# StackOverflow 问答 000327000-000327999

# python - Python 中哪个更快：x**.5 或 math.sqrt(x)？

> ID：327002
> 
> 赞同：234
> 
> 时间：2008-11-29T01:24:09.293
> 
> 标签：python, performance

我一直在想这个问题。正如标题所说，哪个更快，实际功能还是简单地提高到一半？

**更新**

这不是过早优化的问题。这只是底层代码如何实际工作的问题。Python代码如何工作的理论是什么？

我给 Guido van Rossum 发了一封电子邮件，因为我真的很想知道这些方法的区别。

### 我的电子邮件：

> 在 Python 中至少有 3 种求平方根的方法：math.sqrt、'**' 运算符和 pow(x,.5)。我只是对这些实现中的差异感到好奇。说到效率，哪个更好？

### 他的回应：

> pow 和 ** 是等价的；math.sqrt 不适用于复数，并链接到 C sqrt() 函数。至于哪个更快，我不知道...

* * *

## 回答 #1

> 赞同：111
> 
> 时间：2008-11-29T01:32:11.210

**`math.sqrt(x)`明显快于`x**0.5`。**

```
import math
N = 1000000 
```

```
%%timeit
for i in range(N):
    z=i**.5 
```

> 10 个循环，3 个循环中的最佳：每个循环 156 毫秒

```
%%timeit
for i in range(N):
    z=math.sqrt(i) 
```

> 10 个循环，3 个循环中的最佳：每个循环 91.1 毫秒

使用 Python 3.6.9（[笔记本](https://colab.research.google.com/drive/1HWHl3g5erXogBu68mVB00IEYdE7NU09r?usp=sharing)）。

* * *

## 回答 #2

> 赞同：22
> 
> 时间：2008-11-29T02:16:47.533

*   优化的第一条规则：*不要这样做*
*   第二条规则：*暂时不要这样做*

以下是一些时间安排（Python 2.5.2，Windows）：

```
$ python -mtimeit -s"from math import sqrt; x = 123" "x**.5"
1000000 loops, best of 3: 0.445 usec per loop

$ python -mtimeit -s"from math import sqrt; x = 123" "sqrt(x)"
1000000 loops, best of 3: 0.574 usec per loop

$ python -mtimeit -s"import math; x = 123" "math.sqrt(x)"
1000000 loops, best of 3: 0.727 usec per loop 
```

该测试表明`x**.5`比 略快`sqrt(x)`。

对于 Python 3.0，结果是相反的：

```
$ \Python30\python -mtimeit -s"from math import sqrt; x = 123" "x**.5"
1000000 loops, best of 3: 0.803 usec per loop

$ \Python30\python -mtimeit -s"from math import sqrt; x = 123" "sqrt(x)"
1000000 loops, best of 3: 0.695 usec per loop

$ \Python30\python -mtimeit -s"import math; x = 123" "math.sqrt(x)"
1000000 loops, best of 3: 0.761 usec per loop 
```

`math.sqrt(x)`总是比`x**.5`在另一台机器上更快（Ubuntu、Python 2.6 和 3.1）：

```
$ python -mtimeit -s"from math import sqrt; x = 123" "x**.5"
10000000 loops, best of 3: 0.173 usec per loop
$ python -mtimeit -s"from math import sqrt; x = 123" "sqrt(x)"
10000000 loops, best of 3: 0.115 usec per loop
$ python -mtimeit -s"import math; x = 123" "math.sqrt(x)"
10000000 loops, best of 3: 0.158 usec per loop
$ python3.1 -mtimeit -s"from math import sqrt; x = 123" "x**.5"
10000000 loops, best of 3: 0.194 usec per loop
$ python3.1 -mtimeit -s"from math import sqrt; x = 123" "sqrt(x)"
10000000 loops, best of 3: 0.123 usec per loop
$ python3.1 -mtimeit -s"import math; x = 123" "math.sqrt(x)"
10000000 loops, best of 3: 0.157 usec per loop 
```

* * *

## 回答 #3

> 赞同：17
> 
> 时间：2008-11-29T01:45:49.013

在这些微基准测试中，速度会更慢，因为在数学命名空间`math.sqrt`中查找所需的时间很短。`sqrt`你可以稍微改进一下

```
 from math import sqrt 
```

尽管如此，通过 timeit 运行一些变化，显示出轻微的 (4-5%) 性能优势`x**.5`

有趣的是，做

```
 import math
 sqrt = math.sqrt 
```

速度甚至更快，速度差异在 1% 以内，几乎没有统计学意义。

* * *

我将重复 Kibbee，并说这可能是一个过早的优化。

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2008-11-29T01:28:24.353

您真正执行了多少平方根？您是否正在尝试用 Python 编写一些 3D 图形引擎？如果不是，那为什么要使用晦涩难懂的代码而不是易于阅读的代码呢？在我能预见的任何应用程序中，时间差将小于任何人所能注意到的。我真的不是要放下你的问题，但似乎你在过早的优化方面走得太远了。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2010-04-23T04:17:49.423

在 python 2.6 中，`(float).__pow__()` 函数使用 C`pow()`函数，`math.sqrt()`函数使用 C`sqrt()`函数。

在 glibc 编译器中`pow(x,y)`，它的实现非常复杂，并且针对各种异常情况进行了很好的优化。例如，调用 C`pow(x,0.5)`只是调用`sqrt()`函数。

使用`.**`或速度的差异`math.sqrt`是由围绕 C 函数使用的包装器引起的，速度很大程度上取决于系统上使用的优化标志/C 编译器。

**编辑：**

这是克劳迪乌算法在我的机器上的结果。我得到了不同的结果：

```
zoltan@host:~$ python2.4 p.py 
Took 0.173994 seconds
Took 0.158991 seconds
zoltan@host:~$ python2.5 p.py 
Took 0.182321 seconds
Took 0.155394 seconds
zoltan@host:~$ python2.6 p.py 
Took 0.166766 seconds
Took 0.097018 seconds 
```

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-11-29T02:17:09.980

对于它的价值（见吉姆的回答）。在我的机器上，运行 python 2.5：

```
PS C:\> python -m timeit -n 100000 10000**.5
100000 loops, best of 3: 0.0543 usec per loop
PS C:\> python -m timeit -n 100000 -s "import math" math.sqrt(10000)
100000 loops, best of 3: 0.162 usec per loop
PS C:\> python -m timeit -n 100000 -s "from math import sqrt" sqrt(10000)
100000 loops, best of 3: 0.0541 usec per loop 
```

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-11-29T02:28:52.780

在我的机器上使用 Claudiu 的代码，即使使用“从数学导入 sqrt”x**.5 更快，但使用 psyco.full() sqrt(x) 变得更快，至少快 200%

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2010-04-23T05:27:31.410

有人评论了 Quake 3 中的“快速 Newton-Raphson 平方根”……我用 ctypes 实现了它，但与原生版本相比它非常慢。我将尝试一些优化和替代实现。

```
from ctypes import c_float, c_long, byref, POINTER, cast

def sqrt(num):
 xhalf = 0.5*num
 x = c_float(num)
 i = cast(byref(x), POINTER(c_long)).contents.value
 i = c_long(0x5f375a86 - (i>>1))
 x = cast(byref(i), POINTER(c_float)).contents.value

 x = x*(1.5-xhalf*x*x)
 x = x*(1.5-xhalf*x*x)
 return x * num 
```

这是另一种使用 struct 的方法，比 ctypes 版本快 3.6 倍，但仍然是 C 的 1/10。

```
from struct import pack, unpack

def sqrt_struct(num):
 xhalf = 0.5*num
 i = unpack('L', pack('f', 28.0))[0]
 i = 0x5f375a86 - (i>>1)
 x = unpack('f', pack('L', i))[0]

 x = x*(1.5-xhalf*x*x)
 x = x*(1.5-xhalf*x*x)
 return x * num 
```

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2008-11-29T01:25:16.170

很可能是 math.sqrt(x)，因为它针对平方根进行了优化。

基准测试将为您提供您正在寻找的答案。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2018-10-18T08:52:10.233

**Pythonic 要优化的东西是可读性。**为此，我认为`sqrt`最好明确使用该功能。话虽如此，让我们无论如何都要调查性能。

我更新了 Claudiu 的 Python 3 代码，也使得优化计算变得不可能（一个好的 Python 编译器将来可能会这样做）：

```
from sys import version
from time import time
from math import sqrt, pi, e

print(version)

N = 1_000_000

def timeit1():
  z = N * e
  s = time()
  for n in range(N):
    z += (n * pi) ** .5 - z ** .5
  print (f"Took {(time() - s):.4f} seconds to calculate {z}")

def timeit2():
  z = N * e
  s = time()
  for n in range(N):
    z += sqrt(n * pi) - sqrt(z)
  print (f"Took {(time() - s):.4f} seconds to calculate {z}")

def timeit3(arg=sqrt):
  z = N * e
  s = time()
  for n in range(N):
    z += arg(n * pi) - arg(z)
  print (f"Took {(time() - s):.4f} seconds to calculate {z}")

timeit1()
timeit2()
timeit3() 
```

结果各不相同，但示例输出为：

```
3.6.6 (default, Jul 19 2018, 14:25:17) 
[GCC 8.1.1 20180712 (Red Hat 8.1.1-5)]
Took 0.3747 seconds to calculate 3130485.5713865166
Took 0.2899 seconds to calculate 3130485.5713865166
Took 0.2635 seconds to calculate 3130485.5713865166 
```

还有一个更新的输出：

```
3.7.4 (default, Jul  9 2019, 16:48:28) 
[GCC 8.3.1 20190223 (Red Hat 8.3.1-2)]
Took 0.2583 seconds to calculate 3130485.5713865166
Took 0.1612 seconds to calculate 3130485.5713865166
Took 0.1563 seconds to calculate 3130485.5713865166 
```

[自己试试。](https://tio.run/##rZHBbsMgEETv@xWjnMBNIqdpL5H8Cz71XiEHEtQYKJBIcZRvd8GurZybHpB2Z4fhaXHXeLRm2/fK2xbhGqBbZ33ERfqgraFBj7qV0yDXo9qKeJzU8O3jEk4vIYmc1yay3wROVKPC5rMsy3yI9lINKTpuGN8R0KV5jSJdBUKq85Dx1CjrYaANvDAHyerBnf0vFZhJN5zmKAqs37FK6lAlx/A@mFp8WPuFGxvzkiXw3fpN3RFkY80@IFo04tScTyJK3Lr7gj/SvT5Bl/cxE67GtuP/x7Zlwh@qHPt3xpTwgJi75wnnf6V5hzQR877/AQ)

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2010-04-23T03:14:26.183

Claudiu 的结果与我的不同。我在旧 P4 2.4Ghz 机器上的 Ubuntu 上使用 Python 2.6...这是我的结果：

```
>>> timeit1()
Took 0.564911 seconds
>>> timeit2()
Took 0.403087 seconds
>>> timeit1()
Took 0.604713 seconds
>>> timeit2()
Took 0.387749 seconds
>>> timeit1()
Took 0.587829 seconds
>>> timeit2()
Took 0.379381 seconds 
```

sqrt 对我来说始终更快......即使 Codepad.org NOW 似乎也同意 sqrt 在本地环境中更快（[http://codepad.org/6trzcM3j](http://codepad.org/6trzcM3j)）。目前，键盘似乎正在运行 Python 2.5。Claudiu 第一次回答时，也许他们使用的是 2.4 或更早版本？

事实上，即使使用 math.sqrt(i) 代替 arg(i)，我仍然可以更好地使用 sqrt。在这种情况下，timeit2() 在我的机器上花费了 0.53 到 0.55 秒，这仍然比 timeit1 中的 0.56-0.60 数字要好。

我想说，在现代 Python 上，使用 math.sqrt 并绝对将它带到本地上下文中，或者使用 somevar=math.sqrt 或使用 from math import sqrt。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2020-04-25T16:16:46.923

当然，如果处理文字并需要一个常量值，Python 运行时可以在编译时预先计算该值，如果它是用运算符编写的——在这种情况下不需要分析每个版本：

```
In [77]: dis.dis(a)                                                                                                                       
  2           0 LOAD_CONST               1 (1.4142135623730951)
              2 RETURN_VALUE

In [78]: def a(): 
    ...:     return 2 ** 0.5 
    ...:                                                                                                                                  

In [79]: import dis                                                                                                                       

In [80]: dis.dis(a)                                                                                                                       
  2           0 LOAD_CONST               1 (1.4142135623730951)
              2 RETURN_VALUE 
```

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2022-02-23T09:59:34.647

**你好！**我刚刚制作了一个 Stack Exchange 个人资料来参与这次对话！我正在做的事情可能看起来微不足道，但在判断之前听我说一遍：

### 实验条件：

> 1.  离线（没有互联网编译器问题）
> 2.  保持我的系统状态尽可能稳定
> 3.  一次尝试测试所有 3 个功能

对于原始问题中所述的每个函数，我运行了 3 个循环，每个循环 5 次迭代。我在每个循环中计算了从 0 到 10^8 的整数的平方根。

结果如下： 所用 **时间**： `sqrt(x)`< `x**0.5`<`pow(x, 0.5)`

> 注意：在两位数秒的范围内，超过 10^8 个非负整数。

输出截图： [输出](https://i.stack.imgur.com/lcMO8.jpg)

### 我的结论：

我觉得 Guido 的电子邮件很好地证明了这些时间安排。考虑以下陈述：

*   “`math.sqrt()`链接到 C 并且不包含复数”
*   “`**`和`pow()`是等价的”

因此，我们可以暗示这`**`两者`pow()`都有一定的间接成本，因为它们都必须检查传递的输入是否为复数，即使我们传递的是整数。此外，复数是 Python 的内置程序，使用 Python 编写 Python 代码是计算机上的任务。

值得注意的是，`math.sqrt()`它的运行速度相对较快，因为它既不需要检查复数参数的麻烦，也因为它直接与 C 语言函数相连，这被证明比一般 Python 快一点。

如果您对这个结论的看法与我的不同，请告诉我！

### 代码：

```
import time
import math
print("x**0.5 : ")
for _ in range(5):
    start = time.time()
    for i in range(int(1e8)):
        i**0.5
    end = time.time()
    print(end-start)
print("math.sqrt(x) : ")
for _ in range(5):
    start = time.time()
    for i in range(int(1e8)):
        math.sqrt(i)
    end = time.time()
    print(end-start)
print("pow(x,0.5) : ")
for _ in range(5):
    start = time.time()
    for i in range(int(1e8)):
        pow(i,0.5)
    end = time.time()
    print(end-start) 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2017-11-23T14:37:13.630

我最近解决的问题[SQRMINSUM](http://www.spoj.com/problems/SQRMINSUM/ "SQRMINSUM")需要在大型数据集上重复计算平方根。[在我进行其他优化之前，我历史上](http://www.spoj.com/status/SQRMINSUM,nadstratosfer/)最古老的 2 次提交仅通过将 **0.5 替换为 sqrt() 不同，从而将 PyPy 中的运行时间从 3.74 秒减少到 0.51 秒。这几乎是 Claudiu 测量的 400% 改进的两倍。

* * *

## 回答 #15

> 赞同：-4
> 
> 时间：2015-03-24T11:37:06.067

如果你进入 math.py 并将函数“sqrt”复制到你的程序中，那会更快。您的程序需要一些时间才能找到 math.py，然后打开它，找到您要查找的函数，然后将其带回您的程序。如果即使使用“查找”步骤该功能也更快，那么该功能本身必须非常快。可能会将您的时间缩短一半。总之：

1.  转到数学.py
2.  找到函数“sqrt”
3.  复制它
4.  将函数作为 sqrt finder 粘贴到您的程序中。
5.  计时。

# c++ - 使用列名向量生成 sql 语句

> ID：327010
> 
> 赞同：0
> 
> 时间：2008-11-29T01:29:14.447
> 
> 标签：c++, sql, idioms

我们需要在工作场所定期解决的一个问题是如何根据用户提供的表/列名构建 sql 语句。我要解决的问题是列名之间的逗号。

一种技术看起来像这样。

```
selectSql  = "SELECT ";

for (z = 0; z < columns.size(); z++)
{
    selectSql += columns[z]._name;
    selectSql += ", "; 
}

selectSql = selectSql(0, selectSql.len() - 2);

selectSql += "FROM some-table"; 
```

另一种技术看起来像这样

```
selectSql  = "SELECT ";

for (z = 0; z < columns.size(); z++)
{
    selectSql += columns[z]._name;
    if (z < columns.size() - 1) 
        selectSql += ", "; 
}

selectSql += "FROM some-table"; 
```

我对这些实现中的任何一个都不是特别着迷。

我很高兴听到有关解决此问题的其他方法的想法，着眼于使代码更易于阅读/理解/维护。

有哪些替代技术可用？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-29T02:37:04.387

在您的情况下，假设至少有一列可能是安全的，否则进行选择是没有意义的。在这种情况下，您可以这样做：

```
selectSql  = "SELECT ";
selectSql += columns[0]._name;

for (z = 1; z < columns.size(); z++) {
   selectSql += ", ";
   selectSql += columns[z]._name;
}

selectSql += " FROM some-table"; 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-29T19:09:26.163

您可以通过编写一个函数对象并使用类似 strager 提出的方法（尽管他的实现不是 C++），而不是每次都再次应用解决方法，从而一劳永逸地解决问题：

```
struct join {
    std::string sep;
    join(std::string const& sep): sep(sep) { }

    template<typename Column>
    std::string operator()(Column const& a, Column const& b) const {
        return a._name + sep + b._name;
    }
}; 
```

由于我不知道您的列类型，因此我将其保留为模板。现在，每当您想构建查询时，只需执行

```
std::string query = std::accumulate(cols.begin(), cols.end(), 
    std::string("SELECT "), join(", ")) + " FROM some-table;"; 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-29T03:09:16.100

我们不打扰删除尾随的逗号。
这是因为您可以选择一个常量并且 SQL 仍然有效。

```
SELECT A FROM T

-- Is the same as 

SELECT A,1 FROM T

-- Apart from there is an extra column named 1 where each value is 1 
```

因此使用 STL 使其紧凑：

```
#include <sstream>
#include <iterator>
#include <algorithm>

    std::stringstream           select;

    // Build select statement.
    select << "SELECT ";
    std::copy(col.begin(),col.end(),std::ostream_iterator<std::string>(select," , "));
    select << " 1 FROM TABLE PLOP"; 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-29T01:42:59.300

我建立语句的方式通常是：

```
pad = ""
stmt = "SELECT "

for (i = 0; i < number; i++)
{
    stmt += pad + item[i]
    pad = ", "
} 
```

这是相对干净的 - 它重新分配以填充每次迭代，但这是微不足道的。我对此使用了许多微不足道的变体，但它是我所知道的最干净的机制。

当然，也会有其他人的答案可以借鉴...

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-29T19:55:54.867

它不必那么复杂。

```
string sql = "SELECT " + join(cols.begin(), cols.end(), ", ") + " FROM some_table"; 
```

在哪里

```
template <typename I>
string join(I begin, I end, const string& sep){
   ostringstream out;
   for(; begin != end; ++begin){
      out << *begin;
      if(begin+1 != end) out << sep;
   }
   return out.str();
} 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-29T21:21:35.507

不赘述这一点，而是看一下 boost::algorithm::join()。这是一个示例，以防您认为他们的文档对于文字来说太密集了：

```
std::string
build_sql(std::vector<std::string> const& colNames,
          std::string const& tableName)
{
    std::ostringstream sql;
    sql << "SELECT "
        << boost::algorithm::join(colNames, std::string(","))
        << " FROM " << tableName;
    return sql.str();
} 
```

如有疑问，请查看 Boost.org。他们通常已经有了解决大多数类似问题的方法。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-29T01:44:12.277

我建议构建一个通用的连接函数来做到这一点。您可以使用例如累积算法来连接列。

编辑：**见[litb 的实现](https://stackoverflow.com/questions/327010/using-a-vector-of-column-names-to-generate-a-sql-statement#327862)**；它不那么天真。

```
// Untested
#include <numeric>

template<std::string separator>
struct JoinColumns {
    std::string operator()(Column a, Column b) {
        return a._name + separator + b._name;
    }

    // Too lazy to come up with a better name
    std::string inArray(T array) {
        stl::accumulate(array.begin(), array.end(), std::string(), *this);
    }
};

selectSql += stl::accumulate(columns.begin(), columns.end(), std::string(), JoinColumns<", ">());
// or
selectSql += JoinColumns<", ">().inArray(columns); 
```

当然，您可以通过使用更好的包装器来获得更简洁的语法。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-29T02:19:45.593

```
for (z = 0; z < columns.size(); z++)
{
    if( z != 0 )
        selectSql += ", "; 
    selectSql += columns[z]._name;
} 
```

# java - 如何设置 JFileChooser 以实现 java Swing 中的单击行为？

> ID：327016
> 
> 赞同：2
> 
> 时间：2008-11-29T01:37:42.480
> 
> 标签：java, interface, jfilechooser

如何将`JFileChooser`行为从双击选择更改为单击选择模式？

我正在开发一个应用程序来运行单击界面（不需要双击，就像 KDE 界面模式）或双击界面（默认的 Windows 界面模式或常规 GNOME 界面模式）。我希望 Java 应用程序的行为与系统的其余部分一样，以尊重用户当前的配置和环境。

* * *

## 回答 #1

> 赞同：-1
> 
> 时间：2008-11-29T17:00:31.773

理想的解决方案应该是在 JFileChooser 类的某处设置一个配置值，让它在单击或双击模式下工作。

由于貌似没有这样的配置，这里根据Richie_W的思路给出一个大概的解决方案。为了允许用户在许多目录中导航并避免在设置选择时触发的可重入事件，我不得不对其进行一些扩展。但是，正如 Oscar 指出的那样，无法使用键盘进行导航（它总是选择焦点所在的任何内容）。如果你不使用键盘，它可以工作。

```
JFileChooser _fileChooser=new JFileChooser();

if (ConfigurationManager.isSingleClickDesired()) {
    //We will be interested in files only, but we need to allow it to choose both
    _fileChooser.setFileSelectionMode(JFileChooser.FILES_AND_DIRECTORIES);
    _fileChooser.addPropertyChangeListener(new PropertyChangeListener() {

      //To prevent reentry
  private boolean handlingEvent=false;

      public void propertyChange(PropertyChangeEvent e) {

        //Prevent reentry
        if (handlingEvent)
          return;
        else
          //Mark it as handling the event
          handlingEvent=true;

        String propertyName = e.getPropertyName();

        //We are interested in both event types
        if(propertyName.equals(JFileChooser.SELECTED_FILE_CHANGED_PROPERTY) ||
           propertyName.equals(JFileChooser.DIRECTORY_CHANGED_PROPERTY)){

        File selectedFile = (File) e.getNewValue();
        if (selectedFile!=null) {
          if (selectedFile.isDirectory()) {
            //Allow the user to navigate directories with single click
        _fileChooser.setCurrentDirectory(selectedFile);
          } else {
            _fileChooser.setSelectedFile(selectedFile);
            if (_fileChooser.getSelectedFile()!=null)
          //Accept it
          _fileChooser.approveSelection();
        } 
          } 
        }

 //Allow new events to be processed now
     handlingEvent=false;
    }
  }); 
} 
```

Ps->对不起，代码格式不太好看，但是 StackoverFlow 破坏了 KDE 和 Gnome 下的 Firefox 和 Iceweasel 代码格式支持。

# python - 属性 BOLD 似乎在我的诅咒中不起作用

> ID：327026
> 
> 赞同：6
> 
> 时间：2008-11-29T01:46:53.333
> 
> 标签：python, linux, curses, bold

我使用这样的东西：screen.addstr(text, color_pair(1) | A_BOLD)，但它似乎不起作用。但是，A_REVERSE 和所有其他属性确实有效！

实际上，我正在尝试用白色打印一些东西，但是 COLOR_WHITE 将其打印为灰色.. 经过一段时间的搜索，似乎将其打印为灰色 + BOLD 就可以了！

任何帮助将不胜感激。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-29T02:38:50.717

这是一个示例代码（Python 2.6，Linux）：

```
#!/usr/bin/env python
from itertools import cycle
import curses, contextlib, time

@contextlib.contextmanager
def curses_screen():
    """Contextmanager's version of curses.wrapper()."""
    try:
        stdscr=curses.initscr()
        curses.noecho()
        curses.cbreak()
        stdscr.keypad(1)
        try: curses.start_color()
        except: pass

        yield stdscr
    finally:
        stdscr.keypad(0)
        curses.echo()
        curses.nocbreak()
        curses.endwin()

if __name__=="__main__":
    with curses_screen() as stdscr:
        c = curses.A_BOLD
        if curses.has_colors():
            curses.init_pair(1, curses.COLOR_GREEN, curses.COLOR_BLACK)
            c |= curses.color_pair(1)

        curses.curs_set(0) # make cursor invisible

        y, x = stdscr.getmaxyx()
        for col in cycle((c, curses.A_BOLD)):
            stdscr.erase()
            stdscr.addstr(y//2, x//2, 'abc', col)
            stdscr.refresh()
            time.sleep(1) 
```

一切似乎都在工作。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2018-10-26T21:13:20.670

我试过这个：`screen.addstr(text, curses.color_pair(1) | curses.A_BOLD)`它奏效了！

所以只需添加`curses.`它就可以了。当然在开始使用：`import curses`

# php - 如何在 PHP 中实现后台/异步后写缓存？

> ID：327035
> 
> 赞同：6
> 
> 时间：2008-11-29T01:59:53.573
> 
> 标签：php, mysql, caching

我有一个特定的 PHP 页面，由于各种原因，它需要将大约 200 个字段保存到数据库中。这些是 200 个单独的插入和/或更新语句。现在要做的显而易见的事情是减少这个数字，但是，就像我说的那样，由于我不会费心进入的原因，我不能这样做。

我没想到会出现这个问题。选择在 MySQL 中似乎性能合理，但插入/更新却不是（执行此更新大约需要 15-20 秒，这自然是不可接受的）。我编写的 Java/Oracle 系统可以愉快地同时进行数千次插入/更新（在这两种情况下都运行本地数据库；MySQL 5 与 OracleXE）。

现在在 Java 或 .Net 之类的东西中，我可以很容易地执行以下操作之一：

1.  将数据写入内存中的后写缓存（即它知道如何持久化到数据库并且可以异步执行）；
2.  将数据写入内存缓存并使用 PaaS（持久性即服务）模型，即缓存的侦听器将持久化字段；或者
3.  只需启动一个可以持久化数据的后台进程。

最小的解决方案是拥有一个我可以简单更新的缓存，它会在自己的时间单独去更新数据库（即它会在更新内存缓存后立即返回）。这可以是全局缓存或会话缓存（尽管全局共享缓存确实以其他方式吸引人）。

此类问题还有其他解决方案吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-12-16T05:00:02.453

mysql_query('INSERT INTO tableName VALUES(...),(...),(...),(...)')

上面给出的查询语句更好。但是我们有另一种解决方案来提高插入语句的性能。
请按照以下步骤操作..
1\. 您只需创建一个 csv（逗号分隔的分隔文件）或简单的 txt 文件，并使用文件写入机制（如 Java 中的 FileOutputStream 类）写入您要插入的所有数据。
2.使用这个命令

```
LOAD DATA INFILE 'data.txt' INTO TABLE table2
  FIELDS TERMINATED BY '\t'; 
```

3 如果您不清楚此命令，请点击[链接](http://dev.mysql.com/doc/refman/5.1/en/load-data.html)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-29T21:26:01.410

您应该能够相对快速地进行 200 次插入，但这取决于很多因素。如果您正在使用事务引擎并在自己的事务中执行每个引擎，请不要 - 这会产生过多的 I/O。

如果您使用的是非事务性引擎，那就有点棘手了。使用单个多行插入可能会更好，因为 MySQL 的刷新策略意味着它不需要在每行之后刷新其更改。

您真的希望能够在您的生产规格开发箱上重现这一点，并准确分析它发生的原因。停下来应该不难。

当然，另一种可能性是由于极端大小的表或大量索引，您的插入速度很慢 - 在这种情况下，您应该适当地扩展您的数据库服务器。将大量行插入其索引不适合 RAM（或没有正确配置 RAM 以用于缓存这些索引）的表中通常会变得很臭。

但是不要试图寻找一种使您的应用程序复杂化的方法，因为有一种方法可以轻松地转换它，而是保持当前的算法。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-10T10:36:49.240

您可以使用的另一种解决方案（而不是调整 mysql :)）是使用一些 JMS 服务器和PHP 的[STOMP 连接驱动程序](http://stomp.codehaus.org/)以异步方式将数据写入数据库服务器。[ActiveMQ](http://activemq.apache.org/)内置了对 STOMP 协议的支持。还有一个[StompConnect](http://stomp.codehaus.org/StompConnect)项目，它是任何 JMS 兼容服务器（OpenMQ、JBossMQ 等）的 STOMP 代理。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-29T02:02:43.550

您可以更新本地缓存（希望是 memcached），然后通过[beanstalkd](http://xph.us/software/beanstalkd/)推送写入请求。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-29T02:15:38.253

我怀疑你的 SQL 插入有问题——它真的不应该花那么长时间。准备好的查询会有所帮助吗？您的 mysql 服务器是否需要更多专用于键空间的内存？我认为还有一些问题需要问。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-29T04:19:51.607

你是如何进行插入的，你是在每条记录中插入一个吗

```
mysql_query('INSERT INTO tableName VALUES(...)');
mysql_query('INSERT INTO tableName VALUES(...)');
mysql_query('INSERT INTO tableName VALUES(...)');
mysql_query('INSERT INTO tableName VALUES(...)');
mysql_query('INSERT INTO tableName VALUES(...)'); 
```

还是您使用单个查询

```
mysql_query('INSERT INTO tableName VALUES(...),(...),(...),(...)'); 
```

这两个选项中的后者要快得多，根据经验，第一个选项将导致它花费更长的时间，因为 PHP 必须等待第一个查询完成，然后才能移动到第二个，依此类推。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-29T20:28:58.873

在进行插入时查看数据库的统计信息。我*猜*你的一个更新锁定了表，因此你的所有语句都排队了，你会遇到这种延迟。要研究的另一件事是您的索引创建/更新，因为您在表上拥有的索引越多，所有`UPDATE`和`INSERT`语句的速度就越慢。

另一件事是，我认为您使用`MYISAM`（表引擎）将整个表锁定在 UPDATE 上。我建议您`INNODB`改用。`INNODB`-查询速度较慢`SELECT`，但​​速度较快`INSERT`，`UPDATE`因为它只锁定正在处理的行而不是整个表。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2012-01-21T22:42:55.037

考虑一下：

```
mysql_query('start transaction');
mysql_query('INSERT INTO tableName VALUES(...)');
mysql_query('INSERT INTO tableName VALUES(...)');
mysql_query('INSERT INTO tableName VALUES(...)');
mysql_query('INSERT INTO tableName VALUES(...)');
mysql_query('INSERT INTO tableName VALUES(...)'); 
mysql_query('commit;') 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2012-08-22T02:48:18.090

请注意，如果您的表是 INSERT-ONLY（没有删除，也没有对可变长度列进行更新），那么在使用 MyISAM 时插入不会锁定或阻止读取。

这可能会或可能不会提高插入性能，但如果您遇到并发插入/读取问题，它可能会有所帮助。

我正在使用它，并且每天只清除旧记录，然后是“优化表”。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2012-04-08T08:58:55.427

您可以将 CURL 与 PHP 一起使用来进行异步数据库操作。

一种可能的解决方案是将每个查询分叉到一个单独的线程中，但是 PHP 不支持线程。我们可以使用[PCNTL](http://php.net/manual/en/book.pcntl.php)函数，但对我来说使用它们有点棘手。我更喜欢使用这个另一种解决方案来创建 fork 并执行异步操作。

参考这个

[http://gonzalo123.wordpress.com/2010/10/11/speed-up-php-scripts-with-asynchronous-database-queries/](http://gonzalo123.wordpress.com/2010/10/11/speed-up-php-scripts-with-asynchronous-database-queries/)

# opengl - 如何将纹理应用于 glutSolidCube

> ID：327043
> 
> 赞同：16
> 
> 时间：2008-11-29T02:09:43.537
> 
> 标签：opengl, glut, textures

我可以找到有关将纹理映射到指定顶点等的多边形的教程，但没有关于如何将纹理应用于使用 glut (glutSolidCube) 绘制的立方体（或其他东西）的教程。

我正在做类似的事情：

```
glTexEnvfv(GL_TEXTURE_ENV, GL_TEXTURE_ENV_MODE, decal);
glTexParameterfv(GL_TEXTURE_2D, GL_TEXTURE_WRAP_S, repeat);
glTexParameterfv(GL_TEXTURE_2D, GL_TEXTURE_WRAP_T, repeat);
glTexParameterfv(GL_TEXTURE_2D, GL_TEXTURE_MAG_FILTER, nearest);
glTexParameterfv(GL_TEXTURE_2D, GL_TEXTURE_MIN_FILTER, nearest);

glPixelStorei(GL_UNPACK_ALIGNMENT, 1);
glTexImage2D(GL_TEXTURE_2D, 0, 4, myImageWidth, myImageHeight, 0, GL_RGBA, GL_UNSIGNED_BYTE, (GLvoid *)myImage);

//...

glEnable(GL_TEXTURE_2D);

//now draw the cube
glutSolidCube(N); 
```

这样做我将纹理应用于立方体，但整个立方体获得纹理中第一个字节的颜色！

使用 glutSolidCube 时，有没有办法将纹理映射到实体立方体（和其他实体）？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2011-02-16T00:51:49.097

其实有一个解决办法...

你可以像这样使用生成纹理坐标

```
 glEnable(GL_TEXTURE_GEN_S); //enable texture coordinate generation
    glEnable(GL_TEXTURE_GEN_T);
    glBindTexture(GL_TEXTURE_2D, theTexture[2]);
    glutSolidCube(2);
    glDisable(GL_TEXTURE_GEN_S); //enable texture coordinate generation
    glDisable(GL_TEXTURE_GEN_T); 
```

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2008-11-29T03:53:06.963

不，因为`glutSolidCube()`不生成纹理坐标。不过幸运的是，`glutSolidCube()`自己很容易实现并添加纹理坐标。这是源代码`glutSolidCube()`和相关函数，来自[http://www.opengl.org/resources/libraries/glut/](http://www.opengl.org/resources/libraries/glut/)：

```
/* Copyright (c) Mark J. Kilgard, 1994, 1997\. */

/**                                                                             
(c) Copyright 1993, Silicon Graphics, Inc.                                      

ALL RIGHTS RESERVED                                                             

Permission to use, copy, modify, and distribute this software                   
for any purpose and without fee is hereby granted, provided                     
that the above copyright notice appear in all copies and that                   
both the copyright notice and this permission notice appear in                  
supporting documentation, and that the name of Silicon                          
Graphics, Inc. not be used in advertising or publicity                          
pertaining to distribution of the software without specific,                    
written prior permission.

THE MATERIAL EMBODIED ON THIS SOFTWARE IS PROVIDED TO YOU
"AS-IS" AND WITHOUT WARRANTY OF ANY KIND, EXPRESS, IMPLIED OR
OTHERWISE, INCLUDING WITHOUT LIMITATION, ANY WARRANTY OF
MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL SILICON GRAPHICS, INC.  BE LIABLE TO YOU OR ANYONE
ELSE FOR ANY DIRECT, SPECIAL, INCIDENTAL, INDIRECT OR
CONSEQUENTIAL DAMAGES OF ANY KIND, OR ANY DAMAGES WHATSOEVER,
INCLUDING WITHOUT LIMITATION, LOSS OF PROFIT, LOSS OF USE,
SAVINGS OR REVENUE, OR THE CLAIMS OF THIRD PARTIES, WHETHER OR
NOT SILICON GRAPHICS, INC.  HAS BEEN ADVISED OF THE POSSIBILITY
OF SUCH LOSS, HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,
ARISING OUT OF OR IN CONNECTION WITH THE POSSESSION, USE OR
PERFORMANCE OF THIS SOFTWARE.

US Government Users Restricted Rights

Use, duplication, or disclosure by the Government is subject to
restrictions set forth in FAR 52.227.19(c)(2) or subparagraph
(c)(1)(ii) of the Rights in Technical Data and Computer
Software clause at DFARS 252.227-7013 and/or in similar or
successor clauses in the FAR or the DOD or NASA FAR
Supplement.  Unpublished-- rights reserved under the copyright
laws of the United States.  Contractor/manufacturer is Silicon
Graphics, Inc., 2011 N.  Shoreline Blvd., Mountain View, CA
94039-7311.

OpenGL(TM) is a trademark of Silicon Graphics, Inc.
*/

static void
drawBox(GLfloat size, GLenum type)
{
  static GLfloat n[6][3] =
  {
    {-1.0, 0.0, 0.0},
    {0.0, 1.0, 0.0},
    {1.0, 0.0, 0.0},
    {0.0, -1.0, 0.0},
    {0.0, 0.0, 1.0},
    {0.0, 0.0, -1.0}
  };
  static GLint faces[6][4] =
  {
    {0, 1, 2, 3},
    {3, 2, 6, 7},
    {7, 6, 5, 4},
    {4, 5, 1, 0},
    {5, 6, 2, 1},
    {7, 4, 0, 3}
  };
  GLfloat v[8][3];
  GLint i;

  v[0][0] = v[1][0] = v[2][0] = v[3][0] = -size / 2;
  v[4][0] = v[5][0] = v[6][0] = v[7][0] = size / 2;
  v[0][1] = v[1][1] = v[4][1] = v[5][1] = -size / 2;
  v[2][1] = v[3][1] = v[6][1] = v[7][1] = size / 2;
  v[0][2] = v[3][2] = v[4][2] = v[7][2] = -size / 2;
  v[1][2] = v[2][2] = v[5][2] = v[6][2] = size / 2;

  for (i = 5; i >= 0; i--) {
    glBegin(type);
    glNormal3fv(&n[i][0]);
    glVertex3fv(&v[faces[i][0]][0]);
    glVertex3fv(&v[faces[i][1]][0]);
    glVertex3fv(&v[faces[i][2]][0]);
    glVertex3fv(&v[faces[i][3]][0]);
    glEnd();
  }
}

void APIENTRY
glutSolidCube(GLdouble size)
{
  drawBox(size, GL_QUADS);
} 
```

只需添加一些对[glTexCoord*](http://www.opengl.org/documentation/specs/man_pages/hardcopy/GL/html/gl/texcoord.html)系列函数的调用。 [NeHe](http://nehe.gamedev.net/data/lessons/lesson.asp?lesson=06)有一个很好的教程，介绍如何开始使用 OpenGL 进行纹理映射。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-11-29T02:42:15.640

根据[GLUT API 文档](http://www.opengl.org/documentation/specs/glut/spec3/node80.html)：

> [glutSolidCube 生成] 适用于照明的法线，但不生成纹理坐标（茶壶除外）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2020-06-26T20:43:44.313

如果您想避免`glBegin\End`并`GL_TEXTURE_GEN_S\T`按照现代设计

```
 void drawBox() {
        static glm::vec3 n[6] =
        {
          {-1.0, 0.0, 0.0},
          {0.0, 1.0, 0.0},
          {1.0, 0.0, 0.0},
          {0.0, -1.0, 0.0},
          {0.0, 0.0, 1.0},
          {0.0, 0.0, -1.0}
        };
        static int faces[6][4] =
        {
          {0, 1, 2, 3},
          {3, 2, 6, 7},
          {7, 6, 5, 4},
          {4, 5, 1, 0},
          {5, 6, 2, 1},
          {7, 4, 0, 3}
        };
        glm::vec3 v[8];
        int i;

        v[0][0] = v[1][0] = v[2][0] = v[3][0] = -1;
        v[4][0] = v[5][0] = v[6][0] = v[7][0] = 1;
        v[0][1] = v[1][1] = v[4][1] = v[5][1] = -1;
        v[2][1] = v[3][1] = v[6][1] = v[7][1] = 1;
        v[0][2] = v[3][2] = v[4][2] = v[7][2] = -1;
        v[1][2] = v[2][2] = v[5][2] = v[6][2] = 1;

        auto& surface = surfaces[0];

        for ( i = 0; i < 6; i++ ) {
            for ( int j = 0; j < 4; j++ ) 
                surface.normals.push_back( n[i] );
            auto i1 = i * 4;
            surface.indices.push_back( i1 + 0 );
            surface.indices.push_back( i1 + 1 );
            surface.indices.push_back( i1 + 3 );
            surface.indices.push_back( i1 + 1 );
            surface.indices.push_back( i1 + 2 );
            surface.indices.push_back( i1 + 3 );
            surface.vertices.push_back( v[faces[i][0]] );
            surface.vertices.push_back( v[faces[i][1]] );
            surface.vertices.push_back( v[faces[i][2]] );
            surface.vertices.push_back( v[faces[i][3]] );
            surface.texCoords.push_back( { 0, 0 } );
            surface.texCoords.push_back( { 0, 1 } );
            surface.texCoords.push_back( { 1, 0 } );
            surface.texCoords.push_back( { 1, 1 } );
        }
    } 
```

# javascript - 使用 jQuery 创建 HTML 元素的最有效方法是什么？

> ID：327047
> 
> 赞同：432
> 
> 时间：2008-11-29T02:15:53.603
> 
> 标签：javascript, jquery, html, dom

最近我一直在做很多模态窗口弹出窗口等等，为此我使用了 jQuery。我用来在页面上创建新元素的方法绝大多数都是这样的：

```
$("<div></div>"); 
```

但是，我感觉这不是最好或最有效的方法。从性能的角度来看，在 jQuery 中创建元素的最佳方法是什么？

[该答案](https://stackoverflow.com/a/268520/32943)具有以下建议的基准。

* * *

## 回答 #1

> 赞同：311
> 
> 时间：2008-11-29T02:35:20.740

我使用`$(document.createElement('div'));` [Benchmarking 表明](http://jsperf.com/jquery-vs-createelement)这种技术是最快的。我推测这是因为 jQuery 不必将其识别为元素并创建元素本身。

您真的应该使用不同的 Javascript 引擎运行基准测试，并用结果衡量您的受众。从那里做出决定。

* * *

## 回答 #2

> 赞同：165
> 
> 时间：2008-11-29T02:32:18.780

我个人建议（为了可读性）：

```
$('<div>'); 
```

到目前为止建议的一些数字（safari 3.2.1 / mac os x）：

```
var it = 50000;

var start = new Date().getTime();
for (i = 0; i < it; ++i)  {
  // test creation of an element 
  // see below statements
}
var end = new Date().getTime();
alert( end - start );                

var e = $( document.createElement('div') );  // ~300ms
var e = $('<div>');                          // ~3100ms
var e = $('<div></div>');                    // ~3200ms
var e = $('<div/>');                         // ~3500ms 
```

* * *

## 回答 #3

> 赞同：156
> 
> 时间：2013-10-14T16:32:25.337

## 问题：

> 使用 jQuery 创建 HTML 元素的最有效方法是什么？

## 回答：

既然差不多了，`jQuery`我认为最好使用这种（干净的）方法（你正在使用）

```
$('<div/>', {
    'id':'myDiv',
    'class':'myClass',
    'text':'Text Only',
}).on('click', function(){
    alert(this.id); // myDiv
}).appendTo('body'); 
```

[演示。](http://jsfiddle.net/heera/RGerb/)

这样，您甚至可以对特定元素使用事件处理程序，例如

```
$('<div/>', {
    'id':'myDiv',
    'class':'myClass',
    'style':'cursor:pointer;font-weight:bold;',
    'html':'<span>For HTML</span>',
    'click':function(){ alert(this.id) },
    'mouseenter':function(){ $(this).css('color', 'red'); },
    'mouseleave':function(){ $(this).css('color', 'black'); }
}).appendTo('body'); 
```

[演示。](http://jsfiddle.net/heera/RGerb/1/)

但是当您处理大量动态元素时，您应该避免`handlers`在特定元素中添加事件，而是应该使用委托事件处理程序，例如

```
$(document).on('click', '.myClass', function(){
    alert(this.innerHTML);
});

var i=1;
for(;i<=200;i++){
    $('<div/>', {
        'class':'myClass',
        'html':'<span>Element'+i+'</span>'
    }).appendTo('body');
} 
```

[演示。](http://jsfiddle.net/heera/RGerb/3/)

因此，如果您创建并附加数百个具有相同类的元素，即 ( `myClass`)，那么事件处理将消耗更少的内存，因为只有一个处理程序可以为所有动态插入的元素完成这项工作。

**更新：**因为我们可以使用以下方法来创建动态元素

```
$('<input/>', {
    'type': 'Text',
    'value':'Some Text',
    'size': '30'
}).appendTo("body"); 
```

但是`size`不能使用这种方法设置属性 using`jQuery-1.8.0`或更高版本，这是一个旧的[错误报告](http://bugs.jquery.com/ticket/12429)，看看[这个例子](http://jsfiddle.net/heera/RGerb/)using`jQuery-1.7.2`它显示`size`属性设置为`30`使用上面的例子，但使用相同的方法我们不能设置`size`属性 using `jQuery-1.8.3`，这里是一个[不工作的小提琴](http://jsfiddle.net/RGerb/7/)。因此，要设置`size`属性，我们可以使用以下方法

```
$('<input/>', {
    'type': 'Text',
    'value':'Some Text',
    attr: { size: "30" }
}).appendTo("body"); 
```

或者这个

```
$('<input/>', {
    'type': 'Text',
    'value':'Some Text',
    prop: { size: "30" }
}).appendTo("body"); 
```

我们可以`attr/prop`作为子对象传递，但它适用于`jQuery-1.8.0 and later`版本检查[此示例](http://jsfiddle.net/RGerb/8/)，但它[不起作用](http://jsfiddle.net/RGerb/9/)`jQuery-1.7.2 or earlier`（未在所有早期版本中测试）。

顺便说一句，取自`jQuery`错误报告

> 有几种解决方案。首先是根本不使用它，因为它不会为您节省任何空间，这会提高代码的清晰度：

他们建议使用以下方法（[在早期的方法](http://jsfiddle.net/RGerb/11/)中也有效，在中测试`1.6.4`）

```
$('<input/>')
.attr( { type:'text', size:50, autofocus:1 } )
.val("Some text").appendTo("body"); 
```

因此，最好使用这种方法，IMO。此更新是在我阅读/找到[此答案](https://stackoverflow.com/a/19576388/741747)后进行的，并且在此答案中表明，如果您使用`'Size'(capital S)`而不是`'size'`then 它将[正常工作](http://jsfiddle.net/g9Hct/1/)，即使在`version-2.0.2`

```
$('<input>', {
    'type' : 'text',
    'Size' : '50', // size won't work
    'autofocus' : 'true'
}).appendTo('body'); 
```

另请阅读关于[prop](http://api.jquery.com/prop/)，因为存在差异`Attributes vs. Properties`，它因版本而异。

* * *

## 回答 #4

> 赞同：37
> 
> 时间：2010-04-25T19:43:34.407

实际上，如果你在做`$('<div>')`，jQuery 也会使用`document.createElement()`.

（只需看一下[第 117 行](http://code.jquery.com/jquery-1.4.2.js)）。

有一些函数调用开销，但除非性能至关重要（您正在创建数百 [数千] 元素），否则没有太多理由恢复为普通**DOM**。

为新网页创建元素可能是您最好坚持使用**jQuery**做事方式的一种情况。

* * *

## 回答 #5

> 赞同：20
> 
> 时间：2008-11-29T03:00:47.537

如果您有很多 HTML 内容（不仅仅是一个 div），您可能会考虑将 HTML 构建到隐藏容器中的页面中，然后在需要时对其进行更新并使其可见。这样，浏览器可以预先解析大部分标记，并避免在调用时被 JavaScript 卡住。希望这可以帮助！

* * *

## 回答 #6

> 赞同：20
> 
> 时间：2010-02-05T13:39:06.750

这不是问题的正确答案，但我仍然想分享这个......

`document.createElement('div')`当您想要动态制作大量元素并附加到 DOM 时，使用 just和跳过 JQuery 将大大提高性能。

* * *

## 回答 #7

> 赞同：16
> 
> 时间：2008-11-29T02:22:14.697

我认为您使用的是最好的方法，尽管您可以将其优化为：

```
 $("<div/>"); 
```

* * *

## 回答 #8

> 赞同：10
> 
> 时间：2008-11-29T02:42:23.940

从 CPU 的角度来看，您不需要执行极少执行的操作的原始性能。

* * *

## 回答 #9

> 赞同：9
> 
> 时间：2013-07-12T11:25:03.333

你必须明白，元素创建性能的重要性在首先使用 jQuery 的情况下是无关紧要的。

请记住，创建元素没有真正的目的，除非你真的要使用它。

您可能很想进行性能测试，例如`$(document.createElement('div'))`vs.`$('<div>')`并从使用中获得巨大的性能提升，`$(document.createElement('div'))`但这只是 DOM 中尚不存在的一个元素。

但是，归根结底，您还是会想要使用该元素，因此真正的测试应该包括 f.ex。.appendTo();

让我们看看，如果您相互测试以下内容：

```
var e = $(document.createElement('div')).appendTo('#target');
var e = $('<div>').appendTo('#target');
var e = $('<div></div>').appendTo('#target');
var e = $('<div/>').appendTo('#target'); 
```

您会注意到结果会有所不同。有时一种方式比另一种方式表现更好。这只是因为您计算机上的后台任务数量会随着时间而变化。

**[在这里测试自己](http://jsperf.com/jquery-create-html)**

因此，归根结底，您确实想选择最小且最易读的方式来创建元素。这样，至少，您的脚本文件将尽可能小。在性能点上，可能比在 DOM 中使用元素之前创建元素的方式更重要。

* * *

## 回答 #10

> 赞同：8
> 
> 时间：2012-01-22T12:38:37.817

已经有人做了基准测试： [jQuery document.createElement 等效？](https://stackoverflow.com/questions/268490/jquery-document-createelement-equivalent)

`$(document.createElement('div'))`是大赢家。

* * *

## 回答 #11

> 赞同：7
> 
> 时间：2010-09-23T20:13:46.773

一点是这样做可能更容易：

```
$("<div class=foo id=bar style='color:white;bgcolor:blue;font-size:12pt'></div>") 
```

然后用 jquery 调用来完成所有这些。

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2014-09-15T12:53:54.137

我正在使用 jquery.min v2.0.3 。对我来说最好使用以下内容：

```
var select = jQuery("#selecter");
jQuery("`<option/>`",{value: someValue, text: someText}).appendTo(select); 
```

如下：

```
var select = jQuery("#selecter");
jQuery(document.createElement('option')).prop({value: someValue, text: someText}).appendTo(select); 
```

第一个代码的处理时间远低于第二个代码。

# iis-7 - Cruisecontrol.NET & IIS7 静态文件处理程序问题

> ID：327050
> 
> 赞同：1
> 
> 时间：2008-11-29T02:17:25.177
> 
> 标签：iis-7, cruisecontrol.net

我试图让 Cruisecontrol.NET 与 Server 2008/IIS7 一起运行，当我尝试导航到仪表板时，我收到以下错误： HTTP 错误 404.17 - 未找到 请求的内容似乎是脚本，不会由静态文件处理程序。

我在 IIS7 中有点迷失，所以它可能非常简单。他们（cc.net）在 web.config 中使用 http 处理程序做了一些有趣的事情，这可能与问题有关：

有人有任何指示吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-12T16:04:23.577

在 Vista 中，转到控制面板中的 Windows 功能。那里有一个 IIS 部分，您会在 IIS 6 兼容性部分下找到脚本设置

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-29T04:06:14.580

仪表板是否设置为 IIS 中的应用程序？

我没有使用过 IIS7，但我知道在 IIS6 中您需要启用应用程序并将其分配给应用程序池，然后才能运行 ASPX 代码。

**编辑：** 这适用于 IIS6。

在 Web 服务器上打开 IISAdmin 工具。展开网站文件夹。找到 CruiseControl 的虚拟目录（目录？）。右键单击它并查看属性。在目录选项卡上，创建一个新应用程序并为其命名。使应用程序能够执行“仅脚本”。将它分配给一个应用程序池（您可能想为这个应用程序创建一个新的——请参阅帮助文档）。您可能还需要更改 ASP.NET 版本 您可以在 ASP.NET 选项卡上执行此操作——选择 v1.1 或 v2.0，无论 CruiseControl 需要哪个。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-04-05T00:28:07.537

当我在 Windows 7/IIS 7.5 下安装 CCNET 1.5 时，我也遇到了同样的问题

您需要为 ccnet 站点配置应用程序池。在应用程序池的基本设置下，将“托管管道模式”设置为“集成”。

# php - 如何使用 HABTM 关系在 CakePHP 中查询数据？

> ID：327052
> 
> 赞同：7
> 
> 时间：2008-11-29T02:18:01.507
> 
> 标签：php, cakephp, has-and-belongs-to-many, cakephp-1.2

我正在开发一个 CakePHP 1.2 应用程序。我有一个模型“用户”，通过连接表定义了一些与其他表的 HABTM 关系。

我现在的任务是根据存储在这些 HABTM 表之一中的数据查找用户信息。不幸的是，当查询执行时，我的条件因缺少表的错误而被拒绝。经过检查，CakePHP 似乎没有在 select 语句中包含任何 HABTM 表。

我的用户 HABTM 关系如下：

```
 var $hasAndBelongsToMany = array(
    'Course' => array(
        'className'             => 'Course',
        'joinTable'              => 'course_members',
        'foreignKey'             => 'user_id',
        'associationForeignKey'  => 'course_id',
        'conditions'             => '',
        'order'                  => '',
        'limit'                  => '',
        'uniq'                   => false,
        'finderQuery'            => '',
        'deleteQuery'            => '',
        'insertQuery'            => ''
    ),
    'School' => array(
        'className'             => 'School',
        'joinTable'              => 'school_members',
        'foreignKey'             => 'user_id',
        'associationForeignKey'  => 'school_id',
        'conditions'             => '',
        'order'                  => '',
        'limit'                  => '',
        'uniq'                   => false,
        'finderQuery'            => '',
        'deleteQuery'            => '',
        'insertQuery'            => ''
    ),
    'Team' => array(
        'className'             => 'Team',
        'joinTable'              => 'team_members',
        'foreignKey'             => 'user_id',
        'associationForeignKey'  => 'team_id',
        'conditions'             => '',
        'order'                  => '',
        'limit'                  => '',
        'uniq'                   => false,
        'finderQuery'            => '',
        'deleteQuery'            => '',
        'insertQuery'            => ''
    )
); 
```

错误是：

> SQL 错误：1054：“where 子句”中的未知列“School.name”

最后，它试图执行的查询

```
 SELECT 
 `User`.`id`, `User`.`username`, `User`.`password`, `User`.`firstName`, `User`.`lastName`, `User`.`email

`, `User`.`phone`, `User`.`streetAddress`, `User`.`city`, `User`.`province`, `User`.`country`, `User

`.`postal`, `User`.`userlevel`, `User`.`modified`, `User`.`created`, `User`.`deleted`, `User`.`deleted_date

` FROM `users` AS `User`   WHERE `User`.`id` = 6 AND `School`.`name` LIKE '%Test%'    LIMIT 1 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-30T13:46:44.330

将调试级别提高到 2 并查看 SQL 输出。找到您的代码正在生成的查询，您会注意到有几个。CakePHP 中的 ORM 层不会在第一个查询中加入 HABTM 相关表。它从第一次选择中获取结果，然后分别获取每个项目的 HABTM 数据。因为连接表不在第一个查询中，所以打算在连接表上使用的条件会导致您看到的错误。

这本烹饪书有一节介绍了[HABTM 关联](http://book.cakephp.org/2.0/en/models/associations-linking-models-together.html#hasandbelongstomany-habtm)和根据 HABTM 表中满足您要求的条件获取数据。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2010-08-07T18:42:14.463

来自食谱：[http ://book.cakephp.org/view/83/hasAndBelongsToMany-HABTM](http://book.cakephp.org/view/83/hasAndBelongsToMany-HABTM)

一种选择是搜索标签模型（而不是食谱），这也将为我们提供所有相关的食谱。

```
$this->Recipe->Tag->find('all', array(
    'conditions' => array('Tag.name' => 'Dessert'))); 
```

我们还可以使用连接表模型（CakePHP 为我们提供）来搜索给定的 ID。

```
$this->Recipe->bindModel(array('hasOne' => array('RecipesTag')));
$this->Recipe->find('all', array(
    'fields' => array('Recipe.*'),
    'conditions' => array('RecipesTag.tag_id' => 124) // id of Dessert
)); 
```

也可以创建一个奇异的关联，以便根据需要创建尽可能多的连接以允许过滤，例如：

```
$this->Recipe->bindModel(array('hasOne' => array('RecipesTag',
    'FilterTag' => array(
        'className' => 'Tag',
        'foreignKey' => false,
        'conditions' => array('FilterTag.id = RecipesTag.tag_id')
))));
$this->Recipe->find('all', array(
    'fields' => array('Recipe.*'),
    'conditions' => array('FilterTag.name' => 'Dessert')
)); 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-05T06:11:24.387

您的表应该称为“schools_users”而不是“school_members”，因为它是多对多的，因此在两边的表名中使用复数形式是合适的。

您还将模型类名称“学校”设置为 HABTM 的别名。您应该将其更改为更通用的内容，例如“用户在并且拥有许多 SchoolS”中的“Schools”以避免冲突。

还有另一个提示：尝试“通过”学校模型而不是用户模型来查找用户。

$this->User->Schools->find()

希望这可以帮助。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-29T10:26:12.443

FWIW，您的连接表确实似乎是“奇怪的命名”，因为它们不遵循此处描述的约定：

[http://book.cakephp.org/view/83/hasAndBelongsToMany-HABTM](http://book.cakephp.org/view/83/hasAndBelongsToMany-HABTM)

无论如何，祝你好运，我记得 HABTM 在 CakePHP 中是个麻烦事。

# php - PHP中的动态逻辑表达式解析/评估？

> ID：327060
> 
> 赞同：12
> 
> 时间：2008-11-29T02:21:02.890
> 
> 标签：php, parsing

我需要在某些 PHP 页面上评估任意复杂度的用户定义的逻辑表达式。假设表单字段是主要变量，则需要：

*   用“变量”替换表单字段值；
*   处理比较运算符，至少按符号、名称处理 ==、<、<=、>= 和 >（例如分别为 eq、lt、le、ge、gt）；
*   处理布尔运算符 not, and, or and possible xor by name, symbol (eg !, &&, || and ^^);
*   处理字符串和数字的文字值；
*   是纯文本而不是 XML（例如“名字 == '' 或姓氏 == ''）；和
*   性能合理。

现在在过去的几年里，我已经编写了递归下降解析器，它可以构建一个表达式树并做这种事情，但这不是我在 PHP 中津津乐道的任务，所以我希望那里有一些东西至少会得到我在那儿的一些路。

建议？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2015-08-01T04:21:40.643

自从提出这个问题以来已经过去了很多时间，我碰巧正在寻找一个用于 php.ini 的表达式解析器。我选择使用 Symfony 2.4 中的[ExpressionLanguage](http://symfony.com/blog/new-in-symfony-2-4-the-expressionlanguage-component)组件。它可以通过[packagist](https://packagist.org/packages/symfony/expression-language)安装，无需来自 composer 的依赖。

`composer require symfony/expression-language`

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-29T02:31:27.020

检查[create_function](http://www.php.net/create_function)，它从传递的字符串参数创建一个匿名函数，我不确定它的性能，但它非常灵活......

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-29T05:25:42.673

如果我正确理解了这个问题，您希望用户用非 PHP 编写函数，然后让 PHP 解释它吗？

如果是这样，您可以简单地获取他们的字符串并将“lt”替换为“<”，将“gt”替换为“>”……然后执行 eval()。

我有一种预感，问题不是这么简单，但如果是这样， eval() 就可以完成这项工作。当然，那么你就会为任何形式的攻击敞开心扉。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-05T21:31:23.890

看看[我的中缀到后缀示例](http://www.guge.net/?p=3#more-3)，我认为您可以相对轻松地将其移植到 PHP。它只使用一个阵列和一些开关。没有树。只需要一个堆栈来运行后缀结果。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-04-06T22:49:35.353

看看这个功能： http: [//pluginphp.com/plug-in31.php](http://pluginphp.com/plug-in31.php)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2013-02-24T18:21:23.327

您可以尝试调整我的 Evaluator 类（[https://github.com/djfm/Evaluator](https://github.com/djfm/Evaluator)），它执行算术表达式（目前），您也可以使用变量。实现了所有主要的 PHP 运算符。

# php - PHP中的XML解析和转换？

> ID：327066
> 
> 赞同：0
> 
> 时间：2008-11-29T02:33:05.953
> 
> 标签：php, xml, regex, parsing

我为页面显示定义了一个自定义 XML 模式，它通过评估页面上的 XML 元素将元素放在页面上。目前这是使用 preg 正则表达式函数实现的，主要是优秀的 preg_replace_callback 函数，例如：

```
...
$s = preg_replace_callback("!<field>(.*?)</field>!", replace_field, $s);
...

function replace_field($groups) {
  return isset($fields[$group[1]) ? $fields[$groups[1]] : "";
} 
```

举个例子。

现在这工作得很好......只要 XML 元素没有嵌套。在这一点上，它变得更加复杂，就像你有：

```
<field name="outer">
  <field name="inner">
    ...
  </field>
</field> 
```

您要确保首先替换最里面的字段。明智地使用贪婪/非贪婪的正则表达式模式可以在一定程度上处理这些更复杂的场景，但明确的信息是我已经达到了正则表达式可以合理做的极限，我真的需要做 XML 解析。

我想要的是一个 XML 转换包，它：

允许我有条件地评估/包含包含的文档树或不理想地基于回调函数（类似于 preg_replace_callback）；可以处理相同或不同类型的嵌套元素；并以一种很好的方式处理属性（例如作为关联数组）。

一路走来有什么可以帮助我的？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-29T02:50:39.820

您可以使用 XSL 来执行此操作 - 只需首先匹配内部模式。

这是学习 XSL 可以做什么的一个很好的起点：

[http://www.w3schools.com/xsl/](http://www.w3schools.com/xsl/)

您可以在服务器端或客户端执行 xsl 转换（使用 js、activex 或其他）。

如果您仍然讨厌 xsl 的这个想法，您可以查看 PHP 中内置的 xml 解析 - google for SAX parser PHP - 这是构建自定义解析器的回调实现，目前使用 libxml2。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-29T10:19:44.080

PHP 的[`XSLTProcessor`](http://de2.php.net/manual/en/class.xsltprocessor.php)类（[ext/xsl](http://de2.php.net/manual/en/book.xsl.php) - PHP 5 默认包含 XSL 扩展，可以通过将参数添加`--with-xsl[=DIR]`到配置行来启用）非常复杂，并且允许通过使用[`XSLTProcessor::registerPHPFunctions()`](http://de2.php.net/manual/en/xsltprocessor.registerphpfunctions.php)方法在 XSL 文档中使用 PHP 函数等。

[以下示例是从PHP 手册页](http://de2.php.net/manual/en/xsltprocessor.registerphpfunctions.php)中无耻地捏造出来的：

```
$xml = '<allusers>
 <user>
  <uid>bob</uid>
 </user>
 <user>
  <uid>joe</uid>
 </user>
</allusers>';
$xsl = '<?xml version="1.0" encoding="UTF-8"?>
<xsl:stylesheet version="1.0" 
     xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
     xmlns:php="http://php.net/xsl">
<xsl:output method="html" encoding="utf-8" indent="yes"/>
 <xsl:template match="allusers">
  <html><body>
    <h2>Users</h2>
    <table>
    <xsl:for-each select="user">
      <tr><td>
        <xsl:value-of
             select="php:function(\'ucfirst\',string(uid))"/>
      </td></tr>
    </xsl:for-each>
    </table>
  </body></html>
 </xsl:template>
</xsl:stylesheet>';
$xmldoc = DOMDocument::loadXML($xml);
$xsldoc = DOMDocument::loadXML($xsl);

$proc = new XSLTProcessor();
$proc->registerPHPFunctions();
$proc->importStyleSheet($xsldoc);
echo $proc->transformToXML($xmldoc); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-03-21T10:56:53.857

绝对不是正则表达式。XML 格式可以以不影响其内容的方式进行更改（换句话说：对 XML 处理库不可见），但对正则表达式很重要。这样的代码很快成为维护的噩梦。

至于使用哪个解析器（SAX、StAX、DOM、JDOM、dom4j、XOM 等），

# ios - 收到 EXC_BAD_ACCESS 信号

> ID：327082
> 
> 赞同：296
> 
> 时间：2008-11-29T02:50:26.887
> 
> 标签：ios, cocoa-touch

将应用程序部署到设备时，程序将在几个周期后退出，并出现以下错误：

```
Program received signal: "EXC_BAD_ACCESS". 
```

该程序在 iPhone 模拟器上运行没有任何问题，只要我一步一步执行说明，它也会调试和运行。一旦我让它再次运行，我就会击中`EXC_BAD_ACCESS`信号。

在这种特殊情况下，恰好是加速度计代码中的错误。它不会在模拟器中执行，这就是它没有抛出任何错误的原因。但是，它会在部署到设备后执行。

这个问题的大多数答案都是针对一般`EXC_BAD_ACCESS`错误的，所以我将把它作为一个全面的开放性来解决可怕的 Bad Access 错误。

`EXC_BAD_ACCESS`通常由于非法内存访问而引发。您可以在下面的答案中找到更多信息。

你`EXC_BAD_ACCESS`之前有遇到过信号吗，你是怎么处理的？

* * *

## 回答 #1

> 赞同：201
> 
> 时间：2008-11-29T23:17:07.427

根据您的描述，我怀疑最可能的解释是您的内存管理存在一些错误。您说您从事 iPhone 开发工作已经有几个星期了，但不是说您是否对 Objective C 有总体经验。如果您来自其他背景，则可能需要一段时间才能真正内化内存管理规则 - 除非您非常重视它。

请记住，您从分配函数（通常是静态分配方法，但还有一些其他方法）或复制方法中获得的任何内容，您也拥有内存，并且必须在完成后释放它。

*但是，如果您从包括*工厂方法（例如）在内的任何其他东西中得到一些东西，`[NSString stringWithFormat]`那么您将拥有一个自动释放引用，这意味着它可以在将来的某个时间由其他代码发布 - 因此，如果您需要，这一点至关重要将其保留在您保留它的直接功能之外。如果不这样做，内存可能会在您使用它时保持分配状态，或者在您的模拟器测试期间被释放但巧合地仍然有效，但更有可能在设备上运行时被释放并显示为错误的访问错误。

追踪这些事情的最好方法，也是一个好主意（即使没有明显的问题）是在 Instruments 工具中运行应用程序，尤其是使用 Leaks 选项。

* * *

## 回答 #2

> 赞同：101
> 
> 时间：2009-07-01T07:27:49.463

EXC_BAD_ACCESS 的一个主要原因是试图访问已释放的对象。

要了解如何解决此问题，请阅读此文档： [DebuggingAutoReleasePool](http://cocoadev.com/DebuggingAutorelease)

即使您不认为自己在“释放自动释放的对象”，这也适用于您。

这种方法非常有效。我一直在使用它并取得了巨大的成功！！

总之，这解释了如何使用 Cocoa 的 NSZombie 调试类和命令行“malloc_history”工具来准确查找在您的代码中访问了哪些已发布对象。

**边注：**

运行仪器和检查泄漏将无助于排除 EXC_BAD_ACCESS 故障。我很确定内存泄漏与 EXC_BAD_ACCESS 无关。泄漏的定义是您不再有权访问的对象，因此您无法调用它。

**更新：** 我现在使用 Instruments 来调试泄漏。在 Xcode 4.2 中，选择 Product->Profile，当 Instruments 启动时，选择“Zombies”。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2008-11-29T04:08:40.223

EXC_BAD_ACCESS 信号是将无效指针传递给系统调用的结果。我今天早些时候在 OS X 上用一个测试程序得到了一个 - 我将一个未初始化的变量传递给`pthread_join()`，这是由于早期的错字造成的。

我不熟悉 iPhone 开发，但您应该仔细检查您传递给系统调用的所有缓冲区指针。一直提高编译器的警告级别（使用 gcc，使用`-Wall`and`-Wextra`选项）。在模拟器/调试器上启用尽可能多的诊断。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2008-11-29T22:49:35.920

根据我的经验，这通常是由非法内存访问引起的。检查所有指针，尤其是对象指针，以确保它们已初始化。确保您的 MainWindow.xib 文件（如果您正在使用一个文件）设置正确，并具有所有必要的连接。

如果纸上检查都没有发现任何问题，并且单步执行时也没有发生，请尝试使用 NSLog() 语句定位错误：将它们撒在你的代码上，移动它们直到你隔离导致的行错误。然后在该行设置断点并运行您的程序。当您到达断点时，检查所有变量以及其中的对象，看看是否有任何不符合您预期的情况。我会特别注意其对象类是您未曾预料到的变量。如果一个变量应该包含一个 UIWindow 但它却有一个 NSNotification ，那么当调试器不运行时，相同的底层代码错误可能会以不同的方式表现出来。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2009-10-26T03:59:07.273

我只花了几个小时跟踪 EXC_BAD_ACCESS 并发现 NSZombies 和其他环境变量似乎没有告诉我任何信息。

对我来说，这是一个带有格式说明符但没有传递参数的愚蠢 NSLog 语句。

```
NSLog(@"Some silly log message %@-%@"); 
```

由固定

```
NSLog(@"Some silly log message %@-%@", someObj1, someObj2); 
```

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2010-10-19T20:31:36.907

Apple 开发者计划的任何参与者都可以观看 2010 WWDC 视频。有一个很棒的视频：“Session 311 - Advanced Memory Analysis with Instruments”展示了在仪器中使用僵尸和调试其他内存问题的一些示例。

如需登录页面的链接，请单击[此处](http://insideapple.apple.com/redir/cbx-cgi.do?v=2&la=en&lc=&a=kGSol9sgPHP%2BtlWtLp%2BEP%2FnxnZarjWJglPBZRHd3oDbACudP51JNGS8KlsFgxZto9X%2BTsnqSbeUSWX0doe%2Fzv%2FN5XV55%2FomsyfRgFBysOnIVggO%2Fn2p%2BiweDK%2F%2FmsIXj)。

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2008-12-01T05:20:51.090

不是一个完整的答案，但我收到的一个特定情况是当我尝试访问一个“死”的对象时，因为我试图使用自动释放：

```
netObjectDefinedInMyHeader = [[[MyNetObject alloc] init] autorelease]; 
```

例如，我实际上将它作为一个对象传递给“通知”（将其注册为侦听器、观察者，无论您喜欢什么成语），但是一旦发送通知，它就已经死了，我会得到 EXC_BAD_ACCESS。稍后根据需要将其更改为`[[MyNetObject alloc] init]`并释放它可以解决该错误。

这可能发生的另一个原因是，例如，如果您传入一个对象并尝试存储它：

```
myObjectDefinedInHeader = aParameterObjectPassedIn; 
```

稍后在尝试访问 myObjectDefinedInHeader 时，您可能会遇到麻烦。使用：

```
myObjectDefinedInHeader = [aParameterObjectPassedIn retain]; 
```

可能是你需要的。当然，这些只是我遇到的几个例子，还有其他原因，但这些可能难以捉摸，所以我提到它们。祝你好运！

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2009-12-07T00:44:44.943

我发现在 objc_exception_throw 上设置断点很有用。这样，当您获得 EXC_BAD_ACCESS 时，调试器应该会中断。

可以在此处找到说明[DebuggingTechniques](http://www.cocoadev.com/DebuggingTechniques)

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2009-07-23T11:07:06.840

只是添加另一种可能发生这种情况的情况：

我有代码：

```
NSMutableString *string;
[string   appendWithFormat:@"foo"]; 
```

显然我忘记为字符串分配内存：

```
NSMutableString *string = [[NSMutableString alloc] init];
[string   appendWithFormat:@"foo"]; 
```

解决问题。

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2012-12-26T19:15:18.873

在 EXC_BAD_ACCESS 异常发生之前捕获它们的另一种方法是[静态分析器](http://developer.apple.com/library/ios/#documentation/ToolsLanguages/Conceptual/Xcode4UserGuide/060-Debug_Your_App/debug_app.html#//apple_ref/doc/uid/TP40010215-CH3-SW22)，在 XCode 4+ 中。

使用 Product > Analyze (shift+cmd+B) 运行静态分析器。单击分析器生成的任何消息将覆盖源上的图表，显示有问题的对象的保留/释放顺序。

![在此处输入图像描述](https://i.stack.imgur.com/waqzG.png)

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2010-02-17T08:15:14.983

使用简单的规则“如果你没有分配或保留它，就不要释放它”。

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2010-09-15T19:13:09.833

[如何调试 EXC_BAD_ACCESS](http://www.touch-code-magazine.com/how-to-debug-exc_bad_access/)

查看上面的链接并按照它所说的去做......只是一些使用 NSZombies 的快速说明

运行应用程序并在它失败后（应该显示“中断”而不是“EXC_BAD_ACCESS”......检查控制台（运行>控制台）......现在应该有一条消息告诉它试图访问什么对象。

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2009-05-16T19:35:56.513

在过去的四个小时里，我一直在调试和重构代码以解决此错误。上面的帖子让我看到了问题：

之前的属性： startPoint = [[DataPoint alloc] init] ; startPoint= [DataPointList objectAtIndex: 0];
. . . x = startPoint.x - 10；// EXC_BAD_ACCESS

之后的属性： startPoint = [[DataPoint alloc] init] ; startPoint = [[DataPointList objectAtIndex: 0] 保留];

再见 EXC_BAD_ACCESS

* * *

## 回答 #14

> 赞同：3
> 
> 时间：2009-08-24T02:04:38.053

希望你完成后释放“字符串”！

* * *

## 回答 #15

> 赞同：3
> 
> 时间：2010-02-09T11:54:40.950

我忘记在初始化方法中返回 self ... ;)

* * *

## 回答 #16

> 赞同：3
> 
> 时间：2010-03-04T05:40:56.960

忘记从`dealloc`. 我在 UINavigationController 的 rootView 上获得了 exc_bad_access，但只是有时。我认为问题出在 rootView 中，因为它在 viewDidAppear{} 中途崩溃了。事实证明，只有在我使用错误的 dealloc{} 版本弹出视图后才会发生这种情况，就是这样！

"EXC_BAD_ACCESS" [切换到进程 330] 现在没有可用于编程的内存：调用 malloc 不安全

我认为这是我试图分配的问题......而不是我试图释放非分配的问题，D'oh！

* * *

## 回答 #17

> 赞同：3
> 
> 时间：2010-05-03T00:50:31.770

这是一个很好的线程。这是我的经验：我搞砸了属性声明中的 retain/assign 关键字。我说：

```
@property (nonatomic, assign) IBOutlet UISegmentedControl *choicesControl;
@property (nonatomic, assign) IBOutlet UISwitch *africaSwitch;
@property (nonatomic, assign) IBOutlet UISwitch *asiaSwitch; 
```

我应该说的地方

```
@property (nonatomic, retain) IBOutlet UISegmentedControl *choicesControl;
@property (nonatomic, retain) IBOutlet UISwitch *africaSwitch;
@property (nonatomic, retain) IBOutlet UISwitch *asiaSwitch; 
```

* * *

## 回答 #18

> 赞同：3
> 
> 时间：2010-06-28T12:49:07.887

我仅在尝试执行包含大数组的 C 方法时在 iPhone 上遇到 EXC_BAD_ACCESS。模拟器能够给我足够的内存来运行代码，但不是设备（数组是一百万个字符，所以有点过分了！）。

EXC_BAD_ACCESS 发生在方法的入口点之后，让我困惑了很长时间，因为它离数组声明很远。

也许其他人可能会从我几个小时的拉头发中受益。

* * *

## 回答 #19

> 赞同：3
> 
> 时间：2014-01-07T09:17:17.660

我如何处理 EXC_BAD_ACCESS

有时我觉得当抛出 EXC_BAD_ACCESS 错误时，xcode 会在 main.m 类中显示错误，而不会提供崩溃发生位置的额外信息（有时）。

在那些时候，我们可以在 Xcode 中设置一个异常断点，以便在捕获到异常时放置一个断点，并直接告知用户该行发生了崩溃

![在此处输入图像描述](https://i.stack.imgur.com/eojHc.png)

* * *

## 回答 #20

> 赞同：2
> 
> 时间：2008-11-30T14:39:46.317

NSAssert() 调用验证方法参数对于跟踪和避免传递 nil 非常方便。

* * *

## 回答 #21

> 赞同：2
> 
> 时间：2009-05-30T23:48:57.387

在过去的四个小时里，我一直在调试和重构代码以解决此错误。上面的帖子让我看到了问题：

之前的财产：

```
startPoint = [[DataPoint alloc] init] ;
startPoint= [DataPointList objectAtIndex: 0];
x = startPoint.x - 10; // EXC_BAD_ACCESS 
```

之后的属性：

```
startPoint = [[DataPoint alloc] init] ;
startPoint = [[DataPointList objectAtIndex: 0] retain]; 
```

再见`EXC_BAD_ACCESS`

非常感谢您的回答。我整天都在为这个问题苦苦挣扎。你真棒！

* * *

## 回答 #22

> 赞同：2
> 
> 时间：2009-12-10T14:38:15.100

我刚遇到这个问题。对我来说，原因是删除一个 CoreData 托管对象，然后尝试从另一个地方读取它。

* * *

## 回答 #23

> 赞同：2
> 
> 时间：2010-04-05T11:16:18.037

只是添加

[Lynda.com](http://www.lynda.com/)有一张很棒的 DVD，叫做

> [iPhone SDK 基础培训](http://www.lynda.com/home/DisplayCourse.aspx?lpk2=48369)

第 6 章第 3 课是关于**EXEC_BAD_ACCESS**和使用 Zombies 的全部内容。

对我来说很好理解，不仅仅是错误代码，还有我如何使用 Zombies 来获取有关已发布对象的更多信息。

* * *

## 回答 #24

> 赞同：2
> 
> 时间：2011-02-23T16:52:22.710

检查错误可能是什么

使用 NSZombieEnabled。

要在您的应用程序中激活 NSZombieEnabled 工具：

选择 Project > Edit Active Executable 打开可执行信息窗口。单击参数。单击“要在环境中设置的变量”部分中的添加 (+) 按钮。在 Name 列中输入 NSZombieEnabled，在 Value 列中输入 YES。确保选中 NSZombieEnabled 条目的复选标记。

我在 iPhoneSDK 上找到了这个答案

* * *

## 回答 #25

> 赞同：2
> 
> 时间：2012-02-14T04:46:51.710

我意识到前段时间有人问过这个问题，但是在阅读了这个帖子之后，我找到了 XCode 4.2 的解决方案：产品 -> 编辑方案 -> 诊断选项卡 -> 启用僵尸对象

帮助我找到发送到已释放对象的消息。

* * *

## 回答 #26

> 赞同：2
> 
> 时间：2014-04-13T19:36:05.037

当你有无限递归时，我认为你也可能有这个错误。这对我来说是一个案例。

* * *

## 回答 #27

> 赞同：1
> 
> 时间：2012-03-09T12:02:22.170

XCode 4 及更高版本，使用 Instruments 变得非常简单。只需在 Instruments 中运行 Zombies。本教程解释得很好：[debugging exc_bad_access error xcode instruments](http://www.ioslearner.com/debugging-exc_bad_access-error-xcode-instruments/)

* * *

## 回答 #28

> 赞同：1
> 
> 时间：2012-10-18T21:09:27.630

`@`创建字符串时不要忘记符号，`C-strings`视为`NSStrings`将导致`EXC_BAD_ACCESS`.

用这个：

```
@"Some String" 
```

而不是这样：

```
"Some String" 
```

PS - 通常在`array`使用大量记录填充内容时。

* * *

## 回答 #29

> 赞同：1
> 
> 时间：2012-11-29T09:07:48.633

甚至另一种可能性：在队列中使用块时，您可能很容易尝试访问另一个队列中的对象，此时该对象已被取消分配。通常当您尝试向 GUI 发送内容时。如果您的异常断点被设置在一个奇怪的地方，那么这可能是原因。

* * *

## 回答 #30

> 赞同：1
> 
> 时间：2013-01-21T23:52:10.827

我明白了，因为我没有使用`[self performSegueWithIdentifier:sender:]`并且`-(void) prepareForSegue:(UIstoryboardSegue *)`正确

* * *

## 回答 #31

> 赞同：1
> 
> 时间：2017-04-02T09:56:08.990

在你做任何事情之前，你应该尝试：

**产品 -> 清洁**

并再次运行。它对我有用。否则，我会浪费时间。

* * *

## 回答 #32

> 赞同：0
> 
> 时间：2021-03-04T17:31:41.827

在我的情况下，我有一个视图（A），在我有另一个视图（B）的实例。我忘记了 B 是 A 的子类。显然这会导致递归和无休止的分配。打破这个问题修复了 EXE_BAD_ACCESS 问题。

```
 class A: UIView {

      let b = B()
      .
      .
   }

   class B: A {
     .
     .
   } 
```

* * *

## 回答 #33

> 赞同：0
> 
> 时间：2021-05-10T13:22:49.650

**EXC_BAD_ACCESS**

`EXC_BAD_ACCESS`访问已经释放的对象。内核发送此异常（EXC），表示无法访问内存块（BAD ACCESS）。

*   [[unowned(unsafe)]](https://stackoverflow.com/a/61020491/4770877)被使用
*   当一个目标使用具有不同`IPHONEOS_DEPLOYMENT_TARGET`[^([About])](https://stackoverflow.com/a/63671561/4770877)的另一个目标时。在我的例子中`Test`，target(10.0) 使用`explicit dependency`[^([About])](https://stackoverflow.com/a/59219025/4770877)和`14.0`IPHONEOS_DEPLOYMENT_TARGET

* * *

## 回答 #34

> 赞同：0
> 
> 时间：2021-07-08T21:07:22.983

尝试在 12 Pro Max 上分配 140000x 屏幕高度的 ScrollView 空间时出现 EXC_BAD_ACCESS 错误。它分配得很好，直到达到大约 140,000 像素宽度。;)

* * *

## 回答 #35

> 赞同：0
> 
> 时间：2021-10-28T14:56:04.850

如果您正在使用自定义字体并以编程方式对其进行实例化，则如果您之前未在运行时注册字体，则可能会发生此错误。

为了确定是否是这种情况，Xcode 控制台将打印如下内容：

```
* thread #1, queue = 'com.apple.main-thread', stop reason = EXC_BAD_ACCESS (code=1, address=0x1d8)
    frame #0: 0x0000000180f969cc CoreText`CTFontGetClientObject + 12
... 
```

或者

```
* thread #1, queue = 'com.apple.main-thread', stop reason = EXC_BAD_INSTRUCTION (code=EXC_I386_INVOP, subcode=0x0)
    frame #0: 0x000000012341c10e CoreFoundation`CFRelease.cold.1 + 14
    frame #1: 0x00000001232ed7bd CoreFoundation`CFRelease + 77
    frame #2: 0x0000000128136990 libGSFont.dylib`GSFontGetExtraData + 112
    frame #3: 0x0000000135bc8958 UIFoundation`-[UIFont lineHeight] + 9
    frame #4: 0x00000001340149f3 UIKitCore`-[UILabel intrinsicContentSize] + 331
... 
```

要注册自定义字体并解决该问题，您可以查看此解决方案：[https ://stackoverflow.com/a/69756114/3701102](https://stackoverflow.com/a/69756114/3701102)

* * *

## 回答 #36

> 赞同：-1
> 
> 时间：2015-01-12T10:57:48.043

在我的情况下，它是由 tableview 删除操作引起的。此解决方案解决了我的错误访问异常：[https ://stackoverflow.com/a/4186786/538408](https://stackoverflow.com/a/4186786/538408)

# dll - 添加自定义DLL搜索路径@应用启动

> ID：327093
> 
> 赞同：12
> 
> 时间：2008-11-29T03:04:48.823
> 
> 标签：dll, path, setdlldirectory

我绞尽脑汁试图想出一个优雅的解决方案来解决 DLL 加载问题。我有一个静态链接到加载 DLL 的其他 lib 文件的应用程序。我没有直接加载 DLL。我想在可执行文件所在的文件夹之外的另一个文件夹中有一些 DLL。像 %working_folder%\dlls 之类的东西 - 我宁愿在我的 %working_folder% 中没有几十个（是的......几十个）DLL .

我正在尝试开发一些作为主应用程序一部分的东西，它将调整搜索路径@启动。我遇到的问题是这个新的自定义 DLL 路径不在系统搜索路径中。当我启动应用程序时，它会崩溃（STATUS_DLL_NOT_FOUND），因为必要的 DLL 不在适当的位置。我想做的是检查@startup这个新的自定义DLL文件夹是否在进程环境变量搜索路径中，如果没有添加它。问题是，应用程序会在应用程序执行一行代码之前尝试加载所有这些 DLL。

我该如何解决？我考虑过编写一个帮助应用程序，它首先启动，适当地调整环境变量并通过 CreateProcess 启动主应用程序。我敢肯定这会奏效，但它会让开发人员感到困难。当他们调试主应用程序时，他们不会首先启动辅助应用程序——他们甚至不能这样做。

我尝试了注册表应用程序路径功能，但没有成功。和以前一样的鸡和蛋问题。

我可以在这里做什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2014-03-28T12:01:27.593

我发现马修的回答对我有用。

在 Visual Studio 2012 中，转到您的项目属性，然后在 Configuration Properties->Linker->Input->Delay Loaded Dlls 中添加您希望在需要时才加载的每个 dll 文件。

虽然它不再需要在 main 之前运行，但这是我设置新搜索路径的代码

```
class RunBeforeMain
{
public:
    RunBeforeMain()
    {
        const TCHAR* dllPathEnvName= name of env variable to directory containing dlls
        const TCHAR* pathEnvName= TEXT("Path");

        TCHAR newSearchPath[4096];
        ::GetEnvironmentVariable(dllPathEnvName, newSearchPath, MAX_PATH);

             //append bin
        _tcscat_s(newSearchPath, MAX_PATH, TEXT("bin;"));
        size_t length = _tcslen(newSearchPath);

            //append existing Path
        ::GetEnvironmentVariable(pathEnvName, newSearchPath + length, 4096-length);
        ::SetEnvironmentVariable(pathEnvName, newSearchPath);

    }
};
static RunBeforeMain runBeforeMain; //constructor code will run before main. 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-01-05T02:22:51.077

我的建议是对 DLL 使用延迟加载链接，并尽早调用 SetDllDirectory()，以便在调用方法/函数时找到它们。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-29T03:33:45.973

[编辑 - 重新阅读问题后，我发现您遇到的问题是 DLL 在`main`开始之前被加载]

我猜这些库是用 C++ 编写的，并且正在从全局范围内某些对象的构造函数中加载 DLL。这是有问题的。请允许我引用[Yossi Kreinin](http://www.yosefk.com/blog/consistency-how-to-defeat-the-purpose-of-ieee-floating-point.html)的话：

> 在 main() 中做第一件事。如果你使用 C++，你应该在 main() 之前做第一件事，因为人们可以在全局变量的构造函数中使用 FP。这可以通过确定编译器特定的翻译单元初始化顺序、编译您自己的 C/C++ 启动库、使用 LD_PRELOAD 之类的东西覆盖已编译启动库的入口点、在静态链接程序中覆盖它来实现在二进制图像中，有一个编码约定强制在使用 FP 之前调用 FloatingPointSingleton::instance()，或者在 main() 之前拍摄喜欢做事的人。这是一个权衡。

[下面的原始答案]

有关用于加载 DLL 的搜索算法，请参[见此页面。](http://msdn.microsoft.com/en-us/library/ms682586(VS.85).aspx)您可以使用[`SetDllDirectory()`](http://msdn.microsoft.com/en-us/library/ms686203(VS.85).aspx)将目录添加到 DLL 搜索路径。

您还应该能够使用[`GetEnvironmentVariable()`](http://msdn.microsoft.com/en-us/library/ms683188(VS.85).aspx)和将目录添加到 PATH 环境变量[`SetEnvironmentVariable()`](http://msdn.microsoft.com/en-us/library/ms686206(VS.85).aspx)。

另一种选择是将当前工作目录更改为包含带有 .dll 的 DLL 的文件夹[`SetCurrentDirectory()`](http://msdn.microsoft.com/en-us/library/aa365530(VS.85).aspx)。如果您曾经使用相对文件名加载任何文件，请确保在加载 DLL 后将工作目录改回。

# c# - asp.net mvc RedirectToAction("Index") vs Index()

> ID：327095
> 
> 赞同：17
> 
> 时间：2008-11-29T03:07:50.423
> 
> 标签：c#, asp.net, asp.net-mvc

假设我有一个带有索引方法和更新方法的控制器。更新完成后，我想重定向到 Index()。我应该使用 return RedirectToAction("Index") 还是只调用 return Index()？有区别吗？

```
public ActionResult Index()
{
  return View("Index", viewdata);
}

public ActionResult Update()
{
  // do updates
  return RedirectToAction("Index"); or
  return Index();
} 
```

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2008-11-29T03:20:12.083

使用重定向，否则客户端上的 URL 将与发布的 URL 保持相同，而不是与 Index 操作对应的 URL。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-11-29T04:16:49.567

其他需要考虑的事项：

*   当用户单击刷新按钮时，POST 后的重定向操作会更好，因为不会提示他们将数据重新发送到服务器。

*   除非您通过 TempData 等显式维护表单数据，否则重定向操作将丢失表单数据。如果不这样做，您的表单控件在 POST 之后将没有任何价值，这在某些情况下可能是不可取的。

# php - PHP中的简单加密

> ID：327097
> 
> 赞同：9
> 
> 时间：2008-11-29T03:08:42.967
> 
> 标签：php, encryption

我正在构建一个带有源代码的系统，我将在“网络”上分发该系统以提供可收养的虚拟宠物。该系统将主要由孩子拥有。因为我希望它对绝对初学者程序员可用，所以我的系统有几个复杂性限制：它不能使用 PHP 通常不附带的库，它不能接触数据库或写入其他永久存储.

当每只宠物被收养时，访客将随机获得该宠物的一系列略有不同的变体中的一个。这些变化最初看起来相同，但随着时间的推移会成长为不同的宠物。访问者将获得一个 HTML 格式的短代码，该代码链接到他们的宠物图像。由于服务器端没有可用的永久存储，因此用户的图像链接必须包含所有信息，以确定他们最终获得了哪种宠物变体。

目前，URL 只包含宠物的 ID 和用户获得的变体 ID。这样做的问题是，通过相互比较代码，用户可以找出其中谁最终得到了相同的变化。由于某些变体比其他变体更罕见，因此用户可以在差异甚至视觉明显之前轻松发现罕见的变体。

我想要的是 URL 中详细信息的加密系统。隐藏变体 ID 的东西，以便每个用户很可能获得不同的 URL。我曾想过使用变体 ID（3 位或 4 位）作为大随机数的低位或高位，但用户会发现其中的模式。理想情况下，加密系统将被参数化，以便我的系统的每个安装都使用稍微不同的加密。

PHP 的 mcrypt 库中可能会有一些有用的东西，但它在托管商中似乎并不常见。

我可以在这里使用简单的参数化混淆/加密吗？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-11-29T05:16:16.873

您正在寻找“一次性填充”加密。它需要一个密钥并对字符进行模数加法以创建加密字符串。

```
function ecrypt($str){
  $key = "abc123 as long as you want bla bla bla";
  for($i=0; $i<strlen($str); $i++) {
     $char = substr($str, $i, 1);
     $keychar = substr($key, ($i % strlen($key))-1, 1);
     $char = chr(ord($char)+ord($keychar));
     $result.=$char;
  }
  return urlencode(base64_encode($result));
}

function decrypt($str){
  $str = base64_decode(urldecode($str));
  $result = '';
  $key = "must be same key as in encrypt";
  for($i=0; $i<strlen($str); $i++) {
    $char = substr($str, $i, 1);
    $keychar = substr($key, ($i % strlen($key))-1, 1);
    $char = chr(ord($char)-ord($keychar));
    $result.=$char;
  }
return $result;
} 
```

这就是简单的字符串加密。我要做的是序列化用户参数的数组并将其作为链接中的变量传递：

```
$arr = array(
  'pet_name'=>"fido",
  'favorite_food'=>"cat poop",
  'unique_id'=>3848908043
);
$param_string = encrypt(serialize($arr));

$link = "/load_pet.php?params=$param_string"; 
```

在 load_pet.php 你应该做相反的事情：

```
$param_string = $_GET["params"];
$params = unserialize(decrypt($param_string)); 
```

巴姆。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-11-29T03:13:25.017

如果您期望相对较低的复杂程度，那么您可以进行非常简单的“异或”加密并将密钥“存储”为 URL 的一部分。然后你可以只使用 php 的 rand() 或 /dev/random 或其他任何东西来生成密钥。

低复杂度的用户不会轻易发现他们需要做的就是将他们宠物 ID 的下半部分与上半部分进行异或，以获得可以与他们的朋友进行比较的值。我猜大多数能够识别出这就是正在发生的事情的人不会花时间去弄清楚，而且这些人无论如何都在你的目标受众之外。

编辑：如果不是很明显，我是说你给每只宠物一个不同的钥匙（因为给同一个钥匙不能解决你的问题）。因此，如果宠物变体（petvar）是一个 16 位数字，则生成一个 16 位随机数（rnd），然后执行以下操作：`petvar = (petvar^rnd)<<16 | rnd;`然后您可以反转该操作以提取 rnd，然后提取 petvar^rnd，然后只需再次对其进行异或即可获得原始的petvar。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-29T04:46:20.727

为什么不给每个用户一个长的、随机的 ID，然后将有关他们宠物的所有详细信息存储在服务器上呢？最佳实践是不在 URL 中存储任何内容，无论是否加密。您只需要一个会话 ID。

# ubuntu - 在 Linux 中删除受限文件夹中的文件

> ID：327100
> 
> 赞同：0
> 
> 时间：2008-11-29T03:10:14.803
> 
> 标签：ubuntu, apache2

我一直在尝试为我的 apache 服务器创建一个新目录。当我尝试访问新目录时，我输入：

须藤 /etc/init.d/apache2 重启

但我在 Ubuntu 终端中收到此错误：

/etc/apache2/conf.d/fqdn.save 第 1 行的语法错误：ServerName 采用一个参数，即服务器的主机名和端口。

在我调查时，fqdn.save 文件无法访问，被认为是未知的。我想删除此文件，但我无法删除，因为我认为我需要 root 访问权限。

有谁知道如何在 Ubuntu 中删除这个不需要的文件？或者有谁知道当我在终端上键入“sudo /etc/init.d/apache restart”时如何将 apache2 重新启动重定向到 /etc/apache2/conf.d/fqdn（而不是 fqdn.save）

谢谢，麻烦您了

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-29T03:44:29.133

你有 sudo; 我将假设这是标准的 Ubuntu “毯子” sudo，它可以让你做任何事情。

通过执行以下操作检查文件中的内容：

```
sudo cat /etc/apache2/conf.d/fqdn.save 
```

备份文件，以防万一：

```
sudo cp /etc/apache2/conf.d/fqdn.save /tmp 
```

删除文件：

```
sudo rm /etc/apache/conf.d/fqdn.save 
```

然后到那时你应该能够启动服务器......

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-29T03:31:16.023

您需要在有权写入该文件的组内，并且可能是 apache 和 root（用户和组），我不太确定 ubuntu 中 apache 的组名，但如果您是普通用户，我害怕您不能只删除该文件，请询问系统管理员或对该文件具有权限的人。

另一方面，如果 init 脚本“apache2”有指向它的链接，则删除该文件将不起作用，相反，您可能会收到一个不同的错误，指出找不到该文件。

所以你的问题似乎是你有 apache 的初始化脚本试图访问错误的文件名，我相信解决方案是编辑 apache 的初始化脚本并将其指向正确的文件名，这将是 fqdn 而不是 fqdn。节省

# python - @Rails 用户：你试过 web2py 吗？优点？缺点？

> ID：327101
> 
> 赞同：13
> 
> 时间：2008-11-29T03:11:54.957
> 
> 标签：python, ruby-on-rails, web2py

web2py to 是一个 Python 框架，但共享 Ruby on Rails 的“约定优于配置”设计。从好的方面来说，它在其标准发行版中包含了更多功能，我们声称它更快、更易于使用。

有任何 Rails 用户尝试过吗？你的印象是什么？

请不要吐槽。只是技术评论。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-11-29T16:40:54.870

来吧，伙计们……您唯一的论点是“技术差异无关紧要”。和“你使用什么网络框架无关紧要”？我不同意。用户群的规模更多地与营销和框架存在多长时间有关。通过这个论点，ASP 和 PHP 比 Rails 更好。

这里有人用过 Rails 和 web2py 吗？

web2py 在 webfaction 和任何支持 mod_proxy 或 mod_wsgi 或 mod_fcgi 的托管服务提供商上运行，并在 Google App Engine 上运行（rails 不支持）。还有一个专门的 web2py 托管服务提供商 (star-nix.com)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-08-09T08:15:16.033

我发现 web2py 更容易学习......运行和抽象的脚本更少。另一方面，web2py 的数据库层并不是真正的 ORM……它几乎就像编写原始 SQL。简单的事情最终会占用很多行代码，就像 SQL 一样。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-29T13:25:42.893

我想说在 Rails 上使用 webpy 的最大“缺点”是周围没有很多特定于 Rails 的托管服务，以及基于它的庞大社区（有 Rails 插件和工具用于..一切）。web2py 不能这样说。

这取决于你想用它做什么 - 如果它是用来编写你的个人网站的东西，并且你已经有一个服务器来托管它，那么使用你喜欢的任何东西。如果它是分发给其他人运行的东西，Rails 有更多的托管选项和更大的社区，所以它可能是一个更好的选择。

技术差异是相当无关紧要的。每个框架基本上都可以做同样的事情（生成网页）。重要的是社区、易用性、有用的功能集、托管它的能力等等——这些都是非常主观的。

我仍然经常使用 PHP，不是因为“它更好”，而是因为我可以将它托管在绝大多数网络主机上。我也使用 Rails，因为它有一个良好且非常活跃的社区。框架的实际技术细节从来都不是考虑因素，真的..

我可能会列出为什么 web2py 比 Rails“更好”/“更差”的列表 - Rails 在生成包含循环的模板时可能会慢 0.04 秒/请求，或者 web2py 可能有一个好的 DB 模型生成器，或者其他一些技术原因- 但这些可能与你根本无关

# objective-c - 事件范围

> ID：327105
> 
> 赞同：0
> 
> 时间：2008-11-29T03:16:56.973
> 
> 标签：objective-c, cocoa

给定

```
@interface Canvas:NSView {        
    NSNumber * currentToolType; 
    ...
} 
```

在我的 .h 文件和 .m 文件中声明

```
- (id)initWithFrame:(NSRect)frame {
    self = [super initWithFrame:frame];
    if (self) {
        currentToolType=[[NSNumber alloc]initWithInt:1];
    }
    return self;
} 
```

再往下

```
-(void)mouseUp:(NSEvent *)event
{
   NSLog(@"tool value in event: %d",[currentToolType intValue]);
   //rest of code
}

-(NSBezzierPath *)drawPath:(NSRect)aRect
{
   NSLog(@"tool value in draw: %d",[currentToolType intValue]); 
```

**//drawPath 方法代码的其余部分，在 switch 语句中使用 currentToolType 的值**

```
}

-(IBAction)selectToolOne:(id)sender
{
   [currentToolType release];
   [currentToolType = [[NSNumber alloc]initWithInt:0];
}

-(IBAction)selectToolTwo:(id)sender
{
   [currentToolType release];
   [currentToolType = [[NSNumber alloc]initWithInt:1];
} 
```

动作方法是唯一`currentToolType`改变的地方。但是，由于某种原因，它似乎`currentToolType`是`mouseUp`. 我没有为 var 编写（或合成）访问器，因为它仅由它自己使用。我注意到它`initWithFrame`被调用了两次 - 我假设它是用于父窗口和 NSView？

我错过了什么？
谢谢！
这是一个使用 COCOA 和 Obj-C 生成的基于 XCode 文档的应用程序。我都是新手。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-29T04:30:45.220

您提到 initWithFrame: 被调用了两次。你的 initWithFrame: 应该只被调用一次（除非你碰巧有两个 Canvas 视图）。

您是否有可能在 nib/xib 文件中有 Canvas 视图，并且还在代码中创建另一个视图（使用 alloc/initWithFrame :)？

在这种情况下，您有两个 Canvas 对象。您可能有一个连接到您的控件，而另一个在窗口中（因此响应 mouseUp: 并且它每次都给您相同的值）。

如果您在 IB 中设置了 Canvas 视图，则可以通过删除创建第二个的代码来解决此问题。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-29T03:22:16.557

您可能遇到过一种特殊情况： NSNumber 可能有缓存实例来表示常用数字。

不过有两个观察结果：

*   当您可以简单地使用 NSIntegers 或者可能是老式的枚举类型时，使用 NSNumber 会浪费大量内存，从而完全避免了对象开销。
*   当您查看 NSNumber 的实例时，您从未真正展示过您的代码；没有它，这里没有足够的信息来回答你的问题。

# database - 通过 http 和 json 同步 2 个 sqlite 表的最佳方法是什么？

> ID：327111
> 
> 赞同：13
> 
> 时间：2008-11-29T03:23:25.947
> 
> 标签：database, json, sqlite, synchronization

我有一个相当简单的同步问题。我有一个包含大约 10 列的表，我想在 3 个不同客户端上的 sqlite 文件之间保持同步：一个 Iphone 客户端、一个浏览器客户端和一个 Ruby on Rails 客户端。所以我需要一个简单的 sycing 解决方案，它适用于所有 3，即我可以轻松地在 Javascript、Objective C 和 Ruby 中实现它，并且它可以通过 HTTP 与 JSON 一起使用。我查看了其他同步解决方案的各种组件，例如 git 中的那个，一些来自 Google gears 社区的教程，以及一个名为acts_as_replica 的rails 插件。我天真的方法是简单地在数据库中创建一个最后同步的时间戳，然后创建一个所有删除的变更日志。（我不允许更新表中的条目）。然后我可以检索自上次时间戳以来的所有新条目，

我应该考虑使用每个条目的 SHA1 哈希或 UUID 还是最后同步的时间戳就足够了？如何确保没有重复条目？有没有我可以遵循的更简单的算法？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-02T06:59:12.670

我假设变化可能会在最后。我不知道插入和更新的特征，但这是我的想法；

*   我会 SHA1（或 MD5，在这种情况下无关紧要）当月和前几个月的日子。与这些指纹进行比较是一种快速查看差异的方法。（我今天离开时没有散列）
*   如果前几个月有差异；
    *   如果一个月的交易量太大，我们可以拆分该月并简单地动态生成每日指纹，而不是比较整个月。
    *   否则，我们可以像对待每日变化一样对待每月变化。
*   在找出更改发生的位置后，主副本将发送该期间所有唯一 ID 的列表。（总是发送今天的信息）
*   然后从机删除必须删除的内容并编译要插入的 id 列表。
*   主机只发送那些记录（完整）。

可根据数据量调整时间类别（日、月）。

当然，这是一个幼稚而简单的算法。如果我正在处理敏感/关键数据，我会寻找[事务](http://en.wikipedia.org/wiki/Database_transaction)算法。

# arrays - MC++ 互操作数组访问

> ID：327115
> 
> 赞同：0
> 
> 时间：2008-11-29T03:26:35.567
> 
> 标签：arrays, interop, managed-c++

使用托管 C++ (VS 2005)，您如何将数组< unsigned char > 作为 unsigned char* 传递给函数？

```
 ref class Utils
 {
     public: 

     static void A(array<unsigned char, 1> a)
     {
       //How do I call B()????
     }

     static void B(const unsigned char* a)
     {
        //do stuff
     }

 }; 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-29T03:41:28.750

你这样做吗？

```
 void A(array<unsigned char, 1> a)
 {
     pin_ptr<unsigned char> pData= &a[0];
     B(pData);
 } 
```

# visual-studio - 如何在 Microsoft Visual C# 2008 Express Edition 中启用 Emacs 键绑定？

> ID：327116
> 
> 赞同：3
> 
> 时间：2008-11-29T03:29:54.997
> 
> 标签：visual-studio, emacs

如何在 Microsoft Visual C# 2008 Express Edition 中启用 Emacs 键绑定？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-29T18:43:11.223

您可以尝试使用[XKeymacs ，它可以在](http://www.cam.hi-ho.ne.jp/oishi/indexen.html)*所有*Windows 应用程序中启用类似 Emacs 的键绑定。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-29T03:39:06.650

似乎 Emacs 键绑定文件 ( **Emacs.vsk** ) 不包含在 Visual Studio Express Editions 中，但是您可能能够找到并使用它:-)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-01T17:11:25.080

此外，安装 Visual C++ 速成版。它包括 emacs 键绑定。

# ruby-on-rails - 在不使用htaccess的情况下将'myapp.com'重定向到rails中的'www.myapp.com'？

> ID：327122
> 
> 赞同：27
> 
> 时间：2008-11-29T03:39:48.130
> 
> 标签：ruby-on-rails, redirect, subdomain

使用 Morph Labs 的 Appspace 部署站点意味着无法自动将“myapp.com”重定向到“www.myapp.com”（也无法访问 .htacess）。

有没有一种轨道方式来做到这一点？我需要像[subdomain-fu](http://github.com/mbleigh/subdomain-fu/tree/master)这样的插件吗？

更具体地说，我正在尝试做类似的事情：

*   'myapp.com' => 'www.myapp.com'
*   'myapp.com/session/new' => 'www.myapp.com/session/new'

基本上，我总是希望在每个请求上都添加“www”子域（因为 SSL 证书特别有一个通用名称“www.myapp.com”）。

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2008-11-29T04:14:05.720

也许这样的事情可以解决问题：

```
class ApplicationController < ActionController::Base
  before_filter :check_uri

  def check_uri
    redirect_to request.protocol + "www." + request.host_with_port + request.request_uri if !/^www/.match(request.host)
  end
end 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-11-13T14:55:44.970

卡森的回答效果很好。

这是另一种方式的代码（www -> no www）

```
before_filter :check_uri

def check_uri
  if /^www/.match(request.host)
    redirect_to request.protocol + request.host_with_port[4..-1] + request.request_uri 
  end
end 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2012-03-01T19:04:18.890

我必须更改 Carson 的答案才能让它在 Rails 3 中工作。我用 request.fullpath 替换了 request.uri：

```
class ApplicationController < ActionController::Base
  protect_from_forgery

  Rails.env.production? do
    before_filter :check_url
  end

  def check_url
    redirect_to request.protocol + "www." + request.host_with_port + request.fullpath if !/^www/.match(request.host)
  end
end 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2010-06-28T00:16:31.123

这对我很有用。我确实做了一个小的补充，因为我只希望在我的生产环境中出现这种行为：

```
def check_uri
  redirect_to request.protocol + "www." + request.host_with_port + request.request_uri if !/^www/.match(request.host) if Rails.env == 'production'
end 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-07-25T20:18:06.810

我知道这已经得到解答，但我认为其他人都应该知道 CodeRack：Canonical Host 解决方案。这非常好，因为它允许特定于 env 的重定向。[http://coderack.org/users/tylerhunt/middlewares/6-canonical-host](http://coderack.org/users/tylerhunt/middlewares/6-canonical-host)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-29T03:45:44.530

这里有几种不同的方法：

```
 head :moved_permanently, :location => ‘http://www.newdomain.com’ 
```

其他：

```
def rails_301
headers["Status"] = "301 Moved Permanently"
redirect_to "http://www.newdomain.com"
end 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2013-10-16T05:37:55.673

对于那些希望也使用 heroku 强制 SSL 的人来说，这对我来说效果很好，基于[根域上的 Heroku SSL](https://stackoverflow.com/questions/6701549/heroku-ssl-on-root-domain)

在我的 DNS 设置中，我设置了一个 URL / 转发记录（DNS 简单）

```
URL foo.com     3600        http://www.foo.com 
```

CNAME 设置只需要为 WWW 设置

```
CNAME   www.foo.com 3600        providedssslendpoint.herokussl.com 
```

我还必须为我的根设置和别名

```
ALIAS   foo.com 3600        providedsslendpoint.herokussl.com 
```

然后我决定简单地将**foo.com**替换为 env 变量`ENV['SITE_HOST']`（其中 SITE_HOST 可能等于 www.foo.com 或 test.foo.com），这样我就可以通过我的 heroku 配置进行控制。这样，我可以控制在不同环境中发生的事情。（有关在本地设置环境变量，请参阅[https://github.com/bkeepers/dotenv](https://github.com/bkeepers/dotenv)）

例如，我的测试应用程序使用**test.foo.com**作为 url，它也有自己的 SSL 端点，所以对我来说很好用。

```
 before_filter :check_domain

  def check_domain
    if Rails.env.production? || Rails.env.testing? and request.host.downcase != ENV['SITE_HOST']
      redirect_to request.protocol + ENV['SITE_HOST'] + request.fullpath, :status => 301
    end
  end 
```

从现在开始，最终用户将始终使用强制 SSL 访问 www。旧链接会出现小问题，但没有什么明显的。

# keyboard - 最适合程序员的*最佳*无线键盘/鼠标套装是什么？

> ID：327129
> 
> 赞同：13
> 
> 时间：2008-11-29T03:47:11.530
> 
> 标签：keyboard, mouse, desktop, wireless

我考虑了以下几点：

[罗技桌面 MX 5500](http://www.logitech.com/index.cfm/keyboards/keyboard_mice_combos/devices/3481&cl=us,en)

[微软无线娱乐桌面 8000](http://www.microsoft.com/hardware/mouseandkeyboard/productdetails.aspx?pid=080)

但我想看看其他程序员会推荐什么。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-29T03:50:40.870

我知道您正在寻找一组，但可能会感兴趣这两个主题：

*   [https://stackoverflow.com/questions/687/keyboard-for-programmers](https://stackoverflow.com/questions/687/keyboard-for-programmers)
*   [https://stackoverflow.com/questions/53132/mouse-for-programmer](https://stackoverflow.com/questions/53132/mouse-for-programmer)

就个人而言，我更喜欢单独购买我的东西，这样我才能找到两者中最好的。例如，我目前正在使用 Apple 键盘和 Logitech MX Revolution 鼠标，两者都给我留下了深刻的印象。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-29T05:30:43.147

作为平均 60 wpm 的打字员，我可以向您保证，从长远来看，无线键盘只会让您感到沮丧。它已经到了我实际上换回有线键盘的地步，因为我还没有找到可以跟上我的无线键盘。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-29T04:50:26.490

我用过几个，迄今为止最耐用的防弹是我的戴尔蓝牙对。它与工业级连接单元的物理设置相同。蓝牙发射器也与其他设备兼容。良好的电池寿命，两个 AA 用于鼠标和 3 个 AAA 用于键盘 - 一组 NiMH 至少需要 6 周。

我把它们放在我的背包里，带上一个额外的蓝牙发射器，它们总是在客户的电脑上工作。

[![](https://i.stack.imgur.com/SdPNY.jpg)](https://i.stack.imgur.com/SdPNY.jpg)
[（来源：[dell.com](http://snpi.dell.com/sna/images/products/large/310-7990.jpg)）]

所有的罗技、微软，可能还有六个其他的非品牌都没有比较过。

我使用[KeyTweak](http://webpages.charter.net/krumsick/)进行 Ctl/CapsLock 交换 - 实际上我不交换它们 - 我没有使用 Caps Lock 键。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-11-29T05:04:51.810

也许是因为我一直很喜欢[快乐的黑客键盘](http://en.wikipedia.org/wiki/Happy_Hacking_Keyboard)，但我真的很喜欢非常紧凑[的 Apple 蓝牙键盘](http://www.apple.com/keyboard/)（可以在 windows 下使用）。但我真的很喜欢它的时尚设计和标准（ish）布局。与我的笔记本电脑相匹配的布局，以便我可以继续触摸类型的反斜杠。对于鼠标，我承认我不那么挑剔，并使用[强大的鼠标](http://www.apple.com/mightymouse/)或罗技 V270 蓝牙旅行鼠标。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-11-29T03:54:46.790

我会避免使用罗技 MX5000/MX5500。如果你能得到不是蓝牙的东西，那将是最好的。罗技使用的蓝牙堆栈有问题。按键喜欢“卡住”，这意味着即使您松开按键，它们也会像被按下一样。如果卡住的键是退格键或删除键，那尤其糟糕。我从来没有遇到过他们的非蓝牙产品的问题。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-11-29T04:20:44.910

因此，这不是建议，而是一些指导：许多（但不是全部）无线键盘和鼠标在空闲后激活它们时会“吞下”第一次击键或瞬间移动。就好像他们去睡觉什么的。

我在 Logitech 和 Microsoft 无线套件以及第三个（相对未知的）品牌中都看到了这一点。

您的使用风格可能不会受到影响——但是每当我使用同事的 PC 时，错过的鼠标点击和击键都会让我发疯。停下来想一想，决定下一步该做什么，然后当机器没有响应时，我就失去了思路。啊！

我的建议：无论您选择哪种套件，请确保您有机会亲自尝试一下，然后再投入您辛苦赚来的现金

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-29T05:55:12.427

我不认为这里有“最好的”。我认为您必须选择适合您、性能良好且在您的价格范围内的组件。

# compact-framework - 重写嵌入式 Visual Basic 应用程序

> ID：327138
> 
> 赞同：1
> 
> 时间：2008-11-29T03:56:01.107
> 
> 标签：compact-framework, pocketpc, evb

我正在考虑重写我多年前编写的 eMbedded Visual Basic 应用程序。我对它不满意，因为多年来客户时不时地遇到各种问题，主要是由于缺少所需的 dll/activex 控件而导致应用程序不再加载！当客户端在远处使用它时，这非常令人沮丧并且自然难以调试。在很多情况下，重新安装应用程序并不能解决问题。

我的偏好是用 C# 重写它，因为我对 C# 和 DotNet 很满意，但我也对其他平台开放，如黑莓或 iTouch/iPhone，只要该平台可以支持地图和 GPS。我现在开始用 C# 重写它，但我不能确定我在 .net 中不会遇到同样的问题。

有没有其他人在迁移到 CF DotNet 时已经消失/持续存在的 eVB 应用程序有类似的问题？或者你会再次建议一个不同的平台吗？

编辑：请注意，无论如何我都希望离开 eVB，但如果我转移到 CF DotNet，我想确保我不会遇到同样的缺失 dll/控制问题。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-29T04:24:25.823

我强烈推荐 .NET CF，特别是如果您已经了解 C# 和 .NET。Mono 已移植到 iPhone，因此可以编写在 Windows Mobile 和 iPhone 上运行的应用程序。黑莓没有 Mono（如果有的话），所以这是一个明确的限制。我个人无法忍受黑莓（我同时拥有黑莓和 WM 智能手机，黑莓让我想上吊），但它们确实拥有庞大的用户群。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-29T14:45:35.023

您应该在几年前从 eVB 迁移出来，但那是桥下的水。如果您想继续以 Windows CE/Windows Mobile 为目标，我建议您使用 CF - 语言无关紧要，使用您喜欢的语言。

没有办法保证无论您的“丢失 DLL”问题不会再次发生，因为我们不知道丢失了什么 DLL。如果它是第 3 方控制，那么您将受制于市场。如果提供者幸存下来，他们的控制权很可能会继续存在。

如果您想以 iPhone/Blackberry 为目标，那么 Java 更有可能是您选择的语言——我不太熟悉的工具。Eclipse for Blackberry - iPhone 可能有自己的工具。

至于 Silverlight，您可能会看到它，但到目前为止，它作为一个可行的平台太慢了，至少在我见过的任何 WinMo 设备上是这样。我们已经为各种垂直领域删除了许多很多 CF 应用程序，并且从未遇到任何可用性问题（尽管我们已经这样做了很长时间，并且知道每个限制以及我们应该和不应该尝试的内容）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-29T05:28:40.093

我建议您更进一步，看看 Silverlight。其中一个前提是它是一种更长期稳定、便携、轻量级的下载和安装，而且它还没有变得糟糕。

我认为它有可能成为下一个嵌入式 VB。CF 的困难之一是我发现它是真实事物的一个不足的子集。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-11-23T20:59:28.270

另一种选择是 NS Basic/CE。它与 eVB 高度兼容，因此您将能够保留大部分（如果不是全部）代码。该产品一直在不断更新，因此它可以在当前设备上运行。

NS Basic/CE 创建的安装程序包含您的程序所需的所有 dll 文件，因此它们将包含在安装中。

# python - 一个 Apache 上的多个 Django 管理站点...当我登录一个时，我会退出另一个

> ID：327142
> 
> 赞同：3
> 
> 时间：2008-11-29T04:01:45.153
> 
> 标签：python, django, admin

我有两个 Django 项目和应用程序在同一个 Apache 安装上运行。两个项目和两个应用程序都具有相同的名称，例如 myproject.myapplication。它们分别位于单独命名的目录中，因此看起来像 .../dir1/myproject/myapplication 和 .../dir2/myproject/myapplication。

关于实际面向公众的应用程序的一切工作正常。当我登录到任何一个管理站点时，它似乎都可以，但是如果我切换并在对面的管理站点上执行任何工作，我就会退出第一个管理站点。简而言之，我无法同时登录两个管理站点。任何帮助，将不胜感激。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-11-29T07:27:35.360

设置[SESSION_COOKIE_DOMAIN](http://docs.djangoproject.com/en/dev/topics/http/sessions/#session-cookie-domain)选项。您需要为每个站点设置域，这样 cookie 就不会相互覆盖。

您还可以使用 SESSION_COOKIE_NAME 使每个站点的 cookie 名称不同。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-17T14:23:25.433

我在同一个 Apache 服务器（在 CentOS 上）上托管的实时和临时站点遇到了类似的问题。我为每个站点的设置添加了唯一的 SESSION_COOKIE_NAME 值（在 local_settings.py 中，如果没有，则创建一个并将其导入 settings.py 中），为实时站点设置 SESSION_COOKIE_DOMAIN 并将 SESSION_COOKIE_DOMAIN = None 设置为暂存。我还运行“python manage.py cleanup”来（希望）清除数据库中的任何冲突信息。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-29T05:56:53.547

好吧，如果它们具有相同的项目和应用程序名称，那么数据库和表将是相同的。保存会话信息的 django_session 表对于两个站点是相同的。您必须使用不同的项目名称，这些名称将放在不同的 MySQL（或其他）数据库中。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-29T07:06:58.383

会话信息存储在数据库中，因此如果您与两个正在运行的实例共享数据库，注销一个位置将使您同时注销两个实例。如果您的情况需要您共享数据库，最简单的解决方法可能是创建具有管理员权限的第二个用户帐户。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-29T10:08:50.667

让我猜猜，这是否在您的本地主机上运行？并且您将每个站点分配到不同的端口？即本地主机：8000，本地主机：8001 ..？

我有同样的问题！（虽然我本身并没有运行 Apache）

当您登录到管理站点时，您会在浏览器中获得一个与域“localhost”关联的 cookie，该 cookie 存储了某种指向存储在服务器数据库中的会话的指针。

当您访问其他站点时，服务器会尝试解释 cookie，但失败了。我猜它会删除cookie，因为它是“垃圾”。

在这种情况下，您可以做的是更改您的域

第一个站点使用 localhost:8000，第二个站点使用 127.0.0.1:8001。这样第二个站点就不会尝试读取第一个站点设置的 cookie

我还认为您可以根据需要编辑您的 HOSTS 文件以向 127.0.0.1 添加更多别名。（但我没试过这个）

# c# - 如果 DataSource 不包含任何项目，如何在 ASP.NET C# 中隐藏转发器？

> ID：327151
> 
> 赞同：7
> 
> 时间：2008-11-29T04:11:36.130
> 
> 标签：c#, asp.net, repeater

我有一个 ASP.NET 页面，它使用嵌套在另一个转发器中的转发器来生成数据列表。其效果如下：

```
<asp:Repeater>
    <ItemTemplate>
        <span><%#Eval("Data1") %></span>
        <!-- and many more -->
        <asp:Repeater DataSource='<%#Eval("Data2")%>'>
            <HeaderTemplate>
                <ul>
            </HeaderTemplate>
            <ItemTemplate>
                <li><%#Container.DataItem%></li>
            </ItemTemplate>
            <FooterTemplate>
                </ul>
            </FooterTemplate>
        </asp:Repeater>
    </ItemTemplate>
</asp:Repeater> 
```

在 (C#) 代码隐藏中，我基本上使用 LINQ 从 XML 文档中提取信息列表并将该信息绑定到第一个转发器。

寻找这个答案，似乎方法是确定嵌套中继器的数据是否为空。如果是，则将转发器的可见性设置为 false。

不幸的是，我无法确定如何内联，而不是在代码隐藏中（因为它不一定适用于我正在做的事情）。

由于我的页面现在没有验证，因为没有 Data2 的任何项目 ul 最终都是空的，并且因为我想继续使用无序列表，所以我寻求你的帮助。

有任何想法吗？

谢谢！

更新：

如果它有帮助，因为它很可能在代码隐藏中执行，LINQ 就是这样的效果：

```
var x = from y in z
    select new {
        Data1 = d,
        // etcetera
        Data2 = (from j in k
            where j.Value != String.Empty
            select j.Value).ToList()
    };

blah.DataSource = x;
blah.DataBind(); 
```

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-12-01T02:50:56.557

这不会完全**隐藏**转发器，但您可以子类化转发器控件，以便它包含一个类似于 GridView 的空数据模板：

```
using System;
using System.Web.UI;
using System.Web.UI.WebControls;

public class EmptyCapableRepeater : Repeater
{
    public ITemplate EmptyDataTemplate { get; set; }

    protected override void OnDataBinding ( EventArgs e )
    {
        base.OnDataBinding( e );

        if ( this.Items.Count == 0 )
        {
            EmptyDataTemplate.InstantiateIn( this );
        }
    }
} 
```

您可以像这样在您的 .aspx 中使用它：

```
<custom:EmptyCapableRepeater runat="server" ID="rptSearchResults">
    <ItemTemplate>
        <%# Eval( "Result" )%>
    </ItemTemplate>
    <SeparatorTemplate>
        <br />
    </SeparatorTemplate>
    <EmptyDataTemplate>
        <em>No results were found.</em>
    </EmptyDataTemplate>
</custom:EmptyCapableRepeater> 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-29T08:53:30.633

尝试类似：

```
<asp:Repeater runat="server" DataSource='<%#Eval("Data2")%>' 
    Visible='<%# ((IEnumerable)Eval("Data2")).GetEnumerator().MoveNext() %>'> 
```

对于嵌套中继器

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-11-04T14:40:38.750

为什么不使用 ListView？它提供了许多相同的功能，包括 EmptyDataTemplate。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2013-05-13T14:03:31.017

用这个：

```
protected void Repeater1_PreRender(object sender, EventArgs e)
{
    if (Repeater1.Items.Count < 1)
    {
        container.Visible = false;
    }
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-29T04:13:05.380

当您执行 LINQ 查询时，检查它的 Count 属性（提供它的某种列表）。如果它为 0，那么只需将 Visible 属性设置为 false。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-29T04:40:16.667

据我所知，您必须通过代码隐藏执行此操作，只需使用 ItemDataBound 事件来处理它，您几乎可以保留所有内容，只需输入一些获取数据集的逻辑并确定它是否有条目，如果没有隐藏中继器。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-30T06:20:48.023

我不认为您正在做的事情会起作用当我尝试按照您尝试的方式设置 DataSource 时出现错误；但是，在你背后的代码中这样做：

假设您向父中继器的 ItemDataBoundEvent 添加了一个侦听器，那么您将需要稍微更改 linq 查询以不使用匿名类型（创建具有您的属性的受保护类） 在 mjy 情况下，我使用 dto 作为类名。

```
void rep1_ItemDataBound(object sender, RepeaterItemEventArgs e)
{

    Repeater rep2 = (Repeater)e.Item.FindControl("rep2");
    rep2.DataSource = ((dto)e.Item.DataItem).y;
    rep2.DataBind();
} 
```

我很想知道为什么你认为你不能在后面的代码中解决这个问题。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2010-01-08T18:26:02.457

我知道这是一个旧线程，上面的答案是一个非常好的解决方案，但是我遇到了类似的问题，并且找到了另一个不同的简单解决方案，我想我也会分享。这可以很好地验证并显示相同。

只需将您的页脚模板更改为：

```
<FooterTemplate> 
            <li style="display:none;">This will not show.</li></ul> 
</FooterTemplate> 
```

或者，如果您使用表格：

```
<FooterTemplate> 
            <tr> style="display:none;"><td>But something must be in here.</td></tr></table> 
</FooterTemplate> 
```

希望对某人有所帮助！

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2010-05-20T16:01:24.193

在这种`OnItemDataBound`情况下，如果是 a，则将可见性设置为 false，如果`ItemType`是 a ，则将可见性设置为`Header`true 。`ItemType``Item`

# web-services - 在.net中加密肥皂

> ID：327162
> 
> 赞同：2
> 
> 时间：2008-11-29T04:23:06.357
> 
> 标签：web-services

我一直在尝试加密soap消息并发送到服务器，以便服务器可以解密，处理消息，再次加密响应并发送回客户端......

我简短地说我想在 ASMX Web 服务中实现安全性......

请帮我

谢谢桑迪普

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-29T04:29:18.013

使用 HTTPS 有什么问题？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-29T04:30:38.103

https 和soap 扩展是很好的解决方案；您始终可以通过直接加密输入和输出来“自己动手”

```
[WebMethod]
public string SecureMethodX(string secureInput)
{
    string plainText = decrypt(secureInput);
    //do something...
    string encryptedResult = encrypt(someResult);
    return encryptedResult;
} 
```

如果您有多种方法，这会变得很痛苦，但是如果您有特定的一次性需求（例如在客户端和服务器之间传递硬件指纹和/或许可证密钥），那么这个解决方案可能是最简单的实现

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-29T04:37:39.183

看看 SOAP 扩展。它们允许您在客户端和服务器上使用 SOAP 流。它们很好，因为您可以不理会您的服务代码 - 操作发生在 web 方法开始之前和结束之后。它们的工作方式很像 HttpModule，但也可以包含在客户端/请求端。

*   [http://msdn.microsoft.com/en-us/library/system.web.services.protocols.soapextension.aspx](http://msdn.microsoft.com/en-us/library/system.web.services.protocols.soapextension.aspx)
*   [http://msdn.microsoft.com/en-us/magazine/cc164007.aspx](http://msdn.microsoft.com/en-us/magazine/cc164007.aspx)
*   [http://www.theserverside.net/tt/articles/showarticle.tss?id=SOAPExtensions](http://www.theserverside.net/tt/articles/showarticle.tss?id=SOAPExtensions)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-29T05:14:59.717

HTTPS 是一种用于加密 Web 服务的标准。我用它来加密网络服务。

# sql - 在“最终”一致性和无事务（又名 SimpleDB）的情况下，你真的能走多远？

> ID：327169
> 
> 赞同：6
> 
> 时间：2008-11-29T04:36:13.523
> 
> 标签：sql, database, amazon-web-services, amazon-simpledb

我真的很想使用 SimpleDB，但我担心如果没有真正的锁定和事务，整个系统会存在致命缺陷。我知道对于高读/低写应用程序来说这是有道理的，因为最终系统会变得一致，但是介于两者之间的时间呢？似乎在不一致的数据库中正确的查询会以一种很难追踪的方式在整个数据库中造成破坏。希望我只是一个担心疣...

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-29T08:22:04.003

这是一致性和可扩展性以及 - 在某种程度上 - 可用性之间的非常经典的战斗。有些数据并不总是需要如此一致。例如，查看 digg.com 和一个故事的挖掘次数。很有可能值在“digg”记录中重复，而不是强制数据库对“user_digg”表进行连接。如果这个数字不完全准确，这有关系吗？可能不是。然后使用像 SimpleDB 这样的东西可能是一个不错的选择。然而，如果你正在编写一个银行系统，你可能应该把一致性放在首位。:)

除非您从第一天开始就知道您必须处理大规模，否则我会坚持使用简单的更传统的系统，例如 RDBMS。如果您在具有合理商业模式的地方工作，那么如果流量激增，您有望看到收入大幅增长。然后你可以用这笔钱来帮助解决扩展问题。扩展很难，扩展也很难预测。大多数伤害您的扩展问题将是您从未预料到的。

我宁愿建立一个站点，并在流量增加时花几周时间解决规模问题，然后花很多时间担心规模问题，以至于我们因为资金用完而永远无法投入生产。:)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-29T13:39:08.137

假设您正在谈论[这个 SimpleDB](http://www.cs.bc.edu/~sciore/simpledb/intro.html)，那么您不必担心；有真正的理由不将其用作现实世界的 DBMS。

从 DBMS 中的事务支持获得的属性可以用首字母缩写词“ACID”来缩写：原子性、一致性、隔离性和持久性。A和D主要与系统崩溃有关，而C和我则与常规操作有关。它们都是人们在使用商业数据库时完全认为理所当然的事情，所以如果你使用的数据库没有一个或多个，你可能会遇到许多令人讨厌的惊喜。

**原子性**：任何事务要么完全完成，要么根本不完成（即，它要么完全提交要么中止）。这适用于单个语句（如“UPDATE table ...”）以及更长、更复杂的事务。如果您没有这个，那么任何出现问题（例如，磁盘已满，计算机崩溃等）都可能会导致半途而废。换句话说，您永远不能依赖 DBMS 来真正完成您告诉它的事情，因为任何数量的现实世界问题都可能成为阻碍，甚至一个简单的 UPDATE 语句也可能会部分完成。

**一致性**：您为数据库设置的任何规则都将始终得到执行。就像，如果你有一条规则说 A 总是等于 B，那么任何人对数据库系统所做的任何事情都不能破坏该规则——任何尝试的操作都会失败。如果您的所有代码都是完美的，这并不那么重要……但实际上，什么时候会出现这种情况？另外，如果你错过了这个安全网，那么当你失去时事情会变得非常糟糕......

**隔离**：对数据库执行的任何操作都将像串行发生（一次一个）一样执行，即使实际上它们是同时发生的（彼此交错）。如果不止一个用户同时访问这个数据库，而你没有这个，那么你做梦也想不到的事情就会出错；即使是原子语句也可以以不可预见的方式相互交互并搞砸事情。

**持久**性：如果断电或软件崩溃，正在进行的数据库事务会发生什么？如果你有耐用性，答案是“没什么——它们都是安全的”。数据库通过使用称为“撤消/重做日志记录”的东西来做到这一点，在这种情况下，您对数据库所做的每一件小事都会首先记录（通常在单独的磁盘上以确保安全），以便您可以在发生故障后重建当前状态。没有它，上面的其他属性就毫无用处，因为你永远无法 100% 确定崩溃后事情会保持一致。

这些事情对你来说重要吗？答案与您正在执行的事务类型以及在失败情况下您想要的保证有关。很可能有一些情况（比如只读数据库）你不需要这些，但是一旦你开始做任何不重要的事情，并且发生了一些不好的事情，你会希望你拥有它们。也许您可以在发生意外情况时恢复到备份，但我的猜测是它不是。

另请注意，放弃所有这些保护措施并不意味着您的数据库会表现得更好；事实上，可能恰恰相反。这是因为现实世界的 DBMS 软件也有大量代码来*优化*查询性能。因此，如果您在 SimpleDB 上编写一个连接 6 个表的查询，请不要假设它会找出运行该查询的最佳方式——您可能最终需要等待数小时才能完成，而商业 DBMS 可以使用索引哈希连接并在 0.5 秒内得到它。有无数的小技巧可以用来优化查询性能，相信我，当它们消失时，你会真的很想念它们。

这些都不是对 SimpleDB 的打击。从该[软件的作者](http://www.cs.bc.edu/~sciore/simpledb/intro.html)那里得到它：“虽然它是一个很棒的教学工具，但我无法想象有人愿意将它用于其他任何事情。”

# c# - 什么会导致我的应用程序无法访问资源 (.resx) 文件

> ID：327175
> 
> 赞同：1
> 
> 时间：2008-11-29T04:43:03.773
> 
> 标签：c#, winforms, resources, terminal-services

在终端服务器上运行的 Winforms c# 应用程序。按钮和菜单项的所有图像都作为资源存储在 .resx 文件中。经过一些重度使用，在使用系统时打开和关闭窗口，抛出“索引超出范围”异常并且窗口不再打开。如果用户试图导航到系统的任何其他部分，它会因同样的原因而失败。将其缩小到无法再加载的资源。

有谁知道可能导致这种情况的原因或我如何能够避免这种情况？我应该使用不同的方法来存储要用于我的应用程序的图像吗？

附加信息：原来用户收到的是“参数无效”异常，而不是索引超出范围。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-29T14:47:28.670

奇怪的是你在访问资源的时候收到了超出范围的异常，主要是因为资源没有存储在任何类型的集合中，是作为属性访问的，所以也许你的异常不是来自那里？

请提供一些有关您检索图像/按钮方式的代码。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-29T15:07:55.447

你用完资源后释放吗？听起来您的资源句柄用完了（您看到的异常可能是红鲱鱼）。

# python - 是否有一种“单线”方法可以按排序顺序从字典中获取键列表？

> ID：327191
> 
> 赞同：4
> 
> 时间：2008-11-29T05:03:14.093
> 
> 标签：python, iterator, syntactic-sugar

list`sort()`方法是一个修饰函数，它返回`None`.

因此，如果我想遍历字典中的所有键，我不能这样做：

```
for k in somedictionary.keys().sort():
    dosomething() 
```

相反，我必须：

```
keys = somedictionary.keys()
keys.sort()
for k in keys:
    dosomething() 
```

有没有一种很好的方法可以按排序顺序遍历这些键，而不必将其分解为多个步骤？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-11-29T05:20:37.567

```
for k in sorted(somedictionary.keys()):
    doSomething(k) 
```

请注意，您还可以获取按键排序的所有键和值，如下所示：

```
for k, v in sorted(somedictionary.iteritems()):
   doSomething(k, v) 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-11-29T05:06:35.880

我可以回答我自己的问题吗？

我刚刚发现了方便的“排序”功能，它完全符合我的要求。

```
对于排序中的 k（somedictionary.keys()）：
    做点什么（）

```

它出现在[Python 2.5 字典 2 键排序中](https://stackoverflow.com/questions/157424/python-25-dictionary-2-key-sort)

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-05-13T05:54:38.103

实际上， .keys() 不是必需的：

```
for k in sorted(somedictionary):
    doSomething(k) 
```

或者

```
[doSomethinc(k) for k in sorted(somedict)] 
```

# seo - 我应该摆脱访问我网站的机器人吗？

> ID：327192
> 
> 赞同：4
> 
> 时间：2008-11-29T05:03:32.750
> 
> 标签：seo, robots.txt

我一直在我的跟踪器上注意到机器人正在访问我的网站。我应该更改或编辑我的 robots.txt 还是更改某些内容？不确定这是否好，因为它们正在索引或什么？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-29T05:07:54.800

> 我应该更改或编辑我的 robots.txt 还是更改某些内容？

取决于机器人。一些机器人会尽职尽责地忽略 robots.txt。18 个月前，我们在使用 google AD 机器人时遇到了类似的问题，因为我们的客户购买了很多广告。Google AD 机器人将（如文档所述）忽略通配符 (*) 排除，但会听取明确的忽略。

请记住，尊重 robots.txt 的机器人不会抓取您的网站。如果您希望他们访问您的数据以进行索引，这是不可取的。

更好的解决方案是限制或向机器人提供静态内容。

> 不确定这是否好，因为它们正在索引或什么？

他们可能是索引/抓取/窃取。真的都一样。我认为您想要的是根据 UserAgents 限制他们的 http 请求处理。如何执行此操作取决于您的 Web 服务器和应用程序容器。

正如其他答案中所建议的那样，如果机器人是恶意的，那么您需要找到 UserAgent 模式并向他们发送 403 禁止。或者，如果恶意机器人动态更改用户代理字符串，您还有两个选择：

*   白名单用户代理 - 例如，创建一个只接受某些用户代理的用户代理过滤器。这是非常不完美的。
*   IP 禁止 - http 标头将包含源 IP。或者，如果您遇到 DOS（拒绝服务攻击），那么您将遇到更大的问题

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-29T05:42:48.083

我真的不认为更改 robots.txt 会有所帮助，因为只有优秀的机器人才会遵守它。所有其他人都忽略它并根据需要解析您的内容。就我个人而言，我使用[http://www.codeplex.com/urlrewriter](http://www.codeplex.com/urlrewriter)来摆脱不受欢迎的机器人，如果发现它们，则通过禁止消息进行响应。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-29T05:48:48.447

垃圾邮件机器人不关心 robots.txt。[您可以使用mod_security](http://www.modsecurity.org)之类的东西来阻止它们（这本身就是一个非常酷的 Apache 插件）。或者你可以忽略它们。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-29T06:11:56.230

您可能必须使用 .htaccess 来拒绝某些机器人来破坏您的日志。见这里：[http ://spamhuntress.com/2006/02/13/another-hungry-java-bot/](http://spamhuntress.com/2006/02/13/another-hungry-java-bot/)

我有很多 Java 机器人抓取我的网站，添加

SetEnvIfNoCase 用户代理 ^Java/1。javabot=yes
SetEnvIfNoCase User-Agent ^Java1\. javabot=yes
拒绝来自 env=javabot

让他们停下来。现在他们只得到 403 一次，仅此而已:)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-11-30T08:01:02.720

我曾经为一位客户工作过，该客户有许多“价格比较”机器人一直在访问该网站。问题是我们的后端资源稀缺，每笔交易都需要花钱。

在尝试与其中一些抗争一段时间后，机器人只是不断改变其可识别的特征。我们最终采用了以下策略：

对于服务器上的每个会话，我们确定用户是否在任何时候点击过快。在给定次数的重复之后，我们将“isRobot”标志设置为 true，并通过添加睡眠来简单地降低该会话中的响应速度。我们没有以任何方式告诉用户，因为在这种情况下他只是开始一个新会话。

# executable - IDA Pro 和编辑可执行文件

> ID：327196
> 
> 赞同：5
> 
> 时间：2008-11-29T05:07:17.330
> 
> 标签：executable, patch, ida

这是一个非正统的问题。

我对使用 IDA Pro 有点陌生。
有没有办法编辑汇编代码，然后让 IDA 将结果保存为可执行文件？
是否有某种插件可以做到这一点？因为似乎IDA不想保存为EXE。
还是我需要以其他方式手动编辑它？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2012-04-06T20:56:36.543

IDA Pro 版本 6.1+（可能是 6.2+）将允许您将补丁直接应用于输入文件。同样，它允许您将更改还原回来。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-04-26T04:02:35.333

我在其他地方看到您必须从那里生成一个 .diff 文件，然后使用文本编辑器打开并使用另一个程序修补原始文件。

# c# - C# 表适配器更新不起作用

> ID：327198
> 
> 赞同：0
> 
> 时间：2008-11-29T05:09:46.810
> 
> 标签：c#, database, sql-server-ce, tableadapter

我正在尝试将对象序列化为 sql 紧凑型数据库。我正在使用 VCS Express 2008。每次我运行测试以查看我的数据是否发送到数据库时，数据库中都没有任何内容。我的代码：

```
string inputForDB = null;
                QuizCategoryTableAdapter quizCategoryAdapter = new QuizCategoryTableAdapter();
                QuizApp._QuizApp_DataSet.QuizCategoryDataTable quizCategoryTable = new QuizApp._QuizApp_DataSet.QuizCategoryDataTable();
                quizCategoryAdapter.Fill(quizCategoryTable);
                //Check to see if quizCategory exists
                if (quizCategoryTable.Rows.Contains(quizCategory._categoryID)) {
                    //overwrite (update)
                    //Serialize the object and put in db
                    MemoryStream MemStream = new MemoryStream();
                    IFormatter formatter = new BinaryFormatter();
                    formatter.Serialize(MemStream, quizCategory);
                    inputForDB = Convert.ToBase64String(MemStream.ToArray());
                    quizCategoryAdapter.Insert(quizCategory._categoryName, quizCategory._categoryDescription, inputForDB);
                    //send update to database
                    MemStream.Close();
                } else {
                    //append (insert)
                    MemoryStream MemStream2 = new MemoryStream();
                    IFormatter formatter2 = new BinaryFormatter();
                    formatter2.Serialize(MemStream2, quizCategory);
                    inputForDB = Convert.ToBase64String(MemStream2.ToArray());
                    quizCategoryAdapter.Insert(quizCategory._categoryName, quizCategory._categoryDescription, inputForDB);
                    MemStream2.Close();
                } 
```

它编译得很好，但由于某种原因不起作用。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-11-29T05:13:11.857

您必须调用 Adapter Update 方法以及 DataSet 上的 AcceptChanges

# ms-access - Access 之后我们会做什么？

> ID：327199
> 
> 赞同：34
> 
> 时间：2008-11-29T05:10:08.463
> 
> 标签：ms-access

微软似乎一心要弃用数据库工具的瑞士军刀。外观/文件交换/克隆/命名你的首字母缩写词连接任意数据库服务器/电子表格/CSV/平面文件还有什么？

您从 Access 中挤出了哪些奇怪的功能？还有什么可以代替它的呢？

* * *

## 回答 #1

> 赞同：43
> 
> 时间：2008-12-07T07:01:27.110

Access 不是 DBMS。或者至少它*不仅仅是*一个简单的 DBMS。这是一个非常好的 RAD 环境，一种以图形方式创建 SQL 代码的简单方法，以及成熟 DBM 的常规前端。

SQL Server（Express 或 MSDE）或 Oracle、MySQL 等都**不会**取代它，除非它们与简单的编程语言、Crystal Reports 之类的工具以及初学者无需学习 SQL 即可使用的方式集成。

在我的第一份专业工作中，我完全在 Access 中开发了一个非常大的系统。客户端的前端，我的管理前端，管理的报告和监控，每个用户的权限，在特定时间运行的自动任务等。因此，我开始了解它的许多缺陷和优势。

我见过用它完成的奇妙应用程序，以及一些废话。我仍然将它用于个人项目，并且不会为它感到羞耻（例如，数独播放器或卡诺映射实现）。有一个 MVP 完全在 Access 中创建了一个 Paint 克隆，尽管我认为这是极端的。

Access 的珍珠：很高兴能轻松测试数据库设计理念并为您创建草图表单、报告等。如果您更改列的名称（甚至是表，尽管有时会失败），很高兴看到所有对它的引用都自动更改为新名称。“子形式”控制摇滚，我渴望在 VB6 上。对表格进行重复过滤的“Thunder”按钮很棒，我希望我在 SSMS 上有类似的东西！

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2008-11-29T17:49:42.250

**替换 Access的**问题 - 并且替换 Access 是在绝大多数情况下阻止我向我的业务客户推荐迁移到 Ubuntu 或 SUSE 桌面的问题 - 并不是 Access 被广泛用于其数据库设施：它不是除了用户编写的部门应用程序中最容易重新编码的 Micky Mouse。问题在于中型应用程序，其中数据很久以前就迁移到了公司 SQL Server。

这些是一场噩梦。它们通常写得很糟糕（多年来我已经获得了相当多的管理）并且封装了大量的业务逻辑。**以任何**方式重新编码它们通常最多需要几个人月 - 通常是两倍或三倍，对于一个如此规模的部门来说，有预算来支持这一点是不寻常的。此外，尽管 AJAX 和良好的类似桌面控件的出现意味着这至少在理论上是可能的，但实际上这些都与 MS Office 桌面的其余部分大规模集成，并且几乎不可能在没有用户看到的情况下解开中短期可用性下降——这本身就是一个阻碍。

我真的不知道解决方案是什么，除了用其他方法缓慢替换创建新系统并希望现有应用程序逐渐消亡。麻烦的是，我认为 Access 很可能是 1990 年代的 Cobol——它将永远支持遗留应用程序，因为从头开始重写成本太高。

顺便说一句，来自非 Access 传统 Win32 编码背景的其他人是否有发现即使是专业编写的 Access 应用程序的编码标准通常低于平均水平？虽然像格式化和变量名这样肤浅（但很重要）的东西通常都很好，但我一遍又一遍地发现程序结构很差。我知道这通常可能是因为这些应用程序已经像 Topsy 一样发展，而且 VBA 确实不利于良好的编码，但即使考虑到这些因素，事情通常看起来也比人们预期的要糟糕。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2008-11-29T06:14:11.423

我认为简单的答案是什么...... Access 是常用的，因为它是唯一的选择并且它是可扩展的。世界上几乎每台商业机器上都没有安装任何其他东西，就像访问一样。如果您正在寻找替代方案，Oracle Application Express 是一个相当强大的基于 Web 的应用程序，可以在 Oracle XE 上运行。它是 Access 的潜在替代方案，但不支持主从表和访问。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-07-10T02:51:13.013

世界上有一个连续的开发者，而不是硬性和快速的界限。人员包括业务经理和 IT 专业人员。我认为自己是一个高级的业余开发者，介于两者之间。因此，我在工作中使用 MS Access 在小型建筑办公室中组织大量数据，包括时间表、财务和建筑规范。当然，现在的应用程序是一大堆臭气熏天的 p**，已经增长了近五年。

多年来，我一直在寻找比 Access 更好的东西——我可以在 VB.NET 中创建简单的应用程序，但是 VBA 的学习曲线很大。我看过各种各样的选择。通常您需要 Crystal Reports 来获得任何类型的报告功能，或者 IDE 不直观，或者每次将字段链接到数据对象需要十分钟，或者根本没有与其他办公产品集成。老板也不会为需要炸弹的东西买单。我很想摆脱 Access，但我所看到的任何东西都无法满足所有条件。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2009-07-06T11:59:47.713

Access 的好处在于它可以解决 IT 臃肿问题。它带有 MS Office，因此它已经批准在锁定的计算机上使用，但我不必努力数周/数月来获得通过各个部门批准的应用程序、编码时间以及所有测试应用程序我可以在一个下午用 Access 快速启动。当然 SQL 服务器会很好用，但不值得头疼。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2008-11-30T04:39:25.420

我的表弟是一个认真的[FileMaker](http://filemakeroffer.com)人。他似乎做得很好，并围绕它发展了一家小公司。显然 FileMaker 是一个用于快速应用程序开发的跨平台 Mac/PC 系统...

商业高级用户/RAD 集可能会出现类似的情况？

微软可能有故意杀死这样的数据库系统的历史。[我曾经听过Les Pinter](http://www.dotnetrocks.com/default.aspx?showNum=309)对 .Net Rocks 的采访，他声称他曾经听到一位微软高管说，每卖出一个 FoxPro 副本，微软就会损失数千美元的 SQL 版税。FoxPro 今天在哪里？官方称它已于 2007 年 3 月停产。那么它是如何从盛名走向灭亡的呢？好吧，Les 说微软收购了它并故意将其投入使用。

我通常不喜欢阴谋论，但这确实与微软那个时代的记录产生了共鸣。

无论如何，撇开琐事不谈，我相信会有更多 RAD 风格的数据库工具......它们赋予非开发人员权力，并允许开发人员非常快速地解决某些类型的问题。我不喜欢将它们用于大型项目，不幸的是，级联 - 小型项目往往会随着时间的推移而增长。因此，我只将它们用于非常微小的事情。

至于长期后果……嗯，我已经看到了它们无法很好地扩展的情况，所有这些分散的解决方案开始看起来很像技术债务。实际上，可以将 Access 连接到 SQL Server 后端，这样可以解决很多问题。

可能我对 Access 所做的最大/最奇怪的事情是从头开始编写 EDI 系统。对于那些与 EDI 进行过直接合作的人，你知道我在说什么。那是多么愚蠢的想法。我的问题更多地与 VBA 相关，而不是 Access——我记得我只是真的需要接口而不是拥有它们。

在像 Codesmith 这样的东西可用之前，我也用它来生成代码。它为 ASP Classic 生成业务对象（CRUD 和其他一些基础知识）。这实际上很棒。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2008-12-01T22:49:12.287

我不认为 MS 有任何摆脱 Access 的意图。他们可能会将其转变为更多的最终用户工具，而不是程序员的工具，但它永远不会消失。将 Jet 数据库引擎分叉为每个 Windows 副本附带的传统 Jet 4 版本（因为 Active Directory 使用 Jet 4 作为其数据存储）和 Access 开发组拥有的版本（ACE，及其 ACCDB文件格式，实际上是 Jet 4.5 或 Jet 5）。

Access 是一个非常流行和有用的应用程序，并且在任何数量的组织（无论大小）中的所有级别中都具有功能。

为什么没有 Access 的开源替代品？

因为要创建一个如此复杂的软件来完成这么多不同的事情太难了。

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2009-02-19T03:38:06.373

我怀疑微软会扼杀 Access。随着 Access 2007[与 Sharepoint 的集成以及 SharePoint](http://blogs.msdn.com/access/archive/2006/08/24/windows-sharepoint-services-overview.aspx)的快速增长，Access 实际上可能会重新成为 SharePoint 网站的离线和报告工具。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2009-01-06T11:30:45.350

根据我的经验，Excel 在军团内部的使用更为广泛。我们现在正在做一个项目，我们将大约 60 000 个 Excel 文档（每个文档有 4-12 张）转换为 Sharepoint 和 Infopath 表单。;)

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2009-02-19T07:10:45.860

微软希望我们转向使用[Office 业务应用程序](http://msdn.microsoft.com/en-us/library/bb614538.aspx)——本质上是将办公应用程序连接到数据库。将 SharePoint 添加到组合中，有很多可能性。MS也有大量的许可费。

我已经看到用于集成和前端 GIS 和健康数据的访问。这让我大吃一惊，这个应用程序的编码和记录得多么好。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-11-29T09:34:29.490

作为马克。Access 是我使用数据库的第一种方法，当时我发现它很强大。它有一些不错的功能，例如从“示例查询”生成 SQL。它的表单功能和打印各种格式（例如标签页）的能力也很好。

不利的一面是，它是专有的，并且每个新版本都与以前的版本不兼容：如果您使用 Access 2000 加载使用 Access 97 制作的底座，则无法再使用旧版本加载它...

虽然我没有做太多的个人数据库工作（主要是地址列表），但对于这样的工作，我会使用 Open Office 的数据库工具（尚未尝试）或一个好的旧开源数据库（MySQL、SQLite 是轻量级的） bases) 带有 GUI 前端，例如 SQuirreL SQL 客户端，可能还有 JasperReport 作为报告前端。
不像 Access 那样集成，学习曲线更陡峭，但在某种程度上更灵活。

现在，我确信我们可以找到一些简单的好旧的非关系数据库，用于我当时的简单用途。:-)

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-11-29T17:15:05.190

我欢迎 Access 呼吸到最后一口气并加入 Clippy 之类的公司的那一天。

访问是善意的，但它已成为拐杖。即使在拥有能干 IT 员工的大公司中，Access 应用程序也可能猖獗，在产品维护方面为了解全球格局提供了一个痛点。在我看来，指向其他数据源的链接 Access 数据库、未维护的 Access 应用程序以及只是剪切灵活性都是问题。

我认为 Access 实际上太强大了，太灵活了，太可扩展了。在微软为桌面数据库领域带来快速发展的善意尝试中，它确实打开了一个潘多拉的盒子。也可以从另一个角度看待它。假设一家公司有几个用 Access 编写的应用程序。编写它们的开发人员离开了。这些应用程序足够重要以至于它们仍然需要使用，但还不够重要以至于 IT 部门获得批准将它们移植到技术能力更强的平台上。

现在的情况是，如果团队中没有人知道 Access，这是新开发人员的要求。这意味着您可能不得不放弃技术最全面且最适合的开发人员，如果他没有遗留印章的话。关于这一点，我是根据经验发言的。我们只剩下两个遗留的 Access 应用程序，并且正在狂热地试图说服将功能合并到相关的、基于代码的项目或他们自己的新项目中的需求。我有一位开发人员使用 Access “chops”，并且不会根据某人是否知道 Access 来进行候选人搜索，以防万一他离开。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2009-02-19T02:50:59.900

Access 只是迁移到桌面上的单个用户或共享数据库文件上的几个用户，没有太多安全性。如果您想将其提升到更高的级别，请使用 Access 作为 SQL Server 的前端。

现在看来，Access 2010 正在寻求将挂钩引入 SharePoint，以尝试“启用 Web”Access 应用程序。甚至还有迎合这项技术的主机站点。也许所有担心 Access 无法扩展的人都可以不再害怕了？

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2009-03-24T02:28:44.533

至于我见过的最奇怪的东西挤进 Access ......

我是一所小型大学的警察调度员，我们（像几乎每个机构一样）使用 CAD（计算机辅助调度）和 RMS（记录管理系统）系统。

我们以前的 CAD/RMS 软件完全内置在 Access 中。你打开 Access，然后通过一个丑陋的 GUI，输入服务调用，一切。官员通过相同的界面撰写报告。

起初它运行良好，然后随着数据库大小的增长，它变得极其缓慢且难以使用。这就是当国家让你在一个项目中以最低出价者的情况下发生的......

现在我们使用基于浏览器、由 MS SQL 支持的 CAD/RMS 解决方案。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2009-10-20T00:50:45.583

我认为 Access 不会很快消失。Office 2010 的测试版已经发布，其中包含更新的 Access，Microsoft 博客正在大肆宣传 Access 14（2010 之后的版本）的功能，其中包括改进的 Access 项目 (.ADP)，更好地支持 SQL Server 2005/2008 和更好的 .网络整合。

如果我要寻找提供前端和后端功能的新集成数据库开发系统，Oracle APEX 将是主要竞争者。前端是基于网络的，不需要在客户端上运行，整个系统可以免费下载和安装（快速版），并且几年后新用户的进入障碍有望减少，因此外行可以涉足。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2010-10-27T05:12:11.850

Access definitely has both pro's and cons, it's just another tool to use but not abuse. Every adult job I've ever had used ran on windows, so Access or something like it will exist. I feel sorry for the places that are stuck in Access quicksand or lost in excel hell. But are we forgetting that all that can be corrected and better yet prevented with a bad ass bi team and proper training.

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2008-11-29T06:49:33.067

PostgreSQL、MySQL、FileMaker、*<在此处插入不是Access的数据库名称>*、Excel、自定义解析器、自然语言导入器、Perl只是因为它是瑞士军刀、grep awk sed、m4、之前的旧版本Access Access的消亡，...

*奇怪的功能？* 我使用 SQL 语句来访问 Access，而不是通常的无数方法来访问 Access。我使用的 SQL 语句与其他数据库以及 Access 一起工作——我知道这很奇怪。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2008-11-30T03:39:59.593

像许多人一样，这些年来我一直使用和滥用访问权限，但总觉得有点脏……当我最近看到 Rob Conery 的这篇文章时，我感觉好多了：

[http://blog.wekeroad.com/blog/hacking-your-vote/](http://blog.wekeroad.com/blog/hacking-your-vote/)

永远不会梦想在投票系统中使用访问权限。可怕的。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2009-03-24T02:07:45.723

FileMaker 是从 MS Access 转移的一个很好的数据库。它是一个跨平台的数据库（mac/PC）。它有一个 Web 查看器，您可以通过它连接到网络世界。例如，图表、地图等可以在此 Web 查看器中显示。FileMaker 易于初学者使用。您还可以探索脚本机制并实现数据操作。最新的 FileMaker 10 具有几个有趣的新功能。我投票给 FileMaker。

* * *

## 回答 #20

> 赞同：-1
> 
> 时间：2009-07-06T11:43:41.160

我相信如果人们发现 File Maker Pro 的存在，它可能会成为一个新标准。

FMP 具有 Access 的所有相同功能/缺点，如果您知道自己在做什么，您实际上可以进行真正的客户端/服务器设置。

在单个文件中，您可以定义表单、报告、表格等。它也是跨平台的，可以在 Windows 或 Mac 上运行，也可以适应基于 Web 的。都是设计使然。

从“真正的”SQL 服务器到 File Maker Pro 真的很难，但一旦我掌握了窍门，我发现它非常棒。现在作为一个数据库，它并没有什么特别之处，但作为一个“普通”人可以使用的数据库应用程序开发系统，它真的很闪耀。

如果您计划网络设置，我建议您花时间学习如何预先将存储数据库与应用程序数据库分开。否则升级需要您进行大量数据导出/导入，如果您的表发生显着变化，这可能需要一段时间或几乎不可能。

我已经构建了一个呼叫中心应用程序，该应用程序自动处理来电号码查找并使用 NT 上的 FMP 自动拨打常规 POTS 电话。那是大约 6 年前的事了，所以我想从那以后情况有所改善。

* * *

## 回答 #21

> 赞同：-1
> 
> 时间：2009-07-10T03:00:20.673

当我希望 Excel 可以执行“左内连接”时，我只使用了 Access。否则，MS 已经完成了一项公平的工作，使 C#/SQL 提供简单（且免费）用于轻量级 RDB 项目。

# javascript - JSCocoa 和 iPhone

> ID：327200
> 
> 赞同：2
> 
> 时间：2008-11-29T05:11:33.873
> 
> 标签：javascript, iphone

现在我手头有一堆空闲时间，我想真正进入 iphone dev 。

但是Objective C让我害怕（有点）。感觉时光倒流了一点。我这么说是因为我在过去的 8 个月里一直在用 C++ 编写代码。

[JSCocoa](http://inexdo.com/JSCocoa)看起来棒极了，但这真的可以在 iphone 上运行吗？

需要做些什么才能让这个在 iphone 上运行？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-29T05:31:53.660

（嗨，我是 JSCocoa 开发人员） JSCocoa 在 iPhone 模拟器上工作。从 Google svn 查看最新版本并编译 iPhoneTest2。

要在 iPhone 上工作，它需要 libffi。我看过[http://code.google.com/p/iphone-dev/source/browse/trunk/llvm-gcc-4.0-iphone/](http://code.google.com/p/iphone-dev/source/browse/trunk/llvm-gcc-4.0-iphone/)和一些关于 iPhone 版 Python 的 libffi 帖子，但没有进一步测试。

另外我没有 iPhone，所以测试主要取决于拥有 iPhone 的人 :)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-29T06:46:23.213

使用越狱 iPhone，您可以明确地用 Python 和 Ruby（可能还有 JSCocoa，但我从未研究过）编写应用程序

问题是，要使用 PyObjC/RubyObjC（以及最有可能的 JSCocoa 和任何其他类似项目），您*必须*知道如何使用常规 ObjC 和 Cocoa，因为这些框架几乎是对它们的直接映射。

看到[这个](https://stackoverflow.com/questions/14422/why-is-the-pyobjc-documentation-so-bad#14507)答案，可以总结为..

> 恐怕暂时，您需要基本掌握 ObjC 才能从使用 Cocoa 的任何语言中受益

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-29T08:26:40.373

有点跑题了，但是：你不应该害怕 Objective-C。当然，语法起初看起来很丑（对我来说确实如此），但过了一段时间你就会迷上它。而且由于您已经在 C++ 中度过了 8 个月，我认为您已经很好地掌握了 C，这已经减轻了您学习 Objective-c 的负担！

# winforms - 在 mvc 模式中如何显示另一个视图

> ID：327209
> 
> 赞同：2
> 
> 时间：2008-11-29T05:20:25.320
> 
> 标签：winforms, model-view-controller

嗨，我正在使用 mvc 模式开发一个 winform 应用程序，

如果我有一个 Windows 窗体作为其中带有按钮的视图，并且我想在单击第一个窗体中的按钮时显示另一个视图（winform）。

在这种情况下，视图是否应该将按钮单击通知给控制器，并且控制器将实例化第二个表单并显示，或者第一个视图本身将执行此操作。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-29T10:00:42.900

控制器可能应该处理它。在最纯粹的 MVC 模式中，视图应该用于显示它们自己的内容，而任何其他逻辑，包括显示其他视图，都取决于控制器。（事实上​​，对于许多动作，这就是控制器最终要做的所有事情。）

# c - 您将如何在 Daily WTF 中实现 poloied 功能？

> ID：327216
> 
> 赞同：3
> 
> 时间：2008-11-29T05:28:44.463
> 
> 标签：c, coding-style

[2008-11-28的 Daily WTF](http://thedailywtf.com/Articles/nice_num,-mean_programmer.aspx)使用以下代码：

```
static char *nice_num(long n)
{
    int neg = 0, d = 3;
    char *buffer = prtbuf;
    int bufsize = 20;

    if (n < 0)
    {
        neg = 1;
        n = -n;
    }
    buffer += bufsize;
    *--buffer = '\0';

    do
    {
        *--buffer = '0' + (n % 10);
        n /= 10;
        if (--d == 0)
        {
            d = 3;
            *--buffer = ',';
        }
    }
    while (n);

    if (*buffer == ',') ++buffer;
    if (neg) *--buffer = '-';
    return buffer;
} 
```

你会怎么写？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-11-29T06:03:10.447

如果您是一位经验丰富的 C 程序员，您会意识到这段代码实际上并没有那么糟糕。它相对简单（对于 C 语言），而且速度非常快。它存在三个问题：

1.  它在 LONG_MIN (-2,147,483,648) 的边缘情况下失败，因为否定这个数字会产生二进制补码
    *   它假定 32 位整数 - 对于 64 位长整数，20 字节缓冲区不够大
    *   它不是线程安全的——它使用全局静态缓冲区，因此多个线程同时调用它会导致竞争条件

问题 #1 很容易通过特殊情况解决。为了解决 #2，我将代码分成两个函数，一个用于 32 位整数，一个用于 64 位整数。#3 有点困难——我们必须更改接口以使完全线程安全。

这是我的解决方案，基于此代码，但经过修改以解决这些问题：

```
static int nice_num(char *buffer, size_t len, int32_t n)
{
  int neg = 0, d = 3;
  char buf[16];
  size_t bufsize = sizeof(buf);
  char *pbuf = buf + bufsize;

  if(n < 0)
  {
    if(n == INT32_MIN)
    {
      strncpy(buffer, "-2,147,483,648", len);
      return len <= 14;
    }

    neg = 1;
    n = -n;
  }

  *--pbuf = '\0';

  do
  {
    *--pbuf = '0' + (n % 10);
    n /= 10;
    if(--d == 0)
    {
      d = 3;
      *--pbuf = ',';
    }
  }
  while(n > 0);

  if(*pbuf == ',') ++pbuf;
  if(neg) *--pbuf = '-';

  strncpy(buffer, pbuf, len);
  return len <= strlen(pbuf);
} 
```

说明：它在堆栈上创建一个本地缓冲区，然后以与初始代码相同的方法填充该缓冲区。然后，它将它复制到传递给函数的参数中，确保不会溢出缓冲区。它还有一个 INT32_MIN 的特殊情况。如果原始缓冲区足够大，则返回值为 0，如果缓冲区太小并且结果字符串被截断，则返回值为 1。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-29T06:05:18.820

嗯......我想我不应该承认这一点，但我的嵌入式系统的 int 到字符串例程的工作方式几乎完全相同（但没有放入逗号）。

这不是特别简单，但是如果您正在使用无法使用的系统，我不会将其称为 WTF `snprintf()`。

写上面的那个家伙大概是注意到了`printf()`套路族不能做逗号分组，所以想出了自己的。

脚注：有些库的`printf()`样式格式确实支持分组，但它们不是标准的。而且我知道发布的代码不支持使用“。”分组的其他语言环境。但这几乎不是 WTF，可能只是一个错误。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-29T06:04:36.060

这可能与我实际编写它的方式非常接近。我可以立即看到该解决方案的唯一问题是它不适用于 LONG_MIN 在 LONG_MIN 为 -(LONG_MAX + 1) 的机器上，这是当今大多数机器。我可能会使用`localeconv`获取千位分隔符而不是假设逗号，并且我可能会更仔细地计算缓冲区大小，但是算法和实现对我来说似乎很简单，对于 C 来说并不是真正的 WTF（有更好的解决方案对于 C++）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-29T06:07:32.463

语言：

```
(defun pretty-number (x) (format t "~:D" x)) 
```

我很惊讶我能如此轻松地做到这一点。我什至没有超过我的 Lisp 书的第一章。xD（或者我应该说，〜：D）

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-08-29T23:48:20.703

```
size_t
signed_as_text_grouped_on_powers_of_1000(char *s, ssize_t max, int n)
{
    if (max <= 0)
        return 0;

    size_t r=0;
    bool more_groups = n/1000 != 0;
    if (more_groups)
    {
       r = signed_as_text_grouped_on_powers_of_1000(s, max, n/1000);
       r += snprintf(s+r, max-r, ",");
       n = abs(n%1000);
       r += snprintf(s+r, max-r, "%03d",n);
    } else
       r += snprintf(s+r, max-r, "% 3d", n);

    return r;
} 
```

不幸的是，这比原来慢了大约 10 倍。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-29T06:03:15.127

在纯 C 中：

```
#include <stdio.h>
#include <limits.h>

static char *prettyNumber(long num, int base, char separator)
{
#define bufferSize      (sizeof(long) * CHAR_BIT)
        static char buffer[bufferSize + 1];
        unsigned int pos = 0;

        /* We're walking backwards because numbers are right to left. */
        char *p = buffer + bufferSize;
        *p = '\0';

        int negative = num < 0;

        do
        {
                char digit = num % base;
                digit += '0';

                *(--p) = digit;
                ++pos;

                num /= base;

                /* This the last of a digit group? */
                if(pos % 3 == 0)
                {
/* TODO Make this a user setting. */
#ifndef IM_AMERICAN
#       define IM_AMERICAN_BOOL 0
#else
#       define IM_AMERICAN_BOOL 1
#endif
                        /* Handle special thousands case. */
                        if(!IM_AMERICAN_BOOL && pos == 3 && num < base)
                        {
                                /* DO NOTHING */
                        }
                        else
                        {
                                *(--p) = separator;
                        }
                }
        } while(num);

        if(negative)
                *(--p) = '-';

        return p;
#undef bufferSize
}

int main(int argc, char **argv)
{
        while(argc > 1)
        {
                long num = 0;

                if(sscanf(argv[1], "%ld", &num) != 1)
                        continue;

                printf("%ld = %s\n", num, prettyNumber(num, 10, ' '));

                --argc;
                ++argv;
        };

        return 0;
} 
```

通常我会返回一个分配的缓冲区，它需要由用户释放。这种添加是微不足道的。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-29T09:59:00.907

我很无聊，在 Perl 中做了这个幼稚的实现。作品。

```
 sub pretify {
    my $num = $_[0];
    my $numstring = sprintf( "%f", $num );

    # Split into whole/decimal
    my ( $whole, $decimal ) = ( $numstring =~ /(^\d*)(.\d+)?/ );
    my @chunks;
    my $output = '';

    # Pad whole into multiples of 3
    $whole = q{ } x ( 3 - ( length $whole ) % 3 ) . $whole;

    # Create an array of all 3 parts.
    @chunks = $whole =~ /(.{3})/g;

    # Reassemble with commas
    $output = join ',', @chunks;
    if ($decimal) {
        $output .= $decimal;
    }

    # Strip Padding ( and spurious commas )
    $output =~ s/^[ ,]+//;

    # Strip excess tailing zeros
    $output =~ s/0+$//;

    # Ending with . is ugly
    $output =~ s/\.$//;
    return $output;
}

print "\n", pretify 100000000000000000000000000.0000;
print "\n", pretify 10_202_030.45;
print "\n", pretify 10_101;
print "\n", pretify 0;
print "\n", pretify 0.1;
print "\n", pretify 0.0001;
print "\n"; 
```

# c++ - 样条、B 样条和 NURBS C++ 库

> ID：327218
> 
> 赞同：14
> 
> 时间：2008-11-29T05:29:51.510
> 
> 标签：c++, graphics

有谁知道样条曲线的库或一组类 - 特别是 b 样条曲线和 NURBS（可选）。

目前，一个快速、高效的 b 样条库对我来说非常有用。

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-07-09T17:28:50.137

我知道我在问这个问题几个月后才回答，但对于可能正在寻找类似答案的其他人，我会指出[openNURBS](http://www.opennurbs.org/)。

OpenNURBS 也恰好是建模包[Rhinoceros](http://www.rhino3d.com/)中使用的库。这是一个非常完整的库，值得考虑。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-11-29T10:11:42.643

1.) 对于 B 样条曲线 - 你应该检查 C 中的数字食谱（有这本书，也可以在线参考）

2.) 还要检查：[sourceforge.net/projects/einspline/](http://sourceforge.net/projects/einspline/) & [this](http://www.gnu.org/software/gsl/manual/html_node/Basis-Splines.html)

-广告

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-14T17:56:39.953

这个库也可能很有希望：http: [//libnurbs.sourceforge.net](http://libnurbs.sourceforge.net)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2014-05-31T20:02:28.960

[Eigen Spline](http://eigen.tuxfamily.org/dox/unsupported/group__Splines__Module.html)基于著名的（快速）线性代数 C++ 模板库。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2014-04-30T14:41:06.757

此外，ITK 有一个用于 bspline itkBSplineScatteredDataPointSetToImageFilter 的类，请参见 http://www.itk.org/Wiki/ITK/Examples/WishList/PointSet/BSplineScatteredDataPointSetToImageFilter 上的示例（[http://www.itk.org/Doxygen/html/classitk_1_1BSplineScatteredDataPointSetToImageFilter](http://www.itk.org/Doxygen/html/classitk_1_1BSplineScatteredDataPointSetToImageFilter.html)[上](http://www.itk.org/Wiki/ITK/Examples/WishList/PointSet/BSplineScatteredDataPointSetToImageFilter)的 文档[.html](http://www.itk.org/Doxygen/html/classitk_1_1BSplineScatteredDataPointSetToImageFilter.html) [http://www.itk.org/Doxygen/html/classitk_1_1BSplineScatteredDataPointSetToImageFilter.html](http://www.itk.org/Doxygen/html/classitk_1_1BSplineScatteredDataPointSetToImageFilter.html) )

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2014-11-25T05:46:02.647

麻省理工学院的优秀图书馆也有在线书籍作为补充。这是（超级）书 [http://web.mit.edu/hyperbook/Patrikalakis-Maekawa-Cho/mathe.html](http://web.mit.edu/hyperbook/Patrikalakis-Maekawa-Cho/mathe.html)

在链接的底部，您会找到相关的软件，在这里： [http ://web.mit.edu/hyperbook/Patrikalakis-Maekawa-Cho/software.html](http://web.mit.edu/hyperbook/Patrikalakis-Maekawa-Cho/software.html)

GSL 有一个很好的非常基本的 b 样条实现，但它不包括 NURBS 曲线，也不包括用于插入/移除结的算法，或者一些更高级的东西。您还可以在 Piegl & Tiller 的“The NURBS book”一书中找到许多有用的算法，您可以用自己的语言编译这些算法：http: [//www.amazon.com/NURBS-Book-Monographs-Visual-通讯/dp/3540615458](https://rads.stackoverflow.com/amzn/click/com/3540615458)

数值配方不包括对 b 样条的支持。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2015-08-16T08:42:25.523

[SISL](https://github.com/SINTEF-Geometry/SISL)似乎是一个很好的 NURBS 库（在 AGPL 许可下）。它是[GoTools](http://www.sintef.no/Geometry-Toolkits)的一部分，可以在[此处](https://github.com/SINTEF-Geometry/GoTools)克隆。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2021-01-15T15:57:30.483

[vspline](https://bitbucket.org/kfj/vspline)是一个免费的开源 B 样条库。它全面而快速，带有额外的代码来有效地处理像图像和体积这样的 nD 栅格数据。它是 C++11 标准中的仅标头 C++ 模板元代码，几乎没有外部依赖项。还有一个同名的debian包。

# vxworks - taskDelay(0) 是否会将 CPU 让给优先级较低的任务

> ID：327222
> 
> 赞同：2
> 
> 时间：2008-11-29T05:32:00.307
> 
> 标签：vxworks

如果有 3 个优先级为 P1 P2 P3 的任务（T1，T2，t3）。

P1 已挂起。

假设任务 P2 正在做一些计算。在执行期间，它希望将 CPU 让给系统中的其他任务。

TaskDelay(0) 在这种情况下仍然有效吗？还是仅在所有任务具有相同优先级时才有效？

问候，帕布

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-29T05:34:42.547

taskDelay(0)**不会**导致较低优先级的任务控制 CPU。

只有当具有相同优先级的任务准备好执行时，taskDelay(0) 才会导致上下文切换。

taskDelay(0) 实质上导致优先级 x 的任务被放在优先级 x 就绪队列的末尾。如果它是该优先级的唯一任务，则保留 CPU。

# python - Python 字典的内存高效替代方案

> ID：327223
> 
> 赞同：46
> 
> 时间：2008-11-29T05:33:26.607
> 
> 标签：python, memory, data-structures

在我目前的一个副项目中，我正在浏览一些文本，查看单词三连音的频率。在我第一次尝试时，我使用了默认字典深度三层。换句话说，`topDict[word1][word2][word3]`返回这些单词在文本中出现的次数，`topDict[word1][word2]`返回一个字典，其中包含单词 1 和 2 之后出现的所有单词，等等。

这可以正常工作，但它非常占用内存。在我最初的测试中，它使用的内存是仅将三元组存储在文本文件中的 20 倍，这似乎是一个过大的内存开销。

我怀疑这些字典中的许多创建的插槽比实际使用的插槽多，所以我想用以这种方式使用时内存效率更高的其他字典替换字典。我强烈希望有一种解决方案，它允许按照字典的方式进行键查找。

根据我对数据结构的了解，使用红黑或 AVL 之类的平衡二叉搜索树可能是理想的，但我真的不想自己实现它们。如果可能的话，我宁愿坚持使用标准的 python 库，但如果它们能最好地工作，我绝对愿意接受其他替代方案。

那么，有人对我有什么建议吗？

编辑添加：

感谢您到目前为止的回复。到目前为止，一些答案建议使用元组，当我将前两个单词压缩成一个元组时，这对我并没有多大帮助。我很犹豫是否将这三个单词都用作键，因为我希望在前两个单词的情况下可以轻松查找所有第三个单词。（即我想要类似的结果`topDict[word1, word2].keys()`）。

我正在使用的当前数据集是[Wikipedia For Schools](http://www.soschildrensvillages.org.uk/charity-news/wikipedia-for-schools.htm)的最新版本。例如，解析前一千页的结果对于一个文本文件大约是 11MB，其中每行是三个单词，并且计数所有选项卡分隔。以我现在使用的字典格式存储文本大约需要 185MB。我知道指针和诸如此类的东西会有一些额外的开销，但差异似乎太大了。

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2008-11-29T07:06:58.007

一些测量。我获取了 10MB 的免费电子书文本并计算了三元组频率，生成了一个 24MB 的文件。将它存储在不同的简单 Python 数据结构中需要以 kB 为单位的这么多空间，以运行 ps 的 RSS 来衡量，其中 d 是 dict，keys 和 freqs 是列表，a,b,c,freq 是 trigram 记录的字段：

```
295760     S. Lott's answer
237984     S. Lott's with keys interned before passing in
203172 [*] d[(a,b,c)] = int(freq)
203156     d[a][b][c] = int(freq)
189132     keys.append((a,b,c)); freqs.append(int(freq))
146132     d[intern(a),intern(b)][intern(c)] = int(freq)
145408     d[intern(a)][intern(b)][intern(c)] = int(freq)
 83888 [*] d[a+' '+b+' '+c] = int(freq)
 82776 [*] d[(intern(a),intern(b),intern(c))] = int(freq)
 68756     keys.append((intern(a),intern(b),intern(c))); freqs.append(int(freq))
 60320     keys.append(a+' '+b+' '+c); freqs.append(int(freq))
 50556     pair array
 48320     squeezed pair array
 33024     squeezed single array 
```

标记为 [*] 的条目没有有效的方法来查找一对 (a,b)；它们被列出只是因为其他人建议了它们（或它们的变体）。（我有点厌烦做这个，因为投票最多的答案没有帮助，如表所示。）

“对数组”是我原始答案中的以下方案（“我将从键为前两个单词的数组开始......”），其中每对的值表表示为单个字符串。“压缩对数组”是相同的，省略了等于 1 的频率值（最常见的情况）。“压缩单个数组”类似于压缩对数组，但将键和值组合为一个字符串（带有分隔符）。压缩的单数组代码：

```
import collections

def build(file):
    pairs = collections.defaultdict(list)
    for line in file:  # N.B. file assumed to be already sorted
        a, b, c, freq = line.split()
        key = ' '.join((a, b))
        pairs[key].append(c + ':' + freq if freq != '1' else c)
    out = open('squeezedsinglearrayfile', 'w')
    for key in sorted(pairs.keys()):
        out.write('%s|%s\n' % (key, ' '.join(pairs[key])))

def load():
    return open('squeezedsinglearrayfile').readlines()

if __name__ == '__main__':
    build(open('freqs')) 
```

我还没有编写代码来从这个结构中查找值（使用 bisect，如下所述），或者实现下面描述的更高级的压缩结构。

**原答案：**一个简单的排序字符串数组，每个字符串都是用空格分隔的单词连接，使用 bisect 模块搜索，应该值得一试。这节省了指针等空间。由于单词的重复，它仍然浪费空间；有一个标准的技巧可以去除常见的前缀，用另一个级别的索引来取回它们，但这更复杂也更慢。（想法是以必须顺序扫描的压缩形式存储数组的连续块，以及每个块的随机访问索引。块大到可以压缩，但对于合理的访问时间来说足够小。特定的压缩此处适用的方案：如果连续条目是“hello george”和“hello world”，则将第二个条目改为“6world”。[兹库](http://www.python.org/doc/2.5.2/lib/module-zlib.html)？无论如何，您可以通过查找全文搜索中使用的字典结构来了解更多信息。）因此，具体而言，我将从键为前两个单词的数组开始，并使用其条目列出可能的并行数组第三个词及其频率。不过，它可能仍然很糟糕——我认为就包含电池的内存高效选项而言，你可能不走运。

*此外，这里不*建议使用二叉树结构来提高内存效率。例如，[这篇论文](https://dl.acm.org/doi/abs/10.1145/506309.506312)在一个类似的问题上测试了各种数据结构（尽管是一元组而不是三元组），并找到了一个哈希表来通过该度量击败所有的树结构。

我应该像其他人一样提到，排序后的数组只能用于单词列表，而不是二元组或三元组；然后对于您的“真实”数据结构，无论它是什么，您都使用整数键而不是字符串——词表中的索引。（但这使您无法利用除了单词表本身之外的常见前缀。也许我毕竟不应该建议这个。）

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-11-29T07:36:31.490

使用元组。
元组可以是字典的键，所以你不需要嵌套字典。

```
d = {}
d[ word1, word2, word3 ] = 1 
```

另外，您可以使用 defaultdict

*   这样没有条目的元素总是返回 0
*   这样你就可以`d[w1,w2,w3] += 1`在不检查密钥是否已经存在的情况下说

例子：

```
from collections import defaultdict
d = defaultdict(int)
d["first","word","tuple"] += 1 
```

如果您需要查找与 (word1,word2) 元组的所有单词“word3”，则使用列表理解在 dictionary.keys() 中搜索它

如果您有一个元组 t，您可以使用切片获取前两项：

```
>>> a = (1,2,3)
>>> a[:2]
(1, 2) 
```

一个用列表推导搜索元组的小例子：

```
>>> b = [(1,2,3),(1,2,5),(3,4,6)]
>>> search = (1,2)
>>> [a[2] for a in b if a[:2] == search]
[3, 5] 
```

你看这里，我们得到了以 (1,2) 开头的元组中作为第三项出现的所有项的列表

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-11-29T11:50:18.763

在这种情况下，[ZODB](http://www.zope.org/Products/StandaloneZODB) ¹ BTrees 可能会有所帮助，因为它们对内存的消耗要少得多。使用 BTrees.OOBtree（对象键到对象值）或 BTrees.OIBTree（对象键到整数值），并使用 3 字元组作为键。

就像是：

```
from BTrees.OOBTree import OOBTree as BTree 
```

该接口或多或少类似于 dict，但（对您而言）还有额外的好处，即,`.keys`和有两个可选参数：`.items``.iterkeys``.iteritems``min, max`

```
>>> t=BTree()
>>> t['a', 'b', 'c']= 10
>>> t['a', 'b', 'z']= 11
>>> t['a', 'a', 'z']= 12
>>> t['a', 'd', 'z']= 13
>>> print list(t.keys(('a', 'b'), ('a', 'c')))
[('a', 'b', 'c'), ('a', 'b', 'z')] 
```

¹ 请注意，如果您在 Windows 上并使用 Python >2.4，我知道有更新的 Python 版本的软件包，但我不记得在哪里。

PS他们存在于[CheeseShop](http://pypi.python.org/pypi/ZODB3) ☺</p>

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-11-29T06:59:32.827

几次尝试：

我想你正在做类似的事情：

```
from __future__ import with_statement

import time
from collections import deque, defaultdict

# Just used to generate some triples of words
def triplegen(words="/usr/share/dict/words"):
    d=deque()
    with open(words) as f:
        for i in range(3):
            d.append(f.readline().strip())

        while d[-1] != '':
            yield tuple(d)
            d.popleft()
            d.append(f.readline().strip())

if __name__ == '__main__':
    class D(dict):
        def __missing__(self, key):
            self[key] = D()
            return self[key]
    h=D()
    for a, b, c in triplegen():
        h[a][b][c] = 1
    time.sleep(60) 
```

这给了我〜88MB。

将存储更改为

```
h[a, b, c] = 1 
```

大约需要 25MB

实习 a、b 和 c 大约需要 31MB。我的情况有点特别，因为我的话从不重复输入。您可以自己尝试一些变体，看看其中一种是否对您有帮助。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-11-29T12:14:17.403

你在实现马尔可夫文本生成吗？

如果您的链将 2 个单词映射到第三个单词的概率，我会使用字典将 K 元组映射到第 3 个单词直方图。实现直方图的一种简单（但需要内存）的方法是使用带有重复的列表，然后`random.choice`以适当的概率为您提供一个单词。

这是一个以 K-tuple 作为参数的实现：

```
import random

# can change these functions to use a dict-based histogram
# instead of a list with repeats
def default_histogram():          return []
def add_to_histogram(item, hist): hist.append(item)
def choose_from_histogram(hist):  return random.choice(hist)

K=2 # look 2 words back
words = ...
d = {}

# build histograms
for i in xrange(len(words)-K-1):
  key = words[i:i+K]
  word = words[i+K]

  d.setdefault(key, default_histogram())
  add_to_histogram(word, d[key])

# generate text
start = random.randrange(len(words)-K-1)
key = words[start:start+K]
for i in NUM_WORDS_TO_GENERATE:
  word = choose_from_histogram(d[key])
  print word,
  key = key[1:] + (word,) 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-29T06:21:59.987

您可以尝试使用相同的字典，只有一层深。

```
topDictionary[word1+delimiter+word2+delimiter+word3] 
```

分隔符可以是普通的“”。（或使用（word1，word2，word3））

这将是最容易实现的。我相信你会看到一点进步，如果还不够……我会想办法……

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-29T11:44:40.507

好的，所以您基本上是在尝试存储稀疏的 3D 空间。您希望对该空间的访问模式类型对于算法和数据结构的选择至关重要。考虑到您的数据源，您是否要将其提供给网格？如果您不需要 O(1) 访问权限：

为了获得内存效率，您希望将该空间细分为具有相似数量条目的子空间。（就像一个 BTree）。所以一个数据结构：

*   第一个词范围
*   第二个词范围
*   第三个词范围
*   条目数
*   排序的条目块。
*   所有 3 个维度的下一个和上一个块

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-12-01T16:42:46.347

Scipy 具有稀疏矩阵，因此如果您可以将前两个单词设为元组，则可以执行以下操作：

```
import numpy as N
from scipy import sparse

word_index = {}
count = sparse.lil_matrix((word_count*word_count, word_count), dtype=N.int)

for word1, word2, word3 in triple_list:
    w1 = word_index.setdefault(word1, len(word_index))
    w2 = word_index.setdefault(word2, len(word_index))
    w3 = word_index.setdefault(word3, len(word_index))
    w1_w2 = w1 * word_count + w2
    count[w1_w2,w3] += 1 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-11-29T12:18:27.647

如果内存不够大，[pybsddb](http://www.jcea.es/programacion/pybsddb.htm)可以帮助存储磁盘持久映射。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-11-29T16:52:46.360

您可以使用 numpy 多维数组。您需要使用数字而不是字符串来索引数组，但这可以通过使用单个 dict 将单词映射到数字来解决。

```
import numpy
w = {'word1':1, 'word2':2, 'word3':3, 'word4':4}
a = numpy.zeros( (4,4,4) ) 
```

然后索引到你的数组，你会做这样的事情：

```
a[w[word1], w[word2], w[word3]] += 1 
```

这种语法并不漂亮，但 numpy 数组的效率与您可能找到的任何东西一样有效。另请注意，我还没有尝试过这段代码，所以我可能会在一些细节上有所偏差。只是从这里回忆。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-11-29T19:48:04.243

这是一个使用 bisect 库来维护单词排序列表的树结构。**O** (log2(n))中的每次查找。

```
import bisect

class WordList( object ):
    """Leaf-level is list of words and counts."""
    def __init__( self ):
        self.words= [ ('\xff-None-',0) ]
    def count( self, wordTuple ):
        assert len(wordTuple)==1
        word= wordTuple[0]
        loc= bisect.bisect_left( self.words, word )
        if self.words[loc][0] != word:
            self.words.insert( loc, (word,0) )        
        self.words[loc]= ( word, self.words[loc][1]+1 )
    def getWords( self ):
        return self.words[:-1]

class WordTree( object ):
    """Above non-leaf nodes are words and either trees or lists."""
    def __init__( self ):
        self.words= [ ('\xff-None-',None)  ]
    def count( self, wordTuple ):
        head, tail = wordTuple[0], wordTuple[1:]
        loc= bisect.bisect_left( self.words, head )
        if self.words[loc][0] != head:
            if len(tail) == 1:
                newList= WordList()
            else:
                newList= WordTree()
            self.words.insert( loc, (head,newList) )
        self.words[loc][1].count( tail )
    def getWords( self ):
        return self.words[:-1]

t = WordTree()
for a in ( ('the','quick','brown'), ('the','quick','fox') ):
    t.count(a)

for w1,wt1 in t.getWords():
    print w1
    for w2,wt2 in wt1.getWords():
        print " ", w2
        for w3 in wt2.getWords():
            print "  ", w3 
```

为简单起见，这在每个树和列表中使用了一个虚拟值。这节省了无穷无尽的 if 语句，以便在我们进行比较之前确定列表是否实际上是空的。它只有一次是空的，因此对于所有*n* -1 其他单词来说，if 语句都被浪费了。

* * *

## 回答 #12

> 赞同：-1
> 
> 时间：2008-11-29T07:11:47.967

您可以将所有单词放入字典中。键是单词，值是数字（索引）。

然后你像这样使用它：

```
Word1=indexDict[word1]
Word2=indexDict[word2]
Word3=indexDict[word3]

topDictionary[Word1][Word2][Word3] 
```

在 indexDict 中插入：

```
if word not in indexDict:
    indexDict[word]=len(indexDict) 
```

# nhibernate - 使用 nhibernate 映射 SQL 2008 datetimeoffset

> ID：327226
> 
> 赞同：4
> 
> 时间：2008-11-29T05:40:36.420
> 
> 标签：nhibernate, sql-server-2008

是否有任何受支持的方法可以使用 nhibernate 将 SQL 2008 中的新数据类型 datetimeoffset 映射到 System.DateTimeOffset？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-12T12:44:50.207

NH 2.1（或从 NHibernate 主干编译）支持这一点以及更多开箱即用的功能。[看看这个](http://nhforge.org/blogs/nhibernate/archive/2009/03/11/nhibernate-and-ms-sql-server-2008-date-time-datetime2-and-datetimeoffset.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-19T15:45:35.623

（假设 google 没有关闭任何东西）您可能需要创建一个简单的 IUserType 来处理这个问题，而且我相信 NH 团队会很乐意接受它作为每个人都受益的补丁。

Ayende 在这方面有一个很好的[帖子](http://ayende.com/Blog/archive/2008/07/31/Entities-dependencies-best-practices.aspx)。他通过了几个选项来解决他的问题，所以你可能想从帖子的底部（而不是评论）开始，然后往上走。

# jquery - 使用 jQuery 通过 JSON 显示数据的最佳方式

> ID：327231
> 
> 赞同：17
> 
> 时间：2008-11-29T05:45:41.790
> 
> 标签：jquery, json

我试图找到通过使用 jQuery 的 Ajax 调用在我的页面上显示结果的最佳方法，您认为最好的方法是将其作为 JSON 还是纯文本传递？我以前使用过 ajax 调用，但不确定哪个比另一个更受欢迎，对于 JSON 版本，从 PHP 页面生成的 JSON 文件中读取以显示我的结果的最佳方式是什么。

我知道我会包含一个`.each`来运行它以显示它们。

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2008-11-29T15:53:37.493

像这样的东西：

```
$.getJSON("http://mywebsite.com/json/get.php?cid=15",
        function(data){
          $.each(data.products, function(i,product){
            content = '<p>' + product.product_title + '</p>';
            content += '<p>' + product.product_short_description + '</p>';
            content += '<img src="' + product.product_thumbnail_src + '"/>';
            content += '<br/>';
            $(content).appendTo("#product_list");
          });
        }); 
```

将采用由产品键返回的 PHP 数组组成的 json 对象。例如：

```
Array('products' => Array(0 => Array('product_title' => 'Product 1',
                                     'product_short_description' => 'Product 1 is a useful product',
                                     'product_thumbnail_src' => '/images/15/1.jpg'
                                    )
                          1 => Array('product_title' => 'Product 2',
                                     'product_short_description' => 'Product 2 is a not so useful product',
                                     'product_thumbnail_src' => '/images/15/2.jpg'
                                    )
                         )
     ) 
```

要重新加载列表，您只需执行以下操作：

```
$("#product_list").empty(); 
```

然后使用新参数再次调用 getJSON。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-11-29T06:45:06.103

JQuery 具有用于 Ajax 的内置 json 数据类型，并将数据转换为对象。PHP% 还具有内置的 json_encode 函数，可将数组转换为 json 格式的字符串。节省了大量的解析、解码工作。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-11-29T16:08:08.417

完美的！谢谢Jay，下面是我的HTML：

```
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>Facebook like ajax post - jQuery - ryancoughlin.com</title>
<link rel="stylesheet" href="../css/screen.css" type="text/css" media="screen, projection" />
<link rel="stylesheet" href="../css/print.css" type="text/css" media="print" />
<!--[if IE]><link rel="stylesheet" href="../css/ie.css" type="text/css" media="screen, projection"><![endif]-->
<link href="../css/highlight.css" rel="stylesheet" type="text/css" media="screen" />
<script src="js/jquery.js" type="text/javascript" charset="utf-8"></script>
<script type="text/javascript">
/* <![CDATA[ */
$(document).ready(function(){
    $.getJSON("readJSON.php",function(data){
        $.each(data.post, function(i,post){
            content += '<p>' + post.post_author + '</p>';
            content += '<p>' + post.post_content + '</p>';
            content += '<p' + post.date + '</p>';
            content += '<br/>';
            $(content).appendTo("#posts");
        });
    });   
});
/* ]]> */
</script>
</head>
<body>
        <div class="container">
                <div class="span-24">
                       <h2>Check out the following posts:</h2>
                        <div id="posts">
                        </di>
                </div>
        </div>
</body>
</html> 
```

我的 JSON 输出：

```
{ posts: [{"id":"1","date_added":"0001-02-22 00:00:00","post_content":"This is a post","author":"Ryan Coughlin"}]} 
```

运行代码时出现此错误：

```
object is undefined
http://localhost:8888/rks/post/js/jquery.js
Line 19 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-11-29T06:53:24.260

您可以从 JSON 对象创建 jQuery 对象：

```
$.getJSON(url, data, function(json) {
    $(json).each(function() {
        /* YOUR CODE HERE */
    });
}); 
```

# asp.net - 对excel中的行进行分组

> ID：327238
> 
> 赞同：0
> 
> 时间：2008-11-29T06:02:31.727
> 
> 标签：asp.net, excel

我在asp.net 中设计了一个网页。在那我使用了css文件和excel生成按钮。当我单击用于将数据从数据库填充到 Excel 的按钮时。它显示了上传这样的css文件的问题。我将如何删除该错误。

为了打开excel表，我使用了以下代码

```
Response.ContentType = "application/xls";
Response.AddHeader("Content-Disposition", "attachment; filename=itext.xls"); 
```

这有什么不对吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-29T10:45:41.297

如果我理解正确，您遇到的问题是我很久以前遇到的问题（仍在经典的 ASP 时代），当您打开生成的 excel 文件时，您会收到指向 css 引用的错误“缺少文件”。我当时所做的解决方法是完全删除 css 引用并改用内联样式。

这将允许您回家，但如果您想要一个更先进的解决方案，您可以向服务器发出异步请求，在那里生成内容（在内存中或在文件中，取决于结果的大小）然后发送完成后返回给客户端。

# git - 使用 git-format-patch 和 git am 寻找工作流示例

> ID：327249
> 
> 赞同：19
> 
> 时间：2008-11-29T06:16:01.217
> 
> 标签：git, version-control, workflow

我正在考虑让我的学生使用 git 进行结对编程。因为学生的工作必须保密，所以公开回购是不可能的。相反，每个学生都有一个他们自己维护的私人仓库，他们需要使用 git-format-patch 交换补丁。我已经阅读了手册页，但我有点不清楚将发送*哪些补丁。*对于学生来说，显而易见的事情是**发送自上次发送以来的所有补丁，**或者（如果 git 不介意冗余地接收相同的补丁）**发送自时间之初以来的所有补丁**。（请记住，这些是学生项目，它们会持续几个星期，而且很小，**性能不是标准**。）我们最好的朋友是**简单**我们也喜欢蛮力。

谁能给我一个简短的系列示例，展示两个人，每个人都有一个私人 git repo，使用 git-format-patch 和 git-am 交换补丁？或者将我指向现有的 git 文档和/或教程？

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-11-29T06:25:04.643

如果他们能看到彼此的 git repos 效果最好。git 本身就是以这种方式管理的（人们可以参考一个公共回购，然后他们从那里格式化补丁）。如果人们*永远*看不到彼此的回购协议，事情就会变得更加困难......

他们可能会做的一件事是维护对他们最后一次进行格式补丁的引用。假设他们首先发送整个树（包括 .git）：

```
tar cvf - mytree | gzip -9vc > /tmp/mytree.tgz
# mail /tmp/mytree.tgz
git tag last-send
# hack, commit, hack, commit
git format-patch -M -C last-send..
# mail 00* && rm 00*
git tag -f last-send 
```

`git tag`在这种形式中创建一个“轻量级标签。它是一种书签。这将是人们跟踪他们发送的内容的一种简单方法，以便他们下次可以再次发送。

另一方面：

```
# get patches from mail and place in /tmp
git am /tmp/00*
rm /tmp/00* 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2016-01-26T23:11:30.477

似乎这[`git bundle`](https://git-scm.com/docs/git-bundle)是更好的选择。与`git format-patch`单向通信工作流不同，捆绑包允许您利用与公共遥控器相同的工作流，但与直接访问分开。

它专为运动鞋网而设计，非常适合学生保存到 USB 或电子邮件包。

补丁更多的是由项目负责人的沟通方式提交以供批准。

# python - 为什么 Python readline 模块在 OS X 上不可用？

> ID：327251
> 
> 赞同：6
> 
> 时间：2008-11-29T06:18:49.370
> 
> 标签：python, macos, readline

Python[`readline`](http://www.python.org/doc/2.5.2/lib/module-readline.html)模块的文档说“可用性：Unix”。但是，它在 OS X 上似乎不可用，尽管其他标记为 Unix 的模块可用。这是我正在使用的：

```
$ unname -a
Darwin greg.local 8.11.1 达尔文内核版本 8.11.1：2007 年 10 月 10 日星期三 18:23:28 PDT；根：xnu-792.25.20~1/RELEASE_I386 i386 i386
$哪个蟒蛇
/usr/bin/python
$蟒蛇
Python 2.3.5（#1，2007 年 11 月 26 日，09:16:55）
[GCC 4.0.1 (Apple Computer, Inc. build 5363) (+4864187)] 在 darwin
输入“帮助”、“版权”、“信用”或“许可”以获取更多信息。
>>> 导入读取线
回溯（最近一次通话最后）：
  文件“”，第 1 行，在？
ImportError：没有名为 readline 的模块
>>>

```

我还通过 MacPorts 安装了 Python 2.5，但`readline`在那里也不可用。

我可以做些什么来为OS X 上`readline`的 Python 功能提供功能？`raw_input()`

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-29T07:05:00.897

您是否尝试安装`py-readline`（或`py25-readline`用于 Python 2.5）端口？

此外，在上面的代码片段中，您使用的不是 MacPort python，而是 Apple Python。

MacPort 版本应位于`/opt/local`目录结构中。你应该检查你的路径。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2016-08-14T15:38:39.020

试试`rlwrap`。它应该适用于任何版本的python，通常是任何shell。

`brew install rlwrap`在 Mac OS X 上安装

用法为`rlwrap python`。它也存储历史。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-11-29T06:29:39.330

由于许可问题（GPL 给您带来的限制），它没有在 OS X 中发布。

如果你安装了 readline 包，Macports python 应该没问题。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-07-11T23:05:09.410

您应该能够在 Mac 的本机 Python 上获得 readline 支持。显然它是通过 BSD 的编辑线实现的，您必须以稍微不同的方式启动它。我刚刚在 Mac 上进行了测试，它运行良好（OS X 10.5.7）。有关`man python`更多详细信息，请参阅“交互式输入编辑和历史替换”部分 -[在此处反映在网络上](http://developer.apple.com/documentation/Darwin/Reference/ManPages/man1/python.1.html)。

```
luga ~ $ python 
Python 2.5.1 (r251:54863, Feb  6 2009, 19:02:12) 
[GCC 4.0.1 (Apple Inc. build 5465)] on darwin
Type "help", "copyright", "credits" or "license" for more information.
>>> import rlcompleter
>>> import readline
>>> 
```

# selenium - 在 Selenium 中，如何关闭日志记录？

> ID：327252
> 
> 赞同：3
> 
> 时间：2008-11-29T06:18:50.587
> 
> 标签：selenium

我正在使用以下方法：

```
set_browser_log_level 'off' 
```

但我的日志级别继续包含信息。

当我的测试输入登录密码时，我试图抑制日志记录和“最后 4 个命令”显示。

[http://release.seleniumhq.org/selenium-remote-control/0.9.2/doc/ruby/classes/Selenium/SeleniumDriver.html#M000128](http://release.seleniumhq.org/selenium-remote-control/0.9.2/doc/ruby/classes/Selenium/SeleniumDriver.html#M000128)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-29T07:17:17.567

我建议您切换到最新版本，即使它被称为 beta。这些 Selenium 家伙有奇怪的版本号。看看是否有帮助。

# asp.net - 我可以在 Windows XP 上编写 .aspx 应用程序吗？

> ID：327272
> 
> 赞同：0
> 
> 时间：2008-11-29T06:42:40.287
> 
> 标签：asp.net

我打算在 Windows XP 机器上写一个 aspx 页面。我启用了 IIS 7.0 并设置了虚拟目录。Win XP 是否允许进行 aspx 页面开发？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-29T06:56:20.353

是的，您可以在 Windows XP 上开发 ASP.NET 页面 (.aspx)。XP 只运行 IIS 5.1，但是您甚至不需要安装 IIS，因为 Visual Web Developer Express 有一个内置的 Web 服务器，您可以在开发过程中使用。要开始使用，我会去[http://www.microsoft。 com/express/](http://www.microsoft.com/express/)并下载 Microsoft Visual Web Developer Express。完成之后，访问[http://www.asp.net/get-started/](http://www.asp.net/get-started/)学习基础知识。在 StackOverflow 上发布您遇到的任何问题或问题。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-01T01:59:29.720

新的 Web 平台安装程序现在支持 XP：

[http://www.microsoft.com/web/channel/products/WebPlatformInstaller.aspx](http://www.microsoft.com/web/channel/products/WebPlatformInstaller.aspx)

# php - 具有可变大小变量列表的 MySQL 准备语句

> ID：327274
> 
> 赞同：25
> 
> 时间：2008-11-29T06:43:23.157
> 
> 标签：php, sql, mysql, prepared-statement

你将如何在 PHP 中编写一个准备好的 MySQL 语句，它每次都需要不同数量的参数？此类查询的一个示例是：

```
SELECT `age`, `name` FROM `people` WHERE id IN (12, 45, 65, 33) 
```

该子句每次运行时`IN`都会有不同数量的s。`id`

我有两种可能的解决方案，但想看看是否有更好的方法。

**可能的解决方案 1**使语句接受 100 个变量，并用保证不在表中的虚拟值填充其余变量；多次调用超过 100 个值。

**可能的解决方案 2**不要使用准备好的语句；为可能的注入攻击构建和运行查询检查。

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-11-29T09:36:05.837

我可以想到几个解决方案。

一种解决方案可能是创建一个临时表。为 in 子句中的每个参数插入表中。然后对你的临时表做一个简单的连接。

另一种方法可能是做这样的事情。

```
$dbh=new PDO($dbConnect, $dbUser, $dbPass);
$parms=array(12, 45, 65, 33);
$parmcount=count($parms);   // = 4
$inclause=implode(',',array_fill(0,$parmcount,'?')); // = ?,?,?,?
$sql='SELECT age, name FROM people WHERE id IN (%s)';
$preparesql=sprintf($sql,$inclause);  // = example statement used in the question
$st=$dbh->prepare($preparesql);
$st->execute($parms); 
```

我怀疑但没有证据表明第一个解决方案可能更适合较大的列表，而后者适用于较小的列表。

* * *

为了让@orrd 开心，这里有一个简洁的版本。

```
$dbh=new PDO($dbConnect, $dbUser, $dbPass);
$parms=array(12, 45, 65, 33);
$st=$dbh->prepare(sprintf('SELECT age, name FROM people WHERE id IN (%s)',
                          implode(',',array_fill(0,count($parms),'?'))));
$st->execute($parms); 
```

* * *

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2012-06-10T09:39:36.797

还有一个[`FIND_IN_SET`函数](http://dev.mysql.com/doc/refman/5.6/en/string-functions.html#function_find-in-set)，其第二个参数是一串逗号分隔值：

```
SELECT age, name FROM people WHERE FIND_IN_SET(id, '12,45,65,33') 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-11-29T09:55:41.083

体面的 sql 包装器支持绑定到数组值。IE

```
$sql = "... WHERE id IN (?)";
$values = array(1, 2, 3, 4);
$result = $dbw -> prepare ($sql, $values) -> execute (); 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-29T09:47:51.210

请把#2 从桌子上拿下来。准备好的语句是您应该考虑保护自己免受 SQL 注入的唯一方法。

但是，您可以做的是生成一组动态的绑定变量。即，如果您需要 7 个（或 103 个），就不要赚 100 个。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-01-18T19:27:14.897

我的答案来自：[http](http://bugs.php.net/bug.php?id=43568)
://bugs.php.net/bug.php?id=43568 这是我解决问题的有效方法。现在我可以根据需要动态使用任意数量的参数。它们将与我在数组中的数字相同，或者在这种情况下，我将最后一个查询（找到 email = 'johndoe@gmail.com' 的所有 id）中的 id 传递给动态查询以获取所有无论我最终需要多少，关于这些 id 的信息。

```
<?php $NumofIds = 2; //this is the number of ids i got from the last query
    $parameters=implode(',',array_fill(0,$NumofIds,'?')); 
    // = ?,? the same number of ?'s as ids we are looking for<br />
    $paramtype=implode('',array_fill(0,$NumofIds,'i')); // = ii<br/>
    //make the array to build the bind_param function<br/>
    $idAr[] = $paramtype; //'ii' or how ever many ?'s we have<br/>
    while($statement->fetch()){ //this is my last query i am getting the id out of<br/>
        $idAr[] = $id;  
    }

    //now this array looks like this array:<br/>
    //$idAr = array('ii', 128, 237);

    $query = "SELECT id,studentid,book_title,date FROM contracts WHERE studentid IN ($parameters)";
    $statement = $db->prepare($query);
    //build the bind_param function
    call_user_func_array (array($statement, "bind_param"), $idAr);
    //here is what we used to do before making it dynamic
    //statement->bind_param($paramtype,$v1,$v2);
    $statement->execute();
?> 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-29T10:02:04.207

如果您只在`IN`子句中使用整数值，那么没有什么可以反对在不使用 SQL 参数的情况下动态构建查询。

```
function convertToInt(&$value, $key)
{
    $value = intval($value);
}

$ids = array('12', '45', '65', '33');
array_walk($ids, 'convertToInt');
$sql = 'SELECT age, name FROM people WHERE id IN (' . implode(', ', $ids) . ')';
// $sql will contain  SELECT age, name FROM people WHERE id IN (12, 45, 65, 33) 
```

但毫无疑问，[这里](https://stackoverflow.com/questions/327274/mysql-prepared-statements-with-a-variable-size-variable-list#327384)的解决方案是解决这个问题的更一般的方法。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2014-01-17T10:35:14.460

我今天有一个类似的问题，我发现了这个话题。查看答案并在谷歌周围搜索，我找到了一个很好的解决方案。

虽然，我的问题有点复杂。**因为我也有固定的绑定值和动态**的。

这就是解决方案。

```
$params = array()
$all_ids = $this->get_all_ids();

for($i = 0; $i <= sizeof($all_ids) - 1; $i++){
    array_push($params, $all_ids[$i]['id']);
}

$clause = implode(',', array_fill(0, count($params), '?')); // output ?, ?, ?
$total_i = implode('', array_fill(0, count($params), 'i')); // output iiii

$types = "ss" . $total_i; // will reproduce : ssiiii ..etc

// %% it's necessary because of sprintf function
$query = $db->prepare(sprintf("SELECT * 
                                FROM clients    
                                WHERE name LIKE CONCAT('%%', ?, '%%') 
                                AND IFNULL(description, '') LIKE CONCAT('%%', ?, '%%')
                                AND id IN (%s)", $clause));

$thearray = array($name, $description);
$merge    = array_merge($thearray, $params); // output: "John", "Cool guy!", 1, 2, 3, 4

// We need  to pass variables instead of values by reference
// So we need a function to that
call_user_func_array('mysqli_stmt_bind_param', array_merge (array($query, $types), $this->makeValuesReferenced($merge))); 
```

和**函数 makeValuesreferenced**：

```
public function makeValuesReferenced($arr){
    $refs = array();
    foreach($arr as $key => $value)
        $refs[$key] = &$arr[$key];
    return $refs;
} 
```

获取此“诀窍”的链接：[https](https://bugs.php.net/bug.php?id=49946) ://bugs.php.net/bug.php?id=49946 ，[PHP 将一个数组附加到另​​一个数组（不是 array_push 或 +）](https://stackoverflow.com/questions/4268871/php-append-one-array-to-another-not-array-push-or)，[[PHP]：错误 -> 太少sprintf() 中的参数；](https://stackoverflow.com/questions/1620165/php-error-too-few-arguments-in-sprintf), [http://no2.php.net/manual/en/mysqli-stmt.bind-param.php#89171](http://no2.php.net/manual/en/mysqli-stmt.bind-param.php#89171) , [PHP 5.3.1 的引用传递问题](https://stackoverflow.com/questions/2045875/pass-by-reference-problem-with-php-5-3-1)

# iphone - UITextField 将不间断空格转换为空格？

> ID：327283
> 
> 赞同：4
> 
> 时间：2008-11-29T06:55:56.580
> 
> 标签：iphone, cocoa-touch

似乎 UITextFields 将所有[不间断空格](http://en.wikipedia.org/wiki/Non-breaking_space)（nbsp，U+00A0）转换为[空格](http://en.wikipedia.org/wiki/Space_character)（U+0020）。这会导致编辑区域设置特定数字的问题。例如，在法语/法国语言环境中，不间断空格将 1 和 % 分隔成“1 %”。但是，由于 UITextField 将分隔符转换为空格，因此区域设置感知的 NSNumberFormatter 无法解析区域设置字符串并将其转换为数字。

下面的代码片段说明了这个问题。

```
NSLocale *fr_FR = [[[NSLocale alloc] initWithLocaleIdentifier:@"fr_FR"] autorelease];

NSNumberFormatter *percentageFormatter = [[NSNumberFormatter alloc] init];
[percentageFormatter setFormatterBehavior:NSNumberFormatterBehavior10_4];
[percentageFormatter setGeneratesDecimalNumbers:TRUE];
[percentageFormatter setNumberStyle:NSNumberFormatterPercentStyle];
[percentageFormatter setLocale:fr_FR];

NSDecimalNumber *one = [NSDecimalNumber decimalNumberWithString:@"0.01"];

// will be "1 %" where the separator character is a nbsp (this is correct)
NSString *percentage = [percentageFormatter stringFromNumber:one];

UITextField *textField = [[UITextField alloc] init];
textField.text = percentage;

// will be "1 %" where the separator character is a space (this is wrong)
NSString *textFieldValue = textField2.text;

// returns an indeterminate value: may throw an exception, may return nil, etc
// this should return the number 0.01
NSNumber *percentageNumber = [percentageFormatter numberFromString:textFieldValue]; 
```

**我的问题：如何防止 UITextField 将不间断空格转换为空格？**

我了解我可以采用的解决方法来破解它，以便如果我在使用不间断空格的语言环境中它可以工作。但是，如果我不知道 UITextField 的属性/行为来保留 nbsp，我想知道。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-01T09:04:02.140

我很确定这个功能不存在。如何打开 iPhone 的错误报告？

# c# - 希望关于在 C# 中修改字典的简单问题

> ID：327286
> 
> 赞同：0
> 
> 时间：2008-11-29T07:00:08.460
> 
> 标签：c#, .net, dictionary

我在一个名为 current 的变量中有一个巨大的空白值字典，如下所示：

```
struct movieuser {blah blah blah}
Dictionary<movieuser, float> questions = new Dictionary<movieuser, float>(); 
```

所以我正在遍历这本字典，需要填写“答案”，如下所示：

```
for(var k = questions.Keys.GetEnumerator();k.MoveNext(); )
{
    questions[k.Current] = retrieveGuess(k.Current.userID, k.Current.movieID);
} 
```

现在，这不起作用，因为我尝试修改正在循环的字典时得到了 InvalidOperationException。但是，您可以看到代码应该可以正常工作 - 因为我没有添加或删除任何值，只是修改了值。但是，我理解为什么它害怕我尝试这样做。

这样做的首选方法是什么？在不使用迭代器的情况下，我想不出一种方法来遍历字典。

我真的不想创建整个数组的副本，因为它包含大量数据并且会像感恩节一样吃掉我的内存。

谢谢，戴夫

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-29T07:04:49.090

有什么理由不能同时用键和值填充字典吗？

```
foreach(var key in someListOfKeys)
{
    questions.Add(key, retrieveGuess(key.userID, key.movieID);
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-29T07:36:08.793

马特的回答，首先获得钥匙，分开是正确的方法。是的，会有一些冗余——但它会起作用。我会采用一个易于调试和维护的工作程序，而不是一个无法工作或任何一天都难以维护的高效程序。

不要忘记，如果你创建`MovieUser`一个引用类型，那么数组的大小只会与你拥有的用户数量一样多——这非常小。一百万用户在 x64 上只会占用 4MB 或 8MB。你真的有多少用户？

因此，您的代码应类似于：

```
IEnumerable<MovieUser> users = RetrieveUsers();

IDictionary<MovieUser, float> questions = new Dictionary<MovieUser, float>();
foreach (MovieUser user in users)
{
    questions[user] = RetrieveGuess(user);
} 
```

如果您使用的是 .NET 3.5（因此可以使用 LINQ），那就更简单了：

```
IDictionary<MovieUser, float> questions = 
    RetrieveUsers.ToDictionary(user => user, user => RetrieveGuess(user)); 
```

请注意，如果`RetrieveUsers()`可以从其源（例如文件）流式传输用户列表，那么无论如何它将是有效的，因为您在填充字典时一次不需要知道多个用户。

对其余代码的一些评论：

*   代码约定很重要。将类型和方法的名称大写以适应其他 .NET 代码。
*   你不是在调用`Dispose`由`IEnumerator<T>`调用产生的`GetEnumerator`. 如果你只使用`foreach`你的代码会更简单*，*更安全。
*   `MovieUser`几乎可以肯定是一个类。你真的有充分的理由让它成为一个结构吗？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-29T07:06:10.723

将字典键存储在临时集合中，然后遍历临时集合并将键值用作索引器参数。这应该让你绕过异常。

# c# - 如何使 ListBox 中的某些项目变为粗体？

> ID：327310
> 
> 赞同：17
> 
> 时间：2008-11-29T07:34:49.527
> 
> 标签：c#, .net, visual-studio, listbox

在 Visual c# Express Edition 中，是否可以将 ListBox 中的某些（但不是全部）项目设为粗体？我在 API 中找不到任何类型的选项。

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2008-11-29T07:51:26.967

您需要将列表框的 DrawMode 更改为 DrawMode.OwnerDrawFixed。查看 msdn 上的这些文章：
[DrawMode Enumeration](http://msdn.microsoft.com/en-us/library/system.windows.forms.drawmode.aspx)
[ListBox.DrawItem Event](http://msdn.microsoft.com/en-us/library/system.windows.forms.listbox.drawitem.aspx)
[Graphics.DrawString Method](http://msdn.microsoft.com/en-us/library/19sb1bw6.aspx)

还可以在 msdn 论坛上查看这个问题：
[关于 ListBox 项目的问题](http://social.msdn.microsoft.com/Forums/en-US/vbgeneral/thread/dacea8cd-963e-4a40-9af6-1495acf1d3c5/)

一个简单的例子（两个项目 - Black-Arial-10-Bold）：

```
 public partial class Form1 : Form
 {
    public Form1()
    {
        InitializeComponent();

        ListBox1.Items.AddRange(new Object[] { "First Item", "Second Item"});
        ListBox1.DrawMode = DrawMode.OwnerDrawFixed;
    }

    private void ListBox1_DrawItem(object sender, DrawItemEventArgs e)
    {
        e.DrawBackground();
        e.Graphics.DrawString(ListBox1.Items[e.Index].ToString(), new Font("Arial", 10, FontStyle.Bold), Brushes.Black, e.Bounds);
        e.DrawFocusRectangle();
    }
 } 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2014-03-26T18:14:56.727

为了增加 Mindaugas Mozūras 的解决方案，我遇到了一个问题，即我`e.Bounds`的尺寸不够大并且文本被截断。为了解决这个问题（感谢[这里](http://arstechnica.com/civis/viewtopic.php?f=20&t=314206)的帖子），您覆盖`OnMeasureItem`事件并将 DrawMode 更改为`DrawMode.OwnerDrawVariable`.

在设计师：

```
listBox.DrawMode = DrawMode.OwnerDrawVariable; 
```

在处理程序中：

```
void listBox_MeasureItem(object sender, MeasureItemEventArgs e)
{
     e.ItemHeight = 18;
} 
```

解决了我的高度切断文本的问题。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2015-10-01T01:06:31.820

一个更通用的示例，它使用 sender，并且实际上尊重前景色（例如，如果选择了项目，或者用户使用了另一种颜色集，其中黑色前景色不是真正可读的）和当前 ListBox 字体：

```
 private void listBoxDrawItem (object sender, DrawItemEventArgs e)
    {
        Font f = e.Font;
        if (e.Index == 1) //TODO: Your condition to make text bold
            f = new Font(e.Font, FontStyle.Bold);
        e.DrawBackground();
        e.Graphics.DrawString(((ListBox)(sender)).Items[e.Index].ToString(), f, new SolidBrush(e.ForeColor), e.Bounds);
        e.DrawFocusRectangle();
    } 
```

您需要将 DrawMode 设置为 OwnerDrawFixed（例如，在设计器中）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-12-09T11:19:56.893

以下是演示相同的代码。

```
using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Data;
using System.Drawing;
using System.Linq;
using System.Text;
using System.Windows.Forms;

namespace WindowsFormsApplication2
{
    public partial class Form1 : Form
    {
        public Form1()
        {
            InitializeComponent();
        }

        private void Form1_Load(object sender, EventArgs e)
        {
            foreach (FontFamily fam in FontFamily.Families)
            {
                listBox1.Items.Add(fam.Name);
            }
            listBox1.DrawMode = DrawMode.OwnerDrawFixed; // 属性里设置

        }

        private void listBox1_DrawItem(object sender, DrawItemEventArgs e)
        {
            e.DrawBackground();
            e.Graphics.DrawString(listBox1.Items[e.Index].ToString(), new Font(listBox1.Items[e.Index].ToString(), listBox1.Font.Size), Brushes.Black, e.Bounds);
            //e.DrawFocusRectangle();
        }
    }
} 
```

![样本输出](https://i.stack.imgur.com/HsBKz.png)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2017-05-24T19:55:49.450

使所选项目加粗

```
public partial class Form1 : Form
{
    public Form1()
    {
        InitializeComponent();

        ListBox1.Items.AddRange(new Object[] { "me", "myself", "bob"});

        // set the draw mode to fixed
        ListBox1.DrawMode = DrawMode.OwnerDrawFixed;
    }

    private void ListBox1_DrawItem(object sender, DrawItemEventArgs e)
    {
        // draw the background
        e.DrawBackground();

        // get the font
        Font font = new Font(e.Font, (e.State & DrawItemState.Selected) == DrawItemState.Selected ? FontStyle.Bold : FontStyle.Regular);

        // draw the text
        e.Graphics.DrawString(ListBox1.Items[e.Index].ToString(), font, new SolidBrush(ListBox1.ForeColor), e.Bounds);

        e.DrawFocusRectangle();
    }
} 
```

# python - Python 的内置字典是如何实现的？

> ID：327311
> 
> 赞同：377
> 
> 时间：2008-11-29T07:35:31.163
> 
> 标签：python, data-structures, dictionary

有谁知道python的内置字典类型是如何实现的？我的理解是它是某种哈希表，但我无法找到任何明确的答案。

* * *

## 回答 #1

> 赞同：652
> 
> 时间：2012-01-26T17:52:00.447

这是我能够汇总的有关 Python dicts 的所有内容（可能比任何人都想知道的要多；但答案很全面）。

*   Python 字典被实现为**哈希表**。

*   散列表必须允许**散列冲突**，即即使两个不同的键具有相同的散列值，表的实现也必须具有明确地插入和检索键和值对的策略。

*   Python`dict`使用**开放寻址**来解决哈希冲突（如下所述）（参见[dictobject.c:296-297](http://hg.python.org/cpython/file/52f68c95e025/Objects/dictobject.c#l296)）。

*   Python 哈希表只是一个连续的内存块（有点像一个数组，所以你可以`O(1)`按索引进行查找）。

*   **表中的每个槽可以存储一个且仅一个条目。**这个很重要。

*   表中的每个**条目**实际上是三个值的组合：**< hash, key, value >**。这是作为 C 结构实现的（参见[dictobject.h:51-56](http://hg.python.org/cpython/file/52f68c95e025/Include/dictobject.h#l51)）。

*   下图是 Python 哈希表的逻辑表示。在下图中，`0, 1, ..., i, ...`左侧是哈希表中**槽**的索引（它们仅用于说明目的，显然不与表一起存储！）。

    ```
     # Logical model of Python Hash table
      -+-----------------+
      0| <hash|key|value>|
      -+-----------------+
      1|      ...        |
      -+-----------------+
      .|      ...        |
      -+-----------------+
      i|      ...        |
      -+-----------------+
      .|      ...        |
      -+-----------------+
      n|      ...        |
      -+-----------------+ 
    ```

*   当一个新的 dict 被初始化时，它以 8*个 slot*开始。（见[dictobject.h:49](http://hg.python.org/cpython/file/52f68c95e025/Include/dictobject.h#l49)）

*   在向表中添加条目时，我们从某个插槽 开始`i`，它基于键的哈希值。CPython 最初使用`i = hash(key) & mask`(where `mask = PyDictMINSIZE - 1`，但这并不重要)。请注意，`i`检查的初始插槽 取决于密钥的*哈希值*。

*   如果该插槽为空，则将条目添加到插槽中（通过条目，我的意思是，`<hash|key|value>`）。但是如果那个插槽被占用了怎么办！？很可能是因为另一个条目具有相同的哈希（哈希冲突！）

*   如果插槽被占用，CPython（甚至 PyPy）会将插槽中条目的哈希和**键**（通过比较我`==`的意思是比较而不是`is`比较）与要插入的当前条目的哈希和键（[dictobject.c ）进行比较:337,344-345](http://hg.python.org/cpython/file/52f68c95e025/Objects/dictobject.c#l337) ) 分别。如果*两者都*匹配，则认为该条目已经存在，放弃并继续插入下一个条目。如果散列或密钥不匹配，则开始**探测**。

*   探测只是意味着它按插槽搜索插槽以找到一个空插槽。从技术上讲，我们可以一个一个地进行，`i+1, i+2, ...`并使用第一个可用的（即线性探测）。但是由于注释中解释得很清楚的原因（参见[dictobject.c:33-126](http://hg.python.org/cpython/file/52f68c95e025/Objects/dictobject.c#l33)），CPython 使用**随机探测**。在随机探测中，以伪随机顺序选择下一个槽。该条目被添加到第一个空槽。对于本次讨论，用于选择下一个插槽的实际算法并不重要（有关探测算法，请参见[dictobject.c:33-126](http://hg.python.org/cpython/file/52f68c95e025/Objects/dictobject.c#l33)）。重要的是探测槽直到找到第一个空槽。

*   查找也会发生同样的事情，只是从初始槽 i 开始（其中 i 取决于键的哈希）。如果散列和键都与槽中的条目不匹配，它开始探测，直到找到匹配的槽。如果所有插槽都用尽，则报告失败。

*   顺便说一句，`dict`如果三分之二已满，则会调整大小。这样可以避免减慢查找速度。（见[dictobject.h:64-65](http://hg.python.org/cpython/file/52f68c95e025/Include/dictobject.h#l64)）

注意：我对 Python Dict 实现进行了研究，以回答我自己[关于](https://stackoverflow.com/questions/9010222/)dict 中的多个条目如何具有相同的哈希值的问题。我在这里发布了一个稍微编辑过的回复版本，因为所有研究都与这个问题非常相关。

* * *

## 回答 #2

> 赞同：100
> 
> 时间：2017-06-12T21:54:15.970

> Python 的内置字典是如何实现的？

这是短期课程：

*   它们是哈希表。（有关 Python 实现的详细信息，请参见下文。）
*   从 Python 3.6 开始，一种新的布局和算法使它们
    *   按插入键排序，和
    *   占用更少的空间，
    *   几乎没有性能成本。
*   当 dicts 共享键时（在特殊情况下），另一个优化可以节省空间。

从 Python 3.6 开始，有序方面是非官方的（让其他实现有机会跟上），但[在 Python 3.7 中是官方的](https://mail.python.org/pipermail/python-dev/2017-December/151283.html)。

## Python 的字典是哈希表

很长一段时间，它的工作原理就是这样。Python 将预先分配 8 个空行并使用哈希来确定键值对的粘贴位置。例如，如果键的散列以 001 结尾，它会将其粘贴在第 1（即第 2）索引中（如下例所示。）

```
 <hash>       <key>    <value>
     null        null    null
...010001    ffeb678c    633241c4 # addresses of the keys and values
     null        null    null
      ...         ...    ... 
```

在 64 位架构上，每行占用 24 个字节，在 32 位架构上占用 12 个字节。（请注意，这里的列标题只是用于我们目的的标签 - 它们实际上并不存在于内存中。）

如果散列与先前存在的键的散列结束相同，则这是一个冲突，然后它将键值对粘贴在不同的位置。

存储5个key-value后，再添加一个key-value对时，hash冲突的概率太大，所以字典的大小翻了一番。在 64 位进程中，在调整大小之前，我们有 72 个字节是空的，之后，由于 10 个空行，我们浪费了 240 个字节。

这会占用大量空间，但查找时间相当恒定。密钥比较算法是计算哈希，转到预期位置，比较密钥的 id - 如果它们是同一个对象，它们是相等的。如果不是，则比较哈希值，如果它们*不*相同，则它们不相等。否则，我们最后比较键是否相等，如果相等，则返回值。相等性的最终比较可能会很慢，但较早的检查通常会缩短最终比较，从而使查找非常快。

碰撞会减慢速度，理论上攻击者可以使用哈希冲突来执行拒绝服务攻击，因此我们随机初始化哈希函数，以便它为每个新的 Python 进程计算不同的哈希。

上面描述的浪费空间导致我们修改了字典的实现，一个令人兴奋的新功能是字典现在按插入排序。

## 新的紧凑哈希表

相反，我们首先为插入的索引预分配一个数组。

由于我们的第一个键值对位于第二个槽中，我们这样索引：

```
[null, 0, null, null, null, null, null, null] 
```

我们的表格只是按插入顺序填充：

```
 <hash>       <key>    <value>
...010001    ffeb678c    633241c4 
      ...         ...    ... 
```

所以当我们查找一个键时，我们使用哈希来检查我们期望的位置（在这种情况下，我们直接到数组的索引 1），然后到哈希表中的那个索引（例如索引 0 )，检查键是否相等（使用前面描述的相同算法），如果是，则返回值。

我们保留了恒定的查找时间，在某些情况下速度损失很小，而在其他情况下速度有所提高，与先前存在的实现相比，我们节省了相当多的空间，并且我们保留了插入顺序。唯一浪费的空间是索引数组中的空字节。

Raymond Hettinger 于 2012 年 12 月在[python-dev上介绍了这一点。它最终在](https://mail.python.org/pipermail/python-dev/2012-December/123028.html)[Python 3.6](https://docs.python.org/3/whatsnew/3.6.html#new-dict-implementation)中进入了 CPython 。按插入排序被认为是 3.6 的实现细节，以允许 Python 的其他实现有机会赶上。

## 共享密钥

另一个节省空间的优化是共享密钥的实现。因此，我们不再拥有占据所有空间的冗余字典，而是拥有重复使用共享键和键的哈希值的字典。你可以这样想：

```
 hash         key    dict_0    dict_1    dict_2...
...010001    ffeb678c    633241c4  fffad420  ...
      ...         ...    ...       ...       ... 
```

对于 64 位机器，这可以为每个额外字典的每个键节省多达 16 个字节。

## 自定义对象和替代品的共享密钥

这些共享密钥字典旨在用于自定义对象`__dict__`。要获得这种行为，我相信您需要`__dict__`在实例化下一个对象之前完成填充（[参见 PEP 412](https://www.python.org/dev/peps/pep-0412/)）。这意味着您应该在`__init__`or中分​​配所有属性`__new__`，否则您可能无法节省空间。

但是，如果您在`__init__`执行时知道所有属性，您还可以提供`__slots__`您的对象，并保证`__dict__`根本没有创建它（如果在父母中不可用），甚至允许`__dict__`但保证您预见的属性是无论如何都存储在插槽中。有关更多信息`__slots__`，[请在此处查看我的回答](https://stackoverflow.com/q/472000/541136)。

## 也可以看看：

*   [PEP 509](https://www.python.org/dev/peps/pep-0509/) -- 向 dict 添加私有版本
*   [PEP 468](https://www.python.org/dev/peps/pep-0468/) -- 保留`**kwargs`函数中的顺序。
*   [PEP 520](https://www.python.org/dev/peps/pep-0520/) - 保留类属性定义顺序
*   [PyCon 2010: The Might Dictionary](https://www.youtube.com/watch?v=C4Kc8xzcA68) - Brandon Rhodes
*   [PyCon 2017：更强大的词典](https://www.youtube.com/watch?v=66P5FMkWoVU)- Brandon Rhodes
*   [PyCon 2017：现代 Python 词典融合了十几个伟大的想法](https://www.youtube.com/watch?v=npw4s1QTmPg)- Raymond Hettinger
*   [dictobject.c](https://github.com/python/cpython/blob/master/Objects/dictobject.c) - CPython 在 C 中的实际 dict 实现。

* * *

## 回答 #3

> 赞同：53
> 
> 时间：2010-06-08T11:00:37.887

Python 字典使用[开放寻址](http://en.wikipedia.org/wiki/Hash_table#Open_addressing)（[参考美丽的代码](http://books.google.co.in/books?id=gJrmszNHQV4C&lpg=PP1&hl=sv&pg=PA298#v=onepage&q&f=false)）

**注意！** *如维基百科中所述，开放寻址*，也称为*封闭散列*，不应与其相反的*开放散列混淆！*

开放寻址意味着字典使用数组槽，当对象的主要位置在字典中时，使用“扰动”方案在同一数组中的不同索引处寻找对象的位置，其中对象的哈希值起作用.

# xcode - Xcode自动完成 - 替换文本击键？

> ID：327314
> 
> 赞同：8
> 
> 时间：2008-11-29T07:37:13.423
> 
> 标签：xcode, autocomplete

假设我们有一个带有 2 个方法的 TestClass`-getSomeString`和`-getAnotherString`，我们正在编辑以下代码，光标位于所示位置：

```
NSString *aString = [TestClass get<cursorIsHere>SomeString]; 
```

说我想把它改成使用`-getAnotherString`. 如果我调出自动完成弹出窗口并通过按 Enter 或 Tab 选择其他方法，我将得到：

```
NSString *aString = [TestClass getAnotherStringSomeString]; 
```

即，它不会替换现有文本，而只是插入。

是否有特殊的击键可以使其替换剩余的文本？

请参阅 IntelliJ 以供参考。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-18T18:02:14.947

我认为没有一步操作可以实现这一目标。我的建议与 Thomas Templemann 类似，但不是两步向前选择单词然后删除，而是通过在**Control + 上弹跳来扩展为所需的自动完成。**然后点击**Option + forward delete**，这会杀死单词的末尾。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-16T16:19:03.020

我不这么认为。我一直使用以下

*   双击 getSomeString
*   按 Escape （或您的自动完成键）
*   寻找替代方法

双击步骤从来没有真正困扰过我，但如果有人知道更好，我会很感兴趣！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-18T12:28:06.870

我对这个问题的解决方法是：由于光标将在插入的文本之后，我只需按 Shift-Option-Rightcursor，选择光标后面的单词，然后按 Delete 键。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-12-15T20:50:45.010

从 IntelliJ 9 的自动完成弹出窗口中选择方法时，您可以使用 Tab 键执行“替换”而不是“插入”（不知道它是否在以前的版本中可用）。

# asp.net - LargeData 上基于 Ajax 的仪表板

> ID：327321
> 
> 赞同：1
> 
> 时间：2008-11-29T07:52:02.830
> 
> 标签：asp.net, jquery, asp.net-ajax, dashboard

我正在开发某种 CRM 应用程序，该应用程序具有大量销售数据以及所有客户线索等（ASP.NET 2.0/Ajax）

我想创建一个仪表板，它有四个单独的数据容器，每个容器都有不同类型的数据，每个容器必须在配置的时间间隔后自行更新。所以我只想更新页面的那一部分而不是整个页面

在上述场景中我应该使用什么 asp.net updatePanel 或 jQuery 实现（哪种技术和原因）

因为性能在这里也很重要。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-29T10:31:50.997

在这种情况下，ASP.NET UpdatePanel 或 jQuery（或两者的混合）都可以很好地为您服务；如果您两者都没有经验，我会推荐 UpdatePanel 方式，因为它更接近您习惯的常规 ASP.NET 代码。

[这篇文章](http://msdn.microsoft.com/en-us/library/bb398867.aspx)会让你达到 90%，最后你要做的就是放置一些简单的 javascript 来每隔 X 秒触发一次更新；比如`window.setTimeout("Button1.click()",5000)`如果你想每 5 秒刷新一次面板。如果您不希望用户可以使用该按钮，只需通过 CSS 将其隐藏即可。

还有更优雅的方法（使用 JSON、Web 服务、客户端模板等），但这是完成工作的简单方法。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-29T11:48:42.900

ASP.NET UpdatePanel 易于设置，但根据我的经验，调试起来很糟糕。

使用 jQuery（或其他一些 JS 框架）和 .NET AJAX 库自己做更多的工作是前期工作，但以后更容易改进和维护。

如果您担心的话，UpdatePanel 的流量比您在自己的解决方案中使用的 JSON 大得多。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-08-07T14:28:40.183

您还可以使用[动态仪表板框架](http://www.dynamicdashboards.net)并将更新面板转换为拖放小部件。

它是用于 Asp.Net 的独立于浏览器的 Web 部件框架。

# java - JUnit 没有提供有关“错误”的信息

> ID：327324
> 
> 赞同：18
> 
> 时间：2008-11-29T07:55:41.607
> 
> 标签：java, ant, junit

我正在使用 Junit 4.4 和 Ant 1.7。如果一个测试用例因错误而失败（例如，因为一个方法抛出了意外的异常），我不会得到任何关于错误是什么的详细信息。

我的 build.xml 看起来像这样：

```
<target name="test" depends="compile">
<junit printsummary="withOutAndErr" filtertrace="no" fork="yes" haltonfailure="yes" showoutput="yes">
  <classpath refid="project.run.path"/>
  <test name="a.b.c.test.TestThingee1"/>
  <test name="a.b.c.test.NoSuchTest"/>
</junit>
</target> 
```

当我运行“ant test”时，它显示（例如）2 次测试运行，0 次失败，1 次错误。它没有说“没有像 NoSuchTest 这样的测试”，尽管这是完全合理的，并且会让我找出错误的原因。

谢谢！

-担

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2008-11-29T08:14:14.020

弄清楚了 ：）

我需要在 junit 块内添加一个“格式化程序”。

```
<formatter type="plain" usefile="false" /> 
```

什么皮塔饼。

-担

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-11-29T15:30:10.880

如果您要进行大量测试，则可能需要考虑两个更改：

1.  运行所有测试，而不是在第一个错误处停止
2.  创建显示所有测试结果的报告

使用 junitreport 任务很容易做到：

```
<target name="test">
    <mkdir dir="target/test-results"/>
    <junit fork="true" forkmode="perBatch" haltonfailure="false"
           printsummary="true" dir="target" failureproperty="test.failed">
        <classpath>
            <path refid="class.path"/>
            <pathelement location="target/classes"/>
            <pathelement location="target/test-classes"/>
        </classpath>
        <formatter type="brief" usefile="false" />
        <formatter type="xml" />
        <batchtest todir="target/test-results">
            <fileset dir="target/test-classes" includes="**/*Test.class"/>
        </batchtest>
    </junit>

    <mkdir dir="target/test-report"/>
    <junitreport todir="target/test-report">
        <fileset dir="target/test-results">
            <include name="TEST-*.xml"/>
        </fileset>
        <report format="frames" todir="target/test-report"/>
    </junitreport>

    <fail if="test.failed"/>
</target> 
```

# java - 为什么不建议在 JSP 中使用 JavaScript？

> ID：327325
> 
> 赞同：3
> 
> 时间：2008-11-29T07:55:50.563
> 
> 标签：java, javascript, jsp

为什么不建议在 JSP 中使用 JavaScript？我能想到的一个理由是关闭浏览器中的功能会阻止代码执行。这背后还有其他原因吗？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-11-29T08:40:36.680

Afaik，在 jsp 中使用 javascript 是没有问题的，很多网站都使用它。特别是如果您的网站是一个网络应用程序，您*将*不得不同时使用这两个应用程序。他们是完全独立的。你只需要确保你使用的每一个都是合适的。

至于关于在浏览器中关闭 javascript 使网站无法使用的部分，无论何时使用 javascript，无论是否使用 jsp，都是如此。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-07-24T12:56:27.167

我知道这是一个非常古老的问题，但我想无论如何我都会插嘴。我认为您应该在当前时期使用 javascript，因为它可以提供非常丰富的用户体验，并且使用 jQuery（我个人最喜欢的）、prototype 和 mootools 等 js 库，可以轻松地将 javascript 集成到您的应用程序中。

如果您设计正确的应用程序，您可以添加丰富用户体验的 javascript（并使他们更容易使用您的站点/应用程序），而无需额外的服务器开销和很少的努力。

但是 - 您的网站不应依赖 javascript 来实现功能，因为用户的浏览器可能不支持它。

Javascript 应该不显眼，并为支持它的用户提供更丰富的体验。

这是一篇关于UI和优雅升级的好文章，而不是为用户浏览器的故障而设计。[http://realtech.burningbird.net/javascript/accessibility/gracefully-upgrading](http://realtech.burningbird.net/javascript/accessibility/gracefully-upgrading)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-07-24T14:04:12.990

他的意思是“不要使用 java scriptlets”，这是 <% %> 之间的东西。

最大的原因必须是可维护性和调试性；scriptlet 使一切变得非常困难。

另一方面，如果你实现 taglibs，你可以将任何逻辑提取到一个真正的 java 类中，这很容易调试，你仍然可以在可视化 xml/html 编辑器中打开东西，因为 taglibs 是一个有效的 xml结构体。

现在，在客户端（在 javascript 中）进行验证是个坏主意。用户可以禁用 javascript，甚至可以直接访问 url 来绕过验证，这让您容易受到攻击。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-29T08:06:28.217

JSP 是一种服务器端技术。那就是 - 服务器解析/编译所有信息，然后将其发送到客户端（即您的浏览器）。进而..

如果接收到的数据包含任何 javascript，则浏览器会在其自己的 javascript VM 中解释它，并且服务器早已被遗忘，因为 HTTP 是无状态协议。

考虑到“不推荐 Web 中的 JS”，我不会为此烦恼。大多数网站都广泛使用 JS，因此在客户端关闭它会使它们几乎无用。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-29T15:23:28.443

如果您有很多客户端，那么使用 JavaScript 在客户端上进行计算可能是个好主意。如果你在服务器上做所有事情，你只会浪费客户端浏览器提供的许多处理能力，如果太多的客户端使服务器忙，Java 的速度优势将化为乌有。（感谢*@Subtenante*在评论中指出这一点！）。

但另一方面，在服务器上运行的 Java 比在客户端上运行的 JavaScript 更快，并且它不会受到客户端上冗余代码的影响，用于测试客户端运行哪个浏览器。

不过，正如 trex 指出的那样，JavaScript 有其用途。由于它在客户端上运行，因此它可以在将表单字段发送到服务器之前验证表单字段。

# objective-c - setNeedsDisplay 不工作？

> ID：327326
> 
> 赞同：5
> 
> 时间：2008-11-29T07:56:06.083
> 
> 标签：objective-c, cocoa, drawing, key-value-observing

我在简单的可可应用程序中重绘自定义视图时遇到问题。绘图基于一个简单的 NSSlider 正在更改的参数。但是，尽管我实现了 -setParameter: 和 -parameter 方法并将滑块的值绑定到界面构建器中的该参数，但我似乎无法制作自定义视图来重绘自身。

重绘的代码是这样的：

```
- (void)setParameter:(int)newParameter {
  parameter = newParamter;
  NSLog(@"Updated parameter: %d", parameter);
  [self setNeedsDisplay:YES];
} 
```

尽管视图本身不会重绘，但我确实收到了有关设置新参数的消息。欢迎任何想法！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-29T08:14:49.230

通常的语法是: `[self setNeedsDisplay:YES]`，尽管我认为这意味着同样的事情。您是在实现该`- (void)drawRect:(NSRect)rect`方法，还是使用`drawRect:`超类的方法？

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-12-08T07:17:33.433

对于在使用`NSOpenGLView`子类时遇到此问题的任何人，您可能会忘记`[[self openGLContext] flushBuffer]`在`drawRect:`.

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2011-05-17T10:25:54.843

有时原因很简单：文件的所有者与 UIView 对象没有联系。即它的插座设置不正确。使用 IB、ctrl 按钮和拖动方法 :)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-02-22T15:25:27.117

在 iOS 6 中没有这样的函数可以调用：`setNeedsDisplay:YES`. 我遇到了同样的问题，并提供了这个解决方案：[https](https://stackoverflow.com/a/15027374/1280800) ://stackoverflow.com/a/15027374/1280800 。

希望它会有所帮助。

# ruby-on-rails - 将 DB-ish 查询转换为 Rails ActiveRecord 模型术语是否有意义？

> ID：327337
> 
> 赞同：2
> 
> 时间：2008-11-29T08:14:38.637
> 
> 标签：ruby-on-rails, activerecord

```
mysql> desc categories;
+-------+-------------+------+-----+---------+----------------+
| Field | Type        | Null | Key | Default | Extra          |
+-------+-------------+------+-----+---------+----------------+
| id    | int(11)     | NO   | PRI | NULL    | auto_increment |
| name  | varchar(80) | YES  |     | NULL    |                |
+-------+-------------+------+-----+---------+----------------+

 mysql> desc expenses;
+-------------+---------------+------+-----+---------+----------------+
| Field       | Type          | Null | Key | Default | Extra          |
+-------------+---------------+------+-----+---------+----------------+
| id          | int(11)       | NO   | PRI | NULL    | auto_increment |
| created_at  | datetime      | NO   |     | NULL    |                |
| description | varchar(100)  | NO   |     | NULL    |                |
| amount      | decimal(10,2) | NO   |     | NULL    |                |
| category_id | int(11)       | NO   | MUL | 1       |                |
+-------------+---------------+------+-----+---------+----------------+ 
```

现在我需要这样的前 N ​​个类别...

```
Expense.find_by_sql("SELECT categories.name, sum(amount) as total_amount 
   from expenses 
   join categories on category_id = categories.id 
   group by category_id 
   order by total_amount desc") 
```

但这让我的 Rails 良心耿耿于怀.. 似乎可以通过 Expense.find 并提供诸如 :group、:joins 之类的选项来实现相同的目标。

*   有人可以将此查询翻译成 ActiveRecord 模型吗？
*   值得吗...就我个人而言，我发现 SQL 更具可读性并且可以更快地完成我的工作。也许因为我仍在学习 Rails。不在源代码中嵌入 SQL 有什么好处（除了不能更改数据库供应商..sql 风格等）？
*   似乎`find_by_sql`没有像`find`. 解决方法是什么？例如，如果我想将记录数限制为用户指定的限制。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-29T14:27:35.607

```
Expense.find(:all,
  :select => "categories.name name, sum(amount) total_amount",
  :joins => "categories on category_id = categories.id",
  :group => "category_id",
  :order => "total_amount desc") 
```

希望有帮助！

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-29T16:47:51.440

> 似乎 find_by_sql 没有像 find 这样的绑定变量规定。

确实如此。（来自 Rails[文档](http://api.rubyonrails.com/)）

```
# You can use the same string replacement techniques as you can with ActiveRecord#find
  Post.find_by_sql ["SELECT title FROM posts WHERE author = ? AND created > ?", author_id, start_date] 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-30T12:04:12.057

好吧，这是最终对我有用的代码..（弗朗索瓦..生成的 sql stmt 缺少 join 关键字）

```
def Expense.get_top_n_categories options={}
    #sQuery = "SELECT categories.name, sum(amount) as total_amount 
    #   from expenses 
    #   join categories on category_id = categories.id 
    #   group by category_id 
    #   order by total_amount desc";
    #sQuery += " limit #{options[:limit].to_i}" if !options[:limit].nil?
    #Expense.find_by_sql(sQuery)
    query_options = {:select => "categories.name name, sum(amount) total_amount",
        :joins => "inner join categories on category_id = categories.id",
        :group => "category_id",
        :order => "total_amount desc"}
    query_options[:limit] = options[:limit].to_i if !options[:limit].nil?
    Expense.find(:all, query_options)
  end 
```

find_by_sql 确实有 rails 绑定变量...我不知道我是如何忽略它的。最后，上述用户指定的使用是 sql-injection 的潜在入口点，还是 to_i 方法调用阻止了这种情况？

感谢所有的帮助。我很感激。

# c - MATLAB“C”DLL 错误

> ID：327347
> 
> 赞同：2
> 
> 时间：2008-11-29T08:28:13.773
> 
> 标签：c, dll, matlab

我正在将一些 MATLAB 函数编译成 C DLL。导出的`mlf`函数返回一个布尔值，表示函数是否成功。当返回值为false时，我想找出错误信息。我找不到办法做到这一点！（除了编译和导出`lasterror()`函数）。

是否有 C 接口来获取 MATLAB 运行时生成的最后一个错误？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-12T13:59:57.343

好吧，让我们试试……

[**mexCallMATLABWithTrap**](http://www.mathworks.com/help/techdoc/apiref/mexcallmatlabwithtrap.html)（C 和 Fortran） - 调用 MATLAB 函数、用户定义的 M 文件或 MEX 文件并捕获错误信息

```
#include "mex.h"

mxArray *mexCallMATLABWithTrap(int nlhs, mxArray *plhs[], int nrhs, const mxArray *prhs[], const char *functionName); 
```

和

[**mexEvalStringWithTrap**](http://www.mathworks.com/help/techdoc/apiref/mexevalstringwithtrap.html)（C 和 Fortran）- 在调用者的工作区执行 MATLAB 命令并捕获错误信息

```
#include "mex.h"

mxArray *mexEvalStringWithTrap(const char *command); 
```

这两件事是通过谷歌和一两个猜测找到的。对不起，如果这是浪费时间。

# .net - .net 中的无锁结构

> ID：327358
> 
> 赞同：5
> 
> 时间：2008-11-29T08:46:52.860
> 
> 标签：.net, concurrency, lock-free, task-parallel-library

我是 .net 的新手，想知道 .net 是否具有 Java 等效的 AtomicInteger、ConcurrentLinkedQueue 等？

我做了一些搜索，但什么也想不出来。

无锁算法需要某种 CAS 指令，它是通过 Java 中未记录的 Unsafe 类提供的，.net 有什么等价的吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-29T09:05:05.290

在 .NET 中有 Interlocked 类，具有静态方法 Interlocked.Increment() 和 Interlocked.Decrement()。

请参阅[http://msdn.microsoft.com/en-us/library/system.threading.interlocked.aspx](http://msdn.microsoft.com/en-us/library/system.threading.interlocked.aspx)。

您还将在 System.Threading 命名空间中找到其他原子 och 同步结构。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-29T09:22:16.847

我在 .Net 中编写了大量无锁不可变集合结构。这包括二叉树、地图、数组、链表等......源代码和二进制文件可在代码库中找到

[咆哮包](http://code.msdn.microsoft.com/RantPack)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-29T09:18:54.077

Interlocked 类具有执行简单原子操作（如递增、递减、比较、交换等）所需的所有静态方法。查看[http://msdn.microsoft.com/en-us/library/system.threading.interlocked_members.aspx](http://msdn.microsoft.com/en-us/library/system.threading.interlocked_members.aspx)

对于大多数集合，您可以通过名为“Synchronized”的静态成员获取同步集合。但是请注意，这些不是无锁结构，它们只是隐藏了使用锁/信号量的混乱。检查队列集合的同步方法[http://msdn.microsoft.com/en-us/library/system.collections.queue.synchronized.aspx](http://msdn.microsoft.com/en-us/library/system.collections.queue.synchronized.aspx)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-29T09:57:50.427

作为信息，.NET 4.0 很可能（[此处](http://blogs.msdn.com/pfxteam/archive/2008/10/31/9026988.aspx)）将从[Parallel Extensions](http://blogs.msdn.com/somasegar/archive/2007/11/29/parallel-extensions-to-the-net-fx-ctp.aspx)继承 CCR/TPL 。特别是 TPL 引入了*一系列*集合和其他为高级线程场景设计的结构（具有最少的锁等）。

目前，线程集合等的数量有限，加上通常的锁定原语 plus`Interlocked`等。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-29T10:12:26.230

这是我在.net 的 Interlocked 类中看到的问题。

我有多个线程更新一个计数器。每个线程必须获得唯一的计数器值，因此没有线程必须获得相同的值。

.net 中的联锁类的工作方式，我有 -

```
int counter;
void code(){
    myThreadVal = Interlocked.increment(counter);
} 
```

现在，由于两个线程都可以看到相同的计数器值，因此它们都可以获得相同的 myThreadVal 值。

但是，在 java 的 AtomicInteger 永远不会发生的情况下，每个线程总是会得到不同的值。

# excel - 如何在 Excel 工作表中添加表单？

> ID：327361
> 
> 赞同：-2
> 
> 时间：2008-11-29T08:49:18.583
> 
> 标签：excel

如何在 Excel 工作表中添加输入表单。我想使用表单将值插入 Excel 单元格。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-29T09:52:02.527

ALT+F11 在 Excel 中启动 VBA 编辑器。在那里您可以创建用户表单（插入|用户表单），您可以将其绑定到自己的模块或附加到工作表。

我建议您查看 Excel 帮助或 MSDN 以了解您可以使用 UserForms 做什么的详细信息。网络上也有很多 VBA 教程正是针对这类事情的。谷歌是你的朋友。

高温高压

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-29T10:03:14.610

有一种在 Excel 中创建简单表单的快速而肮脏的方法。不需要 VBA。

首先，使用您想要的基本格式创建一个表格。

例如

```
 A    B    C
1   Name Age  Favourite Animal
2   Jane 11   Horse 
```

选择范围，然后选择数据 | 形式。（这是在 Excel 2003 中。）

它将打开一个简单的表单，允许导航、创建、删除和搜索。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-01T17:11:43.323

@奇思妙想，

很酷的把戏。从来不知道它的存在。我不得不做一些查看，但您也可以在 Excel 2007 中进行。

1.  单击 Office 按钮，选择 Excel 选项，转到自定义选项卡
2.  从“Choose commands from”下拉菜单中选择“Commands Not in the Ribbon”
3.  在列表中找到“表单”并单击“添加”，然后单击“确定”

此时，“表单”命令将显示在“快速访问”工具栏上，位于“保存”和“撤消/重做”图标旁边。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-29T08:57:11.483

您必须激活表单工具栏。
当然，IIRC，表单必须由VBA代码处理。

# java - 在线考试网络应用程序

> ID：327365
> 
> 赞同：8
> 
> 时间：2008-11-29T09:01:38.480
> 
> 标签：java, javascript, jsp, servlets

我正在使用即将完成的 JSP/Servlets 开发在线考试。我计划为整个考试添加计时器功能，以分钟为单位显示经过的时间。我如何使用万无一失的技术来实现这一点，因为使用 javascript 意味着用户可以关闭浏览器中的功能。对此的任何帮助将不胜感激。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-29T09:10:48.460

记录用户在服务器上开始和结束的时间。用户必须按下一个按钮来表示他们已经开始考试，这可以触发服务器标记开始时间；当提交最终答案时，服务器可以记录所用的总时间。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-30T02:44:28.787

在[Terracotta](http://terracotta.org)，我们最近开发了一个用于在线考试的参考 Web 应用程序。我们还使用 Javascript 实现了一个客户端计时器，如果您想看一下，代码是开源的。

文档和现场演示的主页是[http://reference.terracotta.org](http://reference.terracotta.org)

最后一个版本的项目源在这里： [http ://svn.terracotta.org/svn/forge/projects/exam/tags/release-1.0.1/](http://svn.terracotta.org/svn/forge/projects/exam/tags/release-1.0.1/)

实际的 Javascript 计时器代码在[这里](http://svn.terracotta.org/svn/forge/projects/exam/tags/release-1.0.1/src/main/webapp/js/examTimer.js)。希望这是足够的指针继续下去。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-14T03:05:59.190

更好的是，您可以跟踪考试开始时间并将其存储到服务器中。在客户端，您可以使用倒数计时器。如果他们禁用 javascript，它会影响客户端中运行的计时器。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-29T09:10:00.693

服务器端

将经过的时间存储在用户会话中。

您的页面可以在 javascript 中显示剩余时间，人们可以弄乱 javascript，但他们没有能力弄乱您的计时逻辑，总是从服务器获取剩余时间。

当前时间 - 所有答案的开始时间等

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-29T09:11:11.020

您可以在用户的​​浏览器中要求使用 javascript，并使用 javascript+AJAX - 每分钟从服务器获取更新时间或确保时间同步。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2013-05-15T08:33:58.100

管理计时器的更好方法是在客户端而不是服务器端。如果网络很慢会怎样？

由于您的逻辑在服务器端，因此网速不佳的人无法完成考试。您可以查看 Skill Evaluation Lab 考试软件计时器管理并像这样实现。

# sql - 将两张表连接成一张大表

> ID：327366
> 
> 赞同：9
> 
> 时间：2008-11-29T09:04:22.903
> 
> 标签：sql, database

我有两个具有相同列的表，我需要将一个表的行复制到另一个表的行以创建一个包含两个表中所有值的大表。现在我正在执行此查询以返回相同的内容：

```
SELECT col1, col2, col3 from Table1
union
SELECT col1, col2, col3 from Table2 
```

但是，它似乎非常低效，并且在我的系统上非常慢（返回 1210189 条记录）。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-11-29T09:10:01.007

可以这样做：

```
SELECT col1, col2, col3 
INTO Table1
FROM Table2 
```

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-11-29T09:14:23.663

从联合所有开始：

```
select col1, col2, col3 from Table1
union all
select col1, col2, col3 from Table2 
```

您的查询正在尝试删除重复数据，这会大大减慢它的速度。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-29T09:59:31.310

我认为最好的选择是在 sql server 中创建一个视图，这将优化查询的性能：

```
SELECT col1, col2, col3 from Table1
union all
SELECT col1, col2, col3 from Table2 
```

（正如其他用户所说：“union”用于从两个表中选择不同的值，而“union all”用于选择所有值，包括表中的重复值。）

同时，如果我为网络编写它们，我会限制从数据库中获取的行数，如果这给我带来问题，使用 Sql Server 2005 [row_number()](http://msdn.microsoft.com/en-us/library/ms186734.aspx)的新功能，我会分页结果.

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-29T10:46:30.437

您可以使用它来填充第二个表：

```
Insert into table2 select * from table1; 
```

或者，如果您想更具体：

```
Insert into table2(col1, col2, col3) select col1, col2, col3 from table1; 
```

（注意：某些 DBMS 可能需要在 SELECT 子句周围加上括号。）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-04-04T11:39:04.827

```
select * into new table(your new table name) 
from table1.col1,table1.col2,table2.col1; 
```

这里的列可以是您需要的列。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2018-07-20T22:11:47.867

```
select * into newtable from table1
union all
select * from table2 
```

工作得很好。准则，两个表具有完全相同的列名:)

# macos - PPC 断点

> ID：327372
> 
> 赞同：3
> 
> 时间：2008-11-29T09:12:21.827
> 
> 标签：macos, debugging, assembly, powerpc

如何在 PPC 上实现断点（具体来说，在 OS X 上）？

例如，在 x86 上，它通常使用 INT 3 指令 (0xCC) 完成——对于 ppc 是否有与此相当的指令？还是有其他方式设置/实现它们？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2012-04-23T19:09:06.487

使用 gdb 和一个 hexdumps 自身的函数，我得到 0x7fe00008。这似乎是[tw 指令](http://pic.dhe.ibm.com/infocenter/aix/v6r1/topic/com.ibm.aix.aixassem/doc/alangref/tw.htm#mj2a0ken)：

```
0b01111111111000000000000000001000
  011111                           31
        11111                      condition flags: lt, gt, ge, logical lt, logical gt
             00000                 rA
                  00000            rB
                       0000000100  constant 4
                                 0 reserved 
```

即比较 r0 和 r0 并捕获任何结果。

GDB反汇编只是[扩展助记符`trap`](http://pic.dhe.ibm.com/infocenter/aix/v6r1/topic/com.ibm.aix.aixassem/doc/alangref/fixed_point_trap.htm#zu8rh2fjeff)

**编辑：**我正在使用“GNU gdb 6.3.50-20050815（Apple 版本 gdb-696）（2007 年 10 月 20 日星期六 18:20:28 GMT）”

**编辑2：***条件*断点也可能使用其他形式，`tw`或者`twi`如果所需的值已经在寄存器中并且调试器不需要跟踪命中计数。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-29T13:43:47.503

除了软件断点，PPC 还支持硬件断点，通过`IABR`（并且可能`IABR2`，取决于内核版本）寄存器实现。这些是指令断点，但也有数据断点（使用`DABR`and，可能，实现`DABR2`）。如果您的内核支持两组硬件断点寄存器（即存在 IABR2 和 DABR2），您可以做的不仅仅是在特定地址上触发：您可以指定整个连续范围的地址作为断点目标。对于数据断点，您还可以指定是否希望它们在写入、读取或任何访问时触发。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-29T13:30:16.800

最好的猜测是“tw”或“twi”指令。

您可以深入研究 PPC gdb 的源代码，OS X 可能使用与其 FreeBSD 根相同的功能。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-05-17T21:26:39.573

PowerPC 架构使用“陷阱”。

[http://publib.boulder.ibm.com/infocenter/aix/v6r1/index.jsp?topic=/com.ibm.aix.aixassem/doc/alangref/twi.htm](http://publib.boulder.ibm.com/infocenter/aix/v6r1/index.jsp?topic=/com.ibm.aix.aixassem/doc/alangref/twi.htm)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2017-05-29T15:05:26.407

指令断点通常通过[`TRAP`](https://en.wikipedia.org/wiki/Trap_(computing))指令或[`IABR`](https://www.manualslib.com/manual/606065/Ibm-Powerpc-750gx.html?page=64)调试硬件寄存器来实现。

示例实现： [ArchLinux](http://elixir.free-electrons.com/linux/latest/source/arch/powerpc/xmon/xmon.c)、[Apple](https://opensource.apple.com/source/xnu/xnu-1504.7.4/osfmk/ppc/trap.c.auto.html)、[Wii](http://storage.googleapis.com/google-code-archive-downloads/v2/code.google.com/geckodownloads/geckoos_source.zip)和[Wii U](https://github.com/Kinnay/DiiBugger/blob/master/wiiu_code/server.cpp)。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2008-11-29T09:32:00.867

一个可靠的（但目前已经醉了，所以带着一粒盐）消息来源告诉我，这是一个零指令，它是非法的并且会导致某种系统陷阱。

编辑：进入社区维基，以防我的朋友喝醉了，他说的绝对是垃圾:-)

# performance - 测试并发性的基准问题

> ID：327379
> 
> 赞同：4
> 
> 时间：2008-11-29T09:22:56.063
> 
> 标签：performance, multithreading, concurrency, benchmarking

对于我现在正在做的一个项目，我需要查看不同的[支持并发的](http://en.wikipedia.org/wiki/Concurrent_computing)编程语言的性能（除其他外）。

目前我正在研究比较[stackless python](http://www.stackless.com/)和[C++ PThreads](https://computing.llnl.gov/tutorials/pthreads/)，所以重点放在这两种语言上，但稍后可能会测试其他语言。当然比较必须尽可能有代表性和准确，所以我的第一个想法是开始寻找一些标准***的并发/多线程基准问题***，可惜我找不到任何像样的或标准的测试/问题/基准。

所以我的问题如下：*您是否有一个好的、简单或快速的问题来测试编程语言的性能*（并揭示它在过程中的强项和弱点）？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-29T09:25:56.357

当然，您应该测试硬件和编译器，而不是测试并发性能的语言吗？

我会从并发性方面的简单性和生产力的角度来看待一种语言，以及它在多大程度上“隔离”了程序员不会犯锁定错误。

编辑：从过去作为设计并行算法的研究人员的经验来看，我认为您会发现在大多数情况下，并发性能在很大程度上取决于算法的并行化方式以及它如何针对底层硬件。

此外，众所周知，基准是不平等的。在并行环境中更是如此。例如，“处理”非常大的矩阵的基准测试将适合矢量管道处理器，而并行排序可能更适合更通用的多核 CPU。

这些可能有用：

[平行基准](http://www.crpc.rice.edu/newsArchive/2893.html)

[NAS 并行基准](http://www.nas.nasa.gov/Resources/Software/npb.html)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-29T10:24:13.617

好吧，有一些经典，但不同的测试强调不同的功能。一些分布式系统可能更健壮，具有更有效的消息传递等。更高的消息开销会损害可伸缩性，因为扩展到更多机器的正常方法是发送大量小消息。您可以尝试的一些经典问题是分布式埃拉托色尼筛法或执行不佳的斐波那契数列计算器（即计算系列中的第 8 个数字，第 7 个机器旋转，第 6 个机器旋转）。几乎任何分治算法都可以同时完成。您还可以同时实现 Conway 的生命游戏或热传递。

我想说最容易快速实现的是实现不佳的斐波那契计算器，尽管它过于强调创建线程而过于强调这些线程之间的通信。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-29T09:44:26.490

> [当然，您应该测试硬件和编译器，而不是测试并发性能的语言吗？](https://stackoverflow.com/questions/327379/benchmark-problems-for-testing-concurency#327380)

不，硬件和编译器与我的测试目的无关。我只是在寻找一些可以测试用一种语言编写的代码与另一种语言的代码竞争的好问题。我真的在测试特定语言中可用的结构来进行并发编程。标准之一是性能（按时间衡量）。

我正在寻找的其他一些测试标准是：

*   编写正确的代码有多*容易；*因为众所周知，并发编程比编写单线程程序更难
*   用于并发编程的技术是什么：事件驱动，基于actor，消息解析，...
*   程序员自己必须编写多少代码以及自动为他完成多少代码：这也可以用给定的基准问题进行测试
*   什么是抽象级别以及翻译回机器代码时涉及多少开销

所以实际上，我并不是在寻找性能作为*唯一*和最好的参数（这确实会把我送到硬件和编译器而不是语言本身），我实际上是从程序员的角度来检查什么语言最适合什么样的问题，它的弱点和优势是什么等等......

请记住，这只是一个小项目，因此测试也应保持较小。（因此对所有东西都进行严格测试是不可行的）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-29T19:08:57.193

我决定使用[Mandelbrot 集](http://en.wikipedia.org/wiki/Mandelbrot_set)（更精确的[转义时间算法](http://en.wikipedia.org/wiki/Mandelbrot_set#Escape_time_algorithm)）来对不同语言进行基准测试。
它非常适合我，因为可以轻松实现原始算法，并且从中创建多线程变体并不是很多工作。

下面是我目前拥有的代码。它仍然是一个单线程变体，但我会在对结果满意后立即更新它。

```
#include <cstdlib> //for atoi
#include <iostream>
#include <iomanip> //for setw and setfill
#include <vector>

int DoThread(const double x, const double y, int maxiter) {
    double curX,curY,xSquare,ySquare;
    int i;

    curX = x + x*x - y*y;
    curY = y + x*y + x*y;
    ySquare = curY*curY;
    xSquare = curX*curX;

    for (i=0; i<maxiter && ySquare + xSquare < 4;i++) {
      ySquare = curY*curY;
      xSquare = curX*curX;
      curY = y + curX*curY + curX*curY;
      curX = x - ySquare + xSquare;
    }
    return i;
}

void SingleThreaded(int horizPixels, int vertPixels, int maxiter, std::vector<std::vector<int> >&  result) {
    for(int x = horizPixels; x > 0; x--) {
        for(int y = vertPixels; y > 0; y--) {
            //3.0 -> so we always have -1.5 -> 1.5 as the window; (x - (horizPixels / 2) will go from -horizPixels/2 to +horizPixels/2
            result[x-1][y-1] = DoThread((3.0 / horizPixels) * (x - (horizPixels / 2)),(3.0 / vertPixels) * (y - (vertPixels / 2)),maxiter);
        }
    }
}

int main(int argc, char* argv[]) {
    //first arg = length along horizontal axis
    int horizPixels = atoi(argv[1]);

    //second arg = length along vertical axis
    int vertPixels = atoi(argv[2]);

    //third arg = iterations
    int maxiter = atoi(argv[3]);

    //fourth arg = threads
    int threadCount = atoi(argv[4]);

    std::vector<std::vector<int> > result(horizPixels, std::vector<int>(vertPixels,0)); //create and init 2-dimensional vector
    SingleThreaded(horizPixels, vertPixels, maxiter, result);

    //TODO: remove these lines
    for(int y = 0; y < vertPixels; y++) {
      for(int x = 0; x < horizPixels; x++) {
            std::cout << std::setw(2) << std::setfill('0') << std::hex << result[x][y] << " ";
        }
        std::cout << std::endl;
    }
} 
```

我已经在 Linux 下使用 gcc 对其进行了测试，但我确信它也可以在其他编译器/操作系统下工作。要让它工作，你必须输入一些命令行参数，如下所示：

> 曼德布罗 106 500 255 1

第一个参数是宽度（x 轴）
第二个参数是高度（y 轴）
第三个参数是最大迭代次数（颜色数）
最后一个是线程数（但那个是目前未使用）

根据我的决定，上面的例子给了我一个很好的 Mandelbrot 集的 ASCII 艺术表示。但是用不同的参数自己尝试（第一个将是最重要的，因为那将是宽度）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-02T09:09:10.880

您可以在下面找到我一起编写的代码，以测试 pthreads 的**多线程**性能。我没有清理它，也没有进行任何优化；所以代码有点*原始*。

将计算出的 mandelbrot 集保存为位图的代码不是我的，你可以在[这里找到](http://www.programmersheaven.com/d/click.aspx?ID=F54666)

```
#include <cstdlib> //for atoi
#include <iostream>
#include <iomanip> //for setw and setfill
#include <vector>

#include "bitmap_Image.h" //for saving the mandelbrot as a bmp

#include <pthread.h>

pthread_mutex_t mutexCounter;
int sharedCounter(0);
int percent(0);

int horizPixels(0);
int vertPixels(0);
int maxiter(0);

//doesn't need to be locked
std::vector<std::vector<int> > result; //create 2 dimensional vector

void *DoThread(void *null) {
    double curX,curY,xSquare,ySquare,x,y;
    int i, intx, inty, counter;
    counter = 0;

    do {
        counter++;
        pthread_mutex_lock (&mutexCounter); //lock
            intx = int((sharedCounter / vertPixels) + 0.5);
            inty = sharedCounter % vertPixels;
            sharedCounter++;
        pthread_mutex_unlock (&mutexCounter); //unlock

        //exit thread when finished
        if (intx >= horizPixels) {
            std::cout << "exited thread - I did " << counter << " calculations" << std::endl;
            pthread_exit((void*) 0);
        }

        //set x and y to the correct value now -> in the range like singlethread
        x = (3.0 / horizPixels) * (intx - (horizPixels / 1.5));
        y = (3.0 / vertPixels) * (inty - (vertPixels / 2));

        curX = x + x*x - y*y;
        curY = y + x*y + x*y;
        ySquare = curY*curY;
        xSquare = curX*curX;

        for (i=0; i<maxiter && ySquare + xSquare < 4;i++){
          ySquare = curY*curY;
          xSquare = curX*curX;
          curY = y + curX*curY + curX*curY;
          curX = x - ySquare + xSquare;
        }
        result[intx][inty] = i;
     } while (true);
}

int DoSingleThread(const double x, const double y) {
    double curX,curY,xSquare,ySquare;
    int i;

    curX = x + x*x - y*y;
    curY = y + x*y + x*y;
    ySquare = curY*curY;
    xSquare = curX*curX;

    for (i=0; i<maxiter && ySquare + xSquare < 4;i++){
      ySquare = curY*curY;
      xSquare = curX*curX;
      curY = y + curX*curY + curX*curY;
      curX = x - ySquare + xSquare;
    }
    return i;

}

void SingleThreaded(std::vector<std::vector<int> >&  result) {
    for(int x = horizPixels - 1; x != -1; x--) {
        for(int y = vertPixels - 1; y != -1; y--) {
            //3.0 -> so we always have -1.5 -> 1.5 as the window; (x - (horizPixels / 2) will go from -horizPixels/2 to +horizPixels/2
            result[x][y] = DoSingleThread((3.0 / horizPixels) * (x - (horizPixels / 1.5)),(3.0 / vertPixels) * (y - (vertPixels / 2)));
        }
    }
}

void MultiThreaded(int threadCount, std::vector<std::vector<int> >&  result) {
    /* Initialize and set thread detached attribute */
    pthread_t thread[threadCount];
    pthread_attr_t attr;
    pthread_attr_init(&attr);
    pthread_attr_setdetachstate(&attr, PTHREAD_CREATE_JOINABLE);

    for (int i = 0; i < threadCount - 1; i++) {
        pthread_create(&thread[i], &attr, DoThread, NULL);
    }
    std::cout << "all threads created" << std::endl;

    for(int i = 0; i < threadCount - 1; i++) {
        pthread_join(thread[i], NULL);
    }
    std::cout << "all threads joined" << std::endl;
}

int main(int argc, char* argv[]) {
    //first arg = length along horizontal axis
    horizPixels = atoi(argv[1]);

    //second arg = length along vertical axis
    vertPixels = atoi(argv[2]);

    //third arg = iterations
    maxiter = atoi(argv[3]);

    //fourth arg = threads
    int threadCount = atoi(argv[4]);

    result = std::vector<std::vector<int> >(horizPixels, std::vector<int>(vertPixels,21)); // init 2-dimensional vector
    if (threadCount <= 1) {
        SingleThreaded(result);
    } else {
        MultiThreaded(threadCount, result);
    }

    //TODO: remove these lines
    bitmapImage image(horizPixels, vertPixels);
    for(int y = 0; y < vertPixels; y++) {
      for(int x = 0; x < horizPixels; x++) {
            image.setPixelRGB(x,y,16777216*result[x][y]/maxiter % 256, 65536*result[x][y]/maxiter % 256, 256*result[x][y]/maxiter % 256);
            //std::cout << std::setw(2) << std::setfill('0') << std::hex << result[x][y] << " ";
        }
        std::cout << std::endl;
    }

    image.saveToBitmapFile("~/Desktop/test.bmp",32);
} 
```

使用具有以下参数的程序可以获得良好的结果：

> 曼德布罗 5120 3840 256 3

这样您将获得 5 * 1024 宽的图像；5 * 768 高，256 种颜色（唉，你只会得到 1 或 2 个）和 3 个线程（1 个主线程，除了创建工作线程之外不做任何工作，2 个工作线程）

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-03-21T16:58:16.060

自从 2008 年 9 月基准测试游戏转移到四核机器上，许多不同编程语言的程序都被重写以利用四核——[例如，前 10 个 mandelbrot 程序](https://benchmarksgame-team.pages.debian.net/benchmarksgame/performance/mandelbrot.html)。

# css - 什么是好的 CSS 策略？

> ID：327382
> 
> 赞同：24
> 
> 时间：2008-11-29T09:34:16.433
> 
> 标签：css

我们有一个大型的 ASP.Net 网站，它有一个失控的 CSS 样式表。

我正在考虑使用以下策略（取自[http://www.techrepublic.com/article/developing-a-css-strategy/5437796/](http://www.techrepublic.com/article/developing-a-css-strategy/5437796/)），这对我来说似乎是合乎逻辑的......

*您可能有一个专门用于站点范围样式的 CSS 文件和用于可识别的站点页面子集（例如特定部门的页面或具有不同布局样式的页面）的单独 CSS 文件。对于特定页面独有的样式，请为每个页面使用单独的 CSS 文件（如果样式太多而无法舒适地放入文档标题中）。您为每个页面链接或导入适当的 CSS 文件，以便加载显示该页面所需的所有样式，但很少出现仅出现在其他页面上的不必要样式。*

这是继续的好方法吗？有哪些替代方案？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-11-29T09:40:03.270

我认为最好的选择是将css划分为：

-layout.css

-content.css

然后，如果您需要其他更具体的内容，您可以为广告添加更多的 CSS：ads.css，或为特定部分添加一个 CSS。

我还会为 IE css hacks 添加 ie.css。

我不会谈论只为一个页面创建一个 CSS：如果您使用太多 CSS，您可能会遇到的问题是您的页面必须向服务器发出更多请求，这会减慢您的页面速度。这就是为什么我建议您实现一个 HttpHandler ，它将仅在您目前需要的一个 css 文件中创建一个缓存副本。看这里： [http ://blog.madskristensen.dk/post/Combine-multiple-stylesheets-at-runtime.aspx](http://blog.madskristensen.dk/post/Combine-multiple-stylesheets-at-runtime.aspx)

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-11-30T05:14:15.770

有用于分解样式表的三种主要方法：基于属性、基于结构和混合。您选择哪种方法最应该基于工作流程和个人喜好。

## 基于属性

基于属性的分解的最基本、最具代表性的形式是使用两个样式表：structure.css 和 style.css。structure.css 文件将包含仅使用诸如高度、宽度、边距、填充、浮动、位置等属性的规则。这将有效地包含以您想要的方式排列页面元素所必需的“构建块”。style.css 文件将包含具有背景、字体、颜色、文本装饰等属性的规则。这有效地充当了在其他样式表中创建的结构的皮肤。

额外的分离可能包括使用typography.css 文件，您将在其中放置所有字体属性。或者是一个 colors.css 文件，您可以在其中放置所有颜色和背景属性。尽量不要过火，因为这种方法很快就会变得比它的价值更麻烦。

## 基于结构

分解样式表的基于结构的方法围绕着根据它们所应用的元素来分离规则。例如，您可能会看到页眉中所有内容的 masthead.css 文件、页面内容区域中所有内容的 body.css 文件、侧边栏中所有内容的 sidebar.css 文件和 footer.css 文件页面底部的所有内容。

当您的网站在每个页面上都有很多不同的部分时，这种方法真的很有帮助。它还有助于最大限度地减少每个样式表中的规则数量。与基于属性的方法不同，后者往往在页面上的每个元素的每个样式表中都有一个规则，使用这种方法，对于任何给定元素，您在一个样式表中只有一个规则。

## 杂交种

如您所料，混合方法结合了两种方法的优点，是我的首选。在这里，您创建一个 structure.css 文件，就像在基于属性的方法中一样，仅使用创建基本布局所需的那些属性。然后你创建额外的样式表，比如 masthead.css，它会为标题蒙皮；body.css，对内容进行蒙皮；等等

## 其他注意事项

困扰这些方法的一个问题是，通过创建多个样式表，您需要客户端的浏览器获取许多文件。这会对用户体验产生负面影响，因为大多数浏览器只会向同一服务器发出两个并发请求。如果您有七个样式表，这意味着在初始页面加载时可能会增加数百毫秒（一旦缓存了样式表，这种影响就会减少，但您希望给这些新访问者留下良好的第一印象）。正是出于这个原因，创建了 CSS sprites 技术。分解样式表可能会抹杀使用精灵所获得的任何收益。

解决此问题的方法是在用户发出页面请求时将分解的样式表压缩回一个样式表。

为了两全其美，可以考虑使用像[Sass](http://haml.hamptoncatlin.com/docs/rdoc/classes/Sass.html)这样的 CSS 元语言。这允许 CSS 作者将一个样式表分解为多个样式表，同时仍然只向浏览器呈现一个样式表。这为 CSS 创作工作流程增加了一个步骤（尽管它可能被编写脚本以在任何 Sass 文件更新时将 Sass 编译为 CSS），但它可能是值得的，尤其是在考虑到 Sass 的许多其他好处时。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-11-29T10:24:19.327

您可以做的是拥有许多易于管理、单独的文件用于开发，然后将它们全部合并到一个文件中并在您的实时站点上将其缩小。

这需要更多的设置工作，但可以为您提供两全其美的优势 - 易于管理站点 + 快速页面加载。

编辑：雅虎的[YUI 压缩器](http://developer.yahoo.com/yui/compressor/)似乎是最好的压缩器。它可以压缩 CSS 和 Javascript。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-22T19:22:10.620

我的解决方案有很多：

*   **base.css / reset.css** : 你的基础 {base layout, type, color} -- 100% 可重用性
*   **helper.css**：模块的基本布局规则以及“实用程序类”{网格变体、表单、表格等}——90%以上的可重用性
*   **module.css**：模块的复杂布局规则{语义模块，如 .post 或 .comment} - 75% 的可重用性
*   **layout.css** : 基于模板的规则 {#hd, #bd, #ft, #homePage, etc.} - 几乎没有可重用性
*   **color.css** : 所有颜色规则，组合 - 50% 可重用性
*   **type.css**：所有类型规则，组合 - 75% 可重用性（文本样式变化较少）
*   这种分离还允许布局表的移动和打印版本，全部由@import 通过我链接到 html 的样式表控制。

我将其用于中型站点。为了额外的组织，我将每张纸的分段基本相同{包装，一般，独特等}。我还标记了我的选择器和属性，并在同一个选择器组中按依赖顺序缩进它们，这样我就知道我引用或扩展了哪些规则。这个框架允许几乎无限的扩展，同时保持事物的组织性、可理解性和可重用性。一个月前我不得不重构一个 7000+ 行的 master.css 文件，所以这是我正在尝试的一个新系统。我发现 100% 内容语义 CSS 不像语义/布局混合那样可扩展且易于理解，因为无论如何这就是 CSS 的用途。

**1.25-yr-later-edit**：另一种可能更相关的方法是使用一个好的 CSS 文本编辑器。我很肯定 VS 不适合使用 CSS，除非你遇到了一些扩展。如果你在 Windows 上，试试[E 文本编辑器](http://e-texteditor.com)，b/c 它是一个 TextMate Windows 端口，并且有为 CSS 和标记设计的捆绑包，可以为你提供更好的语法突出显示和自动完成功能。然后你可以做的就是将一个 8000 行的样式表组织成可折叠的折叠：

```
/** Start Module 1 */
[css]
/* End Module 1 **/ 
```

并使用符号列表为您即时显示快速目录，其中包含类似`Start`或的​​查询`Module 1`。它还索引行`/** these types of comments **/`（非常适合标记区域）和所有 CSS 选择器链。使用 E 处理单个大文件应该没有问题。此外，除非您逐步增强 CSS，否则无论如何它都会被缩小。我还会确保缩进你的 CSS 以在某种程度上模仿它所指的 DOM 部分的结构。

```
.container {}
    .container .inner {}
        .container .head {}
    .container .inner.alt {} 
```

否则，我同意“1 个基本 CSS 和 1 个页面/部分 CSS”方法，尽管这完全取决于您的业务需求。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-29T11:32:22.480

我会检查 YUI CSS。也许不是您正在寻找的答案，但 YUI CSS 消除了使用不同浏览器等的大部分麻烦......

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-29T12:45:09.463

制定一些适合您（或您的公司）的简单规则。

将您的 CSS 分成单独的文件，例如：

```
layout.css
content.css
menu.css
typography.css 
```

确定每个文件中将包含哪些声明，例如，确保：

```
font-weight, text-decoration, font-family 
```

和

```
h1, h2, h3, h4, h5, h6, a, p, li 
```

所有内容都位于排版 CSS 文件中。决定如何处理边缘情况，例如标题的边框属性、文本元素（布局或排版）上的填充和边距。

如果您的声明集变得笨拙，有些人喜欢按字母顺序组织它们。

缩进你的 CSS，例如：

```
#logo h1 {text-indent: -9999px}
     #logo h1 a {display: block; width: 200px; height: 98px; backround...} 
```

注释您的 CSS，包括对其他文件的引用，如果该特定选择器的其他规则驻留在那里。

如果您确实将 CSS 划分为单独的文件，请考虑将它们合并并压缩到一个文件中，作为构建和部署过程的一部分。

确保每个开发人员都非常了解您的 CSS 标准。

另外，有点相关的是，我刚刚知道了一个 Firefox 插件，用于查找不必要的选择器。它被称为[Dust-Me 选择器](https://addons.mozilla.org/en-US/firefox/addon/5392)。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-29T10:03:16.483

netadictos 提出了一些好的观点，我同意。寻找更多 Css 的原因很容易，但从长远来看，保持精简的好处要大得多。

此外，您是否考虑过在 asp.net 中使用主题和皮肤文件？.css 和 .skin 的组合可以显着减小您的 Css 的整体大小，这对性能有一点好处，但对于更容易管理非常有好处。

一些例外情况可能包含在一个 css 文件中，但如果一个 css 文件中的内容完全不同，那么您可以考虑使用单独的 css 甚至是单独的站点（如果它们不同的话）。显然，您可能会加载不同版本的主题，具体取决于它是哪个用户。这就是你可能有大量 Css 文件的地方。也就是说，假设您对每个页面都有一个 css，然后您想为您网站上的不同客户提供不同的 css，那么您将成倍增长。这当然假设你有这个挑战。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-29T10:14:37.537

关于 JavaScript 文件，我想知道同样的事情。如果您的网站高度依赖 Ajax，以至于几乎每个页面都需要某种自定义 Javascript，那么您会坚持下去吗？

最佳实践通常在页面中没有 javascript，而是作为外部文件（与 css 一样）。但是，如果您每页都有一个 .js 文件，那么事情就会慢慢失控。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-11-29T12:54:55.793

我不确定 Windows 等价物，但在 Mac 上，您可以获得[CSSEdit](http://www.macrabbit.com/cssedit)，它允许您将文件夹添加到 CSS 文件并像这样管理它们。[在这篇文章](http://www.viget.com/inspire/organizing-your-stylesheet-using-css-edit/)中有一个很好的解释。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-12-01T05:02:58.710

全局 css 文件之前让我很头疼。CSS 通常没有命名空间，所以如果两个不同的模块创建一个带有“box”类的 div，那么一个模块的意图会覆盖另一个模块。此外，[a] 标记、[p] 标记和其他基本标记上的样式（即不基于类或 id 的样式）将对第 3 方控件造成严重破坏，因为您的全局样式表级联到设计为假设的 html 组件上页面上没有其他 CSS。不恰当地使用文本居中到中心元素会导致难以调试全局居中。所以我喜欢多个css文件。我见过 css 管理器（在请求时将 css 合并在一起的 http 模块），但认为额外的 http 请求非常值得限制我认为 css 对我的应用程序造成的损害范围。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-12-01T06:20:12.470

我们使用 Ruby on Rails，因此我们有一个清晰的控制器/动作对，我们使用它来引用 CSS 类和 Javascript 视图。

具体来说，获取控制器的名称+动作名称并将其作为 ID 嵌入到视图中，将其放在主体标签或您的主要内容 div 上。

```
<body id="users_list_body"> 
```

其中“用户”是控制器的名称，“列表”是操作。然后在你的CSS中你有规则喜欢

#users_list_body

因此，您可以将所有特定的 CSS 限定在该视图中。当然，您还可以使用更通用的 CSS 来处理整体样式。但是更容易定义此 ID 允许您为各个页面创建特定的 CSS（因为控制器/操作映射到特定页面）。

你最终有这样的规则

```
 #users_list_body table 
  #users_list_body table thead 
```

对 Javascript 执行相同的操作。因此，在每个页面的页脚中，您使用相同的控制器/动作名称对并将其嵌入到函数调用中

```
 //javascript
 if(V.views.users_list) { V.views.user_list(); } 
```

然后在你的外部Javascript中你有类似的东西

```
V = {};
V.views = {};
V.views.user_list = function() {
  //any code you want to run for the Users controller / List action..
  //jQuery or something
  $('#save_button').click({ ... });
} 
```

将所有 Javascript 代码限定为特定函数，最终将其全部封装。然后，您可以将所有 Javascript 文件合并为一个，压缩它，然后将其作为一个文件提供，您的任何逻辑都不会发生冲突。一个页面的 JS 不会与任何其他页面的 JS 冲突，因为每个页面都由其方法名称限定。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-12-01T06:32:33.600

无论您选择什么，请**避免使用 @import 指令**。

使浏览器按顺序加载样式表，从而减慢页面的加载和渲染速度。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-03-22T19:37:30.613

这就是我所做的：我将我的样式表分开，有点像其他人建议的那样。但是，我有一个脚本将它们连接在一起，缩小它们，添加标题，然后压缩它们。然后将生成的文件用作样式表，如果它超过到期日期，它会自动重新编译。我在站点范围内对所有公共文件执行此操作，然后在特定页面的基础上针对仅出现在该页面上的 CSS 执行此操作。最多，我每页只会调用 2 个 CSS 文件，它们将被压缩，从而最大限度地减少下载时间和大小以及页面请求的数量，但我仍然可以以任何有意义的方式将它们分开我。同样的策略也可以用于 JavaScript。

# emacs - find-grep 和 grep-find 有什么区别？

> ID：327401
> 
> 赞同：1
> 
> 时间：2008-11-29T10:12:32.860
> 
> 标签：emacs

`find-grep`Emacs和Emacs有什么区别`grep-find`？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-29T10:17:04.503

它们看起来一样。见[手册](http://www.impernix.org/Manuals/emacs/Grep-Searching.html)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-12-01T19:26:32.460

您可以使用`M-x describe-function`（或`C-h f`使用默认键绑定）来回答这个问题，这是输出`find-grep`：

```
find-grep is an alias for `grep-find' in `progmodes/grep.el'.
(find-grep COMMAND-ARGS)
... 
```

# c# - 从 C# 使用 Microsoft 虚拟服务器：CoSetProxyBlanket 什么都不做

> ID：327404
> 
> 赞同：1
> 
> 时间：2008-11-29T10:15:29.860
> 
> 标签：c#, nant, virtual-server

[我正在尝试编写几个用于与 Microsoft Virtual Server 2005 R2 SP1 交互的 NAnt 任务，并且我已经在“通过 PowerShell 控制虚拟服务器”](http://blogs.msdn.com/virtual_pc_guy/archive/2006/06/13/630165.aspx)帖子中提取了“Virtual PC Guy 的 WebLog”中的代码。

它不起作用：调用 CreateVirtualMachine 时总是失败：

`System.Runtime.InteropServices.COMException (0x80070542): Either a required impersonation level was not provided, or the provided impersonation level is invalid. (Exception from HRESULT: 0x80070542)`

`at Microsoft.VirtualServer.Interop.VMVirtualServerClass.CreateVirtualMachine(String configurationName, String configurationPath)`

我的代码如下：

```
var virtualServer = new VMVirtualServerClass();
SetSecurity(virtualServer);
var virtualMachine = virtualServer.CreateVirtualMachine("TEST",
    @"D:\Virtual Server\TEST.vmc"); 
```

...其中 SetSecurity 定义如下：

```
 private static void SetSecurity(object dcomObject)
    {
        IntPtr pProxy = Marshal.GetIUnknownForObject(dcomObject);
        int hr = CoSetProxyBlanket(pProxy,
            RPC_C_AUTHN_DEFAULT,
            RPC_C_AUTHZ_DEFAULT,
            IntPtr.Zero,
            RPC_C_AUTHN_LEVEL_PKT_PRIVACY,
            RPC_C_IMP_LEVEL_IMPERSONATE,
            IntPtr.Zero,
            EOAC_DYNAMIC_CLOAKING);
        Marshal.ThrowExceptionForHR(hr);
    }

    private const uint RPC_C_AUTHN_NONE = 0;
    private const uint RPC_C_AUTHN_WINNT = 10;
    private const uint RPC_C_AUTHN_DEFAULT = 0xFFFFFFFF;

    private const uint RPC_C_AUTHZ_NONE = 0;
    private const uint RPC_C_AUTHZ_DEFAULT = 0xFFFFFFFF;

    private const uint RPC_C_AUTHN_LEVEL_DEFAULT = 0;
    private const uint RPC_C_AUTHN_LEVEL_PKT_PRIVACY = 6;

    private const uint RPC_C_IMP_LEVEL_IDENTIFY = 2;
    private const uint RPC_C_IMP_LEVEL_IMPERSONATE = 3;

    private const uint EOAC_NONE = 0;
    private const uint EOAC_DYNAMIC_CLOAKING = 0x40;
    private const uint EOAC_DEFAULT = 0x0800;

    [DllImport("Ole32.dll")]
    public static extern int CoSetProxyBlanket(IntPtr pProxy,
            UInt32 dwAuthnSvc,
            UInt32 dwAuthzSvc,
            IntPtr pServerPrincName,
            UInt32 dwAuthnLevel,
            UInt32 dwImpLevel,
            IntPtr pAuthInfo,
            UInt32 dwCapabilities); 
```

如果我编写一个独立程序并添加对 的调用`CoInitializeSecurity`，那么它可以工作。但是，我不想要一个独立的程序——我想要一组 NAnt 任务（所以是一个 DLL），并且我不想调用`CoInitializeSecurity`，因为无法保证其他一些 NAnt 任务不会调用它已经。

有没有人有这个工作？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-30T07:49:57.063

在从托管代码中使用 CoSetProxyBlanket 时，您可能会遇到一个基本问题。不幸的是，由于 CLR 编组接口的方式，没有可靠的方法可以在托管代码中与此方法进行互操作。

以下是一些描述此问题的博客条目

*   [http://blogs.msdn.com/mbend/archive/2007/04/18/cosetproxyblanket-not-supported-from-managed-code.aspx](http://blogs.msdn.com/mbend/archive/2007/04/18/cosetproxyblanket-not-supported-from-managed-code.aspx)
*   [http://blogs.msdn.com/jaredpar/archive/2007/04/19/cosetproxyblanket-and-managed-code.aspx](http://blogs.msdn.com/jaredpar/archive/2007/04/19/cosetproxyblanket-and-managed-code.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-08-23T21:14:35.443

值得一提的是，.NET 4.0 似乎将添加一个新方法[`GetObjectForIUnknownWithBlanket`](http://msdn.microsoft.com/en-us/library/dd386829(VS.100).aspx)（在 System.Runtime.InteropServices.Marshal 下）来帮助解决这个问题。来自（测试版）MSDN 文章：

> GetObjectForIUnknownWithBlanket 将 IUnknown 包装在一个唯一的托管对象中，并在所有请求的接口上调用 CoSetProxyBlanket 函数。它确保返回一个唯一的对象，而不是在缓存中查找以将给定的 IUnknown 与现有对象匹配。

我还没有尝试过，但它看起来很有希望。

*顺便说一句，很好的问题和很好的接受的答案！我刚刚遇到了同样的问题，这是我找到正确解释的唯一地方。*

# c# - 通过 java 运行 .net 控制台时出现“句柄无效”

> ID：327408
> 
> 赞同：10
> 
> 时间：2008-11-29T10:23:18.690
> 
> 标签：c#, java, .net, console

我正在尝试通过 Java 运行 dot net 控制台应用程序：

```
process = Runtime.getRuntime().exec(commandLine); 
```

我得到以下输出：

```
Detecting
The handle is invalid. 
```

通过控制台（Windows）直接运行它时没有问题：

```
Detecting
100%
Done.
100% 
```

我正在以这种形式运行更多应用程序，但没有问题。

得到了这个堆栈跟踪：

```
Detecting at System.IO.__Error.WinIOError(Int32 errorCode, String maybeFullPath)
 at System.Console.GetBufferInfo(Boolean throwOnNoConsole, Boolean& succeeded)
 at System.Console.get_CursorTop()
 at AutomaticImageOrientation.HelperClasses.General.WriteProgressToConsole(Int32 lastIndex, Int32 totalImages)
 at AutomaticImageOrientation.MainManager.DetectImage(String[] files, String outputPath, String& globalErrorMessage, Dictionary`2& foundRotations) 
```

问题是当 .net 应用程序尝试写入控制台时，解决方案是什么？

找到导致问题的行：

```
Console.CursorLeft = 0; 
```

你知道为什么吗？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-01-23T07:46:40.080

控制台应用程序正在尝试为控制台设置光标位置。这是不可能的，因为实际上没有控制台。当没有控制台时，所有不会导致简单读取或写入的操作都可能导致错误（因为它们中的大多数都需要控制台输出缓冲区才能工作）。

在您希望自动化的控制台应用程序中执行诸如设置光标位置或清除屏幕之类的操作是个坏主意。一个基本的解决方法是将有问题的语句放在 try-catch 中，然后丢弃异常。从[System.Console 上的 MSDN 页面](http://msdn.microsoft.com/en-us/library/system.console.aspx)：

> 您不应使用 Console 类在无人参与的应用程序（例如服务器应用程序）中显示输出。同样，对诸如 Write 和 WriteLine 等方法的调用在 Windows 应用程序中也不起作用。
> 
> 当基础流被定向到控制台时正常工作的控制台类成员可能会在流被重定向（例如，文件）时抛出异常。因此，如果您重定向标准流，请对您的应用程序进行编程以捕获 System.IO.IOException。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2013-08-21T20:04:34.247

我遇到了同样的问题，只是它是通过 SQL 任务调度程序运行 ac# 控制台应用程序。

我认为问题在于某些控制台方法和属性（Console.WindowWidth、Console.CursorLeft）正试图操纵控制台输出，这在控制台被重定向时是不可能的。

我将代码部分包装在一个简单的 try catch 块中，现在它工作正常。

```
//This causes the output to update on the same line, rather than "spamming" the output down the screen.
//This is not compatible with redirected output, so try/catch is needed.
try
{
    int lineLength = Console.WindowWidth - 1;
    if (message.Length > lineLength)
    {
        message = message.Substring(0, lineLength);
    }

    Console.CursorLeft = 0;
    Console.Write(message);
}
catch 
{
    Console.WriteLine(message);
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-23T08:25:16.197

试试这个来获取调用命令的输出流

```
Runtime r = Runtime.getRuntime();
mStartProcess = r.exec(applicationName, null, fileToExecute);

StreamLogger outputGobbler = new StreamLogger(mStartProcess.getInputStream());
outputGobbler.start();

int returnCode = mStartProcess.waitFor();

class StreamLogger extends Thread{

   private InputStream mInputStream;

   public StreamLogger(InputStream is) {
        this.mInputStream = is;
    }

   public void run() {
        try {
            InputStreamReader isr = new InputStreamReader(mInputStream);
            BufferedReader br = new BufferedReader(isr);
            String line = null;
            while ((line = br.readLine()) != null) {
                    System.out.println(line);
            }
        } catch (IOException ioe) {
            ioe.printStackTrace();
        }
    }

} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-23T08:51:09.747

这可能取决于您的 Java 应用程序是如何运行的。如果您的 java 应用程序没有控制台，那么当您的内部进程需要控制台存在时可能会出现问题。读[这个](http://msdn.microsoft.com/en-us/library/ms682075(VS.85).aspx)。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-29T11:03:30.650

没有更多细节很难诊断 - 也许权限......一点点异常处理（也许将堆栈跟踪写入stderr）将有很大帮助。但如果您不拥有该应用程序，则帮助不大。

如果你没有得到任何地方，你可以尝试使用[反射器](http://www.red-gate.com/products/reflector/)来查看 .NET 应用程序在“检测”期间正在做什么 - 它可能有助于确定原因。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-29T13:23:59.480

我认为你朋友的程序没有问题。您可能需要获取从 Runtime.getRuntime().exec(commandLine) 接收的流程对象的输出流，并调用 read() 方法或其他方法。它可能会起作用。

# vim - 你更喜欢如何在 Vim 中的缓冲区之间切换？

> ID：327411
> 
> 赞同：93
> 
> 时间：2008-11-29T10:24:28.360
> 
> 标签：vim, editor, buffer

我试过[MiniBufExplorer](http://www.vim.org/scripts/script.php?script_id=159)，但我通常会看到几个窗口显示它或完全关闭它。我想要的是像[LustyJuggler](http://www.vim.org/scripts/script.php?script_id=2050)这样的增量搜索，我在 Emacs 中的缓冲区之间切换的方式。肯定有这样的剧本吗？

* * *

## 回答 #1

> 赞同：76
> 
> 时间：2008-11-29T12:22:06.110

我曾经使用选项卡和多个`gvim`实例的组合，将相关文件组保留为每个实例中的选项卡。只要我没有在一个实例中出现太多选项卡，选项卡栏就会一目了然地显示您正在编辑的每个文件的名称。

然后我阅读了 Jamis Buck 的一篇关于他如何[从 TextMate 切换回 vim](http://weblog.jamisbuck.org/2008/10/10/coming-home-to-vim)的帖子，并学到了一些很棒的技巧：

*   `Ctrl`+`w` `s`和`Ctrl`+`w` `v`分割当前窗口
*   `Ctrl`+`6`在同一窗口中的两个缓冲区之间来回切换。
*   很棒的[fuzzyfinder.vim](http://www.vim.org/scripts/script.php?script_id=1984)，它可以自动完成搜索当前目录中的文件或当前打开的缓冲区
*   Jamis 自己的[blur_file_finder](http://github.com/jamis/fuzzy_file_finder/tree/master)和[blurfinder_textmate](http://github.com/jamis/fuzzyfinder_textmate/tree/master)稍微修改了`fuzzyfinder`工作方式，使其表现得更像一个类似的功能`TextMate`（据我所知，不同之处在于它匹配文件名中的任何位置，而不仅仅是从一开始）。观看[此视频](http://s3.amazonaws.com/buckblog/videos/fuzzyfinder_textmate.mov)以了解它的实际效果。

现在我只有一个`gvim`实例，将其最大化，然后将其拆分为多个窗口，这样我就可以一次查看多个文件。`Ctrl`我将+绑定`F`到`fuzzyfinder\_textmate`，所以现在如果我输入 (say) `Ctrl`+`F` `mod/usob`它会打开`app/models/user\_observer.rb`。我几乎再也不用担心标签了。

**更新 2010/08/07**

`fuzzyfinder\_textmate` 正如凯西在评论中指出的那样，虽然仍然很棒，但它已不再维护。此外，它（和/或`fuzzyfinder.vim`）在处理大型项目（大量目录或文件）时会变得有点慢和不稳定，所以我一直在寻找替代方案。

[幸运的是， Wincent Colaiuta](http://wincent.com)的[Command-T 插件](https://wincent.com/products/command-t/)形式似乎有一个很好的替代方案。这与 具有非常相似（如果不是稍微好一点）的行为`fuzzyfinder\_textmate`，但明显更快；它还具有很好的功能，例如能够以拆分或垂直拆分的方式打开找到的文件。感谢（和赞成！）大卫·里弗斯指出它。

* * *

## 回答 #2

> 赞同：33
> 
> 时间：2008-11-29T11:44:13.907

我使用基础 - ' `:ls`' + ' `:bn`'/' `:bp`' + ' `:b <part-of-name>`'

* * *

## 回答 #3

> 赞同：32
> 
> 时间：2008-12-01T03:17:46.580

我喜欢“ctrl-w s”和“ctlr-w v”来分割窗口。然后我映射移动键（h、j、k、l）并按住 ctrl 以在拆分窗口之间移动：

```
" Map ctrl-movement keys to window switching
map <C-k> <C-w><Up>
map <C-j> <C-w><Down>
map <C-l> <C-w><Right>
map <C-h> <C-w><Left> 
```

不得不将我的手移到箭头键上很烦人。

接下来，我设置 ctlr-tab 以在当前窗口中的缓冲区之间切换（就像许多其他环境一样）：

```
" Switch to alternate file
map <C-Tab> :bnext<cr>
map <C-S-Tab> :bprevious<cr> 
```

在过去的几年里，这些对我来说效果很好，尽管 vim 总是有比你知道的更多的秘密。

* * *

## 回答 #4

> 赞同：24
> 
> 时间：2010-08-01T03:43:48.230

我已经使用 Wincent Colaiuta 的[Command-T vim 插件](https://wincent.com/products/command-t/)几个月了。Wincent 用 C 写了它需要快速的部分，我必须说它是！而且，我认为它的文件模式匹配逻辑甚至比 Textmate 的 Command-T 还要好。查看[截屏视频](https://s3.amazonaws.com/s3.wincent.com/command-t/screencasts/command-t-demo.mov?width=640&height=480)。

> VIM 的 Command-T 插件提供了一种非常快速、直观的机制，可以用最少的按键次数打开文件。它被命名为“Command-T”，因为它的灵感来自于 TextMate 中绑定到 Command-T 的“转到文件”窗口。
> 
> 文件是通过键入出现在其路径中的字符来选择的，并由一种算法排序，该算法知道出现在某些位置（例如，紧跟在路径分隔符之后）的字符应该被赋予更多的权重。

[更轻松的缓冲区切换](http://vim.wikia.com/wiki/Easier_buffer_switching)包含许多有用的提示。我已将以下内容应用于我的 .vimrc，它执行缓冲区名称自动完成，将最有用的缓冲区切换命令映射到我的 <Leader> 和左侧主行键，并在状态行中显示当前缓冲区编号：

```
"" Tab triggers buffer-name auto-completion
set wildchar=<Tab> wildmenu wildmode=full

let mapleader = ","

map <Leader>t :CommandT<Return>
map <Leader>a :bprev<Return>
map <Leader>s :bnext<Return>
map <Leader>d :bd<Return>
map <Leader>f :b 

"" Show the buffer number in the status line.
set laststatus=2 statusline=%02n:%<%f\ %h%m%r%=%-14.(%l,%c%V%)\ %P 
```

我还使用[MiniBufExplorer](http://www.vim.org/scripts/script.php?script_id=159)，它在自己的水平拆分顶部提供每个列出的缓冲区的紧凑列表。

* * *

## 回答 #5

> 赞同：18
> 
> 时间：2011-12-19T14:33:41.597

```
nmap <Leader>bb :ls<CR>:buffer<Space> 
```

没有人提到不错的插件[ctrlp.vim](http://www.vim.org/scripts/script.php?script_id=3736)。使用此插件，您可以按名称搜索缓冲区。

* * *

## 回答 #6

> 赞同：15
> 
> 时间：2013-05-21T03:20:43.067

我用

`CTRL`-`J`用于下一个缓冲区

`CTRL`-`K`对于以前的缓冲区

`CTRL`-`L`下一个标签

`CTRL`-`H`对于上一个标签

这是`.vimrc`配置：

```
map <C-J> :bnext<CR>
map <C-K> :bprev<CR>
map <C-L> :tabn<CR>
map <C-H> :tabp<CR> 
```

见[http://syskall.com/my-biggest-vim-productivity-boost/](http://syskall.com/my-biggest-vim-productivity-boost/)

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2008-11-29T11:49:56.517

```
imap <A-1> <Esc>:tabn 1<CR>i
imap <A-2> <Esc>:tabn 2<CR>i
imap <A-3> <Esc>:tabn 3<CR>i
imap <A-4> <Esc>:tabn 4<CR>i
imap <A-5> <Esc>:tabn 5<CR>i
imap <A-6> <Esc>:tabn 6<CR>i
imap <A-7> <Esc>:tabn 7<CR>i
imap <A-8> <Esc>:tabn 8<CR>i
imap <A-9> <Esc>:tabn 9<CR>i

map <A-1> :tabn 1<CR>
map <A-2> :tabn 2<CR>
map <A-3> :tabn 3<CR>
map <A-4> :tabn 4<CR>
map <A-5> :tabn 5<CR>
map <A-6> :tabn 6<CR>
map <A-7> :tabn 7<CR>
map <A-8> :tabn 8<CR>
map <A-9> :tabn 9<CR> 
```

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2013-08-23T19:53:02.503

我最近变得更加简约。

要循环我使用的缓冲区`]b`和`[b`未受损的缓冲区：[https ://github.com/tpope/vim-unimpaired](https://github.com/tpope/vim-unimpaired)

要直接跳转到打开的缓冲区，只需使用 Vim 的制表符补全`:b`。几个字母足以到达任何带有一两个制表符的打开缓冲区。

`:e`与我使用相对路径和制表符完成的打开缓冲区类似。

我`:ls`偶尔也会使用来查看我打开了哪些缓冲区（并检查它们的修改状态）。

为了摆脱我`:bw`用来擦除缓冲区的缓冲区。我通常会进行临时拆分并更改缓冲区以保留我的布局，因为它`:bw`也会关闭活动窗口。

我尝试过的所有 minibuf 东西最终都让我烦恼，我不希望一些智能匹配的东西为我打开随机文件。如果我真的需要浏览某些内容，我会使用 NERDtree ( `:e .`)。

IDK，最近我也放弃了 Yankring（因为它搞砸了`xp`）并开始使用寄存器，我最近决定`f`/`t`动作是有史以来最伟大的事情......

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2011-12-19T12:57:38.583

要列出并在我使用的缓冲区之间切换：

```
nnoremap <Leader>l :ls<CR>:b<space> 
```

在缓冲区之间切换：

```
map <Leader>n :bn<CR>
map <Leader>p :bp<CR> 
```

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-11-29T13:53:06.613

出色的[Buffer Explorer](http://vim.sourceforge.net/scripts/script.php?script_id=42)已经变得如此强大的肌肉记忆力，以至于我发现自己希望可以在其他应用程序中使用它。当主动编辑两个以上的文件时，我发现它非常快。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2008-12-12T15:10:10.060

我花了很长时间来构建我的 .vimrc 来处理这个我已经从事了四年的 HTML::Mason 项目，所以我有一个奇怪的选项卡和拆分窗口组合。为了您的观赏乐趣：

```
map ;o :Sex <CR>
map <C-J> <C-W>j
map <C-K> <C-W>k
map <C-l> <C-W>l
map <C-h> <C-W>h
map ;] :tabnext<CR>
map ;[ :tabprev<CR>
map <C-t> :tabe +"browse ."<CR>
map <C-O> :NERDTreeToggle ~/curr/trunk/<CR> 
```

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2009-04-03T23:39:58.493

我使用[tselectbuffer](http://www.vim.org/scripts/script.php?script_id=1866)。它真的很快，不像 bufexplorer 不会在你的窗口中占用空间。它还有一个增量搜索。我尝试了 minibufexplorer，发现缓冲区中的导航有点困难。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2012-01-09T12:26:51.167

我已经将 and 映射`<S-J>`到`<S-K>`and `:bp`，`:bn`尽管我承认我不使用它，因为文件数大于 10。然后我将`<C-J>`and映射`<C-K>`到 Gnome Terminal 的上一个和下一个选项卡，并且我通常为每个运行 4 个 vim 实例我从事的 4 个不同的项目。我仍然真的希望下一个和上一个缓冲区能够进入我一直在处理的缓冲区的历史记录，而不是缓冲区列表中的顺序。

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2015-10-08T12:52:55.813

我使用 tselectbuffer。它真的很快，不像 bufexplorer 不会在你的窗口中占用空间。它还有一个增量搜索。我尝试了 minibufexplorer，发现缓冲区中的导航有点困难。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-11-29T10:28:49.207

我使用简单的 :vsplit 和 ^W+w/^W+r 和 :tabnew 和 Ctrl+Alt+PgUp/PgDown 组合键。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2014-01-04T22:06:01.760

当 Vim 会话中打开了多个缓冲区时，可能很难跟踪缓冲区及其各自的缓冲区编号。如果是这种情况，使用简单的映射可以更轻松地切换到不同的文件：

> :nnoremap (F5) :buffers(CR):buffer(空格)

[vim.wikia.com](http://vim.wikia.com/wiki/Easier_buffer_switching)

# vim - 可以在 Vim 中映射 Windows 键吗？

> ID：327415
> 
> 赞同：18
> 
> 时间：2008-11-29T10:28:02.987
> 
> 标签：vim, editor, keyboard-shortcuts, keymapping

在 Emacs 中使用 Windows 键作为 Meta 非常有用，有没有办法在 Vim 中做到这一点？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2014-04-08T13:11:01.667

即使在终端中，您也绝对可以，尽管您必须将其用作元键（我发现无法单独使用它）。

用 vim 编辑你的 .vimrc 文件。假设您想`Win+q`在正常模式下重新映射以退出 vim。只需添加您的映射，并在尝试指示您的快捷方式时，按`Ctrl+V`，然后按`Win+q`。

这将添加类似于`^X@sq`您的文件的内容（但**不要直接输入**，这`^X`是一个**特殊字符**）。

最后，您的行应如下所示：

```
nnoremap ^X@sq :q<CR> 
```

保存并退出，再次启动 vim，就是这样。

注意：`Ctrl+v`在插入模式下，按字面意思插入以下键/键组合。有关更多信息，请尝试`:help i_CTRL-V`使用 vim。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2012-07-04T12:23:51.897

很抱歉回答了这么古老的问题，但解决方案非常简单：在终端中无法使用 Win 键，但可以与 Gvim 一起使用。只需将其作为修饰符 T 传递即可。例如，

```
:nmap <T-F5> :q<cr> 
```

将 Win+F5 映射到 :q 命令。但它只能在 *nix 下使用。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-11-29T11:57:30.120

您可以使用[AutoHotkey 将](http://www.autohotkey.com/docs/misc/Remap.htm)windows 键映射到不同的键。仅当 vim 处于活动状态时才激活映射：

```
#IfWinActive ahk_class GVIM
RWin::Alt  
LWin::Alt  
#IfWinActive  ; This puts subsequent remappings and hotkeys in effect for all windows. 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2010-04-07T20:13:03.267

这些答案（包括这个）都不是特定于 vim 的，所选答案是特定于 Windows 的。这是运行 X 的 *nix 的一个。

我将左 Win 键映射到 Esc 键。这在虚拟终端中不起作用，但在 X 中起作用。

要么：
（1）追加`keysym Super_L = Escape`并`~/.Xmodmap`执行`xmodmap .Xmodmap`.
|______(1a) ~ 与 相同`echo "keysym Super_L = Escape" >> ~/.Xmodmap && xmodmap .Xmodmap`。
(2) 执行`xmodmap -e "keysym Super_L = Escape"`。

如果您希望它在虚拟终端中工作，请参阅 [0]。

参考文献：
[0] [http://www.mail-archive.com/screen-users@gnu.org/msg02859.html](http://www.mail-archive.com/screen-users@gnu.org/msg02859.html)
[1] [http://www.paganini.net/index.cgi/linux/nocaps.html](http://www.paganini.net/index.cgi/linux/nocaps.html)
[2] [http://ubuntuforums.org/archive/index.php/t-975229.html](http://ubuntuforums.org/archive/index.php/t-975229.html)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-29T11:12:45.093

不太确定，但`Ctrl`+`Esc`键组合是仅 Windows 的键映射。它对 vim 没有帮助

# deployment - 使用 Capistrano 通过 FTP 部署（非 Rails 站点）？

> ID：327417
> 
> 赞同：19
> 
> 时间：2008-11-29T10:29:34.107
> 
> 标签：deployment, capistrano

我该怎么办？

我有一个主要是静态的站点，它托管在一个便宜的网络主机上，它只允许 FTP 访问主机。该站点在 git 中进行跟踪。我正在使用 OS X。

我想通过简单地上传网站的新版本`cap deploy`

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-11-29T11:26:00.670

我们使用 capistrano 来部署我们用 PHP 编写的网站。

从内存中（我现在不在工作），我们重载部署并使用 rsync 通过 sftp 同步。像这样的东西：

```
desc "Sync"
namespace :deploy do

  desc "Sync remote by default"
  task :default do
    remote.default
  end

  namespace :remote do

      desc "Sync to remote server"
      task :default do
          `rsync -avz "/path/to/webapp" "#{remote_host}:#{remote_root}/path/to/webapp"`
      end
  end
end 
```

我相信您可以用任何 ftp 程序替换 rsync，它应该可以正常工作。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-29T11:42:20.683

我没有用 capistrano 尝试过，但是在我自己的 shell 脚本中，我一直使用 weex

( [http://weex.sourceforge.net/](http://weex.sourceforge.net/) )

通过 FTP 部署站点。想象一下，你也可以用 capistrano 破解它。

它保留 FTP 服务器状态的本地缓存，以便它只能上传更改的文件。这很好，大大加快了速度……但是（显然？），如果您的代码/其他内容通过其他方式更改，则会出错。因此，如果需要，可以不这样做。

# javascript - 在Javascript中计算日期差异的最佳方法是什么

> ID：327429
> 
> 赞同：41
> 
> 时间：2008-11-29T11:04:33.677
> 
> 标签：javascript

我在 Javascript 中做一个函数，比如 VisualBasic DateDiff。

您给出两个日期和返回时间间隔（秒、分钟、天等...）

```
DateDiff(ByVal Interval As Microsoft.VisualBasic.DateInterval, _
  ByVal Date1 As Date, ByVal Date2 As Date) as Long 
```

那么计算Javascript日期差异的最佳方法是什么？

* * *

## 回答 #1

> 赞同：62
> 
> 时间：2008-11-29T11:44:19.180

像这样使用[Date 对象](http://w3schools.com/jsref/jsref_obj_date.asp)：

```
function DateDiff(var /*Date*/ date1, var /*Date*/ date2) {
    return date1.getTime() - date2.getTime();
} 
```

这将返回两个日期之间的毫秒数差异。将其转换为秒、分钟、小时等应该不会太困难。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-29T11:09:48.453

如果您遵循本[教程](http://www.javascriptkit.com/javatutors/datedifference.shtml)，一种方法是使用：

```
Date.getTime() 
```

您将在此处找到完整的[javascript 函数](http://web.archive.org/web/20081202142917/http://javascript.internet.com/math-related/date-difference.html)，并完成日期验证。

话虽如此，正如[Rafi B.](https://stackoverflow.com/users/351947/rafi-b) 5 年后评论的那样，“[在 javascript 中获取 2 个日期之间的差异？](https://stackoverflow.com/a/15289883/6309) ”更加精确。

```
var _MS_PER_DAY = 1000 * 60 * 60 * 24;

// a and b are javascript Date objects
function dateDiffInDays(a, b) {
  // Discard the time and time-zone information.
  var utc1 = Date.UTC(a.getFullYear(), a.getMonth(), a.getDate());
  var utc2 = Date.UTC(b.getFullYear(), b.getMonth(), b.getDate());

  return Math.floor((utc2 - utc1) / _MS_PER_DAY);
} 
```

# c# - 强制服务中的线程等待另一个线程完成

> ID：327438
> 
> 赞同：2
> 
> 时间：2008-11-29T11:23:24.620
> 
> 标签：c#, .net, multithreading

我正在编写一个具有五种不同方法的服务，这些方法可能需要 5 秒到 5 分钟才能运行。

该服务将安排这些不同的方法以不同的时间间隔运行。

我不希望任何方法同时运行，那么我如何让这些方法检查另一个方法是否正在运行并在它完成时将自身排队运行？

安东尼

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-29T12:40:48.223

如果你想要*简单*，并且所有方法都在同一个类中，你可以使用`[MethodImpl]`：

```
[MethodImpl(MethodImplOptions.Synchronized)]
public void Foo() {...}

[MethodImpl(MethodImplOptions.Synchronized)]
public void Bar() {...} 
```

例如方法， this 锁定`this`; 对于静态方法，这锁定在`typeof(TheClass)`.

因此，这些锁定对象是公开的——因此有一个遥远的（但真正的）机会是另一位代码可能会锁定它们。通常认为创建自己的锁对象是更好的做法：

```
private readonly object syncLock = new object(); // or static if needed

...
public void Foo() {
   lock(syncLock) {
      ...
   }
} 
```

ETC

* * *

旁白：一个奇怪的事实；ECMA 规范没有为 [MethodImpl] 定义特定模式，甚至包括私有锁的示例，作为“有效”。但是，MS 规范坚持使用 this/typeof。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-29T12:39:40.583

有[MethodImplOptions.Synchronized 属性](http://msdn.microsoft.com/en-us/library/system.runtime.compilerservices.methodimploptions.aspx)，如文章[Synchronized method access in C#](http://bartdesmet.net/blogs/bart/archive/2006/10/02/4490.aspx)中所述，但这可能导致死锁，如 MSDN 中所述。听起来，对于您的使用，这不是一个大问题。

否则，最简单的方法是使用[lock 语句](http://msdn.microsoft.com/en-us/library/c5kehkcz.aspx)来确保一次只执行一个方法：

```
class ServiceClass
{
     private object thisLock = new object();

     public Method1()
     {
        lock ( thisLock )
        {
             ...
        }
     }

     public Method2()
     {
        lock ( thisLock )
        {
             ...
        }
     }
     ...
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-29T11:26:46.970

如果您使用的是 java，您可以使方法[同步](http://java.sun.com/docs/books/tutorial/essential/concurrency/syncmeth.html)，这将防止多个线程同时访问它。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-29T13:34:11.563

一般来说，我强烈反对使用 MethodImpl(MethodImplOptions.Synchronized) 属性来进行线程同步。如果你打算进行多线程编程，你真的应该非常仔细地考虑你应该在哪里以及如何锁定。

我可能有点夸大其词，但我发现 MethodImpl 同步方法与其他方法之间有太多相似之处，例如在 VB 中使用 End 语句。它经常向我发出信号，表明您并不真正知道自己在做什么，并希望此语句/方法/属性能神奇地解决您的问题。

# visual-studio-2008 - Windows Server 2008 作为开发机器 - 一步一步

> ID：327448
> 
> 赞同：16
> 
> 时间：2008-11-29T11:31:22.467
> 
> 标签：visual-studio-2008, sql-server-2005, iis, iis-7, windows-server-2008

我发现了许多关于使用 Windows Server 2003 作为开发机器的教程，而关于用于相同目的的 Windows Server 2008 的信息却很少。

为了获得更好的体验，我遵循了[将您的 Windows Server 2008 转换为工作站](http://www.win2008workstation.com/wordpress/)的步骤。

我正在搜索具有 IIS 6 兼容模式的 IIS 7、.NET Framework 3.5 SP1（是否需要安装`.NET Framework 3.0`功能，或者可以直接安装）、SQL Server 2005 SP2（带有报告服务和分析服务）的要求和安装顺序)，Visual Studio 2008 SP1。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-29T11:32:28.783

**`SQL Server 2005 - installation order`**（谢谢安东尼）

*   具有 IIS 6 向后兼容性的 IIS 7（用于报告服务）
*   知识库 950636
*   SQL 服务器 2005
*   [SQL Server 2005 SP3](http://www.microsoft.com/downloads/details.aspx?FamilyID=ae7387c3-348c-4faa-8ae5-949fdfbe59c4&displaylang=en)
*   [Visual Studio 2005 SP1](http://www.microsoft.com/downloads/details.aspx?FamilyId=BB4A75AB-E2D4-4C96-B39D-37BAF6B5B1DC&displaylang=en)（用于投标）
*   [适用于 Vista 的 Visual Studio 2005 SP1 更新](http://www.microsoft.com/downloads/details.aspx?familyid=90e2942d-3ad1-4873-a2ee-4acc0aace5b6&displaylang=en)（用于 BIDS）

**`SQL Server 2005 - links`**

*   [在 Windows Vista 上安装 SQL Server 2005 SP3 时出现错误消息：“Visual Studio 2005 与此版本的 Windows 存在已知的兼容性问题”](http://support.microsoft.com/?kbid=960320)
*   [Windows Server 2008 更新 (KB950636)](http://www.microsoft.com/downloads/details.aspx?familyid=FB0EE17E-96EB-4CBB-AC09-95A4DCF73077&displaylang=en) - 安装此更新可解决在运行 Windows Server 2008 的系统上未成功完成 SQL Server 2005 安装的问题。
*   [您在运行 Windows Vista 或 Windows Server 2008 服务器核心安装的计算机上的 SQL Server 2005 安装程序的系统配置检查页面上收到一条警告消息](http://support.microsoft.com/kb/920201/en-us)
*   [如何在运行 Windows Server 2008 的计算机上安装和配置 SQL Server 2005 Reporting Services](http://support.microsoft.com/kb/938245/)
*   [Windows Server 2008 上的 SQL Server 2005](http://www.codersbarn.com/post/2008/08/09/SQL-Server-2005-on-Windows-Server-2008.aspx)
*   [在 IIS 7 上安装 SQL Server 2005 报告服务](http://igregor.net/post/2008/01/Installing-SQL-Server-2005-Reporting-Service-on-IIS-7.aspx)
*   [适用于 Vista 的 SQL Server 用户配置工具](http://blogs.msdn.com/knom/archive/2007/03/02/sql-server-user-provisioning-tool-for-vista.aspx)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-29T11:31:43.840

**.NET Framework 3.5 Service Pack 1 - 安装顺序**

*   系统更新准备工具
*   .NET Framework 3.0（Windows Server 2008 功能）
*   [.NET Framework 3.5 SP1（完整包）](http://www.microsoft.com/downloads/details.aspx?displaylang=en&FamilyID=d0e5dea7-ac26-4ad7-b68c-fe5076bba986)
*   [.NET Framework 3.5 Service Pack 1 的更新可用 (KB959209)](http://support.microsoft.com/?kbid=959209)

**.NET Framework 3.5 Service Pack 1 - 链接**

*   在 Windows Vista 或 Windows 2008 Server 上安装 .NET Framework 3.5 SP1 之前，请确保已打开 Windows 更新服务。
*   [Windows Vista 和 Windows Server 2008 的系统更新准备工具说明](http://support.microsoft.com/kb/947821)- 由于 .NET Framework 2.0 和 3.0 是 Windows Vista 和 Windows Server 2008 上的操作系统组件，它们依赖于操作系统组件存储处于良好状态能够正确安装（引自[此处](http://forums.asp.net/p/1305769/2562990.aspx)）
*   [**统一 .NET Framework 故障排除指南**](http://blogs.msdn.com/astebner/articles/454956.aspx)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-01T07:09:36.473

[http://www.codersbarn.com/post/2008/08/09/SQL-Server-2005-on-Windows-Server-2008.aspx](http://www.codersbarn.com/post/2008/08/09/SQL-Server-2005-on-Windows-Server-2008.aspx)

我在 VMWare Workstation 上使用 W2K8 进行 SharePoint 开发，从第一天开始就没有麻烦。安装所有 IIS7 功能（包括 IIS6 兼容性的东西），你应该很高兴。

安东尼:-)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-10T08:59:43.703

**Visual Studio 2008 - 链接**

*   [将 Visual Studio 2008 与 IIS 7.0 一起使用](http://learn.iis.net/page.aspx/387/using-visual-studio-2008-with-iis-70/)
*   [无法在使用 VS2008 SP1 和 IIS7 的 Web 服务器上开始调试](http://social.msdn.microsoft.com/Forums/en-US/vsdebug/thread/dc3757fc-0933-4dc7-8587-242c4ef268fe/)
*   [无法在 Web 服务器上开始调试。IIS 不会列出与启动的 URL 匹配的应用程序。](http://social.msdn.microsoft.com/Forums/en-US/vsdebug/thread/04532b6d-e281-4b7f-a623-543dcb683e2f/)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-01T11:40:18.703

**IIS 7 - 安装顺序**

*   IIS 7（Windows Server 2008 角色）
*   [如果两个线程同时访问 IIS，您可能无法使用服务器管理器管理 IIS](http://support.microsoft.com/kb/946517/en-us)

**IIS 7 - 链接**

*   [在 Windows Server 2008 上安装 IIS 7.0](http://learn.iis.net/page.aspx/29/installing-iis7-on-windows-server-2008/)

**具有 IIS 6 向后兼容性的 IIS 7 - 链接**

*   [在 IIS 7 上安装 SQL Server 2005 报告服务](http://igregor.net/post/2008/01/Installing-SQL-Server-2005-Reporting-Service-on-IIS-7.aspx)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-13T06:40:18.030

**MSI 4.5 - 安装顺序**

*   [MSI 4.5 修补程序 - 当您使用 Windows Installer (MSI) 4.5 在 Windows Server 2008、Windows Vista、Windows Server 2003 或 Windows XP 中安装多个 MSI 程序包时出现错误消息：API 调用被拒绝 - 上下文中没有操作](http://support.microsoft.com/Default.aspx?kbid=958655)

**MSI 4.5 - 链接**

*   [更新至 MSI 4.5 (KB958655)](http://blogs.msdn.com/windows_installer_team/archive/2008/12/05/update-to-msi-4-5-kb958655.aspx)

# javascript - Javascript中的范围问题

> ID：327454
> 
> 赞同：3
> 
> 时间：2008-11-29T11:40:58.143
> 
> 标签：javascript, scoping

我需要一些关于 Javascript 中的范围界定问题的信息。我知道它支持词法（静态）范围，但是，它不也支持动态范围吗？如果您对 Javascript 中的作用域有所了解，请与我分享？

谢谢

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-29T12:26:33.743

我认为您很困惑，因为 Javascript 使用静态范围，但在函数级别，而不是像通常的结构化语言那样在块级别。

```
var foo = "old";
if (true) {var foo = "new";}
alert (foo == "new") 
```

所以要小心，块不会产生作用域！这就是为什么您有时会看到内部带有函数的循环只是为了启用范围在迭代内的变量：

```
functions = [];
for(var i=0; i<10; i++) {
   (function(){
       var local_i = i;
       functions[local_i] = function() {return local_i;}
   })();
}
functions[2]() // returns 2 and not 10 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-30T18:19:34.030

据我了解；Javascript有两种变量，全局变量和局部变量。但是，假设我们有一个名为 x 的变量，它被定义为全局变量，并且定义在引用 x 的地方范围的静态父级中。在这种情况下，x 取全局变量的值。因此，全局变量的优先级高于局部变量。而且，当没有任何全局变量时，x 通过静态链找到声明，这让我认为 Javascirpt 是静态作用域语言。

我在上面吗？

# asp.net - Web 应用程序的日志记录

> ID：327460
> 
> 赞同：1
> 
> 时间：2008-11-29T11:46:38.257
> 
> 标签：asp.net, log4net, logging

我正在使用 asp.net 构建一个相当大的站点（如果有任何兴趣，可以使用表单），我想知道我是否需要一个日志框架，例如 log4net。我以前使用过这样的框架，但我不知道如何将它用于此类项目。通常我认为客户交付的应用程序需要日志记录，可以将日志发送回然后分析错误。你怎么看？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-29T11:49:35.160

哎呀，日志记录对于 Web 应用程序*非常重要。*如果您正确登录，它会使故障排除*变得*更加容易。

Log4Net 作为一个框架可能是一个不错的选择。您可能还需要一种从多个服务器收集日志的方法——即使您目前不使用多个服务器，也可能值得建议您在某个时候这样做。

集中化的一种选择是将日志复制到数据库中 - 有关这方面的更多意见，请参阅[此问题。](https://stackoverflow.com/questions/290304)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-29T11:56:18.767

所有类型的应用程序都需要日志。如果您交付您的应用程序（无论是客户交付的还是内部交付的），无论是 Web 表单还是 smartclient/windows 应用程序日志记录/仪器都是它的支柱。

您的应用程序的最终用户如何知道应用程序正在按预期工作？如果发生任何错误会发生什么？生产团队将如何诊断错误？最终用户/管理员将如何主动分析应用程序并防止未来可能出现的问题？

由于您使用的是 ASP.net，我建议您也看看 ASP.net 的“健康监控”功能。

您可以为不同类型的日志记录编写自定义事件和提供程序，并可以将其配置为同步/异步使用。

您可以将 log4net 或企业日志记录块与“健康监控”一起使用，并且可以以最小的努力创建一个全面的日志记录/仪表解决方案。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-29T12:01:49.817

我肯定会担保企业信息接收器（我认为这是正确的名称，它是用于日志记录的 Microsoft api）或企业库。

I use the latter for all sorts of things such as caching, logging, etc, and it is a very powerful and time saving tool. I also use health monitoring. This is for a large web application that I am building.

You are spoilt for choice when it comes to logging in .NET, and the above two suggestions are great.

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-29T13:33:29.943

Logging is needed if you need to know how application behaves, in which conditions errors occur, who and how has used application (ip address, time, link,...)

Most people use it to trace program execution so they can answer questions like 'why it stopped working?', 'when did it stopped working?' etc.

If you know that applications code too well, and you can easily reproduce problems then I guess logging is overkill for you :)

# .net - 哪些开源项目使用了城堡活动记录？

> ID：327475
> 
> 赞同：3
> 
> 时间：2008-11-29T12:07:10.600
> 
> 标签：.net, castle-activerecord

除了演示之外，您能否建议任何使用城堡 activerecord 进行代码研究的开源项目？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-30T17:10:45.073

[google code](http://code.google.com/hosting/search?q=castle%20activerecord)上有不少。他们之中有一些是：

*   [酒窖经理](http://code.google.com/p/winecellarmanager/)
*   [先生博客引擎](http://code.google.com/p/mr-blogengine/)
*   [故事诗](http://code.google.com/p/storyverse/)
*   [盖亚冲刺](http://code.google.com/p/gaia-sprint/)
*   [攻城略地](http://code.google.com/p/storm-the-castle/)
*   [问题跟踪器.Net](http://code.google.com/p/issuetrackerdotnet/)

# c++ - SDL_event KEYDOWN 行为问题

> ID：327476
> 
> 赞同：3
> 
> 时间：2008-11-29T12:08:12.300
> 
> 标签：c++, sdl

这是问题所在，我编写了一个事件循环来检测 keydown 和 keyup 事件。我遇到的问题是 keydown 事件在按下并按住键时生成 keydown 和 keyup 事件。我正在使用箭头键移动对象，然后在释放键时停止移动（keyup）。任何帮助都会有所帮助。谢谢。=)

贾斯汀

PS我会发布代码，但我无法让它看起来正确。

```
print("         SDL_Event event;
    SDL_EnableKeyRepeat(0,0);
    while(SDL_PollEvent(&event)){
        switch(event.type){
        case SDL_QUIT:
            done = true;
            break;
        case SDL_KEYDOWN:
            switch(event.key.keysym.sym){
            case SDLK_ESCAPE:
                done = true;
                break;
            case SDLK_LEFT:
                animate_x = -5;
                cout << "left press\n";
                break;
            case SDLK_RIGHT:
                animate_x = 5;
                break;
            case SDLK_UP:
                animate_y = -5;
                break;
            case SDLK_DOWN:
                animate_y = 5;
                break;
            default:
                break;
            }
            break; -left out in original
        case SDL_KEYUP:
            switch(event.key.keysym.sym){
            case SDLK_LEFT:
                cout << "left up\n";
                animate_x = 0;
                break;
            case SDLK_RIGHT:
                animate_x = 0;
                break;
            case SDLK_UP:
                animate_y = 0;
                break;
            case SDLK_DOWN:
                animate_y = 0;
                break;
            default:
                break;
            }
            break; -left out in original
        }
    }"); 
```

在试图弄清楚如何发布代码时，我注意到我在两种情况下都遗漏了默认值。代码现在可以工作了。它不断地处理这些案例并执行与队列中的内容相匹配的代码。傻我。感谢所有的帮助。=)

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-30T10:48:08.747

看起来您启用了重复键。要禁用它，请使用

```
SDL_EnableKeyRepeat(0, 0); 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-01T05:50:40.127

您可能想要使用`SDL_GetKeyState`而不是跟踪 keydown/keyup；我使用它来检测键的即时状态，您可以使用它来确定键是否在连续帧上被按住。

# python - 将未绑定的python函数存储在类对象中

> ID：327483
> 
> 赞同：18
> 
> 时间：2008-11-29T12:21:47.467
> 
> 标签：python, function

我正在尝试在 python 中执行以下操作：

在名为 foo.py 的文件中：

```
# simple function that does something:
def myFunction(a,b,c):
  print "call to myFunction:",a,b,c

# class used to store some data:
class data:
  fn = None

# assign function to the class for storage.
data.fn = myFunction 
```

然后在一个名为 bar.py 的文件中： import foo

```
d = foo.data
d.fn(1,2,3) 
```

但是，我收到以下错误：

> TypeError：必须以数据实例作为第一个参数调用未绑定的方法 f()（改为获取 int 实例）

我想这很公平 - python 将 d.myFunction 视为类方法。但是，我希望它把它当作一个普通函数来对待——所以我可以调用它而不必在 myFunction 定义中添加一个未使用的“self”参数。

所以问题是：

***如何在不绑定到该类的情况下将函数存储在类对象中？***

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2008-11-29T12:28:33.927

```
data.fn = staticmethod(myFunction) 
```

应该做的伎俩。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-29T13:38:20.557

你可以做的是：

```
d = foo.data()
d.fn = myFunction

d.fn(1,2,3) 
```

这可能不是您想要的，但确实有效。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-30T10:21:24.167

感谢安德烈的回答——太简单了！

For those of you who care, perhaps I should have included the entire context of the problem. Here it is anyway:

In my application, users are able to write plugins in python. They must define a function with a well-defined parameter list, but I didn't want to impose any naming conventions on them.

So, as long as users write a function with the correct number of parameters and types, all they have to do is something like this (remember, this is the plugin code):

```
# this is my custom code - all plugins are called with a modified sys.path, so this
# imports some magic python code that defines the functions used below.
from specialPluginHelperModule import *

# define the function that does all the work in this plugin:
def mySpecialFn(paramA, paramB, paramC):
    # do some work here with the parameters above:
    pass

# set the above function:
setPluginFunction(mySpecialFn) 
```

The call to `setPluginFunction` takes the function object and sets it in a hidden class object (along with other plugin-configuration related stuff, this example has been simplified somewhat). When the main application wants to run the function, I use the `runpy` module to run the plugin code, and then extract the class object mentioned above - this gives me the configuration data and the plugin function so I can run it cleanly (without polluting my namespace).

This entire process is repeated multiple times for different plugins over the same input, and seems to work very well for me.

# workflow-foundation - 在 Windows 工作流基础中终止和暂停活动

> ID：327486
> 
> 赞同：1
> 
> 时间：2008-11-29T12:26:57.817
> 
> 标签：workflow-foundation

我需要停止执行是否有使用终止和暂停活动的程序

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-10T09:02:25.960

微软网站上的这个示例应该可以帮助您暂停和终止活动

[http://msdn.microsoft.com/en-us/library/ms742189.aspx](http://msdn.microsoft.com/en-us/library/ms742189.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-10T17:24:06.727

这完全取决于您想要做什么。有一个 Terminate Activity 将终止正在运行并已到达该活动的工作流实例。一旦终止，该工作流实例将失效并且永远无法重新启动。

暂停是您可以在 WorkflowInstance 上调用的东西，例如

```
WorkflowInstance instance = runtime.GetWorkflow(instanceId);
instance.Suspend("Paused for some good reason");

// do something here

instance.Resume(); 
```

# java - 帮助我在 JPA 中的选择查询有问题

> ID：327487
> 
> 赞同：0
> 
> 时间：2008-11-29T12:28:27.813
> 
> 标签：java, jpa

我有问题我想

从杂志中选择 name_magazine

我已经导入了所有需要的库

和

> 查询 q = EntityManger.createQuery("SELECT name_magazine FROM Magazine");
> 
> 列表结果 = (List) q.getResultList ();
> 
> For(Sting s : 结果)
> 
> System.out.println(s);

但是当我运行这段代码时，它是错误的。有人能帮我吗？谢谢

这是我运行程序时的错误

> 209) 在 tugas_rpl.Tugas_RPLView.Iseng(Tugas_RPLView.java:734) ... 34 更多原因：异常 [TOPLINK-8034] (Oracle TopLink Essentials - 2.0.1 (Build b09d-fcs (12/06/2007)) ): oracle.toplink.essentials.exceptions.EJBQLException 异常描述：编译查询时出错 [Select m.Name from magazine m]。未知的抽象模式类型 [杂志]。在 oracle.toplink.essentials.exceptions.EJBQLException.unknownAbstractSchemaType(EJBQLException.java:494) 在 oracle.toplink.essentials.internal.parsing.ParseTreeContext.classForSchemaName(ParseTreeContext.java:163) 在 oracle.toplink.essentials.internal.parsing .VariableNode.resolveClass(VariableNode.java:280) 在 oracle.toplink.essentials.internal.parsing.DotNode.resolveMapping(DotNode.java:254) 在 oracle.toplink。

我已经尝试过 Vincent Ramdhanie，Guðmundur Bjarni 的建议

> 查询 q = entityManager.createQuery("从杂志 m 中选择 m.name");
> 
> 列表结果 = (List) q.getResultList();
> 
> For(Sting s : 结果)
> 
> System.out.print(s);

但仍然错误

这是我使用的库和变量

> 私有 javax.persistence.EntityManager 实体管理器；
> 
> 导入 org.jdesktop.application.Action；
> 
> 导入 org.jdesktop.application.ResourceMap；
> 
> 导入 org.jdesktop.application.SingleFrameApplication；
> 
> 导入 org.jdesktop.application.FrameView；
> 
> 导入 org.jdesktop.application.TaskMonitor；
> 
> 导入 org.jdesktop.application.Task；
> 
> 导入 java.awt.event.ActionEvent；
> 
> 导入 java.awt.event.ActionListener；
> 
> 导入 java.util.ArrayList；
> 
> 导入 java.util.List；
> 
> 导入 javax.swing.Timer；
> 
> 导入 javax.swing.Icon；
> 
> 导入 javax.swing.JDialog；
> 
> 导入 javax.swing.JFrame；
> 
> 导入 javax.swing.event.ListSelectionEvent；
> 
> 导入 javax.swing.event.ListSelectionListener；
> 
> 导入 org.jdesktop.beansbinding.AbstractBindingListener；
> 
> 导入 org.jdesktop.beansbinding.Binding；
> 
> 导入 org.jdesktop.beansbinding.PropertyStateEvent；
> 
> 导入 javax.persistence.*；

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-29T17:51:55.787

答案就在您的异常的调用堆栈中：

```
Error compiling the query [Select m.Jenis_Motor from motor m]. Unknown abstract schema type [motor]. 
```

这不是您的杂志查询的问题，而是另一个格式错误的查询 - 可能是在其他地方定义的命名查询。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-29T12:44:57.733

您可能应该说出错误到底是什么。

但是，假设您有一个实体杂志，那么查询应该是：

```
 select m from Magazine m 
```

如果你想要所有的杂志。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-29T12:57:12.217

为此，您需要一个这样定义的实体：

```
@Entity
@Table(name = "magazines")
public class Magazine {
  /*
   * Some more attributes
   */

  @Column(name = "name_magazine")
  private String name;

  /*
   * Constructors, getters and setters
   */
} 
```

此外，您需要一个指向您的实体的 persistence.xml 文件。如果所有这些都到位，则此查询应该可以工作并为您提供所有杂志的列表。

```
from Magazine m 
```

您指定的查询是它的投影，并且我在上面显示的实体应该是

```
select m.name from Magazine m 
```

希望这可以帮助。:)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-07-03T15:17:54.660

你重命名了你的班级吗？

类名可能与命名查询中使用的名称不同

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2018-02-14T05:45:04.957

如果您使用的是 JPA，那么在查询中您需要编写 className 和 object，如下所示

```
Query q = EntityManger.createQuery ("SELECT name_magazine e FROM Magazine e"); 
```

e 是 Magazine 类的对象。如果您在 EntityManager 中创建查询时遇到此异常，请查看您的 persistence.xml 文件，您需要在该文件中的 persistence-unit 标记之后添加类

```
<class>PackageName.className</class> 
```

# asp.net - 将 ADODB.Recordset 类型从 .NET 返回到经典 ASP

> ID：327495
> 
> 赞同：0
> 
> 时间：2008-11-29T12:43:11.403
> 
> 标签：asp.net, asp-classic, data-access-layer

我有一个 DAL，我想在从经典 asp 执行时返回一个 ADODB.recordset。该对象作为 com 对象公开，我有一个完整的 dal 工作，但我不确定如何返回一个对象，该对象是 .net 可以使用的记录集。

任何帮助都会得到帮助。谢谢！

——尼古拉斯

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-29T13:00:45.627

您需要在 Web 项目中添加对 COM 基础 ADODB 的引用以及对 DAL 组件的引用。然后，您应该能够像在 ASP 中一样使用该组件。

那就是说你应该阅读这个知识库：-

[KB312111](http://support.microsoft.com/kb/312111)

我强烈建议您首先考虑将 DAL 移植到 .NET 程序集。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-01T19:45:14.933

我认为你们俩都可以提供反馈，但由于问题写得不好，我想做的事情可能被误解了。我找到了一个链接，该链接完全符合我的要求。

我所拥有的是一个 DAL，它是我想向 ASP 公开的程序集，但这样做是为了避免重写大量代码，我需要首先找到一种方法，仅在从 Classic 调用时才返回记录集的类型ASP 应用程序。这将通过一个 COM 公开的方法调用来实现，该方法调用将对 DAL 进行调用并将返回的 .NET DataSet 转换为 VB RecordSet。

这是我发现的使这成为可能的链接。 [http://www.codeproject.com/KB/database/ADOConversion.aspx](http://www.codeproject.com/KB/database/ADOConversion.aspx)

再次感谢您的帮助和您的意见，对于这样一个写得不好的问题，我深表歉意。

——尼古拉斯

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-30T05:57:28.663

同安东尼所说的一样，如果你能通过一切手段避免这种情况，那就去做吧。如果您的 DAL 是一个非常通用的 DAL，您可能可以在 .net 中编写一个或使用其他人（如 Application Block）并花费更少的时间来处理可能出现的问题。

# asp.net-mvc - 为什么从 ASP.net MVC 中取出验证请求？

> ID：327499
> 
> 赞同：5
> 
> 时间：2008-11-29T12:45:13.397
> 
> 标签：asp.net-mvc, xss

在标准的 ASP.net 应用程序中，ASP.net 提供了一些针对 XSS 攻击的保护，如果有人尝试，则使用 validateRequest throwing 检测危险的输入错误。此功能似乎已从 MVC 中删除，知道为什么吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-02T08:31:28.130

我知道这个问题很老，但我想我还是可以回答的。

有一个 ValidateInput 操作过滤器属性可以添加到操作中。

```
[ValidateInput(true)]
public ActionResult Foo()
{

} 
```

您还可以在模型属性上使用 AllowHtml 属性

```
public class MyModel
{
    public Guid ID { get; set; }

    [AllowHtml]
    public string SomeStringValue { get; set; }
} 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-29T12:57:36.427

这是一条难以跨越的界限。您的 Web 应用程序是否只是“应该”的 RESTful Web 资源？还是它试图做更多。接下来你知道你有 100 个隐藏的输入字段：__VIEWSTATE、__EVENTTARGET、__EVENTARGUMENT 等等。

如您所知，您仍然可以在 MVC 中防止 XSS 攻击。只需[谷歌它就](http://www.google.com/search?hl=en&q=asp.net+mvc+xss&aq=f&oq=)可以看到几个例子。但原因基本上是 MVC 是一种不同的、“更干净”的 Web 应用程序。

编辑：我不知道我上面所说的是否清楚。但这个想法是 MVC 不会试图超越它的本质（就像 ASP.NET 所做的那样）。他们都有自己的优点和理由。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-29T13:20:47.880

无论如何，我希望你有比 ValidateRequest 更强大的东西来避免 XSS。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-25T19:27:16.917

我发现 ValidateRequest 解决方案是一个 hack。在我看来，“避免 XSS”是一个业务规则；因此让模型处理这种情况。

我真的很喜欢关于希望更好地遵循 REST 原则的解释。至于100个隐藏字段，让我想起了我几年前提供的一个ASP解决方案；我使用大量隐藏字段来携带元数据。不漂亮。

# windows - 批处理文件以保留十行之一

> ID：327500
> 
> 赞同：2
> 
> 时间：2008-11-29T12:50:47.673
> 
> 标签：windows, batch-file

我有一个包含 n 行的文件。（n 超过 1 亿）

我想输出一个 10 行中只有 1 行的文件，我不能将文件分成十部分并只保留一部分，因为它必须更随机一些。稍后我必须进行统计分析，我无法在数据中产生强烈的偏差）。

如果记录号 mod 10 然后输出它，我正在考虑读取文件和每条记录。

约束是：

*   它是一台 Windows（可能是加固的）计算机，可能是 XP Vista 或 Windows server 2003。

*   没有可用的开发工具

*   没有网络，USB，CD-ROM。没有对外交流。

因此我在考虑windows批处理文件（我不能假设powershell，并且vbscript很可能已被删除）。目前正在查看 FOR /F 命令。我仍然不是专家，我不知道如何做到这一点。

*谢谢保罗的回答。我重新格式化（在 Hosam 的帮助下）将答案放入批处理文件中：*

```
@echo off
setlocal   
findstr/N . inputFile| findstr ^[0-9]*0: >temporaryFile
FOR /F "tokens=1,* delims=: " %%i in (temporaryfile) do echo %%j > outputFile 
```

*感谢 quux 和 Pax 提供类似的替代解决方案。然而，在对较大的文件进行快速测试后，Paul 的答案大约快了 8 倍。我想评估（在 SET 中）有点慢，即使逻辑看起来很棒。*

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-29T13:07:19.950

好的，我想我已经破解了它：

```
findstr/N . path-to-log-file | findstr ^[0-9]*0: 
```

（使用 findstr 将行号添加到行首，然后再次仅打印行号以零结尾的行）

因此，您将得到 10 行中的一行，但每行都附加了行号和冒号

~~如果我能想到一种仅使用命令行工具将其剥离的方法，我将编辑此答案:)~~

删除行号和冒号

```
FOR /F "tokens=1,2* delims=: " %i in (file-with-linenumbers) do echo %j 
```

保罗。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-29T13:30:42.727

这是一个小命令脚本，可以执行您想要的操作（准确地每 10 行打印出文件lines32.txt）。该文件（用于我的测试）包含数字 1 到 32（含），每行一个，输出为 10、20、30。

```
@echo off
setlocal

set /a "n = 0"
for /f %%i in (lines32.txt) do call :fn %%i
endlocal
goto :eof

:fn
set /a "n = n + 1"
if not %n%==10 goto :eof
echo %1
set /a "n = 0"
goto :eof 
```

自从糟糕的旧 DOS 时代以来，Windows 命令语言已经取得了长足的进步。我仍然不认为它与 ksh 或 bash 匹配，但它做得不错。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-29T13:40:21.803

保罗有一个非常好的答案。通过添加重定向运算符，您可以将数据写入文件。

```
findstr /n . yourLogFile.txt | findstr ^[0-9]*0: > numberedFile.txt
for /f "tokens=1,2* delims=:" %i in (numberedFile.txt) do echo %j > smallFile.txt
del numberedFile.txt 
```

如果从命令行运行，这将起作用。如果要将其放入批处理文件中，请将每个 '%' 字符替换为 '%%'（这样 %i 将变为 %%i，而 %j 将变为 %%j，因为在批处理文件中 '%' 有特殊含义）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-29T13:43:47.880

选择的答案可能需要很长时间来处理，因为它必须处理整个文件两次。如果该文件有数百万行......哇哦。

这就是我想出的。它会简单地按顺序处理文件，每 10 行打印一次（以您喜欢的任何数字结尾）：

```
@ECHO OFF
SETLOCAL
SET lastdigit=7
SET linecounter=0
FOR /F "tokens=*" %%a IN (text.txt) DO CALL :picker %%a
ENDLOCAL
GOTO :eof

:picker
set line=%*
IF {%linecounter:~-1%} == {%lastdigit%} ECHO %linecounter% %line%
SET /a linecounter=%linecounter% + 1
GOTO :eof 
```

每行都有编号，从零开始。任何 %linenumber% 以 %lastdigit% 结尾的行都会与行号一起回显到控制台。使用集合 /? 看看我是如何想出那个 {%linecounter:~-1%} 的东西（它只是去掉了除了最后一位 linenumber 之外的所有内容）。

# javascript - 改变某种元素的innerHTML的最好方法

> ID：327506
> 
> 赞同：2
> 
> 时间：2008-11-29T12:58:02.417
> 
> 标签：javascript

我有一个带有几个 Div 的 HTML 页面，它将显示现在和每个给定日期之间的时间差。

```
<div class="dated" onEvent="calculateHTML(this, 'Sat Jun 09 2007 17:46:21')">
30 Minutes Ago</div> 
```

我希望该时间差是动态的（在页面加载时以及在时间间隔内计算到所有元素）

所以，我的想法是去所有“过时”类的div，计算每个div的时间差并替换对应的innerHTML。

这是最好的方法还是我应该尝试不同的方法？

编辑：
我遇到的问题之一是，我在 div 中的哪个位置保存，将用于生成文本的日期？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-29T13:34:12.750

您可以使用 jQuery 之类的库来简化您的生活。该库允许您选择具有特定类的所有元素并将函数应用于每个元素。也可以让它等到 DOM 完全加载后再执行。像这样：

```
$(document).ready(function(){
    $(".dated").each(function (i) {
        //your code here--this refers to the current element
    });

}); 
```

它带有许多插件，例如[计时器](http://plugins.jquery.com/project/Timer)插件，可帮助您定期运行代码。我自己没有测试过计时器插件，但你可以设置如下：

```
$(document).ready(function(){
 $.timer(1000, function (timer) {
    $(".dated").each(function (i) {
        //your code here--this refers to the current element
    });

 });
}); 
```

[编辑] 也许您可以在页面开头的变量中声明日期。然后差异代码将计算当前日期减去存储在变量中的日期。也就是说，如果每个元素都是从同一日期计算的？否则，使用隐藏元素来存储每个元素的日期。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-29T14:44:47.537

文森特的解决方案看起来不错。对于日期，您可以执行以下操作：

```
<div class="dated">
  <span style="display: none">'Sat Jun 09 2007 17:46:21'</span>
  <p>30 minutes ago.</p>
</div> 
```

然后读出span并替换p的innerHTML。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-29T13:20:23.357

使用innerHTML 在大多数情况下（全部？）都有效，并且通常可能比生成一堆HTML 更快（即在这种情况下不是）。

我总是喜欢使用如下所示的标准方法，因为我知道它们永远不会中断。[请注意，我不直接检查 'class' 属性，因为一个元素可能有多个类。]

```
function adjustDates() {
    var i;
    var elms = document.getElementsByTagName("div");
    for (i = 0; i < elms.length; i++) {
        var e = elms[i];

        /* update timestamps with date */
        if (elementHasClass(e, "dated")) {
            var txt = YOUR_DIFFERENCE_CODE(e);
            e.replaceChild(document.createTextNode(txt), e.lastChild);
        }
    }
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-29T17:02:09.257

当您开始获取用户数据时，请**始终**使用 dom 方法将用户数据附加到页面并假设所有用户数据都将包含诸如“ ' > 和 href 之类的可怕内容。

此处的“用户数据”包括您自己没有生成的任何文本字符串。这包括浏览器用户代理、应用程序库版本字符串等所有内容。

（这很容易出错，所以我的建议是在任何地方都使用 DOM 方法，除非你*知道* 你有速度问题。配置文件并且不要过早优化）

# html - Firefox中的自动完成用户/密码

> ID：327512
> 
> 赞同：0
> 
> 时间：2008-11-29T13:15:34.770
> 
> 标签：html, firefox, autocomplete, passwords

我已经在 HTML 中创建了一个登录提交表单，但由于某种原因，用户/密码自动完成功能不像我在 Firefox 中所期望的那样工作。

这就是 Firefox 中发生的情况：

*   我提供用户名和密码，然后单击登录按钮
*   如果我想记住密码，Firefox 会提示我。我按“记住”并登录工作。（我确保在运行此测试之前删除了所有记住的密码）
*   我注销并返回登录页面。我希望预先填写用户名和密码字段，但事实并非如此（如果 FF 只为特定 URL 存储了一个用户/密码组合，那么它会自动在您的表单中预先填写此组合）

请注意，我不（想）使用 cookie。我在 FF 密码管理器中验证了用户名和密码实际上已被存储（它们是）

这是此页面的代码：

```
<form name="login_form" id="login_form" autocomplete="ON" onsubmit="javascript:xajax_action_login(document.getElementById('user_name').value, document.getElementById('password').value); return false;">
    <div class="login_line">
        <div class="login_line_left">name</div>
        <div id="user_name_id" class="login_line_right"><input size="16" maxlength="16" name="user_name" id="user_name" type="text"></div>
    </div> <!-- login_line -->
    <div class="login_line">
        <div class="login_line_left">password</div>
        <div id="password_id" class="login_line_right"><input size="16" maxlength="16" name="password" id="password" type="password"></div>
    </div> <!-- login_line -->
    <div class="login_line">
        <div class="login_line_left"> </div>
        <div class="login_line_right"><input class="button" value="login" type="submit">
    </div> <!-- login_line -->
</form> <!-- login_form --> 
```

我的代码有什么问题？如何使用我的代码自动完成以在 FF 中工作？

自动补全确实适用于例如 gmail。每次我访问 gmail 的登录页面时，电子邮件和密码字段都已正确预填。我不使用“在这台计算机上记住我”复选框，因此不使用 cookie。

我会非常感谢您的帮助。碧玉

 **Firefox 中启用了**更新自动完成功能。**我想保持 IE 兼容。**

 *** * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-29T13:18:57.057

网址是静态的还是动态的，自动完成不适用于动态网址，比如说您的网址是：

```
http://www.domain.come/login.php?someDynamicVarLikeAdateOrSo=12312

```

然后密码保存将不起作用，然后您应该使用 modrewrite 或其他东西将 url 显示为浏览器的静态

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-24T16:49:22.747

我发现了为什么它不起作用。我使用 ajax 将示例 html 粘贴到容器 div 中。显然firefox对此非常敏感，因为（如前所述）我的代码确实可以在IE中运行。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-29T14:42:21.147

首先，检查是否在 Firefox 中启用了自动完成功能。
然后尝试将文本框的“类型”属性设置为“自动完成”。详细信息在[这里](https://developer.mozilla.org/en/XUL/textbox_(Firefox_autocomplete))

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-01T03:24:52.433

看起来你`autocomplete="ON"`在`<form>`标签中。尝试将其更改为`autocomplete="on"`- 即删除“ON”的大写。

# java - Java中的模糊字符串搜索库

> ID：327513
> 
> 赞同：76
> 
> 时间：2008-11-29T13:17:11.927
> 
> 标签：java, nlp, fuzzy-search

我正在寻找用于模糊字符串搜索的高性能 Java 库。

有许多算法可以找到相似的字符串、Levenshtein 距离、Daitch-Mokotoff Soundex、n-gram 等。

存在哪些 Java 实现？对他们有利有弊？我知道 Lucene，任何其他解决方案或 Lucene 是最好的？

我找到了这些，有人有经验吗？

*   [SimMetrics](http://www.dcs.shef.ac.uk/~sam/simmetrics.html)
*   [NGramJ](http://ngramj.sourceforge.net/)

* * *

## 回答 #1

> 赞同：41
> 
> 时间：2008-11-29T14:58:12.067

Commons Lang 有一个[Levenshtein distance](http://commons.apache.org/lang/apidocs/org/apache/commons/lang3/StringUtils.html#getLevenshteinDistance%28java.lang.CharSequence,%20java.lang.CharSequence%29)的实现。

Commons Codec 有[soundex](http://commons.apache.org/proper/commons-codec/apidocs/org/apache/commons/codec/language/Soundex.html)和[metaphone](http://commons.apache.org/proper/commons-codec/apidocs/org/apache/commons/codec/language/Metaphone.html)的实现。

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2016-09-14T17:54:33.570

[如果您主要是比较短字符串并想要一些可移植和轻量级的东西，您可以使用移植到 Java](https://github.com/xdrop/fuzzywuzzy)的著名的 python 算法 blurwuzzy 。

[你可以在这里](http://chairnerd.seatgeek.com/fuzzywuzzy-fuzzy-string-matching-in-python/)阅读更多关于它的信息

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2015-10-14T12:43:57.323

您可以使用 Apache Lucene，但根据用例，这可能太重了。对于非常简单的模糊搜索，使用起来可能有点复杂（如果我错了，请纠正我）它需要你建立一个索引。

如果您需要一个简单的在线（= 不维护索引）算法，您可以使用模糊[Bitap 算法](https://en.wikipedia.org/wiki/Bitap_algorithm)。[我在这里](https://github.com/simon-watiau/Bitap-in-Java)找到了 Java 的实现。它的代码适合单个相对较短的方法，具有几乎不言自明的签名：

```
public static List<Integer> find(String doc, String pattern, int k) 
```

Apache Commons`StringUtils`实现了用于模糊字符串匹配的 Levenshtein 算法。可以看成是的模糊版`String.equals`，Bitap 就像是模糊版，`String.indexOf`仍然使用 Levenshtein 距离度量。它通常比天真地使用 Levenshtein 将搜索模式与可能匹配的每个子字符串进行比较更有效。

**备注**：

*   Bitap 算法似乎对相对较小的字母表非常有用，例如纯 ASCII。事实上，我链接到的 Simon Watiau 版本会抛出`ArrayIndexOutOfBoundsException`非 ASCII 字符 (>= 128)，因此您必须将它们过滤掉。
*   我尝试在应用程序中使用 Bimap 按姓名搜索内存中的人员列表。我发现 Levenhstein 距离为 2 会导致太多误报。Levenhstein 距离为 1 效果更好，但它无法检测到交换两个字母的错字，例如“William”和“Willaim”。我可以想出一些方法来解决这个问题，例如

    1.  仅当精确搜索未找到匹配项时才进行模糊搜索（并向用户显示有关此的消息）
    2.  调整 Bitap 以使用 Damerau-Levenshtein 距离，其中交换的距离为 1 而不是 2。根据[wikipedia](https://en.wikipedia.org/wiki/Damerau%E2%80%93Levenshtein_distance)，这是可能的，但我在 Java 中找不到现有的实现。
    3.  而不是“包含”做一个“startsWith”。[模糊搜索工具](https://code.google.com/p/fuzzy-search-tools/)包含 Damerau-Levenshtein 的前缀版本，但它给了我一个`ArrayIndexOutOfBoundsException`
    4.  调整算法以引入精确匹配得分更高的搜索结果排名

    如果您要执行 2 或 4，则最好还是使用像 Lucene 这样的适当全文搜索库。

*   更多关于模糊搜索的信息可以在[这个博客](http://ntz-develop.blogspot.nl/2011/03/fuzzy-string-search.html)上找到。[它的作者还在Java 中](https://code.google.com/p/fuzzy-search-tools/)创建了一个名为的实现`BitapOnlineSearcher`，但需要您`java.io.Reader`与 Alphabet 类一起使用。它的 Javadoc 是用俄语编写的。

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2008-12-18T17:18:51.650

SimMetrics 可能是您需要的：http: [//sourceforge.net/projects/simmetrics/](http://sourceforge.net/projects/simmetrics/)

它有几种算法用于计算各种类型的编辑距离。

Lucene 是一个非常强大的全文搜索引擎，但 FT 搜索与模糊字符串匹配并不完全相同（例如，给定一个字符串列表，找到与某个候选字符串最相似的那个）。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2011-10-28T22:21:43.100

到 Lucene 我会添加 SOLR [http://wiki.apache.org/solr/AnalyzersTokenizersTokenFilters](http://wiki.apache.org/solr/AnalyzersTokenizersTokenFilters)

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2016-09-19T16:18:03.940

您可以尝试[Completely](https://github.com/fmmfonseca/completely)库，它依赖于文本预处理来创建内存索引，以便在大型数据集中有效地回答（模糊）搜索。与 Lucene 和其他功能齐全的文本搜索库不同，该 API 很小且易于上手。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-29T13:40:29.510

[我认为Apache Lucene](http://lucene.apache.org/)是唯一的方法。我不知道任何更好的搜索库。

> Apache Lucene(TM) 是一个完全用Java 编写的高性能、全功能的文本搜索引擎库。它是一种适用于几乎所有需要全文搜索的应用程序的技术，尤其是跨平台的应用程序。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2010-04-06T14:48:02.377

你可以试试bitap。我正在玩用 ANSI C 编写的 bitap，它非常快，在[http://www.crosswire.org](http://www.crosswire.org)中有 java 实现。

# asp.net - ASP.net 应用程序中的 SecurityException

> ID：327520
> 
> 赞同：1
> 
> 时间：2008-11-29T13:27:50.143
> 
> 标签：asp.net, azure, securityexception, cloud-platform

我有一个查询 Lucene 索引的网络应用程序，它在我的网络中的 W2K3 服务器中运行良好。现在我得到了我的天蓝色代码，所以我想测试上传应用程序的服务。为了做到这一点，我必须安装 Vista（我是在虚拟机中安装的），因为 Azure SDK 不会安装在 XP 机器上。

我创建了我的云服务，从我的应用程序中添加了文件，但是当我运行它（只是 F5）时，我得到一个 SecurityException，当我调用 Lucene 来查询索引时，说：

> 应用程序试图执行安全策略不允许的操作。要授予此应用程序所需的权限，请联系您的系统管理员或在配置文件中更改应用程序的信任级别。

我一直在谷歌搜索，我发现的解决方案涉及修改 machine.config 文件，这是我无法“在云中”做的事情。

有人可以帮忙吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-02T14:49:11.270

好的，如果有人遇到同样的问题，这是我从 Azure 论坛得到的正确答案：

> 这是因为 Windows Azure CTP 的信任策略。环境变量 TEMP 和 TMP 可用并适当设置。但是，System.IO.Path.GetTempPath 和 System.IO.GetTempFile 不起作用，因为它们需要不受限制的环境权限。我建议您联系 Lucene 开发人员，看看他们是否可以修改代码，使其在中等信任环境中正常运行。

感谢 Daniel C. Wang 的回答。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-04T22:01:39.353

我还发现了一个关于我的相同问题以及如何解决的问题。
这里是链接：[Lucene.Net 在我的主机上失败，因为它调用 GetTempPath()。有什么工作？](https://stackoverflow.com/questions/194795/lucenenet-fails-at-my-host-because-it-calls-gettemppath-whats-the-work-around)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-01T17:57:36.523

您可以更改 web.config 中的信任，除非 machine.config 中不允许这样做（通常在共享主机中）。在你的看跌期权中，看看会发生什么。

如果不允许您这样做，请查看您是否可以通过与您的提供商交谈来获得您的控制 GACd。如果这不起作用，很抱歉，但你不走运。有时您可以找到不需要完全信任特定方法的解决方法，但如果第三方 dll 需要它，您无能为力

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2008-11-29T13:42:21.923

还没有这样做，但是否有可能拥有实时操作环境的桌面版本？这似乎是故障排除的良好开端。

# .net - asp.net mvc 中的链接安全修整

> ID：327525
> 
> 赞同：2
> 
> 时间：2008-11-29T13:31:46.407
> 
> 标签：.net, asp.net-mvc, sitemap, security-trimming

我想在 asp.net mvc web 应用程序中显示一些仅指向经过身份验证的用户的链接。

*   我在 Visual Studio 2008 中使用了 asp.net mvc Web 应用程序的模板，该模板随 asp.net mvc 的 beta 版本一起提供。
*   我使用表单身份验证。
*   我想在现有视图中添加如下内容：

```
<a href="/Account/ChangePassword">更改密码</a>

```

并且只显示登录用户的链接。

最简单的方法是什么？我想要一些简单的东西，比如我用 asp.net 网络表单尝试过的 web.sitemap 的安全修整。（可以与 mvc 一起使用吗？还是仅用于 Web 表单？）

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-28T21:41:34.097

您可以像这样构建一个自定义 SiteMapProvider：

[使用安全修整构建 ASP.NET MVC 站点地图提供程序](http://blog.maartenballiauw.be/post/2008/08/29/Building-an-ASPNET-MVC-sitemap-provider-with-security-trimming.aspx)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-29T13:42:29.643

以下应该工作。如果用户在浏览器中手动输入 URL，您还需要在控制器操作中执行类似的操作。或者，正如您所说，您可以限制对 web.config 中操作的访问。

```
 <% if (HttpContext.Current.Request.IsAuthenticated) { %>
    <a href="/Account/ChangePassword">Change password</a>
 <% } %> 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-29T13:45:18.047

显示更改密码链接

显示登录链接

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-29T16:11:24.743

你可以简单地做到这一点：

[更改密码](/Account/ChangePassword)

# c++ - 我可以优化具有 3 个 for 循环和 4 个 if 的代码吗？

> ID：327531
> 
> 赞同：1
> 
> 时间：2008-11-29T13:38:27.530
> 
> 标签：c++, algorithm

我发了另一个帖子

[在这里](https://stackoverflow.com/questions/326885/a-loop-to-create-neighbor-nodes-in-3d-space)我问如何在 3-d 空间中创建一个立方体素节点的 26 个邻居。我得到了一个很好的答案并实施了它。

为此，我添加了一些 MIN MAX Position 检查。

我想知道是否有**与 3 个 for 循环和 4 个 if used 相关**的方法来改善此代码的执行时间。我在另一篇文章中读到，当使用 while 循环时速度更快，但它是在一篇非特定语言的文章中。

这是真的？如果是的话，你能在我的代码中帮我解决这个问题，因为我很幸运吗？有没有办法以一种更快的方式递归地实现它？

这是我的代码：

```
...
std::vector<Pos> Create26Neighbor(Pos somePos, double resol) 
{
    std::vector <Pos> vect1;
    Pos  m_MinPos(0.0,0.0,0.0);
    Pos  m_MaxPos(5.0,4.0,5.0);

    for (double dz = somePos.m_pPos[2] - resol; dz <= somePos.m_pPos[2] + resol; dz+=resol)
    {
        if (dz>m_MinPos.m_pPos[2] && dz<m_MaxPos.m_pPos[2])
        {
            for (double dy = someCPos.m_pPos[1] - resol; dy <= someCPos.m_pPos[1] + resol; dy+=resol)
            {
                if (dy>m_MinPos.m_pPos[1] && dy<m_MaxPos.m_pPos[1])
                {
                    for (double dx = somePos.m_pPos[0] - resol; dx <= somePos.m_pPos[0] + resol; dx+=resol)
                    {
                        if (dx>m_MinPos.m_pPos[0] && dx<m_MaxPos.m_pPos[0])
                        {
                            // all 27
                            if ((dx != somePos.m_pPos[0]) || (dy != somePos.m_pPos[1]) || (dz != somePos.m_pPos[2]))
                            {
                                Pos tempPos(dx,dy,dz);
                                vect1.push_back(tempPos);
                            }
                        }
                    }
                }
            }
        }
    }
    return vect1;
}
.... 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-29T14:40:07.780

首先，摆脱 if 语句。不需要他们。您可以将它们合并到循环条件中。其次，避免每次迭代都重新计算循环条件。是的，编译器可能会将其优化掉，但它通常对浮点优化非常保守（并且它可能会将从内存中读取的 fp 值与从寄存器中读取的值区别对待，这意味着它*无法*消除循环中的数组查找条件），因此通常最好手动进行简单的优化：

```
std::vector<Pos> Create26Neighbor(Pos somePos, double resol) 
{
    std::vector <Pos> vect1(27); // Initialize the vector with the correct size.
    Pos  m_MinPos(0.0,0.0,0.0);
    Pos  m_MaxPos(5.0,4.0,5.0);

    double minz = std::max(somePos.m_pPos[2] - resol, m_MinPos.m_pPos[2]);
    double maxz = std::min(somePos.m_pPos[2] + resol, m_MaxPos.m_pPos[2];
    int i = 0;
    for (double dz = min; dz <= max; dz+=resol)
    {
        double miny = std::max(somePos.m_pPos[1] - resol, m_MinPos.m_pPos[1]);
        double maxy = std::min(somePos.m_pPos[1] + resol, m_MaxPos.m_pPos[1];
        for (double dy = miny; dy <= maxy; dy+=resol)
        {
            double minx = std::max(somePos.m_pPos[0] - resol, m_MinPos.m_pPos[0]);
            double maxx = std::min(somePos.m_pPos[0] + resol, m_MaxPos.m_pPos[0];

            for (double dx = minx; dx <= maxx; dx+=resol)
            {
                ++i;
                // If we're not at the center, just use 'i' as index. Otherwise use i+1
                int idx = (dx != somePos.m_pPos[0] || dy != somePos.m_pPos[1] || dz != somePos.m_pPos[2]) ? i : i+1;
                vec1[idx] = Pos(dx, dy, dz); // Construct Pos on the spot, *might* save you a copy, compared to initilizing it, storing it as a local variable, and then copying it into the vector.
              }
        }
    }
    return vect1;
} 
```

我要考虑的最后一点是内部 if 语句。紧密循环中的分支可能比您预期的要昂贵。我可以想出多种方法来消除它：

*   正如我在代码中所勾画的那样，可以诱使 ?: 运算符为中心值计算不同的向量索引（因此它被写入下一个向量元素，因此在下一次迭代中再次被覆盖）。这将消除分支，但总体上可能会或可能不会更快。
*   拆分循环，以便在“resol”值之前和之后有单独的循环。这有点尴尬，有很多较小的循环，并且整体效率可能较低。但它会消除内部 if 语句，因此它也可能更快。
*   允许将中心点添加到向量中，然后忽略它，或者在循环之后将其删除（这将是一个有点昂贵的操作，并且可能会或可能不会得到回报。如果您使用双端队列，它可能会更便宜而不是向量。

并确保编译器展开内部循环。手动展开它也可能有帮助。

最后，很大程度上取决于如何定义 Pos。

请注意，我建议的大部分内容都符合“它可能不会更快，但是......”。您必须不断地对所做的每一项更改进行分析和基准测试，以确保您确实在提高性能。

根据您愿意走多远，您可以将所有内容合并到一个循环中（在整数上运行），并在每次迭代中即时计算 Pos 坐标。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-29T14:46:27.863

如果没有像域过滤这样的“智能”，你可能不会找到很多方法来简化这样的三次方程。

真的，我在这里发帖的真正原因是代码实在是**太牛了**，即：哎呀。呸。我对过度嵌套的代码有个人和最近发展的厌恶，并且会努力将其中一些内部循环导出到单独的函数，**尽管**它会增加额外的理论开销（分析它，小函数通常会内联）

我个人的观点是，如果你的代码是高性能的，但没有人能理解它，它比次优但可维护的代码更糟糕。

* * *

此外，如果您可以保证坐标的数量相对于起点是固定的，您可以通过对结构进行硬编码来受益，即手工完成，即：

```
function generate26( x,y,z ){ 
   return [ 
   # Top 
     # Left
      [x-1,y+1,z-1], 
      [x-1,y+1,z],
      [x-1,y+1,z+1]
   ];
}
```

或者生成一个或 2 个宏来为您完成。

至少这样你完全依赖编译器优化内存结构的能力，没有循环或任何东西。（可以肯定的是，对其进行概要分析）

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-29T13:45:32.227

*   从语言的角度来看，您可以通过在向量中保留 26 个（或 27 个，具体取决于您的意思是什么数字 :)）项来提高性能：

    `std::vector<Pos> vect1; vect1.reserve(27);`

    这将使内部数组足够大并避免重新分配向量。

*   无论是返回向量，还是通过引用传递向量并写入性能更高，只能通过测试来确定。编译器可以优化掉返回值副本。

通常，如果您优化算法本身（或通过选择另一个算法），您将获得更多的性能提升，而不是尝试优化其实现。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-29T15:35:13.537

> 有没有办法以一种更快的方式递归地实现它？

不，真的，**不**。

递归意味着函数调用，通常是大量的。函数调用意味着堆栈操作和（可能）上下文更改，这是相对较慢的操作。

递归是一个强大的工具，可以用来做一些非常棘手的事情，同时保持可读性，但它不是一种高性能技术。在最好的情况下，您可能会找到一个优化尾递归的编译器，使其运行速度与正常循环一样快——这是通过在幕后将递归代码转换为正常循环来实现的。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-29T19:54:45.900

```
std::vector<Pos> Create26Neighbor(Pos somePos, double resol) 
{
    std::vector<Pos> vect1(26);
    Pos  m_MinPos(0.0,0.0,0.0);
    Pos  m_MaxPos(5.0,4.0,5.0);

    double z = somePos.m_pPos[2] - resol;

    for(int dz = -1; dz <= 1; ++dz) {
        z += resol;
        if(z <= m_MinPos.m_pPos[2] || z >= m_MaxPos.m_pPos[2])
            continue;

        double y = somePos.m_pPos[1] - resol;

        for(int dy = -1; dy <= 1; ++dy) {
            y += resol;
            if(y <= m_MinPos.m_pPos[1] || y >= m_MaxPos.m_pPos[1])
                continue;

            double x = somePos.m_pPos[0] - resol;

            for(int dx = -1; dx <= 1; ++dx) {
                x += resol;

                if(dx == 0 && dy == 0 && dz == 0)
                    continue;

                if(x <= m_MinPos.m_pPos[0] || x >= m_MaxPos.m_pPos[0])
                    continue;

                vect1.push_back(Pos(x, y, z));
            }
        }
    }

    return vect1;
} 
```

我试图优化它以提高可读性。你*真的*关心速度吗？我认为速度对于创建一些邻居节点并不重要。您是否分析过您的代码以查看这是否是瓶颈？

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-29T19:27:45.937

所以基本上，在正常情况下，您希望向向量添加 26 个位置，这些位置可以很容易地枚举，*除了*您必须小心不要访问超出范围的体素。

如果您真的，真的，想最大限度地优化这个功能，最优化的实现将是单个开关和展开的循环。

对于 3 个维度中的每一个，只有五种可能性：

```
case 1:  {somePos[i] - resol};  // 1 value only
case 2:  {somePos[i] - resol, somePos[i]}   // 2 values
case 3:  {somePos[i] - resol, somePos[i], somePos[i] + resol}  // all 3
case 4:                      {somePos[i], somePos[i] + resol}  // 2 values again
case 5:                                  {somePos[i] + resol}  // 1 value only 
```

还有一个“案例0”，其中*没有任何*值在范围内。但是，如果对于任何维度都是如此，那么您根本不需要添加任何值。

结合三个维度中的每一个维度的 5 种可能性，您可以实现 125 种可能的情况。鉴于您拥有 125 个案例中的哪一个，您可以将循环和 if 展开为最多 26 个 push_back() 调用的序列。

像这样的东西：

```
enum eCase {
CASE_NONE = 0,
CASE_LOW1 = 1,
CASE_LOW2 = 2,
CASE_ALL3 = 3,
CASE_HIGH2 = 4,
CASE_HIGH1 = 5,
};

eCase Xcase = /* a function of somePos[0], m_MinPos[0], m_MaxPos[0], and resol */
eCase Ycase = ...
eCase Zcase = ...

#define MUNGE(_x,_y,_z) (((((_x)*6)+(_y))*6)+(_z))
switch (MUNGE(Xcase, Ycase, Zcase) {

default:
    break;  // all CASE_NONE's do nothing
case MUNGE (CASE_ALL3, CASE_ALL3, CASE_ALL3):
    vect1.push_back( pos (somePos.m_pPos[0] - resol, somePos.m_pPos[1] - resol, somePos.m_pPos[2] - resol));
    vect1.push_back( pos (somePos.m_pPos[0] - resol, somePos.m_pPos[1] - resol, somePos.m_pPos[2]        ));
    vect1.push_back( pos (somePos.m_pPos[0] - resol, somePos.m_pPos[1] - resol, somePos.m_pPos[2] + resol));
    vect1.push_back( pos (somePos.m_pPos[0] - resol, somePos.m_pPos[1]        , somePos.m_pPos[2] - resol));
    vect1.push_back( pos (somePos.m_pPos[0] - resol, somePos.m_pPos[1]        , somePos.m_pPos[2]        ));
    vect1.push_back( pos (somePos.m_pPos[0] - resol, somePos.m_pPos[1]        , somePos.m_pPos[2] + resol));
    vect1.push_back( pos (somePos.m_pPos[0] - resol, somePos.m_pPos[1] + resol, somePos.m_pPos[2] - resol));
    vect1.push_back( pos (somePos.m_pPos[0] - resol, somePos.m_pPos[1] + resol, somePos.m_pPos[2]        ));
    vect1.push_back( pos (somePos.m_pPos[0] - resol, somePos.m_pPos[1] + resol, somePos.m_pPos[2] + resol));

    vect1.push_back( pos (somePos.m_pPos[0]        , somePos.m_pPos[1] - resol, somePos.m_pPos[2] - resol));
    vect1.push_back( pos (somePos.m_pPos[0]        , somePos.m_pPos[1] - resol, somePos.m_pPos[2]        ));
    vect1.push_back( pos (somePos.m_pPos[0]        , somePos.m_pPos[1] - resol, somePos.m_pPos[2] + resol));
    vect1.push_back( pos (somePos.m_pPos[0]        , somePos.m_pPos[1]        , somePos.m_pPos[2] - resol));
    vect1.push_back( pos (somePos.m_pPos[0]        , somePos.m_pPos[1]        , somePos.m_pPos[2] + resol));
    vect1.push_back( pos (somePos.m_pPos[0]        , somePos.m_pPos[1] + resol, somePos.m_pPos[2] - resol));
    vect1.push_back( pos (somePos.m_pPos[0]        , somePos.m_pPos[1] + resol, somePos.m_pPos[2]        ));
    vect1.push_back( pos (somePos.m_pPos[0]        , somePos.m_pPos[1] + resol, somePos.m_pPos[2] + resol));

vect1.push_back( pos (somePos.m_pPos[0] + resol, somePos.m_pPos[1] - resol, somePos.m_pPos[2] - resol));
vect1.push_back( pos (somePos.m_pPos[0] + resol, somePos.m_pPos[1] - resol, somePos.m_pPos[2]        ));
vect1.push_back( pos (somePos.m_pPos[0] + resol, somePos.m_pPos[1] - resol, somePos.m_pPos[2] + resol));
vect1.push_back( pos (somePos.m_pPos[0] + resol, somePos.m_pPos[1]        , somePos.m_pPos[2] - resol));
vect1.push_back( pos (somePos.m_pPos[0] + resol, somePos.m_pPos[1]        , somePos.m_pPos[2]        ));
vect1.push_back( pos (somePos.m_pPos[0] + resol, somePos.m_pPos[1]        , somePos.m_pPos[2] + resol));
vect1.push_back( pos (somePos.m_pPos[0] + resol, somePos.m_pPos[1] + resol, somePos.m_pPos[2] - resol));
vect1.push_back( pos (somePos.m_pPos[0] + resol, somePos.m_pPos[1] + resol, somePos.m_pPos[2]        ));
vect1.push_back( pos (somePos.m_pPos[0] + resol, somePos.m_pPos[1] + resol, somePos.m_pPos[2] + resol));
break; 
```

... 仅剩 124 个案例！

***不要 - 重复 不要***真的手动编写所有这些代码！！！如果不编写一个难以发现的错误，任何人都无法做到这一点。编写另一个程序来编写源代码。:-)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-29T13:50:26.180

您所有的 for 循环本质上都是以下形式：

```
for (d_ = somPos._ - resol; d_ <= somPos_.+resol; d_+= resol) 
```

这恰好执行了 3 次。如果将这三个 for 循环替换为以下形式，则此代码可能会变得更快：

```
double dz = somePos.m_pPos[2] - resol; 
for(z = 0; z < 3; z++, dz += resol) 
```

在此处使用常见的 for 循环形式将允许优化器在需要时展开这些循环。我认为您拥有的另一种形式不够简单，以至于优化器无法确定它实际上只会发生 3 次。这个是。

编辑：此外，如果您对 MinPos/MaxPos 值使用 const 或 #define，编译器可能会*稍微*加快我们的速度。我不认为它能够以你拥有它们的方式确定值真的是常数。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-11-29T13:52:13.527

将相等性与浮点数进行比较是非常危险的并且容易出错。

按值传递和返回对象？根据您的对象，这可能会减慢速度。

就优化而言，尽可能在最“外”的循环中测试变量。但实际上，您要担心的问题似乎远比循环优化要大得多。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-11-29T20:06:21.070

我还没有试图弄清楚，但你可以用 SSE2/Altivec/其他向量指令做一些漂亮的事情，一次做多个比较。

# python - 在 Python 字典中存储和更新列表：为什么会发生这种情况？

> ID：327534
> 
> 赞同：27
> 
> 时间：2008-11-29T13:40:05.547
> 
> 标签：python, dictionary, list

我有一个如下所示的数据列表：

```
// timestep,x_position,y_position
0,4,7
0,2,7
0,9,5
0,6,7
1,2,5
1,4,7
1,9,0
1,6,8 
```

...我想让它看起来像：

```
0, (4,7), (2,7), (9,5), (6,7)
1, (2,5), (4,7), (9,0), (6.8) 
```

我的计划是使用字典，其中 t 的值是字典的键，而键的值将是一个列表。然后我可以将每个 (x,y) 附加到列表中。就像是：

```
# where t = 0, c = (4,7), d = {}

# code 1
d[t].append(c) 
```

现在这会导致 IDLE 失败。但是，如果我这样做：

```
# code 2
d[t] = []
d[t].append(c) 
```

...这行得通。

所以问题是：为什么代码 2 有效，但代码 1 无效？

PS 对我计划做的任何改进都会引起极大的兴趣！我想我必须通过输入检查每个循环上的字典，看看字典键是否已经存在，我猜是通过使用类似 max(d.keys()): 如果它存在，附加数据，如果不创建空列表作为字典值，然后在下一个循环中追加数据。

* * *

## 回答 #1

> 赞同：72
> 
> 时间：2008-11-29T13:46:42.053

让我们看看

```
d[t].append(c) 
```

的价值是`d[t]`多少？尝试一下。

```
d = {}
t = 0
d[t] 
```

你得到了什么？哦。里面没有任何东西`d`有`t`.

现在试试这个。

```
d[t] = []
d[t] 
```

啊。现在有一些东西`d`用`t`.

您可以做几件事。

1.  使用示例 2。
2.  使用`setdefault`. `d.setdefault(t,[]).append(c)`.
3.  使用[collections.defaultdict](http://www.python.org/doc/2.5.2/lib/defaultdict-objects.html)。您将使用 a`defaultdict(list)`而不是简单的字典，`{}`.

* * *

**编辑1.优化**

给定来自上述形式的文件的输入行：ts、x、y，分组过程是不必要的。没有理由从 (ts, x, y) 的简单列表转到更复杂的 (ts, (x,y), (x,y), (x,y), ... ) 列表。原始列表可以在到达时完全处理。

```
d= collections.defaultdict(list)
for ts, x, y in someFileOrListOrQueryOrWhatever:
    d[ts].append( (x,y) ) 
```

* * *

**编辑 2\. 回答问题**

“初始化字典时，你需要告诉字典键值数据结构是什么样的吗？”

我不确定这个问题是什么意思。由于所有字典*都是*键值结构，因此问题不是很清楚。因此，我将回顾这三个备选方案，这可能会回答这个问题。

**示例 2**。

初始化

```
d= {} 
```

采用

```
if t not in d:
    d[t] = list()
d[t].append( c ) 
```

每个字典值都必须初始化为一些有用的结构。在这种情况下，我们检查密钥是否存在；当密钥丢失时，我们创建密钥并分配一个空列表。

**默认设置**

初始化

```
d= {} 
```

采用

```
d.setdefault(t,list()).append( c ) 
```

在这种情况下，我们利用该`setdefault`方法获取与键关联的值或创建与缺失键关联的新值。

**默认字典**

初始化

```
import collections
d = collections.defaultdict(list) 
```

采用

```
d[t].append( c ) 
```

使用`defaultdict`初始化函数来丢失键。在这种情况下，我们提供了一个`list`函数，以便为缺少的键创建一个新的空列表。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-11-29T14:28:09.927

我想你想使用 setdefault。使用起来有点奇怪，但正是你需要的。

```
d.setdefault(t, []).append(c) 
```

如果该键存在，该`.setdefault`方法将返回绑定到字典键的元素（在我们的例子中是一个列表） 。`t`如果没有，它会将一个空列表绑定到该键`t`并返回它。因此，无论哪种方式，都会有一个列表，`.append`然后该方法可以将元组附加到该列表`c`。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-29T13:53:34.007

```
dict=[]  //it's not a dict, it's a list, the dictionary is dict={}
elem=[1,2,3]
dict.append(elem) 
```

您可以通过这种方式访问​​单个元素：

```
print dict[0] // 0 is the index 
```

输出将是：

```
[1, 2, 3] 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-01T22:54:25.863

如果您的数据尚未按所需标准排序，以下代码可能有助于对数据进行分组：

```
#!/usr/bin/env python
"""
$ cat data_shuffled.txt
0,2,7
1,4,7
0,4,7
1,9,0
1,2,5
0,6,7
1,6,8
0,9,5
"""
from itertools   import groupby
from operator    import itemgetter

# load the data and make sure it is sorted by the first column
sortby_key = itemgetter(0)
data = sorted((map(int, line.split(',')) for line in open('data_shuffled.txt')),
              key=sortby_key)

# group by the first column
grouped_data = []
for key, group in groupby(data, key=sortby_key):
    assert key == len(grouped_data) # assume the first column is 0,1, ...
    grouped_data.append([trio[1:] for trio in group])

# print the data
for i, pairs in enumerate(grouped_data):
    print i, pairs 
```

输出：

```
0 [[2, 7], [4, 7], [6, 7], [9, 5]]
1 [[4, 7], [9, 0], [2, 5], [6, 8]] 
```

# java - Strange floating-point behaviour in a Java program

> ID：327544
> 
> 赞同：10
> 
> 时间：2008-11-29T13:44:48.250
> 
> 标签：java, math

In my program I have one array with 25 double values 0.04 When I try to sum these values in a loop I get following results:

```
0.0 + 0.04 = 0.04
0.04 + 0.04 = 0.08
0.08 + 0.04 = 0.12
0.12 + 0.04 = 0.16
0.16 + 0.04 = 0.2
0.2 + 0.04 = 0.24000000000000002
0.24000000000000002 + 0.04 = 0.28
0.28 + 0.04 = 0.32
0.32 + 0.04 = 0.36
0.36 + 0.04 = 0.39999999999999997
0.39999999999999997 + 0.04 = 0.43999999999999995
0.43999999999999995 + 0.04 = 0.4799999999999999
0.4799999999999999 + 0.04 = 0.5199999999999999
0.5199999999999999 + 0.04 = 0.5599999999999999
0.5599999999999999 + 0.04 = 0.6
0.6 + 0.04 = 0.64
0.64 + 0.04 = 0.68
0.68 + 0.04 = 0.7200000000000001
0.7200000000000001 + 0.04 = 0.7600000000000001
0.7600000000000001 + 0.04 = 0.8000000000000002
0.8000000000000002 + 0.04 = 0.8400000000000002
0.8400000000000002 + 0.04 = 0.8800000000000002
0.8800000000000002 + 0.04 = 0.9200000000000003
0.9200000000000003 + 0.04 = 0.9600000000000003 
```

Why on earth could that happen?!

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2008-11-29T13:50:08.630

The most common storage for floating-point values in programming languages - [IEEE singles and doubles](http://en.wikipedia.org/wiki/IEEE_754) - does not have exact representations for most decimal fractions.

The reason is that they store values in binary floating-point format, rather than decimal floating-point format. The only fractional values which can be represented exactly are those which are sums of negative powers of two. Numbers like:

*   0.5 (2^-1)
*   0.125 (2^-3)
*   0.625 (2^-1 + 2^-3)

Etc.

What you are seeing is the fact that representations of numbers like 0.96 are not exactly representable, because they are not expressible as a sum of negative powers of two. Thus, when printed out with full precision as a decimal fraction, they won't match the original value.

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-11-29T13:52:24.757

See also "[What Every Computer Scientist Should Know About Floating Point](http://docs.sun.com/source/806-3568/ncg_goldberg.html)"

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-11-29T14:10:42.880

Other answers mentioned why, but not how to avoid it.

There are several solutions:

*   Scaling: if all your numbers are multiples of 0.01 (for instance), multiply everything by 100 and use integer arithmetic (which is exact).
*   Numeric type: if your language has a numeric type (like a `numeric` type in SQL), you can use it.
*   Arbitrary precision rationals: use a bignum library like [GMP](http://gmplib.org/), which allows you to represent these numbers as the ratio of two integers.
*   Decimal floating point: if you have a decimal floating point like the one in [IEEE-754r](http://en.wikipedia.org/wiki/IEEE_754_revision#decimal_arithmetic), you can use it.

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-29T21:44:36.207

You may wish to check out the java [BigDecimal](http://java.sun.com/j2se/1.5.0/docs/api/java/math/BigDecimal.html) class as an alternative to floats and doubles.

# vim - 带有 Viper 和 Vimpulse 的 Emacs 中缺少哪些 Vim 功能？

> ID：327555
> 
> 赞同：21
> 
> 时间：2008-11-29T13:52:21.513
> 
> 标签：vim, emacs, editor, viper-mode, vimpulse

Vim 中缺少 Emacs 的一些重要功能，例如 comint 模式，并且没有脚本/插件可以替代它们。

与 Emacs 相比，Vim 也有一些好处，例如模式编辑和通常更好的默认快捷方式。然而，毒蛇模式让我两者兼得。Vimpulse 还启用了可视模式。不幸的是，没有任何模式可以让 Emacs 像 Vim 一样快速运行。

所以我主要学习 Vim-in-Emacs。我缺少哪些 Vim 功能？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-12-01T12:04:19.000

我是一个普通的 vim 用户，但不是一个 emacs 用户，并且没有用来`vimpulse`确认这一点。

但是浏览下面的 vimpulse 代码，我看不到文本对象的提及。

[http://www.emacswiki.org/cgi-bin/wiki/vimpulse.el](http://www.emacswiki.org/cgi-bin/wiki/vimpulse.el)

Vim 引入了一些非常有用的用于选择和移动的习语，这些习语在常规 vi 中没有

*   `cat`xml / html标签的'cut around tag'
*   `diw`'在单词中删除'
*   `di(` `di"`删除`""` `()`等内的文本。

在 vim 帮助中查看`:he`text-objects 以获得更多信息。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-11-30T19:32:51.340

> 不幸的是，没有任何模式可以让 Emacs 像 Vim 一样快速运行。

如果您的意思是 emacs 启动时间很短，您可以通过永久打开 emacs 会话来显着缩短它，并在需要编辑文件时使用 gnuclient/emacsclient。

[http://www.emacswiki.org/emacs/GnuClient](http://www.emacswiki.org/emacs/GnuClient)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-12-19T19:11:08.470

我在 emacs 中错过的一个 vi 功能是`.`重复上次编辑的 (dot) 命令。有[dot-mode.el](http://wyrick.org/source/elisp/dot-mode/)可以实现`C-.`模拟这一点，但它并不总是对我有用（我不精通 elisp 以找出原因）。

甚至 viper 也没有像 vi 那样实现这个命令（上次我检查过），即使它实现了，我认为这还不足以让我开始使用 viper。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-09-16T01:39:40.303

要获得 vimpulse 可能缺少的类型的完整列表

:helpgrep 不在 Vi 中

将列出帮助中与 vi 不兼容的每个功能。

大约有 700 场比赛。

当然会有很多重复的功能

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-12-12T04:18:22.323

Vi 随处移动 - 在 Vi 中，无论您是在目录列表、帮助文件、只写文件还是允许编辑的内容中，您始终可以使用相同的快捷方式进行导航。

正确的视觉和删除行为 - 与 emacs 标记非常相似，但习惯上不同，因此 Vi 用户很难重新训练。如果您已经习惯了 emacs 标记，那么您并没有真正错过任何东西。

正确的转义行为 - 应该取消所有其他模式活动并将您返回到命令模式。同样，如果您对 emacs 感到满意，那么您可能已经习惯了模态输入等。

关于 Vi 被部署在世界上每个 nix 系统上的明显栗子（Gentoo 纯粹主义者纠正我？） - 无论如何，在我看来这不是一个非常强烈的论点。

这些是我在使用 emacs+viper 期间突然出现的。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-29T06:51:23.667

Vim 宏似乎不适用于 viper/vimpulse：

[在 Emacs 中使用 viper + vimpulse 时，Vim 宏不起作用](https://stackoverflow.com/questions/98225/vim-macros-dont-work)

（顺便说一句，让我关心 vim/vimpulse 的杀手级 emacs 功能是不同的框架可以编辑同一个文件。这就像有一个拆分，两个部分可以在不同的窗口中。如果有人知道如何在 vim 中完成，你会是我的英雄。）

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-08-14T04:43:59.933

使用 / 和 ? 进行增量搜索 不见了。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-09-02T01:16:14.433

作为一个喜欢 emacs*作为操作系统*和 vi*作为输入模型*的爱好者，我自然而然地想喜欢 viper。然而，在使用它的两秒钟内，我不得不放弃它：**viper 不支持 C-[ 作为转义键的替代品——这是 vi***中*最常用命令的必要快捷方式。

# asp.net - 表设计成嵌套数据列表

> ID：327562
> 
> 赞同：1
> 
> 时间：2008-11-29T13:56:10.350
> 
> 标签：asp.net, html-table, nested-datalist

我使用下面的代码来查看像图 1 这样的结果，但是像图 2 这样的结果即将到来。应该怎么做才能解决？

asp代码：

```
<asp:datalist id="dtlUrun" runat="server" RepeatDirection="Horizontal">
            <ItemTemplate>
                <table class="dtlTable">
                    <tr>
                        <td class="dtlHeader"></td>
                        <td class="dtlHeader"><%#DataBinder.Eval(Container.DataItem, "DS_MAMUL")%></td>
                    </tr>
                    <asp:DataList ID="dtlBayi" Runat="server">
                        <ItemTemplate>
                            <tr>
                                <td class="dtlColumn"><%#DataBinder.Eval(Container.DataItem, "DS_BAYI")%></td>
                                <td class="dtlColumn"><%#DataBinder.Eval(Container.DataItem, "MT_MIKTAR")%></td>
                            </tr>
                        </ItemTemplate>
                    </asp:DataList>
                </table>
            </ItemTemplate>
        </asp:datalist> 
```

风格：

```
 <style type="text/css">

.dtlTable {
    BORDER-RIGHT: #000000 1px solid; 
    BORDER-TOP: #000000 1px solid; 
    BORDER-LEFT: #000000 1px solid; 
    BORDER-BOTTOM: #000000 1px solid; 
    BORDER-COLLAPSE: collapse; 
    BACKGROUND-COLOR: #fafafa; 
    border-spacing: 0px;
}
.dtlColumn {
    PADDING-RIGHT: 0px; 
    PADDING-LEFT: 8px; 
    FONT-WEIGHT: normal; 
    FONT-SIZE: 0.7em; 
    PADDING-BOTTOM: 4px; 
    COLOR: #404040; 
    PADDING-TOP: 4px; 
    BORDER-BOTTOM: #6699cc 1px dotted; 
    FONT-FAMILY: Verdana, sans-serif, Arial; 
    BACKGROUND-COLOR: #fafafa; 
    TEXT-ALIGN: left;
}
.dtlHeader {
    BORDER-RIGHT: #000000 1px solid; 
    BORDER-TOP: #000000 1px solid; 
    FONT-WEIGHT: bold; 
    FONT-SIZE: 12px; 
    BORDER-LEFT: #000000 1px solid; 
    COLOR: #404040; 
    BORDER-BOTTOM: #000000 1px solid; 
    FONT-FAMILY: Verdana; 
    BACKGROUND-COLOR: #99cccc;
} 

    </script> 
```

VB代码：

```
Private Sub bindGrid()
    Dim objUrun As New caynet_class.cls_LU_MAMUL
    Me.dtlUrun.DataSource = objUrun.GetBy_MAMUL_ARALIGI(Session("CAY_NEVILERI_SATIS_KRITER")("MAMUL_NO1"), Session("CAY_NEVILERI_SATIS_KRITER")("MAMUL_NO2"))
    Me.dtlUrun.DataBind()
End Sub

Private Sub dtlUrun_ItemDataBound(ByVal sender As Object, ByVal e As System.Web.UI.WebControls.DataListItemEventArgs) Handles dtlUrun.ItemDataBound
    If Not e.Item.ItemIndex = -1 Then
        Dim mamulNo As Integer = CType(DataBinder.Eval(e.Item.DataItem, "MAMUL_NO"), Integer)
        CType(e.Item.FindControl("dtlBayi"), DataList).DataSource = caynet_class.cls_RAPOR_SATIS.Get_Cay_Nevileri_Satis2(mamulNo)
        CType(e.Item.FindControl("dtlBayi"), DataList).DataBind()
        Session("dtlDurum") = False
    End If
End Sub 
```

图一： http://img146.imageshack.us/my.php?image= [89632085xz4.jpg](http://img146.imageshack.us/my.php?image=89632085xz4.jpg)

图二：http ://img227.imageshack.us/my.php?image= [15383944jq6.jpg](http://img227.imageshack.us/my.php?image=15383944jq6.jpg)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-29T14:29:38.740

从我在代码中可以看出，第一个数据列表与两个标题项绑定，然后在里面你有单独的元素。您的模板为每个部分创建一个表格，但默认情况下表格将是块级元素。我的猜测是你可以用 CSS 解决这个问题，但我必须检查一下。我个人会做这样的事情。

```
<asp:dataList id="" runat="server">
    <headertemplate>
        <table>
            <tr>
    </headertemplate>
    <itemtemplate>
        <td>
            <!-- Your template here -->
        </td>
    </itemtemplate>
    <footertemplate>
        </tr></table>
    </footertemplate>
</asp:datalist> 
```

这实际上将两个表放在数据列表中的一个更大表的单元格中。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-29T14:51:52.377

headertemplate 中的标签在 footertemplate 中看不到他的结束标签。你确定你的代码是真的吗？

你说：

> 我的猜测是你可以用 CSS 解决这个问题

请让我们用 Css 修复它:)

# java - Java中是否有类似于pyparsing的库？

> ID：327569
> 
> 赞同：7
> 
> 时间：2008-11-29T14:16:39.450
> 
> 标签：java, python, parsing, pyparsing

我需要为 Java 中类似 html 的标记语言的非常简化版本快速构建解析器。在 python 中，我会使用 pyparsing 库来做到这一点。Java有类似的东西吗？请不要建议已经存在用于 html 解析的库，我的应用程序是一项学校作业，它将演示如何使用访问者模式遍历对象树并序列化为文本，所以我在这里没有考虑现实世界的术语。基本上我需要的只是标签、属性和文本节点。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-29T16:05:08.110

另一个好的解析器生成器是[ANTLR](http://www.antlr.org/ "ANTLR")，这可能是您正在寻找的。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-29T15:57:13.383

对您的使用来说可能有点过分，但[javacc](https://javacc.dev.java.net/)是一个出色的工业级解析器生成器。我已经多次使用这个程序/库，它可靠且值得学习，特别是如果您要使用语言和编译器。以下是来自上述网站的程序描述：

> Java Compiler Compiler [tm] (JavaCC [tm]) 是用于 Java [tm] 应用程序的最流行的解析器生成器。解析器生成器是一种读取语法规范并将其转换为可以识别与语法匹配的 Java 程序的工具。除了解析器生成器本身之外，JavaCC 还提供与解析器生成相关的其他标准功能，例如树构建（通过 JavaCC 附带的名为 JJTree 的工具）、操作、调试等。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-29T16:23:41.707

在 Java 中快速搜索解析器生成器会产生[JParsec](http://jparsec.codehaus.org/)。我从未使用过它——但它的灵感来自 Haskell 库，所以根据定义它一定很好:-)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-29T21:29:25.413

我喜欢 JParsec（感谢 Torsten，我刚刚发现它），因为它不会生成代码... :-) 也许效率较低，但对于小型任务来说已经足够了。
我找到了一个类似的库[JTopas](http://jtopas.sourceforge.net/jtopas/ "托帕斯")。

[Java Source](http://java-source.net/open-source/parser-generators "解析器生成器")中有一个很好的解析器列表（无论是否生成器）。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-29T15:05:14.953

java中的字符串处理有很多选择。也许非常基础的`java.util.Scanner`课程`java.util.StringTokenizer`对您有帮助？

另一个不错的选择可能是`the org.apache.commons.lang.text`图书馆。 [http://commons.apache.org/lang/apidocs/org/apache/commons/lang/text/package-summary.html](http://commons.apache.org/lang/apidocs/org/apache/commons/lang/text/package-summary.html)

# php - MySQL 存储过程与多选

> ID：327570
> 
> 赞同：2
> 
> 时间：2008-11-29T14:18:38.603
> 
> 标签：php, mysql, performance, apache, stored-procedures

这是我的场景：

我有一个（我们称之为）节点表。每个上的主键只是“node_id”。

我有一个维护节点层次结构的表，只有两列：parent_node_id 和 child_node_id。

层次结构在单独的表中维护，因为节点可以具有 N:N 关系。也就是说，一个节点可以有多个孩子，也可以有多个父母。

如果我从一个节点开始并想要获取它的所有祖先（即层次结构更高的所有内容），我可以进行多次选择，或者在一个存储过程中完成所有操作。

任何对此问题有实际经验的人都知道哪一个可能具有最佳性能？我在网上读过推荐两种方式的东西。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-29T15:48:00.953

“哪一个可能有最好的表现？”：没有人知道！您唯一能做的就是同时尝试和 MEASURE。可悲的是，这是所有与性能相关的问题的主要答案......除非在算法之间明显存在 O(n) 差异的情况下。

而且，顺便说一句，“多父母”并没有形成层次结构（否则我会建议阅读 Joe Celko 的一些书），但 DAG（直接无环图）是一种更难驯服的野兽......

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-29T15:09:02.123

如果性能是您关心的问题，那么该架构设计不会像其他人那样对您有效。

有关更多信息，请参阅[SQL 中的更多树和层次结构](http://www.sqlteam.com/article/more-trees-hierarchies-in-sql)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-29T15:29:08.087

我认为一般的陈述可能会导致问题，因为这取决于您如何查询存储过程对索引的使用。为了做出有用的声明，有必要比较您的选择的 SQL 和存储过程。

# c++ - C++ - 传递对 std::shared_ptr 或 boost::shared_ptr 的引用

> ID：327573
> 
> 赞同：116
> 
> 时间：2008-11-29T14:27:31.317
> 
> 标签：c++, boost, pass-by-reference, pass-by-value, shared-ptr

如果我有一个需要使用 a 的函数，`shared_ptr`将它的引用传递给它会不会更有效（以避免复制`shared_ptr`对象）？可能的不良副作用是什么？我设想了两种可能的情况：

1) 在函数内部，由参数制作副本，如

```
ClassA::take_copy_of_sp(boost::shared_ptr<foo> &sp)  
{  
     ...  
     m_sp_member=sp; //This will copy the object, incrementing refcount  
     ...  
} 
```

2）在函数内部只使用参数，如

```
Class::only_work_with_sp(boost::shared_ptr<foo> &sp) //Again, no copy here  
{    
    ...  
    sp->do_something();  
    ...  
} 
```

在这两种情况下，我都看不到传递`boost::shared_ptr<foo>`值而不是引用的充分理由。按值传递只会“暂时”增加由于复制而导致的引用计数，然后在退出函数范围时减少它。我忽略了什么吗？

只是为了澄清一下，在阅读了几个答案之后：我完全同意过早优化问题，并且我总是尝试首先分析热点然后工作。如果您知道我的意思，我的问题更多是从纯技术代码的角度来看的。

* * *

## 回答 #1

> 赞同：117
> 
> 时间：2012-01-13T01:48:22.337

我发现自己不同意最高投票的答案，所以我去寻找专家意见，他们就在这里。来自[http://channel9.msdn.com/Shows/Going+Deep/C-and-Beyond-2011-Scott-Andrei-and-Herb-Ask-Us-Anything](http://channel9.msdn.com/Shows/Going+Deep/C-and-Beyond-2011-Scott-Andrei-and-Herb-Ask-Us-Anything)

Herb Sutter：“当你通过 shared_ptrs 时，副本很昂贵”

Scott Meyers：“无论是通过值传递还是通过引用传递，shared_ptr 没有什么特别之处。使用与任何其他用户定义类型完全相同的分析。人们似乎认为 shared_ptr 以某种方式解决了问题所有的管理问题，因为它很小，所以通过价值传递必然很便宜。它必须被复制，并且有与之相关的成本……通过价值传递它很昂贵，所以如果我能侥幸逃脱它在我的程序中具有适当的语义，我将通过引用 const 或引用来传递它”

Herb Sutter：“总是通过对 const 的引用来传递它们，而且偶尔可能因为你知道你调用的东西可能会修改你从中获得引用的东西，也许你可能会按值传递......如果你将它们作为参数复制，哦我的天哪，你几乎不需要增加引用计数，因为它无论如何都被保持活动状态，你应该通过引用传递它，所以请这样做”

更新：Herb 在这里对此进行了扩展：http: [//herbsutter.com/2013/06/05/gotw-91-solution-smart-pointer-parameters/](http://herbsutter.com/2013/06/05/gotw-91-solution-smart-pointer-parameters/)，尽管这个故事的寓意是你不应该通过shared_ptrs 完全“除非您想使用或操纵智能指针本身，例如共享或转移所有权。”

* * *

## 回答 #2

> 赞同：114
> 
> 时间：2008-11-30T10:38:40.140

不同`shared_ptr`实例的要点是保证（尽可能）只要 this`shared_ptr`在范围内，它指向的对象仍然存在，因为它的引用计数至少为 1。

```
Class::only_work_with_sp(boost::shared_ptr<foo> sp)
{
    // sp points to an object that cannot be destroyed during this function
} 
```

因此，通过使用对 a 的引用`shared_ptr`，您将禁用该保证。所以在你的第二种情况下：

```
Class::only_work_with_sp(boost::shared_ptr<foo> &sp) //Again, no copy here  
{    
    ...  
    sp->do_something();  
    ...  
} 
```

你怎么知道它`sp->do_something()`不会因为空指针而爆炸？

这完全取决于代码的那些“...”部分中的内容。`shared_ptr`如果您在第一个“...”期间调用具有清除同一对象的副作用（在代码的另一部分中的某处）的东西怎么办？如果它恰好是该`shared_ptr`对象唯一剩下的不同呢？再见对象，就在您将要尝试使用它的地方。

所以有两种方法可以回答这个问题：

1.  非常仔细地检查整个程序的源代码，直到您确定对象不会在函数体期间死亡。

2.  将参数改回为不同的对象而不是引用。

适用于这里的一般建议：不要为了性能而对代码进行冒险的更改，直到您在分析器中为您的产品计时并最终测量出您想要进行的更改会产生性能的显着差异。

**评论者 JQ 的更新**

这是一个人为的例子。这是故意简单的，所以错误会很明显。在实际示例中，错误并不那么明显，因为它隐藏在真实细节层中。

我们有一个函数可以在某处发送消息。它可能是一条大消息，因此我们使用 a到一个字符串，而不是使用`std::string`可能在传递到多个地方时被复制的a ：`shared_ptr`

```
void send_message(std::shared_ptr<std::string> msg)
{
    std::cout << (*msg.get()) << std::endl;
} 
```

（对于这个例子，我们只是将它“发送”到控制台）。

现在我们要添加一个工具来记住上一条消息。我们想要以下行为：必须存在一个包含最近发送的消息的变量，但是当当前正在发送消息时，必须没有先前的消息（在发送之前应该重置变量）。所以我们声明新变量：

```
std::shared_ptr<std::string> previous_message; 
```

然后我们根据我们指定的规则修改我们的函数：

```
void send_message(std::shared_ptr<std::string> msg)
{
    previous_message = 0;
    std::cout << *msg << std::endl;
    previous_message = msg;
} 
```

因此，在我们开始发送之前，我们丢弃当前之前的消息，然后在发送完成后，我们可以存储新的之前的消息。都好。下面是一些测试代码：

```
send_message(std::shared_ptr<std::string>(new std::string("Hi")));
send_message(previous_message); 
```

正如预期的那样，这会打印`Hi!`两次。

现在出现了维护者先生，他查看代码并认为：嘿，那个参数`send_message`是 a `shared_ptr`：

```
void send_message(std::shared_ptr<std::string> msg) 
```

显然可以改为：

```
void send_message(const std::shared_ptr<std::string> &msg) 
```

想想这将带来的性能提升！（没关系，我们将通过某个渠道发送通常很大的消息，因此性能提升将小到无法衡量）。

但真正的问题是，现在测试代码将表现出未定义的行为（在 Visual C++ 2010 调试版本中，它会崩溃）。

维护者先生对此感到惊讶，但添加了一个防御性检查以`send_message`试图阻止问题的发生：

```
void send_message(const std::shared_ptr<std::string> &msg)
{
    if (msg == 0)
        return; 
```

但是当然它仍然会继续并崩溃，因为在调用`msg`时永远不会为空`send_message`。

正如我所说，在一个简单的示例中，所有代码都如此紧密地结合在一起，很容易找到错误。但在实际程序中，相互持有指针的可变对象之间的关系比较复杂，很容易*出错*，很难构建必要的测试用例来检测错误。

一个简单的解决方案是，您希望函数能够始终依赖于`shared_ptr`非空值，即函数分配其自己的 true `shared_ptr`，而不是依赖于对现有 的引用`shared_ptr`。

缺点是复制的 a`shared_ptr`不是免费的：即使是“无锁”实现也必须使用互锁操作来兑现线程保证。`shared_ptr`因此，在某些情况下，可以通过将 a 更改为 a来显着加快程序速度`shared_ptr &`。但这并不是可以安全地对所有程序进行的更改。它改变了程序的逻辑含义。

`std::string`请注意，如果我们在整个过程中使用而不是，会发生类似的错误`std::shared_ptr<std::string>`，而不是：

```
previous_message = 0; 
```

为了清除信息，我们说：

```
previous_message.clear(); 
```

然后，症状将是意外发送空消息，而不是未定义的行为。额外复制一个非常大的字符串的成本可能比复制 a 的成本要高得多`shared_ptr`，因此权衡可能会有所不同。

* * *

## 回答 #3

> 赞同：23
> 
> 时间：2008-11-29T16:32:32.390

我建议不要这种做法，除非你和其他与你一起工作的程序员真的、*真的*知道你们都在做什么。

首先，您不知道您的类的接口可能会如何演变，并且您想防止其他程序员做坏事。通过引用传递 shared_ptr 不是程序员应该期望看到的，因为它不是惯用的，并且很容易错误地使用它。防御性编程：使界面难以错误使用。通过引用传递只会在以后引起问题。

其次，在您知道这个特定的类将成为问题之前不要进行优化。首先配置文件，然后如果您的程序确实需要通过引用传递来提供提升，那么也许。否则，不要为小事（即通过值传递所需的额外 N 条指令）操心，而是担心设计、数据结构、算法和长期可维护性。

* * *

## 回答 #4

> 赞同：18
> 
> 时间：2008-11-29T14:34:29.993

是的，在那里参考就可以了。您不打算授予该方法共享所有权；它只想使用它。您也可以参考第一种情况，因为无论如何您都要复制它。但对于第一种情况，它*需要*所有权。有这个技巧仍然只复制一次：

```
void ClassA::take_copy_of_sp(boost::shared_ptr<foo> sp) {
    m_sp_member.swap(sp);
} 
```

您还应该在返回时复制（即不返回参考）。因为你的类不知道客户端在用它做什么（它可以存储一个指向它的指针，然后发生大爆炸）。如果后来证明这是一个瓶颈（第一个配置文件！），那么您仍然可以返回一个参考。

* * *

**编辑**：当然，正如其他人指出的那样，只有当您知道您的代码并且知道您没有以某种方式重置传递的共享指针时，这才是正确的。如果有疑问，只需按值传递。

* * *

## 回答 #5

> 赞同：11
> 
> 时间：2008-11-30T14:57:43.750

通过`shared_ptr`s 是明智的`const&`。它不太可能引起麻烦（除非在`shared_ptr`函数调用期间删除了引用的极少数情况，如 Earwicker 所详述），并且如果您传递大量这些，它可能会更快。记住; 默认`boost::shared_ptr`是线程安全的，所以复制它包括一个线程安全的增量。

尝试使用`const&`而不仅仅是`&`，因为临时对象可能不会通过非常量引用传递。（尽管 MSVC 中的语言扩展允许您这样做）

* * *

## 回答 #6

> 赞同：10
> 
> 时间：2008-11-29T16:21:54.410

在第二种情况下，这样做更简单：

```
Class::only_work_with_sp(foo &sp)
{    
    ...  
    sp.do_something();  
    ...  
} 
```

你可以把它称为

```
only_work_with_sp(*sp); 
```

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-11-29T19:12:27.780

除非函数明确地修改指针，否则我会避免使用“普通”引用。

在调用小函数时， A`const &`可能是一个明智的微优化——例如，为了实现进一步的优化，比如内联一些条件。此外，增量/减量 - 因为它是线程安全的 - 是一个同步点。不过，我不认为这会在大多数情况下产生重大影响。

通常，除非您有理由不这样做，否则您应该使用更简单的样式。然后，要么使用`const &`一致，要么添加评论，说明为什么你只在几个地方使用它。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2010-03-28T19:37:28.183

我主张通过 const 引用传递共享指针 - 使用指针传递的函数不拥有指针的语义，这对开发人员来说是一个干净的习惯用法。

唯一的缺陷是在多线程程序中，共享指针指向的对象在另一个线程中被销毁。因此可以肯定地说，在单线程程序中使用共享指针的 const 引用是安全的。

通过非常量引用传递共享指针有时是危险的 - 原因是函数可能在内部调用的交换和重置函数以破坏函数返回后仍然被认为有效的对象。

我猜这不是过早的优化 - 当您清楚自己想要做什么并且编码习惯已被您的开发人员牢牢采用时，它是关于避免不必要的 CPU 周期浪费。

只是我的 2 美分 :-)

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2010-11-29T00:02:27.557

似乎这里的所有优点和缺点实际上都可以推广到通过引用传递的任何类型，而不仅仅是 shared_ptr。在我看来，你应该知道引用传递、常量引用和值传递的语义，并正确使用它。但是通过引用传递 shared_ptr 绝对没有本质上的错误，除非您认为所有引用都是错误的......

回到示例：

```
Class::only_work_with_sp( foo &sp ) //Again, no copy here  
{    
    ...  
    sp.do_something();  
    ...  
} 
```

你怎么知道它`sp.do_something()`不会因为悬空指针而爆炸？

事实是，不管 shared_ptr 与否、const 与否，如果您有设计缺陷，例如直接或间接`sp`在线程之间共享所有权、误用 do 的对象`delete this`、您有循环所有权或其他所有权错误，都可能发生这种情况。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2014-09-25T22:56:21.833

我还没有看到提到的一件事是，当您通过引用传递共享指针时，如果您想通过对基类共享指针的引用传递派生类共享指针，则会丢失您获得的隐式转换。

例如，此代码将产生错误，但如果您更改`test()`共享指针不通过引用传递，它将起作用。

```
#include <boost/shared_ptr.hpp>

class Base { };
class Derived: public Base { };

// ONLY instances of Base can be passed by reference.  If you have a shared_ptr
// to a derived type, you have to cast it manually.  If you remove the reference
// and pass the shared_ptr by value, then the cast is implicit so you don't have
// to worry about it.
void test(boost::shared_ptr<Base>& b)
{
    return;
}

int main(void)
{
    boost::shared_ptr<Derived> d(new Derived);
    test(d);

    // If you want the above call to work with references, you will have to manually cast
    // pointers like this, EVERY time you call the function.  Since you are creating a new
    // shared pointer, you lose the benefit of passing by reference.
    boost::shared_ptr<Base> b = boost::dynamic_pointer_cast<Base>(d);
    test(b);

    return 0;
} 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-11-30T16:00:36.107

我假设您熟悉[过早优化](http://en.wikipedia.org/wiki/Optimization_%28computer_science%29#When_to_optimize)并且出于学术目的或因为您已经隔离了一些性能不佳的预先存在的代码而提出此问题。

通过引用传递是可以的

通过 const 引用传递更好，通常可以使用，因为它不会强制指向的对象具有 const-ness。

由于使用引用，您**不会有丢失指针的风险。**该引用证明您在堆栈中较早地拥有智能指针的副本，并且只有一个线程拥有调用堆栈，因此预先存在的副本不会消失。

由于您提到的原因，使用引用**通常更有效，****但不能保证**。请记住，取消引用对象也可能需要工作。您理想的参考使用场景是，如果您的编码风格涉及许多小函数，其中指针将在使用之前从一个函数传递到另一个函数。

您应该**始终避免将**智能指针存储为参考。您的`Class::take_copy_of_sp(&sp)`示例显示了正确的用法。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2010-03-03T14:24:51.610

假设我们不关心 const 的正确性（或者更多，您的意思是允许函数能够修改或共享传入数据的所有权），通过值传递 boost::shared_ptr 比通过引用传递它更安全我们允许原始的 boost::shared_ptr 控制它自己的生命周期。考虑以下代码的结果...

```
void FooTakesReference( boost::shared_ptr< int > & ptr )
{
    ptr.reset(); // We reset, and so does sharedA, memory is deleted.
}

void FooTakesValue( boost::shared_ptr< int > ptr )
{
    ptr.reset(); // Our temporary is reset, however sharedB hasn't.
}

void main()
{
    boost::shared_ptr< int > sharedA( new int( 13 ) );
    boost::shared_ptr< int > sharedB( new int( 14 ) );

    FooTakesReference( sharedA );

    FooTakesValue( sharedB );
} 
```

从上面的示例中我们看到，通过引用传递*sharedA*允许*FooTakesReference*重置原始指针，这将其使用计数减少到 0，从而破坏了它的数据。*然而FooTakesValue*不能重置原始指针，保证*sharedB 的*数据仍然可用。当另一个开发人员不可避免地出现并试图利用*sharedA*脆弱的存在时，混乱随之而来。然而，幸运的*sharedB*开发人员早早回家，因为他的世界一切都好。

在这种情况下，代码安全性远远超过复制所带来的任何速度改进。同时， boost::shared_ptr 旨在提高代码安全性。如果某些事情需要这种利基优化，那么从副本到参考会容易得多。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2011-09-02T19:46:53.760

Sandy 写道：“似乎这里的所有优点和缺点实际上都可以推广到通过引用传递的任何类型，而不仅仅是 shared_ptr。”

在某种程度上是正确的，但使用 shared_ptr 的目的是消除对对象生命周期的担忧，并让编译器为您处理。如果您要通过引用传递共享指针并允许引用计数对象的客户端调用可能释放对象数据的非常量方法，那么使用共享指针几乎没有意义。

我在上一句中写了“几乎”，因为性能可能是一个问题，并且在极少数情况下“可能”是合理的，但我自己也会避免这种情况并自己寻找所有可能的其他优化解决方案，例如认真查看在添加另一个级别的间接，惰性评估等。

存在于作者之前的代码，或者甚至发布了作者的记忆，需要对行为的隐含假设，特别是关于对象生命周期的行为，需要清晰、简洁、可读的文档，然后许多客户无论如何都不会阅读它！简单几乎总是胜过效率，而且几乎总是有其他方法可以提高效率。如果您确实需要通过引用传递值以避免通过引用计数对象（和等于运算符）的复制构造函数进行深度复制，那么也许您应该考虑使深度复制的数据成为引用计数指针的方法快速复制。（当然，这只是一种可能不适用于您的情况的设计方案）。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2013-04-11T16:30:04.930

我曾经在一个项目中工作，该项目的原则非常强大，即按值传递智能指针。当我被要求进行一些性能分析时 - 我发现对于智能指针的引用计数器的递增和递减，应用程序花费了已用处理器时间的 4-6%。

如果您想按值传递智能指针只是为了避免在 Daniel Earwicker 所述的奇怪情况下出现问题，请确保您了解为此付出的代价。

如果您决定使用引用，则使用 const 引用的主要原因是当您需要从继承您在接口中使用的类的类中传递指向对象的共享指针时，可以进行隐式向上转换。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-11-29T17:36:21.153

除了 litb 所说的之外，我想指出它可能是通过 const 引用在第二个示例中传递的，这样您就可以确定您不会意外修改它。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2013-07-23T07:23:47.450

```
struct A {
  shared_ptr<Message> msg;
  shared_ptr<Message> * ptr_msg;
} 
```

1.  按值传递：

    ```
    void set(shared_ptr<Message> msg) {
      this->msg = msg; /// create a new shared_ptr, reference count will be added;
    } /// out of method, new created shared_ptr will be deleted, of course, reference count also be reduced; 
    ```

2.  通过引用传递：

    ```
    void set(shared_ptr<Message>& msg) {
     this->msg = msg; /// reference count will be added, because reference is just an alias.
     } 
    ```

3.  通过指针传递：

    ```
    void set(shared_ptr<Message>* msg) {
      this->ptr_msg = msg; /// reference count will not be added;
    } 
    ```

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2016-03-05T07:45:33.510

每个代码片段都必须具有一定的意义。如果您在应用程序的**任何地方**按值传递共享指针，这意味着*“我不确定其他地方发生了什么，因此我赞成原始安全*”。对于可以查阅代码的其他程序员，这不是我所说的良好信心标志。

无论如何，即使一个函数获得一个 const 引用并且您“不确定”，您仍然可以在函数的头部创建共享指针的副本，以添加对指针的强引用。这也可以看作是对设计的暗示（“指针可以在别处修改”）。

所以是的，IMO，默认值应该是“**通过 const 引用传递**”。

# graph - 你如何在 gnuplot 中绘制条形图？

> ID：327576
> 
> 赞同：106
> 
> 时间：2008-11-29T14:29:21.437
> 
> 标签：graph, charts, plot, gnuplot, bar-chart

如何在带有文本标签的 gnuplot 中绘制条形图？

* * *

## 回答 #1

> 赞同：131
> 
> 时间：2012-07-18T23:23:28.607

简单的条形图：

![条状图](https://i.stack.imgur.com/xsRfu.png)

```
set boxwidth 0.5
set style fill solid
plot "data.dat" using 1:3:xtic(2) with boxes 
```

数据.dat：

```
0 label       100
1 label2      450
2 "bar label" 75 
```

**如果您想以不同的方式设置条形样式，可以执行以下操作：**

![多色条形图](https://i.stack.imgur.com/YqSHn.png)

```
set style line 1 lc rgb "red"
set style line 2 lc rgb "blue"

set style fill solid
set boxwidth 0.5

plot "data.dat" every ::0::0 using 1:3:xtic(2) with boxes ls 1, \
     "data.dat" every ::1::2 using 1:3:xtic(2) with boxes ls 2 
```

**如果你想为每个条目做多个栏：**

数据.dat：

```
0     5
0.5   6

1.5   3
2     7

3     8
3.5   1 
```

gnuplot：

```
set xtics ("label" 0.25, "label2" 1.75, "bar label" 3.25,)

set boxwidth 0.5
set style fill solid

plot 'data.dat' every 2    using 1:2 with boxes ls 1,\
     'data.dat' every 2::1 using 1:2 with boxes ls 2 
```

![barchart_multi](https://i.stack.imgur.com/ghpyC.png)

**如果你想变得棘手并使用一些简洁的 gnuplot 技巧：**

Gnuplot 具有可用作颜色索引的伪列：

```
plot 'data.dat' using 1:2:0 with boxes lc variable 
```

![barchart_multi2](https://i.stack.imgur.com/14rNM.png)

此外，您可以使用函数来选择所需的颜色：

```
mycolor(x) = ((x*11244898) + 2851770)
plot 'data.dat' using 1:2:(mycolor($0)) with boxes lc rgb variable 
```

![barchart_multi3](https://i.stack.imgur.com/VwzZX.png)

注意：您必须添加一些其他基本命令才能获得与示例图像相同的效果。

* * *

## 回答 #2

> 赞同：25
> 
> 时间：2008-11-29T14:30:48.097

```
使用 2: xtic(1) 和直方图绘制“data.dat”

```

这里 data.dat 包含表单的数据

```
标题 1
标题2 3
“长标题” 5

```

* * *

## 回答 #3

> 赞同：18
> 
> 时间：2016-04-07T22:24:37.687

我只想扩展顶级答案，它使用 GNUPlot 创建条形图，适合绝对初学者，因为我阅读了答案并且仍然对大量语法感到困惑。

我们首先编写一个 GNUplot 命令的文本文件。让我们称之为commands.txt：

```
set term png
set output "graph.png"
set boxwidth 0.5
set style fill solid
plot "data.dat" using 1:3:xtic(2) with boxes 
```

`set term png`将 GNUplot 设置为输出 .png 文件，并且`set output "graph.png"`是它将输出到的文件的名称。

接下来的两行是不言自明的。第五行包含很多语法。

```
plot "data.dat" using 1:3:xtic(2) with boxes 
```

`"data.dat"`是我们正在操作的数据文件。`1:3`表示我们将使用 data.dat 的第 1 列作为 x 坐标，使用 data.dat 的第 3 列作为 y 坐标。`xtic()`是负责对 x 轴进行编号/标记的函数。`xtic(2)`因此，表示我们将使用 data.dat 的第 2 列作为标签。

“data.dat”看起来像这样：

```
0 label       100
1 label2      450
2 "bar label" 75 
```

要绘制图形，请`gnuplot commands.txt`在终端中输入。

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2011-04-05T11:43:06.347

我推荐 Derek Bruening 的条形图生成器 Perl 脚本。可在[http://www.burningcutlery.com/derek/bargraph/获得](http://www.burningcutlery.com/derek/bargraph/)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2019-01-25T17:36:20.873

您可以直接使用 gnuplot 提供的样式直方图。这是一个示例，如果您在输出中有两个文件：

```
set style data histograms
 set style fill solid
 set boxwidth 0.5
 plot "file1.dat" using 5 title "Total1" lt rgb "#406090",\
      "file2.dat" using 5 title "Total2" lt rgb "#40FF00" 
```

# xunit.net - 使用 TestDriven.net 运行 XUnit.net 测试

> ID：327582
> 
> 赞同：14
> 
> 时间：2008-11-29T14:35:45.527
> 
> 标签：xunit.net, testdriven.net

我已经使用 NUnit 多年了，我想试试 XUnit。所以我安装了 XUnit 并运行了允许您通过 TD.net 运行 XUnit 的可执行文件。

我似乎一次不能运行多个测试。使用 NUnit + TD.net，我可以单击解决方案中的文件名并运行文件中的所有测试。我似乎无法用 XUnit + TD.net 做到这一点。

这是我能做的吗？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-02-26T15:04:14.983

确保运行 XUnit.net 附带的安装程序。有一个按钮可供单击，它将安装 TestDriven.net 支持。

您遇到的问题在这里描述：http: [//www.codeplex.com/xunit/Wiki/View.aspx?title=FaqTestDrivenNet &referringTitle=Home](http://www.codeplex.com/xunit/Wiki/View.aspx?title=FaqTestDrivenNet&referringTitle=Home)

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-01-24T05:04:33.013

简短回答：将以下内容复制到计算机上的 .reg 文件中，更新 Xunit dll 所在的路径，然后将其导入注册表。

Windows 注册表编辑器版本 5.00

> [HKEY_LOCAL_MACHINE\SOFTWARE\MutantDesign\TestDriven.NET\TestRunners\xunit] @="4" "AssemblyPath"="C:\_Files\Programs\Programming\XUnit\xunit-1.1.0\xunit.runner.tdnet.dll" "TypeName"="Xunit.Runner.TdNet.TdNetRunner"

长答案：

我在 32 位和 64 位版本的 Windows 上都遇到过几次这个问题。TestDriven.net 使用注册表来存储可用的测试框架列表。XUnit 带有一个安装程序 xunit.installer（以管理员身份运行），它应该可以生成正确的注册表项。

通常我可以让 TD.net 与 XUnit 一起工作一段时间，然后我就会失去支持。今天我第一次尝试让它在 Windows 7 beta 上运行，但根本无法运行。

经过一番搜索，我找到了应该输入有关测试框架的信息的注册表项。

> HKEY_LOCAL_MACHINE\SOFTWARE\MutantDesign\TestDriven.NET\TestRunners

现在在 64 位系统上，Wow6432Node 下还有一个键，看起来 Xunit 安装程序正在设置注册表键。

无论如何，我从 HKEY_LOCAL_MACHINE\SOFTWARE\Wow6432Node\MutantDesign\TestDriven.NET\TestRunners\xunit 导出了 xunit 注册表项，并对其进行了编辑，删除了 Wow6432Node，然后将其导入。重新启动视觉工作室后，一切正常。我会保留注册表文件，以防它再次损坏。

# visual-studio - 高级 Windows 应用程序 UI（MDI 选项卡式组）

> ID：327583
> 
> 赞同：0
> 
> 时间：2008-11-29T14:37:08.553
> 
> 标签：visual-studio, user-interface, visual-c++, mfc

我希望能够创建一个 MDI UI 布局，以下列方式扩展[MDI 选项卡式组的行为。](http://msdn.microsoft.com/en-us/library/cc165830.aspx)在拆分选项卡组的窗格中，我想创建一个具有相反方向对齐的嵌套选项卡组。例如，给定一个水平拆分的顶层，我想在第一个窗格中创建一个垂直拆分的选项卡组。这似乎需要对 CMDIFrameWndEx 和相关类进行返工。

选项卡式组布局是一个吸引人的 UI 设备。遗憾的是它在主流网络浏览器中不可用。我是否正确地假设它的最佳支持在 Visual C++ Feature Pack 中？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-29T16:05:26.797

[这是](http://www.dotnetmagic.com/features_tabbedMDI.html)一个例子，至少。此外，[阿瓦隆码头](http://www.codeplex.com/AvalonDock)。我猜MFC在许多方面仍然落后。

# c# - 如何对抗真正的大控制器。.

> ID：327585
> 
> 赞同：1
> 
> 时间：2008-11-29T14:39:59.200
> 
> 标签：c#, winforms, model-view-controller

我有一个使用 MVC 构建的 winforms 应用程序。控制器正在订阅视图中的所有事件（按钮单击等），并将多个视图与模型连接起来。

问题是控制器现在大约有 3000 行（难以进行单元测试）代码。

避免让控制器做所有事情并变得如此庞大的最佳实践是什么？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-29T15:08:04.993

要指出的一件显而易见的事情可能是一个控制器不必作为一个类来实现。MVC 设计模式只是声明 M、V 和 C 是独立的组件，但并不是说每个组件都必须是一个，并且只能是一个类。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-29T15:43:49.073

### 子控制器

控制器可以在不破坏 MVC 模式的情况下拆分为各种**子控制器。**

在 3k 行时，可以肯定的是，凝聚力在某处被破坏了。尝试将相同的行为组合在一起并创建新的控制器。这样，您将拥有一个“主”控制器，该控制器将调用“子”控制器。

### 无子方法：

根据我自己的经验，我没有 1 个控制器用于整个 WinForm 应用程序。我如何创建它是我有多个从菜单加载的模块。当这些模块被加载（表单->视图）时，它带有自己的控制器。这样，每个模块我只有 1 个控制器。这些控制器通常不会超过 500 行代码。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-29T14:59:06.823

取决于情况，但假设您还没有到应该创建新控制器的地步，有几种方法。

很大程度上取决于您的设置。一种常见的方法是使用服务层或服务代理来为非特定的控制器工作。使用接口助手甚至静态助手应该消除一些重复。假设它被分解成可测试的方法，300 行听起来一点也不坏。

除了经常重复创建更多控制器的口头禅之外，我也很想听听其他意见。我们使用 MVP 并尝试使用子控制器，但这确实依赖于谨慎使用，并且可能不是一个好主意。

在 MVP 中每个模块都有一个控制器是很常见的，这与应用程序的逻辑部分有关。在您的域中应该有一些清晰的，而一些可能更难以区分。

# python - 建议在没有 switch case 的情况下实现文本菜单

> ID：327597
> 
> 赞同：3
> 
> 时间：2008-11-29T15:01:28.813
> 
> 标签：python

我正在迈出 Python 的第一步。我看到我们没有 switch case 语句，所以你们会在 python 中实现一个文本菜单吗？

谢谢

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-11-29T17:32:04.720

你可能会做这样的事情：

```
def action1():
    pass # put a function here

def action2():
    pass # blah blah

def action3():
    pass # and so on

def no_such_action():
    pass # print a message indicating there's no such action

def main():
    actions = {"foo": action1, "bar": action2, "baz": action3}
    while True:
        print_menu()
        selection = raw_input("Your selection: ")
        if "quit" == selection:
            return
        toDo = actions.get(selection, no_such_action)
        toDo()

if __name__ == "__main__":
    main() 
```

这会将您所有可能的操作功能放入字典中，键是您将输入的内容以运行该功能。然后它从列表中检索动作输入动作，除非输入动作不存在，在这种情况下它检索 no_such_action。

在您对它的工作原理有了基本的了解之后，如果您正在考虑做一个严肃的业务命令行类型的应用程序，我会看看命令行应用程序的[`cmd`框架](http://docs.python.org/library/cmd.html)。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-29T15:15:46.930

一般来说，如果 elif 就可以了，但如果你有很多案例，请考虑使用 dict。

```
actions = {1: doSomething, 2: doSomethingElse}
actions.get(n, doDefaultThing)() 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-29T15:06:14.547

您可以使用 if...elif。如果你必须选择一个数字，它会是这样的：

```
n = chosenOption()
if(n == 0):
    doSomething()
elif(n == 1):
    doAnyOtherThing()
else:
    doDefaultThing() 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-29T15:15:34.853

从“Python 简介”一书中查看这个[主题。](http://www.network-theory.co.uk/docs/pytut/ifStatements.html)Switch 语句由 if..elif..elif 序列代替。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-29T17:27:51.267

对于你的第一个问题，我同意 Ali A.

对于你的第二个问题：

导入系统
sys.exit(1)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-03-09T12:41:43.800

我来这里是为了寻找同样的东西，最后写了自己的： [https ://github.com/gerrywastaken/menu.py](https://github.com/gerrywastaken/menu.py)

你这样称呼它：

```
import menu

message = "Your question goes here"
options = {
    'f': ['[F]irst Option Name', 'First value'],
    's': ['[S]econd Option Name', 'Second value'],
    't': ['[T]hird Option Name', 'Third value']
}

selection = menu.getSelection(message, options) 
```

它为用户提供了一个菜单，他们可以通过括号中的字符选择他们想要的选项。如果他们输入“s”作为他们的选项，那么选择将被分配“第二值”的值。我本可以让它更漂亮，但我想让事情变得简单，尽管拉请求是非常受欢迎的。

# c# - 使用 WinForms 应用程序中的解锁器解锁文件？

> ID：327598
> 
> 赞同：1
> 
> 时间：2008-11-29T15:02:54.583
> 
> 标签：c#, .net, winforms, file-locking

我正在尝试使用解锁器从 C# 程序中解锁文件。

在我的 UI 中，我放了一个按钮来解锁应用程序无法删除的文件。当用户按下按钮时，我希望打开解锁器（著名的应用程序）。

我在 Unlocker web 上阅读过，并且有一些关于要使用的命令行的解释，但没有任何作用。

我编写了以下代码，但没有任何反应：

"c:\Program Files\unlocker\unlocker.exe" -L "PATHFORTHEFILE.doc"

什么都没发生。我试过不带参数和-LU。

任何想法？

比解锁器更有效地将其与软件集成的东西？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-29T15:45:27.493

如果解锁器带有参数 -L 和 -U，我认为 L 不会是你想要解锁的那个。可能 U 用于解锁；）

如果您对锁定文件的应用程序有任何控制权，那么让该程序释放文件而不是第三方应用程序像这样将其撕掉会是一个更好的解决方案。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-19T18:54:42.340

unnlocker.exe c:\song.mp3 -s -d

-s 解锁

-d 删除

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-29T15:35:01.057

查看[System.Diagnostics.Process](http://msdn.microsoft.com/en-us/library/system.diagnostics.process.aspx)类和相关 ProcessStartInfo 类的文档。

# asp.net - 将 base64 编码文件发布到 asp.net 1.1 页面

> ID：327604
> 
> 赞同：0
> 
> 时间：2008-11-29T15:08:58.707
> 
> 标签：asp.net, http, file, upload

我们正在制作一个自动修补应用程序，并希望通过 asp.net 页面（或者可能是 Web 服务）在生产服务器上发布文件，因为我们只能通过 http 访问生产服务器。该页面应该接受文件并将它们存储到适当的位置。文件的路径将在外部 XML 文件中声明。那么，是否可以在 body 标签中发布 base64 编码文件以及如何？也许甚至有更好的方法？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-29T17:48:23.580

请参阅[使用 XML CDATA 节点通过 Web 服务发送文件](http://www.codeproject.com/KB/cpp/sending_files_via_webserv.aspx?display=Print)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-29T18:06:15.900

为什么不创建一个接受如下对象的网络服务：

```
class postfile
{
 public byte[] fileByte;
 public string fileName;
} 
```

然后在您的客户端应用程序中添加 Web 引用。

.net 将为您序列化对象。

您将需要使用 wse 安全性来保护它，并且可能需要服务使用模拟在服务器上写入文件。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-29T16:48:51.343

如果您打算使用 Base64 编码。看一眼

```
 System.Convert.ToBase64String()
        System.Convert.FromBase64String()
        System.Convert.ToBase64CharArray()
        System.Convert.FromBase64CharArray() 
```

# hosting - 在云中托管、部署和运行 Web 应用程序

> ID：327608
> 
> 赞同：1
> 
> 时间：2008-11-29T15:10:10.390
> 
> 标签：hosting, grid, stack, cloud, solution

到目前为止，我已经阅读了一些关于在网格中托管应用程序的云计算和服务的博客文章。

如果我想以尽可能低的成本在云中运行 Web 应用程序，最好的解决方案是什么？

让我们假设以下配置：

*   J2EE 网络应用程序
*   任何免费数据库（MySQL、PostgreSQL）
*   将 Web 应用程序部署到的任何 Web 容器

您建议使用哪种应用程序堆栈作为服务的最佳组合

1.  主持人
2.  部署
3.  跑

网络应用程序？

作为附加要求，选择的服务不应该对服务器管理有太多要求，例如防火墙设置等。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-29T15:44:25.547

我最近调查了[亚马逊的 ec2](http://aws.amazon.com/ec2/)解决方案。它非常好，如果您找到适合您需要的一个，您可以使用许多预制的盒子。我认为仍然会涉及一些服务器管理......你无法摆脱这一点。但是预制的盒子会更容易。

费用是合理的，因为您只需按使用量付费。

[编辑] 预先构建的盒子称为亚马逊系统映像 (AMI)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-29T15:47:26.413

这个空间现在变化很快，所以我想你会找到很多不同的好答案。如果我现在在哪里便宜地做某事，我可能会选择以下堆栈：

*   网络服务器：阿帕奇
*   应用服务器：tomcat -如果您需要在[apache 级别](http://httpd.apache.org/docs/2.2/mod/mod_proxy_balancer.html)增长或拆分，甚至在最前面引入[负载均衡器框，请使用](http://www.apsis.ch/pound/)[集群支持](http://tomcat.apache.org/tomcat-5.5-doc/cluster-howto.html)
*   数据库服务器：MySql——主要是因为它易于集群
*   平台：[scalr](http://scalr.net) - 云设置简单且便宜。它在后端使用[亚马逊的云](http://aws.amazon.com/)，这可以让你获得很多额外的东西，比如将服务器放在不同的数据中心以实现冗余。

现在您可以添加或删除其中的一部分。您可能不需要 Web 层，可以直接公开 tomcat。您可能需要 EJB，在这种情况下，您可以为此启动更多节点并创建另一个层。您可能想在 apache 前面添加一个负载平衡层。您可能希望使用[Amazon Cloudfront](http://aws.amazon.com/cloudfront/)服务将静态文件推送到其边缘网络。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-09-14T02:09:51.693

我认为你无法接近[Jelastic](http://jelastic.com)。它包含@carson 提到的所有内容。特别是我会提到他们独特的 Web 控制台，他们对要安装的任何 API 或控制台没有任何依赖关系。我为我的初创公司的许多客户使用他们的平台。此外，您还可以立即从控制台获得对负载平衡和配置的 nginx 支持。

# binary - 使用 GNU ld 链接器脚本包含二进制文件

> ID：327609
> 
> 赞同：28
> 
> 时间：2008-11-29T15:12:18.903
> 
> 标签：binary, gnu, ld

我有一个有效的链接器脚本。我想添加另一个数据部分，其内容是直接从文件中提取的（ld 不应该解析它并提取这些部分等等）。我怎样才能做到这一点？

```
OUTPUT_FORMAT("elf32-i386")
ENTRY(start)
SECTIONS
{
  .text 0x100000 : {
    *(.multiboot)
    *(.text)
    *(.code)
    *(.rodata*)
  }
  .data : {
    *(.data)
  }
  .bss : {
    *(.bss)
  }
  kernel_end = .;
  roottask_start = .;
  .data : {

    HERE I WANT TO INCLUDE THE ENTIRE CONTENTS OF ANOTHER (BINARY) FILE

  }
  roottask_end = .;
} 
```

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2008-11-29T23:01:47.393

您可以尝试使用`objcopy`将其转换为可以链接的普通对象，然后在链接器脚本中引用其符号，就像对普通对象所做的那样。从[`objcopy`手册页](http://linux.die.net/man/1/objcopy)：

> -B bfdarch --binary-architecture=bfdarch 在将原始二进制输入文件转换为目标文件时很有用。在这种情况下，输出架构可以设置为 bfdarch。如果输入文件具有已知的 bfdarch，则此选项将被忽略。您可以通过引用转换过程创建的特殊符号来访问程序内部的此二进制数据。这些符号称为 `_binary_objfile_start`和。例如，您可以将图片文件转换为目标文件，然后使用这些符号在您的代码中访问它。`_binary_objfile_end``_binary_objfile_size`

...其中*objfile*将扩展为输入对象文件的名称。

另请参阅该`--rename-section`选项。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2013-08-27T13:52:21.853

您可以将原始文件放在程序集中的单独部分，然后将此部分包含在链接描述文件中。

首先，您需要创建模板 .S 文件，例如。

```
.section .rawdata
.incbin "blob1.raw" 
```

...并根据需要修改链接描述文件以包含此部分：

```
.data : {

    *(.rawdata*)

} 
```

您也可以在[此处](https://stackoverflow.com/questions/15594988/objcopy-prepends-directory-pathname-to-symbol-name/18413411#18413411)查看有关 .S 模板的更多详细信息。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2011-12-15T09:13:45.010

另一种解决方案是使用该函数从您的二进制文件中生成包含字节的第二个链接器脚本`BYTE`，然后使用该`INCLUDE`指令将其包含在前一个链接器脚本中。

您可以使用`hexdump`以下方式从二进制文件生成脚本：

```
cat ramelfs | hexdump -v -e '"BYTE(0x" 1/1 "%02X" ")\n"' > ramelfs.ld 
```

然后以这种方式包含它：

```
SECTIONS {
    .text : {

        /* ... */

        kramelfs = .;
        INCLUDE "ramelfs.ld" ;
        kramelfs_end = .;

       /* ... */
    }
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2021-11-01T18:29:35.283

```
仅使用链接器的另一种方法是使用 TARGET 和 INPUT

    目标（二进制）
    输入 (./my_binary_data.bin)
    输入 (./my_binary_code.bin)
    # 如果需要，在此处添加更多二进制文件

    OUTPUT_FORMAT("elf32-i386")

    进入（开始）

    部分
    {
        .text 0x100000：{
            *(.multiboot)
            *（。文本）
            *（。代码）
            ./my_binary_code.bin
            *(.rodata*)
        }
        。数据 ： {
            *（。数据）
        }
        .bss：{
            *(.bss)
        }
        kernel_end = .;
        roottask_start = .;
        。数据 ： {

            ./my_binary_data.bin

        }
        根任务结束 = .;
    }

```

# php - 从网站上刮下价格

> ID：327617
> 
> 赞同：0
> 
> 时间：2008-11-29T15:28:29.073
> 
> 标签：php, regex, character-encoding

我正在尝试使用 PHP 和正则表达式从网页中获取价格。价格格式为 123.12 英镑或 123.12 美元（即英镑或美元）。

我正在使用 libcurl 加载内容。然后其输出将进入`preg_match_all`. 所以它看起来有点像这样：

```
$contents = curl_exec($curl);

preg_match_all('/(?:\$|£)[0-9]+(?:\.[0-9]{2})?/', $contents, $matches); 
```

到目前为止这么简单。问题是，PHP 根本不匹配任何东西——即使页面上有价格。我已将其范围缩小到“£”字符存在问题 - PHP 似乎不喜欢它。

我认为这可能是一个字符集问题。但无论我做什么，我似乎都无法让 PHP 匹配它！有人有想法么？

（编辑：我应该注意，如果我尝试使用使用相同的正则表达式和页面内容的正则[表达式测试工具，它工作正常）](http://www.spaweditor.com/scripts/regex/index.php)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-29T15:32:00.580

你有没有尝试在£前面使用\

```
preg_match_all('/(\$|\£)[0-9]+(\.[0-9]{2})/', $contents, $matches); 
```

我已经用 .Net 和 \£ 尝试过这个表达式，它可以工作。我刚刚对其进行了编辑并删除了一些“：”。 [（来源：][[clip2net.com](http://clip2net.com/clip/m12122/1227972904-clip-9kb.png)][）][![替代文字](https://i.stack.imgur.com/DwYIJ.png)](https://i.stack.imgur.com/DwYIJ.png)

阅读我关于 Curl 给你错误编码的可能性的评论（这篇文章的评论）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-29T15:37:09.210

也许磅有它的html实体替换？我认为您应该使用某种沙发程序尝试您的正则表达式（即，将其与本地固定文本匹配）。

我会像这样更改我的正则表达式：`'/(?:\$|£)\d+(?:\.\d{2})?/'`

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-29T15:41:28.390

这应该适用于简单的值。

```
'#(?:\$|\£|\€)(\d+(?:\.\d+)?)#' 
```

这不适用于千位分隔符，如 234,343 和 34,454.45。

# c - 使用 C 计算时间段

> ID：327630
> 
> 赞同：0
> 
> 时间：2008-11-29T15:44:14.220
> 
> 标签：c, time, date

如何计算 C（任何库等）中 2 个日期之间的时间段？

该程序应将两个（本地）日期作为输入，并提供它们之间的持续时间作为输出。

例如，

```
startDate = OCT-09-1976 and endDate = OCT-09-2008 
should show a duration of 32 years. 

startDate = OCT-09-1976 and endDate = DEC-09-2008 
should show a duration of 32 years and 2 months. 
```

谢谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-29T15:54:01.737

[使用strptime](http://www.manpagez.com/man/3/strptime/)将日期转换为两个 struct tm 结构

[Difftime](http://www.manpagez.com/man/3/difftime/)以秒为单位为您提供两者之间的差异。

[使用此处](http://www.daniweb.com/forums/post121350-7.html)的代码将其转换为月份等（在 C++ 中，但唯一的 C++ 用于字符串格式，易于更改）

编辑：正如评论员所观察到的，这避免了月份问题。如果您对它假设月份有 30 天感到满意，那么 isodiff_from_secs 的（GPL'd）代码可以转换为您想要的。[在此处](http://en.wikipedia.org/wiki/ISO_8601#Durations)查看[Google 代码搜索](http://www.google.com/codesearch?hl=en&sa=N&q=isodiff_from_secs+lang:c&ct=rr&cs_r=lang:c)和标准说明

做一个完全正确的解决方案，考虑到实际日子之间的真实月份，将非常复杂。这是您的问题所必需的吗？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-29T15:50:49.947

我最近使用[Boost.Date_Time](http://www.boost.org/doc/libs/1_37_0/doc/html/date_time/gregorian.html)做了一些非常相似的事情，并将生成的函数呈现为 C，但这当然需要使用 C++ 链接器。

实际上，这个例子还有一些不足之处——开始日期和结束日期总是在一个月的同一天吗？如果是这样，您可以忽略天数，最后只需减去月份和年份的数字。

但是，如果您的日期可以在一个月中的任何地方，它可能会有点棘手。请记住，并非所有月份的天数都相同！

[C difftime](http://linux.die.net/man/3/difftime)不能帮助您计算月份，这就是我使用 Boost 的原因，尽管您可能没有该选项。

# c++ - OpenGL 和单色纹理

> ID：327642
> 
> 赞同：12
> 
> 时间：2008-11-29T15:56:22.993
> 
> 标签：c++, opengl, textures

是否可以将单色（具有 1 位图像深度的图形数据）纹理泵入 OpenGL？

我目前正在使用这个：

```
glTexImage2D( GL_TEXTURE_2D, 0, 1, game->width, game->height, 0, GL_LUMINANCE, GL_UNSIGNED_BYTE, game->culture[game->phase] ); 
```

我在 GL_LUMINANCE 模式下使用 8 位无符号整数的方阵（一个 8 位通道代表所有 3 个通道的亮度和完整的 alpha）来抽它，但它在 IMO 中非常无效，因为数组中的 onlu 值是 0x00 和 0xFF .

我可以（以及如何）以某种方式使用简单的每像素一位布尔数组吗？过大的数组大小会减慢数组上的任何其他操作:(

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2013-03-29T15:48:02.660

经过一番研究，我能够使用以下代码将每像素 1 位的图像渲染为纹理：

```
static GLubyte smiley[] = /* 16x16 smiley face */
{
    0x03, 0xc0, /*       ****       */
    0x0f, 0xf0, /*     ********     */
    0x1e, 0x78, /*    ****  ****    */
    0x39, 0x9c, /*   ***  **  ***   */
    0x77, 0xee, /*  *** ****** ***  */
    0x6f, 0xf6, /*  ** ******** **  */
    0xff, 0xff, /* **************** */
    0xff, 0xff, /* **************** */
    0xff, 0xff, /* **************** */
    0xff, 0xff, /* **************** */
    0x73, 0xce, /*  ***  ****  ***  */
    0x73, 0xce, /*  ***  ****  ***  */
    0x3f, 0xfc, /*   ************   */
    0x1f, 0xf8, /*    **********    */
    0x0f, 0xf0, /*     ********     */
    0x03, 0xc0  /*       ****       */
};

float index[] = {0.0, 1.0};

glPixelStorei(GL_UNPACK_ALIGNMENT,1);

glPixelMapfv(GL_PIXEL_MAP_I_TO_R, 2, index);
glPixelMapfv(GL_PIXEL_MAP_I_TO_G, 2, index);
glPixelMapfv(GL_PIXEL_MAP_I_TO_B, 2, index);
glPixelMapfv(GL_PIXEL_MAP_I_TO_A, 2, index);

glTexImage2D(GL_TEXTURE_2D,0,GL_RGBA,16,16,0,GL_COLOR_INDEX,GL_BITMAP,smiley);

glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_MAG_FILTER, GL_LINEAR);
glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_MIN_FILTER, GL_LINEAR); 
```

结果如下：

![在此处输入图像描述](https://i.stack.imgur.com/fAdlv.png)

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-11-29T16:02:58.410

亮度图像的最小未压缩纹理格式使用每像素 8 位。

但是，可以压缩每像素 1 位的图像而不会丢失 S3TC 或 DXT 格式。这仍然不是每像素 1 位，而是介于 2 到 3 位之间。

如果你真的需要每像素 1 位，你可以用一个小技巧来做到这一点。将 8 个每像素 1 位纹理加载为一个 8 位 Alpha-only 纹理（图像 1 加载到位 1，图像 2 加载到位 2，依此类推）。完成后，您可以使用 alpha 测试功能和一些纹理环境编程来“处理”每个子纹理，以将 alpha 转换为颜色。

这仅在您有 8 个每像素 1 位纹理并且很难正确处理的情况下才有效。

# css - 如何在gmail中执行“更多操作”之类的下拉框

> ID：327643
> 
> 赞同：3
> 
> 时间：2008-11-29T15:56:23.867
> 
> 标签：css, html-select

我在 gmail 收件箱页面中看到了“更多操作”下拉框。它在列表中有级别和一些禁用的项目。

如何在 HTML+CSS 中做到这一点？

谢谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-29T18:12:36.463

回应 Rob，不使用***disabled***的原因是***IE***。

这不是一个好主意的原因是IE在 IE6、IE7 或 IE8 中***仍然不支持这一点。***

[http://webbugtrack.blogspot.com/2007/11/bug-293-cant-disable-options-in-ie.html](http://webbugtrack.blogspot.com/2007/11/bug-293-cant-disable-options-in-ie.html)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2011-04-10T20:39:06.663

我一直在寻找类似的东西，这是我的解决方案。您需要图标来显示/隐藏、添加 css 和 javascript（本例中为 jquery）。它显示/隐藏菜单，但可以是 .hide div 中的任何内容。

CSS：

```
.shortasc { background: url("/css/asc.gif") no-repeat 50% 50%;cursor:pointer;}
.shortdesc { background: url("/css/desc.gif") no-repeat 50% 50%;cursor:pointer;}
.hide{ display:none;}
.toggle-menu .title {
text-align:left;
}

.toggle-menu div.more{
   position: absolute;
   border:#999999 1px solid;
   background-color:#FFFFFF;

}
.toggle-menu div.more ul{margin:0; padding:2px; text-align:left;}
.toggle-menu div.more ul li{list-style:none; padding:2px; border:#CCCCCC 1px solid;} 
```

html 到 jquery 函数的调用：

```
<span class="toggle-menu">
<span class="title" onclick="$(this).win('togglewin');">titulo del menu</span><span class="orden shortasc">&nbsp;&nbsp;&nbsp;</span>
<div class="more hide">
<ul>
<li>Enlace 1</li>
<li>Enlace 2</li>
<li>and so on</li>
</ul>
</div>
</span> 
```

将方法添加到 jquery 函数或编辑以在标题中添加 onClick 事件或创建您的函数，或者其他什么，这是一个带有 jquery 函数的示例[http://docs.jquery.com/Plugins/Authoring#Getting_Started](http://docs.jquery.com/Plugins/Authoring#Getting_Started)：

```
(function($) {
var methods={
//... your functions
togglewin:function(){
   var p = $(this).position();
  var parent = (this).closest('.toggle-menu');
  if(parent.find('.more').is(':visible')){
     parent.find('.orden').removeClass('shortdesc').addClass('shortasc');   
     parent.find('.more').slideUp();
  }else{
     parent.find('.orden').removeClass('shortasc').addClass('shortdesc');
     parent.find('.more').slideDown().offset( { top:p.top+12,left:p.left } );
 }
 return this;
}
};

$.fn.win = function(method) { 
  if ( methods[method] ) {
    return methods[ method ].apply( this, Array.prototype.slice.call( arguments, 1 ));
  } else if ( typeof method === 'object' || ! method ) {
    return methods.init.apply( this, arguments );
  } else {
   $.error( 'Method ' +  method + ' inexistente en jQuery.win' );
 }   
}

})(jQuery); 
```

抱歉，我无法上传图片，但我喜欢这个结果。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-29T17:00:08.950

您可以对 HTML 元素中的元素进行分组和禁用，`<select>`而无需使用 JavaScript。像下面这样的东西应该可以工作：

```
<select name="foo">
    <optgroup label="Odds">
        <option value="1">1</option>
        <option value="3">3</option>
        <option value="5">5</option>
    </optgroup>
    <optgroup label="Evens">
        <option value="2">2</option>
        <option value="4">4</option>
        <option value="6" disabled="disabled">6</option>
    </optgroup>
</select> 
```

对 Firebug 的简短检查表明，谷歌正在用一大堆 HTML 和一些巧妙的 CSS 来伪造他们的下拉框。就个人而言，我认为采用“正确”的方法并将其设计得更漂亮比在这里重新发明轮子更具可读性。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-29T16:59:15.440

您想要一个基于无序列表的弹出/下拉菜单。

# c# - 转向泛型。

> ID：327645
> 
> 赞同：6
> 
> 时间：2008-11-29T15:57:22.213
> 
> 标签：c#, winforms, generics

我正在将 1.1 winforms 应用程序迁移到 2.0。由于泛型，我应该立即更改的主要内容是什么。这是我到目前为止所拥有的：

1.  用通用字典替换所有哈希表
2.  用 List<> 替换所有数组列表
3.  将所有 CollectionBase 派生类替换为：List<>

还有其他应该立即完成的吗？

谢谢，阿克

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-29T17:36:19.953

我认为不应该立即做任何事情！1.1 代码有效，对吧？批发到仿制药的商业案例是什么？在 2.0 下编译应用程序，让它运行和测试。然后，当需要新特性来让你很好地利用泛型时，将这些特性实现为泛型。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-11-29T15:59:21.100

> 还有其他应该立即完成的吗？

通常，尽可能将提及的内容更改`IEnumerable`为`IEnumerable<T>`。通过切换整个命名空间可以极大地帮助迁移，即在每个文件中都使用 uning`import`而`System.Collections`不是导入`System.Collections.Generic`.

此外，在您的代码中搜索对拳击的提及`object`和/或使用，并考虑这是否仍然合适或应该被泛型取代。

正如**jalf**在评论中提醒我的那样，另一个重要的变化是切换到`IComparable`适用的通用版本。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-29T17:20:51.530

由于它们的表现力，通用集合绝对是首选。如果从非泛型集合进行更改，要记住的一件事是，有时行为可能与您预期的不同。例如，在 Hashtable 和 Dictionary 上使用索引器对于不存在的值会有不同的作用。Hashtable 将返回 null 而 Dictionary 将抛出。

```
Hashtable ht = new Hashtable();
ht.Add(1, "one");
string s1 = ht[1;  // s1="one"
string s2 = ht[2]; // s2=null

var dic = new Dictionary<int, string>();
dic.Add(1, "one");
string s1 = dic[1];  // s1="one"
string s2 = dic[2];  // throws KeyNotFoundException 
```

处理此问题的常用方法是使用以下技术：

```
string s = null;
if (dic.TryGetValue(k, out s))
{
    // if we're here, k was found in the dictionary
} 
```

这只会在运行时显示，因此值得提前了解。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-29T17:47:08.980

请参阅 Bill Wagner 的新书《[更有效的 C#](https://rads.stackoverflow.com/amzn/click/com/0321485890) 》 。转向泛型有很多很棒的技巧。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-30T04:51:41.963

我不建议使用`List<T>`而不是`CollectionBase`. 相反，`Collection<T>`为您提供可比较的覆盖。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-30T04:57:26.320

除非您已经拥有一套具有出色代码覆盖率的单元测试，*否则不要不必要地更改任何内容*

否则你只是自找麻烦，更别提发明忙碌的工作了……

# c# - WMI 无效类错误（试图在远程 pc 上卸载软件）

> ID：327650
> 
> 赞同：0
> 
> 时间：2008-11-29T16:05:07.593
> 
> 标签：c#, .net, wmi

所有，我正在尝试远程卸载软件，它在测试机器上运行良好，但我在生产服务器中遇到问题。测试机器我用过windows xp，windows 2003 server，

生产机器：windows server 2003。

可能是什么原因导致此错误，任何帮助将不胜感激。如果您有任何其他方法可以在远程 PC 上卸载软件，请分享。

```
public void Uninstallwithguid(string targetServer, string product,string guid, string version)
{
        this.Project.Log(Level.Info, "Starting Uninstall " );
        this.Project.Log(Level.Info, "targetServer :" + targetServer );
        this.Project.Log(Level.Info, "product :" + product );
        this.Project.Log(Level.Info, "guid :" + guid );
        this.Project.Log(Level.Info, "version :" + version );
        System.Management.ConnectionOptions connoptions = new System.Management.ConnectionOptions();
        connoptions.Impersonation = System.Management.ImpersonationLevel.Impersonate;
        connoptions.Timeout = new TimeSpan(0, 0, 10); // 10 seconds
        System.Management.ManagementScope scope = new System.Management.ManagementScope(@"\\" + targetServer + @"\root\cimv2", connoptions);
        scope.Connect();

        System.Management.ObjectGetOptions objoptions = new System.Management.ObjectGetOptions();
        string test = @"\\" + targetServer + @"\root\cimv2";
        string objPath = string.Format("Win32_Product.IdentifyingNumber='{0}',Name='{1}',Version='{2}'",guid, product, version);
        System.Management.ManagementPath path = new System.Management.ManagementPath(objPath);
        System.Management.ManagementObject moobj = new System.Management.ManagementObject(scope, path, null);
        UInt32 res1 = 0;
        try
        {
        res1 = (UInt32)moobj.InvokeMethod("Uninstall", null);
        }
        catch(Exception ex)
        {
         this.Project.Log(Level.Error, ex.ToString());
         throw ex;
        }
        if (res1 != 0)
        {
            this.Project.Log(Level.Error, "Uninstall error " + res1.ToString());
            throw new Exception("Uninstall error " + res1.ToString());
        }
} 
```

错误描述：

System.Management.ManagementException：System.Management.ManagementObject.Initialize(Boolean getObject) 的 System.Management.ManagementException.ThrowWithExtendedInfo(ManagementStatus errorCode) 的类无效 System.Management.ManagementObject.GetMethodParameters 的 System.Management.ManagementObject.get_ClassPath() (String methodName, ManagementBaseObject& inParameters, IWbemClassObjectFreeThreaded& inParametersClass, IWbemClassObjectFreeThreaded& outParametersClass) 在 System.Management.ManagementObject.InvokeMethod(String methodName, Object[] args)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-30T15:58:59.620

Win2003 默认没有安装这个类——你必须从产品光盘手动安装它。

# c# - 哈希表到 Dictionary<> syncroot 。

> ID：327654
> 
> 赞同：12
> 
> 时间：2008-11-29T16:06:29.713
> 
> 标签：c#, generics, dictionary, hashtable

哈希表具有同步根属性，但通用字典没有。如果我有这样做的代码：

```
lock (hashtable.Syncroot)
{
....
} 
```

如果我要删除哈希表并更改为通用字典，我该如何复制它？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-11-29T17:55:37.950

如果您严格要求兼容性，那么 Bryan 是正确的。这是在字典之上维护当前语义的最佳方式。

虽然扩展它。SyncRoot 属性未直接添加到通用字典的原因是它是一种危险的同步方式。它只比非常危险且容易出现死锁的“lock(this)”好一点。这里有几个链接说明了为什么这是不好的。

*   [http://blogs.msdn.com/bclteam/archive/2005/03/15/396399.aspx](http://blogs.msdn.com/bclteam/archive/2005/03/15/396399.aspx)
*   [http://blogs.msdn.com/ricom/archive/2006/05/01/587750.aspx](http://blogs.msdn.com/ricom/archive/2006/05/01/587750.aspx)

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-11-29T17:30:38.780

SyncRoot 背后的新思路是，它是原始设计中的一个错误。如果唯一要锁定的是字典并且它是私有的，您可以锁定它或用作同步对象的另一个对象。当您要保护的状态不仅仅是字典时，后一种技术很有用。

```
// used as you would have used SyncRoot before
object _syncLock = new object();
Dictionary<string, int> numberMapper = new Dictionary<string, int>();

// in some method...
lock (_syncLock)
{
    // use the dictionary here.
} 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-11-29T16:15:24.530

```
var dictionary = new Dictionary<int, string>();

lock(((ICollection) dictionary).SyncRoot)
{
    // ...
} 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-11-29T16:17:37.367

如果哈希表/字典不是公开的，您可以锁定字典对象本身。

# java - 在 Eclipse 中为从 Eclipse 启动的应用程序指定替代 JRE

> ID：327656
> 
> 赞同：2
> 
> 时间：2008-11-29T16:07:30.880
> 
> 标签：java, eclipse

我正在尝试在 Eclipse 中为我将从 Eclipse 启动的应用程序指定一个替代 jre（我的默认值为 1.6，我需要使用 jdk 1.4.2 运行）。我不确定我是否在以下代码中做正确的事情：

```
Path jreContainerPath = new Path("/usr/lib/jvm/j2sdk1.4.2_18/");
IVMInstall jre = JavaRuntime.getVMInstall(jreContainerPath);
workingCopy.setAttribute(IJavaLaunchConfigurationConstants. ATTR_JRE_CONTAINER_PATH, jre.getName()); 
```

但是，IVMInstall jre 为空。我想我没有正确指定容器路径，但我不确定。我必须在程序中这样做。我很乐意为此提供任何帮助。提前致谢。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-29T16:10:48.097

您是否一定要在程序本身中指定它？否则，您可以转到项目的构建路径并指定要使用的替代 jre。（右键单击项目-> java构建路径->选择jre->单击编辑->在那里选择备用jre）

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-30T01:14:50.980

[`getVMInstall`](http://kickjava.com/src/org/eclipse/jdt/launching/JavaRuntime.java.htm)返回依次调用.[`JREContainerInitializer`](http://kickjava.com/src/org/eclipse/jdt/internal/launching/JREContainerInitializer.java.htm)`.resolveVM(jreContainerPath)``getExecutionEnvironmentId()`

它将路径的第二段作为 JVM 的 id（参见`getVMName()`同一`JREContainerInitializer`类）

可能这意味着预期的路径不是字面路径，而是类似于“/jvm/j2sdk1.4.2_18”的路径，其中“j2sdk1.4.2_18”是您的 Eclipse 配置中已安装 JRE 之一的名称。

通过进一步分析源类，您应该能够准确地弄清楚该方法期望什么。

# vb.net - 慢速 MSAccess 磁盘写入

> ID：327658
> 
> 赞同：2
> 
> 时间：2008-11-29T16:07:47.543
> 
> 标签：vb.net, ms-access

我正在尝试编写一个 VB.Net 程序，该程序每天将 1-2 百万个 5 字段记录（加上索引 ID）保存到 MSAccess 表中。保存过程目前需要 13-20 个小时，这显然是不对的。

它是一个具有最少索引的平面表，目前只有 156MB。除了一个双字段外，这些字段是小字符串、日期或长整数。磁盘本身是一个 15,000 SATA，仅用于此文件。在保存例程期间，计算机和程序没有做任何其他事情。保存例程是一个简单的 FOR-NEXT 循环，它为数据集中的每条记录发出一个简短的 INSERT 语句。

任何人都知道我需要改变什么才能让它更好地工作吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-29T20:38:26.577

可以在任何 DBMS 上显着加快插入速度的技巧是在批量插入数据之前暂时禁用索引、外键和约束 - 然后在数据库中的数据之后再次启用它们。

特别是索引可能是顺序插入的性能杀手，首先填充表然后在已填充的数据上创建索引比插入索引要快至少一个数量级（有时是 2！）。在这种情况下，您可能需要删除索引，然后重新创建它。

然后，正如大多数其他海报已经说过的那样，如果你可以成串地插入东西，那么一次插入一行真的是浪费时间。如果您打开表时完全没有锁定或只有乐观锁定，您将获得轻微的速度提升。

然后你可能会通过使用 DAO 记录集而不是 ADO 获得另一个微小的增量 - 我在使用 VB6 开发的时候就注意到了这一点，可能 ADO.NET 不再是这种情况了

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-29T18:31:16.100

您应该真正管理批量插入。每个插入都有一堆开销，并且通过在 For next 循环中一次执行一行，您浪费了超过 2/3 的计算机功率。如果数据一次进入一行，您将需要构建一个缓冲区来收集它，然后再将批量插入数据库。Kibbee 建议将数据写入 csv 文件，然后将其转储到数据库中，如果您需要写下数据，这是一个好方法。我建议一次在内存中收集几分钟的数据。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-29T23:16:02.687

好了，吃完午饭回来了。

PAUL，PINEDA，您认为对 PK 进行索引是问题的建议是正确的。去掉索引后，它突然每分钟存储 40,000 条记录，速度快到可以在一小时内完成一整天的工作。而且它根本不会影响使用数据的应用程序的速度。

你们其余的慷慨的人......我会在今天剩下的时间里接受你的建议，并希望它变得更好。

你非常有帮助。我欠你们所有人一杯啤酒。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-01T15:44:07.543

您是否启用了“自动提交”？

这真的会减慢您的速度，因为每个插入都需要在处理下一个插入之前物理写入磁盘。

尝试手动提交大约每 1000 次插入。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-29T23:28:00.117

Doofledorfer：这是 5 行示例输入，正如您所问的，尽管我确实认为我现在在块插入建议和主键未索引的情况下走在正确的轨道上

```
INSERT INTO Ticks (Symbol, TickDate, TickTime, TickPRice, TickVolume) 
VALUES ('SPY', #11/28/2008#, #09:30:00#, 88.63, 200);

INSERT INTO Ticks (Symbol, TickDate, TickTime, TickPRice, TickVolume) 
VALUES ('SPY', #11/28/2008#, #09:30:00#, 88.62, 400);

INSERT INTO Ticks (Symbol, TickDate, TickTime, TickPRice, TickVolume) 
VALUES ('SPY', #11/28/2008#, #09:30:00#, 88.62, 100);

INSERT INTO Ticks (Symbol, TickDate, TickTime, TickPRice, TickVolume) 
VALUES ('SPY', #11/28/2008#, #09:30:00#, 88.62, 300);

INSERT INTO Ticks (Symbol, TickDate, TickTime, TickPRice, TickVolume) 
VALUES ('SPY', #11/28/2008#, #09:30:00#, 88.62, 127); 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-29T18:31:08.533

操作，错过了您的一个问题 STEPHBU ... 我允许索引 ID 自动递增，而不是尝试在 INSERT 语句中分配它。好主意，不过！

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2012-01-12T00:14:22.583

我建议使用索引顺序访问方法 - ISAM。它允许您直接将数据从连接的记录源传输到第二个动态连接的数据源。

1.  使用 OleDbConnection 或类似对象打开连接

2.  使用 ISAM 格式代替*FROM对连接运行查询*

语法是这样的：

```
private void PopulateMDB(string ExportPath, int iID)
{

  string cnnStr = "Provider=Microsoft.Jet.OLEDB.4.0;Data Source=" + ExportPath;
  OleDbConnection oConn = new OleDbConnection(cnnStr);
  string q = @"INSERT 
                INTO PensionData ([ID]
                        ,[Recipient Name]
                        ,[Gross Amt]
                        ,[Retirement Date]
                        ,[Plan])

            select id  as [ID]
                  ,name as [Recipient Name]
                  ,gross_amt as [Gross Amt]
                  ,eff_dt as [Retirement Date]
                  ,pln as [Plan]
              FROM [ODBC;Driver=SQL Server;SERVER=euddbms.d;DATABASE=DBName;UID=;PWD=;].tableName
            WHERE id = " + iID;

  oConn.Open();

  try
  {
    OleDbCommand oCmd = new OleDbCommand(q, oConn);

    oCmd.ExecuteNonQuery();
  }
  catch (Exception ex)
  {
    throw ex;
  }
  finally
  {
    oConn.Close();
    oConn = null;
  }

} 
```

**ISAM 的东西:** :

*CSV* [文本；数据库=C:_Path\；HDR=是].[文件.csv]

*访问* [MS Access;Database=C:\Path\File.mdb].[AccessTableName]

*Excel* [Excel 8.0；HDR=是；IMEX=1；MaxScanRows=16；数据库=C:\Path\File.xls].[Table$]

*SQL Server* [ODBC;Driver=SQL Server;SERVER=;DATABASE=;UID=;PWD=;].[表]

[http://support.microsoft.com/kb/321686](http://support.microsoft.com/kb/321686) [http://support.microsoft.com/kb/200427](http://support.microsoft.com/kb/200427)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-29T17:24:37.433

谢谢，杜夫莱多夫。

数据来自实时数据供应商的互联网，采用专有的“矢量”格式，我将其解析为数据集。在开始保存例程之前，我会解析整个文件。是的，如果我可以将数据集直接“导入”到数据库中，而不是单独保存每条记录，那就太好了。但我不知道如何做到这一点。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-11-29T17:27:12.063

您可以尝试将数据写入 CSV 文件，然后使用单个命令轻松将数据导入访问。这可能会显着加快该过程。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-11-29T17:40:56.857

您对 MSAccess 数据库 (mdb) 打开了多少个连接？从我所见，单用户模式比多用户模式快得多。任何打开的 MS Access 程序都算作单个连接（您可以使用[ldbview](http://support.microsoft.com/kb/176670)工具查看 ldb 文件内部）。

您使用行级锁定还是页级锁定？从某些 Access 版本（2000？）开始，它默认为行级锁定；我认为页面级锁定会更快。

你没有运行一些杀毒软件吗？它们可以拦截文件操作并显着减慢整个过程。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-11-29T17:57:36.183

只有一个连接打开，它是一个单用户系统。

尝试关闭我的防病毒软件，但它仍然每秒只能保存 800 条记录。

我不熟悉“锁定”，但我的 OLEDB 连接字符串包含“锁定模式=1”

顺便说一句，如果相关的话，VM 大小在短短几分钟后就增长到 157,000K。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-11-29T17:59:08.270

这里有一些关于分隔文本文件的附加查询的注释，恐怕是 VBScript，但它可能会有所帮助。

```
Set cn = CreateObject("ADODB.Connection")
strFile="C:\ltd.mdb"
strCon="Provider=Microsoft.Jet.OLEDB.4.0;Data Source=" _
& strFile & ";" 

cn.Open strCon

strSQL="INSERT INTO tableX ( Name1,Name2 ) " _
& "SELECT Name1,Name2 " _
& "FROM [ltd.txt] IN '' [Text;Database=c:\docs\;HDR=YES;]"

cn.Execute strSQL 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-11-29T18:06:01.983

尝试 Locking mode=0 - 这是页面级别。800 rps（每秒记录数）每 10 分钟提供 480000 条记录 - 你的意思是 800 rpm 吗？

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-11-29T18:06:18.067

迈克，病毒扫描程序禁用了改进的东西-但听起来仍然有些不正常...同意@Remou的观点，如果可以的话，批量插入的性能会更好。

假设你不能批量插入，只是做了一个示例应用程序（C#，抱歉 - 但 VB.NET 将类似）来创建目录、表并执行一些插入。我暂时跳过了对 ID 的 PK 约束。

这让我在 550 毫秒内运行了大约 1,000 行，在带有病毒扫描程序的虚拟机中运行，笔记本电脑驱动器运行节能。您应该能够通过快速驱动轻松击败它。差异在哪里？

一个想法是你是如何插入 ID 的？从 INSERT 语句中自动生成和省略？或者您插入了一个值并且该列标记为 PK？后者肯定会触发索引查找（您的大量读取 IO ？？？）以验证数据对表的唯一性？

```
using System;
using System.Data;
using System.Data.OleDb;

namespace ConsoleApplication1
{
    class Program
    {
        static void Main(string[] args)
        {
            String jetConnection = "Provider=Microsoft.Jet.OLEDB.4.0; Data Source=C:\\jetsample.mdb;";

            ADOX.CatalogClass cat = new ADOX.CatalogClass();
            cat.Create(jetConnection);

            using(OleDbConnection conn = new OleDbConnection(jetConnection))
            {
                conn.Open();
                using(OleDbCommand cmd = new OleDbCommand("CREATE TABLE test ([ID] INTEGER, [TestDouble] DOUBLE, [TestText] TEXT, [TestDate] DATE, [TestInt] INTEGER)",conn))
                {
                    cmd.CommandType = CommandType.Text;
                    cmd.ExecuteNonQuery();
                }

                using (OleDbCommand cmd = new OleDbCommand("INSERT INTO [Test] VALUES (@id, @testDouble, @testText, @testDate, @testInt)", conn))
                {
                    OleDbParameter id = cmd.Parameters.Add("@id", OleDbType.Integer);
                    OleDbParameter testDouble = cmd.Parameters.Add("@testDouble", OleDbType.Double);
                    OleDbParameter testText = cmd.Parameters.Add("@testText", OleDbType.VarWChar);
                    OleDbParameter testDate = cmd.Parameters.Add("@testDate", OleDbType.Date);
                    OleDbParameter testInt = cmd.Parameters.Add("@testInt", OleDbType.Integer);

                    DateTime start = DateTime.Now;
                    for (int index = 1; index <= 2000000; index++)
                    {
                        if (index % 1000 == 0)
                        {
                            System.Diagnostics.Debug.WriteLine(((TimeSpan)(DateTime.Now - start)).Milliseconds);
                            start = DateTime.Now;
                        }

                        id.Value = index;
                        testDouble.Value = index;
                        testText.Value = String.Format("{0} DBL", index);
                        testDate.Value = DateTime.Now.AddMilliseconds(index);
                        testInt.Value = index;

                        cmd.ExecuteNonQuery();
                    }
                }
            }

        }
    }
} 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-11-29T18:26:07.467

阿沃；关闭病毒扫描程序并进入锁定模式 = 0 有助于...现在每分钟最多 1300 条记录（是的，我的意思是几分钟）但这仍然很慢。

STEPHBU：我的 C 技能很少，但据我所知，你做的事情和我几乎一样。你的“JetConnection”字符串比我的简单得多......这是我的

```
 Me.connSPY.ConnectionString = "Jet OLEDB:Global Partial Bulk Ops=2;" & _
    "Jet OLEDB:Registry Path=;Jet OLEDB:" & _
    "Database Locking Mode=0;" & _
    "Data Source=""E:\SPIRE.mdb"";" & _
    "Mode=Share Deny None;" & _
    "Jet OLEDB:Engine Type=5;" & _
    "Provider=""Microsoft.Jet.OLEDB.4.0"";" & _
    "Jet OLEDB:System database=;" & _
    "Jet OLEDB:SFP=False" & _
    ";persist security info=False;" & _
    "Extended Properties=;" & _
    "Jet OLEDB:Compact Without Replica Repair=False;" & _
    "Jet OLEDB:Encrypt Database=False;" & _
    "Jet OLEDB:Create System Database=False;" & _
    "Jet OLEDB:Don't Copy Locale on Compact=False;" & _
    "User ID=Admin;" & _
    "Jet OLEDB:Global Bulk Transactions=1" 
```

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2008-12-05T20:31:17.473

CodeSlave .... 这是一个有效的观点，如果这一切都解决了，那么我将不得不花钱购买 SQL Server 或类似的东西，更不用说多买几台电脑了。目前，我不想投资现金或学习曲线。

安德森先生……还没试过，我会的。但就目前而言，其他建议将我的 10-20 小时节省时间缩短到 15 分钟，所以我是一个非常快乐的露营者。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2008-11-29T16:14:16.750

（免责声明：我对 Access 知之甚少）

任何分析工具都说什么？（任务管理器会给你一些线索——在显示中添加更多列以查看 I/O、VM 使用情况等）？它是在做很多磁盘访问，还是全部是 CPU？是否消耗大量内存？

索引的提及与我有关，因为在每次插入后可能需要更新 - 您可以关闭索引，进行创建，然后索引完整的文件吗？

它在时间上是线性的吗？（即，如果您创建一个大小为 10% 的文件，是否需要 10% 的时间）？

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2008-11-29T16:45:44.267

谢谢你的问题，保罗。

页面文件使用量为 600MB，CPU 大部分时间约为 5%，每 20 秒左右达到 80% 范围内的峰值。内存：共2G，可用1.3G，系统缓存1G。

是的，它似乎是线性的，前 15,000 条记录需要 10 分钟。

至于索引，我没有尝试过，但是如果您至少没有索引 ID 字段，Access 总是会抱怨。

不过，I/O 读取似乎很多，在运行 20 分钟后接近 6M，并且只有 25,000 条记录。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2008-11-29T17:00:26.860

首先，尝试使用 Access 中的众多导入选项之一。（数据从哪里来？是定界的，还是固定长度的？你如何用VB解析它？）

您应该能够创建没有索引的表。通过拒绝 Access 提供的添加一个。但首先通过导入工作。

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2008-12-01T01:29:16.067

> 每天将 1-2 百万条 5 字段记录（加上索引 ID）写入 MSAccess 表。

冒着说明什么应该是显而易见的风险。你正在解决错误的问题。

转储 MS-Access 并将它们推送到 MS-SQL 服务器上。如果您以后真的必须通过 MS-Access 访问数据，那么只需创建一个指向 MS-SQL 服务器表的表链接。

即使每条记录 5 个字节，您也将在不到一年的时间内超过 MS Access 2003 的 2GB 表/数据库大小限制（不幸的是，这与 MS Access 2007 的情况相同）。

# macos - Mac OS X 终端：将选项+删除映射到“向后删除单词”

> ID：327664
> 
> 赞同：278
> 
> 时间：2008-11-29T16:11:47.893
> 
> 标签：macos, keyboard-shortcuts, terminal

尝试从首选项-> 设置-> 键盘映射它，但“键”组合框只有“向前删除”但没有“删除”。另一方面，我的键盘只有“删除”，没有“前向删除”！

除了偏好之外，还有其他方法吗？

* * *

## 回答 #1

> 赞同：520
> 
> 时间：2008-11-29T16:30:08.417

# 启用选项键作为元键

1.  转到`Terminal`> `Preferences`> `Profiles`>`Keyboard`
2.  检查`Use option key as meta key`。

### 图片

在 2018 年 10 月 23 日捕获的 macOS High Sierra 10.13.6 上。

[![将选项键切换为元键的窗口图示](https://i.stack.imgur.com/TUW6a.png)](https://i.stack.imgur.com/TUW6a.png)

### 笔记

许多应用程序（包括 bash 和 tcsh）将 Meta-Delete 视为“向后删除字”。

* * *

## 回答 #2

> 赞同：81
> 
> 时间：2012-01-28T03:56:23.860

OS X 的终端运行 bash，其中包括 readline 支持。按照Glomek的建议，告诉终端使用 option 作为元键（或者使用`Esc`），然后你有一堆方便的选项：f 和 Meta+b 通过单词前后移动，+和+到行首和行尾，+从光标到行尾删除（杀死），等等。`Ctrl``w``Ctrl``a``Ctrl``e``Ctrl``k`

请参阅[http://www.bigsmoke.us/readline/shortcuts](http://www.bigsmoke.us/readline/shortcuts)以获取一个不错的小参考表。

* * *

## 回答 #3

> 赞同：71
> 
> 时间：2015-08-17T20:18:54.680

删除一个倒退的词：

Ctrl-w。

* * *

## 回答 #4

> 赞同：28
> 
> 时间：2019-11-21T03:20:25.787

**命令编辑快捷键**

`Ctrl + a`- 转到命令行的开头

`Ctrl + e`– 转到命令行末尾

`Ctrl + k`– 从光标处删除到命令行末尾

`Ctrl + u`– 从光标处删除到命令行开头

`Ctrl + w`– 从光标处删除到单词的开头（即向后删除一个单词）

`Ctrl + y`- 将使用删除快捷方式之一（如上面的快捷方式）剪切的单词或文本粘贴到光标后

`Ctrl + xx`– 在命令行开头和当前光标位置之间移动（然后再返回）

`Alt + b`– 向后移动一个单词（或转到光标当前所在单词的开头）

`Alt + f`- 向前移动一个单词（或转到光标当前所在单词的末尾）

`Alt + d`- 从光标处删除到单词的结尾（如果光标在单词的开头，则删除整个单词）

`Alt + c`– 大写到从光标开始的单词的结尾（如果光标在单词的开头，则整个单词）

`Alt + u`- 从光标到词尾变为大写

`Alt + l`- 从光标到词尾变成小写

`Alt + t`– 将当前单词与前一个单词交换

`Ctrl + f`- 向前移动一个字符

`Ctrl + b`– 向后移动一个字符

`Ctrl + d`– 删除光标下的字符

`Ctrl + h`– 删除光标前的字符

`Ctrl + t`- 将光标下的字符与前一个字符交换

**命令调用快捷键**

`Ctrl + r`- 向后搜索历史

`Ctrl + g`- 退出历史搜索模式

`Ctrl + p`– 历史中的上一个命令（即，回溯命令历史）

`Ctrl + n`– 历史中的下一个命令（即向前浏览命令历史）

`Alt + .`– 使用上一条命令的最后一个字

**命令控制快捷键**

`Ctrl + l`- 清除屏幕

`Ctrl + s`- 停止输出到屏幕（用于长时间运行的详细命令）

`Ctrl + q`- 允许输出到屏幕（如果之前使用上面的命令停止）

`Ctrl + c`– 终止命令

`Ctrl + z`– 暂停/停止命令

**Bash Bang (!) 命令**

Bash 还有一些使用 ! (bang) 允许您使用 bash 命令做一些时髦的事情。

`!!`– 运行最后一个命令 `!blah`– 运行以 'blah' 开头的最新命令（例如 !ls）

`!blah:p`– 打印出 !blah 将运行的命令（也将其添加为命令历史记录中的最新命令）

`!$`– 上一条命令的最后一个字（同`Alt + .`）

`!$:p`– 打印出 !$ 将替代的单词

`!*`– 除最后一个单词外的上一个命令（例如，如果您键入`_find somefile.txt /`，那么`!*`将给您`_find somefile.txt`）

`!*:p`– 打印出什么`!*`可以替代

* * *

## 回答 #5

> 赞同：27
> 
> 时间：2015-06-10T10:06:02.427

`⌃W`(control+W) 与 meta + delete 不同（ESC+delete，如果你没有选中使用选项作为元键） meta+delete 将`/ _`视为单词分隔符，`^W`将空格视为分隔符。

例如在（末尾的光标）上使用 ESC+Bakcspace

```
rm /dira/dirb/file1 
```

给

```
rm /dira/dirb/ 
```

而 ^W 也会给出

```
rm 
```

所以在定义修改终端配置文件时最好使用\033\177而不是^W。这样，您实际上将 ⌥⌫ 映射到 esc⌫ 正在执行的操作，并且您继续让 ^W 根据空格分隔符擦除单词。

我希望能够发布一张关于如何做到这一点的图片，但作为一个新手，我不能。

请参阅 bouke 评论以查看如何修改终端配置文件。

* * *

## 回答 #6

> 赞同：26
> 
> 时间：2008-11-29T19:12:07.203

默认情况下，元退格会在大多数 shell 中执行向后的单词 yank。如果您按退出键，然后按退格键，则几乎可以在任何地方使用。

* * *

## 回答 #7

> 赞同：19
> 
> 时间：2015-04-21T13:32:13.247

在您的终端配置文件中，您可以将⌥⌫（选项+删除）绑定到⌃W（控制+W），因此它与其他应用程序类似。

![终端配置文件键盘设置](https://i.stack.imgur.com/fovF6.png)

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2019-12-28T17:08:43.427

在`Natural Text Editing`Profile -> Keys 中启用预设。你可以简单地删除这个词

*   落后于`alt + delete`
*   转发`fn + alt + delete`

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2021-10-14T09:35:14.257

如果您使用的是[Iterm2](https://iterm2.com/)（这就像 OSX 的常规终端更好:) 您可以使用它来更改此行为：

您需要将左 ⌥ 键设置为转义字符。这可以通过 iTerm2 > Preferences > Profiles > Keys 来完成。

[![在此处输入图像描述](https://i.stack.imgur.com/6z9UZ.png)](https://i.stack.imgur.com/6z9UZ.png)

# c++ - 将宽字符串转换为提升日期

> ID：327673
> 
> 赞同：4
> 
> 时间：2008-11-29T16:27:01.857
> 
> 标签：c++, datetime, boost, localization, facet

我需要将存储为宽字符串的数百万个日期转换为提升日期

以下代码有效。但是，它会生成一个可怕的编译器警告，并且似乎效率不高。

有没有更好的办法？

```
#include "boost/date_time/gregorian/gregorian.hpp"
using namespace boost::gregorian;

#include <string>
using namespace std;

    wstring ws( L"2008/01/01" );

    string temp(ws.length(), '\0');
    copy(ws.begin(), ws.end(), temp.begin());
    date d1( from_simple_string( temp ) );

    cout << d1; 
```

* * *

更好的方法是使用标准 C++ 库*locale*，它是*facets*的集合。facet 是一项服务，它允许流操作员处理日期或时间表示或其他任何内容的特定选择。所有关于不同事物的选择，每一个都由它自己的方面处理，都聚集在一个语言环境中。

[这个解决方案是由litb](https://stackoverflow.com/users/34509/litb)向我指出的， 他给了我足够的帮助来在我的生产代码中使用构面，使其更简洁、更快。谢谢。

Nathan Myers有一个关于语言环境和方面的[优秀教程，他设计了方面。](http://www.cantrip.org/locale.html)他有一种轻松的风格，使他的教程易于阅读，尽管这是高级的东西，第一次通读后你的大脑可能会受伤——我的就是这样。我建议你现在去那里。对于任何只想将宽字符串转换为提升日期的实用性的人，本文的其余部分描述了使其工作所需的最低限度。

* * *

litb 首先提供了以下消除编译器警告的简单解决方案。（解决方案在我开始接受之前已被编辑。）这看起来像它做同样的事情，一个一个地转换宽字符，但它避免了使用临时字符串，因此更清晰，我认为。我真的很喜欢编译器警告消失了。

```
#include "boost/date_time/gregorian/gregorian.hpp"
using namespace boost::gregorian;

#include <string>
using namespace std;

    wstring ws( L"2008/01/01" );

    date d1( from_simple_string( string( ws.begin(), ws.end() ) );

    cout << d1; 
```

* * *

litb 继续建议使用我以前从未听说过的“方面”。他们似乎完成了这项工作，在循环中生成了非常简洁的代码，但代价是设置语言环境的序言。

```
wstring ws( L"2008/01/01" );

// construct a locale to collect all the particulars of the 'greek' style
locale greek_locale;
// construct a facet to handle greek dates - wide characters in 2008/Dec/31 format
wdate_input_facet greek_date_facet(L"%Y/%m/%d");
// add facet to locale
greek_locale = locale( greek_locale, &greek_date_facet );
// construct stringstream to use greek locale
std::wstringstream greek_ss; 
greek_ss.imbue( greek_locale );

date d2;

greek_ss << ws;
greek_ss >> d2;

cout << d2; 
```

事实证明，这也更有效：

```
clock_t start, finish;
double  duration;

start = clock();
for( int k = 0; k < 100000; k++ ) {
    string temp(ws.length(), '\0');
    copy(ws.begin(), ws.end(), temp.begin());
    date d1( from_simple_string( temp ) );
}
finish = clock();
duration = (double)(finish - start) / CLOCKS_PER_SEC;
cout << "1st method: " << duration << endl;

start = clock();
for( int k = 0; k < 100000; k++ ) {
    date d1( from_simple_string( string( ws.begin(), ws.end() ) ) );
}
finish = clock();
duration = (double)(finish - start) / CLOCKS_PER_SEC;
cout << "2nd method: " << duration << endl;

start = clock();
for( int k = 0; k < 100000; k++ ) {
    greek_ss << ws;
    greek_ss >> d2;
    ss.clear();
}
finish = clock();
duration = (double)(finish - start) / CLOCKS_PER_SEC;
cout << "3rd method: " << duration << endl; 
```

产生以下输出：

```
第一种方法：2.453
第二种方法：2.422
第三种方法：1.968

```

好的，这现在在生产代码中并通过了回归测试。它看起来像这样：

```
 //  .. construct greek locale and stringstream 

  // ... loop over input extracting date strings

        // convert range to boost dates
        date d1;
        greek_ss<< sd1; greek_ss >> d1;
        if( greek_ss.fail() ) {
                       // input is garbled
            wcout << L"do not understand " << sl << endl;
            exit(1);
        }
         greek_ss.clear();

// finish processing and end loop 
```

我对此有最后一个问题。将方面添加到语言环境似乎需要两次调用语言环境复制构造函数

```
 // add facet to locale
greek_locale = locale( greek_locale, &greek_date_facet ); 
```

为什么没有 add(facet*) 方法？（ _Addfac() 很复杂，未记录且已弃用）

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-29T16:35:35.333

efotinis 找到了使用**from_stream**的好方法。

* * *

我查看了手册，`date_time`发现它支持方面：

```
#include <boost/date_time/gregorian/gregorian.hpp>
#include <iostream>
#include <sstream>
#include <locale>

int main() {
    using namespace boost::gregorian;

    std::wstringstream ss;
    wdate_input_facet * fac = new wdate_input_facet(L"%Y-%m-%d");
    ss.imbue(std::locale(std::locale::classic(), fac));

    date d;
    ss << L"2004-01-01 2005-01-01 2006-06-06";
    while(ss >> d) {
        std::cout << d << std::endl;
    }
} 
```

你也可以这样做。

* * *

我查看了日期方面的工作原理：

*   该`boost::date_time::date_input_facet`模板实现了一个方面。
*   刻面派生自`std::locale::facet`每个刻面，每个刻面都有一个唯一的 id。
*   您可以*将*新的语言环境注入流中，替换其旧的语言环境。流的语言环境将用于各种解析和转换。
*   当您`std::locale`使用我显示的表单创建一个新的时，您给它一个现有的语言环境和一个指向 facet 的指针。给定的方面将替换给定语言环境中相同类型的任何现有方面。（因此，它将替换使用的任何其他 date_input_facet）。
*   所有方面都以某种方式与语言环境相关联，因此您可以使用它`std::has_facet<Facet>(some_locale)`来检查给定的语言环境是否具有某些给定的方面类型。
*   您可以通过执行`std::use_facet<Facet>(some_locale).some_member...`.
*   date_input_facet 有一个 get 函数，可以这样使用：

以下内容基本上`operator>>`由 boost::date_type 完成：

```
// assume src is a stream having the wdate_input_facet in its locale. 
// wdate_input_facet is a boost::date_time::date_input_facet<date,wchar_t> typedef.

date d;

// iterate over characters of src
std::istreambuf_iterator<wchar_t> b(src), e;

// use the facet to parse the date
std::use_facet<wdate_input_facet>(src.getloc()).get(b, e, src, d); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-29T17:28:09.313

您可以使用**from_stream**解析器函数：

```
using boost::gregorian::date;
using boost::gregorian::from_stream;

std::wstring ws( L"2008/01/01" );
date d1(from_stream(ws.begin(), ws.end()));
std::cout << d1;  // prints "2008-Jan-01" 
```

# c# - 如何使用 System.Speech 和 SAPI 5.3 将单词添加到已加载的语法中

> ID：327678
> 
> 赞同：4
> 
> 时间：2008-11-29T16:32:04.827
> 
> 标签：c#, .net, speech-recognition, sapi

给定以下代码，

```
Choices choices = new Choices();
choices.Add(new GrammarBuilder(new SemanticResultValue("product", "<product/>")));

GrammarBuilder builder = new GrammarBuilder();
builder.Append(new SemanticResultKey("options", choices.ToGrammarBuilder()));

Grammar grammar = new Grammar(builder) { Name = Constants.GrammarNameLanguage};
grammar.Priority = priority;

_recognition.LoadGrammar(grammar); 
```

如何在加载的语法中添加其他单词？我知道这可以通过本机代码和使用 SpeechLib 互操作来实现，但我更喜欢使用托管库。

**更新：**我想要实现的是，不必因为个别更改而重复加载整个语法。对于小语法，我通过调用得到了很好的结果

```
_recognition.RequestRecognizerUpdate() 
```

然后在事件中卸载旧语法并加载重建的语法：

```
void Recognition_RecognizerUpdateReached(object sender, RecognizerUpdateReachedEventArgs e) 
```

对于大型语法，这变得太昂贵了。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-16T16:53:55.720

听起来您需要通过语法规则参考使用一些间接性。这可以通过 GrammarBuilder.AppendRuleReference 方法来完成。首先使用一些 SRGS 语法文件来测试您的语法可能更容易。

原理是您将一个包含一些参考的主要大型语法加载到较小的用户特定单词列表语法，您将动态加载这些语法。

有关srgs 格式，请参见[http://www.w3.org/TR/speech-grammar/#S2.2 ，以及](http://www.w3.org/TR/speech-grammar/#S2.2)[http://msdn.microsoft.com/en-us/library/system.speech.recognition.grammarbuilder .appendrulereference.aspx](http://msdn.microsoft.com/en-us/library/system.speech.recognition.grammarbuilder.appendrulereference.aspx)用于编程版本。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-09-17T22:29:27.493

在本机 SAPI 中，我会使用 ISpGrammarBuilder2::AddTextSubset()。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-16T23:51:26.793

如果您有非常大的语法，另一种选择是使用听写语法选项。有一个标准的听写语法，但您也可以指定自己的。请参阅[http://msdn.microsoft.com/en-us/library/system.speech.recognition.dictationgrammar.aspx](http://msdn.microsoft.com/en-us/library/system.speech.recognition.dictationgrammar.aspx)，它是构造函数。

你不会更新这个。它包含所有可能的单词。

# jquery - 显示“正在加载”消息的方法

> ID：327681
> 
> 赞同：2
> 
> 时间：2008-11-29T16:36:44.893
> 
> 标签：jquery, ajax, json

我正在使用 jquery 和 getJSON 方法，我想知道是否有办法在加载我的内容之前显示一条消息说正在加载。我知道对于 jquery ajax 调用，在提交回调之前你可以有一些东西，但 getJSON 只有三个选项。

有任何想法吗？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-11-29T17:48:22.160

将此添加到您的页面的某处：

```
<div id="loading" style="display:none">
    <img src="/images/ajax-loader.gif" alt="Loader" />&nbsp;Loading...
</div>
<script type="text/javascript">
    $().ready(function() {
        $("#loading").bind("ajaxSend", function() {
            $(this).show();
        }).bind("ajaxComplete", function() {
            $(this).hide();
        });
    });
</script> 
```

您可以根据需要设置 loader-div 的样式，例如 Google Mail-like loader：

```
#loading
 {
   position:fixed; 
   _position:absolute;
   top: 0;
   left:47%; 
   padding:2px 5px;
   z-index: 5000;
   background-color:#CF4342;
   color:#fff;
 } 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-11-29T16:50:20.357

您可以触发自定义`.ajax`“之前”和“成功”事件。

但是，通常情况下，您只会做类似的事情

```
 showLoadingAnimation(); 
  $.getJSON(  ..... function(){
      dontShowLoadingAnimation(); 
  }); 
```

或类似的东西。

然而，您的问题有些模糊，很难确定您想要做什么，而您已经无法简单地使用 javascript 来完成。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-11-29T17:11:10.223

您可以在 jQuery 对象上使用[ajaxSend](http://docs.jquery.com/Ajax/ajaxSend)和[ajaxStop](http://docs.jquery.com/Ajax/ajaxStop)来附加适当的事件处理程序，如[本教程](http://techxplorer.com/2007/10/06/using-jquery-for-an-ajax-loading-message/)中所述。无论请求的类型如何（所有 jQuery AJAX 和 JSON 方法），这都会显示进度指示器，并且如果发生错误，也会隐藏加载图形。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-29T22:03:47.947

肯特，

类似的东西会起作用，只需显示一个带有显示文本 Loading... 的简单 div 元素，然后显示我的 JSON 结果。

瑞安

# javascript - 使用淡入淡出和追加

> ID：327682
> 
> 赞同：74
> 
> 时间：2008-11-29T16:38:53.300
> 
> 标签：javascript, jquery, fade

我正在将 JSON 数据加载到我的页面并使用`appendTo()`，但我试图淡化我的结果，有什么想法吗？

```
$("#posts").fadeIn();
$(content).appendTo("#posts"); 
```

`append`我看到文件上的和,之间有区别`appendTo`。

我也试过这个：

```
$("#posts").append(content).fadeIn(); 
```

***我明白了，上面的伎俩！***

但我得到`"undefined"`了我的 JSON 值之一。

* * *

## 回答 #1

> 赞同：169
> 
> 时间：2008-11-29T16:49:28.520

如果您在附加内容之前隐藏内容并将fadeIn 方法链接到该内容，您应该获得您正在寻找的效果。

```
// Create the DOM elements
$(content)
// Sets the style of the elements to "display:none"
    .hide()
// Appends the hidden elements to the "posts" element
    .appendTo('#posts')
// Fades the new content into view
    .fadeIn(); 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-11-29T17:21:02.433

我不知道我是否完全理解您遇到的问题，但这样的事情应该有效：

HTML：

```
<div id="posts">
  <span id="post1">Something here</span>
</div> 
```

Javascript：

```
var counter=0;

$.get("http://www.something/dir",
    function(data){
        $('#posts').append('<span style="display:none" id="post' + counter + ">" + data + "</span>" ) ;
        $('#post' + counter).fadeIn();
        counter += 1;
    }); 
```

基本上，您将每个内容（每个“帖子”）包装在一个跨度中，将该跨度的显示设置为无，因此它不会显示，然后将其淡入。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2010-02-19T21:56:43.960

我认为这应该可以解决您的问题。

```
$('#content').prepend('<p>Hello!</p>');
$('#content').children(':first').fadeOut().fadeIn(); 
```

如果您正在执行追加，那么您必须改用 :last 选择器。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-11-29T16:54:50.847

您必须知道代码不会线性执行。不能指望动画的东西会停止代码执行以执行动画然后返回。

```
 commmand(); 
   animation(); 
   command(); 
```

 `This is because the animation uses set timeout and other similar magic to do its job and settimeout is non-blocking.

This is why we have callback methods on animations to run when the animation is done ( to avoid changing something which doesn't exist yet )` 

```
 command(); 
   animation( ... function(){ 
      command(); 
   }); 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2012-10-07T10:55:31.347

```
$(output_string.html).fadeIn().appendTo("#list"); 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2011-07-17T13:03:37.940

假设您在定义的 css 中有以下内容：

```
.new {display:none} 
```

和 javascript 应该是：

```
$('#content').append('<p class='new'>Hello!</p>');
$('#content').children('.new').fadeIn();
$('#content').children.removeClass('new');
$('#content').children('.new').hide(); 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2011-12-23T18:40:59.427

首先是将接收到的数据转换为 jQuery 对象。第二，立即隐藏。第三，将其附加到目标节点。而且，毕竟，我们可以清楚地使用必要的动画，就像fadeIn :)

```
jNode = $("<div>first</div><div>second</div>");
jNode.hide();
$('#content').append(jNode);
jNode.fadeIn(); 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2012-07-31T16:42:04.140

我有一个丰富的，为此：

```
$("dt").append(tvlst.ddhtml);
$("dd:last").fadeIn(700); 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2018-04-05T04:28:01.307

**我试过你说的方法，但没有奏效。 *它使用以下代码***

```
$("div").append("content-to-add").hide().fadeIn(); 
```

# javascript - 有没有办法在 JavaScript 中读取二进制数据？

> ID：327685
> 
> 赞同：46
> 
> 时间：2008-11-29T16:43:32.417
> 
> 标签：javascript, binary

我想将二进制数据注入 JavaScript 中的对象。有没有办法做到这一点？

IE

```
var binObj = new BinaryObject('101010100101011'); 
```

有这样的效果。任何帮助都会很棒。

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2008-11-29T16:46:32.690

您可以使用 parseInt：

`var bin = parseInt('10101010', 2);`

第二个参数（基数）是输入的基数。

* * *

## 回答 #2

> 赞同：23
> 
> 时间：2009-11-22T21:15:28.023

[这里解释了](http://blog.nihilogic.dk/2008/05/reading-exif-data-with-javascript.html)这个[二进制 ajax 库](http://www.nihilogic.dk/labs/binaryajax/binaryajax.js)，还有另一个可以处理更多数据类型的[二进制解析器库。](http://jsfromhell.com/classes/binary-parser)

[您还可以查看具有二进制 Blob 对象](http://code.google.com/apis/gears/api_blob.html)的 Google Gears或查看为 Flash 制作 javascript 包装器，该包装器提供[本机 ByteArray 实现](http://www.adobe.com/livedocs/flex/3/langref/flash/utils/ByteArray.html)。

或者......你可以坐等，希望所有这些事情都成为[标准](http://www.w3.org/TR/FileAPI/):)

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2011-01-27T11:02:57.903

在所有最近的浏览器上，您可以执行以下操作：

```
xhr.overrideMimeType('text/plain; charset=x-user-defined'); 
```

并检索一个字符串。要获得二进制结果，您必须这样做

```
data.charCodeAt(pos) & 0xff; 
```

* * *

在 Firefox 和 Chrome 的夜间版本中，您可以将值作为[ArrayBuffer检索](https://developer.mozilla.org/en/JavaScript_typed_arrays)

```
xhr.responseType = "arraybuffer"; 
```

然后可以在那里访问结果

```
xhr.mozResponseArrayBuffer // Firefox
xhr.response // Chrome 
```

然后您可以在缓冲区上应用[TypedArray](https://developer.mozilla.org/en/JavaScript_typed_arrays/ArrayBufferView)（例如：Int32Array）或[DataView](https://developer.mozilla.org/en/JavaScript_typed_arrays/DataView)来读取结果。

* * *

为了使这个过程更容易，我制作了一个支持二进制类型的[jQuery Patch](http://blog.vjeux.com/2011/javascript/jquery-binary-ajax.html)和一个使用浏览器最新可用读取功能的[DataView Wrapper 。](http://blog.vjeux.com/2011/javascript/jdataview-read-binary-file.html)

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2009-09-11T16:57:44.127

JavaScript 对原始二进制数据的支持很少。一般来说，最好在这个限制内生活。但是，我正在考虑为我的一个项目尝试一个技巧，该技巧涉及操纵巨大的位图以在 OLAP 数据库中进行设置操作。 **这在 IE 中不起作用**。

基本思想是这样的：将二进制数据强制转换为 PNG 以将其发送到 JavaScript，例如，位图可能是黑白 PNG，黑色是 100% 透明的。然后使用 Canvas 操作进行按位数据操作。

[HTML5 Canvas](http://www.whatwg.org/specs/web-apps/current-work/multipage/the-canvas-element.html)包含一个[像素数组类型](http://www.whatwg.org/specs/web-apps/current-work/multipage/the-canvas-element.html#canvaspixelarray)，它允许访问图像中的字节。Canvas 还支持合成操作，例如 XOR。Lighten 和 darken 应该可以做 AND 和 OR。这些操作很可能在任何支持它们的浏览器中得到很好的优化——可能使用 GPU。

如果有人尝试这个，请让我知道它的效果如何。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2010-12-10T16:42:56.323

那将是另一种方式......`pow`并且`squareroot`可能由数学类计算......我不知道它是否是最快的方式，但它与“程序员视图”中的 Windows 计算器一样快。

```
AlertFormatedBin();
function AlertFormatedBin()
{
    var vals = decToBinArr(31,8);
    var i;

    var s = "";
    var mod = vals.length % 4;
    for(i= 0; i <mod;i++)
    {
        s+=vals[i];
    }
    if(i>0)
        s+=" ";
    var j = i;
    for(i;i<vals.length;i++)
    {
        s+=vals[i];
        if(i-j != 0 && (i+1-j)%4 == 0)
        {
            s+=" ";
        }
    }
    alert(s);
}

function decToBinArr(dec, minSize)
{
    var mod = dec%2;
    var r = new Array();
    if(dec > 1)
    {
        dec-=mod;
        var bd = squareRootRoundedDown(dec);
        if(minSize && minSize-1 > bd)
            bd = minSize-1;
        else
            var i;
            for(i = bd; i>0;i--)
            {
                var nxt = pow(2,i);
                if(dec >= nxt)
                {
                    r[i] = 1;
                    dec-=nxt;
                }
                else
                {
                    r[i] = 0;
                }
            }
    }
    r[0]= mod;
    r.reverse();
    return r;
}

function squareRootRoundedDown(dec)
{
    if(dec<2)
        return 0;
    var x = 2;
    var i;
    for(i= 1;true;i++)
    {
        if(x>=dec)
        {
            i = x == dec ? i : i-1;
            break;
        }
        x= x*2;
    }
    return i;
}

function pow(b,exp)
{
    if(exp == 0)
        return 0;
    var i = 1;
    var r= b;
    for(i = 1; i < exp;i++)
        r=r*b;
    return r;
} 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2011-01-07T23:24:44.507

在不久的将来，您将能够使用[ArrayBuffers](https://developer.mozilla.org/en/JavaScript_typed_arrays/ArrayBuffer)和[File API Blobs](http://www.w3.org/TR/FileAPI/)。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2016-11-19T15:26:17.740

正如@Zippy 在评论中指出的那样，最近（2016 年末）的解决方案包括：

*   [数据视图](https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Global_Objects/DataView)（标准）
*   [jDataView](https://github.com/jDataView/jDataView)（DataView 的填充/扩展）
*   [jBinary](https://github.com/jDataView/jBinary)（基于 jDataView 构建）

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-11-29T23:46:35.727

Javascript 不提供以简单字符串以外的任何形式加载对象的机制。

您可以做的最接近的是将对象序列化为字符串，可选择加密/压缩它，将其发送到浏览器，并在必要时解密/解压缩，检查完整性，eval（）和祈祷（）。

除了使用 eval （这不太安全），您可以使用自己的格式（或者，有很多库的 xml 或 json ）并自己解析它。

附带说明一下，如果您希望在浏览器获取可用数据后（在解密/解压缩后）进行混淆，那么规避起来太容易了。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2014-12-18T22:33:08.790

[jBinary](https://github.com/jDataView/jBinary) “使在浏览器和 Node.js 中创建、加载、解析、修改和保存复杂的二进制文件和数据结构变得容易。”

我没有使用它，但这是我在这里问同样的问题时发现的......

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2011-05-17T06:58:57.037

百分比编码可以将字符串转义为任何二进制 blob 的直接 1<->1 表示，并且还可以跨浏览器移植；

```
unescape("%uFFFF%uFFFF%uFFFF"); 
```

大多数浏览器漏洞利用[这种技术](http://en.wikipedia.org/wiki/Shellcode#Percent_encoding)将 shellcode 嵌入 HTML 页面，它非常适用于创建任意二进制流。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2019-10-21T01:10:14.400

欢迎所有在 Google 上找到此旧帖子的人。我想出了一个可以在 2019 年开始在 Chrome 中运行的解决方案，所以希望这只是一些附加功能或大多数人错过的功能。

您可以为您的号码使用`0b`前缀。它不会完全得到二进制表示，但您可以轻松地将其转换为整数进行存储。例如，您可以这样存储二进制数`1010`：

```
var binNum = 0b1010 //Stores as an integer, which would be 10 
```

如果你很好奇，它也适用于带有`0x`前缀的十六进制：

```
var binNum = 0x1010 //Stores as an integer, which would be 4112 
```

# google-app-engine - 如何从 Google 的 appengine 动态生成 pdf？

> ID：327700
> 
> 赞同：31
> 
> 时间：2008-11-29T16:56:57.317
> 
> 标签：google-app-engine, pdf-generation

我想创建一个可以在 Google 的 appengine 上运行的应用程序。

但是，此应用程序需要能够动态生成 PDF。

我怎么能这样做？

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2008-11-29T17:40:17.090

您可以使用该[`reportlab`库](http://www.reportlab.org/rl_toolkit.html)从 Python 生成 PDF。您可以只在应用程序代码中包含 ReportLab 文件，也可以包含 ReportLab 代码的[zip 存档](http://code.google.com/appengine/articles/django10_zipimport.html)，然后将其插入应用程序的`sys.path`.

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-04-25T18:35:55.287

为了克服 google appengine 中的文件数限制，您可以将您的 reportlib 打包成一个 zip 文件并使用它。请务必查看我遇到的这个问题..

[http://code.google.com/p/googleappengine/issues/detail?id=1085](http://code.google.com/p/googleappengine/issues/detail?id=1085)

此外，您可以使用 pisa、htmllib 和 pyPdf 使用 html 模板生成 pdf。

祝一切顺利。

瓦伦

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2010-12-21T10:13:08.423

我会推荐**PyFPDF**，它是轻量级但功能强大的 PHP FPDF 库的纯 Python 端口。它几乎没有几十千字节。

请参阅[http://code.google.com/p/pyfpdf/](http://code.google.com/p/pyfpdf/)

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2011-12-19T02:49:14.583

谷歌有一个新的“[转换 API](http://code.google.com/appengine/docs/java/conversion/) ”可以解决你所有的问题。以下是该网站的描述：

> App Engine Conversion API 使用 Google 的基础架构在常见文件类型之间转换文档，以提高效率和规模。该 API 支持 HTML、PDF、文本和图像格式之间的同步或异步转换，并可选择执行光学字符识别 (OCR)。

# model-view-controller - 用于 MVC Web 应用程序的常见设计模式

> ID：327701
> 
> 赞同：16
> 
> 时间：2008-11-29T16:58:56.317
> 
> 标签：model-view-controller, design-patterns

我正在尝试指导一些人构建 Web 应用程序。他们了解并使用 MVC，但我对您在构建 Web 应用程序时使用的其他常见模式感兴趣。

那么，您发现哪些模式可以很好地融入到正确的 MVC 应用程序中。也许是异步进程、计划任务、处理电子邮件等。你希望你知道要寻找或避免什么？

这个问题并不重要，但我们的大多数应用程序都使用 ASP.NET 和 Rails。

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2008-11-29T17:42:58.503

一旦您进入 MVC，探索“Gang of Four”书之外的模式并进入 Martin Fowler 的“[企业应用程序架构模式](http://martinfowler.com/eaaCatalog/index.html)”是值得的。

[注册表](http://martinfowler.com/eaaCatalog/registry.html)模式可用于使众所周知的对象在整个对象层次结构中可用。本质上是使用全局数据的替代品。

许多 MVC 框架还使用[前端控制器](http://martinfowler.com/eaaCatalog/frontController.html)和[两步视图](http://martinfowler.com/eaaCatalog/twoStepView.html)模式。

MVC 中的“模型”最好设计为[领域模型](http://martinfowler.com/eaaCatalog/domainModel.html)模式，尽管一些框架（由 Rails 领导）将模型与[ActiveRecord模式](http://martinfowler.com/eaaCatalog/activeRecord.html)[混为一谈](http://wiki.rubyonrails.org/rails/pages/Models)。我经常[建议](http://karwin.blogspot.com/2008/05/activerecord-does-not-suck.html)Model 和 ActiveRecord 之间的关系应该是 HAS-A，而不是 IS-A。

还可以在 Portland Pattern Repository wiki 上阅读有关[ModelViewController的信息。](http://c2.com/cgi/wiki?ModelViewController)关于 MVC、面向对象和其他补充 MVC 的模式（例如[Observer](http://c2.com/cgi/wiki?ObserverPattern) ），有一些很好的讨论。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-29T17:26:39.083

这个问题太开放了，很难给出正确的答案。我可以告诉你，**观察者**模式在 MVC（和 Web 应用程序）中很重要，这将是一个很好的答案。关于所有存在的设计模式在大型 Web 应用程序中都很常见。您将需要使用一些**Factory**来构建复杂对象并访问某些部分需要一些**Facade**。

如果你想要更多的“技巧”或*好的实践*而不是*设计模式*，我建议你使用**[IoC](http://en.wikipedia.org/wiki/Dependency_injection)**和使用好的**[框架](http://en.wikipedia.org/wiki/Model-view-controller#Implementations_of_MVC_as_web-based_frameworks)**而不是从头开始。我可以建议你解释一下拥有一个好的**[ORM](http://en.wikipedia.org/wiki/Object-relational_mapping)**引擎的好处，以更快地推动你的持久层（通常也可以来自框架）。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-29T17:27:41.157

不要从与您的开发方法一起使用哪些模式的角度来看待它，而应更多地从如何逐个问题地应用模式来看待它。为项目做出的架构决策提供了与其他人的经验所决定的使用什么模式一样多的指示。

也就是说，我发现我是 Provider 模型的粉丝，因为它可以通过多种选择来完成单个任务，并且添加了易于部署的功能。此外，工作单元模式非常适合设置事务边界。但是，在很大程度上，架构和业务需求决定了任何给定代码更改或新开发所采用的方法。

尽管我很喜欢模式，但我总是害怕看到它们被过度使用。我亲眼看到有人为了使用它们而使用它们，这实际上使代码更难维护，并且比应有的更紧密耦合。此外，最好了解模式论点的双方。一个好的模式知识也应该用（通常被认为是一种模式，就其本身而言）[反模式](http://en.wikipedia.org/wiki/Anti-pattern) 知识来完善。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-29T17:14:55.300

我很可能也会推荐某种依赖注入（控制反转）。可能是要使用的最重要的补充“模式”。

# ajax - AJAX 和表单？

> ID：327717
> 
> 赞同：0
> 
> 时间：2008-11-29T17:18:02.550
> 
> 标签：ajax, forms

我有一些使用 AJAX 与服务器通信的真正原因：级联组合、建议、多个相关选择（例如，我有 {French} [add] 的 {elementary} 知识和 {German} [add] 的 {good} 知识...）。我也有一些常规字段，我通过 get 处理。

问题是，一旦我连接到服务器端，以这种方式推送所有数据对我来说会更容易。是不是走得太远了？如果我一开始就没有使用 AJAX 的理由，我仍然使用它来推送表单数据怎么办？我觉得有义务为关闭 javascript 的人提供后备，但大多数底层逻辑都是相同的，所以它对我来说并没有太大的开销。这是一种我无论如何都会推送的数据，所以我不会丢失对某些东西有好处的获取参数。

有什么理由不这样做吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-29T17:48:27.340

用户体验是任何软件产品的重要组成部分。如果您可以通过提供更好的交互来改善体验，那么没有理由不这样做。

确保您编写[不显眼](http://icant.co.uk/articles/seven-rules-of-unobtrusive-javascript/)且[可降解](http://particletree.com/features/the-hows-and-whys-of-degradable-ajax/)的 javascript，以便使用屏幕阅读器或禁用 javascript 的浏览器的用户仍然可以完成交互。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-29T17:26:28.147

这种策略的唯一问题是，如果有人决定他们也想要一个非 JavaScript 解决方案，那么你就会陷入更深的麻烦。我认为使用将在网络上获得所需结果的“最不花哨”机制是相当明智的。如果它只是一个表单帖子，那么除非有其他理由，否则请保留它作为表单帖子。

# c - 如何列出物理磁盘？

> ID：327718
> 
> 赞同：85
> 
> 时间：2008-11-29T17:18:12.127
> 
> 标签：c, windows, winapi, hard-drive

如何在 Windows 中列出物理磁盘？为了获得`"\\\\.\PhysicalDrive0"`可用的列表。

* * *

## 回答 #1

> 赞同：79
> 
> 时间：2008-11-29T17:24:03.130

#WMIC [wmic](http://www.ss64.com/nt/wmic.html)是一个非常完善的工具

```
wmic diskdrive list 
```

提供（太多）详细列表，例如

了解较少的信息

```
wmic diskdrive list brief 
```

#C [Sebastian Godelet](https://stackoverflow.com/users/281306/sebastian-godelet)[在评论](https://stackoverflow.com/questions/327718/how-to-list-physical-disks/327724#comment18466111_327724)中提到：

> 在 C 中：

```
system("wmic diskdrive list"); 
```

如评论所述，您也可以调用 WinAPI，但是...如“[如何使用 C 应用程序从 WMI 获取数据？](https://stackoverflow.com/a/1431517/6309) ”中所示，这非常复杂（通常使用 C++，而不是 C 完成）。

* * *

#PowerShell 或使用 PowerShell：

```
Get-WmiObject Win32_DiskDrive 
```

* * *

2022 年 2 月更新，微软在“[我们不再开发的 Windows 10 功能](https://docs.microsoft.com/en-us/windows/deployment/planning/windows-10-deprecated-features)”中宣布

> WMIC 工具在 Windows 10 版本 21H1 和 Windows Server 的 21H1 通用可用性通道版本中已弃用。
> 
> **[此工具已被用于 WMI 的 Windows PowerShell](https://docs.microsoft.com/en-us/powershell/scripting/learn/ps101/07-working-with-wmi)**取代。
> 
> 注意：此弃用仅适用于[命令行管理工具](https://docs.microsoft.com/en-us/windows/win32/wmisdk/wmic)。WMI 本身不受影响。

* * *

## 回答 #2

> 赞同：52
> 
> 时间：2012-07-27T08:09:49.473

一种方法：

1.  使用枚举逻辑驱动器[`GetLogicalDrives`](http://msdn.microsoft.com/en-us/library/aa364972%28VS.85%29.aspx)

2.  对于每个逻辑驱动器，打开一个名为`"\\.\X:"`（不带引号）的文件，其中 X 是逻辑驱动器号。

3.  调用[`DeviceIoControl`](http://msdn.microsoft.com/en-us/library/windows/desktop/aa363216%28v=vs.85%29.aspx)将句柄传递给上一步中打开的文件，并将`dwIoControlCode`参数设置为[`IOCTL_VOLUME_GET_VOLUME_DISK_EXTENTS`](http://msdn.microsoft.com/en-us/library/windows/desktop/aa365194%28v=vs.85%29.aspx)：

    ```
    HANDLE hHandle;
    VOLUME_DISK_EXTENTS diskExtents;
    DWORD dwSize;
    [...]

    iRes = DeviceIoControl(
        hHandle,
        IOCTL_VOLUME_GET_VOLUME_DISK_EXTENTS,
        NULL,
        0,
        (LPVOID) &diskExtents,
        (DWORD) sizeof(diskExtents),
        (LPDWORD) &dwSize,
        NULL); 
    ```

这会将逻辑卷的物理位置信息作为[`VOLUME_DISK_EXTENTS`](http://msdn.microsoft.com/en-us/library/windows/desktop/aa365727%28v=vs.85%29.aspx)结构返回。

在卷驻留在单个物理驱动器上的简单情况下，物理驱动器号可在`diskExtents.Extents[0].DiskNumber`

* * *

## 回答 #3

> 赞同：36
> 
> 时间：2013-08-12T09:02:24.817

这可能为时已晚 5 年 :)。但是由于我还没有看到这个答案，所以添加了这个。

我们可以使用[Setup API](http://msdn.microsoft.com/en-us/library/windows/hardware/ff551069(v=vs.85).aspx)来获取磁盘列表，即系统中实现[`GUID_DEVINTERFACE_DISK`](http://msdn.microsoft.com/en-us/library/windows/hardware/ff545824(v=vs.85).aspx).

一旦我们有了他们的设备路径，我们就可以发出来[`IOCTL_STORAGE_GET_DEVICE_NUMBER`](http://msdn.microsoft.com/en-us/library/windows/hardware/ff560551(v=vs.85).aspx)构建`"\\.\PHYSICALDRIVE%d"``STORAGE_DEVICE_NUMBER.DeviceNumber`

另见[`SetupDiGetClassDevs`功能](http://msdn.microsoft.com/en-us/library/windows/hardware/ff551069%28v=vs.85%29.aspx)

```
#include <Windows.h>
#include <Setupapi.h>
#include <Ntddstor.h>

#pragma comment( lib, "setupapi.lib" )

#include <iostream>
#include <string>
using namespace std;

#define START_ERROR_CHK()           \
    DWORD error = ERROR_SUCCESS;    \
    DWORD failedLine;               \
    string failedApi;

#define CHK( expr, api )            \
    if ( !( expr ) ) {              \
        error = GetLastError( );    \
        failedLine = __LINE__;      \
        failedApi = ( api );        \
        goto Error_Exit;            \
    }

#define END_ERROR_CHK()             \
    error = ERROR_SUCCESS;          \
    Error_Exit:                     \
    if ( ERROR_SUCCESS != error ) { \
        cout << failedApi << " failed at " << failedLine << " : Error Code - " << error << endl;    \
    }

int main( int argc, char **argv ) {

    HDEVINFO diskClassDevices;
    GUID diskClassDeviceInterfaceGuid = GUID_DEVINTERFACE_DISK;
    SP_DEVICE_INTERFACE_DATA deviceInterfaceData;
    PSP_DEVICE_INTERFACE_DETAIL_DATA deviceInterfaceDetailData;
    DWORD requiredSize;
    DWORD deviceIndex;

    HANDLE disk = INVALID_HANDLE_VALUE;
    STORAGE_DEVICE_NUMBER diskNumber;
    DWORD bytesReturned;

    START_ERROR_CHK();

    //
    // Get the handle to the device information set for installed
    // disk class devices. Returns only devices that are currently
    // present in the system and have an enabled disk device
    // interface.
    //
    diskClassDevices = SetupDiGetClassDevs( &diskClassDeviceInterfaceGuid,
                                            NULL,
                                            NULL,
                                            DIGCF_PRESENT |
                                            DIGCF_DEVICEINTERFACE );
    CHK( INVALID_HANDLE_VALUE != diskClassDevices,
         "SetupDiGetClassDevs" );

    ZeroMemory( &deviceInterfaceData, sizeof( SP_DEVICE_INTERFACE_DATA ) );
    deviceInterfaceData.cbSize = sizeof( SP_DEVICE_INTERFACE_DATA );
    deviceIndex = 0;

    while ( SetupDiEnumDeviceInterfaces( diskClassDevices,
                                         NULL,
                                         &diskClassDeviceInterfaceGuid,
                                         deviceIndex,
                                         &deviceInterfaceData ) ) {

        ++deviceIndex;

        SetupDiGetDeviceInterfaceDetail( diskClassDevices,
                                         &deviceInterfaceData,
                                         NULL,
                                         0,
                                         &requiredSize,
                                         NULL );
        CHK( ERROR_INSUFFICIENT_BUFFER == GetLastError( ),
             "SetupDiGetDeviceInterfaceDetail - 1" );

        deviceInterfaceDetailData = ( PSP_DEVICE_INTERFACE_DETAIL_DATA ) malloc( requiredSize );
        CHK( NULL != deviceInterfaceDetailData,
             "malloc" );

        ZeroMemory( deviceInterfaceDetailData, requiredSize );
        deviceInterfaceDetailData->cbSize = sizeof( SP_DEVICE_INTERFACE_DETAIL_DATA );

        CHK( SetupDiGetDeviceInterfaceDetail( diskClassDevices,
                                              &deviceInterfaceData,
                                              deviceInterfaceDetailData,
                                              requiredSize,
                                              NULL,
                                              NULL ),
             "SetupDiGetDeviceInterfaceDetail - 2" );

        disk = CreateFile( deviceInterfaceDetailData->DevicePath,
                           GENERIC_READ,
                           FILE_SHARE_READ | FILE_SHARE_WRITE,
                           NULL,
                           OPEN_EXISTING,
                           FILE_ATTRIBUTE_NORMAL,
                           NULL );
        CHK( INVALID_HANDLE_VALUE != disk,
             "CreateFile" );

        CHK( DeviceIoControl( disk,
                              IOCTL_STORAGE_GET_DEVICE_NUMBER,
                              NULL,
                              0,
                              &diskNumber,
                              sizeof( STORAGE_DEVICE_NUMBER ),
                              &bytesReturned,
                              NULL ),
             "IOCTL_STORAGE_GET_DEVICE_NUMBER" );

        CloseHandle( disk );
        disk = INVALID_HANDLE_VALUE;

        cout << deviceInterfaceDetailData->DevicePath << endl;
        cout << "\\\\?\\PhysicalDrive" << diskNumber.DeviceNumber << endl;
        cout << endl;
    }
    CHK( ERROR_NO_MORE_ITEMS == GetLastError( ),
         "SetupDiEnumDeviceInterfaces" );

    END_ERROR_CHK();

Exit:

    if ( INVALID_HANDLE_VALUE != diskClassDevices ) {
        SetupDiDestroyDeviceInfoList( diskClassDevices );
    }

    if ( INVALID_HANDLE_VALUE != disk ) {
        CloseHandle( disk );
    }

    return error;
} 
```

* * *

## 回答 #4

> 赞同：25
> 
> 时间：2016-05-20T12:34:54.863

答案远比上述所有答案简单。物理驱动器列表实际上存储在注册表项中，该注册表项还提供了设备映射。

HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\disk\Enum

**Count**是 PhysicalDrive# 的编号，每个编号的 Registry Value 是对应的物理驱动器。

例如，注册表值“0”是 PhysicalDrive0。该值是 PhysicalDrive0 映射到的实际设备。此处包含的值可以传递到参数[pDeviceID中的](https://msdn.microsoft.com/en-us/library/windows/hardware/ff538742(v=vs.85).aspx)**CM_Locate_DevNode**以使用即插即用服务。这将允许您在设备上收集大量信息。例如设备管理器中的属性，如“友好显示名称”，如果您需要驱动器名称、序列号等。

不需要可能不在系统或其他黑客上运行的 WMI 服务，并且此功能至少自 2000 年以来就已存在于 Windows 中，并且在 Windows 10 中仍然如此。

* * *

## 回答 #5

> 赞同：13
> 
> 时间：2008-12-08T17:55:21.687

我修改了一个名为“dskwipe”的开源程序，以便从中提取磁盘信息。Dskwipe 是用 C 语言编写的，您可以从中提取此功能。二进制文件和源代码可在此处获得：[dskwipe 0.3 已发布](http://smithii.com/dskwipe)

返回的信息将如下所示：

```
Device Name                         Size Type      Partition Type
------------------------------ --------- --------- --------------------
\\.\PhysicalDrive0               40.0 GB Fixed
\\.\PhysicalDrive1               80.0 GB Fixed
\Device\Harddisk0\Partition0     40.0 GB Fixed
\Device\Harddisk0\Partition1     40.0 GB Fixed     NTFS
\Device\Harddisk1\Partition0     80.0 GB Fixed
\Device\Harddisk1\Partition1     80.0 GB Fixed     NTFS
\\.\C:                           80.0 GB Fixed     NTFS
\\.\D:                            2.1 GB Fixed     FAT32
\\.\E:                           40.0 GB Fixed     NTFS 
```

* * *

## 回答 #6

> 赞同：12
> 
> 时间：2015-02-16T21:33:41.590

唯一正确的答案是@Grodriguez 的答案，这是他懒得写的代码：

```
#include <windows.h>
#include <iostream>
#include <bitset>
#include <vector>
using namespace std;

typedef struct _DISK_EXTENT {
    DWORD         DiskNumber;
    LARGE_INTEGER StartingOffset;
    LARGE_INTEGER ExtentLength;
} DISK_EXTENT, *PDISK_EXTENT;

typedef struct _VOLUME_DISK_EXTENTS {
    DWORD       NumberOfDiskExtents;
    DISK_EXTENT Extents[ANYSIZE_ARRAY];
} VOLUME_DISK_EXTENTS, *PVOLUME_DISK_EXTENTS;

#define CTL_CODE(DeviceType, Function, Method, Access) \
    (((DeviceType) << 16) | ((Access) << 14) | ((Function) << 2) | (Method))
#define IOCTL_VOLUME_BASE ((DWORD)'V')
#define METHOD_BUFFERED 0
#define FILE_ANY_ACCESS 0x00000000
#define IOCTL_VOLUME_GET_VOLUME_DISK_EXTENTS CTL_CODE(IOCTL_VOLUME_BASE, 0, METHOD_BUFFERED, FILE_ANY_ACCESS)

int main() {
    bitset<32> drives(GetLogicalDrives());
    vector<char> goodDrives;
    for (char c = 'A'; c <= 'Z'; ++c) {
        if (drives[c - 'A']) {
            if (GetDriveType((c + string(":\\")).c_str()) == DRIVE_FIXED) {
                goodDrives.push_back(c);
            }
        }
    }
    for (auto & drive : goodDrives) {
        string s = string("\\\\.\\") + drive + ":";
        HANDLE h = CreateFileA(
            s.c_str(), GENERIC_READ, FILE_SHARE_READ | FILE_SHARE_WRITE, NULL,
            OPEN_EXISTING, FILE_FLAG_NO_BUFFERING | FILE_FLAG_RANDOM_ACCESS, NULL
        );
        if (h == INVALID_HANDLE_VALUE) {
            cerr << "Drive " << drive << ":\\ cannot be opened";
            continue;
        }
        DWORD bytesReturned;
        VOLUME_DISK_EXTENTS vde;
        if (!DeviceIoControl(
            h, IOCTL_VOLUME_GET_VOLUME_DISK_EXTENTS,
            NULL, 0, &vde, sizeof(vde), &bytesReturned, NULL
        )) {
            cerr << "Drive " << drive << ":\\ cannot be mapped into physical drive";
            continue;
        }
        cout << "Drive " << drive << ":\\ is on the following physical drives: ";
        for (int i = 0; i < vde.NumberOfDiskExtents; ++i) {
            cout << vde.Extents[i].DiskNumber << ' ';
        }
        cout << endl;
    }
} 
```

我认为安装 Windows 驱动程序开发工具包是一个相当漫长的过程，所以我已经包含了需要`DeviceIoControl`用于此任务的声明。

* * *

## 回答 #7

> 赞同：11
> 
> 时间：2008-11-29T18:11:28.337

GetLogicalDrives() 枚举所有已安装的磁盘分区，***而不是***物理驱动器。

您可以使用（或不使用）GetLogicalDrives 枚举驱动器号，然后调用 QueryDosDevice() 以找出该字母映射到的物理驱动器。

或者，您可以解码注册表中 HKEY_LOCAL_MACHINE\SYSTEM\MountedDevices 中的信息。然而，那里的二进制数据编码并不明显。如果你有 Russinovich 和 Solomon 的书 Microsoft Windows Internals 的副本，这个注册表配置单元将在第 10 章中讨论。

* * *

## 回答 #8

> 赞同：10
> 
> 时间：2012-04-19T12:26:38.143

The only sure shot way to do this is to call `CreateFile()` on all `\\.\Physicaldiskx` where x is from 0 to 15 (16 is maximum number of disks allowed). Check the returned handle value. If invalid check `GetLastError()` for **ERROR_FILE_NOT_FOUND**. If it returns anything else then the disk exists but you cannot access it for some reason.

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2013-06-20T21:51:13.063

Thic WMIC 命令组合工作正常：

```
wmic volume list brief 
```

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2020-12-04T23:59:32.787

如果您只需要查看现有磁盘，这个就足够了：

```
powershell "get-physicaldisk" 
```

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2014-01-01T09:47:46.313

可能想要包括旧的 A: 和 B: 驱动器，因为你永远不知道谁可能在使用它们！我厌倦了 USB 驱动器碰撞我的两个仅用于 Readyboost 的 SDHC 驱动器。我一直将它们分配给高字母 Z: Y: 使用一个实用程序，它可以根据需要为设备分配驱动器号。我想知道.... 我可以制作一个 Readyboost 驱动器号 A: 吗？是的！我可以将我的第二个 SDHC 驱动器号设置为 B: 吗？是的！

我以前使用过软盘驱动器，从没想过 A: 或 B: 会在 Readyboost 中派上用场。

我的意思是，不要假设 A: & B: 不会被任何人用于任何事情您甚至可能会发现正在使用旧的 SUBST 命令！

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2018-02-12T09:25:59.427

**[这](https://stackoverflow.com/questions/24049367/how-do-i-get-the-disk-drive-serial-number-in-c-c/48741695#48741695)**是一个通过 WMI 调用来实现它**的新解决方案。**
然后你需要做的就是打电话：

```
queryAndPrintResult(L"SELECT * FROM Win32_DiskDrive", L"Name"); 
```

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2008-12-10T16:31:40.670

我今天刚刚在我的 RSS 阅读器中遇到了这个问题。我有一个更清洁的解决方案给你。这个例子是在 Delphi 中，但可以很容易地转换为 C/C++（都是 Win32）。

从以下注册表位置查询所有值名称： **HKLM\SYSTEM\MountedDevices**

将它们一一传递给以下函数，您将返回设备名称。相当干净和简单！[我在这里的博客上找到了这段代码。](http://www.remkoweijnen.nl/blog/2008/12/10/converting-a-volume-name-to-a-device-name/)

```
function VolumeNameToDeviceName(const VolName: String): String;
var
  s: String;
  TargetPath: Array[0..MAX_PATH] of WideChar;
  bSucceeded: Boolean;
begin
  Result := ”;
  // VolumeName has a format like this: \\?\Volume{c4ee0265-bada-11dd-9cd5-806e6f6e6963}\
  // We need to strip this to Volume{c4ee0265-bada-11dd-9cd5-806e6f6e6963}
  s :=  Copy(VolName, 5, Length(VolName) - 5);

  bSucceeded := QueryDosDeviceW(PWideChar(WideString(s)), TargetPath, MAX_PATH) <> 0;
  if bSucceeded then
  begin
    Result := TargetPath;
  end
  else begin
    // raise exception
  end;

end; 
```

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2015-04-27T18:43:42.880

如果您想要“物理”访问，我们正在开发此 API，最终将允许您与存储设备进行通信。它是开源的，您可以查看当前代码以获取一些信息。查看更多功能： [https ://github.com/virtium/vtStor](https://github.com/virtium/vtStor)

* * *

## 回答 #15

> 赞同：-3
> 
> 时间：2012-02-18T08:12:34.000

列出美国英语字母表中的所有字母，跳过 a 和 b。“CDEFGHIJKLMNOPQRSTUVWXYZ”。`CreateFile`用例如打开每个驱动器`CreateFile("\\.\C:")`。如果它没有返回`INVALID_HANDLE_VALUE`，那么你有一个“好”的驱动器。接下来拿起那个句柄并运行它`DeviceIoControl`以获得磁盘#。**[有关详细信息，请参阅我的相关答案](https://stackoverflow.com/a/9312075/504239)**。

# visual-studio-2008 - NAnt 和 VS2008 (.NET 3.5) - 不支持文件 Solution.sln 的解决方案格式

> ID：327722
> 
> 赞同：9
> 
> 时间：2008-11-29T17:22:14.287
> 
> 标签：visual-studio-2008, .net-3.5, nant

我试图让 NAnt 0.86b1 与 VS2008 SP1 和 x64 XP 一起运行。

我有一个基本的构建文件（如下），它给出了文件“Solution.sln”的错误解决方案格式不受支持。

```
<property name="nant.settings.currentframework" value="net-3.5" />

<target name="build" description="Full Rebuild" depends="clean,compile" />  

<target name="clean" description="Cleans outputs">
    <delete dir="bin" failonerror="false" />
    <delete dir="obj" failonerror="false" />
</target>

<target name="compile" description="Compiles solution">
    <solution configuration="debug" solutionfile="Solution.sln" />
</target> 
```

有没有其他人遇到过这个问题？我找不到任何有用的东西。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-29T17:31:09.590

您会注意到文档表明 NAnt 的[`<solution`>](http://nant.sourceforge.net/release/0.85/help/tasks/solution.html)任务不支持比 VS2003 更新的解决方案文件。

我建议将[nantcontrib](http://nantcontrib.sourceforge.net/release/0.85/help/tasks/msbuild.html)[的`<msbuild>`](http://nantcontrib.sourceforge.net/release/0.85/help/tasks/msbuild.html)任务用于比 VS2003 更新的所有项目。

此外，.85 版本的 NAnt 仅支持最高 2.0 的框架版本。让事情对 3.5 框架起作用的最纯粹的方法是使用[.86-beta1](http://nant.sourceforge.net)版本的 NAnt。然后，您将能够`<msbuild>`针对 3.5 解决方案使用该任务。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-01-08T23:20:57.710

nant-0.86-beta1 支持 3.5 但不是在解决方案节点上有多好。我最终从 nantcontrib 使用了这个：

```
 <target name="build" description="Compiles using the AutomatedDebug Configuration">
    <!-- <loadtasks assembly="C:\Dev\nant-0.86-beta1\bin\NAnt.Contrib.Tasks.dll"  /> -->
    <msbuild project="${Solution.Filename}">
      <property name="Configuration" value="Release"/>
    </msbuild>
  </target> 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-12T22:10:20.293

请参阅[使用 nant 和 VS2008 构建平台代码](https://stackoverflow.com/questions/426199/building-the-platform-code-with-nant-and-vs2008/543648#543648)

这是堆栈溢出。基本上你只有几个选项，用项目构建文件、通用构建文件和主构建文件自己控制所有构建。或者运行 Exec 任务，为要编译的每个解决方案执行正确版本的 MSBuild。

# google-app-engine - 有效跨越实体关系的 GQL 查询

> ID：327727
> 
> 赞同：0
> 
> 时间：2008-11-29T17:25:02.003
> 
> 标签：google-app-engine, gql

我的情况是，我需要[在 Django 数据库模型](http://docs.djangoproject.com/en/dev/topics/db/queries/#lookups-that-span-relationships)中的查询中跨越 Google App Engine 实体关系。我将`ListProperty`s 用于一对多关系，如下所示：

```
class Foo(db.Model): bars = db.ListProperty(db.Key)
class Bar(db.Model): eggs = db.ListProperty(db.Key) 
```

我想执行一个执行以下操作的查询：

```
# Foo.filter('bars.eggs =', target_egg)
[foo
for egg in eggs if egg == target_egg
for eggs in bar.eggs
for bar in foo.bars
for foo in Foo.all()] 
```

这种理解似乎效率极低。我真的很想像注释掉的部分那样执行查询，但看起来[GQL 语法](http://code.google.com/appengine/docs/datastore/gqlreference.html)不允许针对属性的属性进行查询：

```
 SELECT * FROM <kind>
    [WHERE <condition> [AND <condition> ...]]
    [ORDER BY <property> [ASC | DESC] [, <property> [ASC | DESC] ...]]
    [LIMIT [<offset>,]<count>]
    [OFFSET <offset>]

  <condition> := <property> {< | <= | > | >= | = | != } <value>
  <condition> := <property> IN <list>
  <condition> := ANCESTOR IS <entity or key> 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-29T17:56:24.750

你是对的，App Engine 数据存储不允许这种查询。你说得对，列表理解效率低下。但是，请考虑一下，当您使用像您的连接一样执行查询时，这几乎正是关系数据库所做的 - 数据库必须执行与您在这里所做的相同的 O(n^3) 工作 - 唯一的区别是你是用 Python 做的，而且还有额外的往返时间。由于 App Engine 是为扩展而设计的，因此它并不是真正为这类查询而设计的。

但是，通常有一种方法可以使您的模型去规范化以促进这一点，方法是将您需要访问的一些属性移到 Foo 模型上，或者如果您正在进行聚合，则将总数移到 Foo 模型上。但是，如果不进一步了解您要解决的问题，就很难给出具体的解决方案。

# jakarta-ee - 按某个类别自动过滤的查询系统（电子邮件到数据库）的最佳设计是什么？

> ID：327732
> 
> 赞同：2
> 
> 时间：2008-11-29T17:26:43.950
> 
> 标签：jakarta-ee

我们正在开发一个使用 J2EE 的查询管理系统。我们正在研究一项功能，允许用户向特定邮件 ID 发送查询并输入数据库。Catch 是自动将其分配给某些类别。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-29T17:31:07.780

要求用户使用在线表格进行查询。要求他们在接受询问之前选择一个类别。然后，您可以选择通过电子邮件发送、保存到数据库或两者兼而有之。通过电子邮件发送时，您可以使用某种标识符标记将类别附加到主题行，例如 [cat=TECHSUPPORT]。这将允许通过电子邮件客户端过滤消息。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-29T23:44:42.847

对于处理外部电子邮件，我会考虑使用贝叶斯过滤器对它们进行分类。这就是许多最成功的垃圾邮件过滤器的工作原理，并且该技术可以适用于对垃圾邮件以外的内容进行分类。我没用过，但试试[NClassifier](http://nclassifier.sourceforge.net/Usage.html)。如果这不起作用，请搜索贝叶斯过滤器并查看出现了什么。

# sql - 我们可以在 MySQL 中将表名作为“选项”吗？

> ID：327745
> 
> 赞同：10
> 
> 时间：2008-11-29T17:38:35.177
> 
> 标签：sql, mysql, database

**我对 MYSQL 非常非常陌生。我试图创建一个名为“option”的表。** **我的 SQL 查询是：**

创建表选项（

id int not null 主键 auto_increment，

选择 varchar(30)

)

**执行此查询时，它显示以下错误**

错误代码：1064 您的 SQL 语法有错误；检查与您的 MySQL 服务器版本相对应的手册，以在第 1 行的“option(id int not null primary key auto_increment,choice varchar(30))”附近使用正确的语法（0 ms）

**如果我尝试使用表名作为“选择”它正在工作。**

**我们可以在mysql中将表名作为“选项”吗？**

谢谢

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-11-29T17:45:07.283

如果你想有一个表名选项，你应该可以，只要记住，每当你在查询中使用表时，你都必须用`符号将它包起来。像这样。

```
`option` 
```

键盘左上角的 ` 键，带有波浪号。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-11-29T17:49:28.070

选择一个不同的名称（一个不是您的 RDBMS 中的保留字的名称）并为您自己和其他可能使用它的人省去很多麻烦。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-11-30T03:35:45.047

option是Mysql中的保留字。我们可以通过在单引号内使用单词来使用保留字。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-12-14T02:22:23.210

最好选择另一个表名。否则维护我们的代码会很困难。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-11-29T17:45:31.120

如果使用反引号对 SQL 关键字进行转义，则可以将 SQL 关键字用作 MySQL 中的表名。

```
 CREATE TABLE `option` (
     ...
 ) 
```

不过，这样做通常不是一个好主意。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-29T17:47:44.767

**option**是 MySQL 中的[保留字](http://dev.mysql.com/doc/mysqld-version-reference/en/mysqld-version-reference-reservedwords-5-0.html)。为自己节省一个痛苦的世界，并为您的表名使用**选择**。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-29T17:47:52.193

请参阅[MySQL 文档](http://dev.mysql.com/doc/refman/5.0/en/identifiers.html)。你可以这样做：

```
create table `option` (
...
) 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2015-10-25T13:27:19.963

是的，您绝对可以创建一个名为 option 的表，但在每个查询中您都必须使用

```
`option` 
```

而不是平原`option`。最好即兴发挥一点，并创建一个名为 options 的表来避免麻烦。禁止使用 mysql 保留字作为表名或列名或过程名。

# language-agnostic - 特殊情况如何处理

> ID：327751
> 
> 赞同：1
> 
> 时间：2008-11-29T17:45:02.277
> 
> 标签：language-agnostic

这是经常发生的情况，但这里是最新的例子：

公司在制作招聘广告时有各种联系数据（地址、电话号码、电子邮件......），他们有复选框来选择他们想要联系的方式。它基本上是描述性数据。用户在阅读广告时会看到类似“您可以通过邮件亲自申请...”之类的内容，*除非*它是“通过 Web 门户”或“通过电子邮件”，因为此时应该会出现相应的按钮。这些选项存储在数据库中，客户（网站所有者，而不是制作广告的公司）可以更改它们（例如，他们可以添加“通过心灵感应”或其他方式），但如果他们篡改了“电子邮件”和“网络” -portal”选项，他们搞砸了他们的网站。

那么我应该如何处理所有行为方式相同的数据，除了以这种方式运行的“这个东西”和以其他方式运行的“那个东西”，并且数据本身是实时的，应该由客户端编辑。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-29T17:56:36.357

您已将您的问题标记为“与语言无关”，并且并非所有语言都完全支持多态性，但这就是我处理这个问题的方式。

每个选项都有一些类型，不同的类型需要设置不同的属性。但是，每种类型都支持某种“渲染”方法，可以根据需要显示联系人方法。由于属性（电话号码或网址等）是特定于类型的，因此您可以在创建这些“对象”时验证管理员的输入，以确保提供了必要的数据并且有效。由于您实现了 render 方法，而不是吐出用户提供的 HTML，因此您可以确保呈现的页面是正确的。它不太灵活，但更安全，更用户友好。

在数据库中，您可以拥有一个包含所有类型联系人数据的稀疏填充表，或者一个具有公共属性的“父”表和具有特定类型属性的子表。这取决于您有多少类型以及它们有多大不同。在任何一种情况下，您都会有某种类型的指示符，以便您知道数据应该绑定到的对象的类型。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-29T18:06:00.020

首先，三思而后行，你真的需要它。原因很简单。您应该满足特定需求，输入数据是提供该服务的一种手段。如果数据不适合现有服务，那么它的价值是什么？谁是该特定信息的消费者？

有两个可能的答案：您正在扩大您的客户群，或者由于需求变化而需要更改现有服务。在这两种情况下，您都需要从商业模式的发展中脱颖而出。如果您描述您需要什么服务以及它应该提供什么信息，您将避免大量特定数据，并带有易于在软件中实现的明确要求。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-09T19:04:26.837

基于对数据库的提及，我建议为此使用[解决模式。](http://database-programmer.blogspot.com/2008/04/advanced-table-design-resolutions.html)上面的链接描述了它，但它实际上比听起来要简单得多。您编写一个返回所有可能选项的数据库查询（例如，根据您的架构，您可能使用 UNION 或 JOIN 一起读取标准选项和自定义选项） - 然后 COALESCE SQL 关键字可用于查找第一个 '非 NULL 的选项值的分辨率。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-29T18:20:33.610

好吧，如果只是您有两个特殊的选项，然后以相同的方式处理其他任何事情，那么将您的选项存储为字符串，如果两个特殊选项中的任何一个出现在该列表中，则显示该特殊项目的适当材料。

只需检查您的物品清单中的两个特殊物品即可。没有什么花哨。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-30T16:35:27.173

通过编写一个非常简单的[规则引擎](https://stackoverflow.com/questions/93147/how-to-design-a-rule-engine)。您可以使用开箱即用的实现，也可以推出自己的实现。由于您的案例看起来很简单，我倾向于自己动手，因为这意味着更少的依赖关系（YMMV）。

# java - Java PreparedStatements 中的通配符

> ID：327765
> 
> 赞同：9
> 
> 时间：2008-11-29T17:52:06.177
> 
> 标签：java, mysql, jdbc, prepared-statement

这是我当前的 SQL 语句：

```
SEARCH_ALBUMS_SQL = "SELECT * FROM albums WHERE title LIKE ? OR artist LIKE ?;"; 
```

它会返回与专辑或艺术家姓名完全匹配的内容，但不会返回任何其他内容。我不能在语句中使用“%”，否则会出错。

如何在准备好的语句中添加通配符？

（我正在使用 Java5 和 MySQL）

谢谢！

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-11-29T17:55:52.630

您将 % 放在绑定变量中。所以你也是

```
 stmt.setString(1, "%" + likeSanitize(title) + "%");
   stmt.setString(2, "%" + likeSanitize(artist) + "%"); 
```

您应该添加**ESCAPE '!'** 允许您在输入中转义与**LIKE**相关的特殊字符。

在使用**标题**或**艺术家之前，您应该使用以下方法转义特殊字符（** **!**、**%**、**_**和**[** ）来清理它们（如上所示）：

```
public static String likeSanitize(String input) {
    return input
       .replace("!", "!!")
       .replace("%", "!%")
       .replace("_", "!_")
       .replace("[", "![");
} 
```

# java - 在 Spring 应用程序上下文中直接嵌入 XML 配置

> ID：327772
> 
> 赞同：2
> 
> 时间：2008-11-29T17:58:43.857
> 
> 标签：java, xml, spring, configuration

我有一个 Java 对象，它能够在给定 XML 配置描述的情况下进行自我配置（它也需要其他描述，但我目前对 XML 感兴趣）。我想知道是否可以将 XML 描述直接嵌入到 Spring 应用程序上下文描述中。我在想像：

```
<bean id="myXMLConfiguredBean" class="com.example.Foo">
  <constructor-arg type="xml">
    <myconfig xmlns="http://example.com/foo/config">
      <bar>42</bar>
    </myconfig>
  </constructor-arg>
</bean> 
```

但我不知道这 - 或类似的东西 - 是否可能。我意识到我可以将 myconfig 嵌入到 CDATA 部分中，但这似乎有点难看。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-29T23:35:11.977

Spring 的[XSD](http://www.springframework.org/schema/beans/spring-beans-2.5.xsd)允许`<constructor-arg>`通过以下方式包含任何 XML：

```
<xsd:element name="constructor-arg">
  <xsd:complexType>
    <xsd:sequence>
      <xsd:element ref="description" minOccurs="0" />
        <xsd:choice minOccurs="0" maxOccurs="1">
          <xsd:element ref="bean" />
          <xsd:element ref="ref" />
          <xsd:element ref="idref" />
          <xsd:element ref="value" />
          <xsd:element ref="null" />
          <xsd:element ref="list" />
          <xsd:element ref="set" />
          <xsd:element ref="map" />
          <xsd:element ref="props" />
          <!-- Any XML -->
          <xsd:any namespace="##other" processContents="strict" />
        </xsd:choice>
      </xsd:sequence>
      ...
  </xsd:complexType>
</xsd:element> 
```

属性`processContents`可以具有[三个值之一](http://www.w3.org/TR/xmlschema-1/#Wildcard_details)

> 严格：必须有一个可用项目的顶级声明，或者该项目必须有一个`xsi:type`，并且该项目必须是·有效的（视情况而定）。

所以，只要你的配置 XML 有一个模式，并且你正确地导入它，这应该可以工作。

然后，您需要使用[CustomEditorConfigurer](http://static.springframework.org/spring/docs/2.5.x/api/org/springframework/beans/factory/config/CustomEditorConfigurer.html)为您的 XML注册一个[PropertyEditor](http://java.sun.com/javase/6/docs/api/java/beans/PropertyEditor.htm)

希望这可以帮助

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-01T15:32:27.643

如果您的 bean 有一个属性告诉它配置文件的位置，并且它从类路径（或文件系统上的绝对位置）加载配置，那不是更干净吗？这样一来，您的 Spring 配置看起来更清晰，并且更容易编辑 bean 的 XML 配置，因为它位于单独的文件中。

也许你甚至可以使用 Spring Application Context 的资源特性来做到这一点。

# python - 读取文件的最后一行

> ID：327776
> 
> 赞同：3
> 
> 时间：2008-11-29T18:03:03.393
> 
> 标签：python

想象一下我有一个文件

```
Xpto,50,30,60
Xpto,a,v,c
Xpto,1,9,0
Xpto,30,30,60 
```

该txt文件可以附加很多次，当我打开文件时，我只想获取txt文件最后一行的值......我怎么能在python上做到这一点？读最后一行？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-11-29T18:34:42.440

我认为我[上次提出这个](https://stackoverflow.com/questions/260273/most-efficient-way-to-search-the-last-x-lines-of-a-file-in-python)问题时的回答被遗憾地忽略了。:-)

> 如果你在一个unix盒子上， `os.popen("tail -10 " + filepath).readlines()`可能是最快的方法。否则，这取决于您希望它有多强大。到目前为止提出的方法都会以一种或另一种方式失败。对于最常见情况下的稳健性和速度，您可能需要类似对数搜索：使用 file.seek 转到文件末尾减去 1000 个字符，读入，检查它包含多少行，然后到 EOF 减去 3000 个字符，读入 2000 个字符，计算行数，然后 EOF 减去 7000，读入 4000 个字符，计算行数，等等，直到你有你需要的行数。但是，如果您确定它总是会在具有合理行长的文件上运行，那么您可能不需要它。
> 
> 您可能还会在 unix 命令的[源代码](http://www.koders.com/c/fid8DEE98A42C35A1346FA89C328CC3BF94E25CF377.aspx)中找到一些灵感。`tail`

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-29T20:36:00.370

`f.seek( pos ,2)`寻求相对于文件末尾的“pos”。尝试 pos 的合理值，然后 readlines() 并获取最后一行。

您必须考虑到“pos”何时不是一个好的猜测，即假设您选择 300，但最后一行是 600 个字符长！在这种情况下，只需合理猜测再试一次，直到捕获整条线。（这种最坏的情况应该很少见）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-04-16T19:56:06.953

嗯，为什么不直接寻找文件的末尾并阅读直到你换行？

```
i=0
while(1):
    f.seek(i, 2)
    c = f.read(1)
    if(c=='\n'):
        break 
```

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2008-11-29T18:06:24.823

不确定特定于 python 的实现，但以更与语言无关的方式，您想要做的是跳过（查找）到文件的末尾，然后按倒序读取每个字符，直到到达换行符您的文件正在使用，通常是一个值为 13 的字符。只需从该点向前读取到文件末尾，您将拥有文件中的最后一行。

# database - 使用 shell 脚本的 sqlplus 访问和电子邮件访问

> ID：327777
> 
> 赞同：1
> 
> 时间：2008-11-29T18:04:18.900
> 
> 标签：database, oracle, shell, sqlplus

我在 shell 脚本方面相当初级，以下是详细信息..

我正在寻找触发 sql 查询并基于该数据执行一些逻辑的最佳方法。我使用了以下代码段..

壳变量=`sqlplus $user/$passwd <<END select count(1) from table1; end EOF`

if[$shellvariable -ne 0] then <> fi

有没有更好的方法来执行相同的..

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-30T07:57:18.420

你在正确的轨道上。sqlplus 是在编写 shell 脚本时与数据库交互的最佳方式，但需要注意两点：

1.  使用“-S”参数阻止 sqlplus 打印其所有应用程序信息
2.  要将数据直接读取到变量中，您将需要一些 sqlplus 环境设置来将输出修剪为您想要的

对于任何正在学习 shell 脚本以帮助他们管理和自动化 Oracle 数据库管理的 DBA，我强烈推荐 Jon Emmons 的书[Oracle Shell Scripting](http://pratalife.blogspot.com/2008/11/oracle-shell-scripting.html)。它教授了一个很棒的 shell 脚本介绍课程，但是在对 DBA 真正有用和有趣的任务的上下文中。

最后一点：如果您要做的不仅仅是简单的 DBA 任务，我建议您不要使用 shell 脚本，而是使用具有适当数据库支持的脚本语言。Perl 对于 Oracle 来说是一个不错的选择，因为它是随数据库一起安装的。

[这是一个用 bash 和 perl 完成的 Oracle 脚本示例](http://tardate.blogspot.com/2007/04/find-and-tail-oracle-alert-log.html)。在 shell 版本中，它是如何将特定值读取到 shell 变量的：

```
alertlog=$(sqlplus -S \/ as sysdba 2> /dev/null <<EOF
SET NEWPAGE 0
SET SPACE 0
SET LINESIZE 80
SET PAGESIZE 0
SET ECHO OFF
SET FEEDBACK OFF
SET VERIFY OFF
SET HEADING OFF
SELECT value 
FROM   v\$parameter 
WHERE  name = 'background_dump_dest';
EOF
) 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-08-31T08:11:07.257

[通过 shell 脚本访问数据库](http://scripterworld.blogspot.com/2009/08/connecting-to-oracle-database-from-unix.html)

# mysql - 为我网站上的每个用户分配一个 MySQL 数据库是否不合理？

> ID：327787
> 
> 赞同：10
> 
> 时间：2008-11-29T18:08:06.473
> 
> 标签：mysql, database

我正在创建一个基于用户的网站。对于每个用户，我需要几个 MySQL 表来存储不同类型的信息（即 userInfo、quotesSubmitted 和 ratesSubmitted）。这样做是否更好：

a) 为站点创建一个数据库（即“mySite”），然后在其中创建数百或数千个表（即“userInfo_bob”、“quotessubmitted_bob”、“userInfo_shelly”和“quotesSubmitted_shelly”）

或者

b) 创建数百或数千个数据库（即“Bob”、“Shelly”等），每个数据库仅创建几个表（即“Bob”内部：userInfo、quotesSubmitted、ratesSubmitted 等）

**我应该使用一个数据库和该数据库中的许多表，还是使用多个数据库和每个数据库的几个表？**

* * *

编辑：

问题是我需要跟踪谁对什么进行了评分。这意味着如果用户评价了 300 条报价，我需要能够准确地知道用户评价了哪些报价。

也许我应该这样做？

一张报价表。一张表列出用户。一张表记录所有已做出的评级（即三列：用户、报价、评级）。这似乎是合理的。这有什么问题吗？

* * *

## 回答 #1

> 赞同：41
> 
> 时间：2008-11-29T18:10:21.897

使用一个数据库。

使用一张表来保存用户，一张表来保存报价。

在这两个表之间，您有一个表，其中包含将用户与报价相匹配的信息，该表将保存用户给出的报价的评级。

这种简单的设计将允许您存储几乎无限数量的报价、无限的用户，并且您将能够将每个报价与零个或多个用户匹配，反之亦然。

中间的表将包含用户表和报价表的*外键。*

您可能会发现复习一些数据库设计基础知识很有帮助，stackoverflow 上有很多相关的问题。

从这些开始...

[什么是标准化？](https://stackoverflow.com/questions/246701/what-is-normalisation-or-normalization-why-is-it-important)

[设计数据库时要记住的重要事项](https://stackoverflow.com/questions/141126/what-is-important-to-keep-in-mind-when-designing-a-database)

[“太多”有多少个字段？](https://stackoverflow.com/questions/220613/how-many-fields-is-too-many-in-a-table)

[更多表或更多列？](https://stackoverflow.com/questions/59482/whats-the-better-database-design-more-tables-or-more-columns)

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-11-29T18:13:28.037

> 我应该使用一个数据库和该数据库中的许多表，还是使用多个数据库和每个数据库的几个表？

也不，您应该使用一个数据库，其中包含一个用户表、一个报价表、一个费率表等。

然后，您在（例如）您的报价表中有一个列，其中说明报价是针对哪个用户的。

```
CREATE TABLE user (
    user INT(10) UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY,
    ...
);

CREATE TABLE quote (
    quote INT(10) UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY,
    user INT(10) UNSIGNED NOT NULL,
    ...
);

CREATE TABLE rate (
    rate INT(10) UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY,
    user INT(10) UNSIGNED NOT NULL,
    ...
 ); 
```

`JOIN`然后在语句中使用 SQL`SELECT`将表链接在一起。

编辑 - 上面假设用户和费率之间存在多对一关系 - 其中存在“多对多”关系，您需要为每种数据创建一个表，然后为每个用户创建另一个包含行的表 <- > 速率对。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-11-29T18:12:55.980

许多数据库的两个问题（实际上更多，但从这些开始。）

1.  您不能将参数用于数据库名称。

2.  当您对表格进行第一次更改时，您会做什么？（提示：工作 X (# databases)）。

“许多表”表明您正在考虑每个用户的表。这是另一个同样有问题的想法。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-29T18:11:28.963

两者都不。您为每种类型的数据创建一个包含单个表的单个数据库，然后使用外键将每个用户的数据链接在一起。如果您只有几个固定用户，这不会那么糟糕，但是您所建议的根本不是可扩展的。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-29T18:15:07.300

我们有一个类似的系统，有很多用户和他们的相关数据。我们遵循单一数据库和公用表的方法。这样，您将拥有一个保存用户信息的表和一个保存所有数据的表。除了数据之外，我们还有对帮助我们隔离信息的用户 ID 的引用。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-29T19:17:46.660

相比之下，您确实需要单独的数据库的时候是当您有多个虚拟主机客户端想要使用数据库做自己的事情时 - 然后您可以设置安全性，以便他们只能访问自己的数据。

但是，如果您正在编写与数据库而不是数据库交互的代码，那么您想要的是规范化表，如此处其他几个答案中所述。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-29T18:15:07.050

您的设计存在缺陷。您应该使用外键将元组限制为正确的用户，而不是为每个帐户添加新实体。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-29T18:16:55.270

一个数据库中的多个表或具有相同表的多个数据库之间有什么区别？是为了更好的安全性还是为了不同类型的备份？

我不确定 mySQL 但在 MSSQL 中是这样的：

*   如果您需要以不同的方式备份数据库，则需要考虑将表保存在不同的数据文件中。默认情况下，它们都在 PRIMARY 文件中。您可以指定不同的存储。

*   所有事务都保存在 tempdb 中。这不是很好，因为如果事务日志已满，那么所有数据库都会停止运行。然后，您最终可以为每个用户使用单独的 SQL 服务器。如果您谈论的是成千上万的客户，这有点胡说八道。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-11-29T19:27:21.977

每个必需的实体集都有一个带有正确创建索引的表（一个表用于提交的报价，一个表用于提交的费率）。

```
CREATE TABLE quotesSubmtited (
   userid INTEGER, 
   submittime DATETIME, 
   quote INTEGER,
   quotedata INTEGER, 
   PRIMARY KEY (userid, submittime),
   FOREIGN KEY quote REFERENCES quotesList (quoteId),
   FOREIGN KEY userid REFERENCES userList (userId)
);

CREATE INDEX idx1 ON quotesSubmitted (quote); 
```

请记住：您创建的索引越多，更新速度就越慢。因此，请仔细查看您在查询中使用的内容并为此创建索引。一个好的数据库优化教程将有助于理解您需要创建哪些索引（我无法在这个答案中总结它）。

I also presume you don't know about JOINs and FOREIGN KEYs so make sure you read about them as well. Quite useful!

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2008-11-29T18:17:27.453

使用一个数据库和一个表。您将需要一个“用户”表，并且该表将链接（主-外键）到这些表。

# apache - 您如何比较 Apache Tomcat 和 Glassfish 作为生产服务器？

> ID：327793
> 
> 赞同：23
> 
> 时间：2008-11-29T18:11:36.480
> 
> 标签：apache, deployment, glassfish, webserver

我有一个当前在 Apache Tomcat 上运行的基于 J2EE 的系统。我们正在讨论将我们的生产服务器迁移到 Glassfish 服务器。

有人可以与他们中的任何一个分享他们的经验吗？

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2008-11-29T18:20:35.543

它们没有可比性。

Apache Tomcat 不是 J2EE 服务器。它只是 Web 应用程序的 Servlet 容器。而已。如果您需要 J2EE API 实现，则必须从其他地方获取。例如，通过使用使用 Tomcat 作为其容器的 Apache Geronimo 服务器，或者通过从 Glassfish 获取 JAR 文件。

Glassfish 是一个完整的 Java 应用服务器，实现了 JPA、EJB 等 API。Glassfish 包含一个 Tomcat 最初使用的 Servlet 引擎，但他们对其进行了改进（不知道具体是什么）。最近的 glassfish 服务器使用另一个容器`grizzly`，该容器使用 NIO API 进行输入/输出，并且可以很好地扩展。据我所知，Glassfish Servlet Engine 的性能更高。在这里我找到了一个很好的基准（虽然它有点旧）：

[http://weblogs.java.net/blog/sdo/archive/2007/05/how_to_test_con.html](http://weblogs.java.net/blog/sdo/archive/2007/05/how_to_test_con.html)

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-11-29T18:20:19.880

这是[一个相当古老的比较](https://rogerkeays.com/blog/glassfish-vs-tomcat)。因此，每台服务器的能力无疑都得到了提升。

编辑：这是[当前的比较。](http://wiki.glassfish.java.net/Wiki.jsp?page=GlassFishVsTomcat)

不过，两者对于生产使用都足够稳定。这真的要归结为功能。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-14T18:16:40.197

大问题是：为什么？您认为 Glassfish 将通过 Tomcat 或 Jetty 为您提供什么？也许是管理实用程序？

除了基本的 servlet 容器之外，您想要的大多数东西都很容易插入。

因此，虽然 Glassfish 还不错，但“仅仅因为”而移动是没有意义的。我构建的大多数生产服务都在普通的旧 servlet 容器上，不使用任何特定于实现的功能。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-10-14T22:27:16.900

这可能有点过时，甚至可能有点偏颇，但它来自 Oracle。您可以跳到将玻璃鱼与汤姆猫进行比较的部分

[http://java.sun.com/developer/technicalArticles/glassfish/GFandMySQL_Part1.html](http://java.sun.com/developer/technicalArticles/glassfish/GFandMySQL_Part1.html)

# java - IIS 在性能和可伸缩性方面与企业 Web 应用程序的 weblogic 和 websphere 相比如何？

> ID：327801
> 
> 赞同：1
> 
> 时间：2008-11-29T18:16:37.143
> 
> 标签：java, .net, iis, websphere, weblogic

反对将 .NET 用于大容量、事务性企业系统的一个常见论点是 IIS 无法与 Java 的 Weblogic 和 websphere 之类的相比。这是真的？不幸的是，对于 .NET Web 应用程序，IIS 是作为应用程序服务器的唯一选择。有人对此有任何反对意见吗？我想在企业中更多地推广 .NET，并且需要一些帮助来推进我的案例。

谢谢

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-29T19:32:48.457

我已经编写 ASP.NET 6 年了，在进入该领域之前，我是一名网络工程师。IMO，IIS 上的 ASP.NET 开箱即用比大多数其他平台更快。但是，很容易用平庸的编程技能搞砸性能，并且高度调整的平台可能会击败标准的 IIS 配置。

老实说，对于哪个平台具有更高的潜在性能的整个辩论，我并没有太多关注，因为我从来没有解决过这个问题，而且我开发的网站每小时获得超过 2-3 百万次点击没有打嗝。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-29T19:53:47.057

如果你问 IIS 和 .Net 是否可以做高性能网站，答案是肯定的。您不太可能达到您提到的任何一个 Web 服务器开始出现问题的那种规模。您更有可能首先遇到后端数据库的问题。

如果您要问如何说服管理层，那么我会尝试一些 MS 案例研究，这些案例研究都可以在[Microsoft 案例研究网站上](http://www.microsoft.com/casestudies/default.aspx)找到。

您可能希望找到与您的业务领域相关的案例研究，但这里有一些我过去使用过的案例：

1.  [GoDaddy.com：世界上最大的域名注册商将 350 万个域名从 Linux 迁移到 Windows](http://www.microsoft.com/casestudies/casestudy.aspx?casestudyid=1000003748)
2.  [伦敦证券交易所将信息传播时间从 30 毫秒缩短至 2 毫秒](http://www.microsoft.com/casestudies/casestudy.aspx?casestudyid=200042)
3.  [Virgin Group：使用 Microsoft .NET 使网站流量增加了近 50%](http://www.microsoft.com/casestudies/casestudy.aspx?casestudyid=51584)
4.  [Break.com：流行的娱乐网站在两台 Web 服务器上处理高达 3500 万的每日页面浏览量](http://www.microsoft.com/casestudies/casestudy.aspx?casestudyid=4000002034)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-29T18:45:45.087

该站点使用 LinqToSql 在 .NET 上运行。有关详细信息，请参阅[此](https://blog.stackoverflow.com/2008/09/what-was-stack-overflow-built-with/)帖子。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-29T19:02:57.063

许多非常受欢迎的网站都使用 .Net：Myspace.com、Dell.com、Match.com、Monster.com、Newegg.com ...

在此处查看更多信息：[http ://www.asp.net/get-started/](http://www.asp.net/get-started/)

此外，您可以使用 mod_mono 在 Apache 上运行 .Net。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-06-30T16:03:07.640

由于内核中的缓存，IIS 7 实际上对于静态页面非常快。

但它作为应用服务器相当慢：[G-WAN](http://gwan.ch/)快四倍。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-29T19:46:17.570

实际上，在 Mono/Apache 上运行 ASP.NET 已经开始流行起来。

我个人坚持使用 IIS，因为这是我所知道的，但如果你已经是 Linux 商店，我会毫不犹豫地推荐 Mono。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-08T14:38:17.577

尽管严格来说这不是真的，但我认为 IIS 更像是一个 Web 服务器而不是高性能应用程序服务器，但每个服务器的用例通常略有不同。

例如，WebSphere 在金融界非常流行，那里有很多关键任务分布式事务处理。这可以通过 IIS 实现，但使用 WAS 或 weblogic 之类的更容易。

对我来说; 可用的应用程序服务器是 .net 在服务器端跟不上 Java 的主要原因之一。

卡尔

# c# - 为什么我得到 E_ACCESSDENIED 从代理调用 COM+ 方法？

> ID：327805
> 
> 赞同：2
> 
> 时间：2008-11-29T18:19:08.680
> 
> 标签：c#, .net, proxy, com+, access-denied

抱歉，如果这有点冗长...考虑一下：

**我在名为Company**的命名空间中有一个 COM+ 应用程序，它公开了一个名为**Server**的对象，该对象具有以下方法：

```
bool Server.Execute(IOptions options)

IOptions Server.CreateOptions() 
```

IOptions 仅具有几个布尔读/写属性，如下所示：

```
IOptions.Option1 (bool)

IOptions.Option2 (bool) 
```

我使用以下代码创建了一个客户端应用程序：

```
Company.Server s = new Company.Server();

Company.IOptions serverOptions = s.CreateOptions();

serverOptions.Option1 = false;
serverOptions.Option2 = true;

s.Execute(serverOptions); 
```

我在机器 A 上安装 COM+ 应用程序，然后在机器 A 上执行客户端，一切都很好。

然后我修改客户端应用程序，使其创建自己的 IOptions 实现，如下所示：

```
public class ClientOptions : Company.IOptions
{
    public bool Option1 { get; set; }
    public bool Option2 { get; set; }
}

Company.Server s = new Company.Server();

ClientOptions clientOptions = new ClientOptions();

clientOptions.Option1 = false;
clientOptions.Option2 = true;

s.Execute(clientOptions); 
```

同样，我在机器 A 上执行客户端应用程序，一切都很好。

如果我在机器 B 上安装 COM+ 应用程序作为机器 A 的代理，然后执行客户端，则会在调用以下命令时收到 E_ACCESSDENIED 错误：

```
s.Execute(clientOptions); 
```

这是在机器 B 访问机器 A 上执行的代码的摘要

```
Company.Server s = new Company.Server();

Company.Options serverOptions = s.CreateOptions()

serverOptions.Option1 = false;
serverOptions.Option2 = true;

s.Execute(serverOptions); // this is fine

ClientOptions clientOptions = new ClientOptions();

clientOptions.Option1 = false;
clientOptions.Option2 = true;

s.Execute(clientOptions); // this causes the error 
```

总而言之，当客户端与 COM+ 应用程序在同一台机器上时，为什么我可以实现自己的 IOptions 并在 COM+ 应用程序中使用它，但当客户端通过另一台机器上的代理访问 COM+ 应用程序时却不能？

似乎如果 IOptions 是由服务器创建的，那很好，但如果它是由客户端创建的，则不是。

任何帮助将不胜感激。

谢谢，

卡尔。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-29T18:57:11.040

我将推断一些较早的 DCOM 经验，这可能有帮助，也可能没有帮助。当您被拒绝访问时，您必须查看机器 B 上的 DCOM 配置参数。

在较旧的操作系统（Windows 2000）上，您将运行**dcomcnfg**。但在 XP 中，您从控制面板——管理工具运行组件服务。在 Vista 下，显然，您必须运行 windows\System32\comexp.msc。

当您在组件服务管理中时，突出显示我的电脑并选择属性。您要做的第一件事是在**Defaults Properties**选项卡上，单击**Enable Distributed COM on this Computer**。此外，您可能需要在**COM 安全**选项卡中指定**启动和激活**以及**访问**权限。这样做时，您可能必须同时处理编辑限制和编辑默认值？

 **请注意，我认为这些是默认权限，您可能希望在应用程序列表中找到您注册的 COM+ 应用程序并设置特定于应用程序的访问权限，而不是机器范围的默认值。但我知道您必须选中**在此计算机上启用分布式 COM**复选框。

我希望这有帮助。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-29T18:51:06.463

尝试通过 dcomcnfg.exe（应该打开 MMC 管理单元）查看远程计算机上 COM 服务器的远程激活权限。

-Oisin

# python - Django 等效于 count 和 group by

> ID：327807
> 
> 赞同：93
> 
> 时间：2008-11-29T18:19:28.243
> 
> 标签：python, django

我有一个看起来像这样的模型：

```
class Category(models.Model):
    name = models.CharField(max_length=60)

class Item(models.Model):
    name = models.CharField(max_length=60)
    category = models.ForeignKey(Category) 
```

我想为每个类别选择项目的计数（只是计数），所以在 SQL 中它就像这样简单：

```
select category_id, count(id) from item group by category_id 
```

有没有相当于做这种“Django 方式”的方法？还是纯 SQL 是唯一的选择？我熟悉 Django 中的*count()*方法，但是我不知道*group by*如何适合那里。

* * *

## 回答 #1

> 赞同：133
> 
> 时间：2009-08-23T05:21:09.567

正如我刚刚发现的，这里是如何使用 Django 1.1 聚合 API 执行此操作：

```
from django.db.models import Count
theanswer = Item.objects.values('category').annotate(Count('category')) 
```

* * *

## 回答 #2

> 赞同：58
> 
> 时间：2008-11-29T20:44:21.227

（**更新**：完整的 ORM 聚合支持现在包含在[Django 1.1](http://docs.djangoproject.com/en/dev/releases/1.1/#aggregate-support)中。对于以下关于使用私有 API 的警告，此处记录的方法不再适用于 Django 的 1.1 后版本。我还没有深入了解原因；如果您使用的是 1.1 或更高版本，则无论如何都应该使用真正的[聚合 API 。）](http://docs.djangoproject.com/en/dev/topics/db/aggregation/)

核心聚合支持在 1.0 中已经存在；它只是未记录，不受支持，并且还没有在其之上的友好 API。但是，在 1.1 到来之前，无论如何您都可以使用它（风险自负，并且完全知道 query.group_by 属性不是公共 API 的一部分并且可能会更改）：

```
query_set = Item.objects.extra(select={'count': 'count(1)'}, 
                               order_by=['-count']).values('count', 'category')
query_set.query.group_by = ['category_id'] 
```

如果您随后遍历 query_set，则每个返回值将是一个带有“category”键和“count”键的字典。

您不必在这里按 -count 排序，这只是为了演示它是如何完成的（它必须在 .extra() 调用中完成，而不是在查询集构造链的其他地方完成）。此外，您也可以说 count(id) 而不是 count(1)，但后者可能更有效。

另请注意，在设置 .query.group_by 时，值必须是实际的 DB 列名（'category_id'）而不是 Django 字段名（'category'）。这是因为您正在以数据库术语而不是 Django 术语的级别调整查询内部结构。

* * *

## 回答 #3

> 赞同：58
> 
> 时间：2009-08-27T15:02:17.150

由于我对 Django 1.1 中的分组是如何工作的有点困惑，我想我会在这里详细说明你是如何使用它的。首先，重复迈克尔所说的话：

> 正如我刚刚发现的，这里是如何使用 Django 1.1 聚合 API 执行此操作：
> 
> ```
> from django.db.models import Count
> theanswer = Item.objects.values('category').annotate(Count('category')) 
> ```

另请注意，您需要`from django.db.models import Count`！

这将只选择类别，然后添加一个名为`category__count`. 根据默认排序，这可能就是您所需要**的，但如果默认排序使用除此之外的字段`category`将不起作用**。这样做的原因是还选择了排序所需的字段并使每一行都是唯一的，因此您不会按照自己的意愿对内容进行分组。解决此问题的一种快速方法是重置排序：

```
Item.objects.values('category').annotate(Count('category')).order_by() 
```

这应该会产生您想要的结果。要设置注释的名称，您可以使用：

```
...annotate(mycount = Count('category'))... 
```

然后，您将`mycount`在结果中调用一个注释。

关于分组的其他一切对我来说都非常简单。请务必查看[Django 聚合 API](http://docs.djangoproject.com/en/dev/topics/db/aggregation)以获取更多详细信息。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-29T21:31:53.440

这个怎么样？（除了慢。）

```
counts= [ (c, Item.filter( category=c.id ).count()) for c in Category.objects.all() ] 
```

它的优点是很短，即使它确实获取了很多行。

* * *

编辑。

一个查询版本。顺便说一句，这通常*比*数据库中的 SELECT COUNT(*) 快。试试看。

```
counts = defaultdict(int)
for i in Item.objects.all():
    counts[i.category] += 1 
```

# ajax - Struts 2 & Dojo 文件太重，影响网站性能。有什么补救措施吗？

> ID：327820
> 
> 赞同：7
> 
> 时间：2008-11-29T18:30:49.283
> 
> 标签：ajax, performance, dojo, struts2

嗯.. 我们已经使用 struts2 ajax 功能开发了一个 j2ee 应用程序。我们发现 dojo 的实现非常缓慢。我们做了以下事情： 1\. dojo 库的自定义构建。（将 dojo.js 从 240kb 增加到 350kb） 2\. 从 struts jar 中取出所有静态内容并将其保存在外面。

性能显着提高。但它仍然很重，你可以猜到 350kb 大小..

struts2 ajax 应该这么重吗？还是有更轻的实现可用？

* * *

编辑：我在我的应用程序中使用了 Firebug 和 YSlow。下面提到了一些极大地改善了我的情况的变化：

1.  dojo 的自定义构建（减少了 I/O 的数量）
2.  将静态文件移出 Struts jar（帮助很大）
3.  调整您的服务器以 gzip 响应（将响应大小减少到 1/3）
4.  减少您网站上的图片数量。（这很明显）

将继续更新进一步的变化..

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-29T19:16:36.663

首先检查您是否在服务器上完成了所有便于缓存的操作（例如，设置正确的 HTTP 标头、压缩、服务器端缓存、上游缓存等）。有关更多详细信息，请参阅[提高性能...。](http://lazutkin.com/blog/2007/feb/1/improving-performance/)

目标是尽可能减少 I/O — 使用 Firebug 或任何其他网络流量监控工具来查看来回发送了多少。尽量减少 I/O 请求的数量和总字节数。

不要忘记它也适用于您的动态数据 - 选择有效的格式，将几个相关的请求捆绑在一起，删除所有一遍又一遍地发送而不改变的枯木。

如果自定义构建和服务器端调整没有帮助，请考虑将您的 Web 应用程序重组为更轻量级。例子：

*   评估上面链接中讨论的闪屏技术。
*   如果您使用许多不同的表单小部件，请查看是否真的有必要，然后使用常规 DOM 元素，如“input”、“button”、“textarea”、“select”。
*   布局小部件也是如此。看看简单的 CSS 是否可以帮助您。
*   评估分层构建 Dojo 而不是一个单一的 dojo.js，以便网页仅加载必要的子集。请参阅[包系统和自定义构建中的](http://www.dojotoolkit.org/book/dojo-book-0-9/part-4-meta-dojo/package-system-and-custom-builds)详细信息。

在过去的 2 年里，我一直以使用 Dojo 构建 Web 应用程序为生.

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-16T05:14:38.837

确保您首先遵循此常见问题解答： [http://struts.apache.org/2.x/docs/performance-tuning.html](http://struts.apache.org/2.x/docs/performance-tuning.html)

我通常重新编写自己的主题，而不是使用内置 dojo 的 struts2 ajax 主题。这样我可以使用我想使用的任何工具包（jQuery）。当我将模板文件夹从 jar 复制到 webapp 的根 Web 目录时，我看到了最大的性能改进。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-16T05:08:59.813

最后我检查了一下，struts 发布了 Dojo (0.4) 版本，它已经有 2 年历史了。Dojo 对 0.9/1.0 版本进行了重写，从而显着提高了性能并减少了代码大小。您应该确保您运行的是最新版本的 Dojo（当前版本是 1.2.3）并使用上面 Eugene 的构建和提示。

# wpf - 你能在数据绑定的 WPF 样式中做“数学”吗

> ID：327829
> 
> 赞同：9
> 
> 时间：2008-11-29T18:40:40.340
> 
> 标签：wpf, data-binding, templates, styles

我有一个按钮控件样式，我想更改任何数据绑定版本的填充，以针对需要 2 像素偏移的字形进行调整。我将使用 SimpleStyles.xaml 中的 SimpleButton 作为示例（...显示为简洁起见删除了触发器代码的位置）：

```
<Style x:Key="SimpleButton" TargetType="{x:Type Button}" BasedOn="{x:Null}">
  <Setter Property="FocusVisualStyle" Value="{DynamicResource SimpleButtonFocusVisual}"/>
  <Setter Property="Background" Value="{DynamicResource NormalBrush}"/>
  <Setter Property="BorderBrush" Value="{DynamicResource NormalBorderBrush}"/>
  <Setter Property="Template">
    <Setter.Value>
        <ControlTemplate TargetType="{x:Type Button}">
            <!-- We use Grid as a root because it is easy to add more elements to customize the button -->
           <Grid x:Name="Grid">
             <Border x:Name="Border" Background="{TemplateBinding Background}" BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="{TemplateBinding BorderThickness}" Padding="{TemplateBinding Padding}"/>

              <!-- Content Presenter is where the text content etc is placed by the control. The bindings are useful so that the control can be parameterized without editing the template -->
             <ContentPresenter HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}" Margin="{TemplateBinding Padding}" VerticalAlignment="{TemplateBinding VerticalContentAlignment}" RecognizesAccessKey="True"/>
           </Grid>
     ...
    </Setter.Value>                     
  </Setter>
</Style> 
```

我想要做的是在 Padding="{TemplateBinding Padding}" 的地方添加一些额外的边距。像 Padding="{TemplateBinding Padding} + 2,0,0,0" 这样的东西。

有 XAML 语法吗？如果没有，在代码中执行此操作时是否有最佳方法（装饰器？）？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-11-30T18:50:14.530

目前 XAML 不解析 Binding 语法等中的表达式。但是，您可以使用[IValueConverter](http://msdn.microsoft.com/en-us/library/system.windows.data.ivalueconverter.aspx)或[IMultiValueConverter](http://msdn.microsoft.com/en-us/library/system.windows.data.imultivalueconverter.aspx)来帮助自己：

XAML：

```
<Setter.Value>
    <ControlTemplate TargetType="{x:Type Button}">
       <Grid x:Name="Grid">
         <Grid.Resources>
             <local:ThicknessAdditionConverter x:Key="AdditiveThickness" />
         </Grid.Resources>
         <Border x:Name="Border">
             <Border.Padding>
                 <Binding Path="Padding" RelativeSource="{RelativeSource TemplatedParent}"
                          Converter="{StaticResource AdditiveThickness}">
                     <Binding.ConverterParameter>
                         <Thickness>2,0,0,0</Thickness>
                     </Binding.ConverterParameter>
                 </Binding>
             </Border.Padding>
         </Border>
 ...
</Setter.Value> 
```

IValueConverter 后面的代码：

```
public class ThicknessAdditionConverter : IValueConverter
{
    public object Convert(object value, Type targetType, object parameter, CultureInfo culture)
    {
        if (value == null) return new Thickness(0, 0, 0, 0);
        if (!(value is Thickness)) throw new ArgumentException("Value not a thickness", "value");
        if (!(parameter is Thickness)) throw new ArgumentException("Parameter not a thickness", "parameter");

        var thickness = new Thickness(0, 0, 0, 0);
        var t1 = (Thickness)value;
        var t2 = (Thickness)parameter;

        thickness.Left = t1.Left + t2.Left;
        thickness.Top = t1.Top + t2.Top;
        thickness.Right = t1.Right + t2.Right;
        thickness.Bottom = t1.Bottom + t2.Bottom;

        return thickness;
    }

    public object ConvertBack(object value, Type targetType, object parameter, CultureInfo culture)
    {
        throw new NotImplementedException();
    }
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-29T20:54:57.150

[Blendables.com](http://www.blendables.com/products/productsEmix.aspx)上提供了一个名为***Eval Binding***的产品，而***Simple Binding***现在可以做到这一点。（该产品不是免费的）在这里查看[白皮书](http://www.blendables.com/files/folders/essentials_documentation/entry148.aspx)

例如，对于下面的 XAML 代码，您需要一个转换器来执行操作。

```
<Ellipse Fill="Blue" Height="50"
    Width="{Binding RelativeSource={RelativeSource Self}, 
        Path=Height, Converter={StaticResource MyConverter}}" /> 
```

但是使用 EvalBinding 你可以像下面这样

```
 <Ellipse Fill="Blue" Height="50"
    Width="{blendables:EvalBinding [{Self}.Height]/2}" /> 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-29T20:16:09.007

不，不在此版本的 XAML 中 - 使用值转换器进行数学运算。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-30T18:21:24.620

`ExpressionConverter`在[这个库](http://www.codeplex.com/wpfconverters)中查看。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-08-03T23:09:23.227

**您可以利用转换来做一些简单的数学运算。**

查看 Charles Petzold 很久以前提出的这个技巧：http: [//www.charlespetzold.com/blog/2006/04/060223.html](http://www.charlespetzold.com/blog/2006/04/060223.html)

不幸的是，它似乎对您的特定场景没有帮助...因为您只想更改 Padding 的厚度类型的 Left 属性...而且这不是您可以单独绑定的依赖属性。

但是，我觉得有必要添加这个答案，因为它可以帮助其他人通过谷歌或其他搜索引擎找到他们的方式。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2013-03-25T16:36:49.613

查看 MathConverter：[http: //rachel53461.wordpress.com/2011/08/20/the-math-converter/](http://rachel53461.wordpress.com/2011/08/20/the-math-converter/)

在那里，您可以发送一个表达式作为转换器参数，其中 @VALUE 是您绑定到的值：

```
ConverterParameter=((@VALUE-15)*.2) 
```

# c - 多文件C程序，如何最好地实现可选日志记录？

> ID：327836
> 
> 赞同：9
> 
> 时间：2008-11-29T18:46:36.130
> 
> 标签：c, debugging

我有一个多文件 C 程序。我希望用户能够在运行时指定不同的调试级别。

实现这一点的最佳方法是什么？

我正在考虑将 debug(level, "message") 类型的函数导出并在任何地方使用。有更好的/其他想法吗？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-11-30T09:20:32.013

乔纳森的建议很好，但由于 C99 我们有可变参数宏，所以不需要使用双括号来调试宏。

我使用了一个轻型版本的日志记录头：

```
#define LOG_FATAL    (1)
#define LOG_ERR      (2)
#define LOG_WARN     (3)
#define LOG_INFO     (4)
#define LOG_DBG      (5)

#define LOG(level, ...) do {  \
                            if (level <= debug_level) { \
                                fprintf(dbgstream,"%s:%d:", __FILE__, __LINE__); \
                                fprintf(dbgstream, __VA_ARGS__); \
                                fprintf(dbgstream, "\n"); \
                                fflush(dbgstream); \
                            } \
                        } while (0)
extern FILE *dbgstream;
extern int  debug_level; 
```

所以无论我需要记录什么，我只需添加行

`LOG(LOG_ERR, "I/O error %s occured while opening file %s", strerror(errno), filename);`

在程序初始化期间，您需要为`dbgstream`（通常默认为`stderr`）和指定值`debug_level`。

对于真正的项目而不是`fprintf`多次调用，我只是从`LOG`宏调用我的函数并 pass `__FILE__`，`__LINE__`并`__VA_ARGS_`作为参数 - 该函数还在日志行中打印日期、时间和 pid，并且不要`fflush()`每次都这样做 - 仅当缓冲计数器超过预设值时- 它显着提高了日志记录性能。

但请注意，某些编译器可能不支持可变参数宏，因为它仅在 C99 中引入。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-29T20:18:59.610

在 Windows（以及整个 Microsoft）中，我们广泛使用[Windows 事件跟踪](http://msdn.microsoft.com/en-us/library/bb968803.aspx)(ETW)。ETW 是一种高效的静态日志记录机制。NT 内核和许多组件都被很好地检测了。ETW有很多优点：

*   任何 ETW 事件提供程序都可以在运行时动态启用/禁用 - 无需重新启动或进程重新启动。大多数 ETW 提供程序提供对单个事件或事件组的精细控制。
*   事件数据的格式化不是在运行时完成的（这可能*非常*昂贵）。它在事件跟踪被后处理时完成。
*   ETW 是[Windows 事件日志](http://technet.microsoft.com/en-us/magazine/cc160886.aspx)的底层机制。如果您正确构建您的仪器，您将免费获得应用程序级别的日志记录。
*   您的组件可以支持非常精细的事件启用，可以单独、按级别或分组（或任何组合）。您还可以在我们的代码中放置多个提供程序。
*   来自任何提供者（最重要的是内核）的事件都可以合并到单个跟踪中，因此所有事件都可以关联起来。
*   合并后的迹线可以从盒子中复制出来并进行完全处理 - 带有符号。
*   NT 内核样本配置文件中断可以生成 ETW 事件 - 这会产生一个非常轻量级的样本配置文件，可以随时*使用*
*   在 Vista 和 Windows Server 2008 上，记录事件是无锁的并且完全支持多核 - 每个处理器上的线程可以独立记录事件，而无需在它们之间进行同步。
*   当日志记录关闭时，ETW 也很有效 - 它只是一个简单的布尔检查（ETW 执行此操作，或者您可以显式执行此操作）。请注意，这*不需要*内核模式转换。这一切都在进行中。

这对我们来说非常有价值，也适用于您的 Windows 代码 - ETW 可用于任何组件 - 包括用户模式、驱动程序和其他内核组件。

许多人喜欢在他们的程序或组件运行时观察他们的日志输出。使用 ETW 很容易做到这一点。我们经常做的是编写一个流式 ETW 消费者。我没有将 printfs 放在代码中，而是将 ETW 事件放在有趣的地方。当我的组件正在运行时，我可以随时运行我的 ETW 观察程序 - 观察程序接收事件并显示它们、计算它们或用它们做其他有趣的事情。

大多数代码都可以从良好实现的日志记录中受益。良好实施的静态运行时日志记录可以直接发现许多问题 - 没有它，您对组件中发生的事情的可见性为零。您可以查看输入、输出和猜测——仅此而已。

他们在这里的关键是“实施良好”一词。仪表必须在正确的位置。像其他任何事情一样，这需要一些思考和计划。如果它不在有用/有趣的地方，那么它不会帮助您在开发、测试或部署场景中发现问题。您还可能有太多的仪器在打开时导致性能问题 - 甚至关闭！

Windows 中有几个工具可以帮助您使用基于 ETW 的记录器和事件。其中包括 logman.exe 和 tracerpt.exe。还有一些[xperf 工具](http://msdn.microsoft.com/en-us/library/cc305187.aspx)专注于性能，但也可以控制任何 ETW 提供程序和转储日志文件。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-29T18:51:49.363

log4j 有一个非常好的 C 端口[log4c](http://log4c.sourceforge.net/)。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-11-29T19:15:25.713

我使用了两个密切相关的调试系统（在*歇斯底里的葡萄干*的单个标头中声明）。更简单的有一个调试级别和类似 printf 的函数，它们采用调试级别并且仅在调试级别设置得足够高时才发出输出。更复杂的一个提供不同的调试子系统，每个子系统的行为都像一个更简单的子系统（例如，我可以在与输入调试或规则调试不同的级别进行宏调试，或者......）。

您的问题未解决的另一个问题是如何在运行时启用调试。我一直使用命令行选项——通常' `-d`'用于'第 3 级的基本调试'，' `-D nn`'用于第 nn 级的调试。或者，使用复杂系统：' `-D input=3,macros=5,rules=1`'。拥有一个具有相同语义的环境变量并不难。

从实现这些的标头中：

```
/*
** Usage:  TRACE((level, fmt, ...))
** "level" is the debugging level which must be operational for the output
** to appear. "fmt" is a printf format string. "..." is whatever extra
** arguments fmt requires (possibly nothing).
** The non-debug macro means that the code is validated but never called.
** -- See chapter 8 of 'The Practice of Programming', by Kernighan and Pike.
*/
#ifdef DEBUG
#define TRACE(x)    db_print x
#else
#define TRACE(x)    do { if (0) db_print x; } while (0)
#endif /* DEBUG */

#ifndef lint
#ifdef DEBUG
/* This string can't be made extern - multiple definition in general */
static const char jlss_id_debug_enabled[] = "@(#)*** DEBUG ***";
#endif /* DEBUG */
#ifdef MAIN_PROGRAM
const char jlss_id_debug_h[] = "@(#)$Id: debug.h,v 3.6 2008/02/11 06:46:37 jleffler Exp $";
#endif /* MAIN_PROGRAM */
#endif /* lint */

#include <stdio.h>

extern int      db_getdebug(void);
extern int      db_newindent(void);
extern int      db_oldindent(void);
extern int      db_setdebug(int level);
extern int      db_setindent(int i);
extern void     db_print(int level, const char *fmt,...);
extern void     db_setfilename(const char *fn);
extern void     db_setfileptr(FILE *fp);
extern FILE    *db_getfileptr(void);

/* Semi-private function */
extern const char *db_indent(void);

/**************************************\
** MULTIPLE DEBUGGING SUBSYSTEMS CODE **
\**************************************/

/*
** Usage:  MDTRACE((subsys, level, fmt, ...))
** "subsys" is the debugging system to which this statement belongs.
** The significance of the subsystems is determined by the programmer,
** except that the functions such as db_print refer to subsystem 0.
** "level" is the debugging level which must be operational for the
** output to appear. "fmt" is a printf format string. "..." is
** whatever extra arguments fmt requires (possibly nothing).
** The non-debug macro means that the code is validated but never called.
*/
#ifdef DEBUG
#define MDTRACE(x)  db_mdprint x
#else
#define MDTRACE(x)  do { if (0) db_mdprint x; } while (0)
#endif /* DEBUG */

extern int      db_mdgetdebug(int subsys);
extern int      db_mdparsearg(char *arg);
extern int      db_mdsetdebug(int subsys, int level);
extern void     db_mdprint(int subsys, int level, const char *fmt,...);
extern void     db_mdsubsysnames(char const * const *names); 
```

# iis - 使用命令行进行远程计算机 IIS 管理

> ID：327837
> 
> 赞同：1
> 
> 时间：2008-11-29T18:48:11.680
> 
> 标签：iis

帮助我在远程 PC/服务器上管理 IIS（我想做的是创建虚拟目录，设置虚拟目录的属性）。

并检查 iis 是否正在运行，并且存在特定的虚拟目录。

iisvdir.vbs 有助于管理本地系统上的 iis，我如何使用它来管理远程系统。

或者有没有其他方法可以做到这一点。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-29T18:49:50.163

你可以做的比 powershell 和 IIS 提供者差很多：

[http://learn.iis.net/page.aspx/429/installing-the-iis-70-powershell-provider/](http://learn.iis.net/page.aspx/429/installing-the-iis-70-powershell-provider/)

即使没有提供程序，使用 WMI 的 powershell 也比使用 vbs 更容易。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-29T19:04:20.370

我自己找到了它，但如果有人做得更好，请告诉我。 [http://support.microsoft.com/kb/816568](http://support.microsoft.com/kb/816568)

列出虚拟目录 iisweb /query 命令使用以下语法： iisweb /query WebSite [WebSite...] [/s Computer [/u [Domain]User /p Password]]

创建虚拟目录。iisvdir /create 命令使用以下语法：iisvdir /create WebSite [/Virtual Path]Name Physical Path [/s Computer [/u [Domain] User /p Password]]

它里面有服务器名。

# wpf - 您可以通过 WPF 样式将数据绑定到 CornerRadius 吗？

> ID：327838
> 
> 赞同：2
> 
> 时间：2008-11-29T18:48:34.597
> 
> 标签：wpf, data-binding, styles, cornerradius

我有一个 Button 样式，似乎无法将边框的 CornerRadius 属性数据绑定到模板。这是一个依赖属性，所以它应该是数据可绑定的。我想知道我是否缺少要使用的正确 XAML 语法？

```
<Style TargetType="{x:Type Button}" BasedOn="{x:Null}">         
      <Setter Property="FocusVisualStyle" Value="{DynamicResource MyButtonFocusVisual}"/>       
      <Setter Property="Background" Value="{DynamicResource MyButtonBackgroundBrush}"/>       
      <Setter Property="Foreground" Value="{DynamicResource MyButtonForegroundBrush}"/>
      <Setter Property="BorderBrush" Value="{DynamicResource MyButtonBorderBrush}"/>
      <Setter Property="BorderThickness" Value="3"/>
      <Setter Property="FontFamily" Value="Segoe UI"/>      
      <Setter Property="FontSize" Value="14" />
      <Setter Property="CornerRadius" Value="2" />
      <Setter Property="Template">          
      <Setter.Value>
        <ControlTemplate TargetType="{x:Type Button}">
           <!-- We use Grid as a root because it is easy to add more elements to customize the button -->
           <Grid x:Name="Grid">
           <Border x:Name="Border" CornerRadius="{TemplateBinding CornerRadius}" Background="{TemplateBinding Background}" BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="{TemplateBinding BorderThickness}" Padding="{TemplateBinding Padding}"/> 
           </Grid> 
         </ControlTemplate>             
       </Setter.Value>      
     </Setter>                  
   </Style> 
```

和 CornerRadius="{TemplateBinding CornerRadius}" 都给我错误“CornerRadius 无法识别或无法访问”。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-30T18:19:34.560

您正在尝试`CornerRadius`在 class 上设置/绑定属性`Button`，但没有这样的属性。所以这个错误是预期的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-01T21:11:50.063

肯特是对的。解决此问题的一种方法是创建您自己的从按钮类继承的自定义控件。然后在这个派生类中，创建一个依赖属性并将其注册到窗口的 CornerRadius 属性。然后您可以使用上面的代码，但不是在 Button 控件上设置样式属性，而是在派生类上设置样式属性。

# apache-flex - Flex Mxml 和属性作为字符串，转义 ?? 帮助

> ID：327843
> 
> 赞同：0
> 
> 时间：2008-11-29T18:53:19.597
> 
> 标签：apache-flex, string, mxml

一个简单的问题：如果我对属性使用转义字符，例如

```
<mx:Image  id="img" toolTip="\\foo{\\bar}" 
```

它不会验证工具提示，因此不会编译。

解决办法是什么 ？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-04T12:41:30.810

例如，您可以在 creationComplete 事件处理程序中使用 ActionScipt 并为您分配工具提示，您将不会有与 MXML 中相同的约束。

但是您也可以通过使用 CDATA 在 MXML 中避免这些约束：

```
<mx:Image id="img" source="foo.jpg" width="50" height="50">
<mx:toolTip>
    <![CDATA[\foo{\bar} or any usually forbidden characters as <, >, &, "'"...]]>
</mx:toolTip></mx:Image> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-07-12T16:16:58.790

您可以对特殊字符使用 HTML 格式。`<mx:Image id="img" toolTip="&#092;foo&#123;&#092;bar&#125;"/>`

# java - 使用 Java 的图像分类算法

> ID：327856
> 
> 赞同：3
> 
> 时间：2008-11-29T19:05:49.943
> 
> 标签：java, algorithm, image, classification

我的目标是实现不同的图像分类方法，以展示它们的功能以及这些方法背后的优缺点。我想尝试使用 Java 实现的包括：

最小距离分类器

k-最近邻分类器。

我想知道什么可以用来完成我在 Java 中已经存在的任务，以便我可以改变算法的运行方式。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-30T11:54:38.863

虽然不完全确定这就是你要找的东西（抱歉，你的问题有点不清楚），如果你想要的是一个库/系统来帮助你完成工作的*分类*部分，那么你可能想看看 Weka ( [http://www.cs.waikato.ac.nz/ml/weka/](http://www.cs.waikato.ac.nz/ml/weka/) )，在我看来是用于数据挖掘实验的最佳 Java 库。

相反，如果您正在寻找允许您分析图像以提取可用于执行分类的特征的算法，您可能希望从 Java 中此类算法的目标描述开始，例如那些在Rafael Santos的在线书籍*Java Image Processing Cookbook中找到的；*这是[“监督图像分类简要教程”部分的直接链接](http://www.lac.inpe.br/JIPCookbook/7020-tutorial-supervisedclassification.jsp)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-01-25T07:00:43.787

您还可以将 RapidMiner 与 IMMI（图像挖掘）扩展一起使用：

[http://www.burgsys.com/mumi-image-mining-community.php](http://www.burgsys.com/mumi-image-mining-community.php)

对于图像分类，您可以使用例如全局特征提取，然后使用一些分类算法（例如人工神经网络）。

# c# - 如何对字符串数组进行排序？

> ID：327857
> 
> 赞同：6
> 
> 时间：2008-11-29T19:07:53.123
> 
> 标签：c#, arrays

我有一个用逗号分隔的输入单词列表。我想按字母和长度对这些单词进行排序。在不使用内置排序功能的情况下如何做到这一点？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-11-29T19:57:10.857

好问题！！作为一个崭露头角的计算机科学家，排序可能是最重要的概念。

实际上有很多不同的算法可以对列表进行排序。

当您分解所有这些算法时，最基本的操作是比较列表中的两个项目，定义它们的“自然顺序”。

例如，为了对整数列表进行排序，我需要一个函数来告诉我，给定任意两个整数 X 和 Y，X 是小于、等于还是大于 Y。

对于您的字符串，您将需要相同的东西：一个函数告诉您哪些字符串具有“较小”或“较大”值，或者它们是否相等。

传统上，这些“比较器”函数看起来像这样：

```
int CompareStrings(String a, String b) {
   if (a < b)
      return -1;
   else if (a > b)
      return 1;
   else
      return 0;
} 
```

我省略了一些细节（比如，你如何计算 a 是否小于或大于 b？线索：遍历字符），但这是任何比较函数的基本框架。如果第一个元素较小，则返回小于零的值，如果第一个元素较大，则返回大于零的值，如果元素具有相等的值，则返回零。

但这与排序有什么关系？

排序路由将为列表中的元素对调用该函数，使用函数的结果来确定如何将项目重新排列到排序列表中。比较函数定义了“自然顺序”，“排序算法”定义了调用和响应比较函数结果的逻辑。

每个算法都像是一个全局策略，用于保证任何输入都会被正确排序。以下是您可能想知道的一些算法：

**冒泡排序：**

遍历列表，调用所有相邻元素对的比较函数。每当您得到大于零的结果（意味着第一个元素大于第二个元素）时，交换两个值。然后继续下一对。当您到达列表末尾时，如果您不必交换任何对，那么恭喜您，列表已排序！如果您必须执行任何交换，请回到开始并重新开始。重复这个过程，直到没有更多的交换。

注意：这通常不是对列表进行排序的一种非常有效的方法，因为在最坏的情况下，它可能需要您扫描整个列表多达 N 次，以获得具有 N 个元素的列表。

***合并排序：***

这是用于对列表进行排序的最流行的分治算法之一。基本思想是，如果您有两个已排序的列表，则很容易合并它们。只需从每个列表的开头开始，并删除具有最小起始值的列表的第一个元素。重复此过程，直到您消耗完两个列表中的所有项目，然后您就完成了！

```
1     4        8     10    
   2     5  7     9
------------ becomes ------------> 
1  2  4  5  7  8  9  10 
```

但是如果你没有两个排序列表怎么办？如果你只有一个列表，并且它的元素是随机排列的怎么办？

这就是归并排序的聪明之处。您可以将任何单个列表分成更小的部分，每个部分都可以是未排序列表、已排序列表或单个元素（如果您对此感兴趣，实际上是一个已排序列表，长度 = 1）。

因此，合并排序算法的第一步是将整个列表划分为越来越小的子列表，在最小的级别（每个列表只有一个或两个元素），它们很容易排序。并且一旦排序，很容易将任意两个相邻的排序列表合并成一个更大的排序列表，其中包含两个子列表的所有元素。

注意：就最坏情况下的效率而言，该算法比上述冒泡排序方法要好得多***。***我不会详细解释（这涉及一些相当琐碎的数学，但需要一些时间来解释），但提高效率的快速原因是该算法将其问题分解为理想大小的块，然后合并这些块的结果。冒泡排序算法一次解决了所有问题，因此它没有得到“分而治之”的好处。

* * *

这只是列表排序的两种算法，但还有许多其他有趣的技术，每种技术都有其优点和缺点：快速排序、基数排序、选择排序、堆排序、壳排序和桶排序。

互联网上充斥着关于排序的有趣信息。这是一个很好的起点：

[http://en.wikipedia.org/wiki/Sorting_algorithms](http://en.wikipedia.org/wiki/Sorting_algorithms)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-29T19:28:11.710

创建一个控制台应用程序并将其粘贴到 Program.cs 作为类的主体。

```
public static void Main(string[] args)
{
    string [] strList = "a,b,c,d,e,f,a,a,b".Split(new [] { ',' }, StringSplitOptions.RemoveEmptyEntries);

    foreach(string s in strList.Sort())
        Console.WriteLine(s);
}

public static string [] Sort(this string [] strList)
{
    return strList.OrderBy(i => i).ToArray();
} 
```

请注意，我确实使用了内置方法，[`OrderBy`](http://msdn.microsoft.com/en-us/library/system.linq.enumerable.orderby.aspx). 正如其他答案指出的那样，您可以在那里实现许多不同的排序算法，我认为我的代码片段可以为您完成所有工作，除了实际的排序算法。

[一些 C# 特定的排序教程](http://www.publicjoe.f9.co.uk/csharp/sort00.html)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-29T19:27:20.277

围绕[排序算法](http://en.wikipedia.org/wiki/Sorting_algorithm)建立了一个完整的研究领域。您可能想选择一个简单的并实施它。

虽然它不会是最高性能的，但实现[冒泡排序](http://en.wikipedia.org/wiki/Bubble_sort)应该不会花费您太长时间。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-29T19:30:25.450

如果您不想使用内置函数，则必须自己创建一个。我会推荐*冒泡排序*或一些类似的算法。冒泡排序不是一种有效的算法，但它可以完成工作，并且易于理解。

[您会在wikipedia](http://en.wikipedia.org/wiki/Sorting_algorithm)上找到很多很好的阅读材料。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-29T19:43:37.577

我建议为快速排序做一个 wiki。

仍然不确定为什么不想使用内置排序？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-29T20:44:37.313

冒泡排序会损害大脑。

插入排序至少易于理解和编码，实际上在实践中很有用（对于非常小的数据集和几乎排序的数据）。它是这样工作的：

假设前 n 个项目已经按顺序排列（您可以从 n = 1 开始，因为显然有一个事情本身就是“按正确顺序”）。

取数组中的第 (n+1) 个项目。将此称为“枢轴”。从第 n 个项目开始并向下处理：
   - 如果它比枢轴大，则将其向右移动一个空间（以在其左侧创建一个“间隙”）。
   - 否则，将其留在原处，将“枢轴”放在其右侧一个空间（即，如果您移动任何东西，则在“间隙”中，或者如果您什么都不移动，则在它开始的地方），然后停止。

现在数组中的前 n+1 项是按顺序排列的，因为枢轴位于比它小的所有元素的右侧，以及比它大的所有元素的左侧。由于您按顺序从 n 个项目开始，这就是进步。

重复，每一步 n 增加 1，直到处理完整个列表。

这对应于一种方式，您可以将一系列文件夹按顺序放入文件柜中：放入；然后将另一个放在正确的位置，将它后面的所有东西推过去一个空间以腾出空间；重复直到完成。从来没有人通过冒泡排序对物理对象进行排序，所以对我来说，为什么它被认为是“简单的”是个谜。

现在剩下的就是你需要能够在给定两个字符串的情况下计算第一个是否大于第二个。我不太清楚“字母和长度”是什么意思：字母顺序是通过一次比较每个字符串中的一个字符来完成的。如果不一样，那是您的订单。如果它们相同，请查看下一个，除非您在其中一个字符串中没有字符，在这种情况下，那是“较小”的那个。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-30T01:33:52.750

**使用 NSort**

几年前，我在[Windows Developer Power Tools](http://www.windevpowertools.com)一书中遇到了[NSort](http://www.projectdistributor.net/Projects/Project.aspx?projectId=108)库。NSort 库实现了许多排序算法。与编写自己的排序相比，使用 NSort 之类的主要优点是已经过测试和优化。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2011-01-17T07:04:01.920

在 C# 中发布指向快速字符串排序代码的链接：

[http://www.codeproject.com/KB/cs/fast_string_sort.aspx](http://www.codeproject.com/KB/cs/fast_string_sort.aspx)

另一点：上面建议的比较器不推荐用于非英语语言：

int CompareStrings(String a, String b) {
if (a < b) return -1;
否则，如果 (a > b)
返回 1；否则
返回 0；}

查看此链接以获取非英语语言排序：

[http://msdn.microsoft.com/en-us/goglobal/bb688122](http://msdn.microsoft.com/en-us/goglobal/bb688122)

如前所述，将 nsort 用于不适合内存的真正巨大的数组。

# database - 是否有任何工具或程序可以为 oracle db 版本生成数据库增量脚本

> ID：327859
> 
> 赞同：-2
> 
> 时间：2008-11-29T19:08:50.907
> 
> 标签：database, release

为 oracle 数据库生成增量发布脚本的任何工具。

像用于 SQLServer 的 Redgate DBComparer。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-29T19:15:11.703

见[这里](https://stackoverflow.com/questions/47366/sql-compare-like-tool-for-oracle)。

其他链接、工具：

[http://www.sqlmanager.net/de/products/oracle/dbcomparer](http://www.sqlmanager.net/de/products/oracle/dbcomparer)

[http://www.sqldelta.com/oraclebeta.html](http://www.sqldelta.com/oraclebeta.html)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-09-07T20:47:18.930

也许对你来说晚了一年，但 Red Gate 现在有一个用于 Oracle 的模式比较工具！

试试[http://www.red-gate.com/products/schema_compare_for_oracle/index.htm](http://www.red-gate.com/products/schema_compare_for_oracle/index.htm)

# ruby-on-rails - Rails 应用程序的共享文件存储

> ID：327867
> 
> 赞同：5
> 
> 时间：2008-11-29T19:12:29.290
> 
> 标签：ruby-on-rails, ruby, linux, network-storage

我有一个接受文件上传的 Rails 应用程序，我想知道在服务器之间进行公共存储的最佳方式。由于我们有许多 Windows 应用程序，我们过去使用过 samba，但是当我们构建纯 linux 应用程序时，我想以最好的方式做到这一点。

我们期望有大量数据，因此需要跨多个文件服务器进行扩展。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-29T19:26:19.327

我使用了带有 S3 后端的[回形针。](http://railscasts.com/episodes/134-paperclip)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-29T20:25:44.213

如果您想在内部拥有所有数据，那么网络文件系统可能是您的选择。尝试设置[AFS](http://en.wikipedia.org/wiki/Andrew_File_System)，它的扩展性非常好。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-29T23:21:55.590

另一个不错的选择来自 Memcached 的创建者：

Mogile FS [http://www.danga.com/mogilefs/](http://www.danga.com/mogilefs/)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-29T19:21:50.863

一种简单的方法是将 attachment_fu 与 S3 后端一起使用。

# .net - 当 X 是可空整数时“如果 X = 无”的 FXCop 规则

> ID：327876
> 
> 赞同：1
> 
> 时间：2008-11-29T19:22:23.157
> 
> 标签：.net, vb.net, fxcop

```
1 Dim x as Integer? = Nothing  
2 If x = Nothing Then  
3     'this is what I think will happen   
4 Else  
5     'this is what really happens   
6 End If 
```

正确的写法是“如果 x 什么都不是”。

是否有 FXCop 规则对此进行检查？或者更好的是，有人可以告诉我如何写我自己的吗？

乔纳森

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-03T18:59:14.417

另一个编写自定义 FxCop 规则的好资源可以在这里找到：[binarycoder](http://www.binarycoder.net/fxcop/index.html)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-01T13:41:16.980

学习为 FXCop 编写自定义规则的最佳选择是[这里](http://social.msdn.microsoft.com/forums/en-US/vstscode/threads/)的论坛它涉及编写自定义程序集来解析代码并检查它。

具体来说，您想编写一条规则，上面写着“不要对可空类型使用 = nothing，而是确保使用 hasvalue。

# delphi - THotkey 支持双赢？

> ID：327880
> 
> 赞同：3
> 
> 时间：2008-11-29T19:24:36.147
> 
> 标签：delphi, hotkeys

有没有办法让delphi中的THotkey组件支持windows键？

或者有人知道可以做到这一点的组件吗？

多谢！

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-29T22:33:06.283

恕我直言，THotKey 不支持这一点是件好事。

不要在程序中使用 windows 键作为键盘快捷键，“Windows Vista 用户体验指南”在[指南 - 交互 - 键盘](http://msdn.microsoft.com/en-us/library/bb545460.aspx)下说明如下：

> 不要将 Windows 徽标修饰键用作程序快捷键。Windows 徽标密钥保留供 Windows 使用。即使 Windows 现在不使用 Windows 徽标组合键，它也可能在将来使用。

即使 Windows 不使用该快捷键，使用这样的键盘快捷键也会让用户感到困惑，因为它会在您的程序中执行一项功能，而其他此类快捷键（如 Win+E 或 Win+R）会激活系统范围的功能，在此过程中停用您的程序。

**编辑：**

THotKey 是围绕系统控件的轻量级包装，仅支持该系统控件支持的内容。除了快捷键的 Alt、Ctrl 和 Shift 修饰符之外，没有记录的方法可以设置任何内容。

您可以创建自己的控件以使用 Windows 键显示快捷方式，并设置全局键盘挂钩（查看*SetWindowsHookEx()* API 函数）。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-29T22:09:38.107

我不知道您是否可以使用 THotkey 组件来做到这一点。

但是您可以使用以下方法在任何 KeyDown 事件中捕获左右 Windows 键：

> if key = vk_LWin then showmessage('left');
> if key = vk_RWin then showmessage('right');

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-05T12:45:37.603

当然有可能——您需要制作自己的 { THotKey } 副本并稍微调整一下以支持 Win 键。您需要将自己的 KeyDown() 和 Repaint() 函数添加到此类。

像这样：

```
 TMyCustomHotKey = class(TWinControl)
  public
      WinKey: boolean;
  procedure WMPaint(var Message: TWMPaint); message WM_PAINT;
    constructor Create(AOwner: TComponent); override;
  end;

  TMyHotKey = class(TMyCustomHotKey) 
```

..

```
 procedure TMyCustomHotKey.KeyDown(Sender: TObject; var Key: Word; Shift: TShiftState);
    var
     a : integer;
     lbl : string;
      tmphot : tshortcut;
    begin

     a:= 0;
      if GetAsyncKeyState(VK_LWIN) <> 0 then  a:= 1;
      if GetAsyncKeyState(VK_RWIN) <> 0 then a:= 1;

     if a=1 then begin
            winkey := true;
      end else
      begin
            winkey := false;
      end;
      rePaint();
}

procedure TMyCustomHotKey.WMPaint(var Message: TWMPaint);
var
  PS: TPaintStruct;
  DC: HDC;
  Canvas: TCanvas;
  i: Integer;
  X, Y: Integer;
  OldColor: TColor;
  Size: TSize;
  Max: Integer;
  s, Palabra, PrevWord: string;
    OldPen, DrawPen: HPEN;
 tmphot : tshortcut;
  Key: Word;
  Shift: TShiftState;

  lbl ,res: string;
 keyboardState: TKeyboardState;
asciiResult: Integer;

begin

  DC := Message.DC;
  if DC = 0 then DC := BeginPaint(Handle, PS);

  Canvas := TCanvas.Create;
  try

     OldColor         := Font.Color;
    Canvas.Handle    := DC;
    Canvas.Font.Name := Font.Name;
    Canvas.Font.Size := Font.Size;
    with Canvas do
    begin

      Brush.Color := Self.Color;
      FillRect(Self.ClientRect);
          Font.Color := OldColor;

       tmphot := gethotkey;
         ShortCutToKey(tmphot, Key, Shift);

          res := GetCharFromVKey(key);

         if (winkey = false) and (key = 0 ) and (tmphot = 0)then
          BEGIN lbl := 'Enter hotkey [CTRL/ALT/WIN] + Key'   ;
          TextOut(1 ,1,lbl)             ;
          END
         else begin

         if winkey then lbl := 'Win +' else lbl := '';
          if ssAlt in Shift then lbl := lbl+ 'Alt + ';
          if ssShift in Shift then lbl := lbl+ 'Shift + ';
          if (not winkey) and (ssCtrl  in Shift) then lbl := lbl+ 'Ctrl + ';
          lbl := lbl+ res;

          end;

          TextOut(1 ,1,lbl);

      end;

  finally
    if Message.DC = 0 then EndPaint(Handle, PS);
  end;
  Canvas.Free;
    SETCARETPOS(1,1);

end; 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-30T09:47:41.537

请参阅MSDN 上的[RegisterHotKey](http://msdn.microsoft.com/en-us/library/ms646309(VS.85).aspx)函数。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-02T19:22:34.840

THotKey 不支持 Win-Key。我会在它旁边添加一个复选框，可能是 Win-Key 修饰符。

# visual-studio - Visual Studio 中的 MRU 列表丢失

> ID：327881
> 
> 赞同：-1
> 
> 时间：2008-11-29T19:24:51.623
> 
> 标签：visual-studio

几个月前，Visual Studio 中的 MRU 列表停止工作。“文件”菜单或起始页都不会显示任何最近打开的项目或解决方案。老实说，我不知道我做了什么导致这种情况，但也许对 VS 的阴暗深处有更多了解的人可能会冒险猜测导致它消失的原因，甚至更好的是，如何找回它？

这是一个非常普通的带有 SP1 的 VS2k8 Team System 安装，在 32 位 XP SP3 机器上运行。

编辑：注册表项 HKCU\Software\Microsoft\VisualStudio\9.0\ProjectMRUList 存在，但为空。该注册表项的权限似乎很正常。我正在运行 VS 的用户对它具有读写访问权限（并且通常具有管理员权限）。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-30T17:22:14.380

您可以从 SysInternals 运行 RegMon / FileMon (ProcessMon) 以确保它访问正确的路径，并且没有权限问题等

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2014-04-07T07:59:32.857

试用最近使用的文件（支持 2010、2012 和 2013），它在每个项目的基础上维护一个 MRU 列表。

Visual Studio 2012、2013： http: [//visualstudiogallery.msdn.microsoft.com/a61cbd1d-b5a2-490b-a6bb-f0ea3ecf214a](http://visualstudiogallery.msdn.microsoft.com/a61cbd1d-b5a2-490b-a6bb-f0ea3ecf214a) Visual Studio 2010：http: [//visualstudiogallery.msdn.microsoft.com/45283881-5a62-4dc1-8ffb -4cbc02709947](http://visualstudiogallery.msdn.microsoft.com/45283881-5a62-4dc1-8ffb-4cbc02709947)

它免费且非常有效地管理您项目的 MRU 列表。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-30T19:59:33.940

如果您已经检查了明显的内容，请原谅我：在工具、选项、环境、常规下有一个设置，您可以在其中设置要在 MRU 列表中显示的项目数。是否有可能以某种方式将其设置为零？

# asp.net-mvc - ASP.NET MVC ActionResult 背后的推理是一个抽象类？

> ID：327885
> 
> 赞同：5
> 
> 时间：2008-11-29T19:25:52.430
> 
> 标签：asp.net-mvc

在[ASP.NET MVC](http://www.asp.net/mvc/)中，`ActionResult`作为控制器操作方法返回的所有结果的基础的类被定义为具有单一方法的抽象类（© Microsoft）：

```
public abstract void ExecuteResult(ControllerContext context); 
```

你能想到这个设计的任何具体原因吗？具体来说，我觉得有点奇怪，

*   没有`IActionResult`界面，
*   如果有这样的接口，则根本不需要该类。

毕竟，如果这是一个接口而不是那个抽象类，就没有必要扩展一个基类来创建一个新的`ActionResult`——只需要`IActionResult`正确地实现。在一个世界上，错误的语言，没有多重继承，这个优势对我来说似乎很重要。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-12-01T19:10:07.500

接口非常适合允许一个类实现多个协定，例如当您知道一个类型必须是两个不同的事物时。在某些情况下，这可能会鼓励创建具有太多职责的类型。

动作结果有一个单一的责任，似乎没有任何场景需要一个对象既是动作结果*又*是其他东西。即使你这样做了，也可以通过合成来完成。因此，在这种情况下，我们选择了 ABS，以便我们在 RTM 之后有更大的灵活性，以便在必要时进行更改。

但是，如果我们阻止了一个特定的场景，其中一个接口更可取，我们会考虑它。我们总是可以在以后以一种不会破坏的方式做到这一点。

您甚至可以通过编写自己的操作调用程序来自己完成，这只需要您实现 IActionInvoker（一个接口）并且该调用程序可以检查您自己的 IActionResult 而不是 ActionResult。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-29T19:59:01.973

我猜是因为他们期待 ActionResult 在 CTP/beta 的整个生命周期内获得方法和属性。如果它是一个接口，那么对 IActionResult 的每次更改都会破坏现有代码。向抽象基类添加另一个方法不会导致任何问题。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-02-28T23:18:16.143

您实现接口并从抽象类继承。
对我来说，这是“成为一个类型”或“表现得像一个类型”之间的区别

由于 C# 不支持多重继承，您被迫将您的类定义为 ActionResult，而不是充当 ActionResult 的东西。

将其与 EventArgs 类进行比较。为什么继承 EventArgs 而不是 IEventArgs 接口有意义。好吧，因为 EventHandler 带有 EventArgs 类型的东西，而不是充当 EventArgs 类的东西。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-02-28T23:32:20.403

我知道这不是您正在寻找的东西，但是为了哈哈，我打开了 MVC3 源代码，将 ActionResult 更改为 IActionResult，运行了几个查找和替换，一切正常。

这对我来说意味着 ActionResult 是一个 API 原因的抽象类。也许就像 MVC 团队希望你能够使用 Fields 或者不想让人们有能力做疯狂的 IActionResult、ISomething、IMyNuttyThing 一样简单。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2012-05-30T15:40:53.047

我认为 IActionResult 会有所帮助的一个场景是依赖注入。我想要一组在 SPA 和剃须刀 UI 之间共享的控制器。在配置中，我想动态设置应用程序类型并拥有我的控制器

```
public ActionResult Get(){
  var customer = new Customer();
  return View(customer);
} 
```

我希望在运行时根据应用程序类型确定具体的 View 方法。IE。Json() 或 ViewResult()

对于这两种情况，我传递给结果的对象将是相同的。

那有意义吗？或者如果没有 IActionResult 这可能吗？

# c - 如何从 stdlib 为 qsort 编写比较函数？

> ID：327893
> 
> 赞同：4
> 
> 时间：2008-11-29T19:30:24.700
> 
> 标签：c, sorting, compare, qsort

我有一个结构：

```
struct pkt_
{
  double x;
  double y;
  double alfa;
  double r_kw;
};

typedef struct pkt_ pkt; 
```

这些结构的表：

```
pkt *tab_pkt;

tab_pkt = malloc(ilosc_pkt * sizeof(pkt)); 
```

我想做的是`tab_pkt`按`tab_pkt.alfa`and排序`tab_pkt.r`：

```
qsort(tab_pkt, ilosc_pkt, sizeof(pkt), porownaj); 
```

哪里 porownaj 是一个比较函数，但是怎么写呢？这是我的“草图”：

```
int porownaj(const void *pkt_a, const void *pkt_b)
{
  if (pkt_a.alfa > pkt_b.alfa && pkt_a.r_kw > pkt_b.r_kw) return 1;
  if (pkt_a.alfa == pkt_b.alfa && pkt_a.r_kw == pkt_b.r_kw) return 0;
  if (pkt_a.alfa < pkt_b.alfa && pkt_a.r_kw < pkt_b.r_kw) return -1;
} 
```

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-11-29T19:54:01.250

像这样的东西应该工作：

```
int porownaj(const void *p_a, const void *p_b)
{
  /* Need to store arguments in appropriate type before using */
  const pkt *pkt_a = p_a;
  const pkt *pkt_b = p_b;

  /* Return 1 or -1 if alfa members are not equal */
  if (pkt_a->alfa > pkt_b->alfa) return 1;
  if (pkt_a->alfa < pkt_b->alfa) return -1;

  /* If alfa members are equal return 1 or -1 if r_kw members not equal */
  if (pkt_a->r_kw > pkt_b->r_kw) return 1;
  if (pkt_a->r_kw < pkt_b->r_kw) return -1;

  /* Return 0 if both members are equal in both structures */
  return 0;
} 
```

远离愚蠢的技巧，例如：

```
return pkt_a->r_kw - pkt_b->r_kw; 
```

它返回未规范化的值，难以阅读，无法正常处理浮点数，有时甚至会出现棘手的极端情况，即使对于整数值也无法正常工作。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-29T19:48:36.740

问题有两个部分 - 如何编写代码，以及如何比较数据包类型。您必须确保始终返回一个值。您的代码也应该始终是这样的：

```
porownaj(&pkt_a, &pkt_b) == -porownaj(&pkt_b, &pkt_a) 
```

您的大纲比较不处理以下情况：

```
pkt_a->alfa >  pkt_b->alfa && pkt_a->r_kw <= pkt_b->r_kw
pkt_a->alfa <  pkt_b->alfa && pkt_a->r_kw >= pkt_b->r_kw
pkt_a->alfa == pkt_b->alfa && pkt_a->r_kw != pkt_b->r_kw 
```

还有一个问题 - 比较浮点值是否适合精确相等？这将取决于您的应用程序。

机械地，您必须将 const void 指针转换为 const 结构指针。我使用显式强制转换 - C++ 需要它，并且我尝试让 C++ 编译器可以接受我的代码，即使它确实是 C 代码。

```
int porownaj(const void *vp1, const void *vp2)
{
     const pkt *pkt_a = (const pkt *)vp1;
     const pkt *pkt_b = (const pkt *)vp2;

     if (pkt_a->alfa >  pkt_b->alfa && pkt_a->r_kw >  pkt_b->r_kw) return 1;
     if (pkt_a->alfa == pkt_b->alfa && pkt_a->r_kw == pkt_b->r_kw) return 0;
     if (pkt_a->alfa <  pkt_b->alfa && pkt_a->r_kw <  pkt_b->r_kw) return -1;
     return 0;
 } 
```

这不涉及我无法解决的问题，因为我不是必要信息的一方。请注意，一般来说，多维对象（例如复数，或 (x,y) 或 (x,y,z) 坐标）不能简单地比较大于、小于或等于。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-29T20:00:27.883

是的，我按 alfa 排序，r_kw 决定 pkt 是否是第一个（我认为第一个值将具有最大（或最小）的 alfa 和 r_kw）。这就是我理解问题的方式，我不是 100% 确定。

# .net - 在不卸载的情况下升级 Windows 服务

> ID：327895
> 
> 赞同：31
> 
> 时间：2008-11-29T19:31:41.857
> 
> 标签：.net, windows-services, windows-installer

目前我必须在安装新版本之前卸载旧版本的服务。我很确定这与它不够聪明，无法在添加新服务条目之前更新或删除旧服务条目有关。

如果服务已经存在，有没有办法让安装程序跳过注册服务？（我可以假设安装文件夹和服务名称在版本之间不会改变。）

另外，有没有办法在卸载时自动停止服务？

* * *

### 编辑：

我正在使用 MSI 包和 Visual Studio 安装项目。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-11-29T23:54:16.087

我已经使用 WiX 完成了此操作，它使用 ServiceInstall 和服务控制命令生成 .MSI 文件：

```
<Component Id='c_WSService' Guid='*'>
    <File Id='f_WSService' Name='WSService.exe' Vital='yes' Source='..\wssvr\release\wsservice.exe' KeyPath="yes" />
    <ServiceInstall Id='WSService.exe' Name='WSService' DisplayName='[product name]' Type='ownProcess'
                    Interactive='no' Start='auto' Vital='yes' ErrorControl='normal'
                    Description='Provides local and remote access to [product name] search facilities.' />
    <ServiceControl Id='WSService.exe' Name='WSService' Start='install' Stop='both' Remove='uninstall' Wait='yes' />
</Component> 
```

这将停止服务，安装新版本并重新启动服务。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-11-29T21:09:57.883

我不使用 Visual Studio 安装项目，所以我可能错了，但它似乎不支持作为 Windows Installer 标准功能的 ServiceInstall 和 ServiceControl 表。这两个表专门用于安装和更新服务....

[Wix](http://wix.sourceforge.net/)确实支持它（[见这个例子](http://www.dalun.com/wix/06.10.2005.htm)），也许你可以创建一个合并模块，并在你的项目中使用它。

否则这可能会有所帮助：[Installing Services with Visual Studio (Phil Wilson)](http://www.installsite.org/pages/en/msi/tips.htm#SvcInstall)

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2008-11-29T21:24:29.103

从命令行使用**sc工具停止和启动服务：**

```
sc stop {name of your service}
sc start {name of your service} 
```

当服务停止时，更新相应的文件，然后重新启动服务。您也应该能够从安装程序中做到这一点。如果您在安装程序中使用[Wix](http://wix.sourceforge.net/index.html)，请查看[ServiceControl](http://wix.sourceforge.net/manual-wix2/wix_xsd_servicecontrol.htm)元素。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-29T19:47:05.960

你不能停止服务，覆盖服务可执行文件，然后重新启动服务吗？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-29T19:59:22.707

您可以制作单独的 DLL，该服务将在每次工作时加载和调用。确保该服务在使用后卸载 DLL。

使用时应将其加载到单独的应用程序域中。

[所以 http://msdn.microsoft.com/en-us/library/c5b8a8f9.aspx](http://msdn.microsoft.com/en-us/library/c5b8a8f9.aspx)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2013-01-11T13:26:03.667

我的 hacky 解决方案是修改`ProjectInstaller.vb`文件，使其发出停止和删除服务的命令，然后暂停一下。从安装的角度来看可能不如修改`msi`文件那么整洁，但对于继承我的代码的人来说更具可读性/逻辑性。

请注意，该`RunCommandCom`位是从[如何从 VB.NET 运行 DOS/CMD/命令提示符命令？](https://stackoverflow.com/questions/10261521)

将此方法与[如何在安装后自动启动服务的代码结合使用？](https://stackoverflow.com/questions/212734)您可以获得所需的服务安装体验 - 一种自动安装和启动的服务，如果有一个当前正在运行的服务，则会覆盖该服务。

```
'This works.  It leaves the MSI in a state that tells you to reboot the PC, but you really don't need to.

Private Sub ProjectInstaller_BeforeInstall(sender As Object, e As System.Configuration.Install.InstallEventArgs) Handles Me.BeforeInstall

    Dim sEchoMessage As String = String.Empty
    sEchoMessage &= " & ECHO ******************       Please be patient      *******************************"
    sEchoMessage &= " & ECHO Pausing to stop and delete the previous version of the following service:"
    sEchoMessage &= " & ECHO " & ServiceInstaller1.ServiceName
    sEchoMessage &= " & ECHO -------------------------------------------------------------------------------"
    sEchoMessage &= " & ECHO After install is complete, you may see a message that says you need to reboot."
    sEchoMessage &= " & ECHO You may IGNORE this message - The service will be installed and running."
    sEchoMessage &= " & ECHO There is NO Reboot required."
    sEchoMessage &= " & ECHO *******************************************************************************"

    RunCommandCom("sc stop " & ServiceInstaller1.ServiceName & " & sc delete " & ServiceInstaller1.ServiceName & sEchoMessage, 15000)

End Sub

Private Sub RunCommandCom(command As String, mSecSleepAfterExecution As Integer)

    Using p As Process = New Process()
        Dim pi As ProcessStartInfo = New ProcessStartInfo()
        pi.Arguments = " /K " + command
        pi.FileName = "cmd.exe"
        p.StartInfo = pi
        p.Start()
        System.Threading.Thread.Sleep(mSecSleepAfterExecution)
        p.CloseMainWindow()
    End Using

End Sub 
```

# python - 如何在pygame中的图片背景上画线

> ID：327896
> 
> 赞同：2
> 
> 时间：2008-11-29T19:31:42.263
> 
> 标签：python, drawing, pygame

我想在 pygame 的表面上画线（任意位置和长度），它本身是从磁盘上的文件加载的图像。

谁能指出我这样做的一些示例代码？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-29T20:59:44.410

这应该可以满足您的要求：

```
# load the image
image = pygame.image.load("some_image.png")

# draw a yellow line on the image
pygame.draw.line(image, (255, 255, 0), (0, 0), (100, 100)) 
```

通常，您不会绘制到原始图像，因为您必须重新加载图像才能取回原始图像（或在开始绘制之前创建它的副本）。也许你真正需要的是更像这样的东西：

```
# initialize pygame and screen
import pygame
pygame.init()
screen = pygame.display.set_mode((720, 576))

# Draw the image to the screen
screen.blit(image, (0, 0))

# Draw a line on top of the image on the screen
pygame.draw.line(screen, (255, 255, 255), (0, 0), (50, 50)) 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-29T19:38:14.777

pygame 中模块 pygame.draw 的帮助：

名称 pygame.draw - 用于绘制形状的 pygame 模块

文件 d:\program files\python25\lib\site-packages\pygame\draw.pyd

函数 aaline(...) pygame.draw.aaline(Surface, color, startpos, endpos, blend=1): return Rect 绘制精细的抗锯齿线

```
aalines(...)
    pygame.draw.aalines(Surface, color, closed, pointlist, blend=1): return Rect

arc(...)
    pygame.draw.arc(Surface, color, Rect, start_angle, stop_angle, width=1): return Rect
    draw a partial section of an ellipse

circle(...)
    pygame.draw.circle(Surface, color, pos, radius, width=0): return Rect
    draw a circle around a point

ellipse(...)
    pygame.draw.ellipse(Surface, color, Rect, width=0): return Rect
    draw a round shape inside a rectangle

line(...)
    pygame.draw.line(Surface, color, start_pos, end_pos, width=1): return Rect
    draw a straight line segment

lines(...)
    pygame.draw.lines(Surface, color, closed, pointlist, width=1): return Rect
    draw multiple contiguous line segments

polygon(...)
    pygame.draw.polygon(Surface, color, pointlist, width=0): return Rect
    draw a shape with any number of sides

rect(...)
    pygame.draw.rect(Surface, color, Rect, width=0): return Rect
    draw a rectangle shape 
```

# apache - 从 Apache 迁移到 lighttpd 将获得哪些性能改进？

> ID：327899
> 
> 赞同：2
> 
> 时间：2008-11-29T19:32:31.280
> 
> 标签：apache, lighttpd

我目前有一个由 4 个 Apache Web 服务器组成的集群，用于提供最大为 30Mb 的静态文件。一般来说，我可以预计到这些服务器的并发连接数最多为 5000 个。通过将其移至 lighttpd，我期望获得什么性能改进？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-29T19:46:15.713

我希望它能够更轻松地处理并发性并减少内存开销。我已经停止在几乎所有可以部署的地方部署 Apache。

您也可以考虑使用 nginx 进行比较。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-29T20:10:36.787

如果您将[Apache 与 MPM](http://httpd.apache.org/docs/2.2/mpm.html)与 worker 或事件一起使用，您可能不会看到太大的区别。如果您还没有开始使用它们，我会尝试一下。不过，lighttpd 也没有任何问题。我认为今天只是选择一个并使用它的问题。

如果我在哪里提供这种类型的文件，我会将其推送到 CDN，而不必担心。现在有很多便宜的，比如[CacheFly](http://www.cachefly.com/)和[亚马逊的 Cloudfront](http://aws.amazon.com/cloudfront/)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-11-15T09:08:00.053

从我的头顶：

1.  更小的内存占用
2.  更快的文件读取

一定要在他们的网站上查看基准，他们提供了很多关于这个主题的信息：[http ://www.lighttpd.net/benchmark](http://www.lighttpd.net/benchmark)

# user-interface - 帮我找到这个用例故事

> ID：327902
> 
> 赞同：1
> 
> 时间：2008-11-29T19:33:19.467
> 
> 标签：user-interface, crud, use-case

我记得几年前读过一本关于用例的方法书。（这可能是在用户故事取代这部分术语之前。）

手头的任务类似于添加新客户。

大约有一个 1 页的偏移部分描述了几个开发人员，他们说“我们不需要任何臭名昭著的用例。我们一直这样做。不会超过几个小时。”

第二天，他们带着你经典的 CRUD 类型的表维护屏幕回来了——因此与从一个好的用例开发的 UI 相比，它们被咀嚼了。

有人认出这个吗？它在当时给人留下了深刻的印象，它仍然是一个很好的警示故事。我想再次找到它。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-29T20:27:36.660

我不确定，但这听起来有点像艾伦·库珀（Alan Cooper）**的 The Inmates Are Running the Asylum中的内容。**

# c# - 使用双精度，返回字符串

> ID：327904
> 
> 赞同：0
> 
> 时间：2008-11-29T19:34:24.177
> 
> 标签：c#, arrays, string, double

在我正在编写的应用程序中，其中一种方法允许将用户输入的数字转换为字母。

例如，用户将输入成绩（作为双打），程序将决定（当满足条件时）返回与数字相关联的字母。最初，我是这样写的：

```
public void GetGrade(double scores)
Console.Write("Score of {0} earns: ", score);

if (score >= 95.0)
    Console.WriteLine("A+");
else if (score >= 90.0)
    Console.WriteLine("A");
else if (score >= 85.0)
    Console.WriteLine("B+");
else if (score >= 80.0)
    Console.WriteLine("B");
else if (score >= 75.0)
    Console.WriteLine("C+");
else if (score >= 70.0)
    Console.WriteLine("C");
else if (score >= 65.0)
    Console.WriteLine("D+");
else if (score >= 60.0)
    Console.WriteLine("D");
else
    Console.WriteLine("F"); 
```

但在编写时需要考虑到 RETURN。所以，我认为它应该是公共字符串`GetGrade(double scores)` 而且因为它在一个数组中，我需要：

```
foreach(double score in scoress)
{
THE CODE I POSTED ABOVE
} 
```

除了我会把所有的`console.writeline`s 都改回来。但是，当我这样做时，我收到一个语法错误，告诉我：

> 不能在此范围内声明名为 score 的局部变量，因为它会给'score' 赋予不同的含义，'score' 已在父范围或当前范围中用于表示其他内容。

所以，我收集到我不能使用`score`，因为标题已经包含`score`. 我该如何让它按照我想要的方式工作？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-29T19:48:02.653

你的问题令人困惑。

> 而且因为它在一个数组中......

但是您的示例均不包含数组。您的方法可以正常工作

```
public string ToGrade(double score)
{
  if (score >= 95.0)
        return "A+";
    else if (score >= 90.0)
        return "A";
  /* snip */
    else
        return "YOU GET NOTHING!  YOU LOSE!  GOOD DAY SIR!";
} 
```

在我看来，您的方法不是问题，而是您调用它的代码才是问题所在。您必须发布该内容才能获得问题的正确答案。

如果你得到一个“等级”数组并将它们转换成一堆字母等级，你必须有一个数组来存储字母等级。像这样的东西可能是你需要的：

```
public static string[] ToGrade(double[] grades)
{
  // sanity checks go here
  string[] result = new string[grades.Length];
  for(int i = 0; i < grades.Length; i++)
    result[i] = ToGrade(grades[i]);
  return result;
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-29T19:51:36.250

尝试更改 for 循环中的变量名称。

```
Foreach (double s in scores){...} 
```

我假设`scores`是一个双打数组。这个对吗？

如果你从一个数组返回，你只会得到第一个分数的成绩......也许你应该返回一个相关的成绩集合。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-29T19:55:33.887

```
var list = [
    [95.0, "A+"],
    [90.0, "A"],
    [85.0, "B+"],
    [80.0, "B"],
    [75.0, "C+"],
    [70.0, "C"],
    [65.0, "D+"],
    [60.0, "D"]
];

 for (var i in list)
    if (score >= list[0])
        return list[1];
 return "F"; 
```

# c# - 登录后的FormsAuthentication

> ID：327913
> 
> 赞同：0
> 
> 时间：2008-11-29T19:42:03.677
> 
> 标签：c#, asp.net, asp.net-mvc

好的，我有简单的场景：

有两个页面：登录和欢迎页面。我将 FormsAuthentication 与我自己的表一起使用，该表有四列：ID、用户名、密码、全名

当按下登录时，我将我的用户名设置为：

```
FormsAuthentication.SetAuthCookie(userName, rememberMe ?? false); 
```

在我无法使用的欢迎页面上：

```
Page.User.Identity.Name 
```

向用户提供当前登录的用户，但我不像[http://asp.net](http://asp.net)网站中的所有示例那样使用用户名，我想使用 FullName 字段

我认为当页面加载它的疯狂并且不喜欢用户会话或简单 Cookie 时，总是去 db 并请求全名，也许 FormsAuth 提供者对此有自定义字段

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-29T20:33:54.760

表单身份验证使用 cookie 工作。您可以构建自己的身份验证 cookie 并将全名放入其中，但我想我会将其放入会话中。如果您使用任何类型的 cookie，则每次都需要从中提取名称。将其绑定到会话似乎更自然，并且使您可以轻松访问。我同意每次返回数据库似乎是一种浪费，我肯定会在某处缓存该值。

可以在[此处](http://msdn.microsoft.com/en-us/library/aa480476.aspx)找到有关构建您自己的表单身份验证 cookie 的信息。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-30T00:47:02.783

在您调用 FormsAuth 后，我会将用户的全名存储在会话 cookie 中

```
FormsAuth.SetAuthCookie(userName, rememberme);

// get the full name (ex "John Doe") from the datbase here during login
string fullName = "John Doe";

Response.Cookies["FullName"].Value = fullName;
Response.Cookies["FullName"].expires = DateTime.Now.AddDays(30); 
```

然后通过以下方式在您的视图页面中检索它：

```
string fullName = HttpContext.Current.Request.Cookies["FullName"].Value 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2019-05-17T15:30:35.137

抱歉，我参加聚会有点晚了，但是您可以这样做，而无需将值存储在其他任何地方:)

```
var authCookieKey = FormsAuthentication.FormsCookieName;
var responseCookies = HttpContext.Current.Response.Cookies;
var requestCookies = HttpContext.Current.Request.Cookies;

var aspxAuthCookieInResponse = responseCookies.AllKeys.Contains(authCookieKey) ? responseCookies[authCookieKey] : null;
var aspxAuthCookieInRequest = requestCookies.AllKeys.Contains(authCookieKey) ? requestCookies[authCookieKey] : null;

// Take ASPXAUTH cookie from either response or request.
var cookie = aspxAuthCookieInResponse ?? aspxAuthCookieInRequest;
var authTicket = FormsAuthentication.Decrypt(cookie.Value); // Todo: Check for nulls.

// Using the name!
var userName = authTicket.Name; 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-29T20:57:43.790

表单身份验证没有自定义字段。你只需要使用会话。这就是你知道的。;) 只是不要忘记 - 表单身份验证 cookie 和会话是两个独立的东西。他们甚至每个人都有自己的超时时间。因此，除非您自己这样做，否则用户注销时不会重置会话。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-10-23T08:46:57.227

使用配置文件来存储用户的额外信息怎么样？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-10-23T09:04:00.453

最简单的选择是使用会话。默认情况下，会话状态存储在内存中，并且会在 ASP.NET 工作进程回收时丢失，但是您可以将其配置为使用状态服务，它将会话信息保留在单独的进程中：

[http://msdn.microsoft.com/en-us/library/ms178586.aspx](http://msdn.microsoft.com/en-us/library/ms178586.aspx)

另一种选择是使用配置文件。听起来您已经在自己的表中存储了“配置文件”信息，因此您可能必须为其编写自定义提供程序，因此它是一个更复杂的解决方案。

# c# - C# 中的 Redim Preserve？

> ID：327916
> 
> 赞同：37
> 
> 时间：2008-11-29T19:44:14.533
> 
> 标签：c#, arrays

今天我震惊地发现 C# 不支持动态大小的数组。那么，一个习惯使用[ReDim Preserve的](http://msdn.microsoft.com/en-us/library/w8k3cys2.aspx)[VB.NET](http://en.wikipedia.org/wiki/Visual_Basic_.NET)开发人员如何在 C# 中处理这个问题呢？

在函数的开头，我不确定数组的上限。这取决于从数据库返回的行。

* * *

## 回答 #1

> 赞同：79
> 
> 时间：2008-11-29T20:12:07.237

VB.NET 也没有动态大小数组的想法——CLR 不支持它。

“Redim Preserve”的等价物是[`Array.Resize<T>`](http://msdn.microsoft.com/en-us/library/bb348051.aspx)- 但您*必须*注意，如果有其他对原始数组的引用，它们根本不会被更改。例如：

```
using System;

class Foo
{
    static void Main()
    {
        string[] x = new string[10];
        string[] y = x;

        Array.Resize(ref x, 20);
        Console.WriteLine(x.Length); // Prints out 20
        Console.WriteLine(y.Length); // Still prints out 10
    }
} 
```

证明这相当于 Redim Preserve：

```
Imports System

Class Foo
    Shared Sub Main()
        Dim x(9) as String
        Dim y as String() = x

        Redim Preserve x(19)
        Console.WriteLine(x.Length)
        Console.WriteLine(y.Length)
    End Sub
End Class 
```

这两个程序是等价的。

如果你真的想要一个动态大小的集合，你应该使用`List<T>`（或类似的东西）。直接使用数组存在各种问题 - 有关详细信息，请参阅[Eric Lippert 的博客文章](http://blogs.msdn.com/ericlippert/archive/2008/09/22/arrays-considered-somewhat-harmful.aspx)。这并不是说无论如何你都应该避免它们——但你需要知道你在处理什么。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-11-29T19:47:56.177

改用 ArrayLists 或泛型

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2008-11-29T19:46:16.603

使用列表<T>。它将根据需要动态调整大小。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-11-29T19:58:33.613

你真的不应该使用 ReDim，它可能非常昂贵。我更喜欢 List(Of T)，但是这方面有很多选择。

也就是说，你有一个问题，这是你的答案。

```
x = (int[]) Utils.CopyArray((Array) x, new int[10]); 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2012-11-18T03:42:03.370

我不禁注意到，以上答案*都没有*接近多维数组的概念。话虽如此，这里有一个例子。有问题的数组预定义为`x`。

```
int[,] temp = new int[newRows, newCols];
int minRows = Math.Min(newRows, x.GetUpperBound(0) + 1);
int minCols = Math.Min(newCols, x.GetUpperBound(1) + 1);
for (int i = 0; i < minRows ; ++i)
     for (int j = 0; j < minCols; ++j)
         temp[i, j] = x[i, j];
x = temp; 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2013-12-18T18:28:16.280

只是为了好玩，这是使用泛型来重新调整/扩展一维数组的一种方法（再添加一个“行”）：

```
static T[] Redim<T>(T[] arr, bool preserved)
{
    int arrLength = arr.Length;
    T[] arrRedimed = new T[arrLength + 1];
    if (preserved)
    {
        for (int i = 0; i < arrLength; i++)
        {
            arrRedimed[i] = arr[i];
        }
    }
    return arrRedimed;
} 
```

还有一个添加 n 行（尽管这不会阻止用户减小数组的大小，这将在 for 循环中引发错误）：

```
static T[] Redim<T>(T[] arr, bool preserved, int nbRows)
{
    T[] arrRedimed = new T[nbRows];
    if (preserved)
    {
        for (int i = 0; i < arr.Length; i++)
        {
            arrRedimed[i] = arr[i];
        }
    }
    return arrRedimed;
} 
```

我相信你明白了。

对于多维数组（二维），这是一种可能性：

```
static T[,] Redim<T>(T[,] arr, bool preserved)
{
    int Ubound0 = arr.GetUpperBound(0);
    int Ubound1 = arr.GetUpperBound(1);
    T[,] arrRedimed = new T[Ubound0 + 1, Ubound1];
    if (preserved)
    {
        for (int j = 0; j < Ubound1; j++)
        {
            for (int i = 0; i < Ubound0; i++)
            {
                arrRedimed[i, j] = arr[i, j];
            }
        }
    }
    return arrRedimed;
} 
```

在您的程序中，无论是否使用指定的类型，编译器都会识别它：

```
int[] myArr = new int[10];
myArr = Redim<int>(myArr, true); 
```

或者

```
int[] myArr = new int[10];
myArr = Redim(myArr, true); 
```

不确定这一切是否真的相关。=D 请随时纠正我或改进我的代码。;)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2015-11-12T06:33:35.020

即使很久以前它可能会帮助寻找简单解决方案的人 - 我在另一个论坛中发现了一些很棒的东西：

```
//from Applied Microsoft.NET framework Programming - Jeffrey Richter
public static Array RedimPreserve(Array origArray, Int32 desiredSize)
        {
            System.Type t = origArray.GetType().GetElementType();
            Array newArray = Array.CreateInstance(t, desiredSize);
            Array.Copy(origArray, 0, newArray, 0, Math.Min(origArray.Length, desiredSize));
            return newArray;
        } 
```

资料来源：[https ://social.msdn.microsoft.com/Forums/en-US/6759816b-d525-4752-a3c8-9eb5f4a5b194/redim-in-c?forum=csharplanguage](https://social.msdn.microsoft.com/Forums/en-US/6759816b-d525-4752-a3c8-9eb5f4a5b194/redim-in-c?forum=csharplanguage)

# css - 在 CSS 中，anchor 是唯一支持伪样式属性的元素吗？

> ID：327933
> 
> 赞同：1
> 
> 时间：2008-11-29T19:56:04.163
> 
> 标签：css

我正在考虑使用这些样式在数据网格中实现更轻松的单元格翻转效果，但我似乎无法让这些样式在除了最基本的标签之外的任何东西上工作。

锚标记是`<a>`HTML 中唯一支持悬停、活动、访问等样式的元素吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-29T19:58:37.343

它应该适用于所有元素，但 IE6 仅支持链接。我使用[whatever:hover](http://www.xs4all.nl/~peterned/csshover.html)来解决这个问题。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-29T20:00:12.940

现代浏览器支持所有元素的伪样式属性，IE6 是当前唯一不支持的广泛使用的浏览器（并且仅适用于 :hover 属性）。

不幸的是，在 IE6 使用率降至最低水平之前，您应该避免在非锚元素上使用 :hover 属性以获得更好的跨浏览器支持。或者，您可以使用 javascript（带有浏览器检测）或[CSS 表达式](http://lawrence.ecorp.net/inet/samples/css-ie-hover1.shtml)为其提供 IE6 支持。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-29T20:06:19.887

根据[CSS2 规范](http://www.w3.org/TR/CSS2/selector.html#dynamic-pseudo-classes)：

> CSS 没有定义哪些元素可能处于上述状态 [:hover、:active 和 :focus]，或者状态如何进入和离开。

换句话说，根本不要依赖他们的工作。我会使用 Javascript 和 CSS 来获得更广泛的受众。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-30T05:35:15.773

PPK 在此处对浏览器兼容性有很好的参考：[http ://www.quirksmode.org/css/contents.html#t16](http://www.quirksmode.org/css/contents.html#t16)

它显示了正确支持 :hover 伪类（以及许多其他 css 选择器）的浏览器。

* * *

## 回答 #5

> 赞同：-2
> 
> 时间：2008-11-29T20:00:46.823

是的，不幸的是，锚是唯一支持这些样式的标签。

我会推荐以下内容：在编写任何自己的 JS 代码之前，请尝试使用 JQuery 框架，它可能会为您节省大量工作。

另一个疯狂的解决方法是将使用样式的大小扩展到父（单元格）的 100%，这样您就可以有效地将样式应用于单元格。

# networking - 将某个端口上的所有请求转发到网络上的另一台机器的最佳方法是什么？

> ID：327952
> 
> 赞同：0
> 
> 时间：2008-11-29T20:06:22.210
> 
> 标签：networking, tcp, dns, port, iptables

我有两台专用服务器，没有硬件防火墙。我想转发通过端口 1008 进入主服务器的所有请求，以由同一网络上的另一台专用服务器完成。我知道我需要设置某种 TCP 代理，但我昨天第一次听说 IPTables。有什么快速提示吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-29T21:20:52.043

最简单的方法是使用只是 TCP 代理的东西。使用 iptables 可以实现这一点，但并不容易。

从 A 向 B 转发请求很容易（使用 DNAT），但很难让 C 的响应通过 B 返回 A（因为 DNAT 不会更改发件人地址）。然后 A 会忽略响应，因为它们来自 C 而不是 B。

本质上，这样做的方法是将 B 设置为 C 的默认网关，并使用转发，但是，这会在 B 中增加一个故障点；如果 B 发生故障，C 的出站流量（包括对直接发送给 C 的请求的响应）最终将进入黑洞。

我认为使用 IPtables 可以没有这种路由技巧，但是您需要具有相同的 SNAT'd 和 DNAT'd 连接，这充其量是棘手的。

通常在这种情况下，大多数人将另一台主机（防火墙）放在两台机器前面并让它做出 DNAT 决策 - 当然这也会引入故障点，这就是为什么在关键设置中，防火墙通常具有冗余备份（它的配置是同步的，有时它的连接跟踪表是同步的）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-29T20:15:32.737

首先，我建议您安装防火墙。我使用[Shorewall](http://www.shorewall.net/)管理 iptables 已经很长时间了，而且它很容易配置。其次，如果您使用诸如 Shorewall 之类的东西，则有[关于如何进行 DNAT（端口转发）的简单指南](http://www.shorewall.net/two-interface.htm#DNAT)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-01T11:49:18.653

Carson 是对的：在服务器和客户端之间放置一个桥接防火墙。然后，防火墙（IP 表）可以将流量重定向到不同的端口和不同的机器。

由于防火墙是一个网桥，您不必更改网络设置，但必须为网桥接口分配一个 IP 地址，用于每个网络客户端和服务器所在的 IP 地址。否则重定向将不起作用。

警告：最初指向连接的机器必须在线（意味着：它的 IP 地址必须在使用中），否则重定向将不起作用。

如果重定向是作为高可用性故障转移的一种手段，我会考虑使用负载平衡器（集群）而不是防火墙，这会导致 linux 虚拟服务器（用于一般方法）或负载平衡器软件，如 Apache（使用 mod proxy_balancer）、balance 或 pount（如果只需要平衡 http 请求）。还有像 f5 这样的硬件设备用于负载平衡。

# oop - 函数式编程会取代 GoF 设计模式吗？

> ID：327955
> 
> 赞同：1106
> 
> 时间：2008-11-29T20:08:46.620
> 
> 标签：oop, design-patterns, functional-programming

自从我去年开始学习[F#](http://en.wikipedia.org/wiki/F_Sharp_%28programming_language%29)和[OCaml](http://en.wikipedia.org/wiki/Objective_Caml)以来，我已经阅读了大量文章，这些文章坚持认为设计模式（尤其是在 Java 中）是命令式语言中缺少的功能的解决方法。我发现的一篇文章[提出了相当强烈的主张](http://www.defmacro.org/ramblings/fp.html)：

> 我遇到的大多数人都读过 四人帮 (GoF)[的设计模式一书。](http://en.wikipedia.org/wiki/Design_Patterns)任何有自尊的程序员都会告诉你，这本书与语言无关，而且这些模式通常适用于软件工程，无论你使用哪种语言。这是一个崇高的主张。不幸的是，它与事实相去甚远。
> 
> 函数式语言极具表现力。**在函数式语言中，不需要设计模式，因为该语言可能非常高级，您最终会以完全消除设计模式的概念进行编程。**

函数式编程 (FP) 的主要特征包括作为一等值的函数、currying、不可变值等。对我来说，OO 设计模式似乎并不明显接近这些特征中的任何一个。

此外，在支持 OOP 的函数式语言（例如 F# 和 OCaml）中，对我来说，使用这些语言的程序员显然会使用与所有其他 OOP 语言相同的设计模式。事实上，现在我每天都在使用 F# 和 OCaml，我在这些语言中使用的模式与我在 Java 中使用的模式之间没有显着差异。

函数式编程消除了对 OOP 设计模式的需求的说法有道理吗？如果是这样，您能否发布或链接到典型 OOP 设计模式及其等效功能的示例？

* * *

## 回答 #1

> 赞同：1133
> 
> 时间：2008-11-29T23:06:35.450

您引用的博客文章夸大了它的主张。FP 并没有*消除*对设计模式的需求。术语“设计模式”并未广泛用于描述 FP 语言中的相同事物。但它们存在。函数式语言有很多最佳实践规则，例如“当你遇到问题 X 时，使用看起来像 Y 的代码”，这基本上就是设计模式。

然而，大多数 OOP 特定的设计模式在函数式语言中几乎无关紧要，这是正确的。

我认为说设计模式*通常*只是为了弥补语言中的缺点而存在，这应该不是特别有争议的。如果另一种语言可以简单地解决同样的问题，那另一种语言就不需要设计模式了。该语言的用户甚至可能不知道*存在*问题，因为，好吧，这不是该语言的问题。

以下是四人帮对这个问题的看法：

> 编程语言的选择很重要，因为它会影响一个人的观点。我们的模式假设 Smalltalk/C++ 级别的语言特性，而这种选择决定了哪些可以轻松实现，哪些不能轻松实现。如果我们假设是过程语言，我们可能已经包含了称为“继承”、“封装”和“多态”的设计模式。类似地，我们的一些模式直接由不太常见的面向对象语言支持。例如，CLOS 有多种方法，可以减少对诸如访问者之类的模式的需求。事实上，Smalltalk 和 C++ 之间存在足够多的差异，这意味着某些模式可以用一种语言比另一种更容易表达。（例如，参见迭代器。）

（以上引自《设计模式简介》一书，第 4 页，第 3 段）

> 函数式编程的主要特征包括函数作为一等值、currying、不可变值等。对我来说，OO 设计模式似乎并不明显接近这些特征中的任何一个。

如果不是一流函数的近似，命令模式是什么？:) 在 FP 语言中，您只需将一个函数作为参数传递给另一个函数。在 OOP 语言中，您必须将函数包装在一个类中，您可以实例化该类，然后将该对象传递给另一个函数。效果是一样的，但是在 OOP 中它被称为设计模式，它需要更多的代码。如果不是柯里化，那么抽象工厂模式是什么？一次将参数传递给函数，以配置最终调用它时它吐出什么样的值。

所以是的，一些 GoF 设计模式在 FP 语言中显得多余，因为存在更强大和更易于使用的替代方案。

但是当然还有一些设计模式是FP 语言无法解决的*。*单例的 FP 等价物是多少？（暂时忽略单例通常是一种糟糕的使用模式。）

它也适用于两种方式。正如我所说，FP 也有它的设计模式。人们只是通常不这么认为。

但是你可能遇到过单子。如果不是“处理全局状态”的设计模式，它们是什么？这是一个在 OOP 语言中非常简单的问题，以至于那里不存在等效的设计模式。

我们不需要“增加静态变量”或“从该套接字读取”的设计模式，因为这正是您*所做*的。

说 monad 是一种设计模式，就像说 Integers 及其通常的操作和零元素是一种设计模式一样荒谬。不，monad 是一种**数学模式**，而不是设计模式。

在（纯）函数式语言中，副作用和可变状态是不可能的，除非您使用 monad“设计模式”或任何其他允许相同事物的方法来解决它。

> 此外，在支持 OOP 的函数式语言（例如 F# 和 OCaml）中，对我来说，使用这些语言的程序员显然会使用与所有其他 OOP 语言相同的设计模式。事实上，现在我每天都在使用 F# 和 OCaml，我在这些语言中使用的模式与我在 Java 中使用的模式之间没有显着差异。

也许是因为你仍然在思考？很多人在一生都在处理命令式语言之后，在尝试使用函数式语言时很难放弃这种习惯。（我在 F# 上看到过一些非常有趣的尝试，实际上*每个*函数都只是一串“let”语句，基本上就像您使用了一个 C 程序，并用“let”替换了所有分号。:)）

但另一种可能性可能是您还没有意识到您正在解决琐碎的问题，这需要 OOP 语言中的设计模式。

当你使用柯里化，或者将一个函数作为参数传递给另一个函数时，停下来想想你会如何在 OOP 语言中做到这一点。

> 函数式编程消除了对 OOP 设计模式的需求的说法有道理吗？

是的。:) 当您使用 FP 语言工作时，您不再需要特定于 OOP 的设计模式。但是您仍然需要一些通用设计模式，例如 MVC 或其他非 OOP 特定的东西，并且您需要一些新的 FP 特定的“设计模式”。所有语言都有其缺点，设计模式通常是我们解决它们的方法。

无论如何，你可能会发现尝试“更干净”的 FP 语言很有趣，比如[ML](https://en.wikipedia.org/wiki/ML_(programming_language))（我个人最喜欢，至少出于学习目的）或[Haskell](http://en.wikipedia.org/wiki/Haskell_%28programming_language%29)，当你没有 OOP 拐杖可以依靠时'面临着新的事物。

* * *

正如所料，一些人反对我将设计模式定义为“修补语言中的缺点”，所以这是我的理由：

如前所述，大多数设计模式都特定于一种编程范式，有时甚至是一种特定的语言。通常，它们解决仅存*在于*该范式中的问题（参见 FP 的 monad，或 OOP 的抽象工厂）。

为什么 FP 中不存在抽象工厂模式？因为它试图解决的问题在那里不存在。

因此，如果 OOP 语言中存在问题，而 FP 语言中不存在问题，那么显然这是 OOP 语言的缺点。问题可以解决，但您的语言并没有这样做，而是需要您提供一堆样板代码来解决它。理想情况下，我们希望我们的编程语言能够神奇地解决*所有*问题。原则上仍然存在的任何问题都是语言的缺点。;)

* * *

## 回答 #2

> 赞同：159
> 
> 时间：2008-11-29T20:15:35.280

> 函数式编程消除了对 OOP 设计模式的需求的说法有道理吗？

函数式编程与面向对象编程不同。面向对象的设计模式不适用于函数式编程。相反，您拥有函数式编程设计模式。

对于函数式编程，您不会阅读 OO 设计模式书籍；您将阅读其他有关 FP 设计模式的书籍。

> 语言不可知论者

不完全。仅与 OO 语言无关。设计模式根本不适用于过程语言。它们在关系数据库设计环境中几乎没有意义。它们在设计电子表格时不适用。

> 典型的 OOP 设计模式及其功能等价物？

以上不应该存在。这就像要求将一段程序代码重写为 OO 代码一样。嗯...如果我将原始的 Fortran（或 C）翻译成 Java，我除了翻译它什么也没做。如果我将它完全重写为 OO 范式，它将不再看起来像原始的 Fortran 或 C ——它将无法识别。

从 OO 设计到功能设计没有简单的映射。他们看待问题的方式非常不同。

函数式编程（与*所有*编程风格一样）具有设计模式。关系数据库有设计模式，OO 有设计模式，过程编程有设计模式。一切都有设计模式，甚至建筑物的架构。

设计模式——作为一个概念——是一种永恒的构建方式，与技术或问题领域无关。但是，特定的设计模式适用于特定的问题域和技术。

每个思考自己在做什么的人都会发现设计模式。

* * *

## 回答 #3

> 赞同：49
> 
> 时间：2009-01-01T20:59:55.527

布赖恩对语言和模式之间紧密联系的评论很中肯，

这个讨论中缺少的部分是成语的概念。James O. Coplien 的书“Advanced C++”在这里产生了巨大的影响。早在他发现 Christopher Alexander 和*无名专栏*之前（如果不阅读 Alexander，您也无法明智地谈论模式），他就谈到了掌握成语对于真正学习语言的重要性。他以 C 语言中的字符串复制为例，`while(*from++ = *to++);`您可以将其视为缺失语言特性（或库特性）的创可贴，但真正重要的是它是一个比任何其他语言都更大的思想或表达单元它的部分。

这就是模式和语言试图做的事情，让我们更简洁地表达我们的意图。思想单位越丰富，你能表达的思想就越复杂。拥有一个范围广泛的丰富的、共享的词汇表——从系统架构到小游戏——让我们能够进行更智能的对话，并思考我们应该做什么。

作为个人，我们也可以学习。这是整个练习的重点。我们每个人都可以理解和使用我们永远无法想到的东西。语言、框架、库、模式、习语等都在分享知识财富方面占有一席之地。

* * *

## 回答 #4

> 赞同：46
> 
> 时间：2009-11-24T15:49:21.227

GoF 书明确地将自身与 OOP 联系在一起——标题是 Design Patterns - Elements of Reusable *Object-Oriented* Software（重点是我的）。

* * *

## 回答 #5

> 赞同：34
> 
> 时间：2008-11-29T20:23:43.470

Peter Norvig[的动态编程中的设计模式对这个一般主题进行了深思熟虑的报道，尽管是关于“动态”语言而不是“功能”语言（有重叠）。](http://norvig.com/design-patterns/)

* * *

## 回答 #6

> 赞同：26
> 
> 时间：2012-10-19T08:15:59.750

这是另一个链接，讨论这个话题：[http ://blog.ezyang.com/2010/05/design-patterns-in-haskel/](http://blog.ezyang.com/2010/05/design-patterns-in-haskel/)

在他的博文中，Edward 用 Haskell 描述了所有 23 种原始 GoF 模式。

* * *

## 回答 #7

> 赞同：22
> 
> 时间：2008-11-29T23:15:45.090

当您尝试在“设计模式”（一般而言）和“FP 与 OOP”的级别上看待这个问题时，您会找到的答案充其量是模糊的。

不过，在这两个轴上更深入，并考虑*特定的设计模式*和*特定的语言特性*，事情就会变得更加清晰。

因此，例如，当使用具有**代数数据类型和模式匹配**、**闭包**、**一等函数**等的语言时，某些特定模式，如**Visitor**、**Strategy**、**Command**和**Observer**肯定会改变或消失。GoF 书中的一些其他模式仍然不过，“坚持”。

 ******一般来说，我会说，随着时间的推移，特定的模式正在被新的（或只是越来越流行的）语言特性所消除。这是语言设计的自然过程；随着语言变得更加高级，以前只能在书中使用示例调用的抽象现在成为特定语言功能或库的应用程序。

（除此之外：这是我[最近](http://lorgonblog.spaces.live.com/blog/cns!701679AD17B6D310!511.entry)写的一篇博客，其中包含更多关于 FP 和设计模式的讨论的其他链接。）

* * *

## 回答 #8

> 赞同：17
> 
> 时间：2008-12-16T19:44:06.413

我想说的是，当您拥有像 Lisp 这样支持宏的语言时，您可以构建自己的特定领域抽象，这些抽象通常比一般的成语解决方案要好得多。

* * *

## 回答 #9

> 赞同：16
> 
> 时间：2008-11-30T07:11:50.557

Norvig 的演讲暗示了他们对所有 GoF 模式所做的分析，他们说 23 种模式中有 16 种在函数式语言中具有更简单的实现，或者只是语言的一部分。所以大概至少有七个是a）同样复杂或b）不存在于语言中。对我们来说不幸的是，它们没有被列举出来！

我认为很明显，GoF 中的大多数“创建”或“结构”模式只是让 Java 或 C++ 中的原始类型系统执行您想要的操作的技巧。但是不管你用什么语言编程，其余的都值得考虑。

一个可能是原型；虽然它是 JavaScript 的一个基本概念，但它必须在其他语言中从头开始实现。

我最喜欢的模式之一是 Null Object 模式：将某物的缺失表示为一个不做任何适当类型的对象。这可能更容易用函数式语言建模。然而，真正的成就是视角的转变。

* * *

## 回答 #10

> 赞同：9
> 
> 时间：2008-11-30T18:02:04.097

甚至 OO 设计模式解决方案也是特定于语言的。

设计模式是您的编程语言无法为您解决的常见问题的解决方案。在 Java 中，Singleton 模式解决了单一（简化）问题。

在 Scala 中，除了 Class 之外，您还有一个名为 Object 的顶级构造。它是惰性实例化的，只有一个。您不必使用单例模式来获得单例。这是语言的一部分。

* * *

## 回答 #11

> 赞同：8
> 
> 时间：2008-11-29T21:43:53.760

正如其他人所说，有一些特定于函数式编程的模式。我认为摆脱设计模式的问题与其说是切换到函数式的问题，不如说是**语言特性**的问题。

看看 Scala 如何摆脱“单例模式”：您只需声明一个**对象**而不是一个类。另一个特性，模式匹配，有助于避免访问者模式的笨拙。在此处查看比较： *[Scala 的模式匹配 = 类固醇上的访问者模式](http://andymaleh.blogspot.com/2008/04/scalas-pattern-matching-visitor-pattern.html)*

Scala 和 F# 一样，是面向对象功能的融合。我不了解 F#，但它可能具有这些功能。

闭包存在于函数式语言中，但它们不必局限于它们。它们有助于使用委托人模式。

再来一个观察。这段代码实现了一个模式：它是如此经典且如此基本，以至于我们通常不会将其视为“模式”，但它确实是：

```
for(int i = 0; i < myList.size(); i++) { doWhatever(myList.get(i)); } 
```

像 Java 和 C# 这样的命令式语言已经采用了本质上是一个函数式构造来处理这个问题：“foreach”。

* * *

## 回答 #12

> 赞同：8
> 
> 时间：2013-08-26T02:10:48.353

模式是解决类似问题的方法，这些问题反复出现，然后被描述和记录。所以不，FP 不会取代模式。但是，FP 可能会创建新模式，并使某些当前的“最佳实践”模式“过时”。

* * *

## 回答 #13

> 赞同：8
> 
> 时间：2013-12-09T17:45:14.447

GoF*设计模式正在为*[Simula 67](https://en.wikipedia.org/wiki/Simula)的后代 OO 语言（如 Java 和 C++）编写变通方案。

设计模式处理的大多数“弊病”是由以下原因引起的：

*   静态类型的类，它指定对象，但它们本身不是对象；
*   对单一调度的限制（仅最左边的参数用于选择方法，其余参数仅被视为静态类型：如果它们具有动态类型，则由方法使用临时方法对其进行排序）；
*   常规函数调用和面向对象的函数调用之间的区别，这意味着面向对象的函数不能作为函数参数传递给需要常规函数的函数，反之亦然；和
*   “基本类型”和“类类型”之间的区别。

这些设计模式中没有一个不会在 Common Lisp 对象系统中消失，即使解决方案的结构与相应的设计模式基本相同。（此外，该对象系统比 GoF 书早了十多年。Common Lisp 在该书首次出版的同一年成为 ANSI 标准。）

就函数式编程而言，模式是否适用于它取决于给定的函数式编程语言是否具有某种对象系统，以及是否以受益于模式的对象系统为模型。这种面向对象的类型不能很好地与函数式编程混合，因为状态的突变位于最前面和最中心。

构造和非可变访问与函数式编程兼容，因此与抽象访问或构造有关的模式可能适用：工厂、外观、代理、装饰器和访问者等模式。

另一方面，像状态和策略这样的行为模式可能并不*直接*应用于功能 OOP，因为状态的突变是它们的核心。这并不意味着它们不适用；也许它们以某种方式与可用于模拟可变状态的任何技巧结合使用。

* * *

## 回答 #14

> 赞同：7
> 
> 时间：2010-09-17T00:30:36.207

我想插入 Jeremy Gibbons 的几篇优秀但有些密集的论文：“将模式设计为​​高阶数据类型通用程序”和“迭代器模式的本质”（两者均可在此处获得：[http://www. comlab.ox.ac.uk/jeremy.gibbons/publications/](http://www.comlab.ox.ac.uk/jeremy.gibbons/publications/)）。

这些都描述了惯用的功能构造如何覆盖其他（面向对象）设置中特定设计模式所覆盖的领域。

* * *

## 回答 #15

> 赞同：6
> 
> 时间：2008-11-30T22:20:22.657

如果不提出类型系统，就无法进行此讨论。

> 函数式编程的主要特征包括函数作为一等值、currying、不可变值等。对我来说，OO 设计模式似乎并不明显接近这些特征中的任何一个。

那是因为这些特性没有解决 OOP 所解决的相同问题……它们是命令式编程的替代方案。FP 对 OOP 的回答在于 ML 和 Haskell 的类型系统……特别是 sum 类型、抽象数据类型、ML 模块和 Haskell 类型类。

> 但是当然还有一些设计模式是 FP 语言无法解决的。单例的 FP 等价物是多少？（暂时忽略单例通常是一种糟糕的使用模式）

类型类做的第一件事是消除对单例的需求。

您可以浏览 23 个列表并消除更多，但我现在没有时间。

* * *

## 回答 #16

> 赞同：4
> 
> 时间：2012-10-01T10:51:38.210

我认为只有两个 GoF 设计模式旨在将函数式编程逻辑引入自然 OO 语言。我想到了战略和指挥。其他一些 GoF 设计模式可以通过函数式编程进行修改，以简化设计并保持目的。

* * *

## 回答 #17

> 赞同：4
> 
> 时间：2012-10-19T19:44:48.173

本质上，**是**的！

*   [当一个模式绕过最终](http://lambda-the-ultimate.org/node/3655)促进[组合](http://www.cse.chalmers.se/~rjmh/Papers/whyfp.html)的缺失特性（高阶函数、流处理......）时。
*   一次又一次地重写模式实现的需要本身可以被视为一种[语言气味](http://c2.com/cgi/wiki?LanguageSmell)。

此外，这个[页面（AreDesignPatternsMissingLanguageFeatures）](http://c2.com/cgi/wiki?AreDesignPatternsMissingLanguageFeatures)提供了一个“模式/特征”翻译表和一些很好的讨论，如果你愿意挖掘的话。

* * *

## 回答 #18

> 赞同：3
> 
> 时间：2008-11-30T22:00:37.330

函数式编程不会取代设计模式。设计模式是不可替代的。

模式只是存在；它们随着时间的推移而出现。GoF 书将其中一些正式化了。如果随着开发人员使用函数式编程语言而出现新模式，那是令人兴奋的事情，也许还会有关于它们的书籍。

* * *

## 回答 #19

> 赞同：3
> 
> 时间：2014-05-20T12:04:20.853

在 2013 年新书名为*“函数式编程模式——在 Scala 和 Clojure 中”*中，作者 Michael.B. Linn 在许多情况下对 GoF 模式进行了比较并提供了替代方案，并且还讨论了新的功能模式，如“尾递归”、“记忆”、“惰性序列”等。

这本书在亚马逊上有售。当我拥有几十年的面向对象背景时，我发现它非常有用和令人鼓舞。

* * *

## 回答 #20

> 赞同：2
> 
> 时间：2016-06-28T22:11:02.523

OOP 和 GoF 模式处理状态。OOP 对现实进行建模，以使代码库尽可能接近给定的现实要求。GoF 设计模式是被确定用于解决原子现实世界问题的模式。他们以语义的方式处理状态问题。

由于在真正的函数式编程中不存在状态，因此应用 GoF 模式没有意义。没有功能性设计模式，就像有 GoF 设计模式一样。与现实相比，每个功能设计模式都是人工的，因为功能是数学而不是现实的构造。

函数缺乏时间的概念，因为无论当前时间是什么，它们总是返回相同的值，除非时间是函数参数的一部分，这使得处理“未来请求”变得非常困难。混合语言混合了这些概念，使这些语言不是真正的函数式编程语言。

函数式语言的兴起只是因为一件事：当前物理学的自然限制。由于物理定律，当今的处理器在处理指令的速度方面受到限制。您会看到时钟频率停滞不前，但处理核心有所扩展。这就是为什么指令的并行性对于提高现代应用程序的速度变得越来越重要的原因。由于函数式编程根据定义没有状态，因此没有副作用，因此安全地并行处理函数是安全的。

GoF 模式并没有过时。它们至少对于模拟现实世界的需求是必要的。但是，如果您使用函数式编程语言，则必须将它们转换为它们的混合等价物。最后，如果您使用持久性，您将没有机会只制作功能性程序。对于程序的混合元素，仍然有必要使用 GoF 模式。对于任何其他纯功能元素，没有必要使用 GoF 模式，因为没有状态。

因为真正的函数式编程不需要 GoF 模式，这并不意味着不应该应用 SOLID 原则。SOLID 原则超越了任何语言范式。

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2008-11-29T20:18:42.917

我认为每种范式都有不同的目的，因此不能以这种方式进行比较。

我还没有听说 GoF 设计模式适用于所有语言。我听说它们适用于所有**OOP 语言**。如果您使用函数式编程，那么您解决的问题领域与 OO 语言不同。

我不会使用函数式语言来编写用户界面，但是像 C# 或 Java 这样的 OO 语言之一会使这项工作变得更容易。如果我正在编写一种函数式语言，那么我不会考虑使用 OO 设计模式。

* * *

## 回答 #22

> 赞同：1
> 
> 时间：2014-06-12T12:28:04.313

正如公认的答案所说，OOP 和 FP 都有其特定的模式。

但是，有些模式非常普遍，我能想到的所有编程平台都应该有。这是一个（不完整的）列表：

*   适配器。我几乎想不出一个有用的编程平台，它是如此全面（和自我实现）以至于它不需要与世界交谈。如果要这样做，肯定需要一个适配器。

*   正面。任何可以处理大型源代码的编程平台都应该能够模块化。如果您要为程序的其他部分创建一个模块，您将希望隐藏代码的“脏”部分并为其提供一个漂亮的界面。

*   翻译。一般来说，任何程序都只做两件事：解析输入和打印输出。鼠标输入需要解析，窗口部件需要打印出来。因此，拥有一个嵌入式解释器为程序提供了额外的自定义事物的能力。

另外，我注意到在典型的 FP 语言 Haskell 中，有一些类似于 GoF 模式的东西，但名称不同。在我看来，这表明他们在那里，因为在 FP 和 OOP 语言中都有一些常见的问题需要解决。

*   Monad 变压器和装饰器。前者用于为现有的单子添加额外的能力，后者为现有的对象添加额外的能力。

* * *

## 回答 #23

> 赞同：1
> 
> 时间：2016-12-13T10:57:01.810

OOP 和 FP 有不同的目标。OOP 旨在封装软件组件的复杂性/移动部分，FP 旨在最小化软件组件的复杂性和依赖性。

然而，这两种范式不一定是 100% 矛盾的，可以一起应用以从两个世界中受益。

即使使用像 C# 这样本身不支持函数式编程的语言，如果您了解 FP 原理，您也可以编写函数式代码。同样，如果您了解 OOP 原则、模式和最佳实践，则可以使用 F# 应用 OOP 原则。无论您使用哪种编程语言，您都将根据您尝试解决的情况和问题做出正确的选择。

* * *

## 回答 #24

> 赞同：1
> 
> 时间：2020-04-26T15:14:55.707

一些模式在支持 FP 的语言中更容易实现。例如，策略可以很好地使用闭包来实现。但是，根据上下文，您可能更喜欢使用基于类的方法来实现策略，比如策略本身非常复杂和/或共享您想要使用模板方法建模的结构。

根据我使用多范式语言 (Ruby) 开发的经验，FP 实现在简单的情况下运行良好，但在上下文更复杂的情况下，基于 GoF OOP 的方法更适合。

FP 方法不会取代 OOP 方法，而是对其进行补充。

* * *

## 回答 #25

> 赞同：1
> 
> 时间：2020-05-23T23:45:30.837

确实如此，因为高级函数 PL（如 OCaml，具有类、模块等）在类型通用性和表达能力方面肯定会取代 OOP 命令式语言。抽象不会泄漏，您可以直接在程序中表达您的大部分想法。因此，是的，它确实取代了设计模式，无论如何，与功能模式相比，大多数设计模式都过于简单化了。

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2018-09-05T05:33:00.537

在函数式编程中，设计模式具有不同的含义。事实上，大多数**OOP**设计模式在函数式编程中是不必要的，因为更高级别的抽象和**HOF**用作构建块。

> HOF 的原理意味着函数可以作为参数传递给其他函数。并且函数可以返回值。

* * *

## 回答 #27

> 赞同：0
> 
> 时间：2020-03-26T10:07:46.503

恕我直言，函数式编程的最重要特征是您只使用*表达式*进行编程- 表达式中的表达式中的表达式都计算为最后一个“在计算时使机器变暖”的最终表达式。

面向对象编程的最重要特征，恕我直言，您正在使用具有内部状态的对象进行编程。你不能在纯函数中拥有内部状态——面向对象的编程语言需要*语句*来使事情发生。（函数式编程中没有语句。）

您正在将苹果与橙子进行比较。面向对象编程的模式不适用于函数编程，因为函数式编程是用表达式编程，而面向对象编程是用内部状态编程。

* * *

## 回答 #28

> 赞同：0
> 
> 时间：2020-04-07T18:57:02.517

振作起来。

听到我声称已经替换了设计模式并揭穿了 SOLID 和 DRY 的真相，会让很多人感到更加愤怒。我谁都不是。[尽管如此，我还是正确地建模了协作（制造）架构，并在我的网站http://www.powersemantics.com/](http://www.powersemantics.com/)上发布了在线构建流程的规则以及其背后的代码和科学。

我的论点是，设计模式试图实现制造业所谓的“大规模定制”，这是一种每一步都可以重塑、重组和扩展的过程形式。您可能会将此类进程视为未编译的脚本。我不会在这里重复我的（在线）论点。简而言之，我的大规模定制架构通过在没有任何混乱语义的情况下实现灵活性来取代设计模式。我很惊讶我的模型运行得如此之好，但程序员编写代码的方式根本无法与制造业如何组织协作工作相提并论。

*   制造 = 每一步都与一个产品相互作用
*   OOP = 每一步都与自身和其他模块交互，像无用的上班族一样将产品从一个点传递到另一个点

这种架构永远不需要重构。还有一些关于集中和分配的规则会影响复杂性。但是要回答您的问题，函数式编程是另一组处理语义，而不是大规模自定义流程的体系结构，其中 1）源路由作为（脚本）文档存在，使用者可以在触发之前重写，2）模块可以很容易和动态添加或删除。

我们可以说 OOP 是“硬编码过程”范式，而设计模式是避免这种范式的方法。但这就是大规模定制的全部内容。设计模式将动态过程体现为凌乱的硬代码。没有意义。F# 允许将函数作为参数传递这一事实意味着函数式语言和 OOP**语言**都试图自行完成大规模定制。

代表脚本的硬编码对读者来说是多么令人困惑？如果您认为编译器的消费者为此类功能付费，则根本不会，但对我而言，此类功能是语义浪费。它们毫无意义，因为大规模定制的目的是使流程本身**动态化**，而不仅仅是对使用 Visual Studio 的程序员来说是动态的。

# .net - 如何处理 .NET Winforms 中的堆叠控件？

> ID：327968
> 
> 赞同：4
> 
> 时间：2008-11-29T20:22:49.320
> 
> 标签：.net, winforms

我有一个表单，它将多个面板控件堆叠在一起，每个控件都根据表单上的其他选定选项显示/隐藏。这在表单设计器中管理起来确实很痛苦，因为面板的行为不像完整的 TabControl。但是，看起来您不能在没有选项卡的情况下使用 TabControl。处理这个问题的最佳方法是什么？是否有类似 TabControl 的控件，但没有选项卡？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-29T20:44:37.233

您可以隐藏选项卡，在设计器中非常方便。在您的项目中添加一个新类并粘贴以下代码：

```
using System;
using System.Windows.Forms;

public class TablessControl : TabControl {
  protected override void WndProc(ref Message m) {
    // Hide tabs by trapping the TCM_ADJUSTRECT message
    if (m.Msg == 0x1328 && !DesignMode) m.Result = (IntPtr)1;
    else base.WndProc(ref m);
  }
} 
```

# php - 你的 PHP 工具集中有什么？

> ID：327977
> 
> 赞同：8
> 
> 时间：2008-11-29T20:31:49.507
> 
> 标签：php, devtools

每个 PHP 程序员都可能至少使用某种形式的模板引擎和数据库抽象层，但除了这些之外，您认为哪些附加功能是必不可少的，或者会建议您的程序员同行尝试一下？

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2008-11-29T20:51:25.160

1.  一个很好的框架。
    PHP 有很多可供选择：[Zend's](http://framework.zend.com/)、[Solar](http://solarphp.com/)、[CakePHP](http://cakephp.org/)、[Symfony](http://www.symfony-project.org/)、[Kohana](http://kohanaphp.com/home)。一个好的框架将承担应用程序开发的大部分繁琐部分，让您可以将更多时间花在实现特定于项目的领域逻辑上。框架还将有助于实施一致的编码风格，通常有大量的文档，并且大多数都经过了很好的测试并且总体上很稳定。

2.  一个好的IDE。
    对于任何认真的开发人员来说，一个好的 IDE 是必须的。项目组织、目录导航、代码完成和各种有用的扩展（例如，用于文件版本控制系统）都是极大的生产力助推器。PHP 有几个不错的 IDE，包括[Zend Studio](http://www.zend.com/en/products/studio/)和[PDT for Eclipse](http://www.eclipse.org/pdt/)。

3.  构建系统。
    构建脚本对于在阶段（开发/暂存/生产）之间移动项目之前自动重复任务很有用，例如设置目录/文件权限、SVN 更新、运行测试等。我主要使用[Phing](http://phing.info/trac/)（一个[Ant](http://ant.apache.org/)克隆）来构建和部署项目。

4.  分析和调试工具。
    这两个需求由同一个工具 - [xdebug](http://www.xdebug.org/)解决，它提供了改进的调试功能，还可以生成[kcachegrind](http://kcachegrind.sourceforge.net/html/Home.html)报告来分析您的应用程序。然后我使用[webgrind](http://code.google.com/p/webgrind/)访问这些报告。

5.  操作码缓存。
    PHP 的运行时编译方案对性能造成了重大影响。[操作码缓存](http://en.wikipedia.org/wiki/PHP_accelerator)通过在编译状态下缓存脚本来改善这一点，避免了缓存命中时的编译开销。当我有机会时，我使用[APC](http://www.php.net/apc)作为我的操作码缓存。

6.  各种开源包。
    PHP 作为一种语言是开源的，具有悠久的开源开发传统。对于最常见（和一些不常见）的需求，有许多高质量/有用的包，可以节省大量的开发时间。我使用[wordpress](http://wordpress.org/)和[joomla](http://www.joomla.org/)作为博客平台，使用[HTML Purifier](http://htmlpurifier.org/)来清理和验证 HTML，使用[minify](http://code.google.com/p/minify/)来缩小和连接 CSS 和 Javascript 等。

7.  源文件版本控制。
    无论编程语言如何，都是必须的。我将[SVN](http://subversion.tigris.org/)与[乌龟](http://tortoisesvn.tigris.org/)客户端（用于 Windows）一起使用。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-29T20:55:22.000

IDE：Eclipse 的 PDT

源代码控制：带有 Tortoise SVN 的 SVN

其他细节，如框架，取决于项目。

# ms-access - 使用 ADO 将 SQL Server Compact 3.5 数据库连接到 MS Access 2003？

> ID：327982
> 
> 赞同：4
> 
> 时间：2008-11-29T20:39:08.197
> 
> 标签：ms-access, sql-server-ce

是否可以在 MS Access 2003 中编写连接并打开 SQL Compact 3.5 数据库？我希望能够使用 MS Access 2003 来操作 SQL Compact 3.5 数据库中的数据。如果可能，那么将使用哪些语句来打开数据库？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-02T05:30:03.617

这只是一个想法，我无法确认它是否会起作用，但鉴于 SQL Compact 缺少 ODBC 驱动程序并且您不能拥有链接表，也许您可​​以使用 SQL Compact 的 OLEDB 连接字符串作为源连接字符串在 Access 中保存的 QueryDef。如果你能让它工作，你可以为每个表创建一个保存的 QueryDef，然后像查询是链接表一样使用它们。

我无法在我的机器上测试它，因为我安装的唯一 OLEDB 提供程序是 Jet，而 Access 似乎不喜欢那样。

但这可能值得一试。可能它不会起作用，因为我在 Access 中找不到任何人这样做过的地方。但我真的不明白为什么它不应该工作。

再说一次，我可能完全是错的，不过。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-01T09:35:28.677

虽然我没有专门尝试使用 SQL Compact，但连接到服务器应该是标准的：

1.  检查您的可用工具中是否正确引用了 ADODB 文件 (msado21.tlb)
2.  写下您的连接字符串，如下所示：

    MyConnectionString = "Provider=SQLOLEDB.1;Integrated Security=SSPI;Persist Security Info=False;Initial Catalog=YourDatabaseName;Data Source=YourSQLServerInstanceName"

    此字符串是为“集成安全”上下文编写的。如果您想为 SQL 安全上下文更改它，请[在此处](http://www.connectionstrings.com/)检查以更新字符串。理想情况下，该字符串应在您的代码中声明为公共变量。

完成后，您可以打开 ADODB 记录集并开始操作它：

```
public sub connectionTest
Dim activeConnection as ADODB.connection, _
    activeRecordset as ADODB.recordset

Set activeConnection = New ADODB.connection
activeConnection.connectionString = myCOnnectionString
activeConnection.open

set activeRecordset = New ADODB.recordset
'this will open a read-only recordset'
activeRecordset.open _
    "SELECT * FROM myTableName", _
    activeConnection, _
    adOpenStatic, _
    adLockReadOnly

if activeRecordset.EOF and activeRecordset.BOF then
    debug.print "No records in this table"
else
    activeRecordset.moveFirst
    do while not activeRecordset.EOF
        debug.print activerecordset.fields("myFieldName").value
        activeRecordset.moveNext
    loop
endif

activeRecordset.close
set activeRecordset = nothing
activeConnection.close
set activeConnection = nothing

end sub 
```

# javascript - 我的 javascript 如何确定它是由 WScript 还是浏览器调用的？

> ID：327983
> 
> 赞同：1
> 
> 时间：2008-11-29T20:40:22.530
> 
> 标签：javascript

我正在尝试编写一个可以从 WScript 或浏览器（嵌入在 html 中）调用的 javascript 程序。许多 javascript 函数与调用者的类型无关，但与调试函数无关，例如“window.write”或“WScript.alert”。

我知道 javascript 函数可以确定其调用者的名称，但不能确定 javascript 主程序。

案例1：调用者是WScript，WScript sample.js

案例2：调用者是浏览器，

sample.js 如何判断它是被 WScript 还是浏览器调用的？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-29T20:58:24.803

您可以通过检查 WScript/window 对象的存在/不存在来检查您的脚本是从 WScript 还是浏览器调用的。浏览器没有内置的 WScript 对象，并且 WScript 脚本通常无法访问窗口对象（除非您创建它）。

例如...

```
function Test()
{
    if(typeof WScript!= "undefined")
    {
        WScript.Echo("Hello WScript!");
    }
    else if (typeof window != "undefined")
    {
        alert("Hello browser!");
    }
} 
```

# c# - WPF 数据绑定到接口而不是实际对象 - 可以强制转换吗？

> ID：327984
> 
> 赞同：55
> 
> 时间：2008-11-29T20:40:25.010
> 
> 标签：c#, wpf, data-binding

假设我有一个这样的界面：

```
public interface ISomeInterface
{
...
} 
```

我也有几个实现这个接口的类；

```
public class SomeClass : ISomeInterface
{
...
} 
```

现在我有一个 WPF ListBox 列出 ISomeInterface 的项目，使用自定义 DataTemplate。

数据绑定引擎显然不会（我已经能够弄清楚）允许我绑定到接口属性 - 它看到对象是 SomeClass 对象，并且只有在 SomeClass 碰巧具有可用的绑定属性时才会显示数据非接口属性。

如何让 DataTemplate 表现得好像每个对象都是 ISomeInterface，而不是 SomeClass 等？

谢谢！

* * *

## 回答 #1

> 赞同：66
> 
> 时间：2009-12-01T17:07:44.017

为了绑定到显式实现的接口成员，您需要做的就是使用括号。例如：

隐含的：

```
{Binding Path=MyValue} 
```

明确的：

```
{Binding Path=(mynamespacealias:IMyInterface.MyValue)} 
```

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2013-09-14T05:46:00.227

[Beatriz Costa](http://social.msdn.microsoft.com/profile/beatriz%20costa%20-%20msft/?ws=usercard-inline)来自微软论坛的[这个答案](http://social.msdn.microsoft.com/Forums/vstudio/en-US/1e774a24-0deb-4acd-a719-32abd847041d/data-templates-and-interfaces)- MSFT值得一读（相当古老）：

> 数据绑定团队不久前讨论了添加对接口的支持，但最终没有实现它，因为我们无法为它提出一个好的设计。问题是接口没有像对象类型那样的层次结构。考虑一下您的数据源实现了这两者的场景，`IMyInterface1`并且`IMyInterface2`您在资源中为这两个接口都有 DataTemplates：您认为我们应该选择哪个 DataTemplate？
> 
> 在为对象类型进行隐式数据模板时，我们首先尝试`DataTemplate`为确切的类型找到一个，然后为它的父级、祖父级等找到一个。有非常明确的类型顺序供我们应用。当我们谈到添加对接口的支持时，我们考虑使用反射来找出所有接口并将它们添加到类型列表的末尾。我们遇到的问题是当类型实现多个接口时定义接口的顺序。
> 
> 我们必须记住的另一件事是反射并不便宜，这会降低我们在这种情况下的性能。
> 
> 那么解决方案是什么？您无法在 XAML 中完成所有这些操作，但您可以使用一些代码轻松完成。的`ItemTemplateSelector`属性`ItemsControl`可用于选择`DataTemplate`要为每个项目使用的属性。在`SelectTemplate`模板选择器的方法中，您将接收作为模板的项目作为参数。在这里，您可以检查它实现的接口并返回`DataTemplate`与之匹配的接口。

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2008-11-29T20:50:15.397

简短的回答是 DataTemplate 不支持接口（考虑多重继承、显式与隐式等）。我们倾向于解决这个问题的方法是扩展一个基类 things 以允许 DataTemplate 特化/泛化。这意味着一个体面但不一定是最佳的解决方案是：

```
public abstract class SomeClassBase
{

}

public class SomeClass : SomeClassBase
{

}

<DataTemplate DataType="{x:Type local:SomeClassBase}">
    <!-- ... -->
</DataTemplate> 
```

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2009-09-12T09:07:42.497

你有另一个选择。在您的 DataTemplate 上设置一个键并在 ItemTemplate 中引用该键。像这样：

```
<DataTemplate DataType="{x:Type documents:ISpecificOutcome}"
              x:Key="SpecificOutcomesTemplate">
    <Label Content="{Binding Name}"
           ToolTip="{Binding Description}" />
</DataTemplate> 
```

然后在要使用的地方按键引用模板，如下所示：

```
<ListBox ItemsSource="{Binding Path=SpecificOutcomes}"
         ItemTemplate="{StaticResource SpecificOutcomesTemplate}"
         >
</ListBox> 
```

![渲染](https://i.stack.imgur.com/alB63.png)

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2011-05-20T07:11:12.227

dummyboy 建议的答案是最佳答案（应该投票给 imo 顶部）。它确实存在设计人员不喜欢它的问题（给出错误“Object null 不能用作 PropertyPath 的访问器参数），但有一个很好的解决方法。解决方法是在数据模板中定义项目，然后将模板设置为标签或其他内容控件。例如，我试图添加这样的图像

```
<Image Width="120" Height="120" HorizontalAlignment="Center" Source="{Binding Path=(starbug:IPhotoItem.PhotoSmall)}" Name="mainImage"></Image> 
```

但它一直给我同样的错误。解决方案是创建一个标签并使用数据模板来显示我的内容

```
<Label Content="{Binding}" HorizontalAlignment="Center" MouseDoubleClick="Label_MouseDoubleClick">
    <Label.ContentTemplate>
        <DataTemplate>
            <StackPanel>
                <Image Source="{Binding Path=(starbug:IPhotoItem.PhotoSmall)}" Width="120" Height="120" Stretch="Uniform" ></Image>
            </StackPanel>
        </DataTemplate>
    </Label.ContentTemplate>
</Label> 
```

这有它的缺点，但它似乎对我来说效果很好。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2017-01-17T23:43:02.593

注意：如果接口属性在路径内，您也可以使用更复杂的多部分路径：

```
 <TextBlock>
    <TextBlock.Text>
        <Binding Path="Packages[0].(myNamespace:IShippingPackage.ShippingMethod).CarrierServiceCode"/>
    </TextBlock.Text>
 </TextBlock> 
```

或者直接用`Binding`指令。

```
 <TextBlock Text="{Binding Path=Packages[0].(myNamespace:IShippingPackage.ShippingMethod).CarrierServiceCode}"/> 
```

或者，当使用接口的多个属性时，您可以在本地重新定义 DataContext 以使代码更具可读性。

```
 <StackPanel DataContext={Binding Path=Packages[0].(myNamespace:IShippingPackage.ShippingMethod)}">
    <TextBlock Text="{Binding CarrierName}"/>
    <TextBlock Text="{Binding CarrierServiceCode}"/>
  </StackPanel> 
```

提示：当心`)}`在路径表达式的末尾意外结束。我一直在犯愚蠢的复制/粘贴错误。

`Path="(myNameSpace:IShippingPackage.ShippingMethod)}"`

* * *

### 确保使用`Path=`

发现如果我不明确使用`Path=`那么它可能无法解析绑定。通常我会写这样的东西：

```
Text="{Binding FirstName}" 
```

代替

```
Text="{Binding Path=FirstName}" 
```

但是对于更复杂的接口绑定，我发现`Path=`需要避免这种异常：

```
System.ArgumentNullException: Key cannot be null.
Parameter name: key
   at System.Collections.Specialized.ListDictionary.get_Item(Object key)
   at System.Collections.Specialized.HybridDictionary.get_Item(Object key)
   at System.ComponentModel.PropertyChangedEventManager.RemoveListener(INotifyPropertyChanged source, String propertyName, IWeakEventListener listener, EventHandler`1 handler)
   at System.ComponentModel.PropertyChangedEventManager.RemoveHandler(INotifyPropertyChanged source, EventHandler`1 handler, String propertyName)
   at MS.Internal.Data.PropertyPathWorker.ReplaceItem(Int32 k, Object newO, Object parent)
   at MS.Internal.Data.PropertyPathWorker.UpdateSourceValueState(Int32 k, ICollectionView collectionView, Object newValue, Boolean isASubPropertyChange) 
```

即不要这样做：

```
<TextBlock Text="{Binding Packages[0].(myNamespace:IShippingPackage.ShippingMethod).CarrierServiceCode}"/> 
```

# python - 如何修改文件的最后一行？

> ID：327985
> 
> 赞同：9
> 
> 时间：2008-11-29T20:41:28.893
> 
> 标签：python, file

我文件的最后一行是：

> 29-dez,40,

如何修改该行，使其显示为：

> 29-Dez,40,90,100,50

注意：我不想写新行。我想采取同样的做法并在后面加上新的值`29-Dez,40,`

我是python的新手。我在处理文件时遇到了很多麻烦，对我来说，我看到的每个示例似乎都很困难。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-29T23:41:59.187

为了扩展[Doug 所说](https://stackoverflow.com/questions/327985/need-help-to-write-in-the-last-line-of-the-file#328007)的内容，为了将文件内容读入数据结构，您可以使用文件对象的[readlines() 方法](http://www.python.org/doc/2.5.2/lib/bltin-file-objects.html)。

下面的代码示例将文件读入“行”列表，编辑最后一行，然后将其写回文件：

```
#!/usr/bin/python

MYFILE="file.txt"

# read the file into a list of lines
lines = open(MYFILE, 'r').readlines()

# now edit the last line of the list of lines
new_last_line = (lines[-1].rstrip() + ",90,100,50")
lines[-1] = new_last_line

# now write the modified list back out to the file
open(MYFILE, 'w').writelines(lines) 
```

如果文件非常大，那么这种方法将无法正常工作，因为这每次都会将所有文件行读入内存并将它们写回文件，这是非常低效的。但是，对于一个小文件，这将正常工作。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-11-29T21:05:31.047

除非文件很大，否则您可能会发现将整个文件读入数据结构（可能只是行列表）更容易，然后修改内存中的数据结构，最后将其写回文件.

另一方面，也许你的文件*真的*很大——至少有几个 GB。在这种情况下：最后一行可能以换行符终止，如果您寻找该位置，您可以用最后一行末尾的新文本覆盖它。

所以也许：

```
f = open("foo.file", "wb")
f.seek(-len(os.linesep), os.SEEK_END) 
f.write("new text at end of last line" + os.linesep)
f.close() 
```

（不同平台上的模数行结尾）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-29T20:46:52.347

不要直接使用文件，以类的形式制作适合您需求的数据结构，并制作从/写入文件的方法。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-04T01:52:50.637

我最近写了一个脚本来做与此非常相似的事情。它将遍历一个项目，查找所有模块依赖项并添加任何缺少的导入语句。我不会把这篇文章和整个脚本混在一起，但我会展示我是如何修改文件的。

```
import os
from mmap import mmap

def insert_import(filename, text):
    if len(text) < 1:
        return
    f = open(filename, 'r+')
    m = mmap(f.fileno(), os.path.getsize(filename))
    origSize = m.size()
    m.resize(origSize + len(text))
    pos = 0
    while True:
        l = m.readline()
        if l.startswith(('import', 'from')):
            continue
        else:
            pos = m.tell() - len(l)
            break
    m[pos+len(text):] = m[pos:origSize]
    m[pos:pos+len(text)] = text
    m.close()
    f.close() 
```

摘要：这个片段需要一个文件名和一个要插入的文本块。它找到已经存在的最后一个导入语句，并将文本粘贴在该位置。

我建议最关注的部分是mmap的使用。它允许您以与处理字符串相同的方式处理文件。非常便利。

# windows - 我用什么软件把软盘作为图像放在硬盘上？

> ID：327986
> 
> 赞同：-2
> 
> 时间：2008-11-29T20:41:40.330
> 
> 标签：windows, macos, backup, floppy

我还有很多软盘。其中一些可能有我不想丢失的源代码。我也不想单独查看每一个，因为这会花费很多时间。什么软件最适合将所有数据复制到硬盘上，最好是同时创建索引？

我也有兴趣对 mac 软盘进行映像，但它不必在同一台机器上。

[回复]
目标是最终摆脱所有带有软盘的盒子。我问的是图像，因为 xcopy 不会复制所有（隐藏的？）扇区，是吗？xxcopy 更好吗？

我不想为每张软盘键入一个名称。

mac 上的磁盘工具可能需要太多的键盘或鼠标操作，但可能是可取的

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-29T21:12:24.340

这是我在我的 Linux 机器上用来执行相同类型任务的脚本。基本上我只是将每个磁盘的原始图像放到一个文件夹中。我后来运行了另一个脚本，该脚本安装了每个脚本并将目录列表转储到文件中。

```
#!/bin/bash

floppydev='/dev/sdb'
savepath='/srv/floppy_imgs'
while true
do
  echo "Press a key to create an image of the next floppy"
  read -n 1

  dd if=$floppydev of=/dev/null count=1 2> /dev/null
  errlvl=$?
  #if the disk isn't in the drive then wait
  while [ $errlvl -ne 0 ]
  do
    sleep 1
    dd if=$floppydev of=/dev/null count=1 2> /dev/null
    errlvl=$?
  done

  filename=$(date +'img-%Y%m%d-%H%M%S.flp')

  if [ ! -f $savepath/$filename ]
  then
    echo "creating image as $filename"
    dd if=$floppydev of=$savepath/$filename
    errlvl=$?

    if [ $errlvl -ne 0 ]
    then
      echo 'the image copy failed!'
      rm -i $savepath/$filename
    else
      mlabel -s -i $savepath/$filename ::
      md5sum $savepath/$filename > $savepath/$filename.md5
      echo "copy complete"
      echo " "
    fi
  fi

done 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-29T21:23:28.480

使用 rawread 和 rawrite。

可能有各种实现，我发现的第一个是这样的：http: [//www.pamarsystems.com/raw.html](http://www.pamarsystems.com/raw.html)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-01T15:38:30.487

我使用[WinImage](http://www.winimage.com/)获得了令人满意的结果。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-07-07T09:01:33.307

在 OS X 上，也许你可以简单地使用 DD？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-29T21:06:55.737

我不太确定你的目标。不知何故，您需要的是一个机器人，插入软盘，复制等:-)

我只会制作一堆空文件夹，插入磁盘，全选并拖动到第 n 个文件夹。或者使用 xcopy 或 xxcopy 之类的东西以递归方式将数据从软盘传输到文件夹。等等。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-29T21:07:02.023

操作系统？为什么不自己创建一个批处理文件，在指定位置创建一个新文件夹，命名为当前时间戳，然后复制软盘驱动器的内容。这样您就可以在插入软盘和运行批处理文件时看电视。只要您以已知顺序将它们放入驱动器，您就可以通过按时间戳对结果文件夹进行排序来识别哪个是哪个。

不确定mac上的等价物是什么，但我确定有一个。

**编辑：** 我认为你应该需要的一切都在[这里](http://www.chebucto.ns.ca/~ak621/DOS/Bat-Adv2.html)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-02T18:24:58.480

在 Mac 上，您可能可以使用磁盘工具将软盘转换为 DMG 文件——但我已经好几年没有 Mac 软盘驱动器了，所以我无法测试这个理论。

# c# - HTTP POST XML 到 REST 单例服务抛出 NotSupportedException

> ID：327996
> 
> 赞同：2
> 
> 时间：2008-11-29T20:51:37.860
> 
> 标签：c#, wcf, rest, silverlight-2.0

我在 silverlight 应用程序中有以下 REST 主机。我在 Save 方法的 EndGetResponse() 调用中收到 NotSupportedException。在此示例中，我使用 WCF REST Starter Kit 中的 REST Singleton 服务的默认配置，但对 OnAddItem 方法进行了一些更改以通过 POST 接受更新（因为不支持 silverlight PUT）。当我从 Fiddler 发帖时，我收到了 StatusCode 200。该服务与 SilverlightPage 托管在同一站点上，因此我没有任何 x 域策略设置。我错过了一些明显的东西吗？

Load 方法工作正常。

```
namespace SilverlightApplication2
{
    public class Customer
    {
        public string Name { get; set; }
    }

    public class RestHost
    {
        public event EventHandler Loaded = delegate { };
        public event EventHandler Error = delegate { };

        public Customer Customer { get; set; }
        public string ErrorMessage { get; set; }

        public RestHost()
        {
            Customer = new Customer();

            Load();
        }

        private void Load()
        {
            // begin loading customer
            var request = (HttpWebRequest)WebRequest.Create(new Uri("http://localhost:41078/SilverlightApplication2.Web/Service.svc/"));
            request.BeginGetResponse(delegate(IAsyncResult result)
            {
                try
                {
                    var resp = request.EndGetResponse(result);

                    var doc = XDocument.Load(resp.GetResponseStream());

                    Customer.Name = doc.Element("SampleItem").Element("Value").Value;

                    Loaded(this, EventArgs.Empty);
                }
                catch (Exception ex)
                {
                    ErrorMessage = ex.GetBaseException().Message;
                    Error(this, EventArgs.Empty);
                }
            }, null);
        }

        public void Save()
        {
            var request = (HttpWebRequest)WebRequest.Create(new Uri("http://localhost:41078/SilverlightApplication2.Web/Service.svc/"));
            request.Method = "POST";
            request.ContentType = "application/xml";
            request.BeginGetRequestStream(delegate(IAsyncResult result)
            {
                var postDoc = new XDocument(
                    new XElement("SampleItem", new XAttribute(XNamespace.Xmlns + "i", "http://www.w3.org/2001/XMLSchema-instance"),
                        new XElement("Value", Customer.Name)
                    )
                );
                postDoc.Save(request.EndGetRequestStream(result));

                request.BeginGetResponse(delegate(IAsyncResult result2)
                {
                    try
                    {
                        var resp = request.EndGetResponse(result2); // NotSupportedExecption here

                        var doc = XDocument.Load(resp.GetResponseStream());

                        Customer.Name = doc.Element("SampleItem").Element("Value").Value;

                        Loaded(this, EventArgs.Empty);
                    }
                    catch (Exception ex)
                    {
                        ErrorMessage = ex.GetBaseException().Message;
                        Error(this, EventArgs.Empty);
                    }
                }, null);
            }, null);

        }
    }
} 
```

这里也是页面代码

```
<UserControl x:Class="SilverlightApplication2.Page"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation" 
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml" 
    Width="400" Height="300">
    <Grid x:Name="LayoutRoot" Background="White">
        <StackPanel Width="100" HorizontalAlignment="Left" Margin="15">
            <TextBlock>Customer</TextBlock>
            <TextBox x:Name="CustomerName" />
            <TextBlock Foreground="LightGray" x:Name="LoadingLabel" Margin="5,-19,0,0">Loading ...</TextBlock>
            <Button Content="Save" Margin="0,5,0,0" Click="Button_Click" />
        </StackPanel>
    </Grid>
</UserControl> 
```

代码隐藏

```
namespace SilverlightApplication2
{
    public partial class Page : UserControl
    {
        private RestHost _host;

        public Page()
        {
            InitializeComponent();

            _host = new RestHost();
            _host.Loaded += delegate
            {
                this.Dispatcher.BeginInvoke(delegate
                {
                    this.LoadingLabel.Visibility = Visibility.Collapsed;
                    this.CustomerName.Text = _host.Customer.Name;
                });
            };
            _host.Error += delegate
            {
                this.Dispatcher.BeginInvoke(delegate
                {
                    HtmlPage.Window.Alert(_host.ErrorMessage);
                });
            };
        }

        private void Button_Click(object sender, RoutedEventArgs e)
        {
            _host.Customer.Name = this.CustomerName.Text;
            _host.Save();
        }
    }
} 
```

* * *

## 回答 #1

> 赞同：-3
> 
> 时间：2009-08-28T02:07:36.893

这是一个很好的演练...

[http://blog.donnfelker.com/post/How-To-REST-Services-in-WCF-35-Part-2-The-POST.aspx](http://blog.donnfelker.com/post/How-To-REST-Services-in-WCF-35-Part-2-The-POST.aspx)**********