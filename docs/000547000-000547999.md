# StackOverflow 问答 000547000-000547999

# layout - 为什么要选择固定宽度设计？

> ID：547000
> 
> 赞同：24
> 
> 时间：2009-02-13T18:02:53.203
> 
> 标签：layout

**更新：** 我删除了我的动机，因为它似乎分散了读者的注意力。这不是关于“你为什么不把你的窗户变小”。查看屏幕截图，您将看到由于固定宽度而被遮挡的文本。请参阅我在 CSS 中对“em/ex”表示法的引用。我想在这里进行真正的讨论。谢谢你。

* * *

现在我想请教一下这个主题的真正专家——我不是网页设计师——为什么固定宽度布局仍然如此受欢迎，以及它是否真的有*充分的*理由。（也欢迎您指出反对它的理由。）

*   **相对地（从一开始）设计你的布局**是不是太难了？**似乎有些人甚至[忘记了如何去做](https://stackoverflow.com/questions/90595/how-to-implement-a-web-page-that-scales-when-the-browser-window-is-resized)。**

***   **您是否有诸如可读性之类的真正原因**而只是不知道如何正确处理它？在这里，我指的是一些智慧，比如很难阅读更长的行（这就是报纸使用专栏的原因）——但是，应该使用[`em`and`ex`](http://htmlhelp.com/reference/css/units.html)给出宽度。

    *   **你是否**被一些[旧的指导方针](https://stackoverflow.com/questions/456250/recommended-website-resolution-width-and-height)所强迫？在 HTML 的黑暗时代，人们做错了*很多*事情；现在每个人都终于使用 CSS，但也许这个只是坚持。

    *   还是您像我一样，想知道为什么每个人都在做“错”？** 

 **为了说明问题，我想先给出反面例子的截图：

*   [StackOverflow](http://fopref.meinungsverstaerker.de/div_priv/stackoverflow.png)（在这里我什至看不出是什么使它*难以*修复）
*   [Filmstarts](http://fopref.meinungsverstaerker.de/div_priv/filmstarts.png)（一个德国网站，如果我不带老花镜，它就会变得不可读）

这是一个积极的例子。它看起来像一个典型的固定站点（即使有透明边框），但它不是：

[Wiki 软件网站](http://fsi.informatik.uni-erlangen.de/dw/)——[相关论坛](http://fsi.informatik.uni-erlangen.de/forum/)

你怎么看？

**更新：**相关问题：[这个](https://stackoverflow.com/questions/27381/should-websites-expand-on-window-resize)和[那个](https://stackoverflow.com/questions/329900/css-fixed-or-float-layout)。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-02-13T18:41:37.417

And here, as expected, comes the usual canard: “long lines are too hard to read”.

**[Citation needed]**, folks.

See [http://webusability.com/article_line_length_12_2002.htm](http://webusability.com/article_line_length_12_2002.htm) for a summary of actual research in this area. A number of these, plus [http://psychology.wichita.edu/surl/usabilitynews/72/LineLength.asp](http://psychology.wichita.edu/surl/usabilitynews/72/LineLength.asp), find that although users express a preference for moderate line lengths, reading speeds do not sharply drop off with ‘long’ lines; in fact many show increased speeds with the longer settings.

As long as it's not *ridiculously long*, and taking care to use a decent amount of leading, long lines are not generally a real issue at today's typical browser widths and default font sizes. (If you're one of those designers that loves to use teeny-tiny type for everything, it could be an issue, but then you're already making it impossible to read with the flyspeck text. Stop it!)

So as it's only an option of user preference that prefers medium-short lines, let us users decide how much screen space we want to give the web site to get our work done. We're the ones best-equipped to know. If you decide you know definitively best you're likely to waste space, or, if you guessed too long, make us scroll back and forth sideways to read the text — and that really *is* a readability nightmare.

If you want to protect us from ourselves, you can compromise by specifying a min-width and max-width in ‘em’ units so that the page is responsive to liquid layout, but doesn't get stretched to extremes.

But otherwise, the best reason to design fixed-width is indeed that it is easier, especially for someone with a fixed-2D-grid view of the world and static visual-design tools like Photoshop.

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-02-13T18:08:19.480

It's already a pain to make a website that renders correctly across all popular browsers; if you also want it to render correctly at all text sizes, it's quite a lot of work. A lot of web developers design their sites for the default font size and try to support fonts that are either a little bit larger or a little bit smaller. (You might be interested in [this dated but relevant piece](http://www.useit.com/alertbox/20020819.html) from Jakob Nielsen.)

As for fixed-width sites, it's hard to say. Personally, I suspect that a lot of web designers just like to feel like they have a lot of control over their look and feel, and think the site looks "ugly" when you stretch it too far, so they don't let you do it. Probably not wise, but there you go.

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2009-02-13T19:13:07.140

> Now I would like to ask real experts on this topic -- I'm not a web designer -- why fixed width layout are still that popular and if there are really good reasons for it.

Ah, both subjective and argumentative. I'm sure my argument won't convince you, but here's one really good reason, IMHO:

Presentation.

Just like a movie, the director has an *experience* in mind for the viewer. They frame the movie just so. They move the action at a given pace for the emotion they are trying to invoke in the viewer. Even though DVDs have had the "angle" feature since inception, few movies have ever given viewers the opportunity to watch the film from a different point of view, and if they have that viewpoint was still under the control of the director.

Now, any old sap can throw up a website, and for the most part they aren't interested in anything more than the content.

But real designers fully understand that the design must be understood as a whole. A wide layout has a very different impact on people than a multicolumn or thin layout. Reader eyes move in a certain pattern, and the text is intended to pull the reader along a path.

Those who claim that every layout should have certain features are shortsighted. There are no universally true 'rules', and trying to make an expanding layout a rule is shortsighted at best, and arrogant at worst.

-Adam

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-02-13T19:03:24.197

Here are my $0.02 and they are worth exactly what you paid for them (and if that's not a perfect example of the current economic situation... :-))

The layout of a website should be dictated by the overall user experience. This is in part determined by the accessibility, in part by the design, in part by the functionality:

1.  Accessibility - as several people pointed out, letting the website use the full width of the browser without any control can result in quite a long lines that make it hard to read[1]. Making the text automatically layout in multiple columns is a potential answer to this problem, but it's really hard to achieve with CSS (that's gotta be the worst tool for doing layout humanity ever devised, but that's a separate topic) and is fraught with other issues as well.

I should note that you do have a point - most websites with fixed width do suck on high-DPI because they don't take into account the changed font size. However, that's not an inherent problem of the fixed width design; I've seen it with fluid designs as well.

[1] No, I don't have a citation. I, however, have tried reading on full-screen on my 24" 1920x1200 96dpi [2] and gotta tell you - after 15 minutes my neck is cramping from the constant turning of my head.

[2] The typical user still runs 1024x768 or 1280x1024 (based on instrumentation from the product I work on, with about little bit less than 10mln installs for the latest version). So yeah, I am not the typical user.

2.  Design - most modern designs are very rich on graphical and video elements. Most graphical elements do not scale well with the document reflow and video does not scale at all. (I would again blame this on CSS - it's support for dynamic resizing of images is lacking some basic operations and there is aboslutely no support for building and control of the visual tree. But I digress again :-)) As such, disegners opt in for the easier approach.

3.  Functionality - fluid layout is really good for dealing with big text chunks like documents. However, quite a few modern websites are in effect applications, not documents. They have multiple elements and controls and increasing the area on which these elements are scatered makes it harder for the user to keep all of them in focus.

Couple examples:

*   two control groups that are aligned at the left and the right end will be too far away from each other in full-screen width. Note: that can be alleviated by choosing to always keep all the controls grouped together, like most desktop applications do (almost all desktop apps keep all toolbars left-aligned).
*   a picture/video and associated text below it. On full screen there are two possible approaches for fluid layout: a) scale the picture to the full width, at which point the text is visually lost b) leave the picture the same width, but let the text flow the full width, at which point the picture is visually lost.

I guess my point is that the fluid layout is not the Holy Grail of all layouts and there are scenarios where it's not applicable. The designer and the developer of the webapp should choose the appropriate layout and implement it so that it meets the needs of the target users, delivers the best experience of the product functionality and adapts to the user environment.

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-02-13T18:25:52.120

I suspect that most web developers go for fixed width because it's by far easier to develop such a site (in addition, many Content Management Systems only offer a fixed-width layout). Getting a dynamic layout to work well & correctly in different browsers is more tricky - but it is definity doable (I'm just recently working on that issue ;-).

And I do agree with you - I want web pages that dynamically adjust their contents to the browser size that **I as the 'customer'** like to work with (whether that's small or large). I don't like to be patronized into "not using my browser in full-screen mode" or anything the like...

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-02-13T18:07:31.213

[忘记我提到的窗口管理，它不是主题]

I currently run a big internet-community and we'll switch to fixed-width (for 1024px) design asap because we only get problems currently using a dynamic-width-layout: You cant rely on anything, and (the biggest problem imho) **text gets to long, so there are only a few lines but the lines themself are much to long to overview**.

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-02-13T18:19:55.550

You might try zooming in. Most modern browsers will zoom the whole page by default, not just the text. This preserves the page layout and uses more of your screen. Usually the shortcut is ctrl + + and ctrl + -. It works well on my laptop, at least

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2009-02-13T20:52:35.433

## Readability and Predictability

You need to know how things will be displayed to be sure it will be readable and pleasant to the eyes. By using a fixed width, you know exactly (almost exactly because of cross-browser support) what your users will see.

**However** fixed-width designs would be a thing from the past if browsers could support correctly exactly **2** CSS properties:

> min-width
> 
> max-width

That would allow designers to design web sites that would be **flexible and predictable**. No more surprises and users can use whatever resolution they want.

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-02-13T20:24:28.497

In my experience, it is for two reasons:

1) Speed - it is generally faster to write a web page in fixed with, rather than trying to write one that resizes correctly at more than a small number of resolutions.

2) The designer of the web site isn't the ultimate approver of what goes into production - if you try to work with a flow instead of fixed layout you get questions about why it looks different on Sallys' PC vs the Big bosses, and why can't you move this over to here, etc, which are easier to fix by moving to a fixed layout.

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2009-02-13T20:41:40.903

**Tabbed Browsers**

Since I use a tabbed browser for day to day use, resizing my window every time I switch tabs is actually a bit of a hassle. I have the window set to the maximum usable width for my purposes, and to accommodate the "largest" tab that is open. For the remaining tabs, having fluid layouts is actually kind of annoying and distracting. Items and text jump around and change position depending on how I may have resized my window for another tab. Also, fluid layouts result in uncomfortably wide blocks of short (vertically) text.

For me, it's a lot easier as a reader to keep my eyes tracking properly on narrower blocks of text with lots of vertical scroll, and it's *much* easier when sites I'm familiar with stay the same size so that the layout and positioning is predictable, regardless of what I've done to my window to accommodate other tabs. I actually used to be a big fan of fluid layouts, but I find more and more that I prefer fixed layouts now that I use a tabbed browser.

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2009-02-13T22:30:00.427

I think the question shouldn't be "Why would you choose a fixed-width design?" it should be **"why wouldn't you?"**

Firstly, you need to cater for the lowest-common denominator. Many developers will be running on screens with resolutions like 1680x1050, 1920x1200 and 1280x1024\. Some users will be using 1024x768, which I personally consider the lowest resolution you need to cater for (thank God it's not 800x600 anymore). If you fix the width to 960-1000 pixels then you don't run the problem of developers unintentionally making pages that can't be viewed without scrolling on a monitor with less than 1600 pixels (wide). Believe me it happens.

Layout on any non-trivial Webpage is hard. Throw in cross-browser support such that your page not only works but looks reasonably consistent and it's a huge problem. Now try to throw in variable width and it just gets that much worse if not impossible. Look at the payoff too: who is it going to benefit? A small minority of users that have high resolutions and actually want to stretch that content across the entire screen. I have a widescreen monitor and I won't maximize my browser for instance. Many people are like me in this respect.

Consider another problem: CSS. CSS s good for many things but is a royal pain in many others. For one thing. Now browser box model differences aside, there are still many quirks with how different browsers handle CSS and even if there weren't there are many trivial things CSS can't do and the only workaround is to do things by pixel.

As a concrete example, I'm doing some tables at the moment that are bursting at the seams. I'm reloading the contents with an Ajax call and replacing the contents. Now I at first tried to fix the widths of the columns with percentages. Doing it this way would be a prerequisite for not fixing the width. Firefox treated those as a suggestion and would resize them anyway even when it arguably didn't have to. I didn't get satisfactory results until I fixed the widths in pixels.

At the end of the day no website really cares if it stretches across 1600 pixels or not. That's what it comes down to.

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2009-02-23T15:26:42.160

I've worked with a lot of artists. They design a layout to be pleasing and clear. They want the presentation to match what they designed. Artist-driven design leads to fixed-width. For brochure sites, fixed width makes a lot of sense.

For sites with rapidly-changing content (news or shopping, or most anything driven by a CMS), I much prefer fluid, full-screen designs.

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2009-02-13T18:13:56.500

One of the biggest concerns that fixing the width of a website solves is readability. If you let a site be arbitrarily wide and have a block of text using that entire width, it becomes very difficult for people to read. If you make the font size bigger to compensate, then you destroy the experience for people with smaller screens.

On the other hand, if your content is visual or modular and you can make it fill up the page more intelligently, you might have a case for a totally fluid layout.

But I agree with the others who question why you would maximize a browser on such a big display. Why not make your browser window smaller? You'll be more productive and you'll stop worrying about it at the same time.

Many browsers do a better job of scaling websites to be larger than they used to; Firefox 3, at least, [grows the entire page when you zoom in](http://arstechnica.com/open-source/news/2007/07/firefox-3-gets-full-page-zoom.ars), not breaking the layout.

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2009-02-13T18:19:25.537

If you want it to take up more screen real estate, use a lower resolution. This can be useful if you're displaying a website on a large monitor up on a wall for public view. Otherwise, take @[theomega](https://stackoverflow.com/questions/547000/fixed-width-websites-in-2009-a-bad-idea/547026#547026)'s advice and use the rest of your screen for other windows.

As for a little (of the very little) of what I know about web design and fixed width sites:

*   They tend to make good use of white space and draw your focus down the page. Cluttering up the page by cramming every last corner with content is what designers call "visual intimidation." It's difficult to figure out what's important versus what's not.
*   They feel more "finished", like a picture in a frame instead of like a photo print thumb-tacked up on a cork board.

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2009-02-13T18:21:33.533

"It has a resolution of 1920x1200, so all fixed-width sites waste space The form factor is only 15". So I have to use larger fonts and the text won't fit into these crammed layouts any more, sometimes even getting obstructed by other elements."

There is a good reason for that. If the paragraph are stretched too wide, it gets more difficult to read. Humans need a "break" after about 15 to 20 words and that is EXACTLY why we don't have books that are very wide.

The higher resolution allows you to have MORE details BUT it also depends on HOW you use the space. I never maximize the browser and PC's are built for window multitasking, not ONE window at a time.

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2009-02-13T18:27:51.040

Fixed width layouts are perfectly acceptable.

Fluid layouts are nice, but are more difficult to implement, especially if there are more than two columns and source div order is important.

Line length is an issue regarding readability, but this interacts with font size. So you have to balance width against likely font sizes on screen.

Nowadays, it's reasonable to assume that 1024 x 768 and up is the vast majority of the desktop user market, so you can safely design for 960 px fixed width -- for screen media type.

A couple of important constraints:

*   ensure is that horizontal scrolling is *never* required by the user
*   if conversions are an issue, make sure that clickable things -- particularly "calls to action" or anything than makes your cash register go "ka-ching" should not fall to the right of the 770th pixel or so -- just in case.

But another consideration is handheld media. You should provide alternate CSS for handheld media type. Many of these screens are under 400 px wide.

Delivering a site that looks good and functions on a wide variety browsers, devices, display widths and viewport sizes is a moving target and continuous challenge.

As regards the filmstarts.de site, it is definitely a mess, but the problem is not that it is a fixed width layout, but rather with how the layout is designed and implemented. There are good and bad implementations of fixed width layouts, just like there are good and bad implementations of fluid layouts, or semi-fluid layouts with fixed width elements, etc.

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2009-02-13T18:56:44.807

The whole point of being able to adjust the size of your browser window is to better see the content of a web page, in the way that suits your situation. If the page isn't going to adjust, why not just make browser windows a single, fixed size?

If I have a big monitor, I want to be able to stretch my window out and have the content correctly fill it. If I need space for another window, I want to be able to shrink my browser window down and have the content correctly adjust by changing the layout (until a certain minimum point, and then by switching to a scroll bar, of course.)

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2009-02-13T21:16:14.817

I put it down to laziness. Fixed width layouts are simply easier to design and make look nice because you do not need to worry about the size changing. This, for example, makes it really easy to add images, since you know what size the layout will be.

Personally, fixed-width websites really irritate me. I like to use large monitors. I paid a lot of money for them, so I'd like to make use to make use of them instead of having most of it be left blank. This is made even worse by sites which refuse to get larger if I increase the font size. I don't have the best eyesight and often use larger fonts to read text on websites and nothing is worse than a fixed-width layout leaving me with three words per line and a mostly blank screen...

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2009-02-13T21:21:54.130

As far as I'm aware while all the reasons cited are valid, the primary reason is that a lot of machines in monolithic institutions like banks and government orgs are still on fixed and somewhat archaic low resolutions. It's just the lowest common denominator sadly.

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2009-02-19T23:18:21.963

I personally like fixed width sites better. I am not forced to mess with my browser window to get a line size I can deal with. I personally find very long lines very hard to read. I also just think it looks better although that is 100% completely subjective.

I have designed and worked with both. Some aspects of variable width sites make displaying data easier. The only problem I have had with them is due to right aligned navigation which was a little messy when it could move based on the user's browser setting.

My final answer - **both are fine and each have their place**.

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2009-02-26T09:07:49.503

I just came across this site, which actually has a link in the top right corner that lets you switch between fixed and fluid.

[http://developer.spikesource.com/wiki/index.php/Home](http://developer.spikesource.com/wiki/index.php/Home)

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2009-02-13T19:08:17.540

A major point for using fixed width is that the designer can actually control the way the webpage looks irrespective of browser environment. I see two reasons to use FW:

1.  The designer wants the webpage to look all the same.
2.  The designer lacks time/wish/... to test their page in different modes and in different browsers, and just avoids the risk of webpage layot starting flying around.

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2009-02-13T21:14:01.543

I didn't make fixed-size layout until I switched to a 32 inches monitor. It is very hard to read the text if the lines goes over 32 inches. I've learned appreciate text that do not span over more than 1,000 pixels, and I have switched to fixed layout since.

But I agree that reducing the content width to < 800px is a pain when you have a big monitor.

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2009-02-19T19:52:44.020

Most users lack understanding of how to use a browser properly. When the day come such that users actually know how to use a computer then you will understand that fluid width is the obvious choice for web sites.

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2009-02-19T19:59:10.860

I am frequently forced too. None of the 3 developers here has a strong background in design, and the dictated rules and implementations we strive for reflects this. It is an area I want to improve in.

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2009-02-25T06:56:49.547

Liquid layout using % as unit can adapt to any screen.

Some layouts must use fixed column design. If there's table or image in the column, you have to use fixed column, or the table or image will break the column in liquid design. In grid layouts with heights of the grid normally fixed, it's better using fixed column or the widths may got uneven.

It's upto the content of webpage to use elastic column or fixed column layout.

* * *

## 回答 #27

> 赞同：-1
> 
> 时间：2009-02-13T18:22:51.067

Long lines of text can be difficult to read. For the website I work on we limit the width for usability and readability. We have also designed our site to scale well using CTRL-+ to zoom.

# php - 保存推送标题以强制下载的远程文件

> ID：547005
> 
> 赞同：0
> 
> 时间：2009-02-13T18:03:41.283
> 
> 标签：php, http, file, download, http-headers

我可以使用 PHP 下载远程文件，但是如何从将标头推出的链接下载？我的意思是，您可以单击一些链接，它会强制下载并显示对话框以保存文件。如何使用 PHP**下载和保存**这类东西？

任何示例或教程链接都会很棒，因为我在这个主题上找不到任何有用的东西。

感谢您的任何帮助

## 更新并[已解决]

```
<?php

set_time_limit(300);

// File to download
$remoteFile = $_GET['url'];

$file = fopen($remoteFile, "r");

if (!$file) {
    echo "<p>Unable to open remote file.\n";
    exit;
}
$line = '';

while (!feof ($file)) {
    $line .= fgets ($file, 4096);
}

//readfile($line);
file_put_contents('here2.mp4',  $line);

fclose($file);

?> 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-13T19:04:51.200

只是试图重现情况。Gubmo 是对的，这种下载方法适用于我的*Content-Type: application/octet-stream*和*Content-type: application/force-download*标头。

[如此处](http://www.checkupdown.com/status/E410.html)所述，HTTP 410 意味着*客户端请求的 URL 不再可从该系统获得。这不是“从未听说过”的回应，而是“不再住在这里”的回应*。也许他们有某种防浸出系统。

应该对此进行调查。如果他们需要 cookie—— [stream-context-create](http://ua2.php.net/manual/en/function.stream-context-create.php)可以提供帮助。或者他们可能会检查推荐人。但我几乎可以肯定问题不在标题中。

希望这可以帮助。

**您询问过的**UPD示例代码。****

 **```
// file to download -- application/octet-stream
$remoteFile = 'http://dev/test/remote/send.php';
// file to download -- application/force-download
$remoteFile = 'http://chtyvo.org.ua/authors/Skriabin_Kuzma/Ya_Pobieda_i_Berlin.rtf.zip';
// file to store
$localFile = 'kuzma.zip';

$fin = fopen($remoteFile, "r");
if (!$fin) {
    die("Unable to open remote file");
}

$fout = fopen($localFile, "w");
if (!$fout) {
    die("Unable to open local file");
}

while (!feof($fin)) {
    $line = fgets($fin, 1024);
    fwrite($fout, $line, 1024);
}

fclose($fout);
fclose($fin); 
```

和你的一样。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-13T18:07:36.423

您可以像下载远程文件一样执行此操作。那些“强制下载”标头值只是告诉想要内联显示数据的用户代理来下载它们。但这对您的脚本没有任何影响，因为它无法显示数据。

# iphone - 简单的应用程序结构。你怎么看？

> ID：547006
> 
> 赞同：1
> 
> 时间：2009-02-13T18:04:26.087
> 
> 标签：iphone, objective-c, cocoa-touch

我对保留我的属性和内存管理方面的方式很感兴趣。这适用于编辑存储在表中的类信息的简单应用程序。有 3 个视图控制器。

*   列表视图（列出所有类）
*   所选项目的详细视图（列出所选类的属性）
*   编辑视图（列出
    所选类的单个属性并允许对其进行编辑）

这是目前的结构，你怎么看？

**列表视图控制器**

@property (nonatomic, 保留) NSMutableArray *pools;
@property (nonatomic, 保留) PoolFacilityEditController *childController;

要将新的类实例添加到表中，请单击运行此方法的添加按钮。

```
//Loads up the editPoolFacility controller to add a new pool 
```

-（无效）添加{

```
PoolFacilityEditController *editController = self.childController;

PoolFacility *aPoolFacility = [[PoolFacility alloc] init];

[self.pools addObject:aPoolFacility];
[aPoolFacility release];

editController.thePoolFacility = aPoolFacility;

editController.pools = self.pools;

[self.navigationController pushViewController:editController animated:YES]; 
```

}

下一个控制器现在已加载，这里是它有趣的实例变量。明智与否，我选择将池分配给新控制器而不是保留。我不想不必要地保留。

**详细视图**

```
@property (nonatomic, assign) PoolFacility *thePoolFacility; (assigned in the above add method) 
```

@property (nonatomic, assign) NSMutableArray *pools; （也在 add 方法中赋值）

详细视图具有执行以下操作的方法..

```
- (void)viewWillAppear:(BOOL)animated {

//Pass the copy onto the child controller
if (self.childController.thePoolFacility != self.thePoolFacility) {
    self.childController.thePoolFacility = self.thePoolFacility;
} 
```

}

池被传递到细节编辑控制器，因此它知道它正在编辑的池。

现在用户点击一个单独的池信息（例如名称）并且详细视图控制器弹出。它允许编辑单个属性。

有趣的属性如下所示：

```
@property (nonatomic, retain) PoolFacility *thePoolFacilityCopy; 
```

@property (nonatomic, assign) PoolFacility *thePoolFacility;

它会创建一个副本以供编辑，以防用户更改值然后想要取消。如果用户按下保存，它会将副本中的值复制到非副本中。

```
- (void)viewWillAppear:(BOOL)animated {

PoolFacility *poolCopy = [self.thePoolFacility copy];
self.thePoolFacilityCopy = poolCopy;
[poolCopy release]; 
```

}

如果按下保存或取消，则会弹出视图。

然后我们回到显示所有字段的中间视图。

现在，如果用户按下保存，我只需弹出视图控制器，我们就会返回列表视图。或者如果用户按下取消我运行这个方法。

```
-(void)cancel {

[self.pools removeObject:self.thePoolFacility];
[self.navigationController popViewControllerAnimated:YES]; 
```

}

**所以总结一下**

我在不同的视图控制器中分配一个属性，而不是保留它。

此外，我的视图控制器仅加载一次，并且在它们“消失”时不会被释放

我希望这有点道理！我的问题是..这是一个好方法吗？

谢谢，

担

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-13T19:21:24.950

我在这里没有看到一个具体的问题，所以我只会做一些一般性的批评。

1.  在 iPhone OS 中，取消按钮在用于添加新项目的对话框中很常见，但在编辑对话框中则更少。事实上，我能想到的编辑对话框上的取消按钮的唯一示例是在时钟应用程序的闹钟面板中。所以不用担心复制 PoolFacility 并在保存时将更改复制回来；只需使取消按钮仅对新对象可见（或使用废纸篓图标——取消新池和删除现有池实际上与现在设计的方式相同）。

2.  正如您现在拥有的那样，不存在在错误时间释放对象的危险。但是，如果您更改了存储方法——例如，让应用程序从磁盘延迟加载 PoolFacility 对象——它会回来咬你。今天写得好，明天你就不会痛苦了。正确的方法是使 thePoolFacility 成为保留属性并在您的 dealloc 方法中释放它。（如果您继续按照当前的方式管理池列表，您应该对它做同样的事情。）

3.  说到这一点，您没有显示现有的 PoolFacility 对象是如何加载的。他们来自哪里？如果正在进行某种数据库访问，您可能会发现在创建、更新或删除对象时让 PoolFacility 发送通知很有帮助，然后根据需要观察并响应适当的通知。我编写的所有存储用户数据的应用程序都采用这种方法；我发现它非常方便和灵活。

4.  由于只有一个池列表并且多个控制器都需要它，因此将其存储在您的应用程序委托中而不是传递它并不可耻。更好的是，编写一个管理列表的 FacilityList 单例对象。这可以让您从控制器中提取大量逻辑。通常，除了与屏幕交互的东西外，您应该将所有可以放入模型的东西都放入模型中。这意味着当 Apple 制作 iTablet 或发布 Apple TV SDK 时——或者当你决定制作 Mac 版本或重做用户界面时——你可以尽可能多地使用未经修改的应用程序。

# c++ - 如何在 C++ 中使用按位标志？

> ID：547011
> 
> 赞同：10
> 
> 时间：2009-02-13T18:05:08.817
> 
> 标签：c++, bit-manipulation

根据[这个](http://www.mazeworks.com/mazegen/mazetut/index.htm)网站，我希望用一个 16 位整数的二维数组来表示一个迷宫。

每个 16 位整数需要保存以下信息：

> 这是一种方法（这绝不是唯一的方法）：12x16 迷宫网格可以表示为 16 位整数的数组 m[16][12]。每个数组元素将包含网格中单个对应单元格的所有信息，整数位映射如下：
> 
> [![替代文字](https://i.stack.imgur.com/QmTW6.gif)](https://i.stack.imgur.com/QmTW6.gif)
> [（来源：[mazeworks.com](http://www.mazeworks.com/mazegen/mazetut/tut5.gif)）]
> 
> 要推倒一堵墙、设置边界或创建特定路径，我们需要做的就是翻转一个或两个数组元素中的位。

如何在 16 位整数上使用按位标志，以便我可以设置每个位并检查它们是否已设置。

我想以一种易于阅读的方式进行（即 Border.W、Border.E、Walls.N 等）。

这通常如何在 C++ 中完成？我是否使用十六进制来表示每一个（即 Walls.N = 0x02、Walls.E = 0x04 等）？我应该使用枚举吗？

* * *

另请参阅[如何设置、清除和切换单个位？](https://stackoverflow.com/questions/47981/how-do-you-set-clear-and-toggle-a-single-bit-in-c).

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-13T18:34:19.073

如果您想使用位域，那么这是一种简单的方法：

```
typedef struct MAZENODE
{
    bool backtrack_north:1;
    bool backtrack_south:1;
    bool backtrack_east:1;
    bool backtrack_west:1;
    bool solution_north:1;
    bool solution_south:1;
    bool solution_east:1;
    bool solution_west:1;
    bool maze_north:1;
    bool maze_south:1;
    bool maze_east:1;
    bool maze_west:1;
    bool walls_north:1;
    bool walls_south:1;
    bool walls_east:1;
    bool walls_west:1;
}; 
```

然后你的代码可以测试每一个的真假。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-02-14T09:12:22.113

采用[`std::bitset`](http://en.cppreference.com/w/cpp/utility/bitset)    

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-13T18:13:43.600

如果您关心哪些特定位的含义，请使用十六进制常量/枚举和按位运算。

否则，使用 C++ 位域（但请注意，整数中位的顺序将取决于编译器）。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-13T18:17:09.050

了解您的位运算符：&、|、^ 和 !。

在许多 C/C++ 文件的顶部，我看到了以十六进制定义的标志来屏蔽每一位。

```
#define ONE 0x0001 
```

要查看某个位是否打开，请与 1 进行“与”。要打开，请与 1 进行或。要像开关一样切换，请与 1 进行异或。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-20T12:16:56.587

要操作位集，您还可以使用 ....

`std::bitset<N>`

```
std::bitset<4*4> bits;
bits[ 10 ] = false;
bits.set(10);
bits.flip();
assert( !bits.test(10) ); 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-13T18:10:11.800

您可以按照您的建议使用十六进制标志或枚举来执行此操作，但最易读/自我记录的可能是使用所谓的“位域”（有关详细信息，Google for `C++ bitfields`）。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-13T18:15:09.197

是的，一个好方法是使用十六进制十进制来表示位模式。然后使用位运算符来操作 16 位整数。

例如：

```
if(x & 0x01){} // tests if bit 0 is set using bitwise AND
x ^= 0x02;     // toggles bit 1 (0 based) using bitwise XOR
x |= 0x10;     // sets bit 4 (0 based) using bitwise OR 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-05-19T04:12:08.297

我不是 bitset 的忠实粉丝。在我看来，这只是更多的打字。无论如何，它并没有隐藏你在做什么。你还是要 & && | 位。除非您只选择 1 位。这可能适用于一小组标志。并不是说我们也需要隐藏我们正在做的事情。但是一个类的目的通常是让它的用户更容易做一些事情。我不认为这门课能做到。

例如，您有一个带有 .. 64 个标志的标志系统。如果你想测试..我不知道.. 1 if 语句中有 39 个，看看它们是否都在......使用位域是一个巨大的痛苦。你必须把它们都打出来……当然。我假设你*只使用*位域功能，而不是混合和匹配方法。与位集相同。除非我在课堂上遗漏了一些东西。这是很有可能的，因为我很少使用它。我看不到一种可以测试所有 39 个标志的方法，除非你输入洞的东西或诉诸“标准方法”（使用枚举标志列表或 39 位的一些定义值并使用位集 && 运算符）。根据您的方法，这可能会开始变得混乱。我知道.. 64 个标志听起来很多。好吧。它是..取决于你在做什么。就个人而言，我参与的大多数项目都依赖于标志系统。所以实际上.. 64 并不是闻所未闻的。虽然 16~32 在我的经验中更为常见。实际上，我现在正在帮助一个标志系统具有 640 位的项目。它基本上是一个特权系统。

# relational-algebra - 如何计算自然连接？

> ID：547014
> 
> 赞同：2
> 
> 时间：2009-02-13T18:05:23.760
> 
> 标签：relational-algebra

有人可以向我解释这里发生了什么以及如何解决这个问题吗？

假设关系 R(A,B) 具有元组：

```
AB
1 2
3 4
5 6

```

并且关系 S(B,C,D) 具有元组：

```
BCD
2 4 6
4 6 8
4 7 9

```

计算 R 和 S 的自然连接。然后，确定以下哪些元组在自然连接
R |><| S. 你可以假设每个元组都有模式 (A,B,C,D)。

我不知道自然连接的真正含义。你能给我解释一下吗？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-02-13T18:13:43.507

自然连接是连接（“粘在一起”）来自两个匹配关系的元素。在这个例子中

*   (1, **2** ) 匹配 ( **2** , 4, 6) 所以你得到 (1, 2, 4, 6)
*   (3, **4** ) 匹配 ( **4** , 6, 8) 所以你得到 (3, 4, 6, 8)
*   (3, **4** ) 匹配 ( **4** , 7, 9) 所以你得到 (3, 4, 7, 9)

所以自然连接是 {(1, 2, 4, 6), (3, 4, 6, 8), (3, 4, 7, 9)}

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-13T18:15:11.287

我假设 R(A,B) 是主，S(B,C,D) 是细节，B 是外键。

SQL：从 R、S 中选择 *，其中 RB = SB

那么结果是：

A B C D

1 2 4 6

3 4 6 8

3 4 7 9

# mysql - 我如何存储订单？

> ID：547022
> 
> 赞同：12
> 
> 时间：2009-02-13T18:06:51.150
> 
> 标签：mysql, sorting, database-design

我有一个应用程序，里面有任务，你可以重新排序。现在我正在考虑如何最好地存储它们。我是否应该为 ordernumber 设置一个列并在每次更改时重新计算所有这些列？请告诉我一个不需要我更新所有订单号的版本，因为这非常耗时（从执行的角度来看）。

如果我必须将其放在订单的最顶部，然后将其拖到底部，这尤其糟糕。

*   名称（订单号）

--

*   1示例 (1)
*   2示例（2）
*   3示例（3）
*   4示例 (4)
*   5示例（5）

--

*   2示例 (1) *
*   3示例（2）*
*   4示例 (3) *
*   5示例 (4) *
*   1示例 (5) *

*必须在数据库中更改

还有一些任务可能会因为他们正在完成而被删除

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-02-13T18:16:40.723

您可以将订单保留为文字，并使用词法排序：

```
1\. A
2\. Z 
```

添加任务：

```
1\. A
3\. L
2\. Z 
```

添加更多：

```
1\. A
4\. B
3\. L
2\. Z 
```

在 1 和 4 之间移动 2：

```
1\. A
2\. AL
4\. B
3\. L 
```

等等

您一次只更新一条记录：只需在第一个不同的记录之间取一个平均字母：如果您放在 and 之间`A`，则`C`取`B`，如果放在 and 之间`ALGJ`，则`ALILFG`取`ALH`。

现有字母旁边的字母与 旁边的字母相连接`Z`。IE。如果你需要把 between `ABHDFG`and `ACSD`F 算作 between `ABH`and `AB(Z+)`, 写`AB(letter 35/2)`, 即`ABP`.

如果您用完了字符串长度，您可能总是会执行完整的重新排序。

**更新：**

您还可以将数据保存为链表。

请参阅我博客中的文章，了解如何做到这一点`MySQL`：

*   [**排序列表**](http://explainextended.com/2009/03/25/sorting-lists/)

简而言之：

```
/* This just returns all records in no particular order */

SELECT  *
FROM    t_list

id      parent
------- --------
1       0
2       3
3       4
4       1

/* This returns all records in intended order */

SELECT  @r AS _current,
        @r := (
        SELECT  id
        FROM    t_list
        WHERE   parent = _current
        )
FROM    (
        SELECT  @r := 0
        ) vars,
        t_list

_current id
-------  --------
0        1
1        4
4        3
3        2 
```

移动项目时，您最多需要更新`4`行。

这似乎是保持经常更新的有序列表的最有效方式。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-02-13T18:14:22.677

通常，我会按照您的建议添加一个名为“Ordinal”或“PositionOrdinal”之类的 int 或 smallint 列，并带有您提到的确切警告 - 每次重新记录单个记录时都需要更新可能大量的记录 -订购。

好处是给定特定任务的键和该任务的新位置，移动项目的代码只是两个语句：

```
UPDATE `Tasks` SET Ordinal= Ordinal+1 WHERE Ordinal>=@NewPosition
UPDATE `Tasks` SET Ordinal= @NewPosition WHERE TaskID= @TaskID 
```

对于双向链表或词汇顺序还有其他建议。两者都可以更快，但代价是更复杂的代码，并且只有在同一组中有**很多项目时，性能才重要。**

性能或代码复杂性是否更重要将取决于您的情况。如果您有数百万条记录，那么额外的复杂性可能是值得的。但是，我通常更喜欢更简单的代码，因为*用户通常只手动订购小列表*。如果列表中没有那么多项目，*那么额外的更新就无关紧要了。* 这通常可以处理数千条记录，而不会对性能产生任何明显影响。

更新示例要记住的一件事是，该列仅用于排序，而不是直接向用户显示。因此，当如图所示将项目从顶部拖到底部时，您唯一需要更改的是一条记录。将第一个位置留空并不重要。这意味着通过足够的重新排序来溢出整数排序的可能性很小，但让我再说一遍：*用户通常只手动排序小列表*。我从未听说过这种风险实际上会导致问题。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-13T18:33:52.850

根据您的回答，我想出了一个混合物，如下所示：

假设我们有：

*   1示例 (1)
*   2示例（2）
*   3示例（3）
*   4示例 (4)
*   5示例（5）

现在，如果我对 4 到 5 之间的东西进行排序，它看起来像这样：

*   2示例（2）
*   3示例（3）
*   4示例 (4)
*   1示例 (4.5)
*   5示例（5）

现在又在 1 到 5 之间

*   3示例（3）
*   4示例 (4)
*   1示例 (4.5)
*   2示例 (4.75)
*   5示例（5）

它总是取数字之间差异的一半

我希望作品请纠正我;）

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-21T21:21:25.037

这不是一个容易的问题。如果您的可排序元素数量很少，我会将它们全部重置为新顺序。

否则，“测试和设置”似乎需要同样多的工作或更多的工作来仅修改已更改的记录。

您可以将这项工作委托给客户端。让客户端维护旧排序顺序和新排序顺序并确定应该更新哪些行[排序顺序] - 然后将这些元组传递给 PHP-mySQL 接口。

您可以通过以下方式增强此方法（*不需要*浮点数）：

1.  如果列表中的所有可排序元素都根据它们在列表中的位置初始化为排序顺序，则将每个元素的排序顺序设置为类似于 row[sort-order] = row[sort-order * K] 其中 K是某个数字 > 您希望列表重新排序的平均次数。O(N)，N=元素的数量，但将插入容量增加至少 N*K，每个现有元素对之间至少有 K 个开放槽。

2.  然后，如果您想在其他两个元素之间插入一个元素，只需将其排序顺序更改为 > 下部元素和 < 上部元素。如果元素之间没有“空间”，您可以简单地重新应用上一段中介绍的“传播”算法 (1)。K 越大，应用的频率就越低。

K 算法将有选择地应用在 PHP 脚本中，而新排序顺序的选择将由客户端（可能是 Javascript）完成。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-13T18:14:46.297

我们使用数据库中的序列列来完成。

我们使用稀疏编号（例如 10、20、30，...），因此我们可以在现有值之间“插入”一个。如果相邻的行有连续的数字，我们会重新编号我们可以的最小行数。

您可能可以使用十进制数 - 取与您插入的位置相邻的行的序列号的平均值，然后您只需更新正在“移动”的行

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-13T18:14:12.100

我建议在数据库中有一个订单列。当一个对象被重新排序时，在您重新排序的对象和具有相同排序值的对象之间交换数据库中的 order 值，这样您就不必重新排序整个行集。

希望这是有道理的...当然，这取决于您重新订购的规则。

# regex - 正则表达式从字符串中查找特殊字符，但有一些例外

> ID：547024
> 
> 赞同：1
> 
> 时间：2009-02-13T18:07:02.447
> 
> 标签：regex

我需要编写一个小的正则表达式，当它与任何其他特殊字符一起出现时，它应该匹配文字字符 * 的出现。例如，我需要捕获所有这些事件`!* )* (* ** *.*`。例外是`*=`and `=*`，我想允许它。我尝试将正则表达式编写为

```
\W&&[^=]\*|\*\W&&[^=] 
```

但这似乎不起作用。有什么建议么？非常感谢您的帮助。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-13T18:42:01.800

```
(\*[^\w=]|[^\w=]\*) 
```

匹配星号后跟任何非单词字符（等号除外）或非单词字符后跟星号/

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-13T18:17:40.517

那个匹配你所有的*坏*样本：

```
(\!\*|\)\*|\(\*|\*\*|\*\.\*) 
```

如果您想要的不仅仅是这 4 种情况，请更好地描述一下，允许什么和禁止什么。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-13T18:30:34.823

试试这个

```
([^(\W\*)*(\*\W)*]|=\*|\*=) 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-13T18:25:44.680

我认为您正在寻找一个带有[lookbehind 和lookahead assertions](http://www.regular-expressions.info/lookaround.html)的正则表达式。就像是：

```
(?!=[\=\s])\*(?![\=\s]) 
```

# linux - 如何编写一个跟随光标的 X11 应用程序

> ID：547032
> 
> 赞同：2
> 
> 时间：2009-02-13T18:08:47.870
> 
> 标签：linux, unix, x11

我想编写一个根据我的喜好定制的 Linux 屏幕放大镜。理想情况下，放大的窗口将是一个大约 150 像素宽的正方形，无论鼠标光标走到哪里，它都会跟随。

在 X11 中可以做到这一点吗？有一个跟随鼠标的应用程序窗口会更容易，还是完全忘记窗口会更好（或可能），只是将鼠标指针设为 150x150 的正方形，放大下面的任何内容？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-13T18:14:39.667

看看[xeyes](http://en.wikipedia.org/wiki/Xeyes)的来源？

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-13T18:12:31.247

这实际上已经存在，它被称为[Xmag](http://www.xfree86.org/current/xmag.1.html)（在 Google 上搜索更多信息）。如果你想知道它是如何工作的，你可能想查看它的源代码。

*编辑*：看起来我误读了你的问题......如果你想要一个放大的正方形跟随鼠标指针，我想应该是可能的，但我不知道你会如何做的技术细节. 无论如何，开始的地方可能是以 Xmag 为起点。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-13T18:35:35.543

我不确定这是否可以作为自己的应用程序运行，或者必须集成到您的窗口管理器中。无论哪种方式，您都需要 libx11（可能有不同的发行版名称）。另外，我建议看看[swarp](http://www.suckless.org/programs/swarp.html)。我知道这甚至与您所说的不相近，但源代码只有 35 行，它显示了 libx11 可以做什么。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-04-18T19:42:05.783

我个人会制作一个无框窗口，始终保持在顶部，中间有一个 1px 的孔。用户所做的事件（鼠标点击、按键等）被传递到下面的窗口。

当用户移动它的光标时，它应该对您的窗口可见，您只需将其移动一点。对于放大部分，好吧 - 留给读者作为练习（因为我还不知道如何做到这一点;-)。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2018-11-12T13:52:42.580

Texworks 带有这样一个功能来检查排版乳胶源产生的 pdf。您还可以选择方形或圆形放大镜。请参阅[https://www.tug.org/texworks/](https://www.tug.org/texworks/)以访问可用于启动板的代码。

# vb.net - 如何正确编码这些通用函数和类继承？（VB.NET）

> ID：547033
> 
> 赞同：0
> 
> 时间：2009-02-13T18:09:18.510
> 
> 标签：vb.net, generics, inheritance

我有一个需要调用三种不同类型的函数，所有不同类型的底层逻辑保持相同，所以我认为最好使用泛型编写这个函数。

以下是所涉及的类和函数的基本概述：

```
'PO Base class'
Public MustInherit Class ProductionOrder
     Public MustInherit Class Collection(Of T)
          Inherits System.Collections.Generic.Dictionary(Of Long, T)
     End Class
     '....'
End Class

Public Class ProfileProductionOrder
     Inherits ProductionOrder
     Public Class Collection
          Inherits ProductionOrder.Collection(Of ProfileProductionOrder)
     End Class
     '....'
End Class

Public Class UnitProductionOrder
     Inherits ProductionOrder
     Public Class Collection
          Inherits ProductionOrder.Collection(Of UnitProductionOrder)
     End Class
     '....'
End Class

Public Class CrateProductionOrder
     Inherits ProductionOrder
     Public Class Collection
          Inherits ProductionOrder.Collection(Of CrateProductionOrder)
     End Class
     '....'
End Class

'Generic function, intended to work on profile, unit, and crate production orders.'
'This method resides in the base class of the GUI.'
Protected Sub FillPOCells(Of T As ProductionOrder.Collection(Of ProductionOrder)) _
    (ByVal dgv As DataGridView, ByVal ProductionOrders As T)
     '...do some stuff'
End Sub

'This function resides in the Profile child GUI class.'
Protected Sub LoadDataGridViewPOs()
     Dim dgv As DataGridView
     Dim ProductionOrders As ProfileProductionOrder.Collection
     '....'
     'Fill PO Cells'
     FillPOCells(Of ProfileProductionOrder.Collection)(dgv, ProductionOrders)
     '....'
End Sub 
```

ProductionOrder 基类和子类编译，FillPOCells 函数也是如此。但是当我在 LoadDataGridViewPOs 中调用 FillPOCells 时，编译器会抱怨“类型参数 'ProfileProductionOrder.Collection' 没有继承或实现约束类型 'ProductionOrder.Collection(Of ProductionOrder)'。

此外，这里有一些关于为什么以这种方式设置的解释。我的前任设置了将对象集合作为子类放入其中的约定，因此很容易将其称为 Obj.Collection。接下来，我们需要三种不同类型的生产订单的原因是因为它们的处理方式不同，并且存储在后端的不同表等中。最后，我意识到我可以相当容易地实现这一点，而无需让这个特定的泛型函数起作用，但我将其视为一种学习经验，以提高我对泛型和 OO 设计的理解。

所以问题是，为什么我会得到那个编译器错误，我应该如何改变我的类和泛型设计来完成我的想法？

如果您需要有关我正在尝试做什么或如何设置的任何进一步解释，请告诉我。主要思想是有一个函数可以获取一个集合，该集合的元素属于 ProductionOrder 子类之一，并对这些元素运行仅使用其 ProductionOrder 基类中保存的功能的操作（因此，为什么任何一个子类型都是可以在函数中操作）。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-13T19:37:25.550

```
'PO Base class'
Public MustInherit Class ProductionOrder(Of T)
     Public MustInherit Class Collection
          Inherits System.Collections.Generic.Dictionary(Of Long, T)
     End Class
     '....'
End Class

Public Class ProfileProductionOrder
     Inherits ProductionOrder(Of ProfileProductionOrder)
     '....'
End Class

Public Class UnitProductionOrder
     Inherits ProductionOrder(Of UnitProductionOrder)
     '....'
End Class

Public Class CrateProductionOrder
     Inherits ProductionOrder(Of CrateProductionOrder)
     '....'
End Class 
```

在我看来，这要简单得多。但我非常怀疑您是否需要 CollectionClass。

# sql-server-2005 - MS SQL2005 使用 SqlCommand 或任何其他方法查询/存储过程结果到文本

> ID：547040
> 
> 赞同：2
> 
> 时间：2009-02-13T18:10:19.210
> 
> 标签：sql-server-2005, text

我有一个简单的问题。

我需要将结果作为简单文本返回，可以是字符串或类似的。

即我想要相同的行为，例如

结果到文本 (Cntrl + T)

当您从 SQL Server Management Studio 运行查询时。

如何以编程方式针对从 C# 调用存储过程来完成此操作？

即类似于`ExecuteReader();`或`ExecuteXMLReader();`但返回一个字符串。

有一些`ToString()`可用的吗？

谢谢，凯。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-13T18:21:25.233

不，您必须自己通过读取 dbreader 来构建刺痛。

# perl - 如何在 Perl 中从 printf 呈现未定义的值？

> ID：547042
> 
> 赞同：4
> 
> 时间：2009-02-13T18:10:50.033
> 
> 标签：perl, printf, undef

我正在寻找一种优雅的方式来表示在格式化数字通常呈现的情况下未定义的值。我会举一个小例子。对于初学者，你当然不能使用这个：

```
#!/usr/bin/perl
use strict;
use warnings;
for my $s (1, 1.2, undef, 1.3) {
    printf "%5.2f\n", $s;
} 
```

...因为“使用警告”在第三次迭代中用“使用未初始化的值...”为您指明了方向。所以下一步是这样的：

```
#!/usr/bin/perl
use strict;
use warnings;
for my $s (1, 1.2, undef, 1.3) {
    printf "%5.2f\n", $s//0;
} 
```

顺便说一句，男孩，我喜欢新的 5.10 '//' 运算符吗？但这也不是我想要的，因为 $s 的值不是零，它是未定义的。我真正想要的是这样的：

```
#!/usr/bin/perl
use strict;
use warnings;
for my $s (1, 1.2, undef, 1.3) {
    printf "%5.2f\n", $s//q();
} 
```

...但我不能，因为这会在第三个值上产生“参数”不是数字...”问题。

这把我带到了我的问题的门口。我当然可以编写代码来检查我发出的每个数字的定义性，并创建一个完全不同的非基于 %f 的 printf 格式字符串，但是，嗯，...哎呀。

有没有人定义了一种很好的方法来处理这种类型的需求？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-13T18:17:35.587

它不漂亮，但我只是这样做

```
defined($s) ? printf "%f.2f\n", $s : print "undef\n"; 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-13T18:23:56.773

我不认为这有什么不好的*——*这正是你想做的。

```
use strict;
use warnings;

my($raw) = [1, 1.2, undef, 1.3];
my($formatted) = [map((defined $_ ? sprintf('%5.2f', $_) : "(undef)"), @$raw)];

print '$formatted: <', join('> <', @{$formatted}), qq(>\n); 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-13T18:27:45.080

我认为最好的方法是编写/获取一个通用的*漂亮*打印机，它可以接受你扔给它的任何东西，然后执行：

```
#!/usr/bin/perl
use strict;
use warnings;
use MyPrettyPrinter;
for my $s (1, 1.2, undef, 1.3) {
    print MyPrettyPrinted($s), "\n";
} 
```

# asp.net-mvc - asp.net mvc 用户权限和视图

> ID：547049
> 
> 赞同：1
> 
> 时间：2009-02-13T18:12:23.230
> 
> 标签：asp.net-mvc, security, authentication, permissions

在处理 mvc 中视图的安全权限时，似乎有 2 个选项：

1.  要么处理控制器中的权限控制逻辑并将用户引导到适当的视图......
2.  或者实现某种形式的安全感知 HtmlHelper 扩展来呈现（或不呈现）适当的表单字段/数据

我在这里错过任何其他选择吗？第一个似乎荒谬地不干燥，第二个似乎与视图的定义相矛盾......

所以我的问题是：有没有更好的方法？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-13T18:29:16.887

我不同意（2）与视图的想法相矛盾的想法。根据从控制器接收的数据渲染或不渲染视图的特定组件对我来说似乎非常合适。我认为，您是选择要求数据在模型中还是可以从其他服务器资源中使用，这取决于您想成为多么迂腐。我选择更务实，简单地使用所提供的内容，而不是制造一个新模型来保存与角色相关的信息，因此在某些情况下（链接我的菜单控件）我只是在视图逻辑中进行角色检查。

重要的是要记住 MVC 是一种模式——而不是格言。在图案似乎对您不利的地方，可以稍微弯曲一下。同样，DRY 是原则而非法律。如果最好重复一些代码以更好地完成目标，请继续重复它。了解您正在为自己制造维护问题，但不要让严格遵守原则妨碍您做“正确的事情”。

# project-management - 是否有任何工具可以私下向客户展示他们的工作进度并与开发人员进行讨论？

> ID：547051
> 
> 赞同：0
> 
> 时间：2009-02-13T18:12:39.407
> 
> 标签：project-management

我的老板让我找到一种系统，让客户能够登录网站并将他们的网站视为正在进行的工作（因此员工显然必须能够上传他们的工作）。所有通讯将通过本网站处理。

这听起来像是一个论坛，但客户将无法看到彼此的项目。它是私人的，唯一可以看到*所有*客户项目的人是员工。

我确信我可以使用论坛和一些可见性选项来实现它，但我只是想知道是否有人知道任何类似的系统。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-13T18:22:31.597

像[Basecamp](http://www.basecamphq.com/)这样的东西会起作用 - 为每个客户/项目设置一个 Basecamp 项目，并且只允许客户访问适当的项目，而您的员工可以访问所有项目。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-13T18:36:38.413

如果您在 Windows 平台上，Sharepoint 始终处于启用状态。也不妨看看[Mingle](http://studios.thoughtworks.com/mingle-agile-project-management)。我没有在几个版本中使用它，但它显示出真正的希望。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-13T18:39:22.260

我看到的大多数人都无法在互联网上查看实际的网站——因为它很容易复制底层的 HTML（当然，除非其中大部分是服务器端脚本，但那是另一家商店）。大多数情况下，他们只是获得屏幕截图（也许是在开发人员机器上进行用户测试），直到大部分资金转手为止。

为什么不建立一个公告板（如 phpBB，但不一定是 phpBB）并隔离每个客户可以看到的内容。然后你可以在每个客户的区域发布截图，让他们评论和讨论？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-13T19:49:00.063

我们在页面底部（在我们的 DEV 网站上）有一个论坛风格的部分，人们可以在其中添加评论。想法是，发现问题的测试人员将在添加新的（可能重复的）评论之前检查页面底部的评论。

我们允许在内部分配问题，然后在修复后将其分配回作者以供批准。

此外，测试人员将页面标记为“可操作”或“损坏”。我们有一份尚未审核的页面报告，因此测试人员可以确保他们已达到 100% 的覆盖率。

我们有例程将所有页面重置为“需要测试”（准备好进行另一轮测试），可选择将页面标记为“已损坏”，或将所有页面重置为“需要测试”。

我们倾向于为此使用子域 - 所以 TEST.MyDomain.COM - 并且将 ROBOTS.TXT 设置为禁止所有搜索引擎爬取 - 所以只有那些知道的人才能找到该站点。（我想你可能更偏执，需要密码访问，但我们的客户即将推出该网站，而不是偏执于外人看到它 - 事实上，他们经常要求客户等看看）

话虽如此，我们确实有一个“已知用户登录”，它不提供特定的管理员权限，但会记录该特定用户的任何评论 - 如果我们无法弄清楚他们的评论到底意味着什么，这总是有用的！

# .net - 使用 ADO.NET Entity Framework 的存储过程

> ID：547063
> 
> 赞同：2
> 
> 时间：2009-02-13T18:14:30.697
> 
> 标签：.net, entity-framework, ado.net

我正在尝试在实体框架中使用存储过程。我最初创建的模型没有存储过程。然后我从数据库进入更新模型并选择我想要的存储过程，然后通过函数导入添加它。现在我可以在函数导入下的模型浏览器中看到该函数，但是当我尝试在对象上下文中调用它时，我收到错误消息，提示“xxModel”不包含“xxfunction”的定义。知道我做错了什么吗？

我在与 proc 相关的文件中看不到任何错误。

这是 edmx 文件中存储过程的标签

```
 <Function Name="p_DeleteDealFacts" Aggregate="false" BuiltIn="false"
        NiladicFunction="false" IsComposable="false"
        ParameterTypeSemantics="AllowImplicitConversion" Schema="dbo">
        <Parameter Name="DealID" Type="int" Mode="In" />

    <FunctionImportMapping FunctionImportName="DeleteDealFacts"
          FunctionName="InterceptModel.Store.p_DeleteDealFacts" />
</EntityContainerMapping> 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-12-29T16:31:05.093

当且仅当您将返回指定为实体类型时，Visual Studio 才会在模型的代码隐藏中生成函数代码。标量和空返回类型不起作用。对我来说似乎是一个错误。这是完整的故事：[具有非实体返回类型的实体模型中的函数导入](https://stackoverflow.com/questions/578536/function-imports-in-entity-model-with-a-non-entity-return-type)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-13T19:14:23.453

在 XML 视图中打开您的实体数据模型并检查您是否有任何

<!--在生成过程中发现错误：警告 XXXX: The table/view/stored proc .....MDF.dbo.StoredProcName' does not have .... -->

标签

如果您不这样做，则搜索您的 <Function Name="{Name}" /> 标签，并搜索该 {Name}。检查以确保没有任何不妥之处。

如果您找不到任何问题，请在您的问题中发布这些标签和您的存储过程。

# .net - 为什么我的 Linq to Entities 代码重复行？

> ID：547064
> 
> 赞同：0
> 
> 时间：2009-02-13T18:14:36.157
> 
> 标签：.net, linq, entity-framework, hierarchy

我正在使用 ADO.NET Entity Framework 来管理对象的层次结构。每个人都有一个单亲和零个或多个孩子。

[ADO.NET 实体框架对象与父和子 http://img14.imageshack.us/img14/7158/thingpi1.gif](http://img14.imageshack.us/img14/7158/thingpi1.gif)

我在我的 WPF 应用程序中使用 TreeView 控件呈现这些。只需单击一个按钮，即可将新事物作为子项添加到所选事物中...

视觉基本...

```
Private Sub ButtonAddThing_Click(...) 处理 ButtonAddThing.Click
    将新事物视为新事物
    NewThing.Id = Guid.NewGuid()
    NewThing.Parent = DirectCast(TreeViewThings.SelectedItem, Thing)
    ...
    db.AddToThing（新事物）
    db.SaveChanges()
    TreeViewThings.UpdateLayout()
结束子

```

但是，有一个问题。它不是简单地将新事物添加到数据库中，而是首先添加父事物的副本，但奇怪的是，ID 的唯一标识符为空。

这会使数据库变得混乱，并在第二次单击按钮 ButtonAddThing 后引发以下异常。

> 例外：“违反主键约束‘PK_Thing’。无法在对象‘dbo.Thing’中插入重复键。语句已终止。”

这些是生成的 T-SQL 插入语句...

父副本：

```
exec sp_executesql N'insert [dbo].[Thing]([Id], [ParentId], ...)
values (@0, @1, ...) ',N'@0 uniqueidentifier,@1 uniqueidentifier,...',
@0='00000000-0000-0000-0000-000000000000',
@1='389D987D-79B1-4A9D-970F-CE15F5E3E18A',
...

```

新事物：

```
exec sp_executesql N'insert [dbo].[Thing]([Id], [ParentId], ...)
values (@0, @1, ...) ',N'@0 uniqueidentifier,@1 uniqueidentifier,...',
@0='88641EBB-B7D7-4203-8191-B27E1D1E1840',
@1='391FF0D9-40ED-4349-BB91-0F2E440EF8C9',
...

```

为什么我的 Linq to Entities 代码会重复这些父行？如何正确处理这种父/子关系？

* * *

更新：这不仅仅是创建新事物时的问题。我的“删除”按钮也不能正常工作。

```
私有子按钮DeleteThing_Click(...)
    db.DeleteObject(DirectCast(TreeViewThings.SelectedItem, Thing))
    db.SaveChanges()
结束子

```

也不

```
私有子按钮DeleteThing_Click(...)
    Dim Id As Guid = DirectCast(TreeViewThings.SelectedItem, Thing).Id
    Dim DoomedThing As Thing = (From t In db.Thing _
                                其中 t.Id = Id _
                                选择 t).First
    db.DeleteObject(DoomedThing)
    db.SaveChanges()
结束子

```

我在调试应用程序时正在监视 SQL Server Profiler。观察到的行为：

1.  第一个按钮单击删除就好了。
2.  第二个按钮单击插入一个重复的父项（空 GUID 唯一标识符主键），然后执行删除。
3.  第三个按钮单击失败（违反 PRIMARY KEY 约束），因为它无法插入具有空 GUID 主键的第二个事物。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-13T18:29:25.513

你应该能够做这样的事情：

```
Dim ParentId As Guid = DirectCast(TreeViewThings.SelectedItem, Thing).Id
NewThing.Parent =（从 t 在 db.Thing _
                  其中 t.Id = ParentId _
                  选择 t).First

```

这将建立你想要的层次模型。

# c - 为什么 gcc 的所有错误消息中都有“â”？

> ID：547071
> 
> 赞同：13
> 
> 时间：2009-02-13T18:15:12.020
> 
> 标签：c, linux, gcc

出于某种原因，我安装的 gcc 似乎正在打印一个“a with a carat”字符来代替其错误消息中的所有 %s，例如，

```
test.c:4: error: expected â, â, â, â or â before â token 
```

有没有其他人见过这个？（不用说，很难用谷歌搜索。）

（这是在 Ubuntu 8.10 上）

编辑：http://ubuntuforums.org/showthread.php?t=252832 的人[说](http://ubuntuforums.org/showthread.php?t=252832)要设置 LC_MESSAGES=en_US 但这对我没有任何作用。

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-02-13T18:31:03.213

啊哈！问题是我有 LANG=en_US.UTF-8 并且正在使用 xterm。显然，这并不好。通过设置 LANG=C 或 LANG=en_US，现在一切都很好。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-02-13T18:18:35.897

**您的 LANG 设置是什么（在终端中的 bash 上调用“导出”）？**尝试将 Lang 设置为正确的值，例如

LANG="en_US.UTF-8"

使用

声明 -x LANG="en_US.UTF-8"

这似乎是一个字符集问题，所以也许您想使用正确的进行仔细检查。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-13T18:19:03.727

对我来说似乎很疯狂，但我只是想说明一下，您可以通过将 ^ 称为抑扬符来更轻松地搜索它，这通常是用作重音时的名称。

# sql-server - SQL Server：如何向现有表添加约束，但前提是约束不存在？

> ID：547074
> 
> 赞同：16
> 
> 时间：2009-02-13T18:16:30.817
> 
> 标签：sql-server, sql-server-2005

我需要向现有的 SQL 服务器表添加一个约束，但前提是它不存在。

我正在使用以下 SQL 创建约束。

```
ALTER TABLE [Foo] ADD CONSTRAINT [FK_Foo_Bar] FOREIGN KEY ([BarId]) REFERENCES [Bar] ([BarId]) ON UPDATE CASCADE ON DELETE CASCADE 
```

我希望我可以在 SQL 的开头添加一些 SQL 来测试约束的存在，但我不知道如何。

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2009-02-13T18:18:56.193

就我个人而言，我会放弃现有的约束，并重新创建它——以防已经存在的约束在某种程度上有所不同

```
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'[dbo].[MyFKName]') AND OBJECTPROPERTY(id, N'IsForeignKey') = 1)
    ALTER TABLE dbo.MyTableName DROP CONSTRAINT MyFKName
GO
ALTER TABLE dbo.MyTableName ADD CONSTRAINT [MyFKName] ... 
```

我正在使用的当前更现代的代码是：

```
IF EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[MyFKName]') AND parent_object_id = OBJECT_ID(N'[dbo].[MyTableName]'))
    ALTER TABLE dbo.[MyTableName] DROP CONSTRAINT [MyFKName]
GO
ALTER TABLE dbo.[MyTableName] ADD CONSTRAINT [MyFKName] FOREIGN KEY ... 
```

不确定检查 sys.objects ... 或 sys.foreign_keys 是否有任何优势 ...但在某些时候我决定使用 sys.foreign_keys

从 SQL2016 开始，添加了新的“IF EXISTS”语法，可读性更强：

```
-- For SQL2016 onwards:
ALTER TABLE dbo.[MyTableName] DROP CONSTRAINT IF EXISTS [MyFKName]
GO
ALTER TABLE dbo.[MyTableName] ADD CONSTRAINT [MyFKName] FOREIGN KEY ... 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-02-13T18:50:48.347

我建议使用 INFORMATION_SCHEMA.TABLE_CONSTRAINTS 视图。它可以跨不同的数据库引擎移植：

```
SELECT COUNT(*) 
FROM INFORMATION_SCHEMA.TABLE_CONSTRAINTS 
WHERE TABLE_NAME='Foo' 
AND CONSTRAINT_NAME='FK_Foo_Bar' 
AND CONSTRAINT_TYPE='FOREIGN KEY' 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-08-10T06:55:07.720

```
Alter table tableName add constraint constraintname default 0  for columnname 
```

您可以根据需要提供约束名称，而无需单引号

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2014-10-08T09:29:14.643

删除默认约束并创建自己的约束。ALTER table TABLE_NAME 删除约束 CONSTRAINT NAME GO ALTER TABLE [dbo].[TABLE_NAME] ADD CONSTRAINT [DF_TABLE_NAME_COLUMN_NAME] FOR [COLUMN_NAME]

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2016-09-15T05:46:28.427

在添加之前检查约束是否已经存在 -

```
 IF NOT EXISTS(SELECT * FROM INFORMATION_SCHEMA.REFERENTIAL_CONSTRAINTS WHERE CONSTRAINT_NAME = 'FK_Foo_Bar')
    BEGIN
    ALTER TABLE dbo.MyTableName ADD CONSTRAINT [MyFKName] ...
    END 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2018-02-23T15:31:59.667

非常简单：

如果 OBJECT_ID('Schema.keyname') 为 NULL

ALTER TABLE Schema.tablename 添加约束键名...

# java - .DM 文件类型（手机 DRM）的有效内容类型值是什么

> ID：547091
> 
> 赞同：2
> 
> 时间：2009-02-13T18:19:01.760
> 
> 标签：java, mobile, soap, drm

遵守 NDA 限制我必须含糊其辞。

我的任务是评估将 .dm 文件从客户系统强制传输到蜂窝设备的可行性。到目前为止，我知道我可以发送带有 txt 和 gif|jpg 有效负载的 smil 有效负载，但不能发送 .dm 文件。

在有效负载开始之前，在 DRM 包装器内部有一个标头前缀。

```
 Content-Type: audio/mpeg
   Content-Transfer-Encoding: binary 
```

从我们的东西到手机的桥接是通过一个 SOAP 桥接器，而现在搞砸的事情是我不知道要告诉它我要发送什么。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-13T18:30:30.050

我通过快速搜索找到了这个，它建议使用“application/vnd.oma.drm.message”。

[http://discussion.forum.nokia.com/forum/showthread.php?t=87421](http://discussion.forum.nokia.com/forum/showthread.php?t=87421)

[http://discussion.forum.nokia.com/forum/showthread.php?t=51823](http://discussion.forum.nokia.com/forum/showthread.php?t=51823)

# design-patterns - 多态属性设计模式

> ID：547105
> 
> 赞同：0
> 
> 时间：2009-02-13T18:22:08.620
> 
> 标签：design-patterns, properties

我有这个大的多态对象层次结构，我想使用原始类型将这些对象公开给另一种语言。我在想我的基础对象将有一个属性字典（C++），并且层次结构中的每个子类都将添加属性或修改属性，然后当我转发到另一种语言时，我不需要任何强制转换 - 我只是发送类型和属性字典。

想法？

更新：如果相关，我正在通过第三方库桥接 C++ 和 ActionScript。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-13T18:38:52.917

我不明白 C++ 中的“属性”是什么；而且我不明白您的各种类将实现哪些方法，并从其他语言调用。

您正在考虑的伪代码示例可能会使这一点更清楚。

除了 CORBA，另请参阅 COM 和 Web 服务（它们是实现与语言无关的跨进程 IPC 的其他标准方法）。

# mysql - 存储 MySQL GUID/UUID

> ID：547118
> 
> 赞同：32
> 
> 时间：2009-02-13T18:27:39.557
> 
> 标签：mysql, binary, guid, uuid

这是我能想出的将 UUID() 生成的 MySQL GUID/UUID 转换为二进制 (16) 的最佳方法：

```
UNHEX(REPLACE(UUID(),'-','')) 
```

然后将其存储在 BINARY(16)

这样做有什么我应该知道的含义吗？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-13T18:35:29.007

影响不大。它会稍微减慢查询速度，但您几乎不会注意到它。

`UNIQUEIDENTIFIER``16-byte binary`无论如何都存储在内部。

如果您要将二进制文件加载到客户端并在那里解析它，请注意`bit order`，它可能有其他字符串表示形式而不是初始`NEWID()`.

`Oracle`的`SYS_GUID()`函数很容易出现这个问题，将其转换为字符串会在客户端和服务器上产生不同的结果。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2018-04-21T07:39:00.123

从 MySQL 8.0 及更高版本您可以使用[UUID_TO_BIN](https://dev.mysql.com/doc/refman/8.0/en/miscellaneous-functions.html#function_uuid-to-bin)：

> **UUID_TO_BIN(string_uuid)** , UUID_TO_BIN(string_uuid, swap_flag)
> 
> 将字符串 UUID 转换为二进制 UUID 并返回结果。（IS_UUID() 函数描述列出了允许的字符串 UUID 格式。）返回的二进制 UUID 是一个 VARBINARY(16) 值。

```
CREATE TABLE t (id binary(16) PRIMARY KEY);

INSERT INTO t VALUES(UUID_TO_BIN(UUID(), true));
INSERT INTO t VALUES(UUID_TO_BIN(UUID(), true));
INSERT INTO t VALUES(UUID_TO_BIN(UUID(), true));

SELECT *, BIN_TO_UUID(id) FROM t; 
```

**[DB-Fiddle.com 演示](https://www.db-fiddle.com/f/qGbAKZpuGHAGd62sMvFQVZ/0)**

# ruby - 在 Ruby 中，如何替换字符串中的问号字符？

> ID：547127
> 
> 赞同：6
> 
> 时间：2009-02-13T18:29:36.057
> 
> 标签：ruby, string, uri, substitution

在 Ruby 中，我有：

```
require 'uri'
foo = "et tu, brutus?"
bar = URI.encode(foo)      # => "et%20tu,%20brutus?" 
```

我试图让 bar 等于 "et%20tu,%20brutus%3f" ("?" 替换为 "%3F") 当我尝试添加这个时：

```
bar["?"] = "%3f" 
```

这 ”？” 匹配一切，我得到

```
=> "%3f" 
```

我试过了

```
bar["\?"]
bar['?']
bar["/[?]"]
bar["/[\?]"] 
```

还有一些其他的东西，它们都不起作用。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-02-13T18:37:22.997

`require 'cgi'`并打电话`CGI.escape`

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-13T18:33:00.853

这是一个示例 irb 会话：

```
irb(main):001:0> x = "geo?"

=> "geo?"

irb(main):002:0> x.sub!("?","a")

=> "geoa"

irb(main):003:0> 
```

但是， sub 只会替换第一个字符。如果要替换字符串中的所有问号，请使用如下`gsub`方法：

```
str.gsub!("?","replacement") 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-05-23T20:42:09.587

现在在 Ruby 中只有一种好方法可以做到这一点：

```
require "addressable/uri"
Addressable::URI.encode_component(
  "et tu, brutus?",
  Addressable::URI::CharacterClasses::PATH
)
# => "et%20tu,%20brutus%3F" 
```

但是，如果您正在使用 URI 进行操作，那么无论如何您都应该使用[Addressable](https://github.com/sporkmonger/addressable)。

```
sudo gem install addressable 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2017-11-28T13:19:10.380

如果您知道接受哪些字符，则可以删除不匹配的字符。

```
accepted_chars = 'A-z0-9\s,'
foo = "et tu, brutus?"
bar = foo.gsub(/[^#{accepted_chars}]/, '') 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2021-06-23T00:04:21.697

`URI.escape`接受可选参数来告诉您要转义哪些字符。它会覆盖默认值，因此您必须调用它两次。

```
> URI.escape URI.escape("et tu, brutus?"), "?"
=> "et%20tu,%20brutus%3F" 
```

# c# - 由于目标机器主动拒绝，无法建立连接

> ID：547134
> 
> 赞同：3
> 
> 时间：2009-02-13T18:33:26.360
> 
> 标签：c#, .net, tcp, tcpclient, tcplistener

我正在使用 C# 开发一个简单的 hello world TCP/IP 客户端服务器应用程序，但无法让我的客户端连接。谁能提供任何额外的故障排除步骤？我开始没有想法了...

以下是相关的代码部分：

服务器：

```
Console.Out.WriteLine("About to bind address");
IPAddress ipAd = IPAddress.Parse("127.0.0.1"); 
Console.Out.WriteLine("Choose a port to bind...");

String port = Console.In.ReadLine();
int iPort = Int32.Parse(port);

TcpListener myList = new TcpListener(ipAd, iPort);

myList.Start();

Console.WriteLine("The server is running at: "+myList.LocalEndpoint);
Console.WriteLine("Waiting for a connection.....");

Socket s = myList.AcceptSocket();
Console.WriteLine("Connection accepted from " + s.RemoteEndPoint); 
```

客户：

```
Console.Out.WriteLine("enter address: ");
string address = Console.In.ReadLine();
Console.Out.WriteLine("enter port: ");
int port = Convert.ToInt32(Console.In.ReadLine());

TcpClient tcpclnt = new TcpClient();
Console.WriteLine("Connecting.....");

Console.Out.WriteLine("Address: " + address + ":" + port);
tcpclnt.Connect(address, port); 
```

我能够从客户端机器 ping 服务器，但是我无法使用绑定端口远程登录到服务器。我尝试了各种端口（一些在 8000 的低端，一些在 40000 左右）。我在两个系统上都禁用了 Windows 防火墙。这些系统连接到不在互联网上的路由器。我尝试过设置和不设置端口转发以将给定端口上的传入请求转发到服务器机器，但没有任何效果。

我能够捕获的唯一异常是客户端抛出的：

> 由于目标机器主动拒绝，无法建立连接。

我检查了一个`InnerException`，但似乎没有 - 这是基本异常。这可能是对的吗？

不知道我还应该看什么 - 任何额外的故障排除步骤都会有所帮助。

谢谢！

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-13T18:39:24.270

我以前遇到过这个。诀窍是绑定到`0.0.0.0`而不是`127.0.0.1`. 当您绑定到`127.0.0.1`服务器时，将只接受来自 localhost 的连接。绑定到`0.0.0.0`它将接受所有请求。

您可能还想从客户端[映射](http://nmap.org/download.html)主机并查看它认为哪些端口处于打开状态。

**编辑：**如果您在其中硬编码机器的 IP 地址，则侦听器将仅在该网络接口上侦听。如果您使用`0.0.0.0`侦听器，将侦听所有可用的网络接口。这包括您的计算机和连接 USB 的手持设备、第二张网卡或 VPN 链接之间的接口。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-02-13T18:35:57.650

上面的代码正在监听来自环回地址的请求。这将有效地仅侦听该网络上的连接，并且该网络仅包括您的计算机。

您是否尝试过监听绑定到连接应该来自的网络的地址？在本地网络上，它应该类似于 192.168.xx 或 10.xxx

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-13T18:35:04.860

在您的机器上尝试`netstat -al`（确切的命令行在 Windows 和 unix 之间有所不同）并查看服务器是否正在侦听端口

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-13T18:38:16.800

为什么不使用 .NET 远程处理？它比做一个 TCP/IP 客户端服务器要好。您可以在对象之间传递消息。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-13T18:38:45.410

您是否尝试在同一台机器上运行客户端服务器以确保首先建立连接？除此之外，尝试使用分配的路由器或运行服务器的机器的静态 IP 与绑定到环回。

# .net - System.Collections - 为什么有这么多选项？

> ID：547137
> 
> 赞同：2
> 
> 时间：2009-02-13T18:34:37.183
> 
> 标签：.net, arrays, collections, list

我的大部分编程经验都是使用一种语言，其中有一个集合数据结构——数组。现在我主要在 .NET 中工作，我开始欣赏大量可用的工具，但我也发现很难确定哪些工具最适合每个问题。我发现收藏品经常出现这种情况。

我敢肯定，凭借时间/经验，我将能够更快地找到适合该工作的工具，但是任何人都可以就哪些收藏类适合哪些工作提供一些指导吗？有什么好的经验法则可以遵循吗？

**编辑：**我发现我几乎总是使用 List(T)，这就是引发这个问题的原因。我知道使用其他类有非常具体的原因。尽管 List(T) 大部分时间都有效，但我想避免在另一个结构更适合时将某些内容塞入通用列表中。我必须能够发现这些情况。

谢谢！

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-02-13T18:39:58.123

你没有说你以前用过什么语言，但我很有信心说，如果你认为数组是唯一可用的东西，那么你可能弄错了。

例如，C++ 仅本地支持数组“集合”（“集合”在这里使用得非常松散），但是通过添加指针，您可以为 .Net 中可用的任何集合数据结构实现等价物。事实上，如果您查看 C++ 标准模板库，您会发现大多数常见结构的库存实现。

额外结构的原因是数组并不总是，甚至经常是用于数据集合的最合适的结构。它有许多限制可以通过一个或另一个集合来解决，并且使用这些不同的集合，您通常可以用*更少的代码获得**更高的*性能，并减少数据结构实现中出现错误的机会。

 *在决定使用哪种集合类型时，您需要查看它*最常*被使用的方式。例如，集合中的所有对象是否都应为同一类型、继承自同一类型或任何类型？你会经常添加和删除项目吗？如果是这样，您是否总是推送/弹出、排队/出列项目，或者您是否需要将项目添加到特定位置？您会按键、按索引或同时按两者查找特定项目吗？如果通过key，key是如何确定的？

一些比较常见的集合：

*   `List<T>`可能应该在您习惯使用数组的*大多数情况下使用。*它支持使用与数组相同的语法按索引查找，性能接近数组，是强类型的，并且*非常*容易添加或删除项目，并且非常快速地追加或弹出项目（插入到特定位置是慢得多）。

*   `LinkedList<T>`如果您接受过任何正式的计算机科学培训，应该听起来很熟悉。它使用类似于 List 的语法，但进行了不同的优化：查找速度较慢，因为它们需要遍历列表，而将项目添加或删除到特定位置可以更快。

*   `Dictionary<TKey, TValue>`使用类似于 a 的语法`List<T>`，但不是数组索引，而是将键值放在括号中。字典很棒，因为通过键查找特定项目被认为是*非常快*的，因为无论字典中有多少项目，找到您需要的项目总是需要大约相同的时间。

*   `SortedList<TKey, TValue>`工作起来很像字典，除了当你迭代它时，返回的项目是按键排序的。但是，如果不先迭代它之前的所有项目，就无法查找第 n 个项目。

*   `KeyedCollection`经常被忽视，因为它隐藏在与其他一些集合不同的命名空间中，您必须实现一个（非常简单的）函数才能使用它。它的工作方式也很像字典，此外它还支持按索引轻松查找。它通常在项目的键是项目本身的简单属性时使用。

*   不要忘记旧的备用：`Stack`和`Queue`. 同样，如果您有任何正式的计算机科学教育，您应该已经非常清楚这些是如何根据他们的名字工作的。

最后，这些集合中的大多数（包括数组！）都实现了一组通用接口。这些接口非常有用，因为您可以针对接口而不是特定集合编写程序，然后您的函数可以接受实现该接口的*任何*集合。例如，无论您传入一个字符串数组、a`List<string>`还是任何其他的，以下代码都将起作用`IEnumerable<string>`：

```
void WriteToConsole(IEnumerable<string> items)
{
    foreach (string item in items)
    {
       Console.WriteLine(item);
    }
} 
```

其他值得一看的接口包括`IList<T>`、`ICollection<T>`和`IQueryable<T>`。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-13T18:41:00.383

**通用列表（List）**适合常用。他们不进行装箱和拆箱。所以没有表演者的问题。

```
List<string> items = new List<string>();
items.Add("abc");
items.Add("dfg"); 
```

**ArrayLists**接受任何对象作为项目。因此它们非常适合存储多种类型的情况。例如，如果您需要将一个 int 和一个字符串存储在同一个集合中，arraylist 对此很有用。

```
ArrayList items = new ArrayList();
items.Add("abc");
items.Add(1);
items.Add(DateTime.Now); 
```

**SortedLists**和**Hashtables**是存储键值对。您可以为您的项目定义一个键。这可以帮助您快速找到它们。SortedLists 是自动排序的 Hastables。

```
Hashtable items1 = new Hashtable();
items1.Add("item1", "abc");
items1.Add("item2", "dfg");

SortedList items2 = new SortedList();
items2.Add("Second", "dfg");
items2.Add("First", "abc"); 
```

希望这可以帮助 ！

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-13T20:19:45.357

就像计算机科学中的许多其他事情一样，当有多种选择时，通常意味着有多种方法可以做某事。正如其他人所说，每个集合都有各种优点和缺点。无论您是否使用集合的通用版本，最终所有集合都提供以下操作：

*   插入
*   更新
*   删除
*   抬头
*   枚举

对于这些操作中的每一个，不同的集合具有不同的性能特征。例如，数组可以快速更新项目，但插入或删除项目需要更长的时间。查找速度非常快。

将其与列表进行比较。列表插入速度非常快。查找需要更长的时间。更新和删除操作要求您已经拥有该项目并且速度非常快。数组和列表的枚举大致相同。

所有的集合也有一定的行为，例如，集合是否保持排序。如果是这样，那么插入/更新/删除操作将花费更长的时间，但会加快查找速度。

因此，根据您的程序大部分时间在做什么将决定使用哪个集合。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-13T18:40:21.320

Stacks、Queues、SortedList、Dictionary、HashTable 等集合都是标准数据结构，可在各种情况下派上用场。

Queue 可以实现 FIFO，而无需您自己动手。堆栈为您提供 LIFO。SortedLists 给你一个预排序的列表等等。

在 collections 命名空间中还有很多其他的，都在[这里](http://msdn.microsoft.com/en-us/library/system.collections.aspx)进行了讨论。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-13T18:41:06.217

我可以提供两个提示： 1\. 尽可能多地使用通用集合。2\. 在 HashSet 和 List 泛型集合之间做出决定时，请真正了解您将使用它们的目的。哈希集在搜索时可能会更快，但插入也会减慢（我发现）。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-13T18:41:28.213

算法和数据结构。各有优缺点，各有目的。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-13T18:44:15.163

有很多与此问题相关的帖子，您必须考虑您真正需要做什么。您是否需要基于字符串的键（¿）如何填充数据，您是否需要本机方法来查找是否存在任何键或是否存在任何值（？）

泛型是我最常用的，但其他的也是有原因的；）

[http://discuss.fogcreek.com/dotnetquestions/default.asp?cmd=show&ixPost=5119](http://discuss.fogcreek.com/dotnetquestions/default.asp?cmd=show&ixPost=5119)

# linux - 软件负载平衡器是否管理双向 SSL 连接？如果是这样，怎么做？

> ID：547138
> 
> 赞同：1
> 
> 时间：2009-02-13T18:34:47.807
> 
> 标签：linux, ssl, load-balancing

我对软件或硬件负载平衡器的工作原理一无所知。我猜硬件负载均衡器基本上是一个开关，并基于某种算法决定为传入请求切换到哪个节点。在软件负​​载平衡器方面，我猜该软件会选择一个节点并使用反向代理连接到它。在这种情况下，2-way SSL 将无法工作，因为负载均衡器不能拥有客户端的私钥。

同样，我不知道软件负载均衡器是如何工作的，但由于我的应用程序需要负载均衡器并且应用程序使用 2 路 SSL 连接，我想知道软件负载均衡器如何处理 2 路 SSL联系。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-13T19:09:44.213

一般来说，软件负载均衡器会注意到有新的传入连接请求，评估可用机器上的工作负载，并将新请求分配给最合适的机器。当存在基于会话的服务时，该连接将在会话期间持续；仅当服务器出现故障时才会发生重新平衡，并且可能会在新平衡的配置中建立新连接。

因此，正如 Jon 所暗示的那样，SSL 会话将与服务器建立，并将与该服务器继续，直到会话终止。

如果您想更动态地路由连接，那么可能必须在将请求动态发送到不同服务器的软件之前终止（解密）SSL会话。

所有这些都是可能的——它们不一定是有效的或实施的。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-15T22:49:47.433

不，SSL 与负载平衡器一起使用。它们通常在 TCP 级别工作，因此客户端连接到 LB IP 地址，但它会将连接 NAT 到真实服务器。连接在其生命周期内一直持续到同一个真实服务器，但如果同一个客户端创建另一个，它可以（并且通常会）转到不同的服务器。

对于 HTTPS，这可以正常工作，除了如果您有一个支持 SSL 会话缓存的 Web 服务器，那么如果客户端返回到不同的服务器，SSL 会话缓存将丢失。在实践中，这不是一个大问题。当然，HTTP 保持活动会话不受影响，因为它们是单个 TCP 连接，因此它们保持在同一个真实服务器上。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-13T18:40:14.083

软件负载平衡器将在多台服务器上平均分配会话。

因此，如果用户点击您的负载均衡器，它会将他发送到特定服务器，并且该服务器将协商 SSL。用户将不断地与该服务器对话，直到他的会话到期。届时，他将再次访问负载均衡器。

# git - EC2 上的启动脚本

> ID：547148
> 
> 赞同：6
> 
> 时间：2009-02-13T18:38:31.200
> 
> 标签：git, shell, amazon-ec2, fedora

我创建了一个自定义 Amazon AMI (Fedora) 运行一些脚本然后关闭。

AMI 的问题在于，如果我的代码发生更改，那么 AMI 实例必须有办法在执行它们之前获取最新的脚本。

我写了一个shell脚本并将其放入`/etc/init.d/nt_startup`

为了使代码保持最新，我`git pull`在代码存储库中执行了一个 shell 脚本，然后执行该脚本。

问题是，`git pull`实例启动时似乎没有运行，但 python 脚本运行得很好。不知道我错过了什么......这是启动脚本：

```
#!/bin/bash
#
# ec2 Startup script for EC2 machines
#
# chkconfig: 345 99 02
# description: Script used to issue startup and shutdown commands.
#

if [ "$1" = "start" ]; then
 /usr/scripts/code/git_latest
 python /usr/scripts/code/process.py
 exit
fi

if [ "$1" = "stop" ]; then
#nothing
exit
fi 
```

`/usr/scripts/code/git_latest`shell 脚本如下所示：

```
#pulls in the latest code from the repository
cd /usr/scripts/code
sudo git pull 
```

它应该拉下最新的`process.py`脚本。

奇怪的是，如果我 ssh 进入我的实例并手动执行启动脚本 ( `/etc/init.d/nt_startup "start"`)，git 脚本就可以正常工作。

我错过了什么吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-14T07:52:03.913

好的，我终于想通了。在搜索 EC2 输出后，我发现了这一行：

“正在启动 ntstartup: sudo: 抱歉，你必须有一个 tty 才能运行 sudo”

显然 Fedora 锁定了非 tty sudo 命令。

快速搜索导致了解决方案：

1.  以 root 身份运行“visudo”。
2.  找到带有“Default requiretty”的行并将其注释掉（#Default requiretty）

希望这对遇到此问题的其他人有所帮助。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-13T18:42:33.983

您必须在 /etc/rc?.d 中放置一个启动链接。您可以使用 chkconfig(8) 或 ntsysv(8) 来帮助您管理这些目录。

# networking - 从管理员到开发

> ID：547155
> 
> 赞同：4
> 
> 时间：2009-02-13T18:39:33.087
> 
> 标签：networking, admin

最近，我的一个朋友从高级 NOC 职位转为开发人员。在此之前，他只是在做服务台的事情。他没有学位，只有通常的 MIS/网络认证，据我所知，他只在周末修补代码。我可以看到在某些情况下，对配置、数据包、用户、OU 等有很好的了解对开发人员非常有益。

我的问题是，有多少全职开发人员是这样开始的？甚至有多少人兼任开发人员/系统管理员/网络管理的职责？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-13T18:46:40.697

我确信这是一个相当普遍的情况。我在 IT 领域工作了 12 年，我发现随着时间的推移，真正的收入来自成为专家（DBA、编码员等），而不是通才（网络管理员、帮助台）。

这实际上是我的职业生涯所走的道路。我不是一个全职的 DBA 或开发人员，但这就是我要去的地方。

我也愿意打赌，我在此过程中学到的人际交往能力（帮助台支持、网络管理员、系统分析师）将对我的 DBA/开发人员职业生涯有所帮助。如果我直接进入编码职业，我觉得我不会获得的技能。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-13T19:18:17.330

确实。我认为开发人员应该知道他们正在为其构建软件的平台。如果开发人员以前曾担任过系统管理员，他将知道如何很好地集成他的软件。我想到了一些与 Windows-Desktop-App 相关的“集成气味”：

*   应用程序无法在普通用户权限下运行（在适当安全的企业桌面上运行？哎呀！）
*   应用程序需要对所有类型的系统文件夹的写入权限（安全？哎呀！）
*   应用程序将用户设置存储在“非标准”位置，例如 %programfiles%（备份？权限？哎呀！）
*   应用程序不提供静默安装设置（部署？哎呀！）

ETC..

**真正的**系统管理员永远不会编写具有上述集成气味之一的软件。真的。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-13T18:43:56.897

这在小公司中很常见。我这样做了一段时间 - 开发我们出售给客户的软件，保持网络正常运行，并根据需要为少于 20 人的制造公司向数据库添加功能。

你在一家小企业中身兼数职。

但是我在高中时就开始编写微控制器，所以我不能说这是我开始的地方。

作为开发人员，了解所有这些系统的工作知识非常*有帮助。*

-亚当

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-13T19:23:18.783

开发人员和管理员的重叠发生了很多。我们的最后一位管理员在旁边开发，以便他更好地了解他正在帮助支持的内容。当他离开时，我成为了管理员，只是因为我在一边修补了管理员的东西，以了解我的软件是如何得到支持的。

我想说的是，对任何技术专业人士来说，对一些重点的广泛理解是最好的。然后通过一些学习，您可以改变以满足可能出现的任何需求。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-13T20:46:32.907

我更多地看到了程序员还“管理”服务器甚至网络的另一种方式。我肯定在那个位置。

我认为它也可以很容易地转向管理员可以开始编程系统的其他方式，但根据我的经验，它并不常见。每当我问服务器管理员或网络人员“你也编程吗？” 大多数时候答案是“不”。

我认为程序员越界可能会更容易，因为当您对系统进行编程时，除非您始终有可用的管理员，否则您需要能够设置自己的环境，这通常包括设置服务器。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-02-13T20:52:34.730

我从一名 NOC 运营商开始，最终晋升为高级网络工程师职位。在我之前的公司任职的最后 2-3 年里，我开始喜欢上编程，并开始利用自己的时间自学一切。2005 年左右，我离开了这家公司，去了一家小型初创公司，至今仍以管理员和主要开发人员的身份在那里工作。

我对自己施加的一个挑战是不要为了满足编程挑战而一蹴而就地进行管理员更改。我必须强迫自己以一种我制作的任何应用程序都可以以最低权限重新部署到其他地方的方式进行编码，尽管事实上我可以用我们自己的服务器做任何我想做的事情。很好地履行两项职责与由于另一项职责的需要而糟糕地履行一项职责之间的界限。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-13T18:45:04.023

我在这。虽然我从小就一直在修改代码，但我的第一份全职工作是系统管理员、DBA 和其他相关角色。之后我作为一名开发人员从事全职工作，现在我既是一名开发人员又是一名安全研究员。此外，我设法完成了 CS 硕士学位。我相信这样的转变是可能的，而且非常有益，因为您可以对自己的工作领域有更广泛的了解。

# java - 如何让关闭挂钩在从 Eclipse 启动的进程上执行

> ID：547169
> 
> 赞同：56
> 
> 时间：2009-02-13T18:42:25.263
> 
> 标签：java, eclipse, shutdown

我的应用程序中有一个关闭挂钩（使用创建`Runtime.getRuntime().addShutdownHook`）。但是，如果我从 Eclipse 中启动应用程序，当它关闭时，关闭挂钩不会执行。

我认为这是因为 Eclipse 向进程发送了相当于强制终止信号，这不会导致关闭挂钩执行（相当于 Windows 上的 taskkill /F 或 Linux 上的 kill -p），尽管我我不确定。

有谁知道如何解决这个问题？我正在运行 Windows (Vista)，我感觉这可能是 Windows 特定的问题，但我不确定。

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2009-03-11T23:37:05.390

我在我的主要方法结束时使用了以下技巧来解决这个问题：

```
if (Boolean.parseBoolean(System.getenv("RUNNING_IN_ECLIPSE"))) {
    System.out.println("You're using Eclipse; click in this console and " +
            "press ENTER to call System.exit() and run the shutdown routine.");
    try {
        System.in.read();
    } catch (IOException e) {
        e.printStackTrace();
    }
    System.exit(0);
} 
```

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-02-18T03:24:33.167

First off, is your application ending or are you forcibly ending it? If you are forcibly ending it (via the stop button), this [Eclipse bug report](https://bugs.eclipse.org/bugs/show_bug.cgi?id=38016) has details about why this might not be working.

Failing that, you may be correct about this being Windows-specific behavior. I'm on a Mac so I can't confirm, sorry. However, I can tell you that the following test program *does* execute the shutdown hooks as expected.

```
public class MyShutdownHook
{
    public static void main( String[] args )
    {
        System.out.println( "Entering main." );

        Runtime.getRuntime().addShutdownHook( 
            new Thread(
                new Runnable() {
                    public void run() {
                        System.out.println( "Shutdown hook ran." );
                    }   
                }
            )
        );

        System.out.println( "Exiting main." );
    }
} 
```

The Javadocs for [Runtime#addShutdownHook](http://java.sun.com/javase/6/docs/api/java/lang/Runtime.html#addShutdownHook(java.lang.Thread)) do mention that shutdown hooks do not run when the JVM is aborted, not exited normally, so again, you are probably correct in your assumptions. That being said, here are some things to try. Again, sorry I can't confirm these ahead of time -- no Windows here. (Blessedly!)

*   Make sure the JVM does not include the **-Xrs** option. This has a [side-effect](http://java.sun.com/j2se/1.5.0/docs/tooldocs/windows/java.html) on shutdown hooks.
*   Try launching the JVM using either the **-server** or **-client** option. It's been my experience that edge-case behavior can be effected by the choice of VM mode. (Especially with regard to threading -- at least on Mac.)
*   Are you launching your app under a profiler or the like? Loading any native libraries?
*   Are you getting some fatal error and missing it? E.g., OutOfMemoryError or the like?
*   Try checking/unchecking the **Launch in background** option from your application's *Run Configuration* dialog in Eclipse.
*   Last but not least: Invoke **System.exit()** manually if you have the opportunity. :)

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2012-03-23T01:35:17.643

这是一个您可以在 Eclipse 之外运行的脚本，以列出在 Eclipse 下运行的可以终止的可用进程。

```
#!/bin/bash
set -o nounset                              # Treat unset variables as an error

PROCESSES=$(ps axo pid,ppid,command)

# Find eclipse launcher PID
LAUNCHER_PID=$(echo "$PROCESSES" | grep "/usr/lib/eclipse/eclipse" |grep -v "launcher"|awk '{print $1}')
echo "Launcher PID $LAUNCHER_PID"

# Find eclipse PID
ECLIPSE_PID=$(echo "$PROCESSES" | egrep "[[:digit:]]* $LAUNCHER_PID " | awk '{print $1}')
echo "Eclipse PID $ECLIPSE_PID"

# Find running eclipse sub-process PIDs
SUB_PROCESS=$(echo "$PROCESSES" | egrep "[[:digit:]]* $ECLIPSE_PID " | awk '{print $1}')

# List processes
echo
for PROCESS in $SUB_PROCESS; do
    DRIVER=$(ps --no-headers o pid,ppid,command $PROCESS | awk '{print $NF}')
    echo "$PROCESS $DRIVER"
done

echo "Kill a process using: 'kill -SIGTERM \$PID'" 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2017-08-18T10:42:57.320

在 Windows 上，要以标准方式优雅地停止 Java 应用程序，您需要向其发送`Ctrl`+ `C`。这仅适用于控制台应用程序，但 Eclipse 使用`javaw.exe`而不是`java.exe`. 要解决此问题，请打开启动配置、JRE 选项卡并选择“Alternative JRE:”。“Java 可执行文件”组框出现并允许输入备用可执行文件“java”。

现在我们需要一个外部程序将 Ctrl-C 发送到带有隐藏控制台的进程。我在[这里](http://stanislavs.org/stopping-command-line-applications-programatically-with-ctrl-c-events-from-net/)和[这里](http://ebanshi.cc/questions/569145/how-to-cleanly-shut-down-a-console-app-started-with-process-start)找到了提示。我们的程序附加到所需进程的控制台并发送控制台事件。

```
#include <stdio.h>
#include <windows.h>

int main(int argc, char* argv[])
{
    if (argc == 2) {
        unsigned pid = 0;
        if (sscanf_s(argv[1], "%u", &pid) == 1) {
            FreeConsole(); // AttachConsole will fail if we don't detach from current console
            if (AttachConsole(pid)) {
                //Disable Ctrl-C handling for our program
                SetConsoleCtrlHandler(NULL, TRUE);
                GenerateConsoleCtrlEvent(CTRL_C_EVENT, 0);
                return 0;
            }
        }
    }

    return 1;
} 
```

测试java程序：

```
public class Shuthook {

    public static void main(final String[] args) throws Exception {
        Runtime.getRuntime().addShutdownHook(new Thread() {
            @Override
            public void run() {
                System.out.println("Shutting down...");
            }
        });

        String sPid = ManagementFactory.getRuntimeMXBean().getName();
        sPid = sPid.substring(0, sPid.indexOf('@'));

        System.out.println("pid: " + sPid);
        System.out.println("Sleeping...");
        Thread.sleep(1000000);
    }

} 
```

终止它：

```
C:\>killsoft.exe 10520 
```

Eclipse中的测试程序输出：

```
pid: 10520
Sleeping...
Shutting down... 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-13T19:07:31.363

我不确定如何解决此问题，但 IntelliJ 在其“运行”对话框中添加了一个单独的按钮，该按钮将以调用 Shutdown Hooks 的方式关闭 VM。他们的调试器没有这个功能。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-18T06:29:38.900

我现在被困在 websphere 中，看不到我在寻找什么。但我确实记得 eclipse 有一个与在同一个 VM 中启动应用程序相关的运行配置选项。您是否可以在与 eclipse 虚拟机相同的虚拟机中启动您的 java 应用程序？

但这个选项让我忘记了。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2015-09-25T08:37:06.240

Sairam 就在这里，通过调用**System.exit(0)**我们可以终止 eclipse JVM 并且可以看到 Shutdown hook 结果

# screen - 为笔记本电脑开发定制的屏幕显示应用程序

> ID：547171
> 
> 赞同：-2
> 
> 时间：2009-02-13T18:42:39.130
> 
> 标签：screen, button

我很想为我的笔记本电脑创建一个自定义的屏幕显示应用程序，因为制造商提供的应用程序完全是垃圾。我打算编写一个应用程序来显示诸如音量控制、屏幕亮度、无线天线状态等内容。我不确定我需要知道什么信息才能开始创建这样的东西（用于抓取按键/按钮按下的界面、系统优先级、任何其他相关数据），并且想知道是否有人可以帮助我指出正确的方向。如果可能的话，我想用 C# 开发它。

例如，当我按住笔记本电脑键盘上的“Fn”键并按“F5”键时，音量会降低。通过屏幕上的图形可以直观地表示此操作，该图形显示当前正在降低的声级。我想替换原生图形，因为，我只是不喜欢它：D。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-13T22:18:26.757

为此，我使用[AutoHotKey 。](http://www.autohotkey.com/)编程语言/框架有点奇怪，但它非常强大，并且有许多免费可用的脚本可以做一些令人惊奇的事情（好吧，当你考虑到语言时，令人惊奇;-)。Adam Pash（来自 LifeHacker.com）在 AutoHotKey 方面做了很多出色的工作。

我没有对自定义图形做任何事情，但这是我的音量控制代码的样子（它与 Win-Plus 和 Win-Minus 热键相关联）。

```
#=::
    SoundSetWaveVolume, +5
    Gosub, osd
    Return

#-::
    SoundSetWaveVolume, -5
    Gosub, osd
    Return

;; onscreen display for volume control
osd:
    IfWinNotExist, volume
    {
        Progress, b1, volume:, , volume
    }
    WinSet, Transparent, 220, volume
    SoundGet, Volumelvl, wave, volume
    Transform, Volumelvl,  Round, %Volumelvl%
    Progress, %Volumelvl%, volume: %Volumelvl%`%
    SetTimer, osd_off, 1000
    Return

osd_off:
    Progress, off 
```

# c# - 将鼠标事件传递给父控件

> ID：547172
> 
> 赞同：34
> 
> 时间：2009-02-13T18:43:19.737
> 
> 标签：c#, winforms, mouseevent

环境：.NET Framework 2.0，VS 2008。

我正在尝试创建某些 .NET 控件（标签、面板）的子类，它将通过某些鼠标事件（`MouseDown`, `MouseMove`, `MouseUp`）传递到其父控件（或顶级表单）。我可以通过在标准控件的实例中为这些事件创建处理程序来做到这一点，例如：

```
public class TheForm : Form
{
    private Label theLabel;

    private void InitializeComponent()
    {
        theLabel = new Label();
        theLabel.MouseDown += new MouseEventHandler(theLabel_MouseDown);
    }

    private void theLabel_MouseDown(object sender, MouseEventArgs e)
    {
        int xTrans = e.X + this.Location.X;
        int yTrans = e.Y + this.Location.Y;
        MouseEventArgs eTrans = new MouseEventArgs(e.Button, e.Clicks, xTrans, yTrans, e.Delta);
        this.OnMouseDown(eTrans);
    }
} 
```

我无法将事件处理程序移动到控件的子类中，因为在父控件中引发事件的方法受到保护，并且我没有父控件的限定符：

> *无法`System.Windows.Forms.Control.OnMouseDown(System.Windows.Forms.MouseEventArgs)`通过 type 的限定符访问受保护的成员`System.Windows.Forms.Control`；限定符必须是类型`TheProject.NoCaptureLabel`（或派生自它）。*

我正在研究`WndProc`在我的子类中覆盖控件的方法，但希望有人能给我一个更清洁的解决方案。

* * *

## 回答 #1

> 赞同：69
> 
> 时间：2011-12-26T12:11:38.340

是的。经过大量搜索，我找到了文章[“浮动控件，工具提示样式”](http://www.vbaccelerator.com/home/NET/Code/Controls/Popup_Windows/Floating_Controls/article.asp)，它用于`WndProc`将消息从 更改`WM_NCHITTEST`为`HTTRANSPARENT`，使`Control`鼠标事件透明。

为此，创建一个继承自的控件`Label`并简单地添加以下代码。

```
protected override void WndProc(ref Message m)
{
    const int WM_NCHITTEST = 0x0084;
    const int HTTRANSPARENT = (-1);

    if (m.Msg == WM_NCHITTEST)
    {
        m.Result = (IntPtr)HTTRANSPARENT;
    }
    else
    {
        base.WndProc(ref m);
    }
} 
```

我已经在 Visual Studio 2010 中使用 .NET Framework 4 客户端配置文件对此进行了测试。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-13T18:47:26.967

您需要在基类中编写一个公共/受保护的方法，该方法将为您引发事件。然后从派生类调用此方法。

或者

这是你想要的吗？

```
public class MyLabel : Label
{
    protected override void OnMouseDown(MouseEventArgs e)
    {
        base.OnMouseDown(e);
        //Do derived class stuff here
    }
} 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-13T18:54:43.470

扩展的`WS_EX_TRANSPARENT`窗口样式实际上是这样做的（它是就地工具提示使用的）。您可能想要考虑应用这种风格，而不是编写大量的处理程序来为您完成。

为此，请覆盖该`CreateParams`方法：

```
protected override CreateParams CreateParams
{
  get
  {
    CreateParams cp=base.CreateParams;
    cp.ExStyle|=0x00000020; //WS_EX_TRANSPARENT
    return cp;
  }
} 
```

进一步阅读：

*   [http://support.microsoft.com/kb/92526](http://support.microsoft.com/kb/92526)
*   [http://msdn.microsoft.com/en-us/library/ms632680.aspx](http://msdn.microsoft.com/en-us/library/ms632680.aspx)

# vb.net - 网页上的自动换行

> ID：547175
> 
> 赞同：0
> 
> 时间：2009-02-13T18:44:12.467
> 
> 标签：vb.net, web

我目前正在使用 .NET 2008 创建一个网页。我们正在从数据库中获取信息，在显示它时我无法将其包裹在下面。例如：

```
 2231 Question 1
 2232 Mechanical Engineering Technologists and Technicians 
 2233 Industrial Engineering and Manufacturing Technologists 
 and Technicians 
 2234 Question 4 
```

在 2233 中，我怎样才能让它看起来像这样：

```
 2231 Question 1
 2232 Mechanical Engineering Technologists and Technicians 
 2233 Industrial Engineering and Manufacturing Technologists 
      and Technicians 
 2234 Question 4 
```

谢谢！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-13T18:59:12.460

我将按以下方式构建您的 HTML：

```
<div class="qNumber">2231</div>
<div class="qContent">Question 1</div>
<div class="clear"></div>

<div class="qNumber">2232</div>
<div class="qContent">Mechanical Engineering Technologists and Technicians</div>
<div class="clear"></div>

<div class="qNumber">2233</div>
<div class="qContent">Industrial Engineering and Manufacturing Technologists and Technicians </div>
<div class="clear"></div>

<div class="qNumber">2234</div>
<div class="qContent">Question 4</div>
<div class="clear"></div> 
```

您的 CSS 将如下所示：

```
.qNumber { float: left; width: 40px; }
.qContent { width: 350px; padding-left: 40px; }
.clear { clear: both; } 
```

显然根据自己的喜好调整数字:)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-13T18:46:22.943

嗯，有一个更好的方法，但是这可以通过桌子便宜而快速地完成。

```
<table>
<tr><td>2231</td><td>Question 1</td></tr>
<tr><td>2232</td><td>Mechanical Engineering Technologists and Technicians</td></tr> 
<tr><td>2233</td><td>Industrial Engineering and Manufacturing Technologists and Technicians</td></tr> 
<tr><td>2234</td><td>Question 4</td></tr>
</table> 
```

好吧，我尝试在markdown中实现它，但它不喜欢它。

-亚当

# linux - 监控服务器上的带宽

> ID：547178
> 
> 赞同：3
> 
> 时间：2009-02-13T18:45:20.107
> 
> 标签：linux, monitoring, fedora, bandwidth

我曾经在共享主机上，我可以使用那里的标准工具来查看带宽图。

我现在有我的网站在专用服务器上运行，我不知道发生了什么：P*叹息*

我在我的 Fedora core 10 机器上安装了 webmin，我想监控带宽。我正要设置带宽模块，它给了我这个警告：

```
Warning - this module will log ALL network traffic sent or received on the 
selected interface. This will consume a large amount of disk space and CPU
time on a fast network connection. 
```

没有什么我可以使用的更轻且适合 NOOB 的东西吗？'咳嗽' 免费工具 '咳嗽'

谢谢你的帮助。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-13T18:47:30.820

[vnStat](http://humdi.net/vnstat/)与它们一样轻巧。（如果命令行工具提供的图表不够漂亮，那么有很多前端。）

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-13T18:49:29.787

我使用[munin](http://munin.projects.linpro.no/)。如果您愿意，它可以制作漂亮的图表并且可以设置警报。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-13T19:03:55.053

不幸的是，这不适用于 *nix，但我有一个自动化的过程来分析我的 IIS 日志，将它们从 Web 服务器移出并使用[Web Log Expert](http://www.weblogexpert.com)分析它们。如果打开了适当的计数器，它就会为我提供站点每个元素消耗的带宽。

他们工具的免费版本不允许编写脚本，但它执行相同的分析。它支持 W3C 扩展和 Apache（通用和组合）日志格式。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-13T23:37:32.043

看看[mrtg](http://oss.oetiker.ch/mrtg/)。设置起来相当容易，运行一个简单的 cron 作业来从您的路由器收集 snmp 统计信息，并显示一些合理且简单的图表。数据存储在 RRD 数据库中（有关详细信息，请参阅 mrtg 页面），也可以挖掘用于其他用途。

# php - 使用 Zend_Search_Lucene 搜索数字

> ID：547180
> 
> 赞同：6
> 
> 时间：2009-02-13T18:46:12.477
> 
> 标签：php, zend-framework, full-text-search

那么为什么下面的第一个搜索示例没有返回任何结果？对于如何修改以下代码以使数字搜索成为可能的任何想法将不胜感激。

# 创建索引

```
$index = new Zend_Search_Lucene('/myindex', true);
$doc->addField(Zend_Search_Lucene_Field::Text('ssn', '123-12-1234'));
$doc->addField(Zend_Search_Lucene_Field::Text('cats', 'Fluffy'));
$index->addDocument($doc);
$index->commit(); 
```

# 搜索 - 没有结果

```
$index = new Zend_Search_Lucene('/myindex', true);
$results = $index->find('123-12-1234'); 
```

# 搜索 - 有结果

```
$index = new Zend_Search_Lucene('/myindex', true);
$results = $index->find('Fluffy'); 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-11-03T19:19:24.427

首先，您需要更改文本分析器以包含数字

Zend_Search_Lucene_Analysis_Analyzer::setDefault(new Zend_Search_Lucene_Analysis_Analyzer_Common_TextNum());

然后对于带有数字的字段，您想使用**Zend_Search_Lucene_Field::Keyword**而不是**Zend_Search_Lucene_Field::Text** 这将跳过令牌的创建并将值“按原样”保存到索引中。然后你可以通过它搜索。我不知道它对浮点数的表现如何（可能不适用于浮点数 3.0 不会匹配 3）但对于自然数（如 ids ）就像一个魅力。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-13T22:32:51.900

这是您选择的分析器的效果。

我相信[默认分析器](http://framework.zend.com/manual/en/zend.search.lucene.charset.html#zend.search.lucene.charset.default_analyzer)只会索引匹配 /[a-zA-Z]+/ 的术语。这意味着您的 SSN 不会作为术语添加到索引中。

即使您切换到文本+数字不区分大小写的分析器，您想要的仍然无法工作。术语的表达式是 /[a-zA-Z0-9]+/ 这意味着添加到索引中的术语将是 12,123,1234。

如果您需要将 123-12-1234 视为一个有效术语，您可能需要扩展 Zend_Search_Lucene_Analysis_Analyzer_Common 并使 123-12-1234 成为一个术语。

见 [http://framework.zend.com/manual/en/zend.search.lucene.extending.html#zend.search.lucene.extending.analysis](http://framework.zend.com/manual/en/zend.search.lucene.extending.html#zend.search.lucene.extending.analysis)

您的另一个选择是将 ssn 存储为 Zend_Search_Lucene_Field::Keyword。由于关键字没有分解为术语。

[http://framework.zend.com/manual/en/zend.search.lucene.html#zend.search.lucene.index-creation.understanding-field-types](http://framework.zend.com/manual/en/zend.search.lucene.html#zend.search.lucene.index-creation.understanding-field-types)

# sql - 请帮忙解释一下这个 SQL 语句

> ID：547187
> 
> 赞同：0
> 
> 时间：2009-02-13T18:47:33.283
> 
> 标签：sql

该表`Arc(x,y)`当前有以下元组（注意有重复）：

```
(1,2),
(1,2),
(2,3),
(3,4),
(3,4),
(4,1),
(4,1),
(4,1),
(4,2) 
```

计算查询结果：

```
SELECT a1.x, a2.y, COUNT(*)
FROM Arc a1, Arc a2
WHERE a1.y = a2.x
GROUP BY a1.x, a2.y; 
```

是什么`a1`和`a2`指的是什么？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-13T18:50:41.013

a1 和 a2 只是连接到自身的 Arc 表的别名。你也可以说，

```
Arc As a1, Arc As a2 
```

你问的是这个吗？

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-13T18:58:09.763

它被称为`self join`.

您可以自己加入一个表，就像在您的任务中一样，它将导致：

```
(1, 2) (2, 3)  // note the join condition, y from the right is equal to x from the left
(1, 2) (2, 3)
(2, 3) (3, 4)
(2, 3) (3, 4)
... 
```

等等

这当然会在`GROUP`'ing 之后缩小。

`a1`并`a2`参考表格的实例。您希望从结果的哪一部分得到`x`？用于`a1.x`左侧部分，`a2.x`用于右侧部分。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-13T19:20:10.477

查询的答案是：

```
create temp table arc(x int, y int);
insert into arc values(1,2);
insert into arc values(1,2);
insert into arc values(2,3);
insert into arc values(3,4);
insert into arc values(3,4);
insert into arc values(4,1);
insert into arc values(4,1);
insert into arc values(4,1);
insert into arc values(4,2);

SELECT a1.x, a2.y, COUNT(*)
FROM Arc a1, Arc a2
WHERE a1.y = a2.x
GROUP BY a1.x, a2.y;

      4           3                1
      4           2                6
      2           4                2
      1           3                2
      3           1                6
      3           2                2 
```

This is not necessarily the answer to the question, though. As already noted, 'a1' and 'a2' are table aliases, alternative names for the Arc table so that it can be joined to itself.

# database - 评估 HDF5：HDF5 为数据建模提供了哪些限制/功能？

> ID：547195
> 
> 赞同：40
> 
> 时间：2009-02-13T18:50:31.170
> 
> 标签：database, binaryfiles, hdf5, datamodel

我们正在评估用于存储在分析 C/C++ 代码期间收集的数据的技术。在 C++ 的情况下，数据量可能比较大，每个 TU 约 20Mb。

阅读以下 SO[答案](https://stackoverflow.com/questions/416436/what-to-put-in-a-binary-data-files-header/416937#416937)后，我认为[HDF5](http://www.hdfgroup.org/HDF5/)可能是适合我们使用的技术。我想知道这里的人是否可以帮助我回答我最初遇到的一些问题：

1.  表现。数据的一般用法是写入一次并读取“多次”，类似于编译器生成的“.o”文件的生命周期。HDF5 与使用 SQLite DB 之类的东西相比如何？这甚至是一个合理的比较吗？

2.  随着时间的推移，我们将添加到我们正在存储的信息中，但不一定要重新分发一组全新的“阅读器”来支持新格式。阅读用户指南后，我了解到 HDF5 类似于 XML 或 DB，因为该信息与标签/列相关联，因此为读取旧结构而构建的工具只会忽略它不关心的字段？我对此的理解正确吗？

3.  我们希望写出的大部分信息将是一种树型结构：作用域层次结构、类型层次结构等。理想情况下，我们会将作用域建模为具有父级、子级等。是否可以有一个 HDF5 对象“点”给另一个？如果没有，是否有使用 HDF5 解决此问题的标准技术？或者，正如数据库所要求的那样，我们是否需要一个唯一的键来在搜索数据时通过适当的查找将一个对象“链接”到另一个对象？

非常感谢！

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2009-02-13T19:07:35.030

> HDF5 与使用 SQLite DB 之类的东西相比如何？这甚至是一个合理的比较吗？

有点类似，但不是真的。它们都是结构化文件。SQLite 具有支持使用 SQL 进行数据库查询的功能。HDF5 具有支持大型科学数据集的功能。

它们都意味着高性能。

> 随着时间的推移，我们将添加到我们正在存储的信息中，但不一定要重新分发一组全新的“阅读器”来支持新格式。

如果以结构化形式存储数据，那么这些结构的数据类型也会存储在 HDF5 文件中。我对它的工作原理有点生疏（例如，如果它包括先天的向后兼容性），但我知道如果您正确设计“阅读器”，它应该能够处理将来更改的类型。

> 是否可以让一个 HDF5 对象“指向”另一个？

绝对地！你会想要使用[属性](http://www.hdfgroup.org/HDF5/doc/H5.user/Attributes.html)。每个对象都有一个或多个字符串描述到达该对象的路径。HDF5[组](http://www.hdfgroup.org/HDF5/doc/H5.user/Groups.html)类似于文件夹/目录，除了文件夹/目录是分层的 = 一个唯一的路径描述每个人的位置（至少在没有硬链接的文件系统中），而组形成一个可以包括循环的有向图。我不确定您是否可以将指向对象的“指针”直接存储为属性，但您始终可以将绝对/相对路径存储为字符串属性。（或其他任何地方作为字符串；如果需要，您可以拥有大量的查找表。）

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-02-13T19:45:59.323

我们在我的项目中生成 HDF5 数据，但我通常不直接处理它。我可以试一下前两个问题：

1.  我们使用一次写入，多次读取模型，格式似乎可以很好地处理这个问题。我知道一个项目用于同时写入*Oracle*数据库和 HDF5。最终他们删除了 Oracle 输出，因为性能受到影响并且没有人使用它。显然，SQLite 不是 Oracle，但 HDF5 格式更适合这项任务。基于这一数据点，RDBMS 可能会针对多次插入和更新进行更好的调整。

2.  当我们添加新的数据类型时，我们的客户使用的阅读器非常强大。一些变化是预料之中的，但我们不必担心在添加更多数据字段时会破坏东西。我们的 DBA 最近编写了一个 Python 程序来读取 HDF5 数据并填充 KMZ 文件以在 Google 地球中进行可视化。既然是他用来学习 Python 的项目，我会说建立阅读器并不难。

关于第三个问题，我要向[Jason S 的高超知识](https://stackoverflow.com/questions/547195/evaluating-hdf5-what-limitations-features-does-hdf5-provide-for-modelling-data/547240#547240)低头。

我会说 HDF5 是一个完全合理的选择，特别是如果您已经对它感兴趣或计划为科学界生产一些东西。

# fax - 寻找 T.38 库

> ID：547201
> 
> 赞同：-2
> 
> 时间：2009-02-13T18:54:23.253
> 
> 标签：fax

我正在尝试实现一个适用于传真的系统。我们有一个网关，电话到 T.38（IP 传真）。我需要一个库，可以让我做另一端，T.38 到 TIFF 图像。我在 Mac 上做这个，我们使用 C、C++、php、java。

将 T.38 悄悄地转换为 T.37（通过电子邮件传真）的程序也可以正常工作。

有谁知道其中任何一个？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-24T17:29:38.130

T.38 网关实际上只是调制解调器部分，用于在电话线上获取传真模拟“音频”数据并将其转换为较低级别 T.30 HDLC 数据的直接二进制数字数据包流。T.38 标准确实指定了某种级别的应用程序级解码，以延长某些传真确认握手中的计时器……实际上，T.38 网关在他的一端与电话另一端的传真机购买了一些时间当东西通过IP网络时打电话...特别是如果有数据包丢失等情况。但是，所有这些都在T.38网关和传真机之间进行......而不是IP网络。

因此，如果您真的想查看 T.38 网关的 IP 数据包端并且确实想要访问传真文件图像并将其呈现为 TIFF，那么您真正要寻找的是 T.30 传真终止因为 T.30 指定了 HDLC 数据的格式以及如何编码/解码该内容。实际上，您必须实现传真机的逻辑以将文档捕获到 TIFF 中，就像真正的传真机捕获图像并打印到纸上一样。

即：您真正想要的是 T.30 实现，而不是 T.38 实现。请注意，T.30 标准的一部分还引用了 T.4，它描述了如何在 T.30 的上下文中压缩实际图像数据。

相对于从 T.38 到 T.37，虽然我认为这在理论上是可能的，但请理解，就像 T.38 一样，T.37 标准假设这种网关的一端是模拟域。也就是说，T.37 标准规定了如何从模拟到电子邮件消息，就像 T.38 从模拟到实时数字数据包流一样。在标准的上下文中，没有从 T.38 到 T.37 的“双跳”来获取您的传真图像....所以我认为找到现有的实现似乎不太可能。

最后，您需要的是 T.30 FAX 终止实施，因为您正在与之通话的 T.38 网关已经为您完成了调制解调器部分。或者，另一种看待这个问题的方式是您想要一个 T.37 网关*而不是*T.38 网关。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-27T03:39:02.797

[Asterisk](http://www.asterisk.org)开源 PBX 使用[SpanDSP](http://www.soft-switch.org/index.html)库来实现传真。看起来该库具有处理[T.38](http://www.soft-switch.org/spandsp-doc/t38_core_page.html)和 InSciTek Jeff 提到的其他协议的模块[。](http://www.soft-switch.org/spandsp-modules.html)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-02T04:16:34.303

如果您愿意在某处使用 linux，Hylafax 可能对您有用。

我使用星号 + iaxmodem + hylafax。Hylafax 旨在接收/发送传真。收到的传真保存为 tiff 或 pdf 格式，或发送到您自己制作的任意脚本进行处理。Hylafax 希望使用真正的调制解调器。Iaxmodem 模拟真正的调制解调器，同时真正成为与星号的 IAX2（类似 sip 的 voip 协议）连接。

如果你真的是铁杆，你可以考虑从 hylafax 中提取“转换”部分并将其变成一个库，供你在 mac 上使用。它是开源的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2016-02-11T15:02:34.017

[OPAL](http://www.opalvoip.org/)是一个支持 T.38（仅最高 14400）的库（它也可以使用 spandsp 处理包含传真音的 G711 音频）。也存在商业选择，主要来自 Dialogic 和 Commetrex。

# .net - 最佳基础设施

> ID：547203
> 
> 赞同：1
> 
> 时间：2009-02-13T18:55:25.357
> 
> 标签：.net, database, infrastructure

我有以下情况，我想知道你会采取什么方法来解决这个问题。

这是客户的需求。

他需要一个网站/电子商务以及能够自定义电子商务外观的东西。他还希望能够扩展一些功能，例如产品配置。

他在一个国家设有办事处，在另一个国家设有办事处。

客户通过网络或电话下订单，然后公司的某个人决定是在办公室 1 还是办公室 2 下订单。

客户需要能够从一个位置查看有关两个办公室的信息。

所以我们有 1 个网站 + 2 个办公室，我想知道在这种情况下你会选择做什么。你会在网络上制作所有东西，在那种情况下，我如何处理条形码和特殊打印机。

你会做一个网站+ 1 软件在网络上共享一个数据库。在那种情况下，数据传输会不会太慢。

目标是使开发尽可能简单，因为客户希望能够在需要时更改程序员。

最好，应用程序应该在 .Net 中完成，以便更容易编码。

那么在这种情况下你会怎么做呢？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-13T19:09:03.420

为此，我将使用 Web 服务对数据执行操作，但使用富客户端从两个办公室访问 Web 服务。这样，您可以处理可能在办公室中使用的硬件，而不必担心通过 Web 连接到数据库（这不是一件好事）。

# c++ - 温索克怪异（C++）

> ID：547214
> 
> 赞同：1
> 
> 时间：2009-02-13T18:58:40.713
> 
> 标签：c++, winsock

我正在尝试实现一个名为“inet_pton”的函数，它将 IPv4 或 IPv6 的字符串表示（如“66.102.1.147”[google]）转换为二进制网络字节有序形式。这是我的代码的相关部分：

```
#if defined WIN32
int inet_pton (int af, const char *src, void *dst)

{
    const void *data;
    size_t      len;
    struct      addrinfo hints, *res;

    hints.ai_family   = af;
    hints.ai_socktype = SOCK_STREAM; 
    hints.ai_protocol = IPPROTO_UDP;
    hints.ai_flags    = AI_NUMERICHOST;

    if (getaddrinfo (src, NULL, &hints, &res))
    {
        std::cout << "ERROR : inet_pton() in " << __FILE__ << " at line " << __LINE__ << std::endl;
        std::cout << "      : getaddrinfo() failed to get IP address info for \"" << src << "\"" << std::endl;
        return 0;
    }
... 
```

所以 src 是传入的 IP 字符串。但是，我总是收到类似的错误

getaddrinfo() 无法获取“66.102.1.147”的 IP 地址信息

有winsock经验的人可以评论吗？我还尝试了另一种方法，函数

```
WSAStringToAddress ((LPTSTR)src, af, NULL, (LPSOCKADDR) &sa, &address_length) 
```

但它总是返回错误代码 WSAEINVAL，表示 IP 字符串无效。这对我来说毫无意义。我使用 VS2005 作为我的 IDE。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-13T19:12:04.800

好吧，首先，您要求使用 UDP 作为协议的流套接字，而这不会发生。

尝试：

```
hints.ai_family   = af;
hints.ai_socktype = 0; 
hints.ai_protocol = 0;
hints.ai_flags    = AI_NUMERICHOST; 
```

并首先将其 memset 为零，因为它具有您未设置的额外成员...

同样在我的代码中，当我没有空字符串而不是空时，我为端口或服务传递了一个空字符串。文档似乎没有指定当您没有值时要做什么；但无论哪种方式，一个空字符串都对我有用。

哦，和往常一样，在这些情况下，知道 WSAGetLastError() 返回什么值会很有用......

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-13T19:10:49.017

MSDN 有一篇关于使用 getaddrinfo 的优秀文章：

[http://msdn.microsoft.com/en-us/library/ms738520(VS.85).aspx](http://msdn.microsoft.com/en-us/library/ms738520(VS.85).aspx)

甚至还有一个使用 AI_NUMERICHOST 的示例，这听起来像是您需要的。他们设置他们的“提示”结构与你有点不同：

```
ZeroMemory(&hints, sizeof(hints));
hints.ai_flags = AI_NUMERICHOST;
hints.ai_family = AF_UNSPEC; 
```

他们不设置其他 2 个属性。也许这会有所帮助？

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-13T19:13:49.650

您为 af 传递的值是多少？我有一些代码可以做同样的事情，我和你的唯一区别是：

*   我将提示结构设置为 0
*   我总是通过`PF_UNSPEC`ai_family
*   我使用`IPPROTO_TCP`而不是`IPPROTO_UDP`.

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-13T19:17:51.557

您也可以使用[libcurl](http://cool.haxx.se/cvs.cgi/curl/lib/inet_pton.c?rev=1.21&content-type=text/vnd.viewcvs-markup)作为参考。重新发明轮子并不总是必要的。

# php - 如何使用 PHP 制作 pdf 文件

> ID：547216
> 
> 赞同：3
> 
> 时间：2009-02-13T18:59:50.010
> 
> 标签：php, pdf

如何在 PHP 中制作 PDF 文件。我想做的是学生名单。所以我想查询数据库，获取信息并在用户单击生成学生列表时将其作为 PDF 提供给用户。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-02-13T19:04:25.070

您有两个不错的选择，首先是用于操作 pdf 的标准 php 库：http: [//us2.php.net/pdf](http://us2.php.net/pdf)

或者您可以使用[http://www.fpdf.org/](http://www.fpdf.org/)。我会推荐第二个。

其他选项包括： [www.pdflib.com](http://www.pdflib.com)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-13T19:01:51.707

PEAR 有[PEAR::File_PDF](http://pear.php.net/package/File_PDF)包。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-13T19:04:19.530

已经有许多库可用于 PHP 绑定。想到的一个是 PDFLib (www.pdflib.com)。如果我没记错的话，甚至应该有一个可以免费使用的精简版。但只是检查一下。

希望能帮助到你

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-13T19:05:03.990

我使用[ezPDF](http://www.ros.co.nz/pdf/)类。轻巧，简单，易于使用，并且可以处理大多数情况。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-20T16:52:48.177

[FPDF](http://www.fpdf.org/ "FPDF")是该领域的经典之作。处理 Unicode（例如亚洲字符集）时似乎有限制，因此有一些库对其进行了扩展（[UFPDF](http://acko.net/blog/ufpdf "UFPDF")，[TCPDF](http://www.tecnick.com/public/code/cp_dpage.php?aiocp_dp=tcpdf "TCPDF") ...）。

# apache-flex - 使用 nant 自动发布我的 flex 站点？

> ID：547218
> 
> 赞同：1
> 
> 时间：2009-02-13T19:01:14.890
> 
> 标签：apache-flex, nant

我正在使用 Flex，我厌倦了每当我想要发布时都必须手动将文件放在正确的文件夹中。我想在构建成功时发布。

有没有一种快速的方法，使用 Nant（不是我当前选择的构建工具）来自动化这个？我的 PC 上有一个虚拟目录，它是我的托管目录。

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-13T19:15:02.313

NAnt 有一个复制任务可以让你这样做。只需指定要复制的文件和文件夹以及目标文件夹。

如果您还使用 NAnt 构建 Flex 应用程序，您可以自动执行构建和文件/文件夹复制。

一个例子：

```
<copy todir="${build.dir}">
  <fileset basedir="bin">
    <include name="*.dll" />
  </fileset>
</copy> 
```

[http://nant.sourceforge.net/release/latest/help/tasks/copy.html](http://nant.sourceforge.net/release/latest/help/tasks/copy.html)

# java - 火狐“ssl_error_no_cypher_overlap”错误

> ID：547219
> 
> 赞同：19
> 
> 时间：2009-02-13T19:01:15.030
> 
> 标签：java, security, apache, firefox, ssl

我和我的同事在使用 Firefox 3.0.6 访问我们正在开发的 Java 1.6.0___11 Web 应用程序时遇到问题。在会话开始后 1-30 分钟内一切正常……但最终，连接失败并出现以下错误：

`Secure Connection Failed`

`An error occurred during a connection to 10.x.x.x.`

`Cannot communicate securely with peer: no common encryption algorithm(s).`

`(Error code: ssl_error_no_cypher_overlap)`

IE 工作正常。Firefox 在 Windows 和 Fedora 中都会引发错误，因此问题似乎与操作系统无关。Java EE 应用程序在 Tomcat 6.0.16 服务器上运行。所有页面都使用 TLS 1.0 通过带有 mod_nss 的 Apache 2.2.8 HTTP 服务器进行加密。

我们的 Apache 服务器配置为拒绝 SSL 3.0 连接。我们的一个假设是 Firefox 可能正在尝试建立 SSL 3.0 连接……但为什么呢？

基于一些谷歌搜索，我们尝试了以下事情，但没有成功：

*   使用 Firefox 2.x（有些人报告了 2.x 有效但 3.x 无效的情况）：

*   启用 SSL2

*   禁用 SSL3

*   禁用 OCSP（工具 > 选项 > 高级 > 加密 > 验证）

*   确保客户端计算机的防病毒/防火墙没有阻止或扫描端口 443（https 端口）

有任何想法吗？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2014-12-06T23:13:13.193

I had the same issue while renewing the certificate for our server at www.tpsynergy.com . After importing the new server certificate and restarting the tomcat, the error we were getting was ERR_SSL_VERSION_OR_CIPHER_MISMATCH. After lot of research, I used this link [https://www.sslshopper.com/certificate-key-matcher.html](https://www.sslshopper.com/certificate-key-matcher.html) to compare the csr (certificate signing request to the actual certificate). They both did not match. So I created a new csr and obtained a new certificate and installed the same. It worked.

So the full steps for the process are

1.  From the same server where the certificate will be installed, create CSR

keytool -keysize 2048 -genkey -alias tomcat -keyalg RSA -keystore tpsynergy.keystore (change the domain name as needed)

While creating this, it will ask for first name and last name. Do not give your name, but use the domain name. For example I gave it as www.tpsynergy.com

2.keytool -certreq -keyalg RSA -alias tomcat -file csr.csr -keystore tpsynergy.keystore

This will create a csr.csr file in the same folder. copy the contents of this to the godaddy site and create the new certificate.

3.  The downloaded certificate zip file will have three files gd_bundle-g2-g1.crt gdig2.crt youractualcert.crt

4.  You will need to download the root cert gdroot-g2.crt from godaddy repository.

5.  Copy all these files to the same directory from where you created the CSR file and where the keystore file is located.

6.  Now run the below commands one by one to import the certs into the keystore

    keytool -import -trustcacerts -alias root -file gd_bundle-g2-g1.crt -keystore tpsynergy.keystore

    keytool -import -trustcacerts -alias root2 -file gdroot-g2.crt -keystore tpsynergy.keystore

    keytool -import -trustcacerts -alias intermediate -file gdig2.crt -keystore tpsynergy.keystore

    keytool -import -trustcacerts -alias tomcat -file yourdomainfile.crt -keystore tpsynergy.keystore

7.  Ensure that server.xml file in conf folder has this entry

8.  Restart the tomcat

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-08-24T14:14:26.393

鉴于您尝试过的内容和错误消息，我想说这更多地与使用的确切密码算法有关，而不是与 TLS/SSL 版本有关。您是在使用非 Sun JRE，还是使用不同供应商的安全实施？如果可以，请尝试使用不同的 JRE/OS 来测试您的服务器。如果你不能看到[Wireshark](http://www.wireshark.org/ "线鲨")发生了什么（过滤器为 'tcp.port == 443'）。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-08-29T04:50:12.350

如果您查看 Wikipedia 上的 SSL 协商过程，您会知道一开始 ClientHello 和 ServerHello 消息是在浏览器和服务器之间发送的。

只有当 ClientHello 中提供的密码在服务器上有重叠项时，ServerHello 消息才会包含双方都支持的密码。否则，由于没有通用密码，因此不会启动 SSL 连接。

要解决此问题，您需要安装密码（通常在操作系统级别），而不是在浏览器上努力（通常浏览器依赖于操作系统）。我熟悉Windows和IE，但我对Linux和Firefox知之甚少，所以我只能指出问题所在，无法为您提供解决方案。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2015-10-02T11:23:25.747

[在使用Burp](https://portswigger.net/burp/)时，我在浏览安全网站 (https://) 时遇到了类似的问题（或者至少是在搜索 Google 时将您带到此页面的问题）：

*   `ssl_error_no_cypher_overlap`在火狐中
*   `ERR_SSL_VERSION_OR_CIPHER_MISMATCH`在铬

原来是[使用 Java 8](http://forum.portswigger.net/thread/1181/unable-generate-ca-certificate)的问题。当我切换到 Java 7 时，问题就停止了。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-08-25T15:28:30.383

我要检查的第一件事是 mod_nss 的配置。这是一个奇怪的问题，因为它是你的，世界上没有像它这样的 :-) 而如果 Firefox 或 mod_nss 本身存在一些巨大的错误，我想你现在已经在你的谷歌任务。您修改配置（例如禁用 SSL3 和其他各种随机调整）的事实也很可疑。

我会回到一个非常普通的 mod_nss 配置，看看它是否有效。然后系统地更改您当前的配置，直到您可以重现问题。听上去，错误的来源在 mod_nss 的密码规范配置和相关的协议协商内容中。因此，也许您在尝试关闭 SSLv3 时无意中更改了某些内容（顺便说一句，为什么要禁用 SSL3？通常人们会禁用 V2？）。

要检查的另一件事是您使用的是最新的 mod_nss 并且这不是已知的错误。它设法启动会话然后失败的事实很有趣 - 它表明它可能正在尝试重新协商会话并且当时未能协商密码。所以它可能是对称密码。或者它可能只是你的 mod_nss 版本中的一个实现错误，它以某种方式混淆了协议。

另一个想法，这是一个疯狂的猜测，是浏览器正在尝试恢复在您禁用它之前与 SSLv3 协商的会话，并且在 V3 关闭时尝试恢复该会话时出现问题，或者 mod_nss 只是没有不能正确执行。

java/tomcat 的东西似乎是一条红鲱鱼，除非我误解了你的描述，否则 SSL 握手/协议中不涉及这些。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-13T19:14:28.603

在Firefox的高级设置下，您应该能够设置加密。默认情况下，应检查 SSL3.0 和 TLS1.0，因此如果 firefox 尝试创建 ssl 3.0 连接，请尝试取消选中 ssl 3.0s 设置。

如果这不起作用，请尝试在 about:config 页面中搜索“ssl2” 我的 Firefox 已将 ssl2 默认设置为 false 的设置...

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2020-12-03T09:22:38.547

我在一个非常旧的本地路由器上遇到了同样的问题，并且由于自签名证书而无法打开它的 WebGUI。解决方案是安装[旧的 Firefox Portable 版本](https://sourceforge.net/projects/portableapps/files/Mozilla%20Firefox%2C%20Portable%20Ed./)。我测试了以下版本：

*   Firefox 33.1.1（工作）
*   Firefox 45.0.2（工作）
*   Firefox 56.0.2（失败）

这很奇怪，因为它应该只是[版本 59 以来的一个问题](https://superuser.com/questions/1303396/how-to-fix-firefox-59-no-longer-accepting-my-self-signed-ssl-certificate-on-dev)，但只要它有效，对我来说就可以了。

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2010-10-02T20:03:14.387

如果您在 Firefox 上收到无密码重叠错误，并且您将其保留为默认设置，那么您使用的肯定是一个非常不安全的站点，试图使用非常弱的“导出级”密码。这些天不鼓励使用这些密码，我个人会停止使用试图使用如此弱密码的网站。

* * *

## 回答 #9

> 赞同：-2
> 
> 时间：2014-12-26T23:35:23.973

对我有用的是我：

1.  转到关于：配置。
2.  在搜索框中输入“安全”。
3.  将所有返回的条目设置为其默认值。
4.  在搜索框中输入“ssl”。
5.  将所有返回的结果设置为其默认值。
6.  启用 ssl2。
7.  禁用 ssl3。
8.  重新启动火狐。

重启火狐注意事项：当我关闭它后很快启动它时，它经常出现文件访问问题，这需要我删除**C:\WINDOWS\Application Data\Mozilla\Firefox**中的**places.sqlite** 和**places.sqlite-journal** **\配置文件\n18091xv.default**。这导致我丢失了我的历史记录，而且每次发生这种情况时都必须从备份中恢复书签。我等待五到十分钟或更长时间以避免这种麻烦。

在 WinMe 上运行 Firefox v3.5.1

* * *

## 回答 #10

> 赞同：-2
> 
> 时间：2014-10-22T19:31:23.430

登录后出现“错误代码：ssl_error_no_cypher_overlap”错误消息，此时应出现欢迎屏幕 - 使用 Firefox 浏览器

解决方案

在 Firefox 浏览器中启用对 40 位 RSA 加密的支持： 1：在浏览器地址栏中输入“about:config” 2：查找/选择“security.ssl3.rsa_rc4_40_md5” 3：将布尔值设置为 TRUE

* * *

## 回答 #11

> 赞同：-2
> 
> 时间：2009-09-01T13:26:24.190

我也有同样的问题；解决足以启用“about：config”中的所有 SSL 模式。我是通过使用 ssl 过滤来找到它们的。首先，我启用了所有选项来禁用不必要的选项。

* * *

## 回答 #12

> 赞同：-4
> 
> 时间：2014-10-22T19:38:14.723

登录后出现“错误代码：ssl_error_no_cypher_overlap”错误消息，当出现欢迎屏幕时 - 使用 Firefox 浏览器 解决方案 1：在浏览器地址栏中输入 'about:config' 2：查找/选择“security.ssl3.rsa_rc4_40_md5” 3：将布尔值设置为真的

# html - ASP.NET MVC 导航和用户界面设计

> ID：547222
> 
> 赞同：7
> 
> 时间：2009-02-13T19:02:12.937
> 
> 标签：html, asp.net-mvc, css, user-interface, navigation

**短版**：

* * *

你知道有什么方法可以让输入按钮（提交）和锚标记使用 CSS 而没有 Javascript 在视觉上呈现相同的内容吗？

**长版**：

* * *

我正在开发一个 ASP.NET MVC 应用程序。该站点包含查看详细信息或创建或更新我的模型的页面。页面操作包含在表单的底部，通常包括**Update**和**Cancel**或**Edit**、**Delete**和**List**（如果在详细信息视图页面上）。**Update**、**Edit**和**Delete**操作将数据从表单发布到服务器，而**Cancel**和**List**动作是/可以由适当的 GET 请求处理。重要的是要注意，我的设计目标之一是在禁用 Javascript 时使站点尽可能地工作，就像启用 Javascript 时那样。我还希望 UI 元素在视觉上呈现相同的元素，无论该元素是导致回发还是触发 GET 请求。

为了让表单提交在没有 Javascript 的情况下工作，我想我必须使用提交按钮。我用 CSS 覆盖了按钮的视觉样式，以呈现很像 SO 页面顶部的“按钮”——平面、纯色和纯文本。我希望使用锚标记处理生成 GET 请求的操作，但是我无法让这些标记和样式按钮以相同的方式呈现。对齐和字体大小似乎存在问题。我能够让它们接近但不完全相同。

**编辑**： *使用按钮和锚的样式差异包括无法让字体在边界框内相对于基线的相同位置呈现，以及让边界框本身以相对于容器的相同大小和对齐方式呈现。无论我如何调整，事情都只是以一种或另一种方式偏离了几个像素。如果你能够让它工作，请告诉我。知道这是可能的，会让我更容易继续尝试，直到我让它发挥作用。*

我尝试过的一件事是将 GET 操作包裹在一个按钮上，其样式类似于表单按钮。这在 Firefox 中效果很好，但在 IE7 中却不行。在 IE7 中单击此类按钮不会将单击传播回锚点。我现在想出的是为 GET 创建一个新表单，使用 method="GET"，与所需的操作相关联。我将它包裹在一个提交按钮周围，该按钮具有一个 onclick 处理程序，该处理程序设置`location.href`为所需操作的 URL。即使表单嵌套在另一个表单中，这在视觉上呈现相同并且似乎可以工作。一个小问题是，如果禁用了 Javascript，那么我的 GET url`?`在末尾包含 a 而不是您想要的漂亮干净的 url。

我想知道的是，是否有其他人以不同的方式解决了这个问题，效果更好（并且可能需要更少的 HTML）？你有什么我可以尝试的其他想法吗？`?`当关闭Javascript时将请求作为帖子提交时，有什么方法可以修复GET url？

下面的示例代码来自详细信息视图。我意识到我也可以（并且可以说应该）通过 javascript 添加 onclick 处理程序，但是当我内联执行时，代码实际上读起来更好。我正在使用 HtmlHelper 扩展来生成下面的所有标记。我已经重新格式化它以提高可读性。

```
 <form action="../Edit/2" class="inline-form" method="get">
        <input class="button"
               onclick="location.href='../Edit/2';return false;"
               value="Edit"
               type="submit" />
    </form>
    <form action="../Delete/2" class="inline-form" method="post">
         <input class="button"
                value="Delete"
                type="submit" />
    </form>
    <form action="../List" class="inline-form" method="get">
        <input class="button"
               onclick="location.href='../List';return false;"
               value="List Donors"
               type="submit" />
    </form> 
```

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-02-13T21:17:21.613

您应该查看[这篇](http://particletree.com/features/rediscovering-the-button-element/)关于设置按钮标签样式的文章。它包括用于呈现两者的 CSS 和相似的标签，并且具有允许按钮中的图标的副作用。

# php - wamp 无法加载 mysqli 扩展

> ID：547224
> 
> 赞同：14
> 
> 时间：2009-02-13T19:03:09.580
> 
> 标签：php, mysql, localhost, phpmyadmin

WAMP 安装良好，没有问题，但是...

去 phpMyAdmin 时，我从 phpMyAdmin 收到如下错误：

```
Cannot load mysqli extension. Please check your PHP configuration 
```

此外，phpMyAdmin 文档对此错误消息的解释如下：

> 为了连接到 MySQL 服务器，PHP 需要一组称为“MySQL 扩展”的 MySQL 函数。此扩展可能是 PHP 发行版的一部分（已编译），否则需要动态加载。它的名字可能是 mysql.so 或 php_mysql.dll。phpMyAdmin 尝试加载扩展但失败。通常，通过安装名为“PHP-MySQL”或类似的软件包来解决问题。

最后，apache_error.log 文件包含以下 PHP 警告（请参阅 mySQL 警告）：

```
PHP Warning: Zend Optimizer does not support this version of PHP - please upgrade to the latest version of Zend Optimizer in Unknown on line 0
PHP Warning: Zend Platform does not support this version of PHP - please upgrade to the latest version of Zend Platform in Unknown on line 0
PHP Warning: Zend Debug Server does not support this version of PHP - please upgrade to the latest version of Zend Debug Server in Unknown on line 0
PHP Warning: gd wrapper does not support this version of PHP - please upgrade to the latest version of gd wrapper in Unknown on line 0
PHP Warning: java wrapper does not support this version of PHP - please upgrade to the latest version of java wrapper in Unknown on line 0
PHP Warning: mysql wrapper does not support this version of PHP - please upgrade to the latest version of mysql wrapper in Unknown on line 0 
```

因此，由于某种原因 PHP 无法识别 mysql 扩展。

有谁知道为什么？任何解决方案或解决方法？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-10-17T04:53:15.013

我删除了程序文件中的PHP，一切都开始工作了，问题是安装了两次pHp

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2012-01-26T06:32:08.777

我尝试了许多解决方案，但没有一个对我有用。我尝试了以下解决方案：

*   重启 wampserver
*   重新安装 wampserver
*   重启机器
*   以及此问题中提到的所有其他解决方案。

然而，这些都没有奏效。然后我发现我的 PHPMyAdmin 没有在 chrome 中工作，而是在 firefox 中工作。所以我尝试清除缓存，重新启动浏览器等，但仍然无法正常工作。

然后我删除了所有文件`C:\wamp\tmp`，然后再次尝试，它可以工作。我不确定它为什么会起作用，但这是我的想法。会话被缓存并且没有被清除。所以一旦我删除了这个目录中的所有文件，所有的会话都被删除了，因此它工作正常。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-07-15T04:27:13.120

首先，确保`php.ini`文件正在加载`mysqli`扩展名。
如果您使用的是 WAMPServer，请单击系统托盘中的图标，转到`PHP`->`PHP Extensions`并确保已选中。如果没有，请进入`php.ini`文件并确保该行：`extension=php_mysqli.dll`未注释（例如，删除`;`如果它存在）。如果该行不存在，请添加它。

如果这仍然不起作用，请仔细检查`php.ini`是否正在加载正确的文件。
为此，请查看您的 phpinfo()（[此处](http://localhost/?phpinfo=1)为 WAMPServer）。向下滚动到该`Loaded Configuration File`行并查看`php.ini`正在加载的行。`Make sure it is the right file. If you're using WAMPServer, it should be`（WAMP 安装文件夹）\bin\apache\Apache2.2.11\bin\php.ini `. By default, it is`C:\wamp\bin\apache\Apache2.2.11\bin\php.ini`。

如果`php.ini`正在加载不同的文件，只需将其重命名为其他名称，以便 PHP 将尝试在其他位置找到该文件。应该有一种方法可以指定你想使用哪个，但我忘记了具体怎么做......

如果这仍然不起作用...尝试弄乱 phpMyAdmin 的设置，或使用其他答案，但恐怕我无能为力。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2014-03-18T12:23:16.693

我正在使用两个 PHP 版本 1) 5.2.9 和 2) 5.2.13 运行 WAMP。

根据站点要求，我需要将 PHP 版本从 5.2.13 更改为 5.2.9。交换 PHP 版本后，错误是“缺少 mysqli 扩展”。经过长时间调试后，我知道这是由于 php.ini 文件中的“extension_dir”路径错误。

所以我改变了它的价值：

旧：“extension_dir”c:/wamp/bin/php/php5.2.13/ext/

新：“extension_dir”c:/wamp/bin/php/php5.2.9/ext/

重新启动wamp服务器中的所有服务，然后它就被修复了。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-12-22T10:21:39.867

在 wampserver 中转到 php.ini。打开文件并取消注释 extension=msql.dll 通过删除分号(;) 为各自的操作系统。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-05-13T18:55:23.447

还要设置mysql密码：

```
SET PASSWORD FOR root@localhost=PASSWORD('your_password'); 
```

以及 config.inc.php 中的 phpmyadmin mysql 密码：

```
$cfg['Servers'][$i]['password'] = 'your_password'; 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-07-15T04:09:39.223

我有同样的问题。我安装了 WAMP 服务器。一切正常。然后有一天我重新启动了我的电脑，它就停止了工作！我拼命尝试浏览所有帮助帖子并进行操作，但没有任何效果。

他们通常建议您做的是，首先转到您的 php.ini 文件并确保您的“extension_dir”设置正确。然后确保这两行没有被注释（去掉前面的 ;）： extension=php_mysql.dll extension=php_mysqli.dll

然后有人建议我下载这两个文件的新副本，但没有一个有效。我还尝试卸载所有内容（php/mysql/apache）并多次重新安装 WAMP 服务器的新副本，但没有成功。

最后，我设法找到了替代解决方案。我切换到“easyphp”（[http://www.easyphp.org/](http://www.easyphp.org/)）。这与 WAMP 非常相似。首先，我备份了我的 sql 数据库，以便在新安装时重新加载它们。

然后我安装了“easyphp”，一切似乎都正常。我从备份中重新加载了我的 sql 数据库，现在一切恢复正常。

我希望有人患有类似的问题。会发现这很有用。如果有人真的找到了使 WAMP 服务器正常工作的修复程序。请务必将其张贴在这里，这样很多人都会受益。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2011-06-09T23:20:21.503

只需添加您的 php.ini：

```
[PHP_MCRYPT]
extension=php_mcrypt.dll
[PHP_MYSQL]
extension=php_mysql.dll
[PHP_MYSQLI]
extension=php_mysqli.dll 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2010-01-15T14:10:11.263

只是想插话这个。使用 Wamp Server 2.0，并使用 Zend Studio 和 Zend 调试器进行开发。

到目前为止，我还不能（将在某个时候回到它）让 zend 调试器与 php 5.3 一起工作。所以在 wamp 中我加载了一个早期的 php 版本，5.2.11。访问 php 我的管理员时，我遇到了同样的错误。

我必须做的是更改“extension_dir”的 php.ini 文件值`c:/wamp/bin/php/php5.2.11/ext/`以匹配我正在使用的 php 版本。在那之后，一切都很好。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2012-11-30T20:20:36.757

对我来说，在搜索所有日志/互联网/所有非正常事物之后，我做了这个。您必须通过以下方式注册 dl：

通过申请：

```
WAMP -> PHP settings -> enable dl 
```

或者

```
# php.ini #

; Whether or not to enable the dl() function.  The dl() function does NOT work
; properly in multithreaded servers, such as IIS or Zeus, and is automatically
; disabled on them.
; http://php.net/enable-dl
enable_dl = On 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2013-06-13T05:59:55.050

我一次又一次地安装 wamp，检查 php.ini 文件，重新启动机器，替换 index.php 文件，努力尝试，

但没有一个有效。然后我去 wamp/temp 并删除了所有文件，现在它工作正常。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2012-12-02T20:05:54.973

我刚刚安装了 WampServer，遇到了同样的问题。我找到了对我有用的解决方案，它非常简单。

1.  禁用 PHP 扩展`php_mysqli`。
2.  重启 WampServer，访问本地`phpmyadmin`.
3.  启用`php_mysqli`回来。
4.  重复步骤 2。

几次页面刷新后，剩余的错误板（关于`MySQL`和`sqli`）消失了。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2012-02-29T18:36:08.973

我遇到了这个问题，花了 2 个小时在网上尝试了所有解决方案，但都没有奏效。

试过这个，它醒了：

改变

> mysql.default_host =

至

> mysql.default_host = 本地主机

并重新启动 WAMP。注意你是否使用mysqli。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2012-10-15T17:14:16.363

我遇到这个问题很久了。
尝试了我在论坛上阅读的所有内容，这最终对我有用：
打开你的 php.ini（我假设你已经加载了好的那个......）并找到 mysqli.default_port = 3306
更改为
mysqli 的这一行。 default_port = 80
重新启动所有服务
转到 localhost/phpmyadmin -> 将不起作用
重新打开 php.ini 文件并重新键入此
mysqli.default_port = 3306
重新启动所有服务
为我工作。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2011-01-10T20:04:57.967

有同样的问题，与 wamp。尝试用备份交换您当前版本的 php.ini。有一个在：`wamp\bin\php\php5.3.0phpForApache.txt`。为我工作。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2012-04-13T03:41:42.330

我有同样的错误。当我增加脚本内存大小并启用 E_ALL 然后重新启动服务器时，我在 phpmyadmin 中遇到了该错误。我所要做的就是重新启动我的电脑！

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2018-10-04T15:06:06.357

我将 Windows 中的路径变量设置为一些随机版本的 php。

修复方法是更新它并将其设置为我的 wampserver 安装中的文件夹：

```
C:\wamp64\bin\php\php5.6.38 
```

然后我意识到这对于我的具体情况也是错误的，我实际上应该从 vagrant 中运行脚本。活到老，学到老。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2019-07-22T14:50:34.363

由于不同的原因，我遇到了这个问题：

检查 PHP 错误日志（从 Wamp 托盘获取 -> PHP -> PHP 错误日志。我在编辑文件时在 php.ini 文件中有语法错误。检查日志并清除错误。这将打开您的PhpMyAdmin 正确。

# oracle - sql查询中的参数：SSRS

> ID：547235
> 
> 赞同：1
> 
> 时间：2009-02-13T19:06:06.937
> 
> 标签：oracle, reporting-services, parameters

我正在使用`oracleclient`提供者。我想知道如何在查询中使用参数。

```
select * from table A where A.a in ( parameter). 
```

参数应该是`multivalue`参数。

如何创建数据集？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-13T20:12:33.110

You can't have a variable in list in oracle directly. You can however, break apart a comma seperated list into rows that can be used in your subquery. The string txt can be replaced by any number of values seperated by a comma.

```
 select * from a where a.a in ( 
       SELECT regexp_substr(txt,'[^,]+',1,level)
         FROM (SELECT 'hello,world,hi,there' txt  -- replace with parameter
                 FROM DUAL)
   CONNECT BY LEVEL <= LENGTH (REGEXP_REPLACE (txt, '[^,]'))+1
   ) 
```

The query works by first counting the number of commas that are in the text string. It does this by using a reqular expression to remove all non commas and then counts the length of the remainder.

It then uses an Oracle "trick" to return that number + 1 number of rows from the dual table. It then uses the regexp_substr function to pull out each occurence.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-13T19:12:59.917

简单的。将参数添加到报告中，并确保将其选中为多值。然后在数据选项卡中进入并编辑查询单击“...”按钮以编辑数据集。在参数选项卡下创建一个映射参数，使其看起来像这样（显然您的参数会有不同的名称）：

```
@ids | =Parameters!ContractorIDS.Value 
```

然后在查询选项卡中使用 coorelated 子查询，如您上面的示例。我已经用 SQL Server 做过很多次了，它没有理由不能与 Oracle 一起工作，因为 SSRS 将构建一个符合 ANSI 的 SQL 语句，它将传递给 Oracle。

```
where A.myfield in (@ids) 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2013-01-16T23:36:33.833

首先，在具有 Oracle OLEDB 连接的 SSRS 中，您需要使用冒号，而不是 @ 符号，例如 :parameter 不是 @parameter 但是您不能将其作为多值参数来执行，它只接受单个值。更糟糕的是，如果您使用的是 ODBC 连接，则必须单独使用问号，例如？不是@parameter，然后参数的顺序变得很重要，它们也不能是多值的。剩下的唯一方法是使用表达式构造查询（参数的 join() 函数）或调用存储过程。

存储过程选项是最好的，因为 SSRS 可以非常干净地处理存储过程的参数到 SQL Server 和 Oracle，但如果这不是一个选项，你可以使用这个表达式：

```
="select column1, column2, a from table A where A.a in (" + Join(Parameters!parameter.Value,", ") + ")" 
```

或者，如果参数值是需要在它们周围加上撇号的字符串：

```
="select column1, column2, a from table A where A.a in ('" + Join(Parameters!parameter.Value,"', '") + "')" 
```

当您右键单击数据集时，您可以选择“数据集属性”，然后使用 fx 按钮将查询编辑为表达式，而不是使用不允许您将其编辑为表达式的查询设计器。

此表达式方法的最大限制为大约 1000 个值，但如果您有这么多值，无论如何这都是错误的方法，您宁愿加入一个表。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-13T19:08:27.430

我认为您不能在这种情况下使用参数。（除非 oracle 和您使用的语言支持数组类型参数？）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2014-01-08T21:33:56.307

oracle 中的参数被定义为“:parametername”，所以在你的查询中你应该使用类似的东西：

```
select * from table A where value in (:parametername) 
```

将参数添加到报告中的参数文件夹并标记复选框“允许多个值”。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2017-12-12T16:40:25.737

正如维克多格里马尔多提到的......下面对我来说非常好。一旦我`:parameter`在 SSRS 数据集 1 中的 SQL 查询中使用 .. 它要求我输入这些参数的值，我为此选择已经创建的 SSRS 参数。

`SELECT * FROM table a WHERE VALUE IN (**:parametername**)`

谢谢维克多。

# perl - 如何在没有运行时检查的情况下设置 Eclipse 来编辑 Perl？

> ID：547237
> 
> 赞同：3
> 
> 时间：2009-02-13T19:06:59.977
> 
> 标签：perl, eclipse, text-editor

我正在开发一个同时包含 Java（在客户端）和 Perl（在服务器端）的项目，我真的很想使用 Eclipse 来编辑我的 Perl 脚本，而不是去另一个编辑器。我试过使用[EPIC 插件](http://www.epic-ide.org/)。但是，我无法在本地机器上为这些脚本设置运行环境，因此插件会显示与缺少库和其他外部依赖项相关的各种错误。

我只想要一个为 Perl 提供漂亮语法高亮的文本编辑器。有什么建议么？使用 EPIC 插件时有什么方法可以关闭运行时错误检查？我无法通过快速搜索找到任何东西。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-15T12:52:29.523

它本身不是工作台中的设置。这是每个项目的设置。

在您的 Perl 项目中，选择 Project->Properties。在该对话框中，单击“构建器”。您可能只有一个——“Perl Auto Builder”。取消选择它并单击“确定”。

不幸的是，您必须为每个单独的 Perl 项目执行此操作。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-13T21:33:55.693

你没有指出你的操作系统。试试[Padre](http://padre.perlide.org/) - 它是跨平台的。它可以与 CPAN shell 一起安装（如果你在 Windows 上使用[Strawberry Perl](http://strawberryperl.com/)，你至少需要 10 月份的版本）。Padre 仍在快速发展，但已经支持 Perl 5 和 6（6 需要插件）。HTML、JavaScript 和 CSS（也带有插件）。已经编写了许多其他插件，例如 Perl::Critic。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-13T22:43:33.543

你可以试试[Perlipse](http://code.google.com/p/perlipse/)，它似乎是一个[活跃](http://perlipse.blogspot.com/)的项目。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-15T13:06:57.537

[Emacs](http://www.gnu.org/software/emacs/)是一个出色的 Perl 文本编辑器。 `cperl-mode`拥有任何编辑器（甚至 Padre）中最好的 Perl 语法高亮支持，并且 Emacs 应该满足您所有的编辑需求。它很容易编写脚本，并且有数以千计的扩展可用。（有些甚至更好地支持 Perl，比如[Stylish::REPL](http://github.com/jrockway/stylish)。）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-05-24T13:34:53.750

使用`EditPlus`, 最简单的语法高亮编辑器。适用于`Perl`.

# hibernate - 如何使用 jboss-log4j.xml 文件为不同的应用程序在不同的日志文件中定向 Hibernate 记录器语句

> ID：547242
> 
> 赞同：3
> 
> 时间：2009-02-13T19:07:48.010
> 
> 标签：hibernate, logging, jboss, log4j

我正在使用 JBOSS 4.2.2 服务器来部署多个 Web 应用程序。每个应用程序都使用 Hibernate，并且每个应用程序都有单独的日志文件和单独的附加程序。现在对于一个应用程序的 Hibernate 日志记录语句应该进入该特定应用程序的日志文件。有人知道如何配置 log4j.xml 文件来实现这一点吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2010-02-03T15:11:38.623

[在 JBoss 中，您可以使用此处](http://community.jboss.org/wiki/SeparatingApplicationLogs)描述的 TCL 过滤器。只需将过滤器添加到您要操作的配置部分。

示例（稍微改编自上述源代码，请*参阅 Deploy Application As .war File*部分）：

```
<appender name="App1Log" class="org.apache.log4j.FileAppender">
    <errorHandler class="org.jboss.logging.util.OnlyOnceErrorHandler" />
    <param name="Append" value="false"/>
    <param name="File" value="${jboss.server.log.dir}/app1.log"/>
    <layout class="org.apache.log4j.PatternLayout">
        <param name="ConversionPattern" value="%d{ISO8601} %-5p [%8.8t][%20.20c] %m%n"/>
    </layout>
    <filter class="org.jboss.logging.filter.TCLFilter">
        <param name="AcceptOnMatch" value="true"/>
        <param name="DeployURL" value="app1-exp.war"/>
    </filter>
</appender> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-11T21:48:23.327

如果您有多个应用程序，每个应用程序都在运行 hibernate，只需在应用程序 log4j.xml 文件中使用 hibernate 类的类路径（即 org.hibernate）创建一个休眠附加程序，这应该将输出定向到指定的日志文件。

如果这不起作用，请检查 hibernate 是否没有拾取已捆绑到任何库 jar 中的 log4j 属性文件。如果 hibernate 找不到 log4j.xml 文件，那么您应该在 system.out 中收到一条警告消息

卡尔

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-11-08T08:53:10.197

1.  添加 NDC。日志仍然转到同一个文件，但该文件将更容易 grep。
2.  更改 JBoss 类加载，以便每个应用程序都可以拥有自己的 log4j.xml

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-10-01T16:56:45.930

我不能 100% 确定我是否正确理解了您的问题。我假设您希望根据发出日志语句的应用程序将同一记录器的输出定向到不同的文件。

Log4J 提供了一个[映射诊断上下文](http://logging.apache.org/log4j/1.2/apidocs/org/apache/log4j/MDC.html)。在休眠代码运行之前，可以将此上下文设置为不同的值（取决于您的应用程序）。hibernate 发出的每个日志语句也包含 MDC 的内容。

有了它，您可以编写一个特殊的附加程序来检查 MDC 的内容并将日志消息写入不同的文件。

我在一个繁重的多线程应用程序中使用了这种方法，其中每个线程都生成自己的日志文件，并且效果很好。

# css - 使用文本缩进的图像导航

> ID：547245
> 
> 赞同：0
> 
> 时间：2009-02-13T19:08:17.713
> 
> 标签：css, xhtml, navigation, text-indent

我正在尝试为我的网站创建一个简单的图像导航，使用 CSS 来声明`background-image`列表项 (li) 的属性。问题是，当我`text-indent`将图像放在屏幕外时，链接不再存在（我想也是在屏幕外）。任何帮助将不胜感激。这是我的 XHTML：

```
<div id="nav">
  <ul>
    <li class="current about">
      <a href="#about" title="about">about</a>
    </li>
    <li class="contact">
      <a href="#contact" title="contact">contact</a>
    </li>
    <li class="networks">
      <a href="#networks" title="networks">networks</a>
    </li>
  </ul>
</div> 
```

这是我的CSS：

```
#nav li {
   display: block;
   float:left;
   background-image: url("images/nav-normal.png");
   height:47px;
   text-indent: -9999px;
} 
```

我还为各个列表项设置了背景位置，因为我使用的是[图像精灵](http://www.alistapart.com/articles/sprites/)。提前致谢！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-13T19:15:37.600

将该样式应用于`#nav li a`. 否则`li`，包括链接在内的所有内容都会移出屏幕。

# c# - ?：操作员与。If 语句性能

> ID：547249
> 
> 赞同：33
> 
> 时间：2009-02-13T19:08:30.550
> 
> 标签：c#, .net, performance, if-statement, operators

我一直在尝试优化我的代码，使其更加简洁和可读，并希望这样做不会导致性能下降。我认为我的更改可能会减慢我的应用程序，但它可能只是在我的脑海中。两者之间是否有任何性能差异：

```
Command.Parameters["@EMAIL"].Value = email ?? String.Empty; 
```

和

```
Command.Parameters["@EMAIL"].Value = (email == null) ? String.Empty: email; 
```

和

```
if (email == null)
{
    Command.Parameters["@EMAIL"].Value = String.Empty
}
else
{
    Command.Parameters["@EMAIL"].Value = email
} 
```

我对可读性的偏好是空合并运算符，我只是不希望它影响性能。

* * *

## 回答 #1

> 赞同：72
> 
> 时间：2009-02-13T19:27:27.290

您正在尝试在这里进行[微优化](http://www.codinghorror.com/blog/2009/01/the-sad-tragedy-of-micro-optimization-theater.html)，这通常是一个很大的禁忌。除非你有性能分析来告诉你这是一个问题，否则它甚至不值得改变。

对于一般用途，正确的答案是更容易维护的东西。

尽管如此，空合并运算符的 IL 是：

```
L_0001: ldsfld string ConsoleApplication2.Program::myString
L_0006: dup 
L_0007: brtrue.s L_000f
L_0009: pop 
L_000a: ldsfld string [mscorlib]System.String::Empty
L_000f: stloc.0 
```

开关的 IL 是：

```
L_0001: ldsfld string ConsoleApplication2.Program::myString
L_0006: brfalse.s L_000f
L_0008: ldsfld string ConsoleApplication2.Program::myString
L_000d: br.s L_0014
L_000f: ldsfld string [mscorlib]System.String::Empty
L_0014: stloc.0 
```

对于[空合并运算符](http://msdn.microsoft.com/en-us/library/ms173224.aspx)，如果值为`null`，则执行六个语句，而对于[`switch`](http://msdn.microsoft.com/en-us/library/06tc147t%28v=VS.100%29.aspx)，执行四个操作。

在非`null`值的情况下，空合并运算符执行四个操作而不是五个操作。

当然，这假设所有 IL 操作都花费相同的时间，但事实并非如此。

无论如何，希望你能看到在这个微观尺度上的优化是如何迅速开始减少回报的。

话虽如此，最后，对于大多数情况，在这种情况下最容易阅读和维护的就是正确的答案。

如果您发现这样做的规模被证明是低效的（并且这些情况很少而且相差甚远），那么您应该衡量哪个具有更好的性能，然后进行特定的优化。

* * *

## 回答 #2

> 赞同：69
> 
> 时间：2009-02-13T19:12:34.970

恕我直言，针对可读性和理解进行优化 - 与您在现实世界中花费的时间相比，当您在几个月后回到此代码并尝试了解您到底是什么时，任何运行时性能提升都可能是最小的首先做。

* * *

## 回答 #3

> 赞同：18
> 
> 时间：2009-02-13T19:50:21.527

> 我认为我的更改可能会减慢我的应用程序，但它可能只是在我的脑海中。

除非您实际上是在*衡量*性能，否则这一切都在您的脑海中和无谓的猜测中。

（不是特别挑剔你，但看到一个又一个关于性能微优化（以及许多答案）的问题不包含“测量”一词，真是令人失望。）

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-02-13T19:13:47.073

我怀疑不会有任何性能差异。

除此之外，我想知道为什么您会担心在这种情况下偏爱一种陈述而不是另一种陈述？我的意思是：性能影响（如果有的话）将是最小的。恕我直言，这将是一种微优化，不值得付出努力。
我会选择最易读、最清晰且不担心性能的语句，因为它的影响最小（在这种情况下）。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2009-02-13T19:17:45.473

在这种情况下几乎没有显着的性能差异。

当性能差异可以忽略不计时，一切都与**可读代码**有关。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2014-09-14T13:53:23.027

为了讨论... if/then/else 的运行速度与 ?: 三元运算的运行速度与单级 switch/case 语句一样快。

[以下是 C# 代码的一些性能基准。](http://cc.davelozinski.com/c-sharp/what-is-the-fastest-conditional-statement)

只有当你开始深入到 2-3 级时，性能才会开始受到严重影响。也就是说，像这个荒谬的例子：

```
switch (x % 3)
    {
        case 0:
            switch (y % 3)
            {
                case 0: total += 3;
                    break;
                case 1: total += 2;
                    break;
                case 2: total += 1;
                    break;
                default: total += 0;
                    break;
            }
            break;
        case 1:
            switch (y % 3)
            {
                case 0: total += 3;
                    break;
                case 1: total += 2;
                    break;
                case 2: total += 1;
                    break;
                default: total += 0;
                    break;
            }
            break;
    case 2:
            switch (y % 3)
            {
                case 0: total += 3;
                    break;
                case 1: total += 2;
                    break;
                case 2: total += 1;
                    break;
                default: total += 0;
                    break;
            }
            break;
    default:
        switch (y % 3)
        {
            case 0: total += 3;
                break;
            case 1: total += 2;
                break;
            case 2: total += 1;
                break;
            default: total += 0;
                break;
        }
        break;
    } 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2013-05-11T11:28:47.397

这是机器级代码是有效的还是人类可读的代码的问题。当我们使它对我们更具可读性时，它使机器能够复杂地解释代码，反之亦然......

# delphi - Tortoise SVN插件获取Redmine的问题列表，Delphi中的插件

> ID：547255
> 
> 赞同：1
> 
> 时间：2009-02-13T19:10:27.783
> 
> 标签：delphi, svn, tortoisesvn, bug-tracking, redmine

我下载了tortoise插件示例，但不知道如何在Delphi上实现。

我已经成功编译了 C# 示例，并在存储库中使用它，但是我在 C# 方面的一般开发知识很差。另一方面，我不知道如何开始在 Delphi 中创建该插件，但之后我认为这对我来说很容易。

我想为 Redmine 问题列表集成制作一个插件。

像“hello world”这样的东西会很棒！

这里有一些使用 C# 做一个新插件的指南： [http://svn.devjavu.com/traceexplorer/trunk/ext/tortoisesvn.net/issue-tracker-plugins.txt](http://svn.devjavu.com/tracexplorer/trunk/ext/tortoisesvn.net/issue-tracker-plugins.txt) [http://tortoisesvn.tigris.org/ds /viewMessage.do?dsForumId=757&dsMessageId=1113569](http://tortoisesvn.tigris.org/ds/viewMessage.do?dsForumId=757&dsMessageId=1113569)

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-13T20:10:16.440

The TSVN plugin API is COM-based. I'd start by learning how to implement a COM object in Delphi. There's [this book](https://rads.stackoverflow.com/amzn/click/com/1578702216). I also found [this](http://delphi.about.com/od/beginners/l/aa113004a.htm).

If you already know how to implement COM objects in Delphi, then I apologise for being condescending. Do you have any questions specifically about the IBugTraqProvider interface? Oh, and IBugTraqProvider2 is new to TSVN 1.6 (i.e. not released yet).

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-16T08:53:45.290

去

```
File->New->Other...->ActiveX and select COM Object 
```

您将需要接口声明。Delphi 直接支持 *.tlb。如果没有，则必须将 *.idl 转换为 pascal 接口声明。这比听起来容易。请注意，接口声明可能位于 SVN 主干中的某个位置。

您不需要声明您的新 COM 对象实现 IBugTraqProvider 接口，并根据需要实现它。

完成后，您可能需要使用 TortoiseSVN 注册新的 COM 库。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-16T08:21:19.847

您可以在此页面上查看功能 C# 插件： [http ://www.redmine.org/boards/3/topics/5420](http://www.redmine.org/boards/3/topics/5420)

# php - PHP - 将表单字段值默认为当前日期

> ID：547276
> 
> 赞同：1
> 
> 时间：2009-02-13T19:14:35.107
> 
> 标签：php, datetime, date

我正在尝试将字段中的值默认为当前日期，但是我的代码：

```
<?php 
echo '<input type="text" name="makeupassignment" size="50" value="'.date("m/d/y").'">';
?> 
```

只打印这个：

'; ?>

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-13T19:33:09.073

在我看来，网页没有通过 PHP 解释器运行。查看网页的来源。当您在浏览器中单击“显示源代码”时，您是否看到 PHP 源代码？

我认为发生的情况是您的浏览器将其解析如下：

*   打开类型为 ?php 的标签
*   两个名为“echo”和“'<input”的字段
*   然后是具有值的字段：type="text"、name="makeupassignment"、size="50" 和 value="'.date("，然后是 m/d/y")。'"
*   然后是结束标签>
*   然后剩下的就是逐字输出

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-13T19:34:14.390

我猜你正在测试的网络服务器上没有启用/安装 PHP。查看该页面上的源代码，我敢打赌，您会看到所有代码

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-13T19:39:10.540

基本上，PHP 不会解析页面的代码。

*   您正在运行的脚本是 .html 还是 .php 脚本？确保它是正确的后缀。我发现 Firefox 不会打开 .php 页面（除非我通过 localhost 访问它）。
*   PHP 正在运行吗？`php -v`通过在控制台/终端窗口中运行来检查。
*   Apache（/IIS/lighttpd 等）是否正在运行？

# asp.net - 使用实体框架时有哪些好的设计实践

> ID：547278
> 
> 赞同：74
> 
> 时间：2009-02-13T19:15:18.087
> 
> 标签：asp.net, visual-studio-2008, entity-framework

这将主要适用于不通过 soa 访问数据的 asp.net 应用程序。这意味着您可以访问从框架加载的对象，而不是传输对象，尽管一些建议仍然适用。

这是一个社区帖子，因此请在您认为合适的情况下添加。

**适用于**：Visual Studio 2008 sp1 附带的 Entity Framework 1.0。

**为什么首先选择EF？**

考虑到它是一项有很多问题的年轻技术（见下文），要为您的项目加入 EF 潮流可能很难。然而，这是微软正在推动的技术（以牺牲 Linq2Sql 为代价，它是 EF 的一个子集）。此外，您可能对 NHibernate 或其他解决方案不满意。不管是什么原因，有一些人（包括我）和 EF 一起工作，生活还不错。让你思考。

**EF 和继承**

第一个大主题是继承。EF 确实支持以 2 种方式持久化的继承类的映射：每个类的表和表的层次结构。建模很容易，并且该部分没有编程问题。

（以下适用于每个类模型的表，因为我没有每个层次结构表的经验，无论如何，这是有限的。）真正的问题是当您尝试运行包含一个或多个对象的查询时继承树：生成的 sql 非常糟糕，需要很长时间才能被 EF 解析并且也需要很长时间才能执行。这是一个真正的表演终结者。足够了，EF 可能不应该与继承一起使用或尽可能少地使用。

这是一个有多糟糕的例子。我的 EF 模型有约 30 个类，其中约 10 个是继承树的一部分。在运行查询以从 Base 类中获取一项时，就像 Base.Get(id) 一样简单，生成的 SQL 超过 50,000 个字符。然后，当您尝试返回一些关联时，它会退化得更厉害，甚至会抛出关于无法一次查询超过 256 个表的 SQL 异常。

好的，这很糟糕，EF 概念是允许您创建对象结构而不考虑（或尽可能少地）考虑表的实际数据库实现。它在这方面完全失败了。

那么，推荐？如果可以的话，避免继承，性能会好很多。在必须的地方谨慎使用它。在我看来，这使得 EF 成为了一个美化的 sql-generation 查询工具，但使用它仍然有优势。以及实现类似于继承的机制的方法。

*使用接口绕过继承*

尝试使用 EF 进行某种继承时要知道的第一件事是，您不能为非 EF 建模的类分配基类。甚至不要尝试，它会被建模者覆盖。那么该怎么办？

您可以使用接口来强制类实现某些功能。例如，这里是一个 IEntity 接口，允许您在设计时不知道实体类型的 EF 实体之间定义关联。

```
public enum EntityTypes{ Unknown = -1, Dog = 0, Cat }
public interface IEntity
{
    int EntityID { get; }
    string Name { get; }
    Type EntityType { get; }
}
public partial class Dog : IEntity
{
   // implement EntityID and Name which could actually be fields 
   // from your EF model
   Type EntityType{ get{ return EntityTypes.Dog; } }
} 
```

使用此 IEntity，您可以在其他类中使用未定义的关联

```
// lets take a class that you defined in your model.
// that class has a mapping to the columns: PetID, PetType
public partial class Person
{
    public IEntity GetPet()
    {
        return IEntityController.Get(PetID,PetType);
    }
} 
```

它利用了一些扩展功能：

```
public class IEntityController
{
    static public IEntity Get(int id, EntityTypes type)
    {
        switch (type)
        {
            case EntityTypes.Dog: return Dog.Get(id);
            case EntityTypes.Cat: return Cat.Get(id);
            default: throw new Exception("Invalid EntityType");
        }
    }
} 
```

不像普通继承那样简洁，特别是考虑到您必须将 PetType 存储在额外的数据库字段中，但考虑到性能提升，我不会回头。

它也不能模拟一对多、多对多的关系，但通过创造性地使用“Union”，它可以发挥作用。最后，它会在对象的属性/函数中创建加载数据的副作用，您需要注意这一点。在这方面使用像 GetXYZ() 这样的明确命名约定会有所帮助。

**编译查询**

实体框架的性能不如使用 ADO（显然）或 Linq2SQL 直接访问数据库。但是，有一些方法可以改进它，其中之一是编译您的查询。编译查询的性能类似于 Linq2Sql。

什么是编译查询？它只是一个查询，您告诉框架将已解析的树保留在内存中，以便下次运行时不需要重新生成它。所以下一次运行，您将节省解析树所需的时间。不要小看这一点，因为这是一项非常昂贵的操作，如果查询更复杂，情况会变得更糟。

编译查询有两种方法：使用 EntitySQL 创建 ObjectQuery 和使用 CompiledQuery.Compile() 函数。（请注意，通过在您的页面中使用 EntityDataSource，您实际上将使用带有 EntitySQL 的 ObjectQuery，以便编译和缓存）。

如果您不知道 EntitySQL 是什么，请放在此处。它是针对 EF 编写查询的基于字符串的方式。这是一个示例：“从 Entities.DogSet 中选择值 dog 作为 dog，其中 dog.ID = @ID”。语法与 SQL 语法非常相似。您还可以进行非常复杂的对象操作，[此处][1] 对此进行了很好的解释。

好的，这里是如何使用 ObjectQuery<>

```
 string query = "select value dog " +
                       "from Entities.DogSet as dog " +
                       "where dog.ID = @ID";

        ObjectQuery<Dog> oQuery = new ObjectQuery<Dog>(query, EntityContext.Instance));
        oQuery.Parameters.Add(new ObjectParameter("ID", id));
        oQuery.EnablePlanCaching = true;
        return oQuery.FirstOrDefault(); 
```

第一次运行此查询时，框架将生成表达式树并将其保存在内存中。因此，下次执行时，您将节省昂贵的步骤。在该示例中，EnablePlanCaching = true，这是不必要的，因为这是默认选项。

编译查询以供以后使用的另一种方法是 CompiledQuery.Compile 方法。这使用了一个委托：

```
 static readonly Func<Entities, int, Dog> query_GetDog =
        CompiledQuery.Compile<Entities, int, Dog>((ctx, id) =>
            ctx.DogSet.FirstOrDefault(it => it.ID == id)); 
```

或使用 linq

```
 static readonly Func<Entities, int, Dog> query_GetDog =
        CompiledQuery.Compile<Entities, int, Dog>((ctx, id) =>
            (from dog in ctx.DogSet where dog.ID == id select dog).FirstOrDefault()); 
```

调用查询：

```
query_GetDog.Invoke( YourContext, id ); 
```

CompiledQuery 的优点是在编译时会检查查询的语法，而 EntitySQL 则不会。但是，还有其他考虑...

*包括*

假设您希望查询返回狗主人的数据，以避免对数据库进行 2 次调用。很容易做到，对吧？

实体SQL

```
 string query = "select value dog " +
                       "from Entities.DogSet as dog " +
                       "where dog.ID = @ID";
        ObjectQuery<Dog> oQuery = new ObjectQuery<Dog>(query, EntityContext.Instance)).Include("Owner");
        oQuery.Parameters.Add(new ObjectParameter("ID", id));
        oQuery.EnablePlanCaching = true;
        return oQuery.FirstOrDefault(); 
```

编译查询

```
 static readonly Func<Entities, int, Dog> query_GetDog =
        CompiledQuery.Compile<Entities, int, Dog>((ctx, id) =>
            (from dog in ctx.DogSet.Include("Owner") where dog.ID == id select dog).FirstOrDefault()); 
```

现在，如果您想让 Include 参数化怎么办？我的意思是，您希望拥有一个从关心狗的不同关系的不同页面调用的单个 Get() 函数。一个关心所有者，另一个关心他的 FavoriteFood，另一个关心他的 FavotireToy 等等。基本上，您想告诉查询要加载哪些关联。

使用EntitySQL很容易

```
public Dog Get(int id, string include)
{
        string query = "select value dog " +
                       "from Entities.DogSet as dog " +
                       "where dog.ID = @ID";

        ObjectQuery<Dog> oQuery = new ObjectQuery<Dog>(query, EntityContext.Instance))
    .IncludeMany(include);
        oQuery.Parameters.Add(new ObjectParameter("ID", id));
        oQuery.EnablePlanCaching = true;
        return oQuery.FirstOrDefault();
} 
```

包含只是使用传递的字符串。很容易。请注意，可以使用 IncludeMany(string) 改进 Include(string) 函数（仅接受单个路径），该函数允许您传递逗号分隔的关联字符串以进行加载。进一步查看此功能的扩展部分。

然而，如果我们尝试使用 CompiledQuery 来做这件事，我们会遇到很多问题：

显而易见的

```
 static readonly Func<Entities, int, string, Dog> query_GetDog =
        CompiledQuery.Compile<Entities, int, string, Dog>((ctx, id, include) =>
            (from dog in ctx.DogSet.Include(include) where dog.ID == id select dog).FirstOrDefault()); 
```

调用时会窒息：

```
query_GetDog.Invoke( YourContext, id, "Owner,FavoriteFood" ); 
```

因为，如上所述，Include() 只想查看字符串中的单个路径，在这里我们给它 2：“Owner”和“FavoriteFood”（不要与“Owner.FavoriteFood”混淆！）。

然后，让我们使用 IncludeMany()，它是一个扩展函数

```
 static readonly Func<Entities, int, string, Dog> query_GetDog =
        CompiledQuery.Compile<Entities, int, string, Dog>((ctx, id, include) =>
            (from dog in ctx.DogSet.IncludeMany(include) where dog.ID == id select dog).FirstOrDefault()); 
```

又错了，这一次是因为 EF 无法解析 IncludeMany，因为它不是被识别函数的一部分：它是一个扩展。

好的，所以您想将任意数量的路径传递给您的函数，而 Includes() 只需要一个。该怎么办？您可以决定永远不需要超过 20 个 Includes，然后将结构中的每个分隔字符串传递给 CompiledQuery。但现在查询看起来像这样：

```
from dog in ctx.DogSet.Include(include1).Include(include2).Include(include3)
.Include(include4).Include(include5).Include(include6)
.[...].Include(include19).Include(include20) where dog.ID == id select dog 
```

这也很糟糕。好的，那么，请稍等。我们不能用 CompiledQuery 返回一个 ObjectQuery<> 吗？然后在上面设置包含？好吧，我也会这么想：

```
 static readonly Func<Entities, int, ObjectQuery<Dog>> query_GetDog =
        CompiledQuery.Compile<Entities, int, string, ObjectQuery<Dog>>((ctx, id) =>
            (ObjectQuery<Dog>)(from dog in ctx.DogSet where dog.ID == id select dog));
public Dog GetDog( int id, string include )
{
    ObjectQuery<Dog> oQuery = query_GetDog(id);
    oQuery = oQuery.IncludeMany(include);
    return oQuery.FirstOrDefault;   
} 
```

这应该有效，除了当您调用 IncludeMany（或 Include、Where、OrderBy...）时，您会使缓存的编译查询无效，因为它现在是一个全新的查询！因此，表达式树需要重新解析，并且再次获得该性能。

那么解决方案是什么？您根本不能将 CompiledQueries 与参数化包含一起使用。请改用 EntitySQL。这并不意味着 CompiledQueries 没有用途。这对于始终在相同上下文中调用的本地化查询非常有用。理想情况下应该始终使用 CompiledQuery，因为在编译时会检查语法，但由于限制，这是不可能的。

一个使用示例是：您可能希望有一个页面来查询哪两只狗有相同的最喜欢的食物，这对于 BusinessLayer 函数来说有点狭窄，所以您将它放在您的页面中并确切知道包含的类型是什么必需的。

*将超过 3 个参数传递给 CompiledQuery*

Func 限制为 5 个参数，其中最后一个是返回类型，第一个是模型中的 Entities 对象。这样就剩下 3 个参数了。有点遗憾，但它可以很容易地改进。

```
public struct MyParams
{
    public string param1;
    public int param2;
    public DateTime param3;
}

    static readonly Func<Entities, MyParams, IEnumerable<Dog>> query_GetDog =
        CompiledQuery.Compile<Entities, MyParams, IEnumerable<Dog>>((ctx, myParams) =>
            from dog in ctx.DogSet where dog.Age == myParams.param2 && dog.Name == myParams.param1 and dog.BirthDate > myParams.param3 select dog);

public List<Dog> GetSomeDogs( int age, string Name, DateTime birthDate )
{
    MyParams myParams = new MyParams();
    myParams.param1 = name;
    myParams.param2 = age;
    myParams.param3 = birthDate;
    return query_GetDog(YourContext,myParams).ToList();
} 
```

*返回类型（这不适用于 EntitySQL 查询，因为它们在执行期间与 CompiledQuery 方法不同时编译）*

使用 Linq，您通常不会强制执行查询，直到最后一刻，以防下游的某些其他功能想要以某种方式更改查询：

```
 static readonly Func<Entities, int, string, IEnumerable<Dog>> query_GetDog =
        CompiledQuery.Compile<Entities, int, string, IEnumerable<Dog>>((ctx, age, name) =>
            from dog in ctx.DogSet where dog.Age == age && dog.Name == name select dog);

public IEnumerable<Dog> GetSomeDogs( int age, string name )
{
    return query_GetDog(YourContext,age,name);
}
public void DataBindStuff()
{
    IEnumerable<Dog> dogs = GetSomeDogs(4,"Bud");
    // but I want the dogs ordered by BirthDate
    gridView.DataSource = dogs.OrderBy( it => it.BirthDate );

} 
```

这里会发生什么？通过仍然使用原始 ObjectQuery（即实现 IEnumerable 的 Linq 语句的实际返回类型），它将使编译后的查询无效并强制重新解析。因此，经验法则是返回一个 List<> 对象。

```
 static readonly Func<Entities, int, string, IEnumerable<Dog>> query_GetDog =
        CompiledQuery.Compile<Entities, int, string, IEnumerable<Dog>>((ctx, age, name) =>
            from dog in ctx.DogSet where dog.Age == age && dog.Name == name select dog);

public List<Dog> GetSomeDogs( int age, string name )
{
    return query_GetDog(YourContext,age,name).ToList(); //<== change here
}
public void DataBindStuff()
{
    List<Dog> dogs = GetSomeDogs(4,"Bud");
    // but I want the dogs ordered by BirthDate
    gridView.DataSource = dogs.OrderBy( it => it.BirthDate );

} 
```

当您调用 ToList() 时，查询会根据编译后的查询执行，然后，OrderBy 会针对内存中的对象执行。它可能会慢一点，但我什至不确定。可以肯定的是，您不必担心错误处理 ObjectQuery 并使编译的查询计划无效。

再一次，这不是一揽子声明。ToList() 是一种防御性编程技巧，但如果您有正当理由不使用 ToList()，请继续。在许多情况下，您希望在执行查询之前对其进行细化。

*表现*

编译查询对性能有何影响？它实际上可以相当大。一个经验法则是编译和缓存查询以供重用至少需要两倍于不缓存的情况下执行它的时间。对于复杂的查询（阅读 inherirante），我已经看到了 10 秒。

因此，第一次调用预编译查询时，性能会受到影响。在第一次命中之后，性能明显优于相同的非预编译查询。与 Linq2Sql 几乎相同

当您第一次加载带有预编译查询的页面时，您将获得成功。它可能会在 5-15 秒内加载（显然最终会调用多个预编译查询），而后续加载将花费不到 300 毫秒。巨大的差异，由您决定是否可以让您的第一个用户受到打击，或者您希望脚本调用您的页面以强制编译查询。

*可以缓存此查询吗？*

```
{
    Dog dog = from dog in YourContext.DogSet where dog.ID == id select dog;
} 
```

不，临时 Linq 查询不会被缓存，每次调用它都会产生生成树的成本。

*参数化查询*

大多数搜索功能都涉及大量参数化的查询。甚至还有一些可用的库可以让您从 Lamba 表达式中构建参数化查询。问题是您不能对这些查询使用预编译的查询。解决此问题的一种方法是在查询中绘制出所有可能的条件并标记您要使用的条件：

```
public struct MyParams
{
    public string name;
public bool checkName;
    public int age;
public bool checkAge;
}

    static readonly Func<Entities, MyParams, IEnumerable<Dog>> query_GetDog =
        CompiledQuery.Compile<Entities, MyParams, IEnumerable<Dog>>((ctx, myParams) =>
            from dog in ctx.DogSet 
    where (myParams.checkAge == true && dog.Age == myParams.age) 
        && (myParams.checkName == true && dog.Name == myParams.name ) 
    select dog);

protected List<Dog> GetSomeDogs()
{
    MyParams myParams = new MyParams();
    myParams.name = "Bud";
    myParams.checkName = true;
    myParams.age = 0;
    myParams.checkAge = false;
    return query_GetDog(YourContext,myParams).ToList();
} 
```

这里的优点是您可以获得预编译的 quert 的所有好处。缺点是您很可能最终会得到一个很难维护的 where 子句，您将因预编译查询而受到更大的惩罚，并且您运行的每个查询都没有达到应有的效率（特别是加入连接）。

另一种方法是逐段构建 EntitySQL 查询，就像我们对 SQL 所做的那样。

```
protected List<Dod> GetSomeDogs( string name, int age)
{
string query = "select value dog from Entities.DogSet where 1 = 1 ";
    if( !String.IsNullOrEmpty(name) )
        query = query + " and dog.Name == @Name ";
if( age > 0 )
    query = query + " and dog.Age == @Age ";

    ObjectQuery<Dog> oQuery = new ObjectQuery<Dog>( query, YourContext );
    if( !String.IsNullOrEmpty(name) )
        oQuery.Parameters.Add( new ObjectParameter( "Name", name ) );
if( age > 0 )
        oQuery.Parameters.Add( new ObjectParameter( "Age", age ) );

return oQuery.ToList();
} 
```

这里的问题是： - 编译期间没有语法检查 - 每个不同的参数组合都会生成不同的查询，在第一次运行时需要对其进行预编译。在这种情况下，只有 4 种不同的可能查询（无参数、仅年龄、仅名称和两个参数），但您可以看到普通世界搜索可以有更多。- 没有人喜欢连接字符串！

另一种选择是查询大量数据子集，然后在内存中缩小范围。如果您正在处理特定的数据子集，例如城市中的所有狗，这将特别有用。你知道有很多，但你也知道没有那么多......所以你的 CityDog 搜索页面可以加载内存中城市的所有狗，这是一个预编译的查询，然后细化结果

```
protected List<Dod> GetSomeDogs( string name, int age, string city)
{
string query = "select value dog from Entities.DogSet where dog.Owner.Address.City == @City ";
    ObjectQuery<Dog> oQuery = new ObjectQuery<Dog>( query, YourContext );
    oQuery.Parameters.Add( new ObjectParameter( "City", city ) );

List<Dog> dogs = oQuery.ToList();

if( !String.IsNullOrEmpty(name) )
        dogs = dogs.Where( it => it.Name == name );
if( age > 0 )
        dogs = dogs.Where( it => it.Age == age );

return dogs;
} 
```

当您开始显示所有数据然后允许过滤时，它特别有用。

问题： - 如果您不小心您的子集，可能会导致严重的数据传输。- 您只能过滤您返回的数据。这意味着如果您不返回 Dog.Owner 关联，您将无法过滤 Dog.Owner.Name 那么最好的解决方案是什么？没有。您需要选择最适合您和您的问题的解决方案： - 当您不关心预编译查询时，使用基于 lambda 的查询构建。- 当您的对象结构不太复杂时，使用完全定义的预编译 Linq 查询。- 当结构可能很复杂并且不同的结果查询的可能数量很小（这意味着更少的预编译命中）时，使用 EntitySQL/字符串连接。

**单例访问**

处理所有页面中的上下文和实体的最佳方法是使用单例模式：

```
public sealed class YourContext
{
    private const string instanceKey = "On3GoModelKey";

    YourContext(){}

    public static YourEntities Instance
    {
        get
        {
            HttpContext context = HttpContext.Current;
            if( context == null )
                return Nested.instance;

            if (context.Items[instanceKey] == null)
            {
                On3GoEntities entity = new On3GoEntities();
                context.Items[instanceKey] = entity;
            }
            return (YourEntities)context.Items[instanceKey];
        }
    }

    class Nested
    {
        // Explicit static constructor to tell C# compiler
        // not to mark type as beforefieldinit
        static Nested()
        {
        }

        internal static readonly YourEntities instance = new YourEntities();
    }
} 
```

**不跟踪，值得吗？**

执行查询时，您可以告诉框架跟踪它将返回或不返回的对象。这是什么意思？启用跟踪（默认选项）后，框架将跟踪对象的情况（是否已修改？已创建？已删除？）并且还将在从数据库进行进一步查询时将对象链接在一起，这就是在这里很有趣。

例如，假设 ID == 2 的 Dog 拥有 ID == 10 的所有者。

```
Dog dog = (from dog in YourContext.DogSet where dog.ID == 2 select dog).FirstOrDefault();
    //dog.OwnerReference.IsLoaded == false;
    Person owner = (from o in YourContext.PersonSet where o.ID == 10 select dog).FirstOrDefault();
    //dog.OwnerReference.IsLoaded == true; 
```

如果我们在不跟踪的情况下做同样的事情，结果会有所不同。

```
ObjectQuery<Dog> oDogQuery = (ObjectQuery<Dog>)
    (from dog in YourContext.DogSet where dog.ID == 2 select dog);
oDogQuery.MergeOption = MergeOption.NoTracking;
Dog dog = oDogQuery.FirstOrDefault();
    //dog.OwnerReference.IsLoaded == false;
ObjectQuery<Person> oPersonQuery = (ObjectQuery<Person>)
    (from o in YourContext.PersonSet where o.ID == 10 select o);
oPersonQuery.MergeOption = MergeOption.NoTracking;
    Owner owner = oPersonQuery.FirstOrDefault();
    //dog.OwnerReference.IsLoaded == false; 
```

跟踪非常有用，在没有性能问题的完美世界中，它会一直开启。但在这个世界上，就性能而言，它是有代价的。那么，您应该使用 NoTracking 来加快速度吗？这取决于您计划将数据用于什么目的。

您使用 NoTracking 查询的数据是否有可能用于在数据库中进行更新/插入/删除？如果是这样，请不要使用 NoTracking，因为关联不会被跟踪，并且会导致抛出异常。

在绝对没有数据库更新的页面中，您可以使用 NoTracking。

混合跟踪和 NoTracking 是可能的，但它要求您在更新/插入/删除时格外小心。问题是，如果您混合使用，那么您可能会让框架尝试将 NoTracking 对象附加（）到存在同一对象的另一个副本且启用跟踪的上下文中。基本上，我要说的是

```
Dog dog1 = (from dog in YourContext.DogSet where dog.ID == 2).FirstOrDefault();

ObjectQuery<Dog> oDogQuery = (ObjectQuery<Dog>)
    (from dog in YourContext.DogSet where dog.ID == 2 select dog);
oDogQuery.MergeOption = MergeOption.NoTracking;
Dog dog2 = oDogQuery.FirstOrDefault(); 
```

dog1 和 dog2 是 2 个不同的对象，一个被跟踪，一个不被跟踪。在更新/插入中使用分离的对象将强制 Attach() 说“等一下，我这里已经有一个具有相同数据库键的对象。失败”。当你 Attach() 一个对象时，它的所有层次结构也会被附加，从而导致到处出现问题。要格外小心。

*使用 NoTracking 能快多少*

这取决于查询。有些人比其他人更容易跟踪。我没有一个快速的简单规则，但它有帮助。

*那么我应该到处使用 NoTracking 吗？*

不完全是。跟踪对象有一些优点。第一个是对象被缓存，因此对该对象的后续调用不会命中数据库。该缓存仅在 YourEntities 对象的生命周期内有效，如果您使用上面的单例代码，它与页面生命周期相同。一页请求 == 一个 YourEntity 对象。因此，对于同一个对象的多次调用，每个页面请求只会加载一次。（其他缓存机制可以扩展它）。

当您使用 NoTracking 并尝试多次加载同一个对象时会发生什么？每次都会查询数据库，所以那里有影响。在单个页面请求期间，您应该/应该多久调用一次相同的对象？当然尽可能少，但它确实发生了。

还记得上面关于为您自动连接关联的文章吗？NoTracking 没有，因此如果您分批加载数据，则它们之间将没有链接：

```
ObjectQuery<Dog> oDogQuery = (ObjectQuery<Dog>)(from dog in YourContext.DogSet select dog);
oDogQuery.MergeOption = MergeOption.NoTracking;
List<Dog> dogs = oDogQuery.ToList();

ObjectQuery<Person> oPersonQuery = (ObjectQuery<Person>)(from o in YourContext.PersonSet  select o);
oPersonQuery.MergeOption = MergeOption.NoTracking;
    List<Person> owners = oPersonQuery.ToList(); 
```

在这种情况下，没有狗会设置其 .Owner 属性。

在尝试优化性能时要记住一些事情。

**没有延迟加载，我该怎么办？**

这可以看作是因祸得福。当然，手动加载所有内容很烦人。但是，它减少了对数据库的调用次数，并迫使您考虑何时应该加载数据。您可以在一个数据库调用中加载的越多越好。这一直是正确的，但现在通过 EF 的这个“功能”强制执行。

当然，你可以调用 if(!ObjectReference.IsLoaded) ObjectReference.Load(); 如果您愿意，但更好的做法是强制框架一次性加载您知道需要的对象。这是关于参数化包含的讨论开始有意义的地方。

假设你有你的 Dog 对象

```
public class Dog
{
    public Dog Get(int id)
    {
        return YourContext.DogSet.FirstOrDefault(it => it.ID == id );
    }
} 
```

这是您一直使用的函数类型。它从各处被调用，一旦你有了那个 Dog 对象，你将在不同的函数中对它做非常不同的事情。首先，它应该是预编译的，因为你会经常调用它。其次，每个不同的页面都希望能够访问不同的 Dog 数据子集。有些人会想要 Owner，有些人会想要 FavoriteToy，等等。

当然，您可以随时为所需的每个参考调用 Load()。但这每次都会产生对数据库的调用。馊主意。因此，每个页面都会在第一次请求 Dog 对象时询问它想要查看的数据：

```
 static public Dog Get(int id) { return GetDog(entity,"");}
    static public Dog Get(int id, string includePath)
{
        string query = "select value o " +
            " from YourEntities.DogSet as o " + 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2011-10-20T05:16:14.060

请不要使用上述所有信息，例如“单例访问”。您绝对 100% 不应该存储此上下文以供重用，因为它不是线程安全的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-03-26T06:46:42.930

虽然内容丰富，但我认为分享所有这些如何融入完整的解决方案架构可能会更有帮助。示例 - 获得了一个解决方案，显示您在哪里同时使用 EF 继承和您的替代方案，以便显示它们的性能差异。

# c# - 在运行时停止/启动 WCF MEX 服务

> ID：547287
> 
> 赞同：2
> 
> 时间：2009-02-13T19:17:32.963
> 
> 标签：c#, c#-3.0, wcf

是否有可能/如何在运行时停止和启动自托管 WCF 服务的 HTTP MEX 侦听器而不影响主 WCF 服务？

（请不要问我为什么要这样做。绕过别人强加的人为限制是一种黑客行为。）

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-16T06:43:30.900

*****[重新测试和代码清理后重新添加此答案] 这是我添加到基于 WCF 的通用服务开发框架中的实际代码，并且已经过全面测试。*****

假设您从启用 MEX 开始`ServiceHost`...

> 以下解决方案是根据子类 ( ) 编写的，该`ServiceHost`子类 ( `WCFServiceHost<T>`) 实现了用于存储 MEX类`IWCFState`实例的特殊接口 ( ) 。`EndpointDispatcher`

首先，添加这些命名空间...

```
using System.ServiceModel;
using System.ServiceModel.Dispatcher; 
```

其次，定义`IWCFState`接口...

```
public interface IWCFState
{
    EndpointDispatcher MexEndpointDispatcher
    {
        get;
        set;
    }
} 
```

第三，为一些扩展方法创建一个静态类`ServiceHost`（我们将在下面填写它们）......

```
public static class WCFExtensions
{
    public static void RemoveMexEndpointDispatcher(this ServiceHost host){}

    public static void AddMexEndpointDispatcher(this ServiceHost host){}
} 
```

现在让我们填写扩展方法...

## `ServiceHost`在运行时停止 MEX

```
public static void RemoveMexEndpointDispatcher(this ServiceHost host)
{
    // In the simple example, we only define one MEX endpoint for
    // one transport protocol
    var queryMexChannelDisps = 
            host.ChannelDispatchers.Where(
                disp => (((ChannelDispatcher)disp).Endpoints[0].ContractName
                                            == "IMetadataExchange"));
    var channelDisp = (ChannelDispatcher)queryMexChannelDisps.First();

    // Save the MEX EndpointDispatcher
    ((IWCFState)host).MexEndpointDispatcher = channelDisp.Endpoints[0];

    channelDisp.Endpoints.Remove(channelDisp.Endpoints[0]);
} 
```

然后这样称呼...

```
// WCFServiceHost<T> inherits from ServiceHost and T is the Service Type,
// with the new() condition for the generic type T.  It encapsulates 
// the creation of the Service Type that is passed into the base class 
// constructor.
Uri baseAddress = new Uri("someValidURI");
WCFServiceHost<T> serviceImplementation = new WCFServiceHost<T>(baseAddress);

// We must open the ServiceHost first...
serviceImplementation.Open();

// Let's turn MEX off by default.
serviceImplementation.RemoveMexEndpointDispatcher(); 
```

## `ServiceHost`在运行时（再次）启动 MEX

```
public static void AddMexEndpointDispatcher(this ServiceHost host)
{
    var queryMexChannelDisps =
            host.ChannelDispatchers.Where(
                    disp => (((ChannelDispatcher)disp).Endpoints.Count == 0));
    var channelDisp = (ChannelDispatcher)queryMexChannelDisps.First();

    // Add the MEX EndpointDispatcher
    channelDisp.Endpoints.Add(((IWCFState)host).MexEndpointDispatcher);
} 
```

然后这样称呼...

```
serviceImplementation.AddMexEndpointDispatcher(); 
```

## 概括

这种设计允许您使用一些消息传递方法向服务本身或托管服务的代码发送命令，并让它执行 MEX 的启用或禁用`EndpointDispatcher`，从而有效地关闭 MEX `ServiceHost`。

注意：此设计假设代码在启动时将支持 MEX，但随后它将使用配置设置来确定服务是否会在`Open()`调用`ServiceHost`. 如果您在打开之前尝试调用任一扩展方法，则会抛出此代码`ServiceHost`。

注意事项：我可能会创建一个特殊的服务实例，其管理操作在启动时不支持 MEX，并将其建立为服务控制通道。

## 资源

在弄清楚这一点时，我发现以下两个资源必不可少：

*   .NET Reflector：*类浏览器、分析器和反编译器，用于检查 System.ServiceModel.dll 等程序集*：[http ://www.red-gate.com/products/reflector/](http://www.red-gate.com/products/reflector/)

*   Extending Dispatchers (MSDN)：提供了一个很棒的 WCF 服务类组成的高级图表：http: [//msdn.microsoft.com/en-us/library/ms734665.aspx](http://msdn.microsoft.com/en-us/library/ms734665.aspx)

# c++ - GCC 中的“空基优化”是否可配置？

> ID：547290
> 
> 赞同：9
> 
> 时间：2009-02-13T19:17:49.937
> 
> 标签：c++, gcc

考虑以下类型：

```
 struct A {};
  struct B : A { int i; }; 
```

`sizeof(A) > 0`按照标准的要求。

`sizeof(B)`由于空基优化，应该是 4。然而在 GCC 4.1.1 上它是 5（我在这个区域使用了一包 1）。而且不一致 - 我的一些文件得到了它，有些没有。还不能确定有什么区别，我们有一个大项目。

在我使用的其他三个编译器（微软和飞思卡尔）上，我没有这个问题。根据[这篇文章](http://www.cantrip.org/emptyopt.html)，空基优化显然是可选的。

在 GCC 4.1.1 中是否有编译器选项或编译指示来调整它？我可以解决这个问题，但我想先了解发生了什么。我用谷歌搜索了一段时间，似乎找不到任何东西。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-02-13T19:57:36.080

这总是发生。我在弄清楚之前立即发布。也许发帖的行为让我以不同的方式思考..

所以在我的问题中，样本有点过于简化了。它实际上更像这样：

```
struct Base {};
struct C1 : Base { int i; }
struct C2 : Base { C1 c; int i; } 
```

sizeof(C1) 在所有平台上都是正确的 4，但 sizeof(C2) 在 GCC 上是 9 而不是 8。而且...显然，根据我在原始问题中链接到的文章的最后一点，GCC 是唯一正确的方法。我会在这里引用它（来自 Nathan Meyers）：

> 根据编译器必须遵守的 ABI 规范，可以进行一系列相关的“空子对象”优化。（Jason Merrill 几年前向我指出了其中的一些。）例如，考虑（空）类型 A、B 和 C 的三个结构成员，以及第四个非空的结构成员。它们可能，一致地，都占用相同的地址，只要它们彼此之间或与包含类没有任何共同的基数。*实践中的一个常见问题是让一个类的第一个（或唯一一个）成员派生自与该类相同的空基。编译器必须插入填充，以便它们两个子对象具有不同的地址。*这实际上发生在具有 interator 成员的迭代器适配器中，两者都派生自 std::iterator。一个不小心实现的标准 std::reverse_iterator 可能会出现这个问题。

所以，我看到的不一致只发生在我有上述模式的情况下。我从空结构派生的所有其他地方都可以。

很容易解决。感谢大家的评论和回答。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-28T07:53:42.470

GCC C++ 使用标准填充遵循这些规则：

注意：`__attribute__((__packed__))`或更改默认包装将修改这些规则。

*   类 EmptyBase {}; --> sizeof(EmptyBase) == 1

*   只要都是唯一类型（包括父级），任何数量的空基都将映射到结构偏移量中的 0。

*   非空基父级仅按声明的顺序排列，仅填充对齐。

*   如果派生类的第一个紧跟空基的成员不是从任何这些基派生的，则允许从该成员的第一个正确对齐的偏移量开始，该偏移量大于或等于空基-基地址——这可能与空基地址相同。

*   如果派生类的第一个紧跟空基地址的成员确实派生自这些基中的任何一个，它将从该成员的第一个正确对齐的偏移量开始，该偏移量大于空基地址——这绝不是与空基地相同的地址。

*   空类成员在包含类中占用至少一个字节的存储空间。

* * *

MSVC++ 遵循以下规则：

注意：`#pragma pack`或更改默认包装将修改这些规则。

*   类 EmptyBase {}; --> sizeof(EmptyBase) == 1

*   空基类（或从空基派生的类）从偏移量 0（零）开始的唯一方法是它是第一个基类。

*   非空基类将从基类的下一个有效对齐偏移量开始。

*   所有空基类在派生类中的有效存储空间似乎为零，并且不会影响当前偏移量，除非后面跟着另一个空基类（或从空基派生的类），在这种情况下，您应该看到以下规则.

*   在空基类（或从空基派生的类）之后的空基类（或从空基派生的类）将在填充到该类的正确对齐之前将当前偏移位置加 1。

*   最后一个基类和第一个类成员或 vft 指针之间没有填充（对齐除外）。*** 注意：这是一个过度激进的空基优化，可能会破坏 C++ 标准。

*   空类成员在包含类中占用至少一个字节的存储空间。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-13T19:44:37.080

好吧，这不是一个完整的答案，但是[GCC 手册](http://gcc.gnu.org/onlinedocs/gcc-4.3.3/gcc/C_002b_002b-Dialect-Options.html#index-C_002b_002b-options_002c-command-line-127)提到 g++ 有时可以将空基类放置在错误的偏移量处。请参阅有关该`-Wabi`选项的信息。

# javascript - 如何在上传文件之前检索文件的大小？

> ID：547292
> 
> 赞同：6
> 
> 时间：2009-02-13T19:17:55.490
> 
> 标签：javascript, file, input, filesize

我的网络应用程序中有一个文件输入标签。我想在将文件发送到服务器之前检查文件是否太大。当然，我仍然有验证服务器端。有没有办法用 JavaScript 做到这一点？它必须在 IE7+ 和 FF3+ 中工作。谢谢你。

编辑： somefileinputobject.files[0].filesize 适用于 FF，但不适用于 IE。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-13T19:22:51.560

这是一个难题。您必须使用 AJAX 来完成，并使用浏览器在 POST 请求中发送到服务器的文件大小标头。

雅虎的 UI 库有一个工具可以帮助解决这个问题。 [YUI 上传器](http://developer.yahoo.com/yui/uploader/ "YUI 上传器")

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-13T19:19:49.620

Javascript 无法做到这一点。这将有严重的安全问题。也许闪存可以。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-13T19:21:04.483

简短的回答：不，你应该在服务器上处理这个。

长答案：不可靠。使用 IE，您可以执行以下操作：

```
function checkSize(filespec) {
var fso, f, s;
fso = new ActiveXObject("Scripting.FileSystemObject");
f = fso.GetFile(filespec);
s = f.size;
// Do something with var s
} 
```

但这很容易受到浏览器的安全设置或使用其他浏览器或平台的影响。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-13T19:21:31.143

无法对所有浏览器使用 Javascript 可靠地完成，但您可以限制发布数据的总大小`web.config`

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-13T19:23:15.087

如果您使用传统的文件输入控件，您真的没有很多选择。您无法在客户端检查它，它会在您有机会检查服务器端之前达到您配置的 maxRequestLength。但是，您可以捕获超出 maxRequestLength 时发生的异常。

# sql-server - 如何捕获/记录 SQL Server 2005“注意”事件？

> ID：547297
> 
> 赞同：0
> 
> 时间：2009-02-13T19:18:40.387
> 
> 标签：sql-server, error-handling

这是在这里参考这个问题：

[检查分布式事务中绕过 CATCH 块的约束](https://stackoverflow.com/questions/546781/check-contraint-bypassing-catch-block-in-distributed-transaction)

显然，在那个分布式事务场景中，一个“注意事件”被发送到我们的 sql server 并且正在破坏连接，而没有给我们机会在 CATCH 块中记录错误。

那么我们如何记录“注意”事件呢？我们不能让事情在后台默默地失败！有没有办法记录这些事件？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-13T19:29:43.543

不幸的是，不是来自连接内部。您必须在数据库上方的级别捕获它。

# php - 对网站进行单元测试

> ID：547302
> 
> 赞同：33
> 
> 时间：2009-02-13T19:18:59.807
> 
> 标签：php, unit-testing, codeigniter

我很想知道其他开发人员如何测试他们的网站。PHP 特别是在我的情况下，但这可能跨越多种语言。我已经在一个网站上工作了一年多，我真的很想自动化我在版本之间进行的很多回归测试。

这个特定的站点在 CodeIgniter 中，所以我对我的模型进行了一些测试。我想超越只是测试这些。但是，我敢肯定，即使是非 MVC 开发人员也必须解决这个问题。

**编辑：**我认为满足我很多测试需求的功能是能够在脚本处理结束时断言参数具有特定值。就我而言，控制器中有很多逻辑，这是我想测试的主要区域。

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2009-02-13T19:25:38.717

对于没有测试 UI 的实际单元测试，您应该只测试模型中的功能。无论如何，您的大部分功能都应该在那里。

你可能想看看[Selenium](http://seleniumhq.org/)来测试你网站的 UI。它可以记录您的操作并回放它们，或者您可以直接编辑脚本。 [（来源：][[seleniumhq.org](http://seleniumhq.org/projects/ide/selenium-ide.gif)][）][![替代文字](https://i.stack.imgur.com/nm6EH.gif)](https://i.stack.imgur.com/nm6EH.gif)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-13T19:28:28.770

你试过[健身](http://fitnesse.org/)吗？

它有助于创建验收测试。它们对网站特别有用，做这种测试很痛苦。

网页内也有一些来自 unclebob 的视频。好消息是 Fitnesse 不受网站测试的限制，因此您对使用它的了解也可以与其他应用程序一起使用。

我正在做的项目是一个用 C++ 编写的桌面应用程序，它使用 Fitnesse 测试。

但是，如果您的意思是对模型进行单元测试（我认为您没有这样做），则可以使用 phpunit 库创建它们。我认为 ZEND 框架有一个类似的库。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-13T19:23:12.823

您可能想查看 PHPUnit [http://www.phpunit.de/manual/current/en/](http://www.phpunit.de/manual/current/en/)

我已经开始在我的 PHP 项目中使用它，它非常易于使用且非常强大。特别是学习和使用模拟： [http ://www.phpunit.de/manual/3.0/en/mock-objects.html](http://www.phpunit.de/manual/3.0/en/mock-objects.html)

在对执行数据库操作的应用程序进行单元测试时，模拟尤其重要。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-07-16T00:04:51.163

看看[吐司](http://jensroland.com/projects/toast/)。它是专门为 CodeIgniter 构建的。它使用 CI 基础架构，因此您可以通过浏览器运行所有测试测试，并将结果显示为网页 (HTML)。使用起来非常简单。

我建议你也测试你的控制器。测试模型没问题，但模型只是数据库存储。控制器包含所有“业务逻辑”，是大多数事情出错的地方。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-13T19:30:01.513

就测试网络应用程序而言，我听说过的最好的想法之一是创建一个脚本，该脚本将遍历站点中的所有页面并检查它们与之前扫描的差异，让您接受更改并修复回归。

一般来说，GUI 应用程序（网站是 GUI 应用程序）的自动测试是困难的并且通常是不必要的。单元测试最适合使用简单的库。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-13T19:34:10.427

我使用 Canoo WebTest。它是目前最好的免费网站单元测试框架。它完全可以使用 XML 编写脚本，并且不需要浏览器，因此可以从构建服务器运行。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-13T19:34:43.843

我们修改了 Waiter (Ruby)。它将 URL 和表单填充的“脚本”播放到 IE，我们添加了一个脚本“命令”来获取屏幕截图；将屏幕截图图像与已知良好图像（即主图像）进行比较，如果该图像不同，则将其记录下来（基本上准备了此类结果的网页），并且“人类”对主图像进行审查/ 测试图像。显然，此时有两种结果——“差异是故意的”或“存在不正确的变化”。在第一个实例中，主图像被新图像替换；在第二个我们去修复错误，并且更改将包含在下一次测试运行中

# html - 为什么服务器端包含不起作用？

> ID：547308
> 
> 赞同：0
> 
> 时间：2009-02-13T19:20:27.370
> 
> 标签：html, apache, xhtml, server-side

我一直在尝试在我的网站上使用服务器端包含来节省编写代码的时间，并能够快速轻松地更改站点范围的元素。

但是，我似乎无法让它们在本地或服务器上工作。

我已将它们设置为“ssi”文件夹中的 .html 文件（仅需要代码，没有 html 或 body 标签），并在我的 .shtml 文件中的适当位置调用它们：

```
<!--#include virtual="/ssi/<filename>.html" --> 
```

但仍然没有。有任何想法吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-13T19:28:50.597

是阿帕奇吗？也许甚至没有启用包含。

[http://httpd.apache.org/docs/2.2/howto/ssi.html](http://httpd.apache.org/docs/2.2/howto/ssi.html)

> 要在您的服务器上允许 SSI，您的 httpd.conf 文件或 .htaccess 文件中必须有以下指令：
> 
> `Options +Includes`

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-13T20:47:09.550

您是否在 Apache 服务器上启用了 SSI？

你应该在 conf/http.conf 中有这样的东西：

```
AddType text/html .shtml
AddOutputFilter INCLUDES .shtml 
```

这意味着 .shtml 文件被解析为 SSI 命令（不是 .html）文件。然后，您需要启用 if fr 您的虚拟主机或目录：

```
Options +Includes 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-13T19:23:43.260

可能是路径问题。你试过没有“ssi”前面的“/”吗？

# winapi - 在 Windows XP 64bit 下运行 Win32 IIS 应用程序

> ID：547313
> 
> 赞同：1
> 
> 时间：2009-02-13T19:21:25.230
> 
> 标签：winapi, iis, windows-xp, win64

如何在 Windows XP 64 位的 IIS 中运行 Windows 32 位应用程序？

注意：这不在 Visual Studio 中运行。注意：仅记录 404 错误。注意：IIS 禁用 CGI 脚本导致的 404 错误

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-13T19:34:28.897

试试这个： cscript.exe adsutil.vbs set W3SVC/AppPools/Enable32BitAppOnWin64 true

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-13T20:40:45.650

默认情况下，IIS 在默认应用程序池中运行您的应用程序。在 64 位 Windows 上，该应用程序池默认为 64 位。

您应该创建一个新的应用程序池，并配置 IIS 以在新的 32 位应用程序池中运行您的 32 位网站。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-03T04:32:58.077

您可能遇到了 Bitness 问题 - 在执行 Enable32BitAppOnWin64 脚本后，您需要注册 ASP.Net 过滤器的 32 位版本。转到 32 位版本的框架 (C:\Windows\Microsoft.NET\Framework\v2.0.50727) 并重新运行 aspnet_regiis.exe -i -enable 命令。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-13T20:18:14.143

如果在将 IIS 设置为在 32 位模式下运行（JohnW 的回答）后您的应用程序仍然没有运行，您需要跟踪错误。检查 windows 事件日志（应用程序和系统）并检查 C:\WINDOWS\system32\Logfiles\HTTPERR 文件夹中的 HTTPERR 日志文件（在 win64 上可能是不同的位置）。IIS 非常擅长记录问题。

# pdf - 使用 ImageMagick 或 Ghostscript（或其他东西）缩放 PDF 以适应页面？

> ID：547326
> 
> 赞同：13
> 
> 时间：2009-02-13T19:24:37.533
> 
> 标签：pdf, resize, imagemagick, ghostscript

我一直在努力反对这一点，但无济于事。

我需要缩小一些大型 PDF 以在 8.5x11 英寸（标准字母）页面上打印。ImageMagick/Ghostscript 可以处理这种事情，还是因为我使用了错误的工具来完成这项工作，所以我遇到了很多麻烦？

仅仅依靠客户端打印对话框中的“缩小到页面”选项不是一个选项，因为我们希望它易于最终用户使用。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2010-08-09T19:08:11.437

我不会使用`convert`. 它在后台使用 Ghostscript，但速度要慢得多。我会直接使用 Ghostscript，因为它给了我更直接的控制（以及一些更难以实现的设置的控制`convert`）。对于转换为 PDF 到 PDF 转换的工作，无论如何您都将安装 Ghostscript：

```
 gs \
    -o /path/to/resized.pdf \
    -sDEVICE=pdfwrite \
    -dPDFFitPage \
    -r300x300 \
    -g2550x3300 \
    /path/to/original.pdf 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-02-13T19:57:58.920

ImageMagick 的 mogrify/convert 命令确实可以完成这项工作。Stephen Page 的想法几乎是正确的，但您还需要设置文件的 dpi，否则您将无法完成工作。

假设您有一个 300 dpi 的文件，并且纵横比已经与 8.5 x 11 相同，那么命令将是：

```
// 300dpi x 8.5 -2550, 300dpi x 11 -3300
convert original.pdf -density "300" -resize "2550x3300" resized.pdf 
```

如果纵横比不同，则需要进行一些稍微复杂的裁剪。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-02-16T14:15:28.130

使用 ImageMagick 的问题是您正在转换为光栅图像格式，增加了文件大小并降低了页面上任何矢量元素的质量。

[Multivalent](https://rg.to/file/c6bd7f31bf8885bcaa69b50ffab7e355/Multivalent20060102.jar.html)将保留 PDF 的矢量信息。尝试：

```
java -cp Multivalent.jar tool.pdf.Impose -dim 1x1 -paper "8.5x11in" myFile.pdf 
```

创建输出文件 myFile-up.pdf

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2011-04-17T01:23:49.437

Ghostscript 方法对我来说效果很好。（我将文件从我的 Windows PC 移动到 Linux 计算机并在那里运行。）我对 Ghostscript 命令做了一个小改动，因为上面的 Ghostscript resize 命令完全填满了 8.5 x 11 英寸的页面。但是，我的打印机无法打印到边缘，因此沿每个页面边缘丢失了几毫米。为了克服这个问题，我将我的 PDF 文档缩放为 8.5 x 11 英寸的 0.92。这样，我看到所有内容都以页面为中心并且有一点边距。因为 0.92 * (2550x3300) = (2346x3036)，所以我运行了以下 Ghostscript 命令：

```
 gs -sDEVICE=pdfwrite \
     -dPDFFitPage \
     -r300x300 \
     -g2346x3036 \
     /home/user/path/original.pdf \
     -o /home/user/path/resized.pdf 
```

# c# - 如何让 TinyMCE 在 UpdatePanel 中工作？

> ID：547327
> 
> 赞同：14
> 
> 时间：2009-02-13T19:24:57.127
> 
> 标签：c#, asp.net, javascript, updatepanel, tinymce

我正在尝试做很多人似乎能够做到但我无法实施任何解决方案的事情。[TinyMCE](http://tinymce.moxiecode.com/)控件在asp.net 表单中运行良好，直到您使用 UpdatePanel 将其括起来，然后在回发后中断。我已经尝试了一些修复，比如 RegisterClientScriptBlock 方法，但仍然不成功，回发后我仍然失去了 tinyMCE 控制。

下面是一个完整的测试项目（VS 2008），在 UpdatePanel 外部提供一个控件，在内部提供一个控件，每个控件上都有一个用于生成回发的按钮。同样在项目中，我有一个 EditorTest 控件，其中包括我尝试过的一些调用的注释代码，以防它给任何人任何想法。

[代码示例](http://www.mediafire.com/?eiwmtogykzm)

以下是 MCE 论坛上一些解决方案的一些来源：
[AJAX](http://tinymce.moxiecode.com/punbb/viewtopic.php?id=4673&p=1)
[UpdatePanel](http://tinymce.moxiecode.com/punbb/viewtopic.php?pid=48752#p48752)

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2010-08-13T15:03:27.543

要执行`init`每次`UpdatePanel`您需要使用以下方式注册脚本的更改`ScriptManager`：

```
// control is your UpdatePanel
ScriptManager.RegisterStartupScript(control, control.GetType(), control.UniqueID, "your_tinymce_initfunc();", true); 
```

**注意：**你不能`exact`在你的 init 函数上使用 mode ，你可以使用`textareas`a 或 a `class selector`，否则它将无法正常工作。

您还必须使用

```
ScriptManager.RegisterOnSubmitStatement(this, this.GetType(), "", "tinyMCE.triggerSave();"); 
```

在 UpdatePanel 的回发中，编辑器内容不会保存在文本框中，因为默认行为仅适用于`form.submit`，因此当您提交任何内容时，它会在发布之前保存文本。

在后面的代码中，您只需要访问`TextBox.Text`属性即可获取值。

**注意：**如果您使用的是 .NET GZipped，您可能不得不放弃它，我无法让它工作，我必须完全删除它。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-01T01:25:01.593

好的，你的问题是双重的。Stefy 为您提供了部分答案，即您必须在回发时通过注册启动脚本来初始化 TinyMCE，如下所示：

```
using System.Web.UI;

namespace TinyMCEProblemDemo
{
    public partial class EditorClean : UserControl
    {
        protected void Page_Load(object sender, System.EventArgs e)
        {                
              ScriptManager.RegisterStartupScript(this.Page, 
                  this.Page.GetType(), mce.ClientID, "callInt" + mce.ClientID + "();", true);
        }
    }
} 
```

您遇到的第二个问题是自定义控件的实现。设计自定义控件超出了此答案的范围。谷歌可以帮助你。

您在页面上有多个控件实例，这可能会导致脚本出现问题，因为它会被多次呈现。这就是我修改您的标记以解决您的问题的方式（注意脚本函数的动态命名，自定义控件应该是自包含的，并且模式：tinyMCE.init 上的“精确”）：

```
<%@ Control Language="C#" AutoEventWireup="true" CodeBehind="EditorClean.ascx.cs"
    Inherits="TinyMCEProblemDemo.EditorClean" %>
<script type="text/javascript" src="Editor/tiny_mce.js"></script>

<script type="text/javascript">
    function myCustomCleanup<%= mce.ClientID%>(type, value) {
        if (type == "insert_to_editor") {
            value = value.replace(/&lt;/gi, "<");
            value = value.replace(/&gt;/gi, ">");
        }
        return value;
    }
    function myCustomSaveContent<%= mce.ClientID%>(element_id, html, body) {
        html = html.replace(/</gi, "&lt;");
        html = html.replace(/>/gi, "&gt;");
        return html;
    }

    function callInt<%= mce.ClientID%>() {

        tinyMCE.init({
            mode: "exact",
            elements: "<%= mce.ClientID%>",
            theme: "advanced",
            skin: "o2k7",
            plugins: "inlinepopups,paste,safari",
            theme_advanced_buttons1: "fontselect,fontsizeselect,|,forecolor,backcolor,|,bold,italic,underline,strikethrough,|,justifyleft,justifycenter,justifyright,justifyfull,|,bullist,numlist,|,outdent,indent,blockquote,|,cut,copy,paste,pastetext,pasteword",
            theme_advanced_buttons2: "",
            theme_advanced_buttons3: "",
            theme_advanced_toolbar_location: "top",
            theme_advanced_toolbar_align: "left",
            cleanup_callback: "myCustomCleanup<%= mce.ClientID%>",
            save_callback: "myCustomSaveContent<%= mce.ClientID%>"
        });
    }
</script>
<textarea runat="server" id="mce" name="editor" cols="50" rows="15">Enter your text here...</textarea> 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2016-01-03T17:01:24.380

此解决方案不再适用于 TinyMCE 4.2.3。您现在需要使用 tinymce.remove()，而不是使用 tinymce.mceRemoveControl()。这是一个完整的工作示例：

这页纸

```
 <%@ Page Title="" Language="C#" MasterPageFile="~/MasterPages/Frame.master" AutoEventWireup="true" CodeFile="FullImplementation.aspx.cs" 
  Inherits="TinyMCE" ValidateRequest="false" %>

<asp:Content ID="Content1" ContentPlaceHolderID="cphContent" Runat="Server">

  <asp:ScriptManager runat="server"/>

  <asp:UpdatePanel runat="server" id="upUpdatPanel">
    <ContentTemplate>

      <asp:TextBox runat="server" id="tbHtmlEditor" TextMode="MultiLine">
        Default editor text
      </asp:TextBox>

      <asp:Dropdownlist runat="server" ID="ddlTest" AutoPostBack="true" OnSelectedIndexChanged="ddlTest_SelectedIndexChanged">
        <Items>
           <asp:ListItem Text="A"></asp:ListItem>
           <asp:ListItem Text="B"></asp:ListItem>
        </Items>
      </asp:Dropdownlist>

      <asp:Button runat="server" ID="butSaveEditorContent" OnClick="butSaveEditorContent_Click" Text="Save Html Content"/>      

    </ContentTemplate>
  </asp:UpdatePanel>

  <script type="text/javascript">

      $(document).ready(function () {
        /* initial load of editor */
        LoadTinyMCE();
      });

      /* wire-up an event to re-add the editor */     
      Sys.WebForms.PageRequestManager.getInstance().add_endRequest(EndRequestHandler_Page);

      /* fire this event to remove the existing editor and re-initialize it*/
      function EndRequestHandler_Page(sender, args) {
        //1\. Remove the existing TinyMCE instance of TinyMCE
        tinymce.remove( "#<%=tbHtmlEditor.ClientID%>");
        //2\. Re-init the TinyMCE editor
        LoadTinyMCE();
      }

      function BeforePostback() {
        tinymce.triggerSave();
      }

      function LoadTinyMCE() {

        /* initialize the TinyMCE editor */
        tinymce.init({
          selector: "#<%=tbHtmlEditor.ClientID%>",
          plugins: "link, autolink",
          default_link_target: "_blank",
          toolbar: "undo redo | bold italic | link unlink | cut copy paste | bullist numlist",
          menubar: false,
          statusbar: false
        });
      }

  </script>

</asp:Content> 
```

代码隐藏：

```
 using System;
using System.Collections.Generic;
using System.Linq;
using System.Net;
using System.Web;
using System.Web.UI;
using System.Web.UI.WebControls;

public partial class TinyMCE : System.Web.UI.Page
{
  protected void Page_Load(object sender, EventArgs e)
  {
    // we have to tell the editor to re-save the date on Submit 
    if (!ScriptManager.GetCurrent(Page).IsInAsyncPostBack)
    {
      ScriptManager.RegisterOnSubmitStatement(this, this.GetType(), "SaveTextBoxBeforePostBack", "SaveTextBoxBeforePostBack()");
    }

  }

  protected void butSaveEditorContent_Click(object sender, EventArgs e)
  {
    string htmlEncoded = WebUtility.HtmlEncode(tbHtmlEditor.Text);

  }

  private void SaveToDb(string htmlEncoded)
  {
    /// save to database column
  }

  protected void ddlTest_SelectedIndexChanged(object sender, EventArgs e)
  {

  }
} 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2010-05-19T23:43:21.467

使 tinyMCE 在更新面板中工作的正确方法：

1）为“提交”按钮的 OnClientClick 创建一个处理程序。

2) 运行 tinyMCE.execCommand("mceRemoveControl", false, '<%= txtMCE.ClientID %>'); 在处理程序中，以便在回发之前删除 tinyMCE 实例。

3) 在您的异步回发中，使用 ScriptManager.RegisterStartupScript 运行 tinyMCE.execCommand("mceAddControl", true, '<%= txtMCE.ClientID %>');

基本上，您需要做的就是在异步回发之前使用 mceRemoveControl 命令并注册启动脚本以在异步回发之后运行 mceAddControl 命令。不算太硬。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-01-21T20:02:33.570

这是一个老问题，但经过数小时的搜索和寻找答案后，我觉得有义务发布我想出的解决方案。

看来，至少在我正在使用的实现中（UpdatePanel 中的多个编辑器），必须通知 tinyMCE 在 UpdatePanel 提交时控件将消失，否则它将拒绝再次加载它。

因此，除了 Init TinyMCE 的代码（只需要在整个页面加载时运行）之外，您还需要为每个 MCE 文本框执行此操作：

```
ScriptManager.RegisterStartupScript(this, this.GetType(), elm1.UniqueID+"Add",
    "tinyMCE.execCommand('mceAddControl', true,'" + elm1.ClientID + "');", true);
ScriptManager.RegisterOnSubmitStatement(this, this.GetType(), elm1.UniqueID + "Remove",
    "tinyMCE.execCommand('mceRemoveControl', true,'" + elm1.ClientID + "');"); 
```

elm1 就是 tinyMCE 元素。我的是一个驻留在 UserControl 中的 textarea，但您可以将它应用于您想要绑定/取消绑定您的 textarea 的任何项目。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-06-12T09:38:22.247

我做了以下事情：

首先，我将此 Javascript 添加到我的页面：

```
<script type="text/javascript">
Sys.WebForms.PageRequestManager.getInstance().add_endRequest(endRequestHandler);

function endRequestHandler(sender,args)
{
    tinyMCE.idCounter=0;
    tinyMCE.execCommand('mceAddControl',false,'htmlContent');
}

function UpdateTextArea()
{ 
    tinyMCE.triggerSave(false,true);
}
</script> 
```

因为我正在创建一个 ASP.NET 并在我的页面中使用 ASP.NET 按钮，所以我必须将以下内容添加到页面加载中：

```
protected void Page_Load(object sender, EventArgs e)
{
    Button1.Attributes.Add("onclick", "UpdateTextArea()");
} 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2015-12-13T21:41:57.503

为使用 .NET 框架 4 的用户更新此问题的答案，我通过插入以下内容成功地将 TinyMCE 附加到更新面板内的 TextBox：

**在 <head></head> 区域内的标记中：**

```
<script src="scripts/tinymce/tinymce.min.js" type="text/javascript"></script>
<script type="text/javascript">

    tinyMCE.init({
        selector: ".tinymcetextarea",
        mode: "textareas",

        plugins: [
             "advlist autolink link image lists charmap print preview hr anchor pagebreak spellchecker",
             "searchreplace visualblocks visualchars code fullscreen autoresize insertdatetime media nonbreaking",
             "save table contextmenu directionality emoticons template paste textcolor",
             "autosave codesample colorpicker image imagetools importcss layer"
        ],

        toolbar: "insertfile undo redo | styleselect | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link image | print preview media | forecolor backcolor emoticons",
        style_formats: [
             { title: 'Bold text', inline: 'b' },
             { title: 'Red text', inline: 'span', styles: { color: '#ff0000' } },
             { title: 'Red header', block: 'h1', styles: { color: '#ff0000' } },
             { title: 'Example 1', inline: 'span', classes: 'example1' },
             { title: 'Example 2', inline: 'span', classes: 'example2' },
             { title: 'Table styles' },
             { title: 'Table row 1', selector: 'tr', classes: 'tablerow1' }
        ]
    });

</script> 
```

**在 <body></body> 区域内的标记中：**

```
<asp:TextBox ID="tbContentHtml" CssClass="tinymcetextarea" Wrap="true" runat="server" Width="90%" TextMode="MultiLine" /> 
```

**最后在 Page_Load 事件的代码隐藏中：**

```
ScriptManager.RegisterStartupScript(this, this.GetType(), tbContentHtml.UniqueID + "Add", "tinyMCE.execCommand('mceAddEditor', true,'" + tbContentHtml.ClientID + "');", true);
ScriptManager.RegisterOnSubmitStatement(this, this.GetType(), tbContentHtml.UniqueID + "Remove", "tinyMCE.execCommand('mceRemoveEditor', true,'" + tbContentHtml.ClientID + "');"); 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-13T19:48:35.713

Not sure if you've looked at these.

[http://joakimk.blogspot.com/2007/07/tinymce-inside-of-aspnet-ajax.html](http://joakimk.blogspot.com/2007/07/tinymce-inside-of-aspnet-ajax.html)

and

[http://codeodyssey.com/archive/2007/7/18/updatepanel-tinymce-demo-with-project-zip-file](http://codeodyssey.com/archive/2007/7/18/updatepanel-tinymce-demo-with-project-zip-file)

Here is a tinymce forum post on it

[http://tinymce.moxiecode.com/punbb/viewtopic.php?id=12682](http://tinymce.moxiecode.com/punbb/viewtopic.php?id=12682)

Good luck.

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-04-27T13:02:00.483

每当刷新更新面板时，您都必须调用 TinyMCE 的初始化方法。

为此，您必须从 RegisterStartupScript 方法调用此方法 (tinyMCE.init)，或者在页面的 head 部分中创建页面加载 javascript 函数，如下所示：

```
function pageLoad() {
   tinyMCE.init();
} 
```

每次刷新更新面板时都会执行此功能。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2012-07-20T07:00:03.347

我在 ajax 调用的响应生成后解决了这个问题，因为调用 tiny mce

```
function edittemp(name) {

xmlhttp=GetXmlHttpObject();
if (xmlhttp==null)
{
alert ("Your browser does not support XMLHTTP!");
return;
}

var url="edit_temp.php";
url=url+"?id="+name;

xmlhttp.onreadystatechange=stateChanged3;
xmlhttp.open("GET",url,true);
xmlhttp.send(null); 

}
function stateChanged3()
{
if (xmlhttp.readyState==4)
{
spl_txt=xmlhttp.responseText.split("~~~");

document.getElementById("edit_message").innerHTML=spl_txt[0];   
tinyMCE.init({
theme : "advanced",
mode: "exact",
elements : "elm1",
theme_advanced_toolbar_location : "top",
theme_advanced_buttons1 : "bold,italic,underline,strikethrough,separator,"
+ "justifyleft,justifycenter,justifyright,justifyfull,formatselect,"
+ "bullist,numlist,outdent,indent",
theme_advanced_buttons2 : "link,unlink,anchor,image,separator,"
+"undo,redo,cleanup,code,separator,sub,sup,charmap",
theme_advanced_buttons3 : "",
height:"350px",
width:"600px"
});
}
} 
```

ajax调用的页面是

```
<?php
$name=$_GET['id'];
include 'connection.php';
$result=mysql_query("SELECT * FROM `templete` WHERE temp_name='$name' and status=1");

$row = mysql_fetch_array($result);
$Content=$row['body'];
?>
<html>
<head>
<title>editing using tiny_mce</title>
<script language="..." src="tinymce/jscripts/tiny_mce  /tiny_mce.js"></script>
</head>
<body>
<h2>change the template here</h2>
<form method="post" action="save_temp.php?name=<?php echo $name;?>">
<textarea id="elm1" name="elm1" rows="15" cols="80"><?php echo $Content;?></textarea>
<br />
<input type="submit" name="save" value="Submit" />
<input type="reset" name="reset" value="Reset" />
</form>
</body>
</html> 
```

在这种情况下可能会有所帮助。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2013-01-16T23:38:30.223

我做这个

```
<script language="javascript" type="text/javascript">
    function pageLoad(sender, args) { 
        aplicartinyMCE();     
    }
    function aplicartinyMCE() {
       tinyMCE.init({
           mode: "specific_textareas",
           editor_selector: "mceEditor",
           .....
       });
    }
</script> 
```

即使在每次异步回发后初始化编辑器

然后在 page_load 事件中

```
ScriptManager.RegisterOnSubmitStatement(this, this.GetType(), "salvarEditorMCE", "tinyMCE.triggerSave();"); 
```

* * *

## 回答 #12

> 赞同：-2
> 
> 时间：2009-02-16T14:01:15.153

TinyMCE（以及其他所见即所得编辑器、FCKEditor 等）存在回发验证问题。默认情况下，回发的任何 ASP.Net 页面都会检查其内容，并且任何未编码的 HTML 都会引发回发验证错误。

现在很多人，包括那些论坛上的人建议禁用回发验证， validaterequest="false" ，但这会使您容易受到脚本攻击，最好的办法是将函数绑定到异步回发事件，该事件在异步回发之前触发. 这个 JavaScript 函数需要对被回发到服务器的 TinyMCE 数据进行 HTML 编码，然后这将通过回发验证，你会没事的。

我相信 TinyMCE 和其他编辑器正确地在回发上执行此操作，但不是异步回发因此问题，事实上，如果您查看 TinyMCE 的源代码，您可能会找到执行此操作的函数并简单地添加事件绑定。

希望这可以帮助

# instant-messaging - 创建 IM 机器人

> ID：547335
> 
> 赞同：5
> 
> 时间：2009-02-13T19:28:19.397
> 
> 标签：instant-messaging, bots

我正在尝试创建一个 IM 机器人，但我无法找到必要的资源。

* * *

**更新**

Imified 存在一个问题，使 gtalk 机器人无法在线显示（并且没有响应），它现在可以正常工作，所以我要关闭它。

本[教程](http://www.labnol.org/internet/tutorial-create-bot-for-gtalk-yahoo-messenger/4354/)确实有效。

* * *

**原始问题未删除以供参考**

首先，我确实找到了一个关于[如何编写自己的 IM Bot](http://www.labnol.org/internet/tutorial-create-bot-for-gtalk-yahoo-messenger/4354/)的很棒的教程，但它使用的 IMified 平台看起来已经死了（2008 年 9 月的最后一篇博文，在他们的帮助论坛上没有任何反馈，...）。

我确实设法使用他们的服务创建了一个测试版机器人，但正如我在他们的帮助论坛中看到的那样，它永远不会在线。

那么，有人设法做到了吗？

**笔记**

我正在寻找的东西是：

*   自由
*   适用于 PHP* 或一些免费的托管解决方案（如 IMified 但有效）
*   适用于 Google Talk（我真的不在乎其他）

当然，请发布有关任何不符合这些标准的解决方案的答案，这可能会有所帮助。

*我在 GoDaddy 上有一个 Linux 托管计划

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-13T20:56:06.533

Google Talk 使用 jabber，其中的协议称为[XMPP](http://en.wikipedia.org/wiki/Xmpp)。一个快速的谷歌搜索“xmpp bot php”把我带到了[这里](http://code.google.com/p/xmpphp/)。这应该足够开始了吗？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-08-25T16:08:54.277

从教程中获取，以防它消失：

> **第 1 步**：访问[imified.com](http://imified.com/)并请求邀请。你还应该给你的机器人起一个像样的名字，因为每个电子邮件地址只能有一个机器人。
> 
> **第 2 步**：带有密钥的电子邮件应在下一分钟到达您的收件箱。将该密钥复制到剪贴板并前往此处兑换该密钥。
> 
> **第 3 步**：现在是时候创建一个机器人，它实际上是一个驻留在公共 Web 服务器上的简单脚本。它可以是 PHP、Perl、Python 或任何其他语言。更多在这里。
> 
> 这是我为 labnol IM bot 编写的 PHP 脚本的源代码 - 非常不言自明 - 它会读取您的消息，从 Google Suggest 获取相关数据并将其回显到 IM 窗口。
> 
> ```
> <?php   // Get all the related keywords from Google Suggest
>     $u = "http://google.com/complete/search?output=toolbar";   $u = $u . "&q=" . $_REQUEST['msg'];
> 
>     // Using the curl library since dreamhost doesn't allow fopen
>     $ch = curl_init();
>     curl_setopt($ch, CURLOPT_URL, $u);
>     curl_setopt($ch, CURLOPT_HEADER, 0);
>     curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);
> 
>     $xml = simplexml_load_string(curl_exec($ch));
>     curl_close($ch);
> 
>     // Parse the keywords and echo them out to the IM window
>     $result = $xml->xpath('//@data');
>     while (list($key, $value) = each($result))
>     {
>         echo $value ."<br>";
>     }
> ?> 
> ```
> 
> **第 4 步**：一旦您的脚本准备就绪，请将其放在您的 Web 服务器上的某个位置，并将完整的 URI 复制到剪贴板。
> 
> 现在登录到您的 imified 帐户，粘贴脚本 URL 并将该 im bot 添加到您的朋友列表中。就是这样。

# c# - NHibernate ICriteria 带包

> ID：547343
> 
> 赞同：0
> 
> 时间：2009-02-13T19:32:48.073
> 
> 标签：c#, nhibernate

只是一个快速的问题。如果我有 2 个表连接到具有多对多关系的第三个表中，是否可以在其中一个表和连接表中编写带有表达式的 ICriteria？

假设映射文件看起来像：

```
 <bag name ="Bag" table="JoinTable" cascade ="none">
      <key column="Data_ID"/>
      <many-to-many class="Data2" column="Data2_ID"/>
    </bag> 
```

那么是否可以编写如下所示的 ICriteria ？

```
 ICriteria crit = session.CreateCriteria(typeof(Data));
        crit.Add(Expression.Eq("Name", name));
        crit.Add(Expression.Between("Date", startDate, endDate));
        crit.Add(Expression.Eq("Bag", data2IDNumber)); 
```

当我尝试这个时，它告诉我预期的类型是 IList，而实际类型是 Bag。

谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-13T19:38:43.600

你应该这样做（我认为）

```
ICriteria crit = session.CreateCriteria (typeof(Data));
crit.Add (Expression.Eq ("Name", name));
crit.Add (Expression.Between ("Date", startDate, endDate));
crit.CreateAlias ("Bag", "b");
crit.Add (Expression.Eq ("b.Id", data2IDNumber)); 
```

# php - PHP - Eclipse PDT - 突出显示未初始化（拼写错误）的变量

> ID：547345
> 
> 赞同：2
> 
> 时间：2009-02-13T19:33:02.973
> 
> 标签：php, eclipse, eclipse-pdt

我使用美妙的 Eclipse PDT 进行 PHP 开发。

由于我拼写错误的变量名，我经常遇到恼人的错误。

有没有办法突出显示尚未初始化的变量？因为它们几乎肯定是由于拼写错误。

谢谢你的帮助。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-13T19:36:44.353

不。由于 PHP 的动态性，有时是骇人听闻的性质，将 IDE 认为未声明的变量加下划线总体上会很痛苦。由于许多函数可以自己声明变量（例如[extract](http://www.php.net/manual/en/function.extract.php)），这将是一个主要障碍。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-15T17:56:56.197

zend studio 有这个功能，所以我不确定我们是否会在 pdt 中看到它，它还会突出显示无法访问的代码等。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-13T19:51:15.753

带有 PHPParser 插件的 JEdit 就是这样，IIRC。我已经很久没有尝试过了，不过，我可能错了。

# c# - 使用 C# 进行远程 HTTP 发布

> ID：547347
> 
> 赞同：4
> 
> 时间：2009-02-13T19:33:12.567
> 
> 标签：c#, webrequest

如何在 C# 中执行远程 HTTP 发布（请求）？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-02-13T20:22:27.237

This is code from a small app I wrote once to post a form with values to a URL. It should be pretty robust.

_formValues is a Dictionary<string,string> containing the variables to post and their values.

```
 // encode form data
StringBuilder postString = new StringBuilder();
bool first=true;
foreach (KeyValuePair pair in _formValues)
{
    if(first)
        first=false;
    else
        postString.Append("&");
    postString.AppendFormat("{0}={1}", pair.Key, System.Web.HttpUtility.UrlEncode(pair.Value));
}
ASCIIEncoding ascii = new ASCIIEncoding();
byte[] postBytes = ascii.GetBytes(postString.ToString());

// set up request object
HttpWebRequest request;
try
{
    request = WebRequest.Create(url) as HttpWebRequest;
}
catch (UriFormatException)
{
    request = null;
}
if (request == null)
    throw new ApplicationException("Invalid URL: " + url);
request.Method = "POST";
request.ContentType = "application/x-www-form-urlencoded";
request.ContentLength = postBytes.Length;

// add post data to request
Stream postStream = request.GetRequestStream();
postStream.Write(postBytes, 0, postBytes.Length);
postStream.Close();

HttpWebResponse response = request.GetResponse() as HttpWebResponse; 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-13T19:37:41.260

您可以使用 WCF 或创建 WebRequest

```
var httpRequest = (HttpWebRequest)WebRequest.Create("http://localhost/service.svc");
var httpRequest.Method = "POST";

using (var outputStream = httpRequest.GetRequestStream())
{
    // some complicated logic to create the message
}

var response = httpRequest.GetResponse();
using (var stream = response.GetResponseStream())
{
    // some complicated logic to handle the response message.
} 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-13T19:37:54.007

我使用[这个](http://www.jigar.net/articles/viewhtmlcontent78.aspx)非常简单的类：

```
 public class   RemotePost{
     private  System.Collections.Specialized.NameValueCollection Inputs 
     = new  System.Collections.Specialized.NameValueCollection() ;

    public string  Url  =  "" ;
    public string  Method  =  "post" ;
    public string  FormName  =  "form1" ;

    public void  Add( string  name, string value ){
        Inputs.Add(name, value ) ;
     }

     public void  Post(){
        System.Web.HttpContext.Current.Response.Clear() ;

         System.Web.HttpContext.Current.Response.Write( "<html><head>" ) ;

         System.Web.HttpContext.Current.Response.Write( string .Format( "</head><body onload=\"document.{0}.submit()\">" ,FormName)) ;

         System.Web.HttpContext.Current.Response.Write( string .Format( "<form name=\"{0}\" method=\"{1}\" action=\"{2}\" >" ,

        FormName,Method,Url)) ;
            for ( int  i = 0 ; i< Inputs.Keys.Count ; i++){
            System.Web.HttpContext.Current.Response.Write( string .Format( "<input name=\"{0}\" type=\"hidden\" value=\"{1}\">" ,Inputs.Keys[i],Inputs[Inputs.Keys[i]])) ;
         }
        System.Web.HttpContext.Current.Response.Write( "</form>" ) ;
         System.Web.HttpContext.Current.Response.Write( "</body></html>" ) ;
         System.Web.HttpContext.Current.Response.End() ;
     }
} 
```

你就这样使用它：

```
RemotePost myremotepost   =  new   RemotePost()  ;
myremotepost.Url  =  "http://www.jigar.net/demo/HttpRequestDemoServer.aspx" ;
myremotepost.Add( "field1" , "Huckleberry" ) ;
myremotepost.Add( "field2" , "Finn" ) ;
myremotepost.Post() ; 
```

非常干净，易于使用，并封装了所有的渣土。我更喜欢直接使用 HttpWebRequest 等等。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-13T19:39:22.893

使用[`WebRequest.Create()`](http://msdn.microsoft.com/en-us/library/system.net.webrequest.create.aspx)并设置[`Method`](http://msdn.microsoft.com/en-us/library/system.net.httpwebrequest.method.aspx)属性。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-13T19:43:07.893

还`System.Net.WebClient`

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-26T12:10:14.337

我使用以下代码使用 httpwebrequest 类调用 web 服务：

```
internal static string CallWebServiceDetail(string url, string soapbody, 
int timeout) {
    return CallWebServiceDetail(url, soapbody, null, null, null, null, 
null, timeout);
}
internal static string CallWebServiceDetail(string url, string soapbody, 
string proxy, string contenttype, string method, string action, 
string accept, int timeoutMilisecs) {
    var req = (HttpWebRequest) WebRequest.Create(url);
    if (action != null) {
        req.Headers.Add("SOAPAction", action);
    }
    req.ContentType = contenttype ?? "text/xml;charset=\"utf-8\"";
    req.Accept = accept ?? "text/xml";
    req.Method = method ?? "POST";
    req.Timeout = timeoutMilisecs;
    if (proxy != null) {
        req.Proxy = new WebProxy(proxy, true);
    }

    using(var stm = req.GetRequestStream()) {
        XmlDocument doc = new XmlDocument();
        doc.LoadXml(soapbody);
        doc.Save(stm);
    }
    using(var resp = req.GetResponse()) {
        using(var responseStream = resp.GetResponseStream()) {
            using(var reader = new StreamReader(responseStream)) {
                return reader.ReadToEnd();
            }
        }
    }
} 
```

这可以很容易地用于调用 web 服务

```
public void TestWebCall() {
    const string url = 
"http://www.ecubicle.net/whois_service.asmx/HelloWorld";
    const string soap = 
@"<soap:Envelope xmlns:soap='about:envelope'>
    <soap:Body><HelloWorld /></soap:Body>
</soap:Envelope>";
    string responseDoc = CallWebServiceDetail(url, soap, 1000);
    XmlDocument doc = new XmlDocument();
    doc.LoadXml(responseDoc);
    string response = doc.DocumentElement.InnerText;
} 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-13T19:42:41.547

```
HttpWebRequest HttpWReq = 
(HttpWebRequest)WebRequest.Create("http://www.google.com");

HttpWebResponse HttpWResp = (HttpWebResponse)HttpWReq.GetResponse();
Console.WriteLine(HttpWResp.StatusCode);
HttpWResp.Close(); 
```

如果请求成功，应该打印“OK”（200）

* * *

## 回答 #8

> 赞同：-3
> 
> 时间：2009-08-16T21:11:49.733

从 C#、Java 或 PHP 等高级语言开始的问题是，人们可能永远不知道地下在现实中是多么简单。所以这里有一个简短的介绍：

[http://reboltutorial.com/blog/raw-http-request/](http://reboltutorial.com/blog/raw-http-request/)

# xul - 如何最好地部署我的 XUL 应用程序？

> ID：547349
> 
> 赞同：4
> 
> 时间：2009-02-13T19:34:03.750
> 
> 标签：xul, deployment, xulrunner

我有一个我认为有用的 xul 应用程序，我想部署它。目标平台是Linux；我相信它也可以在 Windows/OSX 上运行，但尚未测试。部署此应用程序的最佳方式是什么？

*   是否使用 xpi 包并要求用户单独安装 xulrunner？
*   如果我捆绑 xulrunner，我应该将它保存在我的程序目录中还是应该将它安装在 /usr/bin 或其他任何地方？

我意识到这是两个问题，但我认为它们是相关的......

谢谢，内森

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-13T20:07:32.907

我在 Windows 上从 1.8 到 1.9 转换期间部署了一个基于 XULRunner 的应用程序。它使用 XUL，并有一些基于 DLL 的 XPCOM 组件。确保您拥有“开箱即用”的东西的最佳方法是将所有内容（运行时和应用程序）捆绑到一个安装中。可能会有一些重复，但考虑到已经在他们的机器上安装了 XULRunner 的人数，可能不值得将其整理出来。它当然不适合我们（我们是 BOWMAN 套件上的第一个 XULRunner 应用程序）。但是，如果您愿意，您也可以提供 xpi 作为对高级用户的礼遇。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-13T22:10:46.197

捆绑它——这是 Mozilla 推荐的方法（目前）——你可以让它更加用户友好。

也许有一天会与 Firefox 的 xulrunner 可执行文件有很好的联系，您可以使用它。但那一天不是今天。

# css - 在 YUI 网格中保持块对齐

> ID：547359
> 
> 赞同：0
> 
> 时间：2009-02-13T19:35:50.877
> 
> 标签：css, yui-grids

当我有一个在`yui-main`块中几乎没有内容的网格布局时，一些侧边栏块（在我的情况下是外部的`yui-main`）会跳到主块下方。

这是此问题[的示例页面](http://www.uvshock.co.uk/yui.html)（如果文件不再存在，则为[pastebin'd 源）。](http://pastry.se/10109/)

### 例子

这个工作正常，因为里面的内容`#yui-main`比外面的内容长：

```
<div id="bd">
    <div id="yui-main">
        <div class="yui-b">
            <h2>Lorem Ipsum</h2>
            <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Donec quis libero vitae tellus rhoncus malesuada. Ut tempor ipsum vel orci. Maecenas nec nibh. Aenean sed nisi. In hac habitasse platea dictumst. Etiam augue. Curabitur et felis non tortor commodo porta. Vivamus bibendum viverra tellus. Aliquam erat volutpat. Vestibulum in turpis. Duis bibendum nunc ac lectus. Mauris mi. Mauris neque.</p>
        </div>
        <div class="yui-b">
            <h2>Lorem Ipsum</h2>
            <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Donec quis libero vitae tellus rhoncus malesuada. Ut tempor ipsum vel orci. Maecenas nec nibh. Aenean sed nisi. In hac habitasse platea dictumst. Etiam augue. Curabitur et felis non tortor commodo porta. Vivamus bibendum viverra tellus. Aliquam erat volutpat. Vestibulum in turpis. Duis bibendum nunc ac lectus. Mauris mi. Mauris neque.</p>
        </div>
    </div>

    <div class="yui-b">
        <h2>Delors sit amet</h2>
        <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Donec quis libero vitae tellus rhoncus malesuada. Ut tempor ipsum vel orci. Maecenas nec nibh. Aenean sed nisi. In hac habitasse platea dictumst. Etiam augue. Curabitur et felis non tortor commodo porta. Vivamus bibendum viverra tellus. Aliquam erat volutpat. Vestibulum in turpis. Duis bibendum nunc ac lectus. Mauris mi. Mauris neque. </p>
    </div>
</div> 
```

然而这个没有，因为外面的`yui-main`内容比里面的内容长。因此它在下面溢出`yui-main`。

```
<div id="bd">
    <div id="yui-main">
        <div class="yui-b">
            <h2>Lorem Ipsum</h2>
            <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Donec quis libero vitae tellus rhoncus malesuada. Ut tempor ipsum vel orci. Maecenas nec nibh. Aenean sed nisi. In hac habitasse platea dictumst. Etiam augue. Curabitur et felis non tortor commodo porta. Vivamus bibendum viverra tellus. Aliquam erat volutpat. Vestibulum in turpis. Duis bibendum nunc ac lectus. Mauris mi. Mauris neque.</p>
        </div>
    </div>

    <div class="yui-b">
        <h2>Delors sit amet</h2>
        <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Donec quis libero vitae tellus rhoncus malesuada. Ut tempor ipsum vel orci. Maecenas nec nibh. Aenean sed nisi. In hac habitasse platea dictumst. Etiam augue. Curabitur et felis non tortor commodo porta. Vivamus bibendum viverra tellus. Aliquam erat volutpat. Vestibulum in turpis. Duis bibendum nunc ac lectus. Mauris mi. Mauris neque. </p>
    </div>

    <div class="yui-b">
        <h2>Delors sit amet</h2>
        <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Donec quis libero vitae tellus rhoncus malesuada. Ut tempor ipsum vel orci. Maecenas nec nibh. Aenean sed nisi. In hac habitasse platea dictumst. Etiam augue. Curabitur et felis non tortor commodo porta. Vivamus bibendum viverra tellus. Aliquam erat volutpat. Vestibulum in turpis. Duis bibendum nunc ac lectus. Mauris mi. Mauris neque. </p>
    </div>
</div> 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-17T09:05:05.667

div 是浮动的`yui-b`，但尚未清除。这实质上意味着没有什么可以告诉他们哪些元素要浮动*在下面*，让它们如图所示垂直堆叠。

`clear:both`在第二个`yui-b`div上设置可以解决此问题。

# c# - 业务流程软件

> ID：547362
> 
> 赞同：0
> 
> 时间：2009-02-13T19:36:50.717
> 
> 标签：c#, sql, process

这里有什么推荐吗？我需要一些可以采用一组流程并将它们批处理在一起的东西。例如，我需要：

1）执行一些sql

2) 运行 C# 片段

3) 具有人工交互的检查点步骤（即在步骤 X 发送电子邮件并等待用户查看结果并单击继续等...）

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-13T19:38:12.663

如果您使用的是 C#，则不妨使用 3.5 中的 Windows Workflow Framework。这几乎就是它的用途。

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2009-02-13T19:38:37.017

为此，我使用 Captaris Workflow。相当昂贵，但效果非常好。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-02-13T19:53:01.990

取决于您愿意编码多少与您愿意支付多少。您*可以*“免费”使用“普通”.NET 代码对其进行编码。下一步将使用 Windows Workflow，尽管您仍然需要编写“人工交互”步骤。稍微贵一点的是像 FinalBuilder 或 Automiser 这样的工具，这意味着你要编写的代码更少，而且工作流设计器的可视化程度更高。更昂贵的——但可能没有代码——将是像 BizTalk、MetaStorm、K2 等这样的企业系统。

# java - Java 库检查器？

> ID：547380
> 
> 赞同：2
> 
> 时间：2009-02-13T19:42:15.807
> 
> 标签：java

我目前正在开发一个用 Java 编写的维护项目。我们目前正在努力清理一些代码，并尝试为整个项目提供更多的组织。

构建中包含的库列表已经很长了，老实说，没有人知道/记住每个库的用途或原因？因此，我正在寻找一种能够从本质上找到代码中使用库的位置的工具。本质上就像 IDE 中的 find 使用函数一样。

这样的工具存在吗？我目前正在使用 Netbeans，如前所述，我们的代码是用 java 编写的。

我知道我可以删除每个库并为每个库编译项目以查找用法，但似乎应该有更好的方法。有任何想法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-13T19:47:00.460

由于您使用的是 NetBeans，我建议您使用[SQE](https://sqe.dev.java.net/)插件，其中包括[Dependency Finder](http://depfind.sourceforge.net/)。（如果您还没有使用 FindBugs，那么现在是开始的好时机。）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-13T19:47:37.993

尝试使用[jarjar](http://code.google.com/p/jarjar/)。它有一个命令行界面，可以分析你的依赖树。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-13T19:47:44.060

我已经有几年没有使用它了，但我记得[JDepend](http://www.clarkware.com/software/JDepend.html)在我遇到类似情况时很有用。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-13T19:48:10.847

您可以让 Eclipse 为您删除不必要的导入。然后只需在代码中搜索与特定库的包名称相关的导入。

# javascript - 你从哪里包含 jQuery 库？谷歌 JSAPI？CDN？

> ID：547384
> 
> 赞同：242
> 
> 时间：2009-02-13T19:43:31.030
> 
> 标签：javascript, jquery, ssl, google-ajax-libraries

有几种方法可以包含 jQuery 和 jQuery UI，我想知道人们在使用什么？

*   谷歌 JSAPI
*   jQuery的网站
*   您自己的站点/服务器
*   另一个 CDN

我最近一直在使用 Google JSAPI，但发现设置 SSL 连接甚至只解析 google.com 都需要很长时间。我一直在为 Google 使用以下内容：

```
<script src="https://www.google.com/jsapi"></script>
<script>
google.load('jquery', '1.3.1');
</script> 
```

我喜欢使用 Google 的想法，因此它在访问其他网站时会被缓存并节省我们服务器的带宽，但如果它一直是网站的慢速部分，我可能会更改包含。

你用什么？你有什么问题吗？

**编辑：**刚刚访问了 jQuery 的网站，他们使用以下方法：

```
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3/jquery.min.js"></script> 
```

**Edit2：**以下是我去年如何毫无问题地包含 jQuery：

```
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.4.3/jquery.min.js"></script> 
```

不同之处在于删除`http:`. 通过删除它，您无需担心在 http 和 https 之间切换。

* * *

## 回答 #1

> 赞同：153
> 
> 时间：2009-02-13T20:12:30.553

毫无疑问，我选择让 Google API 服务器为 JQuery 提供服务。我没有使用 jsapi 方法，因为我没有利用任何其他 Google API，但是如果改变了，那么我会考虑它......

**第一：** Google api 服务器分布在世界各地，而不是我的单一服务器位置：更接近的服务器通常意味着更快的访问者响应时间。

**第二：**许多人选择将 JQuery 托管在 Google 上，因此当访问者访问我的站点时，他们可能已经在本地缓存中拥有 JQuery 脚本。预缓存的内容通常意味着访问者的加载时间更快。

**第三：**我的网络托管公司向我收取使用的带宽费用。如果访问者可以在其他地方获得相同的文件，那么每个用户会话消耗 18k 是没有意义的。

我了解我对 Google 提供了部分信任，以提供正确的脚本文件，并且可以在线和可用。到目前为止，我对使用 Google 并没有感到失望，并且会继续这种配置，直到可以不这样做为止。

**值得指出的一件事...**如果您的网站上混合了安全和不安全页面，您可能需要动态更改 Google 源以避免在安全页面中加载不安全内容时看到的常见警告：

这是我想出的：

```
<script type="text/javascript">
    document.write([
        "\<script src='",
        ("https:" == document.location.protocol) ? "https://" : "http://",
        "ajax.googleapis.com/ajax/libs/jquery/1.2.6/jquery.min.js' type='text/javascript'>\<\/script>" 
    ].join(''));
</script> 
```

**更新 9/8/2010** - 提出了一些建议，通过删除 HTTP 和 HTTPS 并简单地使用以下语法来降低代码的复杂性：

```
<script type="text/javascript">
    document.write("\<script src='//ajax.googleapis.com/ajax/libs/jquery/1.2.6/jquery.min.js' type='text/javascript'>\<\/script>");
</script> 
```

此外，如果您想确保加载了最新的主要版本的 jQuery 库，您还可以更改 url 以反映 jQuery 主要编号：

```
<script type="text/javascript">
    document.write("\<script src='//ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js' type='text/javascript'>\<\/script>");
</script> 
```

最后，如果您不想使用 Google 并且更喜欢 jQuery，您可以使用以下源路径（请记住，jQuery 不支持 SSL 连接）：

```
<script type="text/javascript">
    document.write("\<script src='http://code.jquery.com/jquery-latest.min.js' type='text/javascript'>\<\/script>");
</script> 
```

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2009-02-13T19:58:21.803

您可能希望在外部服务器上托管的一个原因是要解决与特定服务器的并发连接的浏览器限制。

然而，鉴于您使用的 jQuery 文件可能不会经常更改，浏览器缓存将启动并在大多数情况下使这一点变得毫无意义。

将其托管在外部服务器上的第二个原因是降低到您自己服务器的流量。

然而，鉴于 jQuery 的大小，它很可能只是您流量的一小部分。您可能应该尝试优化您的实际内容。

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2009-02-13T19:47:42.437

jQuery 1.3.1 min 的大小只有 18k。我不认为在初始页面加载时问这个问题太大了。之后会被缓存。结果，我自己主持。

* * *

## 回答 #4

> 赞同：14
> 
> 时间：2009-02-13T19:57:46.393

如果您想使用 Google，直接链接可能会更灵敏。每个库都列出了直接文件的路径。这是 jQuery 路径

```
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.1/jquery.min.js"></script> 
```

只需重新阅读您的问题，您使用 https 是否有原因？这是谷歌在他们的例子中列出的脚本标签

```
<script src="http://www.google.com/jsapi"></script> 
```

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2009-02-13T23:07:43.033

我不希望我开发的任何公共站点依赖于任何外部站点，因此，我会自己托管 jQuery。

当另一个（Google、jquery.com 等）出现故障时，您是否愿意在您的站点上中断？减少依赖是关键。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2009-02-13T20:36:23.210

优点：Host on Google 有好处

*   可能更快（他们的服务器更优化）
*   他们正确处理缓存 - 1 年（我们很难被允许进行更改以在我们的服务器上正确获取标头）
*   已经拥有指向另一个域上的 Google 托管版本的链接的用户已经在其缓存中拥有该文件

缺点：

*   一些浏览器可能会将其视为 XSS 跨域并禁止该文件。
*   特别是为 Firefox 运行 NoScript 插件的用户

我想知道您是否可以从 Google 中包含，然后检查是否存在一些全局变量或类似的变量，以及是否从您的服务器加载？

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2009-02-13T22:10:39.193

这里有几个问题。首先，您指定的异步加载方法：

```
<script type="text/javascript" src="https://www.google.com/jsapi"></script>
<script type="text/javascript">
  google.load('jquery', '1.3.1');
  google.setOnLoadCallback(function() {
    // do stuff
  });
</script> 
```

有几个问题。脚本标签在检索时暂停页面加载（如有必要）。现在，如果他们加载缓慢，这很糟糕，但 jQuery 很小。上述方法的真正问题在于，由于 jquery.js 加载对于许多页面都是独立发生的，它们将在 jquery 加载之前完成加载和渲染，因此您所做的任何 jquery 样式**对用户来说都是可见的变化**。

另一种方式是：

```
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.1/jquery.min.js"></script> 
```

尝试一些简单的示例，例如，有一个简单的表格并使用 setOnLoadCallback() 方法将单元格的背景更改为黄色，而 $(document).ready() 使用静态 jquery.min.js 加载。第二种方法不会有明显的闪烁。第一个意志。我个人认为这不是一个好的用户体验。

作为一个例子运行这个：

```
<html>
<head>
  <title>Layout</title>
  <style type="text/css">
    .odd { background-color: yellow; }
  </style>
</head>
<body>
<table>
  <tr><th>One</th><th>Two</th></tr>
  <tr><td>Three</td><td>Four</td></tr>
  <tr><td>Five</td><td>Six</td></tr>
  <tr><td>Seven</td><td>Nine</td></tr>
  <tr><td>Nine</td><td>Ten</td></tr>
</table> 
<script src="http://www.google.com/jsapi"></script>
<script>
  google.load("jquery", "1.3.1");
  google.setOnLoadCallback(function() {
    $(function() {
      $("tr:odd").addClass("odd");
    });
  });
</script>
</body>
</html> 
```

您（应该）看到表格出现，然后行变为黄色。

google.load() 方法的第二个问题是它只托管有限范围的文件。这是 jquery 的一个问题，因为它非常依赖插件。如果您尝试包含一个带有`<script src="...">`标签的 jquery 插件，那么`google.load()`该插件可能会失败，并显示“jQuery 未定义”的消息，因为它尚未加载。我真的没有办法解决这个问题。

第三个问题（任何一种方法）是它们是一个外部负载。假设您有一些插件和您自己的 Javascript 代码，您至少需要两个外部请求来加载您的 Javascript。您最好获取 jquery、所有相关插件和您自己的代码并将其放入一个缩小文件中。

你[应该使用 Google 的 Ajax 库 API 进行托管吗？](http://cxliv.org/2008/05/27/should_you_use_googles_ajax_libraries_api_for_hosting.php)：

> 至于加载时间，您实际上是在加载两个脚本 - jsapi 脚本和 mootools 脚本（上面的压缩版本）。所以这是两个连接，而不是一个。根据我的经验，我发现加载时间实际上比从我自己的个人共享服务器加载慢 2-3 倍，即使它来自 Google，而且我的压缩文件版本比 Google 的大几 K。即使在文件已加载并（可能）缓存之后也是如此。所以对我来说，由于带宽并不重要，所以没关系。

最后，您可能会遇到偏执浏览器将请求标记为某种 XSS 尝试的潜在问题。这通常不是默认设置的问题，但在公司网络上，用户可能无法控制他们使用的浏览器，更不用说您可能遇到的安全设置问题。

所以最后我真的看不到我使用谷歌 AJAX API 至少（更“完整”的 API 在某些方面是不同的故事），除了在这里发布示例。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2009-02-13T20:22:44.960

除了建议将其托管在自己的服务器上的人之外，我还建议将其保留在单独的域（例如 static.website.com）上，以允许浏览器将其加载到与其他内容线程分开的位置。这个技巧也适用于所有静态的东西，比如图像和 css。

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2009-02-13T20:30:48.420

我必须为 Google 上托管的库投票 -1。他们正在收集数据，采用谷歌分析风格，以及围绕这些库的包装器。至少，我不希望客户端浏览器做的比我要求它做的更多，更不用说页面上的其他任何事情了。更糟糕的是，这是谷歌不作恶的“新版本”——使用不显眼的 javascript 来收集更多的使用数据。

注意：如果他们改变了这种做法，超级棒。但是上次我考虑使用他们的托管库时，我监控了我网站上的出站 http 流量，并且定期调用谷歌服务器并不是我期望看到的。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2009-02-13T19:47:58.397

我可能对此有点老派，但我仍然不赞成盗链。也许 Google 是个例外，但总的来说，将文件托管在您自己的服务器上确实是一种很好的方式。

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2015-06-26T19:44:49.230

我将添加此作为在本地托管这些文件的原因。

最近，TWC 上南加州的一个节点无法解析 ajax.googleapis.com 域（适用于使用 IPv4 的用户），因此我们无法获取外部文件。直到昨天，这一直是间歇性的（现在是持续性的。）因为它是间歇性的，所以我在解决 SaaS 用户问题时遇到了很多问题。花了无数个小时试图追踪为什么一些用户对软件没有问题，而另一些用户却在失败。在我通常的调试过程中，我没有询问用户是否关闭 IPv6 的习惯。

我偶然发现了这个问题，因为我自己正在使用这个特定的“路由”到文件并且也只使用 IPV4。我发现了开发人员工具的问题，告诉我 jquery 没有加载，然后开始进行跟踪路由等......以找到真正的问题。

在此之后，我很可能永远不会回到外部托管的文件，因为：谷歌不必为此成为问题而关闭，并且......这些节点中的任何一个都可能受到 DNS 劫持并传递恶意 js而不是实际的文件。一直认为我是安全的，因为谷歌域永远不会关闭，现在我知道用户和主机之间的任何节点都可能成为故障点。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2009-02-13T19:47:45.370

我只包含来自 jQuery 站点的最新版本：http: [//code.jquery.com/jquery-latest.pack.js](http://code.jquery.com/jquery-latest.pack.js) 它适合我的需要，我永远不必担心更新。

编辑：对于一个主要的网络应用程序，当然要控制它；下载并自己提供。但对于我的个人网站，我不在乎。事物不会神奇地消失，它们通常首先被弃用。我跟上它足以知道将来版本要更改的内容。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2011-03-29T11:54:56.313

这里有一些有用的资源，希望可以帮助您选择您的 CDN。MS 最近通过其 CDN 添加了一个用于交付库的新域。

旧格式：[http](http://ajax.microsoft.com/ajax/jQuery/jquery-1.5.1.js) ://ajax.microsoft.com/ajax/jQuery/jquery-1.5.1.js 新格式：[http ://ajax.aspnetcdn.com/ajax/jQuery/jquery-1.5.1.js](http://ajax.aspnetcdn.com/ajax/jQuery/jquery-1.5.1.js)

这不应发送 microsoft.com 的所有 cookie。 [http://www.asp.net/ajaxlibrary/cdn.ashx#Using_jQuery_from_the_CDN_11](http://www.asp.net/ajaxlibrary/cdn.ashx#Using_jQuery_from_the_CDN_11)

这里有一些关于所有技术在网络上使用的最流行技术的统计数据。 [http://trends.builtwith.com/](http://trends.builtwith.com/)

希望能帮助您选择。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2009-02-13T21:50:59.460

如果我负责“实时”站点，我最好了解正在发生的一切以及**进入**我的站点的所有内容。出于这个原因，我自己在同一台服务器或静态/外部服务器上托管 jquery-min 版本，但无论哪种方式，只有我（或我的程序/代理）可以在验证/测试每个更改后更新库的位置

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2010-02-16T12:28:39.243

在头部：

```
 (function() {
    var jsapi = document.createElement('script'); jsapi.type = 'text/javascript'; jsapi.async = true;
    jsapi.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + 'www.google.com/jsapi?key=YOUR KEY';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('head')[0]).appendChild(jsapi);
  })(); 
```

正文结束：

```
<script type="text/javascript">
google.load("jquery", "version");
</script> 
```

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2017-11-21T15:14:27.427

我将它与我自己的服务器上的其他 js 文件一起托管，就是这样，将它们组合并缩小（使用 django-compresser，在这里，但这不是重点）作为一个 js 文件，与网站的所有内容一起提供需要投入其中。无论如何，您都需要提供自己的 js 文件，所以我认为没有理由不在那里添加额外的 jquery 字节 - 传输更多 kb 比发出更多请求要便宜得多。你不依赖任何人，一旦你的缩小的 js 被缓存，你也超级快。

在第一次加载时，基于 CDN 的解决方案可能会胜出，因为您必须从自己的服务器加载额外的 jquery 千字节（但是，没有额外的请求）。不过，我怀疑差异是否明显。然后，在清除缓存的第一次加载时，您自己的托管解决方案可能总是更快，因为需要更多请求（和 DNS 查找）来获取 CDN jquery。

我想知道这一点是如何几乎从未被提及的，以及 CDN 似乎如何接管世界 :)

# asp.net - 我应该在什么时候调用 ASP.NET 事件的基本方法？

> ID：547391
> 
> 赞同：2
> 
> 时间：2009-02-13T19:45:07.170
> 
> 标签：asp.net, page-lifecycle

在 ASP.NET 中，如果我重写页面生命周期事件，我应该在工作之前还是之后调用它的基本方法？这还重要吗？

```
protected override void OnPreRender(EventArgs e)
{
    // My code goes here
    base.OnPreRender(e);
    // Or here
} 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-13T19:50:45.753

是的，你应该关心。假设您需要在所有这些页面中插入一个新的基类。对我来说，直接调用基础方法比稍后进行大量重构要容易。

再说一次，也许你不需要这样做。

**编辑**
基于对问题的编辑，这里有更多信息：

是的，你应该关心。有时您希望基类方法在您的方法之前触发（在构造函数的情况下），有时您希望它在您的之后触发（析构函数）。

这可能意味着在您的代码到达时属性或对象是否可用之间的差异。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-13T19:49:22.793

asp.net 事件模型中的“OnEvent”方法仅包装实际的事件调用（在本例中为“PreRender”事件）。因此，您唯一需要决定的是“我需要在工作之前还是之后调用该事件”？

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-10-28T17:30:25.710

答案是，这取决于代码在做什么之前或之后。

正如另一个人所说，如果它是构造函数的东西，它应该放在前面。析构函数应该继续。举一个更具体的例子，如果您有处理页面和加载内容、填充下拉列表和填充标签等的代码，那么您希望在查看预填充内容并确定可见性或与页面上的数据有关的业务规则逻辑。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-13T19:54:47.053

我认为原则上给他们打电话是个好主意。在您当前使用的框架版本中，基类方法中没有代码可能是真的，但谁知道未来的版本。此外，关注点分离将规定您编写的派生自 Page 的代码不会假定 Page 类除了在其 OnPreRender 方法中引发 PreRender 事件之外什么都不做。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-10-28T10:31:01.143

没有单一的规则。我可以给你举个例子。我的 ASP.net webapp 使用母版页打开的 NHibernate 事务，并在页面结束时由它提交/回滚。

好吧，我必须尽早在 OnInit 方法中初始化事务（Master 没有类似 Page 的 OnPreInit），否则用户控件在 Page.Load 之前无法访问事务。

相同的规则适用于提交。控件可能希望在其生命周期的最后阶段更新对象，然后我必须在 Unload 方法中，甚至在处置器中尽可能晚地关闭事务！

所以……就我而言……

```
void OnInit(EventArgs e) {
    transaction = session.BeginTransaction();
    base.OnInit(e);
}

void OnUnload(EventArgs e) {
    base.OnUnload(e);
    try{
        transaction.Commit();
    } catch {}
}

void OnError(EventArgs e) {
    base.OnError();
    transaction.Rollback();
} 
```

我会建议你一个一般规则：如果你的页面的设计合同涉及创建和销毁某个事件范围之间的控件使用的资源（即在加载之后和 PreRender 之前），那么在事件触发**之前**尽可能晚地初始化资源，并在触发最终事件**后**尽早销毁它

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-10-28T11:52:59.447

如果您仍然要调用页面基础方法，则可以使用

```
protected void Page_PreRender (object sender, EventArgs e) {...} 
```

而不是

```
protected override void OnPreRender(EventArgs e) {
   base.OnPreRender(e);
   ...
} 
```

# php - 通过php在mysql中错误的参数计数错误

> ID：547392
> 
> 赞同：0
> 
> 时间：2009-02-13T19:45:16.470
> 
> 标签：php, mysql

我一直在努力解决这个问题太久了，我没有看到任何错误。

我有一张桌子，里面有很多位置。当我通过我的 php 脚本添加位置时，我收到“mysql_query() 的参数计数错误”的错误。

当我回显 mysql 查询时，一切看起来都很好，我可以将其复制并粘贴到 phpmyAdmin 中，一切运行良好。

查询看起来像这样

```
INSERT IGNORE INTO locations (name, address, city, state, zip) VALUES ('Soboba Casino','23333 Soboba Road', 'San Jacinto', 'CA', '92581') 
```

我错过了什么吗？为什么这不在我的脚本中运行，而是在 phpmyAdmin 中运行？

对不起，错过了 php，进攻性的 php 看起来很简单

```
// insert the venue
$insertLoc="INSERT IGNORE INTO locastions (loc, address, city, state, zip) VALUES ('$venueName','$streetAddress', '$city', '$state', '$zip')";
echo $insertLoc;
mysql_query($insertLoc)or die(mysql_query()); 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-13T20:03:00.763

尝试将第三行替换为

```
mysql_query($insertLoc)or die(mysql_error()); 
```

（请注意，我已将第二个替换为`mysql_query()`。`mysql_error()`）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-13T19:46:15.453

这是一个 PHP 错误，而不是 MySQL 错误。检查您的 PHP 代码，如果您需要更多帮助，请发布它。

问题编辑后的编辑答案：这是 die() 子句。 `mysql_query`至少需要一个参数。其他人建议使用`mysql_error(),`which 可能是您打算做的。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-13T20:49:02.790

`or die(mysql_query());`应该`or die(mysql_error());`

另外，在你的 SQL 中我猜`locastions`应该是`locations`

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-13T19:48:09.177

您能否显示导致此错误的 PHP？如果我猜测我会说这是您正在创建的 SQL 中的错误引用，导致参数计数关闭。

```
mysql_query("INSERT IGNORE INTO locations (name, address, city, state, zip) VALUES ('$place", '$address', '$city', '$state', '$zip')"); 
```

这将解析为多个参数。

# xml - 用于比较 xml 文件的工具或库

> ID：547399
> 
> 赞同：42
> 
> 时间：2009-02-13T19:47:09.600
> 
> 标签：xml, comparison, content-management

我正在寻找一个理解 xml 的 XML 比较工具。它不能像 WinMerge 或 Beyond Compare 那样逐行比较。

一个理想的解决方案是显示更改的方式类似于 Word 2007 显示跟踪更改的方式。 [DeltaXML](http://www.deltaxml.com/)可以做到这一点，但没有“开箱即用”的真正 GUI，每位用户 500 美元！：

[![](https://i.stack.imgur.com/ZUKRv.jpg)](https://i.stack.imgur.com/ZUKRv.jpg)

[ExamXml](http://www.a7soft.com/examxml.html)开箱即用，但以令人困惑的方式显示差异。它没有前后的概念，它只是显示差异：

[![替代文字](https://i.stack.imgur.com/141cz.gif)](https://i.stack.imgur.com/141cz.gif)
[（来源：[a7soft.com](http://www.a7soft.com/images/examxml1_.gif)）]

该工具应该具有使用属性作为键的概念，这样它就不会认为重新排序的元素列表发生了变化。DeltaXML 会这样做，但我未能为屏幕截图正确设置它。

* * *

**更新：**

到目前为止， **[ExamlXML](http://www.a7soft.com/examxml.html)**是最好的开箱即用解决方案。但它缺乏 DeltaXML 的变更管理概念。导致一些可用性问题。

**[DeltaXML](http://www.deltaxml.com/)**几乎是我需要的解决方案，但具有更多开箱即用功能的东西会更好。DeltaXML 需要编写 java 代码来调用 api，以及编写 XSL 来将 xml 转换为预期的输入。

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-02-22T17:21:18.367

我很惊讶没有人提到微软的[XML NotePad](http://www.microsoft.com/downloads/details.aspx?familyid=72d6aa49-787d-4118-ba5f-4f30fe913628&displaylang=en)

它是免费的，它可以创建一个很好的比较，告诉哪些元素/属性已经改变、移动、被删除等：

（对不起，如果屏幕截图有点宽）。

![](https://www.your-translations.com/images/XML%20Notepad.jpg)

![](https://www.your-translations.com/images/XML%20Notepad_compare.jpg)

您还可以将 XLS 应用到 XML 文件并进行各种编辑操作。很值得一试。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-02-18T05:44:22.490

如果我理解您的问题，您可能有一个使用 XML 文件作为数据存储的应用程序，并且 GUI 将“技术”标签名称抽象为“用户友好”标签 - 我再次假设。因此，以类似的方式看待差异将是一种自然的延伸。我还假设您的应用程序没有遵循“抽象”概念的差异工具。

我进行了一些搜索，发现了一个似乎与突出显示功能接近的应用程序 ( [ExamXML )。](http://www.a7soft.com/examxml.html)我下载了 eval 版本并针对它测试了您的文件：

[http://www.programmedintheusa.com/images/stack547399.png](http://www.programmedintheusa.com/images/stack547399.png)

它在突出差异方面做得很好。它看起来非常互动，并且弹出了多少差异。看起来你可以改变它使用的颜色，所以也许你可以使用灰色和白色来淡化标签。它似乎也有很多选项，您也可以为您的用户预先设置。

我想指出，您将很难找到一个不会显示标签名称的 XML 比较工具，因为标签是提供内容上下文的东西。如果去掉上下文，就很难理解所显示的数据。无论如何，也许这个工具可能会有所帮助。您是否还尝试向您的用户展示其中一些工具，看看他们愿意容忍什么，有时他们可能会让您感到惊讶。希望这可以帮助！

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-02-13T19:58:18.137

SourceGear 的 DiffMerge 对单用户免费：

[http://www.sourcegear.com/diffmerge/](http://www.sourcegear.com/diffmerge/)

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-17T23:12:31.590

我可能会尝试[使用 DeltaXML](http://www.deltaxml.com/) + XSLT 转换来获得您想要的特定结果。将纯文本比较工具与 XML 结合使用的一个问题是，即使内容本身没有变化，XML 文档的物理形式（其缩进等）也会发生变化，这可能会导致大量误报。DeltaXML 是比较基于文档的 XML 的一个非常好的工具。

此外，根据您的用户使用的编辑器，它可能具有内置的 XML 差异。例如，Arbortext Editor 有一个很好的工具，可以显示文本（而不是标签），其中的更改突出显示/删除。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-02-20T01:16:12.413

[Altova diffDog](http://www.altova.com/features_xml_diffdog.html) XML Spy 和 diffDog 是出色的工具。从我冰冷的死手上撬开它们，有点东西。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-02-13T20:55:51.197

正如@BobbyShaftoe 已经提到的，Beyond Compare 非常出色。然而，对于合并，我喜欢使用[Araxis Merge](http://www.araxis.com/merge/index.html)。我们经常将其用于类似目的。

至于您对用户的非技术能力的评论：

> 感谢您的回复......但这些似乎都太技术化了。我的用户通常看不到 xml 标记，因为他们的 XML 创作工具将它们抽象出来。是否有任何工具可以显示文本内容的差异，但不显示（或不强调）xml 标签。

我要把它扔在那里：你的用户应该学习。如果您让他们合并和更改 XML 文件——我假设可能用于记录保存或应用程序配置——那么他们应该至少对他们正在做的事情有一个基本的了解。他们不必是 XML 专家也能使用列出的工具并完成工作。

但是，如果要求您的用户对他们正在做的工作有基本的了解是不可能的，那么我建议您自己编写一个配置实用程序并将其交付给您的最终用户，而不是依赖第三方软件。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-13T19:54:00.270

[试试 Microsoft MSDN XML](http://msdn.microsoft.com/en-au/xml/default.aspx)中的XML Notepad，它有一个比较 XML 文件。不知道它有多好。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-13T19:49:51.480

您是否尝试过[testdiff](http://www.prestosoft.com/edp_examdiff.asp)？当然，它仍然是一种技术工具，但使用起来很容易。它有一个拖放界面来比较文件。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-13T19:53:11.067

我总是使用 kdiff3。它易于使用，最多可以比较 3 个文件。 [http://kdiff3.sourceforge.net/](http://kdiff3.sourceforge.net/)

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-02-13T22:23:24.687

您可能会发现[XML Diff and Patch GUI Tool](http://msdn.microsoft.com/en-us/library/aa302295.aspx)（MSDN 上的示例代码）更好地满足您的需求：它仍然显示标签，但强调文本的差异。由于您获得了代码，因此您可以更加努力地根据您的要求对其进行定制。

尽管该示例相对较旧（2004 年 7 月，并且起源于 2002 年），但它可以轻松升级到 Visual Studio Express C# 2008。如果/当安装程序 MSI 提到“.NET 代码示例中的 SQLXML Bulkload”时，请不要推迟从 MSDN 站点下载[示例- 它不是！](http://download.microsoft.com/download/6/5/D/65DD68D3-E63A-455B-8CD3-17B0447DAEB5/xmldiffgui.msi)

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-02-18T17:44:14.413

无论是编程方式还是 UI，您都可以使用 MSDN 中的 XmlDiff、XmlPatch 工具和库。有关其工作原理的详细信息，请查看指南。

[http://msdn.microsoft.com/en-us/library/aa302294.aspx](http://msdn.microsoft.com/en-us/library/aa302294.aspx)

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-02-21T19:47:28.743

[Oxygen](http://www.oxygenxml.com/) XML Editor 拥有我发现的最好的 XML diff 集合工具。有几种不同的算法可供比较，所以如果默认设置不适合您，请尝试使用 Syntax Aware 或其他一些算法（现在，我使用的是版本 8 并且尚未升级到版本 10，所以 ymmv，但我怀疑XML 差异变得更糟）。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2010-08-28T12:47:53.967

我知道这是一个过时的线程，但[Project: Merge](http://www.projectmerge.com)是一个新的 Windows 应用程序，它可以管理 XML 文件的双向和三向合并和比较。（三向操作假设有两个文件都派生自一个公共基础文件。）

您可能需要告诉它如何识别单个元素以完美地处理您的文件，但这很容易做到，而且您只需要做一次。

# flash - 在 IE 中刷新时不会在根对象上绘制矩形

> ID：547408
> 
> 赞同：2
> 
> 时间：2009-02-13T19:48:41.390
> 
> 标签：flash, actionscript-3

我有一个 swf 文件，它在 IE 上的行为很奇怪。问题是在第一次加载后查看页面时不会绘制某个矩形。它只出现在 IE 中，一个快速的解决方法是使 swf 的路径在每个请求上都是唯一的，这样它就不会被缓存。我的其余对象每次都被绘制。

代码很简单

```
公共函数drawStage（）
{
    var bgRect:Shape = new Shape();

    bgRect.graphics.beginFill(0x5F5F5F);
    bgRect.graphics.drawRect(0,84, stage.stageWidth, 115);
    bgRect.graphics.endFill();
    bgRect.alpha = 0;

    addChild(bgRect);

    Tweener.addTween(bgRect, { alpha: 1, time: 1 });
}

```

在我的构造函数中调用。整个课程可以在这里看到：[http](http://katuaq.wwwdev.punktum.gl/flash/bioteaser.txt) ://katuaq.wwwdev.punktum.gl/flash/bioteaser.txt，swf在这里：http: [//katuaq.wwwdev.punktum.gl/](http://katuaq.wwwdev.punktum.gl/)。

正如您现在可能已经知道的那样，在 IE 中刷新时不会绘制图像背后的灰色背景。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-14T13:54:07.460

不要从构造函数中调用 drawStage。在构造函数中为 ADDED_TO_STAGE 事件设置一个监听器，并从该事件的处理程序中调用 drawStage。此外，您可能会发现当用户使用浏览器缩放功能时，您的舞台尺寸会发生变化，因此请注意 RESIZE 事件并采取相应措施。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-14T13:01:16.650

IE 对缓存的 swf 做了一些奇怪的事情，这使得前几帧的 stageWidth 错误。解决方案是在读取该值之前稍等片刻，或者只使用一个设定的数字。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-15T15:16:43.840

这绝对是一个已知问题。刷新时，stage.{SIZES} 在 IE 中设置为 0。您可以添加一个侦听器（输入帧或调整大小）检查大小是否为“非零”：

```
stage.addEventListener(Event.RESIZE, onResize);
stage.dispatchEvent(new Event(Event.RESIZE));

function onResize(event:Event):void 
{
    if (stage.stageHeight > 0 && stage.stageWidth > 0) 
    {
        stage.removeEventListener(Event.RESIZE, resizeHandler); 
    }
} 
```

此外，您应该知道在某些浏览器中无法正确处理大量事件：

[http://www.actionscript.org/forums/showthread.php3?t=136345&highlight=timeline+preloader](http://www.actionscript.org/forums/showthread.php3?t=136345&highlight=timeline+preloader)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-16T08:12:56.190

这是缓存和 Internet Explorer 的一个已知问题。

最简单的解决方案是您现在拥有的解决方案。使 swf 路径独一无二。否则，您不必要地混淆您的操作脚本代码。

请注意，将图像加载到 Flash 时也会出现此问题。如果一旦加载，您可能会遇到 IE 问题。在那里，您必须使图像的路径独一无二。

# xpath - XPath 1 查询

> ID：547422
> 
> 赞同：1
> 
> 时间：2009-02-13T19:52:15.407
> 
> 标签：xpath

我发布了一个类似的问题，并得到了非常有用的回复。现在问题有点不同，所以我发布它。我指定它是一个与 XPath 1 相关的问题。这是我的 XML 文件的内容：

```
<?xml version="1.0" encoding="ISO-8859-1"?>
<mainNode>
    <subNode>
        <h hm="08:45">
            <store id="1563">Open</store>
        </h>
        <h hm="13:00">
            <store id="1045">Open</store>
            <store id="763">Open</store>
            <store id="1047">Open</store>
        </h>
        <h hm="16:30">
            <store id="1045">Open</store>
            <store id="763">Open</store>
            <store id="1047">Open</store>
        </h>
        <h hm="20:00">
            <store id="1045">Open</store>
            <store id="1043">Open</store>
            <store id="1052">Open</store>
        </h>
        <h hm="22:00">
            <store id="763">Open</store>
        <store id="1052">Open</store>
        </h>
    </subNode>
</mainNode> 
```

我的程序获取当前时间：如果我得到 12.40，我必须检索下一个 h hm (13.00) 的所有商店 id：这个问题已经解决。

在使用第二个 XPath 查询检索数据之后，我必须知道，直到在当天（XML 文件是其代表），一个商店将被打开。因此，假设商店是标识为 id=1045 的商店，现在是早上 12.40。该商店将在 20.00 关闭，因为它位于 h hm=13.00 子节点、h hm=16.30 子节点和 h hm=20.00 子节点中。所以，我必须得到那个 20.00。

**案例 2：现在是 12.40，我必须知道 763 什么时候关闭。它将在 16.30 关闭，无论它是否包含在最后一个节点中 (h hm=22.00)。所以，我必须得到那个 16.30。**

这可能吗？

提前致谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-14T16:02:54.077

以下是如何构造这样的 XPatch 表达式：

下面的 XPath 表达式选择想要的结果

```
($vOpen[not(count(following-sibling::h[1] | $vOpen) 
          = 
           count($vOpen))
       ][1]/@hm
|

  $vOpen[last()]/@hm

 )

  [1] 
```

在哪里`$vOpen`

定义为：

```
$vge1240[store/@id=$vId] 
```

并`$vge1240`定义为：

```
/*/*/h[translate(@hm,':','') >= 1240] 
```

并`$vId`定义为：

```
1045 
```

或者

```
763 
```

上述变量可以在 XSLT 样式表中定义和引用，或者，如果 XPath 嵌入在另一个主机中，则每个变量引用必须替换为变量定义的右侧。在这种情况下，完整的 XPath 表达式将是：

```
 (/*/*/h[translate(@hm,':','') >= 1240][store/@id=763]
      [not(count(following-sibling::h[1]
                |             
                 /*/*/h[translate(@hm,':','') >= 1240][store/@id=763]
                 )     
          =       
           count(/*/*/h[translate(@hm,':','') >= 1240][store/@id=763])) 
          ]  
          [1]
            /@hm

     |
        /*/*/h[translate(@hm,':','') >= 1240][store/@id=763]
           [last()]
                   /@hm 
       )

        [1] 
```

**说明**：

```
($vOpen[not(count(following-sibling::h[1] | $vOpen) 
          = 
           count($vOpen))
       ][1]/@hm
|

  $vOpen[last()]/@hm

 )

  [1] 
```

意思如下：

1.  来自“开放”时间中包含 id (763) 的所有条目

2.  以那些紧随其后的兄弟不属于该集合的那些（封闭或不包含 763）

3.  从那些拿第一个。

4.  从上面步骤 3\. 中选择的节点中获取第一个（按文档顺序）和`$vOpen`. 如果其中的所有条目都包含给定的 ID，这将选择“开放”时间中的最后一个条目。

**在这里，我们基本上使用 Kayesian 方法来交叉两个节点集**$ns1 和 $ns2：

$ns1[count(.|$ns2) = count($ns2)]

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-13T20:05:15.000

[我将在您提到的最后一个问题](https://stackoverflow.com/questions/475923/xpath-query-and-time)中重复我对您的回答的最后一部分。

将 XML 加载到一些更有利于您的需求的数据结构中会更实用。这个次要问题只是再次强化了该建议的合理性。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-13T20:26:19.240

如果您要查找的商店 ID 在 中`$store`，这将获取`h/@hm`包含该 ID 的最后一个，后跟`h`不包含该 ID的最后一个**或**包含该商店 ID 的最后一个（对于在最后关闭的商店*）*。**`h/@hm``h/@hm`**

 **```
//h[not(store/@id=$store)]/preceding-sibling::h[store/@id = $store][1]/@hm | //h[store/@id=$store][last()]/@hm 
```

使用您的示例 XML 在 XSLT 中进行测试：

```
<?xml version="1.0" encoding="utf-8" ?>
<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform" version="1.0">
    <xsl:variable name="store" select="763"/>

    <xsl:template match="/">
        <closes>
            <xsl:value-of select="//h[not(store/@id=$store)]/preceding-sibling::h[store/@id = $store][1]/@hm | //h[store/@id=$store][last()]/@hm"/>
        </closes>
    </xsl:template>
</xsl:stylesheet> 
```

打印`<closes>16:30</closes>`。如果您更改`$store`为 1052，则`<closes>22:00</closes>`改为打印。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-14T17:11:33.227

我认为这行得通。它会找到 store/@id 的最后一次连续出现（在开始时间之后），其中@id = $id，我相信这就是您正在寻找的。

```
<xsl:variable name="id" select="'1045'"/>
<xsl:variable name="st" select="translate('12:40',':','')"/>

...

((//h[translate(@hm,':','') >= $st])[position() = count(preceding-sibling::*[store/@id=$id])+1 and store/@id=$id])[last()]/@hm 
```

说明：首先，选择与提供的开始时间共享开始时间 >= 的所有元素。然后，在这些结果中，选择最后一个元素的 @hm 属性，该属性的位置等于其中包含请求的 store/@id 标记的前面元素的数量。

这个简短版本的一个限制是，如果商店 id 不在开始时间之后的第一个元素内出现，它将失败。下面的一个通过从包含正确 store/@id 的开始时间之后的第一个开始来修复该限制，但它有点混乱：

```
<xsl:variable name="id" select="'1045'"/>
<xsl:variable name="st" select="translate('12:40',':','')"/>

...

((//h[translate(@hm,':','') >= $st and position() >= count(//h[not(preceding-sibling::*[store/@id=$id])])])[position() = count(preceding-sibling::*[store/@id=$id])+1 and store/@id=$id])[last()]/@hm 
```

# c# - C# 字符串不会连接

> ID：547430
> 
> 赞同：0
> 
> 时间：2009-02-13T19:54:12.313
> 
> 标签：c#, string, concatenation

```
// Reads NetworkStream into a byte buffer.

NetworkStream ns;
System.Net.Sockets.TcpClient client = new TcpClient();

byte[] receiveBytes = new byte[client.ReceiveBufferSize];
ns.Read(receiveBytes, 0, (int)client.ReceiveBufferSize);
String returndata = Encoding.UTF8.GetString(receiveBytes); 
```

我成功地从客户端读取并将结果存储到一个名为 returndata 的字符串中。但是，当我尝试将 returndata 与任何内容连接时，不会发生连接。例如：String.Concat(returndata, "test") 返回 returndata，returndata + "test" 也是如此。

有谁知道为什么会这样？

编辑：史蒂夫 W 是正确的；我后来发现 returndata.Length 总是返回 8192。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-13T19:56:03.213

您是将其分配给字符串还是返回给自身？

```
returndata = string.Concat(returndata, "test");
returndata += "test"; 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-13T19:59:03.237

为了扩展 jhunter 的答案， Concat 方法不会更改原始字符串变量的内容，它只是*返回*连接的结果。如果希望 returndata 包含连接的结果，则需要使用`returndata = string.Concat(returndata, "test")`.

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-13T20:19:03.393

我认为问题与不跟踪读取的字节总数有关。设置为 ReceiveBufferSize 的字节缓冲区很可能大于读取的实际字节数。通过考虑读取的实际字节，然后将其传递给 Encoding.UTF8.GetString() 方法，您应该得到一个可以连接的有效字符串。这是一个例子：

```
 NetworkStream ns;
System.Net.Sockets.TcpClient client = new TcpClient();

byte[] receiveBytes = new byte[client.ReceiveBufferSize];
int bytesRead = ns.Read(receiveBytes, 0, receiveBytes.Length);
String returndata = Encoding.UTF8.GetString(receiveBytes,0,bytesRead);
returndata = returndata.Trim(new char[] {'\0'}); 
```

另请注意有关读取空终止符并将其包含在读取的字节中的其他建议也可能是一个问题。我已经包含了字符串的 Trim 以确保删除空终止符。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-13T19:58:57.653

我猜一下：

接收到的字符串包含一个 '\0' 终止符。您应该能够使用调试器进行检查。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-13T19:58:23.380

字符串是不可变的。这意味着，当您将另一个字符串添加（连接）到您的字符串时，您将收到一个新的字符串实例。
原始字符串本身不会更改。

# syntax - Common Lisp 中的 eq、eql、equal 和 equalp 有什么区别？

> ID：547436
> 
> 赞同：82
> 
> 时间：2009-02-13T19:56:15.617
> 
> 标签：syntax, common-lisp, equality

Common Lisp 中的 ,​​ 和 ,`eq`有什么`eql`区别？我知道他们中的一些检查类型，其中一些检查类型以及所有这些，但是哪个是哪个？什么时候比其他更好用？`equal``equalp`

* * *

## 回答 #1

> 赞同：87
> 
> 时间：2009-02-13T20:00:36.930

来自[Common Lisp：等式谓词](http://www.cs.cmu.edu/Groups/AI/html/cltl/clm/node74.html)

> `(eq x y)`当且仅当`x`和`y`是同一个相同对象时为真。
> 
> 如果它的`eql`参数是`eq`，或者如果它们是具有相同值的相同类型的数字，或者如果它们是表示相同字符的字符对象，则谓词为真。
> 
> 如果`equal`谓词的参数是结构相似（同构）的对象，则谓词为真。一个粗略的经验法则是，当且仅当它们的打印表示相同时，两个对象才相等。
> 
> 两个对象`equalp`是否相等；如果它们是字符并且满足 char-equal，则忽略字母大小写和字符的某些其他属性；如果它们是数字并且具有相同的数值，即使它们是不同的类型；或者如果他们的组件都是`equalp`.

以下是我在上面链接到的同一页面中的一些示例：

```
(eq 'a 'b) is false. 
(eq 'a 'a) is true. 
(eq 3 3) might be true or false, depending on the implementation. 
(eq 3 3.0) is false. 
(eq 3.0 3.0) might be true or false, depending on the implementation. 
(eq #c(3 -4) #c(3 -4)) 
  might be true or false, depending on the implementation. 
(eq #c(3 -4.0) #c(3 -4)) is false. 
(eq (cons 'a 'b) (cons 'a 'c)) is false. 
(eq (cons 'a 'b) (cons 'a 'b)) is false. 
(eq '(a . b) '(a . b)) might be true or false. 
(progn (setq x (cons 'a 'b)) (eq x x)) is true. 
(progn (setq x '(a . b)) (eq x x)) is true. 
(eq #\A #\A) might be true or false, depending on the implementation. 
(eq "Foo" "Foo") might be true or false. 
(eq "Foo" (copy-seq "Foo")) is false. 
(eq "FOO" "foo") is false.

(eql 'a 'b) is false. 
(eql 'a 'a) is true. 
(eql 3 3) is true. 
(eql 3 3.0) is false. 
(eql 3.0 3.0) is true. 
(eql #c(3 -4) #c(3 -4)) is true. 
(eql #c(3 -4.0) #c(3 -4)) is false. 
(eql (cons 'a 'b) (cons 'a 'c)) is false. 
(eql (cons 'a 'b) (cons 'a 'b)) is false. 
(eql '(a . b) '(a . b)) might be true or false. 
(progn (setq x (cons 'a 'b)) (eql x x)) is true. 
(progn (setq x '(a . b)) (eql x x)) is true. 
(eql #\A #\A) is true. 
(eql "Foo" "Foo") might be true or false. 
(eql "Foo" (copy-seq "Foo")) is false. 
(eql "FOO" "foo") is false.

(equal 'a 'b) is false. 
(equal 'a 'a) is true. 
(equal 3 3) is true. 
(equal 3 3.0) is false. 
(equal 3.0 3.0) is true. 
(equal #c(3 -4) #c(3 -4)) is true. 
(equal #c(3 -4.0) #c(3 -4)) is false. 
(equal (cons 'a 'b) (cons 'a 'c)) is false. 
(equal (cons 'a 'b) (cons 'a 'b)) is true. 
(equal '(a . b) '(a . b)) is true. 
(progn (setq x (cons 'a 'b)) (equal x x)) is true. 
(progn (setq x '(a . b)) (equal x x)) is true. 
(equal #\A #\A) is true. 
(equal "Foo" "Foo") is true. 
(equal "Foo" (copy-seq "Foo")) is true. 
(equal "FOO" "foo") is false.

(equalp 'a 'b) is false. 
(equalp 'a 'a) is true. 
(equalp 3 3) is true. 
(equalp 3 3.0) is true. 
(equalp 3.0 3.0) is true. 
(equalp #c(3 -4) #c(3 -4)) is true. 
(equalp #c(3 -4.0) #c(3 -4)) is true. 
(equalp (cons 'a 'b) (cons 'a 'c)) is false. 
(equalp (cons 'a 'b) (cons 'a 'b)) is true. 
(equalp '(a . b) '(a . b)) is true. 
(progn (setq x (cons 'a 'b)) (equalp x x)) is true. 
(progn (setq x '(a . b)) (equalp x x)) is true. 
(equalp #\A #\A) is true. 
(equalp "Foo" "Foo") is true. 
(equalp "Foo" (copy-seq "Foo")) is true. 
(equalp "FOO" "foo") is true. 
```

* * *

## 回答 #2

> 赞同：29
> 
> 时间：2009-02-14T08:43:21.433

还有一些注意事项：

*   大多数 CL 函数在未指定测试时隐式使用 EQL

*   另请参见 STRING-EQUAL、= 和 TREE-EQUAL

*   EQ的核心通常是指针比较

和一个粗略的指南：

```
比较...使用...

对象/结构均衡器

NIL EQ（但函数 NULL 更简洁，可能更便宜）

T EQ（或者只是值，但你不关心类型）

精确数字 EQL

浮动 =

字符 EQL 或 CHAR-EQUAL

Lists, Conses, Sequences EQ（如果你想要完全相同的对象）
                           EQUAL（如果你只关心元素）

字符串 EQUAL（区分大小写）、EQUALP（不区分大小写）
                           STRING-EQUAL（如果您将符号混入其中）

树（列表的列表） TREE-EQUAL（带有适当的 :TEST 参数）

```

请注意，为了提高效率，通常使用 EQ >> EQL >> EQUAL >> EQUALP。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2014-02-15T10:18:42.807

从[这里](http://eli.thegreenplace.net/2004/08/08/equality-in-lisp/)和我老师的幻灯片

> **eq**测试它的参数（由同一块计算机内存表示）是否是相同的符号。

例如：

(eq 'A 'B) NIL
(eq 'RAM 'RAM) T
(eq (cons 'a 'b) (cons a' b')) ; *这是因为对两个 cons 进行了不同的调用，因此显然会为它们分配不同的内存块*

> **eql**首先测试它的参数是否满足 EQ，如果不满足，它会尝试查看它们是否是相同类型和值的数字。

例如：

(eql 4 4.0) 无
(eql 4 4) T

现在注意一个**区别**：

(eq 4.0 4.0) NIL ; 取决于平台，如第一个（接受的）答案中所述
(eql 4.0 4.0) T ; 参数的类型和值相同

*在某些实现上（eq 4.0 4.0）可能会返回 true，因为标准中没有指定实现是否应该只在内存中保留一份数字和字符的副本，就像使用符号一样）。根据经验* **，不要使用eq on numbers and characters**，*除非你真的知道你在做什么。*

> **equal**是一个“更健全”的比较函数。根据经验，您可以将其视为告诉您两个对象是否看起来相同（结构相似或同构）。它可能是您要用于一般相等的运算符。对于数字、字符和符号，它的行为类似于 eql，但对于列表（conses）和字符串，它告诉它们的元素是否

例如：

(等于 4 4) T
(等于 (+ 2 2) 4) T

现在注意一个**区别**

(eql (cons 'a 'b) (cons 'a 'b)) NIL
(equal (cons 'a 'b) (cons 'a 'b)) T ; *equal 通常对于打印相同的东西是正确的*

> **equalp**就像相等，只是更高级。数字比较是类型不敏感的。字符和字符串的比较不区分大小写。

例如：

(equalp (cons 'a 'b) (cons 'a 'b)) T ; *等于等于*

现在注意一个**区别**

等于（4 4.0）零等于（4
4.0）T；*由于 equalp 对数字类型不敏感*

# cocoa-touch - 如何控制放大窗口中使用的文本颜色？

> ID：547438
> 
> 赞同：3
> 
> 时间：2009-02-13T19:57:35.737
> 
> 标签：cocoa-touch

我们使用的是深色背景的 UITextView。因此，我们将文本设置为白色，以便于阅读。问题是当您按住手指移动插入点时弹出的放大窗口也使用白色作为文本颜色。这使得无法准确查看插入点的位置。

是否可以独立控制放大窗口中使用的文本颜色？

这是说明问题的屏幕截图。

![替代文字](https://dl.getdropbox.com/u/22784/magnify-white.png)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-17T04:20:29.313

我只是在这里做了一个快速测试，它工作正常。

我在模拟器中使用固件 2.2.1 并使用设备进行了测试。

这是我为测试它所做的： 1- 创建了一个新的基于视图的项目 2- 在 Interface Builder 中编辑了 nib，添加了一个 UITextView，将文本设置为白色，背景设置为灰色，其他一切都默认

你有什么不一样的吗？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-15T17:47:21.187

嗯，它在 Notes 应用程序中正常工作。不仅背景是黄色的，您还可以看到线条。

也许这取决于您是直接在 UITextView 上设置背景颜色还是使其透明并设置其包含视图的背景颜色？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-13T21:44:57.273

我不认为你对此有任何控制。我认为您应该就此向 Apple 提交错误报告。它应该比这更聪明。

# python - Send Info from Script to Module Python

> ID：547450
> 
> 赞同：2
> 
> 时间：2009-02-13T19:59:51.020
> 
> 标签：python

Hi I wonder how you can send info over to a module

An Example main.py Looks like this

```
from module import *
print helloworld() 
```

module.py looks like this

```
def helloworld():    
    print "Hello world!" 
```

Anyway i want to send over info from main.py to module.py is it possible?

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-13T20:05:05.127

It is not clear what you mean by "send info", but if you but the typical way of passing a value would be with a function parameter.

main.py:

```
helloworld("Hello world!") 
```

module.py

```
def helloworld(message):
    print message 
```

Is that what your looking for? Also the two uses of `print` in your example are redundant.

Addendum: It might be useful for you to read the [Python documentation regarding function declarations](http://docs.python.org/tutorial/controlflow.html#defining-functions), or, alternatively, most Python introductory tutorials would cover the same ground in fewer words. Anything you read there is going to apply equally regardless of whether the function is in the same module or another module.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-13T20:08:24.120

Yes. You can either send over information when calling functions/classes in module, or you can assign values in module's namespace (not so preferable).

As an example:

```
# module.py
# good example
def helloworld(name):
    print "Hello, %s" % name

# main.py
# good example
import module
module.helloworld("Jim") 
```

And for the bad: don't do it:

```
# module.py
# bad example
def helloworld(): 
    print "Hello, %s" % name

# main.py
# bad example
import module
module.name = "Jim"
module.helloworld() 
```

# java - 从 Lotus Notes 中的 Java 代理输出到客户端状态栏？

> ID：547456
> 
> 赞同：1
> 
> 时间：2009-02-13T20:03:03.133
> 
> 标签：java, lotus-notes

有谁知道`print`在 Lotus Notes Java 代理中获取 LotusScript 行为的方法，即在客户端状态栏上显示输出？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2010-01-01T03:56:57.943

我不知道有任何方法可以将 Java 代码本地打印到状态栏。

您可以这样做的唯一方法是将您的代码转换为 Java 类，为该类创建一个“打印”方法，然后使用 LotusScript 中的 JavaSession 对象在 LotusScript 中激活它们。在 LotusScript 中激活它后，您可以使用 print 方法将其分配给一个变量，然后调用 LotusScript 的“打印”函数。一种迂回的方式，但本质上您需要在 LotusScript 中执行“打印”命令

这应该会有所帮助： [http ://www.codestore.net/help/help85_designer.nsf/b3266a3c17f9bb7085256b870069c0a9/cfcde330df8ee09e852574cf006b67a7?OpenDocument](http://www.codestore.net/help/help85_designer.nsf/b3266a3c17f9bb7085256b870069c0a9/cfcde330df8ee09e852574cf006b67a7?OpenDocument)

# asp.net - 当我向选择添加选项时，选择变得更窄

> ID：547457
> 
> 赞同：1
> 
> 时间：2009-02-13T20:03:16.800
> 
> 标签：asp.net, javascript, html

继承了一个应用程序，该应用程序的页面具有调用 javascript 函数 addValueClick() 的链接，当我这样做时会弹出一个对话框，我输入一些文本，然后将文本放入选择框中。每次将新选项添加​​到选择时，它都会变窄约 5 个像素。我不知道为什么会这样，但它只发生在 IE7

这是javascript：

```
function addValueClick()
{
    var newValue = prompt("Please enter a new value.","");
    if (newValue != null && newValue != "")
    {
        var lst = document.getElementById("lstValues");
        var opt = document.createElement("option");
        opt.setAttribute("selected", "true");
        opt.appendChild(document.createTextNode(newValue));
        lst.appendChild(opt);
        updateBtns();
        copyValues();
    }
}

function copyValues()
{
    var frm = document.forms[0];
    var lst = frm.elements["lstValues"];
    var hid = frm.elements["hidValues"];
    var xml = "<root>";
    for (var i = 0; i < lst.options.length; i++)
    {
        xml += "<value seq_num=\"" + (i + 1) + "\">" +
          lst.options[i].text + "</value>";
    }
    xml += "</root>";
    hid.value = xml;
}

function updateBtns()
{
    var lst = document.getElementById("lstValues");
    var iSelected = lst.selectedIndex;
    var lnkEdit = document.getElementById("lnkEditValue");
    var lnkDelete = document.getElementById("lnkDeleteValue");
    var lnkUp = document.getElementById("lnkValueUp");
    var lnkDown = document.getElementById("lnkValueDown");
    if (iSelected == -1)
    {
        lnkEdit.style.visibility = "hidden";
        lnkDelete.style.visibility = "hidden";
        lnkUp.style.visibility = "hidden";
        lnkDown.style.visibility = "hidden";
    }
    else
    {
        lnkEdit.style.visibility = "visible";
        lnkDelete.style.visibility = "visible";

        if (iSelected == 0)
            lnkUp.style.visibility = "hidden";
        else
            lnkUp.style.visibility = "visible";

        if (iSelected == lst.options.length - 1)
            lnkDown.style.visibility = "hidden";
        else
            lnkDown.style.visibility = "visible";
    }
} 
```

编辑： HTML，它实际上是 ASP.NET。listValueChanged() 方法所做的就是调用上面的 updateButtons()。

```
<tr>
    <TD class=body vAlign=top noWrap align=right><b>Values:</TD>
    <TD class=body vAlign=top noWrap align=left><asp:ListBox id="lstValues" runat="server" onchange="lstValuesChange();" Rows="9" onselectedindexchanged="lstValues_SelectedIndexChanged"></asp:ListBox></TD>
    <TD class=body vAlign=top noWrap align=left>
        <TABLE id="Table2" cellSpacing="2" cellPadding="2" border="0">
            <TR>
                <TD noWrap>
                    <asp:HyperLink id="lnkAddValue" runat="server" NavigateUrl="javascript:addValueClick();">Add</asp:HyperLink></TD>
            </TR>
            <TR>
                <TD noWrap>
                    <asp:HyperLink id="lnkEditValue" runat="server" NavigateUrl="javascript:editValueClick();">Edit</asp:HyperLink></TD>
            </TR>
            <TR>
                <TD noWrap>
                    <asp:HyperLink id="lnkDeleteValue" runat="server" NavigateUrl="javascript:deleteValueClick();">Delete</asp:HyperLink></TD>
            </TR>
            <TR>
                <TD noWrap>&nbsp;</TD>
            </TR>
            <TR>
                <TD noWrap>
                    <asp:HyperLink id="lnkValueUp" runat="server" NavigateUrl="javascript:valueUpClick();">Up</asp:HyperLink></TD>
            </TR>
            <TR>
                <TD noWrap>
                    <asp:HyperLink id="lnkValueDown" runat="server" NavigateUrl="javascript:valueDownClick();">Down</asp:HyperLink></TD>
            </TR>
        </TABLE>
    </TD>
</TR> 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-13T20:37:18.933

它可能更多地与 html 而非脚本有关。选择包含在什么内容中？基于JS，我认为这里没有任何问题。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-13T21:54:42.773

我知道`SelectElement.innerHTML = '...';` [在 IE (bug 274) 中通过添加选项失败](http://webbugtrack.blogspot.com/2007/08/bug-274-dom-methods-on-select-lists.html)。

但我不知道通过 .createElement() 添加选项失败......虽然我并没有过度惊讶。

您可以使用 JavaScript`new Option();`语法来创建它们，我相当肯定它不会失败。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-16T19:08:00.203

问题是将选项添加到 Select 我将其更改为以下内容，并且效果很好：

```
function addValueClick()
{
    var newValue = prompt("Please enter a new value.","");
    if (newValue != null && newValue != "")
    {
        var lst = document.getElementById("lstValues");
        var opt = document.createElement("option");
        opt.text = newValue;
        opt.value = newValue;
        try {
            lst.add(opt, null); // real browsers
        }
        catch (ex) {
            lst.add(opt); // IE
        }

        updateBtns();
        copyValues();
    }
} 
```

# javascript - 衡量客户端页面加载时间的最佳方法是什么？

> ID：547458
> 
> 赞同：17
> 
> 时间：2009-02-13T20:03:19.687
> 
> 标签：javascript, performance, monitoring, client-side, timing

我希望监控我们网站的最终用户体验，并将其与服务器端已经记录的时间信息相关联。我的假设是，这将需要 javascript 在请求开始时 (window.onbeforeunload) 和加载结束时 (window.onload) 捕获时间戳。基本上是这样 - “[测量 Web 应用程序响应时间：与客户见面](http://www.javaworld.com/javaworld/jw-11-2008/jw-11-measuring-client-response.html)”

1.  有更好的方法吗？
2.  我应该期待什么样的性能损失（数量级）？
3.  结果有多好？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2010-12-13T19:14:40.043

还有来自雅虎的[Boomerang 。](http://yahoo.github.com/boomerang/doc/)

具有 Jiffy 和 Episodes 中不存在的一些高级功能。在支持它的浏览器中也支持[Navigation Timing](https://dvcs.w3.org/hg/webperf/raw-file/tip/specs/NavigationTiming/Overview.html) API（Chrome 6、IE 9）

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2012-09-04T11:30:58.013

为了完整起见，您现在可以在一些**现代**浏览器中使用导航计时 API：[https ://developer.mozilla.org/en-US/docs/Navigation_timing](https://developer.mozilla.org/en-US/docs/Navigation_timing)

```
function onLoad() { 
  var now = new Date().getTime();
  var page_load_time = now - performance.timing.navigationStart;
  console.log("User-perceived page loading time: " + page_load_time);
} 
```

**第三方编辑**

基于[caniuse.com 导航计时](http://caniuse.com/#search=navigation%20timing)今天得到广泛支持 (10/2016)

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-04-27T12:18:27.000

编辑（2013 年）：尝试[Boomerang](https://github.com/SOASTA/boomerang)，就像 @yasei-no-umi 建议的那样。它被积极维护。

——老答案——

我们使用[Jiffy](http://code.google.com/p/jiffy-web/)。

使用和修改非常简单——我们编写了自己的服务器端代码（而不是 Jiffy 的 Apache + perl）并使用了 Jiffy 的 JS。

关于性能损失 - 客户端没有。JS 本身非常快，并且可以在页面加载后使用 XHR 完成向服务器的报告，这对用户体验没有任何影响。在服务器端，您将收到两倍的请求。如果这是一个瓶颈，您可以为计时响应设置不同的服务器。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-13T20:13:14.327

使用[yslow](https://addons.mozilla.org/en-US/firefox/addon/5369)（Firefox 扩展）之类的东西怎么样？

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-05-07T19:09:38.270

[Jiffy](http://code.google.com/p/jiffy-web/)的替代方案是[Episodes](http://stevesouders.com/episodes/)。

两者都涉及检测您的 Javascript 以跟踪各种时间，并将这些时间记录在中央服务器上。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-13T20:09:30.497

我们在页面中有一个“回调”（一个 1x1 透明 GIF 图像，其参数表示页面渲染的 ID），该页面将“查看的页面”记录到我们的数据库中。即记录与记录页面本身具有相同 ID 的记录，并且当我们的渲染完成时我们有一个日志条目。

所以我们有时间：

*   页面准备开始
*   页面准备/响应完成
*   渲染完成时客户打电话回家

帮助理解“慢”的客户端（CPU 或 ISP/带宽）

不调用 home 的 PS 页面渲染也很有趣 - 用户点击关闭（假设该会话中的其他页面渲染确实记录了 Phone Home）

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2009-02-13T20:13:37.743

我很怀疑这些方法。其中一些方法比必要的更复杂，我质疑这些数据的准确性。我要做的是让测试人员去各种网络并使用诸如 Firebug 之类的东西：

[http://getfirebug.com/](http://getfirebug.com/)

见鬼的；这是最近提交给 SOSP 的一篇关于 AjaxScope 工具的有趣论文。有趣的是，这是一篇由 MS Research 发表的学术文章，显示 Firefox 的 Javascript 实现在某些情况下的性能比 Internet Explorer 好很多倍。:)

[http://research.microsoft.com/en-us/groups/rad/sosp07.pdf](http://research.microsoft.com/en-us/groups/rad/sosp07.pdf)

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2009-04-27T12:23:17.863

我们倾向于使用以下组合：

Firefox： [Web 开发人员工具栏](https://addons.mozilla.org/en-US/firefox/addon/60) [Firebug](http://getfirebug.com/) [YSlow](http://developer.yahoo.com/yslow/)

IE： [提琴手](http://www.fiddler2.com/fiddler2/)

在所有这些中，我发现 YSlow 提供了关于如何改善加载时间的最佳信息，但 Fiddler 提供了关于您可以通过网络期待什么的最佳整体信息，甚至可以模拟不同的网络速度。

# oop - 猴子修补/重新开放真的是反思的一个例子吗？

> ID：547464
> 
> 赞同：3
> 
> 时间：2009-02-13T20:05:34.953
> 
> 标签：oop, reflection, terminology, monkeypatching, late-binding

为这个问题的递归性质道歉，但对 SO 问题的[选择答案](https://stackoverflow.com/questions/546968/when-you-say-ruby-is-reflective-does-this-mainly-refer-to-duck-typing)让我质疑我对反射的理解。

我认为反射主要是关于在程序运行时查询程序的内部事件。此响应中给出的示例修补了 Ruby 的内置 Integer 类。

*   这不是更像函数重载/继承而不是运行时修改吗？
*   重新开课真的是反思的一个例子吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-13T20:16:24.133

反射可用于实现后期绑定。

后期绑定可用于实现猴子补丁。

猴子补丁可用于实现该答案中显示的那种编码风格。

但是还有其他方法可以实现不需要猴子修补或反射的此类功能。哎呀，一个好的宏预编译器可以让你接近。

所以，技术上是正确的，但不是（恕我直言）最好的例子。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-13T20:30:52.570

冒着增加递归级别的风险，尽管您在该链接上引用了我的答案，但我想做出回应。

这种误解很容易产生，因为我们对反射的直观理解是指向内看。这当然也是编程中反射的一个重要方面——例如，在 Ruby 中，我们有像 instance_of 这样的方法来允许对象在运行时询问关于自己的问题。

但是请看一下[反射的维基百科定义](http://en.wikipedia.org/wiki/Reflection_(computer_science))：

> 反射是计算机程序可以观察**和修改**其自身结构和行为的过程。

如您所见，反射不仅仅是运行时自检。它也是改变运行时行为的能力。重新打开一个类也称为“猴子补丁”。[你可以在这里](http://en.wikipedia.org/wiki/Monkey_patch)阅读更多关于它的信息。

> 猴子补丁是一种在 不改变原始源代码的情况下**扩展或修改动态语言的运行时代码的方法。**
> 
> 这个过程也被称为： - Guerrilla patching - 扩展先前声明的类 - 重新打开类 - Dynamic Funk - Hijacking - Duck Punching - Method Swizzling

# sql - 使用 MS SQL Server 2005，如何将详细记录合并到一个逗号分隔的列表中

> ID：547467
> 
> 赞同：2
> 
> 时间：2009-02-13T20:06:01.957
> 
> 标签：sql, sql-server, group-concat

**背景：**我正在运行 **MS2005**。我有一个 MASTER 表（ID，MDESC）和一个 DETAIL 表（MID，DID，DDESC），数据如下

```
1 MASTER_1
2 MASTER_2
1 L1 DETAIL_M1_L1
1 L2 DETAIL_M1_L2
1 L3 DETAIL_M1_L3
2 L1 DETAIL_M2_L1
2 L2 DETAIL_M2_L2 
```

如果我加入表格

```
SELECT M.*, D.DID FROM MASTER M INNER JOIN DETAIL D on M.ID = D.MID 
```

我得到如下列表：

```
1 MASTER_1 L1
1 MASTER_1 L2
1 MASTER_1 L3
2 MASTER_2 L1
2 MASTER_2 L2 
```

**问题：** 有没有办法使用 MS SQL 选择语句将详细记录放入逗号分隔的列表中，如下所示：

```
1 MASTER_1 "L1, L2, L3"
2 MASTER_2 "L1, L2" 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-13T20:23:17.860

你需要一个功能： -

```
 CREATE FUNCTION [dbo].[FN_DETAIL_LIST]
 (
     @masterid int
 )
 RETURNS varchar(8000)
 AS 
 BEGIN
     DECLARE @dids varchar(8000)

     SELECT @dids = COALESCE(@dids + ', ', '') + DID
     FROM DETAIL
     WHERE MID = @masterid
     RETURN @dids
 END 
```

用法：-

```
SELECT MASTERID, [dbo].[FN_DETAIL_LIST](MASTERID) [DIDS]
FROM MASTER 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-13T20:36:49.123

感谢 Bill Karwin 链接中的概念，是**CROSS APPLY**使它起作用

```
SELECT ID, DES, LEFT(DIDS, LEN(DIDS)-1) AS DIDS
 FROM MASTER M1 INNER JOIN DETAIL D on M1.ID = D.MID 
  CROSS APPLY (
    SELECT DID + ', '
    FROM MASTER M2 INNER JOIN DETAIL D on M2.ID = D.MID 
    WHERE M1.ID = M2.ID
    FOR XML PATH('')
   ) pre_trimmed (DIDS)
GROUP BY ID, DES, DIDS 
```

**结果：**

```
ID  DES        DIDS
--- ---------- ---------------
1   MASTER_1   L1, L2, L3
2   MASTER_2   L1, L2 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-13T20:08:40.547

合并是你的朋友。

```
declare @CSL vachar(max)

set @CSL = NULL
select @CSL = coalesce(@CSL + ', ', '') + cast(DID as varchar(8))
from MASTER M INNER JOIN DETAIL D on M.ID = D.MID

select @CSL 
```

这不适用于通用查询（即，对于单个主记录非常有效）。

你可以把它放到一个函数中......但这可能不会给你你需要/想要的性能。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-13T20:13:01.393

这就是 MySQL 的`GROUP_CONCAT()`聚合函数的目的。不幸的是，在其他不支持它的 RDBMS 品牌中复制此功能并不容易。

请参阅[在 Microsoft SQL Server 2005 中模拟 group_concat MySQL 函数？](https://stackoverflow.com/questions/451415/simulating-groupconcat-mysql-function-in-ms-sql-server-2005)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-13T20:16:16.690

我认为您需要一个函数才能在最新版本的 SQL Server 中正常工作：

[http://sqljunkies.com/WebLog/amachanic/archive/2004/11/10/5065.aspx?Pending=true](http://sqljunkies.com/WebLog/amachanic/archive/2004/11/10/5065.aspx?Pending=true)

# c# - 程序集引用无法在我们的构建服务器上正确解析

> ID：547468
> 
> 赞同：13
> 
> 时间：2009-02-13T20:06:47.773
> 
> 标签：c#, tfsbuild, assembly-resolution

我们使用 VS2008 SP1 用 C# 编写代码。我们有一台运行 Team System Server 2008 的服务器，我们将其用于源代码控制、任务等。该**服务器**也是我们用于**Team Build**的构建机器。这已经工作了很长时间了。直到目前。当我们尝试构建一个**引用**了一个**外部程序集**的项目时，我们会收到这些**错误消息**（这发生在 Team Build 中，以及在物理登录并通过 Visual Studio 进行常规构建时）：

 ****> C:\WINDOWS\Microsoft.NET\Framework\v3.5\Microsoft.Common.targets ：警告 MSB3246：*已解析文件的图像错误、没有元数据或无法访问。无法加载文件或程序集*“C:\Program Files\Syncfusion\Essential Studio\7.1.0.21\Assemblies\3.5\Syncfusion.XlsIO.Base.dll”或其依赖项之一。*该模块应包含程序集清单。*
> 
> C:\Program Files\MSBuild\Microsoft\VisualStudio\v9.0\ReportingServices\Microsoft.ReportingServices.targets(24,2)：错误 MSB4062：无法从 Microsoft 程序集加载“Microsoft.Reporting.RdlCompile”任务。 ReportViewer.Common，版本=9.0.0.0，文化=中性，PublicKeyToken=b03f5f7f11d50a3a。无法加载文件或程序集 'Microsoft.ReportViewer.Common, Version=9.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a' 或其依赖项之一。该模块应包含程序集清单。确认声明正确，并且程序集及其所有依赖项都可用。
> 
> 找不到引用的组件“Syncfusion.XlsIO.Base”。

这些错误是针对一个有一个有问题的程序集引用的项目。当我尝试构建整个解决方案时，当然会因为这个错误而出现更多错误。还有另外两个项目与其他程序集引用有相同的问题。我有一个 VS 似乎无法解析的引用程序集列表：

*   Microsoft.ReportViewer.Common
*   Microsoft.ReportViewer.WinForms
*   Syncfusion.Compression.Base
*   Syncfusion.Core
*   Syncfusion.XlsIO.Base

Syncfusion 程序集来自第 3 方组件包。其他两个与 Microsoft ReportViewer 组件有关。

引用是通过.NET 选项卡中的“添加引用”窗口添加的，所以我认为这没有任何可疑之处。在程序集引用的属性窗口中，Culture、Description、Path、Runtime Version 或 Strong Name 中没有值。版本说 0.0.0.0 和 Resolved 是 False。我想很明显 VS 无法解析引用。我的问题是为什么？？？我为这个问题挠了挠头。这仅发生在服务器上，该解决方案在我的机器和我的同事机器上都构建得很好。装配参考属性在我们的机器上很好。

我尝试**卸载****3rd-party 组件**（当然是在服务器上），然后重新安装。没有帮助。我试图**修复****VS2008**安装。没有帮助。试图从**源代码控制中检索****早期版本**（我知道以前在服务器上构建过），但我得到了相同的错误消息。我检查了**文件权限**，一切似乎都井井有条。我的想法已经不多了...

 ****我该如何解决这个问题？

**2009 年 2 月 16 日更新：**
我试图**比较我的电脑和服务器上的 dll 的 ildasm 输出**（请参阅我写的关于此的评论），在我看来是评论的一行中有一个小差异。我必须承认我根本不明白为什么会有区别，所以也许有人可以向我解释一下？我还尝试在服务器上
运行**病毒扫描。**没有帮助。试图**删除****引用**，然后通过浏览磁盘上的 dll 来读取它**。**没用。

**2009 年 3 月 17 日更新：**
我找到了解决方案！罪魁祸首是**Panda Antivirus 的 TruPrevent 模块**。禁用模块后，一切正常！=)我在[fuslogvw.exe](http://msdn.microsoft.com/en-us/library/e74a18c4%28VS.80%29.aspx)及其生成的日志
的帮助下发现了这一点。谷歌搜索结果，偶然发现了[这个博客条目。](http://msmvps.com/blogs/carlosq/archive/2007/03/23/the-strange-case-of-error-80131018-loading-a-visual-studio-add-in.aspx). 希望这可以帮助其他人。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-10T06:16:43.777

几乎可以肯定问题是环境问题 - 与来源无关。

一些想法...

(i) 尝试禁用您的防病毒/反恶意软件工具 - 我已经看到这些工具（尤其是趋势科技防病毒软件，出于某种原因）可以在（期间？）扫描后锁定 DLL 文件，干扰编译器。

(ii) 检查您的 PATH 环境变量。即使在现代，PATH 变量也被用来解决一些问题——如果这搞砸了（太长，最大长度是 2048 个字符 IIRC），那么事情可能会很奇怪。

(iii) 您检查过文件权限 - 您是否检查过注册表中的权限？例如，SyncFusion 将其许可证密钥安装在用户和机器配置单元中——如果构建服务器无法读取其中一个，可能会导致问题。

祝你好运！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-24T22:43:37.750

也可能是引用的程序集在开发机器上的 GAC 中，但不在构建机器上。将它从 GAC 中取出，放入您的源存储库，并通过路径引用它。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2014-07-08T09:57:14.807

我们遇到了同样的问题，原来**C 盘已满**（只有 28MB）。
释放空间解决了这个问题，即使构建发生在 D 上。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-13T20:13:13.920

你看到这个文件的 ildasm 有什么不同吗

'C:\Program Files\Syncfusion\Essential Studio\7.1.0.21\Assemblies\3.5\Syncfusion.XlsIO.Base.dll'

在您的机器上还是在服务器上？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-24T22:34:41.593

我怀疑构建过程所在的用户无权访问您的 3rd 方控件所在的文件夹。由于这在您的计算机上正常运行，因此几乎可以肯定是用户/权限特定的。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-09T17:46:18.947

您的第 3 方 dll 可能依赖于非托管 dll。通常是因为缺少特定版本的 VC++ 运行时 Dll。

在您的服务器上使用 Dependency Walker [http://www.dependencywalker.com/](http://www.dependencywalker.com/)打开 Dll并检查缺少的引用。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-10T04:04:37.043

不确定这是否对您的情况有所帮助，但在 dll 显然以某种方式未注册之前，我确实有类似的事情，并且在 dll 上运行 regsvr32 就可以了。

# perl - 如何在 Perl 中合并一个大的、未排序的文件中的行而不会耗尽内存？

> ID：547472
> 
> 赞同：3
> 
> 时间：2009-02-13T20:08:39.673
> 
> 标签：perl, memory, file, hash

我有一个非常大的列分隔文件，来自数据库报告，如下所示：

```
field1,field2,field3,metricA,value1
field1,field2,field3,metricB,value2 
```

我希望新文件具有这样的组合行，所以它看起来像这样：

```
field1,field2,field3,value1,value2 
```

我可以使用哈希来做到这一点。在此示例中，前三个字段是键，我将 value1 和 value 按一定顺序组合为 value。读入文件后，我只需将哈希表的键和值打印到另一个文件中。工作正常。

但是，我有一些担忧，因为我的文件会非常大。每个文件大约 8 GB。

会有更有效的方法来做到这一点吗？我考虑的不是速度，而是内存占用。我担心这个过程可能会由于内存问题而死。我只是在一个可行的解决方案方面画了一个空白，但最终不会把所有东西都塞进一个非常大的哈希值中。

为了全面披露，我在 Windows 上使用 ActiveState Perl。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-13T20:17:36.297

如果您的行是按键排序的，或者由于某些其他原因，field1、field2、field3 的相等值是相邻的，那么状态机会快得多。只需阅读这些行，如果字段与前一行相同，则发出两个值。

否则，至少，您可以利用恰好有两个值的事实，并在找到第二个值时从哈希中删除键 - 这应该会大大限制您的内存使用量。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-13T20:20:21.843

如果您有其他类似 Unix 的工具可用（例如通过 cygwin），那么您可以使用**sort**命令预先对文件进行排序（它可以处理大文件）。或者，您可以让数据库输出排序后的格式。

文件排序后，进行这种合并就很容易了 - 一次迭代一行，将最后一行和下一行保留在内存中，并在键更改时输出。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-02-14T02:38:19.597

如果您认为数据不适合内存，您可以随时将哈希绑定到磁盘数据库：

```
use BerkeleyDB;
tie my %data, 'BerkeleyDB::Hash', -Filename => 'data';

while(my $line = <>){
    chomp $line;
    my @columns = split /,/, $line; # or use Text::CSV_XS to parse this correctly

    my $key = join ',', @columns[0..2];
    my $a_key = "$key:metric_a";
    my $b_key = "$key:metric_b";

    if($columns[3] eq 'A'){
        $data{$a_key} = $columns[4];
    }
    elsif($columns[3] eq 'B'){
        $data{$b_key} = $columns[4];
    }

    if(exists $data{$a_key} && exists $data{$b_key}){
        my ($a, $b) = map { $data{$_} } ($a_key, $b_key);
        print "$key,$a,$b\n";
        # optionally delete the data here, if you don't plan to reuse the database
    }
} 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-13T20:13:39.427

直接从数据库再次导出到新文件而不是重新处理已经输出的文件不是更好吗？如果这是一个选择，那么我会走那条路。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-13T22:30:23.547

您可以尝试使用[Sort::External](http://search.cpan.org/perldoc?Sort::External)。它让我想起了可以在程序逻辑中直接使用的大型机排序。对于我使用它的用途来说，它工作得很好。

# html - html间距中的javascript

> ID：547480
> 
> 赞同：1
> 
> 时间：2009-02-13T20:12:03.457
> 
> 标签：html, jsp, spacing

```
<SCRIPT LANGUAGE="JavaScript">  
DynamicImage1(xx) DynamicImage2(yy) DynamicImage3(zz)   
</SCRIPT> 
```

这个 JS 片段在我的 HTML 表单中。（每个函数将根据输入参数显示不同的值。）

如何设置这些图像之间的间距？我希望它们都在同一行（默认情况下），但它们之间有间距。

我正在考虑把它放在桌子上，但我不确定这是否是最好的方法

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-13T20:19:37.417

更清洁的方法是将它们分开：

```
<div id="image1">
<SCRIPT LANGUAGE="JavaScript">  
     DynamicImage1(xx)
</SCRIPT>
</div>

<div id="image2">
<SCRIPT LANGUAGE="JavaScript">  
     DynamicImage2(xx)
</SCRIPT>
</div>

<div id="image3">
<SCRIPT LANGUAGE="JavaScript">  
     DynamicImage3(xx)
</SCRIPT>
</div> 
```

然后使用 CSS 设置样式；用于`float:left`将它们排成一排并添加`padding:right`到空间中。

我说这是干净的方式；不太干净的方法是保留你所拥有的，但`document.write("&nbsp;")`在每个图像之间添加。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-13T20:19:47.370

[与其直接在页面上编写代码，不如创建具有唯一 id 的通用容器（例如，< div id="images_container" ></ div >），并使用innerHTML](http://www.w3schools.com/htmldom/prop_anchor_innerhtml.asp)属性将图像 HTML 一张一张地写入此容器中。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-13T20:52:49.990

啊。不要在避免它们的地方使用内联脚本，并且在可以直接创建和插入 DOM 时不要使用 innerHTML。并使用 CSS 来处理 positionin/spacin 方面。图像已经内联显示，因此将 div 单独包装在它们周围只会使事情复杂化。

在不知道你的方法做什么的情况下，我猜，但这是你应该大致做的事情：

```
<head>
    <script>
    function createImage(t,params)
    {
      var img = document.createElement('img');
      /* season img to taste (e.g. img.src = params.source? */
      t.appendChild(img);
    }

    /* bind this method to onload event or better a ready event */
    function exec()
    {
      var t = document.getElementByid('target');
      createImage(t,xx);
      createImage(t,yy);
      createImage(t,zz);
    }
    </script>
    <style>
    /* I'm not advocating px here and these are just example values */
    #target {width: 600px; text-align: center;}
    #target img {border: 0px; margin: 0 10px; } /* the margin handles the spacing */
    </style>
</head>
<body>
    <div id="target"></div>
</body> 
```

[JS DOM 方法参考](http://www.javascriptkit.com/domref/elementmethods.shtml)

* * *

为什么 innerHTML 不好？虽然确实可以更快，但并非*总是*如此，而且无论如何[它都很接近](http://andrew.hedges.name/blog/2008/04/19/innerhtml-versus-the-dom-cant-we-all-just-get-along)，但是速度并不是 JS 的真正问题。然而innerHTML：

*   打开注入攻击
*   当它使用事件处理程序破坏预先存在的元素时会造成内存泄漏
*   基于字符串容易出错
*   不会返回对您刚刚插入的内容的引用，也无法克隆

# regex - 正则表达式在字符串中查找特殊字符，但有一些例外

> ID：547486
> 
> 赞同：8
> 
> 时间：2009-02-13T20:13:09.583
> 
> 标签：regex

我刚刚回答了一个类似（但不准确）的问题。现在我需要关于下面提到的问题的帮助。

我想编写一个匹配一个字符的正则表达式，如果它是一个非单词、非数字和非星 (*) 字符。所以，字符`[0-9][a-z][A-Z] *`不应该匹配，其他字符应该匹配。

我试着写`[\W[^*]]`，但它似乎不起作用。

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-02-13T20:16:08.267

试试这个：

```
[^\w\*] 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-02-13T20:17:02.070

匹配单个字符的最简单的正则表达式（不是您描述的字符之一）独立于任何特定的正则表达式扩展，将是：

```
[^0-9a-zA-Z *] 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-02-13T20:17:03.820

```
[^\w\*] 
```

很简单。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2019-01-29T16:34:02.610

请尝试以下正则表达式：

```
[\W_] 
```

# php - IE 将显示为 2 行，但我希望它显示为一行

> ID：547495
> 
> 赞同：0
> 
> 时间：2009-02-13T20:15:36.240
> 
> 标签：php, css, layout

我有以下代码：

```
<div id="banner">
<a href="http://www.kiubbo.com"><img src="/Logot.png" border=0></a>
    <script type="text/javascript"><!--
            google_ad_client = "pub-xxxxx";
        /* 468x60, creado 13/02/09 */
        google_ad_slot = "7830464607";
        google_ad_width = 468;
        google_ad_height = 60;
        //-->
    </script>
            <script type="text/javascript" src="http://pagead2.googlesyndication.com /pagead/show_ads.js">
    </script>
</div> 
```

在 Firefox 中看起来不错，但在 IE 中显示为 2 行（[http://www.kiubbo.com](http://www.kiubbo.com)）

任何人都知道如何解决这个问题？

谢谢你。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-13T20:24:08.107

尝试：

```
<style type="text/css">
   #banner a {
      float: left;
   }
   #banner iframe {
      float: left;
   }
   .clear { clear: both; }
</style> 
```

并将其放在横幅 div 中的最后一个脚本标记之后：

```
<div class="clear"></div> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-13T20:30:34.097

好像给了标志图片

```
'position:absolute;' 
```

将它们放在 IE 中的同一行。当然，它们也处于彼此之上。

# ruby-on-rails - ROR 模型设置问题：表关系

> ID：547496
> 
> 赞同：1
> 
> 时间：2009-02-13T20:15:39.767
> 
> 标签：ruby-on-rails, model, table-relationships

我正在开发一个具有用户模型、提交模型和评级模型的站点。每个提交的每个用户可能只有一个评分。我的问题是我应该如何在我的模型中设置它？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-13T20:33:26.477

```
class Submission
  has_many :ratings
  validates_uniqueness_of :rating, :scope => :user_id
end 
```

# asp.net - Exception when ASP.NET attempts to delete network file

> ID：547501
> 
> 赞同：1
> 
> 时间：2009-02-13T20:16:36.130
> 
> 标签：asp.net, security, file-io, filesystems

I've got an ASP.NET application that is trying to delete a file on a network share. The ASP.NET application's worker process is running under a domain account (confirmed this by looking in TaskManager and by using ShowContexts2.aspx¹).

I've been assured by the network admins that the process account is a member of a group that has modify permissions to the directory that contains the file I'm trying to delete.

However, it is unable to do so, and instead I get an exception (changed the file path to all x's):

> System.Web.HttpUnhandledException: Exception of type 'System.Web.HttpUnhandledException' was thrown. ---> System.UnauthorizedAccessException: Access to the path '\xxxxxxx\xxxxxxx\xxxxxxx\xxxxxx.xxx' is denied.

Any ideas on how to diagnose/fix this issue?

~~[http://www.leastprivilege.com/ShowContextsNET20Version.aspx](http://www.leastprivilege.com/ShowContextsNET20Version.aspx)~~

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-13T20:17:47.077

Ensure your ASP.NET worker process has access to the specified file path.

You can try giving "full control" access to "everyone" and then paring back access until it works with the permissions you want.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-13T21:03:59.383

听起来您确实没有在适当的环境下运行。

以不同方式处理此问题（一种更安全的方式）的建议是在默认帐户下运行并使用**WNetAddConnection2** Windows API 映射到网络驱动器。使用此 API，您无需更改 ASP.net 运行的上下文，您只需映射驱动器连接。您可以指定域帐户或本地帐户。您可以让它实际映射一个驱动器号，或者您可以只对驱动器共享进行身份验证而不映射一个字母。

我不止一次地使用过这个来自 asp.net 的 API，而且效果很好。因为您不给 ASP.net 增加特权，所以这更加安全。

有关 WNetAddConnection2 API 的更多信息：

[http://msdn.microsoft.com/en-us/library/aa385413(VS.85).aspx](http://msdn.microsoft.com/en-us/library/aa385413(VS.85).aspx)

# php - 包括带有 $_GET 的页面

> ID：547503
> 
> 赞同：1
> 
> 时间：2009-02-13T20:16:56.643
> 
> 标签：php

我想要像 index.php?showuser=512, index.php?shownews=317 这样的 url，用于我从 db 获取内容的页面......以及常规页面 index.php?page=about 等等，没有 mod-rewrite。

Invision Power Board 有这样的网址。我查看了他们的代码，但我无法弄清楚他们是如何做到的。

我可以这样做：

```
if (ctype_digit($_GET['shownews'])) include('shownews.php'); 
elseif (ctype_digit($_GET['showuser'])) include('showuser.php');

// regular pages
elseif ($_GET['page'] == 'about') include('about.php');
elseif ($_GET['page'] == 'help') include('help.php'); 
elseif ($_GET['page'] == 'login') include('login.php'); 
```

但这感觉太乱了。只是好奇 IPB 是如何做到这一点的。有没有更好的方法来做到这一点？没有任何mod-rewrite。有谁知道吗？我怀疑他们会像上面那样做。

我不能这样做：

```
if (preg_match('/^[a-z0-9]+$/', $_GET['page'])) include('$_GET['page']'); 
```

然后我会得到像 index.php?showuser&id=512 和我不喜欢的链接。（我知道仅显示原理并不安全）

我喜欢这种方式，它不是最好的，但我喜欢它，所以请对模板引擎、框架等保持安静。请善待并回答我的问题……我只是想知道 IPB 是如何做到这一点的。

谢谢托梅克

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-13T20:32:57.633

我不知道 IPB 是如何做到这一点的，让我们把它排除在外。但是，这就是*我*解决这个问题的方法：

首先，我认识到有两种 GET 参数：page/identifier 和 just page。这些将单独测试。

其次，我认识到所有的 get 参数都匹配它们的文件名，没有 php 后缀，所以我们可以利用它来发挥我们的优势。

要记住的最重要的事情之一是永远不要让 GET 参数影响我们未经清理的代码。在这种情况下，我们知道我们可以并且想要显示哪些类型的页面，因此我们可以从中创建一个白名单。

因此，进入伪 y 调度程序代码：

```
$pagesWithId = array("shownews", "showuser", "showwhatever");
$justPages   = array("about", "help", "login");

foreach ($pagesWithId as $page) {
  if (isset($_GET[$page])) {
    $id = (int)$_GET[$page]; 

    include($page.'.php');
    die();
  }
}

if (in_array($_GET['page'], $justPages)) {
  include($_GET['page'].'.php');
  die();
}

// page not found
show404OrHandleOtherwise(); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-13T20:41:20.250

对于页面，您只需使用一个简单的数组。

```
if (isset($pages[$_GET['page']])) include $pages[$_GET['page']]; 
```

对于 shownews=317 您可以在您的应用程序中进行简单的转换。取决于您希望如何优先处理页面或节目新闻等：

```
if (isset($pages[$_GET['page']])) {
  include $pages[$_GET['page']];
} else {
  $possiblePages = array_filter(array_intersect_key($_GET, $pagesWithId), 'ctype_digit');
  if (!empty($possiblePages)) {
    $id = reset($possiblePages);
    $pageName = key($possiblePages);
    $page = $pagesWithId[$pageName];
    include $page;
  } else {
    //no valid pages
  }
} 
```

注意：页面“名称”是数组键，值是要包含的路径、文件和扩展名。更可定制。

# latex - 在 LaTeX 中，有没有办法在第一次引用它之后自动放置一个浮点数？

> ID：547508
> 
> 赞同：19
> 
> 时间：2009-02-13T20:17:46.033
> 
> 标签：latex, figures

我目前正在编写一个长的单列文档，其中包含很多浮点数（图形和表格）。我知道在乳胶中放置花车的常用 b/h/p/t 选项。但是，我想知道是否存在可以让我自动执行以下操作的包或宏：在第一次引用后立即自动放置一个浮点数。因此，如果引用出现在页面 x 的顶部，那么浮动很可能出现在页面 x 的底部，或者可能出现在页面 x+1 的（顶部）。在任何情况下，它都不应该*出现*在*引用之前*。

我知道这可能很难实现，但我也不是乳胶大师......

[（请注意，此问题与此](https://stackoverflow.com/questions/448768/is-there-a-way-to-get-latex-to-place-figures-in-the-same-page-as-a-reference-to-t)问题不同。）

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-02-13T20:49:23.023

LaTeX Companion 说该`flafter`包可用于确保浮动永远不会放在它们的引用之前。要使用它，请将以下内容添加到文档的序言中：

```
\usepackage{flafter} 
```

请注意，根据[这个线程](http://groups.google.com/group/comp.text.tex/browse_frm/thread/46174a9418cbafc)，`flafter`所做的是确保浮动永远不会出现在其在 LaTeX 源代码中的位置之前。

如果您的文档只有几个浮点数，这可能会很好。对于有很多浮动的文档，放置变得更加困难，并且您可能会发现所有浮动都一起出现在文档或章节的末尾，或者您可能会收到“太多未处理的浮动”错​​误。建议阅读[此页面](http://www.tex.ac.uk/cgi-bin/texfaq2html?label=floats)以及英国 TeX 常见问题解答中的[此页面以获取更多建议。](http://www.tex.ac.uk/cgi-bin/texfaq2html?label=figurehere)

# sql - 仅使用一年中的月份将当前日期与存储的日期时间进行比较

> ID：547512
> 
> 赞同：6
> 
> 时间：2009-02-13T20:18:50.460
> 
> 标签：sql, sql-server

使用 SQL Server 2005，我有一个包含日期时间值的字段。

我想做的是创建2个查询：

1.  比较以查看存储的日期时间是否与当前日期相同的月份+年份
2.  比较以查看存储的日期时间是否与当前日期相同

可能有一个简单的解决方案，但我一直在使用我能找到的各种样本来打砖墙，有什么想法吗？

提前致谢。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-13T20:21:26.397

比较日期的各个部分：

```
WHERE YEAR( columnName ) = YEAR( getDate() ) 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-16T23:34:21.327

虽然其他答案会起作用，但它们都遇到相同的问题：它们对列应用转换，因此永远不会在该列上使用索引。

要在不进行转换的情况下搜索日期，您需要几个内置函数和一些数学运算。下面的例子：

```
--create a table to hold our example values
create table #DateSearch
(
    TheDate datetime not null
)

insert into #DateSearch (TheDate)
--today
select getdate()
union all
--a month in advance
select dateadd(month, 1, getdate())
union all
--a year in advance
select dateadd(year, 1, getdate())
go

--declare variables to make things a little easier to see
declare @StartDate datetime, @EndDate datetime

--search for "same month+year as current date"
select @StartDate = dateadd(month, datediff(month, 0, getdate()), 0), @EndDate = dateadd(month, datediff(month, 0, getdate()) + 1, 0)

select @StartDate [StartDate], @EndDate [EndDate], TheDate from #DateSearch
where TheDate >= @StartDate and TheDate < @EndDate

--search for "same year as current date"
select @StartDate = dateadd(year, datediff(year, 0, getdate()), 0), @EndDate = dateadd(year, datediff(year, 0, getdate()) + 1, 0)

select @StartDate [StartDate], @EndDate [EndDate], TheDate from #DateSearch
where TheDate >= @StartDate and TheDate < @EndDate 
```

该语句为避免转换所做的工作是查找大于或等于当前时间段（月或年）开始的所有值和小于下一个（无效）时间段开始的所有值。这解决了我们的索引问题，也缓解了与 DATETIME 类型中的 3ms 舍入相关的任何问题。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-13T20:25:36.777

```
SELECT * FROM atable 
WHERE 
    YEAR( adate ) = YEAR( GETDATE() )
AND
    MONTH( adate ) = MONTH( GETDATE() ) 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-13T23:32:17.717

在我看来，[DATEDIFF](http://msdn.microsoft.com/en-us/library/ms189794.aspx)正是您所需要的：

```
-- #1 same month and year
SELECT *
FROM your_table
WHERE DATEDIFF(month, your_column, GETDATE()) = 0

-- #2 same year
SELECT *
FROM your_table
WHERE DATEDIFF(year, your_column, GETDATE()) = 0 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-13T20:23:37.127

datepart 函数可让您提取所需的位：

```
declare @d1 as datetime
declare @d2 as datetime

if datepart(yy, @d1) = datepart(yy, @d2) and datepart(mm, @d1) = datepart(mm, @d2) begin
    print 'same'
end 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-13T20:26:16.293

你可以使用这样的东西

一种）

```
select *
from table
where MONTH(field) = MONTH(GetDATE()) 
  and YEAR(field) = YEAR(GetDATE()) 
```

b)

```
select *
from table
where YEAR(field) = YEAR(GetDATE()) 
```

# php - MySQL based web app: Easiest way for users to choose order or items?

> ID：547534
> 
> 赞同：4
> 
> 时间：2009-02-13T20:24:20.277
> 
> 标签：php, mysql, sorting, user-interface

I'm working on something where users can rearrange items, and at a later time, those items need to be displayed in the order chosen. As a simple example, consider a list of items:

A, B, C, D, E, F, G.
The MySQL table would be something simple: user_id, letter, sortnumber

The user is allowed to change the order in incremental steps. They might move A to after D, G to the beginning, etc. In addition to this, they can add, and remove items. So they might delete C, or add X. In each of these steps, I send data to PHP, which will process it, and set the items in MySQL.

There are two ways I see going about this:

1.  Each time they add/remove/reorder something, send the entire list to PHP, delete all the data they previous had in there, and just insert the new list. Problem is, this is a lot of deletions/insertions each time they do anything. They might move A to after B, and then suddenly I delete 7 records, and insert 7 more. On the plus side, it's dead simple.

2.  Each "move" they do (e.g. an add, or a remove, or a reorder), send the information for that. E.g. they moved An after F, and tell me "move An after F" I now have to check that both A and F exist on the list, then I have to decrement all "sortnumber" between A and F (including F). If they say "delete Z" I have to find it on the list, delete it, and decrement all sortnumbers of records after it.

So I'm just curious... Has anybody had to deal with something where order matters, and if so, how did you go about it?

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-13T20:30:30.197

Add a Sequence column to the table - as a floating point number.

When an item is moved between Row-A and Row-B set its sequence number to the Average of those adjacent columns

Index the Sequence column :)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-14T23:03:02.383

每个项目都有一个主键和一个排序号。如果您有一个包含主键的 php 数组，则可以使用 array_splice() 删除项目并将项目插入到数组中。

```
// base array
$items = array( 7, 11, 9, 4, 5);
// remove item 11
array_splice($items, array_search(11), 1);
// insert 11 before item 4
array_splice($items, array_search(4), 0, 11);
// input now contains 7, 9, 11, 4, 5 
```

然后循环遍历数组并使用主键更新排序

```
$i = 0;
foreach($items as $item) {
  // UPDATE item_table SET sorting = '$i' WHERE id = '$item';
  i++;
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-13T20:29:48.500

When the user wants to save the new order of the items, have it compare the new order to the old order and only perform updates on ones who have their *sortnumber* changed. If they delete an item, you don't need to shift the *sortnumber*s down. If you sort a list with a number that is missing in the middle, it will still be in the correct order.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-13T22:53:46.500

最后的序列顺序是唯一重要的。如果您移动六个项目以获得特定顺序，您实际上不需要关心列表的顺序在您开始时的状态和完成时的状态之间的点。

添加和删​​除项目而不用担心序列顺序，然后在单击“保存排序”按钮时更新项目以设置序列值。

这给你两个好处：

*   每次更改项目时的开销要少得多，这也意味着它会更快。
*   设置序列非常简单——您所要做的就是以所需的顺序发送一个项目 ID 列表，然后对其进行迭代，从 0 开始更新序列值并向上。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-21T21:23:56.343

*这是我对 Thomaschaaf 的问题给出的相同答案：*

> 这不是一个简单的问题。如果您的可排序元素数量很少，我会将它们全部重置为新顺序。
> 
> 否则，“测试和设置”似乎需要同样多的工作或更多的工作来仅修改已更改的记录。
> 
> 您可以将这项工作委托给客户端。让客户端维护旧排序顺序和新排序顺序并确定应该更新哪些行[排序顺序] - 然后将这些元组传递给 PHP-mySQL 接口。
> 
> 您可以通过以下方式增强此方法（*不需要*浮点数）：
> 
> 1.  如果列表中的所有可排序元素都根据它们在列表中的位置初始化为排序顺序，则将每个元素的排序顺序设置为类似于 row[sort-order] = row[sort-order * K] 其中 K是某个数字 > 您希望列表重新排序的平均次数。O(N)，N=元素的数量，但将插入容量增加至少 N*K，每个现有元素对之间至少有 K 个开放槽。
>     
>     
> 2.  然后，如果您想在其他两个元素之间插入一个元素，只需将其排序顺序更改为 > 下部元素和 < 上部元素。如果元素之间没有“空间”，您可以简单地重新应用上一段中介绍的“传播”算法 (1)。K 越大，应用的频率就越低。
>     
>     
> 
> K 算法将有选择地应用在 PHP 脚本中，而新排序顺序的选择将由客户端（可能是 Javascript）完成。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-22T08:31:29.827

只需添加另一列。调用它`order`。

您有行的顺序，每行都有一个 id 或主键。一次一个地浏览你的行，并在你去的时候设置顺序。所以：

```
UPDATE item_table SET order = 0 WHERE id="fred";
UPDATE item_table SET order = 1 WHERE id="larry";
UPDATE item_table SET order = 2 WHERE id="john";
UPDATE item_table SET order = 3 WHERE id="sydney"; 
```

我确信在数学上存在一些诡计的方法，但有时简单的答案是最好的。

然后，当您进行查询时添加`SORT BY order`.

# c# - 有用的迷你模式（不是设计模式）

> ID：547539
> 
> 赞同：2
> 
> 时间：2009-02-13T20:26:00.630
> 
> 标签：c#, .net, design-patterns, idioms

我最常用的迷你模式是：

```
VideoLookup = new ArrayList  { new ArrayList { buttonVideo1, "Video01.flv" },
                               new ArrayList { buttonVideo2, "Video02.flv" },
                               new ArrayList { buttonVideo3, "Video03.flv" }, 
                               new ArrayList { buttonVideo4, "Video04.flv" },
                               new ArrayList { buttonVideo4, "Video04.flv" }
                             }; 
```

这意味着，我可以将单击的按钮与 ArrayList 中的每个项目进行比较，而不是每个按钮都有一个 case 的 switch 语句。然后，当我找到匹配项时，我会启动正确的文件（尽管“查找”第二部分的操作可能是委托或其他任何内容）。

主要的好处是我没有记住为每个 switch 语句案例添加所有正确代码的问题，我只是在查找 ArrayList 中添加了一个新项目。

*（是的，我知道使用 ArrayList 不是最好的方法，但它是旧代码。而且我知道每次循环遍历数组不如使用 switch 语句高效，但这段代码不在紧环）*

有没有其他人有任何他们使用的迷你模式来节省时间/精力或使代码更具可读性？*它们不必只是与 GUI 相关*。

**更新：**不要复制这段代码，我知道它很糟糕，但我没有意识到有多糟糕。改用这样的东西。

```
Hashtable PlayerLookup = new Hashtable();
PlayerLookup.Add(buttonVideo1, "Video01.flv");
PlayerLookup.Add(buttonVideo2, "Video02.flv");
PlayerLookup.Add(buttonVideo3, "Video03.flv");
PlayerLookup.Add(buttonVideo4, "Video04.flv");

string fileName = PlayerLookup[currentButton].ToString(); 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-06-13T01:32:00.490

拜托拜托请使用这个版本。

```
VideoLookup = new Dictionary<Button, string> {
    { buttonVideo1, "Video01.flv" },
    { buttonVideo2, "Video02.flv" },
    { buttonVideo3, "Video03.flv" }, 
    { buttonVideo4, "Video04.flv" },
    { buttonVideo4, "Video04.flv" }
}; 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-13T20:32:42.580

您可以创建一个结构或对象，其中包含一个按钮引用和一个表示文件名的字符串，然后是这些内容的列表。或者，您可以只使用字典，让自己更轻松。很多改进的方法。:)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-13T20:36:57.733

关于开关的话题，我写了很多这样的东西：

```
public Object createSomething(String param)
{
    return s == null                          ? new NullObject() :
           s.equals("foo")                    ? new Foo() :
           s.equals("bar")                    ? new Bar() :
           s.equals("baz") || s.equals("car") ? new BazCar() :
                                                new Object();
} 
```

我认为与常规 switch 语句相比，它看起来更具可读性，并且能够进行更复杂的比较。是的，它会更慢，因为你需要比较每个条件，但 99% 的时间并不重要。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-04-17T23:20:18.380

在 Java 中，我有时会发现实现公共接口的私有内部类对于由紧密耦合元素组成的对象非常有帮助。[我已经看到在使用 Allen Holub 的Visual Proxy](http://www.javaworld.com/javaworld/jw-09-1999/jw-09-toolbox.html?page=6)架构创建 UI 的上下文中讨论过这个迷你模式（习语），但除此之外没有太多。据我所知，它没有名字。

例如，假设您有一个可以提供迭代器的 Collection 接口：

```
public interface Collection
{
  ...

  public Iterator iterate();
}

public interface Iterator
{
  public boolean hasNext();
  public Object next();
} 
```

如果您有一个实现 Collection 的 Stack，那么您可以将其 Iterator 实现为私有内部类：

```
public class Stack implements Collection
{
  ...

  public Iterator iterate()
  {
    return new IteratorImpl();
  }

  private class IteratorImpl implements Iterator
  {
    public boolean hasNext() { ... }
    public Object next() { ... }
  }
} 
```

Stack.IteratorImpl 可以完全访问 Stack 的所有私有方法和字段。同时，Stack.IteratorImpl 对除 Stack 之外的所有人都是不可见的。

Stack 和它的 Iterator 往往是紧密耦合的。最坏的情况是，将 Stack 的 Iterator 实现为公共类可能会迫使您破坏 Stack 的封装。私有内部类可让您避免这种情况。无论哪种方式，您都可以避免使用真正的实现细节来污染类层次结构。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-13T23:59:42.643

在我的上一份工作中，我编写了 Andrei Alexandrescu 和 Petru Marginean 在 C++ 中引入的强制概念的 C# 版本（[原始文章在这里](http://www.ddj.com/cpp/184403864)）。

这真的很酷，因为它可以让您在不中断流程的情况下将错误处理或条件检查与正常代码交织在一起 - 例如：

```
 string text = Enforce.NotNull( myObj.SomeMethodThatGetsAString(), "method returned NULL" ); 
```

这将检查第一个参数是否为空，如果是则抛出带有第二个参数作为消息的 EnforcementException，否则返回第一个参数。也有采用字符串格式参数的重载，以及允许您指定不同异常类型的重载。

您可能会争辩说，这种事情在 C# 中的相关性较低，因为运行时检查更好并且已经提供了相当丰富的信息 - 但是这个习惯用法让您可以更接近源代码并提供更多信息，同时保持表达性。

我使用相同的系统进行前后条件检查。

我可能会写一个开源版本并从这里链接它。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-06-13T01:43:05.737

因为当我快速编写代码时（截止日期！截止日期！为什么我在 stackoverflow.com 上？截止日期！），我会得到这样的代码：

```
Button1.Click += (o,e) => { DoSomething(foo); }; 
```

这会在某些时候导致我的内存泄漏吗？我不知道！这可能值得一个问题。确认！截止日期！

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-13T21:01:20.670

对于 Windows 窗体，我经常使用 Tag 字段来放置一个伪命令字符串，这样我就可以为一组共享的按钮提供一个事件处理程序。这对于做几乎相同的事情但参数化的按钮特别有效。

在您的第一个示例中，我会将按钮的标记设置为等于视频文件的名称——无需查找。

对于具有某种形式的基于文本的命令处理器来调度操作的应用程序，标签是一个刚刚输入命令处理器的字符串。效果很好。

（顺便说一句：我已经看到用于迷你模式的术语“成语”......）

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-06-13T01:18:36.277

我开始在 C# 中看到的一个新习惯用法是使用闭包参数来封装该方法需要运行的一些配置或设置。这样，您可以控制代码必须从您的方法中运行的相对顺序。

这被 Martin Fowler 称为嵌套闭包：http: [//www.martinfowler.com/dslwip/NestedClosure.html](http://www.martinfowler.com/dslwip/NestedClosure.html)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2010-09-27T19:10:47.153

也许已经有更好的方法来做到这一点（vbEx2005/.Net2.0），但我发现有一个通用的委托创建者类是有用的，它接受一个接受一些参数的方法，以及任何一个的值, 或除一个之外的所有参数，并产生一个委托，该委托在调用时将使用指定的参数调用指定的函数。与 ParameterizedThreadStart 等基于 ParamArray 的事物不同，一切都是类型安全的。

例如，如果我说：

```
Sub Foo(param1 作为整数，param2 作为字符串)
    ...
结束子

...
  Dim theAct as Action(of Integer) = _
      ActionOf(of Integer).NewInv(AddressOf Foo,"Hello there")

  法案(5)
...
```

结果将是在声明 Foo 的对象上调用 Foo(5, "Hello there")。不幸的是，我最终不得不为我想要支持的每个不同数量的参数拥有单独的泛型类和方法，但是将所有的剪切和粘贴都放在一个文件中，而不是让额外的代码分散在各处来创建适当的代表。

# mysql - 如何操纵 MySQL 全文搜索相关性以使一个字段比另一个字段更“有价值”？

> ID：547542
> 
> 赞同：45
> 
> 时间：2009-02-13T20:26:32.860
> 
> 标签：mysql, search, indexing, full-text-search, relevance

假设我有两列，关键字和内容。我对两者都有一个全文索引。我希望关键字中包含 foo 的行比内容中包含 foo 的行具有更高的相关性。我需要做什么才能使 MySQL 将关键字中的匹配权重高于内容中的匹配？

我正在使用“匹配”语法。

解决方案：

能够通过以下方式完成这项工作：

```
SELECT *, 
CASE when Keywords like '%watermelon%' then 1 else 0 END as keywordmatch, 
CASE when Content like '%watermelon%' then 1 else 0 END as contentmatch,
MATCH (Title, Keywords, Content) AGAINST ('watermelon') AS relevance 
FROM about_data  
WHERE MATCH(Title, Keywords, Content) AGAINST ('watermelon' IN BOOLEAN MODE) 
HAVING relevance > 0  
ORDER by keywordmatch desc, contentmatch desc, relevance desc 
```

* * *

## 回答 #1

> 赞同：96
> 
> 时间：2009-03-02T00:34:45.507

创建三个全文索引

*   a) 关键字列上的一个
*   b) 一个在内容栏
*   c) 关键字和内容列中的一个

然后，您的查询：

```
SELECT id, keyword, content,
  MATCH (keyword) AGAINST ('watermelon') AS rel1,
  MATCH (content) AGAINST ('watermelon') AS rel2
FROM table
WHERE MATCH (keyword,content) AGAINST ('watermelon')
ORDER BY (rel1*1.5)+(rel2) DESC 
```

关键是它只在列`rel1`中为您提供了查询的相关性`keyword`（因为您仅在该列上创建了索引）。 `rel2`做同样的事情，但对于`content`列。您现在可以应用您喜欢的任何权重将这两个相关性分数相加。

但是，您没有使用这两个索引中的任何一个进行实际搜索。为此，您使用第三个索引，它位于两列上。

（关键字，内容）上的索引控制您的召回。也就是返回什么。

两个独立的索引（一个仅针对关键字，一个仅针对内容）控制您的相关性。您可以在此处应用自己的加权标准。

请注意，您可以使用任意数量的不同索引（或者，可能会根据其他因素在查询时更改您在查询时使用的索引和权重......如果查询包含停用词，则仅搜索关键字......减少权重偏差如果查询包含超过 3 个单词...等）。

每个索引确实会占用磁盘空间，因此索引越多，磁盘就越多。反过来，mysql的内存占用更高。此外，插入将花费更长的时间，因为您有更多的索引要更新。

您应该针对您的情况对性能进行基准测试（小心关闭 mysql 查询缓存以进行基准测试，否则您的结果将出现偏差）。这不是谷歌级别的效率，但它非常简单并且“开箱即用”，几乎可以肯定它比您在查询中使用“喜欢”要好得多。

我发现它真的很好用。

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2009-02-13T21:51:51.687

实际上，使用 case 语句来制作一对标志可能是一个更好的解决方案：

```
select 
...
, case when keyword like '%' + @input + '%' then 1 else 0 end as keywordmatch
, case when content like '%' + @input + '%' then 1 else 0 end as contentmatch
-- or whatever check you use for the matching
from 
   ... 
   and here the rest of your usual matching query
   ... 
order by keywordmatch desc, contentmatch desc 
```

同样，仅当所有关键字匹配的排名高于所有仅内容匹配时。我还假设关键字和内容的匹配是最高排名。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2017-07-08T12:02:12.033

仅使用 2 个全文索引的更简单版本（取自 @mintywalker 的学分）：

```
SELECT id, 
   MATCH (`content_ft`) AGAINST ('keyword*' IN BOOLEAN MODE) AS relevance1,  
   MATCH (`title_ft`) AGAINST ('keyword*' IN BOOLEAN MODE) AS relevance2
FROM search_table
HAVING (relevance1 + relevance2) > 0
ORDER BY (relevance1 * 1.5) + (relevance2) DESC
LIMIT 0, 1000; 
```

这将针对 搜索两个完整索引的列，`keyword`并将匹配的相关性选择到两个单独的列中。我们将排除不匹配的项目（相关性 1 和相关性 2 都为零），并通过增加`content_ft`列的权重对结果进行重新排序。我们不需要复合全文索引。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-17T15:28:16.637

几年前我这样做了，但没有全文索引。我手头没有代码（前雇主），但我记得很清楚这项技术。

简而言之，我从每一列中选择了一个“权重”。例如：

```
select table.id, keyword_relevance + content_relevance as relevance from table
   left join
      (select id, 1 as keyword_relevance from table_name where keyword match) a
   on table.id = a.id
   left join
      (select id, 0.75 as content_relevance from table_name where content match) b
   on table.id = b.id 
```

请原谅这里的任何伪劣 SQL，我需要写任何 SQL 已经好几年了，而且我正在做这件事...

希望这可以帮助！

J.Js

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-08-10T09:13:36.273

在布尔模式下，MySQL 支持“>”和“<”运算符来更改单词对分配给行的相关值的贡献。

我想知道这样的事情是否可行？

```
SELECT *, 
MATCH (Keywords) AGAINST ('>watermelon' IN BOOLEAN MODE) AS relStrong, 
MATCH (Title,Keywords,Content) AGAINST ('<watermelon' IN BOOLEAN MODE) AS relWeak 
FROM about_data  
WHERE MATCH(Title, Keywords, Content) AGAINST ('watermelon' IN BOOLEAN MODE) 
ORDER by (relStrong+relWeak) desc 
```

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-02-13T20:34:21.857

据我所知，MySQL全文搜索不支持此功能，但是您可以通过在关键字字段中多次重复该单词来达到效果。与其使用关键字“foo bar”，不如使用“foo bar foo bar foo bar”，这样 foo 和 bar 在关键字列中同样重要，并且由于它们多次出现，它们与 mysql 更相关。

我们在我们的网站上使用它并且它有效。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2009-02-16T03:26:42.917

好吧，这取决于您的确切含义：

> 我希望关键字中包含 foo 的行比内容中包含 foo 的行具有更高的相关性。

如果您的意思是关键字中包含 foo 的行应该位于内容中包含 foo 的**任何行***之前* ，那么我将执行两个单独的查询，一个用于关键字，然后（可能是懒惰的，仅在请求时）另一个在内容。

 *** * *

## 回答 #8

> 赞同：-1
> 
> 时间：2011-02-01T12:06:03.117

我需要类似的东西并使用了 OP 的解决方案，但我注意到全文与部分单词不匹配。因此，如果“西瓜”作为单词的一部分出现在关键字或内容中（如 watermelonsalesmanager），则它不匹配，并且由于 WHERE MATCH 不包含在结果中。所以我玩弄了一下，将 OP 的查询调整为：

```
SELECT *, 
CASE WHEN Keywords LIKE '%watermelon%' THEN 1 ELSE 0 END AS keywordmatch, 
CASE WHEN Content LIKE '%watermelon%' THEN 1 ELSE 0 END AS contentmatch,
MATCH (Title, Keywords, Content) AGAINST ('watermelon') AS relevance 
FROM about_data  
WHERE (Keywords LIKE '%watermelon%' OR 
  Title LIKE '%watermelon%' OR 
  MATCH(Title, Keywords, Content) AGAINST ('watermelon' IN BOOLEAN MODE)) 
HAVING (keywordmatch > 0 OR contentmatch > 0 OR relevance > 0)  
ORDER BY keywordmatch DESC, contentmatch DESC, relevance DESC 
```

希望这可以帮助。

* * *

## 回答 #9

> 赞同：-4
> 
> 时间：2009-02-13T20:46:01.847

如果指标只是所有关键字匹配比所有内容匹配更“有价值”，那么您可以只使用带有行数的联合。沿着这些思路。

```
select *
from (
   select row_number() over(order by blahblah) as row, t.*
   from thetable t
   where keyword match

   union

   select row_number() over(order by blahblah) + @@rowcount + 1 as row, t.*
   from thetable t
   where content match
)
order by row 
```

对于比这更复杂的事情，如果您想对每一行应用实际重量，我不知道如何提供帮助。

# security - 为开发人员开源生产数据？

> ID：547545
> 
> 赞同：0
> 
> 时间：2009-02-13T20:28:32.573
> 
> 标签：security, open-source, privacy

我正在构建一个开源的、用户贡献内容的网站，我认为如果开发人员可以访问每晚的生产 SQL 转储，他们更有可能从 github 上查看代码并玩用它。

根据这个想法，我正在考虑：

*   **根本不收集私人用户信息，**对帐户使用 open-id，并大量使用 memcache 进行会话身份验证等。
*   **在发布之前**匿名敏感数据****

 **有时我会被“如果...不是很酷吗？”得意忘形。想法，所以我希望在这里进行健全性检查。这两种方法有什么明显的缺陷吗？这是一个理智的想法吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-13T20:55:05.583

一般来说，我认为你应该两者都做。您收集的任何私人数据对您来说都是一种责任，而不仅仅是因为您打算发布您的数据库。你能收集的越少越好。

然而，出于同样的原因，您可能会意识到敏感的不仅仅是 ID 和密码。还记得[AOL 搜索数据泄露](http://en.wikipedia.org/wiki/AOL_search_data_scandal)吗？还是 Netflix 数据库出版物？即使没有 ID，人们也能通过拼凑用户行为轨迹并将其与其他地方的数据对应起来，[设法找出一些账户的真实身份。](http://www.securityfocus.com/news/11497 "研究人员逆转 Netflix 匿名化")有些人对他们的搜索历史和电影租借感到尴尬。去搞清楚。

因此，我认为一般规则应该是尽可能少地收集，并将剩下的匿名化。即使您不存储与某个帐户对应的人的身份，您也可能想要打乱各种登录的操作。

另一方面，在某些情况下，您根本不关心这种隐私。例如，在维基百科中，您在网站上可以做的几乎所有事情都是公开的。至少，记录在数据库中的所有内容。如果信息已经通过 API 可用，则将其隐藏在数据库下载中是没有意义的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-13T21:06:10.440

除了**收集更少的数据**并**匿名**您收集的数据之外，您还可以添加一个位/标志供**用户选择是否包含他们的数据**。您可以将其设置为 CC 许可证标志，以便在满足您的需求的同时为用户提供温暖的'n'fuzzies。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-13T20:35:25.023

听起来是个不错的主意。您必须注意的一件事是安全性，因为黑客会知道您的数据库的确切架构。虽然这不是不可能处理的，但只要看看大多数开源项目。但是您需要更加强调安全性，因为现在可以更轻松地进行潜在的 SQL 注入。

另一件事是双重确保敏感数据是匿名的。此外，有些人可能（错误地）试图声称他们对用户提交的内容的版权受到侵犯，因此您可能需要指定 CC 许可证或其他东西，只是为了让一切更加清晰并防止将来出现问题（即使您是对的） ）。

# mysql - How to optimize query looking for rows where conditional join rows do not exist?

> ID：547552
> 
> 赞同：0
> 
> 时间：2009-02-13T20:30:39.713
> 
> 标签：mysql, optimization, join

I've got a table of keywords that I regularly refresh against a remote search API, and I have another table that gets a row each each time I refresh one of the keywords. I use this table to block multiple processes from stepping on each other and refreshing the same keyword, as well as stat collection. So when I spin up my program, it queries for all the keywords that don't have a request currently in process, and don't have a successful one within the last 15 mins, or whatever the interval is. All was working fine for awhile, but now the keywords_requests table has almost 2 million rows in it and things are bogging down badly. I've got indexes on almost every column in the keywords_requests table, but to no avail.

I'm logging slow queries and this one is taking forever, as you can see. What can I do?

```
# Query_time: 20 Lock_time: 0 Rows_sent: 568 Rows_examined: 1826718

SELECT Keyword.id, Keyword.keyword
FROM `keywords` as Keyword
LEFT JOIN `keywords_requests` as KeywordsRequest
ON (
  KeywordsRequest.keyword_id = Keyword.id
  AND (KeywordsRequest.status = 'success' OR KeywordsRequest.status = 'active')
  AND KeywordsRequest.source_id = '29'
  AND KeywordsRequest.created > FROM_UNIXTIME(1234551323)
)
WHERE KeywordsRequest.id IS NULL
GROUP BY Keyword.id
ORDER BY KeywordsRequest.created ASC;

```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-13T20:50:47.857

看来您最具选择性的索引`Keywords`是 on `KeywordRequest.created`。

尝试以这种方式重写查询：

```
SELECT Keyword.id, Keyword.keyword
FROM `keywords` as Keyword
LEFT OUTER JOIN (
  SELECT *
  FROM `keywords_requests` as kr
  WHERE created > FROM_UNIXTIME(1234567890) /* Happy unix_time! */
) AS KeywordsRequest
ON (
  KeywordsRequest.keyword_id = Keyword.id
  AND (KeywordsRequest.status = 'success' OR KeywordsRequest.status = 'active')
  AND KeywordsRequest.source_id = '29'
)
WHERE keyword_id IS NULL; 
```

它将（希望）散列连接两个不太大的来源。

Bill Karwin 是对的，你不需要`GROUP BY`or`ORDER BY`

MySQL 中没有对计划的精细控制，但您可以尝试（尝试）通过以下方式改进您的查询：

1.  创建一个复合索引`(keyword_id, status, source_id, created)`并使其成为：

    ```
    SELECT Keyword.id, Keyword.keyword
    FROM `keywords` as Keyword
    LEFT OUTER JOIN `keywords_requests` kr
    ON (
      keyword_id = id
      AND status = 'success'
      AND source_id = '29'
      AND created > FROM_UNIXTIME(1234567890)
    )
    WHERE keyword_id IS NULL
    UNION
    SELECT Keyword.id, Keyword.keyword
    FROM `keywords` as Keyword
    LEFT OUTER JOIN `keywords_requests` kr
    ON (
      keyword_id = id
      AND status = 'active'
      AND source_id = '29'
      AND created > FROM_UNIXTIME(1234567890)
    )
    WHERE keyword_id IS NULL 
    ```

    理想情况下，这应该`NESTED LOOPS`在您的索引上使用。

2.  创建一个复合索引`(status, source_id, created)`并使其成为：

    ```
    SELECT Keyword.id, Keyword.keyword
    FROM `keywords` as Keyword
    LEFT OUTER JOIN (
      SELECT *
      FROM `keywords_requests` kr
      WHERE
        status = 'success'
        AND source_id = '29'
        AND created > FROM_UNIXTIME(1234567890)
      UNION ALL
      SELECT *
      FROM `keywords_requests` kr
      WHERE
        status = 'active'
        AND source_id = '29'
        AND created > FROM_UNIXTIME(1234567890)
    )
    ON keyword_id = id
    WHERE keyword_id IS NULL 
    ```

    这有望用于`HASH JOIN`更受限制的哈希表。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-13T20:50:24.893

在诊断 MySQL 查询性能时，您需要分析的第一件事是来自[EXPLAIN](http://dev.mysql.com/doc/refman/5.1/en/using-explain.html)的报告。

如果你学会阅读 EXPLAIN 给你的信息，那么你可以看到查询在哪些地方没有使用索引，或者它们在哪些地方导致了昂贵的文件排序，或者其他性能危险信号。

我注意到在您的查询中，这`GROUP BY`无关紧要，因为 KeywordRequests 只会返回一个 NULL 行。也`ORDER BY`无关紧要，因为由于您的`WHERE`子句，您按始终为 NULL 的列进行排序。如果删除这些子句，您可能会删除文件排序。

还可以考虑将查询重写为其他形式，并衡量每种形式的性能。例如：

```
SELECT k.id, k.keyword
FROM `keywords` AS k
WHERE NOT EXISTS (
  SELECT * FROM `keywords_requests` AS kr
  WHERE kr.keyword_id = k.id
   AND kr.status IN ('success', 'active')
   AND kr.source_id = '29'
   AND kr.created > FROM_UNIXTIME(1234551323)
); 
```

其他提示：

*   是`kr.source_id`整数吗？如果是这样，比较整数 29 而不是字符串 '29'。
*   `keyword_id`, `status`, `source_id`,上是否有适当的索引`created`？也许即使是对所有四列的复合索引也是最好的，因为 MySQL 在给定查询中每个表只使用一个索引。

* * *

您对 EXPLAIN 输出进行了截图，并在评论中发布了链接。我看到查询*没有*使用关键字中的索引，这是有道理的，因为无论如何您都在扫描该表中的每一行。短语“不存在”表示 MySQL 对 LEFT OUTER JOIN 进行了一些优化。

我认为这应该比您的原始查询有所改进。GROUP BY/ORDER BY 可能导致它将中间数据集保存为临时表，并在磁盘上对其进行排序（这非常慢！）。您要查找的是 EXPLAIN 信息的 Extra 列中的“使用临时；使用文件排序”。

因此，您现在可能已经对其进行了足够的改进以缓解瓶颈。

我确实注意到可能的键可能表明您在四列上有单独的索引。您可以通过创建复合索引来改进它：

```
CREATE INDEX kr_cover ON keywords_requests
  (keyword_id, created, source_id, status); 
```

你可以给 MySQL 一个使用特定索引的[提示：](http://dev.mysql.com/doc/refman/5.1/en/index-hints.html)

```
... FROM `keywords_requests` AS kr USE INDEX (kr_cover) WHERE ... 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-13T20:46:06.573

不知道 MySQL，但在 MSSQL 中，我会采取的攻击路线是：

1）在KeywordsRequest状态，source_id和created上创建一个覆盖索引

2）UNION结果tog et围绕关键字Request.status上的OR

3）使用 NOT EXISTS 代替外部连接（并尝试使用 UNION 而不是 OR）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-08-04T08:22:50.743

试试这个 SELECT Keyword.id, Keyword.keyword FROM `keywords`as Keyword LEFT JOIN (select * from keywords_requests where source_id = '29' and (status = 'success' OR status = 'active') AND source_id = '29' AND created > FROM_UNIXTIME (1234551323) AND id IS NULL ) 作为 KeywordsRequest ON (KeywordsRequest.keyword_id = Keyword.id

) GROUP BY Keyword.id ORDER BY KeywordsRequest.created ASC;

# asp.net-mvc - Windows 2003 与 Visual Studio 2008 上的 Asp.Net MVC Url.RouteUrl 问题

> ID：547559
> 
> 赞同：1
> 
> 时间：2009-02-13T20:32:40.800
> 
> 标签：asp.net-mvc, iis-6, url-routing

我看到开发机器和部署服务器之间的 Url.RouteUrl 输出存在差异。我正在运行 Visual Studio 2008，我的部署框是 Windows 2003 Server。我已将 Global.asax.cs 配置为在路由表中使用 .aspx 扩展名运行。但是，当我使用“Search-Basic”命名路由时，Url.RouteUrl("Search-Basic", new {category = "Test", searchExpression = "search this"}) 没有输出

查看代码：

```
<%= Url.RouteUrl("Search-Basic", new {category = "test", searchExpression="search this"}) %> 
```

Global.asax.cs 代码：

```
 // routes for IIS 6 and version below
        routes.MapRoute(
            "Search-Basic",
            "Search.aspx/Basic/{category}",
            new { controller = "Search", action = "Basic", category = "All" }
            );

        routes.MapRoute(
            "Default",                                              // Route name
            "{controller}.aspx/{action}/{id}",                           // URL with parameters
            new { controller = "Home", action = "Index", id = "" }  // Parameter defaults
        );

        routes.MapRoute(
            "Root",
            "",
            new { controller = "Home", action = "Index", id = "" }
        ); 
```

在我的开发框中，我得到了预期的输出：/Search.aspx/Basic/Test?searchExpression=search%20this

但是，在我的部署服务器上，我根本没有得到任何输出。一个区别可能是我在部署服务器上的虚拟目录中运行应用程序。类似于：[http](http://testmachine.com/sm/testappname/) : //testmachine.com/sm/testappname/ 其中“/sm”是一个虚拟目录，“/testappname”是一个包含我的应用程序的虚拟目录。

有任何想法吗？

非常感谢你。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-13T21:22:39.993

您是否正在运行相同版本的 ASP.NET MVC，因为 RC1（非刷新）中存在一个错误，当您有一个未在路由中指定控制器的路由时会导致此行为：

> 另一个回归是，在某些情况下，当您指定路由名称时，RouteUrl（以及因此 RouteLink）方法返回一个空字符串，但该路由具有默认参数，而不是 URL 中的参数。
> 
> 例如，如果您有以下路线：
> 
> `routes.MapRoute("route-name", "foo/bar", new {controller="Home", action="index"});`
> 
> 请注意，控制器具有默认值，但不是 URL 的一部分。如果您随后指定：
> 
> `<%= Url.RouteUrl("route-name") %>`
> 
> 您可能期望它会使用该路由来呈现 URL，但事实并非如此。当我们重构所有生成 url 的助手以调用一个通用方法时，就会引入这个错误。然而，事实证明，我们的 RouteUrl 方法（也称为非 MVC 特定方法）应该具有与 MVC 特定方法（例如 Action）略有不同的行为。我们在通用方法中添加了一个标志，以便考虑到这种差异。这是一个没有大表面积的修复程序。

请参阅[http://haacked.com/archive/2009/01/30/aspnetmvc-refresh.aspx](http://haacked.com/archive/2009/01/30/aspnetmvc-refresh.aspx)

# greensoftware - What humanitarian, eco/green and sustainability focused software projects are there?

> ID：547565
> 
> 赞同：4
> 
> 时间：2009-02-13T20:33:28.583
> 
> 标签：greensoftware

I've recently come across the [HFOSS](http://hfoss.org/) (Humanitarian Free Open Source Software) Project as well as some other companies doing Smart Power Grid software companies and other kinds of Green focused software projects.

Since I am doing some research on the topic and because Google searches on *Green /Eco / Humanitarian / Sustainability* return a lot of noise to signal I was wondering what projects people know about personally which I might find worth reading up on.

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2010-02-21T22:01:20.510

当你为非政府组织或联合国工作时，有很多这样的工作，浏览这些网站之一开始你的“人道主义”工作搜索：

*   联合国工作怪物网站 ( [http://www.unjobmonster.com](http://www.unjobmonster.com) )
*   联合国官方网站（[http://www.jobs.un.org](http://www.jobs.un.org)）
*   联合国工作网站 ( [http://www.unjobs.org](http://www.unjobs.org) )

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-13T22:15:30.617

*   不是绿色，而是接近人道主义：似乎有很多[开源医疗项目](http://en.wikipedia.org/wiki/List_of_open_source_healthcare_software)正在进行......
*   [Pamguard](http://www.pamguard.org/home.shtml)是一个开源软件社区，开发海洋哺乳动物声学检测和定位软件以造福海洋环境

# unit-testing - Automating VB6 application with ActiveX controls

> ID：547569
> 
> 赞同：1
> 
> 时间：2009-02-13T20:35:27.020
> 
> 标签：unit-testing, vb6, automation, activex

I have a VB6 application that I don't have source code. This application uses third-party ActiveX controls. I want to automate these ActiveX controls. Is it possible to get the IUnknowns or Object references? For some of these, I can get the underlying HWNDs, but from what I can tell there isn't a generic way to convert these HWNDs to the ActiveX control.

Some testing software allows you to script VB6 applications with ActiveX controls. How do they do it?

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-12-03T07:05:09.040

这些 ActiveX 控件是否位于单独的 DLL 中？如果是这样，您可以使用 OLE View（一个 VS 6.0 工具）打开 dll 并查看所有接口、coclasse 等。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-13T21:12:49.190

您也许可以通过 Microsoft Research Detours 库使用 DLL 注入。基本上，您希望为这些特定控件挂钩 cocreate。你需要非常小心，尤其是当你做任何跨线程/跨进程的事情时（COM 线程规则非常重要）。

总的来说，Detours 很容易使用......但我从未尝试过使用 COM 例程。您可能想查看不同的解决方案。

另请注意，Detours 对其有一些许可限制，可能会影响您分发它的能力。

测试软件很可能只是将适当的 WM_XXX 消息发送到有问题的特定窗口（例如 WM_MOUSEMOVE）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-13T21:30:46.403

很抱歉，VB6 EXE 不包含提取它使用的 COM 对象所需的清单。您最好尝试一些 rbobby 的建议，尤其是关于发送 WM_XXX 消息的建议。

# c# - 在我的 WCF 服务上调用 close() 会释放所有资源吗？

> ID：547575
> 
> 赞同：4
> 
> 时间：2009-02-13T20:36:57.220
> 
> 标签：c#, wcf, garbage-collection

在我的 WCF 服务上调用 close 会杀死所有资源还是为 GC 设置它们，或者我也应该将其设置为 null 吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-13T20:50:11.477

首先，WCF 代理是`IDisposable`，所以你可以*使用*`using`：

```
using(var proxy = new MyProxy()) { // see below - not quite enough
   // use proxy
} 
```

**不幸**的是，WCF 也有一个`Dispose()`经常抛出异常的错误实现。但是，[这是一个非常酷的技巧](http://www.iserviceoriented.com/blog/post/Indisposable+-+WCF+Gotcha+1.aspx)，可以让它正常工作。[我自己](http://marcgravell.blogspot.com/2008/11/dontdontuse-using.html)也写过关于这个的博客，但我认为第一个链接要好得多。

所以：使用`IDisposable`and `using`，但要谨慎使用（在这种情况下）。

设置字段*通常*没有区别。有一些边缘情况（例如由多个委托捕获的变量、静态字段、长寿命对象等），但通常不要管它。特别是*不*要这样做，因为理论上这可以*延长*寿命：

```
if(field != null) field = null; // BAD 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-13T20:45:21.240

这与其说是一个 WCF 问题，不如说是一个 .NET 问题。也可以看看

[在 .NET 中使用后将对象设置为 Null/Nothing](https://stackoverflow.com/questions/2785/setting-objects-to-null-nothing-after-use-in-dot-net)

[处理这个对象就够了吗？还是我需要做更多？](https://stackoverflow.com/questions/328743/is-disposing-this-object-enough-or-do-i-need-to-do-more)

[在 Dispose(bool) 方法实现中，不应该将成员设置为空吗？](https://stackoverflow.com/questions/456551/in-the-disposebool-method-implementation-shouldnt-one-set-members-to-null)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-13T20:42:36.877

如果之后很长一段时间都可以访问，您只需要将变量设置为 null 。比如说，一个长寿命对象上的一个字段，或者一个静态字段。这通常适用，不仅适用于 WCF。

# php - How can I get the search result count for a dynamic drop down list?

> ID：547577
> 
> 赞同：0
> 
> 时间：2009-02-13T20:37:02.740
> 
> 标签：php, mysql, ajax

I have a count problem in PHP...

I am creating a drop down list dynamically from MySQL. When I select the first drop down menu, how can I get the search result count... like 10 products from the database?

Here is my code:

ajax..file:

```
var xmlHttp

function showCount(str)
{
xmlHttp=GetXmlHttpObject();
if (xmlHttp==null)
 {
 alert ("Your browser does not support AJAX!");
 return;
 }
var url="phpApplication.php";
url=url+"?action=count2";
url=url+"&sid="+Math.random();
xmlHttp.onreadystatechange=stateChanged;
xmlHttp.open("POST",url,true);
xmlHttp.send(null);
}

function stateChanged()
{
if (xmlHttp.readyState==4)
{
document.getElementById("countR").innerHTML=xmlHttp.responseText;
}
}

function GetXmlHttpObject()
{
var xmlHttp=null;
try
 {
 // Firefox, Opera 8.0+, Safari
 xmlHttp=new XMLHttpRequest();
 }
catch (e)
 {
 // Internet Explorer
 try
   {
   xmlHttp=new ActiveXObject("Msxml2.XMLHTTP");
   }
 catch (e)
   {
   xmlHttp=new ActiveXObject("Microsoft.XMLHTTP");
   }
 }
return xmlHttp;
} 
```

PHP Application:

```
class Application {

     public function __construct () { 

    } 

    function conn($sql)
{   

      $host      = "localhost";
      $username  = "root";
      $pwd       = "";
      $dbname    = "example";

    //echo "commnecing connection to local db<br>"
    if (!($conn=mysql_connect($host, $username, $pwd)))  {
        printf("error connecting to DB by user = $username and pwd=$pwd");
        exit;
    }
    $db3=mysql_select_db($dbname,$conn) or die("Unable to connect to local database");

    $result = mysql_query($sql) or die ("Can't connect because ". mysql_error());

    return $result;

}//end function  

function dropdown($field, $table)
{ 
  //initialize variables
  $oHTML  = '';
  $result = '';

  //check to see if the field is passed correctly
  if (($field == "")||($table == ""))
  {
    die("No column or table specified to create drop down from!");
  }

  $sql = "select distinct($field) from $table";

  //call the db function and run the query
  $result = $this->conn($sql);

  //if no results are found to create a drop down return a textbox
  if ((!$result) ||(mysql_num_rows($result)==0))
  {
    $oHTML .= "<input type='text' name='$field' value='' size='15'>";
  }elseif (($result)&&(mysql_num_rows($result)>0)){

    //build the select box out of the results
    $oHTML .= "<select name='$field' onchange='showCount(this.value)'>\n<option value='all'>All</option>\n";
    while ($rows = mysql_fetch_array($result))
    {
      $oHTML .= "<option value='".$rows[$field]."'>".$rows[$field]."</option>\n";

    }
    $oHTML .= "</select>\n";

  }
  //send the value back to the calling code
  return $oHTML;
}//end function

function countResult(){

  $sql2 = "select * from produkt_finder_table where 1 ";

  if ( $q == (!empty($_POST['Bauform_d']))&&($_POST['Bauform_d'] != 'all'))
  {
    $sql2 .= " and Bauform_d like '". addslashes($_POST['Bauform_d'])."%' ";
  }

  if ((!empty($_POST['Beschreibung_d']))&&($_POST['Beschreibung_d'] != 'all'))
  {
    $sql2 .= " and Beschreibung_d like '". addslashes($_POST['Beschreibung_d'])."%' ";
  }

   if ((!empty($_POST['SelectSchutzart_Cust_Bereich_d']))&&($_POST['SelectSchutzart_Cust_Bereich_d'] != 'all'))
  {
    $sql2 .= " and SelectSchutzart_Cust_Bereich_d like '". addslashes($_POST['SelectSchutzart_Cust_Bereich_d'])."%' ";
  }

   if ((!empty($_POST['SelectErfassungswinkel_Cust_Bereich_d']))&&($_POST['SelectErfassungswinkel_Cust_Bereich_d'] != 'all'))
  {
    $sql2 .= " and SelectErfassungswinkel_Cust_Bereich_d like '". addslashes($_POST['SelectErfassungswinkel_Cust_Bereich_d'])."%' ";
  }

   if ((!empty($_POST['ArtikelProduktgruppe_d']))&&($_POST['ArtikelProduktgruppe_d'] != 'all'))
  {
    $sql2 .= " and ArtikelProduktgruppe_d like '". addslashes($_POST['ArtikelProduktgruppe_d'])."%' ";
  }

$result2 = $this->conn($sql2);
  //run query

  if (!$result2){ die("No results due to database error.<br>".mysql_error());  }

  if (mysql_num_rows($result2)==0)
  {
    echo "0";
  }else{

    echo mysql_num_rows($result2);
}
}

function count1(){

   if ((!empty($_POST['Bauform_d']))&&($_POST['Bauform_d'] != 'all')) {

}

    $sql2 .= " and Bauform_d like '". addslashes($_POST['Bauform_d'])."%' ";
     $sql2 = "select * from produkt_finder_table where 1 ";
     $result2 = $this->conn($sql2);
      if (!$result2){ die("No results due to database error.<br>".mysql_error());  }

  if (mysql_num_rows($result2)==0)
  {
    echo "0";
  }else{

    echo mysql_num_rows($result2);
  }

  //run query

}

function countResultAll(){

 $sql = "select * from produkt_finder_table where 1 ";

  if ((!empty($_POST['searchfield']))&&($_POST['searchfield'] != 'all'))
  {
    $sql .= " and ArtikelName like '". addslashes($_POST['searchfield'])."%' ";
  }

$result = $this->conn($sql);
  //run query

  if (!$result){ die("No results due to database error.<br>".mysql_error());  }

  if (mysql_num_rows($result)==0)
  {
    echo "0";
  }else{

    echo mysql_num_rows($result);
}
}

function search()
{

//base sql
  $sql = "select * from produkt_finder_table where 1 ";

//get the values from the form

  if ((!empty($_POST['Bauform_d']))&&($_POST['Bauform_d'] != 'all'))
  {
    $sql .= " and Bauform_d like '". addslashes($_POST['Bauform_d'])."%' ";
  }

  if ((!empty($_POST['Beschreibung_d']))&&($_POST['Beschreibung_d'] != 'all'))
  {
    $sql .= " and Beschreibung_d like '". addslashes($_POST['Beschreibung_d'])."%' ";
  }

   if ((!empty($_POST['SelectSchutzart_Cust_Bereich_d']))&&($_POST['SelectSchutzart_Cust_Bereich_d'] != 'all'))
  {
    $sql .= " and SelectSchutzart_Cust_Bereich_d like '". addslashes($_POST['SelectSchutzart_Cust_Bereich_d'])."%' ";
  }

   if ((!empty($_POST['SelectErfassungswinkel_Cust_Bereich_d']))&&($_POST['SelectErfassungswinkel_Cust_Bereich_d'] != 'all'))
  {
    $sql .= " and SelectErfassungswinkel_Cust_Bereich_d like '". addslashes($_POST['SelectErfassungswinkel_Cust_Bereich_d'])."%' ";
  }

   if ((!empty($_POST['ArtikelProduktgruppe_d']))&&($_POST['ArtikelProduktgruppe_d'] != 'all'))
  {
    $sql .= " and ArtikelProduktgruppe_d like '". addslashes($_POST['ArtikelProduktgruppe_d'])."%' ";
  }

 //run query
  $result = $this->conn($sql);

  if (!$result){ die("No results due to database error.<br>".mysql_error());  }

  if (mysql_num_rows($result)==0)
  {
    echo "No Results found!";
  }else{

     echo "<table border='1' class='corner'><th width='332'><a href='product.php'>Back</a></th>";
     echo "<th>Product Result</th>";
     echo "<td width='40' align='center' style=' font-size:16px'><div id='countR'>";
     $this->countResult();
     echo "</div></td>";
        echo "</table>";

    // echo '<div style="float:right; font-size:16px">'.$this->countResultAll().'</div>';
    // echo "<div style='float:left; font-size:16px'>Produkt Result</div>";

    echo "<table border='1' class='corner'>"; 

     $i = 1;
    if((mysql_num_rows($result) % 2) == 0){
    $complete = false;
     }else{
    $complete = true;
     }

    while ($rows= mysql_fetch_array($result))
    {

      echo "<td>";
      echo "<ul><li class='addResult'><span class='red'>".$rows['Bauform_d']."<br /><span class='black'>".$rows['ArtikelName']."</span></span><img src='{imag}' alt='' /> <a href='#'>More Info</a> </li></ul>";
      echo "</td>";

   if(($i % 2) == 0){

       echo "</tr><tr>";
    }   

      $i++;
}
if($complete == true){

    echo "<td>&nbsp;</td>";

}     

    echo "</tr></table>";
      echo "<table border='1' class='corner'><th width='332'><a href='product.php'>Back</a> <div></div></th>";
     echo "<th>Product Result</th>";
     echo "<td width='40' align='center' style=' font-size:16px'>";
     $this->countResult();
     echo "</td>";
        echo "</table>";

}
}

function show_form()
{

  $Bauform   = $this->dropdown('Bauform_d','produkt_finder_table');
  $Beschreibung  = $this->dropdown('ArtikelGruppe_d','produkt_finder_table');
   $SelectSchutzart  = $this->dropdown('SelectSchutzart_Cust_Bereich_d','produkt_finder_table');
    $SelectErfassungswinkel  = $this->dropdown('SelectErfassungswinkel_Cust_Bereich_d','produkt_finder_table');
     $ArtikelProduktgruppe  = $this->dropdown('ArtikelProduktgruppe_d','produkt_finder_table');

  echo "<form name='search' action='productResult.php?action=search' method='POST'>
        <table width='50%' align='center' valign='center' class='corner'>
        <tr>
          <td colspan='2' align='center'> Search Form  <div id='countR' style='float:right; font-size:16px'>Count</div></td>
        </tr>
        <tr>
          <td align='right'>Montageart:</td><td>$Bauform</td>
        </tr>
         <tr>
          <td align='right'>ProduktGruppe:</td><td>$Beschreibung</td>
        </tr>
         <tr>
          <td align='right'>Speisung:</td><td>$SelectSchutzart</td>
        </tr>
        <tr>
          <td align='right'>Reichweite:</td><td> $SelectErfassungswinkel </td>
        </tr>
        <tr>
          <td align='right'>Erfwinkel:</td><td>$ArtikelProduktgruppe </td>
        </tr>

        <tr>
           <td colspan='2' align='center'><input type='submit' name='submit' value='Go!'></td>
        </tr>
        </table>
        </form>";

}//end function

function searchAll()
{

//base sql
  $sql = "select * from produkt_finder_table where 1 ";

//get the values from the form
//NOTE: You should do way more valdation on the values before you attempt to process anything

  if ((!empty($_POST['searchfield']))&&($_POST['searchfield'] != 'all'))
  {
    $sql .= " and ArtikelName like '". addslashes($_POST['searchfield'])."%' ";
  }

  //run query
  $result = $this->conn($sql);

  if (!$result){ die("No results due to database error.<br>".mysql_error());  }

  if (mysql_num_rows($result)==0)
  {
    echo "No Results found!";
  }else{

     echo "<table border='1' class='corner'><th width='332'><a href='product.php'>Back</a></th>";
     echo "<th>Product Result</th>";
     echo "<td width='40' align='center' style=' font-size:16px'><div id='countR'>";
     $this->countResultAll();
     echo "</div></td>";
     echo "</table>";

    // echo '<div style="float:right; font-size:16px">'.$this->countResultAll().'</div>';
    // echo "<div style='float:left; font-size:16px'>Produkt Result</div>";

    echo "<table border='1' class='corner'>"; 

     $i = 1;
    if((mysql_num_rows($result) % 2) == 0){
    $complete = false;
     }else{
    $complete = true;
     }

    while ($rows= mysql_fetch_array($result))
    {

      echo "<td>";
      echo "<ul><li class='addResult'><span class='red'>".$rows['Bauform_d']."<br /><span class='black'>".$rows['ArtikelName']."</span></span><img src='{imag}' alt='' /> <a href='#'>More Info</a> </li></ul>";
      echo "</td>";

   if(($i % 2) == 0){

       echo "</tr><tr>";
    }   

      $i++;
}
if($complete == true){

    echo "<td>&nbsp;</td>";

}     
     echo "</tr></table>";
     echo "<table border='1' class='corner'><th width='332'><a href='product.php'>Back</a> <div></div></th>";
     echo "<th>Product Result</th>";
     echo "<td width='40' align='center' style=' font-size:16px'>";
     $this->countResultAll();
     echo "</td>";
     echo "</table>";

}
}
}

$action = $_GET['action'];

$proFin = new Application();

switch($action) {

        case 'show':
            $proFin->show_form();
        break;

        case 'search':
            $proFin->search();
        break; 

        case 'searchAll':
            $proFin->searchAll();
        break; 

        case 'count':
            $proFin->countResult();
        break; 

        case 'count1':
            print 'hallo';
        break; 

        case 'count2':

            if (!empty($_POST))
{

        var_dump($_POST);
}

        break; 

        case 'count3':
            echo $rows[$field];
        break; 
        } 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-13T20:53:56.193

我已经在 apache 上用 firefox 测试了这个，“empty”被“23”替换。

测试.html

```
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Test ajax</title>
</head>
<script language="javascript">
var xmlHttp

function showCount(str)
{
    xmlHttp=GetXmlHttpObject();
    if (xmlHttp==null)
    {
        alert ("Your browser does not support AJAX!");
        return;
    }
    var url="testajax.php";
    url=url+"?action=count2";
    url=url+"&sid="+Math.random();
    xmlHttp.onreadystatechange=stateChanged;
    xmlHttp.open("POST",url,true);
    xmlHttp.send(null);
}

function stateChanged()
{
    if (xmlHttp.readyState==4)
    {
        document.getElementById("countR").innerHTML=xmlHttp.responseText;
    }
}

function GetXmlHttpObject()
{
    var xmlHttp=null;
    try
    {
        // Firefox, Opera 8.0+, Safari
        xmlHttp=new XMLHttpRequest();
    }
    catch (e)
    {
        // Internet Explorer
        try
        {
            xmlHttp=new ActiveXObject("Msxml2.XMLHTTP");
        }
        catch (e)
        {
            xmlHttp=new ActiveXObject("Microsoft.XMLHTTP");
        }
    }
    return xmlHttp;
}
</script>
<body bgcolor="#FFFFFF" text="#000000" link="#0000FF" vlink="#000080" alink="#FF0000" onload="showCount( 'heelo' )" >
<span id="countR">empty</span>
</body>
</html> 
```

testajax.php

```
<?

if( $_REQUEST[ 'action' ] == 'count2' )
{
    header( 'Content-type: text/xml' );
    echo <<<XMLTOP
<?xml version="1.0" encoding="UTF-8"?>

XMLTOP;
        echo( '<countr>23</countr>' );
}
?> 
```

// 用于 mysql 中的 mysql 行计数，您可以使用它来获取计数并将其作为第一行。

```
$query = "SELECT SQL_CALC_FOUND_ROWS ...";

$result = mysql_query( $query ) or LogFatalError( "Database error: " . mysql_error() );
$count  = mysql_result( mysql_query( 'SELECT FOUND_ROWS()' ), 0, 0 ); 
```

# winforms - 将 ToolStripDropDownButton 的菜单显示为上下文菜单

> ID：547579
> 
> 赞同：0
> 
> 时间：2009-02-13T20:37:21.320
> 
> 标签：winforms

我有一个包含 ToolStripDropDownButton 的工具条。作为另一种访问方法，当用户在工具条下方的区域中单击鼠标右键时，我还希望能够将此按钮的下拉菜单显示为上下文菜单。

我尝试了以下代码，但它不起作用（它在正常位置显示按钮的下拉菜单，直接在按钮下方）：

```
Point contextMenuLocation = [get from WM_CONTEXTMENU]
myButton.DropDown.Show( contextMenuLocation ); 
```

我能想到的最好的办法是将工具条项从按钮的下拉菜单复制到 ContextMenuStrip 中，但我没有看到任何简单的方法来做到这一点（ToolStripItem 没有实现 ICloneable 或 Clone 方法）。工具条项目存储对其父项的引用，因此我不能只将现有项目添加到上下文菜单，因为这会破坏按钮。

有没有人知道如何做到这一点？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-13T21:27:36.630

使用相同项目填充两个不同下拉列表的一种好方法是将项目创建提取到一个函数中，该函数在您打开该下拉列表的任何实例之前构建必要的下拉列表。如果应用程序状态发生变化，这还允许您启用禁用的东西。

```
class A
{
    public A()
    {
        button = new ToolStripDropDownButton();
        button.DropDown = new ToolStripDropDown();

        ToolStripDropDown dropDown = new ToolStripDropDown();
        dropDown.Opening += DropDownOpening;
        menu.Items.DropDown = dropDown;

    }

    void DropDownOpening(object sender, EventArgs e)
    {
        ToolStripDropDown dropDown = sender as ToolStripDropDown;
        if(dropDown != null) 
        {
            dropDown.Items.Clear();
            BuildMenu(dropDown);
        }
        else
        {
            // throw if you like
        }
    }

    void BuildMenu(ToolStripDropDown dropDown)
    {
        // TODO : Add items to dropdown
        // TODO : Take decisions depending on current application state
    }

    ToolStripDropDownButton button;
    MenuStrip menu;
} 
```

# asp.net - 仅当用户输入值时按参数搜索

> ID：547598
> 
> 赞同：0
> 
> 时间：2009-02-13T20:45:14.030
> 
> 标签：asp.net, sql, sql-server

我想重写此查询，以便如果 @UserName 传入一个空值，那么它将 Client_User 排除在搜索条件之外。如果用户在网络表单的用户名文本框中输入名称，我只希望它按名称搜索。我不知道该怎么做。

```
select * from weblogs.dbo.vwlogs 
where Log_time between @BeginDate and @EndDAte 
and  client_user=@UserName 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-13T20:47:24.043

select * from weblogs.dbo.vwlogs where Log_time between @BeginDate and @EndDate and **(@UserName IS NULL OR client_user=@UserName)**

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-13T20:46:43.390

```
select * 
from weblogs.dbo.vwlogs 
where Log_time between @BeginDate and @EndDAte 
  and (client_user=@UserName or @UserName IS null) 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-13T21:27:53.990

Kristen 的解决方案会起作用，但如果您需要性能，请不要这样做，因为该计划将仅针对第一个条件进行缓存。

因此，如果您的过程首先使用 NULL 参数调用，则该查询将被缓存。

如果您需要更高的性能，请使用 IF 语句并创建两个不同的查询。

在更复杂的查询中，事件 sp_execsql 会更快。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-14T08:52:01.587

最好的解决方案是利用 sp_execute_sql。例如：

```
--BEGIN SQL
declare @sql nvarchar(4000)

set @sql = 
'select * from weblogs.dbo.vwlogs 
where Log_time between @BeginDate and @EndDate'
+ case when @UserName is null then '' else 'and client_user = @UserName' end

sp_execute_sql
@sql
, @params = '@UserName varchar(50)'
, @UserName = @UserName
--END SQL 
```

正如 muerte 所提到的，这将带来性能优势。根据 BOL：

当语句的参数值更改是唯一的变化时，可以使用 sp_executesql 代替存储过程多次执行 Transact-SQL 语句。因为 Transact-SQL 语句本身保持不变并且只有参数值发生变化，所以**Microsoft® SQL Server™ 查询优化器可能会重用**它为第一次执行生成的执行计划。

# java - 在我的类路径中选择了 Java 的默认 JAXB 实现

> ID：547599
> 
> 赞同：6
> 
> 时间：2009-02-13T20:45:16.153
> 
> 标签：java, xml, xslt, jaxb, classpath

我编写了一个使用 JAXB 进行 XSL 转换的 Java 应用程序。我在类路径中包含了 saxon9.jar，这样我就可以在命令行上使用 XSLT 2.0 而不是 XSLT 1.0。

```
java -classpath ./lib/saxon9.jar:./ -jar myApp.jar 
```

我在我的 XSL 中包含了代码来报告使用的 XSLT。

```
<xsl:comment><xsl:text >
</xsl:text>XSLT Version: <xsl:value-of select="system-property('xsl:version')" /> <xsl:text >
</xsl:text>XSLT Vendor: <xsl:value-of select="system-property('xsl:vendor')" /> <xsl:text >
</xsl:text>XSLT Vendor URL: <xsl:value-of select="system-property('xsl:vendor-url')" /> <xsl:text >
</xsl:text></xsl:comment> 
```

它报告。

```
XSLT Version: 1.0
XSLT Vendor: Apache Software Foundation (Xalan XSLTC)
XSLT Vendor URL: http://xml.apache.org/xalan-j 
```

这是作为 JVM 一部分的默认实现。

**如何让它使用我指定的撒克逊语？**

* * *

**跟进：**

所以这些方法都不起作用（除了将 saxon jar 放在 endorsed 目录中），但它们都应该起作用。似乎我使用“-jar myApp.jar”和想要替代 XSLT 实现的组合是不兼容的。换句话说...

java -Djavax.xml.transform.TransformerFactory=net.sf.saxon.TransformerFactoryImpl -classpath ./lib/saxon9.jar:./ -jar myApp.jar

...不起作用，但这确实...

java -Djavax.xml.transform.TransformerFactory=net.sf.saxon.TransformerFactoryImpl -classpath ./lib/saxon9.jar:./myApp.jar org.dacracot.myApp

...有趣的是，我什至不必指定工厂，我得到了撒克逊版本...

java -classpath ./lib/saxon9.jar:./myApp.jar org.dacracot.myApp

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-15T01:51:55.817

查看[TransformerFactory.newInstance()](http://java.sun.com/javase/6/docs/api/javax/xml/transform/TransformerFactory.html#newInstance())的 javadoc，了解配置工厂的所有可能方法。

1.  系统属性
2.  库/jaxp.properties
3.  服务配置文件（可能在 saxon JAR，/META-INF/services/javax.xml.transform.TransformerFactory）

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-13T13:26:19.873

The last example you posted(w/o -Djavax...) works because the META-INF/services directory contains a file named

> java.xml.transform.TransformerFactory

with the content

> net.sf.saxon.TransformerFactoryImpl

The reason using

```
java -cp lib/saxon9.jar;myjar.jar 
```

works and

```
java -cp lib/saxon9.jar -jar myjar.jar 
```

doesn't is that using the -jar option tells java(w).exe to ignore the rest of the command line and pull everything (classpath included) from the jar's manifest file. If you put saxon9.jar in your jar manifest's classpath it should work.

```
Manifest-Version: 1.0
Main-Class: net.my.MainClass
Class-Path: lib/saxon9.jar 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-13T20:59:48.897

您是否尝试过将您的 jar 放在[背书](http://java.sun.com/j2se/1.4.2/docs/guide/standards/)目录中？

如果您不希望效果是全局的，请使用以下选项：

```
-Djava.endorsed.dirs=my_dir 
```

在命令行中。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-13T21:40:16.600

此系统属性应设置替换 TransformerFactory：

```
java -Djavax.xml.transform.TransformerFactory=com.foobar.AcmeTransformer MyApp 
```

我相信你想要的工厂类是*net.sf.saxon.TransformerFactoryImpl*

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-13T21:06:36.150

怎么样

```
java -Xbootclasspath:lib/saxon9.jar -classpath . -jar myApp.jar 
```

# algorithm - RAR解压算法

> ID：547601
> 
> 赞同：12
> 
> 时间：2009-02-13T20:45:30.163
> 
> 标签：algorithm, compression, rar

我正在寻找可用于解压缩 RAR 文件的算法的描述。我不需要创建新的档案，只需解压缩现有的档案。

Wotsit.org 有 RAR[文件格式](http://www.wotsit.org/list.asp?al=R)（第 2 版）的描述，但描述中没有描述解压缩算法。

另外，有谁知道 RAR 版本 3 是否对文件格式本身进行了重大更改？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-02-13T20:47:00.253

[您可以在WinRAR 站点](http://www.rarlabs.com/rar_add.htm)获得 UnRAR 的源代码。

# javascript - 这是使用 jQuery 选项卡创建“全部”选项卡的最佳方式吗？

> ID：547602
> 
> 赞同：0
> 
> 时间：2009-02-13T20:45:51.080
> 
> 标签：javascript, jquery-ui

我已经使用 jQuery UI 选项卡创建了一个界面，但是我的要求之一是有一个“全部”选项，该选项可以同时显示选项卡组中所有页面的内容。

我的选项卡是从 PHP 动态生成的，我给每个选项卡按钮一个 id，以便结果如下所示：

```
<li ><a id='tabProjectBrief' href="#section1">Project Brief</a></li>
<li ><a id='tabScorecard' href="#extra1">Scorecard</a></li>
<li ><a id='tabContributions' href="#section2">Contributions</a></li>
<li ><a id='tabOther' href="#section6">Other</a></li>
<li ><a id='tabAll' href="#all">All</a></li> 
```

然后在我的 JavaScript 中，我有以下内容：

```
$(document).ready(function() {
  $('#tabAll').click(function(){

    setTimeout("$('div.tabSection').removeClass('ui-tabs-hide')", 50);
  });
}); 
```

我正在使用setTimeout（），因为选择了选项卡时，jQuery UI在先前选择的选项卡上设置UI-Tab-Hide类，从而从我可以在新选项卡上单击“事件”之后发生的内容。这样，刚刚收到 ui-tabs-hide 类的选项卡也会将其删除。

它似乎工作得很好，但是对我来说感觉有点像黑客，那么有没有更好的方法来做到这一点？谢谢。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-13T20:49:55.533

你的解决方案对我来说似乎很好。`$("div.tab-section").show();`更干净，但会保持类名完整，如果用户在单击“全部”选项卡后选择另一个选项卡，您不希望这样做。

# sql - 如何有效使用 SQL 替换功能？

> ID：547611
> 
> 赞同：2
> 
> 时间：2009-02-13T20:48:04.697
> 
> 标签：sql, tsql, ms-access

我正在尝试替换 Access 数据库中的多行以遵循一组新的数据规则。例如，Fort Myers 中的 Fort 一词被列为 Ft.、Ft 和 Fort。我想对组进行全局更改。我熟悉 SQL 替换命令，但想知道是否有人对存储过程做过类似的事情，或者有过类似的经验。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-13T20:53:57.317

比外行人听起来更难...

没有办法解决它，只能为你不喜欢的每一件事做一个替换，变成你喜欢的。但要非常小心......意想不到的后果和所有。我建议在每次更新之前进行选择，以准确了解您将要更新的内容。

因此，在您的迈尔斯堡实例中，您必须进行 3 次替换：

```
Replace("Ft. Myers", "Fort Myers")
Replace("Ft Myers", "Fort Myers")
Replace("Fort. Myers", "Fort Myers") 
```

如果你有很多数据和很多东西要改变，这可能是一项艰巨的任务。但是没有“自动化”的方式来做到这一点——SQL 不使用模糊逻辑，你必须准确地指定你想要它做的一切。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-13T20:54:33.480

整理地址可能是一场噩梦。您可能需要创建一个替换表：

```
ShouldBe    Current
Fort Myers  Ft Myers
Foot Hill   Ft Hills 
```

在大多数情况下，ShouldBe 列可以填充更新查询，但您也可以在更新主表之前查看结果。这也将有利于未来的数据输入。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-13T20:57:52.457

你必须**非常非常小心**，不要更换超过你想要的东西。

**万一出现严重错误，请先进行备份。**

始终以 SELECT 开头以首先过滤记录。仔细检查结果。

```
SELECT * FROM Table WHERE City LIKE "%Ft. Myers%" 
```

然后按照卡尔顿所说的进行替换。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-13T21:19:13.873

如果您的目标是标准化类似于 ~Fort Myers 的城市名称，您应该能够执行以下操作：

```
UPDATE Table SET City = 'Fort Myers' WHERE City LIKE 'F%Myers'; 
```

这应该替换任何行中的任何 City 字段，其中 City 以 F 开头并以 Myers 结尾。这可能是您想要的，但要非常小心。

# java - 在Java中计算树中的节点

> ID：547622
> 
> 赞同：21
> 
> 时间：2009-02-13T20:50:39.167
> 
> 标签：java, recursion, tree

首先，我发誓这不是作业，这是我在一次采访中被问到的一个问题。我想我把它弄得一团糟（尽管我确实意识到解决方案需要递归）。这是问题：

实现 count() 方法，该方法返回树中的节点数。如果一个节点既没有左孩子也没有右孩子，相关的`getXXChild()`方法将返回`null`

```
class Tree {

  Tree getRightChild() {
    // Assume this is already implemented
  }

  Tree getLeftChild() {
    // Assume this is already implemented
  }

  int count() {
    // Implement me
  }
} 
```

我问这个问题的原因只是想看看正确的解决方案，从而衡量我的问题有多糟糕。

干杯，托尼

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2009-02-13T20:55:28.063

```
int count() {
  Tree right = getRightChild();
  Tree left = getLeftChild();
  int c = 1;                                      // count yourself!
  if ( right != null ) c += right.count();        // count sub trees
  if ( left != null ) c += left.count();          // ..
  return c;
} 
```

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2009-02-13T20:54:46.833

一个简单的递归解决方案：

```
int count() {
   Tree l = getLeftTree();
   Tree r = getRightTree();
   return 1 + (l != null ? l.count() : 0) + (r != null ? r.count() : 0);
} 
```

一个不那么简单的非递归的：

```
int count() {
    Stack<Tree> s = new Stack<Tree>();
    s.push(this);
    int cnt = 0;
    while (!s.empty()) {
        Tree t = s.pop();
        cnt++;
        Tree ch = getLeftTree();
        if (ch != null) s.push(ch); 
        ch = getRightTree();
        if (ch != null) s.push(ch); 
    }
    return cnt;
} 
```

后者可能更节省内存，因为它用堆栈和迭代代替了递归。它也可能更快，但如果没有测量就很难判断。一个关键的区别是递归解决方案使用堆栈，而非递归解决方案使用堆来存储节点。

**编辑：**这是迭代解决方案的一个变体，它较少使用堆栈：

```
int count() {
    Tree t = this;
    Stack<Tree> s = new Stack<Tree>();
    int cnt = 0;
    do {
        cnt++;
        Tree l = t.getLeftTree();
        Tree r = t.getRightTree();
        if (l != null) {
            t = l;
            if (r != null) s.push(r);
        } else if (r != null) {
            t = r;
        } else {
            t = s.empty() ? null : s.pop();
        }
    } while (t != null);
    return cnt;
} 
```

您是否需要更高效或更优雅的解决方案自然取决于您的树的大小以及您打算使用此例程的频率。记住 Hoare 所说的：“过早的优化是万恶之源。”

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2009-02-13T21:16:19.433

我更喜欢这个，因为它写着：

*左返回计数 + 右计数 + 1*

```
 int count() {
      return  countFor( getLeftChild() ) + countFor( getRightChild() ) + 1;
  }
  private int countFor( Tree tree )  { 
       return tree == null ? 0 : tree.count();
  } 
```

更倾向于文学编程。

顺便说一句，我不喜欢 Java 上如此常用的 getter/setter 约定，我认为使用*leftChild()*会更好：

```
 return countFor( leftChild() ) + countFor( rightChild() ) + 1; 
```

就像 Hoshua Bloch 在这里解释的那样[http://www.youtube.com/watch?v=aAb7hSCtvGw](http://www.youtube.com/watch?v=aAb7hSCtvGw) at min。32:03

> *如果你得到它rigth你的代码读取......*

但是，我不得不承认 get/set 约定现在几乎是语言的一部分。:)

对于许多其他部分，遵循此策略会创建自记录代码，这是一件好事。

托尼：我想知道，你在采访中的回答是什么。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-02-13T20:55:04.100

像这样的东西应该工作：

```
int count()
{
    int left = getLeftChild() == null ? 0 : getLeftChild().count();
    int right = getRightChild() == null ? 0 : getRightCHild().count();

    return left + right + 1;
} 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-02-13T20:55:56.173

```
return (getRightChild() == null ? 0 : getRightChild.count()) + (getLeftChild() == null ? 0 : getLeftChild.count()) + 1; 
```

或类似的东西。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-02-14T00:44:12.227

```
class Tree {

  Tree getRightChild() {
    // Assume this is already implemented
  }

  Tree getLeftChild() {
    // Assume this is already implemented
  }

  int count() {
   return 1 
      + getRightChild() == null? 0 : getRightChild().count()
      + getLeftChild() == null? 0 : getLeftChild().count();
  }
} 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-02-13T20:57:29.463

[您可以通过多种方式](http://en.wikipedia.org/wiki/Tree_traversal)遍历这棵树。简单地预先遍历，代码将是（基于您定义的函数）：

```
int count() {
    count = 1;
    if (this.getLeftChild() != null)
        count += this.getLeftChild().count();
    if (this.getRightChild() != null)
        count += this.getRightChild().count();
    return count;
} 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2011-12-09T08:31:24.690

实现方法：

```
public static int countOneChild(Node root)
{
    ...
} 
```

它计算具有一个孩子的二叉树中的内部节点的数量。将功能添加到`tree.java`程序中。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2017-06-02T19:58:16.327

我是通过前序递归做到的。虽然它并不完全遵循使用 localRoot 的采访格式，但我想你明白了。

```
private int countNodes(Node<E> localRoot, int count) {
    if (localRoot == null) 
        return count;     
    count++; // Visit root
    count = countNodes(localRoot.left, count); // Preorder-traverse (left)
    count = countNodes(localRoot.right, count); // Preorder-traverse (right)
    return count;
}

public int countNodes() {
   return countNodes(root, 0);
} 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-02-13T20:55:12.993

这是一个标准的递归问题：

```
count():
    cnt = 1 // this node
    if (haveRight) cnt += right.count
    if (haveLeft)  cnt += left.count
return cnt; 
```

非常低效，如果树很深，这是一个杀手，但这对你来说是递归......

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-02-13T20:58:59.927

```
int count()

{
   int retval = 1;
    if(null != getRightChild()) retval+=getRightChild().count();
    if(null != getLeftChild()) retval+=getLeftChild().count();
    return retval;

} 
```

上帝，我希望我没有犯错。

编辑：我确实做到了。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2010-08-05T19:13:53.030

我的第一次尝试没有添加任何新内容，但后来我开始怀疑递归深度以及是否可以重新排列代码以利用最新 Java 编译器的尾调用优化功能。主要问题是空测试 - 可以使用 NullObject 解决。我不确定 TCO 是否可以处理这两个递归调用，但它至少应该优化最后一个。

```
static class NullNode extends Tree {

    private static final Tree s_instance = new NullNode();

    static Tree instance() {
        return s_instance;
    }

    @Override
    Tree getRightChild() {  
        return null;
    }  

    @Override
    Tree getLeftChild() {  
        return null;
    }  

    int count() {  
        return 0;
    }
}

int count() {      
    Tree right = getRightChild();      
    Tree left  = getLeftChild();      

    if ( right == null ) { right = NullNode.instance(); }
    if ( left  == null ) { left  = NullNode.instance(); }

    return 1 + right.count() + left.count();
} 
```

NullNode 的精确实现取决于 Tree 中使用的实现——如果 Tree 使用 NullNode 而不是 null，那么子访问方法可能应该抛出 NullPointerException 而不是返回 null。无论如何，主要思想是使用 NullObject 以尝试从 TCO 中受益。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-02-13T22:13:55.457

当然，如果您想在计数时避免访问树中的每个节点，并且处理时间对您来说比内存更有价值，您可以通过在构建树时创建计数来作弊。

1.  在每个节点中都有一个 int 计数，初始化为 1，它表示以该节点为根的子树中的节点数。

2.  插入节点时，在从递归插入例程返回之前，增加当前节点的计数。

IE

```
public void insert(Node root, Node newNode) {
  if (newNode.compareTo(root) > 1) {
    if (root.right != null) 
      insert(root.right, newNode);
    else
      root.right = newNode;
  } else {
    if (root.left != null)
      insert(root.left, newNode);
    else
      root.left = newNode;
  }
  root.count++;
} 
```

然后从任何点获取计数只涉及查找 node.count

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2011-12-09T12:17:42.473

在面试中应该预料到与二叉树有关的问题。我会说在下一次面试之前花点时间浏览[这个](http://cslibrary.stanford.edu/110/BinaryTrees.html)链接。解决了大约14个问题。您可以看看解决方案是如何完成的。这将使您了解将来如何解决二叉树的问题。

我知道您的问题特定于 count 方法。这也在我提供的链接中实现

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2016-04-06T05:34:53.050

```
class Tree {

  Tree getRightChild() {
    // Assume this is already implemented
  }

Tree getLeftChild() {
    // Assume this is already implemented
 }

 int count() {
    if(this.getLeftChild() !=null && this.getRightChild()!=null) 
        return 1 + this.getLeftChild().count() + this.getRightChild().count();
    elseif(this.getLeftChild() !=null && this.getRightChild()==null)
        return 1 + this.getLeftChild().count();
    elseif(this.getLeftChild() ==null && this.getRightChild()!=null)
        return 1 + this.getRightChild().count();
    else return 1;//left & right sub trees are null ==> count the root node
  }
} 
```

# asp.net - asp.net：防止生成服务器控制 ID

> ID：547625
> 
> 赞同：1
> 
> 时间：2009-02-13T20:52:17.417
> 
> 标签：asp.net, html, controls, standards

### 问题

使用asp.net服务器控件时，会自动生成如下的id属性。

```
<img id="ctl00_body_ULRepeater_ctl01_LIRepeater_ctl00_PartImg" src="img.png" /> 
```

虽然我一般不反对 id 属性，但我尽量避免使用这些不必要的冗长类型的名称，并使用简洁、描述性的名称。

### 问题

我可以阻止 asp.net 生成这些 id 属性吗？它们看起来很糟糕，如果我用转发器或其他东西生成很多项目，它们实际上会增加很多页面重量。我该如何摆脱它们？

### 笔记

我在 Visual Studio 2008 中使用 asp.net 3.0。

### [更新]

好的，所以我可以子类化（ClientID 被声明为可覆盖），但这真的不好玩。我可以*在任何地方*使用文字控件。或者，我可以咬紧牙关，忍受几乎没有任何东西的页面渲染缓慢**。**

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-13T20:56:55.283

我相信 asp.net 4.0 的功能之一将是能够更好地控制生成的 ID。现在，您将获得任何服务器生成控件的名称修饰。这就是允许 asp.net 保证控件 ID 的唯一性的原因。

您始终可以使用直接的 HTML 标记（不要 runat=server）来避免此问题。不过，您会牺牲易用性来换取更轻量级的页面。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-11-02T14:36:34.857

您可以通过在运行时将每个控件的 Id 属性设置为 null 来完全隐藏这些 id 属性，例如

```
Private Sub repeNewsletters_ItemDataBound(ByVal sender As Object, ByVal e As System.Web.UI.WebControls.RepeaterItemEventArgs) Handles repeNewsletters.ItemDataBound

    If e.Item.DataItem Is Nothing Then
        Return
    End If

    Dim hlDetails = DirectCast(e.Item.FindControl("hlDetails"), System.Web.UI.WebControls.HyperLink)

    hlDetails.ID = Nothing 
```

结束子

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-13T21:00:24.947

截至目前，ControlID 是只读属性。在即将发布的 ASP.NET Web 窗体（带有 .NET 4.0）中，这将是一个使用多种不同方法（如静态、继承等）的可设置属性

# sql-server - SQL IN 的 SSIS/VB.NET 等效项（匿名 array.Contains()）

> ID：547629
> 
> 赞同：0
> 
> 时间：2009-02-13T20:52:57.197
> 
> 标签：sql-server, vb.net, ssis

我有一些 SQL 可以对 GL 帐号和成本中心的组合执行复杂的逻辑，如下所示：

```
WHEN (@IntGLAcct In (
    882001, 882025, 83000154, 83000155, 83000120, 83000130, 
    83000140, 83000157, 83000010, 83000159, 83000160, 83000161,
83000162, 83000011, 83000166, 83000168, 83000169, 82504000, 
82504003, 82504005, 82504008, 82504029, 82530003, 82530004,
83000000, 83000100, 83000101, 83000102, 83000103, 83000104, 
83000105, 83000106, 83000107, 83000108, 83000109, 83000110, 
83000111, 83000112, 83000113, 83100005, 83100010, 83100015, 
82518001, 82552004, 884424,   82550072, 82552000, 82552001, 
82552002, 82552003, 82552005, 82552012, 82552015, 884433,   
884450,   884501,   82504025, 82508010, 82508011, 82508012,
83016003, 82552014, 81000021, 80002222, 82506001, 82506005, 
82532001, 82550000, 82500009, 82532000)) 
```

总的来说，整个事情在 UDF 中表现不佳，特别是当它全部嵌套并且步骤的顺序很重要等时。我还不能使它成为表驱动的，因为业务逻辑非常复杂。

因此，我正在做一些探索性的工作，将其移入 SSIS，以了解以不同的方式进行操作。然而，在我的脚本任务中，我必须使用 VB.NET，所以我正在寻找一种替代方法：

```
Select Case IntGLAcct = 882001 OR IntGLAcct = 882025 OR ... 
```

这显然要冗长得多，并且会使移植过程变得非常困难。

即使是类似的东西`({90605, 90607, 90610} AS List(Of Integer)).Contains(IntGLAcct)`也更容易移植，但我无法让初始化程序给我一个这样的匿名数组。而且这些小收藏有很多，我不确定我是否可以提前创建它们。

它真的需要在一个地方。业务会定期更改此逻辑。我的策略是使用 udf 来镜像他们旧的“包含”文件，但性能一直很差。现在每个函数只需要 2 或 3 个参数。事实证明，在现有系统的一个黑暗角落，他们实际上构建了一个包含所有这些结果的数百万行表——即使预先计算的表使用得不多。

所以我的新实验是（因为我仍在构建大型交叉连接表以协调该部分过程）继续使用表而不是代码，但继续在 SSIS 阶段填充此表而不是调用 udf 1200 万次 - 因为我的 udf 版本基本上在合理的时间范围内停止工作，而 DBA 现在没有太大帮助。然而，我知道 SSIS 可以非常有效地处理这些行 - 因为每个月我都会在几分钟内从遗留系统中带来数十个数百万行表的已知良好结果，并运行查询以确认与新版本没有差异.

SSIS 代码理论上会成为业务逻辑的守护者，而高效的表将由此构建（基于所有已知的参数组合）。当然，如果我可以将逻辑简化为一个真正的逻辑表，那将是最终的设计——但目前还不能真正预见。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-13T21:11:08.790

试试这个：

```
Array.IndexOf(New Integer() {90605, 90607, 90610}, IntGLAcct) >-1 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-13T21:06:07.007

如果您对传入的数据集使用条件拆分转换，然后使用表达式或类似的东西（我不确定您的 GL 帐户是否是固定的，或者您是否要动态传递它们）来应用于结果怎么办？然后，您可以从中获取结果数据并根据需要进行处理。

# c# - HttpUtility.HtmlEncode 不会对所有内容进行编码

> ID：547634
> 
> 赞同：17
> 
> 时间：2009-02-13T20:53:59.410
> 
> 标签：c#, html, encoding, utf-8

我正在使用 C# 和 .Net 3.5 中的桌面客户端程序与 Web 服务器交互。我正在使用 Fiddler 来查看 Web 浏览器发送的流量，并对其进行模拟。遗憾的是，这台服务器很旧，并且对字符集和 utf-8 的概念有些困惑。大多数情况下它使用Latin-1。

当我在包含“特殊”字符的 Web 浏览器中输入数据时，例如“Ω π ℵ ∞ ♣ ♥ ♈ ♉ ♊ ♋ ♌ ♍ ♎ ♏ ♐ ♑ ♒ ♓”提琴手告诉我它们从浏览器到服务器的传输方式如下：`"&#9800; &#9801; &#9802; &#9803; &#9804; &#9805; &#9806; &#9807; &#9808; &#9809; &#9810; &#9811; "`

但是对于我的客户，HttpUtility.HtmlEncode 不会转换这些字符，而是保持原样。我需要调用什么来将“♈”转换为 ♈ 等等？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-02-13T21:02:52.587

Rich Strahl 刚刚发布了一篇博客文章，[没有 System.Web 的 Html 和 Uri 字符串编码](http://west-wind.com/weblog/posts/617930.aspx)，其中他有一些自定义代码也可以对字符的上限进行编码。

```
/// <summary>
/// HTML-encodes a string and returns the encoded string.
/// </summary>
/// <param name="text">The text string to encode. </param>
/// <returns>The HTML-encoded text.</returns>
public static string HtmlEncode(string text)
{
    if (text == null)
        return null;

    StringBuilder sb = new StringBuilder(text.Length);

    int len = text.Length;
    for (int i = 0; i < len; i++)
    {
        switch (text[i])
        {

            case '<':
                sb.Append("&lt;");
                break;
            case '>':
                sb.Append("&gt;");
                break;
            case '"':
                sb.Append("&quot;");
                break;
            case '&':
                sb.Append("&amp;");
                break;
            default:
                if (text[i] > 159)
                {
                    // decimal numeric entity
                    sb.Append("&#");
                    sb.Append(((int)text[i]).ToString(CultureInfo.InvariantCulture));
                    sb.Append(";");
                }
                else
                    sb.Append(text[i]);
                break;
        }
    }
    return sb.ToString();
} 
```

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-02-13T21:05:13.967

HtmlEncode 的返回值类型是一个字符串，它是 Unicode 的，因此不需要对这些字符进行编码。

如果您的输出流的编码与这些字符不兼容，则使用 HtmlEncode，如下所示：-

```
 HttpUtility.HtmlEncode(outgoingString, Response.Output); 
```

HtmlEncode 然后适当地转义字符。

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2009-02-13T21:08:36.487

这似乎非常低效，但我能想到的唯一方法是查看每个字符：

```
public static string MyHtmlEncode(string value)
{
   // call the normal HtmlEncode first
   char[] chars = HttpUtility.HtmlEncode(value).ToCharArray();
   StringBuilder encodedValue = new StringBuilder();
   foreach(char c in chars)
   {
      if ((int)c > 127) // above normal ASCII
         encodedValue.Append("&#" + (int)c + ";");
      else
         encodedValue.Append(c);
   }
   return encodedValue.ToString();
} 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2011-04-14T01:13:48.597

Microsoft 的 AntiXSS 库正确编码了这些字符。

[Codeplex 上的 AntiXSS](http://wpl.codeplex.com/)

[Nuget 包](http://nuget.org/List/Packages/AntiXSS)（添加为参考的最佳方式）

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2010-05-23T04:09:40.997

似乎 HtmlEncode 仅用于编码放入 HTML 文档的字符串，其中只有 / < > & 等会导致问题。对于 URL，只需将 HtmlEncode 替换为 UrlEncode。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2011-06-11T22:41:18.783

*上面的@bdukes 响应将完成这项工作，但如果我们假设大多数字符不会*在此范围内，我们可以让它更快。注意引用的“Ā”（unicode 0x0100）

```
/// <summary>.Net 2.0's HttpUtility.HtmlEncode will not properly encode
/// Unicode characters above 0xFF.  This may be fixed in newer 
/// versions.</summary>
public static string HtmlEncode(string s)
{
    // Let .Net 2.0 get right what it gets right.
    s = HttpUtility.HtmlEncode(s);

    // Search for first non-ASCII.  Hopefully none and we can just 
    // return s.
    int num = IndexOfHighChar(s, 0);
    if (num == -1)
        return s;
    int old_num = 0;
    StringBuilder sb = new StringBuilder();
    do {
        sb.Append(s, old_num, num - old_num);
        sb.Append("&#");
        sb.Append(((int)s[num]).ToString(NumberFormatInfo.InvariantInfo));
        sb.Append(';');
        old_num = num + 1;
        num = IndexOfHighChar(s, old_num);
    } while (num != -1);
    sb.Append(s, old_num, s.Length - old_num);
    return sb.ToString();
}

static unsafe int IndexOfHighChar(string s, int start)
{
    int num = s.Length - start;
    fixed (char* str = s) {
        char* chPtr = str + start;
        while (num > 0) {
            char ch = chPtr[0];
            if (ch >= 'Ā')
                return s.Length - num;
            chPtr++;
            num--;
        }
    }
    return -1;
} 
```

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2016-05-20T17:49:36.173

您始终可以按如下方式替换不需要的 ASCII：如果在没有 if 语句的情况下对其进行编码，则结果字符串为“这意味着我在哭 :'&'#39;) 无论出于何种原因，都会处理“特殊字符”并将其替换为 HTML 字符.

```
string text = "This means I am crying :'(";

string encoded = HttpUtility.HtmlEncode(text);
if(encoded.Contains("&#39;"))
{
    encoded = encoded.Replace("&#39;", "'");
} 
```

# c++ - 用 C++ 解析海量数据

> ID：547654
> 
> 赞同：1
> 
> 时间：2009-02-13T20:59:46.570
> 
> 标签：c++, design-patterns, qt, architecture, parsing

在我的工作中，我需要解析来自不同数据源的不同类型的数据文件。有时我通过直接编写 c++ 代码（在 qt 和 boost:D 的帮助下）来解析它们，有时使用辅助程序手动进行。我必须指出，数据类型彼此如此不同，很难为所有数据类型创建通用接口。但我想以更通用的方式完成这项工作。我计划编写一个库来转换它们，并且将来添加新的解析器实用程序应该很容易。我还计划在我的程序中使用其他帮助程序，而不是手动。我的问题是你建议什么样的架构或模式，基本条件是库必须可以通过新类或 dll 进行扩展，并且还可以配置。顺便说一句，数据可以是文本，

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-13T21:08:25.613

不要吹我自己的小号，但我的小型开源实用程序**CSVfix**具有可扩展的体系结构，该体系结构基于派生具有非常简单的接口的新 C++ 类。我确实考虑过使用带有 DLL 的插件架构，但对于这样一个简单的实用程序来说，这似乎有点矫枉过正。[如果有兴趣，您可以在此处](http://code.google.com/p/csvfix/)获取二进制文件和源代码。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-13T21:15:18.733

我建议使用 3 部分模型，其中常见的数据格式是一个字符串，它应该能够包含每个值：

*   阅读器：在这一层中，使用某种文件格式描述符从源（即 CSV 文件）读取值。然后将这些值存储在某种中间数据结构中。
*   连接器/转换器：该层负责将读取器数据映射到写入器字段。
*   Writer：这一层负责将特定的数据结构写入目标（即另一种文件格式或数据库）。

这样您就可以为不同的输入文件编写不同的阅读器。

我认为最困难的部分是创建中间存储格式/结构的定义，以使其具有前瞻性和灵活性。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-13T21:20:04.603

我用于在数据文件读/写类中定义数据结构的一种方法是使用`std::map<std::string, std::vector<std::string>, string_compare>`其中键是变量名而字符串向量是数据的地方。虽然这在内存中很昂贵，但它并没有将我锁定为仅数字数据。而且，这种方法允许在同一个文件中使用不同长度的数据。

我让基类实现了这种通用存储，而派生类实现了读取器/写入器功能。然后，我使用工厂来获取所需的处理程序，使用确定文件格式的另一个类。

# asp.net - ASP.net：更改默认 web 控件属性

> ID：547658
> 
> 赞同：0
> 
> 时间：2009-02-13T20:59:59.923
> 
> 标签：asp.net, css, default

再会，

在 Visual Studio 2005 中，当我在设计器中放置一个 web 控件时，我必须手动设置 CssClass 属性。有没有办法自动设置该属性？问题是，90% 的时间，我想将 css 应用于我的控件，但并非总是如此，所以我不能真正在 html head 中使用 css 样式。我想过为每个 web 控件创建自己的用户控件，但这对我来说似乎有点过分了。

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-13T21:13:31.157

我认为实现此目的的另一种方法（并且因为它们被应用 90% 的时间）是将它们应用为您的 css 文件中的默认值：

即一个按钮

```
#page input { color: #454545; border: 1px solid #cccccc; width: 98%; } 
```

然后只将 CssClass 设置为您不想要的

```
.RandomButton { } 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-13T21:06:05.120

看看名字可笑但仍在改进的[CSS 友好适配器](http://www.asp.net/CssAdapters/)

开箱即用，它们是立即升级，深入研究它们的工作方式是关于如何进一步改进它们以满足您的需求的教育。

# hibernate - 使用 Hibernate 实现无事务

> ID：547662
> 
> 赞同：0
> 
> 时间：2009-02-13T21:01:56.627
> 
> 标签：hibernate, transactions

有没有办法选择 Hibernate 将与事务包装的更新？受到 EBay 尽可能做到无事务的驱动的启发，我知道我的应用程序中有许多不需要 ACID 写入的更新。例如，有一个更新由一个用户 ID 和另一个表的 ID 组成。只有一个用户可以插入这条记录，我知道它不需要是一个事务。那么，如何禁用这一插入或插入到这一表的事务？

编辑：

好吧，鉴于我的基础数据库是 mysql - 看起来我必须逐表选择。任何不需要事务的表都可以设置为 myisam 而不是 innodb。啊，好吧，不是我要找的答案。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-13T21:06:53.277

请参阅：[休眠 Tx 文档](http://www.hibernate.org/42.html)

一般的答案是这取决于你如何调用休眠。上面的文档准确地解释了如何通过 Hibernate API 控制事务边界。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-13T21:09:35.643

我对Hibernate一无所知，但我的想法是：

如果您没有显式地开始交易/提交，那么它会做的事情（除非您打开了隐式交易）。

如果每页（工作单元）只有一个 INSERT / UPDATE，那么该页本质上是 ACID，因此您是否启动和显式事务并不重要。

但是，将整个页面的 DB 事务限定为范围的隐式事务将确保如果您在将来添加某些内容，而忘记了该页面没有隐式事务，那么您可以避免自己！

# c# - 异常处理应用程序块（Ent Lib 4.1）的两个HandleException（）方法之间的本质区别是什么

> ID：547665
> 
> 赞同：0
> 
> 时间：2009-02-13T21:03:52.067
> 
> 标签：c#, .net, exception, exception-handling, enterprise-library

在 Microsoft 企业库的异常处理应用程序块的最新版本（4.1，2008 年 10 月发布）中，有两个 HandleException() 方法签名，我对这些的意图有点迷茫，特别是因为文档和智能感知都没有，QuickStart 应用程序也没有任何有意义的区别。

这是两个签名：

```
bool HandleException(Exception exceptionToHandle, string policyName);

bool HandleException(Exception exceptionToHandle, string policyName, out Exception exceptionToThrow); 
```

我发现的所有示例都使用第一个，如本示例中直接从 XML 文档中对实际方法的注释中得出的：

```
try
{
   Foo();
}
catch (Exception e)
{
   if (ExceptionPolicy.HandleException(e, name)) throw;
} 
```

在这里，来自同一来源（该方法的 XML 文档注释）是使用第二个的示例：

```
try
{
   Foo();
}
catch (Exception e)
{
   Exception exceptionToThrow;
   if (ExceptionPolicy.HandleException(e, name, out exceptionToThrow))
   {
      if(exceptionToThrow == null)
         throw;
      else
         throw exceptionToThrow;
   }
} 
```

所以，我的问题是，使用第二个给你什么，而第一个没有？这对我来说应该是显而易见的，但我今天的脑袋一团糟，我真的不想再把头撞在众所周知的墙上了。:)

请不要猜测；我希望听到有人从使用它的经验中真正知道他们在说什么。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-03T11:10:15.783

如果您在企业库配置中使用替换处理程序，则您的替换异常将通过第二个签名返回 .. ，输出 Exception exceptionToThrow)。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-11-18T04:51:49.860

两种方法重载的主要区别在于

```
bool HandleException(Exception exceptionToHandle, string policyName); 
```

如果 PostHandlingAction 设置为 ThrowNewException，则会抛出异常。

而第二种方法重载：

```
bool HandleException(Exception exceptionToHandle, string policyName, out Exception exceptionToThrow); 
```

在这种情况下不会抛出异常，而是返回异常作为输出参数重新抛出。

实际上，两个调用调用相同的核心代码，但第二个方法重载捕获抛出的异常并将其返回给调用者。

So the second overload gives you a bit more control since you could perform some additional logic before throwing. It also standardizes the API in the sense that if you use the second HandleException method with the out parameter Enterprise Library will never intentionally handle your exception and throw it for you. i.e. The first method sometimes throws and sometimes relies on you to rethrow (in the case of NotifyRethrow) but the second method always returns and lets the caller throw/rethrow.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-07-08T07:44:56.093

我相信您不允许跨 WCF 服务边界抛出原始异常，这是一项安全功能（真正确保敏感的错误信息不会通过服务链传播）。因此，可以通过第二个参数 out Exception exceptionToThrow 创建和传入一个新的执行，并通过您的配置（企业库替换异常）给出特定的异常消息和类型。其中一个例子是：

```
 try
            {
                throw new InvalidCastException();
            }
            catch (InvalidCastException ex)
            {
                Exception ex1;
                bool rethrow = ExceptionPolicy.HandleException(ex, "ReplacePolicy1", out ex1);

                if (rethrow)
                {
                    throw new FaultException<ApplicationException>((ApplicationException)ex1, ex1.Message);
                }
            } 
```

抛出一个 FaultException（在 WCF 操作上设置了一个错误协定）可防止 WCF 服务在您的调用应用程序/服务中报告错误状态错误消息。

如果没有第二个签名，我将在 WCF 服务边界之间进行错误简化/传播。

谢谢，保罗。（修改代码 8/7/09 - John 的更正评论，谢谢）

# c# - 为什么我们的 c# 图形代码不再工作了？

> ID：547668
> 
> 赞同：4
> 
> 时间：2009-02-13T21:04:42.660
> 
> 标签：c#, operators

情况如下：

我们有一些通用图形代码用于我们的一个项目。在对代码进行了一些清理之后，似乎有些东西不再起作用（图形输出看起来完全错误）。

我对给出正确输出的最后一个代码版本进行了比较，看起来我们改变了我们的一个函数，如下所示：

```
static public Rectangle FitRectangleOld(Rectangle rect, Size targetSize)
{
    if (rect.Width <= 0 || rect.Height <= 0)
    {
        rect.Width = targetSize.Width;
        rect.Height = targetSize.Height;
    }
    else if (targetSize.Width * rect.Height > 
        rect.Width * targetSize.Height)
    {
        rect.Width = rect.Width * targetSize.Height / rect.Height;
        rect.Height = targetSize.Height;
    }
    else
    {
        rect.Height = rect.Height * targetSize.Width / rect.Width;
        rect.Width = targetSize.Width;
    }

    return rect;
} 
```

到

```
static public Rectangle FitRectangle(Rectangle rect, Size targetSize)
{
    if (rect.Width <= 0 || rect.Height <= 0)
    {
        rect.Width = targetSize.Width;
        rect.Height = targetSize.Height;
    }
    else if (targetSize.Width * rect.Height > 
             rect.Width * targetSize.Height)
    {
        rect.Width *= targetSize.Height / rect.Height;
        rect.Height = targetSize.Height;
    }
    else
    {
        rect.Height *= targetSize.Width / rect.Width;
        rect.Width = targetSize.Width;
    }

    return rect;
} 
```

我们所有的单元测试都通过了，除了一些语法快捷方式之外，代码中没有任何变化。但就像我说的，输出是错误的。我们可能只是恢复到旧代码，但我很好奇是否有人知道这里发生了什么。

谢谢。

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-02-13T21:07:04.493

听起来你没有足够的单元测试：]

不幸的是，你的陈述

“除了一些语法快捷方式外，代码中没有任何变化”

错了，我猜这就是你的问题所在。（这当然是你的问题之一！）

是的，

```
a *= b; 
```

相当于

```
a = a * b; 
```

但

```
a *= b / c; 
```

不一样

```
a = a * b / c; 
```

反而

```
a *= b / c;    // equivalent to a = a * (b / c)
a = a * b / c; // equivalent to a = (a * b) / c 
```

（参见msdn 上的[c# 运算符优先级）](http://msdn.microsoft.com/en-us/library/aa691323(VS.71).aspx)

我猜当您的目标高度不是原始矩形高度的精确倍数（或宽度相同）时，您会遇到麻烦。

那么你最终会遇到以下这种情况：

假设 rect.Size = (8, 20), targetSize = (15, 25)

使用您的原始方法，您将得出以下计算：

```
rect.Width     = rect.Width * targetSize.Height / rect.Height;
//             = 8          * 25                / 20
//             = 200 / 20 (multiplication happens first)
//             = 10
// rect.Width  = 10 
```

使用您的新代码，您将拥有

```
rect.Width    *= targetSize.Height / rect.Height;
//            *= 25 / 20
//            *= 1 (it's integer division!)
// rect.Width  = rect.Width * 1
//             = 8
// rect.Width  = 8 
```

这是不一样的。（如果目标大小小于原始大小，情况会更糟；在这种情况下，整数除法将导致其中一个维度为 0！）

如果“[你的]单元测试都通过了”那么你肯定需要一些额外的测试，特别是那些处理非整数倍数的测试。

另请注意，您的计算

```
else if(targetSize.Width * rect.Height > 
        rect.Width * targetSize.Height) 
```

不可靠；对于非常大的矩形，它有可能溢出并给你不正确的结果。作为乘法的一部分，您最好转换为更大的类型（即长）。（同样，应该有一些单元测试来达到这个效果）

希望有帮助！

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-02-13T21:08:14.490

如果 Rectangle.Width 和 Rectangle.Height 是整数，则以下两行不同：

```
rect.Width = rect.Width * targetSize.Height / rect.Height;
rect.Width *= targetSize.Height / rect.Height; 
```

第一行按顺序执行乘法、除法、强制转换为整数，然后是赋值。第二个执行除法，强制转换为整数，乘法，然后赋值。问题是，在您的非工作代码中，**您的 divide 在 multiply 之前被转换为整数**。

保留原始代码或强制除法为浮点。

编写更好的单元测试来检查这个问题。（尝试没有偶数倍数的宽度/高度组合（例如素数）。）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-13T21:11:17.010

添加到 Daniel L 的答案。

这种“优化”的意义何在？有更好的方法来清理此代码，并使其更具可读性。

# sql-server - 长查询防止插入

> ID：547670
> 
> 赞同：2
> 
> 时间：2009-02-13T21:05:44.653
> 
> 标签：sql-server, sql-server-2005

我有一个查询，每晚在一张有一堆记录（200,000+）的桌子上运行。此应用程序仅对结果进行迭代（如果相关，则在 C# 应用程序中使用 DbDataReader）并处理每个结果。处理完全在数据库之外完成。在应用程序迭代结果期间，我无法将任何记录插入到我正在查询的表中。插入语句只是挂起并最终超时。插入是在完全独立的应用程序中完成的。

SQL Server 是否在查询完成时锁定表？这似乎是一个过于激进的锁定策略。我可以理解查询和新插入的记录之间如何存在冲突，但是如果在查询开始后插入的记录根本不包含在结果中，我会完全没问题。

有什么办法可以避免这种情况？

更新：
WITH (NOLOCK) 确实成功了。正如你们中的一些人指出的那样，这不是最干净的方法。考虑到记录的数量，我无法真正将所有内容都查询到内存中，并且该表中的某些列是二进制的（某些记录实际上是大约 1MB 的总数据）。

另一个建议是一次查询成批的记录。这也不是一个坏主意，但它确实带来了一个新问题：独立于数据库的查询。现在，该应用程序可以与各种不同的数据库（Oracle、MySQL、Access 等）一起使用。每个数据库都有自己的方式来限制查询中返回的行。但也许这更好地保存另一个问题？

回到主题，“WITH (NOLOCK)”子句肯定是特定于 SQL Server 的，有没有办法将其排除在我的查询之外（从而阻止它与其他数据库一起使用）？也许我可以以某种方式在 DbCommand 对象上指定一个参数？或者我可以在数据库级别指定锁定策略吗？也就是说，更改 SQL Server 本身中的某些属性会阻止表在默认情况下像这样锁定？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-14T09:15:14.167

如果您使用的是 SQL Server 2005+，那么试试新的 MVCC 快照隔离如何。我用它取得了很好的效果：

```
ALTER DATABASE SET SINGLE_USER WITH ROLLBACK IMMEDIATE；
ALTER DATABASE SET READ_COMMITTED_SNAPSHOT ON；
ALTER DATABASE SET MULTI_USER；

```

它将阻止读者阻止作者，反之亦然。它以极低的成本消除了许多死锁。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-13T21:11:48.507

这取决于您使用的隔离级别。您可以尝试使用 With (NoLock) 提示进行选择，这将防止读取锁定，但也意味着正在读取的数据可能会在选择事务完成之前更改。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-13T21:18:04.297

您可以做的第一件事是尝试将“WITH (NOLOCK)”添加到查询中的任何表中。这将“驯服”SQL Server 所做的锁定。在连接上使用“NOLOCK”的示例如下...

```
SELECT COUNT(Users.UserID)
    FROM Users WITH (NOLOCK)
       JOIN UsersInUserGroups WITH (NOLOCK) ON 
          Users.UserID = UsersInUserGroups.UserID 
```

另一种选择是使用数据集而不是数据读取器。数据读取器是一种“消防软管”技术，它在您的程序处理并基本上通过软管逐行处理表格时保持与表格的连接。数据集使用“断开连接”方法，将所有数据加载到内存中，然后关闭连接。然后，您的程序可以循环内存中的数据，而不必担心锁定。但是，如果这是非常大量的数据，则可能存在内存问题。

希望这可以帮助。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-13T21:11:49.070

如果在 FROM 子句中的表名之后添加 WITH (NOLOCK) 提示，它应该确保它没有锁定，并且它不关心读取被锁定的数据。如果您同时写作，您可能会得到“过时”的结果，但如果您不关心这一点，那么您应该没问题。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-13T21:13:49.377

我认为避免这种情况的最佳方法是在 SQL 中而不是在应用程序中进行。

您可以添加一个

等待延迟'000:00:01'

在每次循环迭代结束时为其他进程运行提供时间 - 只需确保您没有启动 TRANSACTION 以便所有其他进程无论如何都被锁定

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-13T21:19:55.900

该查询正在执行表锁定，因此插入失败。

在我看来，您在处理结果时一直在锁定桌面。您应该将它们加载到某种数组或集合中，然后关闭数据库连接。然后处理数组。

此外，当您进行选择时，请使用： WITH(NOLOCK) 或 WITH(READPAST)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-13T21:25:59.003

我不是使用锁定提示的忠实拥护者，因为您最终可能会遇到脏读或其他怪异现象。其他几个想法：

*   你能把行数分解，这样你就不会一次抓住 200k 吗？有没有办法判断你是否处理了一行——一个标志、一个时间戳——你可以用来进行查询？您的查询可能是“SELECT TOP 5000 ...”每次获得不同的 5k。较短的查询意味着较短的锁。

*   如果您可以使用较小的行集，我喜欢 DataSet 与 IDataReader 的想法。您将数据加载到内存中并且不消耗任何 SQL 锁，但是内存量可能会导致其他问题。

-布赖恩

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-14T08:15:57.770

您应该能够在 .NET 级别设置隔离级别，这样您就不必包含 WITH (NOLOCK) 提示。

如果您想使用批处理选项，您应该能够从 .NET 级别指定 Rowcount 设置，这将告诉数据库仅返回*n*条记录。通过在 .NET 级别设置这些设置，它们应该变得独立于数据库并在所有平台上工作。

# sharepoint - SharePoint：网站布局

> ID：547677
> 
> 赞同：3
> 
> 时间：2009-02-13T21:06:42.560
> 
> 标签：sharepoint, sharepoint-designer

嗨，我想知道我可以使用哪种布局来获取右上角的搜索框。我使用*（欢迎页面）空白 Web 部件页面）*作为页面布局，但它缺少右上角的搜索框。

还有另一个问题：如何将自己的布局添加到“创建页面”页面的列表中。谢谢你。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-16T09:34:44.607

搜索框在您的母版页中定义。通常是 default.master，无论您选择哪种布局，母版页中定义的元素仍将位于同一位置。在您的情况下，您的主服务器上似乎不存在搜索框，需要再次添加。

您需要修改站点的母版页，并将适当的 SP 控件添加到页面上的适当位置以进行搜索。这将确保在该位置为每个页面呈现一个 SP 搜索框。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-14T04:28:50.860

要定义您自己的页面布局，请查看[Link 1](http://office.microsoft.com/en-us/sharepointdesigner/HA101741281033.aspx)和[Link 2](http://www.wssdemo.com/Blog/archive/2008/10/27/creating-a-sharepoint-page-layout-to-play-video-content.aspx)。

至于搜索框，它被定义为站点模板的一部分。尝试使用协作站点模板创建站点。

# c - 在 C 中进行类型转换的替代方法？

> ID：547679
> 
> 赞同：1
> 
> 时间：2009-02-13T21:07:02.637
> 
> 标签：c, string

我在一些代码中遇到了这一行，在任何地方都找不到定义的语法：

```
*(float *)csCoord.nX = lImportHeight* .04f; /* magic number to scale font size */ 
```

如果我从中删除， `f` 编译 `.04f` 器会发出警告，指出由于从“双”到“浮点”的转换可能导致数据丢失。我假设 `f` 正在做某种类型转换。

有没有人见过这个？这在 C 标准中在哪里定义？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-02-13T21:08:55.253

尾随的 f 向编译器表明它是一个浮点类型的文字，就像 "" 表示一个文字字符串，而 L 后缀表示一个 long int。

文字的[C++ 规范](http://cpp.comsci.us/etymology/literals.html)是相同的。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-13T21:10:23.050

没有“f”，数量 0.04 是双倍。当您将 lImportHeight 与双精度数相乘时，您将获得另一个双精度数。然后你将它存储在一个浮点大小的内存位置，失去精度。对于“f”，0.04f 是一个浮点字面量。你用它多个 lImportHeight ，你得到一个浮点数；那么分配不会导致精度损失。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-13T21:09:44.783

不知道它在标准中的定义，但你使用 an`f`来表示一个浮点数，否则编译器会假定它是一个双精度数。`u`同样，您可以通过添加 a或 long by `l`（小写 ell）等来指定要无符号的整数。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-13T21:18:09.273

究竟是什么问题？您的编译器会在 .04f 上阻塞吗？尝试

```
(float) .04 
```

# sql-server - 从 LINQ to SQL 查询时间戳列

> ID：547684
> 
> 赞同：7
> 
> 时间：2009-02-13T21:08:25.863
> 
> 标签：sql-server, linq, performance

我的表有一个名为“RowVer”的时间戳列，LINQ 映射到类型 System.Data.Linq.Binary。这种数据类型对我来说似乎没用，因为（除非我遗漏了什么）我不能做这样的事情：

```
// Select all records that changed since the last time we inserted/updated.
IEnumerable<UserSession> rows = db.UserSessions.Where
( usr => usr.RowVer > ???? ); 
```

因此，我正在寻找的解决方案之一是添加一个名为 RowTrack 的新“计算列”，它在 SQL 中定义如下：

```
CREATE TABLE UserSession
(
RowVer timestamp NOT NULL,
RowTrack  AS (convert(bigint,[RowVer])),
-- ... other columns ...
) 
```

这使我可以像我想要的那样查询数据库：

```
// Select all records that changed since the last time we inserted/updated.
IEnumerable<UserSession> rows = db.UserSessions.Where
( usr => usr.RowTrack > 123456 ); 
```

这是做事的坏方法吗？查询计算列的性能如何？有更好的解决方法吗？

此外，我正在针对 Sql Server 2000 进行开发以实现最终的向后兼容性，但我可以说服老板让 2005 成为最低公分母。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2010-09-30T06:39:43.183

AS [Diego Frata](https://stackoverflow.com/users/214601/diego)在[这篇文章](http://diegofrata.wordpress.com/2009/11/18/linq-to-sql-expression-trees-and-binary-comparing/)中概述了一个 hack，它使时间戳可以从 LINQ 查询。

诀窍是定义一个接受两个**System.Data.Linq.Binary**参数的**Compare**方法

 **```
public static class BinaryComparer
{
 public static int Compare(this Binary b1, Binary b2)
 {
 throw new NotImplementedException();
 }
} 
```

请注意，该函数不需要实现，只有它的名称（**比较**）很重要。

查询将类似于：

```
Binary lastTimestamp = GetTimeStamp();
var result = from job in c.GetTable<tblJobs>
             where BinaryComparer.Compare(job.TimeStamp, lastTimestamp)>0
             select job; 
```

（这在 job.TimeStamp>lastTimestamp 的情况下）

**编辑**：如果您需要它在 SQL 之外工作，请参阅[Rory MacLeod 的答案](https://stackoverflow.com/a/11593739/113108)以了解该方法的实现。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-02-13T21:32:31.657

SQL Server“时间戳”只是记录已更改的指示符，它实际上并不是日期/时间的表示。（虽然假设每次修改数据库中的记录时都会增加，

注意它会回零（不是经常，诚然），所以唯一安全的测试是这个值是否已经改变，而不是它是否大于某个任意的先前值。

您可以将 TimeStamp 列值传递给 Web 表单，然后在提交时查看表单中的 TimeStamp 是否与当前记录中的值不同 - 如果不同，其他人已更改并临时保存了记录.

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-13T21:13:31.453

> > // 选择自我们上次插入/更新以来更改的所有记录。
> > 
> > 有更好的解决方法吗？

为什么不设置两列，一列用于 createddate，另一列用于 lastmodifieddate。我想说这是处理这种情况的更传统的方式。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2012-07-21T16:06:20.353

继[jaraics 的回答](https://stackoverflow.com/a/3828349/1016)之后，您还可以为该`Compare`方法提供一个实现，使其能够在查询之外工作：

```
public static class BinaryExtensions
{
    public static int Compare(this Binary b1, Binary b2)
    {
        if (b1 == null)
            return b2 == null ? 0 : -1;

        if (b2 == null)
            return 1;

        byte[] bytes1 = b1.ToArray();
        byte[] bytes2 = b2.ToArray();
        int len = Math.Min(bytes1.Length, bytes2.Length);
        int result = memcmp(bytes1, bytes2, len);

        if (result == 0 && bytes1.Length != bytes2.Length)
        {
            return bytes1.Length > bytes2.Length ? 1 : -1;
        }

        return result;
    }

    [DllImport("msvcrt.dll")]
    private static extern int memcmp(byte[] arr1, byte[] arr2, int cnt);
} 
```

的使用`memcmp`取自[this answer](https://stackoverflow.com/a/2173611/1016 "没有绑定检查的 C# byte[] 比较") to a question on comparison byte arrays。如果数组的长度不同，但较长的数组以与较短的数组相同的字节开始，则较长的数组被认为大于较短的数组，即使额外的字节全为零。

# macos - 有没有办法查询 MacBook LCD 的当前亮度级别？

> ID：547691
> 
> 赞同：2
> 
> 时间：2009-02-13T21:09:48.700
> 
> 标签：macos, lcd, screen-brightness

这个想法是，一旦亮度超过一定水平，人们就可以切换到不同的视觉方案以提供更大的可见度。另外，如果它可以是某种听众类型的东西，那就更好了，但我会尽我所能。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-13T22:27:38.793

我相信人们可以使用 IOKit 进行查找。如下在终端中运行 ioreg 命令会给出两条可见亮度值的行。

```
% ioreg -c AppleGraphicsControlBacklight | grep brightness

| | |     "IODisplayParameters" = {"brightness"={"min"=0,"value"=408,"max"=1024},"commit"={"reg"=0}}
| |   |     "IODisplayParameters" = {"brightness"={"min"=0,"value"=408,"max"=1024},"commit"={"reg"=0}} 
```

也许有足够 IOKit 知识的人可以整理一个样本......

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-15T06:25:29.200

epatel 非常接近，我只需将 AppleGraphicsControlBacklight 关键字更改为其他内容即可使其在我的 macbook 上运行，所以我猜这可能会在 OSX 版本和/或 macbook 版本之间发生变化。

我拼凑了一个简短的 ruby​​ 脚本，以在命令行上打印出一个小的视觉指示器。

```
# grab the string containing the values
brite_string = `ioreg -c AppleBacklightDisplay | grep brightness`

# build a regex to match those vals
brite_regex  = /"brightness"=\{"min"=([0-9]{1,3}),"value"=([0-9]{1,3}),"max"=([0-9]{1,3})/

# match them
match_data = brite_regex.match(brite_string)

# extract the values from the match
min = match_data[1].to_i
val = match_data[2].to_i
max = match_data[3].to_i

# print them out nice
puts "Current Brightness"
print "["

max.times do  |i|
  print i > val ? " " : "*"
end

puts "]" 
```

* * *

## 回答 #3

> 赞同：-3
> 
> 时间：2009-02-13T21:18:23.733

我不是 Mac 用户，但 /proc 是否存在于文件系统中？如果该虚拟文件目录存在，您可能需要查看它。

# asp.net - 没有时间的 SQL 日期搜索

> ID：547693
> 
> 赞同：0
> 
> 时间：2009-02-13T21:10:48.010
> 
> 标签：asp.net, sql-server

我有一个按日期搜索的查询。数据库中的日期包括时间。如何仅搜索日期。

```
select * 
from weblogs.dbo.vwlogs 
where Log_time between @BeginDate and @EndDAte 
  and (client_user=@UserName or @UserName  Is null) 
order by Log_time desc 
```

```
cmd.Parameters.AddWithValue("@BeginDate", txtBeginDate.Text);
cmd.Parameters.AddWithValue("@EndDAte", txtEndDate.Text); 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-13T21:16:41.100

让你的 sql 保持原样，只修复你的参数：

```
cmd.Parameters.Add("@BeginDate", SqlDbType.DateTime).Value =
    DateTime.Parse(txtBeginDate.Text).Date;       
cmd.Parameters.Add("@EndDAte", SqlDbType.DateTime).Value =
    // add one to make search inclusive
    DateTime.Parse(txtEndDate.Text).Date.AddDays(1); 
```

您还想首先检查以确保您的文本框是有效的日期时间，但您应该明白这一点。

这里唯一需要注意的是，由于 BETWEEN 运算符的怪癖，它将匹配第二天的第一时刻。因此，为了解决这个问题，我们编写如下查询：

```
SELECT * 
FROM vwlogs 
WHERE Log_time >= @BeginDate AND Log_Time < @EndDate 
    AND (client_user=@UserName OR @UserName IS NULL) 
ORDER BY Log_time DESC 
```

特别注意日期前后的比较运算符。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-13T21:22:15.957

在 SQL 中，将开始日期和结束日期舍入为 Whole Dates 并使用 >= @BeginDate 并且非常具体地使用 < @EndDAte。“舍入”过程恐怕不是很优雅

例如

```
SELECT @BeginDate = DATEADD(Day, DATEDIFF(Day, 0, @BeginDate), 0),
       @EndDAte = DATEADD(Day, DATEDIFF(Day, 0, @EndDAte) + 1, 0)

select * 
from weblogs.dbo.vwlogs 
where     Log_time >= @BeginDate 
      and Log_time < @EndDAte
      and (@UserName Is null OR client_user=@UserName)
order by Log_time desc 
```

请注意，我首先移动了“@UserName Is null”，因为有一些证据表明该测试很容易通过/失败，并且如果第一次测试会导致第二个 CPU 密集型测试 (client_user=@UserName) 被忽略是 TRUE （当然可能是 TommyRot ...）

此外，为了获得最佳性能，您应该明确命名您需要的所有列，而不是使用“SELECT *”（但这可能只是为了这个问题的目的）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-13T21:49:51.943

首先要做的是从日期中删除时间。如果您想在 sql server 代码中执行此操作，您可以使用类似下面的代码。我在我工作的所有数据库上都有这个功能

```
cast(floor(cast(@fromdate as float)) as datetime) 
```

接下来要担心的是 where 标准。您需要确保选择从开始日期开始到结束日期的所有内容。您还需要确保一天的查询可以使用这样的日期添加

```
Where LogTime >= @fromdate and LogTime < DateAdd(dd, 1, @todate) 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-13T21:17:38.650

如果您想更改 sql，

TRUNC(Log_Time) 将每个日期时间减少到午夜的那个日期。

确保将列上的索引构建为 TRUNC(Log_TIME) 以便它可用。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-13T21:28:59.073

另一个问题 - 截断您的结束日期将不包括该日期！考虑：

WHERE Log_Time >= @BeginDate AND Log_Time < @EndDate

如果@EndDate 被截断，它将是午夜并且当天不匹配任何内容。你需要增加一天！

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-13T21:55:48.370

通过在查询之前添加以下行来清理日期...

```
select 
    @begindate=dateadd(day,datediff(day,0,@begindate),0),
    @enddate=dateadd(ms,-3,dateadd(day,datediff(day,0,@enddate),1)) 
```

这会将**您**的开始日期设置为尽可能低的时间 (00:00:00.000)，并将结束日期设置为尽可能高的时间 (23:59:59.997) **。**然后，您可以保持 BETWEEN 查询与编写时完全相同。

```
select * 
from weblogs.dbo.vwlogs 
where Log_time between @BeginDate and @EndDAte 
and (client_user=@UserName or @UserName Is null) 
order by Log_time desc 
```

希望这可以帮助。

# language-design - 为什么语法糖有时被认为是一件坏事？

> ID：547710
> 
> 赞同：14
> 
> 时间：2009-02-13T21:14:39.593
> 
> 标签：language-design, syntactic-sugar

恕我直言，语法糖通常使程序比从一组非常简约的原语进行编码更具可读性和更容易理解。我真的没有看到好的，深思熟虑的语法糖的缺点。为什么有些人基本上认为语法糖充其量是多余的，最坏的情况是应该避免的？

编辑：我不想说出名字，但自从人们问起，似乎大多数 C++ 和 Java 程序员，例如，坦率地说，他们并不关心他们的语言完全缺乏语法糖。在很多情况下，他们并不一定只是喜欢语言的其他部分就足以使缺少糖分值得权衡，而是他们真的**不在乎**。此外，Lisp 程序员似乎几乎为他们语言的奇怪符号感到自豪（我不会称它为语法，因为它在技术上不是），尽管在这种情况下，它更容易理解，因为它允许 Lisp 的元编程工具与它们一样强大。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-02-13T21:24:26.277

*句法糖会导致分号癌。*艾伦·佩利斯

如果在没有参考上下文的情况下进行推理，就很难对语法糖进行推理。有很多关于“语法糖”为什么好或坏的例子，没有上下文，所有这些都是毫无意义的。

你提到句法糖在使程序可读和更容易理解时是好的……我可以反驳说，有时句法糖会影响语言的形式结构，特别是当句法糖是设计过程中的后期附录时的一种编程语言。

与其从语法糖的角度思考，我更喜欢从设计良好的、促进可读性和易于理解的语言以及设计糟糕的语言的角度思考。

问候，

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-02-13T21:45:38.940

在某些情况下，语法糖会以令人不快的方式相互作用。

一些具体的例子：

第一个是 c#（或 java）特定的，自动装箱和锁/同步结构

```
private int i;
private object o = new object();

private void SomethingNeedingLocking(bool b)
{
    object lk = b ? i : o;
    lock (lk) { /* do something */ }
} 
```

在这个例子中，可以使用任何对象作为同步点的有用的锁结构与自动装箱相结合，会导致一个可能的错误。每次都会对 i 的新盒装实例进行锁定。有争议的是，锁定结构过于有用，并且锁定的其他一些特定结构会更好，但肯定组合仍然存在缺陷。

多变量声明和指针：

```
long* first, second; 
```

一个经典的错误（虽然很容易发现）。多个变量的糖不适合指针声明。

一些构造不需要糖的其他方面来引起问题，一个经典的例子是 ++ 运算符。它巧妙地让你避免写作

```
i = i + 1; 
```

一种广泛使用的构造（并且它本身具有错误范围，因为如果您希望更改使用 i，则必须记住更新这两个变量）。然而，由于这很容易嵌入到其他表达式中，前缀和后缀的问题出现了。当在 for 循环中使用时，这无关紧要，评估发生在任何其他评估之外，但在其他地方使用它可能会造成混淆（因为您可能嵌入了计算的一个非常重要的方面（无论是当前还是下一个value 应该被使用) 变成一个非常小且容易遗漏的形式。

以上所有情况（编译器确实应该为您发现的锁/盒子除外）都是使用可能很好的情况，或者有经验的程序员可能会认为“这对我来说非常清楚”，但肯定存在混淆的范围对于新手程序员或转向不同语法的程序员。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-02-13T21:19:28.130

太多不必要的糖只会增加语言的膨胀。我会说出名字，但我会被激怒。:) 另外，有时语言使用语法糖而不是真正的实现。例如，有一种语言将保持无名，其“泛型实现”只是一层薄薄的语法糖。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-02-13T22:58:18.953

废话。C 和 Lisp 程序员一直都在使用语法糖。

例子：

*   `a[i]`代替`*(a+i)`
*   `'(1 2 3)`代替`(quote 1 2 3)`

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-02-13T22:10:56.213

一般来说，语法使一门语言难以学习，更不用说掌握了。因此，语法集越小，越容易学习和尝试掌握。这是许多新语言从流行的现有语言中借用语法的主要原因。

此外，虽然我可以简单地避免学习某些我出于某种原因不感兴趣的功能，但我最终会发现自己正在阅读喜欢该功能的其他人的代码，*然后*我需要去学习该功能只是为了理解他们代码。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-02-13T21:36:29.743

就个人而言，我一直觉得“语法糖”这个词含糊不清。我的意思是，如果你想获得技术知识，除了基本算术、if 语句和 goto 之外的任何东西都是语法糖。

我认为大多数人在忽略“语法糖”时的意思是语言功能使复杂的东西变得过于简单。最臭名昭著的例子是 Perl。但由于我不是 Perl 专家，我会给你一个我在 python 中谈论的例子（取自[这个问题](https://stackoverflow.com/questions/406121/flattening-a-shallow-list-in-python)）：

```
reduce(list.__add__, map(lambda x: list(x), [mi.image_set.all() for mi in list_of_menuitems])) 
```

这是一个明显的尝试，让更简单的事情变得可怕，可怕的错误。

这并不是说我支持删除这些功能。我认为这些功能只需要小心使用。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-02-13T22:47:09.403

我一直将“语法糖”理解为是指添加到现有语言中但不扩展语言功能的任何语法。否则，任何比二进制机器语言更直接的东西都可以称为语法糖。

即使它们没有扩展语言的功能，它们仍然非常有用。

例如，LINQ 是语法糖，因为它没有向 C#3 添加任何在 C#2 中不可能实现的新功能。但是要在 C#2 中执行与简单的 LINQ 表达式相同的操作，将需要更多的代码来完成并且更难阅读。

相反，泛型不是语法糖，因为您可以在 C#2 中使用它们完成 C#1 无法做到的事情，例如创建一个可以包含任何值类型而无需装箱的集合类。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-02-13T21:19:21.377

语法糖可以使您的程序更易于理解，也可以不那么容易理解。如果你为琐碎的事情添加语法糖，你只会增加认知负担，因为语言变得更加复杂。另一方面，如果您可以添加语法糖以某种方式完成以查明特定概念并突出显示它，那么您就可以获胜。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-02-13T21:35:39.200

请参阅[泄漏抽象定律](http://www.joelonsoftware.com/articles/LeakyAbstractions.html)- 太多的糖，你只是在不了解或不知道发生了什么的情况下使用它，如果出现问题，这使得调试变得越来越**困难**。与其说“语法糖”是一件坏事，不如说是很多程序员依赖它而没有真正意识到他们被屏蔽了什么，然后如果语法糖遇到问题，他们就搞砸了。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-02-13T21:17:01.880

可能是因为它导致不知道幕后真正发生了什么的程序员感到困惑，这反过来又可能导致一些低效或编写不佳的代码。只是猜测，我不认为这是一件“坏事” “ 任何一个。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-02-13T21:19:50.000

它是更多的类型和更多的抽象层。我更愿意使用一种设计为具有更高抽象级别的语言，然后是一种带有语法糖的语言，在模仿其他语言内置的功能方面做得很差。

# iphone - 以编程方式从 NIB 设置 UIViewController 中的视图属性（不在初始化期间）

> ID：547716
> 
> 赞同：0
> 
> 时间：2009-02-13T21:15:34.880
> 
> 标签：iphone, cocoa-touch, user-interface

在我的应用程序开始时，我正在使用 NIB 初始化 UIViewController。

在某些时候，我从屏幕上删除视图，然后释放它，所以它不再占用内存。（此时我也在 UIViewController 中保存视图的状态）

稍后，我想重新创建视图并将其重新显示在屏幕上。然后我将恢复它的状态。（使用相同的 UIViewController，而不是新的，因为它保存了状态）

我的问题是，当我重新创建视图时，如何从 NIB 执行此操作，或者这不可能？

对我来说，显而易见的补救措施是：

1.  不要在 UIViewcontroller 中保存状态（约定在哪里要求我保存状态？）

2.  不要释放视图（也许只是释放它的所有子视图？）

3.  不要从 NIB 加载我的视图，以编程方式创建（似乎反对使用 IB 来处理所有事情）

注意：我没有使用 UINavigationController，我自己处理视图的交换，因为你只有其中 2 个。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-13T21:31:52.813

如果你需要那种级别的控制，你真的不想使用 IB。因为，正如您所指出的，如果删除视图然后重新创建它，那么无论如何您都必须在代码中执行此操作。只需在 IB 中设计大部分视图，然后编写一些代码来生成这个视图。然后，您可以稍后再次调用相同的方法，以便在需要时重新创建该视图。

您也许可以将其存档，然后再将其转回对象，但这似乎是一个不恰当的解决方案。IB 不允许在运行时动态创建控件，即使它们曾经存在但不再存在。为此让 IB 脱离循环并不可耻。事实上，这可能是一个好主意。

* * *

或者

如果它是一个包含很多片段的复杂视图，请将视图放在它自己的 nib 中，并为其创建一个视图控制器。然后，您可以简单地使用 nib 名称创建视图控制器，并将控制器视图作为子视图添加到您的主视图中。然后你的视图控制器处理 nib 的加载，你可以在 IB 中设计它。也没有说视图控制器的视图必须占据整个屏幕。

```
self.otherController = [[OtherController alloc] initWithNibName:@"Other" bundle:nil];
[self.view addSubview:otherController.view]; 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-14T00:50:27.327

不要在同一个 nib 文件中创建视图控制器和视图；要么在代码中创建控制器，要么将视图放在单独的 nib 文件中。如果您稍后取消控制器的视图属性，控制器应该重新创建视图。

但是你为什么这么担心这个？如果内存不足，已经有一种机制可以自动释放视图：内存不足警告。如果您确实需要这样做，它只会破坏并重新创建视图，并且它内置在系统中，因此您无需执行任何操作。还记得过早优化的说法吗？

# linux - 有没有办法让 mv 创建要移动到的目录，如果它不存在？

> ID：547719
> 
> 赞同：338
> 
> 时间：2009-02-13T21:15:59.730
> 
> 标签：linux, macos, unix, mkdir, mv

所以，如果我在我的主目录中并且我想将 foo.c 移动到 ~/bar/baz/foo.c ，但这些目录不存在，有没有办法自动创建这些目录，这样你只需要输入

```
mv foo.c ~/bar/baz/ 
```

一切都会好起来的？似乎您可以将 mv 别名为一个简单的 bash 脚本，该脚本将检查这些目录是否存在，如果不存在，则调用 mkdir 然后调用 mv，但我想我会检查是否有人有更好的主意。

* * *

## 回答 #1

> 赞同：350
> 
> 时间：2009-02-13T22:22:10.663

这个单线如何（在 bash 中）：

```
mkdir --parents ./some/path/; mv yourfile.txt $_ 
```

打破它：

```
mkdir --parents ./some/path
# if it doesn't work; try
mkdir -p ./some/path 
```

创建目录（包括所有中间目录），之后：

```
mv yourfile.txt $_ 
```

将文件移动到该目录（$_ 扩展为传递给上一个 shell 命令的最后一个参数，即：新创建的目录）。

我不确定这在其他 shell 中会起作用多远，但它可能会给你一些关于寻找什么的想法。

下面是一个使用这种技术的例子：

```
$ > ls
$ > touch yourfile.txt
$ > ls
yourfile.txt
$ > mkdir --parents ./some/path/; mv yourfile.txt $_
$ > ls -F
some/
$ > ls some/path/
yourfile.txt 
```

* * *

## 回答 #2

> 赞同：73
> 
> 时间：2012-06-21T19:19:06.370

```
mkdir -p `dirname /destination/moved_file_name.txt`  
mv /full/path/the/file.txt  /destination/moved_file_name.txt 
```

* * *

## 回答 #3

> 赞同：26
> 
> 时间：2012-04-26T03:54:05.923

另存为名为 mv.sh 的脚本

```
#!/bin/bash
# mv.sh
dir="$2" # Include a / at the end to indicate directory (not filename)
tmp="$2"; tmp="${tmp: -1}"
[ "$tmp" != "/" ] && dir="$(dirname "$2")"
[ -a "$dir" ] ||
mkdir -p "$dir" &&
mv "$@" 
```

或者将 ~/.bashrc 文件作为替换每个新终端上的默认 mv 的函数放在末尾。使用函数可以让 bash 保留它的内存，而不必每次都读取脚本文件。

```
function mvp ()
{
    dir="$2" # Include a / at the end to indicate directory (not filename)
    tmp="$2"; tmp="${tmp: -1}"
    [ "$tmp" != "/" ] && dir="$(dirname "$2")"
    [ -a "$dir" ] ||
    mkdir -p "$dir" &&
    mv "$@"
} 
```

示例用法：

```
mv.sh file ~/Download/some/new/path/ # <-End with slash 
```

这些基于 Chris Lutz 的提交。

* * *

## 回答 #4

> 赞同：14
> 
> 时间：2009-02-13T21:18:44.997

您可以使用`mkdir`：

```
mkdir -p ~/bar/baz/ && \
mv foo.c ~/bar/baz/ 
```

一个自动执行此操作的简单脚本（未经测试）：

```
#!/bin/sh

# Grab the last argument (argument number $#)    
eval LAST_ARG=\$$#

# Strip the filename (if it exists) from the destination, getting the directory
DIR_NAME=`echo $2 | sed -e 's_/[^/]*$__'`

# Move to the directory, making the directory if necessary
mkdir -p "$DIR_NAME" || exit
mv "$@" 
```

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2016-03-14T19:12:25.050

听起来答案是否定的:)。我真的不想为此创建别名或函数，通常是因为它是一次性的，而且我已经在键入`mv`命令的过程中，但我发现了一些适用于此的方法：

```
mv *.sh  shell_files/also_with_subdir/ || mkdir -p $_ 
```

如果`mv`失败（dir 不存在），它将创建目录（这是上一个命令的最后一个参数，所以`$_`有）。所以只需运行这个命令，然后`up`重新运行它，这一次`mv`应该会成功。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2017-07-07T18:49:44.827

最简单的方法是：

```
mkdir [directory name] && mv [filename] $_ 
```

假设我下载了位于我的下载`~/download`目录`my_PDF`（

我将键入以下命令（确保我当前的工作目录是`~/download`）：

```
mkdir my_PDF && mv *.pdf $_ 
```

**如果您想像这样创建子目录，您可以添加`-p`选项`mkdir`**：（假设我想创建一个名为 的子目录`python`）：

```
mkdir -p my_PDF/python && mv *.pdf $_ 
```

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2020-10-03T19:08:14.567

利用[“获取传递给 shell 脚本的最后一个参数”](https://stackoverflow.com/q/1853946/476351)中的技巧，我们可以创建一个简单的 shell 函数，无论您要移动多少文件，该函数都应该工作：

```
# Bash only
mvdir() { mkdir -p "${@: -1}" && mv "$@"; }

# Other shells may need to search for the last argument
mvdir() { for last; do true; done; mkdir -p "$last" && mv "$@"; } 
```

使用如下命令：

```
mvdir foo.c foo.h ~/some/new/folder/ 
```

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2019-02-27T06:58:34.643

**只有当目标路径中的最后一个目录不存在时，** [rsync](https://linux.die.net/man/1/rsync)命令才能解决问题，例如，`~/bar/baz/`如果目标路径`bar`存在但`baz`不存在，则可以使用以下命令：

`rsync -av --remove-source-files foo.c ~/bar/baz/`

```
-a, --archive               archive mode; equals -rlptgoD (no -H,-A,-X)
-v, --verbose               increase verbosity
--remove-source-files   sender removes synchronized files (non-dir) 
```

在这种情况下，如果`baz`目录不存在，将创建它。但是如果两者`bar`都不`baz`存在 rsync 将失败：

```
sending incremental file list
rsync: mkdir "/root/bar/baz" failed: No such file or directory (2)
rsync error: error in file IO (code 11) at main.c(657) [Receiver=3.1.2] 
```

所以基本上它应该是安全`rsync -av --remove-source-files`的用作`mv`.

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2009-02-13T21:21:10.077

下面的shell脚本，也许？

```
#!/bin/sh
if [[ -e $1 ]]
then
  if [[ ! -d $2 ]]
  then
    mkdir --parents $2
  fi
fi
mv $1 $2 
```

这是基本部分。您可能需要添加一点来检查参数，并且您可能希望在目标存在、源目录存在或不存在时改变行为（即不要覆盖不存在的东西） .

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2014-07-01T11:46:28.730

更愚蠢，但工作方式：

```
mkdir -p $2
rmdir $2
mv $1 $2 
```

使用 mkdir -p 创建包含共享目标文件名的临时目录的目录，然后使用简单的 rmdir 删除该文件名目录，然后将文件移动到新目标。我认为使用 dirname 的答案可能是最好的。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2020-05-20T22:24:00.947

这将移动`foo.c`到`baz`带有父目录的新目录`bar`。

```
mv foo.c `mkdir -p ~/bar/baz/ && echo $_` 
```

`-p`选项将根据`mkdir`需要创建中间目录。
没有`-p`路径前缀中的所有目录必须已经存在。

反引号内的所有内容都````被执行，并且输出作为命令的一部分返回。
由于`mkdir`不返回任何内容，因此只会将 的输出`echo $_`添加到命令中。

`$_`引用先前执行的命令的最后一个参数。
在这种情况下，它将返回`~/bar/baz/`传递给`mkdir`命令的新目录 ( ) 的路径。

* * *

我在没有给出目的地的情况下解压缩了一个存档，并且想将除`demo-app.zip`当前目录之外的所有文件移动到一个名为`demo-app`.
以下行可以解决问题：

```
mv `ls -A | grep -v demo-app.zip` `mkdir -p demo-app && echo $_` 
```

`ls -A`返回所有文件名，包括隐藏文件（*除了隐含的`.`and`..`*）。

管道符号`|`用于将`ls`命令的输出通过管道传输到`grep`（*命令行、纯文本搜索实用程序*）。
该`-v`标志指示`grep`查找并返回除`demo-app.zip`.
该文件列表作为 move 命令的源参数添加到我们的命令行中`mv`。目标参数是传递给`mkdir`引用的使用`$_`和输出的新目录的路径`echo`。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2020-05-27T03:42:55.867

根据另一个答案中的评论，这是我的 shell 函数。

```
# mvp = move + create parents
function mvp () {
    source="$1"
    target="$2"
    target_dir="$(dirname "$target")"
    mkdir --parents $target_dir; mv $source $target
} 
```

将此包含在 .bashrc 或类似文件中，以便您可以在任何地方使用它。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2018-06-30T12:45:04.373

代码：

```
if [[ -e $1 && ! -e $2 ]]; then
   mkdir --parents --verbose -- "$(dirname -- "$2")"
fi
mv --verbose -- "$1" "$2" 
```

例子：

参数：“d1”“d2/sub”

```
mkdir: created directory 'd2'
renamed 'd1' -> 'd2/sub' 
```

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2019-04-17T07:43:52.257

```
((cd src-path && tar --remove-files -cf - files-to-move) | ( cd dst-path && tar -xf -)) 
```

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2020-11-02T13:04:25.427

在将文件批量移动到新的子目录时，我经常偶然发现这个问题。理想情况下，我想这样做：

```
mv * newdir/ 
```

该线程中的大多数答案都建议使用`mkdir`then `mv`，但这会导致：

```
mkdir newdir && mv * newdir 
mv: cannot move 'newdir/' to a subdirectory of itself 
```

我面临的问题略有不同，因为我想全面移动所有内容，并且，如果我在移动之前创建新目录，那么它也会尝试将新目录移动到自身。所以，我通过使用父目录来解决这个问题：

```
mkdir ../newdir && mv * ../newdir && mv ../newdir . 
```

`/`警告：在根文件夹 ( )中不起作用。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2017-08-23T15:33:42.407

我的一个字符串解决方案：

```
test -d "/home/newdir/" || mkdir -p "/home/newdir/" && mv /home/test.txt /home/newdir/ 
```

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2021-02-04T16:02:23.887

`install`我用linux上的命令完成了这个：

```
root@logstash:# myfile=bash_history.log.2021-02-04.gz ; install -v -p -D $myfile /tmp/a/b/$myfile

bash_history.log.2021-02-04.gz -> /tmp/a/b/bash_history.log.2021-02-04.gz 
```

唯一的缺点是文件权限被更改：

```
root@logstash:# ls -lh /tmp/a/b/

-rwxr-xr-x 1 root root 914 Fev  4 09:11 bash_history.log.2021-02-04.gz 
```

如果您不介意重置权限，可以使用：

```
-g, --group=GROUP   set group ownership, instead of process' current group
-m, --mode=MODE     set permission mode (as in chmod), instead of rwxr-xr-x
-o, --owner=OWNER   set ownership (super-user only) 
```

* * *

## 回答 #18

> 赞同：-1
> 
> 时间：2011-04-01T05:11:06.900

你甚至可以使用大括号扩展：

```
mkdir -p directory{1..3}/subdirectory{1..3}/subsubdirectory{1..2} 
```

*   它创建了 3 个目录（directory1、directory2、directory3），
    *   并且在其中的每一个中都有两个子目录（subdirectory1，subdirectory2），
        *   并且在它们中的每一个中都有两个子子目录（subsubdirectory1 和 subsubdirectory2）。

您必须使用 bash 3.0 或更新版本。

* * *

## 回答 #19

> 赞同：-1
> 
> 时间：2016-06-30T01:24:39.327

```
$what=/path/to/file;
$dest=/dest/path;

mkdir -p "$(dirname "$dest")";
mv "$what" "$dest" 
```

# database-design - SQL 数据服务数据库设计指南

> ID：547720
> 
> 赞同：0
> 
> 时间：2009-02-13T21:16:02.850
> 
> 标签：database-design, ssds, sql-data-services, sql-server-data-services

我最近一直在玩 SQL 数据服务。尽管（或者可能是因为）我可以在睡梦中淘汰一个结构良好的关系数据库，但我正在努力思考如何在一个（例如）没有强制执行引用完整性的环境中设计一个高性能数据库和除主键之外的列上没有索引。

有谁知道任何指导方针？

也许一个开始的地方是如何创建一个多对多的连接，即使有大量的~~行~~实体，它也可以以高性能的方式从任一侧遍历？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-14T00:06:18.057

似乎正在使用的短语是：

*   将您的数据分散到多个容器中以获得最佳性能

*   通过实体对数据建模

*   并行处理查询以获得最佳性能

*   在服务托管中间层缓存数据

这意味着我们必须开始像 OO 建模者一样思考，而不是在关系型思维模式中思考。性能似乎依赖于以类似的方式大规模并行化对象查询的能力，以创建可以利用并行化的 LINQ 查询。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-10-27T13:51:28.270

好吧，我最终寻求的解决方案是：停止使用 SQL 数据服务。它是如此半生不熟，以至于目前几乎不值得使用。

# c# - 尝试启动新实例时如何最大化应用程序的第一个实例

> ID：547727
> 
> 赞同：1
> 
> 时间：2009-02-13T21:17:01.990
> 
> 标签：c#, multithreading

我想将应用程序限制为仅在一台机器上运行一个实例。到目前为止，我有这个：

```
Mutex m = new Mutex(true, Name, out IsOwned);

if (!IsOwned)
{
    string message = "There is already a copy of the application '" +
        Name + 
        "' running. Please close that application before starting a new one.";

    MessageBox.Show(message, "Error", 
        MessageBoxButtons.OK, MessageBoxIcon.Information);

    Environment.Exit(0);
}
else
{
    Application.EnableVisualStyles();
    Application.SetCompatibleTextRenderingDefault(false);
    Application.Run(new Form1());
} 
```

它退出了，但是有没有办法在第一个实例关闭之前最大化第一个实例？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-13T21:21:44.787

这不是您想要处理应用程序的多个实例的方式。公认的做法是只切换到应用程序的运行实例。

话虽如此，您可以轻松地创建一个派生自 WindowsFormsApplicationBase 的类（在 Microsoft.VisualBasic 命名空间中）。此答案概述了您将如何执行此操作，并表明您想要一个实例，以及如何处理尝试运行新实例时发生的情况：

[在自定义应用程序的运行实例中打开“已知文件类型” - .NET](https://stackoverflow.com/questions/424368/opening-a-known-file-type-into-running-instance-of-custom-app-net/424390#424390)

# vb6 - 现代，Unicode 友好的“.ini 文件”，用于在 VB6 中存储配置数据

> ID：547730
> 
> 赞同：5
> 
> 时间：2009-02-13T21:17:48.930
> 
> 标签：vb6

我想将数据结构、几个数组和十几个变量的内容存储在一个文件中，这些文件可以由我的软件保存和重新加载，也可以由重新加载的用户在文本编辑器中进行编辑。对于文本编辑，我需要清楚地标记数据，就像在一个好的 ole .ini 文件中一样：

AbsMaxVoltage = 17.5

有一个 GUI，有人可能会争辩说用户应该只从 GUI 加载、保存和修改，但客户希望能够以文本形式读取和修改数据。

编写代码来保存并重新加载它很容易（假设所有标签都在同一个地方，只有数据发生了变化）。通过更多的工作（或使用一些已经存在的 INI R/W 代码，我可以注意标签，所以如果一行被删除或在变量周围移动，变量仍然会被正确填充，但这两种方法似乎都很老了-所以我对编程领域最聪明的人今天如何处理这个问题很感兴趣（使用十年前的 VB6，我不得不承认我仍然喜欢它）。

免责声明：我是一名电气工程师，而不是程序员。这不是我的日常工作。好吧，也许这是我日常工作的一小部分。

干杯!

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-13T21:22:13.663

考虑使用[XML](http://en.wikipedia.org/wiki/XML)。它是完全标准的，许多文本编辑器会正确突出/管理它，地球上的每种编程语言和脚本语言都对阅读它有很好的支持，并且它可以完美地处理 Unicode。

对于您建议的简单名称/值对，它非常易读。但是您还有一个额外的优势，即如果有一天您需要更复杂的东西——例如多行值或不同值的列表——XML 提供了自然、简单的表示方法。

PS[下面是如何在 VB6 中读取 XML](http://www.nonhostile.com/howto-xml-vb6.asp)。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-13T21:25:08.850

回到过去，[这个](http://www.vbaccelerator.com/home/VB/Code/Libraries/Registry_and_Ini_Files/Easy_Ini_File_Access/cIniFile_Class_zip_CINIFILE_CLS.asp)课程帮助我在我的 VB6 程序中使用 INI 文件：

```
VERSION 1.0 CLASS
BEGIN
  MultiUse = -1  'True
END
Attribute VB_Name = "cInifile"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = True
Attribute VB_PredeclaredId = False
Attribute VB_Exposed = False
Option Explicit
' =========================================================
' Class:    cIniFile
' Author:   Steve McMahon
' Date  :   21 Feb 1997
'
' A nice class wrapper around the INIFile functions
' Allows searching,deletion,modification and addition
' of Keys or Values.
'
' Updated 10 May 1998 for VB5.
'   * Added EnumerateAllSections method
'   * Added Load and Save form position methods
' =========================================================

Private m_sPath As String
Private m_sKey As String
Private m_sSection As String
Private m_sDefault As String
Private m_lLastReturnCode As Long

#If Win32 Then
    ' Profile String functions:
    Private Declare Function WritePrivateProfileString Lib "KERNEL32" Alias
     "WritePrivateProfileStringA" (ByVal lpApplicationName As String, ByVal
     lpKeyName As Any, ByVal lpString As Any, ByVal lpFileName As String) As
     Long
    Private Declare Function GetPrivateProfileString Lib "KERNEL32" Alias
     "GetPrivateProfileStringA" (ByVal lpApplicationName As Any, ByVal
     lpKeyName As Any, ByVal lpDefault As Any, ByVal lpReturnedString As
     String, ByVal nSize As Long, ByVal lpFileName As String) As Long
#Else
    ' Profile String functions:
    Private Declare Function WritePrivateProfileString Lib "Kernel" (ByVal
     lpApplicationName As String, ByVal lpKeyName As Any, ByVal lpString As
     Any, ByVal lpFileName As String) As Integer
    Private Declare Function GetPrivateProfileString Lib "Kernel" (ByVal
     lpApplicationName As String, ByVal lpKeyName As Any, ByVal lpDefault As
     Any, ByVal lpReturnedString As String, ByVal nSize As Integer, ByVal
     lpFileName As String) As Integer
#End If

Property Get LastReturnCode() As Long
    LastReturnCode = m_lLastReturnCode
End Property
Property Get Success() As Boolean
    Success = (m_lLastReturnCode <> 0)
End Property
Property Let Default(sDefault As String)
    m_sDefault = sDefault
End Property
Property Get Default() As String
    Default = m_sDefault
End Property
Property Let Path(sPath As String)
    m_sPath = sPath
End Property
Property Get Path() As String
    Path = m_sPath
End Property
Property Let Key(sKey As String)
    m_sKey = sKey
End Property
Property Get Key() As String
    Key = m_sKey
End Property
Property Let Section(sSection As String)
    m_sSection = sSection
End Property
Property Get Section() As String
    Section = m_sSection
End Property
Property Get Value() As String
Dim sBuf As String
Dim iSize As String
Dim iRetCode As Integer

    sBuf = Space$(255)
    iSize = Len(sBuf)
    iRetCode = GetPrivateProfileString(m_sSection, m_sKey, m_sDefault, sBuf,
     iSize, m_sPath)
    If (iSize > 0) Then
        Value = Left$(sBuf, iRetCode)
    Else
        Value = ""
    End If

End Property
Property Let Value(sValue As String)
Dim iPos As Integer
    ' Strip chr$(0):
    iPos = InStr(sValue, Chr$(0))
    Do While iPos <> 0
        sValue = Left$(sValue, (iPos - 1)) & Mid$(sValue, (iPos + 1))
        iPos = InStr(sValue, Chr$(0))
    Loop
    m_lLastReturnCode = WritePrivateProfileString(m_sSection, m_sKey, sValue,
     m_sPath)
End Property
Public Sub DeleteKey()
    m_lLastReturnCode = WritePrivateProfileString(m_sSection, m_sKey, 0&,
     m_sPath)
End Sub
Public Sub DeleteSection()
    m_lLastReturnCode = WritePrivateProfileString(m_sSection, 0&, 0&, m_sPath)
End Sub
Property Get INISection() As String
Dim sBuf As String
Dim iSize As String
Dim iRetCode As Integer

    sBuf = Space$(8192)
    iSize = Len(sBuf)
    iRetCode = GetPrivateProfileString(m_sSection, 0&, m_sDefault, sBuf, iSize,
     m_sPath)
    If (iSize > 0) Then
        INISection = Left$(sBuf, iRetCode)
    Else
        INISection = ""
    End If

End Property
Property Let INISection(sSection As String)
    m_lLastReturnCode = WritePrivateProfileString(m_sSection, 0&, sSection,
     m_sPath)
End Property
Property Get Sections() As String
Dim sBuf As String
Dim iSize As String
Dim iRetCode As Integer

    sBuf = Space$(8192)
    iSize = Len(sBuf)
    iRetCode = GetPrivateProfileString(0&, 0&, m_sDefault, sBuf, iSize, m_sPath)
    If (iSize > 0) Then
        Sections = Left$(sBuf, iRetCode)
    Else
        Sections = ""
    End If

End Property
Public Sub EnumerateCurrentSection(ByRef sKey() As String, ByRef iCount As Long)
Dim sSection As String
Dim iPos As Long
Dim iNextPos As Long
Dim sCur As String

    iCount = 0
    Erase sKey
    sSection = INISection
    If (Len(sSection) > 0) Then
        iPos = 1
        iNextPos = InStr(iPos, sSection, Chr$(0))
        Do While iNextPos <> 0
            sCur = Mid$(sSection, iPos, (iNextPos - iPos))
            If (sCur <> Chr$(0)) Then
                iCount = iCount + 1
                ReDim Preserve sKey(1 To iCount) As String
                sKey(iCount) = Mid$(sSection, iPos, (iNextPos - iPos))
                iPos = iNextPos + 1
                iNextPos = InStr(iPos, sSection, Chr$(0))
            End If
        Loop
    End If
End Sub
Public Sub EnumerateAllSections(ByRef sSections() As String, ByRef iCount As
 Long)
Dim sIniFile As String
Dim iPos As Long
Dim iNextPos As Long
Dim sCur As String

    iCount = 0
    Erase sSections
    sIniFile = Sections
    If (Len(sIniFile) > 0) Then
        iPos = 1
        iNextPos = InStr(iPos, sIniFile, Chr$(0))
        Do While iNextPos <> 0
            If (iNextPos <> iPos) Then
                sCur = Mid$(sIniFile, iPos, (iNextPos - iPos))
                iCount = iCount + 1
                ReDim Preserve sSections(1 To iCount) As String
                sSections(iCount) = sCur
            End If
            iPos = iNextPos + 1
            iNextPos = InStr(iPos, sIniFile, Chr$(0))
        Loop
    End If

End Sub
Public Sub SaveFormPosition(ByRef frmThis As Object)
Dim sSaveKey As String
Dim sSaveDefault As String
On Error GoTo SaveError
    sSaveKey = Key
    If Not (frmThis.WindowState = vbMinimized) Then
        Key = "Maximised"
        Value = (frmThis.WindowState = vbMaximized) * -1
        If (frmThis.WindowState <> vbMaximized) Then
            Key = "Left"
            Value = frmThis.Left
            Key = "Top"
            Value = frmThis.Top
            Key = "Width"
            Value = frmThis.Width
            Key = "Height"
            Value = frmThis.Height
        End If
    End If
    Key = sSaveKey
    Exit Sub
SaveError:
    Key = sSaveKey
    m_lLastReturnCode = 0
    Exit Sub
End Sub
Public Sub LoadFormPosition(ByRef frmThis As Object, Optional ByRef lMinWidth =
 3000, Optional ByRef lMinHeight = 3000)
Dim sSaveKey As String
Dim sSaveDefault As String
Dim lLeft As Long
Dim lTOp As Long
Dim lWidth As Long
Dim lHeight As Long
On Error GoTo LoadError
    sSaveKey = Key
    sSaveDefault = Default
    Default = "FAIL"
    Key = "Left"
    lLeft = CLngDefault(Value, frmThis.Left)
    Key = "Top"
    lTOp = CLngDefault(Value, frmThis.Top)
    Key = "Width"
    lWidth = CLngDefault(Value, frmThis.Width)
    If (lWidth < lMinWidth) Then lWidth = lMinWidth
    Key = "Height"
    lHeight = CLngDefault(Value, frmThis.Height)
    If (lHeight < lMinHeight) Then lHeight = lMinHeight
    If (lLeft < 4 * Screen.TwipsPerPixelX) Then lLeft = 4 *
     Screen.TwipsPerPixelX
    If (lTOp < 4 * Screen.TwipsPerPixelY) Then lTOp = 4 * Screen.TwipsPerPixelY
    If (lLeft + lWidth > Screen.Width - 4 * Screen.TwipsPerPixelX) Then
        lLeft = Screen.Width - 4 * Screen.TwipsPerPixelX - lWidth
        If (lLeft < 4 * Screen.TwipsPerPixelX) Then lLeft = 4 *
         Screen.TwipsPerPixelX
        If (lLeft + lWidth > Screen.Width - 4 * Screen.TwipsPerPixelX) Then
            lWidth = Screen.Width - lLeft - 4 * Screen.TwipsPerPixelX
        End If
    End If
    If (lTOp + lHeight > Screen.Height - 4 * Screen.TwipsPerPixelY) Then
        lTOp = Screen.Height - 4 * Screen.TwipsPerPixelY - lHeight
        If (lTOp < 4 * Screen.TwipsPerPixelY) Then lTOp = 4 *
         Screen.TwipsPerPixelY
        If (lTOp + lHeight > Screen.Height - 4 * Screen.TwipsPerPixelY) Then
            lHeight = Screen.Height - lTOp - 4 * Screen.TwipsPerPixelY
        End If
    End If
    If (lWidth >= lMinWidth) And (lHeight >= lMinHeight) Then
        frmThis.Move lLeft, lTOp, lWidth, lHeight
    End If
    Key = "Maximised"
    If (CLngDefault(Value, 0) <> 0) Then
        frmThis.WindowState = vbMaximized
    End If
    Key = sSaveKey
    Default = sSaveDefault
    Exit Sub
LoadError:
    Key = sSaveKey
    Default = sSaveDefault
    m_lLastReturnCode = 0
    Exit Sub
End Sub
Public Function CLngDefault(ByVal sString As String, Optional ByVal lDefault As
 Long = 0) As Long
Dim lR As Long
On Error Resume Next
    lR = CLng(sString)
    If (Err.Number <> 0) Then
        CLngDefault = lDefault
    Else
        CLngDefault = lR
    End If
End Function 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-02-14T22:20:32.500

很多人会向您推荐 XML。问题是 XML 仍然如此流行，[有些人](http://dret.net/netdret/docs/wilde-cacm2008-xml-fever.html)在没有真正[考虑](http://www.joelonsoftware.com/articles/fog0000000296.html)的情况下到处使用它。

正如 Jeff Atwood[所说](http://www.codinghorror.com/blog/archives/001114.html)，非程序员很难阅读 XML，尤其是编辑它**。**规则太多，例如转义特殊字符和以正确顺序关闭标签。一些专家[建议](http://hsivonen.iki.fi/producing-xml/#nottext)您将 XML 视为**二进制**格式，而不是文本格式。

我建议使用 INI 文件，前提是 32K 的最大大小限制不是问题。在我自己的 VB6 的许多类似情况下，我从来没有达到这个限制。INI 文件对于普通人来说很容易编辑，并且很容易从 VB6 中读取和写入。只需使用网络上免费提供的一些出色的插入代码即可。

*   我确信 Jay Riggs 在他的回答中提供的[课程](http://www.vbaccelerator.com/home/vb/Code/Libraries/Registry_and_Ini_Files/Easy_Ini_File_Access/article.asp)非常棒，因为它来自[VBAccelerator](http://www.vbaccelerator.com)。
*   我也会推荐这[门课](http://vb.mvps.org/samples/kpINI)，因为 Karl Peterson 的任何东西都会很棒。

需要考虑的其他几点：

*   您是否考虑过将文件放入[哪个目录？](http://visualstudiomagazine.com/columns/article.aspx?editorialsid=2962)
*   您在问题中提到了“Unicode 友好”。INI 文件[不是 Unicode](http://www.siao2.com/2006/09/15/754992.aspx)，但这在实践中并不重要。除非您想存储当前代码页上不支持的字符（例如英文计算机上的中文），否则这是一个不寻常的要求，并且无论如何都会导致您在 VB6 程序中[出现其他问题](https://stackoverflow.com/questions/540361/whats-the-best-option-to-display-unicode-text-hebrew-etc-in-vb6/540975#540975)。
*   传奇的 Windows 大师 Raymond Chen 描述[了 XML 配置文件相对于 INI 文件的优势](http://blogs.msdn.com/oldnewthing/archive/2007/11/26/6523907.aspx)。其中许多依赖于只读的 XML 文件。一个合法的优势是如果数据是高度结构化的——类层次结构等。根据您的描述，不适用。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-13T21:27:13.667

是否可以接受 XML 文件：-

```
<config>
    <someAppPart
        AbsMaxVoltage="17.5"
        AbsMinVoltage="5.5"
    />
    <someOtherAppPart
        ForegroundColor="Black"
        BackgroundColor="White"
    />
</config> 
```

它在 VB6 中非常容易使用，您无需担心定位等问题。

缺点是用户对其进行调整可能使其无法解析，但是如果您为配置文件编写自己的解析器，那就是真的。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-13T12:48:58.270

如果我们可以假设您保存的设置只是一组名称/值对而没有两级层次结构要求（即“Sections”中的 INI“Keys”），您可能只是将它们保存为：

```
AbsMaxVoltage=17.5
AbsMinVoltage=5.5 
```

对于编写持久性格式，您可能会考虑使用 FSO，因为无论如何访问量都很低。FSO 可以处理读/写 Unicode 文本文件。

我想我会做一些类似读取行的事情，并在“=”上使用 Split() 来解析它们，只指定 2 个部分（因此也允许“=”在值内）。为了加载这些，我将它们存储到一个简单的类实例中，其中类有两个属性（名称和值），并使用名称作为键将每个属性添加到集合中。如果需要，将 Value 设为默认属性。

甚至可以使用生成的序列编号的特殊名称值来实现某种形式的注释文本行，该值存储为说 Name="%1" Value="comment text" 并生成唯一的名称，以避免集合键冲突。空行可能会被类似地保留。

然后根据需要持久化意味着只需在集合上使用 For Each 并使用 FSO 将 Name=Value 写入磁盘。

要模拟层次结构，您可以简单地使用以下名称：

```
%Comment: somAppPart settings
someAppPart.AbsMaxVoltage=17.5
someAppPart.AbsMinVoltage=5.5

%someOtherPart settings
someOtherAppPart.ForegroundColor=Black
someOtherAppPart.BackgroundColor=White 
```

解析很便宜，因此对 Collection 的任何探测都可能在完全重新解析之前进行（正如 INI API 调用所做的那样）。程序中值的任何更改都可能对磁盘进行完全重写（就像 INI API 调用所做的那样）。

其中一些可以通过在另一个类中用一些逻辑包装集合来自动化。结果可能是如下语法：

```
Settings("someOtherAppPart", "ForegroundColor") = "Red" 
```

又名

```
Settings.Value("someOtherAppPart", "ForegroundColor") = "Red" 
```

这将重新加载集合，然后探测集合以查找键入“someOtherAppPart.ForegroundColor”的项并创建它或将其值设置为“红色”，然后将集合刷新到磁盘。或者，您可能会避免频繁重写并使用不同的 Load 和 Save 方法。

根据需要让它变得简单或花哨。

在任何情况下，结果都是用户可以使用记事本破解的文本文件。FSO 的唯一原因是有一种简单的方式来读/写 Unicode 文本。还可以根据需要使用字节数组 I/O 和显式转换（数组到字符串）和行级解析来避免 FSO。如果是这样，请不要忘记 UTF-16LE BOM。

# apache - mod_rewrite 问题

> ID：547739
> 
> 赞同：1
> 
> 时间：2009-02-13T21:19:19.597
> 
> 标签：apache, mod-rewrite, proxy

我想在本地提供 /foo 和 /foo/ 服务，但是将 /foo/* 的请求代理到远程服务器。但是，以下规则匹配上述所有内容。我究竟做错了什么？

```
RewriteRule ^/foo/(.+)$ http://remote.host/$1 [P,L] 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-16T03:46:31.993

您需要在前几个条件下进行转义，以免它们都将它们发送到远程主机。尝试这个：

```
RewriteEngine On
RewriteRule ^foo$ /$1 [L]
RewriteRule ^foo/$ /$1 [L]
RewriteRule ^foo/([a-zA-Z0-9].*)$ http://example.com/$1 [L] 
```

第一个规则检查第一个条件是清楚的`/foo`。如果是这样，请待在家里。

下一个测试检查它是否不仅仅是`/foo/`. 如果是这样，请再次留在本地。

最后一个测试检查你是否有任何东西悬在斜线后面，如果有，那么你可能想要远程主机并将其发送到那里。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-13T22:57:42.230

我想我明白了——默认文档名被设置为 index.php，它默默地附加到我的重写中。

重写日志输出：

```
(2) init rewrite engine with requested uri /foo
(3) applying pattern '^/foo(/.+)+$' to uri '/foo'
(1) pass through /foo
(2) init rewrite engine with requested uri /foo/
(3) applying pattern '^/foo(/.+)+$' to uri '/foo/'
(1) pass through /foo/
(2) init rewrite engine with requested uri /foo/index.php
(3) applying pattern '^/foo(/.+)+$' to uri '/foo/index.php'
(2) rewrite '/foo/index.php' -> 'http://remote.host//index.php'
(2) forcing proxy-throughput with http://remote.host//index.php
(1) go-ahead with proxy request proxy:http://remote.host//index.php [OK] 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-13T21:30:29.477

好吧，由于 mod_rewrite 通常会从匹配的文本中去除前导斜杠，因此我怀疑您的转录/匿名化不完美，或者在您的重写配置中还有很多其他事情要做。模式 /foo/.+ 无法匹配 /foo 似乎进一步证实了这一点。

您能否扩展并仔细检查您从重写配置中发布的内容，以便我们可以看到可能发生的其他情况？

# python - 死简单的Django文件上传不起作用:-((

> ID：547743
> 
> 赞同：5
> 
> 时间：2009-02-13T21:19:39.660
> 
> 标签：python, django, upload

我正在拼命地尝试使用 Django 进行非常简单的文件上传，而（目前）不打扰模板和 co。

我的 HTML 是：

```
 <form 
      id="uploader" 
      action="bytes/"
      enctype="multipart/form-data" 
      method="post"
  >
      <input type="file" name="uploaded"/>
      <input type="submit" value="upload"/>
  </form> 
```

我的 Python 是（知道它是一个 POST）：

```
if path=="bytes/":
        if 'uploaded' in request.FILES:
            return HttpResponse("you uploaded a file")
        else:
            return HttpResponse("did not get the file") 
```

我不明白为什么我总是收到“没有得到文件”的消息......

谁能帮帮我，好吗？？？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-14T00:04:35.330

尝试将“ `if 'uploaded' in request.FILES:`”更改为“ `if request.FILES`”。

您可能还想查看文档；有一个例子——http [://docs.djangoproject.com/en/dev/topics/http/file-uploads/](http://docs.djangoproject.com/en/dev/topics/http/file-uploads/)

# cocoa-touch - 在 Interface Builder 中创建导航视图

> ID：547748
> 
> 赞同：2
> 
> 时间：2009-02-13T21:20:27.050
> 
> 标签：cocoa-touch, interface-builder

我正在尝试在 Interface Builder 中创建导航视图。它不在MainWindow.xib中，所以Apple Dev上的相关示例项目。网站没用。

解决这个问题的最合乎逻辑（也是最干净）的方法似乎是创建一个 Xib 文件，其中文件的所有者是 UINavigationController 的子类 - 但是，我无法让它在 IB 中工作，（因为 UINavigationController 充当文件夹，并且文件的所有者没有，即使我改变了班级）。

或者，我有一个 Xib 文件，其中文件的所有者是普通 ViewController (VCA) 的子类。我添加了一个带有 ViewController 的 NavigationController，它是 UIViewController (VCB) 的另一个子类，并且我为此 ViewController 指定了一个 Xib 视图。但是我不知道如何在 IB 中指定 VCA 的视图，并且我以编程方式执行此操作的尝试没有奏效。

请帮忙！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-14T17:52:37.573

I've had trouble doing things like this when I was getting started and the most workable approach I came up with was to create the UINavigationController programmatically. I adapted my code from the iPhone "utility" Xcode template. Here's a bit of it that will hopefully get you going: (edited for brevity; self is a UIViewController)

```
self.menuViewController = [[[MenuViewController alloc] 
                 initWithNibName:nil bundle:nil] autorelease];

self.navController = [[UINavigationController alloc] 
     initWithRootViewController:self.menuViewController];

self.navController.navigationBar.barStyle = UIBarStyleBlackOpaque;

[UIView beginAnimations:nil context:NULL];
[UIView setAnimationDuration:1];
[self.view addSubview:self.navController.view];
[UIView commitAnimations]; 
```

# c++ - 在 C++ 中读取不同格式的数据

> ID：547758
> 
> 赞同：3
> 
> 时间：2009-02-13T21:23:23.270
> 
> 标签：c++, binary, parsing

我正在创建我的第一个真正的二进制解析器（一个 tiff 阅读器）并且有一个关于如何分配内存的问题。我想在我的 TiffSpec 类中为 IFD 条目创建一个结构。这些条目将始终为 12 个字节，但根据该特定条目中指定的类型，末尾的值可能是不同的类型（或者可能只是文件中另一个位置的地址）。投射此类数据的最佳方法是什么？我相信我会处理的最小大小的内存是 1 字节。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-13T21:27:27.410

在 C++ 中，您应该使用`union`.

这是一种机制，您可以通过该机制定义多个重叠的数据类型，可能带有一个公共标头。

请参阅[这篇文章](http://www.cplusplus.com/doc/tutorial/other_data_types.html)，了解如何使用联合来解决您的问题——一个带有不同数据的通用标题。

# matlab - 如何使用 PowerPoint 2003 VBA 将图片添加到占位符中？

> ID：547764
> 
> 赞同：1
> 
> 时间：2009-02-13T21:25:34.230
> 
> 标签：matlab, vba, powerpoint

我正在尝试使用 MATLAB 创建 PowerPoint 幻灯片。它似乎与使用 VBA 创建 PowerPoint 幻灯片基本相同，只是语法略有不同。函数名和变量名都是一样的。

无论如何....我可以在幻灯片中添加图片。我还可以添加一个特定的布局，它会创建一些占位符。但我不知道如何添加图片并将其链接到特定的占位符。我想将 4 张图片导入 PowerPoint 并应用“4 对象”布局。我显然可以手动将图片放置在布局选择的相同位置。但我想将它们链接到占位符，以防我需要更改布局。

有谁知道如何添加图片并将其链接到占位符？

谢谢，安德鲁

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-14T01:38:55.400

MathWorks File Exchange 上有一些 MATLAB 代码提交，它们可以帮助您将图形从 MATLAB 移动到具有特定布局的 PowerPoint：

*   [杰迪迪亚](http://www.mathworks.com/matlabcentral/fileexchange/19322)·弗雷 (Jedediah Frey) 的 saveppt2。
*   [马克霍伊尔](http://www.mathworks.com/matlabcentral/fileexchange/20949)的 subplotPPT。
*   马克·布朗的[保存ppt 。](http://www.mathworks.com/matlabcentral/fileexchange/340)

最后提交的内容启发了前 2 个，以及其他一些可能对您有帮助的内容（链接在最后提交的致谢部分提供）。

希望这可以帮助！

# database - 是否可以使用 NHibernate 更新/更改主键？

> ID：547769
> 
> 赞同：1
> 
> 时间：2009-02-13T21:27:25.507
> 
> 标签：database, nhibernate, database-design

我有一个使用自然键（即面向业务的键）的数据库。不幸的是，正因为如此，这些对象的主键可能会随着时间而改变。

我目前正在研究将 NHibernate 用于该数据库的 O/RM。但是，在我的测试中，我注意到没有明显的方法可以更改对象的主键并将其保存到数据库中。

例如，假设我有一个带有“BusinessCode”作为主键的“Business”对象：

```
public class Business
{
    public string BusinessCode { get; set; }

    public string Name { get; set; }

    ...
} 
```

如果我执行 Get，更改主键，并尝试使用 NHibernate 将其保存回数据库，我会收到异常或意外结果（取决于我使用的是*Save()*、*Update()*还是*SaveOrUpdateCopy()*）

```
Business b = session.Get<Business>("BusinessCode1");

b.BusinessCode = "BusinessCode22";

session.Update( b ); 
```

**那么这样的事情可能吗？**

我知道许多 NHibernate 人建议使用不会改变的主键（即身份）。但是我有几个使用自然键的数据库。谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-13T23:21:11.597

实际上，我什至问了这个问题，因为我可以通过执行删除插入类型的操作轻松缓解这个问题。这更像是对现有数据库的概念验证。感谢您的输入！

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-13T22:27:19.077

您是否尝试过使用[复合标识](http://www.hibernate.org/hib_docs/nhibernate/1.2/reference/en/html/mapping.html#mapping-declaration-compositeid)？
或[分配的标识符](http://www.hibernate.org/hib_docs/nhibernate/1.2/reference/en/html/mapping.html#mapping-declaration-id-assigned)？

添加自动递增的 ID 字段完全不可能吗？

# sql - 将行转换为列

> ID：547777
> 
> 赞同：1
> 
> 时间：2009-02-13T21:30:42.830
> 
> 标签：sql, ms-access

在 Access 中执行此操作的最佳方法是什么？

```
Create table tmp
(
  plant int,
  material vchar(20),
  workcenter int,
  setuptime vchar(20)
)

insert into tmp values( 1, mat1, 2, 30)
insert into tmp values( 1, mat1, 3, 30)
insert into tmp values( 1, mat2, 3, 30)
insert into tmp values( 1, mat2, 4, 30)
insert into tmp values( 2, mat1, 4, 30)
insert into tmp values( 2, mat1, 5, 30) 
```

结果需要看起来像。

```
Plant  Material  Workcenter1  Setuptime1  Workcenter2  Setuptime2
1      Mat1      2            30          3            30
1      Mat2      3            30          4            30
2      Mat1      4            30          5            30 
```

我在想这可能会奏效，但必须有更好的方法。

```
SELECT t.Plant, 
    t.Material, 
    t.Workcenter as Workcenter1, 
    t.setuptime as SetupTime1
    t2.Workcenter as Workcenter2, 
    t2.setuptime as SetupTime2
FROM tmp t
LEFT JOIN tmp t2
  on t.plant = t2.plant
  and t.material = t2.material 
```

谢谢一堆。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-13T21:50:49.210

您是否尝试过交叉表查询？

**编辑**

（重新格式化您的问题后，我感觉更好）

您的解决方案几乎可以工作。但是你会得到双重条目（像这样）：

```
Plant  Material  Workcenter1  Setuptime1  Workcenter2  Setuptime2
1      Mat1      2            30          2            30
1      Mat1      2            30          3            30
1      Mat1      3            30          2            30
1      Mat1      3            30          3            30
1      Mat2      3            30          4            30
1      Mat2      3            30          3            30
1      Mat2      4            30          3            30
1      Mat2      4            30          4            30
2      Mat1      4            30          5            30
2      Mat1      4            30          4            30
2      Mat1      5            30          5            30
2      Mat1      5            30          4            30 
```

如果你有两个以上的工作中心，那就更糟了。

所以你想要的是一个列指示器

```
Create table tmp
(
  plant int,
  material vchar(20),
  workcenter int,
  setuptime vchar(20),
  myCol int
); 
```

（顺便说一句，vchars 不能在 ms-access/Jet 中工作......虽然 chars 会）

```
insert into tmp values( 1, mat1, 2, 30, 1);
insert into tmp values( 1, mat1, 3, 30, 2);
insert into tmp values( 1, mat2, 2, 30, 1);
insert into tmp values( 1, mat2, 3, 30, 2);
insert into tmp values( 2, mat1, 4, 30, 1);
insert into tmp values( 2, mat1, 5, 30, 2);

SELECT tmp.plant, tmp.material, tmp.workcenter,   tmp.setuptime,
                                tmp_1.workcenter, tmp_1.setuptime
FROM tmp INNER JOIN tmp AS tmp_1 ON (tmp.material = tmp_1.material)
    AND (tmp.plant = tmp_1.plant)
WHERE   (((tmp.myCol)=1)
    AND ((tmp_1.myCol)=2)); 
```

当然，如果您可以编辑原始表，也许您只想添加第二个 Workcenter 和 Setuptime 列，

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-13T23:01:20.740

您的示例输出不清楚 - 我认为它看起来像：

```
Plant | Mat  | Wkcntr1 | STime1 | Wkcntr2 | STime2 
1     | Mat1 | 2       | 30     | 3       | 30 
1     | Mat2 | 3       | 30     | 4       | 30 
2     | Mat1 | 4       | 30     | 5       | 30 
```

我会说这张桌子的布置并不理想。它看起来没有主键，因此不清楚哪条记录属于 1 列，哪些记录属于 2 列。

我会为 RecordNumber 添加一个额外的字段（即 1 或 2），然后您就有了 Plant、Material 和 RecordNumber 的主键。

您的查询将如下所示：

```
SELECT tmp.plant, tmp.material, tmp.workcenter AS W1, tmp.setuptime AS S1, tmp_1.workcenter AS W2, tmp_1.setuptime AS S2
FROM tmp INNER JOIN tmp AS tmp_1 ON (tmp.material = tmp_1.material) AND (tmp.plant = tmp_1.plant)
WHERE (((tmp.recordNum)=1) AND ((tmp_1.recordNum)=2)); 
```

这仅适用于有限（且已知）数量的东西（无论 1 和 2 代表什么）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-16T16:39:06.333

根据我对您要解决的问题的理解，我认为使用标准 SQL 查询（至少在 Access 中不可行）是不可行的。

我试图破解一些你想要的代码（我认为）。

**如何使用它**

只需将以下代码复制/粘贴到 VBA 模块中即可。
从代码中，或者，如果您想测试它，从 VBA IDE 即时窗口中调用：

```
ExpandTable 
```

**假设**

*   该表`temp`包含您要扩展的数据，其中包含工厂/材料/工作站/等
*   该`temp`表不为空（我省略了一些代码检查以避免样本膨胀）。
*   扩展表将在一个名为 的新表中创建`result`。

**代码**

```
Public Sub ExpandTable()

    Dim db As DAO.Database
    Dim rs As DAO.Recordset, rs2 As DAO.Recordset
    Dim td As DAO.TableDef
    Dim fd As DAO.Field
    Dim maxWorkCenters As Integer
    Dim i As Integer
    Dim sql As String

    Set db = CurrentDb

    ' Delete the old result table if there was one '
    On Error Resume Next
    db.TableDefs.Delete "result"
    On Error GoTo 0

    ' Create the result table '
    Set td = db.CreateTableDef("result")
    td.Fields.Append td.CreateField("Plant", dbInteger)
    td.Fields.Append td.CreateField("Material", dbText)
    ' Get the maximum number of workcenters we will need '
    ' for a given Plan/Material combination '
    sql = "SELECT Count(*) FROM Temp GROUP BY Plant, Material"
    Set rs = db.OpenRecordset(sql, dbOpenSnapshot)
    maxWorkCenters = Nz(rs.Fields(0).Value, 0)
    rs.Close
    Set rs = Nothing
    ' Create as many columns as we need to fit all these combinations '
    For i = 1 To maxWorkCenters
        td.Fields.Append td.CreateField("WorkCenter" & i, dbText)
        td.Fields.Append td.CreateField("SetupTime" & i, dbInteger)
    Next i
    db.TableDefs.Append td

    ' Now get the data into the new table '
    Dim lastPlant As Variant, lastMaterial As Variant
    Dim curcol As Integer
    sql = "SELECT Plant, Material, Workcenter, Setuptime FROM Temp ORDER BY Plant, Material, WorkCenter"
    Set rs = db.OpenRecordset(sql, dbOpenSnapshot)
    Set rs2 = db.OpenRecordset("result", dbOpenDynaset)
    With rs
        lastPlant = 0
        lastMaterial = ""
        Do While Not .EOF
            If (Nz(!Plant) <> lastPlant) Or (Nz(!Material) <> lastMaterial) Then
                If rs2.EditMode = dbEditAdd Then
                    ' Save the previously edited record if any '
                    rs2.Update
                End If

                ' Different plant/material, so we add a new result '
                rs2.AddNew
                rs2!Plant = !Plant
                rs2!Material = !Material
                rs2!WorkCenter1 = !WorkCenter
                rs2!SetupTime1 = !Setuptime
                lastPlant = Nz(!Plant)
                lastMaterial = Nz(!Material)
                curcol = 1
            Else
                ' Same plant/material combi, so we fill the next column set '
                curcol = curcol + 1
                rs2.Fields("Workcenter" & curcol).Value = !WorkCenter
                rs2.Fields("SetupTime" & curcol).Value = !Setuptime
            End If
            .MoveNext
        Loop
        If rs2.EditMode = dbEditAdd Then
            ' Save the last result '
            rs2.Update
        End If
    End With

    Set rs2 = Nothing
    Set rs = Nothing
    Set db = Nothing

End Sub 
```

**关于代码**

*   `result`每次运行时都会完全重新创建该表`ExpandTable`。
*   附加`WorkCenterX`和`SetupTimeX`列的数量适应唯一植物/材料对的实际数量。
*   您必须修改代码以满足您的确切需求。
*   您还必须对其进行一些清理，因为有些事情可能会更好地表达，但您会开玩笑。

**测试数据库**

[您可以从http://blog.nkadesign.com/wp-content/uploads/SO/SO547777.zip](http://blog.nkadesign.com/wp-content/uploads/SO/SO547777.zip)下载测试 Access 2000 数据库。

无论如何，希望它做你想要的，或者至少让你更接近。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-13T21:32:54.633

我不太了解访问语法，无法为您提供完整的答案，但为了帮助您自己进行调查，我可以告诉您，您正在尝试做的事情称为“交叉表”查询或“数据透视”。

在谷歌中使用这些关键字应该可以帮助你。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-13T21:45:42.170

在访问中的查询向导中有一个交叉表选项，可以将您的表格水平放置。这不是你要找的吗？

# excel - 自动创建 Outlook 约会

> ID：547783
> 
> 赞同：4
> 
> 时间：2009-02-13T21:32:49.627
> 
> 标签：excel, outlook

我有一个跟踪到期日期的电子表格（excel 2003），我想知道是否有办法让这些到期日期在 Outlook 中创建约会（提醒）。到期日期在一个字段中，实体名称在电子表格的另一列中。理想情况下，我希望 Outlook (2003) 获取日期（显然）和实体名称。

提前感谢您的帮助

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-13T21:38:42.827

您可以使用 VBA 宏来创建外观约会。以下 2 个链接将帮助您入门。

1.  [使用 VBA 创建 Outlook 约会](http://www.eggheadcafe.com/software/aspnet/31626975/create-custom-appointment.aspx)
2.  [Outlook代码](http://www.outlookcode.com/article.aspx?id=40)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-15T22:24:09.087

这是一些示例代码。

```
Sub CreateCalEntry(LeadDate As Date, DueDate As Date, _
            Subject As String, Location As String, _
            Body As String, _
            Optional AddToShared As Boolean = True)

'Lead date = expect notify from data'
'Due date - expect event due date'
'Add to shared - add item to shared calendar, '
'hard coded as 'Shared Calendar''

Const olApItem = 1

Dim apOL As Object 'Outlook.Application '
Dim oItem As Object 'Outlook.AppointmentItem '
Dim objFolder As Object 'MAPI Folder '

    Set apOL = CreateObject("Outlook.Application")
    Set objFolder = GetFolder( _
         "Public Folders/All Public Folders/Shared Calender")
    Set oItem = apOL.CreateItem(olApItem)

    With oItem
        .Subject = Subject
        .Location = Location
        .Body = Body

        If IsDate(LeadDate) Then
            .Start = DueDate
        Else
            .Start = DueDate
        End If

        If AddToShared = True Then
            .Move objFolder
        End If

        .Display
    End With

    Set oItem = Nothing
    Set apOL = Nothing

End Sub

Public Function GetFolder(strFolderPath As String) As Object 
' strFolderPath needs to be something like '
'   "Public Folders\All Public Folders\Company\Sales" or '
'   "Personal Folders\Inbox\My Folder" '
'This code is from: 
'http://www.outlookcode.com/d/code/getfolder.htm '

Dim apOL As Object 'Outlook.Application '
Dim objNS As Object 'Outlook.NameSpace '
Dim colFolders As Object 'Outlook.Folders '
Dim objFolder As Object 'Outlook.MAPIFolder '
Dim arrFolders() As String 
Dim I As Long

    strFolderPath = Replace(strFolderPath, "/", "\")
    arrFolders() = Split(strFolderPath, "\")

    Set apOL = CreateObject("Outlook.Application")
    Set objNS = apOL.GetNamespace("MAPI")

    On Error Resume Next

    Set objFolder = objNS.Folders.Item(arrFolders(0))

    If Not objFolder Is Nothing Then
        For I = 1 To UBound(arrFolders)
            Set colFolders = objFolder.Folders
            Set objFolder = Nothing
            Set objFolder = colFolders.Item(arrFolders(I))

            If objFolder Is Nothing Then
                Exit For
            End If
        Next
    End If

    Set GetFolder = objFolder
    Set colFolders = Nothing
    Set objNS = Nothing
    Set apOL = Nothing

End Function 
```

来自：[http ://wiki.lessthandot.com/index.php/Create_Outlook_Appointment%2C_Shared_Folder](http://wiki.lessthandot.com/index.php/Create_Outlook_Appointment%2C_Shared_Folder)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-15T21:51:31.910

您可以通过会议邀请来做到这一点。他们不会被自动接受，但他们会在那里。会议邀请只是标题中包含特殊内容的电子邮件。

# c# - 为什么在 C# 中使用 finally？

> ID：547791
> 
> 赞同：199
> 
> 时间：2009-02-13T21:36:32.893
> 
> 标签：c#, exception-handling

finally 块中的任何内容都（几乎）总是执行，那么将代码封闭到其中或不封闭有什么区别？

* * *

## 回答 #1

> 赞同：426
> 
> 时间：2009-02-13T21:42:24.660

无论是否有异常，finally 块中的代码都会被执行。当涉及到您需要始终像关闭连接一样运行的某些内务管理功能时，这非常方便。

现在，我*猜*你的问题是为什么你应该这样做：

```
try
{
    doSomething();
}
catch
{
    catchSomething();
}
finally
{
    alwaysDoThis();
} 
```

什么时候可以这样做：

```
try
{
    doSomething();
}
catch
{
    catchSomething();
}

alwaysDoThis(); 
```

答案是很多时候，你的 catch 语句中的代码要么重新抛出异常，要么跳出当前函数。对于后一个代码，“alwaysDoThis();” 如果 catch 语句中的代码发出 return 或抛出新的异常， call 将不会执行。

* * *

## 回答 #2

> 赞同：62
> 
> 时间：2009-02-13T21:47:37.783

已经指出了使用 try-finally 的大多数优点，但我想我会添加这个：

```
try
{
    // Code here that might throw an exception...

    if (arbitraryCondition)
    {
        return true;
    }

    // Code here that might throw an exception...
}
finally
{
    // Code here gets executed regardless of whether "return true;" was called within the try block (i.e. regardless of the value of arbitraryCondition).
} 
```

这种行为使它在各种情况下都非常有用，特别是当您需要执行清理（释放资源）时，尽管在这种情况下*使用*块通常更好。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2009-02-13T22:04:50.580

任何时候您使用非托管代码请求，如流阅读器、数据库请求等；并且您想捕获异常然后使用try catch finally 并在finally 中关闭流、数据读取器等，如果您在出错时不关闭连接，这对于数据库请求来说真的很糟糕

```
 SqlConnection myConn = new SqlConnection("Connectionstring");
        try
        {
            myConn.Open();
            //make na DB Request                
        }
        catch (Exception DBException)
        {
            //do somehting with exception
        }
        finally
        {
           myConn.Close();
           myConn.Dispose();
        } 
```

如果您不想捕获错误，请使用

```
 using (SqlConnection myConn = new SqlConnection("Connectionstring"))
        {
            myConn.Open();
            //make na DB Request
            myConn.Close();
        } 
```

如果出现错误，连接对象将被自动处理，但您不会捕获错误

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2009-02-13T21:37:33.237

因为即使您不在 catch 块中处理异常，finally 也会被执行。

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2013-08-05T10:48:38.740

finally 语句即使在 return 之后也可以执行。

```
private int myfun()
{
    int a = 100; //any number
    int b = 0;
    try
    {
        a = (5 / b);
        return a;
    }
    catch (Exception ex)
    {
        Response.Write(ex.Message);
        return a;
    }

 //   Response.Write("Statement after return before finally");  -->this will give error "Syntax error, 'try' expected"
    finally
    {
      Response.Write("Statement after return in finally"); // --> This will execute , even after having return code above
    } 

    Response.Write("Statement after return after finally");  // -->Unreachable code
} 
```

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2009-02-13T21:38:46.803

`finally`，如：

```
try {
  // do something risky
} catch (Exception ex) {
  // handle an exception
} finally {
  // do any required cleanup
} 
```

是保证在你的块之后执行代码的机会`try..catch`，不管你的 try 块是否抛出异常。

这使得它非常适合释放资源、数据库连接、文件句柄等。

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2017-12-11T12:43:22.280

我将解释 finally 与**文件阅读器异常**示例的使用

*   **最终**不使用

 **> ```
> try{
> 
>   StreamReader strReader = new StreamReader(@"C:\Ariven\Project\Data.txt");
>   Console.WriteLine(strReader.ReadeToEnd());
>   StreamReader.Close();
> }
> catch (Exception ex)
> {
>   Console.WriteLine(ex.Message);
> } 
> ```

在上面的示例中，如果缺少名为**Data.txt的***文件*，则会引发异常并进行处理，但永远不会执行调用的*语句。**因为这个与阅读器相关的资源从未被释放。****`StreamReader.Close();`*** 

 *****   为了解决上述问题，我们使用**finally**

> ```
> StreamReader strReader = null;
> try{
>     strReader = new StreamReader(@"C:\Ariven\Project\Data.txt");
>     Console.WriteLine(strReader.ReadeToEnd());
> }
> catch (Exception ex){
>     Console.WriteLine(ex.Message);
> }
> finally{
>     if (strReader != null){
>         StreamReader.Close();
>     }
> } 
> ```

快乐编码:)

**注意：** “@”用于创建**逐字**字符串，以避免出现“无法识别的转义序列”的错误。@ 符号表示按字面意思阅读该字符串，否则不解释控制字符。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-02-13T21:38:06.977

假设您需要将光标设置回默认指针而不是等待（沙漏）光标。如果在设置光标之前抛出异常，并且不会彻底使应用程序崩溃，那么您可能会留下一个令人困惑的光标。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-02-13T21:39:23.527

[finally 块](http://msdn.microsoft.com/en-us/library/zwc8s4fz(VS.80).aspx)对于清理在 try 块中分配的任何资源以及运行任何必须执行的代码（即使出现异常）都很有价值。不管 try 块如何退出，控制总是传递给 finally 块。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2009-02-13T21:45:04.590

有时您不想处理异常（没有 catch 块），但您希望执行一些清理代码。

例如：

```
try
{
    // exception (or not)
}
finally
{
    // clean up always
} 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-02-13T21:43:40.460

啊……我想我明白你在说什么了！花了我一秒钟......你想知道“为什么将它放在 finally 块中而不是在 finally 块之后并且完全在 try-catch-finally 之外”。

举个例子，这可能是因为如果你抛出一个错误，你正在停止执行，但你仍然想清理资源，例如打开的文件、数据库连接等。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2017-04-20T14:52:32.590

finally 块的控制流在 Try 或 Catch 块之后。

```
[1\. First Code]
[2\. Try]
[3\. Catch]
[4\. Finally]
[5\. After Code] 
```

例外 1 > 2 > 3 > 4 > 5 如果 3 有一个 Return 语句 1 > 2 > 3 > 4

无异常 1 > 2 > 4 > 5 如果 2 有返回语句 1 > 2 > 4

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2019-07-28T10:58:00.417

如[文档](https://docs.microsoft.com/en-us/dotnet/csharp/language-reference/keywords/try-catch-finally)中所述：

> catch 和 finally 一起的常见用法是在 try 块中获取和使用资源，在 catch 块中处理异常情况，并在 finally 块中释放资源。

[这](https://docs.microsoft.com/en-us/dotnet/csharp/language-reference/language-specification/exceptions#how-exceptions-are-handled)也值得一读，其中指出：

> 一旦找到匹配的 catch 子句，系统就准备将控制权转移到 catch 子句的第一条语句。在开始执行 catch 子句之前，系统首先按顺序执行与 try 语句关联的所有 finally 子句，它们的嵌套比捕获异常的语句更嵌套。

所以很明显，`finally`即使前面的`catch`子句有`return`语句，驻留在子句中的代码也会被执行。

# .net - 与第 3 方网站的集成导致表单身份验证问题

> ID：547796
> 
> 赞同：0
> 
> 时间：2009-02-13T21:38:13.593
> 
> 标签：.net, asp.net, forms-authentication

这就是问题所在。我正在为帐户余额类型的网站使用 ASP.NET 表单身份验证。用户登录后，他们可以通过访问第三方网站 (3pw) 对他们的帐户进行付款。当用户点击付款时，会发生以下情况：

1.  我的网站向传递 id 的 3pw 发出请求。
2.  3pw 向我的站点发出请求，传递 id 和安全 id。
3.  我验证东西....
4.  发生了更多你不需要关心的事情......

当我测试这个过程时，我可以在网络日志中看到我正在访问我网站上的一次性付款页面。使用 Live HTTPHeaders 之类的东西，我可以看到对 3pw 网站的请求（步骤#1）。然后网络日志显示从 3pw 到我的站点的请求（步骤#2），但日志中的下一个条目是对我的站点登录页面的新请求。

```
login.aspx?ReturnUrl=mypage.aspx 
```

3pw 不知道如何处理重定向到登录页面然后失败。问题是当请求从 3pw 传入 mypage.aspx 时，为什么我的站点认为用户不再经过身份验证？我已经查看了我的 cookie，并且我登录时创建的 cookie 仍然存在。那不应该告诉服务器我仍然是经过身份验证的用户吗？

这是我的 web.config 中的内容

```
<authentication mode="Forms">
  <forms defaultUrl="~/somepage.aspx" 
     loginUrl="~/login.aspx"
         protection="All"
     timeout="30" 
     name="MyCookieName"
     enableCrossAppRedirects="true"
     requireSSL="true"/>
</authentication>

<location path="manage">
  <system.web>
    <authorization>
      <allow roles="UserRole" />
      <deny users="?" />
    </authorization>
  </system.web>
</location> 
```

经过身份验证的用户属于角色 UserRole。3pw 请求的页面位于 Manage 目录中。3pw 不是用 .NET 编写的，我无法控制它的配置。

**更新：**

如果我不够清楚，我深表歉意。让我重述一下步骤。

1.  用户登录我的网站并通过身份验证。
2.  用户转到我网站上的一次性付款页面。
3.  在一次性付款页面上，用户单击“付款”按钮。
4.  Make Payment 按钮向 3pw 发出 GET 请求，并在查询字符串中传递一个 id。
5.  3pw 看到请求并向我网站上的验证页面发出 POST 请求。

发生错误的是验证页面的帖子。根据日志文件，对验证页面的请求被重定向到登录页面。我的 Web 服务器看到请求进入，尝试为页面提供服务，但发现用户未通过身份验证，并将请求重定向到登录。这部分让我感到困惑，因为我认为服务器会查看用户是否已通过身份验证，并且由于 cookie 仍然存在，因此它们仍然存在，因此提供请求的页面。

也许我不完全了解整个过程，但是由于我的登录用户对 3pw 的请求是由我的登录用户发起的，所以从 3pw 向我的站点返回的任何请求是否仍属于我的用户？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-13T22:01:32.600

您是说第 3 方网站向您的网站发出请求（第 2 步）？

如果我理解正确，则不会验证此请求，因为它不是来自用户，而是来自第 3 方网站。

**编辑：**

根据您更新的信息，我最初的想法是正确的。ASP.NET 运行时无法知道来自第 3 方网站的请求是“来自用户”的，因为它是完全来自不同位置的单独 POST 请求。

有几种方法可以解决这个问题，如 Daniel Auger 建议的一种方法，您可以`accountPostback.aspx`向所有人开放您的页面。这可能对您来说足够好。

如果你想锁定一点，我想你可以做这样的事情（假设第 3 方网站有一个静态 IP 地址）：

```
// In Global.asax...
void Authenticate_Request(object sender, EventArgs e)
{
    if (Context.Request.ServerVariables["HTTP_X_FORWARDED_FOR"] == System.Web.Configuration.WebConfigurationManager.AppSettings["ThirdPartyWebsiteIP"])
    {
        Context.User = new System.Security.Principal.GenericPrincipal(new System.Security.Principal.GenericIdentity("ThirdPartyWebsite"), new string[] {"AccountPostbackPermission"});
    }
} 
```

并更新您的 web.config appSettings：

```
<configuration>
  <configSections>
    <appSettings>
      <add key="ThirdPartyWebsiteIP" value="127.0.0.1" /> // edit this IP address to match the 3rd party's website's IP address
    </appSettings>
  <configSections>
<configuration> 
```

还有授权：

```
<location path="manage">
  <system.web>
    <authorization>
      <allow roles="AccountPostbackPermission" />
      <deny users="?" />
    </authorization>
  </system.web>
</location> 
```

当然，如果站点使用动态 IP 地址，这将不起作用，您将被迫只允许所有人访问该页面。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-13T22:09:04.127

您能否澄清“请求”的含义？如果您的意思是他们从他们的服务器向您的服务器发起**GET 或 POST 请求**，那么 John Rasch 是正确的：他们没有您的身份验证 cookie。如果您的意思是他们**重定向**到您的站点，那么经过身份验证的用户的浏览器实际上正在发出请求，在这种情况下，它似乎应该可以工作。

请澄清...谢谢！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-14T19:21:17.767

如果您希望第三方网站回发到您网站上的页面，则需要在表单身份验证配置中为该页面设置例外。您不希望发布的页面受到保护。

允许资源不受保护的示例：

```
 <location path="accountPostback.aspx">
    <system.web>
      <authorization>
        <allow users="*" />
      </authorization>
    </system.web>
  </location> 
```

# vim - 按列遍历搜索结果

> ID：547797
> 
> 赞同：3
> 
> 时间：2009-02-13T21:38:27.943
> 
> 标签：vim, emacs, csv, flat-file

`n`Vim（或插件）中有没有一种方法可以按列而不是按行搜索一个术语并遍历搜索结果（根据Vim）？所以如果我的文件是这样的：

```
foo1  bar   bar
baz   baz   foo3
baz   baz   foo4
foo2  bar   bar 
```

如果我搜索，`foo`我想按 1、2、3、4 的顺序遍历结果。通常`n`会让我按 1、3、4、2 的顺序穿过它们。

例如，我希望它浏览一个巨大的固定宽度数据文件或 CSV 文件中的搜索结果，其中列代表字段。

（我也会在 Emacs 中找到一种方法来代替。:)

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-16T13:50:06.507

看到这个问题后，我决定尝试编写一个 vim 插件来处理它。这是我的第一个 vim 插件，所以它可能非常糟糕。但是，它确实适用于您给出的示例。

你可以从 vim.org 下载插件： [SearchCols.vim](http://www.vim.org/scripts/script.php?script_id=2543)

请注意，它还需要来自同一站点的 multvals 插件： [multvals.vim](http://www.vim.org/scripts/script.php?script_id=171)

它创建一个 command `:SearchCols <string>`，可用于搜索`<string>`固定宽度的列，以便搜索首先在第一列中查找，然后在第二列中查找，等等，而不是 vim 标准的逐行搜索. `@:`通过然后重复该命令，`@@`因为它是一个冒号命令。

假设：

*   假设您的文件是用空格分隔的固定宽度列格式化的，即数据项内没有空格，只有在它们之间。
*   假设文件的第一行已格式化，以便可以从中推断出列宽。

我能想到的明显改进是使搜索下一个项目比使用`@:`和更容易`@@`，包括搜索突出显示（代码在那里但它被注释掉，因为它使用`:match`并且你必须使用`:match none`它来关闭它），并消除对 multvals.vim 的依赖。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-14T00:06:52.753

[编辑：我刚刚在这里](http://www.geocities.com/volontir/?200914#tables)找到了对表使用 vim 正则表达式的概述。这比我的业余尝试要干净得多（尽管这也有效；））：

搜索`^foo`将搜索第一列，而搜索`.*\ foo`将搜索第二列，`.*\ .*\ foo`并将搜索第三列。

这当然是不完整的，因为它匹配从行首开始的整个块，所以它会找到 foo3 和 foo4 但将光标放在位置 0。

但是，您可以使用录制功能自动执行此操作。在正常模式下准确键入以下内容：

```
qa/.*\ .*\ foo
/foo
q 
```

（我用新行表示你应该按回车键）。

这会在 a 寄存器下进行两次搜索（qa 在 a 下开始记录，qb 在 b 下开始记录，等等）。现在点击`@a`，你应该只搜索第三列......

我敢肯定你可以把它变成一个带有列号的命令，但我现在走了，对不起:)

# python - Python使用正则表达式替换的函数结果

> ID：547798
> 
> 赞同：5
> 
> 时间：2009-02-13T21:38:30.177
> 
> 标签：python, regex

我有一个文本块，对于每个正则表达式匹配，我想用另一个函数的返回值替换那个匹配。这个函数的参数当然是匹配的文本。

我一直无法想出一个解决这个问题的一次性解决方案。感觉应该很简单。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-02-13T21:45:58.723

就[在文档中](http://docs.python.org/library/re.html#re.sub)：

```
>>> def dashrepl(matchobj):
...     if matchobj.group(0) == '-': return ' '
...     else: return '-'
>>> re.sub('-{1,2}', dashrepl, 'pro----gram-files')
'pro--gram files' 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-13T21:47:22.167

与 Python 无关：匹配要替换的文本之前和之后的所有内容。

```
/^(.*?)(your regexp to match)(.*)$/ 
```

然后在要替换的文本之前和之后都有下一个。其余的很简单——只需在两个字符串之间插入函数的结果。

# mysql - 是否可以通过存储过程更改 mySql 中的表？

> ID：547804
> 
> 赞同：3
> 
> 时间：2009-02-13T21:40:35.507
> 
> 标签：mysql, stored-procedures

这就是我想在 mySQL 中做的事情......我感觉这根本不可行，但很想错......

```
create procedure foo(IN MYTABLE varchar(50) , IN COLNAME varchar (50), IN MYTYPE varchar(50)) 
begin 
IF (select count(*) from information_schema.columns where table_name =MYTABLE and column_name = COLNAME) = 0 
THEN
alter table MYTABLE add column MYNAME MYTYPE; 
end;

call foo( 'table_foo' , 'column_bar' , 'varchar(100)' ); 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-13T21:56:40.473

不知道为什么在地球上你会想要它，但它是可能的：

```
DELIMITER //
DROP PROCEDURE foo//
CREATE PROCEDURE foo(IN MYTABLE varchar(50) , IN COLNAME varchar (50), IN MYTYPE varchar(50))
BEGIN
  SET @ddl = CONCAT('alter table ', MYTABLE, ' add column (', COLNAME, ' ', MYTYPE, ')');
  PREPARE STMT FROM @ddl;
  EXECUTE STMT;
END;
// 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2011-05-11T18:15:49.200

简短回答我为什么要这样做。

当您的架构版本在已发布产品中发生更改时更新已部署的数据库。Shell 脚本对于跨平台代码来说是一个糟糕的选择，因此 SQL 中的脚本非常棒，只需记住在使用后删除这些过程。如果我部署了 1.1 但在更新时处于 1.4，我只需按顺序运行 1.1->1.2、1.2->1.3 和 1.3->1.4 脚本。

# maven-2 - 排除单个依赖项的所有传递依赖项

> ID：547805
> 
> 赞同：241
> 
> 时间：2009-02-13T21:40:45.117
> 
> 标签：maven-2, dependencies

在 Maven2 中，要排除单个传递依赖项，我必须执行以下操作：

```
<dependency>
  <groupId>sample.group</groupId>
  <artifactId>sample-artifactB</artifactId>
  <version>1</version>
   <exclusions>
     <exclusion>
       <groupId>sample.group</groupId>
       <artifactId>sample-artifactAB</artifactId>
     </exclusion>
   </exclusions>
</dependency> 
```

这种方法的问题是我必须为每个由`sample-artifactB`.

有没有办法使用某种通配符来一次排除所有传递依赖项而不是一个接一个？

* * *

## 回答 #1

> 赞同：345
> 
> 时间：2011-09-26T14:31:25.890

对我有用的东西（可能是 Maven 的一个新特性）只是在排除元素中使用通配符。

我有一个多模块项目，其中包含在两个 WAR 打包模块中引用的“应用程序”模块。其中一个 WAR 打包的模块实际上只需要域类（我还没有将它们从应用程序模块中分离出来）。我发现这个工作：

```
<dependency>
    <groupId>${project.groupId}</groupId>
    <artifactId>app</artifactId>
    <version>${project.version}</version>
    <exclusions>
        <exclusion>
            <groupId>*</groupId>
            <artifactId>*</artifactId>
        </exclusion>
    </exclusions>
</dependency> 
```

groupId 和 artifactId 上的通配符排除了所有通常会传播到使用此依赖项的模块的依赖项。

* * *

## 回答 #2

> 赞同：56
> 
> 时间：2009-02-13T23:22:07.837

对于 maven2，没有办法按照您的描述进行操作。对于 Maven 3，有。如果您使用的是 maven 3，请查看[此问题的另一个答案](https://stackoverflow.com/a/7556707/46375)

对于 maven 2，我建议为具有 <exclusions> 的依赖项创建自己的自定义 pom。对于需要使用该依赖项的项目，请将依赖项设置为您的自定义 pom 而不是典型的工件。虽然这不一定允许您使用单个 <exclusion> 排除所有传递依赖项，但它确实允许您只需要编写一次依赖项，并且您的所有项目都不需要维护不必要的长排除列表。

* * *

## 回答 #3

> 赞同：37
> 
> 时间：2011-02-14T18:45:33.463

我发现有用的一件事：

如果您将带有排除项的依赖项放在项目的父 POM 的 dependencyManagement 部分中，或者放在可导入的依赖项管理 POM 中，则无需重复排除项（或版本）。

例如，如果您的父 POM 具有：

```
<dependencyManagement>
    <dependencies>
    ...         
        <dependency>
            <groupId>commons-fileupload</groupId>
            <artifactId>commons-fileupload</artifactId>
            <version>1.2.1</version>
            <exclusions>
                <exclusion>
                    <groupId>junit</groupId>
                    <artifactId>junit</artifactId>
                </exclusion>
            </exclusions>
        </dependency>
     ....
  </dependencies>
</dependencyManagement> 
```

然后项目中的模块可以简单地将依赖声明为：

```
 <dependency>
            <groupId>commons-fileupload</groupId>
            <artifactId>commons-fileupload</artifactId>
        </dependency> 
```

父 POM 中的 将指定版本和排除项。我几乎在我们所有的项目中都使用了这种技术，它消除了很多重复。

* * *

## 回答 #4

> 赞同：24
> 
> 时间：2012-04-30T22:10:33.510

[三年前](https://stackoverflow.com/a/547818/62130)我推荐使用版本 99 不存在，但现在我想出了一个更好的方法，尤其是版本 99 离线后：

在项目的父 POM 中，如果不需要的依赖项潜入构建，请使用[maven-enforcer-plugin](http://maven.apache.org/plugins/maven-enforcer-plugin/index.html)使构建失败。这可以使用插件的[禁止依赖](http://maven.apache.org/enforcer/enforcer-rules/bannedDependencies.html)规则来完成：

```
<plugin>
    <artifactId>maven-enforcer-plugin</artifactId>
    <version>1.0.1</version>
    <executions>
        <execution>
            <id>only-junit-dep-is-used</id>
            <goals>
                <goal>enforce</goal>
            </goals>
            <configuration>
                <rules>
                    <bannedDependencies>
                        <excludes>
                            <exclude>junit:junit</exclude>
                        </excludes>
                    </bannedDependencies>
                </rules>
            </configuration>
        </execution>
    </executions>
</plugin> 
```

然后，当它提醒您有关不需要的依赖项时，将其排除在父 POM 的`<dependencyManagement>`部分中：

```
<dependency>
    <groupId>org.springframework.batch</groupId>
    <artifactId>spring-batch-test</artifactId>
    <version>2.1.8.RELEASE</version>
    <exclusions>
        <exclusion>
            <groupId>junit</groupId>
            <artifactId>junit</artifactId>
        </exclusion>
    </exclusions>
</dependency> 
```

这样，不需要的依赖项不会意外出现（不像`<exclusion>`容易忘记的那样），即使在编译时也不可用（不像`provided`范围），没有虚假的依赖项（不像版本 99）并且它'将在没有自定义存储库的情况下工作（与版本 99 不同）。这种方法甚至可以根据工件的版本、分类器、范围或整个 groupId 工作 -有关详细信息，[请参阅文档](http://maven.apache.org/enforcer/enforcer-rules/bannedDependencies.html)。

* * *

## 回答 #5

> 赞同：14
> 
> 时间：2013-04-02T13:52:19.920

我使用以下解决方法：我没有尝试在所有适当的依赖项中排除工件，而是在顶层将依赖项绘制为“提供”。例如，为了避免发送 xml-apis "whatever version" ：

```
 <dependency>
        <groupId>xml-apis</groupId>
        <artifactId>xml-apis</artifactId>
        <version>[1.0,]</version>
        <scope>provided</scope>
    </dependency> 
```

* * *

## 回答 #6

> 赞同：9
> 
> 时间：2009-07-30T20:26:03.343

目前，没有办法一次排除多个传递依赖，但在 Maven JIRA 站点上有一个功能请求：

[https://issues.apache.org/jira/browse/MNG-2315](https://issues.apache.org/jira/browse/MNG-2315)

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2009-07-30T20:28:33.463

有一个解决方法，如果将依赖项的范围设置为*runtime*，传递依赖项将被排除。尽管请注意，这意味着如果要打包运行时依赖项，则需要添加额外的处理。

要在任何打包中包含运行时依赖项，您可以将 maven-dependency-plugin 的[复制目标用于特定的 artifact](http://maven.apache.org/plugins/maven-dependency-plugin/examples/copying-artifacts.html)。

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2012-02-27T12:35:14.337

如果您需要从要包含在程序集中的依赖项工件中排除所有传递依赖项，则可以在程序集插件的描述符中指定：

```
<assembly>
    <id>myApp</id>
    <formats>
        <format>zip</format>
    </formats>
    <dependencySets>
        <dependencySet>
            <useTransitiveDependencies>false</useTransitiveDependencies>
            <includes><include>*:struts2-spring-plugin:jar:2.1.6</include></includes>
        </dependencySet>
    </dependencySets>
</assembly> 
```

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2011-09-28T08:24:08.537

如果您在 Eclipse 下开发，您可以在 POM 编辑器（启用高级选项卡）依赖关系图中查找要从项目中排除的依赖关系，然后：

右键单击它->“排除 Maven Artifact ...”，Eclipse 将为您进行排除，而无需找出 lib 链接的依赖项。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2009-02-13T21:46:05.087

你排除所有传递依赖的原因是什么？

如果您需要从每个依赖项中排除特定的工件（例如 commons-logging），则[版本 99 不存在](http://day-to-day-stuff.blogspot.com/2007/10/announcement-version-99-does-not-exist.html)方法可能会有所帮助。

* * *

**2012 年更新：**不要使用这种方法。使用[maven-enforcer-plugin 和 excludes](https://stackoverflow.com/a/10391251/62130)。版本 99 产生虚假的依赖关系，版本 99 存储库处于脱机状态（有[类似的镜像](http://www.slf4j.org/faq.html#excludingJCL)，但您也不能依赖它们永远在线；最好只使用 Maven Central）。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2011-10-04T13:52:37.090

在一个类似的问题中，我使用提供的范围声明了所需的依赖项。使用这种方法，可以获取传递依赖项，但不包含在包阶段，这是您想要的。在维护方面我也喜欢这个解决方案，因为不需要维护 pom 或 whaley 解决方案中的自定义 pom；你只需要在容器中提供具体的依赖就可以了

* * *

## 回答 #12

> 赞同：-7
> 
> 时间：2013-06-24T12:07:42.070

在您的类路径中使用最新的 maven .. 它将删除重复的工件并保留最新的 maven 工件..

# html - 一个表单中的两个提交按钮

> ID：547821
> 
> 赞同：626
> 
> 时间：2009-02-13T21:47:04.257
> 
> 标签：html, forms, submit

我在一个表单中有两个*提交*按钮。我如何确定哪一个被击中服务器端？

* * *

## 回答 #1

> 赞同：955
> 
> 时间：2009-02-13T21:53:33.807

**解决方案 1：**
给每个输入一个不同的值并保持相同的名称：

```
<input type="submit" name="action" value="Update" />
<input type="submit" name="action" value="Delete" /> 
```

然后在代码中检查是否触发了：

```
if ($_POST['action'] == 'Update') {
    //action for update here
} else if ($_POST['action'] == 'Delete') {
    //action for delete
} else {
    //invalid action!
} 
```

**问题在于您将逻辑与输入中的用户可见文本联系起来。**

* * *

**解决方案 2：**
给每个人一个唯一的名称并检查 $_POST 是否存在该输入：

```
<input type="submit" name="update_button" value="Update" />
<input type="submit" name="delete_button" value="Delete" /> 
```

在代码中：

```
if (isset($_POST['update_button'])) {
    //update action
} else if (isset($_POST['delete_button'])) {
    //delete action
} else {
    //no button pressed
} 
```

* * *

## 回答 #2

> 赞同：517
> 
> 时间：2009-02-13T21:48:20.493

如果你给每个人一个名字，点击的那个将作为任何其他输入发送。

```
<input type="submit" name="button_1" value="Click me"> 
```

* * *

## 回答 #3

> 赞同：136
> 
> 时间：2014-02-14T11:31:29.383

一个更好的解决方案包括使用按钮标签来提交表单：

```
<form>
    ...
    <button type="submit" name="action" value="update">Update</button>
    <button type="submit" name="action" value="delete">Delete</button>
</form> 
```

按钮*内*的HTML （例如`..>Update<..`，用户看到的内容；因为提供了 HTML，所以`value`用户不可见；它只发送到服务器。这样就没有国际化和多种显示语言的不便（在前一种解决方案，按钮的标签也是发送到服务器的值）。

* * *

## 回答 #4

> 赞同：131
> 
> 时间：2015-08-10T12:07:56.160

有一种新的 HTML5 方法，`formaction`属性：

```
<button type="submit" formaction="/action_one">First action</button>
<button type="submit" formaction="/action_two">Second action</button> 
```

[显然这在Internet Explorer 9](https://en.wikipedia.org/wiki/Internet_Explorer_9)和更早版本中不起作用，但对于其他浏览器应该没问题（请参阅：[w3schools.com HTML <button> formaction 属性](http://www.w3schools.com/tags/att_button_formaction.asp "HTML <button> formaction 属性")）。

就个人而言，我通常使用 JavaScript 远程提交表单（以获得更快的感知反馈），并以这种方法作为备份。在这两者之间，唯一没有涉及到的是禁用 JavaScript 的版本 9 之前的 Internet Explorer。

当然，如果您基本上在服务器端采取相同的操作，而不管按下哪个按钮，这可能是不合适的，但通常如果有两个用户端操作可用，那么它们也会映射到两个服务器端操作。

正如 Pascal_dher 在评论中所指出的，这个属性也可以在`<input>`标签上使用。

* * *

## 回答 #5

> 赞同：35
> 
> 时间：2009-02-13T21:51:28.413

这非常容易测试：

```
<form action="" method="get">
    <input type="submit" name="sb" value="One">
    <input type="submit" name="sb" value="Two">
    <input type="submit" name="sb" value="Three">
</form> 
```

只需将其放入 HTML 页面，单击按钮，然后查看 URL。

* * *

## 回答 #6

> 赞同：29
> 
> 时间：2018-07-30T06:35:50.553

使用`formaction`HTML 属性（第 5 行）：

```
<form action="/action_page.php" method="get">
    First name: <input type="text" name="fname"><br>
    Last name: <input type="text" name="lname"><br>
    <button type="submit">Submit</button><br>
    <button type="submit" formaction="/action_page2.php">Submit to another page</button>
</form> 
```

* * *

## 回答 #7

> 赞同：23
> 
> 时间：2016-11-08T10:03:46.553

```
<form>
    <input type="submit" value="Submit to a" formaction="/submit/a">
    <input type="submit" value="submit to b" formaction="/submit/b">    
</form> 
```

* * *

## 回答 #8

> 赞同：12
> 
> 时间：2016-08-05T05:34:28.413

处理多个提交按钮的最佳方法是在服务器脚本中使用 switch case

```
<form action="demo_form.php" method="get">

    Choose your favorite subject:

    <button name="subject" type="submit" value="html">HTML</button>
    <button name="subject" type="submit" value="css">CSS</button>
    <button name="subject" type="submit" value="javascript">JavaScript</button>
    <button name="subject" type="submit" value="jquery">jQuery</button>
</form> 
```

服务器代码/服务器脚本 - 您提交表单的位置：

### 文件*demo_form.php*

```
<?php
    switch($_REQUEST['subject']) {

        case 'html': // Action for HTML here
                     break;

        case 'css': // Action for CSS here
                    break;

        case 'javascript': // Action for JavaScript here
                           break;

        case 'jquery': // Action for jQuery here
                       break;
    }
?> 
```

资料来源：[W3Schools.com](http://www.w3schools.com/tags/tryit.asp?filename=tryhtml_button_name)

* * *

## 回答 #9

> 赞同：11
> 
> 时间：2014-08-05T11:36:55.957

也许这里建议的解决方案在 2009 年有效，但我已经测试了所有这些赞成的答案，没有人在任何浏览器中工作。

我发现唯一可行的解​​决方案是这个（但我认为使用起来有点难看）：

```
<form method="post" name="form">
    <input type="submit" value="dosomething" onclick="javascript: form.action='actionurl1';"/>
    <input type="submit" value="dosomethingelse" onclick="javascript: form.action='actionurl2';"/>
</form> 
```

* * *

## 回答 #10

> 赞同：10
> 
> 时间：2020-05-12T06:05:01.423

您在一个表单示例中为多个提交按钮形成操作：

```
 <input type="submit" name="" class="btn action_bg btn-sm loadGif" value="Add Address" title="" formaction="/addAddress"> 
 <input type="submit" name="" class="btn action_bg btn-sm loadGif" value="update Address" title="" formaction="/updateAddress"> 
```

* * *

## 回答 #11

> 赞同：8
> 
> 时间：2017-07-02T22:48:54.937

定义`name`为`array`。

```
<form action='' method=POST>
    (...) some input fields (...)
    <input type=submit name=submit[save] value=Save>
    <input type=submit name=submit[delete] value=Delete>
</form> 
```

示例服务器代码（PHP）：

```
if (isset($_POST["submit"])) {
    $sub = $_POST["submit"];

    if (isset($sub["save"])) {
        // Save something;
    } elseif (isset($sub["delete"])) {
        // Delete something
    }
} 
```

`elseif`非常重要，因为如果没有，两者都会被解析。

* * *

## 回答 #12

> 赞同：8
> 
> 时间：2021-02-27T14:02:04.963

一个 HTML 示例，用于在不同的按钮单击时发送不同的表单操作：

```
<form action="/login" method="POST">
    <input type="text" name="username" value="your_username" />
    <input type="password" name="password" value="your_password" />
    <button type="submit">Login</button>
    <button type="submit" formaction="/users" formmethod="POST">Add User</button>
</form> 
```

相同的表单用于添加新用户和登录用户。

* * *

## 回答 #13

> 赞同：6
> 
> 时间：2015-12-04T14:36:59.027

由于您没有指定您使用的服务器端脚本方法，我将给您一个适用于 Python 的示例，使用[CherryPy](https://en.wikipedia.org/wiki/CherryPy)（尽管它也可能对其他上下文有用）：

```
<button type="submit" name="register">Create a new account</button>
<button type="submit" name="login">Log into your account</button> 
```

`<button>`您可以使用名称（使用标签而不是） ，而不是使用该值来确定按下了哪个按钮`<input>`。这样，如果您的按钮碰巧有相同的文本，就不会造成问题。所有表单项的名称（包括按钮）都作为 URL 的一部分发送。

在 CherryPy 中，每一个都是执行服务器端代码的方法的参数。因此，如果您的方法只有`**kwargs`其参数列表（而不是繁琐地输入每个表单项的每个名称），那么您可以检查查看按下了哪个按钮，如下所示：

```
if "register" in kwargs:
    pass # Do the register code
elif "login" in kwargs:
    pass # Do the login code 
```

* * *

## 回答 #14

> 赞同：3
> 
> 时间：2016-06-29T13:22:08.300

```
<form method="post">
    <input type="hidden" name="id" value="'.$id.'" readonly="readonly"/>'; // Any value to post PHP
    <input type='submit' name='update' value='update' formAction='updateCars.php'/>
    <input type='submit' name='delete' value='delete' formAction='sqlDelete.php'/>
</form> 
```

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2009-02-13T21:48:26.970

我认为您应该能够读取 GET 数组中的名称/值。我认为未点击的按钮不会出现在该列表中。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2016-01-21T04:10:31.883

你也可以这样做（我认为如果你有 N 个输入会很方便）。

```
<input type="submit" name="row[456]" value="something">
<input type="submit" name="row[123]" value="something">
<input type="submit" name="row[789]" value="something"> 
```

一个常见的用例是为每个按钮使用来自数据库的不同 ID，这样您以后可以在服务器中知道单击了哪一行。

在服务器端（本例中为 PHP），您可以将“行”作为数组读取以获取 id。

`$_POST['row']`将是一个只有一个元素的数组，格式`[ id => value ]`为（例如：）`[ '123' => 'something' ]`。

因此，为了获得点击的 id，您可以：

```
$index = key($_POST['row']); 
```

*[钥匙](http://php.net/manual/en/function.key.php)*

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2015-06-24T09:34:13.873

简单的。您可以更改表单对不同提交按钮单击的操作。

*在document.Ready*中试试这个：

```
$(".acceptOffer").click(function () {
    $("form").attr("action", "/Managers/SubdomainTransactions");
});

$(".declineOffer").click(function () {
    $("form").attr("action", "/Sales/SubdomainTransactions");
}); 
```

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2017-07-19T21:15:00.413

您还可以使用 href 属性并发送带有为每个按钮附加的值的 get。但是那时不需要表格

```
href="/SubmitForm?action=delete"
href="/SubmitForm?action=save" 
```

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2019-11-26T04:08:30.050

## 由于您没有指定您使用的服务器端脚本方法，我将给您一个适用于 PHP 的示例

```
<?php
   if(isset($_POST["loginForm"]))
   {
    print_r ($_POST); // FOR Showing POST DATA
   }
   elseif(isset($_POST["registrationForm"]))
   {
    print_r ($_POST);
   }
   elseif(isset($_POST["saveForm"]))
   {
    print_r ($_POST);
   }
   else{

   }
?>
<html>
<head>
</head>
<body>

  <fieldset>
    <legend>FORM-1 with 2 buttons</legend>
      <form method="post" >
      <input type="text" name="loginname" value ="ABC" >

     <!--Always use type="password" for password --> 
     <input type="text" name="loginpassword" value ="abc123" >

     <input type="submit" name="loginForm" value="Login"><!--SUBMIT Button 1 -->
     <input type="submit" name="saveForm" value="Save">  <!--SUBMIT Button 2 -->
   </form>
  </fieldset>

  <fieldset>
    <legend>FORM-2 with 1 button</legend>
     <form method="post" >
      <input type="text" name="registrationname" value ="XYZ" >

     <!--Always use type="password" for password -->
     <input type="text" name="registrationpassword" value ="xyz123" >

     <input type="submit" name="registrationForm" value="Register"> <!--SUBMIT Button 3 -->
   </form>
  </fieldset>

</body>
</html>
```

[形式](https://i.stack.imgur.com/ocTbl.png)

[当点击登录 - > loginForm](https://i.stack.imgur.com/ADSZo.png)

[当点击保存 - > saveForm](https://i.stack.imgur.com/lmsz1.png)

[当点击注册 -> 注册表格](https://i.stack.imgur.com/V0S87.png)

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2021-11-24T13:51:32.463

请注意，如果您有多个提交按钮并且您按回车键（ENTER 键），则键盘上的默认按钮值将是 DOM 上的第一个按钮。

例子：

```
<form>
  <input type="text" name="foo" value="bar">
  <button type="submit" name="operation" value="val-1">Operation #1</button>
  <button type="submit" name="operation" value="val-2">Operation #2</button>
</form> 
```

如果您在此表单上按 ENTER，将发送以下参数：

```
foo=bar&operation=val-1 
```

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2022-03-02T05:30:48.627

更新后的答案是使用带有**formaction**和**formtarget的按钮**

在此示例中，第一个按钮`/preview`在新选项卡中启动不同的 url。其他三个使用**表单**标记中指定的**操作。**

 **```
<button type='submit' class='large' id='btnpreview' name='btnsubmit' value='Preview' formaction='/preview' formtarget='blank' >Preview</button>
<button type='submit' class='large' id='btnsave' name='btnsubmit' value='Save' >Save</button>
<button type='submit' class='large' id='btnreset' name='btnsubmit' value='Reset' >Reset</button>
<button type='submit' class='large' id='btncancel' name='btnsubmit' value='Cancel' >Cancel</button> 
```

完整[的文档在这里](https://www.w3docs.com/learn-html/html-button-tag.html)

* * *

## 回答 #22

> 赞同：-1
> 
> 时间：2015-07-24T09:52:33.287

您可以像这样显示按钮：

```
<input type="submit" name="typeBtn" value="BUY">
<input type="submit" name="typeBtn" value="SELL"> 
```

然后在代码中，您可以使用以下方法获取值：

```
if request.method == 'POST':
    #valUnits = request.POST.get('unitsInput','')
    #valPrice = request.POST.get('priceInput','')
    valType = request.POST.get('typeBtn','') 
```

（valUnits 和 valPrice 是我从留下的表格中提取的一些其他值，以供说明）

# python - 如何动态加载 Python 类

> ID：547829
> 
> 赞同：207
> 
> 时间：2009-02-13T21:49:04.940
> 
> 标签：python, reflection, python-import

给定一个 Python 类的字符串，例如`my_package.my_module.MyClass`，加载它的最佳方法是什么？

换句话说，我正在寻找`Class.forName()`Java 中的等价物，Python 中的函数。它需要在 Google App Engine 上运行。

最好这是一个接受类的 FQN 作为字符串的函数，并返回对该类的引用：

```
my_class = load_class('my_package.my_module.MyClass')
my_instance = my_class() 
```

* * *

## 回答 #1

> 赞同：235
> 
> 时间：2009-02-13T22:02:57.683

从 python 文档中，这是您想要的功能：

```
def my_import(name):
    components = name.split('.')
    mod = __import__(components[0])
    for comp in components[1:]:
        mod = getattr(mod, comp)
    return mod 
```

简单`__import__`不起作用的原因是因为任何超过包字符串中第一个点的任何导入都是您正在导入的模块的属性。因此，这样的事情是行不通的：

```
__import__('foo.bar.baz.qux') 
```

您必须像这样调用上述函数：

```
my_import('foo.bar.baz.qux') 
```

或者在您的示例中：

```
klass = my_import('my_package.my_module.my_class')
some_object = klass() 
```

**编辑**：我对此有点失望。你基本上想要做的是：

```
from my_package.my_module import my_class 
```

*仅当您有一个空*的fromlist时，才需要上述功能。因此，适当的调用将是这样的：

```
mod = __import__('my_package.my_module', fromlist=['my_class'])
klass = getattr(mod, 'my_class') 
```

* * *

## 回答 #2

> 赞同：168
> 
> 时间：2014-07-17T23:52:06.197

如果您不想自己动手，`pydoc`模块中有一个功能可以做到这一点：

```
from pydoc import locate
my_class = locate('my_package.my_module.MyClass') 
```

与此处列出的其他方法相比，这种方法的优点是可以在提供的虚线路径上`locate`找到*任何*python 对象，而不仅仅是模块中的直接对象。例如`my_package.my_module.MyClass.attr`。

如果你好奇他们的食谱是什么，这里的功能是：

```
def locate(path, forceload=0):
    """Locate an object by name or dotted path, importing as necessary."""
    parts = [part for part in split(path, '.') if part]
    module, n = None, 0
    while n < len(parts):
        nextmodule = safeimport(join(parts[:n+1], '.'), forceload)
        if nextmodule: module, n = nextmodule, n + 1
        else: break
    if module:
        object = module
    else:
        object = __builtin__
    for part in parts[n:]:
        try:
            object = getattr(object, part)
        except AttributeError:
            return None
    return object 
```

它依赖于`pydoc.safeimport`功能。以下是相关文档：

```
"""Import a module; handle errors; return None if the module isn't found.

If the module *is* found but an exception occurs, it's wrapped in an
ErrorDuringImport exception and reraised.  Unlike __import__, if a
package path is specified, the module at the end of the path is returned,
not the package at the beginning.  If the optional 'forceload' argument
is 1, we reload the module from disk (unless it's a dynamic extension).""" 
```

* * *

## 回答 #3

> 赞同：154
> 
> 时间：2013-10-07T14:55:19.610

```
import importlib

module = importlib.import_module('my_package.my_module')
my_class = getattr(module, 'MyClass')
my_instance = my_class() 
```

* * *

## 回答 #4

> 赞同：35
> 
> 时间：2019-04-09T18:49:57.827

如果您使用的是 Django，则可以使用它。*是的，我知道 OP 没有要求 django，但我遇到了这个问题，寻找 Django 解决方案，但没有找到，然后把它放在这里供下一个寻找它的男孩/女孩使用。*

```
# It's available for v1.7+
# https://github.com/django/django/blob/stable/1.7.x/django/utils/module_loading.py
from django.utils.module_loading import import_string

Klass = import_string('path.to.module.Klass')
func = import_string('path.to.module.func')
var = import_string('path.to.module.var') 
```

请记住，如果您要导入没有`.`, like`re`或`argparse`use 的内容：

```
re = __import__('re') 
```

[以下是`import_string`.](https://docs.djangoproject.com/en/stable/ref/utils/#django.utils.module_loading.import_string)

* * *

## 回答 #5

> 赞同：29
> 
> 时间：2011-11-24T09:49:03.757

```
def import_class(cl):
    d = cl.rfind(".")
    classname = cl[d+1:len(cl)]
    m = __import__(cl[0:d], globals(), locals(), [classname])
    return getattr(m, classname) 
```

* * *

## 回答 #6

> 赞同：12
> 
> 时间：2019-04-27T04:25:57.867

这是分享我在尝试解决此问题时发现`__import__`的一些东西。`importlib`

我正在使用 Python 3.7.3。

当我尝试进入`d`模块中的课程时`a.b.c`，

```
mod = __import__('a.b.c') 
```

该`mod`变量引用顶级命名空间`a`。

所以要上课`d`，我需要

```
mod = getattr(mod, 'b') #mod is now module b
mod = getattr(mod, 'c') #mod is now module c
mod = getattr(mod, 'd') #mod is now class d 
```

如果我们尝试做

```
mod = __import__('a.b.c')
d = getattr(mod, 'd') 
```

我们实际上是在寻找`a.d`.

使用时`importlib`，我想图书馆已经`getattr`为我们做了递归。因此，当我们使用 时`importlib.import_module`，我们实际上得到了最深模块的句柄。

```
mod = importlib.import_module('a.b.c') #mod is module c
d = getattr(mod, 'd') #this is a.b.c.d 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2018-12-17T14:40:03.613

如果你碰巧已经有一个你想要的类的实例，你可以使用 'type' 函数来提取它的类类型并使用它来构造一个新的实例：

```
class Something(object):
    def __init__(self, name):
        self.name = name
    def display(self):
        print(self.name)

one = Something("one")
one.display()
cls = type(one)
two = cls("two")
two.display() 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2017-06-16T15:13:56.350

好的，对我来说这就是它的工作方式（我使用的是 Python 2.7）：

```
a = __import__('file_to_import', globals(), locals(), ['*'], -1)
b = a.MyClass() 
```

那么，b 是类 'MyClass' 的一个实例

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2021-08-18T05:52:50.227

**Python 有一个内置库 importlib 来完成这项工作。:** , 如何绕过包名作为参数动态访问模块方法和类方法。下面给出一个例子。

**模块一：**

```
def get_scenario_data():
    return "module1 scenario data"

class Module1:

    def module1_function1(self):
        return "module1_function"

    def module1_function2(self):
        return "module2_function" 
```

**模块 2：**

```
def get_scenario_data():
    return "module2 scenario data"

class Module2:

    def module2_function1(self):
        return "module2_function1"

    def module2_function2(self):
        return "module2_function2" 
```

模块测试：

1.  将根据包名作为参数动态访问模块方法
2.  将根据包名作为参数动态访问类方法。

**模块测试**

```
import importlib

module = importlib.import_module('pack1.nestedpack1.module1')
print(module.get_scenario_data())
modul1_cls_obj = getattr(module, 'Module1')()
print(modul1_cls_obj.module1_function1())
print(modul1_cls_obj.module1_function2())

module = importlib.import_module('pack1.nestedpack1.module2')
modul2_cls_obj = getattr(module, 'Module2')()
print(modul2_cls_obj.module2_function1())
print(modul2_cls_obj.module2_function2())
print(module.get_scenario_data()) 
```

**结果**

```
module1 scenario data
module1_function
module2_function
module2_function1
module2_function2
module2 scenario data 
```

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2014-10-09T11:47:00.990

在 Google App Engine 中有一个`webapp2`名为`import_string`. 有关更多信息，请参见此处：[https ://webapp-improved.appspot.com/api/webapp2.html](https://webapp-improved.appspot.com/api/webapp2.html)

所以，

```
import webapp2
my_class = webapp2.import_string('my_package.my_module.MyClass') 
```

例如，这用于`webapp2.Route`您可以使用处理程序或字符串的地方。

* * *

## 回答 #11

> 赞同：-2
> 
> 时间：2009-02-13T22:01:44.067

```
module = __import__("my_package/my_module")
the_class = getattr(module, "MyClass")
obj = the_class() 
```

# c++ - 具体类特定方法

> ID：547833
> 
> 赞同：4
> 
> 时间：2009-02-13T21:50:37.790
> 
> 标签：c++, design-patterns, architecture

我有一个有趣的问题。考虑这个类层次结构：

```
class Base
{
public:
   virtual float GetMember( void ) const =0;
   virtual void SetMember( float p ) =0;
};

class ConcreteFoo : public Base
{
public:
   ConcreteFoo( "foo specific stuff here" );

   virtual float GetMember( void ) const;
   virtual void SetMember( float p );

   // the problem
   void foo_specific_method( "arbitrary parameters" );
};

Base* DynamicFactory::NewBase( std::string drawable_name );

// it would be used like this
Base* foo = dynamic_factory.NewBase("foo"); 
```

我省略了 DynamicFactory 的定义以及 Builders 是如何注册的。Builder 对象与名称相关联，并将分配 Base 的具体实现。使用 shared_ptr 处理内存回收的实际实现有点复杂，但它们对我的问题并不重要。

`ConcreteFoo`具有特定于类的方法。但是由于具体实例是在动态工厂中创建的，具体类是未知的或不可访问的，它们只能在源文件中声明。如何`foo_specific_method`向 的用户公开`Base*`？

我正在添加我提出的解决方案作为答案。我为它们命名，以便您可以在答案中轻松引用它们。

我不只是在寻找关于我原来的解决方案的意见，新的解决方案将不胜感激。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-13T23:19:52.897

但是，演员表会比大多数其他解决方案更快：

在基类中添加：

```
void passthru( const string &concreteClassName, const string &functionname, vector<string*> args )
{
    if( concreteClassName == className )
         runPassThru( functionname, args );
}

private:
    string className;
    map<string, int> funcmap;
    virtual void runPassThru( const string &functionname, vector<string*> args ) {} 
```

在每个派生类中：

```
void runPassThru( const string &functionname, vector<string*> args )
{
   switch( funcmap.get( functionname ))
   {
      case 1:
          //verify args
          // call function
        break;
      // etc..
   }
}

// call in constructor
void registerFunctions()
{
      funcmap.put( "functionName", id );
      //etc.
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-13T21:52:49.750

`CrazyMetaType`解决方案。

这个解决方案没有经过深思熟虑。我希望有人可能有类似的经历。我看到这适用于已知类型的未知数量的问题。这很光滑。我正在考虑将其应用于未知数量的未知类型***S***

基本思想是 CrazyMetaType 以类型安全的方式收集参数，然后执行具体的具体方法。

```
class Base
{
   ...
   virtual CrazyMetaType concrete_specific( int kind ) =0;
};

// used like this
foo->concrete_specific(foo_method_id) << "foo specific" << foo_specific; 
```

我对这个解决方案的一个担心`CrazyMetaType`是要让它工作起来会非常复杂。我能胜任这项任务，但我不能指望未来的用户成为 C++ 专家，只是为了添加一种具体的特定方法。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-13T21:51:14.577

将特殊功能添加到`Base`.

最简单也是最不能接受的解决方案是将 foo_specific_method 添加到`Base`. 然后不使用它的类可以将其定义为空。这不起作用，因为允许用户向 dynamic_factory 注册他们自己的构建器。新类也可能有具体的类特定方法。

本着这个解决方案的精神，稍微好一点。将泛型函数添加到`Base`.

```
class Base
{
   ...
   /// \return true if 'kind' supported
   virtual bool concrete_specific( int kind, "foo specific parameters" );
}; 
```

这里的问题是，对于不同的参数集，可能有很多具体的重载。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-13T21:52:03.730

就投吧。

当需要特定于 foo 的方法时，通常您知道 the `Base*`实际上是一个`ConcreteFoo`. 所以只要确保类的定义 `ConcreteFoo`是可访问的，并且：

```
ConcreteFoo* foo2 = dynamic_cast<ConcreteFoo*>(foo); 
```

我不喜欢这个解决方案的原因之一是 dynamic_casts 很慢并且需要 RTTI。

下一步是避免dynamic_cast。

```
ConcreteFoo* foo_cast( Base* d )
{
   if( d->id() == the_foo_id )
   {
      return static_cast<ConcreteFoo*>(d);
   }

   throw std::runtime_error("you're screwed");
} 
```

这需要 Base 类中的另一种方法，这是完全可以接受的，但它需要管理 id。当用户可以使用动态工厂注册自己的构建器时，这变得很困难。

我不太喜欢任何铸造解决方案，因为它需要在使用专门方法的地方定义用户类。但也许我只是一个范围纳粹。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-13T21:54:47.327

`cstdarg`解决方案。

Bjarn Stroustrup 说：

> 一个定义良好的程序最多需要几个没有完全指定参数类型的函数。在大多数情况下，重载函数和使用默认参数的函数可用于处理类型检查，否则会考虑不指定参数类型。只有当参数的数量和参数的类型都不同时，省略号才是必要的

```
class Base
{
   ...
   /// \return true if 'kind' supported
   virtual bool concrete_specific( int kind, ... ) =0;
}; 
```

这里的缺点是：

*   几乎没有人知道如何正确使用 cstdarg
*   感觉不是很c++-y
*   它不是类型安全的。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-13T22:05:19.610

您能否创建 Base 的其他非具体子类，然后在 DynamicFactory 中使用多个工厂方法？

您的目标似乎是颠覆子类化的观点。我真的很想知道你在做什么需要这种方法。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-13T22:15:49.383

如果具体对象具有特定于类的方法，则意味着您仅在处理该类的实例时才专门调用该方法，而不是在处理通用基类时。这是关于 b/c 你正在运行一个检查对象类型的 switch 语句吗？

我会从不同的角度来解决这个问题，使用“不可接受的”第一个解决方案但没有参数，具体对象具有可以存储其状态的成员变量。尽管我想这会迫使您将成员关联数组作为基类的一部分，以避免首先进行强制转换来设置状态。

您可能还想尝试装饰器模式。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-13T22:58:49.407

你可以做一些类似于`CrazyMetaType`或 cstdarg 参数但简单和 C++-ish 的事情。（也许这可能是`SaneMetaType`。）只需为 的参数定义一个基类`concrete_specific`，并让人们从中派生特定的参数类型。就像是

```
class ConcreteSpecificArgumentBase;

class Base
{
   ...  
   virtual void concrete_specific( ConcreteSpecificArgumentBase &argument ) =0;
}; 
```

当然，您将需要 RTTI 来整理每个版本的`concrete_specific`. 但如果`ConcreteSpecificArgumentBase`设计得当，至少它会使调用变得`concrete_specific`相当简单。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-13T23:22:55.213

奇怪的是，DynamicFactory 的用户会收到一个 Base 类型，但是当它是 ConcreteFoo 时需要做一些特定的事情。

也许不应该使用工厂。

尝试查看其他依赖注入机制，例如自己创建 ConcreteFoo，将 ConcreteFoo 类型指针传递给需要它的人，并将 Base 类型指针传递给其他人。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-02-14T02:22:53.470

上下文似乎假设用户将使用您的 ConcreteType 并且知道它正在这样做。

在这种情况下，如果客户知道他们正在处理具体类型并且需要在该抽象级别上工作，您的工厂中似乎可以有另一个方法返回 ConcreteType*。

# apache-flex - 在 flex 中向 XML 添加子节点

> ID：547850
> 
> 赞同：4
> 
> 时间：2009-02-13T21:53:58.517
> 
> 标签：apache-flex, actionscript

在 Flex 应用程序中，我有一个绑定到树控件的 xml 对象。我可以将子节点添加到 xml，但是当我尝试将子节点添加到子节点时，它不会出现在树控件上

```
tree =  <node label="Root">
                        <node label="Category 1"/>
                        <node label="Category2"/>
                        <node label="Category3"/>
                        <node label="Category 4">
                            <node label="SubCategory4.1"/>
                            <node label="SubCategory4.2"/>
                        </node>
                    </node>;                    
            var someNode:XMLNode = new XMLNode(9, 'Category5');         
            var aSubNode:XMLNode = new XMLNode(9, 'SubCategory5.1');
            someNode.appendChild(aSubNode);                                 
            tree.appendChild(someNode); 
```

因此 Category5 出现在树控件上，但 SubCategory5.1 没有。我错过了什么？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-13T22:03:56.447

如果您使用的是 flex，请使用 AS3。XMLNode 是 AS2。简而言之，试试这个：

```
tree = <node label="Root">
           <node label="Category 1"/>
           <node label="Category2"/>
           <node label="Category3"/>
           <node label="Category 4">
               <node label="SubCategory4.1"/>
               <node label="SubCategory4.2"/>
           </node>
       </node>;
var someNode:XML = <node label="Category5"/>;
var aSubNode:XML = <node label="SubCategory5.1"/>;
someNode.appendChild(aSubNode);
tree.appendChild(someNode); 
```

# file - 如何从 AIR 中的本地 jpeg 文件中的 File 对象中获取 BitmapData 对象？

> ID：547859
> 
> 赞同：2
> 
> 时间：2009-02-13T21:58:46.587
> 
> 标签：file, air, bitmap, jpeg

所以我正在尝试创建一个图片库。我的 AIR 应用程序接受拖放到 TileList 组件上的文件。我将图像用作图标，但问题是它们需要很长时间才能加载，所以我想先压缩文件数据（我已经完成了那部分）问题是我不知道如何打开文件并将数据放入 BitmapData 对象。

有任何想法吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-16T00:23:24.337

```
var req:URLRequest = new URLRequest(value.file.url);
var ldr:Loader = new Loader();
ldr.contentLoaderInfo.addEventListener(Event.COMPLETE, completeHandler);
ldr.load(req);
.
.
.
private function completeHandler(event:Event):void {
  var ldr:Loader = Loader(event.target.loader);
  var b:Bitmap = Bitmap(ldr.content);
} 
```

# c# - ASP.Net 对象数据源 - 数据绑定

> ID：547862
> 
> 赞同：1
> 
> 时间：2009-02-13T21:59:54.883
> 
> 标签：c#, asp.net, page-lifecycle

ASP.Net 对象数据源在页面生命周期中的什么时候绑定来自指定数据源的数据？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-13T22:16:35.670

从[Page Life Cycle Overview](http://msdn.microsoft.com/en-us/library/ms178472.aspx)中，指的是数据绑定事件：

> 此事件由数据绑定控件在包含控件（或 Page 对象）的 PreRender 事件之前引发，并标志着控件与数据绑定的开始。

关于 DataBound 事件：

> 此事件标志着数据绑定控件中数据绑定操作的结束。在 GridView 控件中，所有行和任何子控件的数据绑定都是完整的。使用此事件来格式化数据绑定内容或在其他控件中启动数据绑定，这些控件依赖于当前控件内容中的值。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-13T23:33:47.963

正如 Joel 所说，绑定发生在 PreRender 中。如果您**真的**感兴趣，可以查看 BaseDataBoundControl.OnPreRender，您会看到负责此操作的代码。

# .net - 如何使用 .NET 检查 Web 服务是否可用

> ID：547868
> 
> 赞同：3
> 
> 时间：2009-02-13T22:03:09.227
> 
> 标签：.net, web-services

如果 .NET 应用程序需要调用 Web 服务，除了调用特定的 Web 方法之外，是否有一个很好的解决方案来检查 Web 服务当前是否已启动且可用？

在我的 Web 服务中，我通常会包含某种用于测试的状态方法，但这在使用第三方 Web 服务时会成为一个问题。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-13T22:13:07.457

另一种解决方案是对服务的 URL 进行简单的 HTTP 获取。并查看响应代码（即 404 等）。很酷的一点是您不必发布任何数据或调用任何方法。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-13T22:05:08.130

无论如何，您都需要调用一个方法，否则您将不知道 Web 服务本身是否正在运行。即服务器可能正在运行，但 Web 服务已停止。

我们为我们的一些 Web 服务执行此操作，它公开了简洁的功能。我们可以让它返回 true/false，调用失败或 false 意味着它的失败。这让你“返回真”；如果您选择，总是或有条件地返回 false，例如阻止特定客户端或关闭服务而不实际停止 Web 服务等。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-13T22:12:52.650

没有。

您可能会做的一件事是创建一个什么都不做，只返回 true 的 ServiceIsUp 方法。如果您的服务器由于某种原因挂起，您的请求将超时。

# asp.net - 无法弄清楚为什么应用程序重定向到登录页面

> ID：547877
> 
> 赞同：0
> 
> 时间：2009-02-13T22:05:24.697
> 
> 标签：asp.net, login

我继承了一个包含登录屏幕的 ASP.NET 应用程序。当您第一次启动时，或者您有一段时间没有做任何事情时，它就会出现。事实证明我们不需要这个额外的安全层，我正在尝试删除它。我以为我删除了进行重定向的代码，但它仍然会进入登录页面，即使我已经告诉应用程序使用 default.aspx 作为起始页，并确保 default.aspx 不包含应该包含的代码触发重定向（它使用母版页，但母版页也不包含任何应该重定向的内容）。它还会在哪里重定向到登录页面？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-13T22:09:02.880

在您的网络配置中查找`<authentication>`部分（应该在`<location>`部分下）并删除它们

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-13T22:11:01.237

听起来它可能是有效的表单身份验证。

在 web.config 文件中，将身份验证模式值更改为`none`，看看是否有所不同。

```
<authentication mode="none" /> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-17T15:45:39.167

发现了问题。尽管我认为我已经删除了所有重定向代码，但仍有一些隐藏在默认页面上的用户控件中。删除它允许我绕过登录屏幕。所以，我不能将任何回复标记为答案，但我给了他们所有的投票，因为他们都是很好的答案。

# c# - 将 Telerik RadGRID 绑定到列表 目的

> ID：547878
> 
> 赞同：4
> 
> 时间：2009-02-13T22:05:42.183
> 
> 标签：c#, xaml, telerik, radgrid

我对 RadGrid 有一个简单的用途，涉及将其绑定到字符串列表

```
 i.e. using:  list<string> 
```

绑定工作正常，数据显示在网格中。但是，标题显示“项目”，并且我希望能够自定义列的其他方面。我试图在 ascx 页面上设置列的“DataField”属性：

```
 <telerik:GridTemplateColumn UniqueName="column" 
DataField="" HeaderText="Omniture Codes"> 
```

但是，它似乎需要数据字段的名称，就像使用数据表对象获得的名称一样，而不是列表。

有谁知道将列绑定到列表的方法，或者有其他解决方法的想法？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-02-13T22:45:56.910

我认为您应该使用 GridBoundColumn 而不是 GridTemplateColumn 并禁用 AutoGenerateColumns。

例如，以下对我有用：

ASPX：

```
<telerik:RadGrid ID="grid" runat="server" AutoGenerateColumns="false">
  <MasterTableView>
    <Columns>
      <telerik:GridBoundColumn DataField="" HeaderText="MyHeaderText">
      </telerik:GridBoundColumn>
    </Columns>
  </MasterTableView>
</telerik:RadGrid> 
```

代码隐藏：

```
protected void Page_Load(object sender, EventArgs e)
{
    List<string> data = new List<string> {"a", "b", "c"};
    grid.DataSource = data;

} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-13T22:28:04.270

你必须用 RadGrid 尝试这样的事情：

```
<Columns>
    <telerik:GridBoundColumn DataField="AddrLine1" HeaderText="Address Line 1" SortExpression="AddrLine1" UniqueName="AddrLine1">
    <HeaderStyle Font-Bold="False" Font-Italic="False" Font-Overline="False" Font-Strikeout="False" Font-Underline="False" HorizontalAlign="Left" Wrap="True" />
    <ItemStyle Font-Bold="False" Font-Italic="False" Font-Overline="False" Font-Strikeout="False"Font-Underline="False" HorizontalAlign="Left" Wrap="True" />
    </telerik:GridBoundColumn>
</Columns> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-04-12T11:04:22.010

您也可以使用 radgrid 的 Item Template 属性来生成任何设计。

像

```
<ItemTemplate>
                    <div style="width:277px; text-align:left;">
                        <span style=" font-size:11px;">&nbsp;&nbsp;Tdata1:</span>
                        <%# Eval("data1")%>
                        <br />                        
                        <span>&nbsp;&nbsp;data2:</span>
                        <%# Eval("data2")%>
                        <br />
                    </div>

                </ItemTemplate>
                <Columns>                                           
                <telerik:GridBoundColumn DataField="data1" HeaderText="data1" SortExpression="data1" UniqueName="data1"> 
              </telerik:GridBoundColumn>                            
                <telerik:GridBoundColumn DataField="data2" HeaderText="data2" SortExpression="data2" UniqueName="data2"> 
              </telerik:GridBoundColumn> 
                </Columns> 
```

# delphi - 如何判断 TBucketList 的桶数

> ID：547879
> 
> 赞同：3
> 
> 时间：2009-02-13T22:06:15.943
> 
> 标签：delphi, hashtable, tbucketlist

我一直在使用 TBucketList 和 TObjectBucketList 来满足我所有的散列需求，但从未尝试过切换存储桶的数量。我依稀记得这对 Data Structures 类意味着什么，但有人可以详细说明 Delphi 中这个特定类的细微差别吗

```
下表列出了可能的值：

值 桶数

BL2 2
BL4 4
BL8 8
bl16 16
BL32 32
BL64 64
BL128 128
BL256 256

```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-14T01:08:58.033

`TBucketList`并`TObjectBucketList`存储指针。他们使用的散列函数只是掩盖了地址的高位。有多少位被屏蔽取决于对象有多少桶。例如，如果您使用`bl2`31 位被屏蔽掉，并且只有一位地址确定存储桶。使用`bl256`时，将使用指针的整个字节。它是中间两个字节之一。权衡只是您将拥有的存储桶数量。一个桶只需要 8 个字节，因此拥有 256 个字节并不是很大的成本。

除此之外，`TBucketList`它只是一个普通的哈希表，就像您在数据结构类中了解的那样。

`TIntegerBucketList`使用与其他相同的哈希函数。如果您想要一个更复杂的哈希函数，请编写该方法的后代`TCustomBucketList`并覆盖该`BucketFor`方法。在您的后代类中，您还可以分配受保护的`BucketCount`属性以使用除`TBucketList`. 请注意，由于存储桶计数的变化，该类不会重新分配项目，因此`BucketCount`除非您计划自己重新分配，否则不要在项目已添加到列表后重新分配。

# asp.net - 从 ASP.NET 轮询长时间运行的 Windows 服务

> ID：547883
> 
> 赞同：2
> 
> 时间：2009-02-13T22:07:01.387
> 
> 标签：asp.net, windows, windows-services, lucene.net, polling

我们有一个应用程序，它在 Windows 服务中使用 Lucene.NET 来重新索引我们的应用程序以进行搜索。我们的管理部分可以在 Lucene 中触发完整的重新索引，目前查看其进度的唯一方法是通过写入磁盘的日志文件。

这很笨拙。我们想轮询服务以确定重新索引的进度。

有没有人对此有任何见解？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-13T22:10:13.890

如果两个进程都在同一台机器上运行，命名管道将是我在这种情况下进行跨进程通信的方式。

如果两个进程都在不同的机器上，它会变得更加复杂，并且可能会涉及与进程通信的 Web 服务，然后 asp.net 调用 Web 服务。

# ssl - 获得 SSL 连接以使用 STUNNEL/Win32

> ID：547890
> 
> 赞同：3
> 
> 时间：2009-02-13T22:10:16.543
> 
> 标签：ssl, openssl, x509, keytool, stunnel

我需要连接的服务为我提供了三个文件，我试图找出创建 STUNNEL 需要的 Cert=xxx.PEM 文件所需的内容

我有一个“keystore.jks”文件。用 keytool 转储它说这是一个“私钥条目”

我有一个“truststore.jks”文件。转储说它是“受信任的证书条目”。别名是“服务器”

我还有一个“xyz.cer”文件。那似乎是 X.509 证书

我有 OPENSSL 和一个名为“KeytoolUI”的 Java 程序。

底线是我有一堆文件和工具，并且对 SSL 了解不多，我觉得我看不到树木的树木。我需要所有这些文件吗？我为其他服务拥有的现有 PEM 文件只有一个“证书”部分和一个“RSA 私钥”部分。

任何建议表示赞赏。谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-13T23:57:07.517

听起来您的提供商已将您的密钥对（用于客户端身份验证）提供为 java 密钥库，并且（我猜）远程服务器的公共证书或 PEM 格式的 CA 证书。

这是一些相当繁重的猜测，但奇怪的是，如果您不进行客户端身份验证，他们会向您发送私钥。（希望他们没有向您发送他们服务器的私钥！）。

据我所知，stunnel 仅使用 PEM 证书，因此您需要将 JKS 文件转换为两个 PEM 文件（一个用于私钥，一个用于公共证书）。一种方法是使用 将 JKS 转换为 PKCS#12（又名 PFX）文件`keytool`，然后使用 OpenSSL 将 PKCS#12 文件转换为 PEM 私钥/证书文件。

拥有这两个文件后，将它们`key`与.`cert``stunnel.conf`

对于您拥有的最终（神秘）PEM 证书，我将（再次）猜测这是远程 CA，因此您应该`CAfile`根据`stunnel.conf`. （如果您适合在此处发布详细信息，请编辑以包含来自的输出`openssl x509 -in <filename> -text`以提供更多线索）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-20T16:52:33.413

恐怕没有答案。最后我让公司给我发了一个 PEM 文件。

我确实在这里找到了相当权威的教程

[http://www.herongyang.com/crypto/Migrating_Keys_keytool_to_OpenSSL_2.html](http://www.herongyang.com/crypto/Migrating_Keys_keytool_to_OpenSSL_2.html)

问题是对于那些不每天都这样做的人来说，从各种来源获得一堆免费/开源软件来协同工作。您可以在各种站点上找到执行此操作的脚本，但是当您运行它们时，您会看到 Java 回溯、关于 LIBEAY32.DLL 缺少序数等的投诉等。

如果您获得了正确版本的 KEYTOOL、OPENSSL 等，安装在正确的位置，具有完全正确的 JRE 版本和所有其他 DLL，路径正确，并且所有星星都完全对齐，那么您会没事的. 在那之前，这只是一种沮丧的练习。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-02-06T10:55:56.307

```
openssl x509 -inform der -outform pem < xyz.cer > xyz.pem 
```

# html - 如何捕获富文本作为 Web 表单的输入？

> ID：547893
> 
> 赞同：0
> 
> 时间：2009-02-13T22:10:54.700
> 
> 标签：html, richtextbox

我需要让用户能够将富文本剪切并粘贴到我网页上的大文本框中。我怎么做？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-13T22:14:21.523

你可以安装一个像[TinyMCE](http://tinymce.moxiecode.com/)这样的 JavaScript 编辑器来支持富文本。这个特殊的所见即所得编辑器具有“从 Word 粘贴”功能，有助于减少用户尝试在 Web 上发布 Word 文档时通常遇到的所有讨厌的字符编码问题。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-13T22:26:32.353

我想你只能通过使用 IE/Windows/TinyMCE-like-widget set 来做到这一点。

[这是有关剪贴板](http://www.mail-archive.com/tutor@python.org/msg32897.html)的一些信息。

# java - 休眠实现。我们是否支付了反射惩罚？

> ID：547899
> 
> 赞同：6
> 
> 时间：2009-02-13T22:12:04.870
> 
> 标签：java, hibernate, reflection

很久以前，我正在使用反射创建一个迷你 ORM。

在阅读有关反射的信息时，我得到了类似的答案：

[Java 反射性能](https://stackoverflow.com/questions/435553/java-reflection-performance)

这是完全有道理的，我退出了我的迷你 orm 并锐化了我的 CTRL+C、CTRL+V 键（该库旨在避免不得不一次又一次地为我正在开发的 Web 应用程序中的不同表重写相同的片段）

多年后由于某种原因我现在不记得了（也不想记住）我正在阅读（或试图...）Hibernate 源代码，因为我想知道他们是否使用 AOP 即时生成代码并避免反射惩罚，但令我惊讶的是，我所看到的都是纯粹的反射。

这是否意味着最被接受的 ORM 框架，究竟是几年前阻止我继续我天真的努力？:")

我的问题是：有人可以确认我对 Hibernate 实现的理解吗？他们是否会即时生成字节码以提高性能？还是我们（当我们使用它时）总是支付反射惩罚（顺便说一下，如果差异在几毫秒内，我们都没有注意到或抱怨）

我们是否支付了反射惩罚？如果是的话，我觉得**值得！！！**

问候。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-13T22:20:34.723

Hibernate 使您的模型具有休眠意识。

使用反射有不同程度的成本。不断查找特定类的方法特别昂贵。使用缓存副本通过反射执行方法并没有那么慢。如果考虑反射 api 必须完成以调用该方法的任务，那么每个部分都很慢并且消耗 cpu 周期都是有意义的。

## 定位方法

*   访问特定类的每个方法
*   测试每个方法的可见性、方法签名等。
*   *为找到*的方法生成字节码。

一个典型类中方法数量的一个因素以及其中一些操作并非微不足道，很明显这可能是昂贵的。

## 调用方法。

每个反射方法相当于一个字节代码，它使用一些样板来调用目标方法以匹配反射接口。在它可以这样做之前，它必须执行一些健全性检查，以便它可以抱怨漂亮的消息，而不是让运行时抛出 ClassCastException 和类似的异常。

*   如果实例方法检查传入的实例不是 null 并且是正确的类型。
*   检查 arguments 参数是否包含正确数量和类型的参数。
*   在 try catch 中执行该方法。在接球 ITE 等。

所有这些额外的东西都会增加一些成本 - 不是很多，但它确实让事情变得更慢。

## 运行时成本

一般来说，缓存方法和调用这不是成本，但有点慢。反射 api 本身确实会尝试缓存方法和类，但找到正确的方法等仍然是一个缓慢的操作。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-02-13T23:17:35.350

我认为要记住的重要一点是整个应用程序的相对成本。反射比普通对象创建慢吗？是的。反射变得更好更快了吗？是的。但实际上，在比较反射成本与通过线路并使用数据库做某事时，这些点并不是很重要，这就是 hibernate 所做的 - 成本变得完全可以忽略不计，我会说我们没有付出代价。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-02-14T07:44:34.820

持久化和检索的成本是反射成本的许多倍。从数据库访问一条记录可能需要 1-10 毫秒，而使用反射构造一个对象可能需要 0.001 到 0.01 毫秒。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-13T22:16:32.067

NHibernate 不会缓存通过反射收集的类信息，因此您只需在第一次支付罚金吗？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2014-12-30T14:14:35.147

您确实通过使用 NHibernate 支付了反射损失，但如果您通过 NHibernate.Bytecode.IBytecodeProvider 提供所有优化的反射实现，它的可扩展性允许您避免 90% 的反射损失。

# vb6 - VB6 UDT 的自检

> ID：547903
> 
> 赞同：18
> 
> 时间：2009-02-13T22:13:22.073
> 
> 标签：vb6, user-defined-types, tlbinf32

我有一种感觉，这个问题的答案将是“不可能的”，但我会试一试......我在修改旧版 VB6 应用程序并进行一些增强时处于令人羡慕的位置。转换为更智能的语言不是一种选择。该应用程序依赖于大量用户定义的类型来移动数据。我想定义一个通用函数，它可以引用任何这些类型并提取包含的数据。
在伪代码中，这就是我要查找的内容：

```
Public Sub PrintUDT ( vData As Variant )
  for each vDataMember in vData
    print vDataMember.Name & ": " & vDataMember.value 
  next vDataMember 
End Sub 
```

似乎这些信息需要在某处提供给 COM ......那里有任何 VB6 大师愿意试一试吗？

谢谢，

担

* * *

## 回答 #1

> 赞同：40
> 
> 时间：2009-02-15T00:31:08.130

与其他人所说的相反，可以在 VB6 中获取 UDT 的运行时类型信息（尽管它不是内置的语言功能）。Microsoft 的[TypeLib 信息对象库](http://msdn.microsoft.com/en-us/magazine/bb985086.aspx)(tlbinf32.dll) 允许您在运行时以编程方式检查 COM 类型信息。如果你安装了 Visual Studio，你应该已经有了这个组件：要将它添加到现有的 VB6 项目中，请转到*Project->References*并检查标记为“TypeLib Information”的条目。请注意，您必须在应用程序的安装程序中分发和注册 tlbinf32.dll。

您可以在运行时使用 TypeLib Information 组件检查 UDT 实例，只要您的 UDT 已被声明`Public`并在`Public`类中定义。这对于使 VB6 为您的 UDT 生成与 COM 兼容的类型信息是必要的（然后可以使用 TypeLib 信息组件中的各种类进行枚举）。满足此要求的最简单方法是将所有 UDT 放入一个公共`UserTypes`类中，该类将被编译为 ActiveX DLL 或 ActiveX EXE。

## 工作示例摘要

这个例子包含三个部分：

*   **第 1 部分**：创建一个包含所有公共 UDT 声明的 ActiveX DLL 项目
*   **第 2 部分**：创建示例`PrintUDT`方法来演示如何枚举 UDT 实例的字段
*   **第 3 部分**：创建自定义迭代器类，使您可以轻松地遍历任何公共 UDT 的字段并获取字段名称和值。

* * *

**工作示例**

### 第 1 部分：ActiveX DLL

正如我已经提到的，您需要使您的 UDT 可公开访问，以便使用 TypeLib Information 组件枚举它们。完成此操作的唯一方法是将 UDT 放入 ActiveX DLL 或 ActiveX EXE 项目内的公共类中。然后，您的应用程序中需要访问您的 UDT 的其他项目将引用这个新组件。

要跟随这个示例，首先创建一个新的 ActiveX DLL 项目并将其命名为`UDTLibrary`.

接下来，将`Class1`类模块（IDE 默认添加）重命名为并向类`UserTypes`添加两个用户定义的类型，`Person`并且`Animal`：

```
' UserTypes.cls '

Option Explicit

Public Type Person
    FirstName As String
    LastName As String
    BirthDate As Date
End Type

Public Type Animal
    Genus As String
    Species As String
    NumberOfLegs As Long
End Type 
```

**清单 1：`UserTypes.cls`充当我们 UDT 的容器**

接下来，将类的*Instancing*属性更改`UserTypes`为“2-PublicNotCreatable”。任何人都没有理由`UserTypes`直接实例化该类，因为它只是充当我们 UDT 的公共容器。

最后，确保`Project Startup Object`（在*Project->Properties*下）设置为“(None)”并编译项目。您现在应该有一个名为`UDTLibrary.dll`.

### 第 2 部分：枚举 UDT 类型信息

现在是时候演示我们如何使用 TypeLib 对象库来实现`PrintUDT`方法了。

首先，首先创建一个新的标准 EXE 项目，然后随意命名。添加对`UDTLibrary.dll`在第 1 部分中创建的文件的引用。由于我只是想演示它是如何工作的，我们将使用即时窗口来测试我们将编写的代码。

创建一个新模块，为其命名`UDTUtils`并添加以下代码：

```
'UDTUtils.bas'
Option Explicit    

Public Sub PrintUDT(ByVal someUDT As Variant)

    ' Make sure we have a UDT and not something else... '
    If VarType(someUDT) <> vbUserDefinedType Then
        Err.Raise 5, , "Parameter passed to PrintUDT is not an instance of a user-defined type."
    End If

    ' Get the type information for the UDT '
    ' (in COM parlance, a VB6 UDT is also known as VT_RECORD, Record, or struct...) '

    Dim ri As RecordInfo
    Set ri = TLI.TypeInfoFromRecordVariant(someUDT)

    'If something went wrong, ri will be Nothing'

    If ri Is Nothing Then
        Err.Raise 5, , "Error retrieving RecordInfo for type '" & TypeName(someUDT) & "'"
    Else

        ' Iterate through each field (member) of the UDT '
        ' and print the out the field name and value     '

        Dim member As MemberInfo
        For Each member In ri.Members

            'TLI.RecordField allows us to get/set UDT fields:                 '
            '                                                                 '
            ' * to get a fied: myVar = TLI.RecordField(someUDT, fieldName)    '
            ' * to set a field TLI.RecordField(someUDT, fieldName) = newValue ' 
            '                                                                 '
            Dim memberVal As Variant
            memberVal = TLI.RecordField(someUDT, member.Name)

            Debug.Print member.Name & " : " & memberVal

        Next

    End If

End Sub

Public Sub TestPrintUDT()

    'Create a person instance and print it out...'

    Dim p As Person

    p.FirstName = "John"
    p.LastName = "Doe"
    p.BirthDate = #1/1/1950#

    PrintUDT p

    'Create an animal instance and print it out...'

    Dim a As Animal

    a.Genus = "Canus"
    a.Species = "Familiaris"
    a.NumberOfLegs = 4

    PrintUDT a

End Sub 
```

**清单 2：一个示例`PrintUDT`方法和一个简单的测试方法**

### 第 3 部分：使其面向对象

上面的示例提供了一个“快速而肮脏”的演示，展示了如何使用 TypeLib 信息对象库来枚举 UDT 的字段。在实际场景中，我可能会创建一个`UDTMemberIterator`类，使您可以更轻松地遍历 UDT 的字段，以及模块中的实用函数，该函数`UDTMemberIterator`为给定的 UDT 实例创建一个。这将允许您在代码中执行以下操作，这更接近您在问题中发布的伪代码：

```
Dim member As UDTMember 'UDTMember wraps a TLI.MemberInfo instance'

For Each member In UDTMemberIteratorFor(someUDT)
   Debug.Print member.Name & " : " & member.Value
Next 
```

这样做实际上并不太难，我们可以重用`PrintUDT`第 2 部分中创建的例程中的大部分代码。

首先，创建一个新的 ActiveX 项目并将其命名`UDTTypeInformation`或类似的名称。

接下来，确保新项目的启动对象设置为“（无）”。

要做的第一件事是创建一个简单的包装类，它将隐藏类的详细信息以`TLI.MemberInfo`防止调用代码，并使获取 UDT 字段的名称和值变得容易。我叫这堂课`UDTMember`。此类的*Instancing属性应为**PublicNotCreatable*。

```
'UDTMember.cls'
Option Explicit

Private m_value As Variant
Private m_name As String

Public Property Get Value() As Variant
    Value = m_value
End Property

'Declared Friend because calling code should not be able to modify the value'
Friend Property Let Value(rhs As Variant)
    m_value = rhs
End Property

Public Property Get Name() As String
    Name = m_name
End Property

'Declared Friend because calling code should not be able to modify the value'
Friend Property Let Name(ByVal rhs As String)
    m_name = rhs
End Property 
```

**清单 3：`UDTMember`包装类**

现在我们需要创建一个迭代器类，`UDTMemberIterator`这将允许我们使用 VB 的`For Each...In`语法来迭代 UDT 实例的字段。这个类的`Instancing`属性应该设置为`PublicNotCreatable`（我们稍后将定义一个实用方法，它将代表调用代码创建实例）。

**编辑：**（2/15/09）我已经清理了更多代码。

```
'UDTMemberIterator.cls'

Option Explicit

Private m_members As Collection ' Collection of UDTMember objects '

' Meant to be called only by Utils.UDTMemberIteratorFor '
'                                                       '
' Sets up the iterator by reading the type info for     '
' the passed-in UDT instance and wrapping the fields in '
' UDTMember objects                                     '

Friend Sub Initialize(ByVal someUDT As Variant)

    Set m_members = GetWrappedMembersForUDT(someUDT)

End Sub

Public Function Count() As Long

    Count = m_members.Count

End Function

' This is the default method for this class [See Tools->Procedure Attributes]   '
'                                                                               '
Public Function Item(Index As Variant) As UDTMember

    Set Item = GetWrappedUDTMember(m_members.Item(Index))

End Function

' This function returns the enumerator for this                                     '
' collection in order to support For...Each syntax.                                 '
' Its procedure ID is (-4) and marked "Hidden" [See Tools->Procedure Attributes]    '
'                                                                                   '
Public Function NewEnum() As stdole.IUnknown

    Set NewEnum = m_members.[_NewEnum]

End Function

' Returns a collection of UDTMember objects, where each element                 '
' holds the name and current value of one field from the passed-in UDT          '
'                                                                               '
Private Function GetWrappedMembersForUDT(ByVal someUDT As Variant) As Collection

    Dim collWrappedMembers As New Collection
    Dim ri As RecordInfo
    Dim member As MemberInfo
    Dim memberVal As Variant
    Dim wrappedMember As UDTMember

    ' Try to get type information for the UDT... '

    If VarType(someUDT) <> vbUserDefinedType Then
        Fail "Parameter passed to GetWrappedMembersForUDT is not an instance of a user-defined type."
    End If

    Set ri = tli.TypeInfoFromRecordVariant(someUDT)

    If ri Is Nothing Then
        Fail "Error retrieving RecordInfo for type '" & TypeName(someUDT) & "'"
    End If

    ' Wrap each UDT member in a UDTMember object... '

    For Each member In ri.Members

        Set wrappedMember = CreateWrappedUDTMember(someUDT, member)
        collWrappedMembers.Add wrappedMember, member.Name

    Next

    Set GetWrappedMembersForUDT = collWrappedMembers

End Function

' Creates a UDTMember instance from a UDT instance and a MemberInfo object  '
'                                                                           '
Private Function CreateWrappedUDTMember(ByVal someUDT As Variant, ByVal member As MemberInfo) As UDTMember

    Dim wrappedMember As UDTMember
    Set wrappedMember = New UDTMember

    With wrappedMember
        .Name = member.Name
        .Value = tli.RecordField(someUDT, member.Name)
    End With

    Set CreateWrappedUDTMember = wrappedMember

End Function

' Just a convenience method
'
Private Function Fail(ByVal message As String)

    Err.Raise 5, TypeName(Me), message

End Function 
```

**清单 4：`UDTMemberIterator`类。**

请注意，为了使此类可迭代以便`For Each`可以与它一起使用，您必须在`Item`和`_NewEnum`方法上设置某些过程属性（如代码注释中所述）。您可以从工具菜单（工具->过程属性）更改过程属性。

最后，我们需要一个实用函数（`UDTMemberIteratorFor`在本节的第一个代码示例中），它将`UDTMemberIterator`为 UDT 实例创建一个，然后我们可以用`For Each`. 创建一个名为的新模块`Utils`并添加以下代码：

```
'Utils.bas'

Option Explicit

' Returns a UDTMemberIterator for the given UDT    '
'                                                  '
' Example Usage:                                   '
'                                                  '
' Dim member As UDTMember                          '
'                                                  '        
' For Each member In UDTMemberIteratorFor(someUDT) '
'    Debug.Print member.Name & ":" & member.Value  '
' Next                                             '
Public Function UDTMemberIteratorFor(ByVal udt As Variant) As UDTMemberIterator

    Dim iterator As New UDTMemberIterator
    iterator.Initialize udt

    Set UDTMemberIteratorFor = iterator

End Function 
```

**清单 5：`UDTMemberIteratorFor`实用程序函数。**

最后，编译项目并创建一个新项目进行测试。

在您的测试项目中，添加对第 1 部分中新建和创建的引用，`UDTTypeInformation.dll`并`UDTLibrary.dll`在新模块中尝试以下代码：

```
'Module1.bas'

Option Explicit

Public Sub TestUDTMemberIterator()

    Dim member As UDTMember

    Dim p As Person

    p.FirstName = "John"
    p.LastName = "Doe"
    p.BirthDate = #1/1/1950#

    For Each member In UDTMemberIteratorFor(p)
        Debug.Print member.Name & " : " & member.Value
    Next

    Dim a As Animal

    a.Genus = "Canus"
    a.Species = "Canine"
    a.NumberOfLegs = 4

    For Each member In UDTMemberIteratorFor(a)
        Debug.Print member.Name & " : " & member.Value
    Next

End Sub 
```

**清单 6：测试`UDTMemberIterator`类。**

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-14T08:24:04.913

如果您将所有类型更改为类。你有选择。从类型更改为类的最大缺陷是您必须使用新的密钥世界。每次有一个类型变量的声明添加新的。

然后您可以使用变体关键字或 CallByName。VB6 没有任何类型的反射，但您可以制作有效字段列表并测试它们是否存在，例如

类测试有以下内容

```
Public Key As String
Public Data As String 
```

然后，您可以执行以下操作

```
Private Sub Command1_Click()
    Dim T As New Test 'This is NOT A MISTAKE read on as to why I did this.
    T.Key = "Key"
    T.Data = "One"
    DoTest T
End Sub

Private Sub DoTest(V As Variant)
    On Error Resume Next
    Print V.Key
    Print V.Data
    Print V.DoesNotExist
    If Err.Number = 438 Then Print "Does Not Exist"
    Print CallByName(V, "Key", VbGet)
    Print CallByName(V, "Data", VbGet)
    Print CallByName(V, "DoesNotExist", VbGet)
    If Err.Number = 438 Then Print "Does Not Exist"
End Sub 
```

如果您尝试使用不存在的字段，则会引发错误 438。CallByName 允许您使用字符串来调用类的字段和方法。

当您将 Dim 声明为 New 时，VB6 所做的事情非常有趣，并且将大大减少此转换中的错误。你看到这个

```
Dim T as New Test 
```

不被视为完全相同

```
Dim T as Test
Set T = new Test 
```

例如，这将起作用

```
Dim T as New Test
T.Key = "A Key"
Set T = Nothing
T.Key = "A New Key" 
```

这将给出一个错误

```
Dim T as Test
Set T = New Test
T.Key = "A Key"
Set T = Nothing
T.Key = "A New Key" 
```

这样做的原因是，在第一个示例中，VB6 标记了 T，以便在访问成员时检查 T 是否为空。如果是，它将自动创建测试类的新实例，然后分配变量。

在第二个示例中，VB 没有添加此行为。

在大多数项目中，我们严格确保我们将 Dim T 作为测试，设置 T = 新测试。但是在您的情况下，因为您想使用 Dim T 作为新测试将类型转换为副作用最少的类是要走的路。这是因为 Dim as New 导致变量模仿类型更紧密地工作的方式。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-14T19:14:27.737

@担，

看起来您正在尝试使用 UDT 的 RTTI。我认为在运行前不了解 UDT 的情况下，您无法真正获得这些信息。为了让你开始尝试：

[理解UDTs](http://sandsprite.com/CodeStuff/Understanding_UDTs.html)
因为没有这种反射能力。我会为我的 UDT 创建自己的 RTTI。

给你一个基线。试试这个：

```
Type test
    RTTI as String
    a as Long
    b as Long 
    c as Long
    d as Integer
end type 
```

您可以编写一个实用程序来打开每个源文件并将带有类型名称的 RTTI 添加到 UDT。将所有 UDT 放在一个公共文件中可能会更好。

RTTI 将是这样的：

“字符串：长：长：长：整数”

使用 UDT 的内存，您可以提取值。

# sql-server - BETWEEN with dates 在 SQL SERVER 2008 中是否真的有效

> ID：547904
> 
> 赞同：4
> 
> 时间：2009-02-13T22:13:35.613
> 
> 标签：sql-server, datetime

根据[cdonner](https://stackoverflow.com/users/58880/cdonner)的回答，在[这里](https://stackoverflow.com/questions/547693/sql-date-search-without-time/547761#547761)和他的[博客上](http://cdonner.com/why-not-to-use-between-for-datetime-comparisons-in-sql-server-2007.htm)。

他声称 BETWEEN with date 产生不一致的结果

**从他的博客：**

```
select
    case when '9/1/08' between '9/1/08' and '9/15/08'
        then 'in' else 'out' end as s1,
    case when '9/1/08' between '8/28/08' and '9/1/08'
        then 'in' else 'out' end as s2

s1   s2
---- ----
in   in

(1 row(s) affected)
select
    case when '1/1/08' between '1/1/08' and '2/1/08'
        then 'in' else 'out' end as s1,
    case when '1/1/08' between '12/31/07' and '1/1/08'
        then 'in' else 'out' end as s2

s1   s2
---- ----
in   out

(1 row(s) affected 
```

请注意，第二个查询中的 S2 答案显示“Out”，而日期显然应该在其中。

根据**cdonner**，之所以如此，是因为：

*[the] SQL 中 DateTime 类型的最低有效位是 3 毫秒*

我认为原因比这简单得多。我认为这是因为他在查询中使用的是字符串而不是日期。

请原谅我的 SQLServer-ish。我主要讲Oracle，所以这可能很难看。但是当我接受他的查询时 - 证明 - 存在问题并用日期时间变量替换他的字符串时，我得到了正确的输出。

```
DECLARE @Jan108 datetime
DECLARE @Feb108 datetime
DECLARE @Dec3107 datetime

SET @Jan108 = '1/1/08'
SET @Feb108 = '2/1/08'
SET @Dec3107 = '12/31/07'

select
    case when @Jan108 between @Jan108 and @Feb108
        then 'in' else 'out' end as s1,
    case when @Jan108 between @Dec3107 and @Jan108
        then 'in' else 'out' end as s2 
```

哪个是对的？

**注意：**这不是试图解决争论或发起一场激烈的战争。我真的很想了解 SQL Server BETWEEN 的功能是否不如 Oracle BETWEEN。我们在 Oracle 中没有这样的问题。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-13T22:17:22.593

在甲骨文中：

```
select
    case when '1/1/08' between '1/1/08' and '2/1/08'
        then 'in' else 'out' end as s1,
    case when '1/1/08' between '12/31/07' and '1/1/08'
        then 'in' else 'out' end as s2
FROM dual

in out 
```

您在这里比较的是字符串，而不是日期。

什么都没有`BETWEEN` `12/31/07 and 1/1/08`，就像在`2``/``ASCII`

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-13T22:20:31.027

我必须使用这样的东西：

```
Declare @BeginDate SmallDateTime
Declare @EndDate SmallDateTime
Set @BeginDate = '2007-08-01'
Set @EndDate = '2007-08-31'

Select *
From dbo.table1 a
Where a.session_date Between @BeginDate + ' 00:00:00' And @EndDate + ' 23:59:59'
Order By a.session_date asc 
```

在日期时间之间获得正确的

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-13T22:29:29.570

SQL Server 将日期时间值存储为数字。例如，0 是 1900-01-01 00:00:00.000

您在问题中给出的示例存在舍入问题，类似于浮点值 1.0 如何存储为 0.99999 ...

要准确比较日期，您可以将该值转换为 datetime 类型，然后进行比较。

```
SELECT
CASE 
    WHEN cast('1/1/08' as datetime) 
        BETWEEN cast('1/1/08' as datetime) AND cast('2/1/08' as datetime) 
    THEN 'in' ELSE 'out' 
END AS s1,
CASE 
    WHEN cast('1/1/08' as datetime) 
        BETWEEN cast('12/31/07' as datetime) AND cast('1/1/08' as datetime) 
    THEN 'in' ELSE 'out' 
END AS s2 
```

这将导致您的预期输出： s1==in, s2==in

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-13T22:20:26.907

你是对的，他的代码由于字符串比较而存在缺陷。

但是，如果您使用的是 datetime 类型而不是新的 date 类型，则无关紧要。原因是您通常不想要包含性搜索，因此而不是像这样的代码：

```
SELECT * FROM [MyTable] WHERE MyDateColumn BETWEEN @StartDate AND @EndDate 
```

你通常会这样写：

```
SELECT * FROM [MyTable] WHERE MyDateColumn >= @StartDate AND MyDateColumn < @EndDate 
```

其中@EndDate 实际上比您真正想要的日期大一。

我希望新日期类型的问题已解决，但我手边没有 SQL Server 2008，因此无法对其进行测试。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-13T22:25:33.323

因为他完全错了——它在比较字符串

如果您将它们转换为日期时间或用日期变量替换它们，它可以工作：

```
select
    case when CAST('JAN 01 2008' as smalldatetime)
        between CAST('JAN 01 2008' as smalldatetime)
        and CAST('FEB 01 2008' as smalldatetime)
        then 'in' else 'out' end as s1,
    case when CAST('JAN 01 2008' as smalldatetime)
        between CAST('DEC 31 2007' as smalldatetime)
        and CAST('JAN 01 2008' as smalldatetime)
        then 'in' else 'out' end as s2 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-09-26T02:32:30.423

博客上的代码是胡说八道，我欠马克向我指出了这一点。问题存在。它与 BETWEEN 无关，而是与舍入（在某些情况下可能导致 BETWEEN 失败）有关。虽然 SQL Server 会四舍五入，但 .Net 不会，我在很短的时间内遇到了多次插入的问题，我认为我有不同的日期时间值，但由于四舍五入，它们在数据库中变得相同。该帖子很久以前就已更正，代码示例仍然适用于 SQL Server 2008。

如果您运行此查询，您将看到我所指的内容：

```
select convert(varchar(32), convert(datetime,
                            '9/1/08 00:00:00.005'), 121); 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2011-05-02T17:29:39.627

永远不要将 BETWEEN 与日期时间值一起使用。在 MySQL 我可以做

```
created >= CURDATE() - INTERVAL 1 DAY AND created < CURDATE() 
```

限制在昨天创建的（整个）。

在“2011-05-02”和“2011-05-02 23:59:59”之间，我会赌一秒钟的分辨率，并且会错过“2011-05-02 23:59:59.001”的创建.

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2013-02-18T20:28:07.567

很有用的讨论！

我有类似的问题，通过使用 CAST 和 CONVERT 解决，如下所示：

**cast(CONVERT(varchar(8), [PostDate], 112)AS DATE) 在 '2013-01-01' 和 '2013-01-31' 之间**

像魅力一样工作，经过多次详细验证。

“Cast(”是必需的（相信我，我有秃头来证明这一点）。但不必声明变量等。

如果我错过了方法或我的回应，我会对反馈感兴趣。

谢谢！

# mysql - 是否可以从另一个 sql 脚本中的存储过程调用 sql 脚本？

> ID：547915
> 
> 赞同：8
> 
> 时间：2009-02-13T22:16:45.030
> 
> 标签：mysql, stored-procedures, scripting

我想用 . 像这样从存储过程中调用 sql 脚本...

```
delimiter ///
create procedure append_procedure()
BEGIN
\. test.sql;    
END; ///
delimiter ; 
```

我收到“无法打开'test.sql;' “当我以这种方式运行时出错。我也试过了！但后来我得到一个权限被拒绝的错误。但是，我无法消除 ; 或者整个事情都坏了。有没有解决的办法？

我究竟做错了什么？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-13T23:36:07.350

有一组内置于 mysql 客户端的命令。它们记录在“[`mysql`命令](http://dev.mysql.com/doc/refman/5.1/en/mysql-commands.html)”下。这些包括DELIMITER、SOURCE、HELP、CONNECT、USE、QUIT等。

（`\.`或`SOURCE`）命令是这些内置命令之一。 **您不能以编程方式执行这些内置命令，也不能从存储过程中执行。**

这就像尝试使用`execl()`.

一个不同的类比可能是在 Web 浏览器中，您可以在其中键入`about:`由浏览器应用程序本身处理的特殊请求，例如“”；这些不会导致对远程网站的任何 HTTP 请求。

此外，如果您可以从存储过程中获取脚本也无济于事，因为脚本本身可能包含一堆 mysql 客户端内置命令，因此无法由存储过程运行。

* * *

另请参阅我对这些相关问题的回答：

*   [在 PHP 中运行 MySQL *.sql 文件](https://stackoverflow.com/questions/4027769/running-mysql-sql-files-in-php/4028289#4028289)
*   [从 PHP 中加载 .sql 文件](https://stackoverflow.com/questions/147821/loading-sql-files-from-within-php/149456#149456)
*   [PHP：一个 mysql_query 语句中的多个 SQL 查询](https://stackoverflow.com/questions/345637/php-multiple-sql-queries-in-one-mysql-query-statement/345712#345712)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-13T22:22:41.240

如果您使用的是 Sql Sevrer 2005，您可以使用 xp_cmdshell 命令。

[http://msdn.microsoft.com/en-us/library/ms175046(SQL.90).aspx](http://msdn.microsoft.com/en-us/library/ms175046(SQL.90).aspx)

或者

[http://www.sqlservercentral.com/articles/Administering/scriptscheduling/450/](http://www.sqlservercentral.com/articles/Administering/scriptscheduling/450/)

# lotus-notes - Lotus Notes 身份验证

> ID：547916
> 
> 赞同：1
> 
> 时间：2009-02-13T22:16:51.020
> 
> 标签：lotus-notes

我想在我的笔记本电脑上设置 Lotus Notes 来搞乱它。我正在尝试设置我的电子邮件，但我通过 verizon.net 发送的电子邮件需要身份验证。我在 Outlook 07 中设置了它，但 Outlook 不支持数据库。有谁知道如何在 Lotus Notes 中为传出电子邮件设置身份验证，更不用说可能了吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-17T15:05:17.377

在 Lotus Notes 的个人通讯簿（文件 > 数据库 > 打开 > names.nsf）中，转到高级 > 帐户部分并创建一个新帐户。您需要为 POP 创建一个计数，为 SMTP 创建一个帐户以发送和接收电子邮件。这些表单中有一些字段，您可以在其中放置身份验证信息。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-11-10T00:25:57.120

肯是对的，但我想反驳托德的评论（虽然我没有投票给你，托德）。

说 Notes 很糟糕，因为它不是 RDBMS，就像说 SQL 很糟糕，因为它不是网络操作系统一样。Notes 的功能非常强大——事实上，它没有竞争对手。Visual Studion + WinForms 绝不等同。您可以在 Notes 或 RDBMS 中做一些事情——有时一个平台会更好，有时另一个平台会更好。

享受吧，马克。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-02-17T15:09:43.777

Ken Pespisa 的回答是正确的。

但是，您需要了解 nsf（Notes 数据库）是完全平面文件。它们绝不是相关的。相信我，有很多方法可以将关系数据压缩到笔记数据库中，每个人都会给你留下大量的维护噩梦和蹩脚的数据。

米奇对你的评论已经死了，只是乱用 SQL Server Express 或 MySQL。如果您想要 Notes 的 RAD 方面，只需将 Visual Studio 与 WinForms 或其他东西一起使用。

# scons - 可以从 Scons 中吐出有向无环图吗？

> ID：547917
> 
> 赞同：2
> 
> 时间：2009-02-13T22:17:04.967
> 
> 标签：scons, directed-acyclic-graphs

有没有办法让[scons](http://www.scons.org/)输出它内部生成的有向无环图？也许是graphviz格式？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-14T17:59:12.767

我不这么认为。您可以让它以 ASCII-art 类型的方式以各种细节吐出依赖关系树，请参阅[手册页](http://scons.org/doc/1.2.0/HTML/scons-man.html)`--tree=xxx`上描述的选项。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2011-07-29T19:37:45.637

有一个 python 脚本可以使用[graphviz](http://www.thomasstover.com/sconsandgraphviz/sconsandgraphviz.html)可视化 scons 依赖项。

# vb.net - VB With/End With 关键字有什么不好？

> ID：547919
> 
> 赞同：3
> 
> 时间：2009-02-13T22:17:48.800
> 
> 标签：vb.net

在这个[问题](https://stackoverflow.com/questions/542510/how-do-i-create-a-parameterized-sql-query-why-should-i)中，一位用户评论说永远不要在 VB 中使用 With 块。为什么？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-02-13T22:39:11.730

“从不”是一个强有力的词。

我认为只要您不滥用它就可以（例如嵌套）

恕我直言 - 这更好：

```
With MyCommand.Parameters
    .Count = 1
    .Item(0).ParameterName = "@baz"
    .Item(0).Value = fuz
End With 
```

比：

```
MyCommand.Parameters.Count = 1
MyCommand.Parameters.Item(0).ParameterName = "@baz"
MyCommand.Parameters.Item(0).Value = fuz 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-13T23:19:31.180

With 关键字没有任何问题。确实，嵌套时它可能会降低可读性，但解决方案就是不要使用嵌套的 With。
Delphi 中可能存在命名空间问题，它不强制使用前导点，但该问题在 VB.NET 中根本不存在，因此发布有关 Delphi 的咆哮的人正在这个问题上浪费时间。
我认为许多人不喜欢 With 关键字的真正原因是它不包含在 C* 语言中，并且许多程序员自动认为他/她最喜欢的语言中不包含的每个功能都是不好的。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-13T22:35:48.400

与其他选项相比，它只是没有帮助。

如果你真的想念它，你可以为你的对象创建一个或两个字符的别名。别名只需要设置一行，而 With 块（With + End With 行）则需要两行。

别名还为您提供了变量类型的快速鼠标悬停参考。它为 IDE 提供了一个钩子，可以帮助您根据需要跳回到块的顶部（尽管如果块那么大，您还有其他问题）。它可以作为参数传递给函数。您可以使用它来引用索引属性。

所以我们有一个替代方案，可以用更少的代码提供更多的功能。

另请参阅此问题：
[为什么 with() 构造不包含在 C# 中，而它在 VB.NET 中真的很酷？](https://stackoverflow.com/questions/429890/why-with-construct-is-not-included-in-c-with-construct-is-really-cool-in-vb-net)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-13T22:34:03.037

[在精彩的Verity Stob](http://en.wikipedia.org/wiki/Verity_Stob)的一篇搞笑文章中，with 关键字仅在传递参考中被[侧](http://www.theregister.co.uk/2009/02/04/verity_stob_delphi_syntax/page2.html)扫*，*但对于尖酸刻薄是值得的：请参阅开头的段落

**当我们在标识符混淆时**。with关键字*...*

值得阅读整篇[文章](http://www.theregister.co.uk/2009/02/04/verity_stob_delphi_syntax/)！

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-15T03:47:18.660

With 关键字还提供了另一个好处——With 语句中的对象只需要“限定”一次，这可以提高性能。在此处查看 MSDN 上的信息：

[http://msdn.microsoft.com/en-us/library/wc500chb(VS.80).aspx](http://msdn.microsoft.com/en-us/library/wc500chb(VS.80).aspx)

所以无论如何，使用它。

# ruby-on-rails - Rails 嵌套资源

> ID：547920
> 
> 赞同：1
> 
> 时间：2009-02-13T22:18:21.610
> 
> 标签：ruby-on-rails, ruby, routes, nested-resources

这是routes.rb：

```
map.resources :assignments, :shallow => true  do |assignment|  
    assignment.resources :problems  
end 
```

如何在代码中获取 url 来编辑问题（/assignments/xyz/problems/abc/edit）？我已经尝试了
edit_assignment_problem_path(assignment,problem)
和 edit_problem_path(problem)。
虽然第一个适用于我的本地设置，但在服务器上它说方法 edit_assignment_problem_path 未定义。有任何想法吗？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-02-13T22:37:49.580

在你的命令行运行这个：

```
rake routes 
```

它将告诉您已定义的所有路线，以及它们的映射方式。非常便利。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-12-09T19:59:23.197

:shallow => true 是在 Rails 2.2 中引入的。您的本地设置可能运行的是早期版本，而您的服务器可能运行的是 2.2 或更早版本。

对于浅路径，您必须为 :index、:create 和 :new 操作指定完整路径（例如 /assignments/a/problems/..）（因为这些操作需要完整路径）并且必须使用短路径（例如/problems/..) 用于 :edit、:show、:update 和 :destroy 操作。

如果您想要所有路由的完整版本和短版本，唯一的可能性是使用嵌套资源路由，没有浅层和短路由，例如：

```
map.resources :assignments, has_many => :problems
map.resources :problems 
```

请注意，在您的示例中，您不需要对 map.resources 使用块形式。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-14T00:16:10.233

还可以查看[路由指南](http://guides.rubyonrails.org/routing.html)，它可以教你很多新东西。

# haskell - 检查 Haskell 中函数的内部结构

> ID：547922
> 
> 赞同：7
> 
> 时间：2009-02-13T22:19:06.943
> 
> 标签：haskell, functional-programming, sicp

我是 Haskell 新手，虽然之前有过 Lisp/Scheme 经验。现在我正在查看来自 SICP 的示例，并尝试在 Haskell 中实现它们以获得更多的实践经验。在第 3b 课中，作者提出了一个用于符号计算导数的函数。除其他外，它包含以下几行：

```
(define (deriv exp var)
    (cond ((constant? exp var) 0)
          ((same-var? exp var) 1)
; ... 
```

在讲座中，定义了更多功能：

```
(define (constant? exp var)
    (and (atom? exp)
         (not (eq? exp var)))) 
```

有没有办法在 Haskell 中做同样的事情，即检查原子性和与其他函数的符号等价性？或者更一般地说，Haskell 中“反汇编”函数的方法是什么？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-14T07:53:03.600

首先，虽然 SICP 很棒，但我建议不要用它来学习 Haskell。(#) 这个问题的一些困难源于此。

在 Lisp/Scheme 中，[“函数”](http://en.wikipedia.org/wiki/Subroutine)被认为是一段代码，检查一个函数仅仅意味着检查它的代码。在 Haskell 中，[“函数”](http://en.wikipedia.org/wiki/Function_(mathematics))意味着更接近其数学定义的东西，作为从集合 A 到集合 B 的映射。因此，例如，在 Lisp 上下文中，比较两个函数是有意义的：只需比较它们的代码。（但是是不同`(x+y)^2`的`x^2+2*x*y+y^2`函数吗？）在 Haskell 中，这取决于是否存在确定您正在考虑的函数类的相等性的建设性程序。

同样，正如您的问题一样，在 Lisp/Scheme 中，您将编写一个“派生”函数，该函数在给定表达式时正确区分，并且只是错误输出或在任意输入上返回垃圾。在 Haskell 的类型系统下，这（AFAIK）是不可能的，因为——如果你想一想——没有区分任意输入这样的事情：你只能区分一个表达式（或者可能是一个更通用的类，但仍然不能一切）。所以在诺曼拉姆齐的回答中，你首先定义一个“表达式”类型（或类型类），这很简单，然后编写函数

```
derive :: Expression -> Expression 
```

`Expression`它使用模式匹配结构（或其他取决于`Expression`s 的构建方式）来反汇编。

* * *

(#)：原因是 SICP 有一个完全不同的理念，它涉及使用无类型的编程语言并鼓励缺乏代码和数据之间的区别。虽然“code=data”论证有一些优点（例如，在我们使用的 von Neumann 架构中，“一切都是 0 和 1”），但它不一定是推理或建模问题的好方法。（有关这方面的更多信息，请参阅 Philip Wadler 的[Why Calculating is Better than Scheming](http://www.cs.kent.ac.uk/people/staff/dat/miranda/wadler87.pdf)。）如果您想阅读一本具有函数式风格而不是[真实世界](http://book.realworldhaskell.org/)的 Haskell 书籍，也许是 Simon Thompson 的[Haskell：函数式编程的工艺](http://www.cs.kent.ac.uk/people/staff/sjt/craft2e/)或 Richard Bird'

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-13T23:55:49.720

您的 Scheme 示例实际上并未检查 Scheme 函数。我最近在 Haskell 中对以下类型的值进行了一些符号区分：

```
data Exp a = Lit a
           | Exp a :*: Exp a
           | Exp a :+: Exp a
           | Var String
  deriving Eq 
```

而不是使用`atom?`or`eq?`您使用`case`（或其他模式匹配）和`==`.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-13T22:29:36.370

我不认为你能做到这一点。Lisp 是[同音符号](http://en.wikipedia.org/wiki/Homoiconicity)，Haskell 不是。

然而，进一步的谷歌搜索出现了[Liskell](http://liskell.org/)，这是（？）一个有趣的混合体。

# c# - 如何编写不会被编译器/JIT 优化的（测试）代码？

> ID：547934
> 
> 赞同：10
> 
> 时间：2009-02-13T22:24:35.370
> 
> 标签：c#, java, .net, optimization, jit

我不太了解编译器和 JIT 优化的内部原理，但我通常会尝试使用“常识”来猜测哪些可以优化，哪些不能。所以我今天写了一个简单的单元测试方法：

```
@Test  // [Test] in C#
public void testDefaultConstructor() {
    new MyObject();
} 
```

这种方法实际上是我所需要的。它检查默认构造函数是否存在并无异常运行。

但后来我开始考虑编译器/JIT 优化的效果。编译器/JIT 能否通过完全消除该`new MyObject();`语句来优化此方法？当然，它需要确定调用图对其他对象没有副作用，这是简单初始化对象内部状态的普通构造函数的典型情况。

我认为只有 JIT 可以执行这样的优化。这可能意味着这不是我应该担心的事情，因为测试方法只执行一次。我的假设正确吗？

不过，我正在尝试考虑一般主题。当我想到如何防止这个方法被优化时，我想我可以`assertTrue(new MyObject().toString() != null)`，但这非常依赖于`toString()`方法的实际实现，即使这样，JIT 也可以确定该`toString()`方法总是返回一个非空字符串（例如如果实际`Object.toString()`被调用），从而优化整个分支。所以这种方式行不通。

我知道在 C# 中我可以使用`[MethodImpl(MethodImplOptions.NoOptimization)]`，但这不是我真正想要的。我希望找到一种（与语言无关的）方法来确保我的代码的某些特定部分实际上会按我的预期运行，而 JIT 不会干扰这个过程。

此外，在创建单元测试时，我应该注意哪些典型的优化案例？

非常感谢！

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-13T22:37:28.927

别担心。不允许优化任何可能对您的系统产生影响的东西（速度除外）。如果你新建一个对象，调用代码，分配内存，它必须工作。

如果你用 if(false) 保护它，其中 false 是最终结果，它可以在系统之外完全优化，然后它可以检测到该方法没有做任何事情并优化它（理论上）。

编辑：顺便说一句，它也可以足够聪明地确定这种方法：

```
newIfTrue(boolean b) {
    if(b)
        new ThisClass();
} 
```

如果 b 为假，将永远不做任何事情，并最终发现代码中的某个时刻 B 始终为假，并完全从该代码中编译出该例程。

这就是 JIT 可以做任何非托管语言几乎不可能完成的事情的地方。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-13T22:34:05.313

我认为如果你担心它会被优化掉，你可能会做一些测试过度。

在静态语言中，我倾向于将编译器视为一种测试。如果它通过编译，这意味着某些东西在那里（比如方法）。如果您没有另一个测试来练习您的默认构造函数（这将证明它不会抛出异常），您可能想首先考虑为什么要编写默认构造函数（YAGNI 和所有这些）。

我知道有些人不同意我的观点，但我觉得这种事情只会无缘无故地增加你的测试数量，即使通过 TDD 护目镜来看也是如此。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-13T22:40:09.217

这样想：

让我们假设编译器可以确定调用图没有任何副作用（我认为不可能，我隐约记得我的 CS 课程中关于 P=NP 的一些内容）。它将优化任何没有副作用的方法。由于大多数测试没有也不应该有任何副作用，因此编译器可以将它们全部优化。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2013-05-20T20:12:30.570

JIT 只允许执行不影响语言保证语义的操作。*从理论上讲，如果*它可以保证调用没有副作用并且永远不会抛出异常（不算数） ，它可以删除分配并调用`MyObject`构造函数。*`OutOfMemoryError`*

 *换句话说，**如果 JIT 优化了您的测试调用，那么您的测试无论如何都会通过**。

PS：请注意，这适用，因为您正在进行*功能*测试而不是*性能*测试。在性能测试中，确保 JIT 不会优化您正在测量的操作非常重要，否则您的结果将变得毫无用处。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-13T22:40:57.280

似乎在 C# 中我可以这样做：

```
[Test]
public void testDefaultConstructor() {
    GC.KeepAlive(new MyObject());
} 
```

AFAIU，该`GC.KeepAlive`方法不会被 JIT 内联，因此代码将保证按预期工作。但是，我不知道 Java 中有类似的构造。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-13T22:37:27.600

为什么要重要？如果编译器/JIT 可以静态确定不会命中任何断言（这可能会导致副作用），那么您就可以了。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-14T08:01:42.750

每个 I/O 都是一个副作用，所以你可以把

```
Object obj = new MyObject();
System.out.println(obj.toString()); 
```

你很好。

# sql - 需要一些关于简单 SQL 查询的帮助

> ID：547944
> 
> 赞同：0
> 
> 时间：2009-02-13T22:28:26.000
> 
> 标签：sql, tsql

我有一个将状态信息转储到数据库的游戏。例如。已连接、丢失连接、抓取屏幕转储等。

每个状态都由一个名为的字段定义`StateTypeId`，它是一个简单查找表的外键`'StateTypes'`。

现在，我正在尝试查找所有当前为“ `Connected`”的人（例如，StateTypeId == 1），但我不知道该怎么做。当我说*当前已连接*时，我的意思是用户没有“ `LostConnection`”状态（即 StateType == 2）作为他们最近的条目。

我是这样想的。

```
SELECT UserId
FROM UserData
WHERE StateType = 1
GROUP BY UserId 
```

或者

```
SELECT UserId
FROM UserData
WHERE StateType != 1
GROUP BY UserId 
```

但这会返回所有结果，而不仅仅是最近的东西。

有什么建议么？

（我猜我错过了一个`TOP(1)`和一些等级/顺序的东西？）

## 编辑

哦！我忘了提，我在表中有一个 DateTime 列 -> DateEntered。

## 编辑 2 - 澄清问题和一些示例数据。

我已经尝试了建议的解决方案，但运气不佳。因此，我将提供一些示例数据，看看这是否有助于澄清我的问题。

```
ID State          UserName DateAdded
1  Connected      Foo      1/1/2000 12:00 
2  Connected      Bar      1/1/2000 12:01  
3  ScreenShot     Foo      1/1/2000 12:05 
4  LostConnection Foo      1/1/2000 12:06
5  Connected      Joe      1/1/2000 12:10
6  LostConnection Joe      1/1/2000 12:15
7  Screenshot     Bar      1/1/2000 12:16
8  Connected      Jane     1/1/2000 12:22 
```

所以看看这个，（当前）连接的人是 Bar 和 Jane。Foo 和 Joe 走了。另请注意，Bar 的最后一个活动是一个屏幕截图，意思是，他的最后一个活动不是 LostConnection 状态。

HTH。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-13T22:37:48.490

您正在寻找的是 StateType 为 1 或 2 的“最新”条目：

然后，您正在寻找为每个用户识别“最后一个”：

```
select UserName, max(DateAdded) as LastDate
from UserData
where State IN ('Connected', 'LostConnection')
Group by UserName 
```

然后您需要检查这些状态（需要与原始表连接）：

```
SELECT UserName
FROM UserData allData join 
    (select UserName, max(DateAdded) as LastDate
    from UserData
    where State IN ('Connected', 'LostConnection')
    Group by UserName) as lastData on allData.UserName = lastData.UserName
        and allData.DateAdded = lastData.LastDate
WHERE StateType = 'Connected' 
```

另一种加入方式是使用 UserData 的 id，如下所示：

```
SELECT UserName
FROM UserData allData join 
    (select max(id) as id -- if ids are assigned in ascending order
    from UserData
    where State IN ('Connected', 'LostConnection')
    Group by UserName) as lastData on allData.id = lastData.id
WHERE StateType = 'Connected' 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-14T00:04:57.093

如果您有日期时间条目或时间戳，您可以这样做：

```
Select UserID
From UserData
Where StateType = 1
Group by UserID
Having Date = Max(Date) 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-14T10:16:14.800

我认为值得测试 NOT EXISTS 方法的性能。

即找到没有更新记录的具有适当StateType 的用户。

```
SELECT UD1.UserId
FROM  UserData AS UD1
WHERE UD1.StateType = 1
      AND NOT EXISTS
      (
--        Check for newer records:
          SELECT *
          FROM UserData AS UD2
          WHERE UD2.DateEntered > UD1.DateEntered
      ) 
```

如果它们在 UserData 中存储了很多行，并且/或者您将它们保留很长时间，那么这种方法可能会表现不佳。

如果是这种情况，并且这是一个经常发生的查询，我会创建一个 UserCurrentState 表（列 = UserId，StateType），当 StateType 发生变化时会更新它（我会在 UserData 表上放置一个触发器来强制执行此操作）

UserData 中的 StateType 索引不够好，无法使用。您可以拥有一个包含 DateEntered、StateType、UserId 的索引，该索引将覆盖查询并因此应该使用，但实际上只有在您可以限制检查的 DateEntered 的范围时才会有帮助。如果您只是在寻找最后一小时/一天的罚款，如果您正在寻找自开始以来的时间，那么它不会有太大帮助。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-14T10:28:10.667

实际上，这可能更有效（SQL Server 2005 以上）

```
SELECT UserId
FROM
(
    SELECT  *, row_number() 
        OVER
        (
            partition BY UserId 
            ORDER BY DateEntered DESC
        ) AS RecordNumber
    FROM UserData
) AS UD
WHERE      RecordNumber = 1
        AND StateType = 1 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-14T21:40:06.093

这是另一种可能的解决方案，尽管使用的解决方案`NOT EXISTS`可能性能更好。

```
SELECT U1.*
FROM UserData U1
 LEFT OUTER JOIN UserData U2
 ON (U1.UserName = U2.UserName
  AND U1.DateAdded < U2.DateAdded
  AND U2.StateType IN (1,2))
WHERE U1.StateType = 1
  AND U2.UserName IS NULL
ORDER BY U1.DateAdded DESC; 
```

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-02-13T22:45:09.283

您将需要一个时间戳列，并且您需要编写一个将表连接到自身的查询，如下所示

```
Select *
From Userdata U
Where 1 = (Select Top 1 StateType
           From Userdata U2
           Where U.UserId = U2.UserId
           order by u2.TimeStamp desc) 
```

# c# - 在没有尝试捕获的情况下检查文件锁定

> ID：547946
> 
> 赞同：1
> 
> 时间：2009-02-13T22:29:30.100
> 
> 标签：c#, .net, vb.net, file-io

有没有更好的方法来检查文件是否未锁定然后打开文件以捕获异常。我有一个在目录上运行的文件监视程序，在文件在该位置完全移动/创建后，我需要对文件执行一些操作。抛出异常不会影响性能吗？有没有更好的办法？

```
Private Function FileAvailable(ByVal fileName As String) As Boolean
    Try
        Using inputStream As FileStream = File.Open(fileName, FileMode.Open, FileAccess.Read, FileShare.None)
            Return True
        End Using
    Catch ex As IOException
        Return False
    End Try
End Function 
```

或者

```
private bool FileAvailable(string fileName) { 
try { 
    using (FileStream inputStream = File.Open(fileName, FileMode.Open, FileAccess.Read, FileShare.None)) { 
        return true; 
    } 
} 
catch (IOException ex) { 
    return false; 
} 
```

}

一个小专家建议最好的方法。谢谢

该文件正在被复制到监视目录中。没有其他用户可以访问该目录。在我自己处理和移动文件之前，我只需要验证文件是否已完全复制到目录中。我需要独占访问它。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-13T22:37:43.403

你打算多久做一次？把它放在上下文中，假设你每 50 毫秒检查一次——这是相当频繁的。*我的笔记本电脑（我上次检查时）能够每毫秒*抛出 100 多个异常......所以抛出异常的成本将低于总时间的 0.02%——假设它总是很忙！

现在，拥有一个 API 来避免这种情况当然会很好——某种意义上`TryOpenFile`——但如果没有它，我只会把它藏在另一个函数中，不用担心。

但是请记住，如果您只是返回一个布尔值，那么您的数据一旦返回就已经过时 - 一旦您返回“没关系”，另一个进程可能会获取排他锁。为避免这种情况，您应该考虑返回打开的流。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-03-24T23:15:33.840

那么[Mutex](http://msdn.microsoft.com/en-us/library/system.threading.mutex.aspx)呢？

# .net - 某些服务器端代码可以使用哪些 Instant Messenger 服务？

> ID：547951
> 
> 赞同：1
> 
> 时间：2009-02-13T22:31:20.267
> 
> 标签：.net, instant-messaging

我有一个应用程序，我想发送一些警报信息。目前，它正在发送电子邮件-> 工作得很好。

我希望将此服务器应用程序与一个/多个即时通讯服务集成，例如 MSN Messenger 或 Google Chat。不过，我不确定我的选择是什么。

如果可能的话，有人有任何信息吗？

最后，我需要使用 .NET 来执行此操作。

干杯:)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-13T22:35:30.147

我认为[libpurple](http://developer.pidgin.im/wiki/WhatIsLibpurple)库是最常用的方法。这就是 Adium 和 Pidgin 和 Meebo 等许多多协议客户端用来与 Google/jabber、Yahoo 和 MSN 等实际 IM 服务通信的方式。

这声称是带有 .NET 绑定的 libpurple：

[http://code.google.com/p/libpurple-sharp/source/checkout](http://code.google.com/p/libpurple-sharp/source/checkout)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-01-27T04:31:16.153

另请参阅[MSNPSharp](http://code.google.com/p/msnp-sharp) ，它只专注于 MSN 的 IM 协议。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-01-27T04:34:50.087

[jabber-net](http://code.google.com/p/jabber-net/)是一个 C# 库，可让您通过 XMPP 协议（​​由 Google Talk 使用）发送消息

# visual-studio - 在 VS 2005 中重新生成缺少的 AssemblyInfo.cs

> ID：547962
> 
> 赞同：5
> 
> 时间：2009-02-13T22:36:06.713
> 
> 标签：visual-studio, assemblyinfo

我正在尝试构建一个小型 VS 2005 解决方案，我刚刚检查了源代码控制，并且我得到了这个易于理解的错误：

> ...\AssemblyInfo.cs' 无法打开（'系统找不到指定的文件。'）（文件明显丢失）

因为这个文件是自动生成的，所以我以前从来没有特别注意过它，而在 VS 2003（我仍然每天都在使用它 - 可怜我）中，它是否丢失似乎并不重要。

所以 2 个问题： 1\. 如何让 VS 2005 重新生成文件。2\. 谁能用几句话向我解释一下程序集信息文件是什么，为什么会生成它，为什么自动生成一个对我的解决方案构建至关重要的文件是个好主意等等等等。

谢谢 - 安德鲁。

编辑：好的，我在谷歌上搜索了更多，这在 Nunit 测试项目中可能很重要。

更新：删除解决方案资源管理器中的引用，Alex 建议这样做了，项目现在可以构建，但我对它作为解决方案并不完全满意。如果文件如此不重要，为什么首先生成它？如果该文件确实执行了一项重要任务，那么仅仅删除它我错过了什么？

还有，有没有可能找回来？通过让VS重新生成它，或者通过手动破解一个（可能使用另一个作为模板）？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-02-13T22:50:40.937

此文件包含程序集范围的设置，如程序集版本、名称等。当您使用项目的属性页面更改这些设置时，它会自动生成。您应该在项目中使用带有透明图标的此文件（我认为它默认位于资源文件夹或类似的东西中）。在项目树中找到它并将其删除。Visual Studio 将在构建期间停止寻找它。

PS：假设路径以 .. 而不是 ... 开头，那么这个文件应该位于源代码管理中项目的上一个文件夹。所以你可以试试看那里。

# sql - 我可以将存储过程的结果加上另一个值插入到临时表中吗？

> ID：547973
> 
> 赞同：2
> 
> 时间：2009-02-13T22:39:40.387
> 
> 标签：sql, tsql

我有一个需要存储过程值的临时表。所以 SP 将 3 列插入到临时表中，然后我想在不修改 SP 的情况下为每一行添加一个日期时间。

由于我调用 SP 3 次，每次使用不同的日期时间，我不能只更新整个临时表。

有什么建议么？

```
DECLARE @temp TABLE
(
    id INT IDENTITY(1,1),
    Name VARCHAR(150),
    Address VARCHAR(25),
    Date DATETIME
)

WHILE (@count>=@daysBack)
BEGIN
    SET @date=DATEADD(dd, @count, GETDATE())
    INSERT INTO @temp (Name,Address)
        EXEC[dbo].StoredProc@date

--I Want to check for Null and insert the date there
    Update @temp SET Date=@date WHERE Date='' 

    SET @count=@count-1 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-13T22:47:14.130

是的。创建临时表，并在添加的日期列中没有来自您的存储过程的表示，放置一个默认值约束 getdate() 或您需要的任何日期公式。在插入语句中明确指定列并省略日期列，它应该可以工作。随着行的添加，默认值约束将启动并为您填充该列。

例子：

```
create table #tmp (c1 int, c2 int, dt datetime default(getdate()) )

insert into #tmp
(c1, c2)
exec mysproc 
```

# web-services - 虚拟服务器 IIS WMI 问题

> ID：547981
> 
> 赞同：1
> 
> 时间：2009-02-13T22:43:52.513
> 
> 标签：web-services, iis, wmi, virtual-machine

我的任务是找出导致这段代码出现问题的原因：

```
public static ArrayList GetEthernetMacAddresses()
{
    ArrayList addresses = new ArrayList();
    ManagementClass mc = new ManagementClass("Win32_NetworkAdapter");

    // This causes GetInstances(options) 
    // to return all subclasses of Win32_NetworkAdapter
    EnumerationOptions options = new EnumerationOptions();
    options.EnumerateDeep = true;

    foreach (ManagementObject mo in mc.GetInstances(options)) {
        string macAddr = mo["MACAddress"] as string;
        string adapterType = mo["AdapterType"] as string;

        if (!StringUtil.IsBlank(macAddr) && !StringUtil.IsBlank(adapterType))
        {
            if (adapterType.StartsWith("Ethernet")) {
                addresses.Add(macAddr);      
            }
        }    
    }
    return addresses;
} 
```

在我们的 (Win2003) 虚拟服务器上，这在作为控制台应用程序的一部分运行时有效，但不能从在 IIS 上运行的 Web 服务（在同一台机器上）运行。

或者，我可以在 IIS（虚拟服务器上）的 Web 服务中使用此代码并获得正确的返回值：

```
public static string GetMacAddresses()
{
    ManagementClass mgmt = new ManagementClass(
        "Win32_NetworkAdapterConfiguration"
        );
    ManagementObjectCollection objCol = mgmt.GetInstances();

    foreach (ManagementObject obj in objCol)
    {
        if ((bool)obj["IPEnabled"])
        {
            if (sb.Length > 0)
            {
                sb.Append(";");
            }
            sb.Append(obj["MacAddress"].ToString());
        }
        obj.Dispose();
    }
} 
```

为什么第二个有效而不是第一个？

为什么只在通过虚拟机上的 IIS Web 服务调用时？

任何帮助，将不胜感激。

* * *

**更新：** 在与所有不同级别的 MS 支持打了很多电话之后，我们得出结论，这是“按设计”。

由于它在虚拟网络适配器驱动程序的驱动程序级别上，答案是我们应该更改我们的代码“以解决这个问题”。

这意味着您无法在虚拟服务器上可靠地测试代码，除非您使用在物理服务器上使用的相同代码，因为我们不能保证服务器是精确的副本......

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-26T23:08:44.397

好的，所以我写了这段代码来测试这个问题：

```
public void GetWin32_NetworkAdapter()
{
    DataTable dt = new DataTable();
    dt.Columns.Add("AdapterName", typeof(string));
    dt.Columns.Add("ServiceName", typeof(string));
    dt.Columns.Add("AdapterType", typeof(string));
    dt.Columns.Add("IPEnabled", typeof(bool));
    dt.Columns.Add("MacAddress", typeof(string));

    //Try getting it by Win32_NetworkAdapterConfiguration

    ManagementClass mgmt = new ManagementClass("Win32_NetworkAdapter");
    EnumerationOptions options = new EnumerationOptions();
    options.EnumerateDeep = true;

    ManagementObjectCollection objCol = mgmt.GetInstances(options);

    foreach (ManagementObject obj in objCol)
    {
        DataRow dr = dt.NewRow();
        dr["AdapterName"] = obj["Caption"].ToString();
        dr["ServiceName"] = obj["ServiceName"].ToString();
        dr["AdapterType"] = obj["AdapterType"];
        dr["IPEnabled"] = (bool)obj["IPEnabled"];
        if (obj["MacAddress"] != null)
        {
            dr["MacAddress"] = obj["MacAddress"].ToString();
        }
        else
        {
            dr["MacAddress"] = "none";
        }
        dt.Rows.Add(dr);
    }

    gvConfig.DataSource = dt;
    gvConfig.DataBind();

} 
```

* * *

当它在物理 IIS 盒子上运行时，我得到这个： [物理 IIS 服务器 http://img14.imageshack.us/img14/8098/physicaloutput.gif](http://img14.imageshack.us/img14/8098/physicaloutput.gif)

虚拟 IIS 服务器上的相同代码： [虚拟服务器 http://img25.imageshack.us/img25/4391/virtualoutput.gif](http://img25.imageshack.us/img25/4391/virtualoutput.gif)

**看出区别了吗？** 它在第一行。虚拟服务器不返回“AdapterType”字符串。这就是原始代码失败的原因。

这带来了一个有趣的想法。如果虚拟服务器应该是真实 IIS 服务器的“虚拟”表示，为什么它不返回相同的值？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-14T00:03:31.217

为什么两者返回不同的结果？由于用户帐户不同，您可能会从控制台和服务中获得不同的结果。

为什么（1）失败而（2）有效？adapterType 的 null 结果是否可能返回 null 值？如果是这样，代码会处理这种情况吗？

# ssl - 无法使用 Microsoft Virtual PC Windows XP / IE 6 Image 加载 SSL 站点

> ID：547994
> 
> 赞同：0
> 
> 时间：2009-02-13T22:49:12.657
> 
> 标签：ssl, internet-explorer-6, https, virtualization, virtual-pc

我正在尝试使用 Microsoft 的 Win XP / IE 6 虚拟机映像在 IE 6 中测试我的站点，但我无法在虚拟机内的 IE 6 或 Firefox 2 中加载任何 SSL 站点。在 VM 之外，所有站点都按预期加载，但在 VM 内部，在任一浏览器中都找不到站点。非 SSL 站点在 VM 内加载良好。

例如，Firefox 2.0.0.20 错误消息是“Firefox 无法在 secure.example.com 找到服务器”。

是否必须在 VM 中启用特殊功能才能允许连接到 SSL 站点？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-14T00:39:34.780

虚拟机或主机上是否有某种防火墙设置可能阻止端口 443（HTTPS/SSL 端口）？这似乎是我的罪魁祸首。

安全策略中还有另一个设置：“系统加密：使用符合 FIPS 的算法进行加密、散列和签名”。如果设置了此项，您将无法连接到不使用 TLS 1.0 的服务器，大多数站点不提供 TLS 1.0，但是根据我过去的经验，这只影响了 Internet Explorer，而不影响 Firefox。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-16T22:16:51.140

原来是DNS问题。我将 VM 操作系统中的 DNS 服务器切换为使用 OpenDNS，并且这些站点没有出现问题。******************************