# StackOverflow 问答 000149000-000149999

# unit-testing - Rhino Mocks，MbUnit：检查对象是否引发事件的最佳方法

> ID：149008
> 
> 赞同：4
> 
> 时间：2008-09-29T14:45:19.110
> 
> 标签：unit-testing, rhino-mocks, mbunit

我有一个正在测试的对象，它引发了一个事件。使用 Rhino Mocks 检查它是否被饲养的最佳方法是什么？

我能想到的最好的（我确信它会比这更好）：

```
public void MyCallback(object sender, EventArgs e) { _flag = true;}

[Test]
public void DoSomethingRaisesEvent() {
  _flag = false;
  using(_mocks.Record()) {
    Expect.Call(delegeate { _obj.DoSomething();});
  }
  using(_mocks.Playback()) {
    _obj = new SomethingDoer();
    _obj.SomethingWasDoneEvent += new EventHandler(MyHandler);
    Assert.IsTrue(_flag);
  }
} 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-29T18:03:03.347

我发现[了 Phil Haack 的这篇关于如何使用匿名委托测试事件的文章](http://haacked.com/archive/2006/12/13/tip_jar_unit_test_events_with_anonymous_delegates.aspx)

这是代码，直接从他的博客中翻录给那些懒得点击的人：

```
[Test]
public void SettingValueRaisesEvent()
{
    bool eventRaised = false;
    Parameter param = new Parameter("num", "int", "1");
    param.ValueChanged += 
        delegate(object sender, ValueChangedEventArgs e)
        {
            Assert.AreEqual("42", e.NewValue);
            Assert.AreEqual("1", e.OldValue);
            Assert.AreEqual("num", e.ParameterName);
            eventRaised = true;
        };
    param.Value = "42"; //should fire event.

    Assert.IsTrue(eventRaised, "Event was not raised");
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-29T15:05:42.383

我不确定您的测试实际上是如何调用 DoSomething() 方法的。也许你错过了一些触发事件的东西。除此之外，我认为您在使用 Rhino Mocks 测试事件方面走在了正确的轨道上

无论如何，这是我喜欢处理事件的另一种方式：

```
[Test]
public void MyEventTest()
{

    IEventRaiser eventRaiser;

    mockView = _mocks.CreateMock<IView>();
    using (_mocks.Record())
    {
      mockView.DoSomethingEvent += null;
      eventRaiser = LastCall.IgnoreArguments();
    }
    using (_mocks.Playback())
    {
       new Controller(mockView, mockModel);
       eventRaiser.Raise(mockView, EventArgs.Empty);
    }
} 
```

# cocoa - NSCoder vs NSDictionary，什么时候用什么？

> ID：149021
> 
> 赞同：9
> 
> 时间：2008-09-29T14:48:06.700
> 
> 标签：cocoa

我试图弄清楚如何决定何时使用 NSDictionary 或 NSCoder/NSCoding？

似乎对于一般属性列表和这样的 NSDictionary 是生成可在应用程序之外轻松编辑的 XML 文件的简单方法。

在处理包含数据的自定义类或可能嵌套在其中的其他自定义类时，似乎 NSCoder/NSCoding 会是更好的路线，因为它会逐步遍历所有包含的对象类并在使用归档命令时对它们进行编码。

NSDictionary 似乎需要更多的工作才能将所有属性或数据特征放到一个级别才能保存它，因为 NSCoder/NSCoding 会自动编码实现 NSCoding 接口的嵌套自定义类。

除了它是二进制数据并且在您的应用程序之外不可编辑之外，是否有真正的理由使用一个而不是另一个？沿着这些思路，是否有一个指标表明您应该在两者之间倾斜哪种方式？我错过了一些明显的东西吗？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-09-29T15:27:49.897

苹果关于[对象图](http://developer.apple.com/documentation/Cocoa/Conceptual/Archiving/Concepts/objectgraphs.html)的文档有这样的说法：

> Mac OS X 序列化存储值对象的简单层次结构，例如字典、数组、字符串和二进制数据。序列化仅保留对象的值及其在层次结构中的位置。反序列化时对同一值对象的多次引用可能会导致多个对象。不维护对象的可变性。
> 
> …</p>
> 
> Mac OS X 归档存储任意复杂的对象图。存档保留了图中每个对象的身份以及它与图中所有其他对象的所有关系。未归档时，重建的对象图应该是原始对象图的精确副本，除了少数例外。

我的解释是，如果你想存储简单的*值*，序列化（例如使用 NSDictionary）是一个很好的方法。如果您想存储任意类型的*对象图*，并保留唯一性和可变性，那么使用存档（例如使用 NSCoder）是您最好的选择。

您可能还想阅读 Apple 的[Cocoa Archives and Serializations Programming Guide](http://developer.apple.com/documentation/Cocoa/Conceptual/Archiving/)，其中前面链接的关于对象图的页面是其中的一部分，因为它很好地涵盖了这个主题。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-29T17:53:24.993

我*不*喜欢使用 NSCoding/NSCoder/NSArchiver（我们需要选择一个名称！）将对象图序列化为文件。

以这种方式创建的档案非常脆弱。如果您保存 Foo 类的对象，那么天哪，您需要确保当您将数据加载回您的应用程序中时，您的应用程序中有一个 Foo 类。

从与其他应用程序共享文件的角度来看，这使得基于 NSCoder 的序列化变得困难，甚至与您未来的应用程序兼容。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-29T18:40:15.580

我忘了列出我会推荐的东西。

NSCoding 在某些情况下是可以的：如果你只是做一些快速而简单的事情（尽管你必须编写很多代码——每个类有两个方法要序列化）。如果您不担心与其他应用程序的兼容性，也可以。

通过属性列表导出/导入（可能使用 NSPropertyListSerializaion 类）是一个很好的解决方案。基于 XML 的 plist 易于创建和编辑。plists 的主要优点是您不会将文件格式绑定到您的应用程序。

您还可以创建自己的基于 XML 的文件格式并使用 NSXMLDocument API 和朋友对其进行读/写。这实际上并没有比使用属性列表更多的工作。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-29T15:27:01.583

我想你有点糊涂了，NSDictionary 是一种数据结构，它也恰好实现了 NSCoding 协议。因此，从本质上讲，您可以将所有数据放入 NSDictionary 并稍后对其进行编码，或者您可以实现 NSCoding 协议并使用 NSCoder API 对对象树进行编码。根据传入 encodeWithCoder: 方法的 NSCoder 对象的类型，是您的编码的输出。

# pop3 - POP3 CAPA UIDL 命令有什么作用？

> ID：149024
> 
> 赞同：11
> 
> 时间：2008-09-29T14:49:32.283
> 
> 标签：pop3

POP3 CAPA UIDL 命令有什么作用？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-09-29T14:51:54.867

它检查 pop3 服务器是否理解（具有 CAPAbility）UIDL 命令。

根据服务器是否支持 UIDL 命令，响应应该是“+OK”或“-ERR”。

UIDL 命令返回（如果支持）每条消息的唯一标识，因此客户端可以可靠地标识消息。

另请参阅：[rfc2449](http://www.ietf.org/rfc/rfc2449.txt) (CAPA) 和[rfc1939](http://www.ietf.org/rfc/rfc1939.txt) (POP3)。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-11-25T19:32:48.097

CAPA 是一个命令。UIDL 是另一个命令。您可以使用 telnet 连接到 POP 服务器的 110 端口 ( telnet:pop.example.com:110 ) 来试用它们。telnet 建立 TCP 连接后，POP 服务器应该发送类似“+OK Microsoft Exchange POP3 服务已准备好”的信息。您可以键入“CAPA”并按回车键，然后 POP 服务器应以它支持的功能列表进行响应（在该会话状态下，即在登录之前）。您可以通过发送“用户@name@ 并按回车键登录，其中@name@ 将更改为您的POP 帐户名称。然后您输入“通过@pw@”并按回车键，其中@pw@ 是您的密码。这通过网络向您发送明文密码，以便嗅探链接的人可以轻松看到您的密码。您的 POP 服务器可能需要其他更安全的登录方式。（不要'

假设一切顺利，您可以再次尝试“CAPA”，因为会话已经建立并且处于不同的状态。根据服务器配置，功能列表可能相同或不同。此时您可以键入“STAT”并按回车键。POP 服务器应返回“+OK @x@ @y@”，其中@x@ 是消息数，@y@ 是所有消息的字节长度。现在您可以尝试输入“UIDL”并按回车键。POP 服务器将返回一个带有“@n@ @uid@”的列表，其中@n@ 是消息号，@uid@ 是 POP 服务器分配的唯一标识符。

键入 QUIT 并按回车键结束会话并关闭 TCP 连接。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-09-29T14:53:46.437

UIDL 能力表示支持可选的 UIDL 命令。

POP3 服务器可以为每个传入的邮件消息分配一个唯一编号。这允许邮件在下载给用户后留在服务器上。邮件客户端和 POP 服务器都必须支持此功能。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-09-29T14:53:48.527

根据[POP3 RFC](http://www.ietf.org/rfc/rfc1939.txt)，该`UIDL`命令将为您提供消息的唯一 ID。

RFC 继续说：

> 消息的唯一 ID 是由服务器确定的任意字符串，由 0x21 到 0x7E 范围内的 1 到 70 个字符组成，它唯一地标识邮件投递中的消息，并且在会话中持续存在。

[POP3 Exensions RFC](http://www.ietf.org/rfc/rfc2449.txt)说该命令`CAPA`允许您查询**服务器**的功能。

因此该`CAPA UIDL`命令用于查看服务器是否支持唯一 ID。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-29T14:53:29.200

UIDL 是[RFC 1939](http://www.ietf.org/rfc/rfc1939.txt)中描述的唯一 ID 列表功能。这意味着服务器支持为每条消息生成唯一的 ID，以便客户端更轻松地处理留在服务器上的消息。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-29T14:51:53.150

为 POP3 服务器上的消息提供唯一标识符。可能的响应：+OK 或 -ERR

# linux - 我应该什么时候编写 Linux 内核模块？

> ID：149032
> 
> 赞同：36
> 
> 时间：2008-09-29T14:52:42.227
> 
> 标签：linux, module, kernel

有些人出于某种原因想将代码从用户空间移动到 Linux 内核空间。很多时候，原因似乎是代码应该具有特别高的优先级，或者只是“内核空间更快”。

这对我来说似乎很奇怪。我什么时候应该考虑编写内核模块？有没有一套标准？

我如何激励将代码保留在（我相信）属于那里的用户空间中？

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2008-09-30T18:19:27.370

经验法则：**尽最大**努力将代码保留在用户空间中。如果您认为自己做不到，请花尽可能多的时间来研究内核代码的替代方案，就像编写代码一样（即：很长时间），然后*再次尝试*在用户空间中实现它。如果您*仍然*不能，请进行更多研究以确保您做出正确的选择，然后*非常谨慎*地进入内核。正如其他人所说，*很少有*情况要求编写内核模块和调试内核代码可能会非常糟糕，因此不惜一切代价避开。

至于在考虑编写内核模式代码时应该检查的具体条件，这里有一些： 它是否需要访问极低级别的资源，例如中断？*您的代码是否为无法*在当前导出的功能之上构建的硬件定义了新的接口/驱动程序？您的代码是否**需要**访问未从内核空间导出的数据结构或原语？您是否正在编写主要由*其他*内核子系统使用的东西，例如调度程序或 VM 系统（即使在这里，子系统也不一定是内核模式：Mach 对*用户模式*虚拟内存分页器有很强的支持，所以肯定可以做到）？

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2008-09-29T15:21:48.710

将东西放入内核的理由非常有限。如果您正在编写设备驱动程序，那没关系。任何标准应用程序：从不。

缺点是巨大的。调试变得更加困难，错误变得更加频繁且难以发现。您可能会损害安全性和稳定性。您可能必须更频繁地适应内核更改。移植到其他 UNIX 操作系统变得不可能。

我最接近内核的是自定义文件系统（在后台使用 mysql），甚至为此我们使用了 FUSE（其中 U 代表用户空间）。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-09-29T14:59:27.843

我不确定这个问题是否正确。将事物移至内核空间应该有充分的理由。如果没有任何理由，请不要这样做。

一方面，调试变得更加困难，并且错误的影响更糟（崩溃/恐慌而不是简单的核心转储）。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-01-30T01:49:29.860

基本上，我同意 rpj。除非真的有必要，否则代码必须在用户空间中。

但是，为了强调你的问题，哪个条件？

有些人声称驱动程序必须在内核中，这是不正确的。有些司机对时间不敏感，事实上很多司机都是这样的。

例如，成帧器、RTC 定时器、i2c 设备等。这些驱动程序可以很容易地移动到用户空间。甚至有一些文件系统是在用户空间中编写的。

您应该转移到开销较大的内核空间，例如。用户内核交换，对于您的代码正常工作变得不可接受。

但是有很多方法可以解决这个问题。例如，/dev/mem 提供了一种访问物理内存的好方法，就像您从内核空间进行访问一样。

当人们谈论使用 RTOS 时，我通常持怀疑态度。这些天来，处理器是如此强大，以至于大多数时候，实时方面变得可以忽略不计。

但是，即使，假设您正在处理 SONET，并且您需要在 50 毫秒内进行保护切换（实际上甚至更少，因为 50 毫秒的约束适用于整个环），您仍然可以非常快速地进行切换，如果您硬件支持它。

如今，许多成帧器可以为您提供硬件支持，从而减少您需要执行的写入量。您的工作基本上是尽快响应中断。Linux 一点也不差。即使我有大量其他中断正在运行（例如 IDE、以太网等），我得到的中断延迟也少于 1 毫秒。

如果这还不够，那么您的硬件设计可能是错误的。有些东西最好留在硬件上。当我说硬件时，我指的是 ASIC、FPGA、网络处理器或其他高级逻辑。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-29T15:09:49.783

在内核中运行的代码以不同于用户空间代码的方式访问内存、外围设备、系统功能，因此具有更高效率的能力。更不用说减少内核代码的安全限制了。然而，所有这一切通常都是有代价的，例如增加内核面临安全威胁的可能性、锁定操作系统、使调试复杂化等等。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-01T18:59:34.910

如果您的员工想要真正的高优先级、确定性、低延迟等，那么正确的方法是使用一些实时版本的 Linux（或其他操作系统）。

还要查看可抢占的内核选项等。您应该做什么取决于要求，但是将代码放在内核模块中不太可能是正确的解决方案，除非您直接连接某些硬件。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2015-02-18T13:09:50.740

不将代码移动到内核空间的另一个原因是，当您在生产或商业环境中使用它时，由于 GPL 协议，您必须发布该代码。许多软件公司都不想遇到这种情况。:)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-30T16:27:24.737

作为一般规则。想想你想知道什么，如果这是你会在操作系统开发书籍或课程中看到的东西，那么它很有可能属于内核。如果没有，请将其排除在内核之外。如果您有充分的理由打破该规则，请确保您将拥有足够的知识来自己了解它，或者您将与具有该知识的人一起工作。

是的，听起来可能很刺耳，但这正是我的意思，如果你不知道，那么几乎可以肯定答案是否定的，不要在内核中这样做。将您的开发转移到内核空间会打开一大堆蠕虫，您必须确保能够处理这些蠕虫。

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2008-12-21T05:48:06.297

如果您只需要更低的延迟、更高的吞吐量等，那么购买速度更快的计算机可能比开发内核代码**更便宜。**

内核模块*可能*更快（由于更少的上下文切换、更少的系统调用开销和更少的中断），并且确实*以*非常高的优先级运行。如果您想将少量相当简单的代码导出到内核空间，这可能没问题。也就是说，如果发现一小段代码对性能至关重要，*并且*是可以从放置在内核模式中受益的那种代码，那么将其放置在那里可能是合理的。

但是应该避免将程序的大部分移动到内核空间，除非所有其他选项都完全用尽。除了这样做的难度之外，性能收益不太可能很大。

* * *

## 回答 #10

> 赞同：-5
> 
> 时间：2009-02-10T17:36:35.307

如果你问这样的问题，那么你不应该去内核层。基本上只是想知道意味着你不需要。上下文切换的时间是如此微不足道，以至于这些天无论如何都无关紧要。

# c++ - 在 C++ 中存储货币值的最佳方法

> ID：149033
> 
> 赞同：67
> 
> 时间：2008-09-29T14:53:13.257
> 
> 标签：c++, currency

我知道由于舍入错误，浮点数不适合存储货币值。有没有一种标准的方式来用 C++ 来表示金钱？

我查看了 boost 库，并没有发现任何关于它的信息。在 java 中，似乎 BigInteger 是一种方式，但我在 C++ 中找不到等价物。我可以编写自己的货币类，但如果有测试，我宁愿不这样做。

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2008-09-29T16:01:08.460

不要将其存储为美分，因为当您很快乘以税收和利息时，您会累积错误。至少，保留额外的两位有效数字：$12.45 将存储为 124,500。如果你把它保存在一个有符号的 32 位整数中，你将有 200,000 美元可以使用（正数或负数）。如果您需要更大的数字或更精确的数字，带符号的 64 位整数可能会为您提供长时间所需的所有空间。

将这个值包装在一个类中可能会有所帮助，为您提供一个创建这些值、对它们进行算术运算以及格式化它们以供显示的地方。这也将为您提供一个中心位置来携带它所存储的货币（美元、加元、欧元等）。

* * *

## 回答 #2

> 赞同：28
> 
> 时间：2008-09-29T14:59:31.993

在实际的金融系统中处理过这个问题后，我可以告诉你，你可能想要使用一个至少有 6 个小数位精度的数字（假设是美元）。希望既然你在谈论货币价值，你就不会在这里失控。有向 C++ 添加十进制类型的建议，但我不知道实际存在的任何类型。

此处使用的最佳本机 C++ 类型是 long double。

其他仅使用 int 的方法的问题在于，您必须存储的不仅仅是美分。金融交易通常乘以非整数值，这会给您带来麻烦，因为 100.25 美元转换为 10025 * 0.000123523（例如 APR）会导致问题。您最终将进入浮点土地，并且转换将花费您很多。

现在这个问题在大多数简单的情况下都不会发生。我给你一个准确的例子：

给定几千个货币值，如果您将每个值乘以一个百分比然后将它们相加，那么您最终将得到一个不同的数字，而不是如果您没有保留足够的小数位，您将总数乘以该百分比。现在这可能在某些情况下有效，但您通常会很快减少几美分。根据我的一般经验，确保您保持最多 6 位小数的精度（确保剩余的精度可用于整数部分）。

还要了解，如果您以不太精确的方式进行数学运算，则存储它的类型并不重要。如果您的数学是在单精度土地上完成的，那么您是否以双精度存储它并不重要。您的精度对于最不精确的计算是正确的。

* * *

话虽如此，如果你只做简单的加法或减法运算，然后存储数字，那么你会没事的，但是一旦出现比这更复杂的东西，你就会有麻烦了。

* * *

## 回答 #3

> 赞同：24
> 
> 时间：2008-09-29T15:09:35.150

查看相对较新的[Intelr Decimal Floating-Point Math Library](http://software.intel.com/en-us/articles/intel-decimal-floating-point-math-library)。它专门用于金融应用程序，并实现了一些[二进制浮点运算的新标准 (IEEE 754r)](http://en.wikipedia.org/wiki/IEEE_754r)。

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2010-07-08T15:07:00.247

最大的问题是四舍五入！

42,50 欧元的 19% = 8,075 欧元。由于德国的四舍五入规则，这是 8,08 欧元。问题是，（至少在我的机器上）8,075 不能表示为双精度。即使我将调试器中的变量更改为此值，我最终还是 8,0749999....

这就是我的舍入函数（以及我能想到的任何其他浮点逻辑）失败的地方，因为它产生 8,07 欧元。有效数字为 4，因此该值向下舍入。这是完全错误的，除非您尽可能避免使用浮点值，否则您将无能为力。

如果您将 42,50 € 表示为整数 42500000，则效果很好。

42500000 * 19 / 100 = 8075000。现在您可以应用 8080000 以上的舍入规则。出于显示原因，这可以很容易地转换为货币值。8,08 欧元。

但我总是会在课堂上把它包起来。

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2008-09-29T14:55:48.867

我建议您为美分而不是美元的数量保留一个变量。那应该消除舍入误差。以标准美元/美分格式显示它应该是一个视图问题。

* * *

## 回答 #6

> 赞同：9
> 
> 时间：2011-01-04T00:37:43.837

您可以尝试十进制数据类型：

[https://github.com/vpiotr/decimal_for_cpp](https://github.com/vpiotr/decimal_for_cpp)

旨在存储以货币为导向的值（货币余额、货币汇率、利率），用户定义的精度。最多 19 位数字。

它是 C++ 的仅标头解决方案。

* * *

## 回答 #7

> 赞同：9
> 
> 时间：2017-08-28T01:29:24.973

你说你已经查看了 boost 库，但没有发现任何关于那里的信息。但是你有[multiprecision/cpp_dec_float](http://www.boost.org/doc/libs/1_65_0/libs/multiprecision/doc/html/boost_multiprecision/tut/floats/cpp_dec_float.html)说：

> 这种类型的基数是 10。因此，它的行为可能与 base-2 类型略有不同。

因此，如果您已经在使用 Boost，这应该对货币价值和操作有好处，因为它的基数为 10 数字和 50 或 100 位精度（很多）。

看：

```
#include <iostream>
#include <iomanip>
#include <boost/multiprecision/cpp_dec_float.hpp>

int main()
{
    float bogus = 1.0 / 3.0;
    boost::multiprecision::cpp_dec_float_50 correct = 1.0 / 3.0;

    std::cout << std::setprecision(16) << std::fixed 
              << "float: " << bogus << std::endl
              << "cpp_dec_float: " << correct << std::endl;

    return 0;
} 
```

输出：

> 浮动：0.3333333432674408
> 
> cpp_dec_float: 0.3333333333333333

*我并不是说浮点数（以 2 为底）不好，而十进制（以 10 为底）是好的。他们只是表现不同...

** 我知道这是一篇旧帖子，并且 boost::multiprecision 是在 2013 年推出的，所以想在这里评论一下。

* * *

## 回答 #8

> 赞同：7
> 
> 时间：2008-09-29T16:18:37.043

了解您的数据范围。

浮点数仅适用于 6 到 7 位的精度，因此这意味着最大值约为 +-9999.99 而没有四舍五入。对于大多数金融应用程序来说，它是无用的。

双精度数适用于 13 位数字，因此：+-99,999,999,999.99，使用大数字时仍要小心。认识到减去两个相似的结果会剥夺大部分精度（有关潜在问题，请参阅有关数值分析的书）。

32 位整数适合 +-20 亿（缩放到便士将减少 2 个小数位）

64 位整数可以处理任何钱，但同样，在转换时要小心，并乘以您的应用程序中可能是浮动/双倍的各种费率。

关键是要了解您的问题域。您对准确性有哪些法律要求？您将如何显示这些值？转换多久发生一次？你需要国际化吗？在做出决定之前，请确保您可以回答这些问题。

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2008-09-29T15:14:36.323

无论您决定选择哪种类型，我都建议您将其包装在“typedef”中，以便您可以在不同时间更改它。

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2008-09-29T14:55:38.350

这取决于您在舍入方面的业务要求。最安全的方法是存储具有所需精度的整数并知道何时/如何应用舍入。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2008-09-29T15:26:27.637

整数，总是——将它存储为美分（或任何你正在编程的最低货币。）问题是，无论你用浮点数做什么，总有一天你会发现如果你这样做，计算会有所不同它是浮点数。最后一分钟的四舍五入不是答案，因为实际货币计算在进行时会四舍五入。

你也不能通过改变操作的顺序来避免这个问题——当你有一个百分比让你没有正确的二进制表示时，这会失败。如果你差一分钱，会计师会发疯的。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2016-03-15T18:07:58.963

将美元和美分金额存储为两个单独的整数。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2008-09-29T15:03:12.357

如果使用基于十进制的货币，我建议使用 long int 以最小面额存储货币（例如，美国货币是美分）。

非常重要：确保根据实际包含的内容命名所有货币值。（例如：account_balance_cents）这将避免很多问题。

（另一个出现这种情况的例子是百分比。当它实际上包含一个不乘以一百的比率时，切勿将值命名为“XXX_percent”。）

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2014-10-15T01:48:24.647

解决方案很简单，将所需的精度存储为移位整数。但是当读入转换为双浮点数时，计算会遭受更少的舍入错误。然后在数据库中存储时乘以所需的任何整数精度，但在截断为整数之前添加 +/- 1/10 以补偿截断错误，或 +/- 51/100 进行舍入。十分简单。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-09-29T15:11:01.107

[GMP](http://gmplib.org/)库具有“bignum”实现，可用于处理金钱所需的任意大小的整数计算。请参阅[mpz_class的文档](http://gmplib.org/manual/C_002b_002b-Interface-Integers.html#C_002b_002b-Interface-Integers) *（警告：尽管这非常不完整，但提供了全范围的算术运算符）*。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2008-09-29T15:19:24.130

一种选择是将 10.01 美元存储为 1001，并以美分进行所有计算，在显示值时除以 100D。

或者，使用浮点数，并且仅在最后可能的时刻进行舍入。

通常可以通过改变操作顺序来缓解问题。

不要使用 value * .10 来获得 10% 的折扣，而是使用 (value * 10)/100，这将有很大帮助。（记住 .1 是一个重复的二进制文件）

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2008-09-29T15:50:56.457

我们的金融机构使用“双”。由于我们是一家“固定收入”商店，因此我们有许多令人讨厌的复杂算法，无论如何都使用 double。诀窍是确保您的最终用户演示不会超过 double 的精度。例如，当我们有一个总价值数万亿美元的交易清单时，我们必须确保我们不会因为四舍五入的问题而打印垃圾。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2016-07-22T17:07:47.393

对于 32 位，我会使用有符号长，对于 64 位，我会使用有符号长。这将为您提供基础数量本身的最大存储容量。然后我会开发两个自定义操纵器。一种是根据汇率转换该数量，另一种是将该数量格式化为您选择的货币。您可以为各种金融操作/规则开发更多的操纵器。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2021-09-12T21:15:06.637

这是一个非常古老的帖子，但我想我会更新一点，因为已经有一段时间了，事情已经发生了变化。我在下面发布了一些代码，这些代码代表了我能够使用编程语言`long long integer`中的数据类型来表示货币的最佳方式。`C`

```
#include <stdio.h>

int main()
{
    // make BIG money from cents and dollars
    signed long long int cents = 0;
    signed long long int dollars = 0;

    // get the amount of cents
    printf("Enter the amount of cents: ");
    scanf("%lld", &cents);

    // get the amount of dollars
    printf("Enter the amount of dollars: ");
    scanf("%lld", &dollars);

    // calculate the amount of dollars
    long long int totalDollars = dollars + (cents / 100);

    // calculate the amount of cents
    long long int totalCents = cents % 100;

    // print the amount of dollars and cents
    printf("The total amount is: %lld dollars and %lld cents\n", totalDollars, totalCents);
} 
```

* * *

## 回答 #20

> 赞同：-2
> 
> 时间：2008-09-29T18:35:35.750

继续写你自己的钱（[http://junit.sourceforge.net/doc/testinfected/testing.htm](http://junit.sourceforge.net/doc/testinfected/testing.htm)）或货币（）类（取决于你需要什么）。并测试它。

# jakarta-ee - JMSorrelationID 过滤 JMS 消息接收方

> ID：149037
> 
> 赞同：10
> 
> 时间：2008-09-29T14:54:04.143
> 
> 标签：jakarta-ee, queue, jms

如何在 java (JRE /JDK / J2EE 1.4) 中实例化只接收与给定 JMSCorrelationID 匹配的消息的 JMS 队列侦听器？我要获取的消息已发布到队列而不是主题，尽管如果需要可以更改。

这是我目前用来将消息放入队列的代码：

```
/**
 * publishResponseToQueue publishes Requests to the Queue.
 *
 * @param   jmsQueueFactory             -Name of the queue-connection-factory
 * @param   jmsQueue                    -The queue name for the request
 * @param   response                     -A response object that needs to be published
 * 
 * @throws  ServiceLocatorException     -An exception if a request message
 *                                      could not be published to the Topic
 */
private void publishResponseToQueue( String jmsQueueFactory,
                                    String jmsQueue,
                                    Response response )
        throws ServiceLocatorException {

    if ( logger.isInfoEnabled() ) {
        logger.info( "Begin publishRequestToQueue: " +
                         jmsQueueFactory + "," + jmsQueue + "," + response );
    }
    logger.assertLog( jmsQueue != null && !jmsQueue.equals(""),
                      "jmsQueue cannot be null" );
    logger.assertLog( jmsQueueFactory != null && !jmsQueueFactory.equals(""),
                      "jmsQueueFactory cannot be null" );
    logger.assertLog( response != null, "Request cannot be null" );

    try {

        Queue queue = (Queue)_context.lookup( jmsQueue );

        QueueConnectionFactory factory = (QueueConnectionFactory)
            _context.lookup( jmsQueueFactory );

        QueueConnection connection = factory.createQueueConnection();
        connection.start();
        QueueSession session = connection.createQueueSession( false,
                                    QueueSession.AUTO_ACKNOWLEDGE );

        ObjectMessage objectMessage = session.createObjectMessage();

        objectMessage.setJMSCorrelationID(response.getID());

        objectMessage.setObject( response );

        session.createSender( queue ).send( objectMessage );

        session.close();
        connection.close();

    } catch ( Exception e ) {
        //XC3.2  Added/Modified BEGIN
        logger.error( "ServiceLocator.publishResponseToQueue - Could not publish the " +
                      "Response to the Queue - " + e.getMessage() );
        throw new ServiceLocatorException( "ServiceLocator.publishResponseToQueue " +
                                           "- Could not publish the " +
                      "Response to the Queue - " + e.getMessage() );
        //XC3.2  Added/Modified END
    }

    if ( logger.isInfoEnabled() ) {
        logger.info( "End publishResponseToQueue: " +
                         jmsQueueFactory + "," + jmsQueue + response );
    }

}  // end of publishResponseToQueue method 
```

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-09-29T15:25:14.443

队列连接设置是相同的，但是一旦有了 QueueSession，就可以在创建接收器时设置选择器。

```
 QueueReceiver receiver = session.createReceiver(myQueue, "JMSCorrelationID='theid'"); 
```

然后

```
receiver.receive() 
```

或者

```
receiver.setListener(myListener); 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-29T16:10:32.227

顺便说一句，虽然这不是您提出的实际问题 - 如果您尝试通过 JMS 实现请求响应，我建议您[阅读这篇文章](http://activemq.apache.org/how-should-i-implement-request-response-with-jms.html)，因为 JMS API 比您想象的要复杂得多，并且有效地做到这一点比它困难得多看起来。

特别是[为了有效地使用 JMS](http://activemq.apache.org/how-do-i-use-jms-efficiently.html)，您应该尽量避免为单个消息等创建消费者。

此外，由于 JMS API 非常复杂，无法正确有效地使用——尤其是在池、事务和并发处理方面——我建议人们[将中间件从他们的应用程序代码中隐藏起来，](http://activemq.apache.org/camel/hiding-middleware.html)例如通过使用[Apache Camel 的 JMS 的 Spring Remoting 实现](http://activemq.apache.org/camel/spring-remoting.html)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2015-01-06T18:51:40.373

希望这会有所帮助。我使用了 Open MQ。

```
package com.MQueues;

import java.util.UUID;

import javax.jms.JMSException;
import javax.jms.MessageProducer;
import javax.jms.QueueConnection;
import javax.jms.QueueReceiver;
import javax.jms.QueueSession;
import javax.jms.Session;
import javax.jms.TextMessage;

import com.sun.messaging.BasicQueue;
import com.sun.messaging.QueueConnectionFactory;

public class HelloProducerConsumer {

public static String queueName = "queue0";
public static String correlationId;

public static String getCorrelationId() {
    return correlationId;
}

public static void setCorrelationId(String correlationId) {
    HelloProducerConsumer.correlationId = correlationId;
}

public static String getQueueName() {
    return queueName;
}

public static void sendMessage(String threadName) {
    correlationId = UUID.randomUUID().toString();
    try {

        // Start connection
        QueueConnectionFactory cf = new QueueConnectionFactory();
        QueueConnection connection = cf.createQueueConnection();
        QueueSession session = connection.createQueueSession(false, Session.AUTO_ACKNOWLEDGE);
        BasicQueue destination = (BasicQueue) session.createQueue(threadName);
        MessageProducer producer = session.createProducer(destination);
        connection.start();

        // create message to send
        TextMessage message = session.createTextMessage();
        message.setJMSCorrelationID(correlationId);
        message.setText(threadName + "(" + System.currentTimeMillis() 
                + ") " + correlationId +" from Producer");

        System.out.println(correlationId +" Send from Producer");
        producer.send(message);

        // close everything
        producer.close();
        session.close();
        connection.close();

    } catch (JMSException ex) {
        System.out.println("Error = " + ex.getMessage());
    }
}

public static void receivemessage(final String correlationId) {
    try {

        QueueConnectionFactory cf = new QueueConnectionFactory();
        QueueConnection connection = cf.createQueueConnection();
        QueueSession session = connection.createQueueSession(false, Session.AUTO_ACKNOWLEDGE);

        BasicQueue destination = (BasicQueue) session.createQueue(getQueueName());

        connection.start();

        System.out.println("\n");
        System.out.println("Start listen " + getQueueName() + " " + correlationId +" Queue from receivemessage");
        long now = System.currentTimeMillis();

        // receive our message
        String filter = "JMSCorrelationID = '" + correlationId  + "'";
        QueueReceiver receiver = session.createReceiver(destination, filter);
        TextMessage m = (TextMessage) receiver.receive();
        System.out.println("Received message = " + m.getText() + " timestamp=" + m.getJMSTimestamp());

        System.out.println("End listen " + getQueueName() + " " + correlationId +" Queue from receivemessage");

        session.close();
        connection.close();

    } catch (JMSException ex) {
        System.out.println("Error = " + ex.getMessage());
    }
}

public static void main(String args[]) {
    HelloProducerConsumer.sendMessage(getQueueName());
    String correlationId1 = getCorrelationId();
    HelloProducerConsumer.sendMessage(getQueueName());
    String correlationId2 = getCorrelationId();
    HelloProducerConsumer.sendMessage(getQueueName());
    String correlationId3 = getCorrelationId();

    HelloProducerConsumer.receivemessage(correlationId2);

    HelloProducerConsumer.receivemessage(correlationId1);

    HelloProducerConsumer.receivemessage(correlationId3);
}
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-10-21T22:19:07.650

```
String filter = "JMSCorrelationID = '" + msg.getJMSMessageID() + "'";
QueueReceiver receiver = session.createReceiver(queue, filter); 
```

在这里，接收者将获得`JMSCorrelationID`等于的消息`MessageID`。这在请求/响应范例中非常有帮助。

或者您可以直接将其设置为任何值：

```
QueueReceiver receiver = session.createReceiver(queue,  "JMSCorrelationID ='"+id+"'";); 
```

比你可以做的`receiver.receive(2000);`或者`receiver.setMessageListener(this);`

# python - 有没有办法定义模型中的哪些字段在管理应用程序中是可编辑的？

> ID：149040
> 
> 赞同：5
> 
> 时间：2008-09-29T14:55:55.823
> 
> 标签：python, django

假设如下：

*模型.py*

```
class Entry(models.Model):
    title = models.CharField(max_length=50)
    slug = models.CharField(max_length=50, unique=True)
    body = models.CharField(max_length=200) 
```

*管理员.py*

```
class EntryAdmin(admin.ModelAdmin):
    prepopulated_fields = {'slug':('title',)} 
```

我希望通过标题预先填充 slug，但我不希望用户能够从管理员那里编辑它。我认为将 fields=[] 添加到管理对象而不包括 slug 会起作用，但它没有。我还尝试在模型中设置 editable=False ，但这也不起作用（事实上，停止了页面渲染）。

想法？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-29T15:47:49.380

对于这种特殊情况，您可以覆盖您的 save 方法以 slugify（它是内置方法，查看 django 源代码）标题并将其存储在 slug 字段中。同样从那里你可以很容易地检查这个蛞蝓是否确实是独一无二的，如果不是，就以某种方式改变它。

考虑这个例子：

```
def save(self):
    from django.template.defaultfilters import slugify

    if not self.slug:
        self.slug = slugify(self.title)

    super(Your_Model_Name,self).save() 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-29T15:04:04.057

我不确定你要的是什么是可能的。您最好的选择可能是通过指定您的字段集来完全隐藏管理界面中的 slug，而不是覆盖 save 方法以从 tile 复制 slug，并可能对其进行 slugify...

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-29T15:27:55.387

这个[Django Snippet](http://www.djangosnippets.org/snippets/937/)通过定义一个自定义的只读小部件来满足您的需求。因此，您为实际上不允许任何编辑的字段定义了一个自定义编辑器。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-29T19:20:53.813

[此代码段](http://www.djangosnippets.org/snippets/770/)为您提供了一个 AutoSlugField，其中包含您正在寻找的行为，并且将其添加到您的模型中是单行的。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-29T19:36:30.860

除了覆盖`save`以提供您想要的生成值之外，您还可以在您的类中使用[exclude](http://docs.djangoproject.com/en/dev/ref/contrib/admin/#exclude)选项`ModelAdmin`来防止该字段显示在管理员中：

```
class EntryAdmin(admin.ModelAdmin):
    exclude = ('slug',) 
```

# smalltalk - 你会开始学习 Smalltalk 吗？

> ID：149042
> 
> 赞同：84
> 
> 时间：2008-09-29T14:57:25.290
> 
> 标签：smalltalk, seaside

我的问题很简单！

1.  如果你有时间，你会开始学习 Smalltalk 吗？为什么？为什么不？
2.  你已经知道 Smalltalk 了吗？为什么推荐 Smalltalk？为什么不？

就我个人而言，我是一名 Ruby on Rails 程序员，我非常喜欢它。但是，我正在考虑 Smalltalk，因为我阅读了各种博客，并且有些人称 Ruby 为“Smalltalk Light”之类的东西。我对 Smalltalk 感兴趣的第二个原因是[Seaside](http://seaside.st)。

也许有人以前做过同样的转变？

**编辑：**实际上，Smalltalk/Seaside 最让我兴奋的是 WebDevRadio 的以下剧集：[第 52 集：海边的 Randal Schwartz（除其他外）](http://www.webdevradio.com/index.php?id=77)

* * *

## 回答 #1

> 赞同：62
> 
> 时间：2008-09-29T15:51:53.630

如果你喜欢 Ruby，你可能会喜欢 Smalltalk。IIRC Seaside 已移植到[Gemstone VM，](http://seaside.gemstone.com/)这是其 Gemstone/S OODBMS 的一部分。这比 Ruby 有更好的线程支持，因此对于大容量系统来说它是一个更好的后端。这可能是仔细研究它的一个很好的理由。

学习 Smalltalk 的理由：

*   这是一个非常非常好的编程环境。一旦你对它有所了解（对于习惯于 C++ 或 Java 的人来说，这往往是一种文化冲击），你会发现它是一个非常好的工作环境。即使是像我使用的旧 Digitalk 系统使用起来非常愉快。许多老的 XP 和 OO 大师类型，如[Kent Beck](http://en.wikipedia.org/wiki/Kent_Beck)和[Martin Fowler](http://en.wikipedia.org/wiki/Martin_Fowler)当年在 Smalltalk 上崭露头角[，偶尔可以听到在公共场合向往美好的过去](http://www.cincomsmalltalk.com/blog/blogView?showComments=true&entry=3230540451)（感谢 Frank Shearer 的引用，+1）-敏捷开发起源于这个平台。

*   它是历史上最高效的开发平台之一。

*   存在几个成熟的实现，并且有一个惊人的大代码库。曾几何时，它在金融市场领域变得相当流行，开发人员的生产力和上市时间非常重要。直到 1990 年代中期，如果您想要一种适合应用程序开发的商业支持的高级语言，它或多或少是唯一的游戏（LISP 可能除外）。

*   部署很容易 - 只需将图像文件放到适当的目录中。

*   这不是一个真正的原因，但[四本书帮在](https://rads.stackoverflow.com/amzn/click/com/0201633612)他们的很多例子中都使用了 Smalltalk。

不学习 Smalltalk 的原因：

*   这是一个利基市场。你可能很难找到工作。但是，如果您正在生产某种类型的[.com 应用程序并拥有服务器，](http://www.paulgraham.com/avg.html)这可能不是问题。

*   它被许多人视为遗留系统。平台上的新开发相对较少（尽管 Seaside 似乎正在推动复兴）。

*   它往往不能很好地与传统的源代码控制系统配合使用（至少在我使用它时的 90 年代中期）。这可能会或可能不会仍然如此。

*   它有点与世隔绝，喜欢自己玩耍。Python 或 Ruby 是为从头开始集成而构建的，并且往往更加混杂，因此更容易与 3rd 方软件集成。然而，[其他各种更主流](http://www.sun.com/java/)的系统或多或少地受到这种孤立性的影响，这似乎并没有过多地阻碍它们的使用。

* * *

## 回答 #2

> 赞同：47
> 
> 时间：2008-09-29T22:23:01.677

好吧，既然你提到了我的名字，我觉得我应该插话。

正如我在那次播客采访中所说的那样，正如我在我的博客[http://MethodsAndMessages.vox.com/](http://MethodsAndMessages.vox.com/)中反复证明的那样，这是“ *smalltalk 的一年*”。在过去的十个月里进行了 Smalltalk 宣传，我可以看到它确实在发生。越来越多的客户转向 Smalltalk 和 Seaside，Smalltalk 供应商都在努力抓住这一新的关注点。更多更大的 Smalltalk 会议正在计划中。更多招聘信息正在发布。正在发布更多博客文章。

如果您今天转向 Smalltalk，那么您并不孤单。还有很多其他人也在那里。

**编辑**

好吧，几年后，我现在推荐[Dart](http://dartlang.org/)。它是一种由 Google 发明的伟大语言，但现在归 ECMA 委员会所有。它以 node.js 风格运行服务器端，但也通过转换为 JavaScript 在现代浏览器中运行客户端。很多好书、博客、帮助频道、IDE 支持、[公共 live pastebin](https://dartpad.dartlang.org)。我认为它肯定有腿……足以让我编写课件来现场或在线教授它，而且我很确定我的作品中有一两本书。并且 Gilad Bracha，一个古老的 Smalltalker 是设计的主要贡献者，所以 Dart 中有很多 Smalltalk。

* * *

## 回答 #3

> 赞同：31
> 
> 时间：2008-09-29T22:27:49.247

Smalltalk 是一门很好学的语言，最棒的是它只需要一天的时间就可以完成。它不仅仅是一种学术语言。人们正在构建处理数十亿美元的庞大、可扩展、可复制的应用程序。他们只是很少谈论它。例如，参见[GemStone 和 Orient Overseas Container Lines：航运业案例研究](http://seaside.gemstone.com/docs/OOCL_SuccessStory.pdf)。

Seaside 是学习 Smalltalk 的一个很好的理由，但我认为您不会发现它比 Rails 好几个数量级。

让我信服的是宝石。我真的很喜欢 Gemstone 的 GLASS（GemStone、Linux、Apache、Smalltalk、Seaside）。其中最重要的部分是 GemStone，它主要为您处理所有对象持久性，而您无需考虑它。看到他们的一些演示并听到人们使用 GemStone 所做的事情，我重新认识了“大型应用程序”的含义。

Rails 最让我烦恼的部分是对象关系映射。这对 Ruby 没有任何影响，因为它在 GLORP（处理 Smalltalk 的 ActiveRecord）、Perl 或其他任何东西中都一样糟糕。将对象映射到数据库表非常痛苦。有了 GemStone，对数据库的思考就消失了，因此对数据库的工作也消失了。这就像一块巨大的石头（或一群猴子）从我的背上取下来。

* * *

## 回答 #4

> 赞同：16
> 
> 时间：2008-09-29T15:11:43.117

*> 找不到不花钱的 Smalltalk 开发环境*

**谷歌**- 免费的小谈话

Cincom Smalltalk、Squeak、GNU Smalltalk

* * *

## 回答 #5

> 赞同：15
> 
> 时间：2008-09-29T15:15:13.623

学习 Smalltalk 将从发明 OO 的人 (Alan Kay) 的角度为您提供面向对象软件开发的基础。重叠窗口环境的想法来自 Smalltalk。

学习 Smalltalk 的一个绊脚石是它是一个消息传递系统，具有奇怪的流控制语法，例如：

```
i < 60
   ifTrue: [ self walk ] 
```

它有一个非常成熟的类库，具有我没见过太多地方的一致性。所有环境（甚至商业 Smalltalks）中的类库都有可用的源代码，可让您向语言大师学习。在编写 Smalltalk 时，我总是会问这个问题是如何在环境中完成的。

Smalltalk 通常在映像中实现，该映像是系统中所有对象的实时环境。

交互式调试器真正将 Smalltalk 与 Ruby 分开。

Seaside 是 Web 开发框架，并为 Smalltalk 带来了新的焦点。它是一个基于 continuation 的环境，允许内部命中调试和流畅的富客户端类型的开发体验（可以在单一方法中设计顶级应用程序流程）。它与 script.aculo.us 的集成方式使得它可以在 Smalltalk 中轻松调用。

* * *

## 回答 #6

> 赞同：10
> 
> 时间：2008-09-30T13:17:38.267

奈杰尔，我引用的一句话是：

虽然我已经很久没有用它做任何事情了，但我提名 Smalltalk，但我仍然没有遇到过像它能够将思想转化为计算机代码的东西。这不仅仅是语言：它是美妙的浏览器环境、库以及编写清晰、设计良好的代码的文化，就像其他任何东西都可以做出意大利面条一样快。当 JavaOne 的参与者称赞 Java 比其他任何东西都更有效率时，我需要一个牛皮纸袋。哦，好吧，回到整理我的类路径...——Martin Fowler（软件开发杂志，2001 年 1 月）

我在[这里](http://www.cincomsmalltalk.com/blog/blogView?showComments=true&entry=3230540451)找到了。

* * *

## 回答 #7

> 赞同：10
> 
> 时间：2008-10-14T11:41:21.827

不同意那个认为你不会将 Smalltalk 用于大型应用程序的海报——这正是它的亮点。但我也在一周内创建了相当时髦（注意小写）的原型应用程序。

我从 92 年开始在 ST 中学习 OO，非常高兴我这样做了。它给了我一个真正的面向对象的背景。在课堂上思考。没有类型。ST 非常重视消息传递。如果您想知道某事，请向对象发送消息并获得答案。恕我直言，精神和 IDE 真的鼓励你用你的耦合和凝聚力做正确的事情。

在我的 Java 日常工作中，我受困于文件、泛型、IDE 之类的 Eclipse，它们的生产力比任何 ST IDE 都要低几个数量级。我唯一一次提前完成开发时使用的是 ST。事实上，它非常高效，我们得到了如此多的重用，我不得不转移到另一个项目，因为我无事可做！（好吧，也许我可以花时间学习估计......）

下载 squeak，找一本好书玩。唯一的缺点是，如果您的日常演出使用 Java 或 C#，您最终会希望您可以使用 ST。你会早点回家的。

克里斯·布鲁克斯

* * *

## 回答 #8

> 赞同：9
> 
> 时间：2008-12-23T00:53:28.933

我建议大家学习 Lisp (Scheme) 或 Smalltalk。

Smalltalks 有很棒的 IDE，一旦你克服了文化冲击，你就不想错过这些 IDE。是的，免费的不止一种：Squeak、Dolphin、Smalltalk/X 和 Visualworks（非商业）。

不过，Lisp 的数学基础可能更加简洁。

问候

PS：其实我建议两个都学！

* * *

## 回答 #9

> 赞同：8
> 
> 时间：2008-09-29T15:09:13.030

我不知道鲁比..

Smalltalk 是一种**纯**OO 语言。如果您觉得需要真正了解 OO，而不仅仅是最流行的“OO”语言（如 C++、Java 等）的模拟 OO，那么我建议您使用 smalltalk。

在 smalltalk 中，一切都是对象，具有属性、行为和元。在模拟中，您拥有在对象中使用的数据类型。

我会说玩它，你只会受益。

* * *

## 回答 #10

> 赞同：7
> 
> 时间：2009-01-16T12:05:43.187

我完全在你的鞋子里。我正在使用 RoR 并研究 Smalltalk 领域。以下是我认为重要的一些优点和缺点：

**优点：**

*   成熟稳定的环境
*   快速的开发周期
*   让你想得更多，写得更少

**缺点：**

*   需要不同的思维
*   还是不太明白

我是如何了解 Smalltalk 的，这很有趣。在搜索 Lisp 和 Erlang 的东西时，谷歌搜索结果中不断出现的就是这一件事。有一天，我检查了一下，对漂亮的 windows 环境感到惊讶。片刻之后，我找到了 Aida/Web 框架。我被迷住了，并开始使用这个框架通过 Web 开发来学习 Smalltalk。

仍然不完全在那里，但它太有趣了，我简直不能坐以待毙...... :-) 我又玩得很开心了。

* * *

## 回答 #11

> 赞同：5
> 
> 时间：2008-12-07T03:32:19.667

如果我有时间，不会开始学习它。为什么不？因为学习 C# 或 Java 在经济上会更有效率和更有利可图。

另一方面，如果您是业余爱好者，并且想进行考古挖掘，那么我建议您花一些时间通过研究 Alan Kay 来了解 smalltalk 的内容、时间、原因和方式。引人入胜的故事和令人难以置信的人（毕竟，他获得了转动奖）。然后也许玩一点吱吱声来感受这种语言。在此之后，您可能对块、闭包和面向对象的原则有了新的尊重/理解。

我知道并使用 Smalltalk，已经使用了大约 15 年，仍然**在维护**它，并且不会向朋友推荐 Smalltalk。为什么不？拥有并不断获得就业是一件好事。尽管您可以从 Smalltalk 中学到很多东西，但在当今这个时代，您不能轻易地将其转化为有报酬的工作。

此外，您似乎对 Seaside 很兴奋，我会假设 Seaside/GemStone 的合作伙伴关系。我使用 GemStone 已经有一段时间了，两者结合起来非常吸引人。我希望他们能够获得成功所需的市场份额和动力。

* * *

## 回答 #12

> 赞同：5
> 
> 时间：2010-01-22T00:12:13.273

不！如果你真的开始学习它，你可能再也不想用其他东西编程了。

如果您是 lisp 程序员，这可能不是真的。

* * *

## 回答 #13

> 赞同：4
> 
> 时间：2015-11-25T21:24:23.823

当然，学习 Smalltalk！这是 2015 年，Smalltalk 再次崛起，这要归功于[Pharo](http://pharo.org/)。法罗是免费的。Pharo 正在迅速发展成为一个强大的企业工具。在 4.0 版和即将推出的 5.0 版中，它在短短四年内已经成熟了很多！

然后是[Amber](http://amber-lang.net/)，它是用于 Web 的 Smalltalk。它也是免费的并且发展迅速。

尽管[Smalltalk 享有盛誉](https://medium.com/smalltalk-talk/why-aren-t-people-using-smalltalk-80de31b6e3f4)，但这不是你父亲的 Smalltalk。现代 Smalltalk 令人兴奋且充满希望。

确实，Smalltalk 的工作（还）并不多。但是，如果有足够多的人聚集到新的 Smalltalker 浪潮中，那么行业将适应它，我们将看到 Smalltalk 在商业中得到更广泛的采用。问题是，你有远见吗？

* * *

## 回答 #14

> 赞同：3
> 
> 时间：2008-09-29T15:05:32.290

我在第一个研究生大学水平的面向对象编程课程（大约 1988 年）中学习了 Smalltalk。老师认为最好从“纯”面向对象语言开始，然后再转向更流行的语言（我们在学期末做了一点 C++）。

从这个角度来看，最好还是从纯 OO 开始，尽管现在我们有 Java 和 C#，它们都是“近乎纯”的 OO——足够接近，你可以忽略它们的非 OO 特性，并将自己限制在语言的 Pure-OO 子集中。

* * *

## 回答 #15

> 赞同：3
> 
> 时间：2008-09-29T15:27:31.287

我已经做了几年软件工程师了。我听说有人多次提到 Smalltalk，而且 Smalltalk 从 1980 年左右就出现了，但它是一种似乎从未成为软件主流的语言。有点像 Objective C、CLIPS、PL/I 等——你可能听说过，但大多数人从未编程过。

我可能不会花时间学习 Smalltalk，除非我需要做某项工作。几年前，我简要查看了一些 Smalltalk 教程和示例，看起来它在 OO 编程的某些方面具有一些明显的优势（比如消息概念看起来很酷）。但遗憾的是，它不是主流，似乎也没有获得多大的动力。

* * *

## 回答 #16

> 赞同：3
> 
> 时间：2010-08-04T17:24:31.207

如果你想更好地理解极限编程（甚至是 Scrum），我会说**是**的。

为什么没有耐心的 Java 程序员需要学习 Smalltalk：

[http://www.dafydd.net/archive/2010/why-smalltalk-isnt-just-another-language/](http://www.dafydd.net/archive/2010/why-smalltalk-isnt-just-another-language/)

* * *

## 回答 #17

> 赞同：2
> 
> 时间：2009-12-30T07:40:30.203

这个线程对我来说变得非常实际。我正在计划将软件迁移到 Web 应用程序。这是一个基于数据库的软件。我特别在检查替代品 1) Rails 2) Seaside

如果我能获得 Gemstone/S 作为数据库的数据，我也会考虑这一点。所以对我来说，这意味着我必须比以前学习 Smalltalk（更好）。因为这可能是我未来 15 年的工作。您会（并且不应该）长时间使用您不喜欢的软件;-)。我的印象是 Gemstone/S 是“杀手级”应用程序之一。但是对象的持久化仍然是一个非常困难的领域......

* * *

## 回答 #18

> 赞同：2
> 
> 时间：2015-11-28T19:59:42.313

1)**是的！学习一门语言总是好的。如果你要学习一门语言，那就让它成为一种强大的、有影响力的、可以轻松快速地学习的语言。**

Smalltalk 仍然是学习 OO 概念的卓越语言和环境。

它是所有对象，一直向下。这使得工作方式非常一致。

整数是整数类的实例。字符串是字符对象的集合。类是它们定义的类的单例实例对象。

控制结构通过向布尔类的实例发送获取消息来工作。

甚至匿名方法（代码块，又名块）也是对象。

一切都是通过向对象发送消息来完成的。语法可以贴在明信片上。

Smalltalk 中概念及其实现的清晰性意味着您可以开发直接转换为 Java、Ruby 和 C# 的思维方式。我希望 Python 也是如此。

这对于明确概念非常有用，以至于英国的一所主要大学使用 Smalltalk 每年培训 5,000 人进行面向对象计算。

Squeak 5，刚刚发布。它从具有渐进式垃圾收集功能的新 Cog/Spur VM 中获得了显着的性能提升。

Pharo 4 有一个可爱干净的桌面主题。下一个版本，Pharo 5，将很快发布。它将转向使用 Cog/Spur VM，它将在该版本中包含大约 5,000 个类，并且可以通过配置浏览器工具从网络上轻松获得其他类包。

Squeak 5 即使在第一代 Raspberry Pi 上也能表现出色，并且在新的 5 美元 Raspberry Pi 零上快了近 50%。99 美元可以为您购买 Raspberry Pi 2、屏幕和机箱 - 运行成熟、功能齐全的 IDE。

正在对 Smalltalk 中的协调分布式 OO 系统（例如 Naiad 和 Spoon）进行前沿研究。

一些世界上最大的企业数据库都在 Smalltalk 上运行——包括跟踪世界上 60% 的集装箱，以及世界上最大银行的交易系统。

您可以将 Smalltalk 用作一种超级强大的 CoffeeScript，用[Amber Smalltalk](http://amber-lang.net)编写并转译为 JavaScript，在浏览器中运行。

Squeak、Pharo 和 Amber 都是免费、开源、开放许可的语言和环境。

Squeak 和 Pharo 为 MacOS、Windows 和 Linux 提供了一次写入、随处运行的工具。（也可能是 RiscOS）。

Dolphin Smalltalk 以原生 Windows 外观和感觉为目标，让您可以编译已完成工作的封闭 .exe 文件以分发给最终用户。供应商对 Dolphin 的进一步开发已经停止，但它功能齐全，并且像所有 Smalltalks 一样，被设计为可大规模扩展。（我是否提到过，Pharo 现在有 5,000 个类，而 Squeak 有 3,000 个？Pharo 是 Squeak 3.9 的一个分支）

**有安装和启动 Squeak、Amber、Pharo、Cuis 和 Dolphin 的操作指南：** [http://beginningtosmalltalk.blogspot.co.uk/2015/11/how-to-get-smalltalk- up-and-running.html](http://beginningtosmalltalk.blogspot.co.uk/2015/11/how-to-get-smalltalk-up-and-running.html)

Seaside Web 框架在 Squeak 和 Pharo 上运行。这是一个很棒的成熟工具，更传统的 AidaWeb 框架也是如此。

VisualAge、VisualWorks 和 Gemstone 都提供企业级稳健的系统。Gemstone 提供具有事务和持久性的无限可扩展对象数据库。

**2）是的 - 我已经使用它了。**

我通过开放大学学习了它，并立即在 Ruby 中取得了成效（一本 Pickaxe 书的副本和我身边的图书馆参考资料）。它对我使用 Java 和 Xerox Moo-code 帮助很大。

我刚刚回到它编写应用程序来控制管理和分发响应式、大规模多平台移动应用程序。

我希望很快我也将使用 Amber 重写我的 JavaScript 移动应用程序。

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2008-09-29T15:31:50.683

我真的不知道你在找什么。

如果您正在寻找一种不同的语言来编写，我认为这在很大程度上取决于可用的库。我既不了解 Ruby 也不了解 Smalltalk，但似乎编写 Ruby on Rails 类应用程序的最有效方法可能不是 Smalltalk。

如果您想了解 Ruby 背后的想法，这可能是一个非常好的举措。我没有任何量化的东西，但如果我知道的不仅仅是工具，如果我知道它们背后的想法或它们是如何工作的，我总是对使用工具（例如语言系统）感觉更好。

如果你想学习不同类型的面向对象语言，你可能很想学习 Smalltalk（如果它与 Ruby 有很大不同的话），比如 Java 或 C++，也许还有 Common Lisp 对象系统。

如果你只是想学点不一样的东西，Smalltalk 不失为一个不错的选择。我还建议 Common Lisp，其他人无疑会有其他建议（你现在能得到一个好的 Forth 系统吗？）。

* * *

## 回答 #20

> 赞同：-5
> 
> 时间：2008-09-29T15:08:02.347

是的，我对此很感兴趣。已经尝试过一次，但找不到一个不花钱的 Smalltalk 开发环境。

# sql-server - 在 SQL Server Management Studio 中，我可以跨多个数据库搜索资产吗？

> ID：149054
> 
> 赞同：5
> 
> 时间：2008-09-29T15:00:28.870
> 
> 标签：sql-server, ssms

我的日常 IDE 是 Eclipse，它具有出色的开放资源功能（CTRL+SHIFT+R 或 Navigate > Open Resource），允许用户跨多个项目搜索文件/资源​​。

我在 SQL Server Management Studio 中找不到类似的功能，有吗？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2012-07-31T21:33:30.883

我相信这就是你要找的东西： [http ://www.red-gate.com/products/sql-development/sql-search/](http://www.red-gate.com/products/sql-development/sql-search/)

它是完全免费的，而且非常棒。

[![在此处输入图像描述](https://i.stack.imgur.com/3P4zc.png)](https://i.stack.imgur.com/3P4zc.png)
[（来源：[red-gate.com](http://www.red-gate.com/products/sql-development/sql-search/assets/images/fullview.png)）]

![在此处输入图像描述](https://i.stack.imgur.com/S3syT.png)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-07T17:06:19.923

您可以使用信息架构视图在 sql 数据库中搜索对象 [http://msdn.microsoft.com/en-us/library/ms186778.aspx](http://msdn.microsoft.com/en-us/library/ms186778.aspx) 有一个用于表、列、函数、存储过程等。

select * from INFORMATION_SCHEMA.routines where ROUTINE_DEFINITION like '%xp%_'

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-03T11:24:21.730

不，SMS 中没有默认机制可以跨项目进行搜索。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-24T17:28:44.697

您可以像这样使用 sp_MSforeachdb：

```
sp_MSforeachdb 'SELECT * FROM ?.INFORMATION_SCHEMA.routines WHERE ROUTINE_TYPE = ''PROCEDURE''' 
```

以上将选择所有数据库中的所有过程，并以不同的结果集返回它们。使用不同的视图，您还可以选择表、列等。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-29T15:16:17.523

我希望有人比我有更好的答案。过去，我使用 CURSOR 搜索所有数据库并将结果插入临时表。然后我可以从临时表中选择并显示结果。

我没有这个代码了。如果没有人想出更好的答案，我会回来用一些真实的代码编辑它。我认为会有一个DMV。任何人？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2019-08-22T21:27:08.337

我制作了以下 CLR 存储过程来搜索具有显式并行性的数据库中的所有表和所有列。也许它会做你想要的。它不搜索存储的过程或函数，但您可以查找值、列名、表名等，并以 XML 行的形式返回结果。请注意，这不应该在日常使用，但它对于偶尔的审计或取证/DBA 任务很有用，而且它绝对很快......在 2 秒内搜索 AdventureWorks 上的所有表，平板托管在一台普通的台式 PC 上。

[https://pastebin.com/RRTrt8ZN](https://pastebin.com/RRTrt8ZN)

```
/*
    This script creates a CLR stored procedure and its assembly on a database that will let you search for
    keywords separated by a space on all columns of all tables of all types except 'binary', 'varbinary', 'bit',
    'timestamp', 'image', 'sql_variant', and 'hierarchyid'. This was made as a CLR stored proc to take advantage
    of explicit parallelism to make the search a lot faster. Be aware that this will use many cores so only use
    this for occasional DBA work. This has the potential to cause a DDoS type of situation if broad searches with
    many results are hammered into the server, since each request can try to parallelize its search. An optional
    parameter exists to limit parallelism to a set number of cores. You can also set filters on the tables or
    columns to search, including logical operators OR, AND, NOT, and parenthesis (see examples below). Results
    are returned as XML rows.

    To install you need owner rights. Also, because SQL Server doesn't allow secondary CLR threads access to 
    the stored procedure context, we extract the connection string from the first context connection we make.
    This works fine, but only if you are connected with a trusted connection (using a Windows account).

    ------------------------------------------------------------------
    -- CLR access must be enabled on the instance for this to work. --
    ------------------------------------------------------------------
    -- sp_configure 'show advanced options', 1;                     --
    -- GO                                                           --
    -- RECONFIGURE;                                                 --
    -- GO                                                           --
    -- sp_configure 'clr enabled', 1;                               --
    -- GO                                                           --
    -- RECONFIGURE;                                                 --
    -- GO                                                           --
    ------------------------------------------------------------------

    -----------------------------------------------------------------------------------
    -- Database needs to be flagged trustworthy to be able to access CLR assemblies. --
    -----------------------------------------------------------------------------------
    -- ALTER DATABASE [AdventureWorks] SET TRUSTWORTHY ON;                           --
    -----------------------------------------------------------------------------------

    Example usages:
    ---------------
    Using all available processors on the server:
        EXEC [dbo].[SearchAllTables] @valueSearchTerm = 'john michael'

    Limiting the server to 4 concurrent threads:
        EXEC [dbo].[SearchAllTables] @valueSearchTerm = 'john michael', @maxDegreeOfParallelism = 4

    Using logical operators in search terms:
        EXEC [dbo].[SearchAllTables] @valueSearchTerm = '(john or michael) and not jack', @tablesSearchTerm = 'not contact'

    Limiting search to table names and/or column names containing some search terms:
        EXEC [dbo].[SearchAllTables] @valueSearchTerm = 'john michael', @tablesSearchTerm = 'person contact', @columnsSearchTerm = 'address name'

    Limiting search results to the first row of each table where the terms are found:
        EXEC [dbo].[SearchAllTables] @valueSearchTerm = 'john michael', @getOnlyFirstRowPerTable = 1

    Limiting the search to the schema only automatically returns only the first row for each table:
        EXEC [dbo].[SearchAllTables] @tablesSearchTerm = 'person contact'

    Only return the search queries:
        EXEC [dbo].[SearchAllTables] @valueSearchTerm = 'john michael', @tablesSearchTerm = 'person contact', @onlyOutputQueries = 1

    Capturing results into temporary table and sorting:
        CREATE TABLE #temp (Result NVARCHAR(MAX));
        INSERT INTO #temp
            EXEC [dbo].[SearchAllTables] @valueSearchTerm = 'john';
        SELECT * FROM #temp ORDER BY Result ASC;
        DROP TABLE #temp;
*/ 
```

# javascript - How to format numbers as currency strings

> ID：149055
> 
> 赞同：2243
> 
> 时间：2008-09-29T15:00:28.963
> 
> 标签：javascript, formatting, currency

I would like to format a price in JavaScript. I'd like a function which takes a `float` as an argument and returns a `string` formatted like this:

```
"$ 2,500.00" 
```

What's the best way to do this?

* * *

## 回答 #1

> 赞同：2301
> 
> 时间：2013-04-26T10:09:56.210

# [Intl.NumberFormat](https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Global_Objects/NumberFormat)

JavaScript has a number formatter (part of the Internationalization API).

```
// Create our number formatter.
var formatter = new Intl.NumberFormat('en-US', {
  style: 'currency',
  currency: 'USD',

  // These options are needed to round to whole numbers if that's what you want.
  //minimumFractionDigits: 0, // (this suffices for whole numbers, but will print 2500.10 as $2,500.1)
  //maximumFractionDigits: 0, // (causes 2500.99 to be printed as $2,501)
});

formatter.format(2500); /* $2,500.00 */ 
```

Use `undefined` in place of the first argument (`'en-US'` in the example) to use the system locale (the user locale in case the code is running in a browser). [Further explanation of the locale code](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Intl#Locale_identification_and_negotiation).

Here's a [list of the currency codes](https://www.iban.com/currency-codes).

## Intl.NumberFormat vs Number.prototype.toLocaleString

A final note comparing this to the older .`toLocaleString`. They both offer essentially the same functionality. However, toLocaleString in its older incarnations (pre-Intl) [does not actually support locales](http://www.ecma-international.org/ecma-262/5.1/#sec-15.7.4.3): it uses the system locale. So when debugging old browsers, be sure that you're using the correct version ([MDN suggests to check for the existence of `Intl`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number/toLocaleString#Checking_for_support_for_locales_and_options_arguments)). There isn't any need to worry about this at all if you don't care about old browsers or just use the [shim](https://github.com/andyearnshaw/Intl.js).

Also, the performance of both is the same for a *single* item, but if you have a lot of numbers to format, using `Intl.NumberFormat` is ~70 times faster. Therefore, it's usually best to use `Intl.NumberFormat` and instantiate only once per page load. Anyway, here's the equivalent usage of `toLocaleString`:

```
(2500).toLocaleString('en-US', {
  style: 'currency',
  currency: 'USD',
}); /* $2,500.00 */ 
```

### Some notes on browser support and Node.js

*   Browser support is no longer an issue nowadays with 98% support globally, 99% in the US and 99+% in the EU
*   There is a [shim](https://github.com/andyearnshaw/Intl.js) to support it on fossilized browsers (like [Internet Explorer 8](https://en.wikipedia.org/wiki/Internet_Explorer_8)), should you really need to
*   Node.js before v13 only supports `en-US` out of the box. One solution is to install [full-icu](https://github.com/icu-project/full-icu-npm), see [here](https://stackoverflow.com/a/39626602/1000608) for more information
*   Have a look at [CanIUse](https://caniuse.com/#feat=internationalization) for more information

* * *

## 回答 #2

> 赞同：1928
> 
> 时间：2008-09-29T15:12:32.693

## [Number.prototype.toFixed](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number/toFixed)

This solution is compatible with every single major browser:

```
 const profits = 2489.8237;

  profits.toFixed(3) // Returns 2489.824 (rounds up)
  profits.toFixed(2) // Returns 2489.82
  profits.toFixed(7) // Returns 2489.8237000 (pads the decimals) 
```

All you need is to add the currency symbol (e.g. `"$" + profits.toFixed(2)`) and you will have your amount in dollars.

## Custom function

If you require the use of `,` between each digit, you can use this function:

```
function formatMoney(number, decPlaces, decSep, thouSep) {
    decPlaces = isNaN(decPlaces = Math.abs(decPlaces)) ? 2 : decPlaces,
    decSep = typeof decSep === "undefined" ? "." : decSep;
    thouSep = typeof thouSep === "undefined" ? "," : thouSep;
    var sign = number < 0 ? "-" : "";
    var i = String(parseInt(number = Math.abs(Number(number) || 0).toFixed(decPlaces)));
    var j = (j = i.length) > 3 ? j % 3 : 0;

    return sign +
        (j ? i.substr(0, j) + thouSep : "") +
        i.substr(j).replace(/(\decSep{3})(?=\decSep)/g, "$1" + thouSep) +
        (decPlaces ? decSep + Math.abs(number - i).toFixed(decPlaces).slice(2) : "");
}

document.getElementById("b").addEventListener("click", event => {
  document.getElementById("x").innerText = "Result was: " + formatMoney(document.getElementById("d").value);
});
```

```
<label>Insert your amount: <input id="d" type="text" placeholder="Cash amount" /></label>
<br />
<button id="b">Get Output</button>
<p id="x">(press button to get output)</p>
```

Use it like so:

```
(123456789.12345).formatMoney(2, ".", ","); 
```

If you're always going to use '.' and ',', you can leave them off your method call, and the method will default them for you.

```
(123456789.12345).formatMoney(2); 
```

If your culture has the two symbols flipped (i.e., Europeans) and you would like to use the defaults, just paste over the following two lines in the `formatMoney` method:

```
 d = d == undefined ? "," : d,
    t = t == undefined ? "." : t, 
```

## Custom function (ES6)

If you can use modern ECMAScript syntax (i.e., through Babel), you can use this simpler function instead:

```
function formatMoney(amount, decimalCount = 2, decimal = ".", thousands = ",") {
  try {
    decimalCount = Math.abs(decimalCount);
    decimalCount = isNaN(decimalCount) ? 2 : decimalCount;

    const negativeSign = amount < 0 ? "-" : "";

    let i = parseInt(amount = Math.abs(Number(amount) || 0).toFixed(decimalCount)).toString();
    let j = (i.length > 3) ? i.length % 3 : 0;

    return
      negativeSign +
      (j ? i.substr(0, j) + thousands : '') +
      i.substr(j).replace(/(\d{3})(?=\d)/g, "$1" + thousands) +
      (decimalCount ? decimal + Math.abs(amount - i).toFixed(decimalCount).slice(2) : "");
  } catch (e) {
    console.log(e)
  }
};

document.getElementById("b").addEventListener("click", event => {
  document.getElementById("x").innerText = "Result was: " + formatMoney(document.getElementById("d").value);
});
```

```
<label>Insert your amount: <input id="d" type="text" placeholder="Cash amount" /></label>
<br />
<button id="b">Get Output</button>
<p id="x">(press button to get output)</p>
```

* * *

## 回答 #3

> 赞同：1448
> 
> 时间：2013-01-20T19:25:37.683

## Short and fast solution (works everywhere!)

```
(12345.67).toFixed(2).replace(/\d(?=(\d{3})+\.)/g, '$&,');  // 12,345.67 
```

The idea behind this solution is replacing matched sections with first match and comma, i.e. `'$&,'`. The matching is done using [lookahead approach](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Regular_Expressions#special-lookahead). You may read the expression as *"match a number if it is followed by a sequence of three number sets (one or more) and a dot"*.

**TESTS:**

```
1        --> "1.00"
12       --> "12.00"
123      --> "123.00"
1234     --> "1,234.00"
12345    --> "12,345.00"
123456   --> "123,456.00"
1234567  --> "1,234,567.00"
12345.67 --> "12,345.67" 
```

**DEMO:** [http://jsfiddle.net/hAfMM/9571/](http://jsfiddle.net/hAfMM/9571/)

* * *

## Extended short solution

You can also extend the prototype of [`Number`](https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Global_Objects/Number) object to add additional support of any number of decimals `[0 .. n]` and the size of number groups `[0 .. x]`:

```
/**
 * Number.prototype.format(n, x)
 * 
 * @param integer n: length of decimal
 * @param integer x: length of sections
 */
Number.prototype.format = function(n, x) {
    var re = '\\d(?=(\\d{' + (x || 3) + '})+' + (n > 0 ? '\\.' : '$') + ')';
    return this.toFixed(Math.max(0, ~~n)).replace(new RegExp(re, 'g'), '$&,');
};

1234..format();           // "1,234"
12345..format(2);         // "12,345.00"
123456.7.format(3, 2);    // "12,34,56.700"
123456.789.format(2, 4);  // "12,3456.79" 
```

**DEMO / TESTS:** [http://jsfiddle.net/hAfMM/435/](http://jsfiddle.net/hAfMM/435/)

* * *

## Super extended short solution

In this [super extended version](https://stackoverflow.com/questions/149055/how-can-i-format-numbers-as-money-in-javascript/14428340#comment34151293_14428340) you may set different delimiter types:

```
/**
 * Number.prototype.format(n, x, s, c)
 * 
 * @param integer n: length of decimal
 * @param integer x: length of whole part
 * @param mixed   s: sections delimiter
 * @param mixed   c: decimal delimiter
 */
Number.prototype.format = function(n, x, s, c) {
    var re = '\\d(?=(\\d{' + (x || 3) + '})+' + (n > 0 ? '\\D' : '$') + ')',
        num = this.toFixed(Math.max(0, ~~n));

    return (c ? num.replace('.', c) : num).replace(new RegExp(re, 'g'), '$&' + (s || ','));
};

12345678.9.format(2, 3, '.', ',');  // "12.345.678,90"
123456.789.format(4, 4, ' ', ':');  // "12 3456:7890"
12345678.9.format(0, 3, '-');       // "12-345-679" 
```

**DEMO / TESTS:** [http://jsfiddle.net/hAfMM/612/](http://jsfiddle.net/hAfMM/612/)

* * *

## 回答 #4

> 赞同：328
> 
> 时间：2008-09-29T15:14:47.167

Take a look at the JavaScript [Number](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number) object and see if it can help you.

*   `toLocaleString()` will format a number using location specific thousands separator.
*   `toFixed()` will round the number to a specific number of decimal places.

To use these at the same time the value must have its type changed back to a number because they both output a string.

Example:

```
Number((someNumber).toFixed(1)).toLocaleString() 
```

**EDIT**

One can just use toLocaleString directly and its not necessary to recast to a number:

```
someNumber.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2}); 
```

#### Multiple numbers

If you need to frequently format numbers similarly you can create a specific object for reuse. Like for German (Switzerland):

```
const money = new Intl.NumberFormat('de-CH',
  { style:'currency', currency: 'CHF' });
const percent = new Intl.NumberFormat('de-CH',
  { style:'percent', maximumFractionDigits: 1, signDisplay: "always"}); 
```

which than can be used as:

```
money.format(1234.50); // output CHF 1'234.50
percent.format(0.083);  // output +8.3% 
```

Pretty nifty.

* * *

## 回答 #5

> 赞同：170
> 
> 时间：2010-05-19T14:48:54.860

Below is the [Patrick Desjardins (alias Daok)](https://stackoverflow.com/questions/149055/how-can-i-format-numbers-as-money-in-javascript/149099#149099) code with a bit of comments added and some minor changes:

```
/*
decimal_sep: character used as decimal separator, it defaults to '.' when omitted
thousands_sep: char used as thousands separator, it defaults to ',' when omitted
*/
Number.prototype.toMoney = function(decimals, decimal_sep, thousands_sep)
{
   var n = this,
   c = isNaN(decimals) ? 2 : Math.abs(decimals), // If decimal is zero we must take it. It means the user does not want to show any decimal
   d = decimal_sep || '.', // If no decimal separator is passed, we use the dot as default decimal separator (we MUST use a decimal separator)

   /*
   According to [https://stackoverflow.com/questions/411352/how-best-to-determine-if-an-argument-is-not-sent-to-the-javascript-function]
   the fastest way to check for not defined parameter is to use typeof value === 'undefined'
   rather than doing value === undefined.
   */
   t = (typeof thousands_sep === 'undefined') ? ',' : thousands_sep, // If you don't want to use a thousands separator you can pass empty string as thousands_sep value

   sign = (n < 0) ? '-' : '',

   // Extracting the absolute value of the integer part of the number and converting to string
   i = parseInt(n = Math.abs(n).toFixed(c)) + '',

   j = ((j = i.length) > 3) ? j % 3 : 0;
   return sign + (j ? i.substr(0, j) + t : '') + i.substr(j).replace(/(\d{3})(?=\d)/g, "$1" + t) + (c ? d + Math.abs(n - i).toFixed(c).slice(2) : '');
} 
```

And here some tests:

```
// Some tests (do not forget parenthesis when using negative numbers and number with no decimals)
alert(123456789.67392.toMoney() + '\n' + 123456789.67392.toMoney(3) + '\n' + 123456789.67392.toMoney(0) + '\n' + (123456).toMoney() + '\n' + (123456).toMoney(0) + '\n' + 89.67392.toMoney() + '\n' + (89).toMoney());

// Some tests (do not forget parenthesis when using negative numbers and number with no decimals)
alert((-123456789.67392).toMoney() + '\n' + (-123456789.67392).toMoney(-3)); 
```

The minor changes are:

1.  moved a bit the `Math.abs(decimals)` to be done only when is not `NaN`.

2.  `decimal_sep` can not be empty string any more (a some sort of decimal separator is a *must*)

3.  we use `typeof thousands_sep === 'undefined'` as suggested in [How best to determine if an argument is not sent to the JavaScript function](https://stackoverflow.com/questions/411352/how-best-to-determine-if-an-argument-is-not-sent-to-the-javascript-function)

4.  `(+n || 0)` is not needed because `this` is a `Number` object

[JSFiddle](https://jsfiddle.net/9kvrndfu/)

* * *

## 回答 #6

> 赞同：140
> 
> 时间：2014-11-04T21:09:38.167

If amount is a number, say `-123`, then

```
amount.toLocaleString('en-US', { style: 'currency', currency: 'USD' }); 
```

will produce the string `"-$123.00"`.

Here's a complete working [example](http://jsfiddle.net/1h29dguy/).

* * *

## 回答 #7

> 赞同：129
> 
> 时间：2011-09-01T05:46:10.100

[accounting.js](http://openexchangerates.github.io/accounting.js/) is a tiny JavaScript library for number, money and currency formatting.

* * *

## 回答 #8

> 赞同：113
> 
> 时间：2012-02-16T20:42:10.293

Here's the best JavaScript money formatter I've seen:

```
Number.prototype.formatMoney = function(decPlaces, thouSeparator, decSeparator) {
    var n = this,
        decPlaces = isNaN(decPlaces = Math.abs(decPlaces)) ? 2 : decPlaces,
        decSeparator = decSeparator == undefined ? "." : decSeparator,
        thouSeparator = thouSeparator == undefined ? "," : thouSeparator,
        sign = n < 0 ? "-" : "",
        i = parseInt(n = Math.abs(+n || 0).toFixed(decPlaces)) + "",
        j = (j = i.length) > 3 ? j % 3 : 0;
    return sign + (j ? i.substr(0, j) + thouSeparator : "") + i.substr(j).replace(/(\d{3})(?=\d)/g, "$1" + thouSeparator) + (decPlaces ? decSeparator + Math.abs(n - i).toFixed(decPlaces).slice(2) : "");
}; 
```

It was reformatted and borrowed from here: *[How to format numbers as currency strings](https://stackoverflow.com/questions/149055/how-to-format-numbers-as-currency-strings/149099#149099)*

You'll have to supply your own currency designator (you used `$` above).

Call it like this (although note that the arguments default to 2, comma, and period, so you don't need to supply any arguments if that's your preference):

```
var myMoney = 3543.75873;
var formattedMoney = '$' + myMoney.formatMoney(2, ',', '.'); // "$3,543.76" 
```

* * *

## 回答 #9

> 赞同：86
> 
> 时间：2011-03-17T16:28:19.767

Here's another attempt, just for fun:

```
function formatDollar(num) {
    var p = num.toFixed(2).split(".");
    return "$" + p[0].split("").reverse().reduce(function(acc, num, i, orig) {
        return num + (num != "-" && i && !(i % 3) ? "," : "") + acc;
    }, "") + "." + p[1];
} 
```

And some tests:

```
formatDollar(45664544.23423) // "$45,664,544.23"
formatDollar(45) // "$45.00"
formatDollar(123) // "$123.00"
formatDollar(7824) // "$7,824.00"
formatDollar(1) // "$1.00"
formatDollar(-1345) // "$-1,345.00
formatDollar(-3) // "$-3.00" 
```

* * *

## 回答 #10

> 赞同：85
> 
> 时间：2013-09-25T01:42:45.630

**[Works for all current browsers](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number/toLocaleString#Browser_Compatibility)**

Use `toLocaleString` to format a currency in its language-sensitive representation (using [ISO 4217](https://www.currency-iso.org/en/home/tables/table-a1.html) currency codes).

```
(2500).toLocaleString("en-GB", {style: "currency", currency: "GBP", minimumFractionDigits: 2}) 
```

***Example South African Rand code snippets [for avenmore](https://stackoverflow.com/questions/149055/how-to-format-numbers-as-currency-strings/14735423#comment101585127_18994850)***:

```
console.log((2500).toLocaleString("en-ZA", {style: "currency", currency: "ZAR", minimumFractionDigits: 2}))
// -> R 2 500,00
console.log((2500).toLocaleString("en-GB", {style: "currency", currency: "ZAR", minimumFractionDigits: 2}))
// -> ZAR 2,500.00
```

* * *

## 回答 #11

> 赞同：69
> 
> 时间：2012-02-16T20:42:09.653

I think you want:

```
f.nettotal.value = "$" + showValue.toFixed(2); 
```

* * *

## 回答 #12

> 赞同：30
> 
> 时间：2008-09-29T15:22:33.140

Ok, based on what you said, I'm using this:

```
var DecimalSeparator = Number("1.2").toLocaleString().substr(1,1);

var AmountWithCommas = Amount.toLocaleString();
var arParts = String(AmountWithCommas).split(DecimalSeparator);
var intPart = arParts[0];
var decPart = (arParts.length > 1 ? arParts[1] : '');
decPart = (decPart + '00').substr(0,2);

return '£ ' + intPart + DecimalSeparator + decPart; 
```

I'm open to improvement suggestions (I'd prefer not to include [YUI](https://en.wikipedia.org/wiki/Yahoo!_UI_Library) just to do this :-) )

I already know I should be detecting the "." instead of just using it as the decimal separator...

* * *

## 回答 #13

> 赞同：29
> 
> 时间：2012-10-02T21:07:30.157

[Numeral.js](http://numeraljs.com/) - a JavaScript library for easy number formatting by @adamwdraper

```
numeral(23456.789).format('$0,0.00'); // = "$23,456.79" 
```

* * *

## 回答 #14

> 赞同：27
> 
> 时间：2011-07-22T07:47:51.657

I use the library [Globalize](https://github.com/jquery/globalize) (from Microsoft):

It's a great project to localize numbers, currencies and dates and to have them automatically formatted the right way according to the user locale! ...and despite it should be a jQuery extension, it's currently a 100% independent library. I suggest you all to try it out! :)

* * *

## 回答 #15

> 赞同：27
> 
> 时间：2016-10-17T05:25:18.757

The following is concise, easy to understand, and doesn't rely on any overly complicated regular expressions.

```
function moneyFormat(price, sign = '$') {
  const pieces = parseFloat(price).toFixed(2).split('')
  let ii = pieces.length - 3
  while ((ii-=3) > 0) {
    pieces.splice(ii, 0, ',')
  }
  return sign + pieces.join('')
}

console.log(
  moneyFormat(100),
  moneyFormat(1000),
  moneyFormat(10000.00),
  moneyFormat(1000000000000000000)
)
```

Here is a version with more options in the final output to allow formatting different currencies in different locality formats.

```
// higher order function that takes options then a price and will return the formatted price
const makeMoneyFormatter = ({
  sign = '$',
  delimiter = ',',
  decimal = '.',
  append = false,
  precision = 2,
  round = true,
  custom
} = {}) => value => {

  const e = [1, 10, 100, 1000, 10000, 100000, 1000000, 10000000]

  value = round
    ? (Math.round(value * e[precision]) / e[precision])
    : parseFloat(value)

  const pieces = value
    .toFixed(precision)
    .replace('.', decimal)
    .split('')

  let ii = pieces.length - (precision ? precision + 1 : 0)

  while ((ii-=3) > 0) {
    pieces.splice(ii, 0, delimiter)
  }

  if (typeof custom === 'function') {
    return custom({
      sign,
      float: value,
      value: pieces.join('')
    })
  }

  return append
    ? pieces.join('') + sign
    : sign + pieces.join('')
}

// create currency converters with the correct formatting options
const formatDollar = makeMoneyFormatter()
const formatPound = makeMoneyFormatter({
  sign: '£',
  precision: 0
})
const formatEuro = makeMoneyFormatter({
  sign: '€',
  delimiter: '.',
  decimal: ',',
  append: true
})

const customFormat = makeMoneyFormatter({
  round: false,
  custom: ({ value, float, sign }) => `SALE:$${value}USD`
})

console.log(
  formatPound(1000),
  formatDollar(10000.0066),
  formatEuro(100000.001),
  customFormat(999999.555)
)
```

* * *

## 回答 #16

> 赞同：26
> 
> 时间：2011-07-16T05:09:18.193

[javascript-number-formatter](https://github.com/Mottie/javascript-number-formatter) (formerly [at Google Code](https://code.google.com/archive/p/javascript-number-formatter/))

*   Short, fast, flexible yet stand-alone.
*   Accept standard number formatting like `#,##0.00` or with negation `-000.####`.
*   Accept any country format like `# ##0,00`, `#,###.##`, `#'###.##` or any type of non-numbering symbol.
*   Accept any numbers of digit grouping. `#,##,#0.000` or `#,###0.##` are all valid.
*   Accept any redundant/foolproof formatting. `##,###,##.#` or `0#,#00#.###0#` are all OK.
*   Auto number rounding.
*   Simple interface, just supply mask & value like this: `format( "0.0000", 3.141592)`.
*   Include a prefix & suffix with the mask

(excerpt from its README)

* * *

## 回答 #17

> 赞同：25
> 
> 时间：2012-01-04T11:47:09.560

A shorter method (for inserting space, comma or point) with a regular expression:

```
 Number.prototype.toCurrencyString = function(){
        return this.toFixed(2).replace(/(\d)(?=(\d{3})+\b)/g, '$1 ');
    }

    n = 12345678.9;
    alert(n.toCurrencyString()); 
```

* * *

## 回答 #18

> 赞同：24
> 
> 时间：2012-06-30T01:45:48.080

+1 to [Jonathan M for providing the original method](https://stackoverflow.com/questions/149055/how-to-format-numbers-as-currency-strings/9318724#9318724). Since this is explicitly a currency formatter, I went ahead and added the currency symbol (defaults to '$') to the output, and added a default comma as the thousands separator. If you don't actually want a currency symbol (or thousands separator), just use "" (empty string) as your argument for it.

```
Number.prototype.formatMoney = function(decPlaces, thouSeparator, decSeparator, currencySymbol) {
    // check the args and supply defaults:
    decPlaces = isNaN(decPlaces = Math.abs(decPlaces)) ? 2 : decPlaces;
    decSeparator = decSeparator == undefined ? "." : decSeparator;
    thouSeparator = thouSeparator == undefined ? "," : thouSeparator;
    currencySymbol = currencySymbol == undefined ? "$" : currencySymbol;

    var n = this,
        sign = n < 0 ? "-" : "",
        i = parseInt(n = Math.abs(+n || 0).toFixed(decPlaces)) + "",
        j = (j = i.length) > 3 ? j % 3 : 0;

    return sign + currencySymbol + (j ? i.substr(0, j) + thouSeparator : "") + i.substr(j).replace(/(\d{3})(?=\d)/g, "$1" + thouSeparator) + (decPlaces ? decSeparator + Math.abs(n - i).toFixed(decPlaces).slice(2) : "");
}; 
```

* * *

## 回答 #19

> 赞同：23
> 
> 时间：2008-09-29T15:06:49.417

The main part is inserting the thousand-separators, and that could be done like this:

```
<script type="text/javascript">
  function ins1000Sep(val) {
    val = val.split(".");
    val[0] = val[0].split("").reverse().join("");
    val[0] = val[0].replace(/(\d{3})/g, "$1,");
    val[0] = val[0].split("").reverse().join("");
    val[0] = val[0].indexOf(",") == 0 ? val[0].substring(1) : val[0];
    return val.join(".");
  }

  function rem1000Sep(val) {
    return val.replace(/,/g, "");
  }

  function formatNum(val) {
    val = Math.round(val*100)/100;
    val = ("" + val).indexOf(".") > -1 ? val + "00" : val + ".00";
    var dec = val.indexOf(".");
    return dec == val.length-3 || dec == 0 ? val : val.substring(0, dec+3);
  }
</script>

<button onclick="alert(ins1000Sep(formatNum(12313231)));"> 
```

* * *

## 回答 #20

> 赞同：22
> 
> 时间：2009-08-24T15:30:43.180

There is a JavaScript port of the PHP function "number_format".

I find it very useful as it is easy to use and recognisable for PHP developers.

```
function number_format (number, decimals, dec_point, thousands_sep) {
    var n = number, prec = decimals;

    var toFixedFix = function (n,prec) {
        var k = Math.pow(10,prec);
        return (Math.round(n*k)/k).toString();
    };

    n = !isFinite(+n) ? 0 : +n;
    prec = !isFinite(+prec) ? 0 : Math.abs(prec);
    var sep = (typeof thousands_sep === 'undefined') ? ',' : thousands_sep;
    var dec = (typeof dec_point === 'undefined') ? '.' : dec_point;

    var s = (prec > 0) ? toFixedFix(n, prec) : toFixedFix(Math.round(n), prec);
    // Fix for Internet Explorer parseFloat(0.55).toFixed(0) = 0;

    var abs = toFixedFix(Math.abs(n), prec);
    var _, i;

    if (abs >= 1000) {
        _ = abs.split(/\D/);
        i = _[0].length % 3 || 3;

        _[0] = s.slice(0,i + (n < 0)) +
               _[0].slice(i).replace(/(\d{3})/g, sep+'$1');
        s = _.join(dec);
    } else {
        s = s.replace('.', dec);
    }

    var decPos = s.indexOf(dec);
    if (prec >= 1 && decPos !== -1 && (s.length-decPos-1) < prec) {
        s += new Array(prec-(s.length-decPos-1)).join(0)+'0';
    }
    else if (prec >= 1 && decPos === -1) {
        s += dec+new Array(prec).join(0)+'0';
    }
    return s;
} 
```

(Comment block from [the original](http://kevin.vanzonneveld.net/techblog/article/javascript_equivalent_for_phps_number_format/), included below for examples & credit where due)

```
// Formats a number with grouped thousands
//
// version: 906.1806
// discuss at: http://phpjs.org/functions/number_format
// +   original by: Jonas Raoni Soares Silva (http://www.jsfromhell.com)
// +   improved by: Kevin van Zonneveld (http://kevin.vanzonneveld.net)
// +     bugfix by: Michael White (http://getsprink.com)
// +     bugfix by: Benjamin Lupton
// +     bugfix by: Allan Jensen (http://www.winternet.no)
// +    revised by: Jonas Raoni Soares Silva (http://www.jsfromhell.com)
// +     bugfix by: Howard Yeend
// +    revised by: Luke Smith (http://lucassmith.name)
// +     bugfix by: Diogo Resende
// +     bugfix by: Rival
// +     input by: Kheang Hok Chin (http://www.distantia.ca/)
// +     improved by: davook
// +     improved by: Brett Zamir (http://brett-zamir.me)
// +     input by: Jay Klehr
// +     improved by: Brett Zamir (http://brett-zamir.me)
// +     input by: Amir Habibi (http://www.residence-mixte.com/)
// +     bugfix by: Brett Zamir (http://brett-zamir.me)
// *     example 1: number_format(1234.56);
// *     returns 1: '1,235'
// *     example 2: number_format(1234.56, 2, ',', ' ');
// *     returns 2: '1 234,56'
// *     example 3: number_format(1234.5678, 2, '.', '');
// *     returns 3: '1234.57'
// *     example 4: number_format(67, 2, ',', '.');
// *     returns 4: '67,00'
// *     example 5: number_format(1000);
// *     returns 5: '1,000'
// *     example 6: number_format(67.311, 2);
// *     returns 6: '67.31'
// *     example 7: number_format(1000.55, 1);
// *     returns 7: '1,000.6'
// *     example 8: number_format(67000, 5, ',', '.');
// *     returns 8: '67.000,00000'
// *     example 9: number_format(0.9, 0);
// *     returns 9: '1'
// *     example 10: number_format('1.20', 2);
// *     returns 10: '1.20'
// *     example 11: number_format('1.20', 4);
// *     returns 11: '1.2000'
// *     example 12: number_format('1.2000', 3);
// *     returns 12: '1.200' 
```

* * *

## 回答 #21

> 赞同：20
> 
> 时间：2012-04-16T04:00:55.590

[Patrick Desjardins](https://stackoverflow.com/a/149099/155987)' answer looks good, but I prefer my JavaScript code simple. Here's a function I just wrote to take a number in and return it in currency format (minus the dollar sign):

```
// Format numbers to two decimals with commas
function formatDollar(num) {
    var p = num.toFixed(2).split(".");
    var chars = p[0].split("").reverse();
    var newstr = '';
    var count = 0;
    for (x in chars) {
        count++;
        if(count%3 == 1 && count != 1) {
            newstr = chars[x] + ',' + newstr;
        } else {
            newstr = chars[x] + newstr;
        }
    }
    return newstr + "." + p[1];
} 
```

* * *

## 回答 #22

> 赞同：19
> 
> 时间：2012-02-17T12:09:46.617

There is a built-in function, [toFixed](http://www.w3schools.com/jsref/jsref_tofixed.asp), in JavaScript:

```
var num = new Number(349);
document.write("$" + num.toFixed(2)); 
```

* * *

## 回答 #23

> 赞同：17
> 
> 时间：2020-03-26T23:27:27.000

**Please try the below code**

```
"250000".replace(/(\d)(?=(\d{3})+(?!\d))/g, '$1,'); 
```

**Ans**: 250,000

[![Enter image description here](https://i.stack.imgur.com/nkmZ3.png)](https://i.stack.imgur.com/nkmZ3.png)

* * *

## 回答 #24

> 赞同：16
> 
> 时间：2008-09-29T15:16:57.207

```
function CurrencyFormatted(amount)
{
    var i = parseFloat(amount);
    if(isNaN(i)) { i = 0.00; }
    var minus = '';
    if(i < 0) { minus = '-'; }
    i = Math.abs(i);
    i = parseInt((i + .005) * 100);
    i = i / 100;
    s = new String(i);
    if(s.indexOf('.') < 0) { s += '.00'; }
    if(s.indexOf('.') == (s.length - 2)) { s += '0'; }
    s = minus + s;
    return s;
} 
```

From [WillMaster](http://www.willmaster.com/library/tutorials/currency-formatting-and-putting-commas-in-numbers-with-javascript-and-perl.php).

* * *

## 回答 #25

> 赞同：15
> 
> 时间：2012-10-02T21:15:27.087

I suggest the NumberFormat class from [Google Visualization API](https://developers.google.com/chart/interactive/docs/reference#numberformatter).

You can do something like this:

```
var formatter = new google.visualization.NumberFormat({
    prefix: '$',
    pattern: '#,###,###.##'
});

formatter.formatValue(1000000); // $ 1,000,000 
```

* * *

## 回答 #26

> 赞同：15
> 
> 时间：2021-07-26T21:35:42.260

### just use the native javascript Inlt

you just use the options to format its value

```
const number = 1233445.5678
console.log(new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' }).format(number));
```

[mozilla documentation link](https://developer.mozilla.org/pt-BR/docs/Web/JavaScript/Reference/Global_Objects/Intl/NumberFormat)

* * *

## 回答 #27

> 赞同：14
> 
> 时间：2010-07-19T19:26:07.880

As usually, there are multiple ways of doing the same thing, but I would avoid using `Number.prototype.toLocaleString` since it can return different values based on the user settings.

I also don't recommend extending the `Number.prototype` - extending native objects prototypes is a bad practice since it can cause conflicts with other people code (e.g. libraries/frameworks/plugins) and may not be compatible with future JavaScript implementations/versions.

I believe that regular expressions are the best approach for the problem, here is my implementation:

```
/**
 * Converts number into currency format
 * @param {number} number    Number that should be converted.
 * @param {string} [decimalSeparator]    Decimal separator, defaults to '.'.
 * @param {string} [thousandsSeparator]    Thousands separator, defaults to ','.
 * @param {int} [nDecimalDigits]    Number of decimal digits, defaults to `2`.
 * @return {string} Formatted string (e.g. numberToCurrency(12345.67) returns '12,345.67')
 */
function numberToCurrency(number, decimalSeparator, thousandsSeparator, nDecimalDigits){
    //default values
    decimalSeparator = decimalSeparator || '.';
    thousandsSeparator = thousandsSeparator || ',';
    nDecimalDigits = nDecimalDigits == null? 2 : nDecimalDigits;

    var fixed = number.toFixed(nDecimalDigits), //limit/add decimal digits
        parts = new RegExp('^(-?\\d{1,3})((?:\\d{3})+)(\\.(\\d{'+ nDecimalDigits +'}))?$').exec( fixed ); //separate begin [$1], middle [$2] and decimal digits [$4]

    if(parts){ //number >= 1000 || number <= -1000
        return parts[1] + parts[2].replace(/\d{3}/g, thousandsSeparator + '$&') + (parts[4] ? decimalSeparator + parts[4] : '');
    }else{
        return fixed.replace('.', decimalSeparator);
    }
} 
```

* * *

## 回答 #28

> 赞同：14
> 
> 时间：2013-02-06T17:42:14.607

This might be a little late, but here's a method I just worked up for a coworker to add a locale-aware `.toCurrencyString()` function to all numbers. The internalization is for number grouping only, *not* the currency sign - if you're outputting dollars, use `"$"` as supplied, because `$123 4567` in Japan or China is the same number of USD as `$1,234,567` is in the US. If you're outputting euro, etc., then change the currency sign from `"$"`.

Declare this anywhere in your HTML <head> section or wherever necessary, just before you need to use it:

```
 Number.prototype.toCurrencyString = function(prefix, suffix) {
    if (typeof prefix === 'undefined') { prefix = '$'; }
    if (typeof suffix === 'undefined') { suffix = ''; }
    var _localeBug = new RegExp((1).toLocaleString().replace(/^1/, '').replace(/\./, '\\.') + "$");
    return prefix + (~~this).toLocaleString().replace(_localeBug, '') + (this % 1).toFixed(2).toLocaleString().replace(/^[+-]?0+/,'') + suffix;
  } 
```

Then you're done! Use `(number).toCurrencyString()` anywhere you need to output the number as currency.

```
var MyNumber = 123456789.125;
alert(MyNumber.toCurrencyString()); // alerts "$123,456,789.13"
MyNumber = -123.567;
alert(MyNumber.toCurrencyString()); // alerts "$-123.57" 
```

* * *

## 回答 #29

> 赞同：12
> 
> 时间：2019-01-20T08:59:41.470

```
Number(value)
        .toFixed(2)
        .replace(/(\d)(?=(\d{3})+(?!\d))/g, "$1,")
```

* * *

## 回答 #30

> 赞同：11
> 
> 时间：2014-05-17T23:39:18.243

Here are some solutions and all pass the test suite. The test suite and benchmark are included. If you want copy and paste to test, try [this gist](https://gist.github.com/steelywing/85fdcbe084c332596179).

### Method 0 (RegExp)

It is based on [VisioN's answer](https://stackoverflow.com/questions/149055/how-to-format-numbers-as-currency-strings/14428340#14428340), but it fixes if there isn't a decimal point.

```
if (typeof Number.prototype.format === 'undefined') {
    Number.prototype.format = function (precision) {
        if (!isFinite(this)) {
            return this.toString();
        }

        var a = this.toFixed(precision).split('.');
        a[0] = a[0].replace(/\d(?=(\d{3})+$)/g, '$&,');
        return a.join('.');
    }
} 
```

### Method 1

```
if (typeof Number.prototype.format === 'undefined') {
    Number.prototype.format = function (precision) {
        if (!isFinite(this)) {
            return this.toString();
        }

        var a = this.toFixed(precision).split('.'),
            // Skip the '-' sign
            head = Number(this < 0);

        // Skip the digits that's before the first thousands separator
        head += (a[0].length - head) % 3 || 3;

        a[0] = a[0].slice(0, head) + a[0].slice(head).replace(/\d{3}/g, ',$&');
        return a.join('.');
    };
} 
```

### Method 2 (Split to Array)

```
if (typeof Number.prototype.format === 'undefined') {
    Number.prototype.format = function (precision) {
        if (!isFinite(this)) {
            return this.toString();
        }

        var a = this.toFixed(precision).split('.');

        a[0] = a[0]
            .split('').reverse().join('')
            .replace(/\d{3}(?=\d)/g, '$&,')
            .split('').reverse().join('');

        return a.join('.');
    };
} 
```

### Method 3 (Loop)

```
if (typeof Number.prototype.format === 'undefined') {
    Number.prototype.format = function (precision) {
        if (!isFinite(this)) {
            return this.toString();
        }

        var a = this.toFixed(precision).split('');
        a.push('.');

        var i = a.indexOf('.') - 3;
        while (i > 0 && a[i-1] !== '-') {
            a.splice(i, 0, ',');
            i -= 3;
        }

        a.pop();
        return a.join('');
    };
} 
```

### Usage Example

```
console.log('======== Demo ========')
console.log(
    (1234567).format(0),
    (1234.56).format(2),
    (-1234.56).format(0)
);
var n = 0;
for (var i=1; i<20; i++) {
    n = (n * 10) + (i % 10)/100;
    console.log(n.format(2), (-n).format(2));
} 
```

### Separator

If we want custom a thousands separator or decimal separator, use `replace()`:

```
123456.78.format(2).replace(',', ' ').replace('.', ' '); 
```

### Test suite

```
function assertEqual(a, b) {
    if (a !== b) {
        throw a + ' !== ' + b;
    }
}

function test(format_function) {
    console.log(format_function);
    assertEqual('NaN', format_function.call(NaN, 0))
    assertEqual('Infinity', format_function.call(Infinity, 0))
    assertEqual('-Infinity', format_function.call(-Infinity, 0))

    assertEqual('0', format_function.call(0, 0))
    assertEqual('0.00', format_function.call(0, 2))
    assertEqual('1', format_function.call(1, 0))
    assertEqual('-1', format_function.call(-1, 0))

    // Decimal padding
    assertEqual('1.00', format_function.call(1, 2))
    assertEqual('-1.00', format_function.call(-1, 2))

    // Decimal rounding
    assertEqual('0.12', format_function.call(0.123456, 2))
    assertEqual('0.1235', format_function.call(0.123456, 4))
    assertEqual('-0.12', format_function.call(-0.123456, 2))
    assertEqual('-0.1235', format_function.call(-0.123456, 4))

    // Thousands separator
    assertEqual('1,234', format_function.call(1234.123456, 0))
    assertEqual('12,345', format_function.call(12345.123456, 0))
    assertEqual('123,456', format_function.call(123456.123456, 0))
    assertEqual('1,234,567', format_function.call(1234567.123456, 0))
    assertEqual('12,345,678', format_function.call(12345678.123456, 0))
    assertEqual('123,456,789', format_function.call(123456789.123456, 0))
    assertEqual('-1,234', format_function.call(-1234.123456, 0))
    assertEqual('-12,345', format_function.call(-12345.123456, 0))
    assertEqual('-123,456', format_function.call(-123456.123456, 0))
    assertEqual('-1,234,567', format_function.call(-1234567.123456, 0))
    assertEqual('-12,345,678', format_function.call(-12345678.123456, 0))
    assertEqual('-123,456,789', format_function.call(-123456789.123456, 0))

    // Thousands separator and decimal
    assertEqual('1,234.12', format_function.call(1234.123456, 2))
    assertEqual('12,345.12', format_function.call(12345.123456, 2))
    assertEqual('123,456.12', format_function.call(123456.123456, 2))
    assertEqual('1,234,567.12', format_function.call(1234567.123456, 2))
    assertEqual('12,345,678.12', format_function.call(12345678.123456, 2))
    assertEqual('123,456,789.12', format_function.call(123456789.123456, 2))
    assertEqual('-1,234.12', format_function.call(-1234.123456, 2))
    assertEqual('-12,345.12', format_function.call(-12345.123456, 2))
    assertEqual('-123,456.12', format_function.call(-123456.123456, 2))
    assertEqual('-1,234,567.12', format_function.call(-1234567.123456, 2))
    assertEqual('-12,345,678.12', format_function.call(-12345678.123456, 2))
    assertEqual('-123,456,789.12', format_function.call(-123456789.123456, 2))
}

console.log('======== Testing ========');
test(Number.prototype.format);
test(Number.prototype.format1);
test(Number.prototype.format2);
test(Number.prototype.format3); 
```

### Benchmark

```
function benchmark(f) {
    var start = new Date().getTime();
    f();
    return new Date().getTime() - start;
}

function benchmark_format(f) {
    console.log(f);
    time = benchmark(function () {
        for (var i = 0; i < 100000; i++) {
            f.call(123456789, 0);
            f.call(123456789, 2);
        }
    });
    console.log(time.format(0) + 'ms');
}

// If not using async, the browser will stop responding while running.
// This will create a new thread to benchmark
async = [];
function next() {
    setTimeout(function () {
        f = async.shift();
        f && f();
        next();
    }, 10);
}

console.log('======== Benchmark ========');
async.push(function () { benchmark_format(Number.prototype.format); });
next(); 
```

* * *

## 回答 #31

> 赞同：11
> 
> 时间：2016-06-04T06:09:10.547

I found this from: [accounting.js](http://openexchangerates.github.io/accounting.js/). It's very easy and perfectly fits my need.

```
// Default usage:
accounting.formatMoney(12345678); // $12,345,678.00

// European formatting (custom symbol and separators), can also use options object as second parameter:
accounting.formatMoney(4999.99, "€", 2, ".", ","); // €4.999,99

// Negative values can be formatted nicely:
accounting.formatMoney(-500000, "£ ", 0); // £ -500,000

// Simple `format` string allows control of symbol position (%v = value, %s = symbol):
accounting.formatMoney(5318008, { symbol: "GBP",  format: "%v %s" }); // 5,318,008.00 GBP

// Euro currency symbol to the right
accounting.formatMoney(5318008, {symbol: "€", precision: 2, thousand: ".", decimal : ",", format: "%v%s"}); // 1.008,00€ 
```

* * *

## 回答 #32

> 赞同：10
> 
> 时间：2011-12-02T23:25:10.153

A simple option for proper comma placement by reversing the string first and basic regexp.

```
String.prototype.reverse = function() {
    return this.split('').reverse().join('');
};

Number.prototype.toCurrency = function( round_decimal /*boolean*/ ) {       
     // format decimal or round to nearest integer
     var n = this.toFixed( round_decimal ? 0 : 2 );

     // convert to a string, add commas every 3 digits from left to right 
     // by reversing string
     return (n + '').reverse().replace( /(\d{3})(?=\d)/g, '$1,' ).reverse();
}; 
```

* * *

## 回答 #33

> 赞同：9
> 
> 时间：2008-09-29T15:17:49.500

The [YUI](https://en.wikipedia.org/wiki/Yahoo!_UI_Library) codebase uses the following formatting:

```
format: function(nData, oConfig) {
    oConfig = oConfig || {};

    if(!YAHOO.lang.isNumber(nData)) {
        nData *= 1;
    }

    if(YAHOO.lang.isNumber(nData)) {
        var sOutput = nData + "";
        var sDecimalSeparator = (oConfig.decimalSeparator) ? oConfig.decimalSeparator : ".";
        var nDotIndex;

        // Manage decimals
        if(YAHOO.lang.isNumber(oConfig.decimalPlaces)) {
            // Round to the correct decimal place
            var nDecimalPlaces = oConfig.decimalPlaces;
            var nDecimal = Math.pow(10, nDecimalPlaces);
            sOutput = Math.round(nData*nDecimal)/nDecimal + "";
            nDotIndex = sOutput.lastIndexOf(".");

            if(nDecimalPlaces > 0) {
                // Add the decimal separator
                if(nDotIndex < 0) {
                    sOutput += sDecimalSeparator;
                    nDotIndex = sOutput.length-1;
                }
                // Replace the "."
                else if(sDecimalSeparator !== "."){
                    sOutput = sOutput.replace(".",sDecimalSeparator);
                }
                // Add missing zeros
                while((sOutput.length - 1 - nDotIndex) < nDecimalPlaces) {
                    sOutput += "0";
                }
            }
        }

        // Add the thousands separator
        if(oConfig.thousandsSeparator) {
            var sThousandsSeparator = oConfig.thousandsSeparator;
            nDotIndex = sOutput.lastIndexOf(sDecimalSeparator);
            nDotIndex = (nDotIndex > -1) ? nDotIndex : sOutput.length;
            var sNewOutput = sOutput.substring(nDotIndex);
            var nCount = -1;
            for (var i=nDotIndex; i>0; i--) {
                nCount++;
                if ((nCount%3 === 0) && (i !== nDotIndex)) {
                    sNewOutput = sThousandsSeparator + sNewOutput;
                }
                sNewOutput = sOutput.charAt(i-1) + sNewOutput;
            }
            sOutput = sNewOutput;
        }

        // Prepend prefix
        sOutput = (oConfig.prefix) ? oConfig.prefix + sOutput : sOutput;

        // Append suffix
        sOutput = (oConfig.suffix) ? sOutput + oConfig.suffix : sOutput;

        return sOutput;
    }
    // Still not a number. Just return it unaltered
    else {
        return nData;
    }
} 
```

It would need editing as the YUI library is configurable, like replacing oConfig.decimalSeparator with ".".

* * *

## 回答 #34

> 赞同：9
> 
> 时间：2011-04-15T19:03:57.517

Patrick Desjardins (ex Daok)'s example worked well for me. I ported it over to CoffeeScript if anyone is interested.

```
Number.prototype.toMoney = (decimals = 2, decimal_separator = ".", thousands_separator = ",") ->
    n = this
    c = if isNaN(decimals) then 2 else Math.abs decimals
    sign = if n < 0 then "-" else ""
    i = parseInt(n = Math.abs(n).toFixed(c)) + ''
    j = if (j = i.length) > 3 then j % 3 else 0
    x = if j then i.substr(0, j) + thousands_separator else ''
    y = i.substr(j).replace(/(\d{3})(?=\d)/g, "$1" + thousands_separator)
    z = if c then decimal_separator + Math.abs(n - i).toFixed(c).slice(2) else ''
    sign + x + y + z 
```

* * *

## 回答 #35

> 赞同：8
> 
> 时间：2008-09-29T16:02:44.757

A minimalistic approach that just meets the original requirements:

```
function formatMoney(n) {
    return "$ " + (Math.round(n * 100) / 100).toLocaleString();
} 
```

[@Daniel Magliola](https://stackoverflow.com/questions/149055/how-to-format-numbers-as-currency-strings#comment43766_149371): You're right. The above was a hasty, incomplete implementation. Here's the corrected implementation:

```
function formatMoney(n) {
    return "$ " + n.toLocaleString().split(".")[0] + "."
        + n.toFixed(2).split(".")[1];
} 
```

* * *

## 回答 #36

> 赞同：7
> 
> 时间：2015-05-04T15:09:29.710

[tggagne is correct](https://stackoverflow.com/questions/149055/how-to-format-numbers-as-currency-strings?page=3&tab=oldest#comment52088405_30033551). My solution below is not good due to float rounding. And the toLocaleString function lacks some browser support. I'll leave the below comments for archival purposes of what *not* to do. :)

*[Date.prototype.toLocaleString()](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date/toLocaleString#Browser_Compatibility)*

**(Old Solution) Use [Patrick Desjardins' solution](https://stackoverflow.com/questions/149055/how-to-format-numbers-as-currency-strings/149099#149099) instead.**

*This is a terse solution that uses toLocaleString(), which has been supported since JavaScript version 1.0\. This example designates the currency to U.S. Dollars, but could be switched to pounds by using 'GBP' instead of 'USD'.*

```
var formatMoney = function (value) {
    // Convert the value to a floating point number in case it arrives as a string.
    var numeric = parseFloat(value);
    // Specify the local currency.
    return numeric.toLocaleString('USD', { style: 'currency', currency: "USD", minimumFractionDigits: 2, maximumFractionDigits: 2 });
} 
```

*See* ***[Internationalization and localization, Currencies](https://marcoscaceres.github.io/jsi18n/#localize_currency)*** *for additional details.*

* * *

## 回答 #37

> 赞同：6
> 
> 时间：2014-05-19T22:08:34.627

A function to handle currency output, including negatives.

Sample Output:
$5.23
-$5.23

```
function formatCurrency(total) {
    var neg = false;
    if(total < 0) {
        neg = true;
        total = Math.abs(total);
    }
    return (neg ? "-$" : '$') + parseFloat(total, 10).toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g, "$1,").toString();
} 
```

* * *

## 回答 #38

> 赞同：6
> 
> 时间：2015-10-22T17:08:58.373

Another way:

```
function centsToDollaString(x){
  var cents = x + ""
  while(cents.length < 4){
    cents = "0" + cents;
  }
  var dollars = cents.substr(0,cents.length - 2)
  var decimal = cents.substr(cents.length - 2, 2)
  while(dollars.length % 3 != 0){
    dollars = "0" + dollars;
  }
  str = dollars.replace(/(\d{3})(?=\d)/g, "$1" + ",").replace(/^0*(?=.)/, "");
  return "$" + str + "." + decimal;
} 
```

* * *

## 回答 #39

> 赞同：5
> 
> 时间：2013-01-15T14:07:36.930

[http://code.google.com/p/javascript-number-formatter/](http://code.google.com/p/javascript-number-formatter/):

*   Short, fast, flexible yet stand-alone. Only 75 lines including MIT license info, blank lines & comments.
*   Accept standard number formatting like #,##0.00 or with negation -000.####.
*   Accept any country format like # ##0,00, #,###.##, #'###.## or any type of non-numbering symbol.
*   Accept any numbers of digit grouping. #,##,#0.000 or #,###0.## are all valid.
*   Accept any redundant/fool-proof formatting. ##,###,##.# or 0#,#00#.###0# are all OK.
*   Auto number rounding.
*   Simple interface, just supply mask & value like this: format( "0.0000", 3.141592)

**UPDATE** This is my home-grown `pp` utilities for most common tasks:

```
var NumUtil = {};

/**
  Petty print 'num' wth exactly 'signif' digits.
  pp(123.45, 2) == "120"
  pp(0.012343, 3) == "0.0123"
  pp(1.2, 3) == "1.20"
*/
NumUtil.pp = function(num, signif) {
    if (typeof(num) !== "number")
        throw 'NumUtil.pp: num is not a number!';
    if (isNaN(num))
        throw 'NumUtil.pp: num is NaN!';
    if (num < 1e-15 || num > 1e15)
        return num;
    var r = Math.log(num)/Math.LN10;
    var dot = Math.floor(r) - (signif-1);
    r = r - Math.floor(r) + (signif-1);
    r = Math.round(Math.exp(r * Math.LN10)).toString();
    if (dot >= 0) {
        for (; dot > 0; dot -= 1)
            r += "0";
        return r;
    } else if (-dot >= r.length) {
        var p = "0.";
        for (; -dot > r.length; dot += 1) {
            p += "0";
        }
        return p+r;
    } else {
        return r.substring(0, r.length + dot) + "." + r.substring(r.length + dot);
    }
}

/** Append leading zeros up to 2 digits. */
NumUtil.align2 = function(v) {
    if (v < 10)
        return "0"+v;
    return ""+v;
}
/** Append leading zeros up to 3 digits. */
NumUtil.align3 = function(v) {
    if (v < 10)
        return "00"+v;
    else if (v < 100)
        return "0"+v;
    return ""+v;
}

NumUtil.integer = {};

/** Round to integer and group by 3 digits. */
NumUtil.integer.pp = function(num) {
    if (typeof(num) !== "number") {
        console.log("%s", new Error().stack);
        throw 'NumUtil.integer.pp: num is not a number!';
    }
    if (isNaN(num))
        throw 'NumUtil.integer.pp: num is NaN!';
    if (num > 1e15)
        return num;
    if (num < 0)
        throw 'Negative num!';
    num = Math.round(num);
    var group = num % 1000;
    var integ = Math.floor(num / 1000);
    if (integ === 0) {
        return group;
    }
    num = NumUtil.align3(group);
    while (true) {
        group = integ % 1000;
        integ = Math.floor(integ / 1000);
        if (integ === 0)
            return group + " " + num;
        num = NumUtil.align3(group) + " " + num;
    }
    return num;
}

NumUtil.currency = {};

/** Round to coins and group by 3 digits. */
NumUtil.currency.pp = function(amount) {
    if (typeof(amount) !== "number")
        throw 'NumUtil.currency.pp: amount is not a number!';
    if (isNaN(amount))
        throw 'NumUtil.currency.pp: amount is NaN!';
    if (amount > 1e15)
        return amount;
    if (amount < 0)
        throw 'Negative amount!';
    if (amount < 1e-2)
        return 0;
    var v = Math.round(amount*100);
    var integ = Math.floor(v / 100);
    var frac = NumUtil.align2(v % 100);
    var group = integ % 1000;
    integ = Math.floor(integ / 1000);
    if (integ === 0) {
        return group + "." + frac;
    }
    amount = NumUtil.align3(group);
    while (true) {
        group = integ % 1000;
        integ = Math.floor(integ / 1000);
        if (integ === 0)
            return group + " " + amount + "." + frac;
        amount = NumUtil.align3(group) + " " + amount;
    }
    return amount;
} 
```

* * *

## 回答 #40

> 赞同：5
> 
> 时间：2014-09-10T01:19:56.420

[Intl.NumberFormat](https://developer.mozilla.org/es/docs/Web/JavaScript/Reference/Global_Objects/NumberFormat)

```
var number = 3500;
alert(new Intl.NumberFormat().format(number));
// → "3,500" if in US English locale 
```

Or *[PHP's number_format in JavaScript](http://phpjs.org/functions/number_format/)*.

* * *

## 回答 #41

> 赞同：5
> 
> 时间：2019-09-19T09:35:23.073

We can also use [**numeraljs**](http://numeraljs.com/)

> Numbers can be formatted to look like currency, percentages, times, or even plain old numbers with decimal places, thousands, and abbreviations. And you can always create a custom format.

```
var string = numeral(1000).format('0,0');
// '1,000' 
```

* * *

## 回答 #42

> 赞同：4
> 
> 时间：2013-08-15T03:22:51.337

This answer meets the following criteria:

*   Does not depend on an external dependency.
*   Does support localization.
*   Does have tests/proofs.
*   Does use simple and best coding practices (no complicated regex's and uses standard coding patterns).

This code is built on concepts from other answers. Its execution speed should be among the better posted here if that's a concern.

```
var decimalCharacter = Number("1.1").toLocaleString().substr(1,1);
var defaultCurrencyMarker = "$";
function formatCurrency(number, currencyMarker) {
    if (typeof number != "number")
        number = parseFloat(number, 10);

    // if NaN is passed in or comes from the parseFloat, set it to 0.
    if (isNaN(number))
        number = 0;

    var sign = number < 0 ? "-" : "";
    number = Math.abs(number);    // so our signage goes before the $ symbol.

    var integral = Math.floor(number);
    var formattedIntegral = integral.toLocaleString();

    // IE returns "##.00" while others return "##"
    formattedIntegral = formattedIntegral.split(decimalCharacter)[0];

    var decimal = Math.round((number - integral) * 100);
    return sign + (currencyMarker || defaultCurrencyMarker) +
        formattedIntegral  +
        decimalCharacter +
        decimal.toString() + (decimal < 10 ? "0" : "");
} 
```

These tests only work on a US locale machine. This decision was made for simplicity and because this could cause of crappy input (bad auto-localization) allowing for crappy output issues.

```
var tests = [
    // [ input, expected result ]
    [123123, "$123,123.00"],    // no decimal
    [123123.123, "$123,123.12"],    // decimal rounded down
    [123123.126, "$123,123.13"],    // decimal rounded up
    [123123.4, "$123,123.40"],    // single decimal
    ["123123", "$123,123.00"],    // repeat subset of the above using string input.
    ["123123.123", "$123,123.12"],
    ["123123.126", "$123,123.13"],
    [-123, "-$123.00"]    // negatives
];

for (var testIndex=0; testIndex < tests.length; testIndex++) {
    var test = tests[testIndex];
    var formatted = formatCurrency(test[0]);
    if (formatted == test[1]) {
        console.log("Test passed, \"" + test[0] + "\" resulted in \"" + formatted + "\"");
    } else {
        console.error("Test failed. Expected \"" + test[1] + "\", got \"" + formatted + "\"");
    }
} 
```

* * *

## 回答 #43

> 赞同：4
> 
> 时间：2014-01-21T10:18:07.740

Here is the short and best one to convert numbers into a currency format:

```
function toCurrency(amount){
    return amount.replace(/(\d)(?=(\d\d\d)+(?!\d))/g, "$1,");
}

// usage: toCurrency(3939920.3030); 
```

* * *

## 回答 #44

> 赞同：4
> 
> 时间：2014-06-26T10:26:55.647

The code [from Jonathan M](https://stackoverflow.com/questions/149055/how-to-format-numbers-as-currency-strings/9318724#9318724) looked too complicated for me, so I rewrote it and got about 30% on Firefox v30 and 60% on Chrome v35 speed boost ([http://jsperf.com/number-formating2](http://jsperf.com/number-formating2)):

```
Number.prototype.formatNumber = function(decPlaces, thouSeparator, decSeparator) {
    decPlaces = isNaN(decPlaces = Math.abs(decPlaces)) ? 2 : decPlaces;
    decSeparator = decSeparator == undefined ? "." : decSeparator;
    thouSeparator = thouSeparator == undefined ? "," : thouSeparator;

    var n = this.toFixed(decPlaces);
    if (decPlaces) {
        var i = n.substr(0, n.length - (decPlaces + 1));
        var j = decSeparator + n.substr(-decPlaces);
    } else {
        i = n;
        j = '';
    }

    function reverse(str) {
        var sr = '';
        for (var l = str.length - 1; l >= 0; l--) {
            sr += str.charAt(l);
        }
        return sr;
    }

    if (parseInt(i)) {
        i = reverse(reverse(i).replace(/(\d{3})(?=\d)/g, "$1" + thouSeparator));
    }
    return i + j;
}; 
```

Usage:

```
var sum = 123456789.5698;
var formatted = '$' + sum.formatNumber(2, ',', '.'); // "$123,456,789.57" 
```

* * *

## 回答 #45

> 赞同：4
> 
> 时间：2014-10-22T11:21:08.627

[https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/NumberFormat](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/NumberFormat) Example: Using locales

This example shows some of the variations in localized number formats. In order to get the format of the language used in the user interface of your application, make sure to specify that language (and possibly some fallback languages) using the locales argument:

> var number = 123456.789;
> 
> // German uses comma as decimal separator and period for thousands console.log(new Intl.NumberFormat('de-DE').format(number)); // → 123.456,789
> 
> // Arabic in most Arabic speaking countries uses real Arabic digits console.log(new Intl.NumberFormat('ar-EG').format(number)); // → ١٢٣٤٥٦٫٧٨٩
> 
> // India uses thousands/lakh/crore separators console.log(new Intl.NumberFormat('en-IN').format(number));

* * *

## 回答 #46

> 赞同：4
> 
> 时间：2016-09-30T02:34:45.423

* * *

## 回答 #47

> 赞同：3
> 
> 时间：2011-05-11T19:22:26.790

This might work:

```
function format_currency(v, number_of_decimals, decimal_separator, currency_sign){
  return (isNaN(v)? v : currency_sign + parseInt(v||0).toLocaleString() + decimal_separator + (v*1).toFixed(number_of_decimals).slice(-number_of_decimals));
} 
```

No loops, no regexes, no arrays, no exotic conditionals.

* * *

## 回答 #48

> 赞同：3
> 
> 时间：2011-11-29T15:14:56.363

A quicker way with regexp:

```
Number.prototype.toMonetaryString = function() {
  var n = this.toFixed(2), m;
  //var = this.toFixed(2).replace(/\./, ','); For comma separator
  // with a space for thousands separator
  while ((m = n.replace(/(\d)(\d\d\d)\b/g, '$1 $2')) != n)
      n = m;
  return m;
}

String.prototype.fromMonetaryToNumber = function(s) {
  return this.replace(/[^\d-]+/g, '')/100;
} 
```

* * *

## 回答 #49

> 赞同：3
> 
> 时间：2012-02-16T20:40:59.920

There is no equivalent of "formatNumber" in JavaScript. You can write it yourself or find a library that already does this.

* * *

## 回答 #50

> 赞同：3
> 
> 时间：2013-01-29T05:21:56.043

Here is a mootools 1.2 implementation from the code provided by XMLilley...

```
Number.implement('format', function(decPlaces, thouSeparator, decSeparator){
decPlaces = isNaN(decPlaces = Math.abs(decPlaces)) ? 2 : decPlaces;
decSeparator = decSeparator === undefined ? '.' : decSeparator;
thouSeparator = thouSeparator === undefined ? ',' : thouSeparator;

var num = this,
    sign = num < 0 ? '-' : '',
    i = parseInt(num = Math.abs(+num || 0).toFixed(decPlaces)) + '',
    j = (j = i.length) > 3 ? j % 3 : 0;

return sign + (j ? i.substr(0, j) + thouSeparator : '') + i.substr(j).replace(/(\d{3})(?=\d)/g, '$1' + thouSeparator) + (decPlaces ? decSeparator + Math.abs(num - i).toFixed(decPlaces).slice(2) : '');
}); 
```

* * *

## 回答 #51

> 赞同：3
> 
> 时间：2013-03-21T03:11:21.410

I based this heavily on [the answer from VisioN](https://stackoverflow.com/questions/149055/how-to-format-numbers-as-currency-strings/14428340#14428340):

```
function format (val) {
  val = (+val).toLocaleString();
  val = (+val).toFixed(2);
  val += "";
  return val.replace(/(\d)(?=(\d{3})+(?:\.\d+)?$)/g, "$1" + format.thousands);
}

(function (isUS) {
  format.decimal =   isUS ? "." : ",";
  format.thousands = isUS ? "," : ".";
}(("" + (+(0.00).toLocaleString()).toFixed(2)).indexOf(".") > 0)); 
```

I tested with inputs:

```
[   ""
  , "1"
  , "12"
  , "123"
  , "1234"
  , "12345"
  , "123456"
  , "1234567"
  , "12345678"
  , "123456789"
  , "1234567890"
  , ".12"
  , "1.12"
  , "12.12"
  , "123.12"
  , "1234.12"
  , "12345.12"
  , "123456.12"
  , "1234567.12"
  , "12345678.12"
  , "123456789.12"
  , "1234567890.12"
  , "1234567890.123"
  , "1234567890.125"
].forEach(function (item) {
  console.log(format(item));
}); 
```

And got these results:

```
0.00
1.00
12.00
123.00
1,234.00
12,345.00
123,456.00
1,234,567.00
12,345,678.00
123,456,789.00
1,234,567,890.00
0.12
1.12
12.12
123.12
1,234.12
12,345.12
123,456.12
1,234,567.12
12,345,678.12
123,456,789.12
1,234,567,890.12
1,234,567,890.12
1,234,567,890.13 
```

Just for fun.

* * *

## 回答 #52

> 赞同：3
> 
> 时间：2015-01-29T13:07:36.243

I like the shortest [answer by VisionN](https://stackoverflow.com/questions/149055/how-to-format-numbers-as-currency-strings/14428340#14428340) except when I need to modify it for a number without a decimal point ($123 instead of $123.00). It does not work, so instead of quick copy/paste I need to decipher the arcane syntax of the JavaScript regular expression.

Here is the original solution

```
n.toFixed(2).replace(/\d(?=(\d{3})+\.)/g, '$&,'); 
```

I'll make it a bit longer:

```
var re = /\d(?=(\d{3})+\.)/g;
var subst = '$&,';
n.toFixed(2).replace(re, subst); 
```

The `re` part here (search part in string replace) means

1.  Find all digits (`\d`)
2.  Followed by (`?=` ...) (lookahead)
3.  One or more groups `(`...`)+`
4.  Of exactly three digits (`\d{3}`)
5.  Ending with a dot (`\.`)
6.  Do it for all occurrences (`g`)

The `subst` part here means:

1.  Every time there is a match, replace it with itself (`$&`), followed by a comma.

As we use `string.replace`, all other text in the string remains the same and only found digits (those that are followed by 3, 6, 9, etc. other digits) get an additional comma.

So in a number, 1234567.89, digits **1** and **4** meet the condition (**1**23**4**567.89) and are replaced with "**1,**" and "**4,**" resulting in 1,234,567.89.

If we don't need the decimal point in dollar amount at all (i.e., $123 instead of $123.00), we may change the regular expression like this:

```
var re2 = /\d(?=(\d{3})+$)/g; 
```

It relies on the end of line (`$`) instead of a dot (`\.`) and the final expression will be (notice also `toFixed(0)`):

```
n.toFixed(0).replace(/\d(?=(\d{3})+$)/g, '$&,'); 
```

This expression will give

```
1234567.89 -> 1,234,567 
```

Also instead of end of line (`$`) in the regular expression above, you may opt for a word boundary as well (`\b`).

*My apology in advance if I misinterpreted any part of the regular expression handling.*

* * *

## 回答 #53

> 赞同：3
> 
> 时间：2015-02-20T23:40:03.383

Many of the answers had helpful ideas, but none of them could fit my needs. So I used all the ideas and build this example:

```
function Format_Numb(fmt){
    var decimals = isNaN(decimals) ? 2 : Math.abs(decimals);
    if(typeof decSgn === "undefined") decSgn = ".";
    if(typeof kommaSgn === "undefined") kommaSgn= ",";

    var s3digits = /(\d{1,3}(?=(\d{3})+(?=[.]|$))|(?:[.]\d*))/g;
    var dflt_nk = "00000000".substring(0, decimals);

    //--------------------------------
    // handler for pattern: "%m"
    var _f_money = function(v_in){
                       var v = v_in.toFixed(decimals);
                       var add_nk = ",00";
                       var arr = v.split(".");
                       return arr[0].toString().replace(s3digits, function ($0) {
                           return ($0.charAt(0) == ".")
                                   ? ((add_nk = ""), (kommaSgn + $0.substring(1)))
                                   : ($0 + decSgn);
                           })
                           + ((decimals > 0)
                                 ? (kommaSgn
                                       + (
                                           (arr.length > 1)
                                           ? arr[1]
                                           : dflt_nk
                                       )
                                   )
                                 : ""
                           );
                   }

    // handler for pattern: "%<len>[.<prec>]f"
    var _f_flt = function(v_in, l, prec){
        var v = (typeof prec !== "undefined") ? v_in.toFixed(prec) : v_in;
        return ((typeof l !== "undefined") && ((l=l-v.length) > 0))
                ? (Array(l+1).join(" ") + v)
                : v;
    }

    // handler for pattern: "%<len>x"
    var _f_hex = function(v_in, l, flUpper){
        var v = Math.round(v_in).toString(16);
        if(flUpper) v = v.toUpperCase();
        return ((typeof l !== "undefined") && ((l=l-v.length) > 0))
                ? (Array(l+1).join("0") + v)
                : v;
    }

    //...can be extended..., just add the function, for example:    var _f_octal = function( v_in,...){
    //--------------------------------

    if(typeof(fmt) !== "undefined"){
        //...can be extended..., just add the char, for example "O":    MFX -> MFXO
        var rpatt = /(?:%([^%"MFX]*)([MFX]))|(?:"([^"]*)")|("|%%)/gi;
        var _qu = "\"";
        var _mask_qu = "\\\"";
        var str = fmt.toString().replace(rpatt, function($0, $1, $2, $3, $4){
                      var f;
                      if(typeof $1 !== "undefined"){
                          switch($2.toUpperCase()){
                              case "M": f = "_f_money(v)";    break;

                              case "F": var n_dig0, n_dig1;
                                        var re_flt =/^(?:(\d))*(?:[.](\d))*$/;
                                        $1.replace(re_flt, function($0, $1, $2){
                                            n_dig0 = $1;
                                            n_dig1 = $2;
                                        });
                                        f = "_f_flt(v, " + n_dig0 + "," + n_dig1 + ")";    break;

                              case "X": var n_dig = "undefined";
                                        var re_flt = /^(\d*)$/;
                                        $1.replace(re_flt, function($0){
                                            if($0 != "") n_dig = $0;
                                        });
                                        f = "_f_hex(v, " + n_dig + "," + ($2=="X") + ")";    break;
                              //...can be extended..., for example:    case "O":
                          }
                          return "\"+"+f+"+\"";
                      } else if(typeof $3 !== "undefined"){
                          return _mask_qu + $3 + _mask_qu;
                      } else {
                          return ($4 == _qu) ? _mask_qu : $4.charAt(0);
                      }
                  });

        var cmd =     "return function(v){"
                +     "if(typeof v === \"undefined\")return \"\";"  // null returned as empty string
                +     "if(!v.toFixed) return v.toString();"         // not numb returned as string
                +     "return \"" + str + "\";"
                + "}";

        //...can be extended..., just add the function name in the 2 places:
        return new Function("_f_money,_f_flt,_f_hex", cmd)(_f_money,_f_flt,_f_hex);
    }
} 
```

First, I needed a **C-style** format-string-definition that should be **flexible, but very easy to use** and I defined it in following way; patterns:

```
%[<len>][.<prec>]f   float, example "%f", "%8.2d", "%.3f"
%m                   money
%[<len>]x            hexadecimal lower case, example "%x", "%8x"
%[<len>]X            hexadecimal upper case, example "%X", "%8X" 
```

Because there isn't any need to format others than to euro for me, I implemented only "%m".

But it's easy to extend this... Like in C, the format string is a string containing the patterns. For example, **for euro**: **"%m €&quot;** (returns strings like "8.129,33 €&quot;)

Besides the flexibility, I needed a **very fast solution for processing tables**. That means that, when processing thousands of cells, the processing of format string **must not be done more than once**. A call like "format( value, fmt)" is not acceptable for me, but this must be split into two steps:

```
// var formatter = Format_Numb( "%m €&quot;);
// simple example for Euro...

//   but we use a complex example:

var formatter = Format_Numb("a%%%3mxx \"zz\"%8.2f°\"  >0x%8X<");

// formatter is now a function, which can be used more than once (this is an example, that can be tested:)

var v1 = formatter(1897654.8198344);

var v2 = formatter(4.2);

... (and thousands of rows) 
```

Also for performance, _f_money encloses the regular expression;

Third, a call like "format( value, fmt)" is not acceptable because:

Although it should be possible to format different collections of objects (for example, cells of a column) with different masks, I don't want to have something to handle format strings at the point of processing. At this point I only want *to use* formatting, like in

> for( var cell in cells){ do_something( cell.col.formatter( cell.value)); }

What format - maybe it's defined in an .ini file, in an XML for each column or somewhere else ..., but **analyzing and setting formats** or dealing with internationalizaton **is processed in totally another place**, and there I want to assign the formatter to the collection without thinking about performance issues:

> col.formatter = Format_Numb( _getFormatForColumn(...) );

Fourth, I wanted an **"tolerant" solution**, so passing, for example, a string instead of a number should return simply the string, but "null" should return en empty string.

(Also formatting "%4.2f" must not cut something if the value is too big.)

And last, but not least - it should be **readable and easy extendable**, *without* having any effects in performance... For example, if somebody needs "octal values", please refer to lines with "...can be extended..." - I think that should be a very easy task.

My overall focus lay on performance. Each "processing routine" (for example, `_f_money`) can be encapsulated optimized or exchanged with other ideas in this or other threads without change of the "prepare routines" (analyze format strings and creation of the functions), which must only be processed once and in that sense are not so performance critical like the conversion calls of thousands of numbers.

For all, who prefer methods of numbers:

```
Number.prototype.format_euro = (function(formatter){
    return function(){ return formatter(this); }})
(Format_Numb( "%m €&quot;));

var v_euro = (8192.3282).format_euro(); // results: 8.192,33 €

Number.prototype.format_hex = (function(formatter){
    return function(){ return formatter(this); }})
(Format_Numb( "%4x"));

var v_hex = (4.3282).format_hex(); 
```

Although I tested some, there may be a lot of bugs in the code. So it's not a ready module, but just an idea and a starting point for non-JavaScript experts like me.

The code contains many and little modified ideas from a lot of Stack Overflow posts; sorry I can't reference all of them, but thanks to all the experts.

* * *

## 回答 #54

> 赞同：3
> 
> 时间：2016-11-10T18:32:34.290

I had a hard time finding a simple library to work with date and currency, so I created my own: [https://github.com/dericeira/slimFormatter.js](https://github.com/dericeira/slimFormatter.js)

Simple as that:

```
var number = slimFormatter.currency(2000.54); 
```

* * *

## 回答 #55

> 赞同：3
> 
> 时间：2018-04-06T08:37:10.610

Because every problem deserves a one-line solution:

```
Number.prototype.formatCurrency = function() { return this.toFixed(2).toString().split(/[-.]/).reverse().reduceRight(function (t, c, i) { return (i == 2) ? '-' + t : (i == 1) ? t + c.replace(/(\d)(?=(\d{3})+$)/g, '$1,') : t + '.' + c; }, '$'); } 
```

This is easy enough to change for different locales. Just change the '$1,' to '$1.' and '.' to ',' to swap `,` and `.` in numbers. The currency symbol can be changed by changing the '$' at the end.

Or, if you have [ES6](https://en.wikipedia.org/wiki/ECMAScript#6th_Edition_%E2%80%93_ECMAScript_2015), you can just declare the function with default values:

```
Number.prototype.formatCurrency = function(thou = ',', dec = '.', sym = '$') { return this.toFixed(2).toString().split(/[-.]/).reverse().reduceRight(function (t, c, i) { return (i == 2) ? '-' + t : (i == 1) ? t + c.replace(/(\d)(?=(\d{3})+$)/g, '$1' + thou) : t + dec + c; }, sym); }

console.log((4215.57).formatCurrency())
$4,215.57
console.log((4216635.57).formatCurrency('.', ','))
$4.216.635,57
console.log((4216635.57).formatCurrency('.', ',', "\u20AC"))
€4.216.635,57 
```

Oh and it works for negative numbers too:

```
console.log((-6635.574).formatCurrency('.', ',', "\u20AC"))
-€6.635,57
console.log((-1066.507).formatCurrency())
-$1,066.51 
```

And of course you don't have to have a currency symbol:

```
console.log((1234.586).formatCurrency(',','.',''))
1,234.59
console.log((-7890123.456).formatCurrency(',','.',''))
-7,890,123.46
console.log((1237890.456).formatCurrency('.',',',''))
1.237.890,46 
```

* * *

## 回答 #56

> 赞同：2
> 
> 时间：2010-05-27T09:38:29.470

```
function getMoney(A){
    var a = new Number(A);
    var b = a.toFixed(2); // Get 12345678.90
    a = parseInt(a); // Get 12345678
    b = (b-a).toPrecision(2); // Get 0.90
    b = parseFloat(b).toFixed(2); // In case we get 0.0, we pad it out to 0.00
    a = a.toLocaleString(); // Put in commas - Internet Explorer also puts in .00, so we'll get 12,345,678.00
    // If Internet Explorer (our number ends in .00)
    if(a < 1 && a.lastIndexOf('.00') == (a.length - 3))
    {
        a = a.substr(0, a.length-3); // Delete the .00
    }
    return a + b.substr(1); // Remove the 0 from b, then return a + b = 12,345,678.90
}
alert(getMoney(12345678.9)); 
```

This works in Firefox and Internet Explorer.

* * *

## 回答 #57

> 赞同：2
> 
> 时间：2012-06-29T15:17:36.293

```
String.prototype.toPrice = function () {
    var v;
    if (/^\d+(,\d+)$/.test(this))
        v = this.replace(/,/, '.');
    else if (/^\d+((,\d{3})*(\.\d+)?)?$/.test(this))
        v = this.replace(/,/g, "");
    else if (/^\d+((.\d{3})*(,\d+)?)?$/.test(this))
        v = this.replace(/\./g, "").replace(/,/, ".");
    var x = parseFloat(v).toFixed(2).toString().split("."),
    x1 = x[0],
    x2 = ((x.length == 2) ? "." + x[1] : ".00"),
    exp = /^([0-9]+)(\d{3})/;
    while (exp.test(x1))
        x1 = x1.replace(exp, "$1" + "," + "$2");
    return x1 + x2;
}

alert("123123".toPrice()); //123,123.00
alert("123123,316".toPrice()); //123,123.32
alert("12,312,313.33213".toPrice()); //12,312,313.33
alert("123.312.321,32132".toPrice()); //123,312,321.32 
```

* * *

## 回答 #58

> 赞同：2
> 
> 时间：2012-07-04T20:25:55.643

CoffeeScript for [Patrick's popular answer](https://stackoverflow.com/questions/149055/how-to-format-numbers-as-currency-strings/149099#149099):

```
Number::formatMoney = (decimalPlaces, decimalChar, thousandsChar) ->
  n = this
  c = decimalPlaces
  d = decimalChar
  t = thousandsChar
  c = (if isNaN(c = Math.abs(c)) then 2 else c)
  d = (if d is undefined then "." else d)
  t = (if t is undefined then "," else t)
  s = (if n < 0 then "-" else "")
  i = parseInt(n = Math.abs(+n or 0).toFixed(c)) + ""
  j = (if (j = i.length) > 3 then j % 3 else 0)
  s + (if j then i.substr(0, j) + t else "") + i.substr(j).replace(/(\d{3})(?=\d)/g, "$1" + t) + (if c then d + Math.abs(n - i).toFixed(c).slice(2) else "") 
```

* * *

## 回答 #59

> 赞同：2
> 
> 时间：2015-04-06T13:03:46.940

There are already good answers. Here's a simple attempt for fun:

```
function currencyFormat(no) {
  var ar = (+no).toFixed(2).split('.');
  return [
      numberFormat(ar[0] | 0),
      '.',
      ar[1]
  ].join('');
}

function numberFormat(no) {
  var str = no + '';
  var ar = [];
  var i  = str.length -1;

  while(i >= 0) {
    ar.push((str[i-2] || '') + (str[i-1] || '') + (str[i] || ''));
    i = i-3;
  }
  return ar.reverse().join(',');
} 
```

Then run some examples:

```
console.log(
  currencyFormat(1),
  currencyFormat(1200),
  currencyFormat(123),
  currencyFormat(9870000),
  currencyFormat(12345),
  currencyFormat(123456.232)
) 
```

* * *

## 回答 #60

> 赞同：2
> 
> 时间：2016-01-08T21:53:27.837

I want to contribute with this:

```
function toMoney(amount) {
    neg = amount.charAt(0);
    amount = amount.replace(/\D/g, '');
    amount = amount.replace(/\./g, '');
    amount = amount.replace(/\-/g, '');

    var numAmount = new Number(amount);
    amount = numAmount.toFixed(0).replace(/./g, function(c, i, a) {
        return i > 0 && c !== "," && (a.length - i) % 3 === 0 ? "." + c : c;
    });

    if(neg == '-')
        return neg + amount;
    else
        return amount;
} 
```

This allows you to convert numbers in a text box where you are only supposed to put numbers (consider this scenario).

**This is going to clean a textbox where there are only supposed to be numbers, even if you paste a string with numbers and letters or any character**

```
<html>
<head>
    <script language=="Javascript">
        function isNumber(evt) {
            var theEvent = evt || window.event;
            var key = theEvent.keyCode || theEvent.which;
            key = String.fromCharCode(key);
            if (key.length == 0)
                return;
            var regex = /^[0-9\-\b]+$/;
            if (!regex.test(key)) {
                theEvent.returnValue = false;
                if (theEvent.preventDefault)
                    theEvent.preventDefault();
            }
        }

        function toMoney(amount) {
            neg = amount.charAt(0);
            amount = amount.replace(/\D/g, '');
            amount = amount.replace(/\./g, '');
            amount = amount.replace(/\-/g, '');

            var numAmount = new Number(amount);
            amount = numAmount.toFixed(0).replace(/./g, function(c, i, a) {
                return i > 0 && c !== "," && (a.length - i) % 3 === 0 ? "." + c : c;
            });

            if(neg == '-')
                return neg + amount;
            else
                return amount;
        }

        function clearText(inTxt, newTxt, outTxt) {
            inTxt = inTxt.trim();
            newTxt = newTxt.trim();
            if(inTxt == '' || inTxt == newTxt)
                return outTxt;

            return inTxt;
        }

        function fillText(inTxt, outTxt) {
            inTxt = inTxt.trim();
            if(inTxt != '')
                outTxt = inTxt;

            return outTxt;
        }
    </script>
</head>

<body>
    $ <input name=reca2 id=reca2 type=text value="0" onFocus="this.value = clearText(this.value, '0', '');" onblur="this.value = fillText(this.value, '0'); this.value = toMoney(this.value);" onKeyPress="isNumber(event);" style="width:80px;" />
</body>

</html> 
```

* * *

## 回答 #61

> 赞同：2
> 
> 时间：2016-11-22T22:45:58.927

Here's a straightforward formatter in vanilla JavaScript:

```
function numberFormatter (num) {
    console.log(num)
    var wholeAndDecimal = String(num.toFixed(2)).split(".");
    console.log(wholeAndDecimal)
    var reversedWholeNumber = Array.from(wholeAndDecimal[0]).reverse();
    var formattedOutput = [];

    reversedWholeNumber.forEach( (digit, index) => {
        formattedOutput.push(digit);
        if ((index + 1) % 3 === 0 && index < reversedWholeNumber.length - 1) {
            formattedOutput.push(",");
        }
    })

    formattedOutput = formattedOutput.reverse().join('') + "." + wholeAndDecimal[1];

    return formattedOutput;
} 
```

* * *

## 回答 #62

> 赞同：2
> 
> 时间：2018-07-30T15:30:24.077

I wanted a vanilla JavaScript solution that automatically returned the decimal portion.

```
function formatDollar(amount) {
    var dollar = Number(amount).toLocaleString("us", "currency");
    // Decimals
    var arrAmount = dollar.split(".");
    if (arrAmount.length==2) {
        var decimal = arrAmount[1];
        if (decimal.length==1) {
            arrAmount[1] += "0";
        }
    }
    if (arrAmount.length==1) {
        arrAmount.push("00");
    }

    return "$" + arrAmount.join(".");
}

console.log(formatDollar("1812.2"); 
```

* * *

## 回答 #63

> 赞同：1
> 
> 时间：2012-10-19T03:43:41.327

Here's mine...

```
function thousandCommas(num) {
  num = num.toString().split('.');
  var ints = num[0].split('').reverse();
  for (var out=[],len=ints.length,i=0; i < len; i++) {
    if (i > 0 && (i % 3) === 0) out.push(',');
    out.push(ints[i]);
  }
  out = out.reverse() && out.join('');
  if (num.length === 2) out += '.' + num[1];
  return out;
} 
```

* * *

## 回答 #64

> 赞同：1
> 
> 时间：2014-09-09T21:28:05.167

I like it simple:

```
function formatPriceUSD(price) {
    var strPrice = price.toFixed(2).toString();
    var a = strPrice.split('');

    if (price > 1000000000)
        a.splice(a.length - 12, 0, ',');

    if (price > 1000000)
        a.splice(a.length - 9, 0, ',');

    if (price > 1000)
        a.splice(a.length - 6, 0, ',');

    return '$' + a.join("");
} 
```

* * *

## 回答 #65

> 赞同：1
> 
> 时间：2019-08-30T11:39:20.153

* * *

## 回答 #66

> 赞同：1
> 
> 时间：2020-10-04T23:40:54.483

Taking a few of the best rated answers, I combined and made an [ECMAScript 2015](https://en.wikipedia.org/wiki/ECMAScript#6th_Edition_%E2%80%93_ECMAScript_2015) (ES6) function that passes [ESLint](https://en.wikipedia.org/wiki/ESLint).

```
export const formatMoney = (
  amount,
  decimalCount = 2,
  decimal = '.',
  thousands = ',',
  currencySymbol = '$',
) => {
  if (typeof Intl === 'object') {
    return new Intl.NumberFormat('en-AU', {
      style: 'currency',
      currency: 'AUD',
    }).format(amount);
  }
  // Fallback if Intl is not present.
  try {
    const negativeSign = amount < 0 ? '-' : '';
    const amountNumber = Math.abs(Number(amount) || 0).toFixed(decimalCount);
    const i = parseInt(amountNumber, 10).toString();
    const j = i.length > 3 ? i.length % 3 : 0;
    return (
      currencySymbol +
      negativeSign +
      (j ? i.substr(0, j) + thousands : '') +
      i.substr(j).replace(/(\d{3})(?=\d)/g, `$1${thousands}`) +
      (decimalCount
        ? decimal +
          Math.abs(amountNumber - i)
            .toFixed(decimalCount)
            .slice(2)
        : '')
    );
  } catch (e) {
    // eslint-disable-next-line no-console
    console.error(e);
  }
  return amount;
}; 
```

* * *

## 回答 #67

> 赞同：0
> 
> 时间：2021-07-14T20:36:10.627

Zero dependency tiny JavaScript library (1kB bytes) by CurrencyRate.today, providing simple way and advanced number, money and currency formatting and removes all formatting/cruft and returns the raw float value.

[https://github.com/dejurin/format-money-js](https://github.com/dejurin/format-money-js)

```
npm install format-money-js 
```

Features:

*   **from**: money and currency formatting;

*   **un**: removes all formatting/cruft and returns the raw float value.

Examples 1

```
const { FormatMoney } = require('format-money-js');

const fm = new FormatMoney({
  decimals: 2
});

console.log(fm.from(12345.67, { symbol: '$' })); // return string: $12,345.67
console.log(fm.un('€12,345;67')); // return number: 12345.67 
```

Example 2

```
const { FormatMoney } = require('format-money-js');

const fm = new FormatMoney({
  decimals: 2
});

console.log(fm.from(
  12345.67, 
  { symbol: '$' },
  true // Parse, return object
  )
);
/* return object: 
{
  source: 12345.67,
  negative: false,
  fullAmount: '12,345.67',
  amount: '12,345',
  decimals: '.67',
  symbol: '$'
}*/ 
```

* * *

## 回答 #68

> 赞同：0
> 
> 时间：2021-11-22T23:01:37.643

you can simply use [NumberToCurrency.js](https://www.npmjs.com/package/number-to-currency) which you will covert number or string to currency string with one command

* * *

## 回答 #69

> 赞同：-1
> 
> 时间：2011-07-22T07:41:53.127

Here is a quick way by using regexp and replace.

```
function formatCurrency(number, dp, ts) {
  var num = parseFloat(number); // Convert to float
  var pw; // For Internet Explorer
  dp = parseInt(dp, 10); // Decimal point
  dp = isNaN(dp) ? 2 : dp; // Default 2 decimal point
  ts = ts || ','; // Thousands separator

  return num != number ?
    false : // Return false for NaN
    ((0.9).toFixed(0) == '1' ? // For cater Internet Explorer toFixed bug
        num.toFixed(dp) : // Format to fix n decimal point with round up
        (Math.round(num * (pw = Math.pow(10, dp) || 1)) / pw).toFixed(dp) // For fixing Internet Explorer toFixed bug on round up value like 0.9 in toFixed
    ).replace(/^(-?\d{1,3})((\d{3})*)(\.\d+)?$/, function(all, first, subsequence, dmp, dec) { // Separate string into different parts
      return (first || '') + subsequence.replace(/(\d{3})/g, ts + '$1') + (dec || ''); // Add thousands separator and rejoin all parts
    } );
} 
```

# bash - 如何递归删除所有文件的尾随空格？

> ID：149057
> 
> 赞同：130
> 
> 时间：2008-09-29T15:01:41.863
> 
> 标签：bash, whitespace

如何删除整个项目的所有尾随空格？从根目录开始，并从所有文件夹中的所有文件中删除尾随空格。

另外，我希望能够直接修改文件，而不仅仅是将所有内容打印到标准输出。

* * *

## 回答 #1

> 赞同：89
> 
> 时间：2011-02-26T22:02:29.347

这是一个 OS X >= 10.6 Snow Leopard 解决方案。

**它忽略 .git 和 .svn 文件夹**及其内容。它也不会留下备份文件。

```
export LC_CTYPE=C
export LANG=C
find . -not \( -name .svn -prune -o -name .git -prune \) -type f -print0 | perl -0ne 'print if -T' | xargs -0 sed -Ei 's/[[:blank:]]+$//' 
```

* * *

## 回答 #2

> 赞同：34
> 
> 时间：2008-09-29T15:07:26.733

利用：

```
find . -type f -print0 | xargs -0 perl -pi.bak -e 's/ +$//' 
```

如果您不希望生成“.bak”文件：

```
find . -type f -print0 | xargs -0 perl -pi -e 's/ +$//' 
```

作为 zsh 用户，您可以省略 find 调用，而是使用：

```
perl -pi -e 's/ +$//' **/* 
```

注意：为防止破坏`.git`目录，请尝试添加：`-not -iwholename '*.git*'`.

* * *

## 回答 #3

> 赞同：32
> 
> 时间：2012-04-12T08:58:16.730

两种替代方法也适用于**DOS 换行符(CR/LF)，并且在****避免二进制文件**方面做得很好：

检查 MIME 类型是否以开头的[通用解决方案](https://unix.stackexchange.com/questions/36233/how-to-skip-file-in-sed-if-it-contains-regex)`text/`：

```
while IFS= read -r -d '' -u 9
do
    if [[ "$(file -bs --mime-type -- "$REPLY")" = text/* ]]
    then
        sed -i 's/[ \t]\+\(\r\?\)$/\1/' -- "$REPLY"
    else
        echo "Skipping $REPLY" >&2
    fi
done 9< <(find . -type f -print0) 
```

[**Mat的 Git 存储库特定**解决方案](https://unix.stackexchange.com/a/36240/3645)，它使用`-I`选项`git grep`跳过 Git 认为是二进制的文件：

```
git grep -I --name-only -z -e '' | xargs -0 sed -i 's/[ \t]\+\(\r\?\)$/\1/' 
```

* * *

## 回答 #4

> 赞同：25
> 
> 时间：2008-09-29T15:04:26.897

在 Bash 中：

`find dir -type f -exec sed -i 's/ *$//' '{}' ';'`

注意：如果您使用的是`.git`存储库，请尝试添加：`-not -iwholename '.git'`.

* * *

## 回答 #5

> 赞同：15
> 
> 时间：2009-03-12T15:03:02.013

这在 OSX 10.5 Leopard 中对我有用，它不使用 GNU sed 或 xargs。

```
find dir -type f -print0 | xargs -0 sed -i.bak -E "s/[[:space:]]*$//" 
```

如果您有需要排除的文件（我做过），请小心这一点！

您可以使用 -prune 忽略某些目录或文件。对于 git 存储库中的 Python 文件，您可以使用以下内容：

```
find dir -not -path '.git' -iname '*.py' 
```

* * *

## 回答 #6

> 赞同：11
> 
> 时间：2013-04-27T00:10:15.130

Ack 就是为这种任务而设计的。

它的工作方式与 grep 类似，但它知道不要进入 .svn、.git、.cvs 等位置。

```
ack --print0 -l '[ \t]+$' | xargs -0 -n1 perl -pi -e 's/[ \t]+$//' 
```

比使用 find/grep 跳过障碍要容易得多。

Ack 可通过大多数包管理器（如*ack*或*ack-grep*）获得。

它只是一个 Perl 程序，因此它也有单文件版本，您只需下载并运行即可。请参阅：[确认安装](http://beyondgrep.com/install/)

* * *

## 回答 #7

> 赞同：9
> 
> 时间：2014-05-14T14:43:15.577

### `ex`

尝试使用[Ex 编辑器](https://en.wikipedia.org/wiki/Ex_%28text_editor%29)（Vim 的一部分）：

```
$ ex +'bufdo!%s/\s\+$//e' -cxa **/*.* 
```

^(注意：对于递归（bash4 和 zsh），我们使用[新的通配选项](https://stackoverflow.com/q/4438306/55075)( `**/*.*`)。通过 启用`shopt -s globstar`。)

您可以将以下功能添加到您的`.bash_profile`：

```
# Strip trailing whitespaces.
# Usage: trim *.*
# See: https://stackoverflow.com/q/10711051/55075
trim() {
  ex +'bufdo!%s/\s\+$//e' -cxa $*
} 
```

### `sed`

对于使用`sed`，请检查：[如何使用 sed 删除尾随空格？](https://stackoverflow.com/q/4438306/55075)

### `find`

找到以下脚本（例如`remove_trail_spaces.sh`）从文件中删除尾随空格：

```
#!/bin/sh
# Script to remove trailing whitespace of all files recursively
# See: https://stackoverflow.com/questions/149057/how-to-remove-trailing-whitespace-of-all-files-recursively

case "$OSTYPE" in
  darwin*) # OSX 10.5 Leopard, which does not use GNU sed or xargs.
    find . -type f -not -iwholename '*.git*' -print0  | xargs -0 sed -i .bak -E "s/[[:space:]]*$//"
    find . -type f -name \*.bak -print0 | xargs -0 rm -v
    ;;
  *)
    find . -type f -not -iwholename '*.git*' -print0 | xargs -0 perl -pi -e 's/ +$//'
esac 
```

从要扫描的目录运行此脚本。最后在 OSX 上，它将删除所有以`.bak`.

要不就：

```
find . -type f -name "*.java" -exec perl -p -i -e "s/[ \t]$//g" {} \; 
```

这是[Spring Framework Code Style](https://github.com/spring-projects/spring-framework/wiki/Spring-Framework-Code-Style)推荐的方式。

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2009-11-26T14:15:24.887

我最终没有使用 find 也没有创​​建备份文件。

```
sed -i '' 's/[[:space:]]*$//g' **/*.* 
```

根据文件树的深度，这（较短的版本）可能足以满足您的需要。

注意这也需要二进制文件，例如。

* * *

## 回答 #9

> 赞同：6
> 
> 时间：2012-03-09T18:40:21.983

这里不是排除文件，而是上面明确的白名单文件的变体，基于文件扩展名，你想要剥离，随意调味：

```
find . \( -name *.rb -or -name *.html -or -name *.js -or -name *.coffee -or \
-name *.css -or -name *.scss -or -name *.erb -or -name *.yml -or -name *.ru \) \
-print0 | xargs -0 sed -i '' -E "s/[[:space:]]*$//" 
```

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2010-11-16T19:24:15.420

我最终运行了这个，它是 pojo 和 adams 版本的混合。

它将清除尾随空格以及另一种形式的尾随空格，即回车：

```
find . -not \( -name .svn -prune -o -name .git -prune \) -type f \
  -exec sed -i 's/[:space:]+$//' \{} \;  \
  -exec sed -i 's/\r\n$/\n/' \{} \; 
```

如果有，它不会触及 .git 文件夹。

**编辑**：在评论之后让它更安全一点，不允许在其中获取带有“.git”或“.svn”的文件。但要注意，如果你有一些二进制文件，它*会触及二进制文件。*如果您只希望它接触例如 .py 和 .php 文件，请使用`-iname "*.py" -or -iname "*.php"`after 。`-type f`

**更新 2**：它现在替换了行尾的各种空格（这也意味着制表符）

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2014-08-05T05:29:57.927

红宝石：

```
irb
Dir['lib/**/*.rb'].each{|f| x = File.read(f); File.write(f, x.gsub(/[ \t]+$/,"")) } 
```

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2012-09-20T08:03:55.497

这很好用.. add/remove --include 用于特定文件类型：

```
egrep -rl ' $' --include *.c *  | xargs sed -i 's/\s\+$//g' 
```

* * *

## 回答 #13

> 赞同：4
> 
> 时间：2016-11-02T02:52:48.953

1）许多其他答案使用`-E`. 我不知道为什么，因为那是[未记录的 BSD 兼容性](https://stackoverflow.com/questions/3139126/whats-the-difference-between-sed-e-and-sed-e)选项。`-r`应改为使用。

2）其他答案使用`-i ''`。那应该只是`-i`（或者`-i''`如果愿意的话），因为`-i`后面有后缀。

3）Git具体解决方案：

```
git config --global alias.check-whitespace \
'git diff-tree --check $(git hash-object -t tree /dev/null) HEAD'

git check-whitespace | grep trailing | cut -d: -f1 | uniq -u -z | xargs -0 sed --in-place -e 's/[ \t]+$//' 
```

第一个注册一个 git 别名`check-whitespace`，其中列出了带有尾随空格的文件。第二个运行`sed`在他们身上。

我只使用`\t`而不是`[:space:]`因为我通常看不到垂直标签、换页和不可破坏的空格。您的测量值可能会有所不同。

* * *

## 回答 #14

> 赞同：4
> 
> 时间：2019-08-03T01:21:26.653

我使用正则表达式。4个步骤：

1.  在编辑器中打开根文件夹（我使用 Visual Studio Code）。
2.  点击左侧的搜索图标，然后启用正则表达式模式。
3.  在搜索栏中输入“+\n”，在替换栏中输入“\n”。
4.  单击“全部替换”。

这将删除所有文件中每行末尾的所有尾随空格。您可以排除一些不符合此需求的文件。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2012-08-08T09:43:11.600

这对我有用（Mac OS X 10.8，Homebrew 安装的 GNU sed）：

```
find . -path ./vendor -prune -o \
  \( -name '*.java' -o -name '*.xml' -o -name '*.css' \) \
  -exec gsed -i -E 's/\t/    /' \{} \; \
  -exec gsed -i -E 's/[[:space:]]*$//' \{} \; \
  -exec gsed -i -E 's/\r\n/\n/' \{} \; 
```

删除尾随空格，用空格替换制表符，用 Unix 替换 Windows CRLF `\n`。

有趣的是，在所有文件得到修复之前，我必须运行 3-4 次，所有清理`gsed`指令。

# encoding - 如何在浏览器的文件下载框中显示非 ASCII 文件名？

> ID：149058
> 
> 赞同：8
> 
> 时间：2008-09-29T15:02:09.927
> 
> 标签：encoding, utf-8

似乎没有一种可接受的方式以非 ascii 格式发送标头参数。

文件下载的标头通常看起来像

内容配置：附件；文件名="theasciifilename.doc"

除非你在文件名参数中破坏了一个 utf8 编码的字符串，Firefox 会很好地处理它，而 IE 会抛出。

CodeProject 上有一个[文档解释了对文件名进行编码的方法。](http://www.codeproject.com/KB/aspnet/NonUSASCII.aspx)

本文档通过十六进制编码字节将 Bản Kiểm Kê.doc 编码为 B%e1%ba%a3n%20Ki%e1%bb%83m%20K%c3%aa.doc。

问题 #1：该字符串中的第一个字符：ả 的值为 ả - 将该数字编码为十六进制，您会得到 %a3%1e。这家伙是怎么得到%e1%ba%a3的？（我显然在这里遗漏了一些简单的东西）

问题 #2：虽然 IE 承认这种编码，但 Firefox 不承认！该怎么办？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-29T22:45:16.727

规范基本上不允许除 US-ASCII 之外的任何内容。HTTP 标头是 US-ASCII。HTTP 的负载默认为 ISO 8859-1，但它指的是内容正文，而不是标头。

可以说，正确的做法是使用 MIME 的技术在标头中编码非 ASCII 数据，如[RFC 2047](ftp://ftp.rfc-editor.org/in-notes/rfc2047.txt)中所述，但我不知道浏览器是否真的支持这一点。

**编辑：**哎呀，不，RFC 2047 第 5 节明确表示 Content-Disposition 中不允许编码形式。看起来你不走运 - 没有标准。

**编辑 2：**有一个标准 - [RFC 2231](ftp://ftp.rfc-editor.org/in-notes/rfc2231.txt)定义了现在应该如何工作。它得到了一些浏览器的支持，但在 IE 中不受支持。我发现[了一些测试用例](ftp://ftp.rfc-editor.org/in-notes/rfc2231.txt)，它们展示了它的工作原理以及可用的浏览器支持。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-29T15:18:06.020

对问题 #1 的回答：您混淆了 Unicode 和 UTF-8。'ả' 的十六进制值是 0xA31E 但这不是 UTF-8 字符。在 UTF-8 中，该字符需要三个字节，`0xE1 0xBA 0xA3`. URL 编码对于非 ascii 编码的定义很差，但 %e1%ba%a3 是用于该字符的有效 UTF-8 编码。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-04T00:07:04.203

对于问题 #2，您需要对 Internet Explorer 和 Firefox 的文件名进行 URL 编码。唯一的区别是您需要在 Firefox 中使用 RFC 2231 的格式。这适用于 Firefox 3 和 Internet Explorer 7。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-29T15:10:24.463

在上面的链接中， e1 ba a3 是提到的字符的 UTF-8 编码，而不是字符代码。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-29T16:37:32.490

对问题 #2 的回答（某种程度上）：

由于您发现一个浏览器中的命名方案在另一个浏览器中不起作用，您唯一的解决方案是对每个浏览器进行不同的处理，类似于[此处](http://www.motobit.com/help/ScptUtl/pa97.htm)的示例。

如果链接消失，解决方案基本上是：

```
1\. If browser is IE URL encode filename
2\. Generate Content-disposition header 
```

当然，通过 User-agent 确定浏览器是否为 IE（这是您可以做到的唯一方法）充满了各种常见的危险。

就像这听起来以北美为中心一样，如果在您无法控制的大量浏览器中这项工作很重要，哪些浏览器可能会阻止或修改用户代理，那么只需避免文件名中的 UTF-8 编码字符并始终使用“下载”之类的。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-15T15:46:47.707

不幸的是，目前没有一种方法可以在所有用户代理中工作。

测试用例见[http://greenbytes.de/tech/tc2231/ ，然后向微软、谷歌和苹果投诉。](http://greenbytes.de/tech/tc2231/)

# mysql - 你最喜欢的 Ruby on Rails 书籍是什么，为什么？

> ID：149060
> 
> 赞同：3
> 
> 时间：2008-09-29T15:02:26.307
> 
> 标签：mysql, ruby-on-rails, ruby, memcached, mongrel

我正在寻找一些关于 RoR 的书籍，以帮助自学如何构建可扩展的 RoR 应用程序。我已经阅读了 RailsS​​pace 的书，今晚将开始阅读 Rails Way 的书。

一些感兴趣的主题是：

*   REST - 考虑使用 Amazon 的 SimpleDB
*   有效地使用 RSpec
*   memcached - 服务器架构和代码实现
*   mongrel - 服务器架构
*   MySQL

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-09-29T15:16:30.330

[使用 Rails 进行敏捷 Web 开发对于](http://www.pragmaticprogrammer.com/news/second-edition-agile-web-development-with-rails-now-shipping)Rails 新手来说始终是一个很好的起点。

我真的很喜欢这本书，因为它以示例驱动的方法来教你框架。他们一步一步地构建了一个应用程序，我认为这确实可以帮助您了解 Rails 框架的要点。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-29T15:42:59.797

[替代文字 http://ecx.images-amazon.com/images/I/51QMXWhhVjL._SL500_BO2,204,203,200_AA219_PIsitb-sticker-dp-top,TopLeft,25,-40_SH20_OU01_.jpg](http://ecx.images-amazon.com/images/I/51QMXWhhVjL._SL500_BO2,204,203,200_AA219_PIsitb-sticker-dp-top,TopLeft,25,-40_SH20_OU01_.jpg)

[《Rails Way》](https://rads.stackoverflow.com/amzn/click/com/0321445619)是一本很棒的书。但是，不要忘记阅读大量网站。例如，[Rails 方式](http://www.therailsway.com/)。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-29T20:18:51.757

[Rails Recipes](https://rads.stackoverflow.com/amzn/click/com/0977616606)和[Advanced Rails Recipes](https://rads.stackoverflow.com/amzn/click/com/0978739221)是非常简单的书籍，可以帮助您完成工作。我刚刚开始阅读[The Art of Rails](https://rads.stackoverflow.com/amzn/click/com/0470189487)，其中涵盖了一些更高级的主题，例如元编程、API 设计和 RSpec。到目前为止我很享受。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-29T15:05:30.310

[替代文字 http://ecx.images-amazon.com/images/I/51M9z0rC3aL._SL500_AA240_.jpg](http://ecx.images-amazon.com/images/I/51M9z0rC3aL._SL500_AA240_.jpg)

[Simply Rails 2](http://www.amazon.com/exec/obidos/tg/detail/-/0980455200/ref=ord_cart_shr?_encoding=UTF8&m=ATVPDKIKX0DER&v=glance)是一本很棒的书，我一直在用它来开始使用 Rails

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-29T16:40:46.943

我从“使用 Rails 进行敏捷开发”开始，并且听说过关于 SitePoint 书籍“Simply Rails 2”的好消息。要考虑的事情，尤其是 Rails，是确保您正在阅读的版本是相关的。Rails 运行**得非常**快，我发现很难找到准确、及时的文档。它是跨多个网站的博客和随机 wiki 文档的混搭。花时间确保您获得有关正确版本的正确文档。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-29T15:24:16.443

在使用 Rails 进行敏捷 Web 开发之后，我最喜欢的是[Practical Rails Projects](https://rads.stackoverflow.com/amzn/click/com/1590597818)，它通过使用 Web 服务、REST、javascript 等功能“开发”多个项目来超越Rails。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-29T15:25:07.970

我非常喜欢 Rails 食谱书籍，因为它们是最佳实践的集合。对于学习轨道，敏捷书是标准。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-29T16:37:53.050

我同意“Rails 方式”。它只涵盖比大多数其他书籍更高级的主题。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-30T21:49:08.427

这个问题已经在 StackOverflow 上以类似的形式问过几次。这是[一个类似问题的链接](https://stackoverflow.com/questions/99370/anyone-know-of-a-good-ruby-on-rails-21-tutorial#99571)。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-03-18T09:57:47.833

我目前正在阅读；

*   [Ruby on Rails 傻瓜版](http://www.amazon.co.uk/Ruby-Rails-Dummies-Barry-Burd/dp/0470081201/ref=sr_1_19?ie=UTF8&s=books&qid=1237370003&sr=8-19 "傻瓜式导轨")
*   [简单的 Rails 2.0](http://www.amazon.co.uk/Simply-Rails-2-Patrick-Lenz/dp/0980455200/ref=sr_1_1?ie=UTF8&s=books&qid=1237369956&sr=8-1)
*   [使用 Rails 进行敏捷 Web 开发](http://www.amazon.co.uk/Agile-Web-Development-Rails-Ruby/dp/1934356166/ref=sr_1_22?ie=UTF8&s=books&qid=1237370003&sr=8-22)

它们都很好，（可能按复杂程度排列）

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-11-23T14:14:20.680

**使用 Rails 进行敏捷 Web 开发**是我最喜欢的 Rails 书籍！

如果您需要更多信息，请使用谷歌 :)

# flash - Flash / ActionScript 3.0 中的 StackTrace

> ID：149073
> 
> 赞同：37
> 
> 时间：2008-09-29T15:05:12.867
> 
> 标签：flash, actionscript-3, stack-trace

我想在我的代码的任何函数中查看堆栈跟踪，所以我做了这样的事情来调用它并打印堆栈跟踪：

```
public function PrintStackTrace() {
    try {
        throw new Error('StackTrace');
    } catch (e:Error) {
        trace(e.getStackTrace());
    }
} 
```

我想知道是否有其他方法可以做到这一点。在某些地方，Error 类创建了堆栈跟踪，但也许它没有用 ActionScript 3.0 做到这一点，所以它可能不可行，但我想知道。

谢谢！

* * *

## 回答 #1

> 赞同：51
> 
> 时间：2008-09-29T15:29:53.993

据我所知，使堆栈跟踪可用于您自己的代码的唯一方法是通过 Error 类中的[getStackTrace()](http://livedocs.adobe.com/flex/3/langref/Error.html#getStackTrace())方法，就像您已经在做的那样。但是，在回答您问题中的示例时，我会提到您实际上不必抛出错误 - 您可以创建它并在其上调用方法：

```
var tempError:Error = new Error();
var stackTrace:String = tempError.getStackTrace(); 
```

此外，如文档所述，这仅适用于 Flash Player 的调试版本，因此您可以将此功能包装在一个 if 块中，如果需要，该块会检查[Capabilities.isDebugger](http://livedocs.adobe.com/flex/3/langref/flash/system/Capabilities.html#isDebugger)的值。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2013-02-10T23:52:55.830

从 Flash Player 11.5 开始，堆栈跟踪也可用于播放器的非调试器版本。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2010-10-13T15:18:35.977

使用 Flex SDK 附带的 Flex 调试器 (FDB)。它是一个命令行调试器，允许您调试 .swf，甚至是在线调试器（如果它是调试版本）。它允许您设置断点、打印/更改变量和转储堆栈，并且**不需要您添加任何额外的代码**。一个非常有用的工具，你不应该没有！

您需要的 fdb 选项是 'break' 并指定要停止执行的类和行，以及 'bt' 或 'info stack' 为您提供堆栈的回溯。您还可以在应用程序运行时显示有关应用程序的几乎所有内容。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2012-02-06T08:52:21.753

@hasseg 是对的。您还可以通过在编译 SWF 时提供 -compiler.verbose-stacktraces=true 来保留发布版本（而非调试）中的堆栈跟踪信息。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2016-03-29T16:52:11.823

我把这个小功能放在一起：

```
public static function getStackTrace() : String
{
    var aStackTrace : Array = new Error().getStackTrace().split("\n");
    aStackTrace.shift();
    aStackTrace.shift();
    return "Stack trace: \n" + aStackTrace.join("\n");
} 
```

我在开发时与我的应用程序一起使用的自定义“调试”类中具有此功能。两个 shift() 调用删除了前两行：第一行只是字符串“Error”，第二行引用了这个函数本身，所以它没有用。如果您愿意，您甚至可以删除第三行（它指的是您调用 getStackTrace() 函数的行），方法是添加另一个 shift() 调用，但我将其作为“堆栈”的起点痕迹”。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2013-12-18T13:14:20.613

```
var tempError:Error = new Error();
var stackTrace:String = tempError.getStackTrace(); 
```

将此`stackTrace`字符串写入任何文件，以便您也可以在运行模式下查看程序的日志。所以你不需要只在调试器模式下运行它。将其写入`uncaughtexception`应用程序的事件中，因此它将最后执行。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2014-08-25T19:38:48.097

从 Flash 11.5 开始，堆栈跟踪在 Flash 的发布版本中工作。

然而，这并不意味着这不再是一个问题。如果您的应用程序设置为使用早于 11.5 in 的编译器`Flash Builder --> Project properties --> ActionScript Compiler`，则不会有堆栈跟踪。

此外，在同一页面上，您可以查看您的 AIR SDK 版本。如果您使用的是 v3.4 或更早版本，您将看不到堆栈跟踪。[如果这是您的问题，您的所有开发人员都应按照此处](http://helpx.adobe.com/flash-builder/kb/overlay-air-sdk-flash-builder.html)的说明更新他们的 AIR SDK 。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2016-07-11T09:10:01.270

该`getStackTrace`方法仅在调试 Flash 播放器 ( [https://www.adobe.com/support/flashplayer/debug_downloads.html](https://www.adobe.com/support/flashplayer/debug_downloads.html) ) 上返回堆栈跟踪，在发布播放器上返回`null`。确保您已安装并运行调试播放器。

仅将`-compiler.verbose-stacktraces=true`行号添加到调试堆栈跟踪。

样例测试： [https ://gist.github.com/pipeno/03310d3d3cae61460ac6c590c4f355ed](https://gist.github.com/pipeno/03310d3d3cae61460ac6c590c4f355ed)

# database - 多个索引可以一起工作吗？

> ID：149078
> 
> 赞同：15
> 
> 时间：2008-09-29T15:05:48.937
> 
> 标签：database, oracle, optimization, indexing

假设我有一个包含两个字段“foo”和“bar”的数据库表。它们都不是唯一的，但它们中的每一个都被索引。但是，它们不是一起索引，而是每个都有一个单独的索引。

现在假设我执行一个查询，例如`SELECT * FROM sometable WHERE foo='hello' AND bar='world';` 我的表，其中 foo 为“hello”的大量行和 bar 为“world”的少量行。

所以数据库服务器在底层做的最有效的事情是使用 bar 索引来查找 bar 为 'world' 的所有字段，然后只返回 foo 为 'hello' 的那些行。这是`O(n)`其中 n 是 bar 为“world”的行数。

但是，我想这个过程可能会反过来发生，即使用 fo 索引并搜索结果。这将是`O(m)`其中 m 是 foo 是“hello”的行数。

那么 Oracle 是否足够聪明，可以在这里高效搜索？其他数据库呢？或者有什么方法可以在我的查询中告诉它以正确的顺序搜索？也许通过将条款`bar='world'`放在首位`WHERE`？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-09-29T15:26:03.207

Oracle 几乎肯定会使用最具选择性的索引来驱动查询，您可以使用解释计划检查这一点。

此外，Oracle 可以通过几种方式结合使用这两个索引——它可以将 btree 索引转换为位图并对它们执行位图 AND 操作，或者它可以对两个索引返回的 rowid 执行哈希连接。

这里的一个重要考虑因素可能是被查询的值之间的任何相关性。如果 foo='hello' 占表中 80% 的值，bar='world' 占 10%，那么 Oracle 将估计查询将返回 0.8*0.1= 8% 的表行。但是，这可能不正确 - 查询实际上可能返回 10% 的 rwo 甚至 0% 的行，具体取决于值的相关程度。现在，根据这些行在整个表中的分布情况，使用索引来查找它们可能效率不高。您可能仍需要访问（例如）70% 或表块来检索所需的行（谷歌为“聚类因子”），在这种情况下，如果 Oracle 的估计正确，它将执行完整的表扫描。

我相信在 11g 中，您可以收集多列统计信息来帮助解决这种情况。在 9i 和 10g 中，您可以使用动态采样来很好地估计要检索的行数。

要获取执行计划，请执行以下操作：

```
explain plan for
SELECT *
FROM   sometable
WHERE  foo='hello' AND bar='world'
/
select * from table(dbms_xplan.display)
/ 
```

与之对比：

```
explain plan for
SELECT /*+ dynamic_sampling(4) */
       *
FROM   sometable
WHERE  foo='hello' AND bar='world'
/
select * from table(dbms_xplan.display)
/ 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-07T18:48:15.257

伊莱，

你在评论中写道：

> 不幸的是，我有一张表，里面有很多列，每列都有自己的索引。用户可以查询任意字段组合，因此我无法高效地为每个字段组合创建索引。但是，如果我确实只有两个需要索引的字段，我完全同意您使用两个索引的建议。– Eli Courtwright（9 月 29 日 15:51）

这实际上是相当重要的信息。有时，程序员在提问时会比自己聪明。他们试图将问题提炼成最重要的问题，但往往过于简化而错过了最佳答案。

这种情况正是发明位图索引的原因——处理在 where 子句中使用未知列组的时间。

以防万一有人说 BMI 仅适用于低基数列，可能不适用于您的情况。低可能没有你想象的那么小。唯一真正的问题是 DML 与表的并发性。必须是单线程或罕见的才能工作。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-29T15:14:06.327

是的，您可以通过查询向 Oracle 提供“提示”。这些提示伪装成数据库的注释（“/* HINT */”）并且主要是特定于供应商的。因此，一个数据库的一个提示将不适用于另一个数据库。

我会在这里使用索引提示，小表的第一个提示。见[这里](http://www.dbasupport.com/oracle/ora9i/index_hints.shtml)。

另一方面，如果您经常搜索这两个字段，为什么不在这两个上创建索引呢？我没有正确的语法，但它会像

```
CREATE INDEX IX_BAR_AND_FOO on sometable(bar,foo); 
```

这样数据检索应该非常快。如果连接是唯一的，您只需创建一个应该快如闪电的唯一索引。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-29T15:29:19.673

首先，我假设你在谈论好的、正常的、标准的 b*-tree 索引。位图索引的答案完全不同。对于 Oracle 中的各种类型的索引，有很多选项可能会也可能不会改变答案。

至少，如果优化器能够确定特定条件的选择性，它将使用更具选择性的索引（即柱上的索引）。但是，如果您有偏斜的数据（列栏中有 N 个值，但任何特定值的选择性基本上大于或小于数据的 1/N），您需要在列上有一个直方图才能告诉优化器哪些值或多或少有可能。如果您使用绑定变量（所有优秀的 OLTP 开发人员都应该这样做），根据 Oracle 版本，您可能会遇到绑定变量窥视的问题。

潜在地，Oracle 甚至可以将两个 b*-tree 索引动态转换为位图，并将位图组合起来，以便使用这两个索引来查找需要检索的行。但这是一个相当不寻常的查询计划，特别是如果只有两列，其中一列是高度选择性的。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-29T15:15:32.983

> 那么 Oracle 是否足够聪明，可以在这里高效搜索？

简单的答案是“可能”。每个数据库供应商都有很多非常聪明的人致力于优化查询优化器，所以它可能正在做你甚至没有想到的事情。如果你更新统计数据，它可能会做得更多。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-29T15:16:23.870

我相信您也可以让 Oracle 显示一个查询计划，这样您就可以准确地看到首先使用哪个索引。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-29T15:20:32.440

最好的方法是将 foo 添加到 bar 的索引，或将 bar 添加到 foo 的索引（或两者）。如果 foo 的索引还包含 bar 上的索引，则该额外的索引级别不会影响 foo 索引在该索引的任何当前使用中的效用，也不会明显影响维护该索引的性能，但它会给数据库额外的用于优化查询的信息，例如示例中的。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-29T15:24:42.137

它比那更好。

索引搜索总是比全表扫描快。因此，在幕后 Oracle（以及 SQL 服务器）将首先在两个索引上定位行的范围。然后它将查看哪个范围更短（看到它是一个内部连接），它会迭代更短的范围以找到两者中较大的匹配项。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-29T15:17:20.687

您可以提供有关使用哪个索引的提示。我对 Oracle 不熟悉，但在 Mysql 中，您可以使用 USE|IGNORE|FORCE_INDEX（有关详细信息，请参阅[此处）。](http://dev.mysql.com/doc/refman/5.1/en/index-hints.html)为了获得最佳性能，您应该使用组合索引。

# windows - 从忽略读取错误的光学介质中恢复

> ID：149092
> 
> 赞同：7
> 
> 时间：2008-09-29T15:10:37.223
> 
> 标签：windows, linux, recovery, system-calls, optical-drive

我有存档在光学媒体（CD 和 DVD）中的文件的备份。这些都有 par2 恢复文件，存储在单独的媒体上。即使在没有 par2 文件的情况下，在一个光驱上读取时的小错误也可以在另一个驱动器上正常读取。

问题是，当读取有故障的媒体时，读取时间非常非常长，因为设备往往会重试多次。

问题是：如何控制重试次数（即设置为不重试或只试一次）？一些系统调用？可以下载的库吗？我必须在 SCSI 层上工作吗？

这个问题主要是关于 Linux 的，但任何 Win32 指针也将受到欢迎。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-16T08:24:07.397

`man readom`，cdrecord自带的一个程序：

```
 -noerror
          Do not abort if the high level error checking in readom found an
          uncorrectable error in the data stream.

   -nocorr
          Switch  the  drive  into  a mode where it ignores read errors in
          data sectors that are a result of uncorrectable  ECC/EDC  errors
          before reading.  If readom completes, the error recovery mode of
          the drive is switched back to the remembered old mode.
   ...

   retries=#
          Set the retry count for high level retries in readom to #.   The
          default  is  to do 128 retries which may be too much if you like
          to read a CD with many unreadable sectors. 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-17T13:50:40.550

可用的最佳工具是 dd_rhelp。只是

```
dd_rhelp /dev/cdrecorder /home/myself/DVD.img 
```

，喝杯茶，看漂亮的图形。

dd_rhelp rpm 包信息：

> dd_rhelp 在整个磁盘上使用 ddrescue，并在尝试对坏扇区进行长时间尝试之前尝试收集最大有效数据。如果您让 dd_rhelp 无限工作，它的效果与简单的 dd_rescue 类似。但是因为您可能没有这个无限的时间，dd_rhelp 会跳过坏扇区并挽救有效数据。从长远来看，它会使用 dd_rescue 解析您的所有设备。
> 
> 您可以随时按 Ctrl-C 并随意重新运行，dd_rhelp 会恢复作业，因为它取决于 dd_rescue 创建的日志文件。此外，进度会显示在您的设备被救出的 ASCII 图片中。

我自己用过很多次，非常非常可靠。

您可以将它从 DAG 安装到类似 Red Hat 的发行版中。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-29T19:24:14.650

由于建议使用 dd，我应该注意我知道存在并使用了 sg_dd，但我的问题不是关于命令 (1) 或 (1m)，而是关于系统调用 (2) 或库 (3)。

### 编辑

另一个有用的 linux 命令行实用程序是`sdparm`. 以下标志似乎禁用了硬件重试：

```
sudo sdparm --set=RRC=0 /dev/sr0 
```

`/dev/sr0`就我而言，光驱的设备在哪里。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-29T18:50:30.283

在检查是否`hdparm`可以修改重试次数时（似乎不是这样），我认为，根据错误的类型，降低 CD-ROM 速度可能会减少读取错误的数量，这实际上可能会增加平均读取速度。但是，如果某些扇区完全无法读取，那么即使降低 CD-ROM 速度也无济于事。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-12T16:11:44.900

由于您要询问驱动程序级别的访问权限，因此您应该查看 SCSI 命令，或者可能是 ASPI 之类的 API。在 windows VSO 软件（下面的盲读/盲写开发人员）开发了一个更好的 API，Patin-Couffin，它提供锁定的低级访问：

[http://en.wikipedia.org/wiki/Patin-Couffin](http://en.wikipedia.org/wiki/Patin-Couffin)

这可能会让你开始。然而，归根结底，驱动器与 SCSI 命令接口，即使它实际上是 USB、SATA、ATA、IDE 或其他。您还可以查找与 ATAPI 相关的术语，这是该 CD-ROM SCSI 层接口的首批规范之一。

如果您找不到合适的 linux 库或使用上述搜索术语和概念处理较低级别命令的示例，我会感到惊讶。

* * *

较旧的答案：

[Blindread/blindwrite](http://www.blindwrite.com/)是在 cd-rom 保护方案的鼎盛时期开发的，通常使用故意坏扇区或错误信息来验证原始 CD。

它将允许您设置一系列参数，包括重试。请记住，CD-ROM 驱动器本身决定了重试的次数，我不确定这是否可以通过许多（大多数？）CD-ROM 驱动器的软件进行设置。

您可以将磁盘复制为 ISO 格式，忽略错误，然后使用 ISO 实用程序读取数据。

-亚当

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-16T08:37:43.213

看一下[ASPI](http://en.wikipedia.org/wiki/ASPI)接口。在 windows 和 linux 上都可用。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2008-09-29T17:46:41.140

dd(1) 是你的朋友。

dd if=/dev/cdrom of=image bs=2352 conv=noerror,notrunc

该驱动器可能仍会重试一次，但我认为如果不修改固件，您不会变得更好。

# excel - 在 Excel 电子表格中捕获 Click 事件

> ID：149102
> 
> 赞同：1
> 
> 时间：2008-09-29T15:13:08.573
> 
> 标签：excel, user-interface, spreadsheet, event-driven, vba

当用户单击单元格时，如何在 Excel 中捕获事件。我希望能够使用这个事件来触发一些代码来计算用户点击一列中几个不同单元格的次数。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-29T15:17:08.127

查看 Worksheet_SelectionChange 事件。在这种情况下，您可以使用带有命名范围的 Intersect() 来确定是否单击了特定范围。

这里有一些代码可以帮助您入门。

```
Private Sub Worksheet_SelectionChange(ByVal Target As Excel.Range)
    If Not Intersect(Target, Range("SomeNamedRange")) Is Nothing Then
         'Your counting code 
    End If
End Sub 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-29T15:14:54.390

使用[Worksheet.SelectionChange](http://msdn.microsoft.com/en-us/library/microsoft.office.tools.excel.worksheet.selectionchange(VS.80).aspx)事件来捕获它。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-29T15:18:06.363

Worksheet SelectionChange 事件会做到这一点。请注意，**每次**用户单击新单元格时都会触发此事件。

# crystal-reports - Crystal Reports 与 ReportViewer 的优缺点？

> ID：149118
> 
> 赞同：16
> 
> 时间：2008-09-29T15:16:35.557
> 
> 标签：crystal-reports, reporting

我们一直在为我们的 Web 应用程序在 VS2008 中围绕 Crystal Reports 设计报表，我刚刚发现 Microsoft 提供了 ReportViewer 控件。我进行了一些搜索，但无法找到每种生成报告方法的优缺点的良好细分。

我正在寻找有关以下方面的利弊：

*   易于开发
*   易于部署
*   数据导出能力
*   易于支持和在网络上查找帮助

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-09-29T15:32:41.180

好吧，我可以回答一方面。我使用了**ReportViewer**又名客户端报告。我可以告诉你它易于使用、易于部署和易于开发。如果您可以创建 SQL Reporting Services 报表，则可以创建这些报表。他们可以采用任何类型的数据源，因此您可以完全控制。

[这是一本关于客户端报告的优秀书籍](https://www.apress.com/us/book/9781590598542)。

有内置的 PDF 和 Excel 导出可用，但您也可以添加自己的导出处理。您可以在您自己的服务中使用winforms、Asp.Net。你可以用它们做任何你能想象到的事情。

对于水晶报表，我对它们了解不多。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-11-11T14:11:01.673

我可以说，我使用 Crystal Reports 的次数越多（这已经超过 9 年了），我就越想摆脱它。您想留在那里的唯一原因是，如果您已经启动并运行了大量 CR 报告。

Crystal Reports 是用户将其视为“天造地设”的报告引擎的“一站式商店”，但结果却过于臃肿，充满了错误和许可证要求。

它**非常**强大，但要付出代价；它很复杂，并不总是按照您的意愿行事。

那里*有*更好的选择。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-12-18T00:12:36.780

我们一直在使用 Crystal Report 进行报告，但始终存在可移植性问题，因为您必须将 Crystal 运行时与您的应用程序打包在一起。此外，对于客户端报告，它的大部分功能都没有被利用。reportviewer 简单易用，并且包含您需要的功能。

# .net - 更改/添加控件到窗口打开/保存通用对话框

> ID：149119
> 
> 赞同：6
> 
> 时间：2008-09-29T15:16:54.197
> 
> 标签：.net, c++, openfiledialog, savefiledialog

有没有办法更改/添加到 Windows 打开/保存常用对话框以添加额外的功能？

在工作中，我们在服务器上有一个区域，其中包含数百个“工作文件夹”——只是由数据库应用程序自动创建/管理的普通 Windows 文件夹，用于存放有关工作的信息（电子邮件/扫描的传真/Word 文档/电子表格/照片等）由作业编号命名。

我想用一个组合框扩展标准的打开/保存对话框，该组合框根据数据库中的标签搜索工作文件夹，这样无论我的用户在做什么，他们都可以轻松找到正确的工作文件夹来查找/保存他们的工作

连接到数据库并提供搜索功能是没有问题的，但是有没有办法在对话框中添加一个组合框控件（最好使用 keypress/keydown 事件）？

或者创建我自己的对话框并调用/使用它来代替标准对话框？即从任何应用程序我的对话框将被称为允许轻松访问工作文件夹。如果他们在 Outlook 中，他们可以快速找到工作文件夹，如果使用记事本，他们仍然可以轻松找到该文件夹​​。

这将意味着一种从任何应用程序中查找工作文件夹的新统一方式。

理想情况下，有人会知道使用 VB/VB.net/C# 的方法，但我猜，如果可能的话，它可能会是 C++。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-29T18:55:01.833

就像 Mark Ransom 所说，您可以使用 OFN ENABLETEMPLATE 和 OFN ENABLEHOOK 标志来做到这一点。然后为 OPENFILENAME 结构的 lpTemplateName 数据成员指定一个对话框资源。正确放置控件需要反复试验。

您编写的挂钩过程将接收特定于该对话框的窗口消息 - 您对 WM_NOTIFY 消息特别感兴趣 - 有许多特殊消息（CDN INITDONE、CDN FOLDERCHANGE 等）。

我已经创建了一些非常复杂的，我希望我可以包括一个截图。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-29T18:02:41.537

Windows API 的相关 Microsoft 文档位于：http:
[//msdn.microsoft.com/en-us/library/ms646960 (VS.85).aspx](http://msdn.microsoft.com/en-us/library/ms646960(VS.85).aspx)
[http://msdn.microsoft.com/en-us/library /ms646839(VS.85).aspx](http://msdn.microsoft.com/en-us/library/ms646839(VS.85).aspx)

特别注意 OFN_ENABLETEMPLATE 和 OFN_ENABLEHOOK 标志。

正如您所说，当您使用 C/C++ 工作时，这些信息最相关。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-29T15:19:30.027

您的程序可以设置起始文件夹，因此如果您知道作业编号（以及文件夹的名称），您可以将对话框设置为从已打开的正确文件夹开始。除此之外，我认为如果不为其编写整个 shell 扩展，您将无能为力。

# sql-server - SQL Server 2000：更新语句上的“子查询返回多个值”

> ID：149124
> 
> 赞同：2
> 
> 时间：2008-09-29T15:17:45.617
> 
> 标签：sql-server

我正在尝试做一个简单的更新。这种事情我已经做过几千次了。

```
update articles
set department = 60
where type = 'Top Story' 
```

今天我收到一个奇怪的错误。

> 描述错误：无法检索执行计划：子查询返回超过 1 个值。当子查询跟随 =、!=、<、<=、>、>= 或子查询用作表达式时，这是不允许的。
> 
> 警告：---> W (1)：语句已终止。<---
> 
> 1559 条记录受影响

更新语句中没有子查询。这是怎么回事？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-09-29T15:19:56.187

很可能表上有一个触发器，并且错误发生在触发器中，而不是在您的实际 SQL 语句中。

我进一步打赌触发器假定插入或删除特殊表只会有一行（实际上在大规模更新中并非如此，就像您正在执行的那样），从而导致了问题。

# c# - Request.UrlReferrer 为空？

> ID：149130
> 
> 赞同：23
> 
> 时间：2008-09-29T15:18:11.933
> 
> 标签：c#, .net, visual-studio, visual-studio-2008

在 aspx C#.NET 页面（我正在运行框架 v3.5）中，我需要知道用户来自哪里，因为他们无法在不登录的情况下查看页面。如果我有页面`A`（用户想要查看的页面）重定向到页面`B`（登录页面），Request.UrlReferrer 对象为空。

背景：如果用户没有登录，我会重定向到登录页面（`B`在这种情况下）。登录后，我想将他们返回到他们在被迫登录之前请求的页面。

**更新：**
一个不错的快速解决方案似乎是：
`//if user not logged in Response.Redirect("..MyLoginPage.aspx?returnUrl=" + Request.ServerVariables["SCRIPT_NAME"]);`
然后，只需查看登录页面上的 QueryString，您强制他们进入并将用户放在成功登录后的位置。

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2008-09-29T15:24:44.523

UrlReferrer 基于浏览器*应*发送的[HTTP_REFERER标头。](http://en.wikipedia.org/wiki/Referer)但是，与留给客户的所有事情一样，它是可变的。

 *我知道一些“安全”套件（如 Norton 的 Internet Security）会去除该标题，相信它有助于跟踪用户行为。另外，我确信有一些 Firefox 扩展可以做同样的事情。

底线是你不应该相信它。只需将 url 附加到 GET 字符串并以此为基础进行重定向。

更新：正如评论中提到的，将 GET 参数的重定向限制为仅适用于无域的相对链接、拒绝目录模式 (../) 等可能是一个好主意。所以仍然要检查重定向；如果您遵循标准“不要盲目使用任何用户提供的输入”规则，您应该是安全的。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-09-29T15:22:07.040

如果你使用标准的 Membership 提供者，并且为目录/页面设置了 Authorization，代码会在成功登录后自动设置 ReturnUrl 的查询参数和重定向。

如果您不想使用成员资格提供程序模式，我建议您也手动执行查询字符串参数。HTTP 引荐来源网址不是很可靠。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-29T15:21:26.387

问题可能与您如何将用户重定向到其他页面有关。无论如何，引用 url 不是你应该作为绝对规则的东西 - 客户可以轻松地伪造它。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-29T15:24:32.260

您要查找的内容最好使用查询字符串变量（例如 returnURL 或 originURL）来完成。推荐人最适合用于数据挖掘操​​作，因为它非常不可靠。

例如，请参阅 ASP.Net 使用登录名进行重定向的方式。

# visual-studio-2008 - 有没有办法将 VS 的 CSS 验证更新到 3.0？

> ID：149131
> 
> 赞同：18
> 
> 时间：2008-09-29T15:18:55.923
> 
> 标签：visual-studio-2008, validation, css

我收到有关 CSS3.0 属性（如文本溢出）的警告。有没有办法针对 3.0 进行验证？

* * *

VS2010 在 SP1 中支持 HTML5 和 CSS3。

[http://blogs.msdn.com/b/webdevtools/archive/2011/01/27/html5-amp-css3-in-visual-studio-2010-sp1.aspx](http://blogs.msdn.com/b/webdevtools/archive/2011/01/27/html5-amp-css3-in-visual-studio-2010-sp1.aspx)

* * *

现在它在这里。

[http://visualstudiogallery.msdn.microsoft.com/7211bcac-091b-4a32-be2d-e797be0db210/view/Reviews/0?showReviewForm=True](http://visualstudiogallery.msdn.microsoft.com/7211bcac-091b-4a32-be2d-e797be0db210/view/Reviews/0?showReviewForm=True)

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-09-29T15:45:47.310

显然，您可以为 CSS 定义自己的 Visual Studio Intellisense 架构。我不确定 VS 是否会对此进行验证，或者仅将其用于代码完成。

可能值得做一个最小的，看看它是否被用于验证。

[Visual Studio 2005 和 2008 中的自定义 CSS Intellisense 架构](http://blogs.msdn.com/mikhailarkhipov/archive/2007/10/19/how-to-create-custom-css-intellisense-schema-in-visual-studio-2005-and-2008.aspx)

不过，我还不知道一种简单的方法来验证 CSS 3。CSS 3 是一个大型的模块化规范，尽管浏览器对某些属性提供了不错的支持，但其中大部分仍处于不断变化之中。

[http://www.w3.org/Style/CSS/current-work](http://www.w3.org/Style/CSS/current-work)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2010-12-03T18:06:05.460

要关闭 VS2008 中的验证，我必须转到工具 > 选项 > 文本编辑器 > CSS > CSS 特定并取消选中“检测错误”。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2011-06-16T16:36:04.600

试试这个：

[http://visualstudiogallery.msdn.microsoft.com/7211bcac-091b-4a32-be2d-e797be0db210/view/Reviews/0?showReviewForm=True](http://visualstudiogallery.msdn.microsoft.com/7211bcac-091b-4a32-be2d-e797be0db210/view/Reviews/0?showReviewForm=True)！

我刚刚将它安装在我的计算机上，并且在 Visual Studio 2010 sp1 上运行良好

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-29T15:48:05.167

我不相信。但是您可以根据需要关闭验证。转到工具 > 选项。展开文本编辑器 > HTML > 验证。此屏幕显示所有不同的验证目标。如果要关闭验证，请取消选中显示错误。

# sql - 如何在另一个存储过程中迭代存储过程结果......没有游标？

> ID：149132
> 
> 赞同：8
> 
> 时间：2008-09-29T15:19:20.697
> 
> 标签：sql, sql-server, sql-server-2005, tsql

我不确定这是否是我应该在 T-SQL 中做的事情，而且我很确定在这种情况下使用“迭代”这个词是错误的，因为你永远不应该在 sql 中迭代任何东西。它应该是基于集合的操作，对吗？无论如何，这是场景：

我有一个存储过程，它返回许多唯一标识符（单列结果）。这些 id 是另一个表中记录的主键。我需要在该表中的所有相应记录上设置一个标志。

如何在不使用游标的情况下做到这一点？对你来说应该是一个简单的 sql 大师！

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-09-29T15:22:59.517

这可能不是最有效的，但我会创建一个临时表来保存存储过程的结果，然后在与目标表的连接中使用它。例如：

```
CREATE TABLE #t (uniqueid int)
INSERT INTO #t EXEC p_YourStoredProc

UPDATE TargetTable 
SET a.FlagColumn = 1
FROM TargetTable a JOIN #t b 
    ON a.uniqueid = b.uniqueid

DROP TABLE #t 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-30T02:38:28.770

您还可以将存储过程更改为用户定义的函数，该函数返回带有您的唯一标识符的表。您可以直接加入 UDF 并将其视为一个表，从而避免显式创建额外的临时表。此外，您可以在调用函数时将参数传递给函数，这是一个非常灵活的解决方案。

```
CREATE FUNCTION dbo.udfGetUniqueIDs
()
RETURNS TABLE 
AS
RETURN 
(
    SELECT uniqueid FROM dbo.SomeWhere
)

GO

UPDATE dbo.TargetTable 
SET a.FlagColumn = 1
FROM dbo.TargetTable a INNER JOIN dbo.udfGetUniqueIDs() b 
    ON a.uniqueid = b.uniqueid 
```

**编辑：** 这将适用于 SQL Server 2000 及更高版本...

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-29T15:24:37.143

将存储过程的结果插入到临时表中，并将其连接到要更新的表中：

```
INSERT INTO #WorkTable
EXEC usp_WorkResults

UPDATE DataTable
  SET Flag = Whatever
FROM DataTable
INNER JOIN #WorkTable
  ON DataTable.Ket = #WorkTable.Key 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-29T15:28:07.477

使用临时表或表变量（您使用的是 SS2005）。

虽然，这不是可嵌套的 - 如果存储过程使用该方法，那么您不能将该输出转储到临时表中。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-29T15:31:29.013

如果您升级到 SQL 2008，那么我相信您可以传递表参数。否则，您将陷入全局临时表或创建包含某种进程 ID 列的永久表，以确定对存储过程的哪个调用是相关的。

您在更改生成 ID 的存储过程方面有多少空间？您可以在其中添加代码来处理它，或者有一个参数可以让您在调用时选择性地标记行。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2008-09-29T15:23:41.060

一个丑陋的解决方案是让您的过程在每次调用它时返回“下一个”id，方法是使用另一个表（或现有表上的某个标志）过滤掉它已经返回的行

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2008-09-29T15:28:15.137

您可以使用带有附加列的临时表或表变量：

```
DECLARE @MyTable TABLE (
    Column1 uniqueidentifer,
    ...,
    Checked bit
)

INSERT INTO @MyTable
SELECT [...], 0 FROM MyTable WHERE [...]

DECLARE @Continue bit
SET @Continue = 1
WHILE (@Continue)
BEGIN
    SELECT @var1 = Column1,
           @var2 = Column2,
           ...
    FROM @MyTable
    WHERE Checked = 1

    IF @var1 IS NULL
        SET @Continue = 0
    ELSE
    BEGIN

        ...

        UPDATE @MyTable SET Checked = 1 WHERE Column1 = @var1
    END
END 
```

编辑：实际上，在您的情况下，加入会更好；上面的代码是一个无光标迭代，这对你的情况来说是多余的。

# c - Unix/C 中的数据库独立性

> ID：149136
> 
> 赞同：2
> 
> 时间：2008-09-29T15:19:34.940
> 
> 标签：c, database, portability

我们有一个用 C 语言编写并在 Solaris 和 Linux 下运行的系统，它使用 Sybase CT 库来访问 Sybase 数据库。我们从内部开发的 DDL 生成表定义、索引、存储过程和 C 代码，以减少工作量和错误。

我们希望实现数据库独立性，因此我们可以添加（作为第一个开始）Oracle 支持。

我们正在考虑 ODBC 或 ESQL/C，但没有使用它们的经验。

您会建议什么解决方案（当然，最好是便宜且简单的解决方案）。是否有可能拥有单一来源的解决方案？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-29T15:34:36.090

我强烈推荐[SQLAPI++](http://www.sqlapi.com/)（可能有缺点，它是一个 C++ 库）。还有[unixODBC](http://www.unixodbc.org/)，尽管我从未在代码中使用过它——只是在研究可​​移植数据库 API 时才接触到它。POCO 还为数据库操作提供了一个统一的、可移植的 API（尽管还是在 C++ 中），但最后我检查了一下，[POCO](http://pocoproject.org/poco/info/index.html)的那部分只是处于开发的初始阶段。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-29T15:29:33.513

ODBC 将帮助您编写更便携的系统，但如果您希望利用底层数据库，则必须小心正确开发 SQL，因为 SQL 本身可能无法 100% 跨数据库移植，即使使用不同的 ODBC司机。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-29T15:32:01.570

iodbc [http://www.firstsql.com/iodbc/](http://www.firstsql.com/iodbc/)

或 unix odbc [http://www.unixodbc.org/](http://www.unixodbc.org/)

可能是“最便携”的选择之一。

问候弗里德里希

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-29T15:20:51.583

ODBC 将为您提供比 ESQL/C 更多的可移植性选项。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-29T15:27:27.870

我一直在使用[iODBC](http://www.iodbc.org)来访问 SQL Server 和 mysql，并且到目前为止取得了不错的效果。我认为它也适用于 Oracle，但这取决于 ODBC 驱动程序，到目前为止还没有尝试过。

# java - 将 JAR 文件中的动画 gif 加载到 ImageIcon

> ID：149153
> 
> 赞同：9
> 
> 时间：2008-09-29T15:23:12.653
> 
> 标签：java, swing, animated-gif, javax.imageio

我正在尝试从存储在 jar 文件中的动画 gif 创建一个 ImageIcon。

```
ImageIcon imageIcon = new ImageIcon(ImageIO.read(MyClass.class.getClassLoader().getResourceAsStream("animated.gif"))); 
```

图像加载，但仅加载动画 gif 的第一帧。动画不播放。

如果我从文件系统上的文件加载动画 gif，一切都会按预期工作。动画播放所有帧。所以这有效：

```
ImageIcon imageIcon = new ImageIcon("/path/on/filesystem/animated.gif"); 
```

如何从 jar 文件将动画 gif 加载到 ImageIcon 中？

编辑：这是一个完整的测试用例，为什么不显示动画？

```
import javax.imageio.ImageIO;
import javax.swing.*;

public class AnimationTest extends JFrame {

    public static void main(String[] args) {
        SwingUtilities.invokeLater(new Runnable() {
            public void run() {
                AnimationTest test = new AnimationTest();
                test.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
                test.setVisible(true);
            }
        });
    }

    public AnimationTest() {
        super();
        try {
            JLabel label = new JLabel();
            ImageIcon imageIcon = new ImageIcon(ImageIO.read(AnimationTest.class.getClassLoader().getResourceAsStream("animated.gif")));
            label.setIcon(imageIcon);
            imageIcon.setImageObserver(label);
            add(label);
            pack();
        } catch (Exception e) {
            e.printStackTrace();
        }
    }
} 
```

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2011-06-28T09:42:11.273

这从 inputStream 读取 gif 动画

```
InputStream in = ...;
Image image = Toolkit.getDefaultToolkit().createImage(org.apache.commons.io.IOUtils.toByteArray(in)); 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-09-29T15:28:52.280

你必须使用 getClass().getResource(imgName); 获取图像文件的 URL。从 Real 的 HowTo 中查看[本教程。](http://www.rgagnon.com/javadetails/java-0240.html)

编辑：加载图像后，您必须[设置 ImageObserver 属性](http://java.sun.com/javase/6/docs/api/javax/swing/ImageIcon.html#setImageObserver(java.awt.image.ImageObserver))才能运行动画。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2011-03-26T18:42:37.977

由于这个线程只是从一个与动画 GIF 几乎没有关系但被拖到 OT 的更新线程链接的，我想我会添加这个“对我有用”的微不足道的源。

```
import javax.swing.*;
import java.net.URL;

class AnimatedGifInLabel {

    public static void main(String[] args) throws Exception {
        final URL url = new URL("http://i.stack.imgur.com/OtTIY.gif");
        Runnable r = new Runnable() {
            public void run() {
                ImageIcon ii = new ImageIcon(url);
                JLabel label = new JLabel(ii);
                JOptionPane.showMessageDialog(null, label);
            }
        };
        SwingUtilities.invokeLater(r);
    }
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2013-03-01T20:43:03.507

希望这还为时不晚。

我设法通过这种方式在我的 JPanel 中获取了动画 gif：

```
private JPanel loadingPanel() {
    JPanel panel = new JPanel();
    BoxLayout layoutMgr = new BoxLayout(panel, BoxLayout.PAGE_AXIS);
    panel.setLayout(layoutMgr);

    ClassLoader cldr = this.getClass().getClassLoader();
    java.net.URL imageURL   = cldr.getResource("img/spinner.gif");
    ImageIcon imageIcon = new ImageIcon(imageURL);
    JLabel iconLabel = new JLabel();
    iconLabel.setIcon(imageIcon);
    imageIcon.setImageObserver(iconLabel);

    JLabel label = new JLabel("Loading...");
    panel.add(iconLabel);
    panel.add(label);
    return panel;
} 
```

这种方法的一些要点：
1\. 图像文件在 jar 内；
2、ImageIO.read()返回一个BufferedImage，不更新ImageObserver；
3\. 另一种查找捆绑在 jar 文件中的图像的方法是询问 Java 类加载器（加载程序的代码）来获取文件。它知道东西在哪里。

所以通过这样做，我能够在我的 JPanel 中获得我的动画 gif，它就像一个魅力。

# c# - C# 中多线程网络服务器的模式

> ID：149163
> 
> 赞同：11
> 
> 时间：2008-09-29T15:24:48.343
> 
> 标签：c#, multithreading, asynchronous, network-programming

有没有我可以遵循的模板/模式/指南来设计多线程服务器？通过我的谷歌搜索，我在网上找不到任何非常有用的东西。

我的程序将使用 TcpListener 启动一个线程来监听连接。每个客户端连接都将由它自己的 IClientHandler 线程处理。服务器会将 clientHandler.HandleClient 包装在一个委托中，调用 BeginInvoke，然后不再关心它。

我还需要能够干净地关闭监听线程，这是我在网上找不到很多例子的东西。

我假设 lock/AutoResetEvents/threading 魔术与 async BeginAceptTcpClient 和 EndAcceptTcpClient 的结合将使我到达那里，但是当涉及到网络代码时，对我来说一切都已经完成了。所以我必须相信我可以遵循一些模式，而不会被无数多线程的极端案例完全混淆，我似乎永远无法做到完美。

谢谢。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-09-29T15:38:38.013

奇怪的是，您可能会在计算机科学作业[**CSC 512 Programming Assignment 4: Multi-Threaded Server With Patterns**](http://homepage.cs.uri.edu/courses/attic/csc512/assn3.html)中找到一些东西。虽然它是 C++ 巫术，但对于可以使用 C# 的人来说，这个理论是完全可以理解的。

*   [接受器/连接器](http://www.cs.wustl.edu/~schmidt/PDF/Acc-Con.pdf)
*   [监控对象](http://www.cs.wustl.edu/~schmidt/PDF/monitor.pdf)
*   [线程安全接口](http://www.cs.wustl.edu/~schmidt/PDF/dispatching.pdf)
*   [包装外观](http://www.cs.wustl.edu/~schmidt/PDF/wrapper-facade.pdf)
*   [范围锁定](http://www.cs.wustl.edu/~schmidt/PDF/dispatching.pdf)
*   [战略锁定](http://www.cs.wustl.edu/~schmidt/PDF/locking-patterns.pdf)
*   [反应堆](http://www.cs.wustl.edu/~schmidt/PDF/reactor-siemens.pdf)
*   [半同步/半异步](http://www.cs.wustl.edu/~schmidt/PDF/PLoP-95.pdf)
*   [领导者/追随者](http://www.cs.wustl.edu/~schmidt/PDF/lf.pdf)

[尽管您可以在主页](http://homepage.cs.uri.edu/courses/attic/csc512/)上获得完整的好读物列表。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-29T16:50:05.003

看一下之前的这个问题：

[如何最小化 tcp 服务器应用程序中使用的线程数？](https://stackoverflow.com/questions/32198/how-do-you-minimize-the-number-of-threads-used-in-a-tcp-server-application)

它不是严格的 C# 特定的，但它有一些很好的建议。

# windows - 如何限制 Microsoft Windows 中正在运行的进程的最大数量？

> ID：149189
> 
> 赞同：2
> 
> 时间：2008-09-29T15:30:37.487
> 
> 标签：windows, process, registry

我正在寻找一种方法来限制 Windows Server 2003 中运行的最大进程数。

某处是否有控制它的注册表项？如果是这样，它是哪一个？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-29T15:35:24.013

如果您正在谈论任务管理器中列出的项目中的流程，那么本机无法做到这一点，您可以使用程序来做到这一点，***但应该没有真正的正当理由这样做。***

如果您正在谈论使您的应用程序无论被调用多少次都只启动一个 EXE，那么您正在寻找单例。.NET 示例，网址为：[http](http://www.thescarms.com/dotnet/SingleInstance.aspx) ://www.thescarms.com/dotnet/SingleInstance.aspx --EDIT 对于另一种语言，请在谷歌搜索“singleton”和您的语言。

如果您要问其他问题，请详细说明。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-29T15:51:44.333

国内零售Windows没有限制进程数量的内在方式（除了耗尽可用资源）

Windows Starter Editions 使用 Windows Starter ed 的修改版本实现了进程上限。但是，仅在新兴市场中可用。

# powershell - PowerShell 函数返回行为

> ID：149191
> 
> 赞同：17
> 
> 时间：2008-09-29T15:30:53.073
> 
> 标签：powershell

我在 PowerShell 中看到了一些相当奇怪的行为，看起来自定义函数可能需要一个“括号包装器”来评估，如您所期望的那样。给定一个简单的 PowerShell 函数：

```
function Return-True { return $true } 
```

然后是一些示例代码来调用它：

```
PS C:\> Return-True
True
PS C:\> Return-True -eq $false
True
PS C:\> (Return-True) -eq $false
False 
```

想法？评论？

* * *

## 回答 #1

> 赞同：35
> 
> 时间：2008-09-29T16:03:28.703

当 PowerShell 看到令牌`Return-True`时，它会将其标识为命令，并且在评估或语句结束之前，其他所有内容都是传递给函数的参数`Return-True`。

如果您这样做，您可以看到这一点：

```
PS > function Return-True { "The arguments are: $args"; return $true }
PS > Return-True -eq $false
The arguments are: -eq False
True 
```

这就是为什么以下所有内容都返回“True”的原因，因为您所看到的只是`Return-True`使用各种参数调用的结果：

```
PS > Return-True -eq $false
True
PS > Return-True -ne $false
True
PS > Return-True -eq $true
True
PS > Return-True -ne $true
True 
```

使用`(Return-True)`强制 PowerShell 评估函数（不带参数）。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-29T16:03:13.477

第二行不进行布尔评估。看看如果你对字符串做同样的事情会发生什么。

```
PS C:\> function Return-True { return "True string" }
PS C:\> Return-True
True string
PS C:\> Return-True -eq "False string"
True string
PS C:\> (Return-True) -eq "False string"
False 
```

第二行只是简单地返回函数的值，而不是进行比较。我不确定为什么会发生这种行为，但它比使用转换为字符串“True”和“False”的布尔值更容易看到这种行为。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-06-05T19:09:32.803

如果您使用 PowerShell V2 的编辑器，您会看到第一个示例中的 -eq 是蓝色的，因为它是一个参数，而第二个示例中的 -eq 是灰色的，因为它是一个运算符

同样在 V2 中，您可以使用 CmdletBinding 和 param 严格控制参数

```
function Return-True
{
    [CmdletBinding()]
    param()
    return $true
}
Return-True -eq $false

Return-True -eq $false
Return-True : A parameter cannot be found that matches parameter name 'eq'.
At line:7 char:16
+ Return-True -eq <<<<  $false
    + CategoryInfo          : InvalidArgument: (:) [Return-True], ParameterBindingException
    + FullyQualifiedErrorId : NamedParameterNotFound,Return-True 
```

# backup - webapps的理智备份策略

> ID：149195
> 
> 赞同：2
> 
> 时间：2008-09-29T15:31:50.900
> 
> 标签：backup, web-applications

我正在做一个 webapp，需要一个备份计划。这是我到目前为止所得到的：

*   将 SQL 数据库每晚加密备份到 Amazon S3 和我的外部驱动器（如果可能，增量备份，对 PostgreSQL 还不太熟悉，但那是另一个线程）
*   每晚将我的 Mercurial 存储库（包括 Apache 配置、部署脚本等）备份到 S3（通过 Time Machine 进行本地备份）

我应该添加其他任何内容，还是会涵盖它？为了衡量数据的重要性/将是多么重要，它是一个类似于 Basecamp 的项目管理应用程序。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-29T15:34:45.637

每周对您的数据库进行完整备份以及每晚进行增量备份吗？

这意味着如果您的一个旧增量备份损坏，那么您丢失的数据不到一周。

此外，请确保您有一个备份测试计划，以确保您的备份正常工作。有很多关于这方面的恐怖故事，来自那些多年来一直在做备份的公司，从未测试过它们，然后在需要它们时发现它们都没有任何用处。（我也曾在这样的公司工作过。谢天谢地，我发现备份在需要并解决问题之前无法正常工作）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-29T15:52:23.707

过去对我有用的最佳策略之一是让“备份”过程与安装过程相同，即我们在 linux 中完全编写了服务器配置、应用程序创建、数据库设置等脚本，因此安装看起来像：

./install.sh [服务器] [应用程序名称] 和备份/恢复 ./install [服务器] [应用程序名称] -database [数据库备份文件]

在备份方面，数据库完全备份（MySQL 数据库），由 cronjob

这几乎确保了每次部署新实例时都会测试恢复，并且脚本最终也被用于在需要更换硬件或给定服务器从客户那里获得过多负载时移动实例。

这是我几年前工作的一个 Saas 企业应用程序的设置，因此我们可以完全控制服务器。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-01T19:23:07.707

如果您可以从增量备份更改为差异备份，我会的。如果您有增量备份，则必须应用每周完整备份，然后再应用每个增量备份。如果您的一个增量在本周早些时候失败，那么您所有后续备份也将失败。

但是，如果您使用差异，则每个差异都包含自上次备份以来的所有更改。因此，即使其中一个备份在本周早些时候失败，如果您最近的备份成功，您仍然可以完全恢复。

我希望我能很好地解释这一点！

:)

# git - 我可以使用 SVN 或 Mercurial 只提交部分代码吗？

> ID：149198
> 
> 赞同：37
> 
> 时间：2008-09-29T15:32:10.557
> 
> 标签：git, svn, version-control, mercurial, tortoisesvn

我通常使用 Tortoise SVN，但我一直在研究 Mercurial，因为它是一个分布式修订控制系统。

在这两个系统中，我正在寻找的是一种工具，它可以让我只选择文件的一部分并提交它们。如果我现在想这样做，我必须复制到文件的临时版本并只保留我想在当前版本中提交的更改，然后在提交后再次将临时版本复制到当前版本。真是太麻烦了，程序应该可以为我做到这一点。

我听说 Git 支持这一点，请让我知道这是否正确。

* * *

## 回答 #1

> 赞同：40
> 
> 时间：2008-09-29T15:43:48.423

Mercurial 可以通过[记录](https://www.mercurial-scm.org/wiki/RecordExtension)扩展来做到这一点。

它会提示您输入每个文件和每个差异块。例如：

```
% hg record
diff --git a/prelim.tex b/prelim.tex
2 hunks, 4 lines changed
examine changes to 'prelim.tex'? [Ynsfdaq?]  
@@ -12,7 +12,7 @@
 \setmonofont[Scale=0.88]{Consolas}
 % missing from xunicode.sty
 \DeclareUTFcomposite[\UTFencname]{x00ED}{\'}{\i}
-\else
+\else foo
 \usepackage[pdftex]{graphicx}
 \fi

record this change to 'prelim.tex'? [Ynsfdaq?]  
@@ -1281,3 +1281,5 @@
 %% Local variables:
 %% mode: latex
 %% End:
+
+foo
\ No newline at end of file
record this change to 'prelim.tex'? [Ynsfdaq?]  n
Waiting for Emacs... 
```

提交后，剩余的差异将被留下：

```
% hg di
diff --git a/prelim.tex b/prelim.tex
--- a/prelim.tex
+++ b/prelim.tex
@@ -1281,3 +1281,5 @@
 %% Local variables:
 %% mode: latex
 %% End:
+
+foo
\ No newline at end of file 
```

或者，您可能会发现使用 MQ（Mercurial Queues）将存储库中的各个更改分成补丁更容易。也有记录的 MQ 变体 (qrecord)。

**更新：**还可以尝试[crecord](http://bitbucket.org/edgimar/crecord/wiki/Home)扩展，它提供了一个curses接口来选择大块/行。

![录音截图](https://i.stack.imgur.com/wRcie.png)

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-09-30T04:43:01.887

是的，git 允许你这样做。该`git add`命令有一个`-p`（或`--patch`）选项，可让您逐个查看更改，选择要暂存的内容（您还可以细化这些块或编辑补丁）。您还可以使用交互模式来 git-add ( `git add -i`) 并使用“p”选项。

这是一个[交互式添加的截屏视频](http://gitcasts.com/posts/interactive-adding)，它还演示了`git add`.

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2010-03-01T16:57:46.587

查看 TortoiseHG，它将进行大块选择，并让您将不同的更改提交到一个文件，以进行不同的提交。

它甚至可以让您在一次提交中提交对某些文件的所有更改以及对其他文件的部分更改。

[http://tortoisehg.bitbucket.io/](http://tortoisehg.bitbucket.io/)

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-09-29T22:41:43.690

不久前我问了一个[类似](https://stackoverflow.com/questions/125272/using-mercurial-whats-the-easiest-way-to-commit-and-push-a-single-file-while-le)的问题，使用[hgshelve 扩展](https://www.mercurial-scm.org/wiki/ShelveExtension)得到的答案正是我想要的。

在进行提交之前，您可以将来自不同文件的更改（或文件中的大量更改）放在“架子”上，然后提交您想要的内容。然后您可以取消搁置您未提交的更改并继续工作。

过去几天我一直在使用它，并且非常喜欢它。非常易于可视化和使用。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2017-09-07T17:19:14.390

Mercurial 现在为该命令提供了一个选项`--interactive`（或`-i`）`commit`，它可以直接启用此功能。

这直接从命令行工作，因此如果您是命令行爱好者，它是完美的！

跑步

```
> hg commit -i 
```

开始一个交互式会话，允许检查、编辑和记录单个更改以创建提交。

这与and命令的`--patch`and`--interactive`选项非常相似。`git add``git commit`

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-29T15:46:10.383

我建议不要这样工作。

如果您必须进行更改集，设置已准备好签入的设置 A 和尚未准备好的设置 B，您如何确定仅签入设置 A 不会破坏您的构建/测试？你可能会错过一些行，忘记不同文件中的行，或者没有意识到 A 对 B 的依赖会破坏其他人的构建。

您的提交应该是谨慎的原子更改，不会破坏您*或*您团队中的其他人的构建。如果您部分提交文件，您将大大增加您在不知情的情况下为其他人破坏构建的机会，直到您有一些不高兴的同事敲门。

最大的问题是，为什么你觉得有必要以这种方式工作？

# asp.net - 我们可以使用 Forms Authentication 在另一个应用程序中创建一个具有自己的 Web.config 和 Forms Authentication 部分的应用程序吗？

> ID：149200
> 
> 赞同：0
> 
> 时间：2008-09-29T15:32:23.723
> 
> 标签：asp.net, .net, forms-authentication

我有一个使用表单身份验证来验证一种用户类型的应用程序。此应用程序中有一个部分需要使用数据库中的不同表为另一种类型的用户进行身份验证。如果第二种用户的会话超时，则会出现问题，她会被带到主 Web.Config 的 Forms Authentication 部分中定义的登录页面，而不是第二种用户的登录页面。我正在寻找解决这个问题的方法。一个想法是在 IIS 中为该部分创建一个应用程序，并为该文件夹创建一个 Web.Config 并添加另一个 Forms Authentication 部分。在我的实验中，这似乎不起作用。我错过了一些明显的东西吗？有什么见解吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-29T15:38:22.150

IIRC，身份验证适用于每个文件夹。因此，如果需要第二种身份验证的所有页面都位于具有自己配置的特定子文件夹中，您应该能够做到这一点。

不过，这不是 100% 确定的，所以如果有更多知识渊博的人可以反驳我，我会删除回复。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-29T15:41:51.627

您可能需要仔细检查我的语法，但顶级 web.config 可以有任意数量的标签。

```
<location>...</location> 
```

在里面你可以为你想要的任何文件夹/文件指定单独的配置参数。[在这里](http://www.dotnetcoders.com/web/Articles/ShowArticle.aspx?article=186)寻找参考。

编辑：道歉，我忽略了正确格式化代码

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-29T18:27:17.530

<location> 标记内不能有 <authentication> 部分，因此必须将子文件夹设置为它自己的 IIS（和 ASP.NET）应用程序。因此，您应该能够自行运行该小节。

我认为 500.19 是“无法读取或解析 web.config”错误 - 它有详细信息吗？您可能需要打开远程错误（或检查事件查看器）才能看到它们。如果您仍然遇到问题，请发布 web.config 的片段。

顺便说一句 - 我从来都不是嵌套应用程序的粉丝，并且可能更喜欢让您的普通 Login.aspx 页面作为 MemberOf 或重定向到 SpecialUserLogin.aspx 或其他东西来处理它。嵌套应用程序是一个用于设置和测试 IME 的 PITA（例如 - 我认为你甚至不能让它在 Cassini 下工作 - 尽管你可以为它做 2 个单独的项目，并在部署时组合起来）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-29T18:41:38.137

是的你可以。Web.config 文件具有具有覆盖功能的树状继承架构。这意味着您可以通过在其中放置 web.config 文件并指定不同的配置设置来修改子文件夹中的设置。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-29T19:08:00.180

我理解这个问题的方式，你有两个解决方案，第一个是查看角色，整个[提供者模型](http://msdn.microsoft.com/en-us/library/aa479030.aspx)将是一个很好的起点。否则，最好的办法是将应用程序分成两部分，拆分第二个用户类型区域，然后通过虚拟目录将其包含回主项目中。请记住，虚拟目录从父目录 web.config 继承其权限，因此您需要使用`<Location>`标签来删除虚拟目录的身份验证，然后在虚拟目录 web.config 中定义您的新表单身份验证。如果您需要在窗体身份验证下进行 Windows 身份验证 (NTLM)，这将非常有效。

# javascript - 确定 Flex 中是否存在 XML 属性的最佳方法

> ID：149206
> 
> 赞同：9
> 
> 时间：2008-09-29T15:32:59.713
> 
> 标签：javascript, apache-flex, actionscript-3

我有一个来自 HTTPService 调用的 XML 响应，其结果格式为 e4x。

```
 <?xml version="1.0" encoding="utf-8"?>
<Validation Error="Invalid Username/Password Combination" /> 

```

我努力了：

```
 private function callback(event:ResultEvent):void {
    if(event.result..@Error) {
        // error attr present
    }
    else {
        // error attr not present
    }
} 

```

这似乎不起作用（它总是认为错误属性退出）最好的方法是什么？谢谢。

**编辑：**我还尝试将属性与 null 和空字符串进行比较，但没有成功...

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-09-29T17:37:51.753

您已经找到了最好的方法：

```
event.result.attribute("Error").length() > 0 
```

`attribute`如果您不知道属性是否存在，该方法是检索属性的首选方法。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-09T17:13:56.730

我喜欢这种方法，因为 a.) 它非常简单，b.) Ely Greenfield 使用它。;)

```
if("@property" in node){//do something} 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-29T19:11:00.033

您可以通过以下方式进行检查：

```
if (undefined == event.result.@Error) 
```

或动态

```
if (undefined == event.result.@[attributeName]) 
```

请注意，在您的示例中，这两个点将检索所有级别的所有后代，因此您将获得一个列表作为结果。如果没有错误属性，您将得到一个空列表。这就是为什么它永远不会等于 null。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-29T15:51:00.917

假设在您的示例`event.result`中是一个`XML`对象，其内容与您发布的完全一样，这应该可以工作（因为 Validation 标记是 XML 的根标记）：

```
var error:String = event.result.@Error;
if (error != "")
    // error
else
    // no error 
```

上面的示例将假定`Error`具有空值的现有属性应被视为“无错误”情况，因此，如果您想知道该属性是否*实际*存在，您应该这样做：

```
if (event.result.hasOwnProperty("@Error"))
    // error
else
    // no error 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2013-06-13T12:14:52.667

我喜欢使用以下语法进行检查，因为它易于阅读，输入更少，并且几乎是最快的方法：

```
if ("@style" in item) // do something 
```

当您事先不知道该属性的名称时，要将值分配回该属性，请使用以下`attribute`方法：

```
var attributeName:String = "style";
var attributeWithAtSign:String = "@" + attributeName;
var item:XML = <item style="value"/>;
var itemNoAttribute:XML = <item />;

if (attributeWithAtSign in itemNoAttribute) {
    trace("should not be here if attribute is not on the xml");
}
else {
    trace(attributeName + " not found in " + itemNoAttribute);
}

if (attributeWithAtSign in item) {
    item.attribute(attributeName)[0] = "a new value";
} 
```

* * *

以下所有方法都是测试从该问题列出的答案中收集的属性是否存在。由于有这么多，我在 11.7.0.225 调试播放器中运行每个。右边的值是使用的方法。左边的值是运行代码一百万次所需的最低时间（以毫秒为单位）。结果如下：

```
807    item.hasOwnProperty("@style")
824    "@style" in item
1756   item.@style[0]
2166   (undefined != item.@["style"])
2431   (undefined != item["@style"])
3050   XML(item).attribute("style").length()>0 
```

性能测试代码：

```
var item:XML = <item value="value"/>;
var attExists:Boolean;
var million:int = 1000000;
var time:int = getTimer();

for (var j:int;j<million;j++) {
    attExists = XML(item).attribute("style").length()>0;
    attExists = XML(item).attribute("value").length()>0;
}

var test1:int = getTimer() - time; // 3242 3050 3759 3075

time = getTimer();

for (var j:int=0;j<million;j++) {
    attExists = "@style" in item;
    attExists = "@value" in item;
}

var test2:int = getTimer() - time; // 1089 852 991 824

time = getTimer();

for (var j:int=0;j<million;j++) {
    attExists = (undefined != item.@["style"]);
    attExists = (undefined != item.@["value"]);
}

var test3:int = getTimer() - time; // 2371 2413 2790 2166

time = getTimer();

for (var j:int=0;j<million;j++) {
    attExists = (undefined != item["@style"]);
    attExists = (undefined != item["@value"]);
}

var test3_1:int = getTimer() - time; // 2662 3287 2941 2431

time = getTimer();

for (var j:int=0;j<million;j++) {
    attExists = item.hasOwnProperty("@style");
    attExists = item.hasOwnProperty("@value");
}

var test4:int = getTimer() - time; // 900 946 960 807

time = getTimer();

for (var j:int=0;j<million;j++) {
    attExists = item.@style[0];
    attExists = item.@value[0];
}

var test5:int = getTimer() - time; // 1838 1756 1756 1775 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-29T15:47:15.093

我已经想出了一个解决方案，如果有更好的方法来做到这一点，我仍然很感兴趣......

这将起作用：

```
 private function callback(event:ResultEvent):void {
    if(event.result.attribute("Error").length()) {
        // error attr present
    }
    else {
        // error attr not present
    }
} 

```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-10-25T22:05:01.933

干得好：

```
if(event.result.@error[0]){
    //exists 
} 
```

容易吧？:)

# delphi - GUI 的 AVI 动画

> ID：149210
> 
> 赞同：2
> 
> 时间：2008-09-29T15:34:24.997
> 
> 标签：delphi, user-interface, animation, vcl, avi

我需要获取一些用于 Borland VCL TAnimate 组件的 AVI 动画，以便在“在线更新”、“刻录 cd”等操作期间显示。

到目前为止，我只遇到过[glyFX 动画包](http://www.glyfx.com/shop/detail/animationpack/)。

有人可以推荐其他地方来获得漂亮的 avi 动画吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-02T10:24:55.387

您可以考虑使用 GIF 动画而不是 AVI。网上有很多。还有一些免费的 Delphi 组件与动画 GIF 一起使用，例如[Delphi 的 TGIFImage](http://melander.dk/delphi/gifimage/)。

# c# - 确定可用带宽

> ID：149211
> 
> 赞同：1
> 
> 时间：2008-09-29T15:34:26.760
> 
> 标签：c#, .net

确定 .NET 中可用带宽的最佳方法是什么？

我们的用户从各种远程接入点（有线和无线）访问业务应用程序，有时带宽可能非常低，具体取决于用户所在的位置。当应用程序似乎运行缓慢时，问题可能是由于带宽低而不是其他问题。

我希望能够运行某种服务，该服务会在可用带宽低于特定阈值时向用户发出警告。

有什么想法吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-29T15:38:11.150

不超出下载已知大小的文件和确定需要多长时间的时间。这样做的缺点是您需要浪费大量带宽才能做到这一点。此外，如果您想在吞吐量降至阈值以下时发出警报，则必须或多或少地连续运行测试。

恕我直言，我会在某些地方表现不佳，因为如果它确实发生了，你将无能为力。

对不起。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-29T15:40:20.927

没有实际使用带宽就没有简单的方法来测量带宽——这当然会使应用程序挨饿。不过要记住几点：

1）实际上是带宽问题还是延迟？您可以以比带宽更少干扰的方式测量延迟。

2) 应用程序是否都从同一服务器（或至少同一网络）运行？您可能会发现用户将与网络的某些区域建立良好的连接，但其他区域则不然。（最后一英里可能会成为限制因素，但并非*总是*如此。）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-29T15:39:08.013

如果您正在传输数据，只需对其进行测量。如果你想让它独立于你的服务器的速度，你也可以从某个地方下载一个引用对象。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-29T18:04:51.813

在不知道您的连接的确切性质或其使用方式的情况下，我知道有两个选项。

MultinetGetConnectionPerformance ( [http://msdn.microsoft.com/en-us/library/aa385342(VS.85).aspx](http://msdn.microsoft.com/en-us/library/aa385342(VS.85).aspx) )

系统事件通知服务 ( [http://msdn.microsoft.com/en-us/library/aa377538(VS.85).aspx](http://msdn.microsoft.com/en-us/library/aa377538(VS.85).aspx) )

两者都不是直接的 .NET 类，但可以很容易地在 .NET 中实现。

看看他们两个，看看他们是否适合你。

罗伊

# sql-server - 什么是假设指标？

> ID：149213
> 
> 赞同：6
> 
> 时间：2008-09-29T15:34:36.027
> 
> 标签：sql-server, indexing

有人知道 sql server 2000 中使用了哪些假设索引吗？我有一个包含 15 多个此类索引的表，但不知道它们是为什么而创建的。他们可以减慢删除/插入的速度吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-29T15:40:22.427

假设索引通常是在您运行索引调整向导时创建的，并且是建议，在正常情况下，如果向导运行正常，它们将被删除。

如果留下一些可能会导致一些问题，请参阅[此链接以了解删除它们的方法](http://msdn.microsoft.com/en-us/library/ms190172(SQL.90).aspx)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-29T15:36:49.797

不确定 2000 年，但 2005 年的假设索引和数据库对象通常是由**DTA（数据库优化顾问）创建的对象**

您可以通过运行以下查询来检查索引是否是假设的：

```
SELECT  *
FROM    sys.indexes
WHERE   is_hypothetical = 1 
```

如果您已向调优顾问提供了作为其索引策略基础的良好信息，那么我会说通常信任其结果，但如果您当然应该在盲目信任它之前检查它是如何分配这些结果的。每种情况都会有所不同。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-29T15:38:59.917

谷歌搜索“sql server 假设索引”返回[以下文章](http://weblogs.sqlteam.com/mladenp/archive/2007/07/16/60257.aspx)作为第一个结果。引用：

> 假设的索引和数据库对象通常只是由 DTA（数据库优化顾问）创建的对象

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-29T15:37:02.510

假设索引是由 Database Tuning Advisor 生成的索引。一般来说，索引过多并不是一个好主意，您应该检查您的查询计划以修剪那些未使用的索引。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2019-06-29T20:59:02.880

从[sys.indexes](https://docs.microsoft.com/en-us/sql/relational-databases/system-catalog-views/sys-indexes-transact-sql?view=sql-server-2017)：

```
is_hypothetical     bit     

1 = Index is hypothetical and cannot be used directly as a data access path. 
    Hypothetical indexes hold column-level statistics.

0 = Index is not hypothetical. 
```

它们也可以使用 undocumented 手动创建`WITH STATISTICS_ONLY`：

```
CREATE TABLE tab(id INT PRIMARY KEY, i INT);

CREATE INDEX MyHypIndex ON tab(i) WITH STATISTICS_ONLY = 0;
/* 0 - withoud statistics -1 - generate statistics */

SELECT name, is_hypothetical
FROM sys.indexes
WHERE object_id = OBJECT_ID('tab'); 
```

**[db<>小提琴演示](https://dbfiddle.uk/?rdbms=sqlserver_2017&fiddle=10881f0bdb88e4e805c26913aa5d100c)**

# asp.net - 如何在页面加载之前移动 asp.net/ajax 控件？

> ID：149227
> 
> 赞同：1
> 
> 时间：2008-09-29T15:37:23.680
> 
> 标签：asp.net, asp.net-ajax

我有一个面板控件，我需要在回发中保持位置。我可以通过维护一个 cookie 来做到这一点，每次加载页面时都会读取该 cookie，以便在页面加载之前获取面板的位置。

问题是，页面被加载，然后重新定位，这会导致控件在其默认位置的短暂闪烁，并跳转到回发之前的位置。

有没有办法防止这种情况？我希望控件首先移动到它的位置，然后显示它以防止这种“闪光”。

*编辑：我正在添加一个 DragPanel ajax 控件扩展器来重新定位它。我有一个被调用的 pageLoad，并且在调用 pageLoad 后面板被重新定位。必须有一个非常简单的解决方案。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-29T15:45:31.243

您能否在 ASP.NET 客户端库的 pageLoad 事件中注册定位面板的函数？

此链接可能会有所帮助：[ASP.NET AJAX 客户端生命周期事件](http://asp.net/AJAX/Documentation/Live/overview/AJAXClientEvents.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-29T16:00:43.000

因为您将面板的位置存储在 cookie 中，所以您可以在服务器端回发事件期间更新面板的位置。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-03T20:25:31.053

由于您已经有了在 pageLoad 期间重新定位面板的代码，因此您可以在服务器端添加代码以在 IsPostback 时隐藏面板。

在 pageLoad 上，您需要在重新定位后的面板之后添加步骤来设置 panel.style.display=''。

# c# - 在 C# 中合并大文件

> ID：149233
> 
> 赞同：1
> 
> 时间：2008-09-29T15:38:08.030
> 
> 标签：c#

我有 7-8 个 xml 文件。每个大小约为 50 MB。在 C# 中以编程方式合并文件而不会出现 System.OutOfMemory 异常的最佳方法是什么？到目前为止，我已经尝试读取 StringBuilder 中的每个文件，而不是将其放入字符串构建器的数组中，但我仍然得到 system.outofmemoery 异常。有什么帮助吗？？谢谢你，-尼梅什

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-29T15:39:37.387

关于 stringbuilder 的事情是您仍在尝试将全部内容保存在内存中。您一次只想在内存中保留一小部分，这意味着使用文件流。不要将整个文件读入内存，在其上打开一个流并继续从流中读取。

xml 的问题在于您不能只是将它们附加到彼此：您将破坏标签嵌套。因此，您需要了解 xml 文件的结构，以便了解在每个文件边界处要做什么。

如果您有一些理论上可以与 StringBuilder 一起使用，但由于内存限制而在实践中失败的东西，您应该能够将 StringBuilder 的 .Append() 和 .AppendLine() 方法调用转换为 .Write() 和 .WriteLine()要求文件流。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-29T15:44:43.257

您需要合并的细节确实至关重要。但是，首先：您可能需要一个 XmlReader 用于每个输入文件，一个 XmlWriter 用于输出文件。这将让您流式传输输入和输出。

另一种选择是使用从 LINQ 到 XML 的 XStreamingElement。我没有这方面的任何经验，但它很可能是一个更简单的 API 使用。（LINQ to XML 的其余部分肯定比 DOM API 更好。）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-29T15:43:38.877

请定义“合并”。

如果您只想连接文件，请使用 StreamReader，并逐行读取。

如果您想实际生成一个新的有效 xml，请使用 XmlTextReader。它不会读取内存中的整个文件。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-29T16:05:49.103

就个人而言，当我*必须*处理 XML 文件时（通常是受到身体暴力的威胁），我会这样做：

1.  通过 DataSet.ReadXML() 将每个文件加载到 .NET 数据集中
2.  组合信息（通过 DataSet 查询）。
3.  通过 DataSet.WriteXML() 将组合的 DataSet 写入 XML

然后我积极地删除原始 XML 文件并擦除磁盘上存在的扇区以消除污点。:-)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-29T15:40:21.380

这取决于您所说的合并是什么意思，因为您尚未发布有关架构的任何信息。

在单个集合中同类简单元素的最简单情况下，您只需直接合并到磁盘上的新文件，避免大量内存工作，确保剥离外部包含的元素并添加到集合周围。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-29T15:43:14.523

不确定在这种情况下合并是什么意思。您是指文件的简单连接，还是检查内容？

例如，

文件1.xml

```
<items>
    <item id="1">
        <name>Widget</name>
    </item>
    <item id="2">
        <name>Widget 2</name>
    </item>
</items> 
```

文件2.xml

```
<items>
    <item id="3">
        <name>Widget</name>
    </item>
    <item id="4">
        <name>Widget 2</name>
    </item>
</items> 
```

可以组合为

```
<items>
    <item id="1">
        <name>Widget</name>
    </item>
    <item id="2">
        <name>Widget 2</name>
    </item>
</items>
<items>
    <item id="3">
        <name>Widget</name>
    </item>
    <item id="4">
        <name>Widget 2</name>
    </item>
</items> 
```

这是非常微不足道的，或者作为

```
<items>
    <item id="1">
        <name>Widget</name>
    </item>
    <item id="2">
        <name>Widget 2</name>
    </item>
    <item id="3">
        <name>Widget</name>
    </item>
    <item id="4">
        <name>Widget 2</name>
    </item>
</items> 
```

考虑到您正在谈论的数据量，情况并非如此。你是什​​么意思？

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-29T15:53:51.923

通过调用“copy a.xml + b.xml”命令或调用“copy”命令使用的 windows 文件系统 API 将它们合并到文件系统中。

# .htaccess - 使用 .htaccess 编辑 php.ini

> ID：149236
> 
> 赞同：1
> 
> 时间：2008-09-29T15:38:26.970
> 
> 标签：.htaccess, php

我正在慢慢回到 PHP，现在我遇到了一个问题，我想在我们的主机上安装一些 Web 软件，我需要在服务器上安装最新的 Zend（他们没有）或 IonCube 并且IonCube 要求在 php.ini 中启用 enable_dl。现在我的一位同事认为我可以通过服务器上的 .htaccess 文件来更新它。所以我在我的机器上创建了一个 s.htaccess，因为 Windows 不喜欢文件扩展名之前的空白。所以我在上传的文件中添加了行 php_flag enable_dl On 并将文件重命名为服务器上的 .htaccess 。当我刷新文件时，当我将其保留为 s.htaccess 时它很好，但我的 php 信息仍然显示为关闭。

我犯了什么n00b错误？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-29T15:41:12.610

[文档](http://www.php.net/manual/en/info.configuration.php)说这只能在 php.ini 中设置（不能在 .htaccess 中）。您可以通过查看显示“PHP_INI_SYSTEM”的表格来了解这一点，这意味着 - “可以在 php.ini 或 httpd.conf 中设置条目”。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-29T15:42:29.020

Unix 隐藏文件的方法是在它前面加上一个点。该文件在那里，但它只是被隐藏了。您的 ftp 软件应该有显示隐藏文件的设置。IIRC，您可以在 Windows 中通过 cmd 将文件重命名为 .htaccess。.htaccess 仅在当前目录和子目录中有效。这也可能是（出于安全原因）只能通过 php.ini 设置的设置之一

# delphi - Delphi 中的 Not Nil 快捷方式

> ID：149262
> 
> 赞同：7
> 
> 时间：2008-09-29T15:43:03.293
> 
> 标签：delphi

什么delphi函数断言一个对象不是零？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-09-29T15:58:13.397

就像上面指出的 knight_killer 一样，您使用该`Assert()`函数，断言`Assigned(obj)`是`true`. 当然，与大多数编译语言一样，除非您专门启用了断言，否则*不会*执行断言（甚至不会包含在编译器输出中），因此您不应依赖断言进行发布模式构建。

当然，您可以简单地检查`nil`, a la `Assert(obj <> nil)`。但是，`Assigned()`产生完全相同的编译器输出，并具有额外的好处，它也适用于指向类方法的指针（实际上是一对指针，一个指向方法，另一个指向类实例），所以`Assigned()`使用养成好习惯。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-09-29T15:48:03.000

不知道你的意思，但`Assert(Assigned(MyObject));`很短且易于使用。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-09-30T07:33:01.060

Assigned(AObject) 会告诉你一个对象是否为 nil。

或许值得一提的是，如果您使用 AObject.Free 释放对象，Assigned 仍将返回 true。因此，请确保使用 FreeAndNil(AObject) 释放对象。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-29T15:48:04.280

如果已分配（MyObject）然后...

# c++ - 升压库

> ID：149268
> 
> 赞同：53
> 
> 时间：2008-09-29T15:43:28.503
> 
> 标签：c++, boost

自从我开始使用这个站点以来，我不断听到关于 Boost 库的消息。我想知道 Boost 库的一些主要好处是什么（因此我为什么要使用它）以及 Boost 库的可移植性如何？

* * *

## 回答 #1

> 赞同：69
> 
> 时间：2008-09-29T15:48:33.140

Boost 由标准委员会的几位成员组织。
因此，它是下一个标准中图书馆的温床。

1.  它是 STL 的扩展（它填补了遗漏的位）
2.  这是有据可查的。
3.  它得到了同行评议。
4.  它具有很高的活动性，因此可以快速找到并修复错误。
5.  它是平台中立的，适用于任何地方。
6.  它可以免费使用。

随着 tr1 即将推出，很高兴知道 boost 已经覆盖了很多领域。tr1 中的很多库基本上都是直接从 boost 原件改编而来的，因此已经过尝试和测试。不同之处在于它们已被移至 std::tr1 命名空间（而不是 boost）。

您需要做的就是将以下内容添加到您的编译器默认[包含搜索路径](http://www.boost.org/doc/libs/1_37_0/doc/html/boost_tr1/usage.html)中：

```
<boost-install-path>/boost/tr1/tr1 
```

然后，当您包含标准标头时，boost 将自动将所有必需的东西导入命名空间 std::tr1

### 例如：

要使用 std::tr1::share_ptr 你只需要包含 <memory>。这将为您提供一个文件的所有智能指针。

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2008-09-29T15:48:14.700

您可以简单地阅读[Boost 背景信息](http://www.boost.org/users/)页面，快速了解为什么应该使用 Boost 以及可以将其用于什么用途。值得花几分钟。

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2008-09-29T15:52:35.920

99% 便携。

我想说的是，一旦你发现了通过 boost 解决的需求，它就有很多真正有用的库。您可以自己编写代码，也可以使用非常可靠的库。拥有像 Multi-Index、Lambda、Program Options、RegEx、SmartPtr 和 Tuple 这样的现成资源真是太棒了……

最好的办法是花一些时间浏览不同库的文档并评估它是否对您有用。

值得！！

* * *

## 回答 #4

> 赞同：15
> 
> 时间：2008-09-29T20:51:54.640

Boost 很棒，但只是在这里玩 Devil's Advocate 是您可能不想使用 Boost 的一些原因：

*   有时无法在旧编译器上编译/正常工作。
*   它通常比使用较少模板的方法增加编译时间更多。
*   某些 Boost 代码可能不会像您认为的那样做。阅读文档！
*   模板滥用可能导致无法阅读的错误消息。
*   模板滥用会导致代码难以在调试器中单步执行。
*   它是最前沿的 C++。下一个版本的 Boost 可能不再在您当前（旧）的编译器上编译。

所有这一切并不意味着即使您不按原样使用 Boost，您也不应该查看 Boost 代码并自己获得一些想法。

* * *

## 回答 #5

> 赞同：13
> 
> 时间：2008-09-29T15:46:22.363

你会得到很多 C++0x 中的东西。但除了一般性之外，一些更好的细节是一个简单的[正则表达式库](https://stackoverflow.com/questions/130186/ie-textrange-select-method-not-working-properly)，一个用于[从字符串转换为整数](http://www.boost.org/doc/libs/1_36_0/libs/conversion/lexical_cast.htm)（词法转换）的转换库：

```
int iResult = 0;
try
{
    iResult = lexical_cast<int>("4");
}
catch(bad_lexical_cast &)
{
    cout << "Unable to cast string to int";
} 
```

日期[/时间库](http://www.boost.org/doc/libs/1_36_0/doc/html/date_time.html)等...

```
using namespace boost::gregorian;
date weekstart(2002,Feb,1);
date thursday_next = next_weekday(weekstart, Thursday); // following Thursday 
```

还有一个[Python 接口](http://www.boost.org/doc/libs/1_36_0/libs/python/doc/index.html)（Boost Python），一个[词法分析器/解析器 DSL](http://spirit.sourceforge.net/)（Boost Spirit）：

```
// A grammar in C++ for equations
group       = '(' >> expression >> ')';
factor      = integer | group;
term        = factor >> *(('*' >> factor) | ('/' >> factor));
expression  = term >> *(('+' >> term) | ('-' >> term)); 
```

而这只是表面上的问题......

* * *

## 回答 #6

> 赞同：12
> 
> 时间：2008-09-29T15:45:19.497

Boost 是 C++ 库的集合。其中 10 个包含在 C++0x 的 tr1 中。

您可以[在此处开始使用 boost](http://www.boost.org/users/index.html)。

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2008-09-29T15:49:11.967

[Boost](http://www.boost.org/)是一组高质量的同行评审 C++ 库，它们强调可移植性和正确性。它是语言和标准库新增功能的事实上的试验场。查看他们的网站了解更多详情。

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2008-09-29T15:50:39.123

Boost 的优点：它广泛可用，可以移植到任何现代 C++ 编译器或任何平台。
这些功能与平台无关，您不必为每个新框架学习新的线程设计。
它以标准方式封装了许多特定于平台的功能，例如文件系统。

这是 C++ 应该附带的！Java 的很多流行之处在于它附带了一个标准库，可以做几乎所有你想做的事情。不幸的是，C++ 只继承了有限的 C/Unix 标准函数。

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2008-11-08T22:18:02.910

`shared_ptr`和`weak_ptr`，尤其是在多线程代码中，单独值得安装 boost。 `BOOST_STATIC_ASSERT`做编译时逻辑检查也很酷。

boost 中的许多类和实用程序都在标头中，这意味着您无需编译任何东西就可以获得很多功能，这也是一个优点。可移植性通常不是问题，除非您使用非常旧的编译器。我曾经试图让 MPL 与 VC6 一起工作，它在完全爆炸之前打印出 40,000 个警告/内部错误。但总的来说，无论您的平台或编译器供应商如何，大多数库都应该可以工作。

考虑到 Boost 中的很多东西已经在 TR1 中，并且很可能会出现在 C++ 标准库的下一个版本中。这是一个相当大的认可。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2008-09-29T15:47:08.710

Boost 是一个非常广泛的（通常）通用结构库，可以帮助几乎任何应用程序。这可以从 C++ 0x 规范中包含许多 boost 组件这一事实来证明。

它也至少可以在主要平台上移植，并且应该可以移植到几乎任何具有大多数标准兼容的 C++ 编译器的东西。

唯一的警告是 boost 库之间可能有很多混合的依赖关系，这使得只选择一个特定的组件来分发（而不是整个 boost 库）变得更加困难。

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2008-09-29T16:11:23.613

以上所有，加上它鼓励了许多现代的、最佳实践的 C++ 技术。它倾向于提高代码的质量。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-01-19T10:06:00.143

另请注意，大多数 boost 是模板，因此不需要构建
（只需包含正确的头文件）。

The few parts that do require building are optional:
These can each be built independently thus preventing unnecessary bloat for unneeded code.

# javascript - 如何消除ajax调用的闪烁效果

> ID：149272
> 
> 赞同：3
> 
> 时间：2008-09-29T15:44:00.340
> 
> 标签：javascript, html, ajax

我遇到一个问题：

在 html 页面上，当我单击某个控件（选项卡面板标题）时，我会进行 ajax 调用。

从 Wicket（java 代码）中，我调用了一个 javascript 函数，该函数“重绘”了我页面上的所有组件（这就像重新加载页面）。每次我这样做时，我都会在 html 上获得闪烁效果（正如我所说，在 ajax 调用之后将触发页面上所有组件的重绘）。

我正在触发 javascript 函数（重绘），因为我需要使用 ajax 响应提供的新信息“重绘”（例如，响应给了我一个新表，我必须重绘，使用这个新信息重绘页面作为一种参数，根据它）。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-29T15:58:52.817

抱歉，但要明确一点：当您说“重绘”时，您真的是指重绘当前存在的内容（如“对表格进行动态更改但不要删除它”）还是您的意思是将现有内容替换为一些新内容，就像普通的 Ajax 技术一样？

如果您用新组件替换现有组件，您应该可以，只要您提供某种淡入淡出/动画效果，从控件被替换的事实中引起用户的注意。有时，如果您要更新大量界面，则进行某种“屏幕缓冲”（将所有新组件加载到隐藏的**div**中，然后用新的 div 替换现有的**div ）会有所帮助。**

# performance - HTTP 与 HTTPS 性能

> ID：149274
> 
> 赞同：381
> 
> 时间：2008-09-29T15:44:41.963
> 
> 标签：performance, http, https

http 和 https 在性能上是否有任何重大差异？我似乎记得读过 HTTPS 可以是 HTTP 的五分之一。这对当前一代的网络服务器/浏览器有效吗？如果是这样，是否有任何白皮书支持它？

* * *

## 回答 #1

> 赞同：237
> 
> 时间：2008-09-29T16:09:50.543

对此有一个非常简单的答案：***分析您的 Web 服务器的性能，以查看针对您的特定情况的性能损失。***有几种工具可以比较 HTTP 与 HTTPS 服务器的性能（想到 JMeter 和 Visual Studio），它们非常易于使用。

如果没有关于您的网站性质、硬件、软件和网络配置的*一些*信息，没有人可以给您一个有意义的答案。

正如其他人所说，由于加密会产生一定程度的开销，但它高度依赖于：

*   硬件
*   服务器软件
*   动态与静态内容的比例
*   客户端到服务器的距离
*   典型的会话长度
*   等等（我个人最喜欢的）
*   客户端的缓存行为

以我的经验，大量处理动态内容的服务器往往受 HTTPS 的影响较小，因为与内容生成时间相比，加密所花费的时间（SSL 开销）微不足道。

大量服务于可以轻松缓存在内存中的一组相当小的静态页面的服务器会遭受更高的开销（在一种情况下，吞吐量在“内部网”上减半）。

编辑：其他几个人提出的一点是 SSL 握手是 HTTPS 的主要成本。这是正确的，这就是为什么“典型的会话长度”和“客户端的缓存行为”很重要。

许多非常短的会话意味着握手时间将压倒任何其他性能因素。较长的会话意味着握手成本将在会话开始时产生，但后续请求的开销相对较低。

客户端缓存可以在多个步骤中完成，从大型代理服务器到单个浏览器缓存。通常 HTTPS 内容不会被缓存在共享缓存中（尽管一些代理服务器可以利用中间人类型的行为来实现这一点）。许多浏览器缓存当前会话的 HTTPS 内容，并且经常跨会话缓存。不缓存或更少缓存的影响意味着客户端将更频繁地检索相同的内容。这导致更多的请求和带宽来服务相同数量的用户。

* * *

## 回答 #2

> 赞同：229
> 
> 时间：2008-09-29T16:20:54.450

HTTPS 需要一个非常慢的初始握手。作为握手的一部分传输的实际数据量并不大（通常低于 5 kB），但对于非常小的请求，这可能是相当多的开销。但是，一旦握手完成，就会使用一种非常快速的对称加密形式，因此开销很小。底线：通过 HTTPS 发出大量短请求将比 HTTP 慢很多，但如果您在单个请求中传输大量数据，则差异将是微不足道的。

但是，keepalive 是 HTTP/1.1 中的默认行为，因此您将进行*一次*握手，然后通过同一连接进行大量请求。这对 HTTPS 产生了重大影响。您可能应该分析您的网站（正如其他人所建议的那样）以确保，但我怀疑性能差异不会很明显。

* * *

## 回答 #3

> 赞同：102
> 
> 时间：2008-09-30T15:01:19.360

要真正了解 HTTPS 将如何增加您的延迟，您必须了解 HTTPS 连接是如何建立的。这是一个[很好的图表](http://publib.boulder.ibm.com/tividd/td/ITAME/SC32-1363-00/en_US/HTML/ss7aumst18.htm)。关键是，客户端不会在 2 个“腿”（一次往返，您发送请求，服务器发送响应）之后获取数据，而是客户端至少要在 4 个腿（2 次往返）之后才能获取数据. 因此，如果数据包在客户端和服务器之间移动需要 100 毫秒，那么您的第一个 HTTPS 请求将至少需要 500 毫秒。

当然，这可以通过重新使用 HTTPS 连接（浏览器应该这样做）来缓解，但它确实解释了加载 HTTPS 网站时初始停滞的部分原因。

* * *

## 回答 #4

> 赞同：79
> 
> 时间：2008-09-29T21:49:20.540

开销不是由于加密。在现代 CPU 上，SSL 所需的加密是微不足道的。

开销是由于 SSL 握手，这是冗长的，并且大大增加了 HTTPS 会话比 HTTP 会话所需的往返次数。

在服务器位于模拟的高延迟链接末端时测量（使用 Firebug 等工具）页面加载时间。存在模拟高延迟链接的工具 - 对于 Linux，有“netem”。在相同的设置上比较 HTTP 和 HTTPS。

延迟可以通过以下方式在一定程度上得到缓解：

*   确保您的服务器使用 HTTP keepalives - 这允许客户端重用 SSL 会话，从而避免再次握手
*   将请求数量减少到尽可能少 - 通过尽可能组合资源（例如 .js 包含文件、CSS）并鼓励客户端缓存
*   减少页面加载次数，例如通过将不需要的数据加载到页面中（可能在隐藏的 HTML 元素中），然后使用客户端脚本显示它。

* * *

## 回答 #5

> 赞同：25
> 
> 时间：2014-12-02T03:42:04.897

# 2014 年 12 月更新

[您可以使用AnthumChris的](https://twitter.com/AnthumChris)**[HTTP 与 HTTPS 测试](http://www.httpvshttps.com/)**网站在您自己的浏览器中轻松测试 HTTP 和 HTTPS 性能之间的差异：“此页面通过不安全的 HTTP 和加密的 HTTPS 连接测量其加载时间。两个页面都加载了 360 个独特的、非缓存的图像（总共 2.04 MB）。”</p>

结果可能会让你大吃一惊。

**[由于 Mozilla、Akamai、Cisco、Electronic Frontier Foundation 和 IdenTrust 的支持，让我们加密](https://letsencrypt.org/)**证书颁发机构将于 2015 年夏季开始发布免费、自动化和开放的 SSL 证书，因此了解 HTTPS 性能的最新知识非常重要。

# 2015 年 6 月更新

Let's Encrypt 的更新 - 2015 年 9 月到货：

*   [Let's Encrypt 发布时间表](https://letsencrypt.org/2015/06/16/lets-encrypt-launch-schedule.html)（2015 年 6 月 16 日）
*   [让我们加密根证书和中间证书](https://letsencrypt.org/2015/06/04/isrg-ca-certs.html)（2015 年 6 月 4 日）
*   [Let's Encrypt 订户协议草案](https://letsencrypt.org/2015/05/21/draft-le-sa.html)（2015 年 5 月 21 日）

Twitter 上的更多信息：[@letsencrypt](https://twitter.com/letsencrypt)

有关 HTTPS 和 SSL/TLS 性能的更多信息，请参阅：

*   [TLS 还快吗？](https://istlsfastyet.com/)
*   [高性能浏览器网络，第 4 章：传输层安全](http://chimera.labs.oreilly.com/books/1230000000545/ch04.html)
*   [超频 SSL](https://www.imperialviolet.org/2010/06/25/overclocking-ssl.html)
*   [SSL 处理的剖析和性能](http://www.cs.ucr.edu/~bhuyan/papers/ssl.pdf)

有关使用 HTTPS 重要性的更多信息，请参阅：

*   [为什么要使用 HTTPS？](https://https.cio.gov/everything/)（仅 HTTPS 标准）
*   [Let's Encrypt](https://letsencrypt.org/)（互联网安全研究组）
*   [HTTPS 无处不在](https://www.eff.org/https-everywhere)（电子前沿基金会）

总结一下，让我引用[Ilya Grigorik 的话](https://www.igvita.com/)：*“TLS 恰好有一个性能问题：它使用得不够广泛。其他一切都可以优化。”*

感谢[Chris （](https://stackoverflow.com/users/4035845/chris) [HTTP 与 HTTPS 测试](http://www.httpvshttps.com/)基准测试的作者）在下面发表的评论。

* * *

## 回答 #6

> 赞同：24
> 
> 时间：2008-10-08T16:03:22.983

[当前的最佳答案](https://stackoverflow.com/questions/149274/http-vs-https-performance#149397)并不完全正确。

正如其他人在这里指出的那样，https 需要握手，因此需要更多的 TCP/IP 往返。

在 WAN 环境中，延迟通常会成为限制因素，而不是服务器上增加的 CPU 使用率。

请记住，从欧洲到美国的延迟可能在 200 毫秒左右（往返时间）。

[您可以使用HTTPWatch](http://httpwatch.com/)轻松衡量这一点（针对单个用户案例）。

* * *

## 回答 #7

> 赞同：12
> 
> 时间：2008-09-29T20:12:36.077

除了到目前为止提到的所有内容之外，请记住，出于安全原因，某些（全部？）网络浏览器不会将通过 HTTPS 获得的缓存内容存储在本地硬盘上。这意味着从用户的角度来看，包含大量静态内容的页面在重新启动浏览器后加载速度会变慢，而从服务器的角度来看，通过 HTTPS 对静态内容的请求量将高于通过 HTTP 的请求量。

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2008-09-29T16:12:39.213

对此没有一个单一的答案。

加密总是会消耗更多的 CPU。在许多情况下，这可以卸载到专用硬件，并且成本会因所选算法而异。例如，3des 比 AES 贵。有些算法对于加密器来说比解密器更昂贵。有些有相反的成本。

比散装加密更昂贵的是握手成本。新连接将消耗更多的 CPU。这可以通过会话恢复来减少，但代价是保留旧的会话机密直到它们过期。这意味着来自客户端的小请求不会返回更多请求是最昂贵的。

对于跨 Internet 流量，您可能不会注意到数据速率的这种成本，因为可用带宽太低。但是您肯定会在繁忙的服务器上的 CPU 使用率中注意到它。

* * *

## 回答 #9

> 赞同：6
> 
> 时间：2008-09-29T18:24:24.310

我可以告诉你（作为拨号用户），通过 SSL 的同一页面比通过常规 HTTP 慢几倍......

* * *

## 回答 #10

> 赞同：6
> 
> 时间：2008-11-05T10:18:10.070

在许多情况下，SSL 握手的性能影响将通过 SSL 会话可以在两端（桌面和服务器）缓存这一事实而减轻。例如，在 Windows 机器上，SSL 会话最多可以缓存 10 小时。请参阅 [http://support.microsoft.com/kb/247658/EN-US](http://support.microsoft.com/kb/247658/EN-US)。一些 SSL 加速器还将具有允许您调整会话缓存时间的参数。

另一个需要考虑的影响是，通过 HTTPS 提供的静态内容不会被代理缓存，这可能会降低通过同一代理访问站点的多个用户的性能。这可以通过静态内容也将缓存在桌面上的事实来缓解，Internet Explorer 版本 6 和 7 缓存可缓存的 HTTPS 静态内容，除非另有指示（工具菜单/Internet 选项/高级/安全/不保存加密页面到磁盘）。

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2013-12-01T18:18:14.667

这是一篇关于 SSL 握手延迟的好文章（有点旧，但仍然很棒）。帮助我将 SSL 确定为通过慢速 Internet 连接使用我的应用程序的客户端速度慢的主要原因：

[http://www.semicomplete.com/blog/geekery/ssl-latency.html](http://www.semicomplete.com/blog/geekery/ssl-latency.html)

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2014-03-24T05:31:04.857

我做了一个小实验，从 flickr (233 kb) 得到同一张图片的 16% 时差：

[http://farm8.staticflickr.com/7405/13368635263_d792fc1189_b.jpg](http://farm8.staticflickr.com/7405/13368635263_d792fc1189_b.jpg)

[https://farm8.staticflickr.com/7405/13368635263_d792fc1189_b.jpg](https://farm8.staticflickr.com/7405/13368635263_d792fc1189_b.jpg)

![在此处输入图像描述](https://i.stack.imgur.com/L4kAF.png)

当然，这些数字取决于许多因素，例如计算机性能、连接速度、服务器负载、路径上的 QoS（从浏览器到服务器的特定网络路径），但它显示了一般的想法：HTTPS 比 HTTP 慢，因为它需要完成更多操作（SSL 握手和编码/解码数据）。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2013-05-08T23:44:55.707

因为我正在为我的项目调查同样的问题，所以我找到了这些幻灯片。较旧但有趣：

[http://www.cs.nyu.edu/artg/research/comparison/comparison_slides/sld001.htm](http://www.cs.nyu.edu/artg/research/comparison/comparison_slides/sld001.htm)

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2013-07-10T22:43:34.397

> **TLS 快了吗？**是的。

*   观看：[https ://www.youtube.com/watch?v=0EB7zh_7UE4](https://www.youtube.com/watch?v=0EB7zh_7UE4)
*   阅读：[https ://istlsfastyet.com/](https://istlsfastyet.com/)

有许多项目旨在模糊界限并使 HTTPS 一样快。像[SPDY](http://www.chromium.org/spdy)和[mod-spdy](https://code.google.com/p/mod-spdy/)。

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2014-10-07T20:33:32.847

这里似乎有一个令人讨厌的边缘案例：Ajax over congested wifi。

Ajax 通常意味着 KeepAlive 在 20 秒后超时。但是，wifi 意味着（理想情况下是快速的）ajax 连接必须进行多次往返。更糟糕的是，wifi经常丢包，还有TCP重传。在这种情况下，HTTPS 的表现真的很糟糕！

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2016-01-19T11:22:03.203

> HTTP 与 HTTPS 性能比较

与普通的旧 HTTP 相比，我总是将 HTTPS 与较慢的页面加载时间相关联。作为一名 Web 开发人员，网页性能对我来说很重要，任何会降低我的网页性能的事情都是禁忌。

为了理解所涉及的性能影响，下图让您基本了解当您使用 HTTPS 请求资源时会发生什么。

[![在此处输入图像描述](https://i.stack.imgur.com/OxUgH.jpg)](https://i.stack.imgur.com/OxUgH.jpg)

从上图中可以看出，与使用纯 HTTP 相比，使用 HTTPS 时需要执行一些额外的步骤。当您使用 HTTPS 发出请求时，需要进行握手以验证请求的真实性。与 HTTP 请求相比，此握手是一个额外的步骤，不幸的是会产生一些开销。

为了了解性能影响并亲自了解性能影响是否会显着，我将此站点用作测试平台。我前往webpagetest.org 并使用可视化比较工具来比较使用HTTPS 和HTTP 的网站加载。

正如您可以从[这里](http://www.webpagetest.org/video/view.php?id=140910_a7e4a141508c1f9ced201422c14e4060c79694e7&embed=1&width=816&height=384)看到的使用 HTTPS 的测试视频结果确实对我的页面加载时间产生了影响，但是差异可以忽略不计，我只注意到 300 毫秒的差异。请务必注意，这些时间取决于许多因素，例如计算机性能、连接速度、服务器负载以及与服务器的距离。

您的站点可能不同，彻底测试您的站点并检查切换到 HTTPS 所涉及的性能影响非常重要。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2008-09-29T15:46:46.950

鉴于 SSL 需要一个额外的加密步骤，而非 SLL HTTP 根本不需要，这几乎可以肯定是正确的。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2008-09-29T15:46:59.820

HTTPS 具有加密/解密开销，因此它总是会稍微慢一些。SSL 终止非常占用 CPU。如果您有卸载 SSL 的设备，则延迟的差异可能几乎不明显，具体取决于您的服务器所承受的负载。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2008-09-29T16:01:24.713

有一种方法可以衡量这一点。来自 apache 的名为 jmeter 的工具将测量吞吐量。如果您在受控环境中使用 jmeter 设置大量服务样本，使用和不使用 SSL，您应该获得相对成本的准确比较。我会对你的结果感兴趣。

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2019-12-26T19:43:44.110

HTTPS 确实会影响页面速度...

上面的引述揭示了许多人对网站安全和速度的愚蠢。HTTPS / SSL 服务器握手会在建立 Internet 连接时造成初始停滞。在访问者的浏览器屏幕上开始呈现任何内容之前会有一个缓慢的延迟。这种延迟是在 Time-to-First-Byte 信息中测量的。

HTTPS 握手开销出现在 Time-to-First-Byte 信息 (TTFB) 中。常见的 TTFB 范围从低于 100 毫秒（最佳情况）到超过 1.5 秒（最坏情况）。但是，当然，使用 HTTPS 会差 500 毫秒。

往返、无线 3G 连接可能需要 500 毫秒或更长时间。额外的行程将延迟加倍至 1 秒或更多。这对移动性能有很大的负面影响。非常坏的消息。

我的建议是，如果您不交换敏感数据，那么您根本不需要 SSL，但如果您确实喜欢电子商务网站，那么您可以在某些交换敏感数据的页面上启用 HTTPS，例如登录和结帐。

资料来源：[Pagepipe](http://pagepipe.com/httpsssl-and-its-negative-impact-on-mobile-speed/)

* * *

## 回答 #21

> 赞同：-1
> 
> 时间：2008-09-29T15:54:26.243

更重要的性能差异是 HTTPS 会话在用户连接时保持打开状态。HTTP“会话”仅持续单个项目请求。

如果您正在运行一个具有大量并发用户的站点，则希望购买大量内存。

* * *

## 回答 #22

> 赞同：-1
> 
> 时间：2018-02-18T07:01:59.043

浏览器可以接受带有 HTTP 或 HTTPS 的 HTTP/1.1 协议，但浏览器只能处理带有 HTTPS 的 HTTP/2.0 协议。从 HTTP/1.1 到 HTTP/2.0 的协议差异使得 HTTP/2.0 平均比 HTTP/1.1 快 4-5 倍。此外，在实现 HTTPS 的站点中，大多数是通过 HTTP/2.0 协议实现的。因此，HTTPS 几乎总是比 HTTP 更快，这仅仅是因为它通常使用的协议不同。但是，如果将 HTTP/1.1 上的 HTTP 与 HTTP/1.1 上的 HTTPS 进行比较，则平均而言，HTTP 比 HTTPS 稍快。

以下是我使用 Chrome (Ver. 64) 进行的一些比较：

基于 HTTP/1.1 的 HTTPS：

*   0.47 秒平均页面加载时间
*   比 HTTP/1.1 上的 HTTP 慢 0.05 秒
*   比 HTTP/2.0 上的 HTTPS 慢 0.37 秒

HTTP/1.1 之上的 HTTP

*   0.42 秒平均页面加载时间
*   比 HTTP/1.1 上的 HTTPS 快 0.05 秒
*   比 HTTP/2.0 上的 HTTPS 慢 0.32 秒

基于 HTTP/2.0 的 HTTPS

*   0.10 秒平均加载时间
*   比 HTTP/1.1 上的 HTTP 快 0.32 秒
*   通过 HTTPS/1.1 比 HTTPS 快 0.37 秒

# java - 限制 Java 包之间的依赖关系

> ID：149294
> 
> 赞同：10
> 
> 时间：2008-09-29T15:47:48.163
> 
> 标签：java, build-process, dependency-management

在 Java 构建系统中对包依赖项实施限制的可能性有哪些？例如，`myapp.server.bl.Customer`不应允许类引用`myapp.client.ui.customlayout`包。我对基于 Ant 或特定于 IDE 的解决方案感兴趣。

我想在构建中收到一条错误消息，表明（自定义）包依赖规则已被违反并且构建中止。我还想在 Ant 脚本或 IDE 项目文件之外的列表中维护依赖项，最好是在文本文件中。

（我不知道 Maven 但我在这里读过它对模块依赖管理有更好的支持）

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-29T16:43:31.213

我相信 Checkstyle 有一个检查。它被称为[进口控制](http://checkstyle.sourceforge.net/config_imports.html#ImportControl "Checkstyle 文档")

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-09-29T17:02:01.853

您可以配置 Eclipse 项目以指定访问规则。访问规则可以使用通配符规则指定“禁止”、“不鼓励”和“可访问”级别。然后，您可以将不鼓励或禁止的违规配置为在构建期间标记为警告或错误。

关于这个想法的旧文章（细节可能已经过时）：

[http://www.eclipsezone.com/eclipse/forums/t53736.html](http://www.eclipsezone.com/eclipse/forums/t53736.html)

如果您使用的是 Eclipse（或 OSGi）插件，那么插件/模块的“公共”部分是明确定义的，这是模型的一部分。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-29T20:39:38.383

[ivy](http://ant.apache.org/ivy/)似乎是解决您问题的好方法（如果您使用的是 ant）。Ivy 是 Ant 的官方依赖管理组件，因此可以很好地与 ant 集成。它能够解决依赖关系、处理冲突、创建排除项等。

它使用简单的 xml 结构来描述依赖关系，并且比 Maven 更易于使用，因为它只尝试解决依赖关系解析问题。

从常春藤主页：

Ivy 是一个用于管理（记录、跟踪、解决和报告）项目依赖关系的工具。它具有以下特点：

1.  灵活性和可配置性——Ivy 本质上与流程无关，不依赖于任何方法或结构。相反，它提供了必要的灵活性和可配置性，以适应广泛的依赖管理和构建过程。
2.  与 Apache Ant 紧密集成 - 虽然可作为独立工具使用，但 Ivy 与 Apache Ant 配合得特别好，它提供了许多强大的 Ant 任务，从依赖关系解析到依赖关系报告和发布。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-30T03:00:55.893

对于 IDE 特定的解决方案，IntelliJ IDEA 有一个依赖分析工具，它也允许定义无效的依赖。 [http://www.jetbrains.com/idea/webhelp2/dependency-validation-dialog.html](http://www.jetbrains.com/idea/webhelp2/dependency-validation-dialog.html)

编译和实时显示依赖冲突，同时编辑依赖类（作为右侧错误栏中的错误/警告条纹）。

使用 JetBrains 的 TeamCity 构建服务器可以获得更多自动化，它可以运行检查构建并报告上述配置的检查。

对于另一个独立于 IDE 的解决方案，AspectJ 可用于声明无效依赖项（并在构建过程中集成该步骤，以获得问题的警告/错误信息）。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-29T16:49:06.723

Eclipse 通过构建路径属性/jar 属性对此提供了支持。我认为它可能只适用于 jar / 项目边界。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-03-25T13:27:39.887

您可以在 IDEA 或 Maven 中使用多个模块，或者在 Eclipse 和 Gradle 中使用多个项目。这个概念在所有情况下都是相同的。

一个简单的解释是 myapp.server.bl 的一个模块和**myapp.client.ui.customlayout****的**另一个模块，它们之间没有编译时依赖关系。现在，任何针对相反模块/项目编译代码或代码完成的尝试都将失败。

 **要审核问题的广泛程度，IntelliJ IDEA 的一个有用起点是**分析依赖关系**：

[http://www.jetbrains.com/idea/webhelp/analyzing-dependencies.html](http://www.jetbrains.com/idea/webhelp/analyzing-dependencies.html)

从那篇文章中，您可以了解如何为您的项目运行和执行依赖项分析。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2011-09-19T10:59:35.380

也许可以使用 **Classsycle ：** [http ://classycle.sourceforge.net/ddf.html](http://classycle.sourceforge.net/ddf.html)

# asp.net - 防止 DataGrid 中的文本换行

> ID：149300
> 
> 赞同：1
> 
> 时间：2008-09-29T15:48:09.660
> 
> 标签：asp.net

我有一个数据绑定 DataGrid 控件的问题，尽管每一列的 Wrap 属性设置为 false，但文本仍然会换行。它似乎只在 IE 上执行此操作，而不是 FF。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-29T15:58:33.100

微软似乎意识到了这个问题，他们[提供了一个解决方法](http://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=104081)......

我不知道这是否在 IE8 B2 中得到解决……你可以试试看。祝你好运！

# python - App Engine 上的后台任务

> ID：149307
> 
> 赞同：6
> 
> 时间：2008-09-29T15:48:55.493
> 
> 标签：python, google-app-engine, cron

如何在 App Engine 上运行后台任务？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-06-23T02:11:39.343

您可以使用[任务队列 Python API](http://code.google.com/appengine/docs/python/taskqueue/)。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-29T15:51:15.347

GAE 是构建可扩展 Web 应用程序的非常有用的工具。许多人指出的限制很少是不支持后台任务，缺乏周期性任务以及对每个HTTP请求花费多少时间的严格限制，如果请求超过该时间限制，则操作将被终止，这使得耗时的任务无法运行.

**如何运行后台任务？**
在 GAE 中，代码仅在有 HTTP 请求时执行。代码需要多长时间有严格的时间限制（我认为是 10 秒）。因此，如果没有请求，则不会执行代码。建议的解决方法之一是使用外部框连续发送请求，因此有点创建后台任务。但是为此我们需要一个外部盒子，现在我们依赖于一个额外的元素。另一种选择是发送 302 重定向响应，以便客户端重新发送请求，这也使我们依赖于外部元素，即客户端。如果那个外部盒子是 GAE 本身呢？每个使用过不支持循环结构的函数式语言的人都知道替代方案，即递归是循环的替代品。那么，如果我们完成部分计算并在同一个 url 上执行一个 HTTP GET 并以非常短的时间（比如 1 秒）呢？这会在 apache 上运行的 php 代码上创建一个循环（递归）。

```
<?php
$i = 0;
if(isset($_REQUEST["i"])){
        $i= $_REQUEST["i"];
    睡眠（1）；
}
$ch = curl_init("http://localhost".$_SERVER["PHP_SELF"]."?i=".($i+1));
curl_setopt($ch, CURLOPT_HEADER, 0);
curl_setopt($ch, CURLOPT_TIMEOUT, 1);
curl_exec($ch);
打印“你好世界\n”；
?>

```

一些这在 GAE 上不起作用。那么如果我们在其他一些 url 上做 HTTP GET 说 url2 哪个在第一个 url 上做 HTTP GET 呢？这似乎在 GAE 中有效。这个代码看起来像这样。

```
类 FirstUrl(webapp.RequestHandler):
    定义获取（自我）：
        self.response.out.write("ok")
        时间.sleep(2)
        urlfetch.fetch("http://"+self.request.headers["HOST"]+'/url2')

类SecondUrl（webapp.RequestHandler）：
    定义获取（自我）：
        self.response.out.write("ok")
        时间.sleep(2)
        urlfetch.fetch("http://"+self.request.headers["HOST"]+'/url1')

application = webapp.WSGIApplication([('/url1', FirstUrl), ('/url2', SecondUrl)])
定义主（）：
    run_wsgi_app（应用程序）
如果 __name__ == "__main__":
    主要的（）

```

由于我们找到了一种运行后台任务的方法，让我们为周期性任务（计时器）和一个跨越许多 HTTP 请求（foreach）的循环结构构建抽象。

**计时器**
现在构建计时器是直截了当的。基本思想是有一个计时器列表和每个应该被调用的时间间隔。一旦我们达到那个间隔，就调用回调函数。我们将使用 memcache 来维护计时器列表。为了找出何时调用回调，我们将在 memcache 中存储一个 key，其间隔为过期时间。我们定期（比如 5 秒）检查该键是否存在，如果不存在则调用回调并再次设置该键的间隔。

```
def 计时器（函数，间隔）：
    timerlist = memcache.get('timer')
    如果（无 == 计时器列表）：
        计时器列表 = []
    timerlist.append({'func':func, 'interval':interval})
    memcache.set('timer-'+func, '1', 间隔)
    memcache.set('timer', timerlist)

定义检查计时器（）：
    timerlist = memcache.get('timer')
    如果（无 == 计时器列表）：
        返回假
    对于计时器列表中的电流：
        if(None == memcache.get('timer-'+current['func'])):
            #重置间隔
            memcache.set('timer-'+current['func'], '1', current['interval'])
            #调用回调函数
            尝试：
                eval(当前['func']+'()')
            除了：
                经过
            返回真
    返回假

```

**Foreach**
当我们想要进行长时间的计算时，例如对 1000 个数据库行进行一些操作或获取 1000 个 url 等，这是需要的。基本思想是在 memcache 中维护回调和参数列表，并且每次使用参数调用回调。

```
def foreach（函数，参数）：
    looplist = memcache.get('foreach')
    如果（无 == 循环列表）：
        循环列表 = []
    looplist.append({'func':func, 'args':args})
    memcache.set('foreach', looplist)

定义检查循环（）：
    looplist = memcache.get('foreach')
    如果（无 == 循环列表）：
        返回假
    if((len(looplist) > 0) 和 (len(looplist[0]['args']) > 0)):
        arg = looplist[0]['args'].pop(0)
        func = looplist[0]['func']
        if(len(looplist[0]['args']) == 0):
            looplist.pop(0)
        if((len(looplist) > 0) 和 (len(looplist[0]['args']) > 0)):
            memcache.set('foreach', looplist)
        别的：
            memcache.delete('foreach')
        尝试：
            eval(func+'('+repr(arg)+')')
        除了：
            经过
        返回真
    别的：
        返回假

＃ 代替
# foreach 范围内的索引（0, 1000）：
# someoperaton(index)
# 我们会说
# foreach('someoperaton', range(0, 1000))

```

现在构建一个每隔一小时获取 url 列表的程序是直截了当的。这是代码。

```
def getone（网址）：
    尝试：
        结果 = urlfetch.fetch(url)
        如果（结果.status_code == 200）：
            memcache.set(url, '1', 60*60)
            #处理结果.内容
    除了 ：
        经过

def getallurl():
    #要获取的url列表
    urllist = ['http://www.google.com/', 'http://www.cnn.com/', 'http://www.yahoo.com', 'http://news.google. com']
    提取列表 = []
    对于 urllist 中的 url：
        如果（memcache.get(url) 为无）：
            fetchlist.append(url)
    #这相当于
    #for fetchlist 中的 url: getone(url)
    if(len(fetchlist) > 0):
        foreach('getone', fetchlist)

#注册定时器回调
计时器（'getallurl'，3*60）

```

完整的代码在这里[http://groups.google.com/group/httpmr-discuss/t/1648611a54c01aa](http://groups.google.com/group/httpmr-discuss/t/1648611a54c01aa) 我已经在 appengine 上运行这段代码几天了，没有太多问题。

警告：我们大量使用 urlfetch。每天 urlfetch 的限制是 160000。所以要小心不要达到这个限制。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2012-11-01T18:03:30.383

[您可以在此处](https://developers.google.com/appengine/docs/python/config/cron)找到有关 Python App Engine 中 cron 作业的更多信息。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-06T15:20:34.663

即将推出的运行时版本将具有某种周期性执行引擎 a'la cron。在 AppEngine 组上查看[此消息。](http://groups.google.com/group/google-appengine/msg/9a94aaf4a3b9415f)

> 所以，所有的 SDK 部分似乎都可以工作，但我的测试表明这还没有在生产服务器上运行——我设置了一个“每 1 分钟”的 cron 来记录它运行时的日志，并且它还没有被调用

很难说什么时候可以使用，虽然......

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2016-01-28T14:14:57.637

使用[延迟 Python 库](https://cloud.google.com/appengine/articles/deferred?hl=en)是使用基于 TaskQueue API 构建的 Python 在 Appengine 上执行后台任务的最简单方法。

```
from google.appengine.ext import deferred

def do_something_expensive(a, b, c=None):
    logging.info("Doing something expensive!")
    # Do your work here

# Somewhere else
deferred.defer(do_something_expensive, "Hello, world!", 42, c=True) 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-03-06T17:28:21.707

如果您想运行后台定期任务，请参阅[此问题](https://stackoverflow.com/questions/145651/cron-jobs-on-google-appengine)（AppEngine cron）

如果您的任务不是周期性的，请参阅[任务队列 Python API](http://code.google.com/appengine/docs/python/taskqueue/)或[任务队列 Java API](http://code.google.com/appengine/docs/java/taskqueue/)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2013-08-14T18:03:08.987

应用引擎中内置了一个 cron 工具。

请参考： [https ://developers.google.com/appengine/docs/python/config/cron?hl=en](https://developers.google.com/appengine/docs/python/config/cron?hl=en)

* * *

## 回答 #8

> 赞同：-3
> 
> 时间：2011-12-06T21:00:49.090

使用任务队列 - [http://code.google.com/appengine/docs/java/taskqueue/overview.html](http://code.google.com/appengine/docs/java/taskqueue/overview.html)

# asp.net - ASP.NET GridView 回发未设置已发布控件的值

> ID：149311
> 
> 赞同：1
> 
> 时间：2008-09-29T15:49:55.880
> 
> 标签：asp.net, gridview, web-controls

添加一些复杂的 EditItemTemplate（一个模板中的多个字段），然后从 RowUpdating 事件解析控件时，用户手动输入的控件没有值。我的猜测是绑定数据时会发生一些事情，但我有一些实例，只需在代码隐藏中添加和属性到控件即可启动行为并删除该代码使代码工作。作为一种变通方法，我可以 Request(controlname.UniqueId) 来获得它的价值，但那是一种黑客行为。

**编辑** 当我像这样访问值时

```
TextBox txtValue = gvwSettings.SelectedRow.FindControl("txtValue") as TextBox; 
```

找到文本框，但 .Text 不是用户输入。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-29T16:10:16.300

您是否关闭了 ViewState？您是否以编程方式在模板中添加了控件？如果是这样，您是否在正确的阶段创建了它们？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-29T16:07:34.637

您应该能够使用 GridViewUpdateEventArgs 来检索输入的值，例如：

```
TextBox txtValue = gvwSettings.SelectedRow.FindControl("txtValue") as TextBox; 
```

我以前使用过这种语法，它就像一个魅力。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-29T16:24:14.847

将回发数据绑定移动到 Page_Init

# sql-server - 虚拟化 SQL Server：为什么不呢？

> ID：149318
> 
> 赞同：33
> 
> 时间：2008-09-29T15:51:17.813
> 
> 标签：sql-server, performance, virtualization

我工作的 IT 部门正在尝试迁移到 100% 虚拟化服务器，所有数据都存储在 SAN 上。他们还没有这样做，但该计划最终要求将现有的物理 SQL Server 机器也迁移到虚拟服务器。

几个月前，我参加了 Heroes Happen Here 发布活动，在一次 SQL Server 会议上，演讲者顺便提到这对于生产系统来说不是一个好主意。

所以我正在寻找一些东西：

1.  这是或不是一个好主意的具体原因是什么？我需要参考，或者不打扰回复。我可以通过谷歌自己想出一个模糊的“I/O 绑定”响应。
2.  仅 HHH 演讲者的回忆可能无法说服我们的 IT 部门改变主意。任何人都可以直接指出我更权威的东西吗？而“直接”，我的意思是比一个模糊的在线图书评论更具体的东西。请缩小一点。

* * *

## 回答 #1

> 赞同：36
> 
> 时间：2008-09-29T16:04:28.327

我可以从个人经验中这么说，因为在我们说话的时候我正在处理这个问题。我目前作为承包商工作的地方为其 SQL Server 开发系统提供了这种类型的环境。我正在尝试在这种环境下开发一个相当适中的 BI 系统，并且确实在努力解决性能问题。

TLB 未命中和模拟 I/O 在幼稚的虚拟机上非常慢。如果您的 O/S 支持准虚拟化（这在 Windows 上仍然不是成熟的技术），那么您可以使用准虚拟化 I/O（本质上是与 VM 中的 API 挂钩的设备驱动程序）。最近版本的 Opteron 支持嵌套页表，这消除了在软件中模拟 MMU 的需要（这真的很慢）。

因此，在大型数据集上运行并执行大量 I/O（例如 ETL 进程）的应用程序会遇到虚拟化的致命弱点。如果您有像数据仓库系统这样的东西，可能会占用内存或磁盘 I/O，您应该考虑其他东西。对于一个简单的事务应用程序，它们可能没问题

从透视角度来看，我正在使用的系统在具有 4 个 2gbit F/C 链接的 SAN 上的刀片（IBM 服务器）上运行。这是一个中档 SAN。VM 有 4GB 的 RAM IIRC，现在有两个虚拟 CPU。在最好的情况下（当 SAN 安静时），这仍然只是我[XW9300](http://h10010.www1.hp.com/wwpc/uk/en/sm/WF05a/12454-12454-296719-296721-296721-459226.html)速度的一半，它在 1 个 U320 总线和 4GB RAM 上有 5 个 SCSI 磁盘（系统、临时数据库、日志、数据、数据）。

您的里程可能会有所不同，但我建议使用工作站系统，例如我描述的用于开发任何 I/O 繁重的工作站系统，而不是 SAN 上的虚拟服务器。除非您的资源使用要求超出了此类工具包（在这种情况下，无论如何它们都远远超出了虚拟服务器），否则这是一个更好的解决方案。硬件并不昂贵——肯定比 SAN、刀片机箱和 VMWare 许可便宜得多。SQL Server 开发者版附带 VS Pro 及更高版本。

这还有一个好处是，您的开发团队不得不从一开始就被迫处理部署——您必须想出一个易于“一键式”部署的架构。这并不像听起来那么难。 [Redgate SQL Compare Pro](http://www.red-gate.com/products/SQL_Compare/index.htm)是您的朋友。您的开发人员还将获得数据库管理的基本工作知识。

快速浏览一下[惠普的网站](http://h71016.www7.hp.com/dstore/MiddleFrame.asp?page=config&ProductLineId=433&FamilyId=2698&BaseId=24336&oi=E9CED&BEID=19701&SBLID=)，我得到了大约 4,600 美元的 XW8600（他们目前基于至强的型号）的标价，该型号配备四核至强芯片、4GB 内存和 1x146 和 4x73GB 15k SAS 硬盘。街头价格可能会少一些。将此与 SAN、刀片机箱和 VMware 许可的价格以及该设置的备份成本进行比较。对于备份，您可以提供带有备份的网络共享，人们可以根据需要删除压缩的数据库备份文件。

编辑：[AMD 网站上的这份白皮书](http://developer.amd.com/assets/NPT-WP-1%201-final-TM.pdf)讨论了 VM 上的一些基准测试。从后面的基准测试来看，繁重的 I/O 和 MMU 工作负载确实破坏了 VM 性能。他们的基准测试（由于它是供应商提供的统计数据，因此需要谨慎对待）表明 OLTP 基准测试的速度损失为 3.5 倍。虽然这是供应商提供的，但应牢记：

*   它对幼稚的虚拟化进行基准测试，并将其与半虚拟化解决方案进行比较，而不是裸机性能。

*   OLTP 基准测试将具有更多随机访问 I/O 工作负载，并且将花费更多时间等待磁盘寻道。更顺序的磁盘访问模式（数据仓库查询的特征）将有更高的惩罚，并且具有大量 TLB 未命中的内存密集型操作（例如，SSAS 是一个圣经内存猪）也将招致额外的惩罚. 这意味着此类处理的减速可能比白皮书中引用的 OLTP 基准惩罚更为明显。

我们在这里看到的是 TLB 未命中和 I/O 在 VM 上非常昂贵。在 MMU 中具有半虚拟化驱动程序和硬件支持的良好架构将缓解部分或全部这些问题。但是，我认为 Windows Server 2003 根本不支持半虚拟化，而且我不确定 Windows 2008 服务器提供了何种级别的支持。根据我的经验，与相对适中的规格裸机硬件相比，在处理 ETL 流程和 SSAS 多维数据集构建时，VM 会从根本上减慢服务器的速度。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-09-29T15:58:31.977

SAN——当然还有集群，但关于虚拟化——你会受到性能影响（对你来说可能值得，也可能不值得）：

[http://blogs.technet.com/andrew/archive/2008/05/07/virtualized-sql-server.aspx](http://blogs.technet.com/andrew/archive/2008/05/07/virtualized-sql-server.aspx)

[http://sswug.org](http://sswug.org)最近在他们的每日通讯中有一些关于它的注释

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-03-26T14:29:34.127

我想添加 Brent Ozar 的这一系列文章：

*   [为什么您的系统管理员想要虚拟化您的服务器](http://www.brentozar.com/archive/2009/03/why-your-sysadmin-wants-to-virtualize-your-servers/)
*   [为什么要虚拟化 SQL Server？](http://www.brentozar.com/archive/2009/03/why-would-you-virtualize-sql-server/)
*   [不应虚拟化 SQL Server 的原因](http://www.brentozar.com/archive/2009/03/reasons-why-you-shouldnt-virtualize-sql-server/)

在我所希望的意义上，它并不完全具有*权威性*（来自构建服务器的团队，或某种官方手册），但 Brent Ozar 非常受人尊敬，我认为他在涵盖所有问题方面做得很好.

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-29T21:36:59.510

我们在 VMWare 上为 900 多人运行一个工资系统，没有任何问题。这已经生产了10个月。就 DB 而言，这是一个中等大小的负载，我们在 VM 中预先分配了驱动器空间以防止 IO 问题。您必须定期对 VM 主机和 VM 片进行碎片整理，以保持可接受的性能。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-29T16:00:56.727

这是一些 VMWARE 测试。 [http://www.vmware.com/files/pdf/SQLServerWorkloads.pdf](http://www.vmware.com/files/pdf/SQLServerWorkloads.pdf)

当然，他们不会将其与物理机器进行比较。但是，您可能可以使用他们用于您的环境的工具进行类似的测试。

我们目前在 VMWARE 环境中运行 SQL Server 2005。但是，它是一个负载非常轻的数据库，而且非常棒。运行没有问题。

正如大多数人所指出的，这将取决于您的数据库负载。

也许你可以说服 IT 部门在盲目实施之前做一些好的测试。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-29T16:02:17.800

不，我不能指出任何特定的测试或类似的东西，但我可以从经验中说，将生产数据库服务器放在虚拟机上是一个坏主意，尤其是在它有很大负载的情况下。

有利于发展。甚至可能进行测试（理论上，如果它在虚拟盒的负载下运行良好，它会在生产中运行良好）但不是在生产中。

这真的是常识。你想让你的硬件运行两个操作系统和你的 sql server 还是一个操作系统和 sql server？

编辑：我的经验使我的反应有偏差。我曾在沉重的恒定负载下使用大型数据库。如果您在轻负载下拥有较小的数据库，则虚拟化可能适合您。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-30T10:22:10.247

**在Conor Cunningham 的**博客文章[Database Virtualization - The Dirty Little Secret 没人谈论...](http://www.sqlskills.com/blogs/conor/2008/02/07/DatabaseVirtualizationTheDirtyLittleSecretNobodyIsTalkingAbout.aspx)中有一些与此相关的信息。去引用：

> 在服务器本身内部，对于这个领域中对性能很重要的许多事情知之甚少，令人惊讶。SQL Server 的核心引擎假设如下：
> 
> 1.  所有 CPU 都同样强大
> 2.  所有 CPU 以大致相同的速率处理指令。
> 3.  刷新到磁盘可能应该在有限的时间内发生。

这篇文章还进一步详细阐述了这些问题。考虑到总体上考虑到这个问题的可用信息稀缺，我认为这是一本很好的读物。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-11-26T22:13:57.147

请注意，有一些专门为数据库设计的虚拟化产品可能值得研究，而不是像 VMWare 这样的通用产品。

我们公司（超过 200 台 SQL 服务器）目前正在我们的一些服务器上部署[HP Polyserve](http://h18006.www1.hp.com/products/storage/software/polyserve/support/hp_polyserve.html)：

> 适用于 Microsoft SQL Server 的 HP PolyServe 软件可以将多个 Microsoft SQL Server 实例整合到数量少得多的服务器和集中式 SAN 存储上。HP PolyServe 独特的“共享数据”架构在实用程序平台中提供企业级可用性和类似虚拟化的灵活性。

我们部署它的主要原因是使硬件更换更容易：将新盒子添加到“矩阵”中，在每个 SQL 实例所在的位置（无缝地）随机排列，然后移除旧盒子。对应用程序团队透明，因为 SQL 实例名称不会更改。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2014-10-05T15:42:29.797

**旧问题与旧答案**

该线程中的答案已有多年历史。整个线程中的大多数负面观点在技术上仍然是正确的，但相关性要小得多。与过去相比，虚拟化和 SAN 的开销成本现在已不再是一个因素。正确配置的虚拟化主机、来宾、网络和 SAN 可以提供良好的性能以及虚拟化和操作灵活性的好处，包括只有虚拟化才能提供的良好恢复方案。

然而，在现实世界中，只需要一个小的配置细节就可以让整个事情陷入困境。在实践中，虚拟 SQL 服务器的最大挑战是说服负责虚拟化的人员并与之合作，以使其设置正确。

具有讽刺意味的是，在 100% 的情况下，我们将生产从虚拟化中移回专用硬件，性能在专用硬件上达到了顶峰。在所有这些情况下，它不是虚拟化，而是它的设置方式。通过回到专用硬件，我们实际上证明了虚拟化可以更好地利用资源 5 倍或更多。现代软件通常设计为跨节点横向扩展，因此虚拟化在这方面也对您有利。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-29T15:55:16.103

虚拟化软件时，我最关心的通常是许可。

这是一篇关于 MS SQL 的文章。不确定您的情况，因此无法挑选出任何重点。

[http://www.microsoft.com/sql/howtobuy/virtualization.mspx](http://www.microsoft.com/sql/howtobuy/virtualization.mspx)

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-29T15:56:05.507

SQL Server 在虚拟环境中受支持。事实上，我会建议它看到许可选项之一是每个插槽。这意味着您可以在虚拟化（例如 Windows 2008 Server Datacenter）系统中放置任意数量的 SQL Server 实例，并且只需为机器拥有的每个处理器插槽付费。

它比这更好，因为 DataCenter 是按插槽许可的，并且还具有无限的虚拟机许可。

不过，我建议将 Hyper-V 集群在两台机器上，这样如果一台机器出现故障，另一台机器就可以弥补不足。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-09-29T21:48:01.497

我认为数据发生不良事件的可能性太大了。

作为一个简单的例子，假设您在 Virtual Server 2005 R2 中运行了一个 SQL Server 机器并打开了撤消磁盘（因此，主“磁盘”文件保持不变，并且所有更改都对可以清除的单独文件进行或稍后合并）。然后发生了一些事情（通常，您遇到了 128GB 的​​限制或任何大小），并且一些无知的管理员必须在半夜重新启动并发现他无法这样做，直到他删除了撤消磁盘。你搞砸了——即使他保留撤消磁盘文件以供以后分析，将数据合并在一起的可能性也很小。

因此，与此线程中的其他帖子相呼应-对于开发来说这很好，但对于生产来说这不是一个好主意。您的代码可以重建和重新部署（这是另一回事，用于源代码控制的 VM 也不是一个好主意），但您的实时生产数据更为重要。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-01-16T16:30:36.943

还应考虑在处理 Vitalization 时可能引入的安全问题。[虚拟化安全](http://pandalabs.pandasecurity.com/archive/Virtualization-Security-Part-2.aspx)是 PandaLabs 的一篇很好的文章，涵盖了一些问题。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2013-01-15T01:40:52.487

你从错误的角度看待这个问题。首先，您不会从供应商那里找到为什么您应该“不”虚拟化或为什么应该虚拟化的白皮书。

每个环境都是不同的，您需要做在您的环境中有效的事情。话虽如此，有些服务器非常适合虚拟化，有些则不应该虚拟化。例如，如果您的 SQL Server/s 每秒执行数百万次事务，例如，如果您的服务器位于纽约证券交易所或纳斯达克，并且数百万美元依赖于它，那么您可能不应该对其进行虚拟化。确保您了解虚拟化 SQL 服务器的后果。

我已经看到人们一遍又一遍地虚拟化 SQL 只是因为虚拟化很酷。然后稍后在 VM 服务器未按预期执行时抱怨。

您需要做的是设置一个基准，全面测试您想要部署的解决方案并展示它可以做什么和不能做什么，这样您就不会遇到任何意外。虚拟化很棒，它有利于环境并通过整合节省成本，但是您需要向您的主管说明为什么您不应该虚拟化您的 SQL Server，并且只有您才能做到这一点。

# linux - 使用 automake 设置每个文件的标志

> ID：149324
> 
> 赞同：8
> 
> 时间：2008-09-29T15:52:21.617
> 
> 标签：linux, gcc, automake

有没有办法使用 automake 在每个文件的基础上设置标志？
特别是，如果我有一个 c++ 项目并且想要使用 -WAll 编译所有文件，除了我想要禁用特定警告的文件，我该怎么办？

我试过类似的东西：

```
CXXFLAGS = -WAll ...
bin_PROGRAMS = test
test_SOURCES = main.cpp utility.cpp
utility_o_CXXFLAGS = $(CXXFLAGS) -Wno-unused-value 
```

但它没有用。

已编辑：删除了对 automake 手册的引用，这实际上具有误导性（感谢 Douglas Leeder）。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2012-09-11T13:53:39.613

你不能这样做`automake`...但*可以这样做*=)将以`make`下行添加到您的`Makefile.am`：

```
utility.$(OBJEXT) : CXXFLAGS += -Wno-unused-value 
```

有关详细信息，请参阅[GNU Make 文档：特定于目标的变量值](http://www.gnu.org/software/make/manual/html_node/Target_002dspecific.html#Target_002dspecific)。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-14T14:34:54.270

Automake 仅支持每个目标标志，而您需要每个对象标志。一种解决方法是创建一个包含您的对象的小型库：

```
CXXFLAGS = -Wall ...
bin_PROGRAMS = test
test_SOURCES = main.cpp
test_LDADD = libutility.a
noinst_LIBRARIES = libutility.a
libutility_a_SOURCES = utility.cpp
libutility_a_CXXFLAGS = $(CXXFLAGS) -Wno-unused-value 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-29T17:00:16.367

您感到困惑-该部分指的是 automake 本身的选项。

这是一种设置 automake 命令行选项的方法：

> -W CATEGORY --warnings=category 输出属于类别的警告。类别可以是以下之一：
> 
> ```
> gnu
>     warnings related to the GNU Coding Standards (see Top).
> obsolete
>     obsolete features or constructions
> override
>     user redefinitions of Automake rules or variables
> portability
>     portability issues (e.g., use of make features that are known to be not portable)
> syntax
>     weird syntax, unused variables, typos
> unsupported
>     unsupported or incomplete features
> all
>     all the warnings
> none
>     turn off all the warnings
> error
>     treat warnings as errors 
> ```
> 
> 可以通过在其名称前加上“no-”来关闭类别。例如， -Wno-syntax 将隐藏有关未使用变量的警告。
> 
> 默认输出的类别是“语法”和“不支持”。此外，在 --gnu 和 --gnits 严格性中启用了 'gnu' 和 'portability'。
> 
> 环境变量 WARNINGS 可以包含以逗号分隔的要启用的类别列表。它会在命令行切换之前被考虑在内，这样 -Wnone 也将忽略任何由 WARNINGS 启用的警告类别。这个变量也被 autoconf 等其他工具使用；由于这个原因，未知类别被忽略。

第 17 节中列出的 per-file 指的是 per-Makefile 而不是源文件。

我不知道任何每个源文件的标志设置，但您可以为每个结果二进制文件设置选项：

```
binaryname_CXXFLAGS 
```

# c++ - “奇怪重复的模板模式”的实际用途

> ID：149336
> 
> 赞同：45
> 
> 时间：2008-09-29T15:54:49.567
> 
> 标签：c++, templates, design-patterns, crtp, f-bounded-polymorphism

[“奇怪重复的模板模式](http://en.wikipedia.org/wiki/Curiously_Recurring_Template_Pattern)”有哪些实际用途？通常显示的“[计数类](http://en.wikipedia.org/wiki/Curiously_Recurring_Template_Pattern#Object_counter)”示例对我来说并不是一个令人信服的示例。

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2008-09-29T16:03:32.353

[模拟动态绑定](http://c2.com/cgi/wiki?SimulatedDynamicBinding)。在保留一些分层优势的同时避免虚函数调用的成本对于可以在我目前正在从事的项目中完成的子系统来说是一个巨大的胜利。

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2008-09-29T16:19:01.973

**它对于mixin** （我的意思是你继承的类以提供功能）也特别有用，它们本身需要知道它们正在操作什么类型（因此需要是模板）。

在*Effective C++*中，Scott Meyers 提供了一个类模板 NewHandlerSupport<T> 作为示例。这包含一个静态方法来覆盖特定类的新处理程序（与 std::set_new_handler 对默认运算符 new 所做的相同），以及一个使用处理程序的运算符 new。为了提供每个类型的处理程序，父类需要知道它作用于什么类型，所以它需要是一个类模板。模板参数是子类。

如果没有 CRTP，您将无法真正做到这一点，因为您需要单独实例化 NewHandlerSupport 模板，并使用单独的静态数据成员来存储当前的 new_handler，每个使用它的类。

很明显，整个例子是非常非线程安全的，但它说明了这一点。

Meyers 认为 CRTP 可能被认为是“为我而做”。我想说这通常适用于任何 mixin，并且 CRTP 适用于您需要 mixin 模板而不仅仅是 mixin 类的情况。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-29T18:17:59.643

如果您认为仅在方法扩展时才需要传递给超类的子类类型，那么 CRTP 就不会那么好奇了。所以所有类型都被定义了。您只需要将符号子类类型导入超类的模式，但它只是一个前向声明 - 因为所有正式模板参数类型都是按定义的 - 就超类而言。

我们以稍微修改的形式使用，将特征类型结构中的子类传递给超类，以使超类可以返回派生类型的对象。该应用程序是一个几何微积分库（点、向量、线、框），其中所有通用功能都在超类中实现，子类只定义了一个特定类型：CFltPoint 继承自 TGenPoint。CFltPoint 也存在于 TGenPoint 之前，因此子类化是一种自然的重构方式。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-29T16:04:36.877

通常，它用于类似多态的模式，您不需要在运行时选择派生类，只需在编译时选择。这样可以节省运行时虚函数调用的开销。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-02T09:52:38.693

对于 CRTP 的实际库使用，请查看 ATL 和 WTL (wtl.sf.net)。它在那里被广泛用于编译时多态性。

# .net - .NET 中的 HTTP 身份验证

> ID：149337
> 
> 赞同：4
> 
> 时间：2008-09-29T15:54:52.220
> 
> 标签：.net, http, authentication

是否可以创建与以下代码等效的 .NET？

```
<?php
if (!isset($_SERVER['PHP_AUTH_USER'])) {
    header('WWW-Authenticate: Basic realm="My Realm"');
    header('HTTP/1.0 401 Unauthorized');
    echo 'Text to send if user hits Cancel button';
    exit;
} else {
    echo "<p>Hello {$_SERVER['PHP_AUTH_USER']}.</p>";
    echo "<p>You entered {$_SERVER['PHP_AUTH_PW']} as your password.</p>";
}
?> 
```

我也希望能够在 web.config 中定义静态用户/密码。这在 PHP 中很容易做到，在 MSDN 中没有看到任何解释如何做到这一点的东西。

* * *

我想要的是这个：

![https://i.stack.imgur.com/IJE1b.png](https://i.stack.imgur.com/IJE1b.png)

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-29T16:28:14.277

实现与 PHP 代码相同的最简单方法是通过[Reponse.AppendHeader()](http://msdn.microsoft.com/en-us/library/system.web.httpresponse.appendheader(VS.80).aspx)直接发送相同的标头。

我仍然建议您阅读[ASP.NET Forms Authentication Tutorial](http://www.asp.net/Learn/Security/)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-29T19:23:13.077

您需要在 ASP.NET 中实现基本身份验证，而不是上述响应者所说的表单身份验证。一个很好的例子[可以在这里找到](http://www.codeproject.com/KB/aspnet/mybasicauthentication.aspx)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-29T16:20:07.277

恐怕我帮不了你。除了在 IIS 中使用不同的安全设置（例如集成安全性（Windows 安全性））之外，我不知道如何获得这样的对话框。如果这就是您想要的，那么您需要进入 IIS 并禁用匿名访问，启用另一种身份验证类型，例如集成的、基本的，并且在您的代码中，您可以通过检查来验证它们是否已登录：

```
System.Security.Principal.WindowsIdentity.GetCurrent().IsAuthenticated 
```

尽管在这种情况下 IIS 负责验证。除此之外，我帮不了你。

如果你需要它，在 asp.net 中的 windows auth 链接：http: [//msdn.microsoft.com/en-us/library/ms998358.aspx](http://msdn.microsoft.com/en-us/library/ms998358.aspx)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-29T15:58:17.577

是的，您可以添加到 web.config 并使用表单身份验证。我不知道php，所以我无法回答你剩下的问题

[http://msdn.microsoft.com/en-us/library/aa720092(VS.71).aspx](http://msdn.microsoft.com/en-us/library/aa720092(VS.71).aspx) \

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-29T16:05:19.340

是的，您可以在 web.config 中指定凭据。ASP.NET 也有一个内置的会员系统，并有像登录这样的控件来使用它——尽管这与在 web.config 中设置静态凭据不同。

我认为做你所说的最简单的方法是保护 IIS 中的目录。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-29T16:06:54.920

我通常做自己的身份验证是针对我自己的数据库中的用户名和密码的 asp.net。对于我这样做的方式，我在页面上创建了一个用户名和密码对话框，并有一个登录按钮。在回发期间，我会执行以下操作：

```
if(SecurityHelper.LoginUser(txtUsername.Text, txtPassword.Text))
{
    FormsAuthentication.RedirectFromLoginPage(txtUsername.Text, true);
} 
```

记住这一点，你需要做的就是一样，检查用户名和密码是否符合你的要求，如果你想买，你甚至可以硬编码，我不推荐它。\如果它有效使用formsauthentication 类的静态方法。

# transactions - SQL Server 2000 和 System.Transactions.TransactionScope()

> ID：149339
> 
> 赞同：3
> 
> 时间：2008-09-29T15:55:04.557
> 
> 标签：transactions, sql-server-2000, transactionscope

是否可以使用带有 SQL2000 的 TransactionScope() 创建 LIGHTWEIGHT 事务？或者，如果没有，是否有使用 CommitableTransaction 和/或类似方法的解决方法？

所以答案基本上是，“如果你想在 SQL2000 上进行本地到 1 个服务器的事务，不要使用 TransactionScope()”。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-29T16:34:39.080

轻量级事务需要支持“可推广”事务。SQL Server 2000 根本不支持这一点。SQL Server 2005 中添加了可升级事务。

Florin Lazar发布了一个可以在特定场景中使用[的适配器。](http://blogs.msdn.com/florinlazar/archive/2005/09/29/fast-transactions-with-system-transactions-and-microsoft-sql-server-2000.aspx)您必须自己判断此适配器是否适合您的环境。

# sql-server-2008 - SQL 2008 中的新日期/时间数据类型

> ID：149346
> 
> 赞同：2
> 
> 时间：2008-09-29T15:56:57.003
> 
> 标签：sql-server-2008

我正在尝试在 SQL 2008 中使用新的 DATETIMEOFFSET 数据类型，但我不知道如何让 DATETIMEOFFSET '2008-09-27 21:28:17.2930000 -07:00' 显示为 '2008-09-27 14:28:17.2930000'（基本上应用偏移量来显示当地时间）。

有谁知道如何做到这一点？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-29T16:23:02.527

以下 MSDN 文章似乎涵盖了这一点：

*   [http://msdn.microsoft.com/en-us/library/bb384267.aspx](http://msdn.microsoft.com/en-us/library/bb384267.aspx)
*   [http://msdn.microsoft.com/en-us/library/bb630289.aspx](http://msdn.microsoft.com/en-us/library/bb630289.aspx)
*   [http://msdn.microsoft.com/en-us/library/ms187928.aspx](http://msdn.microsoft.com/en-us/library/ms187928.aspx)

看来您需要将 datetimeoffset 转换为另一种格式，例如 datetime，但“CAST and CONVERT”页面上的示例代码并不清楚。

# c# - 基于紧凑框架 DirectShow 的摄像头，带预览功能

> ID：149363
> 
> 赞同：1
> 
> 时间：2008-09-29T16:00:48.897
> 
> 标签：c#, .net, visual-studio

我有一个工作的 directshow 相机（不基于 CameraDialog）的示例（wimobot.org），但此示例不包括预览。我不知道如何实现预览的直接显示过滤器，C# 或 Visual Basic .Net 中的任何示例代码？

提前致谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-07-28T09:10:41.583

很抱歉回答了一个老问题，但我自己已经找了一段时间了，刚刚在这里遇到了 DirectShow .Net CF Wrapper：

[http://alexmogurenko.com/blog/directshownetcf/](http://alexmogurenko.com/blog/directshownetcf/)

# textbox - 如何在 Powerbuilder 文本框中添加上标字符？

> ID：149375
> 
> 赞同：2
> 
> 时间：2008-09-29T16:03:28.563
> 
> 标签：textbox, powerbuilder, datawindow

有没有办法在数据窗口的文本框的 Powerbuilder 属性窗口中执行此操作？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-29T18:24:02.360

这取决于您如何定义“文本框”，但通常混合普通文本和上标文本的唯一方法是使用富文本控件。在 PB 11.5 中，您甚至可以使用富文本作为列样式。

祝你好运，

特里。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-01T15:23:21.340

是的。对于文本控件，您必须选择具有上标字符的字体（Arial 可以）。

*   进入 Windows Character Map（通常在开始菜单中的 Accessories->System Tools 下）并选择您的字体。
*   然后转到要放置在文本控件中的上标字符。单击它，然后单击“选择”按钮将其放置在字符映射文本框中。
*   然后单击复制按钮。
*   现在您可以返回 PowerBuilder 并将该值粘贴到属性窗口文本区域。

只要为 DataWindow 控件选择的字体与在字符映射中选择的字体相同，它就应该显示为您的上标字符。

同样的技术也可以用来包含任何 Wingding 类型的字符。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-03T18:48:15.353

我们最终使用了两个单独的文本字段。这是一个丑陋的解决方案，但它有效。上标字段有一个较小的字体，并被推高一点。

我认为较新的 PB 版本支持上标。

谢谢您的帮助。

格伦

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-06-27T19:19:17.040

如果你去字符图 - 当你选择你的字符时，它会在窗口的右下角显示输入这个字符的键。

示例：Arial 字体 - `®`（注册）标记为`Alt`+ 0174

要输入这些，请打开您的数字锁，按住`alt`键，然后键入`0` `1` `7`&`4`然后松开`alt`键。您必须使用数字键盘上的数字键来执行此操作，键盘顶部的数字键不起作用。

然后，您可以直接输入字符或执行以下操作：

`ls_key = '®`'

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-07T19:03:42.163

实际上，我偶然发现了一个更简单的解决方案。我将 pdf 中的部分文本复制并粘贴到数据窗口文本控件的文本属性中。上标字符只是粘贴了。所以我猜道格曼的解决方案也可以。

示例：“™商标用于...”

注意：我使用的是 PB 9.0.1

感谢所有的帮助，格伦

# .net - 如何在 vb.net 中生成 Code39 条码

> ID：149379
> 
> 赞同：10
> 
> 时间：2008-09-29T16:03:59.153
> 
> 标签：.net, vb.net, barcode

我想从我的应用程序中创建 Code39 编码的条形码。

我知道我可以为此使用字体，但我不想这样做，因为我必须在服务器上注册字体，而且我有过一些非常糟糕的经历。

*我提出这个问题后产生的一个例子是在答案中*

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-10-01T09:03:26.030

这是我目前的代码隐藏，有很多评论：

```
Option Explicit On
Option Strict On

Imports System.Drawing
Imports System.Drawing.Imaging
Imports System.Drawing.Bitmap
Imports System.Drawing.Graphics
Imports System.IO

Partial Public Class Barcode
    Inherits System.Web.UI.Page
    'Sebastiaan Janssen - 20081001 - TINT-30584
    'Most of the code is based on this example: 
    'http://www.atalasoft.com/cs/blogs/loufranco/archive/2008/04/25/writing-code-39-barcodes-with-javascript.aspx-generation.aspx
    'With a bit of this thrown in:
    'http://www.atalasoft.com/cs/blogs/loufranco/archive/2008/03/24/code-39-barcode

    Private _encoding As Hashtable = New Hashtable
    Private Const _wideBarWidth As Short = 8
    Private Const _narrowBarWidth As Short = 2
    Private Const _barHeight As Short = 100

    Sub BarcodeCode39()
        _encoding.Add("*", "bWbwBwBwb")
        _encoding.Add("-", "bWbwbwBwB")
        _encoding.Add("$", "bWbWbWbwb")
        _encoding.Add("%", "bwbWbWbWb")
        _encoding.Add(" ", "bWBwbwBwb")
        _encoding.Add(".", "BWbwbwBwb")
        _encoding.Add("/", "bWbWbwbWb")
        _encoding.Add("+", "bWbwbWbWb")
        _encoding.Add("0", "bwbWBwBwb")
        _encoding.Add("1", "BwbWbwbwB")
        _encoding.Add("2", "bwBWbwbwB")
        _encoding.Add("3", "BwBWbwbwb")
        _encoding.Add("4", "bwbWBwbwB")
        _encoding.Add("5", "BwbWBwbwb")
        _encoding.Add("6", "bwBWBwbwb")
        _encoding.Add("7", "bwbWbwBwB")
        _encoding.Add("8", "BwbWbwBwb")
        _encoding.Add("9", "bwBWbwBwb")
        _encoding.Add("A", "BwbwbWbwB")
        _encoding.Add("B", "bwBwbWbwB")
        _encoding.Add("C", "BwBwbWbwb")
        _encoding.Add("D", "bwbwBWbwB")
        _encoding.Add("E", "BwbwBWbwb")
        _encoding.Add("F", "bwBwBWbwb")
        _encoding.Add("G", "bwbwbWBwB")
        _encoding.Add("H", "BwbwbWBwb")
        _encoding.Add("I", "bwBwbWBwb")
        _encoding.Add("J", "bwbwBWBwb")
        _encoding.Add("K", "BwbwbwbWB")
        _encoding.Add("L", "bwBwbwbWB")
        _encoding.Add("M", "BwBwbwbWb")
        _encoding.Add("N", "bwbwBwbWB")
        _encoding.Add("O", "BwbwBwbWb")
        _encoding.Add("P", "bwBwBwbWb")
        _encoding.Add("Q", "bwbwbwBWB")
        _encoding.Add("R", "BwbwbwBWb")
        _encoding.Add("S", "bwBwbwBWb")
        _encoding.Add("T", "bwbwBwBWb")
        _encoding.Add("U", "BWbwbwbwB")
        _encoding.Add("V", "bWBwbwbwB")
        _encoding.Add("W", "BWBwbwbwb")
        _encoding.Add("X", "bWbwBwbwB")
        _encoding.Add("Y", "BWbwBwbwb")
        _encoding.Add("Z", "bWBwBwbwb")
    End Sub

    Protected Sub Page_Load(ByVal sender As Object, ByVal e As System.EventArgs) Handles Me.Load
        BarcodeCode39()
        Dim barcode As String = String.Empty
        If Not IsNothing(Request("barcode")) AndAlso Not (Request("barcode").Length = 0) Then
            barcode = Request("barcode")
            Response.ContentType = "image/png"
            Response.AddHeader("Content-Disposition", String.Format("attachment; filename=barcode_{0}.png", barcode))

            'TODO: Depending on the length of the string, determine how wide the image will be
            GenerateBarcodeImage(250, 140, barcode).WriteTo(Response.OutputStream)
        End If
    End Sub

    Protected Function getBCSymbolColor(ByVal symbol As String) As System.Drawing.Brush
        getBCSymbolColor = Brushes.Black
        If symbol = "W" Or symbol = "w" Then
            getBCSymbolColor = Brushes.White
        End If
    End Function

    Protected Function getBCSymbolWidth(ByVal symbol As String) As Short
        getBCSymbolWidth = _narrowBarWidth
        If symbol = "B" Or symbol = "W" Then
            getBCSymbolWidth = _wideBarWidth
        End If
    End Function

    Protected Overridable Function GenerateBarcodeImage(ByVal imageWidth As Short, ByVal imageHeight As Short, ByVal Code As String) As MemoryStream
        'create a new bitmap
        Dim b As New Bitmap(imageWidth, imageHeight, Imaging.PixelFormat.Format32bppArgb)

        'create a canvas to paint on
        Dim canvas As New Rectangle(0, 0, imageWidth, imageHeight)

        'draw a white background
        Dim g As Graphics = Graphics.FromImage(b)
        g.FillRectangle(Brushes.White, 0, 0, imageWidth, imageHeight)

        'write the unaltered code at the bottom
        'TODO: truely center this text
        Dim textBrush As New SolidBrush(Color.Black)
        g.DrawString(Code, New Font("Courier New", 12), textBrush, 100, 110)

        'Code has to be surrounded by asterisks to make it a valid Code39 barcode
        Dim UseCode As String = String.Format("{0}{1}{0}", "*", Code)

        'Start drawing at 10, 10
        Dim XPosition As Short = 10
        Dim YPosition As Short = 10

        Dim invalidCharacter As Boolean = False
        Dim CurrentSymbol As String = String.Empty

        For j As Short = 0 To CShort(UseCode.Length - 1)
            CurrentSymbol = UseCode.Substring(j, 1)
            'check if symbol can be used
            If Not IsNothing(_encoding(CurrentSymbol)) Then
                Dim EncodedSymbol As String = _encoding(CurrentSymbol).ToString

                For i As Short = 0 To CShort(EncodedSymbol.Length - 1)
                    Dim CurrentCode As String = EncodedSymbol.Substring(i, 1)
                    g.FillRectangle(getBCSymbolColor(CurrentCode), XPosition, YPosition, getBCSymbolWidth(CurrentCode), _barHeight)
                    XPosition = XPosition + getBCSymbolWidth(CurrentCode)
                Next

                'After each written full symbol we need a whitespace (narrow width)
                g.FillRectangle(getBCSymbolColor("w"), XPosition, YPosition, getBCSymbolWidth("w"), _barHeight)
                XPosition = XPosition + getBCSymbolWidth("w")
            Else
                invalidCharacter = True
            End If
        Next

        'errorhandling when an invalidcharacter is found
        If invalidCharacter Then
            g.FillRectangle(Brushes.White, 0, 0, imageWidth, imageHeight)
            g.DrawString("Invalid characters found,", New Font("Courier New", 8), textBrush, 0, 0)
            g.DrawString("no barcode generated", New Font("Courier New", 8), textBrush, 0, 10)
            g.DrawString("Input was: ", New Font("Courier New", 8), textBrush, 0, 30)
            g.DrawString(Code, New Font("Courier New", 8), textBrush, 0, 40)
        End If

        'write the image into a memorystream
        Dim ms As New MemoryStream

        Dim encodingParams As New EncoderParameters
        encodingParams.Param(0) = New EncoderParameter(Encoder.Quality, 100)

        Dim encodingInfo As ImageCodecInfo = FindCodecInfo("PNG")

        b.Save(ms, encodingInfo, encodingParams)

        'dispose of the object we won't need any more
        g.Dispose()
        b.Dispose()

        Return ms
    End Function

    Protected Overridable Function FindCodecInfo(ByVal codec As String) As ImageCodecInfo
        Dim encoders As ImageCodecInfo() = ImageCodecInfo.GetImageEncoders
        For Each e As ImageCodecInfo In encoders
            If e.FormatDescription.Equals(codec) Then Return e
        Next
        Return Nothing
    End Function
End Class 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-09-29T16:12:50.367

如果您选择 Code39，您可能可以从我编写的这段代码中进行编码

[http://www.atalasoft.com/cs/blogs/loufranco/archive/2008/03/24/code-39-barcode-generation.aspx](http://www.atalasoft.com/cs/blogs/loufranco/archive/2008/03/24/code-39-barcode-generation.aspx)

我编写它是为了使用我们的工具包生成图像，但您可以很容易地重写它以使用 .NET Image/Graphics。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-09-29T16:50:38.497

我不了解图书馆——我所做的所有条形码工作都是使用条形码字体。如果您使用“3 of 9”格式，请查看[免费的 3-of-9 。](http://www.squaregear.net/fonts/free3of9.shtml)

3-of-9 的注意事项：

确保所有文本都是大写的，每个条形码都以星号开头和结尾

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-29T16:33:39.257

这是 .NET 语言的开源条形码渲染库：http: [//www.codeplex.com/BarcodeRender](http://www.codeplex.com/BarcodeRender)

它可以渲染一些常用的编码。

该许可证看起来不错，而且似乎在开源和商业应用程序中都可以使用（但是，IANAL，您可能想自己检查它的[许可证](http://www.codeplex.com/BarcodeRender/license)。）

这是另一个，也是开源的，使用 Apache 2.0 许可证：http: [//sourceforge.net/projects/onecode/](http://sourceforge.net/projects/onecode/)

一般来说，当你从一开始就知道你在寻找开源组件时，最好绕过谷歌，直接在[SourceForge上](http://sourceforge.net)搜索（它有一个很棒的搜索结果过滤系统，你可以按语言过滤，这可能是你感兴趣的给你）或微软的[CodePlex](http://www.codeplex.com/)（选择通常更有限，但你去。）

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-05T23:42:14.557

您要打印到标准打印机还是实际的条码打印机（zebra 或 datamax）？zebra 和 datamax 都有自己的脚本语言——实际上更像是标记语言。分别是 ZPL 和 DPL。我更喜欢斑马，他们的文档更干净。

如果您没有合法的条码打印机，我建议您购买一台并执行以下操作....（这比尝试构建小图像块并绘制它们以模拟条码字体要干净得多）

两者都为您提供了极大的灵活性，并且您可以让打印机处理创建实际的条形码图像。

让您的程序通过 ftp 向打印机发送一个自定义的 ZPL/DPL 脚本，其中包括您希望作为条形码打印的值。基本上，您只需将包含脚本的文本文件“放入”打印机的 IP，打印机就会处理字体。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-17T05:57:50.537

[iTextSharp](http://itextsharp.sourceforge.net/)库虽然表面上用于创建 PDF，但也有一个包含 Code39 的条形码生成库。

添加对 DLL 的引用后，它很简单：

```
Barcode39 code39 = new Barcode39();
code39.Code = "Whatever You're Encoding"; 
```

糟糕，那是 C#，但你明白了。创建后，您可以以几乎任何图像格式渲染图像并根据需要使用它。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-29T16:57:27.827

如果您渲染客户端，则字体可以驻留在工作站上。这样您就可以使用 3-of-9。我在几个项目中使用了 3-of-9 和最简单的解决方案。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2014-11-13T04:12:07.833

这是[如何在 vb.net 中生成 Code39 条形码](http://www.barcodelib.com/vb_net/)的示例。我现在测试了它，它可以工作。

```
 Public Class code39
    Private bitsCode As ArrayList

    Public Sub New()
        bitsCode = New ArrayList
        bitsCode.Add(New String(3) {"0001101", "0100111", "1110010", "000000"})
        bitsCode.Add(New String(3) {"0011001", "0110011", "1100110", "001011"})
        bitsCode.Add(New String(3) {"0010011", "0011011", "1101100", "001101"})
        bitsCode.Add(New String(3) {"0111101", "0100001", "1000010", "001110"})
        bitsCode.Add(New String(3) {"0100011", "0011101", "1011100", "010011"})
        bitsCode.Add(New String(3) {"0110001", "0111001", "1001110", "011001"})
        bitsCode.Add(New String(3) {"0101111", "0000101", "1010000", "011100"})
        bitsCode.Add(New String(3) {"0111011", "0010001", "1000100", "010101"})
        bitsCode.Add(New String(3) {"0110111", "0001001", "1001000", "010110"})
        bitsCode.Add(New String(3) {"0001011", "0010111", "1110100", "011010"})
    End Sub

    Public Function Generate(ByVal Code As String) As Image
        Dim a As Integer = 0
        Dim b As Integer = 0
        Dim imgCode As Image
        Dim g As Graphics
        Dim i As Integer
        Dim bCode As Byte()
        Dim bitCode As Byte()
        Dim tmpFont As Font

        If Code.Length <> 12 Or Not IsNumeric(Code.Replace(".", "_").Replace(",", "_")) Then Throw New Exception("Le code doit être composé de 12 chiffres")

        ReDim bCode(12)
        For i = 0 To 11
            bCode(i) = CInt(Code.Substring(i, 1))
            If (i Mod 2) = 1 Then
                b += bCode(i)
            Else
                a += bCode(i)
            End If
        Next

        i = (a + (b * 3)) Mod 10
        If i = 0 Then
            bCode(12) = 0
        Else
            bCode(12) = 10 - i
        End If
        bitCode = getBits(bCode)

        tmpFont = New Font("times new roman", 14, FontStyle.Regular, GraphicsUnit.Pixel)
        imgCode = New Bitmap(110, 50)
        g = Graphics.FromImage(imgCode)
        g.Clear(Color.White)

        g.DrawString(Code.Substring(0, 1), tmpFont, Brushes.Black, 2, 30)
        a = g.MeasureString(Code.Substring(0, 1), tmpFont).Width

        For i = 0 To bitCode.Length - 1
            If i = 2 Then
                g.DrawString(Code.Substring(1, 6), tmpFont, Brushes.Black, a, 30)
            ElseIf i = 48 Then
                g.DrawString(Code.Substring(7, 5) & bCode(12).ToString, tmpFont, Brushes.Black, a, 30)
            End If

            If i = 0 Or i = 2 Or i = 46 Or i = 48 Or i = 92 Or i = 94 Then
                If bitCode(i) = 1 Then 'noir
                    g.DrawLine(Pens.Black, a, 0, a, 40)
                    a += 1
                End If
            Else
                If bitCode(i) = 1 Then 'noir
                    g.DrawLine(Pens.Black, a, 0, a, 30)
                    a += 1
                Else 'blanc
                    a += 1
                End If
            End If
        Next
        g.Flush()
        Return imgCode
    End Function

    Private Function getBits(ByVal bCode As Byte()) As Byte()
        Dim i As Integer
        Dim res As Byte()
        Dim bits As String = "101"
        Dim cle As String = bitsCode(bCode(0))(3)
        For i = 1 To 6
            bits &= bitsCode(bCode(i))(CInt(cle.Substring(i - 1, 1)))
        Next
        bits &= "01010"
        For i = 7 To 12
            bits &= bitsCode(bCode(i))(2)
        Next
        bits += "101"
        ReDim res(bits.Length - 1)
        For i = 0 To bits.Length - 1
            res(i) = Asc(bits.Chars(i)) - 48
        Next
        Return res
    End Function

End Class 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2015-01-12T06:01:38.667

而不是使用条形码字体，我更喜欢[.net 条形码生成器组件](http://www.pqscan.com/barcode-creator/)。下面是[用于创建 Code 39 条码的 vb.net 示例](http://www.pqscan.com/generate-barcode/csharp-vb.html)。

```
Imports System.IO
Imports PQScan.BarcodeCreator

Namespace BarcodeGeneratorVB
Class Program
    Private Shared Sub Main(args As String())
        Dim barcode As New Barcode()

        barcode.Data = "www.pqscan.com"
        barcode.BarType = BarCodeType.Code39
        barcode.Width = 300
        barcode.Height = 100

        barcode.CreateBarcode("code39-vb.jpeg")
    End Sub
End Class
End Namespace 
```

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2008-09-29T16:14:14.327

在我的上一份工作中，我为此在 vb.net 中使用了几个不同的库。我们有一个，然后搬到了另一个。我不记得他们的名字（如果我看到他们我会再次认出他们），但我知道*两者*都是付费的，我们在切换时评估了几个不同的组件，我认为其中包括免费一。我们是一家*非常*小的商店，对成本*非常*敏感，所以如果免费组件有任何好处，您可以打赌我们会使用它（我认为我们需要 128b 支持，它只处理 code39）。

我还记得我们切换的原因是在我们从 .Net 1.1 迁移到 .Net 2.0 的同时，第一个组件在转换时太慢了。

所以，总而言之，那里有一些东西，但在 3 年前并不是什么好事。希望其他人可以过来填写一些实际姓名。

# sql - SQL 存储过程中的动态排序

> ID：149380
> 
> 赞同：132
> 
> 时间：2008-09-29T16:04:19.683
> 
> 标签：sql, tsql, stored-procedures, sorting

这是我过去花费数小时研究的问题。[在我看来，现代RDBMS](http://en.wikipedia.org/wiki/Relational_database_management_system)解决方案应该解决的问题，但到目前为止，我还没有发现任何东西可以真正解决我认为在任何具有数据库后端的 Web 或 Windows 应用程序中非常普遍的需求。

我说的是动态排序。在我的幻想世界中，它应该像这样简单：

```
ORDER BY @sortCol1, @sortCol2 
```

这是新手 SQL 和[存储过程](http://en.wikipedia.org/wiki/Stored_procedure)开发人员在 Internet 上的各个论坛上给出的典型示例。“为什么这不可能？” 他们问。`ORDER BY`总是有人最终过来向他们讲授存储过程的编译性质、一般的执行计划，以及不能将参数直接放入子句的各种其他原因。

* * *

我知道你们中的一些人已经在想什么：“那么让客户进行分类吧。” 自然地，这会从您的数据库中卸载工作。不过，在我们的案例中，我们的数据库服务器在 99% 的时间里都没有出过汗，它们甚至还不是多核的，也不是每 6 个月对系统架构进行的任何其他无数改进。仅出于这个原因，让我们的数据库处理排序不会有问题。此外，数据库*非常*善于分类。他们针对它进行了优化，并且多年来一直在做正确的事情，执行它的语言非常灵活、直观和简单，最重要的是任何初学者 SQL 编写者都知道如何去做，更重要的是他们知道如何编辑它，进行更改，进行维护等。当您的数据库远没有被征税并且您只想简化（并缩短！）开发时间时，这似乎是一个明显的选择。

然后是网络问题。我玩过 JavaScript 可以对 HTML 表进行客户端排序，但它们不可避免地不够灵活，无法满足我的*需求*很难证明重写或滚动我自己的 JavaScript 排序器所花费的时间是合理的。服务器端排序通常也是如此，尽管它可能已经比 JavaScript 更受欢迎。我不是特别喜欢 DataSets 开销的人，所以起诉我。

但这又带回了不可能的观点——或者更确切地说，不容易。在以前的系统中，我已经完成了一种令人难以置信的动态排序方式。它既不漂亮，也不直观、简单或灵活，并且初学者 SQL 编写者会在几秒钟内迷失方向。这已经不是一个“解决方案”，而是一个“并发症”。

* * *

以下示例并不意味着展示任何最佳实践或良好的编码风格或任何东西，也不代表我作为 T-SQL 程序员的能力。它们就是它们，我完全承认它们令人困惑，形式不好，而且只是简单的黑客攻击。

我们将一个整数值作为参数传递给存储过程（让我们将参数称为“排序”），并从中确定一堆其他变量。例如...假设 sort 为 1 （或默认值）：

```
DECLARE @sortCol1 AS varchar(20)
DECLARE @sortCol2 AS varchar(20)
DECLARE @dir1 AS varchar(20)
DECLARE @dir2 AS varchar(20)
DECLARE @col1 AS varchar(20)
DECLARE @col2 AS varchar(20)

SET @col1 = 'storagedatetime';
SET @col2 = 'vehicleid';

IF @sort = 1                -- Default sort.
BEGIN
    SET @sortCol1 = @col1;
    SET @dir1 = 'asc';
    SET @sortCol2 = @col2;
    SET @dir2 = 'asc';
END
ELSE IF @sort = 2           -- Reversed order default sort.
BEGIN
    SET @sortCol1 = @col1;
    SET @dir1 = 'desc';
    SET @sortCol2 = @col2;
    SET @dir2 = 'desc';
END 
```

您已经可以看到，如果我声明更多 @colX 变量来定义其他列，我真的可以根据“sort”的值对要排序的列进行创意......使用它，它通常最终看起来像下面令人难以置信的混乱条款：

```
ORDER BY
    CASE @dir1
        WHEN 'desc' THEN
            CASE @sortCol1
                WHEN @col1 THEN [storagedatetime]
                WHEN @col2 THEN [vehicleid]
            END
    END DESC,
    CASE @dir1
        WHEN 'asc' THEN
            CASE @sortCol1
                WHEN @col1 THEN [storagedatetime]
                WHEN @col2 THEN [vehicleid]
            END
    END,
    CASE @dir2
        WHEN 'desc' THEN
            CASE @sortCol2
                WHEN @col1 THEN [storagedatetime]
                WHEN @col2 THEN [vehicleid]
            END
    END DESC,
    CASE @dir2
        WHEN 'asc' THEN
            CASE @sortCol2
                WHEN @col1 THEN [storagedatetime]
                WHEN @col2 THEN [vehicleid]
            END
    END 
```

显然，这是一个非常精简的例子。真正的东西，因为我们通常有四到五列来支持排序，除此之外，每列可能还有第二列甚至第三列（例如日期降序，然后按名称升序排序），并且每列都支持双列定向排序，有效地使案例数量增加一倍。是的……它很快就长毛了。

这个想法是，人们可以“轻松”更改排序情况，以便在 storagedatetime 之前对车辆 ID 进行排序......但伪灵活性，至少在这个简单的例子中，真的到此为止。本质上，每个未通过测试的案例（因为我们的排序方法这次不适用于它）呈现一个 NULL 值。因此，您最终会得到一个功能如下的子句：

```
ORDER BY NULL DESC, NULL, [storagedatetime] DESC, blah blah 
```

你明白了。它之所以有效，是因为 SQL Server 按子句的顺序有效地忽略了空值。这很难维护，任何对 SQL 有任何基本工作知识的人都可能看到。如果我失去了你们中的任何一个，请不要难过。我们花了很长时间才让它工作，但我们仍然对尝试编辑它或创建类似的新东西感到困惑。值得庆幸的是，它不需要经常更改，否则它很快就会变得“不值得麻烦”。

然而它*确实*奏效了。

* * *

我的问题是： **有没有更好的方法？**

我对存储过程以外的解决方案没有意见，因为我意识到这可能不是要走的路。最好，我想知道是否有人可以在存储过程中做得更好，但如果没有，你们都如何处理让用户使用 ASP.NET 动态排序数据表（也可以双向）？

感谢您阅读（或至少略读）这么长的问题！

PS：很高兴我没有展示我的存储过程示例，该示例支持动态排序、列的动态过滤/文本搜索、通过 ROWNUMBER() OVER 进行分页，*并*尝试...捕获错误时的事务回滚... “庞然大物”甚至还没有开始描述它们。

* * *

**更新：**

*   我想**避免动态 SQL**。将字符串解析在一起并在其上运行 EXEC 会首先破坏存储过程的许多目的。有时我想知道这样做的缺点是否不值得，至少在这些特殊的动态排序情况下。尽管如此，每当我做这样的动态 SQL 字符串时，我总是觉得很脏——就像我仍然生活在经典的 ASP 世界中一样。
*   我们首先需要存储过程的很多原因是为了**安全**。我不能就安全问题打电话，只建议解决方案。使用 SQL Server 2005，我们可以在架构级别对单个存储过程设置权限（如果需要，基于每个用户），然后直接拒绝对表的任何查询。批评这种方法的利弊也许是另一个问题，但这又不是我的决定。我只是主要的代码猴子。:)

* * *

## 回答 #1

> 赞同：103
> 
> 时间：2008-09-29T16:42:13.197

是的，这很痛苦，而且您的操作方式与我的操作方式相似：

```
order by
case when @SortExpr = 'CustomerName' and @SortDir = 'ASC' 
    then CustomerName end asc, 
case when @SortExpr = 'CustomerName' and @SortDir = 'DESC' 
    then CustomerName end desc,
... 
```

对我来说，这仍然比从代码构建动态 SQL 要好得多，后者变成了 DBA 的可扩展性和维护噩梦。

我从代码中所做的是重构分页和排序，所以我至少没有太多的重复和填充`@SortExpr`值`@SortDir`。

就 SQL 而言，保持不同存储过程之间的设计和格式相同，这样至少在您进行更改时它是整洁和可识别的。

* * *

## 回答 #2

> 赞同：23
> 
> 时间：2008-09-30T04:35:39.333

这种方法可以防止可排序的列按顺序重复两次，并且在 IMO 中更具可读性：

```
SELECT
  s.*
FROM
  (SELECT
    CASE @SortCol1
      WHEN 'Foo' THEN t.Foo
      WHEN 'Bar' THEN t.Bar
      ELSE null
    END as SortCol1,
    CASE @SortCol2
      WHEN 'Foo' THEN t.Foo
      WHEN 'Bar' THEN t.Bar
      ELSE null
    END as SortCol2,
    t.*
  FROM
    MyTable t) as s
ORDER BY
  CASE WHEN @dir1 = 'ASC'  THEN SortCol1 END ASC,
  CASE WHEN @dir1 = 'DESC' THEN SortCol1 END DESC,
  CASE WHEN @dir2 = 'ASC'  THEN SortCol2 END ASC,
  CASE WHEN @dir2 = 'DESC' THEN SortCol2 END DESC 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-09-29T16:28:43.043

动态 SQL 仍然是一种选择。您只需要决定该选项是否比您目前拥有的更可口。

这是一篇文章，显示：[http](http://www.4guysfromrolla.com/webtech/010704-1.shtml) ://www.4guysfromrolla.com/webtech/010704-1.shtml 。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-09-29T19:08:38.103

我的应用程序经常这样做，但它们都在动态构建 SQL。但是，当我处理存储过程时，我会这样做：

1.  使存储过程成为返回值表的函数 - 无排序。
2.  然后在您的应用程序代码中执行一个`select * from dbo.fn_myData() where ... order by ...`，以便您可以在那里动态指定排序顺序。

然后至少动态部分在您的应用程序中，但数据库仍在做繁重的工作。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2010-08-02T17:17:19.353

我用来避免某些作业的动态 SQL 的存储过程技术（hack？）是拥有一个唯一的排序列。IE，

```
SELECT
   name_last,
   name_first,
   CASE @sortCol WHEN 'name_last' THEN [name_last] ELSE 0 END as mySort
FROM
   table
ORDER BY 
    mySort 
```

这个很容易被击败——您可以在 mySort 列中连接字段，使用数学或日期函数反转顺序等。

不过，在从 Sql-Server 检索数据之后，我最好使用我的 asp.net gridviews 或其他具有内置排序的对象来为我进行排序。或者即使它不是内置的——例如，asp.net 中的数据表等。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-09-29T16:49:52.617

可能还有第三种选择，因为您的服务器有很多空闲周期 - 使用帮助程序通过临时表进行排序。就像是

```
create procedure uspCallAndSort
(
    @sql varchar(2048),        --exec dbo.uspSomeProcedure arg1,'arg2',etc.
    @sortClause varchar(512)    --comma-delimited field list
)
AS
insert into #tmp EXEC(@sql)
declare @msql varchar(3000)
set @msql = 'select * from #tmp order by ' + @sortClause
EXEC(@msql)
drop table #tmp
GO 
```

警告：我没有对此进行测试，但它“应该”在 SQL Server 2005 中工作（它将从结果集中创建一个临时表，而无需提前指定列。）

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-09-29T22:17:55.760

有几种不同的方法可以破解它。

先决条件：

1.  sp 中只有一个 SELECT 语句
2.  省略任何排序（或有默认值）

然后插入临时表：

```
create table #temp ( your columns )

insert #temp
exec foobar

select * from #temp order by whatever 
```

方法#2：将链接服务器设置回自身，然后使用 openquery 从中选择：http: [//www.sommarskog.se/share_data.html#OPENQUERY](http://www.sommarskog.se/share_data.html#OPENQUERY)

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-09-29T18:00:51.887

我同意，使用客户端。但这似乎不是您想听到的答案。

所以，它是完美的方式。我不知道你为什么要改变它，甚至问“有没有更好的方法”。真的，它应该被称为“道”。此外，它似乎可以很好地满足项目的需求，并且可能在未来几年内具有足够的可扩展性。由于您的数据库没有征税并且排序*非常容易*，因此在未来几年内应该保持这种状态。

我不会出汗的。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-09-29T16:27:11.690

在某些时候，离开存储过程而只使用参数化查询来避免这种黑客行为难道不值得吗？

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2009-05-07T20:13:11.347

当您对排序结果进行分页时，动态 SQL 是一个不错的选择。如果您对 SQL 注入有疑虑，您可以使用列号而不是列名。在使用负值进行降序之前，我已经这样做了。像这样的东西...

```
declare @o int;
set @o = -1;

declare @sql nvarchar(2000);
set @sql = N'select * from table order by ' + 
    cast(abs(@o) as varchar) + case when @o < 0 then ' desc' else ' asc' end + ';'

exec sp_executesql @sql 
```

然后你只需要确保数字在 1 到 # 列之间。您甚至可以将其扩展为列号列表，并使用类似[这样](http://www.sommarskog.se/arrays-in-sql-2005.html#iterative)的函数将其解析为整数表。然后你会像这样构建order by子句......

```
declare @cols varchar(100);
set @cols = '1 -2 3 6';

declare @order_by varchar(200)

select @order_by = isnull(@order_by + ', ', '') + 
        cast(abs(number) as varchar) + 
        case when number < 0 then ' desc' else '' end
from dbo.iter_intlist_to_tbl(@cols) order by listpos

print @order_by 
```

一个缺点是您必须记住客户端每列的顺序。特别是当您不显示所有列或以不同的顺序显示它们时。当客户端想要排序时，您将列名映射到列顺序并生成整数列表。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2014-01-07T18:56:25.250

反对在客户端进行排序的一个论点是大量数据和分页。一旦您的行数超出了您可以轻松显示的范围，您通常会作为跳过/拍摄的一部分进行排序，您可能希望在 SQL 中运行。

对于实体框架，您可以使用存储过程来处理您的文本搜索。如果您遇到相同的排序问题，我看到的解决方案是使用存储过程进行搜索，只返回匹配的 id 键集。接下来，使用列表（包含）中的 id 对数据库重新查询（使用排序）。即使 ID 集非常大，EF 也能很好地处理这个问题。是的，这是两次往返，但它允许您始终将排序保留在数据库中，这在某些情况下可能很重要，并阻止您在存储过程中编写大量逻辑。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-09-29T16:06:57.477

如何处理显示结果的东西（网格、报告等）而不是 SQL 的排序？

**编辑：**

自从这个答案早些时候被否决以来，为了澄清事情，我将详细说明......

你说你知道客户端排序，但想避开它。当然，那是你的决定。

不过，我想指出的是，通过在客户端执行此操作，您可以一次提取数据，然后根据需要使用它——而不是每次来回多次往返于服务器排序发生了变化。

您的 SQL Server 现在没有被征税，这太棒了。不应该。但仅仅因为它没有超载并不意味着它会永远保持这种状态。

如果您正在使用任何较新的 ASP.NET 内容在 Web 上显示，那么其中的很多内容已经融入其中。

是否值得为每个存储过程添加这么多代码来处理排序？再次，您的电话。

我不是最终负责支持它的人。但是考虑一下当在存储过程使用的各种数据集中添加/删除列时会涉及什么（需要修改 CASE 语句），或者当用户突然而不是按两列排序时，用户决定他们需要三个——要求您现在更新使用此方法的每个存储过程。

对我来说，获得一个有效的客户端解决方案并将其应用于少数面向用户的数据显示并完成它是值得的。如果添加了新列，则它已被处理。如果用户想按多列排序，他们可以按其中的两列或二十列排序。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2018-12-19T22:46:31.723

抱歉，我迟到了，但对于那些真正想要避免使用动态 SQL，但又想要它提供的灵活性的人来说，这是另一种选择：

与其动态生成 SQL，不如编写代码为每个可能的变化生成一个唯一的过程。然后您可以在代码中编写一个方法来查看搜索选项并让它选择适当的过程来调用。

如果您只有一些变化，那么您可以手动创建 proc。但是，如果您有很多变体，那么不必维护它们，您只需维护您的 proc 生成器，而不是让它重新创建它们。

作为一个额外的好处，您将获得更好的 SQL 计划，从而获得更好的性能。

* * *

## 回答 #14

> 赞同：-1
> 
> 时间：2008-09-30T04:11:00.500

这个解决方案可能只适用于.NET，我不知道。

我使用 SQL order by 子句中的初始排序顺序将数据提取到 C# 中，将该数据放入 DataView 中，将其缓存在 Session 变量中，并使用它来构建页面。

当用户单击列标题进行排序（或分页或过滤）时，我不会返回数据库。相反，我返回缓存的 DataView 并将其“排序”属性设置为我动态构建的表达式，就像我使用动态 SQL 一样。（我使用“RowFilter”属性以相同的方式进行过滤）。

[您可以在http://ifdefined.com/btnet/bugs.aspx](http://ifdefined.com/btnet/bugs.aspx)上的我的应用程序 BugTracker.NET 的演示中看到/感觉到它正在工作

* * *

## 回答 #15

> 赞同：-8
> 
> 时间：2008-09-30T04:16:48.020

除非必要，否则应避免 SQL Server 排序。为什么不在应用服务器或客户端排序？.NET Generics 也进行了特殊的排序

# objective-c - performSelectorOnMainThread 实现的底层细节：

> ID：149388
> 
> 赞同：8
> 
> 时间：2008-09-29T16:06:29.180
> 
> 标签：objective-c, cocoa

想知道是否有人知道或有指向讨论 Cocoa 的“performSelectorOnMainThread：”方法的低级实现细节的好文档的指针。

我最好的猜测，我认为可能非常接近的猜测是，它使用 mach 端口或在它们之上的抽象来提供线程内通信，将选择器信息作为 mach 消息的一部分传递。

对？错误的？谢谢！

**更新 09:39AMPST**

谢谢 Evan DiBiase 和 Mecki 的回答，但要澄清一下：我了解运行循环中发生的情况，但我正在寻找的答案是；“方法*在哪里*排队？选择器信息*如何*传递到队列中？” 寻找的不仅仅是 Apple 的文档信息：我读过它们

**太平洋标准时间 14:21 更新**

Chris Hanson 在评论中提出了一个很好的观点：我的目标不是为了在我自己的代码中利用它们而学习底层机制。相反，我只是对更好地理解向另一个线程发出信号以执行代码的过程的概念性理解感兴趣。正如我所说，我自己的研究使我相信它利用了 IPC 的 mach 消息传递在线程之间传递选择器信息，但我专门寻找关于正在发生的事情的**具体**信息，所以我可以确定我理解事情*正确*。谢谢！

**2009 年 3 月 6 日更新**

我在这个问题上开了一个赏金，因为我真的很想看到它得到回答，但如果你想收集，请确保你阅读了**所有内容**，包括所有当前提出的答案，对这些答案和我的原始问题的评论，以及我在上面发布的更新文本。我正在寻找by 等使用的机制的**最低级别细节**`performSelectorOnMainThread:`，正如我之前提到的，我怀疑它与 Mach 端口有关，但我真的很想知道。**除非我能确认**给出的答案是正确的，否则不会授予赏金。谢谢大家！

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-03-06T20:30:09.390

Yes, it does use Mach ports. What happens is this:

1.  A block of data encapsulating the perform info (the target object, the selector, the optional object argument to the selector, etc.) is enqueued in the thread's run loop info. This is done using `@synchronized`, which ultimately uses `pthread_mutex_lock`.
2.  CFRunLoopSourceSignal is called to signal that the source is ready to fire.
3.  CFRunLoopWakeUp is called to let the main thread's run loop know it's time to wake up. This is done using mach_msg.

From the Apple docs:

> Version 1 sources are managed by the run loop and kernel. These sources use Mach ports to signal when the sources are ready to fire. A source is automatically signaled by the kernel when a message arrives on the source’s Mach port. The contents of the message are given to the source to process when the source is fired. The run loop sources for CFMachPort and CFMessagePort are currently implemented as version 1 sources.

I'm looking at a stack trace right now, and this is what it shows:

```
0 mach_msg
1 CFRunLoopWakeUp
2 -[NSThread _nq:]
3 -[NSObject(NSThreadPerformAdditions) performSelector:onThread:withObject:waitUntilDone:modes:]
4 -[NSObject(NSThreadPerformAdditions) performSelectorOnMainThread:withObject:waitUntilDone:] 
```

Set a breakpoint on mach_msg and you'll be able to confirm it.

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-29T16:21:12.000

[NSObject`performSelectorOnMainThread:withObject:waitUntilDone:`方法](http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSObject_Class/Reference/Reference.html#//apple_ref/occ/instm/NSObject/performSelectorOnMainThread:withObject:waitUntilDone:)的文档说：

> 此方法使用默认的运行循环模式（即与[NSRunLoopCommonModes](http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSRunLoop_Class/Reference/Reference.html#//apple_ref/c/data/NSRunLoopCommonModes)常量关联的模式）在主线程的运行循环上对消息进行排队。作为其正常运行循环处理的一部分，主线程将消息出列（假设它以默认运行循环模式之一运行）并调用所需的方法。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-29T16:27:13.373

又一编辑：

要回答评论的问题：

> 使用什么 IPC 机制在线程之间传递信息？共享内存？插座？马赫消息？

NSThread 在内部存储对主线程的引用，通过该引用，您可以获得对该线程的 NSRunloop 的引用。NSRunloop 内部是一个链表，通过将 NSTimer 对象添加到运行循环，一个新的链表元素被创建并添加到列表中。所以你可以说它是共享内存，实际上属于主线程的链表只是从不同的线程中修改。有互斥锁/锁（甚至可能是 NSLock 对象）可以确保编辑链表是线程安全的。

伪代码：

```
// Main Thread

for (;;) {
    lock(runloop->runloopLock);
    task = NULL;
    do {
        task = getNextTask(runloop);
        if (!task) {
            // function below unlocks the lock and
            // atomically sends thread to sleep.
            // If thread is woken up again, it will
            // get the lock again before continuing
            // running. See "man pthread_cond_wait"
            // as an example function that works
            // this way
            wait_for_notification(runloop->newTasks, runloop->runloopLock);
        }
    } while (!task);
    unlock(runloop->runloopLock);
    processTask(task);
}

// Other thread, perform selector on main thread
// selector is char *, containing the selector
// object is void *, reference to object

timer = createTimerInPast(selector, object);
runloop = getRunloopOfMainThread();
lock(runloop->runloopLock);
addTask(runloop, timer);
wake_all_sleeping(runloop->newTasks);
unlock(runloop->runloopLock); 
```

当然这过于简单了，大部分细节都隐藏在函数之间。例如 getNextTask 将只返回一个计时器，如果计时器应该已经触发。如果每个计时器的触发日期仍在未来，并且没有其他要处理的事件（如键盘、来自 UI 的鼠标事件或发送的通知），它将返回 NULL。

* * *

我仍然不确定问题是什么。**选择器**只不过是一个包含被调用方法名称的 C 字符串。每个方法都是一个普通的 C 函数，并且存在一个字符串表，其中包含方法名称作为字符串和函数指针。这就是 Objective-C 实际工作的基本原理。

正如我在下面写的，创建了一个 NSTimer 对象，它获取一个指向目标对象的指针和一个指向包含方法名称的 C 字符串的指针，当计时器触发时，它会使用字符串表找到要调用的正确 C 方法（因此它需要目标对象的方法的字符串名称）（因此它需要对它的引用）。

不完全是实现，但非常接近它：

Cocoa 中的每个线程都有一个 NSRunLoop（它总是在那里，你永远不需要为线程创建）。PerformSelectorOnMainThread 创建一个像[这样](http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSTimer_Class/Reference/NSTimer.html#//apple_ref/occ/instm/NSTimer/initWithFireDate:interval:target:selector:userInfo:repeats:)的 NSTimer 对象，它只触发一次并且触发时间已经位于过去（因此它需要立即触发），然后获取主线程的 NSRunLoop 并在那里添加计时器对象。一旦主线程*空闲*，它会在其 Runloop 中搜索下一个要处理的事件（如果没有要处理的内容，则进入睡眠状态，并在添加事件后立即再次唤醒）并执行它。调度调用时主线程正忙，在这种情况下，它会在完成当前任务后立即处理计时器事件，或者此时它正在休眠，在这种情况下，它将通过添加事件来唤醒并立即处理。

了解 Apple*最有可能如何做到这一点*的一个很好的来源（没有人可以肯定地说，毕竟它是封闭的源代码）是 GNUStep。由于 GCC 可以处理 Objective-C（它不仅仅是 Apple 提供的扩展，甚至标准的 GCC 也可以处理），然而，没有 Apple 提供的所有基本类的 Obj-C 是相当无用的，GNU 社区试图重新- 实现您在 Mac 上使用的最常见的 Obj-C 类，它们的实现是开源的。

[在这里](ftp://ftp.gnustep.org/pub/daily-snapshots/core.20080925.tar.bz2)您可以下载最近的源包。

将其解压缩并查看 NSThread、NSObject 和 NSTimer 的实现以了解详细信息。我猜 Apple 的做法并没有太大的不同，我可能可以使用 gdb 来证明这一点，但为什么他们的做法与这种方法有很大不同呢？这是一种非常有效的聪明方法:)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-29T23:20:33.037

# winforms - Winforms 线程问题，第二个线程无法访问第一个主窗体控件

> ID：149394
> 
> 赞同：7
> 
> 时间：2008-09-29T16:08:45.040
> 
> 标签：winforms, multithreading

我有一个 winforms 应用程序，问题与线程有关。因为我正在调用'MyCustomCode() 来创建一个新线程，并调用方法'SomeMethod()'，然后访问MessageBox.Show(...)。

问题与线程有关，因为新创建的线程试图访问在另一个线程上创建的控件。

我收到错误消息：

跨线程操作无效：控件“TestForm”从创建它的线程以外的线程访问。

```
public TestForm()
{
    InitializeComponent();

    // custom code
    //
    MyCustomCode();

}

public void SomeMethod()
{

    // ***** This causes an error  ****

    MessageBox.Show(this,   
        ex.Message, 
        "Error", 
        MessageBoxButtons.OK, 
        MessageBoxIcon.Error
    );
}

private void InitializeAutoUpdater()
{
        // Seperate thread is spun to keep polling for updates
        ThreadStart ts = new ThreadStart(SomeMethod);
        pollThread = new Thread(ts);
        pollThread.Start();
} 
```

**更新**

如果您查看此示例[http://www.codeproject.com/KB/cs/vanillaupdaterblock.aspx](http://www.codeproject.com/KB/cs/vanillaupdaterblock.aspx)，则 CheckAndUpdate 方法正在调用 MessageBox.Show(..) 这就是我的问题。我原以为代码很好用！

**有趣的**是，这段代码在星期五工作得很好？？？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-09-29T16:11:53.783

您不能从多个线程访问 UI 元素。

解决此问题的一种方法是调用控件的 Invoke 方法，并委托给使用 UI 元素（如消息框）的函数。像这样的东西：

```
public delegate void InvokeDelegate();

public void SomeMethod()
{

    button1.Invoke((InvokeDelegate)doUIStuff);

}

void doUIStuff()
{
           MessageBox.Show(this,   
                ex.Message, 
                "Error", 
                MessageBoxButtons.OK, 
                MessageBoxIcon.Error
            );
} 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-09-29T16:20:49.957

为了避免跨线程异常（InvalidOperationException），下面是代码模式：

```
protected delegate void someGuiFunctionDelegate(int iParam);

protected void someGuiFunction(int iParam)
{
    if (this.InvokeRequired)
    {
        someGuiFunctionDelegate dlg = new 
            someGuiFunctionDelegate(this.someGuiFunction);
        this.Invoke(dlg, new object[] { iParam });
        return;
    }

    //do something with the GUI control here
} 
```

我同意这很烦人，但这是 Windows GUI 控件不是线程安全的事实的产物。可以在某处或其他地方使用标志关闭异常，但不要这样做，因为它会导致极难找到错误。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-29T16:32:35.920

为了简单起见，您可以考虑使用[BackGroundWorker](http://msdn.microsoft.com/en-us/library/system.componentmodel.backgroundworker.aspx)类。此类将提供一个框架来处理您的线程和进度通知事件。您的 ui 线程将处理进度事件并显示您传回的错误消息。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-29T16:15:10.377

*   使用[Control.BeginInvoke](http://msdn.microsoft.com/en-us/library/system.windows.forms.control.begininvoke.aspx)或[Control.Invoke](http://msdn.microsoft.com/en-us/library/system.windows.forms.control.invoke.aspx)方法

或者

*   使用[SynchronizationContext](http://msdn.microsoft.com/en-us/library/system.threading.synchronizationcontext.aspx)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-10-11T06:09:38.037

我知道这是一篇较旧的帖子，但我最近找到了一个使用泛型和扩展方法的优雅解决方案。这是作者作品和一些评论的结合。

**一种跨线程Winforms访问的通用方法**

[http://www.codeproject.com/KB/cs/GenericCrossThread.aspx](http://www.codeproject.com/KB/cs/GenericCrossThread.aspx)

```
public static void Manipulate<T>(this T control, Action<T> action) where T : Control
{
    if (control.InvokeRequired)
    {
        control.Invoke(new Action<T, Action<T>>(Manipulate),
                    new object[] { control, action });
    }
    else
    { action(control); }
} 
```

这可以通过以下方式调用，为简单起见，我使用了标签。

```
someLabel.Manipulate(lbl => lbl.Text = "Something"); 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-29T16:42:17.440

检查 InvokeRequired

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-29T16:15:09.347

你不应该**使用**BeginInvoke，你应该使用 Invoke，然后一旦你掌握了这一点，如果真的需要，你可以考虑使用 BeginInvoke。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-29T16:18:25.813

```
'*******************************************************************
' Get a new processor and fire it off on a new thread.
'*******************************************************************
fpProc = New Processor(confTable, paramFile, keyCount)
AddHandler fpProc.LogEntry, AddressOf LogEntry_Handler
Dim myThread As System.Threading.Thread = New System.Threading.Thread(AddressOf fpProc.ProcessEntry)
myThread.Start() 
```

然后在父应用程序中你有：

```
'*************************************************************************
'     Sub: LogEntry_Handler()
'  Author: Ron Savage
'    Date: 08/29/2007
'
' This routine handles the LogEntry events raised by the Processor class
' running in a thread.
'*************************************************************************
Private Sub LogEntry_Handler(ByVal logLevel As Integer, ByVal logMsg As String) Handles fProc.LogEntry
 writeLogMessage(logMsg);
End Sub 
```

我就是做这个的。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2010-01-06T21:58:40.107

我特别喜欢递归调用。

```
public delegate void InvokeDelegate(string errMessage); 

    public void SomeMethod() 
    { 
        doUIStuff("my error message");
    } 

    void doUIStuff(string errMessage) 
    { 
        if (button1.InvokeRequired)
            button1.Invoke((InvokeDelegate)doUIStuff(errMessage)); 
        else
        {
               MessageBox.Show(this,    
                    ex.Message,  
                    errMessage,  
                    MessageBoxButtons.OK,  
                    MessageBoxIcon.Error 
                ); 
        }
    } 
```

# sql-server - 从 Linux 访问 Microsoft SQL Server 的方法有哪些？

> ID：149395
> 
> 赞同：54
> 
> 时间：2008-09-29T16:09:25.367
> 
> 标签：sql-server

我们有一台运行 SQL Server 2005 的 Windows 机器，我们需要能够从 Linux 机器上运行一些数据库查询。有哪些推荐的方法来做到这一点？理想情况下，我们需要一个类似于 Windows 上的 sqlcmd 的命令行实用程序。

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2008-09-29T16:14:23.343

[FreeTDS](http://www.freetds.org) + [unixODBC](http://www.unixodbc.org)或[iODBC](http://www.iodbc.org)

首先安装 FreeTDS，然后将两个 ODBC 引擎之一配置为使用 FreeTDS 作为其 ODBC 驱动程序。然后使用 ODBC 引擎的命令行界面。

unixODBC 有 isql，iODBC 有 iodbctest

你也可以使用你喜欢的编程语言（我已经成功使用 Perl、C、Python 和 Ruby 连接到 MSSQL）

我个人使用的是 FreeTDS + iODBC：

```
$more /etc/freetds/freetds.conf
[10.0.1.251]
    host = 10.0.1.251
    port = 1433
    tds version = 8.0

$ more /etc/odbc.ini
[ACCT]
Driver = /usr/local/freetds/lib/libtdsodbc.so
Description = ODBC to SQLServer via FreeTDS
Trace = No
Servername = 10.0.1.251
Database = accounts_ver8 
```

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2014-05-12T04:37:47.557

sql-cli 是一个基于 nodejs 的跨平台 sql server 命令行界面。您可以通过 npm [https://www.npmjs.org/package/sql-cli安装它](https://www.npmjs.org/package/sql-cli)

它可以连接到本地和 sql azure 实例。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2008-09-29T21:55:03.040

[sqsh](http://www.sqsh.org/) + [freetds](https://www.freetds.org)。

sqsh 主要是 Sybase SQL Server（现在是 ASE）的 isql 替代品，但它可以很好地连接到 SQL Server（前提是您使用 freetds）。

要编译，只需将 $SYBASE 指向 freetds 安装，它应该可以从那里工作。我整天在我的 Mac 上使用它。

sqsh 最好的部分是高级功能，例如简单的服务器链接（无需在 SQL Server 中设置链接服务器）、流控制和循环（不再连接字符串和执行动态 SQL）以及不可见的批量复制/加载.

使用任何其他命令行工具的人简直是疯了！:)

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-09-29T16:32:02.113

[pymssql](http://pymssql.sourceforge.net/)是一个基于 FreeTDS 的 DB-API Python 模块。它对我有用。如果需要，创建一些辅助函数，并从 Python shell 使用它。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-09-29T16:16:13.820

Mono 包含应该为您执行此操作的 ADO.NET 提供程序。我不知道是否有一个命令行实用程序，但如果没有的话，你绝对可以封装一些 C# 来执行查询。

看看[http://www.mono-project.com/TDS_Providers](http://www.mono-project.com/TDS_Providers)和[http://www.mono-project.com/SQLClient](http://www.mono-project.com/SQLClient)

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2014-09-20T12:41:18.617

自2011 年[11 月](http://blogs.technet.com/b/dataplatforminsider/archive/2011/11/28/available-today-preview-release-of-the-sql-server-odbc-driver-for-linux.aspx)起，Microsoft为 Red Hat Enterprise Linux (RHEL) 和 SUSE Linux Enterprise Server (SLES)提供了他们自己的[SQL Server ODBC Driver for Linux 。](http://msdn.microsoft.com/en-us/sqlserver/connectivity#SNAC)

*   [在 Red Hat Linux 上下载用于 SQL Server 的 Microsoft ODBC Driver 11](http://www.microsoft.com/en-us/download/details.aspx?id=36437)
*   [在 SUSE 上下载适用于 SQL Server 的 Microsoft ODBC Driver 11 - CTP](http://www.microsoft.com/en-us/download/details.aspx?id=34687)
*   [Linux 文档上的 ODBC 驱动程序](http://go.microsoft.com/fwlink/?LinkID=125813)

它还包括[`sqlcmd`](http://msdn.microsoft.com/en-us/library/hh568447%28v=sql.110%29.aspx)用于 Linux。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-09-29T22:02:09.653

如果您使用的是 Java，请查看 JDBC。

[http://msdn.microsoft.com/en-us/library/ms378672(SQL.90).aspx](http://msdn.microsoft.com/en-us/library/ms378672(SQL.90).aspx)

[http://en.wikipedia.org/wiki/Jdbc](http://en.wikipedia.org/wiki/Jdbc)

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-09-29T16:21:32.543

你没有说你想对结果数据做什么，但如果它是开发/维护的一般查询，那么我会认为远程桌面到 Windows 服务器，然后在他们身上使用实际的 SQL Server 工具总是比 Linux 本身上的任何组合解决方案更有效的选择。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-09-29T16:35:51.387

有一个可用于 PHP 的抽象库。不确定您的客户端的盒子将支持什么，但如果它的 Linux 则肯定应该支持使用此构建 PHP 查询接口： [http://adodb.sourceforge.net/](http://adodb.sourceforge.net/) 希望对您有所帮助。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2020-04-02T14:44:45.387

我想推荐[Sqlectron](https://www.electronjs.org/apps/sqlectron)。除了在 MIT 许可下开源之外，它还受到 Electron 的多平台支持。它自己的定义是：

> 一个简单轻量级的 SQL 客户端桌面，支持跨数据库和平台

它[目前支持](https://github.com/sqlectron/sqlectron-core#current-supported-databases)PostgreSQL、MySQL、MS SQL Server、Cassandra 和 SQLite。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2021-07-11T21:36:13.687

令人惊讶的是，没有人提到，与其他答案似乎暗示的相反，FreeTDS 就是您所需要的。不需要 unixODBC、iODBC 或其他任何东西。

> 在 Windows 上运行一些数据库查询 [...] 类似于 sqlcmd 的命令行实用程序

`tsql`这样做并且是 FreeTDS 软件包的一部分（`freebcp`与其他实用程序一样）。`tsql`没有花哨的用户界面，但如果你想要一个轻量级、功能性和高性能的命令行实用程序，它就可以了。

参见例如[如何在 tsql 中运行 SQL 脚本](https://stackoverflow.com/questions/17078869/how-to-run-a-sql-script-in-tsql)

顺便说一句，我的意思是小于 500kb（可能小于 60k，具体取决于它的编译方式），据我所知，内存和 CPU 的效率非常高。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2013-10-22T15:58:43.087

我对 freetds 解决方案不满意，这就是我编写一个类的原因（命令历史记录、表和字段的自动完成等）

[http://www.phpclasses.org/package/8168-PHP-Use-ncurses-to-get-key-inputs-and-write-shell-text.html](http://www.phpclasses.org/package/8168-PHP-Use-ncurses-to-get-key-inputs-and-write-shell-text.html)

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2018-05-19T07:18:07.527

**valentina-db**它有 sql server 的免费版本
.rpm 和 .deb
序列号将在注册后通过电子邮件发送

[https://www.valentina-db.com/en/](https://www.valentina-db.com/en/)

[https://valentina-db.com/en/store/category/14-free-products](https://valentina-db.com/en/store/category/14-free-products)

[![瓦伦蒂娜数据库](https://i.stack.imgur.com/1vERC.png)](https://i.stack.imgur.com/1vERC.png)

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2018-07-11T04:57:41.560

如果您使用 eclipse，您可以在其上安装 Data Tools Platform 插件并将其用于包括 MS SQLServer 在内的每个数据库引擎。它只需要为该数据库引擎获取 JDBC 驱动程序。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2019-02-21T13:18:26.560

*现在*有一个很好的基于 CLI 的工具用于访问 MSSQL 数据库。

它被称为`mssql-cli`，它有点类似于 postgres' `psql`。

[Gihub 存储库页面](https://github.com/dbcli/mssql-cli)

例如通过`pip`安装（全局安装，对于本地安装省略`sudo`部分）：

```
sudo pip install mssql-cli 
```

# visual-studio - 自定义 Visual Studio 的 Intellisense

> ID：149400
> 
> 赞同：6
> 
> 时间：2008-09-29T16:11:15.377
> 
> 标签：visual-studio, ide, customization

最近的一个项目让我再次使用 C#，我注意到了一些我以前没有的东西——C# 的 Intellisense 显示了调用方法时可能引发的异常

[![](https://i.stack.imgur.com/KQKTY.png)](https://i.stack.imgur.com/KQKTY.png)

由于我主要使用 VB.NET 应用程序，因此在这些应用程序中也具有此功能非常好，但不幸的是 VB 的 Intellisense 没有它

[![](https://i.stack.imgur.com/TajmR.png)](https://i.stack.imgur.com/TajmR.png)

是否有任何快速简便的方法可以自定义 Visual Studio 的 Intellisense 以显示异常（以及 XML 注释中的其他成员）？还是我正在使用 SDK 进行完整修改？

更新：2008 年 9 月 29 日下午 1:49 -- 我认为这将比简单地更改配置设置更复杂。由于注释是基于 XML 的，我希望在 Visual Studio 目录中的某个地方有一个 XSLT 文件，但到目前为止还没有任何结果。看起来我将不得不深入研究 Visual Studio SDK。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-29T17:26:36.523

尝试转到工具 -> 选项...
然后文本编辑器 -> 基本
并确保未选中“自动列出成员”和“隐藏高级成员”这两个选项。
还要检查“参数信息”。

我无法验证此信息，因为我当前的 Visual Studio 安装是 C# 独立的。

问候，路易斯

# asp.net - 在 GridView RowDataBound 中或直接在 SQL 中操作结果？

> ID：149416
> 
> 赞同：0
> 
> 时间：2008-09-29T16:14:16.633
> 
> 标签：asp.net, sql, optimization

我有一个关于效率的奇怪问题。假设我在数据库中有一个字段，它只是一个代表其他内容的数字。例如，值 1 表示期限为 30 天。

编写这样的 SELECT 语句会更好（更有效）吗？

```
SELECT
    CASE TermId
        WHEN 1 THEN '30 days'
        WHEN 2 THEN '60 days'
    END AS Term
FROM MyTable 
```

...并将结果直接绑定到 GridView，还是评估 GridView 的 RowDataBound 事件中的 TermId 字段并相应地更改单元格文本会更好？

不要担心可扩展性或类似的东西，我只关心整体效率的差异。值得一提的是，数据库驻留在 Web 服务器上。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-29T16:29:03.277

效率在这里可能无关紧要 - 代码可维护性确实如此。问问自己——这些价值观会改变吗？如果他们这样做怎么办？如果这些值发生变化，使用 2 年后我需要做什么？如果很明显在 SQL 中编写脚本意味着更好的可维护性（更容易更改），那么在存储过程中进行。如果以后在代码中更改它们更容易，那么就这样做。做任何一个的好处都非常低，因为代码看起来一点也不复杂。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-29T16:27:04.950

出于多种原因，我会在网格视图中处理翻译。

原因 #1：SQL 资源是共享的。网格是分布式的。更好的可扩展性。

原因 #2：传输几个整数与字符串的带宽较低。

原因 #3：可以将代码本地化为其他语言，而不会影响 SQL Server 代码。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-29T17:28:34.380

数据库表中称为 TermID 的字段将暗示自己代表另一个表的外键（可能称为“术语”）。

如果是这种情况，那么该表可能具有（或应该具有）一个可以保存“30 天”文本的描述字段。您可以/应该加入此表以检索描述性文本。

虽然这种连接可能不会提高效率，但它是一个足够轻量级的连接，不会妨碍您。

# html - 实现可调整大小的文本区域？

> ID：149421
> 
> 赞同：22
> 
> 时间：2008-09-29T16:14:57.863
> 
> 标签：html, resize, textarea

Stackoverflow 如何实现可调整大小的文本区域？

这是他们自己推出的东西，还是我可以轻松附加到我网站上的文本区域的公开可用组件？

我发现了这个问题，但它并不完全符合我的要求。

[自动调整文本区域](https://stackoverflow.com/questions/7477/autosizing-textarea)

这更多地谈到了自动调整文本区域的大小，而我想要你可以上下拖动的小抓取区域。

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2008-09-29T16:28:34.557

StackOverflow 使用 jQuery 插件来完成此操作：[TextAreaResizer](http://plugins.jquery.com/project/TextAreaResizer)。

验证这一点很容易——只需从站点中提取[JS文件。](http://sstatic.net/js/wmd.js)

**历史注释：**最初编写此答案时，WMD 和 TextAreaResizer 是两个独立的插件，两者都不是由 SO 开发团队编写的（另请参见：[micahwittman 的答案](https://stackoverflow.com/questions/149421/implementing-a-resizable-textarea/149442#149442)）。此外，该站点的 JavaScript 非常易于阅读……这些都不再是*严格*正确的，但 TextAreaResizer 仍然可以正常工作。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-09-29T16:20:38.350

我最近需要一个类似的功能。它被称为[Autogrow](http://www.technoreply.com/autogrow-textarea-plugin-3-0/)，它是惊人的[jQuery](http://jquery.com/)库的插件

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-29T16:20:26.290

[起初我认为这是Wysiwym Markdown 编辑器](http://wmd-editor.com/)的内置功能，但 Shog9 是正确的：它根本不是内置的，而是由 jQuery 插件 TextAreaResizer 提供的（我被浏览器用来检查在[编辑器演示](http://wmd-editor.com/demo)中，因为 Google Chrome 本身在 textareas 上添加了可扩展功能——很像 Safari 浏览器所做的）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2015-03-24T19:00:37.567

使用 AngularJS：

```
angular.module('app').directive('textarea', function() {
  return {
    restrict: 'E',
    controller: function($scope, $element) {
      $element.css('overflow-y','hidden');
      $element.css('resize','none');
      resetHeight();
      adjustHeight();

      function resetHeight() {
        $element.css('height', 0 + 'px');
      }

      function adjustHeight() {
        var height = angular.element($element)[0]
          .scrollHeight + 1;
        $element.css('height', height + 'px');
        $element.css('max-height', height + 'px');
      }

      function keyPress(event) {
        // this handles backspace and delete
        if (_.contains([8, 46], event.keyCode)) {
          resetHeight();
        }
        adjustHeight();
      }

      $element.bind('keyup change blur', keyPress);

    }
  };
}); 
```

这会将您的所有文本区域转换为增长/缩小。如果您只希望特定文本区域增长/缩小 - 将顶部更改为如下所示：

```
angular.module('app').directive('expandingTextarea', function() {
  return {
    restrict: 'A', 
```

希望有帮助！

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2018-01-26T11:51:45.900

这个怎么样，它的工作

```
<textarea oninput='this.style.height = "";this.style.height = this.scrollHeight + "px"'></textarea> 
```

# oop - 使用回调时如何避免循环依赖？

> ID：149439
> 
> 赞同：9
> 
> 时间：2008-09-29T16:19:34.907
> 
> 标签：oop, inversion-of-control, callback

在设计具有生产者/消费者关系的两个类时，如何避免循环依赖？这里 ListenerImpl 需要一个对 Broadcaster 的引用才能注册/注销自己，而 Broadcaster 需要一个对 Listeners 的引用才能发送消息。这个例子是用 Java 编写的，但它可以应用于任何 OO 语言。

```
public interface Listener {
  void callBack(Object arg);
}
public class ListenerImpl implements Listener {
  public ListenerImpl(Broadcaster b) { b.register(this); }
  public void callBack(Object arg) { ... }
  public void shutDown() { b.unregister(this); }
}
public class Broadcaster {
  private final List listeners = new ArrayList();
  public void register(Listener lis) { listeners.add(lis); }
  public void unregister(Listener lis) {listeners.remove(lis); }
  public void broadcast(Object arg) { for (Listener lis : listeners) { lis.callBack(arg); } }
} 
```

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-09-29T16:23:50.900

我不认为这是一个循环依赖。

听众什么都不依赖。

ListenerImpl 依赖于 Listener 和 Broadcaster

Broadcaster 依赖于 Listener。

```
 Listener
       ^        ^
      /          \
     /            \
Broadcaster <--  ListenerImpl 
```

所有箭头都在 Listener 处结束。没有循环。所以，我觉得你没问题。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-09-29T17:09:13.773

任何面向对象语言？好的。这是 CLOS 中的十分钟版本。

# 广播框架

```
(defclass broadcaster ()
  ((listeners :accessor listeners
              :initform '())))

(defgeneric add-listener (broadcaster listener)
  (:documentation "Add a listener (a function taking one argument)
  to a broadcast's list of interested parties"))

(defgeneric remove-listener (broadcaster listener)
  (:documentation "Reverse of add-listener"))

(defgeneric broadcast (broadcaster object)
  (:documentation "Broadcast an object to all registered listeners"))

(defmethod add-listener (broadcaster listener)
  (pushnew listener (listeners broadcaster)))

(defmethod remove-listener (broadcaster listener)
  (let ((listeners (listeners broadcaster)))
    (setf listeners (remove listener listeners))))

(defmethod broadcast (broadcaster object)
  (dolist (listener (listeners broadcaster))
    (funcall listener object))) 
```

# 示例子类

```
(defclass direct-broadcaster (broadcaster)
  ((latest-broadcast :accessor latest-broadcast)
   (latest-broadcast-p :initform nil))
  (:documentation "I broadcast the latest broadcasted object when a new listener is added"))

(defmethod add-listener :after ((broadcaster direct-broadcaster) listener)
  (when (slot-value broadcaster 'latest-broadcast-p)
    (funcall listener (latest-broadcast broadcaster))))

(defmethod broadcast :after ((broadcaster direct-broadcaster) object)
  (setf (slot-value broadcaster 'latest-broadcast-p) t)
  (setf (latest-broadcast broadcaster) object)) 
```

# 示例代码

```
Lisp> (let ((broadcaster (make-instance 'broadcaster)))
        (add-listener broadcaster 
                      #'(lambda (obj) (format t "I got myself a ~A object!~%" obj)))
        (add-listener broadcaster 
                      #'(lambda (obj) (format t "I has object: ~A~%" obj)))
        (broadcast broadcaster 'cheezburger))

I has object: CHEEZBURGER
I got myself a CHEEZBURGER object!

Lisp> (defparameter *direct-broadcaster* (make-instance 'direct-broadcaster))
      (add-listener *direct-broadcaster*
                  #'(lambda (obj) (format t "I got myself a ~A object!~%" obj)))
      (broadcast *direct-broadcaster* 'kitty)

I got myself a KITTY object!

Lisp> (add-listener *direct-broadcaster*
                    #'(lambda (obj) (format t "I has object: ~A~%" obj)))

I has object: KITTY 
```

不幸的是，Lisp 通过消除对它们的需求解决了大多数设计模式问题（例如您的问题）。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-29T17:57:33.827

与 Herms 的回答相反，我**确实**看到了一个循环。这不是依赖循环，而是引用循环：LI 保存 B 对象，B 对象保存（一个数组）LI 对象。它们不容易自由，需要注意确保它们在可能的情况下自由。

一种解决方法是让 LI 对象持有对广播者的 WeakReference。从理论上讲，如果广播公司已经离开，无论如何都没有什么可注销的，所以您的注销将简单地检查是否有广播公司要注销，如果有就这样做。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-29T16:28:27.317

我不是 java 开发者，但像这样：

```
public class ListenerImpl implements Listener {
  public Foo() {}
  public void registerWithBroadcaster(Broadcaster b){ b.register(this); isRegistered = true;}
  public void callBack(Object arg) { if (!isRegistered) throw ... else ... }
  public void shutDown() { isRegistered = false; }
}

public class Broadcaster {
  private final List listeners = new ArrayList();
  public void register(Listener lis) { listeners.add(lis); }
  public void unregister(Listener lis) {listeners.remove(lis); }
  public void broadcast(Object arg) { for (Listener lis : listeners) { if (lis.isRegistered) lis.callBack(arg) else unregister(lis); } }
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-02T09:35:41.247

使用弱引用打破循环。

看到[这个答案](https://stackoverflow.com/questions/157856/do-java-listeners-need-to-be-removed-in-the-finalize-method#157903)。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-28T09:50:32.323

这是 Lua 中的一个示例（我在这里使用我自己的[Oop 库](http://luaforge.net/projects/objectlua/)，请参阅代码中对“对象”的引用）。

就像在 Mikael Jansson 的 CLOS 示例中一样，您可以直接使用函数，无需定义侦听器（注意使用 '...'，它是 Lua 的可变参数）：

```
Broadcaster = Object:subclass()

function Broadcaster:initialize()
    self._listeners = {}
end

function Broadcaster:register(listener)
    self._listeners[listener] = true
end

function Broadcaster:unregister(listener)
    self._listeners[listener] = nil
end
function Broadcaster:broadcast(...)
    for listener in pairs(self._listeners) do
        listener(...)
    end
end 
```

坚持你的实现，这是一个我猜可以用任何动态语言编写的示例：

```
--# Listener
Listener = Object:subclass()
function Listener:callback(arg)
    self:subclassResponsibility()
end

--# ListenerImpl
function ListenerImpl:initialize(broadcaster)
    self._broadcaster = broadcaster
    broadcaster:register(this)
end
function ListenerImpl:callback(arg)
    --# ...
end
function ListenerImpl:shutdown()
    self._broadcaster:unregister(self)
end

--# Broadcaster
function Broadcaster:initialize()
    self._listeners = {}
end
function Broadcaster:register(listener)
    self._listeners[listener] = true
end
function Broadcaster:unregister(listener)
    self._listeners[listener] = nil
end
function Broadcaster:broadcast(arg)
    for listener in pairs(self._listeners) do
        listener:callback(arg)
    end
end 
```

# asp.net - IIS 6、通配符应用程序映射和 FrontPage

> ID：149458
> 
> 赞同：1
> 
> 时间：2008-09-29T16:23:55.190
> 
> 标签：asp.net, iis, asp-classic, frontpage

虽然我很想在我托管的流量很大的网站上不需要 FrontPage Extensions，但客户端需要它来管理该网站。刚刚在此站点上的 IIS 6 中实现了通配符应用程序映射，以便在 ASP 和 ASP.NET 资源之间提供集成的表单身份验证安全性，这破坏了 FrontPage 扩展。一切都像一个魅力，包括加密和缓存角色，现在甚至可以用于 ASP，除了 FrontPage 的丢失。具体来说，您甚至无法登录 FrontPage 管理（凭据不正确）。

有没有人通过 ASP.NET 2.0 aspnet_isapi.dll 让 FrontPage 使用通配符应用程序映射路由？

更新：我已经标记了@Chris Hynes 的答案，即使我没有时间进行测试（并且当前配置适用于客户端）。这是有道理的，并且与我认为正在发生的事情以及可能的处理方式一致，但当时不知道将请求路由到哪里（fpadmdll.dll）。非常感谢！

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-07T19:13:16.837

这里的问题听起来像是通配符映射优先于首页扩展 ISAPI 处理程序和/或弄乱了请求/响应。我会尝试创建一个什么都不做的处理程序并将其映射到 fpadmdll.dll。

像这样的东西：

```
namespace YourNamespace
{
    public IgnoreRequestHandler : IHttpHandler
    {
        public IsReusable { get { return true; } }

        public void ProcessRequest(HttpContext context)
        { }
    }
} 
```

然后将其映射到 web.config 中：

```
<httpHandlers>
    <add verb="*" path="fpadmdll.dll" type="YourNamespace.IgnoreRequestHandler, YourDll"  />
</httpHandlers> 
```

# arrays - 类中的向量问题

> ID：149463
> 
> 赞同：0
> 
> 时间：2008-09-29T16:25:05.907
> 
> 标签：arrays, vector

我在一个类中有这个代码：

```
void SendStones()
{
    int currenthole = hole;
    int lastplace = 0;
    for(int i=0;i<stns.size();i++)
    {
        while(1)
        {//Calculate new currenthole
            if(currenthole == 13) { currenthole = 7; break;}
            if(currenthole == 14) { currenthole = 6; break;}
            if((currenthole<=12 && currenthole > 7) || (currenthole<=6 && currenthole > 1)) { currenthole--; break;}
        }
        lastplace = stns.size()-1;
        hole[currenthole]->ReciveStone(stns[lastplace]);//PROBLEM
        stns.pop_back();
    }
}

vector<Stones*> stns; 
```

所以它会出现这个错误：数组下标的无效类型`int [int]'

有什么问题？我不明白。谢谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-29T16:28:59.033

看起来 hole 是一个简单的 int，而您正在尝试对其下标。这就是你的意思吗？洞在哪里声明？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-29T16:45:11.100

根据您在回答中所说的，hole 是指向*n* Hole 对象的指针。这意味着你的代码没有做你认为它正在做的事情。

```
int currenthole = hole; 
```

这是存储指向数组集合中第一个对象的地址值，这意味着此代码

```
if(currenthole == 13) { currenthole = 7; break;}
            if(currenthole == 14) { currenthole = 6; break;}
            if((currenthole<=12 && currenthole > 7) || (currenthole<=6 && currenthole > 1)) { currenthole--; break;} 
```

可能是胡说八道。

它没有解释为什么您会收到*“数组下标的无效类型 `int[int]'”*错误。您确定没有第二个名为*hole的**int*类型声明吗？

 *——实际上，重新阅读你写的东西，我更加确定你没有做你认为你正在做的事情。SendStones 是 Hole 类的成员，对吗？检查您的 Hole 类内部是否没有孔成员变量。这可能是问题所在，因为它会在任何名为hole 的全局变量之前找到（如果我没记错我的范围规则的话）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-29T16:33:21.143

Hole 是一个非常大的类，
SendStones 是该类中的一个函数成员。
我不会发送整个文件，但我可以说
hole[currenthole] 是一个 Hole *hole[14];
这是一个很大的程序和项目，所以我发送了所需的相关代码。

这是 ReciveStones 函数的代码：

void ReciveStone(Stone *rcvstone) { stns.push_back(rcvstone); }

# xml - 我有一个 100+MB 的 XML 文件（sans-DTD/Schema）。XSLT 不会有它。转换/解析的策略？

> ID：149474
> 
> 赞同：1
> 
> 时间：2008-09-29T16:27:39.410
> 
> 标签：xml, xslt, parsing

该 XML 文件包含去年全年的存档新闻报道。我被要求按故事类别[y|ies] 将这些故事分类到新的 XML 文件中。

```
big_story_export.xml 
```

变成

```
lifestyles.xml
food.xml
nascar.xml 
```

...等等。

我使用一次性 python 脚本完成了这项工作，*但是*，**我最初尝试使用 XSLT 进行此操作**。这让我很沮丧，因为我的 XPATH 选择弄得一团糟。测试文件被完美地转换了，但是将大文件放在我的样式表上导致......*什么都没有*。

您推荐哪些策略来确保此类文件将通过 XSLT 运行？*这是供应商交给我的，所以想象一下，在定义这个文件的结构时，我没有太多的影响力。*

如果你们想要代码示例，我会把一些放在一起。

如果有的话，我会对一些使 XML+XSLT 顺利协同工作的技巧感到满意。

* * *

@Sklivvz

我正在使用 python 的 libxml2 & libxslt 来处理这个。我现在正在研究 xsltproc。

对于这些一次性情况，它似乎是一个很好的工具。谢谢！

* * *

@diomidis-spinellis

它的格式很好，尽管（如前所述）我没有能力发现它的有效性。

至于写一个模式，我喜欢这个主意。

如果这是一次性的事情，我在验证这个文件上投入的时间是不切实际的，尽管我预见到必须从我们的供应商处处理更多这样的文件。

编写一个模式（并将其提交给供应商）将是管理这样的 XML funk 的一个极好的长期策略。谢谢！

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-29T21:25:28.727

使用 XSLT 处理任意大的 XML 文档的问题在于 XSLT 处理首先将输入文档解析为源树。这棵树被解析到内存中。这意味着最终您会遇到一个足够大的输入文档，即使您使用的是像 Saxon 这样的强大 XSLT 处理器并且您有足够的虚拟内存，也会导致问题。（它可能仍然有效，但会很慢。）

Another reason not to use XSLT for this is that you're producing multiple output documents, which (based on what you've said so far) means you're making multiple passes over your input document.

It may (depending on a lot of factors about your situation that I don't know about) be better to take a SAX-based approach instead of using XSLT. Using a SAX processor, you may be able to write a method that makes a single, forward-only pass through the source document, parsing it as it goes, and writes all of the output documents as it encounters the elements that contain them.

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-29T16:36:22.167

这听起来像是大型 XML 文件或 XSLT 处理器中的错误。您应该检查您的文件的两件事。

1.  文件是格式良好的 XML 吗？也就是说，所有标签和属性是否都正确终止和匹配？XML 处理器（如[xmlstarlet](http://xmlstar.sourceforge.net/)）可以告诉您这一点。
2.  该文件是否包含有效的 XML？为此，您需要一个模式和一个 XML 验证器（[xmlstarlet](http://xmlstar.sourceforge.net/)也可以做到这一点）。我建议您投入一些精力来编写文件的架构定义。它将大大简化您的调试，因为您可以轻松地查明您可能遇到的问题的确切来源。

如果文件格式正确且有效，但 XSLT 处理器仍然拒绝为您提供您所期望的结果，那么您可以确定问题出在处理器上，您应该尝试使用不同的处理器。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-29T16:32:01.740

您使用的是什么语言/解析器？
对于大文件，我尝试使用 Unix 命令行工具。
它们通常比其他解决方案更有效率，并且不会“破坏”大文件。

尝试使用`xsltproc`

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-29T17:51:27.757

我可以推荐 Saxon XSLT 处理器吗？我知道它可以处理大文件，只要你给 Java JVM 足够的内存。

另一件事是，您的 XSLT 中可能有一些优化可能会有所帮助，但很难就这样的事情做出笼统的陈述。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-23T20:25:48.033

Check out Apache's [Xalan C++](http://xml.apache.org/xalan-c/index.html). In my experience, where others (including Saxon) have failed on "large" XML files (>600 MB), this was able to run with memory to spare.

# latex - 在 LaTeX 中为方程式添加标题

> ID：149479
> 
> 赞同：52
> 
> 时间：2008-09-29T16:28:31.810
> 
> 标签：latex

好吧，这似乎很简单，但我找不到为方程式添加标题的方法。需要标题来解释方程中使用的变量，所以某种类似表格的结构来保持对齐和漂亮会很棒。

* * *

## 回答 #1

> 赞同：55
> 
> 时间：2008-09-29T17:05:25.420

该`\caption`命令仅限于浮动：您需要将方程放置在图形或表格环境（或一种新的浮动环境）中。例如：

```
\begin{figure}
\[ E = m c^2 \]
\caption{A famous equation}
\end{figure} 
```

浮动的重点是让 LaTeX 确定它们的位置。如果您想让方程式出现在固定位置，请不要使用浮点数。[标题包](http://www.tex.ac.uk/tex-archive/macros/latex/contrib/caption/caption-eng.pdf)的`\captionof`命令可用于将标题放置在浮动环境之外。它是这样使用的：

```
\[ E = m c^2 \]
\captionof{figure}{A famous equation} 
```

`\listoffigures`如果您的文档有一个，这也会产生一个条目。

要对齐方程式的某些部分，请查看[`eqnarray`environment](http://www.eng.cam.ac.uk/help/tpl/textprocessing/teTeX/latex/latex2e-html/ltx-223.html)或[amsmath](http://www.ams.org/tex/amslatex.html)包的一些环境：align、gather、multiline、...

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-09-29T16:31:19.620

你可能想看看[http://tug.ctan.org/tex-archive/macros/latex/contrib/float/](http://tug.ctan.org/tex-archive/macros/latex/contrib/float/)允许您使用定义新的浮点数`\newfloat`

我这样说是因为字幕通常应用于浮动。

直线方程（用`$ ... $`, `$$ ... $$`,写成的`begin{equation}...`）是不支持的内联对象`\caption`。

这可以在之前使用以下[代码段完成](https://tex.stackexchange.com/a/97034/149720)`\begin{document}`

```
\usepackage{float}
\usepackage{aliascnt}
\newaliascnt{eqfloat}{equation}
\newfloat{eqfloat}{h}{eqflts}
\floatname{eqfloat}{Equation}

\newcommand*{\ORGeqfloat}{}
\let\ORGeqfloat\eqfloat
\def\eqfloat{%
  \let\ORIGINALcaption\caption
  \def\caption{%
    \addtocounter{equation}{-1}%
    \ORIGINALcaption
  }%
  \ORGeqfloat
} 
```

并且在添加方程式时使用类似的东西

```
\begin{eqfloat}
\begin{equation}
f( x ) = ax + b
\label{eq:linear}
\end{equation}
\caption{Caption goes here}
\end{eqfloat} 
```

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2017-12-15T22:06:47.273

正如[Gonzalo Medina 的这个论坛帖子](http://latex.org/forum/viewtopic.php?t=6343)一样，第三种方式可能是：

```
\documentclass{article}
\usepackage{caption}

\DeclareCaptionType{equ}[][]
%\captionsetup[equ]{labelformat=empty}

\begin{document}

Some text

\begin{equ}[!ht]
  \begin{equation}
    a=b+c
  \end{equation}
\caption{Caption of the equation}
\end{equ}

Some other text

\end{document} 
```

包中使用的命令的更多详细信息[`caption`](https://ctan.org/pkg/caption)：[这里](https://ctan.mirror.garr.it/mirrors/ctan/macros/latex/contrib/caption/caption-eng.pdf)。

上述代码输出的截图：

[![输出截图](https://i.stack.imgur.com/YQHsQ.png)](https://i.stack.imgur.com/YQHsQ.png)

# .net - 如何根据传递给 VB.NET 泛型方法的类型执行条件逻辑

> ID：149484
> 
> 赞同：2
> 
> 时间：2008-09-29T16:29:16.643
> 
> 标签：.net, vb.net, generics

我想创建一个创建类实例的 VB.NET 通用工厂方法（作为控制容器的本土反转）。如果我将接口 IDoSomething 作为通用参数传递，我想返回一个 DoSomething 的实例（实现 IDoSomething）。我无法弄清楚 if 语句的语法。我想写一些类似的东西：

```
Public Function Build(Of T) as T  
    If T Is IDoSomething then  
        Return New DoSomething()  
    ElseIf T Is IAndSoOn Then  
        Return New AndSoOn()  
    Else  
        Throw New WhatWereYouThinkingException("Bad")  
    End If  
End Sub 
```

但是这段代码无法编译。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-29T16:39:30.677

```
Public Function Build(Of T) As T
  Dim foo As Type = GetType(T)

  If foo Is GetType(IDoSomething) Then
    Return New DoSomething()
  ...
  End If
End Function 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-29T16:54:12.777

```
Public Function Build(Of T) as T  
    If T.gettype Is gettype(IDoSomething) then  
        Return New DoSomething()  
    ElseIf T.gettype Is gettype(IAndSoOn) Then  
        Return New AndSoOn()  
    Else  
        Throw New WhatWereYouThinkingException("Bad")  
    End If  
End Sub 
```

# php - 如何在SVN中存储配置参数？

> ID：149485
> 
> 赞同：5
> 
> 时间：2008-09-29T16:29:22.540
> 
> 标签：php, svn

像许多项目一样，我们部署到许多环境，QA、UA、Developer trunk 等。

在 SVN 中存储敏感配置参数的最佳方式是什么？或者，您是否应该只在服务器上维护一个带有凭据的较小的未版本化文件？

主要是，我们不想向每个开发人员公开生产凭据。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-29T16:50:37.483

我宁愿提供配置示例而不是真实的配置文件。在我的项目`setup.default.php`中，根目录中有每个用户需要复制`setup.php`并修改以匹配本地环境的文件。此外，为了防止签入自定义的安装文件，在`.svnignore`.

```
$ echo 'setup.php' > .svnignore
$ svn propset svn:ignore -F .svnignore . 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-29T20:21:37.880

这也是我遇到的一个问题。我认为答案是签入模板（例如您使用 setup.php.default 的模板），然后使用[Phing](http://phing.info/trac/)等自动化工具 推动开发。如果您在 setup.php 文件中使用可识别的标记，那么 Phing 将能够用单独的服务器值替换这些标记。此外，一个简单的一步直播将是一个有用的过程。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-29T16:41:01.810

我同意亚当的观点。如果它不能使从事该项目的每个人都受益，那么它不应该受到版本控制。如果有人签出您的代码副本，您的个人项目文件会帮助他们吗？可能不是。它很可能只会把事情弄得一团糟。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-29T16:32:15.047

我根本不会将配置信息存储在存储库中。这样您就不必担心 SVN 在更新源代码时会尝试更新配置。

# c++ - 磁盘支持的 STL 容器类？

> ID：149488
> 
> 赞同：40
> 
> 时间：2008-09-29T16:29:55.397
> 
> 标签：c++, algorithm, data-structures, stl, on-disk

我喜欢使用 STL 开发算法，但是，我经常遇到这个问题，即我的数据集对于堆来说太大了。

我一直在寻找 STL 容器和磁盘支持的算法的替代品，即存储在磁盘上而不是堆上的数据结构。

一位朋友最近向我指出了[stxxl](http://stxxl.sourceforge.net)。在我过多参与之前......我应该考虑是否有其他可用的磁盘支持的 STL 替代品？

**注意：我对持久性或嵌入式数据库不感兴趣。请不要提及 boost::serialization、POST++、关系模板库、Berkeley DB、sqlite 等。我知道这些项目并在它们适合我的目的时使用它们。**

*更新：有几个人提到了内存映射文件和使用自定义分配器，顺便说一句，这是很好的建议，但我会指出他们在[这里](http://lists.boost.org/Archives/boost/2002/11/39388.php)的讨论中，大卫亚伯拉罕建议磁盘支持的容器需要自定义迭代器。这意味着自定义分配器方法不太可能奏效。*

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-09-30T03:06:36.380

我已经实现了一些非常相似的东西。实现迭代器是最具挑战性的。我使用**[boost::iterator_facade](http://www.boost.org/doc/libs/1_36_0/libs/iterator/doc/iterator_facade.html)**来实现迭代器。使用`boost::iterator_facade`您可以**轻松地将**任何缓存在**磁盘上的数据结构**调整为具有 STL 容器接口。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-09-29T17:32:49.783

我从来没有做过像这样的事情，但是通过编写一个使用内存映射文件来支持数据的自定义分配器，可以做你想做的事情。

有关易于使用的内存映射文件实现的文档，请参阅[boost::interprocesses](http://www.boost.org/doc/libs/1_36_0/doc/html/interprocess/sharedmemorybetweenprocesses.html#interprocess.sharedmemorybetweenprocesses.mapped_file) 、有关编写分配器的详细讨论的[Dobbs 博士的这篇文章](http://www.ddj.com/cpp/184406243)，以及有关问题和[示例代码的描述的](http://www.spinellis.gr/blog/20101030/smap.cpp)[IEEE 软件专栏](http://www.spinellis.gr/blog/20101030/)。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-29T16:46:25.247

如果（如您所写）您对持久性不感兴趣，最简单的解决方案是增加堆大小并使用操作系统的虚拟内存设施。不适合计算机物理内存的堆部分最终将在磁盘上进行分页，从而为您提供所需的内容：对通常存储在磁盘上的数据进行正常的 STL 访问。操作系统将负责缓存物理内存中最常用的页面，并将不经常使用的页面驱逐到磁盘。您的代码将保持不变，您只需添加更多物理内存即可提高其性能。

要增加堆大小，请检查操作系统的参数，例如 Unix 系统上的 ulimit(1) 和 Windows XP 上的系统属性 - 高级 - 性能 - 高级 - 虚拟内存。如果您已达到 32 位 4GB 的限制，请考虑迁移到 64 位架构或将您的程序编译为 64 位。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-29T16:38:48.820

我对这个主题不太了解，但是可以将类似 STL 的接口写入内存映射文件吗？

编辑：如果您尝试获取大文件的特定部分，此方法可能适用。如果您尝试对整个文件执行某些操作，则在读取文件的未缓存部分时可能会产生大量页面错误。

# c# - C# 代码的 Pascal 套管或 Camel 套管？

> ID：149491
> 
> 赞同：35
> 
> 时间：2008-09-29T16:30:20.777
> 
> 标签：c#, .net, naming-conventions, standards

我一直在与我的同事争论 Pascal 套管（上驼峰式）与下驼峰[式](http://en.wikipedia.org/wiki/CamelCase)套管。它们用于降低所有内容的驼峰式大小写，从 SQL 数据库中的表名到 C# 代码中的属性命名，但我更喜欢 Pascal 大小写，变量的小驼峰大小写和属性的 Pascal 大小写：

```
string firstName;
public string FirstName {
...
} 
```

但他们已经习惯了：

```
string _firstname;
public string firstName {
...
} 
```

我试图跟上他们的“标准”，所以代码看起来一样，但我只是不喜欢它。

我已经看到至少 .NET 框架使用了这种约定，这就是我尝试保留代码的方式，例如：

```
System.Console.WriteLine("string") 
```

你使用/喜欢什么，为什么？如果有人问这个问题，我很抱歉，但我搜索并没有找到任何东西。

**更新：** 我给出了一个方法示例，而不是一个属性，但它是一样的。正如我在第一段中所说，我的同事对所有内容（变量、方法、表名等）都使用 Pascal 约定。

* * *

## 回答 #1

> 赞同：39
> 
> 时间：2008-09-29T16:37:11.430

官方[设计指南](https://docs.microsoft.com/en-us/dotnet/standard/design-guidelines/)的链接可能会有所帮助。具体来说，请阅读[大写样式](https://docs.microsoft.com/en-us/dotnet/standard/design-guidelines/capitalization-conventions#capitalizing-compound-words-and-common-terms)部分。

从总体上看，Pascal 与 Camel 并没有那么重要，而且您不可能说服任何人为了更改名称的大小写而返回现有的代码库。真正重要的是您希望在给定的代码库中保持一致。

只要您不使用匈牙利语，我就很高兴。

* * *

## 回答 #2

> 赞同：37
> 
> 时间：2008-09-29T16:35:27.613

我使用框架使用的东西，因为它是事实上的最佳实践。但是，只要您公司的代码**始终**使用他们的风格，那么您最好习惯它。如果每个开发人员都有自己的标准，那么根本就没有标准。

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2008-09-29T16:56:51.650

你应该看看微软的新工具[StyleCop](http://code.msdn.microsoft.com/sourceanalysis)用于检查 C# 源代码。还要留意[FxCop](http://msdn.microsoft.com/en-us/library/bb429476(VS.80).aspx)以检查已编译的 .Net 程序集。FxCop 更关注代码的作用细节，而不是布局，但它确实有一些与公开可见名称相关的命名规则。

StyleCop 定义了一个编码标准，现在微软正在将其作为行业标准进行推广。它根据标准检查 C# 源代码。StyleCop 遵循您的 PascalCase 风格。

让人们使用 StyleCop（或任何其他标准）可能很困难，这是一个相当大的障碍，而 StyleCop 非常详尽。但是代码应该是统一的标准——个人标准总比没有好，公司标准比个人标准好，行业标准是最好的。

当一个项目开始时说服人们要容易得多 - 团队正在形成并且没有现有的代码可以转换。如果代码不符合标准，您可以使用工具（FxCop、StyleCop）来中断构建。

您应该使用语言和框架的标准 - SQL 代码应该使用 SQL 标准，而 C# 代码应该使用 C# 标准。

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2008-09-29T16:35:59.217

对于公共接口，您应该坚持 MS .NET 框架设计指南：“[大写约定](https://docs.microsoft.com/en-us/dotnet/standard/design-guidelines/capitalization-conventions)”。

对于非暴露成员，那么无论您和您的同事都可以达成一致意见。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-09-29T16:33:56.463

我（和我的团队）更喜欢为班级名称保留首字母大写。

为什么？我认为 Java 标准正在传播。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-14T18:37:31.817

来自 .NET Framework Developer's Guide [Capitalization Conventions](https://docs.microsoft.com/en-us/dotnet/standard/design-guidelines/capitalization-conventions)，区分大小写：

> 大写指南的存在只是为了使标识符更易于阅读和识别。大小写不能用作避免库元素之间名称冲突的方法。
> 
> 不要假设所有编程语言都区分大小写。他们不是。名称不能仅因大小写而异。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2011-07-27T07:30:56.660

我刚刚找到[.Net 的编码标准](http://se.inf.ethz.ch/old/teaching/ss2007/251-0290-00/project/CSharpCodingStandards.pdf)。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-29T16:34:07.430

属性应该使用 Pascal 大小写。就变量名称而言，有些人使用_，有些人使用m_，有些人只使用普通的旧驼色套管。我认为只要您在这里保持一致，就没有关系。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-29T16:34:33.637

您发布的 .NET 示例是一个函数。方法/函数采用的“标准”是 A capped camel-case（或 Pascal，如果你想这样称呼它）。

我尽可能坚持使用骆驼案。它可以让您轻松了解变量和方法之间的区别。

此外，我喜欢在局部类变量前面加上下划线。例如：`_localVar`。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-29T16:36:52.633

我想您必须忍受编码标准对您工作地点的规定，无论您个人多么不喜欢它。也许在未来的某一天，您将能够规定自己的编码标准。

就我个人而言，我喜欢数据库对表和字段使用“fish_name”、“tank_id”等形式的名称，而数据库模型的等效代码是“fishName”和“tankID”。当“fooName”可用时，我也不喜欢“_fooname”命名。但我必须重申，这是主观的，不同的人会因为他们之前的经历和教育而对什么是好什么坏有不同的看法。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-29T16:40:11.860

实际上，对此没有“标准”约定。某处有一个 Microsoft 编辑的指南，并且与任何其他命名约定指南一样，肯定还有另一个反驳它，但这就是我所理解的“标准 C# 大小写约定”。

1.  类型名称（类、枚举）、常量和属性中的 PerWordCaps。
2.  camelCase 用于非常长的局部变量和受保护/私有变量
3.  **没有**ALL_CAPS （嗯，仅在编译器定义中，但不在您的代码中）
4.  似乎一些系统类使用下划线名称（_name）作为私有变量，但我猜这来自原始作者的背景，因为它们中的大多数直接来自 C++。此外，请注意 VB.NET 不区分大小写，因此如果您扩展类，您将无法访问受保护的变量。

实际上，[FxCop](http://msdn.microsoft.com/en-us/library/bb429476(VS.80).aspx)会强制执行其中的一些规则，但是（AFAIK）它会忽略您对局部变量使用的任何拼写。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-09-29T16:46:27.960

我喜欢[Aardvark](http://www.joelonsoftware.com/articles/AardvarkSpec.html)的项目规范中规定的编码约定

* * *

## 回答 #13

> 赞同：-1
> 
> 时间：2017-04-11T09:58:04.597

你喜欢哪个才是最重要的，显然主要是遵守团队的标准。私下里，您可以随意编写代码，无论您将变量命名为 someVariable 还是 SomeVariable，它都不会影响最终产品。

* * *

## 回答 #14

> 赞同：-3
> 
> 时间：2013-04-10T04:38:16.147

我退出编程的那一天——微软将 C# 中的 CamelCase 作为标准。因为我的成长逻辑对 PascalCase 有很多原因，不像孩子的逻辑，他只关心更短的名字或更容易写。

顺便说一句：CamelCasing 主要来自 C++ STD 库风格，这是继承自 C 的原生旧语言。所以 Java 继承自 C++。但是 C# - 是全新的语言 - 干净美观，有新的规则。Oldfags 必须在 Java 或 C++ 上编程，新一代人必须在 C# 上编程 - 他们永远不应该互动。

考虑这个例子： 1) PascalCase: list.Capacity.ToString(); 2）骆驼案例：list.capacity.toString();

在 (1) 中，我们有长期的 CAMEL CASE！表示 listCapacityToString。在（2）中我们有废话：listcapacitytoString。

我就是这样读的。以及为什么 CamelCase 本身不合逻辑。我可以为 PascalCase 杀人，永远不要碰它，任何年龄的孩子。

Microsoft - 永远或直到他们使用 PascalCase。

# c++ - 逗号运算符有什么作用？

> ID：149500
> 
> 赞同：40
> 
> 时间：2008-09-29T16:33:05.777
> 
> 标签：c++, c, operators, comma-operator

以下代码在 C/C++ 中做了什么？

```
if (blah(), 5) {
    //do something
} 
```

* * *

## 回答 #1

> 赞同：66
> 
> 时间：2008-09-29T16:35:20.763

应用逗号运算符，值 5 用于确定条件的真/假。

它将执行 blah() 并取回一些东西（大概），然后使用逗号运算符，并且 5 将是唯一用于确定表达式的真/假值的东西。

* * *

请注意，对于 blah() 函数的返回类型（未指定），可能会重载 , 运算符，从而使结果不明显。

* * *

## 回答 #2

> 赞同：45
> 
> 时间：2008-09-29T16:35:48.097

如果逗号操作符没有被重载，代码类似这样：

```
blah();
if (5) {
  // do something
} 
```

如果逗号运算符重载，则结果将基于该函数。

```
#include <iostream>
#include <string>

using namespace std;

string blah()
{
    return "blah";
}

bool operator,(const string& key, const int& val) {
    return false;
}

int main (int argc, char * const argv[]) {

    if (blah(), 5) {
        cout << "if block";
    } else {
        cout << "else block";
    }

    return 0;
} 
```

*（编辑以显示逗号运算符重载场景。感谢 David Pierre 对此发表评论）*

* * *

## 回答 #3

> 赞同：20
> 
> 时间：2008-09-29T17:19:47.133

我知道这种代码应该做的一件事：它应该让编码器被解雇。在这样写的人旁边工作，我会有点害怕。

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2008-09-29T16:52:24.937

在病态的情况下，这取决于逗号运算符的作用......

```
class PlaceHolder
{
};

PlaceHolder Blah() { return PlaceHolder(); }

bool operator,(PlaceHolder, int) { return false; }

if (Blah(), 5)
{
    cout << "This will never run.";
} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-29T16:35:43.307

我会说这取决于 blah()。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-30T11:46:40.170

关于更广泛的答案。逗号运算符（非重载）解析为，执行第一部分并返回第二部分。

因此，如果您有 (foo(),bar()) 两个函数都将被执行，但表达式的值计算为 bar() （以及表达式的类型）。

虽然我不会说这有合理的用法，但通常被认为有点难以阅读代码。主要是因为没有多少语言共享这样的结构。因此，根据个人经验，我会避免使用它，除非我将代码添加到预先存在的表达式中并且不想完全改变它的格式。

示例：我有一个宏（不讨论是否应该使用宏，有时甚至不是你写的）

FIND_SOMETHING(X) (x>2) ? find_fruits(x) : find_houses(x)

我通常在 my_possession = FIND_SOMETHING(34); 这样的作业中使用它

现在我想将日志添加到它以进行调试，但我无法更改查找功能。我可以做 ：

FIND_SOMETHING(X) (x>2)？(LOG("找水果"),find_fruits(x)):(LOG("找房子"),find_houses(x))

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-29T16:38:14.003

以下是假设它是 C 代码，在 C 文件或 C++ 文件的 C 块中编写的：

*如果*是毫无意义的。它将调用 blah()，但是*if*根本不考虑 blah() 的结果。唯一考虑的是 5，因此 if 将始终评估为 true。IOW，您可以将此代码编写为

```
blah();
// do something 
```

没有任何*如果*。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-01T13:40:32.417

我有时会使用这样的结构来进行调试。无论blah的返回值如何，当我强制if close为真时。很明显，它不应该出现在生产代码中。

# java - 基于注解的 Spring bean 验证

> ID：149506
> 
> 赞同：14
> 
> 时间：2008-09-29T16:33:55.433
> 
> 标签：java, validation, spring-modules

我正在研究一种基于注释的方法来使用[spring modules](https://springmodules.dev.java.net/)验证 Spring beans 。在[本教程](http://wheelersoftware.com/articles/spring-bean-validation-framework.html)中，使用以下 bean（省略了 getter 和 setter）作为示例：

```
public final class User {  

  @NotBlank  
  @Length(max = 80)  
  private String name;  

  @NotBlank  
  @Email  
  @Length(max = 80)  
  private String email;  

  @NotBlank  
  @Length(max = 4000)  
  private String text;  
} 
```

如果不遵守特定验证规则，则使用的错误消息应遵循以下格式：

```
bean-class.bean-propery[validation-rule]=Validation Error message 
```

上面显示的类的示例包括：

```
User.email[not.blank]=Please enter your e-mail address.  
User.email[email]=Please enter a valid e-mail address.  
User.email[length]=Please enter no more than {2} characters. 
```

消息键包含类名的事实带来了几个问题：

1.  如果类被重命名，消息键也需要改变
2.  如果我有另一个类（例如 Person），其电子邮件属性与 User.email 验证相同，我需要复制消息，例如

    Person.email[not.blank]=请输入您的电子邮件地址。
    Person.email[email]=请输入有效的电子邮件地址。
    Person.email[length]=请输入不超过 {2} 个字符。

事实上，文档声称可以为特定规则（例如@Email）配置默认消息，如下所示：

```
email=email address is invalid 
```

如果找不到规则的特定于 bean 的消息，则应使用此默认消息。但是，我的经验是，这根本行不通。

避免重复消息的另一种机制是将错误消息的键传递给规则注释。例如，假设我为 @Email 规则定义了以下默认错误消息

```
badEmail=Email address is invalid 
```

如果我像这样注释相关属性，则应使用此消息：

```
@Email(errorCode="badEmail")
private String email; 
```

但是我一次又一次地尝试了这个，它似乎不起作用。在使用此验证框架时，有没有人找到避免重复错误消息的方法？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-06T20:23:55.923

我快速浏览了[BeanValidator API](https://springmodules.dev.java.net/source/browse/%2Acheckout%2A/springmodules/www/docs/javadocs/0.8/org/springmodules/validation/bean/BeanValidator.html)，看起来您可能想尝试*errorCodeConverter*属性。

您需要实现自己的[ErrorCodeConverter](https://springmodules.dev.java.net/source/browse/%2Acheckout%2A/springmodules/www/docs/javadocs/0.8/org/springmodules/validation/bean/converter/ErrorCodeConverter.html)，还是使用提供的实现之一？

```
....
<bean id="validator" class="org.springmodules.validation.bean.BeanValidator"
    p:configurationLoader-ref="configurationLoader"
    p:errorCodeConverter-ref="errorCodeConverter" />

<bean id="errorCodeConverter" class="contact.MyErrorCodeConverter" />
.... 
```

*注意：configurationLoader 是教程中使用的 config XML 中定义的另一个 bean*

示例转换器：

```
package contact;

import org.apache.commons.logging.Log;
import org.apache.commons.logging.LogFactory;
import org.springmodules.validation.bean.converter.ErrorCodeConverter;

public class MyErrorCodeConverter implements ErrorCodeConverter {

    private Log log = LogFactory.getLog(MyErrorCodeConverter.class);

    @Override
    public String convertPropertyErrorCode(String errorCode, Class clazz, String property) {
        log.error(String.format("Property %s %s %s", errorCode, clazz.getClass().getName(), property));
        return errorCode;  // <------ use the errorCode only
    }

    @Override
    public String convertGlobalErrorCode(String errorCode, Class clazz) {
        log.error(String.format("Global %s %s", errorCode, clazz.getClass().getName()));
        return errorCode;
    }
} 
```

现在属性应该可以工作了：

```
MyEmailErrorCode=Bad email

class Foo {
    @Email(errorCode="MyEmailErrorCode")
    String email
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-06-22T14:41:30.393

Spring 验证确实有一个 ErrorCodeConverter 执行此操作：

org.springmodules.validation.bean.converter.KeepAsIsErrorCodeConverter

使用此选项时，将检查资源包中的以下代码：

[errorCode.commandBeanName.fieldName, errorCode.fieldName, errorCode.fieldClassName, errorCode]

*   errorCode 是实际的验证错误代码，例如。not.blank，电子邮件。
*   commandBeanName 与引用表单支持 bean 的模型键名称相同。
*   fieldName 是字段的名称。
*   fieldClassName 是字段类名，例如。java.lang.String, java.lang.Integer

因此，例如，如果我有一个在模型中由键“formBean”引用的 bean，并且 java.lang.String 类型的字段 emailAddress 不包含电子邮件地址，这会导致 errorCode 电子邮件。验证框架将尝试解析以下消息代码：

[email.formBean.emailAddress、email.emailAddress、email.java.lang.String、email]

如果错误代码被错误代码“badEmail”替换，如下所示：

@Email(errorCode="badEmail")

框架将尝试解析的消息代码将是：

[badEmail.formBean.emailAddress, badEmail.emailAddress, badEmail.java.lang.String, badEmail]

我建议保持 errodCode 相同。因此，一条消息可用于所有与该 errorCode 相关联的字段。如果您需要更具体地使用某个字段的消息，您可以使用代码 errorCode.commandBeanName.field 将消息添加到资源包。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2016-09-07T16:05:29.743

`applicationContext.xml`在您的文件中添加以下 bean 。

```
<bean id="configurationLoader"
    class="org.springmodules.validation.bean.conf.loader.annotation.AnnotationBeanValidationConfigurationLoader" />

<!-- Use the error codes as is. Don't convert them to <Bean class name>.<bean field being validated>[errorCode]. -->    
<bean id="errorCodeConverter"
    class="org.springmodules.validation.bean.converter.KeepAsIsErrorCodeConverter"/>

 <!-- shortCircuitFieldValidation = true ==> If the first rule fails on a field, no need to check 
    other rules for that field -->   
<bean id="validator" class="org.springmodules.validation.bean.BeanValidator"
    p:configurationLoader-ref="configurationLoader"
    p:shortCircuitFieldValidation="true" 
    p:errorCodeConverter-ref="errorCodeConverter"/> 
```

# .net - “提交”按钮在 Firefox 3 中有效，但在 IE7 (ASP 1.1) 中无效

> ID：149530
> 
> 赞同：1
> 
> 时间：2008-09-29T16:37:52.490
> 
> 标签：.net, asp.net

我有需要修改的旧网站的代码。我在两个页面中修改了一些表单代码。我修改了文本框的最大长度，并稍微修改了函数中的一两行代码。发生时的“btnSubmit_Click”函数。

在网络服务器上通过 FTP 上传新代码后，当我使用 Firefox 3 单击“提交”按钮时，该按钮会执行它应该执行的操作。使用 IE7，什么都不会发生。没有页面加载，没有刷新，没有错误，什么都没有。IE 不忙，它不会超时，它不会超时。

然而，在我的开发笔记本电脑上，当我运行项目时，提交按钮在 IE7 中正常工作。

有什么想法吗？

**对 Mecki 的回应：** 它是 method=POST，但它是一个 JavaScript 回发的东西好吧。我还检查了输出的 HTML，提交按钮有一个 JS“onclick”事件：
onclick="if (typeof(Page_ClientValidate) == 'function') Page_ClientValidate();"

当然，尽管所有必填字段都有他们需要的内容。当我通过遗漏必填字段中的信息来测试它时，验证也有效，IE7 要求我填写数据。奇怪的一个。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-05T20:48:49.710

问题并不完整，我遗漏了一个事后看来非常重要的细节：我还将网站从一个主机移动到另一个主机。

问题似乎是验证 JavaScript 代码的不同版本。我通过将**aspnet_client\systemweb\1_1_4322\*.***目录从 IIS 的根目录复制到网站的根目录来解决了这个问题。我转移的网站，在这个目录中已经有代码，它必须是不同的构建版本，或者与新服务器上运行的 ASP 不同的东西。

抱歉 Mecki，如果我对 JavaScript 有任何好处，我会说，你的回答会让我朝着正确的方向前进。西蒙，在调查您的想法时，我注意到 javascript 包含**aspnet_client**。一天结束时，我通过反复试验解决了这个问题，所以我完全不知道是什么导致了我的问题。感谢您的帮助。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-03T18:58:47.483

在将 ASP 站点移植到 ASP.NET 时，我刚刚看到了完全相同的问题。我有一个可以在 Firefox、Safari、Chrome 中提交的表单——但在 IE 或 Opera 中完全没有任何作用。就像您的表格一样，它什么也不做，不抛出任何错误等 - 它只是坐在那里什么都不做。与您的表单不同，这是一个普通的旧回发 - 它没有使用任何客户端来触发表单提交，也没有客户端验证等。

如果我将 onclick 处理程序附加到提交按钮，我可以看到该按钮正在被单击 - 但如果我将 onsubmit 处理程序附加到表单，我什么也得不到。如果我让按钮 onclick 处理程序通过 JavaScript 提交表单，它工作正常 - 它只是直接提交不起作用。

在我的头撞在桌子上一会儿之后，我意识到页面上还有另一个表单——在这个例子中，是由一个单独的类中的一个函数创建的，所以看不见也想不开。在 ASP 中没有问题——这两种形式是分开的。当然，ASP.NET 已经将页面包装在它自己的表单中，而 HTML 不允许嵌套表单。我已经删除了我正在使用的主表单周围的表单标签，但我忽略了第二个表单，因为它位于页面的其他位置和代码的其他位置。所以 IE 和 Opera 忽略了嵌套表单（我认为是正确的），但 Firefox 等人更加宽容并允许表单提交。

这是一个典型的错误示例，在从头开始编写代码时不会犯这种错误，但在批量移植代码时很容易犯这种错误，因为很久以前编写的东西会产生副作用，而这种副作用在你的代码中不会立即可见'重新工作。

这可能与您的问题有关，也可能无关，但它可能会帮助遇到此问题的其他有类似问题的人寻找可能的答案。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2012-10-26T08:25:36.220

从页面中删除多个`<form>`标签。
asp.NET 只允许一个`<form>`标签进入页面。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-29T16:42:29.903

提交按钮是真的提交表单（发送帖子/获取）还是调用 JavaScript 代码来执行检查或其他操作？如果是这样，我的第一个猜测是发生了一些 JS 错误。你应该看看 JS 控制台？（如果IE有一个，我自己不用IE，但是根据[这个MS页面](http://blogs.msdn.com/ie/archive/2004/10/26/247912.aspx)，它有一个，你只需要启用它）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-23T20:02:57.677

我只是有同样的问题。只要确保你没有嵌套标签。或者，如果您使用谷歌搜索框执行此操作，您可以查看本指南以解决问题：

[http://www.codeproject.com/KB/aspnet/CustomSearchEngine.aspx](http://www.codeproject.com/KB/aspnet/CustomSearchEngine.aspx)

# .net - StringBuilder 的 RAM 消耗情况如何？

> ID：149551
> 
> 赞同：6
> 
> 时间：2008-09-29T16:42:23.353
> 
> 标签：.net, stringbuilder, ram

我们有一些操作正在执行大量大字符串连接，并且最近遇到了内存不足异常。不幸的是，调试代码不是一种选择，因为这是在客户站点发生的。

所以，在对我们的代码进行大修之前，我想问一下：对于大字符串，StringBuilder 的 RAM 消耗特性是什么？

特别是当它们与标准字符串类型进行比较时。字符串的大小远远超过 10 MB，我们似乎遇到了大约 20 MB 的问题。

**注意**：这不是关于速度，而是关于 RAM。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-09-29T16:47:17.257

每次 StringBuilder 用完空间时，它都会重新分配一个两倍于原始缓冲区大小的新缓冲区，复制旧字符，并让旧缓冲区进行 GC。您可能只是使用了足够的（称为 x），以至于 2x 大于您允许分配的内存。您可能想要确定字符串的最大长度，并将其传递给 StringBuilder 的构造函数，以便您进行预分配，并且您不会受到双倍重新分配的支配。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-09-29T17:54:34.380

这是关于[字符串连接与内存分配](http://blog.cumps.be/string-concatenation-vs-memory-allocation/)的一个很好的研究。

> **如果你可以避免连接，那就去做吧！**
> 
> 这很简单，如果您不必连接但希望源代码看起来不错，请使用第一种方法。它将像单个字符串一样得到优化。
> 
> **永远不要使用 += 连接。**幕后发生了太多的变化，这在我的代码中并不明显。我建议宁可将 String.Concat() 显式用于任何重载（2 个字符串、3 个字符串、字符串数组）。这将清楚地显示您的代码所做的事情，不会有任何意外，同时让您自己检查效率。
> 
> **尝试估计 StringBuilder 的目标大小。**
> 
> 估计所需大小越准确，StringBuilder 为增加其内部缓冲区而必须创建的临时字符串就越少。
> 
> **当性能成为问题时，不要使用任何 Format() 方法。**
> 
> 解析格式涉及太多开销，当您使用的所有内容都是 {x} 替换时，您可以构建一个由片段组成的数组。Format() 有利于提高可读性，但是当您从应用程序中挤出所有可能的性能时，这是要做的事情之一。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-29T19:28:38.007

您可能对绳索数据结构感兴趣。这篇文章：[绳索：理论和实践](http://www.ibm.com/developerworks/java/library/j-ropes/index.html "绳索：理论与实践")解释了它们的优势。也许有一个.NET 的实现。

[更新，回答评论] 它是否使用更少的内存？在文章中搜索*内存*，你会发现一些提示。
基本上，是的，尽管有结构开销，因为它只是在需要时添加内存。StringBuilder，当耗尽旧缓冲区时，必须分配一个更大的缓冲区（这已经浪费了空内存）并丢弃旧缓冲区（这将被垃圾收集，但同时仍然可以使用大量内存）。

我还没有找到 .NET 的实现，但至少有一个 C++ 实现（在 SGI 的 STL 中：[http](http://www.sgi.com/tech/stl/Rope.html) ://www.sgi.com/tech/stl/Rope.html ）。也许你可以利用这个实现。请注意我参考的页面有关于内存性能的工作。

请注意，绳索并不是解决所有问题的方法：它们的实用性在很大程度上取决于您如何构建大弦以及如何使用它们。文章指出了优点和缺点。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-29T17:20:42.713

Strigbuilder 是解决连接字符串引起的内存问题的完美解决方案。

为了回答您的具体问题，与字符串长度等于当前分配的 Stringbuilder 缓冲区长度的普通字符串相比，Stringbuilder 具有恒定大小的开销。缓冲区可能是生成的字符串大小的两倍，但是在连接到 Stringbuilder 时不会再分配内存，直到缓冲区被填满，所以它确实是一个很好的解决方案。

与字符串相比，这是出色的。

```
string output = "Test";
output += ", printed on " + datePrinted.ToString();
output += ", verified by " + verificationName;
output += ", number lines: " + numberLines.ToString(); 
```

这段代码有四个字符串作为文字存储在代码中，两个在方法中创建，一个来自变量，但它使用了六个独立的中间字符串，这些字符串越来越长。如果这种模式继续下去，它将以指数速度增加内存使用量，直到 GC 开始清理它。

* * *

## 回答 #5

> 赞同：-2
> 
> 时间：2008-09-29T16:48:14.930

我不知道字符串生成器的确切内存模式，但通用字符串不是一个选项。

当您使用公共字符串时，每个连接都会创建另外几个字符串对象，并且内存消耗猛增，使得垃圾收集器被过于频繁地调用。

```
string a = "a";

//creates object with a

a += "b"

/creates object with b, creates object with ab, assings object with ab to "a" pointer 
```

# orm - 将 Subsonic 用于可能被大量访问的 ASPNET MVC 应用程序

> ID：149557
> 
> 赞同：3
> 
> 时间：2008-09-29T16:44:10.383
> 
> 标签：orm, subsonic, scalability

我即将为一个可能被大量访问的 ASPNET MVC 应用程序启动一个项目，并且我正在考虑将 Subsonic 用于我的 DAL。我对 Subsonic 处理数千个并发请求的能力有些担心。谁能给我一些使用 Subsonic 的流行网站的例子？此外，如果您对除了 NHibernate 之外的 Subsonic 的可能替代品有任何建议，那也很好。谢谢

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-29T16:53:59.127

*数以千计*的并发请求？你确定这很可能吗？

值得一提的是，[DotNetKicks](http://www.dotnetkicks.com/)使用 SubSonic，而且似乎从来没有性能问题。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-18T01:38:39.233

我每个月通过 SubSonic 发出大约 4-5M 的请求，没有任何问题，事实上它非常快，而且我的服务器几乎没有征税。这些请求在白天达到峰值，所以虽然我们没有达到 1000 个并发请求，但我对 SubSonic 在负载下的印象非常深刻。因为它使用生成的代码，它实际上会比您在那里找到的大多数 ORM 更快。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-02T05:09:37.330

SubSonic 是一种工具，您必须明智地使用它，例如将缓存添加到您的站点并在有时使用它们时关闭 IDataReader。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-29T18:21:05.143

作为指导，如果您有 1000 个用户，您的并发用户不会超过 1 或 2 个。至少在我的经验中。要拥有 1K 并发用户，您至少应该拥有 500K-1M 用户。

# python - Python 桌面小部件

> ID：149559
> 
> 赞同：2
> 
> 时间：2008-09-29T16:44:21.397
> 
> 标签：python, desktop, widget

我对制作类似于 Apple 的 Dashboard 或 Vista 的桌面小部件很感兴趣。如果可能的话，我想让它们跨平台。Opera 的小部件是跨平台的，但需要用户安装 Opera，所以这是一个很大的限制。

我知道大多数小部件都是用 HTML/XML、CSS 和 Javascript 制作的。有没有办法使用 Python 创建它们？

* * *

**更新**：我确实找到了一个谈论[睡衣](http://advogato.org/article/981.html)的网站。有没有人有它的经验，如果有，它的功能/限制是什么？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-29T17:16:59.167

你应该看看[Digsby](http://www.digsby.com/)的人在做什么。基本上，他们已经[为 wxWidgets](http://wxwebkit.wxcommunity.com/)编写了一个 WebKit 端口，然后使用 WebKit 来呈现界面，并使用 wxPython 来编写应用程序的其余部分。非常整洁，但目前*非常*alpha。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-29T17:21:12.433

看看[gDesklets](http://www.gdesklets.de/)。AFAIK 它们只是 UNIX，但也许将它们移植到其他平台比从头开始更有意义？

他们使用 python 创建小部件（desklets）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2015-02-19T01:20:18.790

[Screenlets](https://launchpad.net/screenlets)就是为这个任务而设计的。

> Screenlets 项目既是一个 Python 框架，用于简化编写 Cairo 绘制的桌面小部件，类似于 OS:X 的“仪表板”功能中的那些。

小部件可以完全用 Python 编写。已经开发了使用该框架[的小部件集合。](https://launchpad.net/indiv-screenlets)

它旨在与 Linux 桌面一起使用。但在我看来，它应该很容易移植到其他平台，因为 Cairo 是跨平台的。

缺点

*   它不经常更新。最新版本 0.1.6 于 2012-01-27 发布
*   它的主页已经关闭了一段时间。启动板虽然有效。
*   仅支持 Python 2。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-29T17:03:40.277

您可以查看[PyGTK](http://www.pygtk.org/)，它允许您创建桌面小部件，但它们不会由 OSX 的仪表板管理。如果你想[开发一个 OSX 小部件](http://developer.apple.com/macosx/dashboard.html)，你会想坚持使用 HTML/CSS/JavaScript。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-29T17:05:28.523

看看pyqt4。它具有 webkit 集成。我自己正在研究这个，但还没有真正有时间深入研究 API。

# .net - 如何编写 .NET 单元测试？

> ID：149569
> 
> 赞同：2
> 
> 时间：2008-09-29T16:46:51.063
> 
> 标签：.net, tdd

如何在 .NET 中编写单元测试？

特别是 Visual Studio 2005？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-29T16:55:59.483

如果您使用的是 Visual Studio Team Suite 产品之一，请参考 Microsoft.VisualStudio.TestTools.UnitTesting，使用 TestClass 属性装饰您的测试类，并使用 TestMethod 属性装饰您的测试方法。

NUnit 的方法类似，只是你引用了 NUnit.Framework，类将使用 TestFixture 进行修饰，而测试方法将使用 Test 进行修饰。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-29T17:30:42.253

如果你决定使用[NUnit](http://www.nunit.org/)，那么看看[testdriven.net](http://www.testdriven.net/)可能是个好主意，因为它提供了与 Visual Studio 的非常好的集成。目前还有多种其他单元测试框架可用。我建议您考虑[xUnit](http://www.codeplex.com/xunit)。我知道您在想什么：“为什么要使用另一个单元测试框架？”。确实，没有什么特别好但仍然如此。查看这篇[博文](http://jamesnewkirk.typepad.com/posts/2007/09/announcing-xuni.html)，如果您决定可以使用[ReSharper](http://www.jetbrains.com/resharper/) [插件](http://www.codeplex.com/xunit/Wiki/View.aspx?title=HowToUseResharper&referringTitle=Home)进行 Visual Studio 集成。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-17T13:02:02.927

这是使用[NUnit的基本思想](http://www.nunit.org)

创建一个测试项目。

在测试项目中引用您的应用程序的主项目。

在测试项目中创建一个测试类。

添加`Imports nunit.Framework`

用`<TestFixture()>`

比如 `<TestFixture()> Public Class MyTestClass` ...

创建测试方法，每个都装饰`<Test()>`并添加您的测试：

```
<Test()> _
Public Sub harness()
    Assert.IsTrue(False)
End Sub 
```

构建您的测试项目。打开 NUnit 并在那里打开您的测试项目。单击“运行”绿色为通过，红色为失败。

上面的“线束”测试只是为了证明你在开始测试自己的东西之前已经把所有东西都连接起来了。一旦正确连接（并且您在测试中失败）切换到“true”，NUnit 应该显示绿色。

从这里开始，您开始为自己的项目添加测试。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-29T16:48:34.243

您可以使用其中一种 Team Suite 产品，也可以使用[NUnit 等第](http://www.nunit.org/index.php)3 方工具。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-29T17:25:32.967

有很多方法可以编写单元测试。不确定您是在询问执行单元测试的工具，还是想知道单元测试的过程。

[NUnit](http://nunit.org/)是一种流行的测试工具。可以与 Visual Studio Team Suite 产品一起使用的 Microsoft 的[MSTest](http://msdn.microsoft.com/en-us/library/ms182489(VS.80).aspx)也非常好。

如果您打算进行大量测试，我建议您阅读有关持续集成的内容。

就实际编写测试而言，这对于 StackOverflow 来说是一个非常复杂的话题。我建议阅读有关测试的文章。有很多内容涵盖了这个主题。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-17T12:29:46.780

+1 在 MbUnit 上并 efinetly 使用 testdriven.net

我发现它更快，特别是对于数据模型测试

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-17T13:09:13.643

SpecUnit 对 NUnit 进行了 BDD 样式单元测试的一个很好的补充。我真的很喜欢在名为“When_x_happens”之类的类中进行测试的想法，并且该类中的方法描述了 x 发生时的预期结果 - “foo_should_do_bar()”。SpecUnit 还有一个用于从测试生成报告的工具，这是一个很好的文档来源。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-29T17:28:40.510

在我看来，[MBUnit](http://www.mbunit.com/)是要走的路。它大大优于 NUnit（非常相似，但支持行测试和事务）和其他 MS 工具（Team Suite 并没有真正成功，我不鼓励使用它）。

> MbUnit 提供先进的单元测试支持和先进的夹具，使开发人员和测试人员能够测试他们软件的各个方面。

# ruby - Ruby 中的延续

> ID：149570
> 
> 赞同：12
> 
> 时间：2008-09-29T16:47:06.960
> 
> 标签：ruby, continuations

有没有人做过让 Ruby 做延续的工作（比如 Smalltalk 上的 Seaside）？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-09-29T17:11:22.643

是的，在大多数情况下。就我的记忆而言，MRI (1.8) 已经支持它们，Ruby 1.9 (YARV) 也支持它们， Rubinius[也是](http://svn.ruby-lang.org/cgi-bin/viewvc.cgi?view=rev&revision=12380)如此。JRuby 和 IronRuby 没有延续，而且它们不太可能获得它们（JVM 和 CLR 使用堆栈自检来确保安全性）

Ruby 作为一种语言支持通过`callcc`关键字进行延续。例如，它们用于实现`Generator`标准库中的类。

**[ruby-doc 的延续](http://www.ruby-doc.org/docs/ProgrammingRuby/html/ref_c_continuation.html)**

基于延续的 Web 框架（如 seaside 或 Arc 的 std. 库中的一个）似乎不太受欢迎。我发现[有人](http://rubyforge.org/projects/wee/)声称可以让你做可选的延续，但我从未使用过它。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-09-29T17:34:58.530

正如其他人已经说过的，Ruby 1.8 支持延续。

然而，Ruby 1.9 已经有一段时间不支持它们了。它们在今年的某个时候被重新添加，但大多数其他 Ruby 解释器（JRuby、IronRuby 等）不支持它们。

如果您希望您的代码在主线 Ruby 以外的其他平台上可用，我建议不要使用它们。

阅读[这篇 InfoQ 文章](http://www.infoq.com/news/2007/08/ruby-1-9-fibers)，以获得关于该主题的更全面的讨论。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-12-23T23:53:44.860

顺便说一句[，这](http://chneukirchen.org/blog/archive/2005/03/restartable-exceptions.html)是使用延续实现的可重新启动异常（又名条件）的示例。我用过它几次，在 Ruby 工具箱中拥有它是一件很酷的事情。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-29T16:43:58.970

neverblock 使用 1.9 光纤作为单线程 ruby​​ Web 服务器

# javascript - 检查是否使用 jQuery 选择了选项，如果没有选择默认值

> ID：149573
> 
> 赞同：211
> 
> 时间：2008-09-29T16:47:31.610
> 
> 标签：javascript, jquery, forms, dom, html-select

使用 jQuery，您如何检查选择菜单中是否选择了一个选项，如果没有，则将其中一个选项指定为已选择。

（选择是在我刚刚继承的应用程序中使用迷宫般的 PHP 函数生成的，所以这是一个快速修复，当我了解这些时：）

* * *

## 回答 #1

> 赞同：272
> 
> 时间：2008-09-29T17:42:11.273

虽然我不确定你想要完成什么，但这段代码对我有用。

```
<select id="mySelect" multiple="multiple">
  <option value="1">First</option>
  <option value="2">Second</option>
  <option value="3">Third</option>
  <option value="4">Fourth</option>
</select>

<script type="text/javascript"> 
$(document).ready(function() {
  if (!$("#mySelect option:selected").length) {
    $("#mySelect option[value='3']").attr('selected', 'selected');
  }
});
</script> 
```

* * *

## 回答 #2

> 赞同：30
> 
> 时间：2008-09-29T16:57:01.493

无需为此使用 jQuery：

```
var foo = document.getElementById('yourSelect');
if (foo)
{
   if (foo.selectedIndex != null)
   {
       foo.selectedIndex = 0;
   } 
} 
```

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2013-09-13T19:27:24.950

这个问题很老并且有很多观点，所以我将在那里抛出一些东西，这将有助于我确定的一些人。

要检查一个选择元素是否有任何选定的项目：

```
if ($('#mySelect option:selected').length > 0) { alert('has a selected item'); } 
```

或检查选择是否未选择任何内容：

```
if ($('#mySelect option:selected').length == 0) { alert('nothing selected'); } 
```

或者，如果您处于某种循环中并想要检查是否选择了当前元素：

```
$('#mySelect option').each(function() {
    if ($(this).is(':selected')) { .. }
}); 
```

检查循环中是否未选择元素：

```
$('#mySelect option').each(function() {
    if ($(this).not(':selected')) { .. }
}); 
```

这些是执行此操作的一些方法。jQuery 有许多不同的方式来完成相同的事情，因此您通常只需选择看起来最有效的一种。

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2008-09-29T17:51:55.963

[lencioni 的回答](https://stackoverflow.com/questions/149573/check-if-option-is-selected-with-jquery-if-not-select-a-default/149820#149820)是我推荐的。您可以`('#mySelect option:last')`使用“”更改选项的选择器以选择具有特定值的选项`#mySelect option[value='yourDefaultValue']`。 [更多关于选择器](http://docs.jquery.com/Selectors "更多选择器")。

如果您在客户端上广泛使用选择列表，请查看此插件： [http](http://www.texotela.co.uk/code/jquery/select/) ://www.texotela.co.uk/code/jquery/select/ 。如果您想查看更多使用选择列表的示例，请查看源代码。

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2009-10-30T12:25:17.840

这是我更改所选选项的功能。它适用于 jQuery 1.3.2

```
function selectOption(select_id, option_val) {
    $('#'+select_id+' option:selected').removeAttr('selected');
    $('#'+select_id+' option[value='+option_val+']').attr('selected','selected');   
} 
```

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2009-12-09T11:59:56.667

```
<script type="text/javascript"> 
$(document).ready(function() {
  if (!$("#mySelect option:selected").length)
   $("#mySelect").val( 3 );

});
</script> 
```

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-09-29T18:06:40.827

我已经遇到了提到的[texotela 插件](http://www.texotela.co.uk/code/jquery/select/)，它让我可以这样解决它：

```
$(document).ready(function(){
    if ( $("#context").selectedValues() == false) {
    $("#context").selectOptions("71");
    }
}); 
```

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2009-12-04T16:27:10.693

**简单的！**默认应该是第一个选项。**完毕！**这将导致您使用不显眼的 JavaScript，因为不需要 JavaScript :)

[不显眼的 JavaScript](http://en.wikipedia.org/wiki/Unobtrusive_JavaScript)

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-09-29T16:51:26.933

查看元素的[selectedIndex](http://www.w3schools.com/htmldom/prop_select_selectedindex.asp)。`select`顺便说一句，这是一个普通的 DOM 事情，不是特定于 JQuery 的。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2009-10-30T21:38:08.177

这是一个我发现有效的快速脚本......结果被分配给一个标签。

```
$(".Result").html($("option:selected").text()); 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-12-04T16:03:08.857

你们在选择方面做得太多了。只需按值选择：

```
$("#mySelect").val( 3 ); 
```

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2013-08-21T09:48:00.890

```
if (!$("#select").find("option:selected").length){
  //
} 
```

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2015-03-21T16:20:30.567

我找到了一个很好的方法来检查是否选择了选项并在没有选择时选择默认值。

```
 if(!$('#some_select option[selected="selected"]').val()) {
        //here code if it HAS NOT selected value
        //for exaple adding the first value as "placeholder"
        $('#some_select option:first-child').before('<option disabled selected>Wybierz:</option>');
    } 
```

如果**#some_select 没有**默认选择的选项，则**.val(** )*未定义*

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2010-08-15T12:18:31.737

```
$("option[value*='2']").attr('selected', 'selected');
// 2 for example, add * for every option 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2012-04-02T07:32:33.500

```
$("#select_box_id").children()[1].selected 
```

这是在 jquery 中检查选项是否被选中的另一种方法。这将返回布尔值（真或假）。

[1] 是选择框选项的索引

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2014-02-14T19:25:28.110

更改选择框上的事件以触发，一旦触发，只需拉出所选选项的 id 属性：-

```
$("#type").change(function(){
  var id = $(this).find("option:selected").attr("id");

  switch (id){
    case "trade_buy_max":
      // do something here
      break;
  }
}); 
```

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2014-04-22T19:59:34.400

我只是在寻找类似的东西，发现了这个：

```
$('.mySelect:not(:has(option[selected])) option[value="2"]').attr('selected', true); 
```

这将查找类中尚未选择选项的所有选择菜单，并选择默认选项（在本例中为“2”）。

我尝试使用`:selected`而不是`[selected]`，但这不起作用，因为总是选择某些东西，即使没有任何属性

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2016-01-17T09:19:43.557

如果您需要明确检查每个选项以查看是否有任何选项具有“选定”属性，您可以执行此操作。否则，使用`option:selected`您将获得第一个默认选项的值。

```
var viewport_selected = false;      
$('#viewport option').each(function() {
    if ($(this).attr("selected") == "selected") {
        viewport_selected = true;
    }
}); 
```

# algorithm - 需要一种将网络块范围折叠成超集范围列表的算法

> ID：149577
> 
> 赞同：14
> 
> 时间：2008-09-29T16:48:20.157
> 
> 标签：algorithm

我的数学让我失望了！我需要一种将网络范围缩小为超集的有效方法，例如，如果我输入 IP 范围列表：

*   1.1.1.1 至 2.2.2.5
*   1.1.1.2 至 2.2.2.4
*   10.5.5.5 至 155.5.5.5
*   10.5.5.6 至 10.5.5.7

我想返回以下范围：

*   1.1.1.1 至 2.2.2.5
*   10.5.5.5 至 155.5.5.5

注意：输入列表没有排序（尽管它们可能是？）。执行此操作的简单方法是检查列表中的每个范围以查看输入范围 x 是否是子集，如果是，则不插入范围 x。但是，每当您插入新范围时，它可能是现有范围的超集，因此您必须检查现有范围以查看它们是否可以折叠（例如，从我的列表中删除）。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-09-29T17:44:12.003

这是段计算的联合。最佳算法（在 O(nlog(n)) 中）包括执行以下操作：

2.  对列表 L 中的所有端点（起点和终点）进行排序（每个端点都应该知道它所属的段）。如果端点等于起点，则应认为起点小于终点。
3.  从左到右遍历排序列表 L 并保持数字**LE-RE**，其中**LE**是您已经通过的左侧端点的数量，**RE**是您已经通过的右侧端点的数量。
4.  每次**LE-RE**达到零时，您都处于连接的段并集的末尾，并且您知道您之前看到的段的并集（因为之前返回零）是一个超集。
5.  如果您还保持了最小值和最大值，则在每次归零之间，您就有了超集的界限。

最后，你得到一个不相交超集的排序列表。尽管如此，两个超集 A 和 B 可以相邻（A 的端点正好在 B 的起点之前）。如果要合并 A 和 B，可以通过简单的后处理步骤或稍微修改步骤 3 来实现：当**LE-RE**达到零时，仅当L 不是您当前元素的直接继承者。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-30T11:06:48.987

您知道可以轻松地将 IPv4 地址转换为 int 数字（int32 数字），对吗？使用 int 数字要容易得多。所以基本上每个地址都是 0 到 2^32 范围内的数字。每个范围都有一个起始编号和一个结束编号。你的例子

```
1.1.1.1 to 2.2.2.5
1.1.1.2 to 2.2.2.4 
```

可以写成

```
16,843,009 to 33,686,021
16,843,010 to 33,686,020 
```

所以很容易看出一个范围是否在另一个范围内。如果给出以下条件，则一个范围完全在另一个范围内

```
startIP2 >= startIP1 && startIP2 <= endIP1 &&
endIP1 >= startIP1 && endIP2 <= endIP1 
```

在这种情况下，范围 startIP2-endIP2 完全在 startIP1-endIP1 内。如果只有第一行为真，则 startIP2 在 startIP1-endIP1 范围内，但 end 超出范围。如果只有第二行为真，则 endIP 在范围内，但起始 IP 在范围外。在这种情况下，如果只有一行为真，则需要在开头或结尾扩展范围。如果两条线都为假，则范围完全不相交，在这种情况下，它们是两个完全独立的范围。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-29T16:56:30.557

您需要做的只是检查重叠范围。如果两个范围重叠，则它们将合并为一个范围。如果一个范围的右侧大于另一个范围的左侧，则范围重叠。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-29T17:27:11.123

好吧，我的同事想出了这个答案，我认为这非常好。如果您发现任何问题，请告诉我：

*   按 StartIP 排序 IP 范围
*   对于要插入的每一行“x”：
    *   如果列表中有前一行“y”，则获取：
        *   如果 x 和 y 是连续的，则将 y 扩展到 x 的 EndingIP
        *   否则，如果 x.StartingIP <= y.StartingIP 和 x.EndingIP > y.EndingIP，则将 y 扩展到 x.EndingIP
        *   否则，如果 x 是 y 的子集，则什么也不做
        *   否则，创建一个新范围
    *   否则，创建一个新范围并插入到列表中

# eclipse - 当使用 svn tortoise 签出代码时，从 Eclipse 中查看存储库信息

> ID：149583
> 
> 赞同：1
> 
> 时间：2008-09-29T16:49:20.997
> 
> 标签：eclipse, svn, maven-2

我正在使用 svn tortoise 从存储库中签出一个 maven 项目，然后我打开 eclispe，并使用 m2eclipse 插件导入一个 maven 项目。maven 项目可以正常运行，我可以很好地构建它。

问题是使用颠覆性的 Eclipse 并没有将文件/资源​​标记为处于源代码控制中（即使我似乎拥有所有相关的 .svn 目录。）

如果我尝试在 using -> import -> check out Maven Projects from SCM 中检查代码，我会得到相同的行为。即项目导入正常，但文件未链接到 Eclipse 中的 svn 存储库。

关于如何进行，有什么建议吗，因为我发现乌龟 svn 签入过程非常痛苦。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-29T16:54:32.963

您是否为团队共享设置了项目（右键单击项目->团队->共享项目）？如果我没记错的话，应该检测现有的 .svn 文件夹并在 Eclipse 中启用版本控制。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-30T19:48:38.483

我强烈建议您确保使用 tortoise svn 提交，因为我与 subclipse 的一致性特别差。如果你用乌龟进/出，然后用 subclipse 更新你应该没问题。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-29T17:07:11.077

您可能想尝试使用[Subclipse](http://subclipse.tigris.org/)。它是 Subversion 的 Eclipse 插件，非常好。我还发现，在使用 Tortoise 与 SVN 存储库交互的同时，还打开 Eclipse 并访问相同的存储库会导致问题。如果可以的话，你应该避免它。

# python - BeautifulSoup 的 Python 3 兼容性

> ID：149585
> 
> 赞同：20
> 
> 时间：2008-09-29T16:49:50.667
> 
> 标签：python, python-3.x, beautifulsoup, porting

BeautifulSoup 是否适用于 Python 3？

如果没有，多久会有港口？会有港口吗？

谷歌没有向我提供任何信息（也许是因为我在寻找错误的东西？）

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2012-03-28T11:03:10.490

Beautiful Soup **4.x** [正式支持 Python 3。](https://groups.google.com/forum/#!msg/beautifulsoup/VpNNflJ1rPI/sum07jmEwvgJ)

```
pip install beautifulsoup4 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-12-30T07:19:47.197

在我提出这个问题大约两个月后，一个端口已经发布：

[http://groups.google.com/group/beautifulsoup/browse_thread/thread/f24882cc17a0625e](http://groups.google.com/group/beautifulsoup/browse_thread/thread/f24882cc17a0625e)

它会打赌BS工作，但仅此而已。不过还没试过。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-12-02T13:54:42.197

[http://www.crummy.com/software/BeautifulSoup/](http://www.crummy.com/software/BeautifulSoup/)说：

> 下载美丽的汤
> 
> 如果您使用的是 Python 2.3 到 2.6，那么 3.0 系列是最佳选择。3.0 系列中的最新版本是 3.0.8，于 2009 年 11 月 30 日发布。
> 
> 如果您使用的是 Python 3.0，则必须使用 3.1 系列。Beautiful Soup 3.1.0.1 版本于 2009 年 1 月 6 日发布。您可以将 3.1 系列与早期版本的 Python 一起使用，但您可能会遇到此处描述的问题。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-01T07:27:38.957

有一个[Python 3.0 的候选](http://www.python.org/download/releases/3.0/)版本，所以你可以自己测试 BeautifulSoup 的兼容性:)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-29T16:57:57.777

我猜答案是“不”。根据[Python.org](http://www.python.org/download/releases/3.0/)：

> Python 3000（又名“Py3k”，作为 Python 3.0 发布）是该语言的新版本，与 2.x 版本线不兼容。语言基本相同，但许多细节，尤其是字典和字符串等内置对象的工作方式发生了很大变化，最终删除了许多不推荐使用的功能。此外，标准库已经在几个显着的地方进行了重组。

[BeautifulSoup 论坛](http://groups.google.com/group/beautifulsoup)可能是解决这个特定问题的更好地方。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2018-07-23T16:05:46.823

是的，漂亮的汤在 python 3 中工作，

Linux

```
apt-get install python3-bs4 
```

视窗

```
pip install beautifulsoup4 
```

有关更多信息，请参阅[https://www.crummy.com/software/BeautifulSoup/bs4/doc/#installing-beautiful-soup](https://www.crummy.com/software/BeautifulSoup/bs4/doc/#installing-beautiful-soup)

# c# - 如何在 Linq 2 SQL 映射中定义类型？

> ID：149593
> 
> 赞同：0
> 
> 时间：2008-09-29T16:52:09.273
> 
> 标签：c#, linq-to-sql, .net-3.5

我正在尝试手动执行我的 linq 2 sql 对象，所以我有以下代码：

```
var mapping = XmlMappingSource.FromXml(xml);

using (DataContext ctx = new DataContext(conn_string, mapping))
{
    list = ctx.GetTable<Achievement>().ToList();
} 
```

XML 看起来像这样：

```
<?xml version="1.0" encoding="utf-8" ?>
<Database Name="FatFights" xmlns="http://schemas.microsoft.com/linqtosql/mapping/2007">
  <Table Name="dbo.Achievements">
    <Type Name="FatFights.Business.Objects.Achievement">
      <Column Name="Id" Member="Id" DbType="UniqueIdentifier NOT NULL" IsPrimaryKey="true" />
      <Column Name="UserId" Member="UserId" />
      <Column Name="Achieved" Member="Achieved" />
      <Column Name="AchievementId" Member="AchievementTypeId" />
      <Association Name="AchievementType_Achievement" Member="AchievementTypeId" ThisKey="Id" OtherKey="Id" IsForeignKey="true" />
    </Type>
  </Table>
</Database> 
```

这将返回以下错误：

System.InvalidOperationException：在类型“Int32”上找不到键“Id”的键成员“Id”。键可能是错误的，或者“Int32”上的字段或属性已更改名称..

所以我需要弄清楚如何告诉 Linq 2 SQL Id 是 GUID 而不是 Int32 ......所以我生成了一些 Linq2SQL XML 来看看它们是如何做到的，它们传递了 Type，但是根据 Type，Type 不是一个有效的属性XSD，所以它失败了。

这是 SQL 表：

```
CREATE TABLE Achievements
(
    Id              UNIQUEIDENTIFIER    NOT NULL    CONSTRAINT RG_Achievements ROWGUIDCOL
                                                    CONSTRAINT DF_Achievements_Id DEFAULT (NEWID()),
    UserId          UNIQUEIDENTIFIER    NOT NULL,
    AchievementId   INTEGER             NOT NULL,
    Achieved        DATETIME            NOT NULL,

    CONSTRAINT FK_Achievements_Users
        FOREIGN KEY (UserId)
        REFERENCES aspnet_Users (UserId),

    CONSTRAINT FK_Achievements_AcheivementTypes
        FOREIGN KEY (AchievementId)
        REFERENCES AchievementTypes (Id),

    CONSTRAINT PK_Achievements
        PRIMARY KEY (Id),

    CONSTRAINT UQ_Achievements_1
        UNIQUE (UserId, AchievementId)
) 
```

和业务对象：

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;

namespace FatFights.Business.Objects
{
    public class Achievement
    {
        public Guid Id { get; set; }
        public Guid UserId { get; set; }
        public int AchievementTypeId { get; set; }
        public DateTime Achieved { get; set; }
    }
} 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-29T19:04:24.307

我怀疑问题出在这里：

成员="AchievementTypeId"

对于关联，您应该链接一个类型化的成员 - 例如，您可能有一个名为“AchievementType”（AchievementType 类型）的属性，并且有 Member="AchievementType"。

例如，在 Northwind 中，链接 Customer 和 Order 显示（对于 Order）：

```
<Association Name="Customer_Order" Member="Customer"
  ThisKey="CustomerID" OtherKey="CustomerID"
  Type="Customer" IsForeignKey="true" /> 
```

然后，SqlMetal 生成的代码有一些链接 CustomerID 和 Customer 属性的过于复杂的代码。

# cross-platform - 多平台开发

> ID：149596
> 
> 赞同：2
> 
> 时间：2008-09-29T16:52:41.283
> 
> 标签：cross-platform

我目前正在使用单声道在 C# 中开发桌面应用程序，并在 SuSE 和 Windows 中进行测试。这个概念并不重要，但它是一个“web lint”程序，它将扫描网站并返回可能存在的安全问题和/或跨浏览器兼容性问题。但是，我希望能够为多个平台提供二进制文件。我应该继续使用 Mono，还是有其他平台可以让我更好地使用平台，例如 Mac、Windows、Linux 和其他平台（可能是移动平台），并且更容易移植？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-29T16:59:23.513

好吧，您最好的选择始终是使用所有平台上实际存在的语言。我认为，这通常意味着 Java，尽管 perl 也有适用于移动平台的风格（取决于所讨论的移动平台）。

我的大部分跨平台工作都是在 C 和 perl 中完成的，但是 C 有一些令人头疼的问题（很多 #ifdef's），而且 perl 可能不在你关心的移动平台上（还）。您必须评估您想要定位的所有平台通用的语言/编译器/解释器，然后从该列表中进行选择。在不知道此类平台的完整列表的情况下，我们将很难告诉您使用什么，尽管 Java 有足够的流行语，可能是一个强有力的候选者。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-29T17:35:54.270

如果您了解 C++，[Qt](http://en.wikipedia.org/wiki/Qt_%28toolkit%29)将涵盖许多平台。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-29T17:27:52.743

对于大多数桌面环境，C# 和 Mono 可能已经足够跨平台了。诀窍将是“移动平台”要求。

移动操作系统种类繁多，没有太多可以概括的方法。有些有Java，比如黑莓。C# 可能会让您进入基于 Windows Mobile 的平台。iPhone做自己的事情。你几乎必须选择一个平台并瞄准它。这可能最终会告知您的桌面平台选择。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-30T07:48:35.217

只要坚持使用 Mono，确保您有宪兵代码检查器（FxCop for Mono）检查您的代码是否存在可移植性问题，您应该没问题。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-29T16:58:42.720

Java 将在 Windows、Linux 和 Mac 上运行。应该很容易从 C# 转换 - 使用 Apache HTTPClient 来抓取您正在扫描的 Web 内容，并且扫描代码应该或多或少相同。然而，缺点是要求用户安装 Java 运行时。

Python 是另一种选择 - 您可以为 Windows 构建独立的可执行文件，默认情况下它附带大多数 Linux 发行版，还有 Mac OS X（需要引用；））。这对 Windows 用户来说少了很多麻烦（语言被编译成可执行文件，不需要其他下载）。

如果单声道在 Mac OS X 上运行，那么这肯定也是一个很好的平台吗？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-29T17:21:37.330

这真的取决于你想做什么。对于 Web 开发，如果 HTML/JavaScript 就足够了，那就坚持下去。如果您需要更高级的东西，我会使用带有 Mono 的 ASP.NET（您可能会这样做），因为您已经知道了。（您可以在此处使用 Visual Studio。）

另一种选择可能是（因为您是 C# 开发人员）使用 Silverlight。这为您提供了 Windows 和 Mac 平台，希望[Moonlight](http://www.mono-project.com/Moonlight)稍后会覆盖 Linxu 平台。（您可以在此处使用 Visual Studio 和 Expression Blend。）

如果您需要桌面应用程序，那么 Java 可能是最简单的，因为您已经了解 C#。但是，如果您了解 C/C++，请尝试以[wxWidgets](http://www.wxwidgets.org/)为例。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-30T08:01:22.770

为什么要限制自己使用传统的 C#/Java？看看 Adob​​e AIR 和 Microsoft SilverLight

# php - php代码格式化程序/美化器和php美化一般

> ID：149600
> 
> 赞同：36
> 
> 时间：2008-09-29T16:53:53.607
> 
> 标签：php, editor

你知道有什么好的工具可以很好地格式化凌乱的 php 代码吗？最好是 Aptana/Eclipse 的脚本，但也可以使用独立工具。

* * *

## 回答 #1

> 赞同：44
> 
> 时间：2009-01-30T02:28:14.917

那么这是我非常基本和粗略的脚本：

```
#!/usr/bin/php
<?php
class Token {
    public $type;
    public $contents;

    public function __construct($rawToken) {
        if (is_array($rawToken)) {
            $this->type = $rawToken[0];
            $this->contents = $rawToken[1];
        } else {
            $this->type = -1;
            $this->contents = $rawToken;
        }
    }
}

$file = $argv[1];
$code = file_get_contents($file);

$rawTokens = token_get_all($code);
$tokens = array();
foreach ($rawTokens as $rawToken) {
    $tokens[] = new Token($rawToken);
}

function skipWhitespace(&$tokens, &$i) {
    global $lineNo;
    $i++;
    $token = $tokens[$i];
    while ($token->type == T_WHITESPACE) {
        $lineNo += substr($token->contents, "\n");
        $i++;
        $token = $tokens[$i];
    }
}

function nextToken(&$j) {
    global $tokens, $i;
    $j = $i;
    do {
        $j++;
        $token = $tokens[$j];
    } while ($token->type == T_WHITESPACE);
    return $token;
}

$OPERATORS = array('=', '.', '+', '-', '*', '/', '%', '||', '&&', '+=', '-=', '*=', '/=', '.=', '%=', '==', '!=', '<=', '>=', '<', '>', '===', '!==');

$IMPORT_STATEMENTS = array(T_REQUIRE, T_REQUIRE_ONCE, T_INCLUDE, T_INCLUDE_ONCE);

$CONTROL_STRUCTURES = array(T_IF, T_ELSEIF, T_FOREACH, T_FOR, T_WHILE, T_SWITCH, T_ELSE);
$WHITESPACE_BEFORE = array('?', '{', '=>');
$WHITESPACE_AFTER = array(',', '?', '=>');

foreach ($OPERATORS as $op) {
    $WHITESPACE_BEFORE[] = $op;
    $WHITESPACE_AFTER[] = $op;
}

$matchingTernary = false;

// First pass - filter out unwanted tokens
$filteredTokens = array();
for ($i = 0, $n = count($tokens); $i < $n; $i++) {
    $token = $tokens[$i];
    if ($token->contents == '?') {
        $matchingTernary = true;
    }
    if (in_array($token->type, $IMPORT_STATEMENTS) && nextToken($j)->contents == '(') {
        $filteredTokens[] = $token;
        if ($tokens[$i + 1]->type != T_WHITESPACE) {
            $filteredTokens[] = new Token(array(T_WHITESPACE, ' '));
        }
        $i = $j;
        do {
            $i++;
            $token = $tokens[$i];
            if ($token->contents != ')') {
                $filteredTokens[] = $token;
            }
        } while ($token->contents != ')');
    } elseif ($token->type == T_ELSE && nextToken($j)->type == T_IF) {
        $i = $j;
        $filteredTokens[] = new Token(array(T_ELSEIF, 'elseif'));
    } elseif ($token->contents == ':') {
        if ($matchingTernary) {
            $matchingTernary = false;
        } elseif ($tokens[$i - 1]->type == T_WHITESPACE) {
            array_pop($filteredTokens); // Remove whitespace before
        }
        $filteredTokens[] = $token;
    } else {
        $filteredTokens[] = $token;
    }
}
$tokens = $filteredTokens;

function isAssocArrayVariable($offset = 0) {
    global $tokens, $i;
    $j = $i + $offset;
    return $tokens[$j]->type == T_VARIABLE &&
        $tokens[$j + 1]->contents == '[' &&
        $tokens[$j + 2]->type == T_STRING &&
        preg_match('/[a-z_]+/', $tokens[$j + 2]->contents) &&
        $tokens[$j + 3]->contents == ']';
}

// Second pass - add whitespace
$matchingTernary = false;
$doubleQuote = false;
for ($i = 0, $n = count($tokens); $i < $n; $i++) {
    $token = $tokens[$i];
    if ($token->contents == '?') {
        $matchingTernary = true;
    }
    if ($token->contents == '"' && isAssocArrayVariable(1) && $tokens[$i + 5]->contents == '"') {
        /*
         * Handle case where the only thing quoted is the assoc array variable.
         * Eg. "$value[key]"
         */
        $quote = $tokens[$i++]->contents;
        $var = $tokens[$i++]->contents;
        $openSquareBracket = $tokens[$i++]->contents;
        $str = $tokens[$i++]->contents;
        $closeSquareBracket = $tokens[$i++]->contents;
        $quote = $tokens[$i]->contents;        
        echo $var . "['" . $str . "']";
        $doubleQuote = false;
        continue;
    }
    if ($token->contents == '"') {
        $doubleQuote = !$doubleQuote;
    }
    if ($doubleQuote && $token->contents == '"' && isAssocArrayVariable(1)) {
        // don't echo "
    } elseif ($doubleQuote && isAssocArrayVariable()) {
        if ($tokens[$i - 1]->contents != '"') {
            echo '" . ';
        }
        $var = $token->contents;
        $openSquareBracket = $tokens[++$i]->contents;
        $str = $tokens[++$i]->contents;
        $closeSquareBracket = $tokens[++$i]->contents;
        echo $var . "['" . $str . "']";
        if ($tokens[$i + 1]->contents != '"') {
            echo ' . "';
        } else {
            $i++; // process "
            $doubleQuote = false;
        }
    } elseif ($token->type == T_STRING && $tokens[$i - 1]->contents == '[' && $tokens[$i + 1]->contents == ']') {
        if (preg_match('/[a-z_]+/', $token->contents)) {
            echo "'" . $token->contents . "'";
        } else {
            echo $token->contents;
        }
    } elseif ($token->type == T_ENCAPSED_AND_WHITESPACE || $token->type == T_STRING) {
        echo $token->contents;
    } elseif ($token->contents == '-' && in_array($tokens[$i + 1]->type, array(T_LNUMBER, T_DNUMBER))) {
        echo '-';
    } elseif (in_array($token->type, $CONTROL_STRUCTURES)) {
        echo $token->contents;
        if ($tokens[$i + 1]->type != T_WHITESPACE) {
            echo ' ';
        }
    } elseif ($token->contents == '}' && in_array($tokens[$i + 1]->type, $CONTROL_STRUCTURES)) {
        echo '} ';
    } elseif ($token->contents == '=' && $tokens[$i + 1]->contents == '&') {
        if ($tokens[$i - 1]->type != T_WHITESPACE) {
            echo ' ';
        }
        $i++; // match &
        echo '=&';
        if ($tokens[$i + 1]->type != T_WHITESPACE) {
            echo ' ';          
        }
    } elseif ($token->contents == ':' && $matchingTernary) {
        $matchingTernary = false;
        if ($tokens[$i - 1]->type != T_WHITESPACE) {
            echo ' ';
        }
        echo ':';
        if ($tokens[$i + 1]->type != T_WHITESPACE) {
            echo ' ';
        }
    } elseif (in_array($token->contents, $WHITESPACE_BEFORE) && $tokens[$i - 1]->type != T_WHITESPACE &&
        in_array($token->contents, $WHITESPACE_AFTER) && $tokens[$i + 1]->type != T_WHITESPACE) {
        echo ' ' . $token->contents . ' ';
    } elseif (in_array($token->contents, $WHITESPACE_BEFORE) && $tokens[$i - 1]->type != T_WHITESPACE) {
        echo ' ' . $token->contents;
    } elseif (in_array($token->contents, $WHITESPACE_AFTER) && $tokens[$i + 1]->type != T_WHITESPACE) {
        echo $token->contents . ' ';
    } else {
        echo $token->contents;
    }
} 
```

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2010-08-19T00:14:00.937

[http://en.sourceforge.jp/projects/pdt-tools/](http://en.sourceforge.jp/projects/pdt-tools/)

^^^ 将为您提供一个正确的 CTRL+SHIFT+F Eclipse/Aptana PHP 格式化程序，如 Java。

请参阅[此处](http://www.free-source.net/blog/Aptana%20and%20Eclispe%20-%20Code%20Formatter%20for%20PHP%20Development%20Tools%20for%20Eclipse)获取安装帮助。

![eclipse php代码格式化程序](https://i.stack.imgur.com/xDegS.png)

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2008-09-29T18:36:01.800

[PHP Code Beautifier](http://www.waterproof.fr/products/phpCodeBeautifier/)是一个有用的免费工具，应该可以满足您的需求，尽管他们的[下载页面](http://www.waterproof.fr/products/phpCodeBeautifier/download.php)确实需要创建一个帐户。

> 该工具已被拒绝为 3 个版本：
> 
> *   允许可视化处理文件的 GUI 版本。
> *   允许批处理或与其他工具（CVS、SubVersion、IDE ...）集成的命令行版本。
> *   作为 PHPEdit 的集成工具。

基本上，它会变成：

```
if($code == BAD){$action = REWRITE;}else{$action = KEEP;}
for($i=0; $i<10;$i++){while($j>0){$j++;doCall($i+$j);if($k){$k/=10;}}} 
```

进入

```
if ($code == BAD) {
    $action = REWRITE;
} else {
    $action = KEEP;
}
for($i = 0; $i < 10;$i++) {
    while ($j > 0) {
        $j++;
        doCall($i + $j);
        if ($k) {
            $k /= 10;
        }
    }
} 
```

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2010-08-06T21:10:03.420

有一个 pear 模块可以格式化您的代码。[PHP 美化器](http://pear.php.net/package/PHP_Beautifier)

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-09-29T16:55:52.057

如果您使用 Zend 开发环境，您可以使用缩进代码功能 (Ctrl+Shift+F)。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2013-04-11T16:53:41.363

使用 NetBeans PHP 并按 alt+shift+F。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-09-29T17:52:51.950

这是一个 php 代码美化器（当然是 PHP）类： http:
[//www.codeassembly.com/A-php-code-beautifier-that-works/](http://www.codeassembly.com/A-php-code-beautifier-that-works/)

和

在线演示：

[http://www.codeassembly.com/examples/beautifier.php](http://www.codeassembly.com/examples/beautifier.php)

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-09-29T17:01:12.637

Zend 开发环境现在是一个 Eclipse 插件，您可以将它与 Aptana 一起运行并使用它的缩进代码功能。

[禅德工作室](http://www.zend.com/en/products/studio/downloads)

我自己还没有升级到 Eclipse 插件，我非常喜欢以前的 ZDE。虽然现在我已经开始实际将 Eclipse 用于其他语言，但我几乎已经准备好迈出这一步了。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-04-30T04:29:08.133

这个如何：

[http://universalindent.sourceforge.net/](http://universalindent.sourceforge.net/)

它结合了一堆格式化程序，并将生成您需要的脚本，以便您可以将它们传递出去并让您的团队成员在下次提交之前使用它们......虽然......格式化程序可能会弄乱您的代码并呈现它无法使用...

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2012-04-17T20:36:19.557

最简单的解决方案是仅使用内置此功能的 IDE。如果您打算定期用 PHP 编写代码，只需花 60 美元购买 PHPStorm。你不会后悔的。

[http://www.jetbrains.com/phpstorm/](http://www.jetbrains.com/phpstorm/)

它允许您在文件或目录级别使用简单的键盘快捷键来格式化您的代码，并具有无数其他出色的功能。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2010-05-18T04:41:08.120

我们的[PHP 格式化](http://www.semanticdesigns.com/Products/Formatters/PHPFormatter.html)程序将可靠地格式化您的代码。它使用基于编译器的前端来解析代码，因此它不会误解代码并损坏它。因此，其格式化输出*始终*有效。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2012-05-12T02:19:40.290

[phpformatter.com](http://phpformatter.com/)效果最好

“这个免费的在线 PHP 格式化程序旨在让您可以使用您喜欢的样式美化您的所有 PHP 脚本”

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2012-07-22T05:26:42.300

这是一个很好的问题。我有一个读取 json 并输出 php、html 和 css 的应用程序。我运行一个程序并生成数十个（数百个？）文件。我希望这里的答案是有用的。

我使用 heredocs、特殊的包含文件、元字符等开始了我的项目，但很快就变得一团糟。我想要一个不需要框架或 ide 的独立解决方案。所以我删除了所有的 heredoc 和其他垃圾，并创建了一个通用的文本缓冲类，而不关心格式。对于我所关心的一切，它都可以是一条线。对于 html，我内置了 tidy() 。对于 php，我使用[phpstylist](http://sourceforge.net/projects/phpstylist/)。phpstylist 较旧，但仍然适用于 php 格式。

为了设置 phpstylist 选项，我在 windows gui 中使用了[UniversalIndent](http://universalindent.sourceforge.net/)（2012 年 1 月更新）。

UniversalStylist 列出了 24 个（！）格式化程序（c、php、ruby、html、...）。它特别了解 phpstylist 的选项，并在您打开和关闭选项时为您提供文件的实时刷新。很好。然后，当您拥有自己的风格时，它可以选择保存命令行选项并生成脚本。对于某些格式化选项，您必须添加 perl、python 等的路径。

如果您使用的是 windows 并想尝试使用 UniversalIndent 的 phpstylist，只需将 php.exe 的目录添加到您的 env 路径。我使用[ampps](http://www.ampps.com/)，所以我的设置为 c:\ampps\php。

找到一个好的固溶体并不容易。我也有兴趣听到其他人为代码审查和归档目的对自动生成的 php/html 文件进行尽可能简单的批处理格式化所做的事情。

* * *

## 回答 #14

> 赞同：-1
> 
> 时间：2015-05-21T19:58:51.863

我在为 PHP 找到一个像样的免费格式化程序时也遇到了很多麻烦，有很多在线和命令行工具，但由于某种原因它们似乎不起作用，结果仍然充满了糟糕的缩进使用制表符和空格的组合，它们永远不会按照您想要的方式获得大括号！

我尝试了上面的代码片段，但这对我也不起作用，缩进仍然充满了空格和制表符。

所以我也试着写了一个简单的，这个只是使用了所有的正则表达式，没有花哨的编译器魔法，所以它可能会破坏一些东西，并且仍然是非常 beta 并且正在对各种混乱的代码进行测试。该界面目前也非常基本，但应该会在接下来的几天内改进。

对于 MediaWiki 的约定，它是硬连线的，但您可以很容易地对其进行修改（我稍后可能会添加选项）。

[https://www.organicdesign.co.nz/Special:CodeTidy](https://www.organicdesign.co.nz/Special:CodeTidy)

# c# - C#“使用”语法

> ID：149609
> 
> 赞同：48
> 
> 时间：2008-09-29T16:55:23.743
> 
> 标签：c#, exception, using, using-statement

using 是捕获异常还是抛出异常？IE

```
using (StreamReader rdr = File.OpenText("file.txt"))
{
 //do stuff
} 
```

如果流读取器抛出异常，它是通过使用捕获还是抛出以便调用函数可以处理它？

* * *

## 回答 #1

> 赞同：64
> 
> 时间：2008-09-29T17:00:17.617

当您看到 using 语句时，请考虑以下代码：

```
StreadReader rdr = null;
try
{
    rdr = File.OpenText("file.txt");
    //do stuff
}
finally
{
    if (rdr != null)
        rdr.Dispose();
} 
```

所以真正的答案是它不会对 using 块的主体中​​抛出的异常做任何事情。它不处理它或重新抛出它。

* * *

## 回答 #2

> 赞同：35
> 
> 时间：2008-09-29T16:58:43.423

using 语句不吃异常。

所有“使用”所做的只是将您的对象限定为 using 块，并在对象离开块时自动调用对象的 Dispose()。

但是有一个问题，如果线程被外部源强行中止，则可能永远不会调用 Dispose。

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2008-09-29T16:57:44.860

[`using`](http://msdn.microsoft.com/en-us/library/yh598w02(VS.80).aspx)允许异常沸腾。它的作用类似于 try/finally，finally 处理使用的对象。因此，它仅适用于实现`IDisposable`.

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-09-29T17:01:17.677

它抛出异常，因此您的包含方法需要处理它，或者将其传递到堆栈中。

```
try
{
    using (
        StreamReader rdr = File.OpenText("file.txt"))
    { //do stuff 
    }
}
catch (FileNotFoundException Ex)
{
    // The file didn't exist
}
catch (AccessViolationException Ex)
{
    // You don't have the permission to open this
}
catch (Exception Ex)
{
    // Something happened! 
} 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-09-29T17:05:25.187

在 using 语句的初始化表达式中引发的任何异常都将按预期向上传播方法范围和调用堆栈。

不过要注意的一件事是，如果初始化表达式中发生异常，则不会在表达式变量上调用 Dispose() 方法。这几乎总是您想要的行为，因为您不想费心处理实际上未创建的对象。但是，在复杂的情况下可能会出现问题。也就是说，如果在构造函数中隐藏了多个初始化，并且一些初始化在抛出异常之前成功，那么此时可能不会发生 Dispose 调用。不过，这通常不是问题，因为构造函数通常保持简单。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2011-05-04T03:58:51.783

在您的示例中，如果`File.OpenText`抛出，`Dispose`则**不会**调用。

如果异常发生在`//do stuff`，`Dispose` **将**被调用。

在这两种情况下，异常通常会传播到范围之外，就像没有*using*语句一样。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-09-29T16:57:19.230

如果您没有专门捕获异常，它将被抛出堆栈，直到发生某些事情

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-09-29T16:58:49.960

除了清理其范围内的内容外， using 不会干扰异常处理。

它不处理异常，但允许异常通过。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-09-29T17:02:07.313

`using`保证*创建的对象将在块的末尾被释放，即使抛出异常也是如此。*未*捕获异常。但是，如果你试图自己抓住它，你需要小心你所做的事情。由于任何捕获异常的代码都在`using`语句定义的范围块之外，因此您的对象将不可用于该代码。

*除了停电，核浩劫等常见的嫌疑人

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-09-29T17:03:49.120

你可以想象在没有 catch 块的情况下**使用****try...finally**块。在 finally 块中，IDisposable.Dispose 被调用，并且由于没有 catch 块，任何异常都会被抛出堆栈。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-29T16:59:40.597

“使用”不会捕获异常，它只是在发生未处理的异常时处理资源。

也许问题是，如果声明中也出现错误，它会处理括号中分配的资源吗？不过，很难想象两者都会发生。

# checksum - 我怎么能猜到校验和算法？

> ID：149617
> 
> 赞同：17
> 
> 时间：2008-09-29T16:56:37.127
> 
> 标签：checksum, crc

假设我最后有一些带有 16 位校验和的数据包。我想猜测使用了哪种校验和算法。

首先，从转储数据中我可以看到数据包有效负载中的一个字节变化完全改变了校验和，所以我可以假设它不是某种简单的异或或求和。

然后我尝试[了 CRC16 的几种变体](http://svn.rot13.org/index.cgi/RFID/view/guess-crc.pl)，但运气不佳。

这个问题可能更偏向于密码学，但我真的对任何易于理解的统计工具感兴趣，以找出这可能是哪个 CRC。如果其他一切都失败了，我什至可能会转向[绘制不同的 CRC 算法。](http://lcamtuf.coredump.cx/newtcp/)

背景故事：我有带有某种校验和的串行 RFID 协议。我可以毫无问题地重播消息并解释结果（没有校验和检查），但我无法发送修改过的数据包，因为设备将它们丢弃在地板上。

使用现有软件，我可以更改 RFID 芯片的有效载荷。但是，唯一的序列号是不可变的，所以我没有能力检查每个可能的组合。尽管我可以生成递增一的值转储，但不足以使详尽的搜索适用于这个问题。

如果问题本身还不够，则可以使用[带有数据的转储文件:-)](http://www.bljak.org/~dpavlin/rfid-serial-dump.tar.gz)

**需要参考文件吗？** [CRC 错误检测算法的无痛指南](http://www.geocities.com/SiliconValley/Pines/8659/crc.htm)是很好的参考，我在这里提出问题后发现。

最后，在接受的答案比它的 CCITT 非常有用的提示之后，我 [使用了这个 CRC 计算器](http://www.zorc.breitbandkatze.de/crc.html)，并将生成的校验和与已知的校验和异或得到 0xffff，这使我得出结论，最终的异或是 CCITT 的 0x0000 的 0xffff 插入。

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-10-01T17:14:13.697

对于 CRC，需要考虑许多变量：

```
Polynomial
No of bits (16 or 32)
Normal (LSB first) or Reverse (MSB first)
Initial value
How the final value is manipulated (e.g. subtracted from 0xffff), or is a constant value 
```

典型的 CRC：

```
LRC:    Polynomial=0x81; 8 bits; Normal; Initial=0; Final=as calculated
CRC16:  Polynomial=0xa001; 16 bits; Normal; Initial=0; Final=as calculated
CCITT:  Polynomial=0x1021; 16 bits; reverse; Initial=0xffff; Final=0x1d0f
Xmodem: Polynomial=0x1021; 16 bits; reverse; Initial=0; Final=0x1d0f
CRC32:  Polynomial=0xebd88320; 32 bits; Normal; Initial=0xffffffff; Final=inverted value
ZIP32:  Polynomial=0x04c11db7; 32 bits; Normal; Initial=0xffffffff; Final=as calculated 
```

首先要做的是通过更改最后一个字节来获取一些样本。这将帮助您计算出 CRC 中的字节数。

这是一个“自制”算法。在这种情况下，可能需要一些时间。否则尝试标准算法。

尝试更改最后一个字节的 msb 或 lsb，看看这会如何更改 CRC。这将指示方向。

更难的是，有一些实现会操纵 CRC，这样它就不会影响通信介质（协议）。

根据您对 RFID 的评论，这意味着 CRC 与通信相关。通常 CRC16 用于通信，但 CCITT 也用于某些系统。

另一方面，如果这是 UHF RFID 标签，则有一些 CRC 方案 - 一个 5 位和一些 16 位。这些都记录在 ISO 标准和 IPX 数据表中。

```
IPX:  Polynomial=0x8005; 16 bits; Reverse; Initial=0xffff; Final=as calculated
ISO 18000-6B: Polynomial=0x1021; 16 bits; Reverse; Initial=0xffff; Final=as calculated
ISO 18000-6C: Polynomial=0x1021; 16 bits; Reverse; Initial=0xffff; Final=as calculated
    Data must be padded with zeroes to make a multiple of 8 bits
ISO CRC5: Polynomial=custom; 5 bits; Reverse; Initial=0x9; Final=shifted left by 3 bits
    Data must be padded with zeroes to make a multiple of 8 bits
EPC class 1: Polynomial=custom 0x1021; 16 bits; Reverse; Initial=0xffff; Final=post processing of 16 zero bits 
```

**这是你的答案！！！！**

**通过您的日志，CRC 是 CCITT 之一。第一个字节 0xd6 从 CRC 中排除。**

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-29T17:15:42.913

它可能不是 CRC，它可能是像 Reed-Solomon 这样的纠错码。

ECC 代码通常是它们保护的原始数据大小的很大一部分，具体取决于它们要处理的错误率。如果消息的大小超过 16 个字节，2 个字节的 ECC 就不够用了。因此，如果消息很大，您很可能是正确的，它是某种 CRC。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2015-06-09T14:11:16.723

我试图在这里解决一个类似的问题，我发现了一个非常简洁的网站，它将获取您的文件并使用 47 种不同的算法对其运行校验和并显示结果。如果用于计算校验和的算法是这些算法中的任何一种，您只需在通过简单文本搜索生成的校验和列表中找到它。

该网站是[https://defuse.ca/checksums.htm](https://defuse.ca/checksums.htm)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-29T17:03:06.203

您将不得不尝试所有可能的校验和算法，并查看哪个生成相同的结果。但是，无法保证校验和中包含哪些内容。例如，一些算法会跳过空格，这会导致不同的结果。

我真的不明白为什么有人想知道这一点。

# sql - 具有唯一索引的 SQL 克隆记录

> ID：149627
> 
> 赞同：2
> 
> 时间：2008-09-29T16:58:21.020
> 
> 标签：sql, mysql, database

是否有一种干净的方法可以克隆具有索引（自动增量）的 SQL 中的记录。我想克隆除索引之外的所有字段。我目前必须枚举每个字段，并在插入选择中使用它，我宁愿不明确列出所有字段，因为它们可能会随着时间而改变。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-29T17:01:19.470

除非你想进入动态 SQL。既然你写了“干净”，我假设不是。

**编辑：**由于他要求提供动态 SQL 示例，因此我将尝试一下。目前我没有连接到任何数据库，所以这不是我的想法，几乎肯定需要修改。但希望它能抓住事物的精神：

```
-- Get list of columns in table
SELECT INTO #t
EXEC sp_columns @table_name = N'TargetTable'

-- Create a comma-delimited string excluding the identity column
DECLARE @cols varchar(MAX)
SELECT @cols = COALESCE(@cols+',' ,'') + COLUMN_NAME FROM #t WHERE COLUMN_NAME <> 'id'

-- Construct dynamic SQL statement
DECLARE @sql varchar(MAX)
SET @sql = 'INSERT INTO TargetTable (' + @cols + ') ' +
    'SELECT ' + @cols + ' FROM TargetTable WHERE SomeCondition'

PRINT @sql -- for debugging
EXEC(@sql) 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-29T17:11:52.923

我无法想到任何简单而干净的方法，但是从您问题中的一些项目来看，我会担心您的底层架构。也许你有一个绝对正当的理由想要这样做，但通常你想尽量避免数据库中的重复，而不是让它们更容易导致。此外，明确命名列通常是一个好主意。如果您要链接到外部代码，它可以确保您在添加新列时不会破坏该链接。如果您不是（听起来您可能不在这种情况下），我仍然更喜欢列出列，因为它迫使我查看更改/新列的效果 - 即使只是为了查看代码并决定添加新列不是问题。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-03-13T03:58:25.447

```
DROP TABLE #tmp_MyTable

SELECT * INTO #tmp_MyTable
FROM MyTable
WHERE MyIndentID = 165

ALTER TABLE #tmp_MyTable
DROP Column MyIndentID

INSERT INTO MyTable
SELECT * 
FROM #tmp_MyTable 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-03-22T20:37:49.570

这也处理唯一键 projectnum 以及主键。

```
CREATE TEMPORARY TABLE projecttemp SELECT * FROM project WHERE projectid='6';
ALTER TABLE projecttemp DROP COLUMN projectid;
UPDATE projecttemp SET projectnum = CONCAT(projectnum, ' CLONED');
INSERT INTO project SELECT NULL,projecttemp.* FROM projecttemp; 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-29T17:05:07.650

您可以创建一个插入触发器来执行此操作，但是，您将失去使用显式 ID 进行插入的能力。相反，它将始终使用序列中的值。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-29T17:35:10.637

您可以创建一个触发器来为您执行此操作。为确保触发器仅适用于克隆，您可以创建一个单独的用户名 CLONE 并使用它登录。或者，更好的是，如果您的 DBMS 支持它，创建一个名为 CLONE 的角色，任何用户都可以使用该角色登录并进行克隆。触发代码将类似于：

```
if (CURRENT_ROLE = 'CLONE') then
   new.ID = assign new id from generator/sequence 
```

当然，您只会将该角色授予允许克隆记录的用户。

# c# - CanStop 设置为 False 时停止 Windows 服务的方法 (C#)

> ID：149632
> 
> 赞同：2
> 
> 时间：2008-09-29T16:59:04.467
> 
> 标签：c#, windows, service

好的，所以[我没有意志力实验](https://stackoverflow.com/questions/146439/way-to-stop-a-program-from-starting-up-using-c)的第二部分是：

摘要问题 - **有没有办法在 Windows 服务上动态设置 CanStop 属性？**

Whole Spiel - 我有一项服务，目前正在检查和终止进程（IE 游戏），我已经告诉它，如果那天我不允许。伟大的。我将 CanStop 设置为 false，这样如果我沉迷其中，就不能直接终止服务。我有一个程序将进行密码检查（其他人输入密码），如果密码正确，它将停止服务。（如果我有严重的提款）问题是使用 ServiceController 类。

据我所知，ServiceController 只是一个装饰器（是的设计模式猜测），所以我无法获得它所代表的实际服务。第一次尝试是属性信息，但我太笨了，没有意识到那是没有意义的。其次是字段信息，因为我认为可能有一个“代表”服务的私有字段。正如您可能猜到的那样，两者都失败了。

有任何想法吗？

**编辑 1** 我想避免将 CanStop 值放在我可以像配置文件或注册表一样轻松获取的地方。所以我正在尝试，虽然没有成功，但在程序中完全处理这个问题。

**新的（失败的）尝试：**

> 管理对象服务；ManagementBaseObject 停止服务；
> 
> service = new ManagementObject("Win32_Service.Name='StopProgram'");
> 
> stopService = service .InvokeMethod("StopService", null, null);

不确定这有什么作用。我认为由于 CanStop 情况它无法停止。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-29T18:00:58.297

“CanStop”是windows服务控制管理器中服务注册的一个属性。你不能在中途改变它。

而且，当然，如果你足够聪明，可以编写自己的服务，那么你就足够聪明，可以调出 task-man 并简单地终止服务进程。CanStop 不会阻止您从服务下方拉出地毯。CanStop 只告诉服务控制管理器不要向服务发送“停止”命令。

如果您想允许某些事情通过，请使用全局事件来启用/禁用服务检查 - 或者只是从 PC 中删除游戏！:-)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-29T17:32:31.923

与其尝试直接访问和控制服务，不如在某处设置一个标志（如注册表或文件），然后由您的服务在执行您尝试控制的事件之前对其进行检查。

# json - JSON 编辑器/格式化程序？

> ID：149635
> 
> 赞同：11
> 
> 时间：2008-09-29T16:59:25.167
> 
> 标签：json, serialization

我有一些 JSON 数据，但都在一条线上。有谁知道可以为我格式化（例如缩进和插入新行）这些数据的网络或 Windows 编辑器，以便我可以更好地阅读它？最好是使用 GUI 来显示 JSON，而不是使用命令行工具来输出重新格式化的文档，例如。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2012-04-24T18:15:17.117

我最近创建了 JSON Editor Online，这是一个可以轻松在线编辑和格式化 JSON 的工具。JSON 以清晰、可编辑的树状视图和格式化的纯文本形式显示。

[http://jsoneditoronline.org/](http://jsoneditoronline.org/)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-29T17:01:30.873

你试过这个吗？

[http://jsonformat.com/](http://jsonformat.com/)

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-09-30T07:19:54.350

您可以下载[http://www.thomasfrank.se/json_editor.html](http://www.thomasfrank.se/json_editor.html)并在您自己的数据上本地运行它，尽管它是一个编辑器而不是格式化程序。

[http://www.jsonlint.com/](http://www.jsonlint.com/)也是一个有用的验证和重新格式化工具。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2010-04-19T21:12:07.037

在 Windows 我去：http: [//jsonviewer.codeplex.com/](http://jsonviewer.codeplex.com/)

方便从 Firebug 中提取原始 JSON 响应并为我解析它。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-29T17:01:44.943

我使用[http://curiousconcept.com/jsonformatter](http://curiousconcept.com/jsonformatter)来格式化计算机生成的 json。它使它更具可读性。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-29T17:05:48.710

请记住，JSON 只是一个带有花哨衣服的 Javascript 对象文字。您应该能够使用任何[Javascript Beautifier](http://elfz.laacz.lv/beautify/)来清理它。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2011-06-20T20:24:27.617

我喜欢这个：http: [//freeformatter.com/json-formatter.html](http://freeformatter.com/json-formatter.html)

如果您的文档不符合 RFC 标准，则验证过程很灵活。它还创建了一个带有可折叠节点的树，当您想在 json 树的一小块区域中工作时，这很酷

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2011-08-14T21:11:28.687

这就是我所做的：使用 Aptana Eclipse Javascript 编辑器，它将在您键入时检查您的语法。只有一个技巧：您必须将您的 json 包装在一点点 javascript 中，以使整个内容成为有效的 javascript 文件，并消除那些红色和黄色的语法错误。

所以，最外面的`{}` 变成：（ `x={};`所有的 json 文件都在中间）。

现在你只需要在解析为 JSON 之前去掉和`x=`。`;`我在一个包装 jQuery ajax 函数的函数中执行此操作：

```
function get_json_file(url,options,callback){
    var opts = {dataType:"text"};
    opts.url = url;
    $.extend(opts,options);
    opts.success=function(data){
        var json = data.substring(data.indexOf('{'),data.lastIndexOf('}')+1);
        var obj = JSON.parse(json);
        callback(obj);
    };
    $.ajax(opts);
} 
```

这有点疯狂，但在 eclipse 中有效地拥有一个非常好的语法检查 JSON 编辑器是值得的。

# sql - SQL 对层次结构中的节点进行重新排序

> ID：149639
> 
> 赞同：3
> 
> 时间：2008-09-29T16:59:47.820
> 
> 标签：sql, sql-server, hierarchy, adjacency-list-model

我有一个使用邻接列表模型（见下文）的“任务列表”数据库，因此每个“任务”可以有无限的子任务。该表有一个“TaskOrder”列，因此所有内容都以正确的顺序呈现在树视图上。

是否有一条 SQL 语句 (MS-SQL 2005) 将选择指定父节点的所有子节点并在删除同级时更新 TaskOder 列？

```
任务表
----------
任务 ID
父任务 ID
任务顺序
任务名称
- ETC - 

```

有任何想法吗？谢谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-29T17:10:24.317

如果您只使用TaskOrder 进行排序，那么简单地在TaskOrder 中留下漏洞肯定会更简单，因为简单地删除项目不会使排序不正确。但是我不确定您的应用程序的需求。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-29T22:04:20.287

几种不同的方式...由于 TaskOrder 是由父 ID 限定的，因此收集它并不难。在 SQL Server 中，我会在 delete 上设置一个触发器，该触发器会减少所有比您删除的“更高”的触发器，从而缩小差距（伪代码如下）：

```
CREATE TRIGGER ON yourtable FOR DELETE
AS
  UPDATE Task
     SET TaskOrder    = TaskOrder - 1
   WHERE ParentTaskId = deleted.ParentTaskId
     AND TaskOrder    > deleted.TaskOrder 
```

如果您不想要触发器，您可以先在查询中捕获 parentID 和 TaskOrder，删除行，然后执行相同的更新语句，但使用文字而不是触发器。

或者如果你想最小化服务器往返，你可以将要删除的任务一直移动到底部，然后将其他任务向上移动，然后进行删除，但这似乎过于复杂。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-29T17:14:07.490

不是直接的。这是一种[拓扑排序](http://en.wikipedia.org/wiki/Topological_sorting)，您将子节点“悬挂”在父节点上。如果子级中没有依赖关系，则执行它们的顺序无关紧要。如果子项必须按特定顺序执行，那么您没有足够的信息来推断这一点 - 它们必须具有额外的层次结构。

假设父母中孩子的顺序无关紧要，那么拓扑排序将为您提供所需的东西。在大多数 SQL 方言中，您不会将其放入单个查询中 - 您必须编写一个 sproc 来执行此操作。

如果节点中子节点的顺序相关，那么您需要维护父节点中的任务顺序。使用 ParentNodeID、TaskOrder 和 count (*) 的查询将挑选出重复项，但除非系统有额外的信息来对任务进行排序，否则您仍然需要手动干预来选择正确的顺序。

如果你想让我澄清一些事情，请添加评论。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-29T17:14:34.197

这看起来像是 ROW_Number 的工作。

```
DECLARE @Tasks TABLE
(
  TaskId int PRIMARY KEY,
  ParentTaskId int,
  TaskOrder int,
  TaskName varchar(30)
)

INSERT INTO @Tasks(TaskId, ParentTaskId, TaskOrder, TaskName)
SELECT 1, null, 1, 'ParentTask'

INSERT INTO @Tasks(TaskId, ParentTaskId, TaskOrder, TaskName)
SELECT 2, 1, 2, 'B'

INSERT INTO @Tasks(TaskId, ParentTaskId, TaskOrder, TaskName)
SELECT 3, 1, 1, 'A'

INSERT INTO @Tasks(TaskId, ParentTaskId, TaskOrder, TaskName)
SELECT 4, 1, 3, 'C'
--Initial
SELECT * FROM @Tasks WHERE ParentTaskId = 1 ORDER BY TaskOrder

DELETE FROM @Tasks WHERE TaskId = 2
--After Delete
SELECT * FROM @Tasks WHERE ParentTaskId = 1 ORDER BY TaskOrder

UPDATE t
SET TaskOrder = NewTaskOrder
FROM @Tasks t
  JOIN
(
SELECT TaskId, ROW_Number() OVER(ORDER BY TaskOrder) as NewTaskOrder
FROM @Tasks
WHERE ParentTaskId = 1
) sub ON t.TaskId = sub.TaskId

--After Update
SELECT * FROM @Tasks WHERE ParentTaskId = 1 ORDER BY TaskOrder 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-29T17:15:12.917

删除任务 88：

```
UPDATE TaskTable
SET ParentTaskID = (SELECT ParentTaskID AS temp FROM Task_Table t1 WHERE TaskID = 88)
WHERE
TaskID IN (SELECT TaskID task2 FROM TaskTable t2 WHERE ParentTaskID = 88);
Delete FROM TaskTable WHERE TaskID = 88; 
```

当然，您可以取消删除，只留下记录以供将来报告之用。

警告：未经测试！！！

# objective-c - 让 NSRunLoop 等待设置标志的最佳方法？

> ID：149646
> 
> 赞同：40
> 
> 时间：2008-09-29T17:00:58.160
> 
> 标签：objective-c, cocoa, macos

在[NSRunLoop](http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSRunLoop_Class/Reference/Reference.html#//apple_ref/occ/instm/NSRunLoop/run)的 Apple 文档中，有示例代码演示了在等待其他东西设置标志时暂停执行。

```
BOOL shouldKeepRunning = YES;        // global
NSRunLoop *theRL = [NSRunLoop currentRunLoop];
while (shouldKeepRunning && [theRL runMode:NSDefaultRunLoopMode beforeDate:[NSDate distantFuture]]); 
```

我一直在使用它并且它可以工作，但是在调查性能问题时，我将其追踪到了这段代码。我使用几乎完全相同的一段代码（只是标志的名称不同:)，如果我`NSLog`在设置标志后（以另一种方法）放在一行上，然后在后面的一行`while()`有一个看似随机的在两个日志语句之间等待几秒钟。

在速度较慢或速度较快的机器上，延迟似乎没有什么不同，但每次运行之间的延迟确实有所不同，至少为几秒，最多为 10 秒。

我已经使用以下代码解决了这个问题，但原始代码不起作用似乎并不正确。

```
NSDate *loopUntil = [NSDate dateWithTimeIntervalSinceNow:0.1];
while (webViewIsLoading && [[NSRunLoop currentRunLoop] runMode: NSDefaultRunLoopMode beforeDate:loopUntil])
  loopUntil = [NSDate dateWithTimeIntervalSinceNow:0.1]; 
```

使用此代码，设置标志时和 while 循环之后的日志语句现在始终相隔不到 0.1 秒。

有人知道为什么原始代码会表现出这种行为吗？

* * *

## 回答 #1

> 赞同：36
> 
> 时间：2008-09-29T19:40:03.957

Runloops 可能有点像一个神奇的盒子，事情发生了。

基本上你是在告诉 runloop 去处理一些事件然后返回。或者如果在超时之前没有处理任何事件，则返回。

使用 0.1 秒超时，您经常会遇到超时。runloop 触发，不处理任何事件并在 0.1 秒内返回。偶尔它会有机会处理一个事件。

随着您的 distinctFuture 超时，runloop 将永远等待，直到它处理一个事件。因此，当它返回给您时，它刚刚处理了某种事件。

短超时值将比无限超时消耗更多的 CPU，但使用短超时有充分的理由，例如，如果您想终止 runloop 正在运行的进程/线程。您可能希望 runloop 注意到旗帜已经改变，需要尽快救助。

你可能想玩弄一下 runloop 观察者，这样你就可以准确地看到 runloop 正在做什么。

有关更多信息，请参阅[此 Apple 文档](https://developer.apple.com/library/mac/documentation/Cocoa/Conceptual/Multithreading/RunLoopManagement/RunLoopManagement.html#//apple_ref/doc/uid/10000057i-CH16-SW22)。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2008-10-07T11:44:39.603

好的，我向您解释了问题，这是一个可能的解决方案：

```
@implementation MyWindowController

volatile BOOL pageStillLoading;

- (void) runInBackground:(id)arg
{
    NSAutoreleasePool * pool = [[NSAutoreleasePool alloc] init];

    // Simmulate web page loading
    sleep(5);

    // This will not wake up the runloop on main thread!
    pageStillLoading = NO;

    // Wake up the main thread from the runloop
    [self performSelectorOnMainThread:@selector(wakeUpMainThreadRunloop:) withObject:nil waitUntilDone:NO];

    [pool release];
}

- (void) wakeUpMainThreadRunloop:(id)arg
{
    // This method is executed on main thread!
    // It doesn't need to do anything actually, just having it run will
    // make sure the main thread stops running the runloop
}

- (IBAction)start:(id)sender
{
    pageStillLoading = YES;
    [NSThread detachNewThreadSelector:@selector(runInBackground:) toTarget:self withObject:nil];
    [progress setHidden:NO];
    while (pageStillLoading) {
        [[NSRunLoop currentRunLoop] runMode:NSDefaultRunLoopMode beforeDate:[NSDate distantFuture]];
    }
    [progress setHidden:YES];
}

@end 
```

*start*显示进度指示器并在内部运行循环中捕获主线程。它会一直呆在那里，直到另一个线程宣布它完成。为了唤醒主线程，它将使它处理一个除了唤醒主线程之外没有其他目的的函数。

这只是您可以做到的一种方式。在主线程上发布和处理通知可能更可取（其他线程也可以注册它），但上面的解决方案是我能想到的最简单的解决方案。顺便说一句，它并不是真正的线程安全。为了真正实现线程安全，对布尔值的每次访问都需要由任一线程的 NSLock 对象锁定（使用这样的锁也会使“易失性”过时，因为受锁保护的变量根据 POSIX 标准是隐式易失性的；然而，C 标准不知道锁，所以这里只有 volatile 可以保证这个代码工作；GCC 不需要为受锁保护的变量设置 volatile）。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2008-10-25T22:52:19.743

一般来说，如果您自己在循环中处理事件，那么您做错了。根据我的经验，它可能会导致大量混乱的问题。

如果您想以模态方式运行——例如，显示进度面板——以模态方式运行！继续使用 NSApplication 方法，以模态方式运行进度表，然后在加载完成后停止模态。请参阅 Apple 文档，例如[http://developer.apple.com/documentation/Cocoa/Conceptual/WinPanel/Concepts/UsingModalWindows.html](http://developer.apple.com/documentation/Cocoa/Conceptual/WinPanel/Concepts/UsingModalWindows.html)。

如果您只希望视图在加载期间保持正常，但您不希望它是模态的（例如，您希望其他视图能够响应事件），那么您应该做一些更简单的事情。例如，您可以这样做：

```
- (IBAction)start:(id)sender
{
    pageStillLoading = YES;
    [NSThread detachNewThreadSelector:@selector(runInBackground:) toTarget:self withObject:nil];
    [progress setHidden:NO];
}

- (void)wakeUpMainThreadRunloop:(id)arg
{
    [progress setHidden:YES];
} 
```

你完成了。无需控制运行循环！

-会

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2008-09-30T02:09:30.230

如果您希望能够设置标志变量并让运行循环立即通知，只需使用[`-[NSRunLoop performSelector:target:argument:order:modes:`](http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSRunLoop_Class/Reference/Reference.html#//apple_ref/doc/uid/20000321-performSelector_target_argument_order_modes_ "-[NSRunLoop performSelector:target:argument:order:modes:]")要求运行循环调用将标志设置为 false 的方法。这将导致您的运行循环立即旋转，调用方法，然后检查标志。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-10-06T11:31:19.927

在您的代码中，当前线程将检查变量是否每 0.1 秒更改一次。在 Apple 代码示例中，更改变量不会产生任何影响。runloop 将一直运行，直到它处理一些事件。如果 webViewIsLoading 的值发生了变化，不会自动产生事件，所以会一直循环，为什么会跳出来呢？它会一直呆在那里，直到它得到一些其他事件来处理，然后它会打破它。这可能会在 1、3、5、10 甚至 20 秒内发生。直到发生这种情况，它才会跳出运行循环，因此它不会注意到这个变量已经改变。IOW 您引用的 Apple 代码是不确定的。

我认为你应该重新考虑这个问题。由于您的变量名为 webViewIsLoading，您是否等待加载网页？你为此使用 Webkit 吗？我怀疑您根本不需要这样的变量，也不需要您发布的任何代码。相反，您应该异步编码您的应用程序。您应该启动“网页加载过程”，然后返回主循环，一旦页面完成加载，您应该异步发布在主线程中处理的通知并运行应该尽快运行的代码加载完成。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-29T20:08:11.470

我在尝试管理时遇到了类似的问题`NSRunLoops`。类参考页面上的讨论[说：](http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSRunLoop_Class/Reference/Reference.html#//apple_ref/doc/uid/20000321-CHDDBFEA)`runMode:beforeDate:`

> 如果没有输入源或计时器附加到运行循环，则此方法立即退出；否则，它在处理第一个输入源或达到 limitDate 后返回。从运行循环中手动删除所有已知的输入源和计时器并不能保证运行循环将退出。Mac OS X 可以根据需要安装和删除额外的输入源，以处理针对接收者线程的请求。因此，这些来源可能会阻止运行循环退出。

我最好的猜测是，输入源`NSRunLoop`可能是由 OS X 本身附加到您的`runMode:beforeDate:`. 在您的情况下，发生这种情况需要“*几秒钟到最多 10 秒钟*”，此时`runMode:beforeDate:`将返回一个布尔值，`while()`将再次运行，它会检测到`shouldKeepRunning`已设置为`NO`，并且循环将终止。

随着您的细化`runMode:beforeDate:`，无论它是否附加了输入源或已处理任何输入，都将在 0.1 秒内返回。这是一个有根据的猜测（我不是运行循环内部的专家），但认为您的改进是处理这种情况的正确方法。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2013-08-14T01:48:16.603

您的第二个示例只是在您轮询以检查时间间隔 0.1 内运行循环的输入时解决。

有时我会为您的第一个示例找到解决方案：

```
BOOL shouldKeepRunning = YES;        // global
NSRunLoop *theRL = [NSRunLoop currentRunLoop];
while (shouldKeepRunning && [theRL runMode:NSRunLoopCommonModes beforeDate:[NSDate distantFuture]]); 
```

# java - Java中AJP协议的实现

> ID：149662
> 
> 赞同：5
> 
> 时间：2008-09-29T17:02:59.217
> 
> 标签：java, client, ajp

在 Apache 中，您可以使用“mod_jk”模块通过“AJP”协议向 Tomcat 发送 HTTP 请求，这比 HTTP 本身的效率要高得多。

我想做同样的事情，但是来自一个 Java 程序。我想使用“AJP”，因为它的性能很好（而且 Tomcat 也不错）。

有人知道“AJP”客户端的 Java 实现吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-30T07:58:03.447

%TOMCAT_HOME%/server/lib 中的 tomcat-ajp.jar 没有 AJP 实现吗？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2017-12-27T10:14:17.843

如果有人需要，可以使用开源 Apache [ajp-client ：](https://github.com/jrialland/ajp-client)

> 这是 ajp13 客户端的 java 实现，允许使用此协议向 servlet 容器发送请求。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-29T19:26:01.010

没有任何真正的想法，但是您是否查看过 Tomcat 的源代码？也许Tomcat不只是实现AJP的接收端。

# mysql - 在 MySQL 中搜索分隔符之间的文本

> ID：149690
> 
> 赞同：12
> 
> 时间：2008-09-29T17:08:28.047
> 
> 标签：mysql

我正在尝试提取分隔符之间的列的某个部分。

例如在下面找到 foo

测试'esf :foo: bar

所以在上面我想返回 foo，但是所有的正则表达式函数只返回 true|false，有没有办法在 MySQL 中做到这一点

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2008-09-29T17:32:05.747

给你，伙计：

```
SELECT 
  SUBSTR(column, 
    LOCATE(':',column)+1, 
      (CHAR_LENGTH(column) - LOCATE(':',REVERSE(column)) - LOCATE(':',column))) 
FROM table 
```

是的，不知道你为什么要这样做，但这会成功。

通过执行 LOCATE，我们可以找到第一个 ':'。要找到最后一个 ':'，没有反向 LOCATE，所以我们必须通过执行 LOCATE(':', REVERSE(column)) 手动完成。

有了第一个 ':' 的索引，从最后一个 ':' 到字符串末尾的字符数，以及 CHAR_LENGTH（*对此不要使用 LENGTH()*），我们可以使用一些数学来发现':' 的两个实例之间的字符串长度。

这样我们就可以执行一个 SUBSTR 并动态地提取两个 ':' 之间的字符。

再一次，这很恶心，但对每个人来说都是他自己的。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2014-11-06T20:53:24.530

如果两个分隔符在您的列中只出现两次，这应该可以工作。我正在做类似的事情......

```
substring_index(substring_index(column,':',-2),':',1) 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-29T17:12:59.317

[LOCATE](http://dev.mysql.com/doc/refman/5.0/en/string-functions.html#function_locate)和[MID](http://dev.mysql.com/doc/refman/5.0/en/string-functions.html#function_mid)的组合可能会成功。

如果值*"test 'esf :foo: bar"*在**fooField**字段中：

```
MID( fooField, LOCATE('foo', fooField), 3); 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-29T17:23:33.987

我不知道你是否有这种权限，但如果你必须做这样的查询，可能是时候重新规范你的表，并将这些值放在查找表中。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-29T17:37:12.427

只有一组分隔符，以下应该可以工作：

```
SUBSTR(
    SUBSTR(fooField,LOCATE(':',fooField)+1),
    1,
    LOCATE(':',SUBSTR(fooField,LOCATE(':',fooField)+1))-1
 ) 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2015-02-25T06:24:02.607

```
mid(col, 
    locate('?m=',col) + char_length('?m='), 
    locate('&o=',col) - locate('?m=',col) - char_length('?m=') 
) 
```

通过用`char_length(.)`数字替换有点紧凑的形式`3`

```
mid(col, locate('?m=',col) + 3, locate('&o=',col) - locate('?m=',col) - 3) 
```

我使用的模式是`'?m='`和`'&o'`。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-29T17:27:18.330

```
select mid(col from locate(':',col) + 1 for 
locate(':',col,locate(':',col)+1)-locate(':',col) - 1 ) 
from table where col rlike ':.*:'; 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-29T17:41:04.647

如果您知道要从中提取的位置而不是数据本身：

```
$colNumber = 2; //2nd position
$sql = "REPLACE(SUBSTRING(SUBSTRING_INDEX(fooField, ':', $colNumber),
                             LENGTH(SUBSTRING_INDEX(fooField, 
                                                    ':', 
                                                    $colNumber - 1)) + 1)"; 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2016-10-05T04:36:07.957

这是我从中提取的内容（主要是冒号“：”作为分隔符，但有一些例外），作为表 loaddata255 中的列 theline255：

```
23856.409:0023:trace:message:SPY_EnterMessage (0x2003a) L"{#32769}"      [0081] WM_NCCREATE sent from self wp=00000000 lp=0023f0b0 
```

这是 MySql 代码（它很快就做了我想要的，而且很简单）：

```
select 
time('2000-01-01 00:00:00' + interval substring_index(theline255, '.', 1) second) as hhmmss
, substring_index(substring_index(theline255, ':', 1), '.', -1) as logMilli
, substring_index(substring_index(theline255, ':', 2), ':', -1) as logTid
, substring_index(substring_index(theline255, ':', 3), ':', -1) as logType
, substring_index(substring_index(theline255, ':', 4), ':', -1) as logArea
, substring_index(substring_index(theline255, ' ', 1), ':', -1) as logFunction
, substring(theline255, length(substring_index(theline255, ' ', 1)) + 2) as logText
from loaddata255 
```

这是结果：

```
# LogTime, LogTimeMilli, LogTid, LogType, LogArea, LogFunction, LogText
'06:37:36', '409', '0023', 'trace', 'message', 'SPY_EnterMessage', '(0x2003a) L\"{#32769}\"      [0081] WM_NCCREATE sent from self wp=00000000 lp=0023f0b0' 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2017-06-29T10:22:31.133

这对我来说看起来很优雅。在第 n 个分隔符之后剥离所有内容，旋转字符串，在 1\. 分隔符之后剥离所有内容，向后旋转。

```
select
  reverse(
    substring_index(
      reverse(substring_index(str,separator,substrindex)),
      separator,
      1)
  ); 
```

例如：

```
select
  reverse(
    substring_index(
      reverse(substring_index('www.mysql.com','.',2)),
      '.',
      1
    )
  ); 
```

* * *

## 回答 #11

> 赞同：-2
> 
> 时间：2014-05-23T23:11:32.077

您可以在 1 个命令中使用 substring / locate 功能

这是一个老鼠教程：

[http://infofreund.de/mysql-select-substring-2-different-delimiters/](http://infofreund.de/mysql-select-substring-2-different-delimiters/)

描述他们的命令应该寻找你：

**SELECT substr(text,Locate(' :', text )+2,Locate(': ', text )-(Locate(' :', text )+2)) FROM`testtable**`

其中 text 是包含“test 'esf :foo: bar”的文本字段

所以 foo 可以是 fooooo 或 fo - 长度无关紧要:)。

# asp.net-mvc - 在 asp.net mvc 中实现 stackoverflow 样式徽章系统的最佳策略

> ID：149697
> 
> 赞同：7
> 
> 时间：2008-09-29T17:11:08.883
> 
> 标签：asp.net-mvc, badge

我想知道使用 asp.net mvc 实现徽章系统的最佳策略是什么。stackoverflow 有一个非常有趣的。你有什么建议？

我想我需要稍微澄清一下这个问题。问题在于获得每个徽章的标准不同。如何使该逻辑可扩展？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-29T17:21:38.907

我会纯粹在 T-SQL 中完成它，并设置一个定期运行的 SQL 作业（Jeff 使用 C# 完成它，并且有一个愚蠢的系统，它根据页面请求运行进程）。

基本上，在您的 SQL 作业中，扫描您的成员表并计算是否有人有资格获得徽章，如果是，则更新徽章表。

然后在前端，执行查询以针对每个请求检索成员的新徽章。

# c++ - Linux 上的互锁等效项

> ID：149710
> 
> 赞同：13
> 
> 时间：2008-09-29T17:14:07.677
> 
> 标签：c++, linux, multithreading, atomic

在 C++ Linux 应用程序中，获取 Win32 上的[Interlocked](http://msdn.microsoft.com/en-us/library/system.threading.interlocked.aspx)函数提供的功能的最简单方法是什么？具体来说，一种以原子方式递增或添加 32 位或 64 位整数的轻量级方法？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-29T17:17:01.677

英特尔的开源[ThreadBuildingBlocks](http://www.threadingbuildingblocks.org/)有一个模板 Atomic，它提供与 .NET 的 Interlocked 类相同的功能。

与 gcc 的 Atomic 内置程序不同，它是跨平台的，不依赖于特定的编译器。正如 Nemanja Trifunovic 在上面正确指出的那样，它确实依赖于 x86 和 Itanium 芯片提供的[比较和交换](http://en.wikipedia.org/wiki/Compare_and_swap)CPU 指令。我想您不会期望英特尔库中的其他任何东西:)

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-09-29T19:31:05.193

*只需几条注释即可澄清与Linux*无关的问题。

**RWM**（读-修改-写）操作和那些不单步执行的操作需要硬件支持才能*原子*执行；其中包括增量和减量、fetch_and_add 等。

对于某些架构（包括 I386、AMD_64 和 IA64），gcc 具有对原子内存访问的内置支持，因此不需要外部库。[在这里](http://gcc.gnu.org/onlinedocs/gcc-4.3.0/gcc/Atomic-Builtins.html)，您可以阅读有关 API 的一些信息。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-09-29T18:10:42.347

严格来说，Linux 不能提供像 Win32 中那样的原子“联锁”功能，仅仅是因为这些功能需要硬件支持，而 Linux 运行在一些不提供这种支持的平台上。话虽如此，如果您可以将自己限制在 Intel x86/x64 上，请查看 Boost 共享指针库中引用计数的实现。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-30T11:33:40.683

Apache Portable Runtime 中的[原子](http://apr.apache.org/docs/apr/1.3/group__apr__atomic.html)函数非常接近 Win32 InterlockedXXX 函数。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-12-01T15:21:30.147

您可以在源代码中插入一些汇编代码，以直接使用 x68 互锁指令。

您应该使用**lock xadd**操作。

参见例如[this](http://www.asmcommunity.net/board/index.php?topic=17369.0)。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-12-01T21:05:14.197

GTK 和 QT 编程以及独立程序中使用的相当常见的 glib 库提供了各种原子操作。有关列表，请参见[http://library.gnome.org/devel/glib/2.16/glib-Atomic-Operations.html](http://library.gnome.org/devel/glib/2.16/glib-Atomic-Operations.html)。`g_atomic`在 Win32 上 Interlocked 支持的大多数操作都有函数，在硬件直接支持这些操作的平台上，它们被内联为所需的汇编代码。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2008-09-29T17:15:53.490

经过进一步审查，[这](http://gcc.gnu.org/onlinedocs/gcc-4.1.0/gcc/Atomic-Builtins.html)看起来很有希望。耶堆栈溢出。

# .net - .NET 中 ClickOnce/智能客户端部署的陷阱/陷阱

> ID：149718
> 
> 赞同：31
> 
> 时间：2008-09-29T17:16:20.337
> 
> 标签：.net, winforms, clickonce, smartclient

我有几个 .NET [Windows 窗体](http://en.wikipedia.org/wiki/Windows_Forms)应用程序，我正准备将它们转换为[ClickOnce](http://en.wikipedia.org/wiki/ClickOnce) /smart-client 部署方案。我已经阅读了这不是很好的教程，但是我应该注意哪些陷阱或“陷阱”？

有几个小应用程序断断续续地使用，但主要应用程序是 C#，24/7 运行，相当大，但每隔几周才会更改一次。它还本地写入日志文件并与本地硬件设备对话。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-09-29T17:21:47.097

以下是我知道的一些。

1.  ~~无法在桌面上放置图标。~~ 你现在可以。

2.  我无法为所有用户安装。

3.  我需要跳过箍将部署移动到不同的服务器。如果您在内部开发，用户可以看到您发布到的服务器，或者如果您正在部署到公共 Web，这不是问题，但如果您需要独立部署到多个客户站点，那就不是很好了。

4.  从[.NET](http://en.wikipedia.org/wiki/.NET_Framework) 3.5 SP1 开始，您不再需要签署部署清单，这使得将部署移动到新服务器变得更加容易。

5.  我无法在[GAC](http://en.wikipedia.org/wiki/Global_Assembly_Cache)中安装程序集。您可以通过创建作为 ClickOnce 应用程序先决条件的常规安装包来解决此问题。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-11-16T04:39:28.683

*   部署更新后，内置对话框将使其看起来好像正在重新下载整个应用程序。事实上，只有更改的 DLL 正在下载，并且显示的进度条是误导/错误的。不要浪费时间试图弄清楚为什么要重新部署所有程序集，结果却发现它们实际上并非如此。不是我那样做或任何事情。
*   当您用于签署原始部署清单的证书过期并且您获得了新的证书时，您将陷入困境（客户端都需要卸载并重新安装）。细节[尽在马口](http://support.microsoft.com/kb/925521)。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-09-30T14:11:47.077

大多数问题已得到解决，但有几个人提到无法创建桌面快捷方式。事实上，您[*可以*使用 Visual Studio 2008 SP1 创建桌面快捷方式](http://social.msdn.microsoft.com/forums/en-US/winformssetup/thread/8799bcb0-d456-4d54-8685-22eb671ee4a5/)。

此外，如果您使用的不是最新版本的 Visual Studio，您始终可以[编写代码来创建已安装的开始菜单快捷方式的快捷方式](https://stackoverflow.com/questions/152188/can-i-create-a-desktop-icon-for-a-clickonce-application)。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-09-29T17:23:02.647

我们有一个要部署为 ClickOnce 应用程序的应用程序。我们需要用户能够修改安装中的一些设置（例如部署路径 - IT 希望从他们的网络共享中提供文件，在构建时未知）。当您更改部署中的任何文件时，您需要重新计算所有哈希值，并对所有内容重新签名。因此，如果此解决方案是内部解决方案，您可能不会在传递签名证书时遇到问题，但如果这是针对客户的，您将需要构建一个奇特的解决方案来绕过此问题。

我从互联网内部的某个地方听到传言说，未来版本的 ClickOnce 将消除一些这种令人头疼的问题。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-09-29T17:22:14.457

ClickOnce 的缺陷之一是您无法安装到[GAC](http://en.wikipedia.org/wiki/Global_Assembly_Cache)。如果您想安装多个共享 DLL 文件的应用程序，这是一个问题。每个应用程序都需要 DLL 文件的本地副本。此外，多个用户安装已结束。请参阅[比较 Window Installer 和 ClickOnce 的列表](http://msdn.microsoft.com/en-us/library/142dbbz4.aspx)。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-11-28T08:25:32.620

您不能静默卸载 ClickOnce 部署的应用程序。另外我认为在启动快捷方式中添加参数是不可能的。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-09-29T17:23:06.733

您无法使用 ClickOnce 应用程序做很多事情，例如安装到用户桌面的快捷方式或在安装应用程序的位置设置任何sayo。对于某些人来说，这些是破坏交易的人。

自从我使用它已经有一段时间了，但是有一种特殊的方法可以用来计算和显示 ClickOnce 版本/内部版本号，它与应用程序的版本/内部版本号是分开的。您必须尝试/捕获，如果 ClickOnce 版本/内部版本号引发异常，则该应用程序未作为 ClickOnce 部署的应用程序运行（即，它作为定期编译的应用程序或从 Visual Studio 运行）。

对于一个简单的应用程序（即不是[Microsoft Word](https://en.wikipedia.org/wiki/Microsoft_Word)，而是一个快速而肮脏的应用程序来做某事）并且需要大量定期部署，ClickOnce 非常棒。但是您很快就遇到了“哦，ClickOnce无法做到这一点，请选择MSI或其他）的墙。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-09-29T17:23:14.067

与普通的 .NET 应用程序相比，您将拥有更少的系统访问权限。

那是因为您将获得较低的信任级别。*[.NET Framework 开发人员指南：ClickOnce 部署和安全性](http://msdn.microsoft.com/en-us/library/76e4d2xw.aspx)*中的更多信息。

我最大的问题是无法使用机器密钥加密配置文件的某些部分，因为您无权访问该密钥（考虑到保护该密钥是有意义的）。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2008-11-16T04:23:36.653

如果有人在搜索中提到这个，我们发现许多客户担心“分发”他们的应用程序缺乏安全性。该应用程序必须在公共位置可用 - 无需任何身份验证 - 才能检查更新。唯一的例外是如果您有 Windows NT 身份验证。我认为*[保护 ClickOnce 应用程序](http://msdn.microsoft.com/en-us/library/76e4d2xw.aspx)*可以解释我的意思。

桌面图标通过代码来完成是相当简单的，并且如前所述，在[3.5 SP1](https://en.wikipedia.org/wiki/.NET_Framework_version_history#Service_Pack_1)中，已经嵌入 - 所以这不再是一个问题。

xmlSerializer 仍有一个未修复的错误 - 在某些情况下它没有正确部署。一个简单的解决方法是手动将此文件添加到部署中。PITA，但它很容易......但是，当您的部署突然失败时，这可能会令人震惊......

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2009-02-12T16:08:36.327

我不知道 SP1 允许您创建桌面图标。
以下是我们一直在做的事情（现在被称为“艰难的方式”）：

```
try
{
    string company = string.Empty;
    string product = string.Empty;
    if (Attribute.IsDefined(asm, typeof(AssemblyCompanyAttribute)))
    {
        AssemblyCompanyAttribute asCompany = (AssemblyCompanyAttribute)Attribute.GetCustomAttribute(asm, typeof(AssemblyCompanyAttribute));
        company = asCompany.Company;
    }
    if (Attribute.IsDefined(asm, typeof(AssemblyProductAttribute)))
    {
        AssemblyProductAttribute asProduct = (AssemblyProductAttribute)Attribute.GetCustomAttribute(asm, typeof(AssemblyProductAttribute));
        product = asProduct.Product;
    }
    if (!string.IsNullOrEmpty(company) && !string.IsNullOrEmpty(product))
    {
        string desktopPath = Path.Combine(Environment.GetFolderPath(Environment.SpecialFolder.Desktop),
            product + ".appref-ms");
        string shortcutPath = Path.Combine(Environment.GetFolderPath(Environment.SpecialFolder.Programs),
            Path.Combine(company, product + ".appref-ms"));
        File.Copy(shortcutPath, desktopPath, true);
    }
}
catch 
{
    // Shortcut could not be created
} 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2010-08-06T20:11:38.517

如果客户端位于需要身份验证的代理后面，则无法安装。

# mfc - 程序无法在 Vista 和 Server 2008 上运行

> ID：149753
> 
> 赞同：1
> 
> 时间：2008-09-29T17:26:42.793
> 
> 标签：mfc, windows-vista, windows-server-2008, visual-c++-6, code-migration

我的许多（如果不是全部）旧 VC++ 6.0 MFC 应用程序在 Vista 和 Server 2008 中无法运行。我认为迁移是个问题，但现在是我的问题 :(

我该如何让这些东西发挥作用？那可能吗？我已经搜索过了，但是有没有关于这个主题的知识库？

编辑：兼容模式似乎有效。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-29T17:29:34.923

它们不起作用应该有具体的原因，当然，究竟是什么不起作用。也许您应该将每个问题分解为一个单独的问题（也许在 SO 中），并准确告诉我们您在尝试运行它们时遇到了什么样的问题，以及导致这些错误出现的代码是什么。

没有细节，就太模糊了。没有什么魔法可以让应用程序像那样简单地工作。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-29T17:44:31.503

[这里](http://www.microsoft.com/downloads/details.aspx?FamilyID=BA73B169-A648-49AF-BC5E-A2EEBB74C16B&displaylang=en)有一个文档解释了如何开发符合 UAC 的应用程序。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-29T17:33:24.820

在不重新编译的情况下，您是否尝试过将程序的兼容模式设置为 Windows 98 或 ME？

# wpf - 您如何确定 WPF 使用的是硬件渲染还是软件渲染？

> ID：149763
> 
> 赞同：32
> 
> 时间：2008-09-29T17:29:00.090
> 
> 标签：wpf, rendering, pipeline

我在各种平台上对 WPF 应用程序进行基准测试，我需要一种简单的方法来确定 WPF 是使用硬件还是软件呈现。

我似乎想起了一个电话来确定这一点，但我现在不能动手。

另外，是否有一种简单的基于代码的方法来强制一个渲染管道在另一个渲染管道上？

* * *

## 回答 #1

> 赞同：36
> 
> 时间：2008-09-29T17:39:21.500

检查 RenderCapability.Tier

*   [图形渲染层](https://docs.microsoft.com/en-us/dotnet/desktop/wpf/advanced/graphics-rendering-tiers)
*   [渲染能力类](https://docs.microsoft.com/en-us/dotnet/api/system.windows.media.rendercapability)

[**更新**]

*   **RenderCapability.IsPixelShaderVersionSupported** - 获取一个值，该值指示是否支持指定的像素着色器版本。
*   **RenderCapability.IsShaderEffectSoftwareRenderingSupported** - 获取一个值，该值指示系统是否可以在软件中渲染位图效果。
*   **RenderCapability.Tier** - 获取一个值，该值指示当前线程的渲染层。
*   **RenderCapability.TierChanged** - 在当前线程的 Dispatcher 对象的渲染层发生更改时发生。

**RenderCapability.Tier >> 16**

*   **渲染层 0** - 无图形硬件加速。DirectX 版本级别低于 7.0 版。
*   **渲染层 1** - 部分图形硬件加速。DirectX 版本级别高于或等于 7.0 版，低于 9.0 版。
*   **渲染层 2** - 大多数图形功能使用图形硬件加速。DirectX 版本级别大于或等于 9.0 版。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2010-05-19T15:56:04.933

.NET 4.0 提供了在代码中强制软件渲染的能力：

```
public partial class App : Application 
{    
    protected override void OnStartup(StartupEventArgs e)    
    {         
        if (WeThinkWeShouldRenderInSoftware())            
            RenderOptions.ProcessRenderMode = RenderMode.SoftwareOnly;    
    }
} 
```

有关更多信息，请参阅[此帖子](http://blogs.msdn.com/jgoldb/archive/2010/04/12/what-s-new-for-performance-in-wpf-in-net-4.aspx)。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-09-29T18:26:47.143

基于[RenderingTier 链接](https://stackoverflow.com/questions/149763/how-do-you-determine-if-wpf-is-using-hardware-or-software-rendering#149802)，这里有一些代码：

```
 logger.InfoFormat("WPF Tier = {0}",RenderCapability.Tier / 0x10000);
        RenderCapability.TierChanged +=
            (sender, args) => logger.InfoFormat("WPF Tier Changed to {0}",
                                                RenderCapability.Tier / 0x10000); 
```

我仍在测试和解决这个问题。有关我发现的内容，请参阅未来的编辑/答案。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-10-01T14:27:35.483

也许以下内容可以帮助您解决问题的第二部分，也就是说，您可以强制一个渲染管道超过另一个：

您可以更改注册表设置以禁用硬件加速并强制始终进行软件渲染。我们经常使用它来查看我们看到的特定问题......是否与视频驱动程序有关。作为我正在谈论的示例，请参阅此[WPF 论坛帖子](http://social.msdn.microsoft.com/Forums/en-US/wpf/thread/7382637b-b4bc-4a46-8bed-f36250a65385)。

不过，这里要注意的一件显而易见的事情是……这会影响**所有**WPF 应用程序，并且实际上应该仅用于测试目的。

要禁用硬件加速：

```
[HKEY_CURRENT_USER\Software\Microsoft\Avalon.Graphics]
"DisableHWAcceleration"=dword:00000001 
```

要启用硬件加速：

```
[HKEY_CURRENT_USER\Software\Microsoft\Avalon.Graphics]
"DisableHWAcceleration"=dword:00000000 
```

查看此[MSDN 链接](http://msdn.microsoft.com/en-us/library/aa970912.aspx)以获取更多信息。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-09-29T18:14:45.237

或者使用[分析工具](http://windowsclient.net/wpf/perf/wpf-perf-tool.aspx)...

> 添加了新复选框以对使用 SW 渲染的传统位图效果的目标应用程序元素进行着色。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-01T06:20:28.667

要回答你问题的后半部分，我相信没有办法真的强迫一种方式超越另一种方式。如果可用，将自动使用硬件渲染，否则使用软件。

如果您需要在软件模式下对其进行测试，则需要使用低规格机器或使用远程桌面查看在另一台计算机上运行的应用程序。然而，除了降低性能/帧率之外，两者之间的外观不应该有任何明显的差异。使用 RenderCapability 类来了解是否应该禁用动画或效果等功能以提高性能。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-07-17T09:35:33.153

我同意第二个答案，但这只是说明了机器使用硬件渲染运行的能力，而不是如果应用程序实际上是硬件渲染的。

我使用画布制作了一个简单的应用程序，只需使用 RotateTransform 旋转一个矩形，就会为硬件渲染的应用程序使用大量 CPU。这和“RenderCapability.Tier”的值为 2，所以有足够的硬件能力来做到这一点。

那为什么不呢？

# sql - 如何使用 GROUP BY 连接 MySQL 中的字符串？

> ID：149772
> 
> 赞同：406
> 
> 时间：2008-09-29T17:32:45.493
> 
> 标签：sql, mysql, string, aggregate, concatenation

基本上问题是如何从中得到：

```
foo_id foo_name
1个
1乙
2℃

```

对此：

```
foo_id foo_name
1 AB
2℃

```

* * *

## 回答 #1

> 赞同：612
> 
> 时间：2008-09-29T17:38:37.057

```
SELECT id, GROUP_CONCAT(name SEPARATOR ' ') FROM table GROUP BY id; 
```

[https://dev.mysql.com/doc/refman/8.0/en/aggregate-functions.html#function_group-concat](https://dev.mysql.com/doc/refman/8.0/en/aggregate-functions.html#function_group-concat)

从上面的链接中，`GROUP_CONCAT`：此函数返回一个字符串结果，其中包含来自组的连接的非 NULL 值。如果没有非 NULL 值，则返回 NULL。

* * *

## 回答 #2

> 赞同：168
> 
> 时间：2008-09-29T17:39:59.440

```
SELECT id, GROUP_CONCAT( string SEPARATOR ' ') FROM table GROUP BY id 
```

更多细节[在这里](http://dev.mysql.com/doc/refman/5.0/en/group-by-functions.html#function_group-concat)。

从上面的链接中，`GROUP_CONCAT`：此函数返回一个字符串结果，其中包含来自组的连接的非 NULL 值。如果没有非 NULL 值，则返回 NULL。

* * *

## 回答 #3

> 赞同：19
> 
> 时间：2008-09-29T17:41:09.123

```
SELECT id, GROUP_CONCAT(CAST(name as CHAR)) FROM table GROUP BY id 
```

会给你一个逗号分隔的字符串

* * *

## 回答 #4

> 赞同：19
> 
> 时间：2013-08-08T05:16:48.610

```
SELECT id, GROUP_CONCAT(name SEPARATOR ' ') FROM table GROUP BY id; 
```

:- 在 MySQL 中，您可以获得表达式组合的连接值。要消除重复值，请使用**DISTINCT**子句。要对结果中的值进行排序，请使用 ORDER BY 子句。要按*相反顺序*排序，请将***DESC***（降序）关键字添加到您在 ORDER BY 子句中排序的列的名称。默认为升序；这可以使用 ASC 关键字显式指定。组中值之间的默认分隔符是逗号 (“,”)。要显式指定分隔符，请使用 SEPARATOR 后跟应插入组值之间的字符串文字值。要完全消除分隔符，请指定**SEPARATOR ''**。

```
GROUP_CONCAT([DISTINCT] expr [,expr ...]
             [ORDER BY {unsigned_integer | col_name | expr}
                 [ASC | DESC] [,col_name ...]]
             [SEPARATOR str_val]) 
```

或者

```
mysql> SELECT student_name,
    ->     GROUP_CONCAT(DISTINCT test_score
    ->               ORDER BY test_score DESC SEPARATOR ' ')
    ->     FROM student
    ->     GROUP BY student_name; 
```

* * *

## 回答 #5

> 赞同：17
> 
> 时间：2010-09-24T09:53:35.003

结果被截断为 group_concat_max_len 系统变量给出的最大长度，默认值为 1024 个字符，因此我们首先执行以下操作：

```
SET group_concat_max_len=100000000; 
```

然后，例如：

```
SELECT pub_id,GROUP_CONCAT(cate_id SEPARATOR ' ') FROM book_mast GROUP BY pub_id 
```

* * *

## 回答 #6

> 赞同：11
> 
> 时间：2017-05-30T20:27:30.580

很好的答案。我也遇到了 NULLS 的问题，并设法通过在 GROUP_CONCAT 中包含 COALESCE 来解决它。示例如下：

```
SELECT id, GROUP_CONCAT(COALESCE(name,'') SEPARATOR ' ') 
FROM table 
GROUP BY id; 
```

希望这对其他人有帮助

# linux - Crystalspace vs. Irrlicht vs.......？

> ID：149773
> 
> 赞同：4
> 
> 时间：2008-09-29T17:32:46.680
> 
> 标签：linux, irrlicht

因此，我使用 Linux，并且一直在努力寻找时间来进行游戏编程。我从 Panda3d 开始，并获得了一些相当不错的结果，并对游戏编程中的许多概念有所了解。不久之后，我决定更上一层楼，转向更强大的、基于 C 或 C++ 的东西。

我可能真的很笨，但我永远无法真正弄清楚如何正确使用 Crystalspace。如果有人对如何使用它有任何有用的资源，我将不胜感激。但与此同时，我在玩 Irrlicht 并且我喜欢它，但我想知道更多知识渊博的人对这个主题有什么看法。也许还有另一个我不知道的很棒的选择。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-12-08T18:52:26.190

如果你问我，Irrlich 是最好的开源引擎——它具有清晰的架构、良好的性能并且需要程序员编写的代码更少。老实说，我无法将 Irrlicht 与 Crystal Space 或 Orge 进行比较。我认为 CS 是一堆代码，由许多不同的程序员以不同的方式编写——我也很难想象如何使用它（由于绝对缺乏文档）。至于Ogre，它并不比D3D容易。我检查了不同的示例，并找到了大量的多行代码片段，这些片段是在 D3D 中用单行代码完成的。所以，我根本看不出一个理由，为什么要花几个月的时间学习 OGRE 糟糕的 API——如果有空闲时间，我会建议自己学习 D3D。我可以说更多 - Irrlicht 比许多商业引擎更好，例如 - 扭矩（绝对缺乏文档，力在现有的引擎上启动项目等），Truevision 等。当然，Irrlicht 缺乏一些很棒的功能，AAA 级引擎必须具备，但对于较小的项目来说已经足够了。如果您没有大笔资金购买 Gamebryo 和类似的成绩引擎，我建议您坚持使用 Irrlicht - 至少在前几个项目中。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-09-30T01:17:29.153

我曾在游戏行业工作过一段时间。我也是一个Linux人。我用 Irrlicht 制作了几款游戏，并将它们作为我简历的一部分，这帮助我找到了一份游戏程序员的工作。

在我看来，与 Ogre 相比，Irrlicht 的 API 更简洁，系统要求更低，并且跨平台工作得更好。和 Irrlicht 一起制作游戏让我玩得很开心。它也相当轻量级（比 Ogre 轻得多），具有非常开放的许可证，可用于任何用途，无论是商业用途还是其他用途。

使用该引擎为我在商业游戏行业工作做好了很多准备。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-09-29T17:52:59.937

食人魔3D

[http://www.ogre3d.org/](http://www.ogre3d.org/)

通常与 Crystalspace 和 irrlicht 一起命名。

据说 Ogre 和 Irrlicht 的设计都比 Crystalspace 更简洁，所以我不会太担心后者的问题。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-01-11T16:21:59.040

如果您正在寻找高效的游戏开发，那么我最好的选择是使用 Unity 3D。我开始使用 Irrlicht，但由于不直观的工具和很大的编程压力而很快退出。食人魔似乎更加复杂。
另一方面，Unity 在每次发布时都在迅速普及。最近的 Unity 4 包含大量功能。
凭借非常少的游戏开发知识，我设法在 Unity Android 中编写了自己的飞行模拟引擎。甚至学会了轻松编写着色器。
虽然高级 Unity 许可证是付费的，但它们非常值得。但您始终可以使用 Unity 免费版制作商业 PC 游戏。总之，游戏开发就是要掌握游戏引擎的窍门。掌握任何，你将统治。

# ruby-on-rails - 在 RoR 2.x 中使用 respond_to 和 ajax 进行优雅降级

> ID：149776
> 
> 赞同：3
> 
> 时间：2008-09-29T17:33:15.587
> 
> 标签：ruby-on-rails, ruby, ajax, graceful-degradation

我正在阅读有关使用 ruby​​ on rails 进行 Web 开发的 AWDR 书籍，旧代码的问题之一是它没有使用 respond_to 来确保使用的视图是 javascript 视图。现在在一些更新的示例中，我看到人们稍后提到它们，在实现优雅降级时，使用 request.xhr？判断用户是否启用了 javascript，如果没有，则重定向用户。

我想知道您是否可以使用 respond_to 来获得相同的行为，如果可以，这是否被认为是好的形式，为什么？

所以我想做的是这样的：

```
def function
  respond_to do |format|
    format.js do
      basic_stuff
    end
    format.html do
      basic_stuff
      user_redirect
    end
  end
end 
```

它似乎确实违反了 DRY 原则，我可能遗漏了一些关于用户和服务器如何在这里交互的信息。老实说，API 文档并没有让我完全清楚。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-29T17:47:20.077

那么你可以像这样重构：

```
def function
  basic_stuff # executed regardless of the mime types accepted
  respond_to do |format|
    format.html do
      user_redirect
    end
  end
  # will fall back rendering the default view - which you should ensure will be js
end 
```

`request.xhr?`查看请求的`X-Requested-With`标头（查看它是否包含“XMLHttpRequest”）。`respond_to`查看接受的 mime 类型。

您可以使用其中任何一个来实现某种优雅的降级。

**但是**`xhr?`，除非您的 ajax 调用正在设置该标头（原型自动执行此操作），否则您将无法使用优雅的降级。

此外，`respond_to`提供更大的灵活性，即发送 xml、json、js，无论它可能来自同一块。

所以我推荐`respond_to`这里。

# jsp - jsp taglib 与包含 jsp 页面之间的根本区别是什么？

> ID：149777
> 
> 赞同：8
> 
> 时间：2008-09-29T17:33:15.663
> 
> 标签：jsp, taglib, jspinclude

我有几个常见的元素（组件），它们会生成一些 html。看来我的选择是创建一个标记库，或者只是将该逻辑放入一个 jsp 页面并包含 jsp。

有什么不同？正面与负面？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-29T17:40:25.100

Taglibs 允许您定义可以记录的（键入的）参数。标记库也可以知道它们在对象树中的位置，因此在不同的上下文中表现不同；或一遍又一遍地调用特定模板来创建迭代器或语句构造。

您是否知道标记库不一定必须用 Java 编写？还有一个名为 tagfiles 的概念，它允许您在 JSP 中编写您的 taglib；通常更适合扁平组件...非常接近包含。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-29T17:48:29.420

当您使用 taglib 时，容器通常：

*   从 _jspService 中编写和调用辅助方法
*   在辅助方法中创建了一个标记类的实例并调用了标准方法（setParent()、doStartTag()、doEndTag() 等...）

这将所有代码保留在同一资源中（请求不会传递给另一个组件），因此允许您构建循环行为并访问当前页面上的其他组件。

学习标签库有开销。但是，一旦您的第一个标签开始工作，它就会走下坡路。此外，非开发人员更容易理解最终结果（假设您为标签选择了好的名称）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-29T17:56:04.893

标记（包括易于使用的类似 JSP 的标记文件机制）支持使用强类型命名参数的调用。

JSP 标记的另一个非常有用且经常被忽视的特性是`JspFragment`属性类型。这允许您将一块 JSP 代码作为参数传递到要调用的标记中，可能会重复调用。

包括缺少这些强大的参数化功能。

* * *

## 回答 #4

> 赞同：-2
> 
> 时间：2008-09-29T17:36:53.377

taglibs 使定义和处理参数变得更容易，但开发它们的开销很大。包含更简单，但功能较弱。很大程度上取决于你的风格。

根据我的经验，人们通常只使用包含，因为他们不想花时间学习创建标签库。导致一团糟。只要您的团队很小并且您的内容不太复杂，那还不错。但这是一种代码气味。

# sql - 如何复制 SQL 表中的记录但换出新行的唯一 ID？

> ID：149784
> 
> 赞同：140
> 
> 时间：2008-09-29T17:35:04.833
> 
> 标签：sql, sql-server, sql-server-2005, tsql

[这个问题](https://stackoverflow.com/questions/57168/how-to-copy-a-row-from-one-sql-server-table-to-another)接近我所需要的，但我的情况略有不同。源表和目的表相同，主键是唯一标识符（guid）。当我尝试这个时：

```
insert into MyTable
    select * from MyTable where uniqueId = @Id; 
```

我显然违反了主键约束，因为我试图复制主键。实际上，我根本不想复制主键。相反，我想创建一个新的。此外，我想有选择地复制某些字段，并将其他字段保留为空。为了使事情变得更复杂，我需要获取原始记录的主键，并将其插入副本中的另一个字段（PreviousId 字段）。

我确信有一个简单的解决方案，我只是不知道足够的 TSQL 知道它是什么。

* * *

## 回答 #1

> 赞同：203
> 
> 时间：2008-09-29T17:37:23.843

试试这个：

```
 insert into MyTable(field1, field2, id_backup)
    select field1, field2, uniqueId from MyTable where uniqueId = @Id; 
```

任何未指定的字段都应接收其默认值（未定义时通常为 NULL）。

* * *

## 回答 #2

> 赞同：110
> 
> 时间：2013-02-22T13:21:50.420

好的，我知道这是一个老问题，但我还是发布了我的答案。

我喜欢这个解决方案。我只需要指定标识列。

```
SELECT * INTO TempTable FROM MyTable_T WHERE id = 1;
ALTER TABLE TempTable DROP COLUMN id;
INSERT INTO MyTable_T SELECT * FROM TempTable;
DROP TABLE TempTable; 
```

“id”列是标识列，这是我必须指定的唯一列。无论如何，这比其他方式要好。:-)

我使用 SQL Server。您可能想在第 1 行和第 2 行使用“ `CREATE TABLE`”和“ `UPDATE TABLE`”。嗯，我看到我并没有真正给出他想要的答案。他还想将 id 复制到另一列。但是这个解决方案非常适合使用新的自动 ID 制作副本。

我使用 Michael Dibbets 的想法编辑我的解决方案。

```
use MyDatabase; 
SELECT * INTO #TempTable FROM [MyTable] WHERE [IndexField] = :id;
ALTER TABLE #TempTable DROP COLUMN [IndexField]; 
INSERT INTO [MyTable] SELECT * FROM #TempTable; 
DROP TABLE #TempTable; 
```

您可以通过用“，”分隔它们来删除一列以上。:id 应替换为您要复制的行的 id。MyDatabase、MyTable 和 IndexField 应替换为您的姓名（当然）。

* * *

## 回答 #3

> 赞同：17
> 
> 时间：2009-05-21T19:49:10.600

我猜你是想避免写出所有的列名。如果您使用的是 SQL Management Studio，您可以轻松地右键单击表和 Script As Insert.. 然后您可以处理该输出来创建您的查询。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2008-09-29T17:37:25.123

指定除您的 ID 字段之外的所有字段。

```
INSERT INTO MyTable (FIELD2, FIELD3, ..., FIELD529, PreviousId)
SELECT FIELD2, NULL, ..., FIELD529, FIELD1
FROM MyTable
WHERE FIELD1 = @Id; 
```

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2017-09-05T00:02:29.213

我有同样的问题，我希望单个脚本处理具有其他开发人员定期添加的列的表。不仅如此，我还支持我们数据库的许多不同版本，因为客户可能并非都与当前版本保持同步。

我采用了 Jonas 的解决方案并稍作修改。这允许我制作该行的副本，然后在将主键添加回原始源表之前更改主键。这对于处理不允许在列中有 NULL 值并且您不想在 INSERT 中指定每个列名的表也非常方便。

此代码将“ABC”的行复制到“XYZ”

```
SELECT * INTO #TempRow FROM SourceTable WHERE KeyColumn = 'ABC';
UPDATE #TempRow SET KeyColumn = 'XYZ';
INSERT INTO SourceTable SELECT * FROM #TempRow;
DELETE #TempRow; 
```

完成删除临时表后。

```
DROP TABLE #TempRow; 
```

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2018-06-18T04:55:26.517

我知道我的回答迟到了。但是我解决的方式与所有答案都有点不同。

我有一种情况，我需要在表格中克隆一行，除了几列。那些少数将有新的价值。此过程应自动支持将来对表的更改。这意味着，克隆记录而不指定任何列名。

我的方法是，

1.  查询 Sys.Columns 以获取表的完整列列表，并在 where 子句中包含要跳过的列的名称。
2.  将其转换为 CSV 作为列名。
3.  Build Select ... 基于此插入到脚本中。

```
 declare @columnsToCopyValues varchar(max), @query varchar(max)
SET @columnsToCopyValues = ''

--Get all the columns execpt Identity columns and Other columns to be excluded. Say IndentityColumn, Column1, Column2
Select @columnsToCopyValues = @columnsToCopyValues  + [name] + ', ' from sys.columns c where c.object_id = OBJECT_ID('YourTableName') and name not in ('IndentityColumn','Column1','Column2')
Select @columnsToCopyValues = SUBSTRING(@columnsToCopyValues, 0, LEN(@columnsToCopyValues))
print @columnsToCopyValues

Select @query = CONCAT('insert into YourTableName (',@columnsToCopyValues,', Column1, Column2) select ', @columnsToCopyValues, ',''Value1'',''Value2'',', ' from YourTableName where IndentityColumn =''' , @searchVariable,'''')

print @query
exec (@query) 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-09-29T17:39:42.187

```
insert into MyTable (uniqueId, column1, column2, referencedUniqueId)
select NewGuid(), // don't know this syntax, sorry
  column1,
  column2,
  uniqueId,
from MyTable where uniqueId = @Id 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-29T17:42:34.270

如果“key”是您的 PK 字段并且它是自动数字的。

```
insert into MyTable (field1, field2, field3, parentkey)
select field1, field2, null, key from MyTable where uniqueId = @Id 
```

它将生成一条新记录，从原始记录中复制 field1 和 field2

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2013-01-20T18:07:09.643

我的表有 100 个字段，我需要一个查询才能工作。现在我可以用一些基本的条件逻辑来切换任意数量的字段，而不必担心它的序数位置。

1.  将下面的表名替换为您的表名

    ```
    SQLcolums = "SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE (TABLE_NAME = 'TABLE-NAME')"

    Set GetColumns = Conn.Execute(SQLcolums)
    Do WHILE not GetColumns.eof

    colName = GetColumns("COLUMN_NAME") 
    ```

2.  将原来的身份字段名替换为你的PK字段名

    ```
    IF colName = "ORIGINAL-IDENTITY-FIELD-NAME" THEN ' ASSUMING THAT YOUR PRIMARY KEY IS THE FIRST FIELD DONT WORRY ABOUT COMMAS AND SPACES
        columnListSOURCE = colName 
        columnListTARGET = "[PreviousId field name]"
    ELSE
        columnListSOURCE = columnListSOURCE & colName
        columnListTARGET = columnListTARGET & colName
    END IF

    GetColumns.movenext

    loop

    GetColumns.close 
    ```

3.  再次替换表名（目标表名和源表名）；编辑您的`where`条件

    ```
    SQL = "INSERT INTO TARGET-TABLE-NAME (" & columnListTARGET & ") SELECT " & columnListSOURCE & " FROM SOURCE-TABLE-NAME WHERE (FIELDNAME = FIELDVALUE)" 
    Conn.Execute(SQL) 
    ```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2010-03-17T09:26:10.057

你可以这样做：

```
INSERT INTO DENI/FRIEN01P 
SELECT 
   RCRDID+112,
   PROFESION,
   NAME,
   SURNAME,
   AGE, 
   RCRDTYP, 
   RCRDLCU, 
   RCRDLCT, 
   RCRDLCD 
FROM 
   FRIEN01P 
```

您应该在表 DENI/FRIEN01P 中输入最大 id 的数量而不是 112。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2019-01-17T13:46:39.663

这是我使用 ASP 经典的方法，但无法完全使用上面的答案，我希望能够将我们系统中的产品复制到新的 product_id 并且即使我们需要它也能够工作在表中添加更多列。

```
Cn.Execute("CREATE TEMPORARY TABLE temprow AS SELECT * FROM product WHERE product_id = '12345'")
Cn.Execute("UPDATE temprow SET product_id = '34567'")
Cn.Execute("INSERT INTO product SELECT * FROM temprow")
Cn.Execute("DELETE temprow")
Cn.Execute("DROP TABLE temprow") 
```

# acl - 带有 ACL 的 SNMP SET 和设置社区名称

> ID：149795
> 
> 赞同：2
> 
> 时间：2008-09-29T17:37:52.907
> 
> 标签：acl, snmp

我需要在网络中的打印机中执行 SNMP Set 操作，该打印机配置为访问控制列表 (ACL)，并且我的主机的 IP 地址不在 ACL 表中。我遇到了一个奇怪的行为：当我配置了 SNMPv1 集社区名称时，如果我的主机 ip 在 ACL 表中，我只能执行 SNMP 集。如果没有配置 SNMPSet 团体名称，即使我的 ip 地址不在 ACL 表中，我也可以正常执行 SNMP Set。那么，有谁知道 ACL 表和 SNMP Set 社区名称之间是否有任何关系？我的意思是，只有在配置了设置的社区名称时，ACL 才“工作”。这有意义吗？

谢谢你的帮助

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-01T02:48:53.107

ACL 在打印机本身上。我们通过网络连接，打印机位于另一个子网中。ACL 仅包含一个条目，并且没有阻止规则。问题本身与 SNMP Set Community 本身相关的行为有关，我想了解它们之间是否存在任何关系。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-16T04:14:38.053

As far as I know, such ACL is not a default part of SNMP, and its function can be varied by the vendor.

Like your test revealed, this may be a security flaw. Consider reporting this issue to the vendor. If they have a fix, they will send to you.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-30T03:54:10.850

那么 ACL 是在本地路由器上还是在打印机本身上？它是什么型号的打印机，您如何连接到它，您是在同一个网络上还是通过路由器到达位于不同网络范围内的打印机？

我会检查完整的 ACL 列表，因为可能存在阻止您访问 atm 的所有规则。

# sql - 在 MySQL 中盲目使用 INSERT 有什么坏处吗？

> ID：149796
> 
> 赞同：3
> 
> 时间：2008-09-29T17:37:58.413
> 
> 标签：sql, mysql

通常我想向表中添加一个值，或者如果它的键已经存在则更新该值。这可以通过多种方式完成，假设在示例中的“user_id”和“pref_key”列上设置了主键或唯一键：

**1.盲插入，如果收到重复键错误则更新：**

```
// Try to insert as a new value
INSERT INTO my_prefs 
(user_id, pref_key, pref_value)
VALUES (1234, 'show_help', 'true');

// If a duplicate-key error occurs run an update query
UPDATE my_prefs 
SET pref_value = 'true'
WHERE user_id=1234 AND pref_key='show_help'; 
```

**2\. 检查是否存在，然后选择或更新：**

```
// Check for existence
SELECT COUNT(*) 
FROM my_prefs
WHERE user_id=1234 AND pref_key='show_help';

// If count is zero, insert
INSERT INTO my_prefs 
(user_id, pref_key, pref_value) 
VALUES (1234, 'show_help', 'true');

// If count is one, update
UPDATE my_prefs 
SET pref_value = 'true' 
WHERE user_id=1234 AND pref_key='show_help'; 
```

第一种方式似乎更可取，因为它只需要一个查询新插入和两个更新，而第二种方式总是需要两个查询。有什么我遗漏的东西，尽管盲目插入会是一个坏主意吗？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-09-29T17:45:55.667

查看[http://dev.mysql.com/doc/refman/5.0/en/insert-select.html中的 ON DUPLICATE KEY 语法](http://dev.mysql.com/doc/refman/5.0/en/insert-select.html)

```
INSERT [LOW_PRIORITY | HIGH_PRIORITY] [IGNORE]
[INTO] tbl_name [(col_name,...)]
SELECT ...
[ ON DUPLICATE KEY UPDATE col_name=expr, ... ] 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-09-29T17:45:39.410

还有第三种 MySQL 方式，这将是该 RDBMS 中的首选方式

```
INSERT INTO my_prefs 
(user_id, pref_key, pref_value) 
VALUES (1234, 'show_help', 'true')
ON DUPLICATE KEY 
UPDATE pref_value = 'true' 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-29T17:41:34.460

就我个人而言，我从不喜欢基于异常的编程（期望在应用程序的正常操作中出现异常），对我来说，第二个示例更具可读性/可维护性。

在某些情况下这会产生影响（例如非常紧密的循环），但我认为应该有充分的理由编写这样的代码，而不是默认的。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-29T17:49:03.100

如果您想通过可能插入双字来避免“异常”并且您想使用标准 SQL（并且您的编程语言/数据库返回更新行的计数），那么使用以下“SQL” - 命令（伪代码） ：

```
int i = SQL("UPDATE my_prefs ...");
if(i==0) {
    SQL("INSERT INTO my_prefs ...");
} 
```

这也考虑到 - 对于大多数用例 - 更新确实比插入更频繁地发生。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-29T17:45:51.937

您可以改用 REPLACE，或者如果使用更新的 MySQL，您可以选择使用“ [INSERT ... ON DUPLICATE KEY UPDATE](http://dev.mysql.com/doc/refman/5.0/en/insert-on-duplicate.html) ”

有几个人连续快速提出这个事实，说当你遇到问题时“总是检查 MySQL 文档”，因为它们很不错，而且在很多情况下，直接导致了解决方案。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-29T19:40:49.383

这些行会有并发 INSERT 吗？删除？

如果您不关心对非 MySQL 数据库的可移植性，“ON DUPLICATE”听起来很棒（行为正是您想要的）。

如果从不删除行，“盲插入”似乎是合理且强大的。（如果 INSERT 案例因为该行存在而失败，那么之后的 UPDATE 应该成功，因为该行仍然存在。但是如果删除行，这个假设是错误的 - 你需要重试逻辑。）在没有“ON DUPLICATE”的其他数据库上，如果您发现延迟很糟糕，您可能会考虑进行优化：您可以通过将此逻辑放入存储过程中来避免在已经存在的情况下进行数据库往返。

如果存在并发 INSERT，则“检查存在”很难正确处理。可以在 SELECT 和 UPDATE 之间添加行。事务甚至不会真正帮助 - 我认为即使在隔离级别“可序列化”，您也会偶尔看到“由于并发更新而无法序列化访问”错误（或任何 MySQL 等效错误消息）。你需要重试逻辑，所以我会说上面建议使用这种方法来避免“基于异常的编程”的人是错误的，因为同样的原因建议首先执行 UPDATE 的人也是错误的。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-29T17:40:49.920

据我所知，第一种方式是首选方式。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-29T17:43:23.457

在您的 DAO 模型中，您可以有一个 id 字段。

*   如果设置为 null / -1 / 不管，数据还没有被持久化。

*   当您持久保存它（或从数据库中检索）时，将其设置为数据库中的 id 值。

*   您的 persist 方法可以检查 ID 并将其传递给 update() 或 add() 实现。

*   缺陷：与数据库不同步等。我敢肯定还有更多，但我真的应该完成一些工作......

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-29T17:47:05.490

只要您使用`MySQL`，就可以使用`ON DUPLICATE`关键字。例如：

```
INSERT INTO my_prefs (user_id, pref_key, pref_value) VALUES (1234, 'show_help', 'true') 
ON DUPLICATE KEY UPDATE (pref_key, pref_value) VALUES ('show_help', 'true'); 
```

# flash - RadioButton 组件中的多行标签 (AS3)

> ID：149800
> 
> 赞同：2
> 
> 时间：2008-09-29T17:39:03.107
> 
> 标签：flash, actionscript-3, radio-button, word-wrap

我正在用 Flash（和 ActionScript 3）制作一个小测验应用程序。决定将 RadioButton 组件用于单选按钮，但我在让自动换行工作时遇到了一些问题。

创建按钮的代码可以在下面找到。

```
_button = new RadioButton();
_button.setStyle("textFormat", _format);
_button.label = _config.toString();
_button.width = Number(_defaults.@alen);
_button.textField.width     = Number(_defaults.@alen);
_button.textField.multiline = true;
_button.textField.wordWrap  = true;
_button.value = _config.@value;
_button.group = _group;
_button.x     = _config.@x;
_button.y     = _config.@y; 
```

_config 是一段 XML，_defaults 是一段包含大小信息和字体设置的 XML

当我将 _button.textField.wordWrap 设置为 true 时，文本会分成多行，但它不会在我想要的 _defaults.@alen 处拆分，但看起来它几乎发生在每个单词之后。

此外，它有时会将其拆分为几行，但直到鼠标悬停在其上才会全部显示。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-29T18:04:55.230

两种可能性：宽度应该以像素为单位，而不是字符。此外，不要忘记按钮本身会占用一些宽度。

如果你不能让它工作，而不是猛烈抨击它，可能只想单独创建标签，或者是一个简单的 TextField，或者使用一个 Label 组件。代码稍微多一点，但多花 10 分钟编写代码而不是花两个小时让组件按您想要的方式工作可能是值得的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-29T18:12:44.167

传递的宽度以像素为单位。

我之前遇到了一些问题，无法使用 CSS 设置标签样式（至少我不知道如何），所以使用了常规文本字段。让对齐恰到好处有点麻烦，所以我希望有可能回到组件。

我现在已经敲了两三个小时的头，所以我认为它又回到了常规文本字段对我来说......

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-05-09T17:52:46.077

我认为[这里](http://blogs.adobe.com/aharui/2007/04/multiline_buttons.html)有一个更好的解决方案。检查出。

# sql - 存储过程所有权链接

> ID：149808
> 
> 赞同：3
> 
> 时间：2008-09-29T17:40:31.137
> 
> 标签：sql, sql-server, tsql, stored-procedures

我的数据库中有几个存储过程，用于从位于单独数据库中的数据集市加载数据。这些程序通常采用以下形式：

```
 CREATE PROCEDURE load_stuff
WITH EXECUTE AS OWNER AS
INSERT INTO my_db.dbo.report_table
(
  column_a
)
SELECT
  column_b
FROM data_mart.dbo.source_table
WHERE
  foo = 'bar'; 
```

当我在 SQL Server Management Studio 中执行查询时，这些运行良好。当我尝试使用 EXEC load_stuff 执行它们时，该过程失败并出现安全警告：

*服务器主体“the_user”无法在当前安全上下文下访问数据库“data_mart”。*

sproc 的 OWNER 是 dbo，即 the_user（为了我们的示例）。两个数据库的 OWNER 也是 the_user 并且 the_user 映射到 dbo（这是 SQL Server 应该做的）。

为什么我会在 SQL Server 中看到此错误？这是因为有问题的用户被别名为 dbo 并且我应该使用不同的用户帐户进行跨数据库数据访问？

**编辑** 我知道这是因为 SQL Server 默认禁用跨数据库所有权链接，这很好。但是，我不确定在这种情况下的最佳做法。如果有人对此方案的最佳实践有任何意见，将不胜感激。

**编辑 2** 最终的解决方案是在两个数据库上都设置 TRUSTWORTHY ON。这允许在两个数据库之间进行有限的所有权链接，而无需诉诸完整的数据库所有权链接。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-29T18:18:34.197

为什么不删除 EXECUTE AS OWNER？

通常，执行 SP 的用户在两个数据库中都具有适当的权限，而我根本不必这样做。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-02-18T15:31:13.230

无需创建登录名，您只需在目标数据库中启用访客用户即可。

**授予连接到访客**

这允许执行用户在来宾上下文下进入数据库，并且当“数据库链接为 ON”时，将不会在目标数据库中检查访问。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-01T14:51:58.530

实际上，DBO 是一个角色（你可以认为它是一组用户），而不是一个用户本身。（除非您可以使用 dbo:passwordfordbo 连接到 SQL SERVER，否则它不是用户）。

通常，在 SQL Server 的美妙世界中，如果您授予 userX 执行storedprocY 的权限，那么即使他没有对 Y 中使用的所有对象的所有权限，X 也有权执行 Y 包含的所有任务。

这是将业务逻辑封装在存储过程中的一个非常有用的特性。（您的用户无权访问该表，但他们可以执行一个存储过程）。

当我们谈论“所有权链接”时，它的含义如下（如果我错了，请纠正我） - 如果所有权链接被禁用：只要所有必需的对象都在同一个数据库中，执行 procedureX 的权利就可以工作 - 的启用链接：“特权”将扩展到所有数据库。

希望有帮助，

# jquery - 使用 jQuery 使用 AJAX 发送 Excel 数据

> ID：149821
> 
> 赞同：37
> 
> 时间：2008-09-29T17:42:19.573
> 
> 标签：jquery, ajax, excel

我有以下从数据库中提取数据的函数。ajax 调用工作正常。如何将成功函数中的制表符分隔数据发送给用户？将联系类型设置为“application/vnd.ms-excel”不起作用。成功警报显示格式正确的数据。

```
 function SendToExcel() {
       $.ajax({
           type: "GET",
           url: "/Search.aspx",
           contentType: "application/vnd.ms-excel",
           dataType: "text",
           data: "{id: '" + "asdf" + "'}",
           success: function(data) {
              alert(data);
           },
           error: function (jqXHR, textStatus, errorThrown) {
              alert(jqXHR.responseText);
       }});
     } 
```

我不想在浏览器中显示数据——我想将它发送到 Excel。

**编辑：** 我找到了一种方法来做我想做的事。我没有将用户重定向到会提示他们保存/打开 Excel 文件的新页面，而是在隐藏的 iframe 中打开了该页面。这样，用户单击一个按钮，就会提示他们保存/打开一个 Excel 文件。没有页面重定向。是阿贾克斯吗？不，但它解决了我遇到的真正问题。

这是我在单击按钮时调用的函数：

```
 function SendToExcel() {
        var dataString = 'type=excel' +
            '&Number=' + $('#txtNumber').val() + 
            '&Reference=' + $('#txtReference').val()

        $("#sltCTPick option").each(function (i) {
             dataString = dataString + '&Columns=' + this.value;
        });

        top.iExcelHelper.location.href = "/Reports/JobSearchResults.aspx?" + dataString;;
     } 
```

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-09-29T17:51:37.197

AJAX 是……错误的选择。将用户重定向到服务器资源，该资源将使用正确的 MIME 类型向下发送数据，并让浏览器弄清楚如何处理它。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2010-12-15T22:26:41.480

在 HTML 中，我有一个带有串行输入元素的表单和一个调用 JavaScript 函数的按钮`onclick="exportExcel();`

* * *

然后在 JavaScript 文件中：

```
function exportExcel(){
    var inputs = $("#myForm").serialize();
    var url = '/ajaxresponse.php?select=exportExcel&'+inputs;
    location.href = url;
} 
```

最后是一个响应某事的数据透视文件

PHP代码：

```
case 'exportExcel':{
                     ob_end_clean();
                     header("Content-type: application/vnd.ms-excel");
                     header("Content-Disposition: attachment;
                     filename=exportFile.xls");
                     echo $html->List($bd->ResultSet($_GET));
                } 
```

$html 是一个处理 html 的对象，而 $bd 是一个从数据库返回数据的对象，发送你自己的 html 表或任何你想要的。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-29T17:58:08.740

由于它使用 JavaScript，AJAX 受到 JavaScript 设计限制的约束，其中包括与客户端机器上的其他进程交互。在这种情况下，这是一件好事；您不希望网站能够自动加载包含恶意宏的 Excel 文档。

如果要在浏览器中显示数据，可以使用AJAX；否则，您只需要提供一个 Excel 文档的链接，然后让浏览器的常规下载处理功能确定要做什么。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-29T23:28:35.997

您可能不想使用 javascript 执行此操作。

我认为您想要做的是使用我的类型**application/csv**创建一个响应页面，然后将用户重定向到该页面。我可能会做一个 window.open() 因为用户不会丢失他们当前所在的页面。

# c# - 访问动态添加的按钮列（在 Datagrid 中）的单击事件。C#/ASP.NET

> ID：149823
> 
> 赞同：2
> 
> 时间：2008-09-29T17:42:37.810
> 
> 标签：c#, asp.net

当我动态创建 Datagrid 并添加新的 buttoncolumn 时，如何访问 buttoncolumn_click 事件？

谢谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-29T19:32:46.813

```
protected void Page_Load(object sender, EventArgs e)
{
  DataGrid dg = new DataGrid();

  dg.GridLines = GridLines.Both;

  dg.Columns.Add(new ButtonColumn {
    CommandName = "add",
    HeaderText = "Event Details",
    Text = "Details",
    ButtonType = ButtonColumnType.PushButton
  });

  dg.DataSource = getDataTable();
  dg.DataBind();

  dg.ItemCommand += new DataGridCommandEventHandler(dg_ItemCommand);

  pnlMain.Controls.Add(dg);
}

protected void dg_ItemCommand(object source, DataGridCommandEventArgs e)
{
  if (e.CommandName == "add")
  {
    throw new Exception("add it!");
  }
}

protected DataTable getDataTable()
{
  // returns your data table
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-29T18:43:54.543

MSDN 站点上的这篇文章清楚地解释了如何[将按钮添加到数据网格](http://msdn.microsoft.com/en-us/library/aa984252(VS.71).aspx)中。您将使用 DataGrid 的命令事件，而不是使用按钮的单击事件。每个按钮都将传递您将设置的特定命令参数。

本文展示[了如何将命令事件与按钮一起使用](http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.button.command.aspx)。在其中您使用 CommandArguments 和 CommandNames。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-29T19:07:33.097

这是我创建数据网格的地方：

System.Web.UI.WebControls.DataGrid Datagridtest = new System.Web.UI.WebControls.DataGrid();

```
 Datagridtest.Width = 600;
        Datagridtest.GridLines = GridLines.Both;
        Datagridtest.CellPadding = 1;

        ButtonColumn bc = new ButtonColumn();
        bc.CommandName = "add";
        bc.HeaderText = "Event Details";
        bc.Text = "Details";
        bc.ButtonType = System.Web.UI.WebControls.ButtonColumnType.PushButton;
        Datagridtest.Columns.Add(bc);
        PlaceHolder1.Controls.Add(Datagridtest);

        Datagridtest.DataSource = dt;
        Datagridtest.DataBind(); 
```

这是我尝试使用的事件：

protected void Datagridtest_ItemCommand(object source, DataGridCommandEventArgs e) { .... }

认为这可能会有所帮助，因为我似乎根本无法捕捉到这一事件。

# apache-flex - loader.load((newSource is URLRequest)? newSource:new URLRequest(newSource)); 做？

> ID：149825
> 
> 赞同：0
> 
> 时间：2008-09-29T17:42:55.687
> 
> 标签：apache-flex, flash, actionscript-3

[我从他的 Book 组件中遇到了Ely Greenfield 的](http://www.quietlyscheming.com/blog/)SuperImage中的以下代码- 我理解 loader.load() 但其余部分是做什么的？

```
loader.load((newSource is URLRequest)? newSource:new URLRequest(newSource)); 
```

它看起来像是某种疯狂的内联 if 语句，但我还是有点困惑。如果它是一个 if 语句 - 这种方式是否比常规 if 语句更好？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-09-29T17:53:17.347

? 被称为“三元运算符”，它的基本用途是：

```
(expression) ? (evaluate to this if expression is true) : (evaluate to this otherwise); 
```

在这种情况下，如果 newSource 是 URLRequest，则 loader.load 将直接传递 newSource，否则将传递从 newSource 构建的新 URLRequest。

三元运算符经常用作 if 语句的更简洁形式，因为它允许内联 if。在这种情况下，相应的代码将是：

```
if (newSource is URLRequest)
   loader.load(newSource);
else
   loader.load(new URLRequest(newSource)); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-29T17:50:26.373

基本上它说的是：如果 newsource 是 URLRequest 的一种类型，则将 newSource 变量传递给 load 方法，如果它不是 URLReuqest 的类型，则创建一个新的 URLRequest 并将其传递给 load 方法。

基本语法是：（条件）？（如果为真则执行的代码）：（如果为假则执行的代码）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-29T17:48:59.120

这是使用[三元 ?: 运算符](http://en.wikipedia.org/wiki/%3F:)。第一部分是条件，在 ? 和 : 是条件为真时返回的内容。: 之后是条件为假时返回的内容。

一个更简单的例子

```
String str = null;
int x = (str != null) ? str.length() : 0; 
```

将与

```
String str = null;
int x;
if (str != null)
  x = str.length()
else
  x = 0; 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-26T23:17:14.143

基本上，据我所知，这意味着它询问变量 newSource 的类是 String 还是 URLRequest，就像 workmad 和 jason 解释的那样。如果它是一个 URLRequest，它将***运行 loader.load(newSource:URLRequest)***。如果它不是 URLRequest，则自动意味着它是一个字符串（也就是 url）。在这种情况下，它将运行***loader.load(new URLrequest(newSource:String)***。

完整的代码可能如下所示：

```
function myFunction(newSource:Object):SomeClass {
var loader:URLLoader = new URLLoader();
loader.load((newSource is URLRequest)? newSource:new URLRequest(newSource));
} 
```

问候，

菲利普·A。

# macos - OSX 上应用程序的首选路径？

> ID：149827
> 
> 赞同：4
> 
> 时间：2008-09-29T17:43:34.877
> 
> 标签：macos, text-editor

我希望能够从我的应用程序运行文本编辑器，正如用户在 TEXT_EDITOR 环境变量中给出的那样。现在，假设该变量中没有任何内容，我想默认使用 OSX 附带的 TextEdit 程序。将 /Applications/TextEdit.app/Contents/MacOS/TextEdit 硬编码到我的应用程序中是否符合规定，还是有更好的方法来调用该程序？

编辑：为了记录，我仅限于在 C 中运行特定的应用程序路径。我没有打开文本文件的路径。

编辑2：说真的，我不是在这里打开文件。我问一个应用程序路径是有原因的。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-29T18:03:06.590

Mac OS X 有一种称为“统一类型标识符”的机制，用于跟踪数据类型和可以处理它们的应用程序之间的关联。管理它的子系统是 Launch Services。您可以执行以下两项操作之一：

*   如果您有一个具有相当知名的路径扩展名的文件，例如`.txt`，您可以只要求`NSWorkspace`在适当的应用程序中打开该文件。

*   如果您没有众所周知的路径扩展名，但您知道数据的类型，则可以要求 Launch Services 查找该类型的默认应用程序，然后要求`NSWorkspace`在该特定应用程序中打开文件。

如果您这样做，您将获得与 Finder 相同的行为，并且您不必 fork()/exec() 或使用 system() 来打开文件。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-29T22:31:37.193

在您的第二次编辑中，听起来您只想获取 TextEdit 的路径，这可以通过使用 NSWorkspace 方法 absolutePathForAppBundleWithIdentifier 轻松完成：

```
NSString *path = [[NSWorkspace sharedWorkspace] absolutePathForAppBundleWithIdentifier:@"com.apple.TextEdit"]; 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-29T17:53:52.730

我相信如果用户的语言设置不是英语，硬编码“应用程序”将不起作用。例如，在 Norsk 中，“Applications”文件夹被命名为“Programmer”。

关于国际化的 Apple 文档在[此处](http://developer.apple.com/documentation/MacOSX/Conceptual/BPInternational/BPInternational.pdf)。从第 45 页开始是处理本地化路径名的部分。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-29T17:48:40.823

我相信 Mac OS X 提供了默认的应用程序机制，因此 .txt 将在 TextEdit.app 或 Emacs 或 GVim 或用户指定的任何内容中打开。但是我在网上找不到任何东西。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2008-09-29T17:53:15.490

您可以从您的应用程序运行以下命令：

```
open <full path to text file> 
```

这将在默认文本编辑器中打开文本文件。`open`您可以使用命令打开任何文件类型。

# javascript - 当您使用 javascript 填充需要子元素的元素时，如何编写有效的 XHTML 1.0 Strict 代码？

> ID：149844
> 
> 赞同：0
> 
> 时间：2008-09-29T17:48:23.523
> 
> 标签：javascript, validation, twitter, w3c-validation, xhtml-1.0-strict

我正在通过 W3C 的验证器运行我的网站，试图让它验证为 XHTML 1.0 Strict，但我遇到了一个特别棘手的（至少在我的经验中）验证错误。我在网站中包含来自各种服务的某些徽章，这些服务提供自己的 API 和代码以包含在外部网站上。这些徽章（大部分情况下）使用 javascript 来填充您在需要子元素的标记中插入的元素。这意味着最终会生成完全有效的标记，但对于验证器来说，它所看到的只是一个不完整的父子标签，然后它会抛出一个错误。

作为一个警告，我知道我可以向他们的徽章不验证的服务投诉。没有这个，我假设有人已经验证了他们的代码，同时包含了这样的徽章，这就是我感兴趣的。诸如“向 Flickr 投诉他们的徽章”之类的答案对我没有多大帮助。

另一个警告：我希望标记尽可能保持语义。IE 添加一个空的 li 标记或 tr-td 对以使其验证将是一个*不受欢迎*的解决方案，即使它可能是必要的。如果这是唯一可以验证的方法，那么好吧，但请把答案倾向于语义标记。

举个例子：

```
<div id="twitter_div">
<h2><a href="http://twitter.com/stopsineman">@Twitter</a></h2>
<ul id="twitter_update_list">
<script type="text/javascript" src="http://twitter.com/javascripts/blogger.js"></script>
<script type="text/javascript" src="http://twitter.com/statuses/user_timeline/stopsineman.json?callback=twitterCallback2&amp;count=1"></script>
</ul>
</div> 
```

注意包装 javascript 的 ul 标签。这最终会通过脚本用 lis 填充，但对于验证器来说，它只看到未填充的 ul。

提前致谢！

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-29T19:20:56.577

以下片段是有效的 XHTML 并且可以完成这项工作：

```
<div id="twitter_div">
    <h2 class="twitter-title"><a href="http://twitter.com/stopsineman" title="Tim's Twitter Page.">Twitter Updates</a></h2>
    <div id="myDiv" />
</div> 

<script type="text/javascript">
    var placeHolderNode = document.getElementById("myDiv");
    var parentNode = placeHolderNode.parentNode;
    var insertedNode = document.createElement("ul");
    insertedNode .setAttribute("id", "twitter_update_list");
    parentNode.insertBefore( insertedNode, placeHolderNode);
    parentNode.remove(placeHolderNode);
</script>
<script type="text/javascript" src="http://twitter.com/javascripts/blogger.js"></script>
<script type="text/javascript" src="http://twitter.com/statuses/user_timeline/stopsineman.json?callback=twitterCallback2&amp;count=5"></script> 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-29T18:44:20.563

也许您可以使用 javascript 编写初始徽章 HTML？如果可以使用 javascript 来填充它，您可能只希望将徽章代码插入到您的文档中，对吗？

您只需要确保您的文档编写发生在您的各种徽章的 javascript 之前。

您能否举一个带有无效代码的页面的 HTML / 链接的具体示例？

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-29T19:27:05.093

每个徽章的解决方案可能不同。在 Twitter 的情况下，您可以编写自己的回调函数。这是一个基于他们的徽章代码的示例：

```
<div id="twitter_div">
  <h2><a href="http://twitter.com/stopsineman">@Twitter</a></h2>
  <div id="twitter_update_list"></div>
</div>

<script type="text/javascript">
function updateTwitterCallback(obj)
{
  var twitters = obj;
  var statusHTML = "";
  var username = "";
  for (var i = 0; i < twitters.length; i++)
  {
    username = twitters[i].user.screen_name;
    statusHTML += ('<li><span>' + twitters[i].text + '</span> <a style="font-size:85%" href="http://twitter.com/' + username + '/statuses/' + twitters[i].id + '">' + relative_time(twitters[i].created_at) + '</a></li>');
  }
  document.getElementById('twitter_update_list').innerHTML = '<ul>' + statusHTML + '</ul>';
}
</script>
<script type="text/javascript" src="http://twitter.com/javascripts/blogger.js"></script>
<script type="text/javascript" src="http://twitter.com/statuses/user_timeline/stopsineman.json?callback=updateTwitterCallback&amp;count=1"></script> 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-06-13T00:22:29.140

我在 <ul> 标签中放了一个带有“display:none”的 <li>：

```
<ul id="twitter_update_list"><li style="display:none;">A</li></ul>

<script type="text/javascript" src="http://twitter.com/javascripts/blogger.js"></script>
<script type="text/javascript" src="http://twitter.com/statuses/user_timeline/01241.json?callback=twitterCallback2&amp;count=1"></script> 
```

这不会干扰脚本，在这种情况下它可以工作，我认为这不是一个“*不受欢迎*的解决方案”:)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-29T18:50:03.797

在某些时候页面变得有效，对吗？只有这样才能真正得到验证。

如果一个重要的页面是用大量 DOM 脚本构建的，我不确定它在构建过程中的每一点是否都有效。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-29T18:56:46.307

这可能不是关于这个话题最流行的观点，但是......

不用担心 100% 的验证。这没什么大不了的。

验证的重点是使您的标记尽可能标准。为什么？因为给定不符合规范的标记（例如，不验证的标记）的浏览器会进行自己的错误检查以更正它并以您希望用户看到的方式显示页面。浏览器错误检查的质量各不相同，yadda-yadda-yadda，最好有有效的标记......但甚至不是你的代码导致验证失败！编写这些徽章的人可能会在多个浏览器中对其进行测试（当然，您也应该这样做），如果它们按预期工作，那么就这样吧。

简而言之，验证没有奖品:)

# security - 经典 ASP SQL 注入保护

> ID：149848
> 
> 赞同：36
> 
> 时间：2008-09-29T17:49:01.353
> 
> 标签：security, ms-access, asp-classic, sql-injection

什么是防止经典 asp 应用程序的 sql 注入的有效方法？

仅供参考，我将它与访问数据库一起使用。（我没有写应用程序）

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2008-09-29T17:50:34.297

存储过程和/或准备好的语句：

[https://stackoverflow.com/questions/1973/what-is-the-best-way-to-avoid-sql-injection-attacks](https://stackoverflow.com/questions/1973/what-is-the-best-way-to-avoid-sql-injection-attacks)

[我可以通过转义单引号和用单引号包围用户输入来防止 SQL 注入吗？](https://stackoverflow.com/questions/139199/can-i-protect-against-sql-injection-by-escaping-single-quote-and-surrounding-us)

[捕获 SQL 注入和其他恶意 Web 请求](https://stackoverflow.com/questions/1284/catching-sql-injection-and-other-malicious-web-requests)

使用 Access DB，您仍然可以做到这一点，但如果您已经担心 SQL 注入，我认为您无论如何都需要离开 Access。

这是 Access 中技术的链接：

[http://www.asp101.com/samples/storedqueries.asp](http://www.asp101.com/samples/storedqueries.asp)

请注意，通常防止注入的不是存储过程本身，而是它是参数化的而不是动态的这一事实。请记住，即使构建动态代码的 SP 如果以某些方式使用参数来构建动态代码，也可能容易受到注入攻击。总的来说，我更喜欢 SP，因为它们形成了应用程序访问数据库的接口层，因此应用程序甚至不允许首先执行任意代码。

此外，如果不使用命令和参数，存储过程的执行点可能会受到攻击，例如，这仍然很容易受到攻击，因为它是动态构建的并且可以成为注入目标：

```
Conn.Execute("EXEC usp_ImOnlySafeIfYouCallMeRight '" + param1 + "', '" + param2 + "'") ; 
```

请记住，您的数据库需要保护自己的边界，并且如果各种登录都有权访问`INSERT/UPDATE/DELETE`表，那么这些应用程序（或受感染的应用程序）中的任何代码都可能成为潜在问题。如果登录仅有权执行存储过程，这将形成一个漏斗，您可以通过它更轻松地确保正确的行为。（类似于 OO 概念，其中对象负责其接口并且不公开其所有内部工作。）

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2011-08-09T11:59:34.673

这是我很久以前制作的几个 sqlinject 脚本，一个简单版本和一个扩展版本：

```
function SQLInject(strWords) 
dim badChars, newChars, i
badChars = array("select", "drop", ";", "--", "insert", "delete", "xp_") 
newChars = strWords 
for i = 0 to uBound(badChars) 
newChars = replace(newChars, badChars(i), "") 
next 
newChars = newChars 
newChars= replace(newChars, "'", "''")
newChars= replace(newChars, " ", "")
newChars= replace(newChars, "'", "|")
newChars= replace(newChars, "|", "''")
newChars= replace(newChars, "\""", "|")
newChars= replace(newChars, "|", "''")
SQLInject=newChars
end function 

function SQLInject2(strWords)
dim badChars, newChars, tmpChars, regEx, i
badChars = array( _
"select(.*)(from|with|by){1}", "insert(.*)(into|values){1}", "update(.*)set", "delete(.*)(from|with){1}", _
"drop(.*)(from|aggre|role|assem|key|cert|cont|credential|data|endpoint|event|f ulltext|function|index|login|type|schema|procedure|que|remote|role|route|sign| stat|syno|table|trigger|user|view|xml){1}", _
"alter(.*)(application|assem|key|author|cert|credential|data|endpoint|fulltext |function|index|login|type|schema|procedure|que|remote|role|route|serv|table|u ser|view|xml){1}", _
"xp_", "sp_", "restore\s", "grant\s", "revoke\s", _
"dbcc", "dump", "use\s", "set\s", "truncate\s", "backup\s", _
"load\s", "save\s", "shutdown", "cast(.*)\(", "convert(.*)\(", "execute\s", _
"updatetext", "writetext", "reconfigure", _
"/\*", "\*/", ";", "\-\-", "\[", "\]", "char(.*)\(", "nchar(.*)\(") 
newChars = strWords
for i = 0 to uBound(badChars)
Set regEx = New RegExp
regEx.Pattern = badChars(i)
regEx.IgnoreCase = True
regEx.Global = True
newChars = regEx.Replace(newChars, "")
Set regEx = nothing
next
newChars = replace(newChars, "'", "''")
SqlInject2 = newChars
end function 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-29T17:50:54.997

使用参数化查询，您需要创建一个命令对象，为它分配一个名称和一个值的参数，如果这样做，您就不需要担心其他任何事情（当然是指 sql 注入；））

[http://prepared-statement.blogspot.com/2006/02/asp-prepared-statements.html](http://prepared-statement.blogspot.com/2006/02/asp-prepared-statements.html)

并且不要相信存储过程，如果您不使用准备好的语句，它们也可能成为攻击媒介。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-10-04T19:34:23.013

“为经典的 asp 应用程序防止 sql 注入的一种强有力的方法”是无情地验证所有输入。时期。

单独的存储过程和/或不同的数据库系统不一定等同于良好的安全性。

MS 最近推出了一个 SQL 注入检查工具，用于查找查询中使用的未经验证的输入。这就是你应该寻找的。

这是链接： [Microsoft Source Code Analyzer for SQL Injection 工具可用于查找 ASP 代码中的 SQL 注入漏洞](http://support.microsoft.com/kb/954476)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-29T19:44:05.867

如果存储过程不是一个选项 - 即使它们是 -**彻底验证所有输入**

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2011-02-21T21:51:53.910

嘿，任何数据库都和使用它的开发人员一样好。

不多也不少。

如果您是优秀的开发人员，您可以使用文本文件作为数据库来构建电子商务站点。是的，它不会像 Oracle 驱动的网站那么好，但对于像家庭定制珠宝制造这样的小型企业来说，它会做得很好。

如果您是优秀的开发人员，您将不会在您的 ASP 页面上使用内联 SQL 语句。即使在 Access 中，您也可以选择构建和使用查询。

带有数据验证的存储过程以及 html 编码 - 是防止任何 SQL 注入攻击的最佳方法。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-07-21T10:01:31.750

[Microsoft Source Code Analyzer for SQL Injection 工具](http://support.microsoft.com/kb/954476)可用于查找 ASP 代码中的 SQL 注入漏洞

* * *

## 回答 #8

> 赞同：-2
> 
> 时间：2008-09-29T19:49:05.103

至少切换到 SQL Express 是一个不错的选择。这将使事情更加安全。即使使用参数和存储过程可以提供很大帮助。我还建议您仔细验证输入以确保它们符合您的预期。

对于像数字这样的值，提取数字以验证它确实只是一个数字是相当容易的。转义 SQL 的所有特殊字符。这样做可以防止尝试的攻击起作用。

# .net - .NET 记录客户端上的 Soap 请求

> ID：149851
> 
> 赞同：7
> 
> 时间：2008-09-29T17:49:47.560
> 
> 标签：.net, web-services, logging, .net-2.0

我在我的客户端应用程序中使用第三方 .NET WebService。出于调试目的，我想捕获从我的服务器发送的 SOAP 请求。我该怎么做呢？这是在不使用 WCF 或 WSE 的情况下在 .NET 2.0 上完成的。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2010-11-24T16:16:20.037

不久前，我写了一篇关于此的文章，标题为“[在 .NET 中记录 SOAP 消息](http://desalasworks.com/logging-soap-messages-in-net/)”。

最简单的方法是**使用 .NET 已经提供的工具**。

**1.**扩展类**`SoapExtension`**。

**2.**覆盖**`ProcessMessage`**获取 Soap 请求的完整输出的方法，然后将此信息输出到文本文件或事件日志。

```
public class SoapMessageLogger : SoapExtension
{
  //…
  public override void ProcessMessage(SoapMessage message)
  {
    switch(message.Stage)
    {
      case SoapMessageStage.BeforeDeserialize:
        LogResponse(message);
        break;
      case SoapMessageStage.AfterSerialize:
        LogResponse(message);
        break;
      // Do nothing on other states
      case SoapMessageStage.AfterDeserialize:
      case SoapMessageStage.BeforeSerialize:
      default:
        break;
    }
  }
  //…
} 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-29T17:56:05.187

如果出于调试目的，我只需将 Web 请求配置为使用代理并通过提琴手（[http://www.fiddlertool.com](http://www.fiddlertool.com)）发送整个请求，那么您可以准确地看到通过网络传输的内容。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-29T18:42:28.417

您可以使用许多选项。当然有一些商业工具（如 SOAPScope），但如果您只是想捕获请求/响应的原始内容，除了 Fiddler（Walden 已经提到过）之外，还有其他一些工具。

[就个人而言，我一直是 Simon Fell 的TcpTrace](http://www.pocketsoap.com/tcptrace/)和[YATT](http://www.pocketsoap.com/yatt/)的长期用户。

如果您对实际检测代码感兴趣，以便它可以自行完成（例如，通过将所有内容记录到文件或其他内容），那么您可能希望考虑在您的服务器上实现[SoapExtension 。](http://msdn.microsoft.com/en-us/library/system.web.services.protocols.soapextension.aspx)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-29T18:44:56.817

您可以使用 SoapExtension 记录 Soap 调用。

[http://msdn.microsoft.com/en-us/magazine/cc164007.aspx](http://msdn.microsoft.com/en-us/magazine/cc164007.aspx)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-19T13:37:46.100

我过去使用[过 Web 服务、SOA 和 SOAP 测试工具 - soapUI](http://www.soapui.org/)并取得了很好的成功。

-Edoode

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-10-18T13:55:49.127

也许是**wireshark**？我一直使用它来捕获我的应用程序的流量。

# linux - 配置文件程序在 Linux 上的速度

> ID：149852
> 
> 赞同：1
> 
> 时间：2008-09-29T17:50:17.433
> 
> 标签：linux, performance, profiling

我有几个我想比较性能的程序变体。两者都执行基本相同的任务。

一个人在 C 和内存中完成所有工作。另一个调用外部实用程序并执行文件 IO。

我如何可靠地比较它们？

1) 使用“时间”获取“CPU 时间”有利于调用 system() 和执行 IO 的第二种变体。即使我将“系统”时间添加到“用户”时间，它仍然不会计算在 wait() 上阻塞的时间。

2) 我不能只为它们计时，因为它们在服务器上运行，并且可以随时从 CPU 上推出。平均 1000 次实验是一个软选项，因为我不知道我的服务器是如何使用的——它是集群上的虚拟机，有点复杂。

3）分析器没有帮助，因为它们会给我时间花在代码上，这再次有利于执行 system() 的版本

我需要将这些程序消耗的所有 CPU 时间累加起来，包括用户、内核、IO 和孩子的递归时间。

我预计这是一个常见问题，但似乎仍然没有找到解决方案。

（用 times() 解决 - 见下文。谢谢大家）

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-29T17:57:46.683

如果我理解的话，在 bash 命令行上键入“time myapplication”并不是您想要的。

如果你想要准确性，你必须使用分析器......你有来源，是吗？

试试[Oprofile](http://oprofile.sourceforge.net/news/)或[Valgrind](http://valgrind.org/)之类的东西，或者看看[这个](http://en.wikipedia.org/wiki/List_of_performance_analysis_tools)以获得更多扩展列表。

如果你没有来源，老实说我不知道​​......

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-29T19:22:29.333

/usr/bin/time（不是 bash 中内置的“时间”）可以提供一些有趣的统计信息。

```
$ /usr/bin/time -v xeyes
    正在计时的命令：“xeyes”
    用户时间（秒）：0.00
    系统时间（秒）：0.01
    此作业获得的 CPU 百分比：0%
    经过（挂钟）时间（h:mm:ss 或 m:ss）：0:04.57
    平均共享文本大小（千字节）：0
    平均非共享数据大小（千字节）：0
    平均堆栈大小（千字节）：0
    平均总大小（千字节）：0
    最大驻留集大小（kbytes）：0
    平均驻留集大小（kbytes）：0
    主要（需要 I/O）页面错误：9
    次要（回收帧）页面错误：517
    自愿上下文切换：243
    非自愿上下文切换：0
    掉期：0
    文件系统输入：1072
    文件系统输出：0
    发送的套接字消息：0
    收到的套接字消息：0
    传递的信号：0
    页面大小（字节）：4096
    退出状态：0

```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-29T17:58:59.330

运行一千次，测量实际花费的时间，然后平均结果。这应该可以消除由于服务器上运行的其他应用程序造成的任何差异。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-01T09:43:29.257

我好像终于找到了。

NAME 时间 - 获取处理时间

概要#包括

```
 clock_t times(struct tms *buf); 
```

描述 times() 将当前进程时间存储在 buf 指向的 struct tms 中。结构 tms 定义如下：

```
 struct tms {
          clock_t tms_utime;  /* user time */
          clock_t tms_stime;  /* system time */
          clock_t tms_cutime; /* user time of children */
          clock_t tms_cstime; /* system time of children */
   }; 
```

孩子们的时间是所有等待孩子的递归总和。

我想知道为什么它还没有成为标准的 CLI 实用程序。或者我可能只是无知。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-29T18:05:46.803

我可能倾向于将“time -o somefile”添加到系统命令的前面，然后将其添加到 time'ing 主程序给出的时间中以获得总数。除非我必须多次这样做，否则我会找到一种方法来获取两次输出并将它们添加到屏幕上（使用 awk 或 shell 或 perl 或其他东西）。

# c - 当文件流没有新数据时如何防止 fgets 阻塞

> ID：149860
> 
> 赞同：14
> 
> 时间：2008-09-29T17:51:47.553
> 
> 标签：c, popen, fgets

我有一个`popen()`执行`tail -f sometextfile`. 只要文件流中有数据，显然我可以通过`fgets()`. 现在，如果没有来自尾部的新数据，则`fgets()`挂起。我试过了`ferror()`，`feof()`但无济于事。当文件流中没有新内容时，如何确保`fgets()`不尝试读取数据？

其中一个建议是`select()`。由于这适用于 Windows 平台，因此选择似乎不起作用，因为匿名管道似乎不适用于它（请参阅[这篇文章](https://stackoverflow.com/questions/152807/what-is-wrong-with-this-popen-select-example "这个帖子")）。

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2008-09-29T18:19:29.127

在 Linux（或任何 Unix-y 操作系统）中，您可以将 popen() 使用的底层文件描述符标记为非阻塞。

```
#include <fcntl.h>

FILE *proc = popen("tail -f /tmp/test.txt", "r");
int fd = fileno(proc);

int flags;
flags = fcntl(fd, F_GETFL, 0);
flags |= O_NONBLOCK;
fcntl(fd, F_SETFL, flags); 
```

如果没有可用的输入，fgets 将返回 NULL，并将 errno 设置为 EWOULDBLOCK。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2008-09-29T17:57:34.467

`fgets()`是阻塞读取，如果没有数据，它应该等到数据可用。

您需要使用 、 或 来执行异步 I `select()`/ `poll()`O `epoll()`。然后在有可用数据时从文件描述符中执行读取。

这些函数使用句柄的文件描述符`FILE*`，通过以下方式检索：`int fd = fileno(f);`

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-01T14:44:14.930

我通过使用线程解决了我的问题，特别[`_beginthread`是`_beginthreadex`](https://docs.microsoft.com/en-us/cpp/c-runtime-library/reference/beginthread-beginthreadex)。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-29T17:55:13.287

我会为 IO 使用 POSIX 函数而不是 C 库的函数，你可以使用[select](http://linux.die.net/man/2/select)或[poll](http://linux.die.net/man/2/pol)。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-29T17:55:49.650

您可以尝试使用低级 IO 函数（open()、read() 等）读取 sometextfile，就像 tail 本身一样。当没有更多要读取的内容时，read() 返回零，但下次仍会尝试读取更多内容，这与 FILE* 函数不同。

# c - ANSI C 是否支持有符号/无符号位域？

> ID：149869
> 
> 赞同：15
> 
> 时间：2008-09-29T17:53:25.820
> 
> 标签：c, struct, bit-fields

将位字段限定为有符号/无符号是否有意义？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-09-29T18:11:16.383

标准的相关部分 (ISO/IEC 9899:1999) 是 6.7.2.1 #4：

> 位域的类型应为 _Bool、signed int、unsigned int 或其他一些实现定义的类型的合格或非合格版本。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-09-29T18:11:42.857

是的。[这里](http://publications.gbdirect.co.uk/c_book/chapter6/bitfields.html)的一个例子：

```
struct {
  /* field 4 bits wide */
  unsigned field1 :4;
  /*
   * unnamed 3 bit field
   * unnamed fields allow for padding
   */
  unsigned        :3;
  /*
   * one-bit field
   * can only be 0 or -1 in two's complement!
   */
  signed field2   :1;
  /* align next field on a storage unit */
  unsigned        :0;
  unsigned field3 :6;
}full_of_fields; 
```

只有您知道它在您的项目中是否有意义；通常，如果字段可以有意义地为负，则它适用于具有多于一位的字段。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-10-28T18:41:14.617

将变量限定为有符号或无符号非常重要。编译器需要知道如何在比较和强制转换期间处理变量。检查此代码的输出：

```
#include <stdio.h>

typedef struct
{
    signed s : 1;
    unsigned u : 1;
} BitStruct;

int main(void)
{
    BitStruct x;

    x.s = 1;
    x.u = 1;

    printf("s: %d \t u: %d\r\n", x.s, x.u);
    printf("s>0: %d \t u>0: %d\r\n", x.s > 0, x.u > 0);

    return 0;
} 
```

输出：

```
s: -1    u: 1
s>0: 0   u>0: 1 
```

编译器使用单个位 1 或 0 存储变量。对于有符号变量，最高有效位确定符号（高位被视为负数）。因此，带符号的变量，虽然它以二进制形式存储为 1，但它被解释为负值。

扩展此主题，无符号两位数的范围为 0 到 3，而有符号两位数的范围为 -2 到 1。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-29T18:00:38.330

我不认为安德鲁在谈论单比特位域。例如，4 位字段：3 位数字信息，1 位符号。这完全是有道理的，尽管我承认无法在我的脑海中想出这样的场景。

更新：我并不是说我想不出多位位字段的用途（在 2400bps 调制解调器时代一直使用它们来尽可能地压缩数据以进行传输），但我想不出有符号位字段的用途，尤其是不是一个古怪的、明显的，对读者来说将是一个“啊哈”的时刻。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-29T18:05:54.853

是的，它可以。C 位域本质上只是有限范围的整数。硬件接口经常将位打包在一起，使得某些控制可以从 -8 到 7，在这种情况下您确实需要一个有符号位字段，或者从 0 到 15，在这种情况下您需要一个无符号位 -场地。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2011-01-04T01:51:01.357

最肯定的是 ANSI-C 提供有符号和无符号位字段。这是必需的。这也是为 IEEE-754 浮点类型 [[1][5][10]]、[[1][8][23]] 和 [[1][10][53] 编写调试器覆盖的一部分]。这在此类数据的机器类型或网络转换中很有用，或者在通过链接发送之前检查双精度（数学为 64 位）到半精度（压缩为 16 位）的转换，例如视频卡纹理。

```
// Fields need to be reordered based on machine/compiler endian orientation

typedef union _DebugFloat {
   float f;
   unsigned long u;
   struct _Fields {
        signed   s :  1;
        unsigned e :  8;
        unsigned m : 23;
      } fields; 
   } DebugFloat; 
```

埃里克

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2012-01-18T16:46:14.507

有符号位域有用的一个地方是在仿真中，其中仿真机器的位数少于您的默认字。

我目前正在考虑模拟 48 位机器，并试图通过位域从 64 位“long long”中使用 48 位是否合理......生成的代码将与我相同做了所有的屏蔽，符号扩展等，但它会读起来更好......

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-29T18:14:47.123

根据这个参考，有可能： http:
[//publib.boulder.ibm.com/infocenter/macxhelp/v6v81/index.jsp ?topic=/com.ibm.vacpp6m.doc/language/ref/clrc03defbitf.htm](http://publib.boulder.ibm.com/infocenter/macxhelp/v6v81/index.jsp?topic=/com.ibm.vacpp6m.doc/language/ref/clrc03defbitf.htm)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-07-30T19:47:39.020

位掩码签名类型因平台硬件而异，这取决于它如何处理移位溢出等。

任何半好 QA 工具都会故意警告这种用法。

* * *

## 回答 #10

> 赞同：-4
> 
> 时间：2008-09-29T17:58:41.483

如果一个“位”被签名，那么你的范围是-1、0、1，然后变成一个三进制数字。我认为标准缩写在这里不合适，但可以进行有趣的对话:)

# database - 如何设计交付数据的事实表

> ID：149871
> 
> 赞同：0
> 
> 时间：2008-09-29T17:54:00.467
> 
> 标签：database, database-design, data-warehouse, olap

我正在构建一个数据仓库，其中包含餐厅的送货信息。数据存储在 SQL Server 2005 中，然后放入 SQL Server Analysis Services 2005 多维数据集。

交付信息由下表组成：

**事实交付**

*   分支键
*   交货日期密钥
*   产品密钥
*   InvoiceNumber（DD：退化维度）
*   数量
*   单位成本
*   线路成本

**笔记：**

*   FactDeliveres 的粒度是发票上的每一行
*   产品维度包括供应商信息

**问题**是：事实表没有主键。主键应该是唯一标识每个交付加上 ProductKey 的东西。但是我没有办法唯一标识一个交付。

在源 OLTP 数据库中，有一个 DeliveryID，对于每个交付都是唯一的，但这是一个对用户没有意义的内部 ID。InvoiceNumber 是供应商的发票编号——这是手动输入的，所以我们得到了重复。

在多维数据集中，我仅基于 FactDeliveres 中的 InvoiceNumber 字段创建了一个维度。这确实意味着，当您按 InvoiceNumber 分组时，您可能会合并 2 个交付，只是因为它们（错误地）具有相同的 InvoiceNumber。

我觉得我需要包含 DeliveryID（称为 DeliveryKey），但我不确定如何。

**我也是：**

1.  将其用作 InvoiceNumber 维度的基础键？
2.  创建一个每次有新交付时都会增长的 DimDelivery？这可能意味着某些属性来自 FactDeliveries 并进入 DimDelivery，例如 DeliveryDate、Supplier、InvoiceNumber。

毕竟，我只能问你：当我的源数据库中有以下信息时，我如何创建一个 Deliveries 多维数据集

**DeliveryHeaders**

*   DeliveryID (PK)
*   交货日期
*   供应商 ID (FK)
*   发票号码（手动输入）

**交货详情**

*   DeliveryID (PK)
*   产品 ID (PK)
*   数量
*   单位成本

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-29T18:11:48.287

我会在事实表中包含 Quantity、UnitCode、InvoiceNumber、DeliveryID。InvoiceNumber 和 DeliveryID 都是退化维度，因为它们会随着每个事实（或很少的事实）而改变。如果每个订单上有大量商品，您可以将它们放在自己的维度中。如果您在一张发票上有多个交货，下面的模型可能不是 100% 正确，但它会很接近。查看 Kimball，他可能有此业务场景的星型模式示例。

```
Fact table:
OrderDateID (not in your model, but probably should be, date dimension in a role)
DeliveryDateID (date dimension in a role)
SupplierID (supplier dimension surrogate key)
InvoiceID (invoice dimension surrogate key)
ProductID (product dimension surrogate key)
Quantity (fact)
UnitCost (fact)
InvoiceNumber (optional)
DeliveryID (optional) 
```

使用通常的日期维度表和以下维度：

```
Supplier Dim:
SupplierID (surrogate)
SupplierCode and data

Invoice Dim:
InvoiceID (surrogate)
InvoiceNumber (optional)
DeliveryID (optional)

Product Dim:
ProductID (surrogate)
ProductCode and Data 
```

永远记住，您的（星型模式）数据仓库根本不会像您的 OLTP 数据那样结构化 - 它完全取决于事实以及描述它们的维度。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-29T19:42:18.880

事实表 PK 几乎总是代理键。每个事实都是几个维度的一部分，因此事实对维度有 FK，但没有自己的真正键。

交付事实（行项目）属于一个分支，它有一个产品，它是更大交付的一部分，它发生在特定日期。听起来像 4 个独立的维度。

Delivery维度有自己的PK，并且有发票号的维度属性。另外，也许还有整体交付的其他属性。

每个交货行项目事实与一个交货和该交货的发票编号相关联。

# jsp - 使用 JSF 重定向和 WebTrends 的问题

> ID：149874
> 
> 赞同：0
> 
> 时间：2008-09-29T17:55:03.117
> 
> 标签：jsp, jsf, webtrends

在我们的新平台上，我们正在使用 JSF。我们的 WebTrends 标签未反映此平台上的正确页面标题。它目前正在显示用户上一页而不是当前页的名称。

我们正在使用 JSF 导航规则，其中有一些“<redirect />”标签。

有没有人遇到过这种情况，有没有解决办法。我建议我们从这个模型中移出一条路，仍然使用 JSF 但不使用导航规则。

谢谢

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-09-29T20:20:44.497

我们通过使用 webtrends javascript API 将正确的页面标题注入页面（而不是依靠 javascript 从页面中读取正确的 URL）来解决了这个问题。由于 JSF 会处理您的 URL，因此您确实无能为力。

重定向标签将起作用，但您必须注意托管 bean 的逻辑，因为它破坏了请求范围。

# sql-server-2005 - 如何在 SQL Server 2005 数据库之间传输 sql 加密数据？

> ID：149876
> 
> 赞同：7
> 
> 时间：2008-09-29T17:55:16.437
> 
> 标签：sql-server-2005, encryption

我有一个现有的 SQL Server 2005 数据库，其中包含使用对称密钥加密的数据。对称密钥是使用密码打开的。我正在升级使用该数据库的前端应用程序，其中包括添加数十个新表、存储过程、UDF 等，并对现有表和数据库对象进行数十次修改。为此，我正在制作现有开发数据库的副本，以便在进行新开发时可以独立支持、维护和更新当前系统。

复制数据库的好方法是什么？通常，我会备份现有数据库，然后将其还原到新数据库。但是，考虑到加密数据，这是否可行？我是否仍然能够使用现有的对称密钥和密码加密和解密新数据库中的数据？

我是否只想使用 DTS 仅传输现有架构。在新数据库中创建一个新的对称密钥/密码。然后编写临时查询以传输数据，使用现有密钥/密码解密，并使用新数据库中的新密钥/密码加密。

我想这的核心是，对称密钥是否适合在单个数据库或同一服务器上的多个数据库中加密/解密数据？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-30T02:30:38.027

您所指的对称密钥是数据库主密钥 (DMK)。它们保存在数据库级别，因此到另一个 SQL 服务器的备份/恢复应该可以正常工作（注意不同的服务帐户，这个[线程](http://www.derkeiler.com/Newsgroups/microsoft.public.sqlserver.security/2006-01/msg00138.html)暗示）

在你做任何事情之前确保你有你的密钥的备份（大概你已经这样做了）：

```
USE myDB
GO
BACKUP MASTER KEY TO FILE = 'path_to_file'
    ENCRYPTION BY PASSWORD = 'password'
GO 
```

从这篇[文章](http://www.sqlservercentral.com/articles/SQL+Server+2005+-+Security/sql2005symmetricencryption/2291/)：

> 创建数据库主密钥时，副本会使用提供的密码加密并存储在当前数据库中。副本也使用服务主密钥加密并存储在主数据库中。DMK 的副本允许服务器自动解密 DMK，这一功能称为“自动密钥管理”。如果没有自动密钥管理，您必须使用 OPEN MASTER KEY 语句并在每次您希望使用依赖 DMK 以确保安全的证书和密钥加密和/或解密数据时提供密码。使用自动密钥管理，不需要 OPEN MASTER KEY 语句和密码。

# asp.net - 如何分析 ADO.NET 连接池？

> ID：149877
> 
> 赞同：2
> 
> 时间：2008-09-29T17:55:40.807
> 
> 标签：asp.net, ado.net, connection-pooling

我正在分析一个 ASP.NET Web 应用程序。我相信这是非常数据库连接密集型的（过度使用 ADO.NET 连接池）。**如何在不调试的情况下告诉它进入池的次数以及池中平均有多少可用连接？**是否有计数器可以在 PerfMon 或其他工具中为我提供此信息？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-29T20:46:14.360

查看 ADO.NET 性能计数器：

[http://msdn.microsoft.com/en-us/library/ms254503.aspx](http://msdn.microsoft.com/en-us/library/ms254503.aspx)

# language-agnostic - 先决条件和例外

> ID：149898
> 
> 赞同：2
> 
> 时间：2008-09-29T17:59:29.843
> 
> 标签：language-agnostic, exception, preconditions

假设您有一个带有一些前置条件和后置条件的方法。是否可以为每个未完成的前置条件创建一个异常类？例如：不完成 pre1 意味着抛出一个 notPre1Exception 实例。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-09-29T18:03:25.373

为什么不想定义 PreconditionFailedException(string precondition)？为每个失败的前提条件抛出不同的异常类型是矫枉过正的。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-29T18:08:17.467

是和不是。

是的 - 违反先决条件当然是引发异常的合适时机。抛出更具体的异常将使捕获该特定异常更简单。

否 - 为您的程序/api 中的每个前提条件声明一个新的异常类似乎有点矫枉过正。这最终可能导致成百上千的异常。这在精神上和计算上似乎都是一种浪费。

我建议为违反前提条件抛出异常。但是，我不建议为每个前提条件定义一个新的例外。相反，我建议创建更广泛的异常类别，涵盖特定*类型*的前提条件违规，而不是特定的前提条件违规。（我还建议在它们适合的地方使用现有的例外。）

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-29T18:05:05.120

一个失败的前置条件应该抛出一个 AssertException 或类似的东西。在调用方法之前，它的前提条件必须成立。如果调用者没有做这个检查，那是程序中的一个错误，或者是方法（API）的错误使用。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-29T18:02:02.630

只有在不满足前提条件的情况下才会发生罕见的*异常*情况。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-29T18:02:07.250

听起来对我来说是一个有用的例外。它当然允许更细粒度的日志记录和调试，而不仅仅是一般的“前提条件失败”，尽管您也可以有一个“前提条件失败”异常并将哪些前提条件失败放入异常消息中。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-29T18:03:59.867

我认为只要您计划使用和处理它们，就可以为所有异常创建不同的异常。

我发现错误/异常处理越好，在后期调试软件就越容易。

例如：如果您有一个通用的 excpeiton 来处理所有错误的输入，那么如果有错误，您必须查看传递给该方法的所有内容。如果您对所有类型的恶劣条件有一个 excpetion，您将知道在哪里寻找。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-29T18:04:07.493

在我看来这是可能的，但如果你想继续这种处理前置条件的方式，你最终会得到每个类方法的 N 个异常类。看起来像“非功能”类的爆炸式增长。

我一直喜欢“核心”功能不处理违反先决条件的代码（除了断言它们 - 一个很大的帮助！）。然后可以将此代码包装在“前置条件检查器”中，它*会*抛出异常或通知不满足。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-29T18:04:50.923

作为一种非常通用的方法来确定您是否应该创建一个类（并且异常是一个类），您应该确定是否有一些代码使这个类与所有其他类不同（在这种情况下是异常）。

如果没有，我只需将字符串设置在异常中并收工。如果你在你的异常中执行代码（也许是一个通用的恢复机制，可以通过调用 exception.resolve() 或其他东西来处理多种情况），那么它可能很有用。

我意识到异常并不总是遵循这条规则，但我认为这或多或少是因为语言提供的异常中不能有任何业务逻辑（因为他们不知道业务——库总是倾向于充满了 OO 规则的例外）

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-29T18:08:38.933

我认为本在这里是目标。如果您不打算捕获它们，那么抛出不同的异常有什么意义？如果你真的想抛出一个不同的，我至少会有一个共同的“PreconditionFailedException”基类，它们都派生自它们，并尝试将它们组织成某种层次结构，这样你就可以捕获它们的组。就个人而言，我不会有不同的，只是有一个常见的异常，你会抛出每个异常的失败细节。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-09-19T22:01:27.567

**不，**您不应该为每个前提条件创建一个特定的例外，因为它会违反按合同设计的原则。

实现前置条件的必然结果是它们应该成为文档的一部分，并且您应该为调用者提供必要的方法来检查所有前置条件是否有效。（即，如果方法执行依赖于对象的状态，则检查状态的方法应该可供调用者使用）。

因此，调用者应该能够在调用您的方法之前检查是否满足所有先决条件。

为每个违反的先决条件实施特定异常将/可能鼓励调用者在方法调用周围使用 try/catch 模式，这与按合同设计的理念相矛盾。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-29T18:05:23.513

我想说，只要你让它们成为未经检查的异常（Java 中 RuntimeException 的子类）就可以了。但是，在 Java 中最好只使用断言。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-09-29T18:19:23.480

如果您这样做，请确保它们都继承自另一个常见的自定义异常。

# c# - 如何使用具有泛型参数的类型作为约束？

> ID：149909
> 
> 赞同：2
> 
> 时间：2008-09-29T18:01:35.800
> 
> 标签：c#, generics, constraints

我想指定一个约束，它是另一种具有通用参数的类型。

```
class KeyFrame<T>
{
    public float Time;
    public T Value;
}

// I want any kind of Keyframe to be accepted
class Timeline<T> where T : Keyframe<*>
{
} 
```

但这还不能在 c# 中完成，（我真的怀疑它永远不会）。是否有任何优雅的解决方案，而不必指定关键帧参数的类型？：

```
class Timeline<TKeyframe, TKeyframeValue> 
     where TKeyframe : Keyframe<TKeyframeValue>,
{
} 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-29T18:12:28.037

由于 TimeLine 很可能是关键帧的聚合，因此不会像：

```
class TimeLine<T>
{
private IList<KeyFrame<T>> keyFrameList;
...
} 
```

很好地满足您的要求？

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-29T18:57:59.860

从[Eric Lippert 的博客](http://blogs.msdn.com/ericlippert/archive/2008/05/19/a-generic-constraint-question.aspx)中了解这一点 基本上，您必须找到一种方法来引用您想要的类型，而无需指定辅助类型参数。

在他的帖子中，他将这个例子展示为一个可能的解决方案：

```
public abstract class FooBase
{
  private FooBase() {} // Not inheritable by anyone else
  public class Foo<U> : FooBase {...generic stuff ...}

  ... nongeneric stuff ...
}

public class Bar<T> where T: FooBase { ... }
...
new Bar<FooBase.Foo<string>>() 
```

希望有帮助，特洛伊

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-29T18:23:06.653

如果代表的类型 T 与`Timeline<T>`代表的类型相同，则`KeyFrame<T>`可以使用：

```
class Timeline<T>
{
  List<KeyFrame<T>> _frames = new List<KeyFrame<T>>(); //Or whatever...

  ...
} 
```

如果类型 T 表示类之间的不同，这意味着`Timeline<T>`可以包含多种类型的`KeyFrame`' 在这种情况下，您应该创建一个更抽象的实现`KeyFrame`并在`Timeline<T>`.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-06-30T19:55:30.633

也许嵌套`Timeline`在`KeyFrame`您的设计中会有意义：

```
class KeyFrame<T> { 
  public float Time; 
  public T Value; 

  class Timeline<U> where U : Keyframe<T> { 
  } 
} 
```

# asp.net - Web 服务的兼容模式

> ID：149923
> 
> 赞同：0
> 
> 时间：2008-09-29T18:04:47.710
> 
> 标签：asp.net, visual-c++, compatibility

我有一个 Web 服务，它加载由 VC++ 6 制成的非托管 .dll。在 Vista 和 Windows Server 2008 中，我可以通过将应用程序置于 Win98 兼容模式来让使用它的应用程序工作。有没有类似的方法可以用我的网络服务做到这一点，所以它会运行？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-09T20:35:09.820

这取决于您的非托管 DLL。我已经成功部署了暴露 COM 接口的非托管 DLL。在目标机器（读取 Web 服务器）上注册这些 COM 组件后，我的托管 Web 应用程序 (ASP.NET) 能够调用这些 COM 组件。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-30T03:46:07.890

我相信 VS.NET 之前的所有 .dll 都是“非托管”的。您是否也可以访问您所指的这个 .dll 的源代码？

# c# - 线程的命名约定？

> ID：149932
> 
> 赞同：46
> 
> 时间：2008-09-29T18:06:22.120
> 
> 标签：c#, java, multithreading

命名线程很有帮助，这样人们就可以分清哪些线程正在为诊断和调试目的做什么。

在一个比另一个更好的多线程应用程序中，线程是否有特定的命名约定？有什么指导方针吗？什么样的信息应该包含在线程的名称中？关于命名可能对其他人有帮助的线程，您学到了什么？

* * *

## 回答 #1

> 赞同：43
> 
> 时间：2008-09-29T18:14:04.927

据我所知，没有标准。随着时间的推移，我发现这些指南很有帮助：

*   使用短名称，因为它们不会使日志文件中的行过长。

*   在重要部分开头的地方创建名称。图形用户界面中的日志查看器往往具有带有列的表，并且线程列通常很小，或者您可以将其变小以阅读其他所有内容。

*   不要在线程名称中使用“线程”一词，因为它很明显。

*   使线程名称易于 grep。避免听起来相似的线程名称

*   如果您有多个相同性质的线程，请使用对应用程序的一次执行或一个日志文件唯一的 ID 枚举它们，以适合您的日志记录习惯。

*   避免泛化诸如“WorkerThread”（你如何命名接下来的 5 个工作线程？）、“GUIThread”（哪个 GUI？它用于一个窗口？用于所有东西？）或“Calculation”（它计算什么？）。

*   如果您有一个使用线程名称来 grep 应用程序日志文件的测试组，请不要在一段时间后重命名您的线程。您的测试人员会因此而讨厌您。经过良好测试的应用程序中的线程名称应该保留。

*   当您有服务网络连接的线程时，请尝试在线程名称中包含目标网络地址（例如 channel_123.212.123.3）。如果有多个连接到同一主机，请不要忘记枚举。

如果您有许多线程并且忘记命名一个，那么您的日志机制应该输出一个唯一的线程 ID（特定于 API，例如通过调用 pthread_self() ）

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-29T18:19:50.903

命名线程很有用，你应该遵循一个命名约定，它适用于其他任何东西，无论是变量、方法还是类。根据他们的工作命名并简洁。如果您遇到需要线程转储的问题，最好查看名称并知道在代码中查找问题的位置，而不是检查堆栈跟踪和猜测。

唯一不同的是，如果有多个相同类型的线程，您真的应该添加某种索引，因为线程名称应该是唯一的以满足某些 API。如果您显示线程名称以了解您的应用程序在不同线程上发生部分执行时的行为方式，它还可以帮助进行日志记录。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-29T19:35:07.057

虽然 Thorsten 的回答是最全面的，但您可能想看看 Tomcat 如何命名其线程。我发现这很有用。我们使用石英调度程序运行多个线程，Thorsten 建议的许多命名规则很有用。

你打算使用线程池吗？如果是，那么这将减少您添加更多有用元信息的机会。如果没有，那么您可以拥有多少有用信息的极限就是天空。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-07T03:48:34.260

关于什么：

[命名空间].[Class][.Class...].[Method][current thread]？

所以你有名字：

Biz.Caching.ExpireDeadItems1
Biz.Caching.ExpireDeadItems2
Biz.Caching.ExpireDeadItems3

等等，对于每个线程。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-08T07:43:25.317

我已经看到了 .NET 中线程的几种命名约定。

有些人更喜欢在名称的开头使用“t”（例如*tMain Thread*），但我认为它没有任何实际价值。相反，为什么不使用简单的描述性名称（行变量），例如*HouseKeeping*、*Scheduler*等。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2008-09-29T18:14:02.167

我倾向于将线程命名与命名方法或变量相同。选择简明扼要地描述线程负责的进程的东西。我不认为您可以或应该将很多额外信息放入线程名称中。富有表现力但简洁是主要目标。

唯一的约定可能是为池中的线程添加递增的后缀。

# ms-access - 终端服务器上的 MS Access MDE

> ID：149936
> 
> 赞同：2
> 
> 时间：2008-09-29T18:07:35.240
> 
> 标签：ms-access

我在终端服务器上部署了一个 MDE 文件，当我双击 MDE 时出现以下错误。" 内存不足，无法执行此操作。请关闭不需要的程序，然后重试。

我在本地机器上从来没有任何问题。

我尝试反编译和压缩并再次编译。我可以打开其他表格，但只有 SwitchBoard 是问题所在。有什么想法吗？MainMenu 中几乎没有 9 个链接。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-07-08T05:27:00.303

如果您在终端服务器上的控制台会话中（在 KVM 上？），或者如果您启用“安装模式”（在远程桌面之后，运行“CHANGE USER /INSTALL”），问题是否仍然存在？我不知道 MDE 应用程序在终端服务上的任何具体问题，但尝试这两件事会让您知道它是否与 TS 配置有关，或者是否是在服务器本身上运行 MDE 的问题。

您可以使用您正在使用的 Windows Server 和 Access 的版本更新问题吗？[当您拥有 Windows Server 2003 和 Access 2000 时，此 Microsoft 知识库文章](http://support.microsoft.com/?kbid=244439)提出了一个问题，因此此处提供更多详细信息会有所帮助。

# java - 创建不可逆向工程的 Java 程序

> ID：149937
> 
> 赞同：5
> 
> 时间：2008-09-29T18:07:53.350
> 
> 标签：java, jar, compilation

有没有办法以不可逆向工程的格式部署 Java 程序？

我知道如何将我的应用程序转换为可执行的 JAR 文件，但我想确保代码不能被逆向工程，或者至少不容易被逆向工程。

源代码的混淆不算……它使代码更难理解，但不会隐藏它。

一个相关的问题是*[如何锁定已编译的 Java 类以防止反编译？](https://stackoverflow.com/questions/49379/how-to-lock-compiled-java-classes-to-prevent-decompilation)*

* * *

完成程序后，我仍然可以访问原始源，因此维护应用程序不会成为问题。如果应用程序是分布式的，我不希望任何用户能够反编译它。混淆并不能实现这一点，因为用户仍然可以反编译它，虽然他们很难遵循操作流程，但他们将能够看到代码，并可能从中获取信息。

我担心的是代码中是否有与远程访问相关的任何信息。应用程序使用用户提供的用户 ID 和密码连接到一个主机。如果该地址位于源代码中，有没有办法向用户隐藏主机地址？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-09-29T18:15:16.983

简短的回答是“不，它不存在”。

**逆向工程是一个根本不需要查看代码的过程**。它基本上是试图理解底层机制，然后模仿它们。例如，这就是 JScript 从 MS 实验室中出现的方式，通过复制 Netscape 的 JavaScript 行为，而无需访问代码。副本是如此完美，以至于连错误都被复制了。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-09-29T18:10:33.780

[您可以使用YGuard](http://www.yworks.com/en/products_yguard_about.htm)混淆您的 JAR 文件。**它不会混淆你的源代码**，而是编译的类，所以以后维护代码没有问题。

如果你想隐藏一些字符串，你可以加密它，使得通过查看源代码更难得到它（如果你混淆 JAR 文件会更好）。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-09-29T18:14:34.927

如果您知道您的目标平台是什么，请获取将您的 Java 编译为本机代码的工具，例如[Excelsior JET](http://www.excelsior-usa.com/jet.html)或[GCJ](http://gcc.gnu.org/java/)。

除此之外，您永远无法隐藏源代码，因为用户始终拥有您的字节码并且可以对其进行[Jad](http://www.kpdus.com/jad.html)。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-09-29T18:13:31.823

您正在使用一种将内省作为核心语言的一部分的语言进行写作。它生成`.class`规范广为人知的文件（从而使其他供应商能够生产 Java 编译器和解释器的洁净室实现）。

这意味着有公开可用的反编译器。所需要的只是一些 Google 搜索，并且您有一些 Java 代码与您的代码执行相同的操作。只是没有注释和一些变量名（但函数名保持不变）。

真的，混淆是你能得到的所有东西（尽管反编译的代码已经被稍微混淆了），而无需使用 C 或其他一些完全编译的语言，无论如何。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-29T18:16:46.340

不要使用解释性语言？你到底想保护什么？如果它足够有价值，任何东西都可以被逆向工程。有人足够关心对大多数项目进行逆向工程的可能性很小。混淆至少提供了一个最小的障碍。

确保您的[知识产权](http://en.wikipedia.org/wiki/Intellectual_property)(IP) 通过其他机制得到保护。特别是对于安全代码，重要的是人们能够检查实现，以便安全在算法中，而不是在源代码中。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-29T18:12:22.043

我很想问你为什么要这样做，但我会不理会它......

我看到的问题是 JVM 和 CLR 一样，需要能够解释您的代码，以便 JIT 编译和运行它。你可以让它更“复杂”，但考虑到字节码的规范是相当有据可查的，并且比 x86 汇编器规范存在更高的层次，你不太可能“隐藏”流程，因为它有在那里让程序首先工作。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-29T18:15:08.327

这是不可能的。

任何可以编译的东西都可以反编译。你能做的最好的事情就是把它搞糊涂。

话虽如此，量子密码学中发生了一些有趣的事情。本质上，任何阅读消息的尝试都会改变它。我不知道这是否可以应用于源代码。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-29T19:06:57.593

即使您将代码编译成本地机器语言，也有各种各样的程序可以让您从本质上将其反编译成汇编语言并遵循流程（OlyDbg，IDA Pro）。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-29T19:43:29.783

把它变成一个网络服务。那么你是唯一可以看到源代码的人。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-09-30T11:14:33.180

这是不可能的。这不是 Java 问题。任何可以编译的语言都可以为Java反编译，这更容易。

您正在尝试向某人展示图片而不实际展示他们。这不可能。即使您隐藏在应用程序级别，您也无法隐藏您的主机。仍然有人可以通过[Wireshark](http://en.wikipedia.org/wiki/Wireshark)或任何其他网络嗅探器捕获它。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2015-02-22T22:05:18.230

正如上面有人所说，逆向工程总是可以反编译您的可执行文件。保护您的源代码（或算法）的唯一方法是不分发您的可执行文件。

separate your application into a server code and a client app, hide the important part of your algorithm in your server code and run it in a cloud server, just distribute the client code which works only as a data getter and senter.

By this even your client code is decompiled. You are not losing anything.

But for sure this will decrease the performance and user convenience.

I think this may not be the answer you are looking for, but just to raise different idea of protecting source code.

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-09-29T20:19:27.620

在某些时候任何解释的东西都必须“以明确的方式”处理。一旦代码通过 JAD 运行，该字符串将清楚地显示为 day。您可以使用您的应用程序部署加密密钥，或者使用基本的 ceasar 密码来加密主机连接信息并在运行时解密......

但是在处理过程中的某些时候，必须明确主机连接信息，以便您的应用程序连接到主机......

所以你可以静态隐藏它，但如果他们运行调试器，你不能在运行时隐藏它

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-09-29T23:06:51.463

这是不可能的。CPU 必须执行您的程序，即您的程序必须采用 CPU 可以理解的格式。CPU 比人类笨得多。因此，如果 CPU 可以理解您的程序，那么人类也可以。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-12-03T06:56:57.277

由于担心隐藏代码，我还是会运行[ProGuard](http://proguard.sourceforge.net/)。

# jsp - jsp 像 jsp:usebean 一样创建脚本变量

> ID：149939
> 
> 赞同：1
> 
> 时间：2008-09-29T18:08:20.667
> 
> 标签：jsp, tagfile

我想做类似 `<test:di id="someService"`/`>
<% someService.methodCall(); %>

where`<test:di`
获取并实例化一个服务 bean 并创建一个脚本变量以供使用。类似于 jsp:usebean 的工作方式，例如 `<jsp:useBean id="someDate" class="java.util.Date"`/>
<%
someDate.getYear();

```
%> 
```

如何使我自己的对象可用作脚本变量？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-29T18:29:13.267

在标签库中完成此操作的方式是使用标签额外信息 (TEI) 类。

你可以在[这里找到一个例子](http://www.stardeveloper.com/articles/display.html?article=2001081601&page=2)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-29T18:19:33.713

我认为您正在尝试编写自己的标签库。

查看教程： [http ://www.ironflare.com/docs/tutorials/taglibs/](http://www.ironflare.com/docs/tutorials/taglibs/)

编辑：正如 Garth 所指出的，您希望在定义标签库后使用 TagExtraInfo 类。 [http://www.stardeveloper.com/articles/display.html?article=2001081601&page=2](http://www.stardeveloper.com/articles/display.html?article=2001081601&page=2)

# db2 - JMP0811I-U 使用 DB2 SQL 编译 Fujitsu COBOL 后出现 Fujitsu 运行时错误：原因/补救措施？

> ID：149945
> 
> 赞同：0
> 
> 时间：2008-09-29T18:09:09.807
> 
> 标签：db2, cobol, netcobol

我能够（在 Windows XP 上）预编译、编译和链接包含嵌入式 SQL 的示例（Fujitsu NetCobol）COBOL 测试程序。该测试程序用于读取并显示 DB2（Linux 上的 UDB 9.5）数据库表中的行数。

在运行时，我收到以下错误消息：

**JMP0811I-U [PID:... TID:...] 'sqlgstrt' 程序的链接规则或参数失败。PGM=DB2TST1**

此错误所指的预编译源代码如下所示：

```
 * ... in WORKING-STORAGE section:

      01  SQLA-PROGRAM-ID.
       05 SQL-PART1 pic 9(4) COMP-5 value 172.
       05 SQL-PART2 pic X(6) value "AEAMAI".
       05 SQL-PART3 pic X(24) value "gBSdTdJY01111 2         ".
       05 SQL-PART4 pic 9(4) COMP-5 value 13.
       05 SQL-PART5 pic X(13) value "ADMINISTRATOR".
       05 SQL-PART6 pic X(115) value LOW-VALUES.
       05 SQL-PART7 pic 9(4) COMP-5 value 8.
       05 SQL-PART8 pic X(8) value "COBOL/DB".
       05 SQL-PART9 pic X(120) value LOW-VALUES.

      * .. in PROCEDURE DIVISION:

      *EXEC SQL CONNECT TO :DB-SERVER USER :DB-USER USING :DB-PWD
      *     END-EXEC
           CALL "sqlgstrt" USING
              BY CONTENT SQLA-PROGRAM-ID
              BY VALUE 0
              BY REFERENCE SQLCA 
```

有人知道这个错误信息是什么意思吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-30T17:00:03.927

错误描述是由于：*) CHECK(LINKAGE) 编译器选项（仅适用于 Windows 的 NetCOBOL，不适用于 Linux）没有此选项，错误仍然存​​在，但描述性更差

实际错误是由于：*) `CALL "sqlgstrt" USING ...`DB2 预编译器生成的暗示错误 (= COBOL) 调用约定 => 手动更改调用 `CALL "sqlgstrt" WITH STDCALL LINKAGE USING...`已解决运行时错误

不过，此解决方案意味着更改预编译器结果，因此我仍在寻找 DB2 预编译器选项来生成正确的 CALL。

# vbscript - 如何确定 VBScript 中的复制何时完成？

> ID：149956
> 
> 赞同：4
> 
> 时间：2008-09-29T18:13:19.500
> 
> 标签：vbscript, copy, filesystems

有谁知道确定文件复制何时在 VBScript 中完成的方法？我正在使用以下内容进行复制：

```
set sa = CreateObject("Shell.Application")  
set zip = sa.NameSpace(saveFile)  
set Fol = sa.NameSpace(folderToZip)  
zip.copyHere (Fol.items) 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-29T18:21:31.757

```
Do Until zip.Items.Count = Fol.Items.Count
    WScript.Sleep 300
Loop 
```

当循环完成时，您的副本就完成了。

但是如果你只想复制而不是压缩，FSO 或 WMI 更好。

如果您正在压缩并希望它们在一个文件中，您必须自己创建 zip 文件，首先使用正确的标题。否则，您只会获得压缩文件/文件夹 IIRC。像这样的东西：

```
Set FSO = CreateObject( "Scripting.FileSystemObject" )
Set File = FSO.OpenTextFile( saveFile, 2, True )
File.Write "PK" & Chr(5) & Chr(6) & String( 18, Chr(0) )
File.Close
Set File = Nothing
Set FSO = Nothing 
```

OpenTextFile 中的 2 是 ForWriting。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-29T18:18:03.450

在[`FileSystemObject`](http://msdn.microsoft.com/en-us/library/6973t06a(VS.85).aspx). 我用它来复制，这是一个阻塞调用。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2015-02-17T15:32:24.363

```
Const FOF_CREATEPROGRESSDLG = &H0&
Const ForReading = 1, ForWriting = 2, ForAppending = 8

Set fso = CreateObject("Scripting.FileSystemObject")

strSource = " " ' Source folder path of log files
strTarget = " .zip" ' backup path where file will be created

AddFilesToZip strSource,strTarget

Function AddFilesToZip (strSource,strTarget)
Set r=fso.GetFolder(strSource)
    set file = fso.opentextfile(strTarget,ForWriting,true) 
    file.write "PK" & chr(5) & chr(6) & string(18,chr(0)) 
    file.Close
    Set shl = CreateObject("Shell.Application")
    i = 0

        For each f in r.Files
            If fso.GetExtensionName(f) = "log" Or fso.GetExtensionName(f) = "Log" Or fso.GetExtensionName(f) = "LOG" Then
            shl.namespace(strTarget).copyhere(f.Path)', FOF_CREATEPROGRESSDLG   
                Do until shl.namespace(strTarget).items.count = i
                    wscript.sleep 300
                Loop
            End If
            i = i + 1
        Next

        set shl = Nothing
End Function 
```

# javascript - 如何避免 JavaScript 中的回发？

> ID：149962
> 
> 赞同：9
> 
> 时间：2008-09-29T18:14:31.540
> 
> 标签：javascript, asp.net

我有一个 ASP.NET 页面，其中有一个按钮。单击按钮会启动一个使用 JavaScript 的模式对话框。根据模态对话框返回的值，我想继续或取消发生的回发。我该怎么做呢？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-09-29T18:15:55.250

添加“return false;” 到按钮的onclick 属性会阻止自动回发。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-29T18:19:16.053

这是你想要做的吗？

```
<input type="button" id="myButton" value="Click!" />

<script type="text/javascript">
document.getElementById('myButton').onclick = function() {
    var agree = confirm('Are you sure?');
    if (!agree) return false;
};
</script> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-29T18:18:30.127

```
function HandleClick()
{
 // do some work;

if (some condition) return true; //proceed
else return false; //cancel;
} 
```

将 OnClientClick 属性设置为“返回 HandleClick()”

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2008-09-29T18:18:06.383

基本上是韦恩所说的，但你只需要输入'return false;' 在呈现模态的函数中。如果这是您想要的值，请让回发发生。如果没有，让函数返回 false 并停止提交。

# activerecord - 在 Castle ActiveRecord 的 OnFlushDirty() 事件中访问 previousState 时出现问题

> ID：149964
> 
> 赞同：1
> 
> 时间：2008-09-29T18:14:38.810
> 
> 标签：activerecord, castle

我有这个问题，我正在使用 Castle ActiveRecord，当我更新时，我验证了 OnFlushDirty 事件中对象的更改。

但是，当我访问 prevouState["MyProperty"] 时，它变为 null 并且我无法获取旧值。

你知道为什么吗？

这是代码；

```
 protected override bool OnFlushDirty(object id, System.Collections.IDictionary previousState, System.Collections.IDictionary currentState, NHibernate.Type.IType[] types)
    {
        StringBuilder errors = new StringBuilder();

        if (this._bankCode <= 0)
            errors.Append("Bank code is invalid" + Environment.NewLine);

        if (string.IsNullOrEmpty(this._name) || this._name.Trim().Length == 0)
            errors.Append("Name is invalid" + Environment.NewLine);

        //previousState["EnterpriseCode"] is always null
        if (previousState["EnterpriseCode"] != currentState["EnterpriseCode"])
        {
            if (this._enterpriseCode == 0)
                errors.Append("Enterprise code is invalid" + Environment.NewLine);
            else 

         ... 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-29T19:56:35.600

我终于做到了，碰巧在hibernate中你必须使用merge()来使hibernate“加载”分离对象的previuos数据，在Castle中相当于SaveCopy()方法。

# c# - C# ResetBinding 翻转 DataGridView *用示例更新*

> ID：149977
> 
> 赞同：0
> 
> 时间：2008-09-29T18:17:54.417
> 
> 标签：c#, data-binding, serialization, datagridview

我遇到了一个部分解决的[问题。](https://stackoverflow.com/questions/118051/c-grid-binding-not-update)快速解释一下：我有一个绑定到需要序列化的复杂对象的网格。从序列化中构建对象时，网格上的事件不会刷新表格显示。有人告诉我在反序列化后重建事件，它可以工作！但是刷新网格的事件似乎根本没有触发。

我必须从我的复杂对象构建一个事件，告诉我内部发生了一些变化。从这个事件我添加了这个代码：

```
this.bindingSource1.ResetBindings(false); 
```

问题是网格在翻转，用户感觉不好（行上下移动而不是停止）。

如何在没有这种翻转的情况下重置绑定？我怎样才能解决[原来的问题](https://stackoverflow.com/questions/118051/c-grid-binding-not-update)？（这将自动解决所有问题）。

**更新**

这是一个执行完全相同行为的示例：

创建一个类：

```
[Serializable()]
class BOClient : INotifyPropertyChanged, IDataErrorInfo
{
    private string name;
    private int len;
    public string Name
    {
        get { return name; }
        set { name = value;
        this.len = name.Length;
        if (this.PropertyChanged !=null)
            this.PropertyChanged(this, new PropertyChangedEventArgs("Name"));
        }
    }

    public int Len
    {
        get { return this.len; }
    }

    public BOClient(string name)
    {
        this.Name = name;
    }

    #region INotifyPropertyChanged Members

    public event PropertyChangedEventHandler PropertyChanged;

    #endregion

    #region IDataErrorInfo Members

    public string Error
    {
        get { return ""; }
    }

    public string this[string columnName]
    {
        get { return ""; }
    }

    #endregion
} 
```

现在，使用 BindingSource 调用“bindingSource1”创建一个表单，并使用该类作为数据源。创建一个网格并将该网格绑定到 bindingsource1。

在该表单中，在 load 中使用此代码：

```
 private void Form1_Load(object sender, EventArgs e)
    {
        BindingList<BOClient> listClient = new BindingList<BOClient>();
        listClient.Add(new BOClient("P1"));
        listClient.Add(new BOClient("P2"));
        listClient.Add(new BOClient("P3"));

        //using (MemoryStream mem = new MemoryStream())
        //{
        //    BinaryFormatter b1 = new BinaryFormatter();

        //    try
        //    {
        //        b1.Serialize(mem, listClient);
        //    }
        //    catch (Exception ez)
        //    {
        //        MessageBox.Show(ez.Message);
        //    }

        //    BinaryFormatter b2 = new BinaryFormatter();

        //    try
        //    {
        //        mem.Position = 0;
        //        listClient = (BindingList<BOClient>)b2.Deserialize(mem);
        //    }
        //    catch (Exception ez)
        //    {
        //        MessageBox.Show(ez.Message);
        //    }

        //}

        this.bindingSource1.DataSource = listClient;
    } 
```

我将序列化过程放在注释中，因为如果没有它，它似乎会出现同样奇怪的行为......现在启动应用程序。更改客户的名称。“新名称”的示例“p1”，然后单击已更改名称下的单元格。您将看到“len”列没有改变。但是，如果您单击具有 len 的单元格，您将看到数字变为正确的值。

有人知道为什么吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-10-02T18:10:23.973

我通过在 BindingList（通过继承）中添加一个方法 [OnDeserialization] 解决了这个问题，我添加了在 OnListChange 上添加事件的代码。这样，当 1 个属性更改时，整行都会刷新。

# c++ - 通过更改窗口大小获得不同的标题大小

> ID：149995
> 
> 赞同：7
> 
> 时间：2008-09-29T18:21:29.230
> 
> 标签：c++, c, struct, packing

我有一个将 TCP 标头表示为结构的 C++ 程序：

```
#include "stdafx.h"

/*  TCP HEADER

    0                   1                   2                   3   
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |          Source Port          |       Destination Port        |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                        Sequence Number                        |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                    Acknowledgment Number                      |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |  Data |           |U|A|P|R|S|F|                               |
   | Offset| Reserved  |R|C|S|S|Y|I|            Window             |
   |       |           |G|K|H|T|N|N|                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |           Checksum            |         Urgent Pointer        |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                    Options                    |    Padding    |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                             data                              |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

*/

typedef struct {        // RFC793
    WORD         wSourcePort;
    WORD         wDestPort;
    DWORD        dwSequence;
    DWORD        dwAcknowledgment;
    unsigned int byReserved1:4;
    unsigned int byDataOffset:4;
    unsigned int fFIN:1;
    unsigned int fSYN:1;
    unsigned int fRST:1;
    unsigned int fPSH:1;
    unsigned int fACK:1;
    unsigned int fURG:1;
    unsigned int byReserved2:2;
    unsigned short wWindow;
    WORD         wChecksum;
    WORD         wUrgentPointer;
} TCP_HEADER, *PTCP_HEADER;

int _tmain(int argc, _TCHAR* argv[])
{
    printf("TCP header length: %d\n", sizeof(TCP_HEADER));
    return 0;
} 
```

如果我运行这个程序，我会得到这个标头的大小为 24 字节，这不是我期望的大小。如果我将字段“wWindow”的类型更改为“unsigned int wWindow:16”，它的位数与 unsigned short 相同，程序会告诉我结构的大小现在是 20 字节，这是正确的大小。为什么是这样？

我在 32 位 x86 机器上使用带有 SP1 的 Microsoft Visual Studio 2005。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-29T18:24:50.347

因为编译器将您的位域打包成 32 位 int，而不是 16 位实体。

通常，您应该避免使用位域并使用其他具有显式位掩码和移位的清单常量（枚举或其他）来访问字段中的“子字段”。

这是应该避免位域的一个原因 - 即使对于同一平台，它们在编译器之间也不是很便携。来自 C99 标准（C90 标准中有类似的措辞）：

> 实现可以分配任何大到足以容纳位域的可寻址存储单元。如果有足够的空间剩余，紧跟在结构中另一个位域之后的位域将被打包到同一单元的相邻位中。如果剩余空间不足，则将不适合的位域放入下一个单元还是与相邻单元重叠是实现定义的。单元内位域的分配顺序（高位到低位或低位到高位）是实现定义的。未指定可寻址存储单元的对齐方式。

您无法保证位域是否会“跨越”一个 int 边界，并且您无法指定位域是从 int 的低端还是 int 的高端开始（这与处理器是否大端或小端）。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-29T19:20:22.943

您的一系列“unsigned int:xx”位域仅使用了 int 中 32 位中的 16 位。其他 16 位（2 个字节）在那里，但未使用。紧随其后的是 unsigned short，它位于 int 边界上，然后是一个 WORD，它在 int 边界上对齐，这意味着它们之间有 2 个字节的填充。

当您切换到“unsigned int wWindow:16”时，编译器不会使用单独的短字节，而是使用前一个位域的未使用部分，因此不会浪费，不会短缩，也不会在短缩之后填充，因此您节省了四个字节。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-29T18:28:36.500

请参阅这个问题：[为什么结构的 sizeof 不等于每个成员的 sizeof 之和？](https://stackoverflow.com/questions/119123/why-does-the-sizeof-operator-return-a-size-larger-for-a-structure-than-the-tota).

我相信当您使用“unsigned int wWindow:16”语法时，编译器会提示禁用填充。

另外，请注意，不保证短路为 16 位。保证是：16 位 <= short 的大小 <= int 的大小。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-29T18:24:50.597

编译器将非位域结构成员填充为 32 位 - 本机字对齐。要解决此问题，请在结构之前执行 #pragma pack(0) 并在之后执行 #pragma pack()。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-29T18:25:08.643

编译器可以根据字段的大小和顺序填充内存中的结构边界。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-29T18:27:42.413

在打包方面不是 C/C++ 专家。但我想规范中有一条规则说，当一个非位域跟随一个位域时，它必须在字边界上对齐，无论它是否适合剩余空间。通过使其成为显式位向量，您可以避免此问题。

这又是带有一点经验的推测。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-29T18:29:13.190

有趣 - 我认为“WORD”会评估为“无符号短”，所以你会在不止一个地方遇到这个问题。

另请注意，您需要处理任何超过 8 位的值的字节序问题。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-29T18:36:13.627

由于编译器打包规则，您会看到不同的值。[您可以在此处](http://msdn.microsoft.com/en-us/library/1d48zaa8.aspx)查看特定于 Visual Studio 的规则。

当您有一个必须打包的结构（或遵守某些特定的对齐要求）时，您应该使用 #pragma pack() 选项。对于您的代码，您可以使用 #pragma pack(0) 它将所有结构成员对齐字节边界。然后，您可以使用 #pragma pack() 将结构打包重置为其默认状态。[您可以在此处](http://msdn.microsoft.com/en-us/library/2e70t5y1.aspx)查看有关 pack pragma 的更多信息。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-29T20:56:50.340

我认为 Mike B 是对的，但不是很清楚。当您要求“短”时，它在 32 位边界上对齐。当您要求 int:16 时，它不是。所以 int:16 正好在 ebit 字段之后，而 short 跳过 2 个字节并从下一个 32 位块开始。

他所说的其余部分是完全适用的——位字段绝不能用于编码外部可见的结构，因为不能保证它们是如何分配的。充其量，它们属于保存字节很重要的嵌入式程序。即使在那里，您也不能使用它们来实际控制内存映射端口中的位。****