# StackOverflow 问答 000222000-000222999

# asp.net-mvc - ASP.NET MVC: PathInfo Limit?

> ID：222011
> 
> 赞同：1
> 
> 时间：2008-10-21T14:08:23.413
> 
> 标签：asp.net-mvc, max, pathinfo

One of the limitations of ASP.NET 2.0 was that PathInfo was limited to 255 characters. Is that limit a problem in ASP.NET MVC urls, or is there any sort of length limit with ASP.NET MVC routing urls?

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-21T15:57:54.520

据我所知，限制是由浏览器强加的，而不是 ASP.NET。例如，

对于 IE，它是 2,083 个字符。

255 个字符的限制是 RFC 2068 的一个警告，它指出：服务器应谨慎对待超过 255 个字节的 URI 长度，因为一些较旧的客户端或代理实现可能无法正确支持这些长度。

此外，对于 ASP.NET MVC，PathInfo 长度将为 0，因此对 PathInfo 大小的任何限制都不适用。我刚刚试了一下，果然，我能够在 IE7 中发出一个包含 2083 个字符的 MVC 请求。

# c# - Guidelines for using the ASP.NET Wizard efficiently

> ID：222013
> 
> 赞同：1
> 
> 时间：2008-10-21T14:08:49.920
> 
> 标签：c#, .net, asp.net, vb.net

A web app our group has put together uses the ASP.NET Wizard control. Each step in the wizard contains a corresponding custom UserControl.

The trouble is that as you go through the wizard steps, *all* the UserControls are loaded on each step, rather than just the one used in that step. That doesn't seem right to me.

So...is there anybody here that's done a lot of work with the Wizard control and can give some guidelines on how to use it correctly, and keep it from loading way too much junk with each step?

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-21T14:21:49.113

One thing that could help you a bit is not putting any code in your UserControls's Page_Load function but instead putting that same code in it's Page_PreRender. That's crucial when using a MultiView and probably applies to the wizard as well.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-07T20:52:16.640

仅供参考，（至少部分）它在每个步骤上加载所有用户控件的原因是，您可以访问在其他步骤中输入的值。如果它没有加载控件，您将无法根据上一步中输入的内容轻松地对当前步骤做出决定（例如，根据上一步中的选择过滤列表）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-21T14:50:32.487

mspmsp 对 PreRender 有一个很好的建议，我注意到之前使用的另一个选项是将控件内的所有配置代码简单地移动到 ConfigureControl 方法。

然后在切换视图时，您可以调用 ConfigureControl() 方法来显式创建/加载您的控件。它具有相同的目的，但在我看来，它有助于使代码更容易理解。

# .net - 目标框架不匹配

> ID：222015
> 
> 赞同：6
> 
> 时间：2008-10-21T14:09:33.600
> 
> 标签：.net, visual-studio

添加对项目的引用时，我有时会看到消息...

“该项目的 Target Framework 版本高于当前项目 Target Framework 版本。是否仍要将此引用添加到您的项目中？”

我理解消息的含义，但谁能解释说“是”可能会出现什么问题？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-10-21T14:27:50.830

假设您构建了一个应用程序，其中 exe 以 2.0 为目标，但某些库以 3.5 为目标。使用 .NET 2.0 机器的人看着主项目并认为他们可以运行它 - 毕竟，应用程序的目标是 2.0，对吗？当库第一次加载时，他们会得到一个令人讨厌的惊喜......

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-04-23T20:01:41.037

实际上，这完全没问题。VS 只是让你意识到。只需确保将必要的引用复制到您的项目并引用它们。如果您引用的项目是您可以控制的项目，您可以将引用放在那里。

例如，我们有一个不能运行 .Net 3.5 的旧版 Windows 2000 服务器。因此，当我们想要利用 LINQ 之类的东西时，我们会将其构建到一个针对 3.5 的单独项目中。然后，我们从面向 2.0 的 Web 应用程序中引用该项目。我们收到您谈到的消息，但我们只是确保将 System.core 和 Link.Data DLL 复制到 bin 文件夹并引用。那么就没有问题了。奇迹般有效。

# java - JMS 有什么用？

> ID：222017
> 
> 赞同：71
> 
> 时间：2008-10-21T14:11:33.203
> 
> 标签：java, jms, messaging

我正在寻找 JMS 是一个很好的解决方案的问题的（简单）示例，以及为什么 JMS 在这些情况下是一个很好的解决方案的原因。过去，当 B 不一定能立即处理消息时，我只是将数据库用作将消息从 A 传递到 B 的一种方式。

这种系统的一个假设示例是所有新注册的用户都应在注册后 24 小时内收到一封欢迎电子邮件。为了论证起见，假设数据库不记录每个用户注册的时间，而是将每个新用户的引用（外键）存储在 pending_email 表中。电子邮件发件人作业每 24 小时运行一次，向此表中的所有用户发送一封电子邮件，然后删除所有 pending_email 记录。

这似乎是应该使用 JMS 的问题，但我不清楚 JMS 相对于我所描述的方法有什么好处。DB 方法的一个优点是消息是持久的。我知道 JMS 消息队列也可以持久化，但在这种情况下，JMS 与我描述的“数据库作为消息队列”方法之间似乎没有什么区别？

我错过了什么？- 大学教师

* * *

## 回答 #1

> 赞同：70
> 
> 时间：2008-10-21T15:05:06.653

JMS 和消息传递实际上是两件完全不同的事情。

*   发布和订阅（向感兴趣的消费者发送消息 - 有点像向邮件列表发送电子邮件，发件人不需要知道谁订阅了
*   高性能可靠负载平衡（消息队列）

查看有关[队列与主题比较的更多信息](http://activemq.apache.org/how-does-a-queue-compare-to-a-topic.html)

您正在谈论的情况是第二种情况，是的，您可以使用数据库表来模拟消息队列。

主要区别在于 JMS 消息队列是为大吞吐量而设计的高性能高并发负载均衡器；您通常可以每秒向许多进程和线程中的许多并发消费者发送数万条消息。这样做的原因是消息队列基本上是高度异步的 - 一个[好的 JMS 提供者会提前将消息流式传输到每个消费者](http://activemq.apache.org/what-is-the-prefetch-limit-for.html)，以便一旦消费者可用，就有数千条消息可以在 RAM 中进行处理。这导致了巨大的吞吐量和非常低的延迟。

例如，想象一下使用数据库表编写 Web 负载均衡器 :)

使用数据库表时，通常一个线程倾向于锁定整个表，因此在尝试实现高性能负载均衡器时往往会获得非常低的吞吐量。

但是像大多数中间件一样，这一切都取决于你需要什么；如果您的系统吞吐量较低，每秒只有几条消息 - 请随意使用数据库表作为队列。但是如果您需要低延迟和高吞吐量 - 强烈建议使用 JMS 队列。

* * *

## 回答 #2

> 赞同：51
> 
> 时间：2008-10-21T14:23:38.033

在我看来，JMS 和其他基于消息的系统旨在解决需要：

*   **异步**通信：应用程序需要通知另一个应用程序发生了事件，而无需等待响应。
*   **可靠性**。确保一次且仅一次的消息传递。使用您的数据库方法，您必须“重新发明轮子”，特别是如果您有多个客户阅读消息。
*   **松耦合**。并非所有系统都可以使用数据库进行通信。因此，JMS 非常适合用于具有可跨系统边界进行通信的解耦系统的异构环境。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-10-21T14:29:01.530

JMS 实现是“推送”的，从某种意义上说，您不必轮询队列来发现新消息，但是您注册一个回调，该回调会在新消息到达时立即被调用。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-10-21T14:56:15.237

解决原始评论。最初描述的是（点对点）JMS 的要点。然而，JMS 的好处是：

1.  您不需要自己编写代码（并且可能会搞砸逻辑，使其不像您想象的那么持久）。此外，第三方 impl 可能比简单的数据库方法更具可扩展性。

2.  jms 处理发布/订阅，这比您给出的点对点示例要复杂一些

3.  您不依赖于特定的实现，并且如果您将来的需求发生变化，可以将其换掉，而不会弄乱您的 java 代码。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-10-22T08:28:36.563

JMS 的一个优点是支持异步处理，这也可以由数据库解决方案完成。然而，以下是 JMS 相对于数据库解决方案的其他一些好处

a) 消息的消费者可以在远程位置。公开数据库以进行远程访问是危险的。您可以通过提供额外的服务来从数据库读取消息来解决这个问题，这需要更多的努力。

b）在数据库的情况下，消息消费者必须轮询数据库中的消息，因为 JMS 在消息到达时提供回调（如 sk 所述）

c) 负载平衡 - 如果有很多消息来，很容易在 JMS 中拥有消息处理器池。

d) 一般而言，通过 JMS 实现会比数据库路由更简单且省力

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2013-09-27T07:14:15.060

JMS 是用于在两个或多个客户端之间传输消息的 API。它的规格在 JSR 914 下定义。

> JMS 的主要优点是通信实体的解耦特性 - 发送方不需要有关接收方的信息。其他优势包括集成异构平台、减少系统瓶颈、提高可扩展性以及更快速地响应变化的能力。

JMS 只是一种接口/API，必须实现具体的类。这些已经由各种组织/提供商实施。它们被称为 JMS 提供者。例如 IBM 的[WebSphere](http://www-01.ibm.com/software/in/websphere/)或Fiorano Softwares 的[FioranoMQ](http://www.fiorano.com/products/Enterprise-Messaging/JMS/Java-Message-Service/FioranoMQ.php)或 Apache、HornetQ、OpenMQ 等的 ActiveMQ。使用的其他术语是管理对象（主题、队列、连接工厂）、JMS 生产者/发布者、JMS 客户端和消息本身。

所以来到你的问题 -`what is JMS good for?` 我想举一个实际的例子来说明它的重要性。

**日间交易**

有一个称为[LVC](https://java.net/jira/browse/JMS_SPEC-37)（最后值缓存）的功能

在交易中，股价由出版商定期发布。每个共享都有一个发布到的关联主题。现在，如果您知道什么是主题，那么您必须知道消息不像队列那样保存。消息在消息发布时被发布给活跃的订阅者（例外是 Durables 订阅者，它们从创建时获取所有发布的消息，但是我们又不想获得太旧的股票价格，这放弃了使用它）。因此，如果客户想知道股票价格，他会创建一个订阅者，然后他必须等到下一个股票价格发布（这又不是我们想要的）。这就是 LVC 发挥作用的地方。每个 LVC 消息都有一个关联的密钥。如果使用 LVC 密钥（针对特定股票）发送消息，然后使用相同密钥发送另一条更新消息，则后者会覆盖前一个消息。当订阅者订阅一个主题（启用了 LVC）时，订阅者将获得具有不同 LVC 键的所有消息。如果我们为每个上市公司保留一个不同的密钥，那么当客户订阅它时，它将获得最新的股票价格并最终获得所有更新。

Ofcourse this is one of the factors other that reliability,security etc which makes JMS so powerful.

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-21T14:30:25.647

Guido 有完整的定义。根据我的经验，所有这些对于良好的合身性都很重要。

我见过的用途之一是在仓库中分发订单。想象一家办公用品公司，它拥有大量为大型办公室提供办公用品的仓库。这些订单将进入一个中心位置，然后分批供正确的仓库分发。在大多数情况下，仓库没有或不想要高速连接，因此订单通过拨号调制解调器向下推送给他们，这就是异步进来的地方。电话线也不是那么重要，所以一半的订单可能会进入并且这就是可靠性很重要的地方。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-21T14:46:40.263

关键优势是解耦不相关的系统，而不是让它们共享通用数据库或构建自定义服务来传递数据。

银行就是一个很好的例子，日内消息被用来在实时数据更改发生时传递它们。源系统很容易“翻墙”抛出消息；缺点是这些系统之间的合同方式很少，您通常会看到住院治疗是在消费者方面实施的。它的耦合几乎太松散了。

其他优势在于对许多应用程序服务器等的开箱即用的 JMS 支持以及围绕它的所有工具：持久性、监控、报告和节流。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2010-12-03T22:10:01.510

这里有一些很好的例子：http: [//www.winslam.com/laramee/jms/index.html](http://www.winslam.com/laramee/jms/index.html)

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-10-21T14:32:01.430

“数据库作为消息队列”解决方案可能对任务来说很繁重。JMS 解决方案的耦合不那么紧密，因为消息发送者不需要知道任何关于接收者的信息。这也可以通过“数据库作为消息队列”中的一些额外抽象来实现，因此这不是一个巨大的胜利......此外，您可以以“发布和订阅”的方式使用队列，这取决于什么很方便你正在努力完成。这也是进一步解耦组件的好方法。如果您的所有通信都在一个系统内和/或拥有可立即用于应用程序的日志非常重要，那么您的方法似乎不错。如果您在不同的系统之间进行通信，JMS 是一个不错的选择。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2010-07-25T08:14:26.210

JMS 与 JTA（Java 事务 API）和 JPA（Java 持久性 API）结合使用会非常有用。通过一个简单的注释，您可以将多个数据库操作 + 消息发送/接收放在同一个事务中。因此，如果其中一个失败，一切都会使用相同的事务机制回滚。

# javascript - 如何在 JavaScript 中格式化数字？

> ID：222018
> 
> 赞同：7
> 
> 时间：2008-10-21T14:11:38.383
> 
> 标签：javascript

如何在 JavaScript 中格式化数字？

* * *

*   [JavaScript 文化敏感货币格式](https://stackoverflow.com/questions/51564/javascript-culture-sensitive-currency-formatting)

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-10-21T14:16:07.237

最好的 JavaScript 是数字上的 toFixed() 和 toPrecision() 函数。

```
var num = 10;
var result = num.toFixed(2); // result will equal 10.00

num = 930.9805;
result = num.toFixed(3); // result will equal 930.981

num = 500.2349;
result = num.toPrecision(4); // result will equal 500.2

num = 5000.2349;
result = num.toPrecision(4); // result will equal 5000

num = 555.55;
result = num.toPrecision(2); // result will equal 5.6e+2 
```

货币、逗号和其他格式必须由您或第三方库完成。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-12-11T08:41:11.040

改进后的脚本（之前的脚本有问题，抱歉；老实说，我也没有彻底测试过），它的工作方式类似于 php number_format：

```
function formatFloat(num,casasDec,sepDecimal,sepMilhar) {
    if (num < 0)
    {
        num = -num;
        sinal = -1;
    } else
        sinal = 1;
    var resposta = "";
    var part = "";
    if (num != Math.floor(num)) // decimal values present
    {
        part = Math.round((num-Math.floor(num))*Math.pow(10,casasDec)).toString(); // transforms decimal part into integer (rounded)
        while (part.length < casasDec)
            part = '0'+part;
        if (casasDec > 0)
        {
            resposta = sepDecimal+part;
            num = Math.floor(num);
        } else
            num = Math.round(num);
    } // end of decimal part
    while (num > 0) // integer part
    {
        part = (num - Math.floor(num/1000)*1000).toString(); // part = three less significant digits
        num = Math.floor(num/1000);
        if (num > 0)
            while (part.length < 3) // 123.023.123  if sepMilhar = '.'
                part = '0'+part; // 023
        resposta = part+resposta;
        if (num > 0)
            resposta = sepMilhar+resposta;
    }
    if (sinal < 0)
        resposta = '-'+resposta;
    return resposta;
} 
```

# java - How to use MySQL prepared statement caching?

> ID：222019
> 
> 赞同：8
> 
> 时间：2008-10-21T14:11:39.757
> 
> 标签：java, mysql, hibernate, jdbc, prepared-statement

How do i take advantage of MySQL's ability to cache prepared statements? One reason to use prepared statements is that there is no need to send the prepared statement itself multiple times if the same prepared statement is to be used again.

```
Class.forName("com.mysql.jdbc.Driver");
Connection conn = DriverManager.getConnection("jdbc:mysql://127.0.0.1:3306/mydb" +
        "?cachePrepStmts=true", "user", "pass");
for (int i = 0; i < 5; i++) {
    PreparedStatement ps = conn.prepareStatement("select * from MYTABLE where id=?");
    ps.setInt(1, 1);
    ps.execute();
}
conn.close() 
```

When running the above Java example I see 5 pairs of Prepare and Execute commands in the mysqld log file. Moving the ps assignment outside of the loop results in a single Prepare and 5 Execute commands of course. The connection parameter "cachePrepStmts=true" doesn't seem to make any difference here.
When running a similar program using Spring and Hibernate the number of Prepare commands sent (1 or 5) depends on whether the cachePrepStmts connection parameter is enabled. How does Hibernate execute prepared statements to take advantage of the cachePrepStmts setting? Is it possible to mimic this using pure JDBC?
I was running this on MySQL Server 4.1.22 and mysql-connector-java-5.0.4.jar

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-21T15:03:21.603

您应该只在循环之外准备一次语句，然后在循环中绑定参数。这就是准备好的语句具有绑定参数的原因——因此您可以重用准备好的语句。

Hibernate 正是这样做的，将所有 SQL 视为幕后准备好的语句，尽管如果您使用文字而不是绑定参数，您显然会滥用这一点。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-02-04T20:06:18.713

您还需要在连接实例上设置语句缓存大小。我假设默认缓存大小为 0。因此不会缓存任何内容。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-17T12:17:16.517

您应该在循环外准备语句。

```
Connection conn = DatabaseUtil.getConnection();
PreparedStatement stmtUpdate = conn.prepareStatement("UPDATE foo SET bar=? WHERE id = ?");
for(int id=0; id<10; id++){
    stmtUpdate.setString(1, "baz");
    stmtUpdate.setInt(2, id);
    int rows = stmtUpdate.executeUpdate();
    // Clear parameters for reusing the preparedStatement
    stmtUpdate.clearParameters();
}
conn.close(); 
```

我不知道 mysql 缓存准备好的语句，但这是 JDBC 准备好的语句应该被重用的方式。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-21T14:29:26.523

> Is it possible to mimic this using pure JDBC?

Is this not in fact what you've done by moving your prepared statement call out of the loop?

I may be misunderstanding the way the MySQL cache works, but does the log file necessarily report the cache's work? It may be that Spring or Hibernate has its own intermediate cache that checks the prepared statements against those sent earlier. It might be that that you're seeing when you run the program with Spring. That would mean doing a bit of tracing with your system to see if the mysqld log is just reporting the statements it's been sent, regardless of how it deals with them.

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-22T00:30:40.897

首先，您的 PreparedStatement 在循环中重新创建，因此允许 JDBC 驱动程序丢弃准备好的数据。所以你要求丑陋的行为，所以你得到了它。

然后，MySQL 中的 PreparedStatement 是独立的一章。要获得真正的缓存，您必须通过连接属性显式请求它。

因此，您必须将“cachePrepStmts”属性设置为“true”才能缓存准备好的语句。默认情况下，该属性设置为 false。

@查看你的 MySQL 版本的 MySQL 手册以获取详细信息

# sharepoint - SharePoint modification forms in state machine workflows

> ID：222026
> 
> 赞同：4
> 
> 时间：2008-10-21T14:12:58.693
> 
> 标签：sharepoint, workflow, state-machine, modification-form

I've been perplexed lately working on a SharePoint state machine workflow. I was hoping to add some modification forms to the workflow so that I could reassign a task while in its state. Unfortunately, modification forms don't seem to be documented for use with state machine workflows (pretty straight forward for sequence workflows though) anywhere that I can find. The use of the ScopeHandlingActivity and its associated event handlers don't seem to mesh well with the state machine.

Has anyone gotten modification forms to work in a state machine workflow and how did you go about doing it?

Thanks!

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2013-01-10T13:17:46.860

您为什么不直接修改任务表单并通过重新分配任务的可能性来扩展它？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2017-10-25T20:59:25.007

首先，我知道这是一个超级旧的线程，但由于它在搜索引擎结果中的位置很高，我想我会把解决方案放在这里。

您需要做的就是使用您的修改 GUID：

1.  在工作流的初始状态中添加 EnableWorkflowModification 活动
2.  将 EventDriven 活动添加到 WORKFLOW 范围。这是设计模式中最外层的边框
3.  在该 EventDriven 活动中添加 OnWorkflowModification 活动

补充说明：

*   标签中的 GUID 必须小写
*   对将所有者设置为工作流本身的修改活动使用单独的令牌，因此它始终在范围内

希望这个答案对将来的某人仍然有用！

# java - 如何将 EJB 公开为 web 服务，以便以后在 ejb 更改时保持客户端兼容性？

> ID：222028
> 
> 赞同：3
> 
> 时间：2008-10-21T14:13:13.153
> 
> 标签：java, web-services

许多框架让我将 ejb 公开为 Web 服务。

但是在发布初始服务 2 个月后，我需要更改 ejb 或其接口的任何部分。我仍然有需要访问旧界面的客户端，所以我显然需要 2 个具有不同签名的 Web 服务。

任何人都对我如何做到这一点有任何建议，最好让框架完成创建包装器和复制逻辑的繁重工作（除非有更聪明的方法）。

我可以在此基础上选择webservice框架，欢迎提出建议。

编辑：我知道我的更改会破坏兼容性，并且我完全意识到我将同时需要两个具有不同命名空间的服务。但是我怎样才能以简单的方式做到这一点？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-05T12:33:02.760

我不认为，你需要任何额外的框架来做到这一点。Java EE 允许您将 EJB 直接公开为 Web 服务（从[EJB 2.1](http://www.jcp.org/en/jsr/detail?id=153)开始；请参见[J2EE 1.4 的示例](http://java.sun.com/j2ee/1.4/docs/tutorial/doc/Session3.html#wp79822)），但使用 EE 5 就更简单了：

```
@WebService
@SOAPBinding(style = Style.RPC)
public interface ILegacyService extends IOtherLegacyService {
    // the interface methods
    ...
}

@Stateless
@Local(ILegacyService.class)
@WebService(endpointInterface = "...ILegacyService", ...)
public class LegacyServiceImpl implements ILegacyService {
    // implementation of ILegacyService
} 
```

根据您的应用程序服务器，您应该能够`ILegacyService`在任何适合的位置提供。正如jezell所说，您应该尝试将不更改合同的更改直接放入此接口中。如果您有其他更改，您可能只是提供具有不同接口的另一个实现。通用逻辑可以拉到`LegacyServiceImpl`.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-21T14:33:06.610

我不是 EBJ 人，但我可以告诉你这在 Web 服务世界中通常是如何处理的。如果您对合同进行了非破坏性更改（例如，添加一个可选的属性），那么您可以简单地更新合同并且消费者应该没问题。

如果您对合同进行了重大更改，那么处理它的方法是创建一个新服务，并为其类型创建一个新的命名空间。例如，如果您的第一个服务的命名空间为：

[http://myservice.com/2006](http://myservice.com/2006)

你的新人可能有：

[http://myservice.com/2009](http://myservice.com/2009)

将此合同公开给新的消费者。

如何处理旧合同取决于您。您可以将所有请求定向到旧服务器，并让客户端选择何时升级到新服务器。如果您可以使用一些逻辑将请求升级为新服务期望的格式，那么您可以删除旧服务的逻辑并将其替换为对新服务的调用。或者，您可能只是将其全部弃用，并使对旧服务的所有调用都失败。

PS：如果您创建消息类对象而不是重用域实体，这将更容易处理。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-23T05:10:25.917

好的，这就去；

dozer.sourceforge.net 似乎是在两个并行结构之间复制数据的繁重工作的可接受起点。我想很多 Web 框架可以生成客户端代理，这些代理可以在服务器上下文中重复使用以保持兼容性。

# c# - 拖动 WPF Popup 控件

> ID：222029
> 
> 赞同：21
> 
> 时间：2008-10-21T14:13:24.153
> 
> 标签：c#, .net, wpf, xaml, popup

WPF Popup 控件很好，但在我看来有些局限。有没有办法在打开弹出窗口时“拖动”它（就像窗口的 DragMove() 方法一样）？

这可以在没有大问题的情况下完成，还是我必须自己编写弹出类的替代品？谢谢

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-10-21T15:07:32.577

PopUp 没有 DragMove。只是一个小工作，你可以添加很多改进。

```
<Popup x:Name="pop" IsOpen="True" Height="200" Placement="AbsolutePoint"  Width="200">
   <Rectangle Stretch="Fill" Fill="Red"/>            
</Popup> 
```

在后面的代码中，添加这个 mousemove 事件

```
 pop.MouseMove += new MouseEventHandler(pop_MouseMove);

   void pop_MouseMove(object sender, MouseEventArgs e)
    {
        if (e.LeftButton == MouseButtonState.Pressed)
        {
            pop.PlacementRectangle = new Rect(new Point(e.GetPosition(this).X,
                e.GetPosition(this).Y),new Point(200,200));

        }
    } 
```

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2011-11-17T16:26:23.437

这是一个使用拇指的简单解决方案。

*   XAML 和代码隐藏中的子类弹出窗口
*   添加宽度/高度设置为 0 的 Thumb（这也可以在 XAML 中完成）
*   在 Popup 上侦听 MouseDown 事件并在 Thumb 上引发相同的事件
*   在 DragDelta 上移动弹出窗口

XAML：

```
<Popup x:Class="PopupTest.DraggablePopup" ...>
    <Canvas x:Name="ContentCanvas">

    </Canvas>
</Popup> 
```

C＃：

```
public partial class DraggablePopup : Popup 
{
    public DraggablePopup()
    {
        var thumb = new Thumb
        {
            Width = 0,
            Height = 0,
        };
        ContentCanvas.Children.Add(thumb);

        MouseDown += (sender, e) =>
        {
            thumb.RaiseEvent(e);
        };

        thumb.DragDelta += (sender, e) =>
        {
            HorizontalOffset += e.HorizontalChange;
            VerticalOffset += e.VerticalChange;
        };
    }
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2011-11-02T06:39:25.533

实现此目的的另一种方法是将 Popup 的位置设置为 MousePoint。这使得弹出窗口最初出现在鼠标光标的位置。

然后您可以使用 Thumb 或 MouseMove 事件来设置 Popup 的 Horizo​​ntalOffset 和 VerticalOffset。当用户拖动弹出窗口时，这些属性会将弹出窗口从其原始位置移开。

请记住将 Horizo​​ntalOffset 和 VerticalOffset 重置为零，以便下次使用弹出窗口！

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2011-12-09T18:28:52.977

鼠标移动过快的问题，可以解决

* * *

这取自 msdn：

> 新窗口包含 Popup 的子内容。
> 
> Popup 控件维护对其子内容的引用作为逻辑子项。创建新窗口时，Popup 的内容成为该窗口的可视子窗口，并且仍然是 Popup 的逻辑子窗口。相反，Popup 仍然是其子内容的逻辑父级。

* * *

换句话说，弹出窗口的子窗口显示在独立窗口中。

因此，当尝试执行以下操作时：
`Popup.CaptureMouse()`正在捕获包装窗口而不是弹出窗口本身。而是使用`Popup.Child.CaptureMouse()`捕获实际的弹出窗口。

并且所有其他事件都应该使用`Popup.Child`.

像`Popup.Child.MouseMove`，`Popup.Child.LostCapture`等等

这已经过测试并且工作正常

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2019-02-13T19:16:01.150

根据[Jobi Joy](https://stackoverflow.com/a/222219/4484284)的回答，我找到了一个可重用的解决方案，它允许您在现有控件/页面的 xaml 中添加为控件。这是不可能添加为带有名称的 Xaml 的，因为它具有不同的范围。

```
 [ContentProperty("Child")]
    [DefaultEvent("Opened")]
    [DefaultProperty("Child")]
    [Localizability(LocalizationCategory.None)]
    public class DraggablePopup : Popup
    {
        public DraggablePopup()
        {
            MouseDown += (sender, e) =>
            {
                Thumb.RaiseEvent(e);
            };

            Thumb.DragDelta += (sender, e) =>
            {
                HorizontalOffset += e.HorizontalChange;
                VerticalOffset += e.VerticalChange;
            };
        }

        /// <summary>
        /// The original child added via Xaml
        /// </summary>
        public UIElement TrueChild { get; private set; }

        public Thumb Thumb { get; private set; } = new Thumb
        {
            Width = 0,
            Height = 0,
        };

        protected override void OnInitialized(EventArgs e)
        {
            base.OnInitialized(e);

            TrueChild = Child;

            var surrogateChild = new StackPanel();

            RemoveLogicalChild(TrueChild);

            surrogateChild.Children.Add(Thumb);
            surrogateChild.Children.Add(TrueChild);

            AddLogicalChild(surrogateChild);
            Child = surrogateChild;
        }
    } 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2021-07-26T13:06:53.793

与其他人对此的说法相反，我 100% 同意 Jobi Joy 的回答（老实说，这应该是公认的答案）。我看到一条评论指出答案中的解决方案会导致内存碎片。这是不可能的，因为创建新结构根本不会导致内存碎片；事实上，使用结构可以节省内存，因为它们是堆栈分配的。此外，我认为这实际上是重新定位弹出窗口的正确方法（毕竟，微软添加 PlacementRectangle 属性是有原因的），所以它不是一个 hack。然而，添加 Thumbs 并期望用户总是将 Popup 放置到画布上，这非常笨拙，并不总是一个实用的解决方案。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2011-04-30T18:28:11.910

```
Private Point startPoint;

 private void Window_PreviewMouseLeftButtonDown(object sender, MouseButtonEventArgs e)
    {

        startPoint = e.GetPosition(null);
    }
private void Window_MouseMove(object sender, MouseEventArgs e)
    {
        if (e.LeftButton == MouseButtonState.Pressed)
        {
            Point relative = e.GetPosition(null);
            Point AbsolutePos = new Point(relative.X + this.Left, relative.Y + this.Top);
            this.Top = AbsolutePos.Y - startPoint.Y;
            this.Left = AbsolutePos.X - startPoint.X;
        }
    } 
```

这适用于拖动我的窗口，但就像它被告知如果我快速移动鼠标，它会离开窗口并停止引发事件。更不用说拖动一点也不顺畅。有谁知道如何正确地做到这一点，漂亮而流畅的拖动，拖动过快时不会失去它？？？如果可能，请发布一个简单的示例，而不是让像我这样的初学者迷失在代码中的整个教程。谢谢！

# c# - 如何使用 .NET 创建 7-Zip 存档？

> ID：222030
> 
> 赞同：110
> 
> 时间：2008-10-21T14:13:47.070
> 
> 标签：c#, .net, compression, 7zip

如何从我的 C# 控制台应用程序创建 7-Zip 存档？我需要能够使用常规的、广泛可用[的 7-Zip](http://www.7-zip.org/)程序来提取档案。

* * *

## 这是我的结果，其中提供了作为此问题答案的示例

*   “脱壳”到 7z.exe - 这是最简单、最有效的方法，我可以确认**它运行良好**。正如[workmad3所提到](https://stackoverflow.com/questions/222030/how-do-i-create-7-zip-archives-with-net#222047)的，我只需要保证所有目标机器上都安装了7z.exe，这是我可以保证的。
*   [7Zip in memory compression](http://www.eggheadcafe.com/tutorials/aspnet/064b41e4-60bc-4d35-9136-368603bcc27a/7zip-lzma-inmemory-com.aspx) - 这是指在发送到客户端之前“在内存中”压缩 cookie；这种方法似乎有些前途。包装器方法（包装[LZMA SDK](http://www.7-zip.org/sdk.html)）返回类型`byte[]`。当我将`byte[]`数组写入文件时，我无法使用 7-Zip ( `File.7z is not supported archive`) 提取它。
*   [7zSharp](http://www.codeplex.com/7zsharp) Wrapper（可在 CodePlex 上找到）——它包装了 7z exe/ [LZMA SDK](http://www.7-zip.org/sdk.html)。我从我的应用程序中引用了该项目，它成功创建了一些存档文件，但我无法使用常规 7-Zip 程序 ( `File.7z is not supported archive`) 提取文件。
*   [7Zip SDK 又名 LZMA SDK](http://www.7-zip.org/sdk.html) - 我想我不够聪明，无法弄清楚如何使用它（这就是我在此处发布的原因）......任何演示创建 7zip 存档的工作代码示例都可以由常规的 7zip 程序？
*   [用于 7-Zip 存档 DLL 的 CodeProject C# (.NET) 接口](http://www.codeproject.com/KB/DLL/cs_interface_7zip.aspx)- 仅支持从 7zip 存档中提取...我需要创建它们！
*   [SharpZipLib](http://sharpdevelop.net/OpenSource/SharpZipLib/Default.aspx) - 根据他们的[常见问题解答](http://wiki.sharpdevelop.net/SharpZipLib_FAQ.ashx)，SharpZipLib 不支持 7zip。

* * *

## 回答 #1

> 赞同：82
> 
> 时间：2008-10-21T14:15:00.030

[EggCafe 7Zip cookie 示例](http://www.eggheadcafe.com/tutorials/aspnet/064b41e4-60bc-4d35-9136-368603bcc27a/7zip-lzma-inmemory-com.aspx)这是一个带有 7Zip DLL 的示例（压缩 cookie）。

[CodePlex Wrapper](http://www.codeplex.com/7zsharp) 这是一个开源项目，可以扭曲 7z 的压缩功能。

[7Zip SDK](http://www.7-zip.org/sdk.html) 7zip (C, C++, C#, Java)的官方SDK <---我的建议

.Net zip 库由[SharpDevelop.net](http://sharpdevelop.net/OpenSource/SharpzipLib/)

带有 7zip 的[CodeProject示例](http://www.codeproject.com/KB/DLL/cs_interface_7zip.aspx)

[SharpZipLib](http://community.sharpdevelop.net/blogs/johnreilly/default.aspx)许多压缩

* * *

## 回答 #2

> 赞同：31
> 
> 时间：2008-10-21T14:18:42.020

如果您可以保证 7-zip 应用程序将在所有目标计算机上安装（并在路径中），则可以通过调用命令行应用程序 7z 来卸载。不是最优雅的解决方案，但它是最少的工作。

* * *

## 回答 #3

> 赞同：25
> 
> 时间：2009-03-08T20:57:54.173

[SevenZipSharp](http://www.codeplex.com/sevenzipsharp)是另一种解决方案。创建 7-zip 档案...

* * *

## 回答 #4

> 赞同：25
> 
> 时间：2012-01-08T07:01:20.850

这是在 C# 中使用 SevenZip SDK 的完整工作示例。

它将写入和读取由 Windows 7zip 应用程序创建的标准 7zip 文件。

PS。前面的示例永远不会解压缩，因为它从未将所需的属性信息写入文件的开头。

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using SevenZip.Compression.LZMA;
using System.IO;
using SevenZip;

namespace VHD_Director
{
    class My7Zip
    {
        public static void CompressFileLZMA(string inFile, string outFile)
        {
            Int32 dictionary = 1 << 23;
            Int32 posStateBits = 2;
            Int32 litContextBits = 3; // for normal files
            // UInt32 litContextBits = 0; // for 32-bit data
            Int32 litPosBits = 0;
            // UInt32 litPosBits = 2; // for 32-bit data
            Int32 algorithm = 2;
            Int32 numFastBytes = 128;

            string mf = "bt4";
            bool eos = true;
            bool stdInMode = false;

            CoderPropID[] propIDs =  {
                CoderPropID.DictionarySize,
                CoderPropID.PosStateBits,
                CoderPropID.LitContextBits,
                CoderPropID.LitPosBits,
                CoderPropID.Algorithm,
                CoderPropID.NumFastBytes,
                CoderPropID.MatchFinder,
                CoderPropID.EndMarker
            };

            object[] properties = {
                (Int32)(dictionary),
                (Int32)(posStateBits),
                (Int32)(litContextBits),
                (Int32)(litPosBits),
                (Int32)(algorithm),
                (Int32)(numFastBytes),
                mf,
                eos
            };

            using (FileStream inStream = new FileStream(inFile, FileMode.Open))
            {
                using (FileStream outStream = new FileStream(outFile, FileMode.Create))
                {
                    SevenZip.Compression.LZMA.Encoder encoder = new SevenZip.Compression.LZMA.Encoder();
                    encoder.SetCoderProperties(propIDs, properties);
                    encoder.WriteCoderProperties(outStream);
                    Int64 fileSize;
                    if (eos || stdInMode)
                        fileSize = -1;
                    else
                        fileSize = inStream.Length;
                    for (int i = 0; i < 8; i++)
                        outStream.WriteByte((Byte)(fileSize >> (8 * i)));
                    encoder.Code(inStream, outStream, -1, -1, null);
                }
            }

        }

        public static void DecompressFileLZMA(string inFile, string outFile)
        {
            using (FileStream input = new FileStream(inFile, FileMode.Open))
            {
                using (FileStream output = new FileStream(outFile, FileMode.Create))
                {
                    SevenZip.Compression.LZMA.Decoder decoder = new SevenZip.Compression.LZMA.Decoder();

                    byte[] properties = new byte[5];
                    if (input.Read(properties, 0, 5) != 5)
                        throw (new Exception("input .lzma is too short"));
                    decoder.SetDecoderProperties(properties);

                    long outSize = 0;
                    for (int i = 0; i < 8; i++)
                    {
                        int v = input.ReadByte();
                        if (v < 0)
                            throw (new Exception("Can't Read 1"));
                        outSize |= ((long)(byte)v) << (8 * i);
                    }
                    long compressedSize = input.Length - input.Position;

                    decoder.Code(input, output, compressedSize, outSize, null);
                }
            }
        }

        public static void Test()
        {
            CompressFileLZMA("DiscUtils.pdb", "DiscUtils.pdb.7z");
            DecompressFileLZMA("DiscUtils.pdb.7z", "DiscUtils.pdb2");
        }
    }
} 
```

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2008-12-15T04:45:31.470

我用的是sdk。

例如：

```
using SevenZip.Compression.LZMA;
private static void CompressFileLZMA(string inFile, string outFile)
{
   SevenZip.Compression.LZMA.Encoder coder = new SevenZip.Compression.LZMA.Encoder();

   using (FileStream input = new FileStream(inFile, FileMode.Open))
   {
      using (FileStream output = new FileStream(outFile, FileMode.Create))
      {
          coder.Code(input, output, -1, -1, null);
          output.Flush();
      }
   }
} 
```

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2015-01-17T07:11:12.713

```
 string zipfile = @"E:\Folderx\NPPES.zip";
 string folder = @"E:\TargetFolderx";

 ExtractFile(zipfile,folder);
public void ExtractFile(string source, string destination)
        {
            // If the directory doesn't exist, create it.
            if (!Directory.Exists(destination))
                Directory.CreateDirectory(destination);

            //string zPath = ConfigurationManager.AppSettings["FileExtactorEXE"];
          //  string zPath = Properties.Settings.Default.FileExtactorEXE; ;

            string zPath=@"C:\Program Files\7-Zip\7zG.exe";

            try
            {
                ProcessStartInfo pro = new ProcessStartInfo();
                pro.WindowStyle = ProcessWindowStyle.Hidden;
                pro.FileName = zPath;
                pro.Arguments = "x \"" + source + "\" -o" + destination;
                Process x = Process.Start(pro);
                x.WaitForExit();
            }
            catch (System.Exception Ex) { }
        } 
```

只需从源代码安装 7 zip 并将参数传递给方法。

谢谢。请喜欢答案。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2019-07-29T09:37:18.480

使用 17.9MB 文本文件的 @Orwellophile 代码的一些附加测试信息。
“按原样”使用代码示例中的属性值将对性能产生巨大的负面影响，需要**14.16 秒**。

将属性设置为以下在**3.91 秒**时执行相同的工作（ia 存档将具有相同的容器信息，即：您可以使用 7zip 提取和测试存档，但没有文件名信息）

本机 7zip **2 秒。**

```
CoderPropID[] propIDs =  {
  //CoderPropID.DictionarySize,
  //CoderPropID.PosStateBits,
  //CoderPropID.LitContextBits,
  //CoderPropID.LitPosBits,
  //CoderPropID.Algorithm,
  //CoderPropID.NumFastBytes,
  //CoderPropID.MatchFinder,
  CoderPropID.EndMarker
};
object[] properties = {
  //(Int32)(dictionary),
  //(Int32)(posStateBits),
  //(Int32)(litContextBits),
  //(Int32)(litPosBits),
  //(Int32)(algorithm),
  //(Int32)(numFastBytes),
  //mf,
  eos
}; 
```

我使用本机 7zip 和 1,2GB SQL 备份文件 (.bak)
7zip（最大压缩）进行了另一项测试：**1 分钟**
LZMA SDK（@Orwellophile 具有上述属性设置）： 12: **26 分钟**:-(输出文件
大小大致相同.

所以我想我自己会使用基于 c/c++ 引擎的解决方案，ia 要么从 c# 调用 7zip 可执行文件，要么使用[squid-box/SevenZipSharp](https://github.com/squid-box/SevenZipSharp)，它是 7zip c/c++ dll 文件的包装器，似乎成为 SevenZipSharp 的最新分支。尚未测试包装器，但我希望其性能与原生 7zip 一样。但希望它可以提供压缩流的可能性，如果你直接调用 exe，你显然不能。否则，我想调用 exe 并没有什么优势。包装器有一些[额外的依赖项](https://github.com/squid-box/SevenZipSharp/issues/54)，因此它不会使您发布的项目“更干净”。

顺便说一句，.Net Core 团队似乎考虑在 .Core 版本的 system.io 类中实现 LZMA。5，那太好了！

（我知道这是一种评论而不是答案，但能够提供代码片段它不能是评论）

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2014-07-18T03:06:17.140

我使用此代码

```
 string PZipPath = @"C:\Program Files\7-Zip\7z.exe";
                string sourceCompressDir = @"C:\Test";
                string targetCompressName = @"C:\Test\abc.zip";
                string CompressName = targetCompressName.Split('\\').Last();
                string[] fileCompressList = Directory.GetFiles(sourceCompressDir, "*.*");

                    if (fileCompressList.Length == 0)
                    {
                        MessageBox.Show("No file in directory", "Important Message");
                        return;
                    }
                    string filetozip = null;
                    foreach (string filename in fileCompressList)
                    {
                        filetozip = filetozip + "\"" + filename + " ";
                    }

                    ProcessStartInfo pCompress = new ProcessStartInfo();
                    pCompress.FileName = PZipPath;
                    if (chkRequestPWD.Checked == true)
                    {
                        pCompress.Arguments = "a -tzip \"" + targetCompressName + "\" " + filetozip + " -mx=9" + " -p" + tbPassword.Text;
                    }
                    else
                    {
                        pCompress.Arguments = "a -tzip \"" + targetCompressName + "\" \"" + filetozip + "\" -mx=9";
                    }
                    pCompress.WindowStyle = ProcessWindowStyle.Hidden;
                    Process x = Process.Start(pCompress);
                    x.WaitForExit(); 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2018-12-22T14:53:14.733

安装名为的 NuGet 包`SevenZipSharp.Interop`

然后：

```
SevenZipBase.SetLibraryPath(@".\x86\7z.dll");
var compressor = new SevenZip.SevenZipCompressor();
var filesToCompress = Directory.GetFiles(@"D:\data\");
compressor.CompressFiles(@"C:\archive\abc.7z", filesToCompress); 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2015-02-06T14:39:00.300

这些最简单的方法是使用 .zip 文件而不是 .7z 并使用[Dot Net Zip](http://dotnetzip.codeplex.com/)

在将 7zip 命令转为 shell 时，还有其他问题，例如用户权限，我遇到了 SevenZipSharp 的问题。

```
Private Function CompressFile(filename As String) As Boolean
Using zip As New ZipFile()
    zip.AddFile(filename & ".txt", "")
    zip.Save(filename & ".zip")
End Using

Return File.Exists(filename & ".zip")
End Function 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2016-10-26T18:13:48.430

[SharpCompress](https://github.com/adamhathcock/sharpcompress)在我看来是最聪明的压缩库之一。它支持 LZMA (7-zip)，易于使用且正在积极开发中。

由于它已经支持 LZMA 流媒体，不幸的是，在撰写本文时它只支持 7-zip 存档读取。但是存档写作在他们的待办事项列表上（参见自述文件）。对于未来的读者：在此处查看当前状态：[https ://github.com/adamhathcock/sharpcompress/blob/master/FORMATS.md](https://github.com/adamhathcock/sharpcompress/blob/master/FORMATS.md)

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2021-04-28T10:23:25.043

[这](https://github.com/ninad2110/managed-lzma/blob/master/sandbox-7z/Program.cs)是创建和提取 7zip 的代码（基于 LZMA SDK - C#）

注意：使用相同代码创建的 7z 存档可以取消存档。由于代码使用使用早期版本的 LZMA SDK 的托管 LZMA

# asp.net - ASP.NET 选项卡控件

> ID：222040
> 
> 赞同：4
> 
> 时间：2008-10-21T14:17:22.490
> 
> 标签：asp.net, asp.net-ajax

我目前正在尝试在 Web 应用程序中创建选项卡式界面，根据我的搜索，ASP.NET 中没有任何“内置”选项卡控件。有一些在[ASP.NET AJAX](http://www.asp.net/ajax/)可下载工具包中，以及大量“按使用付费”的第三方选项卡控件。

我的问题是：您在 ASP.NET 应用程序中使用了哪些 Tab 控件，为什么要使用它？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-21T14:30:51.340

您可以使用 MultiView/Views 和您自己的导航来获取 ASP.NET 中的选项卡。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-21T14:44:44.947

我过去使用过 AJAX [TabControl](http://www.asp.net/Ajax/Ajaxcontroltoolkit/samples/Tabs/Tabs.aspx)，我喜欢它。这很简单。访问活动选项卡及其内容很容易。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-21T14:47:40.370

我使用了 Telerik 的 Rad [TabStrip](http://www.telerik.com/products/aspnet-ajax/controls/tabstrip/overview.aspx)控件，我认为它是最好的控件之一。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-21T15:19:59.620

我们大部分时间都使用多视图，或者在某些情况下，我们使用链接按钮和重叠面板的组合构建自己的选项卡控件，并根据按下的链接按钮交换它们的可见性（这可能看起来很原始，但它效果很好）。

# perl - 在 Perl 中向二进制字符串添加 1 的最简单方法是什么？

> ID：222043
> 
> 赞同：7
> 
> 时间：2008-10-21T14:17:46.203
> 
> 标签：perl, binary, math

我有一个包含 4 字节网络顺序 IPv4 地址的变量（这是使用 pack 和整数表示创建的）。我有另一个变量，也是一个 4 字节的网络顺序子网。我正在尝试将它们添加在一起并添加一个以获得子网中的第一个 IP。

要获取 ASCII 表示，我可以`inet_ntoa($ip&$netmask)`获取基地址，但这样做是错误的`inet_ntoa((($ip&$netmask)+1)`；我收到如下消息：

```
 Argument "\n\r&\0" isn't numeric in addition (+) at test.pm line 95. 
```

所以发生了什么，据我所知，最好的是它正在查看 4 个字节，发现 4 个字节不代表数字字符串，然后拒绝加 1。

另一种说法：我想要它做的是在最低有效字节上加 1，我知道这是第 4 个字节？也就是说，我想获取字符串`\n\r&\0`并以字符串结尾`\n\r&\1`。最简单的方法是什么？

有没有办法做到这一点而不必解包和重新打包变量？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-10-21T14:31:36.813

发生的事情是您使用 制作一个字节字符串`$ip&$netmask`，然后尝试将其视为一个数字。像这样的，这是行不通的。你必须喂的`inet_ntoa`是。

```
pack("N", unpack("N", $ip&$netmask) + 1) 
```

我认为没有更简单的方法可以做到这一点。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-10-21T14:51:16.103

混淆整数和字符串。也许以下代码会有所帮助：

```
use Socket;

$ip = pack("C4", 192,168,250,66); # why not inet_aton("192.168.250.66")
$netmask = pack("C4", 255,255,255,0);

$ipi = unpack("N", $ip);
$netmaski = unpack("N", $netmask);

$ip1 = pack("N", ($ipi&$netmaski)+1);
print inet_ntoa($ip1), "\n"; 
```

哪个输出：

```
192.168.250.1 
```

# wpf - 如何更新 WPF 中工具栏的 ControlTemplate 中的标签？

> ID：222052
> 
> 赞同：1
> 
> 时间：2008-10-21T14:20:56.040
> 
> 标签：wpf, templatebinding

我有一个由 ToolBarTray 和 ToolBar 组成的 ControlTemplate。在我的工具栏中，我有几个按钮，然后是一个标签。我希望能够使用“1 of 10”之类的内容更新工具栏中的标签

我的第一个想法是以编程方式找到标签并设置它，但我读到这应该用触发器来完成。我很难理解如何做到这一点。有任何想法吗？

```
 <Style x:Key="DocViewerToolBarStyle" TargetType="{x:Type ContentControl}">
   <Setter Property="Template">
     <Setter.Value>
           <ControlTemplate TargetType="{x:Type ContentControl}">
              <ToolBarTray... />
              <ToolBar.../>
              <Button../>             
              <Button..>

             <Label x:Name="myStatusLabel"  .. /> 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-21T14:33:07.217

我会将标签设置为控件的“内容”属性，例如

```
<Label x:Name="myStatusLabel"  Content="{TemplateBinding Content}"/> 
```

然后，您可以使用顶级对象的 Content 属性设置标签的文本。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-21T14:41:15.797

ControlTemplate 的目的是定义控件的外观。对于您的问题，我不确定控制模板是否是正确的解决方案。

正如 Bryan 还指出的那样，您应该将 Label 的*Content*属性绑定到控件中已经存在的属性。这应该通过*TemplateBinding*完成。

```
<Label x:Name="myStatusLabel" Content={TemplateBinding MyStatusLabelProperty} ../> 
```

然后属性*MyStatusLabelProperty*必须存在于您的控件类中。通常，您将创建自己的*UserControl*，该 UserControl 具有名为 MyStatusLabelProperty 的正确类型（对象或字符串）的依赖项属性。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-29T19:13:06.533

我将创建一个实现 INotifyPropertyChanged 接口的视图模型，并使用 DataTemplate 来显示它，如下所示：

```
<DataTemplate DataType={x:Type viewmodel:MyToolBarViewModel}>
    <Label Content={Binding CurrentPage} />
    <Label Content={Binding TotalPages} ContentStringFormat="{}of {0}" />
</DataTemplate>

<ToolBar>
    <ContentPresenter Content={Binding <PathtoViewModel>} />
</ToolBar> 
```

通过使用绑定，您不必显式更新标签的内容。您所要做的就是在视图模型中设置属性的值并引发适当的 PropertyChanged 事件，这会导致标签更新其内容。

# c# - BaseType 的 BaseType

> ID：222053
> 
> 赞同：11
> 
> 时间：2008-10-21T14:21:06.010
> 
> 标签：c#

这是我在这里的第一个问题，所以我希望我能很好地表达它，并希望它不会太容易让人麻木。

我有以下类*SubSim*扩展*Sim*，扩展*MainSim*。在一个完全独立的类（以及库）中，我需要检查传递的对象是否是*MainSim*的一种。因此进行以下检查；

```
类型 t = GetType(sim);
//在这种情况下，sim = SubSim
如果（t！= null）
{
  返回 t.BaseType == typeof(MainSim);
}

```

显然*t.BaseType*将返回*Sim*因为*Type.BaseType*获取当前 Type 直接继承的类型。

除了必须做*t.BaseType.BaseType*来获得*MainSub*，还有其他方法可以使用 .NET 库获得正确的类型吗？或者是否有可以重新定义以返回主类的覆盖？

先感谢您

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-10-21T14:23:26.923

有4种相关的标准方式：

```
sim is MainSim;
(sim as MainSim) != null;
sim.GetType().IsSubclassOf(typeof(MainSim));
typeof(MainSim).IsAssignableFrom(sim.GetType()); 
```

您还可以创建递归方法：

```
bool IsMainSimType(Type t)
 { if (t == typeof(MainSim)) return true;   
   if (t == typeof(object) ) return false;
   return IsMainSimType(t.BaseType);
 } 
```

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-10-21T14:22:33.837

```
if (sim is MainSim) 
```

是你所需要的全部。"is" 查找继承树。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-21T14:23:36.050

使用[`is`关键字](http://msdn.microsoft.com/en-us/library/scekt9xw(VS.71).aspx)：

```
return t is MainSim; 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-21T15:09:39.733

“是”选项对我不起作用。它给了我警告；“给定的表达式永远不是提供的（'MainSim'）类型”，但我相信，警告更多地与我们现有的框架有关。我的解决方案最终是：

```
返回 t.BaseType == typeof(MainSim) || t.BaseType.IsSubclassof(typeof(MainSim));
```

不像我希望的那样干净，或者像你的答案看起来那样简单。无论如何，谢谢大家的回答。它们的简单性让我意识到我有很多东西要学。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-21T14:24:20.667

“是”怎么说？

[http://msdn.microsoft.com/en-us/library/scekt9xw(VS.71).aspx](http://msdn.microsoft.com/en-us/library/scekt9xw(VS.71).aspx)

# asp.net - Webform_SaveScrollPositionSubmit 未定义

> ID：222058
> 
> 赞同：2
> 
> 时间：2008-10-21T14:22:18.580
> 
> 标签：asp.net, javascript

把故事剪得更短，在 page 指令中有一个带有 MaintainScrollPositionOnPostback="true" 的 asp.net 页面（我尝试在 page_load 中将其设置为 true），但是我得到了上面的 javascript 错误（Webform_SaveScrollPositionSubmit 没有定义）和我猜测页面要滚动，因为该 js 函数“未定义”...

使用 asp.net 2.0 和 firefox 3...dosent 也在 internut exploader 中工作。尝试过运行aspnet_regiis -c，但没有任何乐趣...

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-21T14:28:11.750

没关系！似乎自定义 HttpModule（具有 ResponseFilter）对页面做了一些讨厌的事情。将 HttpModule 重写为 HttpHandler 并将其绑定到 *.aspx，这样它就不会干扰 WebResource.axd

# sql-server - 在 SQL Server 中将唯一索引创建为“索引”或“约束”有什么区别？

> ID：222065
> 
> 赞同：13
> 
> 时间：2008-10-21T14:23:44.227
> 
> 标签：sql-server, indexing, constraints, unique

在将要成为 UNIQUE（但不是表的主键）的列上创建索引时，SQL Server 让我选择几个选项：

1）我可以选择它是一个约束或索引。
我猜这意味着如果我将它设置为约束，它不会在查询时使用它，只有在写入时。但是，我能想到的让 SQL Server 强制执行该约束的唯一有效方法是实际构建索引。这个选项有什么用？

2）另外，如果我将它设置为“索引”，它让我指定它应该忽略重复的键。这对我来说是最令人费解的......
我再次猜测它意味着与约束相反。它可能意味着“在查询时使用它，但在写入时甚至不检查”。
但那我为什么要把它设置为 UNIQUE 呢？
我猜 SQL Server 可以做一些优化，但我想更好地理解它。

有谁知道 SQL Server 究竟对这些选项做了什么？
将索引设置为唯一但忽略重复键的用例是什么？

注意：这适用于 SQL Server 2000

* * *

**编辑：**根据你所说的，但是......如果我创建一个约束，它将用于加速使用约束中的字段进行过滤的查询？

谢谢！

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-21T15:24:35.537

`UNIQUE`约束是 ISO/ANSI SQL 标准的一部分，而索引不是因为该标准与实现无关。SQL Server 与大多数 SQL DBMS 一样，将使用索引来实现`UNIQUE`约束。

可以说，在 SQL 脚本中使用`UNIQUE`而不是索引*更*便于移植，但如果专有语法提供优化等机会，则不应排除它。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-21T14:40:51.727

SQL Server 将建立一个索引来实现 UNIQUE 约束。[您可以在sys.key_constraints](http://msdn.microsoft.com/en-us/library/ms174321.aspx)视图中看到对用于强制唯一约束的唯一索引的引用（在 2005 年 — 抱歉，我不知道 2000 年的等效项）。但是两个版本在查询时都会使用索引。

不同之处在于，如果您创建索引，您可以更好地控制它的构建方式。特别是，您可以包括可能与键一起经常查找的其他列。

这两个选项都允许您“忽略*现有*数据上的重复键”，但如果您尝试插入与现有数据重复的*新*值，两者都会引发错误。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-21T14:45:34.323

除了唯一约束也在数据库中作为约束对象列出这一事实之外，唯一约束和唯一索引之间没有实际区别。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2012-09-14T14:44:56.063

根据 MSDN，通过唯一约束创建唯一索引或使用 CREATE UNIQUE INDEX 语句显式创建之间没有显着差异。在这两种情况下，都以相同的方式验证数据的唯一性，并且查询优化器不会对它们进行任何不同的处理。作为一种好的做法，如果目标是数据完整性，则使用唯一约束，否则直接使用 CREATE UNIQUE INDEX 语句。

[这](http://csharp-video-tutorials.blogspot.co.uk/2012/09/unique-and-non-unique-indexes-part-37.html)是一篇优秀的文章和一段视频，解释了这两种方法之间的区别。

# wpf - 如何加速 WPF 程序？

> ID：222070
> 
> 赞同：50
> 
> 时间：2008-10-21T14:24:59.167
> 
> 标签：wpf, performance

我喜欢使用 Windows Presentation Framework 进行编程。大多数情况下，我使用 WPF 和 XAML 编写类似浏览器的应用程序。

但真正让我烦恼的是 WPF 的缓慢性。只有几个控件的简单页面加载速度足够快，但是一旦页面稍微复杂一点，比如包含大量数据输入字段、一两个选项卡控件等等，它就会变得很痛苦。

加载此类页面可能需要一秒钟以上。确实是几秒钟，尤其是在不那么快的计算机上（阅读：客户计算机），这可能需要很长时间。

与更改页面上的值相同。关于 WPF UI 的一切都有些迟钝。

这太卑鄙了！他们给了我这个漂亮的框架，但让它变得非常缓慢，所以我不得不一直向我们的客户道歉！

我的问题：

1.  你如何加速 WPF？
2.  您如何描述瓶颈？
3.  你如何处理缓慢的问题？

由于这似乎是 WPF 的普遍问题，我正在寻找一般建议，对许多情况和问题很有用。

其他一些相关问题：

*   [你使用什么工具进行 WPF 开发](https://stackoverflow.com/questions/38642/what-tools-do-you-use-for-wpf-development)
*   [开发 WPF 或 Silverlight 应用程序的工具](https://stackoverflow.com/questions/189244/tools-to-develop-wpf-or-silverlight-applications)

* * *

## 回答 #1

> 赞同：39
> 
> 时间：2008-10-23T15:27:39.557

1.  **你如何加速 WPF？**

    通常在使用以下分析工具之一之后，很明显是什么导致了我的瓶颈。

    *   如果内存是问题，那么我会虚拟化我的数据。
    *   如果渲染时间是问题，那么我会虚拟化控件或尽可能简化控件模板。
    *   如果处理时间是问题，我会尝试改进我的算法或将该工作移至后台线程，并在工作进行时在我的 ui 中显示一个 throbber。

2.  **您如何描述瓶颈？**

    *   [.NET 内存过滤器](http://memprofiler.com/)
    *   [点跟踪](http://www.jetbrains.com/profiler/)
    *   [WPF 的性能分析工具](http://windowsclient.net/wpf/perf/wpf-perf-tool.aspx)
    *   [窥探](http://blois.us/Snoop/)
    *   [破解网](http://www.codeplex.com/cracknetproject)

3.  **你如何处理缓慢的问题？**

    分析和咨询。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-21T14:29:19.550

安装 SP1... 为 WPF 带来大量非常酷的性能提升！！！

[在这里](http://windowsclient.net/wpf/wpf35/wpf-whats-new-35sp1.aspx)阅读更多

这是 SP1 中的 2 个增强功能的示例：延迟[滚动和 UI 元素回收](http://dotnet.org.za/rudi/archive/2008/05/22/scrolling-performance-in-wpf.aspx)！

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2010-06-01T20:30:10.420

我无法添加评论，这就是我发布新答案的原因：我从 pdc09 中找到了这个视频，它提供了一些关于如何配置 wpf 应用程序的想法，因为它对我有很大帮助，我想分享链接：

[高级 WPF 应用程序性能调整和分析](http://microsoftpdc.com/Sessions/CL11)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-21T15:21:45.043

WPF 适用于具有现代显卡的计算机。您的客户是否拥有能够运行 Aero 的现代显卡？如果您的客户使用较旧的显卡，则 WPF 将回退到与硬件加速图形相比运行速度极慢的软件渲染。

您可能还想分析您的应用程序以确保它实际上是 WPF 是慢的部分。可能还有其他东西实际上是瓶颈。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-21T14:36:09.583

避免动画有时也很有帮助。如果您必须使用动画，请降低帧率，这将提高“感觉”性能

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-16T16:25:01.717

移除 Alpha 透明度/位图效果。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-21T17:58:26.740

你能提供更多细节吗？

当我使用诸如列表视图或具有一定复杂性的网格之类的东西时，我才注意到性能缓慢。解决方案是简化它。

除此之外，我只注意到第一次加载应用程序时性能很慢。

高温高压

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-06-23T02:39:39.100

我发现绕过 XAML 并用 C# 编写整个 UI 很有帮助。这让我可以精确控制何时创建和加载控件。它还帮助我了解 XAML “在幕后”在做什么。

# sharepoint - Microsoft 付费支持对您来说值得吗？

> ID：222072
> 
> 赞同：5
> 
> 时间：2008-10-21T14:25:31.383
> 
> 标签：sharepoint

[我在这个问题](https://stackoverflow.com/questions/221716/most-large-companies-prefer-wisa-over-lamp-why)中看到了这句话：

> MS 支持很差，除非您支付了支持合同的费用……然后它非常非常好。– gbjbaanb

这让我开始思考。几个月前（在 Stack Overflow 上线之前），我的公司与 Microsoft 发生了 2 起支持事件。在这两种情况下，我们都在突破我们正在构建的 SharePoint 系统的限制，并且 API 没有公开事件来让我们知道操作何时完成。两次，微软的回应都是告诉我们添加一个`Thread.Sleep()`调用，然后等待操作完成。

现在，我完全支持社区共同努力回答问题，但有时您的问题无法在线获得答案。

在您找不到答案的时候，付费支持对您来说是否值得？

如果您在 Microsoft 付费支持方面取得了成功，请分享这是什么类型的问题。我试图准确了解支持事件的预期结果。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-10-21T14:28:47.227

是的，它有。如果您已经努力自己解决问题，那么在找到任何能够理解问题的人之前，您必须至少找到第三个人，也许第四个人可以提供帮助。

不过，一旦你找到那个人——我发现支持非常好，有很多后续行动，我什至有一位 MS 支持人员帮助我解决与我们的一位客户的复杂 ASP.NET 部署问题。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-21T14:35:29.117

它被混合了。

如果您幸运并与合适的人交谈，他们可以提供宝贵的见解。

另一方面，你可能会得到另一双同情的眼睛。这可能会有所帮助，但不值得花钱。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-21T14:44:06.120

我也有过很好的经验，但与其他一些人一样，我会说你通常必须升级问题才能得到解决。但是，一旦您这样做，他们就会很好地跟进，并提供详细的帮助。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-21T14:52:32.903

我非常幸运地致电 MS 寻求支持。通常，打电话给任何大公司寻求支持都是一场噩梦。对我来说，例外是 MS 和 Oracle。对于 MS，我给他们打了 3 个电话，其中 2 个是 IT 相关的，一个是编程或 Visual Studio 相关的问题。抱歉，我不记得有什么问题。我记得由于我们之间的口音差异，在理解其中一位代表时有些困难，但他非常好，我们通过了它。这是大约 3 年前的事了。

另一件事是我发现销售代表想让你休息一下。如果这是一个错误，他们不会向您收费，并且根据我的经验，所有代表都对此非常公平。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-21T14:33:03.490

是的，我有机会使用 Microsoft 的付费支持。我正在为一家 dot-com 工作，我们在使用 ASP 的主站点上遇到了间歇性崩溃。当错误在网站上弹出并发送了一些进行分析时，我被要求运行此实用程序以生成故障转储。分析表明，代码中进行的字符串连接的数量是一个潜在问题，因为这会导致内存碎片化，并导致问题，因为代码有数百个连接，有时代码甚至不需要这样做，例如在一行中会有“blah blah blah”和“more more more”，其中&是不必要的并导致部分问题，

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-21T14:35:54.683

我只有一次获得 Microsoft 支持的经验，在那种情况下，我发现缺乏这种支持。在电话上打了几个小时后，他们得出结论，没有办法解决我的问题（无法修改 IIS 中的任何网站设置），我们必须重新安装所有内容。后来我找到了一种自己修复它的方法，而无需通过手动编辑文件来完成所有这些。不过那是大约 8 年前的事了，从那以后我就再也不用和他们打交道了。

# sql-server - 从 SQL Server 收到的未知令牌

> ID：222086
> 
> 赞同：1
> 
> 时间：2008-10-21T14:29:29.673
> 
> 标签：sql-server, odbc-sql-server-driver

尝试在 SQL Server 查询分析器中运行查询时出现此错误。是什么原因？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-21T15:13:17.667

如果您正在使用游标，那么您可能已经关闭了游标。查看 MSDN 了解更多信息 ( [http://support.microsoft.com/kb/15169](http://support.microsoft.com/kb/15169) 3)

如果您不使用游标，则可能是服务器问题，请检查日志。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2021-05-04T23:48:34.720

在时间流逝之前，知识库文章：

* * *

文章 ID：151693 - 上次审核：2003 年 10 月 3 日 - 修订：3.0

# [修复：错误消息“从 SQL Server 接收到未知令牌”](https://web.archive.org/web/20091123103812/http://support.microsoft.com/kb/151693)

## 症状

当您将语句选项设置为使用服务器端游标并在 SQL Server 系统表上准备 select 语句时，第一次执行 select 会成功创建游标。关闭此游标后，如果再次执行准备好的语句，则会出现以下错误消息：

> 从 SQL Server 收到的未知令牌。

## 解决方法

在系统表上使用只进游标而不是静态、键集或动态游标。请注意，如果在用户定义的表或视图上创建服务器端游标，则不会出现此问题。

如果只进游标不可接受，请在系统表上再次准备 select 语句并执行它以创建服务器端游标。请注意，第一次执行工作正常，应用程序通常不需要在系统表上重复创建游标。

## 地位

Microsoft 已经确认这是 Microsoft SQL Server 版本 6.50.0201 中的问题。此问题已在 Microsoft SQL Server 6.5 版的美国 Service Pack 1 中得到纠正。有关更多信息，请联系您的主要支持提供商。

# c# - 在 C# 中，如果 2 个进程正在读取和写入同一个文件，那么避免进程锁定异常的最佳方法是什么？

> ID：222089
> 
> 赞同：25
> 
> 时间：2008-10-21T14:30:23.447
> 
> 标签：c#, file-io, distributed

使用以下文件读取代码：

```
using (FileStream fileStream = new FileStream(fileName, FileMode.Open, FileAccess.Read, FileShare.None))
{
    using (TextReader tr = new StreamReader(fileStream))
    {
        string fileContents = tr.ReadToEnd();
    }
} 
```

和下面的文件写代码：

```
using (TextWriter tw = new StreamWriter(fileName))
{
    tw.Write(fileContents);
    tw.Close();
} 
```

可以看到以下异常详细信息：

> 该进程无法访问文件“c:\temp\myfile.txt”，因为它正被另一个进程使用。

避免这种情况的最佳方法是什么？读者是否需要在收到异常后重试，还是有更好的方法？

请注意，阅读器进程使用*FileSystemWatcher*来了解文件何时更改。

另请注意，在这种情况下，我**不是**在寻找在两个进程之间共享字符串的替代方法。

* * *

## 回答 #1

> 赞同：38
> 
> 时间：2008-10-21T14:35:54.560

您可以打开一个文件进行写入并且只锁定写入权限，从而允许其他人仍然读取该文件。

例如，

```
using (FileStream stream = new FileStream(@"C:\Myfile.txt", FileMode.Open, FileAccess.ReadWrite, FileShare.Read))
{
   // Do your writing here.
} 
```

其他文件访问只是打开文件进行读写，并允许读写共享。

```
using (FileStream stream = new FileStream(@"C:\Myfile.txt", FileMode.Open, FileAccess.Read, FileShare.ReadWrite))
{
   // Does reading  here.
} 
```

如果您想确保读者将始终阅读最新文件，您将需要使用锁定文件来指示有人正在写入该文件（尽管如果不仔细实施，您可能会遇到竞争条件）或使确保在打开以读取和处理异常时阻止写入共享，以便您可以重试，直到获得独占访问权限。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-10-21T14:37:14.853

如果您创建了一个命名的互斥锁，您可以在写入应用程序中定义互斥锁，并让读取应用程序等到互斥锁被释放。

所以在当前正在使用 FileSystemWatcher 的通知进程中，只需检查是否需要等待互斥锁，如果需要，它将等待，然后处理。

这是我发现[的类似 Mutex 的 VB 示例](http://www.developerfusion.com/article/5184/multithreading-in-vbnet/4/)，它应该很容易转换为 C#。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-21T14:38:05.337

如果正在写入文件，请让您的进程检查文件的状态。您可以通过锁定文件的存在来做到这一点（即，这个其他文件的存在，可以是空的，防止写入主文件）。

然而，即使这也不是故障安全的，因为两个进程可能同时创建锁定文件 - 但您可以在提交写入之前检查这一点。

如果您的进程遇到锁定文件，则让它简单地休眠/等待，并在未来以预定义的时间间隔重试。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-21T14:51:10.333

使用 FileShare.None 打开文件有什么特别的原因吗？这将防止文件被任何其他进程打开。

FileShare.Write 或 FileShare.ReadWrite 应该允许其他进程（受权限限制）在您读取文件时打开和写入文件，但是您必须在读取文件时注意文件在您下方的更改 - 只是缓冲打开时的内容可能会有所帮助。

然而，所有这些答案都是同样有效的——最好的解决方案取决于你试图对文件做什么：如果在保证它不会改变的同时读取它很重要，那么锁定它并处理随后的异常在您的编写代码中；如果同时读取和写入它很重要，则更改 FileShare 常量。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-21T14:32:04.893

`Mutex`您可以为此使用对象。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-10-21T15:02:26.737

读取器和写入器都需要重试机制。*FileShare*也应该设置为*FileShare.read*为 reader 和*FileShare.none*为 writer。这应该确保读取器在写入过程中不会读取文件。

阅读器（不包括重试）变为

```
using (FileStream fileStream = new FileStream(fileName, FileMode.Open, FileAccess.Read, FileShare.Read))
{
    using (TextReader tr = new StreamReader(fileStream))
    {
        string fileContents = tr.ReadToEnd();
    }
} 
```

写入器（不包括重试）变为：

```
FileStream fileStream = new FileStream(fileName, FileMode.Create, FileAccess.Write, FileShare.None);
using (TextWriter tw = new StreamWriter(fileStream))
{
    tw.Write(fileContents);
    tw.Close();
} 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-21T14:44:29.083

写入临时文件，完成写入后将文件重命名/移动到读者正在查找的位置和/或名称。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2013-05-07T20:21:12.697

最好的办法是将应用程序协议放在文件传输/所有权传输机制之上。“锁定文件”机制是一种古老的 UNIX hack，已经存在了很长时间。最好的办法就是将文件“交给”读者。有很多方法可以做到这一点。您可以使用随机文件名创建文件，然后将该名称“提供”给阅读器。这将允许作者异步写入另一个文件。想想“网页”是如何工作的。一个网页有一个指向更多信息的“链接”，包括图像、脚本、外部内容等。服务器将那个页面交给你，因为它是你想要的“资源”的连贯视图。然后你的浏览器会去获取适当的内容，

This is the most resilient type of "sharing" mechanism to use. Write the file, share the name, move to the next file. The "sharing the name" part, is the atomic hand off that makes sure that both parties (the reader and the writer) agree that the content is "complete."

# eclipse - 如何以编程方式运行 Eclipse 启动配置？

> ID：222093
> 
> 赞同：40
> 
> 时间：2008-10-21T14:31:03.337
> 
> 标签：eclipse, build-process, eclipse-plugin, eclipse-pde

我发现很难很好地表达这个问题，因为有很多通用术语（运行、配置、启动等）。开始：

您可以[将运行配置保存在`.launch`文件](http://eclipsesnippets.blogspot.com/2007/07/tip-creating-and-sharing-launch.html)中。（在运行配置对话框的常用选项卡下，另存为共享文件。

我们将这些签入到 SVN。开发人员可以传递它们，这有助于让新开发人员更快地运行工作应用程序。

我想将这些作为我们构建的一部分进行检查，并使用它们以编程方式运行应用程序、测试等，而无需启动整个 IDE。

`.launch`在 UI 之外运行文件的最佳方式是什么？

**编辑**：我正在尝试统一在构建服务器和 IDE 上运行的测试。我并不是特别想放弃集成调试，使用 ant 脚本运行测试就是这种情况。

对于使用多个捆绑包进行集成测试或对整个捆绑包进行单元测试，这可能是一个更大的问题，您希望在其中模拟扩展。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-20T14:43:24.643

有一个基于 JUnit 构建的 Eclipse 插件，称为 TPTP。它提供了一个自动化客户端，可用于在没有 gui 的情况下从 eclipse 启动测试。也许它有帮助

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-21T14:31:52.710

[Ant4Eclipse](http://ant4eclipse.sourceforge.net/ant-for-eclipse-reference-launch.html)可以为如何做到这一点提供一个很好的起点。

不幸的是，这仅限于 Java 应用程序和 JUnit 配置；我对 PDE 应用程序和插件 JUnit 测试更感兴趣。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2012-04-12T17:36:00.253

我最近使用 Eclipse Buckminster 在 Hudson CI 服务器内构建了一个 Eclipse RCP 应用程序取得了很大的成功。这需要做一些工作，但是一旦我设置了这两个功能，使我的 RCP 产品基于功能，并添加了 Buckminster 查询文件等，它就可以工作了。有一个 Hudson/Jenkins Buckminster 插件允许我让 hudson 构建应用程序。

在保存每个测试片段的启动配置后，我创建了 hudson 命令来调用它们（不幸的是，每个测试片段只有一行），但之后我得到了我想要的自动化 CI 构建。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2013-06-26T22:52:08.893

您还可以使用 Eclipse 使用的 shell 命令。为拿到它，为实现它：

1.  在 Eclipse 中运行你的程序
2.  转到“调试”视图
3.  右键单击进程（可能是树中的第二项）并选择“属性”
4.  复制 shell 命令并删除 agentlib 标志以在 bash 中运行

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-06-17T23:28:40.087

也许以您运行自己的自定义运行配置的方式运行配置会有所帮助。它在[这篇文章](http://www.eclipse.org/articles/Article-Launch-Framework/launch.html)中有所描述。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-20T15:37:31.550

我认为您不需要使用 .launch 配置来运行测试。如果您使用 Eclipse Build System 构建应用程序，那么您可以使用 Eclipse 中的 AntRunner 应用程序来运行您的单元测试。这不会启动整个 IDE。

[本文介绍了如何在构建过程中运行测试](http://www.eclipse.org/articles/Article-PDE-Automation/automation.html)。通过这个过程，您可以使用特殊的“测试”Eclipse 并加载您想要测试的插件。

# .net - 有什么方法可以添加一些默认程序集来解析 Unity / ObjectBuilder 中的类型？

> ID：222102
> 
> 赞同：0
> 
> 时间：2008-10-21T14:32:25.783
> 
> 标签：.net, inversion-of-control, unity-container

我正在使用 MS Unity IoC 框架进行我的第一个项目。

如果我的统一配置中有这个：

```
 <container name="TestBusiness">
    <types>
      <type type="PFServer.DataAccess.TestDataAccess" /> 
```

然后我得到错误：

> 无法从程序集“Microsoft.Practices.Unity.Configuration，Version=1.1.0.0，Culture=neutral，PublicKeyToken=31bf3856ad364e35”加载类型“PFServer.DataAccess.TestDataAccess”。

但是，如果我将程序集名称添加到类型定义中：

```
 <container name="TestBusiness">
    <types>
      <type type="PFServer.DataAccess.TestDataAccess, PFServer" /> 
```

然后它工作正常。有没有办法添加一些默认的程序集来加载类型？在这种情况下，奇怪的是“PFServer.dll”是包含所有这些配置的程序集。我觉得奇怪的是当前程序集不在解析对象的路径中......或者我只是做错了什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-22T11:44:36.900

Unity 通过调用静态方法 Type.GetType(string) 将字符串解析为 Type 对象，该方法需要一个[AssemblyQualifiedName](http://msdn.microsoft.com/en-us/library/system.type.assemblyqualifiedname.aspx)参数。对 GetType 的调用是在 Microsoft.Practices.Unity.Configuration 程序集中进行的，该程序集不知道您的 PFServer 程序集，因此它需要字符串中的程序集名称。

我认为类型别名可能会对您有所帮助。这是一个例子。

```
<unity>
    <typeAliases>
        <typeAlias alias="TestDataAccess" type="PFServer.DataAccess.TestDataAccess, PFServer" />
        ...
    </typeAliases>

    <containers>
      <container name="TestBusiness">
        <types>
            <type type="TestDataAccess" />
            ... 
```

# java - 获取 Java 线程 id 和失控 Java 线程的堆栈跟踪

> ID：222108
> 
> 赞同：17
> 
> 时间：2008-10-21T14:34:52.160
> 
> 标签：java, debugging, jstack

在我最繁忙的生产安装中，有时我会得到一个似乎陷入无限循环的单线程。经过大量研究和调试，我还没有弄清楚谁是罪魁祸首，但似乎应该是可能的。以下是血淋淋的细节：

***当前调试说明：***

1) **ps -eL 18975**向我显示 Linux pid 问题子线程，19269

```
$ps -eL | grep 18975
...
PID   LWP   TTY          TIME CMD
18975 18994 ?        00:00:05 java
18975 19268 ?        00:00:00 java
18975 19269 ?        05:16:49 java
18975 19271 ?        00:01:22 java
18975 19273 ?        00:00:00 java
... 
```

2) **jstack -l 18975**表示没有死锁，**jstack -m 18975**不起作用

3）**jstack -l 18975**确实给了我所有线程的堆栈跟踪（〜400）。示例线程堆栈（*而不是问题*）：

```
“http-342.877.573.944-8080-360”守护进程prio=10 tid=0x0000002adaba9c00 nid=0x754c in Object.wait() [0x00000000595bc000..0x00000000595bccb0]
   java.lang.Thread.State：等待（在对象监视器上）
        在 java.lang.Object.wait（本机方法）
        - 等待（org.apache.tomcat.util.net.JIoEndpoint$Worker）
        在 java.lang.Object.wait(Object.java:485)
        在 org.apache.tomcat.util.net.JIoEndpoint$Worker.await(JIoEndpoint.java:416)
        - 锁定（一个 org.apache.tomcat.util.net.JIoEndpoint$Worker）
        在 org.apache.tomcat.util.net.JIoEndpoint$Worker.run(JIoEndpoint.java:442)
        在 java.lang.Thread.run(Thread.java:619)

```

4) ps -eL 输出的线程 ID 与 jstack 的输出不匹配，或者至少我看不到它。（jstack 文档有点稀疏。）

5) 没有繁重的 IO、内存使用或其他相应的活动线索可供使用。

***平台：***

*   爪哇 6
*   雄猫 6
*   RHEL 4（64 位）

有人知道我如何从 linux ps 输出到我的问题子 java 线程建立连接吗？这么近，又这么远……

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-07-29T09:53:04.977

看起来 jstack 输出中的**nid**是 Linux LWP id。

```
"http-342.877.573.944-8080-360" daemon prio=10 tid=0x0000002adaba9c00 nid=0x754c in Object.wait() [0x00000000595bc000..0x00000000595bccb0] 
```

将 nid 转换为十进制，您就有了 LWP id。在您的情况下，0x754c 是 30028。此过程未显示在我们的 ps 输出中，但它可能是您为节省空间而省略的 LWP 之一。

这是一个 Perl 片段，您可以使用管道将 jstack 的输出传递到：

```
#!/usr/bin/perl -w
while (<>) {
    if (/nid=(0x[[:xdigit:]]+)/) {
        $lwp = hex($1);
        s/nid=/lwp=$lwp nid=/;
    }
    print;
} 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-10-21T14:47:20.823

您可以使用[JConsole](http://java.sun.com/developer/technicalArticles/J2SE/jconsole.html)查看线程的堆栈跟踪。

如果您使用 JDK 1.6.0_07 或更高版本，您也可以使用[visualvm](http://java.sun.com/javase/6/docs/technotes/guides/visualvm/index.html)。

这两种工具都可以很好地查看应用程序中所有正在运行的线程。visualvm 好一点，但希望看到所有线程可以帮助您追踪失控线程。

检查*始终*处于 RUNNING 状态的线程。当我们有一个失控的线程时，堆栈跟踪会不断变化。所以我们能够判断循环调用了哪些方法，并追踪循环。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-03-30T14:03:14.900

很好，有用的答案！

对于 Linux，使用 ps -efL，-L 选项将显示 LWP。附带说明一下，
*“http-342.877.573.944-8080-360”守护进程 prio=10*表示“ *ThreadName*（由 JVM 给出）”*运行模式*（继承自 pid）*优先级*（继承自 pid）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-22T03:31:14.043

如果您在控制台上按 CTRL-BREAK，您将从内存中获得当前线程的转储及其一些堆栈跟踪帧。

从内存中（我不确定这是 IntelliJ IDEa 功能，还是 java 中的默认功能），但它会告诉您哪个线程死锁，以及它们正在等待哪个对象。您应该能够将输出重定向到文件，并且只需 grep 获取 DEADLOCKED 文本。

JConsole、VisualVM 或其他分析器（如 JProfiler）也会向您显示线程及其堆栈，但是如果您不想使用任何外部工具，我认为 CTRL-BREAK 将为您提供所需的内容。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-11-25T16:13:59.833

## 在太阳

请注意，`prstat`默认情况下显示轻量级进程的数量，而不是 LWPID。

要查看特定用户的所有轻量级进程的信息，请使用该`-L`选项。

```
prstat -L -v -u weblogic 
```

现在使用 LWPID 并将其转换为十六进制并将其与线程转储中的 nid 匹配

# mfc - MFC 扩展 DLL 中的 C++/CLI

> ID：222113
> 
> 赞同：3
> 
> 时间：2008-10-21T14:36:06.337
> 
> 标签：mfc, c++-cli

我有一个使用多个 MFC 扩展 DLL 的 MFC 应用程序。我希望这个应用程序（以及其他几个类似的应用程序）能够访问 .net 框架的某些部分。我编写了一个 C# 库来完成我想要的 .net 工作，并希望能够编写一个 MFC dll 来隐藏我的应用程序中的所有 C++/CLI 代码。这些应用程序将保留为纯 MFC 应用程序，唯一的 C++/CLI 代码将在我的新 MFX 扩展 DLL 中。但是，当我这样做时，应用程序在访问新的 MFC C++/CLI dll 时崩溃了。如果我将 C++/CLI 代码放在应用程序中，它可以正常工作，我可以一直调试到 C#。

有谁明白为什么 dll 的想法不起作用？

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-22T02:25:00.773

您不能从纯本机代码中引用托管程序集。您必须翻转使用者上的 /clr 开关（在项目范围内或在某些文件中）或进行一些互操作。

允许您的消费者说纯本机的一种互操作选项是通过[COM Callable Wrapper](http://msdn.microsoft.com/en-us/library/f07c8z1c.aspx)调用托管程序集。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-04T06:48:10.320

我相信我遇到了类似的问题。我的设置类似——一个纯 MFC 应用程序，带有一个纯 MFC DLL，而后者又与 C++/CLI DLL 交互。一切都会运行良好，但它会在退出时崩溃。该问题在使用 CppUnit 测试纯 MFC DLL 时更加严重。

在调试时，我发现由于一个错误，我的 C++ 代码在退出时抛出了访问冲突（通过悬空指针引用的对象）的第一次机会异常。现在，C++ 运行时在退出时会忽略这些违规，而 CLR 不会。CLR 运行时引发未处理的异常，使其看起来程序/单元测试崩溃。

您的问题可能有所不同，但听起来确实与我的问题非常相似。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-22T07:31:42.340

MFC dll 项目引用了 C# 库，并有一个使用 /clr 编译的文件，用于处理与我的 C# 库的接口。实际上，我有时在运行时看到过这项工作，但从未能够调试到 MFC dll 或 C# 代码中。但是，在大多数情况下，它似乎根本不稳定并且崩溃。

# language-agnostic - 垃圾收集和运行时类型信息

> ID：222117
> 
> 赞同：1
> 
> 时间：2008-10-21T14:36:35.027
> 
> 标签：language-agnostic, garbage-collection, language-implementation

[fixnum 问题](https://stackoverflow.com/questions/106597/why-are-fixnums-in-emacs-only-29-bits)让我想到了另一个我想了很久的问题。

许多关于垃圾收集的在线资料并没有说明如何实现运行时类型信息。因此，我对各种垃圾收集器了解很多，但并不真正了解如何实现它们。

fixnum 解决方案实际上非常好，很清楚哪个值是指针，哪个不是。还有哪些其他常用的存储类型信息的解决方案？

另外，我想知道 fixnum -thing。这是否意味着您仅限于每个数组索引上的 fixnums？或者是否有某种解决方法可以获得完整的 64 位整数？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-21T15:11:27.857

基本上，为了实现准确的标记，您需要元数据来指示哪些单词被用作指针，哪些不是。

这个元数据可以按引用存储，就像 emacs 一样。如果对于您的语言/实现，您不太关心内存使用，您甚至可以使引用大于单词（可能是单词的两倍），以便每个引用都可以携带类型信息及其单字数据。这样，您可以拥有一个完整大小的 32 位指针的固定编号，代价是所有引用都是 64 位。

或者，元数据可以与其他类型信息一起存储。因此，例如，一个类除了通常的函数指针表外，还可以包含数据布局的每个字一位，指示该字是否包含垃圾收集器应遵循的引用。如果您的语言具有虚拟调用，那么您必须已经有一种方法可以从对象中计算出要使用的函数地址，因此相同的机制将允许您计算出要使用的标记数据 - 通常您会添加一个额外的秘密指针每个对象的开始，指向构成其运行时类型的类。显然，对于某些动态语言，指向的类型数据需要在写入时复制，因为它是可修改的。

堆栈也可以做类似的事情——将准确的标记信息存储在代码本身的数据部分中，并让垃圾收集器检查存储的程序计数器和/或堆栈上的链接指针，和/或由堆栈放置在堆栈上的其他信息为此目的的代码，以确定堆栈的每一位与哪个代码相关，因此哪些字是指针。轻量级异常机制倾向于做类似的事情来存储关于代码中出现 try/catch 的信息，当然调试器也需要能够解释堆栈，所以这很可能与一堆其他东西一起折叠您已经在实现任何语言，包括具有内置垃圾收集的语言。

请注意，垃圾收集不一定需要准确的标记。您可以将每个单词视为一个指针，无论它是否真的存在，在垃圾收集器的“所有内容的大列表”中查找它，以确定它是否可以引用尚未标记的对象，如果所以将其视为对该对象的引用。这很简单，但代价当然是介于“非常慢”和“非常慢”之间，具体取决于 gc 用于查找的数据结构。此外，有时一个整数恰好与未引用对象的地址具有相同的值，并导致您保留一大堆本应收集的对象。所以这样的垃圾收集器不能提供关于未引用对象被收集的强有力的保证。这对于玩具实现或第一个工作版本可能很好，但不太可能受到用户的欢迎。

比如说，一种混合​​方法可以准确地标记对象，但不能准确标记堆栈中特别多毛的区域。例如，如果您编写的 JIT 可以创建代码，其中引用的对象地址仅出现在寄存器中，而不出现在您通常的堆栈槽中，那么您可能需要不准确地跟踪操作系统存储寄存器时的堆栈区域取消调度有问题的线程以运行垃圾收集器。这可能非常繁琐，因此一种合理的方法（可能导致代码变慢）是要求 JIT 始终在准确标记的堆栈上保留它正在使用的所有指针值的副本。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-02T21:23:48.533

在 Squeak（我猜也是 Scheme 和许多其他动态语言）中`SmallInteger`，你有 31 位有符号整数类和任意大整数类，例如`LargePositiveInteger`. 很可能有其他表示形式，64 位整数或者作为完整对象或带有几个位作为“我不是指针”标志。

但是算术方法被编码为处理过流/不足流，因此如果将 1 添加到`SmallInteger maxVal`，则得到 2^30 + 1 作为 的实例`LargePositiveInteger`，如果从中减去 1，则得到 2^30 作为`SmallInteger`.

# sql-server - SQL Server 2005 - Error_Message() 未显示完整消息

> ID：222119
> 
> 赞同：2
> 
> 时间：2008-10-21T14:36:36.603
> 
> 标签：sql-server, sql-server-2005, error-handling, try-catch

我在 Try/Catch 中封装了一个备份数据库命令，似乎错误消息在某处丢失。例如：

```
BACKUP DATABASE NonExistantDB TO DISK = 'C:\TEMP\NonExistantDB.bak' 
```

..给出错误：
***无法在 sysdatabases 中找到数据库“NonExistantDB”的条目。未找到具有该名称的条目。确保输入的名称正确。BACKUP DATABASE 异常终止。***

然而：

```
BEGIN TRY
    BACKUP DATABASE NonExistantDB TO DISK = 'C:\TEMP\NonExistantDB.bak'
END TRY
BEGIN CATCH
    PRINT ERROR_MESSAGE()
END CATCH 
```

...只给出错误： ***备份数据库异常终止。***

有没有办法获得完整的错误消息，或者这是 try/catch 的限制？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-21T15:22:12.797

这是 try/catch 的限制。

如果仔细查看执行产生的错误

```
 BACKUP DATABASE NonExistantDB TO DISK = 'C:\TEMP\NonExistantDB.bak' 
```

你会发现有两个错误被抛出。第一个是 msg 911，它指出

> 在 sysdatabases 中找不到数据库“NonExistantDB”的条目。未找到具有该名称的条目。确保输入的名称正确。

第二个是您正在显示的 3013 消息。基本上，SQL 只返回最后一个错误。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-07-06T20:23:58.657

这是我刚刚遇到的 SQL 2005 中的 try/catch 块的限制。我不知道它在 2008 年是否仍然存在。

[SQL 2005 错误处理](http://blogs.msdn.com/b/sqlprogrammability/archive/2006/04/03/567550.aspx)

# ibm-midrange - RPG(LE) 中的数据结构定义/模板

> ID：222127
> 
> 赞同：4
> 
> 时间：2008-10-21T14:39:59.467
> 
> 标签：ibm-midrange, rpgle

假设我有一个数据结构，例如

```
d dog           DS                  qualified
d   name                        20
d   breed                       20
d   birthdate                    8  0 
```

然后我可以定义

```
d   poochie                         likeds(dog) 
```

并使用 poochie.name 等。

但是我可以将“狗”设置为模板而不在内存中创建结构吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-02T09:24:50.350

In V6R1 there will be another keyword that is called TEMPLATE. Datastructures with It are not created in the memory and are just used by the compiler for reference. You can also combine it with inz() to have default values in your likeds().

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-21T16:04:35.287

我想到了两个选择。第一种是使用狗属性的 d-specs 创建一个源成员，而不是使用 likes(dog)，而是在每个将使用该子字段定义的数据结构之后有一个 /copy。在我看来，这可能会导致一些草率的代码，并且可能会让某人难以分析。另一方面，如果您在多个程序中使用相同的数据结构，则有好处。

想到的第二个选项是在 dog 数据结构上使用 Based() 关键字，然后定义一个指针字段。指针字段会占用一些内存，但 dog 数据结构在您的程序分配之前不会占用任何内存。Based() 关键字不会延续到使用 LikeDS() 对其定义的其他数据结构中。这样您就可以在程序源中定义数据结构。您不必为它分配内存，也不必将指针设置为任何值。它默认为空。请注意不要在代码中访问 dog 数据结构。你会得到一个指针错误，看起来就像你的程序在没有必需参数的情况下被调用一样。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-12T19:00:54.587

这样做：基于（指针名称）

使用指针是不必要的——我认为会做你想做的事。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-21T15:49:24.270

据我所知，没有。但也许可以对子程序做类似的事情。

[在Midrange.com RPG-L](http://lists.midrange.com/listinfo/rpg400-l)上发布这个问题，比我聪明的人可能会回答你的问题。

# python - 使用 Python globals() 动态类的最佳方法

> ID：222133
> 
> 赞同：6
> 
> 时间：2008-10-21T14:41:54.500
> 
> 标签：python, coding-style, namespaces

我正在开发一个 Web 应用程序，它将根据用户输入返回一组可变的模块。每个模块都是一个 Python 类，其构造函数接受单个参数并具有包含输出的“.html”属性。

从全局命名空间中动态拉取类是可行的：

```
result = globals()[classname](param).html 
```

它肯定比以下内容更简洁：

```
if classname == 'Foo':
    result = Foo(param).html
elif classname == 'Bar':
    ... 
```

从风格上讲，什么被认为是写这篇文章的最佳方式？是否有不使用全局命名空间的风险或理由？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-21T15:43:46.980

这种方法的一个缺陷是它可能使用户能够做的比你想要的更多。他们只需提供名称即可调用该命名空间中的*任何*单参数函数。您可以通过一些检查来帮助防止这种情况（例如 isinstance(SomeBaseClass, theClass)，但最好避免这种方法。另一个缺点是它限制了您的班级布置。如果您最终有几十个这样的班级并决定要将它们分组到模块中，您的查找代码将停止工作。

您有几个备选方案：

1.  创建显式映射：

    ```
     class_lookup = {'Class1' : Class1, ... }
     ...
     result = class_lookup[className](param).html 
    ```

    尽管这样做的缺点是您必须重新列出所有类。

2.  将类嵌套在封闭范围内。例如。在自己的模块或外部类中定义它们：

    ```
    class Namespace(object):
        class Class1(object):
            ...
        class Class2(object):
            ...
    ...
    result = getattr(Namespace, className)(param).html 
    ```

    尽管（__bases__，__getattribute__ 等），您确实无意中在这里公开了几个额外的类变量 - 可能无法利用，但并不完美。

3.  从子类树构造一个查找字典。让你的所有类都继承自一个基类。创建所有类后，检查所有基类并从中填充字典。这样做的好处是您可以在任何地方定义您的类（例如，在单独的模块中），并且只要您在创建所有注册表后创建注册表，您就会找到它们。

    ```
    def register_subclasses(base):
        d={}
        for cls in base.__subclasses__():
            d[cls.__name__] = cls
            d.update(register_subclasses(cls))
        return d

    class_lookup = register_subclasses(MyBaseClass) 
    ```

    上面的一个更高级的变体是使用自注册类——创建一个元类，而不是在字典中自动注册任何创建的类。对于这种情况，这可能是矫枉过正——尽管它在某些“用户插件”场景中很有用。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-21T15:32:59.030

首先，听起来您可能正在重新发明轮子……大多数 Python Web 框架（我所知道的是 CherryPy/TurboGears）已经包含一种根据 URL 的内容将请求分派到特定类的方法，或用户输入。

实际上，您执行此操作的方式没有任何**问题**，但根据我的经验，它往往表明您的程序中存在某种“缺少抽象”。您基本上是依靠 Python 解释器来存储您可能需要的对象列表，而不是自己存储它。

因此，作为第一步，您可能只想制作一个包含您可能要调用的所有类的字典：

```
dispatch = {'Foo': Foo, 'Bar': Bar, 'Bizbaz': Bizbaz} 
```

最初，这不会有太大的不同。但是随着您的网络应用程序的增长，您可能会发现几个优点：（a）您不会遇到命名空间冲突，（b）使用`globals()`您可能会遇到安全问题，攻击者可以在本质上访问您程序中的任何全局符号，如果他们可以找到一种方法将任意`classname`注入到您的程序中，（c）如果您想要拥有`classname`除实际确切类名之外的其他内容，使用您自己的字典会更灵活，（d）您可以将`dispatch`字典替换为如果您发现需要，可以进行数据库访问或类似操作的更灵活的用户定义类。

安全问题对于 Web 应用程序来说尤为突出。`globals()[variable]`从 web 表单中输入 where只是`variable`自**找麻烦**。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-22T06:18:41.553

在类名和类之间建立映射的另一种方法：

定义类时，将属性添加到要放入查找表中的任何类，例如：

```
class Foo:
    lookup = True
    def __init__(self, params):
        # and so on 
```

完成后，构建查找图是：

```
class_lookup = zip([(c, globals()[c]) for c in dir() if hasattr(globals()[c], "lookup")]) 
```

# css - 您应该将样式表分解到什么程度？

> ID：222139
> 
> 赞同：15
> 
> 时间：2008-10-21T14:44:37.897
> 
> 标签：css

我正在为我的公司建立一个新网站，我正处于创建第一页的 html 模型的阶段。我将以此作为网站其余部分的基础。我正在考虑更好地组织我的样式表，现在我的设计看起来跨浏览器一致，但我想知道当我分解它时要走多远。

一个想法是有以下几点：

*   重置.css
*   排版.css
*   布局.css
*   颜色.css

但我在哪里画线？从理论上讲，我可以继续将它们分解为类、ID 等，但我认为这太过分了。

这看起来是一个合理的方法吗？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-10-21T14:49:02.257

巧合的是，A List Apart 今天有[一篇文章](http://www.alistapart.com/articles/progressiveenhancementwithcss)涵盖了这一点。他们建议分成几个主要类别，包括您列出的一些类别（类型、布局、颜色），但进一步包括各种技巧以使旧版浏览器满意。

另一方面，将所有内容都保存在一个 css 文件中可以使浏览器和服务器之间的请求保持关闭。折衷方案可能是将事物分开以进行开发，并合并以进行生产（自然是构建过程的一部分：p）。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-21T14:49:38.777

我不倾向于将排版拆分为单独的样式表，尽管这似乎是个好主意。不过，我会用排版保留颜色。我的典型方法是具有以下结构：

## `base.css`

*   整个站点使用的全局样式
*   旨在可扩展，例如，以便可以为微型站点重新设置外观（但使用现有布局）。
*   实施/进口**`reset.css`**

### `page.css`

*   实现任何特定于页面的更改。

### `microsite_skin.css`

*   请参阅 base.css 第 2 点

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-21T14:48:43.147

泡菜，

分解样式表并没有错。事实上，我发现根据 css 规则的类型或应用站点的哪些部分将 css 规则组织到不同的文件中非常有用。如果您将规则集中到一个大文件中，它很快就会变得一团糟并且变得非常难以管理。

我建议您提出自己的方案，将您的规则分成文件，并在您的所有项目中坚持使用它。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-21T14:53:28.953

我会将布局分解为 2 个以上的部分，基本布局、IE Hacks、菜单（每个菜单区域一个。这可能类似于顶部菜单和侧面菜单）如果根据区域更改颜色的站点我也会为每个颜色区域添加一个。您还可以使用[Yaml](http://yaml.de)或类似的工具作为布局的基础框架。我会保持不同的样式表分开，同时根据网站在上传/发布前不久将它们合并为 2-4 个。总是让黑客们分开。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-21T14:53:31.670

根据您估计以后的需求将它们分开。如果您认为排版、布局或颜色（全局）会发生变化，那么至少以这种方式描述样式可能是明智的，这样以后用另一个样式表替换一个样式表会更容易。

但是如果你在这方面走得太远，你最终会在任何地方出现重复的规则（例如，#content 在typography.css 中有一个字体系列规则，在colors.css 中有一个颜色规则等）。除非您预计关键更改将在那里发生，否则这不是一种合乎逻辑的拆分方式。

另一方面，如果像大多数网站一样，图形设计将保持相当静态，但架构将进行一些更改（例如新的内容类型），那么您希望根据上下文对样式进行分组地点。例如，article.css、search.css 等。

从本质上讲，尝试提前查看以后需要进行哪些更改，然后尝试在您的 css 文件设置中预测这些更改。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-10-21T15:16:32.607

IMO 的主要问题是重复的属性定义问题。这使得样式表难以管理。为了绕过这个问题，使用了分而治之的方法。如果我们可以确保具有不冲突规则的可管理样式表，那么合并表或将它们模块化将很容易。

在审查期间，我所做的只是检查规则冲突、分类和 divitis。使用 Firebug/CSSTidy 组合，突出显示问题区域。在这些方面思考，我什至不考虑排版和字体分离。

目标是拥有一个单一的基础 CSS 文件和单独的浏览器 hacks 文件。如果应用程序具有不同的主题，则需要多个基本 CSS 文件。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-10-21T18:10:50.383

我将所有样式（包括特定于 IE6 和 7 的样式）放在一张纸上。IE6 和 7 样式的目标是使用有条件注释的 div，这些 div 仅在其中一个浏览器访问该站点时出现，例如：

```
<body>
<!--[if IE 7]><div class="IE IE7"><![endif]-->
<!--[if IE 6]><div class="IE IE6"><![endif]-->

... rest of markup ...

<!--[if IE]></div><![endif]-->
</body> 
```

不确定人们对这种方法的看法，但额外的标记可以忽略不计，并且能够在不使用黑客的情况下在主要样式旁边包含 IE6/7 样式......只需在选择器前面加上“.IE”或“.IE6 "等，是一个很大的方便。

至于多个样式表...保存您的 HTTP 请求。使用图像精灵、一个样式表、一个“application.js” javascript 等。

我仍然会为打印和手持样式包含单独的表格，但仅此而已......

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-21T14:48:14.533

不要走得太远。如果您必须这样做，请尝试在生产前找到一种方法将它们合并。最大的问题是您开始堆积 HTTP 请求。对于浏览器来说，这不是什么大问题，而是每个页面需要发出的请求数量。我会说你的情况很好，超过 4 个会有点过火。请记住，您始终可以使用良好的注释和格式来分解大型 CSS 文件。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-10-21T14:52:03.763

每当我试图决定将某些文件拆分多远时（我通常使用代码模块执行此操作，但我将相同的主体应用于我的 css/js），我将其分解为一起有意义的最小可重用文件。这对于跨线路的数据流来说并不是最好的，但它使我的源代码的可维护性变得更加容易。特别是如果您将有很多 css 漂浮在周围。

如果您对使用您的colors.css 并在不修改的情况下在另一个位置使用整个东西感到满意，那么您可能没问题。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-10-21T18:04:40.863

我以几乎完全相同的方式分解我的：

*   reset.ccs - MeyerWeb 的标准[重置](http://meyerweb.com/eric/tools/css/reset/)
*   typography.css - 字体、大小、行高等
*   layout.css - 所有定位、浮动、对齐等。
*   colors.css（或更恰当的 skin.css）——所有颜色、背景图像等。

然后是通过适当版本的条件注释包含的特定于 IE 的文件。

虽然我确实将每个文件组织在单独的部分（基本元素、命名元素、类等）中，但我不需要进一步分开它们。

更新：在最近完成的几个项目中，我对系统进行了一些更改。

*   base.css - 包含来自[YUI 重置](http://developer.yahoo.com/yui/reset/)和[YUI 基本](http://developer.yahoo.com/yui/base/)CSS 文件的 CSS（带有属性）
*   main.css - 包含以下内容的 @import 语句：
    *   typography.css - 字体、大小、行高等
    *   layout.css - 所有定位、浮动、对齐等。
    *   theme.css - 所有颜色、背景图片等。
*   print.css - 覆盖其他 CSS 文件以使页面易于打印。

如果需要，我还会使用条件注释来添加任何特定于 IE 的 CSS 文件。

我的下一步改进是添加一个构建过程步骤，将所有 CSS 文件合并到一个文件中，以减少服务器上的 HTTP 请求。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-10-27T15:24:03.843

看看[blueprint-css](http://github.com/joshuaclayton/blueprint-css/tree/master)。Blueprint 是一个 CSS 框架，它为您提供各种默认样式（例如浏览器重置代码）。

blueprint-css 中的样式表组织如下：

*   **screen.css** - 屏幕的默认样式
*   **print.css** - 打印的默认样式
*   **ie.css** - Internet Explorer 特定修复
*   **application.css** - 包含您编写的样式。实际上你根本不应该修改前面的三个样式表，因为它们是由 blueprint-css 生成的。您可以覆盖 application.css 文件中的所有 blueprint-css 样式。

有关更多详细信息，请参阅 blueprint-css Git 存储库。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-08-10T13:25:06.617

每个人都建议打破。我将成为魔鬼的拥护者。

不破坏样式表怎么样。至少出于生产目的，最好有一个请求而不是多个请求。浏览器可以同时处理 2 个 HTTP 请求。这意味着可以在前 2 个请求完成后发出其他 2 个请求。

组合文件是一种减少 HTTP 请求数量的方法，方法是将所有脚本组合成一个脚本，类似地将所有 CSS 组合成一个样式表。当脚本和样式表因页面而异时，组合文件更具挑战性，但将这部分作为发布过程的一部分可以提高响应时间。

[雅虎](http://developer.yahoo.com/performance/rules.html#num_http)和[谷歌](http://code.google.com/speed/page-speed/docs/rtt.html#CombineExternalCSS)推荐这个。

Google 建议创建 2 个文件。一个用于启动时所需的一切，1 用于其他一切。

我认为即使是设计师也必须考虑优化术语，而不仅仅是核心开发人员。

# drop-down-menu - 如何更改 Cognos 报告文本框中的最高值名称？

> ID：222148
> 
> 赞同：3
> 
> 时间：2008-10-21T14:46:36.783
> 
> 标签：drop-down-menu, report, cognos

下拉列表中第一项的默认值是数据库字段的名称。我需要将其更改为更用户友好的名称。如何更改值？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-21T18:08:23.397

在提示页面上添加一个 HTML 项，并将以下内容添加为 HTML 项：

例子： `<script>` `document.formWarpRequest._oLstChoicesMyList[0].text = '--SELECT A CITY--';` `</script>`

将“MyList”替换为组件的名称。

来自：[链接文本](http://bicentre.blogspot.com/2007/09/cognos-report-studio-create-default.html)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2013-04-30T08:43:39.387

在 Cognos 10 中，您可以在 Report Studio 中指定您选择的提示文本。

1.  选择值提示
2.  在“属性”窗格中的“提示文本”部分下，“标题文本”属性将设置为“自动”。单击它旁边的省略号按钮，然后打开标题文本对话框。
3.  选择“指定文本”选项。单击省略号。
4.  提供您选择的文本，然后单击确定。
5.  运行报告，您将看到您提供的文本将显示为下拉列表中的第一项。

我提供了一个屏幕截图以便更好地理解。

![如何更改提示标题文本](https://i.stack.imgur.com/gteCP.jpg)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-11T14:58:30.110

你有几个选择。首先，您可以将数据项的名称从数据库字段名称重命名为 Framework Manager 元数据中更友好的名称。

其次，您可以在 Report Studio 中重命名项目。但是，如果您这样做，您会注意到它仍在使用数据库名称。您实际上需要在项目表达式中执行计算才能使用您的名称而不是默认名称。因此，假设您正在拉入字符串字段 [Namespace].[Unfriendly Name]，并且您将报告数据项命名为“Friendly Name”。顶部选择仍将显示“不友好的名称”。但是，如果您将数据项替换为以下内容：

[命名空间].[不友好的名称] || ''

它将看到涉及计算并使用您的友好名称。对于数字字段，您必须添加零而不是连接“”。

报告列标题也是如此（您可以将其替换为文本而不是使用此计算方法）。

费解？是的。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-12T16:11:48.213

在查询中的数据项中..你可以做一个..

IF ([dataitemA] = 'some text') THEN ('new text') ELSE ([dataitemA])

我尽量避免使用 javascript 和 html 项目，因为它们通常不适用于 pdf 或 excel 输出。

只是一个想法..

干杯！

# c# - .NET COM 互操作方法签名

> ID：222161
> 
> 赞同：3
> 
> 时间：2008-10-21T14:50:25.607
> 
> 标签：c#, .net, com, interop, com-interop

您将为以下 COM 方法使用什么互操作签名？我对最后两个参数特别感兴趣，以及是否尝试`MarshalAs`与 a一起使用`SizeParamIndex`。

```
HRESULT GetOutputSetting(
  DWORD    dwOutputNum,
  LPCWSTR  pszName,
  WMT_ATTR_DATATYPE*  pType,
  BYTE*    pValue,
  WORD*    pcbLength
); 
```

文档指出：

> **pValue** [out] 指向包含该值的字节缓冲区的指针。传递 NULL 以检索所需缓冲区的长度。
> 
> **pcbLength** [in, out] 在输入时，指向包含 pValue 长度的变量的指针。在输出时，该变量包含 pValue 中使用的字节数。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-21T14:51:47.710

您可以尝试[PInvoke 签名工具包](http://www.codeplex.com/clrinterop/Release/ProjectReleases.aspx?ReleaseId=14120 "PInvoke 签名工具包")。在执行平台互操作时正确编组非常有用。它很可能不会涵盖您的特定问题，但您可能会找到一个类似的问题来为您提供所需的信息。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-21T15:17:45.693

我会使用 SizeParamIndex，因为您的场景正是此功能适用的场景：指定可变大小数组的长度。

所以最后一个参数将在 C# 签名中：

```
byte[] pValue,
ref ushort pcbLength 
```

byte-Array 不带*ref*传递，因为该数组对应于本机代码中的指针。如果为 pValue 传递 NULL（或 C# 中的 null）以检索所需缓冲区的大小。这也意味着调用者必须分配字节数组。参数 pcbLength 由*ref*传递，因为它用作输入/输出参数。

# c++ - 为什么异常时不调用析构函数？

> ID：222175
> 
> 赞同：57
> 
> 时间：2008-10-21T14:52:16.540
> 
> 标签：c++, exception, visual-c++, destructor, stack-unwinding

我希望`A::~A()`在这个程序中被调用，但它不是：

```
#include <iostream>

struct A {
  ~A() { std::cout << "~A()" << std::endl; }
};

void f() {
  A a;
  throw "spam";
}

int main() { f(); } 
```

但是，如果我将最后一行更改为

```
int main() try { f(); } catch (...) { throw; } 
```

然后`A::~A()` *被*调用。

我正在使用 Visual Studio 2005 中的“Microsoft (R) 32-bit C/C++ Optimizing Compiler Version 14.00.50727.762 for 80x86”进行编译。命令行为`cl /EHa my.cpp`.

编译器是否像往常一样正确？标准在这个问题上怎么说？

* * *

## 回答 #1

> 赞同：75
> 
> 时间：2008-10-21T15:04:37.310

没有调用析构函数，因为在堆栈展开之前调用了未处理异常的 terminate()。

C++ 规范所说的具体细节超出了我的知识范围，但使用 gdb 和 g++ 的调试跟踪似乎证实了这一点。

根据[标准草案](http://www.csci.csusb.edu/dick/c++std/cd2/except.html)第 15.3 节第 9 条：

```
9 如果在程序中没有找到匹配的处理程序，函数 terminate()
  (_except.terminate_) 被调用。堆栈是否展开
  在调用 terminate() 之前是实现定义的。

```

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2008-10-22T12:19:54.630

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-21T15:49:32.477

抱歉，我没有标准的副本。
我肯定想要一个明确的答案，所以有标准副本的人想要分享正在发生的事情的章节和经文：

根据我的理解，终止仅称为 iff：

*   异常处理机制找不到抛出异常的处理程序。
    以下是更具体的案例：
    *   在堆栈展开期间，异常会转义析构函数。
    *   一个抛出的表达式，一个异常转义了构造函数。
    *   异常转义非本地静态（即全局）的构造函数/析构函数
    *   异常会转义使用 atexit() 注册的函数。
    *   异常转义 main()
*   当前没有异常传播时尝试重新抛出异常。
*   意外异常使用异常说明符转义函数（通过意外）

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-21T14:58:30.567

在第二个示例中，dtor 在离开 try{} 块时被调用。

在第一个示例中，当程序在离开 main() 函数后关闭时调用 dtor——此时 cout 可能已经被销毁。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-21T15:02:25.940

我也假设编译器不会生成与“a”相关的代码，因为它没有被引用，但它仍然不是正确的行为，因为析构函数做了一些必须执行的事情。

所以，我在 VS2008/vc9 (+SP1) 中尝试了调试和发布，并在抛出异常后调用 ~A，退出 f() - 如果我是对的，这是正确的行为。

现在我刚刚尝试使用 VS2005/vc8 (+SP1)，它的行为是一样的。

我确定使用断点。我刚刚检查了控制台，我也有“~A”消息。也许你在其他地方做错了？

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2016-05-11T13:52:46.623

这个问题很容易用谷歌搜索，所以我在这里分享我的情况。

确保您的异常不会越界`extern "C"`或使用 MSVC 选项 /EHs（启用 C++ 异常 = 是，使用外部 C 函数 (/EHs)）

# c# - 应用程序的内存搜索索引占用太多内存 - 有什么建议吗？

> ID：222182
> 
> 赞同：6
> 
> 时间：2008-10-21T14:53:38.643
> 
> 标签：c#, optimization, search, memory, search-engine

在我们的桌面应用程序中，我们使用[倒排索引](http://en.wikipedia.org/wiki/Inverted_index)实现了一个简单的搜索引擎。

不幸的是，我们的一些用户数据集可能会变得非常大，例如在创建倒排索引之前占用了大约 1GB 的内存。倒排索引本身占用了大量内存，几乎与被索引的数据一样多（另外 1GB 的 RAM）。

显然，这会产生内存不足错误的问题，因为每个应用程序 2GB 内存的 32 位 Windows 限制受到影响，或者使用较低规格计算机的用户难以应对内存需求。

我们的倒排索引存储为：

```
Dictionary<string, List<ApplicationObject>> 
```

这是在处理每个对象时在数据加载期间创建的，以便将 applicationObject 的键字符串和描述词存储在倒排索引中。

所以，我的问题是：是否可以在空间方面更有效地存储搜索索引？也许需要使用不同的结构或策略？或者是否可以创建一种 CompressedDictionary？由于它存储大量字符串，我希望它具有高度可压缩性。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-21T14:59:16.307

如果它是 1GB……把它放在磁盘上。使用像 Berkeley DB 这样的东西。它仍然会非常快。

这是一个为其提供 .net 接口的项目：

[http://sourceforge.net/projects/libdb-dotnet](http://sourceforge.net/projects/libdb-dotnet)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-21T15:17:08.470

我看到了一些解决方案：

1.  如果您在数组中有 ApplicationObjects，则只存储索引 - 可能会更小。
2.  您可以使用一些 C++/CLI 来存储字典，使用 UTF-8。
3.  不要费心存储所有不同的字符串，使用[Trie](http://en.wikipedia.org/wiki/Trie)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-21T16:01:24.933

我怀疑你可能会发现你有很多非常小的列表。

我建议您大致了解频率是什么样的 - 您的字典条目中有多少具有单个元素列表，有多少具有两个元素列表等。您可能会存储几个单独的字典 - 一个用于“我只有一​​个元素” （直接映射）然后“我有两个元素”（映射到包含两个引用的 Pair 结构）等等，直到它变得愚蠢 - 很可能在大约 3 个条目处 - 此时你回到正常列表。将所有内容封装在一个简单的界面后面（添加条目/检索条目）。这样，您将浪费更少的空间（主要是空缓冲区、计数等）。

如果这些都没有多大意义，请告诉我，我会尝试编写一些代码。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-21T15:13:50.503

我同意 bobwienholt 的观点，但如果你正在索引数据集，我假设这些来自某个数据库。[仅使用DTSearch](http://www.dtsearch.com/index.html)或[Lucene.net 之](http://incubator.apache.org/lucene.net/)类的搜索引擎进行搜索是否有意义？

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-22T05:41:43.827

您可以采用 Lucene 所做的方法。首先，您创建一个随机访问内存流（System.IO.MemoryStream），该流镜像磁盘上的一个，但只是其中的一部分（如果您有错误的部分，请从磁盘加载另一个） . 这确实会让人头疼，您的字典需要一种文件可映射格式。[维基百科对分页技术](http://en.wikipedia.org/wiki/Paging "寻呼")有描述。

在文件可映射的情况下。如果您打开 Reflector 并反映 Dictionary 类，您将看到它由存储桶组成。您可能可以将这些存储桶中的每一个用作页面和物理文件（这样插入速度更快）。然后，您还可以通过简单地将“项目 x 已删除”值插入文件并每隔一段时间清理文件来松散地删除值。

顺便说一句，桶保存具有相同哈希值的值。您存储的值覆盖 GetHashCode() 方法非常重要（编译器会警告您有关 Equals() 的情况，因此也要覆盖它）。如果您这样做，您的查找速度会显着提高。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-22T05:50:25.477

使用内存映射文件 Win32 API 透明地备份您的内存结构怎么样？

[http://www.eggheadcafe.com/articles/20050116.asp](http://www.eggheadcafe.com/articles/20050116.asp)具有启用它所需的 PInvokes。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-21T16:08:33.843

索引是仅添加到还是从中删除键？

# version - 如何在发布前检查 JRE 版本？

> ID：222187
> 
> 赞同：12
> 
> 时间：2008-10-21T14:54:59.467
> 
> 标签：version, java, launch

确定机器上安装的 JRE 版本是否足以满足用户想要运行的应用程序的最佳方法是什么？有没有办法使用仅限 java 的东西来做到这一点？我希望该解决方案适用于 Windows/Linux/MacOSX - 如果 JRE 版本太低，则应显示一条消息。目前，如果我尝试在 Java 1.5 上运行它（该应用程序是为 Java 1.6 构建的），我会遇到异常。如果没有通用解决方案，那么在 Windows 上最好的方法是什么？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-10-21T18:11:25.560

您可以使用反射和两个编译器来做到这一点。使用您希望能够运行的最旧的 java 版本编译一个主类。它使用 , 或其他方式检查版本`System.getProperty("java.version")`，然后如果检查通过，则使用反射加载您的*真实*主类，甚至可能直接加载 jar。JRE 不应在编译时加载外部主类未引用的任何类。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-10-22T13:57:01.597

您可能会考虑[Java Webstart](http://java.sun.com/javase/technologies/desktop/javawebstart/overview.html)。即使这个名字暗示着类似小程序的东西，它也是关于独立应用程序的。Webstart 是一个启动器，它检查 JNLP 文件（一个简单的 XML 文件，您可以在其中配置应用程序的下载位置、所需的 Java 版本和一些其他元数据）并使用正确的 JRE 启动您的应用程序。如果有更新的版本可用，它甚至会更新应用程序。缺点是，您必须编写一个 JNLP 文件。这是一个例子：

```
<?xml version="1.0" encoding="utf-8"?>

<!--
###############################################################################
#
# @(#)draw.jnlp 1.6 02/09/11
#
# JNLP File for Draw Demo Application
#
###############################################################################
 -->

<jnlp spec="0.2 1.0"
      codebase="http://java.sun.com/javase/technologies/desktop/javawebstart/apps"
      href="draw.jnlp">
   <information> 
      <title>Draw 4 App</title> 
      <vendor>Sun Microsystems, Inc.</vendor>
      <homepage href="http://java.sun.com/javase/technologies/desktop/javawebstart/demos.html"/>
      <description>A minimalist drawing application along the lines of Illustrator</description>
      <description kind="short">Draw Demo Short Description</description>
      <icon href="images/draw.jpg"/>
      <offline-allowed/> 
   </information> 
   <resources>
      <j2se version="1.3+" href="http://java.sun.com/products/autodl/j2se"/>
      <j2se version="1.3+"/>
      <jar href="draw.jar" main="true" download="eager"/>
   </resources>
   <application-desc main-class="Draw"/>
</jnlp> 
```

第二种可能性是使用启动程序。一个例子是[Apache Commons Launcher](http://commons.apache.org/launcher/)。您也可以自己编写一些启动器应用程序，但这通常不值得。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-10-21T15:32:59.797

您也可以考虑使用 Commons-Launcher，它允许您设置各种环境设置，或在调用应用程序之前执行预检查。

[http://commons.apache.org/launcher](http://commons.apache.org/launcher)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-21T15:08:18.940

通常，我们使用 C 或（仅适用于 unix 时）shell 包装器来解决此问题。不确定这是否真的适合您。

我们还通过在我们的产品中嵌入 JRE 来解决这个问题。处理 99.9% 的情况（另外 0.1% 的时间是用户显式更改我们的配置以使用不同的 JVM）。同样，不确定这对您来说是否是一个合理的解决方案。

在我们的例子中，有大量的本机代码（JNI 和其他），因此无论如何都需要为我们支持的每个平台定制一个可安装的图像。但是，如果您正在处理纯 Java 解决方案，您可能只需要记录您的最低要求并告诉人们使用该程序（没有双关语），如果他们要运行您的东西。这有点像人们抱怨我的 Mac 无法运行 MSVC，或者我的 Linux 机器在运行《魔兽世界》时出现问题。这不是软件所针对的（虚拟）机器——你需要切换。不过，至少在 Java 世界中，我们确实可以称其为升级，而不会伤害任何人的操作系统宗教感情。（尝试告诉 Mac 用户“升级”到 Windows XP 以运行 MSVC - 等待发生的失败。）

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-08-10T15:49:13.297

运行 Java 命令时，您可能需要 Java 版本，例如`java -version:1.6* com.me.MyClass`. 不确定这是否适用于所有 Java 版本，但无论如何它在 1.6 上都可以正常工作。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-21T15:00:21.077

为较高版本的 JRE 构建的应用程序不会在较低版本的 JRE 上运行。因此，您不能只向应用程序添加代码来检查 JRE 版本 - 如果 JRE 版本不兼容，您的 JRE 版本检查代码将不会首先运行。

您需要做的是拥有某种为低版本 JRE（1.3？）构建的启动器应用程序，该应用程序检查版本，然后在必要时启动您的应用程序。这对我来说听起来有点笨拙。

在安装过程中检查版本怎么办？您是否以允许您检查环境变量或执行任何类型的脚本的方式安装应用程序？

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-21T15:51:57.200

对于启动器 - 检查那里的版本。

APP内部；如上使用 System.getProperties();

```
Properties sProp = java.lang.System.getProperties();
String sVersion = sProp.getProperty("java.version");
sVersion = sVersion.substring(0, 3);
Float f = Float.valueOf(sVersion);
if (f.floatValue() < (float) 1.4) {
    System.out.println("Java version too low ....");
    System.exit(1);
}
... 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2010-06-21T19:19:42.687

有一个为 Java 1.2 编译的启动类，它调用 1.6 类中的*真正*main()。如果抛出了不受支持的类异常，它们会捕获它并显示一个很好的错误消息。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2011-04-14T11:09:41.323

这是获取系统中安装的 JRE 版本的代码。

```
var list = deployJava.getJREs();
var result = "";
result = list[0];
for (var i=1; i<list.length; i++)
{
    result += ", " + list[i];
} 
document.write("jre version : "+result); 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-10-21T15:31:29.847

System.getProperties() 为您提供 JVM 属性列表，包括 JRE、JVM 和规范的不同版本 ID。这为所有版本的 Java 实现，因此无论编译的版本和运行的版本如何，或者实现如何，都应该工作。

如果您编写一个基本类来测试版本，您可以首先在您的 main() 启动类中调用它。它必须是真正的基本功能，否则你可能会冒险破坏它。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-10-22T00:01:29.160

嗯 .. 称我为一个无聊的人，但例如，使用 Launch4J 或任何其他本机启动器有什么问题。

在实际运行代码之前，使用本机启动器检查 JVM 版本。仅 Java 的解决方案（在我的书中）只有在与开发人员打交道时才有意义；一旦你接触到最终用户，你就会意识到他们根本不关心 Java 或其技术细节。如果您使用 GW-Basic 编写应用程序，只要您的应用程序正常工作，他们就不会在意。

如果未安装 Java 1.6，lauchner4j 会将用户指向 JDK 1.6 的下载页面。那可能比在 Java 中做魔术更适合您的问题。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-05-08T17:54:28.730

我发现[WinRun4J](http://winrun4j.sourceforge.net/ "WinRun4J")对我来说工作得很好（但是我可能再次有偏见，因为我写了它:-)）。这使您可以指定允许的 Java 的最小和/或最大版本。如果没有找到合适的 JRE 版本（并且该消息是可定制的），它将向用户弹出一个消息框。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2013-03-09T15:29:10.823

以上这些都太他妈复杂了。去吧：

```
Properties props = System.getProperties()
props.list(System.out) 
```

您将看到有关您的 JVM、JRE、JDK 和员工的所有信息。或使用以下方法获取特定值：

```
//full list of possible props you can see if u run code above
String props = System.getProperty(prop) 
```

# svn - Tortoise SVN 隐藏 _svn 文件夹

> ID：222188
> 
> 赞同：13
> 
> 时间：2008-10-21T14:55:32.897
> 
> 标签：svn, version-control, tortoisesvn

当我需要将 Web 解决方案上传到服务器时，它们特别烦人。

有没有办法配置 SVN 在我的工作目录之外创建 _svn 文件夹？如果没有，当您只需要复制代码时，处理它们的最佳方法是什么？

**更新：**使用“svn export”命令是有问题的，因为有些文件不受源代码控制但必需的文件，如 .dll、xml 数据文件或数据库文件，它们不会被导出。因此，每次都需要手动将它们复制到工作副本的不同子目录中。

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2008-10-21T15:03:22.553

（目前）不可能配置 SVN（或 TortoiseSVN）在工作副本之外创建 .svn（或 _svn）目录。我相信 SVN 1.6 路线图包括重新访问工作副本库。将管理目录放在其他地方的能力可能来自这项工作，但我在推测。

您应该使用“svn export”命令来创建工作副本的“干净”副本（即没有_svn 目录）。这适用于命令行客户端。

如果您使用的是 TortoiseSVN，您可以右键单击工作副本，然后选择“导出...”。这将要求您提供将文件导出到的文件夹。或者，您可以将工作副本右键拖动到文件夹（不是工作副本的文件夹），TortoiseSVN 会弹出一个上下文菜单；选项中有“SVN 导出到这里”和“SVN 全部导出到这里”，后者也导出**不受版本控制的文件**。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2008-10-21T14:58:11.347

使用“svn export”创建一个干净的目录树。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2008-10-21T15:45:23.997

[Robocopy](http://en.wikipedia.org/wiki/Robocopy)部署...

```
robocopy {source} {dest} /MIR /XD _svn /XD .svn 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-10-21T15:28:54.483

在 TortoiseSVN 中，您可以**右键**单击工作副本并将其拖动到其他位置。当弹出菜单出现时，选择“SVN Export Here”。（这要求工作副本中的所有代码都已签入，因为导出将来自主干而*不是*工作副本）

有关详细信息，请参阅这些资源：

*   [http://tortoisesvn.net/most-forgotten-feature](http://tortoisesvn.net/most-forgotten-feature)（关于右键+拖动上下文菜单）
*   [http://tortoisesvn.net/node/343](http://tortoisesvn.net/node/343)（关于​​取消版本化 svn 工作副本）。如果您使用此方法，我*认为*您的未版本控制文件将保留在文件夹中，但我没有尝试过...

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-10-21T15:22:23.467

如果您使用 nant 脚本启用到 Web 服务器的部署，它具有 _SVN 和 _SVN/** 作为复制文件时的自动排除。nant 在通过其复制任务复制文件时会过滤掉大量不需要的文件，包括：

*   **/*~
*   **/#*#
*   **/.#*
*   **/%*%
*   **/CVS
*   **/CVS/**
*   **/.cvsignore
*   **/.svn
*   **/.svn/**
*   **/_svn
*   **/_svn/**
*   **/SCCS
*   **/SCCS/**
*   **/vssver.scc
*   **/_vti_cnf/**

您可以在此处的项目主页上阅读有关 NANT 的更多信息：[NANT Home](http://nant.sourceforge.net/)

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-10-21T15:34:56.797

Isak Savo 的解决方案 +1。

您可以执行 XCOPY 并排除“/svn”文件夹：

XCOPY %1 %1_deploy /EXCLUDE:C:\ExcludeSVN.txt /E /C /I /F /R /Y

ExcludeSVN.txt 的内容：

/_svn

事实上，如果你想上传到 web 服务器，你的排除文件可以包含更多：

*   .pdb
*   。CS
*   .resx
*   .csproj
*   .sln
*   .webinfo
*   .bak
*   .sql
*   。压缩
*   .vspscc
*   .vsscc
*   .scc
*   **\Web.config**

警告：如果您排除 .cs 文件，您必须在之后重新复制 .css 文件

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-21T15:20:19.603

Windows 中真正肮脏的方法：创建项目的副本，打开资源管理器，导航到副本所在的目录，然后查找以 _svn 结尾的所有内容。搜索完成后，全选并点击删除。

呸！但它*真的*很好用。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-21T15:47:33.697

我们使用 CruiseControl 和 robocopy 来创建存储库的干净副本。

```
 <exec>
        <executable>C:\Archivos de programa\Windows Resource Kits\Tools\robocopy.exe</executable>
        <buildArgs>E:\CruiseControl\yourproject\Code\trunk\ E:\wwwroot\yourproject *.* /E /XX /XA:H /XO /NDL /NC /NS /NP /XF "*.cache" "*.designer.cs" "*.sln" "*.msbuild" "*.csproj" "*.PDB" "*.user" "*.designer" /XD .svn App_Code obj Properties</buildArgs>
        <buildTimeoutSeconds>60</buildTimeoutSeconds>
        <successExitCodes>1,0</successExitCodes>
 </exec> 
```

/XF 和 /XD 参数不包括您不想上传到生产环境的文件和目录。

[您可以在此处](http://www.ss64.com/nt/robocopy.html)找到有关 robocopy 的更多信息。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2012-11-25T15:50:05.793

如果要删除 Windows 中所有名为**.svn**的子文件夹，请使用以下内容创建批处理文件：

```
for /f "tokens=* delims=" %%i in ('dir /s /b /a:d *.svn') do (
rd /s /q "%%i"
) 
```

将其保存在文件**del_All_Dot_SVN_Folders.cmd**中。运行。你完成了。

感谢[http://www.axelscript.com/2008/03/11/delete-all-svn-files-in-windows/](http://www.axelscript.com/2008/03/11/delete-all-svn-files-in-windows/)

请记住，上面的代码有 .svn，而链接中的代码只有 *svn，所以最好有 .svn，以免意外产生不良影响。

# c++ - 导出数据成员是否正确？(C++)

> ID：222189
> 
> 赞同：0
> 
> 时间：2008-10-21T14:55:34.020
> 
> 标签：c++, dll, import, export

正如标题所示，从 C++ 类中导入/导出静态数据是否正确或有效？

我发现了我的问题 - 我正在查看的课程的作者试图导出此平台不支持的可写静态数据。

非常感谢您的回复。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-21T15:17:54.397

导出的 C++ 类意味着由于名称修改和其他问题，DLL 客户端必须使用与 DLL 相同的编译器。这实际上是一个相当大的问题，我曾经不得不为一堆 C++ 类编写 C 包装器，因为客户端程序已经切换到 MSVC9，而 DLL 本身使用的是 MSVC71。[将 DLL 切换到 MSVC90 还存在一些其他问题]。从那以后，我一直对导出类的业务持怀疑态度，并且更喜欢为所有内容编写 C 包装器。

现在，如果您愿意为导出类付出代价，我想说导出静态数据不会使问题变得更糟。可以说，在您可以导出的各种东西中，导出静态常量是最安全的。即便如此，我宁愿不这样做，因为就像 Timo 所说，你现在被锁定在这个实现中。

我从事的一个框架要求其客户提供一组错误代码常量。随着时间的推移，我们发现使用一堆简单的常量太脆弱了，我们切换到了 OO 设计。我们有一个默认实现，它会返回常见的错误代码，但是每个错误代码都是使用一个虚拟函数来访问的，该虚拟函数可以被单个客户端覆盖——他们从一些高级设备特定的错误处理中使用它。事实证明，该解决方案比基于导出常量的解决方案更具可扩展性*。*

我建议您在导出静态变量之前仔细考虑您期望组件如何发展。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-21T15:11:27.407

它是否正确，因为它会起作用并按照您的期望进行？假设您正在谈论在类或类成员上使用 _declspec(dllexport/dllimport)，是的，您可以这样做，它应该会给您预期的结果 - 静态数据可以在您的 dll 之外访问，其他 C++ 代码可以访问它规定 C++ 访问规范（公共/受保护/私有）首先不会阻止外部访问。

这是个好主意吗？就我个人而言，我不这么认为，因为您不仅会在您的库中而且向外部世界公开类内部结构，这意味着在一天结束时更改实现细节几乎是不可能的。问问自己，你是否 100% 确定这个类的接口和它的大部分实现是否永远不会改变……

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-21T23:34:22.680

类（非静态）数据成员上的 dllexport（或 import）什么都不做。导出的“事物”要么是函数，要么是全局数据（尽管这是一个值得商榷的设计选择）。类上的 dllexport 只是说“导出所有这些功能”的快捷方式。

# c++ - 是否有使用带有参考参数的可变参数的陷阱

> ID：222195
> 
> 赞同：31
> 
> 时间：2008-10-21T14:58:27.307
> 
> 标签：c++, reference, variadic-functions

我有这段代码（总结）......

```
AnsiString working(AnsiString format,...)
{
    va_list argptr;
    AnsiString buff;

    va_start(argptr, format);
    buff.vprintf(format.c_str(), argptr);

    va_end(argptr);
    return buff;
} 
```

并且，在可能的情况下首选通过引用传递的基础上，我因此对其进行了更改。

```
AnsiString broken(const AnsiString &format,...)
{
... the rest, totally identical ...
} 
```

我的调用代码是这样的：-

```
AnsiString s1, s2;
    s1 = working("Hello %s", "World");
    s2 = broken("Hello %s", "World"); 
```

但是，s1 包含“Hello World”，而 s2 包含“Hello (null)”。我认为这是由于 va_start 的工作方式，但我不确定发生了什么。

* * *

## 回答 #1

> 赞同：43
> 
> 时间：2008-10-21T15:25:29.640

如果您查看 va_start 扩展的内容，您会看到发生了什么：

```
va_start(argptr, format); 
```

变成（大致）

```
argptr = (va_list) (&format+1); 
```

如果 format 是一个值类型，它会被放置在所有可变参数之前的堆栈中。如果 format 是引用类型，则只有地址被放入堆栈。当您获取引用变量的地址时，您获得的是地址或原始变量（在这种情况下是在调用 Broken 之前创建的临时 AnsiString），而不是参数的地址。

如果您不想传递完整的类，您的选择是通过指针传递，或者放入一个虚拟参数：

```
AnsiString working_ptr(const AnsiString *format,...)
{
    ASSERT(format != NULL);
    va_list argptr;
    AnsiString buff;

    va_start(argptr, format);
    buff.vprintf(format->c_str(), argptr);

    va_end(argptr);
    return buff;
}

...

AnsiString format = "Hello %s";
s1 = working_ptr(&format, "World"); 
```

或者

```
AnsiString working_dummy(const AnsiString &format, int dummy, ...)
{
    va_list argptr;
    AnsiString buff;

    va_start(argptr, dummy);
    buff.vprintf(format.c_str(), argptr);

    va_end(argptr);
    return buff;
}

...

s1 = working_dummy("Hello %s", 0, "World"); 
```

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-10-21T15:34:32.617

这是 C++ 标准（18.7 - 其他运行时支持）所说的`va_start()`（强调我的）：

> ISO C 对 `va_start()`标头中宏 的第二个参数的限制`<stdarg.h>`在本国际标准中有所不同。参数 `parmN`是函数定义的可变参数列表中最右边的参数的标识符（在 之前的那个 `...`）。 **如果`parmN`使用函数、数组或引用类型声明参数，**或者使用与传递没有参数的参数时产生的类型不兼容的类型，**则行为未定义**。

正如其他人所提到的，如果将可变参数与非直接 C 项目（甚至可能以其他方式）一起使用，则在 C++ 中使用可变参数是危险的。

也就是说 - 我仍然一直使用 printf() ......

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-21T15:07:58.380

[在N0695](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/1995/N0695.pdf)中找到了一个很好的分析为什么你不想要这个

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-21T15:10:00.217

根据 C++ 编码标准（Sutter，Alexandrescu）：

varargs 永远不应该与 C++ 一起使用：

它们不是类型安全的，并且对于类类型的对象具有未定义的行为，这可能会导致您的问题。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2013-06-19T02:56:14.553

这是我的简单解决方法（使用 Visual C++ 2010 编译）：

```
void not_broken(const string& format,...)
{
  va_list argptr;
  _asm {
    lea eax, [format];
    add eax, 4;
    mov [argptr], eax;
  }

  vprintf(format.c_str(), argptr);
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-21T18:24:17.873

边注：

作为可变参数的类类型的行为可能未定义，但在我的经验中是一致的。编译器将类内存的 sizeof(class) 压入堆栈。即，在伪代码中：

```
alloca(sizeof(class));
memcpy(stack, &instance, sizeof(class); 
```

对于以非常有创意的方式使用它的一个非常有趣的示例，请注意，您*可以*将 CString 实例代替 LPCTSTR 直接传递给 varargs 函数，并且它可以工作，并且不涉及强制转换。我把它作为一个练习留给读者来弄清楚他们是如何做到这一点的。

# apache-flex - 在 creationComplete 中使用命令行参数

> ID：222206
> 
> 赞同：2
> 
> 时间：2008-10-21T15:02:58.717
> 
> 标签：apache-flex, actionscript-3, air

如何在*creationComplete*事件处理程序中使用命令行参数？似乎在调用 creationComplete**后，** *invoke*事件发生在我的 AIR 应用程序中，所以我不能在该函数中使用 args，尽管我真的很想这样做。在*调用事件发生****后***可能总是触发的任何其他事件？

 ***** * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-21T17:42:51.140

我认为这是不可能的。我刚刚检查了源，并且在创建完成事件触发后，调用是在 enterframe 处理程序中设置的。您也许可以继承 WindowedApplication 并尝试更改该顺序，但可能有充分的理由说明它以这种方式实现。

您可以在 [FLEX_DIR]\sdks\3.1.0\frameworks\projects\airframework\src\mx\core 中找到 WindowedApplication.as 文件

第 2942 行的有趣评论：

> 由于 nativeApplication 调用事件的行为
> 
> 我们将事件排队直到 windowComplete

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-17T14:19:49.590

虽然 Christophe 是对的，但您实际上可以在创建完成之前获取参数。正如 Christophe 所说，在 WindowedApplication 中，invokeEvents 在初始化期间排队，并在创建完成后调度。但是，您可以完美地监听底层 NativeApplication 对象的调用事件。然后，您将收到调用事件的通知，即在创建完成之前。

# log4net - 如何使用 Log4net RolloverFileAppender 在应用程序启动时强制翻转？

> ID：222210
> 
> 赞同：5
> 
> 时间：2008-10-21T15:03:42.973
> 
> 标签：log4net

在我们的应用程序中配置 Log4Net 以使用带日期标记的名称和 10Meg 文件大小限制。
这会在午夜和达到 10Meg 限制时自动导致翻转到新文件。每次启动（或关闭）应用程序时，我还想将日志记录滚动到一个新文件。
我可以得到所有三个翻转行为吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-21T15:15:19.003

[在配置文件中将appendToFile](http://logging.apache.org/log4net/release/sdk/log4net.Appender.FileAppender.AppendToFile.html)设置为 false。

```
<appender name="RollingLogFileAppender" type="log4net.Appender.RollingFileAppender">
....
  <appendToFile value="false" />
....
</appender> 
```

编辑：回答克雷格的评论：

如果您正确设置了 StaticLogFileName 和 CountDirection（有关更多信息，请参见[http://logging.apache.org/log4net/release/sdk/log4net.Appender.RollingFileAppender.html](http://logging.apache.org/log4net/release/sdk/log4net.Appender.RollingFileAppender.html)），那么事情就会如愿以偿。我们在我们使用它的应用程序中以编程方式配置记录器，但这就是代码的样子：

```
Dim Layout As New PatternLayout("%date{yyyy-MM-dd HH:mm:ss,fff} [%-6thread] %-5level %type{2}.%method(%line) - %message%newline") 
Dim Appender As New log4net.Appender.RollingFileAppender()
Appender.File = Path.Combine(FileSystemHelper.LogDirectory, LogFileName)
Appender.Layout = Layout
Appender.AppendToFile = False ' we will start a new one when the program starts'
Appender.Name = "RollingLogFileAppender"
Appender.Threshold = LogLevel() 'May want to set this by configuration'
Appender.RollingStyle = log4net.Appender.RollingFileAppender.RollingMode.Size 'This means it will start a new log file each time the log grows to 10Mb'
Appender.MaximumFileSize = "10MB"
Appender.MaxSizeRollBackups = -1 'keep an infinite number of logs'
Appender.StaticLogFileName = True
Appender.CountDirection = 1 ' to reduce rollover costs'
log4net.Config.BasicConfigurator.Configure(Appender)
Appender.ActivateOptions() 
```

# java - 在 Java 中管理具有许多参数的构造函数

> ID：222214
> 
> 赞同：118
> 
> 时间：2008-10-21T15:04:56.543
> 
> 标签：java

在我们的一些项目中，有一个类层次结构，随着它沿着链向下添加更多参数。在底部，一些类最多可以有 30 个参数，其中 28 个只是被传递给超级构造函数。

我承认通过 Guice 之类的工具使用自动化 DI 会很好，但由于某些技术原因，这些特定项目仅限于 Java。

按类型按字母顺序组织参数的约定不起作用，因为如果重构类型（您为参数 2 传入的 Circle 现在是 Shape），它可能会突然出现故障。

这个问题可能是具体的并且充满了“如果这是你的问题，那么你在设计层面做错了”的批评，但我只是在寻找任何观点。

* * *

## 回答 #1

> 赞同：299
> 
> 时间：2008-10-21T15:27:37.030

建造者设计模式可能会有所帮助。考虑以下示例

```
public class StudentBuilder
{
    private String _name;
    private int _age = 14;      // this has a default
    private String _motto = ""; // most students don't have one

    public StudentBuilder() { }

    public Student buildStudent()
    {
        return new Student(_name, _age, _motto);
    }

    public StudentBuilder name(String _name)
    {
        this._name = _name;
        return this;
    }

    public StudentBuilder age(int _age)
    {
        this._age = _age;
        return this;
    }

    public StudentBuilder motto(String _motto)
    {
        this._motto = _motto;
        return this;
    }
} 
```

这让我们可以编写如下代码

```
Student s1 = new StudentBuilder().name("Eli").buildStudent();
Student s2 = new StudentBuilder()
                 .name("Spicoli")
                 .age(16)
                 .motto("Aloha, Mr Hand")
                 .buildStudent(); 
```

如果我们省略了一个必填字段（可能是 name 是必需的），那么我们可以让 Student 构造函数抛出异常。它让我们拥有默认/可选参数，而无需跟踪任何类型的参数顺序，因为这些调用的任何顺序都同样有效。

* * *

## 回答 #2

> 赞同：28
> 
> 时间：2008-10-21T15:27:57.840

能不能把相关参数封装在一个对象里面？

例如，如果参数像

```
 MyClass(String house, String street, String town, String postcode, String country, int foo, double bar) {
  super(String house, String street, String town, String postcode, String country);
  this.foo = foo;
  this.bar = bar; 

```

那么你可以改为：

```
 MyClass(Address homeAddress, int foo, double bar) {
  super(homeAddress);
  this.foo = foo;
  this.bar = bar;
} 

```

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2008-10-21T15:13:55.527

您可能想要做的是拥有一个 Builder 类。然后你会做这样的事情：

```
MyObject obj = new MyObjectBuilder().setXxx(myXxx)
                                    .setYyy(myYyy)
                                    .setZzz(myZzz)
                                    // ... etc.
                                    .build(); 
```

[请参阅此 Josh Bloch 演示文稿](http://docs.huihoo.com/javaone/2007/java-se/TS-2689.pdf)(PDF)的第 8 页及以下内容，或[此对 Effective Java 的评论](http://www.javaspecialists.eu/archive/Issue163.html)

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2008-10-21T23:50:47.310

好吧，使用构建器模式可能是*一种*解决方案。

但是一旦你来到 20 到 30 个参数，我猜这些参数之间有很高的关系。因此（如建议的那样）将它们包装成逻辑上健全的数据对象可能是最有意义的。这样，数据对象已经可以检查参数之间约束的有效性。

对于我过去的所有项目，一旦我发现参数太多（那是 8 个而不是 28 个！），我就能够通过创建更好的数据模型来清理代码。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-10-21T15:10:07.657

最好的解决方案是在构造函数中没有太多参数。只有构造函数中真正需要的参数是正确初始化对象所需的参数。你可以有多个参数的构造函数，也可以有一个只有最少参数的构造函数。其他构造函数调用这个简单的构造函数，然后设置其他参数。这样你可以避免越来越多的参数的链问题，而且还有一些方便的构造函数。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-10-21T15:11:50.867

由于您受限于 Java 1.4，如果您想要 DI，那么[Spring](http://www.springframework.org)将是一个非常不错的选择。DI 仅在构造函数参数是服务或在运行时不变的地方有用。

如果你有所有这些不同的构造函数，因为你想要关于如何构造一个对象的变量选项，你应该认真考虑使用 Builder 模式。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2016-06-13T17:47:59.910

在使用构建器模式时，我真的可以推荐使用[Immutables](http://immutables.github.io)或[POJOBuilder](https://github.com/mkarneim/pojobuilder)。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-10-21T15:09:55.897

重构以减少参数数量和继承层次结构的深度几乎是我所能想到的，因为，没有什么能真正帮助保持 20 多岁的参数保持直截了当。在查看文档时，您将不得不接听每一个电话。

您可以做的一件事是将一些逻辑分组的参数分组到他们自己的更高级别的对象中，但这有它自己的问题。

# sql-server - 如何确定列是否在其表的主键中？（SQL 服务器）

> ID：222217
> 
> 赞同：22
> 
> 时间：2008-10-21T15:06:21.783
> 
> 标签：sql-server, code-generation, primary-key, data-access-layer

我目前正在使用...

```
select Table_Name, Column_name, data_type, is_Nullable
from information_Schema.Columns 
```

...确定有关给定数据库中列的信息，以生成数据访问层。

**我可以从哪里检索有关这些列是否是其表主键中的参与者的信息？**

* * *

## 回答 #1

> 赞同：43
> 
> 时间：2008-10-21T15:08:24.697

这是一种方法（将“keycol”替换为您要搜索的列名）：

```
SELECT  K.TABLE_NAME ,
    K.COLUMN_NAME ,
    K.CONSTRAINT_NAME
FROM    INFORMATION_SCHEMA.TABLE_CONSTRAINTS AS C
        JOIN INFORMATION_SCHEMA.KEY_COLUMN_USAGE AS K ON C.TABLE_NAME = K.TABLE_NAME
                                                         AND C.CONSTRAINT_CATALOG = K.CONSTRAINT_CATALOG
                                                         AND C.CONSTRAINT_SCHEMA = K.CONSTRAINT_SCHEMA
                                                         AND C.CONSTRAINT_NAME = K.CONSTRAINT_NAME
WHERE   C.CONSTRAINT_TYPE = 'PRIMARY KEY'
        AND K.COLUMN_NAME = 'keycol'; 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-10-21T15:17:22.433

同样，以下将为您提供有关所有表及其键的信息，而不是有关特定列的信息。这样，您可以确保您拥有所有感兴趣的列并知道它们参与的内容。为了查看所有键（主键、外键、唯一键），请注释 WHERE 子句。

```
SELECT K.TABLE_NAME, C.CONSTRAINT_TYPE, K.COLUMN_NAME, K.CONSTRAINT_NAME
FROM INFORMATION_SCHEMA.TABLE_CONSTRAINTS AS C
JOIN INFORMATION_SCHEMA.KEY_COLUMN_USAGE AS K
ON C.TABLE_NAME = K.TABLE_NAME
AND C.CONSTRAINT_CATALOG = K.CONSTRAINT_CATALOG
AND C.CONSTRAINT_SCHEMA = K.CONSTRAINT_SCHEMA
AND C.CONSTRAINT_NAME = K.CONSTRAINT_NAME
WHERE C.CONSTRAINT_TYPE = 'PRIMARY KEY'
ORDER BY K.TABLE_NAME, C.CONSTRAINT_TYPE, K.CONSTRAINT_NAME 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2014-11-05T16:05:45.583

根据您的需要，使用 INFORMATION_SCHEMA.COLUMNS 和 INFORMATION_SCHEMA.KEY_COLUMN_USAGE 进行完全外部联接。在 select 语句中，从 INFORMATION_SCHEMA.KEY_COLUMN_USAGE 添加 CONSTRAINT_NAME 列，这将为您提供 null 或键名。

```
select C.Table_Name, C.Column_name, data_type, is_Nullable, U.CONSTRAINT_NAME
from information_Schema.Columns C FULL OUTER JOIN INFORMATION_SCHEMA.KEY_COLUMN_USAGE U ON C.COLUMN_NAME = U.COLUMN_NAME
WHERE C.TABLE_NAME=@TABLENAME 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2019-06-06T10:07:56.623

此查询返回列是主键。

```
SELECT  col.COLUMN_NAME ,
        col.DATA_TYPE ,
        col.CHARACTER_MAXIMUM_LENGTH ln ,
        CAST(ISNULL(j.is_primary, 0) AS BIT) is_primary
FROM    INFORMATION_SCHEMA.COLUMNS col
        LEFT JOIN ( SELECT  K.TABLE_NAME ,
                            K.COLUMN_NAME ,
                            CASE WHEN K.CONSTRAINT_NAME IS NULL THEN 0
                                 WHEN K.CONSTRAINT_NAME IS NOT NULL THEN 1
                            END is_primary
                    FROM    INFORMATION_SCHEMA.TABLE_CONSTRAINTS AS C
                            JOIN INFORMATION_SCHEMA.KEY_COLUMN_USAGE AS K ON C.TABLE_NAME = K.TABLE_NAME
                                                              AND C.CONSTRAINT_CATALOG = K.CONSTRAINT_CATALOG
                                                              AND C.CONSTRAINT_SCHEMA = K.CONSTRAINT_SCHEMA
                                                              AND C.CONSTRAINT_NAME = K.CONSTRAINT_NAME
                    WHERE   C.CONSTRAINT_TYPE = 'PRIMARY KEY'
                            AND C.TABLE_NAME = 'tablename'
                  ) j ON col.COLUMN_NAME = j.COLUMN_NAME
WHERE   col.TABLE_NAME = 'tablename' 
```

# javascript - 如何用 jquery 或纯 javascript 更改/替换 flash 对象？

> ID：222218
> 
> 赞同：0
> 
> 时间：2008-10-21T15:06:43.017
> 
> 标签：javascript, jquery, flash

我想在 onClick 事件之后更改包含在 jQuery 中的 flash 对象。我写的代码，本质上是：

```
$(enclosing div).html('');
$(enclosing div).html(<object>My New Object</object>); 
```

在 Firefox 中有效，但在 IE 中无效。我将不胜感激有关这样做的指示或建议。谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-21T15:26:07.453

该`empty()`方法是删除内容的更好方法。不知道这是否能解决你的问题:)

```
$('#mydiv').empty(); 
```

你也可以试试这个`replaceWith(content)`方法。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-21T21:25:26.510

试试`$().remove()`方法。这也删除了事件处理程序以避免内存泄漏问题，这也是为什么将 HTML 设置为空不是一个好主意的原因之一。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-21T21:42:21.423

这就是我正在做的 - 它取自 swfobject 并稍作修改：

```
function removeObjectInIE(el) {
    var jbo = (typeof(el) == "string" ? getElementById(el) : el);
    if (jbo) {
        for (var i in jbo) {
            if (typeof jbo[i] == "function") {
                jbo[i] = null;
            }
        }
        jbo.parentNode.removeChild(jbo);
    }
}

function removeSWF(id) {
    var obj = (typeof(id) == "string" ? getElementById(id) : id);
    if(obj){
        if (obj.nodeName == "OBJECT" || obj.nodeName == "EMBED") {
            if (ua.ie && ua.win) {
                if (obj.readyState == 4) {
                    removeObjectInIE(id);
                }
                else {
                    $(document).ready(function() { removeObjectInIE(id); });
                }
            }
            else {
                obj.parentNode.removeChild(obj);
            }
        }else if(obj.childNodes && obj.childNodes.length > 0){
            for(var i=0;i<obj.childNodes.length;i++){
                removeSWF(obj.childNodes[i]);
            }
        }
    }
} 
```

所以你会这样做`removeSWF("mydiv");`- 你可能想以 jQuery 方式重写它，这是从我正在研究的一个库中获取的，我不能确定 jQuery 会在那里。（我用 替换了我的准备就绪功能`$().ready()`）

# php - 在 PHP 中，如何更正数组中缺少的键？

> ID：222220
> 
> 赞同：16
> 
> 时间：2008-10-21T15:07:55.260
> 
> 标签：php, arrays

使用 后[`array_unique`](http://us.php.net/array_unique)，将删除没有重复值的数组。但是，似乎键也被删除了，这在具有数字索引的数组中留下了间隙（尽管对于关联数组来说很好）。如果我使用 for 循环进行迭代，我必须考虑丢失的索引并将键复制到一个新数组中，但这似乎很笨拙。

* * *

## 回答 #1

> 赞同：41
> 
> 时间：2008-10-21T15:08:54.320

`$foo = array_values($foo);`将为您重新编号数组

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-21T17:39:19.760

而不是使用 for 循环，听起来你应该使用 foreach 循环。显然，您无论如何都不关心索引，因为您正在重新编号它们。

这个循环：

```
for ($i = 0; $i < $loopSize; $i++)
{
process($myArray[$i]);
} 
```

变成

```
foreach($myArray as $key=> $value)
{
    process($value);
    /** or process($myArray[$key]); */
}

or even more simply

foreach($myArray as $value)
{
    process($value);
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-10-14T17:53:13.637

在我尝试使用 for 而不是 foreach 的少数情况下，我很快就后悔了。

它真的总是可以避免的，你甚至可以使用 foreach 但忽略值并使用键，几乎忘记它是一个 foreach 而不是 for，但避免你的键中的任何间隙，并在没有长度/分钟的情况下自动处理你的边界/max 函数或任何东西。

前任。

```
foreach($myArray as $key=>$val)
{
     myArray[$key] = myFunction(myArray[$key]);
} 
```

我发现这对并行数组特别有用。

```
$a = getA(); $b = getB();
foreach($a as $key=>val)
{
    $sql = "INSERT INTO table (field1, field2) VALUES ($a[$key], $b[$key])";
} 
```

# iis - IIS 7.0 多域站点绑定

> ID：222230
> 
> 赞同：6
> 
> 时间：2008-10-21T15:10:16.253
> 
> 标签：iis, iis-7, binding, hosting, dns

我有三个网站，每个网站都有自己的域，连接到我的一台 Windows Server 2008 IIS 7.0 Web 服务器。

*   `example1.com`
*   `example2.com`
*   `example3.com`

每个站点的绑定：

[IIS 7.0 站点绑定 example1.com http://img371.imageshack.us/img371/4215/example1pf4.gif](http://img371.imageshack.us/img371/4215/example1pf4.gif)

[IIS 7.0 站点绑定 example2.com http://img371.imageshack.us/img371/2567/example2xx0.gif](http://img371.imageshack.us/img371/2567/example2xx0.gif)

[IIS 7.0 站点绑定 example3.com http://img266.imageshack.us/img266/8186/example3rh9.gif](http://img266.imageshack.us/img266/8186/example3rh9.gif)

当我导航到 时`example1.com`，我会看到我的*example1*网站。

当我导航到 时`example2.com`，我会看到我的*example2*网站。

但是，当我导航到 时`example3.com`，我看到了我的*example1*网站——而不是我期望的*example3*网站。

这是怎么回事？为什么可能`example2.com`工作，但`example3.com`失败？

* * *

~~问题解决了！~~

我在 IIS 中删除并重新创建了*example3.com*网站，现在它可以正常工作了。

我没有改变任何东西。它要么最初有一个简单的错字，要么重新创建它的行为只是碰巧修复了 IIS 中的一个小问题。

* * *

~~在 IIS 中设置额外的重定向强制网站使用子域后，它再次停止工作：~~

`http://example1.com/`重定向到`http://www.example1.com/`

我再次删除并重新创建了*example3.com*网站；我已经重置了 IIS；我已经重新启动了服务器。它仍然无法正常工作。

* * *

我已经想通了。这不是 IIS 问题。这是一个DNS问题。

出于某种原因，`example3.com`流量被定向到另一家公司的 Web 服务器。他们提供的页面只有一个 HTML 框架。该框架加载带有地址的页面`http://example3.example1.com`。这就是我需要在我的网络服务器上处理的内容。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-21T15:17:26.817

我会验证您是否有 example3.com 指向磁盘上的正确位置。还要确保它没有停止。

回退到 example1 是由于绑定条目没有标头值。

# agile - 使用 Scrum 和 Sprint 改进基础设施的最佳方式

> ID：222243
> 
> 赞同：5
> 
> 时间：2008-10-21T15:13:49.570
> 
> 标签：agile, scrum, infrastructure

是否有人将 Scrum 和 Sprint 用于基础设施。

我正在为永远不会完成的 Sprint 的概念而苦苦挣扎，即网络增强项目。

还有关于如何将项目时间建立到产品待办列表的任何建议，以便我可以理智地检查资源在 sprint 中是否被过度使用。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-21T15:34:57.013

我建议您可以从刷新对 Scrum 整个概念的记忆开始（[http://en.wikipedia.org/wiki/Scrum](http://en.wikipedia.org/wiki/Scrum)可能是一个不错的起点）。

例如，我不认为应该有“永无止境的冲刺”之类的东西。如果您有一些非常长和/或经常性的任务，只需将其分解为更具体的任务。网络增强非常通用 - 将其分解为：

*   研究新网络设备的高峰期
*   检查电缆布局的尖峰
*   绘制设备物理位置和接线图的任务

估计这些并将它们放入您的待办事项列表中。

等等

然后计划短期（1-2）周的冲刺或迭代。为他们每个人分配一个特定的目标。将您的一些任务从积压工作添加到迭代中。完成它。

查看结果，调整过程，重复。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-23T11:38:09.380

Scrum 是一种项目管理方法，它并不是专门针对软件开发的；因此可用于网络增强项目。

你说你正在为“永远不会结束的冲刺”而苦苦挣扎，那不是 Scrum。Sprint 是有时间限制的，它们按时完成。

现在，如果团队在 sprint 中过度承诺，​​或者某些任务被低估，并且有未“完成”的积压项目，它们将从 sprint 的结果中删除，并可能在下一个 sprint 中继续。

您可以做几件事来防止过度使用：

*   积压项目应少；小物品比大物品更容易估计。实际上，它们应该具有[INVEST 特性](http://xp123.com/xplor/xp0308/index.shtml)。**编辑**：积压项目的大小应使团队*平均*可以在一个 Sprint 中完成 5 到 10 个。
*   在第一个 sprint 之后，您现在可以在 sprint 中投入多少团队（提供可比较的资源）
*   不要在 sprint 上 100% 分配人员，根据经验从 80% 开始
*   定义“完成”是什么意思
*   根据你学到的东西重新估计你的积压项目

如果网络增强项目永远无法完成，我认为这是因为发现了新的需求。将它们添加到您的待办事项中，对它们进行优先排序，对它们进行估计，它们最终将被安排在一个 sprint 中。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2014-06-23T16:53:54.623

你可以看看看板。您仍然有积压，但不是时间盒，而是在整个流程流程中施加 WIP 限制。我仍然建议在适当的情况下使用带有站立会议和定期回顾和演示的 Scrum 沟通计划。计划会议有点不同，因为您实际上并没有投入任何工作，但您仍然可以使用故事和故事点（WIP 限制可以在故事点上）。如果你每两周开会一次，我会确保你有 2.5 或 3 周的工作排队（虽然看板的一个优点是你可以随时将下一件大事添加到队列的顶部，而不必等到下一个短跑）。

此外，我喜欢这样一个事实，即您可以让泳道代表他们的各种客户，因为基础设施通常在处理最终用户支持票证并支持除了他们自己的日常工作之外的多个项目。

在瀑布中，您将一次构建和发布所有内容。在 Scrum 中，您会在短时间的冲刺中定期构建和发布。使用看板，您只需保持水流。

Google Infra-gile 了解更多信息。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-21T15:38:47.053

永不结束的 Sprint 不是 Sprint……它是一种职业。JK。如果主要目标无法实现和/或不断变化，请确保您已明确定义子目标。估计每项任务的工时，如果这些工时超过半天左右（非常宽松的规则），则将其分解为子任务。跟踪时间（不必精确——可以在站立会议上或通过您的项目管理系统或票务系统记录）并与任务进行比较。您会发现一些功能和完成时间相似的任务。将它们用作下一个 sprint 的原型，并不断增强它，直到你越来越符合要求。
一旦你对此有了很好的处理，重新审视你的积压工作，分配估计的时间并开始为你的 sprint 定义可靠的目标（由离散的、明确定义的子任务组成）、延伸目标和遥远的目标。坚实的目标应该在您的团队可以达到的范围内（不超过您可以完成的估计目标的 60%，通常更少），延伸目标应该从那个点到您估计可以完成的目标（以 100% 的估计效率）并且遥不可及你应该在你的雷达上设定目标，以防你在冲刺时运气很好。每天，在站立时回顾和绘制你的燃尽图，并重新评估你的 sprint 目标。如果你的估计有很大的变化，请注意原因，如果它们是系统的，重新审视你的任务和估计的时间并重新调整，这样你的下一个估计会更好。起初这是一项艰巨的工作，需要大量的纪律，但几个月后的回报是巨大的。只要坚持严格的现实。祝你好运！

# java - Java 有没有好的日期解析器？

> ID：222245
> 
> 赞同：23
> 
> 时间：2008-10-21T15:13:54.873
> 
> 标签：java, date, parsing

有谁知道不同语言/地区的好日期解析器。Java 的内置解析器（SimpleDateFormat）非常严格。它应该以当前日期完成缺失的部分。

例如

*   如果我不输入年份（仅日期和月份），则应使用当前年份。
*   如果年份是 08 那么它不应该解析 0008 因为当前年份模式有 4 位数字。

编辑：我想解析用户的输入。例如，如果用户的区域设置日期格式是“dd.mm.yyyy”并且用户只键入“12.11”。那么解析器应该接受它作为值为“12.11.2008”的有效日期。目标是良好的可用性。

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2008-10-21T15:18:20.417

检查 Joda Time 及其 Freaky [Formatters](https://www.joda.org/joda-time/userguide.html#Input_and_Output)。

[Java 8 包含 JSR-310](http://www.oracle.com/technetwork/articles/java/jf14-date-time-2125367.html)，因此这也可能是一个解决方案。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-10-21T15:23:46.693

从[43642](https://stackoverflow.com/questions/43842/how-would-you-programmatically-create-a-pattern-from-a-date-that-is-stored-in-a)开始，虽然不一定是重复的：

请参阅 Apache Commons 的[DateUtils](http://commons.apache.org/proper/commons-lang/javadocs/api-2.6/org/apache/commons/lang/time/DateUtils.html#parseDate%28java.lang.String,%20java.lang.String%5B%5D%29)。有一种`parseDate`方法可以让您`String`和多个模式尝试并吐出一个`Date`实例。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-10-21T15:18:52.443

（为清楚起见进行了编辑。）

个人觉得严格就好。如此多的不同情况需要围绕轻松解析的不同规则，要真正将其全面放入一个通用库中是不可能的。

但是，我*会*彻底推荐[Joda Time](https://www.joda.org/joda-time/)，而不是一般的内置日期/时间类。他们的格式化程序和解析器是线程安全的和不可变的，这也很有帮助。Joda Time 对轻松解析有一些支持，如另一个答案所示，但您应该期望自己必须提供一些规则。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-22T11:15:11.890

如果您正在寻找可以从自然“模糊”人工输入中解析日期的东西，我会说[JChronic 。](https://github.com/samtingleff/jchronic)

我已经成功地使用了 JChronic 和 Chronic（原始 Ruby 版本）。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2018-05-23T23:34:15.087

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-12-13T01:29:45.970

SourceForge 上的 POJava 项目有一个 DateTime 对象，可以解析多种语言的日期（当月份被指定为名称时），并且可以在 MM-DD-YYYY 和 DD-MM-YYYY 之间进行配置。它启发式地解析日期，挑选出最可能的年、月、日、小时、分钟、秒和时区，而不是支持预定义的格式。jar 文件大小约为 60K。

对像“10-08”这样的日期的解释存在歧义，因为它可能是“2008-10-08”或“2008 年 10 月”的简写。如果您接受您在示例中给出的那种速记，您可以自己附加年份。

项目：[POJava](http://sourceforge.net/project/showfiles.php?group_id=226950) 文档：[如何使用 DateTime](http://pojava.org/examples/datetime.html)

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2021-06-15T19:01:36.053

**[Basil Bourque](https://stackoverflow.com/a/50498871/10819573)已回答**您的第一个要求**。**

 **> *   如果我不输入年份（仅日期和月份），则应使用当前年份。
> *   如果年份是 08 那么它不应该解析 0008 因为当前年份模式有 4 位数字。

`DateTimeFormatter`允许我们在方括号内指定可选模式。对于第二个要求，您可以指定可选模式，`[.[uuuu][uu]]`同时构建`DateTimeFormatter`.

**演示：**

```
import java.time.LocalDate;
import java.time.ZoneId;
import java.time.format.DateTimeFormatter;
import java.time.format.DateTimeFormatterBuilder;
import java.time.temporal.ChronoField;
import java.util.Locale;
import java.util.stream.Stream;

public class Main {
    public static void main(String[] args) {
        // Replace JVM's ZoneId, ZoneId.systemDefault() with the applicable one e.g.
        // ZoneId.of("Europe/Berlin")
        int defaultYear = LocalDate.now(ZoneId.systemDefault()).getYear();

        DateTimeFormatter dtf = new DateTimeFormatterBuilder()
                                .appendPattern("dd.MM[.[uuuu][uu]]")
                                .parseDefaulting(ChronoField.YEAR, defaultYear)
                                .toFormatter(Locale.ENGLISH);

        // Test
        Stream.of(
                    "12.11",
                    "12.11.21",
                    "12.11.2021"
        ).forEach(s -> System.out.println(LocalDate.parse(s, dtf)));        
    }
} 
```

**输出：**

```
2021-11-12
2021-11-12
2021-11-12 
```

[`ONLINE DEMO`](https://ideone.com/8wnpJ2)

**[从Trail: Date Time](https://docs.oracle.com/javase/tutorial/datetime/index.html)**了解有关现代日期时间 API 的更多信息。

* * *

^(* 出于任何原因，如果您必须坚持使用 Java 6 或 Java 7，则可以使用[***ThreeTen-Backport，***](http://www.threeten.org/threetenbp/)它将大部分*java.time*功能向后移植到 Java 6 和 7。如果您正在为 Android 项目和 Android API 工作level 仍然不符合 Java-8，请检查[Java 8+ APIs available through desugaring](https://developer.android.com/studio/write/java8-support-table)和[How to use ThreeTenABP in Android Project](https://stackoverflow.com/questions/38922754/how-to-use-threetenabp-in-android-project)。)

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-21T15:19:06.907

使用 DateFormat ... 当前标准，直到 Joda 受到欢迎。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-10-21T15:21:35.450

[日历](http://java.sun.com/j2se/1.4.2/docs/api/java/util/Calendar.html)通常是要走的路，但要明白，如果您希望正确完成大多数 Java 日期管理，则将由您自己处理。 [如果您必须管理国际/跨区域信息，时区](http://java.sun.com/j2se/1.4.2/docs/api/java/util/TimeZone.html)是一件好事。[Joda Time](https://www.joda.org/joda-time/)也是一个巧妙的东西，它是[JSR 310](http://today.java.net/pub/a/today/2008/09/18/jsr-310-new-java-date-time-api.html)中将添加到 Java 中的新建议的日期/时间概念背后的灵感。

希望这会有所帮助。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-08-12T21:30:29.540

我试图[在这个答案](https://stackoverflow.com/questions/1268174/phps-strtotime-in-java/1268380#1268380)`strtotime`中用Java实现一个可扩展的 PHP

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-10-21T15:22:01.317

我不得不为 JodaTime 说 +1。除了解析之外，Joda 还使几乎所有与日期相关的操作都变得更好。

# c++ - 音量控制 XP 与 Vista 不同的通道数

> ID：222248
> 
> 赞同：0
> 
> 时间：2008-10-21T15:14:07.447
> 
> 标签：c++, windows, audio

当我运行此代码时：

```
MIXERLINE MixerLine;
memset( &MixerLine, 0, sizeof(MIXERLINE) );
MixerLine.cbStruct = sizeof(MIXERLINE);
MixerLine.dwComponentType = MIXERLINE_COMPONENTTYPE_SRC_WAVEOUT;
mmResult = mixerGetLineInfo( (HMIXEROBJ)m_dwMixerHandle, &MixerLine, MIXER_GETLINEINFOF_COMPONENTTYPE ); 
```

在 XP MixerLine.cChannels 下返回声卡支持的通道数。经常2，这些天经常更多。

在 Vista 下，MixerLine.cChannels 作为一个返回。

然后我得到了一个 MIXERC​​ONTROL_CONTROLTYPE_VOLUME 控件并为每个受支持的通道设置音量，并将不同通道上的音量控制设置为不同的级别，以便在扬声器之间来回平移音乐（从左到右）。

显然在 Vista 下这种方法是行不通的，因为只有一个通道。我可以设置音量，它同时适用于两个通道。

我试图为这个设备获取一个 MIXERC​​ONTROL_CONTROLTYPE_PAN，但这不是一个有效的控件。

所以，所有MMSystem专家的问题是：我需要什么类型的控制来调整左/右平衡？或者，有没有更好的方法？我想要一个适用于 XP 和 Vista 的解决方案。

计算机详细信息：运行 Vista Ultimta 32 位 SP1 和所有最新补丁。音频由带有 4 个扬声器的 Creative Audigy 2 ZS 卡提供，这些扬声器都可以通过 Vista 的声音面板正确寻址（控制）。驱动程序是 Creative 网站上的最新版本 (SBAX_PCDRV_LB_2_18_0001)。Vista 声音未设置为单声道，所有声道都可以从声音面板中看到和控制。

在“XP 兼容模式”下运行程序不会改变此问题的行为。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-22T16:28:01.587

如果您在“XP 兼容性”模式下运行您的应用程序，则混音器 API 的工作方式应该更接近于它们在 XP 中的工作方式。

如果您没有在 XP 模式下运行，那么混音器 API 会反映混音格式 - 如果您的 PC 的音频解决方案配置为单声道，那么您只会看到一个通道，但如果您的机器配置为多通道输出混音器 API 应该反映这一点。

您可以运行扬声器调谐向导来确定为您的音频解决方案配置的通道数。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-22T15:09:55.130

很长一段时间，Microsoftie [Larry Osterman 有一个博客](http://blogs.msdn.com/larryosterman/)，他在博客中讨论了此类问题，因为他所在的团队在 Vista 中重新编写了所有音频内容。

在[对这篇博文的评论中，](http://blogs.msdn.com/larryosterman/archive/2005/12/16/504710.aspx)他似乎表明应用程序控制的平衡不是他们认为需要的：

> CN，实际上我们不知道应用程序控制其平衡的任何情况。话虽如此，我们确实支持应用程序的单独通道量，但强烈建议应用程序不要使用它。

他还表示可以将声音从一侧平移到另一侧，但这取决于硬件是否支持：

> Joku，我们公开了音频解决方案实现的音量控制。如果它可以进行平移，我们就进行平移（我们实际上为左右通道公开了单独的滑块）。

这就解释了为什么`MIXERCONTROL_CONTROLTYPE_PAN`事情失败了——你系统上的音频硬件不支持它。

# sharepoint - Sharepoint 自定义用户和文档库特定属性

> ID：222261
> 
> 赞同：1
> 
> 时间：2008-10-21T15:18:19.997
> 
> 标签：sharepoint, properties, profiler

是否有将自定义属性与用户关联的标准方法？我需要为每个用户和文档库分别存储用户在文档库网格中选择的每页项目数。

**编辑：**

抱歉这种含糊不清，我想以*编程*方式进行。似乎我找到了解决方案，它是[UserProfileManager](http://msdn.microsoft.com/en-us/library/microsoft.office.server.userprofiles.userprofilemanager.aspx)类，尽管我现在正在研究您可以以这种方式为用户保存的属性数量是否存在限制，因为保存页面大小的最简单方法每个用户+文档库的基础似乎使用视图的 GUID 作为属性名称和页数作为值。虽然我不知道它是否更有效，但取决于 sharepoint 如何存储这些属性。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-21T20:28:36.907

不，您需要创建自定义代码来存储数据。

鉴于创建的潜在数据量，将其存储在单独的数据库中可能是明智之举。

这将为数据的操作和检索方式提供更大的灵活性。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-21T15:39:19.750

你的问题有点含糊。您是否正在寻找任何自定义代码？您可以通过多种方式做到这一点，因此在不知道更多您想要什么的情况下很难。

使用自定义代码，您可以设置工作流或事件处理程序来响应项目事件并记录信息并使用用户配置文件或作为 SPPersistedObject 存储它。

如果您想要一种较少以开发人员为中心的方式来做到这一点，您可以使用审计并简单地报告审计结果。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-21T22:49:27.107

您可以设置一个列表来存储选择数据，然后使用文档列表上的事件/AJAX 将勾选/取消勾选项目推送到选择列表中（至少存储用户、库和文档。

如果你不想要一个单独的列表，你可以在你的文档库中创建一个字段来存储哪些用户标记了给定的文档......当用户打勾时，你仍然需要某种事件/AJAX 来更新列表/取消选中该框。粗:)

# c - 在 C 中安全地把 char* 加倍

> ID：222266
> 
> 赞同：11
> 
> 时间：2008-10-21T15:18:57.717
> 
> 标签：c, endianness, type-punning

[在我编写](http://honeypot.net/project/pgdbf)的开源程序中，我正在从文件中读取二进制数据（由另一个程序编写）并输出整数、双精度和其他各种数据类型。挑战之一是它需要在两种字节序的 32 位和 64 位机器上运行，这意味着我最终不得不做相当多的低级位旋转。我对类型双关语和严格别名了解（非常）一点，并希望确保我以正确的方式做事。

基本上，很容易从 char* 转换为各种大小的 int：

```
int64_t snativeint64_t(const char *buf) 
{
    /* Interpret the first 8 bytes of buf as a 64-bit int */
    return *(int64_t *) buf;
} 
```

我有一组支持函数来根据需要交换字节顺序，例如：

```
int64_t swappedint64_t(const int64_t wrongend)
{
    /* Change the endianness of a 64-bit integer */
    return (((wrongend & 0xff00000000000000LL) >> 56) |
            ((wrongend & 0x00ff000000000000LL) >> 40) |
            ((wrongend & 0x0000ff0000000000LL) >> 24) |
            ((wrongend & 0x000000ff00000000LL) >> 8)  |
            ((wrongend & 0x00000000ff000000LL) << 8)  |
            ((wrongend & 0x0000000000ff0000LL) << 24) |
            ((wrongend & 0x000000000000ff00LL) << 40) |
            ((wrongend & 0x00000000000000ffLL) << 56));
} 
```

在运行时，程序会检测机器的字节序并将上述之一分配给函数指针：

```
int64_t (*slittleint64_t)(const char *);
if(littleendian) {
    slittleint64_t = snativeint64_t;
} else {
    slittleint64_t = sswappedint64_t;
} 
```

现在，当我尝试将 char* 转换为 double 时，棘手的部分就来了。我想像这样重新使用字节序交换代码：

```
union 
{
    double  d;
    int64_t i;
} int64todouble;

int64todouble.i = slittleint64_t(bufoffset);
printf("%lf", int64todouble.d); 
```

然而，一些编译器可能会优化掉“int64todouble.i”赋值并破坏程序。有没有更安全的方法来做到这一点，同时考虑到这个程序必须保持性能优化，而且我不希望编写一组并行转换来直接将 char* 转换为 double ？如果双关语的联合方法是安全的，我是否应该重写我的函数，如 snativeint64_t 来使用它？

* * *

我最终使用了[Steve Jessop 的](https://stackoverflow.com/users/13005/)答案，因为转换函数被重写为使用 memcpy，如下所示：

```
int64_t snativeint64_t(const char *buf) 
{
    /* Interpret the first 8 bytes of buf as a 64-bit int */
    int64_t output;
    memcpy(&output, buf, 8);
    return output;
} 
```

编译成与我的原始代码完全相同的汇编程序：

```
snativeint64_t:
        movq    (%rdi), %rax
        ret 
```

在这两者中，memcpy 版本更明确地表达了我正在尝试做的事情，并且应该适用于即使是最天真的编译器。

亚当，你的回答也很棒，我从中学到了很多。感谢您的发布！

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-10-21T15:24:51.060

我强烈建议您阅读[Understanding Strict Aliasing](http://cellperformance.beyond3d.com/articles/2006/06/understanding-strict-aliasing.html)。具体来说，请参阅标有“通过联合铸造”的部分。它有很多很好的例子。虽然这篇文章在一个关于 Cell 处理器的网站上并使用了 PPC 组装示例，但几乎所有这些都同样适用于其他架构，包括 x86。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-21T15:28:40.413

该标准说，写入联合的一个字段并立即从中读取是未定义的行为。因此，如果您按照规则手册进行操作，则基于联合的方法将不起作用。

宏通常是一个坏主意，但这可能是规则的一个例外。使用输入和输出类型作为参数的一组宏应该可以在 C 中获得类似模板的行为。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-21T16:29:08.573

由于您似乎对您的实现足够了解以确保 int64_t 和 double 大小相同，并且具有合适的存储表示，因此您可能会冒险使用 memcpy。然后你甚至不必考虑混叠。

由于您使用函数指针来表示如果您愿意发布多个二进制文件可能很容易内联的函数，因此性能无论如何都不是一个大问题，但您可能想知道某些编译器可能会非常糟糕地优化 memcpy -对于小整数大小，可以内联一组加载和存储，您甚至可能会发现变量已完全优化，编译器执行“复制”只是重新分配它用于变量的堆栈槽，就像联合一样。

```
int64_t i = slittleint64_t(buffoffset);
double d;
memcpy(&d,&i,8); /* might emit no code if you're lucky */
printf("%lf", d); 
```

检查生成的代码，或者只是对其进行分析。即使在最坏的情况下，它也不会很慢。

但是，总的来说，对字节交换做任何过于聪明的事情都会导致可移植性问题。存在具有中端双精度的 ABI，其中每个单词都是 little-endian，但 big word 先出现。

通常您可以考虑使用 sprintf 和 sscanf 存储双打，但对于您的项目，文件格式不在您的控制之下。但是，如果您的应用程序只是将 IEEE 双精度数据从一种格式的输入文件转换为另一种格式的输出文件（不确定是否是，因为我不知道有问题的数据库格式，但如果是的话），那么也许您可以忘记它是双精度数的事实，因为无论如何您都没有将它用于算术。只需将其视为不透明的 char[8]，仅当文件格式不同时才需要进行字节交换。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-21T15:38:59.190

作为一个非常小的子建议，我建议您调查是否可以在 64 位情况下交换掩码和移位。由于该操作是交换字节，因此您应该始终可以使用`0xff`. 这应该会导致更快、更紧凑的代码，除非编译器足够聪明，可以自己解决这个问题。

简而言之，改变这个：

```
(((wrongend & 0xff00000000000000LL) >> 56) 
```

进入这个：

```
((wrongend >> 56) & 0xff) 
```

应该产生相同的结果。

* * *

## 回答 #5

> 赞同：-2
> 
> 时间：2008-10-21T15:55:04.883

*编辑：
删除了关于如何有效地存储数据总是大端和交换到机器端的评论，因为提问者没有提到另一个程序写入他的数据（这是重要信息）。

尽管如此，如果数据需要从任何字节序转换为大字节序，从大字节序转换为主机字节序，ntohs/ntohl/htons/htonl 是最好的方法，最优雅且速度无与伦比（因为如果 CPU 支持，它们将在硬件中执行任务，你不能打败那个）。*

* * *

关于双精度/浮点数，只需通过内存转换将它们存储到整数：

```
double d = 3.1234;
printf("Double %f\n", d);
int64_t i = *(int64_t *)&d;
// Now i contains the double value as int
double d2 = *(double *)&i;
printf("Double2 %f\n", d2); 
```

将其包装成一个函数

```
int64_t doubleToInt64(double d)
{
    return *(int64_t *)&d;
}

double int64ToDouble(int64_t i)
{
    return *(double *)&i;
} 
```

* * *

发问者提供了这个链接：

[http://cocoawithlove.com/2008/04/using-pointers-to-recast-in-c-is-bad.html](http://cocoawithlove.com/2008/04/using-pointers-to-recast-in-c-is-bad.html)

作为铸造不好的证明......不幸的是，我只能强烈反对这一页的大部分内容。引用和评论：

> 与通过指针进行强制转换一样普遍，这实际上是一种不好的做法，并且有潜在的风险代码。由于类型双关语，通过指针进行转换可能会产生错误。

这根本没有风险，也不是不好的做法。如果你做错了，它只有可能导致错误，就像用 C 编程如果你做错了有可能导致错误一样，任何语言的任何编程也是如此。根据这个论点，您必须完全停止编程。

> 类型双关语
> 一种指针别名形式，其中两个指针 和 引用内存中的相同位置，但将该位置表示为不同的类型。编译器会将这两个“双关语”视为不相关的指针。类型双关有可能导致通过两个指针访问的任何数据的依赖性问题。

这是真的，但不幸的是*与我的代码完全无关*。

他指的是这样的代码：

```
int64_t * intPointer;
:
// Init intPointer somehow
:
double * doublePointer = (double *)intPointer; 
```

现在 doublePointer 和 intPointer 都指向同一个内存位置，但是把它当作同一个类型。这确实是您应该通过工会解决的情况，其他任何事情都非常糟糕。糟糕的是，这不是我的代码所做的！

我的代码按**值**复制，而不是按**引用**复制。我将一个 double 转换为 int64 指针（或相反）并**立即遵从**它。一旦函数返回，就没有指向任何东西的指针。有一个 int64 和一个 double ，它们与函数的输入参数完全无关。我从不将任何指针复制到不同类型的指针（如果您在我的代码示例中看到这一点，您严重误读了我编写的 C 代码），我只是将值传输到不同类型的变量（在自己的内存位置） . 所以类型双关的定义根本不适用，因为它说“引用内存中的相同位置”，这里没有任何东西指的是相同的内存位置。

```
int64_t intValue = 12345;
double doubleValue = int64ToDouble(intValue);
// The statement below will not change the value of doubleValue!
// Both are not pointing to the same memory location, both have their
// own storage space on stack and are totally unreleated.
intValue = 5678; 
```

我的代码只不过是一个内存副本，只是用 C 语言编写的，没有外部函数。

```
int64_t doubleToInt64(double d)
{
    return *(int64_t *)&d;
} 
```

可以写成

```
int64_t doubleToInt64(double d)
{
    int64_t result;
    memcpy(&result, &d, sizeof(d));
    return result;
} 
```

仅此而已，因此即使在任何地方都看不到类型双关语。而且这个操作也是完全安全的，就像在 C 中的操作一样安全。 double 被定义为始终为 64 位（与 int 不同，它的大小不变，它固定为 64 位），因此它总是适合成一个 int64_t 大小的变量。

# asp.net - 如何将 ASP.NET 网站编译成单个 DLL 文件？

> ID：222276
> 
> 赞同：15
> 
> 时间：2008-10-21T15:22:07.180
> 
> 标签：asp.net, visual-studio, dll, compilation, web-deployment-project

我终于完成了我的网站。我发表了它，我对结果感到惊讶。虽然 App_Code 编译成一个单独的 DLL 文件，但每个页面后面的代码都编译成自己的 DLL 文件。如何使它成为一个 DLL 文件？

此外，是否可以将所有内容（SubSonic、AJAX 等）编译到同一个 DLL 文件中？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-10-21T15:24:16.507

您可能更愿意为此使用 Web 应用程序项目样式。

您可以使用[ILMerge](http://www.microsoft.com/downloads/details.aspx?FamilyID=22914587-B4AD-4EAE-87CF-B14AE6A939B0&displaylang=en)将程序集合并为一个。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-21T15:31:59.687

为此，您必须将项目转换为 Web 应用程序项目（在 Visual Studio 2005 SP1 和 Visual Studio 2008 中受支持）。

转换过程并不难，但您需要将所有内容移出 app_code 文件夹，因为 WAP（Web 应用程序项目）项目在 app_code 中没有代码。

完成此操作后，项目中的所有内容都将编译为单个 DLL 文件，但任何外部程序集仍包含在它们自己的 DLL 文件中，但也有一些选项可供选择。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-21T15:45:42.703

我们这样做的方式是向我们的站点添加一个部署项目：

[http://msdn.microsoft.com/en-us/asp.net/aa336619.aspx](http://msdn.microsoft.com/en-us/asp.net/aa336619.aspx)

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-21T15:50:18.403

我们为我们的网站使用构建脚本并从命令行运行 aspnet_merge.exe。这是 MSDN 页面：http: [//msdn.microsoft.com/en-us/library/bb397866.aspx](http://msdn.microsoft.com/en-us/library/bb397866.aspx)

# asp.net-mvc - Asp.Net MVC Beta：以前的 RouteData 会覆盖当前的 RouteData？

> ID：222300
> 
> 赞同：1
> 
> 时间：2008-10-21T15:29:28.210
> 
> 标签：asp.net-mvc, routedata

我有类似于以下方法的东西：

```
 public ActionResult Details(int id)
    {
        var viewData = new DetailsViewData
        {
            Booth = BoothRepository.Find(id),
            Category = ItemType.HotBuy
        };
        return View(viewData);
    } 
```

和以下路线：

```
routes.MapRoute("shows","shows/{controller}/{action}/{id}", new {id = 0}); 
```

在测试版之前一切正常，当我有预览版 3 时。现在该方法将在我第一次执行操作时正确填充 id。然而，控制器第二次`ModelState`包含上次使用的 id 值。这会导致`ActionInvoker`在方法的参数而不是`Route`值中使用它。

因此，如果我对两个不同的实体调用该操作两次，结果如下：

```
www.mysite.com/shows/Booth/Details/1  => Details(1)
www.mysite.com/shows/Booth/Details/2  => Details(1)  //from ModelState["id"] 
```

从我使用 Reflector 的快速扫描来看，它似乎首先将参数绑定到 ModelState，然后再绑定到 Routes。但是，我什至从未发布过模型中的任何内容。据我所知，ModelState 不应包含任何内容。

这是测试版中的错误，可能是我的代码中的某个错误，还是有一些我不知道的设计功能？感谢您对 ModelState 的性质以及发生这种情况的原因的任何见解。

编辑：我发现这个问题实际上是 DefaultValueProvider 出现错误的症状，如果您从在 Asp.Net 应用程序的生命周期中存在的 IoC 容器实例化控制器。发生的情况是 DefaultValueProvider 使用第一个给控制器的 ControllerContext 并且在重新创建控制器之前永远不会更新它。这会导致旧的 RouteData 用于方法参数，而不是当前的 RouteData。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-21T15:51:06.653

我很难从你的帖子中说出你期望发生什么以及正在发生什么。您的 BoothRepository.Find 方法是否可能存在错误，以至于它每次都返回相同的内容？

ModelBinder 不应影响此方法，因为操作方法的参数是简单类型 int。

这两个请求都是 GET 请求吗？如果您仍然遇到问题，您能否尝试创建最简单的复制品并将其通过电子邮件发送到 philha - microsoft dot com？

编辑：问题最终是开发人员试图跨请求重用 valueprovider（通过让 Castle Windsor 管理控制器的生命周期）。现在，不支持跨请求重用控制器实例，就像使用具有 IsReusable 属性的 IHttpHandler 那样。所以一般来说，跨请求重用控制器需要做更多的工作。:)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-29T12:29:17.270

问题是生活方式，我完全忽略了它被定义的事实，这意味着默认情况下控制器将使用单例生活方式。将所有控制器的 LifeStyle 设置为 Transient 将解决此问题。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-01T10:15:28.683

如果你使用 spring.net 修改控制器的单例为“假”

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-01T17:51:21.963

在将 Singleton 行为与 IoC 容器（例如 Spring.NET 或 Windsor）一起使用时，这是一个常见问题。控制器不应该有单例行为，因为 ControllerContext 是每个请求的，很像 HttpContext。

# ruby-on-rails - 从 Rails 中的 xml 呈现中排除一些 ActiveRecord 属性

> ID：222304
> 
> 赞同：11
> 
> 时间：2008-10-21T15:31:35.087
> 
> 标签：ruby-on-rails

我有一个想要转换为 xml 的 ActiveRecord 模型，但我不希望在 xml 中呈现所有属性。是否有一个参数可以传递给 render 方法以防止属性在 xml 中呈现？

下面是我所说的一个例子。

```
def show
  @person = Person.find(params[:id])
  respond_to do |format|
    format.xml { render :xml => @person }
  end
end 
```

产生以下 xml

```
<人>
  <name>保罗</name>
  <年龄>25</年龄>
  <电话>555.555.5555</电话>
</人>

```

但是，我不希望显示电话属性。渲染方法中是否有一些参数将属性排除在 xml 中呈现？有点像下面的例子

```
def show
  @person = Person.find(params[:id])
  respond_to do |format|
    format.xml { render :xml => @person, :exclude_attribute => :phone }
  end
end 
```

这将呈现以下xml

```
<人>
  <name>保罗</name>
  <年龄>25</年龄>
</人>

```

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-10-21T15:49:31.417

您可以将模型属性名称数组传递给`:only`and`:except`选项，因此对于您的示例，它将是：

```
def show
  @person = Person.find(params[:id])
  respond_to do |format|
    format.xml { render :text => @person.to_xml, :except => [:phone] }
  end
end 
```

*   [to_xml 文档](http://api.rubyonrails.org/classes/ActiveRecord/Serialization.html#M001145)

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-11-18T21:49:54.317

我只是想知道同样的事情，我在模型级别进行了更改，因此我不必在控制器中进行更改，如果您有兴趣，只是另一种选择。

**模型**

```
class Person < ActiveRecord::Base
 def to_xml
  super(:except => [:phone])
 end
 def to_json
  super(:except => [:phone])
 end
end 
```

**控制器**

```
class PeopleController < ApplicationController
  # GET /people
  # GET /people.xml
  def index
    @people = Person.all

    respond_to do |format|
      format.html # index.html.erb
      format.xml  { render :xml => @people }
      format.json  { render :json => @people }
    end
  end
end 
```

我在每个对象上为 json 和 xml 设置了一个，当我想从每个替代格式的响应中过滤掉东西时，这有点方便。这个方法很酷的一点是，即使你得到一个集合，它也会调用这个方法并返回过滤后的结果。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-21T16:57:46.503

“render :xml”不起作用，但 to_xml 确实起作用。下面是一个例子

```
def show
  @person = Person.find(params[:id])
  respond_to do |format|
    format.xml { render :text => @person.to_xml(:except => [:phone]) }
  end
end 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-03-16T20:46:20.447

除了很好，但你必须记住把它放在任何地方。如果你把它放在控制器中，每个方法都需要有一个 except 子句。我在我的模型中覆盖了 serializable_hash 方法以排除我不想显示的内容。这样做的好处是不必将它放在您要返回的每个地方，也可以应用于 JSON 响应。

# javascript - 计算一个月的最后一天

> ID：222309
> 
> 赞同：359
> 
> 时间：2008-10-21T15:33:14.320
> 
> 标签：javascript, date

如果您提供`0`in`dayValue`您`Date.setFullYear`将获得上个月的最后一天：

```
d = new Date(); d.setFullYear(2008, 11, 0); //  Sun Nov 30 2008 
```

在[mozilla](http://developer.mozilla.org/en/Core_JavaScript_1.5_Reference/Global_Objects/Date/setFullYear)中提到了这种行为。这是一个可靠的跨浏览器功能还是我应该看看其他方法？

* * *

## 回答 #1

> 赞同：548
> 
> 时间：2008-10-21T16:06:33.970

```
var month = 0; // January
var d = new Date(2008, month + 1, 0);
console.log(d.toString()); // last day in January
```

```
IE 6:                     Thu Jan 31 00:00:00 CST 2008
IE 7:                     Thu Jan 31 00:00:00 CST 2008
IE 8: Beta 2:             Thu Jan 31 00:00:00 CST 2008
Opera 8.54:               Thu, 31 Jan 2008 00:00:00 GMT-0600
Opera 9.27:               Thu, 31 Jan 2008 00:00:00 GMT-0600
Opera 9.60:               Thu Jan 31 2008 00:00:00 GMT-0600
Firefox 2.0.0.17:         Thu Jan 31 2008 00:00:00 GMT-0600 (Canada Central Standard Time)
Firefox 3.0.3:            Thu Jan 31 2008 00:00:00 GMT-0600 (Canada Central Standard Time)
Google Chrome 0.2.149.30: Thu Jan 31 2008 00:00:00 GMT-0600 (Canada Central Standard Time)
Safari for Windows 3.1.2: Thu Jan 31 2008 00:00:00 GMT-0600 (Canada Central Standard Time) 
```

产出差异是由于`toString()`实施的差异，而不是因为日期不同。

~~当然，仅仅因为上面确定的浏览器使用 0 作为上个月的最后一天并不意味着它们会继续这样做，或者没有列出的浏览器会这样做，但它增加了人们相信它应该可以工作的可信度。在每个浏览器中都以相同的方式。~~

* * *

## 回答 #2

> 赞同：112
> 
> 时间：2012-12-08T01:06:33.163

我发现这对我来说是最好的解决方案。让 Date 对象为您计算它。

```
var today = new Date();
var lastDayOfMonth = new Date(today.getFullYear(), today.getMonth()+1, 0); 
```

将 day 参数设置为 0 表示比该月的第一天少一天，即上个月的最后一天。

* * *

## 回答 #3

> 赞同：80
> 
> 时间：2008-10-21T15:41:25.660

我会在下个月的第一天使用中间日期，并返回前一天的日期：

```
int_d = new Date(2008, 11+1,1);
d = new Date(int_d - 1); 
```

* * *

## 回答 #4

> 赞同：33
> 
> 时间：2015-01-14T16:31:52.903

在计算机方面，`new Date()`解决`regular expression`方案很*慢！*如果你想要一个超快速（和超神秘）的单行，试试这个（假设`m`是`Jan=1`格式）。我不断尝试不同的代码更改以获得最佳性能。

**我目前*最快*的版本：**

在查看了这个相关问题[Leap year check using bitwise operators (惊人的速度)](https://stackoverflow.com/questions/9852837/leap-year-check-using-bitwise-operators-amazing-speed/9852989#comment44363797_9852989)并发现 25 & 15 幻数代表什么之后，我想出了这个优化的混合答案：

```
function getDaysInMonth(m, y) {
    return m===2 ? y & 3 || !(y%25) && y & 15 ? 28 : 29 : 30 + (m+(m>>3)&1);
} 
```

鉴于位移，这显然假设您的`m`&`y`参数都是整数，因为将数字作为字符串传递会导致奇怪的结果。

**JSFiddle：http:** [//jsfiddle.net/TrueBlueAussie/H89X3/22/](http://jsfiddle.net/TrueBlueAussie/H89X3/22/)

**JSPerf 结果：http:** [//jsperf.com/days-in-month-head-to-head/5](http://jsperf.com/days-in-month-head-to-head/5)

由于某种原因，`(m+(m>>3)&1)`它比*几乎*所有浏览器都更有效`(5546>>m&1)`。

 *唯一真正的速度竞争来自@GitaarLab，所以我创建了一个面对面的 JSPerf 供我们测试：http: [//jsperf.com/days-in-month-head-to-head/5](http://jsperf.com/days-in-month-head-to-head/5)

* * *

它基于我的闰年答案在这里工作：[javascript to findleap year](https://stackoverflow.com/questions/8175521/javascript-to-find-leap-year/19570985#19570985) this answer here[闰年检查使用按位运算符（惊人的速度）](https://stackoverflow.com/questions/9852837/leap-year-check-using-bitwise-operators-amazing-speed)以及以下二进制逻辑。

**二进制月份的快速课程：**

*如果您以二进制*形式解释所需月份的索引（Jan = 1） ，您会注意到具有 31 天的月份要么清除了位 3 并设置了位 0，要么设置了位 3 并清除了位 0。

```
Jan = 1  = 0001 : 31 days
Feb = 2  = 0010
Mar = 3  = 0011 : 31 days
Apr = 4  = 0100
May = 5  = 0101 : 31 days
Jun = 6  = 0110
Jul = 7  = 0111 : 31 days
Aug = 8  = 1000 : 31 days
Sep = 9  = 1001
Oct = 10 = 1010 : 31 days
Nov = 11 = 1011
Dec = 12 = 1100 : 31 days 
```

这意味着您可以使用 将值移位 3`>> 3`位，将这些位与原始位进行异或，并使用.`^ m`查看结果是否为`1`0`0` *位*`& 1`。注意：事实证明它`+`比 XOR ( `^`) 稍快，并且`(m >> 3) + m`在位 0 中给出相同的结果。

**JSPerf 结果**：http: [//jsperf.com/days-in-month-perf-test/6](http://jsperf.com/days-in-month-perf-test/6)

* * *

## 回答 #5

> 赞同：26
> 
> 时间：2011-03-14T17:03:46.863

我的同事偶然发现了以下可能是更简单的解决方案

```
function daysInMonth(iMonth, iYear)
{
    return 32 - new Date(iYear, iMonth, 32).getDate();
} 
```

[从 http://snippets.dzone.com/posts/show/2099 被盗](http://snippets.dzone.com/posts/show/2099)

* * *

## 回答 #6

> 赞同：21
> 
> 时间：2011-12-22T08:55:35.887

**对lebreeze**提供的解决方案稍作修改：

```
function daysInMonth(iMonth, iYear)
{
    return new Date(iYear, iMonth, 0).getDate();
} 
```

* * *

## 回答 #7

> 赞同：11
> 
> 时间：2018-09-07T21:25:28.507

我最近不得不做类似的事情，这就是我想出的：

```
/**
* Returns a date set to the begining of the month
* 
* @param {Date} myDate 
* @returns {Date}
*/
function beginningOfMonth(myDate){    
  let date = new Date(myDate);
  date.setDate(1)
  date.setHours(0);
  date.setMinutes(0);
  date.setSeconds(0);   
  return date;     
}

/**
 * Returns a date set to the end of the month
 * 
 * @param {Date} myDate 
 * @returns {Date}
 */
function endOfMonth(myDate){
  let date = new Date(myDate);
  date.setDate(1); // Avoids edge cases on the 31st day of some months
  date.setMonth(date.getMonth() +1);
  date.setDate(0);
  date.setHours(23);
  date.setMinutes(59);
  date.setSeconds(59);
  return date;
} 
```

将它传入一个日期，它将返回一个设置为月初或月底的日期。

该`begninngOfMonth`函数是相当不言自明的，但`endOfMonth`函数中的内容是我将月份递增到下个月，然后使用`setDate(0)`将日期回滚到上个月的最后一天，这是设置日期规范：

[https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date/setDate](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date/setDate) [https://www.w3schools.com/jsref/jsref_setdate.asp](https://www.w3schools.com/jsref/jsref_setdate.asp)

然后，我将小时/分钟/秒设置为一天结束，这样如果您使用某种 API 预期日期范围，您将能够捕获最后一天的全部内容。这部分可能超出了原始帖子的要求，但它可以帮助其他人寻找类似的解决方案。

`setMilliseconds()`编辑：如果你想更加精确，你也可以加倍努力并设置毫秒。

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2012-08-01T06:48:51.560

试试这个。

```
lastDateofTheMonth = new Date(year, month, 0) 
```

例子：

```
new Date(2012, 8, 0) 
```

输出：

```
Date {Fri Aug 31 2012 00:00:00 GMT+0900 (Tokyo Standard Time)} 
```

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2016-02-23T21:36:39.457

这对我有用。将提供给定年份和月份的最后一天：

```
var d = new Date(2012,02,0);
var n = d.getDate();
alert(n); 
```

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2016-06-01T19:31:35.670

这个很好用：

```
Date.prototype.setToLastDateInMonth = function () {

    this.setDate(1);
    this.setMonth(this.getMonth() + 1);
    this.setDate(this.getDate() - 1);

    return this;
} 
```

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2018-03-20T06:57:50.990

**这将为您提供当前月份的第一天和最后一天。**

如果您需要更改“年份”，请删除 d.getFullYear() 并设置您的年份。

如果您需要更改“月份”，请删除 d.getMonth() 并设置您的年份。

```
var d = new Date();
var days = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];
var fistDayOfMonth = days[(new Date(d.getFullYear(), d.getMonth(), 1).getDay())];
	var LastDayOfMonth = days[(new Date(d.getFullYear(), d.getMonth() + 1, 0).getDay())]; 
console.log("First Day :" + fistDayOfMonth); 
console.log("Last Day:" + LastDayOfMonth);
alert("First Day :" + fistDayOfMonth); 
alert("Last Day:" + LastDayOfMonth);
```

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2019-05-25T14:26:01.720

试试这个：

```
function _getEndOfMonth(time_stamp) {
    let time = new Date(time_stamp * 1000);
    let month = time.getMonth() + 1;
    let year = time.getFullYear();
    let day = time.getDate();
    switch (month) {
        case 1:
        case 3:
        case 5:
        case 7:
        case 8:
        case 10:
        case 12:
            day = 31;
            break;
        case 4:
        case 6:
        case 9:
        case 11:
            day = 30;
            break;
        case 2:
            if (_leapyear(year))
                day = 29;
            else
                day = 28;
            break
    }
    let m = moment(`${year}-${month}-${day}`, 'YYYY-MM-DD')
    return m.unix() + constants.DAY - 1;
}

function _leapyear(year) {
    return (year % 100 === 0) ? (year % 400 === 0) : (year % 4 === 0);
} 
```

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2020-12-09T10:56:26.713

您可以通过以下代码获取当月的第一个和最后一个日期：

```
var dateNow = new Date();  
var firstDate = new Date(dateNow.getFullYear(), dateNow.getMonth(), 1);  
var lastDate = new Date(dateNow.getFullYear(), dateNow.getMonth() + 1, 0); 
```

或者如果您想以自定义格式格式化日期，那么您可以使用 moment js

```
var dateNow= new Date();  
var firstDate=moment(new Date(dateNow.getFullYear(),dateNow.getMonth(), 1)).format("DD-MM-YYYY");  
var currentDate = moment(new Date()).format("DD-MM-YYYY"); //to  get the current date var lastDate = moment(new
 Date(dateNow.getFullYear(), dateNow.getMonth() + 1, 0)).format("DD-MM-YYYY"); //month last date 
```

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2017-12-28T19:31:32.943

下面的函数给出了该月的最后一天：

```
function getLstDayOfMonFnc(date) {
  return new Date(date.getFullYear(), date.getMonth(), 0).getDate()
}

console.log(getLstDayOfMonFnc(new Date(2016, 2, 15))) // Output : 29
console.log(getLstDayOfMonFnc(new Date(2017, 2, 15))) // Output : 28
console.log(getLstDayOfMonFnc(new Date(2017, 11, 15))) // Output : 30
console.log(getLstDayOfMonFnc(new Date(2017, 12, 15))) // Output : 31
```

同样，我们可以得到该月的第一天：

```
function getFstDayOfMonFnc(date) {
  return new Date(date.getFullYear(), date.getMonth(), 1).getDate()
}

console.log(getFstDayOfMonFnc(new Date(2016, 2, 15))) // Output : 1
```

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2019-09-17T21:37:57.827

这是一个保存 GMT 和初始日期时间的答案

```
var date = new Date();

var first_date = new Date(date); //Make a copy of the date we want the first and last days from
first_date.setUTCDate(1); //Set the day as the first of the month

var last_date = new Date(first_date); //Make a copy of the calculated first day
last_date.setUTCMonth(last_date.getUTCMonth() + 1); //Add a month
last_date.setUTCDate(0); //Set the date to 0, this goes to the last day of the previous month

console.log(first_date.toJSON().substring(0, 10), last_date.toJSON().substring(0, 10)); //Log the dates with the format yyyy-mm-dd
```

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2019-11-04T09:06:38.033

```
const today = new Date();

let beginDate = new Date();

let endDate = new Date();

// fist date of montg

beginDate = new Date(

  `${today.getFullYear()}-${today.getMonth() + 1}-01 00:00:00`

);

// end date of month 

// set next Month first Date

endDate = new Date(

  `${today.getFullYear()}-${today.getMonth() + 2}-01 :23:59:59`

);

// deducting 1 day

endDate.setDate(0); 
```

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2021-09-08T01:42:28.240

## 如何不做

请注意本月最后一个看起来像这样的任何答案：

```
var last = new Date(date)
last.setMonth(last.getMonth() + 1) // This is the wrong way to do it.
last.setDate(0) 
```

这适用于大多数日期，但如果`date`已经是该月的最后一天，并且该月的天数比下个月的天数多，则会失败。

例子：

假设`date`是`07/31/21`。

然后`last.setMonth(last.getMonth() + 1)`增加月份，但将日期设置为`31`。

你得到一个 Date 对象`08/31/21`，

这*实际上是* `09/01/21`。

所以`last.setDate(0)`结果`08/31/21`是我们真正想要的是`07/31/21`.

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2015-01-15T11:59:42.740

```
function getLastDay(y, m) {
   return 30 + (m <= 7 ? ((m % 2) ? 1 : 0) : (!(m % 2) ? 1 : 0)) - (m == 2) - (m == 2 && y % 4 != 0 || !(y % 100 == 0 && y % 400 == 0)); 
} 
```

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2016-11-27T15:51:14.013

设置您需要约会的月份，然后将日期设置为零，因此月份在日期函数中从 1 - 31 开始，然后获取最后一天^^

```
var last = new Date(new Date(new Date().setMonth(7)).setDate(0)).getDate();
console.log(last);
```

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2017-04-20T07:22:00.597

我知道这只是语义问题，但我最终以这种形式使用它。

```
var lastDay = new Date(new Date(2008, 11+1,1) - 1).getDate();
console.log(lastDay); 
```

由于函数是从内部参数向外解析的，因此它的工作原理相同。

然后，您可以用所需的详细信息替换年和月/年，无论它是从当前日期开始的。或特定的月份/年份。

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2020-05-11T16:46:05.937

如果您需要以毫秒为单位的确切月底（例如时间戳）：

```
d = new Date()
console.log(d.toString())
d.setDate(1)
d.setHours(23, 59, 59, 999)
d.setMonth(d.getMonth() + 1)
d.setDate(d.getDate() - 1)
console.log(d.toString())
```

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2020-08-19T06:06:40.580

接受的答案对我不起作用，我做了如下。

```
$( function() {
  $( "#datepicker" ).datepicker();
  $('#getLastDateOfMon').on('click', function(){
    var date = $('#datepicker').val();

    // Format 'mm/dd/yy' eg: 12/31/2018
    var parts = date.split("/");

    var lastDateOfMonth = new Date();
                lastDateOfMonth.setFullYear(parts[2]);
                lastDateOfMonth.setMonth(parts[0]);
                lastDateOfMonth.setDate(0);

     alert(lastDateOfMonth.toLocaleDateString());
  });
});
```

```
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
  <link rel="stylesheet" href="/resources/demos/style.css">
  <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
  <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
</head>
<body>

<p>Date: <input type="text" id="datepicker"></p>
<button id="getLastDateOfMon">Get Last Date of Month </button>

</body>
</html>
```

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2021-03-11T01:18:51.810

这将为您提供当前月份的最后一天。

*注意：在 ios 设备上包括时间*。#gshoanganh

```
var date = new Date();
console.log(new Date(date.getFullYear(), date.getMonth() + 1, 0, 23, 59, 59)); 
```

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2021-03-25T18:06:50.937

如果您只需要为我计算出一个月的最后一个日期。

```
var d = new Date();
const year = d.getFullYear();
const month = d.getMonth();

const lastDay =  new Date(year, month +1, 0).getDate();
console.log(lastDay); 
```

在这里试试[https://www.w3resource.com/javascript-exercises/javascript-date-exercise-9.php](https://www.w3resource.com/javascript-exercises/javascript-date-exercise-9.php)

# sql - MySQL，阅读此 EXPLAIN 语句

> ID：222319
> 
> 赞同：5
> 
> 时间：2008-10-21T15:37:29.850
> 
> 标签：sql, mysql, database, database-design

我有一个查询开始在我的应用程序中引起一些关注。我试图更好地理解这个 EXPLAIN 语句，以了解可能缺少索引的位置：

```
            +----+-------------+--------+--------+------------- --+------------+---------+------------ --------+------+----------------------------------+
            | 编号 | 选择类型 | 表| 类型 | 可能的键 | 关键 | key_len | 参考 | 行 | 额外 |
            +----+-------------+--------+--------+------------- --+------------+---------+------------ --------+------+----------------------------------+
            | 1 | 简单 | 小号 | 参考 | 客户 ID | 客户 ID | 4 | 常量 | 102 | 使用临时的；使用文件排序 |
            | 1 | 简单 | 你| eq_ref | 初级 | 初级 | 4 | www_foo_com.s.user_id | 1 | |
            | 1 | 简单 | 一个 | 参考 | session_id | session_id | 4 | www_foo_com.s.session_id | 1 | 使用索引 |
            | 1 | 简单 | h | 参考 | email_id | email_id | 4 | www_foo_com.a.email_id | 10 | 使用索引 |
            | 1 | 简单 | 酸碱度 | 参考 | session_id | session_id | 4 | www_foo_com.s.session_id | 1 | 使用索引 |
            | 1 | 简单 | 时间 | 参考 | session_id | session_id | 4 | www_foo_com.s.session_id | 1 | |
            | 1 | 简单 | 河粉 | 参考 | session_id | session_id | 4 | www_foo_com.s.session_id | 1 | |
            | 1 | 简单 | c | 全部 | 用户字段 | 空 | 空 | 空 | 1108 | |
            +----+-------------+--------+--------+------------- --+------------+---------+------------ --------+------+----------------------------------+
            8 行一组（0.00 秒）

```

我试图通过阅读这个 EXPLAIN 语句来了解我的索引在哪里丢失。公平地说，一个人可以理解如何优化这个查询，而根本看不到查询，只看 EXPLAIN 的结果吗？

似乎对“c”表的 ALL 扫描是致命弱点。根据 MySQL 文档中推荐的常量值来索引它的最佳方法是什么？|

请注意，我还在 cdr 表中的 userfield 中添加了一个索引，但这也没有起到太大作用。

谢谢。

- - 编辑 - -

这是查询，抱歉——不知道为什么我在第一次通过时忽略了它。

```
SELECT s.`session_id` id,
                  DATE_FORMAT(s.`created`,'%m/%d/%Y') date,
                  u.`name`,
                  COUNT(DISTINCT c.id) calls,
                  COUNT(DISTINCT h.id) emails,
                  SEC_TO_TIME(MAX(DISTINCT c.duration)) duration,
                  (COUNT(DISTINCT em.email_id) + COUNT(DISTINCT pho.phone_id) > 0) status
           FROM `fa_sessions` s
           LEFT JOIN `fa_users` u ON s.`user_id`=u.`user_id`
           LEFT JOIN `fa_email_aliases` a ON a.session_id = s.session_id
           LEFT JOIN `fa_email_headers` h ON h.email_id = a.email_id
           LEFT JOIN `fa_phones` ph ON ph.session_id = s.session_id
           LEFT JOIN `fa_email_aliases` em ON em.session_id = s.session_id AND em.status = 1
           LEFT JOIN `fa_phones` pho ON pho.session_id = s.session_id AND pho.status = 1
           LEFT JOIN `cdr` c ON c.userfield = ph.phone_id
           WHERE s.`partner_id`=1
           GROUP BY s.`session_id` 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-21T15:50:16.437

我假设你已经看过[这里](http://dev.mysql.com/doc/refman/5.1/en/using-explain.html)以获得更多关于它告诉你的信息。显然 ALL 意味着它要经过所有这些。在该页面上讨论了使用临时文件和使用文件排序。你可能想看看那个。

从页面：

> 使用文件排序
> 
> MySQL 必须做一个额外的过程来找出如何按排序顺序检索行。排序是通过根据连接类型遍历所有行并存储排序键和指向与 WHERE 子句匹配的所有行的行的指针来完成的。然后对键进行排序，并按排序顺序检索行。请参见第 7.2.12 节，“ORDER BY 优化”。
> 
> 使用临时
> 
> 为了解析查询，MySQL 需要创建一个临时表来保存结果。如果查询包含以不同方式列出列的 GROUP BY 和 ORDER BY 子句，通常会发生这种情况。

我同意查看查询可能有助于更好地解决问题。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-21T15:57:58.887

### 我的建议？

**将查询分成 2 份，并在中间使用临时表。**

### 推理

问题似乎是表 c 正在被表扫描，并且这是查询中的最后一个表。这可能很糟糕：如果您有一个表扫描，您想在查询开始时执行它，所以它只执行一次。

我不是 MySQL 专家，但我花了很多时间优化其他数据库上的查询。在我看来，优化器还没有解决它应该从 c 开始并向后工作。

让我印象深刻的另一件事是连接中的表可能太多了。大多数优化器都在处理超过 4 个表（因为可能的表顺序的数量呈指数增长，因此检查它们变得不切实际）。
我见过的 90% 的性能问题的根源在于连接中有太多的表。

试一试，让我们知道你的进展情况。如果它没有帮助，请发布 SQL，表定义和索引，我会再看一下。

### 一般提示

随意查看我给出的关于一般性能提示的[答案。](https://stackoverflow.com/questions/18783/sql-what-are-your-favorite-performance-tricks#103176)

### 一个很棒的资源

[解释的 MySQL 文档](http://dev.mysql.com/doc/refman/5.0/en/using-explain.html)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-21T15:44:50.443

仔细查看查询会很有用，但至少有一件事显然值得研究 - 最后一行显示查询的那部分的 ALL 类型，这通常不太好看到。如果建议的可能键（用户字段）作为表 c 的添加索引有意义，则可能值得添加它并查看这是否会减少在搜索中为该表返回的行。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-22T14:28:26.413

### 查询计划

我们可能希望优化器选择的查询计划类似于：

*   从`sessions`where开始`partner_id=1`，可能使用索引`partner_id,`
*   加入`sessions`，`users`使用索引`user_id`
*   join `sessions`to `phones`, where `status=1`, 使用索引 on`session_id`并且可能`status`
*   使用索引`sessions`再次加入和**`phones``session_id``phone_id`
*   加入`phones`使用`cdr`索引`userfield`
*   join `sessions`to `email_aliases`, 在哪里`status=1`使用索引`session_id`并且可能`status`
*   使用索引`sessions`再次加入和**`email_aliases``session_id``email_id`
*   加入`email_aliases`使用`email_headers`索引`email_id`

** 通过在这些索引中放置 2 个字段，我们使优化器能够使用 加入表`session_id`，并立即找出关联的`phone_id`或`email_id`无需读取基础表。这种技术为我们节省了阅读时间，并且可以节省大量时间。

### 我将创建的索引：

上面的查询计划建议了这些指标：

```
fa_sessions ( partner_id, session_id )  
fa_users ( user_id )  
fa_email_aliases ( session_id, email_id )  
fa_email_headers ( email_id )  
fa_email_aliases ( session_id, status )  
fa_phones ( session_id, status, phone_id ) 
cdr ( userfield ) 
```

### 笔记

*   如果不创建所有这些，您几乎肯定会获得可接受的性能。
*   如果任何表都很小（少于 100 行），那么可能不值得创建索引。
*   `fa_email_aliases`可能与 一起使用`( session_id, status, email_id )`，具体取决于优化器的工作方式。

# sql - LINQ to SQL 中的嵌套事务

> ID：222325
> 
> 赞同：3
> 
> 时间：2008-10-21T15:39:39.563
> 
> 标签：sql, linq, transactions, nested

我需要帮助来实现相当复杂的业务逻辑，它在许多表上运行并执行相当多的 SQL 命令。但是我想确保数据不会处于不一致的状态，到目前为止，我还没有看到不需要嵌套事务的解决方案。我写了一个简单的伪代码，它说明了一个类似于我想要完成的场景：

```
Dictionary<int, bool> opSucceeded = new Dictionary<int, bool> ();

for (int i = 0; i < 10; i++)
{
    try
    {   
        // this operation must be atomic
        Operation(dbContext, i);

        // commit (?)

        opSucceeded[i] = true;
    }
    catch
    {
        // ignore
    }
}

try
{
    // this operation must know which Operation(i) has succeeded;
    // it also must be atomic
    FinalOperation(dbContext, opSucceeded);

    // commit all
}
catch
{
    // rollback FinalOperation and operation(i) where opSucceeded[i] == true
} 
```

对我来说最大的问题是：如何确保如果 FinalOperation 失败，所有成功的操作 Operation(i) 都回滚？请注意，我也希望能够忽略单个操作（i）的失败。

是否可以通过使用嵌套的 TransactionScope 对象来实现这一点，如果没有 - 你将如何解决这样的问题？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-21T23:00:59.970

如果我在关注您的问题，您希望对数据库进行一系列操作，并捕获足够的信息来确定每个操作是成功还是失败（简化代码中的字典）。

从那里，您有一个最终操作，如果它本身失败，则必须回滚之前的所有成功操作。

看起来这正是简单交易所针对的案例类型。只要最终操作的失败将整个事务回滚（此处假设 FinalOperation 出于其他原因未使用该信息），就无需跟踪子/早期操作的成功或失败。

只需在进入所描述的块之前启动事务，并在知道 FinalOperation 的状态后提交或回滚整个事务。从您当前的描述中可以看出，没有必要嵌套子操作。

也许我错过了什么？（注意，如果您想保留较早的/子操作，那将是完全不同的事情......但是最终操作的失败将整个操作包回滚会使简单的事务可用）。

# windows - 如何诊断 Windows 上的网络问题？

> ID：222326
> 
> 赞同：2
> 
> 时间：2008-10-21T15:39:40.483
> 
> 标签：windows, networking

我经常遇到无法将某些东西连接到其他东西的问题。我通常忘记检查一些明显的东西。你能帮忙吗：

*   诊断连接问题的提示/技术
*   可以提供帮助的工具或应用程序的名称（以及它有用的情况）

*我知道这个问题有点不具体，但希望答案可以为任何试图让计算机/程序相互交谈的人提供一个有用的起点。*

*请您对每个答案给出一个答案，以便选出最好的答案。*

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-21T16:07:49.273

调试网络问题时运行的简单检查：

1.  是否每台机器都有一个 IP 地址，转到命令提示符并运行 ipconfig。此处要检查的关键事项是接口并确保适当的接口具有 IP 地址。
2.  如果您在内部或虚拟网络上运行，请检查两台计算机的 IP 地址是否在同一范围和子网中。
3.  尝试从另一台 ping 每一台机器，看看它们是否可以相互通信。请注意，某些防火墙会阻止 ping 请求。
4.  如果 Ping 失败，则检查防火墙是否处于活动状态。如果通信在“安全”内部网络中，请尝试禁用防火墙并重新 ping。
5.  如果连接通过无线网络，则检查信号强度。
6.  如果 ping 失败并且您正在通过多个网络进行连接，请尝试运行 tracert 以查看可能会向您显示网络上连接失败的位置。
7.  如果您能够 ping 通但无法连接，请检查防火墙设置和网络连接设置。Windows 2000+ 能够在连接属性上设置端口和 IP 访问。
8.  尝试绘制连接的网络图以帮助可视化问题。
9.  如果您通过路由器、防火墙和负载平衡器进行连接，请检查所有设备是否未绑定到任何特定 IP 地址，以及 IP 地址重定向（如果有）是否正确。还要检查任何 NAT 日志以查看是否正在接收连接并正确重定向。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-21T15:44:38.710

线鲨

ProcMon 的最新版本

网络统计

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-21T16:02:11.703

**Wireshark** www.wireshark.org

Wireshark 是适用于 Unix 和 Windows 的网络协议分析器。

特征：

*   深入检查数百种协议，并不断添加更多协议
*   实时捕获和离线分析
*   标准三窗格数据包浏览器
*   多平台：在 Windows、Linux、OS X、Solaris、FreeBSD、NetBSD 和许多其他平台上运行
*   可以通过 GUI 或通过 TTY 模式 TShark 实用程序浏览捕获的网络数据
*   业内最强大的显示过滤器
*   丰富的 VoIP 分析
*   读/写许多不同的捕获文件格式：tcpdump (libpcap)、Catapult DCT2000、Cisco Secure IDS iplog、Microsoft Network Monitor、Network General Sniffer®（压缩和未压缩）、Sniffer® Pro 和 NetXray®、Network Instruments Observer、Novell LANalyzer 、RADCOM WAN/LAN Analyzer、Shomiti/Finisar Surveyor、Tektronix K12xx、Visual Networks Visual UpTime、WildPackets EtherPeek/TokenPeek/AiroPeek 等
*   捕获使用 gzip 压缩的文件可以即时解压缩
*   实时数据可以从以太网、IEEE 802.11、PPP/HDLC、ATM、蓝牙、USB、令牌环、帧中继、FDDI 等读取（取决于您的平台）
*   对许多协议的解密支持，包括 IPsec、ISAKMP、Kerberos、SNMPv3、SSL/TLS、WEP 和 WPA/WPA2
*   可以将着色规则应用于数据包列表，以进行快速、直观的分析
*   输出可以导出为 XML、PostScript®、CSV 或纯文本。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-21T16:02:15.523

自下而上运行 OSI 模型

1.  物理（您有网络适配器/连接）

2.  链路层（arp，网络团队阻止的以太网端口（我见过这种情况，锁定环境看到两个 MAC 地址来自一个工作站端口并关闭该端口）

3.  网络层（ipconfig、tracert、ping）
    *   你有网络地址吗（DHCP，固定）
    *   您是否在正确的子网中/子网之间有路由
    *   中间有什么东西挡住了你
    *   防火墙、路由表

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2012-06-20T12:37:39.060

On windows i user PortQueryUI : [http://www.microsoft.com/en-us/download/details.aspx?id=24009](http://www.microsoft.com/en-us/download/details.aspx?id=24009)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-21T15:44:31.333

如有疑问，请检查 Windows 防火墙是否干扰了您的通信。10 次中有 8 次是错误的。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-21T15:45:40.457

使用 tracert 是一个很好的开始，可以查看您在链上的距离。

对于虚拟机，最好确保在主机操作系统中正确设置了环回适配器。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-21T15:46:37.537

*   最常用的工具是 ping。它可用于测试您的连接和目标的可用性
*   如果您想查看数据包丢失的位置，第二个工具是跟踪器。
*   对于更高级的调试，我使用以下工具：nmap、wireshark 等。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-10-21T15:47:22.497

Windows 有一个 netstat 实用程序，它与 Unix netstat 非常相似，可以做许多不同的事情来帮助您解决网络问题。

随机示例：

netstat -r 显示路由信息

网络统计/？使用信息

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-10-21T15:52:47.463

既然您说您使用的是 2 台虚拟机，我会冒险猜测两台机器都是在 NAT 配置（而不是唯一的网络设备）中设置的——在 NAT 配置中，两台机器（通常）都无法 ping其他。

如果您熟悉命令行，可以尝试“netstat”命令。

您也可以尝试“arp -a”来列出您的 PC 已知的所有 IP/MAC 地址。

“tracert [ip address]”命令将显示您的数据包在到达目的地的途中经过了多少网关/路由器。（不过，如果两台机器都在同一个网络上，这可能没有帮助。）

并且不要忘记检查您的 Windows 防火墙设置。

否则，如果你想搞砸，你可以试试被称为 Wireshark 的数据包嗅探器：http: [//www.wireshark.org/](http://www.wireshark.org/) （又名 Ethereal）

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-10-21T15:56:03.947

**拔出网线**

如果您可以与设备进行一些通信（例如 ping），但无法让您的程序与计算机上的服务通信。然后，尝试拔出网线，看看 ping 是否停止。这将验证您正在与您真正认为的计算机进行通信。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2012-08-23T05:56:44.457

DNS 活动：便携式 DNS 缓存和防火墙；一般网络活动：Wireshark、网络监视器；Windows 实用程序：ping、netstat、nslookup。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-10-21T15:42:54.660

您需要使用消除过程，例如，如果您可以 ping ip 地址但不能 ping 主机名，则存在 DNS 问题。如果您可以 ping 系统但无法连接到共享等。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-10-21T16:30:37.200

**DNS 不同步**

如果您使用的是虚拟机并对其执行回滚，则它可能与 DNS（域名服务器）不同步。尝试删除该机器并将其重新添加到域中，或者如果您可以访问 DNS 机器，则让它刷新其缓存。

# visual-studio - 在 Visual Studio 中调试时迭代可枚举对象

> ID：222328
> 
> 赞同：7
> 
> 时间：2008-10-21T15:40:51.387
> 
> 标签：visual-studio, debugging

在 Visual Studio 中调试时是否可以迭代集合并仅列出过滤的对象信息？我会为此使用即时窗口，但尽管它允许对对象执行方法，但似乎不允许执行自定义循环语句。

ASP.NET 中最简单的示例：

```
this.Page.Validate();
if (!this.Page.IsValid())
{
  // breakpoint here
} 
```

我们如何迭代`Page.Validators`集合并找到那些无效的+在该断点处输出它们的信息？（这不是主要问题，只是一个示例）

如果不可能直接做到这一点，你有什么解决方法吗？不涉及代码修改的解决方法，只需在即时窗口或一些 Watch 表达式中编写代码。

在谷歌搜索时，我发现[这里](http://visualstudiohacks.com/articles/ask-the-pros/ask-the-pros-debugging/)只引用了一种解决方法（虽然找不到原件）：

> “向您的代码添加一个调试方法，该方法执行诸如遍历集合中的所有对象之类的操作。然后您可以在调试模式下从即时窗口调用该方法，它会为您枚举各种事物。把它想象成一个命令-line-debugger-helper。你可以写多少你喜欢的。”

但这仍然是一种解决方法。我认为它应该是可行的，不需要太多的黑客攻击，更重要的是不需要修改代码。当然，应该可以在一个语句中进行某种集合转换。

让我们坚持使用非泛型集合。此外，即时窗口似乎不接受 lambda 表达式（尝试时出错：“表达式不能包含 lambda 表达式”）

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-21T15:48:15.803

您可以尝试使用即时窗口和 LINQ-to-objects 调用。

人为的例子：

```
 pages.Where((x) =>
 {
    if (x.IsValid)
    {
        Debugger.Break();
        return true;
    }
    return false;
 }); 
```

更新：显然，这不起作用，因为即时窗口不允许 lambdas。但是，如果您将 lambda 实现为仅用于调试的方法，则可以执行此操作。

```
[Conditional("DEBUG")]
static bool BreakpointPredicate(YourItemType x)
{
    if (x.IsValid)
    {
        Debugger.Break()
        return true;
    }
    return false;
} 
```

然后只需`Where`在即时窗口中调用：

```
pages.Where(BreakPointPredicate); 
```

# database - 可以将表的序列设置为非常大的值，例如 1000 万吗？

> ID：222339
> 
> 赞同：1
> 
> 时间：2008-10-21T15:45:11.410
> 
> 标签：database, performance, oracle

是否有任何性能影响或任何类型的问题？我这样做的原因是我们正在使用相似表的两组数据库之间进行一些同步，并且我们希望在同步数据时避免重复的 PK 错误。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-21T15:47:35.243

是的，没关系。

注意：如果您有性能问题，可以使用“CREATE SEQUENCE”上的“CACHE”选项：

*"指定数据库预分配和保存在内存中的序列的多少值以便更快地访问。这个整数值可以有 28 位或更少的数字。这个参数的最小值是 2。对于循环的序列，这个值必须小于“*

```
(CEIL (MAXVALUE - MINVALUE)) / ABS (INCREMENT) 
```

*“如果发生系统故障，所有未在提交的 DML 语句中使用的缓存序列值都将丢失。丢失值的潜在数量等于 CACHE 参数的值。”*

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-21T15:53:33.670

当然。您计划做的实际上是一种相当普遍的做法。只需确保用于保存 ID 的客户端代码中的变量足够大（即，使用长整数而不是整数）

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-21T16:04:00.637

我们最近在创建具有非常大种子的表时遇到的唯一问题是当我们尝试与我们无法控制的系统交互时。该系统显然将我们的 ID 读取为 char(6) 字段，因此当我们发送第 10000000 行时，它将无法写入。

在性能方面，我们没有发现使用大 ID 号有任何问题。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-21T16:09:27.007

我们没有看到任何性能影响。我经常大量增加序列。如果您需要将数据“回填”到表中，这些空白会派上用场。

我们唯一遇到的问题是当一个非常大的序列在特定客户端程序上超过 MAXINT 时。序列很好，但是在客户端应用程序中转换为整数开始失败！在我们的例子中，很容易重构表中的 ID 列并让事情再次运行，但回想起来，如果表的排列方式不同，这可能是一个混乱的情况！

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-06T13:34:07.520

如果您正在同步两个表，为什么不更改 PK 种子/增量量，以便在添加新 PK 时一切都自行处理？

假设您必须同步来自 10 个不同数据库中的 10 个患者表的数据。
我们还假设最终所有数据库都必须同步到总部的患者表中。

将每行的 PK 增加 10，但确保每个数据库的最后一位数字不同。

DB0 10,20,30..
DB1 11,21,31..
.....
DB9 19,29,39..

当所有内容合并时，保证没有冲突。

这很容易扩展到 n 个数据库表。只要确保您的 PK 密钥类型不会溢出。我认为 BigInt 对你来说可能足够大......

# perforce - 如何快速轻松地删除附加到更改列表的所有 Perforce 作业？

> ID：222348
> 
> 赞同：0
> 
> 时间：2008-10-21T15:47:13.870
> 
> 标签：perforce

我有一个大约 600 个作业的列表，我无法从命令行中删除它们，因为它们附加到更改列表中。我知道如何分离它们的唯一方法是通过 GUI，但这需要很长时间。有谁知道更好（即更快）的方法？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-21T17:02:10.740

我使用“修复”和“修复”命令解决了这个问题。这是程序：

将“修复”命令的输出转储到文件中

```
p4 fixes > tmp.txt 
```

该文件将包含一堆这样的行：

```
job005519 fixed by change 3177 on 2007/11/06 by raven@raven1 (closed)
job005552 fixed by change 3320 on 2007/12/11 by raven@raven1 (closed)
job005552 fixed by change 3318 on 2007/12/10 by raven@raven1 (closed)
... 
```

使用您可信赖的文本编辑器（这里我不是在谈论记事本）创建一个宏，将行转换为 Perforce 命令以从变更列表中分离作业，（p4 fix -d）：

```
p4 fix -d -c 3177 job005519
p4 fix -d -c 3320 job005552
p4 fix -d -c 3318 job005552
... 
```

将文件另存为 .bat 或 .cmd 文件并运行它，然后 bada bing，bada boom...您的所有作业都从更改列表中分离出来，您可以使用 GUI 或使用类似于我刚才的过程删除它们概述和“作业”命令的输出：

```
p4 jobs > tmp.txt 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-02T02:17:24.270

Perforce 的 -x 参数非常方便；它“指示 p4 从命名文件 [或] 标准输入中读取参数，每行一个”。另外，我相信“job -d”允许删除作业，即使它们与更改相关联。因此，要删除与更改列表关联的所有作业，请执行以下操作（未经测试）：

```
p4 fixes -c <changenum> | p4 -x - job -d 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-10-18T12:56:40.130

您可以使用以下 DOS 脚本来解析 p4 修复的输出，然后删除修复和作业：

设置 users_filename=%1

for /F "tokens=1,5 delims=" %%i in (%users_filename%) do (

p4 修复 -d -c %%j %%i

p4 作业 -d %%i

)

# java - 从中间层 Java 类生成 ActionScript 值对象

> ID：222359
> 
> 赞同：2
> 
> 时间：2008-10-21T15:49:33.023
> 
> 标签：java, apache-flex, remoting

在使用远程处理（通过 BlazeDS）的 Flex / Java 应用程序堆栈中，需要在客户端（在 ActionScript 中）和服务器（在 Java 中）中维护用于保存在客户端和服务器之间来回传递的数据的类。

我想要一种仅在 Java 中维护这些类的方法，并让构建过程生成相应的 ActionScript 值对象类。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-29T07:08:46.680

查看 Granite Data Services 项目中的 AS3 生成器：

[http://www.graniteds.org](http://www.graniteds.org)

如果我没记错的话，它是一个 Eclipse 插件，应该很容易使用。请记住，如果您从 ActionScript 类中排除一个属性，当它被发送回 Flex 客户端时，它仍然会被 Blaze 序列化。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-24T21:08:56.403

如果您要开发任何复杂程度的 Flex RIA 应用程序，那么您可能会实现 MVC 模式 - ala Cairngorm、Mate 或 PureMVC。

看看这个 Flex 代码生成器，因为它预计您在 Flex 客户端中使用 MVC 并适当地生成代码以提供更高程度的杠杆作用：

[FCG：弹性代码生成器](http://www.dehats.com/drupal/?q=node/7)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-21T15:51:55.593

[XDoclet2](http://xdoclet.codehaus.org/)包含一个ActionScript 插件，它可以从Java 代码中的Javadoc 注释生成ActionScript 类。

缺点是它基于 Javadoc 而不是 Java 注释，并且似乎没有很好的文档记录或被广泛使用。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-21T16:20:42.133

有几个免费的 Java 到 AS3 转换器，质量参差不齐：

*   [http://osflash.org/projects/j2as3](http://osflash.org/projects/j2as3)
*   [http://osflash.org/j2as](http://osflash.org/j2as)（这个是 AS2，但可能适合您的目的）

我不能保证他们的质量，但他们声称做你正在寻找的东西。

就我个人而言，我承担了手动维护两个代码库的开销，因为一旦对象稳定下来，就没什么可做的了，这意味着我对对象中的其余代码没有复杂的规则。

另外，我的 Java 对象都有 getter 和 setter，而 AS3 的等价物没有，这意味着公共/私有访问器在任何情况下都是不同的。

高温高压

# sql - 使用 SQL Server 2005 完成 SQL 代码的好工具是什么？

> ID：222364
> 
> 赞同：1
> 
> 时间：2008-10-21T15:50:36.063
> 
> 标签：sql, sql-server

我试过 Red Gate 的 SQL Prompt 并喜欢它，但目前买不起。我想念这个工具提供的良好的代码完成。有没有很好的免费工具可以完成 SQL 代码（表和列名等）？

我已经尝试过 TOAD，但它非常有问题。它会崩溃，并且在应用程序关闭后还会使与数据库的连接保持打开状态。

我也知道 SQL Server 2008 具有某种形式的代码完成，但它要求您连接的数据库是 2008，而不仅仅是 Management Studio 版本。我的雇主最终会升级，但我相信这可能需要一段时间，所以我想要一个很好的工具。

有什么好的推荐吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-21T15:51:25.373

Red Gate 的[SQL 提示符](http://www.red-gate.com/products/SQL_Prompt/index.htm)正是您想要的。**它不是**免费的，但值得。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-21T15:52:40.303

我自己尝试了一些不同的工具，但没有什么能与 SQL Prompt 相比。

如果您喜欢该工具，我个人建议联系 Red Gate，众所周知，他们会在特定时间提供“特价”，您可能会获得折扣，尤其是每月的这个时候。

否则，请联系我，无论如何我都会为您提供 5% 的折扣

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-22T16:03:04.260

当 RedGate 购买 SQL Prompt 时，他们当时免费推出了当前版本。这就是我仍在使用的。它不像新的那样坚固，但远程服务器没有问题——这是我一天中大部分时间都在使用的。看看你能不能拿到一份副本。（版本 2.0.0.59）

# .net - 适用于 VB6 程序员的 Option Strict On 和 .NET

> ID：222370
> 
> 赞同：23
> 
> 时间：2008-10-21T15:51:44.127
> 
> 标签：.net, vb.net, late-binding

我正在准备一个关于 Visual Basic 2005 的课程，目标是迁移到 .NET 平台的 Visual Basic 6 程序员。

我想就是否建议他们始终启用**Option Strict**提出一些建议。

我专门使用 C 风格的编程语言，主要是 Java 和 C#，所以对我来说，**显式转换**是我一直希望我必须做的事情，因为它从来都不是一种选择。
但是，我认识到使用内置支持**后期绑定**的语言的价值，因为不必过于明确地说明代码中的类型确实可以节省时间。**动态类型语言**的流行传播进一步证明了这一点**，甚至在具有动态语言运行时的 .NET 平台上。

考虑到这一点，是否应该鼓励第一次使用 VB.NET 并具有 VB6 背景的人进入**必须使用编译时类型检查**的心态，因为这是“最佳实践” CLR？或者继续享受后期绑定的好处是否“可以”？**

 *** * *

## 回答 #1

> 赞同：26
> 
> 时间：2008-10-21T16:16:56.197

是的！Option Strict 绝对是 .Net 的最佳实践。强调 .Net 的核心是一个强类型平台，直到 DLR 得到更完全的支持。除了少数例外，每个`Dim`and`Function`都应该有一个明确的类型声明与之配套。像 LINQ 或 Boo 和 JScript 这样的东西是证明规则的例外。

这里还有一些需要指出的事情。我相信你很清楚这一切，但我不得不使用和维护大量由前 VB6ers 编写的 VB.Net 代码，所以这对我来说是一个痛处：

*   不要使用旧的字符串函数：`LEN()`, `REPLACE()`, `TRIM()`, 等等
*   不再推荐匈牙利疣。 `oMyObject`并且`sMyString`不是犹太洁食。如果他们不相信您，请向他们展示[Microsoft 设计指南](http://msdn.microsoft.com/en-us/library/ms229042.aspx)中的参考资料。
*   确保他们了解新的`AndAlso`/`OrElse`逻辑运算符
*   参数化查询和现代 ADO.Net。怎么强调都不过分。他们永远不需要再打电话`CreateObject()`了。
*   Scope 在 .Net 中的工作方式与在 VB6 中的工作方式不同（并且更重要）。VB.Net 仍然有模块，但它们现在更类似于静态类。了解在真正的面向对象环境中开发与 VB6 提供的部分 OOP 支持有何不同非常重要。不再有充分的理由允许方法运行到不敬虔的程度。
*   确保他们了解泛型和接口（包括`IEnumeralbe(Of T)`），并了解为什么他们永远不应该`ArrayList`再次使用 an。

我可以继续说下去，但我只会指出[VB.Net 的隐藏功能](https://stackoverflow.com/questions/102084/hidden-features-of-vbnet)问题来结束这个咆哮。

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2008-10-21T15:54:41.420

使用 Option Strict 启用开发所花费的时间将为您节省大量的调试时间。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-10-21T16:11:29.047

`Option Strict`显然不能取代好的单元测试——但反过来也不能。虽然单元测试*可以*检测到与 相同的错误`Option Strict`，但这意味着单元测试中没有错误，单元测试经常和早期完成，等等......。

编写好的单元测试并不总是微不足道的，而且需要时间。然而，编译器已经实现了一些测试——以类型检查的形式。至少，这样可以节省时间。更有可能的是，这节省*了大量*时间和金钱（至少偶尔），因为您的测试是错误的/没有涵盖所有情况/忘记考虑代码的更改。

总而言之，不能保证您的单元测试是正确的。另一方面，有一个强有力的保证，即编译器执行的类型检查是正确的，或者至少它的故障（未经检查的数组协方差、循环引用的错误……）是众所周知的并且有据可查。

另一个总结：**是的，`Option Strict On`绝对是最佳实践。**事实上，我已经在这样的在线社区工作了多年。每当有人在显然没有`Option Strict`启用的代码上需要帮助时，我们都会礼貌地指出这一点，并拒绝提供任何进一步的帮助，直到这个问题得到解决。它节省了很多时间。通常，在此之后问题就消失了。这有点类似于在 HTML 支持论坛中寻求帮助时使用正确的 HTML：无效的 HTML 可能会起作用，但话又说回来，它可能不起作用并且是问题的原因。因此，许多专业人士拒绝提供帮助。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-10-21T15:56:04.477

是的！！！！

在我看来，无论是作为开发人员，还是作为大学讲师，都是的。

最好从一开始就养成良好的习惯，这会使整个过程变得更加容易，而 Option Strict 是我认为需要的元素之一。

*添加*

从字面上可以列出很多原因，但关键是这是一种最佳实践，在教授一门新语言时，从一开始就教授这些最佳实践是关键。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-10-21T17:14:41.527

请记住，这里有两个级别。

选项显式选项严格

两者的主要区别在于 Option Strict 禁用了 VB 对不同数据类型的自动转换。您必须显式使用 CType 或其他数据转换函数将变量分配给其他类型。

我从 1.0 开始就一直在使用 VB，虽然我可以看到这一点，但我认为 Strict 在处理已经实现或继承了不同接口和类的对象时特别热心。

我会先从 Strict 开始，如果它开始妨碍你，然后下拉到 Explicit。但是永远不要同时关闭，那样会导致疯狂和过多的调试时间。

多年来使用 VB，我几乎将 Double 用于所有浮点变量。这样，您就可以避免许多与舍入和精度损失有关的问题。在 VB6 中，我使用 long 作为 32 位整数，但 Integer 在 .NET 中的工作与 Int32 一样好。我还建议使用 Int32、Int16 等而不是 Integer、Long 等，以防微软决定重新定义这些关键字。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-06-09T10:43:31.487

我不同意[RS Conley](https://stackoverflow.com/questions/222370/option-strict-on-and-net-for-vb6-programmers/222693#222693)（非常不寻常）。我最喜欢的 VB6 大师——Francesco Balena、Dan Appleman——都不喜欢 VB6 的自动转换，而[支持](https://rads.stackoverflow.com/amzn/click/com/B00008I9N4) [.NET](http://www.amazon.co.uk/Practical-Guidelines-Practices-Developers-Pro-Developer/dp/0735621721)`Option Strict`。许多有经验的 VB6 程序员都知道自动转换是“邪恶的类型强制”（[pdf](http://vb.mvps.org/articles/pt199511.pdf)），并且会很高兴打开`Option Strict`.

有时最好使用一个不带 的小模块`Option Strict`，以避免大量复杂的反射代码。但这是证明规则的例外。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2010-04-12T14:11:56.407

鉴于 Boehm 的理念，即在开发周期的早期解决问题消耗的资源最少，我喜欢每一种帮助开发人员尽早“解决问题”的工具。出于这个原因，我提倡诸如 IntelliSense 之类的东西，它既可以提高效率，又可以帮助您在周期的早期实现工作代码。（工作，但*不一定*正确。）

出于这个原因，我也支持使用 Option Strict 作为一种帮助在“设计时间”中防止失误和随之而来的更正的方法。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-21T15:57:05.863

如果您习惯于检查您的类型，那么您可能需要 option strict on。关闭它可能有好处，但如果你的大脑没有调整到发现编译器通常会抱怨的错误，那么我会说让它保持打开状态。我在 VB.Net 中工作过很多次，我不得不说，即使我大部分时间都使用严格关闭的选项，但我已经看到很多情况下，打开它会阻止很多错误。

# python - ElementTree XPath - 根据属性选择元素

> ID：222375
> 
> 赞同：46
> 
> 时间：2008-10-21T15:52:51.643
> 
> 标签：python, elementtree

[我在使用 ElementTree 中的属性 XPath Selector 时遇到问题，根据文档](http://effbot.org/zone/element-xpath.htm)我应该能够做到这一点

这是一些示例代码

**XML**

```
<root>
 <target name="1">
    <a></a>
    <b></b>
 </target>
 <target name="2">
    <a></a>
    <b></b>
 </target>
</root> 
```

**Python**

```
def parse(document):
    root = et.parse(document)
    for target in root.findall("//target[@name='a']"):
        print target._children 
```

我收到以下异常：

```
expected path separator ([) 
```

* * *

## 回答 #1

> 赞同：36
> 
> 时间：2008-10-21T16:16:06.230

您尝试使用的语法是**[ElementTree 1.3](http://effbot.org/zone/element-xpath.htm)**中的新语法。

此类版本随**Python 2.7**或更高版本一起提供。如果你有 Python 2.6 或更低版本，你仍然有 ElementTree 1.2.6 或更低版本。

* * *

## 回答 #2

> 赞同：29
> 
> 时间：2013-04-19T13:00:16.117

这段代码有几个问题。

1.  Python 的内置 ElementTree（简称 ET）没有真正的 XPATH 支持；只有一个有限的子集例如，它不支持*从根中查找*表达式，例如`//target`.

    注意：[文档](http://docs.python.org/2/library/xml.etree.elementtree.html#supported-xpath-syntax) 中提到了“ **//** ”，但仅适用于孩子：所以表达式 as `.//target`是有效的；`//...`不是！

    还有一个替代实现：[**lxml**](http://lxml.de)，它更丰富。对于内置代码，使用文档是接缝。那不匹配/工作。

2.  `@name`符号选择xml-**属性**；xml 标记中的`key=value`表达式。

    因此，名称值必须为 1 或 2 才能在给定文档中选择某些内容。或者，可以搜索带有子**元素** *“a”的*目标：（`target[a]`没有@）。

对于给定的文档，使用内置 ElementTree (v1.3) 解析为 root，以下代码是正确且有效的：

*   `root.findall(".//target")` 找到两个目标
*   `root.findall(".//target/a")` 找到两个a元素
*   `root.findall(".//target[a]")`这会再次找到两个目标元素，因为它们都有一个 a 元素
*   `root.findall(".//target[@name='1']")`只找到第*一个*目标。请注意需要 1 左右的引号；否则会引发 SyntaxError
*   `root.findall(".//target[a][@name='1']")`也有效；找到那个目标
*   `root.findall(".//target[@name='1']/a")`只找到一个 a 元素；...

# model-view-controller - 使用 MVC，与自主外围设备的交互属于模型还是控制器？

> ID：222376
> 
> 赞同：2
> 
> 时间：2008-10-21T15:53:14.840
> 
> 标签：model-view-controller, language-agnostic, model, controller, peripherals

使用带有观察者模式的 MVC，如果用户操作需要轮询设备（例如相机）以获取数据，应该在 Controller 中完成轮询并将结果从 Model 传递出去，还是应该向 Model 和模型本身执行轮询。

这个问题是我试图调和我正在阅读的所有内容，这些内容吹捧“瘦控制器”格言与我的直觉，即模型应该只对不获取数据的数据起作用。

（注意：这个问题*可能*是主观的。我不完全确定这个问题有一个唯一的答案。如果没有，请随时重新标记，因为我很想听听关于这个主题的意见。）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-21T15:55:35.820

控制器应执行轮询。模型是我心中状态的快照，所以相机状态应该从控制器传递到模型。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-21T15:56:46.440

它属于控制器。模型包含信息和业务规则，控制器本质上是所有非用户、信息或业务规则的接口，视图处理用户交互。

有人可能会争辩说，视图也可以控制这一点——相机型号和驱动程序可能由用户决定，因此属于该区域。

但我不希望该模型具有外围接口。

-亚当

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-21T16:00:38.977

您可以在控制器下方和模型上方添加一个瘦服务层，这使您可以将所有对外围代码的访问权放在一个地方

# documentation - JavaDoc 之类的 shell 脚本框架？

> ID：222383
> 
> 赞同：3
> 
> 时间：2008-10-21T15:55:00.187
> 
> 标签：documentation, shell

是否有可以记录类似于 JavaDoc 生成的 shell 脚本的开源或公共领域框架？我不需要将其仅限于特定风格的 shell 脚本，理想情况下，我想要一个用于在网页上记录 API 或命令行类型命令的通用框架，该框架易于扩展，甚至更好的是自我记录。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-21T16:20:58.920

如果你有 Perl，[这里](http://bahut.alma.ch/2007_08_01_archive.html)有一个使用 Perl 的 POD 系统来记录 shell 脚本的例子。

> 诀窍是将 Perl POD 部分放在 bash “Here-Document”中，紧跟在 null 命令 (no-op) 之后`:`。
> 
> *   从...开始`: <<=cut`
> *   编写 POD 格式的手册页
> *   而已。你的 POD 以 结尾`=cut`，它也被定义为 shell Here-doc 的结尾
> 
> 然后可以使用所有常用的 Perl 工具（如 perldoc 或 perl2html）处理您的脚本，您甚至可以使用 pod2man 生成真正的手册页。
> 
> 例如，这里是`podtest.sh`脚本：
> 
> ```
> #!/bin/dash
> 
> echo This is a plain shell script
> echo Followed by POD documentation
> 
> : <<=cut
> =pod
> =head1 NAME
> 
>    podtest.sh - Example shell script with embedded POD documentation 
> ```
> 
> ...
> 
> ```
> No rights Reserved
> 
> =cut 
> ```
> 
> 将此 podtest.sh 添加到您的手册页：
> 
> ```
>  pod2man podtest.sh >/usr/local/share/man/man1/podtest.sh.1 
> ```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-10-10T14:38:27.803

虽然 Doxygen 不支持 bash 脚本文件，但你**可以** [让 Doxygen 与 bash 一起工作](http://rickfoosusa.blogspot.nl/2011/08/howto-have-doxygen-support-bash-script.html)

如果您不介意文档与代码分开，您绝对应该查看[ronn](http://rtomayko.github.com/ronn/)。

您可能还会发现[Shocco](http://rtomayko.github.com/shocco/)很有用，尽管它与 JavaDoc 不同（代码是文档的组成部分）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-21T16:02:29.953

您可能会考虑[Doxygen](http://www.doxygen.org/)。虽然它主要用于记录像 JavaDoc 这样的 C-ish 语言，但您可能会想出一个适用于 shell 脚本的设置，但需要一些争论。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-10-19T02:24:09.760

文档化的 shell 脚本的标准方法是使用 troff 并在类似于 C 的脚本注释中使用。虽然我建议使用 Steve 帖子中的“Here-Document”方法，如果你真的需要更可扩展的东西来嵌入你的 troff/ pod/rdoc/jdoc 代码。

# xhtml - XHTML 的制表符实体？

> ID：222385
> 
> 赞同：8
> 
> 时间：2008-10-21T15:55:19.860
> 
> 标签：xhtml, character-entities

有谁知道 xhtml 中选项卡的字符实体是什么？（嗯，如果有的话）...

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-21T15:57:39.573

试试`&#9;`。TAB 是 ASCII 字符 #9。

但无论如何，它可能不会像您期望的那样显示，因为 HTML 在大多数情况下会忽略空格。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-21T15:58:13.973

(X)HTML 对制表符没有特别的支持：它们只是另一个空白字符，无论您是否对它们进行转义。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2008-10-21T16:00:14.827

大多数人模拟标签的方法是使用 DD 和 DT 标签。它们旨在创建词汇表：

```
term
    definition goes here

term
    definition goes here 
```

# unicode - 关于 Unicode，我需要了解什么？

> ID：222386
> 
> 赞同：55
> 
> 时间：2008-10-21T15:55:20.780
> 
> 标签：unicode, internationalization

作为应用程序开发人员，我需要了解 Unicode 吗？

* * *

## 回答 #1

> 赞同：45
> 
> 时间：2008-10-21T16:03:03.573

Unicode 是一种标准，它为书面交流中使用的字形定义数字代码。或者，正如他们自己所说：

> 用于书写世界上所有语言的字符的数字表示标准。Unicode 提供了一种统一的方式来存储、搜索和交换任何语言的文本。它被所有现代计算机使用，并且是在 Internet 上处理文本的基础。Unicode 由 Unicode 联盟开发和维护。

开发人员犯了许多常见但很容易避免的编程错误，他们不费心自学 Unicode 及其编码。

*   首先，去[源头](http://www.unicode.org/)获取权威、详细的信息和实施指南。
*   正如其他人所提到的，Joel Spolsky[列出](http://www.joelonsoftware.com/articles/Unicode.html)了这些错误。
*   我也喜欢 Elliotte Rusty Harold 的 [Unicode 十诫](http://cafe.elharo.com/programming/the-ten-commandments-of-unicode/)。
*   开发人员还应注意 [规范表示](http://www.owasp.org/index.php/Canonicalization,_locale_and_Unicode)攻击。

您应该了解的一些关键概念是：

*   [字形](http://www.unicode.org/glossary/#glyph)——用于表示书写字符的具体图形。
*   [组合](http://www.unicode.org/versions/Unicode5.0.0/ch03.pdf#G729)——组合字形以创建另一个字形。
*   [编码](http://en.wikipedia.org/wiki/Character_encoding)——将 Unicode 点转换为字节流。
*   [Collat](http://www.unicode.org/reports/tr10/) ​​ion — Unicode 字符串的区域敏感比较。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-10-21T16:02:43.120

冒着添加另一个链接的风险，[unicode.org](http://www.unicode.org)是一个壮观的资源。

简而言之，它是 ASCII 的替代品，旨在处理人类曾经使用过的每个字符。Unicode 有各种编码方案来处理所有这些字符 - UTF-8，现在或多或少是标准，非常努力地保持每个字符一个字节，并且前 7 位与 ASCII 相同。

（作为附录，程序员中有一个普遍的误解，即如果你要进行国际化，你只需要了解 Unicode。虽然这肯定是一种用途，但它不是唯一的用途。例如，我正在研究一个只会使用英文文本的项目 - 但有大量花哨的数学符号。将整个项目转移到完全 Unicode 解决的问题比我数不清。）

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-21T15:57:53.100

Unicode 是业界一致认可的标准，用于一致地表示能够表示世界字符系统的文本。所有开发人员都需要了解它，因为全球化是一个日益受到关注的问题。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-21T16:13:38.717

处理 Unicode 的一个（开放）代码源是[ICU](http://www.icu-project.org/) - Unicode 的国际化组件。它包括用于 Java 的 ICU4J 和用于 C 和 C++ 的 ICU4C（提供 C 接口；使用 C++ 编译器）。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-21T16:05:42.227

Unicode 是一个字符集，除了 ASCII（只包含英文字母，127 个字符，其中三分之一实际上是不可打印的控制字符）包含大约 200 万个字符，包括所有已知语言的字符（中文、俄文、希腊语、阿拉伯语等）和一些您可能从未听说过的语言（甚至许多不再使用的死语言符号，但对于存档古代文件很有用）。

因此，您无需处理数十种不同的字符编码，而是为所有字符使用一种编码（这也使得在单个文本字符串中混合来自不同语言的字符变得更容易，因为您不需要在文本字符串的中间）。实际上还有很多空间，我们还远远没有使用所有 2 个 mio 字符；Unicode 联盟可以轻松地为另外 100 种语言添加符号，甚至不用担心符号空间不足。

今天，您可以在图书馆中找到的几乎任何语言的任何书籍都可以用 Unicode 表示。Unicode 是编码本身的名称，它如何表示为“字节”是一个不同的问题。有几种写 Unicode 字符的方法，如 UTF-8（一到六个字节表示单个字符，取决于字符数，英文几乎总是一个字节，其他罗马语言可能是两个或三个，中文/日文可能更多） , UTF-16（大多数字符是两个字节，一些很少使用的是四个字节）和UTF-32，每个字符都是四个字节。还有其他的，但这些是占主导地位的。

Unicode 是许多较新的操作系统（在 Mac OS X 中几乎所有东西都是 Unicode）和编程语言（Java 使用 Unicode 作为默认编码，通常是 UTF-16，我听说 Python 也是如此，并将使用或已经使用 UTF- 32)。如果您打算编写一个应该显示、存储或处理纯英文文本以外的任何内容的应用程序，那么您最好习惯 Unicode，越早越好。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-10-21T17:03:36.477

您无需学习 unicode 即可使用它，这是一个非常复杂的规范。您只需要了解主要问题以及您的编程工具如何处理它。要了解这一点，请查看 Galwegian 的链接以及您的编程语言和 ide 文档。

例如：

您可以将任何字符从 latin-1 转换为 unicode，但它不适用于所有字符。PHP 现在让您知道某些函数（如 stristr）不适用于 unicode。Python 以这种方式声明 unicode 字符串：u"Hello World"。

那是你必须知道的那种瘦。

知道这一点，如果您没有充分的理由不使用 unicode，那么就使用它。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-21T16:05:00.357

Unicode 是一种枚举字符的标准，并为它们提供唯一的数字 ID（称为“代码点”）。它包括用于大多数现代书面语言的大量且不断增长的字符集，以及许多异国情调的东西，如古希腊乐谱。

与其他字符编码方案（如 ASCII 或 ISO-8859 标准）不同，Unicode 没有说明以字节表示这些字符。它只是为字符提供了一组通用的 ID。所以说 Unicode 是“ASCII 的 16 位替代品”是错误的。

有多种编码方案可以以字节为单位表示任意 Unicode 字符，包括 UTF-8、UTF-16 等。

# c# - 将对象转换为通用接口

> ID：222403
> 
> 赞同：31
> 
> 时间：2008-10-21T15:58:54.267
> 
> 标签：c#, generics, interface, casting

我有以下界面：

```
internal interface IRelativeTo<T> where T : IObject
{
    T getRelativeTo();
    void setRelativeTo(T relativeTo);
} 
```

以及一堆（应该）实现它的类，例如：

```
public class AdminRateShift : IObject, IRelativeTo<AdminRateShift>
{
    AdminRateShift getRelativeTo();
    void setRelativeTo(AdminRateShift shift);
} 
```

我意识到这三个是不一样的：

```
IRelativeTo<>
IRelativeTo<AdminRateShift>
IRelativeTo<IObject> 
```

但尽管如此，我需要一种方法来处理所有不同的类，比如 AdminRateShift（和 FXRateShift、DetRateShift），它们都应该实现 IRelativeTo。假设我有一个将 AdminRateShift 作为对象返回的函数：

```
IRelativeTo<IObject> = getObjectThatImplementsRelativeTo(); // returns Object 
```

通过针对接口进行编程，我可以做我需要做的事情，但我实际上不能将 Object 强制转换为 IRelativeTo 所以我可以使用它。

这是一个微不足道的例子，但我希望它能阐明我想要做什么。

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2008-10-21T16:03:38.750

如果我理解这个问题，那么最常见的方法是声明一个非泛型基接口，即

```
internal interface IRelativeTo
{
    object getRelativeTo(); // or maybe something else non-generic
    void setRelativeTo(object relativeTo);
}
internal interface IRelativeTo<T> : IRelativeTo
    where T : IObject
{
    new T getRelativeTo();
    new void setRelativeTo(T relativeTo);
} 
```

另一种选择是让您主要使用泛型进行编码......即您有类似的方法

```
void DoSomething<T>() where T : IObject
{
    IRelativeTo<IObject> foo = // etc
} 
```

如果`IRelativeTo<T>`是 的参数`DoSomething()`，那么*通常*您不需要自己指定泛型类型参数 - 编译器会推断它 - 即

```
DoSomething(foo); 
```

而不是

```
DoSomething<SomeType>(foo); 
```

这两种方法都有好处。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-10-21T16:02:56.210

不幸的是，继承不适用于泛型。如果您的函数需要 IRelativeTo，您也可以将函数设为通用：

```
void MyFunction<T>(IRelativeTo<T> sth) where T : IObject
{} 
```

如果我没记错的话，当你使用上面的函数时，你甚至不需要指定类型，编译器应该根据你提供的参数来计算它。

如果您想在类或方法中保留对这些 IRelativeTo 对象之一的引用（并且您不在乎 T 是什么），则需要再次使此类/方法通用。

我同意，这有点痛苦。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-10-21T16:32:02.983

如果您只关心 IRelativeTo 处理 IObjects，那么您不需要将其设为通用：

```
interface IRelativeTo
 {
   IObject getRelativeTo();
   void setRelativeTo(IObject relativeTo)
 } 
```

但是，实现类可能仍然是通用的：

```
abstract class RelativeTo<T>  : IRelativeTo where T : IObject
 {  
   public virtual T getRelativeTo() {return default(T);}

   public virtual void setRelativeTo(T relativeTo) {}

   IObject IRelativeTo.getRelativeTo() {return this.getRelativeTo(); }

   void IRelativeTo.setRelativeTo(IObject relativeTo) 
    { this.setRelativeTo((T) relativeTo);
    }
 }

class AdminRateShift :  RelativeTo<AdminRateShift>, IObject {} 
```

然后你可以这样做：

```
 IRelativeTo irt = new AdminRateShift();
  IObject o = irt.getRelativeTo();
  irt.setRelativeTo(o); 
```

# .net-3.5 - 我应该如何为不同的客户端管理在 SQL Server 2008 和 SQL Server 2005 上的开发？

> ID：222410
> 
> 赞同：0
> 
> 时间：2008-10-21T16:01:13.233
> 
> 标签：.net-3.5, .net-2.0, development-environment

我工作的公司有几个客户。我目前正在两个 .net 项目之间分配时间。对于客户端 AI，需要 Visual Studio 2008、SQL Server 2008 和 3.5 框架。对于客户端 B 2005 版本/2.0 框架。

该公司的其他人正在使用 Microsoft Virtual PC 来保持开发环境的独立性。

你有什么建议？

**附加信息：** 我看到的主要好处是您可以与任何人共享您的虚拟机设置。这允许新开发人员直接介入项目，而无需花费半天时间来设置新的开发环境及其所有特性。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-21T16:02:16.757

我个人都安装在同一个系统上，并为每个项目使用适当的工具

VS 2005/SQL 服务器 2005

VS 2008/SQL 服务器 2008

我发现它工作得很好，而且我没有切换虚拟机的麻烦。我认为虚拟机只是增加了开销。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-21T16:18:13.697

我也都安装了。实际上，我更进一步，在我的笔记本电脑上设置了多个本地用户，所以我可以右键单击 -> 运行方式，然后将为我的客户端自动加载所有设置（源代码控制等）一起工作。

I just have named instances of SQL Server on my laptop for the particular version, and each project just refers to its own instance of SQL Server. These don't seem to be any conflicts between Visual Studio or any other components.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-21T16:05:37.890

我个人建议你走VPC路线。我已经使用 VPC 将我的开发环境隔离了 2 年多，并且永远不会回去。一台笔记本电脑现在可以轻松拥有 4 GB 以上的 RAM，如果需要，这足以运行几个 VPC。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-21T16:06:15.487

实际上我有 VS 2003 在同一个盒子上添加到 2005 和 2008。如果您想同时打开多个版本，而不是多个虚拟机，值得拥有多个监视器。

# algorithm - 在图中找到访问某些节点的最短路径

> ID：222413
> 
> 赞同：92
> 
> 时间：2008-10-21T16:01:56.133
> 
> 标签：algorithm, graph-theory, dijkstra

我有一个大约 100 个节点和大约 200 条边的无向图。一个节点标记为“开始”，一个节点标记为“结束”，大约有十几个标记为“必须通过”。

我需要找到从“开始”开始，在“结束”结束，**并通过所有“必须通过”节点（以任何顺序）的最短路径。**

（[http://3e.org/local/maize-graph.png](http://3e.org/local/maize-graph.png) / [http://3e.org/local/maize-graph.dot.txt](http://3e.org/local/maize-graph.dot.txt)是有问题的图表 - 它代表宾夕法尼亚州兰开斯特的玉米迷宫）

* * *

## 回答 #1

> 赞同：79
> 
> 时间：2008-10-23T01:50:29.360

将其与旅行推销员问题进行比较的其他人可能没有仔细阅读您的问题。在 TSP 中，目标是找到访问*所有*顶点的最短循环（哈密顿循环）——它对应于将*每个*节点标记为“必须通过”。

就您而言，鉴于您只有大约十二个标有“必须通过”的标签，并且有 12 个！相当小（479001600），您可以简单地尝试仅“必须通过”节点的所有排列，并查看从“开始”到“结束”按该顺序访问“必须通过”节点的最短路径 - 它只会是该列表中每两个连续节点之间的最短路径的串联。

换句话说，首先找到每对顶点之间的最短距离（您可以使用 Dijkstra 算法或其他算法，但是对于那些小数字（100 个节点），即使是最简单的代码[Floyd-Warshall 算法](http://en.wikipedia.org/wiki/Floyd-Warshall_algorithm)也会及时运行）。然后，一旦你把它放在一个表中，尝试你的“必须通过”节点的所有排列，其余的。

像这样的东西：

```
//Precomputation: Find all pairs shortest paths, e.g. using Floyd-Warshall
n = number of nodes
for i=1 to n: for j=1 to n: d[i][j]=INF
for k=1 to n:
    for i=1 to n:
        for j=1 to n:
            d[i][j] = min(d[i][j], d[i][k] + d[k][j])
//That *really* gives the shortest distance between every pair of nodes! :-)

//Now try all permutations
shortest = INF
for each permutation a[1],a[2],...a[k] of the 'mustpass' nodes:
    shortest = min(shortest, d['start'][a[1]]+d[a[1]][a[2]]+...+d[a[k]]['end'])
print shortest 
```

（当然这不是真正的代码，如果你想要实际的路径，你必须跟踪哪个排列给出了最短的距离，以及所有对最短的路径是什么，但你明白了。）

它会在任何合理的语言上运行最多几秒钟:)
[如果你有 n 个节点和 k 个“必须通过”节点，它的运行时间对于 Floyd-Warshall 部分是 O(n ³ )，而 O(k!n ) 对于所有排列部分，并且 100^3+(12!)(100) 实际上是花生，除非你有一些真正的限制性约束。]

* * *

## 回答 #2

> 赞同：29
> 
> 时间：2008-10-21T16:05:41.697

运行[Djikstra 算法](http://en.wikipedia.org/wiki/Shortest_Path_First)以找到所有关键节点（开始、结束和必须通过）之间的最短路径，然后深度优先遍历应该告诉您通过结果子图的最短路径，该路径触及所有节点 start .. . 必须通过 ... 结束

* * *

## 回答 #3

> 赞同：18
> 
> 时间：2008-10-21T17:24:33.160

这是两个问题... Steven Lowe 指出了这一点，但没有对问题的后半部分给予足够的尊重。

您应该首先发现所有关键节点（开始、结束、必须通过）之间的最短路径。一旦发现这些路径，您就可以构建一个简化图，其中新图中的每条边都是从原始图中的一个关键节点到另一个关键节点的路径。您可以使用许多寻路算法在这里找到最短路径。

但是，一旦有了这个新图表，您就完全遇到了 Traveling Salesperson 问题（嗯，几乎……无需返回您的起点）。上面提到的任何与此相关的帖子都将适用。

* * *

## 回答 #4

> 赞同：14
> 
> 时间：2008-10-21T17:11:53.467

实际上，您发布的问题类似于旅行推销员，但我认为更接近于一个简单的寻路问题。无需访问每个节点，您只需在尽可能短的时间（距离）内访问一组特定的节点。

这样做的原因是，与旅行商问题不同，玉米迷宫不允许您直接从地图上的任何一个点前往任何其他点，而无需通过其他节点到达那里。

我实际上会推荐 A* 寻路作为一种需要考虑的技术。您可以通过决定哪些节点可以直接访问哪些其他节点以及来自特定节点的每一跳的“成本”是多少来设置它。在这种情况下，看起来每个“跃点”的成本可能相同，因为您的节点似乎间隔相对较近。A* 可以使用此信息找到任意两点之间的最低成本路径。由于您需要从 A 点到 B 点并在其间访问大约 12 个点，因此即使是使用寻路的蛮力方法也不会受到伤害。

只是一个可供考虑的替代方案。它看起来确实*非常*像旅行推销员问题，这些都是值得阅读的好论文，但仔细观察，你会发现它只是过于复杂的事情。^_^ 这来自之前处理过这类事情的视频游戏程序员的想法。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2015-07-15T23:29:47.717

这*不是*TSP 问题，也不是 NP 难题，因为原始问题不要求必须通过的节点只访问一次。在通过 Dijkstra 算法编译所有必须通过的节点之间的最短路径列表之后，这使得答案变得非常简单。可能有更好的方法，但简单的方法是简单地向后工作二叉树。想象一个节点列表 [start,a,b,c,end]。将简单距离相加 [start->a->b->c->end] 这是您要击败的新目标距离。现在尝试 [start->a->c->b->end] 如果这样更好，请将其设置为目标（并记住它来自该节点模式）。在排列上向后工作：

*   [开始->a->b->c->结束]
*   [开始->a->c->b->结束]
*   [开始->b->a->c->结束]
*   [开始->b->c->a->结束]
*   [开始->c->a->b->结束]
*   [开始->c->b->a->结束]

其中之一将是最短的。

（如果有的话，“多次访问”节点在哪里？它们只是隐藏在最短路径初始化步骤中。a 和 b 之间的最短路径可能包含 c 甚至终点。你不需要关心)

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2008-10-21T22:16:40.853

Andrew Top 的想法是正确的：

1) Djikstra 算法 2) 一些 TSP 启发式算法。

我推荐 Lin-Kernighan 启发式算法：它是任何 NP 完全问题中最著名的算法之一。唯一要记住的另一件事是，在您在第 2 步之后再次展开图形后，您的展开路径中可能有循环，因此您应该绕过这些循环（查看路径上的顶点度数）。

我实际上不确定这个解决方案相对于最佳解决方案有多好。可能有一些病理情况与短路有关。毕竟，这个问题看起来很像 Steiner Tree：[http](http://en.wikipedia.org/wiki/Steiner_tree) ://en.wikipedia.org/wiki/Steiner_tree并且你绝对不能通过收缩你的图表并运行 Kruskal's 来近似 Steiner Tree。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-10-21T16:08:47.087

考虑到节点和边的数量相对有限，您可能可以计算出每条可能的路径并取最短的一条。

通常这被称为旅行商问题，并且无论您使用什么算法，它都有一个不确定的多项式运行时间。

[http://en.wikipedia.org/wiki/Traveling_salesman_problem](http://en.wikipedia.org/wiki/Traveling_salesman_problem)

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2020-08-29T18:20:14.513

这个问题谈到了**必须以任何顺序通过**。我一直在尝试寻找有关必须通过节点的定义顺序的解决方案。我找到了答案，但由于 StackOverflow 上的任何问题都没有类似的问题，所以我在这里发布以让最多的人从中受益。

如果*定义*了顺序或必须通过，那么您可以多次运行 dijkstra 算法。例如，假设您必须从`s`pass through`k1`和（按相应顺序）开始`k2`并`k3`停在`e`. 然后你可以做的是在每对连续的节点之间运行 dijkstra 算法。**成本**和**路径**将由下式给出：

`dijkstras(s, k1) + dijkstras(k1, k2) + dijkstras(k2, k3) + dijkstras(k3, 3)`

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-05-29T15:50:47.787

在十几个“必须访问”的节点上使用蛮力怎么样。您可以轻松覆盖 12 个节点的所有可能组合，这为您提供了一个可以遵循的最佳电路来覆盖它们。

现在您的问题被简化为找到从起始节点到电路的最佳路线之一，然后您沿着路线直到您覆盖它们，然后找到从那里到结束的路线。

最终路径由以下部分组成：

开始 -> 电路路径* -> 必须访问节点的电路 -> 结束路径* -> 结束

你会发现我用 * 标记的路径是这样的

从开始节点到电路上的每个点进行 A* 搜索，从电路上的下一个和上一个节点到结束进行 A* 搜索（因为您可以在任一方向上跟随电路）最终得到的是很多搜索路径，您可以选择成本最低的一个。

通过缓存搜索有很大的优化空间，但我认为这会产生很好的解决方案。

但是，它并没有接近寻找最佳解决方案，因为这可能涉及将必须访问的电路留在搜索中。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2010-05-10T20:12:11.883

任何地方都没有提到的一件事是，是否可以在路径中多次访问同一个顶点。这里的大多数答案都假设多次访问同一个边是可以的，但我认为这个问题（一条路径不应该多次访问同一个顶点！）是*不能*访问同一个顶点两次。

所以蛮力方法仍然适用，但是当您尝试计算路径的每个子集时，您必须删除已经使用的顶点。

# php - PHP中的异步shell exec

> ID：222414
> 
> 赞同：210
> 
> 时间：2008-10-21T16:02:10.003
> 
> 标签：php, asynchronous, shell

我有一个 PHP 脚本，它需要调用一个 shell 脚本，但根本不关心输出。shell 脚本进行了许多 SOAP 调用并且完成速度很慢，所以我不想在 PHP 请求等待回复时减慢它的速度。事实上，PHP 请求应该能够在不终止 shell 进程的情况下退出。

我研究了各种`exec()`, `shell_exec()`,`pcntl_fork()`等功能，但似乎没有一个能提供我想要的东西。（或者，如果他们这样做，我不清楚怎么做。）有什么建议吗？

* * *

## 回答 #1

> 赞同：234
> 
> 时间：2008-10-21T16:08:03.283

如果它“不关心输出”，难道不能用`&`后台进程调用脚本的 exec 吗？

**编辑**- 结合[@AdamTheHut](https://stackoverflow.com/users/1103/adamthehutt)对此帖子的评论，您可以将其添加到以下调用中`exec`：

```
" > /dev/null 2>/dev/null &" 
```

这会将`stdio`(first `>`) 和`stderr`( `2>`) 重定向到`/dev/null`后台并在后台运行。

还有其他方法可以做同样的事情，但这是最简单的阅读方式。

* * *

上述双重重定向的替代方案：

```
" &> /dev/null &" 
```

* * *

## 回答 #2

> 赞同：57
> 
> 时间：2008-10-21T22:20:47.040

我为此使用**了 at**，因为它确实开始了一个独立的过程。

```
<?php
    `echo "the command"|at now`;
?> 
```

* * *

## 回答 #3

> 赞同：39
> 
> 时间：2016-10-25T15:12:07.660

致所有 Windows 用户：我找到了一种运行异步 PHP 脚本的好方法（实际上它几乎适用于所有东西）。

它基于 popen() 和 pclose() 命令。并且在 Windows 和 Unix 上运行良好。

```
function execInBackground($cmd) {
    if (substr(php_uname(), 0, 7) == "Windows"){
        pclose(popen("start /B ". $cmd, "r")); 
    }
    else {
        exec($cmd . " > /dev/null &");  
    }
} 
```

原始代码来自： http: [//php.net/manual/en/function.exec.php#86329](http://php.net/manual/en/function.exec.php#86329)

* * *

## 回答 #4

> 赞同：23
> 
> 时间：2008-10-21T22:27:26.450

在 linux 上，您可以执行以下操作：

```
$cmd = 'nohup nice -n 10 php -f php/file.php > log/file.log & printf "%u" $!';
$pid = shell_exec($cmd); 
```

这将在命令提示符处执行命令，然后只返回 PID，您可以检查它是否 > 0 以确保它有效。

这个问题类似：[PHP 有线程吗？](https://stackoverflow.com/questions/209774/does-php-have-threading)

* * *

## 回答 #5

> 赞同：13
> 
> 时间：2008-10-21T22:29:26.537

[php-execute-a-background-process](https://stackoverflow.com/questions/45953/php-execute-a-background-process#45966)有一些很好的建议。我认为我的很好，但我有偏见:)

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2008-10-21T22:46:46.720

在 Linux 中，您可以通过在命令末尾附加一个 & 符号来在一个新的独立线程中启动一个进程

```
mycommand -someparam somevalue & 
```

在 Windows 中，您可以使用“开始”DOS 命令

```
start mycommand -someparam somevalue 
```

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2008-11-14T15:31:56.447

正确的方法（！）做到这一点是

1.  叉（）
2.  设置ID（）
3.  执行（）

fork 分叉，setsid 告诉当前进程成为主进程（没有父进程），execve 告诉调用进程由被调用进程替换。这样父母就可以在不影响孩子的情况下退出。

```
 $pid=pcntl_fork();
 if($pid==0)
 {
   posix_setsid();
   pcntl_exec($cmd,$args,$_ENV);
   // child becomes the standalone detached process
 }

 // parent's stuff
 exit(); 
```

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2010-07-19T20:25:46.317

我用这个...

```
/** 
 * Asynchronously execute/include a PHP file. Does not record the output of the file anywhere.  
 * Relies on the PHP_PATH config constant.
 *
 * @param string $filename  file to execute
 * @param string $options   (optional) arguments to pass to file via the command line
 */ 
function asyncInclude($filename, $options = '') {
    exec(PHP_PATH . " -f {$filename} {$options} >> /dev/null &");
} 
```

（在哪里`PHP_PATH`定义类似`define('PHP_PATH', '/opt/bin/php5')`或类似的 const）

它通过命令行传入参数。要在 PHP 中阅读它们，请参阅[argv](http://php.net/manual/en/reserved.variables.argv.php)。

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2017-10-10T22:45:58.693

我还发现[Symfony Process Component](https://symfony.com/doc/current/components/process.html#running-processes-asynchronously)对此很有用。

```
use Symfony\Component\Process\Process;

$process = new Process('ls -lsa');
// ... run process in background
$process->start();

// ... do other things

// ... if you need to wait
$process->wait();

// ... do things after the process has finished 
```

[在其GitHub 存储库](https://github.com/symfony/process/blob/729f0f798ebf13f17a79e2431bbcc1fd5c515552/Process.php#L250)中查看它是如何工作的。

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2012-02-08T18:11:32.177

我发现真正对我有用的唯一方法是：

```
shell_exec('./myscript.php | at now & disown') 
```

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2008-11-07T07:33:53.567

您还可以将 PHP 脚本作为**daemon**或**cronjob**运行：`#!/usr/bin/php -q`

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-11-14T15:47:02.207

使用命名的 fifo。

```
#!/bin/sh
mkfifo trigger
while true; do
    read < trigger
    long_running_task
done 
```

然后，每当您想启动长时间运行的任务时，只需编写一个换行符（非阻塞到触发器文件。

只要您的输入小于`PIPE_BUF`并且是单个`write()`操作，您就可以将参数写入 fifo 并让它们像`$REPLY`在脚本中一样显示。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2016-12-21T10:18:55.900

不使用队列，你可以[`proc_open()`](http://php.net/manual/en/function.proc-open.php)这样使用：

```
 $descriptorspec = array(
        0 => array("pipe", "r"),
        1 => array("pipe", "w"),
        2 => array("pipe", "w")    //here curaengine log all the info into stderror
    );
    $command = 'ping stackoverflow.com';
    $process = proc_open($command, $descriptorspec, $pipes); 
```

# sql-server - SQL Server - 运行大型脚本文件

> ID：222442
> 
> 赞同：68
> 
> 时间：2008-10-21T16:07:35.530
> 
> 标签：sql-server, sql-scripts

我在开发服务器上有一个数据库表，在使用包含 140 万行的 CSV 文件的导入例程将其设置为运行后，该表现在已完全填充。

我在表上运行了数据库发布向导，现在我的本地机器上有一个 286MB 的 SQL 脚本。问题是，我不知道如何运行它。如果我将它加载到 SQL Server Management Studio Express 中，我会收到一个警告窗口，上面写着“操作无法完成”。

关于如何让这个 SQL 脚本运行的任何想法？

* * *

## 回答 #1

> 赞同：171
> 
> 时间：2008-10-21T16:09:07.057

使用[sqlcmd](http://msdn.microsoft.com/en-us/library/ms170572.aspx)工具执行文件..

```
sqlcmd -S myServer\instanceName -i C:\myScript.sql 
```

如果您对包含多个 INSERT 的大型 sql 文件（> 100MB）有无法解释的“脚本错误”，只需在文件中将“INSERT INTO”替换为“GO INSERT INTO”，这将减少事务的大小。

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2014-06-01T11:59:21.227

CodePlex 上的这个工具（[Big SQL Script File Runner](http://bigsqlrunner.codeplex.com/)）将运行带有日志和 GUI 的任何大小的脚本文件。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2015-04-23T13:12:58.660

添加到 Gulzar Nazim 的答案：如果仍然失败，请尝试使用选项指定 SQL 文件的[代码页](https://msdn.microsoft.com/en-us/library/windows/desktop/dd317756(v=vs.85).aspx)`-f`：

`sqlcmd -S myServer\instanceName -d databaseName -i C:\myScript.sql -f 65001`

我试图从 SQLite（默认为 UTF-8）导入一个 .dump 文件，并且 sqlcmd 在遇到第一个特殊字符后不断抛出错误。`-f 65001`为我修好了。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-21T18:02:17.200

为什么不直接使用 DTS 导入 CSV 文件呢？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2019-07-16T17:38:52.863

是的，我们可以这样做，我尝试使用**BCP**（批量复制程序）方法来避免 OutOfMemory 问题。

**注意：在 SQLServer 2014 中尝试过**

在 BCP 中，首先我们需要将源数据库数据导出到**bcp**文件（在本地目录文件夹中），然后需要将该**bcp**文件导入源数据库

[![在此处输入图像描述](https://i.stack.imgur.com/8szSn.png)](https://i.stack.imgur.com/8szSn.png)

以下是蛋糕步行步骤：

笔记：

a) 确保目标数据库中存在空表

b) 确保 C 盘中存在 Temp 文件夹

**1)**使用以下命令创建一个名为**Export_Data.bat的 bat 文件**

```
bcp.exe [Source_DataBase_Name].[dbo].[TableName] OUT "C:\Temp\TableName.bcp" -S "Computer Name" -U "SQL Server UserName" -P "SQL Server Password" -n -q 
```

暂停

**2）**运行该bat文件，因为在Temp文件夹中将生成一个bcp文件

**3）**然后使用以下命令创建另一个名为**Import_Data.bat的 bat 文件**

```
bcp.exe [Destination_DataBase_Name].[dbo].[TableName] IN "C:\Temp\TableName.bcp" -S "Computer Name" -U "SQL Server UserName" -P "SQL Server Password" -n -q 
```

暂停

现在我们开始！！

* * *

## 回答 #6

> 赞同：-9
> 
> 时间：2008-10-21T16:10:28.817

在单个事务中运行这么大的东西不是一个好主意。因此，我建议将文件分成更小、更易于管理的块。

另一种选择是查看直接导入 CSV 数据的其他一些方法。

# java - 脚轮性能问题

> ID：222444
> 
> 赞同：1
> 
> 时间：2008-10-21T16:08:02.767
> 
> 标签：java, xml, performance, castor

我们最近从版本 0.9.5.3 升级到 Castor 1.2，我们注意到在 XML 上调用 unmarshal 时性能急剧下降。在这两种情况下，我们将解组到由 castor 生成的 java 类。相比之下，使用相同的 XML，XML 解组调用的时间过去大约需要 10-20 毫秒，现在大约需要 2300 毫秒。在我们的新 castor 实现中是否有明显的我可能遗漏的东西，也许是我遗漏的属性文件，或者我应该开始考虑恢复到旧版本？也许在 java 类文件生成中有些东西正在杀死 unmarshal 调用？如果有充分的理由放弃它以支持其他东西，我也可能会考虑 Castor 替代品。我们在 weblogic 服务器中使用 java 1.5。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2011-10-13T16:23:32.933

我们在使用 castor 1.0.5 和 .castor.cdr 文件时遇到了非常严重的性能问题（解组需要几秒钟，而过去需要几毫秒）。

似乎 .castor.cdr 生成的文件包含旧的/错误的值（不存在的类型和描述符）。删除此文件中的犯罪行后，一切恢复正常。

希望这可以帮助任何有同样问题的人！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-21T16:25:00.750

您可能要考虑改用[JiBX](http://www.jibx.org)。它比 Castor 快得多（在我进行切换的一个项目上快 9 倍），而且更干净。

**编辑**：另见我对这个相关问题的[回答。](https://stackoverflow.com/questions/205749/java-xml-binding#206146)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-22T20:34:16.007

我们最终恢复到 Castor 版本 0.9.5.3，并且在我们从新的 XSD 重新生成 java 类之后，性能又回升了。我不确定为什么生成的 java 之间存在如此大的差异，但是 1.2 类在解组时慢了大约 2 个数量级。

**编辑：**看起来通过创建 ClassDescriptorResolvers/mapping 文件并关闭验证，我们也可以提高性能，但由于我们使用模式生成过程创建了大约 1000 个对象，从成本角度来看，这实际上并不可行。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-30T01:07:24.313

我也有这个问题，在生成 XML 的基本客户/地址集时，生成包含 74 个客户的文档大约需要 3 秒。

恢复到 1.0.4（用于测试）看到这个返回到 1.4s，

但是手动滚动 XML 会在 40 毫秒以下看到输出。我知道框架会增加一些开销，但一定是有什么原因导致了这种情况。

在 Castor 上是否进行过任何分析？

我会按照 Dan 的建议去调查 JiBX。

# python - 如何从 Python 编写 Visual Studio 2008 脚本？

> ID：222450
> 
> 赞同：7
> 
> 时间：2008-10-21T16:08:55.167
> 
> 标签：python, visual-studio, visual-studio-2008, visual-c++

我想编写驱动 Visual Studio 2008 和 Visual C++ 2008 的 Python 脚本。到目前为止，我发现的所有示例都使用`win32com.client.Dispatch`. 这适用于 Excel 2007 和 Word 2007，但不适用于 Visual Studio 2008：

```
import win32com.client
app1 = win32com.client.Dispatch( 'Excel.Application' ) # ok
app2 = win32com.client.Dispatch( 'Word.Application' )  # ok
app3 = win32com.client.Dispatch( 'MSDev.Application' ) # error 
```

有任何想法吗？Visual Studio 2008 是否使用不同的字符串来标识自己？上面的方法过时了吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-21T18:49:14.267

[AutoIt](http://www.autoitscript.com/autoit3/index.shtml)可能会满足您的需求，具体取决于您想要做什么。事实上，我确信它会做任何你需要它做的事情。

摘自我关于如何将 AutoIt 与 Python 一起使用的[另一篇文章：](https://stackoverflow.com/questions/151846/get-other-running-processes-window-sizes-in-python#155587)

```
import win32com.client
oAutoItX = win32com.client.Dispatch( "AutoItX3.Control" )

oAutoItX.Opt("WinTitleMatchMode", 2) #Match text anywhere in a window title

width = oAutoItX.WinGetClientSizeWidth("Firefox")
height = oAutoItX.WinGetClientSizeHeight("Firefox")

print width, height 
```

您当然可以通过这种方式使用任何[AutoItX 功能](http://www.autoitscript.com/autoit3/docs/functions.htm)（请注意，该链接指向 AutoIt 功能参考，AutoIt 的 com 版本 - AutoItX 具有该列表的子集...文档包含在下载中）。我不知道您想要做什么，所以我无法为您指出适当的功能，但这应该可以帮助您入门。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-21T23:08:12.310

我不知道这是否会对 2008 年有所帮助，但使用 Visual Studio 2005 和 win32com 我可以做到这一点：

```
>>> import win32com.client
>>> b = win32com.client.Dispatch('VisualStudio.DTE')
>>> b
<COMObject VisualStudio.DTE>
>>> b.name
u'Microsoft Visual Studio'
>>> b.Version
u'8.0' 
```

不幸的是，我没有 2008 年可供测试。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-06-11T17:42:16.663

ryan_s 有正确的答案。您可能会重新考虑使用 win32com。

我更喜欢 comtypes 模块而不是 win32com。一般来说，它更适合 ctypes 和 python。

在 vs 2008 中使用任何一种方法都可以。这是一个打印 Visual Studio 中所有命令的名称和键盘快捷方式的示例。

```
import comtypes.client as client

vs = client.CreateObject('VisualStudio.DTE')

commands = [command for command in vs.Commands if bool(command.Name) or bool(command.Bindings)]
commands.sort(key=lambda cmd : cmd.Name)

f= open('bindings.csv','w')

for command in commands:
    f.write(command.Name+"," +";".join(command.Bindings)+ "\n")

f.close() 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-21T16:12:04.663

您可以尝试*.Net*自己的版本[IronPython](http://www.codeplex.com/ironpython)。它有一个*VS*插件[IronPythonStudio](http://www.codeplex.com/IronPythonStudio)。

作为一种*.Net*语言，您可以访问所有可用的程序集，包括[Visual Studio Tools for Office](http://msdn.microsoft.com/en-us/office/aa905533.aspx)。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-11-20T12:00:39.627

截至 2013 年，更好的选择是`Visual Studio`通过`IronPython`更好`CLR`/`COM`和其他 MS 东西集成编写脚本：

```
 import clr
import System

t = System.Type.GetTypeFromProgID("AutoItX3.Control")
oAutoItX = System.Activator.CreateInstance(t)

oAutoItX.Opt("WinTitleMatchMode", 2)

width = oAutoItX.WinGetClientSizeWidth("IronPythonApplication1 - Microsoft Visual Studio (Administrator)")
height = oAutoItX.WinGetClientSizeHeight("IronPythonApplication1 - Microsoft Visual Studio (Administrator)")

print width, height 
```

# java - 如何阻止 Hibernate 急切地获取多对一关联对象

> ID：222453
> 
> 赞同：11
> 
> 时间：2008-10-21T16:09:42.903
> 
> 标签：java, hibernate

我有一个在多对一元素中声明的域对象的属性。此属性的基本语法如下所示：

```
<many-to-one name="propertyName" class="propertyClass" fetch="select" not-found="ignore" lazy="proxy" /> 
```

现在，我们的想法是让 Hibernate 不急于获取这个属性。它可能为空，因此设置了未找到的忽略。

但是，Hibernate 在加载包含此关联的类时，会在加载父类时自行加载实际类（甚至不是代理）实例。由于某些属性的大小超过 1MB，因此它们占用了大量的堆空间。

但是，如果 not-found 设置为异常（或默认为异常），则具有此属性的父类会加载代理！

如何阻止休眠不加载代理，同时仍然允许此属性为空？

我找到了lazy=no-proxy，但是文档讨论了某种字节码修改，并没有详细说明。有人可以帮我吗？

如果重要的话，它是 Hibernate 的 Java 版本，并且至少是版本 3（如果有帮助，我可以查找实际版本，但现在是 Hibernate 3+）。

我之前没有指定，但是Java版本是1.4。因此，不支持 Java 注释。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-10-21T16:50:44.867

如果关联的另一端可以为*null ，我相信 hibernate 必须查询关联端以确定它是否应该使用代理（如果另一端为**null*则不需要代理）。我现在找不到对此的参考，但我记得在某处读过它。

为了提供**字段**的延迟加载，文档参考了构建时字段的字节码增强：[使用延迟属性获取](http://docs.jboss.org/hibernate/orm/3.6/reference/en-US/html/performance.html#performance-fetching-lazyproperties)。这是一段摘录：

> Hibernate3 支持对单个属性的惰性获取。这种优化技术也称为提取组。请注意，这主要是一种营销功能，因为在实践中，优化行读取比优化列读取更重要。但是，仅加载类的某些属性在极端情况下可能很有用，即遗留表有数百列并且无法改进数据模型。
> 
> 延迟属性加载需要构建时字节码检测！如果您的持久类没有得到增强，Hibernate 将默默地忽略惰性属性设置并回退到立即获取。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-08-22T00:23:44.663

> 我找到了lazy=no-proxy，但是文档讨论了某种字节码修改，并没有详细说明。有人可以帮我吗？

我假设您正在使用 ANT 来构建您的项目。

```
<property name="src" value="/your/src/directory"/><!-- path of the source files -->
<property name="libs" value="/your/libs/directory"/><!-- path of your libraries -->
<property name="destination" value="/your/build/directory"/><!-- path of your build directory -->

<fileset id="applibs" dir="${libs}">
  <include name="hibernate3.jar" />
  <!-- include any other libraries you'll need here -->
</fileset>

<target name="compile">
  <javac srcdir="${src}" destdir="${destination}" debug="yes">
    <classpath>
      <fileset refid="applibs"/>
    </classpath>
  </javac>
</target>

<target name="instrument" depends="compile">
  <taskdef name="instrument" classname="org.hibernate.tool.instrument.javassist.InstrumentTask">
    <classpath>
      <fileset refid="applibs"/>
    </classpath>
  </taskdef>

  <instrument verbose="true">
    <fileset dir="${destination}">
      <!-- substitute the package where you keep your domain objs -->
      <include name="/com/mycompany/domainobjects/*.class"/>
    </fileset>
  </instrument>
</target> 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2011-02-23T16:16:47.347

确保你的课程不是最终的！

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-21T16:17:21.423

如果您通过控制器将休眠对象从模型传递到视图，请不要！

而是创建一个“快照对象”来存储您想要传递给视图并显示的 Hibernate 对象的值。

**为什么？** 代理在控制器中时仍然可以检索值......但是当您将代理/对象传递给视图时，它不再可以检索值，因为事务已经结束。这就是为什么我提出我上面的建议。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-21T18:36:05.277

使用 Hibernate 注释时，将 @ManyToOne(fetch = FetchType.LAZY) 放在关联上，可以完成您想要的。您是否尝试设置 fetch="lazy" 以查看是否有效？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-08T07:49:51.017

@Miguel Ping：我认为您所指的页面是 [ [http://www.hibernate.org/162.html]](http://www.hibernate.org/162.html])。据我了解，在不存在外键的一对一情况下，需要额外的 SELECT 。设置`constrained="true"`告诉 Hibernate，另一端始终存在，不需要额外的 SELECT。

因此，对于外键所在的多对一而言，不需要执行另一个 SELECT ，因为 FK 的值会告诉您另一端是否存在或`null`. 至少，我是这样理解的。

理论到此为止。代理在外键/多对一方面为我工作。用于关联的映射是：

`<many-to-one name="haendler" column="VERK_HAENDLOID" lazy="proxy" />`

但是代理在一对一的情况下对我来说不起作用，使用给定 URL ( `constrained="true"`) 中描述的映射。嗯，我想我会为此提出一个问题。;-)

# c# - 如何强制串行端口写入方法在发送数据之前等待线路清除？

> ID：222455
> 
> 赞同：11
> 
> 时间：2008-10-21T16:10:31.607
> 
> 标签：c#, windows-mobile, bluetooth, serial-port, zebra-printers

这是我正在尝试做的一些背景：

1.  打开从移动设备到蓝牙打印机的串行端口。
2.  向蓝牙打印机发送 EPL/2 表格，以便它了解如何处理即将接收的数据。
3.  收到表格后，将一些数据发送到打印机，这些数据将打印在标签纸上。
4.  根据需要对要打印的每个标签重复步骤 3。

第 2 步只发生在第一次，因为表单不需要在每个标签之前。我的问题是，当我发送表格时，如果我发送标签数据太快，它将无法打印。有时我会在标签上打印“蓝牙故障：无线电无法运行”，而不是我发送的数据。

通过执行以下操作，我找到了解决此问题的方法：

```
for (int attempt = 0; attempt < 3; attempt++)
{
    try
    {
        serialPort.Write(labelData);
        break;
    }
    catch (TimeoutException ex)
    {
        // Log info or display info based on ex.Message
        Thread.Sleep(3000);
    }
} 
```

所以基本上，我可以捕获一个 TimeoutException 并在等待一段时间后重试 write 方法（三秒似乎一直有效，但更少，似乎每次尝试都会抛出异常）。经过三次尝试，我只是假设串行端口有问题并让用户知道。

这种方式似乎工作正常，但我确信有更好的方法来处理这个问题。我认为我需要使用 SerialPort 类中的一些属性，但我真的找不到任何好的文档或如何使用它们的示例。我尝试过使用一些属性，但它们似乎都没有达到我想要达到的效果。

这是我玩过的属性列表：

*   CD控股
*   中通控股
*   Dsr控股
*   启用 Dtr
*   握手
*   RtsEnable

我确信这些的一些组合将处理我正在尝试做的更优雅的事情。

我正在使用 C#（2.0 框架）、Zebra QL 220+ 蓝牙打印机和 windows Mobile 6 手持设备，如果这对解决方案有任何影响的话。

任何建议，将不胜感激。

[更新]

我还应该注意到，移动设备使用的是蓝牙 2.0，而打印机只有 1.1 版。我假设速度差异是导致打印机在接收数据方面落后的原因。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-31T15:57:47.373

好吧，我已经根据已经给出的两个建议找到了一种方法。我需要使用以下内容设置我的串行端口对象：

```
serialPort.Handshake = Handshake.RequestToSendXOnXOff;
serialPort.WriteTimeout = 10000; // Could use a lower value here. 
```

然后我只需要进行写调用：

```
serialPort.Write(labelData); 
```

由于 Zebra 打印机支持软件流控制，它会在缓冲区快满时向移动设备发送 XOff 值。这会导致移动设备等待打印机发送 XOn 值，从而有效地通知移动设备它可以继续传输。

通过设置写入超时属性，我给出了在抛出写入超时异常之前允许传输的总时间。您仍然希望捕获写入超时，就像我在问题的示例代码中所做的那样。但是，没有必要循环 3 次（或任意数量），每次都尝试写入，因为软件流控制会启动和停止串行端口写入传输。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-21T16:33:54.477

流量控制在这里是正确的答案，它可能不存在/实现/适用于您的蓝牙连接。

查看 Zebra 规范，看看它们是否实现了，或者您是否可以打开软件流控制（xon、xoff），这将允许您查看各种缓冲区何时已满。

此外，蓝牙无线电的最大传输速度不太可能超过 250k。您可能会考虑人为地将其限制为 9,600bps - 这将为无线电提供很大的喘息空间，用于重传、纠错、检测和自身的流量控制。

如果一切都失败了，那么您现在使用的 hack 还不错，但我会打电话给 Zebra 技术支持，并在放弃之前找出他们的建议。

-亚当

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-21T16:21:27.950

问题可能不在于串行端口代码，而在于底层蓝牙堆栈。您使用的端口是纯虚拟的，甚至不太可能实现任何握手（因为它在很大程度上没有意义）。CTS/RTS DTR/DSR 根本不适用于您的工作。

根本问题是，当您创建虚拟端口时，它必须绑定到蓝牙堆栈并连接到配对的串行设备。端口本身不知道这可能需要多长时间，并且它可能已设置为异步执行此操作（尽管这完全取决于设备 OEM 如何完成）以防止调用者在没有时间的情况下长时间锁定配对设备或配对设备超出范围。

虽然您的代码可能感觉像是 hack，但它可能是完成您正在做的事情的最佳、最便携的方式。

您可以使用蓝牙堆栈 API 来尝试在连接之前查看设备是否存在并处于活动状态，但堆栈 API 没有标准化，因此 Widcom 和 Microsoft API 在您如何执行此操作方面有所不同，并且 Widcom 是专有的，并且昂贵的。你最终会遇到一堆尝试发现堆栈类型，动态加载适当的验证器类，让它调用堆栈并查找设备的混乱。鉴于此，您的简单民意调查似乎更清晰，您不必为 Widcom SDK 支付几美元。

# c# - 在 Visual Studio 解决方案中启用和禁用特定项目的“步入”调试

> ID：222456
> 
> 赞同：22
> 
> 时间：2008-10-21T16:10:46.630
> 
> 标签：c#, visual-studio, debugging, step-into

我有一个包含四个 C# 项目的 Visual Studio 解决方案。我想从我的主项目进入解决方案中支持项目的代码，但是当我使用“Step into”键时，它只是跳过对另一个项目的调用。我在支持项目中设置了断点，它们被忽略了，而且我一辈子都无法让它进入对该项目的任何引用。

一切都设置为编译为“调试”，我已经看到 Visual Studio 警告我之前不会命中我的断点 - 在这种情况下它不会这样做。就好像我的代码看起来会调试一样，但是在运行时，有一个设置告诉 Visual Studio 不要单步执行该项目中的代码。我的解决方案中的所有其他项目都可以毫无问题地调试。

我检查了哪个框导致这种行为？

**更新澄清**：“只是我的代码”选项目前被禁用。此外，由于代码属于我的同一解决方案中的一个项目，我认为“仅我的代码”选项在这里不适用。我以为它只适用于我没有源代码的预编译代码，但由于我的项目中有源代码，我认为这个选项没有任何效果。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-10-21T16:14:24.330

不确定是否是这样，但“工具>选项>调试>常规：仅启用我的代码”是可能的。（我更喜欢始终不选中它。）

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-10-21T18:06:23.870

事实证明，在调试之前需要将程序集复制到 GAC 中。在调试选项“只是我的代码”下，如果您没有任何用户代码，则有一个选项可以抑制错误，并且它正在抑制以下错误：

> 以下移动设备是在启用优化或没有调试信息的情况下构建的。（模块名称和路径）要调试此模块，请将其构建配置更改为调试模式。

由于我是在 Debug 配置中构建它，因此我搜索了该错误消息并得到了以下信息：

[http://claytonj.wordpress.com/2008/01/04/the-following-module-was-built-either-with-optimizations-enabled-or-without-debug-information/](http://claytonj.wordpress.com/2008/01/04/the-following-module-was-built-either-with-optimizations-enabled-or-without-debug-information/)

问题解决了。我不知道为什么它需要加入 GAC 才能让我进入该项目，但确实如此。我不问为什么，我只是问怎么做，然后我就做了......

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-10-21T16:16:55.823

要检查的一件事是您的支持项目程序集尚未安装在 GAC 中。打开命令提示符并运行以下命令以确保...

gacutil /l*程序集名称*

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-10-21T16:17:23.637

您需要确保支持项目具有 pdb 文件，否则 Visual Studio 将没有必要的信息来逐步执行代码。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2012-03-23T19:31:02.147

如果您有尝试进入的 dll 的源代码，请执行以下操作：

1.  单击添加这些 dll 作为参考的项目，然后将其删除。
2.  将与 dll(s) 对应的 Project(s) 添加到解决方案中
3.  右键单击项目 -> 添加引用 -> 选择新添加的项目。

现在设置断点并调试代码。您将能够单步执行代码。

问题的原因是您的程序仍在引用旧的 dll（没有源代码），因为它已作为参考添加到您的项目中。删除该 dll 并添加 dll 的项目（dll 的源代码）后，Visual Studio 将能够单步执行您的代码。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-10-21T16:21:38.793

几种可能性：

*   有一个复选框可以进入“只是我的代码”。它的目的是让您无法进入 Microsoft 的框架代码（除非您选择取消选中该框）。

*   您可以尝试重新编译支持代码，以确保您正在调试的代码与您正在查看的代码文件完全匹配。VS 确实关心这一点，如果您将断点放在版本不匹配的代码文件中，它将禁用断点。此外，请确保 PDB 文件与 DLL 位于同一目录中。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2015-04-20T10:50:10.777

在 Visual Studio 2013 中，导致此行为的一种方法是将构建配置设置为`Release`.
把它放回去`Debug`看看是否有帮助。

![在此处输入图像描述](https://i.stack.imgur.com/TgIjp.png)

# naming-conventions - 接口是否有 ISomething / ISomethingable 的替代方案？

> ID：222457
> 
> 赞同：11
> 
> 时间：2008-10-21T16:11:03.883
> 
> 标签：naming-conventions, interface

使用 I 作为接口名称前缀的 .NET 标准似乎越来越普遍，并且不再仅限于 .NET。我遇到了很多使用这种约定的 Java 代码（所以如果 Java 在 C# 之前使用它，我不会感到惊讶）。Flex 也使用它，等等。不过，在名称的开头放置一个 I 有点匈牙利符号的味道，所以我对使用它感到不舒服。

所以问题是，是否有另一种方式来表示Something 是一个接口，而不是一个类，并且无论如何都需要这样表示它。还是它成为一个标准，所以我应该接受它并停止试图通过建议以不同的方式来挑起“宗教战争”？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-10-21T16:19:56.957

从框架设计指南书：

> 表示层次结构根的接口（例如 IList）也应该使用名词或名词短语。表示能力的接口应该使用形容词和形容词短语（例如 IComparable、IFormattable）。

另外，从接口命名的注释中：

> KRZYSZTOF CWALINA：少数使用的前缀之一是“I”表示接口（如在 ICollection 中），但这是出于历史原因。回想起来，我认为使用常规类型名称会更好。例如，在大多数情况下，开发人员并不关心某个东西是接口而不是抽象类。
> 
> BRAD ABRAMS：另一方面，接口上的“I”前缀清楚地认识到 COM（和 Java）对 .NET Framework 的影响。COM 普及甚至制度化了接口以“I”开头的符号。尽管我们讨论了与这种历史模式不同的问题，但我们决定继续使用这种模式，因为我们的许多用户已经熟悉 COM。
> 
> JEFFREY RICHTER：就个人而言，我喜欢“I”前缀，我希望我们有更多这样的东西。小的单字符前缀对保持代码简洁和描述性大有帮助。正如我之前所说，我对私有类型字段使用前缀，因为我发现这非常有用。
> 
> BRENT RECTOR 注意：这实际上是匈牙利符号的另一种应用（尽管没有符号在变量名中使用的缺点）。

它已经成为一种广泛采用的标准，虽然它是匈牙利语的一种形式，正如 Brent 所说，但它没有在变量名中使用匈牙利语表示法的缺点。

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2008-10-21T16:19:25.740

老实说，我会接受它。我知道您所说的有点像匈牙利符号（或至少滥用相同符号）是什么意思，但我认为在这种情况下它具有足够的价值值得做。

随着依赖注入的流行，我经常发现我最终得到了一个接口和一个单一的生产实现。只需使用 I 前缀就可以很方便地区分它们。

一个小数据点：我大量使用 Java 和 C#，并且我经常发现自己必须检查 Java 中的哪些类型实际上是接口，尤其是在集合框架周围。.NET 让这一切变得简单。也许它不会打扰其他人，但它会打扰我。

我为 IFoo +1。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2008-10-21T16:20:15.177

作为一个 .NET 程序员（在大多数情况下），我实际上更喜欢 Java 约定将其删除`I`，原因很简单：通常，小的重新设计需要从接口更改为抽象基类，反之亦然。如果您必须更改名称，这可能需要进行大量不必要的重构。

另一方面，客户端的使用应该是透明的，因此他们不应该关心这种类型的提示。此外，“Thingable”中的“able”后缀应该足够暗示了。它在 Java 中运行良好。

/编辑：我想指出，上述推理促使我放弃了`I`私人项目的前缀。但是，根据 FxCop 规则集检查其中一个后，我立即恢复使用`I`. 一致性在这里获胜，*即使[愚蠢的一致性是小头脑的妖精](http://www.bartleby.com/100/420.47.html)*。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-21T16:18:00.627

它的所有关于**样式**和**可读性**。在接口前加上“I”只是一种流行的命名约定和风格指南。编译器本身并不在乎。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2013-08-01T13:53:33.650

我的主要假设是，最重要的是保持实现的域部分的可读性。所以：

*   如果您有一种行为和一种可能的实现，那么就不要创建接口：

    `public class StackOverflowAnswerGenerator { }`

*   如果您有一种行为和许多可能的实现，那么没有问题，您可以删除“I”，并拥有：

    `public interface StackOverflowAnswerGenerator {}`

    `public class StupidStackOverflowAnswerGenerator : StackOverflowAnswerGenerator {}`

    `public class RandomStackOverflowAnswerGenerator : StackOverflowAnswerGenerator {}`

    `public class GoogleSearchStackoverflowAnswerGenerator : StackOverflowAnswerGenerator {}`

    `//...`

*   当您有一种行为和一种可能的实现时，真正的问题就出现了，但您需要一个接口来描述其行为（例如，为了方便测试，由于项目中的约定，使用一些强制执行此操作的库/框架，...）。可能的解决方案，除了为接口添加前缀之外，还有：

    **a）**为实现添加前缀或后缀（如本主题的其他一些答案中所述）

    **b)**为接口使用不同的命名空间：

    ```
    namespace StackOverflowAnswerMachine.Interfaces 
    {
      public interface StackOverflowAnswerGenerator {}
    }

    namespace StackOverflowAnswerMachine 
    { 
      public class StackOverflowAnswerGenerator : Interfaces.StackOverflowAnswerGenerator
    {}

    } 
    ```

    **c)**使用不同的命名空间进行实施：

    ```
    namespace StackOverflowAnswerMachine 
    {
      public interface StackOverflowAnswerGenerator {}
    }

    namespace StackOverflowAnswerMachine.Implementations 
    { 
      public class StackOverflowAnswerGenerator : StackOverflowAnswerMachine.StackOverflowAnswerGenerator 
    {}

    } 
    ```

尽管我认为最后一种可能性是最干净的，但它的一个缺点是即使`using StackOverflowAnswerMachine;`您可以访问所有域对象，您也必须为所有域接口添加前缀，以免与它们的实现混淆。这可能感觉不是很方便，但在干净的设计中，通常一个类不使用许多其他域对象，并且大多数情况下您只需要在字段声明和构造函数参数列表中使用前缀。所以，这是我目前的建议。

域功能的客户端不需要知道他们使用的是接口、抽象类还是具体类。如果他们需要知道这一点，那么在这样的项目中就会出现一些严重的问题，因为它在同一个抽象层上混合了领域逻辑和基础设施问题。因此我推荐“ **a** ”或“ **c** ”解决方案。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-21T16:16:47.010

Symbian 的编码标准具有用 M 而不是 I 表示的接口（纯抽象 C++ 类）。

否则，我见过的表示接口的唯一其他方式是通过上下文。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-21T16:17:42.187

对于 .NET，Microsoft 的框架设计指南一书绝对推荐它，是的，它非常标准。我从来没有见过它这样做，创建一个新的公约只会使人们感到困惑。

我应该补充一点，我也不喜欢匈牙利符号，但是这种情况以及在类变量前加下划线的情况对我来说是一个很好的例外，因为它们使代码更具可读性。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-05T20:24:28.910

我一直认为这种命名约定有点像恐龙。如今，IDE 已经足够强大，可以告诉我们某物是一个接口。补充一点，我会使代码更难阅读，所以如果你真的想要一个将接口与类分开的命名约定，我会将 Impl 附加到实现类的名称中。

```
public class CustomerImpl implements Customer 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-04-01T14:10:11.443

您要求另一种选择，所以这是我遇到的一种：

在接口类上**不**使用前缀，但在相应的具体类上使用**c**或**C前缀。**您的大多数代码通常会引用接口，所以为什么要使用前缀而不是通常使用较少的具体类型来污染它。

这种方法确实引入了一个不一致之处，即某些具体类型将被添加前缀（具有匹配接口的类型）而其他类型则不会。这可能很有用，因为它提醒开发人员存在接口，并且应该优先使用它而不是具体类型。

老实说，*我*在界面上使用了前缀，但我认为更多是因为我已经习惯和习惯了它。

# java - Java可以删除到回收站吗？

> ID：222463
> 
> 赞同：35
> 
> 时间：2008-10-21T16:14:02.600
> 
> 标签：java, recycle-bin

**Java**是这里的关键。我需要能够删除文件，但用户希望能够从回收站中“取消删除”。据我所知，这是不可能的。其他人知道吗？

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2018-01-16T14:56:50.667

十年后，在 Java 9 中，终于有了一种将文件移动到垃圾箱的内置方法

[`java.awt.Desktop.moveToTrash(java.io.File)`](https://docs.oracle.com/javase/9/docs/api/java/awt/Desktop.html#moveToTrash-java.io.File-)：

> ### `public boolean moveToTrash​(File file)`
> 
> 将指定的文件移动到垃圾箱。
> 
> ### 参数：
> 
> 文件 - 文件
> 
> ### 回报：
> 
> 如果成功将文件移动到垃圾箱，则返回 true。

可以使用`Desktop.isSupported​(Desktop.Action.MOVE_TO_TRASH)`.

* * *

## 回答 #2

> 赞同：26
> 
> 时间：2008-10-21T16:33:40.827

由于各种原因，Windows[没有仅对应于回收站的文件夹的概念](http://blogs.msdn.com/oldnewthing/archive/2008/09/18/8956382.aspx)。

正确的方法是使用 JNI 调用 Windows `SHFileOperation`API，在结构中设置`FO_DELETE`标志。`SHFILEOPSTRUCT`

*   [SHFileOperation 文档](http://msdn.microsoft.com/en-us/library/bb762164(VS.85).aspx)
*   [使用 SHFileOperation 复制文件的 Java 示例](http://www.jroller.com/ethdsy/entry/using_windows_explorer_copy)（同一篇文章中的回收站链接不起作用）

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2018-11-20T07:50:53.277

Java 9 有新方法，但就我而言，我仅限于 Java 8。我发现**Java Native Access Platform**具有**hasTrash()**和**moveToTrash()**方法。我为我在 Win 10 和 Mac OS (Worked) 上测试了它。

```
static boolean moveToTrash(String filePath) {
        File file = new File(filePath);

        FileUtils fileUtils =  FileUtils.getInstance();
        if (fileUtils.hasTrash()) {

            try {
                fileUtils.moveToTrash(new File[] { file });
                return true;
            } catch (IOException e) {
                e.printStackTrace();
                return false;
            }
        } else {
            System.out.println("No Trash");
            return false;
        }
    } 
```

Maven 存储库 [https://mvnrepository.com/artifact/net.java.dev.jna/jna-platform/5.1.0](https://mvnrepository.com/artifact/net.java.dev.jna/jna-platform/5.1.0)

不要混淆它是**Java Native Access 平台**而不是 Java Native Access

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-21T16:38:27.167

我在 suns 网站上找到了这个 RFE： [http ://bugs.sun.com/bugdatabase/view_bug.do?bug_id=5080625](http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=5080625)

这告诉我没有本地 Java 方法可以做到这一点。正如@John Topley 刚刚发布的那样，唯一的解决方案是 JNI 调用。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-09-30T12:20:50.823

请参阅[fileutil](https://jdic.dev.java.net/incubator/fileutil/index.html)孵化器项目（[Java 桌面集成组件](https://jdic.dev.java.net/)项目的一部分）：

> 创建这个孵化器项目是为了托管这些文件实用程序功能，其中大部分是对 J2SE 中 java.io.File 类的扩展。Java 开发人员经常要求此类功能，例如：**将文件发送到垃圾箱**、检查可用磁盘空间、访问文件属性等。这个项目解决了这些经常请求的 API。

请注意，这不仅适用于 Windows，还适用于其他平台（Linux、Mac OS X）。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-11-26T00:53:17.047

[这是使用 SHFileOperation 将文件发送到回收站的示例](http://www.jroller.com/ethdsy/entry/send_to_recycle_bin)的正确链接。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-21T17:58:06.540

正如 John Topley 所建议的，您必须使用本机操作来执行此操作。如果您不想弄脏一些 JNI，您可以使用一个名为[Java Native Access](https://github.com/twall/jna/)的库来执行本机调用。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2017-06-24T14:18:26.253

我的 3 美分 - 使用 cmd util [Recycle.exe](http://www.maddogsw.com/cmdutils/)和 -f 强制回收（无提示）。完美运行。

```
public class Trash {

    public void moveToTrash(File ... file) throws IOException {
        moveToTrash(false, file);
    }

    public void promptMoveToTrash(File ... file) throws IOException {
        moveToTrash(true, file);
    }

    private void moveToTrash(boolean withPrompt, File ... file) throws IOException {
        String fileList = Stream.of(file).map(File::getAbsolutePath).reduce((f1, f2)->f1+" "+f2).orElse("");
        Runtime.getRuntime().exec("Recycle.exe "+(withPrompt ? "" : "-f ")+fileList);
    }

} 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2019-07-24T09:23:32.103

在 JNA 平台中，`FileUtils`不使用 Win32 API。您应该更喜欢`W32FileUtils`哪个支持撤消（从回收站恢复文件）。

*编辑：从 JNA 平台 (5.7.0) 的当前版本开始，使用 FileUtils.getInstance()，此语句已变得不正确，并且 FileUtils 将使用 Win32 API。*

# ruby-on-rails - Ruby On Rails 中带有 ActiveScaffold 的复合键

> ID：222464
> 
> 赞同：1
> 
> 时间：2008-10-21T16:14:07.153
> 
> 标签：ruby-on-rails, ruby, database, activescaffold

我正在开发与旧数据库一起使用的 RoR 应用程序，并将 ActiveScaffold 插件用于精美的 CRUD 界面。

但是，我的旧数据库的一张表具有复合主键。我尝试使用 Composite Keys 插件来处理它，但它似乎与 ACtiveScaffold 有冲突：我收到以下错误：

```
ActionView::TemplateError (Could not find column contact,type) on line #3 of ven
dor/plugins/active_scaffold/frontends/default/views/_form.rhtml:
1: <ol class="form" <%= 'style="display: none;"' if columns.collapsed -%>>
2:   <% columns.each :for => @record do |column| -%>
3:   <% if is_subsection? column -%>
4:   <li class="sub-section">
5:     <h5><%= column.label %> (<%= link_to_visibility_toggle(:default_visible =
> !column.collapsed) -%>)</h5>
6:     <%= render :partial => 'form', :locals => { :columns => column } %>

vendor/plugins/active_scaffold/lib/data_structures/sorting.rb:16:in `add' 
```

在模型代码中，例如：

```
set_primary_keys :contact, :type 
```

我非常感谢任何想法如何使用 ActiveScaffold 获得复合键功能。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-21T17:18:12.470

我认为您最好的选择可能是检查[ActiveScaffold Google Group](http://groups.google.com/group/activescaffold)，因为它由 ActiveScaffold 的核心开发人员监控，他们最终将能够解决您的问题并解释为什么带有插件的复合键不适用于 ActiveScaffold。

祝你好运，如果您确实从 Google 群组中获得了结果（我之前已经发布过并且很快收到了反馈），请务必发布后续内容。

我发现的一个快速结果是[这个](http://groups.google.com/group/activescaffold/browse_thread/thread/c463d4b789ba6f80/a1e30f49db936250?lnk=gst&q=composite#a1e30f49db936250)。

> 我所做的是创建一个不从
> ActiveRecord 继承的外观类，然后使“id”显示主键。在我的例子中，
> 主键是根据其他数据计算出来的，并且可能会因
> 编辑而改变，所以我必须在几个地方覆盖 ActiveScaffold 以
> 允许在更新后更改主键。但是，总而言之，
> 它有效并且相当简单。从一个空类开始
> ，只解决不理解的消息。在您的情况下，您
> 甚至可以将所有消息重定向到包装的 ActiveRecord，同时
> 替换 id 和 id= 方法，并过滤 [] 和 []= 方法。

这可能对你有用。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-27T10:30:14.187

不，我没有收到小组的任何回复，我不确定 ActiveScaffold 是否正在积极维护。

在玩了一段时间的 ActiveScaffold 之后，我最终从头实现了自己的 CRUD 接口。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-10-05T22:11:32.357

我有这个工作，只读模型，在遗留数据库上使用 ActiveScaffold。

诀窍是覆盖模型中的默认“id”字段并返回连接的 PK 字符串。

如果这足够好，那么你去：

```
 class CPKReadonlyModel < ActiveRecord::Base
    set_primary_key :id_one # only half of it, but id overridden below...

    def id
      self.id_one.to_s + ',' + self.id_two.to_s
    end

    def readonly?
      true
    end

    def before_destroy
      raise ActiveRecord::ReadOnlyRecord
    end

    def delete
      raise ActiveRecord::ReadOnlyRecord
    end

    def self.delete_all
      raise ActiveRecord::ReadOnlyRecord
    end
  end 
```

控制器在 active_scaffold 配置块中有以下内容：

```
 config.actions.exclude :create, :update, :delete 
```

# c# - 有效复制多个文件

> ID：222470
> 
> 赞同：10
> 
> 时间：2008-10-21T16:15:30.770
> 
> 标签：c#, .net, file, copy

我必须将很多文件从一个文件夹复制到另一个文件夹。目前我正在这样做：

```
string[] files = Directory.GetFiles(rootFolder, "*.xml");
foreach (string file in files)
{
    string otherFile = Path.Combine(otherFolder, Path.GetFileName(file));
    File.Copy(file, otherFile);
} 
```

这是最有效的方法吗？似乎需要很长时间。

编辑：我真的在问是否有更快的方法来进行批量复制，而不是复制单个文件，但我想答案是否定的。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-21T16:32:04.340

我想不出比 File.Copy 更有效的方法，它直接进入操作系统。

另一方面，如果需要那么长时间，我强烈建议显示一个进度对话框 - 就像[SHFileOperation](http://msdn.microsoft.com/en-us/library/bb762164(VS.85).aspx)为你做的那样。至少您的用户会知道发生了什么。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-21T16:24:20.003

您可以使用操作系统来移动文件。这就是 WinMerge 之类的工具所做的。您单击应用程序中的“复制”按钮，它会弹出 Windows 进度框，就像您使用资源管理器排列副本一样。[这个线程](http://www.microsoft.com/communities/newsgroups/en-us/default.aspx?dg=microsoft.public.dotnet.languages.csharp&tid=89d90929-c087-4b5a-a885-13d41ad37b82&cat=&lang=en&cr=US&sloc=&p=1)描述了它。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-21T17:30:09.623

我最近在 VB .NET 中使用文件流实现了我的文件副本：

```
fsSource = New FileStream(backupPath, FileMode.OpenOrCreate, FileAccess.Read, FileShare.None, 1024, FileOptions.WriteThrough)
fsDest = New FileStream(restorationPath, FileMode.OpenOrCreate, FileAccess.Write, FileShare.None, 1024, FileOptions.WriteThrough)
TransferData(fsSource, fsDest, 1048576)

    Private Sub TransferData(ByVal FromStream As IO.Stream, ByVal ToStream As IO.Stream, ByVal BufferSize As Integer)
        Dim buffer(BufferSize - 1) As Byte

        Do While IsCancelled = False 'Do While True
            Dim bytesRead As Integer = FromStream.Read(buffer, 0, buffer.Length)
            If bytesRead = 0 Then Exit Do
            ToStream.Write(buffer, 0, bytesRead)
            sizeCopied += bytesRead
        Loop
    End Sub 
```

更新进度条（使用 sizeCopied）并在需要时取消文件传输（使用 IsCancelled）似乎是一种快速且非常简单的方法。

# c++ - 在 Linux 中设置编程环境

> ID：222471
> 
> 赞同：24
> 
> 时间：2008-10-21T16:15:36.840
> 
> 标签：c++, c, linux, ide, development-environment

我最近开始使用 Linux 作为我的主要操作系统。在 Linux 中为 C 和 C++ 设置完整的编程环境需要哪些工具？

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-10-21T16:18:46.363

标准的东西：

*   编译工具、gcc、gdb等。
*   某种编辑器/IDE（emacs、vim、eclipse）
*   分析工具
*   源代码控制（SubVersion、git 等）
*   特定于语言的工具，例如 python 的 easy_install（你说的是 C/C++，但对所有东西都一样）
*   一个网络服务器可能吗？Apache、Lighttpd、nginx
*   您将使用的任何库。你在做内核黑客吗？驱动开发？开源的？

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-21T17:22:12.603

Among others you should also have gprof and valgrind ( or something in it's class ).

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-10-21T16:18:18.940

Vi（或 emacs）、 gcc 使
传统的 unix 开发比 ide 更命令行。有非常好的IDE，主要的大概是[eclipse](http://www.eclipse.org/home/categories/languages.php)和[kdevelop](http://www.kdevelop.org)

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-21T16:22:25.967

这取决于您对“完整编程环境”的定义，以及您使用的是 C、C++ 还是两者兼有（C/C++ 是一个不应该使用的糟糕术语。要么是 C，要么是 C++）。

如果您正在寻找 IDE，[Eclipse/CDT](http://www.eclipse.org/cdt/)是根据我的经验最强烈推荐的 IDE（我实际上没有使用任何 IDE，所以我无法提供第一手建议）。

If you can cope with command-line control (and in the end I find it makes things easier to do and doesn't take a whole lot of getting used to), a simple text editor with highlighting will suffice. I prefer KATE (part of KDE), as it features a built-in terminal as well as many features you would expect from an editor inside an IDE, like code folding and regex search/replace.

Many people also recommend Vim or Emacs, both of which are probably available through your distro's repositories. (Eclipse is probably available too, but in my experience the CDT is confusing to install via packages. YMMV). They are both ancient editors; and there is a powerful holy war between the two, so I won't get involved.

Your compiler should probably be GCC - on a Debian system, installing the g++ package as well as build-essential should be enough to get C++ going (build-essential should contain the gcc package required for C development). Whatever your distro, GCC is probably easily available or else already on your system.

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-10-21T16:27:28.593

Seconding swilliams, I'd say the basics are:

*   an editor or IDE (I use vim),
*   a compiler (almost certainly gcc)
*   make, or maybe some other similar tool like ant if you want
*   a debugger (almost certainly gdb)
*   source control (I use subversion)
*   Standard unix utilities like grep and diff, but you have those already

Other than that, I'd say install as you go. Linux is more about little utilities that each do one thing than monolithic development environments that do everything. So if you find yourself needing something, you can always just install it, be that thing a memory profiler, a documentation generator, a bigger/smaller/more different editor, et cetera, et cetera.

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-10-21T17:25:33.530

What distribution are you running?

In Ubuntu or any Debian based distribution you can issue the following command to install all the necessary tools.

```
sudo apt-get install build-essential 
```

From there you can install your SCM solution of choice and an IDE if you prefer or just use your favorite text editor.

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-21T16:17:53.060

最简单的答案是编辑器（任你选——至少已经有一个）和 gcc/g++。

如果您想要一个 IDE，那么在 SO 上会有很多与此相关的问题 :)（包括这个[用于 Linux 的 C++ IDE？](https://stackoverflow.com/questions/24109/c-ide-for-linux)）。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-21T16:29:36.297

Kdevelop is a well regarded and well written IDE for Linux, installing it *should* get you every other tool you might want to develop with installed as well and and IDE to go with it.

By "every other tool" I mean gcc, grep, diff, autoconf et al should be grabbed by the package manager and installed at the same time, but I could be wrong. I don't have a standard distro on hand to test that with.

Personally, I use vim, but I have used kdevelop in the past.

vim/vi is handy because you know that some form of vi is *always* available on *every* unix platform.

*   I have to correct my post. I just looked at the package requirements for kdevelop on ubuntu... it does NOT appear to require gcc and install it automatically

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-10-21T17:36:25.303

If you want something very easy to use, with ability to import visual studio projects, and a feel much like VS, give [Codeblocks](http://www.codeblocks.org) a try. Its quick ( since its not Java based ) and in general works well.

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-10-21T18:00:06.253

Another great utility that you can use are *nix man pages. Each function in the C library has an associated man page.

For example:

man printf

man strncpy

...

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-10-21T18:08:40.823

I took an old windows laptop with a dead hard drive and replaced the hard drive then installed Ubuntu (linux / debian all in one handy release) on it. I had to burn the ubuntu installation files onto a cd first on another working computer.

Here's where I got my linux from (complete with desktop gui, very easy to install, lots of programs to use, it was my first linux but not my first unix):

[http://www.ubuntu.com/getubuntu/download](http://www.ubuntu.com/getubuntu/download)

Then i installed Netbeans for my integrated development environment (IDE) altough I am using it for java -- but it comes with c++ support as shown below:

[http://www.netbeans.org/features/cpp/](http://www.netbeans.org/features/cpp/)

I also installed mySql, you didn't ask, but that is another key component that completes my development environment.

Good luck to you.

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-10-21T18:19:19.460

On most distros, everything you need will be installed by default (very few don't include gcc, they all include some kind of editor). I generally do my development in Vim (or gVim, which is the graphical version -- the best of both worlds). For those times when I'm feeling the need for a "real" IDE, Eclipse with the Vim plugin is really nice. It's almost like working in Vim, except you get the Eclipse stuff -- again, best of both worlds. The Vim plugin for Eclipse that I'm using is not free, however :( I believe there is a free one, but the last time I tried it, it wasn't very good.

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-10-21T19:05:48.697

Personally I use Ubuntu w/ Eclipse CDT. Eclipse is what most people might think of as a Java IDE, but CDT is a set of extensions that really tune it for C/C++ development. It's smart enough to figure out what toolset to use (MacOSX GCC vs Linux GCC, for example).

[Eclipse CDT Website](http://www.eclipse.org/cdt/ "Eclipse CDT website")

For best results, currently the 6.0 JRE for Ubuntu seems to have problems with recent Eclipse versions, so what I did was remove the 6.0 JRE and run:

> apt-get install build-essential sun-java5-jre sun-java5-bin

Then grab the latest Eclipse from the website, unpack it in a directory.

As a final touch, edit the eclipse.ini file that comes with Eclipse and add this line to it:

> -XX:CompileCommand=exclude,org/eclipse/core/internal/dtree/DataTreeNode,forwardDeltaWith

This will further stabilize the app, making it as rocksolid as Windows or Mac.

If you prefer commandline tools over GUI tools, some ones I use regularly:

*   [CMake](http://cmake.org/) -- Portable build tool. It's easy to use and can output a variety of formats like Makefiles or Visual Studio files.

> apt-get install cmake

*   [Vim](http://www.vim.org/) -- VI improved, if you want a text editor with some bells and whistles. Otherwise, just use 'nano', which comes with Ubuntu.

> apt-get install vim

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-12-30T11:45:24.993

Twe options, you must make your decision now and never look back, or risk being burned at the stake:

a. Emacs b. vi(m)

Do not listen to any rational arguments before choosting... listen to the light inside yourself...

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2009-01-09T21:44:17.367

Install a lot of bell a whistles for the editor you choose, vi is usable but no fun. vim is fun, but vim [with extras](http://www.vim.org/scripts/script_search_results.php?order_by=rating) is great.

(And the same is true for Emacs even if that means installing tetris and a doctor ;-) )

/Johan

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2012-11-24T02:47:30.810

Two must haves are guake and pithos. I cant see how any one can have a list of dev tools without these.

# asp.net - IIS 中缺少 ASP.NET 选项卡

> ID：222472
> 
> 赞同：6
> 
> 时间：2008-10-21T16:16:01.457
> 
> 标签：asp.net, iis, deployment, configuration

唔。我正在尝试将 Web 服务部署到新服务器并且没有 ASP.NET 选项卡。我试过 `aspnet_regiis`从 ASP.NET 2.0 目录运行，但这似乎不起作用。有什么想法吗？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-10-21T16:27:22.277

如果您已经（或已经...）在这台特定机器上安装了 VMware Server，那么以下步骤很可能会以最小的痛苦解决问题：

1.  停止 IISAdmin 服务（及其依赖项）
2.  `%windir%\system32\inetsrv\MetaBase.xml`在文本编辑器中打开
3.  删除读取的行`Enable32BitAppOnWin64="TRUE"`
4.  使用重新启动您的服务`iisreset /start`

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-21T16:17:55.337

您是否尝试卸载然后重新安装 ASP.NET？

IE

```
aspnet_regiis -u 
```

接着

```
aspnet_regiis -i 
```

卸载然后重新安装之前对我有用。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-10-21T16:21:02.180

IIS 的默认安装不包括 ASP 或 .Net。您需要在安装 IIS 的 Windows 功能菜单中启用这些功能。[这](http://www.visualwin.com/ASP.NET/)显示了基本步骤 - 它们可能因您的 IIS 版本和主机操作系统而异。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-10-21T16:30:44.140

这可能有多种原因，包括在 .NET Framework 或 IIS 元数据库损坏后安装 IIS。我的顺序是：

1.  **重新安装 ASP.NET**（如上所述：`aspnet_regiis -u`然后`aspnet_regiis -i`（在*Windows\Microsoft.NET\Framework\vX.YZ*目录中找到）
2.  **如果 #1 没有解决它，则重新安装 IIS**（使用 XP/2003 上的“添加/删除程序”或 Vista 上的“程序控制面板小程序”中的“添加/删除 Windows 组件”来删除/重新安装）

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-21T16:20:07.830

这是IIS6吗？我想你可以去

1.  添加/删除软件
2.  Windows 组件
3.  IIS
4.  确保选中 ASP.NET。我认为这安装了对 ASP.Net 的支持
5.  重新运行 aspnet_regiis

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2013-04-24T13:07:47.507

我通过以下步骤解决了我的问题：

> 1) 在“C:\Windows\System32\inetsrv”和子文件夹中设置必要的权限。
> 
> 2) 不要压缩这个文件夹、子文件夹或里面的文件。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-21T16:17:16.553

重新安装 IIS

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2012-06-13T20:30:52.207

我找到了正确的方法。巩固和总结 Windows 7 的方法。

1.  单击开始，然后单击控制面板。

2.  在控制面板中，单击程序，然后单击打开或关闭 Windows 功能。

3.  很重要！在 Windows 功能对话框中，单击 Internet 信息服务以安装默认功能，然后选择以下附加功能：

ASP.NET、.NET 扩展性、请求过滤、ISAPI、ISAPI 扩展 单击确定关闭 Windows 功能对话框。

4\. 要验证 IIS 是否安装成功，请在 Web 浏览器中键入以下内容：

```
http://localhost 
```

您应该会看到默认的 IIS 欢迎页面

5.使用 IIS 卸载 ASP.NET aspnet_regiis -u

6.重新安装aspnet_regiis -i。

7.重新安装 .NET framework 4 以便 IIS 识别应用程序池中的 v4。

参考：

[http://msdn.microsoft.com/en-us/library/k6h9cz8h.aspx](http://msdn.microsoft.com/en-us/library/k6h9cz8h.aspx)

[http://technet.microsoft.com/en-us/library/cc731252%28v=WS.10%29.aspx](http://technet.microsoft.com/en-us/library/cc731252%28v=WS.10%29.aspx)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2011-11-04T19:35:55.340

既然您说要设置新服务器，我假设它是 Windows Server 2008 (IIS7) 或 2008 R2 (IIS7.5)。在任何一种情况下，默认情况下都未配置 ASP.NET 支持（正如其他人所提到的）。查看以下文档：[部署 ASP.NEt 服务器 (IIS7)](http://technet.microsoft.com/en-us/library/cc731252%28v=WS.10%29.aspx)

# c# - 重构以消除 Lambda 表达式中的重复

> ID：222511
> 
> 赞同：6
> 
> 时间：2008-10-21T16:22:04.940
> 
> 标签：c#, refactoring, lambda

这两种方法表现出重复：

```
public static Expression<Func<Foo, FooEditDto>> EditDtoSelector()
{
    return f => new FooEditDto
    {
        PropertyA = f.PropertyA,
        PropertyB = f.PropertyB,
        PropertyC = f.PropertyC,
        PropertyD = f.PropertyD,
        PropertyE = f.PropertyE
    };
}

public static Expression<Func<Foo, FooListDto>> ListDtoSelector()
{
    return f => new FooDto
    {
        PropertyA = f.PropertyA,
        PropertyB = f.PropertyB,
        PropertyC = f.PropertyC
    };
} 
```

我该如何重构以消除这种重复？

更新：糟糕，我忽略了一个重点。FooEditDto 是 FooDto 的子类。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-21T16:33:00.080

好吧，我有一个*非常可怕*的方法可以做到。

您可以编写一个使用反射的方法（请耐心等待！）来计算特定类型的所有属性，并构建一个委托（使用 Reflection.Emit）将属性从该类型复制到另一个。然后使用匿名类型确保您只需要构建一次复制委托，因此速度很快。您的方法将如下所示：

```
public static Expression<Func<Foo, FooEditDto>> EditDtoSelector()
{
    return f => MagicCopier<FooEditDto>.Copy(new { 
        f.PropertyA, f.PropertyB, f.PropertyC, f.PropertyD, f.PropertyC
    });
} 
```

这里的细微差别：

*   MagicCopier 是泛型类型，Copy 是泛型方法，因此您可以显式指定“目标”类型，但隐式指定“源”类型。
*   它使用投影初始化器从用于初始化匿名类型的表达式中推断出属性的名称

我不确定它是否真的值得，但这是一个非常有趣的想法......无论如何我可能不得不实现它:)

编辑：使用[MemberInitExpression](http://msdn.microsoft.com/en-us/library/system.linq.expressions.memberinitexpression.aspx)，我们可以用表达式树来完成这一切，这比 CodeDOM 容易得多。今晚试一试...

编辑：完成，它实际上是非常简单的代码。这是课程：

```
/// <summary>
/// Generic class which copies to its target type from a source
/// type specified in the Copy method. The types are specified
/// separately to take advantage of type inference on generic
/// method arguments.
/// </summary>
public static class PropertyCopy<TTarget> where TTarget : class, new()
{
    /// <summary>
    /// Copies all readable properties from the source to a new instance
    /// of TTarget.
    /// </summary>
    public static TTarget CopyFrom<TSource>(TSource source) where TSource : class
    {
        return PropertyCopier<TSource>.Copy(source);
    }

    /// <summary>
    /// Static class to efficiently store the compiled delegate which can
    /// do the copying. We need a bit of work to ensure that exceptions are
    /// appropriately propagated, as the exception is generated at type initialization
    /// time, but we wish it to be thrown as an ArgumentException.
    /// </summary>
    private static class PropertyCopier<TSource> where TSource : class
    {
        private static readonly Func<TSource, TTarget> copier;
        private static readonly Exception initializationException;

        internal static TTarget Copy(TSource source)
        {
            if (initializationException != null)
            {
                throw initializationException;
            }
            if (source == null)
            {
                throw new ArgumentNullException("source");
            }
            return copier(source);
        }

        static PropertyCopier()
        {
            try
            {
                copier = BuildCopier();
                initializationException = null;
            }
            catch (Exception e)
            {
                copier = null;
                initializationException = e;
            }
        }

        private static Func<TSource, TTarget> BuildCopier()
        {
            ParameterExpression sourceParameter = Expression.Parameter(typeof(TSource), "source");
            var bindings = new List<MemberBinding>();
            foreach (PropertyInfo sourceProperty in typeof(TSource).GetProperties())
            {
                if (!sourceProperty.CanRead)
                {
                    continue;
                }
                PropertyInfo targetProperty = typeof(TTarget).GetProperty(sourceProperty.Name);
                if (targetProperty == null)
                {
                    throw new ArgumentException("Property " + sourceProperty.Name 
                        + " is not present and accessible in " + typeof(TTarget).FullName);
                }
                if (!targetProperty.CanWrite)
                {
                    throw new ArgumentException("Property " + sourceProperty.Name 
                        + " is not writable in " + typeof(TTarget).FullName);
                }
                if (!targetProperty.PropertyType.IsAssignableFrom(sourceProperty.PropertyType))
                {
                    throw new ArgumentException("Property " + sourceProperty.Name
                        + " has an incompatible type in " + typeof(TTarget).FullName);
                }
                bindings.Add(Expression.Bind(targetProperty, Expression.Property(sourceParameter, sourceProperty)));
            }
            Expression initializer = Expression.MemberInit(Expression.New(typeof(TTarget)), bindings);
            return Expression.Lambda<Func<TSource,TTarget>>(initializer, sourceParameter).Compile();
        }
    } 
```

并称它为：

```
TargetType target = PropertyCopy<TargetType>.CopyFrom(new { First="Foo", Second="Bar" }); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-21T17:01:58.650

如果`FooEditDto`是的子类`FooDto`并且您不需要 MemberInitExpressions，请使用构造函数：

```
class FooDto
 { public FooDto(Bar a, Bar b, Bar c) 
    { PropertyA = a;
      PropertyB = b;
      PropertyC = c;
    }
   public Bar PropertyA {get;set;}
   public Bar PropertyB {get;set;}
   public Bar PropertyC {get;set;}
 }

class FooEditDto : FooDto
 { public FooEditDto(Bar a, Bar b, Bar c) : base(a,b,c)
   public Bar PropertyD {get;set;}
   public Bar PropertyE {get;set;}
 }

public static Expression<Func<Foo, FooEditDto>> EditDtoSelector()
{
    return f => new FooEditDto(f.PropertyA,f.PropertyB,f.PropertyC)
    {
        PropertyD = f.PropertyD,
        PropertyE = f.PropertyE
    };
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-21T16:30:58.167

重复在名称中，但 C# 不知道一个类中的 PropertyA 与另一个类中的 PropertyA 连接。您必须明确地建立连接。你做的方式很好。如果您有足够的这些，您可能会考虑使用反射来编写一个可以为任何一对类执行此操作的方法。

请注意您选择的任何方法对性能的影响。反射本身较慢。但是，您也可以使用反射来发出 IL，一旦发出，它的运行速度与您编写的一样快。您还可以生成表达式树并将其转换为已编译的委托。这些技术有些复杂，因此您必须权衡取舍。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-21T16:44:49.340

您可以让调用者返回他们自己的匿名类型对象，只包含他们需要的属性：

```
public static Expression<Func<Foo,T>> 
                             GetSelector<T>(Expression<Func<Foo,T>> f)
 { return f;
 }

/* ... */
var expr = GetSelector(f => new{f.PropertyA,f.PropertyB,f.PropertyC}); 
```

# php - 如何检查 $_POST 中的可选字段

> ID：222520
> 
> 赞同：1
> 
> 时间：2008-10-21T16:25:59.970
> 
> 标签：php, forms, post

目前我的代码如下所示：

```
# Assign values for saving to the db
$data = array(
    'table_of_contents' => $_POST['table_of_contents'],
    'length' => $_POST['length']
);

# Check for fields that may not be set
if ( isset($_POST['lossless_copy']) )
{
   $data = array(
       'lossless_copy' => $_POST['lossless_copy']
    );
}

// etc. 
```

这会导致无穷无尽的 if 语句......即使使用三元语法，它仍然很混乱。有没有更好的办法？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-10-21T17:08:42.457

这个怎么样：

```
// this is an array of default values for the fields that could be in the POST
$defaultValues = array(
    'table_of_contents' => '',
    'length' => 25,
    'lossless_copy' => false,
);
$data = array_merge($defaultValues, $_POST);
// $data is now the post with all the keys set 
```

`array_merge()`将合并这些值，使后面的值覆盖前面的值。

如果你不想信任，`array_merge()`那么你可以做一个`foreach()`循环。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-21T16:57:21.670

```
foreach ($_POST as $key => $value) {
  $data[$key] = $value;
} 
```

记得清理你的 $_POST 值！

**编辑**：如果您希望将可选的 $_POST 值与表中可能存在或不存在的字段匹配，您可以执行以下操作（我假设您使用的是 mysql）：

```
$fields = array();
$table  = 'Current_Table';

// we are not using mysql_list_fields() as it is deprecated
$query  = "SHOW COLUMNS from {$table}";
$result = mysql_query($query);
while ($get = mysql_fetch_object($result) ) {
  $fields[] = $get->Field;
}

foreach($fields as $field) {
  if (isset($_POST[$field]) ) {
    $data[$field] = $_POST[$field];
  }
} 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-21T16:59:18.733

您可以构建一个可选字段数组：

```
$optional = array('lossless_copy', 'bossless_floppy', 'foo');
foreach ($optional as $field) {
    if (isset($_POST[$field])) {
        $data[$field] = $_POST[$field];
    }
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-21T17:04:34.290

```
$formfields = $_POST;
$data = array();
foreach(array_keys($formfields) as $fieldname){
  $data[$fieldname] = $_POST[$fieldname];
} 
```

这将添加所有返回的字段，包括提交。如果您需要知道复选框是否未被选中，您将不得不使用您发布的代码。如果你只关心被选中的复选框，你可以使用上面的代码。

这可能不适用于使用相同名称的多个表单域，例如单选按钮。

编辑：使用欧文的代码，它更干净，我的是同一件事的更详细的版本。

# c# - 将 sbyte 转换为 char 符合 cls

> ID：222521
> 
> 赞同：1
> 
> 时间：2008-10-21T16:26:36.317
> 
> 标签：c#

我有一个 C 库的 C# 包装器。它有一个方法可以返回一个代表字符的 sbyte。我可以使用 Convert.ToChar 但这不符合 CLS。将此 sbyte 转换为 char 的最佳实践是什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-21T16:36:23.117

System.Buffer.BlockCopy 可用于将 sbyte 数组转换为 byte 数组。然后，您可以使用 System.Text.ASCIIEncoding 将字节数组转换为 ASCII 文本。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-21T16:40:40.283

现在你改变了问题:) Sbyte 一开始就不符合 cls。使包装器使用字节。

# mysql - 如何在 MySQL 中搜索表的多个列？

> ID：222526
> 
> 赞同：0
> 
> 时间：2008-10-21T16:28:01.090
> 
> 标签：mysql, stored-procedures, autocomplete

给定一个名为“person”的表（在 MySQL 数据库/模式中），有点像这样：

```
code varchar(25)  
lastname varchar(25)  
firstname varchar(25) 
```

我正在尝试创建一个存储函数来接收“代码”或“代码”的一部分（当然，这是识别该人的代码）并返回具有相似代码的人的建议“列表”。

我不确定如何以**自动完成的方式**进行搜索，返回所有可能的结果（或仅返回五个）；以及如何从存储过程中返回这个人员“列表”。

知道我该怎么做吗？，谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-21T16:30:18.277

您可以在 SQL 中使用通配符。这是你想要的？

```
SELECT * FROM person WHERE code LIKE '%part_of_code%' 
```

# c# - IEnumerable 到 SelectList，没有选择任何值

> ID：222531
> 
> 赞同：15
> 
> 时间：2008-10-21T16:28:41.290
> 
> 标签：c#, asp.net-mvc

我在 ASP.NET MVC 应用程序中有如下内容：

```
IEnumerable<string> list = GetTheValues();
var selectList = new SelectList(list, "SelectedValue"); 
```

即使定义了选定的值，它也没有在视图上被选中。我有这种感觉，我在这里错过了一些东西，所以如果有人能把我的痛苦解救出来！

我知道我可以使用 annoymous 类型来提供键和值，但如果我不需要，我宁愿不添加额外的代码。

编辑：这个问题已经被 ASP.NET MVC RTM 修复了。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2012-03-21T19:02:49.173

如果您只是想将一个映射`IEnumerable<string>`到`SelectList`您可以这样内联：

```
new SelectList(MyIEnumerablesStrings.Select(x=>new KeyValuePair<string,string>(x,x)), "Key", "Value"); 
```

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-10-21T16:43:06.783

试试这个：

```
IDictionary<string,string> list = GetTheValues();
var selectList = new SelectList(list, "Key", "Value", "SelectedValue"); 
```

SelectList（至少在预览版 5 中）不够聪明，无法看到 IEnumerable 的元素是值类型，因此它应该将项目用于值和文本。相反，它将每个项目的值设置为“null”或类似的东西。这就是所选值无效的原因。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-19T18:12:47.257

看看这个：[ASP.NET MVC SelectList selectedValue Gotcha](http://replay.web.archive.org/20090628135923/http://blog.benhartonline.com/post/2008/11/24/ASPNET-MVC-SelectList-selectedValue-Gotcha.aspx)

这是对正在发生的事情的一个很好的解释。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2016-09-29T11:47:37.640

尝试这个

```
ViewBag.Items = list.Select(x => new SelectListItem() 
                              {
                                  Text = x.ToString()
                              }); 
```

# python - python正则表达式中'（？i）密码'的含义是什么？

> ID：222536
> 
> 赞同：6
> 
> 时间：2008-10-21T16:29:51.523
> 
> 标签：python, regex

Pexpect 可用于在 python 中自动执行任务（不需要安装 TCL）。此类中最简单的例程之一是“run()”例程。它接受预期问题模式的字典作为键和响应作为值。例如

pexpect.run ('scp foo myname@host.example.com:.', events={'(?i)password': mypassword})

我知道通常'？用于指示字符串中先前文字的 0 或 1 次出现（对于正则表达式）。不过，在这里，似乎不是这个意思。

专家可以评论它是什么吗？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-10-21T16:34:50.280

[https://docs.python.org/library/re.html#regular-expression-syntax](https://docs.python.org/library/re.html#regular-expression-syntax)

> (?...) 这是一个扩展符号（“（”后面的“？”没有意义）。“？”之后的第一个字符决定了构造的含义和进一步的语法。扩展通常做不创建新组；(?P...) 是此规则的唯一例外。以下是当前支持的扩展。
> 
> (?iLmsux) （集合“i”、“L”、“m”、“s”、“u”、“x”中的一个或多个字母。）组匹配空字符串；这些字母为整个正则表达式设置了相应的标志（re.I、re.L、re.M、re.S、re.U、re.X）。如果您希望将标志包含在正则表达式中，而不是将标志参数传递给 compile() 函数，这将非常有用。
> 
> 请注意， (?x) 标志会更改表达式的解析方式。它应该首先在表达式字符串中使用，或者在一个或多个空白字符之后使用。如果标志前有非空白字符，则结果未定义。

所以在这种情况下，字符串是一个正则表达式，并且设置为不区分大小写。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-21T16:43:07.110

这是 Python 的 re 模块中正则表达式语法的扩展。“i”表示“忽略大小写”。这意味着对“密码”进行了不区分大小写的搜索。

来自[https://docs.python.org/library/re.html#regular-expression-syntax](https://docs.python.org/library/re.html#regular-expression-syntax)

> (?iLmsux) （集合“i”、“L”、“m”、“s”、“u”、“x”中的一个或多个字母。）组匹配空字符串；这些字母为整个正则表达式设置了相应的标志（re.I、re.L、re.M、re.S、re.U、re.X）。如果您希望将标志包含在正则表达式中，而不是将标志参数传递给 compile() 函数，这将非常有用。
> 
> 请注意， (?x) 标志会更改表达式的解析方式。它应该首先在表达式字符串中使用，或者在一个或多个空白字符之后使用。如果标志前有非空白字符，则结果未定义。

# php - 其他具有类似 Xdebug 功能的软件包（信息性 PHP 错误、格式化的 var_dump()s 等）？

> ID：222544
> 
> 赞同：1
> 
> 时间：2008-10-21T16:31:26.277
> 
> 标签：php, xdebug

当安装/启用 Xdebug 时，标准 PHP 错误（当设置为在浏览器中显示时）被替换为包含每个堆栈跟踪的更多信息性消息。此外，我注意到它似乎还改善了其他领域的输出，例如 var_dump() 函数、对输出进行格式化/颜色编码以使其更具可读性。

是否有任何提供类似功能的第三方包？我倾向于使用 Zend Debugger 进行调试，并且很想找到类似这样的东西，它不依赖于 Xdebug。当然，我可以编写自己的错误处理程序、自定义 var_dump() 函数等，但我很想找到像 Xdebug 的功能那样透明地将自身集成到 PHP 中的东西。

**编辑：**我应该强调我不是在寻找调试器，而是在寻找 Xdebug 提供的“附加功能”。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-21T23:09:28.533

至于您的调试，无论您使用什么 IDE，您都只能通过 PHP 扩展找到访问权限。

Xdebug 是最受欢迎的，因为它具有超出您所描述的额外功能。Xdebug 将对 valgrind 格式进行分析（跟踪），您可以使用 Kcachegrind 和 wincachegrind 等程序进行评估。

您唯一可以替代 Xdebug 提供的调试工具的是 Zend Debugger，它是 Zend 平台的一部分（再次作为扩展提供）。

至于替换，您不会找到任何其他扩展来执行 var_dump 和错误报告替换。尤其是找不到（除了 Zend Debugger）调试协议，也绝对找不到任何其他进行分析的扩展。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-22T09:43:45.757

dBug 为 print_r 提供了相当不错的替代品：

[http://dbug.ospinto.com/](http://dbug.ospinto.com/)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-21T17:25:39.413

试试 NuSphere 的 PHP IDE。它也有一个集成的调试器，如果你愿意，你可以免费获得一个演示版本。

[http://www.nusphere.com/](http://www.nusphere.com/)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-03-30T13:38:00.473

我自己的`var_dump`替代方案的无耻插件：

[http://raveren.github.io/kint/](http://raveren.github.io/kint/)

截屏：

[![金特截图](https://i.stack.imgur.com/FhysN.png)](https://i.stack.imgur.com/FhysN.png)
[（来源：[github.io](https://raveren.github.io/kint/img/preview.png)）]

# javascript - 强制 Google Analytics 跟踪代码休眠

> ID：222551
> 
> 赞同：0
> 
> 时间：2008-10-21T16:33:14.277
> 
> 标签：javascript, google-analytics

要使用 Google Analytics，您需要在网页中添加一些 JavaScript 代码，该代码会在页面加载时向 Google 发出异步请求。

根据我的阅读，如果您在 HTML 正文结束之前直接包含它，则不应阻止或减慢页面加载时间。为了验证这一点，我想在一段时间后提出请求。用户应该能够登录到我的网站，无论它向 Google 发出请求需要多少时间，或者它是否完全返回（跟踪代码在登录页面上）。

Google 跟踪代码中有一个“pageTracker._trackPageview()”函数调用。这是将请求发送给 Google 的地方吗？

如果是这样，我应该这样做：

```
window.setTimeout(pageTracker._trackPageview(), 5000); 
```

任何帮助表示赞赏，特别是如果您使用过 Google Analytics 并遇到同样的问题。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-21T18:16:58.543

这应该有效：

```
window.setTimeout(pageTracker._trackPageview, 5000); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-21T16:50:39.640

`window.setTimeout(pageTracker._trackPageview(), 5000);`将立即调用代码 - 你想要的是

`window.setTimeout(function() { pageTracker._trackPageview(); }, 5000);`

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-21T16:39:00.723

那应该这样做。在电话周围加上一些引号：

```
window.setTimeout("pageTracker._trackPageview()", 5000); 
```

如果您想查看请求是否通过，可以使用 Firebug 进行检查。

# c++ - “安置新”有什么用？

> ID：222557
> 
> 赞同：476
> 
> 时间：2008-10-21T16:34:52.510
> 
> 标签：c++, memory-management, new-operator, placement-new

这里有人用过 C++ 的“placement new”吗？如果有，是为了什么？在我看来，它只对内存映射硬件有用。

* * *

## 回答 #1

> 赞同：425
> 
> 时间：2008-10-21T16:41:15.070

## Placement new 允许您在已分配的内存中构造一个对象。

当您需要构造一个对象的多个实例时，您可能希望这样做以进行优化，并且每次需要新实例时不重新分配内存会更快。相反，对可以容纳多个对象的内存块执行一次分配可能会更有效，即使您不想一次使用所有对象。

DevX 给出了一个[很好的例子](http://www.devx.com/tips/Tip/12582)：

> 标准 C++ 还支持放置 new 运算符，它在预分配的缓冲区上构造一个对象。这在构建内存池、垃圾收集器或仅在性能和异常安全至关重要时非常有用（由于内存已经分配，​​因此没有分配失败的危险，并且在预分配的缓冲区上构建对象需要更少的时间） ：

```
char *buf  = new char[sizeof(string)]; // pre-allocated buffer
string *p = new (buf) string("hi");    // placement new
string *q = new string("hi");          // ordinary heap allocation 
```

您可能还想确保在关键代码的某个部分（例如，在起搏器执行的代码中）不会出现分配失败。在这种情况下，您可能希望更早地分配内存，然后在临界区中使用新位置。

## 重新分配安置新

您不应该取消分配正在使用内存缓冲区的每个对象。相反，您应该只删除 [] 原始缓冲区。然后，您必须手动调用类的析构函数。有关这方面的好建议，请参阅 Stroustrup 的常见问题解答：[是否存在“展示位置删除”](http://www.stroustrup.com/bs_faq2.html#placement-delete)？

* * *

## 回答 #2

> 赞同：69
> 
> 时间：2008-10-21T16:52:56.653

我们将它与自定义内存池一起使用。只是一个草图：

```
class Pool {
public:
    Pool() { /* implementation details irrelevant */ };
    virtual ~Pool() { /* ditto */ };

    virtual void *allocate(size_t);
    virtual void deallocate(void *);

    static Pool::misc_pool() { return misc_pool_p; /* global MiscPool for general use */ }
};

class ClusterPool : public Pool { /* ... */ };
class FastPool : public Pool { /* ... */ };
class MapPool : public Pool { /* ... */ };
class MiscPool : public Pool { /* ... */ };

// elsewhere...

void *pnew_new(size_t size)
{
   return Pool::misc_pool()->allocate(size);
}

void *pnew_new(size_t size, Pool *pool_p)
{
   if (!pool_p) {
      return Pool::misc_pool()->allocate(size);
   }
   else {
      return pool_p->allocate(size);
   }
}

void pnew_delete(void *p)
{
   Pool *hp = Pool::find_pool(p);
   // note: if p == 0, then Pool::find_pool(p) will return 0.
   if (hp) {
      hp->deallocate(p);
   }
}

// elsewhere...

class Obj {
public:
   // misc ctors, dtors, etc.

   // just a sampling of new/del operators
   void *operator new(size_t s)             { return pnew_new(s); }
   void *operator new(size_t s, Pool *hp)   { return pnew_new(s, hp); }
   void operator delete(void *dp)           { pnew_delete(dp); }
   void operator delete(void *dp, Pool*)    { pnew_delete(dp); }

   void *operator new[](size_t s)           { return pnew_new(s); }
   void *operator new[](size_t s, Pool* hp) { return pnew_new(s, hp); }
   void operator delete[](void *dp)         { pnew_delete(dp); }
   void operator delete[](void *dp, Pool*)  { pnew_delete(dp); }
};

// elsewhere...

ClusterPool *cp = new ClusterPool(arg1, arg2, ...);

Obj *new_obj = new (cp) Obj(arg_a, arg_b, ...); 
```

现在您可以将对象聚集在一个内存区域中，选择一个非常快但不释放的分配器，使用内存映射以及您希望通过选择池并将其作为参数传递给对象的位置来施加的任何其他语义新运营商。

* * *

## 回答 #3

> 赞同：56
> 
> 时间：2008-10-21T16:40:18.787

如果您想将分配与初始化分开，这很有用。STL 使用placement new 来创建容器元素。

* * *

## 回答 #4

> 赞同：42
> 
> 时间：2008-10-21T17:58:47.240

我在实时编程中使用过它。我们通常*不想*在系统启动后执行任何动态分配（或解除分配），因为无法保证需要多长时间。

我能做的是预先分配一大块内存（大到足以容纳类可能需要的任何数量）。然后，一旦我在运行时弄清楚如何构造这些东西，就可以使用placement new 在我想要的位置构造对象。我知道我使用它的一种情况是帮助创建异构[循环缓冲区](http://en.wikipedia.org/wiki/Circular_buffer)。

这当然不适合胆小的人，但这就是为什么他们使它的语法有点粗糙的原因。

* * *

## 回答 #5

> 赞同：26
> 
> 时间：2008-10-21T16:51:40.557

我用它来构造通过 alloca() 在堆栈上分配的对象。

**无耻的插件：**我在[这里](https://web.archive.org/web/20141012042202/http://tlzprgmr.wordpress.com:80/2008/04/02/c-how-to-create-variable-length-arrays-on-the-stack/)写过博客。

* * *

## 回答 #6

> 赞同：14
> 
> 时间：2010-07-16T17:47:32.093

头怪：宾果！你完全明白了——这正是它的完美之处。在许多嵌入式环境中，外部约束和/或整体使用场景迫使程序员将对象的分配与其初始化分开。综合起来，C++ 称之为“实例化”；但是只要构造函数的操作必须在没有动态或自动分配的情况下显式调用时，placement new 就是这样做的方法。它也是定位固定到硬件组件地址（内存映射 I/O）的全局 C++ 对象的完美方式，或者对于无论出于何种原因必须驻留在固定地址的任何静态对象的位置。

* * *

## 回答 #7

> 赞同：13
> 
> 时间：2013-05-23T05:10:02.510

我用它来创建一个 Variant 类（即一个可以表示单个值的对象，该值可以是多种不同类型之一）。

如果 Variant 类支持的所有值类型都是 POD 类型（例如 int、float、double、bool），那么标记的 C 样式联合就足够了，但是如果您希望某些值类型是 C++ 对象（例如 std::string)，C 联合功能不会这样做，因为非 POD 数据类型可能不会被声明为联合的一部分。

因此，我分配了一个足够大的字节数组（例如 sizeof(the_largest_data_type_I_support)），并在 Variant 设置为保存该类型的值时使用placement new 来初始化该区域中的适当C++ 对象。（当然，当切换到不同的数据类型时，我会事先手动调用对象的析构函数）

* * *

## 回答 #8

> 赞同：13
> 
> 时间：2018-01-16T03:43:30.420

实际上，实现任何类型的数据结构都需要分配比插入元素数量的最低要求更多的内存（即，除了一次分配一个节点的链接结构之外的任何数据结构）。

`unordered_map`使用、`vector`或等容器`deque`。这些都分配了比您迄今为止插入的元素所需的最低内存更多的内存，以避免每次插入都需要堆分配。让我们`vector`作为最简单的例子。

当你这样做时：

```
vector<Foo> vec;

// Allocate memory for a thousand Foos:
vec.reserve(1000); 
```

......这实际上并没有构建一千个Foos。它只是为它们分配/保留内存。如果`vector`没有在这里使用placement new，它将在`Foos`所有地方进行默认构造，并且即使对于您从未插入过的元素也必须调用它们的析构函数。

**分配！=建设，释放！=破坏**

笼统地说，要实现上述许多数据结构，不能将分配内存和构造元素视为不可分割的一件事，同样不能将释放内存和销毁元素视为不可分割的一件事。

这些想法之间必须分开，以避免不必要地左右不必要地调用构造函数和析构函数，这就是为什么标准库将`std::allocator`（在分配/释放内存时不构造或销毁元素*）的想法与使用它的容器使用placement new 手动构造元素，并使用显式调用析构函数手动销毁元素。

> *   我讨厌的设计，`std::allocator`但这是一个不同的主题，我会避免咆哮。:-D

所以无论如何，我倾向于经常使用它，因为我编写了许多通用标准兼容的 C++ 容器，这些容器无法根据现有容器构建。其中包括我几十年前构建的一个小型向量实现，以避免在常见情况下进行堆分配，以及一个内存高效的 trie（一次不分配一个节点）。在这两种情况下，我都无法真正使用现有的容器来实现它们，因此我必须`placement new`避免在左右不必要的东西上过度调用构造函数和析构函数。

自然，如果您曾经使用自定义分配器来单独分配对象，例如空闲列表，那么您通常也希望使用`placement new`，就像这样（基本示例，它不会打扰异常安全或 RAII）：

```
Foo* foo = new(free_list.allocate()) Foo(...);
...
foo->~Foo();
free_list.free(foo); 
```

* * *

## 回答 #9

> 赞同：10
> 
> 时间：2013-04-05T00:45:23.903

序列化时放置 new 也非常有用（比如使用 boost::serialization）。在 10 年的 c++ 中，这只是我需要安置新的第二个案例（如果你包括面试，第三个 :)）。

* * *

## 回答 #10

> 赞同：9
> 
> 时间：2008-10-21T16:38:02.177

如果您正在构建内核，这很有用 - 您将从磁盘或页表中读取的内核代码放在哪里？你需要知道跳到哪里。

或者在其他非常罕见的情况下，例如当您有大量分配的空间并且想要将一些结构放在一起时。它们可以以这种方式打包，而不需要使用 offsetof() 运算符。不过，还有其他技巧。

我也相信一些 STL 实现使用了新的放置，比如 std::vector。他们以这种方式为 2^n 个元素分配空间，并且不需要总是重新分配。

* * *

## 回答 #11

> 赞同：9
> 
> 时间：2013-04-04T08:29:12.827

当您想要重新初始化全局或静态分配的结构时，它也很有用。

旧的 C 方法`memset()`用于将所有元素设置为 0。由于 vtables 和自定义对象构造函数，您无法在 C++ 中执行此操作。

所以我有时使用以下

```
 static Mystruct m;

 for(...)  {
     // re-initialize the structure. Note the use of placement new
     // and the extra parenthesis after Mystruct to force initialization.
     new (&m) Mystruct();

     // do-some work that modifies m's content.
 } 
```

* * *

## 回答 #12

> 赞同：9
> 
> 时间：2015-10-01T13:44:12.837

我认为任何答案都没有强调这一点，但是*新放置*的另一个很好的例子和用法是减少内存碎片（通过使用内存池）。这在嵌入式和高可用性系统中特别有用。在最后一种情况下，它特别重要，因为对于必须运行 24/365 天的系统来说，没有碎片非常重要。这个问题与内存泄漏无关。

即使使用了非​​常好的 malloc 实现（或类似的内存管理功能），也很难长时间处理碎片。在某些时候，如果您没有巧妙地管理内存预留/释放调用，您最终可能会出现许多难以重用的**小间隙（分配给新的预留）。**因此，在这种情况下使用的解决方案之一是使用内存池预先为应用程序对象分配内存。之后，每次您需要某个对象的内存时，您只需使用*新位置*在已保留的内存上创建一个新对象。

这样，一旦您的应用程序启动，您就已经保留了所有需要的内存。所有新的内存保留/释放都进入分配的池（您可能有多个池，一个用于每个不同的对象类）。在这种情况下不会发生内存碎片，因为不会有间隙，并且您的系统可以运行很长一段时间（数年）而不会受到碎片的影响。

我在实践中特别为 VxWorks RTOS 看到了这一点，因为它的默认内存分配系统受到很多碎片的影响。所以项目中基本禁止通过标准的new/malloc方法分配内存。所有的内存预留都应该去一个专用的内存池。

* * *

## 回答 #13

> 赞同：8
> 
> 时间：2008-10-21T16:38:15.093

我用它来存储带有内存映射文件的对象。
具体的例子是一个图像数据库，它处理了大量的大图像（超过内存容量）。

* * *

## 回答 #14

> 赞同：8
> 
> 时间：2008-10-21T16:41:04.683

使用它是`std::vector<>`因为通常分配的`std::vector<>`内存比.`objects``vector<>`

* * *

## 回答 #15

> 赞同：7
> 
> 时间：2008-10-21T20:23:06.153

我已经看到它被用作[“动态类型”指针的轻微性能黑客](http://www.codeproject.com/KB/cpp/dynamic_typing.aspx)（在“引擎盖下”部分）：

> 但这是我用来为小型类型获得快速性能的棘手技巧：如果所持有的值可以放入 void* 中，我实际上并不费心分配新对象，我使用placement new 将其强制放入指针本身.

* * *

## 回答 #16

> 赞同：6
> 
> 时间：2008-10-21T17:01:14.267

我用它来创建基于包含从网络接收到的消息的内存的对象。

* * *

## 回答 #17

> 赞同：5
> 
> 时间：2008-10-21T17:32:33.877

通常，放置新用于摆脱“正常新”的分配成本。

我使用它的另一个场景是我想访问指向仍然要构造的对象的*指针，以实现每个文档的单例。*

* * *

## 回答 #18

> 赞同：5
> 
> 时间：2012-08-28T20:52:39.517

在使用共享内存以及其他用途时，它可能会很方便......例如： http: [//www.boost.org/doc/libs/1_51_0/doc/html/interprocess/synchronization_mechanisms.html#interprocess.synchronization_mechanisms.conditions。 conditions_anonymous_example](http://www.boost.org/doc/libs/1_51_0/doc/html/interprocess/synchronization_mechanisms.html#interprocess.synchronization_mechanisms.conditions.conditions_anonymous_example)

* * *

## 回答 #19

> 赞同：4
> 
> 时间：2008-10-21T18:13:23.967

我遇到的一个地方是在容器中，它分配一个连续的缓冲区，然后根据需要用对象填充它。如前所述，std::vector 可能会这样做，而且我知道某些版本的 MFC CArray 和/或 CList 会这样做（因为那是我第一次遇到它的地方）。缓冲区过度分配方法是一种非常有用的优化方法，并且放置 new 几乎是在这种情况下构造对象的唯一方法。它有时也用于在直接代码之外分配的内存块中构造对象。

我以类似的身份使用过它，尽管它不经常出现。不过，它对于 C++ 工具箱来说是一个有用的工具。

* * *

## 回答 #20

> 赞同：4
> 
> 时间：2008-10-21T21:27:04.090

脚本引擎可以在本机接口中使用它来从脚本分配本机对象。有关示例，请参见 Angelscript (www.angelcode.com/angelscript)。

* * *

## 回答 #21

> 赞同：3
> 
> 时间：2011-01-26T20:03:32.353

[请参阅http://xll.codeplex.com](http://xll.codeplex.com)上的 xll 项目中的 fp.h 文件。它解决了喜欢随身携带尺寸的数组的“编译器毫无根据的笨拙”问题。

```
typedef struct _FP
{
    unsigned short int rows;
    unsigned short int columns;
    double array[1];        /* Actually, array[rows][columns] */
} FP; 
```

* * *

## 回答 #22

> 赞同：3
> 
> 时间：2018-07-30T02:00:02.263

这是 C++ 就地构造函数的杀手级用途：与缓存行对齐，以及 2 边界的其他幂。这是[我的超快速指针对齐算法，可使用 5 条或更少的单周期指令进行任意 2 次方边界](https://github.com/kabuki-starship/kabuki-toolkit/wiki/Fastest-Method-to-Align-Pointers)：

```
/* Quickly aligns the given pointer to a power of two boundary IN BYTES.
@return An aligned pointer of typename T.
@brief Algorithm is a 2's compliment trick that works by masking off
the desired number in 2's compliment and adding them to the
pointer.
@param pointer The pointer to align.
@param boundary_byte_count The boundary byte count that must be an even
power of 2.
@warning Function does not check if the boundary is a power of 2! */
template <typename T = char>
inline T* AlignUp(void* pointer, uintptr_t boundary_byte_count) {
  uintptr_t value = reinterpret_cast<uintptr_t>(pointer);
  value += (((~value) + 1) & (boundary_byte_count - 1));
  return reinterpret_cast<T*>(value);
}

struct Foo { Foo () {} };
char buffer[sizeof (Foo) + 64];
Foo* foo = new (AlignUp<Foo> (buffer, 64)) Foo (); 
```

现在这不只是让你脸上露出笑容吗（:-)。我♥♥♥ C++1x

* * *

## 回答 #23

> 赞同：1
> 
> 时间：2020-12-23T10:46:00.530

我也有一个想法。C++ 确实[有零开销原则](https://en.cppreference.com/w/cpp/language/Zero-overhead_principle)。但是异常不遵循这个原则，所以有时会用编译器开关来关闭它们。

让我们看一下这个例子：

```
#include <new>
#include <cstdio>
#include <cstdlib>

int main() {
    struct A {
        A() {
            printf("A()\n");
        }
        ~A() {
            printf("~A()\n");
        }
        char data[1000000000000000000] = {}; // some very big number
    };

    try {
        A *result = new A();
        printf("new passed: %p\n", result);
        delete result;
    } catch (std::bad_alloc) {
        printf("new failed\n");
    }
} 
```

我们在这里分配一个大的struct，检查分配是否成功，然后删除。

但是如果我们关闭了异常，我们就不能使用 try 块，并且无法处理 new[] 失败。

那么我们该怎么做呢？方法如下：

```
#include <new>
#include <cstdio>
#include <cstdlib>

int main() {
    struct A {
        A() {
            printf("A()\n");
        }
        ~A() {
            printf("~A()\n");
        }
        char data[1000000000000000000] = {}; // some very big number
    };

    void *buf = malloc(sizeof(A));
    if (buf != nullptr) {
        A *result = new(buf) A();
        printf("new passed: %p\n", result);
        result->~A();
        free(result);
    } else {
        printf("new failed\n");
    }
} 
```

*   使用简单的 malloc
*   检查是否以C方式失败
*   如果成功，我们使用placement new
*   手动调用析构函数（我们不能只调用delete）
*   免费调用，因为我们调用了 malloc

**UPD** [@Useless](https://stackoverflow.com/users/212858/useless)写了一条评论，让我看到了[new(nothrow)](https://en.cppreference.com/w/cpp/memory/new/nothrow)的存在，在这种情况下应该使用它，但不是我之前写的方法。请不要使用我之前写的代码。对不起。

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2021-01-04T16:35:25.597

我还有一个想法（它对 C++11 有效）。

让我们看下面的例子：

```
#include <cstddef>
#include <cstdio>

int main() {
    struct alignas(0x1000) A {
        char data[0x1000];
    };

    printf("max_align_t: %zu\n", alignof(max_align_t));

    A a;
    printf("a: %p\n", &a);

    A *ptr = new A;
    printf("ptr: %p\n", ptr);
    delete ptr;
} 
```

使用 C++11 标准，GCC 给出以下[输出](https://godbolt.org/z/xzMv6W)：

```
max_align_t: 16
a: 0x7ffd45e6f000
ptr: 0x1fe3ec0 
```

`ptr`未正确对齐。

使用 C++17 标准及更高版本，GCC 提供以下[输出](https://godbolt.org/z/4dzKnq)：

```
max_align_t: 16
a: 0x7ffc924f6000
ptr: 0x9f6000 
```

`ptr`正确对齐。

据我所知，C++ 标准在 C++17 出现之前不支持过度对齐的 new，如果你的结构的对齐大于`max_align_t`，你可能会遇到问题。要绕过 C++11 中的这个问题，您可以使用`aligned_alloc`.

```
#include <cstddef>
#include <cstdlib>
#include <cstdio>
#include <new>

int main() {
    struct alignas(0x1000) A {
        char data[0x1000];
    };

    printf("max_align_t: %zu\n", alignof(max_align_t));

    A a;
    printf("a: %p\n", &a);

    void *buf = aligned_alloc(alignof(A), sizeof(A));
    if (buf == nullptr) {
        printf("aligned_alloc() failed\n");
        exit(1);
    }
    A *ptr = new(buf) A();
    printf("ptr: %p\n", ptr);
    ptr->~A();
    free(ptr);
} 
```

`ptr`在这种情况下是[对齐的。](https://godbolt.org/z/exr476)

```
max_align_t: 16
a: 0x7ffe56b57000
ptr: 0x2416000 
```

* * *

## 回答 #25

> 赞同：-2
> 
> 时间：2020-09-15T01:36:35.217

> 这里有人用过 C++ 的“placement new”吗？如果有，是为了什么？在我看来，它只对内存映射硬件有用。

在需要复制时非常有用（作为输出传递）：

1.  **不可复制的**对象（例如：`operator=()`由于类包含`const`成员而被自动删除的位置）或
2.  **不可复制的**对象（其中 using`memcpy()`是未定义的行为）

...从一个函数中。

这（从函数中获取这些不可复制或不可复制的对象）可以帮助对该函数进行单元测试，方法是让您看到某个数据对象在被该函数处理后现在看起来是某种方式，或者它可以简单地成为您正常 API 的一部分，用于您认为合适的任何用途。让我们回顾一下这些例子，详细解释我的意思以及如何使用“新布局”来解决这些问题。

# TLDR；

*注意：我已经测试了这个答案中的每一行代码。有用。这是有效的。它不违反 C++ 标准。*

新的展示位置是：

1.  在 C++ 中替换`=`when `operator=()`（赋值运算符）被*删除*，并且您需要“复制”（实际上是复制构造）一个因此不可复制的对象到给定的内存位置。
2.  C++ 中的替换`memcpy()`当您的对象不是[trivially-copyable](https://en.cppreference.com/w/cpp/types/is_trivially_copyable)时，这意味着使用`memcpy()`来复制这个 non-trivially-copyable 对象[“可能是 undefined”](https://en.cppreference.com/w/cpp/string/byte/memcpy)。

*重要提示：“不可复制”对象并不是真正不可复制的。它根本不能通过`=`operator is all 复制，这是对类的底层`operator=()`重载函数的调用。这意味着当你这样做时`B = C;`，实际发生的是对的调用`B.operator=(C);`，而当你这样做时`A = B = C;`，实际发生的是调用`A.operator=(B.operator=(C));`。因此，“不可复制”对象只能通过其他方式复制，例如通过类的**复制*构造函数***，因为同样，该类没有`operator=()`方法。“Placement new”可用于调用类中可能存在的许多构造函数中的任何一个，以便将对象构造到所需的预分配内存位置。由于“placement new”语法允许调用类中的任何构造函数，这包括将一个现有的类实例传递给它，以便让placement new调用类的**复制构造函数**从传入的对象复制构造一个新对象到内存中的另一个位置。将一个对象复制构建到内存中的另一个位置……是一个副本。此操作会创建该原始对象的副本。完成后，您可以拥有两个对象（实例），它们是字节相同的，字面上是逐字节的（取决于您的复制构造函数的实现），位于内存中的两个不同位置。根据定义，那是一个副本。只是没有使用类的`operator=()`方法完成。*

*因此，如果一个类没有`operator=()`方法，则可以将其定义为“不可复制”，但根据 C++ 标准和 C++ 提供的机制，它仍然是非常可复制的，合法地，安全且没有未定义的行为，使用它的**复制构造函数**和**放置新**语法，如下所示。*

*提醒：下面的所有代码行都有效。* [您可以在此处运行大部分代码，包括。下面的许多代码块](https://onlinegdb.com/B1xBGjTEP)，尽管它可能需要一些注释/取消注释的代码块，因为它没有干净地设置为单独的示例。

# 1\. 什么是*不可复制*对象？

不可复制的对象不能用`=`操作符（`operator=()`函数）复制。就是这样！但是，它仍然可以合法复制。请参阅上面真正重要的说明。

**不可复制类示例 1：**

在这里，复制构造是可以的，但是复制是被禁止的，因为我们已经明确地删除了赋值运算符。尝试这样做会`nc2 = nc1;`导致此编译时错误：

> ```
> error: use of deleted function ‘NonCopyable1& NonCopyable1::operator=(const NonCopyable1&)’ 
> ```

这是完整的示例：

```
#include <stdio.h>

class NonCopyable1
{
public:
    int i = 5;

    // Delete the assignment operator to make this class non-copyable 
    NonCopyable1& operator=(const NonCopyable1& other) = delete;
};

int main()
{
    printf("Hello World\n");

    NonCopyable1 nc1;
    NonCopyable1 nc2;
    nc2 = nc1;   // copy assignment; compile-time error!
    NonCopyable1 nc3 = nc1; // copy constructor; works fine!

    return 0;
} 
```

**不可复制类示例 2：**

在这里，复制构造很好，但是禁止复制，因为该类包含一个`const`无法写入的成员（据说，因为显然有变通方法）。尝试这样做会`nc2 = nc1;`导致此编译时错误：

> ```
> error: use of deleted function ‘NonCopyable1& NonCopyable1::operator=(const NonCopyable1&)’
> note: ‘NonCopyable1& NonCopyable1::operator=(const NonCopyable1&)’ is implicitly deleted because the default definition would be ill-formed:
> error: non-static const member ‘const int NonCopyable1::i’, can’t use default assignment operator 
> ```

完整示例：

```
#include <stdio.h>

class NonCopyable1
{
public:
    const int i = 5; // classes with `const` members are non-copyable by default
};

int main()
{
    printf("Hello World\n");

    NonCopyable1 nc1;
    NonCopyable1 nc2;
    nc2 = nc1;   // copy assignment; compile-time error!
    NonCopyable1 nc3 = nc1; // copy constructor; works fine!

    return 0;
} 
```

**因此，如果一个类是不可复制的，您不能执行以下操作来获取它的副本作为输出！**该行将`outputData = data;`导致编译失败，并显示上面最后一个示例中显示的先前错误消息！

```
#include <functional>

#include <stdio.h>

class NonCopyable1
{
public:
    const int i; // classes with `const` members are non-copyable by default

    // Constructor to custom-initialize `i`
    NonCopyable1(int val = 5) : i(val) 
    {
        // nothing else to do 
    }
};

// Some class which (perhaps asynchronously) processes data. You attach a 
// callback, which gets called later. 
// - Also, this may be a shared library over which you have no or little 
// control, so you cannot easily change the prototype of the callable/callback 
// function. 
class ProcessData
{
public:
    void attachCallback(std::function<void(void)> callable)
    {
        callback_ = callable;
    }

    void callCallback()
    {
        callback_();
    }

private:
    std::function<void(void)> callback_;
};

int main()
{
    printf("Hello World\n");

    NonCopyable1 outputData; // we need to receive back data through this object
    printf("outputData.i (before) = %i\n", outputData.i); // is 5

    ProcessData processData;
    // Attach a lambda function as a callback, capturing `outputData` by 
    // reference so we can receive back the data from inside the callback via 
    // this object even though the callable prototype returns `void` (is a 
    // `void(void)` callable/function).
    processData.attachCallback([&outputData]()
        {
            int someRandomData = 999;
            NonCopyable1 data(someRandomData);
            // NOT ALLOWED SINCE COPY OPERATOR (Assignment operator) WAS 
            // AUTO-DELETED since the class has a `const` data member!
            outputData = data; 
        });
    processData.callCallback();
    // verify we get 999 here, NOT 5!
    printf("outputData.i (after) = %i\n", outputData.i); 

    return 0;
} 
```

**一种解决方案：将数据 memcpy 到`outputData`. 这在 C 中是完全可以接受的，但在 C++ 中并不总是可以的。**

Cppreference.com 状态（强调添加）：

> 如果对象可能重叠或**不是 TriviallyCopyable，**则未指定 memcpy 的行为并且**可能未定义。**

和：

> **注意**
> 不是潜在重叠子对象的普通可复制类型的对象是唯一可以使用 / 安全地复制或序列化到二进制文件的 C ++`std::memcpy`对象。`std::ofstream::write()``std::ifstream::read()`

（[https://en.cppreference.com/w/cpp/string/byte/memcpy](https://en.cppreference.com/w/cpp/string/byte/memcpy)）

因此，让我们保持安全并确保[在](https://en.cppreference.com/w/cpp/types/is_trivially_copyable)使用`memcpy()`. 替换上面的这部分：

```
 processData.attachCallback([&outputData]()
        {
            int someRandomData = 999;
            NonCopyable1 data(someRandomData);
            // NOT ALLOWED SINCE COPY OPERATOR (Assignment operator) WAS 
            // AUTO-DELETED since the class has a `const` data member!
            outputData = data; 
        }); 
```

有了这个。注意这次`memcpy()`复制数据的用法，并`std::is_trivially_copyable`确保在编译时使用`memcpy()`! 复制该类型确实是安全的：

```
 // (added to top)
    #include <cstring>  // for `memcpy()`
    #include <type_traits> // for `std::is_trivially_copyable<>()`

    // Attach a lambda function as a callback, capturing `outputData` by 
    // reference so we can receive back the data from inside the callback via 
    // this object even though the callable prototype returns `void` (is a 
    // `void(void)` callable/function).
    processData.attachCallback([&outputData]()
        {
            int someRandomData = 999;
            NonCopyable1 data(someRandomData);
            static_assert(std::is_trivially_copyable<NonCopyable1>::value, "NonCopyable1 must "
                "be a trivially-copyable type in order to guarantee that `memcpy()` is safe "
                "to use on it.");
            memcpy(&outputData, &data, sizeof(data));
        }); 
```

现在可以编译和运行示例程序输出。有用！

> ```
> Hello World
> outputData.i (before) = 5
> outputData.i (after) = 999 
> ```

但是，为了更加安全，您应该在覆盖之前手动调用要覆盖的对象的析构函数，如下所示：

最佳 MEMCPY() 解决方案：

```
 processData.attachCallback([&outputData]()
        {
            int someRandomData = 999;
            NonCopyable1 data(someRandomData);
            static_assert(std::is_trivially_copyable<NonCopyable1>::value, "NonCopyable1 must "
                "be a trivially-copyable type in order to guarantee that `memcpy()` is safe "
                "to use on it.");
            outputData.~NonCopyable1(); // manually call destructor before overwriting this object
            memcpy(&outputData, &data, sizeof(data));
        }); 
```

**但是，如果`static_assert()`上述方法失败，则不应使用`memcpy()`. 因此，一个*始终安全*且更好的 C++ 替代方案是使用“placement new”。**

在这里，我们只是简单地复制构造`data`到 . 占用的内存区域`outputData`。这就是“放置新”语法为我们所做的！它不像`new`操作员通常那样动态分配内存。通常，[`new`运算符](http://www.cplusplus.com/reference/new/operator%20new/) *首先*在堆上动态分配内存，*然后*通过调用对象的构造函数将对象构造到该内存中。但是，placement new 不会执行分配部分。*相反，它只是跳过该部分并在您指定的地址处*将对象构造到内存中！您必须是事先静态或动态分配该内存的人，并且您必须确保为该对象正确对齐内存（请参阅[`alignof`](https://en.cppreference.com/w/cpp/language/alignof)和[`alignas`](https://en.cppreference.com/w/cpp/language/alignas)以及此处的[Placement 新](https://en.cppreference.com/w/cpp/language/new)示例）（在这种情况下，因为我们明确地将对象创建`outputData`为对象，并使用 调用它的构造函数`NonCopyable1 outputData;`），并且您必须确保内存缓冲区/池足够大以容纳您的数据即将建成。

所以，通用放置新语法是这样的：

```
// Call`T`'s specified constructor below, constructing it as an object right into
// the memory location pointed to by `ptr_to_buffer`. No dynamic memory allocation
// whatsoever happens at this time. The object `T` is simply constructed into this
// address in memory.
T* ptr_to_T = new(ptr_to_buffer) T(optional_input_args_to_T's_constructor); 
```

在我们的例子中，它看起来像这样，调用类的*复制构造函数*，`NonCopyable1`我们已经在上面反复证明它是有效的，即使赋值/复制运算符被删除：

```
// copy-construct `data` right into the address at `&outputData`, using placement new syntax
new(&outputData) NonCopyable1(data); 
```

我们的最终`attachCallback`lambda 现在看起来像这样，用放置新语法代替`memcpy()`. 请注意，不再需要检查以确保对象可轻松复制。

===> 全面的最佳 C++ 解决方案——通过使用放置直接复制到目标内存位置来避免 MEMCPY 新：<==== 使用这个！====

```
 processData.attachCallback([&outputData]()
        {
            int someRandomData = 999;
            NonCopyable1 data(someRandomData);
            outputData.~NonCopyable1(); // manually call destructor before overwriting this object
            // copy-construct `data` right into the address at `&outputData`, using placement new syntax
            new(&outputData) NonCopyable1(data); 

            // Assume that `data` will be further manipulated and used below now, but we needed
            // its state at this moment in time. 

            // Note also that under the most trivial of cases, we could have also just called
            // out custom constructor right here too, like this. You can call whatever
            // constructor you want!
            // new(&outputData) NonCopyable1(999);

            // ...
        }); 
```

# 2\. 什么是*不可复制的*对象？

一个不可复制的对象可能是包含虚拟方法和事物的对象，因为这可能导致类必须跟踪“vee 指针”（`vptr`）和“vee 表”（`vtbl`s），以指向正确的虚拟实现记忆。在此处阅读更多相关信息：[Dobb 博士的“多态对象的存储布局”](https://www.drdobbs.com/cpp/storage-layout-of-polymorphic-objects/240012098)。但是，即使在这种情况下，只要您是`memcpy()`从同一个进程到同一个进程（即：在同一个虚拟内存空间内），而不是在进程之间，也不是从磁盘反序列化到 RAM，在我看来那`memcpy()`从技术上讲可以正常工作并且不会产生错误（我已经在一些示例中向自己证明了这一点），但从技术上讲，它似乎是 C++ 标准未定义的行为，因此它是未定义的行为，因此它从编译器到编译器，从一个版本的 C++ 到下一个版本，都不能 100% 依赖，所以……这是未定义的行为，`memcpy()`在这种情况下你不应该这样做。

换句话说，如果`static_assert(std::is_trivially_copyable<NonCopyable1>::value);`上面的检查失败，不要使用`memcpy()`. 您必须改用“新位置”！

使该静态断言失败的一种方法是在类定义中为您的`NonCopyable1`类简单地声明或定义自定义复制/赋值运算符，如下所示：

```
// Custom copy/assignment operator declaration:
NonCopyable1& operator=(const NonCopyable1& other);

// OR:

// Custom copy/assignment operator definition:
NonCopyable1& operator=(const NonCopyable1& other)
{
    // Check for, **and don't allow**, self assignment! 
    // ie: only copy the contents from the other object 
    // to this object if it is not the same object (ie: if it is not 
    // self-assignment)!
    if(this != &other) 
    {
        // copy all non-const members manually here, if the class had any; ex:
        // j = other.j;
        // k = other.k;
        // etc.
        // Do deep copy of data via any member **pointers**, if such members exist
    }

    // the assignment function (`operator=()`) expects you to return the 
    // contents of your own object (the left side), passed by reference, so 
    // that constructs such as `test1 = test2 = test3;` are valid!
    // See this reference, from Stanford, p11, here!:
    // http://web.stanford.edu/class/archive/cs/cs106b/cs106b.1084/cs106l/handouts/170_Copy_Constructor_Assignment_Operator.pdf
    //      MyClass one, two, three;
    //      three = two = one;
    return *this; 
} 
```

（有关自定义复制构造函数、赋值运算符等以及“三规则”和“五规则”的更多示例，请参阅[我的 hello world 存储库和示例](https://github.com/ElectricRCAircraftGuy/eRCaGuy_hello_world/blob/master/cpp/copy_constructor_and_assignment_operator/copy_constructor_and_assignment_operator.cpp)。）

所以，既然我们有了一个自定义赋值运算符，这个类就不再是简单可复制的了，这段代码：

```
 processData.attachCallback([&outputData]()
        {
            int someRandomData = 999;
            NonCopyable1 data(someRandomData);
            static_assert(std::is_trivially_copyable<NonCopyable1>::value, "NonCopyable1 must "
                "be a trivially-copyable type in order to guarantee that `memcpy()` is safe "
                "to use on it.");
            outputData.~NonCopyable1(); // manually call destructor before overwriting this object
            memcpy(&outputData, &data, sizeof(data));
        }); 
```

会产生这个错误：

> ```
> main.cpp: In lambda function:
> main.cpp:151:13: error: static assertion failed: NonCopyable1 must be a trivially-copyable type in order to guarantee that `memcpy()` is safe to use on it.
>              static_assert(std::is_trivially_copyable<NonCopyable1>::value, "NonCopyable1 must "
>              ^~~~~~~~~~~~~ 
> ```

所以，你必须/（真的应该）改用“placement new”，就像前面描述的那样：

```
 processData.attachCallback([&outputData]()
        {
            int someRandomData = 999;
            NonCopyable1 data(someRandomData);
            outputData.~NonCopyable1(); // manually call destructor before overwriting this object
            // copy-construct `data` right into the address at `&outputData`, using placement new syntax
            new(&outputData) NonCopyable1(data); 
        }); 
```

# 更多关于预分配缓冲区/内存池以供“放置新”使用

如果你真的只是要使用placement new来复制构造到内存池/共享内存/预分配的对象空间，那么就没有必要使用`NonCopyable1 outputData;`在我们必须稍后销毁的内存中构造一个无用的实例反正。相反，您可以只使用字节内存池。格式是这样的：

（来自：“安置新”部分：[https](https://en.cppreference.com/w/cpp/language/new) ://en.cppreference.com/w/cpp/language/new ）

```
// within any scope...
{
    char buf[sizeof(T)];  // Statically allocate memory large enough for any object of
                          // type `T`; it may be misaligned!
    // OR, to force proper alignment of your memory buffer for your object of type `T`, 
    // you may specify memory alignment with `alignas()` like this instead:
    alignas(alignof(T)) char buf[sizeof(T)];
    T* tptr = new(buf) T; // Construct a `T` object, placing it directly into your 
                          // pre-allocated storage at memory address `buf`.
    tptr->~T();           // You must **manually** call the object's destructor.
}                         // Leaving scope here auto-deallocates your statically-allocated 
                          // memory `buf`. 
```

所以，在我上面的例子中，这个静态分配的输出缓冲区：

```
// This constructs an actual object here, calling the `NonCopyable1` class's
// default constructor.
NonCopyable1 outputData; 
```

会变成这样：

```
// This is just a statically-allocated memory pool. No constructor is called.
// Statically allocate an output buffer properly aligned, and large enough,
// to store 1 single `NonCopyable1` object.
alignas(alignof(NonCopyable1)) uint8_t outputData[sizeof(NonCopyable1)];
NonCopyable1* outputDataPtr = (NonCopyable1*)(&outputData[0]); 
```

然后你会`outputData`通过`outputDataPtr`指针读取对象的内容。

前一种方法 ( `NonCopyable1 outputData;`) 是最好的，如果此类的构造函数不需要在创建此缓冲区时您无权访问的输入参数，*并且*如果您只打算将这一种数据类型存储到此缓冲区中，而后一种`uint8_t`缓冲区方法是最好的，如果您要么 A）无法访问甚至在您需要创建此缓冲区的位置构造对象所需的所有输入参数，或者 B）如果您计划将多种数据类型存储到这个内存池，可能用于以联合方式在线程、模块、进程等之间进行通信。

# 更多关于 C++ 以及为什么它让我们在这种情况下跳过这些障碍

因此，C++ 中的这整个“放置新”事物，以及对它的需求，花了我大量的研究和很长时间来围绕它。想了想，我突然想到，C （我来自哪里）的**范式是手动分配一些内存，然后把一些东西塞进去。**在处理静态和动态内存分配时，这些都是*单独*`struct`的操作（请记住：您甚至不能为s 设置默认值！）。没有构造函数或析构函数的概念，甚至获得基于作用域的析构函数的*行为*，该析构函数在变量退出给定作用域时自动调用，这很麻烦，并且需要一些花哨的 gcc 扩展`__attribute__((__cleanup__(my_variable)))`魔法[，因为我在我的回答中展示](https://arduino.stackexchange.com/questions/77494/which-arduinos-support-atomic-block/77579#77579). 然而，任意从一个对象复制到另一个对象是*非常容易的。*只需复制周围的对象！这与**C++ 的范式**形成对比，即[RAII（资源获取即初始化）](https://en.wikipedia.org/wiki/Resource_acquisition_is_initialization)。这种范式侧重于对象在*创建时就可以立即*使用。为了实现这一点，它们依赖于*构造函数*和*析构函数*。这意味着像这样创建一个对象：`NonCopyable1 data(someRandomData);`，不仅为该对象*分配内存*，它还*调用对象的*构造函数并将该对象构造（放置）到该内存中。它试图将多件事合二为一。所以，在 C++ 中，`memcpy()`并且赋值运算符 ( `=`; AKA: `operator=()`function) 更明显地受到 C++ 的性质的限制。这就是为什么我们必须在 C++ 中完成这个奇怪的“通过放置新的位置将我的对象复制到给定的内存位置”过程，而不是仅仅创建一个变量并稍后将内容复制到其中，或者稍后将内容`memcpy()`写入其中如果它包含一个`const`成员，就像我们在 C 中所做的那样。C++ 确实试图强制执行 RAII，这部分是他们这样做的方式。

# 您可以`std::optional<>::emplace()`改用

从 C++17 开始，您也可以将[`std::optional<>`](https://en.cppreference.com/w/cpp/utility/optional)其用作包装器。各种容器和包装器的现代 C++`emplace()`函数执行我们在上面使用“placement new”手动执行的操作（另请参见[我的回答here](https://stackoverflow.com/a/63895415/4561887)和关于`std::vector<T,Allocator>::emplace_back`“通常使用**placement-new**就地构造元素”的引用）。

`std::optional`静态分配一个足够大的缓冲区，以容纳您要放入其中的对象。然后它要么存储该对象，要么存储一个`std::nullopt`（与 相同`{}`），这意味着它不保存该对象。要将其中的一个对象替换为另一个对象，只需调用该对象的`emplace()`方法即可`std::optional`。[这将执行以下操作：](https://en.cppreference.com/w/cpp/utility/optional/emplace)

> 就地构造包含的值。如果`*this`在调用之前已经包含一个值，则通过调用其析构函数来销毁包含的值。

因此，它首先手动调用其中已经存在的现有对象的析构函数，如果现有对象已经在其中，那么它相当于“放置新”来复制构造一个新对象（您提供它）到那个内存空间。

所以，这个输出缓冲区：

```
NonCopyable1 outputData; 

// OR

alignas(alignof(NonCopyable1)) uint8_t outputData[sizeof(NonCopyable1)];
NonCopyable1* outputDataPtr = (NonCopyable1*)(&outputData[0]); 
```

现在变成了这样：

```
# include <optional>

std::optional<NonCopyable1> outputData = std::nullopt; 
```

并将此“放置新”复制构建到该输出缓冲区中：

```
processData.attachCallback([&outputData]()
    {
        int someRandomData = 999;
        NonCopyable1 data(someRandomData);
        outputData.~NonCopyable1(); // manually call destructor before overwriting this object
        // copy-construct `data` right into the address at `&outputData`, using placement new syntax
        new(&outputData) NonCopyable1(data); 
    }); 
```

现在成为该`emplace()`缓冲区中的新数据。请注意，*不再需要*手动调用析构函数，因为`std::optional<>::emplace()` *已经为我们处理了在任何已经存在的对象上调用析构函数*！：

```
processData.attachCallback([&outputData]()
    {
        int someRandomData = 999;
        NonCopyable1 data(someRandomData);
        // emplace `data` right into the `outputData` object
        outputData.emplace(data);
    }); 
```

现在，要从 中获取数据`outputData`，只需使用 取消引用它`*`，或调用`.value()`它。前任：

```
// verify we get 999 here!
if (outputData.has_value())
{
    printf("(*outputData).i (after) = %i\n", (*outputData).i);
    // OR 
    printf("outputData.value().i (after) = %i\n", outputData.value().i);
}
else 
{
    printf("outputData.has_value() is false!");
} 
```

样本输出：

> ```
> Hello World
> (*outputData).i (after) = 999
> outputData.value().i (after) = 999 
> ```

[在此处运行此完整示例代码](https://onlinegdb.com/B1xBGjTEP)。

# 参考资料和附加，优秀的阅读：

1.  *****+[一些我见过的最有用和最简单的“放置新”示例！] [https://www.geeksforgeeks.org/placement-new-operator-cpp/](https://www.geeksforgeeks.org/placement-new-operator-cpp/)
2.  [很好的例子] [https://en.cppreference.com/w/cpp/language/new](https://en.cppreference.com/w/cpp/language/new) --> 请参阅“新放置”部分和此处的示例！（我帮助编写了示例）。
3.  [如何使这个 C++ 对象不可复制？](https://stackoverflow.com/questions/2173746/how-do-i-make-this-c-object-non-copyable/2173764#2173764)
4.  [非常重要的一点是，在构造对象时调用放置新行会调用对象的构造函数！：第 3 行（`Fred* f = new(place) Fred();`）本质上只是调用构造函数`Fred::Fred()`。这意味着“构造函数`this`中的指针`Fred`将等于`place`”。] [http://www.cs.technion.ac.il/users/yechiel/c++-faq/placement-new.html](http://www.cs.technion.ac.il/users/yechiel/c++-faq/placement-new.html)
    1.  [http://www.cs.technion.ac.il/users/yechiel/c++-faq/memory-pools.html](http://www.cs.technion.ac.il/users/yechiel/c++-faq/memory-pools.html)
5.  [Dobb博士的《多态对象的存储布局》](https://www.drdobbs.com/cpp/storage-layout-of-polymorphic-objects/240012098)
6.  [C++“三法则”的良好的 pre-C++11 介绍] [http://web.stanford.edu/class/archive/cs/cs106b/cs106b.1084/cs106l/handouts/170_Copy_Constructor_Assignment_Operator.pdf](http://web.stanford.edu/class/archive/cs/cs106b/cs106b.1084/cs106l/handouts/170_Copy_Constructor_Assignment_Operator.pdf)
7.  我的“hello world”示例和存储库，演示自定义复制构造函数、赋值运算符等，与 C++“三规则”/“五规则”/“零规则”/“0/3/5 规则”相关“：[https ://github.com/ElectricRCAAircraftGuy/eRCaGuy_hello_world/blob/master/cpp/copy_constructor_and_assignment_operator/copy_constructor_and_assignment_operator.cpp](https://github.com/ElectricRCAircraftGuy/eRCaGuy_hello_world/blob/master/cpp/copy_constructor_and_assignment_operator/copy_constructor_and_assignment_operator.cpp)
8.  [微软关于 C++17 类型使用的*优秀*`std::optional<>`文章] [https://devblogs.microsoft.com/cppblog/stdoptional-how-when-and-why/](https://devblogs.microsoft.com/cppblog/stdoptional-how-when-and-why/)
9.  [相关，因为“放置新”也非常清楚地解决了这个问题，因为这个问题是我的大多数解决方案和示例背后的症结和驱动力！] [const 成员和赋值运算符。如何避免未定义的行为？](https://stackoverflow.com/questions/4136156/const-member-and-assignment-operator-how-to-avoid-the-undefined-behavior)

# c# - 与应用程序的文件类型关联 (C#)

> ID：222561
> 
> 赞同：10
> 
> 时间：2008-10-21T16:35:43.897
> 
> 标签：c#, .net, registry, file-type

我有几个相关的问题：

1）是否可以使我的程序更改文件类型关联但仅在运行时？你觉得这种行为有什么问题吗？

2）我看到的另一个选项是让用户决定使用我的应用程序打开或恢复默认关联......例如：“捕获所有 .lala 文件”或“恢复 .lala 关联”。我怎样才能做到这一点？您认为最好的方法是什么？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-21T16:51:51.027

关于文件关联，我之前写过一个答案，至少[涵盖了 "How"](https://stackoverflow.com/questions/212906/script-to-associate-an-extension-to-a-program#212921)。

这也应该为您指明如何处理备份和恢复的正确方向。通过 c# 直接访问注册表，无需使用 .reg 文件，因此您可以在应用程序中随意备份以前的值，也可以从那里恢复它。

这里的关键问题是：您*是否应该*随机更改文件关联？至少提前询问用户显然是必要的（正如您也指出的那样）。

此外，启用 UAC 的 Vista 用户或其他 Windows 版本的非特权用户可能没有更改全局文件关联所需的权限。您的程序的（卸载）安装过程可能是唯一可以成功的地方。

编辑

正如[Franci Penov 在他的回答中指出的那样](https://stackoverflow.com/questions/222561/filetype-association-with-application-c#222799)，有*一种*方法可以根据每个用户更改本地文件关联，即使对于非管理员也是如此（这就是我在上一段中谈到“全局关联”的原因）。他还提到了为什么去那里不太可取。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-21T17:54:33.770

您可以通过将小型可执行文件与该文件扩展名相关联来实现“即时”文件关联更改，该文件扩展名在启动时将检查您的主应用程序是否正在运行并将文件名传递给它，或者如果它没有运行，它将调用“常规”相关应用程序。

这种方法的主要优点是您只需要使用注册表一次。

这种方法的主要缺点是：

*   你需要一个辅助进程
*   “拥有”这些文件扩展名的应用程序可以检测到更改并向用户投诉，提示“修复”，从而使您摆脱困境。

或者，您可以在主程序启动时更改文件关联。这甚至适用于非管理员用户。虽然文件关联存储在 中`HKEY_CLASSES_ROOT`，但有一个小技巧 - HKCR 实际上是`HKEY_LOCAL_MACHINE\SOFTWARE\Classes`和`HKEY_CURRENT_USER\SOFTWARE\Classes`的映射 因此，您可以在 HKCU 中临时注册当前用户的文件扩展名，并从 HKLM 中“隐藏”原始关联。

当然，我建议不要使用这种方法，因为您的应用程序只需发生一次崩溃即可使该关联永久化，而且由于很少有应用程序知道如何处理 HKCU 中的文件关联，因此对于原始应用程序。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-21T16:45:35.047

它可能可以完成，但我认为它最终会很麻烦。所有文件类型关联都存储在注册表中，因此您必须在每次应用程序启动和停止时写入/恢复注册表项。此外，根据您执行此操作的频率，可能不会立即在 Windows 资源管理器中获取新关联。

这些关联在注册表中的 HKEY_CLASSES_ROOT 下列出，并且可以通过多种方式映射（mime 类型/progIDs/等）。

我见过的许多应用程序都会询问您是否想在安装期间将某些文件类型与应用程序相关联，并让您能够选择退出并保留当前设置。

我不认为我会推荐“即时”文件类型关联

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-21T16:46:51.050

1) 您可以定义打开对话框文件类型下拉列表中的文件类型。除此之外，*可以*在应用程序打开时更改文件类型默认值，然后在应用程序关闭期间替换，因为文件类型关联只是注册表设置。

至于错，我不会。第一个原因是它不是应用程序的标准行为。第二个原因是，如果您的应用程序或 PC 意外退出，您将面临无法将关联恢复到原始设置的风险。

2) 默认情况下，Windows 允许用户使用右键单击和“打开方式”命令来选择这些选项。

# .net - HttpBrowserCapabilities.Crawler 属性 .NET

> ID：222564
> 
> 赞同：8
> 
> 时间：2008-10-21T16:37:13.973
> 
> 标签：.net, web-crawler

HttpBrowserCapabilities.Crawler 属性 ( [http://msdn.microsoft.com/en-us/library/aa332775(VS.71).aspx](http://msdn.microsoft.com/en-us/library/aa332775(VS.71).aspx) ) 如何工作？我需要检测合作伙伴的自定义爬虫，并且此属性返回 false。

我在哪里/如何添加他的用户代理以便此属性返回 true？除了创建我自己的用户代理检测机制之外还有其他方法吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-21T16:57:05.273

这一切都由 .NET 框架中的默认 browsercaps 声明驱动。

要设置此特定爬虫，您需要将自定义 browserCaps 部分添加到 web.config 以将其标识为爬虫。

关于如何解决这个问题的 MSDN 文档非常有据可查，[这里是一个链接。](http://msdn.microsoft.com/en-us/library/sk9az15a.aspx)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-21T16:59:49.323

HttpBrowserCapabilities 由 C:\WINDOWS\Microsoft.NET\Framework\v2.0.50727\CONFIG\Browsers 中的一组 *.browser 文件填充。您可以在 ~/App_Browsers/ 中添加您自己的文件，其中包含自定义爬虫的详细信息。架构在[这里](http://msdn.microsoft.com/en-us/library/ms228122.aspx)。基本上，它包含一个正则表达式来匹配 User-Agent 标头和一组属性值。

# mysql - 你能推荐一个好的 MySQL 存储过程调试器吗？

> ID：222565
> 
> 赞同：3
> 
> 时间：2008-10-21T16:37:34.860
> 
> 标签：mysql, stored-procedures, debugging

你能推荐一个好的 MySQL 存储过程调试器吗？
**如果它是开源的，并且在 linux 中工作，则加分 :)**

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-21T16:43:48.983

它既不是开源软件（**而是免费软件**），也不能在 linux 中运行，但[Toad® for MySQL](http://www.toadsoft.com/toadmysql/)应该能够帮助您在 Windows 客户端上调试存储过程。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-22T00:11:00.797

我使用过[SQLYog MySQL 编辑器](http://www.webyog.com/en/sqlyog_feature_list.php)，它有一些不错的功能。不幸的是，它并不真正符合您的标准。虽然有一个社区版，所以它已经完成了一半。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-21T16:44:30.057

我不知道[这](http://www.quest.com/toad-for-mysql/)是否符合您的要求，但这是唯一想到的。

* * *

编辑：[这](http://mysql-debugger.safe-install.com/)也可能有帮助，但它并不完全符合免费或 Linux 上可用的测试。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-08-31T10:50:32.307

请尝试以下支持断点、调用堆栈、变量评估、监视任何例程（过程、函数甚至触发器）的 MySQL 调试器 [http://www.devart.com/dbforge/mysql/studio/code-debugger。 .html](http://www.devart.com/dbforge/mysql/studio/code-debugger.html) _

但是，不幸的是，它只能在 Windows 上运行。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-09-22T10:07:56.400

最好的 mysql 调试器在 dbForge Studio for MySQL 中！（恕我直言）

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-05-13T16:57:01.960

您可以尝试 Illatis StepIn，在 Windows 和 Linux 中调试 MySQL 存储过程。请参阅此页面：[http](http://www.illatis.com/downloads/downloads.php) ://www.illatis.com/downloads/downloads.php 。

干杯

# c# - 排序下拉列表？- C#，ASP.NET

> ID：222572
> 
> 赞同：35
> 
> 时间：2008-10-21T16:39:51.407
> 
> 标签：c#, asp.net, drop-down-menu

我很好奇在 C#/ASP.NET 中对 DropDownList 进行排序的最佳路线（更注重简单性，而不是速度或效率） - 我已经查看了一些建议，但它们并不适合我。

编辑：伙计们，我无法控制数据如何进入 DropDownList - 我无法修改 SQL。

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2008-10-22T23:55:06.070

如果你得到一个包含数据的 DataTable，你可以创建一个 DataView，然后将下拉列表绑定到那个。你的代码看起来像......

```
DataView dvOptions = new DataView(DataTableWithOptions);
dvOptions.Sort = "Description";

ddlOptions.DataSource = dvOptions;
ddlOptions.DataTextField = "Description";
ddlOptions.DataValueField = "Id";
ddlOptions.DataBind(); 
```

您的文本字段和值字段选项被映射到您收到的数据表中的相应列。

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2010-03-12T14:39:55.157

.NET 3.5 的 AC# 解决方案（需要 System.Linq 和 System.Web.UI）：

```
 public static void ReorderAlphabetized(this DropDownList ddl)
    {
        List<ListItem> listCopy = new List<ListItem>();
        foreach (ListItem item in ddl.Items)
            listCopy.Add(item);
        ddl.Items.Clear();
        foreach (ListItem item in listCopy.OrderBy(item => item.Text))
            ddl.Items.Add(item);
    } 
```

绑定下拉列表后调用它，例如 OnPreRender：

```
 protected override void OnPreRender(EventArgs e)
    {
        base.OnPreRender(e);
        ddlMyDropDown.ReorderAlphabetized();
    } 
```

将其粘贴在您的实用程序库中，以便于重复使用。

* * *

## 回答 #3

> 赞同：17
> 
> 时间：2008-10-22T23:45:52.203

假设您正在运行最新版本的 .Net Framework，这将起作用：

```
List<string> items = GetItemsFromSomewhere();
items.Sort((x, y) => string.Compare(x, y));
DropDownListId.DataSource = items;
DropDownListId.DataBind(); 
```

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2008-10-21T16:43:06.800

DropDownList 将任何 IEnumerable 作为数据源。

只需使用 LINQ 对其进行排序。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-10-21T16:42:58.437

我通常使用数据库表中的值加载 DropDownList，因此最简单的方法是使用 SELECT 语句的 ORDER BY 子句根据需要对结果进行排序，然后遍历结果并将它们转储到 DropDownList 中。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-10-21T22:24:25.160

查看[CodeProject 中的这篇文章](http://www.codeproject.com/KB/webforms/Sort__a_dropdown_box.aspx)，它重新排列了下拉列表的内容。如果您是数据绑定，则需要在数据绑定到列表后运行排序器。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-12-15T16:15:17.887

建议在将数据绑定到 DropDownList 之前对数据进行排序，但如果不能，这就是对 DropDownList 中的项目进行排序的方式。

首先你需要一个比较类

```
Public Class ListItemComparer
    Implements IComparer(Of ListItem)

    Public Function Compare(ByVal x As ListItem, ByVal y As ListItem) As Integer _
        Implements IComparer(Of ListItem).Compare

        Dim c As New CaseInsensitiveComparer
        Return c.Compare(x.Text, y.Text)
    End Function
End Class 
```

然后你需要一个方法来使用这个 Comparer 对 DropDownList 进行排序

```
Public Shared Sub SortDropDown(ByVal cbo As DropDownList)
    Dim lstListItems As New List(Of ListItem)
    For Each li As ListItem In cbo.Items
        lstListItems.Add(li)
    Next
    lstListItems.Sort(New ListItemComparer)
    cbo.Items.Clear()
    cbo.Items.AddRange(lstListItems.ToArray)
End Sub 
```

最后，用你的 DropDownList 调用这个函数（在它被数据绑定之后）

```
SortDropDown(cboMyDropDown) 
```

PS 抱歉，我选择的语言是 VB。您可以使用[http://converter.telerik.com/](http://converter.telerik.com/)将代码从 VB 转换为 C#

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2012-07-31T19:47:50.857

另一种选择是将 ListItems 放入一个数组并排序。

```
 int i = 0;
        string[] array = new string[items.Count];

        foreach (ListItem li in dropdownlist.items)
        {
            array[i] = li.ToString();
            i++;

        }

        Array.Sort(array);

        dropdownlist.DataSource = array;
        dropdownlist.DataBind(); 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-10-21T17:00:46.123

如果您只想按字母顺序对显示的结果进行排序，我同意在填充数据库查询时使用 ORDER BY 进行排序。让数据库引擎做排序的工作。

但是，有时您需要**除字母表之外的其他排序顺序**。例如，您可能需要这样的逻辑顺序：新建、打开、进行中、已完成、已批准、已关闭。在这种情况下，您可以向数据库表中添加一列以显式设置排序顺序。将其命名为 SortOrder 或 DisplaySortOrder。然后，在您的 SQL 中，您将按排序顺序字段排序（不检索该字段）。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-10-22T14:21:47.893

您使用哪种对象进行数据绑定？通常我使用 Collection<T>、List<T> 或 Queue<T>（取决于具体情况）。使用自定义委托对这些进行排序相对容易。请参阅[有关 Comparison(T) delegate 的 MSDN 文档](http://msdn.microsoft.com/en-us/library/tfakywbh.aspx)。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2013-02-28T09:51:53.993

```
var list = ddl.Items.Cast<ListItem>().OrderBy(x => x.Text).ToList();

ddl.DataSource = list;
ddl.DataTextField = "Text";
ddl.DataValueField = "Value"; 
ddl.DataBind(); 
```

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2014-01-15T07:42:46.617

尝试一下

--------存储过程-----(SQL)

```
USE [Your Database]
GO

CRATE PROC [dbo].[GetAllDataByID]

@ID int

AS
BEGIN
        SELECT * FROM Your_Table
        WHERE ID=@ID
        ORDER BY Your_ColumnName 
END 
```

----------Default.aspx---------

```
<asp:DropDownList ID="ddlYourTable" runat="server"></asp:DropDownList> 
```

---------Default.aspx.cs------

```
protected void Page_Load(object sender, EventArgs e)

{

      if (!IsPostBack)
            {
                List<YourTable> table= new List<YourTable>();

                YourtableRepository tableRepo = new YourtableRepository();

                int conuntryInfoID=1;

                table= tableRepo.GetAllDataByID(ID);

                ddlYourTable.DataSource = stateInfo;
                ddlYourTable.DataTextField = "Your_ColumnName";
                ddlYourTable.DataValueField = "ID";
                ddlYourTable.DataBind();

            }
        } 
```

--------LINQ 助手类----

```
public class TableRepository

   {

        string connstr;

        public TableRepository() 
        {
            connstr = Settings.Default.YourTableConnectionString.ToString();
        }

        public List<YourTable> GetAllDataByID(int ID)
        {
            List<YourTable> table= new List<YourTable>();
            using (YourTableDBDataContext dc = new YourTableDBDataContext ())
            {
                table= dc.GetAllDataByID(ID).ToList();
            }
            return table;
        }
    } 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-10-21T16:49:27.427

我同意人们在将模型中的数据填充到 DropDownList 之前对它们进行排序，所以如果你从数据库中填充它，最好使用简单的**order by**子句让它们已经在那里排序，这样可以节省你在网络服务器中的一些周期，我相信数据库会做得更快。如果您从另一个数据源（例如 XML 文件）填充它，则使用 LINQ 将是一个好主意，甚至 Array.Sort 的任何变体都会很好。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-10-21T17:45:23.583

如果您的数据以 System.Data.DataTable 的形式提供给您，请调用 DataTable 的 .Select() 方法，为 filterExpression 传入“”，为排序传入“COLUMN1 ASC”（或您想要排序的任何列）。这将返回一个按指定排序的 DataRow 对象数组，然后您可以对其进行迭代并转储到 DropDownList 中。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-12-09T11:55:06.673

你可以使用这个 JavaScript 函数：

```
function sortlist(mylist)
{
   var lb = document.getElementById(mylist);
   arrTexts = new Array();
   arrValues = new Array();
   arrOldTexts = new Array();

   for(i=0; i<lb.length; i++)
   {
      arrTexts[i] = lb.options[i].text;
      arrValues[i] = lb.options[i].value;

      arrOldTexts[i] = lb.options[i].text;
   }

   arrTexts.sort();

   for(i=0; i<lb.length; i++)
   {
      lb.options[i].text = arrTexts[i];
      for(j=0; j<lb.length; j++)
      {
         if (arrTexts[i] == arrOldTexts[j])
         {
            lb.options[i].value = arrValues[j];
            j = lb.length;
         }
      }
   }
} 
```

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2010-01-28T20:03:06.123

```
 List<ListItem> li = new List<ListItem>();
        foreach (ListItem list in DropDownList1.Items)
        {
            li.Add(list);
        }
        li.Sort((x, y) => string.Compare(x.Text, y.Text));
        DropDownList1.Items.Clear();
        DropDownList1.DataSource = li;
        DropDownList1.DataTextField = "Text";
        DropDownList1.DataValueField = "Value";
        DropDownList1.DataBind(); 
```

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2010-06-03T05:09:58.487

要对返回数据集的对象数据源进行排序，请使用控件的**Sort**属性。

示例用法 在aspx页面中按ColumnName升序排序

```
<asp:ObjectDataSource ID="dsData" runat="server" TableName="Data" 
 Sort="ColumnName ASC" /> 
```

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2013-04-26T20:53:08.290

如果在将 Source 绑定到 DropDwonList 之前对其进行排序，效果会更好。但是像这样对 DropDownList.Items 进行排序：

```
 Dim Lista_Items = New List(Of ListItem)

    For Each item As ListItem In ddl.Items
        Lista_Items.Add(item)
    Next

    Lista_Items.Sort(Function(x, y) String.Compare(x.Text, y.Text))

    ddl.Items.Clear()
    ddl.Items.AddRange(Lista_Items.ToArray()) 
```

（这种情况下我按字符串（商品的文本）排序，它可以是供应商的名称，供应商的 ID）

该`Sort()`方法适用于每个`List(of )`/ `List<MyType>`，您可以使用它。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2013-09-13T11:28:55.070

你可以这样做很简单

```
private void SortDDL(ref DropDownList objDDL)
{
ArrayList textList = new ArrayList();
ArrayList valueList = new ArrayList();
foreach (ListItem li in objDDL.Items)
{
    textList.Add(li.Text);
}
textList.Sort();
foreach (object item in textList)
{
    string value = objDDL.Items.FindByText(item.ToString()).Value;
    valueList.Add(value);
}
objDDL.Items.Clear();
for(int i = 0; i < textList.Count; i++)
{
     ListItem objItem = new ListItem(textList[i].ToString(), valueList[i].ToString());
     objDDL.Items.Add(objItem);
} 
```

}

并调用此方法 SortDDL(ref yourDropDownList); 就是这样。下拉列表中的数据将被排序。

请参阅[http://www.codeproject.com/Articles/20131/Sorting-Dropdown-list-in-ASP-NET-using-C#](http://www.codeproject.com/Articles/20131/Sorting-Dropdown-list-in-ASP-NET-using-C#)

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2014-04-09T17:16:33.133

试试这个：

```
/// <summary>
/// AlphabetizeDropDownList alphabetizes a given dropdown list by it's displayed text.
/// </summary>
/// <param name="dropDownList">The drop down list you wish to modify.</param>
/// <remarks></remarks>
private void AlphabetizeDropDownList(ref DropDownList dropDownList)
{
    //Create a datatable to sort the drop down list items
    DataTable machineDescriptionsTable = new DataTable();
    machineDescriptionsTable.Columns.Add("DescriptionCode", typeof(string));
    machineDescriptionsTable.Columns.Add("UnitIDString", typeof(string));
    machineDescriptionsTable.AcceptChanges();
    //Put each of the list items into the datatable
    foreach (ListItem currentDropDownListItem in dropDownList.Items) {
            string currentDropDownUnitIDString = currentDropDownListItem.Value;
            string currentDropDownDescriptionCode = currentDropDownListItem.Text;
            DataRow currentDropDownDataRow = machineDescriptionsTable.NewRow();
            currentDropDownDataRow["DescriptionCode"] = currentDropDownDescriptionCode.Trim();
            currentDropDownDataRow["UnitIDString"] = currentDropDownUnitIDString.Trim();
            machineDescriptionsTable.Rows.Add(currentDropDownDataRow);
            machineDescriptionsTable.AcceptChanges();
    }
    //Sort the data table by description
    DataView sortedView = new DataView(machineDescriptionsTable);
    sortedView.Sort = "DescriptionCode";
    machineDescriptionsTable = sortedView.ToTable();
    //Clear the items in the original dropdown list
    dropDownList.Items.Clear();
    //Create a dummy list item at the top
    ListItem dummyListItem = new ListItem(" ", "-1");
    dropDownList.Items.Add(dummyListItem);
    //Begin transferring over the items alphabetically from the copy to the intended drop
     downlist
    foreach (DataRow currentDataRow in machineDescriptionsTable.Rows) {
            string currentDropDownValue = currentDataRow["UnitIDString"].ToString().Trim();
            string currentDropDownText = currentDataRow["DescriptionCode"].ToString().Trim();
            ListItem currentDropDownListItem = new ListItem(currentDropDownText, currentDropDownValue);
    //Don't deal with dummy values in the list we are transferring over
    if (!string.IsNullOrEmpty(currentDropDownText.Trim())) {
        dropDownList.Items.Add(currentDropDownListItem);
    }
} 
```

}

这将获取一个给定的下拉列表，其中包含列表项的 Text 和 Value 属性，并将它们放回给定的下拉列表中。祝你好运！

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2014-06-13T07:09:06.653

如果您在没有数据集的情况下将选项一个一个地添加到下拉列表中，并且您想在添加项目后对其进行排序，这里有一个解决方案：

```
DataTable dtOptions = new DataTable();
DataColumn[] dcColumns = { new DataColumn("Text", Type.GetType("System.String")), 
                           new DataColumn("Value", Type.GetType("System.String"))};
dtOptions.Columns.AddRange(dcColumns);
foreach (ListItem li in ddlOperation.Items)
{
   DataRow dr = dtOptions.NewRow();
   dr["Text"] = li.Text;
   dr["Value"] = li.Value;
   dtOptions.Rows.Add(dr);
}
DataView dv = dtOptions.DefaultView;
dv.Sort = "Text";
ddlOperation.Items.Clear();
ddlOperation.DataSource = dv;
ddlOperation.DataTextField = "Text";
ddlOperation.DataValueField = "Value";
ddlOperation.DataBind(); 
```

这将按字母顺序对下拉项目进行排序。

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2016-09-28T21:53:32.493

如果您使用的是数据有界 DropDownList，只需转到向导并通过以下方式编辑边界查询：

1.  转到 .aspx 页面（设计视图）。
2.  单击下拉列表上的神奇箭头“>”。
3.  选择“配置数据源”。
4.  点击下一步。
5.  在打开的窗口的右侧，单击“ORDER BY...”。
6.  您将有两个现场 cariteria 进行排序。选择所需的字段并单击确定，然后单击完成。

![在此处输入图像描述](https://i.stack.imgur.com/70uIs.png)

* * *

## 回答 #23

> 赞同：-1
> 
> 时间：2008-10-22T23:49:15.643

您可能无法访问 SQL，但如果您有 DataSet 或 DataTable，您当然可以调用该`Sort()`方法。

# python - 用于缩小 CSS 的 Python 脚本？

> ID：222581
> 
> 赞同：49
> 
> 时间：2008-10-21T16:42:26.987
> 
> 标签：python, css, compression, minify

我正在寻找一个简单的 Python 脚本，它可以将 CSS 缩小为网站部署过程的一部分。[（Python 是服务器上唯一支持的脚本语言，像CSS Utils](http://cthedot.de/cssutils/)这样成熟的解析器对于这个项目来说太过分了）。

基本上我想要[jsmin.py](http://www.crockford.com/javascript/jsmin.py.txt)用于 CSS。没有依赖关系的单个脚本。

有任何想法吗？

* * *

## 回答 #1

> 赞同：71
> 
> 时间：2008-10-21T22:05:06.820

这对我来说似乎是一个很好的任务来进入 python，它已经等待了一段时间。我在此展示我的第一个 python 脚本：

```
import sys, re

with open( sys.argv[1] , 'r' ) as f:
    css = f.read()

# remove comments - this will break a lot of hacks :-P
css = re.sub( r'\s*/\*\s*\*/', "$$HACK1$$", css ) # preserve IE<6 comment hack
css = re.sub( r'/\*[\s\S]*?\*/', "", css )
css = css.replace( "$$HACK1$$", '/**/' ) # preserve IE<6 comment hack

# url() doesn't need quotes
css = re.sub( r'url\((["\'])([^)]*)\1\)', r'url(\2)', css )

# spaces may be safely collapsed as generated content will collapse them anyway
css = re.sub( r'\s+', ' ', css )

# shorten collapsable colors: #aabbcc to #abc
css = re.sub( r'#([0-9a-f])\1([0-9a-f])\2([0-9a-f])\3(\s|;)', r'#\1\2\3\4', css )

# fragment values can loose zeros
css = re.sub( r':\s*0(\.\d+([cm]m|e[mx]|in|p[ctx]))\s*;', r':\1;', css )

for rule in re.findall( r'([^{]+){([^}]*)}', css ):

    # we don't need spaces around operators
    selectors = [re.sub( r'(?<=[\[\(>+=])\s+|\s+(?=[=~^$*|>+\]\)])', r'', selector.strip() ) for selector in rule[0].split( ',' )]

    # order is important, but we still want to discard repetitions
    properties = {}
    porder = []
    for prop in re.findall( '(.*?):(.*?)(;|$)', rule[1] ):
        key = prop[0].strip().lower()
        if key not in porder: porder.append( key )
        properties[ key ] = prop[1].strip()

    # output rule if it contains any declarations
    if properties:
        print "%s{%s}" % ( ','.join( selectors ), ''.join(['%s:%s;' % (key, properties[key]) for key in porder])[:-1] ) 
```

我相信这是可行的，并且在最近的 Safari、Opera 和 Firefox 上都可以正常输出。它将破坏除下划线和 /**/ hacks 之外的 CSS hacks！如果您有很多 hack 操作（或将它们放在单独的文件中），请不要使用 minifier。

对我的 python 的任何提示表示赞赏。不过请温柔一点，我是第一次。:-)

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2010-03-07T15:32:16.927

有一个可用于 python 的 YUI 的 CSS 压缩器端口。

这是它在 PyPi 上的项目页面：http: [//pypi.python.org/pypi/cssmin/0.1.1](http://pypi.python.org/pypi/cssmin/0.1.1)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2015-05-01T00:37:16.310

有一个不错的在线工具[cssminifier](http://cssminifier.com/)，它还有一个非常简单易用的 API。我制作了一个小 Python 脚本，将 CSS 文件内容发布到该工具的 API，返回缩小的 CSS 并将其保存到文件“style.min.css”中。我喜欢它，因为它是一个可以很好地集成到自动部署脚本中的小代码：

```
import requests
f = open("style.css", "r")
css_text = f.read()
f.close()
r = requests.post("http://cssminifier.com/raw", data={"input":css_text})
css_minified = r.text
f2 = open("style.min.css", "w")
f2.write(css_minified)
f2.close() 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2015-06-08T15:10:01.690

如果有人遇到这个问题并且正在使用 Django，那么有一个常用的包可以解决这个问题，称为[Django Compressor](http://django-compressor.readthedocs.org/en/latest/)：

> 将链接和内联 JavaScript 或 CSS 压缩到单个缓存文件中。
> 
> *   JS/CSS 属于模板
>     
>     
> *   灵活性
>     
>     
> *   它不会妨碍
>     
>     
> *   完整的测试套件

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-21T17:18:50.580

我不知道任何现成的 python css 缩小器，但就像你说的 css utils 有选项。在检查并验证许可证是否允许之后，您可以浏览源代码并剪掉自己进行缩小的部分。然后将其粘贴在一个脚本中，瞧！你去吧。

作为一个开始，.../trunk/src/cssutils/script.py 中的 csscombine 函数似乎可以在第 361 行附近进行缩小（我检查了修订版 1499）。请注意名为“minify”的布尔函数参数。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2015-12-21T12:40:37.457

在[webassets](https://webassets.readthedocs.org/en/latest/builtin_filters.html#css-compressors)文档中，您可以找到多个压缩器和编译器的链接。从该列表中，我选择[了 pyScss](https://pypi.python.org/pypi/pyScss)，它也缩小了生成的 CSS。

如果你只需要一个 CSS 压缩器，你可以试试[csscompressor](https://pypi.python.org/pypi/csscompressor)：

> YUI CSS Compressor 的几乎完全相同的端口。通过所有原始单元测试。

更通用的工具是[css-html-prettify](https://pypi.python.org/pypi/css-html-prettify)：

> StandAlone Async 单文件跨平台 Unicode-ready Python3 Prettifier Beautifier for Web。

# flash - FLASH/FLEXBUILDER：computeSpectrum 无故停止计算频谱

> ID：222592
> 
> 赞同：0
> 
> 时间：2008-10-21T16:45:01.163
> 
> 标签：flash, actionscript-3, flexbuilder

我正在使用 flex builder 来编译我的 SWF。我在本地机器上使用 mp3 和 computeSpectrum() 来分析 mp3。

玩了 20 秒后，我的 computeSpectrum 停止返回值，而是开始返回此错误：

```
SecurityError: Error #2121: Security sandbox violation: SoundMixer.computeSpectrum: file:///C|/Documents%20and%20Settings/Kasper/My%20Documents/Flex%20Builder%203/Soundanalizer/bin%2Ddebug/Soundanalizer.swf cannot access . This may be worked around by calling Security.allowDomain. 
```

如果我用 flash 编译，它不会抛出这个错误：/

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-22T19:45:18.320

Flash 播放器认为它正在尝试从网站打开本地文件。如果您从 flash ide 运行它，则会忽略它。如果您将其上传到网络服务器，它也应该可以正常工作。

为了能够在本地进行测试，请使用[http://www.macromedia.com/support/documentation/en/flashplayer/help/settings_manager04.html上的安全选项卡添加对您的 swf（或整个项目文件夹）的访问权限](http://www.macromedia.com/support/documentation/en/flashplayer/help/settings_manager04.html)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-21T16:53:47.853

我过去在 computeSpectrum 上遇到的问题是由 Flash 检查音频沙箱的全球方式引起的，这意味着在浏览器中打开的其他不相关的 Flash 内容（例如 YouTube）被视为您的 swf 试图加载它 - 这意味着如果您运行您的应用程序然后打开 YouTube，您将收到错误消息。

这可能是原因吗？

# c# - 如何在 C# 中克隆通用列表？

> ID：222598
> 
> 赞同：694
> 
> 时间：2008-10-21T16:47:05.823
> 
> 标签：c#, generics, list, clone

我在 C# 中有一个通用的对象列表，并希望克隆该列表。列表中的项目是可克隆的，但似乎没有选项可做`list.Clone()`。

有没有简单的方法解决这个问题？

* * *

## 回答 #1

> 赞同：616
> 
> 时间：2008-10-21T16:54:15.280

如果您的元素是值类型，那么您可以这样做：

```
List<YourType> newList = new List<YourType>(oldList); 
```

但是，如果它们是引用类型并且您想要一个深层副本（假设您的元素正确实现`ICloneable`），您可以执行以下操作：

```
List<ICloneable> oldList = new List<ICloneable>();
List<ICloneable> newList = new List<ICloneable>(oldList.Count);

oldList.ForEach((item) =>
    {
        newList.Add((ICloneable)item.Clone());
    }); 
```

显然，替换`ICloneable`上面的泛型并使用您实现的任何元素类型进行转换`ICloneable`。

如果您的元素类型不支持`ICloneable`但确实有一个复制构造函数，您可以这样做：

```
List<YourType> oldList = new List<YourType>();
List<YourType> newList = new List<YourType>(oldList.Count);

oldList.ForEach((item)=>
    {
        newList.Add(new YourType(item));
    }); 
```

就个人而言，我会避免`ICloneable`，因为需要保证所有成员的深层副本。相反，我建议使用复制构造函数或类似的工厂方法`YourType.CopyFrom(YourType itemToCopy)`返回一个新的`YourType`.

这些选项中的任何一个都可以由方法（扩展或其他）包装。

* * *

## 回答 #2

> 赞同：438
> 
> 时间：2008-10-21T16:58:54.363

您可以使用扩展方法。

```
static class Extensions
{
    public static IList<T> Clone<T>(this IList<T> listToClone) where T: ICloneable
    {
        return listToClone.Select(item => (T)item.Clone()).ToList();
    }
} 
```

* * *

## 回答 #3

> 赞同：101
> 
> 时间：2008-10-21T16:52:10.430

对于浅拷贝，您可以改用通用 List 类的 GetRange 方法。

```
List<int> oldList = new List<int>( );
// Populate oldList...

List<int> newList = oldList.GetRange(0, oldList.Count); 
```

引自：[仿制药食谱](https://web.archive.org/web/20121230023705/http://en.csharp-online.net/CSharp_Generics_Recipes%E2%80%94Replacing_the_ArrayList_with_Its_Generic_Counterpart "C# 泛型食谱")

* * *

## 回答 #4

> 赞同：92
> 
> 时间：2008-10-21T17:43:34.773

```
public static object DeepClone(object obj) 
{
    object objResult = null;

    using (var ms = new MemoryStream())
    {
        var bf = new BinaryFormatter();
        bf.Serialize(ms, obj);

        ms.Position = 0;
        objResult = bf.Deserialize(ms);
     }

     return objResult;
} 
```

这是使用 C# 和 .NET 2.0 的一种方法。您的对象需要是`[Serializable()]`. 目标是丢失所有引用并建立新的引用。

* * *

## 回答 #5

> 赞同：42
> 
> 时间：2017-09-25T00:35:03.377

要克隆一个列表，只需调用 .ToList()。这会创建一个浅拷贝。

```
Microsoft (R) Roslyn C# Compiler version 2.3.2.62116
Loading context from 'CSharpInteractive.rsp'.
Type "#help" for more information.
> var x = new List<int>() { 3, 4 };
> var y = x.ToList();
> x.Add(5)
> x
List<int>(3) { 3, 4, 5 }
> y
List<int>(2) { 3, 4 }
> 
```

* * *

## 回答 #6

> 赞同：24
> 
> 时间：2011-07-20T09:26:17.593

稍作修改后，您还可以克隆：

```
public static T DeepClone<T>(T obj)
{
    T objResult;
    using (MemoryStream ms = new MemoryStream())
    {
        BinaryFormatter bf = new BinaryFormatter();
        bf.Serialize(ms, obj);
        ms.Position = 0;
        objResult = (T)bf.Deserialize(ms);
    }
    return objResult;
} 
```

* * *

## 回答 #7

> 赞同：17
> 
> 时间：2015-07-10T14:09:54.473

除非您需要实际克隆 中的每个对象`List<T>`，否则克隆列表的最佳方法是使用旧列​​表作为集合参数创建一个新列表。

```
List<T> myList = ...;
List<T> cloneOfMyList = new List<T>(myList); 
```

插入或删除等更改`myList`不会影响`cloneOfMyList`，反之亦然。

然而，这两个列表包含的实际对象仍然相同。

* * *

## 回答 #8

> 赞同：15
> 
> 时间：2008-10-21T16:54:41.580

如果您只关心值类型...

你知道类型：

```
List<int> newList = new List<int>(oldList); 
```

如果您以前不知道类型，则需要一个辅助函数：

```
List<T> Clone<T>(IEnumerable<T> oldList)
{
    return newList = new List<T>(oldList);
} 
```

公正的：

```
List<string> myNewList = Clone(myOldList); 
```

* * *

## 回答 #9

> 赞同：15
> 
> 时间：2013-02-13T23:20:22.697

使用 AutoMapper（或您喜欢的任何映射库）进行克隆非常简单且易于维护。

定义你的映射：

```
Mapper.CreateMap<YourType, YourType>(); 
```

施展魔法：

```
YourTypeList.ConvertAll(Mapper.Map<YourType, YourType>); 
```

* * *

## 回答 #10

> 赞同：11
> 
> 时间：2013-11-01T14:43:56.280

如果您已经在项目中引用了 Newtonsoft.Json 并且您的对象是可序列化的，您可以始终使用：

```
List<T> newList = JsonConvert.DeserializeObject<T>(JsonConvert.SerializeObject(listToCopy)) 
```

可能不是最有效的方法，但除非您做 100 次或 1000 次，否则您甚至可能不会注意到速度差异。

* * *

## 回答 #11

> 赞同：5
> 
> 时间：2016-11-09T13:55:33.120

无需将类标记为可序列化，并且在我们的测试中使用 Newtonsoft JsonSerializer 甚至比使用 BinaryFormatter 更快。扩展方法可用于每个对象。

***注意**：私有成员不会被克隆*

标准 .NET JavascriptSerializer 选项：

```
public static T DeepCopy<T>(this T value)
{
    JavaScriptSerializer js = new JavaScriptSerializer();

    string json = js.Serialize(value);

    return js.Deserialize<T>(json);
} 
```

[使用Newtonsoft JSON](http://www.newtonsoft.com/json)的更快选项：

```
public static T DeepCopy<T>(this T value)
{
    string json = JsonConvert.SerializeObject(value);

    return JsonConvert.DeserializeObject<T>(json);
} 
```

* * *

## 回答 #12

> 赞同：5
> 
> 时间：2019-05-13T21:04:01.013

对于深拷贝，ICloneable 是正确的解决方案，但这里有一个与 ICloneable 类似的方法，使用构造函数而不是 ICloneable 接口。

```
public class Student
{
  public Student(Student student)
  {
    FirstName = student.FirstName;
    LastName = student.LastName;
  }

  public string FirstName { get; set; }
  public string LastName { get; set; }
}

// wherever you have the list
List<Student> students;

// and then where you want to make a copy
List<Student> copy = students.Select(s => new Student(s)).ToList(); 
```

您需要以下库来制作副本

```
using System.Linq 
```

您也可以使用 for 循环代替 System.Linq，但 Linq 使其简洁明了。同样，您可以按照其他答案的建议进行操作并进行扩展方法等，但这些都不是必需的。

* * *

## 回答 #13

> 赞同：4
> 
> 时间：2019-01-21T17:15:02.167

如果有人读过这篇文章，我会很幸运......但为了不在我的 Clone 方法中返回类型对象列表，我创建了一个接口：

```
public interface IMyCloneable<T>
{
    T Clone();
} 
```

然后我指定了扩展名：

```
public static List<T> Clone<T>(this List<T> listToClone) where T : IMyCloneable<T>
{
    return listToClone.Select(item => (T)item.Clone()).ToList();
} 
```

这是我的 A/V 标记软件中的接口实现。我想让我的 Clone() 方法返回一个 VidMark 列表（而 ICloneable 接口希望我的方法返回一个对象列表）：

```
public class VidMark : IMyCloneable<VidMark>
{
    public long Beg { get; set; }
    public long End { get; set; }
    public string Desc { get; set; }
    public int Rank { get; set; } = 0;

    public VidMark Clone()
    {
        return (VidMark)this.MemberwiseClone();
    }
} 
```

最后，在类中使用扩展：

```
private List<VidMark> _VidMarks;
private List<VidMark> _UndoVidMarks;

//Other methods instantiate and fill the lists

private void SetUndoVidMarks()
{
    _UndoVidMarks = _VidMarks.Clone();
} 
```

有人喜欢吗？有什么改进吗？

* * *

## 回答 #14

> 赞同：3
> 
> 时间：2011-04-25T12:18:33.457

```
public static Object CloneType(Object objtype)
{
    Object lstfinal = new Object();

    using (MemoryStream memStream = new MemoryStream())
    {
        BinaryFormatter binaryFormatter = new BinaryFormatter(null, new StreamingContext(StreamingContextStates.Clone));
        binaryFormatter.Serialize(memStream, objtype); memStream.Seek(0, SeekOrigin.Begin);
        lstfinal = binaryFormatter.Deserialize(memStream);
    }

    return lstfinal;
} 
```

* * *

## 回答 #15

> 赞同：3
> 
> 时间：2011-10-07T07:04:00.627

```
public class CloneableList<T> : List<T>, ICloneable where T : ICloneable
{
  public object Clone()
  {
    var clone = new List<T>();
    ForEach(item => clone.Add((T)item.Clone()));
    return clone;
  }
} 
```

* * *

## 回答 #16

> 赞同：3
> 
> 时间：2016-04-10T07:40:51.303

```
 public List<TEntity> Clone<TEntity>(List<TEntity> o1List) where TEntity : class , new()
    {
        List<TEntity> retList = new List<TEntity>();
        try
        {
            Type sourceType = typeof(TEntity);
            foreach(var o1 in o1List)
            {
                TEntity o2 = new TEntity();
                foreach (PropertyInfo propInfo in (sourceType.GetProperties()))
                {
                    var val = propInfo.GetValue(o1, null);
                    propInfo.SetValue(o2, val);
                }
                retList.Add(o2);
            }
            return retList;
        }
        catch
        {
            return retList;
        }
    } 
```

* * *

## 回答 #17

> 赞同：3
> 
> 时间：2018-02-18T04:52:43.177

```
 //try this
 List<string> ListCopy= new List<string>(OldList);
 //or try
 List<T> ListCopy=OldList.ToList(); 
```

* * *

## 回答 #18

> 赞同：3
> 
> 时间：2021-07-28T07:01:09.480

如果我需要收集的**深层副本**，我最喜欢这样的**方法**：

```
public static IEnumerable<T> DeepCopy<T>(this IEnumerable<T> collectionToDeepCopy)
{
    var serializedCollection = JsonConvert.SerializeObject(collectionToDeepCopy);
    return JsonConvert.DeserializeObject<IEnumerable<T>>(serializedCollection);
} 
```

* * *

## 回答 #19

> 赞同：2
> 
> 时间：2013-06-07T11:37:58.013

您可以使用扩展方法：

```
namespace extension
{
    public class ext
    {
        public static List<double> clone(this List<double> t)
        {
            List<double> kop = new List<double>();
            int x;
            for (x = 0; x < t.Count; x++)
            {
                kop.Add(t[x]);
            }
            return kop;
        }
   };

} 
```

您可以使用它们的值类型成员克隆所有对象，例如，考虑这个类：

```
public class matrix
{
    public List<List<double>> mat;
    public int rows,cols;
    public matrix clone()
    { 
        // create new object
        matrix copy = new matrix();
        // firstly I can directly copy rows and cols because they are value types
        copy.rows = this.rows;  
        copy.cols = this.cols;
        // but now I can no t directly copy mat because it is not value type so
        int x;
        // I assume I have clone method for List<double>
        for(x=0;x<this.mat.count;x++)
        {
            copy.mat.Add(this.mat[x].clone());
        }
        // then mat is cloned
        return copy; // and copy of original is returned 
    }
}; 
```

注意：如果您对复制（或克隆）进行任何更改，它不会影响原始对象。

* * *

## 回答 #20

> 赞同：2
> 
> 时间：2015-12-22T02:19:04.303

如果你需要一个相同容量的克隆列表，你可以试试这个：

```
public static List<T> Clone<T>(this List<T> oldList)
{
    var newList = new List<T>(oldList.Capacity);
    newList.AddRange(oldList);
    return newList;
} 
```

* * *

## 回答 #21

> 赞同：2
> 
> 时间：2019-02-27T09:51:41.407

在这种情况下，对于浅拷贝，使用强制转换可能会有所帮助：

```
IList CloneList(IList list)
{
    IList result;
    result = (IList)Activator.CreateInstance(list.GetType());
    foreach (object item in list) result.Add(item);
    return result;
} 
```

应用于通用列表：

```
List<T> Clone<T>(List<T> argument) => (List<T>)CloneList(argument); 
```

* * *

## 回答 #22

> 赞同：1
> 
> 时间：2014-10-13T14:28:08.163

我使用自动映射器来复制对象。我只是设置了一个将一个对象映射到自身的映射。你可以用任何你喜欢的方式包装这个操作。

[http://automapper.codeplex.com/](http://automapper.codeplex.com/)

* * *

## 回答 #23

> 赞同：1
> 
> 时间：2015-01-15T15:08:20.667

您也可以使用 简单地将列表转换为数组`ToArray`，然后使用 克隆数组`Array.Clone(...)`。根据您的需要，Array 类中包含的方法可以满足您的需要。

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2013-07-03T12:41:06.583

我为自己制作了一些扩展，它转换了未实现 IClonable 的项目的 ICollection

```
static class CollectionExtensions
{
    public static ICollection<T> Clone<T>(this ICollection<T> listToClone)
    {
        var array = new T[listToClone.Count];
        listToClone.CopyTo(array,0);
        return array.ToList();
    }
} 
```

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2015-09-03T11:23:03.820

以下代码应以最少的更改转移到列表中。

基本上，它通过在每个连续循环中插入更大范围的新随机数来工作。如果已经存在与它相同或更高的数字，则将这些随机数上移一个，以便它们转移到新的更大范围的随机索引中。

```
// Example Usage
int[] indexes = getRandomUniqueIndexArray(selectFrom.Length, toSet.Length);

for(int i = 0; i < toSet.Length; i++)
    toSet[i] = selectFrom[indexes[i]];

private int[] getRandomUniqueIndexArray(int length, int count)
{
    if(count > length || count < 1 || length < 1)
        return new int[0];

    int[] toReturn = new int[count];
    if(count == length)
    {
        for(int i = 0; i < toReturn.Length; i++) toReturn[i] = i;
        return toReturn;
    }

    Random r = new Random();
    int startPos = count - 1;
    for(int i = startPos; i >= 0; i--)
    {
        int index = r.Next(length - i);
        for(int j = startPos; j > i; j--)
            if(toReturn[j] >= index)
                toReturn[j]++;
        toReturn[i] = index;
    }

    return toReturn;
} 
```

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2015-12-18T23:56:44.743

另一件事：你可以使用反射。如果您正确缓存它，那么它将在 5.6 秒内克隆 1,000,000 个对象（遗憾的是，内部对象为 16.4 秒）。

```
[ProtoContract(ImplicitFields = ImplicitFields.AllPublic)]
public class Person
{
       ...
      Job JobDescription
       ...
}

[ProtoContract(ImplicitFields = ImplicitFields.AllPublic)]
public class Job
{...
}

private static readonly Type stringType = typeof (string);

public static class CopyFactory
{
    static readonly Dictionary<Type, PropertyInfo[]> ProperyList = new Dictionary<Type, PropertyInfo[]>();

    private static readonly MethodInfo CreateCopyReflectionMethod;

    static CopyFactory()
    {
        CreateCopyReflectionMethod = typeof(CopyFactory).GetMethod("CreateCopyReflection", BindingFlags.Static | BindingFlags.Public);
    }

    public static T CreateCopyReflection<T>(T source) where T : new()
    {
        var copyInstance = new T();
        var sourceType = typeof(T);

        PropertyInfo[] propList;
        if (ProperyList.ContainsKey(sourceType))
            propList = ProperyList[sourceType];
        else
        {
            propList = sourceType.GetProperties(BindingFlags.Public | BindingFlags.Instance);
            ProperyList.Add(sourceType, propList);
        }

        foreach (var prop in propList)
        {
            var value = prop.GetValue(source, null);
            prop.SetValue(copyInstance,
                value != null && prop.PropertyType.IsClass && prop.PropertyType != stringType ? CreateCopyReflectionMethod.MakeGenericMethod(prop.PropertyType).Invoke(null, new object[] { value }) : value, null);
        }

        return copyInstance;
    } 
```

我使用 Watcher 类以一种简单的方式对其进行了测量。

```
 var person = new Person
 {
     ...
 };

 for (var i = 0; i < 1000000; i++)
 {
    personList.Add(person);
 }
 var watcher = new Stopwatch();
 watcher.Start();
 var copylist = personList.Select(CopyFactory.CreateCopyReflection).ToList();
 watcher.Stop();
 var elapsed = watcher.Elapsed; 
```

**结果：**使用内部对象 PersonInstance - 16.4，PersonInstance = null - 5.6

CopyFactory 只是我的测试类，我有十几个测试，包括表达式的使用。您可以在扩展或其他任何形式中以另一种形式实现它。不要忘记缓存。

我还没有测试序列化，但我怀疑有一百万个类的改进。我会尝试一些快速的 protobuf/newton。

PS：为了阅读简单，我这里只使用了auto-property。我可以使用 FieldInfo 进行更新，或者您应该自己轻松实现。

我最近使用开箱即用的 DeepClone 功能测试了[Protocol Buffers序列化程序。](https://en.wikipedia.org/wiki/Protocol_Buffers)在一百万个简单对象上它以 4.2 秒获胜，但对于内部对象，它以 7.4 秒的结果获胜。

```
Serializer.DeepClone(personList); 
```

**摘要：**如果您无权访问这些课程，那么这将有所帮助。否则，它取决于对象的数量。我认为您最多可以使用反射 10,000 个对象（可能会少一点），但除此之外，Protocol Buffers 序列化程序的性能会更好。

* * *

## 回答 #27

> 赞同：0
> 
> 时间：2017-01-20T08:43:49.353

有一种使用 JSON 序列化器和反序列化器在 C# 中克隆对象的简单方法。

您可以创建一个扩展类：

```
using Newtonsoft.Json;

static class typeExtensions
{
    [Extension()]
    public static T jsonCloneObject<T>(T source)
    {
    string json = JsonConvert.SerializeObject(source);
    return JsonConvert.DeserializeObject<T>(json);
    }
} 
```

克隆和对象：

```
obj clonedObj = originalObj.jsonCloneObject; 
```

* * *

## 回答 #28

> 赞同：0
> 
> 时间：2020-12-30T17:55:08.617

对于深度克隆，我使用反射如下：

```
public List<T> CloneList<T>(IEnumerable<T> listToClone) {
    Type listType = listToClone.GetType();
    Type elementType = listType.GetGenericArguments()[0];
    List<T> listCopy = new List<T>();
    foreach (T item in listToClone) {
        object itemCopy = Activator.CreateInstance(elementType);
        foreach (PropertyInfo property in elementType.GetProperties()) {
            elementType.GetProperty(property.Name).SetValue(itemCopy, property.GetValue(item));
        }
        listCopy.Add((T)itemCopy);
    }
    return listCopy;
} 
```

您可以交替使用 List 或 IEnumerable。

# c# - C# switch 语句中的变量声明

> ID：222601
> 
> 赞同：141
> 
> 时间：2008-10-21T16:49:26.333
> 
> 标签：c#, switch-statement

为什么在C# switch 语句中，一个变量在多个情况下使用，你只在第一种情况下声明它？

例如，以下会引发错误“已在此范围内定义了名为 'variable' 的局部变量”。

```
switch (Type)
{
    case Type.A:
            string variable = "x";
                break;
    case Type.B:
            string variable = "y";
                break;
} 
```

但是，根据逻辑，如果类型为 ，则不应命中初始声明`Type.B`。switch 语句中的所有变量是否都存在于单个范围内，它们是否在处理任何逻辑之前创建/分配？

* * *

## 回答 #1

> 赞同：264
> 
> 时间：2008-10-21T17:11:49.487

如果您想要一个范围为特定案例的变量，只需将案例包含在它自己的块中：

```
switch (Type)
{
    case Type.A:
    {
        string variable = "x";
        /* Do other stuff with variable */
    }
    break;

    case Type.B:
    {
        string variable = "y";
        /* Do other stuff with variable */
    }
    break;
} 
```

* * *

## 回答 #2

> 赞同：50
> 
> 时间：2008-10-21T16:52:11.197

我相信它与变量的整体范围有关，它是在开关级别定义的块级范围。

就个人而言，如果您在示例中为开关内的某些内容设置值以使其真正有任何好处，那么无论如何您都希望在开关之外声明它。

* * *

## 回答 #3

> 赞同：37
> 
> 时间：2008-10-21T16:52:46.217

是的，范围是整个开关块 - 不幸的是，IMO。但是，您始终可以在单个案例中添加大括号以创建更小的范围。至于它们是否被创建/分配——堆栈框架有足够的空间容纳方法中的所有局部变量（撇开捕获变量的复杂性不谈）。这不像在方法执行期间分配空间。

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2008-10-21T16:52:58.603

因为它们的作用域在 switch 块。[C# 语言规范](http://msdn.microsoft.com/en-us/library/aa664749(VS.71).aspx)声明如下：

> 在 switch 块中声明的局部变量或常量的范围是 switch 块。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-21T16:55:49.643

这些变量在 C# 编译器中共享范围。[但是，范围在CIL](http://en.wikipedia.org/wiki/Common_Intermediate_Language)中的存在方式不同。至于实际的创建/初始化......只要遵循简单的规则，.NET 内存模型就可以让编译器稍微移动读/写，除非变量被标记为[volatile](https://en.wikipedia.org/wiki/Volatile_variable#In_C.23)。

* * *

## 回答 #6

> 赞同：-2
> 
> 时间：2014-06-20T04:06:22.060

`switch`是一个非常原始的程序实现，它从它自己的时代就已经存在`C`（甚至更早`C++`）。

整体`switch`是一个用作范围包含的**块**`GOTO:`（因此`:`in each `case`）。如果您参加了一些汇编程序课程，那可能看起来很熟悉。

这就是为什么use 在与s 结合而不是在每个like中使用`switch`时最有用的原因`Enum``break``case`

```
switch(mood)
{
    case Mood.BORED:
    case Mood.HAPPY:
        drink(oBeer) // will drink if bored OR happy
break;

    case Mood.SAD: // unnecessary but proofs a concept
    default:
        drink(oCoffee)
break;
} 
```

* * *

## 回答 #7

> 赞同：-3
> 
> 时间：2008-10-21T16:53:01.443

初始化发生在案例中，但声明实际上是在作用域的顶部完成的。（伪代码）

```
switch (Type)
{
string variable;

    case Type.A:
            variable = "x";
                break;
    case Type.B:
            variable = "y";
                break;
} 
```

# linux - 在linux中检测键盘、鼠标活动

> ID：222606
> 
> 赞同：32
> 
> 时间：2008-10-21T16:51:03.850
> 
> 标签：linux, keyboard, mouse, android-activity

我需要一种方法来检测 Linux 上的鼠标/键盘活动。类似于任何 IM 程序所做的事情。如果在 5 分钟内未检测到任何活动，它会将您的 IM 状态设置为“我现在不在这里”。

对此的任何帮助表示赞赏。

谢谢。

* * *

## 回答 #1

> 赞同：36
> 
> 时间：2011-09-06T17:51:50.407

或者简单地使用`xprintidle`以毫秒为单位返回空闲时间的命令。

它已被打包用于基于 debian 的系统。（源代码在原始站点 dtek.chalmers.se/~henoch 上不再可用，但您可以在[packages.ubuntu.com](http://packages.ubuntu.com/search?searchon=names&keywords=xprintidle)获得）

[有关freshmeat.net 的更多信息](http://freshmeat.net/projects/xprintidle/?branch_id=61675&release_id=212408)

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2011-01-15T22:07:52.360

完整的[c](/questions/tagged/c "显示标记为“c”的问题")解决方案：（将整个代码剪切并粘贴到终端中）

```
cat>/tmp/idletime.c<<EOF
#include <time.h>
#include <stdio.h>
#include <unistd.h>
#include <X11/Xlib.h>
#include <X11/Xutil.h>
#include <X11/extensions/scrnsaver.h>

int GetIdleTime () {
        time_t idle_time;
        static XScreenSaverInfo *mit_info;
        Display *display;
        int screen;
        mit_info = XScreenSaverAllocInfo();
        if((display=XOpenDisplay(NULL)) == NULL) { return(-1); }
        screen = DefaultScreen(display);
        XScreenSaverQueryInfo(display, RootWindow(display,screen), mit_info);
        idle_time = (mit_info->idle) / 1000;
        XFree(mit_info);
        XCloseDisplay(display); 
        return idle_time;
}

int main() {
        printf("%d\n", GetIdleTime());
        return 0;
}
EOF

gcc -Wall /tmp/idletime.c -o /tmp/idletime -L/usr/X11R6/lib/ -lX11 -lXext -lXss 
DISPLAY=:0 /tmp/idletime 
```

（主要部分来自 X11::IdleTime perl 模块）

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-21T18:53:00.813

当有更好的方法可用时不要轮询。

您没有指定环境，但由于您提到鼠标，我将假设现代 X11。

[xidle](http://www.freshports.org/x11/xidle/)使用 MIT-SCREEN-SAVER 扩展来判断用户是否空闲——你可以`xidle`直接使用，或者阅读它的源代码来学习如何自己使用 XScreenSaver(3)。

## 编辑

[`man 3 XScreenSaver`](http://www.xfree86.org/current/Xss.3.html)`XIDLE`-- 只需使用它的空闲报告/通知部分，因为自 X11R6以来没有更多的扩展。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2011-01-12T17:23:53.173

我的方法是使用 ad-hoc perl 模块：

```
# cpan -i X11::IdleTime; sleep 2; perl -MX11::IdleTime -e 'print GetIdleTime(), $/;' 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-21T16:54:21.020

尝试`who -u -H`在命令行执行。它会告诉您谁已登录以及他们空闲了多长时间。至少有用户登录到一个终端；我认为它在 X 中根本不起作用。无论如何，通过这些信息，您可以判断谁处于空闲状态并采取适当的措施。

如果你在 X 中，你可以创建一个脚本来作为屏幕保护程序或类似的东西运行。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2018-06-19T01:22:37.877

这是一个如何使用`xprintidle`shell 脚本检查用户是否空闲 5 分钟的示例：

```
#!/bin/sh
idletime=$(xprintidle)
threshold=300000 # 5 min = 5 * 60 * 1000 ms
if [ "$idletime" -gt "$threshold" ]; then
  echo "idle"
fi 
```

`xprintidle`以毫秒为单位返回时间。

该脚本不进行任何轮询或类似操作。它仅在用户空闲时执行一些代码，否则不执行任何操作。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2016-09-08T11:03:57.560

我编写了[wait-while-idle.rb](https://gist.github.com/siers/3b97d3f84347e8600985ce19bf5fb35b)，它执行*“检测 linux 中的键盘、鼠标活动”，*但反过来——等到用户回来。

是的，当然——这是轮询，但我怀疑这里是否有人需要性能。

计划用它和一些脚本来抓住恶作剧者偷偷溜进我的电脑。

# regex - 向正则表达式添加 AND 子句

> ID：222629
> 
> 赞同：3
> 
> 时间：2008-10-21T16:56:13.667
> 
> 标签：regex

我有这个简单的正则表达式，

```
[\d]{1,5} 
```

匹配 0 到 99999 之间的任何整数。

我将如何修改它使其不匹配 0，但匹配 01 和 10 等？

我知道有一种方法可以像这样进行 OR...

```
[\d]{1,5}|[^0]{1} 
```

（没有多大意义）

有办法做AND吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-21T16:59:55.393

可能会更好，例如：

0*[1-9]+[\d]{0,4}

如果我是对的，则转换为“零个或多个零后跟至少一个包含在 '1-9' 中的字符，然后最多 4 个尾随十进制字符”

麦克风

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-21T17:09:16.013

我认为最简单的方法是：

```
[1-9]\d{0,4} 
```

如果对您的情况有意义，请将其放在 ^$ 之间，如果是，请在开头添加 0* ：

```
^0*[1-9]\d{0,4}$ 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-21T16:59:06.173

我的投票是保持正则表达式简单，并将其作为正则表达式之外的单独比较。如果正则表达式通过，将其转换为 int 并确保转换后的值 > 0。

但我知道有时配置文件中的一个正则表达式或控件上的验证属性就是你所得到的。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-21T17:01:35.640

您将接受的一位数字与多位数字之间的 OR 怎么样：

**^[1-9]$|^\d{2,5}$**

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-21T17:45:13.070

我认为消极的前瞻会起作用。试试这个：

```
#!/bin/perl -w

while (<>)
{
    chomp;
    print "OK: $_\n" if m/^(?!0+$)\d{1,6}$/;
} 
```

示例跟踪：

```
0
00
000
0000
00000
000000
0000001
000001
OK: 000001
101
OK: 101
01
OK: 01
00001
OK: 00001
1000
OK: 1000
101
OK: 101 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-21T17:17:47.633

通过使用前瞻，您可以实现 AND 的效果。

```
^(?=regex1)(?=regex2)(?=regex3).* 
```

尽管 Internet Explorer 中存在错误，但有时不会将`(?= )`其视为零宽度。

[http://blog.stevenlevithan.com/archives/regex-lookahead-bug](http://blog.stevenlevithan.com/archives/regex-lookahead-bug)

在你的情况下：

```
^(?=\d{1,5}$)(?=.*?[1-9]).* 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-21T17:35:29.813

看起来您正在搜索 2 个不同的条件。为什么不将其分解为 2 个表达式？它可能更简单，更具可读性。

```
var str = user_string;
if ('0' != str && str.matches(/^\d{1,5}$/) {
    // code for match
} 
```

如果一串 0 也无效，则为以下内容

```
var str = user_string;
if (!str.matches(/^0+$/) && str.matches(/^\d{1,5}$/) {
    // code for match
} 
```

仅仅因为您可以在一个正则表达式中完成所有操作并不意味着您应该这样做。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-21T17:23:19.167

```
^([1-9][0-9]{0,4}|[0-9]{,1}[1-9][0-9]{,3}|[0-9]{,2}[1-9][0-9]{,2}|[0-9]{,3}[1-9][0-9]|[0-9]{,4}[1-9])$ 
```

不漂亮，但它应该工作。这更像是一种蛮力方法。还有一种更好的方法可以通过分组来实现，但我目前对实际实现持空白。

# php - 我应该使用多字节重载（mbstring.func_overload）吗？

> ID：222630
> 
> 赞同：5
> 
> 时间：2008-10-21T16:56:58.177
> 
> 标签：php, unicode

我正在使我的 PHP 站点支持 Unicode。我想知道是否有人对`mbstring.func_overload`设置有经验，它将普通字符串函数（例如`strlen`）替换为它们的多字节等效项（`mb_strlen`）。PHP 手册页上没有任何评论。

是否有任何我应该注意的潜在问题？在任何情况下调用多字节版本都是一个坏主意？

我想一个例子是处理加密的函数，因为它们可能期望处理字节串，而不是字符串。

此外，手册页包含一条注释：“不建议在每个目录上下文中使用函数重载选项，因为尚未确认它在生产环境中足够稳定，并且可能导致未定义的行为。”

这是否意味着它在每个目录的上下文中不稳定，或者它通常不稳定？措辞不清楚。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2012-01-24T10:28:34.443

我的回答是：*绝对不是*！

问题是一旦 str* 函数重载，就没有简单的方法可以“重置”它们。

在一段时间内，这可以很好地与您的项目配合使用，但几乎可以肯定的是，您会遇到使用字符串函数来实现二进制协议的外部库，并且它们会失败。他们会失败，你将花费数小时试图找出他们失败的原因。

当你发现它是`mbstring.func_overload`，你没有太多的选择。您可以在每次调用外部库时将 ini_set 设置`mbstring.internal_encoding`为每字符一个字节的编码并在之后立即将其设置回来，但是如果您的库对您的应用程序进行回调，它只会把事情搞砸。

另一种选择是手动调整库，将所有 str* 函数更改为它们的 mb_string 对应项，并将每个字符一个字节作为编码参数。然而，这也不是一个好主意，因为您失去了轻松更新外部的能力，并且您也可能导致一些性能问题。

所以，再次，不要使用`func_overload`. 如果您使用多字节字符串，请使用适当的 mb_ 函数。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-21T17:05:35.973

您绝对应该注意的一个问题是使用非 mb 感知版本的函数的 3rd 方脚本（可能是库或 pear 扩展）。例如，`strlen()`如果您重载它，使用的库可能会导致问题。

同样，此[错误报告](http://bugs.php.net/bug.php?id=27421)显示 mb_overloaded 函数的虚拟主机出血已在 5.2/5.3 CVS 版本中得到纠正。该错误特定于每个目录的配置。

# c# - Winforms 问题 - 创建窗口句柄时出错

> ID：222649
> 
> 赞同：70
> 
> 时间：2008-10-21T17:01:13.207
> 
> 标签：c#, windows, winforms, window-handles

我们在 Winform 应用程序中看到此错误。任何人都可以帮助您了解为什么会看到此错误，更重要的是如何修复它或避免它发生。

```
System.ComponentModel.Win32Exception：创建窗口句柄时出错。
   在 System.Windows.Forms.NativeWindow.CreateHandle（CreateParams cp）
   在 System.Windows.Forms.Control.CreateHandle()
   在 System.Windows.Forms.Control.CreateControl（布尔 fIgnoreVisible）
   在 System.Windows.Forms.Control.CreateControl()
   在 System.Windows.Forms.Control.OnVisibleChanged（EventArgs e）
   在 System.Windows.Forms.ButtonBase.OnVisibleChanged（EventArgs e）

```

* * *

## 回答 #1

> 赞同：52
> 
> 时间：2008-10-21T18:06:09.563

您是否运行过 Process Explorer 或 Windows 任务管理器来查看 GDI 对象、句柄、线程和 USER 对象？如果没有，请选择要查看的那些列（任务管理器选择查看-> 选择列...然后运行您的应用程序并查看该应用程序的这些列，看看其中一个是否变得非常大。

可能是您有一些您*认为*已清理但尚未处置的 UI 组件。

[这是一个关于此的链接](http://blogs.msdn.com/jfoscoding/articles/450835.aspx)，可能会有所帮助。

祝你好运！

* * *

## 回答 #2

> 赞同：27
> 
> 时间：2008-11-21T21:38:49.183

应用程序的 Windows 句柄限制为 10,000 个句柄。您收到错误是因为您的程序创建了太多句柄。您需要找到内存泄漏。正如其他用户所建议的，使用 Memory Profiler。我也使用 .Net Memory Profiler。此外，如果您在窗体关闭*之前*从窗体中删除它们，请确保调用控件的 dispose 方法（否则控件不会释放）。您还必须确保没有向控件注册的事件。我自己也有同样的问题，尽管我已经知道了，但我仍然有一些内存泄漏继续困扰着我。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2009-08-08T00:35:37.800

请参阅[我的这篇关于“创建窗口句柄时出错”的帖子](http://weblogs.asp.net/fmarguerie/archive/2009/08/07/cannot-create-window-handle-desktop-heap.aspx)以及它与用户对象和桌面堆的关系。我提供一些解决方案。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2010-02-08T14:36:27.650

这个问题几乎总是与 GDI 对象计数、用户对象计数或句柄计数有关，并且通常**不是**因为您的机器上的内存不足。

当我跟踪其中一个错误时，我打开 ProcessExplorer 并查看以下列：句柄、线程、GDI 对象、用户对象、私有字节、虚拟大小和工作集。

（根据我的经验，问题通常是由于事件处理程序持有对象并阻止它被释放而导致的对象泄漏。）

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2010-03-18T12:38:47.463

好吧，就我而言，绝对是失控的用户对象。我查看了 Windows 任务管理器，果然，用户对象数正好是 10'000。

我通过将属性或列表表的容器面板的 Parent 属性设置为选项卡页的属性，在选项卡页中动态嵌入属性和列表表。我有条件地回收或重新创建属性和列表表单，具体取决于列出的集合类型或被检查对象的类类型。

注意：在 Delphi 中，所有控件都有 Owner 和 Parent 属性。即使更改了控件的 Parent 属性，当拥有的控件被销毁时，它仍然会由其所有者处置。

在 C# 中，如果通过更改 Panel.Parent 属性以编程方式将控件（例如 Panel）从 Form 重新分配到 Tab Page，则在 Form 上调用 Dispose() 不会释放 Panel，调用 Controls 也不会.Clear() 在标签页上。即使是直接调用 Panel.Dispose() 也不会真正处置它，除非它的 Parent 事先手动设置为 null 。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-21T17:13:34.413

我认为这通常与计算机内存不足有关，因此它无法再创建任何窗口句柄。通常，此时 Windows 也会开始显示一些奇怪的行为。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-09-01T19:10:53.493

我在我的应用程序中遇到了同样的错误。我在单页中加载了许多控件。在按钮单击事件中，我正在清除控件。清除控件不会从内存中释放控件。所以从内存中处理控件。我只是注释了 controls.clear() 方法并包含几行代码来处理控件。像这样的东西

对于每个 ctl 作为 controlcollection 中的控件

ctl.dispose()

下一个

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2012-03-21T19:32:03.880

我添加了一个检查，使它工作......

```
if (_form.Handle.ToInt32() > 0)
{
   _form.Invoke(method, args);
} 
```

它总是正确的，但没有它，表单会引发错误。顺便说一句，我的句柄在 490 万左右

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2010-06-01T02:25:55.953

肯定有太多句柄（内存泄漏问题）：

[IT Jungles：System.ComponentModel.Win32Exception：创建窗口句柄时出错](http://www.itjungles.com/dotnet/system-componentmodel-win32exception-error-creating-window-handle)

* * *

## 回答 #10

> 赞同：-2
> 
> 时间：2008-10-21T18:11:55.747

内存不足的建议似乎不是一个坏的线索。

你的程序在做什么，它得到这个错误？

它是否创建了大量的窗口或控件？它是否以编程方式而不是在设计时创建它们？如果是这样，您是否循环执行此操作？那个循环是无限的吗？您是否以其他方式消耗了大量的内存？

当您在任务管理器中查看应用程序使用的内存时会发生什么？它会飙升到月球吗？或者更好的是，如上所述，使用进程监视器来深入了解细节。

# ios - 在 UITableViewCell 中更改 UILabel 的背景颜色

> ID：222652
> 
> 赞同：11
> 
> 时间：2008-10-21T17:01:25.077
> 
> 标签：ios, objective-c, cocoa-touch

一个 UITableViewCell 是“预建的”，它带有一个 UILabel 作为它的一个，并且在你初始化它之后唯一的子视图。我*真的*很想改变所说标签的背景颜色，但无论我做什么颜色都不会改变。有问题的代码：

```
UILabel* label = (UILabel*)[cell.contentView.subviews objectAtIndex:0];
label.textColor = [UIColor whiteColor];
label.backgroundColor = [UIColor darkGrayColor];
label.opaque = YES; 
```

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-21T17:13:01.280

您的代码片段对我来说很好，但我相信必须在将单元格添加到表格并显示之后才能完成。如果从 调用`initWithFrame:reuseIdentifier:`，你会得到一个异常，因为`UILabel` **子视图**还没有被创建。

可能最好的解决方案是添加您自己的`UILabel`，配置为您的标准，而不是依赖于这个（非常摇摇晃晃的）路径到内置路径。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2010-11-07T20:48:34.293

这不起作用，因为 UITableViewCell 在 layoutSubviews 方法中设置了它的标签 backgroundColors。

如果要更改内置 textLabel 或 detailTextLabel 的颜色，请将 UITableViewCell 子类化并覆盖 layoutSubviews。调用超级实现，然后将 backgroundColor 属性更改为您想要的。

```
- (void) layoutSubviews
{   
     [super layoutSubviews];

     self.textLabel.backgroundColor = [UIColor redColor];
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-21T20:43:01.400

在分配单元格时将自己的标签添加到 contentView 中，而不是依赖于内置标签的提取。然后您可以控制所有值：

```
UILabel* label = [[[UILabel alloc] init] autorelease];
label.textColor = [UIColor whiteColor];
label.backgroundColor = [UIColor darkGrayColor];
label.opaque = YES;
[cell.contentView addSubview:label]; 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-09-06T10:59:40.053

```
for (UIView *views in views.subviews)
{
    UILabel* temp = (UILabel*)[views.subviews objectAtIndex:0];
    temp.textColor = [UIColor whiteColor];        
    temp.shadowColor = [UIColor blackColor];
    temp.shadowOffset = CGSizeMake(0.0f, -1.0f);
} 
```

# c# - 将程序集嵌入另一个程序集

> ID：222655
> 
> 赞同：41
> 
> 时间：2008-10-21T17:01:46.840
> 
> 标签：c#, .net, dll, assemblies

如果您创建一个使用来自其他程序集的东西的类库，是否可以将这些其他程序集作为某种资源嵌入到类库中？

即不是让*MyAssembly.dll*，*SomeAssembly1.dll*和*SomeAssembly2.dll*坐在文件系统上，其他两个文件被捆绑到*MyAssembly.dll*中并且可以在其代码中使用。

* * *

我也有点困惑为什么 .NET 程序集是*.dll*文件。这种格式在.NET 之前不存在吗？是否所有 .NET 程序集 DLL，但并非所有 DLL 都是 .NET 程序集？为什么他们使用相同的文件格式和/或文件扩展名？

* * *

## 回答 #1

> 赞同：59
> 
> 时间：2009-03-09T05:27:20.253

ILMerge 确实合并程序集，这很好，但有时不是您想要的。例如，当所讨论的程序集是一个强名称程序集，而您没有它的密钥时，您将无法在不破坏该签名的情况下执行 ILMerge。这意味着您必须部署多个程序集。

作为 ilmerge 的替代方法，您可以将一个或多个程序集作为资源嵌入到您的 exe 或 DLL 中。然后，在运行时，当程序集被加载时，您可以以编程方式提取嵌入式程序集，然后加载并运行它。这听起来很棘手，但只有一点样板代码。

为此，请嵌入程序集，就像嵌入任何其他资源（图像、翻译文件、数据等）一样。然后，设置一个在运行时调用的 AssemblyResolver。它应该在启动类的静态构造函数中设置。代码非常简单。

```
 static NameOfStartupClassHere()
    {
        AppDomain.CurrentDomain.AssemblyResolve += new ResolveEventHandler(Resolver);
    }

    static System.Reflection.Assembly Resolver(object sender, ResolveEventArgs args)
    {
        Assembly a1 = Assembly.GetExecutingAssembly();
        Stream s = a1.GetManifestResourceStream(args.Name);
        byte[] block = new byte[s.Length];
        s.Read(block, 0, block.Length);
        Assembly a2 = Assembly.Load(block);
        return a2;
    } 
```

ResolveEventArgs 参数的 Name 属性是要解析的程序集的名称。此名称指的是资源，而不是文件名。如果嵌入名为“MyAssembly.dll”的文件，并调用嵌入的资源“Foo”，那么这里需要的名称是“Foo”。但这会令人困惑，所以我建议使用程序集的文件名作为资源的名称。如果您已正确嵌入并命名程序集，则只需使用程序集名称调用 GetManifestResourceStream() 并以这种方式加载程序集。非常简单。

这适用于多个程序集，就像使用单个嵌入式程序集一样好。

在一个真实的应用程序中，您会希望在该例程中进行更好的错误处理 - 比如如果没有给定名称的流怎么办？如果读取失败会发生什么？等等，但这留给你做。

在其余的应用程序代码中，您照常使用程序集中的类型。

构建应用程序时，您需要像往常一样添加对相关程序集的引用。如果使用命令行工具，请使用 csc.exe 中的 /r 选项；如果您使用 Visual Studio，则需要在项目的弹出菜单中添加“添加引用...”。

在运行时，程序集版本检查和验证照常工作。

唯一的区别是分布。当您部署或分发您的应用程序时，您不需要分发嵌入（和引用）程序集的 DLL。只需部署主程序集；无需分发其他程序集，因为它们已嵌入到主 DLL 或 EXE 中。

* * *

## 回答 #2

> 赞同：35
> 
> 时间：2008-10-21T17:11:05.417

查看**[ILMerge](http://www.microsoft.com/downloads/details.aspx?FamilyID=22914587-b4ad-4eae-87cf-b14ae6a939b0&displaylang=en)**以合并程序集。

> 我也有点困惑为什么 .NET 程序集是 .dll 文件。这种格式在.NET 之前不存在吗？

是的。

> 都是 .NET 程序集 DLL，

通常是 DLL 或 EXE - 但也可以是 netmodule。

> 但并非所有 DLL 都是 .NET 程序集？

正确的。

> 为什么他们使用相同的文件格式和/或文件扩展名？

为什么它应该有所不同 - 它的目的是相同的！

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-10-21T17:11:24.807

您**可以**将程序集（或任何文件，实际上）嵌入为资源（然后使用`ResourceManager`类来访问它们），但如果您只想组合程序集，最好使用像[ILMerge](http://research.microsoft.com/~mbarnett/ILMerge.aspx)这样的工具。

EXE 和 DLL 文件是[Windows 可移植可执行文件](http://en.wikipedia.org/wiki/Portable_Executable)，它们足够通用，可以容纳未来的代码类型，包括任何 .NET 代码（它们也可以在 DOS 中运行，但只显示一条消息，指出它们不应该在 DOS 中运行）。它们包括启动 .NET 运行时（如果它尚未运行）的说明。单个程序集也有可能跨越多个文件，尽管这种情况几乎从未发生过。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-05-13T22:51:13.760

注意 ILMerge 不适用于 XAML 等嵌入式资源，因此 WPF 应用程序等需要使用 Cheeso 的方法。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-10-21T17:19:42.810

[Mono 项目](http://www.mono-project.com/Mono:Runtime)还提供了 mkbundle 实用程序

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2012-12-10T19:53:44.523

为什么他们使用相同的文件格式和/或文件扩展名？

> > 为什么它应该有所不同 - 它的目的是相同的！

我在这里澄清一下 2 美分：DLL 是动态链接库。旧式 .dll（C 代码）和 .net 式 .dll 都是定义为“动态链接”库。所以 .dll 是对两者的正确描述。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2016-01-14T22:52:21.897

关于 Cheeso 将程序集嵌入为资源并使用 Load(byte[]) 重载使用 AssemblyResolve 事件处理程序动态加载它们的答案，您需要修改解析器以检查 AppDomain 以获取要加载和如果已经加载，则返回现有的程序集实例。

使用该重载加载的程序集没有上下文，这可能导致框架尝试多次重新加载程序集。如果不返回已加载的实例，您最终可能会得到相同程序集代码和类型的多个实例，这些实例应该相等但不相等，因为框架认为它们来自两个不同的程序集。

为加载到“无上下文”中的同一个程序集生成多个 AssemblyResolve 事件的至少一种方法是，当您引用从加载到 AppDomain 中的多个程序集中公开的类型时，因为代码执行需要解析这些类型。

[https://msdn.microsoft.com/en-us/library/dd153782%28v=vs.110%29.aspx](https://msdn.microsoft.com/en-us/library/dd153782%28v=vs.110%29.aspx)

链接中的几个要点：

“其他程序集无法绑定到在没有上下文的情况下加载的程序集，除非您处理 AppDomain.AssemblyResolve 事件”

“在没有上下文的情况下加载具有相同标识的多个程序集可能会导致类型标识问题，类似于将具有相同标识的程序集加载到多个上下文中所导致的问题。请参阅避免将程序集加载到多个上下文中。”

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2018-11-14T06:33:56.440

我建议你试试[Costura.Fody](https://github.com/Fody/Costura)。只是不要忘记在 Costura.Fody 之前安装包 Fody（以获得最新的 Fody！）

# c++ - 多重集、映射和哈希映射复杂性

> ID：222658
> 
> 赞同：80
> 
> 时间：2008-10-21T17:02:33.717
> 
> 标签：c++, complexity-theory, big-o

在以下情况下，我想知道 STL 多重集、映射和哈希映射类的 Big O 表示法的复杂性：

*   插入条目
*   访问条目
*   检索条目
*   比较条目

* * *

## 回答 #1

> 赞同：113
> 
> 时间：2008-10-21T17:08:55.267

# map、set、multimap 和 multiset

这些是使用[红黑树](http://en.wikipedia.org/wiki/Red-black_tree)（一种[平衡二叉搜索树](http://en.wikipedia.org/wiki/Balanced_binary_search_tree)）实现的。它们具有以下渐近运行时间：

插入：O(log n)
查找：O(log n)
删除：O(log n)

# hash_map、hash_set、hash_multimap 和 hash_multiset

这些是使用[哈希表](http://en.wikipedia.org/wiki/Hash_table)实现的。它们具有以下运行时：

插入：预期 O(1)，最坏情况 O(n)
查找：预期 O(1)，最坏情况 O(n)
删除：预期 O(1)，最坏情况 O(n)

如果您使用适当的哈希函数，您几乎永远不会看到最坏的情况，但请牢记这一点——请参阅Crosby 和 Wallach 的[通过算法复杂性攻击拒绝服务](http://www.usenix.org/events/sec03/tech/full_papers/crosby/crosby.pdf)的示例。

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2021-08-20T17:47:23.843

对于**set**、**multiset**、**map**、**multimap**，插入、删除和检索信息的时间复杂度为**O(logn)**，因为它们遵循平衡二叉树来构造数据。

对于**unordered_set**和**unordered_map**，使用**散列**方法来构造数据。所以这个时间复杂度是**O(1)**。这是对信息执行任何操作的完美方式，以防您的先决条件是没有按排序顺序排列的数据。

# .net - 我可以从存储过程中返回 varchar(max) 吗？

> ID：222661
> 
> 赞同：10
> 
> 时间：2008-10-21T17:03:59.707
> 
> 标签：.net, sql-server-2005, stored-procedures

带有 SQL Server 2005 后端的 VB.net Web 系统。我有一个返回 varchar 的存储过程，我们终于得到了不适合 varchar(8000) 的值。

我已将返回参数更改为 varchar(max)，但如何告诉 OleDbParameter.Size 属性接受任意数量的文本？

作为一个具体的例子，从存储过程中获取返回参数的 VB 代码过去看起来像：

```
objOutParam1 = objCommand.Parameters.Add("@RStr", OleDbType.varchar)
objOutParam1.Size = 8000
objOutParam1.Direction = ParameterDirection.Output 
```

我可以使 .Size 与（最大）一起使用什么？

更新：

回答一些问题：

出于所有意图和目的，此文本都需要作为一个整体出现。（改变这一点需要比我想做的更多的结构性工作 - 或者被授权，真的。）

如果我没有设置大小，我会收到错误消息“String[6]：Size 属性的大小为 0 无效。”

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-21T17:14:58.810

你可以使用 ADO.NET 吗？

**编辑：**为了澄清，我只是建议您可能要考虑 ADO.NET，因为您正在使用 VB.NET 2005 和 SQL Server 2005--OLEDB 是访问数据库的 pre-.NET 方式，所以您可能会发现通过使用 ADO.NET 来获得更大的灵活性。

您不应该从存储过程中返回 VARCHAR。我什至不确定你能不能。

但是，如果您使用 OUT 参数，则不必按大小指定它。例如：

```
SqlParameter p = new SqlParameter("@RStr", SqlDbType.VarChar);
p.Direction = ParameterDirection.Output; 
```

不确定这是否适合您的需求，但它应该可以正常工作。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-10-21T18:51:59.970

赞成 Ed Altofer。（他先回答，所以如果你喜欢我的回答，也投票给他）。

OleDb 是你的问题。它是一个通用的数据库连接，需要与 SQL Server 进行通信，因此您会遇到最低公分母情况，即只能完全支持最弱的复合功能集。丢失的功能之一是 varchar(max) 支持。

您正在使用 SQL Server 2005 和 VB.Net。是什么阻止您使用 System.Data.SqlClient 而不是 System.Data.OleDb？

**编辑**
我找到了关于这个问题的文档。见这里：http:
[//msdn.microsoft.com/en-us/library/ms131035.aspx](http://msdn.microsoft.com/en-us/library/ms131035.aspx)

相关部分：

> 数据类型**varchar(max)、nvarchar(max)、varbinary(max)、xml、udt**或其他大型对象类型的返回值不能返回到 SQL Server 2005 之前的客户端版本。如果您希望将这些类型用作返回值，您必须使用 SQL Server Native Client。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-11-05T17:33:59.767

我认为使用 -1 作为大小会起作用。至少它应该与 ADO.NET 一起使用。像这样：

objOutParam1 = objCommand.Parameters.Add("@RStr", OleDbType.varchar, -1)

这是一篇很长的文章，但它显示在最后一个示例中使用了 -1：

[http://msdn.microsoft.com/en-us/library/bb399384.aspx](http://msdn.microsoft.com/en-us/library/bb399384.aspx)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-21T17:07:16.797

您是否尝试过不指定尺寸？
你能返回一个 TEXT 而不是一个 VARCHAR(MAX) 吗？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-21T17:07:16.517

这个大字符串是什么样子的？是否可以通过附加记录集更好地返回某些内容，或者只是注释文本？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-21T17:33:19.380

您是否尝试过指定：

```
objOutParam1.Size = Int32.MaxValue; 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-05T10:29:41.917

只需使用 int.MaxValue 作为参数大小。存储过程中的 byte[] 将具有正确的长度。（我实际使用的是 varbinary，但结果是一样的）。

```
 param.Size = int.MaxValue;
 param.SqlDbType = SqlDbType.VarBinary; 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-05T10:48:57.573

您是否尝试过使用“ [OleDbType.LongVarChar](http://www.carlprothman.net/Technology/DataTypeMapping/tabid/97/Default.aspx) ”，这种类型映射到 SQL server 2K 中的 Text，并且可以让您检索超过 8K 的字符。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-04-09T14:18:50.133

-1 选项效果很好。我在从存储过程返回 varchar(max) 的几种情况下使用它。

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2008-10-21T21:36:18.393

简短的回答是使用 TEXT 而不是 VARCHAR(max)。8K 是数据库页面的最大大小，除了 BLOB 和 TEXT 之外，所有数据列都应放入其中。这意味着，由于您的其他列，您的可用容量小于 8k。

BLOB 和 TEXT 是如此的 Web 1.0。更大的行意味着更大的数据库复制时间和更大的文件 I/O。我建议您为此维护一个带有 HTTP 接口的单独文件服务器。

而且，对于上一栏

DataUrl VARCHAR(255) 非空，

插入新行时，首先计算数据的 MD5 校验和。其次，将数据以校验和作为文件名上传到文件服务器。三、INSERT INTO ...(...,DataUrl) VALUES(..., " [http://fileserver/get?id=](http://fileserver/get?id=) " . md5_checksum_data)

通过这种设计，即使平均数据大小变为 1000 倍，您的数据库也将保持平静。

# c++ - 用于 C++ 的 XML-RPC 库

> ID：222667
> 
> 赞同：5
> 
> 时间：2008-10-21T17:06:30.997
> 
> 标签：c++, c, xml-rpc

哪些库可用于在本机 C++ 或 C 中编写 xml-rpc 客户端？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-21T17:13:06.817

您可能想查看[xmlrpc-c](http://xmlrpc-c.sourceforge.net/)或[xmlrpc++](http://xmlrpcpp.sourceforge.net/)。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-21T18:15:14.320

我找到了[许多不同语言的 xml-rpc 实现列表](http://www.xmlrpc.com/directory/1568/implementations)。希望这份清单对其他人有用。

# .net - 哪个Web服务框架？

> ID：222668
> 
> 赞同：1
> 
> 时间：2008-10-21T17:07:07.983
> 
> 标签：.net, web-services

我即将开始将基于 C# 的桌面应用程序转换为基于 Web 的应用程序。出于几个原因，我想通过 Web 服务从逻辑中删除 GUI。微软有 asmx 文件、WCF 以及下周在 PDC 上可能会有的新东西。数据可以通过 SOAP、REST、JSON 以及可能的 12 种其他方式传递。

任何人都可以建议我应该开始使用的 .NET 框架吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-21T17:24:57.557

你即将搬到一个新的平台。我会去WCF。它可以支持您的所有需求。

最初，当您移动时，您可以使用 httpBinding，它非常接近 ASMX Web 服务并且基于 SOAP。如果您以后需要一些高级功能，那么您绝对可以使用 webHttpBinding，这将为您提供基于 REST 和 JSON 的接口。WCF 是非常强大的编程模型，您绝对应该转向它。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-21T17:14:18.157

我投票给 WCF，放下手。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-21T17:21:10.247

如果您想要 SOAP、REST 和 JSON 选项，那么您可能想要查看[WCF Web Programming Model](http://msdn.microsoft.com/en-us/library/bb412169.aspx)和[WCF JSON support](http://msdn.microsoft.com/en-us/library/bb412187.aspx)，尽管我个人对 REST 实现并不满意。但是 WCF 以牺牲[配置地狱](http://msdn.microsoft.com/en-us/library/ms731734.aspx "WCF 配置架构")为代价提供了最大的灵活性。一定要熟悉它的[诊断和 svcTraceViewer](http://msdn.microsoft.com/en-us/library/ms732023.aspx)，以免你得到神秘的、无用的异常。并注意生成的客户端[对一次性模式的破坏实现](http://www.iserviceoriented.com/blog/post/Indisposable+-+WCF+Gotcha+1.aspx)。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-21T17:30:13.303

对于像您这样的桌面应用程序，将数据作为 JSON 传递没有多大意义。它的主要用途是允许从网络浏览器更轻松地访问。尽管它们服务于不同的目的，但对于 REST 来说也是如此。

在我看来，对于两个 .NET 应用程序的通信，WCF 是要走的路。虽然对于许多人来说，ASMX 更容易符合他们的思维方式（只需用 WebMethodAttribute 装饰一些东西就完成了），但我不推荐它，因为缺乏体面的授权/身份验证/加密（任意选择）及其方式微软似乎不再鼓励使用。

顺便说一下，您还可以看看[WSCF - Web Services Contract First](http://www.thinktecture.com/resourcearchive/tools-and-software/wscf)。不幸的是，现在您有更多选择可供选择。:)

# linq-to-sql - 分布式缓存帮助

> ID：222676
> 
> 赞同：0
> 
> 时间：2008-10-21T17:09:46.917
> 
> 标签：linq-to-sql, serialization, caching

我正在尝试使用一些分布式缓存，我正在使用这个[indeXus.Net Shared Cache](http://www.sharedcache.com/cms/homepage.aspx)。

它要求被缓存的对象是可序列化的，这里就是类对象。

```
[Serializable]
public class Members 
{
    public Members()
    {}

    public Members(string aspnetusername, string aspnetpassword,
        string emailaddr,string location)
        : this(0,0,aspnetusername, aspnetpassword,emailaddr,DateTime.Now, location,
        0,0,DateTime.Now,DateTime.Now,DateTime.Now,false)
    { }

    public Members(Int64? row,int memberid, string aspnetusername, string aspnetpassword,
        string emailaddr,DateTime datecreated, string location, int daimokugoal, int previewimageid,
        DateTime lastdaimoku, DateTime lastnotifed, DateTime lastactivitydate, bool isactivated)
    {
        this.Row = row;
        this.MemberID = memberid;
        this.Aspnetusername = aspnetusername;
        this.Aspnetpassword = aspnetpassword;
        this.EmailAddr = emailaddr;
        this.DateCreated = datecreated;
        this.Location = location;
        this.DaimokuGoal = daimokugoal;
        this.PreviewImageID = previewimageid;
        this.LastDaimoku = lastdaimoku;
        this.LastNotefied = lastnotifed;
        this.LastActivityDate = lastactivitydate;
        this.IsActivated = this.IsActivated;
        this.Details = new LazyList<MemberDetails>();
        this.Blogs = new LazyList<MemberBlogs>();
        this.Daimoku = new LazyList<MemberDaimoku>();
        this.Determinations = new LazyList<MemberDeterminations>();
        this.Encouragements = new LazyList<MemberEncouragements>();
        this.Entries = new LazyList<MemberEntries>();
        this.Friends = new LazyList<MemberFriends>();
        this.Stats = new LazyList<MemberStats>();

    }

   public Int64? Row { get; set; }     
   public int MemberID { get; set; }
   public string Aspnetusername { get; set; }
   public string Aspnetpassword { get; set; }
   public string EmailAddr { get; set; }
   public DateTime DateCreated { get; set; }
   public string Location { get; set; }
   public int DaimokuGoal { get; set; }
   public int PreviewImageID { get; set; }
   public DateTime LastDaimoku { get; set; }
   public DateTime LastNotefied { get; set; }
   public DateTime LastActivityDate { get; set; }
   public bool IsActivated { get; set; }
   public LazyList<MemberDetails> Details { get; set; }
   public LazyList<MemberBlogs> Blogs { get; set; }
   public LazyList<MemberDaimoku> Daimoku { get; set; }
   public LazyList<MemberDeterminations> Determinations { get; set; }
   public LazyList<MemberEncouragements> Encouragements { get; set; }
   public LazyList<MemberEntries> Entries { get; set; }
   public LazyList<MemberFriends> Friends { get; set; }
   public LazyList<MemberStats> Stats { get; set; }
} 
```

LINQtoSql 就是填充这个类的。

```
 public IQueryable<Members> GetMemberInfo()
      {
          using (var t = new TransactionScope(TransactionScopeOption.Required,
                    new TransactionOptions { IsolationLevel = System.Transactions.IsolationLevel.ReadUncommitted }))
          {
              var results = from m in _datacontext.ViewMembers
                            let details = GetMemberDetails(m.MemberID)
                            let determinations = GetMemberDeterminations(m.MemberID)
                            let daimoku = GetMemberDaimoku(m.MemberID)
                            let entries = GetMemberEntries(m.MemberID)
                            let blogs = GetMemberBlogs(m.MemberID)
                            let encouragements = GetMemberEncouragements(m.MemberID)
                            let friends = GetMemberFriends(m.MemberID)
                            let points = GetMemberStats(m.MemberID)
                            select new Members
                            {
                                Row = m.Row,
                                MemberID = m.MemberID,
                                Aspnetusername = m.Aspnetusername,
                                Aspnetpassword = m.Aspnetpassword,
                                EmailAddr = m.EmailAddr,
                                DateCreated = m.DateCreated,
                                Location = m.Location,
                                DaimokuGoal = m.DaimokuGoal,
                                PreviewImageID = m.PreviewImageID,
                                LastDaimoku = m.LastDaimoku.Value,
                                LastNotefied = m.LastNotefied.Value,
                                LastActivityDate = m.LastActivityDate.Value,
                                IsActivated = m.IsActivated,
                                Details = new LazyList<MemberDetails>(details),
                                Determinations = new LazyList<MemberDeterminations>(determinations),
                                Daimoku = new LazyList<MemberDaimoku>(daimoku),
                                Entries = new LazyList<MemberEntries>(entries),
                                Blogs = new LazyList<MemberBlogs>(blogs),
                                Encouragements = new LazyList<MemberEncouragements>(encouragements),
                                Friends = new LazyList<MemberFriends>(friends),
                                Stats = new LazyList<MemberStats>(points)
                            };
              return results;
          }
      } 
```

但由于某种原因，我收到了这个错误

System.Runtime.Serialization.SerializationException：类型'System.Data.Linq.DataQuery`1[[DaimokuBeta.MVC.Data.MemberDetails，DaimokuBeta.MVC.Data，版本=1.0.0.0，Culture=neutral，PublicKeyToken=null]] ' 在程序集 'System.Data.Linq, Version=3.5.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089' 中未标记为可序列化。

MemberDetails 也是可序列化的..所以不知道为什么它认为它不能被序列化有什么想法吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-10-21T17:21:18.640

我相信这是您的 LazyList 实现无法序列化，因为异常告诉我们通用类型 DataQuery（来自程序集 System.Data.Linq）不可序列化。这种类型是否以任何方式连接到您的 LazyList ？

如果您尝试缓存成员 DTO（数据传输对象），则应用延迟加载可能不是一个好主意，因为它可能只会在非常不可预测的时刻执行。

缓存通常应该应用于已经加载/计算的数据。否则使用缓存可能没有多大意义。

# .net - 哪些 dotnet 集合类的项目可以按“加法顺序”枚举并通过键检索？

> ID：222681
> 
> 赞同：5
> 
> 时间：2008-10-21T17:11:30.283
> 
> 标签：.net, key, collections, enumeration

我被引导相信我不能指望添加到字典中的项目的顺序来进行枚举。

**是否有一个类（如果可能的话是通用的），可以使用键向其中添加项目并且可以按附加顺序枚举或可以通过键检索哪些项目？**

澄清：我不想在 Key Order 中列举。我想按顺序列举。也就是说，我希望能够在 FIFO（先进先出）的基础上通过枚举来检索项目。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-21T17:15:15.953

您只需使用`List`按添加顺序存储键的 a 即可达到您想要的效果。然后您可以按顺序枚举该列表，并从`Dictionary`.

但是，如果您想使用一个现有的集合类型来完成所有这些操作，我不知道有一种类型可以在不需要提供比较器或没有键作为项目一部分的情况下执行此操作。对于前者，您可以尝试`SortedDictionary`，对于后者，您可以从中派生一个新集合`KeyedCollection`（不完全确定这是否会在没有比较器的情况下保持顺序，因此您需要进行实验以确认这一点）。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-21T17:37:05.427

首先，根据您的主要假设，您是正确的。普通字典不保证枚举的顺序。

其次，您需要小心`SortedDictionary`使用自定义`IComparer`路线。比较器用于键相等以及对集合进行排序。也就是说，使用`IComparer`基于添加顺序的 an，您可能难以`SortedDictionary`通过键值从 a 中检索元素，它最终可能会丢失在树中（这是排序字典的支持）。

如果您愿意走 C5 通用类库路线，则可以从 a`HashedLinkedList<KeyValuePair<T>>`或`HashedLinkedList<T>`T 是自键控的情况下获得一些不错的成绩。您可以创建一个`IEqualityComparer`将对密钥进行操作以生成哈希码的方法。然后检索实际值，您可以使用`Find(ref T x)`原型 x （可能只设置键），它将找到存储的并通过在*O* (1) 时间与*O* ( *log n*`T` )中的引用返回它a 。同样，由 a 支持，它保证按附加顺序枚举（并且您可以通过 C5 指定您喜欢的方向）。***`SortedDictionary``LinkedList``IDirectedEnumerable`***

 ***希望有帮助。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-21T17:31:16.220

您可以创建自己的泛型类（并使其派生自 Dictionary<,> 或 SortedDictionary<,>）并实现您自己的 GetEnumerator() 版本，您可以在其中按键对字典进行排序并返回排序后的值（或者如果您使用 SortedDictionary 然后它已经排序）。

您也可以使用 SortedList<,>，它在某些情况下更好更轻，请查看 MSDN 以了解最符合您的需求。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-10-07T15:52:09.387

主题现在有点老了，但我一直在寻找具有相同行为的集合（保留添加项目的顺序）并且能够在键上索引集合。答案是抽象类 KeyedCollection<>！（在 System.Collections.ObjectModel 命名空间中）我用字典和这个 keyedcollection 运行了一个简单的测试，通过添加一堆时间，从中间删除一个并再次添加项目。KeyedCollection 将新项目添加到末尾，字典将其放置在其原始位置（我猜那里正在进行某种散列）

# .net - 在 Silverlight 中，如何调用 Main Dispatch Thread 上的操作？

> ID：222688
> 
> 赞同：5
> 
> 时间：2008-10-21T17:13:25.553
> 
> 标签：.net, silverlight, multithreading

在 WinForms UserControl 中，我将通过从任何控件的方法调用 this.BeginInvoke() 将数据传递给主 GUI 线程。Silverlight UserControl 中的等价物是什么？

换句话说，我如何获取任意工作线程提供的数据并确保它在主调度线程上得到处理？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-21T17:37:46.737

使用 UserControl 类的 Dispatcher 属性。

```
private void UpdateStatus()
{
  this.Dispatcher.BeginInvoke( delegate { StatusLabel.Text = "Updated"; });
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2011-08-13T15:56:44.007

```
 private void UpdateStatus()
    {
       // check if we not in main thread
       if(!this.Dispatcher.CheckAccess())
       {
          // call same method in main thread
          this.Dispatcher.BeginInvoke( UpdateStatus );
          return;
       }

       // in main thread now
       StatusLabel.Text = "Updated";
    } 
```

# database - 在 Delphi 应用程序中使用哪个嵌入式数据库？

> ID：222699
> 
> 赞同：40
> 
> 时间：2008-10-21T17:16:18.807
> 
> 标签：database, delphi, desktop, embedded-database

我正在 Delphi 中创建一个桌面应用程序，并计划使用嵌入式数据库。我已经使用带有 DISQLite3 库的 SQlite3 开始了这个项目。它有效，但文档似乎有点轻。我最近发现了 Firebird（是的，我已经离开 Windows 一段时间了），它似乎有一些引人注目的特性和支持。

每个嵌入式数据库的优缺点是什么？规模很重要，支持和资源也很重要。你用过什么，为什么？

* * *

## 回答 #1

> 赞同：38
> 
> 时间：2008-10-21T17:27:51.013

我正在使用 Firebird 2.1 Embedded，我对此非常满意。我喜欢数据库大小实际上是无限的（使用 > 4 GB 的数据库进行测试并且可以正常工作）并且数据库文件与 Firebird 服务器兼容，所以我可以使用标准工具进行数据库管理和检查。分发包括在您的 exe 文件夹中放置几个​​文件。

不支持来自多个程序的同时访问，但支持来自多个线程的同时访问（只要您确保在任何给定时刻只有一个“连接”操作正在进行）。

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2008-10-21T17:41:03.047

我在很多项目中都使用过 SQlite3（但来自 C/C++ 和 Objective-C）。它非常小——没有任何依赖关系——数据库在一个文件中。

它是 Mac 开发人员的首选数据库，因为它直接受到 CoreData 和 iPhone 的支持——因此拥有庞大的用户群（更不用说所有其他用户了）。

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2008-10-21T20:48:10.970

我已经在 FeedDemon 中使用 SQLite（通过 DISQLite3）几个月了，我强烈推荐它——它非常快速和稳定。正如 Javier 所说，该库的文档可能很薄，但 SQLite 本身的文档非常好。

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2008-10-21T17:45:36.533

我在很多项目中都使用过[DBISAM 。](http://www.elevatesoftware.com/)它完全嵌入，甚至不需要外部 DLL。与您列出的其他人不同，它是商业的。尽管有很多很棒的功能，并且有很好的文档记录和支持。有一个我还没有尝试过的[继任者。](http://www.elevatesoftware.com/)

* * *

## 回答 #5

> 赞同：13
> 
> 时间：2008-12-03T21:01:29.490

让我们看看，快速比较：

SQLite：

*   数据库中的动态类型
*   跨平台文件
*   在 Windows、Linux、Mac 等上运行。
*   公共区域
*   支持交易
*   依赖文件系统安全，不包括自身安全

火鸟嵌入式：

*   数据库中的强类型
    *   并非所有 SQL 数据类型都受支持
*   跨平台文件
    *   Firebird 嵌入式仅在 Windows 上运行
    *   来自 Firebird 嵌入式文件的格式与完整服务器版本相同
    *   Firebird Embedded 中的文件可以复制到非 Windows 服务器以供使用
*   在修改后的 MPL 下可用（“我们的就是我们的，必须保持免费，你的就是你的，你不必释放它”）
*   支持事务、触发器等

MySQL 嵌入式：

*   对 SQL 功能的支持取决于文件格式
*   (IIRC) 跨平台文件
*   GPL 除非你支付版税
*   在 Windows、Linux、Mac 上运行
*   在开源人群中非常受欢迎

即使是嵌入式数据库也有其优点和缺点。您需要权衡这些优势和劣势与您正在做的决定。

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2008-10-21T17:51:13.497

Firebird Embedded 是我们的第一选择，因为无需更改代码，具有嵌入式数据库的单用户 Delphi 应用程序可以迁移到基于多用户服务器的部署，而不会牺牲任何高端功能（例如存储过程、触发器、视图、 ETC。）。它是一个真正的免费数据库，并且在此过程中不会对您的代码进行 GPL。

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2011-02-28T11:40:30.040

强烈建议在使用数据库和 Delphi 时使用 AnyDAC - 然后您可以选择无缝地定位 FB 或 SQLite。

我更喜欢嵌入式应用程序的 FB。汤姆

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2008-10-21T19:01:43.930

我用的是Sybase的Advantage Database Server，但我也是研发经理，所以这篇文章有失偏颇。:)

我们有适用于 WIN32 VCL 和 VCL.NET 的原生 Delphi TTable 和 TQuery 组件。除了 SQL 支持之外的直接表访问使 Advantage 在许多其他 Delphi 产品中独树一帜。Advantage 支持大型表（仅受记录数量限制，20 亿条），并具有免费的本地引擎，非常适合开发 PC 和不需要客户端/服务器功能的小型客户站点。切换到具有单个连接属性的客户端/服务器，没有其他更改。

我们有大量客户端，因此访问 Delphi 之外的数据也非常容易（.NET 数据提供程序、ODBC、OLE DB、PHP、Perl、JDBC 等）。

主要产品网站： http: [//www.advantagedatabase.com](http://www.advantagedatabase.com) 开发者网站：[http://devzone.advantagedatabase.com](http://devzone.advantagedatabase.com)

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2008-11-17T09:14:09.767

这真的取决于你需要什么。对于单用户应用程序，Firebird Embedded 或 SQLite 可能是最佳选择（而且价格合适）。另一方面，如果您需要支持大量多用户，您可能应该使用常规 Firebird 而不是嵌入式版本（服务器安装简单，因此您不会遇到太多问题）。

如果您需要介于两者之间的东西，对于中等的多用户应用程序，平面数据库之一会更好。我发现[ComponentAce 的 Absolute Database](http://componentace.com/absolute_database_features.htm)比 DBISAM、NexusDB 或 VistaDB 更适合我的需求。

它的占用空间相对较小（没有 DLL），它是一个单文件数据库（对我来说是必须的），支持 Unicode、BLOB 压缩、加密，而且技术限制对于平面数据库来说似乎令人印象深刻。此外，在我需要它的少数情况下，支持很好。

对于缺点，我注意到它不支持嵌套事务，但除此之外，我没有任何问题。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2008-10-21T17:53:52.757

至于大小，没有什么能比得上 SQLite。

当您提到缺乏文档时，我猜它是 DISQLite3 的文档。SQLite[文档](http://www.sqlite.org)非常完整

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2008-10-21T20:44:34.830

（嵌入式）firebird 的问题是，数据库不能驻留在网络驱动器上。此外，很难在只读驱动器 (CD/DVD) 上拥有数据库。

有关这些限制的一些技巧，请参阅 Delphi Wiki： [http ://delphi.wikia.com/wiki/Firebird_tipps](http://delphi.wikia.com/wiki/Firebird_tipps)

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2008-10-21T22:27:13.813

看看 NexusDB。过去使用非常成功。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2008-10-29T09:12:21.690

NexusDB 提供从嵌入式到完整客户端/服务器/远程的全方位服务。我相信也符合 SQL2003。我在几个项目中使用它，到目前为止我很高兴，而且它可以在如此广泛的“规模”中工作这一事实是一个很大的优势（不必为扩大应用程序学习另一个数据库， ETC）。

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2011-03-10T14:33:29.123

看看这个嵌入式数据库比较：[http](http://sql-db.cz.cc/) ://sql-db.cz.cc/ ，它会有所帮助。上面提到的大多数产品都在那里展示：Advantage、DBISAM、Firebird、MS SQL Server 等等：Accuracer、Apollo、ElevateDB、NexusDB、TurboDB。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2008-10-21T18:28:12.343

我偏爱 Component Ace 的 Absolute DB。虽然是商业产品 ($)，但它坚固、易于使用、占用空间小且有据可查。如果您正在寻找一个巨大的多用户应用程序，这不是要走的路，但如果您的多用户需求很轻（或不存在），这是一个可靠的选择。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2008-10-21T22:24:30.493

我正在使用 SQL Server Express 和 ADO 组件。效果很好。您可以使用命令行运行 SQL Server Express 安装，以向用户隐藏复杂性。您还可以分发按文件名加载的数据库。有数百万 SQL Server 用户，因此可以在 intertubes 中轻松找到任何问题的解决方案 :-)

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2008-10-21T23:48:49.840

我进行了一次网络搜索，为我的 Delphi 应用程序找到了一个快速的数据库包。我希望它完全包含在可执行文件中，不需要外部 DLL 或库。我最初是通过 AidAim 找到 Accuracer。他们发布[了他们的数据库有多快，甚至还](http://www.accuracer.com/articles/single-file-delphi-database_tests100.php)与其他类似的软件包进行了比较以“证明”他们的观点。

我想相信他们的说法，但我想我会更多地在网上搜索以查找其他套餐的时间。我很惊讶地[在 Delphi 论坛](http://coding.derkeiler.com/Archive/Delphi/borland.public.delphi.thirdpartytools.general/2007-01/msg00231.html)上发现一个帖子，有人问要使用什么数据库，并且有 14 条不同的建议。其中一位响应者进行了自己的时间比较，发现 Accuracer 与其他几个相比非常慢，Accuracer （方便地）将其排除在他们自己的比较页面之外。

这篇文章，加上我进行的其他后续网络研究，使我倾向于[DISQLite3](http://www.yunqa.de/delphi/doku.php/products/sqlite3/index)，这是一个基于[开源 SQLite 程序](http://www.sqlite.org/)的产品，但增强了在 Delphi 中非常快速地工作，开销非常小，并且具有基于命令的调用 -我喜欢。它正在积极开发中，很快就会有一个官方的 Delphi 2009 版本，尽管当前版本显然可以在 D2009 下工作。

附录：11 月 17 日发布的 DISQLite3 版本 2.0.0，支持 D2009。

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2014-09-13T18:51:33.930

我知道 MS 访问是一个比较垃圾的数据库（并希望在这里被击落），但如果只需要小数据，那么无论如何使用 ms office 可能会有优势。对我来说，这是一种比 csv 文件更灵活地存储程序数据的方法，而 csv 文件是科学代码的常用方法。

您可以从 delphi 代码创建访问数据库，而无需使用 ado 和 odbc 驱动程序安装 ms office（可能需要有一个初始 .accdb 文件，没有要复制的表格，然后填充，我不记得这个细节。不确定许可情况这样做。

.accdb 扩展名可以更改为其他内容并且文件密码受保护（在有限的程度上），因此如果需要，它对用户的访问不会立即显而易见。我知道一些商业开发人员使用这种方法并自己复制它。发现它比 sqlite 更容易设置，但可能是因为我过去已经使用过 ado & access。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2008-10-21T17:44:23.603

我用过 ScimoreDB。它有它的怪癖，因为它们免费提供版税，它在数据类型和一些安装问题上有它的怪癖。这是在一个 C# 项目上。

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2008-10-23T00:13:50.460

如果嵌入式是绝对必须的，请查看 DBISAM。

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2008-11-05T00:27:42.960

kbMemTable 是一个不错的选择。在内存中运行，速度快，多线程。以前是免费的。

[组件4开发人员](http://www.components4developers.com/)

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2008-11-09T22:46:20.480

我在不同的场合使用过 DBISAM 和 kbMemTable。

我喜欢 DBISAM 的地方在于它具有强大的功能，而且通常非常可靠。我曾在大型数据库、全文搜索、只读模式、CGI 和许多其他情况下使用它。

不过，与基于 kbMemTable 或 SQLite 的组件相比，它相当大。而且每个数据库（甚至表）不能有一个文件 - 根据情况，这是一个主要缺点。

kbMemTable 很小，非常适合处理少量数据。由于它在内存中运行，当然它必须是少量数据。

我在几个桌面应用程序上采用的另一个选项是使用 TWriter/TReader 将数据直接从我的对象层次结构转储到我的对象层次结构。这是迄今为止最小的选择，与使用数据库相比速度快得离谱。数据文件也很小。

但是，它有各种缺点 - 如果您可能想要添加/更改字段，则必须对版本进行编码，除非它在内存中，否则它会更加复杂，根本不支持多用户等。

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2008-12-30T21:02:54.650

Firebird 嵌入式也是我们的第一选择。以及带有它的套件*Unified Interbase v2.0*。一个伟大而稳定的解决方案！

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2015-10-27T18:59:26.500

我有一个数据库，我必须每 20 秒记录 5 个字段数据，持续 10 天。3 个字段是整数，1 个字段是双精度（时间），1 个字段是字符串 [5]。

由于我的组件，我仍在使用 Delphi6 srv2。较新的 delphi 版本在组件方面很糟糕，我不得不花费数千美元来重建我的组件库。因此，对于真正的商业应用程序，delphi 6 仍然是最好的，因为 delphis 版本从来没有给出很多问题。在许多方面，例如 USB 或 comport 读数等......他们在以前的版本从未上市之前发布了更新的版本。

我已经使用 Delphi6 设置了一个代码，它在表中附加了 43200 条记录以进行测试，因为我将在应用程序中部署该表，而它有 43200 条记录。我将在 DBChart 上显示所有数据。

测试结果如下数据库通过插入命令填充了 43200 条记录的表

> Dbisam = 34 秒，
> ElevateDb = 11 秒，
> AbsoluteDB = 45 秒，
> SQLlite = 32 分钟，
> Firebird = 12 分钟，
> MSSQL12 localDB = 28 分钟，
> Easy table = 8 分钟，
> BDE = 阻塞，

我还没有测试过 oracle 、 blackfish 、 sysbase 、 nexsusDb 等。但它们似乎也会很慢。我已经与 DBChart 连接，并且只有 elevateDb 和 absoluteDB 在特殊的时间内（例如 7~10 秒）在 DBchart 上加载了 43200 条记录。其他都用了分钟。因此，较慢的数据库总是需要编码技巧才能在某些实际工作中取得成功。

我还通过 locate 命令测试了他们的搜索速度，不幸的是，基于服务器的数据库总是较慢。

MSSQL 和 SQLLite3 在 delphi 中管理起来非常困难，这让我很累。

这些是我的测试结果
最后我决定使用 AbsoluteDB、Dbisam 和 Elevate。我已经把剩下的从电脑上扔了。

Elevate 软件不支持需要在运行时额外的代码来管理的recno 功能。这使得数据库变慢 其他错误是 Elevate 软件是 autoinc 字段。没有办法重置它。因此我没有选择 Elevat 软件，即使它是最快的数据库。他们说很多好功能，但实际上我们使用了多少。他们只是不支持最重要的功能，但修复了许多不必要的功能。8年以来似乎也没有任何优势。

如果您想亲眼看看，请尝试看看..

我正在考虑两个现在绝对的 DB 或 DBisam4

* * *

## 回答 #25

> 赞同：-1
> 
> 时间：2009-02-14T12:04:28.517

一路火鸟。一切都做得很好，到目前为止 2.1 版非常可靠。

* * *

## 回答 #26

> 赞同：-1
> 
> 时间：2009-04-15T05:29:53.993

FireBird 提供了在某个时候扩展到多用户的机会，或者如果您需要并发（如果您的应用程序是多线程的）。

如果您只需要单用户访问，SQLite 是无与伦比的，无论是性能、便利性、SQL 支持还是稳定性，都没有其他数据库可以与它相提并论。

* * *

## 回答 #27

> 赞同：-1
> 
> 时间：2009-04-15T08:49:52.093

Firebird 非常棒，占用空间小，因此您可以使用嵌入式，它可以为许多用户向上扩展，并且 unicode 失败我使用带有 delphi 2009 和 FIB plus 的 devart 组件，用于 delphi 6/7（他们的版本为 2009 和 unicode还没准备好，太糟糕了）

* * *

## 回答 #28

> 赞同：-1
> 
> 时间：2009-05-04T00:00:18.073

嗯，没有人推荐过 BDE - 我想知道为什么会这样 ;-)

BlackFishSQL 是另一种可能性，虽然我还没有深入测试过。

* * *

## 回答 #29

> 赞同：-1
> 
> 时间：2016-10-04T15:48:16.647

谈到嵌入式数据库，第一个问题是：它是多用户的吗？实际上，谁需要一个不允许多个连接（读写）的数据库？我已经（深入地）尝试了所有提到的数据库，但只找到了一个真正按照它应该的方式运行的数据库。那就是Accuracer。accuracer 唯一的遗憾是它是一个三人乐队，长期缺乏适当的支持。它在开发中也主要是静态的，因为我们多年来没有看到任何真正的功能。这并不奇怪，因为只有一个人实际开发它。看来他们是靠着旧名声过日子的。用户的好评反映了这一点（通常是 10 年前的评论）。对于单一的用户体验，我会推荐绝对数据库。至于主要参与者，我会推荐 Microsoft 的 SQL Server。Oracle 已成为过时的软件，正在慢慢消亡。

ps accuracer 的优点是它们的嵌入式数据库功能就像成熟的服务器一样。如果当前记录正在使用中，则它仅锁定当前记录，而其余记录正常运行。不错的数据库。可惜只是停滞不前。

# javascript - 在 javascript 中执行指令的成本是否有任何普遍性？

> ID：222709
> 
> 赞同：2
> 
> 时间：2008-10-21T17:20:35.537
> 
> 标签：javascript, performance

我想知道，在执行给定指令与另一个指令相关的成本方面是否存在任何普遍性（在所有 javascript 引擎中）。

例如， eval() 比调用已经声明的函数要慢。

我想获得一个包含多个指令/函数调用的表格，而不是绝对成本，也许是每个引擎的成本。

这样的文件存在吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-21T20:26:23.527

这里有一个页面（由我们的一位杰出主持人提供，不少于），按浏览器和一般指令类别进行细分：

[http://www.codinghorror.com/blog/archives/001023.html](http://www.codinghorror.com/blog/archives/001023.html)

上面的页面链接到更详细的细分：

[http://www.codinghorror.com/blog/files/sunspider-09-benchmark-results.txt](http://www.codinghorror.com/blog/files/sunspider-09-benchmark-results.txt)

这些页面都没有将性能分解为单个函数调用或算术运算或您拥有的级别。尽管如此，仍有相当多的潜在有用信息。

还有一个指向基准本身的链接：

[http://www2.webkit.org/perf/sunspider-0.9/sunspider.html](http://www2.webkit.org/perf/sunspider-0.9/sunspider.html)

通过查看基准源，您可以更好地了解正在测试的特定函数调用。

创建您自己的自定义基准测试版本以收集您感兴趣的更具体的数据似乎也是一件简单的事情。然后您可以在各种浏览器上运行修改后的基准测试，甚至可以利用服务例如[browsershots.org](http://browsershots.org/)来测试各种浏览器。不知道这会有多好，但尝试一下可能会很有趣......

当然，在同一个浏览器中执行的相同操作可能会花费显着不同的时间，具体取决于使用它的上下文，其方式可能不会立即显而易见。例如，我可以想象一个 Javascript 引擎花费更多时间优化频繁执行的代码，结果在紧密循环中执行的代码可能比不经常执行的相同代码运行得更快。当然，这在实践中可能并不重要。尽管如此，我想您正在寻找的那种好表也可能会总结任何此类影响，如果它们被证明是重要的。

# asp.net - 具有本地化内容的 ASP.NET PasswordRecovery 控件

> ID：222710
> 
> 赞同：3
> 
> 时间：2008-10-21T17:21:06.910
> 
> 标签：asp.net, asp.net-membership

我正在使用 ASP.NET 成员资格和登录控件开发一个简单的门户应用程序。我想使用 PasswordRecovery 控件发送包含忘记密码的电子邮件，但是我的门户需要本地化。我有一个现有的内容管理系统，我正在从中提取本地化字符串，并且我想将 PasswordRecovery 控件链接到该系统。

但是，PasswordRecovery 控件似乎只接受电子邮件正文的 .txt 文件...属性是 PasswordRecovery1.MailDefinition.BodyFileName

我不想使用磁盘上的文件，我想在我的 CMS 中使用本地化内容。

有没有办法做到这一点？我突然想到我也许可以使用 SendingMail 事件通过正常的 System.Net 命名空间发送我的 OWN 电子邮件，但这似乎有点笨拙......

有什么想法吗？

谢谢，马克斯

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-24T17:54:22.197

尝试处理 PasswordRecovery 控件的 SendingMail 事件。在这种情况下，将 e.Message.Body 和 e.Message.Subject 属性设置为您的本地化文本。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-21T17:45:27.627

通过谷歌搜索“BodyFileName 本地化”找到了这个：

[http://forums.asp.net/t/1118242.aspx](http://forums.asp.net/t/1118242.aspx)：

> 只需将该属性绑定到页面的本地资源文件中的键即可。页面的本地资源文件是位于页面目录中名为 app_localresources 的子目录中的文件。只需在设计视图中使用 Visual Studio 的“工具 -> 创建本地资源”选项即可为您创建它。
> 
> 在该文件中，创建一个字符串键/值对，例如
> 
> 名称：myBodyFileName
> 
> 值：myDefaultBodyFile.txt
> 
> 然后将其绑定到登录控件的 BodyFileName 属性，例如
> 
> '>
> 
> 然后只需为其他文化创建卫星本地资源文件，并将这些资源中的键/值对映射到其他正文文件。
> 
> 顺便说一句，如果您使用 Visual Studio 为您创建资源文件，那么绑定可能已经为您自动完成。只需在资源文件或类似文件中搜索“MyChangePasswordControlResource1.BodyFileName”键即可。
> 
> 问候， 豪尔赫

# java - 读取、表示和渲染地图数据的最佳方式是什么？

> ID：222716
> 
> 赞同：12
> 
> 时间：2008-10-21T17:22:45.253
> 
> 标签：java, .net, graphics, rendering, maps

我有兴趣编写一个简单的导航应用程序作为宠物项目。在搜索了免费的地图数据后，我选择了[美国人口普查局 TIGER](http://www.census.gov/geo/www/tiger/tgrshp2007/tgrshp2007.html) 2007 Line/Shapefile 地图数据。数据被分成各个县的 zip 文件，我已经下载了我所在地区的单个县地图数据。

**将此地图数据读入可用格式的最佳方法是什么？**

我应该如何：

*   读入这些文件
*   解析它们 - 正则表达式或一些已经可以解析这些 Shapefile 的库？
*   将数据加载到我的应用程序中 - 我应该将点直接加载到内存中的某些数据结构中吗？使用小型数据库？一旦您关闭地图数据的应用程序，我就不需要持久性。用户可以再次加载 Shapefile。

**读取 Shapefile 数据后，渲染地图的最佳方式是什么？**

理想情况下，我希望能够读取县地图数据 shapefile 并将所有折线渲染到屏幕上并允许旋转和缩放。

我应该如何：

*   将纬度/经度点转换为屏幕坐标？- 据我所知，Shapefile 使用经度和纬度作为其点。所以很明显，我将不得不以某种方式将这些转换为屏幕坐标以显示地图特征。
*   以我可以轻松旋转和缩放整个地图的方式渲染地图数据（道路、边界等的一系列折线）？
*   将我的整个地图渲染为一系列“图块”，以便仅渲染查看区域内的要素/线？

前任。呈现为显示地图的 TIGER 数据：
![替代文字](https://i.stack.imgur.com/mNJ9X.png)

任何对我阅读这些文件的最佳方式、我应该如何在我的程序中表示它们（数据库、内存数据结构）以及我应该如何渲染（旋转/缩放）地图数据有一定经验和洞察力的人在屏幕上将不胜感激。

编辑：澄清一下，我不想使用任何谷歌或雅虎地图 API。同样，我不想使用 OpenStreetMap。我正在寻找一种比利用那些 api/程序更从头开始的方法。这将是一个**桌面**应用程序。

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2009-01-28T15:59:21.760

首先，我建议您使用[2008 TIGER 文件](http://www.census.gov/geo/www/tiger/tgrshp2008/tgrshp2008.html)。

其次，正如其他人指出的那样，现在有很多项目已经读入、解释、转换和使用数据。不过，为这些数据构建自己的解析器几乎是微不足道的，所以没有理由去检查另一个项目的代码并尝试提取你需要的东西，除非你打算将他们的项目作为一个整体来使用。

## 如果你想从较低的级别开始

**解析**

构建您自己的 TIGER 解析器（相当简单 - 只是一个线段数据库），并在此之上构建一个简单的渲染（线条、多边形、字母/名称）也将相当容易。您需要查看渲染阶段的各种[地图投影类型](http://www.colorado.edu/geography/gcraft/notes/mapproj/mapproj_f.html)。最常用的（因此用户最熟悉的）是[墨卡托投影](http://www.colorado.edu/geography/gcraft/notes/mapproj/mapproj_f.html)——它相当简单和快速。您可能想要支持其他预测。

这将在查看如何投影地图以及如何反转该投影方面提供一些“乐趣”（例如，用户单击地图，您想查看他们单击的纬度/经度 - 需要反转当前投影方程）。

**渲染**

当我开发我的渲染器时，我决定将我的窗口建立在固定大小（嵌入式设备）和固定放大率上。这意味着我可以将地图以纬度/经度居中，并且中心像素=中心纬度/经度在给定的放大倍率下，并且给定墨卡托投影，我可以计算出哪个像素代表每个纬度/经度，反之亦然。

一些程序允许窗口变化，而不是使用放大率和固定点，它们使用两个固定点（通常是定义窗口的矩形的左上角和右下角）。在这种情况下，确定像素到纬度/经度的传输变得微不足道——这只是一些插值计算。旋转和缩放使这个传递函数稍微复杂一些，但不应该如此复杂——它仍然是一个带插值的矩形窗口，但窗口角不需要相对于北方处于任何特定方向。这增加了一些极端情况（例如，您可以将地图翻过来并像从地球内部一样查看它），但这些并不繁琐，并且可以在您处理它时进行处理。

一旦你完成了纬度/经度到像素的传输，渲染线条和多边形就相当简单了，除了正常的图形问题（例如线条边缘或多边形重叠不当、抗锯齿等）。但是渲染一个基本的丑陋地图，例如由许多开源渲染器完成的，是相当简单的。

您还可以玩距离和大圆计算 - 例如，一个很好的经验法则是赤道的每度纬度或经度大约为 111.1 公里 - 但随着您靠近任一极点，一个会发生变化，而另一个继续保持在111.1kM。

**存储和结构**

但是，您如何存储和引用数据在很大程度上取决于您打算如何处理这些数据。如果您想对人口统计数据和路由使用相同的数据库结构，则会出现许多难题 - 给定的数据库结构和索引对于一个来说会很快，而对于另一个来说会很慢。

使用邮政编码并仅加载附近的邮政编码适用于小型地图渲染项目，但如果您需要穿越全国的路线，则需要不同的结构。一些实现具有“覆盖”数据库，其中仅包含主要道路并将路线捕捉到覆盖（或通过多个覆盖 - 本地、地铁、县、州、国家）。这会导致快速但有时效率低下的路由。

**平铺**

平铺地图实际上并不容易。在较低的放大倍率下，您可以渲染整个地图并将其切割。在更高的放大倍率下，您无法一次渲染整个事物（由于内存/空间限制），因此您必须将其切片。

在瓦片边界处切割线，以便您可以渲染单个瓦片，但结果并不完美 - 通常所做的是将线渲染到瓦片边界之外（或者，至少保留线端的数据，尽管渲染一旦停止发现它从边缘掉了下来） - 这减少了线条在穿过瓷砖时看起来不太匹配时发生的错误。

当你处理这个问题时，你会明白我在说什么。

找到进入给定图块的数据也并非易事 - 一条线的两端可能在给定图块之外，但穿过图块。您需要查阅有关这方面的图形书籍（[Michael Abrash 的书籍是开创性的参考书](http://www.byte.com/abrash/)，现在可以在前面的链接中免费获得）。虽然它主要谈论游戏，但窗口、裁剪、多边形边缘、碰撞等都适用于此。

## 但是，您可能想玩更高的级别。

完成上述操作后（通过调整现有项目或自己完成上述操作），您可能想要使用其他场景和算法。

**反向地理编码相当容易。** 输入纬度/经度（或点击地图）并获取最近的地址。这将教您如何沿 TIGER 数据中的线段解释地址。

**基本的地理编码是一个难题。** 编写地址解析器是一个有用且有趣的项目，然后使用 TIGER 数据将其转换为纬度/经度并非易事，而是非常有趣。从需要精确的名称和格式匹配开始，然后开始研究“like”匹配和语音匹配。在这个领域有很多研究——在这里查看搜索引擎项目以获得一些帮助。

**找到两点之间的最短路径是一个非常重要的问题。** 有很多很多算法可以做到这一点，其中大部分都获得了专利。我建议如果您尝试使用您自己设计的简单算法，然后进行一些研究并将您的设计与最先进的技术进行比较。如果你对图论感兴趣，那会很有趣。

**遵循路径并先发制人地给出指示**并不像第一眼看上去那么容易。给定一组带有关联的经纬度对数组的指令，使用外部输入（GPS 或模拟 GPS）“跟随”路线，并开发一种算法，在用户接近每个真实交叉口时为用户提供指令。请注意，由于弯曲的道路等，纬度/经度对多于说明，您需要检测行进方向等。在您尝试实施之前，您不会看到很多极端情况。

**兴趣点搜索。** 这个很有趣——你需要找到当前位置，以及一定距离内的所有兴趣点（不是 TIGER 的一部分，自己制作或获取其他来源）（如乌鸦飞过，或更难的驾驶距离）的起源。这很有趣，因为您必须将 POI 数据库转换为在这种情况下易于搜索的格式。您不能花时间遍历数百万个条目，进行距离计算 (sqrt(x^2 + y^2))，然后返回结果。您需要有一些方法或算法来首先减少数据量。

**旅行推销员。** 与多个目的地的路由。只是常规路由的更难版本。

[您可以在此处](http://delicious.com/stienman/gis)找到许多项目的链接以及有关此主题的信息来源。

祝你好运，无论你做什么，无论多么简陋或丑陋，都请发表，让其他人受益！

-亚当

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-10-21T17:44:44.490

[SharpMap](http://www.codeplex.com/SharpMap)是用于 WinForms 和 ASP.NET 的开源 .NET 2.0 映射引擎。这可能会提供您需要的所有功能。它处理最常见的 GIS 矢量和栅格数据格式，包括 ESRI shapefile。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-01-27T09:45:47.317

解决方案是：

*   地理空间服务器，如 mapserver、geoserver、degree（开源）。

他们可以读取和提供 shapefile（以及许多其他东西）。例如，geoserver（安装后）提供来自美国人口普查局 TIGER shapefile 的数据作为演示

*   像 openlayers 这样的 javascript 制图库（请参阅[链接文本中的示例](http://openlayers.org/dev/examples/))

网上有很多使用这个解决方案的例子

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-01-30T05:54:20.680

**有趣的问题。这是我的做法。**

我以任何格式收集我需要的任何几何图形。我一直在从 USGS 提取数据，所以这相当于一堆：

*   SHP 文件（[ESRI Shapefile 技术说明](http://www.esri.com/library/whitepapers/pdfs/shapefile.pdf)）
*   DBF 文件（[Xbase 数据文件 (*.dbf)](http://www.clicketyclick.dk/databases/xbase/format/dbf.html#DBF_STRUCT)）

然后我编写了一个程序，将这些形状定义“编译”成一种可以高效渲染的形式。这意味着进行有效显示数据所需的任何投影和数据格式转换。一些细节：

*   对于 2D 应用程序，您可以使用所需的任何投影：[Map Projections](http://www.colorado.edu/geography/gcraft/notes/mapproj/mapproj_f.html)。
*   对于 3D，您希望将这些纬度/经度转换为 3D 坐标。这里有一些关于如何做到这一点的数学：[从球坐标到普通直角坐标的转换](http://www.mathforum.com/library/drmath/view/51711.html)。
*   将所有基元分解为四叉树/八叉树（2D/3D）。此树中的叶节点包含对与该叶节点（轴对齐）边界框相交的所有几何图形的引用。（这意味着一个几何图形可以被多次引用。）
*   然后将几何图形拆分为顶点表和绘图命令表。这是 OpenGL 的理想格式。可以使用顶点缓冲区（[顶点缓冲区对象](http://www.opengl.org/sdk/docs/man/xhtml/glGenBuffers.xml)）通过[glDrawArrays](http://www.opengl.org/documentation/specs/man_pages/hardcopy/GL/html/gl/drawarrays.html)发出命令。
*   一般访问者模式用于遍历四叉树/八叉树。行走涉及测试访问者是否与树的给定节点相交，直到遇到叶节点。访问者包括：绘图、碰撞检测和选择。（因为树叶可能包含对几何图形的重复引用，walker 将节点标记为已访问并在此后忽略它们。在进行下一次遍历之前，必须重置或以其他方式更新这些标记。）
*   使用空间分区系统（其中一棵树）和高效的绘图表示对于实现高帧率至关重要。我发现在这些类型的应用程序中，您希望帧速率尽可能高，至少为 20 fps。更不用说大量性能将为您提供很多机会来创建更好看的地图。（我的远非好看，但总有一天会到达那里。）
*   空间分区通过减少发送到处理器的绘制命令的数量来帮助渲染性能。但是，有时用户实际上想要查看整个数据集（可能是 arial 视图）。在这种情况下，您需要一个详细程度的控制系统。由于我的应用程序涉及街道，因此我优先考虑高速公路和较大的道路。我的绘图代码知道在我的帧速率下降之前我可以绘制多少个图元。基元也按此优先级排序。我只绘制第一个`x`项目，其中`x`是我可以以我想要的帧速率绘制的图元数量。

剩下的就是你想要显示的任何数据的相机控制和动画。

以下是我现有实现的一些示例：

[图片 http://seabusmap.com/assets/Picture%205.png](http://seabusmap.com/assets/Picture%205.png) [图片 http://seabusmap.com/assets/Picture%207.png](http://seabusmap.com/assets/Picture%207.png)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-01-28T08:16:47.853

为了在本地存储 Tiger 数据，我会选择带有[postgis](http://wiki.postgis.org/documentation/)工具的[Postgresql 。](http://www.postgresql.org/)

他们拥有令人印象深刻的工具集，特别是[Tiger Geocoder](http://wiki.postgis.org/support/wiki/index.php?InstallingTigerGeocoder)为您提供了导入和使用老虎数据的好方法。

您需要查看与 postgis 交互的工具，很可能是某种[地图服务器](http://mapserver.org/)

来自[http://postgis.refracions.net/documentation/](http://postgis.refractions.net/documentation/)：

> 现在有几个开源工具可以与 PostGIS 一起使用。uDig 项目正在开发可以直接与 PostGIS 一起使用的完整读/写桌面环境。对于互联网制图，明尼苏达大学地图服务器可以使用 PostGIS 作为数据源。GeoTools Java GIS 工具包支持 PostGIS，GeoServer Web Feature Server 也是如此。GRASS 支持将 PostGIS 作为数据源。JUMP Java 桌面 GIS 查看器有一个简单的插件用于读取 PostGIS 数据，QGIS 桌面有很好的 PostGIS 支持。PostGIS 数据可以使用 OGR C++ 库和命令行工具（当然还有捆绑的 Shape 文件转储器）导出为多种输出 GIS 格式。当然，任何可以与 PostgreSQL 一起使用的语言都可以与 PostGIS 一起使用——列表包括 Perl、PHP、Python、TCL、C、C++、Java、C# 等等。

编辑：尽管地图服务器的名称中包含单词 SERVER，但这将在桌面环境中使用。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-01-29T17:55:51.660

虽然您已经决定使用 TIGER 数据，但您可能对[OSM（开放街道地图）](http://openstreetmap.org)感兴趣，因为 OSM 包含完整的 TIGER 数据导入，其中包含用户贡献的数据。如果您坚持使用 TIGER 格式，您的应用程序对国际用户将毫无用处，而使用 OSM，您可以立即获得 TIGER 和其他所有内容。

OSM 是一个开放项目，具有协作编辑的免费世界地图。您可以获取所有这些数据以及结构化的 XML，或者查询一个区域，或者将整个世界下载到一个大文件中。

有一些适用于 OSM 的地图渲染器可用于各种编程语言，其中大部分是开源的，但仍有许多工作要做。

还有一个[OSM 路由服务](http://www.openrouteservice.org/)可用。它有一个 Web 界面，也可以通过 Web 服务 API 进行查询。再说一遍，这还没有结束。用户绝对可以使用基于此构建的桌面或移动路由应用程序。

即使您不决定参与该项目，您也可以从中获得很多灵感。只需查看[项目 wiki](http://wiki.openstreetmap.org)以及所涉及的各种软件项目的来源（您将在 wiki 中找到指向它们的链接）。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-21T18:30:35.973

您还可以使用 Microsoft 的可视地球地图应用程序和 api 或使用 Google 的 api。我一直使用 ESRI 产品进行商业编程，并且没有过多地使用开放 api。

此外，您可能想看看 Maker！和查找器！它们是相对较新的程序，但我认为它们是免费的。可能仅限于嵌入数据。[制造商](http://maker.geocommons.com/)可以在这里找到。

问题是空间处理在非商业规模上是相当新的。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-25T16:37:32.090

当我给出这个答案时，问题被标记为

“在 .Net 中用折线渲染 Shapefile（地图数据）的最佳方法是什么？”

现在这是一个不同的问题，但我将我的答案留在原来的问题上。

> 我编写了一个 .net 版本，它可以使用 c# 中的普通 GDI+ 绘制矢量数据（例如 shp 文件中的几何图形）。这很有趣。
> 
> 原因是我们需要处理具有大量附加信息的不同版本的几何图形和属性，因此我们无法使用商业地图组件或开源地图组件。
> 
> 这样做的主要事情是建立一个视口并将 WGIS84 坐标转换/转换为缩小比例和 GDI+ x,y 坐标，如果您甚至需要重新投影，则等待投影。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-01-28T16:29:30.077

如果您不介意为解决方案付费，[Safe Software](http://www.safe.com/)会生产一种名为 FME 的产品。该工具将帮助您将数据从任何格式转换为几乎任何其他格式。包括 Google Earth 格式的 KML 或将其呈现为 JPEG（或一系列 JPEG）。[转换数据后，您可以使用他们的API](http://earth.google.com/comapi/index.html)将 google earth 嵌入到您的应用程序中，或者只显示平铺图像。

另一方面，FME 是一个非常强大的平台，因此在进行翻译时，您可以添加或删除您不一定需要的部分数据。如果您有多个来源，请合并来源。转换坐标（我不记得谷歌地球到底使用了什么）。将备份存储在数据库中。但说真的，如果你愿意花几块钱，你应该调查一下。

您还可以创建包含位置（放置位置）和有关该位置的其他数据/评论的标志（很像在您的示例地图中）。这些旗帜有多种形状和大小。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-01-28T23:53:02.973

对墨卡托投影或其他投影的一种简化是假设纬度和经度的转换因子不变。将纬度乘以 69.172 英里；对于经度，选择地图区域的中纬度并将（180 经度）乘以余弦（middle_latitude）*69.172。转换为英里后，您可以使用另一组转换来获取屏幕坐标。

这就是 1979 年对我有用的方法。

[我的每度英里数的来源。](http://www.ncgia.ucsb.edu/giscc/units/u014/u014_f.html)

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-01-27T10:30:47.663

一种解决方案是使用 MapXtreme。他们有用于 Java 和 C# 的 API。API 能够加载这些文件并呈现它们。

对于 Java：

[http://www.mapinfo.com/products/developer-tools/desktop%2c-mobile-%26-internet-offering/mapxtreme-java](http://www.mapinfo.com/products/developer-tools/desktop%2c-mobile-%26-internet-offering/mapxtreme-java)

对于 .NET：

[http://www.mapinfo.com/products/developer-tools/desktop%2c-mobile-%26-internet-offering/mapxtreme-2008](http://www.mapinfo.com/products/developer-tools/desktop%2c-mobile-%26-internet-offering/mapxtreme-2008)

我在桌面应用程序中使用了这个解决方案，效果很好。它提供的不仅仅是渲染信息。

现在从头开始这样做可能需要相当长的时间。他们确实有一个您可以下载的评估版。我认为它只是在地图上打印“MAPXTREME”作为水印，但在其他情况下它完全可用

# wpf - 在 ListView 中为不同的类别项目更改（启用/禁用）GroupStyle

> ID：222729
> 
> 赞同：3
> 
> 时间：2008-10-21T17:30:17.093
> 
> 标签：wpf, listview, listbox, styles

如何在运行时根据某些条件在`GroupStyles`a之间切换？`ListView`例如，我需要对`GroupStyle`标头名称为空的项目使用默认值，如果它不为空，则使用自定义`GroupStyle`主题？我试过`GroupStyleSelector`了，但它不起作用，因为它适用于多级分组，而在我的情况下，我只有一级分组。

如果是，那么如何？

自定义`GroupStyle`：

```
 <Style x:Key="grouping"
           TargetType="{x:Type GroupStyle}">
        <Setter Property="ContainerStyle">
            <Setter.Value>
                <Style TargetType="{x:Type GroupItem}">
                    <Setter Property="Margin"
                            Value="0,0,0,5" />
                    <Setter Property="Template">
                        <Setter.Value>
                            <ControlTemplate TargetType="{x:Type GroupItem}">
                                <Expander IsExpanded="False"
                                          BorderBrush="#FFA4B97F"
                                          BorderThickness="0,0,0,1">
                                    <Expander.Header>
                                        <DockPanel>
                                            <TextBlock FontWeight="Bold"
                                                       Text="{Binding Name}"
                                                       Margin="0"
                                                       Width="250" />
                                            <TextBlock FontWeight="Bold"
                                                       Text="{Binding Path=Items[0].StartTime, StringFormat=T}" />
                                        </DockPanel>
                                    </Expander.Header>
                                    <Expander.Content>
                                        <ItemsPresenter />
                                    </Expander.Content>
                                </Expander>
                            </ControlTemplate>
                        </Setter.Value>
                    </Setter>
                </Style>
            </Setter.Value>
        </Setter>                    
    </Style> 
```

非常感谢。

真诚的，弗拉德。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-22T14:58:51.017

好的，

我找到了解决方案。基本上我需要构建 DataTrigger 并检查其中的类别，如果匹配，则使用不同的 GroupStyle。这是示例：

```
 <ControlTemplate TargetType="{x:Type GroupItem}"
                   x:Key="defaultGroup">
       <ItemsPresenter />
  </ControlTemplate>

  <ListView.GroupStyle>
   <GroupStyle >                            
    <GroupStyle.ContainerStyle>
     <Style TargetType="{x:Type GroupItem}">
      <Setter Property="Margin"
        Value="0,0,0,5" />
      <Setter Property="Template">
       <Setter.Value>
        <ControlTemplate TargetType="{x:Type GroupItem}">
         <Expander IsExpanded="False"
             BorderBrush="Black"
             BorderThickness="3"
             Padding="5,1,1,5">
          <Expander.Header>
           <DockPanel>
            <TextBlock FontWeight="Bold"
                 Margin="0"
                 Width="250">
             <TextBlock.Text>
              <MultiBinding StringFormat="{}{0} ({1} jobs)">
               <Binding Path="Name" />
               <Binding Path="ItemCount" />
              </MultiBinding>
             </TextBlock.Text>
            </TextBlock>
            <TextBlock FontWeight="Bold"
                 Text="{Binding Path=Items[0].Category, StringFormat=T}" />
           </DockPanel>
          </Expander.Header>
          <Expander.Content>
           <ItemsPresenter />
          </Expander.Content>
         </Expander>
        </ControlTemplate>
       </Setter.Value>
      </Setter>
      <Style.Triggers>
       <DataTrigger Binding="{Binding Items[0].Category}"
           Value="ABC">
        <Setter Property="Template"
          Value="{StaticResource defaultGroup}" />
       </DataTrigger>
      </Style.Triggers>
     </Style>
    </GroupStyle.ContainerStyle>
   </GroupStyle>
  </ListView.GroupStyle> 
```

# python - 樱桃不关闭套接字

> ID：222736
> 
> 赞同：3
> 
> 时间：2008-10-21T17:33:26.497
> 
> 标签：python, sockets, cherrypy

我正在使用cherrypy 作为网络服务器。它为我的应用程序提供了良好的性能，但它存在一个非常大的问题。几个小时后，cherrypy 崩溃，说明由于打开的文件太多，它无法创建套接字：

```
[21/Oct/2008:12:44:25] ENGINE HTTP Server 
cherrypy._cpwsgi_server.CPWSGIServer(('0.0.0.0', 8080)) shut down    
[21/Oct/2008:12:44:25] ENGINE Stopped thread '_TimeoutMonitor'.    
[21/Oct/2008:12:44:25] ENGINE Stopped thread 'Autoreloader'.    
[21/Oct/2008:12:44:25] ENGINE Bus STOPPED    
[21/Oct/2008:12:44:25] ENGINE Bus EXITING    
[21/Oct/2008:12:44:25] ENGINE Bus EXITED    
Exception in thread HTTPServer Thread-3:    
Traceback (most recent call last):    
  File "/usr/lib/python2.3/threading.py", line 436, in __bootstrap    
    self.run()    
  File "/usr/lib/python2.3/threading.py", line 416, in run   
    self.__target(*self.__args, **self.__kwargs)    
  File "/usr/lib/python2.3/site-packages/cherrypy/process/servers.py", line 73, in 
_start_http_thread    
    self.httpserver.start()    
  File "/usr/lib/python2.3/site-packages/cherrypy/wsgiserver/__init__.py", line 1388, in start
    self.tick()    
  File "/usr/lib/python2.3/site-packages/cherrypy/wsgiserver/__init__.py", line 1417, in tick    
    s, addr = self.socket.accept()    
  File "/usr/lib/python2.3/socket.py", line 167, in accept    
    sock, addr = self._sock.accept()    
error: (24, 'Too many open files')    
[21/Oct/2008:12:44:25] ENGINE Waiting for child threads to terminate.. 
```

我试图弄清楚发生了什么。我的应用程序没有打开任何文件或任何套接字等。我的文件只打开了几个 berkeley dbs。我进一步调查了这个问题。我在 /proc/4536/fd/ 中看到了我的cherrypy 进程使用的文件描述符，ID 为 4536 所有套接字都处于 CLOSE_WAIT 状态。我使用以下命令获得了此信息：

```
netstat -ap | grep "4536" | grep CLOSE_WAIT | wc -l 
```

CLOSE_WAIT 状态意味着远程客户端已经关闭了连接。为什么cherrypy然后不关闭套接字并释放文件描述符？我能做些什么来解决这个问题？

我尝试玩以下游戏：

```
cherrypy.config.update({'server.socketQueueSize': '10'}) 
```

我认为这会将随时打开的套接字数量限制为 10，但它根本没有效果。这是我设置的唯一配置，因此，其余配置保持其默认值。

有人可以对此有所了解吗？你认为它是cherrypy中的一个错误吗？我该如何解决？有没有办法自己关闭这些套接字？

以下是我的系统信息：

CherryPy-3.1.0

蟒蛇2.3.4

红帽企业 Linux ES 第 4 版（Nahant 更新 7）

提前致谢！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-21T19:22:18.693

我想你正在存储（在内存中）一些引用套接字的数据；例如，如果您将请求对象存储在任何地方，则可能会这样做。

关闭套接字的最后机会是当它们被垃圾收集时；如果您正在做任何会阻止垃圾收集到达它们的事情，那就是您的问题。我建议你尝试用 CherryPy 编写的 Hello World 程序来重现；如果你不能在那里重现，你知道它在你的代码中——寻找你保存可以（直接或以其他方式）引用套接字的信息的地方。

# javascript - 按键修改后如何获取 HTML 输入的新值？

> ID：222740
> 
> 赞同：31
> 
> 时间：2008-10-21T17:36:34.710
> 
> 标签：javascript, html, dom

我有一个 HTML 输入框

```
<input type="text" id="foo" value="bar"> 
```

我已经为“ *keyup* ”事件附加了一个处理程序，但是如果我在事件处理程序期间检索输入框的当前值，我会得到原来的值，而不是原来的值！

我试过拿起' *keypress* '和' *change* '事件，同样的问题。

我确信这很容易解决，但目前我认为唯一的解决方案是让我在未来几毫秒内使用短暂的超时来触发一些代码！

*无论如何在这些事件期间获得当前值？*

编辑：看起来我的 js 文件有缓存问题，因为我稍后检查了相同的代码，它工作得很好。我会删除这个问题，但不确定这是否会失去发表想法的好心人的代表:)

* * *

## 回答 #1

> 赞同：38
> 
> 时间：2008-10-21T17:45:01.620

你可以发布你的代码吗？我没有发现任何问题。在 Firefox 3.01/safari 3.1.2 上测试：

```
function showMe(e) {
// i am spammy!
  alert(e.value);
}
....
<input type="text" id="foo" value="bar" onkeyup="showMe(this)" /> 
```

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2015-11-26T18:51:49.503

给这个问题一个***现代的方法。***这很好用，包括`Ctrl`+ `v`。[GlobalEventHandlers.oninput](https://developer.mozilla.org/en-US/docs/Web/API/GlobalEventHandlers/oninput)。

```
var onChange = function(evt) {
  console.info(this.value);
  // or
  console.info(evt.target.value);
};
var input = document.getElementById('some-id');
input.addEventListener('input', onChange, false); 
```

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-10-21T18:00:56.533

输入值有两种：字段的**属性**和字段的 html**属性**。

如果您使用 keyup 事件和 field.value，您将获得该字段的当前值。当您使用 field.getAttribute('value') 时，情况并非如此，它会返回 html 属性 (value="") 中的内容。属性表示输入到字段中的内容并在您输入时更改，而属性不会自动更改（您可以使用 field.setAttribute 方法更改它）。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-21T17:47:01.740

```
<html>
    <head>
        <script>
        function callme(field) {
            alert("field:" + field.value);
        }
        </script>
    </head>
    <body>
        <form name="f1">
            <input type="text" onkeyup="callme(this);" name="text1">
        </form>
    </body>
</html> 
```

看起来您可以使用 onkeyup 来获取 HTML 输入控件的**新**值。希望能帮助到你。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-21T17:51:51.857

你可以试试这段代码（需要 jQuery）：

```
<html>
<head>
    <script type="text/javascript" src="jquery.js"></script>
    <script type="text/javascript">
        $(document).ready(function() {
            $('#foo').keyup(function(e) {
                var v = $('#foo').val();
                $('#debug').val(v);
            })
        });
    </script>
</head>
<body>
    <form>
        <input type="text" id="foo" value="bar"><br>
        <textarea id="debug"></textarea>
    </form>
</body>
</html> 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-21T17:45:02.400

[这](http://www.quirksmode.org/dom/events/index.html)是不同事件和浏览器支持级别的表格。您需要选择至少在所有现代浏览器中都支持的事件。

从表中可以看出，`keypress`and`change`事件没有统一的支持，而`keyup`event 有。

还要确保使用跨浏览器兼容的方法附加事件处理程序...

# c# - 工具箱中没有报告项目（VS 2008 SP1）

> ID：222748
> 
> 赞同：3
> 
> 时间：2008-10-21T17:39:53.237
> 
> 标签：c#, visual-studio-2008, report, toolbox

我正在使用 Visual Studio 2008 SP1（版本 9.0.30729.1）。我的问题是我看到的唯一与报告相关的工具箱项目是 3 个“文本框”控件。其他的东西在哪里？我需要添加对不同程序集的引用吗？

这是我采取的步骤：
1）打开Visual Studio
2）添加新项目->“报告应用程序”
3）打开Report1.rdlc
4）打开工具箱，没有可用的控件（除了重复的3个文本框控件）

谢谢你的帮助。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-02T20:25:36.210

我的直觉告诉我，您的安装中有些东西损坏了。

这是我在尝试修复之前会尝试的方法（最近发生了这种情况）：

我通过进入我的个人资料来解决这个问题，如下所示：

C:\Documents and Settings\MYUSERNAME\Local Settings\Application Data\Microsoft\VisualStudio\8.0\ProjectAssemblies

那里有四个隐藏文件，它们显然构成了工具箱缓存。如果您删除它们，它们将被重新生成并且#13119 将返回到 General。正如我所说，这些文件似乎是隐藏的，因此请相应地配置文件资源管理器。

第二个问题：我的用户控件从工具箱中消失了。
我可以通过进入 VS 菜单来修复它：

Visual Studio“工具”菜单

“选项”子菜单

“Windows 窗体设计器”选项卡“常规”选项卡将“AutoToolboxPopulate”设置为“True”

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-11-18T19:58:51.373

我的问题是报告项目工具箱显示多个文本框而不是有效的报告控件。解决方法：1) 关闭visual studio 2005。 2) 删除C:\Documents and Settings\\Local Settings\application Data\microsoft\visualStudio\ 下的文件夹 3) 打开你的visual studio 2005 项目。它应该工作

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-30T18:14:30.457

以下是通过 Google 图书提供的图书参考：http: [//books.google.com/books ?id=b9j0MKXhnygC&pg=PA419&lpg=PA419&dq=vs+2008+Reports+Application+toolbox&source=web&ots=awTO1ibUZH&sig=7iHAUSCZ46_uAjC5lAfLeiXZt_Q&hl=en&sa=X&oi= book_result&resnum=7&ct=result#PPA433,M1](http://books.google.com/books?id=b9j0MKXhnygC&pg=PA419&lpg=PA419&dq=vs+2008+Reports+Application+toolbox&source=web&ots=awTO1ibUZH&sig=7iHAUSCZ46_uAjC5lAfLeiXZt_Q&hl=en&sa=X&oi=book_result&resnum=7&ct=result#PPA433,M1)

我也做了同样的事情（在相同的 VS2008 SP1 上）并且有完全相同的项目可用。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-06T23:09:58.057

完全重新安装处理了它。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-08-19T11:11:14.767

谢谢！！

这修复了我的报表设计器工具箱。我的“报告项目”组只显示了三个文本框项目。

我在 Vista 上，所以文件夹是.. C:\Users\Fox\AppData\Local\Microsoft\VisualStudio

我刚刚重命名了它，下次 VS 启动时，它重新创建了工具箱，所有项目都到位。

在执行此操作之前，我曾尝试在 VS 中使用“右键单击|重置工具箱”来重置工具箱，但它并没有解决问题，只有删除此文件夹才能解决问题。

# python - 对包含元组的元组进行排序

> ID：222752
> 
> 赞同：12
> 
> 时间：2008-10-21T17:40:51.567
> 
> 标签：python, sorting, tuples

我有以下元组，其中包含元组：

```
MY_TUPLE = (
    ('A','Apple'),
    ('C','Carrot'),
    ('B','Banana'),
) 
```

我想根据内部元组中包含的**第二个**值对这个元组进行排序（即排序 Apple、Carrot、Banana 而不是 A、B、C）。

有什么想法吗？

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2008-10-21T17:44:08.207

```
from operator import itemgetter

MY_SORTED_TUPLE = tuple(sorted(MY_TUPLE, key=itemgetter(1))) 
```

或没有`itemgetter`：

```
MY_SORTED_TUPLE = tuple(sorted(MY_TUPLE, key=lambda item: item[1])) 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-10-21T17:45:56.563

从[排序迷你如何](http://wiki.python.org/moin/HowTo/Sorting#head-d121eed08556ad7cb2a02a886788656dadb709bd)

> 通常有一个内置函数可以满足您的需求，例如 str.lower()。操作员模块包含许多对此有用的功能。例如，您可以使用 operator.itemgetter() 根据第二个元素对元组进行排序：

```
>>> import operator 
>>> L = [('c', 2), ('d', 1), ('a', 4), ('b', 3)]
>>> map(operator.itemgetter(0), L)
['c', 'd', 'a', 'b']
>>> map(operator.itemgetter(1), L)
[2, 1, 4, 3]
>>> sorted(L, key=operator.itemgetter(1))
[('d', 1), ('c', 2), ('b', 3), ('a', 4)] 
```

希望这可以帮助。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-21T17:45:12.073

```
sorted(my_tuple, key=lambda tup: tup[1]) 
```

换句话说，在比较要排序的元组的两个元素时，根据作为键参数传递的函数的返回值进行排序。

* * *

## 回答 #4

> 赞同：-2
> 
> 时间：2008-10-21T17:52:01.467

我使用此代码实现了同样的目标，但您的建议很棒。谢谢！

```
templist = [ (line[1], line) for line in MY_TUPLE ] 
templist.sort()
SORTED_MY_TUPLE = [ line[1] for line in templist ] 
```

# internet-explorer - 从 Internet Explorer 6 将 csv 文件格式打开到 Excel 中

> ID：222755
> 
> 赞同：1
> 
> 时间：2008-10-21T17:41:25.653
> 
> 标签：internet-explorer, csv

我正在使用 Java Struts，使用以下代码将其发送给用户

```
response.setContentType("application/vnd.ms-excel"); 
response.setHeader("Content-Disposition", "attachment;filename=" + fileFullName); 
```

首先，我希望这是我的问题的正确位置...... :) 我希望你能帮助我。

当我尝试从 Internet Explorer 打开文件时收到的错误消息是

```
"C:\Documents and Settings\USERNAME\Local Settings\Temporary Internet
Files\Content.IE5\QXJ0P436\btbillsdfjlsfjk.csv' could not be found" 
```

我正在尝试将 csv 文件格式“打开”到 Excel 中。它允许我将文件“保存”到我想要的任何目录，但我不想这样做，我只想打开文件。这在过去一直有效，所以我现在想知道为什么文件“丢失”。

有任何想法吗？

提前致谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-21T17:48:23.767

检查工具 - Internet 选项 - 常规选项卡 - 临时 Internet 文件 - 设置... - 并检查您是否有足够的空间来保存 csv 文件，并且该路径看起来像您发布的那个。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-22T00:51:08.640

这并不是一个真正与编程相关的问题，但无论如何，这通常是由于用户权限不足而发生的。

您可能会在 Windows 支持网站上找到更好的支持。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-21T17:54:45.797

你是通过 HTTPS 下载的吗？如果标题与 , ,不相似`Expires: 0`， IE 可能会出现很多问题`Pragma: cache``Cache-Control: private`

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-06T21:26:22.973

我遇到了与此类似的问题，发现问题是当文件名中有空格时 IE 出现问题。如果内容配置是附件而不是内联文件，也会出现问题。

内容处置：内联；文件名=NoSpacesFileName.csv

所有其他浏览器都可以通过 HTTPS 正常工作。更改其他标题并没有影响我的问题。

# asp.net - 在渲染为位图之前缩放 WPF 内容

> ID：222756
> 
> 赞同：9
> 
> 时间：2008-10-21T17:41:30.597
> 
> 标签：asp.net, wpf, vb.net

背景：我正在开发一个silverlight (1.0) 应用程序，该应用程序可以动态构建美国地图，并在特定位置覆盖图标和文本。该地图在浏览器中运行良好，现在我需要获取显示地图的静态（可打印和可插入文档/powerpoints）副本。

目标：为了获得地图的可打印副本，该副本也可用于 powerpoint 幻灯片、word 等。我选择创建一个 ASP.NET HttpHandler 以在 WPF 的服务器端重新创建 xaml，然后渲染WPF 转换为以 png 文件形式返回的位图图像，以 300dpi 生成以获得更好的打印质量。

问题：这对一个问题很有效，我无法将图像缩放到指定的大小。我尝试了几种不同的方法，其中一些可以在注释掉的行中看到。我需要能够以英寸或像素为单位指定图像的高度和宽度，我不一定关心哪个，并将生成的位图的 xaml 缩放到该大小。目前，如果我将尺寸设置为大于根画布，则画布会以指定尺寸在生成图像的左上角以其原始尺寸呈现。下面是我的 httphandler 的重要部分。存储为“MyImage”的根画布的高度为 600，宽度为 800。为了使内容缩放以适合指定的大小，我缺少什么？

我不完全理解传递给 Arrange() 和 Measure() 的维度是做什么的，因为其中一些代码取自在线示例。我也不完全理解 RenderTargetBitmap 的东西。任何指导将不胜感激。

```
Public Sub Capture(ByVal MyImage As Canvas)
    ' Determine the constraining scale to maintain the aspect ratio and the bounds of the image size
    Dim scale As Double = Math.Min(Width / MyImage.Width, Height / MyImage.Height)

    'Dim vbox As New Viewbox()
    'vbox.Stretch = Stretch.Uniform
    'vbox.StretchDirection = StretchDirection.Both
    'vbox.Height = Height * scale * 300 / 96.0
    'vbox.Width = Width * scale * 300 / 96.0
    'vbox.Child = MyImage

    Dim bounds As Rect = New Rect(0, 0, MyImage.Width * scale, MyImage.Height * scale)
    MyImage.Measure(New Size(Width * scale, Height * scale))
    MyImage.Arrange(bounds)
    'MyImage.UpdateLayout()

    ' Create the target bitmap
    Dim rtb As RenderTargetBitmap = New RenderTargetBitmap(CInt(Width * scale * 300 / 96.0), CInt(Height * scale * 300 / 96.0), 300, 300, PixelFormats.Pbgra32)

    ' Render the image to the target bitmap
    Dim dv As DrawingVisual = New DrawingVisual()
    Using ctx As DrawingContext = dv.RenderOpen()
        Dim vb As New VisualBrush(MyImage)
        'Dim vb As New VisualBrush(vbox)
        ctx.DrawRectangle(vb, Nothing, New Rect(New System.Windows.Point(), bounds.Size))
    End Using
    rtb.Render(dv)

    ' Encode the image in the format selected
    Dim encoder As System.Windows.Media.Imaging.BitmapEncoder
    Select Case Encoding.ToLower
        Case "jpg"
            encoder = New System.Windows.Media.Imaging.JpegBitmapEncoder()
        Case "png"
            encoder = New System.Windows.Media.Imaging.PngBitmapEncoder()
        Case "gif"
            encoder = New System.Windows.Media.Imaging.GifBitmapEncoder()
        Case "bmp"
            encoder = New System.Windows.Media.Imaging.BmpBitmapEncoder()
        Case "tif"
            encoder = New System.Windows.Media.Imaging.TiffBitmapEncoder()
        Case "wmp"
            encoder = New System.Windows.Media.Imaging.WmpBitmapEncoder()
    End Select
    encoder.Frames.Add(System.Windows.Media.Imaging.BitmapFrame.Create(rtb))

    ' Create the memory stream to save the encoded image.
    retImageStream = New System.IO.MemoryStream()
    encoder.Save(retImageStream)
    retImageStream.Flush()
    retImageStream.Seek(0, System.IO.SeekOrigin.Begin)
    MyImage = Nothing
End Sub 
```

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-10-22T04:29:15.547

这应该足以让你开始：

```
 private void ExportCanvas(int width, int height)
{
    string path = @"c:\temp\Test.tif";
    FileStream fs = new FileStream(path, FileMode.Create);

    RenderTargetBitmap renderBitmap = new RenderTargetBitmap(width,
                                                             height, 1/300, 1/300, PixelFormats.Pbgra32);

    DrawingVisual visual = new DrawingVisual();
    using (DrawingContext context = visual.RenderOpen())
    {
        VisualBrush brush = new VisualBrush(MyCanvas);
        context.DrawRectangle(brush,
                              null,
                              new Rect(new Point(), new Size(MyCanvas.Width, MyCanvas.Height)));
    }

    visual.Transform = new ScaleTransform(width / MyCanvas.ActualWidth, height / MyCanvas.ActualHeight);

    renderBitmap.Render(visual);

    BitmapEncoder encoder = new TiffBitmapEncoder();
    encoder.Frames.Add(BitmapFrame.Create(renderBitmap));
    encoder.Save(fs);
    fs.Close();
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-22T20:06:21.647

这最终为我工作：

```
Public Sub Capture(ByVal MyImage As Canvas)
        ' Normally we would obtain a user's configured DPI setting to account for the possibilty of a high DPI setting. 
        ' However, this code is running server side so the client's DPI is not obtainable.
        Const SCREEN_DPI As Double = 96.0   ' Screen DPI
        Const TARGET_DPI As Double = 300.0  ' Print Quality DPI

        ' Determine the constraining scale to maintain the aspect ratio and the bounds of the image size
        Dim scale As Double = Math.Min(Width * SCREEN_DPI / MyImage.Width, Height * SCREEN_DPI / MyImage.Height)

        ' Setup the bounds of the image
        Dim bounds As Rect = New Rect(0, 0, MyImage.Width * scale, MyImage.Height * scale)
        MyImage.Measure(New Size(MyImage.Width * scale, MyImage.Height * scale))
        MyImage.Arrange(bounds)

        ' Create the target bitmap
        Dim rtb As RenderTargetBitmap = New RenderTargetBitmap(CDbl(MyImage.Width * scale / SCREEN_DPI * TARGET_DPI), CDbl(MyImage.Height * scale / SCREEN_DPI * TARGET_DPI), TARGET_DPI, TARGET_DPI, PixelFormats.Pbgra32)

        ' Render the image to the target bitmap
        Dim dv As DrawingVisual = New DrawingVisual()
        Using ctx As DrawingContext = dv.RenderOpen()
            Dim vb As New VisualBrush(MyImage)
            ctx.DrawRectangle(vb, Nothing, New Rect(New System.Windows.Point(), bounds.Size))
        End Using
        ' Transform the visual to scale the image to our desired size.
        'dv.Transform = New ScaleTransform(scale, scale)

        ' Render the visual to the bitmap.
        rtb.Render(dv)

        ' Encode the image in the format selected. If no valid format was selected, default to png.
        Dim encoder As System.Windows.Media.Imaging.BitmapEncoder
        Select Case Encoding.ToLower
            Case "jpg"
                encoder = New System.Windows.Media.Imaging.JpegBitmapEncoder()
            Case "png"
                encoder = New System.Windows.Media.Imaging.PngBitmapEncoder()
            Case "gif"
                encoder = New System.Windows.Media.Imaging.GifBitmapEncoder()
            Case "bmp"
                encoder = New System.Windows.Media.Imaging.BmpBitmapEncoder()
            Case "tif"
                encoder = New System.Windows.Media.Imaging.TiffBitmapEncoder()
            Case "wmp"
                encoder = New System.Windows.Media.Imaging.WmpBitmapEncoder()
            Case Else
                encoder = New System.Windows.Media.Imaging.PngBitmapEncoder()
        End Select
        encoder.Frames.Add(System.Windows.Media.Imaging.BitmapFrame.Create(rtb))

        ' Create the memory stream to save the encoded image.
        retImageStream = New System.IO.MemoryStream()
        encoder.Save(retImageStream)
        retImageStream.Flush()
        retImageStream.Seek(0, System.IO.SeekOrigin.Begin)
        MyImage = Nothing
    End Sub 
```

# c# - 以编程方式在excel中插入单元格注释

> ID：222760
> 
> 赞同：5
> 
> 时间：2008-10-21T17:43:21.733
> 
> 标签：c#, excel, .net-3.5, openxml

使用 c# 和 .net 3.5 以编程方式在 excel 2007 文件中插入单元格注释的更好方法是什么？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-21T17:59:35.913

我只是这样做了，但使用的是 MS Word（使用 Microsoft.Office.Interop.Word

range.Comments.Add ( range, ref _categoryMessage );

所以，我建议使用 Microsoft.Office.Interop.Excel 和类似的方法。从 MSDN 考虑这一点：

[https://docs.microsoft.com/en-us/dotnet/api/microsoft.office.interop.excel.range.addcomment](https://docs.microsoft.com/en-us/dotnet/api/microsoft.office.interop.excel.range.addcomment)

也看到[这个](https://stackoverflow.com/questions/213303/sofware-requirements-analysis#213452)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2013-08-20T19:35:38.027

接受的答案指向正确的方向，但正确的语法是：

```
Excel.Range cell; 
cell.AddComment("My comment"); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2016-05-12T06:49:39.557

```
Excel._Worksheet oSheet =
  (Microsoft.Office.Interop.Excel._Worksheet) excelWorkbook.ActiveSheet;
oSheet.Cells[2, 3].Cells.AddComment("Selam"); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-21T17:56:39.023

你试过使用 VSTO 吗？您可以轻松加载 Excel 文档并对其进行操作。要将注释添加到单元格，请加载文件，激活工作表，然后选择单元格作为范围并设置注释。

# .net - linq中的时间日期转换

> ID：222772
> 
> 赞同：1
> 
> 时间：2008-10-21T17:45:24.053
> 
> 标签：.net, linq, linq-to-sql

我想将格式为“7/20/2008”的日期时间与数据库中格式为“7/20/2008 7:14:53 AM”的日期时间进行比较。

我尝试使用“like”子句，但它不起作用，因为“like”子句仅使用字符串，而我使用的是日期时间格式。

谁能告诉如何在数据库中转换和比较它并提取日期时间。

```
 protected void User_Querytime()
    {
    DataClasses2DataContext dc1 = new DataClasses2DataContext();
    DateTime date1;

    string date = Request.QueryString.Get("TimeOfMessage");
    date1 = Convert.ToDateTime(date);

    var query7 = from u in dc1.syncback_logs
                 where u.TimeOfMessage = date1
                 orderby u.TimeOfMessage descending
                 select u;
    GridView1.DataSource = query7;
    GridView1.DataBind();
    } 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-21T18:22:26.117

我假设您遇到问题，因为`date1`仅包含日期，而您的数据库包含完整的日期/时间值。要查找匹配项，您需要选择以下方法之一：

1）从数据库值中删除时间信息，然后再将它们与您的目标进行比较 2）将您的目标转换为一个范围，然后在该范围内查找数据库值。

```
List<DateTime> dateTimes = new List<DateTime>();
dateTimes.Add(DateTime.Parse("7/20/2008 7:14:53 AM"));
dateTimes.Add(DateTime.Parse("7/20/2008 12:12:01 AM"));
dateTimes.Add(DateTime.Parse("7/21/2008 9:00:00 AM"));
dateTimes.Add(DateTime.Parse("7/20/2009 7:14:53 AM"));

DateTime targetDate = Convert.ToDateTime("7/20/2008");

// Remove time info from data in database
var matchingDates = from date in dateTimes
                    where date.Date == targetDate
                    select date;

// Or use your target date to create a range
DateTime rangeStart = new DateTime(targetDate.Year, targetDate.Month, targetDate.Day, 0, 0, 0);
DateTime rangeEnd = new DateTime(targetDate.Year, targetDate.Month, targetDate.Day, 23, 59, 59);

var matchingDates2 = from date in dateTimes
                     where (date >= rangeStart) && (date <= rangeEnd)
                     select date; 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-21T18:09:20.870

尽管我无法测试您的确切问题，但我能够将日期与以下代码进行比较。

```
 // Random Date Collection
    List<DateTime> dateTimes = new List<DateTime>();
    dateTimes.Add(DateTime.Parse("7/20/2008 7:14:53 AM"));
    dateTimes.Add(DateTime.Parse("7/20/2008 7:14:54 AM"));
    dateTimes.Add(DateTime.Parse("7/20/2009 7:14:53 AM"));

    DateTime myDateTime = DateTime.Parse("7/20/2008");

    var query = from d in dateTimes
                where d.ToShortDateString() == myDateTime.ToShortDateString()
                select d; 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-21T18:13:12.950

与其直接比较日期，不如将它与您接受的最小值/最大值进行比较。因此，不要使用“DbDateCol = mydate”，而是执行“DbDateCol >= myDate.Date and DbDateCol < myDate.Date.AddDays(1)”。

通过使用 Date 属性，您将去掉时间分量（强制它为 0）。通过添加一天，您将获得第二天的开始，将其限制在 DateTime 实例的日期上。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-21T18:13:52.577

假设我正确理解了您的问题，您应该可以使用

```
where u.TimeOfMessage.Date == date1 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-21T18:19:39.303

假设`TimeOfMessage`属性是 DateTime 那么你应该能够做到 `TimeOfMessage.Date`== date1

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-09-26T10:50:11.563

```
using System.Data.Objects; 
```

使用上面并修改您的查询，如下所示：

```
 var bla = (from log in context.Contacts
               where EntityFunctions.TruncateTime(log.ModifiedDate) < today.Date
               select log).FirstOrDefault(); 
```

# html - 定位div的问题

> ID：222777
> 
> 赞同：1
> 
> 时间：2008-10-21T17:46:29.917
> 
> 标签：html, positioning

我正在使用`div`s 布局的网站上工作。我特别遇到了一个问题：培训照片`div`。

如果您访问[http://php.wmsgroup.com/eofd6.org/education.html](http://php.wmsgroup.com/eofd6.org/education.html)，您会在左侧导航下方看到一张已下拉的照片。我希望它直接在那个导航框下方。我已经尝试了几种不同的定位以及主要内容`div`的定位，但我无法正确定位。

任何帮助，将不胜感激。样式表的链接是[http://php.wmsgroup.com/eofd6.org/in.css](http://php.wmsgroup.com/eofd6.org/in.css)

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-21T17:53:11.353

将#content 向右浮动，而不是向左浮动。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-21T18:02:09.790

为了获得更可预测的结果，我将创建一个整体包装器，然后创建 2 个列包装器。你现在已经接近这个布局了，所以这将是一个简单的修复。

```
<html>
<head>
    <style type="text/css">
        #leftColumn {
            width: 30%;
            margin: 0px;
            float: left;
            display: inline;
            clear: left;
        }

         #rightColumn{
            width: 60%; /* allow 10% for flex/margins */
            margin: 0px auto;
            float: left;
            display: inline; 
            clear: right;
        }

    </style>
</head>
<body>
    <div id="pageWrapper">
        <div id="header"></div>
        <div id="leftColumn">
            <div id="nav"> </div>
            <div id="training_photo"> </div>
        </div>
        <div id="rightColumn">
             <div id="content"> </content>
        </div>
    </div>
    <div id="footer"> </footer>
</body> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-21T17:56:05.293

您不能更改标记以将#training_photo div 包含在#nav div 中吗？

# c++ - 添加 Boost 使 Debug 构建依赖于“非 D”MSVC 运行时 DLL

> ID：222778
> 
> 赞同：5
> 
> 时间：2008-10-21T17:46:33.537
> 
> 标签：c++, visual-studio-2008, dll, boost, sxs

我有一个烦人的问题，我可能能够以某种方式规避它，但另一方面，我宁愿在它之上并了解到底发生了什么，因为看起来这些东西真的会留下来。

故事是这样的：我有一个简单的 OpenGL 应用程序，它运行良好：在编译、链接或运行它时从来没有出现过大问题。现在我决定尝试将一些更密集的计算转移到工作线程中，以便可能使 GUI 响应更快——当然是使用 Boost.Thread。

简而言之，如果我在 .cpp 文件的开头添加以下片段：

```
#include <boost/thread/thread.hpp>

void dummyThreadFun() { while (1); }    

boost::thread p(dummyThreadFun); 
```

，然后我在尝试启动调试版本时开始收到“此应用程序无法启动，因为未找到 MSVCP90.dll”。（发布模式工作正常。）

现在查看使用 Dependency Walker 的可执行文件，他也没有找到这个 DLL（我猜这是预期的），我可以看到我们正在寻找它以便能够调用以下函数：

```
?max@?$numeric_limits@K@std@@SAKXZ
?max@?$numeric_limits@_J@std@@SA_JXZ
?min@?$numeric_limits@K@std@@SAKXZ
?min@?$numeric_limits@_J@std@@SA_JXZ 
```

接下来，我尝试转换每个实例`min`并`max`改为使用宏，但可能找不到对它们的所有引用，因为这没有帮助。（我正在使用一些我没有可用源代码的外部库。但即使我能做到这一点——我认为这真的不是正确的方法。）

所以，我的问题——我猜——是：

1.  即使使用调试版本，为什么我们还要寻找非调试 DLL？
2.  解决问题的正确方法是什么？或者甚至是一个快速而肮脏的？

我首先在 Visual Studio 2008 的普通安装中安装了这个。然后尝试安装 Feature Pack 和 SP1，但它们也没有帮助。当然也尝试过多次Rebuild。

我正在为 Boost (v1.36.0) 使用预构建的二进制文件。这不是我第一次在这个项目中使用 Boost，但它可能是我第一次使用基于单独源的部件。

禁用增量链接没有帮助。该程序是 OpenGL 的事实似乎也不相关——当我将相同的三行代码添加到一个简单的控制台程序中时，我遇到了类似的问题（但它抱怨 MSVCR90.dll 和`_mkdir`，当我替换后者`boost::create_directory`，问题消失了！！）。它实际上只是分别删除或添加使程序运行正常或根本不运行的那三行。

我不能说我理解并排（甚至不知道这是否相关，但这是我现在的假设），老实说，我也不是很感兴趣——只要我能构建、调试和部署我的应用程序...

* * *

**编辑 1：**在尝试构建一个能够重现问题的精简示例时，我发现该问题与[Spread Toolkit](http://www.spread.org/)有关，它的使用是我所有遇到此问题的程序的共同因素。（但是，在开始链接 Boost 内容之前，我从未有过这个。）

我现在想出了一个最小的程序，可以让我重现这个问题。它由两个编译单元A.cpp和B.cpp组成。

A.cpp：

```
#include "sp.h"

int main(int argc, char* argv[])
{
    mailbox mbox = -1;
    SP_join(mbox, "foo");

    return 0;
} 
```

B.cpp：

```
#include <boost/filesystem.hpp> 
```

一些观察：

1.  如果我注释掉`SP_join`A.cpp 行，问题就消失了。
2.  如果我注释掉 B.cpp 的单行，问题就消失了。
3.  如果我将 B.cpp 的单行移动或复制到 A.cpp 的开头或结尾，问题就会消失。

（场景2和3，调用时程序崩溃`SP_join`，但那只是因为邮箱无效......这与手头的问题无关。）

此外，Spread 的核心库已链接，这肯定是我的问题 #1 答案的一部分，因为我的系统中没有该库的调试版本。

目前，我正在尝试提出一些可以在另一个环境中重现该问题的方法。（尽管如果它真的可以在我的场所之外重复，我会感到非常惊讶......）

* * *

**编辑 2：**好的，所以[现在](http://users.tkk.fi/jsreunan/BoostThreadTest.zip)我们有一个包，我可以使用它在 WinXP32 + VS2008 + Boost 1.36.0 的几乎普通安装上重现该问题（仍然[是来自 BoostPro Computing 的预构建二进制文件](http://www.boostpro.com/products/free)）。

罪魁祸首肯定是 Spread 库，我的构建不知何故需要一个用于*MSVC 6*的相当古老的 STLPort 版本！尽管如此，我仍然觉得这些症状比较有趣。此外，很高兴听到您是否可以真正重现该问题 - 包括上面的场景 1-3。包装很小，应该包含所有必要的部件。

事实证明，这个问题与 Boost.Thread 没有任何关系，因为这个例子现在使用了 Boost Filesystem 库。此外，它现在抱怨 MSVCR90.dll，而不是以前的 P。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-22T14:04:37.290

Boost.Thread 有很多可能的构建组合，以尝试满足使用 MSVC 可能的链接场景中的所有差异。首先，您可以静态链接到 Boost.Thread，也可以在单独的 DLL 中链接到 Boost.Thread。然后，您可以链接到 MSVC 运行时的 DLL 版本或静态库运行时。最后，您可以链接到调试运行时或发布运行时。

Boost.Thread 标头尝试使用编译器生成的预定义宏自动检测构建场景。为了链接到使用您需要`_DEBUG`定义的调试运行时的版本。这是由 /MD 和 /MDd 编译器开关自动定义的，所以应该没问题，但您的问题描述另有说明。

您从哪里获得预构建的二进制文件？您是在项目设置中明确选择库，还是让自动链接机制选择适当的 .lib 文件？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-21T20:44:11.633

这是一个典型的链接错误。看起来您正在[链接到本身链接到错误 C++ 运行时的 Boost DLL](http://www.boost.org/doc/libs/1_36_0/more/getting_started/windows.html#library-naming)（还有[这个页面](http://www.boost.org/development/separate_compilation.html)，对“线程”进行文本搜索）。它看起来也像`boost::posix::time`库链接到正确的 DLL。

不幸的是，我没有找到讨论如何选择正确构建的 Boost DLL 的页面（尽管我确实找到了一封似乎指向和的[三年前的电子邮件](http://lists.boost.org/Archives/boost/2005/11/96515.php)）。`BOOST_THREAD_USE_DLL``BOOST_THREAD_USE_LIB`

* * *

再次查看您的答案，您似乎正在使用预构建的二进制文件。您无法链接到的 DLL 是[TR1 功能包的一部分](http://blogs.msdn.com/vcblog/archive/2008/01/08/q-a-on-our-tr1-implementation.aspx)（该页面上的第二个问题）。 [该功能包可在 Microsoft 的网站上找到](http://www.microsoft.com/downloads/details.aspx?FamilyId=D466226B-8DAB-445F-A7B4-448B326C48E7&displaylang=en)。或者你需要一个不同的二进制文件来链接。显然，该`boost::posix::time`库链接到未修补的 C++ 运行时。

由于您已经应用了功能包，我认为下一步我将采取手动构建 Boost。这是我一直走的路，而且非常简单： [下载 BJam 二进制文件](http://www.boost.org/users/download/)，然后在库源中运行 Boost Build 脚本。就是这样。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-22T14:39:53.303

我相信我过去在使用 Boost 时也遇到过同样的问题。据我了解，这是因为 Boost 标头使用预处理器指令链接到正确的库。如果您的调试和发布库在同一个文件夹中并且具有不同的名称，“自动链接”功能将无法正常工作。

我所做的是为我的项目定义 BOOST_ALL_NO_LIB（这可以防止标题“自动链接”），然后使用 VC 项目设置链接到正确的库。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-23T01:02:40.457

看起来其他人已经回答了问题的 Boost 方面。这是有关 MSVC 方面的一些背景信息，这可能会节省更多的麻烦。

可能有 4 个版本的 C（和 C++）运行时：

*   /MT：libcmt.lib (C)、libcpmt.lib (C++)
*   /MTd：libcmtd.lib、libcpmtd.lib
*   /MD：msvcrt.lib、msvcprt.lib
*   /MDd：msvcrtd.lib、msvcprtd.lib

DLL 版本仍然需要链接到该静态库（它以某种方式完成所有设置以在运行时链接到 DLL - 我不知道详细信息）。注意在所有情况下调试版本都有`d`后缀。C 运行时使用中`c`缀，C++ 运行时使用中`cp`缀。看到图案了吗？在任何应用程序中，您都应该只链接到其中一行中的库。

有时（如您的情况），您发现自己链接到其他人的静态库，该库被配置为使用错误版本的 C 或 C++ 运行时（通过非常烦人的`#pragma comment(lib)`. 您可以通过提高链接器的详细程度来检测到这一点，但它是一个真正值得寻找的 PITA。“用火箭筒杀死啮齿动物”的解决方案是使用`/nodefaultlib:...`链接器设置来排除您知道不需要的 6 个 C 和 C++ 库。我过去使用过这个没有问题，但我不肯定它会一直有效......也许有人会从木制品中走出来告诉我这个“解决方案”如何导致你的程序在周二下午吃掉婴儿.

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-21T17:53:38.793

现在这变得更有趣了......如果我只是在源代码的某个地方添加它：

```
boost::posix_time::ptime pt = boost::posix_time::microsec_clock::universal_time(); 
```

（连同相应的`#include`东西），然后它又可以正常工作了。所以这是一个快速且不太脏的解决方案，但是，嘿 - 这里发生了什么，真的吗？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-21T20:27:46.707

从内存中，boost 库的各个部分需要您定义一些预处理器标志才能正确编译。之类的东西`BOOST_THREAD_USE_DLL`。

`BOOST_THREAD_USE_DLL`不会是导致此特定错误的原因，但它可能希望您定义或`_DEBUG`类似的东西。我记得几年前在我们的 boost C++ 项目中，我们`BOOST_XYZ`在 Visual Studio 编译器选项（或 makefile）中声明了很多额外的预处理器定义

检查`config.hpp`boost 线程目录中的文件。当你拉入这些`ptime`东西时，它可能包含一个不同的`config.hpp`文件，然后它可能会以不同的方式定义这些预处理器的东西。

# git - GIT vs. Perforce - 两个 VCS 将进入...一个将离开

> ID：222782
> 
> 赞同：85
> 
> 时间：2008-10-21T17:49:08.100
> 
> 标签：git, perforce, process-management

所以我正在工作中出售 GIT。我需要做的第一件事是让每个人相信 GIT 在他们已经习惯的事情上做得更好。我们目前使用 Perforce。其他人有过类似的销售吗？有什么好的链接/建议吗？

最大的胜利之一是我们可以在与网络断开连接的情况下使用它。IMO 的另一个胜利是处理添加/结帐的方式。欢迎加分！此外，我们总共有大约 10-20 名开发人员。

* * *

## 回答 #1

> 赞同：84
> 
> 时间：2010-05-06T03:54:25.993

我在工作中使用 Perforce。我也使用 Git，因为当我处理代码并且无法连接到服务器时，我仍然想要某种形式的版本控制。不，调和离线工作只是不一样。这是我发现 git 有很大好处的地方：

1.  分支速度 - git 最多需要几秒钟。
2.  冲突 - P4Merge 的自动解析一次破坏了一周的工作。从那以后，我宁愿在合并时手动解决。当 Git 提示我有冲突时，它实际上是一个冲突。其余时间，git 会正确解决问题，我节省了大量时间。
3.  跟踪合并 - 如果您有一个分支不断接收来自其他两个分支的合并，您就会知道 perforce 会让人头疼。使用 git，头痛被最小化，因为在 git 中合并的结果实际上是一个新的提交，它知道它的祖先是谁。
4.  权限 - 我忘记了我尝试处理文件的次数，但因为没有在 Perforce 中签出而无法处理。如果您离线使用 XCode（或任何没有可靠的 Perforce SCM 插件的编辑器），您就会知道这有多烦人。我不必担心 Git。我做出改变。Git 不会阻止我并在后台跟踪它们。
5.  保持主树整洁 - 使用 git，我可以对提交进行排序并整理代码，以便历史看起来整洁。没有“签入此文件，因为它应该是先前签入的一部分”垃圾。我像这样压制提交，因为它们没有帮助任何人。
6.  暂存 - 您的 perforce 服务器需要是 2010.1 或更高版本才能使用 p4 shelve 命令。
7.  创建补丁 - 在 git 中很容易做到。不知道在不使用命令行的情况下是否可以在 Perforce 中使用。
8.  从 GUI 发送补丁 - 再次，git 在这里获胜。
9.  磁盘空间 - 使用 perforce，每个分支都是一个副本。这意味着如果你的源代码树很大，你的磁盘空间会很快被消耗掉。一旦你开始建造，这甚至不包括额外的空间。为什么还要在分支和磁盘空间之间建立链接？使用 git，您可以拥有 100 个分支，并且一次只存在一个分支。如果您特别想同时处理两个版本，您可以克隆，完成您的工作，然后根据需要删除一个克隆，而不会丢失任何内容。
10.  如果您使用的是 XCode4，则已放弃对 perforce 的支持，并且现在内置了 git 支持。如果您像我一样进行跨平台工作，这很重要。通过 Visual Studio，您可以使用 git 扩展。使用 perforce，它在两个操作系统上都同样糟糕。好吧，现在在 Mac 上可能会多一点 XCode4 在现场。
11.  查找错误的签入（或 git bisect 规则） - 是否曾尝试使用 perforce 进行二分搜索以找出引入错误的位置？很麻烦，是吗？当中间有其他分支的集成时，就更麻烦了。为什么？因为这些任务没有自动化。您需要编写自己的工具来与 perforce 对话，而且您通常没有时间。使用 git，您可以为其指定起点（“好”点和“坏”点），它会自动为您搜索。更好的是，如果您有一个可以自动化构建和测试过程的脚本，您可以将 git 连接到该脚本，并且查找签入的整个过程都是自动化的。应该是这样的。
12.  跨重构跟踪更改 - 尝试将 BigClass 拆分为 SmallClass1 和 SmallClass2。对于 Perforce，BigClass 现在已不复存在，并且有两个新类（SmallClass1 和 SmallClass2 已加入源代码树）。对于 Perforce，BigClass 与 SmallClass1 和 SmallClass2 之间没有关系。另一方面，Git 足够聪明，知道现在 x% 的 BigClass 在 SmallClass1 中，y% 的 BigClass 在 SmallClass2 中，并且 BigClass 已不复存在。现在，从正在审查跨多个分支的更改的人的角度来看，您告诉我您会发现哪种方法更有用 - Git 或 Perforce。就个人而言，我更喜欢 Git 的方法，因为它更准确地反映了代码的实际变化。Git 能够做到这一点，因为它跟踪文件中的内容，而不是文件本身。
13.  集中式或分散式：Git 是一个[DVCS](http://en.wikipedia.org/wiki/Distributed_revision_control)系统，而 perforce 是集中式的。中心化的 VCS 以后不能去中心化，但是 DVCS（尤其是 git）可以中心化。有几种产品可以为 git 添加非常细粒度的访问控制，如果这是业务需要的话。就个人而言，我会选择一个从长远来看能给我更大灵活性的系统。
14.  分支映射：如果你想直接在 Perforce 中进行分支，你需要创建一个分支映射。这是有原因的，但它们与 Perforce 如何概念化分支有关。作为开发人员或团队，这仅仅意味着工作流程中的一个步骤，我认为这根本没有效率。
15.  在团队之间共享工作：使用 Perforce，您不能拆分提交。A 团队正在开发功能 A。B 团队正在开发 B 功能。C 团队正在修复错误。现在，团队 A 和 B 必须修复一堆错误才能实现他们的功能。唯一的问题是，他们在提交更改时并没有那么自律（可能是因为他们赶在截止日期前），因此他们的“错误修复”是较大提交的一部分，其中还包含新内容，就其版本控制而言分支机构感到担忧。但是，C 团队现在正在做一个点发布，并希望从其他团队那里获得错误修复。如果他们使用 Git，C 团队可以挑选其他团队的相关更改，将它们拆分，只取他们需要的东西，而不用担心引入任何部分实现的功能。使用 Perforce，
16.  更改平台 - 如果将来出于任何原因，您决定更改您选择的平台，使用 Perforce，您将受到 Perforce.com 的摆布以及您选择的平台的工具的可用性。
17.  更改为未来令人惊叹的源代码控制引擎 X - 如果您决定更改用于源代码控制的内容，从 Perforce 中提取源代码控制历史并将其移动到新系统 X 将是一场噩梦，因为它是封闭源代码并且是最好的你可以做的就是猜测 - 只是谷歌的 Perforce 到 Git 迁移来了解我在说什么。至少对于它的开源 Git，它消除了很多涉及的猜测。

好吧，那是我的 2 美分。在 Perforce 的辩护中，我得说他们的客户支持规则，他们的 Time Lapse View 工具也是如此。我不知道如何使用 git 获得延时视图。但是为了方便和节省时间，我每天都会使用 git。

* * *

## 回答 #2

> 赞同：75
> 
> 时间：2008-10-21T23:41:43.477

Perl 5 解释器源代码目前正在经历从 Perforce 转换为 git 的阵痛。也许 Sam Vilain 的`git-p4raw`进口商很有趣。

无论如何，您将在每个集中式 VCS 和大多数分布式 VCS 上获得的主要胜利之一也是原始的、极快的***速度***。在您亲身体验之前，您无法想象将整个项目历史放在手边是多么的解脱，仅仅几分之一秒。即使生成包含每个提交的完整差异的整个项目历史的提交日志，也可以在几分之一秒内进行测量。Git 太快了，你的帽子会飞的。必须通过网络往返的 VCS 根本没有竞争的机会，甚至在千兆以太网链路上也没有。

此外，git 可以很容易地在进行提交时进行仔细选择，从而允许将工作副本（甚至在单个文件中）中的更改分散到多个提交中——如果需要，还可以跨不同的分支进行更改。这可以让你在工作时做更少的心理笔记——你不需要那么仔细地计划你的工作，预先决定你将要进行哪些更改并确保推迟其他任何事情。您可以随心所欲地进行任何更改，并且仍然可以在需要提交时解开它们——几乎总是很容易。[存储](http://git-scm.com/docs/git-stash)在这里可以提供很大的帮助。

我发现，与使用 git 之前相比，这些事实使我自然而然地做出了更多、更专注的提交。这反过来不仅使您的历史记录通常更有用，而且对增值工具（例如[`git bisect`](http://www.kernel.org/pub/software/scm/git/docs/git-bisect.html).

我敢肯定还有更多我现在想不起来的事情。在 git 上出售你的团队的提议的一个问题是，许多好处是相互关联的，并且相互影响，正如我在上面所暗示的那样，因此很难简单地查看 git 的特性和好处列表并推断它们是如何产生的将改变您的工作流程，哪些改变将是真正的改进。您需要考虑到这一点，并且还需要明确指出。

* * *

## 回答 #3

> 赞同：46
> 
> 时间：2008-10-21T18:19:53.593

从 perforce 转换需要很多说服力。在我使用它的两家公司中，它绰绰有余。这两家公司都有不同的办公室，但办公室的基础设施充足，因此不需要有不相交/不连贯的功能。

你说有多少开发人员要换人？

真正的问题是 - 什么是 perforce 不能满足 git 可以提供的组织需求？同样，git 与 perforce 相比有哪些弱点？如果您自己无法回答，那么在这里询问将无济于事。您需要为您的公司找到一个商业案例。（例如，也许它具有较低的总体拥有成本（包括临时学习阶段的生产力损失、较高的管理成本（至少在最初阶段）等）

我认为您将面临艰难的销售 - perforce 是一个非常好的尝试替代。如果您尝试启动 pvcs 或 ssafe，这很容易。

* * *

## 回答 #4

> 赞同：15
> 
> 时间：2008-10-22T13:28:50.700

我认为，在让人们在切换期间/切换后保持快乐方面，要尽早了解的一件事是本地分支在 Git 中的私密性，以及让他们犯错的自由度有多大。让他们都从当前代码中克隆一些私有分支，然后在那里疯狂地进行试验。重命名一些文件，签入，合并另一个分支的东西，倒回历史，将一组更改重新设置在另一组之上，等等。展示即使他们在当地发生的最严重的事故也不会对他们的同事造成任何后果。您想要的是开发人员感到安全的情况，因此他们可以更快地学习（因为 Git 具有陡峭的学习曲线，这一点很重要），然后最终使他们作为开发人员更有效。

当您尝试学习一个集中式工具时，显然您会担心做出一些错误，从而给存储库的其他用户带来问题。仅仅对尴尬的恐惧就足以阻止人们进行实验。即使拥有一个特殊的“培训”存储库也无济于事，因为开发人员不可避免地会在生产系统中遇到他们在培训期间从未见过的情况，因此他们又开始担心了。

但是 Git 的分布式特性消除了这一点。您可以在本地分支中尝试任何实验，如果出现严重错误，只需将分支扔掉，没人需要知道。由于您可以创建任何东西的本地分支，因此您可以使用真实的实时存储库复制您看到的问题，但不会有“破坏构建”或以其他方式自欺欺人的危险。您可以在完成后立即检查所有内容，无需尝试将工作批量整理成整洁的小包裹。因此，不仅是您今天花了四个小时进行的两个主要代码更改，还有您在中途记得的构建修复，以及您在向同事解释某些内容时发现的文档中的拼写错误，等等。如果因为项目正在改变方向而放弃了重大变更，

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2008-10-21T17:52:33.897

个人在 git 上卖给我的命令是[bisect](http://www.kernel.org/pub/software/scm/git/docs/git-bisect.html)。到目前为止，我认为此功能在任何其他版本控制系统中都不可用。

话虽如此，如果人们习惯于使用 GUI 客户端进行源代码控制，他们不会对 git 印象深刻。现在唯一的全功能客户端是命令行。

* * *

## 回答 #6

> 赞同：9
> 
> 时间：2008-10-21T18:56:02.240

人们正在使用哪些 Perforce 功能？

*   单台机器上的多个工作区
*   编号的更改列表
*   开发者分支
*   与 IDE 集成（Visual Studio、Eclipse、SlickEdit、...）
*   许多构建变体
*   复合工作区
*   集成一些修复但不集成其他修复
*   ETC

我问是因为如果所有人都在做的是从命令行获取和放置，git 已经涵盖了这一点，所有其他 RTS 也是如此。

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2008-10-23T21:49:44.963

显然[GitHub 现在为公司提供 git 培训课程](http://github.com/training)。Quoth[他们关于它的博客文章](http://github.com/blog/186-google-android-git-and-github)：

> 在过去的几周里，我多次到谷歌校园帮助训练那里的机器人使用 Git。Shawn Pearce（你可能从他的 Git 和 EGit/JGit 荣耀中认识他——当 Junio 不在城里时，他是接管维护的英雄）邀请我来帮助他培训在 Andriod 上工作的 Google 工程师进行**过渡从 Perforce 到 Git**，因此 Android 可以与大众共享。我可以告诉你，我很乐意这样做。
> 
> […]
> 
> Logical Awesome 现在[正式](http://github.com/training)向所有公司提供这种类型的定制培训服务，如果您也在考虑切换到 Git，我们可以帮助您的组织进行培训和规划。

强调我的。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2011-02-15T23:37:29.093

我已经使用 Perforce 很长时间了，最​​近我也开始使用 GIT。这是我的“客观”意见：

强制功能：

1.  GUI 工具似乎功能更丰富（例如延时视图、修订图）
2.  同步到头部修订时的速度（没有传输整个历史的开销）
3.  Eclipse/Visual Studio 集成真的很棒
4.  您可以在每个 Changelist 的一个分支中开发多个功能（我仍然不能 100% 确定这是否比 GIT 更有优势）
5.  您可以“窥探”其他开发人员正在做什么——他们签出了什么样的文件。

吉特特点：

1.  我的印象是 GIT 命令行比 Perforce 简单得多（初始化/克隆、添加、提交。没有复杂工作区的配置）
2.  结帐后访问项目历史记录的速度（以同步时复制整个历史记录为代价）
3.  离线模式（开发者不会抱怨无法访问的 P4 服务器会禁止他们编码）
4.  创建新分支要快得多
5.  “主”GIT 服务器不需要大量 TBytes 的存储空间，因为每个开发人员都可以拥有自己的本地沙箱
6.  GIT 是开源的 - 没有许可费
7.  如果您的公司也为开源项目做出贡献，那么使用 GIT 共享补丁要容易得多

总的来说，对于开源/分布式项目，我总是推荐 GIT，因为它更像是一个 P2P 应用程序，每个人都可以参与开发。例如，我记得当我使用 Perforce 进行远程开发时，我每周一次通过 1Mbps 链接同步 4GB 项目。很多时间都因此被浪费了。我们还需要设置 VPN 来做到这一点。

如果您有一家小公司并且 P4 服务器将始终处于运行状态，那么我会说 Perforce 也是一个非常好的选择。

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2011-12-30T04:22:09.217

我们使用 Git 已经有一段时间了，最​​近我们的 Git 服务器的硬盘崩溃了，我们无法恢复到最新状态。我们设法回到了几天前的状态。当服务器备份时。团队中的每个人都拉/推了他们的更改，瞧，服务器回到了当前状态。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2012-04-03T03:39:11.587

Perforce 和 git（也是最常提到的）之间的一个重要区别是它们各自处理巨大的二进制文件。

例如，在视频游戏开发公司的一名员工的博客中：http: [//corearchitecture.blogspot.com/2011/09/git-vs-perforce-from-game-development.html](http://corearchitecture.blogspot.com/2011/09/git-vs-perforce-from-game-development.html)

然而，重要的是，当你有一个巨大的 6gb 存储库时，git 和 perforce 之间的速度差异，包含从文档到曾经构建的每个二进制文件的所有内容（最后，哦，是的！实际的源历史记录），通常来自事实上，大公司倾向于运行 Perforce，因此他们将其设置为将所有重要操作卸载到地下室的巨大服务器库。

Perforce 的这一重要优势仅来自与 Perforce 无关的一个因素，即运行它的公司可以负担上述服务器银行的费用。

而且，无论如何，归根结底，Perforce 和 git 是不同的产品。Git 被设计成一个单独的 VCS，它比 Perforce 做得好得多（因为它有更多的功能，通常更容易使用，特别是用另一个人的话来说，在 Perforce 中分支就像执行开放的心手术，只能由专家进行：P）（[http://stevehanov.ca/blog/index.php?id=50](http://stevehanov.ca/blog/index.php?id=50)）

使用 Perforce 的公司获得的任何其他好处仅仅是因为 Perforce 不仅仅是一个 VCS，它还是一个文件服务器，以及具有许多其他功能来测试构建的性能等。

最后：Git 是开源的并且启动起来更加灵活，修补 git 以将重要操作卸载到中央服务器并运行大量昂贵的硬件并不难。

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2012-04-13T09:24:55.873

我认为我知道 GIT 获胜的一件事是它能够在所有文件上“保留行尾”，而 perforce 似乎坚持将它们转换为 Unix、Dos/Windows 或 MacOS9 格式（“\n”、“\ r\n" 或 "\r)。

如果您在 Windows 环境或混合操作系统环境中编写 Unix 脚本，这真的很痛苦。甚至不可能在每个文件扩展名的基础上设置规则。例如，它将 .sh、.bash、.unix 文件转换为 Unix 格式，并将 .ccp、.bat 或 .com 文件转换为 Dos/Windows 格式。

在 GIT 中（我不确定这是默认选项还是唯一选项），您可以将其设置为“保留行尾”。这意味着，您可以手动更改文件的行尾，然后 GIT 将保持该格式不变。在我看来，这似乎是做事的理想方式，我不明白为什么这不是 Perforce 的选项。

实现此行为的唯一方法是将文件标记为二进制文件。正如我所看到的，这将是一个令人讨厌的破解来解决缺少的功能。除了必须对所有脚本等进行繁琐之外，它还可能会破坏大多数差异等。

我们目前确定的“解决方案”是运行 sed 命令，以在每次将脚本部署到 Unix 环境时从脚本中删除所有回车符。这也不理想，特别是因为其中一些部署在 WAR 文件中，并且在解压缩时必须再次运行 sed 行。

这只是我认为给 GIT 一个很大的优势，我认为上面没有提到过。

编辑：在使用 Perforce 一段时间后，我想添加另外几条评论：

A) 我在 Perforce 中真正想念的是一个清晰的实例差异，包括更改、删除和添加的文件。这在 GIT 中可以通过`git diff`命令使用，但在 Perforce 中，必须在记录更改之前签出文件，虽然您可能将主编辑器（如 Eclipse）设置为在编辑文件时自动签出文件，但您有时可能会以其他方式（记事本、unix 命令等）编辑文件。而且新文件似乎根本不会自动添加，即使使用 Eclipse 和 p4eclipse，这可能会很烦人。因此，要查找所有更改，您必须在整个工作区上运行“Diff against...”，首先需要一段时间才能运行，其次包括所有不相关的东西，除非您设置了非常复杂的排除列表，这将我引向下一点。

B) 在 GIT 中，我发现 .gitignore 非常简单且易于管理、阅读和理解。然而，在 Perforce 中可配置的工作区忽略/排除列表看起来笨重且不必要地复杂。我无法通过通配符获得任何排除。我想做类似的事情

```
-//Server/mainline/.../target/...   //Svend_Hansen_Server/.../target/... 
```

排除服务器/主线内所有项目中的所有目标文件夹。但是，这似乎不像我预期的那样工作，我最终为每个项目添加了一行，例如：

```
-//Server/mainline/projectA/target/...  //Svend_Hansen_Server/projectA/target/...
-//Server/mainline/projectB/target/...  //Svend_Hansen_Server/projectB/target/...
... 
```

以及 bin 文件夹、.classpath 和 .projet 文件等的类似行。

C) 在 Perforce 中有相当有用的变更列表。但是，假设我进行了一组更改，将它们全部检查并放入更改列表中，然后在提交该更改列表之前处理其他事情。如果我稍后对第一个更改列表中包含的一个文件进行更改，该文件仍将在该更改列表中，并且我不能稍后提交更改列表，假设它仅包含我最初添加的更改（尽管它将是相同的文件）。在 GIT 中，如果您添加一个文件并且他们对其进行了进一步的更改，这些更改将不会被添加（并且仍会显示在`git diff`如果不先添加新更改，您将无法提交文件。当然，这不像更改列表那样有用，因为您只有一组添加的文件，但是在 GIT 中，您可以只提交更改，因为这实际上并没有推送它们。您可以在推送它们之前让他们处理其他更改，但是如果不推送之前的更改，您将无法推送您稍后添加的任何其他内容。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2008-10-21T17:57:30.270

我没有使用 Git 的经验，但我使用过 Mercurial，它也是一个分布式 VCS。这实际上取决于项目，但在我们的案例中，分布式 VCS 适合该项目，因为它基本上消除了频繁的损坏构建。

我认为这真的取决于项目，因为有些更适合客户端-服务器 VCS，而另一些则更适合分布式 VCS。

* * *

## 回答 #13

> 赞同：-5
> 
> 时间：2012-06-21T03:30:46.160

以下是我不喜欢 git 的地方：

首先，我认为分布式的想法与现实背道而驰。每个实际使用 git 的人都以集中的方式这样做，即使是 Linus Torvalds。如果内核是以分布式方式管理的，那意味着我实际上无法下载“官方”内核源——不会有——我必须决定我想要的是 Linus 的版本，还是 Joe 的版本，或比尔的版本。这显然是荒谬的，这就是为什么有一个官方定义，Linus 使用集中式工作流来控制。

如果你接受你想要一个集中定义你的东西，那么很明显服务器和客户端角色是完全不同的，所以客户端和服务器软件应该相同的教条变得纯粹是限制性的。客户端和服务器*数据*应该相同的教条显然变得荒谬，尤其是在一个有 15 年历史的代码库中，没有人关心，但每个人都必须克隆。

我们实际上想要对所有这些旧东西做的就是把它塞进柜子里，然后忘记它就在那里，就像任何普通的 VCS 一样。git 每天都在网络上来回拖拽它的事实是非常危险的，因为它会唠叨你要修剪它。这种修剪涉及许多繁琐的决定，而且可能会出错。因此，人们可能会从历史的各个点保留一系列快照存储库，但这不正是源代码控制的初衷吗？直到有人发明了分布式模型，这个问题才存在。

Git 积极鼓励人们改写历史，以上可能是其中一个原因。每个普通的 VCS 都使得除了管理员之外的所有人都无法重写历史，并确保管理员没有理由考虑它。如果我错了，请纠正我，但据我所知，git 无法授予普通用户写入权限，而是禁止他们重写历史记录。这意味着任何怀恨在心的开发人员（或仍在为学习曲线苦苦挣扎的开发人员）都可能破坏整个代码库。我们如何收紧那个？好吧，要么您定期备份整个历史记录，即保持历史记录平方，要么禁止对除一些可怜的草皮之外的所有人进行写访问，他们会通过电子邮件接收所有差异并手动合并它们。

让我们举一个资金充足的大型项目的例子，看看 git 是如何为他们工作的：Android。我曾经决定玩一下android系统本身。我发现我应该使用一堆名为 repo 的脚本来获取他们的 git。一些 repo 在客户端上运行，一些在服务器上运行，但两者，就其存在而言，都说明了 git 在任何一种能力上都不完整的事实。发生的事情是，我无法在大约一周内提取资源，然后完全放弃。我不得不从几个不同的存储库中提取大量数据，但是服务器完全被像我这样的人超载了。回购超时，无法从超时的地方恢复。如果 git 如此可分发，你会认为他们 d 已经做了某种点对点的事情来减轻那台服务器上的负载。Git 是可分发的，但它不是服务器。Git+repo 是一个服务器，但 repo 不是可分发的，因为它只是一个临时的 hack 集合。

git 不足的一个类似例子是 gitolite（它的祖先显然没有很好地工作。） Gitolite 将其工作描述为简化 git 服务器的部署。再一次，这个东西的存在证明了 git 不是一个服务器，就像它是一个客户端一样。更重要的是，它永远不会，因为如果它成长为任何一个，它就会背叛它的创始原则。

即使你确实相信分布式的​​东西，git 仍然是一团糟。例如，什么是分支？他们说每次克隆存储库时都会隐式创建一个分支，但这与单个存储库中的分支不同。所以至少有两种不同的东西被称为分支。但是，您也可以在 repo 中倒带并开始编辑。这就像第二种类型的分支，还是又有所不同？也许这取决于您拥有哪种类型的回购 - 哦，是的 - 显然回购也不是一个非常明确的概念。有普通的和裸露的。你不能推送到正常的，因为裸露的部分可能与它的源树不同步。但是你不能 cvsimport 到一个光秃秃的，因为他们没有想到这一点。所以你必须 cvsimport 到一个正常的，将其克隆到开发人员点击的裸机，然后将其 cvsexport 到仍然必须签入 cvs 的 cvs 工作副本。谁能打扰？所有这些并发症从何而来？从分布式思想本身。我最终放弃了 gitolite，因为它对我施加了更多的这些限制。

Git 说分支应该是轻量级的，但许多公司已经存在严重的流氓分支问题，所以我认为分支应该是一个具有严格监管的重大决定。这就是 perforce 真正闪耀的地方...

实际上，您很少需要分支，因为您可以以非常敏捷的方式处理变更集。例如，通常的工作流程是您同步到主线上最后一个已知的好版本，然后编写您的功能。每当您尝试修改文件时，该文件的差异都会添加到您的“默认变更集”中。当您尝试签入变更集时，它会自动尝试将来自主线的新闻合并到您的变更集中（有效地对其进行变基），然后提交。这个工作流程是强制执行的，您甚至不需要了解它。因此，Mainline 收集了更改的历史记录，您以后可以很容易地挑选出自己的方式。例如，假设您想恢复一个旧的，例如，前一个之前的那个。您同步到有问题的更改之前的那一刻，将受影响的文件标记为更改集的一部分，同步到下一刻并与“永远属于我”合并。（那里有一些非常有趣的东西：同步并不意味着拥有相同的东西 - 如果一个文件是可编辑的（即在一个活动的变更集中），它不会被同步破坏，而是标记为要解决。）现在你有了撤消有问题的更改列表。合并后续新闻，您将拥有一个更改列表，您可以将其放在主线顶部以获得所需的效果。我们从未改写任何历史。合并后续新闻，您将拥有一个更改列表，您可以将其放在主线顶部以获得所需的效果。我们从未改写任何历史。合并后续新闻，您将拥有一个更改列表，您可以将其放在主线顶部以获得所需的效果。我们从未改写任何历史。

现在，假设这个过程进行到一半，有人跑到你面前告诉你放弃所有东西并修复一些错误。你只需给你的默认变更列表一个名称（实际上是一个数字）然后“暂停”它，修复现在空的默认变更列表中的错误，提交它，然后恢复命名的变更列表。在您尝试不同的事情时，通常会暂停多个更改列表。它既简单又私密。您可以从分支政权中获得您真正想要的东西，而不会拖延或逃避合并到主线的诱惑。

我想理论上可以在 git 中做类似的事情，但 git 实际上使任何事情成为可能，而不是断言我们认可的工作流程。相对于分布式模型，集中式模型是一堆有效的简化，这是无效的概括。它过于笼统，以至于它基本上希望您在它之上实现源代码控制，就像 repo 一样。

另一件事是复制。在 git 中，一切皆有可能，因此您必须自己弄清楚。在 perforce 中，您将获得一个有效的无状态缓存。它需要知道的唯一配置是主服务器在哪里，客户端可以自行决定指向主服务器或缓存。这是一个五分钟的工作，它不会出错。

您还拥有用于断言代码审查、bugzilla 引用等的触发器和可自定义的表单，当然，您还有实际需要时的分支。这不是clearcase，但它很接近，而且很容易设置和维护。

总而言之，我认为如果你知道你将以集中的方式工作，每个人都这样做，你不妨使用一个为此设计的工具。Git 被高估了，因为 Linus 可怕的机智以及人们像羊一样互相追随的倾向，但它的主要存在理由实际上并不符合常识，并且通过追随它，git 将自己的双手与(a) 软件和 (b) 数据在客户端和服务器端都必须相同这两个巨大的教条，这总是会使集中式工作变得复杂和蹩脚。

* * *

## 回答 #14

> 赞同：-8
> 
> 时间：2011-04-07T22:44:12.347

使用 GIT 代替糟糕的代码行管理是很常见的。Perforce 的许多缺点都是由于糟糕的分支策略造成的。任何其他集中式工具也是如此。如果您必须创建大量分支，那么您做错了。为什么开发人员需要创建这么多分支？

另外，为什么断开连接工作如此重要？就为了有人可以在火车上工作？这是近来唯一无法获得无线连接的地方。甚至大多数火车都有不错的 WiFi。

# c# - 在 asp.net 中获取应用程序根目录的绝对 uri 的最快方法是什么？

> ID：222783
> 
> 赞同：6
> 
> 时间：2008-10-21T17:49:17.057
> 
> 标签：c#, asp.net

最简单的获取方法是什么：`http://www.[Domain].com`在asp.net中？

似乎没有一种方法可以做到这一点，我知道的唯一方法是在服务器变量或 Request.Url 上做一些字符串杂技。任何人？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2011-12-26T15:46:40.430

我们可以使用 Uri 和他的 baseUri 构造函数：

*   `new Uri(this.Request.Url, "/")`对于网站的根
*   `new Uri(this.Request.Url, this.Request.ResolveUrl("~/"))`对于网站的根

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-21T18:03:16.060

你可以使用这样的东西。

```
System.Web.HttpContext.Current.Server.ResolveUrl("~/") 
```

它映射到应用程序的根目录。现在，如果您在虚拟目录中，则需要做更多的工作。

**编辑**

旧帖子包含不正确的方法调用！

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-21T18:18:54.110

你可以这样做：

```
string.Format("{0}://{1}:{2}", Request.Url.Scheme, Request.Url.Host, Request.Url.Port) 
```

您将获得[通用 URI 语法](http://www.faqs.org/rfcs/rfc2396.html) <protocol>://<host>:<port>

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-21T18:53:14.977

我真的很喜欢 CMS 处理这个问题的最佳方式，它使用 String.Format 和 Page.Request 变量。我只是想稍微调整一下。我刚刚在我的一个页面上对其进行了测试，所以，我将在这里复制代码：

```
String baseURL = string.Format(
   (Request.Url.Port != 80) ? "{0}://{1}:{2}" : "{0}://{1}", 
    Request.Url.Scheme, 
    Request.Url.Host, 
    Request.Url.Port) 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-21T17:57:51.017

```
System.Web.UI.Page.Request.Url 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-21T18:00:16.800

```
this.Request.Url.Host 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2013-05-23T09:35:09.823

我在 Page 上使用此属性来处理案例虚拟目录和默认端口：

```
string FullApplicationPath {
    get {
        StringBuilder sb = new StringBuilder();
        sb.AppendFormat("{0}://{1}", Request.Url.Scheme, Request.Url.Host);

        if (!Request.Url.IsDefaultPort)
            sb.AppendFormat(":{0}", Request.Url.Port);

        if (!string.Equals("/", Request.ApplicationPath))
            sb.Append(Request.ApplicationPath);

        return sb.ToString();
    }
} 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-21T22:23:38.797

此方法处理 http/https、端口号和查询字符串。

```
'Returns current page URL 
Function fullurl() As String
    Dim strProtocol, strHost, strPort, strurl, strQueryString As String
    strProtocol = Request.ServerVariables("HTTPS")
    strPort = Request.ServerVariables("SERVER_PORT")
    strHost = Request.ServerVariables("SERVER_NAME")
    strurl = Request.ServerVariables("url")
    strQueryString = Request.ServerVariables("QUERY_STRING")

    If strProtocol = "off" Then
        strProtocol = "http://"
    Else
        strProtocol = "https://"
    End If

    If strPort <> "80" Then
        strPort = ":" & strPort
    Else
        strPort = ""
    End If

    If strQueryString.Length > 0 Then
        strQueryString = "?" & strQueryString
    End If

    Return strProtocol & strHost & strPort & strurl & strQueryString
End Function 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-07-15T21:09:47.740

我不得不处理类似的事情，我需要一种以编程方式将标签设置为指向我的网站根目录的方法。

由于本地主机和虚拟目录的东西，接受的解决方案对我不起作用。

所以我想出了以下解决方案，它可以在有或没有虚拟目录的 localhost 上工作，当然也可以在 IIS 网站下工作。

```
string.Format("{0}://{1}:{2}{3}", Request.Url.Scheme, Request.Url.Host, Request.Url.Port, ResolveUrl("~") 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2010-02-25T23:34:13.143

结合迄今为止我在这个问题上看到的最好的，这个负责：

1.  http 和 https
2.  标准端口（80、443）和非标准
3.  应用程序托管在根目录的子文件夹中

    ```
    string url = String.Format(
        Request.Url.IsDefaultPort ? "{0}://{1}{3}" : "{0}://{1}:{2}{3}",
        Request.Url.Scheme, Request.Url.Host,
        Request.Url.Port, ResolveUrl("~/")); 
    ```

# asp.net - 类将为测试/控制台编译，但不会在 Asp.net 应用程序中编译

> ID：222790
> 
> 赞同：2
> 
> 时间：2008-10-21T17:52:10.140
> 
> 标签：asp.net, compiler-construction

我有一个简单的界面：

```
public interface IVisitorsLogController  
{
    List<VisitorsLog> GetVisitorsLog();
    int GetUniqueSubscribersCount();
    int GetVisitorsCount();
    string GetVisitorsSummary();
} 
```

VisitorLogController 类实现了这个接口。

从控制台应用程序或 TestFixture - 没问题 - 控制台/测试夹具完美编译。

但是，来自同一解决方案中的 Asp.Net 网站（不是应用程序），后面的代码中有此代码

```
private IVisitorsLogController ctl;

protected int GetUniqueMembersCount()
{
    ctl = new VisitorsLogController();
    return ctl.GetUniqueSubscribersCount();        
} 
```

编译器抛出此异常：

> 错误 1“WebSiteBusinessRules.Interfaces.IVisitorsLogController”不包含“GetUniqueSubscribersCount”的定义，并且没有扩展方法“GetUniqueSubscribersCount”接受类型为“WebSiteBusinessRules.Interfaces.IVisitorsLogController”的第一个参数（您是否缺少 using 指令或装配参考？）

但是对于同一文件中的此代码：

```
 protected static int GetVisitorsCount()
{
    return VisitorsLogController.Instance.GetVisitorsCount(DateTime.Today);
} 
```

编译器编译这些行而不抱怨。事实上，如果我在接口中添加任何新内容，编译器现在会在尝试编译 asp.net 页面时抱怨。

不能缺少 using 指令或程序集引用，否则这两种方法都会失败。

这让我发疯！

请问有什么想法吗？

谢谢，

杰里米

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-21T18:15:31.527

出于兴趣，您可以编译以下行：

```
ctl = VisitorsLogController.Instance; 
```

? 我只是想知道您是否以某种方式获得了两个名称相同的接口。

当您键入`ctl.`并按`Ctrl`-时，Intellisense 会提示您什么`Space`？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-21T17:58:40.157

我将首先检查所涉及的每个文件的名称空间，并确保您没有冲突或您不期望的名称空间。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-21T18:42:24.407

另一个重要的代码似乎是访客日志控制器，不是吗？看起来访客日志控制器正在实现一个*不同*的IVictorsLogController 接口。

我认为，右键单击和 GoTo Definition 应该可以解决问题。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-21T21:03:30.907

该解决方案包含网站和三个类项目（数据层、服务层和核心服务）。它们作为项目作为对网站的引用添加。我曾经为发布编译过解决方案 - 发布了站点，然后将配置更改为调试。

显然发生的事情是网站的 /bin 文件中的 Release dll 没有被新的 Debug dll 覆盖。我手动删除了 /bin 目录中的所有文件，你瞧——一切都编译得很完美。

所以马克和约翰——你们都在现场——我实际上确实有两个命名相同的接口。

非常感谢您的帮助 - 如果您没有给我这些指示，我永远不会最终解决它。

# database - 审计撤销操作

> ID：222792
> 
> 赞同：0
> 
> 时间：2008-10-21T17:52:41.167
> 
> 标签：database, oracle

Oracle 中如何**`REVOKE`**审计对表的操作？赠款可以审计...

```
AUDIT GRANT ON *schema.table*; 
```

对系统权限和卷的授予和撤销都可以通过...进行审计

```
AUDIT SYSTEM GRANT; 
```

这些语句都不会审计对象级别的撤销。我的数据库是10g。我对审核由 SYS 完成的撤销很感兴趣，但这不是我主要关心的问题，因此答案不需要对 SYS 用户起作用。

*触发器可以捕获这些，但我更喜欢使用内置审计，所以如果触发器是执行此操作的唯一方法，那么请投票赞成“这无法完成”的答案。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-30T15:42:31.933

根据 Oracle 支持，所有撤销都可以通过执行以下操作进行审计：

1.  将参数设置`audit_sys_operations`为`true`。

2.  将参数设置`audit_trail`为`db_extended`。

3.  运行审计授权表；

这包括对表视图和物化视图的 GRANT 和 REVOKE 权限。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-21T17:54:24.783

这是做不到的。

# mysql - INSERT 触发器后我的 MySQL 不起作用？为什么？

> ID：222806
> 
> 赞同：0
> 
> 时间：2008-10-21T17:56:26.620
> 
> 标签：mysql, database, triggers

我创建了一个类似于以下内容的触发器：

```
delimiter //
CREATE TRIGGER update_total_seconds_on_phone AFTER INSERT
ON cdr 
FOR EACH ROW 
BEGIN
IF NEW.billsec > 0 AND NEW.userfield <> NULL THEN
UPDATE foo
SET total_seconds = total_seconds + NEW.billsec
WHERE phone_id = NEW.userfield;
END IF;

END;// 
```

好像顺利通过了。但是，当我需要它时，它似乎并没有被调用。这是一个例子：

```
mysql> select total_seconds from foo where phone_id = 1;
+---------------+
| total_seconds |
+---------------+
|             0 | 
+---------------+
1 row in set (0.00 sec) 
```

mysql> 插入 cdr (billsec, userfield) VALUES(60, 1); 查询正常，1 行受影响，12 个警告（0.00 秒）

```
mysql> select total_seconds from foo where phone_id = 1;
+---------------+
| total_seconds |
+---------------+
|             0 | 
+---------------+ 
```

编辑：这种特殊情况下的警告不会影响触发器。导致警告的主要是 cdr 表中没有默认值的附加列。为了简单起见，我将我的 INSERT 语句保持简短。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-21T18:01:28.280

生成了 12 个警告。这些是什么？

ETA：哦，等等……你需要使用`is not null`而不是`<> null`. 任何与 的比较`null`总是会返回`null`。

# c# - 使用linq to xml用单引号保存xml元素的属性值

> ID：222819
> 
> 赞同：3
> 
> 时间：2008-10-21T17:59:27.770
> 
> 标签：c#, xml, .net-3.5, linq-to-xml

如何使 XDocument 对象用单引号保存元素的属性值？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-21T18:08:16.923

我不确定 LINQ to XML 的任何格式选项是否允许您指定。为什么需要？这是一种非常糟糕的 XML 处理程序，它会关心它......

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-21T18:53:53.900

只要您在匹配对中使用单引号和双引号并且嵌套正确，符合标准的 XML 处理器就不会关心您使用哪种样式。您的问题表明您打算使用不符合标准（甚至可能不支持 XML）的工具来处理您的 XML 输出。这充其量是一个冒险的提议，尽管我认识到工作环境和客户需求可能并不总是让您选择使用正确的工具。我有同事使用 sed 和 grep 来筛选和修改 XML 文件，他们通常可以侥幸逃脱。但是，如果您有任何选择，我建议您在整个管道中使用 XML 感知工具处理 XML 文件，直到数据不再以 XML 标记为止。

如果你不能这样做，那么 JacobE 的建议可能是你最好的选择。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-21T18:13:08.863

如果绝对需要使用单引号，您可以将 XML 文档写入字符串，然后使用字符串替换将单引号更改为双引号。

# html - 如何保留编号列表的缩进？

> ID：222825
> 
> 赞同：2
> 
> 时间：2008-10-21T18:00:59.513
> 
> 标签：html, css

你如何保留编号列表的缩进？我有一个页面，其中数字被推离页面。我怎样才能防止这种情况？

```
<ol style="padding: 0">
    <li>Item 1</li>
    <li>Item 2</li>
    <li>Item 3</li>
</ol> 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-21T18:24:54.410

使用这样的 CSS 规则：

```
ol { margin-left: 30px; } 
```

这里有一些关于[CSS 盒子模型](http://redmelon.net/tstme/box_model/)的信息。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-21T19:15:28.130

如何使用：

```
li { list-style-position: outside; } 
```

# silverlight - silverlight keydown 事件不会为箭头键触发

> ID：222826
> 
> 赞同：4
> 
> 时间：2008-10-21T18:01:02.710
> 
> 标签：silverlight, key, keydown

我在滚动视图中有一个画布。我将 keydown 事件处理程序附加到滚动视图。对于大多数键，处理程序被调用。

但是，对于箭头键，处理程序不会被调用。相反，滚动视图会在适当的方向上滚动。

我还在滚动视图上附加了一个 keyup 处理程序，并且确实为箭头键调用了 keyup。

有什么方法可以在这里获取箭头键向下事件吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-12-04T16:32:08.880

只需使用 KeyUp 事件。奇迹般有效。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-21T20:14:44.017

我发现这个愚蠢的黑客让它工作。将滚动视图设置为不是制表符可以防止它吃掉关键事件。但后来我在页面上有另一个文本框突然总是有焦点，因为滚动视图不再存在。所以我通过让一个不可见的文本框获得焦点来解决这个问题。

```
scrollView.IsTabStop = false;

invisibleTextBox.Foreground = new SolidColorBrush(Colors.Transparent);
invisibleTextBox.Background = new SolidColorBrush(Colors.Transparent);
Canvas.SetZIndex(invisibleTextBox, -1000);
invisibleTextBox.KeyDown += new KeyEventHandler(HandleKeyDown);
invisibleTextBox.KeyUp += new KeyEventHandler(HandleKeyUp); 
```

编辑：我还不得不将文本框从画布上移开，因为尽管它是不可见的，但它的轮廓仍然出现。

**第二次编辑：**我使用了一个文本框，因为这是我发现的第一个可以捕获 KeyDown 事件的东西。但是，UserControl 可以。因此，使用 UserControl 而不是不可见的文本框可能是更好的做法。如果需要，您可以在 UserControl 上调用 Focus()。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-27T01:05:35.903

这是一个可能的答案-我没有机会对此进行测试。不过，我过去也遇到过类似的麻烦，当一个控件在你处理它们之前就已经消耗了这些事件。您可以尝试以下几件事：

1.  使用 PreviewKeyDown 事件，我认为这就是它的名称。它可以让您在事件被控件消耗之前得到它。
2.  试试 mblandfo 的建议，尽管如果你这样做，你可能会想把整个事情包装在一个用户控件中，以从你的代码的其余部分隐藏你正在做的事情。
3.  向 Canvas 对象添加一个键处理程序，您可以在那里捕获事件，并通过您自己的事件“冒泡”它。

除了 1) 所有这些都算作 hack，真的，但是祝你好运，我希望其中一个对你有用！

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-12-31T16:52:52.290

“使用 PreviewKeyDown 事件，我想这就是它的名称。它可以让您在事件被控件消耗之前得到它。”

这行得通。只需设置事件参数“Handled = true”，ScrollViewer（或 ListBox）在您处理完事件后就不会抓住它。不过，我不需要为 ListBox 使用 IsTabStop 属性；无论如何，它似乎没有做任何事情。

# svn - 您如何组织版本控制存储库？

> ID：222827
> 
> 赞同：108
> 
> 时间：2008-10-21T18:01:09.637
> 
> 标签：svn, version-control, repository, projects-and-solutions

首先，我知道这一点：[您将如何为内部软件项目组织 Subversion 存储库？](https://stackoverflow.com/questions/51217/how-would-you-organize-a-subversion-repository-for-in-house-software-projects) 接下来是实际问题：我的团队正在重组我们的存储库，我正在寻找有关如何组织它的提示。（在这种情况下为 SVN）。这就是我们想出的。我们有一个存储库、多个项目和多个 svn:externals 交叉引用

```
\commonTools /*tools used in all projects. Referenced in each project with svn:externals*/
   \NUnit.v2.4.8
   \NCover.v.1.5.8
   \<other similar tools>
\commonFiles /*settings strong name keys etc.*/
   \ReSharper.settings
   \VisualStudio.settings
\trash /*each member of the team has trash for samples, experiments etc*/
   \user1
   \user2
\projects
   \Solution1 /*Single actual project (Visual Studio Solution)*/
      \trunk
         \src
             \Project1 /*Each sub-project resulting in single .dll or .exe*/
             \Project2
         \lib
         \tools
         \tests
         \Solution1.sln
      \tags
      \branches
   \Solution2
      \trunk
         \src
             \Project3 /*Each sub-project resulting in single .dll or .exe*/
             \Project1 /*Project1 from Solution1 references with svn:externals*/
         \lib
         \tools
         \tests
         \Solution2.sln
      \tags
      \branches 
```

明确词汇：解决方案意味着单个产品，项目是一个 Visual Studio 项目（导致单个 .dll 或单个 .exe）

这就是我们计划布局存储库的方式。主要问题是，我们有多个解决方案，但我们希望在解决方案之间共享项目。我们认为将这些共享项目转移到他们自己的解决方案中没有任何意义，因此我们决定使用 svn:externals 在解决方案之间共享项目。我们还希望将通用工具集和第 3 方库保存在存储库中的一个位置，并在每个解决方案中使用 svn:externals 引用它们。

你觉得这个布局怎么样？尤其是关于 svn:externals 的使用。这不是一个理想的解决方案，但考虑到所有利弊，这是我们能想到的最好的解决方案。你会怎么做？

* * *

## 回答 #1

> 赞同：92
> 
> 时间：2008-11-20T01:02:37.713

如果您遵循以下我的建议（多年来一直如此），您将能够：

-- 将每个项目放在源代码控制中的任何位置，只要您保留项目根目录中的结构即可

-- 在任何机器上的任何地方构建每个项目，以最小的风险和最少的准备

-- 完全独立地构建每个项目，只要您可以访问其二进制依赖项（本地“库”和“输出”目录）

-- 构建和使用任何项目组合，因为它们是独立的

-- 构建和使用单个项目的多个副本/版本，因为它们是独立的

-- 避免将您的源代码控制存储库与生成的文件或库混在一起

我推荐（这里是牛肉）：

1.  定义每个项目以生成单个主要可交付成果，例如 .DLL、.EXE 或 .JAR（Visual Studio 的默认设置）。

2.  将每个项目构建为具有单个根的目录树。

3.  在其根目录中为每个项目创建一个自动构建脚本，该脚本将从头开始构建它，不依赖于 IDE（但如果可行，请不要阻止它在 IDE 中构建）。

4.  考虑 nAnt 用于 Windows 上的 .NET 项目，或基于您的操作系统、目标平台等的类似项目。

5.  让每个项目构建脚本从单个本地共享“库”目录引用其外部（第 3 方）依赖项，每个这样的二进制文件都由 version: `%DirLibraryRoot%\ComponentA-1.2.3.4.dll`,完全标识`%DirLibraryRoot%\ComponentB-5.6.7.8.dll`。

6.  让每个项目构建脚本将主要可交付成果发布到单个本地共享“输出”目录：`%DirOutputRoot%\ProjectA-9.10.11.12.dll`, `%DirOutputRoot%\ProjectB-13.14.15.16.exe`.

7.  让每个项目构建脚本通过“库”和“输出”目录中的可配置和完全版本化的绝对路径（见上文）引用其依赖项，并且没有其他地方。

8.  永远不要让一个项目直接引用另一个项目或其任何内容——只允许引用“输出”目录中的主要可交付成果（见上文）。

9.  通过可配置且完全版本化的绝对路径使每个项目构建脚本引用其所需的构建工具： `%DirToolRoot%\ToolA\1.2.3.4`, `%DirToolRoot%\ToolB\5.6.7.8`.

10.  通过相对于项目根目录的绝对路径使每个项目构建脚本引用源内容： `${project.base.dir}/src`, `${project.base.dir}/tst`（语法因构建工具而异）。

11.  始终需要项目构建脚本通过绝对的、可配置的路径（根植于可配置变量指定的目录）引用每个文件或目录：`${project.base.dir}/some/dirs`或`${env.Variable}/other/dir`.

12.  绝不允许项目构建脚本使用相对路径引用任何内容，例如`.\some\dirs\here`or `..\some\more\dirs`，始终使用绝对路径。

13.  绝不允许项目构建脚本使用没有可配置根目录的绝对路径引用任何内容，例如`C:\some\dirs\here`或`\\server\share\more\stuff\there`.

14.  对于项目构建脚本引用的每个可配置根目录，定义将用于这些引用的环境变量。

15.  尝试尽量减少配置每台机器时必须创建的环境变量的数量。

16.  在每台机器上，创建一个 shell 脚本来定义必要的环境变量，这些环境变量特定于该机器（如果相关，也可能特定于该用户）。

17.  不要将特定于机器的配置 shell 脚本放入源代码控制中；相反，对于每个项目，将项目根目录中的脚本副本作为模板提交。

18.  要求每个项目构建脚本检查其每个环境变量，如果未定义它们，则使用有意义的消息中止。

19.  要求每个项目构建脚本检查其每个依赖的构建工具可执行文件、外部库文件和依赖的项目可交付文件，如果这些文件不存在，则使用有意义的消息中止。

20.  抵制将任何生成的文件提交到源代码控制的诱惑——没有项目可交付成果、没有生成的源代码、没有生成的文档等。

21.  如果您使用 IDE，请生成您可以生成的任何项目控制文件，并且不要将它们提交到源代码控制（这包括 Visual Studio 项目文件）。

22.  建立一个包含所有外部库和工具的官方副本的服务器，以便在开发人员工作站和构建机器上复制/安装。将其与您的源代码控制存储库一起备份。

23.  建立一个没有任何开发工具的持续集成服务器（构建机器）。

24.  考虑一个用于管理外部库和可交付成果的工具，例如 Ivy（与 Ant 一起使用）。

25.  不要使用 Maven——它最初会让你开心，最终会让你哭泣。

请注意，这些都不是特定于 Subversion 的，而且大部分都适用于针对任何操作系统、硬件、平台、语言等的项目。我确实使用了一些操作系统和工具特定的语法，但仅用于说明- -我相信你会翻译成你选择的操作系统或工具。

关于 Visual Studio 解决方案的附加说明：不要将它们置于源代码管理中！使用这种方法，您根本不需要它们，或者您可以生成它们（就像 Visual Studio 项目文件一样）。但是，我发现最好将解决方案文件留给各个开发人员在他们认为合适的情况下创建/使用（但不要签入源代码管理）。我在我的工作站上保留了一个`Rob.sln`文件，我从中引用了我当前的项目。由于我的项目都是独立的，我可以随意添加/删除项目（这意味着没有基于项目的依赖项引用）。

请不要使用 Subversion 外部组件（或其他工具中的类似组件），它们是反模式，因此是不必要的。

当您实施持续集成时，或者甚至当您只想自动化发布过程时，请为其创建一个脚本。制作一个单一的 shell 脚本：获取项目名称（在存储库中列出）和标签名称的参数，在可配置的根目录中创建一个临时目录，检查给定项目名称和标签名称的源代码（通过构造在 Subversion 的情况下适当的 URL）到该临时目录，执行一个干净的构建，运行测试并打包交付物。这个 shell 脚本应该适用于任何项目，并且应该作为“构建工具”项目的一部分检查到源代码管理中。您的持续集成服务器可以使用此脚本作为构建项目的基础，或者它甚至可以提供它（但您仍然可能需要自己的）。

@VonC：您不想在构建脚本中断时一直使用“ant.jar”而不是“ant-abcdjar”，因为您在不知不觉中使用了不兼容的Ant版本运行它。这在 Ant 1.6.5 和 1.7.0 之间尤其常见。概括地说，您总是想知道正在使用的每个组件的特定版本，包括您的平台（Java ABCD）和您的构建工具（Ant EFGH）。否则，您最终会遇到一个错误，您的第一个大问题将是跟踪涉及的各种组件的版本。最好提前解决这个问题。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-21T18:21:30.937

我相信[使用 Subversion 的实用版本控制](http://www.pragprog.com/titles/svn/pragmatic-version-control-using-subversion)具有组织存储库所需的一切。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-21T18:32:22.367

我们已经将我们的设置几乎完全匹配您发布的内容。我们使用一般形式：

```
\Project1
   \Development (for active dev - what you've called "Trunk", containing everything about a project)
   \Branches (For older, still-evolving supported branches of the code)
       \Version1
       \Version1.1
       \Version2
   \Documentation (For any accompanying documents that aren't version-specific 
```

虽然我认为不像你的例子那么完整，但它对我们来说效果很好，让我们把事情分开。我喜欢每个用户都拥有一个“Thrash”文件夹的想法——目前，这些类型的项目最终不会出现在源代码控制中，我一直认为他们应该这样做。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-21T18:57:23.127

为什么将所有内容都放在一个存储库中？为什么不为每个项目建立一个单独的存储库（我的意思是“解决方案”）？

好吧，至少我已经习惯了每个存储库一个项目的方法。您的存储库结构对我来说似乎过于复杂。

您打算将多少项目放入这个大型存储库中？2？3? 10？100？

当你取消一个项目的开发时你会怎么做？只需从存储库树中删除它，以便将来很难找到它。还是让它永远躺在那里？或者当您想将一个项目完全移动到另一台服务器时？

那么所有这些版本号的混乱呢？一个项目的版本号为 2、10、11，而另一个项目的版本号为 1、3、4、5、6、7、8、9、12...

也许我很愚蠢，但我喜欢每个存储库一个项目。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-21T18:33:19.463

我有类似的布局，但我的树干、树枝、标签一直在顶部。所以：/trunk/main、/trunk/utils、/branches/release/等。

当我们想尝试其他版本控制系统时，这最终非常方便，因为许多翻译工具最适合基本的教科书 SVN 布局。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-21T18:55:01.713

我认为提议的结构的主要缺点是共享项目只会使用它们添加到的第一个解决方案进行版本控制（除非 svn:externals 比我想象的更漂亮）。例如，当您为 Solution2 的第一个版本创建分支时，Project1 不会被分支，因为它位于 Solution1 中。如果您稍后需要从该分支构建（QFE 版本），它将使用最新版本的 Project1，而不是分支时的 Project1 版本。

出于这个原因，将共享项目放在一个或多个共享解决方案中（因此是结构中的顶级目录），然后在*任何*解决方案的每个版本中分支它们可能是有利的。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-21T18:58:42.157

要添加到相对路径问题：

我不确定这是一个问题：
只需在名为“Solution1”的目录下检出 Solution1/trunk，Solution2 同上：“目录”的目标实际上代表分支，一旦导入工作区，就*不再可见。*因此，“Solution1”（实际上是“Solution1/trunk”）和“Solution2”（Solution2/trunk）之间可能存在相对路径。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-21T19:11:49.807

RE：相对路径和共享文件问题-

似乎这是特定于 svn 的，但这不是问题。另一个人已经提到了单独的存储库，如果您有不同的项目引用任意其他项目，这可能是我能想到的最佳解决方案。如果您没有共享文件，那么 OP 解决方案（以及许多其他解决方案）将正常工作。

我们仍在解决这个问题，我现在必须解决 3 个不同的工作（不同的客户），因为我接管了设置不存在或糟糕的版本控制。

# bash - 在一组文件中查找文本的更简洁的方法是什么？

> ID：222833
> 
> 赞同：2
> 
> 时间：2008-10-21T18:02:20.057
> 
> 标签：bash, unix, shell

我目前使用以下命令，但输入起来有点笨拙。什么是更短的替代方案？

```
find . -name '*.txt' -exec grep 'sometext' '{}' \; -print 
```

以下是我的要求：

*   限制为文件扩展名（我使用 SVN，不想搜索所有这些 .svn 目录）
*   可以默认为当前目录，但是能指定不同的目录就好了
*   必须是递归的

**更新：**这是我迄今为止最好的解决方案：

```
grep -r 'sometext' * --include='*.txt' 
```

**更新#2：**使用 grep 一段时间后，我意识到我更喜欢第一种方法的输出。所以，我听从了几个响应者的建议，简单地做了一个 shell 脚本，现在我用两个参数（扩展名和要查找的文本）调用它。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-10-21T18:04:17.073

grep 具有 -r （递归）和 --include （仅在与模式匹配的文件和目录中搜索）。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-21T18:08:30.263

如果它太笨拙，请编写一个脚本来执行它并将其放在您的个人 bin 目录中。我有一个“fif”脚本，它在源文件中搜索文本，基本上只是像你在这里一样进行一次查找：

```
#!/bin/bash

set -f  # disable pathname expansion

pattern="-iname *.[chsyl] -o -iname *.[ch]pp -o -iname *.hh -o -iname *.cc
-o -iname *.java -o -iname *.inl"
prune=""
moreargs=true
while $moreargs && [ $# -gt 0 ]; do
    case $1 in
    -h)
        pattern="-iname *.h -o -iname *.hpp -o -iname *.hh"
        shift
        ;;
    -prune)
        prune="-name $2 -prune -false -o $prune"
        shift
        shift
        ;;
    *)
        moreargs=false;
        ;;
    esac
done

find . $prune $pattern | sed 's/ /\\ /g' | xargs grep "$@" 
```

它最初是一个单行脚本，多年来根据我的需要添加了一些功能。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-21T18:53:23.683

这更有效，因为它调用`grep`的次数更少，尽管很难说它更简洁：

```
find . -name '*.txt' -print0 | xargs -0 grep 'sometext' /dev/null 
```

笔记：

/`find -print0`并使`xargs -0`带有嵌入空格的路径名正常工作。

该`/dev/null`参数确保 grep 始终在文件名前添加。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-21T20:24:36.370

安装[`ack`](http://petdance.com/ack/)和使用

```
ack -aG'\.txt$' 'sometext' 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-10-22T03:29:43.623

我第二次 ehemient 对 ack 的建议。我写这篇文章是为了强调一个特定的问题。

作为对 jgormley 的回应（在评论中）：`ack`可以作为单个文件使用，只要安装了正确的 Perl 版本（无处不在）。

鉴于在非 Linux 平台上`grep`通常不接受，*可以*`-R`说 using`ack`更便携。

 ** * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-10-21T18:35:01.487

我使用 zsh，它具有递归通配符。如果您需要查看特定的文件类型，以下内容等同于您的示例：

```
grep 'sometext' **/*.txt 
```

如果您不关心文件类型，则 -r 选项会更好：

```
grep -r 'sometext' * 
```

虽然，对您的原始示例稍作调整会给您提供您想要的内容：

```
find . -name '*.txt' \! -wholename '*/.svn/*' -exec grep 'sometext' '{}' \; -print 
```

如果这是你经常做的事情，让它成为一个函数（把它放在你的 shell 配置中）：

```
function grep_no_svn {
    find . -name "${2:-*}" \! -wholename '*/.svn/*' -exec grep "$1" '{}' \; -print
} 
```

函数的第一个参数是您要搜索的文本。所以：

```
$ grep_here_no_svn "sometext" 
```

或者：

```
$ grep_here_no_svn "sometext" "*.txt" 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-21T18:09:34.830

您可以编写一个脚本（用 bash 或其他方式——我在 Groovy 中有一个）并将其放在路径上。例如

```
$ myFind.sh txt targetString 
```

其中 myFind.sh 是：

```
find . -name "*.$1" -exec grep $2 {} \; -print 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-21T18:21:53.357

我通常通过使用来避免“找人”`grep $(find . -name "*,txt")`

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-27T14:44:27.200

你说你更喜欢你的方法的输出（使用find）。我可以看到它们之间的唯一区别是 grepping 多个文件会将文件名放在前面。

您总是可以（在 GNU grep 中，但您必须使用它，否则 -r 和 --include 不起作用）使用 -h（--no-filename）关闭文件名。相反，对于任何想要文件名但出于其他原因必须使用 find 的人来说，是 -H (--with-filename)。

# vb.net - 在 vb.net 中处理 dbnull 数据

> ID：222834
> 
> 赞同：79
> 
> 时间：2008-10-21T18:03:08.977
> 
> 标签：vb.net, dbnull

我想生成一些从 MS-Access 数据库中检索并存储在*DataTable*对象/变量 myDataTable 中的数据的格式化输出。但是，myDataTable 中的某些字段包含*dbNull*数据。*因此，如果任何字段lastname*、*intials*或*sID*的值为*dbNull*，则以下 VB.net 代码片段将给出错误。

```
 dim myDataTable as DataTable
   dim tmpStr as String
   dim sID as Integer = 1

   ...
   myDataTable = myTableAdapter.GetData() ' Reads the data from MS-Access table
   ...

   For Each myItem As DataRow In myDataTable.Rows

    tmpStr = nameItem("lastname") + " " + nameItem("initials")

    If myItem("sID")=sID Then
        ' Do something
    End If

    ' print tmpStr

   Next 
```

*那么，当字段可能包含dbNull*时，我如何让上面的代码工作，而不必每次都检查数据是否为 ​​dbNull ，就像[这个问题](https://stackoverflow.com/questions/105671/any-systemdbnullvalue-vs-any-is-systemdbnull)一样？

* * *

## 回答 #1

> 赞同：139
> 
> 时间：2008-10-21T18:07:57.860

我所知道的唯一方法是对其进行测试，您可以进行组合以使其变得容易。

```
If NOT IsDbNull(myItem("sID")) AndAlso myItem("sID") = sId Then
   'Do success
ELSE
   'Failure
End If 
```

我用 VB 编写，因为这看起来像是你需要的，即使你混合了语言。

**编辑**

清理以使用 IsDbNull 使其更具可读性

* * *

## 回答 #2

> 赞同：35
> 
> 时间：2009-11-12T17:10:10.680

我厌倦了处理这个问题，所以我写了一个 NotNull() 函数来帮助我。

```
Public Shared Function NotNull(Of T)(ByVal Value As T, ByVal DefaultValue As T) As T
        If Value Is Nothing OrElse IsDBNull(Value) Then
                Return DefaultValue
        Else
                Return Value
        End If
End Function 
```

用法：

```
If NotNull(myItem("sID"), "") = sID Then
  ' Do something
End If 
```

这些年来，我的 NotNull() 函数经历了几次大修。在泛型之前，我只是将所有内容都指定为对象。但我更喜欢通用版本。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2008-10-21T18:09:57.543

您还可以使用 Convert.ToString() 和 Convert.ToInteger() 方法有效地转换 DB null 的项目。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2012-03-31T05:52:58.543

[Steve Wortham 的代码的](https://stackoverflow.com/a/1723822/7444103)一种变体，名义上与`nullable`类型一起使用：

```
Private Shared Function GetNullable(Of T)(dataobj As Object) As T
    If Convert.IsDBNull(dataobj) Then
        Return Nothing
    Else
        Return CType(dataobj, T)
    End If
End Function 
```

例如

```
mynullable = GetNullable(Of Integer?)(myobj) 
```

然后您可以查询`mynullable`（例如，`mynullable.HasValue`）

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-06-07T13:30:15.250

Microsoft 在 .NET 1.0 中提出了 DBNull 来表示数据库 NULL。但是，使用起来很麻烦，因为您无法创建强类型变量来存储真正的值或空值。Microsoft 在 .NET 2.0 中使用可空类型解决了这个问题。但是，您仍然被大量使用 DBNull 的 API 所困扰，并且无法更改它们。

只是一个建议，但我通常会这样做：

1.  所有包含从数据库读取或写入数据库的数据的变量都应该能够处理空值。对于值类型，这意味着使它们为 Nullable(Of T)。对于引用类型（String 和 Byte()），这意味着允许值为 Nothing。
2.  编写一组函数来在“可能包含 DBNull 的对象”和“可为空的 .NET 变量”之间来回转换。在这些函数中包装对 DBNull 样式 API 的所有调用，然后假装 DBNull 不存在。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-10-21T18:08:41.137

您可以使用 IsDbNull 函数：

```
 If  IsDbNull(myItem("sID")) = False AndAlso myItem("sID")==sID Then
    // Do something
End If 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2012-09-05T12:25:03.700

如果您使用的是 BLL/DAL 设置，请在读入 DAL 中的对象时尝试 iif

```
While reader.Read()
 colDropdownListNames.Add(New DDLItem( _
 CType(reader("rid"), Integer), _
 CType(reader("Item_Status"), String), _
 CType(reader("Text_Show"), String), _
 CType( IIf(IsDBNull(reader("Text_Use")), "", reader("Text_Use")) , String), _
 CType(reader("Text_SystemOnly"), String), _
 CType(reader("Parent_rid"), Integer)))
End While 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-21T18:08:01.060

对于包含字符串的行，我可以将它们转换为字符串，如更改

```
tmpStr = nameItem("lastname") + " " + nameItem("initials") 
```

到

```
tmpStr = myItem("lastname").toString + " " + myItem("intials").toString 
```

对于*if*语句*myItem("sID")=sID*中的比较，需要将其更改为

```
myItem("sID").Equals(sID) 
```

然后代码将运行而不会由于*vbNull*数据而出现任何运行时错误。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2013-11-27T15:40:40.307

```
 VB.Net
   ========
    Dim da As New SqlDataAdapter
    Dim dt As New DataTable
    Call conecDB()        'Connection to Database
    da.SelectCommand = New SqlCommand("select max(RefNo) from BaseData", connDB)

    da.Fill(dt)

    If dt.Rows.Count > 0 And Convert.ToString(dt.Rows(0).Item(0)) = "" Then
        MsgBox("datbase is null")

    ElseIf dt.Rows.Count > 0 And Convert.ToString(dt.Rows(0).Item(0)) <> "" Then
        MsgBox("datbase have value")

    End If 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2013-08-11T10:10:41.370

**你好朋友**

**这是在 DataGrid 中检查 db Null 并转换为字符串的最短方法**

1.  创建单元格验证事件并编写此代码
2.  如果 Convert.ToString(dgv.CurrentCell.Value) = "" 那么
3.  CurrentCell.Value = ""
4.  万一

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2014-02-07T17:07:44.580

这是**BY FAR**转换`DBNull`为字符串的最简单方法。诀窍是您在引用数据库中的字段时**不能**使用该函数（这是我最初的问题）：`TRIM`

**之前**（产生错误消息）：

```
Me.txtProvNum.Text = IIf(Convert.IsDBNull(TRIM(myReader("Prov_Num"))), "", TRIM(myReader("Prov_Num"))) 
```

**之后**（不再有错误消息:-)）：

```
Me.txtProvNum.Text = IIf(Convert.IsDBNull(myReader("Prov_Num")), "", myReader("Prov_Num")) 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2016-09-26T20:33:43.147

我认为这应该更容易使用：

> 从表名中选择 ISNULL(sum(field),0)

复制自： http: [//www.codeproject.com/Questions/736515/How-do-I-avoide-Conversion-from-type-DBNull-to-typ](http://www.codeproject.com/Questions/736515/How-do-I-avoide-Conversion-from-type-DBNull-to-typ)

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2021-11-10T17:12:54.000

简单，但不明显。

```
DbNull.Value.Equals(myValue) 
```

我讨厌 VB.NET

# wpf - WPF：直到关闭事件触发后才会提交对具有焦点的文本框的更改

> ID：222839
> 
> 赞同：14
> 
> 时间：2008-10-21T18:04:28.117
> 
> 标签：wpf, data-binding

我有一个用于编辑数据库信息的 WPF 窗口，它使用实体框架对象表示。当用户关闭窗口时，我想在 Closing 事件中注意信息是否已更改，并显示一个消息框，以将更改保存到数据库。

不幸的是，在编辑失去焦点之前，对当前焦点编辑的更改不会分配给绑定源，这发生在处理 Closing 事件之后的某个时刻。

理想情况下，将有一个例程提交视图层次结构中的所有更改，我可以在检查我的实体是否已被修改之前调用它。我还查找了有关以编程方式清除带有焦点的控件中的焦点的信息，但不知道该怎么做。

我的问题是，这通常是如何处理的？

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2011-01-18T13:51:07.040

在 WPF 中，您可以更改 a`Binding`以在修改时更新源，而不是在失去焦点时。这是通过将[`UpdateSourceTrigger`](http://msdn.microsoft.com/en-us/library/system.windows.data.binding.updatesourcetrigger.aspx)属性设置为[`PropertyChanged`](http://msdn.microsoft.com/en-us/library/system.windows.data.updatesourcetrigger.aspx)：

```
Value="{Binding Path=MyProperty, UpdateSourceTrigger=PropertyChanged}" 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-10-22T02:32:23.973

这应该让你非常接近：

```
 private void Window_Closing(object sender, System.ComponentModel.CancelEventArgs e)
{
    ForceDataValidation();
}

private static void ForceDataValidation()
{
    TextBox textBox = Keyboard.FocusedElement as TextBox;

    if (textBox != null)
    {
        BindingExpression be = textBox.GetBindingExpression(TextBox.TextProperty);
        if (be != null && !textBox.IsReadOnly && textBox.IsEnabled)
        {
            be.UpdateSource();
        }
    }

} 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2014-10-14T10:47:18.850

也许您需要从当前元素中移除焦点

```
private void Window_Closing(object sender, System.ComponentModel.CancelEventArgs e)
{
    FocusManager.SetFocusedElement(this, null);
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-01-18T13:39:39.523

假设选项卡序列中有多个控件，则以下解决方案似乎是完整且通用的（只是剪切和粘贴）...

```
Control currentControl = System.Windows.Input.Keyboard.FocusedElement as Control;

if (currentControl != null)
{
    // Force focus away from the current control to update its binding source.
    currentControl.MoveFocus(new TraversalRequest(FocusNavigationDirection.Next));
    currentControl.Focus();
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-22T06:01:36.813

另请查看[这篇](https://stackoverflow.com/questions/57493/wpf-databind-before-saving#58443)文章中的建议

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-23T14:14:09.143

最简单的方法是将焦点设置在某处。您可以立即重新设置焦点，但将焦点设置在任何位置都会触发任何类型的控件上的 LostFocus-Event 并使其更新其内容：

```
IInputElement x = System.Windows.Input.Keyboard.FocusedElement;
DummyField.Focus();
x.Focus(); 
```

另一种方法是获取焦点元素，从焦点元素中获取绑定元素，然后手动触发更新。TextBox 和 ComboBox 的示例（您需要添加需要支持的任何控件类型）：

```
TextBox t = Keyboard.FocusedElement as TextBox;
if ((t != null) && (t.GetBindingExpression(TextBox.TextProperty) != null))
  t.GetBindingExpression(TextBox.TextProperty).UpdateSource();
ComboBox c = Keyboard.FocusedElement as ComboBox;
if ((c != null) && (c.GetBindingExpression(ComboBox.TextProperty) != null))
  c.GetBindingExpression(ComboBox.TextProperty).UpdateSource(); 
```

# javascript - 将 HTMLCollection 转换为数组的最有效方法

> ID：222841
> 
> 赞同：544
> 
> 时间：2008-10-21T18:04:53.997
> 
> 标签：javascript, arrays, object

除了遍历所述集合的内容并手动将每个项目推入数组之外，是否有更有效的方法将 HTMLCollection 转换为数组？

* * *

## 回答 #1

> 赞同：940
> 
> 时间：2008-10-21T18:06:47.567

```
var arr = Array.prototype.slice.call( htmlCollection ) 
```

使用“本机”代码将具有相同的效果。

**编辑**

由于这得到了很多意见，请注意（根据@oriol 的评论）以下更简洁的表达式实际上是*等效*的：

```
var arr = [].slice.call(htmlCollection); 
```

但请注意，根据@JussiR 的评论，与“详细”形式不同，它确实在该过程中创建了一个空的、未使用的且确实不可用的数组实例。编译器对此做了什么超出了程序员的理解范围。

**编辑**

从 ECMAScript 2015 (ES 6) 开始，还有[*Array.from*](http://ecma-international.org/ecma-262/8.0/#sec-array.from)：

```
var arr = Array.from(htmlCollection); 
```

**编辑**

ECMAScript 2015 还提供了[扩展运算符](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Spread_syntax)，它在功能上等同于`Array.from`（尽管注意`Array.from`支持映射函数作为第二个参数）。

```
var arr = [...htmlCollection]; 
```

我已经确认上述两种方法都适用于`NodeList`.

上述方法的性能比较：http: [//jsben.ch/h2IFA](http://jsben.ch/h2IFA)

* * *

## 回答 #2

> 赞同：118
> 
> 时间：2016-05-05T04:23:12.927

不确定这是否是最有效的，但简洁的 ES6 语法可能是：

```
let arry = [...htmlCollection] 
```

* * *

编辑：另一个，来自 Chris_F 评论：

```
let arry = Array.from(htmlCollection) 
```

* * *

## 回答 #3

> 赞同：24
> 
> 时间：2014-03-27T00:42:57.727

我看到了一种更简洁的方法来获取`Array.prototype`一般的方法，它也同样有效。将`HTMLCollection`对象转换为`Array`对象如下所示：

```
[].slice.call(yourHTMLCollectionObject);

```

而且，正如评论中提到的，**对于 IE7 及更早版本的旧浏览器，**您只需使用兼容性功能，例如：

```
function toArray(x) {
    for(var i = 0, a = []; i < x.length; i++)
        a.push(x[i]);

    return a
} 
```

我知道这是一个老问题，但我觉得接受的答案有点不完整；所以我想我会把它扔在那里 FWIW。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-12-09T08:14:13.550

对于跨浏览器实现，我建议您查看[prototype.js](http://prototypejs.org/) `$A`函数

[从 1.6.1 复制](http://prototypejs.org/assets/2009/8/31/prototype.js)：

```
function $A(iterable) {
  if (!iterable) return [];
  if ('toArray' in Object(iterable)) return iterable.toArray();
  var length = iterable.length || 0, results = new Array(length);
  while (length--) results[length] = iterable[length];
  return results;
} 
```

它不使用`Array.prototype.slice`可能是因为它并非在每个浏览器上都可用。恐怕性能很差，因为回退是`iterable`.

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2016-08-13T06:35:55.327

这适用于所有浏览器，包括早期的 IE 版本。

```
var arr = [];
[].push.apply(arr, htmlCollection); 
```

由于 jsperf 目前还处于 down 状态，这里有一个 jsfiddle 比较不同方法的性能。[https://jsfiddle.net/qw9qf48j/](https://jsfiddle.net/qw9qf48j/)

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2018-07-10T18:40:55.380

为了以有效的方式将类数组转换为数组，我们可以使用[jQuery](https://api.jquery.com/jQuery.makeArray/) `makeArray`：

> makeArray：将类数组对象转换为真正的 JavaScript 数组。

用法：

```
var domArray = jQuery.makeArray(htmlCollection); 
```

* * *

一点额外的：

如果您不想保留对数组对象的引用（大多数时候 HTMLCollections 是动态更改的，因此最好将它们复制到另一个数组中，此示例密切关注性能：

```
var domDataLength = domData.length //Better performance, no need to calculate every iteration the domArray length
var resultArray = new Array(domDataLength) // Since we know the length its improves the performance to declare the result array from the beginning.

for (var i = 0 ; i < domDataLength ; i++) {
    resultArray[i] = domArray[i]; //Since we already declared the resultArray we can not make use of the more expensive push method.
} 
```

什么是类数组？

[HTMLCollection](https://api.jquery.com/jQuery.makeArray/)是一个`"array-like"`对象，[类数组](http://www.nfriedly.com/techblog/2009/06/advanced-javascript-objects-arrays-and-array-like-objects/)对象类似于数组的对象，但缺少很多功能定义：

> 类数组对象看起来像数组。它们有各种编号的元素和一个长度属性。但这就是相似之处停止的地方。类数组对象没有 Array 的任何功能，for-in 循环甚至不起作用！

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2013-05-16T19:35:08.213

这是我个人的解决方案，基于此处的信息（此线程）：

```
var Divs = new Array();    
var Elemns = document.getElementsByClassName("divisao");
    try {
        Divs = Elemns.prototype.slice.call(Elemns);
    } catch(e) {
        Divs = $A(Elemns);
    } 
```

Gareth Davis 在他的帖子中描述了 $A：

```
function $A(iterable) {
  if (!iterable) return [];
  if ('toArray' in Object(iterable)) return iterable.toArray();
  var length = iterable.length || 0, results = new Array(length);
  while (length--) results[length] = iterable[length];
  return results;
} 
```

如果浏览器支持最好的方式，ok，否则将使用跨浏览器。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2022-01-04T09:55:02.673

有时，即使您以正确的方式编写代码，但仍然无法正常工作。

```
var allbuttons = document.getElementsByTagName("button");
console.log(allbuttons);

var copyAllButtons = [];
for (let i = 0; i < allbuttons.length; i++) {
  copyAllButtons.push(allbuttons[i]);
}
console.log(copyAllButtons); 
```

你得到空数组。像这样

```
HTMLCollection []
[] 
```

[控制台_javascript](https://i.stack.imgur.com/YKgwq.jpg)

为了解决这个问题，您必须在 html 文件中的 body 标记之后添加 javascript 文件的链接。

```
<script src="./script.js"></script> 
```

如下所示， [html_file](https://i.stack.imgur.com/hCTSf.png)

最终输出

```
HTMLCollection(6) [button.btn.btn-dark.click-me, button.btn.btn-dark.reset, button#b, button#b, button#b, button#b, b: button#b]
(6) [button.btn.btn-dark.click-me, button.btn.btn-dark.reset, button#b, button#b, button#b, button#b] 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2021-02-01T12:07:58.560

我认为在 的实例上**调用`Array.prototype`函数**`HTMLCollection`是比将集合转换为数组（例如，`[...collection]`或`Array.from(collection)`）更好的选择，因为在后一种情况下，集合被不必要地隐式迭代并创建了一个新的数组对象，这会占用额外的资源。`Array.prototype`迭代函数可以安全地调用具有从 from 开始的连续数字键`[0]`和具有`length`此类键数量的有效数字值的属性的对象（包括，例如 和 的实例`HTMLCollection`）`FileList`，因此这是一种可靠的方法。另外，如果经常需要这样的操作，`[]`可以使用一个空数组来快速访问`Array.prototype`函数；或快捷方式`Array.prototype`可以改为创建。一个可运行的例子：

```
const _ = Array.prototype;
const collection = document.getElementById('ol').children;
alert(_.reduce.call(collection, (acc, { textContent }, i) => {
  return acc += `${i+1}) ${textContent}` + '\n';
}, ''));
```

```
<ol id="ol">
    <li>foo</li>
    <li>bar</li>
    <li>bat</li>
    <li>baz</li>
</ol>
```

# mysql - Corel draw 13 mysql查询

> ID：222870
> 
> 赞同：0
> 
> 时间：2008-10-21T18:12:17.417
> 
> 标签：mysql, coreldraw

有没有办法在 Corel Draw 13(X3) 中进行 mysql 数据库查询？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-21T20:14:07.263

如果我没记错的话，CorelDraw 使用 VBA 作为脚本语言，不是吗？

如果是这样，如果它不受限制，您可能可以使用 ODBC 来做到这一点。有关详细信息，请参阅[MySQL 连接器/ODBC](http://dev.mysql.com/doc/refman/5.0/en/connector-odbc.html "MySQL 连接器/ODBC")。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-21T20:31:44.793

为了跟进 PhiLho 的观点，[这是一本 Google 扫描的书，显示使用 ODBC 连接到 MS-Access 数据库](http://books.google.ca/books?id=9OTV1YNLLBsC&pg=PT609&lpg=PT609&dq=Corel+draw+odbc&source=web&ots=2CEhpBo-cE&sig=FjIShZtwQmdSnYMlEtyrEzkR5ys&hl=en&sa=X&oi=book_result&resnum=3&ct=result#PPT611,M1)

# linq - 如何将null分配给sql实体列

> ID：222871
> 
> 赞同：1
> 
> 时间：2008-10-21T18:12:20.457
> 
> 标签：linq, linq-to-sql

我已经为 sql 实体生成了 linq，但无法弄清楚如何将 null 分配给可空列。每当我尝试将 null 分配给它时，它都会说“int 和”之间没有隐式类型转换。顺便说一句，该字段的类型是 int 吗？并且数据库列也可以为空。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-21T18:35:00.520

尝试将其分配给 System.DBNull

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-22T08:55:43.077

你写了*“字段的类型是 int 吗？”* .
我想这就是问题所在：字段的**类型**应该是**int （没有？）**，并且属性“**允许空值**”应该设置为**true**。

在设计器中，您可以将字段类型更改为**int?** 而不是**int**和 ' **allow null** '，但是这样你会遇到各种麻烦（你可能已经注意到了）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-21T18:21:12.593

似乎该列并不是真正可以为空的。检查列的属性，看看它确实被标记为可为空的。如果不是，请检查您的数据库模型并尝试重新创建*LINQ to SQL*模型（如果它在数据库中可以为空）。

请注意，您不能简单地将其在*LINQ to SQL*模型中而不是在数据库中标记为可为空，因为这些类型的差异可能会导致您的*LINQ to SQL*模型停止工作。

**后期编辑更新：**我可以看到字段类型与`int?`此相同，`Nullable<int>`因此将其设置为 null 应该没有问题。但是，在获取整数值时，您应该使用`Value`. `int?`那是问题吗？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-21T20:57:46.503

通常，在将数据库值分配或比较为 null 时，我不得不使用 DBNULL.Value。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-21T21:07:51.663

您只需将 then entites 可为空的属性分配给`null`. 在使用 linq-to-sql 实体时，我从来*不需要*对 System.DBNull 进行分配或测试。

听起来生成的实体类已被手动修改或从数据库中过期。

供您参考，以下是可空和不可空的整数字段：

```
private int? _someID;
/// <summary>
/// Gets or sets the SomeID.
/// </summary>
[Column(Name="SomeID", Storage="_someID", DbType="INT", UpdateCheck=UpdateCheck.Never)]
public int? SomeID
{

private int _someOtherID;
/// <summary>
/// Gets or sets the SomeOtherID.
/// </summary>
[Column(Name="SomeOtherID", Storage="_someOtherID", DbType="INT NOT NULL", CanBeNull=false, UpdateCheck=UpdateCheck.Never)]
public int SomeOtherID
{ 
```

检查您生成的实体是否类似于上面的内容。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2016-05-13T20:39:55.150

当您尝试在实体中显式创建具有可为空列的数据库集时。

new Nullable() 是您正在寻找的。

```
someEntity newEntity = new someEntity()
{
   aNullableInt = new Nullable<Int32>()
}; 
```

# python - “超级”在 Python 中做了什么？- super().__init__() 和显式超类 __init__() 之间的区别

> ID：222877
> 
> 赞同：680
> 
> 时间：2008-10-21T18:13:15.027
> 
> 标签：python, oop, inheritance, multiple-inheritance, super

有什么区别：

```
class Child(SomeBaseClass):
    def __init__(self):
        super(Child, self).__init__() 
```

和：

```
class Child(SomeBaseClass):
    def __init__(self):
        SomeBaseClass.__init__(self) 
```

我已经看到`super`在只有单一继承的类中被大量使用。我可以理解您为什么要在多重继承中使用它，但不清楚在这种情况下使用它有什么优势。

* * *

## 回答 #1

> 赞同：408
> 
> 时间：2015-11-02T00:53:24.423

## 有什么不同？

```
SomeBaseClass.__init__(self) 
```

意思是打电话给`SomeBaseClass`'s `__init__`。尽管

```
super().__init__() 
```

表示从实例的方法解析顺序 (MRO)`__init__`中跟随 的子类（定义此方法的那个）的父类调用绑定。`SomeBaseClass`

如果该实例是该子类的*子*类，则 MRO 中可能会有不同的父类。

### 简单解释

当您编写一个类时，您希望其他类能够使用它。`super()`使其他类更容易使用您正在编写的类。

正如 Bob Martin 所说，一个好的架构可以让你尽可能地推迟决策。

`super()`可以启用这种架构。

当另一个类继承您编写的类时，它也可能是从其他类继承的。并且这些类可以根据类的顺序`__init__`在此之后有一个用于方法解析的类。`__init__`

如果没有`super`您，您可能会对您正在编写的类的父级进行硬编码（就像示例一样）。这意味着您不会`__init__`在 MRO 中调用 next，因此您将无法重用其中的代码。

如果您编写自己的代码供个人使用，您可能不会关心这种区别。但是，如果您希望其他人使用您的代码，那么使用`super`是一件事，它可以为代码的用户提供更大的灵活性。

### Python 2 与 3

这适用于 Python 2 和 3：

```
super(Child, self).__init__() 
```

这仅适用于 Python 3：

```
super().__init__() 
```

它通过在堆栈帧中向上移动并获取方法的第一个参数（通常`self`用于实例方法或`cls`类方法 - 但可以是其他名称）并`Child`在自由变量中找到类（例如），从而在没有参数的情况下工作（它`__class__`在方法中使用名称作为自由闭包变量进行查找）。

我以前更喜欢演示交叉兼容的使用方式`super`，但现在 Python 2 已在很大程度上被弃用，我将演示 Python 3 的处理方式，即`super`不带参数的调用。

### 具有前向兼容性的间接

它给了你什么？对于单继承，从静态分析的角度来看，问题中的示例实际上是相同的。但是， using`super`为您提供了一层具有前向兼容性的间接性。

前向兼容性对于经验丰富的开发人员来说非常重要。您希望您的代码在更改时保持最小的更改。当您查看您的修订历史时，您希望准确了解何时发生了哪些变化。

您可以从单一继承开始，但如果您决定添加另一个基类，您只需更改与基类的行 - 如果基类在您继承的类中发生更改（例如添加了 mixin），您将更改这堂课什么都没有。

在 Python 2 中，正确获取参数`super`和正确的方法参数可能有点令人困惑，所以我建议使用 Python 3 唯一的调用方法。

如果您知道自己`super`正确地使用了单继承，那么以后的调试难度就会降低。

### 依赖注入

其他人可以使用您的代码并将父级注入方法解析：

```
class SomeBaseClass(object):
    def __init__(self):
        print('SomeBaseClass.__init__(self) called')

class UnsuperChild(SomeBaseClass):
    def __init__(self):
        print('UnsuperChild.__init__(self) called')
        SomeBaseClass.__init__(self)

class SuperChild(SomeBaseClass):
    def __init__(self):
        print('SuperChild.__init__(self) called')
        super().__init__() 
```

假设您向对象添加了另一个类，并希望在 Foo 和 Bar 之间注入一个类（出于测试或其他原因）：

```
class InjectMe(SomeBaseClass):
    def __init__(self):
        print('InjectMe.__init__(self) called')
        super().__init__()

class UnsuperInjector(UnsuperChild, InjectMe): pass

class SuperInjector(SuperChild, InjectMe): pass 
```

使用 un-super 子级无法注入依赖项，因为您使用的子级已硬编码要在其自身之后调用的方法：

```
>>> o = UnsuperInjector()
UnsuperChild.__init__(self) called
SomeBaseClass.__init__(self) called 
```

但是，使用子类的类`super`可以正确注入依赖项：

```
>>> o2 = SuperInjector()
SuperChild.__init__(self) called
InjectMe.__init__(self) called
SomeBaseClass.__init__(self) called 
```

### 发表评论

> 为什么这会有用？

[Python 通过C3 线性化算法](https://en.wikipedia.org/wiki/C3_linearization)线性化复杂的继承树，以创建方法解析顺序 (MRO)。

*我们希望按该顺序*查找方法。

对于在父级中定义的方法以在没有 的情况下按该顺序查找下一个方法`super`，它必须

1.  从实例的类型中获取 mro
2.  寻找定义方法的类型
3.  用方法找到下一个类型
4.  绑定该方法并使用预期的参数调用它

> `UnsuperChild`不应该`InjectMe`访问. 为什么结论不是“始终避免使用`super`”？我在这里想念什么？

`UnsuperChild`无权访问. _ *_* `InjectMe`它是`UnsuperInjector`有权访问的`InjectMe`，但不能从它继承的方法调用该类的方法`UnsuperChild`。

两个子类都打算调用 MRO 中下一个具有相同名称的方法，这可能是它在创建时不知道的*另一个类。*

没有`super`对其父方法进行硬编码的方法 - 因此限制了其方法的行为，并且子类无法在调用链中注入功能。

*具有* `super`更大灵活性的那个。可以拦截方法的调用链并注入功能。

您可能不需要该功能，但您的代码的子类可能需要。

## 结论

始终使用`super`来引用父类，而不是对其进行硬编码。

您打算引用的父类是next-in-line，而不是您看到子继承的父类。

不使用`super`会对代码的用户施加不必要的限制。

* * *

## 回答 #2

> 赞同：347
> 
> 时间：2008-10-21T18:24:50.463

单继承的好处`super()`是微乎其微的——大多数情况下，您不必将基类的名称硬编码到使用其父方法的每个方法中。

但是，几乎不可能在没有`super()`. 这包括常见的习惯用法，如 mixins、接口、抽象类等。这会扩展到以后扩展您的代码。如果后来有人想编写一个扩展类`Child`和一个 mixin，他们的代码将无法正常工作。

* * *

## 回答 #3

> 赞同：52
> 
> 时间：2016-12-29T17:31:09.887

我玩了一点`super()`，并认识到我们可以更改呼叫顺序。

例如，我们有下一个层次结构：

```
 A
   / \
  B   C
   \ /
    D 
```

在这种情况下，D 的[MRO](https://stackoverflow.com/a/1848647)将是（仅适用于 Python 3）：

```
In [26]: D.__mro__
Out[26]: (__main__.D, __main__.B, __main__.C, __main__.A, object) 
```

让我们创建一个`super()`在方法执行后调用的类。

```
In [23]: class A(object): #  or with Python 3 can define class A:
...:     def __init__(self):
...:         print("I'm from A")
...:  
...: class B(A):
...:      def __init__(self):
...:          print("I'm from B")
...:          super().__init__()
...:   
...: class C(A):
...:      def __init__(self):
...:          print("I'm from C")
...:          super().__init__()
...:  
...: class D(B, C):
...:      def __init__(self):
...:          print("I'm from D")
...:          super().__init__()
...: d = D()
...:
I'm from D
I'm from B
I'm from C
I'm from A

    A
   / ⇖
  B ⇒ C
   ⇖ /
    D 
```

所以我们可以看到解决顺序与 MRO 中的相同。但是当我们`super()`在方法的开头调用时：

```
In [21]: class A(object):  # or class A:
...:     def __init__(self):
...:         print("I'm from A")
...:  
...: class B(A):
...:      def __init__(self):
...:          super().__init__()  # or super(B, self).__init_()
...:          print("I'm from B")
...:   
...: class C(A):
...:      def __init__(self):
...:          super().__init__()
...:          print("I'm from C")
...:  
...: class D(B, C):
...:      def __init__(self):
...:          super().__init__()
...:          print("I'm from D")
...: d = D()
...: 
I'm from A
I'm from C
I'm from B
I'm from D 
```

我们有一个不同的顺序，它与 MRO 元组的顺序相反。

```
 A
   / ⇘
  B ⇐ C
   ⇘ /
    D 
```

对于额外的阅读，我会推荐下一个答案：

1.  [具有超级（大型层次结构）的 C3 线性化示例](https://stackoverflow.com/a/27670178)
2.  [新旧样式类之间的重要行为变化](https://stackoverflow.com/a/19950198/1322168)
3.  [新式课堂的内幕](http://python-history.blogspot.com/2010/06/inside-story-on-new-style-classes.html)

* * *

## 回答 #4

> 赞同：35
> 
> 时间：2008-10-22T00:06:32.333

这一切不都假设基类是新式类吗？

```
class A:
    def __init__(self):
        print("A.__init__()")

class B(A):
    def __init__(self):
        print("B.__init__()")
        super(B, self).__init__() 
```

在 Python 2 中不起作用。`class A`必须是新式的，即：`class A(object)`

* * *

## 回答 #5

> 赞同：22
> 
> 时间：2016-09-07T17:33:28.780

当调用`super()`以解析到父类方法、实例方法或静态方法的版本时，我们希望将我们所在范围的当前类作为第一个参数传递，以指示我们尝试解析到哪个父类的范围，并作为第二个参数是感兴趣的对象，以指示我们试图将该范围应用于哪个对象。

考虑一个类层次结构`A`, `B`, 并且`C`每个类都是其后一个类的父级, 和`a`,`b`以及每个类的`c`相应实例。

```
super(B, b) 
# resolves to the scope of B's parent i.e. A 
# and applies that scope to b, as if b was an instance of A

super(C, c) 
# resolves to the scope of C's parent i.e. B
# and applies that scope to c

super(B, c) 
# resolves to the scope of B's parent i.e. A 
# and applies that scope to c 
```

## 使用`super`静态方法

例如`super()`在`__new__()`方法中使用

```
class A(object):
    def __new__(cls, *a, **kw):
        # ...
        # whatever you want to specialize or override here
        # ...

        return super(A, cls).__new__(cls, *a, **kw) 
```

解释：

1- 尽管通常`__new__()`将调用类的引用作为其第一个参数，但它在 Python 中*不是*作为类方法实现的，而是作为静态方法实现的。也就是说，对类的引用必须在`__new__()`直接调用时作为第一个参数显式传递：

```
# if you defined this
class A(object):
    def __new__(cls):
        pass

# calling this would raise a TypeError due to the missing argument
A.__new__()

# whereas this would be fine
A.__new__(A) 
```

2-当调用`super()`到父类时，我们将子类`A`作为其第一个参数传递，然后我们传递对感兴趣对象的引用，在这种情况下，它`A.__new__(cls)`是调用时传递的类引用。在大多数情况下，它也恰好是对子类的引用。在某些情况下，它可能不是，例如在多代继承的情况下。

```
super(A, cls) 
```

3-因为作为一般规则`__new__()`是一个静态方法，`super(A, cls).__new__`也将返回一个静态方法，并且需要显式地提供所有参数，包括对感兴趣对象的引用，在这种情况下`cls`。

```
super(A, cls).__new__(cls, *a, **kw) 
```

4-做同样的事情没有`super`

```
class A(object):
    def __new__(cls, *a, **kw):
        # ...
        # whatever you want to specialize or override here
        # ...

        return object.__new__(cls, *a, **kw) 
```

## `super`与实例方法一起使用

例如`super()`从内部使用`__init__()`

```
class A(object): 
    def __init__(self, *a, **kw):
        # ...
        # you make some changes here
        # ...

        super(A, self).__init__(*a, **kw) 
```

解释：

1-`__init__`是一个实例方法，这意味着它的第一个参数是对实例的引用。当直接从实例调用时，引用是隐式传递的，也就是说你不需要指定它：

```
# you try calling `__init__()` from the class without specifying an instance
# and a TypeError is raised due to the expected but missing reference
A.__init__() # TypeError ...

# you create an instance
a = A()

# you call `__init__()` from that instance and it works
a.__init__()

# you can also call `__init__()` with the class and explicitly pass the instance 
A.__init__(a) 
```

2-当`super()`在内部调用时，`__init__()`我们将子类作为第一个参数传递，将感兴趣的对象作为第二个参数传递，这通常是对子类实例的引用。

```
super(A, self) 
```

3- 调用`super(A, self)`返回一个代理，该代理将解析范围并将其应用于就`self`好像它现在是父类的实例一样。我们称之为代理`s`。由于`__init__()`是实例方法，因此调用`s.__init__(...)`将隐式地将 的引用`self`作为第一个参数传递给父级的`__init__()`.

4-做同样的事情，`super`我们不需要将实例的引用显式传递给父版本的`__init__()`.

```
class A(object): 
    def __init__(self, *a, **kw):
        # ...
        # you make some changes here
        # ...

        object.__init__(self, *a, **kw) 
```

## `super`与类方法一起使用

```
class A(object):
    @classmethod
    def alternate_constructor(cls, *a, **kw):
        print "A.alternate_constructor called"
        return cls(*a, **kw)

class B(A):
    @classmethod
    def alternate_constructor(cls, *a, **kw):
        # ...
        # whatever you want to specialize or override here
        # ...

        print "B.alternate_constructor called"
        return super(B, cls).alternate_constructor(*a, **kw) 
```

解释：

1- 可以直接从类中调用类方法，并将对类的引用作为其第一个参数。

```
# calling directly from the class is fine,
# a reference to the class is passed implicitly
a = A.alternate_constructor()
b = B.alternate_constructor() 
```

2-当在类方法中调用`super()`以解析其父版本时，我们希望将当前子类作为第一个参数传递以指示我们尝试解析到哪个父类的范围，并将感兴趣的对象作为第二个参数指示我们想要将该范围应用于哪个对象，通常是对子类本身或其子类之一的引用。

```
super(B, cls_or_subcls) 
```

3- 调用`super(B, cls)`解析为 的范围`A`并将其应用于`cls`. 由于`alternate_constructor()`是一个类方法，调用`super(B, cls).alternate_constructor(...)`将隐式传递一个引用`cls`作为第一个参数到`A`的版本`alternate_constructor()`

```
super(B, cls).alternate_constructor() 
```

4-在不使用的情况下做同样的事情，`super()`您需要获取对*未绑定*版本`A.alternate_constructor()`（即函数的显式版本）的引用。简单地这样做是行不通的：

```
class B(A):
    @classmethod
    def alternate_constructor(cls, *a, **kw):
        # ...
        # whatever you want to specialize or override here
        # ...

        print "B.alternate_constructor called"
        return A.alternate_constructor(cls, *a, **kw) 
```

上述方法不起作用，因为该`A.alternate_constructor()`方法将隐式引用`A`作为其第一个参数。这里`cls`传递的将是它的第二个参数。

```
class B(A):
    @classmethod
    def alternate_constructor(cls, *a, **kw):
        # ...
        # whatever you want to specialize or override here
        # ...

        print "B.alternate_constructor called"
        # first we get a reference to the unbound 
        # `A.alternate_constructor` function 
        unbound_func = A.alternate_constructor.im_func
        # now we call it and pass our own `cls` as its first argument
        return unbound_func(cls, *a, **kw) 
```

* * *

## 回答 #6

> 赞同：16
> 
> 时间：2020-12-20T19:33:51.387

## Super() 简而言之

*   每个 Python 实例都有一个创建它的类。
*   Python 中的每个类都有一系列祖先类。
*   使用 super() 的方法将工作委托给实例类的链中的下一个祖先。

## 例子

这个小例子涵盖了所有有趣的案例：

```
class A:
    def m(self):
        print('A')

class B(A):
    def m(self):
        print('B start')
        super().m()
        print('B end')

class C(A):
    def m(self):
        print('C start')
        super().m()
        print('C end')

class D(B, C):
    def m(self):
        print('D start')
        super().m()
        print('D end') 
```

调用的确切顺序由调用方法的实例决定：

```
>>> a = A()
>>> b = B()
>>> c = C()
>>> d = D() 
```

例如*a*，没有超级调用：

```
>>> a.m()
A 
```

例如*b*，祖先链是`B -> A -> object`：

```
>>> type(b).__mro__   
(<class '__main__.B'>, <class '__main__.A'>, <class 'object'>)

>>> b.m()
B start
A
B end 
```

例如*c*，祖先链是`C -> A -> object`：

```
>>> type(c).__mro__   
(<class '__main__.C'>, <class '__main__.A'>, <class 'object'>)

>>> b.m()
C start
A
C end 
```

例如*d*，祖先链更有趣`D -> B -> C -> A -> object`（***mro***代表方法解析顺序）：

```
>>> type(d).__mro__
(<class '__main__.D'>, <class '__main__.B'>, <class '__main__.C'>, <class '__main__.A'>, <class 'object'>)

>>> d.m()
D start
B start
C start
A
C end
B end
D end 
```

## 更多信息

回答完“super 在 Python 中做了什么？”的问题后，下一个问题是如何有效地使用它。请参阅此[分步教程](https://rhettinger.wordpress.com/2011/05/26/super-considered-super/)或此[45 分钟视频](https://www.youtube.com/watch?v=EiOglTERPEo&t=847s)。

* * *

## 回答 #7

> 赞同：11
> 
> 时间：2019-06-24T17:25:47.187

许多很好的答案，但对于视觉学习者：首先让我们用参数来探索 super，然后不用。 [![超级继承树示例](https://i.stack.imgur.com/SvBDY.png)](https://i.stack.imgur.com/SvBDY.png)

想象有一个`jack`从类创建的实例`Jack`，它具有图中绿色所示的继承链。来电：

`super(Jack, jack).method(...)`

将使用`jack`（其继承树按一定顺序）的MRO（方法解析顺序），并将从 开始搜索`Jack`。为什么可以提供一个父类？好吧，如果我们从实例开始搜索`jack`，它会找到实例方法，重点是找到它的父母方法。

如果不向 super 提供参数，则传入的第一个参数是 的类`self`，传入的第二个参数是`self`。这些是在 Python3 中为您自动计算的。

但是，如果我们不想使用`Jack`' 方法，而不是传入`Jack`，我们可以传入`Jen`以开始向上搜索 from 的方法`Jen`。

它一次搜索一层（宽度而不是深度），例如，如果`Adam`两者`Sue`都具有所需的方法，`Sue`则将首先找到来自的那个。

如果`Cain`两者`Sue`都有所需的方法，`Cain`则将首先调用 ' 的方法。这在代码中对应于：

```
Class Jen(Cain, Sue): 
```

MRO 从左到右。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2020-07-31T15:05:54.150

在多重继承的情况下，您通常希望调用父母双方的初始化程序，而不仅仅是第一个。super() 并不总是使用基类，而是查找方法解析顺序 (MRO) 中的下一个类，并将当前对象作为该类的实例返回。例如：

```
class Base(object):
    def __init__(self):
        print("initializing Base")

class ChildA(Base):
    def __init__(self):
        print("initializing ChildA")
        Base.__init__(self)

class ChildB(Base):
    def __init__(self):
        print("initializing ChildB")
        super().__init__()

class Grandchild(ChildA, ChildB):
    def __init__(self):
        print("initializing Grandchild")
        super().__init__()

Grandchild() 
```

结果是

```
initializing Grandchild
initializing ChildA
initializing Base 
```

`Base.__init__(self)`用`super().__init__()`结果替换

```
initializing Grandchild
initializing ChildA
initializing ChildB
initializing Base 
```

如预期的。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2019-06-22T11:26:05.743

这里有一些很好的答案，但他们没有解决如何`super()`在层次结构中的不同类具有不同签名的情况下使用......尤其是在`__init__`

要回答那部分并能够有效地使用`super()`我建议阅读我的答案[super() 并更改合作方法的签名](https://stackoverflow.com/questions/56714419/super-and-changing-the-signature-of-cooperative-methods/56714809#56714809)。

这只是这种情况的解决方案：

> 1.  层次结构中的顶级类必须继承自自定义类，例如`SuperObject`：
> 2.  如果类可以采用不同的参数，请始终将您收到的所有参数作为关键字参数传递给超级函数，并且始终接受`**kwargs`.

```
class SuperObject:        
    def __init__(self, **kwargs):
        print('SuperObject')
        mro = type(self).__mro__
        assert mro[-1] is object
        if mro[-2] is not SuperObject:
            raise TypeError(
                'all top-level classes in this hierarchy must inherit from SuperObject',
                'the last class in the MRO should be SuperObject',
                f'mro={[cls.__name__ for cls in mro]}'
            )

        # super().__init__ is guaranteed to be object.__init__        
        init = super().__init__
        init() 
```

示例用法：

```
class A(SuperObject):
    def __init__(self, **kwargs):
        print("A")
        super(A, self).__init__(**kwargs)

class B(SuperObject):
    def __init__(self, **kwargs):
        print("B")
        super(B, self).__init__(**kwargs)

class C(A):
    def __init__(self, age, **kwargs):
        print("C",f"age={age}")
        super(C, self).__init__(age=age, **kwargs)

class D(B):
    def __init__(self, name, **kwargs):
        print("D", f"name={name}")
        super(D, self).__init__(name=name, **kwargs)

class E(C,D):
    def __init__(self, name, age, *args, **kwargs):
        print( "E", f"name={name}", f"age={age}")
        super(E, self).__init__(name=name, age=age, *args, **kwargs)

E(name='python', age=28) 
```

输出：

```
E name=python age=28
C age=28
A
D name=python
B
SuperObject 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2020-05-17T13:55:34.257

考虑以下代码：

```
class X():
    def __init__(self):
        print("X")

class Y(X):
    def __init__(self):
        # X.__init__(self)
        super(Y, self).__init__()
        print("Y")

class P(X):
    def __init__(self):
        super(P, self).__init__()
        print("P")

class Q(Y, P):
    def __init__(self):
        super(Q, self).__init__()
        print("Q")

Q() 
```

如果更改`Y`to的构造函数`X.__init__`，您将得到：

```
X
Y
Q 
```

但是使用`super(Y, self).__init__()`，你会得到：

```
X
P
Y
Q 
```

并且`P`甚至`Q`可能涉及另一个您在编写时不知道的文件`X`和`Y`. 所以，基本上，你不会知道`super(Child, self)`你在写的时候会引用什么`class Y(X)`，即使是 Y 的签名也很简单`Y(X)`。这就是为什么 super 可能是更好的选择。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2018-07-17T19:14:11.403

```
class Child(SomeBaseClass):
    def __init__(self):
        SomeBaseClass.__init__(self) 
```

这很容易理解。

```
class Child(SomeBaseClass):
    def __init__(self):
        super(Child, self).__init__() 
```

好的，如果你现在使用 会发生什么`super(Child,self)`？

在创建 Child 实例时，其 MRO(Method Resolution Order) 基于继承的顺序为 (Child, SomeBaseClass, object)。（假设 SomeBaseClass 除了默认对象之外没有其他父对象）

通过`Child, self`, `super`在实例的 MRO 中搜索`self`，返回 Child 的 next 代理对象，本例为 SomeBaseClass，然后该对象调用`__init__`SomeBaseClass 的方法。换句话说，如果它是`super(SomeBaseClass,self)`，则返回的代理对象`super`将是`object`

对于多继承，MRO 可以包含许多类，因此基本上`super`可以让您决定要在 MRO 中的哪个位置开始搜索。

# .net - LINQ to SQL 生成的对象可以解耦吗？

> ID：222895
> 
> 赞同：11
> 
> 时间：2008-10-21T18:17:28.043
> 
> 标签：.net, linq-to-sql, architecture

我喜欢 LINQ to SQL，但它生成的类似乎与它们存储的数据库紧密耦合，这似乎是一件坏事。

例如，使用 ye olde Northwind 数据库，如果我使用 Products 表创建 dbml，`Product`则会生成一个类。我可以在任何其他层使用这个类，这一切都很好，但是如果我决定我宁愿使用普通的旧 ADO.NET（或切换数据库），我将不得不重新创建这个`Product`类，以及其他所有“模型。”

有没有解决的办法？还是单独创建对象模型，然后将表映射到它们？我已经尝试过提供的各种映射类，但还没有找到令人满意的答案。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-23T14:19:51.160

所有这些答案，没有链接！也许我可以帮忙：

[大明说的属性东西](http://msdn.microsoft.com/en-us/library/bb425822.aspx#linqtosql_topic3)

[马库斯·金提到的部分阶级的事情](http://msdn.microsoft.com/en-us/library/bb546176.aspx)

我曾多次经历过这个困难，最后我在上一个项目中所做的就是使用接口作为解决方案中所有不同项目之间共享的契约，并让部分类实现它。

```
[Table(Name="Products")]
public partial class Product: IProduct { } 
```

是的，不幸的是，它需要一些反射魔法才能使其适用于 POCO 实施。

最后，如果你真的关心它，我会选择 NHibernate（我也不是很喜欢它），这正是 Garry Shulter 所描述的。

希望有帮助！

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-21T18:49:24.190

我的团队最近与这个问题作斗争。我真的很想保持“持久性无知”，这意味着可以将域对象创建为普通的旧 C# 对象，而不必被迫从某个基类继承或用一堆属性使类混乱。正如您所说，我们希望能够独立于业务模型修改持久层。

最后，我们决定如果您想要对持久性无知，那么 LINQ 不是可行的方法。我们最终编写了太多的映射代码来在 LINQ 层和我们的业务层之间进行转换。当我们开始编写一堆基于反射的代码来尝试自动执行这些映射时，我们意识到我们正在滑下兔子洞，几乎没有什么可展示的。

如果持久性无知对您很重要，那么使用 NHIbernate 等成熟的 ORM 可能会更好。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-21T18:52:18.270

Linq to SQL（或 EF）与持久性无知*无关。*它是关于数据的对象视图。

NHibernate 是您可能正在寻找的持久性无知 ORM。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-21T22:45:13.107

我最近通过自己创建 POCO 并为数据库手动创建 XML 映射文件来实现这一点。它需要一些手动工作，但它会产生预期的效果。

这是[一篇我发现](http://www.sidarok.com/web/blog/content/2008/10/14/achieving-poco-s-in-linq-to-sql.html)对您入门很有帮助的博客文章。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-12-12T21:05:26.533

哦，嘿，我想我在观看[Rob Conery 在 ASP.NET MVC 上的截屏视频](http://www.asp.net/learn/mvc-videos/#MVCStorefrontStarterKit)时找到了解决方案。诀窍是`select`在您的 LINQ to SQL 查询中插入一个对象。

```
public IQueryable<LinqExample.Core.Person> GetAll() {
    var people = from pe in this.db.Persons
                 select new Person {
                     Id = pe.id,
                     FirstName = pe.fname,
                     LastName = pe.lname,
                     Reports = this.GetReports(pe.id)
                 };
    return people;
} 
```

这让您可以`Person`在代码的其他地方定义一个类。[我在博客上](http://www.sogeti-phoenix.com/Blogs/post/2008/12/LINQ-To-SQL-and-Tight-Coupling-Part-4.aspx)更深入地讨论了它。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-21T18:24:27.687

Scott Hanselman 做了一个关于 asp.net DynamicData 的屏幕，他在其中使用了 Linq To Sql 类。尽管他没有解决特定问题，但我认为一般概念仍然有效。他的方法是创建一个单独的**部分**类，该类`Product`与您的情况下由 dbml 生成的类同名。那么你应该总是有一个`Product`存在于 LINQ 生成之外的类，并且只是“扩展”它的作用。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-21T22:33:18.263

只需将生成的代码复制到您自己的类中并关闭代码生成即可。神奇之处在于属性而不是其他任何东西。

或者，您可以编写自己的不带属性的普通 CLR 对象，并使用外部 XML 映射文件来描述对象和数据库之间的关系。更多信息可以在 MSDN 上的 LINQ to SQL 文档中找到。

# linq-to-sql - 使用构造方法扩展 LINQ 实体类，并使该实体类继承自它的 DataContext 类

> ID：222897
> 
> 赞同：0
> 
> 时间：2008-10-21T18:18:40.773
> 
> 标签：linq-to-sql, .net-3.5, c#-3.0

是否可以同时使用构造函数方法扩展 LINQ-to-SQL 实体类；使该实体类从它的数据上下文类继承？-本质上将实体类转换为业务对象。

这是我目前使用的模式：

```
namespace Xxx
{
    public class User : Xxx.DataContext
    {
        public enum SiteAccessRights
        {
            NotRegistered = 0,
            Registered = 1,
            Administrator = 3
        }

        private Xxx.Entities.User _user;

        public Int32 ID
        {
            get
            {
                return this._user.UsersID;
            }
        }

        public Xxx.User.SiteAccessRights AccessRights
        {
            get
            {
                return (Xxx.User.SiteAccessRights)this._user.UsersAccessRights;
            }

            set
            {
                this._user.UsersAccessRights = (Int32)value;
            }
        }

        public String Alias
        {
            get
            {
                return this._user.UsersAlias;
            }

            set
            {
                this._user.UsersAlias = value;
            }
        }

        public User(Int32 userID)
        {
            var user = (from u in base.Users
                        where u.UsersID == userID
                        select u).FirstOrDefault();

            if (user != null)
            {
                this._user = user;
            }
            else
            {
                this._user = new Xxx.Entities.User();

                base.Users.InsertOnSubmit(this._user);
            }
        }

        public User(Xxx.User.SiteAccessRights accessRights, String alias)
        {
            var user = (from u in base.Users
                        where u.UsersAccessRights == (Int32)accessRights && u.UsersAlias == alias
                        select u).FirstOrDefault();

            if (user != null)
            {
                this._user = user;
            }
            else
            {
                this._user = new Xxx.Entities.User
                {
                    UsersAccessRights = (Int32)accessRights,
                    UsersAlias = alias
                };

                base.Users.InsertOnSubmit(this._user);
            }
        }

        public void DeleteOnSubmit()
        {
            base.Users.DeleteOnSubmit(this._user);
        }
    }
} 
```

**更新：**

请注意，我的`User`类中有两个构造函数方法。我想将它们转移到`User`实体类*并*在它的数据上下文类上扩展`User`实体类，以便数据上下文可用于“新建”的实体类。

希望这是有道理的。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-21T18:45:14.290

Rick Strahl 有许多非常好的文章，可以解决我认为您正在寻找的内容。在此处查看他的[Linq 文章列表](http://www.west-wind.com/Weblog/ShowPosts.aspx?Category=LINQ)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-21T22:30:59.170

从数据上下文继承实体是一个坏主意。它们是两个离散的对象，旨在以这种方式运行。这样做会导致各种问题，尤其是尝试同时提交一堆相关更改时的所有问题 - 经历多个数据上下文将导致失败，因为每个上下文都试图独立工作。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-21T18:28:28.397

使实体成为 DataContext 的类型似乎没有意义。它不需要是 DataContext 才能被视为业务对象，您也不必创建包含原始实体的类型。最好只扩展实体类并使用组合包含对 DataContext 的引用：

```
namespace Xxx.Entities
{
  public partial class User : IDisposable
   { DataContext ctx;

     public static GetUserByID(int userID)
      {  var ctx  = new DataContext();
         var user = ctx.Users.FirstOrDefault(u=>u.UsersID == userID);

         if (user == null)
          {
             user = new User();
             ctx.Users.InsertOnSubmit(user);
          }

         user.ctx = ctx;
         return user;          
      }      

     public void Dispose() { if (ctx != null) ctx.Dispose(); }
   }
} 
```

如果您只是希望属性名称与数据库列名称不同，请在映射文件中执行此操作。

# c# - 智能数据库搜索

> ID：222909
> 
> 赞同：3
> 
> 时间：2008-10-21T18:21:59.533
> 
> 标签：c#, asp.net, sql-server, web-services, dynamics-sl

问题是有一个包含大约 20k 客户记录的数据库，我想尽最大努力避免重复条目。数据库是 Microsoft SQL Server 2005，维护该数据库的应用程序是 Microsoft Dynamics/SL。我正在创建一个与该数据库交互的 ASP.NET Web 服务。我的服务可以将客户记录插入数据库、从中读取记录或修改这些记录。无论是在我的网络服务中，还是通过 MS Dynamics 或在 Sql Server 中，我都想在用户确认添加新记录之前给出可能匹配的列表。

所以用户会提交一条记录，如果它看起来是唯一的，记录会保存并返回一个新的ID。如果存在可能的重复，则用户可以重新提交并确认说：“是的，我看到了可能的重复，这是一条新记录，我想提交它”。

如果它只是一个标点符号或空格，这很容易（例如，如果您输入“Company, Inc.”并且数据库中有一个“Company Inc.”，但如果有轻微的变化，例如“Company Corp. ” 而不是“Company Inc”，或者如果有一个粗大的拼写错误，例如“Cmpany, Inc.”。是否可以在列表中返回类似的记录？如果绝对不可能，我会处理我的有。如果由于重复而需要合并记录，它只会导致更多的工作。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-21T20:10:39.330

哪种[算法](http://www.cs.sunysb.edu/~algorith/files/approximate-pattern-matching.shtml)最适合您的具体细节在很大程度上取决于您的领域，因此我建议尝试一些不同的算法 - 您甚至可能需要组合一些以获得最佳结果。缩写，尤其是特定领域的缩写，可能也需要进行预处理或标准化。

对于名称，您可能最好使用[语音算法](http://en.wikipedia.org/wiki/Phonetic_algorithm)- 考虑到发音。*这些将使史密斯和施密特得分接近，因为他们在说*这些话时很容易混淆。[Double Metaphone](http://en.wikipedia.org/wiki/Double_Metaphone)是一个不错的首选。

对于胖指法，您可能最好使用[编辑距离](http://en.wikipedia.org/wiki/Edit_distance)算法 - 它会在 2 个单词之间产生“差异”。这些将使 Smith 和 Smith 得分接近 - 即使 2 可能会通过语音搜索。

T-SQL 有 SOUNDEX 和[DIFFERENCE](http://msdn.microsoft.com/en-us/library/ms188753.aspx) - 但它们很差。[Levenshtein](http://en.wikipedia.org/wiki/Levenshtein_distance)变体是规范的选择，但还有其他不错的选择 -如果您找不到适当许可的实现，其中大多数在 C# 中相当容易*实现。*

所有这些都将比 T-SQL 更容易从 C# 编码/使用（尽管我确实在可能在 SQL 中工作[的 T-SQL 的可怕滥用中发现了双重变位](http://www.planet-source-code.com/vb/scripts/ShowCode.asp?txtCodeId=519&lngWId=5)）。

尽管此[示例在 Access 中](http://www.kdkeys.net/forums/thread/6450.aspx)（而且我从未真正查看过代码或使用过实现），但包含的演示文稿可以很好地了解您最终可能需要做什么。该代码可能值得一看，也许是 VBA 的一个端口。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-21T18:28:42.170

查看SQL Server 中的[SOUNDEXing 。](http://msdn.microsoft.com/en-us/magazine/cc163731.aspx)我相信它会给你你正在寻找的可能匹配的模糊性。

[声音@MSDN](http://msdn.microsoft.com/en-us/library/aa259235(SQL.80).aspx)

[声音@维基百科](http://en.wikipedia.org/wiki/Soundex)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-21T18:50:41.567

如果可以将[Lucene.NET](http://incubator.apache.org/lucene.net/)集成到您的解决方案中，您肯定应该尝试一下。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-21T18:32:03.257

您可以尝试使用带有 FreeText（或 FreeTextTable）功能的全文搜索来尝试查找可能的匹配项。

# c++ - 在多线程 C++ 应用程序中，我是否需要互斥锁来保护简单的布尔值？

> ID：222916
> 
> 赞同：17
> 
> 时间：2008-10-21T18:23:13.040
> 
> 标签：c++, multithreading, boolean, mutex, openscenegraph

我有一个多线程 C++ 应用程序，它使用 OpenSceneGraph 库进行 3D 渲染。我计划使用 boost::threads 将 OSG 的渲染循环作为一个单独的线程启动，将包含共享状态的数据结构传递给线程。我试图避免任何过于重量级的东西（如互斥锁）进行同步，因为渲染循环需要非常紧凑，而 OSG 本身试图避免必须锁定。大多数共享状态是在线程启动之前设置的，并且永远不会改变。我确实有一些需要更改的数据，我计划对其进行双重缓冲。但是，我有一个简单的布尔值，用于指示线程暂停渲染，然后恢复渲染，以及另一个来终止它。在这两种情况下，应用程序线程都会设置布尔值，而渲染线程只读取它。我需要同步对这些布尔值的访问吗？据我所知，可能发生的更糟糕的事情是渲染循环在暂停或退出之前继续进行额外的帧。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-10-21T18:25:42.210

在具有标准定义的并发性的 C++11 及更高版本中，`std::atomic<bool>`用于此目的。来自[http://en.cppreference.com/w/cpp/atomic/atomic](http://en.cppreference.com/w/cpp/atomic/atomic)：

> 如果一个线程写入一个原子对象而另一个线程从它读取，则行为是明确定义的（有关数据竞争的详细信息，请参见内存模型）。

* * *

以下旧答案在过去的某个时间对于某些编译器和某些操作环境可能是正确的，但今天不应该依赖它：

~~你是对的，在这种情况下你不需要同步布尔值。不过，您应该声明它们`volatile`，以确保编译器实际上每次都从内存中读取它们，而不是在线程中缓存先前的读取（这是一个简化的解释，但它应该为此目的）。~~

以下问题对此有更多信息： [C++ Thread, shared data](https://stackoverflow.com/questions/118199/c-thread-shared-data)

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-10-21T18:26:12.847

为什么不简单地使用[互锁变量](http://msdn.microsoft.com/en-us/library/ms684122(VS.85).aspx)？

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2017-12-18T13:40:17.650

As for C++11 and later it is finally threads-aware and clearly states that modifying a bool (or other non-atomic variable) in one thread and accessing it at the same time in another one is undefined behavior. In you case using `std::atomic<bool>` should be enough to make your program correct, saving you from using locks.
**Do not use `volatile`**. It has nothing to do with threads. For more discussion look at [Can I read a bool variable in a thread without mutex?](https://stackoverflow.com/questions/47867789/can-i-read-a-bool-variable-in-a-thread-without-mutex)

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-21T18:27:16.947

我认为您在这里**不需要**一个完全成熟的互斥锁——尽管如果您不使用支持等待原语的同步对象，渲染线程将需要在“暂停”状态下忙于等待。

您应该考虑使用各种互锁交换原语（Windows 下的 InterlockedExchange）。不是因为来自布尔的读/写是非原子的，而是为了确保没有奇怪的行为，编译器在单个线程上重新排序内存访问。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-21T18:35:20.193

这个线程有更多关于线程安全的信息和讨论，特别是对于简单的数据类型：

[How can I create a thread-safe singleton pattern in Windows?](https://stackoverflow.com/questions/164496/how-can-i-create-a-thread-safe-singleton-pattern-in-windows)

# wcf - 想要将 WCF Web 服务作为 Windows 服务托管，而不是在 IIS 中托管

> ID：222920
> 
> 赞同：5
> 
> 时间：2008-10-21T18:24:32.023
> 
> 标签：wcf, web-services, iis, windows-services, self-hosting

我想公开一些 Web 服务，但考虑将它们作为 Windows 服务托管，而不是在 IIS 中托管。

这是一个好习惯吗？

如是？如何使其安全？

我想对访问它的用户进行身份验证（针对我们的自定义安全数据库，并且还想确保请求来自我们的业务合作伙伴（X.509 证书？？？？对此没有多大作用）。

感谢您在这方面的指点。

谢谢和问候， 阿杰

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-02-11T16:01:51.813

您可能想阅读[这篇 Microsoft 文章](http://msdn.microsoft.com/en-us/library/bb332338.aspx)，其中清楚地指出了每种托管方法的优缺点，包括：Console/WinForms App、IIS 6 和 7（存在差异）和 Windows 服务。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-21T18:27:58.960

如果您使用的是 IIS6，则在许多情况下都必须使用 Windows 服务。Windows 服务 100% 受支持，并且是托管 WCF 的 100% 安全方式。您可以使用与 IIS 中相同的选项来保护它们。

# php - 在 PHP 中，有没有办法在不使用输出缓冲的情况下将 PHP 文件的输出捕获到变量中？

> ID：222925
> 
> 赞同：9
> 
> 时间：2008-10-21T18:25:27.030
> 
> 标签：php, eval, output-buffering

在 PHP 中，我想将文件读入变量并同时处理文件中的 PHP，而不使用输出缓冲。这可能吗？

本质上，我希望能够在不使用的情况下完成此操作`ob_start()`：

```
<?php
ob_start();
include 'myfile.php';
$xhtml = ob_get_clean();
?> 
```

这在PHP中可能吗？

更新：我想在输出回调中做一些更复杂的事情（不允许输出缓冲）。

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2008-10-23T10:06:28.800

PHP 的一个鲜为人知的特性是能够将包含/必需的文件视为函数调用，并带有返回值。

例如：

```
// myinclude.php
$value = 'foo';
$otherValue = 'bar';
return $value . $otherValue;

// index.php
$output = include './myinclude.php';
echo $output;
// Will echo foobar 
```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-10-21T18:30:16.723

从我在 PHP 文档中可以看出，没有。为什么要避免输出缓冲？

解决这个问题的唯一方法是使用 hacky 方法，包括调用命令行 php 客户端或根据可用内容和特定要求执行 curl 请求。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-21T23:00:18.113

在阅读了大家的建议，阅读了一堆文档并尝试了一些东西之后，我想出了这个：

```
<?php
$file = file_get_contents('/path/to/file.php');
$xhtml = eval("?>$file");
?> 
```

它尽可能接近，但不幸的是它不起作用。`?>`这样做的关键是在文件内容之前包含结束 PHP 位 ( )。这将`eval()`退出 PHP 评估模式，并将文件的内容作为非 PHP 代码处理。然后，如果文件中有 PHP 代码块，这些代码块将被评估为 PHP。令人遗憾的是它不会将评估后的内容保存在变量中，它只是将其输出到页面。

谢谢大家的帮助！

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-21T19:06:44.670

Joeri Sebrechts 是正确的。如果 PHP 脚本可通过 HTTP 访问，则可以使用等效且稍微简单的方法：

```
$data = file_get_contents('http://google.com/'); 
```

应该注意的是，使用输出缓冲在资源上会更容易。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-21T18:31:25.973

向 php 页面发出 curl 请求，本质上是伪装成浏览器。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-21T18:50:03.877

如果文件是本地文件，您可以做的是将脚本作为字符串加载到变量中，然后在字符串上运行 eval 。然后你可以在之后做所有其他的事情。否则，您必须使用输出缓冲。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-21T22:52:09.720

```
$fileData = file_get_contents('fileOnDisk.php');
$results = eval($fileData); 
```

但是请查看 eval 上的文档，因为您实际上必须让您调用的文件返回其结果，而不仅仅是回显它们：

[http://us2.php.net/eval](http://us2.php.net/eval)

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2014-10-30T15:23:01.443

黑客警报！您可以使用一些hackery 方法自己对PHP 进行评估，`preg_replace_callback`以搜索和替换PHP 块。

```
function evalCallback($matches)
{
    // [0] = <?php return returnOrEcho("hi1");?>
    // [1] = <?php
    // [2] = return returnOrEcho("hi1");
    // [3] = ?>
    return eval($matches[2]);
}

function evalPhp($file)
{
    // Load contents
    $contents = file_get_contents($file);
    // Add returns
    $content_with_returns = str_replace(
                               "returnOrEcho"
                              ,"return returnOrEcho"
                              ,$contents);
    // eval
    $modified_content = preg_replace_callback(
                              array("|(\<\?php)(.*)(\?\>)|"
                             ,"evalCallback"
                             ,$content_with_returns);
    return $modified_content;
} 
```

您必须修改包含的 PHP 文件以使用`returnOrEcho`函数，以便在这种情况和正常情况下可以重载它。在这种情况下，您希望`return`它以您想要的方式被接收`eval`，但正常情况是`echo`没有返回。

因此，对于这种情况，您将定义：

```
function returnOrEcho($str)
{
    return $str;
} 
```

对于正常情况，您将定义：

```
function returnOrEcho($str)
{
    echo $str;
} 
```

在您包含的 PHP 文件（或视图文件）中，您将拥有如下内容：

```
<?php returnOrEcho("hi1");?>
<?php returnOrEcho("hi3"."oo");?>
<?php returnOrEcho(6*7);?> 
```

我无法让`preg_replace_callback`内联回调工作，所以我使用了一个单独的函数，但是有一个如何做到这一点的示例：[preg_replace_callback() - Calback inside current object instance](https://stackoverflow.com/questions/11164563/preg-replace-callback-calback-inside-current-object-instance)。

# computer-science - 老年人计算机科学

> ID：222937
> 
> 赞同：14
> 
> 时间：2008-10-21T18:28:53.513
> 
> 标签：computer-science, terminology, language-theory

当它是带有类的 C 时，我学习了 C++。我发现自己越来越不喜欢 XML 和垃圾收集等新技术。另一方面，我发现了像 Lua 和 Python 这样的脚本语言。而且我发现自己更喜欢 C++ 的混合环境，具有确定性内存控制、嵌入式脚本语言、垃圾收集和所有相关功能。

我的问题是，在尝试学习这些语言时，我发现自己遇到了一些我不熟悉的术语：lambdas、闭包等。

有哪些在线资源可供老年人了解这些内容？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-10-21T18:32:30.760

[Structure and Interpretation of Computer Programs](http://mitpress.mit.edu/sicp/full-text/book/book.html)以及[随之而来的讲座](http://groups.csail.mit.edu/mac/classes/6.001/abelson-sussman-lectures/)很好地介绍了函数式编程（使用 Scheme），其中许多术语都是从那里来的。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-10-21T18:31:20.870

尽管说起来让我很恼火，但[维基百科](http://www.wikipedia.org)是一个很好的起点。通常有详细的文章以及其他站点上其他定义的链接，以及[Code Project](http://www.codeproject.com)等地方的示例。

[搜索Stack Overflow](http://stackoverflow.com)也非常值得！

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-10-21T18:53:01.390

斯坦福有一些优秀的在线计算机科学课程

[http://see.stanford.edu/SEE/Courses.aspx](http://see.stanford.edu/SEE/Courses.aspx)

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-10-21T18:50:45.183

如果您正在寻找更广泛、更深入的方法，请查看 MIT 的 OpenCourseware。

“MIT OpenCourseWare (OCW) 是几乎所有 MIT 课程内容的网络出版物。OCW 是开放的，可供全世界使用，是 MIT 的一项永久性活动。”

[http://ocw.mit.edu/OcwWeb/web/courses/courses/index.htm#ElectricalEngineeringandComputerScience](http://ocw.mit.edu/OcwWeb/web/courses/courses/index.htm#ElectricalEngineeringandComputerScience)

与您的问题相关，“计算机科学与编程导论”课程使用 Python。还提供了数十种其他课程，并且在非洲大陆的不同机构中提供了更多课程。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-03-01T12:32:07.180

我认为您不需要再次学习所有那些（相当理论的）CS 课程。只需使用 wikipedia 并查看 Python 文档。对于现代 C++，我建议您查看 C++ faq lite（只需 google 一下）。

# java - 如何使用 Java (Swing) 获取标题栏的高度？

> ID：222940
> 
> 赞同：9
> 
> 时间：2008-10-21T18:29:17.833
> 
> 标签：java, swing, user-interface

我正在使用`MouseEvent`Java。该`getPoint()`方法是将标题栏的高度添加到坐标的 y 部分。

我想知道如何找到当前窗口标题栏的高度，以便将 y 值偏移正确的量。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-21T18:46:51.153

您可以通过调用 getInsets 方法（在 Container 中定义）找到框架插图。Frame insets 在 Frame API 文档的顶部进行了讨论。[看到这个问题。](https://stackoverflow.com/questions/193457/getting-drawable-area-of-an-awt-frame-in-mac-os-x)

当然，您始终可以将鼠标侦听器添加到内容窗格。JFrame 在某些方法（例如`add`和）上有一些意外行为`setLayout`。

# iphone - 使用带有小型表格的 UITableViewController？

> ID：222956
> 
> 赞同：15
> 
> 时间：2008-10-21T18:33:21.350
> 
> 标签：iphone, objective-c, cocoa-touch, uitableview

使用 UITableViewController 时，initWithStyle: 方法会根据文档自动创建具有“正确尺寸”的底层 UITableView。

我的问题是这些“正确的尺寸”看起来是 320x460（iPhone 的屏幕尺寸），但我将这个 TableView/Controller 对推入一个 UINavigationController 中，它本身包含在一个 UIView 中，它本身大约是屏幕高度的一半。

我能想出的任何框架或边界争论似乎都无法正确重置表格的大小，因此它“太长”，这意味着有一组行被推离屏幕底部并且不可见或无法通过滚动。

所以我的问题归结为：告诉 UITableViewController 将其组件 UITableView 调整为指定矩形的正确方法是什么？

谢谢！

**更新**我尝试了这里建议的所有技术都无济于事，但我确实发现了一件有趣的事情：如果我完全避开 UINavigationController（我还不愿意为生产做这件事，但作为一个实验），并添加表视图作为我提到的封闭视图的*直接子视图，给定的框架大小**是受尊重的*。在我将 UINavigationController 重新引入组合的**那一刻**，无论它是在表视图之前还是之后添加为子视图，无论是在表视图作为子视图添加之前还是之后分配/初始化它，结果和以前一样。

我开始怀疑 UINavigationController 不是一个团队合作者......

**更新 2**在屏幕上的表格视图之后检查帧大小的建议是一个很好的建议：结果导航控制器实际上在加载和显示之间的某个时间调整它的大小。我的解决方案，充其量是 hacky，一直缓存加载时给出的帧，如果在 tableView:cellForRowAtIndexPath: 的开头发生更改，则将其重置。你为什么在那儿问？因为这是我发现的一个有效的地方，这就是为什么！

我不认为这是一个解决方案，因为它显然不合适，但为了其他任何阅读者的利益，它似乎确实有效。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-10-21T18:38:58.720

为什么不直接使用常规 UIViewController 并手动创建表格？

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-05-28T21:50:53.433

我有同样的问题，我用以下方法解决了它：

```
-(void) loadView {
    [self setView:[[[UIView alloc] initWithFrame:CGRectZero] autorelease]];
    [[self view] setAutoresizesSubviews:NO];

    /* Create & configure table and other views... */

    [self setResultsTable:[[RadarTableViewController alloc] initWithNibName:nil bundle:nil]];
    [[resultsTable view] setFrame:CGRectMake(0,45,320,200)];
} 
```

这是在父控制器（在我的例子中只是一个普通的 UIViewController）控制器中完成的。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-05-01T10:30:51.920

我遇到了同样的问题，我通过在 UITableViewController 的 viewDidAppear 函数中调整 tableView 的大小来解决它。不是理想的解决方案，但它有效。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2012-05-14T06:44:27.877

您可以使用以下方法设置上边距：

```
 UIEdgeInsets inset = UIEdgeInsetsMake(50, 0, 0, 0);
    self.tableView.contentInset = inset; 
```

这不是一个好习惯，以防万一你想要更多的顶部空间，你可以使用它。

**不应该使用 UITableViewController ，只需简单地使用 UIViewController 并以编程方式创建 UITableview**

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-21T19:22:15.637

我不确定你为什么要为你的表创建一个额外的视图控制器。但是，在您的代码中，我没有看到您将表格视图添加到其父级。您也可以尝试降低边界高度，直到整个东西出现在屏幕上；一旦你这样做了，它可能会让你了解为什么它没有按照你期望的方式工作。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-21T18:45:33.963

我同意本的回答。由于视图上的其他控件，我经常遇到需要调整 UITableVIew 大小的情况。

我通常只有一个带有 UITableView IBOutlet 的常规 UIViewController。然后，如果需要，我可以操纵 UITableView 对象的框架以使其达到我需要的大小。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-21T21:05:04.383

检查 UITableView 的 autoresizingMask 和 contentMode 属性。这些都会影响框架。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2014-04-16T05:07:09.510

我用这段代码解决了这个问题

```
{
    UIEdgeInsets insets;
    insets.left = 0;
    insets.right = 0;
    insets.top = 0;
    insets.bottom = 60;
    self.tableView.contentInset = insets;
    [self.tableView setScrollIndicatorInsets:insets];
} 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-23T17:53:23.490

如果您使用的是 Interface Builder，您可以简单地转到“表格视图大小”属性窗口，然后将 Content 和 Scroller 的底部插入更改为另一个小部件的高度。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2013-09-26T19:51:31.773

尝试：

```
self.edgesForExtendedLayout = UIRectEdgeNone;

//This one in case your NavigationController is not Translucent
self.extendedLayoutIncludesOpaqueBars = NO; 
```

希望这可以帮助。

* * *

## 回答 #11

> 赞同：-2
> 
> 时间：2012-06-14T04:58:25.157

将框架设置在`UINavigationController`.

# javascript - 在 Javascript 中使用 addEventHandler 的安全、通用方式？

> ID：222957
> 
> 赞同：6
> 
> 时间：2008-10-21T18:33:23.707
> 
> 标签：javascript, events, dom, attachevent

在深入探讨这个问题的细节之前，我想先说明一下情况。我们的网络分析公司是大型网站的顾问，并且（除了添加单个 SCRIPT 标签）我们无法控制页面本身。

我们现有的脚本使用“旧”方式安装处理程序（element.onclick = blah 的花哨版本；它也执行原始处理程序）完全不知道页面上的“新”（addEventListener 或 attachEvent）处理程序。我们想解决这个问题，使我们的脚本能够在更多站点上运行，而无需进行太多自定义开发。

这里最初的想法是让我们自己的脚本使用 addEventListener/attachEvent，但这会带来一个问题：客户端的站点使用“旧”方式设置处理程序，它会清除我们安装“新”方式的处理程序。快速而肮脏的测试表明这在 IE7 和 FF3 中都会发生，尽管我没有测试整个浏览器范围。还有一个风险是，如果我们在页面的事件处理程序已经设置后使用“新”方式，我们可能会删除它们的处理程序。

所以我的问题是：我可以使用什么安全技术来使用 addEventListener/attachEvent 在 Javascript 中添加事件处理程序，无论页面上的其他事件处理程序是如何安装的，它都可以工作？

请记住：我们无法修改安装我们脚本的站点。（我必须强调，因为对此类问题的默认答案始终是，“只需重写页面，以相同的方式完成所有操作。”）

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-21T18:46:26.817

你能再试试你的快速和肮脏的测试吗？这在FF3中不会发生在我身上。

```
elem.onclick = function() { alert("foo"); };
elem.addEventListener("click", function() { alert("bar"); }, false); 
```

当我单击元素时，两个处理程序都会为我触发。

I'm guessing you forgot the final boolean argument in `addEventListener` (whether to use the capture phase). I'm also guessing you forgot that IE's `attachEvent` needs `onclick`, not `click`.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-21T18:37:27.503

addEventListener/attachEvent 在你问的意义上是安全的。他们将新的事件处理程序添加到节点，而不会更改以前添加到它的任何处理程序（即使曾经通过属性 onxxx 分配）。对于使用 addEventListener/attachEvent 将一些内容带到外国页面的公司，必须是唯一的做法。通过属性分配 onxxx 处理程序确实会破坏托管页面 scipts（以前以相同的方式分配）

# iis - 我的图片要求输入本地网络的密码（在 ASP/IIS 下）

> ID：222967
> 
> 赞同：1
> 
> 时间：2008-10-21T18:38:02.573
> 
> 标签：iis, authentication, asp-classic

不太清楚如何解决这个问题。我正在维护一个 ASP 站点，它大部分是静态的，但是有一个包含页面，它带来了菜单。

就在最近我替换了一些图像，但现在当我尝试该站点时，我收到一个输入密码的提示，就好像它在本地网络上寻找东西一样！

我检查了，所有图像路径都正确写入，所有图像都未阻止（W2k3 安全功能）并且所有图像都设置为允许所有用户...但是，我仍然收到密码提示！

这是它发生的示例页面：http: [//www.iossolution.com/company/aboutus.asp](http://www.iossolution.com/company/aboutus.asp)（似乎仅限于Windows）

谢谢。

/mp

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-21T18:45:48.470

毛里奇奥帕斯特拉纳，

检查相应的用户是否对 windows 文件系统中的文件具有权限。对于 W2K3 和 IIS6，我认为该用户通常是网络服务。

还要检查 images 目录是否在 IIS 中具有预期的身份验证设置。您可能希望选中“启用匿名访问”复选框并选中“集成 Windows 身份验证”框。您可能还需要确保 IUSR_SERVERNAME 用户有权访问图像。

祝你好运！

# web-applications - 网络上的可扩展性

> ID：222970
> 
> 赞同：11
> 
> 时间：2008-10-21T18:38:33.383
> 
> 标签：web-applications, scalability

我一直在和大学里的一些朋友争论，我们无法确定哪个框架对 Web 应用程序具有更高的可扩展性（并且仍然非常快）。

一个调用jsp，另一个调用ruby，另一个调用php，以此类推。我能否请您澄清一下什么是更具可扩展性的潜力？

Tks，希望我没有重复我搜索过的任何内容，但没有发现任何以前的问题。

编辑：如果您可以对此进行比较，那就太好了:)

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2008-10-21T18:59:19.927

Ruby 和 PHP 不是 webapp 框架。它们是在 Web 开发中流行的编程语言。

一般来说，webapp 的可扩展性不是编程语言的属性，给定的 webapp 框架最多*不会妨碍*可扩展性。良好的可扩展性更多是应用程序设计的属性。

有太多的 webapp 框架无法进行逐点比较，这简直就是百科全书。

此外，您可以通过多种方式处理给定应用程序的可伸缩性。一种方法是定义明确且狭窄的范围，并以出色的原始性能为目标，这样一台机器就可以服务于无数个工作单元。最好的例子是[Mailinator](http://www.mailinator.com/)。

另一种方法是通过“仅”添加更多硬件来更轻松地服务于不断增加的负载。几乎任何数据库支持的 webapp 框架都可以通过这种方式扩展：只需在负载均衡器和共享数据库后端之间添加更多应用程序服务器。如果您以这种方式解决问题，您主要关心的是设计应用程序以最小化 1\. 数据库争用 2\. 数据库负载。

最后一种方法是将系统设计为一路疯狂并行。谷歌就是最好的例子。

总而言之：语言或框架不会产生可扩展的应用程序，软件架构师会。

编辑：要清楚，我的答案是关注*可扩展性*，即在不改变设计的情况下处理不断增加的负载的能力。这是与执行速度不同的属性。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-21T18:50:42.173

算法将比使用的语言更重要的可扩展性。

也就是说，语言之间的执行速度会有差异。我相信 Java（Servlet 和 JSP 编译成 servlet，即本机代码）会比 Ruby 和 PHP 快一些）。还有大量用于 Java 的 Web 框架将鼓励您以最佳方式来实现可伸缩性。

还要设计您的应用程序，以便它可以在负载均衡器后面愉快地运行，并且可扩展性变得容易得多:) 然而，这不是我的专业领域。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-21T18:56:16.920

您还可以查看“[什么更快？PHP vs ASP vs JSP vs CGI 等](https://stackoverflow.com/questions/153947/whats-faster-php-vs-asp-vs-jsp-vs-cgi-etc)”

我认为 Java/Java EE 是唯一从头开始设计用于开发分布式/集群应用程序的“框架”，它鼓励从规范（EJB、JTA ...）中实现它的良好实践。

但像往常一样，这取决于。这类问题往往会引发战争:)

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-21T21:47:59.087

Web 框架的可扩展性是一个有点过分思考的问题（有人会说 p155ing 竞赛）。除非您获得巨额资金（这些天祝您好运）并且可以确保每天有数百万访问者，所有这些框架都可以很好地处理它（ASP.NET 也可以）。

就我个人而言，我总是会选择 ASP.NET。它与任何东西一样可扩展，并拥有最好的开发工具。唯一的缺点是托管和操作系统成本。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2013-03-28T16:26:16.957

（五年后...）

我发现这篇博客文章对多种语言相关的 Web 框架进行了基准测试。现在这几乎回答了我在 2008 年提出的问题。

[http://www.techempower.com/blog/2013/03/28/framework-benchmarks/](http://www.techempower.com/blog/2013/03/28/framework-benchmarks/)

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-10-21T21:33:33.420

我不确定您提到的任何框架都会严重阻碍可伸缩性。

这一切都取决于实施。

我会先集中精力让您的 Web 应用程序运行良好，然后在它成为问题时担心可扩展性。换句话说，“当我们到达它时，让我们越过那座桥”。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-10-21T21:34:57.863

答：C ISAPI dll（或自定义 apache 模块）:)

即使这样，Web 服务器的开销、解析 http 请求和提供 html 页面也使得应用程序的执行时间几乎无关紧要。如果您将应用程序作为 CGI 应用程序运行，那么预计性能会更低。

对于 Web 中的可扩展性，您实际上是在谈论添加更多服务器和负载平衡，通过将数据库（如果大量使用）放在单独的服务器上来减轻服务器的负载。

这些语言的原始性能几乎不用担心。使用您想要使用的那个，您将最有效率地使用它。担心您会遇到的其他问题 - 网络 io、安全性、正确性。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-21T21:47:53.813

已经有几个优点了。我的主要观点是：一个对 python 了如指掌的人可能能够使用 python 编写比使用 Java 更具可扩展性的代码。并且有许多大型网站使用您提到的所有技术，所以我认为这两种方式都没有任何大的优势。

在大多数情况下，你应该坚持你熟悉的东西，除非有一个真正重要的理由去另一种方式。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2013-09-18T18:01:25.723

我碰巧遇到了这个问题，并注意到有些人谈论速度，其他人谈论可扩展性。我写了一篇博客文章解释了差异：

[http://www.fransekman.com/scalability-or-performance-what-do-you-mean/](http://www.fransekman.com/scalability-or-performance-what-do-you-mean/)

“高扩展性网站是一个网站，当负载增加时，可以通过增加更多容量来维持其性能水平”。这可以在任何编程语言和几乎任何框架中实现。一些框架具有内置功能，这可能会使一些常见的可伸缩性事物更快地实现。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-10-21T18:53:18.173

编译型语言通常比解释型语言运行得更快，所以我认为 Ruby 和 PHP 从八球后面开始，但这实际上取决于你如何使用语言以及如何构建代码。

所有语言都有自己的最佳实践和模式来构建可扩展的应用程序，并且通常会根据提议的应用程序的功能进行妥协。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-11-21T16:14:18.637

如果你想知道各大网站如何使用 LAMP 来实现可扩展性，你应该看看[数据库分片](http://www.codefutures.com/database-sharding/)。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2010-08-16T15:54:17.833

与站点架构相比，Web 框架的选择对可扩展性（扩展能力）的影响较小。大多数现代 Web 框架都非常适合扩展，因此真正需要注意的是您的部署设置。

# c# - 服务边界处的 WCF 错误日志记录

> ID：222972
> 
> 赞同：4
> 
> 时间：2008-10-21T18:39:02.963
> 
> 标签：c#, wcf, exception, error-handling

我正在尝试在我的 WCF 服务中实现一个 IErrorHandler，以便在将其传递给客户端之前记录每个到达服务边界的异常。我已经使用 IErrorHandlers 将 Exceptions 转换为类型化的 FaultExceptions，这非常有用。根据 IErrorHandler.HandleError() 的 MSDN，它还旨在用于边界处的日志记录。

问题是，不能保证在操作线程上调用 HandleError 函数，所以我不知道如何获取有关哪些操作触发了异常的信息。我可以从异常本身中获取 TargetSite，但这给了我内部方法而不是操作。我还可以解析 StackTrace 字符串以找出它被抛出的位置，但这似乎有点脆弱和做作。在 HandleError 函数中是否有任何一致的、受支持的方式来获取任何状态信息（消息、操作描述等）？或任何其他自动记录服务调用异常的方法？

我正在寻找一种使用我现有的日志框架在生产中实施的解决方案，所以 SvcTraceViewer 不会为我做这件事。

谢谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-20T18:41:38.683

我最终将日志记录放在 IErrorHandler.ProvideFault() 而不是 IErrorHandler.HandlerError() 中。ProvideFault 调用是在操作线程中进行的，因此我可以使用 OperationContext.Current 来获取一些要记录的信息。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-22T02:44:50.080

我以与您描述的方式相同的方式使用 IErrorHanlder，但不适用于日志记录。相反，在服务类（WCF 与否）上，我使用[此处](http://ayende.com/Blog/archive/2008/07/31/Logging--the-AOP-way.aspx)描述的拦截器。我相信这种技术会捕捉到你感兴趣的信息。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-12-19T21:31:48.337

您可以在操作线程上调用的 ProvideFault 方法中存储登录异常数据字典所需的任何上下文信息……然后在 HandleError 方法中引用它以进行记录。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-22T03:10:30.497

您是否使用过[服务跟踪查看器](http://msdn.microsoft.com/en-us/library/ms732023.aspx)？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-06-19T03:42:06.767

正在传入调用线程上调用 ProvideFault() 操作，并且客户端仍被阻塞等待响应。我认为在此方法中添加冗长的过程（如日志记录）并不是一个好主意。这就是为什么他们暴露了另一个操作 HandleError ，该操作在单独的工作线程上被调用。

但我理解你的情况。如果您找到了除登录 ProvideFault 之外的解决方案，请分享。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-06-22T12:21:31.973

如何创建一个实例并将请求消息保存在该实例上？

# html - 为什么带有 ID 表单的 DIV 会下降到相邻 DIV 下方？

> ID：222981
> 
> 赞同：-3
> 
> 时间：2008-10-21T18:43:55.760
> 
> 标签：html, css

我无法`form`在我的布局中正确定位 div。

通过查看我的 div 位置和下面的 css，有没有人知道我可能做错了什么？

```
#floorplans {
  float: left;
  height: 165px;
  width: 203px;
  border-right: 1px solid #FFFFFF;
  border-bottom: 1px solid #FFFFFF;
  position: relative;
  background: #FFFFFF url(https://lorempixel.com/320/170/) no-repeat;
  padding-top: 14px;
  padding-left: 20px;
  display: block;
  color: #000000;
  line-height: 1.5em;
  padding-right: 10px;
}

#development {
  float: left;
  height: 165px;
  width: 204px;
  border-right: 1px solid #FFFFFF;
  border-bottom: 1px solid #FFFFFF;
  position: relative;
  background: #FFFFFF url(https://lorempixel.com/204/165/) no-repeat;
  padding-top: 14px;
  padding-left: 20px;
  display: block;
  color: #000000;
  line-height: 1.5em;
  padding-right: 10px;
}

#projects {
  background: #FFFFFF url(https://lorempixel.com/153/127/) no-repeat;
  height: 127px;
  width: 153px;
  text-align: left;
  padding-left: 300px;
  color: #333333;
  padding-top: 25px;
  display: block;
  float: left;
  position: relative;
  line-height: 1.5em;
  font-size: 10px;
  padding-right: 15px;
  clear: left;
}

#form {
  background: #990000 url(https://lorempixel.com/450/309/) no-repeat;
  float: left;
  height: 309px;
  width: 450px;
  position: relative;
  padding-top: 20px;
  padding-left: 30px;
  padding-right: 30px;
  color: #FFFFFF;
}
```

```
<div id="wrapper">
  <div id="logo"></div>
  <div id="topnav"></div>
  <div id="nav">
    <ul>
      <li><a href="#">link</a></li>
      <li><a href="#">link2</a></li>
      <li><a href="#">link3</a></li>
      <li id="last"><a href="#">link4</a></li>
    </ul>
  </div>
  <div id="gallery"></div>
  <div id="floorplans"></div>
  <div id="development"></div>
  <div id="projects"></div>
  <div id="form">
    <div>
    </div>

    <div id="footer"></div>
  </div>
```

您会注意到 div`form`正在下降。我应该怎么做才能让事情排队？我应该修改 div 的位置吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-21T18:51:29.193

表单`div`的顶部与`div`它之前的顶部一致。`clear:left;`on`#projects`移动`#projects`到下一行（好），以及以下内容（坏）。尝试负上边距，或考虑将 HTML 重组为放在`#form`前面`#projects`。

添加以下内容应该可以工作：

```
#form {
    margin-top:-180px;
}
#projects {
    border-right: 1px solid #FFFFFF;
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-21T18:47:36.737

因为您有两个块（FLOORPLANS 和 DEVELOPMENT INFO），每个块都有一个边框，所以它们现在太宽而不能放在表单块旁边。通过删除一个或两个边框并查看表单是否会弹回那里来测试这一点。

请注意，负边距通常在 IE6 中存在问题，请务必检查任何解决方案。

# c# - 在gridview asp.net c#中创建超链接

> ID：222988
> 
> 赞同：5
> 
> 时间：2008-10-21T18:46:00.780
> 
> 标签：c#, asp.net, linq

我的代码在 c# asp.net 3.5 中

在以下代码中，“Msg”包含许多带有空格和字符的单词（例如：无法准备同步收藏夹：目录不存在：\STL-FNP-02\ryounes$\Sync\Favorites）。这个“消息”从数据库中拉到一个网格视图。我无法在 gridview 中为此“Msg”创建超链接。由于它有空格，因此不会创建超链接。

我需要为这个“消息”创建超链接，然后在 linq 查询中使用它。

我认为一个人可以使用 eval 或 url 编码器。我不知道该怎么做。任何人都可以说如何去做吗？

```
 <asp:HyperLinkField DataTextField="Msg" HeaderText="Msg" DataNavigateUrlFields="Msg"   
  DataNavigateUrlFormatString="Sync.aspx?Msg={0}" /> 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-21T19:00:06.227

解决它的最简单方法是使用类似的东西

```
<asp:TemplateField HeaderText="Msg"> 
    <asp:HyperLink runat="server" Text='<%# HttpUtility.UrlEncode(Eval("Msg")) %>' NavigateUrl='<%#Eval("Msg")%>' />
</asp:TemplateField> 
```

不是 100% 确定语法是正确的，但你明白了一般的想法

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-21T18:49:14.003

它不会创建链接，因为它不是有效的 URL，而不是使用超链接列，您很可能需要迁移到模板并自己管理它，或者至少对其进行一些格式化。

无论将其设为超链接，我都会保持谨慎，它会在哪里消失？

如果根据您应该去的消息有一个特定的地方，请在绑定到网格之前计算...

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-21T18:50:56.823

听起来您需要对字符串进行 url 编码，以便单词和空格可以作为查询字符串中的一个变量存在。看看这个功能：http: [//msdn.microsoft.com/en-us/library/zttxte6w.aspx](http://msdn.microsoft.com/en-us/library/zttxte6w.aspx)

# c# - 为什么在 BinaryReader 上调用 Dispose() 会导致编译错误？

> ID：222996
> 
> 赞同：2
> 
> 时间：2008-10-21T18:48:30.587
> 
> 标签：c#, .net

我有以下类在内部使用 BinaryReader 并实现 IDisposable。

```
类 DisposableClass : IDisposable
    {
        私人 BinaryReader 阅读器；
        公共 DisposableClass（流流）
        {
            reader = new BinaryReader(stream);
        }

        protected virtual void Dispose(bool disposing)
        {
            如果（处置）
            {
                ((IDisposable)reader).Dispose();
// reader.Dispose();// 这不会编译
            }
        }

        公共无效处置（）
        {
            this.Dispose(true);
        }
    }

```

我已经知道我需要将 BinaryReader 转换为 IDisposable 才能对其调用 Dispose，但我不明白为什么我不能直接调用 Dispose() 方法而不转换为 IDisposable？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-21T18:52:27.553

它不起作用，因为`Dispose`on 方法`BinaryReader`已被显式实现。

而不是隐式实现，如：

```
public void Dispose()
{
} 
```

...它已被明确实施，如：

```
void IDisposable.Dispose()
{
} 
```

...这意味着它只能通过`IDisposable`接口访问。因此，您必须`IDisposable`先将实例强​​制转换为。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-21T19:32:35.803

[在这里](https://stackoverflow.com/questions/222996/why-calling-dispose-on-binaryreader-results-in-compile-error#223020)扩展我的评论，`BinaryReader`该类没有正确实现 Dispose 模式。

在 Reflector 中查看这个类，它看起来像这样（对于 .NET 3.5）：

```
public class BinaryReader : IDisposable
{
    public virtual void Close()
    {
       this.Dispose(true);
    }
    protected virtual void Dispose(bool disposing)
    {
       if (disposing)
       {
          Stream stream = this.m_stream;
          this.m_stream = null;
          if (stream != null)
          {
             stream.Close();
          }
       }
       this.m_stream = null;
       this.m_buffer = null;
       this.m_decoder = null;
       this.m_charBytes = null;
       this.m_singleChar = null;
       this.m_charBuffer = null;
   }
   void IDisposable.Dispose()
   {
      this.Dispose(true);
   }
} 
```

这里的问题是，通过实现`IDisposable.Dispose()`显式接口，它会强制开发人员调用`Close()`而不是`Dispose()`.

在这种情况下，我们遇到了语义不平衡的情况。从来没有调用“打开”阅读器，因此“关闭”阅读器并不直观。

更进一步，为了调用 Dispose() 您必须显式转换为`IDisposable`，这不是您通常需要做的事情。您确实可以选择`Dispose(bool)`直接调用，但您怎么知道布尔参数应该是什么？

为了正确遵循该模式，它应该被实现为：

```
public class BinaryReader : IDisposable
{
    public virtual void Close()
    {
        Dispose(true);
        GC.SuppressFinalize(this);
    }
    protected virtual void Dispose(bool disposing)
    {
       if (disposing)
       {
          Stream stream = this.m_stream;
          this.m_stream = null;
          if (stream != null)
          {
             stream.Close();
          }
       }
       this.m_stream = null;
       this.m_buffer = null;
       this.m_decoder = null;
       this.m_charBytes = null;
       this.m_singleChar = null;
       this.m_charBuffer = null;
   }
   public void Dispose()
   {
      this.Close();
   }
} 
```

这将允许您调用`Close()`或`Dispose()`，在这种情况下，任一调用都会继续导致调用`Dispose(true)`。`Close()`（这与通过调用或实际实现的流程相同`((IDisposable)reader).Dispose()`）。

幸运的是（或者不幸的是，取决于您选择查看它的方式），因为`BinaryReader`确实实现了`IDisposable`在 using 语句中允许的接口：

```
using (BinaryReader reader = new BinaryReader(...))
{
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-21T22:34:02.537

实际上，他们选择使用 Close() 而不是 Dispose() Dispose 已明确实现。这就是为什么你看不到它。

但是 Close 与 dispose 做同样的事情，这是他们希望您使用的方法。Reflector 为 Close 方法提供了以下反汇编

```
public virtual void Close()
{
    this.Dispose(true);
} 
```

使用 Close() 是因为它是二进制阅读器上下文中更好的单词选择。

# asp.net - 如何在回发中保留变量

> ID：222999
> 
> 赞同：24
> 
> 时间：2008-10-21T18:48:58.073
> 
> 标签：asp.net, vb.net

我创建了一个页面（带有.vb后面的代码）并创建了Public intFileID As Integer

在页面加载中，我检查查询字符串并在可用时分配它或设置 intFileID = 0。

```
Public intFileID As Integer = 0

Protected Sub Page_Load(ByVal sender As Object, ByVal e As System.EventArgs) Handles Me.Load
    If Not Page.IsPostBack Then
        If Not Request.QueryString("fileid") Is Nothing Then
            intFileID = CInt(Request.QueryString("fileid"))
        End If

        If intFileID > 0 Then
            GetFile(intFileID)
        End If
    End If
End Sub

Private Sub GetFile()
    'uses intFileID to retrieve the specific record from database and set's the various textbox.text
End Sub 
```

Submit 按钮有一个单击事件，它根据 intFileID 变量的值插入或更新记录。我需要能够在回发时保持该值，以使其全部正常工作。

该页面只是在 SQL 数据库中插入或更新一条记录。我没有使用 gridview、formview、detailsview 或任何其他 rad 类型的对象，它们本身会保留键值，我不想使用它们中的任何一个。

如何在不创建可能更改的 HTML 内容的情况下保留 intFileID 中设置的值。

**[编辑] 更改 Page_Load 以使用 ViewState 来保存 intFileID 值**

```
Protected Sub Page_Load(ByVal sender As Object, ByVal e As System.EventArgs) Handles Me.Load
    If Not Page.IsPostBack Then
        If Not Request.QueryString("fileid") Is Nothing Then
            intFileID = CInt(Request.QueryString("fileid"))
        End If

        If intFileID > 0 Then
            GetFile(intFileID)
        End If

        ViewState("intFileID") = intFileID
    Else
        intFileID = ViewState("intFileID")
    End If
End Sub 
```

* * *

## 回答 #1

> 赞同：43
> 
> 时间：2008-10-21T18:57:09.087

As others have pointed out, you can store it in the Session or the ViewState. If it's page specific, I like to store it in the ViewState as opposed to the Session, but I don't know if one method is generally preferred over the other.

In VB, you would store an item in the ViewState like:

```
ViewState(key) = value 
```

And retrieve it like:

```
value = ViewState(key) 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-21T18:53:41.560

Store in:

*   Session
*   ViewState
*   Hidden input

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-10-21T18:59:54.777

Just to summarize what is said above.

You can use Session, Viewstate, or a hidden field.

I personally prefer viewstate as it will work in web farm environments, Session does not, it does not store it on the server waiting for the user, for up to 20 minutes to be removed, and in general viewstate is the place to be for page level data.

You can use a hidden field, but then a user could more easily modify it.

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-10-21T18:50:13.797

Store it in the Session.

```
Page.Session["MyPage_FileID"] = intFileID 
```

You'll need to have logic that manages it as the user navigates around, but if it is always set when the page loads from a GET (or you clear it, if not available on GET) then you should be ok using it later from the Session on your submit PostBack.

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-21T18:58:46.637

Remember:

Each time your server code runs, it's in a brand new instance of your page class. That's for every postback.

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-21T19:27:46.077

Actually, since an ASP.NET page postbacks to itself - including the query string - you could just remove the `If Not Page.IsPostBack` condition. Then it'd set itself on each postback.

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-22T20:46:55.950

I personally would choose to store the value in control state instead of viewstate as viewstate can easily be switched off. ControlState will persist even if viewstate is switched off for any reason. I have included an example on how this may be done.

```
Private intFileId As Integer = 0

Public Property FileID() As Integer
    Get
        Return intFileId
    End Get
    Set(ByVal value As Integer)
        intFileId = value
    End Set
End Property

Protected Overrides Function SaveControlState() As Object
    Dim objState(2) As Object
    objState(0) = MyBase.SaveControlState()
    objState(1) = Me.FileID
    Return objState
End Function

Protected Overrides Sub LoadControlState(ByVal savedState As Object)
    Dim objState() As Object
    objState = savedState
    MyBase.LoadControlState(objState(0))
    Me.FileID = CInt(objState(1))
End Sub

Protected Sub Page_Init(ByVal sender As Object, ByVal e As System.EventArgs) Handles Me.Init
    Me.Page.RegisterRequiresControlState(Me)
End Sub

Protected Sub Page_Load(ByVal sender As Object, ByVal e As System.EventArgs) Handles Me.Load

    If Not Page.IsPostBack Then
        If Not String.IsNullOrEmpty(Request.QueryString("fileid")) Then
            Me.FileID = CInt(Request.QueryString("fileid"))
        End If
    End If

    Response.Write(Me.FileID.ToString())
End Sub 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2016-01-23T10:13:30.163

> `Session["KeyName"] = your value;`
> 
> 1.  Type cast to the type to retrieve and store the data from session like given below :
> 
> `Datatable dt = (DataTable)(Session["KeyName"]);`

or

> `ViewState["KEY"]= value;`
> 
> 2.  Type cast to the type to retrieve and store the data from session like given below :
> 
> `String str = (String)ViewState["KEY"];`

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2011-11-12T10:52:28.543

I'll use Session as [suggested by tvanfosson.](https://stackoverflow.com/questions/222999/how-to-persist-variable-on-postback/223006#223006) ViewState and HiddenField might be too heavy if you want to keep large data like a dataset for comments in a forum's topic pages..*************