# StackOverflow 问答 000612000-000612999

# hibernate - Grails 分页结果不一致

> ID：612003
> 
> 赞同：1
> 
> 时间：2009-03-04T19:10:34.980
> 
> 标签：hibernate, grails, grails-orm, paging

我正在我的 Grails 应用程序中进行一些分页。由于我正在做一些特殊的排序，我不能使用方便的排序/分页方法。这是我在服务器端的分页代码：

```
def criteria = ClientContact.createCriteria().createAlias("client", "c")
criteria.setFirstResult(params.offset?.toInteger())
criteria.setMaxResults(params.max?.toInteger())
def sortField = params.sort
if(params.sort == "clientName") sortField = "c.name"
criteria.addOrder(params.order == "asc" ? Order.asc(sortField) : Order.desc(sortField))
            /*
            if(!StringUtils.isBlank(params.searchField))
            {
                criteria.add(
                    Restrictions.or (
                        Restrictions.ilike("c.name", "%" + params.searchField + "%"),
                        Restrictions.or(
                            Restrictions.ilike("firstName", "%" + params.searchField + "%"),
                            Restrictions.ilike("lastName", "%" + params.searchField + "%")
                        )
                    )
                )
            }
                */

def results = criteria.list() 
```

您会注意到注释掉的代码部分。通常，它不会被注释，因此我可以进行特殊排序，但它被注释掉以帮助减少导致此问题的变量数量。

当我查看结果的第 4 页时，我看到了一定的人员名单。当我重新加载结果的第 4 页时，我看到了一个稍微不同的列表——移动了 8 个人。

有谁知道为什么我会收到不一致的结果？每次查看我的结果的第 4 页时，我希望得到相同的 100 人（如果你没有猜到，我正在显示人们的名字）。'offset'、'max' 和 'sort' 值在两个请求中是相同的。

任何帮助表示赞赏。谢谢，

安德鲁

更新....

这是应该工作的更直接的方法，除非我收到异常。如果我删除“createAlias”行，我不会收到异常。不幸的是，我需要别名才能加入关联的表。

```
 if(params.sort == 'client') params.sort = 'c.name'
            def criteria = ClientContact.createCriteria()
            criteria.createAlias('client', 'c')
            def pagedResults = criteria.list(offset: params.offset, max: params.max, sort: params.sort, order: params.order ?: 'asc' ) {
                    if(!StringUtils.isBlank(params.searchField)) {
                            or {
                                            ilike "c.name", "%$params.searchField%"
                                            ilike "firstName", "%$params.searchField%"
                                            ilike "lastName", "%$params.searchField%"
                            }
                    }
            } 
```

例外：

> 原因：java.lang.IllegalArgumentException: call to [list] not supported here
> 
> 在 grails.orm.HibernateCriteriaBuilder.invokeMethod(HibernateCriteriaBuilder.java:847)
> 
> 在 ClientContactController$_closure21_closure39_closure44.doCall(ClientContactController:494)

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-05T11:07:41.967

我不知道为什么排序在不同的请求中不一致，但我想向您展示代码的“默认”grails 方法：

```
if(params.sort == 'clientName') params.sort = 'c.name'
def criteria = ClientContact.createCriteria()
criteria.createAlias('client', 'c')
def results = criteria.list( sort: params.sort, order: params.order ?: 'asc' ) {
    if(!StringUtils.isBlank(params.searchField)) {
        or {
            ilike "c.name", "%$params.searchField%"
            ilike "firstName", "%$params.searchField%"
            ilike "lastName", "%$params.searchField%"
        }
    }
} 
```

结果变量是PagedResultList 的一个实例，它基本上是一个普通列表，但有一个“totalCount”属性来简化分页。

# powershell - 具有备用凭据的副本项

> ID：612015
> 
> 赞同：40
> 
> 时间：2009-03-04T19:14:05.533
> 
> 标签：powershell, powershell-2.0

我正在使用 powershell v2 的 CTP。我编写了一个脚本，需要访问我们 dmz 中的各种网络共享并复制一些文件。但是，我遇到的问题是，显然 powershell 的 cmdlet（例如复制项、测试路径等）不支持备用凭据...

任何人都对如何最好地完成我的任务有建议..？

* * *

## 回答 #1

> 赞同：45
> 
> 时间：2011-03-23T17:05:53.970

我最近遇到过这种情况，在最新版本的 Powershell 中有一个新的[BitsTransfer Module ，它允许使用](http://msdn.microsoft.com/en-us/library/ee663885%28v=VS.85%29.aspx)[BITS](http://msdn.microsoft.com/en-us/library/bb968799%28v=VS.85%29.aspx)进行文件传输，并支持使用 -Credential 参数。

以下示例显示了如何使用 BitsTransfer 模块将文件从网络共享复制到本地计算机，使用指定的 PSCredential 对象。

```
Import-Module bitstransfer
$cred = Get-Credential
$sourcePath = \\server\example\file.txt
$destPath = C:\Local\Destination\
Start-BitsTransfer -Source $sourcePath -Destination $destPath -Credential $cred 
```

另一种处理方法是使用标准的“net use”命令。但是，此命令不支持“securestring”密码，因此在获取凭证对象后，您必须获取密码的解密版本才能传递给“net use”命令。

```
$cred = Get-Credential
$networkCred = $cred.GetNetworkCredential()
net use \\server\example\ $networkCred.Password /USER:$networkCred.UserName
Copy-Item \\server\example\file.txt C:\Local\Destination\ 
```

* * *

## 回答 #2

> 赞同：34
> 
> 时间：2010-02-16T23:13:24.730

由于 PowerShell 不支持通过许多 cmdlet 使用“-Credential”（*非常*烦人），并且通过 WMI 映射网络驱动器在 PS 中被证明是非常不可靠的，我发现通过 net use 命令预先缓存用户凭据工作得很好：

```
# cache credentials for our network path
net use \\server\C$ $password /USER:$username 
```

在路径中使用 \\server\C$ 的任何操作似乎都可以使用 *-item cmdlet。

完成后，您还可以删除共享：

```
net use \\server\C$ /delete 
```

* * *

## 回答 #3

> 赞同：23
> 
> 时间：2015-06-03T03:28:37.807

PowerShell 3.0 现在支持文件系统提供程序上的凭据。要使用备用凭据，只需使用 New-PSDrive cmdlet 上的 Credential 参数

```
PS > New-PSDrive -Name J -PSProvider FileSystem -Root \\server001\sharename -Credential mydomain\travisj -Persist 
```

在此命令之后，您现在可以访问新创建的驱动器并执行其他操作，包括像普通驱动器一样复制或移动文件。这是完整的解决方案：

```
$Source = "C:\Downloads\myfile.txt"
$Dest   = "\\10.149.12.162\c$\skumar"
$Username = "administrator"
$Password = ConvertTo-SecureString "Complex_Passw0rd" -AsPlainText -Force
$mycreds = New-Object System.Management.Automation.PSCredential($Username, $Password)

New-PSDrive -Name J -PSProvider FileSystem -Root $Dest -Credential $mycreds -Persist
Copy-Item -Path $Source -Destination "J:\myfile.txt" 
```

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2012-05-03T17:57:26.973

这是一个老问题，但我只是为未来的发现者更新它。

**PowerShell v3 现在支持将 -Credential 参数用于文件系统操作。**

希望这可以帮助其他人寻找相同的解决方案。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2009-03-05T10:23:48.203

我会尝试将驱动器映射到远程系统（使用“网络使用”或 WshNetwork.MapNetworkDrive，这两种方法都支持凭据），然后使用复制项。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2012-09-25T15:56:44.067

我知道[PowerShell 3 现在开箱即用地支持这一点](http://blogs.msdn.com/b/powershell/archive/2012/06/21/improving-the-filesystem-provider-through-community-feedback.aspx)，但是为了记录，如果你被困在 PowerShell 2 上，你基本上必须使用旧`net use`命令（如其他几个人所建议的那样），或者[我的模拟模块专门写了](http://huddledmasses.org/using-alternate-credentials-with-the-filesystem-in-powershell/)一段时间来解决这个问题。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2017-08-23T22:52:12.473

这是我在机器上作为 LocalSystem 运行的脚本，但需要域用户的凭据才能访问网络文件位置。它允许您将用户的密码存储在“安全的”加密文件中；只能由编写它的用户阅读。

通过将包含明文密码的文件复制到机器中来设置和更改密码。下次运行脚本时，它会读取密码，对其进行加密，然后删除明文密码。

```
$plaintext_password_file = 'C:\plaintext.txt' # Stores the password in plain text - only used once, then deleted
$encryted_password_file = 'C:\copy_pass.txt'  # Stores the password in "safe" encrypted form - used for subsequent runs of the script
                                              #   - can only be decrypted by the windows user that wrote it
$file_copy_user = 'OURDOMAIN\A_User'

# Check to see if there is a new plaintext password
if (Test-Path $plaintext_password_file)
{
    # Read in plaintext password, convert to a secure-string, convert to an encrypted-string, and write out, for use later
    get-content $plaintext_password_file | convertto-securestring -asplaintext -force | convertfrom-securestring | out-file $encryted_password_file
    # Now we have encrypted password, remove plain text for safety
    Remove-Item $plaintext_password_file
}

# Read in the encrypted password, convert to a secure-string
$pass = get-content $encryted_password_file | convertto-securestring

# create a credential object for the other user, using username and password stored in secure-string
$credentials = new-object -typename System.Management.Automation.PSCredential -argumentlist $file_copy_user,$pass

# Connect to network file location as the other user and map to drive J:
New-PSDrive -Name J -PSProvider FileSystem -Root "\\network\file_directory" -Credential $credentials

# Copy the file to J:
Copy-Item -Force -Verbose -Path "C:\a_file.txt" -Destination "J:\" 
```

*作为一个额外的改进：用户名也可以被加密，而不是硬编码。*

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-11T00:33:58.147

这个[问题](https://stackoverflow.com/questions/303045/connecting-to-a-network-folder-with-username-password-in-powershell)解决了一个非常相关的问题，可能有助于[在 powershell 中使用网络共享](https://stackoverflow.com/questions/303045/connecting-to-a-network-folder-with-username-password-in-powershell)。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-03-04T19:42:44.340

[这](http://blogs.technet.com/brad_rutkowski/archive/2008/09/26/using-invoke-command-to-launch-a-script-on-a-remote-computer-which-connects-to-network-resources.aspx)是一个帖子，有人让它工作。看起来它需要更改注册表。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2012-11-23T04:22:46.953

让这个死而复生。通过将 .ps1 包装在批处理文件中并执行 Win7、Shift + r.Click RunAs，我解决了类似的凭据问题。如果你愿意，你也可以这样使用 PsExec：

```
psexec.exe /accepteula /h /u user /p pwd cmd /c "echo. | powershell.exe -File script.ps1" 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2021-01-27T19:56:16.380

较新的 PowerShell 版本可以处理此问题，MS 文档中有一个很好的示例[，可以在此处复制具有不同凭据的文件](https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.management/copy-item?view=powershell-7.1#example-5--copy-a-file-to-a-remote-computer)

```
$Session = New-PSSession -ComputerName "Server02" -Credential "Contoso\User01"
Copy-Item "D:\Folder002\" -Destination "C:\Folder002_Copy\" -ToSession $Session 
```

* * *

## 回答 #12

> 赞同：-1
> 
> 时间：2009-03-04T19:23:12.797

> 显然 powershell 的 cmdlet（例如复制项、测试路径等）不支持备用凭据...

看起来他们在这里做的，copy-item 肯定包含一个 -Credential 参数。

```
PS C:\> gcm -syn 复制项
复制项 [-Path] <String[]> [[-Destination] <String>] [-Container] [-Force] [-Filter <String>] [-I
nclude <String[]>] [-Exclude <String[]>] [-Recurse] [-PassThru] [-Credential <PSCredential>] [...]

```

* * *

## 回答 #13

> 赞同：-6
> 
> 时间：2009-03-04T19:23:52.623

您应该能够将所需的任何凭据传递给 -Credential 参数。所以像：

$cred = 获取凭据

[输入凭据]

Copy-Item -Path $from -Destination $to -Credential $cred

# c++ - 做差异的图书馆

> ID：612019
> 
> 赞同：2
> 
> 时间：2009-03-04T19:14:36.250
> 
> 标签：c++, diff

我的任务是创建一个可以区分和合并我公司产品的配置文件的工具。配置存储为 XML 或 URL 编码的字符串。我正在寻找一个库，最好是具有与商业软件兼容的许可证的开源库，可以进行这些差异。我们的应用程序是用 C++ 编写的，因此最好使用 C++ 库，但我愿意查看特定于 C# 的库，因为我可以编写一个通过 COM 将其公开给 C++ 的包装器。三向差异是理想的，但二向是可以接受的。如果它了解 XML，那也是一个加分项（因为 XML 节点可以在不更改文档的情况下重新排序等）。有什么图书馆建议吗？我是否应该考虑编写自己的差异工具，以期为其提供格式的语义知识？

感谢[这个类似的问题](https://stackoverflow.com/questions/479654/java-library-for-free-text-diff)，我已经发现了[这个谷歌图书馆](http://code.google.com/p/google-diff-match-patch/)，这看起来真的很棒，但我仍在寻找其他选择。它似乎也能够以 HTML 格式输出差异（使用`<ins>`and`<del>`在我发现它之前我不知道存在的标签），这可能非常方便，但它似乎只是一个统一的差异。我将需要在 Web 浏览器中显示结果，并且可能还必须构建一个界面来在浏览器中进行合并。我不希望库能够帮助完成这些任务，但它必须以适合我在其之上构建它的格式生成输出。我目前正在设想一些类似于 TortoiseMerge 的东西（并排差异，不统一），除了基于浏览器的。任何关于如何呈现这一点的提示/技巧/设计理念也将不胜感激。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-04T19:24:07.787

Subversion 附带Apache 软件许可证`libsvn_diff`并`libsvn_delta`获得许可。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-06T09:16:24.610

[这](http://ssddiff.alioth.debian.org/)是一个 C++ 库，可以区分作者所说的半结构化数据。它很好地处理 HTML 和 XML。由于您的数据是 XML，因此使用它而不是纯文本差异会很有意义。当文件是机器生成时尤其如此。

我目前正在尝试使用这个库来构建一个比较 Visual Studio 项目文件的工具。这些基本上是 XML 文件，使用像 Winmerge 这样的普通 diff 工具太痛苦了，因为 Visual Studio 几乎通过疯狂的重新排序弄乱了整个文件。这个想法是做某种结构化的差异来解决这个问题。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-04T19:53:32.380

为了区分 XML，我建议您首先对其进行规范化：按字母顺序对所有元素进行排序，然后生成表示原始文档但独立于原始格式的令牌/xml 流。运行差异后，解析结果以获取包含添加/删除内容的树。

# sorting - 如何在 IronPython 中对 FileInfo 列表进行排序

> ID：612028
> 
> 赞同：1
> 
> 时间：2009-03-04T19:18:15.057
> 
> 标签：sorting, file, ironpython

给定一个 FileInfo 对象列表，如何按日期对它们进行排序？具体来说，我想按 CreationTime 降序对它们进行排序。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-04T23:37:52.683

这样做的 Pythonic 方式是：

```
fileInfos = list(DirectoryInfo(path).GetFiles())
fileInfos.sort(key=lambda f: f.CreationTime, reverse=True) 
```

列表排序方法采用一个键函数，用于获取每个项目的排序键。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-04T19:23:31.063

DirectoryInfo.GetFiles() 返回一个 FileInfo 对象数组。我创建了一个通用列表来保存 FileInfo 对象，并使用自定义比较器进行排序。

```
logDir = r"C:\temp"
fileInfosArray = DirectoryInfo(logDir).GetFiles("*.log")
fileInfosList = List[FileInfo]()
fileInfosList.AddRange(fileInfosArray)
fileInfosList.Sort(FileInfoCompareCreationTimeDesc)
for fileInfo in fileInfosList:
    print fileInfo.CreationTime, fileInfo.LastAccessTime, fileInfo.LastWriteTime, fileInfo.Name

# comparison delegate for FileInfo objects: sort by CreationTime Descending
def FileInfoCompareCreationTimeDesc(fileInfo1, fileInfo2):
    return fileInfo2.CreationTime.CompareTo(fileInfo1.CreationTime) 
```

# php - 如何设置 cookie 然后在 PHP 中重定向？

> ID：612034
> 
> 赞同：48
> 
> 时间：2009-03-04T19:20:17.220
> 
> 标签：php, cookies, http-headers

经过一些处理后，我想为用户输入设置一个 cookie 值，然后将它们重定向到一个新页面。但是，cookie 没有被设置。如果我注释掉重定向，则 cookie 设置成功。我认为这是某种标题问题。这种情况的最佳解决方法是什么？

```
if($form_submitted) {
    ...
    setcookie('type_id', $new_type_id, time() + 60*60*24*30);
    header("Location: $url");
    exit;
} 
```

请注意，`true`无论哪种情况，setcookie 都会返回，并且我没有收到任何错误/警告/通知。

**编辑：**我正在使用 Unix/Apache/MySQL/PHP

* * *

## 回答 #1

> 赞同：76
> 
> 时间：2009-03-04T19:38:10.327

如果您有人工 url 或子文件夹（如 www.domain.com/path1/path2/），那么您必须将 cookie 路径设置为 / 以适用于所有路径，而不仅仅是当前路径。

```
if($form_submitted) {
    ...
    setcookie('type_id', $new_type_id, time() + 60*60*24*30, '/');
    header("Location: $url");
    exit;
} 
```

来自 PHP 手册：

> cookie 可用的服务器上的路径。如果设置为“/”，cookie 将在整个域中可用。如果设置为 '/foo/'，则 cookie 将仅在 /foo/ 目录和 domain 的 /foo/bar/ 等所有子目录中可用。默认值是设置 cookie 的当前目录。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-04T19:24:00.220

您如何测试 cookie 是否已设置？Cookie 设置后可在*下一页*上使用。

> 常见的陷阱：
> 
> 直到下次加载 cookie 应该可见的页面时，cookie 才会变得可见。要测试 cookie 是否设置成功，请在 cookie 过期之前检查下一个加载页面上的 cookie。过期时间通过 expire 参数设置。调试 cookie 存在的一个好方法是简单地调用 print_r($_COOKIE);。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-04T19:34:27.217

我假设您正在运行 IIS？尝试在同一请求中设置 cookie 和位置标头时，IIS 版本低于 7 时存在已知错误。

[http://support.microsoft.com/kb/q176113/](http://support.microsoft.com/kb/q176113/)

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2015-11-23T21:09:31.800

我能够通过在刷新标题中使用轻微延迟来解决这个问题。我们设置标头（必须在任何可能输出的方法之前完成，例如 setcookie），然后设置 cookie。我添加了一条消息，以便用户在那几秒钟内看不到空白屏幕。

```
 header("refresh: 2; url=$url");
    setcookie('type_id', $new_type_id, time() + 60*60*24*30, '/');
    echo "Processing, please wait..."; 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2016-05-20T15:02:35.477

在标头中使用相对 URL：

```
@Header("Location: orders_9090_1.php"); 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2021-04-22T04:56:27.217

我已经为此制定了解决方案

```
 setcookie(self::SESSION_NAME, $session_id, $expires, '/', null, null, true);
    header("Set-cookie: ".self::SESSION_NAME."=".$session_id."; expires=".date('D, Y-M-d H:i:s', $expires)." GMT; path=/; HttpOnly; secure=true; SameSite=Strict");

//check is something printed
    if (!headers_sent()) {

//is there any header set
                if( !array_map(function($header){ return preg_match('/Set-cookie/i', $header) ? true : null; }, headers_list()) ){

                    die(header('Location: ' . $url));
                }
            }
            die('<script type="text/javascript">window.location.href = ' . ($append ? 'window.location.href' : '') . ($append && $url ? '+' : '') . ($url ? '"' . $url . '"' : '') . ';</script>'); 
```

# adblock - 您将如何设计用于流媒体广播的“广告拦截器”？

> ID：612038
> 
> 赞同：15
> 
> 时间：2009-03-04T19:21:12.770
> 
> 标签：adblock, streaming-radio

我无法忍受听传统广播，因为我无法忍受听广告。（电视也是如此，其中的广告比你想看的要响亮 200%。）

不幸的是，我妻子早上准备时*需要听收音机。*

我在想，我们有插件来阻止我们的网络浏览器中的广告，为什么不用于收音机呢？

大多数广播电台都通过网络提供内容流。您将如何设计广告拦截器？你能预见任何*陷阱*吗？

**更新**

出现了几点...

用什么来代替广告：沉默就可以了。

识别广告：可能在第一次播放时无法识别添加内容，但您必须向软件发出信号表明这是广告。该广告将被记录。是否可以对其进行处理并提取某种独特的“签名”，以便下次播放时可以识别并静音？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2012-09-23T13:45:59.950

我对法国广播网络也有同样的迫切需求。对于基于计算机的解决方案，这是我对过程中 3 个问题的看法。

**1\. 识别广告何时播放**

1.1 手动 [关闭] 按钮会很有用：当您听到烦人的广告时按下它。它是可靠的（虽然有点晚了），并且“警报”可以通过互联网广播到社区工具。

1.2 从互联网接收“这是广告”信号（无论是人为还是软件生成）。

1.3 分析信号，计算签名，并与互联网上的社区数据库进行比较。

1.4 分析信号以发现比平均值更高的响度。

1.5 分析信号以找到比平均速度更快的句子。

1.6 分析信号以发现可疑短语，如“便宜”、“仅美元”、“惊人”、“特价”等。

**2.用其他声音填充广告时间**

2.1 对于某些人来说，沉默确实是完全可以接受的。

2.2 告诉播放器在广告期间播放您自己的 mp3 播放列表。

2.3 告诉玩家切换到另一个喜欢的电台（最好是一个不同时播放广告的电台。

2.4 如果您接受 60 秒的延迟，系统将利用社区信号并能够从第一秒开始停止广告。

**3\. 广告公司会生气吗？**

3.1 好吧，以 AdblockPlus 为例。它工作得非常好，我在 2008 年左右问过它的开发者弗拉基米尔帕兰特，他在广告大厅遇到了麻烦。他回答说：“不：如果 Firefox 有 20% 的份额，然后 20% 的 Firefox 用户安装了 Adblock，它只会让 4% 的互联网用户......还不足以让他们成为一个巨大的关注点。我从未受到任何压力他们的尝试。”

3.2 尽管如此，[Tivo VCR](http://en.wikipedia.org/wiki/Tivo)还是让美国电视内容提供商非常生气，因为它允许跳过广告。

3.3 在互联网上基于计算机的广播收听者的特殊情况下（仅占所有广播收听者的一小部分），我认为该软件将能够在任何内容提供商感到受到威胁之前实现很高的可靠性和流行度：就像 AdblockPlus。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-05T02:55:19.183

对于最简单的情况，我会简单地监控流入时流的音量的移动平均值。如果移动平均值超过阈值（将被调整），那么只需将音量静音（或将其降低 80% ）。

我做了一个快速的谷歌搜索，似乎这个类会有所帮助（假设你在.net中做）： http: [//www.codeproject.com/KB/audio-video/SoundViewer.aspx](http://www.codeproject.com/KB/audio-video/SoundViewer.aspx)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2015-10-21T11:56:04.120

从这个页面收集了一些见解，我为流式广播构建了一个广告块：http: [//adblockradio.com](http://adblockradio.com)

服务器进行（相当昂贵的）计算并向客户端提供“垃圾邮件”索引，客户端可以相应地静音。

我现在只为精选的法语流工作。将来可能会更多，用各种语言。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2016-08-04T08:51:51.497

我为广播创建了一个开源广告拦截器。它假设每个商业街区都以特定的叮当声开始和结束。我录制了这些叮当声，然后使用[互相关](https://en.wikipedia.org/wiki/Cross-correlation)在广播流中检测它们。

我准备了两个版本的广告拦截器。第一个是一个简单的 GUI 应用程序，它接收互联网流、使广告静音并播放结果。

第二个是与立体声接收器一起使用的广告拦截器。我在 Raspberry Pi 上运行它以使我的家庭立体声系统中的广告静音。对于这个版本，我需要一个广播源进行分析。我使用了便宜的 DVB-T 棒和 rtl_fm 应用程序。

实现细节可以在[我的博客](http://blog.rekawek.eu/2016/02/24/radio-adblock/)上找到。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-04T19:27:29.637

鉴于流媒体是**现场直播**的，一个明显的问题是你会用什么来填补时间？从理论上讲，您可以完全切断收音机 30 秒左右，但这不是一个很好的解决方案。

此外，即使假设您可以完美地将广播语音转换为文本（实时）——一个很大的“**如果**”，您将如何确定广告即将开始的文本流？

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-04T20:53:23.703

您必须注意的一件事是，有些客户非常聪明，如果您将音量调得太低，他们会暂停广告。Spotify 就是这样做的。

不过，在广播或纯媒体流上没有问题。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2015-05-04T17:10:37.563

我经常希望有这个，但没有聪明的去做。我的设计要点是：

*   您可以从声卡本身对其进行攻击，而不是分析传入的流。这样，无论如何播放商业或不需要的音频，都可以将其切断。
*   聆听时缓冲 10-15 秒。然后当用户说“这是一个广告”时，让他/她在那个缓冲区中识别它开始的地方。然后，该应用程序可以将传出的音频与其商业声音片段的命中列表相匹配，并知道何时静音。
    *   随着新商业广告的播放，提示用户指出它何时结束。然后应用程序知道静音多长时间。
    *   奖励：商业播音员经常在同一个电台做很多广告。语音质量识别可以让应用程序聆听播音员（通常很烦人）的声音并询问“这是广告吗？”，从而更容易将广告添加到热门列表中。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-04T21:43:34.627

About filling the blanks and handling the processing delays

If your wife isn't too obsessed about the timing, your tool could start 30 minutes before she gets up and thus have a buffer of ad-free radio.

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-03-04T20:40:50.677

[National Instruments 的LabVIEW](http://www.ni.com/labview/)有一堆音频（和振动）分析工具。想到的一个想法是比较左右通道。如果它们不同，那么您可能有音乐。虽然它仍然可能是一个广告。我没有用过他们的音频工具，也不熟悉音频分析，所以你还有一些功课要做。

有时您需要放弃一种编程方法并以不同的方式进行。我在 pandora.com 上听音乐。广告在显示器上是可见的，但永远听不到。我选择我想听的音乐类型并让它播放。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-03-04T19:30:45.073

我不确定你将如何去做，但你可以创建某种音频“过滤器”，每隔一段时间（5-10 秒）检查每个流。

如果过滤器失败，则意味着它是广告，因此您可以关闭或静音流一段时间。

把它想象成音频正则表达式。

现在问题来了。

正如列维克所说，你用什么来填补死时间？

您如何将过滤器连接到流光？如果您将它直接连接到扬声器馈送，这可能会起作用，但是如果您想让其他设备的音频播放，同时使收音机静音，您会怎么做？

这在计算上会有多昂贵？

这听起来像是一个有趣的项目，如果你在它上面取得了良好的进展，请告诉我们！

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2011-02-14T05:43:25.163

我认为您想要感应音量变化，然后将其编程为静音 60 秒，然后重新测试该点的流，如果在同一级别保持关闭 30 多个，然后再次采样，如果应用程序感觉到它是较低的音量节目它取消静音，直到任何变化。某种闪避、定时压缩器，其阈值高于预设水平（在收听节目时设置）。以图形方式显示电平的伴随音频分析器窗口或图表将是理想的......

我之所以找到这个网站，是因为 Heart&Bdy Extrct 广告困扰着 Jeff Rense 的夜间节目和其他几个 alt 新闻台，让我发疯了。每个广告时段！如果您设计一些可以可靠地完成这项工作的软件，您可能会赚到一些钱，但我想广告人会很生气。（我假设您的意思是流媒体广播）但是如果您确实开发了，我会排队购买……更好的是，让我成为您的第一个客户！我经常错过几分钟的一些节目，因为我在房间里做了一些事情后忘记取消静音......在那里学到了很多东西......

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2016-12-02T04:07:04.397

超级简短的答案，但可行并且需要时间/投资来创建：

在 vlc 插件中众包，允许用户点击按钮并传播有广告的范围。如果在限制内多次报告范围，则停止广告录制等等等等，比较音频哈希文件来执行此操作。Wham bam 你得到了众包商业免费广播，可以选择只收听 unqiue 浓缩广播（没有重播）。很确定你必须在客户端存储压缩收音机，否则它是非法的或什么的。

# javascript - 输入表单的 Jquery 自动完成，使用 Textpattern 类别列表作为源

> ID：612045
> 
> 赞同：1
> 
> 时间：2009-03-04T19:23:28.553
> 
> 标签：javascript, jquery, autocomplete, webforms, textpattern

我正在使用[Textpattern CMS](http://textpattern.com/)来建立一个讨论站点——我对 XHTML 和 CSS 以及 Textpattern 的模板语言有很好的掌握，但是 PHP 和 Javascript 有点超出我的能力。

在输入表单上开始一个新主题，用户需要从超过 5,000 个选项的列表中选择一个类别。使用 HTML`select`类型的`input`元素非常笨拙，但它可以工作。我想使用某种 Javascript 魔法来**显示一个`text`-type 输入元素**，该元素将读取用户输入并**显示来自可用类别的匹配或自动完成**，将所需的选项传递`value`到适当的数据库字段中。

我已经看过几个 jquery 的自动完成插件，但这些说明的前提是您了解 Javascript 的工作原理。

正如我上面提到的，我很容易将类别列表生成为`select`-type`input`元素，并且我可以使用 CSS 隐藏该元素。`text`是否可以使用-type 输入元素中的自动完成机制来控制选择列表输入？我该怎么做？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-04T20:08:16.527

**编辑：更新为将 option.value 放在隐藏字段中**

是的，有可能。例如，如果您有以下 html 代码：

```
<input type="text" id="myTextBoxId"></input>
<!-- added hidden field to store selection option value -->
<input type="hidden" id="myHiddenField" name="selectedCategory"></input>
<select id="mySelectId" style="display: none">
    <option>Category 1</option>
    <option>Category 2</option>
    <option>...</option>
</select> 
```

您可以使用以下 jquery 代码将此数据放入数组中：

```
var categories = $.map($("#mySelectId option"), function(e, i)
{
    return e; // Updated, return the full option instead its text
}); 
```

[最后，您可以使用像这样](http://bassistance.de/jquery-plugins/jquery-plugin-autocomplete/)的自动完成插件：

```
$("#myTextBoxId").autocomplete(categories,
{
    formatItem : function(item) { return item.text; } // Added
}); 
```

检查[自动完成插件演示页面](http://jquery.bassistance.de/autocomplete/demo/)以查看您可以使用哪些[选项（如 autoFill 和 mustMatch）。](http://docs.jquery.com/Plugins/Autocomplete/autocomplete)

您所要做的就是将它放在您的 html 标头中（jquery js、自动完成 css 和 js、您页面的代码）：

```
<link rel="stylesheet" type="text/css" href="jquery.autocomplete.css" />
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="jquery.autocomplete.js">
</script>
<script type="text/javascript">
    $(function()
    {
        // Updated script
        var categories = $.map($("#mySelectId option"),
            function(e, i) { return e; });
        $("#myTextBoxId").autocomplete(categories,
        {
            formatItem : function(item) { return item.text; }
        });
        // Added to fill hidden field with option value
        $("#myTextBoxId").result(function(event, item, formatted)
        {
            $("#myHiddenField").val(item.value);
        }
    });
</script> 
```

好吧，这只是几行代码，但我不太喜欢“选择到数组”的东西。如果可能，您应该创建一个页面，该页面返回与用户输入匹配的类别列表（再次，请查看演示页面以获取示例，不幸的是，我对 Textpattern 帮不上什么忙）。

当然，我没有测试，如果您有问题，请发表评论。编辑：我做了测试，但我没有 5k 个项目`select`；）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-20T17:31:21.643

您可以设置自动完成以从 URL 中获取其数据，因此我可以看到它在 Textpattern 中以多种漂亮的方式使用。

自动完成使用的数组格式如下所示：

```
["example_one", "example_two", ... ] 
```

由于您有 5000 多个元素，您可能希望创建一个使用该格式简单列出它们的页面：

```
Page Autocomplete:
[
    <txp:article_custom form="array_form" ... />
]

Form array_form:
"<txp:title />", 
```

要使用此页面而不是在选择字段中包含所有项目，您可以使用以下方式设置自动完成：

```
$("#example").autocomplete("<txp:link_to_home />Autocomplete"); 
```

您可以使用缓存插件来加快加载速度。

为了进一步加快速度，您可以使用带有[自定义显示页面](http://justinfrench.com/?id=15)的 Textpattern 搜索功能，而不是使用完整列表。可能有一种方法可以设置自动完成功能，以便每当输入/删除新字符时，都会使用新的搜索字符串重新加载自动完成功能。

# wcf - WCF 和防火墙

> ID：612053
> 
> 赞同：0
> 
> 时间：2009-03-04T19:24:15.273
> 
> 标签：wcf

我编写了一个非常简单的 WCF 服务（托管在 IIS 中）和与之对话的 Web 应用程序。如果它们都在同一个域中，则可以正常工作。但是当我将它们放在不同的域中（在防火墙的不同侧）时，Web 应用程序会说：

**由于身份验证失败，无法满足对安全令牌的请求。说明：执行当前 Web 请求期间发生未处理的异常。请查看堆栈跟踪以获取有关错误及其源自代码的位置的更多信息。异常详细信息：System.ServiceModel.FaultException：由于身份验证失败，无法满足对安全令牌的请求。源错误：在执行当前 Web 请求期间生成了未处理的异常。可以使用下面的异常堆栈跟踪来识别有关异常起源和位置的信息。**

服务 web.config 的相关部分是：

```
<system.serviceModel>
<services>
  <service behaviorConfiguration="MigrationHelperBehavior"
    name="MigrationHelper">
    <endpoint address="" binding="wsHttpBinding" contract="IMigrationHelper">
      <identity>
        <dns value="localhost" />
      </identity>
    </endpoint>
    <endpoint address="mex" binding="mexHttpBinding" contract="IMetadataExchange" />        <endpoint  binding="httpBinding" contract="IMigrationHelper" />       </service>
</services>
<behaviors>
  <serviceBehaviors>
    <behavior name="MigrationHelperBehavior">
      <!-- To avoid disclosing metadata information, set the value below to false and remove the metadata endpoint above before deployment -->
      <serviceMetadata httpGetEnabled="true"/>
      <!-- To receive exception details in faults for debugging purposes, set the value below to true. Set to false before deployment to avoid disclosing exception information -->
      <serviceDebug includeExceptionDetailInFaults="false"/>
    </behavior>
  </serviceBehaviors>
</behaviors>
</system.serviceModel> 
```

网络应用程序（客户端）web.config 说：

```
<system.serviceModel>
<bindings>
<wsHttpBinding>
<binding name="WSHttpBinding_IMigrationHelper" closeTimeout="00:01:00" openTimeout="00:01:00" receiveTimeout="00:10:00" sendTimeout="00:01:00" bypassProxyOnLocal="false" transactionFlow="false" hostNameComparisonMode="StrongWildcard" maxBufferPoolSize="524288" maxReceivedMessageSize="65536" messageEncoding="Text" textEncoding="utf-8" useDefaultWebProxy="true" allowCookies="false">
    <readerQuotas maxDepth="32" maxStringContentLength="8192" maxArrayLength="16384" maxBytesPerRead="4096" maxNameTableCharCount="16384"/>
    <reliableSession ordered="true" inactivityTimeout="00:10:00" enabled="false"/>
    <security mode="Message">
        <transport clientCredentialType="Windows" proxyCredentialType="None" realm=""/>
        <message clientCredentialType="Windows" negotiateServiceCredential="true" algorithmSuite="Default" establishSecurityContext="true"/>
    </security>
</binding>
</wsHttpBinding>
</bindings>
<client>
<endpoint address="http://mydomain.com/MigrationHelper.svc" binding="wsHttpBinding" bindingConfiguration="WSHttpBinding_IMigrationHelper" contract="MyNewServiceReference.IMigrationHelper" name="WSHttpBinding_IMigrationHelper">
<identity>
    <dns value="localhost"/>
</identity>
</endpoint>
</client>
</system.serviceModel> 
```

我相信这两个只是 VS 2008 为我创建的默认设置。

所以我的问题是，当服务和客户端不在同一个域中时，如何配置它们？

谢谢。吉姆·比迪森

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2011-04-18T08:55:29.367

您似乎想要/正在使用 Windows 身份验证，在跨域情况下，用户凭据通常是不同的。这似乎不是防火墙问题。

要解决默认的 Windows 身份验证，请使用证书或不使用任何内容。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-04T19:29:10.693

有关如何设置 WCF 跟踪的信息，请参阅对[我的问题的回复。](https://stackoverflow.com/questions/600868/wcf-service-connection-issue-maybe-security)如何为服务的 Web 应用程序配置安全性？

# c# - How can I efficiently trim selected characters from middle of a string?

> ID：612058
> 
> 赞同：0
> 
> 时间：2009-03-04T19:24:54.463
> 
> 标签：c#, .net, performance, string

Can anyone think of an efficient way (time wise) to trim a few selected characters from the middle of a string?

Best I came up with was:

```
public static string Trim(this string word, IEnumerable<char> selectedChars)
{
    string result = word;
    foreach (char c in selectedChars)
        result = result.Replace(c.ToString(), "");
    return result;
} 
```

But it is still too slow.

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-04T19:28:43.250

Two options spring to mind:

*   Use a StringBuilder
*   Use a regular expression

Here's the `StringBuilder` version:

```
public static string Trim(this string word, IEnumerable<char> selectedChars)
{
    // The best form for this will depend largely on the size of selectedChars
    // If you can change how you call the method, there are optimisations you
    // could do here
    HashSet<char> charSet = new HashSet<char>(selectedChars);

    // Give enough capacity for the whole word. Could be too much,
    // but definitely won't be too little
    StringBuilder builder = new StringBuilder(word.Length);

    foreach (char c in word)
    {
        if (!charSet.Contains(c))
        {
            builder.Append(c);
        }
    }
    return builder.ToString();
} 
```

The regular expression option could be very efficient if you have a *fixed* set of chars you want to trim, and can build the regex *once*.

Something like:

```
// Put this statically somewhere
Regex unwantedChars = new Regex("[def]", RegexOptions.Compiled);

// Then do this every time you need to use it:
word = unwantedChars.Replace(word, ""); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-04T19:30:56.070

start by using StringBuilder not string for your replacements...
see [http://blogs.msdn.com/charlie/archive/2006/10/11/Optimizing-C_2300_-String-Performance.aspx](http://blogs.msdn.com/charlie/archive/2006/10/11/Optimizing-C_2300_-String-Performance.aspx)

# sql - 您如何构建您打算重用的实体？

> ID：612059
> 
> 赞同：1
> 
> 时间：2009-03-04T19:24:54.633
> 
> 标签：sql, database-design

假设您的数据库中有以下实体：

[图片 http://lh6.ggpht.com/_UpGtM3B8h1U/Sa7SqfWmgDI/AAAAAAAAAHE/epqtm7EnoFg/test.gif](http://lh6.ggpht.com/_UpGtM3B8h1U/Sa7SqfWmgDI/AAAAAAAAAHE/epqtm7EnoFg/test.gif)

您希望能够向所有其他三个实体表（用户、客户和项目）添加注释。您将如何设置？

1.  将 tableName 和 FKId 添加到 Note 表？
2.  为每个关联的 Note 组（即 ClientNote、UserNote）创建一个单独的表
3.  在 Note 中为每个外键（UserId、ClientId 等）创建一个单独的字段

我似乎在选项 2 和 3 之间来回切换，尽管如果有一个优雅的实现，我会选择 1。选项 2 很有吸引力，因为没有空值。选项 3 很有吸引力，因为无论它与什么相关联，一个便笺感觉就像一个便笺。

有什么想法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-04T21:07:17.163

我通常会选择选项 2。我不会在合理范围内强调数据库中表的数量。

最大的问题是，这些笔记会作为一个单一的项目处理吗？例如，您是否会说“给我看所有笔记，无论是给客户、用户还是项目”。我想不出任何有用的情况。你通常会说，“给我看这个客户的笔记”或“给我看这个项目的笔记”。

由于它们在逻辑上不是一个项目，我建议不要尝试将它们物理建模为一个项目。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-04T19:31:35.180

我通常看到的处理方式是在选项 1 中。好处是，对于相关人员来说，这是一种相当简单的方法来查看正在发生的事情。正如您所说，缺点是 SQL 变得不那么优雅了。

不过，事情就是这样。实际上，即使感觉有点笨拙，生成的查询也是清晰易读的。您只需在添加新表的区域中将 sql 添加到新代码中。

当您实际直接操作笔记时，您只需要处理一张桌子。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-04T19:32:51.290

还有第四种方法（我会推荐）：在 Note 表中添加一个唯一的 id，在 User、Client 和 Project 中添加一个字段 noteId

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-04T20:44:51.790

做什么可能取决于您需要的注释字段在实体之间是否真正相同。如果它们相同，我可能会有一个带有 Notetype（用户、客户端、项目）、noteID 和id 来自相应的表以及您需要的所有与注释相关的字段。最大的问题是必须通过触发器而不是 FK 来管理 FK 关系。您不想输入无效的用户 ID，但由于整个列不包含用户 ID，因此您不能只设置 FK 关系。另一方面，如果您稍后添加另一个实体，您可以在不影响表结构的情况下进行操作（尽管您仍然需要修改触发器），这是将 ids 放在单独的字段中的问题。这也意味着您将无法使用级联更新或删除，这会使删除记录（或更改自然键（颤抖））更加困难。

如果实体之间对注释字段的需求不同，我将为每个实体创建单独的注释表。

如果您要在所有实体之间的每个查询中访问 Notes 表，您可能还需要为每个实体使用单独的表，以减少锁定和阻塞问题。然而，音符可能不需要经常被击中，所以情况可能不会太糟糕。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-04T20:53:12.753

选项 3\. 将标识作为主键，并为共享 Note 表的任何表提供外键列。我以这种方式处理电子邮件、电话、地址等。

我知道的唯一缺点是如果您有 10 个表链接到 Note - 您将有 10 个外键列。

我对选项 1 的问题是，感觉就像您正在创建一个人工外键（使用 TableName/Pkid，它实际上不是用户/项目主键的一部分，它们只是 Pkid）。这可能只是我个人的偏见，我只是从来不觉得那是好的设计，但我不能确切地说出为什么。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-04T22:33:25.443

我认为，在这种情况下，您应该明确避免解决方案 1。
您失去了完整性参考，没有动态 SQL 就无法查询您的数据库，并且您总是需要 2 个查询来选择一些注释！
你不应该在像这里这样的简单情况下使用这种方式。

正如我所看到的，我选择了选项 4（在项目、客户和用户上添加字段 note_id）。如果您需要一行多个笔记，这不是问题。您只需添加一个额外的表（可以说 note_set）来建立 n-1 关系。

客户（client_id，note_set_id）用户（user_id，note_set_id）项目（project_id，note_set_id）

note_set(note_set_id) note(note_id, note_set_id, title, body)

该解决方案的主要问题是，如果没有在三个表上创建 UNION，您将无法找到初始“实体”。对我来说这似乎不是一个大问题，但如果是，那么选择选项 3。

最后，选项 2 也不错，但不是我所说的“重用”。

请原谅我的英语。

# actionscript - ActionScript - 它是什么编程语言类别？

> ID：612062
> 
> 赞同：3
> 
> 时间：2009-03-04T19:25:52.540
> 
> 标签：actionscript

ActionScript 是一种脚本语言还是更像 Java 之类的面向对象的编程语言？在 Wikipedia 上的快速检查将其列在脚本语言中......

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-04T19:39:30.247

AS 是 ECMAScript 的变体。你可以说它是 JavaScript 的一种方言。

因此，它具有并且一直具有面向对象的品质。它不是 3.0 中比以前“更多”的 OO，它只是比以前更“类似于 java-OO”。因为现在它包括对基于类的继承的语言支持。

当然，通常的基于原型的继承仍然存在，它是基于类的样式的超集。

这一切都使它比以前少了“脚本”。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-04T19:29:11.377

虽然它被称为动作“脚本”，但它是一种非常类似于 Java 的面向对象语言。所有代码都被编译成二进制 swf 文件。

*   **ActionScript 1**也是基于原型的 OO。

*   **ActionScript 2**添加了类、访问器等，但这几乎是 AS1 之上的语法糖。

*   **ActionScript 3**完全重新设计并在 Flash Player 内的新虚拟机 (AVM2) 中与旧虚拟机并行运行。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-07T11:20:47.143

> Java 与 AS3 的区别是什么？

不是很多。两者都生成被传递的字节码，然后通过 JIT 在目标平台上编译为机器码。

虽然 AS3 通常被描述为属于 EcmaScript 家族，但它在底层有 2 个共存的对象模型。一种是传统的原型方法，另一种是更类似于 java 的方法，包括包、类和接口、子类化、抽象和最终方法等。

同样，AS3 可以在没有任何显式类型的情况下使用（就像 javascript 一样），或者它可以与强类型一起使用，比如 Java。与 AS2 不同，给定的任何类型信息都在编译后的字节码中进行编码，并在运行时进行验证。

请注意，默认的编译器设置鼓励开发人员使用类似 java 的风格，但没有什么是无法通过几个选项来解决的。

从本质上讲，ActionScript 从一种玩具语言（参见 Flash 4 及以下版本）演变为一种类似 javascript 的语言（Flash 5 和 6），再到一种伪装成其他东西的 ecmascript 语言（Flash 7 和 8），再到现在更多的东西与 Java 和 C# 相比，其较旧的版本（Flash 9 和 10）更常见

* * *

简单地回到最初的问题，我可以想到几乎所有脚本语言都有的两个语言特性，而 AS3 缺乏：

1.  直接从源代码运行脚本的能力。AS3 需要一个显式的编译步骤。
2.  在运行时将字符串评估为代码片段的能力。不要在 AS3 中寻找“eval”语句，它根本不存在。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-04T19:29:39.660

它是 EcmaScript 的变体，因此类似于 JavaScript。

[动作脚本](http://en.wikipedia.org/wiki/Actionscript)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-04T19:32:06.457

两者并不相互排斥。

以后的 AS 版本的结构是面向对象的，但是它没有编译到本地汇编器中。它被解释为字节码。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-03-04T19:32:12.167

谁说脚本语言不能是面向对象的？我会说它既是脚本语言又是 OO。

我的意思是，例如，Python 通常被称为脚本语言，并且可以简单地用于编写现有应用程序的脚本。这也是OO。如果有问题的软件，例如，要求您传入一个符合某个接口的对象，则两者实际上可以合并。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-03-09T13:29:03.730

如果不定义脚本语言的含义，没有人可以回答这个问题。

正如 Larry Wall 在[Programming is Hard, Let's Go Scripting](http://www.perl.com/pub/a/2007/12/06/soto-11.html?page=1) ...它。” “但基本上，脚本不是一个技术术语。当我们称某事物为脚本语言时，我们主要是在做出语言和文化判断，而不是技术判断。”

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-03-04T19:30:20.067

AS 3.0 可以写成 OO。以前的版本更像 JavaScript 和程序化。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-03-04T20:43:47.253

有人将 ActionScript 描述为一种面向事件的编程语言。AS3 是一种具有 OO 特性的脚本语言。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-03-04T19:28:50.957

我认为这可能取决于您要询问的版本。我不是动作脚本专家，但看起来设计者正试图使其成为一种面向对象的语言。我认为在 3.0 中，他们有效地（至少部分地）跳转到了面向对象的语言。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-03-05T11:53:16.600

好的，感谢输入的家伙，最好的答案似乎是 AS3 既是 OOP 语言又是脚本语言。我想这可以追溯到脚本语言的定义 - 脚本语言是否已编译？我一直将 AS3 和 Java 等同起来，因为它们都被编译为字节码并在 VM 中运行，但是我从来没有听说过 java 被称为脚本语言，我想我还是有点困惑......

我想我现在的问题是 Java 与 AS3 的区别是什么？

# c# - 什么是按位或 | 运营商呢？

> ID：612072
> 
> 赞同：1
> 
> 时间：2009-03-04T19:29:33.703
> 
> 标签：c#, .net, enums, bit-manipulation

我正在阅读有关标志枚举和按位运算符的信息，并遇到了以下代码：

```
enum file{
read = 1,
write = 2,
readandwrite = read | write
} 
```

我在某处读到了为什么有包容性或陈述以及为什么不能有 &，但找不到文章。有人可以刷新我的记忆并解释原因吗？

另外，我该怎么说和/或？例如。如果 dropdown1="hello" 和/或 dropdown2="hello"....

谢谢

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-03-04T19:39:11.230

**第一个问题：**

A`|`按位或；如果在第一个值或第二个值中设置了一个位，则会在结果中设置一个位。（您使用它`enums`来创建其他值组合的值）如果您要使用按位与，那将没有多大意义。

它的用法如下：

```
[Flags] 
enum FileAccess{
None = 0,                    // 00000000 Nothing is set
Read = 1,                    // 00000001 The read bit (bit 0) is set
Write = 2,                   // 00000010 The write bit (bit 1) is set
Execute = 4,                 // 00000100 The exec bit (bit 2) is set
// ...
ReadWrite = Read | Write     // 00000011 Both read and write (bits 0 and 1) are set
// badValue  = Read & Write  // 00000000 Nothing is set, doesn't make sense
ReadExecute = Read | Execute // 00000101 Both read and exec (bits 0 and 2) are set
}
// Note that the non-combined values are powers of two, \
// meaning each sets only a single bit

// ...

// Test to see if access includes Read privileges:
if((access & FileAccess.Read) == FileAccess.Read) 
```

本质上，您可以测试是否设置了 an 中的某些位`enum`；在这种情况下，我们正在测试是否设置了对应于 a 的位`Read`。值`Read`和`ReadWrite`都将通过此测试（两者都设置了位零）；`Write`不会（它没有设置零位）。

```
// if access is FileAccess.Read
        access & FileAccess.Read == FileAccess.Read
//    00000001 &        00000001 => 00000001

// if access is FileAccess.ReadWrite
        access & FileAccess.Read == FileAccess.Read
//    00000011 &        00000001 => 00000001

// uf access is FileAccess.Write
        access & FileAccess.Read != FileAccess.Read
//    00000010 &        00000001 => 00000000 
```

**第二个问题：**

我认为当您说“和/或”时，您的意思是“一个，另一个或两者”。这正是`||`（或运算符）所做的。要说“一个或另一个，但不是两者”，你会使用`^`（独占或运算符）。

真值表（真==1，假==0）：

```
 A   B | A || B 
     ------|-------
OR   0   0 |    0
     0   1 |    1 
     1   0 |    1
     1   1 |    1 (result is true if any are true)

     A   B | A ^ B 
     ------|-------
XOR  0   0 |    0
     0   1 |    1 
     1   0 |    1
     1   1 |    0  (if both are true, result is false) 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-04T19:35:04.657

上面的 or 是按位或，而不是逻辑或。1 | 2 等价于 3（而 1 & 2 = 0）。

有关按位运算的更好解释，请参见[http://en.wikipedia.org/wiki/Bitwise_operation](http://en.wikipedia.org/wiki/Bitwise_operation)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-04T19:36:04.827

[枚举类型](http://msdn.microsoft.com/en-us/library/cc138362.aspx)。查看 Enumeration Types as Bit Flags 部分，它给出了一个 OR 的例子以及一个 AND NOT b 的例子。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-04T19:35:10.303

好吧，这里有两个不同的问题，但要回答＃2，我认为大多数编程语言中的逻辑或就是你的意思和/或。

```
if (dropdown == "1" || dropdown == "2") // Works if either condition is true. 
```

然而，异或的意思是“一个或另一个，但不是两者”。

# c# - 原子的或巨大的

> ID：612076
> 
> 赞同：-2
> 
> 时间：2009-03-04T19:30:28.597
> 
> 标签：c#, .net, parallel-processing

如果您打算用 C# 编写一个非常并行的应用程序，那么构建非常小的东西会更好吗，比如

小班20个，大班40个，加起来60个，一共120个

或巨大的，例如：

单独制作这 60 个类（仍然考虑到可重用性）。

所以在#2 中，这 60 个类可以包含做事的方法，而不是其他类。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-04T19:33:14.880

抽象地说，这些方法中的任何一种都不会有所作为。

具体来说，最小化可变状态将使您的应用程序更具可并行性。每次更改对象实例的状态时，都会产生潜在的线程安全问题（复杂性或错误；至少选择一个）。如果您查看 Parallel LINQ 或强调并行性的函数式语言，您会注意到类设计的重要性低于避免状态更改的原则。

班级设计是为了你的理智。松散耦合的代码让你更加理智。不可变对象使您更加并行。根据需要组合。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-04T19:32:13.507

较小的部分更容易测试、更容易重构和更容易维护。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-04T19:41:11.943

重要的不是类的大小，而是耦合的范围。

对于并行应用程序，您应该支持不可变对象——有时称为“值对象”，而不是具有很多属性的对象。如果您需要应用产生新值的操作，只需创建新对象作为结果。

观察良好的关注点分离，并让它引导您使用自然数量的类来表示程序中的概念。我推荐由 ObjectMentor 的 Robert Martin 编目和推广的 SOLID 原则。（这应该足以找到列表的谷歌素材！）

最后，我还建议您熟悉 System.Threading 和 System.Collections。大多数集合本质上不是线程安全的，而且众所周知，同步很难做到正确。因此，您最好使用广泛使用、经过测试且可靠的同步原语。

# iphone - iphone屏保（带时钟）

> ID：612077
> 
> 赞同：0
> 
> 时间：2009-03-04T19:30:31.280
> 
> 标签：iphone, screensaver, clock

我可以创建一个 iPhone 应用程序来替换/修改默认时钟屏幕保护程序并显示其他内容（例如我自己的特殊时钟或其他）吗？

我该怎么做呢？我将不胜感激有关该主题的教程的链接，或执行此类操作的示例代码。

（免责声明：这里是 iPhone 开发新手）

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-04T19:38:40.280

无法覆盖 iPhone 上现有应用程序/功能的任何功能，包括手机锁定时显示的屏幕。您可以编写一个在启动时模仿该功能的应用程序，但我认为这不是您想要做的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-04T19:56:48.287

我认为这将违反苹果 UI 指南，并且很有可能不会被应用商店接受。

# xml - XPath 查找嵌套值

> ID：612087
> 
> 赞同：0
> 
> 时间：2009-03-04T19:33:29.980
> 
> 标签：xml, xpath

我有一些 XML 在使用 XPath 处理时遇到问题。我似乎无法获得我正在寻找的价值。XML 的结构如下：

```
<Group>
   <Menu>
      <Name>Top Menu</Name>
      <Document>
         <DocName>Readme.txt</DocName>
      </Document>
      <Menu>
         <Name>Sub Menu</Name>
         <Document>
            <DocName>Manual.pdf</DocName>
         </Document>
         <Document>
            <DocName>UserGuide.pdf</DocName>
         </Document>
      </Menu>
   </Menu>
</Group> 
```

给定菜单名称，我想返回菜单中的 DocumentNodes 列表。例如，给定“子菜单”，我想取回 Manual.pdf 和 UserGuide.pdf 的两个文档节点。

目前，我正在使用循环遍历子项的代码提取这些信息，但是，我宁愿直接使用 XPath 将其提取出来，但我的技能很弱。

（在你问之前，我无法重组 XML。它是以这种方式提供给我的。）

有什么想法吗？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-03-04T19:37:01.563

这是一个 XPath，可以满足您的需求：

> `//Menu[Name='Sub Menu']/Document`

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-04T19:38:11.293

`/<Menu>[\w\n]*<Name>Sub Menu</Name>[\w\n]*<Document>[\w\n]*(<DocName>([a-ZA-Z0-9\.]+)</DocName>[\w\n]*)*</Menu>/`

很可能会起作用（稍微调整一下，这有点粗糙！），但是，我不认为 Regex 是要走的路。我个人会使用 XPath 或 DOM

# c# - XmlWriter 只转义一种引用

> ID：612088
> 
> 赞同：1
> 
> 时间：2009-03-04T19:33:38.450
> 
> 标签：c#, escaping, xmlwriter

这是一些 C# 代码：

```
var sb = new StringBuilder();
var w = XmlWriter.Create(sb);
w.WriteStartElement("hello");
w.WriteAttributeString("target", "world ' \" !");
w.WriteEndElement();
w.Flush();
// then look at sb.ToString() 
```

我得到一个看起来像这样的字符串：

```
 <?xml version="1.0" encoding="utf-16"?><hello target="world ' &quot; !" /> 
```

它只是转义双引号，而不是单引号。但是 XmlWriter.WriteAttributeString(String, String) 的文档说：

> 如果属性值包含双引号或单引号，则将它们替换为 " 和’ 分别。

是否需要设置一些标志以使其执行文档所说的操作？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-04T19:45:20.933

如果您使用 .Net Reflector 查看代码，您会发现正在调用 System.Xml.XmlTextEncoder.Write(string) 方法。这是感兴趣的代码：

```
if (!this.inAttribute || (this.quoteChar != ch))
   this.textWriter.Write('\'');
else
   this.WriteEntityRefImpl("apos"); 
```

写入属性值时，不会转义单引号，因为它不需要。只有在编写文本元素时“&’” 用来。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-04T20:25:36.657

这不是 中的错误`XmlWriter`，而是您的旧系统中的错误。

如果您查看`AttValue`XML 1.0 推荐中的定义，您会发现它`XmlWriter`正在做它应该做的事情：如果属性值用撇号分隔，则属性值可以包含引号，如果它被分隔带引号的属性值可以包含撇号。

可以想象，您可以从中派生一个类`XmlTextWriter`并覆盖它的`WriteAttributes`和`WriteAttributeString`方法。那可能行得通。但是，如果您这样做，请注意名称空间和编码。

# apache - Firefox 请求图像缓慢

> ID：612094
> 
> 赞同：0
> 
> 时间：2009-03-04T19:35:30.537
> 
> 标签：apache, firefox, jsf, networking

我创建了一个简单的 JSF 图像浏览应用程序，但我遇到了 Firefox 的问题。

应用程序本身在 Tomcat 中运行。图片存储在 Apache 提供的目录中。我有 9 张图片显示在一个页面上。服务器位于与客户端分开的机器上。当我尝试在 Firefox 中加载页面时，通常会立即加载 6 张图片（< 500 毫秒）。其他三个将需要 15 到 20 秒才能加载。查看 apache 日志，似乎 firefox 直到 15-20 秒后才请求这三张图片 - 也就是说，我同时看到 6 个请求，然后在 15 秒后其他三个请求。我在Internet Explorer 中试过这个网站，IE 没有这个问题；它会立即加载所有 9 张图片。我试过几台不同的机器，结果都一样。html 的渲染速度非常快，< 200 毫秒，所以我不这样做

数字也不总是相同的 - 有时它会加载 8 个图像，有时会加载 7 个，有时第二批请求会同时出现，有时它会加载 2 个多于一个，等等。我不是确定这是Firefox设置还是错误，或者是否有任何服务器端我可以做的，但我想我会把它扔在那里，看看是否有人有任何想法我可以尝试。

如果它有帮助，这是来自 firefox 的 apache 日志行

```
192.168.1.30 - - [04/Mar/2009:14:25:40 -0500] "GET /work/DSCF0185_thumbnail.jpg HTTP/1.1" 200 7902 "-" "Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.9.0.6) Gecko/2009011913 Firefox/3.0.6 (.NET CLR 3.5.30729)" 
```

和一个来自 IE

```
192.168.1.30 - - [04/Mar/2009:14:34:14 -0500] "GET /work/DSCF0179_thumbnail.jpg HTTP/1.1" 304 - "http://192.168.1.83:8080/app/browse.jsf" "Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 5.1; InfoPath.2; .NET CLR 2.0.50727; .NET CLR 3.0.04506.648; .NET CLR 3.5.21022; .NET CLR 1.1.4322; MS-RTC LM 8; Windows-Media-Player/10.00.00.3990; FDM; .NET CLR 3.0.4506.2152; .NET CLR 3.5.30729)" 
```

**编辑** 我从 Firebug 那里得到了时间 - 它显示整个请求是（例如）18 秒，17.9 秒“接收数据”，其余时间用于排队。不过，直到 17.9 秒结束，我才在 Apache 日志中看到实际请求，这让我相信这是火狐的事情，特别是因为 IE 没有显示问题。如果它在服务器中，我希望在两个浏览器中都能看到问题。

Firefox 中的流水线已关闭。

正如所指出的，我的 IE 日志显示它正在访问缓存 - 我的错误，抓取了日志文件的错误部分。这是一个干净的日志行 - 即使在清除缓存之后，IE 也不会显示与 firefox 相同的问题。

```
192.168.1.30 - - [04/Mar/2009:15:52:18 -0500] "GET /vantagework/DSCF0189_thumbnail.jpg HTTP/1.1" 200 5805 "http://192.168.1.83:8080/vantage/browse.jsf" "Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 5.1; InfoPath.2; .NET CLR 2.0.50727; .NET CLR 3.0.04506.648; .NET CLR 3.5.21022; .NET CLR 1.1.4322; MS-RTC LM 8; Windows-Media-Player/10.00.00.3990; FDM; .NET CLR 3.0.4506.2152; .NET CLR 3.5.30729)" 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-04T19:41:36.950

使用 Firebug 的“Net”控制台检查它是 firefox 还是网络服务器，因为您的网络服务器可能需要时间来接受连接。

Firebug 的“网络”控制台会在它开始请求时向您显示，并为您详细说明请求图像的不同部分（排队等）-

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-04T20:23:07.410

根据您的日志片段，IE 正在从缓存中检索图像，Firefox 正在从服务器获取图像。因此，如果服务器配置出现问题导致图像传输缓慢，如果您先清除缓存，您只会在 IE 中看到类似的行为，所以我会尝试验证非缓存图像确实占用了不同的数量在 Firefox 和 IE 之间下载的时间。

我要检查的另一件事是查看您是否在 Firefox 中启用了[流水线。](http://www.google.com/search?q=firefox+pipelining)如果你这样做，我建议你禁用它，它可能会导致你的服务器出现问题。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-15T17:40:41.100

事实证明，这是由我的 apache 配置引起的。已经进行了一些调整，恢复到开箱即用的 apache 配置解决了这个问题。

# java - Java 类如何从 Entry 类中获取信息？

> ID：612095
> 
> 赞同：1
> 
> 时间：2009-03-04T19:35:46.247
> 
> 标签：java, oop

所以让我们说在我的入口点类（即程序启动时运行的类（具有`public static void main(String args[])`函数）。在那个类中我有这个变量：

```
private ArrayList<String> myData=new ArrayList<String>(); 
```

此类实例化另一个类，该类需要访问`myData`入口点类的成员。它如何检索这个数组列表？

编辑：为了澄清，在`main()`我可以这样做的方法中：

```
SomeOtherClass myClass=new SomeOtherClass(); 
```

然后我可以这样做：

```
myClass.someMethod(); 
```

但是，在`myClass`对象中，我如何从实例化`myClass`对象的入口类中执行方法/检索某些东西？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-04T19:38:59.047

为您实例化的类提供访问权限的最佳方法`myData`是在创建它时将其传递给构造函数。

然后，在您的构造函数中，您可以将 保存`ArrayList`到类的成员变量中。

例如，您的对象构造函数将如下所示：

```
private ArrayList<String> myData;

public YourObjConstructor(ArrayList<String> data){
    myData = data;
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-04T19:49:19.397

听起来您的入口点在调用其他类时仍然是静态的，但是您的 ArrayList 是它的*实例*的成员。您需要离开静态世界并进入实例。

我会将您的 main 方法重构为私有构造函数，并放入一个新的 main() 将其作为新实例启动。

请注意，此代码非常粗略，但它应该有助于说明您需要做什么。

```
public class EntryPoint {
    private ArrayList<String> myData=new ArrayList<String>();

    public static void main( String[] args ) {
        EntryPoint ep = new EntryPoint();
        ep.init();
    }

    private void init() {
        // Populate myData perhaps?

        SomeOtherClass myClass=new SomeOtherClass();
        myClass.someMethod( this );
    }

    public List<String> getMyData() {
        return myData;
    }
}   

public class SomeOtherClass {
    public void someMethod( EntryPoint entry ) {
        List<String> data = entry.getMyData();
        // do stuff with data..!
    }
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-04T19:38:58.937

包含的类`main()`只是一个普通的类。在您的情况下，您必须制作`myData` `public`并且可能`static`（或者，当然，添加访问器）。就像你对任何其他课程所做的那样。

您还可以将`Entry`对象传递给其他类，如下所示：

```
public static void main(String[] args) {
    Entry entry = new Entry();
    SomeOtherClass myClass=new SomeOtherClass(entry);
    // continue as before
} 
```

# c++ - 如何使用 C 或 C++ 获取目录中的文件列表？

> ID：612097
> 
> 赞同：718
> 
> 时间：2009-03-04T19:35:58.303
> 
> 标签：c++, c, file, directory

如何从我的 C 或 C++ 代码中确定目录中的文件列表？

我不允许`ls`在我的程序中执行命令并解析结果。

* * *

## 回答 #1

> 赞同：971
> 
> 时间：2009-03-04T19:57:51.700

**2017 年更新**：

在 C++17 中，现在有一种列出文件系统文件的官方方法：`std::filesystem`. [**下面的Shreevardhan**](https://stackoverflow.com/a/37494654/23264)提供了一个很好的答案，其中包含此源代码（此代码可能会抛出）：

```
#include <string>
#include <iostream>
#include <filesystem>
namespace fs = std::filesystem;

int main()
{
    std::string path = "/path/to/directory";
    for (const auto & entry : fs::directory_iterator(path))
        std::cout << entry.path() << std::endl;
} 
```

**老答案：**

在不使用 boost 的小而简单的任务中，我使用**dirent.h**。它可以作为 UNIX 中的标准头文件使用，也可以[通过 Toni Ronkko 创建的兼容层](https://github.com/tronkko/dirent)用于 Windows 。

```
DIR *dir;
struct dirent *ent;
if ((dir = opendir ("c:\\src\\")) != NULL) {
  /* print all the files and directories within directory */
  while ((ent = readdir (dir)) != NULL) {
    printf ("%s\n", ent->d_name);
  }
  closedir (dir);
} else {
  /* could not open directory */
  perror ("");
  return EXIT_FAILURE;
} 
```

它只是一个小头文件，无需使用像 boost 之类的大型基于模板的方法即可完成您需要的大部分简单工作（无意冒犯，我喜欢 boost！）。

* * *

## 回答 #2

> 赞同：443
> 
> 时间：2016-05-28T02:41:34.380

C++17 现在有一个[`std::filesystem::directory_iterator`](http://en.cppreference.com/w/cpp/filesystem/directory_iterator)，可以用作

```
#include <string>
#include <iostream>
#include <filesystem>
namespace fs = std::filesystem;

int main() {
    std::string path = "/path/to/directory";
    for (const auto & entry : fs::directory_iterator(path))
        std::cout << entry.path() << std::endl;
} 
```

此外，[`std::filesystem::recursive_directory_iterator`](http://en.cppreference.com/w/cpp/filesystem/recursive_directory_iterator)也可以迭代子目录。

* * *

## 回答 #3

> 赞同：236
> 
> 时间：2009-03-04T19:38:49.640

不幸的是，C++ 标准没有定义以这种方式处理文件和文件夹的标准方式。

由于没有跨平台的方式，最好的跨平台方式是使用诸如[boost filesystem 模块](http://www.boost.org/doc/libs/1_38_0/libs/filesystem/doc/index.htm)之类的库。

**跨平台升压方式：**

> 下面的函数，给定一个目录路径和一个文件名，递归地在目录及其子目录中搜索文件名，返回一个布尔值，如果成功，返回找到的文件的路径。
> 
> ```
> bool find_file(const path & dir_path,         // in this directory,
>                const std::string & file_name, // search for this name,
>                path & path_found)             // placing path here if found
> {
>     if (!exists(dir_path)) 
>         return false;
> 
>     directory_iterator end_itr; // default construction yields past-the-end
> 
>     for (directory_iterator itr(dir_path); itr != end_itr; ++itr)
>     {
>         if (is_directory(itr->status()))
>         {
>             if (find_file(itr->path(), file_name, path_found)) 
>                 return true;
>         }
>         else if (itr->leaf() == file_name) // see below
>         {
>             path_found = itr->path();
>             return true;
>         }
>     }
>     return false;
> } 
> ```

来自上面提到的 boost 页面。

**对于基于 Unix/Linux 的系统：**

您可以使用[opendir](http://www.manpagez.com/man/3/opendir/) / [readdir](http://www.manpagez.com/man/3/readdir/) / [closedir](http://www.manpagez.com/man/3/closedir/)。

> 在目录中搜索条目“名称”的示例代码是：
> 
> ```
> len = strlen(name);
> dirp = opendir(".");
> while ((dp = readdir(dirp)) != NULL)
>         if (dp->d_namlen == len && !strcmp(dp->d_name, name)) {
>                 (void)closedir(dirp);
>                 return FOUND;
>         }
> (void)closedir(dirp);
> return NOT_FOUND; 
> ```

来自上述手册页的源代码。

**对于基于 Windows 的系统：**

您可以使用 Win32 API [FindFirstFile](http://msdn.microsoft.com/en-us/library/aa364418(VS.85).aspx) / [FindNextFile](http://msdn.microsoft.com/en-us/library/aa364428(VS.85).aspx) / [FindClose](http://msdn.microsoft.com/en-us/library/aa364413(VS.85).aspx)函数。

> 以下 C++ 示例向您展示了 FindFirstFile 的最小用法。
> 
> ```
> #include <windows.h>
> #include <tchar.h>
> #include <stdio.h>
> 
> void _tmain(int argc, TCHAR *argv[])
> {
>    WIN32_FIND_DATA FindFileData;
>    HANDLE hFind;
> 
>    if( argc != 2 )
>    {
>       _tprintf(TEXT("Usage: %s [target_file]\n"), argv[0]);
>       return;
>    }
> 
>    _tprintf (TEXT("Target file is %s\n"), argv[1]);
>    hFind = FindFirstFile(argv[1], &FindFileData);
>    if (hFind == INVALID_HANDLE_VALUE) 
>    {
>       printf ("FindFirstFile failed (%d)\n", GetLastError());
>       return;
>    } 
>    else 
>    {
>       _tprintf (TEXT("The first file found is %s\n"), 
>                 FindFileData.cFileName);
>       FindClose(hFind);
>    }
> } 
> ```

以上msdn页面的源代码。

* * *

## 回答 #4

> 赞同：103
> 
> 时间：2013-12-30T20:56:40.690

***一个功能就足够了，您不需要使用任何 3rd-party 库（适用于 Windows）。***

```
#include <Windows.h>

vector<string> get_all_files_names_within_folder(string folder)
{
    vector<string> names;
    string search_path = folder + "/*.*";
    WIN32_FIND_DATA fd; 
    HANDLE hFind = ::FindFirstFile(search_path.c_str(), &fd); 
    if(hFind != INVALID_HANDLE_VALUE) { 
        do { 
            // read all (real) files in current folder
            // , delete '!' read other 2 default folder . and ..
            if(! (fd.dwFileAttributes & FILE_ATTRIBUTE_DIRECTORY) ) {
                names.push_back(fd.cFileName);
            }
        }while(::FindNextFile(hFind, &fd)); 
        ::FindClose(hFind); 
    } 
    return names;
} 
```

PS：正如@Sebastian 所提到的，您可以更改`*.*`为`*.ext`以仅获取该目录中的EXT 文件（即特定类型）。

* * *

## 回答 #5

> 赞同：59
> 
> 时间：2013-02-04T01:06:07.137

对于仅限 C 的解决方案，请查看此内容。它只需要一个额外的标题：

[https://github.com/cxong/tinydir](https://github.com/cxong/tinydir)

```
tinydir_dir dir;
tinydir_open(&dir, "/path/to/dir");

while (dir.has_next)
{
    tinydir_file file;
    tinydir_readfile(&dir, &file);

    printf("%s", file.name);
    if (file.is_dir)
    {
        printf("/");
    }
    printf("\n");

    tinydir_next(&dir);
}

tinydir_close(&dir); 
```

与其他选项相比的一些优势：

*   它是可移植的 - 包含 POSIX dirent 和 Windows FindFirstFile
*   它`readdir_r`在可用的地方使用，这意味着它（通常）是线程安全的
*   `UNICODE`通过相同的宏支持 Windows UTF-16
*   它是 C90，所以即使是非常古老的编译器也可以使用它

* * *

## 回答 #6

> 赞同：36
> 
> 时间：2014-07-11T17:15:55.163

我建议使用`glob`这个可重复使用的包装器。它生成一个`vector<string>`对应于符合 glob 模式的文件路径：

```
#include <glob.h>
#include <vector>
using std::vector;

vector<string> globVector(const string& pattern){
    glob_t glob_result;
    glob(pattern.c_str(),GLOB_TILDE,NULL,&glob_result);
    vector<string> files;
    for(unsigned int i=0;i<glob_result.gl_pathc;++i){
        files.push_back(string(glob_result.gl_pathv[i]));
    }
    globfree(&glob_result);
    return files;
} 
```

然后可以使用正常的系统通配符模式调用它，例如：

```
vector<string> files = globVector("./*"); 
```

* * *

## 回答 #7

> 赞同：28
> 
> 时间：2013-10-23T06:36:15.953

我认为，下面的代码片段可用于列出所有文件。

```
#include <stdio.h>
#include <dirent.h>
#include <sys/types.h>

int main(int argc, char** argv) { 
    list_dir("myFolderName");
    return EXIT_SUCCESS;
}  

static void list_dir(const char *path) {
    struct dirent *entry;
    DIR *dir = opendir(path);
    if (dir == NULL) {
        return;
    }

    while ((entry = readdir(dir)) != NULL) {
        printf("%s\n",entry->d_name);
    }

    closedir(dir);
} 
```

这是使用的结构（存在于 中`dirent.h`）：

```
struct dirent {
    ino_t d_ino; /* inode number */
    off_t d_off; /* offset to the next dirent */
    unsigned short d_reclen; /* length of this record */
    unsigned char d_type; /* type of file */
    char d_name[256]; /* filename */
}; 
```

* * *

## 回答 #8

> 赞同：26
> 
> 时间：2015-06-25T16:51:30.213

这是`C++11`使用`boost::filesystem`库获取目录中文件名的非常简单的代码（不包括文件夹名称）：

```
#include <string>
#include <iostream>
#include <boost/filesystem.hpp>
using namespace std;
using namespace boost::filesystem;

int main()
{
    path p("D:/AnyFolder");
    for (auto i = directory_iterator(p); i != directory_iterator(); i++)
    {
        if (!is_directory(i->path())) //we eliminate directories
        {
            cout << i->path().filename().string() << endl;
        }
        else
            continue;
    }
} 
```

输出如下：

```
file1.txt
file2.dat 
```

* * *

## 回答 #9

> 赞同：24
> 
> 时间：2014-02-10T18:57:27.943

为什么不使用`glob()`？

```
#include <glob.h>

glob_t glob_result;
glob("/your_directory/*",GLOB_TILDE,NULL,&glob_result);
for(unsigned int i=0; i<glob_result.gl_pathc; ++i){
  cout << glob_result.gl_pathv[i] << endl;
} 
```

* * *

## 回答 #10

> 赞同：11
> 
> 时间：2009-03-04T19:37:54.337

尝试提升 x 平台方法

[http://www.boost.org/doc/libs/1_38_0/libs/filesystem/doc/index.htm](http://www.boost.org/doc/libs/1_38_0/libs/filesystem/doc/index.htm)

或者只使用您的操作系统特定的文件内容。

* * *

## 回答 #11

> 赞同：9
> 
> 时间：2011-04-08T16:48:01.847

查看使用 win32 api 的此类。只需通过提供`foldername`您想要列表的实例来构造一个实例，然后调用该方法从目录`getNextFile`中获取下一个。`filename`我认为它需要`windows.h`和`stdio.h`.

```
class FileGetter{
    WIN32_FIND_DATAA found; 
    HANDLE hfind;
    char folderstar[255];       
    int chk;

public:
    FileGetter(char* folder){       
        sprintf(folderstar,"%s\\*.*",folder);
        hfind = FindFirstFileA(folderstar,&found);
        //skip .
        FindNextFileA(hfind,&found);        
    }

    int getNextFile(char* fname){
        //skips .. when called for the first time
        chk=FindNextFileA(hfind,&found);
        if (chk)
            strcpy(fname, found.cFileName);     
        return chk;
    }

}; 
```

* * *

## 回答 #12

> 赞同：6
> 
> 时间：2012-11-11T21:35:12.217

GNU 手册 FTW

[http://www.gnu.org/software/libc/manual/html_node/Simple-Directory-Lister.html#Simple-Directory-Lister](http://www.gnu.org/software/libc/manual/html_node/Simple-Directory-Lister.html#Simple-Directory-Lister)

此外，有时最好直接找到源头（双关语）。通过查看 Linux 中一些最常见命令的内部结构，您可以学到很多东西。我在 github 上设置了一个简单的 GNU coreutils 镜像（供阅读）。

[https://github.com/homer6/gnu_coreutils/blob/master/src/ls.c](https://github.com/homer6/gnu_coreutils/blob/master/src/ls.c)

也许这并不适用于 Windows，但使用这些方法可以有许多使用 Unix 变体的案例。

希望有帮助...

* * *

## 回答 #13

> 赞同：6
> 
> 时间：2018-03-13T06:38:01.503

Shreevardhan 的回答效果很好。但是如果你想在 c++14 中使用它，只需进行更改`namespace fs = experimental::filesystem;`

IE，

```
#include <string>
#include <iostream>
#include <filesystem>

using namespace std;
namespace fs = experimental::filesystem;

int main()
{
    string path = "C:\\splits\\";
    for (auto & p : fs::directory_iterator(path))
        cout << p << endl;
    int n;
    cin >> n;
} 
```

* * *

## 回答 #14

> 赞同：4
> 
> 时间：2012-03-29T21:12:31.950

```
char **getKeys(char *data_dir, char* tablename, int *num_keys)
{
    char** arr = malloc(MAX_RECORDS_PER_TABLE*sizeof(char*));
int i = 0;
for (;i < MAX_RECORDS_PER_TABLE; i++)
    arr[i] = malloc( (MAX_KEY_LEN+1) * sizeof(char) );  

char *buf = (char *)malloc( (MAX_KEY_LEN+1)*sizeof(char) );
snprintf(buf, MAX_KEY_LEN+1, "%s/%s", data_dir, tablename);

DIR* tableDir = opendir(buf);
struct dirent* getInfo;

readdir(tableDir); // ignore '.'
readdir(tableDir); // ignore '..'

i = 0;
while(1)
{

    getInfo = readdir(tableDir);
    if (getInfo == 0)
        break;
    strcpy(arr[i++], getInfo->d_name);
}
*(num_keys) = i;
return arr;
} 
```

* * *

## 回答 #15

> 赞同：3
> 
> 时间：2012-02-19T18:22:37.800

我希望这段代码对你有所帮助。

```
#include <windows.h>
#include <iostream>
#include <string>
#include <vector>
using namespace std;

string wchar_t2string(const wchar_t *wchar)
{
    string str = "";
    int index = 0;
    while(wchar[index] != 0)
    {
        str += (char)wchar[index];
        ++index;
    }
    return str;
}

wchar_t *string2wchar_t(const string &str)
{
    wchar_t wchar[260];
    int index = 0;
    while(index < str.size())
    {
        wchar[index] = (wchar_t)str[index];
        ++index;
    }
    wchar[index] = 0;
    return wchar;
}

vector<string> listFilesInDirectory(string directoryName)
{
    WIN32_FIND_DATA FindFileData;
    wchar_t * FileName = string2wchar_t(directoryName);
    HANDLE hFind = FindFirstFile(FileName, &FindFileData);

    vector<string> listFileNames;
    listFileNames.push_back(wchar_t2string(FindFileData.cFileName));

    while (FindNextFile(hFind, &FindFileData))
        listFileNames.push_back(wchar_t2string(FindFileData.cFileName));

    return listFileNames;
}

void main()
{
    vector<string> listFiles;
    listFiles = listFilesInDirectory("C:\\*.txt");
    for each (string str in listFiles)
        cout << str << endl;
} 
```

* * *

## 回答 #16

> 赞同：3
> 
> 时间：2014-07-03T15:40:08.980

系统调用它！

```
system( "dir /b /s /a-d * > file_names.txt" ); 
```

然后只需读取文件。

编辑：这个答案应该被认为是一个 hack，但如果您无法获得更优雅的解决方案，它确实有效（尽管以特定于平台的方式）。

* * *

## 回答 #17

> 赞同：3
> 
> 时间：2014-09-13T15:08:17.667

此实现实现了您的目的，使用指定目录的内容动态填充字符串数组。

```
int exploreDirectory(const char *dirpath, char ***list, int *numItems) {
    struct dirent **direntList;
    int i;
    errno = 0;

    if ((*numItems = scandir(dirpath, &direntList, NULL, alphasort)) == -1)
        return errno;

    if (!((*list) = malloc(sizeof(char *) * (*numItems)))) {
        fprintf(stderr, "Error in list allocation for file list: dirpath=%s.\n", dirpath);
        exit(EXIT_FAILURE);
    }

    for (i = 0; i < *numItems; i++) {
        (*list)[i] = stringDuplication(direntList[i]->d_name);
    }

    for (i = 0; i < *numItems; i++) {
        free(direntList[i]);
    }

    free(direntList);

    return 0;
} 
```

* * *

## 回答 #18

> 赞同：3
> 
> 时间：2021-01-14T01:38:58.123

```
#include <string>
#include <iostream>
#include <filesystem>
namespace fs = std::filesystem;

int main() {
    std::string path = "/path/to/directory";
    for (const auto & entry : fs::directory_iterator(path))
        std::cout << entry.path() << std::endl;
} 
```

* * *

## 回答 #19

> 赞同：2
> 
> 时间：2017-05-22T04:44:07.737

这对我有用。如果我不记得来源，我很抱歉。它可能来自手册页。

```
#include <ftw.h>

int AnalizeDirectoryElement (const char *fpath, 
                            const struct stat *sb,
                            int tflag, 
                            struct FTW *ftwbuf) {

  if (tflag == FTW_F) {
    std::string strFileName(fpath);

    DoSomethingWith(strFileName);
  }
  return 0; 
}

void WalkDirectoryTree (const char * pchFileName) {

  int nFlags = 0;

  if (nftw(pchFileName, AnalizeDirectoryElement, 20, nFlags) == -1) {
    perror("nftw");
  }
}

int main() {
  WalkDirectoryTree("some_dir/");
} 
```

* * *

## 回答 #20

> 赞同：2
> 
> 时间：2018-04-20T18:04:35.850

您可以使用 std::experimental::filesystem::directory_iterator() 获取根目录中的所有文件。然后，读取这些路径文件的名称。

```
#include <iostream>
#include <filesystem>
#include <string>
#include <direct.h>
using namespace std;
namespace fs = std::experimental::filesystem;
void ShowListFile(string path)
{
for(auto &p: fs::directory_iterator(path))  /*get directory */
     cout<<p.path().filename()<<endl;   // get file name
}

int main() {

ShowListFile("C:/Users/dell/Pictures/Camera Roll/");
getchar();
return 0;
} 
```

* * *

## 回答 #21

> 赞同：2
> 
> 时间：2018-09-04T00:24:04.057

这个答案应该适用于在使用 Visual Studio 和任何其他答案时遇到问题的 Windows 用户。

1.  从 github 页面下载 dirent.h 文件。但是最好只使用 Raw dirent.h 文件并按照下面的步骤操作（这就是我让它工作的方式）。

    适用于 Windows 的 dirent.h 的[Github 页面：dirent.h 的 Github 页面](https://github.com/tronkko/dirent/blob/master/include/dirent.h)

    原始 Dirent 文件：[原始 dirent.h 文件](https://raw.githubusercontent.com/tronkko/dirent/master/include/dirent.h)

2.  转到您的项目并添加一个新项目 ( `Ctrl`+ `Shift`+ `A`)。添加头文件 (.h) 并将其命名为 dirent.h。

3.  [将Raw dirent.h 文件](https://raw.githubusercontent.com/tronkko/dirent/master/include/dirent.h)代码粘贴到您的标题中。

4.  在您的代码中包含“dirent.h”。

5.  将以下`void filefinder()`方法放入您的代码中并从您的`main`函数中调用它或编辑您想要如何使用它的函数。

    ```
    #include <stdio.h>
    #include <string.h>
    #include "dirent.h"

    string path = "C:/folder"; //Put a valid path here for folder

    void filefinder()
    {
        DIR *directory = opendir(path.c_str());
        struct dirent *direntStruct;

        if (directory != NULL) {
            while (direntStruct = readdir(directory)) {
                printf("File Name: %s\n", direntStruct->d_name); //If you are using <stdio.h>
                //std::cout << direntStruct->d_name << std::endl; //If you are using <iostream>
            }
        }
        closedir(directory);
    } 
    ```

* * *

## 回答 #22

> 赞同：1
> 
> 时间：2018-04-10T15:16:07.110

由于一个目录的文件和子目录一般都存储在树形结构中，一个直观的方法是使用DFS算法对它们进行递归遍历。这是一个使用 io.h 中的基本文件函数在 windows 操作系统中的示例。您可以在其他平台上替换这些功能。我想表达的是，DFS的基本思想完美的解决了这个问题。

```
#include<io.h>
#include<iostream.h>
#include<string>
using namespace std;

void TraverseFilesUsingDFS(const string& folder_path){
   _finddata_t file_info;
   string any_file_pattern = folder_path + "\\*";
   intptr_t handle = _findfirst(any_file_pattern.c_str(),&file_info);
   //If folder_path exsist, using any_file_pattern will find at least two files "." and "..", 
   //of which "." means current dir and ".." means parent dir
   if (handle == -1){
       cerr << "folder path not exist: " << folder_path << endl;
       exit(-1);
   }
   //iteratively check each file or sub_directory in current folder
   do{
       string file_name=file_info.name; //from char array to string
       //check whtether it is a sub direcotry or a file
       if (file_info.attrib & _A_SUBDIR){
            if (file_name != "." && file_name != ".."){
               string sub_folder_path = folder_path + "\\" + file_name;                
               TraverseFilesUsingDFS(sub_folder_path);
               cout << "a sub_folder path: " << sub_folder_path << endl;
            }
       }
       else
            cout << "file name: " << file_name << endl;
    } while (_findnext(handle, &file_info) == 0);
    //
    _findclose(handle);
} 
```

* * *

## 回答 #23

> 赞同：1
> 
> 时间：2018-09-25T13:10:15.423

我尝试按照[两个](https://stackoverflow.com/a/37494654/23264#answer-612176) [答案](https://stackoverflow.com/a/37494654/23264#answer-37494654)中给出的示例进行操作，可能值得注意的是，它似乎`std::filesystem::directory_entry`已更改为没有`<<`运算符重载。而不是`std::cout << p << std::endl;`我必须使用以下内容才能编译并使其工作：

```
#include <iostream>
#include <filesystem>
#include <string>
namespace fs = std::filesystem;

int main() {
    std::string path = "/path/to/directory";
    for(const auto& p : fs::directory_iterator(path))
        std::cout << p.path() << std::endl;
} 
```

试图`p`自行传递`std::cout <<`导致丢失重载错误。

* * *

## 回答 #24

> 赞同：1
> 
> 时间：2019-08-30T15:46:49.647

基于 herohuyongtao 发布的内容和其他一些帖子：

[http://www.cplusplus.com/forum/general/39766/](http://www.cplusplus.com/forum/general/39766/)

[FindFirstFile 的预期输入类型是什么？](https://stackoverflow.com/questions/17534946/what-is-the-expected-input-type-of-findfirstfile)

[如何将 wstring 转换为字符串？](https://stackoverflow.com/questions/4804298/how-to-convert-wstring-into-string)

这是一个 Windows 解决方案。

因为我想传入 std::string 并返回一个字符串向量，所以我必须进行几次转换。

```
#include <string>
#include <Windows.h>
#include <vector>
#include <locale>
#include <codecvt>

std::vector<std::string> listFilesInDir(std::string path)
{
    std::vector<std::string> names;
    //Convert string to wstring
    std::wstring search_path = std::wstring_convert<std::codecvt_utf8<wchar_t>>().from_bytes(path);
    WIN32_FIND_DATA fd;
    HANDLE hFind = FindFirstFile(search_path.c_str(), &fd);
    if (hFind != INVALID_HANDLE_VALUE) 
    {
        do 
        {
            // read all (real) files in current folder
            // , delete '!' read other 2 default folder . and ..
            if (!(fd.dwFileAttributes & FILE_ATTRIBUTE_DIRECTORY)) 
            {
                //convert from wide char to narrow char array
                char ch[260];
                char DefChar = ' ';
                WideCharToMultiByte(CP_ACP, 0, fd.cFileName, -1, ch, 260, &DefChar, NULL);
                names.push_back(ch);
            }
        } 
        while (::FindNextFile(hFind, &fd));
        ::FindClose(hFind);
    }
    return names;
} 
```

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2018-09-29T10:54:16.243

只是我想分享的东西，并感谢您的阅读材料。玩弄一下这个函数来理解它。你可能会喜欢。e 代表扩展，p 代表路径，s 代表路径分隔符。

如果传递的路径没有结束分隔符，则分隔符将附加到路径。对于扩展名，如果输入了空字符串，则该函数将返回名称中没有扩展名的任何文件。如果输入了单个星号，则将返回目录中的所有文件。如果 e 长度大于 0 但不是单个 *，则如果 e 在零位置不包含点，则将在 e 前面添加一个点。

对于返回值。如果返回零长度映射，则没有找到任何内容，但目录打开正常。如果索引 999 可从返回值获得，但地图大小仅为 1，则意味着打开目录路径时出现问题。

请注意，为了提高效率，此功能可以拆分为 3 个较小的功能。最重要的是，您可以创建一个调用函数，该函数将根据输入检测将要调用的函数。为什么这样更有效率？说如果您要抓取文件中的所有内容，那么执行该方法时，为抓取所有文件而构建的子函数只会抓取所有文件，并且每次找到文件时都不需要评估任何其他不必要的条件。

这也适用于您抓取没有扩展名的文件时。用于该目的的特定构建函数只会在找到的对象是文件时评估天气，然后判断文件名中是否包含点。

如果您只读取文件不多的目录，则节省可能不多。但是，如果您正在阅读大量目录，或者该目录有几十万个文件，则可能会节省大量资金。

```
#include <stdio.h>
#include <sys/stat.h>
#include <iostream>
#include <dirent.h>
#include <map>

std::map<int, std::string> getFile(std::string p, std::string e = "", unsigned char s = '/'){
    if ( p.size() > 0 ){
        if (p.back() != s) p += s;
    }
    if ( e.size() > 0 ){
        if ( e.at(0) != '.' && !(e.size() == 1 && e.at(0) == '*') ) e = "." + e;
    }

    DIR *dir;
    struct dirent *ent;
    struct stat sb;
    std::map<int, std::string> r = {{999, "FAILED"}};
    std::string temp;
    int f = 0;
    bool fd;

    if ( (dir = opendir(p.c_str())) != NULL ){
        r.erase (999);
        while ((ent = readdir (dir)) != NULL){
            temp = ent->d_name;
            fd = temp.find(".") != std::string::npos? true : false;
            temp = p + temp;

            if (stat(temp.c_str(), &sb) == 0 && S_ISREG(sb.st_mode)){
                if ( e.size() == 1 && e.at(0) == '*' ){
                    r[f] = temp;
                    f++;
                } else {
                    if (e.size() == 0){
                        if ( fd == false ){
                            r[f] = temp;
                            f++;
                        }
                        continue;
                    }

                    if (e.size() > temp.size()) continue;

                    if ( temp.substr(temp.size() - e.size()) == e ){
                        r[f] = temp;
                        f++;
                    }
                }
            }
        }

        closedir(dir);
        return r;
    } else {
        return r;
    }
}

void printMap(auto &m){
    for (const auto &p : m) {
        std::cout << "m[" << p.first << "] = " << p.second << std::endl;
    }
}

int main(){
    std::map<int, std::string> k = getFile("./", "");
    printMap(k);
    return 0;
} 
```

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2019-12-10T01:45:22.617

```
#include<iostream>
#include <dirent.h>
using namespace std;
char ROOT[]={'.'};

void listfiles(char* path){
    DIR * dirp = opendir(path);
    dirent * dp;
    while ( (dp = readdir(dirp)) !=NULL ) {
         cout << dp->d_name << " size " << dp->d_reclen<<std::endl;
    }
    (void)closedir(dirp);
}

int main(int argc, char **argv)
{
    char* path;
    if (argc>1) path=argv[1]; else path=ROOT;

    cout<<"list files in ["<<path<<"]"<<std::endl;
    listfiles(path);

    return 0;
} 
```

* * *

## 回答 #27

> 赞同：0
> 
> 时间：2020-09-27T16:03:51.510

尝试`scandir()`从`dirent.h`

[`man scandir()`](https://linux.die.net/man/3/scandir)

* * *

## 回答 #28

> 赞同：0
> 
> 时间：2021-01-13T15:59:23.060

根据上面的答案

```
#include <vector>
#include <string>
#include <algorithm>

#ifdef _WIN32
#include <windows.h>
std::vector<std::string> files_in_directory(std::string path)
{
    std::vector<std::string> files;

    // check directory exists
    char fullpath[MAX_PATH];
    GetFullPathName(path.c_str(), MAX_PATH, fullpath, 0);
    std::string fp(fullpath);
    if (GetFileAttributes(fp.c_str()) != FILE_ATTRIBUTE_DIRECTORY)
        return files;

    // get file names
    WIN32_FIND_DATA findfiledata;
    HANDLE hFind = FindFirstFile((LPCSTR)(fp + "\\*").c_str(), &findfiledata);
    if (hFind != INVALID_HANDLE_VALUE)
    {
        do 
        {
            files.push_back(findfiledata.cFileName);
        } 
        while (FindNextFile(hFind, &findfiledata));
        FindClose(hFind);
    }

    // delete current and parent directories
    files.erase(std::find(files.begin(), files.end(), "."));
    files.erase(std::find(files.begin(), files.end(), ".."));

    // sort in alphabetical order
    std::sort(files.begin(), files.end());

    return files;
}
#else
#include <dirent.h>
std::vector<std::string> files_in_directory(std::string directory)
{
    std::vector<std::string> files;

    // open directory
    DIR *dir;
    dir = opendir(directory.c_str());
    if (dir == NULL)
        return files;

    // get file names
    struct dirent *ent;
    while ((ent = readdir(dir)) != NULL)
        files.push_back(ent->d_name);
    closedir(dir);

    // delete current and parent directories
    files.erase(std::find(files.begin(), files.end(), "."));
    files.erase(std::find(files.begin(), files.end(), ".."));

    // sort in alphabetical order
    std::sort(files.begin(), files.end());

    return files;
}
#endif  // _WIN32 
```

* * *

## 回答 #29

> 赞同：0
> 
> 时间：2021-11-16T15:45:12.810

Shreevardhan 的设计也适用于遍历子目录：

```
#include <string>
#include <iostream>
#include <filesystem>

using namespace std;
namespace fs = filesystem;
int main()
{
    string path = "\\path\\to\\directory";
    // string path = "/path/to/directory";
    for (auto & p : fs::recursive_directory_iterator(path))
        cout << p.path() << endl;
} 
```

汇编：`cl /EHsc /W4 /WX /std:c++17 ListFiles.cpp`

* * *

## 回答 #30

> 赞同：-1
> 
> 时间：2017-06-28T05:23:35.003

这对我有用。它写入一个仅包含所有文件名称（无路径）的文件。然后它会读取该 txt 文件并为您打印。

```
void DisplayFolderContent()
    {

        system("dir /n /b * > file_names.txt");
        char ch;
        std::fstream myStream("file_names.txt", std::fstream::in);
        while (myStream.get(ch))
        {
            std::cout << ch;
        }

    } 
```

* * *

## 回答 #31

> 赞同：-3
> 
> 时间：2021-11-16T16:50:01.093

贡献给[Cesar Alejandro Montero Orozco 的回答](https://stackoverflow.com/a/44794233/14048071)。

简单中有美，通过添加`/s`密钥，我们还可以遍历子目录。

```
system("dir /n /b /s * > file_names.txt"); 
```

# java - 单词类的在线（最好）查找API

> ID：612102
> 
> 赞同：1
> 
> 时间：2009-03-04T19:37:13.823
> 
> 标签：java, web-services, nlp

我有一个单词列表，我想对其进行过滤，以便我只有该单词列表中的名词（使用 Java）。为此，我正在寻找一种简单的方法来查询单词数据库的类型。

我的问题是，有没有人知道一个免费的、简单的单词查找 API，它可以让我找到一个单词的*类别*，而不一定是它的语义定义。

谢谢！

本。

编辑：我的意思是“词性”这个词的类，谢谢你澄清这个

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-04T19:43:50.437

字型？比如动词、名词、形容词等？如果是这样，您可能会遇到一些单词可以以多种方式使用的问题。例如：“你能把那张卡交易给我吗？”、“那是一笔糟糕的交易。”

请参阅[此线程](https://stackoverflow.com/questions/216612/dictionary-api-or-library)以获取一些建议。

也看看[这个](http://wordnetweb.princeton.edu/perl/webwn)，似乎它可能完全符合您的要求。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-11T08:00:04.347

我认为您正在寻找的是单词的词性（POS）。一般来说，除非在句子的上下文中，否则无法确定。有很多词可以有几个不同的潜在词性（例如，“银行”可以用作动词或名词）。

您可以使用 POS 标记器来获取您想要的信息。但是，以下词性标注器假设您在一个结构良好的英语句子中标注单词......

*   OpenNLP Java 库通常非常好，并在 LGPL 下发布[。](http://opennlp.sourceforge.net/)发行版中包含英语和其他几种语言的词性标注器。只需到项目页面获取 jar（也不要忘记下载模型）。

*   还有[斯坦福词性标注器](http://nlp.stanford.edu/software/tagger.shtml)，在 GPL 下用 Java 编写。我对这个库没有任何直接的经验，但斯坦福 NLP 实验室通常非常棒。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-05T03:38:07.553

查询单词数据库将导致 Ben S. 提到的问题，例如它是领先（v. to show the way）还是领先（n. Pb）。如果您想花一些时间解决这个问题，请查看词性标记。[在另一个 SO 线程](https://stackoverflow.com/questions/608743/strategies-for-recognizing-proper-nouns-in-nlp)中有一些很好的信息。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-05T03:56:31.050

对于英语，您可以使用 WordNet 和[可用的 Java API](http://wordnet.princeton.edu/links#Java)之一来查找单词的[词汇类别](http://en.wikipedia.org/wiki/Lexical_category)（在 NLP 中最常称为*词性*）。使用专用的[词性标注器](http://en.wikipedia.org/wiki/Part-of-speech_tagging)是另一种选择。

# php - 如何通过 SSH 运行 php 脚本？

> ID：612115
> 
> 赞同：13
> 
> 时间：2009-03-04T19:39:10.340
> 
> 标签：php, ssh

我有一个相当长的 php 脚本，每当我的互联网连接跳出一秒钟时，浏览器似乎就会停止脚本。我不能坐 8 个小时让我的脚本运行，所以我想我可以通过 ssh 运行它，然后第二天回来获取我的输出文件。然而，简单地将脚本名称输入 ssh 似乎不起作用。是否有通过 ssh 运行 php 脚本的特殊命令？

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-03-04T19:47:31.553

如果您的互联网连接中断，那么这可能也是 SSH 的问题，而且，打开 SSH 窗口并不总是最好的做法（如果您不小心关闭了 ssh 窗口会发生什么情况？ )

我建议通过 SSH 连接到服务器，然后运行一个名为“ [screen](http://en.wikipedia.org/wiki/GNU_Screen) ”的程序，它会继续运行你在其中运行的任何内容，即使你的连接断开。

为此，首先 ssh 进入服务器，然后键入

`screen`

这将加载屏幕，按 Enter 绕过欢迎屏幕

现在，运行您的 PHP 脚本

`php /path/to/your/php/script.php`

这将启动 PHP 运行，

您现在可以根据需要关闭窗口，脚本将继续运行

要返回屏幕会话，请连接到服务器，然后运行命令

`screen -raAD`

这将使您重新连接到您的会话，就好像您一直打开窗口一样。

这实际上非常适合运行冗长的脚本，甚至是运行基于控制台的 IRC 会话：D

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-03-04T19:40:42.520

一般来说，您应该能够像这样从命令行运行脚本

```
php myscript.php 
```

通过 ssh 在远程主机上执行此操作可以像这样完成

```
ssh phpnewb@myhost.com "php myscript.php" 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-03-04T20:09:19.363

除了其他人所说的之外，您可能还想使用`nohup`。

```
ssh user@host "nohup php script.php" 
```

这样，即使您的*ssh*连接断开，它也会继续运行。如果需要，您也可以使用`screen`代替`nohup`。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-03-04T19:42:31.830

尝试

```
php script.php. 
```

如果这不起作用，则必须找到 php 可执行文件，然后执行它。

顺便说一句，您可以使用屏幕，因此如果与计算机的连接丢失，脚本仍会运行。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-03-31T09:50:33.363

nohup php -q /path-to-script/file.php & 退出

将执行 php 文件并关闭控制台而不终止进程。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-04T19:45:12.727

或者，您可以[`ignore_user_abort()`](http://www.php.net/ignore_user_abort)在点击页面后调用并关闭浏览器。

# javascript - ASP.NET AJAX 3.5 和 IE6？

> ID：612118
> 
> 赞同：2
> 
> 时间：2009-03-04T19:39:36.690
> 
> 标签：javascript, .net-3.5, asp.net-ajax, internet-explorer-6

我最近将一个 ASP.NET 应用程序升级到 .NET 3.5 并切换到更新版本的 ASP.NET AJAX 库。

在 FireFox 和 IE7 中，一切正常，在 IE6 中，任何会执行回调（部分刷新，或调用 PageMethod/WebMethod）的东西都会引发错误：

```
Object Doesn't support this property or method
Line: 5175
Char: 9 
```

.NET 3.5 和 IE6 是否存在已知的兼容性问题？

编辑：

我在 IE6 上附加了一个调试器，并且能够找到它正在中断的确切行：

```
 this._xmlHttpRequest.open(verb, this._webRequest.getResolvedUrl(), true /*async*/); 
```

似乎 IE6 拒绝了“打开”的权限。这不是跨站请求，所以很疑惑。该站点当前在映射到本地服务器的假主机名上运行，而不是在实际域上运行，但我认为这不会有所作为。

编辑：我添加了一个赏金，这个错误仍然让我发疯......HALP！

编辑：

找到解决方案！

这篇[论坛帖子](http://forums.asp.net/p/1326906/2944515.aspx)让我好奇地搜索了 MXSML，果然，框架库中有一个错字。

MsXML 被键入为 MXsml。

当然，在处理汇编脚本时，您无法修复它们，但我安装了 SP1，希望它们在那里得到更正。他们是......所以，如果你有这个问题，安装 .NET 3.5 SP1，它就会消失。

哇！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-09T16:43:06.323

你是如何在 IE6 中测试的？当您使用除了干净安装的 IE6 和 asp.net ajax 库之外的任何东西时，我遇到了几个 javascript 错误。（即 asp.net ajax 库不支持多次安装 IE，甚至不支持[IETester](http://www.my-debugbar.com/wiki/IETester/HomePage)）

当使用多个版本的 IE 时，IE 安全模型中的某些东西会使事情变得混乱。您会发现除了您正在运行的系统上的“已安装”版本的 IE 之外，cookie 也无法正常工作。

您还可以在此处查找有关多个 IE 安装的[更多信息。](http://tredosoft.com/Multiple_IE)如果发现评论特别有帮助！

**更新** 我能够挖掘，这在[asp.netfourms](http://forums.asp.net/p/1326906/2944515.aspx)中。这是我唯一能找到的其他东西。可能不会太有帮助，但至少听起来像你在打什么。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-04T21:38:47.883

根据[MSDN](http://msdn.microsoft.com/en-us/library/bb470452.aspx)支持 IE6。确保安全区域设置中的 Internet 区域设置为中。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-03-09T17:22:42.670

另一个来自 asp.net 论坛

[http://forums.asp.net/p/1376680/2896886.aspx](http://forums.asp.net/p/1376680/2896886.aspx)

可能是由不同版本的 XmlHttpRequest 对象引起的

# winapi - 如何在 Windows 文件对话框的“保存”按钮上设置文本？

> ID：612119
> 
> 赞同：3
> 
> 时间：2009-03-04T19:40:03.973
> 
> 标签：winapi, dialog

我正在尝试在 Windows“将文件另存为...”对话框的“保存”按钮上设置文本。

我已经设置了钩子，收到了消息，找到了按钮（注意，如果我调用“ `GetWindowText()`”，我会看到“&Save”，所以我知道它是正确的按钮）。

接下来我使用“ `SetWindowText()`”更改了文本（并调用“ `GetWindowText()`”来检查它 - 文本是正确的）。

但是......按钮仍然显示“保存”。

我可以使用完全相同的代码更改“取消”按钮 - 没问题。“保存”按钮有什么特别之处？我怎样才能改变它。

代码（对于它的价值）：

```
static UINT_PTR CALLBACK myHook(HWND hwnd, UINT msg, WPARAM, LPARAM)
{
  if (msg == WM_INITDIALOG) {
    wchar_t temp[100];
    HWND h = GetDlgItem(GetParent(hwnd),IDOK);
    GetWindowTextW(h,temp,100);     // temp=="&Save"
    SetWindowTextW(h,L"Testing");
    GetWindowTextW(h,temp,100);     // temp=="Testing"
  }
} 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-05T16:11:32.033

我终于让它工作了......

我很确定“保存”按钮会发生一些有趣的事情，但这段代码会努力将其提交：

```
// I replace the dialog's WindowProc with this
static WNDPROC oldProc = NULL;
static BOOL CALLBACK buttonSetter(HWND hwnd, UINT msg, WPARAM wParam, LPARAM lParam)
{
    // Set the button text on every window redraw....
    if (msg == WM_ERASEBKGND) {
        SetDlgItemTextW(hwnd,IDOK,L"OK");
    }
    return oldProc(hwnd, msg, wParam, lParam);
};

// This is the callback for the GetWriteName hook
static UINT_PTR CALLBACK GWNcallback(HWND hwnd, UINT msg, WPARAM wParam, LPARAM lParam)
{
    HWND dlg = GetParent(hwnd);
    if (msg == WM_INITDIALOG) {
        oldProc = (WNDPROC)GetWindowLongPtr(dlg, GWL_WNDPROC);
        if (oldProc !=0) {
            SetWindowLongPtr(dlg, GWL_WNDPROC, (LONG)buttonSetter);
        }
    }
    // We need extra redraws to make our text appear...
    InvalidateRect(dlg,0,1);
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-04T19:59:33.847

您可能需要在设置文本后重新绘制窗口。

设置文本后尝试调用 UpdateWindow()。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-04T20:13:23.330

使用 CDM_SETCONTROLTEXT 消息来设置文本而不是直接乱用 SetWindowText，即

```
SendMessage(hwnd, CDM_SETCONTROLTEXT, IDOK, L"Testing"); 
```

[http://msdn.microsoft.com/en-us/library/ms646960(VS.85).aspx](http://msdn.microsoft.com/en-us/library/ms646960(VS.85).aspx)有更多关于自定义打开/保存对话框

# java - 使用 Java 保护查询字符串的最佳方法是什么？

> ID：612121
> 
> 赞同：2
> 
> 时间：2009-03-04T19:40:42.177
> 
> 标签：java, security, url, encryption

当用户在我们的 Struts 应用程序中注册时，我们希望向他们发送一封电子邮件，其中包含指向不同页面的链接。该链接需要在其查询字符串中包含一个唯一标识符，以便目标页面可以识别用户并做出相应的反应。

为了提高这个系统的安全性，我想首先加密包含标识符的查询字符串，然后将链接设置为过期——在它被使用后和/或几天后。

您建议我使用哪些 Java 技术/方法来执行此操作？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-04T19:48:02.330

我将对您的担忧做一些假设：

1.  用户不应该能够猜出另一个用户的 URL。
2.  一旦使用，URL 就不能重复使用（避免会话重放攻击。）
3.  无论是否使用，URL 都不应该永远存在，从而避免暴力探测。

这就是我的做法。

*   将用户的 ID 和过期时间戳保存在一个表中。
*   将它们连接成一个字符串，然后从中生成一个 SHA-1 哈希。
*   使用 SHA-1 哈希值生成 URL。将所有此类 URL 映射到将进行验证的 servlet。
*   当有人向您发送带有哈希的页面请求时，使用它来查找用户和过期时间。
*   在用户完成着陆页应该做的任何事情后，将数据库中的行标记为“已使用”。
*   每天运行一项作业以清除已使用或已过期的行。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-04T19:45:11.947

对于第一部分，看看[生成私有、唯一、安全的 URL](https://stackoverflow.com/questions/599535/generating-private-unique-secure-urls)。对于过期，您只需将唯一的密钥创建时间戳存储在数据库中，并且只允许您的操作在例如​​ now-keyCreatedAt<3 天时执行。另一种方法是让 cron 或[Quartz](http://www.quartz-scheduler.org/)作业定期删除那些评估为“now-keyCreatedAt<3 days”的行。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-04T21:42:22.477

我认为您可以以无状态方式执行此操作，即没有其他人建议的数据库表。

*   正如 mtnygard 建议的那样，对 URL 参数和一个秘密盐字符串进行 SHA-1 哈希。
*   将哈希值添加为 URL 上的必需参数。
*   在电子邮件中发送 URL。

当用户点击 URL 时：

*   通过再次计算哈希值并将计算值与 URL 上的值进行比较来验证 URL 的完整性。

只要你不泄露你的秘密盐串，就没有人能够伪造对系统的请求。但是，与其他提案不同，此提案不会阻止重播旧 URL。这可能是可取的，也可能不是可取的，这取决于您的情况。

# visual-studio-2008 - 重新显示堆栈跟踪窗口

> ID：612123
> 
> 赞同：5
> 
> 时间：2009-03-04T19:40:43.067
> 
> 标签：visual-studio-2008

我不小心关闭了 Visual Studio 2008 调试器中的 Stack Trace 窗口。如何重新显示此窗口？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-03-04T19:42:19.723

调试时：Debug\Windows\Call stack

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-04T19:42:17.243

在调试/Windows 中。

# asp.net - 如何从 ASPX 控件事件中调用 Javascript 函数？

> ID：612124
> 
> 赞同：2
> 
> 时间：2009-03-04T19:40:56.810
> 
> 标签：asp.net, javascript

如何从 ASPX 控件事件中调用 Javascript 函数？

具体来说，我想从 DropDownList 的 SelectedIndexChanged 事件中调用该函数。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-03-04T19:46:55.267

每次看到这种问题我都会有点紧张，因为十有八九这意味着提问者并不真正理解发生了什么。

当您的 SelectedIndexChanged 事件在服务器上触发时，它会作为*完整回*发的一部分触发。这意味着要运行该代码，您的页面加载代码的其余部分也必须运行。

不仅如此，代码作为来自浏览器的新 http 请求的结果运行。就浏览器而言，结果中将返回一个全新的页面。旧页面和旧 DOM 被丢弃。因此，在您的 SelectedIndexChanged 事件代码运行时，您要调用的 javascript 函数甚至不存在于浏览器中。

那么该怎么做呢？你有几个选择：

*   更改页面，使控件根本不会回发到服务器。完全在客户端的 javascript 中检测更改。这是我的首选选项，因为它避免了浏览器页面中奇怪的加载脚本，并为您的服务器节省了工作量。不利的一面是它使您的页面依赖于javascript，但这并不是什么大问题，因为如果禁用javascript，这从一开始就注定要失败。
*   使用 ClientScript.SetStartupScript() 将所需的 javascript 设置为在 SelectedIndexChanged 事件中运行 onload。
*   将 javascript 的预期结果应用于页面的服务器模型。这具有即使关闭 javascript（可访问性）也能工作的优势，但代价是在服务器上做更多工作，花费更多时间推理页面的逻辑状态，并且可能需要复制客户端和服务器端逻辑。此外，此事件无论如何都取决于 javascript：如果禁用了 javascript，它将不会触发。
*   第一个和第三个选项的某种组合也是可能的，例如它在本地使用javascript（如果可用），但如果没有则回发到服务器。就我个人而言，我希望看到对 ASP.Net 中内置的更好、更直观的支持。但再说一遍：我说的是一般情况。这个特定的事件需要 javascript 才能工作。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-04T19:48:54.933

正如 Muerte 所说，您只需将 javascript 或从后面的代码调用到页面上即可。我个人使用这个：

```
ClientScript.RegisterClientScriptBlock("customscript", "<script>simple script here</script>") 
```

如果您在页面上已经有一个更复杂的功能而不是我拥有的东西，您可以调用该功能。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-04T19:45:35.940

您不能直接从事件中执行此操作，因为 ASPX 控件事件是服务器端的。

您可以做的是在 ASPX 事件中发出一个 Javascript，该事件将在页面重新加载时调用 JavaScript 函数。

例如，如果在您的 ASPX 页面中有一个名为“DoSomething()”的 Javascript 函数，则在您的 ASPX 控件事件中，添加以下内容：

```
protected void btnSubmit_Click(object sender, EventArgs e)
{
    Page.ClientScript.RegisterStartupScript(this.GetType(), "myEvent", "DoSomething()", true);
} 
```

最后一个布尔参数定义自动添加标签。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-04T20:28:20.847

在后面的代码中，通过属性集合将一些标记附加到服务器端控件。这假定该函数已经在页面可用的客户端脚本文件中。

```
MyServerDDLControl.Attributes.Add("SelectedIndexChanged", "MyClientSideFunction();"); 
```

# ios - 如何使用 iOS 轻松调整/优化图像大小？

> ID：612131
> 
> 赞同：116
> 
> 时间：2009-03-04T19:42:42.157
> 
> 标签：ios, objective-c, image, cocoa-touch, resize

我的应用程序正在从网络下载一组图像文件，并将它们保存到本地 iPhone 磁盘。其中一些图像的尺寸相当大（例如，宽度大于 500 像素）。由于 iPhone 甚至没有足够大的显示屏来显示原始尺寸的图像，因此我计划将图像大小调整为更小的尺寸以节省空间/性能。

此外，其中一些图像是 JPEG，它们没有保存为通常的 60% 质量设置。

如何使用 iPhone SDK 调整图片大小，如何更改 JPEG 图像的质量设置？

* * *

## 回答 #1

> 赞同：247
> 
> 时间：2009-03-05T02:20:22.933

提供了一些建议作为[此问题](https://stackoverflow.com/questions/603907/uiimage-resize-then-crop)的答案。我已经建议了[这篇文章](http://ofcodeandmen.poltras.com/2008/10/30/undocumented-uiimage-resizing/)中描述的技术，以及相关的代码：

```
+ (UIImage*)imageWithImage:(UIImage*)image 
               scaledToSize:(CGSize)newSize;
{
   UIGraphicsBeginImageContext( newSize );
   [image drawInRect:CGRectMake(0,0,newSize.width,newSize.height)];
   UIImage* newImage = UIGraphicsGetImageFromCurrentImageContext();
   UIGraphicsEndImageContext();

   return newImage;
} 
```

就图像的存储而言，iPhone 使用最快的图像格式是 PNG，因为它对该格式进行了优化。但是，如果您想将这些图像存储为 JPEG，您可以使用 UIImage 并执行以下操作：

```
NSData *dataForJPEGFile = UIImageJPEGRepresentation(theImage, 0.6); 
```

这将创建一个 NSData 实例，其中包含质量设置为 60% 的 JPEG 图像的原始字节。然后可以将该 NSData 实例的内容写入磁盘或缓存在内存中。

* * *

## 回答 #2

> 赞同：65
> 
> 时间：2009-03-05T04:35:31.003

调整图像大小的最简单和最直接的方法是

```
float actualHeight = image.size.height;
float actualWidth = image.size.width;
float imgRatio = actualWidth/actualHeight;
float maxRatio = 320.0/480.0;

if(imgRatio!=maxRatio){
    if(imgRatio < maxRatio){
        imgRatio = 480.0 / actualHeight;
        actualWidth = imgRatio * actualWidth;
        actualHeight = 480.0;
    }
    else{
        imgRatio = 320.0 / actualWidth;
        actualHeight = imgRatio * actualHeight;
        actualWidth = 320.0;
    }
}
CGRect rect = CGRectMake(0.0, 0.0, actualWidth, actualHeight);
UIGraphicsBeginImageContext(rect.size);
[image drawInRect:rect];
UIImage *img = UIGraphicsGetImageFromCurrentImageContext();
UIGraphicsEndImageContext(); 
```

* * *

## 回答 #3

> 赞同：25
> 
> 时间：2014-09-01T11:03:22.917

上述方法适用于小图像，但是当您尝试调整非常大的图像时，您将很快耗尽内存并导致应用程序崩溃。更好的方法是`CGImageSourceCreateThumbnailAtIndex`在不先完全解码的情况下调整图像大小。

如果您有要调整大小的图像的路径，则可以使用以下命令：

```
- (void)resizeImageAtPath:(NSString *)imagePath {
    // Create the image source (from path)
    CGImageSourceRef src = CGImageSourceCreateWithURL((__bridge CFURLRef) [NSURL fileURLWithPath:imagePath], NULL);

    // To create image source from UIImage, use this
    // NSData* pngData =  UIImagePNGRepresentation(image);
    // CGImageSourceRef src = CGImageSourceCreateWithData((CFDataRef)pngData, NULL);

    // Create thumbnail options
    CFDictionaryRef options = (__bridge CFDictionaryRef) @{
            (id) kCGImageSourceCreateThumbnailWithTransform : @YES,
            (id) kCGImageSourceCreateThumbnailFromImageAlways : @YES,
            (id) kCGImageSourceThumbnailMaxPixelSize : @(640)
    };
    // Generate the thumbnail
    CGImageRef thumbnail = CGImageSourceCreateThumbnailAtIndex(src, 0, options); 
    CFRelease(src);
    // Write the thumbnail at path
    CGImageWriteToFile(thumbnail, imagePath);
} 
```

更多细节[在这里](http://pulkitgoyal.in/resizing-high-resolution-images-on-ios-without-memory-issues/)。

* * *

## 回答 #4

> 赞同：18
> 
> 时间：2013-05-03T08:40:52.137

在不丢失纵横比的情况下缩放图像（即不拉伸图像）的最佳方法是使用以下方法：

```
//to scale images without changing aspect ratio
+ (UIImage *)scaleImage:(UIImage *)image toSize:(CGSize)newSize {

    float width = newSize.width;
    float height = newSize.height;

    UIGraphicsBeginImageContext(newSize);
    CGRect rect = CGRectMake(0, 0, width, height);

    float widthRatio = image.size.width / width;
    float heightRatio = image.size.height / height;
    float divisor = widthRatio > heightRatio ? widthRatio : heightRatio;

    width = image.size.width / divisor;
    height = image.size.height / divisor;

    rect.size.width  = width;
    rect.size.height = height;

    //indent in case of width or height difference
    float offset = (width - height) / 2;
    if (offset > 0) {
        rect.origin.y = offset;
    }
    else {
        rect.origin.x = -offset;
    }

    [image drawInRect: rect];

    UIImage *smallImage = UIGraphicsGetImageFromCurrentImageContext();
    UIGraphicsEndImageContext();

    return smallImage;

} 
```

将此方法添加到您的 Utility 类中，以便您可以在整个项目中使用它，并像这样访问它：

```
xyzImageView.image = [Utility scaleImage:yourUIImage toSize:xyzImageView.frame.size]; 
```

此方法在保持纵横比的同时负责缩放。如果按比例缩小的图像的宽度大于高度（反之亦然），它还会向图像添加缩进。

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2009-03-05T09:23:54.197

如果您可以控制服务器，我强烈建议您使用[ImageMagik](http://www.imagemagick.org)调整图像服务器端的大小。在手机上下载大图像并调整它们的大小会浪费许多宝贵的资源——带宽、电池和内存。所有这些在手机上都是稀缺的。

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2016-03-23T13:51:55.077

我为 Swift 中的图像缩放开发了一个终极解决方案。

您可以使用它来调整图像的大小以填充、方面填充或方面适合指定的大小。

您可以将图像对齐到中心或四个边缘和四个角中的任何一个。

如果原始图像的纵横比和目标大小不相等，您还可以修剪额外的空间。

```
enum UIImageAlignment {
    case Center, Left, Top, Right, Bottom, TopLeft, BottomRight, BottomLeft, TopRight
}

enum UIImageScaleMode {
    case Fill,
    AspectFill,
    AspectFit(UIImageAlignment)
}

extension UIImage {
    func scaleImage(width width: CGFloat? = nil, height: CGFloat? = nil, scaleMode: UIImageScaleMode = .AspectFit(.Center), trim: Bool = false) -> UIImage {
        let preWidthScale = width.map { $0 / size.width }
        let preHeightScale = height.map { $0 / size.height }
        var widthScale = preWidthScale ?? preHeightScale ?? 1
        var heightScale = preHeightScale ?? widthScale
        switch scaleMode {
        case .AspectFit(_):
            let scale = min(widthScale, heightScale)
            widthScale = scale
            heightScale = scale
        case .AspectFill:
            let scale = max(widthScale, heightScale)
            widthScale = scale
            heightScale = scale
        default:
            break
        }
        let newWidth = size.width * widthScale
        let newHeight = size.height * heightScale
        let canvasWidth = trim ? newWidth : (width ?? newWidth)
        let canvasHeight = trim ? newHeight : (height ?? newHeight)
        UIGraphicsBeginImageContextWithOptions(CGSizeMake(canvasWidth, canvasHeight), false, 0)

        var originX: CGFloat = 0
        var originY: CGFloat = 0
        switch scaleMode {
        case .AspectFit(let alignment):
            switch alignment {
            case .Center:
                originX = (canvasWidth - newWidth) / 2
                originY = (canvasHeight - newHeight) / 2
            case .Top:
                originX = (canvasWidth - newWidth) / 2
            case .Left:
                originY = (canvasHeight - newHeight) / 2
            case .Bottom:
                originX = (canvasWidth - newWidth) / 2
                originY = canvasHeight - newHeight
            case .Right:
                originX = canvasWidth - newWidth
                originY = (canvasHeight - newHeight) / 2
            case .TopLeft:
                break
            case .TopRight:
                originX = canvasWidth - newWidth
            case .BottomLeft:
                originY = canvasHeight - newHeight
            case .BottomRight:
                originX = canvasWidth - newWidth
                originY = canvasHeight - newHeight
            }
        default:
            break
        }
        self.drawInRect(CGRectMake(originX, originY, newWidth, newHeight))
        let image = UIGraphicsGetImageFromCurrentImageContext()
        UIGraphicsEndImageContext()
        return image
    }
} 
```

下面是应用此解决方案的示例。

灰色矩形是目标站点图像将被调整大小。浅蓝色矩形中的蓝色圆圈是图像（我使用了圆圈，因为它在不保留纵横比的情况下缩放时很容易看到）。如果您通过，浅橙色标记将被修剪的区域`trim: true`。

**缩放前后的**方面拟合：****

 **[![方面适合 1（之前）](https://i.stack.imgur.com/N68Mt.png)](https://i.stack.imgur.com/N68Mt.png) [![方面适合 1（之后）](https://i.stack.imgur.com/JTIJs.png)](https://i.stack.imgur.com/JTIJs.png)

**方面拟合**的另一个例子：

[![方面适合 2（之前）](https://i.stack.imgur.com/mgXkM.png)](https://i.stack.imgur.com/mgXkM.png) [![方面适合 2（之后）](https://i.stack.imgur.com/bvOIY.png)](https://i.stack.imgur.com/bvOIY.png)

**与顶部对齐的**方面配合：****

 **[![方面适合 3（之前）](https://i.stack.imgur.com/r4yg9.png)](https://i.stack.imgur.com/r4yg9.png) [![方面适合 3（之后）](https://i.stack.imgur.com/rDGJS.png)](https://i.stack.imgur.com/rDGJS.png)

**方面填充**：

[![方面填充（之前）](https://i.stack.imgur.com/SYrdw.png)](https://i.stack.imgur.com/SYrdw.png) [![方面填充（之后）](https://i.stack.imgur.com/rBs06.png)](https://i.stack.imgur.com/rBs06.png)

**填写**：

[![填充（之前）](https://i.stack.imgur.com/mmS8S.png)](https://i.stack.imgur.com/mmS8S.png) [![填充（之后）](https://i.stack.imgur.com/iD96P.png)](https://i.stack.imgur.com/iD96P.png)

我在示例中使用了放大，因为它更易于演示，但解决方案也适用于所讨论的缩小。

对于 JPEG 压缩，你应该使用这个：

```
let compressionQuality: CGFloat = 0.75 // adjust to change JPEG quality
if let data = UIImageJPEGRepresentation(image, compressionQuality) {
  // ...
} 
```

你可以用 Xcode playground查看我的[要点。](https://gist.github.com/mxl/8d3018996468b8c48d57)

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2017-04-14T03:50:54.290

对于 Swift 3，以下代码在保持纵横比的情况下缩放图像。[您可以在Apple 的文档](https://developer.apple.com/library/content/documentation/2DDrawing/Conceptual/DrawingPrintingiOS/HandlingImages/Images.html#//apple_ref/doc/uid/TP40010156-CH13-SW8)中阅读有关 ImageContext 的更多信息：

```
extension UIImage {
    class func resizeImage(image: UIImage, newHeight: CGFloat) -> UIImage {
        let scale = newHeight / image.size.height
        let newWidth = image.size.width * scale
        UIGraphicsBeginImageContext(CGSize(width: newWidth, height: newHeight))
        image.draw(in: CGRect(x: 0, y: 0, width: newWidth, height: newHeight))
        let newImage = UIGraphicsGetImageFromCurrentImageContext()
        UIGraphicsEndImageContext()
        return newImage!
    }
} 
```

要使用它，请调用`resizeImage()`方法：

```
UIImage.resizeImage(image: yourImageName, newHeight: yourImageNewHeight) 
```

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2018-04-12T10:25:02.657

## 斯威夫特版本

```
func resizeImage(image: UIImage, newWidth: CGFloat) -> UIImage? {

    let scale = newWidth / image.size.width
    let newHeight = CGFloat(200.0)
    UIGraphicsBeginImageContext(CGSize(width: newWidth, height: newHeight))
    image.draw(in: CGRect(x: 0, y: 0, width: newWidth, height: newHeight))

    let newImage = UIGraphicsGetImageFromCurrentImageContext()
    UIGraphicsEndImageContext()

    return newImage
} 
```

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2015-09-30T10:51:04.860

您可以使用此代码以所需大小缩放图像。

```
+ (UIImage *)scaleImage:(UIImage *)image toSize:(CGSize)newSize
{
    CGSize actSize = image.size;
    float scale = actSize.width/actSize.height;

    if (scale < 1) {
        newSize.height = newSize.width/scale;
    } 
    else {
        newSize.width = newSize.height*scale;
    }

    UIGraphicsBeginImageContext(newSize);
    [image drawInRect:CGRectMake(0, 0, newSize.width, newSize.height)];
    UIImage* newImage = UIGraphicsGetImageFromCurrentImageContext();
    UIGraphicsEndImageContext();

    return newImage;
} 
```

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2017-07-10T11:24:48.433

在这里添加大量答案，但我已经寻求一种根据文件大小而不是尺寸调整大小的解决方案。

这将减少图像的尺寸和质量，直到它达到您的给定尺寸。

```
func compressTo(toSizeInMB size: Double) -> UIImage? {
    let bytes = size * 1024 * 1024
    let sizeInBytes = Int(bytes)
    var needCompress:Bool = true
    var imgData:Data?
    var compressingValue:CGFloat = 1.0

    while (needCompress) {

        if let resizedImage = scaleImage(byMultiplicationFactorOf: compressingValue), let data: Data = UIImageJPEGRepresentation(resizedImage, compressingValue) {

            if data.count < sizeInBytes || compressingValue < 0.1 {
                needCompress = false
                imgData = data
            } else {
                compressingValue -= 0.1
            }
        }
    }

    if let data = imgData {
        print("Finished with compression value of: \(compressingValue)")
        return UIImage(data: data)
    }
    return nil
}

private func scaleImage(byMultiplicationFactorOf factor: CGFloat) -> UIImage? {
    let size = CGSize(width: self.size.width*factor, height: self.size.height*factor)
    UIGraphicsBeginImageContext(size)
    draw(in: CGRect(x: 0, y: 0, width: size.width, height: size.height))
    if let newImage: UIImage = UIGraphicsGetImageFromCurrentImageContext() {
        UIGraphicsEndImageContext()
        return newImage;
    }
    return nil
} 
```

[按尺寸缩放答案的](https://stackoverflow.com/a/43404939/1532838)功劳

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2020-05-03T03:46:39.817

根据本次会议，[iOS Memory Deep Dive](https://developer.apple.com/videos/play/wwdc2018/416/)，我们最好使用`ImageIO`缩小图像。

使用`UIImage`缩小图像的坏处。

*   将原始图像解压到内存中
*   内部坐标空间变换很昂贵

采用`ImageIO`

*   ImageIO 可以在不污染内存的情况下读取图像大小和元数据信息。

*   ImageIO 可以仅以调整大小的图像为代价来调整图像大小。

关于内存中的图像

*   内存使用与图像的尺寸有关，而不是文件大小。
*   `UIGraphicsBeginImageContextWithOptions`总是使用`SRGB`渲染格式，每个像素使用 4 个字节。
*   图像有`load -> decode -> render`3 个阶段。
*   `UIImage`调整大小和调整大小是昂贵的

对于下面的图片，如果使用`UIGraphicsBeginImageContextWithOptions` 我们只需要 590KB 来加载一张图片，而我们 `2048 pixels x 1536 pixels x 4 bytes per pixel`在解码时需要 = 10MB [![在此处输入图像描述](https://i.stack.imgur.com/rPcHQ.jpg)](https://i.stack.imgur.com/rPcHQ.jpg)

而`UIGraphicsImageRenderer`iOS 10 中引入的 while 将自动选择 iOS12 中的最佳图形格式。这意味着，如果您不需要 SRGB `UIGraphicsBeginImageContextWithOptions`，则可以通过替换为节省 75% 的内存。`UIGraphicsImageRenderer`

这是我关于[内存中的iOS图像的文章](https://suelan.github.io/2020/05/03/iOS-images-in-memory/)

```
func resize(url: NSURL?, maxPixelSize: Int) -> CGImage? {
    guard let url = url else {
      return nil;
    }

    let imgSource = CGImageSourceCreateWithURL(url, nil)
    guard let imageSource = imgSource else {
        return nil
    }

    var scaledImage: CGImage?
    let options: [NSString: Any] = [
            // The maximum width and height in pixels of a thumbnail.
            kCGImageSourceThumbnailMaxPixelSize: maxPixelSize,
            kCGImageSourceCreateThumbnailFromImageAlways: true,
            // Should include kCGImageSourceCreateThumbnailWithTransform: true in the options dictionary. Otherwise, the image result will appear rotated when an image is taken from camera in the portrait orientation.
            kCGImageSourceCreateThumbnailWithTransform: true
    ]
    scaledImage = CGImageSourceCreateThumbnailAtIndex(imageSource, 0, options as CFDictionary)

    return scaledImage
}

DispatchQueue.global().async {
  let image: CGImage? = resize(url: NSURL.init(string: "https://i.stack.imgur.com/rPcHQ.jpg"), maxPixelSize: 600)
  DispatchQueue.main.async {
    let imageView = UIImageView(frame: CGRect(x: 0, y: 0 ,width: 30, height: 30))

    if let cgimage = image {
      imageView.image = UIImage(cgImage: cgimage);

    }
  }
} 
```

或者

```
// Downsampling large images for display at smaller size
func downsample(imageAt imageURL: URL, to pointSize: CGSize, scale: CGFloat) -> UIImage {
    let imageSourceOptions = [kCGImageSourceShouldCache: false] as CFDictionary
    let imageSource = CGImageSourceCreateWithURL(imageURL as CFURL, imageSourceOptions)!
    let maxDimensionInPixels = max(pointSize.width, pointSize.height) * scale
    let downsampleOptions =
        [kCGImageSourceCreateThumbnailFromImageAlways: true,
        kCGImageSourceShouldCacheImmediately: true,
        // Should include kCGImageSourceCreateThumbnailWithTransform: true in the options dictionary. Otherwise, the image result will appear rotated when an image is taken from camera in the portrait orientation.
        kCGImageSourceCreateThumbnailWithTransform: true,
        kCGImageSourceThumbnailMaxPixelSize: maxDimensionInPixels] as CFDictionary
    let downsampledImage =
        CGImageSourceCreateThumbnailAtIndex(imageSource, 0, downsampleOptions)!
    return UIImage(cgImage: downsampledImage)
} 
```

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2015-04-06T10:24:48.627

在视网膜显示器上可能出现的一个问题是图像的比例是由 ImageCapture 设置的。上面的调整大小功能不会改变这一点。在这些情况下，调整大小将无法正常工作。

在下面的代码中，比例设置为 1（未缩放）并且返回的图像具有您期望的大小。这是在`UIGraphicsBeginImageContextWithOptions`通话中完成的。

```
-(UIImage *)resizeImage :(UIImage *)theImage :(CGSize)theNewSize {
    UIGraphicsBeginImageContextWithOptions(theNewSize, NO, 1.0);
    [theImage drawInRect:CGRectMake(0, 0, theNewSize.width, theNewSize.height)];
    UIImage *newImage = UIGraphicsGetImageFromCurrentImageContext();
    UIGraphicsEndImageContext();
    return newImage;
} 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2016-03-15T14:49:31.607

我最终使用 Brads 技术创建了一种`scaleToFitWidth`方法，`UIImage+Extensions`如果这对任何人都有用...

```
-(UIImage *)scaleToFitWidth:(CGFloat)width
{
    CGFloat ratio = width / self.size.width;
    CGFloat height = self.size.height * ratio;

    NSLog(@"W:%f H:%f",width,height);

    UIGraphicsBeginImageContext(CGSizeMake(width, height));
    [self drawInRect:CGRectMake(0.0f,0.0f,width,height)];
    UIImage *newImage = UIGraphicsGetImageFromCurrentImageContext();
    UIGraphicsEndImageContext();

    return newImage;
} 
```

那么无论你喜欢哪里

`#import "UIImage+Extensions.h"`

`UIImage *newImage = [image scaleToFitWidth:100.0f];`

另外值得注意的是，`UIView+Extensions`如果您想从 UIView 渲染图像，您可以将其进一步向下移动到一个类中

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2016-07-13T09:00:32.127

我只是想为 Cocoa Swift 程序员回答这个问题。此函数返回具有新大小的 NSImage。您可以像这样使用该功能。

```
 let sizeChangedImage = changeImageSize(image, ratio: 2)

 // changes image size

    func changeImageSize (image: NSImage, ratio: CGFloat) -> NSImage   {

    // getting the current image size
    let w = image.size.width
    let h = image.size.height

    // calculating new size
    let w_new = w / ratio 
    let h_new = h / ratio 

    // creating size constant
    let newSize = CGSizeMake(w_new ,h_new)

    //creating rect
    let rect  = NSMakeRect(0, 0, w_new, h_new)

    // creating a image context with new size
    let newImage = NSImage.init(size:newSize)

    newImage.lockFocus()

        // drawing image with new size in context
        image.drawInRect(rect)

    newImage.unlockFocus()

    return newImage

} 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2018-05-18T10:02:34.163

如果您的图像在文档目录中，请添加此**URL**扩展名：

```
extension URL {
    func compressedImageURL(quality: CGFloat = 0.3) throws -> URL? {
        let imageData = try Data(contentsOf: self)
        debugPrint("Image file size before compression: \(imageData.count) bytes")

        let compressedURL = NSURL.fileURL(withPath: NSTemporaryDirectory() + NSUUID().uuidString + ".jpg")

        guard let actualImage = UIImage(data: imageData) else { return nil }
        guard let compressedImageData = UIImageJPEGRepresentation(actualImage, quality) else {
            return nil
        }
        debugPrint("Image file size after compression: \(compressedImageData.count) bytes")

        do {
            try compressedImageData.write(to: compressedURL)
            return compressedURL
        } catch {
            return nil
        }
    }
} 
```

用法：

```
guard let localImageURL = URL(string: "< LocalImagePath.jpg >") else {
    return
}

//Here you will get URL of compressed image
guard let compressedImageURL = try localImageURL.compressedImageURL() else {
    return
}

debugPrint("compressedImageURL: \(compressedImageURL.absoluteString)") 
```

注意：- 将 <LocalImagePath.jpg > 更改为您的本地 jpg 图像路径。

* * *

## 回答 #16

> 赞同：-1
> 
> 时间：2015-06-23T07:39:45.627

如果有人还在寻找更好的选择

```
-(UIImage *)scaleImage:(UIImage *)image toSize:(CGSize)targetSize {

    UIImage *sourceImage = image;
    UIImage *newImage = nil;

    CGSize imageSize = sourceImage.size;
    CGFloat width = imageSize.width;
    CGFloat height = imageSize.height;

    CGFloat targetWidth = targetSize.width;
    CGFloat targetHeight = targetSize.height;

    CGFloat scaleFactor = 0.0;
    CGFloat scaledWidth = targetWidth;
    CGFloat scaledHeight = targetHeight;

    CGPoint thumbnailPoint = CGPointMake(0.0,0.0);

    if (CGSizeEqualToSize(imageSize, targetSize) == NO) {

        CGFloat widthFactor = targetWidth / width;
        CGFloat heightFactor = targetHeight / height;

        if (widthFactor < heightFactor)
            scaleFactor = widthFactor;
        else
            scaleFactor = heightFactor;

        scaledWidth  = width * scaleFactor;
        scaledHeight = height * scaleFactor;

        // center the image

        if (widthFactor < heightFactor) {
            thumbnailPoint.y = (targetHeight - scaledHeight) * 0.5;
        } else if (widthFactor > heightFactor) {
            thumbnailPoint.x = (targetWidth - scaledWidth) * 0.5;
        }
    }

    // this is actually the interesting part:

    UIGraphicsBeginImageContext(targetSize);

    CGRect thumbnailRect = CGRectZero;
    thumbnailRect.origin = thumbnailPoint;
    thumbnailRect.size.width  = scaledWidth;
    thumbnailRect.size.height = scaledHeight;

    [sourceImage drawInRect:thumbnailRect];

    newImage = UIGraphicsGetImageFromCurrentImageContext();
    UIGraphicsEndImageContext();

    if(newImage == nil) NSLog(@"could not scale image");

    return newImage ;

} 
```

* * *

## 回答 #17

> 赞同：-1
> 
> 时间：2016-11-03T08:37:56.760

```
- (UIImage *)resizeImage:(UIImage*)image newSize:(CGSize)newSize {
    CGRect newRect = CGRectIntegral(CGRectMake(0, 0, newSize.width, newSize.height));
    CGImageRef imageRef = image.CGImage;

    UIGraphicsBeginImageContextWithOptions(newSize, NO, 0);
    CGContextRef context = UIGraphicsGetCurrentContext();

    CGContextSetInterpolationQuality(context, kCGInterpolationHigh);
    CGAffineTransform flipVertical = CGAffineTransformMake(1, 0, 0, -1, 0, newSize.height);

    CGContextConcatCTM(context, flipVertical);
    CGContextDrawImage(context, newRect, imageRef);

    CGImageRef newImageRef = CGBitmapContextCreateImage(context);
    UIImage *newImage = [UIImage imageWithCGImage:newImageRef];

    CGImageRelease(newImageRef);
    UIGraphicsEndImageContext();

    return newImage;
} 
```

* * *

## 回答 #18

> 赞同：-2
> 
> 时间：2013-09-01T14:46:30.850

要调整图像大小，我使用此函数而不是 DrawInRect 可以获得更好的（图形）结果：

```
- (UIImage*) reduceImageSize:(UIImage*) pImage newwidth:(float) pWidth
{
    float lScale = pWidth / pImage.size.width;
    CGImageRef cgImage = pImage.CGImage;
    UIImage   *lResult = [UIImage imageWithCGImage:cgImage scale:lScale
                            orientation:UIImageOrientationRight];
    return lResult;
} 
```

自动处理纵横比

# nhibernate - 如何运行使用 nHibernate 返回未映射对象列表的 HqlBasedQuery？

> ID：612141
> 
> 赞同：1
> 
> 时间：2009-03-04T19:45:13.587
> 
> 标签：nhibernate, castle-activerecord

我想对两个表（恰好在 ActiveRecord 中映射）运行查询。该查询返回一个无法映射到 ActiveRecord 对象的结果列表（因为它是自定义聚合信息）。

例如

Dim query_str as string = "Select distinct d.ID, (select count(1) as exp from Sales_Leads where date_created <= :todays_date) as NbrLeads from Dealer d"

Dim q As Queries.HqlBasedQuery = New Queries.HqlBasedQuery(GetType(ICollection), query_str) q.SetParameter("todays_date", DateTime.Today) Dim i As ICollection = ActiveRecordMediator.ExecuteQuery(q)

我正在寻找的是简单的 SQL 执行，没有返回 ActiveRecord 对象。

因此，理想情况下，我可以查看集合中每个项目的 i("NbrResults") 。

我得到的错误是：

> 您访问了一个未正确初始化的 ActiveRecord 类。唯一的解释是对 ActiveRecordStarter.Initialize() 的调用不包括 System.Collections.ICollection 类

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2010-03-04T21:43:08.767

好吧，这是很久以前问过的，但我有一个可行的答案。

```
public static IList<T> ExecuteQuery<T>(HqlBasedQuery query)
    where T : new()
{
    query.SetResultTransformer(new NHibernate.Transform.AliasToBeanResultTransformer(typeof(T)));
        var results = (ArrayList)ActiveRecordMediator.ExecuteQuery(query);

    List<T> list = new List<T>(results.Count);
    for (int i = 0; i < results.Count; i++)
    {
        list.Add((T)results[i]);
    }

    return list;
} 
```

这会给你返回类型 T 的结果。类型 T 可以是你想要的**任何东西。**类型 T 需要一个无参数构造函数，并且它需要与您构建的查询中的列名或别名匹配的公共字段或属性。

我们一直这样做。特别是当您想在 HQL 中使用聚合函数来生成聚合数据时。

伴随函数将允许您将查询作为字符串以及您可能拥有的任何位置参数传入：

```
public static IList<T> ExecuteQuery<T, U>(string hqlQuery, params object[] parameters)
        where T : new()
    {
        return ExecuteQuery<T>(new HqlBasedQuery(typeof(U), hqlQuery, parameters));
    } 
```

类型 U 是任何有效的 ActiveRecord 类型。它甚至不必是您引用的类型之一。如果您愿意，您可以将其替换为您知道在会话中有效的某种类型，并放弃额外的参数。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-09T10:56:13.193

您正在跳出 NHibernate 范式调用 SQL，这在一定程度上违背了 ORM 的精神。它本身并不“坏”，但如果我可以尝试保持更松散的耦合，我肯定会避免破坏抽象。

您可以使用直接的 HQL 查询来做您想做的事情，这将返回包含查询结果的元组集合。我在这里解释了如何做到这一点

[使用 Castle ActiveRecord 进行自定义查询](https://stackoverflow.com/questions/308203/custom-query-with-castle-activerecord/318100#318100)

你可能想看看。即使您必须在新建 HQLBasedQuery 时指定类型，NH 也足够聪明，知道如果您不选择类型实例，它应该根据对象元组组装一个结果集。

（IMNSHO 它仍然有点不纯 - 我很想尝试将这种关系建模为一个对象并相应地映射它，但是我必须将 DB 修改为适合对象模型的形状，这不会在所有情况下都可以飞行。）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-04T22:20:58.843

这是我的最终解决方案：

Dim query_str As String = "SELECT DISTINCT d.ID, count(l) from LEAD as l join l.Dealer as d where l.DateCreated >= DATEADD(day, -30, :todays_date) GROUP BY d.ID"

然后获取活动记录会话（或者NHibernate，还是不知道这里返回了什么）：

Dim sess As ISession = activerecordmediator.GetSessionFactoryHolder().CreateSession(GetType(ActiveRecordBase))

Dim q 作为 NHibernate.IQuery = sess.CreateQuery(query_str)

q.SetParameter("todays_date", DateTime.Today) Dim i As IList = q.List() ' 得到结果

在 .aspx 页面中，可以在 GridView 中访问结果，如下所示：

# javascript - 此 JS 代码是否按预期工作？

> ID：612149
> 
> 赞同：-1
> 
> 时间：2009-03-04T19:47:34.500
> 
> 标签：javascript, settimeout

每 3 秒我发出一个 AJAX POST 请求以获取进程的状态。这很好用。

当进程达到 100% 时，将执行回调函数（如下所示）以向页面添加新元素，然后取消用于每 3 秒连续获取进度的 setTimeout 方法。但是，我的用户告诉我它有时无法取消并且新元素没有添加到页面中，而且我一直卡在显示“100%”。

我已经一次又一次地测试了它，它永远不会卡住我。代码看起来也不错，但是我的 JavaScript 技能不是很好，所以我希望有人能指出是否有可能发生这个问题？

我已经评论了代码，很抱歉它很长。我试图减少它。

```
function convertNow(validURL){

    startTime = setTimeout('getStatus();', 6000); 
       //AJAX CALL TO RUN PROCESS
       $.ajax({
       type: "GET",
       url: "main.php",
       data: 'url=' + validURL + '&filename=' + fileNameTxt,
       success: function(msg){
       //ON SUCCESS CLEAR SETTIMEOUT AND SHOW ELEMENTS (text)
       clearTimeout(continueTime);
       clearTimeout(startTime);    
        $("#loading").hide("slow");
        $("#done").html("Done");   
       }//function

     });//ajax

}//function convertNow

function getStatus(){
        //AJAX CALL TO GET STATUS OF PROCESS
        $.ajax({
        type: "POST",
        url: "fileReader.php",
        data: 'textFile=' + fileNameTxt,
        success: function(respomse){
        textFileResponse = respomse.split(" ");
        $("#done").html("Processing...");
        }
        });//ajax
        clearTimeout(continueTime);

        if(textFileResponse[0]=='100.0%'){
            clearTimeout(continueTime);
        }
        else{
            clearTimeout(startTime);
            continueTime = setTimeout('getStatus();', 3000); 
        }
} 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-04T19:53:24.613

在某些边缘情况下，textFileReponse[0]=='100.0%' 中可能存在解析错误，响应中的值不完全等于 100.0%（可能有额外的空格，或者在某些平台上可能存在一些细微差别， ETC...）。这将导致代码落入 else {} 块，并且您的 getStatus 函数将再次排队。

编辑：鉴于评论中的线程，两个 Ajax 代码块之间存在竞争条件的可能性也相同。（只是为了读者的利益而把它放在这里）。结束编辑

然而，除了解析解析之外，您可能想要的是使用 setInterval()，只有一个计时器，而不是 startTime 和 continueTime 计时器。setTimeout 只执行一次，而 setInterval 每 x 毫秒重复一次，所以你只需要一个。要取消 setInterval，请使用 clearInterval。

# c++ - 来自麦克风捕获设备的 DirectSound 缓冲元素的解释

> ID：612154
> 
> 赞同：1
> 
> 时间：2009-03-04T19:49:03.063
> 
> 标签：c++, audio, microphone, directsound

我正在做一些涉及 DirectSound 缓冲区的维护工作。我想知道如何解释缓冲区中的元素，即知道缓冲区中的每个值代表什么。此数据来自麦克风。

正在使用这种波形格式：

```
WAVEFORMATEXTENSIBLE format = {
  { WAVE_FORMAT_EXTENSIBLE, 1, sample_rate, sample_rate * 4, 4, 32, 22 },
  { 32 }, 0, KSDATAFORMAT_SUBTYPE_IEEE_FLOAT
}; 
```

我的目标是检测麦克风静音。我目前通过简单地确定缓冲区中的所有值是否未能超过某个阈值体积值来实现这一点，假设每个缓冲区元素的强度直接对应于体积。

这是我目前正在尝试的：

```
bool is_mic_silent(float * data, unsigned int num_samples, float threshold)
{
  float * max_iter = std::max_element(data, data + num_samples);
  if(!max_iter) {
    return true;
  }

  float max = *max_iter;
  if(max < threshold) {
    return true;
  }

  return false;  // At least one value is sufficiently loud.
} 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-05T08:22:34.953

正如 MSN 所说，样本是 32 位浮点数。要检测静音，您通常会计算 RMS 值：在某个时间间隔（例如 20-50 毫秒）内取**平方**样本值的平均值，并将该平均值与阈值进行比较（平方根）。麦克风信号中固有的噪声可能会让单个样本达到阈值以上，而环境声音仍将被视为无声。短时间间隔内的平均将产生一个更符合我们感知的值。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-05T09:28:13.733

除了 Han 对平均样本的建议外，还考虑校准您的阈值。在不同的环境下，使用不同的麦克风和不同的音频通道，“沉默”可能意味着很多事情。

简单的方法是配置阈值。或者，允许在其中获取阈值的“本底噪声测量”。

请注意，样本是线性的，但音频处理中的电平通常以[dB 为单位](http://en.wikipedia.org/wiki/Decibel)。因此，根据您的目标受众，您可能希望将读数和输入转换为 dB。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-04T22:08:30.793

从[这里开始](http://wiki.multimedia.cx/index.php?title=PCM#Integer_Or_Floating_Point)，浮点 PCM 值来自 [-1, 1]。

# c# - 有什么方法可以让 XmlSerializer 以定义的顺序输出 xml？

> ID：612160
> 
> 赞同：7
> 
> 时间：2009-03-04T19:51:08.237
> 
> 标签：c#, .net, xml, xml-serialization

目前我正在使用 XmlSerializer 序列化和反序列化一个对象。xml 以未定义的顺序生成，这是可以理解的，但在比较对象的版本时会很烦人，因为每次的属性顺序都不同。因此，例如，我不能使用普通的差异工具来查看任何差异。

有没有一种简单的方法可以每次都以相同的顺序生成我的 xml，而无需自己编写 ReadXml 和 WriteXml 方法？我在类上有很多属性，并且时不时地添加新属性，所以我宁愿不必编写然后维护该代码。

(C#.net 2.0)

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-03-04T19:54:00.960

XmlElement 属性有一个[order 属性](http://msdn.microsoft.com/en-us/library/system.xml.serialization.xmlelementattribute.order.aspx)。你可以用它作为开始。

如果您需要在 Xml 文件中查找差异，您可能需要查看[此](http://msdn.microsoft.com/en-us/library/aa302294.aspx).

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-04T19:54:36.480

[使用XmlElementAttribute](http://msdn.microsoft.com/en-us/library/system.xml.serialization.xmlelementattribute.aspx)装饰您的属性，设置[Order](http://msdn.microsoft.com/en-us/library/system.xml.serialization.xmlelementattribute.order.aspx)参数。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-06T04:26:14.543

ps：我不相信 XmlSerializer 生成的 XML 是未定义的顺序。它可能是无证的，但它是已知的。我相信在没有 Order 属性的情况下，XmlSerializer 会序列化所有公共属性，按 prop 名称进行 alpha 排序，然后是所有公共字段，按名称进行 alpha 排序。

# iphone - 在 iPhone 上测试应用升级

> ID：612174
> 
> 赞同：5
> 
> 时间：2009-03-04T19:56:32.793
> 
> 标签：iphone, upgrade, store

假设我在应用商店发布了应用版本 1.0。然后我想发布1.1版。

我将保留从应用程序包复制到应用程序沙箱中的现有数据。这些是一些 XML 配置文件和用户可以写入数据的 sqlite db。这些文件可能需要更新以保留其现有数据。

测试升级方案的最佳方法是什么？

是否有任何类型的委托事件仅在安装时调用？

谢谢。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-04T20:00:23.893

我认为使用在 iTunes 中拖放的 AdHoc 版本进行测试是类似的升级情况。

这就是我测试升级我们的国际象棋游戏的方式，因此它可以在设备上保留旧的和当前的游戏。

至于文件/数据库，我建议它们应该包含一些版本号。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-01-24T14:34:32.780

您可以使用 TestFlight 进行 beta 测试或预生产测试。访问 TestFlight.com 了解更多信息。

# c# - 我在哪里可以找到“Shamir 的秘密分享”的 C# 类？

> ID：612178
> 
> 赞同：7
> 
> 时间：2009-03-04T19:58:56.847
> 
> 标签：c#, .net, security

我正在尝试找一门课程或其他可以让我进行[Shamir 的秘密分享](http://en.wikipedia.org/wiki/Shamir%27s_Secret_Sharing "沙米尔的秘密分享")的课程。

我在 C# 中找到了一个允许您执行此操作的程序，但它不提供源代码。我只是想知道是否有人已经完成了我需要的课程。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2011-11-21T14:10:18.773

我实现[了我自己的版本](https://github.com/moserware/SecretSplitter)，它也使用 PGP 加密。[我描述了它背后的数学原理，并在我的博客文章“生命、死亡和分裂的秘密](http://www.moserware.com/2011/11/life-death-and-splitting-secrets.html)”中举例说明了如何使用它。

**更新：**它现在作为[NuGet 包](http://www.nuget.org/packages/Moserware.SecretSplitter/)提供（以及详细的[示例包](http://www.nuget.org/packages/Moserware.SecretSplitter.Sample/)）

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-04T20:03:55.570

编辑：如评论中所述，该项目实际上没有 C# 源代码 - 但我现在无法删除答案，因为它已被接受。毕竟，也许 OP 实际上满足于使用包装器。

[SecretSharp](http://sourceforge.net/projects/secretsharp/)（从维基百科文章链接）是 GPL - 你可以[在这里浏览代码](http://secretsharp.svn.sourceforge.net/viewvc/secretsharp/)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-04T20:00:31.070

为什么不使用 ILDASM 或 Reflector 从您拥有的应用程序中获取源代码？

# .net - 没有配置文件的 WCF 服务器

> ID：612180
> 
> 赞同：0
> 
> 时间：2009-03-04T19:59:18.607
> 
> 标签：.net, wcf

我厌倦了处理配置文件，所以我试图仅在代码中设置 WCF 服务。

到目前为止，我有这个：

```
 m_ServiceHost = New ServiceHost(Me)
    m_ServiceHost.AddServiceEndpoint( 
          GetType(Aam.AamServiceFramework.IServiceMonitor), 
          New NetTcpBinding, "net.tcp://localhost:6000)
    m_ServiceHost.AddServiceEndpoint(
          GetType(IMetadataExchange), 
          New NetTcpBinding, "net.tcp://localhost:6500)
    m_ServiceHost.Open() 
```

如果我注释掉 IMetadataExchange，这将有效。我该如何处理那块？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-04T20:10:50.887

```
 m_ServiceHost.Description.Behaviors.Add(New ServiceMetadataBehavior())
    m_ServiceHost.AddServiceEndpoint(
             GetType(IMetadataExchange), 
             MetadataExchangeBindings.CreateMexTcpBinding(), 
             "net.tcp://localhost:6595") 
```

# sql-server - 可以恢复一些（但不是全部）数据库的 SQL Auth 用户

> ID：612185
> 
> 赞同：1
> 
> 时间：2009-03-04T20:01:13.250
> 
> 标签：sql-server, sql-server-2005

我想在 MS SQL 2005 中设置一个 SQL Auth 用户，它可以恢复特定实例中的一些（但不是全部）数据库。

我不确定我是否应该为此使用服务器角色，因为它们似乎适用于所有数据库，但数据库角色成员资格似乎也不正确（我不希望 SQL 用户可能“丢失”他们的恢复如果他们恢复的备份不包含他们的数据库角色成员资格）。

我怎样才能做到这一点？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-24T20:15:34.297

您不能这样设置用户。此权限位于服务器/登录级别的数据库/用户之上

登录可能有“ [dbcreator](http://msdn.microsoft.com/en-us/library/ms176014(SQL.90).aspx) ”，它说：

> ...并且可以更改和恢复他们自己的数据库。

即使使用[GRANT](http://msdn.microsoft.com/en-us/library/ms178569(SQL.90).aspx)也会很棘手，如果不是不可能的话，比如“ `GRANT CREATE ANY DATABASE`”

从某种意义上说，还原是一种丢弃和创造。或者只是一个创造。

我建议最好的解决方案（但可能不是你想听到的......）是在 master 中创建你自己的存储过程来检查权限并发出 RESTORE 命令，如果登录设置为该数据库中的用户

例子：`sp_checkandrestore 'dbname', 'backupfile'`

# c# - C#程序（进程）不会卸载

> ID：612188
> 
> 赞同：2
> 
> 时间：2009-03-04T20:02:05.027
> 
> 标签：c#, interop, .net-2.0, unmanaged, dllimport

我有一个 C# 程序，它使用来自另一个程序集的类，并且这个类调用一个非托管 DLL 来进行一些处理。这是一个片段：

```
public class Util
{
    const string dllName = "unmanaged.dll";
    [DllImport(dllName, EntryPoint = "ExFunc")]
    unsafe static extern bool ExFunc(StringBuilder path, uint field);

    public bool Func(string path, uint field)
    {
        return ExFunc(new StringBuilder(path), field);
    }

    ...
}

Util util = new Util();
bool val = util.Func("/path/to/something/", 1); 
```

我遇到的问题是，如果我调用“Func”，我的主 C# 程序将不会卸载。当我在主窗体中调用 Close() 时，如果我在任务管理器中查看，该进程仍然存在。如果我删除对“Func”的调用，程序会很好地卸载。我已经做了一些测试，程序 Main 函数肯定会返回，所以我不确定这里发生了什么。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-04T20:03:28.380

当您的主应用程序关闭时，它可能会调度一个不放手的非后台线程。在没有看到代码的情况下不能肯定地说，但这就是我的假设。

它可能不太理想，但如果您需要一种解决方法，您可以使用：

```
System.Diagnostics.Process.GetCurrentProcess().Kill(); 
```

这将在进程级别结束您的应用程序并终止通过该进程产生的所有线程。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-04T20:06:36.577

看起来您的非托管库正在生成一个用于异步处理的线程。

奇怪的是它支持某种取消功能；我建议您尝试在程序关闭时调用它。如果您的程序在异步调用恰好完成之前刚刚完成，请查找“等待完成”函数并在从“Func”方法返回之前调用它。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-04T20:05:10.793

你有源代码`unmanaged.dll`吗？它必须在做某事，要么启动另一个线程但不退出，要么阻塞它`DllMain`，等等。

# ruby - 为什么在 Ruby 方法中使用感叹号？

> ID：612189
> 
> 赞同：615
> 
> 时间：2009-03-04T20:02:28.443
> 
> 标签：ruby, methods, naming-conventions, immutability

在 Ruby中，一些方法有`?`一个问号（`include?`

但是为什么有些方法有感叹号（`!`）而其他方法没有呢？

这是什么意思？

* * *

## 回答 #1

> 赞同：692
> 
> 时间：2009-03-04T20:04:41.870

通常，以 结尾`!`的方法表示该方法将**修改它所调用的对象**。Ruby 将这些称为“**危险方法**”，因为它们会更改其他人可能引用的状态。下面是一个简单的字符串示例：

```
foo = "A STRING"  # a string called foo
foo.downcase!     # modifies foo itself
puts foo          # prints modified foo 
```

这将输出：

```
a string 
```

在标准库中，您会在很多地方看到成对的名称相似的方法，一个有 the `!`，一个没有。没有的那些称为“安全方法”，它们返回原始副本的副本，并将更改应用于**副本**，而被调用者保持不变。这是没有 的相同示例`!`：

```
foo = "A STRING"    # a string called foo
bar = foo.downcase  # doesn't modify foo; returns a modified string
puts foo            # prints unchanged foo
puts bar            # prints newly created bar 
```

这输出：

```
A STRING
a string 
```

请记住，这只是一个约定，但很多 Ruby 类都遵循它。它还可以帮助您跟踪代码中的修改内容。

* * *

## 回答 #2

> 赞同：162
> 
> 时间：2009-03-04T21:59:56.477

感叹号意味着很多东西，有时除了“这很危险，小心”之外，你无法从中看出很多东西。

正如其他人所说，在标准方法中，它通常用于表示导致对象自身发生变异的方法，但并非总是如此。请注意，许多标准方法会更改其接收器并且没有感叹号（`pop`, `shift`, `clear`），而某些带有感叹号的方法不会更改其接收器（`exit!`）。例如，请参阅[这篇文章](http://dablog.rubypal.com/2007/8/15/bang-methods-or-danger-will-rubyist)。

其他库可能会以不同的方式使用它。在 Rails 中，感叹号通常意味着该方法将在失败时抛出异常，而不是静默失败。

这是一个命名约定，但许多人以微妙不同的方式使用它。在您自己的代码中，一个好的经验法则是在方法执行“危险”操作时使用它，尤其是当存在两个同名方法并且其中一个比另一个更“危险”时。“危险”几乎可以意味着任何东西。

* * *

## 回答 #3

> 赞同：82
> 
> 时间：2009-03-04T21:44:52.130

这个命名约定是从[Scheme](http://www.schemers.org/Documents/Standards/R5RS/)中提取的。

> 1.3.5 命名约定
> 
> 按照惯例，总是返回布尔值的过程的名称通常以“？”结尾。这样的过程称为谓词。
> 
> 按照惯例，将值存储到先前分配的位置（参见第 3.4 节）的过程的名称通常以“！”结尾。这样的过程称为突变过程。按照惯例，突变过程返回的值是未指定的。

* * *

## 回答 #4

> 赞同：26
> 
> 时间：2009-03-04T20:04:51.510

！通常意味着该方法作用于对象而不是返回结果。来自《[Programming Ruby](http://www.ruby-doc.org/docs/ProgrammingRuby/html/tut_methods.html) 》一书：

> “危险”或修改接收器的方法可能以结尾的“！”命名。

* * *

## 回答 #5

> 赞同：23
> 
> 时间：2014-02-15T22:38:25.100

最准确的说法是用Bang 的方法！是更[危险](https://www.ruby-forum.com/topic/176830#773946)或更[令人惊讶](http://ruby-doc.org/core-2.1.0/Array.html#method-i-collect-21)的版本。有许多方法在没有 Bang 的情况下发生变异，例如[`.destroy`](http://ruby-doc.org/core-2.1.0/Array.html#method-i-delete)，通常方法只有在核心库中存在更安全的替代方案时才有 bang。

例如，在 Array 上，我们有`.compact`and `.compact!`，这两个方法都会改变数组，但`.compact!`如果数组中没有 nil，则返回 nil 而不是 self，这比仅返回 self 更令人惊讶。

我发现的唯一非变异方法是`Kernel`'s [`.exit!`](http://ruby-doc.org/core-2.1.0/Kernel.html#method-i-exit-21)，这比在进程关闭时`.exit`无法捕获更令人惊讶。`SystemExit`

Rails 和 ActiveRecord 延续了这一趋势，因为它使用 bang 来获得更多“令人惊讶”的效果，比如[`.create!`](https://stackoverflow.com/a/1761180/193785)在失败时会引发错误。

* * *

## 回答 #6

> 赞同：18
> 
> 时间：2011-09-09T00:05:46.157

来自 themorohoax.com：

根据我的个人喜好，可以通过以下方式使用爆炸。

> 1) 如果方法没有按照它说的那样做，那么活动记录方法会引发错误。
> 
> 2）活动记录方法保存记录或方法保存对象（例如strip！）
> 
> 3) 一个方法做一些“额外的”事情，比如发帖到某个地方，或者做一些动作。

关键是：只有在你真正考虑过是否有必要时才使用 bang，以免其他开发人员不得不检查你为什么使用 bang。

爆炸为其他开发人员提供了两个线索。

> 1）调用方法后不需要保存对象。
> 
> 2）当您调用该方法时，数据库将被更改。

[http://www.themomorohoax.com/2009/02/11/when-to-use-a-bang-exclamation-point-after-rails-methods](http://www.themomorohoax.com/2009/02/11/when-to-use-a-bang-exclamation-point-after-rails-methods)

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2013-09-14T11:51:05.337

简单解释：

```
foo = "BEST DAY EVER" #assign a string to variable foo.

=> foo.downcase #call method downcase, this is without any exclamation.

"best day ever"  #returns the result in downcase, but no change in value of foo.

=> foo #call the variable foo now.

"BEST DAY EVER" #variable is unchanged.

=> foo.downcase! #call destructive version.

=> foo #call the variable foo now.

"best day ever" #variable has been mutated in place. 
```

但是，如果您曾经`downcase!`在上面的解释中调用过一个方法，`foo`则会永久更改为小写。`downcase!`不会返回新的字符串对象，而是将字符串替换到位，完全更改`foo`为小写。我建议你不要使用`downcase!`，除非它是完全必要的。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2017-04-03T15:16:07.787

```
! 
```

我喜欢将其视为一种爆炸性的变化，它摧毁了之前的一切。Bang 或感叹号表示您正在对代码进行永久保存的更改。

例如，如果您使用 Ruby 的全局替换方法，`gsub!`那么您所做的替换是永久性的。

您可以想象的另一种方式是打开一个文本文件并进行查找和替换，然后保存。`!`在你的代码中做同样的事情。

如果您来自 bash 世界，另一个有用的提醒是`sed -i`具有永久保存更改的类似效果。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2015-07-23T21:10:59.493

底线：`!`方法只是更改它们被调用的对象的值，而没有`!`返回操作值的方法不会覆盖调用该方法的对象。

仅`!`当您不打算将原始值存储在您调用该方法的变量中时才使用。

我更喜欢做类似的事情：

```
foo = "word"
bar = foo.capitalize
puts bar 
```

或者

```
foo = "word"
puts foo.capitalize 
```

代替

```
foo = "word"
foo.capitalize!
puts foo 
```

以防万一我想再次访问原始值。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2017-05-23T14:43:20.730

称为“破坏性方法”它们倾向于更改您所指对象的原始副本。

```
numbers=[1,0,10,5,8]
numbers.collect{|n| puts n*2} # would multiply each number by two
numbers #returns the same original copy
numbers.collect!{|n| puts n*2} # would multiply each number by two and destructs the original copy from the array
numbers   # returns [nil,nil,nil,nil,nil] 
```

# c# - 创建用于 SQLDataAdapter 的 SQLCommand

> ID：612203
> 
> 赞同：1
> 
> 时间：2009-03-04T20:06:37.793
> 
> 标签：c#, sql-server, ado.net

我正在尝试使用 a 从表中删除数据`SQLDataAdapter`，为此我需要给它一个`DeleteCommand`.

我用来删除一行的 SQL 是：

```
DELETE FROM table WHERE ID = x 
```

因此问题是：我如何指定`DataAdapter`要替换`x`的内容？生成的 SQL 与`DataAdapter`被告知要更新的数据表（外连接）略有不同（无连接）。

我怎样才能做到这一点？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-04T20:11:14.727

在这里您可以将参数传递给删除命令：

```
// Create the DeleteCommand.
command = new SqlCommand(
    "DELETE FROM Customers WHERE CustomerID = @CustomerID", connection);

// Add the parameters for the DeleteCommand.
parameter = command.Parameters.Add(
      "@CustomerID", SqlDbType.NChar, 5, "CustomerID");
parameter.SourceVersion = DataRowVersion.Original;

adapter.DeleteCommand = command; 
```

取自[MSDN的代码](http://msdn.microsoft.com/en-us/library/system.data.sqlclient.sqldataadapter.deletecommand.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-04T20:10:47.330

使用 SourceColumn 和 SourceVersion SqlParameter 属性：

```
 var deleteCommand = connection.CreateCommand();
        deleteCommand = "DELETE FROM table WHERE ID = @ID";
        var param = new SqlParameter("ID");
        param.SourceColumn = "the Select Column";
        param.SourceVersion = DataRowVersion.Original;
        deleteCommand.Parameters.Add (param); 
```

# sql - Django 1.0/1.1 重写自加入

> ID：612204
> 
> 赞同：1
> 
> 时间：2009-03-04T20:07:02.787
> 
> 标签：sql, django, group-by, sum

有没有办法使用 Django QuerySet 对象重写这个查询：

```
SELECT b.created_on, SUM(a.vote)
FROM votes a JOIN votes b ON a.created_on <= b.created_on
WHERE a.object_id = 1
GROUP BY 1 
```

votes 是一个表，object_id 是一个多次出现的 int（外键——尽管在这里无关紧要），而 created_on 是一个日期时间。

FWIW，这个查询允许一个人在过去的任何时候通过总结所有以前对该 object_id 的投票来获得分数。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-05T11:52:34.930

我很确定无法使用 Django ORM 创建查询。新的 Django 聚合代码非常灵活，但我认为它不能完全满足您的要求。

您确定该查询有效吗？您似乎错过了 b.object_id 为 1 的检查。

这段代码应该可以工作，但它不止一行而且效率不高。

```
from django.db.models import Sum

v_list = votes.objects.filter(object__id=1)

for v in v_list:
    v.previous_score = votes.objects.filter(object__id=1, created_on__lte=v.created_on).aggregate(Sum('vote'))["vote__sum"] 
```

聚合仅在主干中可用，因此您可能需要先更新 django 安装才能执行此操作。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-05T16:20:46.660

聚合不是问题。这里的问题是 Django 的 ORM 根本不会对任何不是 ForeignKey、AFAIK 的东西进行连接。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-05T21:02:17.030

这就是我现在正在使用的。具有讽刺意味的是，sql 被破坏了，但这是它的要点：

```
 def get_score_over_time(self, obj):
    """
    Get a dictionary containing the score and number of votes 
    at all times historically
    """
    import pdb; pdb.set_trace();
    ctype = ContentType.objects.get_for_model(obj)
    try:
        query = """SELECT b.created_on, SUM(a.vote)
                        FROM %s a JOIN %s b 
                        ON a.created_on <= b.created_on
                        WHERE a.object_id = %s
                        AND a.content_type_id = %s
                        GROUP BY 1""" % (
            connection.ops.quote_name(self.model._meta.db_table),
            connection.ops.quote_name(self.model._meta.db_table),
            1,
            ctype.id,
            )
        cursor = connection.cursor()
        cursor.execute(query)
        result_list = []
        for row in cursor.fetchall():
            result_list.append(row)
    except models.ObjectDoesNotExist:
        result_list = None
    return result_list 
```

# .net - 仅在高流量期间出现 TableAdapter 错误

> ID：612205
> 
> 赞同：0
> 
> 时间：2009-03-04T20:07:26.327
> 
> 标签：.net, sql, tableadapter, web-traffic

我正在处理其他人的大量使用 tableAdapters 的项目。该站点有效，但它经常在事件日志中添加一个条目：

> “ExecuteReader 需要一个打开且可用的连接。连接的当前状态是正在连接。”

该站点不会抛出异常，除非流量很高（每秒 5 个以上的请求），否则异常是相同的，指向这行代码：

```
this.Adapter.Fill(dataTable); 
```

> 堆栈跟踪：在 System.Data.SqlClient.SqlConnection.ValidateConnectionForExecute（String 方法，SqlCommand 命令）的 System.Data.SqlClient.SqlConnection.GetOpenConnection（String 方法）

我怎样才能停止这个错误？谢谢。

原来我只得到了一半的图片，错误，当它会抛出一个错误是：

> “已经有一个打开的 DataReader 与此命令关联，必须先关闭它。”

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-04T20:13:58.527

我会说您可能出于多种目的使用相同的连接，其中一个正在被另一个线程关闭。

我建议添加一些跟踪来弄清楚发生了什么。这种错误很难调试，只有在生产环境中才会出现：(

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-04T20:16:11.063

如果您似乎超出了与数据库的允许打开连接数。这可以通过提供 Min Pool Size 和 Max Pool Size 值在连接字符串中进行设置。我认为 Min Pool Size 的默认值为 0，Max Pool Size 的默认值为 100，但我不确定。

尝试更改它们，看看是否有帮助。

# php - .load() 结果显示在页面上时出现随机换行符

> ID：612211
> 
> 赞同：0
> 
> 时间：2009-03-04T20:08:26.883
> 
> 标签：php, jquery, ajax

这个问题我已经有一段时间了，我已经将它隔离为由 mysql_connect 或 mysql_select_db 函数引起的。出于某种原因，当我使用 jquery 的 .load() 时，响应文本在页面中显示时会在顶部有一个换行符（`<textarea>`例如，在 a 中，但在任何元素中）。查看 Firebug 中的响应，没有换行符。如果我只是在我正在调用的脚本中放入纯文本，则不会出现换行符。它与我正在调用的脚本正在建立的数据库连接有关。如果我将换行符写入console.log()，它甚至会出现。我完全慌了，我希望这个问题的描述是有道理的。如果不是，我很乐意澄清。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-05T14:59:19.507

今天早上我玩了一些，发现发生了什么。似乎在我调用的 PHP 脚本中有一个 include() 很好，但是对于每个额外的 include()，它都会添加一个换行符！不要问我为什么。希望这里有人可以提供一些有关这种行为的见解。（如果我将 include() 嵌套在另一个单独的 include() 文件中，也会发生同样的事情。）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-16T14:58:17.230

它是否与一个或多个包含文件中的结束 (?>) 标记后的空格或换行符有关？我会根据经验检查一下，我知道 PHP 不喜欢关闭标签后的空格。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-04T20:59:42.987

在大多数情况下，加载函数所做的只是调用 ajax 函数并附加数据。看看这段代码是否给你换行符。

```
// Request the remote document
jQuery.ajax({
    url: url,
    dataType: "html",
    complete: function(res, status){
        alert(res.responseText);
    }
}); 
```

# sharepoint - SPListItem 的 SharePoint URL 检索

> ID：612212
> 
> 赞同：14
> 
> 时间：2009-03-04T20:08:39.770
> 
> 标签：sharepoint, list

当我尝试检索作为超链接的列时，我得到两个以逗号分隔的项目而不是一个。

当我拉`item["ColumnName"]`我得到它的价值：

> [http://www.google.com/article/583,%20title%20gets%20stars](http://www.google.com/article/583,%20title%20gets%20stars)

为什么显示链接和标题？

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2009-03-04T23:20:11.870

您可以通过这种方式从列值中提取实际值`Url`和值：`Description`

```
SPFieldUrlValue fieldValue = new SPFieldUrlValue(myItem["URL"].ToString());

string linkTitle = fieldValue.Description;

string linkUrl = fieldValue.Url; 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-04T20:17:17.567

因为在最低级别，所有 Sharepoint 字段都存储为字符串。SPField 的 GetFieldValue 方法接受一个字符串，由该字段类的逻辑读取该字符串并将其转换为有意义的值对象。

item["FieldName"] 返回一个表示字段值的通用对象。对象本身通常是无用的，除了作为数据的原始字符串表示。

如果您使用 GetFieldValueAsHtml() 方法，它将返回`<a href="url">title</a>`：

```
//if field is of type Hyperlink, returns <a href="url">title</a>
item.Fields["FieldName"].GetFieldValueAsHtml(item["FieldName"]) 
```

或者

```
//if field is of type Hyperlink, returns Url, Title
item.Fields["FieldName"].GetFieldValueAsText(item["FieldName"]) 
```

或者

```
//if field is of type Hyperlink, returns Url
item.Fields["FieldName"].GetValidatedString(item["FieldName"]) 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-10-22T09:16:24.047

SPListItem URL 属性会返回包含 List/Documetn 库名称的 SPListItem 的 URL，但不会返回包含服务器和站点名称的完整 URL。

要获取完整的 URL，您可以连接 SPLIstItem.Web.Url 和 SPListItem.URL，或者从 SPListItem.XML 数据中提取完整的 URL，如下所示：

```
foreach (SPListItem item in list.Items)
{
  XmlDocument xmlDoc = new XmlDocument();
  xmlDoc.LoadXml(item.Xml);

  XmlNamespaceManager nsm = new XmlNamespaceManager(xmlDoc.NameTable);
  nsm.AddNamespace("z", "#RowsetSchema");

  string fullURL = xmlDoc.SelectSingleNode("z:row", nsm).Attributes["ows_EncodedAbsUrl"].Value;
} 
```

[http://insomniacgeek.com/code/how-to-get-the-full-url-from-splistitem-in-sharepoint/](http://insomniacgeek.com/code/how-to-get-the-full-url-from-splistitem-in-sharepoint/)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-04T20:16:15.603

这就是 SharePoint 存储链接的方式。首先是 URL，然后是页面上实际显示的标题。

从 SharePoint 文档：

*“URL 字段由逗号和空格分隔的两个字符串组成。一个字符串包含 URL 路径，另一个包含用作超链接文本的描述。”*

您必须拆分字符串以获得两部分。

```
string url = field["URL"].Split(',')[0];
string title = field["URL"].Split(',')[1]; 
```

代码不是最佳的，只是为了向您展示我的意思。

Oliver，您没有指定 SharePoint 版本。我的答案是 2003 版。如果您有 MOSS，请查看**SPFieldUrl**和**SPFieldUrlValue**类。

# php - SimpleTest：如何断言抛出了 PHP 错误？

> ID：612217
> 
> 赞同：7
> 
> 时间：2009-03-04T20:10:33.807
> 
> 标签：php, unit-testing, simpletest

如果我是正确的，SimpleTest 将允许您断言抛出 PHP 错误。但是，根据文档，我无法弄清楚如何使用它。我想断言我传递给构造函数的对象是`MyOtherObject`

```
class Object {
    public function __construct(MyOtherObject $object) {
        //do something with $object
    }
}

//...and in my test I have...
public function testConstruct_ExpectsAnInstanceOfMyOtherObject() {
    $notAnObject = 'foobar';
    $object = new Object($notAnObject);
    $this->expectError($object);
} 
```

我哪里错了？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-03-18T19:35:41.720

类型提示抛出 E_RECOVERABLE_ERROR，自 PHP 5.2 版起 SimpleTest 可以捕获该错误。以下将捕获包含文本“必须是一个实例”的任何错误。PatternExpectation 的构造函数采用 perl 正则表达式。

```
public function testConstruct_ExpectsAnInstanceOfMyOtherObject() {
    $notAnObject = 'foobar';
    $this->expectError(new PatternExpectation("/must be an instance of/i"));
    $object = new Object($notAnObject);
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-04T20:22:01.203

PHP 既有错误也有异常，它们的工作方式略有不同。将错误类型传递给类型提示函数将引发异常。你必须在你的测试用例中抓住它。例如。：

```
public function testConstruct_ExpectsAnInstanceOfMyOtherObject() {
  $notAnObject = 'foobar';
  try {
    $object = new Object($notAnObject);
    $this->fail("Expected exception");
  } catch (Exception $ex) {
    $this->pass();
  }
} 
```

或者简单地说：

```
public function testConstruct_ExpectsAnInstanceOfMyOtherObject() {
  $this->expectException();
  $notAnObject = 'foobar';
  $object = new Object($notAnObject);
} 
```

但请注意，这将在发生异常的行之后停止测试。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-04T22:37:48.523

事实证明，SimpleTest 实际上并不支持这一点。您无法在 SimpleTest 中发现致命的 PHP 错误。类型提示很棒，但您无法对其进行测试。类型提示会引发致命的 PHP 错误。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-04T21:46:07.227

您必须在错误发生之前就预料到错误，然后 SimpleTest 会吞下它并计算通过，如果测试结束并且没有错误，那么它将失败。（对于 PHP（非致命）错误和异常，expectError 和 expectException 的作用相同。）

# macos - 杀死 USB 端口的电源

> ID：612220
> 
> 赞同：5
> 
> 时间：2009-03-04T20:10:53.617
> 
> 标签：macos, usb

有没有办法以编程方式关闭 Mac 上的电源或关闭 USB 端口？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-04T22:08:25.350

我相信 USB 电源通常直接来自电源。它可能会通过主板或其他一些硬件将其与数据线结合起来，但我认为电压不会通过任何可编程电路。如果您想停用数据传输，这可能是可能的，因为这是由扩展文件 (IOUSBMassStorageClass.kext) 处理的，但如果没有物理修改端口，我认为您将无法停用电源。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-04T22:16:13.800

如果您指的是 USB 存储设备，根据[Tiger 安全配置手册](http://images.apple.com/server/macosx/docs/Tiger_Security_Config_021507.pdf)(pdf)：

*6 要删除对大容量存储设备（例如 USB 闪存驱动器、外部 USB 硬盘驱动器、外部 FireWire 硬盘驱动器）的支持，请将以下文件拖到废纸篓：*

*IOUSBMassStorageClass.kext*

*IOFireWireSerialBusProtocolTransport.kext*

*7 打开 /System/Library 文件夹。*

*8 将以下文件拖到废纸篓：* *Extensions.kextcache* *Extensions.mkext*

*9 选择 Finder > Secure Empty Trash 删除文件。*

*10 重新启动系统。*

我在周围看到了一些其他的东西，但它们都比猎兔犬要多得多。引导将端口粘合起来以获得相当多的建议。

# django - 哪个 Web 框架产生的开销最小？

> ID：612226
> 
> 赞同：0
> 
> 时间：2009-03-04T20:13:22.270
> 
> 标签：django, web-applications, frameworks

我在我的网站托管服务上玩弄 Django。

我发现一个简单的 Django 页面，它只有一些静态文本，并且是从我创建的一个非常简单的模板呈现的，需要花费大量时间来呈现。与静态 HTML 页面相比，加载时间相差约 2 秒。请记住，这是我的一个简单测试，没有什么复杂的。另请注意，我的虚拟主机位于共享服务器（非专用）上，因此我可能会遇到一些 CPU 限制。

在我看来，要么：

1.  我有一些基本的 CGI/Apache/Django 配置错误
2.  至少在这个特定场景中，Django 需要大量开销。

我发现 #1 不太可能，因为我按照我的网络托管服务 wiki 了解如何设置 Django。所以我们留下了开销问题。

我的问题是，在网站托管在共享服务器上且 CPU/内存开销必须保持在最低限度的情况下，您认为哪个 Web 框架最适合使用？

* * *

**编辑：**似乎我的配置是我可能想看看的，也许稍后我会提出一个关于如何最好地配置 Django 的问题。

就目前而言，我希望能针对您在 Web 框架方面的一般经验以及您发现在上述场景中的性能方面最好的那些提供答案。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-04T20:19:07.607

“我有一些基本的 CGI/Apache/Django 配置错误”

正确的。

第一的。Django 第一次返回一个页面，需要很长时间。第一个请求会发生很多初始化。

第二。您使用*的是*什么具体配置。我们刚刚在守护程序模式下从 mod_python 切换到 mod_wsgi，并且对性能变化非常满意。

第三。你用的是什么数据库？

第四。您使用的是什么测试配置？

第五。您使用什么缓存参数和反向代理？

很有可能您的配置有很多自由度。

* * *

**编辑**

“你发现哪一个在性能方面是最好的”这个问题基本上是不可能回答的。

见[http://wiki.python.org/moin/WebFrameworks](http://wiki.python.org/moin/WebFrameworks)

有几十个框架。很少有人可以检查多于几个来进行正面比较。

通过静态内容实现最佳性能。制作静态页面（例如 Jinja 模板集合）的 Python 应用程序是最快的。

在那之后，基本上是不可能的。甚至[http://werkzeug.pocoo.org/](http://werkzeug.pocoo.org/)也涉及一些在上述情况下*可能无法接受的处理开销。*Python 可能很慢。

Django，只需一点点努力，通常就足够快了。例如，将静态内容与动态内容分开提供可能会大大加快速度。

由于 Django 自动完成了很多工作，因此不必编写每个小的管理页面是一个巨大的胜利。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-04T20:33:53.563

我想说你的设置必须有一些时髦的东西才能获得如此大的性能差异。尝试 mod_wsgi（如果您还没有）并遵循上面海报的优秀建议。如果 Django 真的在所有情况下都这么慢，那么公司就不可能将它用于生产应用程序。很可能*不是*Django 阻止了请求。一旦您将 .pyc 文件全部排序（自动生成的字节码），那么执行应该是相当紧凑的。

但是，如果您实际上并不需要 Django 提供的所有功能，那么为什么要使用它呢？我在一个相当大的生产应用程序中使用它，我们并没有使用它的所有功能......如果你正在做一些相当简单的事情，你可能想要考虑使用[web.py](http://webpy.org/)或[Werkzeug](http://werkzeug.pocoo.org/)之类的东西（或其他非如果您愿意，可以基于 Python）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-05T09:32:22.867

Django 或 Ruby on Rails 等框架源于现实世界的需求。尽管这些需求不同，但结果也不同。

这是我的*经验*： 作为一名前 PHP 程序员，我更喜欢[CakePHP](http://cakephp.org/)用于简单的东西，而[Symfony](http://www.symfony-project.org/)用于更高级的应用程序。我查看了 Ruby，但当时的文档很糟糕。现在我正在使用 Django。Django 非常适合我。与 Symfony 相比，我觉得 Django 带来的开箱即用灵活性较低，但更容易扩展。

另一种方法是使用“无框架” [CherryPy](http://www.cherrypy.org/)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-05T21:38:16.787

我觉得楼主可能有问题。我在我的本地主机（Mac）上进行 Django 开发，而且效果更好。我喜欢用于廉价托管的 WebFaction 和用于高级托管的 Amazon ec2。

该框架很强大，它可以处理繁重的网站 - 不要沉迷于那些东西。重要的是创建一个干净的产品，Django 可以处理它。当您看到应用程序在野外如何处理时，大约需要执行一千个步骤，但是现在，请相信我们，您无需担心框架的固有速度，然后用尽包括一个需要时使用专用 VPS/实例。

此外，按照您的编辑 - 我个人认为性能不是编程中的主要问题。以下是关注的问题：

1.  UI/UX 效率
2.  UI/UX 速度（应用程序缓存）
3.  精心设计的模型/视图
4.  系统优化（n层架构等...）
5.  流程优化（良好的 QA 以减少部署中的故障/瓶颈）
6.  子系统（数据库等）的优化
7.  硬件
8.  框架内部优化

不要浪费时间比较框架速度。它们的优势在于可扩展代码、智能架构等......

附带说明一下，不要为新的 Web 应用程序使用框架。对不起，我不能说得足够大声，但这是当今的绝对要求。这甚至不是关于不使用的辩论，只是使用哪一个。

我个人选择了Django，很棒。但我不能明确地将其他人淘汰出局。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-04T20:17:38.813

可能两者兼而有之。Django 确实有内置缓存的东西，值得一试。无论如何，任何非缓存页面几乎总是比静态文件花费更长的时间。在这两种情况下都必须读取文件，并且在动态页面的情况下，也必须执行它。然后，在这两种情况下，都发送给客户端。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-05T16:03:55.560

明确的共享主机不是运行重型框架（如 Django 或 CakePHP）的最佳选择。如果您负担得起，请购买VPS。

至于性能，可能你的主机使用 Python 和 mod-python，现在不推荐。[WSGI](http://code.google.com/p/modwsgi/)是 Python 驱动的 webapps 的首选标准。

# php - 使用 Apache .htaccess 设置 Php $_SERVER 值 ($_SERVER['something'])

> ID：612228
> 
> 赞同：24
> 
> 时间：2009-03-04T20:13:44.953
> 
> 标签：php, apache, .htaccess

是否可以使用 .htaccess 或其他 apache 功能在 php 数组 $_SERVER 中设置自定义服务器值。

例如

```
if($_SERVER['is_special']) {
    echo "Yeah for us!";
} else {
    echo "No you fool!";
} 
```

我意识到我问了很多问题，答案是否定的，所以请随意说。

* * *

## 回答 #1

> 赞同：43
> 
> 时间：2009-03-04T20:33:59.677

尝试[`SetEnv`指令](http://httpd.apache.org/docs/2.2/mod/mod_env.html#setenv)：

```
SetEnv is_special foobar 
```

# mysql - 如何在 MYSQL 中选择具有 MAX（列值）和 PARTITION 的行？

> ID：612231
> 
> 赞同：863
> 
> 时间：2009-03-04T20:14:26.573
> 
> 标签：mysql, sql, max, distinct, greatest-n-per-group

**我的桌子是：**

| ID | 家 | 约会时间 | 播放器 | 资源 |
| --- | --- | --- | --- | --- |
| 1 | 10 | 2009 年 4 月 3 日 | 约翰 | 399 |
| 2 | 11 | 2009 年 4 月 3 日 | 朱丽叶 | 244 |
| 5 | 12 | 2009 年 4 月 3 日 | 硼砂 | 555 |
| 3 | 10 | 2009 年 3 月 3 日 | 约翰 | 300 |
| 4 | 11 | 2009 年 3 月 3 日 | 朱丽叶 | 200 |
| 6 | 12 | 2009 年 3 月 3 日 | 硼砂 | 500 |
| 7 | 13 | 24/12/2008 | 硼砂 | 600 |
| 8 | 13 | 2009 年 1 月 1 日 | 硼砂 | 700 |

我需要选择每个不同的`home`持有最大值的`datetime`.

**结果将是：**

| ID | 家 | 约会时间 | 播放器 | 资源 |
| --- | --- | --- | --- | --- |
| 1 | 10 | 2009 年 4 月 3 日 | 约翰 | 399 |
| 2 | 11 | 2009 年 4 月 3 日 | 朱丽叶 | 244 |
| 5 | 12 | 2009 年 4 月 3 日 | 硼砂 | 555 |
| 8 | 13 | 2009 年 1 月 1 日 | 硼砂 | 700 |

**我试过了：**

```
-- 1 ..by the MySQL manual: 

SELECT DISTINCT
  home,
  id,
  datetime AS dt,
  player,
  resource
FROM topten t1
WHERE datetime = (SELECT
  MAX(t2.datetime)
FROM topten t2
GROUP BY home)
GROUP BY datetime
ORDER BY datetime DESC 
```

不工作。结果集有 130 行，尽管数据库有 187 行。结果包括一些重复的`home`.

```
-- 2 ..join

SELECT
  s1.id,
  s1.home,
  s1.datetime,
  s1.player,
  s1.resource
FROM topten s1
JOIN (SELECT
  id,
  MAX(datetime) AS dt
FROM topten
GROUP BY id) AS s2
  ON s1.id = s2.id
ORDER BY datetime 
```

没有。给出所有记录。

```
-- 3 ..something exotic: 
```

有各种结果。

* * *

## 回答 #1

> 赞同：1049
> 
> 时间：2009-03-04T20:22:47.270

你是如此接近！您需要做的就是同时选择家庭及其最大日期时间，然后`topten`在两个字段中加入表格：

```
SELECT tt.*
FROM topten tt
INNER JOIN
    (SELECT home, MAX(datetime) AS MaxDateTime
    FROM topten
    GROUP BY home) groupedtt 
ON tt.home = groupedtt.home 
AND tt.datetime = groupedtt.MaxDateTime 
```

* * *

## 回答 #2

> 赞同：132
> 
> 时间：2015-01-06T16:23:49.240

最快的`MySQL`解决方案，没有内部查询并且没有`GROUP BY`：

```
SELECT m.*                    -- get the row that contains the max value
FROM topten m                 -- "m" from "max"
    LEFT JOIN topten b        -- "b" from "bigger"
        ON m.home = b.home    -- match "max" row with "bigger" row by `home`
        AND m.datetime < b.datetime           -- want "bigger" than "max"
WHERE b.datetime IS NULL      -- keep only if there is no bigger than max 
```

**说明**：

使用列将表与自身连接起来`home`。的使用`LEFT JOIN`确保表中的所有行都`m`出现在结果集中。那些在 table 中没有匹配项的`b`将有`NULL`s 的列`b`。

上的另一个条件`JOIN`要求仅匹配列`b`中值`datetime`大于 中的行的行`m`。

使用问题中发布的数据，`LEFT JOIN`将产生以下对：

```
+------------------------------------------+--------------------------------+
|              the row from `m`            |    the matching row from `b`   |
|------------------------------------------|--------------------------------|
| id  home  datetime     player   resource | id    home   datetime      ... |
|----|-----|------------|--------|---------|------|------|------------|-----|
| 1  | 10  | 04/03/2009 | john   | 399     | NULL | NULL | NULL       | ... | *
| 2  | 11  | 04/03/2009 | juliet | 244     | NULL | NULL | NULL       | ... | *
| 5  | 12  | 04/03/2009 | borat  | 555     | NULL | NULL | NULL       | ... | *
| 3  | 10  | 03/03/2009 | john   | 300     | 1    | 10   | 04/03/2009 | ... |
| 4  | 11  | 03/03/2009 | juliet | 200     | 2    | 11   | 04/03/2009 | ... |
| 6  | 12  | 03/03/2009 | borat  | 500     | 5    | 12   | 04/03/2009 | ... |
| 7  | 13  | 24/12/2008 | borat  | 600     | 8    | 13   | 01/01/2009 | ... |
| 8  | 13  | 01/01/2009 | borat  | 700     | NULL | NULL | NULL       | ... | *
+------------------------------------------+--------------------------------+ 
```

最后，该`WHERE`子句只保留`NULL`在的列中有 s 的对`b`（它们`*`在上表中用 标记）；这意味着，由于`JOIN`子句中的第二个条件，从中选择的行在`m`column 中具有最大值`datetime`。

阅读[SQL Antipatterns: Avoiding the Pitfalls of Database Programming](https://pragprog.com/book/bksqla/sql-antipatterns)一书，了解其他 SQL 技巧。

* * *

## 回答 #3

> 赞同：80
> 
> 时间：2009-03-04T20:59:52.580

这里是**T-SQL**版本：

```
-- Test data
DECLARE @TestTable TABLE (id INT, home INT, date DATETIME, 
  player VARCHAR(20), resource INT)
INSERT INTO @TestTable
SELECT 1, 10, '2009-03-04', 'john', 399 UNION
SELECT 2, 11, '2009-03-04', 'juliet', 244 UNION
SELECT 5, 12, '2009-03-04', 'borat', 555 UNION
SELECT 3, 10, '2009-03-03', 'john', 300 UNION
SELECT 4, 11, '2009-03-03', 'juliet', 200 UNION
SELECT 6, 12, '2009-03-03', 'borat', 500 UNION
SELECT 7, 13, '2008-12-24', 'borat', 600 UNION
SELECT 8, 13, '2009-01-01', 'borat', 700

-- Answer
SELECT id, home, date, player, resource 
FROM (SELECT id, home, date, player, resource, 
    RANK() OVER (PARTITION BY home ORDER BY date DESC) N
    FROM @TestTable
)M WHERE N = 1

-- and if you really want only home with max date
SELECT T.id, T.home, T.date, T.player, T.resource 
    FROM @TestTable T
INNER JOIN 
(   SELECT TI.id, TI.home, TI.date, 
        RANK() OVER (PARTITION BY TI.home ORDER BY TI.date) N
    FROM @TestTable TI
    WHERE TI.date IN (SELECT MAX(TM.date) FROM @TestTable TM)
)TJ ON TJ.N = 1 AND T.id = TJ.id 
```

**编辑**
不幸的是，MySQL 中没有 RANK() OVER 函数。
但它可以被模拟，请参阅[Emulating Analytic (AKA Ranking) Functions with MySQL](http://www.oreillynet.com/pub/a/mysql/2007/03/29/emulating-analytic-aka-ranking-functions-with-mysql.html?page=3)。
所以这是**MySQL**版本：

```
SELECT id, home, date, player, resource 
FROM TestTable AS t1 
WHERE 
    (SELECT COUNT(*) 
            FROM TestTable AS t2 
            WHERE t2.home = t1.home AND t2.date > t1.date
    ) = 0 
```

* * *

## 回答 #4

> 赞同：30
> 
> 时间：2009-03-04T20:24:20.747

即使您有两行或多行，每行都`home`具有相等`DATETIME`的 's，这也将起作用：

```
SELECT id, home, datetime, player, resource
FROM   (
       SELECT (
              SELECT  id
              FROM    topten ti
              WHERE   ti.home = t1.home
              ORDER BY
                      ti.datetime DESC
              LIMIT 1
              ) lid
       FROM   (
              SELECT  DISTINCT home
              FROM    topten
              ) t1
       ) ro, topten t2
WHERE  t2.id = ro.lid 
```

* * *

## 回答 #5

> 赞同：22
> 
> 时间：2009-03-04T20:30:58.797

我认为这会给你想要的结果：

```
SELECT   home, MAX(datetime)
FROM     my_table
GROUP BY home 
```

**但是**如果您还需要其他列，只需与原始表进行连接（检查`Michael La Voie`答案）

最好的祝福。

* * *

## 回答 #6

> 赞同：17
> 
> 时间：2010-12-05T17:04:14.373

由于人们似乎不断地遇到这个线程（评论日期范围从 1.5 年开始）并没有这么简单：

`SELECT * FROM (SELECT * FROM topten ORDER BY datetime DESC) tmp GROUP BY home`

不需要聚合函数...

干杯。

* * *

## 回答 #7

> 赞同：11
> 
> 时间：2010-02-16T20:51:50.110

你也可以试试这个，对于大表的查询性能会更好。当每个家庭的记录不超过两个并且它们的日期不同时，它就会起作用。更好的通用 MySQL 查询来自上面的 Michael La Voie。

```
SELECT t1.id, t1.home, t1.date, t1.player, t1.resource
FROM   t_scores_1 t1 
INNER JOIN t_scores_1 t2
   ON t1.home = t2.home
WHERE t1.date > t2.date 
```

或者如果是 Postgres 或那些提供分析功能的数据库，请尝试

```
SELECT t.* FROM 
(SELECT t1.id, t1.home, t1.date, t1.player, t1.resource
  , row_number() over (partition by t1.home order by t1.date desc) rw
 FROM   topten t1 
 INNER JOIN topten t2
   ON t1.home = t2.home
 WHERE t1.date > t2.date 
) t
WHERE t.rw = 1 
```

* * *

## 回答 #8

> 赞同：9
> 
> 时间：2009-03-04T20:58:54.470

```
SELECT  tt.*
FROM    TestTable tt 
INNER JOIN 
        (
        SELECT  coord, MAX(datetime) AS MaxDateTime 
        FROM    rapsa 
        GROUP BY
                krd 
        ) groupedtt
ON      tt.coord = groupedtt.coord
        AND tt.datetime = groupedtt.MaxDateTime 
```

* * *

## 回答 #9

> 赞同：8
> 
> 时间：2009-03-05T23:19:39.977

这适用于甲骨文：

```
with table_max as(
  select id
       , home
       , datetime
       , player
       , resource
       , max(home) over (partition by home) maxhome
    from table  
)
select id
     , home
     , datetime
     , player
     , resource
  from table_max
 where home = maxhome 
```

* * *

## 回答 #10

> 赞同：8
> 
> 时间：2014-01-17T12:11:29.883

在 SQL Server 上试试这个：

```
WITH cte AS (
   SELECT home, MAX(year) AS year FROM Table1 GROUP BY home
)
SELECT * FROM Table1 a INNER JOIN cte ON a.home = cte.home AND a.year = cte.year 
```

* * *

## 回答 #11

> 赞同：5
> 
> 时间：2012-07-12T16:11:16.000

```
SELECT c1, c2, c3, c4, c5 FROM table1 WHERE c3 = (select max(c3) from table)

SELECT * FROM table1 WHERE c3 = (select max(c3) from table1) 
```

* * *

## 回答 #12

> 赞同：5
> 
> 时间：2014-02-01T09:12:32.820

这是 MySQL 版本，它只打印一个条目，其中一组中有重复的 MAX(datetime)。

你可以在这里测试[http://www.sqlfiddle.com/#!2/0a4ae/1](http://www.sqlfiddle.com/#!2/0a4ae/1)

## 样本数据

```
mysql> SELECT * from topten;
+------+------+---------------------+--------+----------+
| id   | home | datetime            | player | resource |
+------+------+---------------------+--------+----------+
|    1 |   10 | 2009-04-03 00:00:00 | john   |      399 |
|    2 |   11 | 2009-04-03 00:00:00 | juliet |      244 |
|    3 |   10 | 2009-03-03 00:00:00 | john   |      300 |
|    4 |   11 | 2009-03-03 00:00:00 | juliet |      200 |
|    5 |   12 | 2009-04-03 00:00:00 | borat  |      555 |
|    6 |   12 | 2009-03-03 00:00:00 | borat  |      500 |
|    7 |   13 | 2008-12-24 00:00:00 | borat  |      600 |
|    8 |   13 | 2009-01-01 00:00:00 | borat  |      700 |
|    9 |   10 | 2009-04-03 00:00:00 | borat  |      700 |
|   10 |   11 | 2009-04-03 00:00:00 | borat  |      700 |
|   12 |   12 | 2009-04-03 00:00:00 | borat  |      700 |
+------+------+---------------------+--------+----------+ 
```

## 带有用户变量的 MySQL 版本

```
SELECT *
FROM (
    SELECT ord.*,
        IF (@prev_home = ord.home, 0, 1) AS is_first_appear,
        @prev_home := ord.home
    FROM (
        SELECT t1.id, t1.home, t1.player, t1.resource
        FROM topten t1
        INNER JOIN (
            SELECT home, MAX(datetime) AS mx_dt
            FROM topten
            GROUP BY home
          ) x ON t1.home = x.home AND t1.datetime = x.mx_dt
        ORDER BY home
    ) ord, (SELECT @prev_home := 0, @seq := 0) init
) y
WHERE is_first_appear = 1;
+------+------+--------+----------+-----------------+------------------------+
| id   | home | player | resource | is_first_appear | @prev_home := ord.home |
+------+------+--------+----------+-----------------+------------------------+
|    9 |   10 | borat  |      700 |               1 |                     10 |
|   10 |   11 | borat  |      700 |               1 |                     11 |
|   12 |   12 | borat  |      700 |               1 |                     12 |
|    8 |   13 | borat  |      700 |               1 |                     13 |
+------+------+--------+----------+-----------------+------------------------+
4 rows in set (0.00 sec) 
```

## 已接受答案的输出

```
SELECT tt.*
FROM topten tt
INNER JOIN
    (
    SELECT home, MAX(datetime) AS MaxDateTime
    FROM topten
    GROUP BY home
) groupedtt ON tt.home = groupedtt.home AND tt.datetime = groupedtt.MaxDateTime
+------+------+---------------------+--------+----------+
| id   | home | datetime            | player | resource |
+------+------+---------------------+--------+----------+
|    1 |   10 | 2009-04-03 00:00:00 | john   |      399 |
|    2 |   11 | 2009-04-03 00:00:00 | juliet |      244 |
|    5 |   12 | 2009-04-03 00:00:00 | borat  |      555 |
|    8 |   13 | 2009-01-01 00:00:00 | borat  |      700 |
|    9 |   10 | 2009-04-03 00:00:00 | borat  |      700 |
|   10 |   11 | 2009-04-03 00:00:00 | borat  |      700 |
|   12 |   12 | 2009-04-03 00:00:00 | borat  |      700 |
+------+------+---------------------+--------+----------+
7 rows in set (0.00 sec) 
```

* * *

## 回答 #13

> 赞同：5
> 
> 时间：2017-11-05T13:35:40.160

另一种使用子查询 gt 每组最近行的方法，该子查询基本上计算每组每行的排名，然后过滤掉最近的行，如 rank = 1

```
select a.*
from topten a
where (
  select count(*)
  from topten b
  where a.home = b.home
  and a.`datetime` < b.`datetime`
) +1 = 1 
```

[演示](http://sqlfiddle.com/#!9/37a0d/16)

这是每行排名不的[视觉演示](http://sqlfiddle.com/#!9/37a0d/17)，以便更好地理解

> 通过阅读一些评论**，如果有两行具有相同的 'home' 和 'datetime' 字段值怎么办？**

上述查询将失败，并将针对上述情况返回超过 1 行。为了掩盖这种情况，将需要另一个标准/参数/列来决定在上述情况下应该采用哪一行。通过查看示例数据集，我假设有一个主键列`id`应该设置为自动递增。因此，我们可以使用此列通过调整相同的查询来选择最近的行，`CASE`例如

```
select a.*
from topten a
where (
  select count(*)
  from topten b
  where a.home = b.home
  and  case 
       when a.`datetime` = b.`datetime`
       then a.id < b.id
       else a.`datetime` < b.`datetime`
       end
) + 1 = 1 
```

[演示](http://sqlfiddle.com/#!9/d2f025/2)

`datetime`上面的查询将在相同的值中选择具有最高 id 的行

每行排名不的[视觉演示](http://sqlfiddle.com/#!9/d2f025/3)

* * *

## 回答 #14

> 赞同：3
> 
> 时间：2015-10-03T10:20:10.213

为什么不使用： SELECT home, MAX(datetime) AS MaxDateTime,player,resource FROM topten GROUP BY home 我错过了什么吗？

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2017-05-08T06:27:47.173

@Michae 接受的答案在大多数情况下都可以正常工作，但对于以下情况却失败了。

如果有 2 行 HomeID 和 Datetime 相同，则查询将返回两行，而不是根据需要返回不同的 HomeID，以便在查询中添加 Distinct，如下所示。

```
SELECT DISTINCT tt.home  , tt.MaxDateTime
FROM topten tt
INNER JOIN
    (SELECT home, MAX(datetime) AS MaxDateTime
    FROM topten
    GROUP BY home) groupedtt 
ON tt.home = groupedtt.home 
AND tt.datetime = groupedtt.MaxDateTime 
```

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2021-03-31T17:11:40.630

在 MySQL 8.0 中，这可以通过使用带有公共表表达式的 row_number() 窗口函数来有效地实现。

（这里的 row_number() 基本上为每个玩家从资源的降序顺序从 1 开始为每一行生成唯一的序列。因此，对于每个序列号为 1 的玩家行将具有最高的资源值。现在我们需要做的就是选择行每个玩家的序列号为 1。可以通过围绕该查询编写一个外部查询来完成。但是我们使用公共表表达式代替，因为它更具可读性。）

架构：

```
 create  TABLE TestTable(id INT, home INT, date DATETIME, 
   player VARCHAR(20), resource INT);
 INSERT INTO TestTable
 SELECT 1, 10, '2009-03-04', 'john', 399 UNION
 SELECT 2, 11, '2009-03-04', 'juliet', 244 UNION
 SELECT 5, 12, '2009-03-04', 'borat', 555 UNION
 SELECT 3, 10, '2009-03-03', 'john', 300 UNION
 SELECT 4, 11, '2009-03-03', 'juliet', 200 UNION
 SELECT 6, 12, '2009-03-03', 'borat', 500 UNION
 SELECT 7, 13, '2008-12-24', 'borat', 600 UNION
 SELECT 8, 13, '2009-01-01', 'borat', 700 
```

询问：

```
 with cte as 
 (
     select id, home, date , player, resource, 
     Row_Number()Over(Partition by home order by date desc) rownumber from TestTable
 )
 select id, home, date , player, resource from cte where rownumber=1 
```

输出：

| ID | 家 | 日期 | 播放器 | 资源 |
| --- | --- | --- | --- | --- |
| 1 | 10 | 2009-03-04 00:00:00 | 约翰 | 399 |
| 2 | 11 | 2009-03-04 00:00:00 | 朱丽叶 | 244 |
| 5 | 12 | 2009-03-04 00:00:00 | 硼砂 | 555 |
| 8 | 13 | 2009-01-01 00:00:00 | 硼砂 | 700 |

*db<>[在这里摆弄](https://dbfiddle.uk/?rdbms=mysql_8.0&fiddle=50d491089baa4d84093e0c70ce9f867f)*

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2009-03-04T20:41:52.407

试试这个

```
select * from mytable a join
(select home, max(datetime) datetime
from mytable
group by home) b
 on a.home = b.home and a.datetime = b.datetime 
```

问候 K

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2016-07-14T06:45:29.157

这是您需要的查询：

```
 SELECT b.id, a.home,b.[datetime],b.player,a.resource FROM
 (SELECT home,MAX(resource) AS resource FROM tbl_1 GROUP BY home) AS a

 LEFT JOIN

 (SELECT id,home,[datetime],player,resource FROM tbl_1) AS b
 ON  a.resource = b.resource WHERE a.home =b.home; 
```

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2020-01-14T16:41:03.027

希望下面的查询将给出所需的输出：

```
Select id, home,datetime,player,resource, row_number() over (Partition by home ORDER by datetime desc) as rownum from tablename where rownum=1 
```

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2020-10-07T23:22:03.337

*（注意：迈克尔的答案非常适合目标列`datetime`不能为每个不同的重复值的情况`home`。）*

如果您的表中**x有****重复的行，并且您只需要为每个不同的列选择一行`home``datetime``home`**，那么这是我的解决方案：

您的表格需要一个唯一的列（如`id`）。如果没有，请创建一个视图并向其中添加一个随机列。

`home`使用此查询为每个唯一值选择一行。`id`在重复的情况下选择最低的`datetime`。

```
SELECT tt.*
FROM topten tt
INNER JOIN
    (
    SELECT min(id) as min_id, home from topten tt2
    INNER JOIN 
        (
        SELECT home, MAX(datetime) AS MaxDateTime
        FROM topten
        GROUP BY home) groupedtt2
    ON tt2.home = groupedtt2.home
    ) as groupedtt
ON tt.id = groupedtt.id 
```

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2021-07-16T13:02:44.363

如果有 2 条具有相同日期和家庭的记录，则接受的答案对我不起作用。加入后将返回 2 条记录。虽然我需要选择其中的任何一个（随机）。此查询用作连接子查询，因此无法仅限制 1。这是我达到预期结果的方式。但是不知道性能。

```
select SUBSTRING_INDEX(GROUP_CONCAT(id order by datetime desc separator ','),',',1) as id, home, MAX(datetime) as 'datetime'
 from topten
 group by (home) 
```

# c# - 使用 .NET 2.0，我如何通过 FTP 连接到服务器、获取文件并删除文件？

> ID：612235
> 
> 赞同：6
> 
> 时间：2009-03-04T20:15:31.250
> 
> 标签：c#, .net, .net-2.0, ftp

.NET (C#) 是否内置了用于 FTP 的库？我不需要任何疯狂的东西......非常简单。

我需要：

1.  FTP到一个帐户
2.  检测连接是否被拒绝
3.  获取文本文件
4.  删除文本文件

最简单的方法是什么？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-04T20:16:57.333

使用[FtpWebRequest](http://msdn.microsoft.com/en-us/library/system.net.ftpwebrequest.aspx)类或普通的旧[WebClient](http://msdn.microsoft.com/en-us/library/system.net.webclient.aspx)类。

FTP到一个帐户并检索一个文件：

```
WebClient request = new WebClient();
request.Credentials = 
    new NetworkCredential("anonymous", "janeDoe@contoso.com");
try 
{
    // serverUri here uses the FTP scheme ("ftp://").
    byte[] newFileData = request.DownloadData(serverUri.ToString());
    string fileString = Encoding.UTF8.GetString(newFileData);
}
catch (WebException ex)
{
    // Detect and handle login failures etc here
} 
```

删除文件：

```
FtpWebRequest request = (FtpWebRequest)WebRequest.Create(serverUri);
request.Method = WebRequestMethods.Ftp.DeleteFile;
FtpWebResponse response = (FtpWebResponse)request.GetResponse();
Console.WriteLine("Delete status: {0}", response.StatusDescription);  
response.Close(); 
```

（代码示例来自 MSDN。）

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-04T20:17:38.673

[本文](http://www.codeguru.com/csharp/csharp/cs_internet/desktopapplications/article.php/c13163)使用 .NET 2.0 为 FTP 客户端实现 GUI，并提供完整的示例源代码。

示例代码包括连接、下载和上传以及良好的评论和解释。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-04T20:17:45.647

只需使用[FtpWebRequest](http://msdn.microsoft.com/en-us/library/system.net.ftpwebrequest.aspx)类。它已经处理了您需要的所有事情。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-04T20:17:23.197

使用[`System.Net.FtpWebRequest`](http://msdn.microsoft.com/en-us/library/system.net.ftpwebrequest.aspx)/[`FtpWebResponse`](http://msdn.microsoft.com/en-us/library/system.net.ftpwebresponse.aspx)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-06-04T06:59:57.630

使用[edtFTPnet](http://www.enterprisedt.com/products/edtftpnet/overview.html)，一个免费的开源 .NET FTP 库，可以满足您的一切需求。

# ruby-on-rails - rake db:create 可以在多个数据库中创建表吗？

> ID：612236
> 
> 赞同：4
> 
> 时间：2009-03-04T20:15:56.257
> 
> 标签：ruby-on-rails, database

我可以使用在两个数据库中创建表`db:create`吗？例如，我可以在`database.yml`for`one_development`和中有条目，`two_development`并且两者都由 ? 创建`rake db:create`？我知道 rake db:create:all 有效——我只是想知道是否有办法根据 RAILS_ENV 对创建的内容进行分段？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-24T07:34:42.130

For **one_development** you can execute this command:

```
RAILS_ENV=one_development rake db:create 
```

For **two_development** you can execute this command:

```
RAILS_ENV=two_development rake db:create 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-04T20:59:32.847

重新定义 rake 任务或创建一个新任务，该任务`rake db:create`针对您需要的两种环境运行。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-04T20:23:54.227

它似乎自动完成所有数据集。查看源代码：

[http://dev.rubyonrails.org/changeset/6849](http://dev.rubyonrails.org/changeset/6849)

它似乎没有像 drop 等那样使用 RAILS_ENV。

# asp.net - IIS 7.0 503 错误与实现 IHttpAsyncHandler 的通用处理程序 (.ashx)

> ID：612242
> 
> 赞同：7
> 
> 时间：2009-03-04T20:16:31.577
> 
> 标签：asp.net, iis-7, ashx, ihttpasynchandler, http-status-code-503

我在使用实现 IHttpAsyncHandler 的通用处理程序时遇到了一些性能问题。在最简单的情况下，处理程序接收到一个 GET 请求，并在 20 秒后将“< timeout />”写入响应后结束响应。

当用 10000-20000 个同时请求敲击 .ashx 时，它会在恰好 5000 个请求后失败，503 服务器不可用。当切换到同步模式并立即结束请求时，问题就消失了。

我已经修改了许多设置，但我唯一设法实现的是降低发生此错误的请求阈值。

这是我玩弄过的设置的简要说明：

**机器配置：**

```
<configuration>
    ...
    <system.web>
        ...
        <processModel enable="true" requestQueueLimit="10000"/>
        ... 
```

**网络配置：**

```
<configuration>
    ...
    <system.web>
        ...
        <httpRuntime enable="true" appRequestQueueLimit="10000"/>
        ... 
```

**IIS 管理器 > 应用程序池 > 高级设置**

```
Queue Length : 65535 
```

虽然我不能确定，如果请求是同步的，这些设置似乎工作得很好，但是当异步时，在服务器开始告诉我离开之前，我似乎无法超过 5000 个请求。如果我把事情设置得更低（不记得上面到底是哪个设置，但我都试过了），那么 503 计数会相应增加，但在严重负载下我永远无法阻止它超过 5000 .

似乎有许多设置分散在可能会影响这一点的无数地方，但 5000 似乎相当固定。我[在这里](http://74.125.77.132/search?q=cache:Rw6hb12Ac94J:www.duringlunch.com/file.axd%3Ffile%3DAdvanced%2BASP.Net%2B2.ppt+appRequestQueueLimit+%22up+to%22+5000&hl=en&ct=clnk&cd=1&gl=uk&client=firefox-a)看到 appRequestQueueLimit 不能超过 5000，但找不到有关此的更多信息，并且想知道这是否是错误信息。

IIS 中是否有任何类型的“洪水控制”设置可能将单个主机限制为不超过 5000 个请求？如何让 IIS 处理超过 5000 个并发异步请求？

**Edit2：是否有任何可能超出限制的计数器或其他指标，我将如何进一步调查？**

编辑：这是负载生成器代码：

```
using System;
using System.Net;
using System.Threading;

namespace HammerTime
{
    class Program
    {
        private static int counter = 0;
        static void Main(string[] args)
        {
            var limit = 5000;
            ServicePointManager.DefaultConnectionLimit=limit;
            for (int i = 0; i < limit;++i )
            {
                StartWebRequest(i.ToString());

            }
            Console.ReadLine();
        }

        private static void StartWebRequest(string channelId)
        {
            string uri = "http://spender2008/test/Test.ashx?channel="+channelId;
            HttpWebRequest request = (HttpWebRequest) WebRequest.Create(uri);
            request.BeginGetResponse(responseHandler, request);
        }

        private static void responseHandler(IAsyncResult ar)
        {
            try
            {
                HttpWebRequest state = (HttpWebRequest)ar.AsyncState;
                HttpWebResponse response = (HttpWebResponse)state.EndGetResponse(ar);

            }
            catch(Exception e)
            {
                Console.WriteLine(e.Message);
            }
            finally
            {
                Console.WriteLine(Interlocked.Increment(ref counter));
            }

        }
    }
} 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-04T23:08:28.123

好的。已修复...非常感谢[这篇](http://blogs.technet.com/winserverperformance/default.aspx)文章清理了一些细节。

要消除 503 错误，需要进行 3 次不同的配置更改：

**机器配置：**

```
<configuration>
    ...
    <system.web>
        ...
        <processModel enable="true" requestQueueLimit="100000"/> 
```

**IIS 管理器 > 应用程序池 > 高级设置**

```
Queue Length : 65535 
```

最后（拼图的缺失部分）命令行：

```
appcmd.exe set config /section:serverRuntime /appConcurrentRequestLimit:100000 
```

主帖中提到的 web.config 设置无关紧要。

10000个并发连接，没问题。感谢帮助！

# c# - .eml 到 .pdf API

> ID：612248
> 
> 赞同：1
> 
> 时间：2009-03-04T20:17:33.447
> 
> 标签：c#, api, pdf-generation, eml

是否有将 .eml 转换为 .pdf 的 C# API？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-04T20:56:16.100

我们有一个类似的任务，但规模要小得多，这是一个临时解决方案。我们将 EML 文件转换为 HTML 页面，然后使用[ABC Pdf](http://www.websupergoo.com/abcpdf-1.htm)组件（我认为他们当时有免费版本？）从 HTML 页面创建 PDF 文件。我们直接从 ASP.NET 页面完成所有操作。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-04T20:54:41.657

使用 OpenOffice ( [http://www.openoffice.org](http://www.openoffice.org) )

这基本上会将任何内容转换为 PDF（doc、xls、ppt、txt）。既然 eml 只是 txt，为什么不直接使用呢？有关如何在 C# 中使用 OpenOffice，请参阅[http://www.opendocument4all.com/download/OpenOffice.net.pdf 。](http://www.opendocument4all.com/download/OpenOffice.net.pdf)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-12-11T12:18:34.310

当 Microsoft Outlook 实用程序接收一封电子邮件并将其保存为计算机文件时，该邮件通常以 MSG 文件格式存储。然后，计算机用户通常需要 Microsoft Outlook 或能够读取 MSG 文件格式的类似程序来访问该文件中包含的信息。值得庆幸的是，用户不再受到这些限制的负担。PST Viewer Pro 是一个实用程序，可以根据您的特定需求成功地将 Outlook MSG 文件导出为各种不同的文件格式。例如，只需单击几下鼠标，您就可以获取一个 MSG 文件并将其转换为 Adob​​e 流行的 PDF 文件格式。

***第1步***

使用 PST Viewer Pro “Explorer Tree”突出显示存储 MSG 文件的目录。“Explorer Tree”是沿 PST Viewer Pro 程序窗口左侧运行的列的名称。它在外观上类似于 Microsoft 的 Windows 资源管理器中的标准文件夹树。您选择的任何目录的内容都将逐项列出并显示在窗口顶部的“邮件列表”中。

***第2步***

在“邮件列表”中单击您要转换的 MSG 文件。您选择的任何消息的内容都将显示在邮件列表的底部。浏览您选择的 MSG 文件，直到找到要转换的文件。

***第 3 步***

从 PST Viewer Pro 顶部的下拉菜单中选择适当的 PDF 设置。您可以选择总共七种 PDF 设置，包括“PDF - 嵌入的附件”、“PDF - 转换/包含的附件​​”、“PDF - 保存到磁盘的附件”等。根据您的需要做出适当的选择。

***第4步***

右键单击“邮件列表”中的 MSG 文件，然后选择“导出”选项。请注意，您还可以从 PST Viewer Pro 顶部的“导出”下拉菜单中选择“导出”选项。此外，您还可以同时按键盘上的`CTRL`和。`E`所有三种方法都将打开转换文件所需的窗口。

***第 5 步***

在您要用于保存 PDF 的文件夹列表上单击一次。您还可以选择“新建文件夹”按钮在当前查看的目录中创建一个新文件夹。做出选择后，单击“确定”。PST Viewer Pro 将获取原始 MSG 文件的内容，并根据您的规格将其转换为 PDF 格式。

您可以通过查看保存文件的目录并使用 Adob​​e Reader 等程序打开它来检查以确保 PDF 转换成功。然后可以将转换后的 PDF 文件以附件的形式通过电子邮件发送给您选择的任何收件人。您还可以根据需要将文件备份到硬盘驱动器或外部 USB 闪存驱动器以进行存档。

还有更多关于如何将 eml 文件导出为 pdf 的教程[http://www.emlviewer.net/2012/08/eml-to-pdf.html](http://www.emlviewer.net/2012/08/eml-to-pdf.html)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-04T20:23:51.107

你不能把文件打印成pdf吗？

**编辑：** 我想我说的是而不是寻找 .eml 到 .pdf 的转换工具；您可以寻找可以自动打印 100 个或 1000 个 .eml 的批量打印工具。然后，您只需将工具批量打印为 pdf。

# c# - Parallel Linq - 使用比处理器更多的线程（用于非 CPU 绑定任务）

> ID：612253
> 
> 赞同：10
> 
> 时间：2009-03-04T20:18:46.050
> 
> 标签：c#, linq, multithreading

我正在使用并行 linq，并且我正在尝试使用这样的基本代码同时下载许多 url：

```
int threads = 10;
Dictionary<string, string> results = urls.AsParallel( threads ).ToDictionary( url => url, url => GetPage( url ); 
```

由于下载网页受网络限制而不是 CPU 限制，因此使用比我的处理器/内核数量更多的线程是非常有益的，因为每个线程中的大部分时间都花在等待网络赶上。但是，从在我的双核机器上运行线程 = 2 与线程 = 10 的性能相同的事实判断，我认为发送到 AsParallel 的线程受限于内核数量。

有没有办法覆盖这种行为？是否有没有此限制的类似库可用？

（我找到了这样一个用于 python 的库，但需要在 .Net 中工作的东西）

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-03-04T20:22:33.573

URL 是否引用同一服务器？如果是这样，则可能是您达到了 HTTP 连接限制而不是线程限制。有一个简单的方法来判断 - 将您的代码更改为：

```
int threads = 10;
Dictionary<string, string> results = urls.AsParallel(threads)
    .ToDictionary(url => url, 
                  url => {
                      Console.WriteLine("On thread {0}",
                                        Thread.CurrentThread.ManagedThreadId);
                      return GetPage(url);
                  }); 
```

编辑：嗯。*我根本*无法使用一些示例代码`ToDictionary()`进行并行化。它适用于但不是。会搜索一下。*`Select(url => GetPage(url))``ToDictionary`*

 *编辑：好的，我仍然无法`ToDictionary`并行化，但你可以解决这个问题。这是一个简短但完整的程序：

```
using System;
using System.Collections.Generic;
using System.Threading;
using System.Linq;
using System.Linq.Parallel;

public class Test
{

    static void Main()
    {
        var urls = Enumerable.Range(0, 100).Select(i => i.ToString());

        int threads = 10;
        Dictionary<string, string> results = urls.AsParallel(threads)
            .Select(url => new { Url=url, Page=GetPage(url) })
            .ToDictionary(x => x.Url, x => x.Page);
    }

    static string GetPage(string x)
    {
        Console.WriteLine("On thread {0} getting {1}",
                          Thread.CurrentThread.ManagedThreadId, x);
        Thread.Sleep(2000);
        return x;
    }
} 
```

那么，这使用了多少个线程？5\. 为什么？天知道。我有 2 个处理器，所以不是这样 - 我们指定了 10 个线程，所以不是这样。即使我改变`GetPage`锤击CPU，它仍然使用5。

如果您只需要将它用于一项特定任务 - 而且您不介意代码有点臭 - 老实说，您最好自己实现它。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-03-04T20:39:55.997

默认情况下，.Net 限制到一个终端服务点（IP：端口）的 2 个并发连接。这就是为什么如果所有 url 都指向同一个服务器，您将看不到差异的原因。

它可以使用[ServicePointManager.DefaultPersistentConnectionLimit](http://msdn.microsoft.com/en-us/library/system.net.servicepointmanager.defaultpersistentconnectionlimit.aspx)属性进行控制。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-05T11:06:10.020

我认为这个问题已经有了很好的答案，但我想强调一点。将 PLINQ 用于不受 CPU 限制的任务原则上是错误的设计。并不是说它不起作用——它会起作用，但是在不必要的时候使用多个线程会导致麻烦。

不幸的是，在 C# 中没有解决这个问题的好方法。在 F# 中，您可以使用并行运行的异步工作流，但在执行异步调用时不要阻塞线程（在幕后，它使用`BeginOperation`和`EndOperation`方法）。您可以在这里找到更多信息：

*   [F# 中的并发——第一部分——异步工作流](http://strangelights.com/blog/archive/2007/09/29/1597.aspx)

同样的想法在某种程度上可以用在 C# 中，但是看起来有点奇怪（但它更有效）。我写了一篇关于这个的文章，还有一个库应该比我最初的想法稍微进化一些：

*   [使用迭代器在 C# 中进行异步编程](http://tomasp.net/blog/csharp-async.aspx)
*   [EasyAsync 库](http://www.codeplex.com/EasyAsync)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-04T20:23:38.533

监控您的网络流量。如果 URL 来自同一个域，则可能会限制带宽。更多的连接实际上可能不会提供任何加速。

# asp.net - 如何拥有 ASP.NET 模板化复合控件？

> ID：612255
> 
> 赞同：2
> 
> 时间：2009-03-04T20:19:24.707
> 
> 标签：asp.net, templates, composite-controls

我正在尝试将模板添加到包含标签和文本框的简化复合控件。我希望我的标记看起来像这样：

```
<test:FormItem ID="fi" runat="server" Title="MyTitle" Text="My Text!">
    <TestTemplate>
        <i>
            <%# Container.Title) %></i>
        <br />
        <%# Container.Text %>
    </TestTemplate>
</test:FormItem> 
```

我有一个 templateContainer 类，它具有 TextBox 和 Label 的属性。

```
public class TemplateContainer : WebControl, INamingContainer
{

    public TextBox Text { get { return m_item.Text; } }
    public Label Title { get { return m_item.Title; } }

    private FormItem m_item;

    public TemplateContainer(FormItem item)
    {
        m_item = item;
    }

} 
```

在主 FormItem 类中，我有一个从 CreateChildControls() 调用的 CreateControlHierarchy() 方法：

```
protected virtual void CreateControlHierarchy()
    {

        m_itemTemplateContainer = new TemplateContainer(this);
        TestTemplate.InstantiateIn(m_itemTemplateContainer);

        Controls.Add(m_itemTemplateContainer);

    } 
```

我想要的是模板呈现实际控制。相反，它在控件上调用 ToString() 并显示 System.Web.UI.WebControls.Label 和 System.Web.UI.WebControls.TextBox。有没有办法让模板将控件添加到它的集合中，而不仅仅是在它们上调用 ToString() ？

注意：我还尝试将文本框和标签添加到执行相同操作的容器的控件集合中。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-05T20:48:45.783

行。所以我尝试了一些事情，我想出了一个好的解决方案。

首先，我尝试在数据绑定表达式中使用方法，然后跟踪文本框或标签在容器的 Control 集合中的位置。但是，CompiledTemplateBuilder（这是 .Net 内部为标记中指定的 ITemplates 构建的内容）将两个绑定表达式之前和之后的所有标记放入一个 DataBoundLiteral 控件中，并且在调用该方法时已经构建了 Control 集合。

起作用的是创建一个新的 WebControl，它充当复合控件中控件的占位符。它有一个属性 Control，当设置时，它将控件添加到它的 Controls 集合中。

```
public class FormItemPlaceHolder : WebControl, INamingContainer
{
    public WebControl Control
    {
        get
        {
            if(Controls.Count == 0)
                return null;
            return Controls[0] as WebControl;
        }
        set
        {
            if (Controls.Count != 0)
                Controls.Clear();
            Controls.Add(value);
        }
    }

} 
```

然后在标记中，我创建了一个这种类型的控件并将它的 Control 属性绑定到容器中的正确属性。

```
<test:FormItem ID="fi" runat="server" Title="MyTitle" Text="My Text!">
    <TestTemplate>
        <i>
        <test:FormItemPlaceHolder ID="ph" runat="server" 
            Control='<%# Container.Title %>' />
        </i>
        <br />
         <test:FormItemPlaceHolder ID="ph2" runat="server" 
             Control='<%# Container.Text %>' />
    </TestTemplate>
</test:FormItem> 
```

有没有人有更好的解决方案？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-11T00:09:23.933

容器不应该定义控件，只定义数据。

您应该在标记中定义数据的实际控件，并为它们分配容器中的值。

例如

```
public class TemplateContainer : UserControl
{
    public string Text { get { return m_text; } }
    public string Title { get { return m_title; } }

    private string m_text;
    private string m_title;
    private FormItem m_item;

    public TemplateContainer(FormItem item)
    {
        m_item = item;
    }

} 
```

在标记中：

```
 <test:FormItem ID="fi" runat="server" Title="MyTitle" Text="My Text!">
        <TestTemplate>
            <i><asp:Label runat="server" Text='<%# Container.Title) %>' /></i>
            <br />
            <asp:TextBox runat="server" Text='<%# Container.Text %>' />
    </TestTemplate>
</test:FormItem> 
```

如果您尝试创建不需要在标记中添加控件的复合控件，那么您为什么要使用模板？如果只是为了造型，那么创建自己的 Style 对象可能更有效？

# ruby - Ruby 的 puts 和 write 方法有什么区别？

> ID：612258
> 
> 赞同：22
> 
> 时间：2009-03-04T20:20:27.840
> 
> 标签：ruby

有什么区别...

```
File.open('abc', 'w') { |f| f.puts 'abcde' } 
```

...和...

```
File.open('abc', 'w') { |f| f.write 'abcde' } 
```

...？

* * *

## 回答 #1

> 赞同：35
> 
> 时间：2009-03-04T20:24:24.413

puts 附加一个换行符， write 没有。从技术上讲，如果结尾没有记录分隔符（通常是换行符）， puts 会将记录分隔符（通常是换行符）附加到输出中。write 只输出给定的内容。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-03-04T21:54:12.137

在这种情况下，我总是从 Ruby Core 文档开始，在本例中是[IO](http://www.ruby-doc.org/core/classes/IO.html)类。

```
ios.puts(obj, ...) => nil 
```

> 将给定对象写入 ios 与`IO#print`. 在尚未以换行序列结尾的任何内容之后写入记录分隔符（通常是换行符）。如果使用数组参数调用，则将每个元素写入新行。如果不带参数调用，则输出单个记录分隔符。

```
ios.write(string) => integer 
```

> 将给定的字符串写入 ios。必须打开流以进行写入。如果参数不是字符串，它将使用 转换为字符串`to_s`。返回写入的字节数。

# http - http get请求中的多个参数

> ID：612259
> 
> 赞同：7
> 
> 时间：2009-03-04T20:20:59.443
> 
> 标签：http, query-string, uri

[http://asdf.com/something.do?param1=true?param2=false](http://asdf.com/something.do?param1=true?param2=false)形式的网址是否有效？

我不认为是第二个？在有效的 url 中是允许的，它应该是一个 & 符号，但我在 http 1.1 rfc 中找不到任何关于这个的东西。有任何想法吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-04T20:22:53.217

使用无效？再次。? 应该指明参数列表的开始。& 应该分隔参数。

来自[RFC 3986](http://www.ietf.org/rfc/rfc3986.txt)：

> ```
> URI = scheme ":" hier-part [ "?" query ] [ "#" fragment ] 
> ```

来自[RFC 1738](http://www.ietf.org/rfc/rfc1738.txt)：

> HTTP URL 采用以下形式：
> 
> ```
> http:// <host> : <port> / <path> ? <searchpart> 
> ```
> 
> 其中`<host>`和`<port>`在第 3.1 节中描述。如果`:<port>` 省略，则端口默认为 80。不允许使用用户名或密码。 `<path>`是一个 HTTP 选择器，`<searchpart>`是一个查询字符串。`<path>`是可选的，和`<searchpart>`它前面的“？”一样。如果两者`<path>`都不`<searchpart>`存在，“/”也可以省略。
> 
> 在`<path>`and`<searchpart>`组件中，“/”、“;”、“?” 被保留。在 HTTP 中可以使用“/”字符来指定层次结构。

此处描述了[搜索部分/查询部分](http://www.w3.org/TR/html401/interact/forms.html#h-17.13.4.1)。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-04T20:22:23.187

使用 & 表示第二个和第三个

即 [http://asdf.com/something.do?param1=true¶m2=false](http://asdf.com/something.do?param1=true&param2=false)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-04T20:26:43.720

> **应用程序/x-www-form-urlencoded**
> 
> 这是默认的内容类型。使用此内容类型提交的表单必须编码如下：
> 
> 1.  控件名称和值被转义。空格字符被替换为`+`，然后保留字符被转义，如 [RFC1738] 第 2.2 节所述：非字母数字字符被替换为`%HH`、一个百分号和两个表示字符 ASCII 代码的十六进制数字。换行符表示为“CR LF”对（即`%0D%0A`）。
> 2.  控件名称/值按照它们在文档中出现的顺序列出。名称与值之间由 分隔`=`，名称/值对之间由 分隔`&`。
> 
> —[应用程序/x-www-form-urlencoded](http://www.w3.org/TR/html401/interact/forms.html#didx-applicationx-www-form-urlencoded)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-04T20:42:33.090

如前所述，再次使用它是无效的。但是，如果您有 ? 字符作为参数值的一部分，您可以将其编码为 %63（就像被编码为 %20 的空格字符一样）。

# .net - 需要鼠标滚轮滚动用户控件

> ID：612270
> 
> 赞同：3
> 
> 时间：2009-03-04T20:23:05.477
> 
> 标签：.net, vb.net, winforms, user-interface, .net-2.0

我有一个我创建的用户控件。我在其右侧添加了一个面板和一个垂直滚动条。我希望能够用鼠标滚轮滚动它。问题是似乎没有在鼠标滚轮上触发的任何事件。如果我关闭面板，则用户控件具有焦点，它将在表单中的鼠标滚轮上触发。但是在面板上它似乎不会触发面板的鼠标滚轮事件，或者控件内的用户控件，甚至是窗体上的。最好的解决方案是在用户控件中触发事件，但我什至会接受表单上的事件并将其反馈回用户控件。

如果重要的话，我正在使用 vb.net 和 vs2005。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-04T22:23:53.673

是的，面板可以有焦点。你只需要给它焦点，我更喜欢在鼠标悬停时使用。

我这样做了，它的问题解决了。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-04T20:54:32.843

*   创建一个新的 VB.NET Winforms 项目
*   在窗体上放置一个 Panel 控件
*   将面板的“AutoScroll”属性设置为“true”
*   将以下代码放在表单的加载事件中

    ```
    For i As Integer = 1 To 100
        Dim b As New Button()
        b.Text = i.ToString()
        b.Size = New Size(60, 40)
        b.Location = New Point(0, (i * b.Height) - b.Height)
        b.Parent = Panel1
        Panel1.Controls.Add(b)
    Next 
    ```

运行项目。

您应该会在 Panel 控件中看到一个包含 100 个按钮的表单。
Panel 控件应包含一个垂直的 ScrollBar。
使用面板内的滚轮应滚动浏览按钮。

希望这个例子有所帮助。

**编辑**

> > 我在其右侧添加了一个面板和一个垂直滚动条。

这不是正确的做法。
您需要使用`AutoScroll`Panel 的属性。

**编辑**
另一个示例：

*   创建一个新的 VB.NET 项目
*   在表单上放置两个按钮
*   创建一个新的用户控件
*   将 usercontrol 的 autoscroll 属性设置为 true
*   将以下代码粘贴到表单加载事件中

    ```
    Dim uc As New UserControl1
    uc.Parent = Me
    Me.Controls.Add(uc)
    uc.Size = New Size(100, 100)
    uc.Location = New Point(0, 0)
    For i As Integer = 1 To 100
        Dim b As New Button()
        b.Text = i.ToString()
        b.Size = New Size(60, 40)
        b.Location = New Point(0, (i * b.Height) - b.Height)
        b.Parent = uc
        uc.Controls.Add(b)
    Next 
    ```

运行程序。

单击按钮（在窗体上）。
请注意，您必须单击 UserControl 以设置其焦点并使用滚轮。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-04T22:21:01.840

我一直在研究这个问题，我可能已经弄清楚了。鼠标滚轮事件仅发送到具有焦点的控件。面板不能有焦点。由于面板覆盖了用户控件，因此也无法获得焦点。（除非它是窗体上的唯一控件）如果在面板 mouseenter 事件上我调用 me.focus 它将焦点设置到用户控件，允许它接收鼠标滚轮事件。该事件在窗体和控件中触发。如果有更好的方法，我仍然愿意接受建议，因为这似乎有点 hacky。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-04T20:49:44.587

[这](http://www.devasp.net/net/articles/display/337.html)是一篇关于在 vb.net 中处理鼠标事件的文章。它特别提到了鼠标滚动。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-12-05T00:45:57.207

您还可以添加以下代码行：

```
 private void UserControl1_Scroll(object sender, ScrollEventArgs e)
    {
        System.Diagnostics.Debug.WriteLine(System.DateTime.Now.ToString("hh:mm:ss") + " Scrolling inside" + e.NewValue + " <- " + e.OldValue);
        this.VerticalScroll.Value = e.NewValue;
    } 
```

这允许您在上下移动滚动条时查看控件中的项目。没有它，控件仅在滚动条被释放时滚动。

# php - 如何在 Windows Vista 上配置 PHP 的邮件功能？

> ID：612277
> 
> 赞同：2
> 
> 时间：2009-03-04T20:24:15.240
> 
> 标签：php, email

我正在自己的网站上工作。

我计划有一个邮件功能来向想要加入我的网站的用户发送通知。

问题是 PHP 的邮件功能对我不起作用。

谁能帮我这个？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-04T20:53:27.400

如果您在 Windows 平台上，您可以尝试：

> [windows 下的假 sendmail](http://glob.com.au/sendmail/)

我假设您没有运行自己的邮件服务器并且不想安装一个。您要做的就是使用 PHP 向或通过（中继）您的 ISP 邮件服务器发送电子邮件，以测试您自己的脚本或测试第三方脚本。

有了 Fake Sendmail，我们需要编辑 php.ini 文件，以便 PHP 的邮件功能可以使用它：

> 打开位于文件夹 C:\php 中的文件 php.ini 搜索此部分 [邮件功能]（从第 612 行开始）

```
sendmail_path = "/usr/local/sendmail/sendmail.exe -t" 
```

欲了解更多信息，请访问： [http ://wiki.uniformserver.com/index.php/Installing_Fake_Sendmail_for_Windows](http://wiki.uniformserver.com/index.php/Installing_Fake_Sendmail_for_Windows)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-04T20:46:36.573

修改应用程序的 php.ini，使其指向 [mail function] 部分中的 smtp 服务器。您需要设置的选项在这里描述：http: [//www.w3schools.com/PHP/php_ref_mail.asp](http://www.w3schools.com/PHP/php_ref_mail.asp)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-04T20:41:40.080

在这种情况下，我会说，如果[邮件文档](http://ca.php.net/manual/en/function.mail.php)没有回答您的问题，那么这就是您用作服务器的任何配置问题。

如果这是您的桌面，您的邮件也可能看起来像垃圾邮件。

# c# - 如何将字节 [] 缓冲区复合到列表中 ?

> ID：612283
> 
> 赞同：1
> 
> 时间：2009-03-04T20:26:16.857
> 
> 标签：c#, .net, networking

因此，我使用大小为 1024 的缓冲区 (byte[]) 通过套接字接收数据，并且我想将读取的内容组合在一起以形成整个数据包，以防它们大于 1024 字节。我选择了一个 List 来存储整个数据包，我想要做的是在每个缓冲区读取时添加它。我想做：

```
List.AddRange(Buffer); 
```

但是，如果缓冲区未满，则会将一堆空字节填充到最后。所以很自然我想做的就是只向列表中添加一定范围的字节，但是没有这样的方法。我总是可以创建一个与接收到的字节数完全相同的临时字节数组，然后使用 AddRange() 并获得我想要的结果，但这对我来说似乎很愚蠢。更不用说它会在每次读取数据时创建然后丢弃一个数组，这不利于可扩展多用户服务器的性能。

有没有办法用列表做到这一点？或者我可以使用其他一些数据结构吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-04T20:32:33.643

如果您使用的是 C# 3.5 (LINQ)

```
list.AddRange(buffer.Take(count)); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-04T20:58:16.733

你*真的*需要结果是 a`List<byte>`吗？之后你打算用它做什么？如果你*真的*只需要一个`IEnumerable<byte>`我建议创建这样的东西：

```
using System;
using System.Collections;
using System.Collections.Generic;

public class ArraySegmentConcatenator<T> : IEnumerable<T>
{
    private readonly List<ArraySegment<T>> segments =
        new List<ArraySegment<T>>();

    public IEnumerator<T> GetEnumerator()
    {
        foreach (ArraySegment<T> segment in segments)
        {
            for (int i=0; i < segment.Count; i++)
            {
                yield return segment.Array[i+segment.Offset];
            }
        }
    }

    public void Add(ArraySegment<T> segment)
    {
        segments.Add(segment);
    }

    public void Add(T[] array)
    {
        segments.Add(new ArraySegment<T>(array));
    }

    public void Add(T[] array, int count)
    {
        segments.Add(new ArraySegment<T>(array, 0, count));
    }

    public void Add(T[] array, int offset, int count)
    {
        segments.Add(new ArraySegment<T>(array, offset, count));
    }

    IEnumerator IEnumerable.GetEnumerator()
    {
        return GetEnumerator();
    }
} 
```

然后你可以每次都添加相关的段。当然，您最终可能会浪费大量内存，并且每次都必须小心创建一个新缓冲区（而不是再次读取原始缓冲区），但它在其他方面会很有效。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-04T20:30:28.033

对于 .Net3.5，您可以使用`.Take()`扩展方法仅返回您收到的实际字节数。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-04T20:30:04.290

我不知道您使用的是什么协议，或者您是否正在实现自定义协议，但如果您确定了可以`Buffer.BlockCopy`用来直接将字节复制到新数组以添加到列表中的大小。

当你没有细节时，很难更简洁。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-04T20:31:55.143

您可以实现自己的 IEnumerable 实现，它只从数组中检索您想要的字节。然后你可以这样做：

List.AddRange(new BufferEnumerator(Buffer));

# 编辑

您还可以查看：

新 System.ArraySegment（缓冲区，0，numBytesRecieved）

我不肯定 ArraySegment 是否会起作用我记得读过它的一些缺点，但不记得具体细节。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-04T20:36:19.283

您可以使用 Array.Copy() 并仅使用数组来构建目标缓冲区：

```
byte[] recvBuffer = new byte[1024];
byte[] message = new byte[0];
int nReaded;

while ((nReaded = ....Read(recvBuffer, 1024) > 0)
{
  byte[] tmp = new byte[message.Length + nReaded];
  Buffer.BlockCopy(message, 0, tmp, 0, message.Length);
  Buffer.BlockCopy(recvBuffer, 0, tmp, message.Length, nReaded);
  message = tmp;
} 
```

**编辑：**将 Array.Copy() 替换为 Buffer.BlockCopy() 就像 Quintin Robinson 在评论中所建议的那样。

# sql - 您学习 LINQ to SQL 花了多长时间？

> ID：612288
> 
> 赞同：2
> 
> 时间：2009-03-04T20:27:16.887
> 
> 标签：sql, linq-to-sql

我之前没有看到任何问题，所以这里是：

一旦您做出（或曾经）决定开始使用 LINQ to SQL，您需要多长时间才能了解它的来龙去脉？

我们正在考虑在我的组织中使用它，但我的上级担心初始时间成本（学习它）。小时将是最有用的答案，但任何见解都会受到赞赏。

额外问题：自从您开始使用 LINQ 以来，它为您节省了多少时间？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-04T20:43:34.833

你可以在下班回来的地铁里学习 LINQ to SQL :)。说真的，学习它真的不需要任何时间（最多 1-2 天），它会为你节省很多时间！

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-04T20:32:46.733

我没有任何具体的衡量标准，但我可以肯定地说，在我使用它的第一个项目中，它在前 2 周的 sprint 中为我节省的时间比我花在学习上的时间要多。

附言。你会发现一个陷阱，就像你使用的任何方法一样，只要远离没有钥匙的桌子:)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-04T20:39:23.923

我只花了大约 8-10 天就为使用 LINQ 的客户完成了一个生产网站，以前从未使用过它。我猜不超过 50% 的时间花在学习 linq 上。

现在我觉得它无论如何都不能让我有资格成为专家，但是获得生产力是非常快速和轻松的。

然而，在学习了它之后，我不太可能在未来的项目中再次选择它——而是坚持使用我自己的 CRUD 类、存储过程和访问数据的 SQLDataReader 方法。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-04T20:49:45.227

我可能已经把它弄乱了几个星期，而且我对它说我已经“学会”了它还不够舒服。我不相信它对我有好处，但我对 SQL 非常了解，而且这花了很长时间。我认为从长远来看 SQL 解决方案会更快地提供更好的解决方案，但 LINQ 可能会为您节省一些时间投资。

它还没有为我节省任何时间，但是我想出一个快速的 SQL 解决方案并不困难。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-04T21:10:35.237

学习 LINQ to SQL 的基础知识完全不需要时间，现在学习处理 DBML 设计器的缺点和 LINQ to SQL 本身的一些怪癖几乎是一个持续的过程。我会说它的好处大大超过了它的不足之处。

就它节省的时间而言，就像任何 ORM 一样，它节省了相当多的时间，我不能确切地说出多少，但与必须使用 IBatis 设计模型和对象相比，这是相当多的时间。
您可能还想考虑实体框架。

# sharepoint - 为什么单击“查看所有站点内容”会产生错误？

> ID：612289
> 
> 赞同：1
> 
> 时间：2009-03-04T20:28:09.317
> 
> 标签：sharepoint, moss, wss

我有一个 SharePoint 网站，单击“查看所有网站内容”会生成此错误：

> URL '/sites/foo/bar' 无效。它可能引用不存在的文件或文件夹，或者引用不在当前 Web 中的有效文件或文件夹。

有任何想法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-04T23:50:15.650

可能是该站点的未发布系统母版页存在问题。尝试查看[http://[yoursitecollection]/_catalogs/masterpage/Forms/AllItems.aspx](http://[yoursitecollection]/_catalogs/masterpage/Forms/AllItems.aspx)以查看是否存在问题。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-04T20:35:38.270

嗯，也许您可​​以检查是否有任何 Web 部件导致问题。

只需在 URL 末尾添加**?contents=1即可进入当前页面的 Web 部件维护模式。**

这是一个长远的目标，但使用 SharePoint，您永远不知道 :)

# linq-to-entities - 使用关联创建新的 LINQ to Entities 对象

> ID：612298
> 
> 赞同：1
> 
> 时间：2009-03-04T20:31:17.923
> 
> 标签：linq-to-entities

我试图弄清楚如何使用 LINQ to Entities 将新记录添加到具有另一个表的外键的表中。我将尝试解释：

假设我有一个带有两个表的简单数据库。例如，让我们调用一个 LibraryItem 和另一个 LibraryItemStatus。LibaryItem 具有指向 LibraryItemStatus 表的外键，因此可以为项目分配状态。

我的问题是如何使用 LINQ To Entities 创建新的 LibraryItem 并将其与状态相关联？我下面的代码一定是错误的，但我找不到任何帮助的例子。

```
LibraryEntities entities = new LibraryEntities();

LibraryItem item = new LibraryItem();
item.Name = "some name";
item.SomeAttribute = "x";
// What do I do here?
// This seems wrong as I don't want a new status.
item.Status = new Status() { id = 1 };
// This seems wrong as I don't really want to have to query the repository
item.Status = entities.Status.First(s => s.StatusID == 1);
// 
entities.AddToItems(item);
entities.Savechanges(); 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-04T20:36:34.430

检查 item.StatusReference 属性。这允许在没有实际查询的情况下发现/设置关系上的元数据。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-04T20:50:26.003

这是“正确”的方式：

```
item.Status = entities.Status.First(s => s.StatusID == 1); 
```

或者：

```
item.Status = entities.GetObjectByKey(new EntityKey("MyContext.Status", "StatusID", 1)); 
```

...如果对象已经加载，它将从内存中加载（entities.Status.First 将始终查询数据库）。

这是“hacky但更快的方式”：

```
item.StatusReference.EntityKey = new EntityKey("MyContext.Status", "StatusID", 1); 
```

好：从来没有任何查询。坏：你不能引用 item.Status; 它仍然是空的。

**更新**：[在 .NET 4.0 中会有更好的方法来做到这一点。](http://blogs.msdn.com/efdesign/archive/2009/03/16/foreign-keys-in-the-entity-framework.aspx "实体框架中的外键")

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-17T09:27:14.630

您还可以将相关表映射到实体模型中的 ItemEntity。

我已经为 ProductName 中的 Product-> ProductLanguage 在下面的 url 上发布的我的项目中完成了该操作。

[openticket.codeplex.com](http://openticket.codeplex.com)

# database-design - 是否值得将枚举值规范化到一个新表中？

> ID：612316
> 
> 赞同：2
> 
> 时间：2009-03-04T20:36:49.703
> 
> 标签：database-design

在使用数据库设计软件时，是否值得将枚举规范化为单独的表？

例如，如果我有课：

```
public class Alert
{
    public int ID
    public System.DayOfWeek AlertDay;
    public string Message;
} 
```

我相应的警报表是否应该简单地类似于：

```
CREATE TABLE Alert
(
    ID INT IDENTITY,
    AlertDay INT,
    Message VARCHAR(50)
) 
```

或者我应该将星期几标准化为一个单独的表并将 FK 关系添加到我的 Alert 表中？

这种设计决策是否有经验法则？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-04T20:39:36.467

我不。但是尽量保持字符串 Message 尽可能短，并在非规范化表上使用索引。

看看[Enum Fields VS Varchar VS Int + Joined table：什么是更快？](http://www.mysqlperformanceblog.com/2008/01/24/enum-fields-vs-varchar-vs-int-joined-table-what-is-faster/)来自 MySQL 性能博客。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-04T20:43:10.950

如果它像关于星期几的信息一样**恒定**，我只需在代码中定义一个枚举并将整数存储在数据库中。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-04T20:44:51.913

通常不会。一周中的日子不太可能改变，并且您不希望必须执行不必要的联接。

另一方面，您确实要确保“星期几”的来源是一致的并且不会改变（例如本地化、大写、缩写等）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-04T21:07:32.843

是否会直接从数据库访问数据而不通过您的对象？如果是这样，那么我会推荐一个查找表，或者任何按星期几编写报告的人在必须编写案例语句来显示星期几的文本值或当他们犯了转换错误时可能会有点恼火使用系统函数 int 到星期几，并发现他们服务器上的 startOfWeek 设置与您硬编码到对象中的设置不同。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-04-18T18:08:20.007

或者，您可以存储 DateTime 并让应用程序确定星期几。许多语言都有执行此操作的内置方法。

# windows - 完全从头开始编写 COM 对象？

> ID：612317
> 
> 赞同：14
> 
> 时间：2009-03-04T20:37:39.607
> 
> 标签：windows, winapi, com

我刚刚开始了一项涉及大量 COM 编程的新工作。到目前为止，通过继续我作为开发人员的旅程中学到的 COM 基础知识，我做得很好，但我是那种需要了解一切的人。整天和 COM 一起工作让我很烦，因为我不知道这些东西是如何工作的。

是否有从头开始创建基本 COM 对象的简单步骤？我的意思是一切。没有 Visual Studio，没有 ATL。只有编译器和记事本。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-03-04T20:42:04.370

你应该从 CodeProject 阅读这篇文章：

*   [普通 C 中的 COM](http://www.codeproject.com/KB/COM/com_in_c1.aspx)
*   [普通 C 中的 COM，第 2 部分](http://www.codeproject.com/KB/COM/com_in_c2.aspx)
*   [普通 C 中的 COM，第 3 部分](http://www.codeproject.com/KB/COM/com_in_c3.aspx)
*   [普通 C 中的 COM，第 4 部分](http://www.codeproject.com/KB/COM/com_in__c4.aspx)
*   [普通 C 语言中的 COM，第 5 部分](http://www.codeproject.com/KB/COM/com_in_c5.aspx)
*   [普通 C 中的 COM，第 6 部分](http://www.codeproject.com/KB/COM/com_in_c6.aspx)
*   [普通 C 中的 COM，第 7 部分](http://www.codeproject.com/KB/COM/com_in_c7.aspx)
*   [普通 C 中的 COM，第 8 部分](http://www.codeproject.com/KB/COM/com_in_c8.aspx)

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-04T20:44:09.637

如果你能拿到[Inside COM](https://rads.stackoverflow.com/amzn/click/com/1572313498)的副本，它应该会让你开心。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-05T00:17:29.657

在从 Dale Rogerson 的 Inside COM 中获得 COM 的基本概念之后，我还建议您阅读 Don Box 的 Essential COM。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-05T01:59:48.117

如果你能忍受，我会建议[Inside OLE2](https://rads.stackoverflow.com/amzn/click/com/1556156189)。这是一本冗长乏味的大书，详细介绍了 COM 的工作原理。我把这本书读了好几遍，每一次都有更深的理解。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-10-10T17:06:39.747

要考虑的另一本书是[Effective COM](http://www.amazon.co.uk/Effective-COM-MTS-based-Applications-Technology/dp/0201379686/ref=sr_1_1?ie=UTF8&qid=1286730295&sr=8-1)。这不是一本初学者的书，但真的非常好。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-10-13T06:11:27.127

我发现 Apple 的[mDNSResponder](http://www.google.com/codesearch/p?hl=nl#pFm0LxzAWvs/darwinsource/tarballs/other/mDNSResponder-107.6.tar.gz%7C2T8Gi0rIVtE/mDNSResponder-107.6/Clients/ExplorerPlugin/ExplorerBar.h&d=7)实现是一个有用的示例。

# algorithm - 解决有序列表中的模糊类别

> ID：612321
> 
> 赞同：3
> 
> 时间：2009-03-04T20:39:15.000
> 
> 标签：algorithm, math, function

让我们举一个具体的例子，希望我能清楚。假设月份的（有序）列表：

> 一月 < 二月 < 三月 < ... < 十二月

（代表月份的整数，从零开始），这样

> 一月是 0，二月是 1，...，十二月是 11。

现在假设我无法访问月份的全名，并得到以下列表，其中月份已缩短为首字母，*e*代表空类别，如下所示：

> e, f, e, e, e

如果我建立一个“明确的月份”列表（f：1，s：8，o：9，n：10，d：11），我可以通过首先计算第一个类别（使用减法和mod 12），然后从那里写下其余部分。但是，假设我得到了清单

> e, A, e, e, J, e

然后我可以（直观地）计算出虽然*A*是模棱两可的（可能是四月或八月），但在这种情况下它只能是四月，因为八月在 2 个类别之后没有任何*J*跟随它。一旦找到这个，我就可以再次从头计算一切。

最后，我的问题是：这个问题是否有解析解决方案（函数、算法），还是我唯一希望使用蛮力来定义每个潜在关系？对于一些例子，没有消歧算法/函数可以工作：考虑我有一个*J*后跟 11 *e*的情况，然后是一个*J*后跟 11 *e*的情况......因为中间有一年，我不能将*J*消歧为一月、六月或七月。

**答案**：我最终编写了 Il-Bhima 的答案，因为特别是对于这种情况，正则表达式是可以的，即使在更高的运行时间 O(mn) 时也是如此。但是，我接受了 Ben 的答案作为正确答案，因为它包含了其他答案（提到了正则表达式解决方案），但也提出了使用 KMP 算法 O(m+n) 的更好方法，尽管这是针对更大数量的字符串匹配模式。谢谢大家。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-04T20:49:49.453

我不确定这是否正是您要查找的内容，但您可以使用修改后的[KMP 字符串搜索算法](http://en.wikipedia.org/wiki/Knuth-Morris-Pratt_algorithm)来解决此问题。

修改将匹配任何内容与空类别。它甚至可以为您找到所有可能的值，例如您提到的带有 11 e 的 J。

您还可以使用[有限状态机](http://en.wikipedia.org/wiki/Finite_state_machine)来确定可能性，这就是[正则表达式](http://en.wikipedia.org/wiki/Regular_expression)的作用。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-05T09:39:03.037

最简单的方法是使用正则表达式。假设您要匹配`e, A, e, e, J, e`.

构造以下正则表达式：`r = ".A..J."`

让`c`我们的控制字符串：

```
 c = "JFMAMJJASONDJFMAMJJASOND" 
```

`r`现在我们在字符串中搜索所有匹配项，`c`其中匹配项的起始索引在`c`.

一般来说，这可能不是最有效的方法。最幼稚的解决方案是尝试将模式与控制字符串的每个循环移位及时匹配，其中是模式的长度，是控制字符串的`"JFMAMJJASOND"`长度（在我们的例子中）。`O(nm)``n``m``JFMAMJJASOND`

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-05T15:24:48.573

对于一般情况，我们可以在 Il-Bhima 的回答的基础上建立一点。首先，我们认识到唯一真正模棱两可的 A、M 或 J 对是两个相隔六个月的 J 或两个相隔一年的相同字母。任何其他组合都将在控制字符串中产生明确的匹配。（我建立了一个所有可能组合的表格来证明这一点。）

因此，整个起始列表中您只需要两个月，其距离 mod 12 不是 0 或 6。然后您可以构建一个小的正则表达式来匹配控制字符串。或者，您可以构建一个查找表，其中包含有序对和月份之间的距离。

# asp.net-mvc - 在调用特定控制器方法之前返回 MVC ActionResult

> ID：612326
> 
> 赞同：1
> 
> 时间：2009-03-04T20:40:30.897
> 
> 标签：asp.net-mvc

我有一个基本控制器类，我的其他控制器从该类继承

```
public abstract class BaseController : Controller
{
    protected override void Initialize(System.Web.Routing.RequestContext requestContext)
    {
        base.Initialize(requestContext);
        ...
    }
} 
```

在初始化期间，我正在做一些设置，在某些情况下，我想缩短执行，直接跳转到 ActionResult 的返回，完全跳过实际 Action 方法的执行。沿着这些思路

```
protected override void Initialize(System.Web.Routing.RequestContext requestContext)
{
    base.Initialize(requestContext);
    if(specialCase)
    {
        ViewData[...] = specialCaseInformation;
        return View("~/Shared/SpecialCase.aspx");
    }   
} 
```

目的是跳过将要调用的任何 ActionResult 方法，并将其替换为我的全局特殊情况页面。但我不认为 Initialize 是为此而生的。

我*认为*我需要做的是创建一个单独的 ActionFilterAttribute 类，覆盖 OnActionExecuting 方法，如果出现 specialCase，构造一个 ViewResult 对象并将其分配给 filterContext.Result 属性。

我是否朝着正确的方向前进，还是应该以不同的方式做这件事？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-04T20:44:05.707

是的，ActionFilterAttribute 正是正确的方法。以 HandleErrorAttribute.cs 为例。

正如您所说，初始化不是正确的方法。

# c++ - C++中'struct'和'typedef struct'的区别？

> ID：612328
> 
> 赞同：906
> 
> 时间：2009-03-04T20:41:12.047
> 
> 标签：c++, struct, typedef

在**C++**中，有什么区别：

```
struct Foo { ... }; 
```

和：

```
typedef struct { ... } Foo; 
```

* * *

## 回答 #1

> 赞同：1297
> 
> 时间：2009-03-04T20:45:36.950

在 C++ 中，只有细微的差别。它是 C 的保留，在其中有所作为。

C 语言标准（[C89 §3.1.2.3](http://port70.net/~nsz/c/c89/c89-draft.txt)、[C99 §6.2.3](http://port70.net/~nsz/c/c99/n1256.html#6.2.3)和[C11 §6.2.3](http://port70.net/~nsz/c/c11/n1570.html#6.2.3)）要求为不同类别的标识符使用单独的命名空间，包括*标签标识符*（for `struct`/ `union`/ `enum`）和*普通标识符*（for`typedef`和其他标识符） .

如果你只是说：

```
struct Foo { ... };
Foo x; 
```

你会得到一个编译器错误，因为`Foo`只在标签命名空间中定义。

您必须将其声明为：

```
struct Foo x; 
```

任何时候你想引用 a `Foo`，你总是不得不称它为 a `struct Foo`。这很快就会很烦人，所以你可以添加一个`typedef`：

```
struct Foo { ... };
typedef struct Foo Foo; 
```

现在`struct Foo`（在标签命名空间中）和普通`Foo`（在普通标识符命名空间中）都指的是同一个东西，你可以自由地声明`Foo`没有`struct`关键字的类型对象。

* * *

构造：

```
typedef struct Foo { ... } Foo; 
```

只是声明和的缩写`typedef`。

* * *

最后，

```
typedef struct { ... } Foo; 
```

声明一个匿名结构并`typedef`为其创建一个。因此，使用此构造，它在标记命名空间中没有名称，只有 typedef 命名空间中的名称。这意味着它也不能被前向声明。 *如果要进行前向声明，则必须在标签命名空间中为其命名*。

* * *

在 C++ 中，所有///声明`struct`的行为就像它们被隐式'ed，只要名称没有被另一个具有相同名称的声明隐藏。有关详细信息，请参阅[Michael Burr 的答案](https://stackoverflow.com/questions/612328/difference-between-struct-and-typedef-struct-in-c/612476#612476)。`union``enum``class``typedef`

* * *

## 回答 #2

> 赞同：238
> 
> 时间：2009-03-04T21:19:37.243

在[这篇 DDJ 文章中](http://drdobbs.com/article/print?articleId=184403396)，Dan Saks 解释了一个小区域，如果您不键入定义您的结构（和类！），错误可能会蔓延：

> 如果你愿意，你可以想象 C++ 为每个标签名生成一个 typedef，比如
> 
> ```
> typedef class string string; 
> ```
> 
> 不幸的是，这并不完全准确。我希望它是那么简单，但事实并非如此。如果不引入与 C 的不兼容性，C++ 无法为结构、联合或枚举生成此类类型定义。
> 
> 例如，假设一个 C 程序同时声明了一个函数和一个名为 status 的结构：
> 
> ```
> int status(); struct status; 
> ```
> 
> 同样，这可能是不好的做法，但它是 C。在这个程序中，状态（本身）指的是函数；结构状态是指类型。
> 
> 如果 C++ 确实为标签自动生成 typedef，那么当您将此程序编译为 C++ 时，编译器将生成：
> 
> ```
> typedef struct status status; 
> ```
> 
> 不幸的是，这个类型名会与函数名冲突，程序无法编译。这就是为什么 C++ 不能简单地为每个标签生成一个 typedef。
> 
> 在 C++ 中，标签的作用与 typedef 名称类似，只是程序可以声明与标签具有相同名称和相同范围的对象、函数或枚举数。在这种情况下，对象、函数或枚举器名称会隐藏标签名称。程序只能通过在标签名称前使用关键字 class、struct、union 或 enum（视情况而定）来引用标签名称。由这些关键字之一和标签组成的类型名称是详细类型说明符。例如，struct status 和 enum month 是详细的类型说明符。
> 
> 因此，一个包含两者的 C 程序：
> 
> ```
> int status(); struct status; 
> ```
> 
> 编译为 C++ 时的行为相同。名称状态仅指功能。程序只能通过使用详细类型说明符结构状态来引用类型。
> 
> 那么这如何让错误潜入程序中呢？考虑 [清单 1](http://drdobbs.com/cpp/184403396?pgno=1)中的程序。该程序定义了一个带有默认构造函数的类 foo，以及一个将 foo 对象转换为 char const * 的转换运算符。表达方式
> 
> ```
> p = foo(); 
> ```
> 
> in main 应该构造一个 foo 对象并应用转换运算符。随后的输出语句
> 
> ```
> cout << p << '\n'; 
> ```
> 
> 应该显示类 foo，但它没有。它显示函数 foo。
> 
> [之所以会出现这个令人惊讶的结果，是因为该程序包含了清单 2](http://drdobbs.com/cpp/184403396?pgno=2)中所示的头文件 lib.h。这个头文件定义了一个也叫 foo 的函数。函数名 foo 隐藏了类名 foo，所以 main 中对 foo 的引用指的是函数，而不是类。main 只能通过使用详细类型说明符来引用该类，如
> 
> ```
> p = class foo(); 
> ```
> 
> 在整个程序中避免这种混淆的方法是为类名 foo 添加以下 typedef：
> 
> ```
> typedef class foo foo; 
> ```
> 
> 紧接在类定义之前或之后。此 typedef 导致类型名称 foo 和函数名称 foo （来自库）之间的冲突，这将触发编译时错误。
> 
> 我知道没有人会理所当然地实际编写这些 typedef。它需要大量的纪律。由于诸如[清单 1](http://drdobbs.com/cpp/184403396?pgno=1)中的错误的发生率可能非常小，因此很多人都不会遇到这个问题。但是，如果您的软件中的错误可能会导致人身伤害，那么无论错误多么不可能，您都应该编写 typedef。
> 
> 我无法想象为什么有人会想要在与类相同的范围内隐藏具有函数或对象名称的类名称。C 中的隐藏规则是一个错误，它们不应该扩展到 C++ 中的类。确实，您可以纠正错误，但它需要额外的编程纪律和不必要的努力。

* * *

## 回答 #3

> 赞同：66
> 
> 时间：2009-03-04T20:54:25.153

还有一个重要的区别：`typedef`s 不能被前向声明。因此，对于该`typedef`选项，您必须`#include`包含包含 的文件`typedef`，这意味着`#include`您的所有内容`.h`也包括该文件，无论它是否直接需要它，依此类推。它肯定会影响您在大型项目上的构建时间。

如果没有`typedef`，在某些情况下，您只需在文件`struct Foo;`顶部添加前向声明`.h`，并且仅`#include`在文件中添加结构定义`.cpp`。

* * *

## 回答 #4

> 赞同：33
> 
> 时间：2009-03-04T20:49:16.943

有**区别**，但很微妙。这样看：`struct Foo`引入了一种新类型。第二个为未命名的类型创建一个名为 Foo 的别名（而不是新类型）`struct`。

> **7.1.3 typedef 说明符**
> 
> 1 [...]
> 
> 使用 typedef 说明符声明的名称成为 typedef-name。在其声明的范围内，typedef-name 在语法上等价于关键字，并以第 8 节中描述的方式命名与标识符关联的类型。因此 typedef-name 是另一种类型的同义词。typedef-name***不会像***类声明 (9.1) 或枚举声明那样引入新类型。
> 
> 8 如果 typedef 声明定义了一个未命名的类（或枚举），则声明为该类类型（或枚举类型）的第一个 typedef 名称仅用于表示类类型（或枚举类型），仅用于链接目的3.5)。[ 例子：

```
typedef struct { } *ps, S; // S is the class name for linkage purposes 
```

因此，typedef**始终**用作另一种类型的占位符/同义词。

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2013-08-05T09:18:39.607

您不能将前向声明与 typedef 结构一起使用。

结构本身是一种匿名类型，因此您没有要转发声明的实际名称。

```
typedef struct{
    int one;
    int two;
}myStruct; 
```

像这样的前向声明不起作用：

```
struct myStruct; //forward declaration fails

void blah(myStruct* pStruct);

//error C2371: 'myStruct' : redefinition; different basic types 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2016-04-11T13:26:25.633

'typedef struct' 和 C++ 中的'struct' 之间的一个重要区别是'typedef structs' 中的内联成员初始化将不起作用。

```
// the 'x' in this struct will NOT be initialised to zero
typedef struct { int x = 0; } Foo;

// the 'x' in this struct WILL be initialised to zero
struct Foo { int x = 0; }; 
```

* * *

## 回答 #7

> 赞同：-3
> 
> 时间：2009-03-04T20:44:20.310

C++ 没有区别，但我相信在 C 中，它允许您声明 struct Foo 的实例而无需显式执行：

```
struct Foo bar; 
```

* * *

## 回答 #8

> 赞同：-5
> 
> 时间：2017-04-08T03:06:14.860

struct 是创建一个数据类型。typedef 是为一个数据类型设置一个昵称。

# sql - 为什么这个 mysql 查询会给我垃圾结果？

> ID：612335
> 
> 赞同：0
> 
> 时间：2009-03-04T20:42:28.050
> 
> 标签：sql, mysql

我试图获取用户拥有的总积分，以及当月的积分。当用户获得积分时，它会使用时间戳登录到积分表中。总计忽略时间戳，而当月的积分查找具有正确时间戳的积分（从该月的第一天开始）。

```
SELECT user_id, user_name, sum(tpoints.point_points) as total_points, sum(mpoints.point_points) as month_points
FROM users 
LEFT JOIN points tpoints
ON users.user_id = tpoints.point_userid 
LEFT JOIN points mpoints 
ON (users.user_id = mpoints.point_userid AND mpoints.point_date > '$this_month')
WHERE user_id = 1
GROUP BY user_id 
```

积分表结构

```
 CREATE TABLE IF NOT EXISTS `points` (
  `point_userid` int(11) NOT NULL,
  `point_points` int(11) NOT NULL,
  `point_date` int(11) NOT NULL,
  KEY `point_userid` (`point_userid`),
  KEY `point_date` (`point_date`)
) ENGINE=MyISAM DEFAULT CHARSET=latin1; 
```

这导致一个非常大的数字，即等于所有点的总和乘以与查询匹配的行数。

我需要在不使用子查询或多个查询的情况下实现这一点。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-04T20:52:52.707

尝试

```
SELECT user_id, user_name, sum(point_points) as total_points, sum( case when point_date > '$this_month' then point_points else 0 end ) as month_points
FROM users
    LEFT JOIN points
        ON users.user_id = points.point_userid 
WHERE user_id = 1
GROUP BY user_id, user_name 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-04T20:46:34.967

```
SELECT user_id, user_name, 
       (
       SELECT  SUM(points.point_points)
       FROM    points
       WHERE   points.point_userid = users.user_id
       ) AS total_points,
       (
       SELECT  SUM(points.point_points)
       FROM    points
       WHERE   points.point_userid = users.user_id
               AND points.point_date > '$this_month'
       ) AS month_points
FROM   users 
WHERE  user_id = 1 
```

# mysql - 在 MySQL 中使用子查询进行选择（带有 ANY 和 IN 的子查询）

> ID：612338
> 
> 赞同：2
> 
> 时间：2009-03-04T20:43:32.917
> 
> 标签：mysql, mysql-error-1242

感谢您的精彩回答！

**了解更多信息**

*   [有关 MySQL IN 比较运算符的更多信息](http://dev.mysql.com/doc/refman/5.0/en/comparison-operators.html#function_in)
*   [连接表](http://dev.mysql.com/doc/refman/5.0/en/join.html)
*   [带有 ANY、IN 和 SOME 的子查询](http://dev.mysql.com/doc/refman/5.0/en/any-in-some-subqueries.html)

* * *

这很难解释，所以让我们设置舞台......

```
userActions         userGroupMap
+------+--------+   +------+-------+
| user | action |   | user | group |
+------+--------+   +------+-------+
| x    | acted! |   | x    | a     |
| y    | acted! |   | y    | a     |
| y    | acted! |   | z    | b     |
| z    | acted! |   +------+-------+
| y    | acted! |
| z    | acted! |
| x    | acted! |
| z    | acted! |
+------+--------+ 
```

我想选择组 a 的操作。我的想法是

```
SELECT actions, user FROM userActions
    WHERE user = (SELECT user, group FROM userGroupMap WHERE group = a) 
```

但显然这个子查询返回不止一行。我应该使用 JOIN 吗？

```
Subquery returns more than 1 row 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-04T21:01:43.963

一种方法是：

```
SELECT actions,
       user
FROM   userActions
WHERE  user IN
               (SELECT user
               FROM    userGroupMap
               WHERE   [group] = 'a'
               ); 
```

但是，对于大型表，此查询往往效率低下，并且执行连接更好：

```
SELECT actions,
       userActions.user
FROM   userActions
       INNER JOIN
              (SELECT user
              FROM    userGroupMap
              WHERE   [group] = 'a'
              ) AS tmp
       ON     userActions.user = tmp.user; 
```

或者，正如 Jonathon 所提到的，你可以做到这一点，并且它几乎同样有效，如果不是更多的话：

```
SELECT actions,
       userActions.user
FROM   userActions
       INNER JOIN userGroupMap
       ON     userActions.user = userGroupMap.user
WHERE  [group] = 'a'; 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-04T20:50:24.817

```
SELECT actions, user FROM userActions
    WHERE user IN (SELECT user FROM userGroupMap WHERE group = a)

SELECT actions, user FROM userActions
    WHERE user = ANY (SELECT user FROM userGroupMap WHERE group = a) 
```

（修改：如其他人所述，仅应返回用户列。）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-04T20:51:27.123

你不能做类似的事情：

```
SELECT 
  a.actions, 
  a.user 
FROM 
  userActions a 
  INNER JOIN userGroupMap g 
    ON a.user = g.user
WHERE
  g.group = 'a' 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-04T20:56:34.397

实际上，此查询将为您提供所需的内容：

```
SELECT actions, user 
FROM userActions 
WHERE user IN 
    (SELECT user FROM userGroupMap WHERE group = 'a') 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-04T20:49:23.090

```
SELECT actions, user FROM userActions
    WHERE user = (SELECT user FROM userGroupMap WHERE group = a) 
```

当子查询应该只返回用户时，它正在返回用户和组（两个​​字段）。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-04T21:00:50.830

而不是使用连接而不是子查询：

```
SELECT
    userActions.action,
    userActions.user
FROM
    userActions
CROSS JOIN userGroupMap ON 
    userGroupMap.user = userActions.user AND
    userGroupMap.group = 'a' 
```

# asp.net - 在 asp.net 中显示来自 sql server 数据库的图像的最佳方法是什么？

> ID：612342
> 
> 赞同：4
> 
> 时间：2009-03-04T20:44:05.100
> 
> 标签：asp.net, sql-server, image, blob

我有一个返回图像字节的 sql 服务器数据库。如果我使用 tableadapter 向导并将其设置为我的存储过程和预览数据，它会拉回图像。它会自动将其转换为预览数据中的图像。我不认为它是一串 Ints 或任何东西。

如何使用 gridview 和 objectdatasource 在我的 asp.net 网页上显示它？

我已经搜索并发现图像字段可以指向另一个页面上进行字节转换的 url，但我不确定它是否是最好的。我找到了另一种创建临时文件的方法。

只是想看看最好的方法。

编辑 - 我试图不使用临时文件。如果我不能使用网格视图，则可以使用常规图像字段。

ASP.NET 2.0，C#。

感谢您的任何帮助。

编辑

最终得到：

```
 protected void Page_Load(object sender, EventArgs e)
    {
        string id = Request["id"];
        string connstr = "DSN=myserver";
        OdbcConnection conn = new OdbcConnection(connstr);
        OdbcCommand cmd = new OdbcCommand("{call mySP (?)}", conn);
        cmd.CommandType = CommandType.StoredProcedure;

        // Add the input parameter and set its properties.
        OdbcParameter parameter = new OdbcParameter();
        parameter.ParameterName = "@MyParam";
        parameter.OdbcType = OdbcType.VarChar;
        parameter.Direction = ParameterDirection.Input;
        parameter.Value = id;

        // Add the parameter to the Parameters collection. 
        cmd.Parameters.Add(parameter);
        conn.Open();
        OdbcDataReader dr = cmd.ExecuteReader();
        while (dr.Read())
        {
            byte[] buffer = (byte[])dr[0];
            Response.ContentType = "image/jpg";
            Response.BinaryWrite(buffer);
            Response.Flush();
        }
    } 
```

这在调用页面上：

```
<asp:Image ID="Image1" ImageAlign="Middle" ImageUrl="show.aspx?id=123" Runat="server" /> 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-04T20:48:04.200

两种选择：

创建一个临时文件 - 这种方法的问题是您必须创建文件，这意味着您的网站必须对目录具有写入权限，这不是一件好事。您还需要有一种方法来清理图像。

从另一个 URL 提供它 - 这是我的首选方法，因为您不需要访问磁盘。一个简单的 http 处理程序 (ashx) 是提供图像的好方法。

# 编辑

如果您需要 ashx 中的会话状态，请查看：[Asp.net System.Web.HttpContext.Current.Session null in global.asax](https://stackoverflow.com/questions/293276/asp-net-system-web-httpcontext-current-session-null-in-global-asax)。

# 编辑

结合更多的想法。在某些情况下，使用临时文件可能会更好。例如，如果很多用户经常请求您的图像。然后将图像存储在磁盘上是有意义的，因为您可以编写一次文件，这确实增加了维护复杂性，但根据流量，这可能是值得的，因为这可以让您避免回调到 .net 堆栈并利用 IIS静态内容的缓存。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-04T22:56:08.650

您添加的示例代码很好，但您应该将其移动到`.ashx`用于此类事情的文件中。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-12-01T03:21:40.977

我为[开源 ImageResizing.Net 库编写了](http://imageresizing.net)[SqlReader](http://imageresizing.net/plugins/sqlreader)插件，以允许您以最优化性能的方式提供和显示来自 SQL 数据库的图像。

即使您不需要进行任何图像处理，它仍然是 (a) 最简单的，并且 (b) 最有效的方法。您可以将它与磁盘缓存（提供自动清理）结合使用，以获得可能的最佳性能。

[安装](http://imageresizing.net)很简单 - 2 个 nuget 命令，或复制并粘贴到 Web.Config，由您选择。

如果您需要帮助，[支持](http://imageresizing.net)是免费且快速的。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-03-04T20:46:19.570

[这](http://davidhayden.com/blog/dave/archive/2008/01/15/ASPNETDynamicDataDisplayingInsertingEditingImagesSQLServerDatabase.aspx)是一些有关如何执行此操作的示例代码。

# python - 你能给一个 Django 应用程序一个详细的名称以供整个管理员使用吗？

> ID：612372
> 
> 赞同：151
> 
> 时间：2009-03-04T20:51:03.630
> 
> 标签：python, django

就像您可以为出现在 Django 管理中的字段和模型提供详细名称一样，您可以为应用程序提供自定义名称吗？

* * *

## 回答 #1

> 赞同：199
> 
> 时间：2010-07-02T08:20:34.377

**姜戈 1.8+**

根据[1.8 文档](https://docs.djangoproject.com/en/1.8/ref/applications/#configuring-applications)（和[当前文档](https://docs.djangoproject.com/en/dev/ref/applications/#configuring-applications)），

> 新应用程序应避免`default_app_config`. 相反，他们应该要求`AppConfig`在`INSTALLED_APPS`.

例子：

```
INSTALLED_APPS = [
    # ...snip...
    'yourapp.apps.YourAppConfig',
] 
```

`AppConfig`然后按照下面列出的方式更改您的。

**姜戈 1.7**

正如 rhunwicks 对 OP 的评论所述，自 Django 1.7 以来，这现在可以开箱即用

取自[文档](https://docs.djangoproject.com/en/1.7/ref/applications/#for-application-authors)：

```
# in yourapp/apps.py
from django.apps import AppConfig

class YourAppConfig(AppConfig):
    name = 'yourapp'
    verbose_name = 'Fancy Title' 
```

然后将`default_app_config`变量设置为`YourAppConfig`

```
# in yourapp/__init__.py
default_app_config = 'yourapp.apps.YourAppConfig' 
```

**在 Django 1.7 之前**

您可以通过在模型定义中定义 app_label 来为您的应用程序指定一个自定义名称。但是当 django 构建管理页面时，它会通过它们的 app_label 对模型进行哈希处理，所以如果你希望它们出现在一个应用程序中，你必须在应用程序的所有模型中定义这个名称。

```
class MyModel(models.Model):
        pass
    class Meta:
        app_label = 'My APP name' 
```

* * *

## 回答 #2

> 赞同：47
> 
> 时间：2014-12-02T17:05:26.793

正如 rhunwicks 对 OP 的评论所述，自 Django 1.7 以来，这现在可以开箱即用

取自[文档](https://docs.djangoproject.com/en/1.7/ref/applications/#for-application-authors)：

```
# in yourapp/apps.py
from django.apps import AppConfig

class YourAppConfig(AppConfig):
    name = 'yourapp'
    verbose_name = 'Fancy Title' 
```

然后将`default_app_config`变量设置为`YourAppConfig`

```
# in yourapp/__init__.py
default_app_config = 'yourapp.apps.YourAppConfig' 
```

* * *

## 回答 #3

> 赞同：31
> 
> 时间：2011-04-28T13:08:37.723

如果您在应用程序中有多个模型，只需使用元信息创建一个模型，并为您的所有模型创建该类的子类。

```
class MyAppModel(models.Model):
    class Meta:
        app_label = 'My App Label'
        abstract = True

class Category(MyAppModel):
     name = models.CharField(max_length=50) 
```

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2010-09-02T16:08:22.260

好吧，我启动了一个名为**todo**的应用程序，现在决定将其命名为**Tasks**。问题是我的表中已经有数据，所以我的工作如下。放入models.py：

```
 class Meta:
       app_label = 'Tasks'
       db_table = 'mytodo_todo' 
```

希望能帮助到你。

* * *

## 回答 #5

> 赞同：12
> 
> 时间：2009-03-05T17:29:30.753

给他们一个 verbose_name 属性。

不要抱太大希望。您还需要将索引视图从 django.contrib.admin.sites 复制到您自己的 ProjectAdminSite 视图中，并将其包含在您自己的自定义管理实例中：

```
class ProjectAdminSite(AdminSite):
    def index(self, request, extra_context=None):
        copied stuff here...

admin.site = ProjectAdminSite() 
```

然后调整复制的视图，使其使用您的 verbose_name 属性作为应用程序的标签。

我通过在复制的视图中添加类似这样的内容来做到这一点：

```
 try:
            app_name = model_admin.verbose_name
        except AttributeError:
            app_name = app_label 
```

当您调整索引视图时，为什么不也添加一个“订单”属性。

* * *

## 回答 #6

> 赞同：10
> 
> 时间：2014-11-18T06:48:03.900

首先，您需要`apps.py`在 appfolder 上创建一个像这样的文件：

```
# appName/apps.py

# -*- coding: utf-8 -*-             
from django.apps import AppConfig

class AppNameConfig(AppConfig):
    name = 'appName'
    verbose_name = "app Custom Name" 
```

默认加载这个 AppConfig 子类：

```
# appName/__init__.py
default_app_config = 'appName.apps.AppNameConfig' 
```

是最好的办法。在 Django 1.7 上测试

![我的自定义应用名称](https://i.stack.imgur.com/oDC6H.png)

**对于对西班牙语有问题的人**

此代码在 python2 脚本上启用 utf-8 兼容性

```
# -*- coding: utf-8 -*- 
```

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2011-06-10T22:47:20.233

对于 Django 1.4（尚未发布，但 trunk 相当稳定），您可以使用以下方法。它依赖于 AdminSite 现在返回一个 TemplateResponse 的事实，您可以在呈现之前对其进行更改。

在这里，我们做了一点猴子补丁来插入我们的行为，如果您使用自定义 AdminSite 子类，可以避免这种情况。

```
from functools import wraps
def rename_app_list(func):
    m = {'Sites': 'Web sites',
         'Your_app_label': 'Nicer app label',
    }

    @wraps(func)
    def _wrapper(*args, **kwargs):
        response = func(*args, **kwargs)
        app_list = response.context_data.get('app_list')

        if app_list is not None:
            for a in app_list:
                name = a['name']
                a['name'] = m.get(name, name)
        title = response.context_data.get('title')
        if title is not None:
            app_label = title.split(' ')[0]
            if app_label in m:
                response.context_data['title'] = "%s administration" % m[app_label]
        return response
    return _wrapper

admin.site.__class__.index = rename_app_list(admin.site.__class__.index)
admin.site.__class__.app_index = rename_app_list(admin.site.__class__.app_index) 
```

这修复了索引和 app_index 视图。它不会修复所有其他管理视图中的面包屑。

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2009-03-04T23:22:05.810

不，但您可以复制管理模板并在那里定义应用程序名称。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2014-09-11T11:24:43.870

有一个不需要任何迁移就可以完成的 hack。取自 Ionel 的博客，归功于他：[http ://blog.ionelmc.ro/2011/06/24/custom-app-names-in-the-django-admin/](http://blog.ionelmc.ro/2011/06/24/custom-app-names-in-the-django-admin/)

还有一张应该在 Django 1.7 [https://code.djangoproject.com/ticket/3591中修复的票](https://code.djangoproject.com/ticket/3591)

"""

假设您有这样的模型：

```
class Stuff(models.Model):
    class Meta:
        verbose_name = u'The stuff'
        verbose_name_plural = u'The bunch of stuff' 
```

您有 verbose_name，但是您也想自定义 app_label 以在管理员中进行不同的显示。不幸的是，有一些任意字符串（带空格）不起作用，而且无论如何也不用于显示。

原来管理员使用 app_label。title() 用于显示，所以我们可以做一个小技巧：str 子类，重写 title 方法：

```
class string_with_title(str):
    def __new__(cls, value, title):
        instance = str.__new__(cls, value)
        instance._title = title
        return instance

    def title(self):
        return self._title

    __copy__ = lambda self: self
    __deepcopy__ = lambda self, memodict: self 
```

现在我们可以有这样的模型：

```
class Stuff(models.Model):
    class Meta:
        app_label = string_with_title("stuffapp", "The stuff box")
        # 'stuffapp' is the name of the django app
        verbose_name = 'The stuff'
        verbose_name_plural = 'The bunch of stuff' 
```

并且管理员将显示“The stuff box”作为应用程序名称。

"""

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2014-03-03T15:32:11.460

如果您已经有使用旧应用名称的现有表，并且您不想迁移它们，那么只需将 app_label 设置在原始模型的代理上。

```
class MyOldModel(models.Model):
    pass

class MyNewModel(MyOldModel):
    class Meta:
        proxy = True
        app_label = 'New APP name'
        verbose_name = MyOldModel._meta.verbose_name 
```

然后你只需要在你的 admin.py 中改变它：

```
#admin.site.register(MyOldModel, MyOldModelAdmin)
admin.site.register(MyNewModel, MyOldModelAdmin) 
```

**请注意，该 url 将是 /admin/NewAPPname/mynewmodel/，因此您可能只想确保新模型的类名看起来尽可能接近旧模型。**

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2019-11-07T20:28:15.467

好吧，这对我有用。在 app.py 中使用：

```
class MainConfig(AppConfig):
    name = 'main'
    verbose_name="Fancy Title" 
```

在 setting.py 中添加 App 的名称和 App 文件夹中 app.py 文件中的类名

```
INSTALLED_APPS = [
    'main.apps.MainConfig',
    'django.contrib.admin',
    'django.contrib.auth',
    'django.contrib.contenttypes',
    'django.contrib.sessions',
    'django.contrib.messages',
    'django.contrib.staticfiles', 
```

]

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2021-08-20T17:37:04.333

这很简单，只需在您的 appName/apps 上添加如下内容

```
class AppNameConfig(AppConfig):
    default_auto_field = 'default Django'
    name = 'AppName'
    verbose_name = 'Name you Want' 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2015-01-05T17:09:34.817

下面的即插即用代码段完美运行，因为`Django 1.7`. 您所要做的就是将以下代码复制到`__init__.py`特定应用程序的文件中并更改`VERBOSE_APP_NAME`参数。

```
from os import path
from django.apps import AppConfig

VERBOSE_APP_NAME = "YOUR VERBOSE APP NAME HERE"

def get_current_app_name(file):
    return path.dirname(file).replace('\\', '/').split('/')[-1]

class AppVerboseNameConfig(AppConfig):
    name = get_current_app_name(__file__)
    verbose_name = VERBOSE_APP_NAME

default_app_config = get_current_app_name(__file__) + '.__init__.AppVerboseNameConfig' 
```

如果您将它用于多个应用程序，您应该将该`get_current_app_name`函数分解为一个帮助文件。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2021-11-19T01:29:56.467

2021 年更新（Django 3.2）：

在**您的 App 的 app.py 文件中，您可以找到 AppClientsConfig 类**。在里面你可以找到 name 属性。不要改变它，除非你真的必须这样做（然后你还需要更改 settings.py 文件中的应用程序注册表......等等）。

而是**向类添加一个属性，如下所示**：

```
verbose_name = "The Name You Like" 
```

这应该够了吧。随意在[官方 Django 文档页面](https://docs.djangoproject.com/en/3.2/ref/applications/#for-application-authors)上阅读更多关于它的信息。

# c++ - 在 C++ 中初始化位域结构的最佳方法是什么？

> ID：612374
> 
> 赞同：10
> 
> 时间：2009-03-04T20:51:36.733
> 
> 标签：c++, constructor, struct, initialization, bit-fields

在 C++ 中，我有一个包含匿名位域结构的类。我想将其初始化为零，而不必手动写出所有字段。

我可以想象将初始化放在三个地方：

1.  在位域中创建构造函数
2.  在包含类的构造函数的初始化列表中清零
3.  在包含类的构造函数主体中清零

这个位域有很多字段，我不想一一列举。

例如看下面的代码：

```
class Big {
    public:
        Big();

        // Bitfield struct
        struct bflag_struct {
            unsigned int field1 : 1;
            unsigned int field2 : 2;
            unsigned int field3 : 1;
            // ...
            unsigned int field20 : 1;
            // bflag_struct(); <--- Here?
        } bflag;

        unsigned int integer_member;
        Big         *pointer_member;
}

Big::Big()
  : bflag(),             // <--- Can I zero bflag here?
    integer_member(0),
    pointer_member(NULL)
{
    // Or here?
} 
```

其中之一更可取吗？还是我还缺少其他东西？

编辑：根据下面接受的答案（由 Ferruccio 提供），我选择了这个解决方案：

```
class Big {
    // ...

    struct bflag_struct {
        unsigned int field 1 : 1;
        // ...
        bflag_struct() { memset(this, 0, sizeof *this); };
    }

    // ...
} 
```

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-03-04T20:54:45.713

你总是可以在你的构造函数中这样做：

```
memset(&bflag, 0, sizeof bflag); 
```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-03-04T20:56:33.663

将位域结构与更容易初始化为 0 的东西联合起来。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-03-04T20:56:05.007

您可以使用联合，尽管这会在访问字段时增加额外的间接级别：

```
class Big {
    union {
        struct {
            unsigned int field1 : 1;
            ...
        } fields;
        unsigned int all_fields;
    };
    ...
};

Big::Big()
  : all_fields(0),
    ...
{
    ...
} 
```

MSVC 允许在联合内部使用匿名结构（参见，例如`D3DMATRIX`in的定义`<d3d9.h>`），但这是一个非标准 C++ 扩展，如果可以，您应该避免使用它。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-05T15:43:05.690

您使用类似函数的初始化程序（标记为“我可以在这里将 bflag 归零吗？”）100% 足以用 0 值初始化您的 POD 结构。

除非您知道您的编译器在这方面有问题，否则对这些成员进行任何额外的初始化都会将其初始化两次而没有任何好处。

编辑：只是为了“好玩”，我刚刚用 VS2005、VS2008、GCC 3.4.4、GCC 4.2 和 Borland C++ 5.5.1 进行了检查……只有 Borland C++ 5.5.1 弄错了。

我说“错误”是因为在我看来，标准的 8.5 和 8.5.1 暗示类似函数的初始化程序应该对 POD 结构进行零初始化。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2019-08-31T22:03:36.620

BTW C++20 支持在类定义中初始化位域，例如

```
class ... {
   int foo : 1 {};
} 
```

使用 -std=c++2a 启用 gcc

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-04T20:57:07.110

顺便说一句，除非您需要位域来连接一些遗留代码，否则您不应该使用它们。它们本质上是不可移植和低效的。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-04T20:55:07.443

您可以在构造函数中使用 ZeroMemory 或 memset 将内存归零，这样看起来更干净。

# gcc - 使用 YDL 6.1 和 Cell SDK 3.1 的 PS3 上的 math.h 未定义对“sqrt”的引用？

> ID：612377
> 
> 赞同：3
> 
> 时间：2009-03-04T20:51:51.087
> 
> 标签：gcc, sdk, cell, powerpc, ps3

我有一个安装了 YDL 6.1 和 SDK 3.1 的 PS3，一切似乎都运行良好，因为我可以编译和运行示例。但是，我在编写自己的程序时遇到了一些问题。我创建了一个小测试用例，似乎可以查明失败的原因。我有以下代码：

```
// mathtest.c
#include <stdio.h>
#include <math.h>

int main ()
{
  double param, result;
  param = 1024.0;
  result = sqrt (param);
  printf ("sqrt(%lf) = %lf\n", param, result );
  return 0;
} 
```

当我然后跑

```
ppu-gcc mathtest.c 
```

我收到以下错误

```
/tmp/ccFqwJdG.o:(.text+0x20): undefined reference to `sqrt'
collect2: ld returned 1 exit status 
```

我已经检查以确保这个系统上存在 math.h 并且它确实定义了 sqrt。我也已经尝试过运行这个：

```
ppu-gcc -I/usr/includes/ mathtest.c 
```

但它会导致同样的错误。我很困惑，有人有什么想法吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-04T20:59:42.923

我有时会在 Linux 上遇到类似的错误，使用 -lm 作为 gcc 参数会有所帮助。也许在这里也是如此。该参数告诉链接器也包含数学库。

# iphone - 线程在模拟器中有效，但在 iPhone 上无效

> ID：612393
> 
> 赞同：0
> 
> 时间：2009-03-04T20:55:05.603
> 
> 标签：iphone, ios-simulator

我正在尝试在进行后台处理时显示 UIActivityIndi​​catorView 。下面的简化代码在我在模拟器中尝试时有效（显示警报）..但是当我从 Xcode 将它下载到我的手机时，后台线程似乎根本没有被调用。（警报永远不会显示）有
什么想法吗？

```
 -(void)viewDidLoad {   
    [self performSelectorInBackground:@selector(runInAnotherThread) withObject:nil];

}

-(void) runInAnotherThread {
    NSAutoreleasePool *pool = [ [ NSAutoreleasePool alloc ] init ];
  int i;
    for(i=0;i < 1000 ;i ++){
        NSLog(@"INDEX = %d", i);
    }

    [self performSelectorOnMainThread : @ selector(backToMainThread ) withObject:nil waitUntilDone:NO]; 
    [ pool release ];
}

-(void) backToMainThread {

    UIAlertView *completeAlert = [[UIAlertView alloc] 
                     initWithTitle:@"Back to main "
                message: @"Success" 
                delegate:nil 
                cancelButtonTitle:@"OK" 
                otherButtonTitles:nil];
    [completeAlert show];
    [completeAlert release];    
} 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-04T21:02:19.407

你试过清理你的构建吗？我刚刚在我的设备和模拟器上运行了您的代码，它在两种情况下都按预期工作

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-04T21:18:17.950

使用 NSOperation 而不是原始线程操作。它为您抽象了各种东西（优先级、自动释放池等......）。? 您可以简单地向您的 NSOperation 子类添加某种委托，以便在需要时获得回调。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-04T21:37:34.860

Thanks for replying so quickly!

It turned out that the issue was not in this code fragment at all. I was executing this code dependent on a value in the keychain. While my simulator's keychain has that value, my test iphone did not have this value.

Feel so silly for troubling all of you. But following up on the reply from nduplessis helped me narrow down the issue.

# c# - ASP.NET 回发错误

> ID：612395
> 
> 赞同：0
> 
> 时间：2009-03-04T20:55:56.490
> 
> 标签：c#, asp.net

我正在使用 C# 打开一个弹出窗口并允许用户从中选择一些值并将该值发送回服务器。但是，当我关闭弹出窗口时，出现以下错误：

* * *

无效的回发或回调参数。`<pagesenableEventValidation="true"/>`使用配置或页面启用事件验证`<%@ Page EnableEventValidation="true" %>`。出于安全目的，此功能验证回发或回调事件的参数是否源自最初呈现它们的服务器控件。如果数据有效且符合预期，请使用该`ClientScriptManager.RegisterForEventValidation`方法注册回发或回调数据以进行验证。"

* * *

有谁知道这可能是什么原因？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-04T21:06:16.357

在将值发回包含 HTML 标记或其他受限字符的表单时，我看到了此错误。默认情况下，.NET 出于安全原因阻止此操作。

在关闭表单时检查您要发回页面的值，以查看您是否在其中一个输入值中发送任何标记。

如果您绝对必须发送此类数据，请禁用 ASPX 页面上的 EnableEventValidation 属性，并确保应用验证以防止注入。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-04T21:01:28.893

出现此错误的最常见原因（对我而言）是当您自己命令式地（在代码隐藏中）而不是在 .aspx 文件中以声明方式创建控件时。特别是在初始页面呈现期间您创建一组控件，而在回发期间您的页面创建逻辑创建（可能略有）不同的一组控件。每次呈现页面时，无论是否在回发时，都必须创建页面上的所有控件并将其添加到树中的相同位置。否则会导致此错误。

此错误可能还有其他原因，但这是我见过的唯一情况。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-04T21:04:31.650

关闭事件验证。只要您自己检查表单值并确保您不接受无效值，这完全没有必要。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-04T21:10:18.750

> 这种事件验证机制降低了未经授权的回发请求和回调的风险。使用此模型，控件在呈现期间注册其事件，然后在回发或回调处理期间验证事件。默认情况下，ASP.NET 中的所有事件驱动控件都使用此功能。

您可以在 PAGE 或 web.config 中关闭 EnableEventValidation，但这会被视为安全风险。

你可以试试：

除非必要，否则请确保在 - !Page.IsPostBack 中完成绑定

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-04T22:01:00.203

如果您的弹出窗口（或其他任何内容）将任何内容注入到执行回发的表单中，那么这可能是错误的根源。

我在使用手动连接的 jquery ajax 调用更新级联选择列表（比 aspnet ajax 快得多）时遇到此错误，放入辅助选择（即 runat=server）的新值导致事件验证失败。您可以通过脚本管理器将其全部注册（我觉得这有点痛苦），或者禁用事件验证，但这确实意味着更加努力并自己验证它。

# c# - WPF 滑块问题

> ID：612412
> 
> 赞同：4
> 
> 时间：2009-03-04T21:00:58.850
> 
> 标签：c#, wpf, slider

我在一个旧的 win32 应用程序上看到了这种行为，当您在滑块轨道上的某个位置（而不是拇指上）按住鼠标时，拇指会移动到该位置。

在 WPF 中，似乎正在发生的是拇指移动了由 SmallChange 或 LargeChange 定义的距离。如果您继续持有，它会在延迟属性定义的一段时间后再次移动 SmallChange/LargeChange。

现在我想获得旧的行为？因此，如果拇指在 2 并且我在 10 附近按下鼠标，我希望它跳到 10。这样做的最佳方法是什么？

在此先感谢您的任何建议。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-03-05T04:31:49.577

Slider.IsMoveToPointEnabled

我不知道在找到它之前我经历了多少次。

# c# - 从 app.config 文件中的 web.config 部分获取值？

> ID：612415
> 
> 赞同：4
> 
> 时间：2009-03-04T21:01:44.103
> 
> 标签：c#, .net, asp.net, web-config, app-config

我正在尝试对最终将在 web.config 文件中结束的值进行单元测试。在我的测试项目中，我创建了一个带有 web.config 部分的 app.config 文件来保存设置。在正常情况下，我会调用 System.Configuration.ConfigurationSettings.AppSettings，但在这种情况下，这不起作用。我看到了[这个问题](https://stackoverflow.com/questions/76781/how-do-i-tdd-a-custom-membership-provider-and-custom-membership-user)，它非常相似，但没有解决如何从配置文件中获取 NameValueCollection。这是配置文件的示例：

```
<?xml version="1.0" encoding="utf-8" ?>
<configuration>
    <system.web>
      <membership defaultProvider="CustomMembershipProvider">
        <providers>
          <clear/>
          <add
            name="CustomMembershipProvider"
            applicationName="SettlementInfo"
            enablePasswordRetrieval="false"
            enablePasswordReset="false"
            requiresQuestionAndAnswer="true"
            writeExceptionsToEventLog="true" />
        </providers>
      </membership>
    </system.web>    

</configuration> 
```

以前有没有人处理过这个问题？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-04T21:25:08.790

我想我在这里很困惑；看起来您正在尝试测试 ASP.NET 是否适当地使用了您的自定义成员资格提供程序。正确的？

如果是这样，我 99.999% 确定您不能使用 MS 框架对此进行单元测试；您必须通过将其部署到网络服务器（或在 VS 中运行 Cassini）并在登录页面中输入用户名/密码来对其进行集成测试。

现在，我可能误解了您的要求。如果是这样，请告诉我，我会相应地编辑我的答案。

**编辑：**

> 目前，我实际上只是在尝试测试来自配置文件的 NameValue 对，以确保如果这些值不存在，则应用我的默认值。换句话说，我想尝试提取 applicationName，并验证它是否等于“SettlementInfo”，等等。之后，我将使用集成测试来确保 ASP.NET 使用自定义框架代替默认框架。那有意义吗？

我需要的不仅仅是评论来回复，所以我正在编辑。如果我没看错，您想对程序进行单元测试以确保它正确处理配置，是吗？这意味着您要确保您的代码获取例如正确的 AppSettings 键并在其中处理空值，对吗？

如果是这样的话，你很幸运；您根本不需要 app.config 或 web.config，您可以在测试设置中设置所需的值。

例如：

```
[TestMethod]
public void Test_Configuration_Used_Correctly()
{
    ConfigurationManager.AppSettings["MyConfigName"] = "MyConfigValue";
    MyClass testObject = new MyClass();
    testObject.ConfigurationHandler();
    Assert.AreEqual(testObject.ConfigurationItemOrDefault, "MyConfigValue");
}

[TestMethod]
public void Test_Configuration_Defaults_Used_Correctly()
{
    // you don't need to set AppSettings for a non-existent value...
    // ConfigurationManager.AppSettings["MyConfigName"] = "MyConfigValue";

    MyClass testObject = new MyClass();
    testObject.ConfigurationHandler();
    Assert.AreEqual(testObject.ConfigurationItemOrDefault, "MyConfigDefaultValue");
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-06-30T14:58:27.427

我相信您只有在您的应用程序实际启动时才能访问 webconfig 文件。解决方案相当简单->“伪造”您的配置。使用 NameValueCollection 并改用它：

```
private static NameValueCollection CreateConfig()
{
NameValueCollection config = new NameValueCollection();
    config.Add("applicationName", "TestApp");
    config.Add("enablePasswordReset", "false");
    config.Add("enablePasswordRetrieval", "true");
    config.Add("maxInvalidPasswordAttempts", "5");
    config.Add("minRequiredNonalphanumericCharacters", "2");
    config.Add("minRequiredPasswordLength", "6");
    config.Add("requiresQuestionAndAnswer", "true");
    config.Add("requiresUniqueEmail", "true");
    config.Add("passwordAttemptWindow", "10");

    return config;
} 
```

现在您可以轻松地将该集合传递到您的类中，以便从中解析数据。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-04T21:51:03.753

您应该能够使用[ConfigurationManager.GetSection()](http://msdn.microsoft.com/en-us/library/system.configuration.configurationmanager.getsection.aspx)方法来提取您想要的任何内容。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-01-23T17:41:23.267

实际上，如果您使用 NUnit，您可以将其粘贴在测试项目的 App.config 中。然后将此行添加到您的 Post-build 事件中：

复制 /Y “$(ProjectDir)App.config” “$(TargetDir)$(TargetFileName).config”</p>

当您在测试中创建新的提供者时，NUnit 会将您的 app.config 中的值传递给 initialize 方法中的提供者。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-04T21:05:33.487

为什么不把它放在 web.config 文件中呢？

# wiki - 在 MediaWiki 中使用动态生成的类别时限制类别嵌入

> ID：612419
> 
> 赞同：6
> 
> 时间：2009-03-04T21:03:45.567
> 
> 标签：wiki, mediawiki

起初我不确定如何在 MediaWiki 中进行高级操作的问题是否属于这里，但在阅读了常见问题并思考之后，我决定 wiki 标记与 HTML 和 CSS 一样是它自己的语言，如果这些欢迎在这里提问，希望这也是！如果我错了，请随时标记这个问题。*更新：*正如这个问题得到的 3 个观点所证明的那样，我想虽然它可能在 Stackoverflow 的规则之内，但在这个主题上可能没有太多的专业知识！我想我需要把这个问题带到官方论坛（不寒而栗）

* * *

## 问题

在我设置的 wiki 上，我设置了我的 MediaWiki，我有一个模板，可以输出动态创建的类别等内容。这意味着调用模板的页面将根据传递给模板的一些变量进行分类。动态生成的类别位于`<includeonly>`块内，以防止模板页面本身获取类别。

问题是我随后*将该*页面嵌入到其他页面，这导致类别也被嵌入，现在第三页具有它嵌入的所有页面的所有类别。

我想以某种方式格式化模板，以便调用模板的页面将使用类别，但包含调用页面的任何页面都不会继承类别。

## 例子

这是我最好的设置示例。如果这还不够，我可以提供指向我的真实示例的链接。

**`Template:Food`**
一个页面，它接受几个变量并输出一个解释食物的高度格式化的块，包括输出基于“类型”变量的类别。

**`Banana`**
此页面使用一些变量调用`Template:Food`模板，包括`type`set to `"fruit"`。结果是，当用户查看“ `Banana`”页面时，他们会得到一个格式精美的页面，其中包含有关水果的一些基本信息。此外，如果用户转到该`Category:Fruit`页面，他们将看到列出的 Banana 页面。

**`Banana Nut Bread Recipe`**
这是问题页面。在这个食谱页面上，作者想要嵌入所有的成分页面，以便每种成分都列在其格式良好的块中。但是，当他使用 嵌入`Banana`页面时`{{:Banana}}`，`Fruit`类别也随之被嵌入，现在该`Banana Nut Bread Recipe`页面被列为`Fruit`错误的类别。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-05T02:29:56.763

如果我理解正确，您希望将仅包含信息（类别）限制为仅深度 1 嵌入。我不认为这是可能的。

可能的解决方案：

1-不要将类别信息放入`Template:Food`. 只需将其直接放在每个成分页面中，或者如果您真的必须，创建一个`Template:Food_category`或类似的。然后每个页面可以有任意数量的`{{Food}}`s 并且`{{food category}}`需要明确放置 s。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2016-06-07T14:16:56.130

Labeled Section Transclusion 扩展允许您使用标签标记源文章的部分，并基于这些标签进行转换。标签可以重叠，因此您可以非常精细地控制通过的内容。

[https://www.mediawiki.org/wiki/Extension:Labeled_Section_Transclusion](https://www.mediawiki.org/wiki/Extension:Labeled_Section_Transclusion)

我认为使用带标签的部分嵌入，您可以将 Type:fruit 和 Banana 描述嵌入到 Banana 页面上单独的嵌入语句中，但只能将描述拉到 Recipe 页面。

# sql - SQL：需要根据子查询限制结果集

> ID：612423
> 
> 赞同：1
> 
> 时间：2009-03-04T21:05:47.090
> 
> 标签：sql, mysql, subquery

我遇到了一个相当奇怪的问题。我有以下示例数据可以在 mysql 数据库中使用：

```
    |钥匙| 数据| 索引 | 总计| 时间戳 |
    | # | 一个 | 1 | 2 | 2009-01-02 01:01:32 |
    | $ | 乙 | 2 | 2 | 2009-01-02 01:03:32 |
    | % | c | 1 | 3 | 2009-01-03 01:01:32 |
    | ^ | d | 2 | 3 | 2009-01-03 01:04:32 |
    | & | 电子| 3 | 3 | 2009-01-03 01:02:32 |
    | * | f | 1 | 2 | 2009-01-05 01:01:32 |

```

发生的事情是另一个进程（不受我控制）正在接收数据包，并将它们直接存储到数据库中，并带有到达时间的时间戳。数据包应该以突发形式到达...... a，b 将彼此靠近并被索引为 1 和 2，每个数据包包含传输的数据包的“总数”。key 是一个普通的自增主键。

我需要的是一个视图，它将显示最近到达的列表（部分列表，如果不是所有的数据包都已经到达，是可以接受的）。

对于上述查询，理想情况下结果应该只是“f”，但我没有看到这样做的方法。如果我们不能以其他方式得到它，返回“a”和“f”是可以接受的。换句话说，select 语句捕获的少量额外数据并不是什么大问题。对于“f”到达之前的时间段，正确的返回是 c、d 和 e。

我的一般想法是这样的：

```
SELECT * FROM 表 WHERE 总计 = (
    SELECT total FROM table WHERE timestamp = (
        从表中选择 MAX（时间戳）
    )
)
ORDER BY DESC 时间戳
限制 （
    SELECT total FROM table WHERE timestamp = (
        从表中选择 MAX（时间戳）
)

```

正如你们中的一些人可能已经注意到的那样，您不能在 LIMIT 子句中执行子查询（至少对于 mysql）。有没有人有另一种方法来解决这个问题？通过将 JOIN 嵌套到最近 id 的小列表中，可以使上面的查询更加清晰，但这仍然会在子查询中留下 LIMIT 子查询问题。

作为一个两阶段查询，这是相对微不足道的。问题是它需要成为 VIEW 的定义选择语句。

编辑以修复错误的 sql 示例

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-04T21:13:44.763

我建议的查询：

```
SELECT *
FROM packets
WHERE total = ( SELECT total
                FROM packets
                WHERE timestamp = ( SELECT MAX(timestamp) FROM packets ))
    AND timestamp >= ( SELECT MAX(timestamp) FROM packets WHERE idx = 1 )
ORDER BY timestamp DESC; 
```

不作为：

```
mysql> create table packets( id bigint(20) AUTO_INCREMENT primary key, data char(1), idx int(10), total int(10), timestamp datetime );
Query OK, 0 rows affected (0.00 sec)

mysql> insert into packets( data, idx, total, timestamp ) values( 'a', 1 ,2,'2009-01-02 01:01:32'),
    ->     ('b' ,2 ,2,'2009-01-02 01:03:32'),
    ->     ('c'  ,1 ,3,'2009-01-03 01:01:32'),
    ->     ('d'  ,2 ,3,'2009-01-03 01:04:32'),
    ->     ('e' ,3 ,3,'2009-01-03 01:02:32'),
    ->     ('f' ,1 ,2,'2009-01-05 01:01:32');
Query OK, 6 rows affected (0.00 sec)
Records: 6  Duplicates: 0  Warnings: 0

mysql> SELECT *
    -> FROM packets
    -> WHERE total = ( SELECT total
    -> FROM packets
    -> WHERE timestamp = ( SELECT MAX(timestamp) FROM packets ))
    -> AND timestamp >= ( SELECT MAX(timestamp) FROM packets WHERE idx = 1 )
    -> ORDER BY timestamp DESC;
+----+------+------+-------+---------------------+
| id | data | idx  | total | timestamp           |
+----+------+------+-------+---------------------+
|  6 | f    |    1 |     2 | 2009-01-05 01:01:32 |
+----+------+------+-------+---------------------+
1 row in set (0.00 sec)

mysql> delete from packets where id = 6;
Query OK, 1 row affected (0.00 sec)

mysql> SELECT * FROM packets WHERE total = ( SELECT total FROM packets WHERE timestamp = ( SELECT MAX(timestamp) FROM packets )) AND timestamp >= ( SELECT MAX(timestamp) FROM packets WHERE idx = 1 ) ORDER BY timestamp DESC;
+----+------+------+-------+---------------------+
| id | data | idx  | total | timestamp           |
+----+------+------+-------+---------------------+
|  4 | d    |    2 |     3 | 2009-01-03 01:04:32 |
|  5 | e    |    3 |     3 | 2009-01-03 01:02:32 |
|  3 | c    |    1 |     3 | 2009-01-03 01:01:32 |
+----+------+------+-------+---------------------+
3 rows in set (0.00 sec)

mysql> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-04T21:15:54.990

如果它们按顺序到达而没有在其间写入其他数据包，则以下也应该起作用。

```
SELECT *
FROM Total t
     INNER JOIN (
       SELECT Total, Timestamp
       FROM Total t
            INNER JOIN (
              SELECT Timestamp = MAX(Timestamp) 
              FROM Total
              WHERE ID = 1
            ) ts ON ts.Timestamp = t.Timestamp.
     ) tit ON tit.Total = t.Total AND tit.Timestamp <= t.Timestamp 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-04T21:21:25.290

这就是我在 sql server 中的做法，您可以转换为 mysql 语法。

```
SELECT *
FROM table
     INNER JOIN (SELECT TOP 1 * FROM table ORDER BY key DESC) AS t ON (table.timestamp = t.timestamp AND table.total = t.total) 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-17T18:50:46.243

我最终使用了一个稍微不同的查询表单：

```
CREATE VIEW NewestTimestamps AS
  SELECT index, MAX(timestamp) AS maxTS FROM table GROUP BY index；

创建视图最新列表为
  SELECT * FROM 表 AS t
    加入 NewestTimestamps sub ON t.timestamp = sub.maxTS AND sub.index = t.index
  WHERE t.total = (SELECT t2.total FROM table AS t2
    WHERE 时间戳 = (SELECT MAX(timestamp) FROM table)
  );

```

这个列表并不是我所要求的，但实际上似乎不可能可靠地区分新旧数据。相反，这将为我提供索引 1 处的最新元素，然后是索引 2，等等……此外，WHERE 子句会将视图的大小限制为最近到达的队列的大小。

请注意，第一个视图是必需的，因为 mysql 不允许视图中的 FROM 子句中的子查询。

# text - 我应该使用什么语言来创建一个简单的在线文本格式化应用程序？

> ID：612425
> 
> 赞同：0
> 
> 时间：2009-03-04T21:06:27.727
> 
> 标签：text, formatting, blogs, richtextediting

我想为一个网站制作一个页面，让用户创建博客文章，并希望他们能够以图形方式编辑格式，如段落和样式，然后将其转换为 html。有没有办法在 PHP 中做到这一点？我需要使用 Javascript 或 Ajax 什么的吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-04T21:08:43.557

PHP（如果你想要动态行为）和[FCKeditor](http://www.fckeditor.net/)（在客户端）将完成这项工作。看看[演示](http://www.fckeditor.net/demo)。另一个好的编辑器是[TinyMCE](http://tinymce.moxiecode.com/)。

# mysql - MySQL存档存储引擎的优缺点？

> ID：612428
> 
> 赞同：17
> 
> 时间：2009-03-04T21:08:32.450
> 
> 标签：mysql, archive, storage-engines

对于我正在开发的网站，我会将用户活动信息（如 Facebook）和对服务器的 HTTP 请求存储到 MySQL 数据库中。

我打算使用 InnoDB 作为存储引擎，但是，我简要了解了 Archive 存储引擎，这听起来像是只插入或选择而从未更新或删除的信息的前进方向。

在我继续之前，我想知道任何利弊，以帮助我决定是否使用它。

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2009-03-04T21:25:09.027

我们目前没有使用存档存储引擎，但已经对其进行了一些研究。我们的应用程序的一个要求是它可以长时间存储大量历史信息。该数据永远不会更新，但需要偶尔选择。

所以......考虑到这一点：

**专业人士**

占地面积非常小。使用 zlib 进行数据压缩。

由于数据文件较小，备份效率更高/速度更快。

**缺点**

不允许列索引。选择需要全表扫描。

不支持空间数据。

--

由于索引限制，我们很可能不会使用此存储引擎。

# sql-server - 我们什么时候必须在 SQL Server 中使用 NVARCHAR/NCHAR 而不是 VARCHAR/CHAR？

> ID：612430
> 
> 赞同：80
> 
> 时间：2009-03-04T21:09:20.250
> 
> 标签：sql-server, unicode, collation, nvarchar

当我们必须使用 Unicode 类型时，是否有规则？

我已经看到大多数欧洲语言（德语、意大利语、英语……）在同一个数据库中的 VARCHAR 列中都很好。

我正在寻找类似的东西：

1.  如果你有中文 --> 使用 NVARCHAR
2.  如果你有德语和阿拉伯语 --> 使用 NVARCHAR

服务器/数据库的整理呢？

我不想像这里建议的那样总是使用 NVARCHAR [varchar 和 nvarchar SQL Server 数据类型之间的主要性能差异是什么？](https://stackoverflow.com/questions/35366/varchar-vs-nvarchar-performance)

* * *

## 回答 #1

> 赞同：124
> 
> 时间：2009-03-05T20:44:44.217

您想要使用 NVARCHAR 的真正原因是当您在同一列中有**不同**的语言时，您需要在不解码的情况下在 T-SQL 中寻址列，您希望能够在 SSMS 中“本地”查看数据，或者您想要标准化 Unicode。

如果您将数据库视为哑存储，则完全可以在 VARCHAR（例如 UTF-8）中存储宽字符串和不同（甚至可变长度）编码。当您尝试编码和解码时，问题就出现了，尤其是当不同行的代码页不同时。这也意味着 SQL Server 将无法轻松处理数据，以便在 T-SQL 中查询（可能是可变的）编码列。

使用 NVARCHAR 可以避免这一切。

我会推荐 NVARCHAR 用于其中包含用户输入数据的任何列，这些数据相对不受约束。

我建议将 VARCHAR 用于任何作为自然键的列（如车牌、SSN、序列号、服务标签、订单号、机场呼号等），它通常由标准或立法或惯例定义和约束。VARCHAR 也用于用户输入，并且非常受限制（如电话号码）或代码（活动/关闭、Y/N、M/F、M/S/D/W 等）。绝对没有理由为这些使用 NVARCHAR。

所以对于一个简单的规则：

VARCHAR 当保证被约束时 NVARCHAR 否则

* * *

## 回答 #2

> 赞同：26
> 
> 时间：2020-08-28T16:54:22.970

[两个最受欢迎的答案都是错误的。它应该与“存储不同/多种语言”无关。您可以支持像`ñ`和英语这样的西班牙语字符，只使用公共`varchar`字段和`Latin1_General_CI_AS` `COLLATION`，例如]

**短版**只要由字段确定的不支持所需的字符，就
应该使用`NVARCHAR`/ 。 此外，根据 SQL Server 版本，您可以使用特定的 ，例如自 SQL Server 2019 以来可用的。在字段（或整个表/数据库）上设置此排序规则，将用于存储和处理该字段上的数据，允许完全支持字符，因此它支持的任何语言。`NCHAR``ENCODING``COLLATION`
`COLLATIONs``Latin1_General_100_CI_AS_SC_UTF8``VARCHAR``UTF-8` `ENCODING``UNICODE`

**完全理解：**
[要完全理解我将要解释的内容，必须有 的概念`UNICODE`，`ENCODING`并且`COLLATION`所有这些概念都非常清楚。如果你不这样做，那么首先看看下面我对“什么是 UNICODE、ENCODING、COLLATION 和 UTF-8，以及它们是如何相关的”部分和提供的文档链接的简明扼要的解释。此外，我在这里所说的一切都特定于`Microsoft SQL Server`，以及它如何存储和处理`char`/`nchar`和`varchar`/`nvarchar`字段中的数据。]

假设我们想在我们的 MSSQL Server 数据库中存储一个特殊的文本。它可能是一条 Instagram 评论，如“我喜欢 stackoverflow！”。
即使是 ASCII 也可以完美支持纯英文部分，但由于还有一个表情符号，它是`UNICODE`标准中指定的字符，我们需要一个`ENCODING`支持这个 Unicode 字符的字符。

MSSQL Server 使用`COLLATION`来确定在///字段`ENCODING`上使用什么。因此，与很多人认为的不同，**不仅是**关于排序和比较数据，而且是关于，因此：**我们的数据将如何存储！**`char``nchar``varchar``nvarchar``COLLATION` **`ENCODING`**

 ****那么，**我们如何知道我们的校对使用的编码是什么？**有了这个：

```
SELECT COLLATIONPROPERTY( 'Latin1_General_CI_AI' , 'CodePage' ) AS [CodePage]
--returns 1252 
```

这个简单的 SQL 返回`Windows Code Page`for a `COLLATION`。A`Windows Code Page`只不过是另一个映射到`ENCODINGs`。对于`Latin1_General_CI_AI` `COLLATION`它返回的`Windows Code Page`代码`1252`，映射到`Windows-1252` `ENCODING`.
因此，对于带有 的`varchar`列，`Latin1_General_CI_AI` `COLLATION`此字段将使用 处理其数据`Windows-1252` `ENCODING`，并且仅正确存储此编码支持的字符。

如果我们检查 Windows-1252 的`Windows-1252 ENCODING`规范[字符列表](https://en.wikipedia.org/wiki/Windows-1252)，我们会发现这种编码不支持我们的表情符号字符。如果我们仍然尝试一下：

[![包含 UNICODE 字符的文本，由于我们对 varchar 字段的排序和编码而被错误地存储](https://i.stack.imgur.com/5FHHF.png)](https://i.stack.imgur.com/5FHHF.png)

**好的，那么我们如何解决这个问题？**实际上，这取决于，这很好！

**`NCHAR`/`NVARCHAR`**

`NCHAR`在 SQL Server 2019 之前，我们只有`NVARCHAR`字段。有人说它们是`UNICODE`田地。**那是错的！**. 同样，它取决于字段`COLLATION`和 SQLServer 版本。微软的[“nchar and nvarchar (Transact-SQL)”文档](https://docs.microsoft.com/en-us/sql/t-sql/data-types/nchar-and-nvarchar-transact-sql?view=sql-server-ver15)完美地说明了：

> 从 SQL Server 2012 (11.x) 开始，当使用启用了补充字符 (SC) 的排序规则时，这些数据类型存储所有 Unicode 字符数据并使用 UTF-16 字符编码。如果指定了非 SC 归类，则这些数据类型仅存储 UCS-2 字符编码支持的字符数据子集。

换句话说，如果我们使用比 2012 年更早的 SQL Server，例如 SQL Server 2008 R2，`ENCODING`那些字段将使用`UCS-2 ENCODING`支持`UNICODE`. 但是，如果我们使用 SQL Server 2012 或更新版本，并定义一个`COLLATION`已`Supplementary Character`启用的，那么我们的字段将使用`UTF-16` `ENCODING`完全支持的`UNICODE`.

**但是，还有更多！我们现在可以使用 UTF-8 了！！**

**`CHAR`/`VARCHAR`**

从 SQL Server 2019 开始，**我们可以使用`CHAR`/`VARCHAR`**字段并且仍然完全支持`UNICODE`使用`UTF-8` `ENCODING`！！！

来自微软的[“char and varchar (Transact-SQL)”文档](https://docs.microsoft.com/en-us/sql/t-sql/data-types/char-and-varchar-transact-sql?view=sql-server-ver15)：

> 从 SQL Server 2019 (15.x) 开始，当使用启用了 UTF-8 的排序规则时，这些数据类型存储全范围的 Unicode 字符数据并使用 UTF-8 字符编码。如果指定了非 UTF-8 归类，则这些数据类型仅存储该归类的相应代码页支持的字符子集。

再次，换句话说，如果我们使用比 2019 更旧的 SQL Server，例如 SQL Server 2008 R2，我们需要`ENCODING`使用前面解释的方法检查。但是，如果我们使用 SQL Server 2019 或更新版本，并定义一个`COLLATION`like `Latin1_General_100_CI_AS_SC_UTF8`，那么我们的字段将使用`UTF-8` `ENCODING`迄今为止支持所有`UNICODE`字符的最常用和最有效的编码。

**奖金信息：**

关于 OP 对*“我已经看到大多数欧洲语言（德语、意大利语、英语……）在 VARCHAR 列中的同一个数据库中都很好”*的观察，我认为很高兴知道为什么会这样：

对于最常见的`COLLATIONs`，如默认的 as或`Latin1_General_CI_AI`will用于字段。如果我们查看它的[文档](https://en.wikipedia.org/wiki/Windows-1252)，我们可以看到它支持：`SQL_Latin1_General_CP1_CI_AS``ENCODING``Windows-1252``varchar`

> 英语、爱尔兰语、意大利语、挪威语、葡萄牙语、西班牙语、瑞典语。另外还有德语、芬兰语和法语。和荷兰语，除了 Ĳ 字符

但正如我之前所说，这与语言无关，而与您希望支持/存储的字符有关，如表情符号示例所示，或者像“锂电池的电阻为 0.5Ω”这样的句子，我们又遇到了简单的英语和一个希腊字母/字符“omega”（这是电阻的符号，以欧姆为单位），不会被`Windows-1252` `ENCODING`.

**结论：**

所以，就是这样！何时使用`char`/`nchar`和`varchar`/`nvarchar`取决于您想要支持的字符，以及您的 SQL Server 版本，该版本将确定`COLLATIONs`您`ENCODINGs`可以使用的字符。

**什么是 UNICODE、ENCODING、COLLATION 和 UTF-8，以及它们之间的关系**
[注意：以下所有解释都是**简化**。请参阅提供的文档链接以了解有关这些概念的所有详细信息。]

*   **`UNICODE`**- 是一种标准，一种约定，旨在规范统一有序的表格中的所有字符。在此表中，每个字符都有一个唯一编号。这个数字通常称为字符的`code point`。
    **UNICODE 不是编码！**

*   **`ENCODING`**- 是字符和字节/字节序列之间的映射。因此，编码用于将字符“转换”为字节，反之亦然，从字节转换为字符。其中最受欢迎的是`UTF-8`,`ISO-8859-1`和。您可以将其视为“转换表”（我在这里确实简化了）。`Windows-1252``ASCII`

*   **`COLLATION`**- 那个很重要。甚至微软的文档也没有明确说明这一点。排序规则指定您的数据将如何排序、比较**和存储！**. 是的，我敢打赌你没想到最后一个，对吧！？排序规则`SQL Server`也决定了`ENCODING`该特定`char`///字段上使用的内容`nchar`。`varchar``nvarchar`

*   **`ASCII ENCODING`**- 是最早的编码之一。它既是字符表（就像一个自己的小版本`UNICODE`）和它的字节映射。所以它不会将一个字节映射到`UNICODE`，而是将一个字节映射到它自己的字符表。此外，它始终只使用 7 位，并支持 128 个不同的字符。足以支持所有英文字母大小写、数字、标点符号和其他一些有限数量的字符。ASCII 的问题在于，由于它只使用 7 位，而当时几乎每台计算机都是 8 位，因此还有另外 128 种可能的字符被“探索”，每个人都开始将这些“可用”字节映射到自己的字符表，创造了很多不同`ENCODINGs`。

*   **`UTF-8 ENCODING`**- 这是另一个`ENCODING`，周围使用最多（如果不是最多）的一个`ENCODING`。它使用可变字节宽度（根据规范，一个字符的长度可以是 1 到 6 个字节）并完全支持所有`UNICODE`字符。

*   **`Windows-1252 ENCODING`**- 也是最常用`ENCODING`的一种，广泛用于 SQL Server。它是固定大小的，所以每个字符总是 1 个字节。它还支持很多口音，来自各种语言，但不支持所有现有的，也不支持`UNICODE`. *这就是为什么您的`varchar`字段具有常见排序规则的原因，例如`Latin1_General_CI_AS`support `á`, `é`, `ñ`characters ，即使它没有使用 support `UNICODE` `ENCODING`。*

资源：
[https ://blog.greglow.com/2019/07/25/sql-think-that-varchar-characters-if-so-think-again/](https://blog.greglow.com/2019/07/25/sql-think-that-varchar-characters-if-so-think-again/)
[https://medium.com/@apiltamang/unicode-utf -8-and-ascii-encodings-made-easy-5bfbe3a1c45a](https://medium.com/@apiltamang/unicode-utf-8-and-ascii-encodings-made-easy-5bfbe3a1c45a)
[https://www.johndcook.com/blog/2019/09/09/how-utf-8-works/](https://www.johndcook.com/blog/2019/09/09/how-utf-8-works/)
[https://www.w3.org/国际/问题/qa-what-is-encoding](https://www.w3.org/International/questions/qa-what-is-encoding)

[https://en.wikipedia.org/wiki/List_of_Unicode_characters](https://en.wikipedia.org/wiki/List_of_Unicode_characters)
[https://www.fileformat.info/info/charset/windows-1252/list.htm](https://www.fileformat.info/info/charset/windows-1252/list.htm)

[https://docs .microsoft.com/en-us/sql/t-sql/data-types/char-and-varchar-transact-sql?view=sql-server-ver15](https://docs.microsoft.com/en-us/sql/t-sql/data-types/char-and-varchar-transact-sql?view=sql-server-ver15)
[https://docs.microsoft.com/en-us/ sql/t-sql/data-types/nchar-and-nvarchar-transact-sql?view=sql-server-ver15](https://docs.microsoft.com/en-us/sql/t-sql/data-types/nchar-and-nvarchar-transact-sql?view=sql-server-ver15)
[https://docs.microsoft.com/en-us/sql/t-sql/statements/windows-collat ​​ion-name-transact-sql?view=sql-server-ver15](https://docs.microsoft.com/en-us/sql/t-sql/statements/windows-collation-name-transact-sql?view=sql-server-ver15)
[https://docs.microsoft.com/en -us/sql/t-sql/statements/sql-server-collat​​ion-name-transact-sql?view=sql-server-ver15](https://docs.microsoft.com/en-us/sql/t-sql/statements/sql-server-collation-name-transact-sql?view=sql-server-ver15)
[https://docs.microsoft.com/en-us/sql/relational-databases/ collat​​ions/collat​​ion-and-unicode-support?view=sql-server-ver15#SQL-collat​​ions](https://docs.microsoft.com/en-us/sql/relational-databases/collations/collation-and-unicode-support?view=sql-server-ver15#SQL-collations)

[SQL Server 默认字符编码](https://stackoverflow.com/questions/5182164/sql-server-default-character-encoding)
[https://en.wikipedia.org/wiki/Windows_code_page](https://en.wikipedia.org/wiki/Windows_code_page)

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2009-03-04T21:13:19.350

每当您必须存储多种语言时，都应该使用 NVARCHAR。我相信您必须将它用于亚洲语言，但不要引用我的话。

如果您以俄语为例并将其存储在 varchar 中，这就是问题所在，只要您定义正确的代码页就可以了。但是假设您使用默认的英文 sql 安装，那么俄文字符将无法正确处理。如果您使用的是 NVARCHAR() 它们将得到正确处理。

# 编辑

好的，让我引用[MSDN](http://msdn.microsoft.com/en-us/library/bb330962.aspx#intlftrql2005_topic2)，也许我是具体的，但你不想在 varcar 列中存储一个以上的代码页，虽然你可以你不应该

> 当您处理以 char、varchar、varchar(max) 或 text 数据类型存储的文本数据时，要考虑的最重要限制是系统只能验证来自单个代码页的信息。（您可以存储来自多个代码页的数据，但不建议这样做。）用于验证和存储数据的确切代码页取决于列的排序规则。如果尚未定义列级排序规则，则使用数据库的排序规则。要确定用于给定列的代码页，可以使用 COLLATIONPROPERTY 函数，如以下代码示例所示：

这里还有一些：

> 此示例说明了许多语言环境（例如格鲁吉亚语和印地语）没有代码页的事实，因为它们是仅 Unicode 排序规则。这些排序规则不适用于使用 char、varchar 或 text 数据类型的列

所以格鲁吉亚语或印地语确实需要存储为 nvarchar。阿拉伯语也是一个问题：

> 您可能遇到的另一个问题是，当您希望支持的所有字符都未包含在代码页中时，无法存储数据。在许多情况下，Windows 将特定的代码页视为“最合适”的代码页，这意味着不能保证您可以依赖该代码页来处理所有文本；它只是可用的最好的。阿拉伯文字就是一个例子：它支持多种语言，包括俾路支语、柏柏尔语、波斯语、克什米尔语、哈萨克语、吉尔吉斯语、普什图语、信德语、维吾尔语、乌尔都语等。除了 Windows 代码页 1256 中定义的阿拉伯语之外，所有这些语言都有其他字符。如果您尝试将这些额外字符存储在具有阿拉伯语排序规则的非 Unicode 列中，

使用 Unicode 时要记住的一点是，尽管您可以将不同的语言存储在单个列中，但您只能使用单个排序规则进行排序。有些语言使用拉丁字符，但不像其他拉丁语言那样排序。口音就是一个很好的例子，我不记得这个例子了，但是有一种东欧语言的 Y 不像英语 Y 排序。然后是西班牙用户要求在 h 之后排序的西班牙语 ch。

总而言之，在处理内部化时您必须处理的所有问题。我认为从一开始就使用 Unicode 字符更容易，避免额外的转换并占用空间。因此，我之前的声明。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-03-04T21:11:23.583

希腊语在 N 列类型上需要 UTF-8：αβγ ;)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-05-04T06:15:30.230

Josh 说：“....使用 Unicode 时要记住的一点是，尽管您可以将不同的语言存储在单个列中，但您只能使用单个排序规则进行排序。有些语言使用拉丁字符但排序不一样其他拉丁语言。口音就是一个很好的例子，我不记得这个例子了，但是有一种东欧语言的 Y 不像英语 Y 排序。然后是西班牙用户要求排序的西班牙语 ch在 h 之后。”

我是母语为西班牙语的人，“ch”不是一个字母，而是两个“c”和“h”，西班牙字母表是这样的：abcdefghijklmn ñ opqrstuvwxyz 我们不希望“ch”在“h”之后，而是“i”除了 ñ 或 HTML 中的“ñ ;”之外，字母表与英语中的字母表相同

亚历克斯

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2016-03-23T15:22:15.717

**TL;博士;**
Unicode -（nchar、nvarchar 和 ntext）
非 unicode -（char、varchar 和 text）。

[来自 MSDN](https://msdn.microsoft.com/en-GB/library/ms143726.aspx)

> SQL Server 中的排序规则为您的数据提供排序规则、区分大小写和区分重音的属性。与字符数据类型（如 char 和 varchar）一起使用的排序规则规定了代码页和可以为该数据类型表示的相应字符。

假设您使用的是默认 SQL 排序规则`SQL_Latin1_General_CP1_CI_AS`，那么下面的脚本应该打印出您可以放入的所有符号，`VARCHAR`因为如果您在打印的列表中看不到它，它使用一个字节来存储一个字符（总共 256 个） - 您需要`NVARCHAR`.

```
declare @i int = 0;
while (@i < 256)
begin
print cast(@i as varchar(3)) + '  '+  char(@i)  collate SQL_Latin1_General_CP1_CI_AS 
print cast(@i as varchar(3)) + '  '+ char(@i)  collate Japanese_90_CI_AS  
set @i = @i+1;
end 
```

如果您将排序规则更改为日语，您会注意到所有奇怪的欧洲字母都变成了正常的，一些符号变成了`?`标记。

> Unicode 是将代码点映射到字符的标准。因为它旨在涵盖世界上所有语言的所有字符，所以不需要不同的代码页来处理不同的字符集。如果存储反映多种语言的字符数据，请始终使用 Unicode 数据类型（nchar、nvarchar 和 ntext）而不是非 Unicode 数据类型（char、varchar 和 text）。

否则你的排序会变得很奇怪。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2019-11-26T10:19:32.060

如果有人在 Mysql 中遇到此问题，则无需将 varchar 更改为 nvarchar 您只需将列的排序规则更改为 utf8

# asp.net-mvc - ASP.Net MVC 最大的问题是什么

> ID：612433
> 
> 赞同：1
> 
> 时间：2009-03-04T21:10:17.017
> 
> 标签：asp.net-mvc

使用 ASP.Net MVC 时遇到的最大问题是什么？您为解决这些问题做了哪些工作？

到目前为止，我最大的问题是：

问题：跟上变化（RCx、beta 等）。

解决方法：编译直到它工作。

问题：记住和处理 Futures DLL。

解决方法：下载最新的，编译直到它工作。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-04T21:32:35.527

我没有遇到任何真正的问题。也就是说，我编写了自己的有用助手库，让我的生活更轻松。其中大部分类似于期货库，但我认为我已经走得更远了。它主要围绕将表单组件、模型绑定器和验证器集成在一起，以便您可以在几秒钟内以最少的代码获得一个完全工作的、可验证的 CRUD 页面。

我很喜欢流畅的验证

```
Rules(
    Ensure(x => x.Date).IsLessThan(DateTime.Now), 
    Ensure(x => x.Telephone).HasMinimumLength(12),
    Ensure(x => x.Email).IsValidEmailAddress()
    ); 
```

也就是说，futures 本身就是一个优秀的包，使 mvc 成为一个很好的工具。我认为它的主要问题是缺乏全面的教程和文档。由于它相对较新并且最近经历了如此多的重大变化，因此许多关于该主题的博客文章都已过时。

我认为一旦它击中 RMT，对于初学者来说，事情应该会变得更容易。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-05T16:14:27.547

文档，文档，文档。此外，除了基本的初学者内容之外，我们还需要一个一站式的最佳实践场所。ASP.NET MV C 页面有很好的教程，但大多数都是简单的教程。我们需要一本我认为的食谱；）

我认为这一切都会随着时间的推移而到来——尤其是在最终发布之后。然而，现在开始工作有点令人沮丧（即使使用 RC2），并且大部分内容已经过时，因为它引用了 Beta 和预览代码 :(

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-19T16:19:06.620

*   似乎大多数教程都在控制器中设置了验证，而不是模型，我不喜欢
*   编译代码时，它不会编译视图中的代码
*   路线是一个令人作呕的混乱
*   我想将我的一些项目切换为不使用代码隐藏，但要么他们都必须有代码隐藏，要么都没有。
*   测试还没有成熟（不过我认为这会随着时间的推移而出现）

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-19T16:32:01.147

到目前为止，[ASP.MVC 1.0 是 RTM 毫无价值](http://www.asp.net/mvc/)。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-04T21:17:01.527

您意识到您正在使用预览/测试版/RC 软件，对吗？可以预料事情会发生变化。

在过去一年左右的时间里，我在使用 ASP.NET MVC 时遇到的大多数问题都是由于我的无知造成的。预览 2 -> 预览 3 真的很痛苦，但仅此而已。

现在，我唯一真正与之抗争的是

```
return Json(data); 
```

当我真的找不到任何数据时，它会在我的数据中看到循环。我确定有一些我不知道的行为导致了这种情况，所以我仍然将其归因于我自己的无知。也许如果有某种方法可以告诉它忽略某些属性，我可以解决这个问题，而不必每次我想从一个动作返回 JSON 时构建一个字典/列表。

另一件事我真的没有问题，但我记得很多人抱怨，就是这么多方法采用匿名对象。即路由定义。Intellisense 不会告诉您方法在其匿名中期望什么样的键/值对。对象，因此如果您不熟悉该框架，则可能难以使用。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-04T22:39:57.457

我喜欢它最先进的事实，我什至喜欢升级我的应用程序的挑战（尽管有时我会推迟它，直到我有更多时间）。

有时困扰我的是缺乏成熟的控件，这些控件会使简单的重复任务（想想验证、数据绑定）变得更加容易。

但在我的一天中，我从来没有后悔使用 MVC，甚至没有考虑过使用 webforms。我迷上了asp.net mvc，并且一年多来没有在其他任何东西上制作任何比单一表格更大的东西。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-06T20:41:58.393

我认为你必须运行一些东西才能看到它是否“真的”编译是它最大的障碍。HTML 标记中的所有“代码”都可以让您轻松解决经典的 asp 意大利面条代码问题。寻找编译器在以后的版本中改进。

# html - HTML中的网站标题

> ID：612436
> 
> 赞同：1
> 
> 时间：2009-03-04T21:10:33.117
> 
> 标签：html, layout

如何创建带有页眉、内容和页脚的网页。我在我的 Mac 上使用 TextEdit 并使用 .HTML 扩展名保存文件。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-04T21:13:02.987

您可以在[HTML Dog](http://htmldog.com/)上浏览 HTML 和 CSS 的 3+3 教程。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-04T21:12:26.467

我假设您有能力在您的主机上运行脚本语言，因此只需编写一个页眉和页脚文件，并使用您选择的动态语言将它们包含在您的内容页面中。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-04T21:14:32.747

创建一个html文件粘贴这个框架：

```
<html>

<frameset rows="25%,50%,25%">

  <frame src="header.htm">
  <frame src="content.htm">
  <frame src="footer.htm">

</frameset>

</html> 
```

然后在同一目录中创建您的页眉、内容和页脚文件。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-04T21:15:54.943

```
<html>
<head><title>my title</title></head>

<h1>My Header</h1>

<p>The quick brown fox jumps over the lazy dog.</p>

<h4>My footer</h4>
</html> 
```

我的头衔

# 我的标题

敏捷的棕色狐狸跳过了懒狗。

我的页脚

* * *

或者，您可以将每个部分放在一个单独的文件中，或者特别是将页眉和页脚放在单独的文件中以供重复使用。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-04T21:25:01.710

如果您的网络服务器是[Apache](http://httpd.apache.org/)（我猜在 Mac 上），您可以使用[服务器端包含](http://www.boutell.com/newfaq/creating/include.html)：

```
<html>
.....
<body>
<!--#include virtual="myheader.html" --> 

YOUR CONTENT GOES HERE

<!--#include virtual="myfooter.html" --> 
</body> 
```

# batch-file - 如何在下面的批处理文件中按列获取输出

> ID：612438
> 
> 赞同：-2
> 
> 时间：2009-03-04T21:10:40.603
> 
> 标签：batch-file

如何在下面的批处理文件中按列获取输出

```
@echo off
setlocal enableextensions enabledelayedexpansion
set Counter=0
for /f "usebackq tokens=2,5,6 delims= " %%a in (`findstr /c:"Cod " 

1231.txt`) do (        
set x=%%b
set x=!x:~3!
set y=%%c        
if %%c LSS 10 set y=!y:~1!
set item!Counter!=%%a-!x!#!y!        
set /a Counter+=1
)
set result=%item0%
for /l %%i in (1,1,!Counter!) do set result=!result!!item%%i!
FOR /F %%A IN ('CHCP') DO SET CHCP=%%A
echo  %result% >>result.txt
endlocal 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-04T21:39:51.987

Looks like you are concatenating the values into the `result` variable. Rather than:

```
... do set result=!result!!item%%i! 
```

Why not output the value directly to your output file:

```
... do echo !item%%i!>>result.txt 
```

# bash - 排序 | 独特 | xargs grep ... 其中行包含空格

> ID：612439
> 
> 赞同：4
> 
> 时间：2009-03-04T21:11:15.987
> 
> 标签：bash, command-line, scripting, cygwin

我有一个逗号分隔的文件“myfile.csv”，其中第 5 列是日期/时间戳。(mm/dd/yyyy hh:mm)。**我需要列出所有包含重复日期的行（有很多）**

我正在通过 cygwin 为 WinXP 使用 bash shell

```
$ cut -d, -f 5 myfile.csv | sort | uniq -d 
```

正确返回重复日期的列表

```
01/01/2005 00:22
01/01/2005 00:37
[snip]    
02/29/2009 23:54 
```

但我不知道如何将其提供给 grep 以提供所有行。显然，我不能`xargs`直接使用，因为输出包含空格。我以为我可以做到`uniq -z -d`，但由于某种原因，结合这些标志会导致 uniq （显然）什么都不返回。

所以，鉴于

```
 $ cut -d, -f 5 myfile.csv | sort | uniq -d -z | xargs -0 -I {} grep '{}' myfile.csv 
```

不起作用...我该怎么办？

我知道我可以用`perl`或其他脚本语言来做到这一点......但我固执的天性坚持认为我应该能够`bash`使用标准命令行工具来做到这一点，如`sort`, `uniq`, `find`, `grep`,`cut`等。

**教我，哦 bash 大师。如何使用典型的 cli 工具获取我需要的行列表？**

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-03-04T21:35:07.690

1.  sort -k5,5 将对字段进行排序并避免剪切；
2.  uniq -f 4 将忽略 uniq 的前 4 个字段；
3.  加上 uniq 上的 -D 会得到所有重复的行（vs -d，只会得到一个）；
4.  但 uniq 会期望制表符分隔而不是 csv，所以 tr '\t' ',' 来解决这个问题。

问题是如果您在#5 之后有不同的字段。你们的日期都一样长吗？您可以在 uniq 中添加 -w 16 （包括时间）或 -w 10 （仅用于日期）。

所以：

```
tr '\t' ',' < myfile.csv | sort -k5,5 | uniq -f 4 -D -w 16 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-04T21:20:35.743

`-z`选项`uniq`需要输入为 NUL 分隔。您可以通过以下方式过滤输出`cut`：

```
tr '\n' '\000' 
```

获得零分隔行。然后`sort`，`uniq`并`xargs`有选项来处理它。尝试类似：

```
cut -d, -f 5 myfile.csv | tr '\n' '\000' | sort -z | uniq -d -z | xargs -0 -I {} grep '{}' myfile.csv 
```

编辑：`tr`管道中的位置错误。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-04T21:46:20.440

您可以使用 -d 选项告诉 xargs 将每一行用作完整的参数。尝试：

```
cut -d, -f 5 myfile.csv | sort | uniq -d | xargs -d '\n' -I '{}' grep '{}' myfile.csv 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-05T14:45:10.710

尝试使用 sed 转义空格：

```
echo 01/01/2005 00:37 | sed 's/ /\\ /g'
cut -d, -f 5 myfile.csv | sort | uniq -d | sed 's/ /\\ /g' | xargs -I '{}' grep '{}' myfile.csv 
```

（另一种方法是将重复的日期行读入 IFS=$'\n' 数组并在 for 循环中对其进行迭代。）

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-09T15:10:47.650

这是 awk 的一个很好的候选：

```
BEGIN { FS="," }
{ split($5,A," "); date[A[0]] = date[A[0]] " " NR }
END { for (i in date) print i ":" date[i] } 
```

1.  将字段分隔符设置为 ',' (CSV)。
2.  在空格上拆分第五个字段，将结果粘贴在 A 中。
3.  将行号连接到我们已经为该日期存储的列表中。
4.  打印出每个日期的行号。

# xslt - 使用时如何测试零记录 ?

> ID：612441
> 
> 赞同：5
> 
> 时间：2009-03-04T21:12:22.050
> 
> 标签：xslt

我的代码生成以下 XML：

```
<person_app>
  <person_data>
    <person>
         ...person details here...
    </person>
  </person_data>
</person_app> 
```

使用 XSLT，我按如下方式解析人员记录：

```
<xsl:template match="/person_app/person_data">
  <xsl:for-each select="person">
      ...generate person HTML...
  </xsl:for-each>
</xsl:template> 
```

但是，如果我收到零人，我想显示“未找到记录”（或类似的东西）。当应用返回零记录时，XML 类似于以下内容：

```
<person_app/> 
```

长话短说，当我使用 <xsl:for-each/> 解析我的 Person 记录时，如何测试空结果集？我尝试了以下但没有成功：

```
<xsl:if test="not(person)">
  <div style="font-size:18pt"><xsl:text>No records found</xsl:text></div>
</xsl:if> 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-04T21:25:07.170

像这样的东西：

```
<xsl:choose>
  <xsl:when test="person">
    <xsl:for-each select="person">
       ...generate person HTML...
    </xsl:for-each>
  </xsl:when>
  <xsl:otherwise>
    <div style="font-size:18pt"><xsl:text>No records found</xsl:text></div>
  </xsl:otherwise>
</xsl:choose> 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-04T21:33:21.987

```
<xsl:template match="/person_app/person_data">
  <xsl:if test="count(person) = 0">
    <div style="font-size:18pt"><xsl:text>No records found</xsl:text></div>
  </xsl:if>
  <xsl:for-each select="person">
      ...generate person HTML...
  </xsl:for-each>
</xsl:template> 
```

# macos - 为什么 Mac ABI 要求 x86-32 的 16 字节堆栈对齐？

> ID：612443
> 
> 赞同：33
> 
> 时间：2009-03-04T21:12:41.270
> 
> 标签：macos, memory-alignment, callstack, calling-convention, abi

我可以理解旧 PPC RISC 系统甚至 x86-64 的这一要求，但对于久经考验的旧 x86？在这种情况下，堆栈只需要在 4 字节边界上对齐。是的，一些 MMX/SSE 指令需要 16 字节对齐，但如果这是被调用者的要求，那么它应该确保对齐正确。**为什么要让每个**调用者都负担这个额外的要求？这实际上会导致性能下降，因为每个呼叫站点都必须管理此要求。我错过了什么吗？

**更新：**在对此进行了更多调查并咨询了一些内部同事之后，我对此有一些理论：

1.  操作系统的 PPC、x86 和 x64 版本之间的一致性
2.  似乎 GCC 代码生成器现在始终执行 sub esp,xxx 然后将数据“移动”到堆栈上，而不是简单地执行“推送”指令。这实际上在某些硬件上可能更快。
3.  虽然这确实使调用站点有点复杂，但在使用调用者清理堆栈的默认“cdecl”约定时几乎没有额外的开销。

我对最后一项的问题是，对于依赖于被调用方清理堆栈的调用约定，上述要求**确实**“丑化”了代码生成。例如，某些编译器决定实现更快的基于寄存器的调用样式以供其内部使用（即任何不打算从其他语言或源调用的代码）？这种堆栈对齐的事情可能会抵消通过在寄存器中传递一些参数所获得的一些性能提升。

**更新：**到目前为止，唯一真正的答案是一致性，但对我来说，这有点太容易了。我在 x86 架构方面拥有超过 20 年的经验，如果一致性，而不是性能或其他具体的东西，真的是原因，那么我恭敬地建议开发人员要求它有点天真。他们忽略了近三年的工具和支持。特别是如果他们希望工具供应商能够快速轻松地为他们的平台调整他们的工具（也许不是......它**是**苹果......），而不必跳过几个看似不必要的障碍。

我会在另一天左右给出这个话题然后关闭它......

### 有关的

*   [这是我的堆栈框架，我不在乎你的堆栈框架！](http://blog.therealoracleatdelphi.com/2010/01/its-my-stack-frame-i-dont-care-about_14.html)

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2009-05-22T16:28:30.630

来自“英特尔® 64 和 IA-32 架构优化参考手册”，第 4.4.2 节：

“为了获得最佳性能，Streaming SIMD Extensions 和 Streaming SIMD Extensions 2 要求它们的内存操作数与 16 字节边界对齐。与对齐的数据相比，未对齐的数据可能会导致显着的性能损失。”

来自附录 D：

“重要的是要确保堆栈帧在函数进入时与 16 字节边界对齐，以在整个函数调用过程中保持本地 __m128 数据、参数和 XMM 寄存器溢出位置对齐。”

[http://www.intel.com/Assets/PDF/manual/248966.pdf](http://www.intel.com/Assets/PDF/manual/248966.pdf)

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-05-07T02:26:29.883

我不确定，因为我没有第一手证据，但我相信原因是 SSE。如果您的缓冲区已经在 16 字节边界上对齐（movps 与 movups），那么 SSE 会快得多，并且任何 x86 对于 mac os x 至少具有 sse2。它可以由应用程序用户来处理，但成本非常高。如果在 ABI 中强制执行它的总成本不是太高，那么它可能是值得的。SSE 在 mac os X 中非常普遍地使用：加速框架等......

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-03-07T01:12:44.843

我相信这是为了让它与 x86-64 ABI 保持一致。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2010-01-15T12:06:01.840

首先，请注意 16 字节对齐是 Apple 为 System V IA-32 ABI 引入的一个例外。

只有在调用系统函数时才需要堆栈对齐，因为许多系统库都使用需要 16 字节对齐的 SSE 或 Altivec 扩展。[我在libgmalloc MAN 页面](http://developer.apple.com/Mac/library/documentation/Darwin/Reference/ManPages/man3/libgmalloc.3.html)中找到了一个明确的参考。

您可以按照您想要的方式完美地处理您的堆栈帧，但是如果您尝试使用未对齐的堆栈调用系统函数，您最终会收到一条**misaligned_stack_error**消息。

**编辑：作为记录，您可以通过使用**[mstack-realign](http://lists.apple.com/archives/xcode-users/2006/Jun/msg00390.html)选项 在使用 GCC 编译时摆脱对齐问题。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2010-01-08T11:34:18.863

这是一个效率问题。

确保堆栈在每个使用新 SSE 指令的函数中是 16 字节对齐的，这会增加使用这些指令的大量开销，从而有效地降低性能。

另一方面，始终保持堆栈 16 字节对齐可确保您可以自由使用 SSE 指令而不会降低性能。这没有成本（至少在说明中衡量的成本）。它只涉及更改函数序言中的常数。

浪费堆栈空间很便宜，它可能是缓存中最热的部分。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2010-01-25T07:06:37.993

我的猜测是，Apple 相信每个人都只使用 XCode (gcc) 来为您对齐堆栈。因此，要求堆栈对齐以便内核不必对齐只是一个微优化。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-05-22T16:12:05.293

嗯，OS X ABI 不是也做有趣的 RISC，比如在寄存器中传递小结构吗？

这表明与其他平台理论的一致性。

想想看，FreeBSD 系统调用 api 也对齐 64 位值。（例如 lseek 和 mmap）

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-05-22T17:07:45.470

虽然我无法真正回答您的问题，但您可能会发现以下站点上的手册很有用：

[http://www.agner.org/optimize/](http://www.agner.org/optimize/)

关于 ABI，请特别查看：

[http://www.agner.org/optimize/calling_conventions.pdf](http://www.agner.org/optimize/calling_conventions.pdf)

希望这很有用。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-03-07T13:13:10.337

为了保持内核的一致性。这允许在多个体系结构上引导相同的内核而无需修改。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2011-07-12T02:38:02.603

不知道为什么没有人考虑过从传统的基于 PowerPC 的平台轻松移植的可能性？

读这个：

[http://developer.apple.com/library/mac/#documentation/DeveloperTools/Conceptual/LowLevelABI/100-32-bit_PowerPC_Function_Calling_Conventions/32bitPowerPC.html#//apple_ref/doc/uid/TP40002438-SW20](http://developer.apple.com/library/mac/#documentation/DeveloperTools/Conceptual/LowLevelABI/100-32-bit_PowerPC_Function_Calling_Conventions/32bitPowerPC.html#//apple_ref/doc/uid/TP40002438-SW20)

然后放大到“32-bit PowerPC Function Calling Conventions”，最后是这个：

> “这些是 32 位 PowerPC 环境中可用的嵌入对齐模式：
> 
> 功率对齐模式源自 IBM XLC 编译器用于 AIX 操作系统的对齐规则。它是在 AIX 和 Mac OS X 上使用的 PowerPC 架构版本的 GCC 的默认对齐模式。因为这种模式最有可能在不同供应商的 PowerPC 架构编译器之间兼容，所以它通常与在之间共享的数据结构一起使用不同的节目。”

鉴于 OSX 遗留的基于 PowerPC 的背景，可移植性是一个主要的考虑因素——它要求一直遵循 AIX 的 XLC 编译器的约定。当您考虑需要确保所有工具和应用程序能够以最少的返工协同工作时，我认为尽可能坚持使用相同的旧 ABI 是很重要的。

这给出了哲学，进一步阅读是明确提到的规则（“Prolog and Epilog”）：

> 被调用的函数负责分配自己的堆栈帧，确保在堆栈中保持 16 字节对齐。此操作由一段称为 prolog 的代码完成，编译器将其放在子例程的主体之前。在子例程的主体之后，编译器放置一个结语以将处理器恢复到子例程调用之前的状态。

# wcf - 在 MEX 响应中为基于操作合同的 WCF 服务添加自定义 SOAP 标头

> ID：612448
> 
> 赞同：0
> 
> 时间：2009-03-04T21:14:25.963
> 
> 标签：wcf, soap, header, mex

我在使用 WCF 服务时遇到问题，该服务需要为标有 [OperationContract] 属性的方法自定义 SOAP 标头。无法在服务中显式声明自定义标头，因为接口方法不基于 [MessageContract]。因此，当 svcutil.exe 尝试构建客户端代理时，生成的代码不包含任何与自定义标头相关的对象。我的问题是我能否轻松地将自定义标头的声明注入到 MEX 响应中，以便它们在服务提供的 WSDL 中可用。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2010-03-01T06:02:53.843

这篇文章中接受的答案演示了一个端点行为，它可以满足您的需求：

[所有操作上的 WCF WSDL Soap 标头](https://stackoverflow.com/questions/986455/wcf-wsdl-soap-header-on-all-operations)

此外，如果您想为每个服务合同指定标头，则可以通过合同行为应用相同的概念。

# ajax - 如何从 Firefox 中删除淡入淡出和滑动效果

> ID：612452
> 
> 赞同：2
> 
> 时间：2009-03-04T21:14:53.793
> 
> 标签：ajax, firefox, desktop

当我作为最终用户访问使用这种 javascript 效果的网页时，有没有办法从 Firefox 中删除滑动和淡出效果？

当某个元素被插入到 DOM 中时，它后面的元素会向下滑动。这是一种图形效果，当有人通过远程连接（终端服务器、Citrix、远程 X、nx）查看时，会非常耗费时间和带宽中间状态。

也许已经有一个设置（关于：配置）？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-04T21:19:07.260

大多数流行网站都有[油脂猴脚本](http://userscripts.org)来简化界面并消除此类烦恼。一般来说，没有办法禁用它，因为它不是一个单一的功能，而是其他良性功能组合的紧急结果。

为了澄清最后一点......用于这些动画的每个单独的javascript函数（即计时器和元素大小/放置操作）都有合法用途。只是它们的组合是一个问题，它们可以通过多种方式与其他操作组合。某种启发式方法可能会识别整个网站中可能令人讨厌的动画，但针对特定网站（或网站框架，所有 jquery 网站使用相同的动画代码等）的个别修复将更加有效和高效。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-04T21:26:19.083

我会研究 Firefox 的 NoScript 扩展——它会禁用每个站点上的所有 javascript，然后可以逐个站点打开。

[https://addons.mozilla.org/en-US/firefox/addon/722](https://addons.mozilla.org/en-US/firefox/addon/722)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2018-08-10T22:15:56.250

试试这个扩展：

[禁用过渡和动画](https://addons.mozilla.org/en-GB/firefox/addon/no-transition/?src=search)

> 今天，当您打开一个菜单时，它通常会“滑动”0.2 秒，或者链接会通过缓慢的淡化来改变颜色……这些效果是由 CSS3 动画/过渡制成的，可能会很重或会降低网站的可访问性。有了这个扩展，过渡是瞬时的。

# django - 用于管理货币账户和交易的 Django 插件

> ID：612463
> 
> 赞同：1
> 
> 时间：2009-03-04T21:17:18.153
> 
> 标签：django, currency, account

我们正在编写一个应用程序，要求用户拥有余额为美元和积分的帐户。是否已经有一个可插入的 django 应用程序可以帮助我们？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-04T23:16:37.790

有一个名为[python-money](http://code.google.com/p/python-money/)的应用程序。它有一些在 Django 模型中定义 MoneyField 的代码，但我们最初的实验显示了一些问题，所以我们只是切换到使用常规的[DecimalField](http://docs.djangoproject.com/en/dev/ref/models/fields/#decimalfield)。

[DecimalField](http://docs.djangoproject.com/en/dev/ref/models/fields/#decimalfield)适用于货币，我认为这也最适合您的情况，因为听起来您不需要保持多种货币的余额。

**编辑：**响应需要交易、账户管理等的附加要求。

试试[迷你](https://secure.caktusgroup.com/projects/minibooks)书，尤其要注意他们的[Ledger 模型](https://secure.caktusgroup.com/projects/minibooks/browser/trunk/ledger/models.py)。

如果这不起作用，我认为您将不得不跳出 Django 并尝试将[OpenERP](http://www.openerp.com/)或[Tryton](http://www.tryton.org/)（OpenERP 分支）之类的东西合并到您的 Django 应用程序中。

# python - 使用超级问题（python 2.5.2）

> ID：612468
> 
> 赞同：2
> 
> 时间：2009-03-04T21:18:13.987
> 
> 标签：python, introspection, python-datamodel

我正在为我的程序编写一个插件系统，但我无法克服一件事：

```
class ThingLoader(object):
'''
Loader class
'''

    def loadPlugins(self):
        '''
        Get all the plugins from plugins folder
        '''
        from diones.thingpad.plugin.IntrospectionHelper import loadClasses

        classList=loadClasses('./plugins', IPlugin)#Gets a list of 
        #plugin classes
        self.plugins={}#Dictionary that should be filled with 
        #touples of objects and theirs states, activated, deactivated.
        classList[0](self)#Runs nicelly
        foo = classList[1]
        print foo#prints <class 'TestPlugin.TestPlugin'>
        foo(self)#Raise an exception 
```

测试插件如下所示：

```
import diones.thingpad.plugin.IPlugin as plugin
   class TestPlugin(plugin.IPlugin):
       '''
     classdocs
    '''
    def __init__(self, loader):
        self.name='Test Plugin'
        super(TestPlugin, self).__init__(loader) 
```

现在 IPlugin 看起来像这样：

```
class IPlugin(object):
    '''
    classdocs
    '''
    name=''
    def __init__(self, loader):
        self.loader=loader
    def activate(self):
        pass 
```

所有 IPlugin 类本身都可以完美运行，但是当被 ThingLoader 调用时，程序会出现异常：

```
File "./plugins\TestPlugin.py", line 13, in __init__
    super(TestPlugin, self).__init__(loader) NameError: 
global name 'super' is not defined 
```

我环顾四周，我根本不知道发生了什么事。

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-03-04T22:02:24.943

'super' 是内置的。除非您竭尽全力删除内置函数，否则您永远不会看到“未定义全局名称 'super'”。

我正在查看您的[用户 Web 链接](http://logdiones.blogspot.com/)，其中有 IntrospectionHelper 的转储。没有缩进很难阅读，但看起来你可能正在这样做：

```
built_in_list = ['__builtins__', '__doc__', '__file__', '__name__']

for i in built_in_list:
    if i in module.__dict__:
        del module.__dict__[i] 
```

那是您在那里更改的原始模块字典，而不是您即将返回的信息副本！从实时模块中删除这些成员，您可以期待更多的“超级”破坏。

很难跟踪该模块在做什么，但我的反应是其中有太多的魔力。普通的 Python 程序永远不需要搞乱导入系统、sys.path 和猴子补丁 __magic__ 模块成员。一点点魔法可以是一个巧妙的技巧，但这非常脆弱。就在我浏览它的时候，代码可能会被以下内容破坏：

*   名称与顶级模块冲突
*   任何新式类的使用
*   仅作为编译字节码提供的模块
*   zipimporter

从 getClassDefinitions、extractModuleNames 和 isFromBase 等令人难以置信的迂回函数来看，在我看来，您对 Python 工作原理的基础知识还有很多了解。（线索：分别是 getattr、module.__name__ 和 issubclass。）

在这种情况下，现在*不是*潜入进口魔法的时候！*很难*。_ 相反，以正常的 Python 方式做事。在包的 mypackage/__init__.py 的底部可能需要输入更多内容：

```
from mypackage import fooplugin, barplugin, bazplugin
plugins= [fooplugin.FooPlugin, barplugin.BarPlugin, bazplugin.BazPlugin] 
```

但它会在任何地方起作用并被理解，而无需依赖复杂而脆弱的魔法巢穴。

顺便说一句，除非您计划进行一些深入的多重继承工作（再说一次，现在可能不是这样做的时候），您甚至可能不需要使用 super()。调用已知超类的常用“IPlugin.__init__(self, ...)”方法很简单；super() 并不总是“更新、更好的做事方式”，在你开始使用它之前，[你应该了解一些事情。](http://fuhm.net/super-harmful/)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-04T22:05:07.430

除非您运行的 Python 版本早于 2.2（不太可能），否则`super()`绝对是一个[内置函数](http://docs.python.org/library/functions.html)（在每个范围内都可用，并且无需导入任何内容）。

可能值得检查您的 Python 版本（只需通过在命令行键入 python 来启动交互式提示）。

# c# - ASP.NET - 如何读取视频文件的属性（长度、分辨率、编解码器）

> ID：612472
> 
> 赞同：1
> 
> 时间：2009-03-04T21:19:05.997
> 
> 标签：c#, asp.net, video

我正在开发一个允许用户上传视频文件的 ASP.NET 应用程序。用户上传后，我需要确定媒体的一些属性——即持续时间/长度、分辨率和编解码器（如果可能）。

解决这个问题的最简单方法是什么？我应该使用 WMP SDK - 这似乎涉及实际实例化服务器上​​的媒体播放器。框架中有什么可以做到这一点，还是我需要依赖外部库？

我不关心向用户显示或流式传输视频。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-05T17:08:22.473

框架中没有任何内容，您将需要某种库。我见过的最好的（但自从我看过以来已经有一年左右的时间了）是 taglib-sharp：

[http://developer.novell.com/wiki/index.php/TagLib_Sharp](http://developer.novell.com/wiki/index.php/TagLib_Sharp)

该站点现在似乎已关闭，但我看到它仅在几个月前被移植到 fink（用于 OSX），所以我认为这是暂时的。

哎呀，刚刚看到你不是第一个提出这些问题的人，我也不是第一个建议 taglib-sharp 的人：

[查看/编辑 MP3 文件的 ID3 数据](https://stackoverflow.com/questions/68283/viewedit-mp3-id3-data-in-c)

（注意：它支持音频和视频文件）。

hth

# cocoa - 根据计算值为计算值设置 KVO

> ID：612474
> 
> 赞同：9
> 
> 时间：2009-03-04T21:19:29.413
> 
> 标签：cocoa, cocoa-bindings, key-value-observing

所以我有两个对象，Invoice 和 InvoiceLineItem。InvoiceLineItem 有一个名为的属性`cost`，它是基于其他属性动态创建的。为了帮助我使用 KVO/绑定：

```
+ (NSSet *)keyPathsForValuesAffectingCost {
    return [NSSet setWithObjects:@"lineItemType", @"serviceCost", @"hourlyRate", @"timeInSeconds", @"productCost", @"quantityOfProduct", @"mileageCost", @"milesTraveled", nil];
} 
```

这很好用。当我编辑像 serivceCost 这样的属性时，表视图中的主要成本会更新得很好。

在 Invoice 对象中，我有一个 InvoiceLineItems 的 NSMutableArray。Invoice 有一个类似的属性，称为`totalCost`. 它是通过迭代行项目来计算的，只要行项目没有被标记为已删除（我这样做是出于同步原因），它就会将成本相加并创建总成本。

现在我的问题/问题。如何设置 Invoice 的 totalCost 以便在行项目的成本之一发生更改时它与 KVO/绑定一起使用？

我尝试设置：

```
+ (NSSet *)keyPathsForValuesAffectingTotalCost {
    return [NSSet setWithObjects:@"lineItems.cost", nil];
} 
```

但它不起作用。我最终在控制台中出现错误：`[<NSCFArray 0x1499ff40> addObserver:forKeyPath:options:context:] is not supported. Key path: cost`

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-04T21:35:15.507

我不相信自动 KVO 传播支持多关系。文档并没有以一种或另一种方式明确说明，但从我对 KVO 的一般了解来看，观察一对多关系的子键往往不是微不足道的。

我解决这个问题的方法是手动观察`cost`每个 InvoiceLineItem 对象的属性，通过在 Invoice 类上分别执行 addObserver/removeObserver 调用的属性的一对多 KVC 访问器`lineItems`在插入/删除方法中调用，然后`totalCost`使用 willChangeValueForKey:/didChangeValueForKey: 手动触发更改。所以像这样的东西（粗略的代码，免责声明等）：

```
- (void)insertObject:(InvoiceLineItem*)newItem inLineItemsAtIndex:(unsigned)index
{
    [newItem addObserver:newItem forKeyPath:@"cost" options:0 context:kLineItemContext];
    [lineItems insertObject:newItem atIndex:index];
}

- (void)removeObjectFromLineItemsAtIndex:(unsigned)index
{
    [[lineItems objectAtIndex:index] removeObserver:self forKeyPath:@"cost"];
    [lineItems removeObjectAtIndex:index];
}

- (void)observeValueForKeyPath:(NSString*)keyPath ofObject:(id)object change:(NSDictionary*)change context:(void*)context
{
    if (context == kLineItemContext)
    {
        [self willChangeValueForKey:@"totalCost"];
        [self didChangeValueForKey:@"totalCost"];
    }
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-09-04T13:53:44.430

您可以尝试更短的解决方案。

添加到头文件：

```
@property (retain, readonly) NSDecimalNumber *accountBalance; 
```

添加到实现文件

```
- (NSDecimalNumber *)totalCost
{
    return [self valueForKeyPath:@"InvoiceLineItems.@sum.cost"];
} 
```

# sql - 我可以使用 SQL 根据日程安排信息绘制实际日期吗？

> ID：612480
> 
> 赞同：3
> 
> 时间：2009-03-04T21:20:46.197
> 
> 标签：sql, sql-server, sql-server-2005, tsql

如果我有一个包含暗示特定日期的计划信息的表，是否可以编写一个 SQL 语句来将该信息转换为实际行，使用某种 CROSS JOIN，也许？

考虑一个包含这些列的付款计划表：

*   **StartDate** - 计划开始的日期（第一次付款应在该日期到期）
*   **期限**- 以月为单位的时间表长度
*   **频率**- 重复之间的月数
*   **PaymentAmt** - 付款金额 :-)

```
SchedID StartDate 期限频率 PaymentAmt
-------------------------------------------------
1 2003 年 1 月 5 日 48 12 1000.00
2 2008 年 12 月 20 日 42 6 25.00

```

是否有一条 SQL 语句可以让我从上面转到下面？

```
                              跑步
预计到期的 SchedID 付款
        日期总数
--------------------------------------
1 1 2003 年 1 月 5 日 1000.00
1 2 2004 年 1 月 5 日 2000.00
1 3 2005 年 1 月 5 日 3000.00
1 4 2006 年 1 月 5 日 4000.00
1 5 2007 年 1 月 5 日 5000.00
2 1 2008 年 12 月 20 日 25.00
2 2 2009 年 6 月 20 日 50.00
2 3 2009 年 12 月 20 日 75.00
2 4 2010 年 6 月 20 日 100.00
2 5 2010 年 12 月 20 日 125.00
2 6 2011 年 6 月 20 日 150.00
2 7 2011 年 12 月 20 日 175.00

```

我正在使用 MS SQL Server 2005（不希望很快升级），我已经可以使用表变量和 while 循环来做到这一点，但似乎某种 CROSS JOIN 会适用，但我不知道怎么可能工作。

感谢您的想法。

*编辑：虽然我最初说的是 2000，但我实际上使用的是 SQL Server **2005。**我们并不像我想象的那样倒退。对不起。*

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-05T14:17:08.343

我现在无法测试代码，所以请稍加注意，但我认为看起来或多或少类似于以下内容的内容应该可以回答这个问题：

```
with q(SchedId, PaymentNum, DueDate, RunningExpectedTotal) as
    (select SchedId,
            1 as PaymentNum,
            StartDate as DueDate,
            PaymentAmt as RunningExpectedTotal
     from PaymentScheduleTable
     union all
     select q.SchedId,
             1 + q.PaymentNum as PaymentNum,
             DATEADD(month, s.Frequency, q.DueDate) as DueDate,
             q.RunningExpectedTotal + s.PaymentAmt as RunningExpectedTotal
     from q
          inner join PaymentScheduleTable s
                  on s.SchedId = q.SchedId
     where q.PaymentNum <= s.Term / s.Frequency)
select *
from q
order by SchedId, PaymentNum 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-04T21:24:46.263

我使用表值函数来实现类似的结果。基本上与使用我知道的表变量相同，但我记得对设计非常满意。

在我看来，这种用法最终读起来很好：

```
/* assumes @startdate and @enddate schedule limits */

SELECT
   p.paymentid,
   ps.paymentnum,
   ps.duedate,
   ps.ret
FROM
   payment p,
   dbo.FUNC_get_payment_schedule(p.paymentid, @startdate, @enddate) ps
ORDER BY p.paymentid, ps.paymentnum 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-04T21:26:11.830

尝试使用整数表（或者更好的是：[http](http://www.sql-server-helper.com/functions/integer-table.aspx) : //www.sql-server-helper.com/functions/integer-table.aspx）和一些日期数学，例如 开始 + 整数 * 频率

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-04T21:25:32.720

一个典型的解决方案是使用日历表。您可以扩展它以满足您自己的需要，但它看起来像：

```
CREATE TABLE Calendar
(
     calendar_date DATETIME NOT NULL,
     is_holiday BIT NOT NULL DEFAULT(0),
     CONSTRAINT PK_Calendar PRIMARY KEY CLUSTERED calendar_date
) 
```

除了 is_holiday 之外，您还可以添加与您相关的其他列。您可以编写一个脚本来在接下来的 10 年或 100 年或 1000 年中填充表格，您应该已经准备就绪。它使您尝试执行的查询变得更加简单，并且可以为您提供额外的功能。

# asp.net-mvc - 当我在 asp.net mvc 中显示表单时，如何让 DropDown 具有选定的值？

> ID：612482
> 
> 赞同：2
> 
> 时间：2009-03-04T21:21:25.320
> 
> 标签：asp.net-mvc

这是我在控制器中的内容：

```
IList<LocationInFacility> locs = LocationsInFacility(custCodeID);
ViewData["LocationsInFacility"] = new SelectList(locs, "ID", "Name", "DL"); 
```

这是视图：

```
<label>Location in Facility</label>
<%= Html.DropDownList
        ("LocationsInFacility",(SelectList)ViewData["LocationsInFacility"]) %> 
```

这是 html 输出，我本来希望选择“DL”，但事实并非如此：

```
<select id="LocationsInFacility" name="LocationsInFacility">
<option value="">-- Select a Location in Facility --</option>
<option value="DL">DELI</option>
<option value="BK">BAKERY</option>
</select> 
```

为什么没有选择“DL”？我究竟做错了什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-04T21:37:55.750

解决方案是将 Html.DropDownList 更改为：

```
<%= Html.DropDownList("LocationsInFacility") %> 
```

* * *

## 回答 #2

> 赞同：-2
> 
> 时间：2009-03-04T21:25:17.730

DL 是 LocationsInFacility 数据中的字符串吗？如果没有，您可能需要传递值，而不是 ToString 等效项

# .net - .NET foreach 语句是否保证以与构建相同的顺序迭代集合？

> ID：612486
> 
> 赞同：15
> 
> 时间：2009-03-04T21:22:48.673
> 
> 标签：.net, collections, foreach

一位同事使用 for 循环在他编写的一些 C# 代码中迭代 List 并留下评论，“没有使用 For Each，因为我不确定它是否按顺序迭代。谁知道微软会做什么。” 例如，假设我们有一个这样构建的 List：

```
var someList = new List<string>();

someList.Add("one");
someList.Add("two");
someList.Add("three"); 
```

我的同事使用了这样的东西：

```
for (int i = 0; i < someList.Count; i++)    
{
    System.Diagnostics.Debug.WriteLine(someList[i]);
} 
```

而不是这个：

```
foreach (var item in someList)              
{
    System.Diagnostics.Debug.WriteLine(item);
} 
```

我猜他担心这些物品的出现顺序可能与它们添加到收藏中的顺序不同。我认为他有点偏执，但从技术上讲，文档没有说明迭代集合的顺序。foreach 语句是否可以以除从最低到最高之外的任何顺序遍历数组或集合对象？

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2009-03-04T21:25:01.240

您的问题是关于 a `List<T>`，它确实维持秩序。

单独的 foreach 不能保证做任何事情。它只是询问为其枚举器提供的对象，这可能会做任何事情。

* * *

## 回答 #2

> 赞同：23
> 
> 时间：2009-03-04T21:25:22.160

这取决于集合：

*   因为`List<T>`它保证是插入顺序。（假设只是`Add`调用，如图所示。如果您将元素插入到列表中的特定位置，它们将在您期望的正确位置返回。）基本上它与您通过 , 等获得的`list[0]`顺序`list[1]`相同`list[2]`。
*   因为`Dictionary<TKey, TValue>`没有保证订购。
*   对于`SortedList<TKey, TValue>`（等），它将按关键比较顺序排列——这就是类型的重点。
*   数组总是按元素顺序出现。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-04T21:28:48.610

为了具体回答这个问题，“foreach”返回 . [GetEnumerator](http://toolStrip) () 返回。对于列表，这是您将内容添加到末尾的顺序。对于字典，它可能是分配事物的存储桶的顺序。

# asp.net - 注销按钮 IIS6 ASP.NET 基本身份验证

> ID：612488
> 
> 赞同：3
> 
> 时间：2009-03-04T21:23:01.900
> 
> 标签：asp.net, iis, session, iis-6, basic-authentication

我需要为 ASP.NET Web 应用程序中的用户提供显式注销按钮。我正在使用带有基本身份验证 (SSL) 的 IIS6。我可以重定向到另一个网页，但浏览器使会话保持活动状态。我四处搜索并找到了一种方法，方法是启用一个活动的 x 控件与 IIS 通信并终止会话。我在一个不允许表单身份验证的受限环境中，也不禁止活动 x 控件。有没有其他人有这个要求，你是如何处理的？

好吧，这就是我害怕的。我在网上看到过类似的答案，我希望有人有办法做到这一点。不过，感谢您的时间。我想我可以使用 javascript 来防止像 history.back() 这样的后退按钮

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2010-03-24T09:42:06.550

我自己为此苦苦挣扎了几天。

使用特定于 IE 的“ `document.execCommand('ClearAuthenticationCache');`”并不是每个人的好选择：1）它会刷新所有凭据，这意味着例如用户还将从他的 gmail 或他当前已通过身份验证的任何其他网站注销 2）它只是 IE ;）

我尝试使用 Session.Abandon()，然后重定向到我的 Default.aspx。仅此是不够的。您需要明确告诉浏览器发出的请求未经授权。你可以通过使用类似的东西来做到这一点：

```
response.StatusCode = 401;
response.Status = "401 Unauthorized";
response.AddHeader("WWW-Authenticate", "BASIC Realm=my application name");
resp.End(); 
```

这将导致以下结果：用户单击注销按钮 ==> 他将获得基本登录窗口。但是：如果他按下退出（登录对话框消失）并点击刷新，浏览器会自动再次发送凭据，导致用户登录，尽管他可能认为他已经注销。

**解决这个问题的诀窍是总是吐出一个独特的“领域”**。然后浏览器不会在上述情况下重新发送凭据。我选择吐出当前日期和时间。

```
response.StatusCode = 401;
response.Status = "401 Unauthorized";
string realm = "my application name";                
response.AddHeader("WWW-Authenticate", string.Format(@"BASIC Realm={0} ({1})", realm, DateTimeUtils.ConvertToUIDateTime(DateTime.Now)));
resp.End(); 
```

您需要做的另一件事是告诉浏览器不要缓存页面：

```
Response.Cache.SetCacheability(HttpCacheability.NoCache);
Response.Cache.SetExpires(DateTime.MinValue);
Response.Cache.SetNoStore(); 
```

有了所有这些东西，它（对我来说）在 IE 中工作，但直到现在我仍然无法阻止 Firefox 在用户第一次按下转义键（隐藏基本登录对话框）然后刷新（F5 ) 或浏览器的后退按钮。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-04T21:29:25.193

该[`Session.Abandon`](http://msdn.microsoft.com/en-us/library/ms524310.aspx)方法销毁存储在 Session 对象中的所有对象并释放它们的资源。如果您不显式调用 Abandon 方法，则服务器会在会话超时时销毁这些对象。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-04T21:27:48.287

您是否尝试过调用 Session.Abandon 以响应按钮单击？

**编辑**：

这似乎是一个经典的后退按钮问题。

对于后退按钮，您几乎无能为力。想象一下，用户刚刚在一个新窗口中打开了当前页面，然后单击了 logOut 按钮，该页面似乎退出了，但它不会立即影响另一个窗口的内容。

只有当他们尝试在该窗口中的某个位置导航时，他们的会话才会明显消失。

许多浏览器以类似（尽管不相同）的方式实现后退按钮。返回上一页不一定是 HTML/HTTP 观点的导航。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-02-02T18:24:26.653

这是适用于 IE6 及更高版本的此问题的解决方案。

```
<asp:LinkButton ID="LinkButton1" runat="server" OnClientClick="logout();">LinkButton</asp:LinkButton>

<script>

    function logout()
    {
    document.execCommand("ClearAuthenticationCache",false);
    }
 </script> 
```

[从http://msdn.microsoft.com/en-us/library/bb250510%28VS.85%29.aspx](http://msdn.microsoft.com/en-us/library/bb250510%28VS.85%29.aspx)找到这个

网络团队简而言之，请提供您的凭据

问：Jerry B. 写道，“在用户验证并处理了他的请求后，我现在想使他无效。假设这台机器处于一个任何人都可以走上来和我们一起走的开放环境中，我想给每个人一个新的挑战用户访问 Web 上特定模块的时间。”

答：这是 Internet Explorer 团队经常要求的功能，那里的好人为我们提供了在 Internet Explorer 6.0 SP1 中实现此功能的方法。您需要做的就是在文档上调用 execCommand 方法，将 ClearAuthenticationCache 作为命令参数传入，如下所示：

```
document.execCommand("ClearAuthenticationCache"); 
```

此命令会刷新缓存中的所有凭据，这样如果用户请求需要身份验证的资源，则会再次出现身份验证提示。

我把它放在我的注销链接按钮上，它适用于 IE6 sp1 及更高版本：

```
OnClientClick="document.execCommand('ClearAuthenticationCache');" 
```

# silverlight - Silverlight MediaElement 云

> ID：612494
> 
> 赞同：1
> 
> 时间：2009-03-04T21:24:39.417
> 
> 标签：silverlight, mediaelement, deepzoom

有人知道我在哪里可以获得类似于 mojaveexperiment.com 的示例 silvelight mediaelement 云吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-05T15:44:02.880

答案和源代码示例在[这里](http://bigpicture.codeplex.com/Release/ProjectReleases.aspx?ReleaseId=12146#ReleaseFiles)

在代码中：而不是

```
 Uri collectionUri;
        if (Uri.TryCreate(App.Current.Host.Source, "/Collection/items.bin", out collectionUri))
            image.Source = collectionUri; 
```

有

```
 Uri collectionUri;
        if (Uri.TryCreate(App.Current.Host.Source, "/Collection/items.bin", out collectionUri))
            msi.Source = new DeepZoomImageTileSource(collectionUri); 
```

[在此处](http://silverlight.net/forums/p/56997/145373.aspx#145373)找到与同一问题相关的线程

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-05T13:55:18.380

MojaveExperiment 使用 Vertigo BigPicture

公司网站在[这里](http://www.vertigo.com/deepzoom.aspx)

# sifr - SIFR：多少算太多？

> ID：612505
> 
> 赞同：2
> 
> 时间：2009-03-04T21:25:41.240
> 
> 标签：sifr

第一次在这里发布海报，使用“ `sifr3-r436`”构建。

我正在我公司的网站上工作，并决定是时候开始使用一些 SIFR 技术了。到目前为止，我已经能够很容易地弄清楚它，除了一两个问题。基本上，我有两个迫切的问题想要回答。

1) 多少 SIFR 被认为是“好的”？虽然我只使用 SIFR 作为标题，但根据常见问题解答/演练中的建议，我仍然有大量文本想要转换为 SIFR。请查看[该网站](http://www.holidayvacations.net/test)以了解我使用了多少 SIFR（Rockwell 字体标题和副标题）。这太多了吗？

2) 如何使用 SIFR 控制字体颜色？显然我知道你可以在' `sifr-config.js`'文件中设置它。但是，我想使用许多不同颜色的标题。我目前正在这样做：

```
sIFR.replace(rockwell, {
selector: '.h3_sifr', css: '.sIFR-root { font-size: 18px; background-color: #a63f03; color: #bf7e04;}', forceSingleLine: true, wmode: 'transparent', tuneHeight: -5,
});
sIFR.replace(rockwell, {
selector: '.h3_sifr_green', css: '.sIFR-root { font-size: 18px; background-color: #FFFFFF; color: #597704;}', forceSingleLine: true, wmode: 'transparent', tuneHeight: -5,
});
sIFR.replace(rockwell, {
selector: '.h3_sifr_maroon', css: '.sIFR-root { font-size: 18px; background-color: #FFFFFF; color: #330000;}', forceSingleLine: true, wmode: 'transparent', tuneHeight: -5,
});
sIFR.replace(rockwell, {
selector: '.h3_sifr_blue', css: '.sIFR-root { font-size: 18px; background-color: #FFFFFF; color: #005995;}', forceSingleLine: true, wmode: 'transparent', tuneHeight: -5,
});
sIFR.replace(rockwell, {
selector: '.h3_sifr_cruise', css: '.sIFR-root { font-size: 18px; background-color: #FFFFFF; color: #016EA1;}', forceSingleLine: true, wmode: 'transparent', tuneHeight: -5,
});
sIFR.replace(rockwell, {
selector: '.h3_sifr_australia', css: '.sIFR-root { font-size: 18px; background-color: #FFFFFF; color: #277c5d;}', forceSingleLine: true, wmode: 'transparent', tuneHeight: -5,
});
sIFR.replace(rockwell, {
selector: '.h3_sifr_intl', css: '.sIFR-root { font-size: 18px; background-color: #FFFFFF; color: #1b2f15;}', forceSingleLine: true, wmode: 'transparent', tuneHeight: -5,
});
sIFR.replace(rockwell, {
selector: '.h3_sifr_us', css: '.sIFR-root { font-size: 18px; background-color: #FFFFFF; color: #32588b;}', forceSingleLine: true, wmode: 'transparent', tuneHeight: -5,
});
sIFR.replace(rockwell, {
selector: '.h3_sifr_hawaii', css: '.sIFR-root { font-size: 18px; background-color: #FFFFFF; color: #4a1e52;}', forceSingleLine: true, wmode: 'transparent', tuneHeight: -5,
});
sIFR.replace(rockwell, {
selector: '.h3_sifr_rail', css: '.sIFR-root { font-size: 18px; background-color: #FFFFFF; color: #304c2a;}', forceSingleLine: true, wmode: 'transparent', tuneHeight: -5,
});
sIFR.replace(rockwell, {
selector: '.h3_sifr_canada', css: '.sIFR-root { font-size: 18px; background-color: #FFFFFF; color: #0a2754;}', forceSingleLine: true, wmode: 'transparent', tuneHeight: -5,
});
sIFR.replace(rockwell, {
selector: '.h3_sifr_alaska', css: '.sIFR-root { font-size: 18px; background-color: #FFFFFF; color: #083c4b;}', forceSingleLine: true, wmode: 'transparent', tuneHeight: -5,
});
sIFR.replace(rockwell, {
selector: '.h3_sifr_sadc', css: '.sIFR-root { font-size: 18px; background-color: #FFFFFF; color: #630002;}', forceSingleLine: true, wmode: 'transparent', tuneHeight: -5,
});
sIFR.replace(rockwell, {
selector: '.h3_sifr_easternus', css: '.sIFR-root { font-size: 18px; background-color: #FFFFFF; color: #8b3100;}', forceSingleLine: true, wmode: 'transparent', tuneHeight: -5,
});
sIFR.replace(rockwell, {
selector: '.h3_sifr_lightgray', css: '.sIFR-root { font-size: 18px; background-color: #FFFFFF; color: #999999;}', forceSingleLine: true, wmode: 'transparent', tuneHeight: -5,
});
sIFR.replace(rockwell, {
selector: '.h3_sifr_medgray', css: '.sIFR-root { font-size: 18px; background-color: #FFFFFF; color: #666666;}', forceSingleLine: true, wmode: 'transparent', tuneHeight: -5,
});
sIFR.replace(rockwell, {
selector: '.h3_sifr_darkgray', css: '.sIFR-root { font-size: 18px; background-color: #FFFFFF; color: #333333;}', forceSingleLine: true, wmode: 'transparent', tuneHeight: -5,
});
sIFR.replace(rockwell, {
selector: '.h3_sifr_extended', css: '.sIFR-root { font-size: 18px; background-color: #FFFFFF; color: #175700;}', forceSingleLine: true, wmode: 'transparent', tuneHeight: -5,
});
sIFR.replace(rockwell, {
selector: '.h3_sifr_orange', css: '.sIFR-root { font-size: 18px; background-color: #FFFFFF; color: #a63f03;}', forceSingleLine: true, wmode: 'transparent', tuneHeight: -5,
}); 
```

现在，正如您所看到的，我能够使用不同颜色的唯一方法是通过对每种颜色的单独替换语句。我尝试更改颜色“内联”（即，`<span class="h3_sifr" style="color:#123456></span>`），但这不起作用。有小费吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-05T09:54:23.890

我认为您使用的 sIFR 有点过多。尝试将其限制为仅主要标题，并且不要替换链接。

CSS 问题有点棘手，没有简单的答案。您可以将其他共享属性复制到`rockwell`对象，因此您不必重复这些。

`forceSingleLine`还要尽量避免使用透明度，我认为你不需要使用。

# floating-point - 80 位扩展精度数据类型的应用/好处是什么？

> ID：612507
> 
> 赞同：15
> 
> 时间：2009-03-04T21:25:45.187
> 
> 标签：floating-point, ieee-754, x87, long-double, extended-precision

是的，我的意思是说*80-bit*。那不是笔误...

我在浮点变量方面的经验总是涉及 4 字节的倍数，比如单数（32 位）、双数（64 位）和长双数（我曾见过它被称为 96 位或 128 位）。这就是为什么当我在编写一些代码以读取和写入[AIFF（音频交换文件格式）文件](http://en.wikipedia.org/wiki/Audio_Interchange_File_Format)时遇到[80 位扩展精度数据类型](http://en.wikipedia.org/wiki/Extended_precision)时有点困惑：选择了扩展精度变量来存储采样音轨的速率。

当我浏览 Wikipedia 时，我发现上面的链接以及[IEEE 754-1985 标准](http://en.wikipedia.org/wiki/IEEE_754-1985)摘要中的 80 位格式的简要说明（但不在[IEEE 754-2008 标准](http://en.wikipedia.org/wiki/IEEE_754)摘要中）。似乎在某些架构上“扩展”和“长双”是同义词。

我没有遇到的一件事是使用扩展精度数据类型的特定应用程序（当然，AIFF 文件采样率除外）。这让我想知道：

*   有没有人遇到过扩展精度对于某些编程应用程序是必要/有益的情况？
*   80 位浮点数的好处是什么，除了明显的“它比 double 精度高一点，但比 long double 的大多数实现少字节”？
*   它的适用性正在减弱吗？

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2009-03-04T21:56:43.350

英特尔的 FPU 在内部使用 80 位格式来获得更高的中间结果精度。

也就是说，你可能有 32 位或 64 位的变量，但是当它们被加载到 FPU 寄存器中时，它们会被转换为 80 位；FPU 然后（默认情况下）在 80 中执行所有计算，但是；计算后，将结果存储回 32 位或 64 位变量中。

顺便说一句 - 一个有点不幸的结果是调试和发布构建可能会产生稍微不同的结果：在发布构建中，优化器可能会在 80 位 FPU 寄存器中保留一个中间变量，而在调试构建中，它将被存储在 64 位变量中，导致精度损失。您可以通过使用 80 位变量来避免这种情况，或者使用 FPU 开关（或编译器选项）以 64 位执行所有计算。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2012-03-30T13:23:08.287

对我来说，使用 80 位是必不可少的。这样，当使用 GOTO 库进行矢量内积时，我得到对称矩阵的高阶 (30,000) 特征值和特征向量，还有四个数字，即，对于我在相对论原子中使用的那种矩阵，我使用 13 个有效数字而不是 9 个有效数字计算，这是避免掉入负能量状态的海洋所必需的。我的另一个选择是使用四倍精度算法，它将 CPU 时间增加 60-70 倍，同时也增加了 RAM 需求。任何依赖于大向量内积的计算都会受益。当然，为了将部分内积结果保存在寄存器中，有必要使用汇编语言，就像在 GOTO 库中一样。这就是我爱上我的旧 Opteron 850 处理器的原因，

80 位速度快，而精度更高却慢得多的原因是 CPU 的标准浮点硬件具有 80 位寄存器。因此，如果您想要额外的 16 位（11 位额外的尾数、4 位额外的指数和 1 位有效未使用的额外位），那么从 64 位扩展到 80 位实际上并不会花费太多——而扩展就运行时间而言，超过 80 位的成本非常高。因此，如果您愿意，不妨使用 80 位精度。使用它不是免费的，但它相当便宜。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-03-04T21:56:35.033

[维基百科解释](http://en.wikipedia.org/wiki/Extended_precision)说 80 位格式可以表示整个 64 位整数而不会丢失信息。因此CPU的浮点单元可以用来实现整数的乘法和除法。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2015-02-17T18:01:33.873

80 位类型尚未提及的另一个优点是，在 16 位或 32 位处理器上，它们没有浮点单元但确实有一个“乘法”指令，它产生的结果是操作数的两倍（16x16 ->32 或 32x32->64)，将 64 位尾数细分为四个或两个 16 位或 32 位寄存器的算术将比 53 位尾数上的算术更快，后者跨越相同数量的寄存器但具有与符号和指数共享 12 个寄存器位。对于不需要比 更精确的应用程序，`float`48 位“扩展浮点”类型的计算同样可能比 32 位`float`.

虽然有些人可能会抱怨扩展精度类型的双舍入行为，但实际上这只是需要完全位精确跨平台再现性的专业应用程序中的问题。从*准确性*的角度来看，64/128 与 65/128 或 1024/2048ulp 与 1025/2048 的舍入误差之间的差异不是问题；在具有*扩展精度变量类型*和*一致的扩展精度语义的语言*中，在许多没有浮点硬件的平台（例如嵌入式系统）上使用扩展类型将提供比单精度或双精度浮点更高的精度和更快的速度类型。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-01-18T17:07:48.760

我使用 80 位进行一些纯数学研究。我不得不对一个变得非常大的无限级数求和，超出了双精度数的范围。收敛性和准确性不是问题，只是处理像 1E1000 这样的大指数的能力。也许一些聪明的代数可以简化一些事情，但是仅仅编写一个具有扩展精度的算法要比花任何时间思考它更快、更容易。

# asp.net - Accessing the object/row being edited in Dynamic Data

> ID：612509
> 
> 赞同：3
> 
> 时间：2009-03-04T21:25:54.077
> 
> 标签：asp.net, dynamic-data

I'm modifying the "Edit.aspx" default page template used by ASP.NET Dynamic Data and adding some additional controls. I know that I can find the type of object being edited by looking at `DetailsDataSource.GetTable().EntityType`, but how can I see the actual object itself? Also, can I change the properties of the object and tell the data context to submit those changes?

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-18T11:13:21.740

也许您已经找到了解决方案，但是我想分享我对此的经验。

结果证明这是一个很棒的皮塔饼，但我设法获得了编辑行。我必须提取 DetailsDataSource WhereParameters，然后在运行时创建查询。

下面的代码适用于具有单个主键的表。如果你有复合键，我猜，它需要修改：

```
Parameter param = null;
foreach(object item in (DetailsDataSource.WhereParameters[0] as DynamicQueryStringParameter).GetWhereParameters(DetailsDataSource)) {
    param = (Parameter)item;
    break;
}

IQueryable query = DetailsDataSource.GetTable().GetQuery();
ParameterExpression lambdaArgument = Expression.Parameter(query.ElementType, "");
object paramValue = Convert.ChangeType(param.DefaultValue, param.Type);
Expression compareExpr = Expression.Equal(
    Expression.Property(lambdaArgument, param.Name),
    Expression.Constant(paramValue)
);
Expression lambda = Expression.Lambda(compareExpr, lambdaArgument);
Expression filteredQuery = Expression.Call(typeof(Queryable), "Where", new Type[] { query.ElementType }, query.Expression, lambda);
var WANTED = query.Provider.CreateQuery(filteredQuery).Cast<object>().FirstOrDefault<object>(); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-12T23:28:07.137

如果它是 DD 对象，您可以使用 FieldTemplateUserControl.FindFieldTemplate(controlId)。然后，如果需要，可以将其转换为 ITextControl 来操作数据。

否则，请尝试使用此扩展方法查找子控件：

```
 public static T FindControl<T>(this Control startingControl, string id) where T : Control
    {
        T found = startingControl.FindControl(id) as T;

        if (found == null)
        {
            found = FindChildControl<T>(startingControl, id);
        }

        return found;
    } 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2015-07-24T02:42:00.493

我找到了另一个解决方案，其他的都不起作用。
就我而言，我已将 Edit.aspx 复制到 /CustomPages/Devices/中，
其中**Devices**是我想要此自定义行为的表的名称。

将此添加到 Edit.aspx -> Page_Init()

```
DetailsDataSource.Selected += entityDataSource_Selected; 
```

在 Edit.aspx 中添加：

```
protected void entityDataSource_Selected(object sender, EntityDataSourceSelectedEventArgs e)
{
    Device device = e.Results.Cast<Device>().First();       
    // you have the object/row being edited !
} 
```

只需将 Device 更改为您自己的表名。

# jquery - 如何解释从 jQuery.ajax 返回的 JSON 并使用 POST 操作？

> ID：612515
> 
> 赞同：4
> 
> 时间：2009-03-04T21:27:30.610
> 
> 标签：jquery, json, post

我有以下 jQuery 代码：

```
$.ajax({
    type: "POST",
    url: "Services/MyService.asmx/Select",
    dataType: "json",
    data: "{'data':'test'}",
    contentType: "application/json; charset=utf-8",
    success: function(msg){ 
                alert(msg); 
             },
    error: function(xhr){ alert(xhr.statusText);}                
}); 
```

对该方法的调用返回以下内容：

```
"{"FirstName":"James"}" 
```

当我取回值时，我的警报会返回完整的 json 字符串。如果我尝试这样做`alert(msg.FirstName)`，我会得到“未定义”。

我见过很多使用 getJSON() 方法的例子；但是，我还没有看到将其用于 POST 动词的方法。谁能指出我出错的正确方向？根据 jquery 文档，返回值应该是相同的 dataType (json)，所以我不确定我缺少什么。

编辑：我查看了我的服务，它与我在返回字符串的方法签名方面找到的示例相匹配。我还确认响应类型是 application/json。

EDIT2：更新了响应以包含外部引号。我还使用自定义 JavaScriptConverter 来进行 JSON 序列化。自定义转换器只获取我的对象属性（在本例中为 FirstName）并将其加载到 Dictionary 集合中，ASP.Net AJAX Extensions v1.0 可以轻松地对其进行序列化。

EDIT3：查看我在使用 eval() 时遇到的问题（它导致了一个`Expected ";"`错误），我注意到 json 属性名称也用引号引起来。一旦我从属性名称（而不是值）中删除引号， eval() 就会再次起作用。现在研究这个问题的服务器端。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-04T22:03:21.493

jQuery 的`.ajax`使用看起来很可靠。您如何验证返回的数据？萤火虫？提琴手？因为`.asmx`web 服务不会返回像`{"FirstName":"James"}`. 响应看起来更像：

```
{"d":{"FirstName":"James"}} 
```

（见[http://encosia.com/2008/03/27/using-jquery-to-consume-aspnet-json-web-services/](http://encosia.com/2008/03/27/using-jquery-to-consume-aspnet-json-web-services/)）

对于您的`success`回调，请尝试：

```
function(res) { alert(res.d.FirstName) } 
```

* * *

**编辑**：看到您的更新并评论 ASP.Net AJAX 的 v1.0：

我不确定 v1.0 如何序列化您的响应，但我的猜测是，如果您在 WebService 方法中进行自己的自定义 JSON 序列化，响应可能会*再次*获得 JSON 序列化。所以你要序列化两次。

我相信你正在使用的所有组件都在做他们应该做的事情，现在你的`success`回调需要手动取消序列化，因为你在服务器上手动序列化：

```
function(res) {
    res = eval('(' + res + ')');
    alert(res.FirstName);
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-04T22:18:25.793

IIRC 您可以评估字符串，结果将是 json 对象。

myJSON = eval(jsonString);

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-04T21:31:29.260

您可以使用 JSON 对象作为第二个参数来定义您的 post 变量。

例子：

```
$.getJSON("service.py",
    { foo: bar },
    function(data) {
        $.each(data, function() { // blah });
    }
); 
```

* * *

编辑：我明白你现在的意思了。您的服务是否将“something/json”作为 MIME 类型返回？如果您正在查看 Firebug 中的响应标头，它应该看起来像这样：

```
Content-Type    application/json; charset=utf-8 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-05T13:45:35.003

您不能`$getJSON`与通过`System.Web.Extensions`. 您正在使用 正确拨打电话`$.ajax()`。

您是否尝试过使用 Firebug 在成功处理程序中设置断点并检查*msg*值？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-16T16:58:38.797

尝试这样的事情：

```
 result = eval('(' + result.d + ')'); 
```

# visual-studio - Visual Studio switch 语句格式

> ID：612516
> 
> 赞同：31
> 
> 时间：2009-03-04T21:27:35.430
> 
> 标签：visual-studio

我正在使用 Visual Studio 2005。它总是希望像这样格式化 switch 语句：

```
switch (thing)
{
case A:
  stuff;
  break;

case B:
  things;
  break;
} 
```

有没有办法让它缩进这样的案例？：

```
switch (thing)
{
  case A:
    stuff;
    break;

  case B:
    things;
    break;
} 
```

* * *

## 回答 #1

> 赞同：50
> 
> 时间：2009-03-04T21:29:36.893

到这里：

> `Tools > Options > Text Editor > C# > Formatting > Indentation > Indent case labels`

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-04T21:32:08.323

工具 | 选项 | 文本编辑器 | c# -> 选中“标识块内容”复选框。

# java - RMI 和异常

> ID：612520
> 
> 赞同：18
> 
> 时间：2009-03-04T21:28:37.800
> 
> 标签：java, networking, rmi

我是使用 RMI 的新手，我对使用异常也比较陌生。

我希望能够在 RMI 上引发异常（这可能吗？）

我有一个为学生提供服务的简单服务器，并且我有删除方法，如果学生不存在，我想抛出一个自定义异常 StudentNotFoundException 扩展 RemoteException（这是一件好事吗？）

任何建议或指导将不胜感激。

服务器接口方法

```
 /**
 * Delete a student on the server
 * 
 * @param id of the student
 * @throws RemoteException
 * @throws StudentNotFoundException when a student is not found in the system
 */
void removeStudent(int id) throws RemoteException, StudentNotFoundException; 
```

服务器方法实现

```
 @Override
public void removeStudent(int id) throws RemoteException, StudentNotFoundException
{
    Student student = studentList.remove(id);

    if (student == null)
    {
        throw new StudentNotFoundException("Student with id:" + id + " not found in the system");
    }
} 
```

客户端方法

```
 private void removeStudent(int id) throws RemoteException
{
    try
    {
        server.removeStudent(id);
        System.out.println("Removed student with id: " + id);
    }
    catch (StudentNotFoundException e)
    {
        System.out.println(e.getMessage());
    }

} 
```

StudentNotFoundException

```
package studentserver.common;

import java.rmi.RemoteException;

public class StudentNotFoundException extends RemoteException
{
    private static final long serialVersionUID = 1L;

    public StudentNotFoundException(String message)
    {
        super(message);
    }
} 
```

感谢您的回复我现在已经设法解决了我的问题并意识到扩展 RemoteException 是个坏主意。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-03-04T21:35:26.037

可以抛出任何类型的异常（甚至是自定义异常），只要确保将它们打包到您的导出 .jar 文件中（如果您使用的是需要手动执行此操作的 Java 版本）。

不过，我不会继承 RemoteException。如果存在某种连接问题，通常会抛出这些问题。据推测，您的客户端处理连接问题的方式与其他类型的问题不同。当您捕获 RemoteException 或连接到不同的服务器时，您可能会告诉用户服务器已关闭。对于 StudentNotFoundException，您可能希望给用户另一个机会来输入学生信息。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-04T21:36:58.200

是的，可以通过 RMI 抛出异常。

`RemoteException`不，扩展以报告应用程序故障不是一个好主意。`RemoteException`表示远程机制中的故障，例如网络故障。使用适当的例外，`java.lang.Exception`必要时扩展自己。

有关更详细的解释，[请查看我的另一个答案](https://stackoverflow.com/questions/351205/bad-idea-to-chain-exceptions-with-rmi/351279#351279)。简而言之，在使用 RMI 时要小心链接异常。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-04T21:37:53.550

> 我希望能够在 RMI 上引发异常（这可能吗？）

是的。任何东西都可以被序列化，即使是例外。我认为异常本身实现了可序列化。

> 我有一个为学生提供服务的简单服务器，并且我有删除方法，如果学生不存在，我想抛出一个自定义异常 StudentNotFoundException 扩展 RemoteException（这是一件好事吗？）

我会让它亲自扩展异常。您的例外就是您的例外，RemoteExceptions 是针对因连接原因而导致 RMI 出错的事情。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-04T21:36:04.473

您的异常无需扩展`RemoteException`.

（值得注意的是，抛出的具体异常类型需要在服务器和客户端都使用的代码库中。）

# java - Java 或 Apache Commons 中是否有 varargs null 检查功能？

> ID：612521
> 
> 赞同：10
> 
> 时间：2009-03-04T21:28:43.790
> 
> 标签：java, validation, null, variadic-functions

我有四个变量，我想检查其中任何一个是否为空。我可以

```
if (null == a || null == b || null == c || null == d) {
    ...
} 
```

但我真正想要的是

```
if (anyNull(a, b, c, d)) {
    ...
} 
```

但我不想自己写。这个函数是否存在于任何常见的 Java 库中？我检查了 Commons Lang 并没有看到它。它应该使用可变参数来接受任意数量的参数。

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-03-04T21:30:28.730

不知道是不是公用的，但是大概需要十秒的时间来写：

```
public static boolean anyNull(Object... objs) {
    for (Object obj : objs)
        if (obj == null)
            return true;
    return false;
} 
```

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-03-04T21:32:59.850

我认为使用 Java 库可以做的最好的事情是：

```
if (asList(a, b, c, d).contains(null)) { 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-07T23:55:37.423

您在评论中询问将静态助手放在哪里，我建议

```
public class All {
    public static final boolean notNull(Object... all) { ... }
} 
```

然后使用限定名进行调用，如

```
assert All.notNull(a, b, c, d); 
```

然后可以使用类`Any`和方法（如`isNull`.

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2016-09-14T12:11:46.713

在 Java 8 中，你可以用更优雅的方式做到这一点：

```
if (Stream.of(a, b, c, d).anyMatch(Objects::isNull)) { ... } 
```

或者您可以将其提取到一个方法中：

```
public static boolean anyNull(Object... objects) {
    return Stream.of(objects).anyMatch(Objects::isNull);
} 
```

然后在你的代码中使用它，如下所示：

```
if (anyNull(a, b, c, d)) { ... } 
```

# c# - How much of .NET is unmanaged?

> ID：612526
> 
> 赞同：4
> 
> 时间：2009-03-04T21:29:29.700
> 
> 标签：c#, .net, unmanaged, managed

Frequently when I am using the Reflector, I come across lots of unsafe code. Anyone knows how much of .NET is unmanaged/safe?

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-04T21:32:11.800

There are many instances of PInvoke that just call Win32 APIs. However, there is some functionality that is implemented in the CLR itself (e.g. Interlocked operations). If you want to see how this is done, look at [Rotor](http://www.google.com/url?sa=t&source=web&ct=res&cd=1&url=http%3A%2F%2Fen.wikipedia.org%2Fwiki%2FShared_Source_Common_Language_Infrastructure&ei=SfOuScaxJ5f2MdK7iN4E&usg=AFQjCNGeJeb2QiFnCNo8u5UiOcii0m33Rg&sig2=ywkPeee5klvMN3bVJaMnbA).

I go into a detailed explanation of locking (viewing the Rotor source) in [this post](http://www.moserware.com/2008/09/how-do-locks-lock.html) on my blog.

To specifically answer your question, you'd have to get all the .NET source code (e.g. use [NetMassDownloader](http://www.codeplex.com/NetMassDownloader) and grep for lines that say "InternalCall" or "DllImport") and compare that with the count of all lines. Perhaps you could multiply each of these "unmanaged" lines by some factor to guess, or you'd have to dive into Rotor or the Windows source code to get the actual numbers. If you went this far then things will get fuzzy (e.g. if File.Open calls Win32's CreateFile, then should CreateFile be counted towards .NET? I think not). So, at best you'd only multiply the "InternalCall"s by some factor to guess.

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-04T21:34:55.053

This is a really difficult question to answer. Unsafe code is easy to quantify in the sense that it exists in the binary and can be measured in terms of IL instructions.

Real unmanaged code, say PInvoke or COM, do have code in the binary but it is insignificant. It represents only the minimal stub necessary to call into the native function. This means you can't really measure how much native code is being excercised in a managed DLL. All you can do is measure the number of calls which provides no real measure of how much unmanaged code is executing.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-04T21:33:59.083

Much of System.Windows.Forms calls into the unmanaged windows API, but I have not found the need to manually dispose of objects I create in this namespace.

When using the System.IO.FileStream class (also calls into unmanaged code), make sure you call Dispose when you are done so you can guarantee the file gets closed right there and then instead of when the finalizer executes.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-04T21:30:50.243

It doesn't really matter as the unsafe calls are wrapped by the corresponding .NET objects. What you need to be concerned about is resource allocation and disposing of objects that implement IDisposable.

# javascript - Sharepoint - How to remove link from Javascript form within List

> ID：612533
> 
> 赞同：1
> 
> 时间：2009-03-04T21:31:40.710
> 
> 标签：javascript, sharepoint, list, hyperlink

We have a sharepoint Aspx form that is formatted like an excel spreadsheet. On each row of the form are links that when clicked, launch a script to show new links, allowing the user to add, view, or hide comments. This will appear for each line item clicked on.

We would like to remove the "add comment" link from the script, but cannot find anywhere to do so in both Sharepoint or Sharepoint Designer.

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-27T00:13:48.360

您可以使用 JavaScript 删除任何 HTML 元素，您只需要能够定位它。

请参阅[getElementById](https://developer.mozilla.org/en/DOM/document.getElementById)和[getElementsByTagName](https://developer.mozilla.org/en/DOM/document.getElementsByTagName)进行定位，然后参阅[Node.removeChild](https://developer.mozilla.org/En/DOM/Node.removeChild)将其从文档中删除。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-28T11:18:06.013

要通过客户端删除它，是的，您可以尝试一些 JS 或 CSS，但您发现很难找到唯一的句柄。Firebug 将帮助查看是否可用。但是您可能需要查看 Schema.xml

您可以使用 Sharepoint Manager [http://www.codeplex.com/spm找到它](http://www.codeplex.com/spm)

交替查看 onet.xml

# sql-server - T-SQL 全局/共享数据

> ID：612542
> 
> 赞同：0
> 
> 时间：2009-03-04T21:34:39.127
> 
> 标签：sql-server, tsql

在编写 TSQL 存储过程时，我发现自己想要集中/规范化代码的某些部分。例如，如果我有这样的查询：

```
SELECT * FROM SomeTable WHERE SomeColumn IN (2, 4, 8) 
```

对于这样的情况，我想将 (2,4,8) 放在过程之外的某个地方，以便稍后在其他查询中重用——以避免重复。有没有内置的方法可以做到这一点？如果我可以分解整段 SQL 代码（如 WHERE 子句的一部分）并在其他查询中重用这些代码，那将是真正整洁的，但我怀疑这是可能的。

谢谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-04T21:39:13.453

我经常想要类似的东西，但具体不存在。*以下是您可以*做的几件事。

**选项1**

我们所做的是使用用户定义函数 (UDF) 来收集您可能称之为全局变量的内容。

您可以在查询中调用 UDF 内联，这非常有用。

假设您想指定一个跨多个存储过程使用的服务器名称。复制该值将无法以最佳方式维护。相反，您可能会执行以下操作：

```
select * from clientNodes where serverName = dbo.SOME_SERVER_NAME() 
```

**选项 2**

这个比较明显，但值得指出。将您的值保存在查找表中并通过 ID 引用它。ID 不会改变，但它引用的值可能会改变。使用上面的示例示例，但对于此选项：

```
Table: Servers
Columns: ServerID, ServerName

declare @serverName varchar(50)
select @serverName = ServerName from Servers where ServerID = 1 
```

这是一种典型的数据库规范化方法，但人们不一定会出于保持数据库逻辑数据集中的目的考虑这一点。

我希望这会有所帮助！伊恩

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-04T21:44:26.327

对于 SQL Server 2005，您可以考虑使用表值函数。

例如：

```
SELECT ... FROM SomeTable INNER JOIN SomeFunction() F ON SomeTable.SomeColumn = F.Id

...

CREATE FUNCTION SomeFunction()
RETURNS @IdTable TABLE (Id INT)
AS
RETURN
(
    SELECT 2 Id
    UNION ALL
    SELECT 4 
    UNION ALL
    SELECT 8
) 
```

更常见的是，您可能希望将值作为参数传递给存储过程。您可以将其作为逗号分隔的字符串来执行。例如

```
EXEC MyProcedure('2,4,8')

...

CREATE PROCEDURE MyProcedure
(
   @IdString AS VARCHAR(MAX)
)
AS
BEGIN
    SELECT ... FROM SomeTable INNER JOIN SomeFunction(@IdString) F ON SomeTable.SomeColumn = F.Id
END

...

CREATE FUNCTION dbo.SomeFunction
(
  @IdString VARCHAR(MAX)
)
RETURNS @IdTable TABLE (Id INT)
AS
BEGIN
    DECLARE @CommaIndex INT, @TotalLength INT, @StartIndex INT, @Id VARCHAR(10)
    SET @TotalLength=LEN(@IdString)
    SET @StartIndex = 1

    WHILE @StartIndex <= @TotalLength
    BEGIN
        SET @CommaIndex = CHARINDEX(',', @IdString, @StartIndex)
        IF @CommaIndex > 0
        BEGIN
            SET @Id = SUBSTRING(@IdString, @StartIndex, @CommaIndex-@StartIndex)
            SET @StartIndex = @CommaIndex + 1
        END
        ELSE
        BEGIN
            Set @Id = SUBSTRING(@IdString, @StartIndex, @TotalLength-@StartIndex+1)
            SET @StartIndex = @TotalLength+1
        END
        INSERT INTO @IdTable
        (Id)
        VALUES
        (CAST(@Id AS INT))
    END

    RETURN
END 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-04T21:59:35.510

你通常会为你想要完成的事情创建一个**视图。**

首先创建一个返回 SomeColumn 值 2、4、8 的函数

```
create function fnSomeTableFilters()
returns @Result table ( ID int not null )
as

begin
    insert  @Result(ID)
    select 2
    union select 4
    union select 8

    return
end
GO 
```

现在创建一个过滤 2,4,8 的视图

```
create view vwFilteredSomeTable
as
select * from SomeTable where SomeColumn in (select ID from dbo.fnSomeTableFilters()) 
```

最后，您的查询变为

```
SELECT * FROM vwFilteredSomeTable 
```

确保给你的视图一个有意义的名字

例如）我有一个名为 vwActiveSites 的视图，用于查询活动站点，顾名思义

```
create view vwActiveSites
as
    select  ...
    from    Sites S
    where   S.Active = 1 
```

这里的美妙之处在于，您使用**vwFilteredSomeTable**的所有查询都不需要更改。如果您需要使用不同的值进行过滤，只需更改*fnSomeTableFilters*

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-04T21:59:52.827

是的 - 使用表格或视图。SomeColumn 是 IN (2, 4, 8) 必须以某种方式对您的数据有意义，因此以这种方式建模。给它一个有意义的名字，你可以自己重用它或加入其他查询。为什么将它埋在 UDF 或类似的东西中？

例如，如果 SomeColumn 是 State 并且值 ('FL', 'GA', 'SC') 是您的东南地区，那么不要传播：

```
 SELECT * FROM SomeTable WHERE State IN ('FL', 'GA', 'SC') 
```

在周围，只需创建一个 Territory 列并完成它。

重复使用静态 WHERE 子句是另一个表或属性（又名概念）只是乞求出来。

# asp.net-mvc - 我应该把我的 asp.net-mvc 强类型视图数据放在哪里？

> ID：612564
> 
> 赞同：6
> 
> 时间：2009-03-04T21:38:50.957
> 
> 标签：asp.net-mvc, conventions, viewdata

我一直在我的控制器中嵌套我的 viewdata 类，随着它们的数量增长，我开始问自己这是否是一个好主意。再说一次，关于用这些东西污染 /Views 和 /Controllers 目录的东西似乎不对。

我在这里缺少一个约定吗？也许是 /ViewData 目录？idk，我的 viewdata 类有哪些好的位置？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-04T21:46:36.367

我不知道有什么约定。我只是把我的放在下面`/Model/ViewModel/BlahViewModel.cs`，等等。在有特定需要之前，我不会把它们放在一个单独的项目中。如果需要，以后移动它们并不困难。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-04T21:46:34.497

我将我的视图数据类放在一个专门用于此的项目中。它们是 DTO，将它们放在自己的项目中强制它们不依赖于架构层中的任何内容。

将它们用作 DTO 来传递给视图只是使用它们的一种方式。我可能会在某个时候通过网络发送它们，在服务总线上的消息中或其他任何地方。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-04T23:36:00.147

我完全按照您的建议做了，我的强类型视图数据位于 /ViewData 中。我考虑将它放在 \Model 目录中，但我不喜欢我的项目有太多嵌套目录。\ViewData 也是[Kigg](http://kigg.codeplex.com/)所做的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-04T23:58:09.407

因为您使用的是 MVC，并且文件夹结构应该代表代码的命名空间结构，所以我建议您对每个对象域都应该将控制器、模型和服务分组到单独的文件夹中

我们会使用

*   域名

    ```
     Controllers
         Model
         Services 
    ```

# .net - Any suggestions for shrinking a PDF file?

> ID：612566
> 
> 赞同：12
> 
> 时间：2009-03-04T21:39:15.153
> 
> 标签：.net, pdf, filesize

We've got a .net 2.0 web system that dynamically builds pdf files. Some of these files can get pretty large - 12MB+. While processing time isn't a factor, really, the size of the files to be downloaded is in some cases.

For the moment, let's assume that our B-grade pdf library is already making the smallest files that it knows how. (Although, if anyone has any suggestions on that front, do see [this related question](https://stackoverflow.com/questions/608724/optimize-abcpdf-file-size).)

However, taking the 12MB file in question and sending it though the Acrobat distiller results in a roughly 700K file, with no appreciable loss in print quality.

I'd love to have some kind of post-processor that does even a third of that. Does anyone have any controls they know about that'll do something like this?

The cheaper the better, for this project, but we're not adverse to throwing a few bucks down.

(Some preemptive comments: naturally, rewriting the existing PDF generation code with a new tool is off the table at the moment. Also, while Distiller seems to have an API, calling that on a webserver doesn't seem like the most efficient course - and Distiller is a little pricey. Finally, we'd just as well not wrap the pdfs in a zip file or some such, since that may baffle the clients somewhat. No, really.)

Thanks!

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-03-04T22:37:30.693

使用*[Ghostscript](http://en.wikipedia.org/wiki/Ghostscript)*，它也可用于 32 位和 64 位 Windows 平台。它识别所有*Adob​​e Distiller*参数 [1] 并[尊重其中的大部分](http://www.ghostscript.com/doc/current/Ps2pdf.htm#Options)。最重要的是，您可以将 PostScript 程序注入到转换过程中。我在图像密集型 PDF 的预印制作环境中使用了一年。如果参数设置正确，文件大小可以从 40MB 下降到 800kB，而没有明显的质量损失。我发现它非常快，实际上文档指出[它可能比 Adob​​e Distiller 更快](http://www.ghostscript.com/doc/current/Ps2pdf.htm#Ps2pdf_vs_AD)。

它是**免费**的（就像啤酒和演讲一样）。

[1] 请参阅*Distiller*帮助文件夹中的*distparm.pdf*或查看[此处](http://www.aces.edu/ctu/compref/acrobat/5.x/Distparm.pdf)。

 *## 你如何使用它

您可以从命令行使用所有想要的参数、输入和输出文件调用它，然后就完成了。

快速示例：

```
gs -dBATCH -dNOPAUSE -sDEVICE=pdfwrite\
   -dCompatibilityLevel=1.3 -dEncodeColorImages=true\
   -sOutputFile=output.pdf input.pdf 
```

一些有价值的资源：

*   [Ghostscript PDF 编写器提示](http://www.ghostscript.com/~ghostgum/pdftips.htm)
*   [Postscript-to-PDF 转换器文档](http://www.ghostscript.com/doc/8.63/Ps2pdf.htm)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-04T21:49:38.733

PDF 通常使用 JBIG/JBIG2/JPEG2000 压缩。Cvision 的[PDFCompressor](http://www.cvisiontech.com/)是压缩 PDF 的最佳选择。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-04T22:27:08.737

有多种风格的 PDF 具有不同大小的功能权衡。如果您要转换基于文本的文档（word/excel/etc）与图像文档（TIFF/JPG/BMP/etc），那么它可能会解释 distiller 为您提供的较小文件大小。您需要确保您的实用程序不仅仅是从所有内容中创建仅图像 PDF 文件（通常更大）。压缩格式也非常重要，特别是对于彩色文档。寻找允许您调整这些设置的配置选项。如果您提到特定的 PDF 构建器工具，我们可能会在这方面为您提供更具体的帮助。

以下是关于 PDF 文件“风味”的不错[参考：](http://blogs.adobe.com/acrolaw/2005/11/understanding_f.html)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2021-03-18T07:24:05.683

大型 PDF 文件有不同的原因。通常的嫌疑人是重复的对象，如图像、不需要的/太大的字体以及太大/压缩不良的图像。

您可以尝试使用市场上可用的 PDF 库之一自己实现压缩实用程序。或者您可以尝试 Docotic.Pdf 库来完成这项任务。我为公司工作，所以你不必信任我 :-) 自己尝试一下，看看它是否对你有帮助。我们有Docotic.Pdf 提供的关于优化手段[的 C# 和 VB.NET 压缩 PDF 文档。](https://bitmiracle.com/pdf-library/compress-pdf.aspx)

免责声明：我知道这个问题已经过时了，但希望我的回答能让那些仍然可以在 SO 上或通过 Google 找到它的人受益。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-04T23:51:33.057

如果您的 pdf 库正在制作次优 PDF，那么在任何其他库中加载和保存 PDF 应该会为您提供更小的文件。 [PDFNet SDK](http://www.pdftron.com/net/index.html) Type 3 应该可以胜任这项任务，360 美元的价格比 Adob​​e PDF 库便宜。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-05T08:16:00.350

Apago 有很多“整理”PDF 的工具

[http://www.apagoinc.com/](http://www.apagoinc.com/)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-04T21:46:53.200

File a bug with the maker of your pdf library? If it's open source, fix a couple of the low hanging fruit (there are probably many) and submit a patch?

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-04T21:48:22.043

I don't have a specific answer to your question, so I hope that my response is not poor form.

I've used [pdftk](http://www.pdfhacks.com/pdftk/) for a variety of PDF-related tasks. It's easy to use from the shell and I see that it does have a compression feature. You could try it out quickly to see if it's something that would work for post processing for your application.

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-03-04T21:53:46.180

如果您对无损压缩感兴趣，请尝试我的工具[Precomp](https://github.com/schnaader/precomp-cpp)和您选择的文件压缩器。根据您的 PDF 文件中的内容，Precomp 通常会放大您的 PDF 文件，以便之后可以更好地压缩它。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-03-04T22:48:32.553

除了使用另一个库之外，最好的办法是让您的库正常工作。关于您的另一篇文章的一些建议-我不确定您要运行任何“后期处理”来压缩文件。

顺便说一句，您的网络服务器是否允许 HTTP gzipped 内容？对最终用户透明！

（话虽这么说，短 PDF 文件应该不受大多数​​压缩方法的影响——图像应该在渲染期间被压缩（在这种情况下是 JPEG >> ZIP）——但如果你有*很多*文本，gzip 可以提供帮助）

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-03-04T22:59:51.683

不要在 PDF 中包含整个字体。照顾好那个可以节省几兆字节。

# sql-server - 最佳热/温备份服务器复制策略 (SQL Server 2005)

> ID：612571
> 
> 赞同：3
> 
> 时间：2009-03-04T21:40:22.623
> 
> 标签：sql-server, database, sql-server-2005, replication

我有两台相同的服务器，装有 SQL Server 2005 和我的应用程序。

硬性要求：

1.  我必须能够在任一服务器上更新数据。
2.  我必须能够拔出任一服务器，而无需重新配置数据库中的任何内容。
3.  当服务器重新插入时，它必须自动与另一台服务器同步。

笔记：

1.  如果可能的话，我更喜欢不会给主服务器增加大量负载的选项。
2.  两台服务器有一个用于复制的专用网络，因此带宽不是问题。
3.  数据在任一服务器上过时几分钟是可以的。

从我读过的内容来看，我的选择是：

*   具有可更新订阅的事务复制（排队更新）
*   合并复制

哪种配置最符合我的要求？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-09T08:06:50.120

当前的选项都不允许让两个服务器都可写。几乎您唯一的选择是合并复制，因为这允许对两台服务器进行更新。

然而，合并复制是最难设置和运行的。您需要确保分发服务器上有足够的驱动器空间，以确保分发服务器不会在其中一台服务器停机的整个过程中耗尽空间。

日志传送和镜像不允许更新辅助服务器。

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2009-03-04T22:42:59.587

你考虑过日志运输吗？

我不认为可以很容易地设置热备用可以自动接管，因此需要一些手动工作才能使其成为主要。

它只会与最近收到的日志一样好 - 但您可以设置为每分钟左右发送一次日志。

如果您必须让备用 100% 保持最新，那么您需要一个同步每个事务的解决方案 - 这将是分布式提交。

但是，如果您要通过 FedEx 运送 Standby 并且可以在它断电之前强制执行一个流程（即运送“最终”日志），那么它应该可以工作；或者如果它刚刚断开连接，FedEx'd，然后返回“在线”，日志传送应该从它停止的地方恢复；然后，当您将其设为主节点时，它将与它收到的最新日志一样“新鲜”。

# c# - Acting only on text input in a KeyPress Event

> ID：612572
> 
> 赞同：3
> 
> 时间：2009-03-04T21:40:55.400
> 
> 标签：c#, winforms, char, keypress

I have a key press event, and I want the combobox to handle the keypress if the input is not textual. I.E. If it is the up or down key, let the combobox handle it like it normally would, but if it's punctuation, or alphanumeric I want to act on it.

I thought **Char.IsControl(e.KeyChar))** would do the trick, but it doesn't catch the arrow keys, and for a combobox, that's important.

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-04T21:45:17.043

Here is an example I had from a previous answer I gave. It came from the MSDN documentation and I think you should be able to modify it nicely based on which characters you want to allow or disallow:

```
// Boolean flag used to determine when a character other than a number is entered.
private bool nonNumberEntered = false;

// Handle the KeyDown event to determine the type of character entered into the control.
private void textBox1_KeyDown(object sender, System.Windows.Forms.KeyEventArgs e)
{
    // Initialize the flag to false.
    nonNumberEntered = false;

    // Determine whether the keystroke is a number from the top of the keyboard.
    if (e.KeyCode < Keys.D0 || e.KeyCode > Keys.D9)
    {
        // Determine whether the keystroke is a number from the keypad.
        if (e.KeyCode < Keys.NumPad0 || e.KeyCode > Keys.NumPad9)
        {
            // Determine whether the keystroke is a backspace.
            if(e.KeyCode != Keys.Back)
            {
                // A non-numerical keystroke was pressed.
                // Set the flag to true and evaluate in KeyPress event.
                nonNumberEntered = true;
            }
        }
    }
    //If shift key was pressed, it's not a number.
    if (Control.ModifierKeys == Keys.Shift) {
        nonNumberEntered = true;
    }
}

// This event occurs after the KeyDown event and can be used to prevent
// characters from entering the control.
private void textBox1_KeyPress(object sender, System.Windows.Forms.KeyPressEventArgs e)
{
    // Check for the flag being set in the KeyDown event.
    if (nonNumberEntered == true)
    {
        // Stop the character from being entered into the control since it is non-numerical.
        e.Handled = true;
    }
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2015-08-05T16:33:29.777

您无需检查任何文本字符。

我希望以下代码有所帮助：

```
void ComboBox_KeyPress(object sender, KeyPressEventArgs e)
{
    if(Char.IsNumber(e.KeyChar))
        ...
    else if(Char.IsLetter(e.KeyChar))
        ...
} 
```

# performance - SharePoint 网站模板的效率真的低于网站定义吗？

> ID：612574
> 
> 赞同：5
> 
> 时间：2009-03-04T21:41:43.930
> 
> 标签：performance, sharepoint, site-definition, sitetemplate

因此，在 SharePoint 博客圈中，似乎每个人都只是从其他博客复制和粘贴相同的要点。我看到的一个要点是，SharePoint 网站模板的效率低于网站定义，因为网站定义存储在文件系统中。真的吗？

网站模板效率较低似乎很奇怪。据我了解，所有网站内容都存在于数据库中，无论您使用网站模板还是网站定义。网站模板一次应用于数据库，从那时起，网站不应该关心内容是否是使用网站模板创建的。

那么，网站模板效率低于网站定义的架构原因是什么？

* * *

编辑：链接到说存在性能差异的博客：

*   来自[MSDN](http://msdn.microsoft.com/en-us/library/ms916803.aspx)：由于在数据库中存储模板和从数据库中检索模板的速度很慢，因此站点模板可能会导致性能下降。
*   来自[DevX](http://www.devx.com/dotnet/Article/27673/1954)：但是，如果您尝试为整个组织创建一组可重用模板，SharePoint 中的用户模板可能会导致性能问题，并且可能不是最佳方法。
*   来自[IT 足迹](http://itfootprint.wordpress.com/2007/04/18/sharepoint-site-template-vs-site-definition/)：由于在数据库中存储和检索模板的速度很慢，因此站点模板可能会导致性能下降。每次呈现页面时都会编译和执行数据库中的模板。
*   来自[Branding SharePoint](http://www.brandingsharepoint.com/Lists/Posts/Post.aspx?ID=17)：自定义网站定义与自定义模板相比具有以下优势：
    *   数据直接存储在 Web 服务器上，因此性能通常更好。

至少，我认为上述文章是不完整的，并且根据我对 SharePoint 体系结构的了解，我认为其中有几篇具有误导性。

我阅读了另一篇反对性能差异的博客文章，但我找不到链接。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-05T09:46:35.140

使用站点模板与站点定义的性能影响通常被夸大了。

为什么？

好吧，让我们举个例子：

1.  您采用 Team Site 网站定义。
2.  您将其另存为新的站点模板
3.  然后，您可以基于这个新站点模板创建一个新的子网站。

你有什么？嗯，要记住的重要一点是“重影”发生在 PAGE 级别，而不是 SITE 级别。由于您没有自定义任何页面，因此您访问的任何页面仍然直接来自站点定义，直接来自文件系统。

想证明一下，这里有两个测试：

**第一次测试**

1.  尝试修改原始站点定义中的 default.aspx 页面。
2.  检查您的站点模板，注意您看到了修改。
3.  它仍然是文件系统的“幻影”

**第二次测试**

1.  创建一个新的站点定义。
2.  根据这个新站点定义创建一个新站点。
3.  创建一个新的站点模板
4.  将网站模板发送给使用 SharePoint 的伙伴，并要求他们基于它创建一个新的子网站。

它会失败。为什么？因为他们的机器上不存在站点定义。

那么，回到您的问题，“SharePoint 网站模板的性能真的不如网站定义吗？” 我的回答是：“性能考虑不应在您决定使用站点定义或站点模板时发挥作用，您的功能目标应该是”。现在它引起了争议，但对我来说，选择站点定义而不是创建功能的理由很少。

就“重影”而言。是的，当定制您的页面时，您的页面将存储在数据库中，是的，您必须进行数据库往返才能获得它。但是，SharePoint 很聪明，当然会缓存它。所以，从理论上讲，是的，它的速度较慢，在实践中，没有人真正注意到。

自 2003 年以来，重影一直在产品中（可能在那之前的 STS 中，不记得了），我从未见过有关其性能影响的官方指导，也没有人猜测“它更慢”的评论。

这让我相信它并不是真的担心。“幻影”页面更大的担忧是维护它们带来的困难，但是对于 2007 和 Masterpages，这是一个小得多的问题。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-05T22:04:01.560

取消主机的问题与其说是性能问题，不如说是升级问题。

在 SPS2003 中，取消重影有一个性能缺陷。这些问题中的大部分已在 SharePoint 2007 中得到解决。一方面，SPVirtualPathProvider 将非镜像页面作为非编译页面运行 - 这实际上至少为第一页提供了更快的呈现速度。

取消重影（或自定义）的真正杀手锏——谁曾认为重命名术语并切换“un”是个好主意？;-) 是您想要升级的时候，以及您的页面、页面布局、母版页，内容类型等是定制的。如果您曾经尝试通过大量自定义对 MOSS 网站进行外观升级，那么您也会知道在不丢失自定义页面中包含的布局或功能的情况下让所有内容都显示新设计是多么痛苦。

安德斯拉斯克

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-04T23:08:44.643

站点定义的性能更高，因为它们缓存在文件系统中，无论模板是否存储在数据库中，并且每次呈现页面时都必须编译和执行。此外，与基于现有站点模板的模板不同，自定义站点定义独立于升级。

[此博客文章](http://itfootprint.wordpress.com/2007/04/18/sharepoint-site-template-vs-site-definition/)和[此更新](http://itfootprint.wordpress.com/2007/05/24/site-templates-vs-site-definitions-part-2/)的文章中很好地概述了其他差异。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-05T00:01:52.923

这里的问题称为重影。开箱即用的 SharePoint 网站在 SharePoint 网站的 12 个配置单元中存储了许多文件（包括母版页和页面布局）。当对这些文件发出请求时，SharePoint 足够智能，可以执行磁盘读取操作。

可以“取消重影”这些页面。本质上，创建对存储在 SharePoint 内容数据库而不是文件系统中的页面的修改。对 Un-Ghosted 页面的请求将导致数据库往返（从数据库中选择，返回文件的字节等）。这必然导致大量的额外工作。当您谈论访问该站点的 100 或 1000 名用户时，此数据库往返会成为性能问题。

因此，用于频繁使用的网站的 SharePoint 自定义网站定义将希望在 Web 服务器文件系统上存储尽可能多的文件（并将 .... 缓存在其他所有内容之外）。站点定义不一定存储在文件系统上，但该过程（除了更复杂之外）可以更好地控制任何自定义项目的存储位置。

两个博客讨论这个问题的例子。 [http://itfootprint.wordpress.com/2007/04/18/sharepoint-site-template-vs-site-definition/](http://itfootprint.wordpress.com/2007/04/18/sharepoint-site-template-vs-site-definition/) [http://my.advisor.com/doc/17614](http://my.advisor.com/doc/17614)

# jquery - 什么是最好的 jQuery“单击缩略图并更改主图像”模块？

> ID：612575
> 
> 赞同：9
> 
> 时间：2009-03-04T21:42:10.763
> 
> 标签：jquery, gallery, thumbnails

这是我所拥有的（所有动态生成的，如果有区别的话）：

*   图像列表
*   每个图像的标题
*   每个图像的缩略图

该页面应加载一张全尺寸图像和所有缩略图。当用户单击缩略图时，全尺寸图像会显示带有标题的新图像。如果他们单击另一个缩略图，图片（和标题）会再次更改。

这不是很复杂。几个月前我拼凑了一个解决方案，但我需要再做一次，我正在查看这个糟糕的代码并认为必须有更好的方法（并且知道 jQuery，其他人已经做到了，并且完成了好吧）。

想法？链接？

谢谢！

* * *

## 回答 #1

> 赞同：48
> 
> 时间：2011-11-02T05:56:39.940

这里的大多数答案就像用佳能射击苍蝇！

```
$('#thumbs img').click(function(){
    $('#largeImage').attr('src',$(this).attr('src').replace('thumb','large'));
    $('#description').html($(this).attr('alt'));
}); 
```

这就是你所需要的.. 4 行代码。

看这里：[4行画廊](http://workshop.rs/demo/gallery-in-4-lines/)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-28T15:24:40.313

你试过灯箱吗？[http://leandrovieira.com/projects/jquery/lightbox/](http://leandrovieira.com/projects/jquery/lightbox/)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-04T21:45:10.227

这是一个看起来很漂亮并且是用 jQuery 编写的：[Photo Slider](http://opiefoto.com/articles/photoslider)

这是另一个我更喜欢的： [Galleria](http://www.webappers.com/2008/03/05/galleria-simple-but-nice-jquery-image-gallery/)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2016-10-19T16:11:18.640

基于[他在此处链接的 krembo99 的答案](http://workshop.rs/demo/gallery-in-4-lines/)，我想分享我的解决方案，因为当我的客户要求这样的功能时，我已经上传了数百张照片。考虑到这一点，通过在提供的代码中添加几行额外的代码，我能够获得适合我的参数的解决方案。

我也在处理较小的图像，所以我不需要创建同一个文件的大小版本。

```
$('.thumbnails img').click(function(){

 // Grab img.thumb class src attribute
 // NOTE: ALL img tags must have use this class, 
 // otherwise you can't click back to the first image.

 var thumbSrc = $('.thumb').attr('src');

 // Grab img#largeImage src attribute
 var largeSrc = $('#largeImage').attr('src');

  // Use variables to replace src instead of relying on file names.
  $('#largeImage').attr('src',$(this).attr('src').replace(thumbSrc,largeSrc));
  $('#description').html($(this).attr('alt'));

}); 
```

这是我的 HTML 的外观。

```
 <img src="path/to/file1.jpg" id="largeImage" class="thumb">
    <div id="description">1st image Description</div>

    <div class="thumbnails">

     <img src="path/to/file1.jpg" class="thumb" alt="1st image description">
     <img src="path/to/file2.jpg" class="thumb"alt="2nd image description">
     <img src="path/to/file3.jpg" class="thumb" alt="3rd image description">
     <img src="path/to/file4.jpg" class="thumb" alt="4th image description">
     <img src="path/to/file5.jpg" class="thumb" alt="5th image description">

    </div> 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-04T21:46:49.910

[http://bradblogging.com/jquery/9-jquery-slideshow-applications-you-cannot-miss/](http://bradblogging.com/jquery/9-jquery-slideshow-applications-you-cannot-miss/)

jQuery 中包含 9 个不同照片幻灯片的页面可供使用

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-03-04T12:44:12.830

查看我的 Galleria 实施：[Essex Gallery 中的 Garden design Landscaper](http://www.achlandscapes.co.uk/garden-ideas.htm#images/ideas/pond.jpg)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-11-12T19:41:54.977

试试[Galleriffic](http://www.twospy.com/galleriffic/)，它有你需要的一切。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2018-11-30T06:18:02.897

很多这些脚本已经过时，对我不起作用，而且需要一组不同的图像作为缩略图。我进行了认真的搜寻，发现了一些非常轻巧的东西，它是纯 js，不需要 jquery。

```
<html>
<head>
<style>
* {margin:0; padding:0; border:0; outline:0; box-sizing:border-box;}
.image, .thumb {width:100%; height:100%;}
#product-image-wrap {position:relative; float:left; width:250px; height:325px; margin:50px 0 50px 50px;}
#product-image {position:relative; float:left; width:250px; height:250px; border:1px solid #d0d0d0; padding:20px; cursor:pointer; display:inline-block; transition:0.9s;}
#product-image:hover {opacity:0.7;}
.product-image-thumbnail {position:relative; float:left; width:55px; height:55px; border:1px solid #d0d0d0; margin-top:20px; padding:10px; cursor:pointer; display:inline-block; transition:0.9s;}
.product-image-thumbnail:hover {opacity:0.7;}
.product-image-thumbnail-spacer {position:relative; float:left; width:10px; height:130px;}
</style>

</head>
<body>

<div id='product-image-wrap'>

<!-- Main -->
<div id='product-image'><img src='http://workshop.rs/demo/gallery-in-4-lines/images/image_01_large.jpg' id='0' class='image' alt='image 0'></div>

<!-- Thumbs -->
<div class='product-image-thumbnail'><img src='http://workshop.rs/demo/gallery-in-4-lines/images/image_01_large.jpg' id='1' class='thumb' onclick='preview(this)' alt='image 0'></div>
<div class='product-image-thumbnail-spacer'></div>
<div class='product-image-thumbnail'><img src='http://workshop.rs/demo/gallery-in-4-lines/images/image_02_large.jpg' id='2' class='thumb' onclick='preview(this)' alt='image 2'></div>
<div class='product-image-thumbnail-spacer'></div>
<div class='product-image-thumbnail'><img src='http://workshop.rs/demo/gallery-in-4-lines/images/image_03_large.jpg' id='3' class='thumb' onclick='preview(this)' alt='image 3'></div>
<div class='product-image-thumbnail-spacer'></div>
<div class='product-image-thumbnail'><img src='http://workshop.rs/demo/gallery-in-4-lines/images/image_04_large.jpg' id='4' class='thumb' onclick='preview(this)' alt='image 4'></div>

</div>

<!-- Javascript -->
<script>
var lastImg = 1;
document.getElementById(lastImg).className = "thumb selected";
function preview(img) {
document.getElementById(lastImg).className = "thumb";
img.className = "thumb selected";
document.getElementById(0).src = img.src;
lastImg = img.id;
}
</script>

</body>
</html> 
```

[https://jsfiddle.net/uo6js5v7/](https://jsfiddle.net/uo6js5v7/)

# javascript - 如何捕获定期刷新 gmail 收件箱的 Ajax 事件

> ID：612576
> 
> 赞同：5
> 
> 时间：2009-03-04T21:42:18.610
> 
> 标签：javascript, gmail, greasemonkey

我正在尝试编写一个适用于 Gmail 的 Greasemonkey 脚本。我知道如何创建响应用户单击收件箱链接或刷新链接的 javascript。我的问题是 Gmail 会定期用新对话刷新收件箱，而我无法捕获此事件。有没有办法在 javascript 中捕获周期性的 Ajax 事件？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-05T00:30:52.933

您可以尝试用您自己的函数替换该`window.setTimeout`函数（也可能是）：`window.setInterval`

```
window._setTimeout = window.setTimeout;
window.setTimeout = function(func, delay) {
    return window._setTimeout(function() {
        // Your code goes here, before the client function is called
        alert('A timeout event just fired!');

        if (typeof func == 'string') {
            eval(func);
        } else {
            func();
        }
    }, delay);
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-06T03:11:54.707

我在上面尝试了 Miles 的出色建议，但不幸的是它不起作用，因为在我有机会在我的 Greasemonkey 脚本中更改它之前，Gmail 已经调用了原始的 setTimeout 函数。

我唯一能做的就是以某种方式对 Gmail 在定期刷新收件箱时所做的更改做出反应。我发现添加或删除节点时会触发几个与 DOM 相关的事件：

[http://www.w3.org/TR/DOM-Level-3-Events/events.html#event-DOMNodeInserted](http://www.w3.org/TR/DOM-Level-3-Events/events.html#event-DOMNodeInserted)

由于 Gmail 正在使用我最新的电子邮件更新 DOM，因此我可以侦听这些 DOM 事件（我正在使用 DOMNodeInserted）并对更改做出反应。

它并不优雅，但它有效。

# svn - Git如何解决合并问题？

> ID：612580
> 
> 赞同：56
> 
> 时间：2009-03-04T21:43:10.573
> 
> 标签：svn, git, version-control

SVN 使分支变得非常便宜，从而使分支变得更加容易，但合并仍然是 SVN 中的一个真正问题——Git 应该解决的问题。

Git 是否实现了这一点，以及如何实现？

（免责声明：我所知道的关于 Git 的一切都是基于 Linus 的讲座——这里的总 git noob）

* * *

## 回答 #1

> 赞同：76
> 
> 时间：2009-03-04T22:24:22.020

Git 不会防止合并中的冲突，但即使它们不共享任何父祖先，也可以协调历史。
（通过[Grafts 文件 ( `.git/info/grafts`)](http://community.livejournal.com/evan_tech/255341.html)，这是一个列表，每行一个，提交后跟它的父项，您可以修改它以实现“和解”目的。）
那里非常强大。

但要真正了解“如何考虑合并”，您[可以从转向 Linus 本人开始](http://wincent.com/a/about/wincent/weblog/archives/2007/07/a_look_back_bra.php)，并意识到这个问题与“算法”无关：

> *Linus*：就我*个人*而言，我想要一些可重复且不聪明的东西。我理解*或*告诉我它做不到的事情。
> 坦率地说，合并单个文件的历史*而不*考虑所有其他文件的历史会让我“呃”。
> 
> **合并的重要部分不是它如何处理冲突（如果它们很有趣，无论如何都需要由人来验证），而是它应该将历史正确地融合在一起，以便您为未来的合并奠定新的坚实基础.**
> 
> 换句话说，重要的部分是*琐碎*的部分：父母的命名，并跟踪他们的关系。不是冲突。
> 
> 看起来 99% 的 SCM 人似乎认为解决方案是在内容合并方面更加聪明。这完全没有抓住重点。

* * *

所以 Wincent Colaiuta 补充说（强调我的）：

> 不需要花哨的元数据、重命名跟踪等。
> **您唯一需要存储的是每次更改前后树的状态。**
> 
> 哪些文件被重命名了？复制了哪些？哪些被删除了？添加了哪些行？哪些被删除了？哪些线路内部发生了变化？哪些文本块从一个文件复制到另一个文件？
> 您不必关心这些问题中的任何一个，当然也不必保留特殊的跟踪数据来帮助您回答这些问题：**对树的所有更改（添加、删除、重命名、编辑等）都是隐式的编码在树的两个状态之间的增量中**；您只需***跟踪******内容***是什么。
> 
> **绝对可以（并且应该）推断出一切**。
> 
> Git 打破常规，因为它考虑的是内容，而不是文件。
> 它不跟踪重命名，它跟踪内容。它在整个树级别上这样做。
> 这与大多数版本控制系统截然不同。
> 它不会费心尝试存储每个文件的历史记录；而是将历史记录存储在树级别。
> 当您执行差异时，您正在比较两棵树，而不是两个文件。
> 
> 另一个从根本上明智的设计决策是 Git 如何进行合并。
> **合并算法很聪明，但他们不会尝试太聪明。明确的决定是自动做出的，但当有疑问时，由用户决定。**
> 这是应该的方式。您不希望机器为您做出这些决定。你永远不会想要它。
> 这就是 Git 合并方法的基本见解：当所有其他版本控制系统都在努力变得更智能时，Git 很高兴地自我描述为“愚蠢的内容管理器”，而且它更适合它。

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2009-03-07T20:21:05.143

现在普遍同意 3 路合并算法（可能具有诸如重命名检测和处理更复杂的历史记录等增强功能），它考虑了当前分支上的版本（'ours'），合并分支上的版本（'theirs' )，并且合并分支的共同祖先的版本（'祖先'）是（从实际的角度来看）解决合并的最佳方法。在大多数情况下，对于大多数内容树级合并（采用哪个版本的文件）就足够了；很少需要处理内容冲突，那么 diff3 算法就足够了。

要使用 3 路合并，您需要知道合并分支的共同祖先（也称为合并基础）。为此，您需要了解这些分支之间的**完整历史记录。**（当前）版本 1.5 之前的 Subversion（没有 SVK 或 svnmerge 等第三方工具）缺少的是***合并跟踪***，即在合并中记住合并提交时使用了哪些父项（哪些提交）。如果没有此信息，则无法在存在重复合并的情况下正确计算共同祖先。

考虑下图：

> ```
> ---.---a---.---b---d---.---1
>         \        /
>          \-.---c/------.---2 
> ```

*（这可能会被破坏......如果有能力在这里绘制 ASCII 艺术图会很好）*。
当我们合并提交'b'和'c'（创建提交'd'）时，共同的祖先是分支点，提交'a'。但是当我们想要合并提交'1'和'2'时，现在共同的祖先是提交'c'。如果不存储合并信息，我们将不得不错误地断定它是提交'a'。

Subversion（1.5 之前的版本）和更早的 CVS 使合并变得困难，因为您必须自己计算共同祖先，并在进行合并时手动提供有关祖先的信息。

Git 将有关提交的所有父级（在合并提交的情况下为多个父级）的信息存储在提交对象中。这样你就可以说 Git 存储修订的 DAG（直接无环图），存储和记住提交之间的关系。

* * *

*（我不确定 Subversion 如何处理下面提到的问题）*

此外，Git 中的合并可以处理两个额外的复杂问题：**文件重命名**（当一侧重命名文件而另一侧没有重命名时；我们想要重命名，并且我们想要将更改应用于正确的文件）和**交叉合并**（更复杂的历史，当有不止一个共同祖先时）。

*   **合并期间的文件重命名**使用基于启发式相似度得分（同时考虑文件内容的相似性和路径名的相似性）***重命名检测***来管理。Git 检测合并分支（和祖先）中哪些文件相互对应。在实践中，它适用于现实世界的案例。
*   **交叉合并**，参见[revctrl.org wiki 上的定义](http://revctrl.org/CrissCrossMerge)，（以及**多个合并基础**的存在）通过使用***递归合并策略***进行管理，该策略生成单个虚拟共同祖先。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-03-10T16:06:00.660

上面的答案都是正确的，但我认为他们错过了 git 对我来说容易合并的中心点。SVN 合并要求您跟踪并记住合并的内容，这是一个巨大的 PITA。从他们的文档中：

```
svn merge -r 23:30 file:///tmp/repos/trunk/vendors 
```

现在这不是杀手，但如果你忘记它是 23-30 包容性还是 23-30 独占性，或者你是否已经合并了其中的一些提交，你就会被淹没，你必须找出答案来避免重复或丢失提交。如果你分支一个分支，上帝会帮助你。

使用 git 它只是 git merge 并且所有这一切都无缝地发生，即使您已经挑选了几个提交或完成了任何数量的梦幻般的 git-land 事情。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-03-04T22:01:55.020

据我所知，合并算法并不比其他版本控制系统中的更智能。但是，由于 git 的分布式特性，不需要集中合并工作。每个开发人员都可以随时将其他开发人员的小更改合并到他的树中，因此出现的冲突往往更小。

* * *

## 回答 #5

> 赞同：-9
> 
> 时间：2009-03-04T22:23:44.203

Git 只是让通过错误的合并来搞砸其他所有人的存储库变得更加困难。

唯一真正的好处是 Git 在合并方面要快得多，因为一切都在本地完成并且是用 C 编写的。

SVN，正确使用，是完全可用的。

# asp.net - ASP.NET MVC RC 返回 Url.Content 的错误路径

> ID：612584
> 
> 赞同：7
> 
> 时间：2009-03-04T21:43:50.883
> 
> 标签：asp.net, asp.net-mvc

**更新**此问题在 ASP.NET MVC 的发布位中不存在

[我有一个 ASP.NET MVC RC 应用程序，它在从http://localhost:9002/](http://localhost:9002/)运行的调试器下运行良好 但是当我将它发布到[http://localhost/Zot/](http://localhost/Zot/)时，对 Url.Content 的调用返回不正确的值。

我有像这样的脚本标签

```
<script src="<%= Url.Content("~/Scripts/util.js") %>" ... 
```

在已发布的站点中，这会产生：

```
<script src="Zot/Scripts/util.js" ... 
```

代替

```
<script src="/Zot/Scripts/util.js" ... 
```

或者

```
<script src="Scripts/util.js" ... 
```

我有样式表标签，例如：

```
<link href="~/Content/Site.css" runat="server" ... 
```

产生正确的东西：

```
<link href="Content/Site.css" ... 
```

关于为什么 Url.Content 失败的任何建议。我显然不能`runat="server"`在`<script>`标签上放一个。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-04T22:22:42.333

我倾向于使用 Rob Conery 的[脚本注册助手](http://blog.wekeroad.com/blog/asp-net-mvc-script-registration-helper/)：

```
public static string RegisterJS(this System.Web.Mvc.HtmlHelper helper, string scriptLib) {
  //get the directory where the scripts are
  string scriptRoot = VirtualPathUtility.ToAbsolute("~/Scripts");
  string scriptFormat="<script src=\"{0}/{1}\" type=\"text/javascript\"></script>\r\n";
  return string.Format(scriptFormat,scriptRoot,scriptLib);
} 
```

用法：

```
<%= Html.RegisterJS("myscriptFile.js") %> 
```

正如您在示例中看到的，这使用 VirtualPathUtility 来解析 Scripts 目录的 url。这也应该有助于绕过标签汤的问题。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-06T09:36:26.873

这应该已在 RC2 中修复。如果您正在使用 RC2 并且仍然遇到此问题，请在以下位置提交错误[http://forums.asp.net/1146.aspx](http://forums.asp.net/1146.aspx)。

# datatable - How can I refresh a YUI dataTable with a button?

> ID：612585
> 
> 赞同：7
> 
> 时间：2009-03-04T21:44:15.673
> 
> 标签：datatable, yui

I'm testing the script:

> [http://developer.yahoo.com/yui/examples/datatable/dt_xhrjson.html](http://developer.yahoo.com/yui/examples/datatable/dt_xhrjson.html)

I would like to add a button to refresh(reset) the data. I would reset all modified data and reload first data. I add this code, so after select (refresh), I have no data:

```
YAHOO.util.Event.onContentReady("splitbuttonsfromjavascript", function () {

var onMenuItemSelect = function () {

        myDataTable.initializeTable();

        myDataTable.render();

        };

        var aSplitButton5Menu = [

            { text: "Refresh", value: 1, onclick: { fn: onMenuItemSelect } }

        ];

        var oSplitButton5 = new YAHOO.widget.Button({ type: "split",  label: "Refresh table", name: "splitbutton", menu: aSplitButton5Menu, container: this });

    }); 
```

What I need to use in my onMenuItemSelect to refresh mydataTable?

* * *

I made some changes to modify the "city" and "rating" in the sample : [http://developer.yahoo.com/yui/examples/datatable/dt_xhrjson.html](http://developer.yahoo.com/yui/examples/datatable/dt_xhrjson.html)

Now, I wish resetting MyTable with a button (and reload default dataset). When I use my code, after button click, I clear all and default data are not reloaded (I have : "No records found." after button click).

How I can reload default data ?

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2010-01-08T18:03:42.220

我认为 Gourneau 的答案是最好的，但它缺少一个很好的接触。为了显示“正在加载...”消息，您需要调用 showTableMessage 函数。

```
myDataTable.showTableMessage("Loading...");
myDataTable.getDataSource().sendRequest('', { success: myDataTable.onDataReturnInitializeTable, scope: myDataTable }); 
```

当请求完成时，onDataReturnInitializeTable 函数会自动清除表消息。

我也在我的[博客](http://aspzone.com/tech/yui-datatable-refresh/)上发布了这个。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-06-12T02:23:05.693

我无法让 Gourneau 发布的方法（到处都提到）起作用，所以我想出了这个小技巧：

```
 function updateTable(){
      sortState = theDataTable.getState().sortedBy
      var sort = sortState ? sortState.key : "id";
      var dir = sortState ? sortState.dir : "yui-dt-desc";
      theDataTable.sortColumn(theDataTable.getColumn(sort),dir);
   }; 
```

你找到当前的排序方法，然后调用 sortColumn 告诉它再次排序，它会刷新数据。这也使分页保持有序。我将它与搜索框和一些过滤器一起使用，以便我可以更改它们的值并相应地更新表格。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-04T23:03:17.777

假设您有一个 DataTable 实例 myTable：

myTable.render() 将重绘表格；myTable.initializeTable() 将清除所有状态，包括排序和选择，并重绘

-埃里克

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-24T16:49:05.520

我认为如果您的按钮调用此功能，它将起作用：

```
myDataTable.getDataSource().sendRequest('',
{ success: myDataTable.onDataReturnInitializeTable,scope: myDataTable}); 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2011-02-25T20:08:23.640

我认为我无法在此处充分发布您所需解决方案的所有代码，但 Yahoo 的 Satyam（至少是 YUI 的主要贡献者）有一个重新查询方法，他为 Datatable 添加了扩展，并已发布例如。我已经使用了它，它运行良好 - 特别是当您需要为您的表格提供搜索功能时。

这是一个开始的链接，但我也会在“Satyam requery”下搜索更多示例或更适合您的数据表版本的示例。

[http://www.satyam.com.ar/yui/2.6.0/requery.html](http://www.satyam.com.ar/yui/2.6.0/requery.html)

-杰森

ps 如果您使用的是服务器端数据，那么使用 onDataReturnInitializeTable 方法的解决方案会有所帮助，但我认为 Satyam 的解决方案也可以解决此问题，并跟踪您的分页。

# delphi - 是否可以安装同一个 delphi 服务应用程序的多个实例？

> ID：612587
> 
> 赞同：10
> 
> 时间：2009-03-04T21:44:50.537
> 
> 标签：delphi, windows-services

我有一个用 Delphi 构建的服务应用程序，效果很好。它完全符合我的要求，一切都很开心。一切都很好，直到我想在一台机器上运行该服务的两个（或更多）实例。由于服务名称是硬编码到程序中的（通过服务的 Name 属性），我只能在任何给定的计算机上安装该服务一次。如果我尝试在运行时修改 Name 属性，则服务不会响应，除非 Name 属性设置为与设计时设置的相同。

我已经为此做了一个解决方法，我将所有不直接与服务控制管理器交互的代码封装到单独的单元中。然后我为每个我想要的服务实例编写一个单独的 Delphi 项目，该服务具有足够的代码来启动自身并开始运行主代码。

在我看来，这种方法很丑陋，而且肯定效率低下。它适用于两个实例，但是我们需要第三个和第四个，然后......

有什么方法可以修改我的代码，以便我只有一个 Delphi 项目，它可以通过一些简单的运行时输入（例如命令行标志）作为多个服务实例安装和运行自身？

或者可能是一个更广泛的问题：是否有实现目标的“正确方法”？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-03-04T23:16:35.623

您还没有明确说明您在 TService 子类中尝试更改的内容。

您是否添加了“BeforeInstall”处理程序？

就像是：

```
procedure TServiceMain.ServiceLoadInfo(Sender : TObject);// new method, not an override
begin
  Name := ParamStr(2);
  DisplayName := ParamStr(3);
end;

procedure TServiceMain.ServiceBeforeInstall(Sender: TService);
begin
  ServiceLoadInfo(Self);
end;
procedure TServiceMain.ServiceCreate(Sender: TObject);
begin
  ServiceLoadInfo(Self);
end; 
```

如果您定期执行此操作，则将 TService 子类化以在构造函数中执行此操作。

您也应该在 BeforeUninstall 中执行相同的操作 - 将两个事件指向相同的方法。

```
C:\>servicename /install MyService "My Service Description" 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-04T21:56:56.873

您可以在内部创建具有多个线程的服务，每个线程都像它自己的服务版本/副本一样。您可以使用服务控制器 API IIRC 来控制它。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-04T22:01:30.637

是的，可以安装同一服务的多个实例，您只需要在安装时（而不是运行时）动态更改名称，但这并不理想。[（代码项目http://www.codeproject.com/KB/dotnet/MultipleInstNetWinService.aspx](http://www.codeproject.com/KB/dotnet/MultipleInstNetWinService.aspx)上有一些示例代码）

但是，我倾向于重新考虑您的方法，服务流程本身实际上是单例的，如果您需要运行一个流程的多个实例，也许您的服务应该只控制和管理多个流程而不是流程。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-01-26T10:45:21.807

上面接受的答案非常有帮助。

我使用的代码：

```
procedure TService1.ServiceAfterInstall(Sender: TService);
begin
//http://stackoverflow.com/questions/612587/is-it-possible-to-install-multiple-instances-of-the-same-delphi-service-applicati
//http://www.c-sharpcorner.com/UploadFile/timosten/DynamicServiceInCSharp11262005062503AM/DynamicServiceInCSharp.aspx?ArticleID=4d5020e4-7317-425c-ab29-5bf37a1db421
//http://support.microsoft.com/kb/137890
  SaveRegSetting('\SYSTEM\CurrentControlSet\Services\' + Name, 'ImagePath', ParamStr(0) + ' --name=' + Name, HKEY_LOCAL_MACHINE)
end;

procedure TService1.ServiceCreate(Sender: TObject);
begin
  Name := Trim(FCommandLineOptions.Values['name']);
  DisplayName := Name;
end; 
```

SaveRegSetting 是我自己的过程，而 FCommandLineOptions 是一个标记命令行参数的对象。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-04T23:45:15.990

将所有代码包装到一个继承自 TThread 的类中。

当您的服务启动时，它将从设置文件或注册表中读取一个数字，并创建您的类的多个实例。

每个实例独立运行。

要更改运行实例的数量，您可以关闭服务，编辑设置（在文件或注册表中）并重新启动服务。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2020-03-12T18:28:47.543

为了破解注册表，我建议使用以下指南并使用 Windows 服务控制器 (sc.exe) 命令行界面：

[使用 sc.exe 创建服务时如何传入上下文参数？](https://stackoverflow.com/questions/3663331/when-creating-a-service-with-sc-exe-how-to-pass-in-context-parameters)

（编辑：请使用建议的代码来获取 Name & DisplayName 属性，只是不要使用 /install 开关为您的服务可执行文件安装您的服务。）

# c# - 强类型化泛型函数的返回的适当方法是什么？

> ID：612592
> 
> 赞同：5
> 
> 时间：2009-03-04T21:45:34.280
> 
> 标签：c#, generics

我正在编写一个过滤器函数来返回从更大的超类型（例如对象）集合中指定的特定类型。这个想法是我给你一个可枚举的，然后你把所有的字符串都给我。你可以在没有泛型的情况下这样写：

```
public static IEnumerable Filter(IEnumerable source, Type type)
{
    List<object> results = new List<object>();

    foreach(object o in source)
    {
        if(o != null && o.GetType() == type)
        {
            results.Add(o);
        }
    }

    return results;
} 
```

如果我们想返回泛型，有几种不同的方法可以实现。

作为直端口：

```
public static IEnumerable<TResult> Filter<TResult>
                          (IEnumerable source, Type type) 
```

传入一个“示例”：

```
IEnumerable<TResult> Filter<TResult>
    (IEnumerable source, TResult resultType) 
```

最终我认为是最干净的：

```
public static IEnumerable<T> Filter<T>(IEnumerable source) 
```

第二种类型将完全使用参数调用（并推断类型）：

```
Filter(myList, "exampleString"); 
```

作为最终版本，将使用类型说明符调用：

```
Filter<string>(myList); 
```

什么是强类型化泛型函数的返回值的适当方法，其中返回类型不会自动隐含在签名中？（为什么？）

（编辑说明：我们的输入没有类型，例如 IEnumerable<T>。充其量是 IEnumerable。此函数将 Ts 从其他类型的整个集合中返回。）

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-03-04T21:48:32.870

Linq 中包含的以下扩展方法正是您所需要的：

```
IEnumerable<T> OfType<T>(this IEnumerable enumerable); 
```

这是一个使用示例：

```
List<object> objects = //...

foreach(string str in objects.OfType<string>())
{
    //...
} 
```

如您所见，他们使用泛型参数作为返回类型说明符。这比使用类型或字符串并返回非类型安全枚举更简单、更安全。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-04T21:54:17.443

我通常更喜欢最终版本 - 它指定了所有相关信息*，仅此而已*。给定带有参数的版本，如果您不熟悉代码，您会不会期望参数的*值*是有意义的，而不仅仅是类型？

偶尔这种“虚拟参数”模式很有用，但我通常会避开它——或者至少提供一个不需要它的重载。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-04T21:49:01.057

最干净的方法是

```
public static IEnumerable<T> Filter<T>(IEnumerable<T> source) 
```

这将删除所有非类型安全函数。然后，您可以使用强制转换调用将任何非泛型 IEnumerable 转换为泛型版本

```
IEnumerable enumerable = GetMyEnumerable();
var filtered = Filter(enumerable.Cast<string>()); 
```

您还可以另外将其设为扩展方法并使调用更加流畅。

```
public static IEnumerable<T> Filter<T>(this IEnumerable<T> source)
...
var filtered = GetMyEnumerable().Cast<string>().Filter(); 
```

**编辑**

OP 提到他们只想过滤到特定类型。在这种情况下，您可以只使用 Enumerable.OfType

```
var filtered = GetMyEnumerable().OfType<SomeType>(); 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-04T22:03:03.880

如果您使用的是框架 3.5，这已经在 IEnumerable 中实现：

```
IEnumerable<string> s = someList.OfType<string>() 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-04T21:54:40.593

这是我的 2 美分。我对您要过滤的内容有些困惑。IEnumerable 是非泛型的，那么您将如何过滤非泛型源并返回 IEnuerable 的结果。

我认为最干净的是

```
public static IEnumerable<T> Filter<T>(IEnumerable<T> source) 
```

如果您知道您的 T 过滤器将是哪种类型，您甚至可以进行泛型类型检查，例如，仅某个接口或基类的类或对象，或值类型......像这样。

```
public static IEnumerable<T> Filter<T>(IEnumerable<T> source) where T : class
public static IEnumerable<T> Filter<T>(IEnumerable<T> source) where T : struct 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-04T22:11:14.763

很明显（至少对我而言）您想要最终版本：

```
IEnumerable<T> Filter<T>(IEnumerable source) 
```

通过减少的过程，如果没有别的。

第一个版本：

```
IEnumerable<T> Filter<T>(IEnumerable source, Type type) 
```

必须处理我传入的类型与约束不匹配的疯狂：

第二个版本：

```
IEnumerable<T> Filter<T>(IEnumerable source, T type) 
```

让我构建了一个示例，该示例可能很昂贵或无法用于构建。另外，如果我传入 null（在任何一种情况下）怎么办？

顺便说一句，对于单个约束，我认为类型参数应该是 T。如果它是函数的返回，你可以侥幸逃脱 - 比如 Func<TResult>，但否则它只是更多的打字，不太清楚。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-04T22:32:13.777

我认为这几乎是你想要的。

```
public static IEnumerable<T> OfType<T>(IEnumerable source) {
    foreach (object obj in source)
        if (obj is T)
            yield return (T)obj;
} 
```

稍微复杂一点但（可能）稍微快一点的版本是

```
public static IEnumerable<T> OfType<T>(IEnumerable source) {
    foreach (object obj in source) {
        T result = obj as T;
        if (result != null)
            yield return result;
    }
} 
```

# c# - Data Access Layer (DAL) design

> ID：612603
> 
> 赞同：3
> 
> 时间：2009-03-04T21:47:32.373
> 
> 标签：c#, data-access-layer

I'm using .Net enterprise library data access application block for my Data Access layer design.

In my Category DAL class, I've methods like :

GetProductsInCategory(int CatId), GetAllProducts, GetCategories, etc.

My question is: where do I put this line of code ?

```
DatabaseFactory.CreateDatabase("MyDB"); 
```

shall I put it in every method above or shall I have a base class which would return Database object to my DAL class.

Also, shall I keep these DAL class methods as static?

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-04T21:54:54.680

我更喜欢返回像连接这样的常见对象的基类，在你的例子中是数据库。

这是对设计数据访问层的参考：[.NET 应用程序体系结构：数据访问层](http://www.simple-talk.com/dotnet/.net-framework/.net-application-architecture-the-data-access-layer/)

我使用 Microsoft Enterprise Library 数据访问应用程序块。它完成了这里提到的大部分事情。但是像连接或交易这样的常见东西会进入我的基类。

![替代文字](https://www.simple-talk.com/iwritefor/articlefiles/253-DAL006.jpg)

> DataServiceBase 类提供常见的数据访问功能，例如打开数据库连接、管理事务、设置存储过程参数、执行命令等。换句话说，DataServiceBase 类包含通用数据库代码，并为您提供了一组帮助方法，供您在各个数据服务类中使用。派生的数据服务类将 DataServiceBase 中的帮助器方法用于特定目的，例如执行特定命令或运行特定查询。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-05T02:39:48.207

感谢您的提示..我将拥有从基类 DBManager 派生的所有 DAL 类。此类将有一个名为 GetDatabase() 的受保护方法，该方法将具有代码：return DatabaseFactory.CreateDatabase("MyDB"); 我在派生类中的方法看起来像：..

```
public DataSet GetProductsInCategory(int Category) 
{
Database db = base.GetDatabase(); 
DbCommand dbCommand = db.GetStoredProcComman("GetProductsByCategory"); 
db.AddInParameter(dbCommand, "CategoryID", DbType.Int32, Category); 
return db.ExecuteDataSet(dbCommand);
} 
```

这个 DAL 设计看起来不错吗？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-05T04:30:33.137

我建议考虑使用 SubSonic 进行 DAL 和对象生成。它实现了 Microsoft 的应用程序块，但为您提供了简单（且强大）的查询功能，例如：

```
SubSonic.Query qry = new SubSonic.Query(Usr.Schema);
qry.SetSelectList(Usr.Columns.UserPkid);
qry.QueryType = SubSonic.QueryType.Select;
qry.AddWhere(Usr.UsernameColumn.ColumnName, SubSonic.Comparison.Equals, Username);

using (IDataReader reader = qry.ExecuteReader())
{
    while (reader.Read())
    {
        Trace.WriteLine("Fetched User Pkid [" + reader[Usr.Columns.UserPkid].ToString() + "]");
    }
} 
```

当然，它实现了[ActiveRecord](http://en.wikipedia.org/wiki/Active_record_pattern)模式，因此对象类具有 .Delete()、.Add()、.Get() 类型的方法。

# prolog - 在 Prolog 中将列表转换为术语

> ID：612604
> 
> 赞同：5
> 
> 时间：2009-03-04T21:47:41.687
> 
> 标签：prolog

就效率和尽可能使用现有的内置谓词而言，将 Prolog 列表转换为 Prolog 术语（不是列表）的最佳方法是什么？

接口和使用示例如下。

```
%% list_to_term(+List:list, +Functor:atom, -Term:term)
%
% Usage:
%
% ?- list_to_term([], myfunctor, Term).
% Term = myfunctor.
%
% ?- list_to_term([a, b, [c], D, 2], myfunctor, Term).
% Term = myfunctor(a, b, [c], D, 2). 
```

即给定的列表（实际上是一个嵌套的术语）被展平为具有给定名称的术语。

我并不是说这样做有意义。（但如果您认为确实如此，请在您的回答中提供一个用例。）

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-04T21:55:05.613

您需要使用`=..`运算符，如下所示：

```
list_to_term(List, Functor, Term) :-
    Term =.. [Functor | List]. 
```

# return-value - 从命令行应用程序将字符串值传递给 Inno Setup

> ID：612609
> 
> 赞同：2
> 
> 时间：2009-03-04T21:48:38.750
> 
> 标签：return-value, inno-setup

场景是我们有一个客户端/服务器应用程序，客户端安装是使用 Inno Setup 的引导程序，它从 IP/端口号指定的服务器下载客户端。我们希望能够通过 UDP 广播检测本地网络上是否有服务器，并且可以编写一个控制台应用程序来执行此操作。问题是，我们如何将信息从控制台应用程序传递给安装程序？

我可以捕获返回码，但那只能是一个 int。据我所知，在 Inno Setup 中读取文件的唯一功能是在预处理器中，因此我们无法读取控制台应用程序在运行时创建的文件。我唯一能想到的就是返回一个 int，其中前 4 位数字是 '.' 和 : 在端口之前的位置，然后解析出该值，这似乎是 hackish、脆弱且容易出错，尤其是考虑到我对构造字符串的 Inno Setup 语法/函数并不十分熟悉。

有什么建议么？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2011-03-03T15:33:14.837

如果要从 Inno Setup 中的代码解析命令行参数，请使用与此类似的方法。只需从命令行调用安装程序，如下所示：

```
c:\MyInstallDirectory>MyInnoSetup.exe -myParam parameterValue 
```

然后你可以在`GetCommandLineParam`任何你需要的地方调用这样的：

```
myVariable := GetCommandLineParam('-myParam'); 
```

```
{ ================================================================== }
{ Allows for standard command line parsing assuming a key/value organization }

function GetCommandlineParam (inParam: String):String; 
var 
  LoopVar : Integer; 
  BreakLoop : Boolean; 
begin 
  { Init the variable to known values } 
  LoopVar :=0; 
  Result := ''; 
  BreakLoop := False; 

  { Loop through the passed in array to find the parameter } 
  while ( (LoopVar < ParamCount) and 
      (not BreakLoop) ) do 
  begin 
    { Determine if the looked for parameter is the next value } 
    if ( (ParamStr(LoopVar) = inParam) and 
       ( (LoopVar+1) < ParamCount )) then 
    begin 
      { Set the return result equal to the next command line parameter } 
      Result := ParamStr(LoopVar+1); 

      { Break the loop } 
      BreakLoop := True; 
    end 

    { Increment the loop variable } 
    LoopVar := LoopVar + 1; 
  end; 
end; 
```

希望这可以帮助...

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-04T23:12:52.277

不知道如何从命令行加载参数，但是您可以使用它`LoadStringFromFile`来加载文件的内容或`GetIniString`从 ini 文件中读取参数。

更一般地，在 Inno 设置帮助文件中查找“支持功能参考”。此页面将为您提供所有 Inno 函数的列表（不包括预处理器）。如果您找不到此页面（如果您只找到有关预处理器的信息），那么您可能正在查找错误的帮助文件。请注意，Inno Setup Help 目录并不是那么好，但索引非常好。

命令行参数记录在“设置命令行参数”页面上。您可能可以通过使用现有参数之一来欺骗 Inno，但使用 ini 文件似乎是最直接的方法。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-10-09T07:03:45.097

[http://news.jrsoftware.org/news/innosetup.code/msg06538.html](http://news.jrsoftware.org/news/innosetup.code/msg06538.html)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-05T22:59:40.117

InnoSetup 包括一种解释性的类似 Pascal 的扩展语言，可以在安装程序运行时用于很多事情。

例如，我知道它可以读取注册表，并且我相当确定它可以读取文件，至少从某些文件夹中读取。您的控制台模式应用程序可以编写一个临时文件或删除一个或多个注册表项，其中包含安装程序其余部分所需的信息，并且可以从脚本环境返回到正确的安装脚本中。安装程序甚至可以稍后清理临时文件和/或密钥。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2014-06-12T05:07:27.070

应该对上述匿名答案进行投票。

通过在脚本中按名称引用参数，我能够将参数传递给我的安装程序：

```
{param:filePath|abc} 
```

然后在调用安装程序时使用所需的格式传递参数值：

```
MyInnoSetup.exe /filePath=../foo.exe 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-20T17:25:23.390

从 Inno 设置手册：

{参数：参数名称|默认值}

```
Embeds a command line parameter value.
    * ParamName specifies the name of the command line parameter to read from.
    * DefaultValue determines the string to embed if the specified command 
      line parameter does not exist, or its value could not be determined. 
```

例子：

[设置] AppId=... AppName={param:exe_name|xyz}.exe

更多： www downloadatoz com/manual/in/inno-setup/topic_consts.htm

# code-formatting - 在 IM 上格式化源代码以保留缩进的最佳方式是什么？

> ID：612610
> 
> 赞同：2
> 
> 时间：2009-03-04T21:48:53.290
> 
> 标签：code-formatting

当您将源代码粘贴给同事时，有没有办法在即时通讯程序中保留缩进？

特别是我正在尝试通过 google talk 编写一些 python 代码，但是所有选项卡都被删除了。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-04T21:59:14.310

将代码粘贴到[http://pastebin.com](http://pastebin.com)并获取用于 IM 或 IRC 对话的短链接。*（披露：我运行该网站，“其他 pastebin 可用！”:)*

# mysql - 帮助 MySQL 中的嵌套查询

> ID：612612
> 
> 赞同：0
> 
> 时间：2009-03-04T21:49:30.027
> 
> 标签：mysql

我有一个 Student_classes 表，如下所示：

```
Student_classes

Student      Classes
 Jon w.      Algebra
 Jon w.      Algebra
 Jake        English
 Scott       Spanish
 Scott       Korean
 Neo         Physics
 Anderson    Chemistry
 Anderson    Psychology 
```

我需要从这个表中获取数据，这样。

1.  如果学生，班级对只出现一次，它应该出现。
2.  如果两行有相同的学生和班级，那么应该出现一个。
3.  如果两个学生有相同的名字，但一个班级是西班牙语，那么应该只返回一行，并且应该丢弃带有“西班牙语”的行。
4.  如果两行有相同的学生但不同的班级并且它们都不是“西班牙语”，那么这两行都应该显示。

如果涵盖了所有要点，则最终查询中应包含以下内容：

```
Jake        English (covers point 1)
Jon w.      Algebra (covers point 2)
Scott       Korean (covers point 3)
Anderson    Chemistry (covers point 4)
Anderson    Psychology (covers point 4) 
```

通过以下查询，我认为我已经涵盖了所有基础，但看起来它不会涵盖第 4 点。

```
SELECT DISTINCT student, classes FROM student_classes
  WHERE classes <> 'Spanish'
  GROUP BY Student; 
```

我试图解决我遇到的一个更大问题的一个子集。

有人可以指导我提出一个涵盖所有 4 点的查询吗？

我无法更改我的数据库设计。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-04T21:53:27.070

如果您删除 GROUP BY，我认为您应该得到所需的结果

```
SELECT DISTINCT student,
                classes
FROM            student_classes
WHERE           classes <> 'Spanish' 
```

DISTINCT 处理第 1、2 和 4 点。 WHERE 子句处理第 3 点。

或者，您可以按两者进行分组：

```
SELECT DISTINCT student,
                classes
FROM            student_classes
WHERE           classes <> 'Spanish'
GROUP BY        student,
                classes 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-04T21:58:28.773

尝试这个：

```
SELECT DISTINCT student, classes FROM student_classes
WHERE classes <> 'Spanish'; 
```

尽管我建议您重新考虑使用学生的姓名作为键，而是使用数字 ID/创建学生表，因为无法区分同一班级中同名的学生...

# php - 如何在 PHP 中最好地处理我的多维数组？

> ID：612618
> 
> 赞同：0
> 
> 时间：2009-03-04T21:52:30.910
> 
> 标签：php, arrays, multidimensional-array

我有一个显示商店销售的应用程序。它是一个多维数组，因此根数组中的每个值都是一个数组，其中包含它所属的给定日期的 、 、`[sales]`等`[cost]`。`[date]`好的，每个商店都有 2 个数组。一个用于已验证的号码，下一个用于未验证的号码。未验证的会在验证后立即领取，因此未验证的第一个日期将是验证后的一天。

好的，到目前为止这一切都很好。

但是当我显示所有商店的总销售额时，我需要将所有已验证和所有未验证的数字结合起来得到总数。这是棘手的部分。经过验证的数组应该只到最低验证商店的日期，其余的都应该是未经验证的。例如：在给定日期，如果所有商店都有已验证的号码，但有一个在该日期未验证，那么它们都需要在该日期未验证。所以这就像它需要创建一个已验证的总数和一个未验证的总数，检查每个数组，如果它们都已验证，则添加到已验证的数组，否则如果有任何未验证的添加到未验证的数组。

我希望这是因为，我正在尽力解释这种情况。我确实有一个有效的算法，但它太复杂了，我每次研究它时都必须永远研究它，我希望有一个更优雅的解决方案。

谢谢！！！

这是数组结构的样子

```
$verified ( 
    [0](sales => 355, cost=> 233, date=> 2008-03-01)
    [0](sales => 235, cost=> 133, date=> 2008-03-02)
    [0](sales => 435, cost=> 143, date=> 2008-03-02)
)
$unverified ( 
        [0](sales => 232, cost=> 133, date=> 2008-03-03)
        [0](sales => 335, cost=> 233, date=> 2008-03-04)
        [0](sales => 535, cost=> 243, date=> 2008-03-05)
    ) 
```

这是虚拟数据，但实际上会有更多条目。每个商店都有这 2 个数组。两个数组的日期都不会显示；日期只会在未验证或已验证。

但是当您为每个商店有几组这些数组并且需要将它们组合起来时，不同商店的未经验证的数字将在不同的日期开始。storeA 可以在 15 日之前进行验证，而 storeB 可以在 7 日之前进行验证。所以我需要为每家商店建立一个新的`$verified`和一个新的。`$unverified`但我不能简单地结合所有验证，因为它们跨越不同的日期范围。因此，如果所有日期都已验证，那么它们会在新的主阵列中保持验证，但如果有任何日期未验证，则它们需要转到新的未验证主阵列。

如果这不成功，我很抱歉。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-04T22:14:32.760

> 更多时候，战略突破将来自重做数据或表格的表示。这是程序的核心所在。给我看你的流程图并隐藏你的表格，我会继续被迷惑。给我看你的表格，我通常不需要你的流程图；他们会很明显。

——小弗雷德里克·P·布鲁克斯，神话人物月

我假设您想为所有商店构建`$total_verified`和`$total_unverified`数组。

1.  `$total_unverified`从数组构造`$unverified`所有商店，跟踪`$earliest_unverified_date`.

2.  从每个`$verified`数组中为所有商店添加值以`$total_verified`iff 记录具有日期并且它早于`$earliest_unverified_date`将值添加到`$total_unverified`数组中。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-04T23:42:03.563

您的问题听起来像是关系数据库的用途。你在使用数据库吗？如果是这样，一个适当的查询（或两个查询）使用`GROUP BY`or`ROLLUP`可以为您节省大量的 PHP 行。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-05T01:17:17.890

我假设您正在从数据库中提取所有这些数字（如果没有，为什么不呢？），并且您的数据库看起来像

```
TABLE SalesSummary

Id   StoreId  Date        SalesTotal  CostTotal  Verified
...
231  1        2008-03-01  355.00      233.00     true
232  2        2008-03-01  299.00      233.00     true
233  1        2008-03-02  235.00      133.00     false
234  2        2008-03-02  335.00      133.00     true
235  1        2008-03-03  435.00      143.00     false
236  2        2008-03-03  319.00      143.00     false 
```

然后

```
SELECT MIN(Date) AS FirstUnverifiedDate FROM SalesSummary WHERE Verified=false 
```

找到第一个未经验证的日期，并且

```
SELECT
  (Date < $FirstUnverifiedDate) AS Verified,
  StoreId,
  SUM(SalesTotal) AS SalesSum,
  SUM(CostTotal) AS CostSum
FROM
  SalesSummary
WHERE
  Date >= $BeginningOfMonth
GROUP BY
  (Date < $FirstUnverifiedDate) DESC,
  StoreId ASC 
```

为您提供所需的销售总额 - 无需每次都从数据库中提取完整的数据集！

# c++ - “无法启动程序”（调试版本）

> ID：612624
> 
> 赞同：4
> 
> 时间：2009-03-04T21:53:30.313
> 
> 标签：c++, visual-c++, visual-studio-2005, boost

> 微软视觉工作室
> 
> 无法启动程序“theprogram.exe”。
> 
> 此应用程序无法启动，因为应用程序配置不正确。查看清单文件以了解可能的错误。重新安装应用程序可能会解决此问题。有关详细信息，请参阅应用程序事件日志。
> 
> 好的

有问题的程序是一个 C++ 项目，没有 MFC，没有 AFX，使用的库是： `opengl32.lib glu32.lib SDL.lib sdlmain.lib`加上 BoostPro 计算的预构建`libboost_signals-vc80-mt-gd-1_37.lib`。

该程序在发布版本中启动良好，但在调试时我收到上述错误消息，以及附加到调试器的僵尸进程，我无法杀死。

调试构建的清单文件：

```
<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<assembly xmlns="urn:schemas-microsoft-com:asm.v1" manifestVersion="1.0">
  <dependency>
    <dependentAssembly>
      <assemblyIdentity type="win32" name="Microsoft.VC80.DebugCRT" version="8.0.50608.0" processorArchitecture="x86" publicKeyToken="1fc8b3b9a1e18e3b"></assemblyIdentity>
    </dependentAssembly>
  </dependency>
  <dependency>
    <dependentAssembly>
      <assemblyIdentity type="win32" name="Microsoft.VC80.CRT" version="8.0.50608.0" processorArchitecture="x86" publicKeyToken="1fc8b3b9a1e18e3b"></assemblyIdentity>
    </dependentAssembly>
  </dependency>
  <dependency>
    <dependentAssembly>
      <assemblyIdentity type="win32" name="Microsoft.VC80.DebugCRT" version="8.0.50727.762" processorArchitecture="x86" publicKeyToken="1fc8b3b9a1e18e3b"></assemblyIdentity>
    </dependentAssembly>
  </dependency>
  <dependency>
    <dependentAssembly>
      <assemblyIdentity type="win32" name="Microsoft.VC80.CRT" version="8.0.50727.762" processorArchitecture="x86" publicKeyToken="1fc8b3b9a1e18e3b"></assemblyIdentity>
    </dependentAssembly>
  </dependency>
</assembly> 
```

和发布版本：

```
<?xml version='1.0' encoding='UTF-8' standalone='yes'?>
<assembly xmlns='urn:schemas-microsoft-com:asm.v1' manifestVersion='1.0'>
  <dependency>
    <dependentAssembly>
      <assemblyIdentity type='win32' name='Microsoft.VC80.CRT' version='8.0.50608.0' processorArchitecture='x86' publicKeyToken='1fc8b3b9a1e18e3b' />
    </dependentAssembly>
  </dependency>
  <dependency>
    <dependentAssembly>
      <assemblyIdentity type='win32' name='Microsoft.VC80.CRT' version='8.0.50727.762' processorArchitecture='x86' publicKeyToken='1fc8b3b9a1e18e3b' />
    </dependentAssembly>
  </dependency>
</assembly> 
```

依赖步行者：

```
Error: The Side-by-Side configuration information for "c:\prog\opengl guis\gg-0.7.0\debug\TUTORIAL.EXE" contains errors. This application has failed to start because the application configuration is incorrect. Reinstalling the application may fix this problem (14001).
Error: At least one required implicit or forwarded dependency was not found.
Error: At least one module has an unresolved import due to a missing export function in an implicitly dependent module.
Error: Modules with different CPU types were found.
Warning: At least one delay-load dependency module was not found.
Warning: At least one module has an unresolved import due to a missing export function in a delay-load dependent module. 
```

DLL：

```
DEVIL.DLL
ILU.DLL
MSVCP80D.DLL
MSVCR80D.DLL
SDL.DLL
DWMAPI.DLL
ADVAPI32.DLL
DCIMAN32.DLL
DDRAW.DLL
GDI32.DLL
GLU32.DLL
KERNEL32.DLL
MSVCRT.DLL
NTDLL.DLL
OPENGL32.DLL
RPCRT4.DLL
SECUR32.DLL
USER32.DLL
ACTIVEDS.DLL
ADSLDPC.DLL
ADVPACK.DLL
APPHELP.DLL
ATL.DLL
AUTHZ.DLL
BROWSEUI.DLL
CABINET.DLL
CDFVIEW.DLL
CERTCLI.DLL
CFGMGR32.DLL
CLBCATQ.DLL
CLUSAPI.DLL
COMCTL32.DLL
COMDLG32.DLL
COMRES.DLL
CREDUI.DLL
CRYPT32.DLL
CRYPTUI.DLL
CSCDLL.DLL
DBGHELP.DLL
DEVMGR.DLL
DHCPCSVC.DLL
DNSAPI.DLL
DUSER.DLL
EFSADU.DLL
ESENT.DLL
GDIPLUS.DLL
HLINK.DLL
HNETCFG.DLL
IEFRAME.DLL
IERTUTIL.DLL
IEUI.DLL
IMAGEHLP.DLL
IMGUTIL.DLL
IMM32.DLL
INETCOMM.DLL
IPHLPAPI.DLL
LINKINFO.DLL
LZ32.DLL
MFC42U.DLL
MLANG.DLL
MOBSYNC.DLL
MPR.DLL
MPRAPI.DLL
MPRUI.DLL
MSASN1.DLL
MSGINA.DLL
MSHTML.DLL
MSI.DLL
MSIMG32.DLL
MSLS31.DLL
MSOERT2.DLL
MSRATING.DLL
MSSIGN32.DLL
MSVCP60.DLL
MSWSOCK.DLL
NETAPI32.DLL
NETCFGX.DLL
NETMAN.DLL
NETPLWIZ.DLL
NETRAP.DLL
NETSHELL.DLL
NETUI0.DLL
NETUI1.DLL
NETUI2.DLL
NORMALIZ.DLL
NTDSAPI.DLL
NTLANMAN.DLL
ODBC32.DLL
OLE32.DLL
OLEACC.DLL
OLEAUT32.DLL
OLEDLG.DLL
POWRPROF.DLL
PRINTUI.DLL
PSAPI.DLL
QUERY.DLL
RASAPI32.DLL
RASDLG.DLL
RASMAN.DLL
REGAPI.DLL
RTUTILS.DLL
SAMLIB.DLL
SCECLI.DLL
SETUPAPI.DLL
SHDOCVW.DLL
SHELL32.DLL
SHLWAPI.DLL
SHSVCS.DLL
TAPI32.DLL
URLMON.DLL
USERENV.DLL
USP10.DLL
UTILDLL.DLL
UXTHEME.DLL
VERSION.DLL
W32TOPL.DLL
WINHTTP.DLL
WININET.DLL
WINIPSEC.DLL
WINMM.DLL
WINSCARD.DLL
WINSPOOL.DRV
WINSTA.DLL
WINTRUST.DLL
WLDAP32.DLL
WMI.DLL
WS2_32.DLL
WS2HELP.DLL
WSOCK32.DLL
WTSAPI32.DLL
WZCDLG.DLL
WZCSAPI.DLL
WZCSVC.DLL
MSVCR80.DLL
TUTORIAL.EXE 
```

链接器调用：

```
/OUT:"C:\prog\OpenGL GUIS\GG-0.7.0\Debug\tutorial.exe" /INCREMENTAL /NOLOGO /LIBPATH:"C:\prog\SDL-1.2.13\lib" /LIBPATH:"C:\prog\contrib\lib_win32" /LIBPATH:"C:\prog\boost\boost_1_37\lib" /MANIFEST /MANIFESTFILE:"Debug\tutorial.exe.intermediate.manifest" /NODEFAULTLIB:"LIBC.LIB" /DEBUG /PDB:"c:\prog\OpenGL GUIS\GG-0.7.0\Debug\tutorial.pdb" /SUBSYSTEM:CONSOLE /MACHINE:X86 /ERRORREPORT:PROMPT opengl32.lib glu32.lib SDL.lib sdlmain.lib  kernel32.lib user32.lib gdi32.lib winspool.lib comdlg32.lib advapi32.lib shell32.lib ole32.lib oleaut32.lib uuid.lib odbc32.lib odbccp32.lib ".\debug\gg.lib" 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2010-12-08T22:00:28.657

如果您右键单击解决方案并转到“属性”，则需要选择“单一启动项目”并选择您的托管项目。这对我有用。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-04T22:01:42.667

看起来调试版本链接到调试和发布运行时，这将是一件非常糟糕的事情——你没有包含在你链接的库列表中——尽管可能值得检查

编辑：可能还值得检查任何`#pragma comment (lib...)`可以强制链接器包含附加库的语句，从而导致潜在的冲突（另请参阅[MSDN 上的文档](http://support.microsoft.com/kb/153901)）

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-05T14:10:15.770

您还在调试版本的清单中列出了**两组**不同的版本！

由于您使用的是 VS2005，因此可能会有所不同，但您可能会在我的问题中找到一些有用的东西：[App does not run with VS 2008 SP1 DLLs, previous version works with RTM versions](https://stackoverflow.com/questions/59635/app-does-not-run-with-vs-2008-sp1-dlls-previous-version-works-with-rtm-versions)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-06-29T08:57:15.747

我对 Visual Studio 2005 C++ express 有一个非常相似的问题。安装平台SDK，把MSVCR80D dll放到正确的地方，但是VS好像没找到。

为 VS Express 安装 SP1 并重新启动，为我解决了这个问题。

[在这里](http://www.microsoft.com/downloads/details.aspx?familyid=7b0b0339-613a-46e6-ab4d-080d4d4a8c4e&displaylang=en)获取

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-06-29T09:27:31.973

这听起来类似于[Boost.Build 线程](http://thread.gmane.org/gmane.comp.lib.boost.build/19260/)中讨论的问题。可能的解决方案包括确保在安装 Visual Studio 时选择安装所有类型的运行时，并使用 sxstrace.exe 工具提供更详细的诊断。但是，在这种情况下，在从头开始重新安装 Visual Studio 之前没有任何效果。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-05T09:32:28.513

尝试按照错误消息的提示查看应用程序日志。我还会尝试使用[Dependency walker 之](http://www.dependencywalker.com/)类的工具来查找可能丢失/错误的 DLL 问题。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-05T09:48:24.323

这一直发生在我身上！这是我发现的一个小技巧来解决它：

1.  转到“构建 > 清洁解决方案”
2.  在“解决方案资源管理器”中，右键单击您的项目，然后转到属性
3.  确保左上角的配置是“调试”
4.  转到“链接器 > 系统 > 子系统”并将其更改为“未设置”。（如果它已经设置为“未设置”，请将其更改为“控制台”。）
5.  重建你的程序，如果它无法编译，那很好。
6.  返回“链接器 > 系统 > 子系统”并将其更改为以前的状态，然后重新编译。

现在，至于为什么会这样，我不确定。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2011-10-28T16:46:12.447

运行在调试配置中编译的应用程序时遇到同样的问题。我正在链接一个外部库，该库已与运行时库的发布版本链接，因此我最终在同一进程中同时获得了发布和调试运行时。由于我没有这个外部库的 Debug 版本，所以我不得不坚持使用 Release 构建，调试起来很麻烦，但仍然可以使用。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2011-11-06T18:07:01.560

它看起来与本文中描述的问题相同：http: [//tmoniuszko.blogspot.com/2011/11/installing-service-pack-1-for-visual.html](http://tmoniuszko.blogspot.com/2011/11/installing-service-pack-1-for-visual.html)

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2015-09-05T12:31:50.670

跟着这些步骤：

1.  将项目保存在新文件夹中。
2.  文件; 将 source.cpp 移到项目中。
3.  建造。
4.  跑。

# html - 是否有任何 CMS 编辑器可供用户使用内容填充锁定的 HTML 模板并提交？

> ID：612627
> 
> 赞同：-1
> 
> 时间：2009-03-04T21:53:54.540
> 
> 标签：html, email, editor, content-management-system

我们从事电子邮件营销工作，为客户创建 HTML/TEXT 电子邮件。本质上，我们为客户设计 HTML 电子邮件模板。然后，客户向我们发布内容（通过表单）以填充这些模板，然后再将它们发送出去。现在我们手动执行此操作，基本上是从他们提交的表单中剪切和粘贴内容到模板的相关部分，这非常耗时，而且特别令人麻木。

我们正在寻找（到目前为止还没有找到）是一个简单的系统，它允许我们以一种所见即所得的 HTML 格式捕获这个客户端内容。基本上，他们会在提交给我们之前填充模板的锁定版本，在必要时输入文本。这是我们最基本的要求，我的一个朋友在这里演示了一个概念证明：

[http://advantageone.co.uk/mbe/](http://advantageone.co.uk/mbe/)
注意：如果您单击模板正文中的文本区域，则会弹出一个编辑器。

现在我们正在寻找一个 CMS 编辑器，它可以很容易地为我们的最终客户执行上述和以下操作？

*   用户登录
*   查看他们创建的之前提交的活动并编辑这些活动
*   创建新的 - 从模板中选择（分配给他们的用户/客户端 ID），也许能够向模板添加新行。
*   并锁定这些 HTML 模板，以便他们也只能编辑允许的内容（如上面的演示），并且可能需要某些区域。
*   也许有一个简单的工作流程或内置的批准
*   允许我们在某个时间点之后锁定提交的广告系列，使其无法进一步编辑，并且作为管理员查看来自所有用户的所有广告系列
*   非常简单，关闭任何无关的功能

本质上是一个非常简单的 CMS，但我们使用输出的 HTML 作为电子邮件发送，而不是发布到网络上。

现在进入实际的困境：我们正在寻找一些非常简单的东西，上面听起来像一个 CMS。但是我们还没有找到任何已经做到的，或者可以很容易地适应这样做的东西。一切要么太复杂，要么简单且不灵活。我们确信一定有现成的东西可用，而不是我们自己编写一些东西。

但我们有点卡住了。有谁知道一个系统，或者可以推荐一个可以开箱即用或经过几天调整的系统？

如果这有点脱节，请原谅我，如果我非常愚蠢并且那里有什么东西，请告诉我！

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-04T23:19:46.660

如果我错了，请纠正我，但您真正想要的是一个表单构建器，它接受提交的表单，使用模板重新格式化它，然后根据表单将生成的文档通过电子邮件发送给一定数量的用户，对吗？

必须有数百种表单产品，也许您在搜索 CMS 时不知道将其称为表单。

（我不想在这里链接到我知道的特定表单产品，因为我担心它看起来像一个骗子。）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-04T22:05:01.083

我当然不是 CMS 专家，我的经验正如您已经观察到的那样；各种 CMS 中嵌入了一系列高级编辑器，还有一些只提供纯文本功能。

您正在寻找的是中间的一个不同的特定点，我不希望您会找到任何满足您需求的系统。

开发自己的可能是唯一合理的解决方案；但是，尽管您的要求非常具体，但它们也相当简单，因此如果您没有内部技能，那么开发这样一个工具应该要花*很多*钱。

祝你好运！

# php - 当我尝试使用 PHP 对 .js 文件进行 GZIP 压缩时，出现某种与 php 相关的错误

> ID：612628
> 
> 赞同：1
> 
> 时间：2009-03-04T21:54:03.747
> 
> 标签：php, javascript, .htaccess, gzip

好的，所以我搜索了几页并提出了以下解决方案：

在 .htaccess 中添加这个

```
#Active GZIP for php-files
php_flag zlib.output_compression On 
php_value zlib.output_compression_level 5 
```

这适用于 .js 和 .css：

```
AddHandler application/x-httpd-php .css .js
php_value auto_prepend_file /Library/WebServer/Documents/blog/code/Helpers/ContentHeader.php 
```

它将执行 .js 以及 .css 作为 php 脚本。第二行包括以下页面：

```
<?php
    $pathInfo = pathinfo($_SERVER['PHP_SELF']);
    $extension = $pathInfo['extension'];

    if($extension == "css")
    {
        header("Content-type: text/css");
    }
    if($extension == "js")
    {
        header("Content-type: text/javascript");
    }
?> 
```

这会将标题“text/css”发送到 .css 文件，将“text/javascript”发送到 javascript 文件。到现在为止还挺好。然而，问题在于我使用的几个缩小的 javascripts 我得到了某种 php 错误：

```
<br />
<b>Parse error</b>:  syntax error, unexpected ']' in <b>/Library/WebServer/Documents/blog/public/scripts/prettify/prettify.js</b> on line <b>18</b><br /> 
```

**或者：**

```
<br />
<b>Warning</b>:  Unexpected character in input:  '\' (ASCII=92) state=1 in <b>/Library/WebServer/Documents/blog/public/scripts/showdown.js</b> on line <b>29</b><br />
<br />
<b>Parse error</b>:  syntax error, unexpected '?' in <b>/Library/WebServer/Documents/blog/public/scripts/showdown.js</b> on line <b>29</b><br /> 
```

那么，有没有更好的方法来做到这一点？我能想到的唯一选择是手动进入 .javascript 文件并“纠正 php 不喜欢的错误”。但它不应该是一个更简单的解决方案吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-04T21:57:28.993

我们使用[Apache Mod_Deflate](http://httpd.apache.org/docs/2.0/mod/mod_deflate.html)并使用那里显示的示例配置。无需在 PHP 中破解就可以很好地工作。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-04T22:03:13.020

我实际上是从 PHP 脚本提供我的 JS 文件。不是因为这个问题，而是我可以控制过期标头和缓存。一般模型为：

*   URL 类似于 /script/blah.1234567890.js；
*   该 URL 是从 blah.js 文件的 mtime 生成的；
*   该 URL 通过 .htaccess 中的重写规则发送到 js.php 脚本；
*   该脚本检查传入的 mtime。如果它比缓存版本的 mtime 更新，它会从我所有的 JS 文件（整理成一个文件，然后用 JSMin 缩小）生成一个新的缓存版本；
*   如果 mtime 不比脚本新，则只提供缓存版本；
*   在所有情况下，内容都将在一年后到期。

URL 中的时间戳允许刷新脚本文件。

现在这与 gzipping 有什么关系？简单的。在我的 js.php 脚本的顶部是：

```
ob_start("ob_gzhandler") 
```

如果客户端支持它（以及使用输出缓冲），它会打开 gzip 压缩。

它真的很有效。

尝试将自己限制在一个 JS 和一个 CSS 文件中。如有必要，将它们组合起来。我也对 CSS 文件做同样的事情（当然没有缩小）。

此解决方案的优点是它仅依赖于启用 mod_rewrite。不需要其他扩展（ob_gzhandler 是 PHP 的标准部分）。此外，还需要一个脚本来组合文件（除非您将其作为构建过程的一部分，但我觉得这有点乏味）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-04T22:08:30.230

您收到此错误的原因是脚本包含`<?`. 例如，在 prettify.js 中是这样的：

```
/^[^<?]+/ 
```

您将其传递给 PHP，以便重新启动 PHP 引擎并看到意外的`]`.

如果您需要更多控制，我会使用@jonstjohn 的方法或@cletus 的方法。

# java - glassfish 中的 Java 堆空间错误

> ID：612634
> 
> 赞同：9
> 
> 时间：2009-03-04T21:54:50.217
> 
> 标签：java, glassfish, application-server, out-of-memory, jboss-mdb

我正在使用全新的 Glassfish 安装，几乎没有自定义。

我有一个消息驱动 Bean (ObjectUpdateMDB)，它侦听一个主题，然后更新它在数据库中接收到的对象。有很多对象正在更新。运行一段时间后，我得到了这个异常：

```
严重：JTS5031：资源 [回滚] 操作上的异常 [org.omg.CORBA.INTERNAL：vmcid：0x0 次要代码：0 已完成：可能]。
严重：MDB00049：消息驱动 bean [Persistence:ObjectUpdateMDB]：postinvoke 中的异常：[javax.transaction.SystemException：org.omg.CORBA.INTERNAL：JTS5031：异常 [org.omg.CORBA.INTERNAL：vmcid：0x0 次要代码: 0 完成：可能] 对资源 [回滚] 操作。vmcid：0x0 次要代码：0 已完成：否]
严重：javax.transaction.SystemException
javax.transaction.SystemException：org.omg.CORBA.INTERNAL：JTS5031：资源[回滚]操作上的异常[org.omg.CORBA.INTERNAL：vmcid：0x0次要代码：0已完成：可能]。vmcid：0x0 次要代码：0 已完成：否
    在 com.sun.jts.jta.TransactionManagerImpl.rollback(TransactionManagerImpl.java:350)
    在 com.sun.enterprise.distributedtx.J2EETransactionManagerImpl.rollback(J2EETransactionManagerImpl.java:1144)
    在 com.sun.enterprise.distributedtx.J2EETransactionManagerOpt.rollback(J2EETransactionManagerOpt.java:426)
    在 com.sun.ejb.containers.BaseContainer.completeNewTx(BaseContainer.java:3767)
    在 com.sun.ejb.containers.BaseContainer.postInvokeTx(BaseContainer.java:3571)
    在 com.sun.ejb.containers.MessageBeanContainer.afterMessageDeliveryInternal(MessageBeanContainer.java:1226)
    在 com.sun.ejb.containers.MessageBeanContainer.afterMessageDelivery(MessageBeanContainer.java:1197)
    在 com.sun.ejb.containers.MessageBeanListenerImpl.afterMessageDelivery(MessageBeanListenerImpl.java:79)
    在 com.sun.enterprise.connectors.inflow.MessageEndpointInvocationHandler.invoke(MessageEndpointInvocationHandler.java:139)
    在 $Proxy98.afterDelivery（未知来源）
    在 com.sun.messaging.jms.ra.OnMessageRunner.run(OnMessageRunner.java:324)
    在 com.sun.enterprise.connectors.work.OneWork.doWork(OneWork.java:76)
    在 com.sun.corba.ee.impl.orbutil.threadpool.ThreadPoolImpl$WorkerThread.run(ThreadPoolImpl.java:555)

信息：MDB00037：[Persistence:ObjectUpdateMDB]：消息驱动的 bean 调用异常：[java.lang.OutOfMemoryError：Java 堆空间]
信息：java.lang.OutOfMemoryError
java.lang.OutOfMemoryError：Java 堆空间

```

看起来这是堆空间的问题。我需要调整堆空间做什么？应用服务器本身还是代理？我该怎么做呢？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-03-04T22:00:25.413

您需要为 Glassfish 安装分配更多 RAM。

见[http://spaquet.blogspot.com/2006/07/liferay-glassfish-part-ii-configuring.html](https://web.archive.org/web/20150525031346/http://spaquet.blogspot.com/2006/07/liferay-glassfish-part-ii-configuring.html)

和[http://docs.sun.com/app/docs/doc/820-4495/gepzd?a=view](https://web.archive.org/web/20090217121946/http://docs.sun.com/app/docs/doc/820-4495/gepzd?a=view)。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2011-02-11T14:00:25.073

我使用以下`asadmin`命令对 Glassfish 3.1 上的问题进行排序：

```
asadmin create-jvm-options --target server-config -- '-XX\:+UnlockExperimentalVMOptions'
asadmin create-jvm-options --target server-config -- '-XX\:+UseG1GC'
asadmin delete-jvm-options --target server-config -- '-Xmx512m'
asadmin create-jvm-options --target server-config -- '-Xmx1024m'
asadmin delete-jvm-options --target server-config -- '-XX\:MaxPermSize=192m'
asadmin create-jvm-options --target server-config -- '-XX\:MaxPermSize=256m'

asadmin create-jvm-options --target default-config -- '-XX\:+UnlockExperimentalVMOptions'
asadmin create-jvm-options --target default-config -- '-XX\:+UseG1GC'
asadmin delete-jvm-options --target default-config -- '-Xmx512m'
asadmin create-jvm-options --target default-config -- '-Xmx1024m'
asadmin delete-jvm-options --target default-config -- '-XX\:MaxPermSize=192m'
asadmin create-jvm-options --target default-config -- '-XX\:MaxPermSize=256m' 
```

这是迈克尔迈尔斯暗示的变体。使用`asadmin`命令使更改易于重复。

我也换用了新的 G1 收集器，它比普通收集器好很多。也有助于 Eclipse ;-)

请注意，语法适用于 Windows 上的 TakeCommand。如果您使用不同的 shell 和操作系统组合，您可能需要不同的转义字符（对于大多数 unix shell，iE 海峡记号而不是反引号）。

如果你用命令搞砸了你的设置，`*-jvm-options`那么你可以用`domain.xml`文件修复它。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-04T22:16:00.743

我的博客上有一篇关于[VM 调优](http://themindstorms.wordpress.com/2009/01/21/advanced-jvm-tuning-for-low-pause/)的文章，我正在向读者介绍[Java 调优白皮书](http://java.sun.com/performance/reference/whitepapers/tuning.html)。

无论如何，为了让您快速获得答案，您可能应该查看几个基本设置：

-Xms：初始堆大小

-Xmx：最大堆大小

要获得这些的快速描述，只需运行：java -X。

./亚历克斯

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-07T11:19:05.277

我不知道这是否相关，但我们在使用 XA 事务时遇到了一些奇怪的异常，导致 CORBA 异常。原因是 MySQL 驱动程序，我们升级到最新的 MySQL JDBC 驱动程序（5.1.7），然后这些 XA 问题就消失了。

# javascript - 将动态生成的 dijit 附加到 div 的末尾

> ID：612642
> 
> 赞同：0
> 
> 时间：2009-03-04T21:56:50.383
> 
> 标签：javascript, dojo

有没有办法创建 dijit 并将其附加到 div 的末尾？假设我有以下代码：

```
<div id="attendants">
</div>

<button dojoType="dijit.form.Button" onClick="addPerson();">Add Person</button> 
```

我在网上找到了以下代码，但这取代了我的 'attendants' div：

```
var personCount = 0;
function addPerson() {
    personCount += 1;
    var attendants = dojo.byId('attendants');
    var newField   = new dijit.form.TextBox({id: 'newPerson' + personCount, name: 'newPerson' + personCount}, attendants);
} 
```

我想动态地向 div 添加一个新的 TextBox dijit，而不是用 dijit 替换 div。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-06T18:55:57.590

答案是：[dijit._Widget.placeAt](http://api.dojotoolkit.org/jsdoc/dijit/1.2/dijit._Widget.placeAt)

```
// place a new button as the first element of some div
var button = new dijit.form.Button({ label:"click" }).placeAt("wrapper","first"); 
```

# c# - 简单的文档管理系统和API

> ID：612646
> 
> 赞同：3
> 
> 时间：2009-03-04T21:58:07.777
> 
> 标签：c#, .net, document-management

在我的软件中，我需要能够连接到一个非常简单的文档管理系统。

我需要能够：

1.  签入/签出文件
2.  添加文件
3.  删除文件
4.  *也许是*版本文件。（领域专家说不，我怀疑他错了。）

这时候我们就没有必要去搜索文档了。

我需要能够从 C# 程序执行此操作，因此必须有一个 .net API。

我需要有不止一个客户能够同时做到这一点。

我最终也需要能够通过网络连接来做到这一点。但只是以后。

这是一个更大的应用程序的一部分，所以我必须能够保持低成本。我认为我不需要像 Documentum 或高端 DM 产品那样复杂的东西。

客户将销售应用程序，因此必须有一个友好的转售协议。

外面有这样的吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-04T22:10:40.023

为什么不使用[WSS (Windows SharePoint Services)](http://office.microsoft.com/en-us/sharepointtechnology/FX100503841033.aspx)，它在 Windows Server 中是免费的，并提供您正在寻找的所有功能和 API 来管理文档、签入/签出版本控制、工作流程等等。它还已经内置了管理界面。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-04T22:01:24.553

关于版本文档的需要：您的领域专家*肯定*是错误的。不仅用户最终会提出这个要求或需要合并某些东西，而且一旦你确定了其他要求，版本控制也很容易添加，所以你不妨去做。

也许您可以将 C# 前端放在颠覆存储库中。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-04T22:55:49.167

Share point based solutions are the most cost effective out there right now. If you're looking to sell a product, you're probably too late. There are A LOT of document management systems that have veered away from the Documentum platform. Check out [NextDocs](http://www.nextdocs.com) for a pretty good SharePoint based solution.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-08-10T03:15:45.960

Why don't you try out [Alfresco](http://www.alfresco.com/). They provide quite a nice set of API capabilities as well (includes web services which can be used in .NET).

Regarding the reseller agreement - not sure of this one.

# resharper - 如何强制 StyleCop for ReSharper 忽略文件？

> ID：612651
> 
> 赞同：14
> 
> 时间：2009-03-04T21:59:50.190
> 
> 标签：resharper, stylecop

我们一直致力于将 StyleCop 引入我们的团队，并且正在使用 Code Plex 的[StyleCop ReSharper 插件](http://stylecopforresharper.codeplex.com/)。问题是，项目中的每个文件似乎都在被分析，我们找不到排除特定文件的方法。这包括文件，例如来自 DBML 的 Designer.cs 文件或项目中包含的第三方组件。这意味着您在 ReSharper 中的站点范围的代码分析总是会显示错误，并且您永远无法让它变为“绿色”。

始终有 ExcludeFromStyleCop 标记，您可以将其放入 .csproj 中，但这仅由 MSBuild 使用。右键单击 ReSharper 错误窗口中的文件并告诉它“忽略错误”似乎也不起作用；窗口只是重新加载，并且再次分析相同的文件。

有人对此有任何想法吗？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2011-12-27T20:03:38.467

这就是我一直在寻找的，除了在 Resharper 6 中，在特定文件中禁用检查的正确击键是： `Ctrl`+ `Shift`+ `Alt`+`8`

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-03-04T23:10:26.603

“您确定您已取消选中指定 stylecop 应检查设计器文件的 StyleCop 设置选项吗？（StyleCop 选项 > 规则 > 详细设置 > 分析设计器文件）？”

[http://stylecopforresharper.codeplex.com/Thread/View.aspx?ThreadId=47346](http://stylecopforresharper.codeplex.com/Thread/View.aspx?ThreadId=47346)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-10-13T19:56:17.753

`CTRL`您可以通过按+完全禁用特定文件的 ReSharper `8`。您会看到代码窗口右上角（在装订线顶部）的小“眼睛”变灰，表示它已被禁用。

再次按下按键以重新启用它。

# regex - 现代编程语言中的“正则表达式”真的是“上下文敏感语法”吗？

> ID：612654
> 
> 赞同：10
> 
> 时间：2009-03-04T22:00:08.737
> 
> 标签：regex, idioms, context-free-grammar

多年来，“正则表达式”模式匹配变得越来越强大，以至于我想知道：它真的只是上下文敏感的语法匹配吗？它是上下文无关语法匹配的变体/扩展吗？它现在在哪里，为什么我们不直接称它为旧的、限制性的“正则表达式”？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-03-04T22:15:54.113

特别是对捕获括号的反向引用使正则表达式比常规的、上下文无关的或上下文敏感的语法更复杂。这个名字只是历史上成长的（和很多词一样）。另请参阅Wikipedia 中的[此部分](http://en.wikipedia.org/wiki/Regular_expression#Patterns_for_non-regular_languages)以及使用Perl[示例的说明。](http://perl.plover.com/NPC/)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-04T22:17:03.860

我的看法：

*   常规语言：
    *   由状态机匹配。在要匹配的语法中只能用一个变量来表示当前的“位置”：无法实现递归
*   上下文无关语言：
    *   由堆栈机匹配。语法中的当前“位置”由一种或另一种形式的堆栈表示。无法“记住”之前发生的任何事情
*   上下文相关语言：
    *   大多数编程语言
    *   ~~所有~~大多数人类语言

我确实知道正则表达式解析器，它允许您匹配解析器已经遇到的东西，实现类似于上下文相关语法的东西。

尽管如此，正则表达式解析器，无论它们多么复杂，都不允许递归应用规则，这是上下文无关语法的明确要求。

在我看来，术语*regex*主要是指用于表达那些常规**语法**（星号和问号）的语法。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-04T22:45:45.057

现代正则表达式实现中的一些特性打破了[经典正则表达式定义](http://en.wikipedia.org/wiki/Regular%5Fexpression#Formal_language_theory)的规则。

例如[Microsoft 的 .NET*平衡组* `(?<`*`name1`*`-`*`name2`*`> … )`](http://msdn.microsoft.com/library/bs2twtah.aspx)：

```
^(?:0(?<L>)|1(?<-L>))*(?(L)(?!))$ 
```

这*与*语言*L* ₀₁ = { *ε* , 01, 0011, 000111, ... } 匹配。[但是根据Pumping Lemma](http://en.wikipedia.org/wiki/Pumping_lemma)，这种语言不是规则的。

# java - 搜索通用异步 Java 作业执行框架/库

> ID：612656
> 
> 赞同：5
> 
> 时间：2009-03-04T22:00:38.363
> 
> 标签：java, spring, executorservice

我正在寻找可以处理`Callable`s 或`Runnable`s 的通用异步 Java 作业执行框架。它类似于`java.util.concurrent.ExecutorService`, （也可能是 wrap `ExecutorService`），但它还具有以下特性：

1.  将作业持久化到数据库的能力，以防应用程序在为作业提供服务时出现故障，并且能够重新启动未完成的作业。（我知道我的工作可能必须执行`Serializable`，这是可以的。）

2.  使用 UUID 使客户端能够获取作业令牌并查询作业状态。（在后台，这些信息也将保存到数据库中。）

我已经开始自己通过构建来解决这个问题`ExecutorService`，但我更喜欢开箱即用的开源解决方案，如果存在的话。

可以在 Spring 框架中工作的东西将是理想的。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-04T22:08:01.433

你可能想看看[Quartz](http://www.quartz-scheduler.org/)。

> Quartz 是一个功能齐全的开源作业调度系统，可以与几乎任何 J2EE 或 J2SE 应用程序集成或一起使用——从最小的独立应用程序到最大的电子商务系统。Quartz 可用于创建简单或复杂的调度，以执行数十、数百甚至数万个作业；任务被定义为标准 Java 组件或 EJB 的作业。Quartz Scheduler 包括许多企业级功能，例如 JTA 事务和集群。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-04T22:08:30.107

您可以使用[Quartz](http://www.opensymphony.com/quartz/)并创建一个[`Job`](http://www.opensymphony.com/quartz/api/org/quartz/Job.html)委托给 a`Runnable`或的具体适配器`Callable`。Quartz 的`Job`接口增加了在任务调用之间维护某些状态的能力。如果需要，Quartz 可以将作业及其状态持久地存储在关系数据库中，并在可扩展的主机集群上执行它们。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-04T22:10:06.360

看看[http://www.opensymphony.com/quartz/wikidocs/Features.html](http://www.opensymphony.com/quartz/wikidocs/Features.html)看看它是否已经为你准备好了。

从该页面：

> *通过使用包含的 JDBCJobStore，所有配置为“非易失性”的作业和触发器都通过 JDBC 存储在关系数据库中*

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-05T03:00:33.197

另一个方向可能是使用[Terracotta](http://terracotta.org)，它能够在 JVM 中集群堆并将其持久化以确保可用性。如果从调度的角度来看这是有用的，Terracotta 支持与[Quartz的集成。](http://www.terracotta.org/web/display/orgsite/Quartz+Integration)此外，还有一个主从器和消息传递[集成模块](http://www.terracotta.org/web/display/orgsite/Master+Worker)也可能有用。Terracotta 是开源的。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-06T19:29:18.693

为了跟进 Alex 的观点，Terracotta 解决方案不会将您的作业持久化到数据库中，它们将持久化在 Terracotta 分布式内存存储中。

由于 Terracotta 将内存存储持久化到磁盘，因此这是将这些作业放入数据库的更有效版本。

同时，它为您提供了一个纯 POJO 编程模型，因此您甚至不必处理 DB txns、ORM 等 - 除非您的特定工作负载碰巧与 DB 对话（在这种情况下，Terracotta 不会在这里帮助或伤害你，它只是帮助分配工作）。

MasterWorker 模式将帮助您在网格上分配工作，您可以非常轻松地开始使用 DistributedExecutorService，提交工作如下所示：

```
CompletionService executor = new DistributedCompletionService(new DistributedExecutorService("myTopologyName"));
executor.submit(new MyRunnable(), null);
...
Future f = executor.take(); 
```

[这是 Terracotta Forge 上 master-worker 实现中快速入门指南](http://forge.terracotta.org/releases/projects/tim-messaging/docs/quickstart.html)的链接。

更重要的是 - Terracotta 不需要你实现 Serializable - 虽然你可以如果你想:)

# php - json 发布请求大小限制（现在是经过验证的 php-mysqli 错误）

> ID：612657
> 
> 赞同：3
> 
> 时间：2009-03-04T22:00:41.077
> 
> 标签：php, json, apache2

我正在通过 JSON 编码的 ajax 请求（表单流程）向我的 PHP 应用程序发送请求。成功处理了一个字符长度为 4174 的 post-request，并正确接收了结果。在请求中添加一个额外的字符会导致我的应用程序无限循环，直到 Apache2 段错误。只有 2 个字段，一个用于 3 位 id，其余是来自文本区域的文本。

我正在使用 Zend Framework 来驱动我的应用程序，Apache2.2.3，PHP 5.2.8，JSON 插件版本 1.2.1，MySQL 5.0.77

有人有想法么...

这是另一个更新:: 跟踪此问题不是 json 请求问题，而是我正在运行的查询的问题。我正在执行 INSERT ON DUPLICATE KEY UPDATE 查询，该查询会增加查询的文本大小。我可以从命令行运行这个查询 find ，但是从 PHP 中它失败了。目前正在调查该问题。任何有兴趣的人都可以在这里查看查询..

** 这是 php 的 mysqli 插件的一个错误，由于某种原因，db 处理程序不喜欢此代码。如果/当我有时间正确测试时，您会看到我的结果。**

```
INSERT INTO element_attribute_values (ElementAttributeId,ElementId,value) VALUES  (1,'553','444st text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this itext this itext this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test tex this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is sotext this ime test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test tex tesxthis is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is fsome test texttext this i this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is sometext this i test text this is some test text this is some test text this is sothis is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text thisf iffffffff4444') ON DUPLICATE KEY UPDATE value='444st text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this itext this itext this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test tex this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is sotext this ime test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test tex tesxthis is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is fsome test texttext this i this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is sometext this i test text this is some test text this is some test text this is sothis is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text this is some test text thisf iffffffff4444' 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-04T22:44:44.060

我不知道这是否相关，但我最近使用 jQuery 使用 $.ajax() 方法将 POST 数据从文本字段提交到 php 脚本。然后，php 脚本将解析数据 (XML) 以获取我需要的信息位。我注意到我的 firephp 输出中有一个错误，它无法解析 POSTed 表单中的 XML。然后我让它输出 strlen() 和数据，并注意到它正在将它从大约 7k 字节减少到 268（或 256 或我忘记确切数量的东西）。这使其成为不完整且无效的 XML 数据堆。我改用 $.post() 方法解决了这个问题。工作完美。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-08-21T17:31:15.340

您可以简单地检查字符串的长度，如果超过限制，请将其拆分。在插入中运行第一部分，然后`+=`使用第二部分对字段进行更新。这有点粗糙，但它绕过了这个错误。

# grep - 如何 grep 计算管道数（'|'）？

> ID：612658
> 
> 赞同：2
> 
> 时间：2009-03-04T22:00:54.617
> 
> 标签：grep

我试过了：

```
 grep -c "\|" *.* 
```

但它不起作用，因为它给出了不正确的连续管道计数。

我怎样才能做到这一点？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-03-04T22:18:17.057

您可以使用`tr(1)`删除所有非管道字符，然后使用`wc(1)`获取总数：

```
cat *.* | tr -d -c '|' | wc -c 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-05T00:24:15.443

这是违反直觉的，但在大多数 unix 正则表达式中，转义 the`|`使其成为或运算符。因此，您的行实际上与“无或无”匹配（您可以通过在任一侧添加一些替代方案来测试这一点）。只需使用

```
grep -c "|" *.* 
```

其次，grep 计算行数，而不是字符出现次数。您可以使用不同的工具；或者，如果您坚持使用 grep，则可以将每个“|” 在自己的线上。例如，使用 sed：

```
sed 's/|/|\n/g' *.* 
```

注意：如果使用 sed，我建议进行*大量*测试以确保它按照您的想法执行。我当时需要。

最后，结合成分：

```
cat *.*  |  sed 's/|/|\n/g'  |  grep -c "|" 
```

不幸的是，这可能对您不起作用，因为您可能没有使用 unix（因为`*.*`. 但希望它能解释这个问题，我总是觉得奇怪的是让人放心。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-04T22:49:34.453

另一个使用 Perl 的选项是：

```
perl -e 'while(<>){$c+=tr/|/|/};print "$c\n"' * 
```

在非单行格式中：

```
while(<>){
    $c += tr/|/|/
}
print "$c\n" 
```

该`while(<>){`行是 Perl 的魔法，用于从命令上的文件或从`STDIN`. 一段时间后你就习惯了。该行本身进入一个名为 的变量`$_`，这是许多 Perl 命令的默认参数。例如`tr`，它的工作方式有点像`tr(1)`，默认为操作`$_`。我将我的结果放在一个名为`$c`. （在完整的程序中，最好将其声明为带有`my $c = 0;`循环外的词法变量。）`+=`运算符将`tr`命令的结果（在这种情况下为管道字符的数量）添加到`$c`.

仅使用`tr(1)`显然是一个更简单的选择。;-)

Using`*.*`是一种 DOSism，您可能不想在类 UNIX 平台上使用它。

使用单引号来避免 shell 解释管道字符会更好一些。例如，我测试了我的答案：

```
$ echo '||||
|||||' | perl -e 'while(<>){$c+=tr/|/|/};print "$c\n"'
9 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2014-05-20T18:35:31.430

如果要查找多个管道，则

```
fgrep -o "|" | wc -l 
```

如果你想找到至少有一个管道的多条线，那么

```
fgrep -c "|" 
```

* * *

## 回答 #5

> 赞同：-3
> 
> 时间：2009-03-04T22:05:16.387

尝试

```
grep -c "\|" *.* 
```

并阅读一些关于 bash 的教程

# sql - 如何在 Excel 外部数据请求中使用参数？

> ID：612664
> 
> 赞同：3
> 
> 时间：2009-03-04T22:01:31.060
> 
> 标签：sql, excel, excel-2007

我已经可以使用 Excel (2007) 从 SQL Server 2005 导入数据。我添加了一个数据连接并输入了一个自定义 SQL 查询来检索我想要的数据。凉爽的。

但我想补充的是，能够根据在电子表格的已知单元格中找到的值对该查询进行参数化。

我的查询将从

```
SELECT * FROM dbo.MyDataTable WHERE Col1 = 'apples'
```

类似于

```
SELECT * FROM dbo.MyDataTable WHERE Col1 = 'Cell("B2")'
```

这可能吗？如果是这样，怎么做？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-11T14:45:57.803

如果您[使用 MS Query](http://office.microsoft.com/en-us/excel/HA100996641033.aspx?pid=CH100648471033)将数据导入 Excel，[此页面](http://office.microsoft.com/en-us/excel/HP102161131033.aspx?pid=CH100648471033)显示如何使用工作表上单元格中的值作为查询中的参数。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-05T11:49:42.350

尝试按如下方式构建代码：

```
Dim strSQL as String
Dim strFruit As String

strFruit = CStr(ThisWorkbook.Sheets("Sheet1").Range("A1").FormulaR1C1)

strSQL = "SELECT * FROM dbo.MyDataTable WHERE Col1 = '" & strFruit & "'" 
```

我发现在将参数合并到 SQL 查询之前先将参数加载到变量中很有用。

它使您的 SQL 字符串更具可读性，并允许您在使用之前检查/清理参数。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-05T13:52:33.130

我没有使用 Excel 2007，但在以前的 Excel 版本中，我真的很讨厌 SQL 查询集成。特别是，我发现如果不将一堆 VBA 代码拼凑在一起，很难完全按照您的要求进行操作。我做了一些研究，最后决定使用 Rob Van Gelder 的 Excel 查询插件：

[http://vangelder.orconhosting.net.nz/excel/queryeditor.html](http://vangelder.orconhosting.net.nz/excel/queryeditor.html)

他的 GUI 中的“参数”部分允许您设置参数并让实用程序提示用户输入值或从单元格引用中提取值。我相信后者正是您想要做的。它还具有在单元格值更改时自动刷新的能力。在验证数据库中的数据时，我经常使用自动刷新功能。

我遇到过几种情况，我的查询已损坏，我无法再打开它们或查看文本。因此，我建议在 Excel 电子表格中为您的查询保留一个选项卡，并将查询文本复制到该特殊页面上的单元格中。这样，如果查询工具吃掉了您的查询，您就不必从头开始重建它们。

第三方工具虽然是免费的，但可能不是您想要的，但对我来说效果很好。祝你好运！

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-04T22:48:55.033

```
Dim SQLString as String

SQLString = "SELECT * FROM dbo.MyDataTable WHERE Col1 = '" & Cells("B2") & "'" 
```

看看[SQL 注入攻击](http://en.wikipedia.org/wiki/SQL_injection)以了解这种方法的缺点是值得的，但它可能不一定是您需要做的事情的考虑因素

# macos - 使用 Autoconf 在 Mac 上检测 32 位与 64 位 Intel CPU

> ID：612672
> 
> 赞同：1
> 
> 时间：2009-03-04T22:03:28.277
> 
> 标签：macos, 64-bit, shared-libraries, autoconf

我正在为应该在 32 位和 64 位 Linux 和 Mac 上运行的项目开发 Autoconf 脚本。在 Linux 上，检测 64 位很容易：你得到`x86_64`而不是`i386`for `build_cpu`. 我不知道如何为 Mac 做到这一点：32 位和 64 位机器都`i386`提供`build_cpu`. 有没有办法使用 Autoconf 内置函数来检测差异？

额外问题：在 64 位 CPU 上，是否有比以下方法更好的方法来以编程方式检测二进制文件是 32 位还是 64 位？

```
file NAME_OF_BINARY | sed -e 's/.*[^0-9]\([0-9]*\)-bit.*/\1/g' 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-06T13:15:22.823

The reason you get `i386` for `build_cpu` is probably because `gcc` compiles in 32-bit mode by default on Mac OS X, even on 64-bit CPUs. The easiest way to handle this is probably to push it off on the user: if they want a 64-bit binary, they can pass in `--build=x86_64-darwin` to `configure`.

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-04T22:21:59.903

要找出二进制文件支持哪些架构，您可以使用文件，您可以解析 的输出`otool -f [name of bin]`，您可以解析 的输出`lipo -info [name of bin]`，或者您可以自己读取胖文件头（这是一个相当简单且有据可查的结构）。如果您有一个单一架构的二进制文件，那么`otool`可以告诉您有关 Mach-O 标头的信息，该标头告诉您它是为哪个架构编译的。

不知道 autoconf 在内部作为主机架构为您提供了什么，但作为 x86_64 Mac 可以运行 x86_64、i386 或 ppc7400 二进制文件，区别有点没有实际意义。要么编译一个通用二进制文件，这是 Apple 建议你做的，要么查看`sysctl hw.optional.x86_64`以确定你在哪个盒子上。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-09T14:39:40.520

要记住的一件事是，在 Mac 上，您可以针对多种架构进行编译，并生成“通用二进制文件”（以前称为“胖二进制文件”）。简单地同时编译可能会更好`-arch i386 -arch x86_64`，这将允许用户在运行时选择运行哪一个（`-arch ppc -arch ppc64`如果你想支持旧的 PPC Macs，你也可以包括在内）。这样，如果用户最终将他们的文件系统从一台机器移动到另一台机器，他们仍将拥有适用于给定机器的二进制文件。有关详细信息，请参阅[64 位转换指南](http://developer.apple.com/DOCUMENTATION/Darwin/Conceptual/64bitPorting/building/building.html)。

# jquery - 我应该避免在样式表中定义的 CSS 类上使用 jQuery 选择器吗？

> ID：612673
> 
> 赞同：8
> 
> 时间：2009-03-04T22:03:39.883
> 
> 标签：jquery, html, css

我关心在我的 jQuery 选择器中使用样式表中定义的 CSS 类。这样做的原因是，当在样式表中定义 CSS 类时，开发人员/设计人员有很多原因要更改类的名称或它在 html 中的使用方式，该 html 与也使用的 jQuery 选择器分离。班级。没有什么明显的东西可以告诉开发人员/设计人员在进行此更改时需要考虑 JavaScript 功能。

避免将 jQuery 选择器与合法的 CSS 类耦合会更好吗，而是使用不与任何样式绑定的 CSS 类，并且有一个像“j_”这样的前缀，这使得它的目的很明显，专门用作jQuery选择器？这将以标记中的额外类名为代价使耦合不那么脆弱。这也将使发现未定义类的验证引擎变得不那么有用，但前缀有望使这些类明显地用作 jQuery 选择器。

……

我知道 CSS 类应该根据它们的功能来命名。但是，我不相信以这种方式命名课程可以解决问题。即使他们的新名称仍在描述相同的功能，开发人员/设计人员仍将更改名称，或者他们可能会修改其使用位置。在这些情况下，这些更改是否会影响 JavaScript 功能并不明显。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-04T22:08:21.120

css 类名应该描述元素的功能，而不是应用于它的样式。如果您有一个向左浮动的侧边栏，请调用类侧边栏，而不是 leftFloat。这样，您可以将侧边栏的样式放在 css 中的侧边栏类中，并应用您需要的任何 jquery 函数。

编辑以澄清其中一条评论：您不必重命名元素的类或 id。如果您有侧边栏，那么它可能会改为工具栏或顶部导航。它仍然被称为侧边栏是否重要？用户永远不会注意到。或者你可以给一切真正抽象的名字，比如导航窗格和主要内容。

上周我用 jQuery 启动了一个 webapp 供内部使用，我只更改了一个 id 的名称，因为我需要对其进行更多概括。除此之外，每个类和 id 都保持完全相同的名称。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-04T22:50:52.593

我认为您的问题纯粹是概念性的。这`class`HTML 中的属性没有定义 CSS 类。它定义了元素的语义类。碰巧 CSS 使用这些类来应用样式（就像 jQuery 选择器使用它们来应用其他功能一样）。没有什么可以阻止您拥有未在样式表中定义或根本没有样式信息的类。因此，所有类都应该被视为代码的一部分，而不是样式。代码规定了类，CSS 只是捎带语义标记来应用样式。因此，CSS 永远不应该指定类名，并且任何设计者都不应该更改类名。我意识到，乍一看，这可能听起来很像（非常正确地）建议您“使用语义名称”的其他答案，

参考：[这个网站](http://htmlhelp.com/reference/html40/attrs.html#class)很清楚地表达了我的观点；[w3schools](http://www.w3schools.com/tags/att_standard_class.asp)也简要提到了它。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-04T22:12:17.570

尊重关注点分离是件好事。但要让它发挥作用，元素应该根据它们在页面上扮演的角色在*语义*上命名。

**好的：**

```
<div id="nav">...</div>
<div id="sidebar">...</div>
<ul class="productsList">
  <li>...</li>
</ul> 
```

**坏的：**

```
<span class="Verdana11">...</span>
<div class="blueBox">...</div>
<ul class="bulletedList">
  <li>...</li>
</ul> 
```

等等。请注意，元素是根据元素在页面上所提供的功能来命名的。风格*会*改变——你可以指望它。但是角色不应该（除非重新设计网站，这必然意味着您无论如何都要重新编码）。因此，无论字体大小是否发生变化或边框是否在某个点被删除，侧边栏都将始终是侧边栏。

在编写脚本时，您应该根据*不会*更改的类名来定位元素。这只有在您以语义方式命名元素时才有可能——并且您的共同开发者也应该这样做。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-04T22:07:36.020

我投票支持精益方法。如果你有对 CSS 和 jQuery 有意义的好类名——使用它们。如果名称对 jQuery 没有意义，则添加新名称或重命名现有类。

如果您担心开发人员通过重命名类来破坏脚本，那么只需在 CSS 中添加一条注释，说明他们在更改类名时需要搜索 jQuery 引用。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-04T22:09:56.857

我倾向于同意你的观点：最好将“可视”类与“功能”类分开。

但是在某些情况下，类名可以清楚地表明一个类具有某些功能效果。例如，一个 .input-edited 类可以由 jQuery 设置并同时使用 CSS 设置样式。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-04T22:12:07.447

尝试使用更多不同的选择器。如果标记不会发生太大变化但您的类名可能会发生变化，请尝试尽可能少地使用类选择器。如果您的类不会有太大变化，但您的标记会改变，请使用更多类。真的，你的 jQuery 选择器应该和你写的任何东西一样语义化。可读性很重要。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-04T22:35:21.477

我同意那些说 CSS 类应该是语义的而不是代表视觉外观的人的观点，但我仍然认为你的问题关于布局和行为之间的“真正”分离是很好的。

我认为最好将仅由脚本使用的类放在单独的样式表中。通过 JS 包含它（因为如果 JS 不可用，则不需要它）。例如“.hover”或“.current”，显然只有通过脚本完成，例如对块级元素的影响。在内联元素上，您可能只使用 CSS 伪类。

作为一名 HTML/CSS 开发人员，当人们说“哦，已经有一个 CSS 类，我可以加入它”时，我有时可能会感到边缘化，但它完全没问题。毕竟 class 属性并不是 CSS 独有的。它是一个 HTML 属性。关于删除仍然在 JS 中使用的 CSS 规则的恐惧，说实话：在大型网站上使用 CSS，你永远无法完全确定它是否被使用，无论它是在 JS 中还是在 HTML 中。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-04T22:53:33.477

我打算将其发布为对[Marius 出色答案](https://stackoverflow.com/questions/612673/#612684)的评论，但它开始变得很长，我想添加一个示例。

不要将它们视为“CSS 类”。他们不是。类是[HTML 规范](http://www.w3.org/TR/html401/struct/global.html#h-7.5.2)的一部分，与 CSS 的关联度绝不亚于 JavaScript。

存在类来向 HTML 元素添加信息。是新闻吗？它是一个小部件吗？它被禁用了吗？HTML 无法指定这些属性与类一起保存。一些类具有与之关联的样式信息（新闻项目的标题、发布日期和署名的格式应该很好），一些具有与之关联的功能（小部件需要初始化），而另一些则两者都有（元素以编程方式被禁用*并且*应该被隐藏或“褪色”）。

绝对**没有理由**不在 CSS 和 JavaScript 中使用相同的类——只要两者都适合类所代表的信息。

* * *

## 回答 #9

> 赞同：-2
> 
> 时间：2009-03-04T22:13:03.963

我认为对 CSS 和脚本使用相同的类是绝对好的。

想象

```
<div class=css-class>
  <div class=script-class>
    <address> <!--for semantic "this is my homepage"--> 
```

还不够丑吗？一个 div 稍微好一点。一个地址稍微好一点。一节课稍微好一点。

“他们换班”的问题通过评论、测试和仔细的编辑来解决。

# asp.net - aspx 页面上的法语字母

> ID：612683
> 
> 赞同：1
> 
> 时间：2009-03-04T22:08:06.410
> 
> 标签：asp.net, encoding

我有一个 winForm 应用程序，它根据应用程序中的用户输入生成一个 .aspx 文件。当用户输入“é”、“à”、“è”、“â”、“ù”、“ô”、“ê”和“ç”等法语字母时，就会出现问题。它应该看起来像页面上的简单文本，但事实并非如此。有任何想法吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-04T22:54:25.817

假设您希望字符与重音符号、抑扬符等一起显示，请尝试以下操作：

将以下内容添加到`<head>`每个（生成的）页面：

```
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /> 
```

确保 .aspx 文件*本身*保存为 UTF-8 文件。

**注意：**我在这里假设 .aspx 文件有点类似于 .jsp 文件。如果该假设是错误的，您可能应该忽略此建议。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-05T03:36:38.337

你是如何创建 .aspx 文件的？如果您使用的是 TextWriter，请检查编码。如果您尝试将字节数组写入 FileStream，请确保在从 String 转换为 Byte[] 时使用正确的编码。UTF-8 通常是 Web 的最佳编码。

# c# - 匿名类的通用列表

> ID：612689
> 
> 赞同：461
> 
> 时间：2009-03-04T22:08:47.033
> 
> 标签：c#, .net, generics, anonymous-types

在 C# 3.0 中，您可以使用以下语法创建匿名类

```
var o = new { Id = 1, Name = "Foo" }; 
```

有没有办法将这些匿名类添加到通用列表中？

例子：

```
var o = new { Id = 1, Name = "Foo" };
var o1 = new { Id = 2, Name = "Bar" };

List<var> list = new List<var>();
list.Add(o);
list.Add(o1); 
```

另一个例子：

```
List<var> list = new List<var>();

while (....)
{
    ....
    list.Add(new {Id = x, Name = y});
    ....
} 
```

* * *

## 回答 #1

> 赞同：470
> 
> 时间：2009-03-04T22:12:18.163

你可以这样做：

```
var list = new[] { o, o1 }.ToList(); 
```

有很多方法可以给这只猫剥皮，但基本上它们都会在某处使用类型推断——这意味着你必须调用一个泛型方法（可能作为扩展方法）。另一个例子可能是：

```
public static List<T> CreateList<T>(params T[] elements)
{
     return new List<T>(elements);
}

var list = CreateList(o, o1); 
```

你明白了:)

* * *

## 回答 #2

> 赞同：117
> 
> 时间：2009-10-30T09:07:30.647

这是答案。

```
string result = String.Empty;

var list = new[]
{ 
    new { Number = 10, Name = "Smith" },
    new { Number = 10, Name = "John" } 
}.ToList();

foreach (var item in list)
{
    result += String.Format("Name={0}, Number={1}\n", item.Name, item.Number);
}

MessageBox.Show(result); 
```

* * *

## 回答 #3

> 赞同：73
> 
> 时间：2014-11-26T17:21:24.983

有很多方法可以做到这一点，但这里的一些响应是创建一个包含垃圾元素的列表，这需要您清除该列表。

如果您正在寻找泛型类型的空列表，请针对元组列表使用 Select 来创建空列表。不会实例化任何元素。

这是创建空列表的单行代码：

```
 var emptyList = new List<Tuple<int, string>>()
          .Select(t => new { Id = t.Item1, Name = t.Item2 }).ToList(); 
```

然后你可以使用你的泛型类型添加到它：

```
 emptyList.Add(new { Id = 1, Name = "foo" });
 emptyList.Add(new { Id = 2, Name = "bar" }); 
```

作为替代方案，您可以执行以下操作来创建空列表（但是，我更喜欢第一个示例，因为您也可以将它用于填充的元组集合）：

```
 var emptyList = new List<object>()
          .Select(t => new { Id = default(int), Name = default(string) }).ToList(); 
```

* * *

## 回答 #4

> 赞同：54
> 
> 时间：2009-03-04T22:10:37.450

不完全是，但你可以说`List<object>`，事情会奏效。然而，`list[0].Id`行不通。

这将在 C# 4.0 的*运行时*通过具有`List<dynamic>`，也就是说你不会得到 IntelliSense。

* * *

## 回答 #5

> 赞同：25
> 
> 时间：2014-05-16T15:00:28.960

我通常使用以下内容；主要是因为您随后从一个空列表“开始”。

```
var list = Enumerable.Range(0, 0).Select(e => new { ID = 1, Name = ""}).ToList();
list.Add(new {ID = 753159, Name = "Lamont Cranston"} );
//etc. 
```

最近，我一直在这样写：

```
var list = Enumerable.Repeat(new { ID = 1, Name = "" }, 0).ToList();
list.Add(new {ID = 753159, Name = "Lamont Cranston"} ); 
```

使用重复方法还可以让您执行以下操作：

```
var myObj = new { ID = 1, Name = "John" };
var list = Enumerable.Repeat(myObj, 1).ToList();
list.Add(new { ID = 2, Name = "Liana" }); 
```

..它为您提供了已添加第一项的初始列表。

* * *

## 回答 #6

> 赞同：24
> 
> 时间：2009-03-04T22:35:37.407

我猜

```
List<T> CreateEmptyGenericList<T>(T example) {
    return new List<T>();
}

void something() {
    var o = new { Id = 1, Name = "foo" };
    var emptyListOfAnonymousType = CreateEmptyGenericList(o);
} 
```

将工作。

你也可以考虑这样写：

```
void something() {
    var String = string.Emtpy;
    var Integer = int.MinValue;
    var emptyListOfAnonymousType = CreateEmptyGenericList(new { Id = Integer, Name = String });
} 
```

* * *

## 回答 #7

> 赞同：21
> 
> 时间：2012-12-13T11:30:46.087

您可以在代码中执行此操作。

```
var list = new[] { new { Id = 1, Name = "Foo" } }.ToList();
list.Add(new { Id = 2, Name = "Bar" }); 
```

* * *

## 回答 #8

> 赞同：20
> 
> 时间：2019-10-31T04:57:03.170

如果您使用的是 C# 7 或更高版本，则可以使用[元组类型](https://docs.microsoft.com/en-us/dotnet/csharp/tuples)而不是匿名类型。

```
var myList = new List<(int IntProp, string StrProp)>();
myList.Add((IntProp: 123, StrProp: "XYZ")); 
```

* * *

## 回答 #9

> 赞同：14
> 
> 时间：2017-05-31T09:31:45.220

在最新版本 4.0 中，可以使用如下动态

```
var list = new List<dynamic>();
        list.Add(new {
            Name = "Damith"
    });
        foreach(var item in list){
            Console.WriteLine(item.Name);
        }
    } 
```

* * *

## 回答 #10

> 赞同：13
> 
> 时间：2015-12-15T06:10:05.530

我在几个答案上检查了 IL。此代码有效地提供了一个空列表：

```
 using System.Linq;
    …
    var list = new[]{new{Id = default(int), Name = default(string)}}.Skip(1).ToList(); 
```

* * *

## 回答 #11

> 赞同：11
> 
> 时间：2017-12-26T18:40:00.840

您可以创建一个动态列表。

```
List<dynamic> anons=new List<dynamic>();
foreach (Model model in models)
{
   var anon= new
   {
      Id = model.Id,
      Name=model.Name
   };
   anons.Add(anon);
} 
```

“动态”由添加的第一个值初始化。

* * *

## 回答 #12

> 赞同：8
> 
> 时间：2011-07-07T11:11:51.823

这是我的尝试。

```
List<object> list = new List<object> { new { Id = 10, Name = "Testing1" }, new {Id =2, Name ="Testing2" }}; 
```

当我为自定义类型创建一个匿名列表时，我想到了这个。

* * *

## 回答 #13

> 赞同：8
> 
> 时间：2019-10-09T16:29:53.993

我很惊讶没有人建议使用集合初始值设定项。这种方式只能在创建列表时添加对象，因此它的名称似乎是最好的方式。无需创建数组然后将其转换为列表。

```
var list = new List<dynamic>() 
{ 
    new { Id = 1, Name = "Foo" }, 
    new { Id = 2, Name = "Bar" } 
}; 
```

您始终可以使用`object`而不是`dynamic`尝试以真正的通用方式保留它，然后才`dynamic`更有意义。

* * *

## 回答 #14

> 赞同：7
> 
> 时间：2010-11-30T09:34:49.427

而不是这个：

```
var o = new { Id = 1, Name = "Foo" }; 
var o1 = new { Id = 2, Name = "Bar" }; 

List <var> list = new List<var>(); 
list.Add(o); 
list.Add(o1); 
```

你可以这样做：

```
var o = new { Id = 1, Name = "Foo" }; 
var o1 = new { Id = 2, Name = "Bar" }; 

List<object> list = new List<object>(); 
list.Add(o); 
list.Add(o1); 
```

但是，如果您尝试在另一个范围内执行类似的操作，您将收到编译时错误，尽管它在运行时有效：

```
private List<object> GetList()
{ 
    List<object> list = new List<object>();
    var o = new { Id = 1, Name = "Foo" }; 
    var o1 = new { Id = 2, Name = "Bar" }; 
    list.Add(o); 
    list.Add(o1);
    return list;
}

private void WriteList()
{
    foreach (var item in GetList()) 
    { 
        Console.WriteLine("Name={0}{1}", item.Name, Environment.NewLine); 
    }
} 
```

问题是只有 Object 的成员在运行时可用，尽管智能感知会显示属性**id**和**name**。

在 .net 4.0 中，一个解决方案是在上面的代码中使用关键字**dynamic**而不是**object**。

另一种解决方案是使用反射来获取属性

```
using System;
using System.Collections.Generic;
using System.Reflection;

namespace ConsoleApplication1
{
    class Program
    {
        static void Main(string[] args)
        {
            Program p = new Program();
            var anonymous = p.GetList(new[]{
                new { Id = 1, Name = "Foo" },       
                new { Id = 2, Name = "Bar" }
            });

            p.WriteList(anonymous);
        }

        private List<T> GetList<T>(params T[] elements)
        {
            var a = TypeGenerator(elements);
            return a;
        }

        public static List<T> TypeGenerator<T>(T[] at)
        {
            return new List<T>(at);
        }

        private void WriteList<T>(List<T> elements)
        {
            PropertyInfo[] pi = typeof(T).GetProperties();
            foreach (var el in elements)
            {
                foreach (var p in pi)
                {
                    Console.WriteLine("{0}", p.GetValue(el, null));
                }
            }
            Console.ReadLine();
        }
    }
} 
```

* * *

## 回答 #15

> 赞同：7
> 
> 时间：2014-09-12T22:13:48.920

这是另一种创建匿名类型列表的方法，它允许您从一个空列表开始，但仍然可以访问 IntelliSense。

```
var items = "".Select( t => new {Id = 1, Name = "foo"} ).ToList(); 
```

如果您想保留第一项，只需在字符串中输入一个字母。

```
var items = "1".Select( t => new {Id = 1, Name = "foo"} ).ToList(); 
```

* * *

## 回答 #16

> 赞同：6
> 
> 时间：2009-03-04T22:42:07.513

你可以这样做：

```
var o = new { Id = 1, Name = "Foo" };
var o1 = new { Id = 2, Name = "Bar" };

var array = new[] { o, o1 };
var list = array.ToList();

list.Add(new { Id = 3, Name = "Yeah" }); 
```

对我来说这似乎有点“hacky”，但它有效 - 如果你真的需要一个列表并且不能只使用匿名数组。

* * *

## 回答 #17

> 赞同：5
> 
> 时间：2012-02-02T10:20:48.270

```
var list = new[]{
new{
FirstField = default(string),
SecondField = default(int),
ThirdField = default(double)
}
}.ToList();
list.RemoveAt(0); 
```

* * *

## 回答 #18

> 赞同：5
> 
> 时间：2016-01-27T11:46:47.223

这是一个老问题，但我想我会输入我的 C# 6 答案。我经常需要设置可以在代码中轻松输入的测试数据作为元组列表。通过几个扩展函数，可以拥有这种漂亮、紧凑的格式，而无需在每个条目上重复名称。

```
var people= new List<Tuple<int, int, string>>() {
    {1, 11, "Adam"},
    {2, 22, "Bill"},
    {3, 33, "Carol"}
}.Select(t => new { Id = t.Item1, Age = t.Item2, Name = t.Item3 }); 
```

这给出了一个 IEnumerable - 如果你想要一个可以添加的列表，那么只需添加 ToList()。

魔法来自元组的自定义扩展 Add 方法，如[https://stackoverflow.com/a/27455822/4536527](https://stackoverflow.com/a/27455822/4536527)所述。

```
public static class TupleListExtensions    {
    public static void Add<T1, T2>(this IList<Tuple<T1, T2>> list,
            T1 item1, T2 item2)       {
        list.Add(Tuple.Create(item1, item2));
    }

    public static void Add<T1, T2, T3>(this IList<Tuple<T1, T2, T3>> list,
            T1 item1, T2 item2, T3 item3) {
        list.Add(Tuple.Create(item1, item2, item3));
    }

// and so on... 
```

}

我唯一不喜欢的是类型与名称分开，但如果你真的不想创建一个新类，那么这种方法仍然可以让你拥有可读的数据。

* * *

## 回答 #19

> 赞同：3
> 
> 时间：2013-10-17T07:17:16.270

对于您的第二个示例，您必须初始化一个 new `List<T>`，一个想法是创建一个匿名列表，然后将其清除。

```
var list = new[] { o, o1 }.ToList();
list.Clear();

//and you can keep adding.
while (....)
{
    ....
    list.Add(new { Id = x, Name = y });
    ....
} 
```

或者作为扩展方法，应该更容易：

```
public static List<T> GetEmptyListOfThisType<T>(this T item)
{
    return new List<T>();
}

//so you can call:
var list = new { Id = 0, Name = "" }.GetEmptyListOfThisType(); 
```

或者可能更短，

```
var list = new int[0].Select(x => new { Id = 0, Name = "" }).Tolist(); 
```

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2019-02-12T20:05:25.767

根据[这个答案](https://stackoverflow.com/a/27155247/1366594)，我想出了两种可以完成任务的方法：

```
 /// <summary>
    /// Create a list of the given anonymous class. <paramref name="definition"/> isn't called, it is only used
    /// for the needed type inference. This overload is for when you don't have an instance of the anon class
    /// and don't want to make one to make the list.
    /// </summary>
    /// <typeparam name="T"></typeparam>
    /// <param name="definition"></param>
    /// <returns></returns>
#pragma warning disable RECS0154 // Parameter is never used
    public static List<T> CreateListOfAnonType<T>(Func<T> definition)
#pragma warning restore RECS0154 // Parameter is never used
    {
        return new List<T>();
    }
    /// <summary>
    /// Create a list of the given anonymous class. <paramref name="definition"/> isn't added to the list, it is
    /// only used for the needed type inference. This overload is for when you do have an instance of the anon
    /// class and don't want the compiler to waste time making a temp class to define the type.
    /// </summary>
    /// <typeparam name="T"></typeparam>
    /// <param name="definition"></param>
    /// <returns></returns>
#pragma warning disable RECS0154 // Parameter is never used
    public static List<T> CreateListOfAnonType<T>(T definition)
#pragma warning restore RECS0154 // Parameter is never used
    {
        return new List<T>();
    } 
```

您可以使用以下方法

```
var emptyList = CreateListOfAnonType(()=>new { Id = default(int), Name = default(string) });
//or
var existingAnonInstance = new { Id = 59, Name = "Joe" };
var otherEmptyList = CreateListOfAnonType(existingAnonInstance); 
```

[这个答案](https://stackoverflow.com/a/612779/1366594)有一个类似的想法，但是直到我做了这些方法之后我才看到它。

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2014-06-24T11:23:08.627

试试这个：

```
var result = new List<object>();

foreach (var test in model.ToList()) {
   result.Add(new {Id = test.IdSoc,Nom = test.Nom});
} 
```

# java - 使用 cookie 读取 URL 到字符串 Java

> ID：612704
> 
> 赞同：0
> 
> 时间：2009-03-04T22:13:31.717
> 
> 标签：java, url, cookies

我需要从 URL 读取字符串，这不是问题，但有些网站需要启用 cookie 以提供内容。因此，即使需要接受 cookie，我也需要一种获取内容的方法？干杯

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-04T22:15:31.633

你可以试试 Apache 的 HTTPClient： [http ://hc.apache.org/httpclient-3.x/](http://hc.apache.org/httpclient-3.x/)

它支持很多东西。我不记得是否包含 cookie，但我敢打赌。

**编辑**

它确实:)

[http://hc.apache.org/httpclient-3.x/cookies.html](http://hc.apache.org/httpclient-3.x/cookies.html)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-04T22:20:58.500

`java.net`支持 cookie 通过`HttpCookie`.

# asp.net - ASP.NET 项目中的重复 html

> ID：612705
> 
> 赞同：0
> 
> 时间：2009-03-04T22:13:37.927
> 
> 标签：asp.net, html

我有一些需要在多个地方复制的 HTML。如果我将它外部化为一个文本文件并将其包含在 ASPX 页面中，它会起作用，但我需要将一个参数传递给这个 HTML（ClientID）

无需创建用户控件，有没有更轻松的方法？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-04T22:17:42.113

我会为此使用[母版页](http://msdn.microsoft.com/en-us/library/wtxbf3hh.aspx)。根据框架的版本（2.0+），[嵌套母版页](http://msdn.microsoft.com/en-us/library/x2b3ktt7.aspx)也是一种选择。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-04T22:19:48.613

您可以只拥有一个包含 HTML 的原始 aspx 文件：

```
<%

If (Request.QueryString["ClientID"]) {
    // Do Something
}

%>

<p>HTML File Contents</p> 
```

然后你可以在服务器端包含文件或 server.execute 文件。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-04T22:20:21.327

您可能想澄清如何将 ClientID 传递给“HTML”，因为听起来您正在执行服务器端处理以生成 HTML，这是 Ajax 的经典案例。我建议使用[JQuery](http://jquery.com/)来实现这一点。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-04T22:21:25.677

也许标准的#Includes 仍然有效，但是TBH 我还没有发现母版页有任何缺点（到目前为止）。这就是他们的设计目的。

# c# - 最好的 C# Profiler？

> ID：612711
> 
> 赞同：0
> 
> 时间：2009-03-04T22:16:01.557
> 
> 标签：c#, .net, performance, profiler

最近我使用了 RedGate ANTS 分析器，它看起来很不错，但是我尝试分析的应用程序由于 DivideByException 而崩溃，因为在 Visual Studio 中运行对于调试和发布都很好。

您知道其他/更好的 C# 分析器吗？

# linq-to-sql - 存储库、实体对象和域对象

> ID：612718
> 
> 赞同：1
> 
> 时间：2009-03-04T22:17:42.160
> 
> 标签：linq-to-sql, domain-driven-design, repository-pattern

在我的存储库中，我正在从 Linq 实体查询对我的域对象进行分配。然后我有一个服务层来处理从存储库返回的这些对象。

我的域对象应该像这样在存储库中吗？或者我的存储库是否应该仅限于实体和数据访问，而是让我的服务层对域对象进行分配？

在存储库中完成所有分配似乎更容易，但现在我的数据库和域对象之间的区别并不明显。这里的正确做法是什么？蒂亚

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-04T22:27:56.067

IMO，如果应用程序相对简单并且您无法想象删除数据访问权限并在存储库中进行分配。但是，如果您认为应用程序将来会变得更加复杂，或者您可能想要更改数据访问权限，请将此功能保留在存储库之外。

我已经在存储库和服务层中完成了分配应用程序，而另一个我有一个单独的转换层（它不是一对一的转换，对象很复杂）。

关于最佳实践要记住一件事，那里有帮助，如果它使事情变得更加困难，那就不要使用它。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-04T23:05:26.490

我以前不喜欢。但现在通常不会回头。基本上问题是，如果您需要更改为结构不同的外部数据源，您可以设置一个新的映射以及存储库代码的实现并完成它。

它是关于数据映射的。检查此链接： http: [//www.martinfowler.com/eaaCatalog/repository.html](http://www.martinfowler.com/eaaCatalog/repository.html)

还要检查这个相关问题：[IRepository 对返回的对象的混淆](https://stackoverflow.com/questions/524603/irepository-confusion-on-objects-returned)。我使用了一个类似的映射器，但是让它在 IQueryable 级别上运行，这使得在映射后使用域对象时能够做一些非常有趣的事情。

# groovy - 如何让这个 Groovy 字符串搜索代码更高效？

> ID：612722
> 
> 赞同：1
> 
> 时间：2009-03-04T22:18:27.867
> 
> 标签：groovy, for-loop

我正在使用以下 groovy 代码在文件中搜索字符串、帐号。我正在阅读的文件大约 30MB，包含 80,000-120,000 行。有没有更有效的方法在包含给定 AcctNum 的文件中查找记录？我是新手，所以我不知道要研究哪个区域，`toList()`或者 for 循环。谢谢！

```
AcctNum = 1234567890

if (testfile.exists())
{
  lines = testfile.readLines()
  words = lines.toList() 
  for (word in words) 
  {
    if (word.contains(AcctNum)) { done = true; match = 'YES' ; break }
    chunks += 1
    if (done) { break }
  }
} 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-04T22:27:24.040

遗憾的是，我什至没有在我当前的笔记本电脑上安装 Groovy - 但我不希望你必须打电话`toList()`。我也希望你能在闭包中表达条件，但我必须参考 Groovy in Action 来检查......

话虽如此，你真的需要把它分成几行吗？您可以使用阅读整个内容`getText()`然后只使用一次调用`contains()`吗？

编辑：好的，如果您需要找到包含记录的实际行，您确实需要打电话`readLines()`，但我认为您不需要`toList()`之后再打电话。你应该能够使用：

```
for (line in lines) 
{
  if (line.contains(AcctNum)) 
  {
     // Grab the results you need here
     break;
  }
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-04T22:59:50.467

当您说*高效*时，您通常必须确定您的意思是：它应该快速运行，还是使用尽可能少的资源（内存，...）。通常两者都位于相反的位置，您必须做出权衡。

如果你想搜索内存友好，我建议逐行读取文件，而不是一次读取它，我怀疑它会这样做（我会错在那里，但在其他语言中，像 readLines 之类的东西会将整个文件读入字符串数组）。

如果您希望它快速运行，我建议，如前所述，一次读取整个文件并查找给定的模式。您可以使用 indexOf 获取位置，然后根据需要从该位置读取记录，而不是仅检查 contains。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-05T10:56:22.227

如果您控制正在阅读的文件的格式，则解决方案是添加索引。

事实上，这就是数据库能够如此快速地定位记录的方式。

但是对于 30MB 的数据，我认为具有不错硬盘驱动器的现代计算机应该可以解决问题，而不是使程序过于复杂。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-04T22:33:44.837

我应该更好地解释它，如果我找到带有 AcctNum 的记录，我会提取记录中的其他信息......所以我认为我需要将文件拆分为多行。

# iphone - 加密和压缩 iPhone 应用程序包中的 html 代码，在第一次启动时解包

> ID：612728
> 
> 赞同：2
> 
> 时间：2009-03-04T22:20:25.867
> 
> 标签：iphone, encryption, compression, obfuscation, drm

我的客户想要在 iPhone 捆绑包中加密/压缩他们的医学书籍的 html 代码，以保护他们的 IP。

什么是为应用程序包准备此文件的好方法，我应该使用哪些补充库（C、Obj-C）在第一次启动应用程序时进行解密和解压缩？

将文件复制到 ~/Documents，然后处理它似乎是最好的解决方案。想法？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-04T23:36:26.823

这非常棘手......几乎不可能让它真正牢不可破。任何有合理动机的人都将能够穿透它。你只会让它变得更难做。无论如何，您绝对不能在捆绑包本身中存储任何密钥。您需要通过安全通道从服务器安全地获取解密密钥，并根据需要使用它。即使那样，越狱的人可能能够在您正在运行的程序上运行 GDB 并在 RAM 中提取密钥 + 密钥将在您的应用程序的所有用户之间共享......您实际上是在尝试实施 DRM 方案，这在设计上存在固有缺陷...除非您需要离线访问，否则您可能希望根据需要从安全的服务器中提取数据...至少您“可以”限制信息泄漏...

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-05T04:52:59.027

这里有一些想法。

如果书籍文本都是字母数字数据，则不要将数据保存为 ASCII - 以您自己的二进制编码格式保存它们（例如使用 5 位而不是 8 位并打包成单词）。这为您提供了一点压缩、轻微的混淆和非常便宜的（以时钟周期为单位）解压缩。您将拥有一种可以快速访问的数据格式，并且可以让随意好奇的黑客远离文本。时钟周期将是我的主要关注点和安全性第二。

另一个想法是以混淆格式在应用程序中存储典型 Blowfish 加密的解密密钥。拆分成两个或三个常量，例如需要一些奇怪的操作来恢复。但是，当然，现在 Blowfish 的开销或任何您关心的问题。

由于您将无法实现完美的安全性（完美的价格非常昂贵），IP 所有者将不得不使用传统的版权和商业秘密技术来充分保护他们的财产。你让黑客更难了，但律师们仍然需要勤奋，只是图书馆保留区的书架上的一本书（请不要复印！）。

干杯

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-04T22:30:44.157

如果我是您，我会将文件加密，并根据需要对其进行解密。人们可以很容易地访问越狱设备上的解密文件。

有关加密技术，请参阅“安全概述”文档和 CryptoExercise 示例代码

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-05T07:03:51.600

您可能不会喜欢它，但最好的方法是不使用 HTML。一旦您将解密的 HTML 传递给 UIWebView，恶意用户就很容易在该级别窃取它，从而破坏您的加密算法的任何目的。具有自定义绘图代码和自定义加密支持格式的 UIView 子类将更难以解决

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-12T19:06:22.837

从[Mac OS X 和 iPhone OS 安全服务](http://developer.apple.com/DOCUMENTATION/Security/Reference/keychainservices/index.html#//apple_ref/doc/uid/TP30000898)：

> 您可以使用钥匙串服务加密和存储少量数据（请参阅[钥匙串服务参考](http://developer.apple.com/DOCUMENTATION/Security/Reference/keychainservices/index.html#//apple_ref/doc/uid/TP30000898) 和[钥匙串服务编程指南](http://developer.apple.com/DOCUMENTATION/Security/Conceptual/keychainServConcepts/index.html#//apple_ref/doc/uid/TP30000897)）。如果您想在 Mac OS X 中加密或解密大量数据，您可以使用 Common Security Services Manager (CSSM) Cryptographic Services Manager。该管理器还具有创建和验证数字签名、生成加密密钥和创建加密哈希的功能。在 iPhone OS 中，证书、密钥和信任服务 API 提供了生成加密密钥、创建和验证数字签名以及加密数据块的功能；请参阅 [证书、密钥和信任服务参考](http://developer.apple.com/DOCUMENTATION/Security/Reference/certifkeytrustservices/index.html#//apple_ref/doc/uid/TP30000157)。

它总是在性能（加密不是免费的）和安全性（安全性和其他一切，真的）之间做出选择。但还有什么新东西？如果您将单个文件保持得足够小，那么解密可能不会让您减慢很多。或者，您可以考虑预测性解密，以便您在后台解密某些文件，例如从当前查看的文件中链接的文件等。但是，我意识到 iPhone 上的并发可能相当不稳定（我不知道因为我没有放弃现金购买许可证）。您还可以通过仅加密那些真正需要它的文件来实现性能提升；索引/目录或其他经常访问的文件真的需要加密吗？这算作您的客户担心的 IP 吗？

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-11-07T15:52:19.970

对于压缩，我可以推荐 QuickLZ（我见过的最快的引擎，压缩比很好）。

# python - Django + SWFUpload 的代码示例？

> ID：612734
> 
> 赞同：5
> 
> 时间：2009-03-04T22:21:07.783
> 
> 标签：python, django, swfupload

有人有 Django + [SWFUpload](http://swfupload.org/)的简单代码示例吗？我让它在我的 PHP 应用程序中完美运行，但 Django 让我头疼。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-03-04T23:05:31.327

不幸的是，我不能给你任何非常详细的代码示例，但我在使用 SWFUpload + Django 方面有相当多的经验（对于我工作的照片共享网站）。无论如何，这里有一些建议，希望能帮助你追求 DjSWF 的幸福:)

1.  您将需要使用 cookie 插件（当然，如果您使用某种基于会话的身份验证 [例如`django.contrib.auth`，并且关心谁上传了什么）。

    cookie 插件将 cookie 中的数据作为 POST 发送，因此您必须找到某种方法将其返回`request.COOKIES`（在特定 URL 上`process_request`查找`settings.SESSION_COOKIE_NAME`in`request.POST`并将其转储的中间件`request.COOKIES`很好地为此工作:)

2.  另外，请记住，您*必须*在响应正文中返回一些内容，以便 SWFUpload 将其识别为成功的上传尝试。我相信这在最新的 SWFUpload 测试版中已经发生了变化，但无论如何，建议只是在其中粘贴一些“ok”之类的东西。对于失败，请使用类似`HttpResponseBadRequest`或类似的东西。

3.  最后，如果您找不到它们，上传的文件在`request.FILES`:)

如果您有任何我没有涵盖的令人困惑的地方，请随时发布更详细的内容，我很乐意提供帮助。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-08-23T13:06:52.187

SWFUpload 示例的 Django 版本：

[http://github.com/naltimari/django-swfupload-samples/tree/master](http://github.com/naltimari/django-swfupload-samples/tree/master)

上传这么久。好主意，但它只是有问题，尤其是在 Windows 上。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2014-07-01T10:32:48.957

以下是我用于解决此问题的特定于 Django 的实现（即，我的上传在 Firefox 中因 302 重定向而失败）。

在生成带有上传器的页面的初始视图中，我查看了 cookie 并找到了 sessionid

```
ipdb> self.request.COOKIES
{'csrftoken': '43535f552b7c94563ada784f4d469acf', 'sessionid': 'rii380947wteuevuus0i5nbvpc6qq7i1'} 
```

当我查看 SWFUploadMiddleware 中发布的内容时（使用 Firefox 时），我发现 sessionid 没有被设置。

在生成包含上传处理程序的页面的初始视图中，我将 sessionid 添加到上下文中。

```
context['sessionid'] = self.request.session.session_key 
```

在我的 swfuploader 设置中，我将 sessionid 添加到 post-params 选项中，如下所示：

```
post_params: {... "sessionid": "{{ sessionid }}" ...}, 
```

现在，当我查看 SWFUploadMiddleware 时，我可以看到 sessionid 被发布，**如果 Firefox ，我的上传开始工作**。

```
ipdb> request.POST 
<QueryDict: {... u'session_id': [u'rii380947wteuevuus0i5nbvpc6qq7i1'],...}> 
```

为了完整起见，我的 SWFUploadMiddleware 看起来像这样......

```
from django.conf import settings
from django.core.urlresolvers import reverse

class SWFUploadMiddleware(object):
    def process_request(self, request):
        if (request.method == 'POST') and (request.path == reverse('upload_handler')) and request.POST.has_key(settings.SESSION_COOKIE_NAME):
            request.COOKIES[settings.SESSION_COOKIE_NAME] = request.POST[settings.SESSION_COOKIE_NAME]
    # http://stackoverflow.com/questions/6634666/403-forbidden-error-on-swfupload-and-django
    # Fix for problem uploading images (403 error) in Firefox 20 and others
    if request.POST.has_key('csrftoken'):
            request.COOKIES['csrftoken'] = request.POST['csrftoken'] 
```

# c++ - 编写 char* 迭代时，“由于信号 10，调试器已退出”

> ID：612739
> 
> 赞同：2
> 
> 时间：2009-03-04T22:22:27.810
> 
> 标签：c++

所以我有一个程序可以让 char* 的东西小写。它通过迭代和操作 ascii 来实现。现在我知道在 c++ 中可能有一些库，但这不是重点——我是一名试图掌握 char*s 和东西的学生:)。

这是我的代码：

```
#include <iostream>

using namespace std;

char* tolower(char* src);

int main (int argc, char * const argv[])
{
    char* hello = "Hello, World!\n";

    cout << tolower(hello);
    return 0;
}

char* tolower(char* src)
{
    int ascii;
    for (int n = 0; n <= strlen(src); n++)
    {
        ascii = int(src[n]);
        if (ascii >= 65 && ascii <= 90)
        {
            src[n] = char(ascii+32);
        }
    }

    return src;
} 
```

（这不是为了分配；））

它构建得很好，但是当我运行它时，我得到一个“由于信号 10，调试器已退出”，Xcode 将我指向该行：“src[n] = char(ascii+32);”

谢谢！

标记

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-03-04T22:28:15.253

约瑟！

你的“你好世界！” string 是所谓的字符串文字，这意味着它的内存是程序的一部分，不能写入。

您正在执行所谓的“就地”转换，例如，不是将小写版本写入您正在写入原始目标的新缓冲区。因为目的地是文字，不能写给你，所以你会崩溃。

试试这个;

```
char hello[32];
strcpy(hello, "Hello, World!\n"); 
```

同样在你的 for 循环中，你应该使用 <，而不是 <=。strlen 返回字符串的长度减去它的空终止符，并且数组索引从零开始。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-03-04T22:31:20.347

正如安德鲁`"Hello World\n"`在代码中指出的那样，它是一个只读文字。您可以使用`strcpy`来制作可修改的副本，或者试试这个：

```
char hello[] = "Hello, World!\n"; 
```

这会自动在堆栈上分配一个足够大的数组来保存文字字符串的副本和尾随`'\0'`，并将文字复制到数组中。

此外，您可以将 ascii 保留为 char，并使用字符文字，而不必知道数值`'A'`是什么：

```
char ascii;
for (int n = 0; n < strlen(src); n++)
{
    ascii = src[n];
    if (ascii >= 'A' && ascii <= 'Z')
    {
        src[n] = ascii - 'A' + 'a';
    }
} 
```

当您使用它时，为什么还要使用 ascii，只需使用 src[n]：

```
for (int n = 0; n < strlen(src); n++)
{
    if (src[n] >= 'A' && src[n] <= 'Z')
    {
        src[n] -= 'A' - 'a';
    }
} 
```

然后，您可以利用这样一个事实，即为了确定 c 字符串的长度，无论如何您都必须对其进行迭代，并将两者结合在一起：

```
for (char *n = src; *n != 0; n++)
    if (*n >= 'A' && *n <= 'Z')
        *n -= 'A' - 'a'; 
```

# css - Flex 伪选择器

> ID：612749
> 
> 赞同：1
> 
> 时间：2009-03-04T22:24:44.640
> 
> 标签：css, apache-flex

我必须`* Required`在 Flex 中添加大量屏幕。在某些地方，我不能使用多个标签。我需要星号与文本一样大。我能想到的唯一想法是：

```
.required:first-letter {
    font-size:30;   
} 
```

似乎不起作用。Flex 中没有实现伪选择器吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-04T23:44:59.890

不，这样的伪选择器在 Flex 中不可用。Flex CSS 目前非常有限。目前，在 Flex SDK 的 3.x 分支中，您只能使用`.styleName`和`ComponentType`选择器。

根据[Adob​​e 的 Flex SDK 开源网站](http://opensource.adobe.com/wiki/display/flexsdk/Flex+SDK)，Flex 4 中将会有新的[高级 CSS 选择器](http://opensource.adobe.com/wiki/display/flexsdk/CSS+Advanced+Selectors)。该文档确实提到了伪选择器，但似乎它们可以作为区分组件“状态”的一种方式，而不是访问文本中的特定子字符串。我猜你的用例最好通过使用`htmlText`Flex 中大多数基于文本的控件上可用的属性来实现。

# c# - 在 C# 中实现朋友（在 C++ 中可用）功能

> ID：612753
> 
> 赞同：2
> 
> 时间：2009-03-04T22:26:55.570
> 
> 标签：c#, .net, c++, serialization

好吧，让我们离开友谊是否打破封装的争论，并实际尝试优雅地提出一个连贯的设计。这是一个双重功能：

1）关于如何实施的一般问题：

```
 public class A 
   {
      friend class B;
   } 
```

2) 为什么我需要这个功能？我的一些类实现了`ISerializable`接口。但是，我想`ISerializable`在 Derived 类中保护方法，这样我就不会将它们暴露给客户端（以及在文档中）。但是，内部类应该能够访问它们。在 C# 中解决这个问题的一般方法是什么？

注意：我使用当前 C++ 标准中定义的友谊。

谢谢

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-04T22:30:11.740

C# 具有`internal`关键字，因此同一程序集中的其他类型可以看到标记为内部的类型。此外，您可以向程序集添加[属性](http://msdn.microsoft.com/en-us/library/system.runtime.compilerservices.internalsvisibletoattribute.aspx)，以允许程序集外部的类型查看该程序集的内部成员。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-04T22:32:07.163

如果这些类在同一个程序集中，您可以使用[internal](http://msdn.microsoft.com/en-us/library/7c5ka91b(VS.80).aspx)。如果它们在不同的程序集中，您可以使用[朋友程序集属性](http://msdn.microsoft.com/en-us/library/0tke9fxk(VS.80).aspx)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-04T22:33:48.737

将`InternalsVisibleTo`这些东西放在一边，在实现接口时只有两种选择：

*   用公共方法实现它们
*   使用显式接口实现来实现它们

在这两种情况下，任何人都可以调用方法，但是使用显式接口实现，您只能“通过”接口表达式调用方法（例如，您可以将实际类型的变量强制转换为`ISerializable`）。

没有“内部”实现接口这样的概念。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-04T22:30:22.440

[内部](http://msdn.microsoft.com/en-us/library/7c5ka91b(VS.80).aspx)成员在当前 .dll 中是公共的，在外部是私有的。此外，您可以使用[InternalsVisibleTo](http://msdn.microsoft.com/en-us/library/system.runtime.compilerservices.internalsvisibletoattribute.aspx)属性将它们公开给外部 .dll。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-11-29T16:14:43.203

我有几个解决方案，所有这些都围绕使用私有单例实例作为“密钥”来证明调用者就是他们所说的那个人。

解决方案1：朋友类是单例

```
public class A
{
  private underwear myUnderwear;

  public ChangeUnderwear(B friend, underwear newUnderwear) 
  {
    if (friend == null) return;
    myUnderwear = newUnderwear
  }
}

public sealed class B
{
  private B() {};
  private B inst;
  private MessWithA(A a)
  {
    a.ChangeUnderwear(this, new Thong());
  }
} 
```

有人看到那里有任何缺陷吗？当您有一个 Foo 类和一个 FooManager 单例时，该技术将适用。

解决方案2：如果朋友不是单例，我想你可以使用隐藏构造和隐藏所有实例的相同想法：

```
interface IB
{ ... }

public sealed class B : IB
{
  private B() {};
  public IB CreateB()
  {
    return (IB)new B();
  }
  private MessWithA(A a)
  {
    a.ChangeUnderwear(this, new Thong());
  }
} 
```

但是现在您现在需要某种方法来防止敌人简单地将 IB 转换为 B，然后冒充 B 访问 A 的仅限朋友的成员。有任何想法吗？

解决方案 3：单例类让第一个请求它的调用者拥有它的实例。朋友类试图在启动时抓取实例，如果其他人先抓取它就会发脾气

```
public class A
{
  private underwear myUnderwear;

  public ChangeUnderwear(B.IdCard friend, underwear newUnderwear) 
  {
    if (friend == null) return;
    myUnderwear = newUnderwear
  }
}

public class B
{
  public sealed class IdCard
  {
    private IdCard() {};
    private static bool created = false;
    public IDCard GetId()
    {
      if (created) throw new Exception("Why are two people asking for the same ID?!?");
      created = true;
      return new IDCard();
    }
  }

  private static IdCard id;

  static B()
  {
    id = IDCard.CreateId();
    if (id == false) throw new Tantrum("Panic: Someone stole my ID card before I could grab it");
  }

  private void MessWithA(A a)
  {
    a.ChangeUnderwear(id, new Thong());
  }
} 
```

# lambda - 什么是通话/抄送？

> ID：612761
> 
> 赞同：61
> 
> 时间：2009-03-04T22:30:32.487
> 
> 标签：lambda, scheme, continuations, lambda-calculus, callcc

我已经尝试过几次来掌握[延续](http://en.wikipedia.org/wiki/Continuation)和[call/cc](http://en.wikipedia.org/wiki/Call-with-current-continuation)的概念。每一次尝试都是失败的。有人可以向我解释这些概念吗，最好用比维基百科或其他 SO 帖子中更现实的例子。

我有网络编程和 OOP 的背景。我也了解 6502 程序集，并与 Erlang 有过一次小小的交流。但是，我仍然无法理解 call/cc。

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2009-03-04T22:51:15.650

将其与 C 进行比较，当前延续就像堆栈的当前状态。它的所有函数都在等待当前函数的结果完成，以便它们可以恢复执行。捕获为当前延续的变量就像一个函数一样使用，只是它获取提供的值并将其返回到等待堆栈。此行为类似于 C 函数[longjmp](http://en.wikipedia.org/wiki/Longjmp)，您可以在其中立即返回到堆栈的较低部分。

这是一个方案 REPL 交互来说明：

```
> (define x 0) ; dummy value - will be used to store continuation later

> (+ 2 (call/cc 
          (lambda (cc)
           (set! x cc)  ; set x to the continuation cc; namely, (+ 2 _)
           3)))         ; returns 5
5

> (x 4)                 ; returns 6
6 
```

C 堆栈和延续之间的一个关键区别是延续可以在程序中的任何位置使用，即使堆栈的状态已经改变。这意味着您基本上可以恢复堆栈的早期版本并一次又一次地使用它们，从而产生一些独特的程序流程。

```
(* 123 (+ 345 (* 789 (x 5)))) ; returns 7

  reason: it is because (x 5) replaces the existing continuation,
          (* 123 (+ 345 (* 789 _))), with x, (+ 2 _), and returns
          5 to x, creating (+ 2 5), or 7. 
```

保存和恢复程序状态的能力与多线程有很多共同之处。事实上，您可以使用延续来实现自己的线程调度程序，正如我在[此处](https://stackoverflow.com/questions/40632/i-just-dont-get-continuations/40736#40736)试图说明的那样。

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2009-03-04T22:41:09.123

看，我找到了关于这个主题的这种[延续传递风格](http://marijn.haverbeke.nl/cps/)的最佳描述。

这是该文章的详细信息副本：

> 作者：Marijn Haverbeke 日期：2007 年 7 月 24 日
> 
> Scheme 的 call-with-current-continuation 函数可以捕获计算、调用堆栈的状态，并在以后恢复相同的状态。在这样的原语之上，可以实现各种形式的异常处理和类似 C 的 longjmp 技巧。
> 
> ```
> function traverseDocument(node, func) {
>   func(node);
>   var children = node.childNodes;
>   for (var i = 0; i < children.length; i++)
>     traverseDocument(children[i], func);
> }   
> 
> function capitaliseText(node) {
>   if (node.nodeType == 3) // A text node
>     node.nodeValue = node.nodeValue.toUpperCase();
> }
> 
> traverseDocument(document.body, capitaliseText); 
> ```
> 
> 这可以转换如下：我们为每个函数添加一个额外的参数，用于传递函数的延续。这个延续是一个函数值，表示函数“返回”后必须发生的动作。（调用）堆栈在延续传递风格中变得过时了——当一个函数调用另一个函数时，这是它做的最后一件事。它不是等待被调用的函数返回，而是将之后想要做的任何工作放入一个延续中，然后传递给函数。
> 
> ```
> function traverseDocument(node, func, c) {
>   var children = node.childNodes;
>   function handleChildren(i, c) {
>     if (i < children.length)
>       traverseDocument(children[i], func,
>                        function(){handleChildren(i + 1, c);});
>     else
>       c();
>   }
>   return func(node, function(){handleChildren(0, c);});
> }
> 
> function capitaliseText(node, c) {
>   if (node.nodeType == 3)
>     node.nodeValue = node.nodeValue.toUpperCase();
>   c();
> }
> 
> traverseDocument(document.body, capitaliseText, function(){}); 
> ```
> 
> 想象一下，我们有一个要大写的 huuuuge 文件。一口气遍历它需要五秒钟，而冻结浏览器五秒钟是相当糟糕的风格。考虑对 capitaliseText 的这个简单修改（不要注意丑陋的全局）：
> 
> ```
> var nodeCounter = 0;
> function capitaliseText(node, c) {
>   if (node.nodeType == 3)
>     node.nodeValue = node.nodeValue.toUpperCase();
> 
>   nodeCounter++;
>   if (nodeCounter % 20 == 0)
>     setTimeout(c, 100);
>   else
>     c();
> } 
> ```
> 
> 现在，每 20 个节点，计算就会中断 100 毫秒，以便让浏览器界面有时间响应用户输入。一种非常原始的线程形式——你甚至可以像这样同时运行多个计算。
> 
> 一个更常见的有用应用程序与 XMLHttpRequests 或用于模拟它们的各种 IFRAME 和 SCRIPT 标记黑客有关。这些总是需要使用某种回调机制来处理服务器发回的数据。在简单的情况下，可以使用一个简单的函数，或者可以使用一些全局变量来存储数据返回后必须恢复的计算状态。对于复杂的情况，例如，当必须向调用者返回一些值的函数使用数据时，延续会大大简化事情。您只需将延续注册为回调，然后在请求完成时恢复您的计算。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2009-03-04T22:40:13.337

**使用延续的一个简单的例子是**在单处理器机器上实现一个线程（如果你愿意的话）管理器。调度器会周期性地中断执行流程（或者，在纤维的情况下，在代码中的各个战略点被调用），保存*延续状态*（对应于*当前线程*），然后切换到不同的*延续状态*（对应于另一个线程，其状态先前已保存。）

参考您的汇编背景，**继续状态将捕获诸如指令指针、寄存器和堆栈上下文（指针）等详细信息**，以随意保存和恢复。

使用延续的另一种方法是考虑用几个并行共存（运行或挂起）**的类线程实体替换方法调用，**`call`使用延续上下文而不是“经典”范式相互传递控制。他们将对全局（共享）数据进行操作，而不是依赖参数。这在某种程度上比`call`堆栈不必先收起然后收起（*嵌套*`calls`）更灵活，但控制可以任意传递。

 ***尝试用**诸如 C 的语言来可视化这个概念，想象有一个带有单个`switch(continuation_point) { case point1: ... }`语句的大循环，其中每个语句`case`对应一个 continuation-savepoint，每个内部的代码都`case`可以通过从并参与循环中的下一次迭代。`continuation_point``continuation_point``break``switch`

你的问题的背景是什么？您感兴趣的任何特定场景？任何特定的编程语言？上面的线程/纤维示例是否足够？

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2017-10-02T00:38:53.597

想象您的脚本是一个视频游戏舞台。Call/cc 就像一个奖励阶段。

[![奖金阶段和通话/抄送之间的平行](https://i.stack.imgur.com/sCZFs.png)](https://i.stack.imgur.com/sCZFs.png)

一旦你触摸它，你就会被转移到奖励阶段（即作为参数传递给 call/cc [f 在这种情况下] 的函数的定义）。

***奖励阶段与普通阶段不同，***因为它们通常有一个元素（即传递给 call/cc 的函数的参数），如果您触摸它，您就会丢失并被传送回正常阶段。

[![退出奖励阶段和调用/抄送函数 args 之间的并行](https://i.stack.imgur.com/DnLar.png)](https://i.stack.imgur.com/DnLar.png)

因此，是否有很多并不重要`args`，当您到达其中一个时，它就结束了。所以我们的执行到达`(arg 42)`并返回到 sum `(+ 42 10)`。

还有一些值得注意的地方：

*   并非所有函数都可以与 call/cc 一起使用。因为它需要一个延续（即一个函数），所以你不能有这样的 f: `(define f (lambda (k) (+ k 42))` ，因为你不能`sum`有一个函数。
*   您也不能拥有`(define f (lambda (k) (f 42 10)))` ，因为延续只需要一个参数。
*   您可以在没有`touching`任何退出的情况下完成，在这种情况下，函数会像任何普通函数一样继续执行（例如`(define f (lambda (k) 42)` ，完成并返回 42）。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-03-04T22:51:11.750

对我有帮助的一点是，在带有函数调用的传统语言中，每当你进行函数调用时，你都会隐式地传递一个延续。

在跳转到函数的代码之前，您在堆栈上保存一些状态（即，您推送您的返回地址并且堆栈已经包含您的本地人）。这本质上是一个延续。当函数完成时，它必须确定将执行流发送到哪里。它使用存储在堆栈中的延续，弹出返回地址并跳转到它。

其他语言概括了这种延续的想法，允许您明确指定继续执行代码的位置，而不是隐式地从进行函数调用的位置继续。

根据评论编辑：

延续是完整的执行状态。在执行的任何时候，您都可以将程序分成两部分（在时间上，而不是空间上） - 已经运行到这一点的部分，以及将从这里运行的所有部分。“当前的延续”是“将从这里开始运行的一切”（你可以把它想象成一个函数，它将完成你程序的其余部分所做的一切）。因此，您提供给的函数在被调用`call/cc`时传递了当前的延续。`call/cc`该函数可以使用延续将执行返回到`call/cc`语句（尽管它更有可能将延续传递给其他东西，因为如果它直接使用它，它可以做一个简单的返回）。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2009-06-03T00:36:18.233

当我试图理解 call/cc 时，我发现这个[call-with-current-continuation-for-C-programmers](http://community.schemewiki.org/?call-with-current-continuation-for-C-programmers)页面很有帮助。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-03-09T20:55:09.523

理解 call/cc 有多个层次。首先，您需要了解这些术语以及该机制的工作原理。然后需要了解如何以及何时在“现实生活”编程中使用 call/cc。

第一级可以通过学习 CPS 达到，但还有其他选择。

对于第二级，我推荐弗里德曼的以下经典。

丹尼尔·弗里德曼。 [“延续的应用：特邀教程”](http://www.cs.indiana.edu/hyplan/dfried/appcont.pdf)。1988 年编程语言原理 (POPL88)。1988 年 1 月。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2011-04-22T22:43:50.463

看看[FScheme的call/cc的描述和实现](https://web.archive.org/web/20160116204833/http://blogs.msdn.com/b/ashleyf/archive/2010/02/11/turning-your-brain-inside-out-with-continuations.aspx)

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2011-09-22T23:02:34.443

我用来从命令式的角度理解延续的模型是，它是调用堆栈的副本以及指向下一条指令的指针。

Call/cc 调用一个函数（作为参数传递），并将延续作为参数。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2020-03-10T10:37:03.083

您可能熟悉“控制转移”的概念，它在诸如 C 之类的语言中体现在诸如 , 和 , 之类的语句中`break`，或者`continue`在支持异常的语言中 - and语句中。`return``goto``try``catch`

您可以想象`break`并且`continue`可以使用来实现`goto`（即，对于使用`break`or的每一段代码`continue`，您可以轻松编写使用`goto`适当放置标签的等效代码）。

所以现在让我们专注于`goto`，正如你应该从你的装配经验中知道的那样 - 是最基本的控制转移操作（你可以想象它很难转换`return`使用`goto`- 但我们会继续讨论）。

因此，假设您有一个如下所示的程序（例如，在 C 中）：

```
instruction1;
instruction2;
...
instructionN; 
```

where`instructionK`可以是赋值或函数调用或语句`if (condition) goto some_label`。

您可以在每一行前面加上一个唯一的标签`goto`：

```
line1: instruction1;
line2: instruction2;
...
lineN: instructionN; 
```

在支持一等延续的语言中，有一个特殊的函数`call/cc`，它的工作方式如下：假设它`instructionK`的形式为

```
...
lineK: call/cc(function(continuation) { ... })
lineK+1: instructionK+1;
... 
```

我在这里使用 JavaScript 的匿名函数表示法，因为 C 不支持匿名函数。您可以看到该函数有一个参数，我称之为`continuation`.

函数的主体在`call/cc`被调用时立即执行，`continuation`参数的值将是`lineK+1`（粗略地说）的地址。或者，换句话说，**当前的延续是*-*这`lineK``lineK+1`**就是你可以考虑的方式。

然而，典型的接口不仅仅是地址：`continuation`参数是一个过程，当被调用时，它会跳转到`lineK+1`. 这就是`call/cc`允许实现`return`语句的方式。

因此，您可以将其`call/cc`视为`goto`类固醇的一种。问题是，您不仅可以调用`continuation`参数，还可以将其存储在变量或其他数据结构中。

`call/cc`我见过的最有趣的用法是 Dorai Sitaram 的书[Teach Yourself Scheme in Fixnum Days](http://ds26gte.github.io/tyscheme/index-Z-H-16.html#node_chap_14)中 Amb 评估器的实现（您可以将它与[Structure and Interpretation of Computer Programs](https://mitpress.mit.edu/sites/default/files/sicp/full-text/book/book-Z-H-28.html#%25_sec_4.3)中未使用的版本进行比较`call/cc`）。

我曾经也使用延续实现了我自己的资源管理机制，如此[处](https://lists.gnu.org/archive/html/guile-user/2013-07/msg00054.html)所述。

但除此之外，一流的延续受到批评，我不建议在生产代码中使用它们（它们与 C 中可用的[setjmp/longjmp](https://en.wikipedia.org/wiki/Setjmp.h)机制非常相似，我也不鼓励。但如果你想看一些使用示例，[这里](https://github.com/panicz/hubertos/blob/master/hubertos.c)是您如何使用它在 100 行 od 代码中实现多任务处理的方法）。

# vmware - 用vmware打开vpc镜像？

> ID：612764
> 
> 赞同：2
> 
> 时间：2009-03-04T22:31:25.060
> 
> 标签：vmware, virtualization, virtual-pc, vpc

我发现文章说这是可能的，但有什么问题？关闭你的vpc然后用vmware打开它是否“总是”简单？

从[这个](http://blog.componentoriented.com/?p=49)将近 3 年的链接说你可以，但你必须在关闭它之前将一些 windows 文件复制到 vpc 中，这仍然有效吗？

**更新 1**

找到了通过[鼠标驱动程序问题的链接](http://geekswithblogs.net/ZarkBlog/archive/2008/01/14/vpc-to-vmware-mouse-problems.aspx)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-05T00:38:45.347

只需使用[VMware 转换器](http://www.vmware.com/support/ws5/doc/ws_newguest_vm_importer.html)。

您可能想要做的一件事是在关闭*之前卸载所有 VPC 驱动程序。*VPC 和 VMware 鼠标驱动程序发生冲突，如果您不这样做，它就会变得丑陋并退化为一堆注册表黑客，以使鼠标再次工作。

否则，是的。就是这么简单。去年我转换了一大堆 VPC 机器（当时不知道鼠标驱动程序问题），这是一个非常顺利的过程。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-05T06:29:59.230

我是写那篇文章的人。我最近没有尝试转换任何图像（一旦我离开 Virtual PC，我就再也没有回头），但我今晚再次尝试查看是否有任何变化。事实证明，根本没有太大变化。

我拿了一个微软发布的用于测试 IE6 的虚拟磁盘，尝试构造一个 VPC 来配合它，最后使用 VMWare 的转换器将此虚拟磁盘转换为 VMWare 磁盘。它在 VMWare 服务器中打开得很好，当我启动时，机器发现了一些新的硬件设备，并要求从 XP 磁盘中获取驱动程序，就像我以前看到的一样。我相信，这是由于 Virtual PC 和 VMWare 之间的仿真差异造成的。

我还没有去追踪这个虚拟机正在寻找的驱动程序，因为我不打算长期保留它，但我记得一旦设置好这些驱动程序，虚拟机就可以正常工作了。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-05T03:57:22.780

将 vpc 转换为 vmware 后，您不再需要 Virtual PC。VMware 工作站要好得多。如果有人只需要使用现有映像，他们可以使用免费的 VMware 播放器。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-17T00:46:36.120

我最近做了这个。这是你要做的：

1.  从您的来宾中卸载 Virtual PC 加载项。
2.  创建一个新的基于 VMWare 的映像，在选择或创建新的虚拟硬盘驱动器时 - 选择您的 VHD 文件。

奇迹般有效。

# c# - Silverlight ReaderWriterLock 实现好/坏？

> ID：612765
> 
> 赞同：3
> 
> 时间：2009-03-04T22:32:00.487
> 
> 标签：c#, silverlight, multithreading

我为 Silverlight[采用](http://staceyw.spaces.live.com/blog/cns!f4a38e96e598161e!482.entry)了一个简单（无升级或超时）ReaderWriterLock 的实现，我想知道任何具有适当专业知识的人都可以验证它的设计是好是坏。对我来说，它看起来还不错，它像宣传的那样工作，但我对多线程代码的经验有限。

```
public sealed class ReaderWriterLock
{
    private readonly object syncRoot = new object();    // Internal lock.
    private int i = 0;                                  // 0 or greater means readers can pass; -1 is active writer.
    private int readWaiters = 0;                        // Readers waiting for writer to exit.
    private int writeWaiters = 0;                       // Writers waiting for writer lock.
    private ConditionVariable conditionVar;             // Condition variable.

    public ReaderWriterLock()
    {
        conditionVar = new ConditionVariable(syncRoot);
    }

    /// <summary>
    /// Gets a value indicating if a reader lock is held.
    /// </summary>
    public bool IsReaderLockHeld
    {
        get
        {
            lock ( syncRoot )
            {
                if ( i > 0 )
                    return true;
                return false;
            }
        }
    }

    /// <summary>
    /// Gets a value indicating if the writer lock is held.
    /// </summary>
    public bool IsWriterLockHeld
    {
        get
        {
            lock ( syncRoot )
            {
                if ( i < 0 )
                    return true;
                return false;
            }
        }
    }

    /// <summary>
    /// Aquires the writer lock.
    /// </summary>
    public void AcquireWriterLock()
    {
        lock ( syncRoot )
        {
            writeWaiters++;
            while ( i != 0 )
                conditionVar.Wait();      // Wait until existing writer frees the lock.
            writeWaiters--;
            i = -1;             // Thread has writer lock.
        }
    }

    /// <summary>
    /// Aquires a reader lock.
    /// </summary>
    public void AcquireReaderLock()
    {
        lock ( syncRoot )
        {
            readWaiters++;
            // Defer to a writer (one time only) if one is waiting to prevent writer starvation.
            if ( writeWaiters > 0 )
            {
                conditionVar.Pulse();
                Monitor.Wait(syncRoot);
            }
            while ( i < 0 )
                Monitor.Wait(syncRoot);
            readWaiters--;
            i++;
        }
    }

    /// <summary>
    /// Releases the writer lock.
    /// </summary>
    public void ReleaseWriterLock()
    {
        bool doPulse = false;
        lock ( syncRoot )
        {
            i = 0;
            // Decide if we pulse a writer or readers.
            if ( readWaiters > 0 )
            {
                Monitor.PulseAll(syncRoot); // If multiple readers waiting, pulse them all.
            }
            else
            {
                doPulse = true;
            }
        }
        if ( doPulse )
            conditionVar.Pulse();                     // Pulse one writer if one waiting.
    }

    /// <summary>
    /// Releases a reader lock.
    /// </summary>
    public void ReleaseReaderLock()
    {
        bool doPulse = false;
        lock ( syncRoot )
        {
            i--;
            if ( i == 0 )
                doPulse = true;
        }
        if ( doPulse )
            conditionVar.Pulse();                     // Pulse one writer if one waiting.
    }

    /// <summary>
    /// Condition Variable (CV) class.
    /// </summary>
    public class ConditionVariable
    {
        private readonly object syncLock = new object(); // Internal lock.
        private readonly object m;                       // The lock associated with this CV.

        public ConditionVariable(object m)
        {
            lock (syncLock)
            {
                this.m = m;
            }
        }

        public void Wait()
        {
            bool enter = false;
            try
            {
                lock (syncLock)
                {
                    Monitor.Exit(m);
                    enter = true;
                    Monitor.Wait(syncLock);
                }
            }
            finally
            {
                if (enter)
                    Monitor.Enter(m);
            }
        }

        public void Pulse()
        {
            lock (syncLock)
            {
                Monitor.Pulse(syncLock);
            }
        }

        public void PulseAll()
        {
            lock (syncLock)
            {
                Monitor.PulseAll(syncLock);
            }
        }

    }

} 
```

如果它很好，它可能对其他人也有帮助，因为 Silverlight 目前缺少读写器类型的锁。谢谢。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-04T23:18:12.077

[我在我的博客](http://www.moserware.com/2008/09/how-do-locks-lock.html)（下至 x86 级别）上深入解释了[Vance Morrison 的 ReaderWriterLock](http://blogs.msdn.com/vancem/archive/2006/03/28/563180.aspx)（在 .NET 3.5 中成为 ReaderWriterLockSlim ）。这可能对您的设计有所帮助，尤其是了解事物的实际运作方式。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-04T22:40:49.733

您的 IsReadorLockHeld 和 IsWriterLockHeld 方法在概念层面都有缺陷。虽然可以确定在给定的时间点是否持有特定的锁，但如果没有这些信息，您绝对不能安全地做任何事情，除非您继续持有锁（代码中不是这种情况）。

这些方法将更准确地命名为 WasReadLockHeldInThePast 和 WasWriterLockHeldInThePast。一旦您将方法重命名为更准确地表示它们所做的事情，就会清楚地表明它们不是很有用。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-04T23:11:20.220

这个类对我来说似乎更简单，并提供相同的功能。它的性能可能稍差，因为它总是 PulsesAll()，但逻辑更容易理解，我怀疑性能影响是否那么大。

```
public sealed class ReaderWriterLock()
{
    private readonly object internalLock = new object();
    private int activeReaders = 0;
    private bool activeWriter = false;

    public void AcquireReaderLock()
    {
        lock (internalLock)
        {
            while (activeWriter)
                Monitor.Wait(internalLock);
            ++activeReaders;
        }
    }

    public void ReleaseReaderLock()
    {
        lock (internalLock)
        {
            // if activeReaders <= 0 do some error handling
            --activeReaders;
            Monitor.PulseAll(internalLock);
        }
    }

    public void AcquireWriterLock()
    {
        lock (internalLock)
        {
            // first wait for any writers to clear 
            // This assumes writers have a higher priority than readers
            // as it will force the readers to wait until all writers are done.
            // you can change the conditionals in here to change that behavior.
            while (activeWriter)
                Monitor.Wait(internalLock);

            // There are no more writers, set this to true to block further readers from acquiring the lock
            activeWriter = true;

            // Now wait till all readers have completed.
            while (activeReaders > 0)
                Monitor.Wait(internalLock);

            // The writer now has the lock
        }
    }

    public void ReleaseWriterLock()
    {
        lock (internalLock)
        {
            // if activeWriter != true handle the error
            activeWriter = false;
            Monitor.PulseAll(internalLock);
        }
    }
} 
```

# c# - 如何用 C# 绘制表格？

> ID：612773
> 
> 赞同：2
> 
> 时间：2009-03-04T22:34:13.680
> 
> 标签：c#, .net, vector

我需要用 C# 将数据表绘制成矢量图像。我正在寻找一个库或组件来帮助我绘制表格，而不必自己关心它的布局。

我只想关心哪些数据属于哪个单元格。

我已经知道一些允许我使用 C# 创建矢量图像的库（例如用于 SVG 图像的 SharpVectorGraphics/SvgNet），但我找不到任何可以帮助我处理表格的东西。

### 问题

有人知道可以做到这一点的库或组件吗？如果它做得好，它不一定是免费的。矢量图像应具有可由 Microsoft PowerPoint 和 Word 的标准安装显示的格式。

### 问题2：

有谁知道用 C# 将（一个）HTML（表格）渲染到图像的方法？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2011-05-02T12:18:16.120

你可以使用[aspose;](http://www.aspose.com/categories/.net-components/aspose.words-for-.net/key-features.aspx) 如果没有其他人为您提供更好的解决方案。它会按照你的要求做，但它“感觉”不是一个好的解决方案！

*   在内存中创建 Word 文档
*   添加表格
*   填充该表
*   导出到图像。

希望有人想出更好的东西！:(

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-05-02T12:41:37.720

我可以想到两种解决方法。

[绘图：](http://msdn.microsoft.com/en-us/library/aa287522%28VS.71%29.aspx) 您可以使用 C# 随意绘制表格和内容，这种方式当然会耗费大量时间，但可能是最快和最专业的方式。

[打印到图片](http://www.java2s.com/Tutorial/CSharp/0460__GUI-Windows-Forms/PrintBMPimage.htm) 与其他人的建议有点相似，根据您的需要制作 HTML 代码，然后将其放入 WebBrowser 控制台。然后对位图进行打印预览。

# c# - WPF ListView中字符串开头的省略号

> ID：612774
> 
> 赞同：12
> 
> 时间：2009-03-04T22:34:26.377
> 
> 标签：c#, wpf, string, listview, ellipsis

我有一个 WPF `ListView`( `GridView`) 并且单元格模板包含一个`TextBlock`. 如果我在`TextTrimming="CharacterEllipsis" TextWrapping="NoWrap"`上添加： `TextBlock`，当列变得小于字符串的长度时，我的字符串末尾会出现一个省略号。我需要的是在字符串的开头有省略号。

即，如果我有字符串`Hello World!`，我想要`...lo World!`，而不是`Hello W...`.

有任何想法吗？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2016-04-22T08:52:08.113

我遇到了同样的问题并写了一个附加属性来解决这个问题（或者说，提供这个功能）。在这里捐赠我的代码：

## 用法

```
<controls:TextBlockTrimmer EllipsisPosition="Start">
    <TextBlock Text="Excuse me but can I be you for a while"
               TextTrimming="CharacterEllipsis" />
</controls:TextBlockTrimmer> 
```

不要忘记在您的 Page/Window/UserControl 根目录中添加命名空间声明：

```
xmlns:controls="clr-namespace:Hillinworks.Wpf.Controls" 
```

`TextBlockTrimmer.EllipsisPosition`可以是`Start`, `Middle`(mac 风格) 或`End`. 很确定你可以从他们的名字中找出哪个是哪个。

## 代码

### 文本块修剪器.cs

```
using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Linq;
using System.Text;
using System.Windows;
using System.Windows.Controls;
using System.Windows.Markup;

namespace Hillinworks.Wpf.Controls
{
    enum EllipsisPosition
    {
        Start,
        Middle,
        End
    }

    [DefaultProperty("Content")]
    [ContentProperty("Content")]
    internal class TextBlockTrimmer : ContentControl
    {
        private class TextChangedEventScreener : IDisposable
        {
            private readonly TextBlockTrimmer _textBlockTrimmer;

            public TextChangedEventScreener(TextBlockTrimmer textBlockTrimmer)
            {
                _textBlockTrimmer = textBlockTrimmer;
                s_textPropertyDescriptor.RemoveValueChanged(textBlockTrimmer.Content,
                                                            textBlockTrimmer.TextBlock_TextChanged);
            }

            public void Dispose()
            {
                s_textPropertyDescriptor.AddValueChanged(_textBlockTrimmer.Content,
                                                         _textBlockTrimmer.TextBlock_TextChanged);
            }
        }

        private static readonly DependencyPropertyDescriptor s_textPropertyDescriptor =
            DependencyPropertyDescriptor.FromProperty(TextBlock.TextProperty, typeof(TextBlock));

        private const string ELLIPSIS = "...";

        private static readonly Size s_inifinitySize = new Size(double.PositiveInfinity, double.PositiveInfinity);

        public EllipsisPosition EllipsisPosition
        {
            get { return (EllipsisPosition)GetValue(EllipsisPositionProperty); }
            set { SetValue(EllipsisPositionProperty, value); }
        }

        public static readonly DependencyProperty EllipsisPositionProperty =
            DependencyProperty.Register("EllipsisPosition",
                                        typeof(EllipsisPosition),
                                        typeof(TextBlockTrimmer),
                                        new PropertyMetadata(EllipsisPosition.End,
                                                             TextBlockTrimmer.OnEllipsisPositionChanged));

        private static void OnEllipsisPositionChanged(DependencyObject d, DependencyPropertyChangedEventArgs e)
        {
            ((TextBlockTrimmer)d).OnEllipsisPositionChanged((EllipsisPosition)e.OldValue,
                                                             (EllipsisPosition)e.NewValue);
        }

        private string _originalText;

        private Size _constraint;

        protected override void OnContentChanged(object oldContent, object newContent)
        {
            var oldTextBlock = oldContent as TextBlock;
            if (oldTextBlock != null)
            {
                s_textPropertyDescriptor.RemoveValueChanged(oldTextBlock, TextBlock_TextChanged);
            }

            if (newContent != null && !(newContent is TextBlock))
                // ReSharper disable once LocalizableElement
                throw new ArgumentException("TextBlockTrimmer access only TextBlock content", nameof(newContent));

            var newTextBlock = (TextBlock)newContent;
            if (newTextBlock != null)
            {
                s_textPropertyDescriptor.AddValueChanged(newTextBlock, TextBlock_TextChanged);
                _originalText = newTextBlock.Text;
            }
            else
                _originalText = null;

            base.OnContentChanged(oldContent, newContent);
        }

        private void TextBlock_TextChanged(object sender, EventArgs e)
        {
            _originalText = ((TextBlock)sender).Text;
            this.TrimText();
        }

        protected override Size MeasureOverride(Size constraint)
        {
            _constraint = constraint;
            return base.MeasureOverride(constraint);
        }

        protected override Size ArrangeOverride(Size arrangeBounds)
        {
            var result = base.ArrangeOverride(arrangeBounds);
            this.TrimText();
            return result;
        }

        private void OnEllipsisPositionChanged(EllipsisPosition oldValue, EllipsisPosition newValue)
        {
            this.TrimText();
        }

        private IDisposable BlockTextChangedEvent()
        {
            return new TextChangedEventScreener(this);
        }

        private static double MeasureString(TextBlock textBlock, string text)
        {
            textBlock.Text = text;
            textBlock.Measure(s_inifinitySize);
            return textBlock.DesiredSize.Width;
        }

        private void TrimText()
        {
            var textBlock = (TextBlock)this.Content;
            if (textBlock == null)
                return;

            if (DesignerProperties.GetIsInDesignMode(textBlock))
                return;

            var freeSize = _constraint.Width
                           - this.Padding.Left
                           - this.Padding.Right
                           - textBlock.Margin.Left
                           - textBlock.Margin.Right;

            // ReSharper disable once CompareOfFloatsByEqualityOperator
            if (freeSize <= 0)
                return;

            using (this.BlockTextChangedEvent())
            {
                // this actually sets textBlock's text back to its original value
                var desiredSize = TextBlockTrimmer.MeasureString(textBlock, _originalText);

                if (desiredSize <= freeSize)
                    return;

                var ellipsisSize = TextBlockTrimmer.MeasureString(textBlock, ELLIPSIS);
                freeSize -= ellipsisSize;
                var epsilon = ellipsisSize / 3;

                if (freeSize < epsilon)
                {
                    textBlock.Text = _originalText;
                    return;
                }

                var segments = new List<string>();

                var builder = new StringBuilder();

                switch (this.EllipsisPosition)
                {
                    case EllipsisPosition.End:
                        TextBlockTrimmer.TrimText(textBlock, _originalText, freeSize, segments, epsilon, false);
                        foreach (var segment in segments)
                            builder.Append(segment);
                        builder.Append(ELLIPSIS);
                        break;

                    case EllipsisPosition.Start:
                        TextBlockTrimmer.TrimText(textBlock, _originalText, freeSize, segments, epsilon, true);
                        builder.Append(ELLIPSIS);
                        foreach (var segment in ((IEnumerable<string>)segments).Reverse())
                            builder.Append(segment);
                        break;

                    case EllipsisPosition.Middle:
                        var textLength = _originalText.Length / 2;
                        var firstHalf = _originalText.Substring(0, textLength);
                        var secondHalf = _originalText.Substring(textLength);

                        freeSize /= 2;

                        TextBlockTrimmer.TrimText(textBlock, firstHalf, freeSize, segments, epsilon, false);
                        foreach (var segment in segments)
                            builder.Append(segment);
                        builder.Append(ELLIPSIS);

                        segments.Clear();

                        TextBlockTrimmer.TrimText(textBlock, secondHalf, freeSize, segments, epsilon, true);
                        foreach (var segment in ((IEnumerable<string>)segments).Reverse())
                            builder.Append(segment);
                        break;
                    default:
                        throw new NotSupportedException();
                }

                textBlock.Text = builder.ToString();
            }
        }

        private static void TrimText(TextBlock textBlock,
                                     string text,
                                     double size,
                                     ICollection<string> segments,
                                     double epsilon,
                                     bool reversed)
        {
            while (true)
            {
                if (text.Length == 1)
                {
                    var textSize = TextBlockTrimmer.MeasureString(textBlock, text);
                    if (textSize <= size)
                        segments.Add(text);

                    return;
                }

                var halfLength = Math.Max(1, text.Length / 2);
                var firstHalf = reversed ? text.Substring(halfLength) : text.Substring(0, halfLength);
                var remainingSize = size - TextBlockTrimmer.MeasureString(textBlock, firstHalf);
                if (remainingSize < 0)
                {
                    // only one character and it's still too large for the room, skip it
                    if (firstHalf.Length == 1)
                        return;

                    text = firstHalf;
                    continue;
                }

                segments.Add(firstHalf);

                if (remainingSize > epsilon)
                {
                    var secondHalf = reversed ? text.Substring(0, halfLength) : text.Substring(halfLength);
                    text = secondHalf;
                    size = remainingSize;
                    continue;
                }

                break;
            }
        }
    }
} 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2017-09-27T23:40:42.513

我实现（复制）了上面的`TextBlockTrimmer`代码，它非常适合加载，但`TextBlock.Text`如果绑定到更改的视图模型属性，之后不会更新。我发现有效的是

1.  定义一个 DependencyProperty 调用`TextBlockText`，`TextBlockTrimmer`类似于`EllipsisPosition`上面的属性，包括一个`OnTextBlockTextChanged()`方法。
2.  在`OnTextBlockTextChanged()`方法中，在调用之前设置`_originalText`为.`newValue``TrimText()`
3.  将该属性绑定`TextBlockText`到 View Model 属性（`SomeText`在下面的 XAML 中调用）
4.  `TextBlock.Text`将属性绑定到`TextBlockTrimmer.TextBlockText`XAML 中的属性：

    ```
    <controls:TextBlockTrimmer EllipsisPosition="Middle" TextBlockText="{Binding SomeText, Mode=OneWay}"
        <TextBlock Text="{Binding TextBlockText, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type controls:TextBlockTrimmer}}}" HorizontalAlignment="Stretch"/>
    </controls:TextBlockTrimmer> 
    ```

如果我同时绑定`TextBlockTrimmer.TextBlockText`和绑定它也`TextBlock.Text`有效`SomeText`（但这样做让我很烦）。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-05T13:46:47.293

不幸的是，这在今天的 WPF 中是不可能的，正如您[从文档](http://msdn.microsoft.com/en-us/library/system.windows.controls.textblock.texttrimming.aspx)中看到的那样。

（我曾经在 Microsoft 从事 WPF 工作，不幸的是，这是我们没有去做的一个功能——不确定它是否计划在未来的版本中使用）

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-09T09:20:10.927

您可以尝试使用 ValueConverter （参见[*IValueConverter* interface](http://msdn.microsoft.com/en-us/library/system.windows.data.ivalueconverter.aspx)）来更改自己应该在列表框中显示的字符串。也就是说，在 Convert 方法的实现中，您将测试字符串是否比可用空间长，然后将它们更改为 ... 加上字符串的右侧。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2010-02-18T16:06:58.610

这是一个如何使用递归对数算法进行有效文本剪辑的示例：

```
private static string ClipTextToWidth(
    TextBlock reference, string text, double maxWidth)
{
    var half = text.Substring(0, text.Length/2);

    if (half.Length > 0)
    {
        reference.Text = half;
        var actualWidth = reference.ActualWidth;

        if (actualWidth > maxWidth)
        {
            return ClipTextToWidth(reference, half, maxWidth);
        }

        return half + ClipTextToWidth(
            reference,
            text.Substring(half.Length, text.Length - half.Length),
            maxWidth - actualWidth);
    }
    return string.Empty;
} 
```

假设您有一个`TextBlock`名为 的字段`textBlock`，并且您希望以给定的最大宽度剪辑其中的文本，并附加省略号。以下方法调用`ClipTextToWidth`来设置`textBlock`字段的文本：

```
public void UpdateTextBlock(string text, double maxWidth)
{
    if (text != null)
    {
        this.textBlock.Text = text;

        if (this.textBlock.ActualWidth > maxWidth)
        {
            this.textBlock.Text = "...";
            var ellipsisWidth = this.textBlock.ActualWidth;

            this.textBlock.Text = "..." + ClipTextToWidth(
                this.textBlock, text, maxWidth - ellipsisWidth);
        }
    }
    else
    {
        this.textBlock.Text = string.Empty;
    }
} 
```

希望有帮助！

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2021-01-05T13:49:41.390

感谢您的帮助 hillin 和 bcunning。[为了完整起见](https://stackoverflow.com/a/36789218/13211180)
，这里是必须附加到由 bcunning描述的[hillin](https://stackoverflow.com/a/46458793/13211180)代码的代码。

**文本块修剪器.cs**

```
public string TextBlockText
{
  get => (string)GetValue(TextBlockTextProperty);
  set => SetValue(TextBlockTextProperty, value);
}

public static readonly DependencyProperty TextBlockTextProperty =
  DependencyProperty.Register("TextBlockText",
                              typeof(string),
                              typeof(TextBlockTrimmer),
                              new PropertyMetadata("", OnTextBlockTextChanged));

private static void OnTextBlockTextChanged(DependencyObject d, DependencyPropertyChangedEventArgs e)
{
  ((TextBlockTrimmer)d).OnTextBlockTextChanged((string)e.OldValue, (string)e.NewValue);
}

private void OnTextBlockTextChanged(string oldValue, string newValue)
{
  _originalText = newValue;
  this.TrimText();
} 
```

我在 ComboBox 中使用它，对我来说它是这样工作的。
**XAML：**

```
<ComboBox ItemsSource="{Binding MyPaths}" SelectedItem="{Binding SelectedPath}" ToolTip="{Binding SelectedPath}">
  <ComboBox.ItemTemplate>
    <DataTemplate>
      <controls:TextBlockTrimmer EllipsisPosition="Start" TextBlockText="{Binding Mode=OneWay}">
        <TextBlock Text="{Binding}" ToolTip="{Binding}"/>
      </controls:TextBlockTrimmer>
    </DataTemplate>
  </ComboBox.ItemTemplate>
</ComboBox> 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2021-08-26T07:26:36.967

您可以使用[IMultiValueConverter](https://docs.microsoft.com/en-us/dotnet/api/system.windows.data.imultivalueconverter)自己修剪文本来实现这一点。

在 convert 方法中，您测试字符串长度，如果它比`TextBlock.ActualWidth`.

这是我使用的实现：

```
public class StartTrimmingConverter :IMultiValueConverter
{
  public object Convert(object[] values, Type targetType, object parameter,
      CultureInfo culture)
  {
    if (values.Length != 2 || !(values[1] is TextBlock))
      return string.Empty;

    TextBlock reference = values[1] as TextBlock;
    return GetTrimmedText(reference, values[0].ToString());
  }

  public object[] ConvertBack(object value, Type[] targetTypes, object parameter,
      CultureInfo culture) => throw new NotImplementedException();

  private static string GetTrimmedText(TextBlock reference, string text)
  {
    if (text != null)
    {
      double maxWidth = reference.ActualWidth - 
              reference.Padding.Left - reference.Padding.Right;

      if (MeasureString(reference, text).Width > maxWidth)
      {
        double ellipsisWidth = MeasureString(reference, "...").Width;

        return "..." + ClipTextToWidth(reference, text,
            maxWidth - ellipsisWidth);
      }
      else
        return text;
    }
    else
      return string.Empty;
  }

  private static string ClipTextToWidth(TextBlock reference, string text,
      double maxWidth)
  {
    int start = (int)Math.Ceiling(text.Length / 2.0f);
    string half = text.Substring(start, text.Length / 2);

    if (half.Length > 0)
    {
      double actualWidth = MeasureString(reference, half).Width;

      if (MeasureString(reference, half).Width > maxWidth)
      {
        return ClipTextToWidth(reference, half, maxWidth);
      }

      return ClipTextToWidth(reference, text.Substring(0, start),
        maxWidth - actualWidth) + half;
    }
    return string.Empty;
  }

  private static Size MeasureString(TextBlock reference, string candidate)
  {
    FormattedText formattedText = new FormattedText(
        candidate,
        CultureInfo.CurrentCulture,
        FlowDirection.LeftToRight,
        new Typeface(reference.FontFamily, reference.FontStyle,
                     reference.FontWeight, reference.FontStretch),
        reference.FontSize,
        Brushes.Black,
        new NumberSubstitution(),
        1);

    return new Size(formattedText.Width, formattedText.Height);
  }
} 
```

对于 XAML 的使用：

```
<Resources>
    <my:StartTrimmingConverter x:Key="trimConv" />
</Resources>
...
<TextBlock>
    <TextBlock.Text>
        <MultiBinding Converter="{StaticResource trimConv}">
            <Binding Path="PropertyName"/>
            <Binding RelativeSource="{RelativeSource Self}"/>
        </MultiBinding>
    </TextBlock.Text>
</TextBlock> 
```

（感谢丹尼尔对用于文本剪辑的递归对数算法的回答）

* * *

## 回答 #8

> 赞同：-5
> 
> 时间：2011-02-07T06:02:01.537

万一其他人像我一样偶然发现了这个问题，这是另一个答案更好的线程（不计分）：

[在 WPF 标签中自动剪辑和附加点](https://stackoverflow.com/questions/2996155/auto-clip-and-append-dots-in-wpf-label/2996198#2996198)

# wiki - 使用类似 StackOverflow 的编辑工具托管 wiki？

> ID：612783
> 
> 赞同：11
> 
> 时间：2009-03-04T22:37:18.243
> 
> 标签：wiki, markdown, wmd

我们正在为我们的一个项目创建开发人员文档，我想将其设置为托管 wiki。

会有很多代码示例，StackOverflow 上使用的 WMD/Prettify 组合是我见过的输入结构化文本（带有标题等）并结合自动格式化代码块的最简单方法。

有谁知道使用此编辑工具集的现有托管 wiki 服务，因此我们不必编写自己的（至少不是马上）？

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-04T22:56:09.027

许多 wiki 引擎都是开源的

为什么不抓住你最喜欢的并添加到 WMD 编辑器中呢？

Screwturn.eu 是一个不错的 C# wiki，具有出色的可扩展性模型和出色的标记管道，升级到 WMD 应该很简单

下载 v3 测试版并查看 /core/Formatter.cs 和 /core/FormattingPipeline.cs 的 REGEX 从 WMD markdown 撰写页面

和 /WebApplication/Editor.ascx 用于编辑器自定义控件，您可以使用一些 LH-RH 代码插入 WMD

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-17T05:39:37.190

查看[Mindtouch 的 DekiWiki](http://www.mindtouch.com/)。他们使用[fckeditor](http://www.fckeditor.net/demo)，我相信，这是非常用户友好的。有一个免费的托管版本（具有有限的扩展功能），您可以付费购买非常强大的版本。

我们将它用于内部文档，它非常棒。

# python - 促进代码生成的最佳 Python 模板库

> ID：612788
> 
> 赞同：32
> 
> 时间：2009-03-04T22:38:52.093
> 
> 标签：python, templates, code-generation

与其花第二天（或一年）的时间阅读它们，还有什么关于模板引擎的建议我应该更详细地研究吗？

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2009-03-04T22:46:56.940

最佳建议：全部尝试。不会花很长时间。

我最喜欢的：[Jinja2](https://jinja.palletsprojects.com)（一英里）

它有不错的语法，可以通过它跟踪错误，并且是沙盒的。

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2009-03-05T15:19:59.473

如果您在进行代码生成，您可能会发现[Cog](http://nedbatchelder.com/code/cog/)很有用——它专门用于代码生成，而不是一种普遍适用的模板语言。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2009-03-04T22:50:40.973

最重要的问题是您是否可以接受模板所需的语法。第二和第三（取决于您的应用程序需求）将是速度和易于分发。

我查看了所有这些，但我唯一能忍受的语法是[Jinja](https://jinja.palletsprojects.com "金贾")。Jinja 具有支持大量 Python 结构的优势，因此可以很容易地根据需要向模板添加功能片段，而无需编写特殊标签。其他模板系统中需要标签的大部分内容都由 Jinja 中的宏处理。

当然，如果您正在寻找简单快捷的东西，那么在核心语言中很难击败[Python 模板 API 。](http://docs.python.org/library/string.html#template-strings)

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-03-05T03:50:10.677

*更新： Kid 似乎已被[Genshi](https://genshi.edgewall.org/)继任。*

我用过 Kid，我认为这是较旧的系统之一。我发现它非常坚固、稳定和可靠。它是基于标签的，因此非常适合使用 XML/HTML。有趣的是，模板函数是作为 HTML 属性完成的，而不是特殊块，即 {% ... %}。但是，其中的某些方面（尤其是它“包含”的方式）可能会变得非常令人讨厌。它似乎也没有被积极开发或根本不再开发。

如果您想要一些已经存在了一段时间并且已经变得相当稳定的东西，那么值得一看。如果您想要更新的内容，我听说过有关 Genshi 和 Jinja 的好消息。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-04T23:01:00.153

我喜欢[Clearsilver](http://www.clearsilver.net)，因为它可以与几种不同的语言一起使用，并且它严格执行数据和表示之间的分离。我以前使用过 Cheetah，虽然它非常好，但我不喜欢使用有时看起来像是一种有限形式的 Python。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-04T23:45:52.820

如果您正在使用 X[HT]ML，那么可以为您提供格式良好的模板的基于标签的模板系统之一是一个不错的选择。我使用[PXTL](http://www.doxdesk.com/software/py/pxtl.html)， FWIW。（它可以生成其他格式，但如果您的重点不是 XML 或 HTML，那将不是一个明智的选择。）

我非常不喜欢那些声称通过将表达式限制为它们自己的小语言来“帮助您分离业务逻辑和表示”的模板系统。他们似乎不明白存在诸如“表示逻辑”之类的东西，而且它有时会变得复杂到需要像 Python 这样的真正语言来运行它。让您将演示逻辑与业务逻辑一起踢到应用程序中*并不是一个胜利*。避免！

（有限的表达式分离迷你语言方法在 JSP 的“EL”中是有意义的，因为 Java 过于冗长而无法在模板库中使用。但我们有 Python！它非常适合在模板中编写表达式；切碎功能和让用户学习另一种新语言对你没有任何好处。）

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-03-05T13:00:14.830

如果您想要一个*非常轻量级*的选项，请尝试 Templete。它只是单个模块中的 80 行代码。看看[这里](http://davidbau.com/archives/2007/02/18/python_templates.html)和[这里](http://davidbau.com/archives/2007/03/11/python_string_functions.html)（它发表在博客中）。如果功能足以满足您的需求，我认为这是一个聪明且非常专注的解决方案。

# .net - System.Drawing.Font：没有字体粗细的概念？

> ID：612790
> 
> 赞同：0
> 
> 时间：2009-03-04T22:39:51.077
> 
> 标签：.net, system.drawing

我只是注意到在.net 中 System.Drawing.Font 似乎没有字体粗细的概念，除了正常和粗体的 FontStyle。我没有在win32中的精细控制。WPF 框架具有字体权重，但我没有使用该命名空间。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-04T22:49:38.480

我认为您可以使用 Win32 创建字体，然后使用 Font.FromHfont 包装它。

# ios - Objective-C 2.0 中的点运算符

> ID：612795
> 
> 赞同：3
> 
> 时间：2009-03-04T22:41:04.193
> 
> 标签：ios, objective-c, cocoa, cocoa-touch

刚刚拿起Objective-C 2.0，想知道使用点运算符而不是“旧”方式访问属性是否有任何优势。我的意思的简短示例。

“旧”方式：

```
 [myFraction setNumerator: 1];
 [myFraction setDenominator: 3]; 
```

“新方法：

```
 myFraction.numerator = 1;
 myFraction.denominator = 3; 
```

谢谢！

罗德里戈

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-04T22:44:24.530

唯一的区别是易于打字和可读性。哪个更具可读性的意见因人而异:)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-04T22:57:29.787

当我降低对象并使用括号实际设置属性时，我使用点语法。

像这样：

```
[self.view setFrame:CGRectMake(0, 0, 320, 480)]; 
```

代替：

```
[[self view] setFrame:CGRectMake(0, 0, 320, 480)]; 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-04T23:09:08.073

我实际上喜欢新语法——但也许是因为我是 Python 程序员。

点属性语法与 KVC/KVO 中的键路径很好地结合在一起。在我看来，它比嵌套括号更整洁（而且我喜欢方案，所以我不反对括号嵌套！），并且在您访问属性而不是传递消息时使其明确 - 即使机制是相同的。

而且，我看到对象的属性访问（基本上）与访问结构或联合成员的操作相同，因此语法*应该*相同。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-04T22:52:43.510

我会主张旧的方式：

方括号语法最明显地表明您正在访问 Objective-C 对象的成员，而点语法表明您正在处理 C 结构（或联合）。

除此之外，这只是个人选择和更多/更少打字的问题。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-06T23:51:25.147

C++ 和 C# 程序员在访问成员变量时可能会更自然地适应点运算符，因为它在这些语言中具有相似的用法。

# javascript - 从可排序移动到可排序

> ID：612799
> 
> 赞同：0
> 
> 时间：2009-03-04T22:41:59.620
> 
> 标签：javascript, jquery, jquery-ui, jquery-ui-sortable

我有什么方法可以让用户将我放在可排序列表（`I used jquery ui's $.sortable()`函数）中的 div 拖到不同的可排序列表中？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-03-04T22:44:49.350

查看[`connectWith`](http://docs.jquery.com/UI/Sortable#option-connectWith)可排序的选项。

本质上，如果您只想`#DivA`能够将元素拖动到`#DivB`您的可排序对象中：

```
$('#DivA').sortable({connectWith: ['#DivB']});
$('#DivB').sortable(); 
```

如果您希望能够在两者之间交换项目，则必须以两种方式设置关系：

```
$('#DivA').sortable({connectWith: ['#DivB']});
$('#DivB').sortable({connectWith: ['#DivA']}); 
```

# objective-c - 带有 NSTableView 的箭头键

> ID：612805
> 
> 赞同：15
> 
> 时间：2009-03-04T22:43:30.787
> 
> 标签：objective-c, cocoa, macos

是否可以使用箭头键和 enter/tab 在 NSTableView 周围导航 NSTableView 的可编辑单元格？例如，我想让它更像电子表格。

这个应用程序的用户需要编辑很多单元格（但不是全部），我认为如果他们不必双击每个单元格，这样做会更容易。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2010-04-21T15:13:11.733

在 Sequel Pro 中，我们使用了不同的（在我看来更简单）的方法：我们`control:textView:doCommandBySelector:`在 TableView 的委托中实现。这种方法很难找到——它可以在**NSControlTextEditingDelegate 协议参考**中找到。（记住 NSTableView 是 NSControl 的子类）

长话短说，这就是我们想出的（我们没有覆盖左/右箭头键，因为它们用于在单元格内导航。我们使用 Tab 向左/向右）

请注意，这只是 Sequel Pro 源代码的一个片段，不能按原样工作

```
- (BOOL)control:(NSControl *)control textView:(NSTextView *)textView doCommandBySelector:(SEL)command
{
    NSUInteger row, column;

    row = [tableView editedRow];
    column = [tableView editedColumn];

    // Trap down arrow key
    if (  [textView methodForSelector:command] == [textView methodForSelector:@selector(moveDown:)] )
    {
        NSUInteger newRow = row+1;
        if (newRow>=numRows) return TRUE; //check if we're already at the end of the list
        if (column>= numColumns) return TRUE; //the column count could change

        [tableContentView selectRowIndexes:[NSIndexSet indexSetWithIndex:newRow] byExtendingSelection:NO];
        [tableContentView editColumn:column row:newRow withEvent:nil select:YES];
        return TRUE;
    }

    // Trap up arrow key
    else if (  [textView methodForSelector:command] == [textView methodForSelector:@selector(moveUp:)] )
    {
        if (row==0) return TRUE; //already at the beginning of the list
        NSUInteger newRow = row-1;

        if (newRow>=numRows) return TRUE;
        if (column>= numColumns) return TRUE;

        [tableContentView selectRowIndexes:[NSIndexSet indexSetWithIndex:newRow] byExtendingSelection:NO];
        [tableContentView editColumn:column row:newRow withEvent:nil select:YES];
        return TRUE;
    } 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-05T23:55:41.450

好吧，这并不容易，但我设法做到了，而无需使用 RRSpreadSheet 甚至其他控件。这是你必须做的：

1.  创建 的子类`NSTextView`，这将是字段编辑器。在本例中，`MyFieldEditorClass`将使用名称并将`myFieldEditor`引用此类的一个实例。

2.  添加一个`MyFieldEditorClass`名为“ `- (void) setLastKnownColumn:(unsigned)aCol andRow:(unsigned) aRow`”或类似名称的方法，并让它将两个输入参数值保存在某处。

3.  添加另一个名为“setTableView：”的方法，并让它将 NSTableView 对象保存在某处，或者除非有另一种方法可以从字段编辑器中获取 NSTableView 对象，否则请使用它。

4.  添加另一个名为`- (void) keyDown:(NSEvent *) event`. 这实际上覆盖了`NSResponder`'s `keyDown:`。源代码应该是（注意 StackOverflow 的 MarkDown 正在改变`<`and`>`到`&lt;`and `&gt;`）：

    ```
    - (void) keyDown:(NSEvent *) event
    {
        unsigned newRow = row, newCol = column;
        switch ([event keyCode])
        {
            case 126: // Up
                if (row)
                newRow = row - 1;
                break;

            case 125: // Down
                if (row < [theTable numberOfRows] - 1)
                    newRow = row + 1;
                break;

            case 123: // Left
                if (column > 1)
                    newCol = column - 1;
                break;

            case 124: // Right
                if (column < [theTable numberOfColumns] - 1)
                    newCol = column + 1;
                break;

            default:
                [super keyDown:event];
                return;
        }

        [theTable selectRow:newRow byExtendingSelection:NO];
        [theTable editColumn:newCol row:newRow withEvent:nil select:YES];
        row = newRow;
        column = newCol;
    } 
    ```

5.  给你的 nib 中的 NSTableView 一个委托，并在委托中添加方法：

    ```
    - (BOOL) tableView:(NSTableView *)aTableView shouldEditColumn:(NSTableColumn *) aCol row:aRow
    {
        if ([aTableView isEqual:TheTableViewYouWantToChangeBehaviour])
            [myFieldEditor setLastKnownColumn:[[aTableView tableColumns] indexOfObject:aCol] andRow:aRow];
        return YES;
    } 
    ```

6.  最后，给 Table View 的主窗口一个委托并添加方法：

    ```
    - (id) windowWillReturnFieldEditor:(NSWindow *) aWindow toObject:(id) anObject
    {
        if ([anObject isEqual:TheTableViewYouWantToChangeBehaviour])
        {
            if (!myFieldEditor)
            {
                myFieldEditor = [[MyFieldEditorClass alloc] init];
                [myFieldEditor setTableView:anObject];
            }
            return myFieldEditor;
        }
        else
        {
            return nil;
        }
    } 
    ```

运行程序并试一试！

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-06T08:32:52.797

与其强迫`NSTableView`做一些不是为它设计的事情，不如考虑使用为此目的而设计的东西。我有一个开源电子表格控件，它可以做你需要的，或者你至少可以扩展它来做你需要的：[MBTableGrid](http://github.com/mattball/mbtablegrid/)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-05-15T20:21:17.500

我想在这里回复答案，但回复按钮似乎不见了，所以当我真的只想问一个关于回复的问题时，我不得不证明答案。

无论如何，我已经看到了一些关于覆盖表视图的 -keyDown 事件的答案，这些答案说是对 TableView 进行子类化，但是根据我到目前为止读过的每一本 Objective-C 书籍，以及几个 Apple 培训视频，你应该很少如果曾经是核心类之一的子类。事实上，他们每个人都指出 C 程序员对子类化很着迷，而这不是 Objective-C 的工作方式。Objective-C 完全是关于助手和委托而不是子类化。

那么，我是否应该忽略任何对子类的回应，因为这似乎与 Objective-C 的规则直接矛盾？

- - 编辑 - -

我发现了一些无需子类化 NSTableView 即可工作的东西。虽然我确实将继承从 NSObject 到 NSResponder 的链上移了一个档次，但我并没有完全继承 NSTableView。我只是添加了覆盖 keyDown 事件的能力。

我使我用作委托的类继承自 NSResponder 而不是 NSObject，并在 awakeFromNib 中将 nextResponder 设置为该类。然后我能够使用 keydown 事件来捕获按键。我当然连接了 IBOutlet 并在 Interface Builder 中设置了委托。

这是我的代码，显示密钥捕获所需的最低限度：

头文件

```
//  AppController.h

#import <Cocoa/Cocoa.h>

@interface AppController : NSResponder {

    IBOutlet NSTableView *toDoListView;
    NSMutableArray *toDoArray;
}

-(int)numberOfRowsInTableView:(NSTableView *)aTableView;

-(id)tableView:(NSTableView *)tableView
objectValueForTableColumn:(NSTableColumn *)aTableColumn
           row:(int)rowIndex;

@end 
```

这是m文件。

```
//  AppController.m
#import "AppController.h"

@implementation AppController

-(id)init
{
    [super init];
    toDoArray = [[NSMutableArray alloc] init];
    return self;
}

-(void)dealloc
{
    [toDoArray release];
    toDoArray = nil;
    [super dealloc];
}

-(void)awakeFromNib
{
    [toDoListView setNextResponder:self];
}

-(int)numberOfRowsInTableView:(NSTableView *)aTableView
{
    return [toDoArray count];
}

-(id)tableView:(NSTableView *)tableView
    objectValueForTableColumn:(NSTableColumn *)aTableColumn
                          row:(int)rowIndex
{
    NSString *value = [toDoArray objectAtIndex:rowIndex];
    return value;
}

- (void)keyDown:(NSEvent *)theEvent
{
    //NSLog(@"key pressed: %@", theEvent);
    if (theEvent.keyCode == 51 || theEvent.keyCode == 117)
    {
        [toDoArray removeObjectAtIndex:[toDoListView selectedRow]];
        [toDoListView reloadData];
    }
}
@end 
```

# asp.net - 如何在 ASP.NET C# 中执行多个数据库请求？

> ID：612814
> 
> 赞同：0
> 
> 时间：2009-03-04T22:46:16.850
> 
> 标签：asp.net, sql

在我编写的每个 ASP.NET 应用程序中，在将信息输出到网页上之前，我都会向数据库发出一些请求。

例如：

```
var DataTable1 = GetDataTable("Select * From Customers");
var DataTable2 = GetDataTable("Select * From Products");
var DataTable3 = GetDataTable("Select * From Orders"); 
```

据我所知，上面的代码将对数据库进行 3 次单独的访问，并且会一个接一个地进行。

无论如何我可以收集我的参数化 SQL 语句并且只访问数据库服务器 1 次吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-04T22:50:18.197

```
var SqlString = "SELECT * FROM Customers; SELECT * FROM Products; SELECT * FROM ORDERS;");
var ds = GetDataSet(SqlString);
var DataTable1 = ds.Tables(0);
var DataTable2 = ds.Tables(1);
var DataTable3 = ds.Tables(2); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-12-19T06:56:08.093

我的解决方案：

```
SqlConnection con = new SqlConnection("Server=CLASS-III-WKS10\\SQLEXPRESS;Initial 
Catalog=wind;Integrated Security=True");
int[] id=new int[9];
int i = 0;
page_load()
{
    con.Open();
    SqlCommand cmd = new SqlCommand("select *from windmill", con);
    SqlDataReader rd = cmd.ExecuteReader();
    while (rd.Read())
    {
        id[i] = rd.GetInt32(9);
        i++;
        //MessageBox.Show(id.ToString());  
    }
    rd.close();
    SqlCommand cmd1 = new SqlCommand("Update windmill set State='Stopped',PmState='Not Available'where Id=0", con);
    cmd1.ExecuteNonQuery(); 
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-04T22:53:47.253

使用分号分隔 SQL 语句和 reader.NextResult 以获取每个集合。您的代码最终会看起来像这样。

```
 Using con As New SqlConnection
        Using cmd As New SqlCommand("Select * From Customers; Select * From Products; Select * From Orders")
            Using reader = cmd.ExecuteReader
                Dim dt1 As DataTable
                dt1.Load(reader)

                reader.NextResult()

                Dim dt2 As DataTable
                dt2.Load(reader)

                reader.NextResult()

                Dim dt3 As DataTable
                dt3.Load(reader)

            End Using
        End Using
    End Using 
```

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-03-04T22:49:33.987

创建一个 Thread 类并在该类中放置一个接受字符串查询作为输入的方法：然后创建一个 Thread 对象并启动该对象。

看看这个[http://msdn.microsoft.com/en-us/library/aa645740(VS.71).aspx](http://msdn.microsoft.com/en-us/library/aa645740(VS.71).aspx)

# c# - 如何在属性网格的自定义字段中显示相似值？

> ID：612820
> 
> 赞同：2
> 
> 时间：2009-03-04T22:47:50.120
> 
> 标签：c#, winforms, propertygrid

我有一个属性网格，可以帮助我管理表单上的所有控件。这些控件是为设计师类型的人设计的，所以我不太担心用户界面......直到有人选择多个对象。

我有一个 UITypeEditor 用于这些常见对象的“BottomDiameter”属性。它跟踪单位（米与英尺）并即时做一些好事。但是，当有人选择两个或三个常见对象时，BottomDiameter 为空白，即使它计算为相同的文本字符串。

（我认为）它是空白的原因是它实际上是三个单独的 objDiameter 对象。我如何告诉属性网格的行为与所有其他属性一样，并在计算结果为相同字符串时显示值？？？

更新：例如，“Anchor”属性的文本输出为“Top, Right”，但当您将其拉下时，它是一个对象。然而，当您在表单上选择五个都具有相同 Anchor 设置的对象时，您仍然可以在属性网格中看到字符串“Top, Right”。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-05T15:52:08.443

在归因于 BottomDiameter 属性的 Datatype 的 TypeConvertor 中，您可能想要创建一个类似于名为 BottomDiameterVistor 的类，它将采用一个数组或所选 BottomDiameter(s) 的列表。覆盖 BottomDiameterVistor 上的 to 字符串属性以返回该属性的聚合文本值。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-09-04T17:52:44.507

如果您的 BottomDiameter 是一个类而不是一个简单的基元，那么您必须重写该类中的 Equals 方法。

# http - 访问网站时，您最初是在什么时候获得唯一的 http cookie？

> ID：612822
> 
> 赞同：0
> 
> 时间：2009-03-04T22:47:59.137
> 
> 标签：http

访问网站时，您最初是在什么时候获得唯一的 http cookie？

我在从网站创建 gui auth 登录时问这个问题。您在访问网站的那一刻得到您的 cookie 吗？如果是这样，如果您没有通过主页访问该网站并直接进入[http://website.com/login.php](http://website.com/login.php)表单，如果您还没有收到它们，您最初是否也会在此处获取 cookie？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-05T00:02:28.163

**在加载设置 cookie 的第一页时。**

它将与该页面的内容一起在 HTTP 标头中发送。

在 PHP 中：

您可以在将输出发送到浏览器之前随时设置 cookie。

您可以在设置后随时阅读（通过 $_COOKIE），包括在同一页面加载中。

请记住，如果您在设置它的同一页面加载中读取它，那么您是从当前进程读取它，而不是从客户端的 cookie 中读取它，它还没有发送。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-04T23:04:26.790

以下是 cookie 及其行为的官方标准：

[http://www.ietf.org/rfc/rfc2965.txt](http://www.ietf.org/rfc/rfc2965.txt)

大多数浏览器会尽可能地遵循这个标准，但请注意，这取决于实现者。如果有错误，那么行为当然是不同的。

我认为您正在寻找的是，只要域或 URI 相同，cookie 就会随请求一起传递。

正如其他人所提到的，cookie 可以被操纵并且本质上是不安全的。不要将它们用作安全措施。您可以跟踪他们已成功登录，但您应该在该事实上设置到期日期。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-04T22:55:51.740

每当您的浏览器发出 http 请求时，服务器/应用程序都可以设置 cookie。换句话说，答案取决于实现。

我建议您查看[Fiddler](http://www.fiddlertool.com/fiddler/)（或其他一些 http 跟踪工具）以更好地了解交互。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-04T22:57:08.943

对此没有正确答案。这是一个实现细节，没有两个网站（使用不同的基本代码）以相同的方式做。变量包括实现系统/语言（ASP、PHP、Python、Ruby 等）、标准化（或自定义）库的使用、网站的安全意识、网站的编写时间等。

无论您首先从哪个页面到达，大多数网站都会设置您的会话 cookie。有很多方法可以做到这一点，但都涉及到调​​用网站源代码中用于处理会话、权限、导航、登录等的常用例程的每个可能的入口点。

话虽如此，我有很多网站不会设置任何 cookie，直到您做一些需要记住的事情（登录、将产品添加到购物车、设置偏好等）。

你应该怎么做取决于什么对你的网站很重要。对此没有单一的答案。

# c# - C#中partial关键字的实际用法

> ID：612831
> 
> 赞同：8
> 
> 时间：2009-03-04T22:49:55.547
> 
> 标签：c#, .net, class

我知道它可以让 Visual Studio 将 WinForms UI 代码与 UI 事件等分开。但是它有什么实际用途吗？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-03-04T22:51:11.877

partial 关键字通常用于代码生成实用程序中，以允许开发人员向生成的代码添加额外的功能，而不必担心再次生成代码时该代码会被删除。

在 C# 3 中，partial 关键字可以应用于方法，以允许生成代码的用户填写生成器留下的空白。例如，Linq To Sql 设计器提供了部分方法，允许您将逻辑添加到框架在实现时将调用的类。这里的好处是 C# 编译器将完全删除未实现的部分方法，因此不实现它们*根本不会影响性能。*

部分类也可用于将非常大的类组织成单独的代码文件，尽管这种用法通常表明您的类太大并且承担了太多责任。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-04T22:59:30.077

我能想到的 partial 关键字的最佳用途是嵌套类。如果没有 partial 关键字，所有嵌套类都必须与包含类放在同一个代码文件中。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-04T23:22:49.490

我发现的一种用途是用于您可能不希望存在于生产代码中的代码，例如跟踪或开发日志记录代码。您可以将它放在部分类中，然后当您进行生产构建时，您只需构建不包含这些部分的内容，编译器将自动去除对那些被排除的部分的任何调用。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-04T22:52:14.947

我用它来划分一些方法需要大量代码的辅助类。这是保持可读性的一种非常简单的方法，因为每个文件只处理类的一部分功能。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-04T22:55:02.973

在 VB 中，您可以使用它来将“正常”代码与需要通过“Option Strict Off”进行后期绑定的代码分开。

在 C# 中，我只将它用于异常大的类。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-04T22:54:37.110

LINQ to SQL 设计器广泛使用它来拆分映射类之外的自定义行为（部分方法）。
简而言之，它的主要目的是用于代码生成器。
希望这可以帮助。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-04T23:06:20.093

我在 Linq2Sql 中一直使用部分类和方法。否则，除了 UI/代码隐藏类之外，我从未将它用于其他任何东西。

我喜欢 linq2sql 中的分部类的一大优点是您可以让分部类继承一个接口，并将接口映射到生成的类。如果您有多个数据提供者并且仍希望对所有数据访问类使用相同的接口，这将非常有用。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-04T23:24:23.497

WPF 广泛使用部分类。XAML 生成一个可以添加到的部分类。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-03-05T05:19:36.637

当我知道我们将有多个开发人员在一个类上工作时，我使用部分类来减少版本控制的合并痛苦。例如，我们经常将 DAL 类拆分为几个部分类文件。如果您不将它们放在不同的文件中，则很容易出现合并冲突，这些冲突在签入版本 ctl 时需要一段时间才能修复。

当课程接近完成时开发变得不那么混乱时，我们摆脱了部分文件。我们只是用它来简化 VC/多开发人员的问题

# asp.net - Web 应用程序编译模型与网站模型的信息

> ID：612842
> 
> 赞同：0
> 
> 时间：2009-03-04T22:52:29.517
> 
> 标签：asp.net

谁能给我一个漂亮、专家但简明的总结 ASP.NET 编译模型与较旧的代码隐藏样式 Web 应用程序？

我对使用部分类和按需编译的较新*网站模型相当熟悉，但我很好奇 ASP.NET 如何将前端部署的 ASPX 页面与后面的预编译代码结合起来。*它是否仍然对 ASPX 进行按需编译，但在后面引用代码，还是什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-04T22:59:34.617

代码隐藏充当基类。aspx 部分仍然可以进行按需编译。编译为 dll 的代码隐藏类。

# c# - 是什么让 ADO.NET 实体框架与市场上的其他 ORM 不同？

> ID：612858
> 
> 赞同：4
> 
> 时间：2009-03-04T22:56:10.880
> 
> 标签：c#, .net, vb.net, entity-framework, ado.net

问题标题很清楚，我想知道为什么它不同以及为什么，何时为我的项目选择它？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-05T12:43:32.140

[I wrote a blog post on this a while ago](http://blogs.teamb.com/craigstuntz/2008/07/17/37825/ "The ADO.NET Entity Framework vs. NHibernate and Other ORMs"). In short, it takes a fundamentally different approach to ORM than Hibernate, ECO, and the other ORMs that I have looked at. You may think this approach is better, worse, or unimportant, but if you look deep enough it's hard to dispute that it is different. But don't take my word on it. If you're really interested in this subject, I strongly recommend reading [this technical paper](http://portal.acm.org/citation.cfm?id=1412331.1412334 "Compiling mappings to bridge applications and databases") and [this interview](http://queue.acm.org/detail.cfm?id=1394137) in ACM Queue.

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-04T23:00:18.983

这可能不是您正在寻找的答案，但我认为您不应该在您的项目中使用它。它很年轻，也不是很完整。等下一个版本出来。

如果您坚持使用实体框架，那么它有一些好处。一个不错的方法是它允许以非常简单的方式进行复杂的映射。当然，因为它是一项微软技术，所以 IDE 集成很好。

但就像我说的，我试过了，我不相信它已经准备好真正使用了。

无论如何，祝你项目好运

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-04T23:16:52.143

根据我的阅读，它对 WCF 远程处理/二进制序列化有很好的支持，这是许多 ORM 不太支持的（如果有的话）。如果您想在客户端使用 ORM 创建富客户端/服务器/远程处理应用程序，则可能值得研究。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-05T01:55:10.453

ADO.NET 不是 ORM。

基本上，区别在于每个人使用的抽象级别。

使用 ADO，您基本上可以查询数据库并将结果用作对象，就像 RDBMS 和您的对象之间的桥梁。

您对数据库进行建模，然后从该模型创建对象。这就是为什么它是一个实体框架（数据库实体）

ORM 不是用于查询或将数据库记录表示为对象（尽管这是每个人都使用它们的方式——包括我在内——），而是一种将对象模型持久保存到关系数据库中的方法。

它们是对象到关系映射（不是关系到对象映射）

因此，当您有一个域（对象）模型并且想要将其持久化（到 RDBMS）时，或者当您有一个实体模型并且想要将其用作应用程序中的对象时，您可以选择其中一种。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-05T01:33:01.863

有什么不同？它没有从所有其他 ORM 中学习。

以下是我一直在为 InfoQ 追踪的问题

[LINQ-to-Entities 真的会根据之前的查询返回不同的结果吗？](http://www.infoq.com/news/2008/12/Lazy-Loading)

[解决实体框架的大数据模型问题](http://www.infoq.com/news/2008/12/EF-Large)

[ADO.NET Entity Framework 2010 的无更改跟踪](http://www.infoq.com/news/2008/11/EF-2010-Fail)

如果您决定使用它，这个工具是必不可少的。

[用于 LINQ to SQL 和 ADO.NET 实体框架的元数据同步工具](http://www.infoq.com/news/2008/12/Huagati)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-05T02:37:01.740

.NET 领域的一些最优秀的 ORM 人才似乎正在从事 NHibernate（免费开源；我使用它）和 LLBLGen Pro（商业）等项目。

NHibernate 是企业级全面多供应商 ORM 的主导标准。NHibernate 也是纯 ORM 实现的主导标准，允许开发人员完全独立于 NHibernate 基础架构编写域模型，并完全消除代码生成的类。

NHibernate 一开始可能看起来很吓人。但是一旦你稍微使用它，它实际上是相当友好的，并且自 7 月以来一直在努力使 NHibernate 几乎无需配置。

# multithreading - 使用更多线程时，什么会使程序运行速度变慢？

> ID：612860
> 
> 赞同：3
> 
> 时间：2009-03-04T22:57:07.477
> 
> 标签：multithreading, pthreads, parallel-processing

这个问题是关于我[之前问过](https://stackoverflow.com/questions/564577/dividing-loop-iterations-among-threads)的同一个程序。回顾一下，我有一个具有如下循环结构的程序：

```
for (int i1 = 0; i1 < N; i1++)
  for (int i2 = 0; i2 < N; i2++)
    for (int i3 = 0; i3 < N; i3++)
      for (int i4 = 0; i4 < N; i4++)
        histogram[bin_index(i1, i2, i3, i4)] += 1; 
```

`bin_index`是其论点的完全确定性函数，就这个问题而言，它不使用或更改任何共享状态 - 换句话说，它显然是可重入的。

我第一次编写这个程序是为了使用单线程。然后我将它转换为使用多个线程，这样线程`n`运行外部循环 where 的所有迭代`i1 % nthreads == n`。所以在每个线程中运行的函数看起来像

```
for (int i1 = n; i1 < N; i1 += nthreads)
  for (int i2 = 0; i2 < N; i2++)
    for (int i3 = 0; i3 < N; i3++)
      for (int i4 = 0; i4 < N; i4++)
        thread_local_histogram[bin_index(i1, i2, i3, i4)] += 1; 
```

并且所有的`thread_local_histogram`s 都在最后添加到主线程中。

奇怪的是：当我只用 1 个线程运行程序以进行某些特定大小的计算时，大约需要 6 秒。当我用 2 或 3 个线程运行它时，进行完全相同的计算，大约需要 9 秒。这是为什么？我希望使用 2 个线程会比 1 个线程快，因为我有一个双核 CPU。该程序不使用任何互斥锁或其他同步原语，因此两个线程应该能够并行运行。

`time`供参考：一个线程（这是在 Linux 上）的典型输出：

```
real    0m5.968s
user    0m5.856s
sys     0m0.064s 
```

和两个线程：

```
real    0m9.128s
user    0m10.129s
sys     0m6.576s 
```

代码位于[http://static.ellipsix.net/ext-tmp/distintegral.ccs](http://static.ellipsix.net/ext-tmp/distintegral.ccs)

PS我知道有专门为这种事情设计的库可能会有更好的性能，但这就是我的最后一个问题，所以我不需要再次听到这些建议。（另外我想使用 pthreads 作为学习经验。）

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-03-04T23:25:07.863

为避免对此发表进一步评论：当我写回复时，发问者尚未发布指向其来源的链接，因此我无法针对他的具体问题调整我的回复。我只是在回答一般问题是什么“可以”导致这样的问题，我从未说过这必然适用于他的情况。当他发布了指向他的来源的链接时，我写了另一个回复，这完全是针对他的问题（这是由我在另一个回复中解释的 random() 函数的使用引起的）。但是，由于这篇文章的问题仍然是“使用更多线程时，什么会使程序运行速度变慢？” 而不是“是什么让我的非常具体的应用程序运行得更慢？”，我认为没有必要更改我相当笼统的回复（一般问题 -> 一般回复，具体问题 -> 具体回复）。

* * *

1）缓存中毒
所有线程都访问同一个数组，这是一块内存。每个内核都有自己的缓存以加快内存访问。由于它们不仅从数组中读取，而且还会更改内容，因此内容实际上仅在缓存中更改，而不是在实际内存中（至少不会立即更改）。问题是另一个核心上的另一个线程可能缓存了重叠的内存部分。如果现在核心 1 改变了缓存中的值，它必须告诉核心 2 这个值刚刚改变。它通过使核心 2 上的缓存内容无效来实现这一点，而核心 2 需要从内存中重新读取数据，这会减慢处理速度。缓存中毒只能发生在多核或多 CPU 机器上。如果您只有一个带有一个内核的 CPU，这没问题。因此，要确定这是否是您的问题，只需禁用一个核心（大多数操作系统允许您这样做）并重复测试。如果它现在几乎同样快，那就是你的问题。

2) 防止内存突发
如果按顺序读取内存，则读取速度最快，就像从 HD 读取文件一样。处理内存中的某个点实际上非常慢（就像 HD 上的“寻道时间”一样），即使您的 PC 拥有市场上最好的内存。但是，一旦解决了这一点，顺序读取就会很快。第一次寻址是通过发送行索引和列索引来进行的，并且在可以访问第一个数据之前总是有等待时间。一旦有这些数据，CPU 就会开始爆发。虽然数据仍在传输中，但它已经发送了下一次突发的请求。只要它保持突发（通过始终发送“请下一行”请求），RAM 将继续尽可能快地输出数据（这实际上非常快！）。仅当数据按顺序读取并且仅当内存地址向上增长时才有效（AFAIK，您不能从高地址突发到低地址）。如果现在两个线程同时运行并且都保持读/写内存，但是都来自完全不同的内存地址，那么每次线程 2 需要读/写数据时，它必须中断线程 1 的可能突发，反之亦然. 如果您有更多线程，这个问题会变得更糟，而且这个问题在只有一个单核 CPU 的系统上也是一个问题。它必须中断线程 1 的可能突发，反之亦然。如果您有更多线程，这个问题会变得更糟，而且这个问题在只有一个单核 CPU 的系统上也是一个问题。它必须中断线程 1 的可能突发，反之亦然。如果您有更多线程，这个问题会变得更糟，而且这个问题在只有一个单核 CPU 的系统上也是一个问题。

顺便说一句，运行的线程数多于内核数永远不会使您的进程更快（正如您提到的 3 个线程），它反而会减慢它的速度（线程上下文切换具有降低处理吞吐量的副作用） - 这与您运行更多线程不同，因为某些线程在某些事件上处于休眠或阻塞状态，因此无法主动处理任何数据。在这种情况下，运行比核心更多的线程可能是有意义的。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-04T23:48:38.713

到目前为止，我在其他答复中所说的一切仍然普遍适用，因为您的问题是“可以”...但是现在我已经看到了您的实际代码，我的第一个赌注是您对 random() 的使用功能减慢一切。为什么？

看，random 在内存中保存了一个全局变量，该变量存储了在那里计算的最后一个随机值。每次你调用 random() （并且你在一个函数中调用它两次）它读取这个全局变量的值，执行计算（不是那么快；random() 单独是一个慢函数）并写入在返回之前返回那里。这个全局变量不是每个线程的，它在所有线程之间共享。所以我写的关于缓存中毒的内容一直都适用于这里（即使你通过为每个线程设置单独的数组来避免数组中毒；这真是太聪明了！）。该值在任一内核的缓存中不断失效，必须从内存中重新获取。但是，如果您只有一个线程，则不会发生类似的情况，此变量在最初读取后永远不会离开缓存，因为它'

更糟糕的是，glibc 有一个线程安全的 random() 版本——我刚刚通过查看源代码验证了这一点。虽然这在实践中似乎是一个好主意，但这意味着每个 random() 调用都会导致互斥锁被锁定、内存被访问和互斥锁被解锁。因此，两个线程在同一时刻调用 random 将导致一个线程被阻塞几个 CPU 周期。但是，这是特定于实现的，因为 AFAIK 并不要求 random() 是线程安全的。大多数标准库函数不需要是线程安全的，因为 C 标准甚至不知道线程的概念。当他们不在同一时刻调用它时，互斥锁对速度没有影响（因为即使是单线程应用程序也必须锁定/解锁互斥锁），但是缓存中毒将再次应用。

您可以为每个线程预先构建一个包含随机数的数组，其中包含每个线程需要的随机数。在产生线程之前在主线程中创建它，并将对它的引用添加到您移交给每个线程的结构指针。然后从那里获取随机数。

或者，如果您不需要地球上“最好的”随机数，则只需实现您自己的随机数生成器，该随机数与每个线程内存一起工作以保持其状态 - 这可能比系统的内置生成器更快。

如果仅适用于 Linux 的解决方案适合您，则可以使用[random_r](http://www.kernel.org/doc/man-pages/online/pages/man3/random_r.3.html)。它允许您在每次调用时传递状态。只需为每个线程使用一个唯一的状态对象。然而这个函数是一个 glibc 扩展，它很可能不被其他平台支持（C 标准和 POSIX 标准 AFAIK 都不支持 - 例如，这个函数在 Mac OS X 上不存在，它可能不存在于 Solaris 或自由BSD）。

创建自己的随机数生成器实际上并不难。如果您需要真正的随机数，则不应首先使用 random() 。Random 仅创建伪随机数（看起来随机的数字，但如果您知道生成器的内部状态，则可以预测）。这是产生良好 uint32 随机数的代码：

```
static uint32_t getRandom(uint32_t * m_z, uint32_t * m_w)
{
    *m_z = 36969 * (*m_z & 65535) + (*m_z >> 16);
    *m_w = 18000 * (*m_w & 65535) + (*m_w >> 16);
    return (*m_z << 16) + *m_w;
} 
```

以某种适当的方式“播种” m_z 和 m_w 很重要，否则结果根本不是随机的。种子值本身应该已经是随机的，但在这里您可以使用系统随机数生成器。

```
uint32_t m_z = random();
uint32_t m_w = random();
uint32_t nextRandom;

for (...) {
    nextRandom = getRandom(&m_z, &m_w);
    // ...
} 
```

这样每个线程只需要调用 random() 两次，然后使用你自己的生成器。顺便说一句，如果您需要双随机数（介于 0 和 1 之间），则可以轻松地包装上面的函数：

```
static double getRandomDouble(uint32_t * m_z, uint32_t * m_w)
{
    // The magic number below is 1/(2^32 + 2).
    // The result is strictly between 0 and 1.
    return (getRandom(m_z, m_w) + 1) * 2.328306435454494e-10;
} 
```

尝试在您的代码中进行此更改，并让我知道基准测试结果如何:-)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-04T23:07:53.367

您正在看到[缓存行弹跳](http://chill-yo.blogspot.com/2007/02/quantifying-cache-bounces.html)。由于直方图桶上的竞争条件，您没有得到错误的结果，我真的很惊讶。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-04T23:01:02.163

一种可能性是创建线程所花费的时间超过了使用线程所节省的时间。如果 O(n^4) 操作的经过时间仅为 6 秒，我认为 N 不是很大。

也不能保证多个线程将在不同的内核或 CPU 上运行。我不确定 Linux 的默认线程亲和性是什么——**可能**两个线程都运行在一个内核上，这会抵消 CPU 密集型代码的好处，例如这样。

[本文](http://www.ibm.com/developerworks/linux/library/l-affinity.html)详细介绍了默认线程亲和性以及如何更改代码以确保线程在特定内核上运行。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-04T23:14:23.427

即使线程不会同时访问数组的相同元素，整个数组也可能位于几个内存页中。当一个核心/处理器写入该页面时，它必须使所有其他处理器的缓存无效。

避免让许多线程在相同的内存空间上工作。为每个线程分配单独的数据以进行处理，然后在计算完成时将它们连接在一起。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-04T23:21:47.823

在我的头顶上：

*   上下文切换
*   资源争用
*   CPU 争用（如果它们没有被拆分为多个 CPU）。
*   缓存抖动

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-05T11:41:58.250

大卫，

你确定你运行一个支持多处理器的内核吗？如果您的系统中只使用一个处理器，则产生额外的 CPU 密集型线程会减慢您的程序。

And, are you sure support for threads in your system actually utilizes multiple processors? Does top, for example, show that both cores in your processor utilized when you run your program?

# graphics - 最小化多边形顶点

> ID：612862
> 
> 赞同：11
> 
> 时间：2009-03-04T22:57:25.263
> 
> 标签：graphics, geometry, polygon, minimize, vertices

什么是减少多边形顶点数量而不改变多边形外观的好算法？

输入：一个多边形，表示为一个点列表，具有太多顶点：例如，来自鼠标的原始输入。

输出：一个顶点少得多的多边形，看起来仍然很像原始多边​​形：例如，可用于碰撞检测的多边形（不一定是凸的）。

编辑：对此的解决方案类似于在图表上找到最佳拟合的多段线。在我的算法书中，它被称为分段最小二乘法。

Edit2：Douglas Peucker 算法是我真正想要的。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-04T23:37:47.130

编辑：哦，看，[简化多边形](http://www.cs.sunysb.edu/~algorith/files/simplifying-polygons.shtml)

你提到了碰撞检测。您可以非常简单地计算围绕它的边界凸包。

如果您关心凹面区域，您可以通过获取多边形的质心并选择一个开始点来计算凹壳。从起点围绕质心旋转，找到要保留的每个顶点，并将其指定为边界外壳中的下一个顶点。算法的复杂性在于您如何确定要保留哪些顶点，但我相信您已经想到了这一点。您可以根据它们相对于质心的位置将所有顶点放入存储桶中。当一个桶的顶点数超过任意数量时，您可以拆分它。然后将该桶中顶点的平均值作为要在边界外壳中使用的顶点。或者，忘记水桶，当你在质心周围移动时，只有当它与最后一个点的距离超过给定距离时才选择一个点。

实际上，您可能只使用多边形中的所有顶点作为“点云”并计算围绕它的凹壳。我会寻找算法链接。最坏的情况是完全凸多边形。

另一种选择是从边界矩形开始。对于矩形上的每个顶点，找到该点到多边形的距离。对于最远的顶点，将其拆分为另外两个顶点并将它们移动一些。重复直到满足一定比例的顶点或区域。我得再考虑一下这个细节。

如果您关心实际上看起来相似的多边形，即使在自相交多边形的情况下，也需要另一种方法，但听起来没有必要，因为您询问了碰撞检测。

This [post](https://stackoverflow.com/questions/321989/greatest-linear-dimension-2d-set-of-points) has some details about the convex hull part.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-04T23:03:00.570

那里有很多材料。只需谷歌搜索“网格减少”、“网格简化”、“网格优化”等内容。

# javascript - 锚点 href 中的 innerHTML 和 C%23 (C#) - Firefox

> ID：612864
> 
> 赞同：1
> 
> 时间：2009-03-04T22:57:49.847
> 
> 标签：javascript, firefox, escaping, innerhtml

`If you set the innerHTML of a <div> to innerHTML = '<a href="Something/C%23">C#</a><br />';`

似乎实际上得到“渲染”的是：

```
<div>
<a href="Something/C#">C#</a><br />
</div> 
```

逃避这种情况的正确方法是什么，所以链接将保持 "Something/C%23" ？

**更新**：
我注意到这里有一个奇怪的小东西。如果您使用函数来建立链接。不需要额外的 %25 转义。奇怪的。
前任。

```
function buildLink(tg, nm) {
  return '<a href="Something/' + tg + '">' + nm + '</a><br />';
} 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-04T23:07:22.663

值得注意的是，许多浏览器会将指向“ `Something/C%23`”的链接呈现`Something/C#`为“友好”的 URL。检查您`div`使用的 Firebug 或类似工具，以确保它实际上设置不正确。

如果是这样，那么您需要将百分号转义为`%25`：

```
innerHTML = '<a href="Something/C%2523">C#</a><br />'; 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-04T23:05:40.610

试试这个：

```
<a href="Something/C%2523">C#</a><br /> 
```

`%`将“ ”扩展为“ `%25`”，您将得到您想要的。然后 " `%25`" 被转换回百分号字符并且后续`23`不会重新解释。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-04T23:05:59.890

逃避百分比本身，你应该拥有它。

```
innerHTML = '<a href="Something/C%2523">C#</a><br />'; 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-05T01:06:43.470

> 似乎实际上得到“渲染”的是：

```
<a href="Something/C#">C#</a><br /> 
```

没有。如果您将鼠标悬停在链接上，Firefox 会在状态栏中告诉您该链接转到“C#”，但它是在撒谎。实际上单击该链接，您最终会看到“C%23”（它会出现在地址栏中）。

> 逃避这种情况的正确方法是什么，所以链接将保持 "Something/C%23" ？

你第一次做对了。“Something/C%2523”编码过多。

> 我注意到这里有一个奇怪的小东西。如果您使用函数来建立链接。不需要额外的 %25 转义。

是否在功能中不会影响它。如果您使用地址栏输入 javascript: URLs 作为测试机制，*将会影响它，并且可能会让您感到困惑。*javascript: URLs 仍然是 URLs，并且在 JS 解释器查看代码之前，其中的任何 %-encoding 都将被撤消。如果你使用 JS 字符串文字转义你不会遇到这个问题：

```
javascript:alert(document.body.innerHTML='<a href="Something/C\x2523">C#</a>') 
```

# language-agnostic - 网络自动化

> ID：612866
> 
> 赞同：1
> 
> 时间：2009-03-04T22:58:00.207
> 
> 标签：language-agnostic, automation

我正在开发一个基于 Web 的旧应用程序和另一个应用程序之间的接口。那个旧的基于 Web 的应用程序运行良好，但没有任何 API 可以与之通信。

有任何编程方式可以说一个网络表单，例如：在这个字段上输入这个值，这个在另一个中，然后提交表单？

**更新：**我正在寻找这样的东西：

```
WebAutomation w = new WebAutomation("http://apphost/report");
w.forms[0].input[3].value = 123;
w.forms[0].input[4].value = "hello";
Response r = w.forms[0].submit();
... 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-04T23:03:12.033

在 .NET 中：[http ://watin.sourceforge.net/](http://watin.sourceforge.net/)

在红宝石中：[http ://wtr.rubyforge.org/](http://wtr.rubyforge.org/)

跨平台：[http ://seleniumhq.org/](http://seleniumhq.org/)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-04T23:03:30.240

你可以，但你必须模拟一个 POST 请求。字段（文本框、单选按钮等）作为键值对传输回资源。您需要对此资源发出请求（无论在 FORM 标记的 SUBMIT 操作中使用哪个），并将所有字段值对放入 POST 有效负载中，而不是请求。这是一个很好的程序，可以查看正在传输的值：http: [//www.httpwatch.com](http://www.httpwatch.com) 或者，您可以使用 Firebug，一个免费的 Firefox 扩展。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-04T23:37:30.533

尽管您的问题上有标签，但答案将是*高度*特定于语言的。根据您愿意实施的解决方案的复杂程度以及您正在寻找的结果的灵活性，还会有多种解决方案。

[一方面，您可以使用 Python 的mechanize](http://wwwsearch.sourceforge.net/mechanize/)之类的东西在很短的时间内完成很多工作，但另一方面，您可以通过使用 COM 对象自动化浏览器来真正进入胆量并进行大量控制作为[SHDocVw](http://www.google.com/search?q=SHDocVw)（当然，仅限 Windows）。

或者，正如 LoveMeSomeCode 所建议的那样，您真的可以将头撞到混凝土上并开始伪造 POST 请求，但是如果服务器正在对表单数据进行任何前端处理，那么祝您好运。

编辑：

如果您正在寻找可以快速上手的东西，另一种选择是使用[AutoIt](http://www.autoitscript.com/autoit3/index.shtml)的 IE 模块，该模块基本上提供了 Internet Explorer 实例上的编程接口（它下面的所有 COM，课程）。请记住，这可能是您可以选择的最不支持的选项。我个人使用它来生成概念验证自动化套件，然后迁移到更强大的 C# 实现，我自己处理 COM 调用。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-06T18:10:04.297

Perl 模块[WWW::Mechanize](http://search.cpan.org/perldoc?WWW::Mechanize)正是这样做的。您的示例将如下所示：

```
use WWW::Mechanize;
my $agent = WWW::Mechanize->new;
$agent->get("http://apphost/report");
my $response = $agent->submit_form(
    with_fields => {
        field_1_name => 123,
        field_2_name => "hello",
    },
); 
```

还有一个 Python 端口，我想许多其他语言也存在类似的库。

# .net - WCF：如何从 ServiceHost 获取端点列表？

> ID：612880
> 
> 赞同：45
> 
> 时间：2009-03-04T23:00:41.073
> 
> 标签：.net, wcf, .net-3.0

我可以使用`ServiceHost.AddServiceEndpoint`. 如何获取该端点列表？

* * *

## 回答 #1

> 赞同：80
> 
> 时间：2009-03-04T23:02:05.017

采用`host.Description.Endpoints`

# agile - Scrum 团队与传统组织的团队

> ID：612883
> 
> 赞同：1
> 
> 时间：2009-03-04T23:01:51.070
> 
> 标签：agile, scrum, organization

对于那些开始在开发团队中使用 Scrum 的人：你们是维持传统团队还是组建新团队？在我们的组织中，我们分为数据库、产品开发和前端开发人员（简化！）。

我感兴趣的是其他人是否真的因为 scrum 重组了他们的整个团队结构，或者你是否组建了专门的项目（？）团队，例如每个“旧”团队中的一个人。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-05T05:19:12.363

实际上，我什至无法想象如果你保持角色孤岛，Scrum 会如何工作。在 scrum 中，我们通过产品构建垂直切片，以便在 sprint 期间交付的每个功能都需要您提到的所有技能（加上您没有提到的 QA）。如果他们不都在同一个团队中，您将如何创建持续协作并让人们致力于冲刺？对我来说，这似乎是最有可能以“Scrumfall”结尾的方式。我无论如何都不是专家，但在我看来，在 scrum 中失败的肯定方法是将其视为项目管理解决方案，而不是整个组织变革。其核心是文化。

回答你关于“通才”的问题。简单的答案是，通过让某些人只能处理某些事情，你会在完成任务时造成巨大的脂肪瓶颈。对于专业，您总是在每一步都受到限制，因为资源有限。在 sprint 1 中，您可能有很多 db 工作要做，而不仅仅是一个 dba 可以做的事情。但是在 sprint 5 中，数据模型完全没有变化，您的 dba 将坐在那里保持无聊。如果您必须在任务级别按角色划分和分配，而不是仅仅抓住适合您团队速度的下一组优先功能，那么在 sprint 计划中几乎不可能在合理的时间内提交。从长远来看，通才模式必然会带来商业价值。

我会警告说，如果您已经按角色处于孤立的组中，那么在敏捷重组中您必须非常小心。许多人还没有准备好，也不想准备好失去他们的特殊头衔而只是成为团队成员。我认为你应该几乎总是期望一些营业额。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-04T23:14:57.373

在 scrum/敏捷开发中，团队中的大多数人都是“通才”，这意味着任何人都可以合理地进入任何角色，这样任何人都可以在待办事项中完成任务，而没有人在等待其他人。

现在，您今天的情况可能不是这种情况，但是做一些事情，例如同行编程和站立会议，以了解人们在哪里遇到障碍并改善知识的交叉授粉将有助于实现这一目标。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-04T23:06:57.907

在我的公司，我们为每个项目创建了一个临时的跨职能团队。我们现有的团队仍然存在，但我们拥有跨职能的 Scrum 团队非常重要。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-04T23:07:05.737

我们通常会尝试混合一点以获得一些跨团队的知识，但我们大部分时间都在我们的专业上工作。但随着项目的进展，我们可以更轻松地帮助不同的团队

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-05T04:50:28.580

当我为前任雇主工作时，公司重组了整个开发组织和产品管理。他们在每个团队中安排了工程师、QA 和分析师。拆分主要是垂直/功能性的，但有一些例外。这些例外是一个错误——垂直架构不适合，因为它真的是水平的。我认为跨职能团队运作良好。在您的情况下，数据库和前端部门需要尽可能与其余部门合并，并且可能会创建特定于您的产品的新垂直领域

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-05T05:21:43.717

我们将团队分为新产品开发和现有产品维护，任何开发人员都可以在冲刺之间从一个到另一个。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-10T18:07:40.730

我认为我们保持了传统的团队，至少目前是这样。在我工作的信息系统部门的应用程序分支中还有几个其他团队，尽管这些团队是在我们进入 Scrum 之前加入的。

我们大多数人都在进行一个使用 Scrum 的大项目，团队似乎发展得很好。我们有一些新的工具和流程，它们似乎对我们帮助很大，并给了我们一种“很棒”的感觉，希望我们能将这种感觉传递给其他团队。

对于数据库的更改，我们中的任何一个开发人员都可以在开发环境中进行更改，然后将脚本传递给 DBA，以便在它准备好投入生产时完成。对于网络的更改，有基础设施人员负责处理，并最初根据操作系统、网络、内存、硬盘驱动器等设置服务器。

# image-processing - 如何在 OCAML 中读取位图？

> ID：612886
> 
> 赞同：6
> 
> 时间：2009-03-04T23:02:41.210
> 
> 标签：image-processing, bitmap, ocaml

我想使用 OCAML 读取位图文件（从文件系统），并将像素（颜色）存储在具有位图维度的数组中，每个像素将占用数组中的一个单元格。

我找到了函数*Graphics.dump_image image -> color array array* 但它没有从文件中读取。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-05T02:26:33.480

[CAMLIMAGE](http://pauillac.inria.fr/camlimages/)应该这样做。还有一个 debian 包 ( `libcamlimage-ocmal-dev`)，以及通过[godi](http://godi.camlcity.org/godi/toc/toc-3.10.html)安装，如果您使用它来管理您的 ocaml 包。

作为在 ocaml 中读取和操作图像的一个有用示例，我建议在[eigenclass](http://eigenclass.org/hiki/seam-carving-in-ocaml)上查看接缝去除算法的代码。

正如乔纳森所说——但不是很好——你也可以从 ocaml 调用 C 函数，例如[ImageMagick](http://www.imagemagick.org/script/index.php)。尽管您将对图像数据进行大量操作以将图像带入 ocaml，但您始终可以为所有函数编写 c 以将图像作为抽象数据类型进行操作——这似乎与但是，您想要用 C 而不是 ocaml 编写大部分程序。

因为我最近想玩 camlimages（并且在安装它时遇到了一些麻烦——我不得不从编译错误中修改两个 ml 文件，虽然非常简单）。这是一个快速程序，`black_and_white.ml`以及如何编译它。这应该让某人轻松地开始使用该软件包（尤其是动态图像生成）：

```
 let () =
       let width  = int_of_string Sys.argv.(1)
       and length = int_of_string Sys.argv.(2)
       and name   = Sys.argv.(3)
       and black = {Color.Rgb.r = 0; g=0; b=0; }
       and white = {Color.Rgb.r = 255; g=255; b=255; } in
       let image = Rgb24.make width length black in
       for i = 0 to width-1 do
           for j = 0 to (length/2) - 1 do
               Rgb24.set image i j white;
           done;
       done;
       Png.save name [] (Images.Rgb24 image) 
```

并编译，

```
ocamlopt.opt -I /usr/local/lib/ocaml/camlimages/ ci_core.cmxa graphics.cmxa ci_graphics.cmxa ci_png.cmxa black_and_white.ml -o black_and_white 
```

并且奔跑，

```
./black_and_white 20 20 test1.png 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-04T23:49:14.887

我不知道开箱即用的方法。您可以使用 打开文件`open_in`并一次读取一个字节`input_char`，吸入标题和数据并为简单格式（例如 BMP）构建`color array array`这种方式，但对于 JPG 或 PNG 之类的任何东西，您自己的解决方案可能会比你想进入的工作更多。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-11-14T09:10:21.140

您还可以使用 OCaml 的众多 SDL 绑定之一，特别是 SDL_image 绑定，它可以让您轻松加载各种图像，并提供以数组形式访问单个像素和原始数据的函数。

[OCamlSDL](http://ocamlsdl.sourceforge.net/home.html)是一种流行的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-14T15:47:26.863

如果您不想使用 CAMLIMAGE，通常使用原始 RGB 或 PNM/PPM（具有易于创建的标题格式，后跟 RGB 值）图像。ImageMagick 允许您查看这些格式或将它们转换为更可用的格式。

# podcast - 如何处理慢性时间问题？

> ID：612892
> 
> 赞同：32
> 
> 时间：2009-03-04T23:03:28.477
> 
> 标签：podcast, time-management, deadlines

我的员工中有一个开发人员长期超过截止日期和估计。在过去一两周的几个项目中，我每天都会听到“应该在一天结束前完成”。这个开发者做得很好。

我已经和他谈过他的问题。他似乎真的很沮丧，并且对如何纠正它们感到恼火。

我的问题是：

1.  什么样的逾期处罚是有效的？
2.  我可以通过什么方式强迫该员工亲自监督他的行为（时间估计等）？

**更新**：根据回复；这就是我想出来的。

1.  惩罚是个坏主意。
2.  员工在没有干预的情况下无法解决估算问题是很自然的。
3.  不要设定最后期限，除非届时没有完成会导致公司后果（失去合同）。
4.  利用可用的方法（敏捷，Joel 的清单）来帮助开发人员更好地估计。

感谢您的链接和信息。也感谢您更新我的想法。

* * *

## 回答 #1

> 赞同：43
> 
> 时间：2009-03-04T23:07:57.390

我认为问题不在于他错过了这些最后期限。

我认为他在估计完成一项任务所需的时间方面确实存在问题。

让他开始记录他所说的任务将花费的时间以及他完成任务实际花费的时间。最终，这本期刊将成为他做出更好估计的指南。一旦他变得更好地估计，他就不应该感到匆忙或烦躁。

* * *

## 回答 #2

> 赞同：29
> 
> 时间：2009-03-04T23:11:50.627

Joel Spolsky 有一篇有趣的文章：[基于证据的调度](http://www.joelonsoftware.com/items/2007/10/26.html)

> ### 1) 分解
> 
> 当我看到以天甚至几周为单位的时间表时，我知道它不会奏效。你必须把你的日程安排成非常小的任务，这些任务可以用小时来衡量。不超过16小时。
> 
> 这迫使你真正弄清楚你要做什么。编写子程序 foo。创建此对话框。解析 Fizzbott 文件。个人开发任务很容易估算，因为您以前编写过子例程、创建对话框和解析文件。
> 
> 如果您马虎，并且选择了为期三周的大任务（例如，“实施 Ajax 照片编辑器”），那么您还没有考虑过您将要做什么。详细地。一步步。而当你还没有想过你要做什么的时候，你不知道需要多长时间。
> 
> 设置 16 小时的最大值会迫使您设计该死的功能。如果您有一个名为“Ajax 照片编辑器”的手动波浪式三周功能而没有详细设计，我很抱歉成为您破坏它的人，但您注定要失败。你从来没有想过它会采取哪些步骤，而且你肯定会忘记很多。

重点是他（和你）应该从他的错误中吸取教训，并在下一次估计时考虑到它们。

另外，如果您是开发人员，我会在一天结束时进行定期代码审查，以更好地了解他的开发过程。

当然，更小的迭代和更细化的任务。将最长任务持续时间设置为 1 天。这就是我们的规则。

* * *

## 回答 #3

> 赞同：20
> 
> 时间：2009-03-04T23:11:48.863

如果你的第一个问题是 **要考虑什么样的惩罚，** 我认为你马上就输了。如果你觉得他做得很好，你可能需要查看最后期限/估计，看看它们是否一开始就切合实际。谁设置了它们，如果有问题的开发人员没有参与，那么这可能是问题的一部分。

我同意@OTisler 的观点，即结对编程以及可能与您自己定期进行的一天结束进度审查可以帮助他完成……尽管如果从一开始就截止日期/估计不切实际，那不是您的问题所在。

对一些特定任务进行更密切的监控应该突出任何问题所在。

* * *

## 回答 #4

> 赞同：16
> 
> 时间：2009-03-04T23:06:10.950

> 什么样的逾期处罚是有效的？

没有任何。如果你激怒了他，他不会做这项工作，或者他会另找工作。你应该帮助他弄清楚为什么他的估计是错误的。史蒂夫·麦康奈尔 (steve McConnell) 有一本书是关于估算的。我会从那里开始。

> 我可以通过什么方式让该员工自己监督他的行为（时间估计等）？

通过帮助他找到正确的估算方法。

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2009-03-04T23:52:15.847

**首先，确保您的要求非常明确。**

我不想这么说，但根据我的经验，最后期限过长通常是主管要求不明确或规范薄弱的问题。首先要做的是确保问题不是源于您，也不是由您加剧。

**此外，请确保您的要求以及他的估计是现实的。**

确保您自己的期望不会促使他做出不切实际的估计以满足不切实际的要求。

请记住，您完成了需求，但开发人员总是进行估算，并且不应被“我们能不能更快地做到这一点”所左右，除非您还指定要删除的功能。

**然后，确保他准确地跟踪他的时间/任务，这样你就可以很好地了解项目的进展情况。**

此过程将显示任何缺乏适当的时间/任务跟踪，这可能最终成为改进的第一步。如果您在项目结束后看不到某个特定项目花费了多长时间，那可能就是问题的原因——估计中没有足够的定义，或者缺少在项目中期发现但从未估计过的“依赖”任务.

您必须准确地知道花了多少时间在做什么，然后才能找出蠕变在哪里，或者可以做些什么。

**然后，看看他的估计在哪里失败并找出原因。回顾一个被吹的项目的估计，把它变成一个项目本身——一个有待解决的问题。**

一旦您确定他的估计确实是问题的根源，请检查他的估计，也许还有另一个开发人员，并找出原因。

这将帮助您找出问题的原因。对问题的深刻理解可能是实际的解决方案。

**最后，如果你真的到了必须尝试惩罚或胁迫的地步，是时候解雇他并重新开始了。**

在某些情况下，惩罚和胁迫是对故意不法行为的适当回应。

但是，如果该开发人员正在积极尝试做好工作，那么您只会通过产生消极态度和挫败感来恶化情况。

如果问题无法解决，并且您确定问题出在他身上，而不是您身上，那么是时候解雇他并找一个能按时完成的开发人员了。当您的成本被夸大并且利润消失时，出色的工作并不意味着什么。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2009-03-05T00:44:12.853

好的，这是相当普遍的——开发人员很乐观。处理它是管理层的工作。如果有人应该受到惩罚，那就是经理（你？）

我很高兴你至少问了，看起来你从这个列表中得到了一些很好的答案，我希望他们能帮助你，你找到一种方法来实际实施一些工作。

当我年轻的时候，我的第一个好经理是这样处理的：

首先，他让我列出一个分项清单——将任务分解为几个小时，并用非常宽松的估计来估计每一个——不管任务有多小，时间都不应该少于 4 小时。

然后他看着他们，告诉我把我所有的估计翻一番。（开发人员，尤其是年轻的开发人员，不要考虑这样一个事实，如果你幸运的话，你一天只有大约 1/2 的工作效率——而其中的一半都花在了你没想到会做的事情上做）。

然后，在制定他的时间表之前，他将我所有的估计翻了一番（没有告诉我）。

他以这种方式转动它们，而不考虑上面的时间表要求。一个好的经理应该意识到，说需要在 2 天内完成，并不能让它成为可能。

随着我的估计越来越好，我们都注意到并相应地进行了调整。

经理的工作不仅仅是做一个项目，而是建立一个团队。这通常需要某种形式的培训。这也是不是工程师的工程经理不能接受的原因，他们对这种事情真的无能为力。

项目或时间表的失败实际上绝不是开发人员的错（除了在一些长期案例中，他无法真正修复或没有任何价值并且需要被解雇）。经理在雇用开发人员、信任他、管理他或为项目配备人员方面做出了错误的决定。

真的，有什么错呢？我想如果经理不是很擅长使项目发生，他将需要有人指点...如果他的经理有什么好，他会问为什么它会走到这一步，你做了什么来解决它， ETC。

雇用经理就是雇用某人来解决问题。使开发人员富有成效。如果他不能让他们富有成效，那么他就不是合适的人选。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2009-03-04T23:19:13.417

对于您的问题：

1.  如果你选择惩罚错过最后期限的人，你将不会得到好的结果。他们会失去动力并感到被贬低。如果你一直催促人们在最后期限前完成工作，那么工作质量就会受到影响，而且你最终会花费大量时间来修复 bug。
2.  要改进他的时间估计，您可以尝试使用 Joel Spolsky 的[基于证据的调度](http://www.joelonsoftware.com/items/2007/10/26.html)，它有一个很好的反馈循环来改进结果估计。

但我有一些问题我认为你需要考虑。

他比其他人晚吗？如果是这样，为什么——是因为他是一个过于乐观的估计者还是一个缓慢的工人？过于乐观的估计很容易解决 - 只需将他的所有数字乘以上述基于证据的调度的一个因子。如果他是一个慢工，为什么？他会分心吗？他是否非常小心地产生了非常低的缺陷代码？他是否过度设计解决方案？他没有有效地重用代码吗？

截止日期是否重要，或者它们只是基于估计的任意日期，以报告管理层的进度？如果是后者，您可以通过自己调整他的估计来解决这个问题。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2009-03-04T23:52:59.670

> 什么样的逾期处罚是有效的？

你陈述了重点并错过了它。超过最后期限的明显惩罚是死亡。如果开发人员在过了最后期限后仍然活着，那么“最后期限”显然不是真正的最后期限。你觉得用军事语言给开发者施加压力很有趣吗？

修正你的措辞。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2009-03-10T22:26:15.130

# 动机

首先：阅读[Peopleware](http://en.wikipedia.org/wiki/Peopleware:_Productive_Projects_and_Teams)

下一个。为什么你认为惩罚将是管理应该有创造力的人的有效方法？我认为你必须重新考虑管理与团队的整个方法。

在我看来，经理首先，也是最重要的角色是确保开发人员*能够*富有创造力和生产力。并不是说他们*富有成效*。那些小字有很大的不同。要发挥创造力，您需要一个安全的环境。通过不断受到最后期限和惩罚威胁的压力，你创造了与安全完全相反的东西。

此外，作为经理，您需要准确的信息作为决策的依据。这也需要一个安全的环境。如果因为诚实和直言不讳而有受到惩罚的风险，那么您肯定会得到谎言和缺乏信息。一个非常危险的决策基地。

# 估计

正如其他所指出的，估计是估计。在我们的团队中，我们根本不进行任何个人估算，我们作为一个团队进行估算。（我有点不愿意称我们所做的为 Scrum，但其中大部分都试图效仿） ,1/2,1,3,5,8,13,20,40,60,100 和在估计任务时每个开发人员选择一张卡片（卡片隐藏，直到每个人都选择一张卡片以避免影响估计）和平均选择的卡片作为估计值。

注意数字是如何逐渐变得不那么准确的。这是设计使然，因为大估计必然不太准确。

对于我们的团队，我们选择使用单位“理想工日”进行估算。早在我们任何人的记忆中，理想的一天还没有发生，但是当您知道如何将日历天转换为“理想的人日”时，这是一个很好的基础。

正如 Scrum 规定的那样，开发是在两周的冲刺中完成的，然后在生产环境中部署新版本。在每个 sprint 之后，我们将已完成任务的估计总和除以 sprint 的计划工日。然后，这个因素是估计团队在两周内可以花费多少“理想人日”的基础。

单个开发人员完成的实际工作项目不需要估算。第一个近似值始终需要 1/2 - 1 天才能完成。如果这个估计结果是错误的，你只需找一个开发人员一起做就可以完成它。或者您将工作项分解为较小的任务，以便更好地分配。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2009-03-04T23:08:16.530

按照@OTisler 的建议设置**里程碑**并尝试**敏捷。**

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2009-03-04T23:08:22.757

我认为你不应该惩罚他。只要让他了解如何做出准确的估计。

作为团队负责人，我的团队成员告诉我，在截止日期前完成 X 功能“没问题”。然后我通常会和他们坐下来讨论我认为需要完成哪些任务和子任务才能完成该功能，以及开发人员认为每个任务需要多长时间。

在我们做完这个练习，并把所有的任务和子任务估计加起来之后，它不可避免地会比开发人员在他们最初的估计中认为的要长得多。在他们开始做出更准确的估计之前，我通常只需要和他们一起做几次这个练习。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2009-03-05T00:32:02.960

令我惊讶的是，你只有其中一个人。

工程师在估计某件事需要多少时间方面很糟糕。我敢打赌，如果您仔细查看其他开发人员的估计，您会发现很多填充。有时填充不是必需的，但任务会扩展以填充可用时间。

解决这个问题的方法是改变你做估计的方式——对每个人。开发人员可能不擅长估计绝对时间，但他们在相对时间方面相当出色。所以在星期一，不要问“添加 whoosiwhatsit 需要多长时间？”而是问“在不到一周的时间内，你能在 whoosiwhatsit 上完成什么？” 这成为他们本周的任务。

下周一你看看它是怎么回事。“好吧，我在两天内安装了 floogle，但结果证明它影响了 mcphee……所以这周我需要解耦这些家伙，这样 whoosiwhatsit 文件就不会被覆盖。” 好的，这是他们本周的任务。

您可能认为这无济于事，因为您仍然不知道 whoosiwhatsit 什么时候准备好。确实如此。您在这里有两个选择：

如果你需要一个截止日期，那么你必须强迫你的错误开发者像其他人一样填充他的估计。他很快就掌握了窍门，而且他很快就会花“两周”的时间来写一些本来应该花一天时间的东西。

你的另一个选择是用虚构的估计来换取更多的可见性。从长远来看，这种方法会让你的工程师更有效率，也更快乐。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2009-03-04T23:08:12.803

所以开发人员做得很好，但在估计交付时间方面很差？我不确定你手上是否有惩罚的情况。

也许再过一段时间，让他引导您完成估算交付点的过程。这可能是一个问他为什么步骤 X、Y 和 Z 需要一定时间的机会。他可能会发现自己只是通过以几乎可以肯定是较慢的速度进行练习来修改他的估计。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2009-03-10T22:06:01.840

问问自己：你的工作是什么？

如果你只是盲目地将开发人员的估计（你知道他们不能给出好的估计）传递给管理人员，而不是自己决定这个估计是否可以实现，那么你就没有做好你的工作。

试着从“增值”的角度来思考（我的一位老雇主经常使用这个词，我讨厌它，但在这种情况下它可能对你有用）。你在增加什么价值？如果你只是在高层管理人员和开发人员之间双向传递东西，那么最终你不会赚钱。你可能会被删除，什么都不会改变。

我曾经遇到过的最好的经理是一个看过另一支球队给他的一系列要求的人，并直截了当地告诉他们，其中近三分之一是公牛，并在我还没看到名单之前就将其删除。我曾经让我编写所有这些额外的管理类型文档的最糟糕的文档，我曾经要求我做的其他经理都没有（我真的觉得我真的是在为他做他的工作），没有甚至给我项目截止日期，几乎没有上班。他们都在同一家公司，很奇怪。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2009-05-23T05:04:27.710

90 小时是一种常见的短期项目期限。简单的方法不是估计“你的时间”，而是测量另一个。计算机程序员不应该为他们的项目做时间估计，因为有证据表明计算自己的时间会导致比观察他人更大的错误。

# .net - BindingSource 和 DataGridView

> ID：612895
> 
> 赞同：0
> 
> 时间：2009-03-04T23:04:33.107
> 
> 标签：.net, ado.net, datagridview, bindingsource, tableadapter

我有两个 DataGridView 通过 BindingSources 和 TableAdapaters 绑定到底层 DataSource。

我有两个模型；字符串和表格。表 -> [id，句柄，描述] 字符串 -> [id，句柄，table_id]

所以表格和字符串之间存在多对一的关系。

选择“表”DataGridView 以过滤“字符串”DataGridView 的内容的最简单方法是什么？

我了解“字符串”DataGridView 的数据源可以设置为“表格”DataGridView 的绑定源，但这不支持多选。

目前，当“表”DataGridView 上的选择发生更改时，我正在迭代选定的行并为“字符串”DataGridView 构建一个基于字符串的过滤器，但我发现这很慢而且很混乱。

有人知道更好的方法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-04T23:23:28.117

您可能对代码有一些其他问题，导致它变慢。

关于它的混乱，我通常只是移动代码，让我可以轻松地将元素列表抓取到 DataGridView 上的扩展方法。内置/简单用于单选。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-07-13T15:03:46.787

您可以为每个表使用两个不同的 BindingSource。或者，您可以只用数据填充第一个表，而根本不使用 BindingSource。然后，您可以对 DataGridView 中的 SelectionChanged 事件做出反应，以在表 2 上的 BindingSource 上设置过滤器。

方法有很多：你自己能想出新的方法吗？

# parsing - 如何对日志文件执行计算

> ID：612906
> 
> 赞同：1
> 
> 时间：2009-03-04T23:07:20.917
> 
> 标签：parsing, shell, awk, gawk

我有一个看起来像这样的：

```
I, [2009-03-04T15:03:25.502546 #17925]  INFO -- : [8541, 931, 0, 0]
I, [2009-03-04T15:03:26.094855 #17925]  INFO -- : [8545, 6678, 0, 0]
I, [2009-03-04T15:03:26.353079 #17925]  INFO -- : [5448, 1598, 185, 0]
I, [2009-03-04T15:03:26.360148 #17925]  INFO -- : [8555, 1747, 0, 0]
I, [2009-03-04T15:03:26.367523 #17925]  INFO -- : [7630, 278, 0, 0]
I, [2009-03-04T15:03:26.375845 #17925]  INFO -- : [7640, 286, 0, 0]
I, [2009-03-04T15:03:26.562425 #17925]  INFO -- : [5721, 896, 0, 0]
I, [2009-03-04T15:03:30.951336 #17925]  INFO -- : [8551, 4752, 1587, 1]
I, [2009-03-04T15:03:30.960007 #17925]  INFO -- : [5709, 5295, 0, 0]
I, [2009-03-04T15:03:30.966612 #17925]  INFO -- : [7252, 4928, 0, 0]
I, [2009-03-04T15:03:30.974251 #17925]  INFO -- : [8561, 4883, 1, 0]
I, [2009-03-04T15:03:31.230426 #17925]  INFO -- : [8563, 3866, 250, 0]
I, [2009-03-04T15:03:31.236830 #17925]  INFO -- : [8567, 4122, 0, 0]
I, [2009-03-04T15:03:32.056901 #17925]  INFO -- : [5696, 5902, 526, 1]
I, [2009-03-04T15:03:32.086004 #17925]  INFO -- : [5805, 793, 0, 0]
I, [2009-03-04T15:03:32.110039 #17925]  INFO -- : [5786, 818, 0, 0]
I, [2009-03-04T15:03:32.131433 #17925]  INFO -- : [5777, 840, 0, 0] 
```

我想创建一个shell脚本来计算括号中的第二个和第三个字段的平均值（`840`在`0`最后一个例子中）。一个更棘手的问题：只有当最后一个不是时，是否有可能获得第三场的平均值`0`？

我知道我可以使用`Ruby`或其他语言来创建脚本，但我想用`Bash`. 有关如何创建此类脚本的资源或提示的任何好的建议都会有所帮助。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-04T23:16:29.163

使用`bash`和`awk`：

> `cat file | sed -ne 's:^.*INFO.*\[\([0-9, ]*\)\][ \r]*$:\1:p' | awk -F ' *, *' '{ sum2 += $2 ; sum3 += $3 } END { if (NR>0) printf "avg2=%.2f, avg3=%.2f\n", sum2/NR, sum3/NR }'`

示例输出（用于您的原始数据）：

> `avg2=2859.59, avg3=149.94`

当然，您不需要使用`cat`，它包含在其中是为了便于阅读并说明输入数据可以来自任何管道的事实；如果必须对现有文件进行操作，请`sed -ne '...' file | ...`直接运行。

* * *

**编辑**

如果您有权访问`gawk`（GNU awk），则可以消除以下需要`sed`：

> `cat file | gawk '{ if(match($0, /.*INFO.*\[([0-9, ]*)\][ \r]*$/, a)) { cnt++; split(a[1], b, / *, */); sum2+=b[2]; sum3+=b[3] } } END { if (cnt>0) printf "avg2=%.2f, avg3=%.2f\n", sum2/cnt, sum3/cnt }'`

同样的评论。`cat`申请。

一点解释：

*   `sed`仅打印与正则表达式匹配的行（`-n ... :p`组合）（包含 INFO 的行后跟数字、空格和行尾方括号之间的逗号的任意组合，允许尾随空格和 CR）；如果任何这样的行匹配，在打印 ( ) 之前只保留方括号 ( `\1`，对应`\(...\)`于正则表达式中的内容) 之间的内容`:p`
    *   sed 将输出如下所示的行：`8541, 931, 0, 0`
*   `awk`使用由 0 个或多个空格 ( ) 包围的逗号`-F ' *, *'`作为字段分隔符；`$1`对应于第一列（例如 8541），`$2`对应于第二列等。缺失的列计为值`0`
    *   最后，`awk`将累加器`sum2`等除以处理的记录数，`NR`
*   `gawk`一次完成所有事情；它将首先测试每一行是否匹配上一个示例中传递的相同正则表达式 to `sed`（除了不同`sed`，`awk`不需要`\`在圆括号中分隔区域或兴趣）。如果该行匹配，则圆括号之间的内容以 a[1] 结尾，然后我们使用相同的分隔符（由任意数量的空格包围的逗号）将其拆分并使用它来累加。我介绍了`cnt`而不是继续使用`NR`，因为如果不是所有行都具有这种形式，则处理的记录数`NR`可能大于相关记录的实际数量（ ），因为保证所有行都传递给`cnt``INFO ... [...comma-separated-numbers...]``sed|awk``sed``awk`是相关的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-05T00:36:05.227

在这里发布我通过 IM 粘贴给你的回复，只是因为它让我尝试 StackOverflow :)

```
# replace $2 with the column you want to avg; 
awk '{ print $2 }' | perl -ne 'END{ printf "%.2f\n", $total/$n }; chomp; $total+= $_; $n++' < log 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-05T11:41:17.127

在*Solaris*上使用*nawk*或*/usr/xpg4/bin/awk*。

 *```
awk -F'[],]' 'END { 
  print s/NR, t/ct 
  }  
{ 
  s += $(NF-3) 
  if ($(NF-1)) {
    t += $(NF-2)
    ct++
    }
  }' infile 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-05T11:49:09.993

使用 Python

```
logfile= open( "somelogfile.log", "r" )
sum2, count2= 0, 0
sum3, count3= 0, 0
for line in logfile:
    # find right-most brackets
    _, bracket, fieldtext = line.rpartition('[')
    datatext, bracket, _ = fieldtext.partition(']')
    # split fields and convert to integers
    data = map( int, datatext.split(',') )
    # compute sums and counts
    sum2 += data[1]
    count2 += 1
    if data[3] != 0:
        sum3 += data[2]
        count3 += 1
logfile.close()

print sum2, count2, float(sum2)/count2
print sum3, count3, float(sum3)/count3 
```

# php - 多个内联条件 AND OR 与 ELSEIF

> ID：612908
> 
> 赞同：0
> 
> 时间：2009-03-04T23:07:31.900
> 
> 标签：php

我认为有时我不需要使用 ELSEIF，也不需要通过内联进行多次检查来重复内容。

我以前做过。

我正在尝试这条简单的线路，但无法使其工作。

我读到：

OR 与 || 相同

AND 与 && 相同

代码（简短的方法，但不起作用）：

```
if($subdom<>'www' or $subdom<>'nosub')
{do some stuff if any of the two are meet} 
```

我也试过这个：

代码：

```
if((subdom!='www') || ($subdom!='nosub')){} 
```

什么是正确的运算符来检查两者中的任何一个？是吗|| 或者 ＆＆。我们应该使用 != 还是 <> 吗？

问题回答后发现的一些信息：

> $a && $b
> //And //如果 $a 和 $b 都为真，则为真。
> 
> $一|| $b
> //或 //如果 $a 或 $b 为 TRUE，则为 TRUE。

这些中的任何一个都可以作为比较：

**!==**（不等于相同），但不是**!=**因为这意味着“不分配”
**<>**将在没有太多欢乐的情况下完成任务。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-04T23:16:53.187

考虑到您的示例，您的表达式始终为真，请检查具有 $subdom 的不同输入值的表：

$expr = ($subdom!='www') || ($subdom!='nosub');

```
   $subdom ($subdom!='www') ($subdom!='nosub') 结果
   ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯ ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯
    万维网 | 假 | 真实 | 真实 |
    nosub | 真实 | 假 | 真实 |
    任何东西| 真实 | 真实 | 真实 |
    废话！| 真实 | 真实 | 真实 |

```

我认为您想在这里使用 AND (&&) 运算符...

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-04T23:14:36.063

你必须仔细考虑你试图表达的逻辑。

现在，您的逻辑是“如果子域不是 'www' 或子域不是 'nosub'”。如果其中任何一个为真，则代码将被执行。

让我们尝试一些测试用例：

*   **nosub**：这不是“www”，所以条件为真，执行代码
*   **random**：这不是“www”或“nosub”，所以两个条件都为真，执行代码
*   **www**：这不是“nosub”，所以条件为真，执行代码

基本上你所做的一切都是真实的。您实际上要表达的是“子域不是'www'而且它不是'nosub'”。也就是说，如果它们都不是，您想要执行代码。

正确的 if 语句是：`if ($subd != 'nosub' && $subd != 'www')`.

如果您对此有疑问，最好更改您提出放入 if 语句中的逻辑的过程。以下是如何构建它的描述。

首先，从您认为“好”的条件开始。“好”条件是“$subd 是 'www' 或 'nosub' 之一”。对此的 if 语句将是：`if ($subd == 'www' || $subd == 'nosub')`

现在，您正在尝试编写代码来处理条件不好的情况，因此您需要采用与良好条件相反的情况。取一个布尔条件的反面，你用 NOT 包围整个事物。在代码中：（`if !($subd == 'www' || $subd == 'nosub')` *注意前面的感叹号）*。

如果你想把那个否定移到里面（就像你最初试图做的那样），当你移动一个否定时，它是布尔代数的一个属性（我希望这是正确的术语，我已经很长时间没有学会这个了）变成这样的关系，您否定两个操作数，并将运算符从 AND 更改为 OR，反之亦然。因此，在这种情况下，当您将负数移到括号内时，`==`become`!=`和`||`become都`&&`得到：`if ($subd != 'www' && $subd != 'nosub)`，正如我在上面给出的那样。

**再次编辑**：我在上一段中提到的属性称为[德摩根定律](http://en.wikipedia.org/wiki/De_Morgan%27s_laws)。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-04T23:16:09.837

我想你会想要使用'and'而不是'or'。

在这两个条件下使用“或”总是会导致结果为真，因为字符串永远不会是值之一。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-04T23:12:19.517

这些运算符具有相同的语义，但[优先级](http://docs.php.net/manual/en/language.operators.precedence.php)不同：

```
false &&  true or true    // = (false && true) or true  => true
false and true || true    // = false and (true || true) => false 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-04T23:16:00.630

if 是错误的，因为所有字符串都将通过检查。所有字符串都不是“www”或不是“nosub”。正是由于这个原因，使用 == 通常比使用 != 更好。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-05T00:22:48.707

我猜你是从你自己的子域传递过来的，比如成员，所以你需要以下

```
if(($dom == 'www') || ($dom == 'nosub'))
{
    echo 'go away';
} 
```

# wpf - 当复选框值更改时更改 WPF ComboBox 上的数据绑定

> ID：612909
> 
> 赞同：2
> 
> 时间：2009-03-04T23:07:34.520
> 
> 标签：wpf, data-binding

我有一个 WPF 组合框，它数据绑定到一个集合，但根据是否选中复选框，我想改变组合框绑定到哪个集合。

基本问题是我有大量的 MyCustomer 集合，我也有一个过滤的 MyCustomer 集合 - 过滤非常密集，我不想用 CollectionView 来做，因为它已经完成，过滤集合已经存在 - 因此需要简单地切换组合的数据绑定。

我希望有一个纯 XAML 解决方案，显然在后面编写一些代码将是一个相对简单的解决方案，但感觉不应该是必需的。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-05T21:25:01.623

这是一个使用 DataTrigger 切换集合的示例：

```
<StackPanel xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
            xmlns:sys="clr-namespace:System;assembly=mscorlib"
            xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">
    <StackPanel.Resources>
        <x:Array x:Key="notes" Type="{x:Type sys:String}">
            <sys:String>do</sys:String>
            <sys:String>re</sys:String>
            <sys:String>mi</sys:String>
        </x:Array>
        <x:Array x:Key="letters" Type="{x:Type sys:Char}">
            <sys:Char>a</sys:Char>
            <sys:Char>b</sys:Char>
            <sys:Char>c</sys:Char>
        </x:Array>
    </StackPanel.Resources>

    <CheckBox x:Name="chkLetters" Content="Use Letters"/>
    <ListBox>
        <ListBox.Style>
            <Style TargetType="{x:Type ListBox}">
                <Setter Property="ItemsSource" Value="{StaticResource notes}"/>
                <Style.Triggers>
                    <DataTrigger Binding="{Binding IsChecked, ElementName=chkLetters}" Value="True">
                        <Setter Property="ItemsSource" Value="{StaticResource letters}"/>
                    </DataTrigger>
                 </Style.Triggers>
            </Style>
        </ListBox.Style>
    </ListBox>
</StackPanel> 
```

对你来说，这些不会是不同的数组，但可能是带有过滤器或其他东西的不同 CollectionViewSources，但原理是相同的。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-05T00:04:32.183

我知道的最好方法是使用一些在内部“获取”正确集合的 shell 集合。

所以你有你的 UnfilteredCollection 和你的 FilteredCollection，然后是一个名为 BindingCollection 的属性，它在它的“getter”中评估一些状态（复选框将绑定到这个状态）以确定要检索的集合。

如果您将 MVVM 用于 UI 和集合之间的数据绑定，一种方法是这样的：

```
<!-- Your ComboBox binds to some shell collection -->
<ComboBox ItemsSource="{Binding BindingCollection}" />
<!-- The input to this item will determine which collection is internally exposed -->
<CheckBox IsChecked="{Binding UseFilteredSet}" /> 
```

然后让你的 ViewModel（中间层）文件做这样的事情（我不包括 INotifyPropertyChanged 的​​实现细节，但如果你愿意，我可以）：

```
private ObservableCollection<MyCustomer> UnfilteredCollection
{
    get { return _unfilteredCollection; }
}

private ObservableCollection<MyCustomer> FilteredCollection
{
    get { return _filteredCollection; }
}

// The public collection to which your ComboBox is bound
public ObservableCollection<MyCustomer> BindingCollection
{
    get 
    { 
        return UseFilteredSet ? 
            FilteredCollection : 
            UnfilteredCollection; 
    }
}

// CheckBox is bound to this state value, which tells the bindings on the shell 
// collection to refresh when the value of this state changes.
public bool UseFilteredSet
{
    get { return _useFilteredSet; }
    set 
    { 
        _useFilteredSet = value;
        OnPropertyChanged("UseFilteredSet");
        OnPropertyChanged("BindingCollection");
    }
} 
```

# svn - 你如何让颠覆作用于不在变更列表中的文件？

> ID：612917
> 
> 赞同：4
> 
> 时间：2009-03-04T23:08:44.737
> 
> 标签：svn

Subversion 的变更列表功能允许您在某些文件上添加标签。例如，我有一个名为“不提交”的更改列表。我如何提交除此更改列表或任何其他更改列表中的文件之外的所有内容，即不属于更改列表的已修改文件？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-05T22:37:22.167

I know that both [TortoiseSVN](http://tortoisesvn.net/) and [AnkhSVN](http://ankhsvn.net/) use what's called an ignore-on-commit changelist. This doesn't affect the command line client, and both are Windows (and Visual Studio) tools. I don't know of a program with such a change list on other platforms.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-04T23:39:36.347

这是一种迂回的做法，但您可以编写一个脚本，将“不提交”更改列表中尚未包含的所有文件标记到另一个更改列表中。然后，提交该新更改列表上的所有更改。

# .net - 你知道任何适用于 Windows 的 OpenSSH 库吗？

> ID：612930
> 
> 赞同：6
> 
> 时间：2009-03-04T23:14:38.187
> 
> 标签：.net, windows, openssh

我想将 OpenSSH 支持合并到 Windows 应用程序中，并且我正在寻找可以提供此功能的库（最好是 .Net 或易于集成到 .Net 中的东西）。我对 ssh 客户端软件比服务器软件更感兴趣，但是这两个功能会更好。

**编辑**：我更喜欢免费和开源的解决方案。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-04T23:18:11.640

查看[WeOnlyDo](http://www.weonlydo.net/)。他们有一些不错的 .NET SSH 组件，比如199 美元的[wodSSH.Net](http://www.weonlydo.com/index.asp?showform=SSH.NET)。

此外，[nSoftware](http://www.nsoftware.com/)有一些很棒的网络组件，例如[IP*Works SSH .Net 版本](http://www.nsoftware.com/order/ssh.aspx)，售价 599 美元。

如果您选择 nSoftware，他们最大的价值就是[订阅红地毯](http://www.nsoftware.com/subscriptions/default.aspx)。这就是我们所拥有的。每位开发人员的起价为 1499 美元。

（截至 2009 年 3 月 4 日的价格）

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-04T23:18:30.703

CodeProject 为[SharpSsh提供了一个很好的](http://www.codeproject.com/KB/IP/sharpssh.aspx)**免费**选项

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-04T23:56:07.353

还有适用于 .NET 的[SSH Factory 和适用于 .NET](http://www.jscape.com/sshfactorydotnet/)的[Granados](http://granados.sourceforge.net/)，价格为 599 美元。

（截至 2009 年 3 月 5 日的价格）

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-05T02:25:38.367

我假设按照您提出问题的方式，这表明您主要对 SSH/SSH2 功能感兴趣...

这听起来如何：

[Paramiko](http://www.lag.net/paramiko/ "帕拉米科") - 一个实现 SSH2 协议的 python 模块

需要[`pycrypto`](http://www.dlitz.net/software/pycrypto/)——

*   `pycrypto`Windows 二进制文件可以在[这里找到](http://www.voidspace.org.uk/python/modules.shtml#pycrypto)
*   `pycrypto`明显可用的[IronPython](http://www.codeplex.com/Wiki/View.aspx?ProjectName=IronPython)实现在[`FePy`](http://fepy.sourceforge.net/). 看[这里](http://lists.ironpython.com/pipermail/users-ironpython.com/2008-July/007565.html)和[这里](http://fepy.svn.sourceforge.net/viewvc/fepy/trunk/fepy/cipher.py?view=log)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-02-23T16:07:17.340

您可以尝试我们的[Rebex SSH 包](http://www.rebex.net/ssh-pack/)，其中包括：

*   与 OpenSSH 兼容的 SSH 核心客户端库
*   带有终端仿真器组件的 SSH Shell
*   SFTP（SSH 文件传输协议）客户端组件
*   SCP 客户端组件

[您可以在http://www.rebex.net/ssh-pack/download.aspx](http://www.rebex.net/ssh-pack/download.aspx)下载试用版

# sql-server - 如何确定要添加到参数的变量的 SQLDBType？

> ID：612950
> 
> 赞同：1
> 
> 时间：2009-03-04T23:20:39.917
> 
> 标签：sql-server, sqlparameter, sqldbtype

如何根据要存储在数据库中的输入变量确定将哪个 SQLDBType 分配给参数？是否有用于测试的 GetType 等效项？

```
If IsNumeric(ParameterValue) Then
    Parameter.SqlDbType = SqlDbType.Float
ElseIf IsDate(ParameterValue) Then
    Parameter.SqlDbType = SqlDbType.DateTime
ElseIf IsArray(ParameterValue) Then
    Parameter.SqlDbType = SqlDbType.VarBinary
Else
    Parameter.SqlDbType = SqlDbType.VarChar
End If 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-20T10:35:55.820

有太多 SqlDbTypes（跨越太多版本）以您想要的方式安全地执行它，特别是如果您需要使用更精确的数据类型（例如十进制而不是浮点数，甚至是 bigint）。

我会考虑使用 SMO 在 .NET 数据类型和 SqlDbTypes 之间创建一个简单的映射系统。然后，您只需将参数映射到存储数据所需的数据库类型。

好消息是，如果您现在开始这项工作，您可以重用该库，或者创建一个接口并为每个 SQL 版本扩展它。

* * *

试试这个（C# 代码）：

```
// Get the DataType from the DataRow in your result set
public void GetDataType(DataRow dr)
{
    DataType dt = new DataType((SqlDataType)Enum.Parse(typeof(SqlDataType), dr["DataTypeName"].ToString(), true))
    {
        MaximumLength = Convert.ToInt32(dr["ColumnSize"]),
        NumericPrecision = Convert.ToInt32(dr["NumericPrecision"])
    };
    // TODO: Map DataType to .NET datatype
} 
```

# asp.net-mvc - 你可以并排使用 ASP.NET MVC Futures 库和 MVC 源代码吗？

> ID：612951
> 
> 赞同：2
> 
> 时间：2009-03-04T23:20:47.623
> 
> 标签：asp.net-mvc

我正在尝试使用 ASP.NET MVC Futures 库中的 Html.RenderAction<> 方法。但是，只有当我的项目引用 GAC 中的 System.Web.Mvc 程序集时，我才能完成这项工作。如果我将 System.Web.Mvc 源代码作为项目包含在我的解决方案中，那么 Microsoft.Web.Mvc 的所有内容都会崩溃。其他人有这种经验吗？想法？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-05T08:36:19.740

要使用 MVC 源代码，需要编辑两个 web.config 文件： - /web.config - /views/web.config

您必须从这些行中删除 PublicKey 属性（根据记忆，下面的示例可能不是 100% 准确，但您明白了 :)）：

```
<add assembly="System.Web.Mvc, Version=x.y.z.a, Culture=neutral, PublicKeyToken=0123456789101112"/> 
```

或者

```
<add tagPrefix="asp" namespace="System.Web.Mvc" assembly="System.Web.Mvc, Version=x.y.z.a, Culture=neutral, PublicKeyToken=0123456789101112"/> 
```

所以它变成了

```
<add assembly="System.Web.Mvc, Version=x.y.z.a, Culture=neutral, PublicKeyToken=null"/> 
```

或者

```
<add tagPrefix="asp" namespace="System.Web.Mvc" assembly="System.Web.Mvc, Version=x.y.z.a, Culture=neutral, PublicKeyToken=null"/> 
```

# svn - 确定本地文件夹使用的源代码控制系统（Subversion 或 TFS）

> ID：612956
> 
> 赞同：2
> 
> 时间：2009-03-04T23:22:14.767
> 
> 标签：svn, version-control, tfs, powershell

摘要：如何确定本地文件夹的 TFS 源代码控制配置。

解释：

在我们的软件工厂中，我根据源代码控制系统代码所在的本地文件夹自动创建 CruiseControl.NET 配置文件。我目前只想支持 Subversion 和 TFS。使用 svn.exe info 命令可以轻松确定 Subversion 用作源代码控制系统，并确定存储库的位置，如下面的 PowerShell 代码所示。但是当使用 TFS 时我该怎么做呢？

“问题”之一是当前登录的用户无权访问 TFS 服务器。我们不能使用集成安全性，因为开发机器没有加入域。

我得到的最接近的是 tf dir ，我必须在弹出框中输入凭据。找不到用于指定用户和密码的命令行参数。tf 属性看起来也很有希望，但是您必须经过身份验证才能执行调用。Subversion 无需身份验证即可提供信息。

我在 PowerShell 中的当前代码以及 SubVersion 的工作代码，缺少 TFS 代码；-) 请注意，对于 CruiseCONtrol.NET 块的实际创建，我们在全局变量中配置了源代码控制用户名和密码。

```
#
#   
#       
# https://svn.mycompany.nl/svn/Acme.Intranet
#       
#   
#
# 如果在源代码控制下返回 CruiseControl.NET 源代码控制配置块
# 以下格式：
#   
# https://svn.mycompany.nl/svn/Acme.Intranet
# c:\project\Acme.Intranet.Build\WorkingDirectory\$configuration
# 极致构建
# 最高密码
#           
#.参数配置
# “调试”或“发布”
# .返回
# 带有配置块的字符串，如果不在 Subversion 源代码控制下，则为 $null。
##>
函数 GetSubversionSourceControlBlock
{
    参数
    (
        $配置
    )

    $svn_exe = Join-Path -Path $productfolder -ChildPath "tools\DotNet2\svn-win32-1.5.2\svn.exe"
    $svnProductInfo = [xml](& $svn_exe 信息`"$productFolder`" --xml)
    $trunkUrl = $svnProductInfo.info.entry.url
    if ($trunkUrl -ne $null)
    {
@"

            $trunkUrl
            $buildfolder\WorkingDirectory\$configuration
            $MastConfigurationGlobal_SourceControlUserName
            $MastConfigurationGlobal_SourceControlPassword

“@
        详细“在 Subversion 源代码控制下。Trunk Url：$trunkUrl”
    }
    别的
    {
        详细“不在 Subversion 源代码控制下”
        $null
    }
}   

#
# tfs.mycompany.nl
# $/Acme.Intranet
# c:\project\Acme.Intranet.Build\WorkingDirectory\$configuration
# 极致构建
# 最高密码
#           
#.参数配置
# “调试”或“发布”
# .返回
# 带有配置块的字符串，如果不在 Tfs 源代码控制下，则为 $null。
##>
函数 GetTfsSourceControlBlock
{
    参数
    (
        $配置
    )

    $null
}   

```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-06T12:31:17.297

故事还在继续：

如果您从 cmd 提示符执行 tf 命令，则一切都如上一个答案中所述。如果您从 PowerShell 命令提示符执行此操作，您将获得以下信息：

```
PS C:\> & tf.exe 工作文件夹 c:\projects\Macaw.SolutionsFactory\FactoryIdeTools\trunk /login:macaw\serge,Trasimeno5
TF10125: 路径 'c:\projects\Macaw.SolutionsFactory\FactoryIdeTools\trunk' 必须以 $/ 开头

```

它给出了一个错误！

我已经尝试了一切，但无济于事。我什至通过 TFS 对象模型进行了尝试，但这变得非常复杂。要获取本地文件夹的工作区，您首先需要一个 tfs 服务器的名称。可能迭代所有当前映射的工作区并迭代在那里定义的服务器（这可能是 tf.exe 所做的）以测试本地文件夹是否属于该工作区。

我终于想出了以下解决方案：

我使用以下代码创建了一个简单的批处理文件 ExecTfWorkprodCommand.bat：

```
@echo 关闭
rem 这是一种奇怪的批处理文件，需要它是因为在 PowerShell 中执行此命令会出错。
rem 此脚本使用以下命令检索有关本地文件夹的 TFS 源控制信息：
rem tf 工作文件夹 /login:domain\user,password
rem %1 是 tf.exe 可执行文件的路径
rem %2 是本地路径
rem %3 是域\用户 [可选，如果省略，则使用集成安全性]
rem %4 是密码 [可选，如果未指定 %3]
rem 输出格式为：
rem =================================================== ===============================
rem 工作区：Macaw.SolutionsFactory@VS-D-SVDOMOSS-1 (Serge)
远程服务器：tfs.macaw.nl
远程 $/Macaw.SolutionsFactory/FactoryIdeTools/trunk: C:\Projects\Macaw.SolutionsFactory\FactoryIdeTools\trunk

如果 [%3]==[] 转到集成安全
%1 工作组 "%2" /登录:%3,%4
转到结束

：综合安全
%1 工作组“%2”

：结尾

```

我从 PowerShell 调用这个批处理脚本。从我要解析的结果来看：

*   Tfs 服务器名称
*   服务器上的文件夹

有关如何解决此问题的示例代码：

```
$tfsProductInfo = & "ExecTfWorkprodCommand.bat "C:\Program Files\Microsoft Visual Studio 9.0\Common7\IDE\TF.exe" "c:\projects\Macaw.SolutionsFactory\FactoryIdeTools\trunk" 域\用户密码
if ($tfsProductInfo -eq $null)
{
    写入输出“无法确定本地文件夹上的 Tfs 源代码控制信息”
}
别的
{
    $tfsserver = [Regex]::Split($tfsProductInfo[2], ":")[1].Trim()
    $serverpath = [Regex]::Split($tfsProductInfo[3], ": ")[0].Trim()
    $localpath = [Regex]::Split($tfsProductInfo[3], ": ")[1].Trim()
    写输出“服务器：$tfsserver”
    写输出“服务器路径：$serverpath”
    写输出“本地路径：$localpath”
}

```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-05T11:18:51.690

好的，我自己找到了答案。首先：有一个 wat 来指定 tf.exe 命令行工具的凭据。使用 /login:domain\user,password。

现在如果我执行：

```
tf 工作文件夹 c:\projects\Macaw.SolutionsFactory\FactoryIdeTools\trunk /login:domain\user,password

```

我得到以下结果：

```
==================================================== ==================================================== ========================================
工作区：Macaw.SolutionsFactory@VS-D-SVDOMOSS-1 (Serge)
服务器：tfs.mycompany.nl
 $/Macaw.SolutionsFactory/FactoryIdeTools/trunk: C:\Projects\Macaw.SolutionsFactory\FactoryIdeTools\trunk

```

这就是我需要的所有信息！

# c# - 为什么我不能将委托放在接口中？

> ID：612957
> 
> 赞同：30
> 
> 时间：2009-03-04T23:22:15.407
> 
> 标签：c#, .net, syntax, delegates, interface

为什么我不能向我的界面添加委托？

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2009-03-04T23:27:54.207

您可以使用以下任何一种：

```
public delegate double CustomerDelegate(int test);
public interface ITest
{
    EventHandler<EventArgs> MyHandler{get;set;}
    CustomerDelegate HandlerWithCustomDelegate { get; set; }
    event EventHandler<EventArgs> MyEvent;
} 
```

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2009-03-04T23:26:47.517

代表只是另一种类型，因此将其放在界面中不会获得任何收益。

您不需要创建自己的代表。大多数时候，您应该只使用 EventHandler、Func、Predicate 或 Action。

请问你的代表长什么样？

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2009-03-05T00:27:50.130

这是一个委托类型声明......

```
public delegate returntype MyDelegateType (params) 
```

this 不能在接口中声明，因为它是类型声明

但是使用上面的类型声明，您可以使用委托实例

```
MyDelegateType MyDelegateInstance ( get; set;) 
```

所以委托实例可以，但委托类型声明不是（在接口中）

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-03-04T23:23:20.020

[Delegate](http://msdn.microsoft.com/en-us/library/ms173171(VS.80).aspx)是一种不能在接口中声明的[类型。](http://msdn.microsoft.com/en-us/library/ms173104.aspx)您可能想要使用事件（如果适用）或在接口之外但在同一命名空间中声明委托。

此链接可能会有所帮助[-何时使用委托而不是接口](http://msdn.microsoft.com/en-us/library/ms173171(VS.80).aspx)

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-03-04T23:44:32.043

文档清楚地表明您可以在接口中定义委托：

> 接口仅包含方法、委托或事件的签名。

[MSDN：接口（C# 参考）](http://msdn.microsoft.com/en-us/library/87d83y5b(VS.80).aspx)

但是，在同一页的注释中，它说接口可以包含方法、属性、索引器和事件的签名。

如果您尝试将委托放在接口中，编译器会说“接口不能声明类型”。

Ecma-334 标准（8.9 接口）同意该页面和编译器上的注释。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2012-11-21T14:51:54.233

接口方法可以接受委托作为参数，没有问题。（也许我没有看到问题？）但如果打算在接口中指定出站调用，请使用事件。

有很多小细节，只显示一些代码而不是试图用散文来描述它要容易得多。（对不起，即使是代码示例也有点臃肿......）

```
namespace DelegatesAndEvents
{
    public class MyEventArgs : EventArgs
    {
        public string Message { get; set; }
        public MyEventArgs(string message) { Message = message; }
    }

    delegate void TwoWayCallback(string message);
    delegate void TwoWayEventHandler(object sender, MyEventArgs eventArgs);

    interface ITwoWay
    {
        void CallThis(TwoWayCallback callback);

        void Trigger(string message);
        event TwoWayEventHandler TwoWayEvent;
    }

    class Talkative : ITwoWay
    {
        public void CallThis(TwoWayCallback callback)
        {
            callback("Delegate invoked.");
        }

        public void Trigger(string message)
        {
            TwoWayEvent.Invoke(this, new MyEventArgs(message));
        }

        public event TwoWayEventHandler TwoWayEvent;
    }

    class Program
    {
        public static void MyCallback(string message)
        {
            Console.WriteLine(message);
        }

        public static void OnMyEvent(object sender, MyEventArgs eventArgs)
        {
            Console.WriteLine(eventArgs.Message);
        }

        static void Main(string[] args)
        {
            Talkative talkative = new Talkative();

            talkative.CallThis(MyCallback);

            talkative.TwoWayEvent += new TwoWayEventHandler(OnMyEvent);
            talkative.Trigger("Event fired with this message.");

            Console.ReadKey();
        }
    }
} 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2012-04-27T19:37:33.730

正如其他人所提到的，您只能在接口*之外定义委托。*

使用委托几乎没有错。我个人认为这`Func<int, double>`比使用代表更可取：

1.  您不能命名参数，因此参数含义可能不明确
2.  事件不是线程安全的已经是老消息了，因此下面的代码并不理想：

    ```
    if (MyFuncEvent != null)
    {
        MyFuncEvent(42, 42.42);
    } 
    ```

    见： http: [//kristofverbiest.blogspot.com/2006/08/better-way-to-raise-events.html](http://kristofverbiest.blogspot.com/2006/08/better-way-to-raise-events.html)

    更安全的代码是：

    ```
    MyFuncEventHandler handler = MyFuncEvent;
    if (handler != null)
    {
        handler(42, 42.42);
    } 
    ```

3.  如果要将事件的签名保存到变量中，则必须复制事件的签名（或者您可以使用`var`，我不喜欢）。如果您有很多争论，那么这可能会变得非常乏味（同样，您可能总是很懒惰并使用`var`）。

    ```
    Func<int, double, string, object, short, string, object> handler = MyFuncEvent;
    if (handler != null)
    {
        handler(42, 42.42, ...);
    } 
    ```

委托使您不必在每次要将其分配给变量类型时复制方法/事件的签名。

# c# - C#：英语语法规则引擎？

> ID：612962
> 
> 赞同：12
> 
> 时间：2009-03-04T23:24:32.747
> 
> 标签：c#, rule-engine

我正在寻找可能存在或不存在的东西。Windows 平台上是否有“英语语法规则引擎”之类的东西（特别适用于 .NET 或 C# 之类的东西）？

具体来说，**我正在寻找能够以“将来时”取一个句子并将其更改为“过去时”（基于英语语法规则）的**东西......比如：

*开发小部件软件，然后与里卡多会面*

对此：

*从事小部件软件工作，然后与里卡多会面*

**是否已经有一个规则引擎可以做到这一点？**

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-03-04T23:30:27.210

[和这个人](http://web.mit.edu/linguistics/people/faculty/chomsky/index.html)谈谈，他可能对你有一些想法。一般来说，英语对于这类事情来说太模棱两可了。例如：

> 把纸剪成两半。

这是命令式命令，还是过去时的句子片段？还有我个人最喜欢的：

> 时光如箭，飞逝；果蝇像香蕉一样。

任何人都可以解析它，但这仅仅是因为大量的语义知识。

话虽如此，有些事情可能值得研究，例如[SharpNLP](http://www.codeplex.com/sharpnlp)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-05T00:02:09.023

正如其他人所说，这是一个非常困难的问题，在一般情况下尚未解决。但是，有些系统做得很好。普林斯顿的[WordNet](http://wordnet.princeton.edu/)就是其中之一。它可以在一定程度上准确识别词性、同义词等（可能包括时态）。我认为您可能对[这些功能](http://wordnet.princeton.edu/wordnet/man/morph.3WN.html)感兴趣，它们似乎可以在给定特定变位的情况下找到单词的词根，并且还可以在给定词根的情况下找到特定的变位（但该页面未提供示例，因此我可以）不确定我是否正确解释了文档）。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-04T23:33:11.697

简短的回答是否定的，一般的 NLP 解析引擎不存在。

长答案是“有点”，但 50 年的研究表明，*在一般情况下*，这是一个非常困难的问题。可能有一个人在做特定的时态转换。无论如何，C# 可能不会有一个。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-05T00:40:38.213

看看[这个](http://grammatica.percederberg.net/)，它叫做 Grammatica。它可能不是您所追求的，但它绝对是在 C# 中解析英语语法规则的良好开端。

# iphone - 有没有办法在运行泄漏时调试（iPhone）？

> ID：612964
> 
> 赞同：1
> 
> 时间：2009-03-04T23:25:16.303
> 
> 标签：iphone, xcode, debugging, memory-leaks

我正在使用 Leaks 在 iPhone 上运行调试版本。我想在某些点打破，看看是否已经发生了特定的泄漏。这将使我能够通过消除过程缩小发生泄漏的范围。但是，当 Leaks 运行时，调试器会被忽略。有什么建议么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-07-13T19:32:44.680

像往常一样在调试模式下运行，然后单独运行泄漏。您可以使用应用程序窗口顶部的默认目标下拉列表将泄漏附加到正在运行的应用程序。只需选择与您的 iPhone 应用程序同名的进程（即屏幕截图中的 PushAndPop）。

[泄漏截图 http://www.17feet.com/external/screen_leaks.png](http://www.17feet.com/external/screen_leaks.png)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-05T13:17:08.287

如果您首先在调试模式下启动它（cmd-Y），您可以打开 Instruments 并选择 Leaks 模板并附加到您正在运行的 iPhone 应用程序进程。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-17T13:05:29.490

一种快速的方法：打开 Terminal.app，运行“ps axwww | grep Simulator/User/Applications | grep -v grep”（不带引号），第一个数字是 PID（正在运行的应用程序的进程 ID）和然后运行“leaks PID”（不带引号并用上一个命令得到的第一个数字替换 PID）

# hibernate - Ant：使用时如何修复 WrappedRuntimeException 任务？

> ID：612965
> 
> 赞同：0
> 
> 时间：2009-03-04T23:25:53.370
> 
> 标签：hibernate, xslt, ant, build

我尝试使用 Ant 中的任务来使用 XSLT`xslt`修改 Hibernate 映射文件 ( )。`*.hbm.xml`但是我不断得到一个`com.sun.org.apache.xml.internal.utils.WrappedRuntimeException`.

如果我取出`!DOCTYPE`源 xml 文件中的声明，则以下目标运行没有任何错误。有人可以告诉我我做错了什么吗？谢谢！

这是我的 Ant 目标：

```
<target name="generatePermHbmXml">
  <xslt in="${base.configuration.hibernate.dir}\Test.hbm.xml" 
        out="${base.configuration.hibernate.dir}\TestPerm.hbm.xml"
        style="${base.configuration.hibernate.dir}\perm.xsl">
    <xmlcatalog>
      <dtd publicId="-//Hibernate/Hibernate Mapping DTD//EN"
           location="http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd"/>
    </xmlcatalog>
  </xslt>       
</target> 
```

这是我的日志输出：

```
[xslt] : Error! hibernate.sourceforge.net
[xslt] : Error! com.sun.org.apache.xml.internal.utils.WrappedRuntimeException: hibernate.sourceforge.net 
```

[编辑] 这是我删除以使其正常工作的 DOCTYPE

```
<!DOCTYPE hibernate-mapping
PUBLIC
"-//Hibernate/Hibernate Mapping DTD//EN"
"http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd"> 
```

[Edit2]：我找到了解决方法，但我不知道这是否是“正确”的方式。我下载了 DTD 文件并将其放在我的项目目录中。我引用了文件（如下所示）而不是 URL，它现在似乎可以工作了。

```
<xmlcatalog>
  <dtd publicId="-//Hibernate/Hibernate Mapping DTD//EN"
       location="${base.configuration.hibernate.dir}/hibernate-mapping-3.0.dtd"/>
</xmlcatalog> 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-05T00:55:03.607

啊，我想我知道问题所在。在您的`xslt`任务中，您指定了一个`xmlcatalog`：

```
<xmlcatalog>
  <dtd publicId="-//Hibernate/Hibernate Mapping DTD//EN"
       location="http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd"/>
</xmlcatalog> 
```

`xmlcatalog`用于帮助`xslt`任务查找 XML 解析和验证所需的 DTD 和其他项目。如果你访问你指定的 URL，`location`你会得到一个 DTD。（哪个 Firefox 显示一个空页面，但查看“页面源”您会看到 DTD 内容。）由于 DTD 实际上存在于该 URL 中，我不知道为什么构建在读取该 DTD 时出现问题——也许编码有差异，或者网站没有正确响应。如果您使用该`-verbose`选项运行 ANT，如果您真的想调试它，您会看到更多围绕故障的堆栈转储。`Exception`你会看到被包裹在你看到的东西中的原件`Exception`。

Anyway, if you download the DTD in question and then point your `location` in the `dtd` element at the local file, as you did:

```
<xmlcatalog>
  <dtd publicId="-//Hibernate/Hibernate Mapping DTD//EN"
       location="${base.configuration.hibernate.dir}/hibernate-mapping-3.0.dtd"/>
</xmlcatalog> 
```

then the parser can find the DTD it needs, guaranteed, and it works fine.

So yes, your solution is the correct solution. This way, your builds don't depend on an external website being accessible and having a file available.

# wpf - WPF MVVM 应用程序中的键盘事件？

> ID：612966
> 
> 赞同：57
> 
> 时间：2009-03-04T23:25:59.187
> 
> 标签：wpf, mvvm

如何在不使用代码隐藏的情况下处理 Keyboard.KeyDown 事件？我们正在尝试使用 MVVM 模式并避免在代码隐藏文件中编写事件处理程序。

* * *

## 回答 #1

> 赞同：248
> 
> 时间：2011-08-17T00:54:24.963

为了带来更新的答案，.net 4.0 框架允许您通过将 KeyBinding 命令绑定到视图模型中的命令来很好地做到这一点。

所以......如果你想听 Enter 键，你会做这样的事情：

```
<TextBox AcceptsReturn="False">
    <TextBox.InputBindings>
        <KeyBinding 
            Key="Enter" 
            Command="{Binding SearchCommand}" 
            CommandParameter="{Binding Path=Text, RelativeSource={RelativeSource AncestorType={x:Type TextBox}}}" />
    </TextBox.InputBindings>
</TextBox> 
```

* * *

## 回答 #2

> 赞同：30
> 
> 时间：2009-09-18T11:36:24.510

哇 - 好像有一千个答案，在这里我要添加另一个..

以“为什么我没有意识到这个额头拍”的方式，真正明显的事情是代码隐藏和`ViewModel`坐在同一个房间里可以这么说，所以没有理由为什么他们不被允许进行对话。

如果您考虑一下，XAML 已经与 ViewModel 的 API 紧密耦合，因此您不妨从后面的代码中对其进行依赖。

遵守或忽略的其他明显规则仍然适用（接口、空检查 <-- 特别是如果您使用 Blend...）

我总是在代码隐藏中创建一个属性，如下所示：

```
private ViewModelClass ViewModel { get { return DataContext as ViewModelClass; } } 
```

这是客户端代码。空检查是为了帮助控制托管，就像在混合中一样。

```
void someEventHandler(object sender, KeyDownEventArgs e)
{
    if (ViewModel == null) return;
    /* ... */
    ViewModel.HandleKeyDown(e);
} 
```

像你想要的那样在后面的代码中处理你的事件（UI 事件是以 UI 为中心的，所以没关系），然后在 ViewModelClass 上有一个可以响应该事件的方法。这些担忧仍然是分开的。

```
ViewModelClass
{
    public void HandleKeyDown(KeyEventArgs e) { /* ... */ }
} 
```

所有这些其他附加属性和巫毒都非常酷，这些技术对其他一些事情真的很有用，但在这里你可能会得到一些更简单的东西......

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-03-10T09:36:51.393

我通过使用具有 3 个依赖属性的附加行为来做到这一点；一个是要执行的命令，一个是要传递给命令的参数，另一个是导致命令执行的键。这是代码：

```
public static class CreateKeyDownCommandBinding
{
    /// <summary>
    /// Command to execute.
    /// </summary>
    public static readonly DependencyProperty CommandProperty =
        DependencyProperty.RegisterAttached("Command",
        typeof(CommandModelBase),
        typeof(CreateKeyDownCommandBinding),
        new PropertyMetadata(new PropertyChangedCallback(OnCommandInvalidated)));

    /// <summary>
    /// Parameter to be passed to the command.
    /// </summary>
    public static readonly DependencyProperty ParameterProperty =
        DependencyProperty.RegisterAttached("Parameter",
        typeof(object),
        typeof(CreateKeyDownCommandBinding),
        new PropertyMetadata(new PropertyChangedCallback(OnParameterInvalidated)));

    /// <summary>
    /// The key to be used as a trigger to execute the command.
    /// </summary>
    public static readonly DependencyProperty KeyProperty =
        DependencyProperty.RegisterAttached("Key",
        typeof(Key),
        typeof(CreateKeyDownCommandBinding));

    /// <summary>
    /// Get the command to execute.
    /// </summary>
    /// <param name="sender"></param>
    /// <returns></returns>
    public static CommandModelBase GetCommand(DependencyObject sender)
    {
        return (CommandModelBase)sender.GetValue(CommandProperty);
    }

    /// <summary>
    /// Set the command to execute.
    /// </summary>
    /// <param name="sender"></param>
    /// <param name="command"></param>
    public static void SetCommand(DependencyObject sender, CommandModelBase command)
    {
        sender.SetValue(CommandProperty, command);
    }

    /// <summary>
    /// Get the parameter to pass to the command.
    /// </summary>
    /// <param name="sender"></param>
    /// <returns></returns>
    public static object GetParameter(DependencyObject sender)
    {
        return sender.GetValue(ParameterProperty);
    }

    /// <summary>
    /// Set the parameter to pass to the command.
    /// </summary>
    /// <param name="sender"></param>
    /// <param name="parameter"></param>
    public static void SetParameter(DependencyObject sender, object parameter)
    {
        sender.SetValue(ParameterProperty, parameter);
    }

    /// <summary>
    /// Get the key to trigger the command.
    /// </summary>
    /// <param name="sender"></param>
    /// <returns></returns>
    public static Key GetKey(DependencyObject sender)
    {
        return (Key)sender.GetValue(KeyProperty);
    }

    /// <summary>
    /// Set the key which triggers the command.
    /// </summary>
    /// <param name="sender"></param>
    /// <param name="key"></param>
    public static void SetKey(DependencyObject sender, Key key)
    {
        sender.SetValue(KeyProperty, key);
    }

    /// <summary>
    /// When the command property is being set attach a listener for the
    /// key down event.  When the command is being unset (when the
    /// UIElement is unloaded for instance) remove the listener.
    /// </summary>
    /// <param name="dependencyObject"></param>
    /// <param name="e"></param>
    static void OnCommandInvalidated(DependencyObject dependencyObject, DependencyPropertyChangedEventArgs e)
    {
        UIElement element = (UIElement)dependencyObject;
        if (e.OldValue == null && e.NewValue != null)
        {
            element.AddHandler(UIElement.KeyDownEvent,
                new KeyEventHandler(OnKeyDown), true);
        }

        if (e.OldValue != null && e.NewValue == null)
        {
            element.RemoveHandler(UIElement.KeyDownEvent,
                new KeyEventHandler(OnKeyDown));
        }
    }

    /// <summary>
    /// When the parameter property is set update the command binding to
    /// include it.
    /// </summary>
    /// <param name="dependencyObject"></param>
    /// <param name="e"></param>
    static void OnParameterInvalidated(DependencyObject dependencyObject, DependencyPropertyChangedEventArgs e)
    {
        UIElement element = (UIElement)dependencyObject;
        element.CommandBindings.Clear();

        // Setup the binding
        CommandModelBase commandModel = e.NewValue as CommandModelBase;
        if (commandModel != null)
        {
            element.CommandBindings.Add(new CommandBinding(commandModel.Command,
            commandModel.OnExecute, commandModel.OnQueryEnabled));
        }
    }

    /// <summary>
    /// When the trigger key is pressed on the element, check whether
    /// the command should execute and then execute it.
    /// </summary>
    /// <param name="sender"></param>
    /// <param name="e"></param>
    static void OnKeyDown(object sender, KeyEventArgs e)
    {
        UIElement element = sender as UIElement;
        Key triggerKey = (Key)element.GetValue(KeyProperty);

        if (e.Key != triggerKey)
        {
            return;
        }

        CommandModelBase cmdModel = (CommandModelBase)element.GetValue(CommandProperty);
        object parameter = element.GetValue(ParameterProperty);
        if (cmdModel.CanExecute(parameter))
        {
            cmdModel.Execute(parameter);
        }
        e.Handled = true;
    }
} 
```

要从 xaml 使用它，您可以执行以下操作：

```
<TextBox framework:CreateKeyDownCommandBinding.Command="{Binding MyCommand}">
    <framework:CreateKeyDownCommandBinding.Key>Enter</framework:CreateKeyDownCommandBinding.Key>
</TextBox> 
```

**编辑：** CommandModelBase 是我用于所有命令的基类。它基于 Dan Crevier 关于 MVVM 的文章（[此处](http://blogs.msdn.com/dancre/archive/2006/09/15/dm-v-vm-part-7-encapsulating-commands.aspx)）中的 CommandModel 类。这是我与 CreateKeyDownCommandBinding 一起使用的略微修改版本的源代码：

```
public abstract class CommandModelBase : ICommand
    {
        RoutedCommand routedCommand_;

        /// <summary>
        /// Expose a command that can be bound to from XAML.
        /// </summary>
        public RoutedCommand Command
        {
            get { return routedCommand_; }
        }

        /// <summary>
        /// Initialise the command.
        /// </summary>
        public CommandModelBase()
        {
            routedCommand_ = new RoutedCommand();
        }

        /// <summary>
        /// Default implementation always allows the command to execute.
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        public void OnQueryEnabled(object sender, CanExecuteRoutedEventArgs e)
        {
            e.CanExecute = CanExecute(e.Parameter);
            e.Handled = true;
        }

        /// <summary>
        /// Subclasses must provide the execution logic.
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        public void OnExecute(object sender, ExecutedRoutedEventArgs e)
        {
            Execute(e.Parameter);
        }

        #region ICommand Members

        public virtual bool CanExecute(object parameter)
        {
            return true;
        }

        public event EventHandler CanExecuteChanged;

        public abstract void Execute(object parameter);

        #endregion
    } 
```

非常欢迎提出改进意见和建议。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2009-05-27T21:20:14.010

有点晚了，但这里。

[Microsoft 的 WPF 团队最近发布了他们的WPF MVVM Toolkit](http://blogs.msdn.com/ivo_manolov/archive/2009/05/03/9584900.aspx)的早期版本 。在其中，您会找到一个名为 CommandReference 的类，它可以处理键绑定之类的事情。查看他们的 WPF MVVM 模板，了解它是如何工作的。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-05-06T23:11:33.283

几个月前我研究了这个问题，我写了一个标记扩展来解决这个问题。它可以像常规绑定一样使用：

```
<Window.InputBindings>
    <KeyBinding Key="E" Modifiers="Control" Command="{input:CommandBinding EditCommand}"/>
</Window.InputBindings> 
```

这个扩展的完整源代码可以在这里找到：

[http://www.thomaslevesque.com/2009/03/17/wpf-using-inputbindings-with-the-mvvm-pattern/](http://www.thomaslevesque.com/2009/03/17/wpf-using-inputbindings-with-the-mvvm-pattern/)

请注意，这种解决方法可能不是很“干净”，因为它通过反射使用了一些私有类和字段......

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2016-06-09T07:00:57.490

类似于 karlipoppins 答案，但我发现如果没有以下添加/更改，它就无法工作：

```
<TextBox Text="{Binding UploadNumber, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">
    <TextBox.InputBindings>
        <KeyBinding Key="Enter" Command="{Binding FindUploadCommand}" />
    </TextBox.InputBindings>
</TextBox> 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-03-05T00:13:29.213

简短的回答是，如果没有代码隐藏，您将无法处理直接的键盘输入事件，但您可以使用 MVVM 处理**InputBindings**（如果您需要，我可以向您展示相关示例）。

你能提供更多关于你想在处理程序中做什么的信息吗？

使用 MVVM 并不能完全避免代码隐藏。它只是用于严格与 UI 相关的任务。一个主要的例子是具有某种类型的“数据输入表单”，当加载时，需要将焦点设置到第一个输入元素（文本框、组合框等）。您通常会为该元素分配一个 x:Name 属性，然后连接 Window/Page/UserControl 的“Loaded”事件以将焦点设置到该元素。这对模式来说是完全可以的，因为任务是以 UI 为中心的，与它所代表的数据无关。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2011-09-01T13:26:43.460

我知道这个问题已经很老了，但我之所以提出这个问题是因为这种功能在 Silverlight (5) 中更容易实现。所以也许其他人也会来这里。

在找不到我要找的东西后，我写了这个简单的解决方案。原来这很简单。它应该适用于 Silverlight 5 和 WPF。

```
public class KeyToCommandExtension : IMarkupExtension<Delegate>
{
    public string Command { get; set; }
    public Key Key { get; set; }

    private void KeyEvent(object sender, KeyEventArgs e)
    {
        if (Key != Key.None && e.Key != Key) return;

        var target = (FrameworkElement)sender;

        if (target.DataContext == null) return;

        var property = target.DataContext.GetType().GetProperty(Command, BindingFlags.Public | BindingFlags.Instance, null, typeof(ICommand), new Type[0], null);

        if (property == null) return;

        var command = (ICommand)property.GetValue(target.DataContext, null);

        if (command != null && command.CanExecute(Key))
            command.Execute(Key);
    }

    public Delegate ProvideValue(IServiceProvider serviceProvider)
    {
        if (string.IsNullOrEmpty(Command))
            throw new InvalidOperationException("Command not set");

        var targetProvider = (IProvideValueTarget)serviceProvider.GetService(typeof(IProvideValueTarget));

        if (!(targetProvider.TargetObject is FrameworkElement))
            throw new InvalidOperationException("Target object must be FrameworkElement");

        if (!(targetProvider.TargetProperty is EventInfo))
            throw new InvalidOperationException("Target property must be event");

        return Delegate.CreateDelegate(typeof(KeyEventHandler), this, "KeyEvent");
    } 
```

用法：

```
<TextBox KeyUp="{MarkupExtensions:KeyToCommand Command=LoginCommand, Key=Enter}"/> 
```

请注意，这`Command`是一个字符串，而不是可绑定的`ICommand`。我知道这不是那么灵活，但它在使用时更干净，而且你 99% 的时间都需要它。虽然改变应该不是问题。

# silverlight - Silverlight 布局最佳实践

> ID：612969
> 
> 赞同：6
> 
> 时间：2009-03-04T23:26:44.223
> 
> 标签：silverlight, xaml, coding-style

我正在使用 Silverlight 编写一个相当大的界面。随着我的进步，该`xaml`文件变得相当大，并且按比例变得越来越丑陋。

### 问题

1.  是否有任何资源可以使 xaml 更具可读性？例如，我将如何显示属性的顺序（例如首先显示高度和宽度）以使其看起来最整洁？
2.  另一个问题是有多种方法可以使用`grids`和来实现接口`stack panels`。使用其中一种方法时是否有首选方法？

我正在寻找可以用作示例的其他资源的建议和链接。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-06T03:03:20.267

如果您有很多复杂的 XAML，您可以尝试将其分解为几个 UserControl，以使其更加模块化，并且每个文件中的 XAML 更少。

这是一个教程 [http://silverlight.net/learn/tutorials/usercontrols.aspx](http://silverlight.net/learn/tutorials/usercontrols.aspx)

这是一个视频 [http://silverlight.net/learn/learnvideo.aspx?video=52036](http://silverlight.net/learn/learnvideo.aspx?video=52036)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-05T00:58:09.060

这可能与[XAML 最佳实践问题](https://stackoverflow.com/questions/488813/xaml-best-practices-guideline)相同，其中建议查看[http://dotnet.org.za/rudi/archive/2009/01/13/xaml-guidelines-released.aspx](http://dotnet.org.za/rudi/archive/2009/01/13/xaml-guidelines-released.aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-05T09:07:05.640

SilverLight 像任何其他 UI 语言一样存在大小复杂性问题

在 HTML 世界中已经写了很多关于这个问题的文章，同样的规则也适用

*   使用 MVP、MVC 等可测试模式 - SilverLight 有测试框架
*   将资源保存在单独的文件中 - 页面布局应该只是布局。风格、主题等通常是共享资源
*   使用自定义控件 - 尽量避免使用通用的内置控件，将它们包装在具有所有默认属性和处理程序等的自定义控件中。然后在页面布局上使用此控件时，可以减少属性包袱用它

由于它们的简单性，我更喜欢堆栈面板而不是网格 - 这有点像 HTML 世界表与 .css 布局之战

[用SilverLight Spy](http://silverlightspy.com/silverlightspy/download-silverlight-spy/)看看其他人的 SilverLight 努力，你可能会对自己的感觉更好:-)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-07-15T06:11:57.917

查看有关 Silverlight 最佳实践的系列：

[**Silverlight 2 最佳实践 - 4 篇文章**](http://www.ganshani.com/2009/07/09/silverlight-2-best-practices-i)

作者在这方面有 4 篇文章。

# c# - 确定异构容器容器中每种类型的元素数量

> ID：612976
> 
> 赞同：0
> 
> 时间：2009-03-04T23:29:33.140
> 
> 标签：c#, .net

我使用 Dictionary 作为异构容器：

```
Dictionary<string, Object> _Table; 
```

它基本上将一些描述映射到 int/double/string/ISeraliazable/etc 类型。

我想有效地计算每种类型的元素数量，然后只打印该类型的元素——在 SQL 中，我将按类型分组，然后分别打印每种类型的计数和所有元素。

我没有使用 LINQ，因为我需要在 .net 2.0 中支持它。我当然鼓励出于教育目的使用类似 linq 的解决方案，但**请记住，我只会使用与 .NET 2.0 兼容的代码**

我目前有一个解决方法，我为每种类型使用字典，然后遍历所有字典。

谢谢....

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-04T23:38:19.097

编辑：您还想打印对象：

```
Dictionary<Type, List<object>> numTypes = new Dictionary<Type, List<object>>();

foreach(KeyValuePair<string, object> pair in _Table){
    Type type = object.GetType();
    if (!numTypes.ContainsKey(type)){
        numTypes[type] = new List<object>();
     }

        numTypes[type].Add(object);
} 
```

# asp.net-mvc - 服务器安装新 MVC 应用程序和 MVC Release Candidate 2 时出错

> ID：612977
> 
> 赞同：0
> 
> 时间：2009-03-04T23:29:59.443
> 
> 标签：asp.net-mvc, installation

我使用 MVC RC2 开发了一个小型应用程序。

该应用程序在我的开发环境中运行良好，但是当我将其推送到我的生产环境时失败并出现以下错误：

```
Method not found: 
'Void System.Web.Mvc.RouteCollectionExtensions.IgnoreRoute
(System.Web.Routing.RouteCollection, System.String)'. 
```

应用程序池正在运行 .NET 2.x 最近安装的 .NET Framework 3.5 SP1 最近安装的 MVC RC2

有没有人遇到过这个问题？似乎在应用程序可用的程序集中缺少必要的方法。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-04T23:49:03.517

听起来您不是指两台机器上的相同程序集。

检查 iis6 和 localhost cassini 使用的 system.web 和 IIS7 使用的 system.webServer 之间的 web.config 差异。

还可以尝试将 MVC dll 放到站点的 bin 目录中，看看它是否没有从 GAC 获取它们。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-09-09T12:20:37.850

你曾经安装过 ASP.NET MVC V1 吗？我做过并且有过类似的经历。然后我下载了位于[此处](http://www.microsoft.com/downloads/details.aspx?FamilyID=d34f9eaa-fcbe-4e20-b2fd-a9a03de7d6dd&displaylang=en)的文档并查看了“将 ASP.NET MVC 1.0 项目升级到 ASP.NET MVC 2”部分

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-01-10T06:51:51.750

您使用的是哪个版本的 IIS？在 IIS 6.0 中，您必须在应用程序扩展映射中添加 MVC。

请查看此博客文章。 [http://haacked.com/archive/2010/12/22/asp-net-mvc-3-extensionless-urls-on-iis-6.aspx](http://haacked.com/archive/2010/12/22/asp-net-mvc-3-extensionless-urls-on-iis-6.aspx)

# objective-c - 为什么这会造成内存泄漏（iPhone）？

> ID：612986
> 
> 赞同：8
> 
> 时间：2009-03-04T23:36:16.667
> 
> 标签：objective-c, iphone, xcode, memory-management

```
//creates memory leak
  self.editMyObject = [[MyObject alloc] init];

//does not create memory leak
  MyObject *temp = [[MyObject alloc] init];
  self.editMyObject = temp;
  [temp release]; 
```

第一行代码会造成内存泄漏，即使您在类的 dealloc 方法中执行 [self.editMyObject release] 也是如此。self.editMyObject 是 MyObject 类型。第二行不会导致内存泄漏。第一行是不正确还是有办法释放内存？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-03-04T23:47:38.527

正确的行为取决于 editMyObject @property 的声明。假设它被定义为

```
@property (retain) id editMyObject; //id may be replaced by a more specific type 
```

或者

```
@property (copy) id editMyObject; 
```

然后通过`self.editMyObject =`保留或复制分配的对象进行分配。由于`[[MyObject alloc] init]`返回一个保留对象，你作为调用者拥有，你有一个 MyObject 实例的额外保留，因此它会泄漏，除非它有一个匹配的释放（如在第二个块中）。我建议您阅读[内存管理编程指南](http://developer.apple.com/library/mac/#documentation/Cocoa/Conceptual/MemoryMgmt/Articles/MemoryMgmt.html)[2]。

您的第二个代码块是正确的，假设属性是如上所述声明的。

ps 你不应该`[self.editMyObject release]`在`-dealloc`方法中使用。您应该调用`[editMyObject release]`（假设支持 @property 的 ivar 被调用`editMyObject`）。调用访问器（via`self.editMyObject`对于@synthesized 访问器是安全的，但如果被覆盖的访问器依赖于对象状态（这可能在调用位置无效`-dealloc`或导致其他副作用），则调用访问器会遇到错误。

[2] Cocoa 中的对象所有权规则非常简单：如果您调用一个具有`alloc`, 或其`copy`签名（或使用`+[NSObject new]`基本上等同于`[[NSObject alloc] init]`）的方法，那么您“拥有”返回的对象，并且您必须平衡您的获取的所有权`release`。在所有其他情况下，您不拥有从方法返回的对象。如果你想保留它，你必须用 a 取得所有权`retain`，然后用 a 释放所有权`release`。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-03-04T23:44:00.487

您的属性被声明为“保留”，这意味着传入的对象会自动保留。

因为你的对象已经有一个来自 alloc/init 的引用计数，所以有两个引用，我假设只有一个版本（在你的析构函数中）。

基本上对 self.editMyObject 的调用就是这样做的；

```
-(void) setEditMyObject:(MyObject*)obj
{
  if (editMyObject)
  {
    [editMyObject release];
    editMyObject = nil;
  }

  editMyObject = [obj retain];
} 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-05T00:37:27.580

按照 Cocoa 和 Cocoa-touch 中的约定，使用`[[SomeClass alloc] initX]`或`[SomeClass newX]`使用保留计数创建的任何对象。您有责任`[someClassInstance release]`在完成新实例后调用，通常是在您的`dealloc`方法中。

当您将新对象分配给属性而不是实例变量时，这会变得棘手。大多数属性被定义为`retain`or `copy`，这意味着它们要么在设置时增加对象的保留计数，要么制作对象的副本，而原始对象保持不变。

在您的示例中，您的`.h`文件中可能包含以下内容：

```
@property (retain) MyObject *editMyObject; 
```

所以在你的第一个例子中：

```
// (2) property setter increments retain count to 2
self.editMyObject = 

    // (1) new object created with retain count of 1
    [[MyObject alloc] init];

// oops! retain count is now 2 
```

当您创建`MyObject`使用`alloc`/的新实例时`init`，它的保留计数为 1。当您将新实例分配给 时`self.editMyObject`，您实际上是在调用`-setEditMyObject:`编译器为您创建的方法`@synthesize editMyObject`。当编译器看到`self.editMyObject = x`时，它会将其替换为`[self setEditMyObject: x]`.

在您的第二个示例中：

```
MyObject *temp = [[MyObject alloc] init];
// (1) new object created with retain count of 1

self.editMyObject = temp;
// (2) equivalent to [self setEditMyObject: temp];
// increments retain count to 2

[temp release];
// (3) decrements retain count to 1 
```

你持有你的新对象足够长的时间来释放它，所以保留计数是平衡的（假设你在你的`dealloc`方法中释放它）。

另请参阅[指针/内存管理的 Cocoa 策略](https://stackoverflow.com/questions/574029/cocoa-strategy-for-pointer-memory-management)

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-03-04T23:44:34.337

第一个版本创建一个没有匹配版本的对象。当您分配对象时，这意味着您是该对象的所有者。您的 setter 可能会保留该对象（应该如此），这意味着您现在拥有该对象两次。您需要发布来平衡对象创建。

如果你打算使用 Cocoa，你应该阅读[Cocoa 内存管理指南。](http://developer.apple.com/documentation/Cocoa/Conceptual/MemoryMgmt/MemoryMgmt.html)一旦你学会它并不难，但它是你必须学习的东西，否则你会遇到很多这样的问题。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-05T00:34:08.510

其他人都已经解释了它为什么会导致内存泄漏，所以我将插话如何避免“temp”变量并仍然防止内存泄漏：

```
self.editMyObject = [[[MyObject alloc] init] autorelease]; 
```

这将使您的（保留）财产成为新对象的唯一所有者。结果与第二个示例完全相同，但没有临时对象。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-10-23T19:42:50.917

同意并解释说下面的代码没有泄漏（假设 @property 保留和 @synthesize 用于 editMyObject）：

```
//does not create memory leak
MyObject *temp = [[MyObject alloc] init];
self.editMyObject = tempt;
[temp release]; 
```

问题：以下不使用临时指针的代码有什么问题吗？

```
//does not create memory leak ?
self.editMyObject = [[MyObject alloc] init];
[editMyObject release]; 
```

对我来说，这看起来不错。

# unix - 用于部署跨平台的打包？

> ID：612987
> 
> 赞同：2
> 
> 时间：2009-03-04T23:36:25.480
> 
> 标签：unix, deployment, cross-platform, packages, packaging

在 Windows 上，应用程序通常打包为 MSI，在 Redhat Linux 上为 RPM，可用于将应用程序部署到所有平台（包括不同风格的 unix 和 windows）的最佳开源打包方法是什么？

内容将包括 exe、unix 二进制文件、java jar 文件、用户数据，甚至要运行的数据库脚本。

（我认识到每个目标操作系统的内容会有所不同，即二进制文件会有所不同，win exe 与 unix 二进制文件等，但例如配置文件可能相同，或者在 java 的情况下甚至字节码 jars）

我希望打包支持的关键特性是不同目录的不同用户和权限，但是我认识到支持这个特性多平台可能非常困难。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-04T23:41:46.170

您应该让构建系统为每个目标平台构建不同的包，而不是构建一个应该可以在所有平台上工作的包，这可能是不可能的。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-05T17:42:23.017

使用[CPack](http://www.cmake.org/Wiki/CMake:Packaging_With_CPack)（它带有[CMake](http://www.cmake.org/)），您可以使用“make package”为 Windows（带有 NSIS）、Linux（rpm 和 deb）和 OS X 创建包。CMake 还简化了跨平台构建。

对于示例，您可以查看 avogadro 的[CMakeLists.txt](http://github.com/cryos/avogadro/blob/1151c80a28f2e0e780ab1e9b4f2a0b8297439b4d/CMakeLists.txt)和[AvoCPack.cmake](http://github.com/cryos/avogadro/blob/1151c80a28f2e0e780ab1e9b4f2a0b8297439b4d/cmake/modules/AvoCPack.cmake)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-04T23:47:47.480

[NSIS](http://nsis.sourceforge.net/Main_Page)是一个开源解决方案，据我所知，它能够构建在 Windows 和类似 UNIX 的系统上运行的安装程序。但是，对于 Windows 上的软件部署（尤其是在企业环境中），MSI 是可行的方法，而 NSIS 则更令人头疼。

所以我不建议你尝试为不同的平台构建一个包/安装程序。但是，正如 RibaldEddie 所指出的，多个包：每个平台一个包。这也允许将包的内容限制为与每个平台相关的文件。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-05T00:15:29.507

我有一个客户端，它使用 IzPack 创建一个安装程序（它基于 Java），在 Windows、OS X 和 Linux 上安装他们的应用程序。

[http://izpack.org/](http://izpack.org/)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-05T17:26:35.067

如果您想支持多个发行版的打包，我建议帮助这些发行版的打包者；为您的软件使用某种众所周知的构建系统（GNU`autotools`或类似`scons`or的东西`waf`），并很好地记录构建、可选依赖项等。

这样，当 Debian、Ubuntu、Red Hat、SuSE 等打包程序出现时，他们将能够为您创建包。如果愿意，您可以选择在可用的单独 VCS 树中包含一个或多个发行版的打包模板。

如果您正在考虑为多个系统打包一个闭源/专有应用程序，您可能最好打包一个 .tar.gz 文件并记录它的安装过程。您还需要确保所使用的构建过程不会将任何路径信息嵌入到应用程序中，以便它可以在 、 或 中运行`/opt`，`/usr`这`/usr/local`是第三方附加软件的一些流行选择。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-09-12T11:11:25.213

[BitRock InstallBuilder](http://installbuilder.bitrock.com) allows you to create installer packages for each one of the platforms you mentioned (as well as creating RPM, DEB, packages etc. from a single project file)

# .net - 什么会导致 .NET 服务引用中的属性在调用时变为空？

> ID：612993
> 
> 赞同：0
> 
> 时间：2009-03-04T23:37:36.943
> 
> 标签：.net, web-services, serialization

我刚刚笔记本电脑崩溃了（溅了水）。我将我的工作代码（2 天前备份）从 Windows Server 2008 笔记本电脑复制到了运行 Visual Studio 2008 SP1 的 Vista 笔记本电脑。两者都运行 .NET 3.5 SP1。

我有一个返回产品信息的 Web 方法调用。

Web 服务中的一些字段（在托管服务器上运行）如下：

```
public class Product
{
    [XmlAttribute("sku")]
    public string SKU;

    [XmlAttribute("name")]
    public string Name;

    [XmlAttribute("category")]
    public string CategoryName;

    [XmlAttribute("categoryKey")]
    public string CategoryKey;

    public List<ProductSectionInfo> Sections;

    public List<MediaItem> MediaItems;

    public string Foo = "bar";
}

public class MediaItem
{

    [XmlAttribute("type")]
    public string Type;

    [XmlAttribute("imageKey")]
    public string ImageKey;

    [XmlAttribute("path")]
    public string Path;

    [XmlAttribute("thumbnailPath")]
    public string ThumbnailPath;

    [XmlAttribute("thumbnailImageKey")]
    public string ThumbnailImageKey;

    [XmlAttribute("selectable")]
    public bool Selectable;
} 
```

当我运行一个`'GetProduct'`Web 方法时，该`'Sections'`属性正在我的 C# 客户端（在新笔记本电脑上）中填充，但`'MediaItems`' 属性不是。它只是在监视窗口中显示为 null。

所以我查看 Fiddler，两者都填充在 XML 中。两者都是列表，在我的代理中定义为标准 [] 数组。

您可能已经注意到我在上面添加了一个“Foo”属性。我在服务器上做了这个，重新编译并重新创建了网络参考。我能够验证在客户端中确实遇到了“Foo”属性。所以它不是'MediaItems'大写或类似的东西。

我非常确信这台新笔记本电脑上有一些与其他笔记本电脑不同的东西。我并没有真正写过什么新东西，只是在别处做了些改动。在我发现问题之前，我什至没有重新创建服务引用代理。我的客户端在测试服务器上运行的另一个实例运行良好，可以访问相同的服务。

固定笔记本电脑明天会回来，但我真的很想弄清楚这一点。我很困惑。我以前见过各种奇怪的事情，但真的看不到这里发生了什么。我可以以某种方式调试代理吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-04T23:44:41.810

我遇到的大部分消息部分无法正确加载的问题通常是代理和服务之间的差异。通常要么发生更改/移动，甚至是 xml 命名空间更改/问题。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-04T23:53:53.940

我知道这是一种问题，只要我提出一些问题，它就会自行解决——当然是这样。

我仍然不知道为什么。我能够添加一个 'Foo' 属性，重新生成代理但它仍然无法工作，这一事实非常奇怪。

*   我添加了一个新的“MediaItems2”属性并为其分配了一个空的“MediaItem”

    MediaItems2 = new List(new MediaItem[] {new MediaItem()})

*   我生成了一个新代理
*   一切正常
*   我从网络服务中删除了“MediaItems2”
*   我生成了一个新代理
*   它仍然有效

不过还是很疑惑。这是这个项目（ASP.NET MVC）第一次在这台笔记本电脑上运行。

哦，好吧，回去工作吧……************