# StackOverflow 问答 000524000-000524999

# delphi - Is there a Delphi library which reads and writes .properties files?

> ID：524000
> 
> 赞同：2
> 
> 时间：2009-02-07T15:52:15.660
> 
> 标签：delphi, properties

I thought about creating my own, but there are many details to consider to make it 100% compatible with Java .properties files, so I'm asking first.

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-07T18:00:22.157

曾经有一个名为[Gel](http://www.gexperts.com/products/gel/gel.asp)的 Java IDE 。它是用 Delphi 编写的，它是一个很好的 IDE，所以我希望它能够处理属性文件。作者已停止该项目的工作。在他[描述项目取消的博客文章中](http://www.gexperts.com/blog/archives/2008/06/entry_387.html)，他提到对使项目开源的前景持开放态度，但它从未真正起飞。如果你问得好，你可能会得到你正在寻找的那部分代码。

对您发现的任何`TStrings`用于其界面的解决方案持怀疑态度。尽管该类具有使其作为处理键/值对的类具有吸引力`Names`的`Values`属性，但它不会与 Java 的属性文件完全兼容。原因是 Java 允许“=”作为键名中的字符，并且`TStrings`该类通过查找字符串中的第一个“=”字符来检测名称的结尾和值的开头。此外，Java 属性文件可以使用“:”作为分隔符，甚至可以使用普通空格。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-07T17:38:21.407

不是 Java 人，但据我所知 .properties 文件伪装成类似于 .INI 文件；它有 name=value 对，没有节名。您可以使用 Delphi 的 TStringList 来处理它；它具有名称和值属性。

例如，要从 .properties 文件中读取以下行：

```
MyProgramData=c:\documents and settings\DR\Application Data\MyApp 
```

我可以简单地使用：

```
var
  SL: TStringList;
  MyDataPath: string;
begin
  SL :=  TStringList.Create;
  try
    SL.LoadFromFile('myapp.properties');
    MyDataPath := SL.Values['MyProgramData'];
  finally
    SL.Free;
  end;
  // Do something with MyDataPath
end; 
```

对于过于迂腐的读者，我并不是建议 TStringList 允许您使用 .properties 文件的全部功能。但是，它*可能*足以满足您的需要。（正如我所说，我不是 Java 人。）

# sql-server - SQL Server 2K - 代理作业 - 错误和消息

> ID：524001
> 
> 赞同：3
> 
> 时间：2009-02-07T15:52:38.703
> 
> 标签：sql-server, sql-server-agent

我有一份每天晚上都跑的工作。我在我的存储过程中进行了自己的日志记录，这样我就可以知道如果出现故障时发生了什么。

昨晚工作失败了，我知道在哪里。当我手动运行作业时，它成功了。所以我去了工作历史，看看我能找到什么。

我选择了“显示步骤详细信息”并可以看到消息。到目前为止一切顺利，但这是我的问题。

显示消息/错误的框充满了大量信息，但最后一部分显示“步骤失败”已被其他没有关于错误信息的消息截断。其他消息都是正常的。我多次使用 BCP 并期待它们。

我的问题是：有没有办法在存储过程中清除它？我要做的是在 stpred 程序失败的部分之前清除它，以便我有一个清晰的框

或者

有什么办法可以看到更多细节吗？我查询了 sysjobhistory 但它基本上是相同的信息。截断/切断并没有多大用处。

或者

有什么方法可以关闭在作业期间记录的消息，以便只有错误存在。

谢谢 ！！谢谢！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-07T15:58:39.157

在 SQL 代理作业步骤的“高级”选项中，您可以选择将步骤输出记录到的文件。此日志文件将包含一个步骤的所有详细信息，而不是截断。它对已经发生的失败没有帮助，但对未来的任何失败都有帮助。

# ide - Netbeans - 使用 [SHIFT]+[F6] 在不同项目中执行文件

> ID：524002
> 
> 赞同：0
> 
> 时间：2009-02-07T15:54:03.020
> 
> 标签：ide, compiler-construction, netbeans, keyboard-shortcuts, compilation

在 Netbeans 中，您可以通过按`Shift`+来运行文件`F6`（在 Windows 上）

所以我目前有三个项目开放。

我想做的是在三个项目之间跳转，并比较在这三个窗格中的每个窗格中执行程序的结果。

Netbeans 似乎对此有疑问。它似乎无法识别出我想在我刚刚跳转到的项目中执行一个文件——相反，它只是从我之前所在的项目中重新执行该文件——或者——它什么都不做。

难道我做错了什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-08T13:07:48.923

在 netbeans 6.5 中，您可以选择不设置主项目。

运行>>设置主项目>>无

这意味着，您当前打开的任何文件，当您告诉它运行时，它将运行您当前打开的任何文件，并将该项目视为主项目。

[http://wiki.netbeans.org/mainProjectConceptualChange](http://wiki.netbeans.org/mainProjectConceptualChange)

希望这可以帮助！

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-07T18:33:20.220

默认情况下，当您尝试运行某些代码时，它将运行您当前设置为工作项目的任何项目，而不是您正在查看的项目。

# ruby - 如何从 ruby 线程中获取错误消息

> ID：524019
> 
> 赞同：12
> 
> 时间：2009-02-07T16:04:18.367
> 
> 标签：ruby, multithreading

我现在遇到一个问题，我看不到我的子线程在哪里吐出错误消息，这使得调试变得困难。

例如：

```
Thread.new{
    a = 1/0
} 
```

有什么方法可以在 stderr 打印出所有线程错误？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-02-07T16:36:23.043

将 Thread 类的`abort_on_exception`标志设置为 true。

或者，将线程主体包装在 throw/catch 块中，并将异常转储到 catch 中。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2010-01-22T13:55:50.783

设置`$DEBUG`为 true （你可以从命令行使用`-d`），你会得到

```
ruby -d bad_thread.rb 
Exception `LoadError' at /usr/lib/ruby/site_ruby/1.8/rubygems.rb:1113 - no such file to load -- rubygems/defaults/operating_system
Exception `LoadError' at /usr/lib/ruby/site_ruby/1.8/rubygems/config_file.rb:34 - no such file to load -- Win32API
Exception `ZeroDivisionError' at bad_thread.rb:2 - divided by 0
bad_thread.rb:2:in `/': divided by 0 (ZeroDivisionError)
    from bad_thread.rb:2
    from bad_thread.rb:1:in `initialize'
    from bad_thread.rb:1:in `new'
    from bad_thread.rb:1 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-02-08T15:10:34.730

这应该会捕获您未明确处理的任何错误并将它们打印到 STDOUT。

```
require 'pp'

Thread.new {
  begin
    a = 1/0
  rescue
    pp $!
  end
} 
```

结果：`#<ZeroDivisionError: divided by 0>`

# image - 您如何在 Adob e Illustrator 9 中找到链接图像的路径？

> ID：524020
> 
> 赞同：2
> 
> 时间：2009-02-07T16:05:16.163
> 
> 标签：image, adobe-illustrator

我有一个带有链接图像的 Illustrator 文件。我实际上想嵌入图像。我首先必须知道它们是哪些文件。我怎么知道？我正在使用 Illustrator 9。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-07T18:08:14.950

我使用的第一个 Illustrator 版本是 10，但是，版本 9 中有链接调色板吗？尝试窗口菜单并寻找“链接”。它有几个选项可以搜索您想要的图像、重新链接、打开原件等。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2011-01-26T02:33:06.100

使用较新版本的 Illustrator，您可能可以使用以下脚本替换损坏图像的链接：

[http://techblog.willshouse.com/2011/01/16/update-illustrator-linked-files-script/](http://techblog.willshouse.com/2011/01/16/update-illustrator-linked-files-script/)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2011-08-01T09:41:43.907

我刚刚在 Illustrator CS4 中遇到了这个问题；我的很多东西最近都被归档了。

单击画板中的“丢失”图像。

在左上角，您将看到显示的文件名。

在随后的下拉菜单中单击“编辑原件”。Illustrator 将尝试查找文件，并闪烁警告窗口“windows 找不到文件”等，为您提供完整的文件位置。

这很有用，因为编辑原件在链接窗口中显示为灰色。对于像我这样拥有大量文件库的人来说非常有用。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-09-22T21:09:44.063

很高兴知道海报已经设置好，但这并不能回答问题。在 CS3 中，如果您双击链接面板中的图像，ti 将显示链接元素的链接信息，其中显示文件的路径（前提是它不长于窗口）。

也许旧版本也允许您这样做。

不幸的是，如果您正在处理丢失的链接元素（您在打开文件时忽略了该元素以修复），则此字段为空白。与 InDesign 相比，Illustrator 在文件打包和链接方面表现不佳。如果它可以像 InDesign 那样打包文件，并存储对外部资源的相对引用，那就太好了。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-01-10T14:13:39.560

我使用以下 perl 脚本来跟踪 Illustrator 文件中的链接图像。这对于断开的链接特别有用，因为它仍然会通过查看 Illustrator 文件中的内容来告诉您链接图像的完整路径。它显然比这里的任何人都需要做的更多，但也许它会很有用。帮助应该解释如何使用它。在我的机器上，我将其命名为 ailinkedfiles.pl，并将其放在我的 PATH 中的 ~/bin 中。

```
#!/usr/bin/perl 

# program to find the linked files inside an Adobe Illustrator file
require 5.004;
use File::Basename;   # to extract a filename from a full path
use File::Find;       # to build a list of files
use File::Spec;       # Platform independent way to build paths
use vars qw/ %opt /;  # for command line options - see init()
use strict;

init(); # process command line options

# Autoflush stdout
$|=1;

if ($opt{p}){
 die "Did you really mean to call your script ".$opt{p}."!\n" if($opt{p} =~ /\.ai$/i); 
 print "Generating script file $opt{p}\n" if $opt{v};
 open SCRIPT, "> $opt{p}"; 
}

die "No input specified; use ".basename($0)." -h for help\n" if(@ARGV==0);
my $arg; foreach $arg (@ARGV){
 if(-d $arg){
  # nb it is necesary to convert the directory specification
  # to an absolute path to ensure that the open in &findLinkedFiles
  # works properly during multi directory traversal
  my $InDir=File::Spec->rel2abs($arg); 
  find(\&handleFind,$InDir); 
 } elsif (-f $arg) {
 my $InDir=File::Spec->rel2abs(dirname($ARGV[0])); 
   &findLinkedFiles(File::Spec->rel2abs($ARGV[0]),$InDir) ;
#   &findLinkedFiles(File::Spec->rel2abs($arg)) ;
 }
}

sub init()
# copied from: http://www.cs.mcgill.ca/~abatko/computers/programming/perl/howto/getopts
{
 use Getopt::Std;      # to handle command line options
 my $opt_string = 'hvlzdsftnp:ux:';
 getopts( "$opt_string", \%opt ) or usage();
 usage() if $opt{h};
}

# Print out usage information
sub usage()
{
 print STDERR << "EOF"; 
Usage: $0 [OPTIONS] <AIFILE/DIR>

Parse an Adobe Illustrator file or (recursively) parse a directory of ai files
and print a list of the linked files to STDOUT.  These could be piped to xargs eg:
$0 aifile.ai | xargs -I {} ln -vs

 -h print this help
 -v verbose ouput
 -s print file names with short path
 -d print current directory on each line
 -n no-print (suppresses printing of linked file names)
 -x <regex> exclude files whose full path matches regex 

 -l symlink in current directory if file linked from Illustrator file exists somewhere else
 -f force symlink to overwrite existing target file
 -t test run
 -p <file> write commands to a script file

 -u status of src and target
  - doesn't exist
  F plain file
  L symbolic link
  E exists (unknown file type)

 Note that src is the link contained in the Illustrator file and
 target is a file of the same name in the same directory as the Illustrator file

 If the status is -- you will have problems in Illustrator
 If the status is -F Illustrator will substitute the local file for the unavailable linked file
 If the status is F- you can run this script with the -s option to make a symlink 
 If the status is FF then Illustrator will be happy 

EOF
 exit();  
}

sub mysymlink{
 my ($src,$targetdir)=@_;
 my $target=File::Spec->catdir($targetdir,basename($src)); 

 if(File::Spec->rel2abs($src) eq File::Spec->rel2abs($target)){
  print "src and target identical for src=$src\n" if $opt{v};  
  return;  
 }

 if(-e $src){
  my $opts=$opt{f}?"-fsv":"-sv";  
  my $cmd="ln $opts \"$src\" \"$target\"";   
  myexec("$cmd");
 } else {
  print "No link made: $src doesn't exist\n" if $opt{v};
 }
}
sub myexec {
 my ($cmd) = @_; 
 if ($opt{t}){
  print STDERR "test: $cmd\n";
 }  elsif ($opt{p}){
  print SCRIPT $cmd,"\n";
 }  else {
  # should get to see output with system
  print STDERR "run: $cmd\n" if $opt{v}; 
  return system $cmd;  
 }
}

sub mystatus{
 my ($src,$targetdir)=@_;
 my $target=File::Spec->catdir($targetdir,basename($src)); 

 my ($ss,$ts)=("-","-"); 

 $ss = "E" if(-e $src);
 $ss = "F" if(-f $src); 
 $ss = "L" if(-l $src);
 $ts = "E" if(-e $target);
 $ts = "F" if(-f $target); 
 $ts = "L" if(-l $target);
 return ($ss.$ts);
}

# This extracts the file info from the header
sub handleFind{
 # get the file name
 my $FullFoundFile = $File::Find::name;
 #print $FullFoundFile,"\n";

 return if ($opt{x} and $FullFoundFile =~ /$opt{x}/i); 

 # parse if it ends in ai
 findLinkedFiles($FullFoundFile, $File::Find::dir) if ($FullFoundFile =~ /\.ai$/i);
}

# This does the actual parsing of the Illustrator Files
sub findLinkedFiles{
 my ($InFile,$InDir)=@_; 

 # protect with escaped quotes for shell if non-empty
 my $ProtectedInDir=$InDir?"\"$InDir\"":$InDir; 

 die "Can't open $InFile \: $!\n"  unless open(AIFILE, "<$InFile");
 binmode(AIFILE);

 # %%DocumentFiles is the starting point 
 $/="%%"; 
 my @lines = readline<AIFILE>; 

 if(@lines==0){
  print STDERR "can't read header of $InFile\n" if $opt{v} ; # the header length
  return;   
 }

 print "################\n"; 

 if ($opt{s}){
  print "# FILE = ",basename($InFile),"\n";  
 } else {
  print "# FILE = ",$InFile,"\n"; 
 }
 for my $i ( 0 .. $#lines ){  
#  if ( $lines[$i]=~/^DocumentFiles\:(.*?)\W+%%/){
# not sure why we need two % signs here
  if ( $lines[$i]=~/^DocumentFiles\:(.*?)\W+%/){
   print mystatus($1,$InDir)," " if $opt{u} and not $opt{n};
   print "\"$1\" ",$opt{d}?$ProtectedInDir:"","\n" unless $opt{n};
   $i++;
   mysymlink($1,$InDir) if $opt{l};
   while($lines[$i]=~/^[+](.*?)\W\%.*$/){
#    print "\"$1\" $InDir\n"; $i++;   
    print mystatus($1,$InDir)," " if $opt{u} and not $opt{n};
    print "\"$1\" ",$opt{d}?$ProtectedInDir:"","\n"unless $opt{n};
    $i++;
    mysymlink($1,$InDir) if $opt{l};     
   }

  }
 } 
} 
```

# ruby - Eclipse 的首选 Ruby 插件？

> ID：524021
> 
> 赞同：74
> 
> 时间：2009-02-07T16:06:05.383
> 
> 标签：ruby, eclipse, eclipse-plugin, ruby-development-tools

RDT（Ruby Development Tool）似乎是为 Eclipse 添加 Ruby 支持的首选插件。但是，我看到该项目的主要开发人员已加入 Aptana RadRails。这是否意味着 Eclipse 中的 Ruby 项目不再是最新的？

如果是这样，现在哪个插件是首选和最佳选择？

* * *

## 回答 #1

> 赞同：93
> 
> 时间：2009-02-07T16:37:31.590

~~试试 Ruby 的[动态语言工具包](http://www.eclipse.org/dltk/)。它可以从 Eclipse 的软件更新面板中获得。~~

2020 年 5 月更新：DLTK 6.0 中删除了 Ruby 支持，转而支持[Eclipse Solargraph](https://github.com/PyvesB/eclipse-solargraph)。

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2009-02-07T16:14:43.430

好问题。我用过 Aptana/radrails，这绝对是一个要避开的。

它会在您启动 Eclipse 的任何目录中写入一个数据库，并且通常会接管 Eclipse，更改许多有用的键绑定。

最烦人的事情之一是`Ctrl`-`1`停止在 Java 文件中工作，这是我一直使用的*热键*。

我期待听到人们对此的回答，因为我想知道一个好的。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2010-11-10T23:49:29.250

看起来更新站点在这里：http: [//download.eclipse.org/technology/dltk/updates/](http://download.eclipse.org/technology/dltk/updates/)

我在 www.eclipse.org/dltk/install.php 上找到了它

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2014-08-08T22:53:00.417

在为 Eclipse 安装 aptana studio 插件后，我遇到[了这个问题。](https://stackoverflow.com/questions/25213115/eclipse-cannot-see-ruby-perspective-or-interpreter)所以，我决定尝试 Eclipse 的动态语言工具包。

如果要卸载 aptana 插件：Eclipse > 帮助 > 关于 Eclipse > 安装详细信息 > 已安装软件选项卡 > Aptana 插件 > 卸载。这应该可以进行干净、无挫折的卸载。

现在，让我们安装 DLTK 插件。

转到链接 - [http://marketplace.eclipse.org/content/ruby-dltk](http://marketplace.eclipse.org/content/ruby-dltk)。按绿色向下箭头。从弹出窗口复制链接。

![在此处输入图像描述](https://i.stack.imgur.com/x2Noj.jpg)

Eclipse > 帮助 > 安装新软件 > 使用 = 复制的链接。

现在您会看到一个插件列表。在该列表中，展开编程语言 > 选中复选框：动态语言工具包 - Ruby 开发工具 > 按下按钮：下一步 > 明显步骤。

在此之后，在[http://rubyinstaller.org/](http://rubyinstaller.org/)安装 Windows 的 RubyInstaller 找到此安装创建的 ruby​​.exe 的位置。当您创建第一个 eclipse ruby​​ 项目时，您将需要它来设置 ruby​​ 解释器。

成功创建 Ruby 项目后，eclipse 会询问您是否要打开 ruby​​ 透视图。说OK。要测试它是否有效，请创建 ruby​​ 项目，然后在此项目中创建一个空的 ruby​​ 脚本。然后将此命令`puts "hello ruby"`作为 ruby​​ 脚本执行。享受闪闪发光的红宝石！

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-07T16:14:38.207

我过去使用过 Aptana/RadRails，并且非常喜欢它。我建议试一试。有一个独立的 Eclipse 插件可以很好地支持非 Rails 项目，如果这就是你想要的。

然而，我对 Eclipse 的唯一体验是通过 Aptana，因此可能还有其他考虑因素。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2015-01-08T12:20:56.170

动态语言工具包 (DLTK) 是首选。在eclipse中一步一步安装：

1.  打开日食
2.  转到**帮助->“Eclipse 市场...** ”
3.  在 Find 文本框上输入 DLTK，然后单击 Go 按钮
4.  单击 Ruby (DLTK) 部分下的安装按钮
5.  按照 Eclipse 弹出窗口中的说明进行操作

安装成功后验证安装：

转到**Window -> Preferences**，您会在左侧面板上看到“Dynamic Languages”和“Ruby”

# cocoa-touch - Download File From short URL

> ID：524022
> 
> 赞同：0
> 
> 时间：2009-02-07T16:06:11.763
> 
> 标签：cocoa-touch, short-url

I want to download a sound file from a short URL (like: `www.adjix.com`) When I try from normal link, it's OK, but from short URL, how first redirect and then download

I use this part of code to create request:

```
NSMutableURLRequest *theRequest = [NSMutableURLRequest requestWithURL:[NSURL URLWithString:urlToSound]];

NSURLConnection *theConnection =[[NSURLConnection alloc] initWithRequest:theRequest delegate:self];

if (theConnection) {
    self.receiveData = [[NSMutableData data] retain];
} 
```

And this code to view header:

```
- (void)connection:(NSURLConnection *)connection didReceiveResponse:(NSURLResponse *)response{
    [receiveData setLength:0];

    if ([response isKindOfClass:[NSHTTPURLResponse self]]  ) {
        NSDictionary *headers = [(NSHTTPURLResponse *)response allHeaderFields];
        NSLog(@"headers: %@", headers);
   }
} 
```

When I try to download directly, link to MP3 header is:

```
 "Accept-Ranges" = bytes;
    Connection = "Keep-Alive";
    "Content-Length" = 21316;
    "Content-Type" = "audio/mpeg";
    Date = "Sat, 07 Feb 2009 16:01:34 GMT";
    Etag = "\"2d810-5344-7dda240\"";
    "Keep-Alive" = "timeout=15, max=100";
    "Last-Modified" = "Sat, 25 Jun 2005 12:26:41 GMT";
    Server = Apache; 
```

When I try to download file with a short URL (`adjix.com/3na3`), the header is:

```
 "Cache-Control" = "max-age=60";
    Connection = close;
    "Content-Length" = 692;
    "Content-Type" = "text/html";
    Date = "Sat, 07 Feb 2009 19:18:23 GMT";
    Expires = "Sat, 07 Feb 2009 19:19:23 GMT";
    Server = "Apache/1.3.41 (Darwin) mod_ssl/2.8.31 OpenSSL/0.9.7l"; 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-11T13:48:52.477

NSURLConnection 有一个委托方法，你可以专门实现它来处理重定向。但是，由于您的请求的用户代理字符串，您要连接的服务器的行为可能有所不同。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-08T00:42:14.530

您可能想尝试 GTMHTTPFetcher 类，它是[Google Toolbox for Mac](http://code.google.com/p/google-toolbox-for-mac/)的一部分。它为您处理重定向。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-07T19:00:05.890

你能提供更多信息吗？特别是，最好提及您用于执行 HTTP 请求的类，以及使用重定向 URL 时发生的中断。

# php - 是否有适用于 RSS 和 ATOM 的 PHP 提要阅读器？

> ID：524024
> 
> 赞同：4
> 
> 时间：2009-02-07T16:08:13.960
> 
> 标签：php, rss, atom-feed

我需要一个可以从提要中检索数据的 PHP 库/脚本，无论它们是 RSS 还是 ATOM，因为我希望用户插入随机提要，然后将其存储在数据库中。如果它可以检查给定的 URL 是否是提要，那就太好了。

如果有任何可以帮助我的东西，有人可以告诉我吗？谢谢！

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-02-07T16:24:32.273

试试这两个，它们都做 RSS 和 Atom：

*   [简单派](http://simplepie.org/)
*   [PHP 通用提要解析器](http://www.ajaxray.com/blog/2008/05/02/php-universal-feed-parser-lightweight-php-class-for-parsing-rss-and-atom-feeds/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-07T16:13:27.583

[Zend_Feed](http://framework.zend.com/manual/en/zend.feed.html)

> Zend_Feed 提供了使用 RSS 和 Atom 提要的功能。它为访问提要、提要属性和条目属性的元素提供了一种自然语法。Zend_Feed 还广泛支持使用相同的自然语法修改提要和条目结构，并将结果转换回 XML。将来，这种修改支持可以为 Atom 发布协议提供支持。

您不必使用整个 Zend 框架，只需使用 Zend_Feed 组件及其依赖项即可。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-09-06T20:54:53.587

最近我创建了一个可以解析 RSS 和 Atom 提要的 php 提要阅读器类。这是链接[http://raynux.com/blog/2009/09/02/rayfeedreader-php-class-for-parsing-rss-and-atom-feed/](http://raynux.com/blog/2009/09/02/rayfeedreader-php-class-for-parsing-rss-and-atom-feed/)。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-02-08T11:35:49.453

这可以通过 SimpleXML 轻松处理，并且除了您自己之外不需要任何其他人的代码。请记住，如果您向 SimpleXML 提供无效或不存在的文件，SimpleXML 会自行处理。使用 try/catch + 异常。

[http://us2.php.net/simplexml](http://us2.php.net/simplexml)

# c++ - 枚举位域容器类

> ID：524028
> 
> 赞同：1
> 
> 时间：2009-02-07T16:09:48.900
> 
> 标签：c++, enums, bit-fields, bitflags

我试图编写一个小类来更好地理解 C++ 中的位标志。但有些事情没有解决。它打印错误的值。哪里有问题？我是否误解了如何添加标志？或者检查位域是否有它们？

继承人的代码：

```
#include <iostream>

enum flag
{
    A = 1, B = 2, C = 4
};

class Holder
{
public:
    Holder() : m_flags(A) {}
    ~Holder() {}

    void add_flag(flag f) { m_flags |= f; }
    bool has_flag(flag f) { return ((m_flags&f)==f); }
    void remove_flag(flag f) 
    {
        unsigned int flags = 0;
        for (int i = 1; i<=(int)C; i *= 2)
        {
            if ((flag)i!=f && has_flag(f))
                flags |= f;
        }
        m_flags = flags;
    }

    void print()
    {
        std::cout << "flags are now: " << m_flags << " | holding: "; 
        for (int i = 1; i<=(int)C; i *= 2)
        {
            if (has_flag((flag)i))
                std::cout << i << " ";
        }
        std::cout << std::endl;
    }

private:
    unsigned int m_flags;
};

int main()
{
    Holder h;
    h.print(); // should print 1

    h.add_flag(B);
    h.print(); // should print 1 2

    h.remove_flag(A);
    h.print(); // should print 2

    h.add_flag(C);
    h.print(); // should print 2 4

    h.remove_flag(B);
    h.print(); // should print 4
} 
```

程序输出：

```
flags are now: 1 | holding: 1 
flags are now: 3 | holding: 1 2 
flags are now: 1 | holding: 1 
flags are now: 5 | holding: 1 4 
flags are now: 0 | holding: 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-07T16:17:45.313

您的 remove_flag() 方法中有一个错误，它应该是 flags |= i;

但是，这样做 O(1) 像这样：

```
void remove_flag(flag f) { m_flags &= ~f; } 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-07T16:20:05.790

*has_flag()*和*remove_flag()*是错误的。他们应该是这样的：

```
bool has_flag(flag f) { return !!(m_flags & f); }
void remove_flag(flag f) 
{
    m_flags &= ~f;
} 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-07T16:24:04.253

我个人会使用 std::vector< bool > 来处理标志，因为它是一种将布尔值打包成位的专业化。

然而：

我认为你的删除标志有点复杂，试试这个

```
void remove_flag( flag f ) 
{
   if ( has_flag( f ) == true )
   {
      m_flags ^= f;   // toggle the bit leaving all other unchanged
   } 
} 
```

编辑：评论问我为什么不这样做`do m_flags &= ~f`。我把这个问题当作“学习者”问题而不是优化问题。我展示了如何使他的代码正确，而不是快速。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-07T16:53:41.543

每个人都已经确定了这一点：flag &= ~f;

[你可以看看我之前的帖子。](https://stackoverflow.com/questions/523724/c-c-check-if-one-bit-is-set-in-i-e-int-variable/524032#524032)

has_flag()：如果 f 中的所有位都已设置，您是否希望返回 true？或者如果至少设置了其中一个？这是 flags&f==f 与 flags&f !=0 之间的区别。

您可以考虑 #include <iomanip> 和 cout << hex <<m_flag <<dec. （十六进制到位的转换可以在您的脑海中更轻松地完成。）

枚举可以在类 Holder 中。

```
class Holder
{
public:
  enum flag { A=1, B=2, C=4; };
...
}; 
```

然后，您将使用**Holder::A**而不是**A**。

如果 has_flag(1<<i) ...

您可能希望 add_flag/has_flag/remove_flag 方法采用 int 而不是枚举类型。这摆脱了很多铸造。如果您不想支持所有可能的 int 值，可以使用验证方法和拒绝路径。顺便说一句，没有什么能阻止我调用 add_flag(flag(5736))。而且您已经非常频繁地投射到 enum_flag 。

您可能想要使用 mFlag 而不是 m_flag。这是你的选择。但是当您查看 m_x*m_y-m_z*m_y-m_x*m_z 之类的代码时，根据您的字体，很容易将 _ 误认为 -。（或相反亦然。）

同样，考虑 addFlag 而不是 add_flag。对于这样的事情，这并不重要。但是当你有一个长的描述性名称时，这些下划线开始加起来，占用了行空间。然后诱惑是缩写名称，使您的代码更加迟钝。

只是我的 0.02 美元。

# flash - Easy way to pdf a web report

> ID：524030
> 
> 赞同：0
> 
> 时间：2009-02-07T16:10:13.860
> 
> 标签：flash, pdf, reporting-services, reporting

We are trying to create a web reporting system, with the standard flash chart's, one of the major requirements is that this report must be emailed to customers on a regular schedule as a PDF file.

Does anyone know of either

*   An easy tool to point at the webpage and pdf it, including flash charts
*   Another way of doing this?

We have tried sql server reporting in the past and found it to be a little slow and generally the charting is a little unpretty.

Any help is appreciated.

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-07T16:22:24.367

If your web reporting system is being built using .NET you may want to look into ABCpdf Component for .NET which can be found [here](http://www.websupergoo.com/abcpdf-1.htm). I am not sure if it works with flash charts, as at my work we use charts that are images, but give it a try.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-07T16:24:09.340

What is your envirnment like? You could try using itext or itextsharp to build PDF files. Crystal Reports is another option, but maintaining separate report files could be a pain in the ass.

# c - 如何在 C 中模拟 OO 风格的多态性？

> ID：524033
> 
> 赞同：79
> 
> 时间：2009-02-07T16:13:17.863
> 
> 标签：c, oop, polymorphism

有没有办法用`C`编程语言编写类似 OO 的代码？

* * *

也可以看看：

*   [你能用 C 写面向对象的代码吗？](https://stackoverflow.com/questions/351733/can-you-write-object-oriented-code-in-c)
*   [C中的面向对象](https://stackoverflow.com/questions/415452/object-orientation-in-c)

通过搜索“[c] oo”找到。

* * *

## 回答 #1

> 赞同：65
> 
> 时间：2009-02-07T16:27:08.477

第一个 C++ 编译器（“C with classes”）实际上会生成 C 代码，所以这绝对是可行的。

基本上，您的基类是一个结构；派生结构必须在第一个位置包含基结构，因此指向“派生”结构的指针也将是指向基结构的有效指针。

```
typedef struct {
   data member_x;
} base;

typedef struct {
   struct base;
   data member_y;
} derived;

void function_on_base(struct base * a); // here I can pass both pointers to derived and to base

void function_on_derived(struct derived * b); // here I must pass a pointer to the derived class 
```

函数可以作为函数指针作为结构的一部分，因此像 p->call(p) 这样的语法成为可能，但您仍然必须显式地将指向结构的指针传递给函数本身。

* * *

## 回答 #2

> 赞同：55
> 
> 时间：2009-02-07T16:24:29.403

常见的方法是使用指向函数的指针来定义结构。这定义了可以在任何类型上调用的“方法”。然后子类型在这个公共结构中设置自己的函数，并返回它。

例如，在linux内核中，有struct：

```
struct inode_operations {
    int (*create) (struct inode *,struct dentry *,int, struct nameidata *);
    struct dentry * (*lookup) (struct inode *,struct dentry *, 
                               struct nameidata *);
    ...
}; 
```

`create`然后，每种注册类型的文件系统都会为、`lookup`和其余功能注册自己的功能。其余代码可以使用通用 inode_operations：

```
struct inode_operations   *i_op;
i_op -> create(...); 
```

* * *

## 回答 #3

> 赞同：32
> 
> 时间：2009-02-07T16:35:58.270

C++ 与 C 相差不远。

类是具有隐藏指针的结构，该指针指向称为 VTable 的函数指针表。Vtable 本身是静态的。当类型指向具有相同结构但指针指向其他实现的 Vtable 时，您将获得多态性。

建议将调用逻辑封装在以结构体为参数的函数中，避免代码混乱。

您还应该在函数中封装结构实例化和初始化（这相当于 C++ 构造函数）和删除（C++ 中的析构函数）。无论如何，这些都是很好的做法。

```
typedef struct
{
   int (*SomeFunction)(TheClass* this, int i);
   void (*OtherFunction)(TheClass* this, char* c);
} VTable;

typedef struct
{
   VTable* pVTable;
   int member;

} TheClass; 
```

调用方法：

```
int CallSomeFunction(TheClass* this, int i)
{
  (this->pVTable->SomeFunction)(this, i);
} 
```

* * *

## 回答 #4

> 赞同：18
> 
> 时间：2012-09-24T09:05:23.043

我查看了其他人的答案并想出了这个：

```
#include <stdio.h>

typedef struct
{
    int (*get)(void* this);
    void (*set)(void* this, int i);
    int member;

} TheClass;

int Get(void* this)
{
    TheClass* This = (TheClass*)this;
    return This->member;
}

void Set(void* this, int i)
{
    TheClass* This = (TheClass*)this;
    This->member = i;
}

void init(TheClass* this)
{
    this->get = &Get;
    this->set = &Set;
}

int main(int argc, char **argv)
{
    TheClass name;
    init(&name);
    (name.set)(&name, 10);
    printf("%d\n", (name.get)(&name));
    return 0;
} 
```

我希望这能回答一些问题。

* * *

## 回答 #5

> 赞同：12
> 
> 时间：2009-02-07T22:00:15.107

[VPRI](http://vpri.org/)的 Ian Piumarta 和 Alessandro Warth的文章[Open Reusable Object Models](http://www.vpri.org/pdf/tr2006003a_objmod.pdf)的附录 B 是GNU C 中对象模型的实现，大约 140 行代码。这是一本引人入胜的读物！

*这是宏的未缓存版本，它使用 C 的 GNU 扩展（语句表达式*）向对象发送消息：

```
struct object;

typedef struct object *oop; 
typedef oop *(*method_t)(oop receiver, ...);

//...

#define send(RCV, MSG, ARGS...) ({ \ 
    oop r = (oop)(RCV); \ 
    method_t method = _bind(r, (MSG)); \ 
    method(r, ##ARGS); \ 
}) 
```

在同一个文档中，查看`object`、和结构，以及和函数。`vtable``vtable_delegated``symbol``_bind``vtable_lookup`

干杯!

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2020-08-18T17:59:56.553

我通常喜欢做的是将结构包装在另一个包含有关包装类的元信息的结构中，然后构建访问者，如作用于通用结构的函数列表。这种方法的优点是您不需要修改现有结构，并且可以为任何结构子集创建访问者。

举个通常的例子：

```
typedef struct {
    char call[7] = "MIAO!\n";
} Cat;

typedef struct {
    char call[6] = "BAU!\n";
} Dog; 
```

我们可以将这两个结构包装在这个新结构中：

```
typedef struct {
    const void * animal;
    AnimalType type;
} Animal; 
```

类型可以是简单的 int 但我们不要偷懒：

```
typedef enum  {
    ANIMAL_CAT = 0,
    ANIMAL_DOG,
    ANIMAL_COUNT
} AnimalType; 
```

有一些包装功能会很好：

```
Animal catAsAnimal(const Cat * c) {
    return (Animal){(void *)c, ANIMAL_CAT};
}

Animal dogAsAnimal(const Dog * d) {
    return (Animal){(void *)d, ANIMAL_DOG};
} 
```

现在我们可以定义我们的“访问者”：

```
void catCall ( Animal a ) {
    Cat * c = (Cat *)a.animal;
    printf(c->call);
}

void dogCall ( Animal a ) {
    Dog * d = (Dog *)a.animal;
    printf(d->call);
}

void (*animalCalls[ANIMAL_COUNT])(Animal)={&catCall, &dogCall}; 
```

那么实际使用情况将是：

```
Cat cat;
Dog dog;

Animal animals[2];
animals[0] = catAsAnimal(&cat);
animals[1] = dogAsAnimal(&dog);

for (int i = 0; i < 2; i++) {
    Animal a = animals[i];
    animalCalls[a.type](a);
} 
```

这种方法的缺点是每次要将结构用作泛型类型时都必须包装结构。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-07T16:44:13.090

文件函数 fopen、fclose、fread 是 C 中 OO 代码的示例。它们不是类中的私有数据，而是用于封装数据的 FILE 结构，C 函数充当成员类函数。 [http://www.amazon.com/File-Structures-Object-Oriented-Approach-C/dp/0201874016](https://rads.stackoverflow.com/amzn/click/com/0201874016)

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2016-04-08T22:36:15.007

```
#include <stdio.h>

typedef struct {
    int  x;
    int z;
} base;

typedef struct {
    base;
    int y;
    int x;
} derived;

void function_on_base( base * a) // here I can pass both pointers to derived and to base
{
    printf("Class base [%d]\n",a->x);
    printf("Class base [%d]\n",a->z);
}
void function_on_derived( derived * b) // here I must pass a pointer to the derived class
{
    printf("Class derived [%d]\n",b->y);
    printf("Class derived [%d]\n",b->x);
}

int main()
{
    derived d;
    base b;
    printf("Teste de poliformismo\n");

    b.x = 2;
    d.y = 1;
    b.z = 3;
    d.x = 4;
    function_on_base(&b);
    function_on_base(&d);
    function_on_derived(&b);
    function_on_derived(&d);
    return 0;
} 
```

输出是：

```
Class base [3]
Class base [1]
Class base [4]
Class derived [2]
Class derived [3]
Class derived [1]
Class derived [4] 
```

所以它有效，它是一个多态代码。

UncleZeiv 一开始就解释过。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2014-10-21T20:32:06.390

来自维基百科：在编程语言和类型论中，多态性（来自希腊语 πολύς，polys，“many, much”和 μορφή，morphē，“form, shape”）是为不同类型的实体提供单一接口。

所以我想说在 C 中实现它的唯一方法是使用可变参数和一些（半）自动类型信息管理。例如，在 C++ 中，您可以编写（对不起，琐碎）：

```
void add( int& result, int a1, int a2 );
void add( float& result, float a1, float a2 );
void add( double& result, double a1, double a2 ); 
```

在 C 中，在其他解决方案中，您能做的最好的事情是这样的：

```
int int_add( int a1, int a2 );
float float_add( float a1, fload a2 );
double double_add( double a1, double a2 );

void add( int typeinfo, void* result, ... ); 
```

然后你需要：

1.  用枚举/宏实现“typeinfo”
2.  用 stdarg.h 东西实现后一个功能
3.  告别 C 静态类型检查

我几乎可以肯定，多态性的任何其他实现都应该看起来很像这个。相反，上面的答案似乎试图解决继承而不是多态！

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2017-03-12T17:19:20.853

为了在 C 中构建 OO 功能，您可以查看以前的答案。

但是，（正如在其他问题中已经提出的那样）如果您想通过 C 语言中的示例来了解多态性是什么。也许我错了，但我想不出像 C 指针算术这样容易理解的东西。在我看来，**指针算术在 C 中本质上是多态的**。在以下示例中，相同的函数（OO 中的方法），即加法 (+)，将根据输入结构的属性产生不同的行为。

例子：

```
double a*;
char str*;

a=(double*)malloc(2*sizeof(double));
str=(char*)malloc(2*sizeof(char)); 

a=a+2; // make the pointer a, point 2*8 bytes ahead.

str=str+2; // make the pointer str, point 2*1 bytes ahead. 
```

免责声明：我是 C 的新手，非常期待得到纠正并从其他用户的评论中学习，甚至完全删除这个答案，如果它是错误的。非常感谢，

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2021-08-27T09:47:12.727

简单函数重载的一个非常粗略的例子，可以使用可变参数宏来实现。

```
#include <stdio.h>
#include <stdlib.h>

#define SCOPE_EXIT(X) __attribute__((cleanup (X)))

struct A
{
  int a;
};

struct B
{
 int a, b;
};

typedef struct A * A_id;
typedef struct B * B_id;

A_id make_A()
{
   return (A_id)malloc(sizeof(struct A));
}

void destroy_A(A_id * ptr)
{
   free(*ptr);
   *ptr = 0;
}

B_id make_B()
{
  return (B_id)malloc(sizeof(struct B));
}

void destroy_B(B_id * ptr)
{
  free(*ptr);
  *ptr = 0;
}

void print_a(A_id ptr)
{
  printf("print_a\n"); 
}
void print_b(B_id ptr)
{
  printf("print_b\n"); 
}

#define print(X) _Generic((X),\
          A_id : print_a, \
          B_id : print_b\
)(X)

int main()
{
  A_id aa SCOPE_EXIT(destroy_A) = make_A();
  print(aa);

  B_id bb SCOPE_EXIT(destroy_B) = make_B();
  print(bb);
  return 0;
} 
```

# asp.net - 以编程方式从数据库中设置图像的高度/宽度

> ID：524039
> 
> 赞同：0
> 
> 时间：2009-02-07T16:16:43.147
> 
> 标签：asp.net, asp.net-2.0

我无法始终如一地设置 img 标签的宽度和高度。img src 是从数据库中动态提取的。从数据库中提取的图像可以具有不同的宽度和高度，因此我需要设置 img 控件。有时宽度和高度设置正确，有时则不正确。我不知道为什么。任何帮助将不胜感激。谢谢！

这就是我现在正在做的事情。

```
try
    {
        byte[] byteArray = GetImage();
        using (Bitmap bmp = ByteArrayToBitmap(byteArray))
        {
            //image is the img tag.
            image.Style["width"] = bmp.Width.ToString();
            image.Style["height"] = bmp.Height.ToString();
        }
    }
    catch (Exception ex)
    { } 
```

编辑：这似乎只是 IE 中的问题。Chrome 和 Firefox 似乎运行良好。此外，如果刷新浏览器，IE7 无法以正确的高度/宽度显示图像，则它会正确显示。有时...

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-07T17:54:35.070

这是因为您需要删除标签的宽度和高度属性。简单地改变 CSS 图像的宽度和高度值是行不通的。

尝试类似的方法，这是在 Javascript 中；

```
 imageTag.removeAttribute('width');
imageTag.removeAttribute('height'); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-08T03:18:43.123

查看您的代码，我会建议另一种方法；既然您的字节数组中已经有图像的副本，为什么不让您的应用程序调整图像大小并将可预测的大小返回给客户端？您将获得不必担心不同浏览器如何调整大小并可能降低图像质量的好处。

这里的例子... [http://www.west-wind.com/Weblog/posts/283.aspx](http://www.west-wind.com/Weblog/posts/283.aspx)

# .net - .NET 还是 Mono vs Qt，哪一个适合跨平台开发？

> ID：524058
> 
> 赞同：18
> 
> 时间：2009-02-07T16:24:38.090
> 
> 标签：.net, user-interface, api, qt

好的，这是雷区，但是如果没有这两者的经验，想要理解为什么一个人会选择 .NET（或等效的 Mono）进行跨平台开发而不是其他工具包是很困难的。

对于可能同时使用这两种方法的程序员，哪些功能会被遗漏或想要？相反，在范式或其他方面，一个用户会发现另一个用户缺少什么？这两个工具包都有很多话要说，但是使用过这两个工具包的人的评论会很有价值。

以下是有关该主题的一些相关问题：

*   [GUI API](https://stackoverflow.com/questions/610/gui-programming-apis)
*   [编程挑战](https://stackoverflow.com/questions/183336/what-was-the-funnest-programming-challenge-you-were-ever-tasked-with)
*   [你用Qt吗？](https://stackoverflow.com/questions/123012/do-you-use-qt-and-why-do-you-use-it)
*   [Windows 下的 GTK 或 Qt](https://stackoverflow.com/questions/199604/gtk-or-qt-under-windows)

**编辑：** 如果 Windows 是目标平台之一，使用 Mono 是否只是一个可行的选择？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-09-10T10:03:46.620

您会选择 Mono（也许还有 C#）进行跨平台开发，原因与有人选择 Java 或 Python 的原因相同。这些语言在虚拟机上运行，​​如果您仔细选择库和设计代码，它将跨平台工作（无需重新编译）。本机语言（如 C、C++）确实有标准，因此语言在多个平台上是相同的，但您使用的编译器设置和库可能不是跨平台的（例如进程、网络等）。

除了技术问题外，熟悉跨平台框架还可以节省时间。例如，学习一个 GUI 库可能需要数周/数月。如果 API 在所有目标上都相同，您显然会节省时间。

Qt4 设计精良，文档齐全，并带有一些有用的、可靠的工具。wxWidgets 变得庞大，有几十个小部件，其中一些你永远不会使用。Qt 的小部件更少，但更灵活。我过去经常使用 wx，但由于 LGPL 许可证、良好的文档、设计器、PyQt、新的 IDE 和不断增长的用户群，我现在是 Qt 转换者。

Qt 和 wxWidgets 都有 Python 绑定（即 PyQt 和 wxPython），因此您可以使用这些库编写跨平台 GUI 代码。对于 Mono，它更棘手，但有 GTK# 和 Qyoto。我没有尝试过其中任何一个，但它们似乎已经到了足够成熟可以使用的地步（例如，参见 MonoDevelop）。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-07T18:33:14.230

对于跨平台（和独特的平台），我会选择 Qt，因为它比 Mono 和 Windows.Forms 更干净，并且使用 MVC 模式，所有应用程序都更容易扩展和修改

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-07T20:09:14.440

我正在使用 Qt4 进行跨平台开发，对此我非常满意。部署工作正常（至少如果您静态链接 Qt，这一点都不难），API*非常*好且一致，Qt Designer 允许快速开发 GUI 部分，因此可以专注于真正的逻辑。信号槽的概念也是我习惯了之后很喜欢的东西。

根据我的经验，使用 wxWidgets 部署更难（在我的情况下，由于对 GTK 的依赖，它特别是 Linux，不知道 Mac）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-07T19:47:32.987

也许您可以使用可移植语言/框架编写大部分应用程序，并为您计划支持的每个操作系统编写单独的“图形界面皮肤”？当然，这种策略在某些情况下可能效果很好，但在许多其他情况下可能会失败。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2012-12-09T08:19:55.950

这是您没有提到的另一个选项，我没有注意到这里提到，但是 [Lazarus](http://www.lazarus.freepascal.org/)是跨平台的，并且随着它的发展而变得更加成熟。当然，就像用 Qt 编写的东西一样，您必须为特定平台编译它。就我而言，我在一个运行在 Mac OSX、Linux 和 Windows 上的项目中成功地使用了 Lazarus。Lazarus 是一个很好的 RAD 工具，Object Pascal 对我写的大多数东西都适用。Lazarus 是提高应用程序速度的好选择。它与用 c/c++ 编写的软件相媲美。我不会费心支持这一点，有案例研究，如果需要，您可以自己进行测试。

我对使用 MonoDevelop 在 c# 中编码的印象是库方面的，特别是 html 和音频有点挑战性。我只玩了几个月的 c#/MonoDevelop，所以我对整个工具包还是很陌生。我猜想因为它是托管代码，所以要付出一些速度代价。同样，我认为研究表明，仅编译的代码通常比 c#/.NET 代码具有速度优势。

当然，另一种选择是 Java。我在那里做的不多，但它确实无处不在，并且运行良好，我再次希望 Java 代码会比仅编译的代码（例如 c/c++/Pascal）慢。

One other option that comes to mind which has compilers for the three main platforms is [Eiffel](http://www.eiffel.com/developers/). I haven't been doing much with it these days, but I liked it when I did play with it. ymmv

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-07T16:59:22.187

你有没有考虑过 wxWidgets。它也是跨平台的，像 QT 一样的 C++ 并且使用不像 QT 的本机控件，并且不需要任何框架来像 .NET 那样运行。

.NET 和 mono 几乎是一回事，如果您正在编写基于用户的简单应用程序而没有太多系统或网络编程，那么 .NET 应该是最好的。

如果性能是应用程序的关键方面，很多人会使用 QT、wxWidgets 等 C++ 库。

* * *

## 回答 #7

> 赞同：-2
> 
> 时间：2009-02-07T17:00:13.667

.NET 不适用于跨平台。编写代码并使其对 MONO 和 .NET 有效工作是非常痛苦的。个人使用 .NET 多于 TCL/Tk 或 Qt 或 Java Swing 的原因是快速应用程序开发。

RAD 对于现有的任何其他框架几乎都是不可能的。RAD 可以用于简单的案例，但是您最后一次编写具有简单用例的基于业务的应用程序是什么时候。

GUI 工具包通常很难使用，因为您需要了解基础知识。基础是数据绑定、剪辑、刷新、布局管理器和事件处理。所有这些概念对于普通开发人员来说都是困难的。原因是大部分内容都被更多的现代工具包抽象出来了。例如，使用 Java Swing，我不需要了解任何有关剪辑或刷新的知识，因为它们为我“神奇地”完成了它。在某些东西没有神奇地刷新的情况下会发生什么，那么这种情况就会提出一个几乎不可能的解决方案。然后代码变得指数级地复杂。

.NET 通常被许多 UI 开发人员使用，因为扩展它非常简单。创建扩展方法来扩展控件非常容易。使用 .NET 实体框架创建绑定数据的方法甚至变得更加简单。但是使用这个 RAD 工具是有代价的，那就是它不是独立于平台的。

# linq - LinqToSQl and the Member access not legal on type exception

> ID：524062
> 
> 赞同：12
> 
> 时间：2009-02-07T16:28:06.447
> 
> 标签：linq, linq-to-sql

The basic problem...

I have a method which executes the following code:

```
IList<Gig> gigs = GetGigs().WithArtist(artistId).ToList(); 
```

The GetGigs() method gets Gigs from my database via LinqToSql...

So, when GetGigs().WithArtist(artistId).ToList() is executed I get the following exception:

```
Member access 'ListenTo.Shared.DO.Artist Artist' of 'ListenTo.Shared.DO.Act' not legal on type 'System.Collections.Generic.List`1[ListenTo.Shared.DO.Act] 
```

Note that the extension function "WithArtist" looks like this:

```
 public static IQueryable<Gig> WithArtist(this IQueryable<Gig> qry, Guid artistId)
    {
        return from gig in qry
               where gig.Acts.Any(act => (null != act.Artist) && (act.Artist.ID == artistId))
               orderby gig.StartDate
               select gig;
    } 
```

If I replace the GetGigs() method with a method that constructs a collection of gigs in **code** (rather than from the DB via LinqToSQL) I do NOT get the exception.

So I'm fairly sure the problem is with my LinqToSQl code rather than the object structure.

However, I have NO IDEA why the LinqToSQl version isnt working, so I've included all the associated code below. Any help would be VERY gratefully receivced!!

The LinqToSQL code....

```
 public IQueryable<ListenTo.Shared.DO.Gig> GetGigs()
    {
        return from g in DBContext.Gigs
               let acts = GetActs(g.ID)
               join venue in DBContext.Venues on g.VenueID equals venue.ID
               select new ListenTo.Shared.DO.Gig
               {
                   ID = g.ID,
                   Name = g.Name,
                   Acts = new List<ListenTo.Shared.DO.Act>(acts),
                   Description  = g.Description,
                   StartDate    = g.Date,
                   EndDate      = g.EndDate,
                   IsDeleted    = g.IsDeleted,
                   Created      = g.Created,
                   TicketPrice  = g.TicketPrice,
                   Venue        =  new ListenTo.Shared.DO.Venue { 
                                    ID = venue.ID, 
                                    Name = venue.Name, 
                                    Address = venue.Address,
                                    Telephone = venue.Telephone,
                                    URL = venue.Website 
                   }

               };
    }

    IQueryable<ListenTo.Shared.DO.Act> GetActs()
    {
        return from a in DBContext.Acts

               join artist in DBContext.Artists on a.ArtistID equals artist.ID into art
               from artist in art.DefaultIfEmpty()

               select new ListenTo.Shared.DO.Act
               {
                    ID = a.ID,
                    Name = a.Name,
                    Artist = artist == null ? null : new Shared.DO.Artist
                    {
                       ID =  artist.ID,
                       Name = artist.Name
                    },
                    GigId = a.GigID

               };
    }

    IQueryable<ListenTo.Shared.DO.Act> GetActs(Guid gigId)
    {
        return GetActs().WithGigID(gigId);
    } 
```

I have included the code for the Act, Artist and Gig objects below:

```
public class Gig : BaseDO
{

    #region Accessors

    public Venue Venue
    {
        get;
        set; 
    }

    public System.Nullable<DateTime> EndDate
    {
        get;
        set;
    }

    public DateTime StartDate
    {
        get;
        set;
    }

    public string Name
    {
        get;
        set;
    }

    public string Description
    {
        get;
        set;
    }

    public string TicketPrice
    {
        get;
        set;
    }

    /// <summary>
    /// The Act object does not exist outside the context of the Gig, therefore,
    /// the full act object is loaded here.
    /// </summary>
    public IList<Act> Acts
    {
        get;
        set;
    }

    #endregion
}

public class Act : BaseDO
{
    public Guid GigId { get; set; }
    public string Name { get; set; }
    public Artist Artist { get; set; }
}

public class Artist : BaseDO
{
    public string Name { get; set; }
    public string Profile { get; set; }
    public DateTime Formed { get; set; }
    public Style Style { get; set; }
    public Town Town { get; set; }
    public string OfficalWebsiteURL { get; set; }
    public string ProfileAddress { get; set; }
    public string Email { get; set; }
    public ImageMetaData ProfileImage { get; set; }

}

public class BaseDO: IDO
{
    #region Properties

    private Guid _id;

    #endregion

    #region IDO Members

    public Guid ID
    {
        get
        {
            return this._id;
        }
        set
        {
            this._id = value;
        }
    }

} 
```

}

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-08T10:46:28.617

I think the problem is the 'let' statement in GetGigs. Using 'let' means that you define a part of the final query separately from the main set to fetch. the problem is that 'let', if it's not a scalar, results in a nested query. Nested queries are not really Linq to sql's strongest point as they're executed deferred as well. In your query, you place the results of the nested query into the projection of the main set to return which is then further appended with linq operators.

When THAT happens, the nested query is buried deeper into the query which will be executed, and this leads to a situation where the nested query isn't in the outer projection of the query to execute and thus has to be merged into the SQL query ran onto the DB. This is not doable, as it's a nested query in a projection nested inside the main sql query and SQL doesn't have a concept like 'nested query in a projection', as you can't fetch a set of elements inside a projection in SQL, only scalars.

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2010-10-26T16:01:38.053

我有同样的问题，似乎对我有用的是分离出一个返回 IQueryable<> 的内联静态方法调用，以便我将这个延迟查询存储到一个变量中并引用它。

我认为这是 Linq to SQL 中的一个错误，但至少有一个合理的解决方法。我还没有对此进行测试，但我的假设是，只有在查询表达式中引用不同类的静态方法时才会出现此问题，而不管该函数的返回类型是否为 IQueryable<>。所以也许它是持有问题根源的方法的类。就像我说的，我无法证实这一点，但可能值得调查。

**更新：**以防万一解决方案不清楚，我想在原始帖子中的示例上下文中指出它。

```
public IQueryable<ListenTo.Shared.DO.Gig> GetGigs()
{
    var acts = GetActs(g.ID); // Don't worry this call is deferred

    return from g in DBContext.Gigs
           join venue in DBContext.Venues on g.VenueID equals venue.ID
           select new ListenTo.Shared.DO.Gig
           {
               ID = g.ID,
               Name = g.Name,
               Acts = new List<ListenTo.Shared.DO.Act>(acts),
               Description  = g.Description,
               StartDate    = g.Date,
               EndDate      = g.EndDate,
               IsDeleted    = g.IsDeleted,
               Created      = g.Created,
               TicketPrice  = g.TicketPrice,
               Venue        =  new ListenTo.Shared.DO.Venue { 
                                ID = venue.ID, 
                                Name = venue.Name, 
                                Address = venue.Address,
                                Telephone = venue.Telephone,
                                URL = venue.Website 
               }

           };
} 
```

请注意，虽然这应该可以纠正手头的问题，但似乎还有另一个问题，即在投影的每个元素中都在访问延迟的行为查询，我猜这会导致向数据库中的每行发出单独的查询外投影。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-07T16:48:53.613

我在你的类中看不到任何东西来表明 LINQ to SQL 是如何计算出哪一列是哪一列等等。

您希望该`WithArtist`方法在 .NET 中执行，还是转换为 SQL？如果您希望将其转换为 SQL，则需要使用适当的 LINQ to SQL 属性装饰您的 Gig 类（或以其他方式配置您的数据上下文）。如果您希望它在代码中执行，只需将第一个参数类型从 更改`IQueryable<Gig>`为`IEnumerable<Gig>`。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2021-07-16T11:16:14.373

我发现这样的问题（我最近也遇到过）可以解决，如果将 IQueryable（或 Table）变量`Gigs`转换为这样的列表

```
return from g in DBContext.Gigs.ToList()
... 
```

如果这仍然不起作用，请对所有 IQueryables 执行相同的操作。在我看来，背后的原因是某些查询太复杂而无法翻译成 SQL。但是如果你将它“具体化”成一个列表，你就可以进行各种查询。

请注意，您应该尽早添加“过滤器”（where 条件），因为过多的内存消耗可能会成为问题。

# database - 使用 Linq 向 DB 发布多个帖子

> ID：524066
> 
> 赞同：0
> 
> 时间：2009-02-07T16:30:04.837
> 
> 标签：database, linq, pooling

如果我有两千个网络用户，每个用户同时通过网站向 sqldb 提交相同的表，linq 会毫无问题地处理这个问题吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-07T16:51:27.880

假设您在每个请求中创建一个新的数据上下文，它将像处理任何其他方法一样处理它。如果你真的有两千个并发请求，我不相信它们*实际上*会同时得到服务 - 假设你以正常方式使用 ASP.NET，我怀疑你会用完线程无论如何，线程池。

你预计会遇到什么样的问题？显然会有正常的数据库并发问题需要解决——处理并发更新等。LINQ to SQL 使得检测和处理这些问题变得相对容易，但我强烈建议您获得一本合适的书来指导您完成整个过程。

# python - Insert Command into Bash Shell

> ID：524068
> 
> 赞同：1
> 
> 时间：2009-02-07T16:30:31.217
> 
> 标签：python, linux, bash, shell, command

Is there any way to inject a command into a bash prompt in Linux? I am working on a command history app - like the Ctrl+R lookup but different. I am using python for this.

I will show a list of commands from history based on the user's search term - if the user presses enter, the app will execute the command and print the results. So far, so good.

If the user chooses a command and then press the right or left key, I want to insert the command into the prompt - so that the user can edit the command before executing it.

If you are on Linux, just fire up a bash console, press Ctrl+r, type cd(or something), and then press the right arrow key - the selected command will be shown at the prompt. This is the functionality I am looking for - but I want to know how to do that from within python.

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-11T17:55:56.527

如果我理解正确，您希望历史行为类似于 python 应用程序中的 bash。如果这是您想要的，那么[GNU Readline 库](http://en.wikipedia.org/wiki/GNU_readline)就是您要走的路。

有一个 python 包装器[GNU readline 接口](http://docs.python.org/library/readline.html)，但它只在 Unix 上运行。 [readline.py](http://newcenturycomputers.net/projects/readline.html)似乎是 Windows 的版本，但我从未尝试过。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-07T16:50:09.427

您可以这样做，但前提是 shell 作为 Python 程序的子进程运行；您不能将内容输入父进程的标准输入。（如果可以的话，当人们以低于调用 shell 的权限运行进程时，UNIX 会出现许多相关的安全问题！）

如果您熟悉[Expect](http://expect.nist.gov/)如何允许传递到交互式子进程（使用来自用户的特定键序列或从子进程接收的字符串触发匹配并将控制发送回您的程序），则可以使用 Python 使用[pexpect](http://www.noah.org/wiki/Pexpect)完成相同的操作。或者，正如另一篇文章所提到的，[curses](http://docs.python.org/library/curses.html)模块提供了对终端显示绘制的完全控制——如果这个历史菜单发生在窗口内而不是图形 (X11/win32) 弹出窗口中，您将需要它。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-11T17:32:30.373

请参阅[readline](http://docs.python.org/library/readline.html)模块。它实现了所有这些功能。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-07T16:42:45.700

恕我直言，带有[python端口的](http://docs.python.org/library/curses.html "蟒蛇端口")[ncurses](http://www.gnu.org/software/ncurses/ncurses.html "诅咒")是一种方法。

# visual-studio - 在 Visual Studio 2008 中使用 Ironscheme

> ID：524070
> 
> 赞同：4
> 
> 时间：2009-02-07T16:31:44.503
> 
> 标签：visual-studio, scheme, ironscheme

虽然 IronScheme codeplex 网站上说 Visual Studio 包含一个插件，但我不知道如何让 Ironscheme 与 VS 一起工作......

可能吗？如果是这样，如何？

谢谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-19T05:40:46.053

首先，你肯定需要 Visual Studio 2008 SP1，没有 SP1 会[出问题](http://ironscheme.codeplex.com/Thread/View.aspx?ThreadId=50805)。

其次，按照[visual-studio.txt](https://ironscheme.svn.codeplex.com/svn/IronScheme/IronScheme.Console/docs/visual-studio.txt)文件中的说明进行操作。

从命令行运行：

1.  如果是管理员：RegPkg /codebase <IronScheme.VisualStudio.dll 的绝对路径>

2.  如果不是管理员：RegPkg /ranu /codebase <IronScheme.VisualStudio.dll 的绝对路径>

3.  开发环境/设置

现在启动 VS，并打开一个扩展名为 'ss' 或 'sls' 或 'scm' 的文件。

干杯

雷比

# asp.net - EventValidation - 少数请求中缺少 __EventValidation 值

> ID：524072
> 
> 赞同：0
> 
> 时间：2009-02-07T16:32:36.873
> 
> 标签：asp.net, event-validation

我们在更新面板中有一个文本框，它在文本更改时回发。对服务器的 1000 个 POST 请求中大约有 1 个缺少 __EventValidation 表单元素（我们使用日志验证，当发生此异常时，请求缺少此表单元素）

由于这种情况并非始终如一，因此我们排除了任何编码问题。我们怀疑用户甚至在表单完全加载之前就发布了表单。

* * *

问题：如果我们没有通过覆盖 Render 方法来执行任何 Response.Flush，是否可以将此 __EventValidation 元素移动到表单的顶部而不是底部？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-11T20:19:31.257

看起来 .NET 2.0 SP2 已修复此问题。

[http://blogs.msdn.com/tom/archive/2008/03/14/validation-of-viewstate-mac-failed-error.aspx#8970568](http://blogs.msdn.com/tom/archive/2008/03/14/validation-of-viewstate-mac-failed-error.aspx#8970568)

# c# - 延迟加载 - 最好的方法是什么？

> ID：524075
> 
> 赞同：14
> 
> 时间：2009-02-07T16:33:48.027
> 
> 标签：c#, architecture, coding-style, lazy-loading, methodology

我见过很多延迟加载的例子——你的选择是什么？

给定一个模型类，例如：

```
public class Person
{
    private IList<Child> _children;
    public IList<Child> Children
    {
        get {
            if (_children == null)
                LoadChildren();
            return _children;
        }
    }
} 
```

Person 类不应该知道它的孩子是如何加载的……还是应该知道？当然，它应该控制何时填充属性？

您是否有一个将 Person 与其子集合耦合在一起的存储库，或者您是否会使用不同的方法，例如使用[延迟加载](https://stackoverflow.com/questions/375881/lazy-loading-and-lazy-execution-patterns)类 - 即使这样，我也不希望延迟加载类在我的模型架构中模糊。

如果首先请求一个人然后是它的子项（即在此实例中不是延迟加载）或以某种方式延迟加载，您将如何处理性能。

这一切都归结为个人选择吗？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-02-07T16:47:32.647

最好的延迟加载是避免它；）线程安全是您必须处理的直接问题。我不知道我有多少次看到具有 8 个 cpu 内核的生产系统对使用的*每个*延迟加载模式运行 8 次延迟加载。至少在服务器启动时，所有服务器内核都倾向于在同一个地方结束。

如果可以的话，让一个 DI 框架为您构建它。如果你不能，我仍然更喜欢显式构造。所以各种AOP魔法根本不跟我切，去类外显式构造吧。不要将它放在 person 类中，只需创建一个以正确方式构造对象的服务。

引入或多或少透明地做这些事情的“魔法”层*似乎*是一个好主意，但我还没有遇到没有不可预见和有问题的后果的实现。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-07T17:14:36.320

您可以使用`Lazy<T>`我在这里谈到的类： [为延迟加载注入数据访问依赖项的正确方法是什么？](https://stackoverflow.com/questions/130292/what-is-the-proper-way-to-inject-a-data-access-dependency-for-lazy-loading/522547#522547)

那里还有更详细的博客文章的链接...

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-07T17:01:10.030

[我在这里](https://stackoverflow.com/questions/130292/what-is-the-proper-way-to-inject-a-data-access-dependency-for-lazy-loading/131059#131059)谈到了我用来完成延迟加载的解决方案

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-07T17:35:19.167

您可以使用[虚拟代理](http://en.wikipedia.org/wiki/Lazy_loading#Virtual_proxy)模式以及[观察者模式](http://en.wikipedia.org/wiki/Observer_pattern)。这会给你延迟加载，而 Person 类没有关于如何加载 Children 的明确知识。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-07T16:39:57.797

我认为这*正是*AOP（例如PostSharp）最好处理的问题。将您的延迟加载作为一个方面，然后使用它来装饰您想要延迟加载的任何属性。免责声明：没试过；只是认为它*应该*工作。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-18T02:56:44.040

[我刚刚在这里](https://stackoverflow.com/questions/652195/is-a-lock-required-with-a-lazy-initialization-on-a-deeply-immutable-type)问了一个相关的问题，但它在不变性和线程安全方面更重要。很多很好的答案和评论。您可能会发现它很有用。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2014-01-31T02:01:02.007

这是一个使用代理模式实现延迟加载的示例

将与您的其余模型一起使用的 Person 类。Children 被标记为虚拟，因此可以在 PersonProxy 类中覆盖它。

```
public class Person {
    public int Id;
    public virtual IList<Child> Children { get; set; }
} 
```

将与您的其他存储库一起使用的 PersonRepository 类。我在这个类中包含了获取孩子的方法，但如果你愿意，你可以在 ChildRepository 类中使​​用它。

```
public class PersonRepository {
    public Person FindById(int id) {
        // Notice we are creating PersonProxy and not Person
        Person person = new PersonProxy();

        // Set person properties based on data from the database

        return person;
    }

    public IList<Child> GetChildrenForPerson(int personId) {
        // Return your list of children from the database
    }
} 
```

与您的存储库一起使用的 PersonProxy 类。这继承自 Person 并将执行延迟加载。您还可以使用布尔值来检查它是否已经加载，而不是检查 Children == null。

```
public class PersonProxy : Person {
    private PersonRepository _personRepository = new PersonRepository();

    public override IList<Child> Children {
        get {
            if (base.Children == null)
                base.Children = _personRepository.GetChildrenForPerson(this.Id);

            return base.Children;
        }
        set { base.Children = value; }
    }
} 
```

你可以像这样使用它

```
Person person = new PersonRepository().FindById(1);
Console.WriteLine(person.Children.Count); 
```

当然，如果您不想直接调用 PersonRepository，您可以让 PersonProxy 接收到 PersonRepository 的接口并通过服务访问它。

# iphone - iPhone开发 - 从用户位置定位地址

> ID：524077
> 
> 赞同：2
> 
> 时间：2009-02-07T16:35:58.567
> 
> 标签：iphone, core-location

是否可以使用 CoreLocation 框架获取用户当前所在的街道/区域？那么如果我得到用户的经纬度位置，我可以从那个位置得到地址（xx 街道，yy 城市，z 州）吗？

谢谢。

***之前已经有人发过这个问题了。刚刚发现[在纬度/经度对获取街道地址](https://stackoverflow.com/questions/158557/get-street-address-at-lat-long-pair)***

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-07T16:38:43.523

您需要的是反向地理编码服务，它将纬度/经度坐标集转换为地址。我怀疑 CoreLocation 是否包含此功能或访问权限。

您可以查看第三方提供商，例如 Google 地图：

[http://nicogoeminne.googlepages.com/documentation.html](http://nicogoeminne.googlepages.com/documentation.html)

还有其他解决方法可能会让您接近。例如，通过使用 Multimap 的路由 API，如下所述：

[http://forums.multimap.com/viewtopic.php?f=1&t=51](http://forums.multimap.com/viewtopic.php?f=1&t=51)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-09T00:22:34.263

同意 - 您需要反向地理编码服务 - 这不包含在核心位置中。这里有一个相当完整的反向地理编码器列表[链接文本](http://groups.google.com/group/Google-Maps-API/web/resources-non-google-geocoders)

# java - 创建 Java CLASSPATH 的 BAT 文件

> ID：524081
> 
> 赞同：39
> 
> 时间：2009-02-07T16:36:37.520
> 
> 标签：java, windows, command-line, batch-file

我想在 Windows 上分发一个用 Java 编写的命令行应用程序。

我的应用程序以 zip 文件的形式分发，其中有一个 lib 目录条目，其中包含调用我的主类所需的 .jar 文件。目前，对于 Unix 环境，我有一个 shell 脚本，它使用通过附加 lib 目录中的所有文件创建的 CLASSPATH 调用 java 命令。

如何编写具有类似功能的 .BAT 文件？在 Windows 世界中 find Unix 命令的等价物是什么？

* * *

## 回答 #1

> 赞同：65
> 
> 时间：2009-02-07T20:16:20.493

您想在批处理脚本中使用 for 循环

```
 @echo off
 setLocal EnableDelayedExpansion
 set CLASSPATH="
 for /R ./lib %%a in (*.jar) do (
   set CLASSPATH=!CLASSPATH!;%%a
 )
 set CLASSPATH=!CLASSPATH!"
 echo !CLASSPATH! 
```

当我正在寻找一个批处理脚本来遍历目录中的所有文件时，这真的帮助了我，它是关于删除文件的，但它非常有用。

[删除空目录的一行批处理脚本](http://blogs.msdn.com/oldnewthing/archive/2008/04/17/8399914.aspx)

老实说，尽管使用 Jon 的答案，如果所有文件都在一个目录中会更好，但这可能会在其他时间帮助你。

* * *

## 回答 #2

> 赞同：29
> 
> 时间：2009-02-07T16:44:50.967

为什么要使用查找？大概你提前知道了你的 jar 文件需要的所有库，那么为什么不直接列出它们呢？

或者，您可以始终使用`-Djava.ext.dirs=lib`并让它以这种方式接收所有内容。

* * *

## 回答 #3

> 赞同：18
> 
> 时间：2009-02-07T19:46:39.900

从 6.0 开始，Java 支持通配符类路径。

[Java 命令行类路径语法](http://java.sun.com/javase/6/docs/technotes/tools/windows/classpath.html)

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2010-02-19T21:28:08.857

如果您希望 CLASSPATH 设置保留在脚本之外并且您没有使用 /V 启动 shell，则可以执行以下操作：

```
@echo off
FOR /R ./lib %%a in (*.jar) DO CALL :AddToPath %%a
ECHO %CLASSPATH%
GOTO :EOF

:AddToPath
SET CLASSPATH=%1;%CLASSPATH%
GOTO :EOF 
```

当您只是在命令行上玩耍时，对于设置您的环境很有用。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-02-07T17:13:24.060

听起来像一个[可执行的 JAR](http://neptune.netcomp.monash.edu.au/javahelp/howto/jar.htm)可以为你工作。如果您要分发包含您的主要例程所需的所有 JAR 的 ZIP，并且您确实在命令 shell 中执行它，那么也许您可以使用清单中定义的 Main-Class 和 Classpath 创建一个可执行 JAR。您的用户所要做的就是双击 JAR 并且 Bob 是您的叔叔。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2011-06-29T14:50:57.107

```
SET CLASSPATH=""
FOR /R /lib %%a in (*.jar) DO CALL :AddToPath %%a
echo %CLASSPATH%

java -cp %CLASSPATH% com.a.b.MyClass

pause

:AddToPath
SET CLASSPATH=%1;%CLASSPATH%
GOTO :EOF 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-07T18:38:35.963

当我发布适用于 Windows/Linux 的命令行 JAR 时，我所做的是使用 ANT 命令将所有 JAR 库嵌入到我的 JAR 中：

```
 <fileset dir="${module.classes.dir}"/>
       <zipfileset src="${endorsed.lib.dir}/myLibrary.jar"/> 
```

通过这种方式，库与您的类文件融为一体。

这不是二进制可重用性的最佳方式，但如果库不是那么重，您只需在任何操作系统中调用 java -jar myApp.jar 即可执行您的应用程序。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2010-03-16T14:31:15.893

如果您使用 Maven 来构建您的项目，您可能会使用一些不同的方式。Application Assembler Maven Plugin 用于创建 Java 应用程序启动器。该插件为您生成bat文件启动器并将依赖项放在指定文件夹中。或者，您的启动器能够将您的应用程序注册为服务\恶魔。

[这是一个关于使用它的话题](http://blog.xebia.com/2009/11/22/maven-appassembler-plugin-dealing-with-long-classpath-on-windows)

此插件有助于保持项目的 CM 部分干燥。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2016-08-30T14:26:10.210

> 有没有更简单的方法来做到这一点？

**是的;**

从版本 6 开始，您可以使用类路径通配符。

```
javac -cp .;../lib/* yourJavaCodeDir/YourJavaFile.java 
```

另请参阅此相关[问答。](https://stackoverflow.com/q/1064481/230513)

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2017-04-03T13:42:24.653

使事情可移植的一个选项是设置类路径相对于批处理文件本身的位置。

在 Windows 中（假设 Java 6+，./bin 中的类，./lib 中的 jars）：

```
@java -classpath %~dp0/bin;%~dp0/lib/* ClassName %1 
```

# windows - 生产代码中的工作流

> ID：524084
> 
> 赞同：5
> 
> 时间：2009-02-07T16:37:37.690
> 
> 标签：windows, workflow, workflow-foundation

嗨，我想知道你们中有多少人在生产环境中使用过 Workflow，这是个好主意吗？我的意思是我们可以使用 DB 和调度程序服务创建相同的东西

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-12T19:08:17.387

我们在生产环境中使用 WF。我们有 6 种不同的工作流程可以运行。这些分为 3 个状态机和 3 个序列。在某些情况下我会再次使用它，但在其他情况下我不会。我会声称工作流的状态机部分很快就完成了，我不确定它是整个设计过程中工作流的核心部分。

在将它们发送给供应商之前，我会再次将工作流程用于报价或转换等短期运行流程。

对于长时间运行的状态机，我不想再做一次 - 主要是因为没有内置的 WF 升级过程，所以我们最终编写了自己的。还有很多概念可以让您了解（在我们的开发团队中被称为吉普赛诅咒）。

我也会稍微担心性能：我们的应用服务器目前正在完全运行（好的，我现在正在重新启动 8000 个工作流）。如果您使用（.NET 3.5）发送和接收活动将其直接集成到 WCF 中，这尤其是一个问题 - 您必须设置一些适当的疯狂配置设置以允许它一次运行多个工作流。

无论如何，正如我所说：它很有用，我会再次使用它，但不会用于另一个状态机。

另请参阅[请确认：Windows Workflow Foundation 现在是否值得支持？](https://stackoverflow.com/questions/339666/please-confirm-is-windows-workflow-foundation-a-good-horse-to-be-backing-right-n/356909#356909)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-07T16:43:50.113

我们使用 Sharepoint，它使用 WF 进行工作流程。它工作得很好，而且很容易定制。如果您需要高级工作流程，WF 可以支持它，但需要一些培训来了解细节。

您可以推出自己的工作流程，但为什么要重新发明轮子？WF 内置于 .NET 3.0+ 框架中并且非常强大，因此您不妨利用它。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-06-26T10:46:46.720

大多数人都说工作流的所有优点，但我观察到它们引入了不必要的代码复杂性和维护问题。它们适用于特定类别的问题。除此之外，他们需要大量的代码管道和维护噩梦。

# .net - ASP.NET MVC 中的用户身份验证和授权

> ID：524086
> 
> 赞同：60
> 
> 时间：2009-02-07T16:38:23.930
> 
> 标签：.net, asp.net-mvc, authentication, authorization

ASP.NET MVC 中用户授权/身份验证的最佳方法是什么？

我看到实际上有两种方法：

*   使用内置的 ASP.NET 授权系统。
*   使用带有我自己的用户、权限、用户组表等的自定义系统。

我更喜欢第二种选择，因为 User 是我的域模型的一部分（而且我对ASP.NET 的内置内容的经验**为零），但我真的很想听听人们在这个领域所做的事情。**

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2009-02-07T16:42:36.387

实际上还有第三种方法。asp.net 成员资格功能基于提供者模型。您可以编写自定义提供程序，从而能够为数据的存储方式提供您自己的实现，同时保留 asp.net 成员资格的大部分好处。

关于该主题的一些文章：

[http://msdn.microsoft.com/en-us/library/f1kyba5e.aspx](http://msdn.microsoft.com/en-us/library/f1kyba5e.aspx)

[http://www.asp.net/learn/videos/video-189.aspx](http://www.asp.net/learn/videos/video-189.aspx)

[http://www.15seconds.com/issue/050216.htm](http://www.15seconds.com/issue/050216.htm)

[http://davidhayden.com/blog/dave/archive/2007/10/11/CreateCustomMembershipProviderASPNETWebsiteSecurity.aspx](http://davidhayden.com/blog/dave/archive/2007/10/11/CreateCustomMembershipProviderASPNETWebsiteSecurity.aspx)

* * *

## 回答 #2

> 赞同：25
> 
> 时间：2009-02-07T23:13:46.470

随风而去。MembershipProvider 对我的口味来说太重了。是的，可以以一种简化的方式实现它，但是你会闻到 NotSupportedException 或 NotImplementedException 的[味道很糟糕。](http://en.wikipedia.org/wiki/Liskov_substitution_principle)

通过完全自定义的实现，您仍然可以使用 IPrincipal、IIdentity 和 FormsAuth。你自己的登录页面到底有多难？

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2011-04-14T13:21:30.103

The easiest way is to use asp.net user names as role names. You can write your own authorizarion attribute to handle authorization:

```
public class CustomAuthorizationAttribute:AuthorizeAttribute
{
    public CustomAuthorizationAttribute():base()
    {
        Users = "registereduser";
    }
    protected override bool AuthorizeCore(HttpContextBase httpContext)
    {
        //You must check if the user has logged in and return true if he did that.
        return (bool)(httpContext.Session["started"]??false); 

    }
    protected override void HandleUnauthorizedRequest(AuthorizationContext filterContext)
    {
        filterContext.HttpContext.Response.Redirect("SessionManagement/Index/?returningURL=" + 
            filterContext.HttpContext.Server.UrlEncode(filterContext.HttpContext.Request.Url.ToString()));

    }

} 
```

The code must handle the AuthorizeCore to return true if the user has started the session, and HandleUnauthorizedRequest to redirect the user to the login page (optionaly you can attach the returning url).

In then controller methods that need authorization, set the attribute over them:

```
public class SecretPageController {
    [CustomAuthorizationAttribute]
    ActionResult Index() {
        //Method that requires authorization
        return View();
    }

} 
```

Also set the authorization method to "Forms" in the web config.

Web.config:

```
 <authentication>
      <forms timeout="120"></forms>
  </authentication> 
```

Controller:

```
public SessionManagementController:Controller {
    public ActionResult Index(string returningURL)
    {
        return View("Index", new SessionModel() { ReturningURL = returningURL});
    }
    [HttpPost]        
    public ActionResult Index(SessionModel mod)
    {
        if (UserAuthenticated(mod.UserName, mod.Password))
        {
            FormsAuthentication.SetAuthCookie("registereduser", false);
            if (mod.UrlRetorno != null)
            {
                return Redirect(mod.ReturningURL);                    
            }
            return RedirectToAction("Index", "StartPage");
        }
        mod.Error = "Wrong User Name or Password";
        return View(mod);
    }
    bool UserAuthenticated(string userName, string password) {
       //Write here the authentication code (it can be from a database, predefined users,, etc)
        return true;
    }

    public ActionResult FinishSession()
    {
        HttpContext.Session.Clear();//Clear the session information
        FormsAuthentication.SignOut();
        return View(new NotificacionModel() { Message = "Session Finished", URL = Request.Url.ToString() });
    }

} 
```

In the Controller, when the user enters its user name and password, set the forms authentication cookie to TRUE (FormsAuthentication.SetAuthCookie("registereduser",true)), signaling the user name (registereduser in the example) to be authenticathed. Then the user signs out, tell ASP.NET to do so calling FormsAuthentication.SignOut().

Model:

```
class SessionModel {
    public string UserName {get;set;}
    public string Password {get;set;}
    public string Error {get;set;}
} 
```

Use a model to store the user data.

View (that presents the SessionModel type):

```
 <div class="editor-label">
            <%: Html.LabelFor(model => model.UserName) %>
        </div>
        <div class="editor-field">
            <%: Html.TextBoxFor(model => model.UserName) %>
            <%: Html.ValidationMessageFor(model => model.UserName) %>
        </div>

        <div class="editor-label">
            <%: Html.LabelFor(model => model.Password) %>
        </div>
        <div class="editor-field">
            <%: Html.TextBoxFor(model => model.Password) %>
            <%: Html.ValidationMessageFor(model => model.Password) %>
        </div>
        <div class="field-validation-error"><%:Model==null?"":Model.Error??"" %></div>
        <%:Html.HiddenFor(model=>model.ReturningURL) %>
        <input type="submit" value="Log In" /> 
```

Use a view to get the data. In this example, there is a hidden field to store the returning URL

I hope this helps (I had to translate the code, so I'm not sure if it is 100% correct).

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-02-09T15:20:38.583

Yet another approach is to use ASP.NET membership for authentication, link your User class to ASP.NET members, and use your User class for more granular permissions. We do this, because it allows changing authentication providers very easily, while still retaining the ability to have a complex permission system.

In general, it's worth remembering that authentication/identity and storing permissions are not necessarily the same problem.

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-02-07T06:01:28.713

You may be interested in RPX for a free API to authenticate your users

[http://blog.maartenballiauw.be/post/2009/07/27/Authenticating-users-with-RPXNow-(in-ASPNET-MVC).aspx](http://blog.maartenballiauw.be/post/2009/07/27/Authenticating-users-with-RPXNow-(in-ASPNET-MVC).aspx)

Try the **ASP.Net MVC Membership Starter Kit** for an administrative API

**Screenshots**

[http://www.squaredroot.com/2009/08/07/mvcmembership-release-1-0/](http://www.squaredroot.com/2009/08/07/mvcmembership-release-1-0/)

**Old locations changesets (historic)**

[http://mvcmembership.codeplex.com/SourceControl/list/changesets](http://mvcmembership.codeplex.com/SourceControl/list/changesets)

**New Location:**

[http://github.com/TroyGoode/MembershipStarterKit](http://github.com/TroyGoode/MembershipStarterKit)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2013-11-20T16:41:23.153

This is a forth approach. Using the [web matrix security classes](http://msdn.microsoft.com/en-us/library/webmatrix.webdata.simplemembershipprovider%28v=vs.111%29.aspx) you can use simple membership provider which can use EF so users and roles can be part of your domain model but also part of the IPrincipal and IIdentity MVC helpers.

I have created an [example Github project](https://github.com/ACassells/SimpleAuth) to see how this can be used with automated self registration and email signup / password reset and the like.

# silverlight - 带有自定义面板的 Silverlight 2 ListBox 不会尊重 ArrangeOverride 的大小

> ID：524099
> 
> 赞同：1
> 
> 时间：2009-02-07T16:46:55.533
> 
> 标签：silverlight, listbox

如果我使用自定义面板来布局我的 ListBoxItems，ListBox 不会尊重它们的组合高度（尽管它确实尊重它们的组合宽度） - 即使我的 ArrangeOverride 返回一个围绕所有项目的大小。

明确设置 ListBox 的高度可以使一切正常，但我希望它自己解决这个问题！

有没有人见过这个？

谢谢

**更新：**在下面的示例中，ListBox 使用了一个自定义面板，该面板根据 Row 属性垂直堆叠文章，并返回足够大的大小以包围所有文章。但除非我为 ListBox 设置高度，否则它会崩溃！

```
<UserControl x:Class="SilverlightApplication1.Page"
xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation" 
xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml" 
xmlns:local="clr-namespace:SilverlightApplication1">
<UserControl.Resources>
    <DataTemplate x:Key="ArticleTemplate">
        <TextBlock Text="{Binding Title}" />
    </DataTemplate>
</UserControl.Resources>
<ListBox Height="200"
        Background="AntiqueWhite"
        ItemTemplate="{StaticResource ArticleTemplate}"
        ItemsSource="{Binding}" VerticalAlignment="Top"
        Margin="0,0,0,0">
    <ListBox.ItemsPanel>
        <ItemsPanelTemplate>
            <local:MyPanel />
        </ItemsPanelTemplate>
    </ListBox.ItemsPanel>
</ListBox>
</UserControl> 
```

这是面板：

```
public class MyPanel : Panel
{
    protected override Size ArrangeOverride(Size arrangeSize)
    {
        double width = 0, height = 0;
        foreach (UIElement child in this.Children)
        {
            var article = (Article)((ContentControl)child).DataContext;
            var y = child.DesiredSize.Height * article.Row;
            var location = new Point(0, y);
            var rect = new Rect(location, child.DesiredSize);
            child.Arrange(rect);
            width = Math.Max(width, child.DesiredSize.Width);
            height = Math.Max(height, y + child.DesiredSize.Height);
        }

        return new Size(width, height);
    }

    protected override Size MeasureOverride(Size availableSize)
    {
        foreach (UIElement child in this.Children)
        {
            if (child != null)
            {
                child.Measure(new Size(double.PositiveInfinity, double.PositiveInfinity));
            }
        }

        return new Size();
    }
} 
```

和域类：

```
public class Article
{
    private readonly int row;
    private readonly string title;

    public Article(string title, int row)
    {
        this.title = title;
        this.row = row;
    }

    public int Row { get { return this.row; } }

    public string Title { get { return this.title; } }
} 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-08T00:57:51.893

我无法重现您描述的问题。您能否提供一些示例代码/xaml 以便我看一下？

更新：

我相信这里的问题是您从 MeasureOverride 返回 (0,0) 作为面板的 DesiredSize。您可能想要执行以下操作：

```
 protected override Size MeasureOverride(Size availableSize)
    {
        double width = 0;
        double height = 0;
        foreach (UIElement child in this.Children)
        {
            if (child != null)
            {
                child.Measure(new Size(double.PositiveInfinity, double.PositiveInfinity));
                width = Math.Max(width, child.DesiredSize.Width);
                height = Math.Max(height, child.DesiredSize.Height);
            }
        }

        return new Size(width, height);
    } 
```

根据您的要求，实际的大小调整逻辑可能会有所不同。

您的代码中发生的情况是，通过从 MeasureOverride 返回 (0,0)，您的 Panel 本质上是在“询问”其父级为其保留该空间量。因此，当涉及到布局周期的 Arrange 阶段时，传递给 ArrangeOverride 的 finalSize 非常小（至少在一维中为 0）。您可以通过在 ArrangeOverride 中设置断点然后检查 finalSize 参数来验证这一点。为了让您的代码与布局系统一起正常工作，您需要从 MeasureOverride 返回您的 Panel 需要包含其子项的最小空间量。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-09T02:03:16.673

不要忘记 ListBoxes 包含 ScrollViewers。ScrollViewer 可能正在查看其子项的高度并认为“很好，我可以处理”，然后设置自己的大小。

尝试设置

```
ScrollViewer.VerticalScrollBarVisibility = "Hidden" 
```

或者

```
ScrollViewer.VerticalScrollBarVisibility = "Disabled" 
```

在您的 ListBox 中，看看会发生什么。

# .net - 使服务器上的所有应用程序都使用 SQL 会话管理器

> ID：524103
> 
> 赞同：0
> 
> 时间：2009-02-07T16:48:58.730
> 
> 标签：.net, sql-server, session, web-config, app-config

有没有办法让服务器上的所有应用程序都使用 SQL Server 作为会话管理器？

原因是我们有一个包含数百个应用程序的服务器，我们希望开始对服务器进行负载平衡，但是将每个单独的应用程序配置为使用 SQL Server 作为会话管理器会很麻烦。如果用户忘记将其设置为 SQL 会话管理器，它还将在部署应用程序时防止人为错误。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-07T16:52:55.413

您可以在 \Microsoft.NET\Framework\v2.0.50727\CONFIG\web.config 中指定 SQLServer 会话管理器

# html - wishfi如何在加载页面上注入代码

> ID：524109
> 
> 赞同：1
> 
> 时间：2009-02-07T16:53:37.363
> 
> 标签：html

有人知道wishfi如何将广告代码注入加载页面吗？

[愿望飞](http://www.wishfi.com)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-07T18:10:36.473

好吧，我花了一段时间才弄清楚你的问题是什么。答案很简单，他们作弊。恕我直言，这实际上是非常可怕的东西。但是，为了做到这一点，网络提供商，无论是 ISP（非常糟糕）还是 WiFi 热点提供商等都会购买此网关设备。它通过固件做到这一点。现在，很容易想象这将如何通过固件完成。您所要做的就是拦截传入的 HTTP 流，查看它是否来自您要破坏的站点（是的，破坏），然后修改流（即插入 HTML 等），然后将其发送回下游。

[http://www.arcticstartup.com/2008/12/02/wishfi-deliveres-messages-into-the-browser/](http://www.arcticstartup.com/2008/12/02/wishfi-deliveres-messages-into-the-browser/)

# sql - 如何加快应用程序连接到 MS SQL Server 的速度？

> ID：524118
> 
> 赞同：1
> 
> 时间：2009-02-07T17:00:12.293
> 
> 标签：sql, sql-server, delphi

我有一个在 SQL Server 2000 上运行的 Delphi 应用程序，但是连接数据库需要很长时间！

但是当我在我的开发服务器上运行这个应用程序时，它的连接速度非常快！

我在 Windows 2003 服务器上运行 SQL Server 2k 个人版，当我在注册表中查看我的 MDAC 版本时，我看到已经安装了 2.8 版！

任何想法为什么会在生产机器上而不是在开发机器上发生这种情况？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-07T18:16:33.187

这很有可能归结为连接到数据库的网络级别问题。当然，这取决于您是否在同一个盒子上运行应用程序和数据库。

尝试使用不同的工具从同一台机器连接到数据库。作为替代方案，您可以设置数据源并从控制面板对其进行测试。如果另一个工具的连接速度很慢，请测试服务器之间的连接以进行其他类型的连接（例如运行 ping）。例如，它可能是通过广播而不是域来解析服务器。或任何数量的其他问题 - 防火墙、交换机、wins 等。

如果您使用集成身份验证进行连接，还要确保数据库可以解析应用程序服务器，反之亦然。这是身份验证过程的一部分，我之前已经看到它会导致创建数据库连接的速度变慢。

简而言之，我相信这不是 delphi / sql 特有的问题，而是生产服务器之间的通信问题。

祝你好运！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-07T17:11:41.583

您的问题很可能与网络或传输层有关

1.  您是通过 TCP、命名管道还是其他机制进行连接？
2.  您是否尝试过使用 Microsoft SQL Profiler 跟踪打开连接？

问候，
利文

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-07T17:22:05.277

建立连接后保持连接打开。这称为连接池，将提高性能。我不知道如何使用 delphi 应用程序来做到这一点。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-07T20:10:25.687

很久以前我遇到过这样的问题，它归结为连接字符串的工作站部分。如果您从开发机器复制了连接字符串，则工作站参数仍然在连接字符串中并指向您的开发机器，这可能在您的部署网络上不存在。

在这种情况下，您与数据库的连接必须等到网络尝试连接不存在的机器（这显然需要时间）。删除工作站cluse，它将无限加速。

# ruby-on-rails - 让用户退出 Rails 应用程序的正确方法是什么？

> ID：524132
> 
> 赞同：2
> 
> 时间：2009-02-07T17:10:04.613
> 
> 标签：ruby-on-rails, ruby

我想在 Rails 应用程序中提供“注销”功能。我是不是应该...

```
session.delete 
```

或者

```
reset_session 
```

通过阅读文档，两者看起来都可以工作。有关系吗？还是我应该使用其他东西？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-07T18:31:49.503

我会使用`reset_session`，因为它是 Rails API 的一部分；而`CGI::Session#delete`实际上是一个*可能会*改变的实现细节。

# c++ - 获取常见文件类型的图标

> ID：524137
> 
> 赞同：12
> 
> 时间：2009-02-07T17:14:04.980
> 
> 标签：c++, winapi, visual-c++, icons

我想在我的 dll 中获取常见文件类型的图标。我正在使用 vc++。我只有文件的文件扩展名和 mime 类型，我想根据这些文件获取文件的图标。

有人可以告诉我我该怎么做吗？（vc++ 中可用的方法需要用户提供需要图标的文件的路径。我无权访问任何此类文件）

谢谢。

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-02-07T17:30:39.707

### 外壳 API

[`SHGetFileInfo()`](http://msdn.microsoft.com/en-us/library/bb762179(VS.85).aspx)您可以通过与标志一起调用来从 shell 中获取它们`SHGFI_USEFILEATTRIBUTES`- 此标志允许例程工作而不需要传入的文件名实际存在，因此如果您有文件扩展名，只需组成一个文件名，附加扩展名，然后传递它在。

通过组合其他标志，您将能够检索：

*   **由系统配置决定的大图标或小图标**：`SHGFI_ICON|SHGFI_LARGEICON`或`SHGFI_ICON|SHGFI_SMALLICON`
*   **由外壳配置确定的大图标或小图标**：`SHGFI_ICON|SHGFI_LARGEICON|SHGFI_SHELLICONSIZE`或`SHGFI_ICON|SHGFI_SMALLICON|SHGFI_SHELLICONSIZE`
*   **shell 的图像列表中的图标索引**以及相应的图像列表：`SHGFI_SYSICONINDEX`
*   **存储图标的实际模块的路径和文件名**（以及该模块中的图标索引）：`SHGFI_ICONLOCATION`

### 例子

```
// Load a System Large icon image
SHGetFileInfo( szFileName, FILE_ATTRIBUTE_NORMAL, &shfi, sizeof(SHFILEINFO), 
   SHGFI_USEFILEATTRIBUTES | SHGFI_ICON | SHGFI_LARGEICON);

// Load a System Small icon image
SHGetFileInfo( szFileName, FILE_ATTRIBUTE_NORMAL, &shfi, sizeof(SHFILEINFO), 
   SHGFI_USEFILEATTRIBUTES | SHGFI_ICON | SHGFI_SMALLICON);

// Load a Shell Large icon image
SHGetFileInfo( szFileName, FILE_ATTRIBUTE_NORMAL, &shfi, sizeof(SHFILEINFO), 
   SHGFI_USEFILEATTRIBUTES | SHGFI_ICON | SHGFI_SHELLICONSIZE);

// Load a Shell Small icon image
SHGetFileInfo( szFileName, FILE_ATTRIBUTE_NORMAL, &shfi, sizeof(SHFILEINFO), 
   SHGFI_USEFILEATTRIBUTES 
   | SHGFI_ICON | SHGFI_SHELLICONSIZE | SHGFI_SMALLICON); 
```

如果要绘制这样的图标，请使用以下内容：

```
// Draw it at its native size
DrawIconEx( hDC, nLeft, nTop, hIcon, 0, 0, 0, NULL, DI_NORMAL );

// Draw it at the System Large size
DrawIconEx( hDC, nLeft, nTop, hIcon, 0, 0, 0, 
            NULL, DI_DEFAULTSIZE | DI_NORMAL );

// Draw it at some other size (40x40 in this example)
DrawIconEx( hDC, nLeft, nTop, hIcon, 40, 40, 0, NULL, DI_NORMAL ); 
```

`SHFILEINFO`可以从结构中获取图标句柄以及文件系统路径：

```
typedef struct _SHFILEINFOA
{
        HICON       hIcon;                      // out: icon
        int         iIcon;                      // out: icon index
        DWORD       dwAttributes;               // out: SFGAO_ flags
        CHAR        szDisplayName[MAX_PATH];    // out: display name (or path)
        CHAR        szTypeName[80];             // out: type name
} SHFILEINFOA; 
```

请记住，您必须在完成后通过传递`hIcon`来释放获得的图标。[`DestroyIcon()`](http://msdn.microsoft.com/en-us/library/ms648063(VS.85).aspx)

* * *

## 回答 #2

> 赞同：-3
> 
> 时间：2009-02-07T17:25:27.767

从注册表中识别图标信息、关联的文件类型和处理文件的程序并从文件中提取图标。 [http://www.codeproject.com/KB/shell/iconextract.aspx](http://www.codeproject.com/KB/shell/iconextract.aspx)

# visual-c++ - 将数据附加到 IStream 对象

> ID：524142
> 
> 赞同：0
> 
> 时间：2009-02-07T17:17:34.240
> 
> 标签：visual-c++, istream

我正在调用 Web 服务以从我的 dll 中获取数据。我正在部分获取 char* 对象中的数据。

我想将整个数据放入 IStream 对象中。我正在运行一个 while 循环并将数据放入 char* 对象中。有人可以告诉我如何将所有这些数据组合成一个 IStream 或 LPSTREAM 对象。

谢谢

从来没有得到这个答案！有人可以帮忙吗！

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-20T23:48:30.127

好的，我想我会回答这个只是为了提供帮助。您正在调用另一台计算机，所以我假设您正在读取 char* 中的数据流。这就是我从“我正在部分获取 char* 对象中的数据”之类的评论中得到的。

因此，据我了解，您只想将 char* 字符串附加到 IStream 对象，以便它保存新数据。

我的建议是这样做：

```
Create a streambuf object (http://msdn.microsoft.com/en-us/library/aa277891(VS.60).aspx)
While you are recieving packets
    append the packet to the streambuf object (http://msdn.microsoft.com/en-us/library/aa277883(VS.60).aspx)
Create a IStream object and init it with the streambuf object (http://msdn.microsoft.com/en-us/library/aa277365(VS.60).aspx) 
```

现在我认为这应该可行。这将用您从网站获得的流填充您的 IStream 对象。

我希望这会有所帮助，罗伯特

# ruby - 同时替换2个字符串？

> ID：524145
> 
> 赞同：8
> 
> 时间：2009-02-07T17:19:53.563
> 
> 标签：ruby, algorithm, string, replace

如何同时替换 2 个字符串？例如，假设我有这样的字符串：

str1 = "AAAA BBBB CCCC DDDD"

我想用“CCCC”替换每个“AAAA”，用“AAAA”替换每个“CCCC”，但如果我这样做了：

str1.gsub("AAAA","CCCC") #CCCC BBBB **CCCC** DDDD

str1.gsub("CCCC","AAAA") # **AAAA** BBBB **AAAA** DDDD

我希望 str1 成为“ **CCCC** BBBB **AAAA** DDDD”

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-02-07T17:24:35.270

一般答案：
使用正则表达式来匹配 AAAA 和 CCCC，然后分别用 CCCC 和 AAAA 替换每个匹配项。

**编辑**以消除混乱

```
str1.gsub(/(AAAA|CCCC)/) { $1 == 'AAAA' ? 'CCCC' : 'AAAA' } 
```

**编辑**我也想到了一种更优雅的方式:)

```
str1.gsub(/((AAAA)|(CCCC))/) { $2 ? 'CCCC' : 'AAAA' } 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-07T17:25:26.580

您是否可以先用其他东西替换 AAAA，然后再继续？

```
str1.gsub("AAAA","WXYZ") # WXYZ BBBB CCCC DDDD
str1.gsub("CCCC","AAAA") # WXYZ BBBB AAAA DDDD
str1.gsub("WXYZ","CCCC") # CCCC BBBB AAAA DDDD 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-07T18:02:54.087

一个解决方案（尽管基于正则表达式的东西最好）将类似于创建替换散列这样的东西，可以根据需要进行扩展。我只是快速将其放在一起进行演示。我敢肯定，多加一点爱和关怀，你可以想出一些更优雅的东西，它的工作原理与此实现仅适用于带空格的字符串相同。

```
str1 = "AAAA BBBB CCCC DDDD"    
replacements = { "AAAA" => "CCCC", "CCCC" => "AAAA", "XXXX" => "ZZZZ" } # etc...

new_string = ""
str1.split(" ").each do |s| 
    new_string += replacements[s] || s
    new_string += " "
end

puts new_string # CCCC BBBB AAAA DDDD 
```

# bash - 过滤掉我可能无法读取文件/查看目录内容的查找结果

> ID：524146
> 
> 赞同：0
> 
> 时间：2009-02-07T17:21:35.043
> 
> 标签：bash, find

例子：

```
find / * 
```

给我所有文件和目录，但**我只想要那些我可以读取的文件和那些我可以看到**. 否则，当我尝试查找所有文件的文件信息时，我会遇到问题：

```
for i in ls $( find / * ); do file $i; done 
```

结果是：

```
find: /lost+found: Permission denied
find: /proc/tty/driver: Permission denied
find: /proc/1/task/1/fd: Permission denied
find: /proc/1/fd: Permission denied
find: /proc/2/task/2/fd: Permission denied
find: /proc/2/fd: Permission denied
find: /proc/3/task/3/fd: Permission denied
# and so on ... 
```

如果可能的话，我希望以一种**通用的方式使用它，这样无论我以哪个用户身份登录，我都可以使用相同的命令行**，但仍然可以获得我可能从 find 中看到的那些文件和目录。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-07T18:08:44.777

使用该`-readable`选项`find`（假设使用 GNU [findutils](http://www.gnu.org/software/findutils/)的现代系统）：

> 匹配可读的文件。这考虑了 -perm 测试忽略的访问控制列表和其他权限伪影。该测试使用了 access(2) 系统调用，因此可能会被执行 UID 映射（或 root-squashing）的 NFS 服务器所欺骗，因为许多系统在客户端的内核中实现 access(2)，因此无法使用服务器上保存的 UID 映射信息。

使用`-perm`和变体不起作用，因为它只查看文件的标志，而不是这些标志是否允许*您*访问。

如果你*没有*，你`-readable`可以`find`通过这个简单的 Perl 脚本输出 ，它只输出所提供的可读文件的文件名：

```
#!/usr/bin/perl -w

use POSIX qw[access];
use strict;

foreach (split(/\0/, <STDIN>)) {
    print $_ . "\0" if (POSIX::access($_, &POSIX::R_OK));
} 
```

例如

```
% find / -print0 | access_test | xargs -0 -n 1 do_cmd 
```

但请注意，这仍然会在尝试递归到它没有权限的目录时产生输出`stderr`错误`find`。( 和)的`print0`选项是为了确保系统可以处理带有嵌入空格的文件名。`find``xargs -0`

# python - 是否有用于 Java 的 Groovy/Grails 的 Python 等价物

> ID：524147
> 
> 赞同：3
> 
> 时间：2009-02-07T17:21:41.470
> 
> 标签：python, django, grails, groovy, jython

我在想像 Jython/Jango 这样的东西？这存在吗？还是 Jython 允许您在 Java 中使用 Python 做所有事情，包括 Django（我不确定 Jython 与 Python 有何不同）？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-07T17:32:47.003

[http://wiki.python.org/jython/DjangoOnJython](http://wiki.python.org/jython/DjangoOnJython)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-07T17:48:53.803

“我不确定 Jython 与 Python 有何不同”

[http://www.jython.org/Project/](http://www.jython.org/Project/)

> Jython 是与 Java 平台无缝集成的高级、动态、面向对象语言 Python 的实现。

[http://docs.python.org/reference/introduction.html#alternate-implementations](http://docs.python.org/reference/introduction.html#alternate-implementations)

> Python 用 Ja​​va 实现。此实现可用作 Java 应用程序的脚本语言，或可用于使用 Java 类库创建应用程序。它还经常用于为 Java 库创建测试。更多信息可以在 Jython 网站上找到。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-11-19T21:54:43.370

[http://turbogears.org/](http://turbogears.org/)

可能更接近您正在寻找的东西

# sql - SQL Server PK 最佳实践

> ID：524150
> 
> 赞同：8
> 
> 时间：2009-02-07T17:22:28.163
> 
> 标签：sql, sql-server, sql-server-2005, database-design, primary-key

我一直想知道在 SQL Server 的 M2M 表中设置 PK 的最佳实践或后果是什么。例如：

我有 2 张桌子

*   用户
*   角色

我正在制作一张新桌子

*   用户角色

其中有 2 个字段 RoleId 和 UserID

现在我应该

1.  创建一个 UserRoleID 作为 PK，并使 UserID 和 RoleID 成为 FK
    *   制作 PK UserID AND RoleID 并将它们设置为 FK
    *   别的东西

我想知道每个选项的性能问题以及推荐的最佳实践是什么。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-02-07T17:29:57.460

这些情况的标准程序是有两个索引。唯一的PK是两个字段复合，基数大的字段在前，即UserID；第二个索引只有辅助字段（即 RoleID）。

然后在可能涉及更多多记录结果集的任何一个上进行聚类（即，如果查询每个用户的多个角色，或者每个角色的多个用户）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-07T18:09:26.320

将 PK 声明为 (UserID, RoleID)。（注意：顺序很重要）

将 UserID 声明为 FK，并引用 Users 表。将 RoleID 声明为 FK，并引用 Roles 表。

运气好的话，您的 DBMS 将按该顺序为您提供 (UserID, RoleID) 的复合索引。

运气好的话，这将加快用户和角色之间的连接。一个好的 DBMS 将为您提供一个合并连接，该连接除了连接条件之外没有任何限制。假设角色数量很少，三路连接也应该运行得非常快。

当您加入 UserRoles 和 Roles，而不加入用户时，您可能会发现它的速度慢得令人失望。你多久这样做一次，在这种情况下速度有多重要？如果它很重要，您可以仅在 RoleID 上创建索引。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-07T17:29:36.370

这取决于您是否希望对特定用户具有特定角色这一事实附加任何其他含义。如果不是，那么只需创建一个集群 PK 以跨越两个字段。

为两者添加 FK 并向第二个字段添加索引。考虑一下字段应该以什么顺序出现。您更有可能检索用户所属的一组角色还是特定角色中的一组用户？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-07T17:30:43.527

这取决于您如何使用它们。大多数时候，我将主键设置为 UserId 和 RoleId 以确保它们是唯一的。这意味着同一用户不能具有相同的角色。

现在这就是“依赖”发挥作用的地方。如果您要将 UserRole 表链接到另一个表，我将在其中创建 UserRoleId 主键。并使 UserId 和 RoleId 成为唯一约束。

这样做的原因是在不需要时引用 UserRole 的表上没有 UserId 和 RoleId，因为您分别链接到 UserRoleId 而不是 User 表和角色表。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-08T03:05:35.707

避免复合 PK 并在两个 FK 上放置一个唯一索引（在这种情况下似乎合适。）。在这种情况下不是问题，但要保持一致。在编写查询时必须记住要处理多个要加入的字段是一件痛苦的事情。如果您的复合键必须由日期时间、字符或其他类型的字段组成，则性能会受到影响。

# eclipse - 自定义环绕的缩写

> ID：524163
> 
> 赞同：4
> 
> 时间：2009-02-07T17:29:02.253
> 
> 标签：eclipse

是否有任何快捷方式可以使用“环绕...”中的模板围绕任何选择？

在这种特殊情况下，我定义了一个带括号模板的环绕...拥有这样的快捷方式将是一个很大的增强。

提前感谢您的帮助。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-08T02:40:02.873

我所知道的环绕模板的唯一快捷方式
（即**`${line_selection}`**在其定义中具有变量的模板）
已在 eclipse 3.2 中引入（实际上在[eclipse3.2 M4](http://kano.net/write/eclipse-news-M4)中进行了改进）

它是“ **Surround With Quick Fix** ”机制

[![替代文字](https://i.stack.imgur.com/yNWiG.png)](https://i.stack.imgur.com/yNWiG.png)
[（来源：[kano.net](http://kano.net/write/eclipse-news-M4_files/surround_with_template.png)）]

为 Quick-Fix 指定快捷方式（默认为 CTRL-1），如果您的选择符合条件（（包含一行），则所有兼容的模板都将显示在 Quick-Fix 对话框中。

然后，您将能够选择适当的环绕模板（如您定义的模板）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2014-04-15T10:16:29.437

@VonC 的回答不适用于**Eclipse Kepler**。使用快捷菜单显示环绕声。

在 java 编辑器中选择一行或多行按`Alt`+ `Shift`+`Z`然后您将获得如下所示的弹出上下文菜单（菜单项因选择区域而异）。

![在此处输入图像描述](https://i.stack.imgur.com/gP4Kw.jpg)

# text - 标记任何文本的最佳方法是什么？

> ID：524180
> 
> 赞同：2
> 
> 时间：2009-02-07T17:37:04.590
> 
> 标签：text, markup

我需要用户使用自定义标签标记文本的某些部分，我不能使用基于 xml 的标签，因为整个文本将嵌入到 XML 文档中，并且所有 < 都将转换为 html 转义码 <。我希望用户使用诸​​如跳过、书签之类的标签来标记文本的某些部分，这些标签也可以具有诸如书签名称 =“第一”之类的属性。这是允许用户使用 BB 论坛方式（如 [b]abcd[/b] 或使用 {{bookmark name="first"}}）标记文本的最佳方式。或者有没有更好的方案或技术可用。

我不想通过降价或纺织来改变文本的结构，我只想标记一些文本部分，比如 phpBB 标签。问题是除了phpBB还有其他风格吗？就像在某些软件中我看到 {{bookmark name = "abcd"}} 样式。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-07T17:45:45.917

为此，我知道的三个常见标记是[Markdown](http://daringfireball.net/projects/markdown/)（我相信 SO 使用过）、[textile](http://www.textism.com/tools/textile/)和[BBCode](http://pear.php.net/pepr/pepr-bbcode-help.php)。前两个通常用于博客站点和 CMS 框架，我认为 BBCode 通常与公告板站点相关联。预览和映射实用程序可用于每个。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-07T17:44:49.397

您可以查看[Textile](http://en.wikipedia.org/wiki/Textile_(markup_language))标记语言，看看它是否符合您的需求。它有许多实现和很好的[文档](http://hobix.com/textile/)。

# file - 如何从 IMAP 消息中确定附件的大小

> ID：524181
> 
> 赞同：2
> 
> 时间：2009-02-07T17:37:38.380
> 
> 标签：file, java-me, email, size, imap

我正在编写一个在 J2ME 上运行的 IMAP 邮件应用程序。这是我的高级项目。

首先，我想知道是否有任何 IMAP 消息仅获取消息正文，不包含附件？

当我将消息发送到 IMAP 服务器时，例如..

*. 获取 20 个正文[文本]*

IMAP 服务器将响应如下

<--车身部分-->

*---MOQ1233897306fd448beb67b3c728ca47f0f5c3dbef2f 内容类型：图片/jpeg；name="card.jpg" 内容传输编码：base64 内容处置：附件；filename="card.jpg" /9j/4RPsRXhpZgAATU0AKgAAAAgABwESAAMAAAABAAEAAAEaAAUAAAABAAAAYgEbAAUAAAABAAAA* ...

所以，我不知道如何只得到身体而不是附件！？在加载所有这些消息并计算文件大小之前，我如何知道文件大小和消息中有多少附件？

如果有人知道这一点，请帮助我。十分感谢。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-16T20:24:44.013

您必须向服务器询问该消息的 BODYSTRUCTURE：

```
FETCH 20 BODYSTRUCTURE 
```

然后，您必须解析响应并确定是否存在附件。这是带有纯文本部分和三个附加图像的消息的示例响应：

```
20 FETCH (BODYSTRUCTURE (("TEXT" "PLAIN" ("CHARSET" "ISO-8859-15" "FORMAT" "flowed") NIL NIL "8BIT" 950 30 NIL NIL NIL)("IMAGE" "JPEG" ("NAME" "r001-023.jpg") NIL NIL "BASE64" 1708116 NIL ("INLINE" ("FILENAME" "r001-023.jpg")) NIL)("IMAGE" "JPEG" ("NAME" "r001-022.jpg") NIL NIL "BASE64" 2077114 NIL ("INLINE" ("FILENAME" "r001-022.jpg")) NIL)("IMAGE" "JPEG" ("NAME" "r001-012.jpg") NIL NIL "BASE64" 2374832 NIL ("INLINE" ("FILENAME" "r001-012.jpg")) NIL) "MIXED" ("BOUNDARY" "------------090105040606010906000608") NIL NIL)) 
```

# c# - 编译时的目标平台/处理器

> ID：524196
> 
> 赞同：8
> 
> 时间：2009-02-07T17:48:11.697
> 
> 标签：c#, .net, target, c-preprocessor, platform

C# 中是否有 #define 可以让我在编译时知道我是针对 x86 (Win32) 还是 x64 (Win64) 进行编译？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-07T21:04:39.117

默认情况下，没有办法做到这一点。原因是 C# 代码不是针对特定平台设计的，因为它在 CLR 上运行。

不过可以用手卷。您可以使用 Visual Studio 中的项目配置设置来定义自己的常量。或者，如果您希望它更精简一点，您可以自己编辑 .csproj 并手动滚动一些具有各种定义的更多配置。

例如，您可以使您的项目文件如下所示。我删除了一些信息，以使 x86/amd64 信息清晰。

```
 <PropertyGroup Condition=" '$(Configuration)|$(Platform)' == 'Debug|x86' ">
    <!-- ... -->
    <DefineConstants>TRACE;DEBUG;X86</DefineConstants>
  </PropertyGroup>
  <PropertyGroup Condition=" '$(Configuration)|$(Platform)' == 'Debug|amd64' ">
    <!-- ... -->
    <DefineConstants>TRACE;DEBUG;AMD64</DefineConstants>
    <ErrorReport>prompt</ErrorReport>
    <WarningLevel>4</WarningLevel>
  </PropertyGroup> 
```

将此添加到 .csproj 文件中会在我的项目中为我提供 2 个新的平台配置。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-07T18:05:39.683

据我所知，Visual Studio 只定义了 DEBUG 和 TRACE 常量。[您可以使用NANT](http://nant.sourceforge.net/)来构建您的项目，而不是在项目配置中手动声明此类常量。它可以在编译时确定构建平台并相应地定义自定义指令。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-07T17:57:09.417

从来没听说过。您必须在不同的项目配置中声明自己的。

# distributed - 如何设计和验证分布式系统？

> ID：524198
> 
> 赞同：16
> 
> 时间：2009-02-07T17:48:17.253
> 
> 标签：distributed, protocols, high-availability, formal-verification

我一直在做[一个项目](http://dimdwarf.sourceforge.net/)，它是一个应用服务器和一个对象数据库的组合，目前只在一台机器上运行。前段时间，我阅读[了一篇](http://www.vldb.org/conf/2007/papers/industrial/p1150-stonebraker.pdf)描述分布式关系数据库的论文，并获得了一些关于如何将论文中的想法应用到我的项目中的想法，这样我就可以使用[共享的集群创建一个运行在集群上的高可用性版本- 无架构](http://en.wikipedia.org/wiki/Shared_nothing_architecture)。

我的问题是，我没有设计分布式系统及其协议的经验——我没有在大学学习关于分布式系统的高级 CS 课程。所以我很担心能不能设计出一个不会造成死锁、饥饿、[脑裂](http://www.venturanetworksinc.com/splitbrain.htm)等问题的协议。

**问题：**我在哪里可以找到关于设计分布式系统的好资料？有哪些方法可以验证分布式协议是否正常工作？欢迎推荐书籍、学术文章等。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-02-08T13:51:19.820

I learned a lot by looking at what is published about really huge web-based plattforms, and especially how their systems evolved over time to meet their growth.

Here a some examples I found enlightening:

*   [eBay Architecture](http://www.addsimplicity.com/downloads/eBaySDForum2006-11-29.pdf): Nice history of their architecture and the issues they had. Obviously they can't use a lot of caching for the auctions and bids, so their story is different in that point from many others. As of 2006, they deployed 100,000 new lines of code every two weeks - and are able to roll back an ongoing deployment if issues arise.

*   [Paper on Google File System](http://research.google.com/archive/gfs.html): Nice analysis of what they needed, how they implemented it and how it performs in production use. After reading this, I found it less scary to build parts of the infrastructure myself to meet exactly my needs, if necessary, and that such a solution can and probably should be quite simple and straight-forward. There is also a lot of interesting stuff on the net (including YouTube videos) on BigTable and MapReduce, other important parts of Google's architecture.

*   [Inside MySpace](http://www.baselinemag.com/c/a/Projects-Networks-and-Storage/Inside-MySpacecom/): One of the few really huge sites build on the Microsoft stack. You can learn a lot of what **not to do** with your data layer.

A great start for finding much more resources on this topic is the [Real Life Architectures](http://highscalability.com/blog/category/example) section on the "High Scalability" web site. For example they a good summary on [Amazons](http://highscalability.com/amazon-architecture) architecture.

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-02-08T06:48:25.587

学习分布式计算并不容易。它确实是一个非常广阔的领域，涵盖了通信、安全性、可靠性、并发性等领域，每个领域都需要数年时间才能掌握。理解最终会通过大量的阅读和实践经验来实现。你似乎有一个具有挑战性的项目开始，所以这是你的机会:)

我相信，关于分布式计算的两本最受欢迎的书是：

1)[分布式系统：概念与设计](https://rads.stackoverflow.com/amzn/click/com/0321263545)- George Coulouris 等人。

2)[分布式系统：原理和范式](https://rads.stackoverflow.com/amzn/click/com/0132392275)- AS Tanenbaum 和 M. Van Steen

这两本书都很好地介绍了当前用于构建成功的分布式系统的方法（包括通信协议）。我个人主要使用后者，我发现它是一个很好的文本。如果您认为亚马逊上的评论不是很好，那是因为大多数读者将这本书与 AS Tanenbaum（IMO 是计算机科学领域最好的作者之一）写的其他书进行比较，坦率地说，这些书写得更好。

**PS**：我真的怀疑您是否需要设计和验证新协议。如果您正在使用应用程序服务器和数据库，那么您所需要的可能已经可用。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-07T17:59:18.727

我喜欢Andrew S. Tanenbaum 和 Maarten van Steen所著的《*分布式系统：原理和范式》一书。*

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2013-03-28T20:04:45.177

> 我在哪里可以找到关于设计分布式系统的好资料？

我一直没能读完[南希·林奇](https://rads.stackoverflow.com/amzn/click/com/1558603484)的名著。但是，我发现 Sukumar Ghosh[分布式系统：一种算法方法](https://rads.stackoverflow.com/amzn/click/com/1584885645)的书更容易阅读，如果需要，它会指向原始论文。

尽管如此，我确实没有读过[Gerard Tel](https://rads.stackoverflow.com/amzn/click/com/0521794838)和[Nicola Santoro](https://rads.stackoverflow.com/amzn/click/com/0471719978)的书。也许它们仍然更容易阅读......

> 有哪些方法可以验证分布式协议是否正常工作？

为了调查可能性（也为了理解问题），我认为从[软件规范方法](https://rads.stackoverflow.com/amzn/click/com/1905209347)一书中了解可能的工具是有用的。

我最后的决定是学习 TLA+。为什么？即使语言和工具看起来更好，我还是真的决定尝试 TLA+，因为它背后的人是 Leslie Lamport。也就是说，不仅是分布式系统上的杰出人物，还是Latex的作者！您可以免费获得[TLA+ 书籍](http://research.microsoft.com/en-us/um/people/lamport/tla/book-02-08-08.pdf)和[几个示例](http://research.microsoft.com/en-us/um/people/lamport/tla/web.zip)。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-07T18:33:44.913

在更抽象和正式的层面上，通信和移动系统： [Robin Milner](http://www.fairdene.com/picalculus/robinmilner.html)[的 Pi-Calculus](http://www.amazon.co.uk/Communicating-Mobile-Systems-Pi-Calculus-Calculus/dp/0521658691/)提供了用于验证系统的微积分。有用于验证协议的 pi-calculus 的变体，例如 SPI-calculus（自从我上次查看以来，维基百科页面已经消失）和[implementations](http://en.wikipedia.org/wiki/Pi_calculus#Implementations)，其中一些也是验证工具。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-08T14:00:51.250

One good book is Birman's [Reliable Distributed Systems](http://www.amazon.co.uk/Reliable-Distributed-Systems-Technologies-Applications/dp/0387215093/ref=sr_1_3?ie=UTF8&s=books&qid=1234101407&sr=1-3), although it has its detractors.

If you want to formally verify your protocol you could look at some of the techniques in Lynch's [Distributed Algorithms](http://www.amazon.co.uk/Distributed-Algorithms-Kaufmann-Management-Systems/dp/1558603484/ref=sr_1_1?ie=UTF8&s=books&qid=1234101491&sr=1-1).

It is likely that whatever protocol you are trying to implement has been designed and analysed before. I'll just plug my own [blog](http://the-paper-trail.org), which covers e.g. consensus algorithms.

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2011-05-05T02:25:46.457

Leslie Lamport 写了很多经典论文： ( [http://research.microsoft.com/en-us/um/people/lamport/pubs/pubs.html](http://research.microsoft.com/en-us/um/people/lamport/pubs/pubs.html) ) 和 Edsger Dijkstra ( [http://www.cs.utexas .edu/users/EWD/](http://www.cs.utexas.edu/users/EWD/)）用于数据库端。

一个主流是NoSQL运动，市场上出现了许多项目，包括CouchDb(couchdb.apache.org)、MongoDB、Cassandra。这些都具有可扩展性和可管理性（复制、容错、高可用性）的承诺。

# python - 如何在外部填充 Django 模型？

> ID：524214
> 
> 赞同：8
> 
> 时间：2009-02-07T17:54:54.307
> 
> 标签：python, django, django-models

从外部源将数据填充到 Django 模型中的最佳方法是什么？

例如，我有一个模型运行，并在一个 XML 文件中运行数据，该文件每周更改一次。

我应该创建一个视图并从 curl cronjob 调用该视图 URL（优点是可以随时读取该数据，而不仅仅是在 cronjob 运行时），还是创建一个 python 脚本并将该脚本安装为 cron（使用 DJANGO _SETTINGS _MODULE 在执行脚本之前设置变量）？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-02-07T18:43:12.570

有一种很好的方法可以在项目环境中完成一些类似维护的工作——编写一个[自定义的 manage.py 命令](http://docs.djangoproject.com/en/dev/howto/custom-management-commands/#howto-custom-management-commands)。它需要所有环境配置和其他东西，让您专注于具体任务。

当然也可以直接通过 cron 调用。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-07T18:03:44.007

您不需要创建视图，只需触发一个[配置了适当 Django 环境设置](https://stackoverflow.com/questions/383073/django-how-can-i-use-my-model-classes-to-interact-with-my-database-from-outside/383089#383089)的 python 脚本。然后像使用视图一样直接调用模型，处理数据，将其添加到模型中，然后将模型 .save() 保存到数据库中。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-07T19:26:13.700

“创建一个python脚本并将该脚本安装为cron（在执行脚本之前使用DJANGO _SETTINGS _MODULE变量设置）？”

首先，请务必在单独的模块中声明您的表单（例如`forms.py`）

然后，您可以编写如下所示的批处理加载程序。（我们有很多这样的。）

```
from myapp.forms import MyObjectLoadForm
from myapp.models import MyObject
import xml.etree.ElementTree as ET

def xmlToDict( element ):
    return dict(
        field1= element.findtext('tag1'),
        field2= element.findtext('tag2'),
    )

def loadRow( aDict ):
     f= MyObjectLoadForm( aDict )
     if f.is_valid():
         f.save()

def parseAndLoad( someFile ):
    doc= ET.parse( someFile ).getroot()
    for tag in doc.getiterator( "someTag" )
        loadRow( xmlToDict(tag) ) 
```

请注意，这里几乎没有独特的处理——它只是使用与您的视图函数相同的表单和模型。

我们将这些批处理脚本放在我们的 Django 应用程序中，因为它依赖于应用程序的`models.py`和`forms.py`.

唯一“有趣”的部分是将您的 XML 行转换为字典，以便它与 Django 的表单无缝协作。除此之外，这个命令行程序使用所有与您的视图相同的 Django 组件。

您可能需要添加选项解析和日志记录，以制作一个完整的命令行应用程序。您还会注意到大部分逻辑是通用的——只有`xmlToDict`函数是真正独特的。我们将这些称为“构建器”并具有类层次结构，因此我们的构建器都是从源文档到 Python 字典的多态映射。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-07T19:33:52.437

我使用 cron 来更新我的数据库，同时使用脚本和视图。从 cron 的角度来看，你选择哪一个并不重要。但是，正如您所指出的，如果您想以非计划的时间间隔进行更新，那么启动浏览器并点击 URL 的简单性是难以超越的。

如果您采用视图路由，则可能值得考虑通过 HTTP POST 接受 XML 文件本身的视图。如果这对您的数据有意义（您没有提供有关该 XML 文件的太多信息），它仍然可以通过 cron 工作，但也可以接受来自浏览器的上传——可能会让生成 XML 文件的人更新自己数据库。如果您不是制作 XML 文件的人，那将是一个巨大的胜利，根据我的经验，这通常是这种情况。

# javascript - 如何从残疾人那里获取表单值元素

> ID：524222
> 
> 赞同：44
> 
> 时间：2009-02-07T17:58:24.190
> 
> 标签：javascript, html, xhtml

表单的 HTML 标准似乎是禁用的输入元素不会影响表单名称/值集合。

有什么办法可以解决这个问题吗？我需要能够打开和关闭禁用，但仍然返回提交表单时的任何值。

我意识到我可以在提交表单之前使用 JavaScript 将值复制到隐藏的输入中，但我不希望这样做。有没有更清洁的方法？

我正在使用 ASP.NET，这并不重要。

* * *

## 回答 #1

> 赞同：103
> 
> 时间：2009-03-24T21:47:59.910

您应该使用`readOnly`标志而不是`disabled`. 只读字段不能由用户编辑，但仍与表单一起提交。

```
<input type="text" value="blah" readonly="true"/> 
```

* * *

## 回答 #2

> 赞同：23
> 
> 时间：2009-02-07T18:03:28.500

> 表单的 HTML 标准似乎是禁用的输入元素不会影响表单名称/值集合。

那是对的。

HACK：您可以在提交时使用 Javascript：

1.  取消设置禁用
2.  设置为只读
3.  提交！

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-03-24T21:49:55.973

如果您将值设为**readonly**，而不是禁用它，字段的名称/值将与其余未禁用的字段一起发送。

使只读字段的焦点事件处理程序将焦点传递给下一个符合条件的字段，使其更像是一个禁用的元素。一些浏览器允许您聚焦并选择只读字段，有些甚至允许您粘贴到只读字段中，尽管它们会恢复为原始值 onblur 和 onchange。

```
<input type="text" value="" readonly="readonly"> 
```

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2009-02-08T00:19:11.910

作为 Wayne 的 hack 的一个稍微更健壮的变体（可能会因按下后退按钮而感到困惑），当禁用控件时：设置`readonly= true`而`className= 'disabled'`不是`disabled= true`，然后样式`.disabled`看起来类似于禁用的字段。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2013-06-08T02:29:20.480

我创建了一个快速（仅限 Jquery）插件，它在禁用输入时将值保存在数据字段中。这只是意味着只要通过 jquery 使用 .prop() 或 .attr() 以编程方式禁用该字段...然后通过 .val()、.serialize() 或 .serializeArra() 访问该值将始终返回即使禁用也值:)

[https://github.com/Jezternz/jq-disabled-inputs](https://github.com/Jezternz/jq-disabled-inputs)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2020-05-21T19:46:03.293

您可以轻松

1.  将状态更改为正常 (disabled=false)
2.  读取值
3.  将输入状态重置为禁用

    ```
    $(element).prop("disabled", false); var text = $(element).val(); $(element).prop("disabled", true) 
    ```

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2009-02-07T18:02:40.890

您可以使用`Visible=false`和/或`ReadOnly=true`代替`Enabled=false`吗？

如果您正在使用控件，则不应该真正设置`Enabled=false`?

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2014-09-04T10:29:33.510

很简单只有两步

1.  检查您要访问的输入是否被禁用，然后删除其“禁用”属性

2.  获取该值，然后再次添加 disabled 属性。

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2012-01-31T10:26:04.107

而不是将字段设置为禁用，将只读属性设置为“只读”，如下所示。

```
readonly=readonly 
```

这将在表单提交中发送您的字段值。

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2016-01-11T18:27:59.260

我想这是一个黑客，但似乎对我来说效果很好。两者都做！用户看到禁用的输入，明显是幻影，浏览器阻止交互 - 但它没有与表单一起提交。用户看不到可能令人迷惑的只读字段，但它与表单一起提交。

```
<input name="mode_d" size="8" value="mode" disabled>
<input name="mode"            value="mode" hidden readonly> 
```

# cocoa-touch - 你能在 Interface Builder 中设置导航栏的编辑按钮吗？

> ID：524223
> 
> 赞同：3
> 
> 时间：2009-02-07T17:58:39.773
> 
> 标签：cocoa-touch, interface-builder

设置表格视图以允许编辑很容易。只需在您的 UITableViewController 中添加一行：

```
self.navigationItem.rightBarButtonItem = self.editButtonItem; 
```

此行在导航栏上添加了一个编辑按钮，该按钮会将表格更改为编辑模式，并在编辑时将其按钮文本更改为“完成”。

是否可以在 Interface Builder 中进行设置？我看到您可以添加 UIBarButtonItem 并将其“标识符”设置为“编辑”，但我没有看到预期的行为。

顺便说一句，“属性”面板中的“标识符”有什么作用？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-07T19:42:51.983

是的，您可以在 Interface Builder 中添加 UIBarButtonItems，它们应该可以工作。

标识符允许您使用预设按钮（如编辑或重新加载），或者您可以选择自定义并制作自己的按钮。

**编辑：**如果您能解释如何通过 IB 添加的 UIBarButtonItems 不起作用，我可能会提供进一步的帮助。

**更新：** UIViewController.editButtonItem 是一种特殊方法，它返回调用视图的 setEditing 方法的 UIBarButtonItem。您可以通过创建一个执行相同操作的方法并将选择器连接到 IB 中的 UIBarButtonItem 来实现相同的效果。

在你的头文件中：

```
- IBAction edit:(id)sender; 
```

并在您的实现文件中：

```
- (IBAction) edit:(id)sender {
    [self setEditing:YES animated:YES];
} 
```

然后将选择器连接到 UIBarButtonItem。

但是，您可能无法在默认的基于导航的应用程序模板中创建此连接，因为表视图位于单独的文件中。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-18T06:43:53.503

看看这里：[http ://blog.tmro.net/2009/05/uitabbarbuttonitem-did-not-change-its.html](http://blog.tmro.net/2009/05/uitabbarbuttonitem-did-not-change-its.html)

如果您希望您的按钮能够动态更改其标签，请确保您使用自定义标识符，否则其标题将是不可变的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2018-07-30T17:56:17.770

从 Xcode 9.4.1 开始，我们似乎仍然无法在 Interface Builder 中专门执行此操作。不过，在代码中很容易做到。

您根本不需要在 IB 中设置按钮。只需在您的`viewDidLoad`方法中添加此代码：

```
navigationItem.leftBarButtonItem = editButtonItem 
```

这会自动设置“编辑”按钮，该按钮会变为“完成”，以便用户可以结束编辑。

要执行与编辑过程相关的任何自定义操作，请覆盖视图控制器的`setEditing(_ editing: Bool, animated: Bool)`方法。

例如，如果您有一个表格视图需要打开和关闭其编辑，您可以这样做：

```
override func setEditing(_ editing: Bool, animated: Bool) {
    super.setEditing(editing, animated: animated)
    tableView.setEditing(editing, animated: animated)
} 
```

*一定要`super.setEditing`在这里打电话。*

注意：如果您使用`UITableViewController`,`setEditing`已经在超类中设置来处理表格视图。您不需要覆盖它，除非您在启用/禁用编辑时要包含其他自定义代码。

# sendmail - 如何从同名的网络服务器（使用 sendmail）向我的谷歌应用程序邮件服务器发送邮件？

> ID：524224
> 
> 赞同：0
> 
> 时间：2009-02-07T17:59:07.247
> 
> 标签：sendmail, google-apps

我的域的邮件由谷歌应用服务处理，所有必需的 DNS MX 记录输入正确。我也有处理域的 HTTP 请求的网络服务器。而且我无法从该服务器向我的邮件域发送邮件，sendmail 会忽略 MX 记录，并且总是尝试在本地为我的域传递所有邮件。

如果它解析为本地 IP 地址，看起来它认为域名是本地的。

这是从日志中截取的：

```
Feb  7 18:03:03 vds sendmail[4100]: n17I33c2004100: test@example.com... User unknown
Feb  7 18:03:03 vds sendmail[4100]: n17I33c2004100: to=test@example.com, delay=00:00:00, mailer=local, pri=0, dsn=5.1.1, stat=User unknown
Feb  7 18:03:03 vds sendmail[4100]: n17I33c2004100: from=root, size=36, class=0, nrcpts=1, msgid=<200902071803.n17I33c2004100@vds.xxxxxx.com>, relay=root@localhost 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-07T21:12:43.533

好。为我的案例找到了解决方案。

只需将以下行添加到您的源 .mc 文件并重新创建 sendmail.cf

```
define(`confDONT_PROBE_INTERFACES', `true') 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-07T18:07:47.243

抛弃 sendmail 并获得 postfix。Sendmail 很难正确配置，也很难保证安全。Postfix 在这两个方面都很容易。我对他们没有经验，但有人告诉我 qmail 和 exim 一样好。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-03-01T21:25:12.420

当我在我的服务器上寻找相同问题的解决方案时，有一个解决方法：转到您的谷歌应用程序邮箱，设置/帐户，然后创建一个新帐户以从中提取电子邮件，作为邮件服务器指定您自己服务器的 IP，并为其提供适用于您以前的邮件解决方案（在谷歌应用程序之前）的用户名和密码。

这样你就可以让谷歌登录到你的本地邮件服务器，然后每 10 分钟左右接收一次所有“丢失”的电子邮件。

# oop - 学习面向对象设计和分析的最佳资源

> ID：524227
> 
> 赞同：4
> 
> 时间：2009-02-07T17:59:36.200
> 
> 标签：oop

我正在寻找最好的资源、视频、书籍、杂志（我喜欢视频）来学习和掌握面向对象的设计和分析。我真的很想了解更多关于在程序中构建程序、设计类和处理数据库的可信和有信誉的方法。所以，我的问题是什么是最好的资源？

谢谢

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-07T18:14:02.253

“Head First”书籍非常好：

*   [面向对象的分析与设计](http://oreilly.com/catalog/9780596008673/)
*   [设计模式](http://oreilly.com/catalog/9780596007126/)

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-02-07T18:06:19.587

必须阅读[Bob Martin 叔叔](http://butunclebob.com/ArticleS.UncleBob.PrinciplesOfOod)在 Object Mentor 上的专栏。自 90 年代 C++ Report 以来，他一直在撰写有关面向对象编程的好文章。他的 SOLID 想法与语言无关。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-07T18:10:50.543

四人组的设计模式。一本您将永远需要的参考书。它详细介绍了如何使用 OO 设计来构建代码。

[http://en.wikipedia.org/wiki/Design_Patterns](http://en.wikipedia.org/wiki/Design_Patterns)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-07T18:24:19.240

我肯定会推荐“Head First Design Patterns”一书。我的建议是至少把那本书通读一遍。一旦您对设计模式有所了解，请使用“Gang of Four Design Patterns”一书进行快速参考/刷新。

以下是我书签中的一些链接：

*   [http://sourcemaking.com/design-patterns-and-tips](http://sourcemaking.com/design-patterns-and-tips)
*   [http://www.dofactory.com/Patterns/Patterns.aspx](http://www.dofactory.com/Patterns/Patterns.aspx)

希望能帮助到你。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-24T21:34:08.057

你会在大学课程中学到最好的，或者至少是一门好的课程。你不必花 2 年的时间来做这件事——如果你能负担得起 400 到 500 英镑，我会推荐[这个](http://www3.open.ac.uk/employment/tutors/courses/M263.shtm)。

它教您有关状态的知识，以及您可以在维基百科上以一种糟糕的方式阅读的其他 4 个概念。我不相信您会从在线免费资源中正确学习它，我猜您只会得到零散的信息。

您可能非常聪明，但出于某种原因，那里的信息不会那么高水平 - 软件领域最聪明的人为他们的大学课程、讲座、作业和考试**付费**，而不仅仅是在互联网上阅读。

要进行分析，请尝试 M256 课程，该课程是关于面向对象的软件开发、UML 和系统设计的。这听起来很乏味，但包含许多您可能永远不会使用但无论如何都想知道的背景信息。

# ruby - 搜索网页内容

> ID：524229
> 
> 赞同：0
> 
> 时间：2009-02-07T17:59:44.653
> 
> 标签：ruby

你如何在 ruby​​ 中搜索网页源很难解释，但这里有一个用 Python 做的代码

```
import urllib2, re
word = "How to ask"
source = urllib2.urlopen("http://stackoverflow.com").read()
if re.search(word,source):
     print "Found it "+word 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-07T18:26:28.703

直接移植您的代码：

```
require 'net/http'
word = 'How to ask'
source = Net::HTTP.get(URI.parse('http://stackoverflow.com/'))
if source.match(word)
    puts "Found #{word}"
end 
```

如果你想做一些事情，比如跟随重定向，你需要[阅读文档](http://www.ruby-doc.org/stdlib/libdoc/net/http/rdoc/index.html)。

# android - 在 Android 上使用 GData API 的最佳选择？

> ID：524257
> 
> 赞同：43
> 
> 时间：2009-02-07T18:10:07.737
> 
> 标签：android, gdata-api

在 Android 应用程序中使用 Google 数据 API 最不痛苦且最节省空间的方法是什么？

经过几次快速搜索后，似乎 Google 代码上有一个[android-gdata](http://code.google.com/p/android-gdata/)项目，这似乎是一个作者的作品。我没有找到任何文档，甚至不知道它是否已经准备好生产。

较旧的选项 com.google.wireless.gdata 包似乎[已从](http://groups.google.com/group/android-developers/browse_thread/thread/faea8516f95ceaa6/9fc2090ffaf6620f?lnk=raot)SDK 中删除。它仍然在 GIT 存储库中[可用。](http://android.git.kernel.org/?p=platform/external/gdata.git;a=summary)

在我在这两种方法上投入太多时间之前，我想知道哪种方法得到最好的支持和最不痛苦。

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2010-04-13T12:50:40.710

请查看支持 Android 的[Google API Client Library](http://code.google.com/p/google-api-java-client/) for Java

它还支持新的**GData**技术，例如最近宣布的部分响应/更新和**JSON-C**，这两者都可以显着提高 Android 的效率。

首先，请查看[Android 开发人员指南](http://code.google.com/p/google-api-java-client/wiki/Android)。另外，请查看[Picasa 网络相册数据 API 的 Android 示例](http://samples.google-api-java-client.googlecode.com/hg/picasa-atom-android-sample/instructions.html?r=default)，该示例演示了创建/更新/删除相册和上传图片的能力。

全面披露：我是[google-api-java-client](http://code.google.com/p/google-api-java-client/)项目的所有者。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-15T01:52:51.163

我还查看了 google-code 项目和 git repo。由于必需项目中出现的明显包袱，我避开了 google-code 项目。我最终根据需要创建了自定义实现以适应标准 java API。[您可以在android-developers group](http://groups.google.com/group/android-developers/browse_thread/thread/faea8516f95ceaa6/2184dfe09ed5c4bf?lnk=gst&q=jw.mach1#2184dfe09ed5c4bf)中找到我的解决方案的粗略描述。它是 4 个简短、易于测试的课程

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2010-12-15T08:12:21.313

请尝试适用于 Android 的[Google SpreadSheet API](http://code.google.com/p/google-spreadsheet-lib-android/)

我在谷歌代码上维护这个项目，所以如果你遇到任何问题，请告诉我。

干杯，普拉桑塔

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2010-09-28T19:26:55.797

以下是让 Google Docs api 与 Android Eclipse 项目一起工作的一些步骤。

[剧透：它在 SAX 异常上中断（对我来说）]

## 1

[获取 GData Java 库](http://code.google.com/p/google-api-java-client/downloads/list1)（通过[语言指南](http://code.google.com/apis/documents/docs/3.0/developers_guide_java.html)）

## 2

从[Android Javamail 端口获取 3 个 jars](http://code.google.com/p/javamail-android/downloads/list3.x/features/external-parameter-entitieseee)

## 3

在您的 lib 文件夹中添加以下 jar，使用上下文菜单将它们添加到路径（构建路径->添加）

*   激活.jar (javamail)
*   addnal.jar (javamail)
*   邮件.jar (javamail)
*   gdata-client-1.0.jar
*   gdata-client-meta-1.0.jar
*   gdata-core-1.0.jar
*   gdata-docs-3.0.jar
*   gdata-docs-meta-3.0.jar
*   gdata-gtt-2.0.jar
*   gdata-gtt-meta-2.0.jar
*   gdata-media-1.0.jar
*   google-collect-1.0-rc1.jar（来自 gdata 文件夹的 deps 文件夹）
*   jsr305.jar3\. （来自 gdata 文件夹的 deps 文件夹）

## 4

不要忘记在您的 AndroidManifest.xml 中添加 INTERNET 权限：

```
<uses-permission android:name="android.permission.INTERNET"></uses-permission> 
```

## 5

尝试一些示例代码：

```
DocsService client = new DocsService("myappname");
try
{
    client.setUserCredentials("username", "password");

    URL feedUri = new URL("https://docs.google.com/feeds/default/private/full/");
    DocumentListFeed feed = client.getFeed(feedUri, DocumentListFeed.class);

    TextView textView = (TextView) findViewById(R.id.textview);

    String text = ""; 
    for (DocumentListEntry entry : feed.getEntries())
    {
        text += entry.getTitle().getPlainText() + "\r\n";
    }

    textView.setText(text);
}
catch (AuthenticationException e)
{
    // TODO Auto-generated catch block
    e.printStackTrace();
}
catch (MalformedURLException e)
{
    // TODO Auto-generated catch block
    e.printStackTrace();
}
catch (IOException e)
{
    // TODO Auto-generated catch block
    e.printStackTrace();
}
catch (ServiceException e)
{
    // TODO Auto-generated catch block
    e.printStackTrace();
} 
```

## 6

2 小时后接受失败，并带有来自 logcat 的 SaxException：

> WARN/XmlParser(1599): javax.xml.parsers.ParserConfigurationException:
> org.xml.sax.SAXNotRecognizedException: [http://xml.org/sax/features/external-parameter-entities](http://xml.org/sax/features/external-parameter-entities)
> ...
> 在 com.google.gdata。 wireformats.input.AtomDataParser.parse(AtomDataParser.java:68)

最后一步会导致 ServiceException。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2012-03-31T15:34:56.190

我使用了这个[API](http://code.google.com/p/android-gdocs-api/)

我尝试将其转换为 a **`.jar`**，但遇到了问题。我发现很容易将项目标记为库项目，然后在我的主项目中使用它。

# sql - SQL“ON”子句优化

> ID：524265
> 
> 赞同：2
> 
> 时间：2009-02-07T18:15:04.653
> 
> 标签：sql, mysql, optimization, join

哪个查询会运行得更快？

```
SELECT * FROM topic_info
    LEFT JOIN topic_data ON topic_info.id = topic_data.id
WHERE id = ? 
```

或者

```
SELECT * FROM topic_info
    LEFT JOIN topic_data ON topic_data.id = topic_info.id
WHERE id = ? 
```

不同之处在于“ON”子句的表达式顺序：第一个查询是检查 topic_info.id 与 topic_data.id，第二个是 topic_data.id 与 topic_info。哪个查询通常会运行得更快？

（我知道任何一个查询都不会解析，因为“id”列不明确，但让我们忽略它）

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-07T18:18:31.653

我不认为它应该有所作为。选择一个约定并坚持下去。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-07T18:22:45.340

这**可能**没关系，但一定要测试一下。

如果您使用 MySQL，请尝试“explain select ...”——它会告诉您您需要知道的内容。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-07T20:30:21.887

其他海报是正确的，你表达加入的方式并不重要。

这是因为他们的查询优化器将确定最有效的方法，当然还有查询计划用于您的查询。无论您的连接语句顺序如何，都会发生这种情况。

希望这可以为您解决问题，但请随时索取更多详细信息。

干杯，约翰

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-07T18:21:20.040

现代数据库足够聪明，因此它对执行性能没有影响。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-07T18:31:03.000

他们不会返回略有不同的结果吗？

因为它是左连接，如果其中一个表中有行而另一个表中没有链接记录，则当该表位于连接子句的右侧时，将不会检索它们。

还是我误解了？

编辑：我完全误解了 - 刚刚做了一些测试。Ta 对评论者直言不讳。

# asp.net - ASP.NET、SQL Server、LINQTOSQL 和日期格式

> ID：524274
> 
> 赞同：0
> 
> 时间：2009-02-07T18:17:39.797
> 
> 标签：asp.net, sql-server, date

我正在通过以下方式设置我的 .net 应用程序的语言环境：

```
 string userLocale = Web.Helpers.LocaleHelpers.GetBestRFC3066Locale(this.Context.Request.UserLanguages);

            if (userLocale != String.Empty)
            {
                System.Threading.Thread.CurrentThread.CurrentCulture = System.Globalization.CultureInfo.CreateSpecificCulture(userLocale);
                System.Threading.Thread.CurrentThread.CurrentUICulture = new System.Globalization.CultureInfo(userLocale);
            } 
```

这很好用，所以我的日期将以基于语言环境的格式显示，即

12/10/2009 为 en-gb 和 10/12/2009 为我们

但是，当我通过 LinqToSql 保存日期时，我需要以通用格式存储这些日期。

目前，当美国用户运行该应用程序时，存储在数据库中的日期为美国格式，而当英国用户使用该应用程序时，其为英国格式。

关于如何最好地实现这一目标的任何建议？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-07T18:22:15.357

将日期作为`datetime`值存储在 SQL Server 中。这样你就不会遇到转换问题。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-09T08:50:17.287

布兰农在那里有正确的解决方案。在 SQL 中拥有日期时间格式的变量后，您可以使用 CONVERT T-SQL 关键字将其转换为其他日期时间格式

# asp-classic - 代码评论——我是在创造一台 Rube Goldberg 机器吗？

> ID：524275
> 
> 赞同：1
> 
> 时间：2009-02-07T18:17:41.873
> 
> 标签：asp-classic, vbscript, ado

我正在通过 ADO 对数据库表进行大量调用。本着保持 DRY 的精神，我编写了以下函数来从记录集中返回一组值。这是兔子脑子吗？我主要使用它来获取一组组合框值等，从不用于巨大的值。示例用法（为简洁起见删除了错误处理）：

```
Function getEmployeeList()
    getEmployeeList= Array()
    strSQL =  "SELECT emp_id, emp_name from employees"
    getEmployeeList = getSQLArray( strSQL, "|" )
End Function 
```

然后我只是对返回的数组做任何我想做的事情。

```
Function getSQLArray( SQL, delimiter )
'*************************************************************************************
' Input a SQL statement and an optional delimiter, and this function
' will return an array of strings delimited by whatever (pipe defaults)
' You can perform a Split to extract the appropriate values. 
' Additionally, this function will return error messages as well; check for 
' a return of error & delimiter & errNum & delimiter & errDescription
'*************************************************************************************
    getSQLArray = Array()
    Err.Number = 0
    Set objCon = Server.CreateObject("ADODB.Connection") 

    objCon.Open oracleDSN

    Set objRS = objCon.Execute(SQL)

    if objRS.BOF = false and objRS.EOF = false then
        Do While Not objRS.EOF
            for fieldIndex=0 to (objRS.Fields.Count - 1)
                    If ( fieldIndex <> 0 ) Then
                        fieldValue = testEmpty(objRS.Fields.Item(fieldIndex))
                        recordString = recordString & delimiter & fieldValue
                    Else 
                        recordString = CStr(objRS.Fields.Item(fieldIndex))
                    End If
            Next 
            Call myPush( recordString, getSQLArray )
            objRS.MoveNext
        Loop
    End If
    Set objRS = Nothing
  objCon.Close
  Set objCon = Nothing
End Function

Sub myPush(newElement, inputArray)
    Dim i
    i = UBound(inputArray) + 1
    ReDim Preserve inputArray(i)
    inputArray(i) = newElement                                          
End Sub

Function testEmpty( inputValue )
    If (trim( inputValue ) = "") OR (IsNull( inputValue )) Then 
      testEmpty = ""
    Else
        testEmpty = inputValue 
    End If
End Function 
```

我的问题是：像这样将所有记录集对象的创建/打开/错误处理抽象到它自己的函数调用中是否有意义？我是否正在建造一台 Rube Goldberg 机器，任何维护此代码的人都会诅咒我的名字？

我应该把它吸起来并编写一些宏来吐出 ADO 连接代码，而不是尝试在函数中执行它吗？

我对 asp 很陌生，所以我在它的功能/最佳实践中存在漏洞，所以任何输入都将不胜感激。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-07T22:01:11.250

按照自己的方式做事没有错。ADO 库的设计并不是那么好，直接使用它们需要太多的代码行，所以我总是有一些实用函数可以更容易地做一些常见的事情。例如，为自己创建一个“ExecuteScalar”函数来运行恰好返回一个值的“ExecuteScalar”函数是非常有用的，因为你可能会执行所有这些 SELECT COUNT(*)。

**但是**-您的`myPush`功能效率极低。`ReDim Preserve`需要很长时间，因为它必须重新分配内存并复制所有内容。这会导致 O(n ² ) 性能，或者我称之为[Shlemiel the Painter](http://www.joelonsoftware.com/articles/fog0000000319.html)算法。推荐的最佳做法是首先调暗，例如，一个有 16 个值空间的数组，然后在填充时将其大小加倍。这样你就不必调用`ReDim Preserve`超过 Lg [2] *n*次。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-08T18:21:15.827

我想知道你为什么不使用 GetRows？它返回一个数组，您可以在此处找到更多详细信息：http: [//www.w3schools.com/ado/met_rs_getrows.asp](http://www.w3schools.com/ado/met_rs_getrows.asp)

关于 GetRows 的几点说明：

```
Set objRS = Server.CreateObject ("ADODB.Recordset")
objRS.Open cmd, , adOpenForwardOnly, adLockReadOnly

If Not objRS.EOF Then
   astrEmployees = objRS.GetRows()
   intRecFirst   = LBound(astrEmployees, 2)
   intRecLast    = UBound(astrEmployees, 2)

   FirstField  = 0
   SecondField = 1
End If

'2nd field of the fourth row (record) '
Response.Write (SecondField, 3) 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-07T18:25:47.457

是的，排除常见任务是有意义的。我认为总体思路没有任何问题。我想知道为什么你要返回一个由分隔符分隔的字符串数组；您不妨返回一个数组数组。

# php - AJAX 进度：从 Shell 读取输出

> ID：524286
> 
> 赞同：1
> 
> 时间：2009-02-07T18:21:35.563
> 
> 标签：php, linux, shell, command-line

**目标**：制作一个进度条，用户可以在其中检查我的服务器下载了多少文件。

**场景**：我有一个 PHP 脚本，它通过 popen 执行一个 python 脚本。我已经这样做了：

```
$handle = popen('python last', 'r');

$read = fread($handle, 4096);

pclose($handle); 
```

这个 python 脚本输出到 shell 是这样的：

```
[last] ZVZX-W3vo9I: Downloading video webpage
[last] ZVZX-W3vo9I: Extracting video information
[download] Destination: myvideo.flv
[download]   9.9% of 10.09M at    3.30M/s ETA 00:02 
```

**问题**：当我读入由 shell 输出生成的文件时，我得到除了最后一行之外的所有 shell 输出！？为什么？

补充一点，当我通过 shell 运行命令时，shell 光标出现在该行的末尾并等待脚本完成。

谢谢大家

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-07T19:02:09.910

我想到的第一件事：也许程序检测到它没有在 TTY 上执行，因此没有显示最后一行，这可能涉及丑陋的控制字符，因为该行似乎在更新自己？

当您将输出重定向到文件（在 shell 中）或通过 less 管道时会发生什么？如果你没有看到最后一行，很可能就是这种情况。除了修复源之外，我不知道其他解决方案。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-07T22:09:27.833

你读到EOF吗？

```
$handle = popen('python last', 'r');
$read   = "";

while (!feof($handle)) {
  $read .= fread($handle, 4096);
}

pclose($handle); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-11-20T12:36:56.683

这将是你的朋友：

```
$handle = popen('python last 2>&1', 'r'); 
```

更多信息可以在这里找到：[维基百科](http://de.wikipedia.org/wiki//dev/null)

# computer-science - 开发人员要点 - 资源和项目尝试

> ID：524287
> 
> 赞同：4
> 
> 时间：2009-02-07T18:21:55.670
> 
> 标签：computer-science

我作为一名开发人员已经工作了大约 2 年，我的 IT 学位有点糟糕，我希望我已经获得了一个“适当的”计算机科学学位，因为我已经意识到我的知识存在巨大差距。

我完全在 c# 中工作，并进行了一些前端 Web 开发。有些东西真的很想学，我想知道人们是否可以向我指出一些好的资源。我基本上一直在尝试列出我不知道的内容并按优先级排序。任何人都可以建议我可以为列出的每个项目和要使用的资源尝试的示例项目（欢迎网络和书籍建议）。

*   网络，了解完整的 IP 堆栈等。
*   http 协议，[OReilly 的书](http://www.amazon.co.uk/HTTP-Definitive-Guide-David-Gourley/dp/1565925092/ref=sr_1_1?ie=UTF8&s=books&qid=1234028413&sr=8-1)值得一​​看吗？
*   多线程应用程序
*   低级编程，目前[从头开始使用此编程的汇编](http://savannah.nongnu.org/projects/pgubook/)
*   数据结构和算法。
*   操作系统
*   您认为应该在此列表中的任何其他内容！

我想我在问，“每个开发人员应该知道什么？他们应该在自己的时间尝试哪些项目以确保他们很好地理解这个主题”。我知道我的清单是相当分散的枪，但我想这就是为什么我要在我的方向上寻求一些帮助。

提前感谢任何花时间对此做出回应的人。

..布里

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-07T18:29:02.990

我否决了您的问题，因为您似乎没有进行搜索。

[每个程序员都应该知道什么？](https://stackoverflow.com/questions/132798/what-should-every-programmer-know)

[每个开发人员都应该知道哪些算法？](https://stackoverflow.com/questions/445425/what-algorithms-should-every-developer-know)

[每个开发人员都应该知道的 asp.net 框架和库……并使用](https://stackoverflow.com/questions/167151/asp-net-frameworks-and-libraries-every-developer-should-know-and-use)

[每个初学者都应该知道的 CSS 技巧？](https://stackoverflow.com/questions/500827/css-tips-which-every-beginning-developer-should-know-about)

[每个优秀的 .NET 开发人员都应该能够回答的问题？](https://stackoverflow.com/questions/365489/questions-every-good-net-developer-should-be-able-to-answer)

[现在的程序员应该具备哪些技能？](https://stackoverflow.com/questions/294825/what-skills-should-a-programmer-have-nowadays)

我不想变得粗鲁。至少我指出了我为什么投反对票。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-08T13:33:27.127

好的，攻击您给出的列表（顺便说一句，它们听起来一点也不杂乱无章-您听起来好像对计算机系统感兴趣，这是一个成熟而活跃的研究领域）。

我将为您提供每个领域的资源和示例项目：

数据结构和算法。

*   **资源：**规范的书，我仍然认为是最好的一本，是 Cormen 等人的《算法导论》。这不是很容易，但它非常丰富且解释清楚。使用 wikipedia（其 DS+A 页面总体上还不错）和 NIST 词典备份您无法从那里完全掌握的内容。
*   **项目：**用您选择的语言实现尽可能多的您喜欢的算法。如果你使用上面的 ITA，我只推荐 Python，因为它是最接近他们使用的伪代码的语言，但不要太担心你的语言选择。我再说一遍，不要陷入选择语言的困境；有足够的时间来学习它们:)

联网。

*   **资源：**要了解它们如何组合在一起，有几本好书。我喜欢 Tanenbaum 的“计算机网络”，但另一个可能更适合您的好选择（尽管需要注意的是，我自己没有彻底阅读过）是 Kurose 和 Ross 的[计算机网络：使用 Internet 的自顶向下方法](http://www.amazon.co.uk/Computer-Networking-Top-down-Approach-Featuring/dp/0321227352/ref=sr_1_4?ie=UTF8&s=books&qid=1234099118&sr=8-4)。这本书可能会很好用，因为你更有可能接触到你早期熟悉的概念。

    要将这一切付诸实践，请阅读 Linux 或 FreeBSD 内核源代码，了解其中的网络堆栈是如何组合在一起的。有很好的资源，无论是印刷版还是网络上，都可以帮助您完成此过程。顺便说一句，我真的不会太担心 HTTP。这是一个重要的协议，但并不是一个非常有趣的协议。在我看来，TCP、IP、UDP、BGP 和朋友们更有趣！

*   **项目：**很难知道什么是可行的项目。回答本书章节末尾的问题。通过编写一个简单的客户端-服务器程序自学用户空间套接字编程（“Hello world！”在网上做起来并不难！）。一旦你有了这个，你可能会自己想出一个扩展——也许你想写一个非常简单的网络服务器。

多线程编程：

*   **资源：**这是一个巨大的话题。如果您只想了解多线程原语如何在您选择的语言中运行，请在网上查找教程 - 至少有 Python、Java 和 C 的负载。如果您对该理论感兴趣，请在 DDJ 中搜索 Herb Sutter 的关于并发编程的系列（但现在这对您来说可能有点高级）。Herlihy 和 Shavit 的[《多处理器编程艺术》](http://www.amazon.co.uk/Art-Multiprocessor-Programming-Herlihy/dp/0123705916/ref=sr_1_1?ie=UTF8&s=books&qid=1234099567&sr=1-1)是一本关于并发编程的精彩书籍，从非常（非常！）实用的学术角度来看，尽管第一版需要修复一堆错误。
*   **项目：**从网络项目中获取您的服务器，并在一个新线程中为每个客户端提供服务，这样您就可以一次接受多个连接。为用餐哲学家的问题编写一个解决方案:)

操作系统：

*   **资源：**有几本很好的入门书籍。同样，我是 Tanenbaum 的[Modern Operating Systems](http://www.amazon.co.uk/Modern-Operating-Systems-Andrew-Tanenbaum/dp/0138134596/ref=sr_1_1?ie=UTF8&s=books&qid=1234099742&sr=1-1)的粉丝，但 Silberschatz 等。人。书也不错。恕我直言，您真的想要一本书，因为您想在研究特定操作系统的工作原理之前对可用的设计选择进行全面概述。

    但是，当您确实达到了这一点时，我建议您再次阅读 Linux 源代码。网上有很好的文章，也有一些很好的印刷书籍（我喜欢[Linux Kernel Development](http://www.amazon.co.uk/Linux-Kernel-Development-Novell-Press/dp/0672327201/ref=sr_1_1?ie=UTF8&s=books&qid=1234099864&sr=1-1)，但它必然有点过时了）。

*   **项目：**在虚拟机中安装 Linux 发行版。向内核添加系统调用，并从用户空间对其进行测试。那么内核就是你的牡蛎！尝试破解调度程序 - 首先让它变得非常愚蠢，然后慢慢添加功能。

    如果您愿意，您可以尝试从头开始编写操作系统，但这是一个巨大且可能非常令人沮丧的体验。我建议开始使用现存的内核 - 至少当它坏了你知道这是因为你刚刚做的事情:)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-07T18:28:15.737

你读过完整的代码吗？这是一个很好的起点，因为它突出了各种主题的大量额外阅读。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-07T18:26:15.693

值得一看的一本好书是 Silberschatz、Galvin 和 Gagne 的“操作系统概念”。

它引导您思考从线程、内存管理到操作系统设计结构的各个方面。书中的例子都是C语言的，所以很容易掌握。它确实填补了您对整个操作系统可能存在的任何空白。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-07T18:30:33.673

您可能会尝试的一件事是为计算机科学课程找到一些公共教学大纲。看看他们在做什么类型的项目并自己尝试。当您需要帮助时，请根据需要查阅书籍、论坛和 SO。

我认为我在本科期间学习的最基础的 CS 课程是编程语言理论、计算机组织、操作系统和理论/离散数学课程。

尝试采用经典算法并用 4 种不同类型的语言实现它。（例如尝试 C#、LISP、Prolog 和 C）向 Linux 内核的本地副本添加一些玩具功能，以查看它是如何运行的。编写分布式文件系统。这些是学校里教会我最多的一些项目。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-07T18:32:59.503

一定要看看计算理论。几本很棒的书是： [http ://www.amazon.com/Introduction-Theory-Computation-Michael-Sipser/dp/053494728X](https://rads.stackoverflow.com/amzn/click/com/053494728X) [http://www.amazon.com/Computability-Complexity-Languages-Second-Fundamentals/dp /0122063821](https://rads.stackoverflow.com/amzn/click/com/0122063821)

我还会查看 projecteuler.net 并解决其中的一些问题。避免使用蛮力解决问题......相反，查看数学并尝试学习将在 CS 理论课中讨论的常见算法和概念。

* * *

## 回答 #7

> 赞同：-2
> 
> 时间：2009-02-07T18:29:09.307

我的必备知识是：

*   依赖注入容器
*   单元测试
*   模式（有点）
*   领域模式（原型）

# python - 如何“放大”曼德布洛特集的一部分？

> ID：524291
> 
> 赞同：5
> 
> 时间：2009-02-07T18:22:48.010
> 
> 标签：python, math, mandelbrot

我创建了一个 Python 文件来生成 Mandelbrot 集图像。最初的数学代码不是我的，所以我不明白——我只是对其进行了大量修改，使其速度提高了大约 250 倍（线程规则！）。

无论如何，我想知道如何修改代码的数学部分以使其呈现一个特定的位。这是数学部分：

```
for y in xrange(size[1]):
        coords = (uleft[0] + (x/size[0]) * (xwidth),uleft[1] - (y/size[1]) * (ywidth))
        z = complex(coords[0],coords[1])
        o = complex(0,0)
        dotcolor = 0  # default, convergent
        for trials in xrange(n):
            if abs(o) <= 2.0:
                o = o**2 + z
            else:
                dotcolor = trials
                break  # diverged
        im.putpixel((x,y),dotcolor) 
```

以及尺寸定义：

```
size1 = 500
size2 = 500
n=64
box=((-2,1.25),(0.5,-1.25))
plus = size[1]+size[0]
uleft = box[0]
lright = box[1]
xwidth = lright[0] - uleft[0]
ywidth = uleft[1] - lright[1] 
```

我需要修改什么以使其呈现集合的某个部分？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-02-07T18:31:16.433

该行：

```
box=((-2,1.25),(0.5,-1.25)) 
```

是定义正在渲染的坐标空间区域的位，因此您只需要更改此行。第一个坐标对是区域的左上角，第二个是右下角。

从图像中获取新坐标应该非常简单。您有两个坐标系，您的“图像”系统大小为 100x100 像素，原点位于 (0,0)。以及由“框”定义的“复杂”平面坐标系。对于 X：

```
X_complex=X_complex_origin+(X_image/X_image_width)*X_complex_width 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-07T20:19:36.137

理解如何做到这一点的关键是理解这`coords =`条线在做什么：

```
coords = (uleft[0] + (x/size[0]) * (xwidth),uleft[1] - (y/size[1]) * (ywidth)) 
```

实际上，与屏幕像素坐标相对应的`x`和`y`值正在被转换为正在查看的复平面上的对应点。这意味着`(0,0)`屏幕坐标将转换到被查看的左上区域`(-2,1.25)`，并且将是相同的，但移动了 1/500和x 坐标`(1,0)`之间的距离（假设窗口宽度为 500 像素） 。`-2``0.5`

这正是那条线正在做的事情——我将用更多说明性的变量名称扩展 X 坐标位以表明这一点：

```
mandel_x = mandel_start_x + (screen_x / screen_width) * mandel_width 
```

（`mandel_`变量是指复平面上的坐标，`screen_`变量是指被绘制像素的屏幕坐标。）

如果你想放大屏幕的一个区域，你想做同样的事情：获取左上角和右下角区域的屏幕坐标，将它们转换为复平面坐标，然后使那些新的 uleft 和 lright 变量。即放大由屏幕坐标 (x1,y1)..(x2,y2) 分隔的框，使用：

```
new_uleft = (uleft[0] + (x1/size[0]) * (xwidth), uleft[1] - (y1/size[1]) * (ywidth))
new_lright = (uleft[0] + (x2/size[0]) * (xwidth), uleft[1] - (y2/size[1]) * (ywidth)) 
```

（显然您需要根据新坐标重新计算大小、xwidth、ywidth 和其他因变量）

如果您好奇，mandelbrot 集背后的数学并没有那么复杂（只是复杂）。它所做的只是取一个特定的坐标，把它当作一个复数，然后反复平方它并将原始数字加到它上面。

对于某些数字，这样做会导致结果发散，在您重复该过程时不断向无穷大增长。对于其他人，它将始终保持在某个水平以下（例如，显然 (0.0, 0.0) 在此过程中永远不会变大。曼德布罗集（黑色区域）是那些不发散的坐标。已经证明，如果任何数字超过 5 的平方根，它都会发散 - 您的代码只是用作(~ )`2.0`的近似值，但这不会产生太大的差异。 `sqrt(5)``2.236`

通常，分歧的区域会绘制出它们超过该值（`trials`代码中的变量）所需的过程迭代次数，这就是产生彩色区域的原因。

# c# - 代码生成器或 T4 模板，它们真的很邪恶吗？

> ID：524295
> 
> 赞同：10
> 
> 时间：2009-02-07T18:24:23.497
> 
> 标签：c#, generics, code-generation, t4

我听说人们说不应使用代码生成器和 T4 模板。这背后的逻辑是，如果您使用生成器生成代码，那么通过泛型和模板构建代码会有更好更有效的方法。

虽然我稍微同意上面的这个说法，但我还没有真正找到有效的方法来构建可以说例如实例化自己的模板。换句话说，我永远做不到：

```
return new T(); 
```

此外，如果我想根据数据库值生成代码，我发现`Microsoft.SqlServer.Management.SMO`与 T4 模板结合使用非常适合生成大量代码，而无需复制/粘贴或使用 resharper。

我在泛型中也发现了许多问题，令我震惊的是，有很多开发人员不理解它们。当我为解决方案检查泛型时，有时它会变得复杂，因为 C# 声明你不能做一些在我看来似乎合乎逻辑的事情。

你怎么认为？您更喜欢构建生成器，还是更喜欢使用泛型？另外，泛型能走多远？我对泛型有相当多的了解，但是我总是遇到一些陷阱和陷阱，这导致我求助于 T4 模板。

处理需要大量灵活性的场景的更合适方法是什么？哦，作为这个问题的奖励，关于 C# 和泛型的好资源是什么？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-02-07T18:51:34.067

你可以做 new T(); 如果你这样做

```
public class Meh<T>
  where T : new()
{
  public static T CreateOne()
  {
    return new T();
  }
} 
```

至于代码生成器。我每天使用一个，没有任何问题。事实上，我现在正在使用一个:-)

泛型解决一个问题，代码生成器解决另一个问题。例如，使用 UML 编辑器创建业务模型，然后使用持久性代码生成类，就像我一直使用[此工具](http://capableobjects.com/ProductsServices_ECO.aspx)所做的那样，使用泛型无法实现，因为每个持久性类都是完全不同的。

至于泛型的良好来源。最好的当然是[Jon Skeet 的书](https://rads.stackoverflow.com/amzn/click/com/1933988363)！:-)

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2011-06-04T20:21:00.390

作为 T4 的鼻祖，我不得不为这个问题辩护好几次，你可以想象 :-)

我的信念是，最好的代码生成是使用可重用库产生等效价值的一步。

正如许多其他人所说，维护 DRY 的关键概念永远不会手动更改生成的代码，而是保留在源元数据更改或在代码生成器中发现错误时重新生成的能力。此时生成的代码具有目标代码的许多特征，您不会遇到复制/粘贴类型问题。

一般来说，生成参数化代码生成器（尤其是基于模板的系统）比正确设计一个将使用成本降低到相同水平的高质量基础库要少得多，因此它是一种快速获取从一致性中获取价值并消除重复错误。

然而，我仍然相信最终的系统通常会通过减少总代码来改进。如果不出意外，它的内存占用几乎总是要小得多（尽管人们倾向于认为泛型在这方面是免费的，但他们肯定不是）。

如果您已经使用代码生成器实现了一些价值，那么这通常会为您赢得一些时间、金钱或善意来投资从生成的代码库中获取库。然后，您可以逐步重新设计代码生成器以针对新库并希望生成更少的代码。冲洗并重复。

对我提出的一个有趣的对立点是，就学习曲线而言，丰富、复杂的参数库并不是最简单的事情，尤其是对于那些没有深入沉浸在平台中的人来说。坚持在更简单的基本框架上生成代码会产生冗长的代码，但它通常非常简单且易于阅读。

当然，如果您的生成器中有很多差异和极其丰富的参数化，您可能只是在牺牲产品的复杂性来换取模板的复杂性。这是一个容易滑入的路径，并且可能使维护同样令人头疼 - 请注意这一点。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-02-07T20:19:13.860

生成代码并不邪恶，也没有异味！关键是在正确的时间生成正确的代码。我认为 T4 很棒——我只是偶尔使用它，但当我使用它时非常有帮助。要说，无条件地生成代码是坏的，这简直是疯了！

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-02-07T20:41:35.263

在我看来，只要代码生成是您正常构建过程的一部分，而不是您运行一次然后保留其输出的东西，代码生成器就可以了。我添加这个警告是因为如果只使用一次代码生成器并丢弃创建它的数据，那么您只会自动创建大量的 DRY 违规和维护问题；而每次有效地生成代码意味着您用于生成的任何东西都是真正的源代码，并且生成的文件只是中间编译阶段，您应该大多忽略。

Lex 和 yacc 是允许您以有效方式指定功能并从中生成高效代码的工具的经典示例。尝试手工完成他们的工作会延长您的开发时间，并且可能会产生效率较低且可读性较差的代码。虽然您当然可以将 lex 和 yacc 之类的东西直接合并到您的代码中，并在运行时而不是在编译时完成它们的工作，但这肯定会给您的代码增加相当大的复杂性并减慢它的速度。如果您确实需要在运行时更改规范，这可能是值得的，但在大多数正常情况下，使用 lex/yacc 在编译时为您生成代码是一个巨大的胜利。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2012-04-12T00:40:46.740

如果没有代码生成，Visual Studio 2010 中的大部分内容都是不可能的。实体框架是不可能的。将控件拖放到窗体上的简单行为是不可能的，Linq 也不可能。说不应该使用代码生成是很奇怪的，因为很多人甚至没有考虑它就使用它。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-02-07T18:59:32.507

也许这有点刺耳，但对我来说代码生成有异味。

使用代码生成意味着有许多潜在的共同原则可以用“不要重复自己”的方式来表达。这可能需要更长的时间，但是当您基于包含机制的基础架构最终获得仅包含真正更改的位的类时，这是令人满意的。

至于泛型......不，我没有太多问题。目前唯一不起作用的就是说

```
List<Animal> a = new List<Animal>();
List<object> o = a; 
```

但即便如此，在下一版本的 C# 中也是可能的。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2011-06-02T08:33:25.327

代码生成对我来说是解决语言、框架等中发现的许多问题的一种解决方法。它们本身并不是邪恶的，我想说发布一种语言（C#）和框架是非常非常糟糕（即邪恶）的复制和粘贴（交换属性、事件触发、缺少宏）或使用魔法数字（wpf 绑定）。

所以，我哭了，但我使用它们，因为我必须这样做。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2011-11-22T07:20:38.257

我使用 T4 进行代码生成以及泛型。两者都很好，各有利弊，并且适用于不同的目的。

就我而言，我使用 T4 基于数据库模式生成实体、DAL 和 BLL。但是，DAL 和 BLL 引用了我基于泛型和反射构建的 mini-ORM。所以我认为你可以并排使用它们，只要你保持控制并保持小而简单。

T4 生成静态代码，而泛型是动态的。如果您使用泛型，则使用反射，据说它的性能低于“硬编码”解决方案。当然你可以缓存反射结果。

关于“return new T();”，我使用这样的动态方法：

```
public class ObjectCreateMethod
    {
    delegate object MethodInvoker();
    MethodInvoker methodHandler = null;

    public ObjectCreateMethod(Type type)
    {
        CreateMethod(type.GetConstructor(Type.EmptyTypes));
    }

    public ObjectCreateMethod(ConstructorInfo target)
    {
        CreateMethod(target);
    }

    void CreateMethod(ConstructorInfo target)
    {
        DynamicMethod dynamic = new DynamicMethod(string.Empty,
                    typeof(object),
                    new Type[0],
                    target.DeclaringType);
        ILGenerator il = dynamic.GetILGenerator();
        il.DeclareLocal(target.DeclaringType);
        il.Emit(OpCodes.Newobj, target);
        il.Emit(OpCodes.Stloc_0);
        il.Emit(OpCodes.Ldloc_0);
        il.Emit(OpCodes.Ret);

        methodHandler = (MethodInvoker)dynamic.CreateDelegate(typeof(MethodInvoker));
    }

    public object CreateInstance()
    {
        return methodHandler();
    }
} 
```

然后，我这样称呼它：

```
ObjectCreateMethod _MetodoDinamico = new ObjectCreateMethod(info.PropertyType);
object _nuevaEntidad = _MetodoDinamico.CreateInstance(); 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-02-07T18:55:44.777

更多的代码意味着更多的复杂性。更高的复杂性意味着有更多的地方可以隐藏错误，这意味着更长的修复周期，这反过来意味着整个项目的成本更高。

只要有可能，我宁愿尽量减少代码量以提供等效的功能；理想情况下使用动态（程序化）方法而不是代码生成。反射、属性、方面和泛型为 DRY 策略提供了许多选项，将生成作为最后的手段。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-02-07T19:20:32.807

泛型和代码生成是两个不同的东西。在某些情况下，您可以使用泛型而不是代码生成，而我认为您应该这样做。对于其他情况，代码生成是一种强大的工具。

对于您只需要根据一些数据输入生成代码的所有情况，代码生成都是可行的方法。最明显但绝不是唯一的例子是 Visual Studio 中的表单编辑器。这里输入是设计器数据，输出是代码。在这种情况下，泛型确实没有任何帮助，但是 VS 简单地根据 GUI 布局生成代码是非常好的。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-06-03T02:18:54.373

代码生成器可以被认为是一种代码气味，表明目标语言存在缺陷或缺乏功能。

例如，虽然这里已经说过“持久化的对象不能泛化”，但最好将其视为“C# 中自动持久化其数据的对象不能在 C# 中泛化”，因为我当然可以在 Python 中通过使用各种方法。

但是，可以通过使用 operator[ ](method_name as string) 在静态语言中模拟 Python 方法，该方法根据要求返回函子或字符串。不幸的是，该解决方案并不总是适用，并且返回函子可能不方便。

我要说的一点是，代码生成器表明了所选语言中的缺陷，通过为手头的特定问题提供更方便的*专用*语法来解决这些缺陷。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2011-09-28T18:57:31.273

生成代码的复制/粘贴类型（如 ORM 制作）也非常有用......

您可以创建数据库，然后让 ORM 生成以您喜欢的语言表达的该数据库定义的副本。

当您更改原始定义（数据库）时，优势就来了，按编译，ORM（如果您有一个好的）可以重新生成您的定义副本。现在，编译器类型检查器可以检查对数据库的所有引用，并且当您使用不再存在的表或列时，您的代码将无法编译。

想一想：如果我在代码中多次调用一个方法，我不是指的是我最初给这个方法起的名字吗？我一遍又一遍地重复这个名字……语言设计者意识到了这个问题，并提出了“类型安全”作为解决方案。不删除副本（正如 DRY 建议我们应该做的那样），而是检查它们的正确性。

ORM 生成的代码在引用表名和列名时带来了相同的解决方案。不删除副本/引用，而是将数据库定义带入您的（类型安全）语言中，您可以在其中引用类和属性。与编译器类型检查一起，这以类似的方式解决了类似的问题：当您引用过时或拼写错误的表（类）或列（属性）时，保证编译时错误而不是运行时错误。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2011-09-28T19:15:24.580

引用：我还没有真正找到有效的方法来构建可以说例如实例化自己的模板。换句话说，我永远做不到：

返回新的 T();

```
public abstract class MehBase<TSelf, TParam1, TParam2>
    where TSelf : MehBase<TSelf, TParam1, TParam2>, new()
{
    public static TSelf CreateOne()
    {
        return new TSelf();
    }
}

public class Meh<TParam1, TParam2> : MehBase<Meh<TParam1, TParam2>, TParam1, TParam2>
{
    public void Proof()
    {
        Meh<TParam1, TParam2> instanceOfSelf1 = Meh<TParam1, TParam2>.CreateOne();
        Meh<int, string> instanceOfSelf2 = Meh<int, string>.CreateOne();
    }
} 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-02-07T19:11:44.900

为什么能够复制/粘贴真的非常快，让它更容易被接受？

这是我能看到的代码生成的唯一理由。

即使生成器提供了您需要的所有灵活性，您仍然必须学习如何使用这种灵活性 - 这是另一个需要学习和测试的层。

即使它在零时间内运行，它仍然会使代码膨胀。

我推出了自己的数据访问类。它知道关于连接、事务、存储过程参数等的一切，我只需要编写所有 ADO.NET 的东西。

自从我不得不编写（甚至查看）其中包含连接对象的任何内容以来已经很长时间了，以至于我很难临时记住语法。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2009-02-07T19:37:12.663

代码生成，如泛型、模板和其他此类快捷方式，是一个强大的工具。与最强大的工具一样，它增强了用户的善恶能力——它们是不可分割的。

因此，如果您彻底了解您的代码生成器，预测它将产生的所有内容以及原因，并且出于正当理由打算这样做，那么就去做吧。但是不要使用它（或任何其他技术）让你经过一个你不确定你要去哪里或如何到达那里的地方。

有些人认为，如果你解决了当前的问题并实施了一些行为，那么你就是金子。您为下一个开发人员（可能是您自己）留下了多少不透明和不透明的痕迹并不总是很明显。

# file - 存储与单个文件关联的元数据的方法？

> ID：524302
> 
> 赞同：11
> 
> 时间：2009-02-07T18:27:45.520
> 
> 标签：file, language-agnostic, metadata

给定一组具有关联元数据的文件，存储此元数据的推荐方法是什么？

某些文件格式支持内部存储元数据（EXIF、ID3 等），但并非所有文件格式都支持这一点，那么还有哪些更通用的选项？

一些元数据几乎肯定是唯一的（标题/描述/等），而有些元数据会在不同程度上重复（类别/标签/等）。
如果需要不同类型的属性，对元数据进行分组也可能很有用。

理想情况下，解决方案应该涵盖概念，而不是特定的语言实现。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-26T23:35:42.210

将元数据存储在数据库中具有一些优势，但数据库的主要问题是元数据没有直接连接到您的数据。如果元数据与数据保持一致，例如目录中的特殊文件或类似的东西，它会更加健壮。

一些文件系统提供可用于元数据的特殊功能，例如[NTFS 备用流](http://www.flexhex.com/docs/articles/alternate-streams.phtml)。不幸的是，这只能在特殊情况下用于元数据存储，因为当将数据复制到不支持它的存储系统时，这些流很容易丢失。我相信linux文件系统也有类似的存储机制。

无论如何，最常见的解决方案是：

*   **包含元数据**的单独隐藏文件（每个目录）****
***   一些应用程序使用带有元数据的**特殊隐藏目录**（如颠覆、cvs 等）。*   或所有应用程序特定元数据的**数据库**（各种） - 在大多数情况下，此数据库也可用于缓存目的**

 **IMO 没有通用解决方案。我会选择将元数据存储在隐藏文件中（稳健性），并使用数据库进行快速访问和缓存。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-05-20T16:39:27.350

我认为“解决方案”在很大程度上取决于您将如何处理元数据。

例如，我们存储的几乎所有元数据（科学数据的多个数据集）都被切碎并存储在数据库中。这允许我们创建数据集以保留文件之间的通用元数据（如您所说，类别和标签），同时我们具有文件特定的结构（标题、开始/停止时间、最小/最大值等）虽然我们可以将这些保留在隐藏文件，我们进行大量搜索，并通过网络服务向外部消费者开放我们的界面。

如果您要存储不会被搜索的元数据，隐藏文件或每个“真实”文件的专用 .xml 文件并不是一个糟糕的选择。它基本上可以被任何东西读取，可以轻松转换为不同的格式，并且如果您决定更改存储机制也不会丢失。

元数据应该帮助你，而不是阻碍你。我已经看到（并且是其中的一部分）元数据存储变得比存储实际数据更繁重的系统，并成为一种负担。只要记住你想用它做什么，不要用“假设”来过度扩展自己。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-07T18:28:23.410

一种选择可能是关系数据库，其结构如下：

```
FILE
f_id
f_location
f_title
f_description

ATTRIBUTE
a_id
a_label

VALUE
v_id
v_label

METADATA
md_file
md_attribute
md_value 
```

此实现具有一些独特的信息（标题/描述），但主要针对重复的数据组。

对于某些要求，其他不太通用的表可能更有用。

* * *

这样做的好处是关系数据库非常普遍，并且显然非常擅长处理关系和存储大量数据。

但是，对于某些用途，数据库服务器会带来可能不希望出现的开销。此外，数据库服务器与文件不同——它们不会坐在一起，并且需要不同的交互方法。

数据库不会（轻易地）处于版本控制之下——这可能是好事也可能是坏事，这取决于您的观点和特定需求。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-08T16:39:32.087

纯文本比其他任何东西都有一些明显的优势。就像是

```
FileName = 'ferrari.gif'
Title = 'My brand new car'
Tags = 'cars', 'cool'
Related = 'michaelknight.mp3' 
```

Picasa 的 Picasa.ini 文件就是这种元数据的一个很好的例子。此外，与其发明自己的格式，不如考虑使用 XML。有很多现成的 DOM 处理器可以处理这种格式。

再说一次，如果文件的数量和它们之间的关系很大，那么数据库可能会更好。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2015-01-20T09:01:47.367

我基本上会制作一个包含这些信息的元数据数据库：

**RESOURCE_TABLE**
RESOURCE_ID
RESOURCE_TYPE（文件夹、文档类型、Web 链接、其他）
RESOURCE_URL（任何 URL）

**NOTES_TABLE**
NOTE_ID
RESOURCE_NO
RESOURCE_NOTE（长文本）

**TAGS_TABLE**
TAG_ID
RESOURCE_NO
TAG_TEXT

然后我会使用文件/文件夹/资源的注释字段文本注释。选择是否为此使用 1:1 或 1:N。

我将使用标签字段来存储任意数量的可搜索参数，例如 YEAR、PROJECT 和其他将描述和分组您的内容的值。

然后，您可以为所有者、利益相关者和其他组织信息等添加表格。

# perl - 如何调用绑定变量的方法？

> ID：524308
> 
> 赞同：5
> 
> 时间：2009-02-07T18:29:13.660
> 
> 标签：perl, object, tie

我刚刚开始学习**tie**。我有一个名为 Link 的类，我想做以下事情：

*   如果获取，则返回链接的地址
*   如果存储，存储新地址
*   能够调用它的方法

到目前为止，我的代码是：

```
 package Link;

sub FETCH {
    my $this = shift;
    return $this->{"site"};
}

sub STORE {
    my ($self,$site) = @_;
    $self->{"site"}   = $site;
}

sub print_method {
    my $self = shift;
    print $self->{"site"};
}

sub TIESCALAR {
    my $class = shift;
    my $link  = shift;
    my $this  = {};
    bless($this,$class);
    $this->{"site"} = $link;
    return $this;
}

1; 
```

我用来检查功能的代码是：

```
 use Link;

tie my $var,"Link","http://somesite.com";
$var->print_method; 
```

运行时，脚本将终止并出现以下错误： **Can't call method "print_method" without a package or object reference at tietest.pl line 4.** .

如果我正确理解它的消息，则解析为调用**`$var->print_method`**该方法的某个字符串。**`print_method`**我怎么能从 tie 中受益，同时也将变量用作对象？

编辑：经过一番试验，我发现如果我在 fetch 上返回 $self ，我可以调用方法，但是 fetch 不会返回地址。

编辑 2：perl 僧侣为我提供了解决方案：**并列**。绑定将返回对对象 VARIABLE 的引用。

通过结合我的方法，我可以完成我想要的一切。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-02-07T21:32:14.040

领带是这项工作的错误工具。当您想要与普通数据类型相同的接口但想要自定义操作如何工作时，您可以使用 tie。由于您想像标量一样访问和存储字符串，因此 tie 不会为您做任何事情。

看起来你想要[URI](http://search.cpan.org/dist/URI)模块，或者它的子类，也许还有一些重载。

如果你真的需要这样做，你需要使用正确的变量。[tie](http://perldoc.perl.org/functions/tie.html)将您指定的变量与您指定的类挂钩，但它仍然是一个普通的标量（而不是引用）。如果要调用方法，则必须使用它返回的对象：

```
my $secret_object = tie my($normal_scalar), 'Tie::Class', @args;
$secret_object->print_method; 
```

如果您只有绑定的标量，您还可以获得秘密对象：

```
my $secret_object = tied $normal_scalar; 
```

我在[Mastering Perl](http://oreilly.com/catalog/9780596527242/)有一整章是关于 tie 的。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-02-07T19:49:58.380

我建议制作一个普通的 Perl 对象，然后[重载](http://perldoc.perl.org/overload.html)字符串化。您失去了通过赋值存储值的能力，但保留了通过打印对象来获取值的能力。一旦你开始想要直接调用方法，一个对象可能就是你想要的。

```
package Link;

use strict;
use Carp;

use overload
(
  '""'      => sub { shift->site },
   fallback => 1,
);

sub new 
{
  my $class = shift;

  my $self = bless {}, $class;

  if(@_)
  {
    if(@_ == 1)
    {
      $self->{'site'} = shift;
    }
    else { croak "$class->new() expects a single URL argument" }
  }

  return $self;
}

sub site
{
  my $self = shift;
  $self->{'site'} = shift  if(@_);
  return $self->{'site'};
}

sub print_method
{
  my $self = shift;
  print $self->site, "\n";
}

1; 
```

示例用法：

```
use Link;

my $link = Link->new('http://somesite.com');

print $link, "\n";   # http://somesite.com
$link->print_method; # http://somesite.com 
```

如果您真的非常希望分配也可以工作，您可以将普通对象与重载字符串化（`Link`上面的）与`tie`：

```
package LinkTie;

use strict;
use Link;

sub FETCH
{
  my $this = shift;
  return $this->{'link'};
}

sub STORE
{
  my($self, $site) = @_;
  $self->{'link'}->site($site);
  return $site;
}

# XXX: You could generalize this delegation with Class::Delegation or similar
sub print_method
{
  my $self = shift;
  print $self->{'link'}->print_method;
}

sub TIESCALAR
{
  my $class = shift;
  my $self = bless {}, $class;
  $self->{'link'} = Link->new(@_);
  return $self;
}

1; 
```

示例用法：

```
tie my $link,'LinkTie','http://somesite.com';
print $link, "\n";   # http://somesite.com
$link->print_method; # http://somesite.com

$link = 'http://othersite.com';

print $link, "\n";   # http://othersite.com
$link->print_method; # http://othersite.com 
```

这一切都非常可怕，而且还有很长的路要走，只是为了获得可疑的能力来分配你也可以调用方法并按原样打印的东西。带有字符串化的标准 URI 对象可能是更好的选择。

# asp.net - Asp.net电子商务表现

> ID：524320
> 
> 赞同：2
> 
> 时间：2009-02-07T18:33:29.110
> 
> 标签：asp.net, e-commerce

我正在使用 C# 在 Asp.Net 3.5 上开发电子商务项目。我正在使用 3 层（数据 + 业务 + UI）结构来访问数据库中的数据（Msql 2005）。

有存储过程和所有的事情。（CRUD方法）

这里存在性能问题，项目运行缓慢。我在事务模型中找不到任何问题。

该项目也在海外共享主机上运行。数据库服务器和Web服务器运行在不同的机器上。数据库服务器有近1000个数据库。

我如何测试和了解问题出在哪里？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-07T18:48:46.380

由于有超过 1000 个数据库共享资源，我会采取可能是您的问题的尝试……如果您连接到数据库并且运行一个简单的查询需要 5 秒钟，那么您可以猜到问题所在。

我会在您的网络服务器上运行的“测试页”上添加一些秒表功能。这应该为您提供基本信息，以查看在等待数据库返回您的查询时是否存在“瓶颈”。如果你已经做到了那么我怀疑它会是你的网络服务器。

您的最后一个选择是设置一个简单的低规格机器，上面有数据库和 Web 服务器，然后进行测试。根据您的网站获得的流量，您应该能够很好地了解其响应时间。

[YSlow](http://developer.yahoo.com/yslow/)之类的工具也可能会有所帮助，但这些工具通常更多地用于微调。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-07T18:48:04.387

由于您在共享托管服务上运行，我猜这就是您的问题所在。您正在与这些服务器上的所有其他网站和数据库竞争服务器资源。

为了确保，我会设置一个模仿您的生产环境的本地环境。然后执行一些标准的压力测试，看看它的表现如何。如果它按照您的预期执行，那么它可能是您的托管解决方案。

使用共享托管解决方案，您确实物有所值。如果它是一个需要更快速度的系统，那么您应该考虑一个专用的托管解决方案。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-07T18:53:55.107

我建议你看看 Tracing：

[http://davidhayden.com/blog/dave/archive/2005/07/17/2396.aspx](http://davidhayden.com/blog/dave/archive/2005/07/17/2396.aspx)

这使您能够查看堆栈跟踪（文章中的最后一张图片），并定位您的性能瓶颈。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-24T18:54:51.717

我开发的用于在我的 Web 应用程序上保存性能日志的快速解决方案可能会对您有所帮助。我有一个运行类似应用程序的 Web 服务器和数据库服务器。我编写了一个运行“基准测试”存储过程并返回运行时间的 Web 服务。我编写了一个在我的开发服务器上运行的 win 应用程序，它调用 Web 服务，将要运行的存储过程的名称传递给它，并计算整个请求所需的时间。win 应用程序将数据写入日志文件，并作为计划任务每​​ 10 分钟运行一次。额外的花里胡哨包括当性能连续 3 次超过指定阈值、连接失败以及在缓慢的一段时间后恢复到正常性能时，自动向团队成员发送电子邮件。

This provides a general indication of how a user's experience on the website will be at any given time and serves as a warning bell for the team. Not exactly the best solution, but I wrote it in a couple of hours several months ago and have used the data it creates for troubleshooting purposes many times.

# programming-languages - OpenGL UI 原型设计的正确语言。抛弃 Python

> ID：524330
> 
> 赞同：0
> 
> 时间：2009-02-07T18:40:15.057
> 
> 标签：programming-languages, prototyping

所以，我有了这个想法，我会尝试使用 OpenGL 和一些物理特性来制作一个实验性用户界面的原型。我对这两个主题都知之甚少，但对 C++、Java 和 C# 等编程语言非常有经验。经过一些初步研究，我决定使用 Python（使用 Eclipse/PyDev）和 Qt，这两个对我来说都是新的，现在有四个不同的主题可以或多或少地同时学习。

我已经在 OpenGL 和 Python 方面取得了相当大的进展，但是虽然 Python 及其生态系统最初似乎非常适合这项任务，但我现在发现了一些严重的缺点。糟糕的 API 文档和缺乏代码完成（由于动态类型），当每个模块有一个类时，必须导入我在每个其他模块中使用的每个模块变得乏味，必须选择正确的模块来运行程序，并且必须等待 30在收到许多明显的拼写错误和其他错误的通知之前，程序启动并隐藏 IDE 的秒数。它变得非常烦人非常快。坦率地说，我不明白所有的绒毛是关于什么的。Lambda 函数、列表推导等都很好，但当然还有更重要的事情。

因此，除非任何人都可以至少解决其中的一些烦恼，否则 Python 就出局了。出于显而易见的原因，C++ 也被淘汰了，而 C# 也被淘汰了，主要是因为缺乏可移植性。这使得 Java 和 JOGL 成为一个有吸引力的选择，但我也对 Ruby 和 Groovy 感到好奇。不过，我想听听您对这些和其他人的看法，以防止我再次犯同样的错误。

要求是：

*   让地狱远离我。
*   良好的代码完成。完整的方法签名，包括数据类型和参数名称。
*   良好的 OpenGL 支持。
*   Qt 支持更可取。
*   面向对象
*   适用于 RAD、原型设计
*   跨平台
*   最好是开源的，但至少是免费的。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-07T21:17:18.703

看来您主要不是 Python 本身的问题，而是 IDE 的问题。

*“错误的 API 文档”*

到什么API？Python 本身、Qt 或您正在使用的其他库？

*“缺少代码完成（由于动态类型）”*

只要您不做任何魔术，我发现 PyDev 非常擅长解决这些问题。如果它丢失了，您总是可以通过以下方式输入提示：

```
assert isinstance(myObj, MyClass) 
```

然后，即使 myObj 来自动态上下文，PyDev 也会为您提供代码完成。

*“当每个模块有一个类时，必须导入我在每个其他模块中使用的每个模块会变得乏味”*

安装 PyDev Extensions，它具有动态自动导入功能。或者在一个单独的模块中收集所有导入并执行以下操作：

```
from mymodulewithallimports import * 
```

*“必须选择正确的模块来运行程序”*

在 Eclipse 中，您可以设置一个默认的启动文件，或者只选中“使用上次运行配置”。然后你永远不必再次选择它。

*“在被告知许多明显的拼写错误和其他错误之前”*

安装 PyDev Extensions，它有更高级的语法检查，并且会很高兴地通知您未使用的导入/变量、未初始化的变量等。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-07T19:07:21.773

只看你的清单，我会推荐 C++；特别是因为代码完成对您来说非常重要。

关于 Python：虽然我很少使用 Python 进行 OpenGL 编程（使用 C++），但 Python 社区为 OpenGL 开发提供了许多有趣的模块：[pyopengl](http://pyopengl.sourceforge.net/)、[pyglew](https://launchpad.net/pyglew)、[pygpu](http://www.cs.lth.se/home/Calle_Lejdfors/pygpu/)；仅举几个。

顺便说一句，您的导入问题可以通过导入模块所在`__init__.py`目录的文件中的模块轻松解决​​，然后只需导入“父”模块。不建议这样做，但仍然可以。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-06-15T19:03:34.847

我不明白为什么没有人听说过 D 编程语言？

这是完美的解决方案！！！！

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-07T21:46:10.720

Consider [Boo](http://boo.codehaus.org/) -- it has many of Python's advantages while adopting features from elsewhere as well, and its compile-time type inference (when variables are neither explicitly given a specific type or explicitly duck typed) allows the kind of autocompletion support you're asking about.

The [Tao.OpenGL](http://taoframework.com/) library exposes OpenGL to .NET apps (such as those Boo compiles), with explicit support for Mono.

(Personally, I'm mostly a Python developer when not doing C or Java, but couldn't care less about autocompletion... but hey, it's your question; also, the one-class-per-module convention seems like a ridiculous amount of pain you're putting yourself through needlessly).

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-07T21:17:54.553

我开始使用 GL4Java 进行 OpenGL 编程，它已迁移到 JOGL，您绝对应该尝试一下 (JOGL)。Java 提供了您需要的大部分功能（加上 Eclipse 为您提供代码完成功能），特别是对于 JOGL，有很多教程可以帮助您入门。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-07T19:00:28.573

如果你想要所有这些东西，唯一真正的选择是使用 Java，但老实说，你对特性有点挑剔。代码完成真的那么重要吗？您列出的其他所有内容在传统上都非常受 Python 好评，所以我没有看到这个问题。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-07T20:10:53.767

我使用的文本编辑器（甚至不是 IDE）允许您导入 API 函数定义。代码完成不是一种语言特性，尤其是对于 OpenGL。只需键入`gl[Ctrl+I]`，您就会得到选项。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-02-07T20:24:00.900

我曾经尝试过使用 Java3D 和 java。我意识到 Java3D 是一个典型的 Java API……有很多对象可以做简单的事情，而且因为它是 Java，所以可以转换成很多代码。然后我转移到 Eclipse 中的 Jython，它清理了代码，只剩下 Java3D 的复杂性。

所以最后，我朝相反的方向走。与纯 python 相比，它的一个优点是我可以将 Java 与 Eclipse 的所有优点（如自动完成）一起使用，并在 Java 中的部件变得笨拙时将其移至 python。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-02-07T20:25:54.843

[Pydev](http://pydev.sourceforge.net/)似乎可以在 Eclipse 中为您提供代码完成功能。

# c++ - 如何将哈希表存储在文件中？

> ID：524342
> 
> 赞同：19
> 
> 时间：2009-02-07T18:51:38.590
> 
> 标签：c++, algorithm, serialization, data-structures, hashtable

如何将具有单独链接的哈希表存储在磁盘上的文件中？

在运行时生成存储在哈希表中的数据很昂贵，从磁盘加载 HT 会更快……如果我能弄清楚如何去做的话。

编辑：查找是在内存中加载的 HT 完成的。我需要找到一种方法将哈希表（在内存中）以某种二进制格式存储到文件中。这样下次程序运行时，它就可以将 HT 从磁盘加载到 RAM 中。

我正在使用 C++。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-07T18:57:07.783

您使用什么语言？常见的方法是进行某种二进制序列化。

好的，我看到您已编辑添加语言。对于 C++，有几个选项。我相信Boost序列化机制是相当不错的。此外，Boost 的序列化库页面也描述了替代方案。链接在这里：

[http://www.boost.org/doc/libs/1_37_0/libs/serialization/doc/index.html](http://www.boost.org/doc/libs/1_37_0/libs/serialization/doc/index.html)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-07T19:02:33.357

假设 C/C++：使用数组索引和固定大小的结构而不是指针和可变长度分配。您应该能够直接将数据结构写入（）到文件中以供以后读取（）。

对于任何更高级别的东西：许多高级语言 API 都具有序列化功能。Java 和 Qt/C++ 都有可以立即想到的方法，所以我知道其他人也这样做。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-02-07T19:06:37.420

[您可以通过使用序列化（例如在 Java 中](http://java.sun.com/docs/books/tutorial/essential/io/objectstreams.html)）将整个数据结构直接写入磁盘。但是，您可能被迫将整个对象读回内存以访问其元素。如果这不切实际，那么您可以考虑使用[随机访问](http://en.wikipedia.org/wiki/Random_access)文件来存储哈希表的元素。您只需使用文件中的字节位置，而不是使用指针来表示链中的下一个元素。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-02-07T23:09:51.580

# 放弃索引的指针。

这有点类似于构建磁盘上的[DAWG](https://en.wikipedia.org/wiki/Deterministic_acyclic_finite_state_automaton)，这是我不久前所做的。让它如此美妙的是它可以直接用 mmap 加载，而不是读取文件。如果哈希空间是可管理的，比如 2 ^(16)或 2 ^(24)个条目，那么我想我会做这样的事情：

*   保留免费索引列表。（如果表为空，每个链索引将指向下一个索引。）
*   当需要链接时，请使用表中的可用空间。
*   如果您需要将某些内容放入被擅自占地者（从其他地方溢出）占用的索引中：
*   记录索引（我们称它为N）
*   交换新元素和寮屋
*   将擅自占地者放入新的免费索引中，（F）。
*   沿着squatter哈希索引上的链，将N替换为F。
*   If you completely run out of free indices, you probably need a bigger table, but you can cope a little longer by using mremap to create extra room after the table.

This should allow you to mmap and use the table directly, without modification. (scary fast if in the OS cache!) but you have to work with indices instead of pointers. It's pretty spooky to have megabytes available in syscall-round-trip-time, and still have it take up less than that in physical memory, because of paging.

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-07T19:05:58.967

也许[DBM](http://en.wikipedia.org/wiki/Berkeley_DB)可能对您有用。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-07T20:05:31.547

如果您的哈希表实现很好，那么只需存储哈希和每个对象的数据 - 考虑到哈希，将对象放入表中不应该很昂贵，并且不直接序列化表或链可以让您在保存之间改变确切的实现并加载。

# c# - 仅使用 wifi 信号确定您的位置？

> ID：524351
> 
> 赞同：5
> 
> 时间：2009-02-07T18:57:50.823
> 
> 标签：c#, .net, wireless, wifi

我将从事一个项目，该项目试图使用来自几个接入点的 wifi 信号强度来确定你的位置。我想知道是否有人知道任何类似的项目或关于该主题的任何文章

如果有人在乎：这是我大学的一个研究项目。编写的应用程序用作开发更适合此类用途的新 wifi 天线的游乐场。我只从事项目的编码部分。哦，它是用 c# 编写的，这不是可选的

* * *

澄清：它唯一的wifi。对我们来说没有 GPS 优势，因为它应该在室内工作 该软件应该通过使用接入点的已知位置及其信号强度来确定您的位置，从而告诉您您在哪里。它目前的精度约为 4-5 米，除此之外我已经有了一个工作原型，只是想知道之前是否做过类似的事情，或者是否有人对这个项目有任何提示或想法

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-07T19:20:51.997

放弃前两个答案，他们需要在第一个中使用 GPS 和 A-GPS，在第二个中使用已知的 WiFi 网络，我的答案是：

这听起来很简单，但你需要先做一些功课，一个调查。

*   您将需要测量并创建一个椭圆形（在纸上），其中包含营地中所有 wifi 路由器的点数和百分比。
*   什么时候，让我们假设你编译了 2 个路由器信息，你准备好了。
*   从用户笔记本电脑/设备获取当前 wifi 点和信号强度，并使用这些值查询数据库。
*   给用户他们当前的位置。

例子：

*   在校园酒吧中，您测量到要在那个地方，您需要有大约 55% 的 WiFi 路由器 1 和 25% 的 WiFi 路由器 2 提供的信号强度。

要在 C# 中使用所有这些，您应该从[这篇代码项目文章](http://www.codeproject.com/KB/gadgets/SignalStrenghth.aspx)开始获取信号强度。然后只需将这些返回值与您在进行第一次调查时测量的数据一起使用。

希望它有所帮助:) 至少，为了解决这个问题，我会这样做。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-08T01:21:54.263

我们在一个已经确定与接入点的距离的项目上执行了此操作，但没有信号三角测量（此处已涵盖其他答案）。

我确实有来自“伙计，我希望我不必回去做这个”部门的建议——那就是在两个方面花更多的时间：

1.  **一种使用多个数据点**的简单且可重复的校准方法。例如，从“非常接近”到“有点接近”的下降将远远超过从“非常远”到“非常非常远”的距离。它不会是线性斜率。
2.  数据平滑。当您移动时，信号强度将与您的移动不成比例地变化（由于路径中的障碍物）。如果您对信号强度的最后 5-10 个样本进行滚动平均，而不是仅取最后一个样本，这将使您的结果更加准确。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-07T19:04:10.827

您可能想查看[Google Gears Geolocation API](http://google-code-updates.blogspot.com/2008/10/introducing-gears-geolocation-api-for.html)。我不知道从 C# 中使用它有多容易，但它可能有用/相关。

（免责声明：我为 Google 工作，但与 Geolocation API 没有任何关系。）

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-07T20:11:25.183

我不会认为信号强度会很好：太多的东西会干扰它（比如墙壁）。但是您可以尝试测量 ping 时间，尤其是当您向 AP 发送 100 次 ping 并取平均值时。大多数情况下，AP 会消化 ping 并生成 pong，但也会有信号的飞行时间组件。如果 AP 响应时间是一致的，那么您应该能够减去它，从而计算到 AP 的距离。通过众所周知的双曲数学，您可以从 3 或 4 个 AP 中找到您的位置。

保罗。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-07T19:02:16.027

[Skyhook 浮现](http://www.skyhookwireless.com/)在脑海中。不过，这取决于人们注册其 AP 的位置。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2013-08-16T14:42:59.403

在定位系统（WPS）中转到 Wifi，我们使用多个 Wifi AP 来跟踪位置。这是由许多系统（如 Google、horizo​​n 等）通过提供额外的安全性 4 隐私来实现的。我也在不知道这一点的情况下尝试了这种类型技术.. 最好，我们可以通过各种方法简化其复杂性，从而实现对现有基础设施的创新。我建议你在购买之前先去 wifi 路由器插件管理和使用。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2019-01-28T17:34:53.930

您可以尝试 FIND3 项目，这里有一个文档[https://www.internalpositioning.com/doc/](https://www.internalpositioning.com/doc/)，它的 API 可用于此目的，并使用学习算法不断准确地了解您的位置。他们也有移动应用程序（仅适用于安卓）。我正在寻找做同样性质的事情。

# c++ - VC6和VC7中判断函数是否有void返回类型的需要方法

> ID：524369
> 
> 赞同：1
> 
> 时间：2009-02-07T19:05:42.557
> 
> 标签：c++, visual-c++, visual-c++-6

以下 C++ 代码可以为 GNU g++、LLVM 和我扔给它的所有其他 C++ 编译器正确编译和运行，Microsoft VC6 和 VC7 除外：

```
template<typename A, typename B> int HasVoidReturnType(A(*)(B)) { return 0; }
template<typename B> int HasVoidReturnType(void(*)(B)) { return 1; }
void f(double) {}
int foo() { return HasVoidReturnType(f); } 
```

对于 VC6 和 VC7，编译失败并报错：

```
f.cpp(4) : error C2667: 'HasVoidReturnType' : none of 2 overloads have a best conversion
    f.cpp(2): could be 'int HasVoidReturnType(void (__cdecl *)(B))'
    f.cpp(1): or       'int HasVoidReturnType(A (__cdecl *)(B))'
    while trying to match the argument list '(overloaded-function)'
f.cpp(4) : error C2668: 'HasVoidReturnType' : ambiguous call to overloaded function
    f.cpp(2): could be 'int HasVoidReturnType(void (__cdecl *)(B))'
    f.cpp(1): or       'int HasVoidReturnType(A (__cdecl *)(B))'
    while trying to match the argument list '(overloaded-function)' 
```

与其争论什么编译器是正确的优点，我如何使用 VC6 和 VC7 从模板函数中确定函数是否具有 void 返回类型？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-07T19:32:00.240

试穿这个尺寸

```
template<typename FuncPtrType>
struct DecomposeFuncPtr;

template<typename ReturnType, typename ArgType>
struct DecomposeFuncPtr<ReturnType(*)(ArgType)> {
  typedef ReturnType return_type;
};

template<typename T>
struct is_void {
  enum { value = 0 };
};

template<>
struct is_void<void> {
  enum { value = 1 };
};

template<typename T>
int HasVoidReturnType(T dontcare) {
  return is_void< typename DecomposeFuncPtr<T>::return_type >::value;
} 
```

它应该避免使 VC6/7 混乱的重载。

嗯。抱歉，我无法使用 VC6/7 对其进行测试。不过，我记得之前在 VC 中使用带有模板的函数指针遇到了问题。由于我们知道 A, B 适用于您原来的功能，我想知道是否类似：

```
template<typename T>
struct is_void {
  enum { value = 0 };
};

template<>
struct is_void<void> {
  enum { value = 1 };
};

template<typename A, typename B>
int HasVoidReturnType(A(*)(B)) {
  return is_void<A>::value;
} 
```

会工作。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-07T19:49:46.837

就 VC++ 6 而言，你被搞砸了，因为它不支持部分模板专业化，而这正是你解决这个问题所需要的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-07T19:15:14.347

您是否尝试过只使用第一个模板并使用模板专业化来定义第二个模板，而不是创建两个模板？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-07T19:16:15.873

仅供参考，这可以在 Microsoft 的 C++ 2008 Express 版本上编译。（我很想帮忙，但无法在我的编译器上重现该问题）

# asp.net - 对一些遗留 ASP.NET 1.1 代码进行单元测试的最佳框架

> ID：524373
> 
> 赞同：2
> 
> 时间：2009-02-07T19:07:58.013
> 
> 标签：asp.net, unit-testing, legacy, .net-1.1

我有旧版 asp.net 1.1 网站。它的 VB 分层结构非常差。调试运行信用卡处理测试大约需要 10 分钟。

我想在解决方案中添加一些单元测试功能来检查我的更改。

我正在考虑将mbunit与galeo一起使用。mbunit 和 galleo 可以与我的 .net 1.1 代码一起使用吗？对于与 .net 1.1 代码兼容的单元测试框架还有其他建议吗？

## 更新

我不是要测试代码的实际 asp.net 部分，只是我在服务/数据层中添加的新接口/业务逻辑。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-07T19:12:30.640

[nunit 有一套](http://nunit.org/)非常完整的 1.1 兼容工具。

# eclipse - 如何实现：在 Eclipse RCP 中协调相同选择的两个视图？

> ID：524375
> 
> 赞同：2
> 
> 时间：2009-02-07T19:07:59.947
> 
> 标签：eclipse, selection, rcp

我在 Eclipse RCP 应用程序中有多个视图：

1) 带有图钉图标的地图视图 2) 所有图钉的列表视图 3) 显示图钉属性的视图

我还有一个带有 get/setActivePushPin 访问器方法的模型对象。

如何正确协调图钉选择？

当我在地图或列表视图上选择一个图钉时，活动图钉应该改变并且应该通知另一个视图。

我意识到每个视图都需要一个 ISelectionListener，但似乎侦听器应该挂接到一个专门用于推销选择事件的公共 ISelectionProvider，而不是显式挂接到特定视图。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-08T23:01:56.547

这篇 developerWorks 文章“[使用视图链接使您的 Eclipse 应用程序更丰富](http://www.ibm.com/developerworks/opensource/library/os-ecllink/?ca=dgr-lnxw03EclipseGUIviews)”几乎完全准确地描述了您的示例。它特别好，因为它描述了同一个问题的两个“范式”——

*   选择提供者-选择侦听器范式
*   属性更改侦听器范例

关于选择服务如何工作的更详细的文章来自 eclipse.org 的这篇文章：“ [Eclipse Workbench：使用选择服务](http://www.eclipse.org/articles/Article-WorkbenchSelections/article.html)”。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-07T19:22:45.470

您需要使用全局选择服务，它协调整个工作台的选择。请参阅描述“选择服务”及其用法的文章：http: [//www.eclipse.org/articles/Article-WorkbenchSelections/article.html](http://www.eclipse.org/articles/Article-WorkbenchSelections/article.html)

# linux - 在哪些情况下建议选择 BSD 系统而不是 Linux？

> ID：524376
> 
> 赞同：6
> 
> 时间：2009-02-07T19:09:43.030
> 
> 标签：linux, operating-system, bsd

对于使用新硬件的日常用户来说，如果有人正在寻找 Windows 的替代品，Linux 对我来说似乎是自然的选择。但是什么时候尝试 BSD 变体才有意义呢？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-07T19:29:45.487

我一直发现 BSD 更直观。BSD 与 Linux 有一些不同的理念。例如，Linux 更喜欢 GNU 命令，而 BSD 选择经典的 BSD 命令（它们相似，但通常有不同的选项）或新编写的命令，当没有其他可用时回退到 GNU。此外，我发现 BSD 手册页比 GNU 手册页更全面，包含更多示例，因为 GNU 倾向于使用信息页面（我鄙视）作为示例。

许多 ISP 系统管理员都信奉 BSD。他们声称它在负载下表现得更好，没有为桌面做出太多妥协，而且它的网络堆栈更高效且错误更少。我不知道那些是真的，或者仍然是真的，但这是我被告知的。

此外，OpenBSD 以高度重视安全性着称，并且在安全性方面他们历来有着非常好的记录。他们采取主动措施（例如，开发新的 C 运行时库例程）来防止安全漏洞被编写。

NetBSD 以几乎可以在任何东西上运行而著称。他们有一长串积极支持的平台。Linux 在某种程度上也尝试这样做，但通常只有一小部分是主线支持的。

最后，它通常归结为个人喜好。您拥有或将要雇用的人知道 BSD 吗？你个人喜欢吗？

还有一些不运行 BSD 的原因。如果您主要是桌面用户，那么 BSD 可能不是最佳选择。当然，您可以在 BSD 上安装与 Linux 相同的大部分内容，但您不会找到类似于 Ubuntu 的“发行版”，它严格专注于桌面。此外，某些设备驱动程序在 BSD 上不可用，因为它们是使用仅 GPL 许可证编写的。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-02-07T19:14:25.923

**有人告诉**我，BSD 比 Linux 更……连贯。我与我的系统管理员朋友就为什么/为什么不是 BSD/Linux 进行了长时间的交谈。这是一个链接：

[http://www.over-yonder.net/~fullermd/rants/bsd4linux/bsd4linux1.php?dupe=with_honor](http://www.over-yonder.net/~fullermd/rants/bsd4linux/bsd4linux1.php?dupe=with_honor)

话虽如此，我在 2007 年开始使用 Debian，而且我从未回头！:)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-07T19:17:15.433

BSD 在 Linux 上的一大优势是许可。Linux 的 GPL 可能使使用其他操作系统的某些不同许可的功能变得困难。首先想到的是 ZFS。

另外，BSD 是一个更成熟的操作系统（直接来自 AT&T System V UNIX）。

普遍引用的智慧是 BSD 对服务器操作系统更有用，而 Linux 对桌面操作系统更有用。但是不要把这当成真理，因为很多人已经成功地将 Linux 用作服务器操作系统，而且很多人已经将 BSD 用作桌面操作系统。

# django - 有什么理由不能将模板过滤器与 Django 模板语法中的字符串进行比较？

> ID：524392
> 
> 赞同：0
> 
> 时间：2009-02-07T19:20:36.583
> 
> 标签：django

我正在尝试这样做，但失败了。有什么理由让它在 Django 模板语法中不起作用？我正在使用最新版本的 Django。

```
{% ifequal entry.created_at|timesince "0 minutes" %} 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-07T19:33:06.650

它不起作用，因为它不应该起作用。您要求的不是模板语言的一部分。

您不能在标签中间应用过滤器，例如`{% ifequal`. 当模板标签使用变量时，它不需要表达式，它需要一个变量，仅此而已。

这种逻辑 - 提取时间，比较等 - 是您应该在视图函数中执行的操作。

然后，您的视图函数会在上下文中放置一个“zerominutes”项以供模板使用。模板不能做太多的处理。

它们旨在完成呈现 HTML 所需的最低要求。其他所有内容都需要在您的视图函数中。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-07T20:02:23.987

`{% ifequal %}`tag 不支持过滤表达式作为参数。它将整体`entry.created_at|timesince`视为变量的标识符。

Quik 解决方法：使用`{% with %}`如下方式引入具有表达式结果的中间变量：

```
{% with entry.created_at|timesince as delta %}
    {% ifequal delta "0 minutes" %}
    ....
    {% endifequal %}
{% endwith %} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-09T18:47:05.763

有关更多信息，请参阅[票证 #5756](http://code.djangoproject.com/ticket/5756)及其评论中的链接。[票证#7295](http://code.djangoproject.com/ticket/7295)中的 Django 补丁实现了此功能。[在#7806](http://code.djangoproject.com/ticket/7806)中提出了基于[#7295](http://code.djangoproject.com/ticket/7295)的模板系统更广泛的重构，它将解决这个问题。

我不认为进行这样的比较工作会违背 Django 模板的设计理念。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-07T19:32:48.290

我认为您可以，尽管我的代码库没有看到它的任何用途。也许`entry.created_at|timesince`没有产生您期望的价值。试着放

```
X{{entry.created_at|timesince}}X 
```

进入您的模板并查看它产生的价值。X 是为了让您可以看到前导或尾随空格，以防出现问题。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-07T22:53:30.723

我最终放弃了将 Django 模板语言用于除了最简单的页面之外的任何内容。查看[Jinja2](http://jinja.pocoo.org/2/)以获得几乎语法兼容的替代方案。是的，您可以逐页选择要使用的内容。

# ruby - Ruby 正则表达式帮助

> ID：524398
> 
> 赞同：1
> 
> 时间：2009-02-07T19:24:03.940
> 
> 标签：ruby, regex

我想从站点中提取成员主页站点链接。看起来像这样

```
<a href="http://www.ptop.se" target="_blank"> 
```

我用它测试了这个网站

[http://www.rubular.com/](http://www.rubular.com/)

```
<a href="(.*?)" target="_blank"> 
```

应输出[http://www.ptop.se](http://www.ptop.se) ,

代码来了

```
 require 'open-uri'
    url = "http://itproffs.se/forumv2/showprofile.aspx?memid=2683"
    open(url) { |page| content = page.read()
    links = content.scan(/<a href="(.*?)" target="_blank">/)
    links.each {|link| puts #{link} 
    }
    } 
```

如果你运行它，它就不起作用。为什么不？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-31T20:48:42.663

我建议您使用一个好的 ruby​​ HTML/XML 解析库，例如[Hpricot](http://wiki.github.com/why/hpricot)或[Nokogiri](http://wiki.github.com/tenderlove/nokogiri)。

如果您需要登录该站点，您可能会对[WWW::Mechanize](http://rubyforge.org/projects/mechanize/)之类的库感兴趣。

代码示例：

```
require "open-uri"
require "hpricot"
require "nokogiri"

url = "http://itproffs.se/forumv2"

# Using Hpricot 
doc = Hpricot(open(url))
doc.search("//a[@target='_blank']").each { |user| puts "found #{user.inner_html}" }

# Using Nokogiri
doc = Nokogiri::HTML(open(url))
doc.xpath("//a[@target='_blank']").each { |user| puts "found #{user.text}" } 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-31T07:34:53.757

您的代码有几个问题

2.  我不知道你所说的使用是什么意思

    # {关联}。但是，如果您想在链接中附加一个 '#' 字符，请确保

    你用引号括起来。即“#{链接}”
3.  String.scan 接受一个块。使用它来循环匹配。
4.  您尝试访问的页面不会返回任何正则表达式匹配的链接。

这是可行的方法：

```
require 'open-uri'
url = "http://itproffs.se/forumv2/"
open(url) do |page|
    content = page.read()
    content.scan(/<a href="(.*?)" target="_blank">/) do |match|
            match.each { |link| puts link}
        end
end 
```

我敢肯定，有更好的方法可以做到这一点。但这应该有效。

希望能帮助到你

# c++ - 简单的 GUI IDE？

> ID：524404
> 
> 赞同：6
> 
> 时间：2009-02-07T19:28:23.180
> 
> 标签：c++, linux, ide

我正在寻找一个 GUI Linux IDE。

眼镜：

*   **简单**而愚蠢的证明。正常的外观和感觉
*   在大多数语言中完全按你输入的缩进
*   一个编译+运行按钮，一个调试器，C++ 的自动重构
*   对常见构建系统的基本非侵入式支持 - 直接制作、cmake、qmake、autotools
*   流畅的工作流程。适当的键盘支持，调试/编码模式之间没有不和谐的转换等

我试过的：

*   KDevelop 臃肿且漏洞百出，甚至难以在机器之间转移项目等
*   jEdit 很丑，功能很差，而且很难找到东西。但它的缩进效果很好。
*   Anjuta、Geany 和许多其他用于 GNOME 的微型 IDE 在缩进和杂项功能方面都失败了
*   Code::Blocks 仅适用于 C++，它非常复杂，并且很难使用 libs 等
*   vi 和 e-macs 很好，但我现在没有时间学习它们，我想要一些同事也可以使用的东西
*   NetBeans 有一个糟糕的 Swing 外观，奇怪的代码编辑器。它也很慢而且看起来很复杂。很棒的功能。
*   蚀。相当庞大和复杂，我不喜欢 UI。我觉得没有教程我什么都做不了

目前我使用 KDevelop 进行工作，使用 gedit+terminal 进行爱好开发，但想看看我是否错过了。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-07T19:38:04.863

你可以试试[QtCreator](http://www.qtsoftware.com/products/appdev/developer-tools/developer-tools)。它还不是很完整（至少在这篇文章中），但它可能比你尝试过的其他一些更接近你想要的。它对键盘非常友好。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-07T19:35:20.810

[在这个答案](https://stackoverflow.com/questions/81584/what-ide-to-use-for-python/81629#81629)之后我尝试[了PIDA](http://pida.co.uk/)，我认为它非常好。不过，您仍然必须学习 vi/emacs 才能使用它。

我还建议您看看[MonoDevelop](http://www.monodevelop.com/)。它基本上是 M$ Visual Studio for Linux，它具有您列出的所有功能。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-06T01:44:48.130

也许只是试试凯特。它是一个很棒的编辑器，有很多插件，能够使用内置终端，代码折叠，它非常适合 kde 桌面。另外它非常快。

# javascript - 没有 MicrosoftAjax.js 和 MicrosoftMvcAjax.js 的 ASP.NET MVC

> ID：524409
> 
> 赞同：15
> 
> 时间：2009-02-07T19:30:10.823
> 
> 标签：javascript, asp.net-mvc, ajax

删除后我会失去哪些功能

微软Ajax.js

微软MvcAjax.js

文件？

由于各种原因，我不想使用它们，我想是否有任何 3rd 方帮助方法可以模仿现有方法但与另一个 JavaScript 框架（例如 jQuery）相关联。

另外，请告知在哪里使用上述 javaScript 文件是可取的/建议的。

非常感谢，

瓦伦丁·瓦西里耶夫。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-02-08T16:45:57.003

如果您不参考 MicrosoftAjax 脚本，您将无法使用 ViewPage 类上的 Ajax 属性公开的 AjaxHelper 扩展方法（在 System.Web.Mvc.Ajax 命名空间中）。通过使用适当的 jQuery AJAX 方法（$.post、$.get、$(selector).load 等）或 jQuery 表单插件，它们相对容易替换。

至于一个或另一个是否更可取，这取决于您对编写自己的实现的舒适程度。Ajax 辅助方法尝试在客户端脚本编程方面为您处理很多事情，但代价是必须加载相当重量级的 MS AJAX 库。滚动您自己的 javascript 方法可以生成更轻量级的代码，并为您提供要使用的 javascript 库的选择（无论是 jQuery 还是其他众多库之一）。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-11T04:03:40.677

我同意。只需使用jquery。.net mvc 3.5 和 jquery 让生活变得美好。干杯

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-07T22:47:57.757

你不需要那些。只需删除它们。请改用 JQuery。

# php - 用于将外部变量整理成单个对象的 php 函数，无论 GET 还是 POST

> ID：524413
> 
> 赞同：0
> 
> 时间：2009-02-07T19:33:52.220
> 
> 标签：php, http, parameters, add-on

我记得曾经回顾过别人的 PHP 代码，他有一个函数或类方法，可以将所有 GET 和 POST 变量滚动到一个可以传递的普通旧对象中。如果 GET 和 POST 中出现相同的名称-值对，则 POST 将获胜。

是否有任何类型的编码良好的 PHP 插件可以做到这一点？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-07T19:55:41.143

您可以使用[`$_REQUEST`](http://php.net/manual/reserved.variables.request.php)，但请注意它包含 、 和 的内容`$_GET`，`$_POST`并且`$_COOKIE`此超全局变量中变量的存在（和顺序，用于覆盖目的）取决于执行环境中的配置。

如果这会导致问题，那么汇总一个简单版本可能是个好主意，其关键是类似于

```
$requestData = array_merge( $_GET, $_POST ); 
```

然后，您可以以某种方式将其包装起来，也许提供额外的有用功能，例如自动应用`stripslashes()`到使用修饰的`magic_quotes`值，为缺失变量提供默认值等。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-08T12:02:54.063

合并两个变量（或使用`$_REQUEST`或[注册全局](http://docs.php.net/manual/en/security.globals.php)变量）可能会导致安全漏洞，因为您无法明确识别其值的来源。因此，在访问时，`$_REQUEST['foobar']`您无法判断该值是通过 URL、POST 正文还是 Cookie 发送的。这会使您的脚本容易受到[跨站点请求伪造的](http://www.owasp.org/index.php/Cross-Site_Request_Forgery_(CSRF))攻击。

所以我建议你去追求安全而不是舒适，并使用那些你期望你的值来自哪里的变量。`$_GET`对于预期通过 URL 传递的参数、`$_POST`通过 POST 传递的参数和`$_COOKIE`cookie。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-08T00:18:14.657

我认为将其`$_GET`与`$_POST`. 它们用于完全不同的事物，并且将它们视为平等，您实际上是在滥用 HTTP 协议。如前所述，`$_REQUEST`做你想做的事，但有点不可预测。您可以轻松编写自己的全局函数来做同样的事情：

```
function param($name, $default = null) {
  return isset($_POST[$name])
    ? $_POST[$name]
    : (isset($_GET[$name])
      ? $_GET[$name] 
      : $default);
} 
```

但真的..这是不好的做法。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-07T19:39:02.643

您可以使用 $_REQUEST 全局变量。它由默认解释的 PHP 定义，当您的应用程序在 web sapi（如 CGI 或 web 服务器模块）中运行时，当您使用 PHP 编写基于 Web 的应用程序时，您的应用程序就是这种情况。$_REQUEST 是 $_GET 和 $_POST 中所有数据的关联数组，默认定义。使用它不需要扩展/库。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-08T11:37:50.400

这是我的框架中处理整个应用程序的全局变量的类。此处不对变量进行任何处理。

```
class stGlobal 
```

{

```
//instance
private static $instance;

//global settings
public $post = '';
public $get = '';
public $files = '';
public $request = '';

private function initialize()
{
    $this->post = $_POST;
    $this->get = $_GET;
    $this->files = $_FILES;
    $this->request = $_REQUEST;
}

public function getInstance()
{
    if (!isset(self::$instance))
    {
        $class = __CLASS__;
        self::$instance = new $class();
        self::$instance->initialize();
    }
    return self::$instance;
} 
```

}

在任何地方使用它

```
$myObj = stGlobal::getInstance(); 
```

# sql-server-2005 - SQL Server Reporting Services 2005 - 如何隐藏图表的图例标签？

> ID：524416
> 
> 赞同：0
> 
> 时间：2009-02-07T19:34:31.780
> 
> 标签：sql-server-2005, reporting-services

我正在报告可以说有 10 列的数据。现在，我的一些客户在所有 10 列中都有数据，而有些客户可能只使用 7 或 5 列……你明白了。当然，我不想为每个可能性都建立一个新的 rdl。好吧，在表格报告中，如果不存在数据，我可以使用 IsMissing 属性很好地隐藏列。

好吧，在图表中，假设是条形图，如果列没有数据，它将不会在图表上显示条形（这很棒），但所有潜在的列仍会显示在系列图例中。

我读到 2008 年为您提供了这种级别的图表定制，但 2005 年没有。还有其他想法吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-07T20:11:11.613

我想我实际上回答了我自己的问题（嗯，它适用于我的场景）。我使用 SQL Server 2005 中提供的 UNPIVOT 函数将列数据放入行中。这给了我一个包含多行的两列（字段和结果）的数据集。现在在 SSRS 图表中，我只是将结果放入数据中，将字段放入系列中，效果很好。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-13T15:11:45.690

我使用的是 2005，但我认为对于条形图，您可能可以执行类似的操作。

图表属性 -> 数据选项卡 -> 系列组（编辑） -> 过滤器 -> 添加适当的过滤器以删除您不关心的系列。

# algorithm - 跨度快速最小值

> ID：524420
> 
> 赞同：2
> 
> 时间：2009-02-07T19:36:10.780
> 
> 标签：algorithm, data-processing

给定数组列表和大量设置时间，我需要快速找到每个数组的某个子跨度中的最小值。在概念上：

```
class SpanThing
{
     int Data;
     SpanThing(int[][] data) /// must be rectangulare
     {
         Data = data;
         //// process, can take a while
     }

     int[] MinsBruteForce(int from, int to)
     {
         int[] result = new int[data.length];
         foreach(int index, int[] dat; Data)
         {
             result[i] = int.max;
             foreach(int v; dat[from .. to]);
                result[i] = min(result[i], v);
         }
         return result;
     }
     int[] MinsSmart(int from, int to)
     {
          // same as MinsBruteForce but faster
     }
} 
```

我目前关于如何做到这一点的想法是在每个节点包含相关跨度中的最小值的数据上构建一个二叉树。这样，在一行的跨度中找到最小值将包括仅找到组成它的树节点的最小值。该集合对于每一行都是相同的，因此可以计算一次。

有没有人看到这个想法有任何问题或知道更好的方法？

* * *

为了澄清，我正在谈论的树将被设置为根节点将包含整个行的最小值，对于每个节点，它的左子节点将具有父节点跨度左半部分的最小值，并且右边也是一样。

```
 0   5   6  2   7   9   4   1   7   2   8   4   2
 ------------------------------------------------
   | 5 | 6|   | 7 | 9 |   | 1 | 7 | 2 | 8 | 4 | 2  
 0 |   5  | 2 |   7   | 4 |   1   |   2   |   2  
   0      |   2       |   1       |       2
          0           |           1
                      0 
```

这棵树可以映射到一个数组并以这样一种方式定义，即可以计算段边界，从而实现快速查找。

我正在优化的情况是我有一个固定的输入集和大量的前期时间，但随后需要对各种跨度进行许多快速测试。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-07T20:13:29.080

您描述的方法听起来像是您正在尝试进行某种[记忆](http://en.wikipedia.org/wiki/Memoization)或缓存，但这只会在您重复检查相同的跨度或嵌套的跨度时对您有所帮助。

*min([0..n])*的一般情况将是*O(n)*，这就是您已经拥有的。

您的代码似乎更关心数组中的实际数字，而不是它们在数组中的顺序。如果您要反复检查这些跨度，是否可以先对数据进行排序，这可能是一个*O(n log n)*操作，然后是一堆*O(1)*操作？大多数语言在其标准库中都有某种内置的[排序算法。](http://en.wikipedia.org/wiki/Sorting_algorithm)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-07T22:56:06.803

您提出的解决方案似乎使用恒定的空间开销、恒定的时间设置和查询的对数时间给出了答案。如果您愿意支付二次空间（即提前计算所有区间），您可以在恒定时间内得到答案。您的对数方案几乎肯定是首选。

如果有可能做得更好，我不会感到惊讶，但如果有一个*简单*的数据结构可以做得更好，我会感到震惊——实际上，对数时间几乎总是足够快。去吧。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-07T20:44:29.440

目前尚不清楚我们如何使用您描述的树方法有效地表示间隔的层次结构。划分区间的方法有很多种——我们是否必须考虑每一种可能性？

像这样的简单方法就足够了：假设`data`是一个 N x M 数组。我会创建一个 M x M x N 数组，其中 entry`(i,j,k)`给出`data(k,i:j)`. 数组条目将按需填充：

```
int[] getMins(int from, int to)
{
    assert to >= from;

    if (mins[from][to] == null)
    {
        mins[from][to] = new int[N];

        // populate all entries (from,:,:)
        for (int k = 0; k < N; k++)
        {
            int t = array[k][from];

            for (int j = from; j < M; j++)
            {
                if (array[k][j] < t)
                    t = array[k][j];

                mins[from][j][k] = t;
            }
        }
    }

    return mins[from][to];
} 
```

# php - 减少静态 HTML 页面中的重复

> ID：524421
> 
> 赞同：2
> 
> 时间：2009-02-07T19:36:16.817
> 
> 标签：php, html

我有一个由一堆静态 HTML 页面组成的网站。显然，这些（标题、菜单等）之间有很多重复。我打算使用的托管公司支持PHP，我对此一无所知。大概 PHP 提供了某种#include 机制，但是我需要对我的 HTML 页面进行哪些更改才能使用它？

例如，假设我有一个这样的页面

**索引.html**

```
<html>
  <head></head>
  <body>
    <h1>My Common Header</h1>
  </body>
</html> 
```

显然我需要将公共部分移动到它自己的文件中：

**header.html**

```
<h1>My Common Header</h1> 
```

给定上面的例子（并假设所有文件都在同一个目录中）：

*   我在 body 标记中添加什么以包含 header.html？
*   我是否需要重命名 index.html 或添加一些特殊标签来表明它是一个 .php 文件？
*   我需要对 header.html 进行任何更改吗？

**更新：**我想强调我的目标只是找到减少静态 HTML 文件之间重复的最低摩擦方法。我有点不愿意去服务器端包含路由，因为我还不知道我将在什么类型的服务器（IIS/Apache）上托管文件，以及是否会打开或关闭包含。我被 PHP 所吸引只是因为它是我可以假定的唯一能够完成这项工作的东西。感谢您的回复。

谢谢， 多纳尔

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-07T19:39:38.150

您不需要使用 PHP 来获得此功能，而且由于潜在的安全问题，这样做通常不是一个好主意。从本质上讲，您是在用核弹击打蚊虫。如果您不使用动态语言，那么您正在寻找服务器端包含。

例如，在 IIS 中：

```
<!--#include virtual="file.inc"--> 
```

请注意，您通常必须配置服务器才能使用它们，因为默认情况下通常会关闭此功能。IIS 和 Apache 都支持服务器端包含，但它们使用不同的配置。

您可以在这里找到更多信息：

[服务器端包括](http://en.wikipedia.org/wiki/Server_Side_Includes)

编辑：我并不是说使用 PHP 是一个坏主意，只是使用 PHP 来包含其他文件。它通过在不需要 PHP 时将 PHP 加入组合来创建更大的攻击面，因此当不需要 PHP 的功能时可能会出现安全问题。

EDIT2：我认为假设您不会因为您的大小而成为目标是一个坏主意，因此您可以忽略安全性。大多数网站都受到自动蠕虫的入侵，并变成恶意软件主机、垃圾邮件僵尸或盗版软件/媒体服务器。除了您最终可能参与感染他人的事实之外，您的网站可能会被列入黑名单，并且可能会花费您真钱的带宽超额费用。我们说的是数百或数千美元。

仅仅因为您是一个小型网站并不会使您成为目标。仅仅在互联网上就会让你成为目标。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-02-07T19:39:45.123

您正在寻找[`include`](http://www.php.net/include/)（或其派生词之一，例如`include_once`, `require`, `require_once`）：

**头文件.php**

```
<h1>My Common Header</h1> 
```

**索引.php**

```
<html>
  <head></head>
  <body>
    <?php include('header.php'); ?>
  </body>
</html> 
```

等等，例如您的页脚。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-07T21:14:40.347

完全忘记在服务器上执行此操作。

如果您*真正*想做的只是维护一些静态页面 - 并且预计不必真正使用 PHP - 我会使用 Dreamweaver 来完成，它允许您创建和管理模板和可变内容.

不需要包含。不需要模板引擎。（这些对于你想要完成的事情来说太过分了。）

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-07T19:42:07.427

您应该首先将index和header的文件扩展名更改为.php，然后您可以这样做：

```
<html>
<head></head>
    <body>
        <? include 'header.php'; ?>
    </body>
</html> 
```

而你的 header.php 文件只有

```
<h1>My Common Header</h1> 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-07T22:15:54.683

Back in the day, I used SSIs (the "<!--#include virtual="file.inc"-->" method described above by Mystere Man) quite a bit for static HTML pages and I would definitely recommend using that.

However if you want to eliminate any uncertainty about whether support for that will be enabled on the server, you could develop your separate files locally and merge them into the resulting files before uploading to your server. Dreamweaver, for example, supports doing this in a seamless fashion.

Or you could do it yourself with a rather simple script in your language of choice by doing simple string replacement on markers in the files, replacing {{{include-header}}} with the contents of a "header.html" file and so on.

**Edit**

Oops! Somehow I didn't see Clayton's post with the same note about Dreamweaver.

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-07T19:45:23.957

[虽然您可以只使用“include”、“require”或“require_once”指令将内容包含在一个页面中，但使用Smarty](http://www.smarty.net/)之类的模板引擎可能会更好

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-07T19:51:20.047

虽然使用包含文件作为标题是一种解决方案，但几年前当我遇到这个问题时，我走了一条不同的路线：我希望所有页面都使用相同的布局（我认为这是相当常见的;-)。因此，因为我只想更改**内容**我将页面内容设置为包含在内的文件，并具有包含页眉和页脚的主模板文件。为了设置要包含的页面，我求助于创建非常小的 php 脚本，这些脚本只设置了一个包含要包含的页面的变量。在某些情况下，页面也可以通过 GET 参数命名。当然，这需要对该参数进行适当的验证。从长远来看，我不再需要担心 HTML 本身——我所做的只是编写包含在内的小片段（当然它们应该是完整的）。

一个可能更好的解决方案是使用现有的模板框架。由于当时的限制，我无法这样做，但当我再次面临同样的问题时，我会这样做。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-07T19:47:30.037

好的，这只是一个半编程相关的问题。

PHP 确实有 include()，它确实很容易使用，但它不利于未来的可维护性。我不会推荐它，尤其是对于大型网站。

我是一个亲框架。我使用过 CodeIgniter、CakePHP 甚至 Smarty 模板引擎。如果您对 PHP 很认真，请考虑 CakePHP。有这个“布局”概念，您可以在主要内容**之外构建页眉、页脚、css、javascript；**例如，对于“关于我们”页面，您的内容将类似于：

> 这是一个关于我们的页面，它告诉你一大堆关于我们的东西......

CakePHP 接受这个内容，并围绕它包装你的布局：

> header
> css
> javascript
> 这是一个关于我们的页面，它告诉你一大堆关于我们的东西......
> 页脚

# deployment - 为 VM 部署进行开发的注意事项

> ID：524426
> 
> 赞同：1
> 
> 时间：2009-02-07T19:38:43.067
> 
> 标签：deployment, virtual-machine

我正在设置一个使用 SQL Server 2005、几个自定义 Windows 服务、Web 服务和一些 IIS .NET 应用程序的系统。获得整个系统设置是一个有点乏味的过程。

我想知道在 VM 中设置整个系统是否是个好主意。然后我可以将虚拟机放到新服务器上并在配置上获得巨大的领先优势吗？

如果我采用这种方法，我应该注意什么？这是一个可行的选择吗？虚拟机是一个不错的部署单元吗？

如果这个概念是可行的，我当然会感谢有关 VM 设置的具体建议。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-07T19:54:59.650

我经常使用这种方法。我将在 VMware Workstation 中设置一个 VM，根据自己的喜好对其进行配置，然后使用 VMware Importer 将我的虚拟机导入 ESX 环境。从那里，我可以将虚拟机变成一个模板，我可以反复使用它来部署我的服务器的克隆，或者作为创建新服务器的起点。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-07T19:58:28.237

· 大量虚拟机（每个客户一台）· 更少的物理机· 我们正在处理的虚拟机必须启动，而其他虚拟机可以关闭· 易于备份，因此，如果出现问题，我们可以开始处理相同的问题当我们关闭虚拟机等... ·物理机必须配置最后一个硬件或几乎。· 根据您的开发，一台物理机可以保留 4 到 8 个 VM。

# c# - 无法隐式转换列表 收藏

> ID：524428
> 
> 赞同：45
> 
> 时间：2009-02-07T19:39:21.397
> 
> 标签：c#, generics, collections

这是一个编译器错误（为了便于阅读而稍作更改）。

这个总是让我很困惑。FxCop 告诉返回 List 是一件坏事，并且派生自的类`Collection<T>`应该作为返回类型更可取。

此外，FxCop 表示可以`List<T>`用于内部数据存储\操作。好的，我明白了，但我不明白的是编译器抱怨试图隐式转换`List<T>`为`Collection<T>`. 不是`List<T>`更多的接口充电和功能吗？为什么禁止隐式转换？

还有一个源于上面的问题：`new List<int>(some collection<int>)`构造函数昂贵吗？

谢谢，

瓦伦丁·瓦西里耶夫

* * *

## 回答 #1

> 赞同：106
> 
> 时间：2009-11-10T17:57:57.747

为什么不直接执行以下操作：

```
Collection<string> collection = new Collection<string>(theList); 
```

因为 Collection(IList input) 将 List 作为构造的一部分。

* * *

## 回答 #2

> 赞同：42
> 
> 时间：2009-02-07T19:42:34.930

`List<T>`不是派生自`Collection<T>`-但是，它确实实现了`ICollection<T>`. 这将是返回类型的更好选择。

至于`new List<int>(some collection<int>)`问题 - 这部分取决于收藏品是什么。如果它实现`ICollection<T>`（在执行时），那么构造函数可以使用它的`Count`属性来创建具有正确初始容量的列表，然后再遍历它并添加每个项目。如果它没有实现`ICollection<T>`，那么它就相当于：

```
List<int> list = new List<int>();
foreach (int x in otherCollection)
{
    list.Add(x);
} 
```

在一个方便的构造函数中仍然很高兴，但效率不高 - 真的不可能。

我不相信构造函数对数组做任何狡猾的事情，它可能会 - 使用`Array.Copy`或其他任何东西来一次性复制很多而不是迭代。（同样，如果它是另一个`List<T>`，它可以获取支持数组并直接复制它。）

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-02-07T19:43:46.863

`List<T>`不继承自`Collection<T>`. 干净利落。除非`List<T>`提供隐式转换为/从的运算符，否则`Collection<T>`您不能这样做。如果可以的话，我实际上建议返回`List<T>`，因为我相信规则是这样的：

接受尽可能少的限制接口作为参数。作为返回参数返回尽可能严格的类型。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-06-09T16:17:55.530

这是用 C# 3.0 编写的通用扩展方法，用于转换`List<T>`为`Collection<T>`

```
using System.Collections.Generic;
using System.Collections.ObjectModel;

public static class ExtensionMethods
{
    public static Collection<T> ToCollection<T>(this List<T> items)
    {
        Collection<T> collection = new Collection<T>();

        for (int i = 0; i < items.Count; i++)
        {
            collection.Add(items[i]);
        }

        return collection;
    }
} 
```

而且是这样使用的……</p>

```
List<string> entities = new List<string>();
entities.Add("Value 1");
entities.Add("Value 2");
entities.Add("Value 3");
entities.Add("Value 4");

Collection<string> convertedEntities = entities.ToCollection<string>(); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2015-05-24T10:32:02.793

这是您转换为`List<T>`的方式`Collection<T>`（使用 LINQ 时）：

**旧功能：**

```
public List<Employee> GetEmployee(int id)
{
     return ( from e in MyDataContext.Employees
                   select new Employee()
                   {
                     e.empId = id
                   }
             ).ToList();
} 
```

**转换后：**

```
using System.Collection.ObjectModel;

public Collection<Employee> GetEmployee(int id)
{
           return new Collection<Employee>( 
               (from e in MyDataContext.Employees
                     select new Employee()
                     {
                       e.empId = id
                     }
                ).ToList() as IList<Employee>
           );
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2015-07-22T06:45:02.583

您可以使用以下

```
public class EmployeeCollection : Collection<Employee>
{
      public EmployeeCollection(IList<Employee> list) : base(list)
      {}

      public EmployeeCollection() : base()
      {}

} 
```

像这样使用类

```
EmployeeCollection  employeeCollection = new EmployeeCollection(list) 
```

* * *

## 回答 #7

> 赞同：-2
> 
> 时间：2019-02-25T22:28:34.473

相反，没有必要循环......你可以只`.ToList()`

```
 ICollection<T> collection = new Collection<T>(); 
```

使用任何方法填充您的集合，当您需要列表时，只需执行以下操作：

```
 List<T> list = collection.ToList(); 
```

之后，您可以在列表中使用您想要的任何内容。

好好编码！

# windows - 将 Mono 应用程序部署到 Windows

> ID：524448
> 
> 赞同：4
> 
> 时间：2009-02-07T19:49:47.867
> 
> 标签：windows, mono, cross-platform

将基于 Mono 的应用程序部署到 Windows 会遇到什么困难？Mono 运行时是否必须与应用程序一起安装？这会给最终用户带来不便吗？

**编辑：** 这个想法是部署一个跨平台的应用程序，因此 Mono 作为一个选择。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-07T20:55:52.897

Mono 是 .NET 的一个实现。只要您不使用特定于 Mono 的 API，它就应该 100% 兼容。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-13T15:15:49.893

只要您在应用程序中坚持使用托管代码并且安装了 .NET 或 Mono，您应该没问题。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-07T20:14:46.597

正如[@duffymo](https://stackoverflow.com/users/37213/duffymo)所说，您最好要求.NET 而不是要求Mono。但是，在某些情况下使用 Mono 是有意义的。特别是，如果您使用[mkbundle](http://www.mono-project.com/Guide:Running_Mono_Applications)创建程序集而不需要安装 Mono。甚至还有一种方法可以将运行时静态链接到 exe，尽管这会带来一些需要考虑的许可要求。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-07T19:52:08.093

如果 Mono 是 .NET 的 Linux 版本，那么在 Windows 上使用 Mono 部署在 Linux 上开发的应用程序不只是意味着获取您的源/包并将其部署在 Windows 上吗？需要通用的 .NET 部分不应该已经在 Windows 上可用吗？

# c++ - boost asio and endian

> ID：524453
> 
> 赞同：9
> 
> 时间：2009-02-07T19:51:44.210
> 
> 标签：c++, boost, boost-asio, endianness

I cant tell, does boost asio handle endian?

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-04-27T21:30:22.243

Asio does convert things like *port* into network order. The conversion functions are not exposed as part of the official interface and are hidden in the *detail* namespace instead (e.g. *boost::asio::detail::socket_ops::host_to_network_short*).

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2012-04-04T21:44:45.100

boost::asio::socket_'s do not perform any byte order conversion.

# iphone - 从 iPhone 到 Mac？

> ID：524456
> 
> 赞同：2
> 
> 时间：2009-02-07T19:54:25.890
> 
> 标签：iphone, macos

注意：这与大多数类似问题的方向相反！

我有一个 iPhone 应用程序，我想在 Mac 上提供一个演示。假设我打算保持相同的屏幕尺寸并且不担心让我的应用程序看起来“像 mac”，那么将 iPhone 应用程序重新编译（或重写）成 Mac 应用程序有多难？

是否可以将苹果在 iPhone SDK 中提供的 iPhone 模拟器与我的应用程序副本一起分发？要求人们自己去安装它似乎是一项主要要求。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-09T00:48:23.920

总的来说，大多数“核心”框架也存在于 Mac 上。作为一个规则，任何以 NS 开头的类都将出现在桌面上 - NSString、NSArray 和 NSObject 等。希望这意味着您的所有引擎代码都将简单地重新编译和运行。

一些中间件也是如此——所有的 iPhone Quartz 都会出现——类和类型以 CG 开头……如果你使用 3D，桌面上有 OpenGL，但它是完整的 OpenGL，而不是 iPhone 的 OpenGL ES。有一些差异，但您的代码将很容易移植。

您肯定需要重新编码的地方是 UI。不仅因为 AppKit 不存在，而且因为 iPhone 所需的 UI 设计通常无法在桌面上运行。iPhone 支持多点触控并且没有（有意义的）重叠窗口。同样，如果您使用任何 iPhone 的硬件，您将不得不重新实现 - 加速度计和 GPS 显然在桌面上不可用。在这两种情况下，经验法则是启动 UI 的类......是特定于 iPhone 的。

如果您在编写应用程序时遵循 Apple 的 MVC 设计指南，则可以将 UI 相关代码与引擎代码很好地分离，并且移植应该会更容易。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-07T20:04:25.840

首先，您不能分发 iPhone 模拟器。那是不可能的。iPhone SDK 协议规定：

> 您同意不出租、出租、出借、上传到任何网站或服务器或在任何网站或服务器上托管、出售、重新分发或再许可全部或部分 SDK，或允许他人这样做。

您可能可以在 Mac 版本中使用部分程序，但您可能必须重写与 UI 相关的代码。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-07T20:18:01.583

如果您的应用程序主要是 OpenGL 或自定义视图，可能一点也不难。如果您的应用程序使用大量 UIKit 视图，那么您将需要重写相当多的代码以使用 Mac 标准 Cocoa 视图。它们完全不同。

# asp.net-mvc - 你如何使用 Moq 模拟会话对象集合

> ID：524457
> 
> 赞同：45
> 
> 时间：2009-02-07T19:54:45.687
> 
> 标签：asp.net-mvc, unit-testing, tdd, moq

我正在使用[shanselmann 的 MvcMockHelper](http://www.hanselman.com/blog/ASPNETMVCSessionAtMix08TDDAndMvcMockHelpers.aspx)类使用 Moq 模拟一些 HttpContext 东西，但我遇到的问题是能够在我的 MVC 控制器中为我的模拟会话对象分配一些东西，然后能够在我的单元测试中读取相同的值以进行验证目的。

我的问题是如何将存储集合分配给模拟会话对象以允许诸如 session["UserName"] = "foo" 之类的代码保留“foo”值并使其在单元测试中可用。

* * *

## 回答 #1

> 赞同：65
> 
> 时间：2009-03-27T18:23:31.390

我从 Scott Hanselman 的[MVCMockHelper](http://www.hanselman.com/blog/ASPNETMVCSessionAtMix08TDDAndMvcMockHelpers.aspx)开始，添加了一个小类并进行了如下所示的修改，以允许控制器正常使用 Session 和单元测试来验证控制器设置的值。

```
/// <summary>
/// A Class to allow simulation of SessionObject
/// </summary>
public class MockHttpSession : HttpSessionStateBase
{
    Dictionary<string, object> m_SessionStorage = new Dictionary<string, object>();

    public override object this[string name]
    {
        get { return m_SessionStorage[name]; }
        set { m_SessionStorage[name] = value; }
    }
}

//In the MVCMockHelpers I modified the FakeHttpContext() method as shown below
public static HttpContextBase FakeHttpContext()
{
    var context = new Mock<HttpContextBase>();
    var request = new Mock<HttpRequestBase>();
    var response = new Mock<HttpResponseBase>();
    var session = new MockHttpSession();
    var server = new Mock<HttpServerUtilityBase>();

    context.Setup(ctx => ctx.Request).Returns(request.Object);
    context.Setup(ctx => ctx.Response).Returns(response.Object);
    context.Setup(ctx => ctx.Session).Returns(session);
    context.Setup(ctx => ctx.Server).Returns(server.Object);

    return context.Object;
}

//Now in the unit test i can do
AccountController acct = new AccountController();
acct.SetFakeControllerContext();
acct.SetBusinessObject(mockBO.Object);

RedirectResult results = (RedirectResult)acct.LogOn(userName, password, rememberMe, returnUrl);
Assert.AreEqual(returnUrl, results.Url);
Assert.AreEqual(userName, acct.Session["txtUserName"]);
Assert.IsNotNull(acct.Session["SessionGUID"]); 
```

它并不完美，但足以用于测试。

* * *

## 回答 #2

> 赞同：39
> 
> 时间：2009-03-13T20:21:06.330

这里使用 Moq 3.0.308.2 是我在单元测试中设置帐户控制器的示例：

```
 private AccountController GetAccountController ()
    {
      .. setup mocked services..

      var accountController = new AccountController (..mocked services..);

      var controllerContext = new Mock<ControllerContext> ();
      controllerContext.SetupGet(p => p.HttpContext.Session["test"]).Returns("Hello World");
      controllerContext.SetupGet(p => p.HttpContext.User.Identity.Name).Returns(_testEmail);
      controllerContext.SetupGet(p => p.HttpContext.Request.IsAuthenticated).Returns(true);
      controllerContext.SetupGet(p => p.HttpContext.Response.Cookies).Returns(new HttpCookieCollection ());

      controllerContext.Setup (p => p.HttpContext.Request.Form.Get ("ReturnUrl")).Returns ("sample-return-url");
      controllerContext.Setup (p => p.HttpContext.Request.Params.Get ("q")).Returns ("sample-search-term");

      accountController.ControllerContext = controllerContext.Object;

      return accountController;
    } 
```

然后在您的控制器方法中，以下内容应返回“Hello World”

```
string test = Session["test"].ToString (); 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2011-02-24T23:38:01.830

我做了一个比@RonnBlack 发布的答案稍微复杂一点的 Mock

```
public class HttpSessionStateDictionary : HttpSessionStateBase
{
    private readonly NameValueCollection keyCollection = new NameValueCollection();

    private readonly Dictionary<string, object> _values = new Dictionary<string, object>();

    public override object this[string name]
    {
        get { return _values.ContainsKey(name) ? _values[name] : null; }
        set { _values[name] = value; keyCollection[name] = null;}
    }

    public override int CodePage
    {
        get { throw new NotImplementedException(); }
        set { throw new NotImplementedException(); }
    }

    public override HttpSessionStateBase Contents
    {
        get { throw new NotImplementedException(); }
    }

    public override HttpCookieMode CookieMode
    {
        get { throw new NotImplementedException(); }
    }

    public override int Count
    {
        get { return _values.Count; }
    }

     public override NameObjectCollectionBase.KeysCollection Keys
{
    get { return keyCollection.Keys; }
}

    public Dictionary<string, object> UnderlyingStore
    {
        get { return _values; }
    }

    public override void Abandon()
    {
        _values.Clear();
    }

    public override void Add(string name, object value)
    {
        _values.Add(name, value);
    }

    public override void Clear()
    {
        _values.Clear();
    }

    public override void CopyTo(Array array, int index)
    {
        throw new NotImplementedException();
    }

    public override bool Equals(object obj)
    {
        return _values.Equals(obj);
    }

    public override IEnumerator GetEnumerator()
    {
        return _values.GetEnumerator();
    }

    public override int GetHashCode()
    {
        return (_values != null ? _values.GetHashCode() : 0);
    }

    public override void Remove(string name)
    {
        _values.Remove(name);
    }

    public override void RemoveAll()
    {
        _values.Clear();
    }

    public override void RemoveAt(int index)
    {
        throw new NotImplementedException();
    }

    public override string ToString()
    {
        return _values.ToString();
    }

    public bool Equals(HttpSessionStateDictionary other)
    {
        if (ReferenceEquals(null, other)) return false;
        if (ReferenceEquals(this, other)) return true;
        return Equals(other._values, _values);
    }
} 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-02T23:06:53.417

我刚刚找到了一个很好的例子，说明 Oxite 团队如何伪造他们的 HttpSessionState 并在该伪造中维护一个 SessionStateItemCollection 集合。在我的情况下，这应该和最小起订量一样有效。

编辑：

此示例的 URL 是[http://oxite.codeplex.com/sourcecontrol/changeset/view/33871?projectName=oxite#388065](http://oxite.codeplex.com/sourcecontrol/changeset/view/33871?projectName=oxite#388065)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-11T14:37:39.207

我认为你可以对模拟设置一个期望，它应该返回一个特定的值。模拟不用作实际的赝品，而是您可以断言行为的东西。

听起来您实际上是在寻找一个适配器，您可以围绕会话进行包装，您可以在测试期间提供不同的实现，并且在运行时它会返回 HttpContext Session 项？

这有意义吗？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2015-08-06T17:09:31.393

谢谢@RonnBlack 的解决方案！就我而言，我不断收到此异常，因为 Session.SessionID 为空：

```
System.NotImplementedException was unhandled by user code
  HResult=-2147467263
  Message=The method or operation is not implemented.
  Source=System.Web
  StackTrace:
       at System.Web.HttpSessionStateBase.get_SessionID() 
```

`Mock<HttpSessionStateBase>`为了解决这个问题，我使用 Moq而不是他的 MockHttpSession以这种方式实现 @RonnBlack 的代码：

```
 private readonly MyController controller = new MyController();

    [TestFixtureSetUp]
    public void Init()
    {
        var session = new Mock<HttpSessionStateBase>();
        session.Setup(s => s.SessionID).Returns(Guid.NewGuid().ToString());
        var request = new Mock<HttpRequestBase>();
        var response = new Mock<HttpResponseBase>();
        var server = new Mock<HttpServerUtilityBase>();
        // Not working - IsAjaxRequest() is static extension method and cannot be mocked
        // request.Setup(x => x.IsAjaxRequest()).Returns(true /* or false */);
        // use this
        request.SetupGet(x => x.Headers).Returns(
            new System.Net.WebHeaderCollection
            {
                {"X-Requested-With", "XMLHttpRequest"}
            });

        var context = new Mock<HttpContextBase>();
        //context
        context.Setup(ctx => ctx.Request).Returns(request.Object);
        context.Setup(ctx => ctx.Response).Returns(response.Object);
        context.Setup(ctx => ctx.Session).Returns(session.Object);
        context.Setup(ctx => ctx.Server).Returns(server.Object);
        context.SetupGet(x => x.Request).Returns(request.Object);
        context.SetupGet(p => p.Request.Url).Returns(new Uri("http://www.mytesturl.com"));
        var queryString = new NameValueCollection { { "code", "codeValue" } };
        context.SetupGet(r => r.Request.QueryString).Returns(queryString);

        controller.ControllerContext = new ControllerContext(context.Object, new RouteData(), controller);
    } 
```

详情请见[http://weblogs.asp.net/gunnarpeipman/using-moq-to-mock-asp-net-mvc-httpcontextbase](http://weblogs.asp.net/gunnarpeipman/using-moq-to-mock-asp-net-mvc-httpcontextbase)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2019-04-25T17:15:53.567

只是为了 Session 更简单的方法是在父类中创建 Session 对象并像这样使用它

```
 public class DalBl : IDalBl
{
    public dynamic Session
    {
        get { return HttpContext.Current.Session; }
    }
} 
```

并在 unitTest

```
 var session = new  Dictionary<string, object>();
        var moq = new Moq.Mock<IDalBl>();
        moq.Setup(d => d.Session).Returns(session); 
```

# php - 如何从选择框中选择多个选项

> ID：524462
> 
> 赞同：2
> 
> 时间：2009-02-07T19:57:00.737
> 
> 标签：php, javascript, html, css

我想知道我们如何从如下所示的选择框中选择多个选项：

```
<label for="color">Colors</label>
<select class="inputbox" name="color" id="color" style="width:180px;">
    <option value="Black">Black</option>
    <option value="White">White</option>
    <option value="Tan">Tan</option>
    <option value="Navy">Navy</option>
    <option value="RoyalBlue">Royal Blue</option>
    <option value="Red">Red</option>
    <option value="Yellow">Yellow</option>
    <option value="Hunter(DarkGreen)">Hunter(Dark Green)</option>
    <option value="Kelly(Green)">Kelly(Green)</option>
    <option value="Burgundy">Burgundy</option>
 </select> 
```

谢谢

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-02-07T19:59:21.760

您所要做的就是使用选择框上的 multiple 属性。

```
<select name="some-select" id="some-select" multiple="multiple">
    <option>Black</option>
    <option>White</option>
    <option>Other</option>
</select> 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-07T20:11:21.613

`$_GET`为了在 PHP 的//数组`$_POST`中为命名参数使用多个值`$_REQUEST`，您必须像这样命名表单字段：

```
name="myFieldName[]"; 
```

通过将大括号放在字段名称的末尾，PHP 将能够为该参数存储多个值。如果您使用多个复选框或多个选择，您应该像这样命名您的字段。并且不要忘记 HTML 选项标签的值。

在您的情况下，HTML 应该是这样的：

```
<select name="some-select[]" id="some-select" multiple="multiple">
<option value="balck">Black</option>
<option value="white">White</option>
<option value="other">Other</option>
</select> 
```

作为表单操作的 PHP 代码可以包含这样的数据。

```
$mySelectValues = $_REQUEST['some-select'];
// mySelectValues is an array now
foreach ($mySelectValues as $selected) {
    echo $selected;
} 
```

当您查看 HTML 页面时，您可以通过按住 Ctrl 键然后选择其他选项来选择多个选项。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-07T20:04:53.000

通常，如果您在标签中使用“多个”选项，HTML 表单将允许您按住 Ctrl 键并单击组合框中的多个选项。您也可以使用“Shift 键单击”来获取一系列值。

但有趣的问题是如何实现这一点，以便超过 10%（估计）的用户能够弄清楚如何使用它？

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2015-09-04T20:44:20.543

我在这里迟到了，但会尝试发布我的答案。可能不是最好的。

将`multiple`属性添加到选择并更改`name="color"`为类似的数组`name="color[]"`

```
<label for="color">Colors</label>
<select class="inputbox" name="color[]" id="color" style="width:180px;" multiple>
    <option value="Black">Black</option>
    <option value="White">White</option>
    <option value="Tan">Tan</option>
    <option value="Navy">Navy</option>
    <option value="RoyalBlue">Royal Blue</option>
    <option value="Red">Red</option>
    <option value="Yellow">Yellow</option>
    <option value="Hunter(DarkGreen)">Hunter(Dark Green)</option>
    <option value="Kelly(Green)">Kelly(Green)</option>
    <option value="Burgundy">Burgundy</option>
 </select> 
```

和 php 可以做这样的事情

```
foreach ($_POST['color'] as $selectedColor)
echo $selectedColor."\n";
//and this echos a comma separated string
$colorString=implode(",", $_POST['color']);
echo $colorString; 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-08-26T17:45:29.267

我也遇到过同样的问题，htmlforums 的人设法想出了一个办法。

论坛链接如下：

[http://www.htmlforums.com/client-side-scripting/t-select-multiple-items-without-ctrl-117760.html](http://www.htmlforums.com/client-side-scripting/t-select-multiple-items-without-ctrl-117760.html)

答案是：（我没有时间将其适应您的代码，抱歉）

```
 <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Select Test</title>

        <meta name="keywords" content="" />
        <meta name="description" content="" />

        <script type="text/javascript">

            // Variables we need
            var previous    = new Array();
            var lastClicked = '';

            // We are going to attach event listeners, no code at the bottom or anything hard coded...
            function addEvent(obj, evType, fn)
            { 
                if(obj.addEventListener)
                {
                    obj.addEventListener(evType, fn, false);
                    return true;
                }
                else if(obj.attachEvent)
                {
                    var r = obj.attachEvent('on' + evType, fn);
                    return r;
                }
                else
                {
                    return false; 
                } 
            }

            // Let's begin when the DOM is ready
            addEvent(window, 'load', begin);

            // Attach the handlers to our selects
            function begin()
            {
                addSelect('numbers');
                addSelect('sm');
                addSelect('sm2');
            }

            // We add a couple of handlers to each
            function addSelect(id)
            {
                var sel = document.getElementById(id);
                addEvent(sel, 'click', whichElement);
                addEvent(sel, 'click', addRemoveClicked);
            }

            // Find which element we are looking at on this click
            function whichElement(e)
            {
                if(!e)
                {
                    var e = window.event;
                }

                if(e.target)
                {
                    lastClicked = e.target;
                }
                else if(e.srcElement)
                {
                    lastClicked = e.srcElement;
                }

                if(lastClicked.nodeType == 3) // Safari bug
                {
                    lastClicked = lastClicked.parentNode;
                }
            }

            // Make sure we are displaying the correct items
            function addRemoveClicked(e)
            {
                if(!previous[this.id])
                {
                    previous[this.id] = new Array();
                }

                // Remember what has been used
                if(previous[this.id][lastClicked.value] == 1)
                {
                    previous[this.id][lastClicked.value] = 0;
                }
                else
                {
                    previous[this.id][lastClicked.value] = 1;
                }

                var selectBox = document.getElementById(this.id);

                // Add correct highlighting
                for(var i = 0; i < selectBox.options.length; i++)
                {
                    selectBox.options[i].selected = '';

                    if(previous[this.id][selectBox.options[i].value] == 1)
                    {
                        selectBox.options[i].selected = 'selected';
                    }
                }
            }
        </script>
    </head>

    <body>
        <form name="selectTest" action="">

            <select name="numbers" id="numbers" multiple="multiple" size="6"> 
                <option value="1">One</option>
                <option value="2">Two</option>
                <option value="3">Three</option>
                <option value="4">Four</option>
                <option value="5">Five</option>
            </select>

            <select name="sm" id="sm" multiple="multiple" size="6">
                <option value="a">To make</option>
                <option value="b">Multiple</option>
                <option value="c">Selections</option>
                <option value="d">Just Click</option>
                <option value="e">With The</option>
                <option value="f">Mouse</option>
            </select>

            <select name="sm2" id="sm2" multiple="multiple" size="6">
                <option>Everything</option>
                <option>Is</option>
                <option>Possible</option>
                <option>Until</option>
                <option>Proven</option>
                <option>Otherwise</option>
            </select>

        </form>
    </body>
    </html> 
```

我希望这有帮助。

谢谢，

马修·米勒

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-07T20:00:52.600

如何选择多个项目？CTRL+单击选项。

# jquery - jQuery 不能选择 AJAX 元素

> ID：524468
> 
> 赞同：4
> 
> 时间：2009-02-07T20:01:12.617
> 
> 标签：jquery, ajax

我正在尝试选择页面加载后添加的页面元素。请参阅下面的前后示例。之前是页面源，之后是生成的源。由于某种原因，我无法选择已生成的任何内容。

这对我来说似乎很奇怪，因为我很确定我以前做过。

谢谢你的帮助。

前：

```
<div class="foo"></div> 
```

后：

```
<div class="foo">
  <div class="bar"></div>
</div> 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-08T03:49:31.907

所有这些关于附加后绑定的评论都是有帮助的。

但是如果你切换到 jQuery 1.3，你可以在第一次设置页面时使用“live”而不是“bind”，那么即使添加了元素，你也会得到你的事件。

[http://docs.jquery.com/Events/live](http://docs.jquery.com/Events/live)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-07T20:43:26.493

将 div 附加到 时`#auto_suggest`，还需要绑定事件：

```
$("#auto_suggest").append("<div class='off'>Blah</div>");
$("#auto_suggest div.off").hover(function() { window.alert($(this).val()); }); 
```

否则，您将使用 jQuery 1.3 及更高版本。该`live()`功能将满足您的需求；例如

```
$("#auto_suggest div.off").live("hover", function() { window.alert($(this).val()); }); 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-07T20:44:09.893

您在创建 dom 元素之前绑定事件，据我所知，这不起作用。相反，您可以在附加后添加绑定。不过可能还有其他解决方案。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-07T20:09:34.470

这是不太可能的。我想自己看源码？

否则尝试在 Firefox/Iceweasel 中使用 Firebug。Firebug 是天赐之物——使用“控制台”选项卡——用于 ajax 密集型站点，其中“查看源代码”是一个不完美的解决方案。您可以执行以下操作：

$(".foo .bar")

控制台将输出匹配元素的数量！

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-07T20:30:43.680

好的，这是代码，如果我删除底部选择器中的 div.off，我会收到测试警报，因为该元素不是生成源。

```
$(document).ready(function(){ 
```

$(".search_container 输入").keyup(function(){

```
var search; 
search = $(".search_container input").val();

if (search.length > 2){

  $.ajax({
    type: "GET", 
    url: "http://localhost:8080/search.xml",
    data: "zoom_query=" + search + "&zoom_xml=1",
    dataType: "xml",
    success: function(xml){

      $("#auto_suggest").empty(); 
      $("#auto_suggest").show();

      var _title = "";
      var _link = "";

      $("item", xml).each(function(){

        _title = $("title", this).text();
        _link = $("link", this).text();
        _context = $("zoom\\:context", this).text();

        if ($(this).length > 0){

          message = "<div class=\"off\">";
          message += "<div title='" + _context + "'>" + _title + "</div>";
          message += "<small>" + _link + "</small>";
          message += "</div>";

          $("#auto_suggest").append(message); 

        }
        else {

          $("#auto_suggest").hide();

        }

      });

    }

  });

}
else {

  $("#auto_suggest").hide();

}; 
```

});

$("#auto_suggest div.off").hover(function(){

```
 alert('test'); 
```

});

});

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-02-07T20:03:47.463

您需要仔细检查所有代码。jQuery 可以访问 DOM 的所有部分，无论它们是静态的还是动态的。

我们需要查看 JavaScript 以帮助您进一步排除故障。

# javascript - 滚动速度与鼠标位置

> ID：524478
> 
> 赞同：2
> 
> 时间：2009-02-07T20:07:17.160
> 
> 标签：javascript, jquery

我有一个小问题，我应该怎么想……问题。我想做一些与[此类](http://www.lo2k.net/v7/lab/flickr/index/flickr_id/23006509@N00)似的事情：当您将鼠标移动到靠近边缘时，您会看到图像滚动的速度比将鼠标放在 DIV 中间时的滚动速度快。

不知道我的解释是否正确，但是......我不知道如何解决这个问题。我确定它与 mousemove 绑定，但我猜这与数学有关。数学不是我最好的技能：D

多谢你们！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-07T20:35:40.423

不幸的是，除了从第 59 行开始链接的站点的源代码中已经读到的内容之外，没有什么可以告诉您的了。我可能会建议简单地尝试在您自己的沙箱页面中复制类似的东西，使用他们拥有的代码作为指导。只需剥离所有可以做的事情，然后从单个图像开始，绑定 mousemove 事件并尝试使用偏移量获取相对位置（请参阅 jquery - [offset](http://docs.jquery.com/CSS/offset)）。

不过，它是新画布标签的一个非常好的实现，我还没有看到它被大量使用，所以感谢您提供链接。我至少可以在[画布](https://developer.mozilla.org/en/Canvas_tutorial) [标签](http://billmill.org/static/canvastutorial/)上为您提供一些有趣的链接，这些链接可能会给您一些指导。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-11-08T15:17:20.663

这是一个老问题，但您可以根据鼠标位置和边缘之间的距离计算百分比。然后使用该比例来设置动画的速度。

# .net - .NET Backgroundworker 对象的线程优先级

> ID：524483
> 
> 赞同：9
> 
> 时间：2009-02-07T20:10:54.483
> 
> 标签：.net, multithreading, backgroundworker

我正在尝试在我正在开发的应用程序中使用 .NET Backgroundworker 对象。

互联网上的所有资料都说该对象在“后台”运行，但**我无法确认该后台线程确实以“低优先级”模式运行**。出现这个问题是因为在 Windows（我假设）中，后台任务可以在“正常”或“低于正常”或“低”优先级模式下运行。

在我的应用程序中，我尝试通过调用 ...

```
Thread.CurrentThread.Priority=ThreadPriority.Lowest 
```

...

但这似乎没有效果。后台工作人员是否忽略此调用？

我想再解释一些：

我的应用程序是一个互联网客户端，它从室内收集有关温度、湿度等的实时数据，并使用

`system.net.webclient.UploadValuesAsync(...)`来电

我已经编写了应用程序，以便客户端 GUI 从腔室收集数据，为它们加上时间戳，然后将它们排队等待上传，就像这样

...

```
Synclock objlock
    debug.print("Queueing reading...")
    dataQ.Enque(reading)
End Synclock
... 
```

backgroundworker 的 Dowork 函数出列，然后像这样上传......

.....................

```
Do
        if dataQ.count() <> 0 then
            Synclock objlock
              reading = dataQ.DeQue()
            End Synclock
            Dim client As New System.Net.WebClient
            ...put the reading in NameValueCollection and upload to server page
            req = new NameValueCollection
            ...
            ...
            client.UploadValuesAsync(uri, "POST", req)
        endif
        thread.sleep(1) 'without this line the CPU usage goes upto 100% and seems to slow other tasks!
    Loop 
```

......

当我运行程序时，我发现每当调用 UploadValuesAsync 时，调试窗口就会停止。我还添加了调试语句以随时查看队列中有多少读数。如果此任务真正以低优先级运行，我希望看到队列计数在获取数据时迅速增加，然后仅在前台空闲且未获取数据时减少。但这种情况并非如此。一旦将读数添加到队列中，它就会出列并上传。因此队列计数始终为 1 或 0！

我的方法有问题吗？我根本不应该使用后台工作者对象吗？

顺便说一句，这是在运行 Windows XP 的双核笔记本电脑中。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-02-07T20:53:08.173

只是补充一下 Jon 和 Marc 已经说过的话：

后台线程没有较低的优先级。前台线程和后台线程之间的区别在于，一旦没有更多前台线程在运行，CLR 将关闭进程。线程池线程是后台线程。

您实际上可以设置线程池线程的优先级，但是由于您几乎无法控制哪个线程池线程将实际运行您的任务，因此不建议这样做。如果您需要特定优先级的线程，您应该使用 Thread 类型创建它们并根据需要设置实例的优先级。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-02-07T20:19:06.323

是的，您的方法有问题 - 当队列为空时，您基本上是在紧密循环。无论线程优先级如何，这都是个坏主意。

为此使用后台工作人员没有任何问题，但是入队/出队实际上应该只使用生产者/消费者队列，当您尝试在没有准备好的情况下出队时阻塞。

[我在我的线程教程](http://www.yoda.arachsys.com/csharp/threads/deadlocks.shtml)中有一个生产者/消费者队列的示例实现- 请参阅链接页面的大约一半。顺便说一句，您需要某种方式来告诉出队过程它已经完成。（例如，将空引用或其他特殊值排入队列。）该代码是在泛型之前编写的，但应该很容易更新。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-07T20:18:44.000

它并没有声称是低优先级 - 背景意味着 a：不是 UI 线程，并且 b：它不会让进程保持活动状态。实际上，它可能与`ThreadPool`线程有关。

如果你想要一个特定的优先级线程，那么使用你自己的`Thread`对象 - 但我通常不会推荐这个......

此外 - “背景”并不意味着“空闲时”。即使在单核机器上，您也可能会看到两个线程都获得尽可能多的 rnutime（如果他们想要的话）。多核更是如此。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-09T17:12:44.867

您可能想查看此工作线程实现。它具有用于指定线程名称、线程优先级以及线程是否为后台线程的受保护构造函数。

[http://devpinoy.org/blogs/jakelite/archive/2008/12/20/threading-patterns-the-worker-thread-pattern.aspx](http://devpinoy.org/blogs/jakelite/archive/2008/12/20/threading-patterns-the-worker-thread-pattern.aspx)

# .net - 这段代码是线程安全的吗？

> ID：524495
> 
> 赞同：3
> 
> 时间：2009-02-07T20:18:41.410
> 
> 标签：.net, c++, multithreading, thread-safety

我正在编写一些代码，其中 UI 线程需要与后台线程进行网络通信。代码有效，但它会被认为是线程安全的吗？

如果有经验的人能带领我走上正确的道路，我会感觉好多了……

```
static Mutex^ mut_currentPage = gcnew Mutex;
static array<unsigned char>^ m_currentPage;

property array<unsigned char>^ Write
{
    void set(array<unsigned char>^ value) 
    {
        mut_currentPage->WaitOne();
        m_currentPage = value;
        mut_currentPage->ReleaseMutex();
    }
} 
```

这是 .NET C++ 代码... :)

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-07T20:23:59.230

它看起来是线程安全的，但您可能需要考虑异常处理；设置字段不应该出错（可能除外`ThreadAbortException`），但如果代码更复杂，您需要确保在出现异常时释放互斥锁。

我也会看看`Monitor`（C#中的“锁定”）

另一种想法：即使您锁定了字段访问，数组本质上也是可变的。考虑`string`改用，因为这是不可变的？

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-07T20:22:59.030

如果您在进程中使用线程并且只想互斥，请使用 Monitor 而不是 Mutex - 我相信它更有效。

这看起来不错 - 但您在*读取*值时也应该锁定，否则没有什么可以说它不会过时。另一种方法是使变量 volatile（至少在 C# 中 - 我不知道 C++/CLI 中的等价物是什么。）

# c# - Rhino Mocks，每次执行存根方法时返回不同的结果

> ID：524498
> 
> 赞同：7
> 
> 时间：2009-02-07T20:18:54.763
> 
> 标签：c#, rhino-mocks

在本例中，.Stub 返回一个新的内存流。两次都返回相同的内存流。我想要的是每次都有一个新的内存流。我的问题是，如何更改 .Stub 以使此测试通过？

```
[TestMethod]
public void Meh()
{
    var mockFileSystem = MockRepository.GenerateMock<IFileSystemService>();
    mockFileSystem.Stub(fs => fs.CreateFileStream(null, FileMode.Append, FileAccess.Write, FileShare.None))
        .IgnoreArguments()
        .Return(new MemoryStream());

    var result1 = mockFileSystem.CreateFileStream(null, FileMode.Append, FileAccess.Write, FileShare.None);
    var result2 = mockFileSystem.CreateFileStream(null, FileMode.Append, FileAccess.Write, FileShare.None);
    Assert.AreNotSame(result1, result2);
} 
```

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-09T10:26:58.507

诀窍是使用 WhenCalled 替换之前的 Return 操作：

```
[TestMethod]
public void Meh()
{
    var mockFileSystem = MockRepository.GenerateMock<IFileSystemService>();
    mockFileSystem.Stub(fs => fs.CreateFileStream(null, FileMode.Append, FileAccess.Write, FileShare.None))
        .IgnoreArguments()
        .Return(null) 

        //*****The return value is replaced in the next line!
        .WhenCalled(invocation => invocation.ReturnValue = new MemoryStream());

    var result1 = mockFileSystem.CreateFileStream(null, FileMode.Append, FileAccess.Write, FileShare.None);
    var result2 = mockFileSystem.CreateFileStream(null, FileMode.Append, FileAccess.Write, FileShare.None);
    Assert.AreNotSame(result1, result2);
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-08T17:35:50.287

根据您使用的版本，有一个隐含的Repeat.Once 或Repeat.Any - 从您的测试中我认为它是最近添加的Repeat.Any。所以我相信它会返回相同的对象，因为 new 出现在您的初始语句中，即它不是在每次调用模拟方法时执行的委托。为了得到你想要的，做两个期望调用，每个调用一个repeat.once。

# linux - rdts 标记时间期限

> ID：524502
> 
> 赞同：0
> 
> 时间：2009-02-07T20:20:30.313
> 
> 标签：linux, multithreading, real-time

我有一个“听起来”像这样的代码：

线程 1

```
now = rdtsc();
for_each_member_in_a_list {
   if ( member_in_list.deadline() <= now ) {
      do_something;
   }
} 
```

线程 2

```
now = rdtsc();
for_each_member_in_a_list {
   member_in_list.updatedealine( foo(now, ...) );
} 
```

现在虽然这在过去使用 SMP 系统运行良好，但此代码无法按预期工作。我想我会将clock_gettime 与CLOCK_MONOTONIC 一起使用，但我想先听听其他一些提示。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-10T00:08:59.483

理论上 TSC 应该是主板上所有 CPU 之间的同步，但在某些 SMP 系统中它不是，这要怪主板制造商。此外，在一些较旧的芯片上，TSC 似乎会随着 CPU 的电源状态而变化，使其可能非常不可靠。clock_gettime(CLOCK_MONOTONIC) 更可靠，但开销更大（这是一个系统调用），但到目前为止是最好的方法。

我还假设您正在锁定您的数据结构:)

# c# - Windows API 和 .net 语言

> ID：524503
> 
> 赞同：4
> 
> 时间：2009-02-07T20:20:46.070
> 
> 标签：c#, .net, vb.net, winapi, visual-c++

人们总是建议我，如果我正在做一些应该使用某些 Windows API 来完成任何进程级工作的应用程序，我必须使用 VC++ 而不是任何其他 .net 语言。

这有什么道理吗？

可以使用 VC++ 完成的所有事情也可以在其他 .net 语言中完成吗？

比较所有 .net 语言的功能时，它们是否相同？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-02-07T20:25:00.837

如果您需要非常密切地使用本机代码，C++ 可能会让生活变得更轻松。但是，使用 P/Invoke 从 C#、VB.NET、F# 等调用 Win32 API 本身并没有错。

*尽管 C# 和 VB.NET 在功能上基本*相同，但并非所有 .NET 语言的功能都相同。我知道 C++/CLI 公开了一些 C# 或 VB.NET 没有公开的东西——我不知道反过来是否正确。（我不知道 C++/CLI 对于 lambda 表达式、扩展方法等是什么样的。）

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-07T20:28:01.687

对于类库不提供帮助的大多数任务，通常使用 P/Invoke 就可以了。有许多“粗略”的 API 受益于简单的 C++/CLI 包装器。通常最好在 C++/CLI 代码中做最少的事情——有效地按摩下面的丑陋之处，供 C#、VB.NET 等使用。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-07T20:42:53.903

当我开始在 .Net 中编程时，我使用的是 C++/CLI，因为我来自最小的 Win32 C++ 背景。我发现我很头疼，因为我不了解 C++/CLI 和 Win32 C++ 之间的细微差别和界限。它不像它们看起来那样容易在两者之间进行互操作。当我了解 P/Invoke 并让我的生活变得更轻松时，我终于开始提高我的技能。P/Invoke 很好，你不一定需要 C++/CLI 来做到这一点。在我看来，您要么完全将 Win32 C++ 用于低级别的东西，要么将 .Net 用于高级的东西，我真的不建议您尝试将 Win32 C++ 与 C++/CLI 进行互操作，除非您绝对必须这样做。即便如此，使用您需要的内容制作 Win32 DLL 并从 .Net 中 P/Invoke DLL 可能更容易，反之亦然。

# php - 如何在开发 LAMP 服务器上运行多个版本的 PHP 5.x？

> ID：524508
> 
> 赞同：81
> 
> 时间：2009-02-07T20:23:08.983
> 
> 标签：php, lamp

我需要使用多个版本的 PHP 5.x 测试我的 PHP 应用程序，例如 PHP 5.0.0 和 PHP 5.2.8。

有没有一种方法可以配置开发 LAMP 服务器，以便我可以使用多个版本的 PHP5 快速测试应用程序？

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2013-05-25T15:51:11.373

在 CentOS 中，您可以将 fastcgi 用于一个 PHP 版本，将 php-fpm 用于另一个版本，如下所述：

[https://web.archive.org/web/20130707085630/http://linuxplayer.org/2011/05/intall-multiple-version-of-php-on-one-server](https://web.archive.org/web/20130707085630/http://linuxplayer.org/2011/05/intall-multiple-version-of-php-on-one-server)

# 基于 CentOS 5.6，仅适用于 Apache

## 1.启用rpmforge和epel yum仓库

```
wget http://packages.sw.be/rpmforge-release/rpmforge-release-0.5.2-2.el5.rf.x86_64.rpm
wget http://download.fedora.redhat.com/pub/epel/5/x86_64/epel-release-5-4.noarch.rpm
sudo rpm -ivh rpmforge-release-0.5.2-2.el5.rf.x86_64.rpm
sudo rpm -ivh epel-release-5-4.noarch.rpm 
```

## 2.安装php-5.1

CentOS/RHEL 5.x 系列自带 php-5.1，只需用 yum 安装即可，例如：

```
sudo yum install php php-mysql php-mbstring php-mcrypt 
```

## 3、从源码编译安装php 5.2和5.3

对于 php 5.2 和 5.3，我们可以在网上找到很多 rpm 包。但是，它们都与CentOS自带的php冲突，所以，我们最好从源头构建和安装，这并不难，关键是将php安装在不同的位置。

但是，当将 php 作为 apache 模块安装时，我们只能同时使用一个版本的 php。如果我们需要在同一台服务器上同时运行不同版本的php，例如不同的虚拟主机可能需要不同版本的php。幸运的是，很酷的 FastCGI 和 PHP-FPM 可以提供帮助。

在启用 fastcgi 的情况下构建和安装 php-5.2

### 1）安装所需的开发包

```
yum install gcc libxml2-devel bzip2-devel zlib-devel \
    curl-devel libmcrypt-devel libjpeg-devel \
    libpng-devel gd-devel mysql-devel 
```

### 2）编译安装

```
wget http://cn.php.net/get/php-5.2.17.tar.bz2/from/this/mirror
tar -xjf php-5.2.17.tar.bz2
cd php-5.2.17
./configure --prefix=/usr/local/php52 \
    --with-config-file-path=/etc/php52 \
    --with-config-file-scan-dir=/etc/php52/php.d \
    --with-libdir=lib64 \
    --with-mysql \
    --with-mysqli \
    --enable-fastcgi \
    --enable-force-cgi-redirect \
    --enable-mbstring \
    --disable-debug \
    --disable-rpath \
    --with-bz2 \
    --with-curl \
    --with-gettext \
    --with-iconv \
    --with-openssl \
    --with-gd \
    --with-mcrypt \
    --with-pcre-regex \
    --with-zlib
make -j4 > /dev/null
sudo make install
sudo mkdir /etc/php52
sudo cp php.ini-recommended /etc/php52/php.ini 
```

### 3）创建一个fastcgi包装脚本

创建文件/usr/local/php52/bin/fcgiwrapper.sh

```
#!/bin/bash
PHP_FCGI_MAX_REQUESTS=10000
export PHP_FCGI_MAX_REQUESTS
exec /usr/local/php52/bin/php-cgi
chmod a+x /usr/local/php52/bin/fcgiwrapper.sh
Build and install php-5.3 with fpm enabled

wget http://cn.php.net/get/php-5.3.6.tar.bz2/from/this/mirror
tar -xjf php-5.3.6.tar.bz2 
cd php-5.3.6
./configure --prefix=/usr/local/php53 \
    --with-config-file-path=/etc/php53 \
    --with-config-file-scan-dir=/etc/php53/php.d \
    --enable-fpm \
    --with-fpm-user=apache \
    --with-fpm-group=apache \
    --with-libdir=lib64 \
    --with-mysql \
    --with-mysqli \
    --enable-mbstring \
    --disable-debug \
    --disable-rpath \
    --with-bz2 \
    --with-curl \
    --with-gettext \
    --with-iconv \
    --with-openssl \
    --with-gd \
    --with-mcrypt \
    --with-pcre-regex \
    --with-zlib 

make -j4 && sudo make install
sudo mkdir /etc/php53
sudo cp php.ini-production /etc/php53/php.ini

sed -i -e 's#php_fpm_CONF=\${prefix}/etc/php-fpm.conf#php_fpm_CONF=/etc/php53/php-fpm.conf#' \
    sapi/fpm/init.d.php-fpm
sudo cp sapi/fpm/init.d.php-fpm /etc/init.d/php-fpm
sudo chmod a+x /etc/init.d/php-fpm
sudo /sbin/chkconfig --add php-fpm
sudo /sbin/chkconfig php-fpm on

sudo cp sapi/fpm/php-fpm.conf /etc/php53/ 
```

**配置 php-fpm**

编辑/etc/php53/php-fpm.conf，更改一些设置。这一步主要是取消一些设置的注释，你可以根据需要调整值。

```
pid = run/php-fpm.pid
listen = 127.0.0.1:9000
pm.start_servers = 10
pm.min_spare_servers = 5
pm.max_spare_servers = 20 
```

**然后，启动 fpm**

```
sudo /etc/init.d/php-fpm start 
```

**安装和设置 mod_fastcgi、mod_fcgid**

```
sudo yum install libtool httpd-devel apr-devel
wget http://www.fastcgi.com/dist/mod_fastcgi-current.tar.gz
tar -xzf mod_fastcgi-current.tar.gz
cd mod_fastcgi-2.4.6
cp Makefile.AP2 Makefile
sudo make top_dir=/usr/lib64/httpd/ install
sudo sh -c "echo 'LoadModule fastcgi_module modules/mod_fastcgi.so' > /etc/httpd/conf.d/mod_fastcgi.conf"
yum install mod_fcgid 
```

**设置和测试虚拟主机**

1) 将以下行添加到 /etc/hosts

```
127.0.0.1 web1.example.com web2.example.com web3.example.com 
```

2）创建web文档根目录并在其下放一个index.php以显示phpinfo切换到用户根目录，运行

```
mkdir /var/www/fcgi-bin
for i in {1..3}; do
    web_root=/var/www/web$i
    mkdir $web_root
    echo "<?php phpinfo(); ?>" > $web_root/index.php
done 
```

*注意：空的 /var/www/fcgi-bin 目录是必需的，以后不要删除它*

3) 创建 Apache 配置文件（附加到 httpd.conf）

```
NameVirtualHost *:80

# module settings
# mod_fcgid
<IfModule mod_fcgid.c>
        idletimeout 3600
        processlifetime 7200
        maxprocesscount 17
        maxrequestsperprocess 16
        ipcconnecttimeout 60 
        ipccommtimeout 90
</IfModule>
# mod_fastcgi with php-fpm
<IfModule mod_fastcgi.c>
        FastCgiExternalServer /var/www/fcgi-bin/php-fpm -host 127.0.0.1:9000
</IfModule>

# virtual hosts...

#################################################################
#1st virtual host, use mod_php, run php-5.1
#################################################################
<VirtualHost *:80>
        ServerName web1.example.com
        DocumentRoot "/var/www/web1"

        <ifmodule mod_php5.c>
                <FilesMatch \.php$>
                        AddHandler php5-script .php
                </FilesMatch>
        </IfModule>

        <Directory "/var/www/web1">
                DirectoryIndex index.php index.html index.htm
                Options -Indexes FollowSymLinks
                Order allow,deny
                Allow from all
        </Directory>

</VirtualHost>
#################################################################
#2nd virtual host, use mod_fcgid, run php-5.2
#################################################################
<VirtualHost *:80>
        ServerName web2.example.com
        DocumentRoot "/var/www/web2"

        <IfModule mod_fcgid.c>
                AddHandler fcgid-script .php
                FCGIWrapper /usr/local/php52/bin/fcgiwrapper.sh
        </IfModule>

        <Directory "/var/www/web2">
                DirectoryIndex index.php index.html index.htm
                Options -Indexes FollowSymLinks +ExecCGI
                Order allow,deny
                Allow from all
        </Directory>

</VirtualHost>
#################################################################
#3rd virtual host, use mod_fastcgi + php-fpm, run php-5.3
#################################################################
<VirtualHost *:80>
        ServerName web3.example.com
        DocumentRoot "/var/www/web3"

        <IfModule mod_fastcgi.c>
                ScriptAlias /fcgi-bin/ /var/www/fcgi-bin/
                AddHandler php5-fastcgi .php
                Action php5-fastcgi /fcgi-bin/php-fpm
        </IfModule>

        <Directory "/var/www/web3">
                DirectoryIndex index.php index.html index.htm
                Options -Indexes FollowSymLinks +ExecCGI
                Order allow,deny
                Allow from all
        </Directory>

</VirtualHost> 
```

4）重启阿帕奇。分别访问 3 个站点以查看 phpinfo 并验证结果。IE：

```
http://web1.example.com
http://web2.example.com
http://web3.example.com 
```

如果一切正常，您可以使用 3 个虚拟主机之一作为模板来创建具有所需 php 版本的新虚拟主机。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2009-02-07T20:36:56.303

一种方法是使用 mod_php 设置您的 php 主版本，并通过不同端口（即 81、82、83 等）上的快速 cgi 运行所有其他版本。但是，这并不能保证完全一致的行为。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2009-02-12T07:00:22.697

拥有多个 apache + php 实例从来没有真正让我喜欢，但这可能是最简单的方法。如果你不喜欢 KISS……这里有个主意。

让你的 apache 启动并运行，并尝试像 debian 和 ubuntu 那样配置它，例如，为加载的模块提供目录。您的 apache conf 可以使用如下行：

```
Include /etc/apache2/mods-enabled/*.load
Include /etc/apache2/mods-enabled/*.conf 
```

然后构建你的第一个 php 版本，并给它一个明确包含版本号的前缀，例如 /usr/local/php/5.2.8、/usr/local/php/5.2.6 ...

conf/load 看起来像这样：

php5.2.6.load

```
LoadModule php5_module /usr/local/php/5.2.6/libphp5.so 
```

php5.2.8.load

```
LoadModule php5_module /usr/local/php/5.2.8/libphp5.so 
```

要切换版本，您所要做的就是更改目录中的加载和配置文件 apache 为另一个版本的包含打开。您可以使用简单的 bash 脚本自动执行此操作（删除实际文件，复制备用版本文件，然后重新启动 apache.

这种设置的一个优点是一切都是一致的，只要您在选项和模块方面保持 php.ini 相同（无论如何您都必须使用 CGI）。他们都在通过SAPI。您的应用程序不需要任何更改，也不需要使用相对 URL。

我*认为*这应该可行，但话又说回来，我没有尝试过，也不太可能这样做，因为我没有与您相同的要求。如果您尝试过，请发表评论。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2015-07-20T09:19:40.100

注意：以下方法适用于 windows。

另一种方法（如果可以一次运行单个版本的 PHP）是定义多个 Apache 服务，每个服务将使用不同的 PHP 版本。

首先Apache配置文件中的使用条件：

```
 <ifdefine php54>
    SetEnv PHPRC C:/apache/php54/
    ScriptAlias /php/ "C:/apache/php54/"
    AddType application/x-httpd-php .php
    Action application/x-httpd-php "/php/php-cgi.exe"
</ifdefine>

<ifdefine php55>
    SetEnv PHPRC C:/apache/php55/
    ScriptAlias /php/ "C:/apache/php55/"
    AddType application/x-httpd-php .php
    Action application/x-httpd-php "/php/php-cgi.exe"
</ifdefine> 
```

现在使用 httpd.exe 从命令行创建两个单独的服务（提升为管理员）：

```
httpd.exe -k install -n Apache224_php54 -D php54

httpd.exe -k install -n Apache224_php55 -D php55 
```

现在您可以一次启动上述服务之一（应该先关闭一个，然后再启动另一个）。

如果您之前已将 Apache 安装为服务，则可以使用以下命令将其删除（将服务名称替换为您使用的名称）：

```
apache -k uninstall -n Apache224 
```

还有一点需要注意的是，我个人使用一个名为“Seobiseu”的“通知区域图标程序”来根据需要启动和停止服务。我已将上述两项服务添加到其中。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2013-05-23T00:39:11.333

了解到您可能正在谈论本地/桌面机器并且可能想*继续*谈论本地/桌面机器，我会为您提供一个替代方案，以防万一它可能对您或其他人有所帮助：

在云中设置多个虚拟服务器实例，并在它们之间共享您的代码作为 git 存储库（或 mercurial，我想，虽然我没有个人经验，但您真正需要的是去中心化的东西）。这样做的好处是让您尽可能接近生产体验，如果您有设置服务器的经验，那么它并不那么复杂（或昂贵，如果您只是想启动服务器，做您需要做的事情，然后再把它转下来，然后你说的是几美分，最多说 50 美分，如果你让它继续运行，最多可以赚几美元）。

这些天，我在云中进行所有项目开发，我发现管理基础架构比使用本地/非虚拟化安装时要简单得多，并且它使这种并行场景相当直截了当。如果你没有考虑过，我只是想把这个想法扔出去。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2010-08-10T10:51:25.543

我刚刚在 Ubuntu 10 上成功从 PHP5.3 降级。

为此，我使用了以下脚本：

```
#! /bin/sh
php_packages=`dpkg -l | grep php | awk '{print $2}'`

sudo apt-get remove $php_packages

sed s/lucid/karmic/g /etc/apt/sources.list | sudo tee /etc/apt/sources.list.d/karmic.list

sudo mkdir -p /etc/apt/preferences.d/

for package in $php_packages;
do echo "Package: $package
Pin: release a=karmic
Pin-Priority: 991
" | sudo tee -a /etc/apt/preferences.d/php
done

sudo apt-get update

sudo apt-get install $php_packages 
```

对于不知道如何从命令行运行脚本的人，这里有一个简短的教程：

```
1\. cd ~/
2\. mkdir bin
3\. sudo nano ~/bin/myscriptname.sh
4\. paste in the script code I have posted above this
5\. ctrl+x (this exits and prompts for you to save)
6\. chmod u+x myscriptname.sh 
```

这 6 个步骤在您的主目录中名为“bin”的文件夹中创建了一个脚本。然后，您可以通过调用以下命令来运行此脚本：

```
~/bin/myscriptname.sh 
```

欧利亚！

希望这对你们中的一些人有所帮助！

作为参考，这里是我得到脚本的地方： [PHP5.2.10 for Ubuntu 10](http://thejibe.com/blog/10/5/php-5210-debs-ubuntu-104-lucid)

那里有几个人都确认这是可行的，这对我来说是一种享受。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2016-12-06T07:53:20.387

创建 PHP 的 Rasmus Lerdorf 正在维护一个活跃的 Vagrant 解决方案，似乎可以解决您的需求。它允许在 PHP 版本之间快速切换，目前支持 20 多个不同的版本。它带有 nginx 服务器，开箱即用，但可以通过预先配置的设置轻松切换到 apache2。它还支持开箱即用的 MySQL。

这样，您将可以访问所有版本的 PHP，可部署在两个主要的 Web 服务器上，在一个漂亮的 vagrant box 中，由 PHP 背后的大人物维护。

欲了解更多信息，我想参考先生的演讲。勒多夫在[https://youtu.be/6XnysJAyThs?t=2864](https://youtu.be/6XnysJAyThs?t=2864)

包含 Vagrant 解决方案的 github 存储库位于[https://github.com/rlerdorf/php7dev](https://github.com/rlerdorf/php7dev)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2016-12-31T22:05:16.337

为了测试，我只是在不同的 IP 地址上运行多个 httpd 实例，所以我在 192.168.0.70 上运行 php7，在 192.168.0.56 上运行 php5.6。在生产中，我有一个运行 php5.3 的旧 oscommerce 的站点，而我只有一个不同的 conf 文件用于该站点

```
httpd -f /etc/apache2/php70.conf
httpd -f /etc/apache2/php53.conf 
```

`php.ini`这也是一种为不同站点提供不同文件的干净方式。如果您只有几个站点，如果这是一种保持事物井井有条的好方法，并且您在升级某些东西时不必担心一次超过 1 个站点

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2017-02-14T04:38:52.487

我的盒子上有几个项目正在运行。如果您已经安装了多个版本，这个 bash 脚本应该可以帮助您轻松切换。目前我有 php5、php5.6 和 php7.0，我经常根据我正在从事的项目来回切换。这是我的代码。

随意复制。确保您了解代码的工作原理。这是针对 webhostin 的。我的本地盒子我的模组存储在 /etc/apache2/mods-enabled/

```
 #!/bin/bash
# This file is for switching php versions.  
# To run this file you must use bash, not sh
# 
    # OS: Ubuntu 14.04 but should work on any linux
# Example: bash phpswitch.sh 7.0
# Written by Daniel Pflieger
# growlingflea at g mail dot com

NEWVERSION=$1  #this is the git directory target

#get the active php enabled mod by getting the array of files and store
#it to a variable
VAR=$(ls /etc/apache2/mods-enabled/php*)

#parse the returned variables and get the version of php that is active.
IFS=' ' read -r -a array <<< "$VAR"
array[0]=${array[0]#*php}
array[0]=${array[0]%.conf}

#confirm that the newversion veriable isn't empty.. if it is tell user 
#current version and exit
if [ "$NEWVERSION" = "" ]; then
echo current version is ${array[0]}.  To change version please use argument
exit 1
fi 

OLDVERSION=${array[0]}
#confirm to the user this is what they want to do
echo "Update php"  ${OLDVERSION} to ${NEWVERSION}

#give the user the opportunity to use CTRL-C to exit ot just hit return
read x

#call a2dismod function: this deactivate the current php version
sudo a2dismod php${OLDVERSION}

#call the a2enmod version.  This enables the new mode
sudo a2enmod php${NEWVERSION} 

echo "Restart service??"
read x

#restart apache
sudo service apache2 restart 
```

# c++ - 最适合即时通讯客户端的异步套接字模型？

> ID：524512
> 
> 赞同：4
> 
> 时间：2009-02-07T20:24:26.610
> 
> 标签：c++, sockets

我正在使用 C++ (Win32) 开发即时通讯客户端，并且正在尝试不同的异步套接字模型。到目前为止，我一直在使用[WSAAsyncSelect](http://msdn.microsoft.com/en-us/library/ms741540(VS.85).aspx)通过我的主窗口接收通知。但是，我遇到了一些意想不到的结果，Winsock 为单个套接字额外生成了 5-6 个线程（除了调用 WSAAsyncSelect 时创建的初始线程）。

我计划修改客户端以通过 DLL:s 支持其他协议，而且我担心我目前的解决方案将不适合基于我对 WSAAsyncSelect 的经验，除了我对混合网络与 UI 代码持否定态度（在消息循环）。

我正在寻找有关多协议 IM 客户端的合适异步套接字模型的建议，该客户端需要能够处理**大约 10-20 多个连接**（取决于协议的数量和协议设计等），而不是使用过多的线程——我对性能和降低资源使用率非常感兴趣。

我一直在寻找 IO Completion Ports，但从我收集到的信息来看，这似乎有点矫枉过正。我非常感谢一些关于合适的套接字解​​决方案的意见！

提前致谢！:-)

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-07T20:44:18.050

处理多个并发套接字有四种基本方法。

1.  多路复用，即使用 select() 轮询套接字。
2.  AsyncSelect 这基本上就是您使用 WSAAsyncSelect 所做的事情。
3.  工作线程，为每个连接创建一个线程。
4.  IO 完成端口，或 IOCP。dp 上面提到了它们，但基本上它们是一种特定于操作系统的处理异步 I/O 的方式，具有非常好的性能，但它有点混乱。

您选择哪个通常取决于您打算去哪里。如果您打算将应用程序移植到其他平台，您可能需要选择 #1 或 #3，因为 select 与其他操作系统上使用的其他模型没有太大区别，并且大多数其他操作系统也有线程的概念（尽管它们可能操作不同）。IOCP 通常是特定于 Windows 的（尽管 Linux 现在也有一些异步 I/O 功能）。

如果您的应用程序仅适用于 Windows，那么您基本上希望为您正在做的事情选择最佳模型。这可能是#3 或#4。#4 是最有效的，因为它回调到您的应用程序（类似，但性能更好，WSAsyncSelect 问题更少）。

使用线程（IOCP 或 WorkerThreads）时必须处理的一件大事是将数据封送回可以更新 UI 的线程，因为您不能在工作线程上调用 UI 函数。最终，在大多数情况下，这将涉及一些来回的消息传递。

如果您是在托管代码中开发它，我会告诉您查看 Jeffrey Richter 的 AysncEnumerator，但您选择了 C++，它有利有弊。很多人已经为 C++ 编写了各种网络库，也许你应该花一些时间研究其中的一些。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-07T20:31:31.183

考虑使用您可以在 boost (www.boost.org) 中找到的 ASIO 库。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-07T21:30:44.277

只需使用同步模型。现代操作系统可以很好地处理多个线程。在极少数情况下确实需要异步 IO，主要是在服务器上。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-07T20:34:20.117

在某些方面 IO 完成端口 (IOCP) 是多余的，但老实说，我发现异步套接字模型比其他方法（选择、非阻塞套接字、重叠 IO 等）更容易使用。

IOCP API 可能更清晰，但一旦你通过它，我认为它实际上更容易使用。过去，最大的障碍是平台支持（它需要基于 NT 的操作系统——即，Windows 9x 不支持 IOCP）。那个限制早就没有了，我会考虑的。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-09T15:30:36.140

如果您决定使用 IOCP（恕我直言，如果您正在为 Windows 编写代码，这是最好的选择），那么我有一些可用的免费代码可以帮您完成很多工作。

[可从此处](http://www.serverframework.com/products---the-free-framework.html)获得最新版本的代码和原始文章的链接。

我对我的框架与 Boost::ASIO 相比的看法可以在这里找到：http: [//www.lenholgate.com/blog/2008/09/how-does-the-socket-server-framework-compare-to- boostasio.html](http://www.lenholgate.com/blog/2008/09/how-does-the-socket-server-framework-compare-to-boostasio.html)。

# c++ - 创建一个 ostream

> ID：524524
> 
> 赞同：7
> 
> 时间：2009-02-07T20:32:31.163
> 
> 标签：c++, std, ostream

出于教育原因，我正在尝试创建一个 c++ ostream。我的测试将创建一个 ostream，它的行为类似于 ofstream，除了写入文件而不是写入双端队列或向量容器之外。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-02-07T21:09:26.330

正如您所说，对于教育而言，我将向您展示我将如何做这样的事情。否则，`stringstream`真的是要走的路。

听起来您想创建一个 streambuf 实现，然后写入向量/双端队列。像这样的东西（从我的另一个[针对 /dev/null 流的](http://groups.google.com/group/comp.lang.c++.moderated/browse_thread/thread/82097fd888b76953)答案复制）：

```
template<typename Ch, typename Traits = std::char_traits<Ch>,
         typename Sequence = std::vector<Ch> >
struct basic_seqbuf : std::basic_streambuf<Ch, Traits> {
     typedef std::basic_streambuf<Ch, Traits> base_type;
     typedef typename base_type::int_type int_type;
     typedef typename base_type::traits_type traits_type;

     virtual int_type overflow(int_type ch) {
         if(traits_type::eq_int_type(ch, traits_type::eof()))
             return traits_type::eof();
         c.push_back(traits_type::to_char_type(ch));
         return ch;
     }

    Sequence const& get_sequence() const {
        return c;
    }
protected:
    Sequence c;
};

// convenient typedefs
typedef basic_seqbuf<char> seqbuf;
typedef basic_seqbuf<wchar_t> wseqbuf; 
```

你可以像这样使用它：

```
seqbuf s;
std::ostream os(&s);
os << "hello, i'm " << 22 << " years old" << std::endl;
std::vector<char> v = s.get_sequence(); 
```

如果你想有一个双端队列作为序列，你可以这样做：

```
typedef basic_seqbuf< char, char_traits<char>, std::deque<char> > dseq_buf; 
```

或类似的东西......好吧，我还没有测试过。但也许这也是一件好事 - 所以如果它仍然包含错误，您可以尝试修复它们。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-07T20:42:25.590

使用 std::stringstream

```
#include <iostream>
#include <sstream>
int main()
{
    std::stringstream   s;
    s << "Plop" << 5;

    std::cout << s.str();
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-07T21:06:37.337

我只想说，您不必为此编写类似 ostream 的类。您可以使用适配器来实现您的目标。

例如，此代码从 istream 读取并将每个元素插入到向量中：

```
vector<string> V;
copy(istream_iterator<string>(cin), 
     istream_iterator<string>(), 
     back_inserter(V)); 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-07T20:47:43.567

如果没有更多关于您想要做什么的详细信息，很难过于具体，但您不想创建新的 ostream。您要做的是创建一个新类型的 streambuf，并使用现有的 ostream。

最简单的做法是从 std::basic_filebuf<> 继承，并重载 sync() 和 overflow() 方法以将元素添加到数据结构中。

# c# - 如何在 C# (.NET) 中使用 POST vars 登录 HTML 表单？

> ID：524525
> 
> 赞同：2
> 
> 时间：2009-02-07T20:32:34.457
> 
> 标签：c#, html, logging, forms, post

比如有这个网站：www.azet.sk

在右侧，有登录名和密码，我希望我的应用程序登录到这个 Web 应用程序，并从我自己的帐户中检索数据到 C# (.NET) 应用程序并使用它。目的是保持“登录”连接处于活动状态并使用 POST 方法发送变量。是否有任何教程或带有示例的简单脚本来学习这个？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-11T23:01:32.100

```
string username = "your";
string password = "password";
HttpWebRequest request = (HttpWebRequest)WebRequest.Create("https://moje.azet.sk/prihlasenie.phtml?KDE=www.azet.sk%2Findex.phtml%3F");
using (StreamWriter writer = new StreamWriter(request.GetRequestStream(), Encoding.ASCII))
{
    writer.Write("nick=" + username + "&password=" + password);
}

HttpWebResponse response = (HttpWebResponse)request.GetResponse();
//Retrieve your cookie that id's your session
//response.Cookies

using (StreamReader reader = new StreamReader(response.GetResponseStream())
{
    Console.WriteLine(reader.ReadToEnd());
} 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-07T20:52:59.843

登录部分应该相对容易。

使用POST 表单数据`System.Net.WebClient`的方法。`UploadValues()`查看 HTML 源代码以找出要 POST 的字段值。

大多数基于表单的身份验证机制使用 HTTP cookie 来保持用户登录。因此，在您发布值之后，检查'Set-Cookie:' 标头`WebClient`的`ResponseHeaders`集合。

为网站的后续 GET/POST 存储 cookie 值。

您可能会发现“从您的帐户中检索数据并使用它”要复杂得多（即屏幕抓取等）。

这是一个包含一些示例的链接：

[http://codebetter.com/blogs/brendan.tompkins/archive/2005/05/18/63329.aspx](http://codebetter.com/blogs/brendan.tompkins/archive/2005/05/18/63329.aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-11T20:06:04.520

查看 WebBrowser 控件。您可以在任何地方导航并以编程方式访问文档及其控件。

# c# - ASP.NET MVC Html.Encode - 新行

> ID：524528
> 
> 赞同：25
> 
> 时间：2009-02-07T20:35:19.363
> 
> 标签：c#, asp.net-mvc, newline, html-encode

`Html.Encode`似乎只是调用`HttpUtility.HtmlEncode`以用它们的转义序列替换一些 html 特定字符。

但是，这并没有考虑如何解释新行和多个空格（标记空白）。所以我为用户提供了一个文本区域来输入纯文本信息块，然后在另一个屏幕上显示该数据（使用`Html.Encode`），新的行和间距将不会被保留。

我认为有 2 个选项，但也许有人可以提出更好的第 3 个选项。

一种选择是只编写一个使用 HtmlEncode 的静态方法，然后将结果字符串中的新行替换`<br>`为多个空格组`&nbsp;`

另一种选择是弄乱`white-space: pre`我的样式表中的属性 - 但是我不确定当 Html 帮助器方法包括新行和制表符以使页面源漂亮时这是否会产生副作用。

是否有第三个选项，例如全局标志、事件或方法覆盖，我可以使用它来更改 html 编码的完成方式，而无需重做 html 辅助方法？

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2009-02-07T20:46:07.173

`HtmlEncode`仅用于对字符进行编码以在 HTML 中显示。它特别不编码空白字符。

我会选择您的第一个选项，并将其作为 HtmlHelper 的扩展方法。就像是：

```
public static string HtmlEncode(this HtmlHelper htmlHelper,
                                string text, 
                                bool preserveWhitespace)
{
    // ...
} 
```

您可以使用`String.Replace()`对换行符和空格进行编码（或者`Regex.Replace`如果您需要更好的匹配）。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2012-01-17T18:39:13.400

使用`style="white-space:pre-wrap;"`为我工作的。根据[这篇文章](http://blog.wolffmyren.com/2009/07/24/dev-tip-preserve-whitespace-in-html-without-using/)。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2012-08-24T22:35:41.827

如果您使用 Razor，您可以执行以下操作：

```
@MvcHtmlString.Create(Html.Encode(strToEncode).Replace(Environment.NewLine, "<br />")) 
```

在您的视图中或在您的控制器中：

```
HttpServerUtility httpUtil = new HttpServerUtility();
MvcHtmlString encoded = httpUtil.HtmlEncode(strToEncode).Replace(Environment.NewLine, "<br />"); 
```

我没有测试控制器方法，但它应该以相同的方式工作。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2011-02-16T17:15:53.943

将您的输出放入`<pre></pre>`和/或`<code></code>`块中。例如：

```
<pre>@someValue</pre> / <code>@someValue</code> 
```

* * *

在现有的上使用等效的 css `div`：

```
<div style="white-space:pre-wrap;">@someValue</div> 
```

* * *

取决于您是想要语义标记还是要摆弄css。我认为这些都比插入`<br/>`标签更整洁。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2014-08-18T15:05:51.580

```
 /// <summary>
    /// Returns html string with new lines as br tags
    /// </summary>
    public static MvcHtmlString ConvertNewLinesToBr<TModel>(this HtmlHelper<TModel> html, string text)
    {
        return  new MvcHtmlString(html.Encode(text).Replace(Environment.NewLine, "<br />"));
    } 
```

# apache - 如何确定 SunOS 上进程的非共享内存大小？

> ID：524533
> 
> 赞同：0
> 
> 时间：2009-02-07T20:37:07.130
> 
> 标签：apache, memory, process, solaris, mod-perl

有没有办法确定 SunOS 上进程的非共享内存大小？如果有帮助，特别是在 mod_perl 下运行的子 httpd 进程的大小。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-08T06:13:46.560

尝试*pmap -x* -有关示例和详细信息，请参阅[Solaris 内部：进程内存映射：pmap -x 。](http://www.solarisinternals.com/wiki/index.php/Processes#Process_Memory_Map:_pmap_-x)

# ruby - 如何配置 tomcat 以使用 jruby 处理 rhtml 页面？

> ID：524535
> 
> 赞同：1
> 
> 时间：2009-02-07T20:39:04.863
> 
> 标签：ruby, tomcat, jruby, erb, rhtml

如何配置 tomcat 以使用 jruby 处理 .rhtml 页面？

我想我应该弄乱 web.xml 文件，但我不知道如何......

（理想情况下，没有 Rails，只是使用 erb 呈现 rhtml 页面所必需的东西......）

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-08T14:24:51.407

可能有更简单的方法，但这里有一些想法：-

1.  将[JRuby-Rack](http://kenai.com/projects/jruby-rack/pages/Home)与一种更轻量级的 Rack 兼容 Ruby Web 框架（如[Sinatra](http://www.sinatrarb.com/) ）结合使用。[Warbler](http://caldersphere.rubyforge.org/warbler/)可能有助于将应用程序打包到一个`.war`文件中，以便简单地部署到 Tomcat。

2.  如果您在 Tomcat 前使用 Apache，则可以[使用 Ruby CGI 脚本](http://dekstop.de/weblog/2006/01/rhtml_on_osx_with_apache_and_erb/)来插入`.rhtml`文件。

3.  如果`.rhtml`文件可以在部署之前进行插值（即它们不依赖于仅在运行时可用的变量），您可以使用像[Webby](http://webby.rubyforge.org/)这样的框架，然后将它们作为静态文件提供。

# jquery - jQuery UI 图像 css

> ID：524536
> 
> 赞同：1
> 
> 时间：2009-02-07T20:39:51.947
> 
> 标签：jquery, image, jquery-ui, themes, jquery-ui-theme

我可以直接获取自创主题中使用的图像，还是必须从`"\jquery-ui-themeroller\theme\images\ui-icons_228ef1_256x240.png"`示例中删除它们？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-07T23:08:03.520

我会说你可能会下载主题的themeroller 1.5 版本并且它会拥有它们。那目前不起作用。

[http://dev.jqueryui.com/ticket/4089](http://dev.jqueryui.com/ticket/4089)

# python - 在 python 中拆分参数——保留引用的子字符串

> ID：524541
> 
> 赞同：1
> 
> 时间：2009-02-07T20:42:21.487
> 
> 标签：python, parsing

完全重复：[在 Python 中用空格分割字符串——保留带引号的子字符串](https://stackoverflow.com/questions/79968/split-a-string-by-spaces-in-python)

* * *

我想接受一个字符串并返回一个列表、字典或以空格分隔的值的元组。但是，我不想匹配引号之间的空格，即

> 苹果橙“香蕉树”绿色

应该作为三个项目回来，“香蕉树”是一个完整的项目。

如果可能的话，它还应该允许引号的转义。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-07T20:52:47.987

这个问题听起来很像解析标签输入，你可以看看 django-tagging [utils.py](http://code.google.com/p/django-tagging/source/browse/trunk/tagging/utils.py) implementation 解决了这种问题

* * *

## 回答 #2

> 赞同：-2
> 
> 时间：2009-02-07T21:02:13.880

```
def splitstring(string):
    """
    >>> string = 'apple orange "banana tree" green'
    >>> splitstring(string)
    ['apple', 'orange', 'green', '"banana tree"']
    """
    import re
    p = re.compile(r'"[\w ]+"')
    quoted_item = p.search(string).group()
    newstring = p.sub('', string)
    return newstring.split() + [quoted_item] 
```

# c++ - 用于检测分号终止的 C++ for & while 循环的正则表达式

> ID：524548
> 
> 赞同：40
> 
> 时间：2009-02-07T20:43:52.343
> 
> 标签：c++, python, regex, parsing, recursion

在我的 Python 应用程序中，我需要编写一个正则表达式来匹配以分号 ( ) 终止的 C++`for`或循环。例如，它应该匹配这个：`while``;`

```
for (int i = 0; i < 10; i++); 
```

...但不是这个：

```
for (int i = 0; i < 10; i++) 
```

乍一看，这看起来微不足道，直到您意识到左括号和右括号之间的文本可能包含其他括号，例如：

```
for (int i = funcA(); i < funcB(); i++); 
```

我正在使用 python.re 模块。现在我的正则表达式看起来像这样（我留下了我的评论，以便您更容易理解）：

```
# match any line that begins with a "for" or "while" statement:
^\s*(for|while)\s*
\(  # match the initial opening parenthesis
    # Now make a named group 'balanced' which matches a balanced substring.
    (?P<balanced>
        # A balanced substring is either something that is not a parenthesis:
        [^()]
        | # …or a parenthesised string:
        \( # A parenthesised string begins with an opening parenthesis
            (?P=balanced)* # …followed by a sequence of balanced substrings
        \) # …and ends with a closing parenthesis
    )*  # Look for a sequence of balanced substrings
\)  # Finally, the outer closing parenthesis.
# must end with a semi-colon to match:
\s*;\s* 
```

这对于上述所有情况都非常有效，但是一旦您尝试使 for 循环的第三部分包含一个函数，它就会中断，如下所示：

```
for (int i = 0; i < 10; doSomethingTo(i)); 
```

我认为它会中断，因为一旦您在左括号和右括号之间放置了一些文本，“平衡”组就会匹配包含文本，因此该`(?P=balanced)`部分不再起作用，因为它不匹配（由于事实括号内的文字不同）。

在我的 Python 代码中，我使用了 VERBOSE 和 MULTILINE 标志，并像这样创建正则表达式：

```
REGEX_STR = r"""# match any line that begins with a "for" or "while" statement:
^\s*(for|while)\s*
\(  # match the initial opening parenthesis
    # Now make a named group 'balanced' which matches
    # a balanced substring.
    (?P<balanced>
        # A balanced substring is either something that is not a parenthesis:
        [^()]
        | # …or a parenthesised string:
        \( # A parenthesised string begins with an opening parenthesis
            (?P=balanced)* # …followed by a sequence of balanced substrings
        \) # …and ends with a closing parenthesis
    )*  # Look for a sequence of balanced substrings
\)  # Finally, the outer closing parenthesis.
# must end with a semi-colon to match:
\s*;\s*"""

REGEX_OBJ = re.compile(REGEX_STR, re.MULTILINE| re.VERBOSE) 
```

任何人都可以建议改进这个正则表达式吗？这对我来说太复杂了，无法理解。

* * *

## 回答 #1

> 赞同：131
> 
> 时间：2009-02-07T21:29:57.693

您可以编写一个非常简单的小程序来执行此操作，而无需使用正则表达式：

*   设置一个位置计数器`pos`，使其指向您的`for`或之后的左括号之前`while`。
*   将左括号计数器设置`openBr`为`0`.
*   现在继续递增`pos`，读取各个位置的字符，并在看到左括号时递增`openBr`，在看到右括号时递减。这将在开始时增加一次，对于“ `for (`”中的第一个左括号，对于中间的一些括号增加和减少一些，并将其设置回括号关闭`0`时。`for`
*   所以，什么时候再停下`openBr`来`0`。

停止位置是您的右括号`for(...)`。现在您可以检查是否有分号。

* * *

## 回答 #2

> 赞同：22
> 
> 时间：2009-02-07T20:50:09.990

这是你真的不应该用正则表达式做的事情。一次只解析一个字符，跟踪开/关括号。

如果这就是您要寻找的全部内容，那么您绝对不需要成熟的 C++ 语法词法分析器/解析器。如果你想练习，你可以写一个递归体面的解析器，但即使是匹配括号也有点多。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2009-02-07T20:51:09.520

这是在工作中使用错误工具的一个很好的例子。正则表达式不能很好地处理任意嵌套的子匹配。你应该做的是使用真正的词法分析器和解析器（C++ 的语法应该很容易找到）并寻找意外的空循环体。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-08T01:53:09.050

试试这个正则表达式

```
^\s*(for|while)\s*
\(
(?P<balanced>
[^()]*
|
(?P=balanced)
\)
\s*;\s 
```

我移除了环绕`\( \)`并将`(?P=balanced)`to 移到`*`any not paren 序列后面。我使用 boost xpressive 完成了这项工作，并重新检查了该网站 ( [Xpressive](http://www.boost.org/doc/libs/1_37_0/doc/html/xpressive/user_s_guide.html#boost_xpressive.user_s_guide.grammars_and_nested_matches) ) 以刷新我的记忆。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-07T20:54:36.313

我什至不会注意括号的内容。

`for`只需匹配以分号开头和结尾的任何行：

```
^\t*for.+;$ 
```

除非您将`for`语句拆分为多行，否则可以正常工作吗？

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-02-07T21:08:02.543

我不知道正则表达式会很好地处理类似的事情。尝试这样的事情

```
line = line.Trim();
if(line.StartsWith("for") && line.EndsWith(";")){
    //your code here
} 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2019-07-22T11:50:53.610

聚会有点晚了，但我认为**正则表达式不是这项工作的正确工具**。

问题是您会遇到边缘情况，这会给正则表达式增加额外的复杂性。[@est](https://stackoverflow.com/users/41948/est)提到[了一个示例行](https://stackoverflow.com/questions/524548/regular-expression-to-detect-semi-colon-terminated-c-for-while-loops#comment6619753_524624)：

```
for (int i = 0; i < 10; doSomethingTo("(")); 
```

此字符串文字包含一个（不平衡！）括号，这破坏了逻辑。显然，您必须忽略字符串文字的内容。为此，您必须考虑双引号。但是字符串文字本身可以包含双引号。例如，试试这个：

```
for (int i = 0; i < 10; doSomethingTo("\"(\\")); 
```

如果你使用正则表达式来解决这个问题，它会给你的模式增加更多的复杂性。

我认为你最好解析语言。例如，您可以使用像 ANTLR 这样的语言识别工具。ANTLR 是一个解析器生成器工具，它也可以[在 Python 中生成解析器](http://blog.anvard.org/articles/2016/03/15/antlr-python.html)。您必须提供定义目标语言的语法，在您的情况下为 C++。那里已经有许多语言的语法，所以你可以抓住[C++ 语法](https://github.com/antlr/grammars-v4/tree/master/cpp)。

然后，您可以轻松地遍历解析器树，搜索空语句作为`while`或`for`循环体。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-02-07T20:57:32.707

格雷格是绝对正确的。这种解析不能用正则表达式来完成。我想有可能构建一些适用于许多情况的可怕的怪物，但是你只会遇到一些有用的东西。

您确实需要使用更传统的解析技术。例如，编写一个像样的递归解析器来做你需要的事情非常简单。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-02-07T21:59:38.773

另一个忽略括号并将 the`for`视为包含三个分号分隔值的构造的想法：

```
for\s*\([^;]+;[^;]+;[^;]+\)\s*; 
```

此选项即使在拆分为多行时也有效（一旦启用 MULTILINE），但假定这`for ( ... ; ... ; ... )`是唯一有效的构造，因此不适用于`for ( x in y )`构造或其他偏差。

还假设没有包含分号作为参数的函数，例如：

```
for ( var i = 0; i < ListLen('a;b;c',';') ; i++ ); 
```

这是否是一种可能的情况取决于您实际执行此操作的目的。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2017-05-24T13:33:47.143

正如弗兰克建议的那样，最好不要使用正则表达式。这是（丑陋的）单线：

```
match_string = orig_string[orig_string.index("("):len(orig_string)-orig_string[::-1].index(")")] 
```

匹配他评论中提到的巨魔线 est：

```
orig_string = "for (int i = 0; i < 10; doSomethingTo(\"(\"));"
match_string = orig_string[orig_string.index("("):len(orig_string)-orig_string[::-1].index(")")] 
```

返回`(int i = 0; i < 10; doSomethingTo("("))`

这是通过向前运行字符串直到它到达第一个打开的括号，然后向后运行直到它到达第一个关闭的括号。然后它使用这两个索引对字符串进行切片。

# .net - 将 System.Data.DataSet 导入 Excel 的最简单方法是什么？

> ID：524559
> 
> 赞同：2
> 
> 时间：2009-02-07T20:47:53.550
> 
> 标签：.net, excel, serialization, dataset

在 .NET 2.0（在本例中为 VB）中，是否有标准 API 可以将 DataSet 对象序列化为可以保存为制表符分隔文件并直接在 Excel 中打开的流？还是必须通过遍历表集合的成员来手动创建分隔文件？

在这种情况下，DataSet 很小，由大约 10 个 DataTables 组成，每个 DataTables 有一到几十行。我只是想知道是否有处理这种情况的内置机制，因为我想这是一个相对常见的机制。

理想情况下，我也希望能够通过单击返回所有内容——例如，客户端单击“生成报告”按钮，我组装报告，并返回包含格式化数据的 Response 对象，提示保存或打开等（我宁愿不让他们下载文件然后导入它，因为这在可用性方面似乎是不必要的麻烦。）

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-28T22:51:55.980

Excel 有一个 ADO.NET 提供程序。这意味着，如果你有一个数据集，你可以使用两个 DataAdapter 将数据从一个地方移动到另一个地方：从 Oracle 到 Excel，从 SQL 到 Excel，从 Excel 到 Oracle，等等。

使用第一个 DA 从源填充 DataSet，然后使用第二个 DA 更新目标。DataAdapter 不需要是相同的类型 - 您可以使用任何 OleDbDataAdapter、SqlDataAdapter、OracleDataAdapter 等进行读取和更新。

无需摆弄 CSV 或 XML 格式。无需使用办公自动化，因此无需 PIA，它可以在服务器上运行。它只是 ADO.NET。

要连接到 Excel，请使用**Microsoft.Jet.OLEDB** oledb 提供程序。

[完整示例源](http://cheeso.members.winisp.net/srcview.aspx?dir=MSOffice&file=ExtractToExcel2.cs)。

摘抄：

```
System.Data.DataSet ds1;

const string ConnStringSql= "Provider=sqloledb;Data Source=dinoch-8;Initial Catalog=Northwind;Integrated Security=SSPI;" ;
const string OutputFilename= "ExtractToExcel.xls";

const string ConnStringExcel= 
"Provider=Microsoft.Jet.OLEDB.4.0;" + 
"Data Source=" + OutputFilename + ";" + 
"Extended Properties=\"Excel 8.0;HDR=yes;\"";  // FIRSTROWHASNAMES=1;READONLY=false\"

const string sqlSelect="SELECT top 10 ProductId, ProductName, QuantityPerUnit, UnitPrice, UnitsInStock, GETDATE() as Extracted  from Products order by UnitPrice";
const string sqlInsert="INSERT INTO Extracto (ProductId, ProductName, QuantityPerUnit, UnitPrice, UnitsInStock, Extracted) VALUES (@ProductId, @ProductName, @QuantityPerUnit, @UnitPrice, @UnitsInStock, @Extracted)"; 

private void ReadFromSql()
{
    var ConnSql= new System.Data.OleDb.OleDbConnection(ConnStringSql);

    var da1 = new System.Data.OleDb.OleDbDataAdapter();
    da1.SelectCommand=  new System.Data.OleDb.OleDbCommand(sqlSelect);
    da1.SelectCommand.Connection= ConnSql;

    ds1= new System.Data.DataSet();
    da1.Fill(ds1, "Extracto");
}

private void InsertIntoExcel()
{
    // need to update the row so the DA does the insert...
    foreach (System.Data.DataRow r in ds1.Tables[0].Rows)
    { 
      r.SetModified(); // mark the row as updated to force an insert
    }

    var da2 = new System.Data.OleDb.OleDbDataAdapter();

    da2.UpdateCommand= new System.Data.OleDb.OleDbCommand(sqlInsert);
    da2.UpdateCommand.Connection= ConnExcel;

    da2.UpdateCommand.Parameters.Add("@ProductId", System.Data.OleDb.OleDbType.Integer, 4, "ProductId");
    da2.UpdateCommand.Parameters.Add("@ProductName", System.Data.OleDb.OleDbType.VarWChar, 40, "ProductName");
    da2.UpdateCommand.Parameters.Add("@QuantityPerUnit", System.Data.OleDb.OleDbType.VarWChar, 20, "QuantityPerUnit");
    da2.UpdateCommand.Parameters.Add("@UnitPrice", System.Data.OleDb.OleDbType.Currency, 8, "UnitPrice");
    da2.UpdateCommand.Parameters.Add("@UnitsInStock", System.Data.OleDb.OleDbType.SmallInt, 2, "UnitsInStock");
    da2.UpdateCommand.Parameters.Add("@Extracted", System.Data.OleDb.OleDbType.Date, 8, "Extracted");

    da2.Update(ds1, "Extracto");
} 
```

这不是 Excel 自动化，因此适用于在服务器上使用 Excel 自动化的注意事项不适用。

您可以从现有的 XLS 文件（或 XLSX）开始，然后填写一个命名范围。这使您有机会在插入 ilve 数据之前应用格式等。本质上，现有的 XLS 文件是一个模板。
或者，您可以从零开始，在运行时完全动态地创建 XLS 文件和 XLS 文件中的表/范围。在这种情况下，XLS 文件将非常普通/普通。没有格式、颜色、公式等。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-07T20:49:35.420

[DataSet.writeXML(Stream)](http://msdn.microsoft.com/en-us/library/system.data.dataset.writexml.aspx)然后就可以将 XML 文件导入 Excel

您还可以查看[此实用程序](http://www.codeproject.com/KB/office/datasettoexcel.aspx)来为您执行此操作。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-27T21:52:11.353

您还可以使用简单的 HTML 表格标记（或网格视图）在 .aspx 页面上的 HTML 中创建表格，然后在您的代码隐藏中将这一行包含在 page.load 中：

```
Response.ContentType = "application/vnd.ms-excel" 
```

请享用 ：）

* * *

## 回答 #4

> 赞同：-2
> 
> 时间：2009-02-07T21:04:56.090

将数据集序列化为 xml `DataSet.WriteXML`，您可以创建一个将其转换为[CSV的](http://en.wikipedia.org/wiki/Comma-separated_values)[Xsl](http://www.w3.org/Style/XSL/)（您可以使用[XslTransform](http://msdn.microsoft.com/en-us/library/system.xml.xsl.xsltransform.aspx)将 xml 与 xsl 转换）

编辑：其他选择是将其直接转换为 CSV

```
Sub DataTable2CSV(ByVal table As DataTable, ByVal filename As String)
    DataTable2CSV(table, filename, vbTab)
End Sub
Sub DataTable2CSV(ByVal table As DataTable, ByVal filename As String, _
    ByVal sepChar As String)
    Dim writer As System.IO.StreamWriter
    Try
        writer = New System.IO.StreamWriter(filename)

        ' first write a line with the columns name
        Dim sep As String = ""
        Dim builder As New System.Text.StringBuilder
        For Each col As DataColumn In table.Columns
            builder.Append(sep).Append(col.ColumnName)
            sep = sepChar
        Next
        writer.WriteLine(builder.ToString())

        ' then write all the rows
        For Each row As DataRow In table.Rows
            sep = ""
            builder = New System.Text.StringBuilder

            For Each col As DataColumn In table.Columns
                builder.Append(sep).Append(row(col.ColumnName))
                sep = sepChar
            Next
            writer.WriteLine(builder.ToString())
        Next
    Finally
        If Not writer Is Nothing Then writer.Close()
    End Try
End Sub 
```

除非你真的想要纯 Excel 格式

# linq - linq 和对象初始化

> ID：524567
> 
> 赞同：0
> 
> 时间：2009-02-07T20:53:12.807
> 
> 标签：linq

如果我有类似的东西：

```
var query = from children in _data.Children
    where children.ChildId == childId
    select new CustomModel.MyChild
    {
        ChildId = children.ChildId,
        Name = children.ChildName
    };

return query.FirstOrDefault(); 
```

我希望结果对象成为我的自定义模型。

我能否以不同的方法处理自定义模型实例化，如果我有多个 linq 查询都生成了自定义子模型，则可以重用该方法？

例如，

```
var query = from children in _data.Children
    where children.ChildId == childId
    select CreateMyCustomChild([param ??]);

return query.FirstOrDefault(); 
```

这很可能是不可能的，我不知道，但是如果可能的话，方法签名会是什么样子？

当多个 linq 查询包含重复的对象初始化代码时，我只考虑重用。

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-07T20:58:42.657

这实际上取决于您使用的 LINQ 版本。如果您使用的是 LINQ to SQL，我不相信您可以在查询中调用任意方法。查询翻译器不知道如何处理方法调用

如果您使用的是 LINQ to Objects，那么您绝对可以这样做，如下所示：

```
var query = from children in _data.Children
    where children.ChildId == childId
    select CreateMyCustomChild(children)

return query.FirstOrDefault();

// Elsewhere

public CustomModel.MyChild CreateMyCustomChild(OtherChild child)
{
    return new CustomModel.MyChild
    {
        ChildId = child.ChildId,
        Name = child.ChildName
    };
} 
```

（旁注：我将查询中的范围变量称为“孩子”而不是“孩子”，因为在任何时候它只代表一个孩子。）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-07T20:58:37.307

如果你愿意，你可以写“select 1”或在你的情况下写“CreateMyCustomChild(children)”，因为“children”包含你的所有信息。在您的情况下，您没有向“孩子”添加很多信息，那么为什么不“选择孩子”呢？

换句话说，只是尝试一下。您的值的返回类型将决定您的 LINQ 枚举的类型。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-07T23:20:45.317

假设您有一个为您进行转换的方法。

```
public static class Conversions
{
  public static CustomModel.MyChild ToCustomModel(this DataModel.MyChild source)
  {
    return new CustomModel.MyChild()
    {
      ChildId = source.ChildId,
      Name = source.ChildName
    }
  }
} 
```

您可以使用这种方法来进行单个项目的转换。

```
DataModel.MyChild myResult = getResult();
CustomModel.MyChild myConvertedResult = myResult.ToCustomModel() 
```

这样的方法也可以在`Enumerable.Select`方法调用中使用。

```
IEnumerable<DataModel.MyChild> myQueriedResults = getResult();
IEnumerable<CustomModel.MyChild> myConvertedResults =
  myQueryiedResults.Select(c => c.ToCustomModel()); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-21T11:53:30.520

虽然您可以使用表达式，但我认为这不值得麻烦。相反，我建议您定义一个扩展方法，例如：

```
IQueryable<CustomModel.MyChild> ToModel(this IQueryable<Child> childs)
{
    return childs.Select( c=>
       select new CustomModel.MyChild
       {
           ChildId = children.ChildId,
           Name = children.ChildName
       }    
    );
} 
```

然后您可以致电：

```
return _data.Children
     .Where(c=>c.ChildId == childId)
     .ToModel()
     .FirstOrDefault(); 
```

# javascript - 从一种形式写到另一种形式

> ID：524582
> 
> 赞同：0
> 
> 时间：2009-02-07T21:04:44.563
> 
> 标签：javascript, text, webforms, input

我有两种形式。

表格 A 有三个文本输入；A1、A2、A3。表格 B 有一个文本输入，B1。

每当您在表格 A 上输入任何输入时，表格 B 应立即更新为来自表格 A 的所有三个输入。如果表格 A 输入之一为空，则应在 B1 中将其替换为 0。

例如，如果我在 A1 中键​​入“test”并将 A2 和 A3 留空，则 B1 应该反映：test+0+0。如果我在 A1 中输入“test”，在 A2 中输入“help”，并将 A3 留空，那么 B1 应该反映：test+help+0

有人可以帮忙吗？我在 Javascript 方面的经验非常有限，所以我什至不确定如何搜索此功能的这些方面。有人可以指出我正确的方向吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-07T21:20:38.463

在A表单的每个输入的onChange事件中添加一个方法如：onChange=populateBField();

```
Function populateBField(){
 document.formB.B1.value = getFieldContents("A1") + "+" + getFieldContents("A2") 
 + "+" + getFieldContents("A3");
}

function getFieldContents(fieldName){
   var fieldValue = document.formA.fieldName.value;
   // if no value is entered, set to 0
   if (fieldValue.length < 1){
       fieldValue = 0;
   }
   return fieldValue;
} 
```

请指出任何错误/改进，因为我自己是一个相对的 JS 新手 :)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-07T21:18:59.260

开始，使用[prototype.js](http://prototypejs.org)

```
function build_b() {
    var str = "";
    str += "A1=" + ($F('A1') == ''? '0' : $F('A1'));
    str += "A2=" + ($F('A2') == ''? '0' : $F('A2'));
    str += "A2=" + ($F('A3') == ''? '0' : $F('A3'));
    $('B').value = str;
} 
```

这假定元素 ID 是 A1、A2、A3 和 B。将此函数绑定到 A1、A2 和 A3 的“onchange”事件。

# cocoa-touch - iPhone可以检测到触摸的大小吗？

> ID：524584
> 
> 赞同：10
> 
> 时间：2009-02-07T21:05:44.497
> 
> 标签：cocoa-touch

据我所知，iPhone 多点触控框架会发送每次触摸的位置，但不会发送大小。

我想让用户用他们的拇指尖点击一个按钮，或者将他们的拇指垫放在多个按钮（不是真正的 UIButtons）上，并让我的触摸跟踪代码意识到它需要按下拇指的所有按钮超过。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2010-12-20T04:48:46.657

所有这些答案都是错误的。苹果似乎没有在商店的应用程序中批准这一点的事实是另一回事。

```
 float vf = 10.0; 
 id valFloat = [thisTouch valueForKey:"pathMajorRadius"]; 
 if(valFloat != nil) {
   vf = [valFloat floatValue]; 
 } 
```

我真的希望这个问题会被用户和开发人员更加努力地推动。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-07T21:57:07.780

由于[UITouch](http://developer.apple.com/iphone/library/documentation/UIKit/Reference/UITouch_Class/Reference/Reference.html)处理触摸并且没有说明大小，我会说不，你不能。您最好尝试另一种方法，例如拖动..

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-08T20:23:59.143

我相当确定硬件可以非常准确地读取触摸区域，但 iPhone 固件不会将此信息带给开发人员。正如 CiNN 所说，UITouch 只是不提供此信息。

但是，硬件与旧的 Fingerworks.com 产品中的硬件相同，它们确实为开发人员提供了实际的触摸数据。因此，也许在（很多）以后的操作系统版本中，将提供触摸表面配置文件。它可能有用！

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-08T08:49:45.683

不，使用 UIKit 是不可能的。

# c++ - 从输入迭代器创建 C++ std::string 的性能

> ID：524591
> 
> 赞同：13
> 
> 时间：2009-02-07T21:09:40.247
> 
> 标签：c++, string, stream

我正在做一些非常简单的事情：将整个文本文件从磁盘读取到`std::string`. 我当前的代码基本上是这样做的：

```
std::ifstream f(filename);
return std::string(std::istreambuf_iterator<char>(f), std::istreambuf_iterator<char>()); 
```

这不太可能对程序的性能产生任何影响，但我仍然很好奇这是否是一种缓慢的方式。

字符串的构造是否存在涉及大量重新分配的风险？在读取之前使用`seekg()`/`tellg()`来计算文件的大小和字符串中的那么多空间会更好（即更快）吗？`reserve()`

* * *

## 回答 #1

> 赞同：37
> 
> 时间：2009-02-08T00:22:04.663

我对你的实现（1）、我的（2）和我在 stackoverflow 上找到的另外两个（3 和 4）进行了基准测试。

结果（平均 100 次运行；使用 gettimeofday 计时，文件为 40 段 lorem ipsum）：

*   读取文件 1：764
*   读取文件2：104
*   读取文件 3：129
*   读取文件4：402

实现：

```
string readFile1(const string &fileName)
{
    ifstream f(fileName.c_str());
    return string(std::istreambuf_iterator<char>(f),
            std::istreambuf_iterator<char>());
}

string readFile2(const string &fileName)
{
    ifstream ifs(fileName.c_str(), ios::in | ios::binary | ios::ate);

    ifstream::pos_type fileSize = ifs.tellg();
    ifs.seekg(0, ios::beg);

    vector<char> bytes(fileSize);
    ifs.read(&bytes[0], fileSize);

    return string(&bytes[0], fileSize);
}

string readFile3(const string &fileName)
{
    string data;
    ifstream in(fileName.c_str());
    getline(in, data, string::traits_type::to_char_type(
                      string::traits_type::eof()));
    return data;
}

string readFile4(const std::string& filename)
{
    ifstream file(filename.c_str(), ios::in | ios::binary | ios::ate);

    string data;
    data.reserve(file.tellg());
    file.seekg(0, ios::beg);
    data.append(istreambuf_iterator<char>(file.rdbuf()),
                istreambuf_iterator<char>());
    return data;
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-07T21:15:56.240

如果您尝试这样做，性能会怎样？而不是问“哪种方式更快？” 你可以想“嘿，我可以测量这个。”

设置一个循环，读取给定大小的文件 10000 次或其他内容，并对其计时。然后用`reserve()`方法和时间来做。尝试几种不同的文件大小（从小到大），看看你会得到什么。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-07T21:29:53.310

老实说，我不确定，但从我读过的内容来看，这真的取决于迭代器。在来自文件流的迭代器的情况下，它可能没有内置方法来测量开始和结束迭代器之间的文件长度。

如果这是正确的，它将以类似于每次空间不足时将其内部存储大小加倍的方式运行。在这种情况下，对于文件中的 n 个字符，除了将字符复制到字符串中之外，还会有 Log[n,2] 内存分配和内存删除，以及 n*Log[n,2] 个单独的字符副本。

正如格雷格指出的那样，您不妨对其进行测试。正如他所说，尝试两种技术的各种文件大小。此外，您可以使用以下内容来获得一些定量时间。

```
#include<time.h>
#include<iostream>

...

clock_t time1=0, time2=0, delta;
float seconds;

time1=clock();

//Put code to be timed here

time2=clock();

delta= time2-time1;

seconds =(((float)delta)/((float)CLOCKS_PER_SEC));

std::cout<<"The operation took: "<<seconds<<" seconds."<<std::endl;

... 
```

这应该可以解决时间问题。

# visual-studio - 无法加载引用的库

> ID：524602
> 
> 赞同：3
> 
> 时间：2009-02-07T21:13:19.460
> 
> 标签：visual-studio, dotnetnuke

在开发 ASP.NET Web 应用程序项目时，我在 Visual Studio 2008 中收到此错误。

> 无法加载引用的库“Path-to-DotNetNuke\bin\file.dll”：该进程无法访问该文件，因为它正被另一个进程使用。

这是一个包含多个模块的 DotNetNuke 项目。IIS 从应用程序根目录下的 /bin 文件夹加载所有程序集。

解决方案中的项目位于各自的 /DesktopModules/ProjectName 文件夹中，并编译到项目下的 bin 文件夹中。

在我编译解决方案并使用脚本**将所有项目的 dll 复制到 /bin后发生错误。**Visual Studio 不允许我重新编译，但如果我重新启动它，一切正常。在重新编译和测试整个解决方案时，这真的很烦人。您必须在每次重新编译之间重新启动 Visual Studio。

当 Visual Studio 显示此错误时，我无法使用 Process Explorer 找到任何文件锁定。

* * *

[更新] 有一个[旧的 MSDN 文档](http://msdn.microsoft.com/en-us/library/ms998223.aspx)告诉您，如果您在那里引用任何超过 64KB 的 DLL，则不要将所有 DLL 构建到单个文件夹中。特别是，该文件说：

> 当引用的程序集大小超过 64 KB 时，它会导致构建过程失败并出现文件锁定错误。

我们确实在 /bin 文件夹中引用了超过 64KB 的 DLL，并且在那里复制重新编译的 DLL 似乎会触发这种情况，至少使用 VB IDE 的后台编译器。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-08T00:20:44.823

> 在我编译解决方案并使用脚本将所有项目的 dll 复制到 /bin 后发生错误。Visual Studio 不允许我重新编译，但如果我重新启动它，一切正常。

我建议将每个项目的输出目录设置为 DotNetNuke 网站的 bin 目录。这将帮助您避免完全复制文件的手动步骤。

设置项目的输出目录： 在解决方案资源管理器中右键单击项目并选择属性。选择构建选项卡，选择所有配置（在顶部）并将输出路径设置为“ `..\..\bin`”（靠近底部）。这假设您的项目文件位于模块主目录中的典型位置（例如 DesktopModules/YourModule/YourProject.csproj），否则您可以使用相邻的浏览按钮导航到网站的 bin 目录。

# asp.net - IRepository 对返回对象的混淆

> ID：524603
> 
> 赞同：1
> 
> 时间：2009-02-07T21:13:28.913
> 
> 标签：asp.net, repository-pattern, irepository

我有一些我经常使用的电子商务代码，它使用 Linq To SQL 将订单保存到数据库。我想删除紧密耦合的 Linq to SQL 位并传入一个 IRepository 但我对事情仍然有些困惑。

假设我的 ICustomerRepository 上有一个 GetCustomer() 方法，该方法返回一个 Customer 对象。

我是否需要它来真正返回一个从该方法传回的 ICustomer 对象，所以如果我从 Linq To SQL 切换到说 SubSonic 这不是问题？

我相信我会这样做，如果是这样的话，Linq To SQL 中是否有一种方法可以轻松地将我的 Linq To SQL Customer 对象转换为我的 ICustomer 对象，例如 SubSonics ExecuteSingle(Of ) 方法？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-07T23:29:34.427

如果您希望您的 Customer 类是一个没有附加到 LINQ 的普通对象，那么您很可能需要编写一个映射器方法来将基于 LINQ 的 Customer 对象转换为您的普通 Customer 域对象。LINQ to SQL 没有内置这样的功能。

我已经开始将我的映射方法包装在一个扩展方法中以提高可读性，这确实有助于保持存储库代码的简单。例如，一个示例 CustomerRepository 方法我看起来像：

```
public Customer GetById(int id)
{
   return dataContext.LINQCustomers.Where(c => c.Id == id)
                                   .Single()
                                   .ToDomainObject();
} 
```

并且 ToDomainObject() 方法在扩展方法中定义，例如：

```
public static class ObjectMapper
{
    public static Customer ToDomainObject(this Customer linqObject)
    {
        var domainObject = null
        if (linqObject != null)
        {
            domainObject = new Customer
            {
               Id = linqObject.Id,
               FirstName = linqObject.FirstName,
               LastName = linqObject.LastName
            }
        }
        return domainObject;
    }
} 
```

或类似的东西。您可以执行相同的操作将域对象转换回 LINQ 对象，以传递回存储库以实现持久性。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-07T21:17:27.360

只要 Customer 是一个普通的旧 .NET 对象，而不是某个 db 生成的实体，您就可以让它返回一个 Customer。您的 Customer 域对象不应该知道如何（或是否）将其持久化到数据库中，而这应该从您的存储库中返回。在您的存储库中，您可能有一些映射代码 - 这很常见 - 从 [但是您从其存储位置获取数据] 映射到您的域对象。如果您使用的是 Linq-to-sql，那么此映射将来自 Linq-To-Sql 生成的 Customer 表（可能还有其他表 - 您的 Customer 域对象可能不会 1:1 映射到数据库中的特定表) 到您的客户域对象，该对象将存在于不同的命名空间（并且很可能是程序集）中。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-07T21:25:31.697

根本没有必要将其设为 ICustomer。存储库的作用是使它看起来好像您的持久实例在内存中。

```
public interface ICustomerRepository
{
  Customer GetByID(int id);
  IEnumerable<Customer> GetByName(string name);
  Customer GetByVatCode(string vatCode);
} 
```

有些人会另外包括方法，例如

```
void Add(Customer newCustomer);
void Delete(Customer deleted);
void Update(Customer modified); 
```

后一种方法实现很可能只是更新一个工作单元。

虽然概念是这些只是请求客户实例的常见方式，存储库充当请求它们的一种方式，而不定义**如何**请求它们。

# ocaml - Ocaml noobie Q——如何使用累加参数？

> ID：524616
> 
> 赞同：5
> 
> 时间：2009-02-07T21:22:12.373
> 
> 标签：ocaml

我正在尝试通过解决Project Euler的[问题 18来学习 Ocaml。](https://projecteuler.net/problem=18)我知道我想做什么，只是不知道该*怎么*做。

我有三个列表：

```
let list1 = [1;2;3;4;5];;
let list2 = [ 6;7;8;9];;
let line = [9999];; 
```

我想将数字 list2 添加到 list1 中的最大相邻数字，IOW 我将添加 6+2、7+3、8+4 和 9+5 以获得列表 [8;10;12;14]。列表 line[] 是一个虚拟变量。

这是我的第三次尝试：

```
let rec meld3 l1 l2 accum =
   if List.length l2 = 1 then
     List.append accum [ (hd l2 + max (hd l1) (hd (tl l1)))]
else
    (
     List.append accum [ (hd l2 + max (hd l1) (hd (tl l1)))];
     meld3 (tl l1) (tl l2) accum ;
    )
;;

let fu = meld3 list1 list2 line ;;

List.iter print_int fu;; 
```

运行此程序后，我希望 line = [9999;8;10;12;14] 而不是 line = [9999]。OTOH，fu 打印为 [999914]。

当我单步执行代码时，代码按预期执行，但没有任何变化；else 块中的累加器永远不会被修改。

我就是不懂这种语言。任何人都可以建议吗？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-08T00:13:57.567

好的，让我们分解你的代码。这是你的原件。

```
let rec meld3 l1 l2 accum =
   if List.length l2 = 1 then
     List.append accum [ (hd l2 + max (hd l1) (hd (tl l1)))]
else
    (
     List.append accum [ (hd l2 + max (hd l1) (hd (tl l1)))];
     meld3 (tl l1) (tl l2) accum ;
    ) 
```

我要做的第一件事是重写它，以便 Caml 程序员能够理解它，*而无需*更改任何计算。这主要意味着使用模式匹配而不是`hd`and `tl`。这种转变*不是*微不足道的。简化列表操作以更容易识别代码问题非常重要。这也使得这个函数在`l2`为空时失败更明显。

```
let rec meld3 l1 l2 accum = match l1, l2 with
| x1::x2::xs, [y] ->   (* here the length of l2 is exactly 1 *)
     List.append accum [ y + max x1 x2 ]
| x1::x2::xs, y::ys ->   (* here the length of l2 is at least 1 *)    
    ( List.append accum [ y + max x1 x2 ]
    ; meld3 (x2::xs) ys accum
    ) 
```

现在我认为你的困难的关键是对分号运算符的理解。如果我写 ( *e1* ; *e2* )，语义是*e1*被评估*为副作用*(think `printf`)，然后*e1 的结果被丢弃*。我认为你想要的是让*e1*`accum`的结果成为递归调用的新值。因此，我们没有丢弃*e1*，而是将其设为参数（这是计算实际发生变化**的关键步骤）：**

```
let rec meld3 l1 l2 accum = match l1, l2 with
| x1::x2::xs, [y] ->   (* here the length of l2 is exactly 1 *)
     List.append accum [ y + max x1 x2 ]
| x1::x2::xs, y::ys ->   (* here the length of l2 is at least 1 *)    
    ( 
      meld3 (x2::xs) ys (List.append accum [ y + max x1 x2 ])
    ) 
```

下一步是观察我们违反了不要重复自己的原则，我们可以通过将基本情况设为`l2`空来解决这个问题：

```
let rec meld3 l1 l2 accum = match l1, l2 with
| x1::x2::xs, [] ->   (* here the length of l2 is 0 *)
     accum 
| x1::x2::xs, y::ys ->   (* here the length of l2 is at least 1 *)    
    ( 
      meld3 (x2::xs) ys (List.append accum [ y + max x1 x2 ])
    ) 
```

然后我们清理一下：

```
let rec meld3 l1 l2 accum = match l1, l2 with
| _, [] -> accum 
| x1::x2::xs, y::ys -> meld3 (x2::xs) ys (List.append accum [ y + max x1 x2 ]) 
```

最后，重复调用`append`使代码成为二次方。这是一个累积参数的经典问题，并且有一个经典的解决方案：以相反的顺序累积答案列表：

```
let rec meld3 l1 l2 accum' = match l1, l2 with
| _, [] -> List.rev accum' 
| x1::x2::xs, y::ys -> meld3 (x2::xs) ys (y + max x1 x2 :: accum') 
```

我已将名称更改`accum`为`accum'`; 对于以相反顺序排列的列表，素数是常规的。最后一个版本是我编译的唯一版本，我还没有测试任何代码。（我确实在我的另一个答案中测试了代码）。

我希望这个答案更有帮助。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-07T22:51:40.417

Well, I think you haven't grasped the essence of functional programming: instead of calling `List.append` and throwing the value away, you need to pass that value as the parameter `accum` to the recursive call.

I would tackle this problem by decoupling the triangle geometry from the arithmetic. The first function takes two lists (rows of the triangle) and produces a new list of triples, each containing and element plus that element's left and right child. Then a simple map produces a list containing the sum of each element with its greater child:

```
(* function to merge a list l of length N with a list l' of length N+1,
   such that each element of the merged lists consists of a triple
     (l[i], l'[i], l'[i+1])
 *)

let rec merge_rows l l' = match l, l' with
  | [], [last] -> []   (* correct end of list *)
  | x::xs, y1::y2::ys -> (x, y1, y2) :: merge_rows xs (y2::ys)
  | _ -> raise (Failure "bad length in merge_rows")

let sum_max (cur, left, right) = cur + max left right

let merge_and_sum l l' = List.map sum_max (merge_rows l l')

let list1 = [1;2;3;4;5]
let list2 = [ 6;7;8;9]

let answer = merge_and_sum list2 list1 
```

If you are working on Euler 18, I advise you to look up "dynamic programming".

# java - 如何在 GWT 中更改 DecoratorPanel 的颜色？

> ID：524617
> 
> 赞同：1
> 
> 时间：2009-02-07T21:22:24.167
> 
> 标签：java, css, gwt

我看到它使用 png 图像进行渲染，所以我假设这意味着我需要提供我自己版本的这些图像，并适当更改颜色。我将这些图像放在哪里，以及如何在 CSS 中应用它们？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-08T21:56:38.670

好的，这就是解决方案。

*   转到[GWT 主题生成器](http://works.sen-sei.in/gtg/)
*   选择你想要的颜色
*   为您的风格选择一个名称
*   点击**生成**
*   获取它生成的 jar 文件，并将其添加到您的类路径中
*   在 app.gwt.xml 文件中添加对新样式的引用

如果您对使用主题生成器不满意，或者担心它有一天会消失，只需执行一次，然后破解它生成的 jar 文件的内容。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-08T03:51:53.897

您可以使用以下代码为装饰面板应用您自己的 CSS 样式。

```
 DecoratorPanel panel=new DecoratorPanel();
 panel.setStyleName("decorator-panel"); 
```

在您的 css 文件中，您可以将样式应用于装饰器面板。使用它我们可以更改颜色。对于图像，您在公共目录（包含您的 css 文件的目录）下创建一个图像目录并将您的图像放在那里。然后在 css 中您可以得到图像。

# java - 交叉编译 JRE/JDK

> ID：524622
> 
> 赞同：2
> 
> 时间：2009-02-07T21:28:36.433
> 
> 标签：java, unix, cross-platform, debian

有人将 sun-java5 源代码包（debian）从 i386/i586 交叉编译到 hppa 架构吗？

或者知道 PA-RISC 的 java 源？我只找到了适用于 HP-UX 的包。

Kaffe/gcj 无法运行我的第三方 java 应用程序

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-19T02:48:14.993

不知道你的胃有多强（我提前道歉，在这种情况下这*可能*不是开箱即用的，你花了几个月的时间在它上面:-)

[http://openjdk.java.net/projects/zero/](http://openjdk.java.net/projects/zero/)

“Zero 是 OpenJDK 的一个端口，它不使用汇编程序，因此可以在任何系统上轻松构建。该项目的目标是能够在任何平台上构建一个符合 TCK 且性能合理的 OpenJDK，而无需额外的移植工作。

Zero 的解释器部分可以在 PowerPC（32 位和 64 位）、x86-64、IA-64、ARM 和 zSeries 上工作。Zero 目前是特定于 Linux 和 GCC 的，但支持其他操作系统和编译器是一个特别受欢迎的领域。”

显然它现在通过了 TCK

# asp-classic - asp错误不显示

> ID：524625
> 
> 赞同：2
> 
> 时间：2009-02-07T21:30:24.603
> 
> 标签：asp-classic

我已将 sql 数据库从一台服务器移动到新服务器（分离/附加）

现在我遇到了一些奇怪的行为，因为它不起作用但没有显示错误。

这是代码

```
<%
const database_dsn="PROVIDER=SQLNCLI10; SERVER=FR-2626\SQLLOP;DATABASE=Lop;Uid=admin-sql;Pwd=xxxx;" 

response.write "Step 0//"

set conn=server.CreateObject("ADODB.Connection")
set RS=server.CreateObject("ADODB.Recordset")

conn.Open database_dsn

response.write "Step 1//"
req = "Select count(*) From tblArticleList"

response.write "Step 2//"
set RS = conn.Execute(req)

response.write  "Step 3//"

%> 
```

程序在第 2 步停止；然后什么都没有，没有错误显示...

我只是不知道该怎么做..我怎么会出错？

谢谢乔纳森

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-11T18:15:25.910

您需要放置错误检查代码以找出实际错误可能是什么。我建议您像这样更改代码：

```
<%
const database_dsn="PROVIDER=SQLNCLI10; SERVER=FR-2626\SQLLOP;DATABASE=Lop;Uid=admin- sql;Pwd=xxxx;"

'Its very important to add this line!!! '
On Error Resume Next
'Its very important to add this line!!! '

response.write "Step 0//"

set conn=server.CreateObject("ADODB.Connection")
set RS=server.CreateObject("ADODB.Recordset")

conn.Open database_dsn

if err.number<>0 then
    response.write err.description
end if

response.write "Step 1//"
req = "Select count(*) From tblArticleList"

response.write "Step 2//"
set RS = conn.Execute(req)

if err.number<>0 then
    response.write err.description
end if

response.write  "Step 3//"

%> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-07T21:54:45.523

Oh i partially found the answer for the error display.

In the Debug pane of the IIS directory configuration, Enable ASP debugging should NOT be checked...althought i thougth it should...

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-09T06:16:03.380

执行查询时，您不使用“设置”命令。我不知道为什么它没有向您显示任何内容，但是您的代码应该看起来更像这样：

```
<%
const database_dsn="PROVIDER=SQLNCLI10; SERVER=FR-2626\SQLLOP;DATABASE=Lop;Uid=admin-sql;Pwd=xxxx;" 

response.write("Step 0//")

set conn=server.CreateObject("ADODB.Connection")
set RS=server.CreateObject("ADODB.Recordset")

conn.Open database_dsn

response.write("Step 1//")
req = "Select count(*) From tblArticleList"

response.write("Step 2//")
RS = conn.Execute(req)

response.write("Step 3//")
%> 
```

是的，“Response.Write”上的括号是可选的。但我就是这样的强迫症，它使故障排除更容易一些。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-05T00:32:12.727

您是否将浏览器设置为“显示友好的 http 错误”，这与您已经确定的是我没有看到错误消息的常见原因。

Shahkaplesh 也是正确的，您可以使用 Server.GetLastError() 来获取发生的最后一个错误，但在此示例中您不需要这样做。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2017-05-26T12:23:12.650

不要踢死马，但我正在对 Oracle 数据库做类似的事情，我有两个幻像问题，我尚未确定根本原因，但有两件事让它们消失了。
1\. 将查询中的所有列命名为任何计算的别名（总和、计数、平均值等），这样您的查询将变为

```
req = "Select count(*) NumRows From tblArticleList" 
```

2\. 在对 cstr 的调用中包装我的查询字符串导致 result.EOF 标志被正确填充，而不是返回一个空值或 null 值，从而导致一个简单的 DO WHILE NOT result.EOF Some Action LOOP 创建一个无限循环，直到网络请求超时。所以例如

```
response.write "Step 2//"
set RS = conn.Execute(cstr(req)) 
```

如果您遇到困难并且无法找出原因，则没什么大不了的，只是一些提示。不过，请遵循上面的调试建议，这是很好的信息。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-09T09:16:16.630

实际上并不意味着不愉快，但是是的，你确实需要一个 Set ，因为你正在设置一个对象类型并且可能想要在某个时候使用返回值（如果这不仅仅是一个看起来像的测试脚本大部头书）。

顺便说一句，Response.Write() 中的括号并不正确，因为它不返回值。它们仅适用于单个参数 sub，因为您可以将括号放在表达式周围您喜欢的任何位置。

例如：

```
 a = (b)
 Response.Write ((("test"))&(1)) 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-07T23:05:23.493

I think Server has a GetLastError method, which you can check to find out what error occurred while running any statement.

e.g. On error resume next .... statement that could cause an error.... errorObject = Server.GetLastError()

For ASPError object, refer [http://www.w3schools.com/asp/asp_ref_error.asp](http://www.w3schools.com/asp/asp_ref_error.asp)

# c++ - 我怎样才能避免名称混淆？

> ID：524633
> 
> 赞同：17
> 
> 时间：2009-02-07T21:40:38.313
> 
> 标签：c++

如何避免 C++ 中的名称混淆？

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2009-02-07T21:43:04.097

你不能。它内置在编译器中，允许您重载函数并在不同的类中拥有具有相同名称的函数等。但是您可以编写像 C 函数一样被破坏的函数。这些可以从 C 代码中调用。但是那些不能被重载，也不能被“普通”C++函数指针调用：

```
extern "C" void foo() {

} 
```

上面的函数将像编译器的 C 函数一样被修改。这可能包括对名称没有任何更改，或者一些更改，例如在它前面的前导“_”左右。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2015-10-24T18:00:33.860

另一种方式：

**控制汇编代码中使用的名称**（[gcc 规范。](https://gcc.gnu.org/onlinedocs/gcc/Asm-Labels.html)）

> 您可以通过在声明符后写入**asm**（或**__asm__**）关键字来指定要在*C 函数或变量的汇编代码中使用的名称。*确保您选择的汇编器名称不会与任何其他汇编器符号或引用寄存器冲突，这取决于您。
> 
>  ****要为函数指定汇编程序名称，请在函数定义之前为函数编写声明并将**asm**放在那里，如下所示：****

 ****```
 int func () asm ("MYFUNC");

 int func ()
 { 
```

`g++`将编译它，`nm -D`输出将是

```
0000000000001e02 T MYFUNC 
```

代替

```
0000000000001e02 T _Z4funcv 
```

在 g++ 4.9.2 上测试

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-02-07T21:42:01.493

你的意思是你可以从库中导出你的函数？ [`extern "c" { your code here }`](http://www.devx.com/tips/Tip/12527)

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2019-03-25T22:20:34.627

绍布的回答实际上是不正确的。避免名称修改的最常见原因是因为您正在构建一个共享库（在 Windows 上，一个 DLL），该库由您无法控制的需要某些导出函数名称的客户端软件使用。由于编译器之间的重整差异，此类接口历来避免名称重整。

你要做的就是这个。首先，在你的源代码中预先`extern "C"`去掉 C++ 的修改；尽管如此，这仍然使 C 受到影响。其次，`-Wl,--kill-at`编译时使用命令行选项。

例子：

```
extern"C" __declspec(dllexport) hresult __stdcall MyExportedFunction( ... )
{
     ....
} 
```

并编译：

```
gcc -shared -mwindows -Wl,--kill-at -Werror ... -o MyLib.dll MyLib.cpp -lkernel32 -l... 
```

您可以使用 Dependency Walker 验证您是否正确。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2020-12-01T14:45:14.107

如果要编译为 wasm，可以通过将`--demangle`选项添加到`wasm-ld` 链接器`clang -Wl,--demangle`

# outlook - outlook add-in, slowing down outlook UI

> ID：524637
> 
> 赞同：2
> 
> 时间：2009-02-07T21:43:30.443
> 
> 标签：outlook, add-in

I have written an outlook add-in to filter spam. The issue is that when the add-in is doing its job of processing a message, and especially with a large attachment that it is procesing / reading through, it is taking a lot of time and because of this the main outlook UI is un-responsive and users cannot do anything with the UI.

Is there an asynchrounous way of running the add-in processing, so that the outlook UI remains OK.

The add-in does a lot of things dueing its procesing of each message and hence it takes a lot of time.

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-12-09T03:11:45.057

如果大部分时间都花在 Outlook API 上，那么创建另一个线程对您没有帮助。由于 Outlook 中的线程模型，从另一个线程访问对象模型将导致调用被编组到主线程，这意味着现在您的 UI 仍处于冻结状态并且您的后台线程处于阻塞状态。

如果大部分工作都花在不涉及 Outlook 对象模型的事情上，那么您可能会看到一个显着的改进，即分离一个单独的工作线程（或线程池）来处理您保存的附件。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-07T23:05:47.250

It's just like with any other program basically. If you need to do something outside of the main thread do so (i.e. create another thread). There's no Outlook-specific API or framework, though.

You have to be extra careful about exception handling though. Unhandled exceptions escaping from a thread can have the weirdest results (though in most cases Outlook will simply crash).

Also, if at all possible you should try to avoid or at least drastically limit accessing the Outlook Object Model from within your processing thread.

Finally, another thing you should make sure of is that you explicitly call `CoInitializeEx` / `CoUninitialize` specially for your new thread if it in any way directly or indirectly uses COM-related functions.

# c++ - 如何创建自己的 ostream/streambuf？

> ID：524641
> 
> 赞同：24
> 
> 时间：2009-02-07T21:45:04.903
> 
> 标签：c++, ostream, streambuf

出于教育目的，我想创建一个 ostream 和流缓冲区来执行以下操作：

1.  在执行 << myVar; 时修复字节序；
2.  存储在双端队列容器中，而不是使用 std:cout 或写入文件
3.  记录额外的数据，例如我做了多少次 <<、我做了多少次 .write、我写入的字节数以及我 flush() 的次数。但我不需要所有信息。

我尝试过超载，但失败了。我尝试通过做重载写入

```
ostream& write( const char* s, streamsize n ) 
```

在我的 basic_stringstream2 类中（我将粘贴 basic_stringstream 复制到我的 cpp 文件中并对其进行了修改），但代码继续使用 basic_ostream。我查看了代码，看起来我需要重载 xsputn （此页面[http://www.cplusplus.com/reference/iostream/ostream](http://www.cplusplus.com/reference/iostream/ostream)上没有提到）但是我还需要重载什么？以及如何构建我的类（它需要继承什么等）？

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2009-02-09T15:39:22.593

规范方法包括定义您自己的流缓冲区。你应该看看：

*   [Angelika LANger](http://www.angelikalanger.com/Articles/Topics.html#CPP)关于 IOStreams 推导的文章
*   [James Kanze](http://gabisoft.free.fr/articles-en.html)关于过滤流缓冲区的文章
*   [boost.iostream](http://www.boost.org/doc/libs/1_37_0/libs/iostreams/doc/index.html)应用示例

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-08-28T07:07:33.890

对于 A+C）我认为您应该查看构面，它们修改了将对象写入字符的方式。您还可以在此处存储有关您流式传输对象的次数的统计信息。查看[使用 STL 流时如何格式化我自己的对象？](https://stackoverflow.com/questions/1096291/how-to-format-my-own-objects-when-using-stl-streams/)例如。

对于 B）您需要创建自己的 streambuf 并将您的 ostream 连接到该缓冲区（构造函数参数）。请参阅[Luc 的链接](https://stackoverflow.com/questions/524641/how-do-i-create-an-ostream-streambuf/528460#528460)+ [Deriving new streambuf classes](https://duckduckgo.com/?q=Deriving+new+streambuf+classes&t=ffab&ia=web)。简而言之，您需要为 ostream 实现此功能（最少）：

*   溢出（放置单个字符或刷新缓冲区）（[链接](http://uw714doc.sco.com/en/SDK_clib/_overflow.html)）
*   xsputn（将 char 数组放入缓冲区）（[链接](http://www.cplusplus.com/reference/iostream/streambuf/xsputn/)）
*   同步（[链接](http://uw714doc.sco.com/en/SDK_clib/_sync.html)）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-09T14:55:57.283

我不确定你想做的事情是否可行。`<<`运算符不是虚拟的。因此，您可以定义`yourstream &operator << (yourstream &strm, int i)`使用字节序转换和计数来执行您想要的操作，并且当您的代码直接调用它时它会起作用。但是，如果您将 yourstream 对象传递给需要 ostream 的函数，则该函数调用的任何时候`<<`，它将转到原始 ostream 版本而不是您的版本。

据我了解，已设置流设施，以便您可以“轻松”定义使用不同类型缓冲区（例如，字符双端队列）的新流类型，并且您可以非常轻松地添加对通过输出您自己的课程`<<`。我不认为您打算重新定义它们之间的中间层。

特别是，`<<`界面的重点是提供格式良好的文本输出，而听起来您实际上想要二进制输出。（否则对“endian”的引用毫无意义。）即使假设有某种我不知道的方法，它充其量也会产生尴尬的二进制输出。例如，考虑最终用户过载以输出 3D 空间中的一个点。的最终用户版本`<<`可能会执行类似`<< '(' << x << ", " << y << ", " << z << ')'`. 这在文本流中看起来不错，但在二进制流中它有很多浪费且完全无用的字符，理想情况下只使用`<< x << y << z`. `<<`（那些应该算作多少次调用？）

# php - 在构造函数中最好不要做哪些事情？

> ID：524647
> 
> 赞同：7
> 
> 时间：2009-02-07T21:48:41.323
> 
> 标签：php, oop, constructor

我首先起草了一个问题：“在构造函数上执行单元测试的最佳方法是什么（例如，PHP5 中的 __construct()）”，但是在阅读相关问题时，我看到一些评论似乎暗示设置成员变量或在构造函数中执行任何复杂的操作都是禁止的。

这里所讨论的类的构造函数接受一个参数，对其执行一些操作（确保它通过嗅探测试，并在必要时对其进行转换），然后将其隐藏在成员变量中。

我认为这样做的好处是：

1) 每当实例化此类的对象时，客户端代码将始终确定该成员变量的值，并且

2）它在客户端代码中保存了一个步骤（其中一个可能会被遗漏），例如，

```
$Thing = new Thing;
$Thing->initialize($var); 
```

当我们可以做到这一点时

```
$Thing = new Thing($var); 
```

并完成它。

这是禁忌吗？如果是，为什么？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-02-07T21:58:35.890

我的经验法则是对象应该在构造函数完成后就可以使用了。但是通常有许多选项可以在之后进行调整。

我的注意事项清单：

*   构造函数应该为对象设置基本选项。
*   他们可能应该创建辅助对象的实例。
*   他们不应该**获取**资源（文件，套接字，...），除非对象显然是某些资源的包装器。

当然，没有规则没有例外。重要的是你要考虑你的设计和你的选择。使对象使用自然 - 包括错误报告。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-02-07T23:11:37.707

这在 C++ 讨论中出现了很多，我得出的一般结论是：

如果对象不获取任何外部资源，则*必须**在*构造函数中初始化成员。这涉及在构造函数中完成所有工作。

*   (x, y) 坐标（或实际上只是一个美化元组的任何其他结构）
*   美国各州缩写查询表

如果一个对象获得了它可以控制的资源，它们*可以**在*构造函数中分配：

*   打开文件描述符
*   分配的内存
*   指向外部库的句柄/指针

如果对象获得了它无法完全控制的资源，则*必须*在构造函数*之外*分配它们：

*   TCP 连接
*   数据库连接
*   弱参考

总是有例外，但这涵盖了大多数情况。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-02-07T21:57:59.260

构造函数用于初始化对象，所以

```
$Thing = new Thing($var); 
```

完全可以接受。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-02-08T12:39:00.450

构造函数的工作是建立实例的[不变量](http://en.wikipedia.org/wiki/Invariant_(computer_science))。

任何对它没有贡献的东西最好远离构造函数。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-07T22:47:16.523

为了提高类的可测试性，保持它的构造函数尽可能简单并让它只要求它绝对需要的东西通常是一件好事。作为 Google 的“清洁代码讲座”系列的一部分，YouTube 上有一个精彩的[演示文稿，详细解释了这一点。](http://www.youtube.com/watch?v=RlfLCWKxHJ0)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-08T12:33:46.293

你绝对应该避免让客户不得不打电话

```
$thing->initialize($var) 
```

这种东西绝对属于构造函数。让他们调用这个对客户端程序员来说是不友好的。有一个（有点争议的）学派说你应该编写类，以便对象*永远不会*处于无效状态——而“未初始化”是一种无效状态。

然而，出于可测试性和性能的原因，有时最好将某些初始化推迟到对象生命的后期。在这种情况下，惰性评估是解决方案。

很抱歉将 Java 语法放在 Python 答案中，但是：

```
// Constructor
public MyObject(MyType initVar) {
      this.initVar = initVar;
}

private void lazyInitialize() {
    if(initialized) {
        return
    }
    // initialization code goes here, uses initVar
}

public SomeType doSomething(SomeOtherType x) {
    lazyInitialize();
    // doing something code goes here
} 
```

您可以对延迟初始化进行分段，以便仅初始化需要它的部分。例如，在 getter 中这样做很常见，只是为了影响所获得的价值。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-07T23:20:52.527

取决于您要构建的系统类型，但总的来说，我认为构造函数最适合仅用于初始化对象的“状态”，而不是本身执行任何状态转换。最好让它设置默认值。

然后我在我的对象中编写一个“句柄”方法来处理诸如用户输入、数据库调用、异常、排序规则之类的事情。这个想法是，这将根据外力（用户输入、时间等）处理对象所处的任何状态。基本上，所有可能改变对象状态并需要额外操作的事物都会在目的。

最后，我在类中加入了一个渲染方法来向用户展示一些有意义的东西。这仅向用户表示对象的状态（无论可能是什么。）

__construct($arguments)
句柄()
渲染(Exception $ex = null)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-08T11:28:23.650

__construct 魔术方法很好用。您在许多框架和应用程序中看到初始化的原因是因为该对象正在被编程为接口，或者它正在尝试制定单例/getInstance 模式。

这些对象通常被拉入上下文或控制器，然后具有由其他更高级别对象调用的公共接口功能。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-23T17:50:16.620

如果 $var 对于 $Thing 工作是绝对必要的，那么它就是一个**DO**

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2009-02-07T21:57:57.093

你不应该把东西放在一个只应该在创建类时运行一次的构造函数中。

解释。

如果我有一个数据库类。构造函数在哪里是到数据库的连接所以

```
$db = new dbclass; 
```

现在我已连接到数据库。

然后我们有一个类，它使用数据库类中的一些方法。

```
class users extends dbclass
{
    // some methods
}

$users = new users 
// by doing this, we have called the dbclass's constructor again 
```

# ruby - 什么！！在红宝石中是什么意思？

> ID：524658
> 
> 赞同：138
> 
> 时间：2009-02-07T21:53:47.460
> 
> 标签：ruby

只是想知道`!!`Ruby中有什么。

* * *

## 回答 #1

> 赞同：165
> 
> 时间：2009-02-07T22:05:28.917

不是这样的。

它用于将值转换为布尔值：

```
!!nil   #=> false
!!"abc" #=> true
!!false #=> false 
```

虽然通常没有必要使用，因为 Ruby 的唯一错误值是`nil`and `false`，所以通常最好让该约定保持不变。

把它想象成

```
!(!some_val) 
```

它合法使用的一件事是防止返回大量数据。例如，您可能不想在方法中返回 3MB 的图像数据`has_image?`，或者您可能不想在`logged_in?`方法中返回整个用户对象。使用`!!`将这些对象转换为简单的`true`/ `false`。

* * *

## 回答 #2

> 赞同：31
> 
> 时间：2009-02-07T22:06:16.107

`true`如果右边的对象不是`nil`和不是`false`，它返回，`false`如果是`nil`或`false`

```
def logged_in?   
  !!@current_user
end 
```

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2009-02-08T18:10:29.080

`!`表示否定布尔状态，两个`!`s 没有什么特别的，除了双重否定。

```
!true == false
# => true 
```

它通常用于强制方法返回布尔值。它将检测任何类型的真实性，例如字符串、整数等等，并将其转换为布尔值。

```
!"wtf"
# => false

!!"wtf"
# => true 
```

一个更真实的用例：

```
def title
  "I return a string."
end

def title_exists?
  !!title
end 
```

当您要确保返回布尔值时，这很有用。不过，恕我直言，这有点毫无意义，因为两者`if 'some string'`都是`if true`完全相同的流程，但有些人发现显式返回布尔值很有用。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-02-07T22:56:44.383

请注意，这个习语也存在于其他编程语言中。C 没有内在`bool`类型，因此所有布尔值都被键入为or`int`的规范值。以这个例子为例（为清楚起见添加了括号）：`0``1`

```
!(1234) == 0
!(0) == 1
!(!(1234)) == 1 
```

“not-not”语法将任何非零整数转换`1`为规范布尔真值。

不过，总的来说，我发现进行合理的比较比使用这个不常见的习语要好得多：

```
int x = 1234;
if (!!x); // wtf mate
if (x != 0); // obvious 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2012-05-18T04:21:28.677

如果您需要进行[独占或](https://stackoverflow.com/a/1058502/38765). 从 Matt Van Horn 的回答中复制并稍作修改：

```
1 ^ true
TypeError: can't convert true into Integer

!!1 ^ !!true
=> false 
```

我用它来确保两个变量要么都是 nil，要么都不是 nil。

```
raise "Inconsistency" if !!a ^ !!b 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2016-10-20T16:39:14.077

这是“双重否定”，但不鼓励这种做法。如果您使用的是[rubocop](https://github.com/bbatsov/rubocop)，您会看到它抱怨此类代码`Style/DoubleNegation`违规。

[理由](https://github.com/bbatsov/rubocop/blob/master/lib/rubocop/cop/style/double_negation.rb)是：

> 由于这既神秘又通常是多余的，因此应避免 [然后解释：] 更改`!!something`为`!something.nil?`

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2015-09-16T03:42:38.423

如果您需要将枚举转换为布尔值，那么了解它的工作原理会很有用。我有代码可以做到这一点，使用`classy_enum`gem：

```
class LinkStatus < ClassyEnum::Base
  def !
    return true
  end
end

class LinkStatus::No < LinkStatus
end

class LinkStatus::Claimed < LinkStatus
  def !
    return false
  end
end

class LinkStatus::Confirmed < LinkStatus
  def !
    return false
  end
end

class LinkStatus::Denied < LinkStatus
end 
```

然后在我的服务代码中，例如：

```
raise Application::Error unless !!object.link_status   # => raises exception for "No" and "Denied" states. 
```

实际上，bangbang 运算符已经变成了我本来可以编写的称为 to_bool 的方法。

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2020-09-01T16:20:11.357

其他答案讨论了做什么`!!`以及它是否是好的做法。

但是，没有一个答案给出将值转换为布尔值的“标准 Ruby 方式”。

```
true & variable 
```

* * *

`TrueClass`，Ruby value 的类`true`，实现了一个方法`&`，[文档](https://ruby-doc.org/core-2.7.0/TrueClass.html)如下：

> `false`如果`obj`是`nil`或`false`，则返回，`true`否则。

当您涵盖标准库时，为什么要使用肮脏的双重否定？

# c# - 你会用什么来做业务验证层？

> ID：524659
> 
> 赞同：12
> 
> 时间：2009-02-07T21:54:15.133
> 
> 标签：c#, validation, nxbre

在我的项目中，我需要创建一个业务对象验证层，它将获取我的对象并根据一组规则运行它并返回通过或失败以及失败原因列表。我知道有很多选择可以实现这一点。

来自微软：

*   [企业图书馆验证应用程序块](http://www.google.com/url?sa=t&source=web&ct=res&cd=1&url=http%3A%2F%2Fmsdn.microsoft.com%2Fen-us%2Flibrary%2Fcc309509.aspx&ei=LAGOSYrcN5CCNcTMiZIL&usg=AFQjCNGYSsoNq_hV223GKaGvO0EMTfN4Pw&sig2=AtQJwf8KrUATfYvTMD9q4g)
*   [Windows Workflow Foundation 规则引擎](http://www.google.com/url?sa=t&source=web&ct=res&cd=1&url=http%3A%2F%2Fmsdn.microsoft.com%2Fen-us%2Flibrary%2Faa480193.aspx&ei=SAGOSfbtGpCCNbXMiZIL&usg=AFQjCNFAKrvKAmkMkprSsL-YDtXcP5_m4A&sig2=FHQuHQpcyQSxhJvM08ovtg)

开源：

*   [流口水.NET](http://droolsdotnet.codehaus.org/)
*   [简单规则引擎（SRE）](http://sourceforge.net/projects/sdsre/)
*   [NxBRE](http://nxbre.wiki.sourceforge.net/)

是否有人在使用这些技术（或我未列出的任何技术）方面取得了特别大的成功或失败，或者对他们认为最适合业务规则验证的技术有任何意见。

**编辑：**我不只是询问通用验证字符串长度 < 200，邮政编码是 5 位数字或 5+4，而是假设实际上会利用规则引擎。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-09T02:16:33.180

The code-versus-rules-engine decision is a matter of trade-offs, IMHO. A few examples are:

### Advantages of code

*   Potentially higher performance.
*   Uses developers' existing skills.
*   No need for separate tools, run-time engines, etc.

### Advantages of rule engine

(Features vary across the various rule engines.)

*   Rule DSL that is writable (or at least readable) by business users.
*   Effective- and expiration-date properties that allow automatic scheduling of rules.
*   Flexible reporting from rule repository supports improved analysis and auditing of system behavior.
*   Just as data-base engines isolate data content/relationship issues from the rest of the system, rules engines isolate validation and policy from the remainder of the system.

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-14T05:04:57.433

A modified version of the CSLA framework rules.

Many of the other rules engines have the promise that goes like "The end user can modify the rules to fit their needs."

Bahh. Very few users are going to learn the complexities of the rules document format or be able to understand the complexities and ramifications of their changes.

The other promise is you can change the rules without having to change the code. I say so what? Changing a rule even as simple as "this field must not be blank" can have a very negative impact on the application. If those fields where previously allowed to be blank you now have a bunch of invalid data in the data store. Plus modern applications are either web based or distributed/updated via technologies like click=once. So you updating a couple of components is just as easy as updating a rules file.

So, because the developer is going to modify them anyway and because they are core to the Business objects operations just locate them in one place and use the power of modern languages and frameworks.

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-08T08:52:35.087

我真的不喜欢微软提供的规则和验证块（太复杂和不灵活），所以我必须根据自定义业务工作流引擎的经验来构建我的。

After a couple of iterations the project has finally gone Open Source now (BSD license) and has proven helpful in production systems. Primary features of [.NET Application Block for Validation and Business Rules](http://abdullin.com/journal/2008/11/23/net-application-block-for-validation-and-business-rules.html):

*   Simple to get started with
*   Rules for the domain objects
*   Rule Reusability
*   Predefined Validation Rules
*   Behavior Extensibility
*   Proper object nesting
*   Designed for DDD and UI level validation
*   Multiple reporting levels
*   Production-proof and active development
*   Small codebase
*   Open Source

Here's how a simple binding of rules at the UI level looks like:

![Binding Rules to UI](https://abdullin.com/storage/uploads/2009/01/2009-01-28_RulesUI2.png?__SQUARESPACE_CACHEVERSION=1233210220588)

Note, that current implementation does not have any DSL at the moment. C# syntax is expressive enough on its own, so there has been no demand to add Boo-based DSL on top.

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-07T22:08:15.807

我不得不承认，对于非常简单的验证，我倾向于编写自己的非常小的、紧凑的规则引擎，主要是因为我认为使用别人的实现对于一个小项目来说是不值得的。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-12T05:12:37.010

I've experimented with Workflow Foundation, used EntLib, and written my own rules engine.

In small applications where I only really need to do UI-based validation to ensure invalid data doesn't sneak into the DB, I reach for the EntLib Validation Block. It's easy to use and requires only a minimal amount of code in my domain objects, plus it doesn't mess up NHibernate or anything else in my technology stack.

For complex stuff, domain-layer validation, etc., I'd easily opt to write my own rules engine again. I'd much rather write rules in code, each rule in it's own tiny class, easily testable and very simple to compose complex sets of rules with.

In the large app that I worked on where I wrote this sort of rules engine, we then used FitNesse to test our rule configurations. It was great having that kind of tool to utilize to ensure correctness. We could feed it tables and tables of data and know, with certainty, that our configured rules worked.

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-15T18:00:12.403

If you are interested in rolling your own, read JP Boodhoo's post on Rules processing. Essentially he lays out a straight forward framework for validating domain objects.

[Validatiion in the Domain Layer](http://blog.jpboodhoo.com/CommentView,guid,e548c7bc-0b11-4978-928b-8838d70d0e16.aspx)

[Validation in the Domain Layer 2](http://blog.jpboodhoo.com/ValidationInTheDomainLayerTakeTwo.aspx)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2012-03-16T05:34:12.903

Try

[http://rulesengine.codeplex.com](http://rulesengine.codeplex.com)

It's lightweight, uses fluent-interfaces to define validation logic, extensible, and Free! You can even define rules on interfaces, implementors inherit the rules.

No more annoying attribute-style validation - what it you don't own the class you want to valida

It has a plug-in to Asp.Net MVC (server-side only).

There is also another project called [Polymod.Net](http://polymod.codeplex.com) which uses RulesEngine to provide self-validating UI's as shown in the screen-shot!

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-07T22:14:00.210

Enterprise Library Validation Block 提供了一种非常类似于 AOP 的方法，并根据我的经验在 3.1 和 4.1 中保持简单。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-12T05:22:34.897

I recommend using [CSLA Framework](http://lhotka.net/cslanet/). Not only for Validation but for other features also.

# c# - HTTP POST Though C#

> ID：524666
> 
> 赞同：5
> 
> 时间：2009-02-07T21:57:30.493
> 
> 标签：c#, .net, http-post

I want to code an auto bot for an online game (tribalwars.net). I'm learning C# in school, but haven't covered networking yet.

Is it possible to make HTTP POSTs though C#? Can anyone provide an example?

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-02-07T22:29:35.390

Trivial with [System.Net.WebClient](http://msdn.microsoft.com/en-us/library/system.net.webclient.aspx):

```
using(WebClient client = new WebClient()) {
    string responseString = client.UploadString(address, requestString);
} 
```

There is also:

*   UploadData - binary (`byte[]`)
*   UploadFile - from a file
*   UploadValues - name/value pairs (like a form)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-07T22:05:22.583

You can use [System.Net.HttpWebRequest](http://msdn.microsoft.com/en-us/library/system.net.httpwebrequest.aspx):

Request

```
HttpWebRequest request= (HttpWebRequest)WebRequest.Create(url);
request.ContentType="application/x-www-form-urlencoded";
request.Method = "POST";
request.KeepAlive = true;

using (Stream requestStream = request.GetRequestStream())
{
    requestStream.Write(BytePost,0,BytePost.Length);
    requestStream.Close();
} 
```

Response

```
HttpWebResponse response = (HttpWebResponse)request.GetResponse();
using(StreamReader sr = new StreamReader(response.GetResponseStream()))
{
    responseString = sr.ReadToEnd();
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-07T22:04:00.963

[Here's](http://www.csharpfriends.com/Forums/ShowPost.aspx?PostID=32254) a good example. You want to use the WebRequest class in C#, which will make this easy.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2021-09-01T04:57:17.737

我知道这是一个老问题，但发布此问题是为了寻找有关如何使用`HttpClient`（命名空间的一部分）在最新的 .NET（Core 5）中发送带有 json 正文的 Http Post 请求的快速示例`System.Net.Http`。例子：

```
//Initialise httpClient, preferably static in some common or util class.
public class Common
{
    public static HttpClient HttpClient => new HttpClient
    {
        BaseAddress = new Uri("https://example.com")
    };
}

public class User
{
    //Function, where you want to post data to api
    public void CreateUser(User user)
    {
        try
        {
            //Set path to api
            var apiUrl = "/api/users";

            //Initialize Json body to be sent with request. Import namespaces Newtonsoft.Json and Newtonsoft.Json.Linq, to use JsonConvert and JObject.
            var jObj = JObject.Parse(JsonConvert.SerializeObject(user));
            var jsonBody = new StringContent(jObj.ToString(), Encoding.UTF8, "application/json");

            //Initialize the http request message, and attach json body to it
            var request = new HttpRequestMessage(HttpMethod.Post, apiUrl)
            {
                Content = jsonBody
            };

            // If you want to send headers like auth token, keys, etc then attach it to request header
            var apiKey = "qwerty";
            request.Headers.Add("api-key", apiKey);

            //Get the response
            using var response = Common.HttpClient.Send(request);

            //EnsureSuccessStatusCode() checks if response is successful, else will throw an exception
            response.EnsureSuccessStatusCode();
        }
        catch (System.Exception ex)
        {
            //handle exception
        }

    }
} 
```

为什么 HttpClient 是静态的或建议每个应用程序实例化一次：

> HttpClient 旨在被实例化一次并在应用程序的整个生命周期中重复使用。为每个请求实例化一个 HttpClient 类将耗尽重负载下可用的套接字数量。这将导致 SocketException 错误。

HttpClient 类也有异步方法。有关课程的更多信息`HttpClient`：[https ://docs.microsoft.com/en-us/dotnet/api/system.net.http.httpclient?view=net-5.0](https://docs.microsoft.com/en-us/dotnet/api/system.net.http.httpclient?view=net-5.0)

# terminal - 将样式文本打印到终端

> ID：524667
> 
> 赞同：2
> 
> 时间：2009-02-07T21:57:35.110
> 
> 标签：terminal

我有一个通过命令行运行的程序，我想打印出粗体或样式文本，类似于手册页的粗体方式（我想不出一个样式示例）。

如何设置发送到终端的文本样式？

如果它有所作为，我正在运行 MacOSX 终端。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-07T22:05:03.100

我相信您想使用[ncurses](http://en.wikipedia.org/wiki/Ncurses)库来完成此操作。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-07T22:09:12.420

你可以看看这个 SO 问题：[Colored grep?](https://stackoverflow.com/questions/138383/colored-grep) 它显示了 VT100 终端颜色输出的简单方法（在 MacOSX 上效果很好）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-07T22:19:37.110

另一个有用的 SO 问题是：[将格式应用于 unix shell](https://stackoverflow.com/questions/510202/apply-formatting-to-unix-shell)，带有指向[ANSI 转义码](http://en.wikipedia.org/wiki/ANSI_escape_code)的链接，以及来自 shell 的示例。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-07T22:32:28.130

您可以使用该`tput`程序从任何 shell 脚本执行此操作以输出`terminfo`代码。奇怪的是，有一个代码可以打开但不能关闭——你必须关闭所有东西。`tput smso`可以使用和打开和关闭反向视频`tput rmso`。

以下是粗体 ( ) 的示例`/bin/ksh`：

```
print -n "This word is "; tput bold; print -n "bold"; tput sgr0; print "!" 
```

`tput`在大多数编程语言中，分叉一个进程和调用比使用`ncurses`库（它`tput`是一个命令行界面）更容易。

# c# - 是否可以编写在 .NET 上运行的恶意软件？

> ID：524676
> 
> 赞同：4
> 
> 时间：2009-02-07T21:59:22.737
> 
> 标签：c#, .net, vb.net, security

我听说过框架和 BCL 中的安全功能，但这与防止恶意程序员编写有害软件或防止恶意软件在 CLR 上运行有关吗？例如，是否可以用 C# 编写一个对 Windows 文件夹进行有害更改的程序？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-02-07T22:01:27.677

绝对可以，尤其是如果该应用程序得到高度信任的话。这就是 .NET 中的信任级别所做的。

查看MSDN上有关[代码访问安全性的文章以获取更多信息。](http://msdn.microsoft.com/en-us/library/930b76w0(VS.71).aspx)

还可以查看 Keith Brown 关于 .NET 安全性的[优秀书籍](http://alt.pluralsight.com/wiki/default.aspx/Keith.GuideBook.HomePage)，您可以在线阅读。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-08T02:14:23.970

那当然是。以前的工作我们为一些 beckhoff plc 控制器创建了一个 Windows 窗体界面。我的一位同事在 WCF 和一些严重错误的编码的帮助下设法杀死了一台 Windows 服务器，或者这可能是倍福的错误。

这可能是您运行具有完全权限的应用程序所获得的。

# javascript - 如何创建一个 tag with Javascript?</a></h1> <div class="ml12 aside-cta flex--item print:d-none sm:ml0 sm:mb12 sm:order-first sm:as-end"> <a href="https://stackoverflow.com/questions/ask" target="_blank" class="ws-nowrap s-btn s-btn__primary">问问题</a></div> </div> <div class="d-flex fw-wrap pb8 mb16 bb bc-black-075"> <div class="flex--item ws-nowrap mr16 mb8"> <span class="fc-light mr2">Arend</span> </div> <div class="flex--item ws-nowrap mr16 mb8" title="2022-04-17 15:46:40Z"> <span class="fc-light mr2">问问题</span> <time itemprop="dateCreated" datetime="2009-02-07T22:12:30.837">2009-02-07T22:12:30.837</time> </div> <div class="flex--item ws-nowrap mb8" title="Viewed 6 times"> <span class="fc-light mr2"></span> 396432 次 </div> </div> <div id="mainbar" role="main" aria-label="question and answers"> <div class="question" data-questionid="4" data-position-on-page="0" data-score="763" id="question"> <div class="post-layout"> <div class="votecell post-layout--left"> <div class="js-voting-container d-flex jc-center fd-column ai-stretch gs4 fc-black-200" data-post-id="4"> <button class="js-vote-up-btn flex--item s-btn s-btn__unset c-pointer " data-controller="s-tooltip" data-s-tooltip-placement="right" aria-pressed="false" aria-label="Up vote" data-selected-classes="fc-theme-primary" data-unselected-classes="" aria-describedby="--stacks-s-tooltip-peeufs8c"> <svg aria-hidden="true" class="svg-icon iconArrowUpLg" width="36" height="36" viewBox="0 0 36 36"><path d="M2 25h32L18 9 2 25Z"></path></svg> </button> <div id="--stacks-s-tooltip-peeufs8c" class="s-popover s-popover__tooltip pe-none" aria-hidden="true" role="tooltip">This question shows research effort; it is useful and clear<div class="s-popover--arrow"></div></div> <div class="js-vote-count flex--item d-flex fd-column ai-center fc-black-500 fs-title" itemprop="upvoteCount" data-value=""> 400 </div> <button class="js-vote-down-btn flex--item s-btn s-btn__unset c-pointer " data-controller="s-tooltip" data-s-tooltip-placement="right" aria-pressed="false" aria-label="Down vote" data-selected-classes="fc-theme-primary" data-unselected-classes="" aria-describedby="--stacks-s-tooltip-04106eqn"> <svg aria-hidden="true" class="svg-icon iconArrowDownLg" width="36" height="36" viewBox="0 0 36 36"><path d="M2 11h32L18 27 2 11Z"></path></svg> </button><div id="--stacks-s-tooltip-04106eqn" class="s-popover s-popover__tooltip pe-none" aria-hidden="true" role="tooltip">This question does not show any research effort; it is unclear or not useful<div class="s-popover--arrow"></div></div> <div id="--stacks-s-tooltip-tgvwendx" class="s-popover s-popover__tooltip pe-none" aria-hidden="true" role="tooltip">Bookmark this question.<div class="s-popover--arrow"></div></div> <a class="js-post-issue flex--item s-btn s-btn__unset c-pointer py6 mx-auto" data-shortcut="T" data-ks-title="timeline" data-controller="s-tooltip" data-s-tooltip-placement="right" aria-label="Timeline" aria-describedby="--stacks-s-tooltip-abwmy15k"><svg aria-hidden="true" class="mln2 mr0 svg-icon iconHistory" width="19" height="18" viewBox="0 0 19 18"><path d="M3 9a8 8 0 1 1 3.73 6.77L8.2 14.3A6 6 0 1 0 5 9l3.01-.01-4 4-4-4h3L3 9Zm7-4h1.01L11 9.36l3.22 2.1-.6.93L10 10V5Z"></path></svg></a><div id="--stacks-s-tooltip-abwmy15k" class="s-popover s-popover__tooltip pe-none" aria-hidden="true" role="tooltip">Show activity on this post.<div class="s-popover--arrow"></div></div> </div> </div> <div class="postcell post-layout--right"> <div class="s-prose js-post-body" itemprop="text"> <p>I'm looking for a way to insert a <code>&lt;style&gt;</code> tag into an HTML page with JavaScript.</p>&#xA;&#xA;<p>The best way I found so far:</p>&#xA;&#xA;<pre><code>var divNode = document.createElement("div");&#xA;divNode.innerHTML = "&lt;br&gt;&lt;style&gt;h1 { background: red; }&lt;/style&gt;";&#xA;document.body.appendChild(divNode);&#xA;</code></pre>&#xA;&#xA;<p>This works in Firefox, Opera and Internet Explorer but not in Google Chrome. Also it's a bit ugly with the <code>&lt;br&gt;</code> in front for IE.</p>&#xA;&#xA;<p>Does anyone know of a way to create a <code>&lt;style&gt;</code> tag that</p>&#xA;&#xA;<ol>&#xA;<li><p>Is nicer</p></li>&#xA;<li><p>Works with Chrome?</p></li>&#xA;</ol>&#xA;&#xA;<p>Or maybe</p>&#xA;&#xA;<ol>&#xA;<li><p>This is a non-standard thing I should avoid</p></li>&#xA;<li><p>Three working browsers are great and who uses Chrome anyway?</p></li>&#xA;</ol>&#xA; </div> <div class="mt24 mb12"> <div class="post-taglist d-flex gs4 gsy fd-column"> <div class="d-flex ps-relative fw-wrap"> <a href="/tags/javascript" class="post-tag js-gps-track" title="show questions tagged 'javascript'" rel="tag">javascript</a><a href="/tags/html" class="post-tag js-gps-track" title="show questions tagged 'html'" rel="tag">html</a><a href="/tags/css" class="post-tag js-gps-track" title="show questions tagged 'css'" rel="tag">css</a> </div> </div> </div> </div> <span class="d-none" itemprop="commentCount">4</span> </div> </div> <div class="js-zone-container zone-container-responsive"> <div id="dfp-isb" class="everyonelovesstackoverflow everyoneloves__inline-sidebar mx-auto" style="min-height: auto; height: auto; display: none;"></div> <div class="js-report-ad-button-container mx-auto" style="width: 300px"></div> </div> <div id="answers"> <a name="tab-top"></a> <div id="answers-header"> <div class="answers-subheader d-flex ai-center mb8"> <div class="flex--item fl1"> <h2 class="mb0" data-answercount=""> 18 回答 <span style="display:none;" itemprop="answerCount">18</span> </h2> </div> </div> </div> <a name="7"></a> <div id="answer-7" class="answer js-answer accepted-answer" data-answerid="7" data-parentid="4" data-score="506" data-position-on-page="1" data-highest-scored="1" data-question-has-accepted-highest-score="1" itemprop="suggestedAnswer" itemscope="" itemtype="https://schema.org/Answer"> <div class="post-layout"> <div class="votecell post-layout--left"> <div class="js-voting-container d-flex jc-center fd-column ai-stretch gs4 fc-black-200" data-post-id="7"> <button class="js-vote-up-btn flex--item s-btn s-btn__unset c-pointer " data-controller="s-tooltip" data-s-tooltip-placement="right" aria-pressed="false" aria-label="Up vote" data-selected-classes="fc-theme-primary" data-unselected-classes="" aria-describedby="--stacks-s-tooltip-dgvag2l3"> <svg aria-hidden="true" class="svg-icon iconArrowUpLg" width="36" height="36" viewBox="0 0 36 36"><path d="M2 25h32L18 9 2 25Z"></path></svg> </button><div id="--stacks-s-tooltip-dgvag2l3" class="s-popover s-popover__tooltip pe-none" aria-hidden="true" role="tooltip">This answer is useful<div class="s-popover--arrow"></div></div> <div class="js-vote-count flex--item d-flex fd-column ai-center fc-black-500 fs-title" itemprop="upvoteCount" data-value="757"> 757 </div> <button class="js-vote-down-btn flex--item s-btn s-btn__unset c-pointer " data-controller="s-tooltip" data-s-tooltip-placement="right" aria-pressed="false" aria-label="Down vote" data-selected-classes="fc-theme-primary" data-unselected-classes="" aria-describedby="--stacks-s-tooltip-gn8ppsfv"> <svg aria-hidden="true" class="svg-icon iconArrowDownLg" width="36" height="36" viewBox="0 0 36 36"><path d="M2 11h32L18 27 2 11Z"></path></svg> </button> </div> </div> <div class="answercell post-layout--right"> <div class="s-prose js-post-body" itemprop="text"> <p>Try adding the <code>style</code> element to the <code>head</code> rather than the <code>body</code>.</p>&#xA;&#xA;<p>This was tested in IE (7-9), Firefox, Opera and Chrome:</p>&#xA;&#xA;<pre><code>var css = 'h1 { background: red; }',&#xA; head = document.head || document.getElementsByTagName('head')[0],&#xA; style = document.createElement('style');&#xA;&#xA;head.appendChild(style);&#xA;&#xA;style.type = 'text/css';&#xA;if (style.styleSheet){&#xA; // This is required for IE8 and below.&#xA; style.styleSheet.cssText = css;&#xA;} else {&#xA; style.appendChild(document.createTextNode(css));&#xA;}&#xA;</code></pre>&#xA; </div> <div class="mt24"> <div class="user-action-time" style="color:#999;text-align:right;">于 2009-02-07T22:25:36.147 回答</div> </div> </div> </div> </div><a name="7"></a> <div id="answer-7" class="answer js-answer accepted-answer" data-answerid="7" data-parentid="4" data-score="506" data-position-on-page="1" data-highest-scored="1" data-question-has-accepted-highest-score="1" itemprop="suggestedAnswer" itemscope="" itemtype="https://schema.org/Answer"> <div class="post-layout"> <div class="votecell post-layout--left"> <div class="js-voting-container d-flex jc-center fd-column ai-stretch gs4 fc-black-200" data-post-id="7"> <button class="js-vote-up-btn flex--item s-btn s-btn__unset c-pointer " data-controller="s-tooltip" data-s-tooltip-placement="right" aria-pressed="false" aria-label="Up vote" data-selected-classes="fc-theme-primary" data-unselected-classes="" aria-describedby="--stacks-s-tooltip-dgvag2l3"> <svg aria-hidden="true" class="svg-icon iconArrowUpLg" width="36" height="36" viewBox="0 0 36 36"><path d="M2 25h32L18 9 2 25Z"></path></svg> </button><div id="--stacks-s-tooltip-dgvag2l3" class="s-popover s-popover__tooltip pe-none" aria-hidden="true" role="tooltip">This answer is useful<div class="s-popover--arrow"></div></div> <div class="js-vote-count flex--item d-flex fd-column ai-center fc-black-500 fs-title" itemprop="upvoteCount" data-value="80"> 80 </div> <button class="js-vote-down-btn flex--item s-btn s-btn__unset c-pointer " data-controller="s-tooltip" data-s-tooltip-placement="right" aria-pressed="false" aria-label="Down vote" data-selected-classes="fc-theme-primary" data-unselected-classes="" aria-describedby="--stacks-s-tooltip-gn8ppsfv"> <svg aria-hidden="true" class="svg-icon iconArrowDownLg" width="36" height="36" viewBox="0 0 36 36"><path d="M2 11h32L18 27 2 11Z"></path></svg> </button> </div> </div> <div class="answercell post-layout--right"> <div class="s-prose js-post-body" itemprop="text"> <p><code>&lt;style&gt;</code> tags should be placed within the <code>&lt;head&gt;</code> element, and each added tag should be added to the bottom of the <code>&lt;head&gt;</code> tag.</p>&#xA;<p>Using <a href="https://developer.mozilla.org/en-US/docs/Web/API/Element/insertAdjacentHTML" rel="noreferrer">insertAdjacentHTML</a> to inject a style tag into the document <a href="https://developer.mozilla.org/en-US/docs/Glossary/Head" rel="noreferrer">head tag</a>:</p>&#xA;<h3>Native DOM:</h3>&#xA;<p><div class="snippet" data-lang="js" data-hide="false" data-console="true" data-babel="false">&#xD;&#xA;<div class="snippet-code">&#xD;&#xA;<pre class="snippet-code-js lang-js prettyprint-override"><code>document.head.insertAdjacentHTML("beforeend", `&lt;style&gt;body{background:red}&lt;/style&gt;`)</code></pre>&#xD;&#xA;</div>&#xD;&#xA;</div>&#xD;&#xA;</p>&#xA;<hr />&#xA;<h3>jQuery:</h3>&#xA;<p><div class="snippet" data-lang="js" data-hide="false" data-console="true" data-babel="false">&#xD;&#xA;<div class="snippet-code">&#xD;&#xA;<pre class="snippet-code-js lang-js prettyprint-override"><code>$('&lt;style&gt;').text("body{background:red}").appendTo(document.head)</code></pre>&#xD;&#xA;<pre class="snippet-code-html lang-html prettyprint-override"><code>&lt;script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"&gt;&lt;/script&gt;</code></pre>&#xD;&#xA;</div>&#xD;&#xA;</div>&#xD;&#xA;</p>&#xA; </div> <div class="mt24"> <div class="user-action-time" style="color:#999;text-align:right;">于 2015-02-22T19:16:22.483 回答</div> </div> </div> </div> </div><a name="7"></a> <div id="answer-7" class="answer js-answer accepted-answer" data-answerid="7" data-parentid="4" data-score="506" data-position-on-page="1" data-highest-scored="1" data-question-has-accepted-highest-score="1" itemprop="suggestedAnswer" itemscope="" itemtype="https://schema.org/Answer"> <div class="post-layout"> <div class="votecell post-layout--left"> <div class="js-voting-container d-flex jc-center fd-column ai-stretch gs4 fc-black-200" data-post-id="7"> <button class="js-vote-up-btn flex--item s-btn s-btn__unset c-pointer " data-controller="s-tooltip" data-s-tooltip-placement="right" aria-pressed="false" aria-label="Up vote" data-selected-classes="fc-theme-primary" data-unselected-classes="" aria-describedby="--stacks-s-tooltip-dgvag2l3"> <svg aria-hidden="true" class="svg-icon iconArrowUpLg" width="36" height="36" viewBox="0 0 36 36"><path d="M2 25h32L18 9 2 25Z"></path></svg> </button><div id="--stacks-s-tooltip-dgvag2l3" class="s-popover s-popover__tooltip pe-none" aria-hidden="true" role="tooltip">This answer is useful<div class="s-popover--arrow"></div></div> <div class="js-vote-count flex--item d-flex fd-column ai-center fc-black-500 fs-title" itemprop="upvoteCount" data-value="38"> 38 </div> <button class="js-vote-down-btn flex--item s-btn s-btn__unset c-pointer " data-controller="s-tooltip" data-s-tooltip-placement="right" aria-pressed="false" aria-label="Down vote" data-selected-classes="fc-theme-primary" data-unselected-classes="" aria-describedby="--stacks-s-tooltip-gn8ppsfv"> <svg aria-hidden="true" class="svg-icon iconArrowDownLg" width="36" height="36" viewBox="0 0 36 36"><path d="M2 11h32L18 27 2 11Z"></path></svg> </button> </div> </div> <div class="answercell post-layout--right"> <div class="s-prose js-post-body" itemprop="text"> <p>Here's a script which adds IE-style <code>createStyleSheet()</code> and <code>addRule()</code> methods to browsers which don't have them:</p>&#xA;&#xA;<pre><code>if(typeof document.createStyleSheet === 'undefined') {&#xA; document.createStyleSheet = (function() {&#xA; function createStyleSheet(href) {&#xA; if(typeof href !== 'undefined') {&#xA; var element = document.createElement('link');&#xA; element.type = 'text/css';&#xA; element.rel = 'stylesheet';&#xA; element.href = href;&#xA; }&#xA; else {&#xA; var element = document.createElement('style');&#xA; element.type = 'text/css';&#xA; }&#xA;&#xA; document.getElementsByTagName('head')[0].appendChild(element);&#xA; var sheet = document.styleSheets[document.styleSheets.length - 1];&#xA;&#xA; if(typeof sheet.addRule === 'undefined')&#xA; sheet.addRule = addRule;&#xA;&#xA; if(typeof sheet.removeRule === 'undefined')&#xA; sheet.removeRule = sheet.deleteRule;&#xA;&#xA; return sheet;&#xA; }&#xA;&#xA; function addRule(selectorText, cssText, index) {&#xA; if(typeof index === 'undefined')&#xA; index = this.cssRules.length;&#xA;&#xA; this.insertRule(selectorText + ' {' + cssText + '}', index);&#xA; }&#xA;&#xA; return createStyleSheet;&#xA; })();&#xA;}&#xA;</code></pre>&#xA;&#xA;<p>You can add external files via</p>&#xA;&#xA;<pre><code>document.createStyleSheet('foo.css');&#xA;</code></pre>&#xA;&#xA;<p>and dynamically create rules via</p>&#xA;&#xA;<pre><code>var sheet = document.createStyleSheet();&#xA;sheet.addRule('h1', 'background: red;');&#xA;</code></pre>&#xA; </div> <div class="mt24"> <div class="user-action-time" style="color:#999;text-align:right;">于 2009-02-07T23:18:28.833 回答</div> </div> </div> </div> </div><a name="7"></a> <div id="answer-7" class="answer js-answer accepted-answer" data-answerid="7" data-parentid="4" data-score="506" data-position-on-page="1" data-highest-scored="1" data-question-has-accepted-highest-score="1" itemprop="suggestedAnswer" itemscope="" itemtype="https://schema.org/Answer"> <div class="post-layout"> <div class="votecell post-layout--left"> <div class="js-voting-container d-flex jc-center fd-column ai-stretch gs4 fc-black-200" data-post-id="7"> <button class="js-vote-up-btn flex--item s-btn s-btn__unset c-pointer " data-controller="s-tooltip" data-s-tooltip-placement="right" aria-pressed="false" aria-label="Up vote" data-selected-classes="fc-theme-primary" data-unselected-classes="" aria-describedby="--stacks-s-tooltip-dgvag2l3"> <svg aria-hidden="true" class="svg-icon iconArrowUpLg" width="36" height="36" viewBox="0 0 36 36"><path d="M2 25h32L18 9 2 25Z"></path></svg> </button><div id="--stacks-s-tooltip-dgvag2l3" class="s-popover s-popover__tooltip pe-none" aria-hidden="true" role="tooltip">This answer is useful<div class="s-popover--arrow"></div></div> <div class="js-vote-count flex--item d-flex fd-column ai-center fc-black-500 fs-title" itemprop="upvoteCount" data-value="37"> 37 </div> <button class="js-vote-down-btn flex--item s-btn s-btn__unset c-pointer " data-controller="s-tooltip" data-s-tooltip-placement="right" aria-pressed="false" aria-label="Down vote" data-selected-classes="fc-theme-primary" data-unselected-classes="" aria-describedby="--stacks-s-tooltip-gn8ppsfv"> <svg aria-hidden="true" class="svg-icon iconArrowDownLg" width="36" height="36" viewBox="0 0 36 36"><path d="M2 11h32L18 27 2 11Z"></path></svg> </button> </div> </div> <div class="answercell post-layout--right"> <div class="s-prose js-post-body" itemprop="text"> <p>I'm assuming that you're wanting to insert a <code>style</code> tag versus a <code>link</code> tag (referencing an external CSS), so that's what the following example does:</p>&#xA;&#xA;<pre><code>&lt;html&gt;&#xA; &lt;head&gt;&#xA; &lt;title&gt;Example Page&lt;/title&gt;&#xA; &lt;/head&gt;&#xA; &lt;body&gt;&#xA; &lt;span&gt;&#xA; This is styled dynamically via JavaScript.&#xA; &lt;/span&gt;&#xA; &lt;/body&gt;&#xA; &lt;script type="text/javascript"&gt;&#xA; var styleNode = document.createElement('style');&#xA; styleNode.type = "text/css";&#xA; // browser detection (based on prototype.js)&#xA; if(!!(window.attachEvent &amp;&amp; !window.opera)) {&#xA; styleNode.styleSheet.cssText = 'span { color: rgb(255, 0, 0); }';&#xA; } else {&#xA; var styleText = document.createTextNode('span { color: rgb(255, 0, 0); } ');&#xA; styleNode.appendChild(styleText);&#xA; }&#xA; document.getElementsByTagName('head')[0].appendChild(styleNode);&#xA; &lt;/script&gt;&#xA;&lt;/html&gt;&#xA;</code></pre>&#xA;&#xA;<p>Also, I noticed in your question that you are using <code>innerHTML</code>. This is actually a non-standard way of inserting data into a page. The best practice is to create a text node and append it to another element node.</p>&#xA;&#xA;<p>With respect to your final question, you're going to hear some people say that your work should work across all of the browsers. It all depends on your audience. If no one in your audience is using Chrome, then don't sweat it; however, if you're looking to reach the biggest audience possible, then it's best to support all major A-grade browsers</p>&#xA; </div> <div class="mt24"> <div class="user-action-time" style="color:#999;text-align:right;">于 2009-02-07T22:22:27.153 回答</div> </div> </div> </div> </div><a name="7"></a> <div id="answer-7" class="answer js-answer accepted-answer" data-answerid="7" data-parentid="4" data-score="506" data-position-on-page="1" data-highest-scored="1" data-question-has-accepted-highest-score="1" itemprop="suggestedAnswer" itemscope="" itemtype="https://schema.org/Answer"> <div class="post-layout"> <div class="votecell post-layout--left"> <div class="js-voting-container d-flex jc-center fd-column ai-stretch gs4 fc-black-200" data-post-id="7"> <button class="js-vote-up-btn flex--item s-btn s-btn__unset c-pointer " data-controller="s-tooltip" data-s-tooltip-placement="right" aria-pressed="false" aria-label="Up vote" data-selected-classes="fc-theme-primary" data-unselected-classes="" aria-describedby="--stacks-s-tooltip-dgvag2l3"> <svg aria-hidden="true" class="svg-icon iconArrowUpLg" width="36" height="36" viewBox="0 0 36 36"><path d="M2 25h32L18 9 2 25Z"></path></svg> </button><div id="--stacks-s-tooltip-dgvag2l3" class="s-popover s-popover__tooltip pe-none" aria-hidden="true" role="tooltip">This answer is useful<div class="s-popover--arrow"></div></div> <div class="js-vote-count flex--item d-flex fd-column ai-center fc-black-500 fs-title" itemprop="upvoteCount" data-value="28"> 28 </div> <button class="js-vote-down-btn flex--item s-btn s-btn__unset c-pointer " data-controller="s-tooltip" data-s-tooltip-placement="right" aria-pressed="false" aria-label="Down vote" data-selected-classes="fc-theme-primary" data-unselected-classes="" aria-describedby="--stacks-s-tooltip-gn8ppsfv"> <svg aria-hidden="true" class="svg-icon iconArrowDownLg" width="36" height="36" viewBox="0 0 36 36"><path d="M2 11h32L18 27 2 11Z"></path></svg> </button> </div> </div> <div class="answercell post-layout--right"> <div class="s-prose js-post-body" itemprop="text"> <p>An example that works and are compliant with all browsers :</p>&#xA;&#xA;<pre><code>var ss = document.createElement("link");&#xA;ss.type = "text/css";&#xA;ss.rel = "stylesheet";&#xA;ss.href = "style.css";&#xA;document.getElementsByTagName("head")[0].appendChild(ss);&#xA;</code></pre>&#xA; </div> <div class="mt24"> <div class="user-action-time" style="color:#999;text-align:right;">于 2009-02-07T22:23:10.177 回答</div> </div> </div> </div> </div><a name="7"></a> <div id="answer-7" class="answer js-answer accepted-answer" data-answerid="7" data-parentid="4" data-score="506" data-position-on-page="1" data-highest-scored="1" data-question-has-accepted-highest-score="1" itemprop="suggestedAnswer" itemscope="" itemtype="https://schema.org/Answer"> <div class="post-layout"> <div class="votecell post-layout--left"> <div class="js-voting-container d-flex jc-center fd-column ai-stretch gs4 fc-black-200" data-post-id="7"> <button class="js-vote-up-btn flex--item s-btn s-btn__unset c-pointer " data-controller="s-tooltip" data-s-tooltip-placement="right" aria-pressed="false" aria-label="Up vote" data-selected-classes="fc-theme-primary" data-unselected-classes="" aria-describedby="--stacks-s-tooltip-dgvag2l3"> <svg aria-hidden="true" class="svg-icon iconArrowUpLg" width="36" height="36" viewBox="0 0 36 36"><path d="M2 25h32L18 9 2 25Z"></path></svg> </button><div id="--stacks-s-tooltip-dgvag2l3" class="s-popover s-popover__tooltip pe-none" aria-hidden="true" role="tooltip">This answer is useful<div class="s-popover--arrow"></div></div> <div class="js-vote-count flex--item d-flex fd-column ai-center fc-black-500 fs-title" itemprop="upvoteCount" data-value="7"> 7 </div> <button class="js-vote-down-btn flex--item s-btn s-btn__unset c-pointer " data-controller="s-tooltip" data-s-tooltip-placement="right" aria-pressed="false" aria-label="Down vote" data-selected-classes="fc-theme-primary" data-unselected-classes="" aria-describedby="--stacks-s-tooltip-gn8ppsfv"> <svg aria-hidden="true" class="svg-icon iconArrowDownLg" width="36" height="36" viewBox="0 0 36 36"><path d="M2 11h32L18 27 2 11Z"></path></svg> </button> </div> </div> <div class="answercell post-layout--right"> <div class="s-prose js-post-body" itemprop="text"> <p>Oftentimes there's a need to override existing rules, so appending new styles to the HEAD doesn't work in every case.</p>&#xA;&#xA;<p>I came up with this simple function that summarizes all <strong><em>not valid</em></strong> "append to the BODY" approaches and is just more convenient to use and debug (IE8+).</p>&#xA;&#xA;<pre><code>window.injectCSS = (function(doc){&#xA; // wrapper for all injected styles and temp el to create them&#xA; var wrap = doc.createElement('div');&#xA; var temp = doc.createElement('div');&#xA; // rules like "a {color: red}" etc.&#xA; return function (cssRules) {&#xA; // append wrapper to the body on the first call&#xA; if (!wrap.id) {&#xA; wrap.id = 'injected-css';&#xA; wrap.style.display = 'none';&#xA; doc.body.appendChild(wrap);&#xA; }&#xA; // &lt;br&gt; for IE: http://goo.gl/vLY4x7&#xA; temp.innerHTML = '&lt;br&gt;&lt;style&gt;'+ cssRules +'&lt;/style&gt;';&#xA; wrap.appendChild( temp.children[1] );&#xA; };&#xA;})(document);&#xA;</code></pre>&#xA;&#xA;<p>Demo: <a href="http://codepen.io/anon/pen/vtHCs" rel="nofollow">codepen</a>, <a href="http://jsfiddle.net/8h09zkht/" rel="nofollow">jsfiddle</a></p>&#xA; </div> <div class="mt24"> <div class="user-action-time" style="color:#999;text-align:right;">于 2014-10-07T07:12:12.443 回答</div> </div> </div> </div> </div><a name="7"></a> <div id="answer-7" class="answer js-answer accepted-answer" data-answerid="7" data-parentid="4" data-score="506" data-position-on-page="1" data-highest-scored="1" data-question-has-accepted-highest-score="1" itemprop="suggestedAnswer" itemscope="" itemtype="https://schema.org/Answer"> <div class="post-layout"> <div class="votecell post-layout--left"> <div class="js-voting-container d-flex jc-center fd-column ai-stretch gs4 fc-black-200" data-post-id="7"> <button class="js-vote-up-btn flex--item s-btn s-btn__unset c-pointer " data-controller="s-tooltip" data-s-tooltip-placement="right" aria-pressed="false" aria-label="Up vote" data-selected-classes="fc-theme-primary" data-unselected-classes="" aria-describedby="--stacks-s-tooltip-dgvag2l3"> <svg aria-hidden="true" class="svg-icon iconArrowUpLg" width="36" height="36" viewBox="0 0 36 36"><path d="M2 25h32L18 9 2 25Z"></path></svg> </button><div id="--stacks-s-tooltip-dgvag2l3" class="s-popover s-popover__tooltip pe-none" aria-hidden="true" role="tooltip">This answer is useful<div class="s-popover--arrow"></div></div> <div class="js-vote-count flex--item d-flex fd-column ai-center fc-black-500 fs-title" itemprop="upvoteCount" data-value="6"> 6 </div> <button class="js-vote-down-btn flex--item s-btn s-btn__unset c-pointer " data-controller="s-tooltip" data-s-tooltip-placement="right" aria-pressed="false" aria-label="Down vote" data-selected-classes="fc-theme-primary" data-unselected-classes="" aria-describedby="--stacks-s-tooltip-gn8ppsfv"> <svg aria-hidden="true" class="svg-icon iconArrowDownLg" width="36" height="36" viewBox="0 0 36 36"><path d="M2 11h32L18 27 2 11Z"></path></svg> </button> </div> </div> <div class="answercell post-layout--right"> <div class="s-prose js-post-body" itemprop="text"> <p><div class="snippet" data-lang="js" data-hide="false" data-console="false" data-babel="false">&#xD;&#xA;<div class="snippet-code">&#xD;&#xA;<pre class="snippet-code-js lang-js prettyprint-override"><code>document.head.innerHTML += `&#xD;&#xA; &lt;style&gt;&#xD;&#xA; h1 {&#xD;&#xA; color: red; &#xD;&#xA; }&#xD;&#xA; p {&#xD;&#xA; color: blue;&#xD;&#xA; }&#xD;&#xA; &lt;/style&gt;`</code></pre>&#xD;&#xA;<pre class="snippet-code-html lang-html prettyprint-override"><code>&lt;h1&gt;I'm red!&lt;/h1&gt;&#xD;&#xA;&lt;p&gt;I'm blue!&lt;/p&gt;</code></pre>&#xD;&#xA;</div>&#xD;&#xA;</div>&#xD;&#xA;</p>&#xA;&#xA;<p>By far the most straightforward solution. All you have to do is type the same as how you'd normally declare <code>style</code> tags, between the backticks</p>&#xA; </div> <div class="mt24"> <div class="user-action-time" style="color:#999;text-align:right;">于 2018-07-16T18:05:34.863 回答</div> </div> </div> </div> </div><a name="7"></a> <div id="answer-7" class="answer js-answer accepted-answer" data-answerid="7" data-parentid="4" data-score="506" data-position-on-page="1" data-highest-scored="1" data-question-has-accepted-highest-score="1" itemprop="suggestedAnswer" itemscope="" itemtype="https://schema.org/Answer"> <div class="post-layout"> <div class="votecell post-layout--left"> <div class="js-voting-container d-flex jc-center fd-column ai-stretch gs4 fc-black-200" data-post-id="7"> <button class="js-vote-up-btn flex--item s-btn s-btn__unset c-pointer " data-controller="s-tooltip" data-s-tooltip-placement="right" aria-pressed="false" aria-label="Up vote" data-selected-classes="fc-theme-primary" data-unselected-classes="" aria-describedby="--stacks-s-tooltip-dgvag2l3"> <svg aria-hidden="true" class="svg-icon iconArrowUpLg" width="36" height="36" viewBox="0 0 36 36"><path d="M2 25h32L18 9 2 25Z"></path></svg> </button><div id="--stacks-s-tooltip-dgvag2l3" class="s-popover s-popover__tooltip pe-none" aria-hidden="true" role="tooltip">This answer is useful<div class="s-popover--arrow"></div></div> <div class="js-vote-count flex--item d-flex fd-column ai-center fc-black-500 fs-title" itemprop="upvoteCount" data-value="5"> 5 </div> <button class="js-vote-down-btn flex--item s-btn s-btn__unset c-pointer " data-controller="s-tooltip" data-s-tooltip-placement="right" aria-pressed="false" aria-label="Down vote" data-selected-classes="fc-theme-primary" data-unselected-classes="" aria-describedby="--stacks-s-tooltip-gn8ppsfv"> <svg aria-hidden="true" class="svg-icon iconArrowDownLg" width="36" height="36" viewBox="0 0 36 36"><path d="M2 11h32L18 27 2 11Z"></path></svg> </button> </div> </div> <div class="answercell post-layout--right"> <div class="s-prose js-post-body" itemprop="text"> <p>Here is a variant for dynamically adding a class </p>&#xA;&#xA;<pre><code>function setClassStyle(class_name, css) {&#xA; var style_sheet = document.createElement('style');&#xA; if (style_sheet) {&#xA; style_sheet.setAttribute('type', 'text/css');&#xA; var cstr = '.' + class_name + ' {' + css + '}';&#xA; var rules = document.createTextNode(cstr);&#xA; if(style_sheet.styleSheet){// IE&#xA; style_sheet.styleSheet.cssText = rules.nodeValue;&#xA; } else {&#xA; style_sheet.appendChild(rules);&#xA; }&#xA; var head = document.getElementsByTagName('head')[0];&#xA; if (head) {&#xA; head.appendChild(style_sheet);&#xA; }&#xA; }&#xA;}&#xA;</code></pre>&#xA; </div> <div class="mt24"> <div class="user-action-time" style="color:#999;text-align:right;">于 2009-12-18T17:29:13.527 回答</div> </div> </div> </div> </div><a name="7"></a> <div id="answer-7" class="answer js-answer accepted-answer" data-answerid="7" data-parentid="4" data-score="506" data-position-on-page="1" data-highest-scored="1" data-question-has-accepted-highest-score="1" itemprop="suggestedAnswer" itemscope="" itemtype="https://schema.org/Answer"> <div class="post-layout"> <div class="votecell post-layout--left"> <div class="js-voting-container d-flex jc-center fd-column ai-stretch gs4 fc-black-200" data-post-id="7"> <button class="js-vote-up-btn flex--item s-btn s-btn__unset c-pointer " data-controller="s-tooltip" data-s-tooltip-placement="right" aria-pressed="false" aria-label="Up vote" data-selected-classes="fc-theme-primary" data-unselected-classes="" aria-describedby="--stacks-s-tooltip-dgvag2l3"> <svg aria-hidden="true" class="svg-icon iconArrowUpLg" width="36" height="36" viewBox="0 0 36 36"><path d="M2 25h32L18 9 2 25Z"></path></svg> </button><div id="--stacks-s-tooltip-dgvag2l3" class="s-popover s-popover__tooltip pe-none" aria-hidden="true" role="tooltip">This answer is useful<div class="s-popover--arrow"></div></div> <div class="js-vote-count flex--item d-flex fd-column ai-center fc-black-500 fs-title" itemprop="upvoteCount" data-value="5"> 5 </div> <button class="js-vote-down-btn flex--item s-btn s-btn__unset c-pointer " data-controller="s-tooltip" data-s-tooltip-placement="right" aria-pressed="false" aria-label="Down vote" data-selected-classes="fc-theme-primary" data-unselected-classes="" aria-describedby="--stacks-s-tooltip-gn8ppsfv"> <svg aria-hidden="true" class="svg-icon iconArrowDownLg" width="36" height="36" viewBox="0 0 36 36"><path d="M2 11h32L18 27 2 11Z"></path></svg> </button> </div> </div> <div class="answercell post-layout--right"> <div class="s-prose js-post-body" itemprop="text"> <p>This object variable will append style tag to the head tag with type attribute and one simple transition rule inside that matches every single id/class/element. Feel free to modify <strong>content</strong> property and inject as many rules as you need. Just make sure that css rules inside <strong>content</strong> remain in one line (or 'escape' each new line, if You prefer so). </p>&#xA;&#xA;<pre><code>var script = {&#xA;&#xA; type: 'text/css', style: document.createElement('style'), &#xA; content: "* { transition: all 220ms cubic-bezier(0.390, 0.575, 0.565, 1.000); }",&#xA; append: function() {&#xA;&#xA; this.style.type = this.type;&#xA; this.style.appendChild(document.createTextNode(this.content));&#xA; document.head.appendChild(this.style);&#xA;&#xA;}}; script.append();&#xA;</code></pre>&#xA; </div> <div class="mt24"> <div class="user-action-time" style="color:#999;text-align:right;">于 2015-02-16T11:00:14.710 回答</div> </div> </div> </div> </div><a name="7"></a> <div id="answer-7" class="answer js-answer accepted-answer" data-answerid="7" data-parentid="4" data-score="506" data-position-on-page="1" data-highest-scored="1" data-question-has-accepted-highest-score="1" itemprop="suggestedAnswer" itemscope="" itemtype="https://schema.org/Answer"> <div class="post-layout"> <div class="votecell post-layout--left"> <div class="js-voting-container d-flex jc-center fd-column ai-stretch gs4 fc-black-200" data-post-id="7"> <button class="js-vote-up-btn flex--item s-btn s-btn__unset c-pointer " data-controller="s-tooltip" data-s-tooltip-placement="right" aria-pressed="false" aria-label="Up vote" data-selected-classes="fc-theme-primary" data-unselected-classes="" aria-describedby="--stacks-s-tooltip-dgvag2l3"> <svg aria-hidden="true" class="svg-icon iconArrowUpLg" width="36" height="36" viewBox="0 0 36 36"><path d="M2 25h32L18 9 2 25Z"></path></svg> </button><div id="--stacks-s-tooltip-dgvag2l3" class="s-popover s-popover__tooltip pe-none" aria-hidden="true" role="tooltip">This answer is useful<div class="s-popover--arrow"></div></div> <div class="js-vote-count flex--item d-flex fd-column ai-center fc-black-500 fs-title" itemprop="upvoteCount" data-value="5"> 5 </div> <button class="js-vote-down-btn flex--item s-btn s-btn__unset c-pointer " data-controller="s-tooltip" data-s-tooltip-placement="right" aria-pressed="false" aria-label="Down vote" data-selected-classes="fc-theme-primary" data-unselected-classes="" aria-describedby="--stacks-s-tooltip-gn8ppsfv"> <svg aria-hidden="true" class="svg-icon iconArrowDownLg" width="36" height="36" viewBox="0 0 36 36"><path d="M2 11h32L18 27 2 11Z"></path></svg> </button> </div> </div> <div class="answercell post-layout--right"> <div class="s-prose js-post-body" itemprop="text"> <p>You wrote:</p>&#xA;&#xA;<pre><code>var divNode = document.createElement("div");&#xA;divNode.innerHTML = "&lt;br&gt;&lt;style&gt;h1 { background: red; }&lt;/style&gt;";&#xA;document.body.appendChild(divNode);&#xA;</code></pre>&#xA;&#xA;<p>Why not this?</p>&#xA;&#xA;<pre><code>var styleNode = document.createElement("style");&#xA;document.head.appendChild(styleNode);&#xA;</code></pre>&#xA;&#xA;<p>Henceforward you can append CSS rules easily to the HTML code:</p>&#xA;&#xA;<pre><code>styleNode.innerHTML = "h1 { background: red; }\n";&#xA;styleNode.innerHTML += "h2 { background: green; }\n";&#xA;</code></pre>&#xA;&#xA;<p>...or directly to the DOM:</p>&#xA;&#xA;<pre><code>styleNode.sheet.insertRule("h1 { background: red; }");&#xA;styleNode.sheet.insertRule("h2 { background: green; }");&#xA;</code></pre>&#xA;&#xA;<p>I expect this to work everywhere except archaic browsers.</p>&#xA;&#xA;<p>Definitely works in Chrome <strong>in year 2019.</strong></p>&#xA; </div> <div class="mt24"> <div class="user-action-time" style="color:#999;text-align:right;">于 2019-01-08T08:21:21.390 回答</div> </div> </div> </div> </div><a name="7"></a> <div id="answer-7" class="answer js-answer accepted-answer" data-answerid="7" data-parentid="4" data-score="506" data-position-on-page="1" data-highest-scored="1" data-question-has-accepted-highest-score="1" itemprop="suggestedAnswer" itemscope="" itemtype="https://schema.org/Answer"> <div class="post-layout"> <div class="votecell post-layout--left"> <div class="js-voting-container d-flex jc-center fd-column ai-stretch gs4 fc-black-200" data-post-id="7"> <button class="js-vote-up-btn flex--item s-btn s-btn__unset c-pointer " data-controller="s-tooltip" data-s-tooltip-placement="right" aria-pressed="false" aria-label="Up vote" data-selected-classes="fc-theme-primary" data-unselected-classes="" aria-describedby="--stacks-s-tooltip-dgvag2l3"> <svg aria-hidden="true" class="svg-icon iconArrowUpLg" width="36" height="36" viewBox="0 0 36 36"><path d="M2 25h32L18 9 2 25Z"></path></svg> </button><div id="--stacks-s-tooltip-dgvag2l3" class="s-popover s-popover__tooltip pe-none" aria-hidden="true" role="tooltip">This answer is useful<div class="s-popover--arrow"></div></div> <div class="js-vote-count flex--item d-flex fd-column ai-center fc-black-500 fs-title" itemprop="upvoteCount" data-value="5"> 5 </div> <button class="js-vote-down-btn flex--item s-btn s-btn__unset c-pointer " data-controller="s-tooltip" data-s-tooltip-placement="right" aria-pressed="false" aria-label="Down vote" data-selected-classes="fc-theme-primary" data-unselected-classes="" aria-describedby="--stacks-s-tooltip-gn8ppsfv"> <svg aria-hidden="true" class="svg-icon iconArrowDownLg" width="36" height="36" viewBox="0 0 36 36"><path d="M2 11h32L18 27 2 11Z"></path></svg> </button> </div> </div> <div class="answercell post-layout--right"> <div class="s-prose js-post-body" itemprop="text"> <pre class="lang-js prettyprint-override"><code>const style = document.createElement("style")&#xA;style.textContent = "h1 { background-color: red; }"&#xA;document.head.appendChild(style)&#xA;</code></pre>&#xA;<h1>The Modern &amp; Easy Way</h1>&#xA;<p>The code above is the gist of it; continue reading if you want to know the reasoning.</p>&#xA;<p>Why another answer? The accepted answer is old and includes redundant code for outdated browsers like the Internet Explorer. Other answers are unnecessarily complex or use properties like <code>.innerHTML</code> that allow for cross-site scripting attacks.</p>&#xA;<h2>The <code>type</code> property is not needed</h2>&#xA;<p>Most of the anwsers set the <code>type</code> property like so: <code>style.type = "text/css"</code>. Setting this property is not necessary unless you need to support older browsers.</p>&#xA;<p>According to <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/style" rel="noreferrer">&lt;style&gt;: The Style Information element - HTML | MDN</a>, the <code>type</code> attribute is optional and defaults to <code>text/css</code>:</p>&#xA;<blockquote>&#xA;<p><code>type</code></p>&#xA;<p>This attribute defines the styling language as a MIME type (charset should not be specified). This attribute is optional and defaults to <code>text/css</code> if it is not specified; values other than the empty string or <code>text/css</code> are not used. <strong>Note</strong>: There is very little reason to include this attribute in modern web documents.</p>&#xA;</blockquote>&#xA;<h2>Adding the CSS</h2>&#xA;<p>To add the CSS, use <a href="https://developer.mozilla.org/en-US/docs/Web/API/Node/textContent" rel="noreferrer"><code>.textContent</code></a> as it is safer and faster than alternative methods. Opposite to <a href="https://developer.mozilla.org/en-US/docs/Web/API/Element/innerHTML" rel="noreferrer"><code>.innerHTML</code></a>, it does not parse HTML and can therefore prevent <a href="https://developer.mozilla.org/en-US/docs/Glossary/Cross-site_scripting" rel="noreferrer">cross-site scripting attacks</a>.</p>&#xA;<p>Another similar property, <a href="https://developer.mozilla.org/en-US/docs/Web/API/HTMLElement/innerText" rel="noreferrer"><code>.innerText</code></a>, is like <code>.textContent</code> but takes CSS styles into account and represents only the "rendered" text content. As we are not interested in "rendered"-only content we prefer <code>.textContent</code>.</p>&#xA;<h3>What does setting <code>.textContent</code> do?</h3>&#xA;<p>Setting the <code>.textContent</code> property removes all the node's (element's) children and replaces them with the given string value.</p>&#xA;<h2>Where to place the element?</h2>&#xA;<p>The style element should be included in the head: "The <code>&lt;style&gt;</code> element must be included inside the <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/head" rel="noreferrer"><code>&lt;head&gt;</code></a> of the document. ...". [<a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/style" rel="noreferrer">&lt;style&gt; ... | MDN</a>]</p>&#xA;<p>To get the head use <code>document.head</code> as it has been <a href="https://caniuse.com/documenthead" rel="noreferrer">supported by all major browsers</a> for a long time already so there is no need for other fallbacks.</p>&#xA; </div> <div class="mt24"> <div class="user-action-time" style="color:#999;text-align:right;">于 2021-10-10T12:23:50.340 回答</div> </div> </div> </div> </div><a name="7"></a> <div id="answer-7" class="answer js-answer accepted-answer" data-answerid="7" data-parentid="4" data-score="506" data-position-on-page="1" data-highest-scored="1" data-question-has-accepted-highest-score="1" itemprop="suggestedAnswer" itemscope="" itemtype="https://schema.org/Answer"> <div class="post-layout"> <div class="votecell post-layout--left"> <div class="js-voting-container d-flex jc-center fd-column ai-stretch gs4 fc-black-200" data-post-id="7"> <button class="js-vote-up-btn flex--item s-btn s-btn__unset c-pointer " data-controller="s-tooltip" data-s-tooltip-placement="right" aria-pressed="false" aria-label="Up vote" data-selected-classes="fc-theme-primary" data-unselected-classes="" aria-describedby="--stacks-s-tooltip-dgvag2l3"> <svg aria-hidden="true" class="svg-icon iconArrowUpLg" width="36" height="36" viewBox="0 0 36 36"><path d="M2 25h32L18 9 2 25Z"></path></svg> </button><div id="--stacks-s-tooltip-dgvag2l3" class="s-popover s-popover__tooltip pe-none" aria-hidden="true" role="tooltip">This answer is useful<div class="s-popover--arrow"></div></div> <div class="js-vote-count flex--item d-flex fd-column ai-center fc-black-500 fs-title" itemprop="upvoteCount" data-value="4"> 4 </div> <button class="js-vote-down-btn flex--item s-btn s-btn__unset c-pointer " data-controller="s-tooltip" data-s-tooltip-placement="right" aria-pressed="false" aria-label="Down vote" data-selected-classes="fc-theme-primary" data-unselected-classes="" aria-describedby="--stacks-s-tooltip-gn8ppsfv"> <svg aria-hidden="true" class="svg-icon iconArrowDownLg" width="36" height="36" viewBox="0 0 36 36"><path d="M2 11h32L18 27 2 11Z"></path></svg> </button> </div> </div> <div class="answercell post-layout--right"> <div class="s-prose js-post-body" itemprop="text"> <p>All good, but for styleNode.cssText to work in IE6 with node created by javascipt, you need to append the node to the document before you set the cssText;</p>&#xA;&#xA;<p>further info @ <a href="http://msdn.microsoft.com/en-us/library/ms533698%28VS.85%29.aspx" rel="noreferrer">http://msdn.microsoft.com/en-us/library/ms533698%28VS.85%29.aspx</a></p>&#xA; </div> <div class="mt24"> <div class="user-action-time" style="color:#999;text-align:right;">于 2010-02-24T23:47:40.327 回答</div> </div> </div> </div> </div><a name="7"></a> <div id="answer-7" class="answer js-answer accepted-answer" data-answerid="7" data-parentid="4" data-score="506" data-position-on-page="1" data-highest-scored="1" data-question-has-accepted-highest-score="1" itemprop="suggestedAnswer" itemscope="" itemtype="https://schema.org/Answer"> <div class="post-layout"> <div class="votecell post-layout--left"> <div class="js-voting-container d-flex jc-center fd-column ai-stretch gs4 fc-black-200" data-post-id="7"> <button class="js-vote-up-btn flex--item s-btn s-btn__unset c-pointer " data-controller="s-tooltip" data-s-tooltip-placement="right" aria-pressed="false" aria-label="Up vote" data-selected-classes="fc-theme-primary" data-unselected-classes="" aria-describedby="--stacks-s-tooltip-dgvag2l3"> <svg aria-hidden="true" class="svg-icon iconArrowUpLg" width="36" height="36" viewBox="0 0 36 36"><path d="M2 25h32L18 9 2 25Z"></path></svg> </button><div id="--stacks-s-tooltip-dgvag2l3" class="s-popover s-popover__tooltip pe-none" aria-hidden="true" role="tooltip">This answer is useful<div class="s-popover--arrow"></div></div> <div class="js-vote-count flex--item d-flex fd-column ai-center fc-black-500 fs-title" itemprop="upvoteCount" data-value="4"> 4 </div> <button class="js-vote-down-btn flex--item s-btn s-btn__unset c-pointer " data-controller="s-tooltip" data-s-tooltip-placement="right" aria-pressed="false" aria-label="Down vote" data-selected-classes="fc-theme-primary" data-unselected-classes="" aria-describedby="--stacks-s-tooltip-gn8ppsfv"> <svg aria-hidden="true" class="svg-icon iconArrowDownLg" width="36" height="36" viewBox="0 0 36 36"><path d="M2 11h32L18 27 2 11Z"></path></svg> </button> </div> </div> <div class="answercell post-layout--right"> <div class="s-prose js-post-body" itemprop="text"> <p>This function will inject css whenever you call the function <code>appendStyle</code> like this:<br>&#xA;<code>appendStyle('css you want to inject')</code></p>&#xA;&#xA;<p>This works by injecting a <code>style</code> node into the head of the document. This is a similar technique to what is commonly used to lazy-load JavaScript.&#xA;It works consistently in most modern browsers.</p>&#xA;&#xA;<p><div class="snippet" data-lang="js" data-hide="false" data-console="false" data-babel="false">&#xD;&#xA;<div class="snippet-code">&#xD;&#xA;<pre class="snippet-code-js lang-js prettyprint-override"><code>appendStyle = function (content) {&#xD;&#xA; style = document.createElement('STYLE');&#xD;&#xA; style.type = 'text/css';&#xD;&#xA; style.appendChild(document.createTextNode(content));&#xD;&#xA; document.head.appendChild(style);&#xD;&#xA;}</code></pre>&#xD;&#xA;<pre class="snippet-code-html lang-html prettyprint-override"><code>&lt;!DOCTYPE html&gt;&#xD;&#xA;&lt;html lang="en"&gt;&#xD;&#xA;&#xD;&#xA;&lt;head&gt;&#xD;&#xA; &lt;meta charset="UTF-8"&gt;&#xD;&#xA; &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;&#xD;&#xA;&lt;/head&gt;&#xD;&#xA;&lt;body&gt;&#xD;&#xA; &lt;h1&gt;Lorem Ipsum&lt;/h1&gt;&#xD;&#xA; &lt;p&gt;dolar sit amet&lt;/p&gt;&#xD;&#xA; &lt;button onclick='appendStyle("body { background-color: #ff0000;}h1 { font-family: Helvetica, sans-serif; font-variant: small-caps; letter-spacing: 3px; color: #ff0000; background-color: #000000;}p { font-family: Georgia, serif; font-size: 14px; font-style: normal; font-weight: normal; color: #000000; background-color: #ffff00;}")'&gt;Press me to inject CSS!&lt;/button&gt;&#xD;&#xA;&lt;/body&gt;&#xD;&#xA;&#xD;&#xA;&lt;/html&gt;</code></pre>&#xD;&#xA;</div>&#xD;&#xA;</div>&#xD;&#xA;</p>&#xA;&#xA;<p>You can also lazy-load external CSS files by using the following snippet:</p>&#xA;&#xA;<p><div class="snippet" data-lang="js" data-hide="false" data-console="true" data-babel="false">&#xD;&#xA;<div class="snippet-code">&#xD;&#xA;<pre class="snippet-code-js lang-js prettyprint-override"><code>appendExternalStyle = function (content) {&#xD;&#xA; link = document.createElement('LINK');&#xD;&#xA; link.rel = 'stylesheet';&#xD;&#xA; link.href = content;&#xD;&#xA; link.type = 'text/css';&#xD;&#xA; document.head.appendChild(link);&#xD;&#xA;}</code></pre>&#xD;&#xA;<pre class="snippet-code-html lang-html prettyprint-override"><code>&lt;!DOCTYPE html&gt;&#xD;&#xA;&lt;html lang="en"&gt;&#xD;&#xA;&#xD;&#xA;&lt;head&gt;&#xD;&#xA; &lt;meta charset="UTF-8"&gt;&#xD;&#xA; &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;&#xD;&#xA; &lt;style&gt;&#xD;&#xA; html {&#xD;&#xA; font-family: sans-serif;&#xD;&#xA; font-display: swap;&#xD;&#xA; }&#xD;&#xA; &lt;/style&gt;&#xD;&#xA;&lt;/head&gt;&#xD;&#xA;&#xD;&#xA;&lt;body&gt;&#xD;&#xA;&#xD;&#xA; &lt;h1&gt;Lorem Ipsum&lt;/h1&gt;&#xD;&#xA; &lt;p&gt;dolar sit amet&lt;/p&gt;&#xD;&#xA; &lt;button onclick='appendExternalStyle("data:text/css;base64,OjotbW96LXNlbGVjdGlvbntjb2xvcjojZmZmIWltcG9ydGFudDtiYWNrZ3JvdW5kOiMwMDB9OjpzZWxlY3Rpb257Y29sb3I6I2ZmZiFpbXBvcnRhbnQ7YmFja2dyb3VuZDojMDAwfWgxe2ZvbnQtc2l6ZToyZW19Ym9keSxodG1se2NvbG9yOnJnYmEoMCwwLDAsLjc1KTtmb250LXNpemU6MTZweDtmb250LWZhbWlseTpMYXRvLEhlbHZldGljYSBOZXVlLEhlbHZldGljYSxzYW5zLXNlcmlmO2xpbmUtaGVpZ2h0OjEuNjd9YnV0dG9uLGlucHV0e292ZXJmbG93OnZpc2libGV9YnV0dG9uLHNlbGVjdHstd2Via2l0LXRyYW5zaXRpb24tZHVyYXRpb246LjFzO3RyYW5zaXRpb24tZHVyYXRpb246LjFzfQ==")'&gt;press me to inject css!&lt;/button&gt;&#xD;&#xA;&lt;/body&gt;&#xD;&#xA;&#xD;&#xA;&lt;/html&gt;</code></pre>&#xD;&#xA;</div>&#xD;&#xA;</div>&#xD;&#xA;</p>&#xA; </div> <div class="mt24"> <div class="user-action-time" style="color:#999;text-align:right;">于 2018-05-29T17:06:57.310 回答</div> </div> </div> </div> </div><a name="7"></a> <div id="answer-7" class="answer js-answer accepted-answer" data-answerid="7" data-parentid="4" data-score="506" data-position-on-page="1" data-highest-scored="1" data-question-has-accepted-highest-score="1" itemprop="suggestedAnswer" itemscope="" itemtype="https://schema.org/Answer"> <div class="post-layout"> <div class="votecell post-layout--left"> <div class="js-voting-container d-flex jc-center fd-column ai-stretch gs4 fc-black-200" data-post-id="7"> <button class="js-vote-up-btn flex--item s-btn s-btn__unset c-pointer " data-controller="s-tooltip" data-s-tooltip-placement="right" aria-pressed="false" aria-label="Up vote" data-selected-classes="fc-theme-primary" data-unselected-classes="" aria-describedby="--stacks-s-tooltip-dgvag2l3"> <svg aria-hidden="true" class="svg-icon iconArrowUpLg" width="36" height="36" viewBox="0 0 36 36"><path d="M2 25h32L18 9 2 25Z"></path></svg> </button><div id="--stacks-s-tooltip-dgvag2l3" class="s-popover s-popover__tooltip pe-none" aria-hidden="true" role="tooltip">This answer is useful<div class="s-popover--arrow"></div></div> <div class="js-vote-count flex--item d-flex fd-column ai-center fc-black-500 fs-title" itemprop="upvoteCount" data-value="2"> 2 </div> <button class="js-vote-down-btn flex--item s-btn s-btn__unset c-pointer " data-controller="s-tooltip" data-s-tooltip-placement="right" aria-pressed="false" aria-label="Down vote" data-selected-classes="fc-theme-primary" data-unselected-classes="" aria-describedby="--stacks-s-tooltip-gn8ppsfv"> <svg aria-hidden="true" class="svg-icon iconArrowDownLg" width="36" height="36" viewBox="0 0 36 36"><path d="M2 11h32L18 27 2 11Z"></path></svg> </button> </div> </div> <div class="answercell post-layout--right"> <div class="s-prose js-post-body" itemprop="text"> <p>as i know there are 4 ways to do that.</p>&#xA;<pre><code>var style= document.createElement("style");&#xA;(document.head || document.documentElement).appendChild(style);&#xA;var rule=':visited { color: rgb(233, 106, 106) !important;}';&#xA;&#xA;//no 1&#xA;style.innerHTML = rule;&#xA;//no 2&#xA;style.appendChild(document.createTextNode(rule));&#xA;&#xA;//no 3 limited with one group&#xA;style.sheet.insertRule(rule);&#xA;//no 4 limited too&#xA;document.styleSheets[0].insertRule('strong { color: red; }');&#xA;&#xA;//addon&#xA;style.sheet.cssRules //list all style&#xA;stylesheet.deleteRule(0) //delete first rule&#xA;&#xA;</code></pre>&#xA; </div> <div class="mt24"> <div class="user-action-time" style="color:#999;text-align:right;">于 2020-10-09T17:42:52.987 回答</div> </div> </div> </div> </div><a name="7"></a> <div id="answer-7" class="answer js-answer accepted-answer" data-answerid="7" data-parentid="4" data-score="506" data-position-on-page="1" data-highest-scored="1" data-question-has-accepted-highest-score="1" itemprop="suggestedAnswer" itemscope="" itemtype="https://schema.org/Answer"> <div class="post-layout"> <div class="votecell post-layout--left"> <div class="js-voting-container d-flex jc-center fd-column ai-stretch gs4 fc-black-200" data-post-id="7"> <button class="js-vote-up-btn flex--item s-btn s-btn__unset c-pointer " data-controller="s-tooltip" data-s-tooltip-placement="right" aria-pressed="false" aria-label="Up vote" data-selected-classes="fc-theme-primary" data-unselected-classes="" aria-describedby="--stacks-s-tooltip-dgvag2l3"> <svg aria-hidden="true" class="svg-icon iconArrowUpLg" width="36" height="36" viewBox="0 0 36 36"><path d="M2 25h32L18 9 2 25Z"></path></svg> </button><div id="--stacks-s-tooltip-dgvag2l3" class="s-popover s-popover__tooltip pe-none" aria-hidden="true" role="tooltip">This answer is useful<div class="s-popover--arrow"></div></div> <div class="js-vote-count flex--item d-flex fd-column ai-center fc-black-500 fs-title" itemprop="upvoteCount" data-value="1"> 1 </div> <button class="js-vote-down-btn flex--item s-btn s-btn__unset c-pointer " data-controller="s-tooltip" data-s-tooltip-placement="right" aria-pressed="false" aria-label="Down vote" data-selected-classes="fc-theme-primary" data-unselected-classes="" aria-describedby="--stacks-s-tooltip-gn8ppsfv"> <svg aria-hidden="true" class="svg-icon iconArrowDownLg" width="36" height="36" viewBox="0 0 36 36"><path d="M2 11h32L18 27 2 11Z"></path></svg> </button> </div> </div> <div class="answercell post-layout--right"> <div class="s-prose js-post-body" itemprop="text"> <p>If the problem you're facing is injecting a string of CSS into a page it is easier to do this with the <code>&lt;link&gt;</code> element than the <code>&lt;style&gt;</code> element.</p>&#xA;&#xA;<p>The following adds <code>p { color: green; }</code> rule to the page.</p>&#xA;&#xA;<pre><code>&lt;link rel="stylesheet" type="text/css" href="data:text/css;charset=UTF-8,p%20%7B%20color%3A%20green%3B%20%7D" /&gt;&#xA;</code></pre>&#xA;&#xA;<p>You can create this in JavaScript simply by URL encoding your string of CSS and adding it the <code>HREF</code> attribute. Much simpler than all the quirks of <code>&lt;style&gt;</code> elements or directly accessing stylesheets.</p>&#xA;&#xA;<pre><code>let linkElement: HTMLLinkElement = this.document.createElement('link');&#xA;linkElement.setAttribute('rel', 'stylesheet');&#xA;linkElement.setAttribute('type', 'text/css');&#xA;linkElement.setAttribute('href', 'data:text/css;charset=UTF-8,' + encodeURIComponent(myStringOfstyles));&#xA;</code></pre>&#xA;&#xA;<p>This will work in IE 5.5 upwards</p>&#xA; </div> <div class="mt24"> <div class="user-action-time" style="color:#999;text-align:right;">于 2018-04-19T11:22:55.190 回答</div> </div> </div> </div> </div><a name="7"></a> <div id="answer-7" class="answer js-answer accepted-answer" data-answerid="7" data-parentid="4" data-score="506" data-position-on-page="1" data-highest-scored="1" data-question-has-accepted-highest-score="1" itemprop="suggestedAnswer" itemscope="" itemtype="https://schema.org/Answer"> <div class="post-layout"> <div class="votecell post-layout--left"> <div class="js-voting-container d-flex jc-center fd-column ai-stretch gs4 fc-black-200" data-post-id="7"> <button class="js-vote-up-btn flex--item s-btn s-btn__unset c-pointer " data-controller="s-tooltip" data-s-tooltip-placement="right" aria-pressed="false" aria-label="Up vote" data-selected-classes="fc-theme-primary" data-unselected-classes="" aria-describedby="--stacks-s-tooltip-dgvag2l3"> <svg aria-hidden="true" class="svg-icon iconArrowUpLg" width="36" height="36" viewBox="0 0 36 36"><path d="M2 25h32L18 9 2 25Z"></path></svg> </button><div id="--stacks-s-tooltip-dgvag2l3" class="s-popover s-popover__tooltip pe-none" aria-hidden="true" role="tooltip">This answer is useful<div class="s-popover--arrow"></div></div> <div class="js-vote-count flex--item d-flex fd-column ai-center fc-black-500 fs-title" itemprop="upvoteCount" data-value="0"> 0 </div> <button class="js-vote-down-btn flex--item s-btn s-btn__unset c-pointer " data-controller="s-tooltip" data-s-tooltip-placement="right" aria-pressed="false" aria-label="Down vote" data-selected-classes="fc-theme-primary" data-unselected-classes="" aria-describedby="--stacks-s-tooltip-gn8ppsfv"> <svg aria-hidden="true" class="svg-icon iconArrowDownLg" width="36" height="36" viewBox="0 0 36 36"><path d="M2 11h32L18 27 2 11Z"></path></svg> </button> </div> </div> <div class="answercell post-layout--right"> <div class="s-prose js-post-body" itemprop="text"> <p>Anyone who is looking for Typescript version,</p>&#xA;<pre><code>const addStyles = (styles) =&gt; {&#xA; let styleNode : HTMLStyleElement = document.createElement('style'); &#xA; styleNode.type = 'text/css'; &#xA; if (styleNode.style) &#xA; styleNode.style.cssText = styles; &#xA; else &#xA; styleNode.appendChild(document.createTextNode(styles)); &#xA; &#xA; /* Append style to the head element */ &#xA; document.head.appendChild(styleNode); &#xA;}&#xA;</code></pre>&#xA;<p>Also, in react/vue/angular if direct injection of CSS is needed, you can use <strong>posstcss-js</strong> to convert CSS into JSS and use <strong>CSS-in-JSS</strong> to inject a new styleSheet directly. For more info, please follow this <a href="https://cssinjs.org/react-jss/?v=v10.5.1" rel="nofollow noreferrer">documentation</a>.</p>&#xA;<p><strong>Update</strong></p>&#xA;<p>You can use <code>document.head</code> as well as per @Brandon McConnell's comment.</p>&#xA; </div> <div class="mt24"> <div class="user-action-time" style="color:#999;text-align:right;">于 2021-03-02T15:55:41.423 回答</div> </div> </div> </div> </div><a name="7"></a> <div id="answer-7" class="answer js-answer accepted-answer" data-answerid="7" data-parentid="4" data-score="506" data-position-on-page="1" data-highest-scored="1" data-question-has-accepted-highest-score="1" itemprop="suggestedAnswer" itemscope="" itemtype="https://schema.org/Answer"> <div class="post-layout"> <div class="votecell post-layout--left"> <div class="js-voting-container d-flex jc-center fd-column ai-stretch gs4 fc-black-200" data-post-id="7"> <button class="js-vote-up-btn flex--item s-btn s-btn__unset c-pointer " data-controller="s-tooltip" data-s-tooltip-placement="right" aria-pressed="false" aria-label="Up vote" data-selected-classes="fc-theme-primary" data-unselected-classes="" aria-describedby="--stacks-s-tooltip-dgvag2l3"> <svg aria-hidden="true" class="svg-icon iconArrowUpLg" width="36" height="36" viewBox="0 0 36 36"><path d="M2 25h32L18 9 2 25Z"></path></svg> </button><div id="--stacks-s-tooltip-dgvag2l3" class="s-popover s-popover__tooltip pe-none" aria-hidden="true" role="tooltip">This answer is useful<div class="s-popover--arrow"></div></div> <div class="js-vote-count flex--item d-flex fd-column ai-center fc-black-500 fs-title" itemprop="upvoteCount" data-value="0"> 0 </div> <button class="js-vote-down-btn flex--item s-btn s-btn__unset c-pointer " data-controller="s-tooltip" data-s-tooltip-placement="right" aria-pressed="false" aria-label="Down vote" data-selected-classes="fc-theme-primary" data-unselected-classes="" aria-describedby="--stacks-s-tooltip-gn8ppsfv"> <svg aria-hidden="true" class="svg-icon iconArrowDownLg" width="36" height="36" viewBox="0 0 36 36"><path d="M2 11h32L18 27 2 11Z"></path></svg> </button> </div> </div> <div class="answercell post-layout--right"> <div class="s-prose js-post-body" itemprop="text"> <p>The most trival answer:</p>&#xA;<pre><code>function addStyle (styleText) {&#xA; const styleNode = document.createElement('style'); &#xA; styleNode.type = 'text/css'; &#xA; styleNode.textContent = styleText;&#xA; document.documentElement.appendChild(styleNode); &#xA; return styleNode;&#xA;}&#xA;</code></pre>&#xA; </div> <div class="mt24"> <div class="user-action-time" style="color:#999;text-align:right;">于 2021-06-24T11:15:58.257 回答</div> </div> </div> </div> </div><a name="7"></a> <div id="answer-7" class="answer js-answer accepted-answer" data-answerid="7" data-parentid="4" data-score="506" data-position-on-page="1" data-highest-scored="1" data-question-has-accepted-highest-score="1" itemprop="suggestedAnswer" itemscope="" itemtype="https://schema.org/Answer"> <div class="post-layout"> <div class="votecell post-layout--left"> <div class="js-voting-container d-flex jc-center fd-column ai-stretch gs4 fc-black-200" data-post-id="7"> <button class="js-vote-up-btn flex--item s-btn s-btn__unset c-pointer " data-controller="s-tooltip" data-s-tooltip-placement="right" aria-pressed="false" aria-label="Up vote" data-selected-classes="fc-theme-primary" data-unselected-classes="" aria-describedby="--stacks-s-tooltip-dgvag2l3"> <svg aria-hidden="true" class="svg-icon iconArrowUpLg" width="36" height="36" viewBox="0 0 36 36"><path d="M2 25h32L18 9 2 25Z"></path></svg> </button><div id="--stacks-s-tooltip-dgvag2l3" class="s-popover s-popover__tooltip pe-none" aria-hidden="true" role="tooltip">This answer is useful<div class="s-popover--arrow"></div></div> <div class="js-vote-count flex--item d-flex fd-column ai-center fc-black-500 fs-title" itemprop="upvoteCount" data-value="-3"> -3 </div> <button class="js-vote-down-btn flex--item s-btn s-btn__unset c-pointer " data-controller="s-tooltip" data-s-tooltip-placement="right" aria-pressed="false" aria-label="Down vote" data-selected-classes="fc-theme-primary" data-unselected-classes="" aria-describedby="--stacks-s-tooltip-gn8ppsfv"> <svg aria-hidden="true" class="svg-icon iconArrowDownLg" width="36" height="36" viewBox="0 0 36 36"><path d="M2 11h32L18 27 2 11Z"></path></svg> </button> </div> </div> <div class="answercell post-layout--right"> <div class="s-prose js-post-body" itemprop="text"> <pre><code>this link may helpful to you: &#xA;</code></pre>&#xA;&#xA;<p><a href="http://jonraasch.com/blog/javascript-style-node" rel="nofollow noreferrer">http://jonraasch.com/blog/javascript-style-node</a></p>&#xA; </div> <div class="mt24"> <div class="user-action-time" style="color:#999;text-align:right;">于 2019-07-15T08:48:45.147 回答</div> </div> </div> </div> </div></div> </div> <div id="sidebar" class="show-votes" role="complementary" aria-label="sidebar"> <div class="module sidebar-related"> <h4 id="h-related">Related</h4> <div class="related js-gps-related-questions" data-tracker="rq=1"> <div class="spacer"> <a href="/questions/18930929" title="Question score (upvotes - downvotes)"> <div class="answer-votes large">1</div> </a> <a href="/questions/18930929" class="question-hyperlink">html - 基础块网格中图像的中间垂直对齐</a> </div><div class="spacer"> <a href="/questions/18930932" title="Question score (upvotes - downvotes)"> <div class="answer-votes large">1</div> </a> <a href="/questions/18930932" class="question-hyperlink">treeview - 如何使用 AutoIt 单击 Windows 开始菜单中的项目？</a> </div><div class="spacer"> <a href="/questions/18930935" title="Question score (upvotes - downvotes)"> <div class="answer-votes large">3</div> </a> <a href="/questions/18930935" class="question-hyperlink">javascript - 需要 js 正则表达式</a> </div><div class="spacer"> <a href="/questions/18930941" title="Question score (upvotes - downvotes)"> <div class="answer-votes large">4</div> </a> <a href="/questions/18930941" class="question-hyperlink">java - 根据自己的规则对 TreeMap 进行排序</a> </div><div class="spacer"> <a href="/questions/18930945" title="Question score (upvotes - downvotes)"> <div class="answer-votes large">1</div> </a> <a href="/questions/18930945" class="question-hyperlink">android - Android ViewPager setOnTouchListener</a> </div><div class="spacer"> <a href="/questions/18930947" title="Question score (upvotes - downvotes)"> <div class="answer-votes large">2</div> </a> <a href="/questions/18930947" class="question-hyperlink">zend-framework2 - Zend Framework 2 如何在视图脚本中获取单个单选按钮？</a> </div><div class="spacer"> <a href="/questions/18930955" title="Question score (upvotes - downvotes)"> <div class="answer-votes large">1</div> </a> <a href="/questions/18930955" class="question-hyperlink">asp.net - 运算符 == 在 asp.net 中的 gridview 行绑定事件中出现错误</a> </div><div class="spacer"> <a href="/questions/18930957" title="Question score (upvotes - downvotes)"> <div class="answer-votes large">1</div> </a> <a href="/questions/18930957" class="question-hyperlink">jquery - 在 onSelect 函数中提交表单后关注所选日期</a> </div><div class="spacer"> <a href="/questions/18930960" title="Question score (upvotes - downvotes)"> <div class="answer-votes large">1</div> </a> <a href="/questions/18930960" class="question-hyperlink">c# - CloudFilesProvider UpdateObjectMetadata 问题</a> </div><div class="spacer"> <a href="/questions/18930968" title="Question score (upvotes - downvotes)"> <div class="answer-votes large">2</div> </a> <a href="/questions/18930968" class="question-hyperlink">memory - 如何使用 Xmx JVM 选项节省内存使用</a> </div> </div> </div> <div class="module js-gps-related-tags" id="related-tags"> <h4 id="h-related-tags">Reference</h4> <div data-name="javascript"> <a href="https://php.github.net.cn" class="post-tag no-tag-menu js-gps-track" target="_blank">php</a>&nbsp;<span class="item-multiplier"><span class="item-multiplier-x">×</span>&nbsp;<span class="item-multiplier-count">1429865</span> </span> </div> <div data-name="javascript"> <a href="https://c-cpp.com" class="post-tag no-tag-menu js-gps-track" target="_blank">c/c++</a>&nbsp;<span class="item-multiplier"><span class="item-multiplier-x">×</span>&nbsp;<span class="item-multiplier-count">756500</span> </span> </div> <div data-name="javascript"> <a href="https://nginx.github.net.cn" class="post-tag no-tag-menu js-gps-track" target="_blank">nginx</a>&nbsp;<span class="item-multiplier"><span class="item-multiplier-x">×</span>&nbsp;<span class="item-multiplier-count">49975</span> </span> </div> <div data-name="javascript"> <a href="https://mongodb.net.cn" class="post-tag no-tag-menu js-gps-track" target="_blank">mongodb</a>&nbsp;<span class="item-multiplier"><span class="item-multiplier-x">×</span>&nbsp;<span class="item-multiplier-count">159057</span> </span> </div> <div data-name="javascript"> <a href="https://mybatis.net.cn" class="post-tag no-tag-menu js-gps-track" target="_blank">mybatis</a>&nbsp;<span class="item-multiplier"><span class="item-multiplier-x">×</span>&nbsp;<span class="item-multiplier-count">3233</span> </span> </div> <div data-name="javascript"> <a href="https://anaconda.org.cn" class="post-tag no-tag-menu js-gps-track" target="_blank">anaconda</a>&nbsp;<span class="item-multiplier"><span class="item-multiplier-x">×</span>&nbsp;<span class="item-multiplier-count">13410</span> </span> </div> <div data-name="javascript"> <a href="https://pycharm.net.cn" class="post-tag no-tag-menu js-gps-track" target="_blank">pycharm</a>&nbsp;<span class="item-multiplier"><span class="item-multiplier-x">×</span>&nbsp;<span class="item-multiplier-count">14671</span> </span> </div> <div data-name="javascript"> <a href="https://python.github.net.cn" class="post-tag no-tag-menu js-gps-track" target="_blank">python</a>&nbsp;<span class="item-multiplier"><span class="item-multiplier-x">×</span>&nbsp;<span class="item-multiplier-count">1902243</span> </span> </div> <div data-name="javascript"> <a href="https://vscode.github.net.cn" class="post-tag no-tag-menu js-gps-track" target="_blank">vscode</a>&nbsp;<span class="item-multiplier"><span class="item-multiplier-x">×</span>&nbsp;<span class="item-multiplier-count">56040</span> </span> </div> <div data-name="javascript"> <a href="https://dockerdocs.cn" class="post-tag no-tag-menu js-gps-track" target="_blank">docker</a>&nbsp;<span class="item-multiplier"><span class="item-multiplier-x">×</span>&nbsp;<span class="item-multiplier-count">110988</span> </span> </div> <div data-name="javascript"> <a href="https://github.net.cn" class="post-tag no-tag-menu js-gps-track" target="_blank">github</a>&nbsp;<span class="item-multiplier"><span class="item-multiplier-x">×</span>&nbsp;<span class="item-multiplier-count">49000</span> </span> </div> <div data-name="javascript"> <a href="https://flask.github.net.cn" class="post-tag no-tag-menu js-gps-track" target="_blank">flask</a>&nbsp;<span class="item-multiplier"><span class="item-multiplier-x">×</span>&nbsp;<span class="item-multiplier-count">49129</span> </span> </div> <div data-name="javascript"> <a href="https://ffmpeg.github.net.cn" class="post-tag no-tag-menu js-gps-track" target="_blank">ffmpeg</a>&nbsp;<span class="item-multiplier"><span class="item-multiplier-x">×</span>&nbsp;<span class="item-multiplier-count">24037</span> </span> </div> <div data-name="javascript"> <a href="https://jmeter.net" class="post-tag no-tag-menu js-gps-track" target="_blank">jmeter</a>&nbsp;<span class="item-multiplier"><span class="item-multiplier-x">×</span>&nbsp;<span class="item-multiplier-count">16910</span> </span> </div> <div data-name="javascript"> <a href="https://matplotlib.net" class="post-tag no-tag-menu js-gps-track" target="_blank">matplotlib</a>&nbsp;<span class="item-multiplier"><span class="item-multiplier-x">×</span>&nbsp;<span class="item-multiplier-count">63493</span> </span> </div> <div data-name="javascript"> <a href="https://getbootstrap.net" class="post-tag no-tag-menu js-gps-track" target="_blank">bootstrap</a>&nbsp;<span class="item-multiplier"><span class="item-multiplier-x">×</span>&nbsp;<span class="item-multiplier-count">54641</span> </span> </div> </div> </div> </div> </div> </div> </div> <footer id="footer" class="site-footer js-footer" role="contentinfo"> <div class="site-footer--container"> <div class="site-footer--logo"> <a href="https://stackoverflow.com"><svg aria-hidden="true" class="native svg-icon iconLogoGlyphMd" width="32" height="37" viewBox="0 0 32 37"><path d="M26 33v-9h4v13H0V24h4v9h22Z" fill="#BCBBBB"/><path d="m21.5 0-2.7 2 9.9 13.3 2.7-2L21.5 0ZM26 18.4 13.3 7.8l2.1-2.5 12.7 10.6-2.1 2.5ZM9.1 15.2l15 7 1.4-3-15-7-1.4 3Zm14 10.79.68-2.95-16.1-3.35L7 23l16.1 2.99ZM23 30H7v-3h16v3Z" fill="#F48024"/></svg></a> </div> <nav class="site-footer--nav"> <div class="site-footer--col"> <h5 class="-title"><a href="https://stackoverflow.org.cn" class="js-gps-track" data-gps-track="footer.click({ location: 3, link: 15})">Stack Overflow 中文网</a></h5> <p>遵从 CC BY-SA 知识共享许可协议。</p> </div> </nav> </div> </footer> <script> var _hmt = _hmt || []; (function() { var hm = document.createElement("script"); hm.src = "https://hm.baidu.com/hm.js?709ff2ad9744e86b5b0eee677fc13ede"; var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s); })(); </script> <!-- Google tag (gtag.js) --> <script async src="https://www.googletagmanager.com/gtag/js?id=G-1MW5BV8G8E"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-1MW5BV8G8E'); </script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6117966252207595" crossorigin="anonymous"></script> </body> </html>

> ID：524696
> 
> 赞同：
> 
> 时间：
> 
> 标签：

None

# c - 为什么 printf() 为大整数输出 -1？

> ID：524698
> 
> 赞同：4
> 
> 时间：2009-02-07T22:13:12.927
> 
> 标签：c

我正在阅读 K&R 书的第二版，其中一个练习需要打印limits.h 标头中定义的所有最大整数值。然而，这...

```
printf("unsigned int: 0 to %d\n", UINT_MAX); 
```

...输出以下内容：

```
unsigned int: 0 to -1 
```

我怎么会得到-1？任何人都可以解释这种行为吗？

我在 Vista 上使用 Digital Mars C 编译器。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-02-07T22:18:48.500

这是因为如果将 UINT_MAX 视为有符号整数，则它会解析为 -1。原因是整数用[二进制补码](http://en.wikipedia.org/wiki/Two%27s_complement)表示。因此，-1 和 4294967296（即 UINT_MAX）具有相同的位表示（0xFFFFFFFF，即所有位设置），这就是您在这里得到 -1 的原因。

**更新：**
如果您使用“%u”作为格式字符串，您将获得预期的结果。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-02-07T22:16:49.863

在 printf 中，我相信 %d 是有符号十进制整数，请尝试 %u 代替。

unsigned int 的最大值设置了最高有效位（全为 1）。对于有符号整数，最高有效位指定负数，因此当您将无符号整数打印为有符号整数时，printf 认为它是负数。

# mysql - 在 MySQL 中显示来自多个数据库的数据和计数

> ID：524700
> 
> 赞同：0
> 
> 时间：2009-02-07T22:13:43.503
> 
> 标签：mysql, database

我有两张桌子，以某种方式加入。我花了最后一个小时在谷歌上搜索，没有找到任何对我有用的具体答案。

情况是，表 1 称为 Clients，表 2 称为 Projects。我需要列出所有客户名称，然后是与该项目相关的项目数量和项目名称。

例如：

客户 1（2 个项目）
- 项目 1 标题
- 项目 2 标题

客户 2 (0 个项目)

客户 3（1 个项目）
- 项目 1 标题

这是如何以最简单和最简单的方式实现的？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-07T22:18:06.567

您没有对您的应用发表任何评论，但我建议将查询与显示分开。让 SQL 为您获取数据，然后让其他东西进行演示。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-08T23:44:49.627

您的查询基本上分为三个部分。

1.  加入表格
2.  按项目分组输出
3.  计算每个客户的项目

第一个很容易。它涉及在每个表中查找客户端 ID 字段并使用一个`JOIN`子句指定要关联的两列（每个表中的一个）。这将为每个项目提供一行，其中还包含匹配客户端的信息。这几乎就是你所要求的。

将第二个和第三个放在一个查询中而不是我推荐的查询中是很棘手的。如果您要将其放入程序中，那么您可以轻松地对查询结果进行后处理。为此，您需要添加一个`ORDER BY`子句来指定按客户端排序。这会将每个客户的所有项目放在后续行中。

现在您可以编写一个循环来处理输出。正如它所做的那样，它必须注意两件事：

1.  当客户端 ID 更改时
2.  计算项目

通过这样做，它可以轻松地为每个客户显示“组标题”，并为项目数量显示“组页脚”。

# visual-studio - Microsoft Visual Studio 许可证

> ID：524702
> 
> 赞同：2
> 
> 时间：2009-02-07T22:15:09.227
> 
> 标签：visual-studio, winforms, licensing, vendors

我在工作场所的 Microsoft Visual Studio 2008 Professional Edition 中为自己开发了一个小型 winforms 应用程序，Visual Studio 已授权给我工作的公司。

如果我想出售该应用程序，我的许可选项有哪些？

编辑：
这里的问题不是我与雇主的关系（代码是在下班后编写的，我们有一个理解），而是我与微软的关系。
前任。如果我继续在 Visual Studio Express 中开发，我可以保留我的旧代码吗？有没有办法验证某些程序集是否是使用 Visual Studio Professional 编写的？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-02-07T22:18:28.690

我想说这更多地取决于您与雇主的合同，而不是 Visual Studio 本身的许可。如果它是经过适当许可的副本，那么问题完全在于您的雇主。

许多开发人员的合同确实规定，在工作期间或在雇主的设备上，甚至在受雇期间的任何时间编写的任何代码都属于雇主。

如果不是这样，我会下载 Visual Studio Express 的副本，并在您自己的系统上进行任何进一步的开发，只是为了保护自己。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-02-07T22:17:58.317

我不是律师，但一般来说，如果你在工作中开发一些东西，使用你雇主的工具，那么他们拥有它，而不是你。

如果您有“理解”，请以书面形式获得。如果您的产品证明是赚钱的，那么您会很高兴自己做到了。

至于 Visual Studio，您应该可以使用您选择的任何许可证分发应用程序。如果您想继续在家开发，请将其移至 Express（您可以保留您的代码，但可能必须处理 Express 中较低级别的功能）或购买 Pro 许可证。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-02-07T23:05:01.527

我很难看到这里的问题是什么。假设您的雇主拥有经过适当许可的 Visual Studio 副本，他们有权让您将其用于他们选择的任何目的。他们是否允许您将公司资源用于您自己的项目，这与 Microsoft 无关。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-02-08T22:26:33.043

您在安装 Visual Studio 时同意的 EULA 非常明确。您不仅拥有使用 VS 开发的代码的权利，还*需要*明确声明对代码的版权。

您应该查看的一个文件是 redist.txt，它被复制到安装目录。它列出了您可以自由重新分发的 Microsoft 拥有的文件。所有必需品都在那里，例如 .NET 框架。不在该列表中的任何内容都不是您可以使用的。

EULA 中有一个特定的排除条款，您不得开发可用于让您的客户付费访问 Internet 资源的产品。有点奇怪的排除，我认为这是为了抑制 MSFT 无法控制的业务部门的竞争。

最后，正如其他人所暗示的那样，与雇主的“理解”意味着在关键时刻蹲下。仔细查看您签署的员工合同。自从我上次看到没有声称拥有下班后工作的所有权以来已经有一段时间了。以及协议结束一定时期后制作的“相关”作品。知识产权很大，你的大脑很紧张。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-02-07T22:38:30.693

Microsoft 的~~DreamSpark ( [https://www.dreamspark.com/default.aspx](https://www.dreamspark.com/default.aspx) )~~程序可能是一个不错的选择。基本上是免费的三年 MSDN 订阅（有一些关于构建实际产品的要求等 - 听起来很完美）

编辑：它是“BizSpark”： http: [//www.microsoft.com/BizSpark/](http://www.microsoft.com/BizSpark/)

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-02-07T22:19:07.313

尝试该项目是否在 Visual Studio Express Edition 中工作。确实如此，问题就解决了。如果不是，则返回步骤 1。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-02-07T22:59:28.683

不了解字节码本身，但首先检查程序集文件属性。在我的 vista 框中，我右键单击 -> 属性，然后选择详细信息选项卡。然后运行 ​​ILDASM 并检查程序集的属性。

还要仔细检查特快版上的 EULA，网页指定它针对“爱好者”和“爱好者”。我偏执的一面认为可能有可识别的东西。

最后，如果您想非常小心，只需下载 SDK 在命令行上编译您的代码，然后再分发您的代码。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-02-07T22:35:04.770

在 VS Professional 上探索 EULA。你应该能够从那里辨别出你能做什么和不能做什么。将此与 Express 的 EULA 进行比较。这很乏味，但它是正确的起点。

# python - Python 有类原型（或前向声明）吗？

> ID：524714
> 
> 赞同：46
> 
> 时间：2009-02-07T22:21:50.070
> 
> 标签：python, class, oop, prototype

我在一个文件中有一系列 Python 类。一些类引用其他类。

我的代码是这样的：

```
class A():
    pass

class B():
    c = C()

class C():
    pass 
```

试图运行它，我得到`NameError: name 'C' is not defined`. 很公平，但是有什么办法让它工作，还是我必须手动重新排序我的课程以适应？在 C++ 中，我可以创建一个类原型。Python有等价物吗？

（我实际上是在玩 Django 模型，但我尽量不让事情复杂化）。

* * *

## 回答 #1

> 赞同：66
> 
> 时间：2010-02-24T22:45:09.307

实际上，以上所有这些都是对 Python 的很好的观察，但它们都不能解决你的问题。

Django 需要自省。

做你想做的事情的*正确方法如下：*

```
class Car(models.Model):
    manufacturer = models.ForeignKey('Manufacturer')
    # ...

class Manufacturer(models.Model):
    # ... 
```

请注意使用类名作为*字符串*而不是文字类引用。Django 提供了这种替代方法来解决 Python 不提供前向声明的问题。

这个问题让我想起了经典的支持问题，你应该总是问任何有问题的客户：“你*真正*想做什么？”

* * *

## 回答 #2

> 赞同：39
> 
> 时间：2009-02-07T22:27:33.303

在 Python 中，您本身并不创建原型，但您确实需要了解“类属性”和实例级属性之间的区别。在上面显示的示例中，您在 B 类上声明了一个类属性，而不是实例级属性。

这就是您要查找的内容：

```
class B():
    def __init__(self):
        self.c = C() 
```

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-02-07T22:30:13.907

这将解决您提出的问题（但我认为您确实在寻找 jholloway7 响应的实例属性）：

```
class A:
    pass

class B:
    pass

class C:
    pass

B.c = C() 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-02-08T14:56:03.667

Python 没有原型或 Ruby 风格的开放类。但是如果你真的需要它们，你可以编写一个重载**new**的元类，以便它在当前命名空间中查找该类是否已经存在，如果它确实返回现有类型对象而不是创建一个新对象。我在不久前写的 ORM 上做了类似的事情，效果很好。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2019-02-05T14:29:46.903

问这个问题十年后，我遇到了同样的问题。虽然人们建议应该在**init**方法内完成引用，但有时您需要在实际实例化类之前将数据作为“类属性”访问。出于这个原因，我想出了一个使用描述符的简单解决方案。

```
class A():
    pass

class B():
    class D(object):
        def __init__(self):
            self.c = None
        def __get__(self, instance, owner):
            if not self.c:
                self.c = C()
            return self.c
    c = D()

class C():
    pass

>>> B.c
>>> <__main__.C object at 0x10cc385f8> 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-07T23:19:28.097

关于类与实例属性的所有正确答案。但是，出现错误的原因只是定义类的顺序。当然 C 类还没有定义（因为类级代码在导入时立即执行）：

```
class A():
    pass

class C():
    pass

class B():
    c = C() 
```

将工作。

# asp.net-mvc - ASP.NET MVC 中返回视图的 URL

> ID：524723
> 
> 赞同：1
> 
> 时间：2009-02-07T22:29:07.577
> 
> 标签：asp.net-mvc, url-routing, friendly-url

在这个问题的上下文中，[链接文本](https://stackoverflow.com/questions/217960/asp-net-mvc-friendly-url)可以从响应表单帖子的控制器转到友好网址吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-07T22:50:36.970

是的。您的控制器操作可以根据您希望为其定义路由的方式确定友好 url，然后重定向到友好 url 而不是返回视图。它会引起另一个浏览器请求，这会给您的服务器增加负载，因此您需要确保它真的很重要。

# apache-flex - 访问 DataGrid 中的 ItemRenderer

> ID：524725
> 
> 赞同：4
> 
> 时间：2009-02-07T22:29:41.223
> 
> 标签：apache-flex, actionscript-3, actionscript, flex3

我有一个数据网格，在 cloumn 中有一个复选框项渲染器以允许行选择：

**主要应用：**

```
 <mx:DataGrid id="dg">
    <mx:columns>
        <mx:DataGridColumn id="ir" itemRenderer="renderers.RowCheckbox" /> 
        <mx:DataGridColumn dataField="Name" headerText="Name" /> 
    </mx:columns>
</mx:DataGrid> 

```

**物品渲染器：**

```
 <-- RowCheckbox -->
<?xml version="1.0" encoding="utf-8"?>
<mx:HBox xmlns:mx="http://www.adobe.com/2006/mxml" horizontalAlign="center"> 
    <mx:CheckBox id="chk"/>
</mx:HBox> 

```

如何获得项目渲染器/复选框的句柄，以便我可以确定检查哪些行？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-08T06:58:10.060

提个建议：我们在应用程序中遇到了类似的问题，我们通过向数据网格的数据提供者中的实体添加“选定”属性来解决它。checkBox 的 selected 属性然后绑定到我们实体的 selected 属性。要知道选择了哪些，我们只需遍历 dataprovider 中的实体而不是项目渲染器。经过很多不同的方法，这确实是最好的选择。

如果我没记错的话，问题是 itemrenderers 没有正确记住选定的状态，并且当您上下滚动时数据网格完全混乱了。滚动后选择了错误的行。

另一种选择是在项目渲染器中调度一个事件，该事件一直冒泡到托管数据网格的控件。然后，您可以侦听这些事件并更新您的模型以反映更改。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-12T15:03:42.303

我在 DataGrid 和多个项目渲染器以及滚动时重用项目渲染器时遇到了类似的问题。为了访问 DataGrid 项目渲染器，我扩展了 DataGrid。我的第一个想法是使用 indicesToIndex()，然后是 indexToItemRenderer()。不幸的是，这些方法没有达到我的预期，所以我添加了 indicesToItemRenderer() 方法：

包 com.whatever.controls {

```
import mx.controls.DataGrid;
import mx.controls.listClasses.IListItemRenderer;

public class CustomDataGrid extends DataGrid
{

    public function CustomDataGrid()
    {
        super();
    }

    public function indicesToItemRenderer(rowIndex:int, colIndex:int):IListItemRenderer
    {
        var firstItemIndex:int = verticalScrollPosition - offscreenExtraRowsTop;
        if (rowIndex < firstItemIndex ||
            rowIndex >= firstItemIndex + listItems.length
            )
        {
            return null;
        }

        return listItems[rowIndex - firstItemIndex][colIndex];
    }

} 
```

要解决滚动时重复使用的项目渲染器问题，请参阅这篇文章：

[http://www.adobe.com/devnet/flex/articles/itemrenderers_pt1.html](http://www.adobe.com/devnet/flex/articles/itemrenderers_pt1.html)

它归结为覆盖数据设置器并将属性存储在数据中。例如，我有一列使用 CheckBox itemRenderer，另一列使用 ComboBox。对于这两者，我都会监听更改事件，并在属性更改时将 selected、selectedIndex 等存储在数据中，并覆盖数据设置器以设置这些属性：

```
 override public function set data(value:Object):void
        {
            if (value != null)
            {
                super.data = value;

                if (data.hasOwnProperty('selected') && data.selected)
                {
                    selected = data.selected;
                }
                else
                {
                    selected = false;
                }
            }
        } 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-07T23:02:38.490

您可以使用`indexToItemRenderer()`ListBase 的所有子类公开的方法。

例如：

```
private function someFunction(index:int):void
{
    var rowCheckbox:RowCheckbox = dg.indexToItemRenderer(index) as RowCheckbox;
    trace(rowCheckbox.chk.selected.toString());
} 
```

...其中`index`表示要测试其“chk”属性的 DataGrid 项的索引。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2010-05-26T11:12:10.567

在 ItemRenderer 中，尝试将 Checkbox 组件放入 VBox 中。解决滚动问题。

# css - ASP.NET MVC - ViewUserControl 中的 CSS 类 - 未定义类或 CssClass

> ID：524732
> 
> 赞同：2
> 
> 时间：2009-02-07T22:35:45.127
> 
> 标签：css, asp.net-mvc

我在 ViewUserControl 中有一个`<table/>`，我给标签一个*class="tblRaised"*属性/值。Visual Studio 保持底层*tblRaised*并告诉我 - 未定义类或 CssClass。

为什么智能感知引擎要在这里验证我的 CSS 类名？还有其他人遇到这个吗？这是一个错误吗？智能感知如何知道我的 css 文件在 ViewUserControl 中的位置？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-07T22:47:08.583

因为样式通常包含在您的视图或母版页中，VS 无法在您的 ViewUserControl 中找到它们。如果您将以下内容添加到 ViewUserControl 中，您可以绕过该问题（并获得智能感知），而无需两次包含 CSS。

```
<% if (false) { %>
   <link rel="stylesheet" type="text/css" ...
<% } %> 
```

这将获得智能感知，因为它可以找到样式表，但使用 if (false) 实际上会阻止它在运行时被包含。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-07T22:42:17.783

通常在 ASP.NET 世界（不是 MVC）中，您会在母版页或当前页面中指定样式。VS 然后读取所有样式信息，然后尝试帮助智能感知在键入时将样式中的类名输出到您的 aspx 页面。使用 MVC，它试图做同样的事情，但它可能只是找不到你的文件，并抛出警告。

暂时忽略它，我相信他们会尝试在 1.0 版本中支持它。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-07T22:43:43.630

这是一个已知的错误。Visual Studio IntelliSense 太有用了。:)

在您的用户控件标记文件中使用此解决方法，它将使 VS IntelliSense 高兴：

```
<% if (false) { %><link href="../../Content/Css/MyCssDefinitions.css" rel="Stylesheet" type="text/css" /><% } %> 
```

# python - python，如何判断返回了什么类型的obj

> ID：524734
> 
> 赞同：1
> 
> 时间：2009-02-07T22:39:47.430
> 
> 标签：python, types

我如何确定 func 返回的 obj 是 int 还是其他东西（如 sqlite 游标）

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-02-07T22:42:24.617

使用`isinstance(item, type)`——例如：

```
if isinstance(foo, int):
    pass # handle this case 
```

然而，显式类型检查在 Python 世界中并不被认为是一种好的做法——这意味着鸭子类型的大部分功能都丢失了：应该允许像鸭子一样走路和嘎嘎叫的东西是鸭子，即使它不是不！:)

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2009-02-07T22:45:43.937

使用内置的“类型”函数，例如 type(10) -> 。

# javascript - Javascript 确认对话框 - ASP.NET

> ID：524741
> 
> 赞同：1
> 
> 时间：2009-02-07T22:47:11.830
> 
> 标签：javascript, c#, asp.net, .net-2.0, dom-events

我在同一主题上看到了几个类似的问题，但没有一个解决了我的问题。

我有一个 asp.net 网站，并希望在数据库更新后向用户显示一条状态消息（asp:label 将在 5 秒内消失）。

我想将文本分配给标签，然后用 Javascript 隐藏它。

我把js部分整理好了，唯一的问题是**我将文本分配给控件后如何调用js函数？**

假设我正在使用以下代码更新数据库中的某些内容：

```
<asp:Button ID="btnUploadFiles" runat="server" OnClick="buttonSubmit_Click" Text="Update"  /> 
```

背后的代码

```
protected void buttonSubmit_Click(object sender, EventArgs e)
    { try{// update the database  
          // change label text to tell the user update succeeded}
      catch(Exception ex){...}
    } 
```

请帮忙！

**更新：请不要使用 jquery，只需使用普通的 javascript**

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-07T23:10:38.257

我个人会为此使用[jQuery](http://jquery.com/)，但如果你想使用普通的旧 JavaScript，那么这样的东西可能会奏效：

```
<script type="text/javascript">
function hideLabel()
{
    // replace yourLabelID with <%=YourLabelID.ClientID%> if it's a .NET Label control
    document.getElementById('yourLabelID').style.display = 'none';
}
setTimeout('hideLabel()', 5000);
</script> 
```

如有必要，您还可以将脚本块嵌入`Literal`控件中，并且仅在更新标签文本时使其可见。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-08T03:07:42.897

要回答您的问题“将文本分配给控件后如何调用 js 函数？”。您可以在按钮单击事件中添加对“RegisterClientScriptBlock”的调用，以输出 Luke 提供的 JavaScript。

```
protected void buttonSubmit_Click(object sender, EventArgs e)
{ 
    try
    {
       // update the database  
       // change label text to tell the user update succeeded
       label.Text = "Message";
       string js = "function hideLabel(){document.getElementById('" + label.ClientID + "').style.display = 'none'};setTimeout(hideLabel, 5000);"
       ClientScript.RegisterClientScriptBlock(this.GetType(), "test", js ,true);
    }
    catch(Exception ex){...}
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-07T22:58:33.367

您是通过 Ajax 回发还是通过普通回发？如果是正常的回发，只需在设置计时器的页面上注册一些 javascript，并在计时器到期后调用隐藏标签的函数。以下示例使用 jQuery 确保在计时器启动之前加载 DOM，但还有其他方法。它会在 5 秒后隐藏标签。

```
function hideLabel(label)
{
   $(label).hide();
}

$(document).ready( function() {
    var label = $('#labelID');
    setTimer(function() { hideLabel(label); ),5000);
}); 
```

如果您使用 AJAX，这个想法基本上是相同的，除了您在 onSuccess 回调中为 AJAX 调用而不是在文档加载时设置计时器。

# c - Windows平台上的制作和替代品，优缺点

> ID：524745
> 
> 赞同：3
> 
> 时间：2009-02-07T22:50:09.170
> 
> 标签：c, makefile, fortran, build-system

我正在寻找一个制作平台。我已经阅读了一些关于 gnu make 的内容，并且它在 Windows 平台上遇到了一些问题（从斜杠/反斜杠到 shell 确定......）所以我想听听我的替代方案是什么？

如果重要的话，我会在小型项目（最大 50k 行）上结合（非常）小 c 进行 fortran 开发，但我认为这并不重要，因为其中大多数都是与语言无关的类型。

什么是 gnu make 缺点，我有什么替代方案，有什么优点？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-07T23:08:57.667

有几个很好的工具可以在 Windows 上进行持续集成和构建。我想到的两个是[NAnt](http://nant.sourceforge.net/)，它把自己描述为 .Net 构建工具，但可以用来构建任何东西——它的开源且非常可扩展，尽管缺少 UI。我最近开始使用[Hudson](http://hudson.gotdns.com/wiki/display/HUDSON/Installation+and+Execution)，它非常棒，输出比 NAnt 好得多，使它更容易使用。我对这些工具和 Fortran 的经验为零，所以祝你好运。

我对 make 及其衍生产品的想法是避免基于它的年龄，这是当时一个很好的工具，但它现在必须有 20 年的历史，而且技术（即使是在构建领域）从那时起已经有了相当大的进步。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-08T22:28:05.130

你可以看看`cmake`。它是一种“元制作”系统：您为它编写一个制作文件，其中说明了您的项目的结构，它需要哪些库和源等等。它可以为您构建 GNU make、nmake（我相信）、Kdevelop 和 Visual Studio 的项目文件的 make 文件。

KDE 已将其用于 KDE4 及以后的版本，并且此后得到了极大的增强：[CMake](http://www.cmake.org/)

另一个这样的系统是[Bakefile](http://www.bakefile.org/index.html)，它是为 wxWidgets GUI 工具包生成生成文件和项目文件而构建的。它也可以用于非 wx 应用程序，并且相对年轻和现代（使用 XML 作为其 makefile 描述）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-07T23:25:46.213

还有[nmake](http://msdn.microsoft.com/en-us/library/ms930369.aspx)，它是微软的 nmake 版本。不过，我建议坚持使用 gnu make。我的建议是始终使用 Unix 之类的斜杠；它们也适用于 Windows。Gnu make 被广泛使用，您可以轻松找到教程并获得有关它的使用建议。这也是一项更好的投资，因为您将来也可以在其他领域使用它。最后，它的功能要丰富得多。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-08T00:28:03.200

我在 Windows 下使用 GNU make 并且没有任何问题。但是，我也使用 bash 作为我的 shell。make 和 bash 都可以作为 Cygwin 软件包的一部分从 www.cygwin.com 获得，如果你打算从命令行使用 make，我强烈建议你安装 bash 和所有常用的命令行工具（grep、sed 等） .

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-08T01:15:17.990

Make 即使在 Windows 上也经受住了时间的考验，我每天都在使用它，但也有[msbuild](http://en.wikipedia.org/wiki/MSBuild)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-04-11T20:37:35.350

细节，细节……

鉴于您的小项目，我会从 MS nmake 开始。如果这还不够，请继续使用 GNUmake。上面的其他建议也很好。Ant 和 CMake 很好，但你不需要它们，如果你有问题，有很多 make 用户可以帮助你。

就此而言，由于您在 Windows 上，MS IDE 没有内置构建工具。只需单击即可。

把事情简单化。计划把第一个扔掉，反正你会的。

维基百科也有这样的说法：

[http://en.wikipedia.org/wiki/List_of_build_automation_software](http://en.wikipedia.org/wiki/List_of_build_automation_software)

# asp.net-mvc - 我应该如何制作这个 ASP.NET MVC 路由？

> ID：524747
> 
> 赞同：0
> 
> 时间：2009-02-07T22:51:10.993
> 
> 标签：asp.net-mvc, routes

我希望有以下网址..我不知道我应该如何做以下事情：

1）在 global.asax 中注册的路由
2）控制器方法

## 网址/路线

```
- http://www.mysite.com/
- http://www.mysite.com/?page=2
- http://www.mysite.com/?tags=fooBar
- http://www.mysite.com/?page=2&tags=fooBar 
```

请注意 - 我不想拥有`http://www.mysite.com/{page}/{tags}/`等。如果这种差异有意义。我也了解默认路由，但我不确定如何调整它们以使其满足我的要求。

最后，我也知道如何使用 Html.ActionLink(..) 所以我不担心如何使用它。

有什么建议么？

## 单元测试

我也觉得我可以进行单元测试，如下所示：-（使用 MvcFakes）...

```
// Arrange.
var routes = new RouteCollection();
MvcApplication.RegisterRoutes(routes);  

// Act.
context = new FakeHttpContext("~/?page=2&tags=fooBar");
routeData = routes.GetRouteData(context);

// Assert.
Assert.AreEqual("Home", routeData.Values["controller"]);
Assert.AreEqual("Index", routeData.Values["action"]);
Assert.AreEqual(2, routeData.Values["page"]);
Assert.AreEqual("fooBar", routeData.Values["tags"]); 
```

## 更新 1

如果有帮助，我希望在默认 HomeController 上运行所有这些 Index 操作。（实际上，我已将 HomeController 重命名为 PostController，但这并不重要/不应该影响问题）。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-09T13:00:14.583

实际上，对于您想要做的事情，您不需要额外的路线。默认的 MVC 路由可以很好地处理您的请求。您只需要记住控制器操作参数名称必须与您的 url 参数名称匹配。

```
URL: http://www.mysite.com/?page=2&tags=fooBar

public ActionResult Index(string page, string tags)
{
   ViewData["Message"] = string.Format("Page={0}, Tags={1}", page, tags);
   return View();
} 
```

当然那是控制器“主页”和动作“索引”的默认设置。但我希望这一点很清楚。

Scott Guthrie 有关于路由的优秀文章[Here](http://weblogs.asp.net/scottgu/archive/2007/12/03/asp-net-mvc-framework-part-2-url-routing.aspx)

# c - 找到二维三角形的中心？

> ID：524755
> 
> 赞同：24
> 
> 时间：2009-02-07T22:57:36.287
> 
> 标签：c, opengl, rotation, geometry

我已经获得了一个带有 x 和 y 坐标、旋转变量等的 2D 三角形的结构。从这些 x 和 y 坐标创建的点开始，我应该围绕该点绘制一个三角形并使用旋转变量适当地旋转它。

我熟悉使用 GL_TRIANGLES 在 OpenGL 中绘制三角形。我的问题是以某种方式提取三角形的中间并在其周围绘制顶点。

编辑：是的，我正在寻找的是质心。

* * *

## 回答 #1

> 赞同：45
> 
> 时间：2009-02-07T23:04:10.733

三角形的中心有不同的“类型”。详细信息：[三角形的中心](https://web.archive.org/web/20131104015950/http://www.jimloy.com/geometry/centers.htm)。找到三角形中心的一种快速方法是平均所有点的坐标。例如：

```
GLfloat centerX = (tri[0].x + tri[1].x + tri[2].x) / 3;
GLfloat centerY = (tri[0].y + tri[1].y + tri[2].y) / 3; 
```

找到中心后，您需要围绕中心旋转三角形。为此，请平移以使中心现在位于 (0, 0)。执行您的旋转。现在反转您之前执行的翻译。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-02-07T23:05:28.563

我猜你的意思是三角形的质心！？
这可以通过 1/3(A + B + C) 轻松计算，其中 A、B 和 C 是三角形的相应点。如果你有你的观点，你可以像往常一样简单地将它们乘以你的旋转矩阵。希望我说对了。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-07T23:05:20.887

三角形中有几个点可以被认为是它的中心（正交中心、质心等）。[维基百科关于三角形的文章的这一部分](http://en.wikipedia.org/wiki/Triangle#Points.2C_lines_and_circles_associated_with_a_triangle)有更多信息。只需查看图片即可快速概览。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-02-07T23:06:36.890

“中间”是指“质心”，如果它是一个具有恒定厚度和密度的 3D 对象，也就是重心？

如果是这样，则选择两个点，并找到它们之间的中点。然后取这个中点和第三个点，找到它们之间1/3的点（更靠近中点）。那是你的质心。我不是在为你做数学。

# vim - 如何在 VIM 中共享我的折叠？

> ID：524756
> 
> 赞同：8
> 
> 时间：2009-02-07T22:57:55.333
> 
> 标签：vim, portability, folding

我在一个有 3 人的项目中。我们需要在 Vim 中为每个成员设置相同的折叠。如何分享我的折叠？

**[回馈]**

我明白了一件重要的事情：谷歌忽略了符号，例如 {{{，所以请谷歌“VIM 三大括号”以查找有关标记方法的帮助。由于您可以快速找到相关信息，因此练习变得容易得多。

为了使用标记方法（由 Adam Bellaire 建议），请注意您必须设置方法：

```
:set foldmethod=marker 
```

感谢您的回答！

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-02-08T13:53:08.223

可能最简单的方法是只使用折叠标记（例如`{{{1`），确保将`vim:fdm=marker`设置包含在文件本身中。例如，这是一个 shell 脚本，其中包含使用折叠标记的设置和两个折叠级别：

```
#/bin/sh
# vim:fdm=marker
echo This file contains fold markers.

#Top Level Fold     {{{1
echo This is a top-level fold.

#Second Level Fold  {{{2
echo This is a second-level fold. 
```

在 vim 中打开这个文件将显示前四行，然后是一个折叠，如果展开将显示第二个折叠。只需确保在注释语法和`vim:fdm=marker`行之间留一个空格，否则 vim 将看不到它。例如，在 C 中，您可以使用：

```
// vim:fdm=marker 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-07T23:03:16.163

折叠在文件中？好吧，相同的设置应该导致相同的折叠。

Vim 可以通过多种方式折叠：手动、缩进、表达式、语法和标记（默认情况下，我相信是弯括号，其中 3 个）。

所以如果你有相同的 vim 版本，并且他们没有改变他们的语法和缩进文件，让他们检查你的 vimrc 中的 foldmethod 和 foldmarker 选项，并将它们复制到他们的 vimrc 文件中。那应该这样做。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-07T23:02:54.217

我以前没有与某人共享 VIM 折叠，但如果您在同一台机器上工作，也许您可​​以使用 VIM 会话，这将保存您当前的状态（包括折叠）。在 VIM 中运行以下命令：

```
 mks! /path/to/session_file 
```

然后你的朋友可以加载会话文件：

```
vim -s /path/to/session_file 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2014-06-10T17:52:56.423

古老的历史，我知道，但这可能是自 09 年出现的 vim 版本以来出现的，而且由于我还没有足够的声誉来发表评论，所以我们开始吧。

好消息是保存文件的**视图**也应该保存手动折叠，甚至是嵌套折叠。

坏消息是我发现它在 vim 7.0 (RHEL 5.5) 下没有产生一致的结果。这可能已在后续更新中得到修复，遗憾的是，我们不允许安装。

# html - 使用 Delphi 2009 下载任何网页并将其保存为 Unicode？

> ID：524758
> 
> 赞同：2
> 
> 时间：2009-02-07T22:58:44.303
> 
> 标签：html, delphi, http, winapi, internationalization

我希望下载一个网页，它可以是任何可能的文本编码，并将其保存为 UTF16LE。假设我可以确定文本的编码（通过检查 HTTP 标头、HTML 标头和/或 BOM），我如何转换文本？

我使用的是 Delphi 2009。不幸的是，帮助文件没有说明如何从*任何*编码转换为 Unicode (UTF16LE) 字符串。具体问题：

*   我可以通过在 AnsiString 上设置正确的编码并将其分配给 UnicodeString 来完成转换吗？
*   如果是这样，我如何将可能标记网页（Big5、Shift-JIS、UTF-32 等）的各种“字符集”描述转换为正确的格式以初始化 AnsiString？

感谢您的建议。

我偏爱直接的 Win32 和 VCL，但涉及 ActiveX 控件的答案也可能会有所帮助。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-09T10:00:08.087

您将如何访问该页面？嵌入式 Internet Explorer、INDY、第三方工具……？这可能会影响答案，因为它决定了输入字符串的格式。

**第 1 部分：获取页面**

如果您使用 Embedded Internet Explorer ( `TWebBrowser`) 访问页面，事情就非常简单：

```
var htmlElement:IHTMLElement;
    myText:String;
begin
  // Get access to the HTML element of the document:
  htmlElement:=(WebBrowserControl.DefaultInterface.Document as IHTMLDocument3).documentElement;
  // Receive the full HTML of the web page:
  myText:=htmlElement.OuterHTML; 
```

网页的编码应该由 IE 和 Delphi 正确处理，您最终会得到一个`UnicodeString`包含结果（`myText`在示例中）。

**第 2 部分：保存为 UTF-16LE**

无论您的字符串来自何处 - 您都可以将其保存为所需的编码：

```
var s:TStringStream;
begin
  s:=TStringStream.Create(myText, TEncoding.Unicode, false);
  s.SaveToFile('yourFileToSaveTo.txt');
  FreeAndNil(s);
end; 
```

`TEncoding.Unicode`是 UTF-16LE，但您也可以使用任何其他编码。

希望这可以帮助。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-07-08T05:08:02.787

在 D2009 及更高版本中，Indy 10 的 TIdHTTP 组件会自动为您将接收到的网页解码为 UTF-16。

在 Windows 上进行 charset 到 Unicode 的转换需要使用代码页（除非您使用 ICONV 库），因此您必须先将字符集名称转换为合适的代码页，然后才能使用 TEncoding.GetEncoding() 和 TEncoding .GetString()，或在 RawByteString（不是 AnsiString）上调用 SetCodePage()，然后将其分配给 UnicodeString，以进行转换（在内部，Indy 使用 TEncoding 并有自己的字符集到代码页查找表）。

# c# - 以下 c# 代码出现不一致的可访问性错误。为什么？

> ID：524761
> 
> 赞同：30
> 
> 时间：2009-02-07T23:01:11.037
> 
> 标签：c#

以下 c# 代码有什么问题？编译器报告此错误：

可访问性不一致：参数类型“ClassLibrary1.Interface1”的可访问性低于方法“ClassLibrary1.Class1.Class1(ClassLibrary1.Interface1)”

使用以下代码：

```
interface Interface1<T>
{
    bool IsDataValid();
    /* Other interfaces */
}

public class Class1<T>
{
    public Interface1<T> interface1;

    public Class1(Interface1<T> interface1)
    {
        this.interface1 = interface1;
    }

} 
```

从那以后，我使用继承设计了不同的代码，但如果有人能告诉我上面有什么问题，我将不胜感激。

* * *

## 回答 #1

> 赞同：62
> 
> 时间：2009-02-07T23:03:06.290

您的“Interface1”不公开..

```
public interface Interface1<T>
{
    bool IsDataValid();
    /* Other interfaces */
} 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-02-07T23:03:12.013

将您的界面标记为公开：

`public interface Interface1<T>`

如果您省略了可访问性标签，则它默认为`internal`，即只有程序集中的其他类可以访问。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-11-21T11:23:54.657

第二种解决方案是如果您的接口不是公开的，那么不要在您制作接口句柄的地方公开您的类。

# php - Phpmyadmin login script

> ID：524762
> 
> 赞同：0
> 
> 时间：2009-02-07T23:02:01.783
> 
> 标签：php, phpmyadmin

I trying to code a login script for phpmyadmin

```
<?php    
$user = "Domain";
$passwords = file("passwords.txt");

foreach ( $passwords as $pass){
$source = file_get_contents("http://dbadmin.one.com/index.php?lang=en&server=1&pma_username=$user&pma_password=$pass");
if(preg_match("/Database/", $source)):
echo "Login Worked with: {$pass}";
endif;
}
?> 
```

My Problem is it , it dont works here

```
echo "Login Worked with: {$pass}"; 
```

Can you see the problem?

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-07T23:14:56.733

Not necessarily the solution to your problem, but some basic error checking might point you in the right direction. Your problem may even begin at the initial call to file.

```
$passwords = file("passwords.txt");

if (!$passwords) {
 echo 'Unable to read password file';
} //etc

$source = file_get_contents("http://dbadmin.one.com/index.php?lang=en&server=1&pma_username=$user&pma_password=$pass");

if (!$source) {
 echo 'Unable to read file source';
} //etc 
```

Also as a side note if you were calling this function on a file outside your filesystem wouldn't you only get the output (HTML) similar to calling it in your browser (not sure if that was your intention).

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-06T20:51:09.853

```
$source = file_get_contents("http://dbadmin.one.com/index.php?lang=en&server=1pma_username=$user&pma_password=$pass");
if(preg_match("/Database/", $source)): 
```

$source 的值将是获取 url 的完整 HTML 响应：

[http://dbadmin.one.com/index.php?lang=en&server=1&pma_username=](http://dbadmin.one.com/index.php?lang=en&server=1&pma_username=) $user&pma_password=$pass

preg_match 只会匹配该字符串的第一行。您将需要以不同的方式解析字符串或替换任何换行符，以便它匹配整个文件。

看起来您正在测试使用用户名“域”和多个不同密码登录到数据库。不确定这是否是您的意图，但这似乎有点奇怪。

# f# - f# - 遍历数组

> ID：524765
> 
> 赞同：4
> 
> 时间：2009-02-07T23:02:55.743
> 
> 标签：f#

我决定采用 f# 作为我的函数式语言。

我的问题：在一个文件中给出一堆 50 位，得到每行总和的前 10 位。（知道的人的欧拉问题）

例如（简化）：1234567890

总和是 45
第一个“十”位数字，或者在我们的例子中，“第一个”数字是 4。

这是我的问题，我读取了我的数字文件，我可以使用“\n”拆分它，现在我有了每一行，然后我尝试将它转换为一个字符数组，但问题就在这里。我无法访问该数组的每个元素。

```
let total =
    lines.Split([|'\n'|])
    |> Seq.map  (fun line -> line.ToCharArray())
    |> Seq.take 1
    |> Seq.to_list  
    |> Seq.length 
```

我得到每一行，将其转换为数组，我取第一个数组（仅用于测试），然后尝试将其转换为列表，然后获取列表的长度。但是这个长度是我有多少个数组的长度（即1）。它应该是 50，因为这就是数组中有多少元素。

有谁知道如何通过管道访问每个字符？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-08T00:35:13.950

我的最终答案：

```
let total =
    lines.Split([|'\n'|])
    |> Seq.map (fun line -> line.ToCharArray() |> Array.to_seq)      
    |> Seq.map (fun eachSeq -> eachSeq 
                               |> Seq.take 50 //get rid of the \r
                               |> Seq.map (fun c -> Double.Parse(c.ToString()))
                               |> Seq.skip 10
                               |> Seq.sum                                
                               )
    |> Seq.average 
```

是我最终得到的，它正在工作:)。

基本上在我将它转换为 charArray 之后，我把它变成了一个序列。所以现在我有一个序列序列。然后我可以遍历每个序列。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-08T00:38:40.030

`Seq.take`仍在返回一个`seq<char array>`. 要仅获取第一个数组，您可以使用`Seq.nth 0`.

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-08T00:46:01.793

我不是 100% 确定你要什么，但我相信你正在尝试写这样的东西：

```
lines.Split([|'\n'|) |> Seq.map (fun line -> line.Length) 
```

这会将每一行转换为表示每行长度的整数序列。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2012-02-29T14:41:49.853

这是我的解决方案：

```
string(Seq.sumBy bigint.Parse (data.Split[|'\n'|])).Substring(0, 10) 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-09T18:51:27.327

我将数据复制到一个字符串中，每行由 x 分隔。那么答案是一行（为SO包装）：

```
let ans13 = data |> String.split ['x'] |> Seq.map Math.BigInt.Parse 
                                                      |> Seq.reduce (+) 
```

如果您从文件中读取它，您将添加文件读取代码：

```
let ans13 = IO.File.ReadAllLines("filename") |> Seq.map Math.BigInt.Parse
                                                            |> Seq.reduce (+) 
```

编辑：实际上，我不确定我们谈论的是同一个欧拉问题——这是针对 13 的，但你的描述听起来略有不同。要获得求和后的前 10 位数字，请执行以下操作：

```
printfn "%s" <| String.sub (string ans13) 0 10 
```

# encryption - .Net Web 服务加密解密数据集

> ID：524778
> 
> 赞同：0
> 
> 时间：2009-02-07T23:06:07.827
> 
> 标签：encryption, service, dataset

有谁知道如何在客户端加密数据集并将其发送到 Web 服务并在那里解密的示例？

另一个问题：我需要做的是将数百行数据从客户端发送到 Web 服务，并让 Web 服务使用这些记录更新数据库。如果不使用数据集，我想不出任何其他方法来做到这一点。有没有更好的方法？

提前致谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-07T23:29:07.393

就加密而言，为什么要重新发明轮子？只需通过 SSL 连接到 Web 服务 - 它很可能比本土替代方案更安全。

我可能会创建一个自定义结构/对象并将它们的数组发送到 web 服务而不是数据集。这将意味着（稍微）更少的网络流量；它将使 web 服务的 WSDL 更具描述性；如果将来有必要，它将使任何非 Microsoft 应用程序更容易与 Web 服务通信。

**编辑：一个例子......**

在服务器端，您可以声明一个自定义类型（例如*ExampleUser*），然后设置您的方法以接受该类型的数组而不是 DataSet：

```
[WebService(Namespace="http://example.yourdomain.com/ExampleWebService/")]
public class ExampleWebService : System.Web.Services.WebService
{
    // this is your custom type
    public class ExampleUser
    {
        public int UserID { get; set; }
        public string Name { get; set; }
        public DateTime DateOfBirth { get; set; }
    }

    // this is your method
    // accepts an array of ExampleUser rather than a DataSet
    [WebMethod]
    public void UploadUsers(ExampleUser[] usersArray)
    {
        // do something...
    }
} 
```

在客户端应用程序中，您将添加对 Web 服务的引用。这将使您能够使用在上面的服务器端代码中声明的 ExampleUser 类型。

然后，您可以在将 DataSet 发送到 Web 服务之前将其转换为 ExampleUser 对象数组：

```
// get the number of rows in the DataTable
int rowCount = yourDataSet.Tables[0].Rows.Count;

// create an array of ExampleUser with the correct capacity
ExampleWebService.ExampleUser[] usersArray =
    new ExampleWebService.ExampleUser[rowCount];

// iterate through each row in the table
for (int i = 0; i < rowCount; i++)
{
    DataRow dr = yourDataSet.Tables[0].Rows[i];

    // create an ExampleUser object and populate it from the DataRow columns
    ExampleWebService.ExampleUser eu = new ExampleWebService.ExampleUser();
    eu.UserID = (int)dr["User_ID"];
    eu.Name = (string)dr["Name"];
    eu.DateOfBirth = (DateTime)dr["Date_Of_Birth"];

    // add the ExampleUser object to the array
    usersArray[i] = eu;
}

// the array is populated so let's call the webservice
ExampleWebService.UploadUsers(usersArray); 
```

**编辑：另一个例子......**

如果您使用的是 .NET 3.5，那么您可以通过使用 LINQ 和对象初始化程序来创建您的数组，从而将客户端简化为几行代码：

```
// create and populate the array
ExampleWebService.ExampleUser[] usersArray =
    yourDataSet.Tables[0].AsEnumerable().Select
    (
        s => new ExampleWebService.ExampleUser()
        {
            UserID = (int)s["User_ID"],
            Name = (string)s["Name"],
            DateOfBirth = (DateTime)s["Date_Of_Birth"]
        }
    ).ToArray();

// the array is populated so let's call the webservice
ExampleWebService.UploadUsers(usersArray); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-07T23:19:04.527

好吧，有很多方法可以解决这个问题。由于您是通过网络发送的，您可以：1）将数据写入 XML 流（这正是 DataSet 的目的）然后 2）您可以压缩 XML（压缩率最好此阶段）然后 3）使用 .NET 加密方案之一进行加密，最后 4）将您的 XML 解密、解压缩和反序列化为 DataSet 对象或您想要对其进行的任何操作。

请注意，您可能需要对加密结果进行 Base64 处理。另一种选择是不加密和使用基于 SSL 的 Web 服务，而只使用本机加密。根据数据的类型，DataSet 可能不是性能方面的最佳选择。您可以发送 CSV 或 JSON 样式的数据块；这可能会更小，特别是如果您的 DataSet 中只有一个“DataTable”对象。就使用的最佳方法而言，这在很大程度上取决于情况。

# c# - DropDownList 样式的 C# ComboBox，如何设置文本？

> ID：524780
> 
> 赞同：21
> 
> 时间：2009-02-07T23:07:16.687
> 
> 标签：c#, .net, combobox

我想使用具有 DropDownList 样式的 ComboBox（使它看起来像一个按钮，因此您无法输入值）将一个值插入到文本框中。我希望组合框有一个名为“通配符”的文本标签，当我从列表中选择一个通配符时，所选值被插入到一个文本框中，组合框文本仍然是“通配符”。我的第一个问题是当组合框为 DropDownList 样式时，我似乎无法设置文本值。使用属性托盘不起作用，当您单击关闭时，文本值会被简单地清除，添加 comboBox.Text = "Wildcards"; 到 form_load 也不起作用。任何人都可以帮忙吗？

* * *

## 回答 #1

> 赞同：35
> 
> 时间：2009-02-08T00:36:17.663

您指定的代码：

```
comboBox.Text = "Wildcards"; 
```

...应该管用。它不会的唯一原因是您指定的文本不是组合框项目列表中的项目。使用 DropDownList 样式时，您只能将 Text 设置为实际出现在列表中的值。

如果您尝试将文本设置为通配符并且该项目未出现在列表中，并且替代解决方案是不可接受的，则您可能不得不对代码有点脏并临时添加一个项目下拉列表展开时删除。

例如，如果您的表单包含一个名为“comboBox1”的组合框，其中包含一些项目和一个名为“button1”的按钮，您可以执行以下操作：

```
private void button1_Click(object sender, EventArgs e)
{
    if (!comboBox1.Items.Contains("Wildcards"))
    {
        comboBox1.Items.Add("Wildcards");
    }

    comboBox1.Text = "Wildcards";
}

private void comboBox1_DropDown(object sender, EventArgs e)
{
    if (comboBox1.Items.Contains("Wildcards"))
        comboBox1.Items.Remove("Wildcards");
} 
```

这非常快速和肮脏，但是通过捕获 DropDownClosed 事件，您可以稍微清理它，根据需要添加“通配符”项目。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2015-05-17T21:57:00.277

您可以在表单加载或表单构造函数中选择一项：

```
public MyForm()
{
    InitializeComponent();

    comboBox.SelectedIndex = 0;
} 
```

或者

```
private void MyForm_Load(object sender, EventArgs e)
{
    comboBox.SelectedIndex = 0;
} 
```

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2011-11-18T17:11:17.707

试试这个

```
comboBox1.SelectedValue = "Wildcards"; 
```

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2013-08-03T21:50:24.470

这可能是一个可能的解决方案：

```
comboBox1.SelectedValue = comboBox1.Items.FindByText("Wildcards").Value; 
```

# .net - Drawing over a TextBox in .NET Compact Framework

> ID：524784
> 
> 赞同：0
> 
> 时间：2009-02-07T23:09:07.807
> 
> 标签：.net, compact-framework

Is it possible to draw over a TextBox control in .NET Compact Framework? I want to create a watermark over it. I have read [this answer](https://stackoverflow.com/questions/174796/watermarked-textbox-for-compact-framework). It's currently my best approach, but I do not want to limit myself to displaying the watermark only when the TextBox does not have the focus.

I'm ready to try any hack!

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-08T03:33:27.057

如果我要这样做，我会创建一个从 TextBox 派生的控件，这样您就可以获得所有基本渲染、事件、文本和选择，yada-yada。然后我会 P/Invoke 到 SetWindowLong 以更改窗口处理程序，并在自定义处理程序中处理 WM_PAINT，绘制水印或任何你想要的。

一个很好的基础示例是[OpenNETCF.Windows.Forms.TextBox2](http://opennetcf.codeplex.com)类，它执行此子类化以处理剪切/复制/粘贴操作。我相信代码自 1.x 天以来就已经存在，因此如果您没有/不想要最新的，代码是免费提供的（上面链接中的页面底部）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-08T00:51:23.747

不幸的是，.NET CF TextBox 不能被继承并用作此任务的基础（对于初学者来说，不会调用 OnPaint），所以老实说，我认为您将节省一些时间来创建自己的控件。

如果您还没有在 .NET CF 中创建自定义控件，我强烈建议您关注这篇关于使控件透明的博客文章，因为这个概念在很大程度上是相同的：

[http://christian-helle.blogspot.com/2008/01/transparent-controls-in-netcf.html](http://christian-helle.blogspot.com/2008/01/transparent-controls-in-netcf.html)

如果我从头开始这样做，我会先从 Panel 继承并将其放入文本框。文本框可能是最难创建的控件之一（尤其是如果文本可能比文本框长），因此您可能还会查看其他供应商是否有带有源代码的 TextBox 组件，您可以从该组件开始，这样您就可以将 .DrawImage 添加到paint方法的末尾，您将拥有水印。

# cocoa - Cocoa/iPhone：BackgroundColor 和 Opaque 属性

> ID：524785
> 
> 赞同：6
> 
> 时间：2009-02-07T23:09:33.110
> 
> 标签：cocoa, cocoa-touch

在 Cocoa，特别是 iPhone SDK 中，该`opaque`属性被描述为：

> 如果不透明，则绘制操作假定视图填充其边界并且可以更有效地绘制。如果不透明并且视图未填充其边界，则结果是不可预测的。如果视图完全或部分透明，则将此属性设置为 NO。

根据我的经验，如果您有一个设置为 的视图（标签、表格单元格等），则**无需**`backgroundColor`设置为即可正确显示（背景清晰）。`[UIColor clearColor]`**`opaque``NO`**

 **直观地说，这样做还需要将 opaque 设置为 NO，但我从未遇到过问题。

你可以混合 opaque=YES 和 clearColor，还是我靠借来的时间生活？它似乎没有在任何地方专门记录。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-08T03:37:28.437

试试看是 iPhone 上唯一的前进方向，因为就像你说的，尽管 SDK 附带的文档量很大，但在许多情况下它并不是很具体。

至于不透明，这只是对合成引擎的一个提示，告诉它不需要费心显示任何被不透明层覆盖的层。但是，合成是由手机上的图形芯片完成的，因此在许多情况下，不绘制部分遮蔽层的遮蔽部分并没有效率更高，这很可能是您看不到东西在时刻（即可可忽略了您尝试过的情况下的设置）。出于同样的原因，您没有看到将 opaque 设置为 true 的性能改进。

因此，我的建议是按照文档所说的方式坚持使用 opaque 属性，因为您冒着渲染错误的风险而没有真正的好处。

# iphone - 当视图控制器被带到视图堆栈的顶部时，如何让视图控制器运行更新代码？

> ID：524786
> 
> 赞同：3
> 
> 时间：2009-02-07T23:09:47.167
> 
> 标签：iphone, cocoa-touch

我有一个 viewController（Planner），它在应用程序启动时加载两个视图控制器（InfoEditor 和 MonthlyPlan）。MonthlyPlan 隐藏在 InfoEditor 后面（加载时）。

所以我的问题是，当我将 InfoEditor 交换为 MonthlyPlan（MonthlyPlan 被带到顶部）时，我如何才能更新 MonthlyPlan 视图上的数据。viewDidLoad 中的 NSLog 在应用程序启动时被调用（这是有道理的）。 viewDidAppear 和 viewWillAppear 中的 NSLog 没有做任何事情。

有任何想法吗？

谢谢！

-- 添加更多细节 --

我正在自己创建视图层次结构。一个简单的 viewController，它只是加载了另外两个 viewController。同时加载两个子视图控制器（在启动应用程序时）。要交换两个视图，我使用以下代码：

```
[self.view exchangeSubviewAtIndex:1 withSubviewAtIndex:0]; 
```

交换意见很好。缺少的部分只是告诉子视图的某种方式，你在前面，更新一些属性。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-07T23:30:08.840

这里缺少细节。你如何“交换”这两种观点？

如果您使用 UINavigationController 作为容器，那么每当您推送/弹出新的 viewController 时都会调用 viewWillAppear/viewDidAppear。这些调用由 UINavigationController 本身进行。如果您正在使用 UINavigationController，请确保您的原型适用于这些功能。

```
- (void)viewWillAppear:(BOOL)animated 
```

如果您尝试自己实现视图层次结构，那么您可能需要自己进行这些调用，作为激活/停用视图的一部分。从viewWillAppear的SDK页面；

> 如果属于视图控制器的视图直接添加到视图层次结构中，视图控制器将不会收到此消息。如果您将视图插入或添加到视图层次结构中，并且它具有视图控制器，则应直接向关联的视图控制器发送此消息。

**更新：**

有了新的细节，问题就很清楚了：在这种情况下，您必须按照 SDK 的建议自己发送消失/出现消息。当直接插入/删除/更改视图时，这些函数不会自动调用，它们由提供层次结构支持的更高级别代码（例如 UINavigationController）使用。

如果您考虑使用 exchangeSubView 的示例，那么什么都不会消失，一个视图恰好完全或部分覆盖另一个视图，具体取决于它们的区域和不透明度。

我建议如果您希望交换视图，那么您确实根据需要删除/添加，并手动将 viewWillAppear / viewWillDisappear 通知发送到他们的控制器。

例如

```
// your top level view controller
-(void) switchActiveView:(UIViewController*)controller animated:(BOOL)animated
{
    UIController* removedController = nil;

    // tell the current controller it'll disappear and remove it
    if (currentController)
    {
        [currentController viewWillDisapear:animated];
        [currentController.view removeFromSuperView];
        removedController = currentController;
    }

    // tell the new controller it'll appear and add its view
    if (controller)
    {
        [controller viewWillAppear:animated];
        [self.view addSubView:controller.view];
        currentController = [controller retain];
    }

    // now tell them they did disappear/appear
    [removedController viewDidDisappear: animated];
    [currentController viewDidAppear: animated];
    [removedController release];
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-09T18:05:44.083

我只需向每个子视图添加一个 updataData 方法，并在您将其置于最前面的同时调用它。您需要向根视图控制器添加一个变量来跟踪活动的子视图：

```
[self.view exchangeSubviewAtIndex:1 withSubviewAtIndex:0];
if (subView1IsActive) [subView1Controller updateData];
else [subView2Controller updateData]; 
```

# python - Python、SQLite 和线程

> ID：524797
> 
> 赞同：9
> 
> 时间：2009-02-07T23:18:03.840
> 
> 标签：python, multithreading, sqlite

我正在开发一个应用程序，它将通过 HTTP 从多个地方收集数据，在本地缓存数据，然后通过 HTTP 提供服务。

所以我在看以下内容。我的应用程序将首先创建几个线程，这些线程将以指定的时间间隔收集数据并将该数据本地缓存到 SQLite 数据库中。

然后在主线程中启动一个 CherryPy 应用程序，它将查询该 SQLite 数据库并提供数据。

我的问题是：如何处理从我的线程和 CherryPy 应用程序到 SQLite 数据库的连接？

如果我将每个线程连接到数据库，我是否也能够创建/使用内存数据库？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-07T23:25:02.970

简短回答：不要在线程应用程序中使用 Sqlite3。

Sqlite3 数据库的规模可以很好地扩展，但并发性却非常糟糕。您将受到“数据库已锁定”错误的困扰。

如果这样做，则每个线程都需要一个连接，并且必须确保这些连接自行清理。这传统上使用线程本地会话处理，并且使用 SQLAlchemy 的 ScopedSession 执行得相当好（例如）。如果我是你，我会使用它，即使你没有使用 SQLAlchemy ORM 特性。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2018-05-01T07:08:58.883

正在进行此测试以确定从 SQLite 数据库写入和读取的最佳方式。我们遵循以下 3 种方法

1.  不带任何线程的读写（上面有normal的方法）
2.  使用线程读写
3.  使用进程读写

我们的示例数据集是一个虚拟生成的 OHLC 数据集，其中包含一个符号、时间戳和 6 个用于 ohlc 和 volumefrom、volumeto 的假值

读取

1.  普通方法读取大约需要 0.25 秒
2.  线程化方法需要 10 秒
3.  读取处理需要 0.25 秒

**获胜者：处理和正常**

写

1.  普通方法写大约需要1.5秒
2.  线程化方法大约需要 30 秒
3.  处理大约需要 30 秒

**获胜者：普通**

**注意：**并非所有记录都使用线程和处理的写入方法写入。线程和处理的写入方法显然会遇到数据库锁定错误，因为写入排队 SQlite 只会将写入排队到某个阈值，然后抛出 sqlite3.OperationalError 指示数据库已锁定。理想的方法是再次重试插入相同的块，但没有意义，因为并行插入的方法执行比顺序读取花费更多的时间，即使没有重试锁定/失败的插入如果不重试，97% 的行被写入并且仍然比顺序写入多 10 倍的时间

**外卖策略：**

1.  更喜欢阅读 SQLite 并将其写入同一线程

2.  如果必须进行多线程，请使用多处理读取具有或多或少相同性能的读取，并遵循单线程写入操作

3.  **不要使用线程**进行读取和写入，因为它在两者上都慢了 10 倍，你可以感谢 GIL

这是完整测试的代码

```
import sqlite3
import time
import random
import string
import os
import timeit
from functools import wraps
from concurrent.futures import ThreadPoolExecutor, ProcessPoolExecutor
import threading
import os

database_file = os.path.realpath('../files/ohlc.db')

create_statement = 'CREATE TABLE IF NOT EXISTS database_threading_test (symbol TEXT, ts INTEGER, o REAL, h REAL, l REAL, c REAL, vf REAL, vt REAL, PRIMARY KEY(symbol, ts))'
insert_statement = 'INSERT INTO database_threading_test VALUES(?,?,?,?,?,?,?,?)'
select = 'SELECT * from database_threading_test'

def time_stuff(some_function):
    def wrapper(*args, **kwargs):
        t0 = timeit.default_timer()
        value = some_function(*args, **kwargs)
        print(timeit.default_timer() - t0, 'seconds')
        return value
    return wrapper

def generate_values(count=100):
    end = int(time.time()) - int(time.time()) % 900
    symbol = ''.join(random.choice(string.ascii_uppercase + string.digits) for _ in range(10))
    ts = list(range(end - count * 900, end, 900))
    for i in range(count):
        yield (symbol, ts[i], random.random() * 1000, random.random() * 1000, random.random() * 1000, random.random() * 1000, random.random() * 1e9, random.random() * 1e5)

def generate_values_list(symbols=1000,count=100):
    values = []
    for _ in range(symbols):
        values.extend(generate_values(count))
    return values

@time_stuff
def sqlite_normal_read():
    """

    100k records in the database, 1000 symbols, 100 rows
    First run
    0.25139795300037804 seconds
    Second run

    Third run
    """
    conn = sqlite3.connect(os.path.realpath('../files/ohlc.db'))
    try:
        with conn:
            conn.execute(create_statement)
            results = conn.execute(select).fetchall()
            print(len(results))
    except sqlite3.OperationalError as e:
        print(e)

@time_stuff
def sqlite_normal_write():
    """
    1000 symbols, 100 rows
    First run
    2.279409104000024 seconds
    Second run
    2.3364172020001206 seconds
    Third run
    """
    l = generate_values_list()
    conn = sqlite3.connect(os.path.realpath('../files/ohlc.db'))
    try:
        with conn:
            conn.execute(create_statement)
            conn.executemany(insert_statement, l)

    except sqlite3.OperationalError as e:
        print(e)

@time_stuff
def sequential_batch_read():
    """
    We read all the rows for each symbol one after the other in sequence
    First run
    3.661222331999852 seconds
    Second run
    2.2836898810001003 seconds
    Third run
    0.24514851899994028 seconds
    Fourth run
    0.24082150699996419 seconds
    """
    conn = sqlite3.connect(os.path.realpath('../files/ohlc.db'))
    try:
        with conn:
            conn.execute(create_statement)
            symbols = conn.execute("SELECT DISTINCT symbol FROM database_threading_test").fetchall()
            for symbol in symbols:
                results = conn.execute("SELECT * FROM database_threading_test WHERE symbol=?", symbol).fetchall()
    except sqlite3.OperationalError as e:
        print(e)  

def sqlite_threaded_read_task(symbol):
    results = []
    conn = sqlite3.connect(os.path.realpath('../files/ohlc.db'))
    try:
        with conn:
            results = conn.execute("SELECT * FROM database_threading_test WHERE symbol=?", symbol).fetchall()
    except sqlite3.OperationalError as e:
        print(e)
    finally:
        return results

def sqlite_multiprocessed_read_task(symbol):
    results = []
    conn = sqlite3.connect(os.path.realpath('../files/ohlc.db'))
    try:
        with conn:
            results = conn.execute("SELECT * FROM database_threading_test WHERE symbol=?", symbol).fetchall()
    except sqlite3.OperationalError as e:
        print(e)
    finally:
        return results

@time_stuff
def sqlite_threaded_read():
    """
    1000 symbols, 100 rows per symbol
    First run
    9.429676861000189 seconds
    Second run
    10.18928106400017 seconds
    Third run
    10.382290903000467 seconds
    """
    conn = sqlite3.connect(os.path.realpath('../files/ohlc.db'))
    symbols = conn.execute("SELECT DISTINCT SYMBOL from database_threading_test").fetchall()
    with ThreadPoolExecutor(max_workers=8) as e:
        results = e.map(sqlite_threaded_read_task, symbols, chunksize=50)
        for result in results:
            pass

@time_stuff
def sqlite_multiprocessed_read():
    """
    1000 symbols, 100 rows
    First run
    0.2484774920012569 seconds!!!
    Second run
    0.24322178500005975 seconds
    Third run
    0.2863524549993599 seconds
    """
    conn = sqlite3.connect(os.path.realpath('../files/ohlc.db'))
    symbols = conn.execute("SELECT DISTINCT SYMBOL from database_threading_test").fetchall()
    with ProcessPoolExecutor(max_workers=8) as e:
        results = e.map(sqlite_multiprocessed_read_task, symbols, chunksize=50)
        for result in results:
            pass

def sqlite_threaded_write_task(n):
    """
    We ignore the database locked errors here. Ideal case would be to retry but there is no point writing code for that if it takes longer than a sequential write even without database locke errors
    """
    conn = sqlite3.connect(os.path.realpath('../files/ohlc.db'))
    data = list(generate_values())
    try:
        with conn:
            conn.executemany("INSERT INTO database_threading_test VALUES(?,?,?,?,?,?,?,?)",data)
    except sqlite3.OperationalError as e:
        print("Database locked",e)
    finally:
        conn.close()
        return len(data)

def sqlite_multiprocessed_write_task(n):
    """
    We ignore the database locked errors here. Ideal case would be to retry but there is no point writing code for that if it takes longer than a sequential write even without database locke errors
    """
    conn = sqlite3.connect(os.path.realpath('../files/ohlc.db'))
    data = list(generate_values())
    try:
        with conn:
            conn.executemany("INSERT INTO database_threading_test VALUES(?,?,?,?,?,?,?,?)",data)
    except sqlite3.OperationalError as e:
        print("Database locked",e)
    finally:
        conn.close()
        return len(data)

@time_stuff
def sqlite_threaded_write():
    """

    Did not write all the results but the outcome with 97400 rows written is still this...
    Takes 20x the amount of time as a normal write
    1000 symbols, 100 rows
    First run
    28.17819765000013 seconds
    Second run
    25.557972323000058 seconds
    Third run
    """
    symbols = [i for i in range(1000)]
    with ThreadPoolExecutor(max_workers=8) as e:
        results = e.map(sqlite_threaded_write_task, symbols, chunksize=50)
        for result in results:
            pass

@time_stuff
def sqlite_multiprocessed_write():
    """
    1000 symbols, 100 rows
    First run
    30.09209805699993 seconds
    Second run
    27.502465319000066 seconds
    Third run
    """
    symbols = [i for i in range(1000)]
    with ProcessPoolExecutor(max_workers=8) as e:
        results = e.map(sqlite_multiprocessed_write_task, symbols, chunksize=50)
        for result in results:
            pass

sqlite_normal_write() 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-03T08:17:18.997

[你可以使用类似的](http://code.activestate.com/recipes/526618/)东西。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-08T00:54:01.637

“...创建几个线程，以指定的时间间隔收集数据并将该数据本地缓存到 sqlite 数据库中。然后在主线程中启动一个 CherryPy 应用程序，该应用程序将查询该 sqlite db 并提供数据。”

不要在线程上浪费大量时间。您所描述的只是操作系统进程。只需启动普通进程来收集和运行 Cherry Py。

为此，您没有真正使用单个进程中的并发线程。以指定的时间间隔收集数据——当使用简单的操作系统进程完成时——可以由操作系统非常简单地安排。例如，Cron 在这方面做得很好。

CherryPy 应用程序也是一个操作系统进程，而不是某个更大进程的单个线程。

只使用进程——线程不会帮助你。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-08T01:21:37.697

根据应用程序，数据库可能是真正的开销。如果我们谈论的是易失性数据，也许您可​​以完全跳过通过 DB 进行的通信，并通过 IPC在*数据收集进程*和*数据服务进程之间共享数据。*当然，如果必须持久保存数据，这不是一个选项。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-08T01:33:41.587

根据数据速率，sqlite 可能是执行此操作的正确方法。每次写入都会锁定整个数据库，因此您不会扩展到每秒 1000 次同时写入。但是，如果您只有几个，这是确保您不会互相覆盖的最安全方法。

# java - FileChannel 和 RandomAccessFile 似乎不起作用

> ID：524804
> 
> 赞同：2
> 
> 时间：2009-02-07T23:21:55.690
> 
> 标签：java, file-io, locking, nio

简单来说：一个使用 sqlitejdbc 作为后端的摇摆应用程序。目前，启动使用同一数据库文件的多个实例没有问题。应该有。该文件被锁定（在应用程序运行时无法删除它），因此检查应该是微不足道的。结果不是。

```
 File f = new File("/path/to/file/db.sqlite");
    FileChannel channel = new RandomAccessFile(f, "rw").getChannel();
    System.out.println(channel.isOpen());
    System.out.println(channel.tryLock()); 
```

结果是

```
 true
    sun.nio.ch.FileLockImpl[0:9223372036854775807 exclusive valid] 
```

无论应用程序是否正在运行。我错过了重点吗？TIA。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-08T00:25:15.577

FileLocks 是 JVM 独有的，而不是单独的线程。因此，如果您在与 Swing 应用程序相同的进程中运行该代码，您将获得锁，因为它是由 JVM 共享的。

如果您的 Swing 应用程序没有运行，则没有其他进程在争夺锁，因此您将获得它。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-09T08:26:49.700

文件系统级别的锁与其他应用程序交互。您可以从 FileChannel 获得其中之一。因此，您在示例代码中所做的操作将使文件看起来被锁定到另一个进程，例如 vi。

但是，JVM 中的其他 Java 线程或进程将看不到锁。关键句是*“文件锁代表整个 Java 虚拟机持有。它们不适用于控制同一虚拟机内的多个线程对文件的访问。”* 您没有看到锁，因此您在与应用程序相同的 JVM 中运行 sqlitejdbc。

所以问题是您如何查看您的 JVM 是否已经获得了文件锁定（假设您不控制获取锁定的代码）？我的一个建议是尝试在文件的不同子集上获取排他锁，例如使用以下代码：

```
fc.tryLock(0L, 1L, false) 
```

如果已经有锁，你应该得到一个 OverlappingFileLockException。这有点hacky，但可能会奏效。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-09T08:48:16.950

你能做一个小实验吗？运行这个程序的两个副本（只是你的代码睡眠）：

```
public class Main {
    public static void main(String [] args) throws Exception {
        File f = new File("/path/to/file/db.sqlite");
        FileChannel channel = new RandomAccessFile(f, "rw").getChannel();
        System.out.println(channel.isOpen());
        System.out.println(channel.tryLock());
        Thread.sleep(60000);
    }
} 
```

如果这没有锁定，您就知道 tryLock() 在您的操作系统/驱动器/JVM 上不起作用。如果这确实锁定了，那么您的逻辑还有其他问题。让我们在评论中知道结果。

# c++ - 如何将图片放大到 300 DPI？

> ID：524805
> 
> 赞同：5
> 
> 时间：2009-02-07T23:22:55.237
> 
> 标签：c++, image-processing, computer-vision, tesseract

[C++ Library for image recognition: images contains words to string](https://stackoverflow.com/questions/462860/c-library-for-image-recognition-images-containing-words-to-string)问题的公认答案建议您：

1.  将输入图像放大/缩小到 300 DPI。

我将如何做到这一点...我的印象是 DPI 用于显示器，而不是图像格式。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-08T00:18:32.363

每当您将像素中的图像与具有图片大小的物理设备相关联时，DPI 都是有意义的。在 OCR 的情况下，它通常意味着扫描的分辨率，即每英寸扫描将获得多少像素。12 磅字体意味着以每行 12/72 英寸打印，大写字符可能占其中的 80%；因此，当以 300 DPI 扫描时，它的高度约为 40 像素。

许多图像格式都记录了 DPI。如果图像被扫描，这应该是扫描仪的准确设置。如果它来自数码相机，它总是显示 72 DPI，这是 EXIF 规范强制要求的默认值；这是因为相机无法知道图像的原始大小。当您使用成像程序创建图像时，您可能有机会将 DPI 设置为任意值。这是为了方便您指定最终图像的使用方式，并且与图像中包含的细节无关。

这是之前的一个问题，询问了调整图像大小的细节： [如何对图像进行高质量缩放？](https://stackoverflow.com/questions/353039/how-do-i-do-high-quality-scaling-of-a-image)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-08T00:34:25.420

我认为这里更准确的术语是**[resampling](http://en.wikipedia.org/wiki/Resampling)**。您需要足够高的像素分辨率来支持准确的 OCR。字体大小（例如，以[磅](http://en.wikipedia.org/wiki/Point_%28typography%29)为单位）通常以长度为单位，而不是像素。由于 72 点 = 1 英寸，我们需要每点 300/72 像素才能获得 300 dpi（“每英寸像素”）的分辨率。这意味着典型的 12 磅字体的高度（或更准确地说，单行距文本中的基线到基线的距离）为 50 像素。

理想情况下，您的源文档应该以适合给定字体大小的分辨率进行扫描，以使图像中的字体大约为 50 像素高。如果分辨率太高/太低，您可以使用图形程序（例如[GIMP](http://www.gimp.org/)）轻松地重新采样图像。您也可以通过图形库以编程方式执行此操作，例如[ImageMagick](http://www.imagemagick.org/script/index.php)，它具有许多编程语言的接口。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-07T23:27:20.377

OCR 软件通常设计为使用“正常”字体大小。从图像的角度来看，这意味着它将寻找可能在 30 到 100 像素高度范围内的字母。分辨率更高的图像会产生看起来太大的字母，OCR 软件无法有效处理。同样，较低分辨率的图像不会为软件提供足够的像素来识别字母。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-08T01:05:37.183

“我该怎么做……我的印象是 dpi 是用于显示器的，而不是图像格式。”

DPI 代表每英寸点数。跟显示器有什么关系？好吧，我们有一个由三个 RGB 子像素组成的像素。DPI 越高，您塞入该空间的细节就越多。

DPI 对显示和打印来说是一种有用的度量，但没有什么用处……事实上，对于图像格式本身没有任何用处。

在某些格式中标记 DPI 的原因是指示设备以该分辨率显示，但据我了解，几乎所有人都忽略了该指令，并尽最大努力优化特定输出的图像。

您可以将图像格式的 72 dpi 更改为 1 dpi 或 6000 dpi，这在显示器上不会产生任何影响。“放大/缩小到 300 dpi”没有意义。重采样也不会改变 DPI。在 Photoshop 中尝试，在更改 DPI 时取消选中“重新采样”，你会发现没有任何区别。它不会变大或变小。

DPI 对于图像格式完全没有意义，IMO。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-08T03:00:12.303

如果您的目标是 OCR，则 DPI 作为原始扫描文档中每英寸图像中的点数是有意义的。如果你的 dpi 太低，信息就永远消失了，即使是双三次插值也不能很好地恢复它。如果你的 dpi 太高，很容易丢掉比特。

完成工作；我是 netpbm/pbmplus 工具集的忠实粉丝；开始的工具是`pnmscale`，但如果您有位图，您需要考虑相关工具，例如`pbmreduce`.

# c# - 处理基于线路的网络 I/O 流的好方法是什么？

> ID：524818
> 
> 赞同：6
> 
> 时间：2009-02-07T23:31:33.363
> 
> 标签：c#, .net, asynchronous, network-programming

注意：让我为这个问题的长度道歉，我不得不在其中输入很多信息。我希望这不会导致太多人简单地略读并做出假设。请完整阅读。谢谢。

我有一个通过套接字传入的数据流。该数据是面向行的。

我正在使用 .NET（BeginRead 等）的 APM（异步编程方法）。这排除了使用基于流的 I/O，因为异步 I/O 是基于缓冲区的。可以重新打包数据并将其发送到流，例如内存流，但也存在问题。

问题是我的输入流（我无法控制）没有给我任何关于流有多长的信息。它只是一个看起来像这样的换行符流：

```
COMMAND\n
...Unpredictable number of lines of data...\n
END COMMAND\n
....repeat.... 
```

因此，使用 APM，并且由于我不知道任何给定的数据集会有多长时间，数据块很可能会跨越需要多次读取的缓冲区边界，但这些多次读取也将跨越多个数据块。

例子：

```
Byte buffer[1024] = ".................blah\nThis is another l"
[another read]
                    "ine\n.............................More Lines..." 
```

我的第一个想法是使用 StringBuilder 并将缓冲区行简单地附加到 SB。这在某种程度上有效，但我发现很难提取数据块。我尝试使用 StringReader 读取换行数据，但无法知道您是否获得了完整的行，因为 StringReader 在添加的最后一个块的末尾返回部分行，然后返回 null 。没有办法知道返回的是否是完整的换行数据行。

例子：

```
// Note: no newline at the end
StringBuilder sb = new StringBuilder("This is a line\nThis is incomp..");
StringReader sr = new StringReader(sb);
string s = sr.ReadLine(); // returns "This is a line"
s = sr.ReadLine();        // returns "This is incomp.." 
```

更糟糕的是，如果我只是继续追加数据，缓冲区会变得越来越大，而且由于这可能一次运行数周或数月，这不是一个好的解决方案。

我的下一个想法是在阅读时从 SB 中删除数据块。这需要编写我自己的 ReadLine 函数，但后来我在读写过程中卡住了数据。此外，较大的数据块（可能包含数百个读取和数兆字节的数据）需要扫描整个缓冲区以查找换行符。它效率不高，而且很丑陋。

我正在寻找具有 StreamReader/Writer 的简单性和异步 I/O 的便利性的东西。

我的下一个想法是使用 MemoryStream，并将数据块写入内存流，然后将 StreamReader 附加到流并使用 ReadLine，但我再次遇到问题，知道缓冲区中的最后一次读取是否是完整的行或不是，而且从流中删除“陈旧”数据更加困难。

我还考虑过使用具有同步读取的线程。这样做的好处是，使用 StreamReader，它将始终从 ReadLine() 返回整行，除非在连接断开的情况下。但是，这会导致取消连接的问题，并且某些类型的网络问题可能会导致长时间挂起阻塞套接字。我正在使用异步 IO，因为我不想在程序阻塞数据接收的整个生命周期中占用一个线程。

连接是持久的。随着时间的推移，数据将继续流动。在初始连接期间，有大量数据流，一旦该流完成，套接字保持打开状态等待实时更新。我不确切知道初始流程何时“完成”，因为唯一知道的方法是不会立即发送更多数据。这意味着我不能等待初始数据加载在处理之前完成，因为它进入时我几乎被“实时”处理。

那么，任何人都可以提出一种不太复杂的方式来处理这种情况的好方法吗？我真的希望它尽可能简单和优雅，但由于所有边缘情况，我不断提出越来越复杂的解决方案。我想我想要的是某种 FIFO，我可以在其中轻松地继续追加更多数据，同时从中弹出符合某些条件的数据（即换行符终止的字符串）。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-08T01:33:22.243

这是一个相当有趣的问题。正如您所建议的那样，我过去的解决方案是使用具有同步操作的单独线程。（我设法解决了使用锁和大量异常处理程序阻塞套接字的大部分问题。）不过，通常建议使用内置异步操作，因为它允许真正的操作系统级异步 I/O，所以我理解你的观点。

好吧，我已经写了一个类来完成我认为你需要的东西（我会说是一种相对干净的方式）。让我知道你的想法。

```
using System;
using System.Collections.Generic;
using System.IO;
using System.Text;

public class AsyncStreamProcessor : IDisposable
{
    protected StringBuilder _buffer;  // Buffer for unprocessed data.

    private bool _isDisposed = false; // True if object has been disposed

    public AsyncStreamProcessor()
    {
        _buffer = null;
    }

    public IEnumerable<string> Process(byte[] newData)
    {
        // Note: replace the following encoding method with whatever you are reading.
        // The trick here is to add an extra line break to the new data so that the algorithm recognises
        // a single line break at the end of the new data.
        using(var newDataReader = new StringReader(Encoding.ASCII.GetString(newData) + Environment.NewLine))
        {
            // Read all lines from new data, returning all but the last.
            // The last line is guaranteed to be incomplete (or possibly complete except for the line break,
            // which will be processed with the next packet of data).
            string line, prevLine = null;
            while ((line = newDataReader.ReadLine()) != null)
            {
                if (prevLine != null)
                {
                    yield return (_buffer == null ? string.Empty : _buffer.ToString()) + prevLine;
                    _buffer = null;
                }
                prevLine = line;
            }

            // Store last incomplete line in buffer.
            if (_buffer == null)
                // Note: the (* 2) gives you the prediction of the length of the incomplete line, 
                // so that the buffer does not have to be expanded in most/all situations. 
                // Change it to whatever seems appropiate.
                _buffer = new StringBuilder(prevLine, prevLine.Length * 2);
            else
                _buffer.Append(prevLine);
        }
    }

    public void Dispose()
    {
        Dispose(true);
        GC.SuppressFinalize(this);
    }

    private void Dispose(bool disposing)
    {
        if (!_isDisposed)
        {
            if (disposing)
            {
                // Dispose managed resources.
                _buffer = null;
                GC.Collect();
            }

            // Dispose native resources.

            // Remember that object has been disposed.
            _isDisposed = true;
        }
    }
} 
```

应该为每个 NetworkStream 创建一个此类的实例，并且每当接收到新数据时都应该调用 Process 函数（在 BeginRead 的回调方法中，在你调用下一个 BeginRead 之前，我会想象）。

注意：我仅使用测试数据验证了此代码，而不是通过网络传输的实际数据。但是，我预计不会有任何差异......

此外，警告该类当然不是线程安全的，但只要在处理当前数据之前不再次执行 BeginRead （正如我假设你正在做的那样），就不会有任何问题。

希望这对你有用。如果还有其他问题，请告诉我，我将尝试修改解决方案来处理它们。（尽管仔细阅读，我可能错过了一些微妙的问题！）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-08T01:13:51.800

你在你的问题中解释的内容让我非常想起 ASCIZ 字符串。（[链接文本](http://www.joelonsoftware.com/articles/fog0000000319.html)）。这可能是一个有益的开始。

我不得不在大学里为我正在做的一个项目写类似的东西。不幸的是，我控制了发送套接字，所以我插入了一段消息字段作为协议的一部分。但是，我认为类似的方法可能会使您受益。

我如何接近我的解决方案是我会发送类似 5HELLO 的内容，所以首先我会看到 5，并且知道我的消息长度为 5，因此我需要的消息是 5 个字符。但是，如果在我的异步读取中，我只有 5HE，我会看到我的消息长度为 5，但我只能从线路读取 3 个字节（假设 ASCII 字符）。因此，我知道我丢失了一些字节，并将我拥有的内容存储在片段缓冲区中。每个套接字我有一个片段缓冲区，因此避免了任何同步问题。粗略的过程是。

1.  从socket读入字节数组，记录读取了多少字节
2.  逐字节扫描，直到找到换行符（如果您没有接收到 ascii 字符，这将变得非常复杂，但是可能是多个字节的字符，您只能自己处理）
3.  将您的片段缓冲区转换为字符串，并将您的读取缓冲区追加到新行。将此字符串作为已完成的消息放入队列或要处理的它自己的委托中。（您可以通过实际读取套接字写入与片段相同的字节数组来优化这些缓冲区，但这很难解释）
4.  继续循环，每次我们找到一个新行时，从记录的开始/结束位置的字节排列创建一个字符串，然后放到队列/委托上进行处理。
5.  一旦我们到达读取缓冲区的末尾，就将剩下的任何内容复制到片段缓冲区中。
6.  调用套接字上的 BeginRead，这将跳转到第 1 步。当套接字中的数据可用时。

然后你使用另一个线程来读取你的incommign消息队列，或者只是让线程池使用委托来处理它。并进行您必须做的任何数据处理。如果我错了，有人会纠正我，但这几乎没有线程同步问题，因为你只能在任何时候从套接字读取或等待读取，所以不用担心锁（除非你是填充队列，我在实现中使用了委托）。您需要自己解决一些细节，例如要留下多大的片段缓冲区，如果在读取时收到 0 个换行符，则必须将整个消息附加到片段缓冲区而不会覆盖任何事物。我认为它最终运行了大约 700 到 800 行代码，但其中包括连接设置、加密协商、

这个设置对我来说表现得非常好；使用这个实现一个包括加密处理的 1.8Ghz opteron，我能够在 100Mbps 以太网上执行高达 80Mbps 的速度。而且由于您与套接字绑定，因此服务器将扩展，因为可以同时处理多个套接字。如果您需要按顺序处理项目，则需要使用队列，但如果顺序无关紧要，那么委托将为您提供线程池之外的非常可扩展的性能。

希望这会有所帮助，这并不是一个完整的解决方案，而是一个开始寻找的方向。

*请注意，我的实现完全在字节级别并支持加密，我在示例中使用了字符以使其更易于可视化。

# performance - 我如何故意从主内存与缓存中读取？

> ID：524821
> 
> 赞同：5
> 
> 时间：2009-02-08T00:09:34.033
> 
> 标签：performance, caching, assembly, masm

所以我正在学习汇编，我们有一个任务是找到从内存读取和从缓存读取之间的时间差。我们必须通过创建 2 个循环并对它们进行计时来做到这一点。（一个从主存读取，另一个从缓存中读取）。问题是，我不知道也找不到任何告诉我如何从缓存或主内存中读取的东西=/。你们能帮帮我吗？我在 MASM32 中这样做。我了解如何制作循环以及大多数汇编语言，但我就是无法阅读 =/

* * *

**编辑：**

我有一个问题，我已经这样做了......

```
mov ecx, 100 ;loop 100 times
xor eax, eax ;set eax to 0
_label:
mov eax, eax ;according to me this is read memory is that good?
dec ecx ;dec loop
jnz _label ;if still not equal to 0 goes again to _label 
```

……这样可以吗？

* * *

**编辑2：**

那么，我不打算撬，感谢您的帮助，我还有另一个问题，因为这是我必须做的两个循环。我需要以某种方式比较它们，我一直在寻找计时器指令，但我没有找到任何我只找到的：**timeGetTime**，**GetTickCount**和**Performance Counter**但据我了解，这些指令返回系统时间而不是时间循环完成。有没有办法真正做我想做的事？还是我需要考虑另一种方式？

此外，如果我给出各种“mov”指令，可以在第二个循环中读取不同的寄存器（不从缓存中读取的寄存器）吗？还是我完全不在这儿？

很抱歉所有这些问题，但再次感谢您的帮助。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-08T00:13:55.883

从缓存中读取。有一个从相同（或非常相似）的内存地址读取的循环：

*   第一次从该地址读取时，该内存地址（以及其他附近的内存地址）中的值将被移动到缓存中
*   **下次**您从**同一个**地址读取时，这些值已经被缓存，因此您正在从缓存中读取。

要读取未缓存的内存，请使用一个从许多非常不同（即比缓存大小相距更远）的内存地址读取的循环。

* * *

回答你的第二个问题：

*   你用 ecx 和 jnz 做的事情看起来不错（我不知道你的计时器有多准确/敏感，但你可能想要循环超过 100 次）

*   这`mov eax, eax`不是“读取内存”......它是一个无操作，它将 eax 移动到 eax。相反，我认为从内存中读取的 MASM 语法更像是`mov eax,[esi]`（“从地址包含在`esi`”中的内存位置读取）

*   根据您使用的操作系统，您必须从实际存在且可读的内存地址中读取。例如，在 Windows 上，不允许应用程序执行`mov esi, 0`后面的操作，`mov eax, [esi]`因为不允许应用程序读取地址/位置为零的内存。

* * *

回答你的第三个问题：

> timeGetTime、GetTickCount 和性能计数器

您提到 timeGetTime、GetTickCount 和 Performance Counter 意味着您在 Windows 下运行。

是的，这些将当前时间返回到各种分辨率/精度：例如，GetTickCount 的分辨率约为 50 毫秒，因此它无法对持续时间少于 50 毫秒的事件进行计时，当对仅持续 50-100 的事件进行计时时不准确毫秒。这就是为什么我说`100`你的`ecx`可能还不够大。

该`QueryPerformanceCounter`功能可能是您拥有的最准确的计时器。

要将这些计时器中的任何一个用作间隔计时器：

*   在开始循环之前花点时间
*   完成循环后再次获取时间
*   减去这两次：差就是时间间隔

> 如果我给出各种“mov”指令可以吗？

是的，我想是这样。我认为您可以这样做（请注意，我不确定/不记得这是否是从名称存储位置读取的正确 MASM 语法）...

```
mov eax,[memory1]
mov eax,[memory2]
mov eax,[memory3]
mov eax,[memory4]
mov eax,[memory5] 
```

... 其中`memory1`through`memory5`是数据段中间隔较宽的全局变量的地址。

或者，你可以做...

```
mov eax,[esi]
add esi,edx
mov eax,[esi]
add esi,edx
mov eax,[esi]
add esi,edx
mov eax,[esi]
add esi,edx
mov eax,[esi] 
```

...其中 esi 指向一个长内存块的底部，而 edx 是一些增量，等于该块长度的大约五分之一。

# c - 使用#defines 自动替换变量

> ID：524825
> 
> 赞同：3
> 
> 时间：2009-02-08T00:14:17.020
> 
> 标签：c, string, replace, c-preprocessor

我有一个文件，其中包含大约 100 个#define，从 1 到 100，每个都有一个唯一的字符串值。

现在我正在尝试打印此值，但我想打印#define 是什么而不是该值。例如：

```
#define FIRST_VALUE 1
var = FIRST_VALUE;
printf("%s", var); 
```

我希望 printf 打印 FIRST_VALUE，而不是 1。

有没有办法在C中做到这一点？还是我必须在 switch 语句中写出 100 多个 case 块？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-02-08T00:39:01.337

您可以使用[字符串化](http://gcc.gnu.org/onlinedocs/cpp/Stringification.html#Stringification)来实现您正在寻找的内容：

```
 #define FIRST_MACRO
  #define MACRO_TO_STRING(x) #x

  #include <stdio.h>

  main() {
     printf("%s\n",  MACRO_TO_STRING(FIRST_MACRO));
  } 
```

该程序将输出：

```
FIRST_MACRO

```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-09T17:16:44.543

在与我在学校的一位助教交谈后，我们决定最好的方法是编写一个 AWK 脚本来处理头文件并自动生成所有需要的案例语句。

多谢你们！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-02T12:26:33.393

你不能完全按照你的意愿去做，因为当编译器得到预处理器输出时，“ONE”标记早已不复存在。但是，如果您的目标是编写一次常量列表但同时生成标记和字符串，则可以这样做。

首先，使用宏将常量构建为头文件中的枚举。文件枚举.h：

```
#ifndef ENUMS_H
#define ENUMS_H

#ifndef 枚举
#define ENUM(name,val) enum { name = val };
＃万一

枚举（一，1）
枚举（二，2）
枚举（三，3）

#endif /* ENUMS_H */

```

其次，在 .c 文件中重新定义宏以创建字符串/整数映射并将 .h 文件包含在正确的位置。文件枚举.c：

```
＃包括
＃包括

类型定义结构{
        字符 *str;
        整数值；
} 描述枚举；

静态 DescriptiveEnum 枚举[] = {
#define ENUM(name,val) { #name, val },
#include “枚举.h”
};
#define NUM_ENUMS (sizeof(enums)/sizeof(enums[0]))

char *enum_to_str(int val)
{
        诠释我;
        对于 (i=0;i<NUM_ENUMS;i++) {
                if (enums[i].val == val) 返回 enums[i].str;
        }
        返回 ””;
}

```

现在枚举常量和映射函数都可供调用者使用。文件 main.c：

```
#include <stdio.h>
#include <stdlib.h>
#include “枚举.h”

char *enum_to_str(int val);

int main(int argc, char *argv[])
{
        整数值；

        值=一；

        printf("%d %s\n",val,enum_to_str(val));

        返回 EXIT_SUCCESS；
}

```

# c - LINUX：是否可以编写不依赖 libc 库的工作程序？

> ID：524826
> 
> 赞同：8
> 
> 时间：2009-02-08T00:14:29.220
> 
> 标签：c, linux, binary, dependencies, executable

我想知道我是否可以用`C`可执行的-programming 语言编写一个程序，尽管不使用单个库调用，例如甚至不使用exit()？

如果是这样，它显然根本不依赖库（libc、ld-linux）。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-08T00:42:38.647

我怀疑你可以写这样的东西，但它最后需要有一个无限循环，因为你不能要求操作系统退出你的进程。你不能做任何有用的事情。

从编译 ELF 程序开始，查看 ELF 规范并将标题、程序段和程序所需的其他部分一起制作。内核将加载您的代码并跳转到某个初始地址。你可以在那里放置一个无限循环。但是，如果不了解一些汇编程序，无论如何从一开始就是没有希望的。

glibc 使用的[`start.S`](http://cvs.savannah.gnu.org/viewvc/libc/sysdeps/i386/elf/start.S?root=libc&view=markup)文件可以作为一个有用的起点。尝试更改它，以便您可以从中组装一个独立的可执行文件。该 start.S 文件是所有 ELF 应用程序的入口点，并且是调用`__libc_start_main`该文件的那个，而该文件又调用`main`. 您只需更改它以使其适合您的需求。

好吧，那是理论上的。但是现在，它有什么实际用途呢？

### 回答更新的问题

好。有一个名为的库`libgloss`，它为旨在在嵌入式系统上运行的程序提供最小接口。`newlib`C 库使用它作为其系统调用接口。总体思路是 libgloss 是 C 库和操作系统之间的层。因此，它还包含操作系统跳转到的启动文件。这两个库都是 GNU binutils 项目的一部分。我用它们为另一个操作系统和另一个处理器做接口，但似乎没有用于 Linux 的 libgloss 端口，所以如果你调用系统调用，你将不得不自己做，正如其他人已经说过的那样.

用 C 编程语言编写程序是绝对可能的。*linux 内核*就是这样一个程序的一个很好的例子。但用户程序也是可能的。但最低限度需要的是一个运行时库（如果你想做任何严肃的事情）。这样的一个将包含真正的基本功能，如 memcpy、基本宏等。C 标准有一种特殊的一致性模式，称为*freestanding*，它只需要非常有限的功能集，也适用于内核。实际上，我对 x86 汇编器*一无所知*，但我已经为一个非常简单的 C 程序尝试了运气：

```
/* gcc -nostdlib start.c */
int main(int, char**, char**);

void _start(int args)
{
    /* we do not care about arguments for main. start.S in 
     * glibc documents how the kernel passes them though.
     */
    int c = main(0,0,0);

    /* do the system-call for exit. */
    asm("movl   %0,%%ebx\n" /* first argument */
        "movl   $1,%%eax\n" /* syscall 1 */
        "int    $0x80"      /* fire interrupt */
        : : "r"(c) :"%eax", "%ebx");
}

int main(int argc, char** argv, char** env) {
    /* yeah here we can do some stuff */
    return 42;
} 
```

我们很高兴，它实际上可以编译并运行:)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-08T00:25:41.600

是的，这是可能的，但是您必须进行系统调用并手动设置您的入口点。

带有入口点的最小程序示例：

```
.globl _start
.text
_start:
    xorl %eax,%eax
    incl %eax
    movb $42, %bl
    int $0x80 
```

或者在纯 C 中（没有出口）：

```
void __attribute__((noreturn)) _start() {
    while(1);
} 
```

编译：

```
gcc -nostdlib -o example example.s
gcc -nostdlib -o example example.c 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-08T01:13:08.680

在纯 C? 正如其他人所说，您仍然需要一种方法来进行系统调用，因此您可能需要为此下拉到内联 asm。也就是说，如果使用 gcc，请查看 -ffreestanding。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-08T02:53:04.360

您需要一种方法来防止 C 编译器生成依赖于 libc 的代码，这`gcc`可以通过`-fno-hosted`. 而且您需要一个汇编语言例程来实现`syscall(2)`. 如果你能得到合适的 OS doco，它们并不难写。在那之后，您将参加比赛。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-08T00:16:54.690

好吧，您需要使用一些系统调用将所有信息加载到内存中，所以我对此表示怀疑。

而且您几乎必须使用 exit()，只是因为 Linux 的工作方式。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-08T09:43:52.767

是的，你可以，但这很棘手。

基本上没有任何意义。

您可以静态链接程序，但随后 C 库的适当部分包含在其二进制文件中（因此它没有任何依赖项）。

You can completely do without the C library, in which case you need to make system calls using the appropriate low-level interface, which is architecture dependent, and not necessarily int 0x80.

If your goal is making a very small self-contained binary, you might be better off static-linking against something like uclibc.

# iphone - 格式化 NSNumber 对象时如何指定小数位？

> ID：524827
> 
> 赞同：10
> 
> 时间：2009-02-08T00:15:59.980
> 
> 标签：iphone, cocoa, cocoa-touch

我正在使用下面的 Objective-C 代码来格式化 NSNumber，它在大多数情况下都可以正常工作，但是当 NSNumber 对象包含一个整数（没有小数部分）时，它并不能完全满足我的要求。

```
UILabel *label = [[UILabel alloc] initWithFrame:CGRectMake(80.0f, 90.0f, 225.0f, 40.0f)];
label.backgroundColor = [UIColor clearColor];
label.textColor = [UIColor whiteColor];
NSNumberFormatter *formatter = [[NSNumberFormatter alloc] init];
[formatter setNumberStyle:NSNumberFormatterDecimalStyle];
[formatter setFormat:@"###.##"];
int bytes = 1024 * 1024;
NSNumber *total = [NSNumber numberWithFloat:([self.totalFileSize floatValue] / bytes)];
label.text = [NSString stringWithFormat:@"0.00 MB of %@ MB", [formatter stringFromNumber:total]]; 
```

因此，例如，如果`self.totalFileSize`持有 55.2300，它将在我的`UILabel`. 但如果同一个变量包含 55，它只会在标签上显示“55”。

我真正想要的是此代码始终在输出中包含 2 位小数。

我怎样才能做到这一点？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-02-08T01:14:25.807

`0`对于您希望始终存在的每个小数位，您的格式字符串应该有一个“ ”。

```
[formatter setFormat:@"###.00"]; 
```

对于“55.23”和“.23”和“.20”

```
[formatter setFormat:@"##0.00"]; 
```

对于“55.23”和“0.23”和“0.20”

请参阅[数字格式字符串语法（Mac OS X 版本 10.0 到 10.3）](http://developer.apple.com/documentation/Cocoa/Conceptual/DataFormatting/Articles/df100103.html#//apple_ref/doc/uid/20000195-SW11)

或者您可以使用 10.4 格式化程序与[- setMinimumFractionDigits:](http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSNumberFormatter_Class/Reference/Reference.html#//apple_ref/occ/instm/NSNumberFormatter/setMinimumFractionDigits:)和[- setMaximumFractionDigits:](http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSNumberFormatter_Class/Reference/Reference.html#//apple_ref/occ/instm/NSNumberFormatter/setMaximumFractionDigits:)两者都设置为 2。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-02-08T00:29:07.410

我相信您正在寻找的是：“%.2f”

最坏的情况，您可以拆分值，检查小数点后是否有任何内容。如果没有手动添加00？

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-08T01:13:16.107

使用localizedStringWithFormat 可能会更好，就像这样......

```
[UILabel alloc] initWithFrame:CGRectMake(80.0f, 90.0f, 225.0f, 40.0f)];
label.backgroundColor = [UIColor clearColor];
label.textColor = [UIColor whiteColor];
int bytes = 1024 * 1024;
label.text = [NSString localizedStringWithFormat:@"0.00 MB of %.2f MB", ([self.totalFileSize floatValue] / bytes)]; 
```

当然，*bytes*可能是*const unsigned*，而 clearColor 往往会占用性能，但这些是另一个线程的问题。

# ruby - 如何使用正则表达式从 HTML 中提取链接？

> ID：524829
> 
> 赞同：1
> 
> 时间：2009-02-08T00:17:19.540
> 
> 标签：ruby, regex

我想从 google.com 中提取链接；我的 HTML 代码如下所示：

```
<a href="http://www.test.com/" class="l" 
```

我花了大约五分钟的时间找到了一个可以使用 www.rubular.com 的正则表达式。这是：

```
"(.*?)" class="l" 
```

代码是：

```
require "open-uri"
url = "http://www.google.com/search?q=ruby"

source = open(url).read()
links = source.scan(/"(.*?)" class="l"/) 

links.each { |link| puts #{link} 
} 
```

问题是，它不输出网站链接吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-08T00:35:34.340

那些链接实际上`class=l`没有`class="l"`。顺便说一句，为了解决这个问题，我在方法中添加了一些日志记录，以便您可以查看各个阶段的输出并对其进行调试。我搜索了您希望找到的字符串但没有找到，这就是您的正则表达式失败的原因。因此，我寻找了您真正想要的正确字符串并相应地更改了正则表达式。调试技巧很方便。

```
require "open-uri"
url = "http://www.google.com/search?q=ruby"

source = open(url).read

puts "--- PAGE SOURCE ---"
puts source

links = source.scan(/<a.+?href="(.+?)".+?class=l/)

puts "--- FOUND THIS MANY LINKS ---"
puts links.size

puts "--- PRINTING LINKS ---"
links.each do |link|
  puts "- #{link}"
end 
```

我还改进了你的正则表达式。您正在寻找一些以 a 标签 ( ) 开头的文本`<a`，然后是一些您不关心的字符 ( `.+?`)、一个 href 属性 ( `href="`)、您想要捕获的 href 属性的内容 ( `(.+?)`)，一些空格或其他属性 ( `.+?`)，最后是类属性 ( `class=l`)。

我`.+?`在那里三个地方。表示`.`任何字符，`+`表示在它之前必须有一个或多个事物，以及`?`表示`.+`应该尝试匹配尽可能短的字符串。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-08T00:39:31.697

坦率地说，问题在于您使用的是正则表达式。问题是 HTML 是一种所谓的[上下文无关语言](http://en.wikipedia.org/wiki/Context_free_language)，而正则表达式只能是被称为[正则语言的一类语言](http://en.wikipedia.org/wiki/Regular_language)。

您应该做的是将页面数据发送到可以处理 HTML 代码的解析器，例如 Hpricot，然后遍历您从解析器获得的解析树。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-08T00:35:06.183

> 我怎么了？

您正在尝试使用正则表达式解析 HTML。不要那样做。即使是有效的 XHTML，正则表达式也无法涵盖语法范围，更不用说现实世界的标签汤了。使用 HTML 解析器库，例如 Hpricot。

FWIW，当我获取 '<a href="http://www.google.com/search?q=ruby" rel="nofollow noreferrer">http://www.google.com/search?q=ruby'我在返回的标记中的任何地方都没有收到 'class="l"'。也许这取决于您使用的是哪个本地 Google 和/或您是否已登录或是否拥有 Google cookie。（你的剧本，和我一样，不会。）

# php - Python 相当于 $this->$varName

> ID：524831
> 
> 赞同：3
> 
> 时间：2009-02-08T00:17:52.910
> 
> 标签：php, python

在 PHP 中，我可以执行以下操作：

```
$myVar = 'name';

print $myClass->$myVar;
// Identical to $myClass->name 
```

我希望在 Python 中执行此操作，但不知道如何

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-02-08T00:21:43.387

在 python 中，它是 getattr 内置函数。

```
class Something( object ):
    def __init__( self ):
        self.a= 2
        self.b= 3

x= Something()
getattr( x, 'a' )
getattr( x, 'b' ) 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-08T00:24:51.617

您将需要使用 getattr 内置函数。

```
myvar = 'name'

//both should produce the same results
value = obj.name
value = getattr(obj, myvar) 
```

# .net - 适用于 .NET Web 应用程序的 32 位构建服务器和 64 位生产服务器

> ID：524837
> 
> 赞同：3
> 
> 时间：2009-02-08T00:19:53.327
> 
> 标签：.net, asp.net, asp.net-mvc, build-process, 64-bit

我们的工作站运行 64 位 Vista，我们的 ASP.NET MVC Web 应用程序的生产服务器是 64 位 Server 2008 服务器。但是，我们运行 TeamCity 的构建服务器是 Server 2008 32 位服务器。我们将采用这些构建并将它们部署在 64 位生产服务器上。应用程序全部用 C# 编写。我应该担心在 32 位环境中进行构建吗？是否有必要升级我们的构建服务器？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-08T00:35:22.780

从技术上讲，这样做应该没有问题，因为编译器只会生成不依赖于平台的 IL 代码。

.NET 应用程序将在生产环境中的 x64 CLR 上运行。在运行时，JIT 编译器将生成 x64 代码。

* * *

## 回答 #2

> 赞同：-2
> 
> 时间：2009-02-08T00:32:31.617

根据我的经验，使用 32 位机器编译应用程序并将其部署到 64 位机器会导致应用程序运行缓慢。不过，对于网络应用程序可能会有所不同。

# html - 为什么我的 Flash 动画会覆盖我的 div 位置？

> ID：524838
> 
> 赞同：1
> 
> 时间：2009-02-08T00:19:59.020
> 
> 标签：html, css, flash, fancybox

我正在使用 FancyBox 生成弹出图像。

> [FancyBox](http://fancy.klade.lv/)（如果你好奇的话。）

它弹出一个`div`with `z-index: 92;`。

我正在运行的 Flash 动画远低于该动画`z-index`。

我的问题是在两个不同的 Firefox 浏览器（相同版本）中我有不同的结果。

一方面，一切看起来都很好。另一方面，Flash 动画出现在`div`. 我尝试刷新并重新启动浏览器，但总是出现同样的问题。

我知道其中一个屏幕截图来自 IE，但它仅作为参考。

我可能做错了什么？

[http://www.my-clock.net/tmp/sreen01.jpg](http://www.my-clock.net/tmp/sreen01.jpg)

[替代文字 http://www.my-clock.net/tmp/sreen02.jpg](http://www.my-clock.net/tmp/sreen02.jpg)

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-02-08T00:25:05.673

尝试在闪存上设置 wmode = transparent。无论您将其设置为什么 z-index，这都会防止 flash 覆盖所有内容。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-08T00:25:47.730

您可以尝试将一些 CSS 代码粘贴到[w3schools TryIt Editor](http://www.w3schools.com/Css/tryit.asp?filename=trycss_zindex1)以检查它是否正确以及 z-index 是否如您所想的那样工作。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-03-09T06:21:06.160

请记住，您需要为 IE 和其他浏览器分别设置**wmode参数：**

```
<param name="wmode" value="opaque" /> <!-- for IE -->
<embed src="images/banner/banner.swf" quality="high" wmode="opaque" ... <!-- for other browsers--> 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-08T17:47:11.573

虽然`wmode=transparent`会起作用，但它会对[性能造成很大影响](http://lists.deconcept.com/pipermail/swfobject-deconcept.com/2006-May/000282.html)。你可能会得到更好的结果`wmode=opaque`。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-23T18:58:14.757

如果您无法更改 Flash 模式，因为它是来自 AdSense 等网络的横幅，该怎么办？

# excel - 如何使用 VBA 反转选定范围的 Excel 列的顺序

> ID：524844
> 
> 赞同：7
> 
> 时间：2009-02-08T00:22:24.150
> 
> 标签：excel, vba

我是 VBA 新手，正在尝试弄清楚如何在不进行硬编码的情况下反转所选列范围的顺序。我查看的每个示例要么对列进行硬编码以反转顺序，要么假设您想要反转工作表中的所有列。我并不是要让某人为我写这个，但就像这应该是简单的一样，只要有人解释了我所缺少的，我应该没问题。

有人有建议吗？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-10-04T17:51:09.433

您可以使用**排序**来执行此操作。

使用此方法，您可以按您想要的任何方式排列列。

如果您有如下所示的数据：

```
 A       B       C
1   header1 header2 header3
2   dataA   dataE   dataI
3   dataB   dataF   dataJ
4   dataC   dataG   dataK
5   dataD   dataH   dataL 
```

在第一行添加一些数字：

```
 A       B       C
1   1       2       3      
2   header1 header2 header3
3   dataA   dataE   dataI
4   dataB   dataF   dataJ
5   dataC   dataG   dataK
6   dataD   dataH   dataL 
```

然后使用排序，没有标题行，然后选择*从左到右*而不是从上到下排序的选项。

按第 1 行降序排序：

```
 A       B       C
1   3       2       1
2   header3 header2 header1
3   dataI   dataE   dataA
4   dataJ   dataF   dataB
5   dataK   dataG   dataC
6   dataL   dataH   dataD 
```

如果要编写脚本，请使用*按行而不是按列排序*的选项。

我在这里写了一个 .vbs ：

[http://gallery.technet.microsoft.com/ScriptCenter/en-us/f6085342-a1ae-49d8-acfc-38368256ee42?lc=1033](http://gallery.technet.microsoft.com/ScriptCenter/en-us/f6085342-a1ae-49d8-acfc-38368256ee42?lc=1033)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-07-12T19:28:32.630

此代码水平翻转整个范围，一次一行是痛苦的。请享用

```
Sub FlipHorizontal()

On Error GoTo EndMacro

Application.ScreenUpdating = False
Application.Calculation = xlCalculationManual
Application.EnableEvents = False

Set Rng = Selection
rw = Selection.Rows.Count
cl = Selection.Columns.Count

If Rng.Cells.Count = ActiveCell.EntireRow.Cells.Count Then
    MsgBox "You May Not Select An Entire Row", vbExclamation, _
    "Flip Selection"
    Exit Sub
End If
If Rng.Cells.Count = ActiveCell.EntireColumn.Cells.Count Then
    MsgBox "You May Not Select An Entire Column", vbExclamation, _
    "Flip Selection"
    Exit Sub
End If

ReDim Arr(rw, cl)
For cc = 1 To cl ' = Rng.Columns.Count
    For rr = 1 To rw 'rr = Rng.Rows.Count
        Arr(rr, cc) = Rng.Cells(rr, cc) '.Formula
        a = Arr(rr, cc)
    Next

Next

'copy arry to range flippingnhorizontal
cc = cl

For a = 1 To cl ' to loop the columns
    For rr = 1 To rw 'rr = Rng.Rows.Count
        Rng.Cells(rr, cc) = Arr(rr, a) '=  .Formula

    Next
    cc = cc - 1
Next

EndMacro:
Application.ScreenUpdating = True
Application.Calculation = xlCalculationAutomatic
Application.EnableEvents = True

End Sub 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-08T00:32:39.870

**从这里**：[翻转或镜像范围](http://www.cpearson.com/excel/excelM.htm)：

此宏将反转一系列数据的顺序。您可以翻转单行或单列数据中的数据（即，N × 1 数组或 1 × N 数组）。您不能选择整行或整列。

```
Public Sub FlipSelection()

Dim Arr() As Variant
Dim Rng As Range
Dim C As Range
Dim Rw As Long
Dim Cl As Long

On Error GoTo EndMacro

Application.ScreenUpdating = False
Application.Calculation = xlCalculationManual
Application.EnableEvents = False

Set Rng = Selection
Rw = Selection.Rows.Count
Cl = Selection.Columns.Count
If Rw > 1 And Cl > 1 Then
   MsgBox "Selection May Include Only 1 Row or 1 Column", _
    vbExclamation, "Flip Selection"
Exit Sub
End If

If Rng.Cells.Count = ActiveCell.EntireRow.Cells.Count Then
    MsgBox "You May Not Select An Entire Row", vbExclamation, _
        "Flip Selection"
    Exit Sub
End If
If Rng.Cells.Count = ActiveCell.EntireColumn.Cells.Count Then
    MsgBox "You May Not Select An Entire Column", vbExclamation, _
        "Flip Selection"
    Exit Sub
End If

If Rw > 1 Then
    ReDim Arr(Rw)
Else
    ReDim Arr(Cl)
End If

Rw = 0
For Each C In Rng
    Arr(Rw) = C.Formula
    Rw = Rw + 1
Next C

Rw = Rw - 1
For Each C In Rng
    C.Formula = Arr(Rw)
    Rw = Rw - 1
Next C

EndMacro:
Application.ScreenUpdating = True
Application.Calculation = xlCalculationAutomatic
Application.EnableEvents = True

End Sub 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-08T00:34:06.433

`Selection.Columns(Selection.Columns.Count).Column`- 给你结束列号
`Selection.Columns(1).Column`- 给你起始列号

您可以使用上述方法进行反向 for 循环。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-10T12:29:23.533

记录一个带有相关单元格引用的宏，然后检查代码。每当我懒得查找某些功能时，我都会这样做（因为，让我们面对现实吧，MS 的文档对于 VBA 来说越来越差了）。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2016-09-30T04:48:45.290

我相信你想要做的看起来像这样：

A1 B1 C1 D1 E1 | E1 D1 C1 B1 A1

A2 B2 C2 D2 E2 | E2 D2 C2 B2 A2

如果这就是你想要做的，试试这个工作表功能：

=INDEX($A$1:$B$5,ROW(A1),6-COLUMN(A1))

其中 6 是 1 + 要反转的范围内的列数。可能有更好的方法来完成这部分，但我在这里很简单。

将该函数放入单元格 F1 并将其复制/粘贴到与原始范围相同的尺寸。然后你可以剪切/粘贴值。

# air - 用于离线应用程序的 Adob e AIR：这是最佳选择吗？

> ID：524853
> 
> 赞同：0
> 
> 时间：2009-02-08T00:26:27.307
> 
> 标签：air, desktop-application, offline, offline-mode

我正在寻找开发仍需要连接到实时站点以检索信息和存储结果的应用程序的离线版本。

该应用程序用于在线课程系统，现在需要在互联网连接不可用或不稳定时工作。该系统当前跟踪查看的每个课程页面（带有 Flash 和视频内容），然后还显示和跟踪多项选择考试的参加情况。这一切都需要离线提供。我认为该程序将在开始时通过用户帐户连接以下载部分或全部课程，包括考试，然后在最后再次连接以上传结果。（如果它可以在连接可用时自动执行该过程会很酷。）应用程序需要看起来类似于在线版本并且需要易于使用（易于安装，上传/下载所需的用户输入很少结果）。

我做了一些研究，看起来[Adob​​e AIR](http://www.adobe.com/products/air/)可能是在线版本和离线版本之间的一个很好的中间地带。

我最大的问题是我没有开发桌面应用程序的经验，因为我是一名 PHP 开发人员，所以我正在寻找类似 AIR 的东西来弥补差距。（在线版本是一个[LAMP](http://en.wikipedia.org/wiki/LAMP_(software_bundle))应用程序。）

有没有人将 Adob​​e AIR 用于这种类型的离线应用程序？它有多容易和安全？

还有其他解决方案吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-08T01:14:13.000

我认为 AIR 是一个很好的选择。我现在一直使用 AIR 来编写内部实用程序。

内置数据库和持久存储很棒。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-08T00:35:31.143

根据您的描述，听起来[Google Gears](http://gears.google.com/)与您要查找的内容更接近一些。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-22T18:19:24.127

Adobe AIR 是一个很好的解决方案。我们正在构建类似的东西。但是，如果下载过程中断，我们将面临恢复下载的问题。

# email - 从我的网络应用程序发送电子邮件的最佳方式，使其看起来像是来自我的用户帐户

> ID：524870
> 
> 赞同：1
> 
> 时间：2009-02-08T00:38:15.880
> 
> 标签：email, spam-prevention

我正在开发一个 Web 应用程序。用户将创建将发送给另一个人的电子邮件。

我希望从我的系统上的用户名和用户的电子邮件地址中显示发送的电子邮件。如果他们回复电子邮件，那么它应该直接发送到发件人的电子邮件地址。

但是，我担心电子邮件看起来像垃圾邮件到电子邮件过滤器。

有没有合适的方法来做到这一点？

我注意到在 WordPress 博客的“联系”页面上做了一些非常相似的事情。电子邮件标题如下所示：

```
To: email@domain.com
Subject: [Test Blog] =?UTF-8?B?aGVsbA==?=
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
From:=?UTF-8?B?aGVsbA==?=<sender@senderdomain.com>
Message-Id: <20090207234737.39C9522802F3@web7.sat.wordpress.com>
Date: Sat,  7 Feb 2009 23:47:37 +0000 (UTC)
Return-Path: donotreply@wordpress.com 
```

有趣的是，“from”标签中的显示名称和显示在主题行中的名称是经过编码的。我不知道这是否有助于垃圾邮件过滤器，但认为至少值得一提。

此外，在此示例中谁会收到无法送达的通知？它会发送到 sender@senderdomain.com 还是发送到 donotreply@wordpress.com？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-08T00:58:45.543

基本上，您需要做的就是将`From`标题设置为发送电子邮件的用户的电子邮件地址。的值`From`是在收件人的电子邮件客户端中显示的内容。目前大多数垃圾邮件检测系统只查看邮件内容，而不是电子邮件标头，因此根据您将 From 标头设置为的内容，您目前不会遇到那么多问题。

但是，有些系统越来越受欢迎，它们可能会阻止您使用其他人的电子邮件地址发送电子邮件 - 最值得注意的是 SPF，[发件人策略框架](http://www.openspf.org/)基本上，实现 SPF 的邮件服务器将检查`From`每封电子邮件地址的域接收并直接与该域检查以查看它是否授权该电子邮件。例如，如果您的服务器是`mydomain.com`，则用户的电子邮件地址是`abcdef@gmail.com`，收件人是`blah@example.com`，

1.  `mydomain.com`联系人`example.com`通过 SMTP 尝试发送电子邮件
2.  `example.com`查找 SPF 记录`gmail.com`
3.  `example.com`检查是否`mydomain.com`在允许使用该域发送电子邮件的域列表中`gmail.com`
4.  如果不是，则电子邮件被阻止

此外，我发现一个[论坛帖子](http://www.emaildiscussions.com/showthread.php?threadid=15009)表明这`Return-Path`是无法送达通知的预期目的地。显然，该标头是根据 SMTP MAIL FROM 命令的值设置的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-08T01:00:05.553

设置电子邮件字段通常很简单，但这样做的确切方法取决于您使用的语言和框架，您没有提及。通常是创建一个新的电子邮件对象，然后按照以下方式做一些事情：

```
email.from = "From Name <fromemailaddress@example.com>";
```

您可以将特定的发件人地址设置为用户的地址，如果您愿意，尽管我个人不是粉丝，但这并不罕见。您还可以将 from 字段设置为：“发件人名称（通过您的站点名称）<yourresponseaddress@example.com>”。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-08T01:00:34.930

不要这样做。

这实际上取决于您的邮件中继是如何设置的，但实际上只是不要这样做。发件人应包含发送电子邮件的电子邮件地址，在您的情况下为 webmaster@whatever.com。如果您希望人们回复不同的地址，您始终可以使用回复标题。[这里有一些注意事项。](http://www.bglug.ca/articles/replyto_header_notes.html)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-08T02:00:35.573

如果我正确理解标准（[RFC 822](http://www.faqs.org/rfcs/rfc822.html)），这正是*Sender*标头的用途（请参阅 §4.4.2\. SENDER / RESENT-SENDER）。不过，我会采用不同的方法，在*From*标头中使用您网站的官方联系地址，并将用户的地址放在*Reply-To*标头中。也许添加一些样板文本，清楚地说明邮件来自哪里。

除了技术方面的建议之外，还有一个建议：不要让匿名用户使用这个工具，你会成为一个完美的垃圾邮件平台。此外，出于善意，您可能希望确保您的（注册）用户知道他们的电子邮件地址已暴露给收件人。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-08T02:05:01.803

请注意，这样做会使垃圾邮件过滤器更加怀疑您的电子邮件。结合可疑的内容，您的电子邮件可能会被过滤。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-08T02:22:12.473

“发件人”标头中的任何人都将收到无法投递的通知。

对于过滤 - 它实际上更多地取决于您的邮件的主题和正文，而不是发件人地址。话虽如此，一些想法......

1.  使用 HTML 编码而不是具有简单格式的纯文本（我知道可能存在相反的论点，但根据我的个人经验，HTML 更频繁地通过）
2.  始终在页脚中添加（“这封电子邮件是从……等等等等发送给您的”）以识别它；如果您不希望人们知道它来自您的系统（即真正模仿“来自”用户），那么您需要找到一种更合法的方式来满足要求。
3.  如果可能，请使用系统中的真实地址作为“发件人”地址，并将用户地址作为“回复”。

# sql - 在 Oracle 10g 中从具有 CLOB 字段的表中缓慢删除

> ID：524871
> 
> 赞同：2
> 
> 时间：2009-02-08T00:38:29.420
> 
> 标签：sql, oracle, plsql, oracle10g, clob

当我尝试从包含两个 CLOB 字段的表中删除行时，我遇到了 Oracle 速度非常慢的问题。该表有数百万行，没有约束，删除是基于主键的。我重建了索引并重新计算了统计数据，但无济于事。

我可以做些什么来提高从此表中删除的性能？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-08T06:37:12.333

跟踪它，启用等待

```
http://download.oracle.com/docs/cd/B19306_01/appdev.102/b14258/d_monitor.htm#i1003679 
```

在 UDUMP 目录中找到跟踪文件。TKPROF 吧。看看最后，它会告诉你数据库在那个 SQL 期间花时间做什么。以下链接很好地概述了如何分析性能问题。

```
http://www.method-r.com/downloads/doc_download/10-for-developers-making-friends-with-the-oracle-database-cary-millsap 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-09T12:03:37.933

在这种情况下，您的`UNDO`表空间似乎是瓶颈。

`ROLLBACK`检查删除数据后需要多长时间。如果它所花费的时间与查询本身的时间相当（在 内`50%`），那么肯定是这种情况。

当您执行`DML`查询时，您的数据（包括原始数据和更改数据）将写入重做日志，然后应用于数据文件和`UNDO`表空间。

删除数百万`CLOB`行需要将数百兆字节（如果不是千兆字节）复制到`UNDO`表空间，这本身需要数十秒。

你能做些什么呢？

1.  创建更快`UNDO`：将其放在单独的磁盘上，使其不那么稀疏（创建更大的数据文件）。
2.  使用`ROLLBACK SEGMENTS`而不是 managed ，在运行查询之前为这个查询和问题`UNDO`分配一个。`ROLLBACK SEGMENT``SET TRANSACTION USE ROLLBACK SEGMENT`

如果不是这种情况，即`ROLLBACK`执行**比**查询本身快得多，那么尝试使用您的`REDO`参数：

1.  使用参数增加`REDO`缓冲区大小。`LOG_BUFFER`
2.  增加日志文件的大小。
3.  在单独的磁盘上创建日志文件，以便从第一个数据文件读取不会妨碍写入第二个数据文件，依此类推。

请注意，`UNDO`操作也会生成`REDO`，因此无论如何执行所有这些操作都是有用的。

`NOLOGGING`之前建议是无用的，因为它仅适用于[此处](http://download.oracle.com/docs/cd/B19306_01/server.102/b14200/clauses005.htm#g1057902)列出的某些操作集，`DELETE`而不是这些操作之一。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-08T01:13:57.850

使用 Oracle，您必须考虑删除行时生成的重做量。如果 CLOB 字段非常大，由于写入的重做量，Oracle 可能需要一段时间才能删除它们，并且您可能无能为力。

您可以执行的一项测试是查看删除是否需要很长时间在一行中，其中两个 CLOB 字段都设置为空。如果是这种情况，那么可能是索引更新需要很长时间。如果是这种情况，如果删除非常频繁，您可能需要调查合并索引（如果可能）。

如果表是派生表，意思是可以从其他表重建，可以看表的NOLOGGING选项。您可以使用最少的日志记录从源表重建表。

我希望这篇文章对一些人有所帮助，但是更多细节可以帮助诊断问题。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-09T02:37:20.210

是否有任何引用该表的子表正在删除？（您可以在要从中删除的表上选择`user_constraints`where = primary key name）。`r_constraint_name`

如果 Oracle 需要查看另一个表以检查没有子记录，则删除可能会很慢。通常的做法是索引子表上的所有外键，所以这不是问题。

遵循 Gary 的建议，执行跟踪并将 TKPROF 结果发布在这里，有人将能够提供进一步的帮助。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-10-07T02:11:36.250

删除的 CLOB 不会最终出现在 UNDOTBS 中，因为它们在 LOB 段中进行了版本化和保留。我认为它会在撤消中产生一些 LOBINDEX 更改。

如果您之前将 LOB 清空或清空，您是否真的用 DELETE 分开的提交来测量那个时间？如果您发出数千次删除，您是否使用批量提交？实例是否空闲？然后 AWR 报告应该告诉你发生了什么。

# c# - 需要写入 Program File 文件夹的自更新 .NET 客户端应用程序

> ID：524875
> 
> 赞同：3
> 
> 时间：2009-02-08T00:39:20.400
> 
> 标签：c#, .net-3.5, uac, file-permissions

**类似于：** [如果路径受到保护，请求 Windows Vista UAC 提升？](https://stackoverflow.com/questions/17533/request-vista-uac-elevation-if-path-is-protected#17544)

我在 c:\Program Files (Windows Vista) 中安装了一个 .NET 客户端应用程序。此应用程序应自行更新，但不是因为权限问题。自动更新程序应该简单地替换几个程序集，但它们都位于 c:\Program File 下，并且应用程序会引发以下异常：

> System.UnauthorizedAccessException：对路径“C:\Program Files...”的访问被拒绝。

我无法控制应用程序的安装位置和权限。有什么解决方法吗？是否可以请求管理员权限几秒钟？是否可以弹出 UAC 窗口？我很确定有一种解决方法......否则，Firefox 将如何自我更新？

提前感谢您的帮助和想法！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-08T00:46:45.987

您可以使用 Click Once 部署方法吗？我们将其用于内部应用程序，当我们发布新版本时，用户的权限没有问题。当他们启动应用程序时（如果存在新版本），系统会提示他们安装更新，并且安装顺利。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-08T00:41:54.670

您不能在中途提升进程的权限，但您可以启动另一个具有更高权限的单独进程来为您完成工作。

让您的主应用程序将所有文件/安装详细信息放入低权限临时位置。准备好后，启动一个较小的应用程序，它的唯一工作是将这些文件复制到 Program Files 目录（并且可能使用新的更新重新启动您的主应用程序）。将该应用程序标记为需要复制到 Program Files 目录或写入注册表（或其他任何需要的权限）所需的权限。

# html - Ruby Unit::Test 通过忽略空格来比较 html 输出

> ID：524881
> 
> 赞同：2
> 
> 时间：2009-02-08T00:43:28.070
> 
> 标签：html, ruby, unit-testing

我正在使用 Ruby 的 Test::unit 将生成的 html 的结果与预期结果进行比较。（不使用导轨）。我不关心空白差异，但这些几乎总是在测试期间出现。是否有任何测试机制来比较 html 而忽略无意义的空格。[我可以在这里](https://stackoverflow.com/questions/321795/comparing-xml-in-a-unit-test-in-python)看到 python 有类似的问题。我正在寻找Ruby的答案。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-08T01:16:04.523

或者自己去掉空格

```
assert_equal html_string.gsub(/\s+/, ' '), '<a href="foo">' 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-08T00:46:38.780

`assert_select`是你想要的。它允许您使用 CSS 选择器来解析 HTML 并查看它是否具有正确的值。

请参阅此`assert_select` [备忘单](http://labnotes.org/svn/public/ruby/rails_plugins/assert_select/cheat/assert_select.html)

编辑：我错过了这不一定是轨道。您可以将相关的 rails gem 导入到您的测试环境中，或者使用 HPricot 之类的东西来允许您将结果作为 HTML 进行传递并检查正确的值。

# ruby - 如何将 gem 嵌入到 RubyCocoa 应用程序中？

> ID：524888
> 
> 赞同：3
> 
> 时间：2009-02-08T00:47:28.403
> 
> 标签：ruby, cocoa, gem

我想将 2 个 gem 嵌入到我的 RubyCocoa 应用程序中，因此用户不必在他/她自己的控制台上安装它们。但我找不到任何关于如何做到这一点的信息。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-08T03:09:37.213

我不熟悉 RubyCocoa 如何处理事物，但我想您可以使用`gem unpack`将 gem 源提取到项目根目录中的某个目录，然后从那里引用该库。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-08T05:00:05.103

RubyCocoa 包含一个名为standaloneify.rb 的工具，它将在您的应用程序包中包含依赖项。找到它`[path to RubyCocoa.framework]/Versions/A/MacOS/Tools/standaloneify.rb`。

# asp.net-mvc - Ajax.BeginForm，用户控件和更新的东西

> ID：524890
> 
> 赞同：1
> 
> 时间：2009-02-08T00:47:40.837
> 
> 标签：asp.net-mvc

我对用户控件有点问题。基本上我想要完成的是以下内容：

1.  我有一个编辑发票的视图。
2.  在这个视图中，我有一个带有发票项目列表的用户控件
3.  我还有一个用 jQuery 激活的 div，用于添加新的发票项目
4.  当我添加发票项目时，我只想用项目列表刷新用户控件

如果没有黑客，我将如何做到这一点？我在想的是以下几点：

```
[AcceptVerbs(HttpVerbs.Post), ValidateAntiForgeryToken]
public ActionResult Create(InvoiceLine line)
{
if (Request.IsAjaxRequest())
{
    if (!ModelState.IsValid)
    {
        return PartialView("CreateLineControl", product);
    }
}           
return PartialView("DisplayLinesControl", product);
} 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-09T03:07:09.233

首先，您将调用一个带有 jQ​​uery 的 aspx 页面（我们将使用一个 http 处理程序，我们将在下面的 web.config 中映射该处理程序，稍后会详细介绍）

基本思想是，我们希望服务器端将用户控件呈现为 xhtml，并在我们的成功方法（客户端）中将此“更新”标记转储回 DOM

```
$.ajax({
    type: "GET",
    url: "UserDetails.aspx?id=" + id,
    dataType: "html",
    error: function(XMLHttpRequest, textStatus, errorThrown)
    {
        alert(XMLHttpRequest.responseText);
    },
    success: function(xhtml)
    {
        var container = document.createElement('div');

        container.innerHTML = xhtml;

        document.getElementById('someElement').appendChild(container);
    }
}); 
```

下面的技术是我用来通过 HttpHandler 利用用户控件将控件重用于 ajax 和 .net 工作的技术

下面是使用 .NET 1.1 完成的（但我相信你可以在 .NET 2.0+ 中完成）下面的类实现了 IHttpHandler，真正的工作是在流程请求子中，如下所示

当时我遇到的唯一问题是asp.net控件不会在用户控件中没有表单标签的情况下呈现，所以我使用了普通的html，一切都很好

```
Public Class AJAXHandler

    Implements IHttpHandler

    Public ReadOnly Property IsReusable() As Boolean Implements System.Web.IHttpHandler.IsReusable
        Get
            Return False
        End Get
    End Property

    Public Sub ProcessRequest(ByVal context As System.Web.HttpContext) Implements System.Web.IHttpHandler.ProcessRequest
        Dim Request As System.Web.HttpRequest = context.Request
        Dim path As String = Request.ApplicationPath
        Dim newHtml As String
        Dim pg As New System.Web.UI.Page

        context.Response.Cache.SetCacheability(HttpCacheability.NoCache)
        context.Response.ContentType = "text/html"

                                Dim uc As New UserDetail
                                uc = CType(pg.UserControl(path + "/Controls/UserDetail.ascx"), UserDetail)
                                Dim sb As New System.Text.StringBuilder
                                Dim sw As New System.IO.StringWriter(sb)
                                Dim htmlTW As New HtmlTextWriter(sw)

                                uc.LoadPage(custid, CType(pro, Integer))
                                uc.RenderControl(htmlTW)
                                context.Response.Write(sb.ToString())
                                context.Response.End()

    End Sub

End Class 
```

最后，在您的 web.config 中，您需要定义处理程序并将其映射到您在 ajax 调用中列出的 aspx 路径

```
 <system.web>
    <httpHandlers>
        <add verb="*" path="UserDetails.aspx" type="project.AJAXHandler, project" />
    </httpHandlers>
  </system.web> 
```

现在您可以使用 UserDetails.aspx 调用用户控件并将用户控件呈现为 html。然后在你渲染它之后它会返回 html (在 response.end 被调用之后)

然后在javascript中，您可以找到用户控件的父DOM元素，将其删除并附加或innerHTML这个新的html

**更新**

以上是我在 webforms 中使用的解决方案，但使用 MVC，以下将产生相同的结果，但工作量要少得多。

jQuery 函数将是相同的，但在服务器端，您只需创建一个新的控制器操作 + PartialView w/您想要的标记（基本上是一个用户控件）

```
Function Edit(ByVal id As Integer) As ActionResult
    Dim User As User = UserService.GetUserById(id)

    Return PartialView("User", User)
End Function 
```

现在在我的 ascx 中，我只是渲染了 html，这就是发送回浏览器进行 container.innerHTML 工作的内容（同样，在这种情况下，MVC 和 Webforms 的客户端代码是相同的）

```
<%@ Control Language="VB" Inherits="System.Web.Mvc.ViewUserControl(Of User)" %>
<% Dim User As User = DirectCast(Model, User)%>
<div id="innerDetail">
    <label for='username'>Username</label>
    <input type="text" id='username' name='username' value="<%= User.Username %>" /><br />

    <a id='lnkUpdate' href='/Application/User.aspx/Edit/<%= User.ID %>' onclick='UpdateUser(this); return false;'>Update User Information</a>
    <span id='lblUpdateStatus' style='display: inline;'></span>
    </div>
</div> 
```

这在 MVC 中使用更少的代码工作的原因是，我们不必处理 webforms 中普通 aspx 文件所需的页面生命周期。

# apache - htaccess 参考问题

> ID：524891
> 
> 赞同：1
> 
> 时间：2009-02-08T00:47:54.643
> 
> 标签：apache, mod-rewrite, redirect

我有这个 htaccess 代码：

```
RewriteEngine on
RewriteBase /xm/
RewriteCond %{REQUEST_URI} !^/index.php$
RewriteRule ^([a-z0-9]*)\.php$ index.php?page=$1 
```

我希望当用户访问例如 main.php 时，此 htaccess 重定向到 index.php?page=main，但每次，并且对于每个页面，它都会重定向到 index.php?page=index，无论如何，页面都是相等的索引。我究竟做错了什么？

编辑：适用于数字（例如 4.php）但不适用于字母：/

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-08T00:51:10.330

它在子请求上再次重写。将 [NS] 放在它的右侧，这样它只会被重写一次。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-08T01:32:15.693

试试这个：

```
RewriteCond $1 !^index$
RewriteRule ^([a-z0-9]+)\.php$ index.php?page=$1 
```

# apache-flex - FlashDevelop - 为什么代码完成不适用于 mx.controls

> ID：524893
> 
> 赞同：5
> 
> 时间：2009-02-08T00:48:57.543
> 
> 标签：apache-flex, flashdevelop

今天是我使用 Flex 和 FlashDevelop 的第一天。在我的 ActionScript 文件中，我有这一行。

```
import flash.display.SimpleButton; 
```

FlashDevelop 意识到这一点并且代码完成工作正常。

但是，当我有这条线时。

```
import mx.controls.Button; 
```

然后代码完成不起作用。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-08T05:57:01.307

对我来说效果很好，不需要做任何特别的事情。但也许您的项目的属性被破坏了。做这个：

打开项目属性
转到编译器选项选项卡
在高级 -> 内部库中添加以下
库\AS3\frameworks\Flex3

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-09-08T07:03:14.177

我有同样的问题。您的 AS3 类路径指向 flashdevelop 库文件夹结构中的一个目录，以选择 mx 类原型。

1.) 在 Flashdevelop 中按 F10 打开“设置”窗口。

2.) 在左侧列表中单击“AS3Context”选项。

3.) 立即在窗口右侧的“语言”组标题下，找到“AS3 类路径”选项。它的值通常设置为“库\AS3\Intrinsic”。将“AS3 Classpath”值更改为“Library\AS3”。

4.) 固定。Flashdevelop 现在应该知道 mx 库，因此自动完成现在也应该可以工作。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-09-16T23:58:30.723

要将任何 swc 包含到代码完成中，请将其父文件夹添加到 swc 库选项。有些人声称使用内在库是有效的，但对我来说不是。这是两种设置的路径：

```
ProjectSettings->CompilerOptions->SWCLibraries = {path to FOLDER containing swc's}
ProjectSettings->CompilerOptions->IntrinsicLibraries = {path to same FOLDER containing swc's} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-08T07:04:09.860

您的构建路径中似乎缺少 Flex 框架。你看过包含的库吗？

# asp.net - 根据主题更改图标

> ID：524899
> 
> 赞同：1
> 
> 时间：2009-02-08T00:51:34.433
> 
> 标签：asp.net, themes

是否有内置的方法来更改不同主题的图标？如果不是，它会像创建一个自定义控件以向图标发出带有正确 url 的链接标签一样简单吗？

# 更新

因此，根据我为了做到这一点所发现的，看起来我将不得不创建一个 http 处理程序来拦截对 favicon.ico 的所有调用。

然后，该处理程序将确定我们正在使用哪个主题（在我的情况下，它将基于域名），然后它将从各种主题文件夹中输出主题 favicon.ico。

由于我支持 IE7，我认为这是我唯一的选择。仍然好奇是否有人有更好的方法。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-08T00:55:26.843

只要您的用户不使用 IE，那应该没问题。IE（至少版本 7）只读取 favicon.ico 文件并完全忽略链接标签。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-10T04:06:40.830

请注意，根据 W3Schools

[http://www.w3schools.com/browsers/browsers_stats.asp](http://www.w3schools.com/browsers/browsers_stats.asp)

您应该预计大约 1/2 的用户使用 IE。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-08-24T15:00:39.420

经过一番研究和思考，这似乎是唯一的方法，并且仍然支持 IE7 及更早版本（我不确定 IE8 是否更新了对 favicon 的支持）。将动态提供图标来执行此操作，您可以执行以下操作：

1.  创建并注册一个 HttpHandler 来处理对 FavIcon.ico 的请求
2.  配置 IIS 以将 .ico 文件的请求发送到 ASP.Net（如果您使用 IIS6 或更早版本）
3.  运行您用来确定哪个主题的逻辑，并从中找到您要提供的 .ico，并将其发送到浏览器。

# asp.net-mvc - 属性似乎根本没有作用

> ID：524905
> 
> 赞同：11
> 
> 时间：2009-02-08T00:55:59.340
> 
> 标签：asp.net-mvc, error-handling, attributes, handleerror

我在使用控制器操作上的 [HandleError] 属性时遇到问题 - 它似乎根本不起作用（即过滤器是否存在并不重要 - 我得到相同的结果......）。当抛出异常时，我在“/”应用程序错误页面中得到标准的红色服务器错误，而不是我的自定义视图。

我在 SO 上找到了关于这个主题的其他几个线程，在大多数情况下，似乎在 web.config 中将 customErrors 选项设置为 On 解决了这个问题。它不适合我，所以我需要找到不同的解决方案。

我的控制器动作：

```
[HandleError]
public ActionResult Index()
{
    throw new Exception("oops...");
    return View();
} 
```

在我的 web.config 文件中

```
<customErrors mode="On"></customErrors> 
```

我已确保 Error.aspx 文件也在 Shared 目录中。我错过了什么？

我正在运行 ASP.NET MVC RC 刷新。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-02-09T15:15:12.027

两件有用的事情要知道：

默认情况下，`HandleError`在开发服务器下运行时不执行任何操作。目的是向开发人员展示更多有用的信息：

```
public virtual void OnException(ExceptionContext filterContext) {
    if (filterContext == null) {
        throw new ArgumentNullException("filterContext");
    }

    // If custom errors are disabled, we need to let the normal ASP.NET
    // exception handler execute so that the user can see useful
    // debugging information.
    if (filterContext.ExceptionHandled
        || ! filterContext.HttpContext.IsCustomErrorEnabled) {
        return;
    } 
```

请注意，这种情况正是`customError`应该控制的。如果设置`customError="On"`没有改变这种行为：

1.  检查你的语法。
2.  确保您正在编辑`Web.config`项目根目录中的，而不是视图中的那个。
3.  确保没有代码集`HttpContext.IsCustomErrorEnabled`。
4.  如果所有其他方法都失败，请尝试关闭调试`Web.config`

其次，某些类型的错误`HandleError`永远无法处理，尤其是 ASP.NET 编译错误。你没有说你遇到了哪个错误。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-08T02:27:55.613

您还需要指定要重定向到的页面。

```
<customErrors mode="On" defaultRedirect="Error.aspx" /> 
```

**编辑：**抱歉 /Shared/ 部分不应该在那里打赌，但您需要告诉 MVC 使用 Error.aspx 将用户发送到哪个页面。然后默认路由会在 shared 中查找名为 Error.aspx 的内容。

很晚了！:) 我想这就是为什么有人给我一个减号的答案！:) 至少它在这里有效，伙计！

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-05-04T22:41:20.597

我遇到了同样的问题，我花了整整两天的时间才弄清楚。结果是我在 Site.Master 页面中出现错误，并且 Error.aspx 使用与所有其他页面相同的母版页。显然 Error.aspx 无法处理这种情况。

我的解决方案是创建一个轻量级且不包含任何模型数据的特定 Error.master 页面。另外，我创建了一个静态 Error.htm，以防 Error.aspx 发生错误。Web.config 设置如下：

```
<customErrors mode="On">
    <error statusCode="500" redirect="Error.htm" />
</customErrors> 
```

希望能帮助到你。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-07-27T14:26:34.183

这个问题的另一个原因可能是，

在 Template MVC Application（由 VS2008 / VS2008 Express 生成）中，Error.aspx（由 VS 生成）使用 Master Page。

如果母版页访问任何 ViewData 它将抛出空引用 Exception ，那么 error.aspx 将不会显示。

使用此简单代码作为您的 Error.aspx ，它将解决问题，（连同 CustomErrors=On ）

```
<%@ Page Language="C#"  Inherits="System.Web.Mvc.ViewPage<System.Web.Mvc.HandleErrorInfo>" %>
<%= Model.Exception.Message %> 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-09-29T09:29:35.303

为了在应该显示 Error.aspx 时解决 404 问题，我必须从 httpHandler 部分中排除 Error.aspx，这会阻止直接访问任何视图（围绕 mvc 2 框架）。我通过将 Error.aspx 放在一个“错误”子文件夹中并将 web.config 放在这个子文件夹中并 `<remove path="*" verb="*" />` 在 httpHandlers 部分中放置一个来做到这一点。我对这个问题的版本（及其解决方案）可能特定于 MVC 2。

请记住在移动 Error.aspx 时更新 defaultRedirect 引用:)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-07-11T07:32:57.720

我尝试了上述建议，但对我没有任何帮助。诀窍是从我的错误控制器中的操作中删除这条线。

```
Response.StatusCode = (int)HttpStatusCode.NotFound; 
```

由于 IIS 错误消息一直在拦截我的错误处理，我一直在努力。虽然它并不理想，因为我想在响应中提供该状态代码，但我发现删除它可以防止 IIS 7+ 干扰我的错误处理。

大部落

# delphi - delphi中的日期和时间

> ID：524907
> 
> 赞同：0
> 
> 时间：2009-02-08T00:58:00.147
> 
> 标签：delphi, datetime

嘿，如果我想要更新自身的日期和时间，我要写什么？Label3.Caption := TimeToStr(Time) 这只是显示时间，当我打开程序时，但我想要一个时间，每秒更新一次表单（--> 像普通时钟一样）。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-02-08T01:10:37.763

1) 在表单上放置一个 TTimer 对象

2) 将其“间隔”属性设置为 1000，将其“启用”属性设置为 true。

3) 双击它以创建一个 OnTimer 事件处理程序。修改它看起来像这样：

```
procedure TForm1.Timer1Timer(Sender: TObject);
begin
    Label3.Caption := TimeToStr(Time)
end; 
```

你有它...

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-02-08T01:14:09.503

您可以使用[Timer](http://docs.codegear.com/docs/radstudio/radstudio2007/RS2007_helpupdates/HUpdate3/EN/html/delphivclwin32/ExtCtrls_TTimer.html)组件每秒更新标签标题。

1.  在您的表单上放置一个计时器。
2.  将[Interval](http://docs.codegear.com/docs/radstudio/radstudio2007/RS2007_helpupdates/HUpdate3/EN/html/delphivclwin32/ExtCtrls_TTimer_Interval.html)属性设置为 500，这将每半秒更新一次标题。
3.  将 Enabled 属性设置为 true。
4.  双击计时器并添加以下代码。

    Label3.Caption := TimeToStr(时间)

您还可以使用[FormatDateTime](http://docs.codegear.com/docs/radstudio/radstudio2007/RS2007_helpupdates/HUpdate3/EN/html/delphivclwin32/SysUtils_FormatDateTime@string@TDateTime.html)函数来更改时间的显示方式

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-08T01:11:10.370

因此，在表单上放置一个计时器，设置为每 500 毫秒左右滴答一次，然后将时间写入计时器事件处理程序中的文本时间字段。您需要比要显示的最小时间间隔更快地滴答作响。另请注意，windows 计时器的优先级很低，因此如果 CPU 被加载，您的计时器可能看起来“卡住”。

# php - 动态包括安全

> ID：524908
> 
> 赞同：3
> 
> 时间：2009-02-08T00:58:40.957
> 
> 标签：php, security

有什么方法可以安全地包含页面而不将它们全部放入数组中？

```
if (preg_match('/^[a-z0-9]+/', $_GET['page'])) {

$page = $_GET['page'].".php";
$tpl = $_GET['page'].".html";
if (file_exists($page)) 包含($page);
if (file_exists($tpl)) 包括($tpl);

}

```

我应该添加什么以使其非常安全？

我这样做是因为我不喜欢必须包含必须包含在所有页面上的内容。“包含页眉 > 内容 > 包含页脚”方式。我也不想使用任何模板引擎/框架。

谢谢。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-08T01:37:46.167

您当前实施的弱点是……</p>

1.  正则表达式只测试字符串的开头，因此“<code>images/../../secret”会通过，并且
2.  如果没有进一步的验证，“<code>index”也将是一个有效值并会导致递归。

* * *

为了使您的实现安全，最好将所有要包含的内容放在自己的目录中（例如“<code>includes”和“<code>templates”）。基于此，您只需要确保没有办法离开这个目录。

```
if (preg_match('/^[a-z0-9]+$/', $_GET['page'])) {
    $page = realpath('includes/'.$_GET['page'].'.php');
    $tpl = realpath('templates/'.$_GET['page'].'.html');
    if ($page && $tpl) {
        include $page;
        include $tpl;
    } else {
        // log error!
    }
} else {
    // log error!
} 
```

注意：`realpath`如果文件存在，则返回给定相对路径的绝对路径，`false`否则返回。所以`file_exists`没有必要。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-08T01:48:53.397

尽管您说过不想将可用页面列表存储在数组中，但它可能是最好的非数据库解决方案。

```
$availFiles = array('index.php', 'forum.php');
if(in_array($_GET['page'].".php", $availFiles))
 {
   //Good
 }
else
 {
   //Not Good
 } 
```

您可以使用 DB 查询或读取文件，甚至读取目录的内容并过滤掉您不希望的内容，轻松地动态构建数组。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-08T11:15:47.170

You should never use user supplied information for includes. You should always have some sort of request handler that does this for you. While a regular expression may filter somethings it will not filter everything.

If you do not want your site to get hacked you do not allow your users to control the flow of the application by designating an include.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-08T02:12:06.267

我同意 Unkwntech。这是一种将文件包含到您的网站中的不安全方式，我希望 PHP 程序员能够完全取消它。即便如此，包含所有可能匹配项的数组肯定更安全。但是，您会发现[MVC 模式](http://en.wikipedia.org/wiki/Model-view-controller)效果更好，而且更安全。我会下载[代码点火器](http://codeigniter.com/)并学习一两个教程，您会喜欢它的原因与您想使用动态包含的原因相同。

# c++ - Will Garbage Collected C be Faster Than C++?

> ID：524919
> 
> 赞同：6
> 
> 时间：2009-02-08T01:12:27.060
> 
> 标签：c++, c, optimization, memory-management, garbage-collection

I had been wondering for quite some time on how to manager memory in my next project. Which is writing a DSL in C/C++.

It can be done in any of the three ways.

1.  Reference counted C or C++.
2.  Garbage collected C.
3.  In C++, copying class and structures from stack to stack and managing strings separately with some kind of GC.

The community probably already has a lot of experience on each of these methods. Which one will be faster? What are the pros and cons for each?

A related side question. Will malloc/free be slower than allocating a big chunk at the beginning of the program and running my own memory manager over it? .NET seems to do it. But I am confused why we can't count on OS to do this job better and faster than what we can do ourselves.

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-08T01:30:22.357

It all depends! That's a pretty open question. It needs an essay to answer it!

Hey.. here's one somebody prepared earlier:

[http://lambda-the-ultimate.org/node/2552](http://lambda-the-ultimate.org/node/2552)

[http://www.hpl.hp.com/personal/Hans_Boehm/gc/issues.html](http://www.hpl.hp.com/personal/Hans_Boehm/gc/issues.html)

It depends how big your objects are, how many of them there are, how fast they're being allocated and discarded, how much time you want to invest optimizing and tweaking to make optimizations. If you know the limits of how much memory you need, for fast performance, I would think you can't really beat grabbing all the memory you need from the OS up front, and then managing it yourself.

The reason it can be slow allocating memory from the OS is that it deals with lots of processes and memory on disk and in ram, so to get memory it's got to decide if there is enough. Possibly, it might have to page another processes memory out from ram to disk so it can give you enough. There's lots going on. So managing it yourself (or with a GC collected heap) can be far quicker than going to the OS for each request. Also, the OS usually deals with bigger chunks of memory, so it might round up the size of requests you make meaning you could waste memory.

Have you got a real hard requirement for going super quick? A lot of DSL applications don't need raw performance. I'd suggest going with whatever's simplest to code. You could spend a lifetime writing memory management systems and worrying which is best.

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-08T01:27:01.337

uh ... It depends how *you* write the garbage collection system for your DSL. Neither C or C++ comes with a garbage collection facility built-in but either could be used to write a very efficient or a very inefficient garbage collector. Writing such a thing, by the way, is a non-trivial task.

DSLs are often written in higher level languages such as Ruby or Python specifically because the language writer can leverage the garbage collection and other facilities of the language. C and C++ are great for writing full, industrial strength languages but you certainly need to know what you are doing to use them - knowledge of [yacc](http://dinosaur.compilertools.net/yacc/) and lex is especially useful here but a good understanding of [dynamic memory management](http://www.bradrodriguez.com/papers/ms/pat4th-c.html) is important also, as you say. You could also check out [keykit](http://nosuch.com/keykit/), an open source music DSL written in C, if you still like the idea of a DSL in C/C++.

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-08T01:31:29.237

Why would garbage collected C be faster than C++? The only garbage collectors available for C are pretty inefficient things, more designed to plug memory leaks than to actually improve the quality of your code.

In any case, C++ has the potential for reaching better performance with less code (note that it's only a potential. It's also very possible to write C++ code that is far slower than the equivalent C).

Considering the current state of both languages, GC's are not currently going to improve performance in your code. GC's can be made very efficient in languages designed for it. C/C++ are not among those. ;)

Apart from that, it's impossible to say. Languages don't have a speed. It doesn't make sense to ask which language is faster. It depends on 1) the specific code, 2) the compiler that compiles it, and 3) the system it's running on (hardware as well as OS).

malloc is a fairly slow operation, far slower than the .NET equivalents, so yes, if you are performing a lot of small allocations, you may be better off allocating a large pool of memory once, and then using chunks of that.

The reason is that the OS has to find a free chunk of memory, basically by following a linked list of all free memory areas. In .NET, a new() call is basically nothing more than moving the heap pointer as many bytes as required by the allocation.

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-08T01:31:15.540

With most garbage collection implementations, allocation can see a speed improvement, but then you have the additional cost of the collection phase which can be triggered at any point in your program's execution, leading to a sudden (seemingly random) delay.

As for your second question, it depends on your memory management algorithms. You'd be safe sticking with your library's default malloc implementation, but there are alternatives which boast better performance.

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-08T01:30:39.347

> A related side question. Will malloc/free be slower than allocating a big chuck at the begining of the program and running my own memory manager over it? .NET seems to do it. But I am confused why we can't count on OS to do this job better and faster than what we can do ourselves.

The problem with letting the OS handle memory allocation is that it introduces indeterministic behaviour. There's no way for the programmer to know how long the OS will take to return a new chunk of memory - an allocation may be quite costly if memory has to be paged out to disk.

Preallocating therefore *might* be a good idea, especially when using a copying garbage collector. It'll increase memory consumption, but allocation will be fast because in most cases it'll just be a pointer increment.

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-08T02:17:01.063

As people have pointed out - GC is faster to allocate (because it just gives you the next block on its list), but slower overall (because it has to compact the heap regularly, in order for allocs to be fast).

so - go for the compromise solution (which is actually pretty damn good):

You create your own heaps, one for each size of object you generally allocate (or 4-byte, 8 byte, 16-byte, 32-byte, etc) then, when you want a new piece of memory you grab the last 'block' on the appropriate heap. Because you pre-allocate from these heaps, all you need to do when allocating is grab the next free block. This works better than the standard allocator because you are happily wasting memory - if you want to allocate 12 bytes, you'll give up a whole 16 byte block from the 16-byte heap. You keep a bitmap of used v free blocks so you can allocate quickly without wasting loads of memory or needing to compact.

Also, because you're running several heaps, highly-parallel systems work much better as you don't need to lock so often (ie you have multiple locks for each heap so you don't get contention nearly as much)

Try it - we used it to replace the standard heap on a very intensive application, performance went up by quite a lot.

BTW. the reason the standard allocators are slow is that they try not to waste memory - so if you allocate a 5 byte, 7 byte and 32 bytes from the standard heap, it'll keep those 'boundaries'. Next time you need to allocate, it'll walk through those looking for enough space to give you what you asked for. That worked well for low-memory systems, but you only have to look at how much memory most apps use today to see that GC systems go the other way, and try to make allocations as fast as possible whilst caring nothing for how much memory is wasted.

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-08T02:48:23.590

The problem has a lot of variables, but *if* your application is written with garbage collection in mind, and *if* you exploit the special features of the [Boehm collector](http://www.hpl.hp.com/personal/Hans_Boehm/gc/), such as different allocation calls for blocks that don't contain pointers, then as a general rule your application - Will have simpler interfaces - Will run somewhat faster - Will require from 1.2x to 2x the space than a similar application using explicit memory management.

For documentation and evidence supporting these claims, you can see the information on Boehm's web site, and also Ben Zorn's several papers on the measured cost of conservative garbage collection.

Most importantly you'll save a ton of effort and won't have to worry about a significant class of memory-management bugs.

The issue of C vs C++ is orthogonal, but GC will definitely be faster than reference counting, especially when there's no compiler support for reference counting.

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-08T01:32:09.047

Neither C nor C++ will give you garbage for free. What they will give you is memory allocation libraries (which provide malloc/free, etc). There are many online resources to algorithms for writing garbage collection libraries. A good start is [link text](http://en.wikipedia.org/wiki/Garbage_collection_(computer_science))

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-08T01:53:38.303

Most non GC languages will allocate and de-allocate the memory as needed and no longer needed. GC'd languages usually allocate large chunks of memory before hand and only free the memory when idle and not in the middle of a intensive task so I am going to **yes if GC kicks in at correct time.**

The D programming language is a garbage collected language and ABI compatible with C and partly ABI compatible with C++. [This Page](http://www.digitalmars.com/d/2.0/cppstrings.html) shows some benchmarks between string performance in C++ and D.

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-02-08T03:34:52.013

I suggest that if you have written a program where memory allocation and deallocation (explicitly or GC'ed) is the bottleneck, then you should re-think your architecture, design and implementation.

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-02-08T04:03:55.137

If you don't want to explicitly manage memory, don't use C/C++. There are plenty of languages with either reference counting or compiler-supported garbage collectors that will probably work much better for you.

C/C++ are designed in an environment where the programmer manages their own memory. Trying to retrofit GC or ref counting onto them may help some, but you'll find that you either have to compromise the performance of the GC (because it doesn't have any compiler hinting as to where pointers might be), or you'll find new and fascinating ways that you can screw up the reference counts or the GC or whatever.

I know it sounds like a good idea, but really, you should just grab a language more suited to the task.

# python - NumPy，PIL 添加图像

> ID：524930
> 
> 赞同：24
> 
> 时间：2009-02-08T01:15:16.430
> 
> 标签：python, image-processing, numpy, python-imaging-library

我正在尝试使用 NumPy 和 PIL 将两个图像添加在一起。我在[MATLAB](http://en.wikipedia.org/wiki/MATLAB)中执行此操作的方式类似于：

```
>> M1 = imread('_1.jpg');
>> M2 = imread('_2.jpg');
>> resM = M1 + M2;
>> imwrite(resM, 'res.jpg'); 
```

我得到这样的东西：

[替代文字 http://www.deadlink.cc/matlab.jpg](http://www.deadlink.cc/matlab.jpg)

使用合成程序并添加图像，MATLAB 结果似乎是正确的。

在 Python 中，我试图做同样的事情：

```
from PIL import Image
from numpy import *

im1 = Image.open('/Users/rem7/Desktop/_1.jpg')
im2 = Image.open('/Users/rem7/Desktop/_2.jpg')

im1arr = asarray(im1)
im2arr = asarray(im2)

addition = im1arr + im2arr

resultImage = Image.fromarray(addition)
resultImage.save('/Users/rem7/Desktop/a.jpg') 
```

我得到这样的东西：

[替代文字 http://www.deadlink.cc/python.jpg](http://www.deadlink.cc/python.jpg)

为什么我得到所有这些时髦的颜色？我也尝试过使用`ImageMath.eval("a+b", a=im1, b=im2)`，但我收到有关 RGB 不支持的错误。

我还看到有一个`Image.blend()`但需要 alpha。

实现我想要的东西的最佳方法是什么？

源图像（图像已被删除）：

[替代文字 http://www.deadlink.cc/_1.jpg](http://www.deadlink.cc/_1.jpg) [替代文字 http://www.deadlink.cc/_2.jpg](http://www.deadlink.cc/_2.jpg)

嗯，好的，我使用添加图像图标添加了源图像，它们在我编辑帖子时出现，但由于某种原因，图像没有出现在帖子中。

（图片已被删除）2013 05 09

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2009-02-08T17:05:45.870

正如每个人已经建议的那样，您观察到的奇怪颜色已经溢出。正如您在[schnaader 回答的评论中](https://stackoverflow.com/questions/524930/numpy-pil-adding-an-image/524943#524943)指出的那样，如果您添加这样的图像，您**仍然会溢出：**

```
addition=(im1arr+im2arr)/2 
```

此溢出的原因是您的 NumPy 数组 ( *im1arr* *im2arr* ) 属于**uint8**类型（即 8 位）。这意味着数组的每个元素最多只能保存 255 的值，因此当总和超过 255 时，它会在 0 附近循环：

```
>>>array([255,10,100],dtype='uint8') +  array([1,10,160],dtype='uint8')
array([ 0, 20,  4], dtype=uint8) 
```

为避免溢出，您的数组应该能够包含超过 255 的值。例如，您需要**将它们转换为浮点数，执行混合操作****并将结果转换回 uint8**：

```
im1arrF = im1arr.astype('float')
im2arrF = im2arr.astype('float')
additionF = (im1arrF+im2arrF)/2
addition = additionF.astype('uint8') 
```

你**不应该这样**做：

```
addition = im1arr/2 + im2arr/2 
```

当您丢失信息时，通过在执行混合信息之前压缩图像的动态（您实际上使图像为 7 位）。

**MATLAB 注意**：您在 MATLAB 中看不到此问题的原因可能是因为 MATLAB 在其函数之一中隐式处理了溢出。

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2009-02-08T03:58:33.760

使用 alpha 值为 0.5 的 PIL 的 blend() 将等效于 (im1arr + im2arr)/2。Blend 不要求图像具有 Alpha 层。

试试这个：

```
from PIL import Image
im1 = Image.open('/Users/rem7/Desktop/_1.jpg')
im2 = Image.open('/Users/rem7/Desktop/_2.jpg')
Image.blend(im1,im2,0.5).save('/Users/rem7/Desktop/a.jpg') 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-08T01:28:27.573

您发布的代码似乎只是总结了大于 256 的值和值溢出。你想要“（a + b）/ 2”或“min（a + b，256）”之类的东西。后者似乎是您的 Matlab 示例的方式。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-08T09:54:53.260

要钳制 numpy 数组值：

```
>>> c = a + b
>>> c[c > 256] = 256 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-08T01:32:40.043

您的示例图像没有显示在我的表格中，所以我要做一些猜测。

我不记得确切的 numpy 到 pil 转换是如何工作的，但有两种可能的情况。我 95% 确定它是 1，但我给出 2 以防万一我错了。1) 1 im1Arr 是一个 MxN 整数数组 (ARGB)，当您将 im1arr 和 im2arr 加在一起时，如果组件 b1+b2>255，您将从一个通道溢出到下一个通道。我猜 matlab 将他们的图像表示为 MxNx3 数组，因此每个颜色通道都是独立的。您可以通过拆分 PIL 图像通道然后制作 numpy 数组来解决此问题

2) 1 im1Arr 是一个 MxNx3 字节数组，当您将 im1arr 和 im2arr 添加在一起时，您正在包装组件。

在显示之前，您还必须将范围重新调整到 0-255 之间。您的选择是除以 2、缩放 255/array.max() 或进行剪辑。我不知道matlab是做什么的

# asp.net-mvc - 如何更改 ValidationSummary 的模板

> ID：524935
> 
> 赞同：1
> 
> 时间：2009-02-08T01:19:55.657
> 
> 标签：asp.net-mvc, validation

在 ASP MVC (RC 1) 中，如何更改 ValidationSummary 的默认模板？

默认情况下，它 ValidationSummary() 以红色显示错误的项目符号列表。我怎样才能改变这个？（即有图像而不是子弹）

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-08T01:49:07.500

您可以使用 CSS 而不是尝试更改 html...例如将项目符号更改为可以使用[list-style-image 的图像](http://www.w3schools.com/Css/pr_list-style-image.asp)。

# asp.net-mvc - 如何在 ASP.NET MVC 中维护 Html.CheckBox() 的状态

> ID：524936
> 
> 赞同：4
> 
> 时间：2009-02-08T01:20:48.260
> 
> 标签：asp.net-mvc

我的 MVC 应用程序中有两个复选框，它们都是布尔/位字段。“通知电子邮件”和“通知短信”。

每当我发回服务器并发生错误时，尽管我设置了尝试值，但复选框的状态已消失。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-05-01T15:10:47.333

为什么不像这样简单？

```
<%=Html.CheckBox("AgreeToRules", (Request.Form["AgreeToRules"] ?? string.Empty).Contains("true"))%> 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-22T17:45:25.797

**更新：** [这在 RC2 中已修复。](http://haacked.com/archive/2009/03/03/aspnetmvc-changes-for-rc2.aspx)

这个问题和这个问题一起，

> [Html.Checkbox 不在 ASP.net MVC 中保留其状态](https://stackoverflow.com/questions/526310/html-checkbox-does-not-preserve-its-state-in-asp-net-mvc)，

解决了 ASPNET.MVC RC1 的一个非常未记录的特性。我已经搜索了几个小时以找到一个好的答案，但找到的很少。

[显然，有一个错误](http://www.codeplex.com/aspnet/WorkItem/View.aspx?WorkItemId=3136)，它禁止复选框和单选按钮在 ModelState 中保持其状态。我们现在还知道，这两个控件是由 Html 助手专门处理的。

我设法想出的最好的方法是构建我自己的 ViewBinder：

从一个非常简单的角度来看：

```
<h2>Keep checkbox value between posts</h2>

<% using (Html.BeginForm("update", "checkbox")) {%>

<p><%= Html.CheckBox("a") %></p>
<p><%= Html.CheckBox("b") %></p>
<p><%= Html.TextBox("dummy") %></p>

<input type="submit" value="update" />

<% } %> 
```

与同样简单的控制器相关联：

```
public class CheckboxController : Controller
{
    public ActionResult Index()
    {
        return View();
    }

    public ActionResult Update()
    {
        var binder = new ViewBinder(ViewData, ValueProvider);
        binder.UpdateBooleanValues("a", "b");
        binder.UpdateMissingValues();

        return View("Index");
    }
} 
```

还有一个简单的类来使它全部工作：

```
internal class ViewBinder
{
    private readonly IDictionary<string, ValueProviderResult> valueProvider;
    private readonly ViewDataDictionary viewData;

    public ViewBinder(ViewDataDictionary viewData, IDictionary<string, ValueProviderResult> valueProvider)
    {
        this.valueProvider = valueProvider;
        this.viewData = viewData;
    }

    public void UpdateMissingValues()
    {
        foreach (var key in valueProvider.Keys)
        {
            if (ValueIsMissing(key)) UpdateValue(key);
        }
    }

    public void UpdateBooleanValues(params string[] names)
    {
        foreach (var name in names)
        {
            UpdateValue(name, BooleanValueFor(name));
        }
    }

    private bool BooleanValueFor(string name)
    {
        return valueProvider[name].AttemptedValue != "false";
    }

    private bool ValueIsMissing(string key)
    {
        return viewData.ContainsKey(key) == false;
    }

    private void UpdateValue(string key)
    {
        var value = valueProvider[key].AttemptedValue;
        UpdateValue(key, value);
    }

    private void UpdateValue(string key, object value)
    {
        viewData[key] = value;
    }
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-08T01:38:39.160

MVC 不像 WebForms 那样具有 ViewState - 这意味着您现在有责任维护这些值。

这将要求您存储复选框是否被选中，然后在页面呈现到视图中的浏览器之前再次将该设置应用于复选框。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-08T02:38:20.847

亚当，

假设您了解 MVC 不包含处理 Asp.Net 回发的服务器功能，如果您需要向服务器发送一条消息，通知您的应用程序已选中该复选框，那么最好使用 Javascript和一个 Ajax 请求。.Net MVC 包含一个 JQuery Javascript 库，因此这样做可能比您想象的要容易。[这是](https://stackoverflow.com/questions/220020/how-to-handle-checkboxes-in-asp-net-mvc-forms)一篇 SO 帖子，涵盖了如何在 MVC 中正确使用复选框。

否则，请意识到 MVC 不支持回发，就像 Andrew 上面所说的那样，也不支持 Asp.Net 视图状态。但是，您可以回到旧的视图状态方式，并使用带有一点 javascript 的常规 HTML 隐藏输入元素来维护您的状态。

综上所述，您可能需要花一点时间阅读这篇[文章](http://blog.eworldui.net/post/2008/05/ASPNET-MVC---Using-Post2c-Redirect2c-Get-Pattern.aspx)。许多 MVC 框架假定您将使用 Post -> Redirect -> Get 模式来处理 Web 表单中的用户输入。如果您继续使用当前的回发和视图状态模式，您将来可能会遇到更多问题，例如您当前正在尝试解决的问题。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-09T00:12:26.813

你如何指定你的复选框 HTML？除了复选框输入元素之外，绑定还需要一个隐藏的输入元素。Html.Checkbox 会为你处理这个，或者你可以研究它是怎么做的，然后自己做。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-07-21T11:49:37.380

其他人可能会发现此解决方案很有用：

[在 ASP.NET MVC 中维护动态复选框列表的状态](https://stackoverflow.com/questions/3291501/asp-net-mvc-maintain-state-of-a-dynamic-list-of-checkboxes/3298821#3298821)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-06-12T17:48:52.473

Andrei Rinea 部分正确。但我已经完成了 - 是使用帮助程序并将先前的值传递回页面中的数据类（由模型访问等）。它运作良好。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-21T12:19:59.193

使用诸如 Html.CheckBox 之类的 HTML Helper 将在 POST 上自动保持状态。

# asp.net - 如何应用条件逻辑来确定在 asp.net 中显示哪个母版页？

> ID：524939
> 
> 赞同：0
> 
> 时间：2009-02-08T01:24:20.717
> 
> 标签：asp.net, asp.net-mvc

我有 2 个母版页和一个内容页。如何向员工显示一个母版页，而向客户显示不同的母版页？

这是一个 asp.net mvc 应用程序。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-09T00:07:43.097

您可以在操作中的 View 方法中指定主节点：

```
return View("MyPage", isCustomer ? "CustomerMasterPage" : "EmployeeMasterPage") 
```

# architecture - “解决方案架构师”和“应用程序架构师”有什么区别？

> ID：524941
> 
> 赞同：99
> 
> 时间：2009-02-08T01:26:29.167
> 
> 标签：architecture, definition

据我所知，**Solutions Architect**只是**Applications Architect**的一个不同的“营销”术语。这是正确的还是角色实际上有所不同？如果是这样，怎么做？

是的，我在 StackOverflow 和 Google 上都搜索过这个。

* * *

## 回答 #1

> 赞同：249
> 
> 时间：2009-02-08T01:39:13.323

**2018 年 1 月 5 日更新**- 在过去的 9 年里，我在这个话题上的想法有了很大的发展。与大多数人相比，我倾向于生活在我们行业的最前沿（尽管肯定不像很多真正聪明的人那样突破界限）。我曾在多家大大小小的公司担任不同级别的架构师，从应用程序到解决方案，再到企业。我得出的结论是**，我们技术行业的未来主要是没有架构师的**. 如果这对您来说听起来很疯狂，请等待几年，您的公司可能会赶上来，或者发现它的竞争对手会赶上（并超越）您。根本的问题是，“架构”只不过是对您的应用程序/解决方案/产品组合做出的所有决定的总和。所以“建筑师”这个头衔真正的意思是“决策者”。这说明了很多，也说明了它*没有*说。它没有说“建设者”。创建一个隐含地告诉人们“建设”低于“决定”的职业道路/层次结构，并且“决定者”不直接负责（通过标题的差异）“建设”。仍然坚持他们的建筑师头衔的人会对此感到愤怒并抗议“但我是亲力亲为！” 太好了，如果你只是一个建设者，那么放弃你毫无意义的头衔，停止将自己与其他建设者区分开来。强调“所有建设者都是决策者，所有决策者都是建设者”的公司将比竞争对手更快地行动。我们对每个人都使用“工程师”这个称号，“工程师”意味着决定和建设。

**原始答案**：

对于从未在一个非常大的组织工作过（或者曾经在一个非常大的组织工作过，但这是一个功能失调的组织）的人来说，“建筑师”可能在他们的嘴里留下了不好的味道。然而，它不仅是一个合法的角色，而且对于聪明的公司来说也是一个高度战略性的角色。

*   当应用程序变得如此庞大和复杂以至于处理整体技术愿景和规划，并将业务需求转化为技术战略成为一项全职工作时，这就是**应用程序架构师**。应用程序架构师还经常指导和/或领导开发人员，并且非常了解他们负责的应用程序的代码。

*   当一个组织有如此多的应用程序和基础设施相互依赖，以至于在不参与其中任何一个代码的情况下确保它们的一致性和战略是一项全职工作时，这就是**解决方案架构师**。解决方案架构师有时可能类似于应用程序架构师，但在一套包含业务逻辑解决方案的特别大的应用程序上。

*   当一个组织变得如此庞大以至于它成为一项全职工作来协调解决方案架构师的高级规划并制定业务技术战略的条款时，该角色就是**企业架构师**。企业架构师通常在执行级别工作，为 CxO 办公室及其支持职能以及整个业务提供建议。

*还有基础架构架构师、信息架构师和其他一些架构师，但就总数而言，这些架构师的比例低于“三巨头”。*

**注意**：许多其他答案都说这些标题没有“标准”。那不是真的。去任何一家财富 1000 强公司的 IT 部门，您都会发现这些头衔的使用始终如一。

关于“建筑师”的两个最常见的**误解是：**

*   架构师只是一个拥有花哨头衔的更高级/更高收入的开发人员
*   架构师是在技术上毫无用处的人，多年没有编码，但仍然在业务中投入大量精力，使开发人员的生活变得困难

这些误解来自于很多架构师做得很糟糕，而组织在理解架构师的用途方面做得很糟糕。将顶级程序员提升为架构师角色是很常见的，但这是不对的。他们有一些重叠但*不*相同的技能组合。最好的程序员可能经常是但并不总是理想的架构师。一个好的架构师对 IT 行业的许多**技术**方面有**很好的理解；**比开发人员需要**更好地**理解**业务需求和策略**；优秀的**沟通技巧**********并且通常具有一些项目管理和业务分析技能。对于架构师来说，必须不遗余力地处理代码并在技术上保持敏锐。好人会。********

 ******* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-02-08T01:35:39.570

基本上，在 IT 认证领域，只要您不涉足“真正的”专业组织，您就可以随意称呼自己。例如，你可以是名片上的“微软认证解决方案工程师”，但如果你写了“专业工程师”（或 P. Eng）这个神奇的短语，除非你有那个铁环，否则你就会遇到法律问题。我知道“真正的”架构师有一个类似的头衔，我不记得了，但只要您不提及您可以成为“思科认证网络架构师”或类似名称。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-02-08T01:38:14.557

不，架构师与程序员的工作不同。架构师更关心非功能性（“功能”）需求。比如可靠性、可维护性、安全性等等。（如果你不同意，请考虑这个思想实验：比较一个用 C 编写的用于复杂网站的 CG​​I 程序与一个 Ruby on Rails 实现。它们都具有相同的*功能*行为；选择 RoR*架构*有哪些优势。）

一般来说，“解决方案架构师”是关于整个系统的——硬件、软件和所有——“应用程序架构师”在固定平台上工作，但术语并不那么严格或标准化。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-02-08T01:52:29.863

架构师职位没有行业标准定义——应用程序/系统/软件/解决方案架构师通常指的是具有强大设计和领导技能的高级开发人员。设计、战略、开发（通常是核心服务或框架）和管理的平衡因组织和项目而异。

唯一对我来说真正具有不同含义的“架构师”职位是“企业架构师”，我认为这更像是一个 IT 战略职位。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-06-01T12:51:29.730

建筑师类型之间存在有效差异：

企业架构师着眼于与企业战略紧密结合的企业解决方案。例如，在银行，他们会查看完整的 IT 环境。

解决方案架构师专注于特定的解决方案，例如银行中的新信用卡收单系统。

领域架构师专注于特定领域，例如应用程序架构师或网络架构师。

技术架构师通常扮演解决方案架构师的角色，较少关注业务方面，而更多地关注技术方面。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-02-08T02:09:29.267

“架构师”是给予能够设计在高层次上良好协同工作的多层应用程序的人的头衔。任何进入通用类型的“架构师”而没有特定类型的技术（即“解决方案”、“应用程序”、“业务”等）都是营销语言。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-08T01:51:22.143

实际上有很大的不同，解决方案架构师从整体上看是一个需求，例如，要求是减少呼叫中心接受披萨订单的员工数量，解决方案架构师会查看所有必须来的组件为了满足这一点，例如使用什么语音识别软件、需要什么硬件、最适合托管它的操作系统、IVR 软件与供应系统的集成等。

另一方面，此场景中的应用程序架构处理软件如何交互的细节，最适合的语言，如何最好地使用任何现有的 api，如果不存在则创建一个 api 等。

两者都有自己的位置，必须完成这两项任务才能满足要求，并且在大型组织中，您将有专门的人员来做，在较小的开发商店中，开发人员通常必须将所有架构任务作为整体开发，因为没有其他人，我说它只是一个营销术语，它是一个真正的角色（即使它是开发人员临时挑选它）并且在项目启动时特别有价值.

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-02-08T01:54:26.787

听起来和我一样！虽然我并不完全不同意奥利。如果他们想要的话，我会给选定的几个人一个软件架构师的头衔，但经验告诉我，真正应该得到软件架构师头衔的人通常不是头衔。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-02-08T03:14:12.680

根据我的经验，当我在 Computer Associates 做咨询时，营销口号是“销售解决方案，而不是产品”。因此，当我们有一个项目并且我需要戴上我的架构师的帽子时，我将成为一名解决方案架构师，因为我将设计一个使用许多组件的*解决方案*，主要是 CA 产品，可能还有一些第 3 方或手编码元素。

现在我更专注于作为一名开发人员，我是应用程序本身的架构师，因此我是一名应用程序架构师。

这就是我的看法，但是正如已经讨论过的，命名标准的方式很少。

* * *

## 回答 #10

> 赞同：-8
> 
> 时间：2009-02-08T01:31:50.547

拼音？

不过说真的 - 他们都是 BS 职位头衔。“程序员”对你还不够好吗？成为“建筑师”！

真的……这世界怎么了？！

编辑：我显然伤害了一些“建筑师”的感觉！

编辑 2：虽然我同意这样的观点，即措辞可以被解释为意味着一些人处理整个问题域（例如硬件、软件、部署、维护），但大多数人想要满足客户（并赚更多钱）如果需要，将提供全面的服务，无论他们的头衔如何。

在现实生活中，这只是营销的绒毛。

* * *

## 回答 #11

> 赞同：-8
> 
> 时间：2009-02-08T04:11:03.657

当你的头衔因为你戴太多帽子而不适合你的名片时，那么有人会为你设计一个漂亮的头衔。

例如编程/IT/项目管理/战略/业务分析师

获得建筑师头衔的其他方式：

*   你花在电话和白板上的时间比实际开发工作软件的时间还要多。
*   与实际开发工作软件相比，您花在帮助人们设置 Outlook/Entourage 上的时间更多。
*   一开始你真的不是一个好的编码员。

# css - 使用 CSS 使背景颜色仅水平重复

> ID：524965
> 
> 赞同：0
> 
> 时间：2009-02-08T01:42:14.847
> 
> 标签：css

我将颜色十六进制代码指定为`background-color`一个非常长的 div。但是，我希望这种颜色只在第一部分从左到右水平重复，而不是进一步下降。

可以使用`background-repeat:repeat-y`还是有其他方法来完成？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-08T01:45:21.720

颜色没有高度......它们只是存在，没有尺寸。如果您想在背景颜色和文档的其余部分之间进行视觉区分，则需要使用纯色图像作为背景图像：

```
div.className {
  background-image:url("images/background.jpg");
  background-position:left top;
  background-repeat:repeat-x; // Causes repeat from left-to-right only
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-08T01:46:43.370

你的意思是重复背景颜色或图像？我假设图像因为重复背景颜色没有意义。是的，这是正确的方法：

```
#mydiv {
  background-image: url(images/background.png);
  background-repeat: repeat-x;
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-05-21T09:40:07.183

background-repeat CSS 属性定义了背景图像的重复方式。背景图像可以沿水平轴、垂直轴或两者重复，或者根本不重复。当图像拼贴的重复没有让它们完全覆盖背景时，调整的方式可以由作者控制：默认情况下，最后一张图像被剪裁，但不同的拼贴可以重新调整大小，或者可以在瓷砖之间插入空间。

[http://www.handycss.com/how/how-to-repeat-a-background-image-horizo​​ntally-with-css/](http://www.handycss.com/how/how-to-repeat-a-background-image-horizontally-with-css/)

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2016-05-09T14:02:09.160

您可以在创建 1px 图像并将其放入编码为 base64 的 CSS 或使用多个 html 元素和定位时，无需文件即可实现此目的。此时，您不能为纯 CSS 中定义的纯色（不使用图像技巧）指定背景大小。

Also see [Is embedding background image data into CSS as Base64 good or bad practice?](https://stackoverflow.com/questions/1124149/is-embedding-background-image-data-into-css-as-base64-good-or-bad-practice)

# language-agnostic - 开始工作前无法签订雇佣合同

> ID：524972
> 
> 赞同：7
> 
> 时间：2009-02-08T01:49:34.863
> 
> 标签：language-agnostic

我正在与一家外包公司打交道，该公司拒绝在我上班的第一天之前提供书面的录取通知书。为了混淆这个问题，我有必要为这个职位搬迁。鉴于当前的就业市场，我觉得有必要采取行动，但看起来我应该在第一天出现之前在其他地方寻找工作。

从其他帖子来看，这似乎是一种相当普遍的做法。我可以采取任何可取的行动吗？

作为脚注，与雇主直接[谈判](https://rads.stackoverflow.com/amzn/click/com/055380488X)始终是一个不错的选择，并且在我的情况下有效。

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2009-02-08T01:52:25.027

我什至不会开始考虑搬到一个不会先给我签署合同的雇主，我什至不会为要约而搬家。如果他们不愿意先给你一份已签署的合同，我会拼命逃离他们，这在我粗略的仪表上是很高的。

作为企业主，我什至不会考虑在没有签订合同的情况下要求某人搬迁。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-02-09T04:28:29.413

> 鉴于当前的就业市场，我觉得有必要采取行动……

无论如何都要行动，但要*理性行动*。没有合同==没有工作！以您自己的最大利益行事 - 告诉他们，一旦您收到正式的书面报价并提供具体的搬迁补偿/费用，您很乐意接受该职位，同时继续寻找尊重您且不尊重您的公司的工作不要指望你承担所有的风险。如果他们不想支付搬迁费用，*请不要搬迁*。取而代之的是，让他们在前 2 周把你安排在旅馆里（或者自己做，在某些地区每周的效率约为 150 美元/周），然后看看情况如何。你可能会*讨厌*这份工作，尤其是当他们如此杂乱无章或无礼以致无法提供正式报价时。

如果你仍然觉得你绝对必须接受这份工作，那就去吧——但不要搬家，只是去拜访，直到你确定他们的意图——并且有能力定期支付！

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-02-08T01:54:32.013

对我来说听起来很狡猾，伙计......

也许你应该继续寻找？在这种情况下，我也很想直接与客户聊天以了解一下实际情况。也许他们可以打消你的疑虑。

机构... grrr。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-02-08T03:03:32.687

我会远离。如果他们现在不给你合同，那意味着两件事之一，都不好。正如您所指出的，这可能意味着它们是粗略的。他们打算让你或至少留下它的可能性。另一个更可能的原因是他们没有可用的合同。他们太杂乱无章，无法这样做。如果是这样的话，你的工作可能是安全的，但我不得不想知道工作环境会是什么样子。无论哪种情况，如果我有任何其他选择，我都会远离。

另一件要考虑的事情是，一旦你到达那里，他们会要求你签署什么。各种烦人的事情都可能出现在合同中，例如繁重的竞业禁止或对您随时创建的任何代码的权利、对您的非全天候活动的限制等。搬迁只是发现您没有想签名。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-08T02:05:05.313

我以前的工作他们甚至不会同意接受我，除非我先签署文件，这样他们就可以在我到达时为我准备好一切！

帮不了你太多。我可能会继续，但我想如果你是一家之主什么的，那就更难了。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-08T01:57:54.703

我不会对合同抱有太大的信心，因为大多数雇佣合同都是“随意”的，这意味着任何一方都可以随时终止合同。

即使有合同，假设您也可以上班，并且在第一天结束时，被告知您的合同即将终止。

如果您有搬迁费用，您可以为此签订一份合同，内容如下：

雇主了解员工正在承担大量搬迁费用，并同意如果雇佣持续时间少于 6 个月，则支付 $X,XXX 的搬迁费用。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-08T04:26:29.833

他们可以支付您的部分搬家费用或某种类型的签约奖金作为诚意的标志吗？他们仍然没有义务雇用你，但你会对这种情况感觉更好。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-13T15:44:58.700

他们可能想出了一个窍门。一些开发人员非常不愿意签署任何诸如竞业禁止协议之类的协议，或者当公司对你在私人时间所做的任何事情提出要求时，以保护自己或确保员工不会在副项目上加速他的精神力量。

在您搬迁之前不愿意为您提供合同可能会有意让您没有谈判选择，因为您已经承诺了这条路并搬迁。

# nhibernate - NHibernate：使用 Fluent Nhibernate 保存子对象

> ID：524974
> 
> 赞同：19
> 
> 时间：2009-02-08T01:51:23.313
> 
> 标签：nhibernate, fluent-nhibernate, nhibernate-mapping

在我的系统中，我有两个实体 - ShoppingCart 和 ShoppingCartItem。相当通用的用例。但是，当我保存我的 ShoppingCart 时，没有任何项目被保存到数据库中。

在我的对象中，我创建了一个新的 ShoppingCart 对象。

```
ShoppingCart cart = CreateOrGetCart(); 
```

然后，我将从数据库中获取的现有产品添加到开头。

```
cart.AddItem(product); 
```

这只是将项目添加到 IList 的简单包装器。

```
 public virtual void AddItem(Product product)
    {
        Items.Add(new ShoppingCartItem { Quantity = 1, Product = product });
    } 
```

然后我在存储库上调用 SaveOrUpdate

```
Repository.SaveOrUpdate(cart); 
```

看起来像这样：

```
 public T SaveOrUpdate(T entity)
    {
        Session.SaveOrUpdate(entity);
        return entity;
    } 
```

我正在使用 Fluent NHibernate 进行映射：

```
 public ShoppingCartItemMap()
    {
        WithTable("ShoppingCartItems");

        Id(x => x.ID, "ShoppingCartItemId");
        Map(x => x.Quantity);

        References(x => x.Cart, "ShoppingCartId").Cascade.SaveUpdate();
        References(x => x.Product, "ProductId");
    }

    public ShoppingCartMap()
    {
        WithTable("ShoppingCarts");

        Id(x => x.ID, "ShoppingCartId");
        Map(x => x.Created);
        Map(x => x.Username);

        HasMany<ShoppingCartItem>(x => x.Items)
            .IsInverse().Cascade.SaveUpdate()
            .WithKeyColumn("ShoppingCartId")
            .AsBag();
    } 
```

数据库架构 (SQL Server 2005) 也相当通用：

```
CREATE TABLE [dbo].[ShoppingCarts]
(
[ShoppingCartID] [int] NOT NULL IDENTITY(1, 1),
[Username] [nvarchar] (50) NOT NULL,
[Created] [datetime] NOT NULL
)
GO
ALTER TABLE [dbo].[ShoppingCarts] ADD CONSTRAINT [PK_ShoppingCarts] PRIMARY KEY CLUSTERED ([ShoppingCartID])
GO

CREATE TABLE [dbo].[ShoppingCartItems]
(
[ShoppingCartItemId] [int] NOT NULL IDENTITY(1, 1),
[ShoppingCartId] [int] NOT NULL,
[ProductId] [int] NOT NULL,
[Quantity] [int] NOT NULL
)
GO
ALTER TABLE [dbo].[ShoppingCartItems] ADD CONSTRAINT [PK_ShoppingCartItems] PRIMARY KEY CLUSTERED ([ShoppingCartItemId])
GO
ALTER TABLE [dbo].[ShoppingCartItems] ADD CONSTRAINT [FK_ShoppingCartItems_Products] FOREIGN KEY ([ProductId]) REFERENCES [dbo].[Products] ([ProductId])
GO
ALTER TABLE [dbo].[ShoppingCartItems] ADD CONSTRAINT [FK_ShoppingCartItems_ShoppingCarts] FOREIGN KEY ([ShoppingCartId]) REFERENCES [dbo].[ShoppingCarts] ([ShoppingCartID])
GO 
```

当我保存或更新我的 ShoppingCart 时，为什么没有任何 ShoppingCartItems 也被保存？

请帮忙。

谢谢

本

更新：将其包装在交易中，为我提供了更多信息：

> 无法将值 NULL 插入到列“ShoppingCartId”、表“WroxPizza.dbo.ShoppingCartItems”中；列不允许空值。插入失败。该语句已终止。

这是因为它是一辆新推车。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-05T22:42:17.180

I had this exact problem with fluent nhibernate. There appears to be a small bug in mapping one-to-many relationships and the relationships not automatically saving or cascading. [See here for a posting about it on the Fluent NHibernate group](http://groups.google.com/group/fluent-nhibernate/browse_thread/thread/1e520583a5f66f18).

Apparently, there is someone working on the issue!

I can;t say for sure that this is the issue with your code but [it looks very similar to a problem I had](http://groups.google.com/group/fluent-nhibernate/browse_thread/thread/f883c6b5233d15f5/8c85ad8e09635217?lnk=gst&q=x97mdr#8c85ad8e09635217). Hope that helps some!

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-13T12:58:33.013

你为什么包括`.Cascade.SaveUpdate()`在行中

```
References(x => x.Cart, "ShoppingCartId").Cascade.SaveUpdate() 
```

?

也许它使 NHibernate（或 Fluent NHibernate）感到困惑，您的关系两端似乎存在级联保存/更新？

将您的 HasMany 配置为级联应该足以实现您想要的。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-08T01:56:59.573

尝试将 Session.SaveOrUpdate 包装在事务中，或者直接在之后强制刷新。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-08T02:00:23.733

我不确定，但我不认为 N​​Hibernate 将对象的保存级联到子对象。您没有显示调用 SaveOrUpdate 的代码，但我知道如果您此时遍历 ShoppingCartItems，分别保存每个，那么它们也会被持久化。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-08T12:37:35.380

您的购物车物品是否有可能先保存，然后才是购物车？因此子项没有父 ID 可以使用？

您可能需要在创建时将购物车显式保存回数据库，然后将商品添加到其中并保存 - 只是为了获取 ID。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-12-27T07:42:02.063

如前所述，您使用 Identity 定义（在数据库模式中）字段，因此，必须在 Map 文件中设置这些字段。示例如下：

`Id(x => x.ID, "ShoppingCartItemId").GeneratedBy.Identity();`

您收到的错误是因为您没有将映射中的 Identity 字段设置为由 Identity 生成，因此，当您尝试 Save() 时，不会生成 Identity 列（并且在数据库中设置为 not null）然后它给你错误。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2009-02-08T12:32:22.927

我对 NHibernate**一无所知**（我使用的 OPF 为我做这件事），但是当您保存聚合根（ShoppingCart）时，代码是否也应该将其复合拥有的实例提交给会话？

* * *

## 回答 #8

> 赞同：-4
> 
> 时间：2009-03-13T11:04:47.103

问题在于您的 sessionfactory 配置语句。如果您希望您的数据保持不变，请不要使用 Exposeconfiguration。这肯定会解决您的数据持久性问题。

# python - 如何在 Django 模板上实现“返回”链接？

> ID：524992
> 
> 赞同：34
> 
> 时间：2009-02-08T02:02:04.430
> 
> 标签：python, django, django-templates, request, referrer

我正在使用[Django](http://www.djangoproject.com/)工具，我想知道是否有一种简单的方法可以使用模板系统创建指向上一页的“返回”链接。

我认为在最坏的情况下，我可以从视图函数中的请求对象中获取此信息，并将其传递给模板渲染方法，但我希望我能以某种方式避免所有这些样板代码。

我检查了 Django 模板文档，但没有看到任何明确提及这一点的内容。

* * *

## 回答 #1

> 赞同：47
> 
> 时间：2009-03-20T14:33:04.077

其实是`go(-1)`。

```
<input type=button value="Previous Page" onClick="javascript:history.go(-1);"> 
```

* * *

## 回答 #2

> 赞同：43
> 
> 时间：2014-11-11T14:49:38.997

这个解决方案对我有用：

```
<a href="{{request.META.HTTP_REFERER}}">Go back</a> 
```

但这之前已添加`'django.core.context_processors.request',`到`TEMPLATE_CONTEXT_PROCESSORS`您的项目设置中。

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2009-02-08T02:08:27.087

那么你可以启用：

```
'django.core.context_processors.request', 
```

在您的`settings.TEMPLATE_CONTEXT_PROCESSORS`街区中并挂出引荐来源网址，但这有点令人作呕，并且可能会到处中断。

大多数你想要这个的地方（例如SO上的编辑帖子页面）你都有一个真实的对象可以连接（在那个例子中，帖子）所以你可以很容易地计算出正确的前一页应该是什么。

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2018-06-04T21:47:47.523

```
<a href="{{request.META.HTTP_REFERER|escape}}">Back</a> 
```

这里`|escape`是用来摆脱`" "`字符串的。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-03-18T10:50:13.340

您始终可以使用非常简单的客户端选项：

```
<a href="javascript:history.go(1)">Back</a> 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2019-12-12T12:48:20.697

对于“返回”通常意味着更高一级的 RESTful 链接：

```
<a href="../"><input type="button" value="Back" class="btn btn-primary" /></a> 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2016-08-11T11:27:15.767

对于 Django 管理员更改表单中的“后退”按钮，我最终做的是一个自定义模板过滤器，用于解析和解码模板中的“preserved_filters”变量。我将以下内容放在自定义的 templates/admin/submit_line.html 文件中：

```
<a href="../{% if original}../{% endif %}?{{ preserved_filters | decode_filter }}">
    {% trans "Back" %}
</a> 
```

然后创建了一个自定义模板过滤器：

```
from urllib.parse import unquote
from django import template

def decode_filter(variable):
    if variable.startswith('_changelist_filters='):
        return unquote(variable[20:])
    return variable

register = template.Library()
register.filter('decode_filter', decode_filter) 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2016-09-28T11:26:03.533

使用客户端解决方案将是正确的解决方案。

```
<a href="javascript:history.go(-1)" class="btn btn-default">Cancel</a> 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2021-01-14T11:19:23.487

此处提到的所有 Javascript 解决方案以及该`request.META.HTTP_REFERER`解决方案有时都有效，但两者都在同一场景中中断（可能还有其他场景）。

我通常在创建或更改对象的表单下有一个取消按钮。如果用户提交表单一次并且服务器端验证失败，则再次向用户呈现表单，其中包含错误的数据。猜猜看，`request.META.HTTP_REFERER`现在指向显示表单的 URL。您可以按取消一千次，并且永远不会回到最初的编辑/创建链接所在的位置。

我能想到的唯一可靠的解决方案有点复杂，但对我有用。如果有人知道一个更简单的解决方案，我很乐意听到它。:-) “诀窍”是将初始 HTTP_REFERER 传递到表单中并从那里使用它。因此，当表单被 POST 到时，它会传递正确的初始引用者。

这是我的做法：

我为完成大部分工作的表单创建了一个 mixin 类：

```
from django import forms
from django.utils.http import url_has_allowed_host_and_scheme

class FormCancelLinkMixin(forms.Form):
    """ Mixin class that provides a proper Cancel button link. """
    cancel_link = forms.fields.CharField(widget=forms.HiddenInput())

    def __init__(self, *args, **kwargs):
        """
        Override to pop 'request' from kwargs.
        """
        self.request = kwargs.pop("request")
        initial = kwargs.pop("initial", {})
        # set initial value of 'cancel_link' to the referer
        initial["cancel_link"] = self.request.META.get("HTTP_REFERER", "")
        kwargs["initial"] = initial
        super().__init__(*args, **kwargs)

    def get_cancel_link(self):
        """
        Return correct URL for cancelling the form.

        If the form has been submitted, the HTTP_REFERER in request.meta points to
        the view that handles the form, not the view the user initially came from.
        In this case, we use the value of the 'cancel_link' field.

        Returns:
            A safe URL to go back to, should the user cancel the form.

        """
        if self.is_bound:
            url = self.cleaned_data["cancel_link"]
            # prevent open redirects
            if url_has_allowed_host_and_scheme(url, self.request.get_host()):
                return url

        # fallback to current referer, then root URL
        return self.request.META.get("HTTP_REFERER", "/") 
```

用于编辑/创建对象的表单（通常是 ModelForm 子类）可能如下所示：

```
class SomeModelForm(FormCancelLinkMixin, forms.ModelForm):
    """ Form for creating some model instance. """

    class Meta:
        model = ModelClass
    # ... 
```

视图必须将当前请求传递给表单。对于基于类的视图，您可以覆盖`get_form_kwargs()`：

```
class SomeModelCreateView(CreateView):
    model = SomeModelClass
    form_class = SomeModelForm

    def get_form_kwargs(self):
        kwargs = super().get_form_kwargs()
        kwargs["request"] = self.request
        return kwargs 
```

在显示表单的模板中：

```
<form method="post">
  {% csrf token %}
  {{ form }}
  <input type="submit" value="Save">
  <a href="{{ form.get_cancel_link }}">Cancel</a>
</form> 
```

 `# javascript - null / empty json 如何检查它而不输出？

> ID：524993
> 
> 赞同：8
> 
> 时间：2009-02-08T02:02:58.750
> 
> 标签：javascript, json

我有一个通过 ajax 检索的 json 编码数据集。我试图检索的一些数据点将返回给我们 null 或空。

但是，我不希望将那些 null 或 empty 显示给最终用户，或传递给其他函数。

我现在正在做的是检查

```
    如果（this.cityState！='null'）{
            // 在这里做一些事情
}

```

但是，对于每一行，我发现自己要经历多个 if 语句，而且似乎效率很低。有一个更好的方法吗？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-02-08T05:05:11.503

由于 JSON 只是一种数据格式，因此实际上无法知道哪些数据成员将为空，除非您明确检查它们。您始终可以重构代码以使其更紧凑且更易于阅读，但如果您事先不知道哪些为空，哪些将包含数据，则必须明确检查每个项目。

虽然我不知道您的代码应该做什么，但这里有一个示例，说明您可以如何重构它以使其更紧凑：

```
var data = { Name: "John Doe", Age: 25, Address: null, CityState: "Denver, CO" };
for (member in data) {
    if (data[member] != null)
        // Do work here
} 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-08T05:06:02.377

我不完全确定你想做什么......你说你不想将它们传递给其他函数，所以我假设你想删除它们：

```
var data = {a:"!",b:"null", c:null, d:0, e:"", hasOwnProperty:"test"};

var y;
for (var x in data) {
    if ( Object.prototype.hasOwnProperty.call(data,x)) {
        y = data[x];
        if (y==="null" || y===null || y==="" || typeof y === "undefined") {
            delete data[x];
        }

    }
} 
```

检查 hasOwnProperty 是为了确保它不是来自属性链的某个属性。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2018-01-14T14:14:36.783

或者你可以只使用

```
int data=0;
try{
   data=json.getInt("Data");
}catch(Exception e){
   data=anydefaultdata;
} 
```

# .net - .NET - 第 3 方网格控件 - 自动填充

> ID：524998
> 
> 赞同：1
> 
> 时间：2009-02-08T02:05:17.687
> 
> 标签：.net, excel, grid, autofill

任何人都知道支持[自动填充](http://office.microsoft.com/en-us/excel/HP012163661033.aspx)（如 Excel）的良好的 3rd 方网格控件。此外，导出到 Excel 并从 Excel 导入（粘贴）也很方便。我主要对可以执行此操作的 WinForms 网格感兴趣，但也很好奇是否存在具有 AutoFill 功能的 Silverlight 网格或 ActiveX 网格。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-07-09T16:43:24.287

[SpreadsheetGear for .NET](http://www.spreadsheetgear.com/)是一个与 Excel 兼容的 WinForms 电子表格控件，也可用于 ASP.NET 应用程序。它支持与 Excel 兼容的自动填充（用鼠标和 API 拖动填充）以及处理更复杂情况的数据系列命令/UI/API，包括线性和增长趋势、日期/时间等...

SpreadsheetGear 还支持读取、写入 xls 和 xlsx 以及剪贴板支持（剪切、复制和粘贴），可以处理 Windows 剪贴板上的 Excel 内容。

我们还没有用于 Silverlight 控件的 SpreadsheetGear - 但这是未来的高优先级。

如果您想尝试一下，可以[在此处](https://www.spreadsheetgear.com/downloads/register.aspx)下载免费试用版。

免责声明：我拥有 SpreadsheetGear LLC

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-09T00:27:57.213

如果您要提供“导出到 Excel 并从 Excel 导入（粘贴）”，那么这是否意味着您要交付给用户可以保证在其计算机上安装 Excel 的环境？如果是这样，您可以通过 VSTO 项目或通过将 Excel 工作表作为控件嵌入 WinForm 来考虑将 Excel 本身用作所需的网格？后者可能需要跳过一些互操作箍，但我认为这仍然是可能的。

显然，如果不能保证所有用户的机器上都有 Excel，那么你可以忽略我的回答；-)

# c++ - C++ 使用 VS2005 在 Windows XP 中使用 new 运算符可以动态分配的最大字节数是多少？

> ID：524999
> 
> 赞同：0
> 
> 时间：2009-02-08T02:05:46.513
> 
> 标签：c++, windows, visual-studio-2005

我有 C++ 代码，它试图动态分配一个 2d 字节数组，大小约为 151MB。当我尝试返回并索引数组时，我的程序每次都在完全相同的位置崩溃，并出现“访问冲突读取位置 0x0110f000”错误，但索引似乎在范围内。这让我相信这些索引处的内存没有正确分配。

1) 使用 new 运算符可以动态分配的最大字节数是多少？

2）如果是我无法动态分配内存的情况，那么每次尝试以完全相同的两个索引访问数组时我的代码崩溃是否有意义？出于某种原因，我觉得每次运行程序时它们都会有所不同，但我知道什么;）

3）如果您认为问题不是来自对 new 的不成功调用，还有什么其他想法可能导致此错误和崩溃？

提前感谢您的所有帮助！

*编辑

这是我分配二维数组的代码...

```
#define HD_WIDTH 960
#define HD_HEIGHT 540
#define HD_FRAMES 100

//pHDVideo is a char**
pHDVideo->VideoData = new char* [HD_FRAMES];

for(int iFrame = 0; iFrame < HD_FRAMES; iFrame++)
{
    //Create the new HD frame
    pHDVideo->VideoData[iFrame] = new char[HD_WIDTH * HD_HEIGHT * 3];
    memset(pHDVideo->VideoData[iFrame], 0, HD_WIDTH * HD_HEIGHT * 3);
} 
```

这是~~[崩溃代码和调试器](http://people.ict.usc.edu/~crotchett/images/hdcrash.jpg)~~（死链接）的屏幕截图，它将有所帮助。

我应该补充一点，对 memset 的调用永远不会失败，这对我来说意味着分配成功，但我可能是错的。

*编辑* 我找到了每个人的解决方法，感谢您的帮助。不知何故，我仍然需要弄清楚如何，有一条额外的水平线被放大，所以我改变了......

```
for(int iHeight = 0; iHeight < HD_HEIGHT; iHeight++) 
```

到

```
for(int iHeight = 0; iHeight < HD_HEIGHT-1; iHeight++) 
```

它突然起作用了。无论如何，再次非常感谢！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-08T02:54:34.653

一些可以考虑的可能性或可​​以尝试的事情：

*   可能是 pHDVideo->VideoData[iFrame] 或 pHDVideo->VideoData 在某处被释放。我怀疑情况是否如此，但无论如何我都会检查所有可能发生这种情况的地方。每次在崩溃语句之前释放那些 AND 时输出一个调试语句。
*   某些东西可能会覆盖 pHDVideo->VideoData[iFrame] 值。在分配时和崩溃声明之前将它们打印出来，以查看它们是否已更改。如果 0x0110f000 不在其中之一的范围内，则几乎可以肯定是这种情况。
*   某些东西可能会覆盖 pHDVideo 值。在分配时和崩溃声明之前将其打印出来，以查看它是否已更改。这取决于您的 pHDVideo 结构中还有什么。
*   请向我们展示崩溃的代码，以及相当多的上下文，以便我们也可以检查出来。

在回答您的具体问题时：

1/ 它是特定于实现或平台的，**在**这种情况下并不重要。如果你的 new 失败了，你会得到一个异常或 null 返回，而不是一个狡猾的指针。

2/ 情况并非如此：见（1）。

3/ 请参阅上文了解一些可能性和要尝试的事情。

添加屏幕截图后：

您确实意识到错误消息说“访问冲突**读取**...”？

这意味着它不是在抱怨写入，`pHDVideo->VideoData[iFrame][3*iPixel+2]`而是从`this->VideoData[iFrame][3*iPixelIndex+2]`.

iPixelIndex 设置为 25458，你能确认它`this->VideoData[iFrame][76376]`存在吗？我无法从您的屏幕截图中看到 this->VideoData 是如何分配和填充的。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-08T02:09:39.237

您如何访问分配的内存？它总是死在同一个语句上吗？它看起来很像您正在运行一维指针数组的末尾，或者它指向的大块字符之一。正如您所说，memset 几乎可以证明内存已正确分配。您分配的内存总量约为 0x9450C00 字节，因此如果连续分配，您引用的地址不在分配内存的末尾。

您的屏幕截图似乎显示 iPixel 在范围内，但未显示 iFrame 的值。是否超出 0-99 范围？

更新：该错误不在于分配内存，而在于您从 HD 到 SD 坐标的转换。您从 SD 缓冲区读取的值超出范围，因为它位于坐标 (144,176) 处，不在 (0,0)-(143,175) 范围内。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-08T02:19:27.050

> 如果是我无法动态分配内存的情况，那么每次尝试以完全相同的两个索引访问数组时我的代码崩溃是否有意义？

不，这对我来说没有意义。

如果您的调用`operator new`失败，我希望它会引发异常或返回空指针（但不会返回指向内存的非空指针，这对于某些索引是可以的，但对于其他索引则不行）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-08T06:10:08.877

为什么要使用浮点数学来计算整数索引？

看起来您的索引超出了 SD 图像缓冲区的范围。25344==SD_WIDTH*SD_HEIGHT，小于iPixelIndex，25458。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-08T13:19:22.100

请注意，在分配许多小对象（这就是为什么它是堆）时，堆分配（例如使用`new`）是有效的。如果您从事非常大的内存分配业务，使用 VirtualAlloc 和朋友可能会更好。`**************