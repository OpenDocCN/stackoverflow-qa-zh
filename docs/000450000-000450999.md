# StackOverflow 问答 000450000-000450999

# apache-flex - 突出显示按钮栏中的选定按钮（flex）

> ID：450006
> 
> 赞同：0
> 
> 时间：2009-01-16T10:24:51.383
> 
> 标签：apache-flex, flex3

在按钮栏中突出显示选定的按钮
怎么做？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-18T13:43:55.450

ToggleButtonBar 为您执行此操作

# c# - 如何在 C# 中获取 USB-Stick 的序列号

> ID：450009
> 
> 赞同：19
> 
> 时间：2009-01-16T10:26:40.367
> 
> 标签：c#, usb, usb-drive

如何在 C# 中获取 USB-Stick 或 USB-HardDrive 的内部序列号？

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2009-01-16T10:32:11.213

试试这个：

```
// add a reference to the System.Management assembly and
// import the System.Management namespace at the top in your "using" statement.
// Then in a method, or on a button click:

ManagementObjectSearcher theSearcher = new ManagementObjectSearcher("SELECT * FROM Win32_DiskDrive WHERE InterfaceType='USB'");
foreach (ManagementObject currentObject in theSearcher.Get())
{
   ManagementObject theSerialNumberObjectQuery = new ManagementObject("Win32_PhysicalMedia.Tag='" + currentObject["DeviceID"] + "'");
   MessageBox.Show(theSerialNumberObjectQuery["SerialNumber"].ToString());
} 
```

*资料来源：[http ://social.msdn.microsoft.com/forums/en-US/Vsexpressvcs/thread/f4447ed3-7e5f-4635-a28a-afff0b620156/](http://social.msdn.microsoft.com/forums/en-US/Vsexpressvcs/thread/f4447ed3-7e5f-4635-a28a-afff0b620156)*

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-01-16T10:59:35.463

[此处描述了](https://web.archive.org/web/20090328094546/http://www.emmet-gray.com/Articles/USB_SerialNumbers.htm)使用 Win32 的解决方案

编辑：原始链接似乎已丢失。以上是一个缓存副本，作者还在VB.Net中写了一些示例代码，[这里还在网上](http://www.emmet-gray.com/Files/AdminTools/USB_SerialNumber.zip)。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2011-05-28T20:06:26.563

我对 Yuval Adam 提供的解决方案有疑问，因为我尝试的每个 USB 记忆棒在 Windows 7 上都返回空白。

我通过查看当前对象的属性 PNPDeviceId 解决了这个问题。

例如

```
currentObject["PNPDeviceID"].ToString(); 
```

不确定这有多有效，但它在我试过的 3 个 USB 记忆棒上对我有用

# wcf - 序列化 FileStream 以进行传输

> ID：450014
> 
> 赞同：3
> 
> 时间：2009-01-16T10:27:44.530
> 
> 标签：wcf, attachment, mailmessage

另请参阅此问题：[我可以将 System.Net.MailMessage 传递给 WCF 服务吗？](https://stackoverflow.com/questions/447071/can-i-pass-a-system-net-mailmessage-to-a-wcf-service)

我想在发送的邮件中添加附件。附件可以是本地磁盘上的文件，也可以是动态创建的 Streams。WCF 协定可以包含 Stream，但仅当所有参数都是 Stream 类型时。那么，将一个或多个附件传递给 WCF 服务的最佳方式是什么？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-01-16T13:45:02.927

好吧，我自己解决了这个问题。这里的技巧是将附件转换为 Base64 编码字符串，与电子邮件系统执行此操作的方式非常相似。我创建了一个类来处理这个问题。在这里为其他人发布：

```
 [DataContract]
    public class EncodedAttachment
    {
        [DataMember(IsRequired=true)]
        public string Base64Attachment;

        [DataMember(IsRequired = true)]
        public string Name;

        /// <summary>
        /// One of the System.Net.Mime.MediaTypeNames
        /// </summary>
        [DataMember(IsRequired = true)]
        public string MediaType;
    }

 public EncodedAttachment CreateAttachment(string fileName)
        {
            EncodedAttachment att = new EncodedAttachment();
            if (!File.Exists(fileName))
                throw new FileNotFoundException("Cannot create attachment because the file was not found", fileName);

            FileInfo fi = new FileInfo(fileName);
            att.Name = fi.Name;
            att.MediaType = System.Net.Mime.MediaTypeNames.Text.Plain;

            using (FileStream reader = new FileStream(fileName, FileMode.Open))
            {
                byte[] buffer = new byte[reader.Length];
                reader.Read(buffer, 0, (int)reader.Length);
                att.Base64Attachment = Convert.ToBase64String(buffer);
            }
            return att;
        } 
```

在客户端：

```
public void SendEmail(SmallMessage msg)
        {
            using (MailMessage message = new MailMessage())
            {
                message.Body = msg.Body;
                message.Subject = msg.Subject;
                message.To.Add(new MailAddress(msg.To));
                message.From = new MailAddress(msg.From);
                foreach (EncodedAttachment att in msg.Attachments)
                {
                    message.Attachments.Add(CreateAttachment(att));
                }

                SmtpClient client = new SmtpClient();
                client.Send(message);
            }
        }

Attachment CreateAttachment(EncodedAttachment encodedAtt)
{
    MemoryStream reader = new MemoryStream(Convert.FromBase64String(encodedAtt.Base64Attachment));
    Attachment att = new Attachment(reader, encodedAtt.Name, encodedAtt.MediaType);
    return att;            
} 
```

# c# - 获取 .NET 框架设置

> ID：450017
> 
> 赞同：3
> 
> 时间：2009-01-16T10:29:40.187
> 
> 标签：c#, .net, debugging

在我的 web.config 中，我有标准元素；

```
<compilation debug="true" defaultLanguage="c#"> 
```

我知道我可以在方法上使用 [Conditional("DEBUG")]，或者使用一些像 #if DEBUG 这样的预编译器 if 语句，但我正在寻找的是内置的 .NET 框架设置，它可以让我知道在编译部分设置调试。

我以前看过它，但找不到它或记得它。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-01-16T10:57:18.040

HttpContext.Current.IsDebuggingEnabled（由 Jason Diamond 发布）是我正在寻找的。

感谢您的帮助马克！

# .net - .net 运行时尝试使用错误版本的程序集

> ID：450018
> 
> 赞同：0
> 
> 时间：2009-01-16T10:30:02.653
> 
> 标签：.net, deployment, assembly-resolution

我有一个引用程序集“Microsoft.Xna.Framework，Version=2.0.0.0，Culture=neutral，PublicKeyToken=6d5c3888ef60e27d”的应用程序。我创建了一个安装程序项目，将这个程序集安装在 GAC 中（通过运行 XNA redist 安装程序）。

但是，当第一次使用此程序集时，我在 JITing 期间收到异常。然后我尝试对图像进行 ngen，并且 ngen 给出以下错误消息：

```
Failed to load dependency Microsoft.Xna.Framework of assembly x,
Version=1.0.0.0, Culture=neutral, PublicKeyToken=null because of the following
error : The specified module could not be found. (Exception from HRESULT: 0x8007007E) 
```

请注意，版本为 1.0.0.0 并且缺少 PublicKeyToken，并且不存在伪造的程序集。什么会导致 JITer 和 ngen 尝试加载这个错误版本的程序集？

程序集的正确版本在 GAC 中。我已经在 Reflector 中打开了我的图像，并且参考在那里正确显示。我还验证了依赖层次结构中没有其他程序集加载伪造的 1.0.0.0 版本。事实上，1.0.0.0 版本在任何地方都不存在，无论是在开发盒上还是在测试机上。

但是，当尝试在测试机器上扩展对Microsoft.Xna.Framework的引用时，Reflector认为（正确地）引用的程序集版本是2.0.0.0，但是即使我可以在GAC中看到它也找不到它在资源管理器中查看 c:\windows\assembly。

请帮忙。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-16T10:58:16.497

（注意 - 提前编辑外部 1.0 dll）

您是否使用任何外部 dll？也许是一些引用 1.0 版本的第 3 方 xna dll。如果首先发现这一点，那么所有的赌注都可能会失败。尝试查看反射器中的任何外部 dll，然后查看它们引用的版本。您还可以尝试为 xna dll 添加[版本策略](http://quickstart.developerfusion.co.uk/quickstart/howto/doc/version.aspx)。

# regex - 如何将扩展的拉丁字符更改为无重音的 ASCII 字符？

> ID：450026
> 
> 赞同：6
> 
> 时间：2009-01-16T10:36:11.937
> 
> 标签：regex, perl

我需要一个通用的音译或替换正则表达式，它将扩展的拉丁字符映射到外观相似的 ASCII 字符，并将所有其他扩展字符映射到 ''（空字符串），这样......

*   e变成e

*   ê 变成 e

*   á 变成

*   ç变成c

*   Ď 变成 D

等等，但是像‡或Ω或‰这样的东西只是被删除了。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-01-16T11:05:17.870

使用 Unicode::Normalize 获取 NFD($str)。在这种形式中，所有带有变音符号的字符都将变成一个基本字符，然后是一个组合的变音符号。然后只需删除所有非 ASCII 字符。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-16T10:56:59.710

也许[CPAN](http://search.cpan.org)模块可能会有所帮助？

[Text::Unidecode](http://search.cpan.org/~sburke/Text-Unidecode-0.04/lib/Text/Unidecode.pm)看起来很有希望，尽管它没有去除‡、Ω 或‰。而是将它们替换为 ++、O 和 %o。这可能是也可能不是您想要的。

[Text::Unaccent](http://search.cpan.org/dist/Text-Unaccent/Unaccent.pm)是另一个候选者，但仅用于摆脱重音的部分。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-16T13:04:31.073

[Text::Unaccent](http://search.cpan.org/perldoc?Text::Unaccent)或[Text::Unaccent::PurePerl](http://search.cpan.org/perldoc?Text::Unaccent::PurePerl)听起来像您所要求的，至少是前半部分。

```
$unaccented = unac_string($charset, $string); 
```

删除所有非 ASCII 字符会相对简单。

```
s/[^\000-\177]+//g; 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-17T11:38:00.387

所有精彩的答案。但实际上没有一个真正起作用。在终端窗口或跨平台的各种代码/文本编辑器中工作时，将扩展字符直接放在源代码中会导致问题。我能够尝试 Unicode::Normalize、Text::Unidecode 和 Text::Unaccent，但无法让它们中的任何一个完全按照我的意愿行事。

最后，我只是列举了所有我想自己音译为 UTF-8 的字符（这是在我的输入数据中发现的最常见的代码页）。

我需要两个额外的替换来处理 æ 和 Æ 我想映射到两个字符

对于感兴趣的各方，最终代码是：（tr 是单行）

```
$word =~ tr/\xC0\xC1\xC2\xC3\xC4\xC5\xC7\xC8\xC9\xCA\xCB\xCC\xCD\xCE\xCF
\xD0\xD1\xD2\xD3\xD4\xD5\xD6\xD8\xD9\xDA\xDB\xDC\xDD\xE0\xE1\xE2\xE3\xE4
\xE5\xE7\xE8\xE9\xEA\xEB\xEC\xED\xEE\xEF\xF0\xF1\xF2\xF3\xF4\xF5\xF6\xF8
\xF9\xFA\xFB\xFC\xFD\xFF/AAAAAACEEEEIIIIDNOOOOOOUUUUYaaaaaaceeeeiiiionoo
oooouuuuyy/;
$word =~ s/\xC6/AE/g;
$word =~ s/\xE6/ae/g;
$word =~ s/[^\x00-\x7F]+//g; 
```

由于像 Ď 这样的东西不是 UTF-8 的一部分，因此它们在我的输入数据中几乎不会经常出现。对于非 UTF-8 输入，我选择只放掉 127 以上的所有内容。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-16T11:39:56.443

当我想翻译一些字符串时，不仅是字符，我正在使用这种方法：

```
my %trans = (
  'é' => 'e',
  'ê' => 'e',
  'á' => 'a',
  'ç' => 'c',
  'Ď' => 'D',
  map +($_=>''), qw(‡ Ω ‰)
};

my $re = qr/${ \(join'|', map quotemeta, keys %trans)}/;

s/($re)/$trans{$1}/ge; 
```

如果你想要一些更复杂的，你可以使用函数而不是字符串常量。使用这种方法，您可以做任何您想做的事情。但是对于您的情况`tr`应该更有效：

```
tr/éêáçĎ/eeacD/;
tr/‡Ω‰//d; 
```

# .net - 从命令行卸载 MSI 文件而不使用 msiexec

> ID：450027
> 
> 赞同：65
> 
> 时间：2009-01-16T10:37:02.280
> 
> 标签：.net, installation, command-line, wix, windows-installer

`msiexec`是安装[MSI](http://en.wikipedia.org/wiki/Windows_Installer)程序的命令提示符软件。但是我发现您可以通过在命令行中输入 MSI 文件的名称来从命令行安装 MSI 文件。

但是为了卸载 MSI 文件，您似乎必须调用该`msiexec`程序并给它一个`/x`or `/uninstall`。

`msiexec`如何在不使用例程的情况下从命令行卸载 MSI ？

* * *

## 回答 #1

> 赞同：180
> 
> 时间：2009-06-28T22:32:12.040

> ## 快递选项：
> 
> ***按产品 GUID 卸载：（***查找[产品 GUID](https://stackoverflow.com/questions/29937568/how-can-i-find-the-product-guid-of-an-installed-msi-setup/29937569#29937569)）- 下面第 3 节进行日志记录。还有： [MSI在这里深度记录](https://stackoverflow.com/questions/54453922/enable-installation-logs-for-msi-installer-without-any-command-line-arguments/54458890#54458890)：
> 
> ```
> msiexec.exe /x {11111111-1111-1111-1111-11111111111X} 
> ```
> 
> ***通过 MSI 文件卸载：***
> 
> ```
> msiexec.exe /x "c:\filename.msi" 
> ```
> 
> ***快捷互动：***
> 
> ```
> Right click MSI file in Windows Explorer and select "Uninstall". 
> ```

* * *

**有很多方法可以卸载 MSI 软件包。以下旨在作为“参考”：**

**总之**，您可以通过以下方式卸载：**msiexec.exe**、**ARP**、**WMI**、**PowerShell**、部署系统，例如**SCCM**、**VBScript** /COM 自动化、**DTF**，或通过**隐藏的 Windows 缓存文件夹**，以及下面介绍的其他一些选项。

前几段提供了重要的 MSI 花絮，然后有**14 个部分**提供了卸载 MSI 文件的不同方法。噗。

> ***“Babble, Babble - Over”：*** *第 1、2 和****3****节**是**正常**的**卸载**方法*******（因此推荐）。**`Personally I use option 3 or 5 from section 3`**（两个选项都带有日志记录，但选项 5 也静默运行）。如果你**很忙**，跳过所有的喋喋不休，去做其中之一——它会完成工作。****

 ***** * *

如果您在**完全卸载时遇到问题**并正在寻找已弃用的替代方案~~MsiZap.exe~~和/或 Windows Installer 清理实用程序 (~~MSICUU2.exe~~)，您可以尝试[**微软的新 FixIt 工具**](https://support.microsoft.com/en-us/help/17588/fix-problems-that-block-programs-from-being-installed-or-removed)（[或国际页面](http://support.microsoft.com/mats/Program_Install_and_Uninstall)）。显然也适用于其他安装问题。

更新的清理方法列表：[**清理损坏的 MSI 卸载**](https://stackoverflow.com/a/53876981/129130)。

* * *

如果您认为**MSI**和**Windows Installer**带来的麻烦多于其价值，您可能想了解[**使用 MSI 文件的企业优势**](https://serverfault.com/questions/11670/the-corporate-benefits-of-using-msi-files/274609#274609)。

* * *

**Installscript MSI**设置通常包含在**setup.exe 文件**中。要了解有关用于卸载此类设置的参数的更多信息，请参阅以下链接：[**setup.exe pdf 参考表**](http://www.itninja.com/static/090770319967727eb89b428d77dcac07.pdf)、[**Setup.exe 和 Update.exe 命令行参数**](http://helpnet.flexerasoftware.com/installshield20helplib/Content/helplibrary/IHelpSetup_EXECmdLine.htm)。

* * *

一些 MSI 文件通过诸如**[Burn](http://wixtoolset.org/documentation/manual/v3/bundle/)** (WiX Toolkit) 或**[InstallShield Suite](http://helpnet.installshield.com/installshield18helplib/SteCreatingSuites.htm)**项目之类的机制作为**捆绑包的一部分安装。**这会使卸载与下面看到的略有不同。这是[InstallShield Suite 项目的示例](https://stackoverflow.com/a/25374825/129130)。

* * *

*请注意，以**静默**方式或**交互**方式运行卸载可能会导致不同的结果 (!)*。有关为什么会出现这种情况的详细说明，请阅读这篇文章：**[从控制面板卸载不同于从 .msi 中删除](https://stackoverflow.com/questions/29677483/uninstall-from-control-panel-is-different-from-remove-from-msi/29679464#29679464)**

* * *

如果在尝试卸载时意外要求您提供原始安装介质，请阅读此答案：**[为什么 MSI 需要原始 .msi 文件才能继续卸载？](https://stackoverflow.com/questions/208530/why-does-msi-require-the-original-msi-file-to-proceed-with-an-uninstall/1189524#1189524)**也许还有下面的第 12 节，了解一些重要的技术细节。

* * *

如果你安装了[CCleaner](http://en.wikipedia.org/wiki/CCleaner)或类似的清理工具，或许可以跳到**第 11 节**。

* * *

**如果卸载完全失败（无法运行），请参阅下面的第 12 和 13 节，了解使用**[**系统还原**](http://en.wikipedia.org/wiki/System_Restore)和/或清理工具“**撤消**”安装的潜在方法。[](http://en.wikipedia.org/wiki/System_Restore)

 *** * *

# 1 -**`Using the original MSI`**

*   如果您有权访问用于安装的原始 MSI，您只需在**Windows 资源管理器中****右键单击**它并选择**Uninstall**。
*****   您也可以按照第 3 节中的说明通过命令行卸载。****

 ***** * *

# 2 -`Using the old ARP Applet OR new Windows 8/10 Settings Interface`

*   只是提到了正常的方法，虽然很明显

*   **`ARP`**= **`Add / Remove Programs Applet`**( **`appwiz.cpl`**)

*   **`Windows 10 Settings Interface`**=> 相同操作的新外壳

*   ***ARP***：

    *   **开始**吧 **`→</kbd> **run** `→</kbd> **appwiz.cpl** `→</kbd> `ENTER` in order to open the add/remove programs applet (or click add/ remove programs in the control panel)```**
    ***   单击要卸载的产品的“**删除”****
***   ***设置界面***（Windows 8 / 10）：

    *   在 Windows 8 / 10 中使用新的设置 GUI
        *   `Windows Key`+ 点击`I`=> **`Apps & Features`**。选择进入并卸载。
    *   直接快捷方式：
        *   `Windows Key`+ 点击`R`=> 输入：`ms-settings:appsfeatures`然后按`Enter`
    *   以这种方式调用卸载时的一些错误报告。如果看到请在下面添加评论。
        *   [**也试试这个答案**](https://stackoverflow.com/q/55404271/129130)
        *   **一般提示**：尝试禁用防病毒并重试。**

 *** * *

# 3 -`Using msiexec.exe command line (directly or via a batch file)`

*   您可以通过**命令提示符**( **cmd.exe** )、**批处理文件**或什至从可执行文件中作为**shell 操作**进行卸载。
*   为此，您可以将**产品 GUID**（查看下方以了解如何找到此[GUID](http://en.wikipedia.org/wiki/Globally_unique_identifier)）或原始 MSI 文件的路径（如果可用）传递给**msiexec.exe**。
*   对于下面的所有命令行，您可以添加`/qn`以**使卸载以静默模式运行**。这是从添加/删除小程序触发时卸载运行的方式。

**选项 3.1：基本交互式卸载**（访问原始 MSI 文件）：

```
msiexec.exe /x "c:\filename.msi" 
```

**选项 3.2：通过产品 GUID 进行基本交互式卸载**（无法访问原始 MSI 文件 -[**这是如何找到产品 GUID**](http://robmensching.com/blog/posts/2010/8/2/the-first-thing-i-do-with-an-msi-log/) - 与以下相同的链接）：

```
msiexec.exe /x {11111111-1111-1111-1111-11111111111X} 
```

**选项 3.3：使用详细日志文件进行交互式卸载**：

```
msiexec.exe /x "c:\filename.msi" /L*V "C:\msilog.log"
msiexec.exe /x {11111111-1111-1111-1111-11111111111X} /L*V "C:\msilog.log" 
```

**选项 3.4：使用刷新的详细日志文件进行交互式卸载**（[详细，刷新到日志选项](http://www.installsite.org/pages/en/msifaq/a/1022.htm)- 连续写入日志，可能非常慢）：

```
msiexec.exe /x "c:\filename.msi" /L*V! "C:\msilog.log"
msiexec.exe /x {11111111-1111-1111-1111-11111111111X} /L*V! "C:\msilog.log" 
```

*   **刷新到日志选项使卸载变慢**，因为日志文件是连续写入而不是分批写入的。这可确保在安装程序崩溃时不会丢失日志缓冲区。

*   换句话说，**如果您的设置崩溃并且详细日志文件中没有有用的信息，请启用此选项**。删除感叹号以关闭刷新到日志选项，卸载会更快。您仍然会获得详细的日志记录，但如前所述，可能会丢失一些日志缓冲区。

**选项 3.5（推荐）：使用详细日志文件进行静默卸载 - 禁止重新启动**（不刷新日志 - 请参阅上一个选项了解这意味着什么）：

```
msiexec.exe /x "c:\filename.msi" /QN /L*V "C:\msilog.log" REBOOT=R
msiexec.exe /x {11111111-1111-1111-1111-11111111111X} /QN /L*V "C:\msilog.log" REBOOT=R 
```

***快速参数说明（因为我推荐这个选项）：***

```
/X = run uninstall sequence
/QN = run completely silently
/L*V "C:\msilog.log"= verbose logging at path specified
{11111111-1111-1111-1111-11111111111X} = product guid of app to uninstall
REBOOT=R = prevent unexpected reboot of computer 
```

***同样，如何找到产品 GUID：*** [如何找到已安装 MSI 设置的产品 G​​UID？](https://stackoverflow.com/questions/29937568/how-can-i-find-the-product-guid-of-an-installed-msi-setup/29937569)（如果您没有要在卸载命令中指定的原始 MSI，则用于卸载）。

*   **重要提示**：如果您为卸载创建日志文件，您可以通过[**搜索“值 3”**](http://robmensching.com/blog/posts/2010/8/2/the-first-thing-i-do-with-an-msi-log/)在日志中找到问题。这对于详细文件特别有用，因为它们非常详细:-)。

*   **如何找到已安装 MSI 的产品 G​​UID**？

    *   有几种方法，我推荐的方法是使用 Powershell：**[如何找到已安装 MSI 设置的产品 G​​UID？](https://stackoverflow.com/questions/29937568/how-can-i-find-the-product-guid-of-an-installed-msi-setup/29937569)**
    *   此处描述的其他几种方法（注册表、本地缓存文件夹等）：**[从 MSI 文件中查找 GUID](https://stackoverflow.com/questions/11251034/find-guid-from-msi-file/29938049#29938049)**
*   有关从**installsite.org**进行日志记录的更多信息：[**如何创建我的安装日志文件**？](http://www.installsite.org/pages/en/msifaq/a/1022.htm)- 不同选项的伟大概述以及 InstallShield 日志记录的细节。

*   [**Msiexec（命令行选项）**](https://msdn.microsoft.com/en-us/library/windows/desktop/aa367988(v=vs.85).aspx) -来自**MSDN的****msiexec.exe**命令行概述。这是[**Technet 版本**](https://technet.microsoft.com/en-us/library/bb490936.aspx)。**[](https://technet.microsoft.com/en-us/library/bb490936.aspx)**

 ***** * *

# 4 -`Using the cached MSI database in the super hidden cache folder`

*   MSI 删除所有 cab（旧 Windows 版本）并将每个安装在**%SystemRoot%\Installer**的超级隐藏系统文件夹中的 MSI 缓存（您需要显示隐藏文件才能看到它）。
*   **注意**：这个超级隐藏的文件夹现在在 Windows 7 及以后的版本中被区别对待。[MSI 文件现在全尺寸缓存](https://stackoverflow.com/a/1189524/129130)。阅读链接的线程以获取更多详细信息 - 建议任何找到此答案并摆弄危险 Windows 设置的人阅读。
*   [通过使用管理员安装来避免这些巨大的缓存文件](https://stackoverflow.com/a/5751980/129130)。关于磁盘空间的主题：[如何摆脱巨大的缓存 MSI 文件（和其他磁盘空间清理技巧）](https://serverfault.com/a/642178/20599)。
*   此处的所有 MSI 文件都将分配一个随机名称（十六进制格式），但是您可以通过显示 Windows 资源管理器状态栏（查看 -> 状态栏）然后选择一个 MSI 来获取有关每个 MSI 的信息。来自 MSI 的摘要流将显示在 Windows 资源管理器窗口的底部。或者正如 Christopher Galpin 指出的那样，打开 Windows 资源管理器中的“评论”列并选择 MSI 文件（[**请参阅本文了解如何执行此操作**](http://csi-windows.com/blog/all/27-csi-news-general/334-identifying-cached-msi-packages-in-cwindowsinstaller-without-opening-them)）。
*   [关于使用 Windows 资源管理器的简短回答](https://stackoverflow.com/a/41735092/129130)
*   找到正确的 MSI 后，只需右键单击它并进行卸载。
*   您还可以使用 PowerShell 显示本地缓存包的完整路径以及产品名称。这是我认为最简单的选择。
*   要启动**PowerShell**：*按住 Windows 键，点击 R，释放 Windows 键，输入“powershell”，然后按 OK*。然后**最大化 PowerShell 窗口**并运行以下命令：

```
 get-wmiobject Win32_Product | Format-Table Name, LocalPackage -AutoSize 
```

![在此处输入图像描述](https://i.stack.imgur.com/HFFF1.png)

*   另请参阅此答案：[如何找到已安装的 MSI 设置的产品 G​​UID？](https://stackoverflow.com/questions/29937568/how-can-i-find-the-product-guid-of-an-installed-msi-setup/29937569#29937569)

* * *

# 5 -`Using` [`PowerShell`](http://thoughtsofmarcus.blogspot.no/2012/12/clever-uninstall-of-msi.html)

*   MSDN 上有[**一个类似但更全面的 PowerShell 脚本**](https://msdn.microsoft.com/en-us/library/aa393941(v=vs.85).aspx)。它允许在多台机器上运行卸载。

*   Even Mien 添加的条目：

    ```
     $app = Get-WmiObject -Class Win32_Product -Filter "Name = 'YOUR_APP'"
     $app.Uninstall() 
    ```

*   这种方法可行，但访问 WMI 类 Win32_Product 将触发**软件一致性检查**，该检查**速度非常慢**，在特殊情况下可能会触发 MSI 自我修复。请参阅这篇文章：**[Powershell 卸载脚本 - 真的很头疼](https://stackoverflow.com/questions/17868285/powershell-uninstall-script-have-a-real-headache/17868466#17868466)**

*   我自己没有对此进行测试，但似乎 $app.Uninstall() 可能会运行在 ARP 小程序的注册表设置中注册的 UninstallString。这意味着它在某些情况下可能会运行修改而不是卸载。

*   查看此主题以获取更多详细信息以及通过 Powershell 卸载的方法：**[如何使用 PowerShell 卸载应用程序？](https://stackoverflow.com/questions/113542/how-can-i-uninstall-an-application-using-powershell)**

* * *

# 6 - `Using the .NET DTF Class Library`（[WiX 工具包的](https://stackoverflow.com/questions/6060281/windows-installer-and-the-creation-of-wix/12101548#12101548)一部分）

*   **此选项是为进入部署和 MSI 的开发人员提供的**- 作为“快速修复”，它实际上并不实用。它要求您下载[**WiX 工具包**](http://wixtoolset.org/)- 一个免费的框架，用于创建从 XML 源文件编译的 MSI 文件。
*   快速了解 WiX 及其“历史”：[Windows Installer 和 WiX 的创建](https://stackoverflow.com/questions/6060281/windows-installer-and-the-creation-of-wix/12101548#12101548)。这[是 WiX 与其他部署工具（商业）的对比](https://stackoverflow.com/questions/1544292/what-installation-product-to-use-installshield-wix-wise-advanced-installer/1546941#1546941)- （优点和缺点 - 希望尽可能客观）。
*   **DTF**（部署工具基金会）作为 WiX 的一部分分发，如下所述：[部署工具基金会的源代码是否可用？](https://stackoverflow.com/questions/8637300/is-source-code-for-deployment-tools-foundation-available).
*   DTF 本质上是**Win32 Windows Installer API 的 .NET 包装器**。通过自动化与 Windows Installer 一起工作时，它消除了对 COM 互操作的所有需求，并且是**.NET 的瑰宝**——*也许是我见过的最容易使用的 .NET 库。强烈推荐 - 非常适合用 C# 培训学生*。
*   以下[来源](https://stackoverflow.com/a/17535555/129130)来自 MSI 专家[**Christopher Painter**](http://blog.deploymentengineering.com/)使用 C# 和 DTF。Microsoft.Deployment.WindowsInstaller 是 DTF 程序集之一。[请参阅 serverfault.com 上解释的其他程序集](https://serverfault.com/questions/577969/is-it-possible-to-disable-msiexec-help-gui/596519#596519)：

```
 using Microsoft.Deployment.WindowsInstaller;

    public static void Uninstall( string productCode)
    {
      Installer.ConfigureProduct(productCode, 0, InstallState.Absent, "REBOOT=\"R\"");
    } 
```

*   Tom Blodget 的另一种选择：[检查卸载是否成功](https://stackoverflow.com/questions/17149811/checking-for-successful-uninstall/17175837#17175837)
*   有关**msiexec.exe**与**自动化**的更多信息，请访问：[**serverfault.com**](https://serverfault.com/questions/577969/is-it-possible-to-disable-msiexec-help-gui/596519#596519)。

* * *

# 7 -`Using the` [`Windows Installer Automation API`](http://msdn.microsoft.com/en-us/library/aa367810(v=vs.85).aspx)

*   以下是对此选项的社区讨论：[Windows Installer Automation API community sample](http://community.flexerasoftware.com/archive/index.php?t-153737.html)

*   API 可以通过[**脚本自动化和 C++ API 调用**](https://serverfault.com/a/596519/20599)来访问（我在 serverfault.com 上的帖子）

*   以下来源改编自 MSI 专家[**Christopher Painter**](http://blog.deploymentengineering.com/)使用[VBScript](http://en.wikipedia.org/wiki/VBScript)：

    ```
     Set installer = CreateObject("WindowsInstaller.Installer")
     installer.InstallProduct "product.msi", "REMOVE=ALL REBOOT=ReallySuppress"
     Set installer = Nothing 
    ```

*   这是另一个通过 Symantec GUID 卸载的 VBScript：[http ://www.symantec.com/connect/downloads/uninstall-application-using-guid-registry](http://www.symantec.com/connect/downloads/uninstall-application-using-guid-registry)

*   [**通过升级代码和 ConfigureProduct 卸载**](https://stackoverflow.com/a/49077469/129130)。

* * *

# 8 -`Using a` [`Windows Installer major upgrade`](https://stackoverflow.com/a/23396011/129130)

*   作为安装另一个 MSI 文件的一部分，可能会发生 Windows Installer 主要升级。
*   **[重大升级是通过在 MSI 的“升级表](https://msdn.microsoft.com/en-us/library/aa372374%28v=vs.85%29.aspx)**”中识别相关产品来编写的。然后按照表中的规定处理这些相关设置。通常这意味着它们已被卸载，但也可以中止主设置（通常用于检测盒子上存在的您自己的应用程序的更高版本）。

* * *

# 9 -`Using Deployment Systems / Remote Administration Systems`

*   [SCCM](http://en.wikipedia.org/wiki/System_Center_Configuration_Manager)、[CA Unicenter](http://en.wikipedia.org/wiki/CA_Unicenter)、[IBM 的 Tivoli](http://en.wikipedia.org/wiki/Tivoli_Management_Framework)、[Altiris](http://en.wikipedia.org/wiki/Altiris) Client Management Suite 等
*   这些工具具有高级客户端 PC 管理功能，包括安装和卸载 MSI 文件
*   这些工具似乎使用 msiexec.exe、自动化、[WMI](https://en.wikipedia.org/wiki/Windows_Management_Instrumentation)等的组合......甚至它们自己调用安装和卸载的方式。
*   根据我的经验，这些工具具有很多“个性”，您需要适应它们不同的做事方式。

* * *

# 10 -`Using WMI - Windows Management Instrumentation`

*   添加只是为了完整性。不**建议**使用这种方法，因为它**非常慢**
    *   每次安装时每次调用**Win32_Product**都会触发**软件一致性检查**
    ***   一致性检查**非常慢**，而且还**可能触发软件修复**。请参阅这篇文章：**[Powershell 卸载脚本 - 真的很头疼](https://stackoverflow.com/questions/17868285/powershell-uninstall-script-have-a-real-headache/17868466#17868466)***   更糟糕的是，[有些人报告他们的事件日志充满了 MsiInstaller EventID 1035 条目](https://serverfault.com/questions/43067/what-could-be-causing-msiinstaller-to-continuously-reconfigure-applicationseven)- 显然是由对 Win32_Product 类的 WMI 查询引起的（我个人从未见过这种情况）。**
***   WMICodeCreator.exe代码创建工具可用于 **[实验](http://www.microsoft.com/en-us/download/details.aspx?id=8572)**
    *   安装可以通过调用`Win32_Product.Install`
    *   卸载可以通过调用`Win32_Product.Uninstall`*   MSDN 示例：[Win32_Product 类的卸载方法](https://msdn.microsoft.com/en-us/library/aa393941(v=vs.85).aspx)**

 *** * *

# 11 -`Using a third-party tool such as` [`ccleaner`](https://www.piriform.com/CCLEANER) `or similar`

*   一些 Windows 应用程序具有自己的界面，不仅可以卸载 MSI 软件包，还可以卸载旧版安装程序。
*   我不想在这里提出任何具体的工具推荐（尤其是商业工具），但是众所周知的[CCleaner](https://www.piriform.com/CCLEANER)具有这样的卸载界面（并且它有免费版本）。我还应该补充一点，[**这个工具最近遭受了恶意软件攻击**](https://www.pcworld.com/article/3225407/security/ccleaner-downloads-infected-malware.html)。
*   我想我们都应该记住，即使是无害的软件也可以在其下载位置注入恶意软件（FTP 攻击）。
    *   我使用[**virustotal.com**](https://www.virustotal.com)检查我的下载，并使用[Sysinternals Process Explorer](https://docs.microsoft.com/en-us/sysinternals/downloads/process-explorer)在安装后检查正在运行的进程 - 以及常规安全软件（以可用者为准）。
    *   使用这种方法通常会发现数量惊人的“灰色区域”软件（工具栏、笑脸、广告软件等），以及一些误报（它们也可能导致问题，因为安全软件会阻止他们的访问或隔离他们进行很多绒毛）。当然还有真正的恶意软件。
    *   [可以在此处找到 Process Explorer 的一些使用提示](https://twitter.com/glytzhkof/status/943103096569454592)- 一系列推文 - 此 Process Explorer 工具连接到[VirusTotal.com](https://www.virustotal.com)以交互方式检查所有正在运行的进程 - 您只需要几个配置步骤。
    *   我应该注意到 Process Explorer 会产生文件签名检查，但没有启发式 - 据我了解（没有检查可疑操作，只是检查 60 多个安全套件来检查标记文件）。您需要一个常规的安全工具来进行交互式在线启发式保护。
    *   就其价值而言，我认为某些安全软件会导致比恶意软件造成的损害更多的误报问题。勒索软件时代著名的遗言……
    *   这是一个足够大的题外话——我只是不想看到人们下载恶意软件。至少检查一下你的[virustotal.com](https://www.virustotal.com)。
*   像这样卸载应该可以正常工作。我认为当您尝试它们的“清理功能”时，这些工具会搞砸太多事情。谨慎使用。如果只使用卸载功能，应该没问题。

* * *

# 12 -`Using a cleanup tool such as` ~~`msizap`~~ `or similar`

*   为了完整性~~msizap.exe~~应该提到虽然它已被**弃用**、**不受支持**和**过时**。不应在任何较新的 Windows 版本上使用它
*   这个命令行工具（~~msizap.exe~~) 还有一个可用的 GUI (~~MSICUU2.exe~~）。这两种工具都已弃用。
*   这些工具的预期用途是**清除失败的卸载**：
*   通常，在极少数情况下，**带有随机名称的缓存 MSI 错误丢失**并且卸载失败，同时要求原始 MSI。这是一个罕见的问题，但我自己也看到过。只有几个潜在的原因：[**移至此答案**](https://stackoverflow.com/a/50478416/129130)。
    *   关键词：系统还原干扰、不良清理应用程序、msiexec.exe 崩溃、断电、安全软件干扰、MSI 开发调试错误（相同的包代码等）、用户修补和黑客攻击（这里有什么？节省空间？）， ETC...
    *   它也可以用来破坏任何 MSI 安装，尽管这显然是不可取的。
    *   更多信息：[为什么 MSI 需要原始 .msi 文件才能继续卸载？](https://stackoverflow.com/questions/208530/why-does-msi-require-the-original-msi-file-to-proceed-with-an-uninstall/1189524#1189524)
*   ~~[这个更新的支持工具](http://support2.microsoft.com/default.aspx?scid=kb;en-us;290301)~~（此工具现在也已弃用）如果您有需要卸载的失效 MSI 软件包，可以在最近的 Windows 版本上试用。
*   有些人建议使用 saschabeaumont 链接到此处的工具：**[Uninstall without a MSI file](https://stackoverflow.com/questions/334490/uninstall-without-an-msi-file/11058378#11058378)**。如果您尝试了它并且它有效，请务必让我们知道。
*   如果您有权访问实际用于安装产品的原始 MSI，则可以使用它来运行卸载。它必须是所使用的确切 MSI，而不仅仅是类似的。

* * *

# 13 -`Using` [`system restore`](http://en.wikipedia.org/wiki/System_Restore) `("installation undo" - last resort IMHO)`

*   严格来说，这不是“**卸载**”的方式，而是“**撤消**”最后一次安装或多次安装的方式。
*   通过还原点还原会使系统恢复到**以前的安装状态**（您可以在 YouTube 或类似网站上找到此视频演示）。
*   请注意，该功能可以完全或部分禁用 - 可以永久禁用整台机器，或每次安装即席。
*   *我看到了系统还原导致的新的、无法解决的安装问题，但通常可以正常工作*。显然不要为了好玩而使用该功能。这是最后的手段，最适合用于**回滚**刚刚安装的新驱动程序或设置，并发现会立即导致问题（[蓝屏](http://en.wikipedia.org/wiki/Blue_Screen_of_Death)、重新启动、不稳定等）。
*   你回去的时间越长，你为自己创造的返工就越多，风险就越高。大多数系统只有几个还原点，而且我相信它们中的大多数只能追溯到一两个月。
*   请注意，系统还原可能会影响必须重新应用的**Windows 更新**以及许多其他系统设置。[**除了纯粹的烦恼之外，这还可能导致安全问题再次出现，您可能希望使用Microsoft Baseline Security Analyzer**](http://en.wikipedia.org/wiki/Microsoft_Baseline_Security_Analyzer)或类似工具对目标框运行特定的安全检查。
*   由于我提到了系统还原，我想我应该提到[**Last Known Good Configuration 功能**](http://support.microsoft.com/kb/307852)。此功能与卸载或系统还原无关，但它是最后一次有效或导致系统运行的引导配置。如果系统在引导过程中蓝屏或停止，它可用于让您的系统再次运行。这通常发生在驱动程序安装后。

* * *

# 14 -`Windows Installer Functions (C++)`

为了完整起见，我想我们应该提到这一切的核心 - 最简单的方法：[Win32 Windows Installer API 函数](https://msdn.microsoft.com/en-us/library/windows/desktop/aa369426(v=vs.85).aspx)。这些可能是大多数（如果不是所有上面列出的“引擎盖下”的其他方法的话）所使用的功能。它们主要用于直接将 MSI 作为技术处理的应用程序或解决方案。

[serverfault.com 上有一个答案，作为卸载的不同编程方法](https://serverfault.com/questions/577969/is-it-possible-to-disable-msiexec-help-gui/596519#596519)（COM 自动化、.NET、Win32 安装程序功能）的总结，可能很有趣。

您将在下面找到一个 C++ 片段，显示如何`Orca, 10.1.17134.12`使用调用[MsiConfigureProductEx 函数](https://msdn.microsoft.com/en-us/library/windows/desktop/aa370071(v=vs.85).aspx)按产品代码卸载。要卸载另一产品，请将为您指定的 GUID 替换`prodcode`为您的产品的 GUID。要查找产品代码，请参阅此答案：[如何找到已安装 MSI 设置的产品 G​​UID？](https://stackoverflow.com/questions/29937568/how-can-i-find-the-product-guid-of-an-installed-msi-setup/29937569#29937569)

卸载将在完全 GUI 模式下进行。要在静默模式或其他一些 GUI 模式（精简、基本等）下运行，请参阅：[MsiSetInternalUI 函数](https://msdn.microsoft.com/en-us/library/windows/desktop/aa370389%28v=vs.85%29.aspx)。

```
#include "pch.h"

#define WIN32_LEAN_AND_MEAN //Minimize includes from Windows.h
#include <windows.h>
#include <msi.h> // Windows Installer
#include <tchar.h> 

#pragma comment(lib, "msi.lib") // To make code link

int main()
{
    const TCHAR noreboot[] = _T("REBOOT=ReallySuppress");
    const TCHAR prodcode[39] = _T("{D7B80ABC-1950-37B8-F851-C3783EED9C93}"); // Orca, 10.1.17134.12

    UINT res = MsiConfigureProductEx(prodcode, INSTALLLEVEL_DEFAULT, INSTALLSTATE_ABSENT, noreboot);

    return res; // Error Codes: https://msdn.microsoft.com/en-us/library/windows/desktop/aa376931(v=vs.85).aspx
} 
```

截至 2018 年 9 月，该代码段是使用最新版本的**Visual Studio 2017制作和测试的：**

1.  从 Visual C++ => Windows 桌面创建一个新的“Windows 控制台应用程序”。

2.  将上述代码复制并粘贴到您的主 CPP 文件中（替换其中的任何内容）。

3.  那应该是它能够运行代码。也许设置一个断点，构建并运行。

    *   ~~当心 VS2017 中默认模板的更改，以及可能导致的奇怪错误：[IntelliSense 引擎无法正常运行的错误太多](https://stackoverflow.com/questions/48129786/there-are-too-many-errors-for-the-intellisense-engine-to-function-correctly)。~~
    *   **2018 年 9 月更新**：模板再次更改。我不再看到上述问题。
    *   代码中的 MSDN 链接列出了从 msiexec.exe 返回的可能的错误消息。

* * *

## 回答 #2

> 赞同：51
> 
> 时间：2009-01-16T10:46:17.300

简短的回答：你不能。使用 MSIEXEC /x

长答案：当您直接在命令行运行 MSI 文件时，所发生的只是它为您运行 MSIEXEC。此关联存储在注册表中。您可以通过（在 Windows 资源管理器中）转到工具/文件夹选项/文件类型来查看关联列表。

例如，您可以从命令行运行 .DOC 文件，WordPad 或 WinWord 将为您打开它。

如果您在注册表中`HKEY_CLASSES_ROOT\.msi`查看，您会看到 .MSI 文件与 ProgID“Msi.Package”相关联。如果您查看`HKEY_CLASSES_ROOT\Msi.Package\shell\Open\command`，您将看到 Windows 在“运行” .MSI 文件时实际使用的命令行。

* * *

## 回答 #3

> 赞同：32
> 
> 时间：2010-01-21T23:09:28.580

另请记住，可以使用 WMIC 命令启动卸载：

`wmic product get name`--> 这将列出所有已安装应用程序的名称

`wmic product where name='myappsname' call uninstall`--> 这将卸载应用程序。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-01-16T10:44:03.233

`msi`文件扩展名映射到 msiexec（与在命令提示符下键入 .txt 文件名的方式相同，会启动记事本/默认文件`.txt`处理程序以显示文件）。

因此，输入带有 .msi 扩展名的文件名确实会以 MSI 文件作为参数运行 msiexec，并采用默认操作 install。出于这个原因，卸载需要您调用带有卸载开关的 msiexec 来卸载它。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-03T17:17:07.350

我会尝试以下语法 - 它适用于我。

```
msiexec /x filename.msi /q 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2011-11-10T03:06:32.713

```
wmic product get name 
```

只是让cmd卡住了......几分钟后仍然闪烁_

在 中`HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall`，如果您可以找到具有您要安装的软件名称的文件夹（不是以 ProductCode 命名的文件夹），则 UninstallString 指向应用程序自己的卸载程序`C:\Program Files\Zune\ZuneSetup.exe /x`

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2009-01-16T10:46:01.730

我假设当您在命令行中键入 int file.msi 时，Windows 会自动为您调用 msiexec file.msi。我假设这是因为当您输入 picture.png 时，它会显示默认的图片查看器。

# .net - .Net 中的动态 CSS 品牌重塑和覆盖

> ID：450032
> 
> 赞同：1
> 
> 时间：2009-01-16T10:41:30.787
> 
> 标签：.net, css

我的任务是建立一种机制来动态更改 .Net 站点中的 css 颜色。目的是确保当我们的内部应用程序站点被构建并部署到我们的 UAT 服务器时，该站点的 UI 与实时版本可识别地不同，而无需更改代码库。

一种选择是遍历每个站点并创建 CSS 的并行 UAT 版本，但我希望有一个处理程序或其他东西来根据键/值对替换 CSS 中的颜色定义，因为我们的颜色在整个应用程序。理想情况下，它应该简单地拦截 css 请求，将任何标准颜色代码定义替换为所需的 UAT 颜色，然后将 CSS 替换为服务器。这听起来像是对问题的现实解决方案，还是任何人都可以提出一种不涉及管理多个 CSS 定义的更好方法？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-02T04:34:04.677

您需要像 HTTP 处理程序这样复杂的东西。只需创建一个输出 CSS 的 .aspx 页面。它可以是 .aspx，只需让您的标签引用 .aspx 页面。

如果你真的想让你的 .css 页面由 ASP.NET 处理（我不会，因为它会影响性能），那么你想添加一个扩展映射，如下所示：http: [//blogs.iis.net/ruslany/archive /2008/09/30/wildcard-script-mapping-and-iis-7-integrated-pipeline.aspx](http://blogs.iis.net/ruslany/archive/2008/09/30/wildcard-script-mapping-and-iis-7-integrated-pipeline.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-09-03T23:08:43.973

您可能还想看一下less：

[http://www.4guysfromrolla.com/articles/030310-1.aspx](http://www.4guysfromrolla.com/articles/030310-1.aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-16T10:59:02.843

只是一个更新，我发现了一些与我在这里想要实现的目标非常相似的东西。

[http://pastebin.ca/1205892](http://pastebin.ca/1205892)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-16T12:35:19.073

Alex（您向其发布博客链接的人）说您需要将以下内容添加到 web.config：

如果您使用“IIS6 / Visual Studio 测试服务器”：

```
<system.web>
    <httpHandlers>
        <add verb="*" path="*.css" type="StyleSheetHandler"/>
    </httpHandlers>
</system.web> 
```

如果您使用的是 IIS7：

它应该可以工作，但是如果没有，那么您将需要像这样检查映射：

对于网站：

```
IIS6 > Website > Home directory 
```

对于虚拟目录浏览到：

```
IIS6 > Virtual folder > Virtual directory (default tab) 
```

单击应用程序设置区域中的配置按钮。

找到 .css 扩展名并检查它是否正在使用 aspnet_isapi.dll

如果不是，那么只需将其更改为。（您可以从任何其他 .NET 扩展名复制完整的 URL，例如 .aspx）

然后一切都应该正常工作。

# javascript - 使用 Javascript 播放声音通知？

> ID：450033
> 
> 赞同：87
> 
> 时间：2009-01-16T10:41:47.323
> 
> 标签：javascript, jquery, audio

我该怎么做，所以每当用户单击链接时，我们都会播放声音？在这里使用 javascript 和 jquery。

* * *

## 回答 #1

> 赞同：47
> 
> 时间：2012-04-06T14:52:19.747

使用这个插件：[https ://github.com/admsev/jquery-play-sound](https://github.com/admsev/jquery-play-sound)

```
$.playSound('http://example.org/sound.mp3'); 
```

* * *

## 回答 #2

> 赞同：25
> 
> 时间：2013-08-27T15:01:15.103

在您的页面上放置一个`<audio>`元素。
获取您的音频元素并调用该`play()`方法：

```
document.getElementById('yourAudioTag').play(); 
```

看看这个例子： http: [//www.storiesinflight.com/html5/audio.html](http://www.storiesinflight.com/html5/audio.html)

[该站点](http://blog.gingertech.net/wp-content/uploads/2011/01/LCA_MM_AVProc2011/#slide6)揭示了您可以做的其他一些很酷的事情，例如`load()`、`pause()`和音频元素的一些其他属性。

您想要播放此音频元素的确切时间由您决定。如果您愿意，请阅读按钮的文本并将其与“否”进行比较。

## 或者

[http://www.schillmania.com/projects/soundmanager2/](http://www.schillmania.com/projects/soundmanager2/)

SoundManager 2 提供了一个易于使用的 API，允许在任何现代浏览器（包括 IE 6+）中播放声音。如果浏览器不支持 HTML5，那么它会从 flash 中获得帮助。如果你想要严格的 HTML5 并且没有 flash，有一个设置，preferFlash=false

它在 iPad、iPhone (iOS4) 和其他支持 HTML5 的设备 + 浏览器上支持 100% 无 Flash 音频

使用很简单：

```
<script src="soundmanager2.js"></script>
<script>
// where to find flash SWFs, if needed...
soundManager.url = '/path/to/swf-files/';

soundManager.onready(function() {
    soundManager.createSound({
        id: 'mySound',
        url: '/path/to/an.mp3'
    });

    // ...and play it
    soundManager.play('mySound');
}); 
```

这是它的实际演示：[http ://www.schillmania.com/projects/soundmanager2/demo/christmas-lights/](http://www.schillmania.com/projects/soundmanager2/demo/christmas-lights/)

* * *

## 回答 #3

> 赞同：21
> 
> 时间：2009-01-16T10:48:46.140

发现类似的东西：

```
//javascript:
function playSound( url ){   
  document.getElementById("sound").innerHTML="<embed src='"+url+"' hidden=true autostart=true loop=false>";
} 
```

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2014-06-05T18:42:15.777

使用 html5 音频标签和 jquery：

```
// appending HTML5 Audio Tag in HTML Body
$('<audio id="chatAudio">
    <source src="notify.ogg" type="audio/ogg">
    <source src="notify.mp3" type="audio/mpeg">
</audio>').appendTo('body');

// play sound
$('#chatAudio')[0].play(); 
```

[来自这里](http://www.9lessons.info/2013/04/play-notification-sound-using-jquery.html)的代码。

在我的实现中，我将音频嵌入直接添加到 HTML 中，而无需附加 jquery。

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2009-01-16T15:37:55.270

JavaScript 声音管理器：

[http://www.schillmania.com/projects/soundmanager2/](http://www.schillmania.com/projects/soundmanager2/)

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2010-01-28T19:37:50.183

```
$('a').click(function(){
    $('embed').remove();
    $('body').append('<embed src="/path/to/your/sound.wav" autostart="true" hidden="true" loop="false">');
}); 
```

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2012-11-02T11:24:21.313

我用Web Audio API写了一个可以做到的小函数......

```
var beep = function(duration, type, finishedCallback) {

    if (!(window.audioContext || window.webkitAudioContext)) {
        throw Error("Your browser does not support Audio Context.");
    }

    duration = +duration;

    // Only 0-4 are valid types.
    type = (type % 5) || 0;

    if (typeof finishedCallback != "function") {
        finishedCallback = function() {};   
    }

    var ctx = new (window.audioContext || window.webkitAudioContext);
    var osc = ctx.createOscillator();

    osc.type = type;

    osc.connect(ctx.destination);
    osc.noteOn(0);

    setTimeout(function() {
        osc.noteOff(0);
        finishedCallback();
    }, duration);

}; 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2011-08-05T11:46:44.780

以下代码可能会帮助您仅使用 javascript 在网页中播放声音。[您可以在http://sourcecodemania.com/playing-sound-javascript-flash-player/](http://sourcecodemania.com/playing-sound-javascript-flash-player/)查看更多详细信息

```
<script>
function getPlayer(pid) {
    var obj = document.getElementById(pid);
    if (obj.doPlay) return obj;
    for(i=0; i<obj.childNodes.length; i++) {
        var child = obj.childNodes[i];
        if (child.tagName == "EMBED") return child;
    }
}
function doPlay(fname) {
    var player=getPlayer("audio1");
    player.play(fname);
}
function doStop() {
    var player=getPlayer("audio1");
    player.doStop();
}
</script>

<form>
<input type="button" value="Play Sound" onClick="doPlay('texi.wav')">
<a href="#" onClick="doPlay('texi.wav')">[Play]</a>
<object classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000"
    width="40"
    height="40"
    id="audio1"
    align="middle">
    <embed src="wavplayer.swf?h=20&w=20"
        bgcolor="#ffffff"
        width="40"
        height="40"
        allowScriptAccess="always"
        type="application/x-shockwave-flash"
        pluginspage="http://www.macromedia.com/go/getflashplayer"
    />
</object>

<input type="button" value="Stop Sound" onClick="doStop()">
</form> 
```

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2011-02-25T18:56:42.677

新的emermer...目前看来兼容IE、Gecko浏览器和iPhone...

[http://www.jplayer.org/](http://www.jplayer.org/)

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-01-16T10:45:49.470

首先，作为用户，我不喜欢这样。

最好的方法可能是使用一个小的 Flash 小程序在后台播放您的声音。

还在这里回答：[从 Javascript 播放声音的跨平台、跨浏览器方式？](https://stackoverflow.com/questions/187098/cross-platform-cross-browser-way-to-play-sound-from-javascript)

# dll - 如何以编程方式获取 DLL 依赖项

> ID：450039
> 
> 赞同：19
> 
> 时间：2009-01-16T10:44:18.833
> 
> 标签：dll, dependencies

如何获取给定 DLL 或 EXE 文件的所有 DLL 依赖项的列表？

换句话说，我想以编程方式执行与“Dependency walker”工具相同的操作。

什么是 Windows（最好是 .NET）API？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-01-16T10:52:20.097

您可以使用[EnumProcessModules](http://msdn.microsoft.com/en-us/library/ms682631(VS.85).aspx)函数。kaanbardak 建议的托管 API 不会为您提供本机模块列表。

例如在 MSDN 上看到[这个页面](http://msdn.microsoft.com/en-us/library/ms682621(VS.85).aspx)

如果您需要静态分析您的 dll，您必须深入研究[PE 格式](http://en.wikipedia.org/wiki/Portable_Executable)并了解导入表。有关详细信息，请参阅此[出色的教程](http://win32assembly.programminghorizon.com/pe-tut6.html)。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-16T13:45:00.977

> **注意**：根据下面帖子的评论，我想这也可能会错过非托管依赖项，因为它依赖于反射。

这是一个小的 c# 程序，由来自 bytes.com 的 Jon Skeet 在[.NET Dependency Walker上编写](http://bytes.com/topic/net/answers/107335-net-dependency-walker#td_post_381010)

```
using System;
using System.Reflection;
using System.Collections;

public class DependencyReporter
{
    static void Main(string[] args)
    {
        //change this line if you only need to run the code one:
        string dllToCheck = @"";

        try
        {
            if (args.Length == 0)
            {
                if (!String.IsNullOrEmpty(dllToCheck))
                {
                    args = new string[] { dllToCheck };
                }
                else
                {
                    Console.WriteLine
                        ("Usage: DependencyReporter <assembly1> [assembly2 ...]");
                }
            }

            Hashtable alreadyLoaded = new Hashtable();
            foreach (string name in args)
            {
                Assembly assm = Assembly.LoadFrom(name);
                DumpAssembly(assm, alreadyLoaded, 0);
            }
        }
        catch (Exception e)
        {
            DumpError(e);
        }

        Console.WriteLine("\nPress any key to continue...");
        Console.ReadKey();
    }

    static void DumpAssembly(Assembly assm, Hashtable alreadyLoaded, int indent)
    {
        Console.Write(new String(' ', indent));
        AssemblyName fqn = assm.GetName();
        if (alreadyLoaded.Contains(fqn.FullName))
        {
            Console.WriteLine("[{0}:{1}]", fqn.Name, fqn.Version);
            return;
        }
        alreadyLoaded[fqn.FullName] = fqn.FullName;
        Console.WriteLine(fqn.Name + ":" + fqn.Version);

        foreach (AssemblyName name in assm.GetReferencedAssemblies())
        {
            try
            {
                Assembly referenced = Assembly.Load(name);
                DumpAssembly(referenced, alreadyLoaded, indent + 2);
            }
            catch (Exception e)
            {
                DumpError(e);
            }
        }
    }

    static void DumpError(Exception e)
    {
        Console.ForegroundColor = ConsoleColor.Red;
        Console.WriteLine("Error: {0}", e.Message);
        Console.WriteLine();
        Console.ResetColor();
    }
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-10T08:32:38.177

要获取本机模块依赖项，我认为从 PE 文件的导入表中获取它应该是可以的，这里有 2 个链接可以深入解释这一点：

[http://msdn.microsoft.com/en-us/magazine/bb985992.aspx](http://msdn.microsoft.com/en-us/magazine/bb985992.aspx)

[http://msdn.microsoft.com/en-us/magazine/cc301808.aspx](http://msdn.microsoft.com/en-us/magazine/cc301808.aspx)

要获取 .NET 依赖项，我们可以使用 .NET 的 API，例如 Assembly.Load。

要获得 .NET 模块的所有依赖项，如何结合两种方式 - .NET 程序集只是带有元数据的 PE 文件。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2016-02-05T23:01:11.760

虽然这个问题已经有一个公认的答案，但其他答案中引用的文档（如果没有损坏）是旧的。我没有通读所有内容，只是发现它没有涵盖 Win32 和 x64 之间的差异或其他差异，我的方法是：

```
C:\UnxUtils\usr\local\wbin>strings.exe E:\the-directory-I-wanted-the-info-from\*.dll > E:\TEMP\dll_strings.txt 
```

这允许我使用 Notepad++ 或 gvim 或其他任何东西来搜索仍然依赖于 dll 名称末尾带有 120.dll 的 MS dll 的 dll，这样我就可以找到需要更新的那些。

这可以很容易地用您喜欢的语言编写脚本。

鉴于我在搜索此信息时考虑了 VS 2015，并且此问题是 Google 搜索的最高结果，因此我提供此答案可能对寻找相同内容的其他人有用。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-10T09:44:34.650

要读取正在运行的 exe 加载的 DLL（模块），请使用 [MSDN 上的 ToolHelp32 函数工具帮助文档](http://msdn.microsoft.com/en-us/library/ms686832(VS.85).aspx)。

不知道运行 .Net 的 exe 会显示什么（我从未尝试过）。但是，它确实显示了加载 DLL 的完整路径。通常，这是我在尝试解决 DLL 问题时需要的信息。.Net 应该已经消除了使用这些函数的需要（查找 DLL Hell 以获取更多信息）。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2019-03-08T17:43:27.037

如果您不想在程序中加载程序集，可以使用 DnSpy ( [https://www.nuget.org/packages/dnSpyLibs](https://www.nuget.org/packages/dnSpyLibs) )：

```
var assemblyDef = dnlib.DotNet.AssemblyDef.Load("yourDllName.dll");
var dependencies = assemblyDef.ManifestModule.GetAssemblyRefs(); 
```

请注意，您在“ManifestModule”属性中拥有所需的所有信息。

# iphone - 为什么这个 OpenGL ES 代码在 iPhone 上运行缓慢？

> ID：450042
> 
> 赞同：6
> 
> 时间：2009-01-16T10:46:03.273
> 
> 标签：iphone, opengl-es

我在学习 OpenGL ES 时稍微修改了 iPhone SDK 的 GLSprite 示例，结果发现速度很慢。即使在模拟器中（硬件最差）所以我一定做错了，因为它只有 400 个带纹理的三角形。

```
const GLfloat spriteVertices[] = {
  0.0f, 0.0f, 
  100.0f, 0.0f,  
  0.0f, 100.0f,
  100.0f, 100.0f
};

const GLshort spriteTexcoords[] = {
  0,0,
  1,0,
  0,1,
  1,1
};

- (void)setupView {
    glViewport(0, 0, backingWidth, backingHeight);
    glMatrixMode(GL_PROJECTION);
    glLoadIdentity();
    glOrthof(0.0f, backingWidth, backingHeight,0.0f, -10.0f, 10.0f);
    glMatrixMode(GL_MODELVIEW);

    glClearColor(0.3f, 0.0f, 0.0f, 1.0f);

    glVertexPointer(2, GL_FLOAT, 0, spriteVertices);
    glEnableClientState(GL_VERTEX_ARRAY);
    glTexCoordPointer(2, GL_SHORT, 0, spriteTexcoords);
    glEnableClientState(GL_TEXTURE_COORD_ARRAY);

    // sprite data is preloaded. 512x512 rgba8888   
    glGenTextures(1, &spriteTexture);
    glBindTexture(GL_TEXTURE_2D, spriteTexture);
    glTexImage2D(GL_TEXTURE_2D, 0, GL_RGBA, width, height, 0, GL_RGBA, GL_UNSIGNED_BYTE, spriteData);
    free(spriteData);

    glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_MIN_FILTER, GL_LINEAR);

    glEnable(GL_TEXTURE_2D);
    glBlendFunc(GL_ONE, GL_ONE_MINUS_SRC_ALPHA);
    glEnable(GL_BLEND);
} 

- (void)drawView {
  ..
    glClear(GL_COLOR_BUFFER_BIT);
    glLoadIdentity();
    glTranslatef(tx-100, ty-100,10);
    for (int i=0; i<200; i++) { 
        glTranslatef(1, 1, 0);
        glDrawArrays(GL_TRIANGLE_STRIP, 0, 4);
    }
  ..
} 
```

每次触摸屏幕或移动屏幕上的手指时都会调用 drawView，并将 tx,ty 设置为发生触摸的 x,y 坐标。

我也尝试过使用 GLBuffer，当翻译是预先生成的并且只有一个 DrawArray 但提供了相同的性能（~4 FPS）。

===编辑===

同时我已经修改了这个，以便使用更小的四边形（尺寸：34x20）并且更少的重叠。大约 400 个四边形 -> 800 个三角形分布在整个屏幕上。纹理大小为 512x512 atlas 和 RGBA_8888，而纹理坐标为浮点数。该代码在 API 效率方面非常难看：有两个 MatrixMode 更改以及两个加载和两个平移，然后是三角形带（四边形）的绘制数组。现在这会产生 ~45 FPS。

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2010-03-28T07:31:20.643

（我知道这已经很晚了，但我无法抗拒。无论如何我都会发帖，以防其他人来这里寻求建议。）

这与纹理大小无关。我不知道为什么人们评价尼尔斯。他似乎对 OpenGL 管道有一个根本性的误解。他似乎认为对于给定的三角形，整个纹理被加载并映射到该三角形上。反之亦然。

一旦三角形被映射到视口中，它就会被光栅化。对于三角形覆盖的每个屏幕像素，都会调用片段着色器。默认片段着色器（您正在使用的 OpenGL ES 1.1）将查找最接近映射 (GL_NEAREST) 到您正在绘制的像素的纹素。它可能会查找 4 个纹素，因为您使用更高质量的 GL_LINEAR 方法来平均最佳纹素。尽管如此，如果三角形中的像素数为 100，那么您必须读取的纹理字节数最多为 4（查找）* 100（像素）* 4（每种颜色的字节数。远低于 Nils 所说的。令人惊讶的是，他可以让它听起来像是他真的知道他在说什么。

WRT 平铺架构，这在嵌入式 OpenGL 设备中很常见，以保留参考的局部性。我相信每个图块都会暴露在每个绘图操作中，很快就会剔除其中的大部分。然后图块决定在其自身上绘制什么。当你打开混合时，这会慢得多，就像你做的那样。因为您使用的大三角形可能会与其他图块重叠和混合，所以 GPU 必须做很多额外的工作。如果不是渲染带有 alpha 边缘的示例正方形，而是渲染实际形状（而不是形状的正方形图片），那么您可以关闭这部分场景的混合，我敢打赌这会加快速度极大地。

如果您想尝试一下，只需关闭混合并查看速度加快了多少，即使看起来不正确。glDisable(GL_BLEND);

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-16T11:04:53.377

您的纹理是每像素 512*512*4 字节。那是一兆字节的数据。如果每帧渲染 200 次，则会产生每帧 200 兆字节的带宽负载。

在大约 4 fps 的情况下，仅纹理读取就消耗 800mb/秒。帧和 Zbuffer 写入也需要带宽。然后是 CPU，也不要低估显示器的带宽要求。

嵌入式系统（例如您的 iphone）上的 RAM 不如桌面 PC 上的快。您在这里看到的是带宽匮乏效应。RAM 根本无法更快地处理数据。

如何解决这个问题：

*   选择一个理智的纹理大小。平均而言，每个像素应该有 1 个纹素。这给出了清晰的纹理。我知道 - 这并不总是可能的。使用常识。

*   使用 mipmap。这占用了 33% 的额外空间，但允许图形芯片在可能的情况下选择使用较低分辨率的 mipmap。

*   尝试较小的纹理格式。也许您可以使用 ARGB4444 格式。这将使渲染速度加倍。还要看看压缩的纹理格式。解压缩不会像在硬件中那样导致性能下降。事实上恰恰相反：由于内存中的尺寸更小，图形芯片可以更快地读取纹理数据。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-03T10:39:47.310

我想我的第一次尝试只是一个糟糕的（或非常好的）测试。iPhone 有一个 PowerVR MBX Lite，它有一个基于 tile 的图形处理器。它将屏幕细分为更小的图块并平行渲染。现在在上面的第一种情况下，由于非常高的重叠，细分可能会有点用尽。此外，由于距离相同，它们无法被剪裁，因此必须计算所有纹理坐标（这可以通过更改循环中的平移来轻松测试）。同样由于重叠，并行性不能被利用，一些瓦片什么都不做，其余的（1/3）工作很多。

所以我认为，虽然内存带宽可能是一个瓶颈，但在本例中并非如此。问题更多是因为图形硬件的工作方式和测试的设置。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-03T01:10:36.210

我不熟悉 iPhone，但如果它没有专门的硬件来处理浮点数（我怀疑它没有），那么尽可能使用整数会更快。

我目前正在为Android（也使用OpenGL ES）开发，例如我的顶点数组是int而不是float。我不能说它有多大的不同，但我想它值得一试。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-03T06:23:35.953

> 苹果对 iPhone 的具体硬件规格守口如瓶，对于我们这些来自控制台背景的人来说，这似乎很奇怪。但人们已经能够确定 CPU 是 32 位 RISC [ARM1176JZF](http://www.arm.com/products/CPUs/ARM1176.html)。好消息是它有一个完整的浮点单元，所以我们可以像在大多数平台上那样继续编写数学和物理代码。

[http://gamesfromwithin.com/?p=239](http://gamesfromwithin.com/?p=239)

# sql-server-2005 - 执行手动故障转移（无见证，高保护模式）

> ID：450048
> 
> 赞同：1
> 
> 时间：2009-01-16T10:47:47.780
> 
> 标签：sql-server-2005, mirroring

如果主要伙伴和镜像伙伴都可用，我可以执行故障转移，但是当主体关闭或从网络中拔出（即失败）时，我不知道如何进行手动故障转移。

我尝试使用：

```
ALTER DATABASE myMirrorDatabase SET PARTNER FORCE_SERVICE_ALLOW_DATA_LOSS 
```

但这会将数据库置于以下状态：

```
[In Recovery] 
```

我无法运行`RESTORE DATABASE`，因为数据库配置为镜像。那么这样做的正确方法是什么？帮助！

* * *

更多信息...（`SERVER_A`与`DB_A`和`SERVER_B`一起给出`DB_B`）

初始状态：

```
DB_A is [Principal, Synchronised], DB_B is [Mirror, Synchronised / Restoring] 
```

我停下来`SERVER_A`：

```
DB_A is [offline], DB_B is [Mirror, Disconnected / In Recovery] 
```

我运行`alter`上面的数据库语句：

```
DB_A is [offline], DB_B is [In Recovery] 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-16T13:28:02.337

如果您有计划外的故障转移，其中主体和见证不可用，您应该在镜像上发出以下语句：

```
USE master
go
ALTER DATABASE AdventureWorks SET PARTNER OFF
GO
RESTORE DATABASE AdventureWorks WITH RECOVERY
GO 
```

这将使镜像联机。

如果您需要在主体再次可用后重新建立镜像配置，您需要完成备份镜像数据库（因为它现在是最新版本）、恢复到主体然后重新配置镜像的过程但反过来。最后，镜像将成为新的主体。

# tfs - 如何在 TFS Team Build 中复制递归目录结构？

> ID：450050
> 
> 赞同：0
> 
> 时间：2009-01-16T10:48:16.983
> 
> 标签：tfs, msbuild, directory, tfsbuild

是否可以在团队构建目标中复制目录？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-01T16:10:51.747

```
<Copy SourceFiles="@(SourceItemGroup)" DestinationFolder="$(YourDir\SubDir\%(RecursiveDir)" /> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-16T10:54:57.437

我发现最简单的方法（如果您想对包含/排除的内容更加严格）是使用我编写的一些自定义 MSBuild 任务：[http ://www.aaron-powell.com/blog.aspx ?cat=AaronPowell.MSBuild.Tasks](http://www.aaron-powell.com/blog.aspx?cat=AaronPowell.MSBuild.Tasks)

您提供源目录、目标方向（提供对网络共享的支持）和要排除的文件名/扩展名。

这主要是因为 Team Build 在运行时会弄得一团糟（尤其是 Web 应用程序），并且实际上不可能使用标准的 MSBuild 复制任务。

# runtime - zlib + masm

> ID：450051
> 
> 赞同：0
> 
> 时间：2009-01-16T10:48:29.760
> 
> 标签：runtime, zlib, msvcrt, masm

zlib 可以在没有所有 c 运行时库（如 msvcrt.dll 和许多其他库）的情况下与 masm 一起使用吗？如果是这样，你能告诉我怎么做吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-16T13:20:03.990

zlib 确实包含针对各种处理器和汇编器（包括 masm）的优化汇编器。但是那个汇编器只适用于 zlib 的最里面的部分。换句话说，它不是在汇编程序中完全重新实现 zlib。因此，使用 masm 块不会改变 zlib 的依赖关系。

也就是说：应该可以静态链接您的应用程序，包括您正在使用且没有外部依赖项的任何 C 运行时库功能。

话又说回来，msvcrt.dll 几乎存在于任何地方的每个 Windows 系统上，那么您为什么要这样做呢？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-29T16:49:48.937

Zlib 不是 C++ 库，所以我不明白为什么需要 C++ 运行时库才能使用它。

我认为您的意思是 C 库。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-01-12T14:30:36.860

这取决于你想做什么，如果你只是想解压缩数据，我会推荐 Joergen Ibsen 的 TINF 库，ZLIB 包中的那些组装实现非常没用，会让你头疼；）

# c# - 有没有办法在 C# 中的其他控件上绘制控件？

> ID：450055
> 
> 赞同：3
> 
> 时间：2009-01-16T10:49:40.163
> 
> 标签：c#, gdi+

我想在它被覆盖的绘制事件中在其他一些控件上绘制一个控件。通过绘图，我的意思是真正的绘图，而不是将控件放在另一个控件中。有什么好办法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-16T12:44:33.623

**尝试ControlPaint**类的静态方法。绘制的控件可能不像 GUI 的其余部分那样被蒙皮，但效果会非常可信。下面是我的一些代码的精简版。**它使用ControlPaint.DrawButton**方法覆盖 ownerdrawn ListBox 的 DrawItem 方法，使列表项看起来像按钮。

该类还有更多用于复选框、组合甚至拖动手柄的好东西。

```
protected override void OnDrawItem(System.Windows.Forms.DrawItemEventArgs e)
{
    e.DrawBackground();

    if (e.Index > -1)
    {
        String itemText = String.Format("{0}", this.Items.Count > 0 ? this.Items[e.Index] : this.Name);

        //Snip

        System.Windows.Forms.ControlPaint.DrawButton(e.Graphics, e.Bounds, ButtonState.Normal);

        e.Graphics.DrawString(itemText, this.Font, SystemBrushes.ControlText, e.Bounds);
    }
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-09-29T12:49:36.490

通过使用控件的 DrawToBitmap 方法，您可以很容易地做到这一点。这是一个片段，它将创建一个 Button 并将其绘制在相同大小的 PictureBox 上：

```
Button btn = new Button();
btn.Text = "Hey!";
Bitmap bmp = new Bitmap(btn.Width, btn.Height);
btn.DrawToBitmap(bmp, new Rectangle(0, 0, btn.Width, btn.Height));
PictureBox pb = new PictureBox();
pb.Size = btn.Size;
pb.Image = bmp; 
```

要在另一个控件的 Paint 事件中使用这种方法，您可以从上面的控件创建位图，然后将其绘制在控件的表面上，如下所示：

```
e.Graphics.DrawImage(bmp, 0, 0);
bmp.Dispose(); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-16T11:03:56.297

也许您所追求的是一个“面板”，您可以从中继承然后创建自己的行为？

```
class MyPanel : System.Windows.Forms.Panel
{
    protected override void OnPaint(System.Windows.Forms.PaintEventArgs e)
    {
        base.OnPaint(e);
    }
} 
```

抓住 e.graphics，你可以在控制范围内做任何你想做的事情。从内存中，您可以在控件等上设置最小尺寸，但您需要跳转到 MSDN 中的 windows.forms 文档以获取更多详细信息（或者您可以在这里提出另一个问题；））。

或者，如果您例如添加功能，您应该从控件继承您尝试增强和覆盖它的绘制方法？

也许您可以详细说明（在您的问题中）您希望这样做是为了什么？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-16T11:12:07.170

```
public delegate void OnPaintDelegate( PaintEventArgs e );
private void panel1_Paint( object sender, PaintEventArgs e ) {
    OnPaintDelegate paintDelegate = (OnPaintDelegate)Delegate.CreateDelegate(
        typeof( OnPaintDelegate )
        , this.button1
        , "OnPaint" );
    paintDelegate( e );
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-16T11:20:30.210

您可以按照@TcKs 的建议添加/覆盖 OnPaint 处理程序或使用 BitBlt 函数：

```
[DllImport("gdi32.dll")]
private static extern bool BitBlt(
    IntPtr hdcDest,
    int nXDest, 
    int nYDest, 
    int nWidth, 
    int nHeight, 
    IntPtr hdcSrc, 
    int nXSrc, 
    int nYSrc, 
    int dwRop 
);

private const Int32 SRCCOPY = 0xCC0020;

....

Graphics sourceGraphics = sourceControl.CreateGraphics();
Graphics targetGraphics = targetControl.CreateGraphics();
Size controlSize = sourceControl.Size;
IntPtr sourceDc = sourceGraphics.GetHdc();
IntPtr targerDc = targetGraphics.GetHdc();
BitBlt(targerDc, 0, 0, controlSize.Width, controlSize.Height, sourceDc, 0, 0, SRCCOPY);
sourceGraphics.ReleaseHdc(sourceDc);
targetGraphics.ReleaseHdc(targerDc); 
```

# windows - 是否可以显示 gridview 或 table 而不是启用自动完成时出现的列表框？

> ID：450058
> 
> 赞同：0
> 
> 时间：2009-01-16T10:50:21.363
> 
> 标签：windows, autocomplete

我想在 c#.net (VS2005) 的程序中开发 YUI 自动完成功能，如自动完成功能。它是一个 Windows 应用程序。在文本框中输入字符时，是否可以在网格视图或表格中显示搜索结果？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-22T06:52:33.577

完全按照您的要求进行操作非常容易。只需将`TextChanged`事件添加到您的文本框中，并在更改时进行搜索。

```
private void textHost_TextChanged(object sender, EventArgs e)
{
   // Do search and update the results
} 
```

但是，您必须考虑到，如果您的搜索需要花费更多时间而不是微不足道的时间，那么当输入每个字符时用户会出现延迟时，用户会感到恼火。为此，您应该`BackgroundWorker`在后台线程中使用并进行搜索。当按下一个新键时，调用`Cancel`线程上的方法并启动一个新键。

如果你想变得更复杂，你可以设置一个后台线程，每次按下一个键时都会发出信号。如果半秒左右没有收到新信号，则开始后台搜索。

# c# - 如何使用 C# 设置组合框中的选定项目以匹配我的字符串？

> ID：450059
> 
> 赞同：221
> 
> 时间：2009-01-16T10:50:23.157
> 
> 标签：c#, winforms, combobox

我有一个字符串“test1”，我的组合框包含`test1`、`test2`和`test3`。如何将所选项目设置为“test1”？也就是说，如何将我的字符串与组合框项目之一匹配？

我正在考虑下面的行，但这不起作用。

```
comboBox1.SelectedText = "test1"; 
```

* * *

## 回答 #1

> 赞同：306
> 
> 时间：2009-01-16T11:08:19.173

这应该可以解决问题：

```
Combox1.SelectedIndex = Combox1.FindStringExact("test1") 
```

* * *

## 回答 #2

> 赞同：211
> 
> 时间：2009-01-16T23:48:35.907

您是否尝试过[Text](http://msdn.microsoft.com/en-us/library/system.windows.forms.combobox.text.aspx)属性？这个对我有用。

```
ComboBox1.Text = "test1"; 
```

SelectedText 属性用于组合框文本框部分中可编辑文本的选定部分。

* * *

## 回答 #3

> 赞同：51
> 
> 时间：2009-01-16T10:57:52.860

假设您的组合框不是数据绑定的，您需要在表单的“items”集合中找到对象的索引，然后将“selectedindex”属性设置为适当的索引。

```
comboBox1.SelectedIndex = comboBox1.Items.IndexOf("test1"); 
```

请记住，如果未找到该项目，IndexOf 函数可能会引发参数异常。

* * *

## 回答 #4

> 赞同：42
> 
> 时间：2009-01-16T10:52:24.510

如果您的 ComboBox 中的项目是字符串，您可以尝试：

```
comboBox1.SelectedItem = "test1"; 
```

* * *

## 回答 #5

> 赞同：14
> 
> 时间：2018-10-18T07:52:14.600

```
ComboBox1.SelectedIndex= ComboBox1.FindString("Matching String"); 
```

在 windows 窗体中试试这个。

* * *

## 回答 #6

> 赞同：12
> 
> 时间：2010-07-09T09:07:07.997

对我来说，这只有效：

```
foreach (ComboBoxItem cbi in someComboBox.Items)
{
    if (cbi.Content as String == "sometextIntheComboBox")
    {
        someComboBox.SelectedItem = cbi;
        break;
    }
} 
```

MOD：如果您在组合框中设置了自己的对象作为项目，则将 ComboBoxItem 替换为其中之一，例如：

```
foreach (Debitor d in debitorCombo.Items)
{
    if (d.Name == "Chuck Norris")
    {
        debitorCombo.SelectedItem = d;
        break;
    }
} 
```

* * *

## 回答 #7

> 赞同：9
> 
> 时间：2009-01-16T22:59:25.553

SelectedText 是在字符串编辑器中获取或设置组合框中所选项目的实际文本，如此处[所述](http://msdn.microsoft.com/en-us/library/system.windows.forms.combobox.selectedtext.aspx)。如果您设置，这将无法编辑：

```
comboBox1.DropDownStyle = System.Windows.Forms.ComboBoxStyle.DropDownList; 
```

利用：

```
comboBox1.SelectedItem = "test1"; 
```

或者：

```
comboBox1.SelectedIndex = comboBox1.Items.IndexOf("test1"); 
```

* * *

## 回答 #8

> 赞同：9
> 
> 时间：2014-06-12T10:21:21.423

我使用了扩展方法：

```
public static void SelectItemByValue(this ComboBox cbo, string value)
{
    for(int i=0; i < cbo.Items.Count; i++)
    {
        var prop = cbo.Items[i].GetType().GetProperty(cbo.ValueMember);
        if (prop!=null && prop.GetValue(cbo.Items[i], null).ToString() == value)
        {
             cbo.SelectedIndex = i;
             break;
        }
    } 
} 
```

然后只需使用该方法：

```
ddl.SelectItemByValue(value); 
```

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2011-04-21T10:56:56.297

```
comboBox1.SelectedItem.Text = "test1"; 
```

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2011-05-05T11:17:40.017

我已经用从数据库填充的 een DataTable 填充了我的 ComboBox。然后我设置了 DisplayMember 和 ValueMember。我使用此代码来设置所选项目。

```
foreach (DataRowView Row in ComboBox1.Items)
{
    if (Row["ColumnName"].ToString() == "Value") ComboBox1.SelectedItem = Row;
} 
```

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2011-08-01T15:38:27.233

该解决方案基于[MSDN](http://en.wikipedia.org/wiki/Microsoft_Developer_Network)，并进行了一些修改。

*   它找到字符串的确切或**部分并设置它。**

    ```
    private int lastMatch = 0;
    private void textBoxSearch_TextChanged(object sender, EventArgs e)
    {
        // Set our intial index variable to -1.
        int x = 0;
        string match = textBoxSearch.Text;
        // If the search string is empty set to begining of textBox
        if (textBoxSearch.Text.Length != 0)
        {
            bool found = true;
            while (found)
            {
                if (comboBoxSelect.Items.Count == x)
                {
                    comboBoxSelect.SelectedIndex = lastMatch;
                    found = false;
                }
                else
                {
                    comboBoxSelect.SelectedIndex = x;
                    match = comboBoxSelect.SelectedValue.ToString();
                    if (match.Contains(textBoxSearch.Text))
                    {
                        lastMatch = x;
                        found = false;
                    }
                    x++;
                }
            }
        }
        else
            comboBoxSelect.SelectedIndex = 0;
    } 
    ```

我希望我有所帮助！

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2009-01-16T10:59:11.143

假设 test1、test2、test3 属于 comboBox1 集合以下语句将起作用。

```
comboBox1.SelectedIndex = 0; 
```

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2009-01-16T10:53:47.813

*   枚举组合框中的 ListItems
*   获取相等的 listindex 设置组合框
*   将 listindex 设置为找到的。

但是如果我作为代码审阅者看到这样的代码，我会建议重新考虑所有方法算法。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2009-01-16T10:56:15.970

您在组合框中没有该属性。您有 SelectedItem 或 SelectedIndex。如果您有用于填充组合框的对象，则可以使用 SelectedItem。

如果没有，您可以获取项目集合（属性项目）并对其进行迭代，直到您获得所需的值并将其与其他属性一起使用。

希望能帮助到你。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2009-01-16T11:01:37.470

```
_cmbTemplates.SelectedText = "test1" 
```

或者可能

```
_cmbTemplates.SelectedItem= _cmbTemplates.Items.Equals("test1"); 
```

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2019-05-22T09:34:39.717

在组合框（包含 MyObject 列表）中找到 mySecondObject（MyObject 类型）并选择该项目：

```
foreach (MyObject item in comboBox.Items)
{
   if (item.NameOrID == mySecondObject.NameOrID)
    {
        comboBox.SelectedItem = item;
        break;
    }
} 
```

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2015-12-07T07:46:40.683

我使用**KeyValuePair** 进行 ComboBox 数据绑定，我想按**值**查找项目，所以这在我的情况下有效：

```
comboBox.SelectedItem = comboBox.Items.Cast<KeyValuePair<string,string>>().First(item=> item.Value == "value to match"); 
```

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2011-11-01T22:41:02.590

```
combo.Items.FindByValue("1").Selected = true; 
```

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2011-08-03T11:52:16.367

```
 ListItem li = DropDownList.Items.FindByValue("13001");
  DropDownList.SelectedIndex = ddlCostCenter.Items.IndexOf(li); 
```

对于您的情况，您可以使用

```
DropDownList.Items.FindByText("Text"); 
```

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2016-04-02T08:31:16.127

在 ComboBox 有父项之前，所有设置 ComboBox 项的方法、技巧和代码行都将不起作用。

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2022-02-13T16:11:47.397

如果您通过数据集绑定数据源，那么您应该使用“SelectedValue”

```
cmbCategoryList.SelectedValue = (int)dsLookUp.Tables[0].Select("WHERE PRODUCTCATEGORYID = 1")[0]["ID"]; 
```

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2021-07-22T13:42:32.760

我知道这不是 OP 所要求的，但可能是他们不知道吗？这里已经有几个答案，所以即使这很长，我认为它可能对社区有用。

使用枚举填充组合框允许轻松使用 SelectedItem 方法以编程方式选择组合框中的项目以及从组合框中加载和读取。

```
public enum Tests
    {
        Test1,
        Test2,
        Test3,
        None
    }

// Fill up combobox with all the items in the Tests enum
    foreach (var test in Enum.GetNames(typeof(Tests)))
    {
        cmbTests.Items.Add(test);
    }

    // Select combobox item programmatically
    cmbTests.SelectedItem = Tests.None.ToString(); 
```

如果您双击组合框，您可以处理选定的索引更改事件：

```
private void cmbTests_SelectedIndexChanged(object sender, EventArgs e)
{
    if (!Enum.TryParse(cmbTests.Text, out Tests theTest))
    {
        MessageBox.Show($"Unable to convert {cmbTests.Text} to a valid member of the Tests enum");
        return;
    }

    switch (theTest)
    {
        case Tests.Test1:
            MessageBox.Show("Running Test 1");
            break;

        case Tests.Test2:
            MessageBox.Show("Running Test 2");
            break;

        case Tests.Test3:
            MessageBox.Show("Running Test 3");
            break;

        case Tests.None:

            // Do nothing

            break;

        default:
            MessageBox.Show($"No support for test {theTest}.  Please add");
            return;
    }
} 
```

然后，您可以从按钮单击处理程序事件运行测试：

```
 private void btnRunTest1_Click(object sender, EventArgs e)
    {
        cmbTests.SelectedItem = Tests.Test1.ToString();
    } 
```

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2016-12-28T18:41:50.543

我创建了一个函数，它将返回值的索引

```
 public static int SelectByValue(ComboBox comboBox, string value)
        {
            int i = 0;
            for (i = 0; i <= comboBox.Items.Count - 1; i++)
            {
                DataRowView cb;
                cb = (DataRowView)comboBox.Items[i];
                if (cb.Row.ItemArray[0].ToString() == value)// Change the 0 index if your want to Select by Text as 1 Index
                {
                    return i;
                }
            }
            return -1;
        } 
```

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2017-11-16T09:09:01.190

这对我有用.....

```
comboBox.DataSource.To<DataTable>().Select(" valueMember = '" + valueToBeSelected + "'")[0]["DislplayMember"]; 
```

* * *

## 回答 #25

> 赞同：-1
> 
> 时间：2017-06-13T06:22:10.057

你可以说`comboBox1.Text = comboBox1.Items[0].ToString();`

* * *

## 回答 #26

> 赞同：-2
> 
> 时间：2011-01-07T09:12:55.913

请尝试这种方式，它对我有用：

```
Combobox1.items[Combobox1.selectedIndex] = "replaced text"; 
```

* * *

## 回答 #27

> 赞同：-3
> 
> 时间：2016-02-21T16:53:12.797

它应该工作

```
Yourcomboboxname.setselecteditem("yourstring"); 
```

如果你想设置数据库字符串使用这个

```
Comboboxname.setselecteditem(ps.get string("databasestring")); 
```

# java - 检测哪个显示器显示窗口

> ID：450069
> 
> 赞同：3
> 
> 时间：2009-01-16T10:56:08.810
> 
> 标签：java, windows, jframe, toolkit, multiple-monitors

我确实有可以包含不同组件的主应用程序 JFrame 窗口。当用户选择可编辑的文本字段时，我会打开一个自行实现的 OnScreenKeyboard。OSK 也是一个 JFrame 窗口。

当用户将主窗口拖到另一个监视器上时，OSK 也应该显示在同一监视器上。为此，我必须检测显示主要 JFrame 的监视器。

我试图找到一种方法

```
Toolkit.getDefaultToolkit() 
```

但无法找到一些东西。

你知道我如何检测显示 JFrame 的监视器吗？

Java 版本 1.4 Windows XP

谢谢

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-16T14:15:09.637

回答，如果所有可用显示器的解决方案都相同。

对于**AWT**：

每个控件都有 getMonitor() 方法，从中可以计算屏幕位置，如下所示：

```
Monitor widgetMonitor = mTextWidget.getMonitor();
Rectangle monitorRect = widgetMonitor.getBounds();

if(monitorRect.x < 0){
   // shown in left monitor, starting from the main monitor
}

if(monitorRect.x > monitorRect.width){
   // shown in right monitor, starting from the main monitor
} 
```

对于**SWT**：

这只是我原始代码的一个片段。您应该询问返回值是否不为 null 以及类似的东西！

```
 int monitorWidth = 0;
    GraphicsEnvironment ge = GraphicsEnvironment.getLocalGraphicsEnvironment();
    GraphicsDevice[] screenDevices = ge.getScreenDevices();
    if(screenDevices.length > 0){
        monitorWidth = screenDevices[0].getDisplayMode().getWidth();
    }

    Point ownerLocationOnScreen = owner.getLocationOnScreen();

    int screenMovingX = 0;
    if(ownerLocationOnScreen.x < 0){
        screenMovingX = -monitorWidth;
    }
    if(ownerLocationOnScreen.x > monitorWidth){
        screenMovingX = monitorWidth;
    } 
```

# assembly - 如何计算汇编代码的位数？

> ID：450083
> 
> 赞同：3
> 
> 时间：2009-01-16T11:02:14.723
> 
> 标签：assembly

假设我有一个用汇编语言编写的程序，它接受用户输入的句子（数字和字母的组合），下一行将显示句子中小写字母的数量。同时显示句子中的位数。

我的问题是：我怎样才能使计数指令来计算数字和字母？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-16T11:09:20.403

我假设您的意思是 x86 程序集，并且字符串以空值结尾。

```
mov eax, STRING_VARIABLE
xor ebx, ebx
xor ecx, ecx
.loop:
  mov dl, [eax]
  cmp dl, 0
  jz .end

  cmp dl, '0'
  jb .notdigit
  cmp dl, '9'
  ja .notdigit
  inc ecx
  jmp .notlowercase
  .notdigit:
  cmp dl, 'a'
  jb .notlowercase
  cmp dl, 'z'
  ja .notlowercase
  inc ecx
  .notlowercase:

  inc eax
  jmp .loop
.end:
; ebx contains the lowercase letter count
; ecx contains the digit count 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-23T02:50:40.070

我认为 Mehrdad 对要完成的工作有大致的了解。

不过，只是一些观察——

*在“ inc ecx* ”之后跳转到 .notlowercase可以节省几个周期，这可能是一个疏忽——

我认为最后一个*inc ecx*应该是*inc ebx*

*考虑到这只是*字母/数字字符，对上/下测试略有扭曲，在 .notdigit 标签之后，可以将小写测试替换为

```
.notdigit:
    and   dl, 0x20
    jz   .notlowercase
    inc   ebx
.notlowercase: 
```

只是我的 2 美分——:)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-23T03:13:10.693

这也会为 Unicode 字符串提供不正确的结果。给定 UTF-16，您需要将 eax 增加 2。如果您需要使用高字节集计算字符，您也需要考虑这一点。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-16T11:33:13.057

如果它是一个以字符串长度作为第一个字节的 Pascal 字符串，您将修改如下；

```
mov eax, STRING_VARIABLE
xor ebx, ebx  ; A tiny bit quicker and shorter than mov ebx,0
xor ecx, ecx
mov dh,[eax]  ; dh is loop counter based on string length
inc eax       ; move onto the string data
.loop:
  cmp dh,0
  jz .end
  .
  .
  .
.notlowercase:
  dec dh
  jmp .loop
.end: 
```

# wcf - WCF 安全模型的概念概述？

> ID：450089
> 
> 赞同：3
> 
> 时间：2009-01-16T11:05:13.440
> 
> 标签：wcf, security, authentication, authorization, api-key

我目前正在使用 WCF 并尝试实现基于 API 密钥和签名的自定义安全模型（类似于 Facebook/Flickr/OAuth 等的工作方式）。

有一些类，如 ServiceAuthorizationManager、SecurityToken、SecurityTokenValidator、IAuthorizationPolicy 等，但我似乎找不到任何关于这些如何协同工作或 WCF 概念安全模型的文档。

我真的在寻找详细说明这些类如何组合和协同工作的东西，这样我就可以了解在哪里提取凭据、在哪里验证它们是否正确、在哪里决定授予它们的访问级别等等。如果有一本关于这些东西的书我可以买，那就更好了，因为我发现的所有 WCF 书籍都完全跳过了所有这些东西。

那里有任何文件吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-17T18:06:12.960

看看 Juval Lowy 的优秀“Programming WCF Services”，第 2 版：

这是亚马逊页面的[链接。](https://rads.stackoverflow.com/amzn/click/com/0596521308)

第 10 章完全致力于安全性。

Microsoft 发布了 WCF 安全指南 - 免费（！）电子书。你可以在[这里](http://www.codeplex.com/WCFSecurityGuide)找到它。

这是一个可怕的大量信息涉水通过。祝你好运！

# sql-server - 如何解决 SQL Server - 基于参数的内联表值函数执行计划变化？

> ID：450091
> 
> 赞同：5
> 
> 时间：2009-01-16T11:05:24.953
> 
> 标签：sql-server, tsql, sql-execution-plan, user-defined-functions

情况如下：
我有一个带有 datetime 参数的表值函数，例如 tdf(p_date)，它过滤大约 200 万行，选择列 date 小于 p_date 的行，并计算其他列的一些聚合值。
它工作得很好，但如果 p_date 是一个自定义标量值函数（在我的例子中返回一天结束），执行计划就会改变，查询从 1 秒到 1 分钟执行时间。

概念证明表 - 1K 产品，2M 行：

```
CREATE TABLE [dbo].[POC](
    [Date] [datetime] NOT NULL,
    [idProduct] [int] NOT NULL,
    [Quantity] [int] NOT NULL
) ON [PRIMARY] 
```

内联表值函数：

```
CREATE FUNCTION tdf (@p_date datetime)
RETURNS TABLE 
AS
RETURN 
(
    SELECT idProduct, SUM(Quantity) AS TotalQuantity,
         max(Date) as LastDate
    FROM POC
    WHERE (Date < @p_date)
    GROUP BY idProduct
) 
```

标量值函数：

```
CREATE FUNCTION [dbo].[EndOfDay] (@date datetime)
RETURNS datetime
AS
BEGIN
    DECLARE @res datetime
    SET @res=dateadd(second, -1,
         dateadd(day, 1, 
             dateadd(ms, -datepart(ms, @date),
                 dateadd(ss, -datepart(ss, @date),
                    dateadd(mi,- datepart(mi,@date),
                         dateadd(hh, -datepart(hh, @date), @date))))))
    RETURN @res
END 
```

查询 1 - 工作得很好

```
SELECT * FROM [dbo].[tdf] (getdate()) 
```

执行计划结束：Stream Aggregate Cost 13% <--- Clustered Index Scan Cost 86%

查询 2 - 不太好

```
SELECT * FROM [dbo].[tdf] (dbo.EndOfDay(getdate())) 
```

执行计划结束：Stream Aggregate Cost 4% <--- Filter Cost 12% <--- Clustered Index Scan Cost 86%

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-16T14:03:45.430

开销是您的标量函数。

这里的 TVF 像内联宏一样扩展，所以

```
SELECT * FROM [dbo].[tdf] (getdate()) 
```

变成

```
SELECT     idProduct, SUM(Quantity) AS TotalQuantity, max(Date) as LastDate
    FROM         POC
    WHERE     Date < getdate()
    GROUP BY idProduct 
```

当您使用日终标量函数时，SQL 无法将 EOD(GETDATE()) 评估为常量。抱歉，我无法快速找到关于 SQL 如何评估这些内容的文章。

我猜它正在为每一行进行评估，而不是你想要的预先评估。

我会单独计算 EOD 声明：

```
DECLARE @eod datetime;
SET @eod = dbo.EndOfDay(getdate());
SELECT * FROM [dbo].[tdf] (@eod) 
```

我也将它用于 EOD 功能：

```
DATEADD(second, -1, DATEADD(day, 1, (DATEDIFF(day, 0, @date)))) 
```

[编辑：我回答的其他问题](https://stackoverflow.com/questions/311026/does-query-plan-optimizer-works-well-with-joined-filtered-table-valued-functions)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-07-08T18:41:56.450

您也可以将 EndOfDay 重写为内联 UDF，并使用嵌套的内联 UDF。例子：

[许多嵌套的内联 UDF 非常快](http://sqlblog.com/blogs/alexander_kuznetsov/archive/2009/06/18/many-nested-inline-udfs-are-very-fast.aspx)

[使用内联 UDF 计算每月的第三个星期三](http://sqlblog.com/blogs/alexander_kuznetsov/archive/2009/06/21/calculating-third-wednesday-of-the-month-with-inline-udfs.aspx)

# javascript - 隐藏元素

> ID：450093
> 
> 赞同：0
> 
> 时间：2009-01-16T11:06:18.570
> 
> 标签：javascript, jquery, dom

提到[我之前的问题](https://stackoverflow.com/questions/444927/logic-behind-hiding-elements)，我遇到了另一个问题。我显示的 div 包含其中的链接。当我单击它们时，div 会按预期消失，但不是按预期消失..（我们希望它在我们单击页面上的任何位置时消失......但其中的链接）

当前使用的代码：

```
 $.listen('click', '.tabImg', function(event) {
                var el = $('#tabs_menu');
                var dv = $('.tabImg').parent();

                var pos = dv.offset();

                $(el).show();
                $(el).css( {"position": "absolute", "left": (pos.left) + "px", "top":20 + pos.top + "px" } );

                $(document).one('click', function()
                { 
                    $(el).slideUp().hide()
                });
                event.stopPropagation();
    }); 
```

tabs_menu 是我正在显示的 div，其中包含链接...

解决方法是什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-16T11:27:03.177

您需要将链接绑定到单击事件并停止冒泡，以便文档不会收到冒泡的点击。

我认为避免绑定多个点击事件的更好方法是监听在文档点击中被点击的锚点。

所以基本上如果触发点击事件的元素是一个锚点不要向上滑动

```
$(document).one('click', function(ev) { 
    if ( !$(ev.target).is('a') ){
        $(el).slideUp().hide()
    }
}); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-16T11:22:39.723

您必须将自己的事件侦听器添加到链接并`event.stopPropagation()`在里面调用。

# c# - 调试 asp.net 应用程序时在 Visual Studio 中查看会话

> ID：450103
> 
> 赞同：1
> 
> 时间：2009-01-16T11:14:58.520
> 
> 标签：c#, asp.net, visual-studio, session

有没有办法在调试 asp.net 应用程序时查看 Visual Studio 中正在进行的会话？

如果有，你能以某种方式终止会话吗？

我需要这个原因，我需要检查当会话确实已经终止并且用户尝试执行需要特定会话的操作时发生的问题以及如何解决这些问题。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-16T11:34:40.040

我想我找到了一种查看它及其内容的方法。在单步执行代码时，在使用我需要检查的会话时跨行，您可以在“自动”窗口中看到它及其内容。（调试-> Windows-> 自动）。

虽然不能杀。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-16T11:23:32.077

在您的页面指令中放置 Trace = "True" 会解决您的问题吗？或者您是在问 VS 是否有内置工具来管理会话？如果是这样，据我所知没有

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-16T11:38:36.773

啊! 在 Autos 窗口中，我可以将会话值编辑为 null，并获得我想要的结果。

# windows - 使用 make 调用批处理文件并使更改持久化

> ID：450105
> 
> 赞同：3
> 
> 时间：2009-01-16T11:16:23.603
> 
> 标签：windows, batch-file, makefile

我正在使用 makefiles (GNU Make) 在命令行上使用 Visual C++ Express 进行编程。为此，我必须调用 Visual Studio 批处理文件*vsvars32.bat*来设置环境。每次我在使用 make 之前打开一个新的 cmd.exe 时都必须这样做。当我尝试从我的makefile调用批处理文件时，它显然将批处理文件作为自己的进程执行，因为之后的环境是相同的。

所以我的问题是：有没有办法像Linux/Unix bash的内置*源命令一样在 cmd.exe 中执行脚本？*当然，除了在 Windows 上安装 bash。

**发布我自己的答案后编辑：**

上面的问题不太对，应该是这样的：

是否可以从生成文件中调用更改环境的批处理文件，以便更改的环境对于生成文件中调用的其他程序仍然存在？

原问题的答案是肯定的：可以使用cmd.exe的内置*调用*命令。但是由于*call*是一个内置命令而不是一个真正的程序，它在 makefile 中不起作用，只有当你从另一个批处理文件中调用一个批处理文件时。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-16T15:17:41.693

Answer compiled from the previous answers:

I made a batch file called make.bat which contains the following:

> call "%VS90COMNTOOLS%vsvars32.bat"
> call make.exe %*

This does the job. But calling an environment-changing batch file from within a makefile, so that the changed environment persists for the other programs called in the makefile, seems to be impossible.

**Edit:** After overflowing my PATH variable by repeatedly calling vsvars32.bat, I made the following changes:

> if not "%VISUALCVARS%" == "TRUE" (
> set VISUALCVARS=TRUE
> call "%VS90COMNTOOLS%vsvars32.bat"
> )
> call make.exe %*

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-16T11:39:06.677

使用“呼叫”：

```
@echo off
pushd.
call "C:\Program Files\Microsoft Visual Studio 8\Common7\Tools\vsvars3235.bat"
msbuild LinqSupportClassesSDKBuild.csproj /t:rebuild /p:Configuration=Release /nologo /v:q /clp:ErrorsOnly;
popd 
```

这是我们用来构建 linq 提供程序的 cmd 文件。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-16T12:36:18.603

至少在我安装的 Visual Studio（尽管有点古老的 VS .NET 2003）中，VS 开始菜单组中的链接之一是打开一个已经设置好环境的 cmd.exe 实例。您可能会发现这些很有帮助：

*   [如何将 Visual Studio 命令提示符 (VSCP) 作为工具添加到 IDE？](http://www.codeproject.com/KB/dotnet/VSCPinYourIDE.aspx)
*   [Running the command prompt from visual studio tools menu](http://www.c-sharpcorner.com/UploadFile/rmcochran/CommandPromptInStudioToolsMenu01152008103357AM/CommandPromptInStudioToolsMenu.aspx)
*   [Shortcut: Launch Visual Studio Command Prompt from Visual Studio](http://dnchannel.blogspot.com/2007/08/shortcut-launch-visual-studio-command.html)

They are more geared toward launching the command prompt from the IDE, but they do include information on launching it with the appropriate environment as well which you may find helpful for your purposes.

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-16T12:53:31.547

How do you launch your console? If you are just launching 'cmd' then instead, create a shortcut that executes (%comspec% resolves to c:\windows\cmd.exe or whatever is relevent on your system)

```
%comspec% /k ""C:\Program Files\Microsoft Visual Studio 8\VC\vcvarsall.bat"" x86 
```

Obviously, change the path to point to the proper installation folder. More generally, as the above poster pointed out, if a .cmd file needs to process another .cmd file rather than launch it as a seperate process, use the 'call' batch command.

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-16T14:11:15.510

Wrap GNU make in a script (mmake.bat). Put the script in the path somewhere.

The script itself should run the vsvars32.bat and then make, like this

```
vsvars32.bat
make %* 
```

As far as I remember, invoking a script from another script like this is done within the same shell (similar to Bash "." command).

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-06-23T17:52:37.943

I have found three solutions to this problem:

1) If the environment variables being set by the batch file are static (that is, they are always the same values), set those values for your entire user profile. Right-click on My Computer, click Properties-->Advanced-->Environment Variables. Add the variables from the batch file to the User Variables or System Variables section (User variables are only visible by you, System variables are visible by all users of that computer).

2) Write a wrapper batch file that calls the environment setup script then calls the Makefile.

3) Instead of using the SET command to set environment variables in the batch file, use the SETX command (requires the Windows Resource Kit). SETX is similar to SET, except it makes its changes to the master environment in the registry and will take effect in all command prompts launched in the future (but not the current one).

# c - 查明管道的读取端当前是否阻塞

> ID：450106
> 
> 赞同：1
> 
> 时间：2009-01-16T11:16:36.147
> 
> 标签：c, unix, posix, pipe

我试图找出子进程是否正在等待用户输入（不解析其输出）。是否有可能在 Unix 上的 C 中确定管道的读取端当前是否有 read() 调用阻塞？

问题是，我无法控制子进程中执行的程序。他们打印出我通常希望重定向到 /dev/null 的各种冗长的垃圾。偶尔会提示用户一些东西。（提示没有可靠的格式。）所以我的想法是：

*   在一个循环中：
    *   排空孩子的标准输出，将其附加到临时缓冲区。
    *   检查（不知道如何）孩子是否要求用户输入，在这种情况下，缓冲区将打印到标准输出。
*   当孩子退出时，扔掉缓冲区。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-16T18:37:47.157

问题是，我无法控制子进程中执行的程序。他们打印出我通常希望重定向到 /dev/null 的各种冗长的垃圾。偶尔会提示用户一些东西。（提示没有可靠的格式。）所以我的想法是：

*   在一个循环中：
    *   排空孩子的标准输出，将其附加到临时缓冲区。
    *   检查（不知道如何）孩子是否要求用户输入，在这种情况下，缓冲区将打印到标准输出。
*   当孩子退出时，扔掉缓冲区。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-20T14:14:37.787

这听起来好像您正在尝试监督 dpkg，有时某些安装后脚本会询问管理员它是否会覆盖某些配置文件。

无论如何，您可能想看看 strace 是如何工作的：

```
strace -f -etrace=read your.program 
```

当然，您需要跟踪哪些 fd 是您编写的管道，但无论如何您可能只需要标准输入。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-18T16:26:17.523

您有以下选择：

*   如果您知道孩子需要某些输入（例如将读取命令的 shell），只需写入管道
*   如果您假设孩子通常不会阅读任何内容，但有时可能会这样做，您可能需要在 shell 中进行作业控制（使用终端与孩子进行通信，使用终端上的进程组和 TIOCSPGRP ioctl 来获取孩子到后台；当孩子试图从终端读取时，它会得到 SIGTTIN，你可以等待（））。这就是 bash 处理诸如“ `(sleep 10; read a;)&`”之类的事情的方式
*   如果你不知道要写什么，或者你有更多的可能性，你将不得不解析输出

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-16T12:51:30.677

您通常只需写入管道，或使用 select 或 poll。如果您需要握手机制，您可以通过各种方式在带外执行此操作，或者提出带内协议。

我不知道是否有内置方法可以知道另一端的阅读器是否阻塞。为什么你需要知道这个？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-16T11:22:59.957

我不认为这是真的：例如，*就在*读取器端调用 read() 之前，管道会有一个实际上没有读取的读取器。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-01-16T11:19:08.810

如果我没记错的话，你不能有一个没有阅读器的管道，这意味着你一直有一个 read(2) 或一个 select(2) 系统挂起。

# c++ - 为什么编译 VCC .sln 在没有标准输出的情况下在后台运行？

> ID：450107
> 
> 赞同：3
> 
> 时间：2009-01-16T11:17:33.460
> 
> 标签：c++, windows, visual-studio, compiler-construction, mvcc

我正在尝试从命令行编译一个项目，如下所示：

```
devenv.exe myproj.sln /build release 
```

看起来代码编译得很好，但这并不是我所需要的：

我希望能够在编译器发生时捕获输出（例如警告、错误）。不幸的是，一旦我发出上述命令，我就会返回到命令提示符。

当我查看 process-explorer 或 taskmgr.exe 时，我可以看到 devenv.exe 进程（和其他一些子进程）正在运行。如果我查看输出文件夹，我可以看到我的所有文件逐渐出现。

有没有办法让 VCC 工作起来更像 GCC - 当我发出构建命令或使用 Makefile 制作项目时，我会收到一条消息流并且控制台会阻塞，直到该过程完成。

更新：谢谢，两个出色的解决方案。我可以确认它有效。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-01-16T11:24:56.160

devenv 使用这个有趣的调度程序在命令行模式和窗口模式之间切换。除了 devenv.exe 之外，实际上还有一个 devenv.com，因为 *.com 优先于 *.exe，所以它首先被调用。devenv.com 分析命令行并决定调用什么。

换句话说，将您的命令行更改为：

```
devenv myproj.sln /build release 
```

你应该没事。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-01-16T11:23:54.727

使用 devenv.com 代替 devenv.exe，你会得到你想要的。

您也可以使用 MSBuild.exe 获得更多选项。

# regex - 从 img 标签中提取 src 属性的正则表达式

> ID：450108
> 
> 赞同：18
> 
> 时间：2009-01-16T11:17:41.090
> 
> 标签：regex

我正在尝试编写一个模式来提取在 HTML 中的 img 标记中找到的文件的路径。

```
String string = "<img src=\"file:/C:/Documents and Settings/elundqvist/My Documents/My Pictures/import dialog step 1.JPG\" border=\"0\" />"; 
```

我的模式：

```
src\\s*=\\s*\"(.+)\" 
```

问题是我的模式还将包括 img 标签的 'border="0" 部分。

什么模式会匹配这个文件的 URI 路径而不包括 'border="0"？

* * *

## 回答 #1

> 赞同：41
> 
> 时间：2009-01-16T11:22:19.583

您的模式应该是（未转义）：

```
src\s*=\s*"(.+?)" 
```

重要的部分是尽可能少地匹配组的添加问号

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2014-02-21T23:46:37.340

只有当它在标签内而不是在其他任何地方作为纯文本写入时，这个才会抓取 src。它还会检查您是否在 src 属性之前或之后添加了其他属性。

此外，它还确定您使用的是单引号 (') 还是双引号 (")。

```
\<img.+src\=(?:\"|\')(.+?)(?:\"|\')(?:.+?)\> 
```

所以对于 PHP，你会这样做：

```
preg_match("/\<img.+src\=(?:\"|\')(.+?)(?:\"|\')(?:.+?)\>/", $string, $matches);
echo "$matches[1]"; 
```

对于 JavaScript，你会这样做：

```
var match = text.match(/\<img.+src\=(?:\"|\')(.+?)(?:\"|\')(?:.+?)\>/)
alert(match[1]); 
```

希望这会有所帮助。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-01-16T11:19:59.867

试试这个表达式：

```
src\s*=\s*"([^"]+)" 
```

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2019-07-26T15:48:24.820

我通过使用这个正则表达式解决了它。

```
/<img.*?src="(.*?)"/g 
```

在[https://regex101.com/r/aVBUOo/1中验证](https://regex101.com/r/aVBUOo/1)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-16T11:22:35.073

您想玩贪婪的集体捕获形式。就像是

`src\\s*=\\s*\"(.+)?\"`

默认情况下，正则表达式将尝试尽可能多地匹配

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-16T12:37:37.880

> 我正在尝试编写一个模式来提取在 HTML 中的 img 标记中找到的文件的路径。

我们可以有一个“不要使用正则表达式解析 [X]HTML”的自动回复器吗？

> 问题是我的模式还将包括 img 标签的 'border="0" 部分。

更不用说任何时候 'src="' 出现在纯文本中！

如果您事先知道要解析的 HTML 的确切格式（例如，因为您自己生成了它），您就可以摆脱它。但除此之外，正则表达式对于这项工作来说是完全错误的工具。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2016-03-04T12:59:34.410

我想扩展这个主题，因为通常该`src`属性是不带引号的，因此采用带引号和不带引号的`src`属性的正则表达式是：
`src\s*=\s*"?(.+?)["|\s]`

# c# - 如何使用用户的默认电子邮件客户端弹出撰写/创建邮件对话框？

> ID：450115
> 
> 赞同：6
> 
> 时间：2009-01-16T11:21:05.107
> 
> 标签：c#, email

用例很简单。在某个时间点，我需要能够向用户展示他熟悉的撰写电子邮件对话框（Outlook 或其他）

*   从、到、主题等字段已经填充了某些应用程序确定的值。
*   该电子邮件还将附带一个附件。

除非用户明确同意，否则不应发送邮件。

我在以前的 VB6 时代做过一次……现在不知道怎么做……我只记得这很容易。

托管应用程序、C#、.net 3.0+

**更新#1**：是的，好像 mailto 删除了对附件的支持（作为安全风险？）。我试过了

您需要包括[此处所述](http://pinvoke.net/default.aspx/shell32/ShellExecute.html)的 ShellExecute 签名。我从中得到的只是一个 5`SE_ERR_ACCESSDENIED`和一个 2 只是为了一些品种

```
string sMailToLink = @"mailto:some.address@gmail.com?subject=Hey&body= yeah yeah yeah";
IntPtr result = ShellExecute(IntPtr.Zero, "open", sMailToLink, "", "", ShowCommands.SW_SHOWNORMAL);
Debug.Assert(result.ToInt32() > 32, "Shell Execute failed with return code " + result.ToInt32()); 
```

相同的 MailtoLink 与 Process.Start... 完美配合，但*只要您不提及附件*。

```
System.Diagnostics.Process.Start(sMailToLink); 
```

其他选项是使用 Outlook 对象模型来执行此操作。但有人告诉我，这需要您根据安装的 Outlook 的确切版本添加程序集引用。如果用户不喜欢 MS 用于电子邮件，这也会爆炸。

下一个选项是 Mapi 和[Mapi33](http://g8.cx/mapi/) .. 状态仍在进行中。耳朵仍然愿意接受建议。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-01-16T11:29:35.823

您可以创建一个流程对象并让它调用“mailto:user@example.com?subject=My+New+Subject”。这将导致系统使用其默认处理程序对 mailto 进行操作，但是，您可以设置主题，这样就不会处理添加附件。我会坦率地承认，我不完全确定您将如何在不编写一些邮件插件的情况下强制发送附件。

流程代码为：

```
System.Diagnostics.Process.Start("mailto:user@example.com?subject=My+New+Subject"); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-16T11:27:09.790

我认为这可能**不是**最有效或最优雅的方式，但炮击“mailto：”链接会做你想做的事。

**编辑：**对不起，遗漏了一个非常重要的“不”。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-16T12:24:47.487

由于 mailto 不支持附件，并且托管代码中不支持 MAPI，因此最好的办法是编写（或让某人编写）一个小型非托管程序来调用可以使用命令行参数调用的 MAPI 函数。遗憾的是 .NET 没有更清洁的替代方案。

另请参阅：[MAPI 和托管代码体验？](https://stackoverflow.com/questions/4508/mapi-and-managed-code-experiences)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-16T13:13:33.597

**使用mailto: arguments**启动过程是最简单的方法。然而，它不允许任何或多或少复杂的事情。

稍有不同的方法涉及**创建电子邮件模板，然后将其提供给 Process.Start**：

```
var client = new SmtpClient();

var folder = new RandomTempFolder();
client.DeliveryMethod = 
  SmtpDeliveryMethod.SpecifiedPickupDirectory;

client.PickupDirectoryLocation = folder.FullName;

var message = new MailMessage("to@no.net",
  "from@no.net", "Subject","Hi and bye");

// add attachments here, if needed
// need this to open email in Edit mode in OE
message.Headers.Add("X-Unsent", "1");

client.Send(message);

var files = folder.GetFiles();

Process.Start(files[0].FullName); 
```

默认电子邮件处理程序的场景：

*   Outlook Express 打开
*   Windows：Outlook - 默认情况下不处理，而是调用 Outlook Express
*   窗户：蝙蝠！- 消息打开查看，按 Shift-F6 和 Enter 发送

我也用 Mono 进行了测试，它或多或少地工作了。

这篇文章中提供了更多详细信息：[信息集成 - 模板化电子邮件的最简单方法](http://rabdullin.com/journal/2008/6/18/information-integration-simplest-approach-for-templated-emai.html)

PS：最后我选择了稍微复杂一点的场景：

*   定义接口 IEmailIntegraton
*   上面的代码进入了 DefaultEmailIntegration
*   添加了 OutlookEmailIntegration（自动化）和 theBat 的实现！电子邮件集成（使用他们的模板格式）。
*   允许 SmartClient 的用户从下拉列表中选择他们的方案（或者，这可以实现为“检查系统的默认电子邮件处理程序并自动决定”）

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-16T11:29:00.753

会不会是你使用了 mailto: 协议？

您强调的几乎所有内容都可以完成，但我很确定，您不能做附件。

[Microsoft MailTo 文档](http://msdn.microsoft.com/en-us/library/aa767737(VS.85).aspx "Microsoft Mailto 文档")

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-16T12:42:41.240

当然，您假设他们将安装电子邮件客户端。

我过去采用的选项（在每个人都至少安装了一个 Outlook 版本的企业环境中）是使用 Outlook 互操作 - 您只需要引用您需要支持的最早版本。

您可以查看 P/Invoking [MAPISendDocuments](http://msdn.microsoft.com/en-us/library/system.net.mail.aspx)（我个人会尽量避免），或者另一种选择是创建您自己的“撰写”表单并使用 [System.Net.Mail](http://msdn.microsoft.com/en-us/library/dd296731(VS.85).aspx)命名空间中的对象。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2011-07-22T07:00:03.850

如果您打算使用 Outlook，您可以使用一个技巧[此代码基于 Outlook 2010[v14.0.0.]] 如果用户打开文件 (.msg)，则创建 Outlook MailItem 并传输文件（即下载） 撰写消息对话框打开自动地

这是代码...

```
 Microsoft.Office.Interop.Outlook.Application outapp = new Application();
    try
    {

        _NameSpace np = outapp.GetNamespace("MAPI");
        MailItem oMsg = (MailItem)outapp.CreateItem(OlItemType.olMailItem);
        oMsg.To = "a@b.com";
        oMsg.Subject = "Subject";

       //add detail

        oMsg.SaveAs("C:\\Doc.msg", OlSaveAsType.olMSGUnicode);//your path
        oMsg.Close(OlInspectorClose.olSave);
    }
    catch (System.Exception e)
    {
        status = false;
    }
    finally
    {
        outapp.Quit();
    } 
```

然后传输您创建的文件说“Doc.msg”

```
 string filename ="Doc.msg";//file name created previously
    path = "C:\\" + filename; //full path ; 
    Response.ContentType="application/outlook";
    Response.AppendHeader("Content-Disposition", "filename=\"" + filename + "\"");
    FileInfo fl = new FileInfo(path);
    Response.AddHeader("Content-Length", fl.Length.ToString());
    Response.TransmitFile(path,0,fl.Length);
    Response.End(); 
```

# wiki - 面向最终用户/客户的用户友好型 wiki

> ID：450124
> 
> 赞同：2
> 
> 时间：2009-01-16T11:23:54.213
> 
> 标签：wiki, user-friendly, end-user

目前我们的团队正在使用[MoinMoin](http://moinmo.in/)作为 IT 的 wiki，它非常棒。

我们希望向最终用户推广使用 wiki，因为他们中的一些人对此感兴趣。例如，在 wiki 上，我们将共享和编辑应用程序的要求。

我认为 MoinMoin 不是对用户更友好（但我喜欢使用它），这就是为什么我们正在为最终用户/客户寻找最好的用户友好 wiki

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-16T11:46:28.343

对你自己来说，MoinMoin 显然是用户友好的。=) 认真地考虑所有用户并尝试弄清楚您拥有什么样的使用模式。MoinMoin 是一个合理的选择，因为它是如此简单的程序。您通常可以通过向 MoinMoin 添加一两个功能来帮助您的非程序员用户。开发人员已经跟上它的步伐，并且您已经拥有了所有内容。

那就是说。今天，Mediawiki 被用于许多通用 wiki。包括维基百科。用户友好性的一个方面是识别。Mediawiki 可能会感觉更友好，因为用户更熟悉它的工作原理。Mediawiki 被广泛采用。许多您可能想要添加以帮助您的用户的额外功能已经被编写为扩展。Mediawiki 的扩展 API 非常好，因此您可以在需要时轻松自动化您自己的垂直领域。Mediawiki 具有相当丰富的功能，而不会完全过载。它有类别和模板，它们都可以方便地保持干燥并在各种过程中使用 wiki。它与 MoinMoin 共享许多语法，因为两者具有相同的祖先（语法方面）。

我可能会选择Mediawiki。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-26T14:31:25.903

访问[Wikimatrix.org](http://wikimatrix.org)以确定您需要哪些功能以及最适合您的工具。我经常提到[Foswiki.org](http://foswiki.org)是一个非常好的和用户友好的工具，但它确实取决于您需要的功能。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2013-08-14T14:53:48.640

我还没有看到任何比[Confluence](https://confluence.atlassian.com)对最终用户更友好的 Wiki 。

只是最重要的原因：

*   虽然其他 Wiki**说**他们有所见即所得的编辑器，但他们实际上所做的是在单击图标时用标记将选定的文本括起来。那不是所见即所得，那是代码注入！在 Confluence 5 中，所有的编辑都是通过可视化编辑器完成的（实际上你确实可以直接在编辑器中看到你得到的东西）。能够由超级用户添加宏（标记）。
*   在几乎所有其他 wiki 中，用户完全负责创建和维护链接层次结构。这意味着断开的链接和孤立的页面将成为常态。在 Confluence 中，所有页面都会自动添加到页面层次结构中并按名称排序。您可以通过文档主题启用树浏览器，即使没有手动添加链接也可以方便地浏览 wiki。最后，您可以通过拖放以任何顺序重新排列页面。

然而，对于超过 10 个用户，Confluence 的成本相当高。但如果你能负担得起，或者你不需要超过 10 个编辑器，那就值得了。如果启用匿名查看，则纯“读者”不计入用户。

# c++ - C++ 自定义 GUI 按钮问题

> ID：450136
> 
> 赞同：0
> 
> 时间：2009-01-16T11:28:38.463
> 
> 标签：c++, oop, button

我正在设计一个图形应用程序，我决定为其编写自己的菜单。我希望这个菜单独立于平台。目前，我的菜单主​​要由一些按钮组成。我的问题涉及单击按钮时的事件处理。我的困境是按钮“了解”它存在的上下文。在我看来，如果有一些更大的代码可以创建按钮并处理鼠标事件，则可能需要某种类型的 switch 语句。switch 语句必须根据所单击按钮的唯一定义来调用适当的操作。

我想避免这个 switch 语句。我的第一个想法是让每个按钮都维护一个函数指针，当它被单击时，它可以用来盲目地启动正确的操作。这将消除任何特定于按钮的代码。然而，按钮应该包含任何特定于上下文的信息（例如函数指针），这让我很困扰。我相当缺乏经验，我想知道这是否被认为是糟糕的设计。无论如何，我怎样才能以一种不需要某种类型的 switch 语句并被认为是好的 OOP 设计的方式来设计我的菜单？我想听听您的首选解决方案是什么。

提前致谢！

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-16T11:58:42.187

你看一下库：

[SPTK](http://www.sptk.net/index.php)（简单强大的工具包）是一个跨平台的工具包，它提供了一组 C++ 类，用于快速和轻松的应用程序开发。它提供使用 FLTK 的 GUI 组件，并具有与 GUI 组件无缝连接的数据库支持。

eGUI
[http://www.codeplex.com/egui](http://www.codeplex.com/egui)
[http://torjo.com/egui/](http://torjo.com/egui/)
[http://msdn.microsoft.com/en-us/magazine/cc534994.aspx](http://msdn.microsoft.com/en-us/magazine/cc534994.aspx)

[NovaTK](http://novatk.sourceforge.net)是一个面向对象的跨平台 GUI 工具包。NovaTK 的重点之一是促进需要更少代码行的跨平台应用程序的快速开发。事件系统基于强大的回调机制，使应用程序设计更简单、更易于阅读和合乎逻辑。

[Ecere Cross Platform GUI Applications](http://www.ecere.com) Develop applications once, deploy them on all platforms alongside a lightweight runtime environment.

Introduction to [wxWidgets](http://www.codeproject.com/KB/library/wxwidgets.aspx)

[ClassLib](http://www.codeproject.com/KB/library/classlib.aspx), A C++ class library

[libgm - A mini GUI library for Windows](http://code.google.com/p/libgm/)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-16T11:33:00.403

您可以查看 [命令模式](http://en.wikipedia.org/wiki/Command_pattern)。

您可以将命令与菜单项相关联，该命令将包含要执行的代码。

# dns - 夺回被“美国域名注册局”骗局夺回的域名控制权

> ID：450141
> 
> 赞同：2
> 
> 时间：2009-01-16T11:31:52.450
> 
> 标签：dns

我的一位客户最终被他们发送的“美国域名注册局”诈骗信所吸引，现在他们实际上已经失去了域名。我的客户名称仍然是注册人、管理员和技术联系人，但所有其他详细信息（地址、电话、电子邮件）均用于 DRoA。我预计我们将因此无法取回该域。除了等待域到期之外，任何人都有任何可能的解决方案？

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-16T11:38:24.370

我认为您的客户可能想与他的律师一起追究此事。DRoA 可能存在欺诈行为。毫无疑问，DRoA 已经把他们的骗局都弄清楚了，所以你的客户不太可能在不花一些钱的情况下拿回他的域名，但是一个好的合法的 nasty-gram 可能会让他们动摇一点。

# c# - 等效于 C# 中的 CType 以转换位于 Gridview 的 EditItemTemplate 中的 Dropdownlist

> ID：450142
> 
> 赞同：1
> 
> 时间：2009-01-16T11:32:03.727
> 
> 标签：c#, gridview, drop-down-menu

我正在使用 Gridview 来显示一些数据。在gridview 的EditItemTemplate 中，我将DropDownList 用于gridview 的列之一。gridview 的 DataSource 是一个表“UserEntries”。Dropdown的Datasource是另一个表“TypeEntries”。TypeEntries 的列是 - Guid 和 TypeName。Guid 是下拉列表的 DataValueField，TypeName 是 DataTextField。我将下拉菜单的 DataValueFiels 存储在 UserEntries 表中。

现在，当用户单击 gridview 的编辑按钮时，如何使用“TypeEntries”表填充下拉列表？我在用

```
 Dropdownlist tempddl = new Dropdownlist();
    tempddl = (Dropdownlist)gvUserData.FindControl("ddlTypeListInGrid");
    tempddl.DataSource = _section.GetTypeEntries();
    tempddl.DataBind(); 
```

但它不工作。谁能告诉我任何其他方式来完成这项任务？提前致谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-16T12:13:41.347

如果您收到“对象引用未设置为对象的实例”。在异常情况下，这意味着未找到“ddlTypeListInGrid”控件。因此，您不能将 NULL ( NOTHING ) 转换为目标类型。

您可以在错误页面的生命周期中执行此代码。在以后的 oage 事件之一（Load、LoadComplete 等）中尝试它，或者检查容器是否真的包含 ID 为“ddlTypeListInGrid”的控件。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-16T14:01:39.647

作为旁注（与您的问题无关，仅供参考）以下行：

```
 DropDownList tempddl = new DropDownList(); 
```

可能 ：

```
 DropDownList tempddl; 
```

您不需要创建 DropDownList 的新实例，因为在下一行，您尝试找到一个名为“ddlTypeListInGrid”的实例。然后，正如 Tcks 所说，如果 ddlTypeListInGrid 控件不存在，那么您可能会收到 NullReferenceException。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-16T11:43:03.890

C# 区分大小写，您应该`DropDownList`改用。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-16T12:06:03.360

您是否正在寻找 Convert.ChangeType，我必须查看更多代码才能解决您的问题。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-16T12:11:08.450

我正在上传整个函数代码。

```
protected void gvUserData_OnRowEditing(object sender, GridViewEditEventArgs  e)
{
    gvUserData.EditIndex = e.NewEditIndex;

    gvUserData.DataSource = _section.GetUserEntries();
    gvUserData.DataBind();

    DropDownList tempddl = new DropDownList();       //I am not sure whether this is correct or not..        
    tempddl = (DropDownList)gvUserData.FindControl("ddlTypeListInGrid");
    tempddl.DataSource = _section.GetTypeEntries();
    tempddl.DataBind();        

} 
```

# c# - 以编程方式使用不同的 WCF 配置配置单个 WCF 操作

> ID：450151
> 
> 赞同：0
> 
> 时间：2009-01-16T11:35:10.320
> 
> 标签：c#, .net, wcf, configuration

我刚刚开始使用 WCF，并想设置一个可分发的网络系统，如下所示：（但不确定是否可能。）

我有一个具有业务逻辑的 .net 客户端。它将需要来自各种来源的各种数据，所以我想添加一个“服务器”，它包含一个内存缓存以及 WCF 功能，用于从数据源发送/接收和发布/订阅未缓存的数据。我认为这些服务器应用程序应该有可能在代码方面相同，但高度可配置，以便可以根据需要以对等方式或传统客户端 - 服务器处理请求。我*认为*可以这样做，以便基本上服务器将请求发送到它配置了端点并获得响应的任何地方。

本质上，服务器将配置如下：

```
Server A
========

Operation 1 - Endpoint I
Operation 2 - Endpoint II

Server B
========

Operation 1 - Endpoint IV
Operation 2 - Endpoint III 
```

每个服务器的配置都存储在 app.config 中，并在启动时加载到内存中。因此，每个 WCF 操作都有自己的 WCF 配置（就端点等而言），它会根据该配置将特定的请求发送到不同的地方。

根据我对 WCF 的阅读，我认为这是可能的。我不知道有足够的经验来知道这是否是我正在描述的标准 WCF 模式（如果是，请告诉我）。否则，我的主要问题是，如何在 WCF 中以编程方式配置每个操作（如上）？

如果我没有清楚地解释自己，请告诉我。

在此先感谢您的帮助，威尔

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-17T19:21:45.897

我不知道这是否会为您提供您正在寻找的东西，但这是我用来将我的 WCF 端点添加到我的 Windows 服务的东西。这是服务运行以加载所有 wcf 服务的代码：

```
IDictionary<string, ServiceHost> hosts;
NetTcpBinding binding;
CustomBinding mexBinding;

private void AddService(Type serviceImp, Type serviceDef, string serviceName)
    {
        ServiceHost host = new ServiceHost(serviceImp);

        string address = String.Format(baseAddress, wcfPort, serviceName); 

        string endAdd = address;
        string mexAdd = address + "/mex";

        ServiceMetadataBehavior behavior = new ServiceMetadataBehavior();
        host.Description.Behaviors.Add(behavior);
        host.AddServiceEndpoint(serviceDef, binding, endAdd);
        host.AddServiceEndpoint(typeof(IMetadataExchange), mexBinding, mexAdd);

        host.Open();

        hosts.Add(serviceDef.Name, host);
    } 
```

`baseAddress`我没有复制一个字符串，但它只有端点的 net.tcp 地址。对于`wcfPort`. 不同的 baseAddress 和端口用于调试、测试和生产。

以防万一不清楚，`serviceImp`是服务实现，`serviceDef`是定义合同的接口。希望这可以帮助。

**编辑**- 以下是我用来帮助我弄清楚所有这些东西的一些参考资料：

[以编程方式创建 WCF 服务主机](http://geekswithblogs.net/hinshelm/archive/2007/05/30/Creating-WCF-Service-Host-Programmatically.aspx)
[Net.Tcp 端口共享示例，第 2 部分](http://blogs.msdn.com/drnick/archive/2006/08/08/690333.aspx)
[服务站：深入 WCF 寻址](http://msdn.microsoft.com/en-us/magazine/cc163412.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-18T00:26:00.930

据我所知，您不能在每个操作的基础上指定配置。最低层是接口层。最简单（丑陋）的解决方案是将每个操作放在单独的界面中。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-02-24T09:16:01.557

将每个操作放在单独的界面中是一种有效且良好的设计方法。Agatha 请求/响应层遵循这种方法。看看这个，这是非常有用和可扩展的

[http://code.google.com/p/agatha-rrsl/](http://code.google.com/p/agatha-rrsl/)

# compact-framework - 智能手机和按钮

> ID：450153
> 
> 赞同：-1
> 
> 时间：2009-01-16T11:37:04.403
> 
> 标签：compact-framework, button, touchscreen, smartphone

智能手机上的 .net compact 框架不知道按钮组件，我不知道原因。我的问题是：人们通常如何克服这个问题？我知道我附近的智能手机可以结账，只有一部pda手机，当然它有触摸屏并支持按钮组件。

你会怎么办 ？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-16T11:53:50.623

缺少按钮是故意的，因为它违反了微软针对智能手机平台的指导方针。相反，您应该使用菜单，这对于拇指操作的设备来说更快。它还有助于为所有手机应用程序提供通用界面。

如果您需要一个按钮，您可以轻松地创建一个自己的按钮。另见这个[问题](https://stackoverflow.com/questions/286286/windows-mobile-5-sdk-button-control#286408)。

# sql-server - 使用空值从搜索中查询数据库

> ID：450159
> 
> 赞同：1
> 
> 时间：2009-01-16T11:39:18.143
> 
> 标签：sql-server, tsql

我在 c# 中使用 asp .net 网络表单搜索，例如字段：-名称-水果

我想写一个可以搜索名字或水果的sproc。如果我知道两者都有值，我会将两个参数传递给 sproc 并编写：

```
Select * from myTable where name =@name and fruit = @fruit 
```

但是有时，名称或水果可能为空。无需编写单独搜索水果和名称。我将如何实现这一目标？

如果可能，我宁愿不创建动态查询，但如果这是唯一的方法，我将如何编写它？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-16T11:41:53.923

您需要确保空字符串不作为参数而不是 null 传递，但以下应该有效。不过，我很确定，如果用户不输入任何内容，表单值将为空。

```
 select * from myTable
 where (@name is null or name = @name) and (@fruit is null or fruit = @fruit) 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-16T11:45:00.873

也许：

```
SELECT * FROM myTable WHERE name Like '%' + @name AND fruit LIKE '%' + @fruit 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-16T11:49:56.090

```
select * from myTable 
where 
   (name = @name and fruit = @fruit)
   or (name = @name and @fruit is null)
   or (fruit = @fruit and @name = is null ) 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-16T12:46:38.487

```
select * from myTable where name = isnull(@name, name) and fruit = isnull(@fruit, fruit) 
```

如果@name 和@fruit 都为空，将返回整个表。如果这是一个问题，您最好在 SP 中添加一些额外的逻辑。

# asp.net - 如何在 ASP.Net 中实现字段级安全性？

> ID：450160
> 
> 赞同：5
> 
> 时间：2009-01-16T11:39:49.610
> 
> 标签：asp.net, security

我有一个包含 20 个字段的 .aspx 表单，必须根据用户角色和订单记录的状态禁用这些字段。目前该应用程序有 5 个角色和 3 个状态，因此我必须考虑 300 种不同的可能条件。

我的第一个想法是将每个排列存储在一个表中，然后在页面加载时通过遍历字段来设置字段。有没有更好的办法？请注意，我使用的是 .Net 2.0 而不是 MVC。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-16T14:04:16.427

我可能会存储每个字段的详细信息，然后是可以编辑它们的角色和状态，然后这样做。

系统的规则是什么？基本上，真的有 300 种可能的条件吗？还是真的某些字段只能针对某些状态进行编辑，然后只有某些角色才能编辑这些字段？还是某些字段也可用于某些角色？

如果更多的是前者，我可能会有这样的事情：

三个主表（如果您添加字段、角色或状态，则可以轻松扩展）：

*   字段
*   角色
*   地位

然后是两个链接表：

*   Field.Id 和 Role.Id
*   Field.Id 和 Status.Id

然后，对于任何给定的订单和用户，您可以找到哪些字段可针对订单的当前状态和用户角色进行编辑，并且在您处理字段时适当地设置访问权限 - 但是您设置控件 - 或者基于动态生成它们在您返回的集合上，或静态在页面上。

如果您遇到角色可以覆盖状态的问题，您还可以在字段/角色表中存储一个布尔值，指示无论状态如何，该字段是否都应该可用。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-16T16:19:19.430

与另一个响应者一样，我们也使用称为 CSLA 的业务对象框架。CSLA 通过要求类开发人员在属性 get/set 调用中进行安全检查来实现字段级安全检查。典型的属性实现如下所示：

```
Private mFirstName As String = ""
Public Property FirstName() As String
    <System.Runtime.CompilerServices.MethodImpl(Runtime.CompilerServices.MethodImplOptions.NoInlining)> _
    Get
        CanReadProperty("FirstName", True)
        Return mFirstName
    End Get
    <System.Runtime.CompilerServices.MethodImpl(Runtime.CompilerServices.MethodImplOptions.NoInlining)> _
    Set(ByVal value As String)
        CanWriteProperty("FirstName", True)
        If value Is Nothing Then value = ""
        If Not mFirstName.Equals(value) Then
            mFirstName = value
            PropertyHasChanged("FirstName")
        End If
    End Set
End Property 
```

`CanReadProperty`注意对和的调用`CanWriteProperty`。第二个参数指定如果用户无权执行特定的读/写操作，该方法应该抛出异常。

`CanReadProperty`和的实现`CanWriteProperty`由框架的基类提供，但在不采用整个 CSLA 框架的情况下应该是可重现的。实现检查一个`AuthorizationRules`数据结构，该结构根据角色定义允许/拒绝谁读/写访问。通常，该`AuthorizationRules`结构是在对象创建期间填充的。

向表示层公开相同`CanReadProperty`和`CanWriteProperty`方法允许您根据当前用户的访问权限启用/禁用 UI 元素。例如：

```
FirstNameTextBox.ReadOnly = Not CanWriteProperty("FirstName", false) 
```

希望这些信息将为您提供一个很好的起点来开发您自己的实现。如果您有兴趣了解有关 CSLA 的更多信息，请查看[Expert C# 2008 Business Objects](https://rads.stackoverflow.com/amzn/click/com/1430210192)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-16T14:43:05.710

我建议使用第三方框架来实现这一点。我们在项目中使用[CSLA](http://www.lhotka.net/cslanet/)框架。它允许我们在字段级别设置授权。

# java - Java/XSLT：找不到匹配的 1 参数函数

> ID：450165
> 
> 赞同：7
> 
> 时间：2009-01-16T11:42:18.883
> 
> 标签：java, jsp, xslt, tomcat, xalan

我收到以下错误：

```
javax.servlet.ServletException: Cannot find a matching 1-argument function named {http://exslt.org/dynamic}evaluate()
at org.apache.jasper.runtime.PageContextImpl.doHandlePageException(PageContextImpl.java:841)
at org.apache.jasper.runtime.PageContextImpl.handlePageException(PageContextImpl.java:774) 
```

我的 xslt 文件的顶部是

```
<?xml version="1.0" encoding="UTF-8"?>
<xsl:stylesheet 
    xmlns:xsl="http://www.w3.org/1999/XSL/Transform" 
    version="1.0"   
    xmlns:dyn="http://exslt.org/dynamic" 
    extension-element-prefixes="dyn"> 
```

你知道我为什么会收到这个错误吗？

**更新**

我的 XML 文件的顶部现在读取。

```
<?xml version="1.0" encoding="UTF-8"?>
<xsl:stylesheet 
     xmlns:xsl="http://www.w3.org/1999/XSL/Transform" 
     version="1.0"
     xmlns:xalan="http://xml.apache.org/xalan" 
     exclude-result-prefixes="xalan"> 
```

我们失败的XML是

```
<xsl:template name="test">
  <xsl:param name="param" />
  <xsl:value-of select="$param"/>
  <xsl:value-of select="xalan:evaluate($param)"/>
</xsl:template> 
```

此代码适用于运行 Tomcat 5.0 的服务器，但不适用于运行 Tomcat 5.5 的服务器。我想是因为代码在一台服务器上运行，而不是环境问题。

XSLT 通过 JSP 页面应用于 XML。对我来说，看起来 xalan.jar 文件没有被使用。JSP 的顶部是：

```
<%@page import="javax.xml.transform.*"%>
<%@page import="javax.xml.transform.stream.*"%>
<%@page import="         java.security.Principal,
             java.net.URL, 
             java.net.URLConnection, 
             java.io.InputStream,
             java.io.InputStreamReader,
             java.io.Reader,
             java.io.BufferedReader,
             java.io.File,
             javax.xml.transform.*,
             javax.xml.transform.stream.*,
             javax.xml.transform.*,
             javax.xml.transform.stream.*"%> 
```

**更新** 问题是 Saxon 被选为 XML 解析器。Saxon 不支持此功能。删除 Saxon.jar 可以解决此问题。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-16T11:57:24.420

在 XSLT 的某个地方，您指的是一个名为“{ [http://exslt.org/dynamic](http://exslt.org/dynamic) }evaluate()”的函数，而您没有给它预期的参数数量。

或者......它无法找到您正在添加的扩展。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-16T14:29:48.170

**您可能正在使用旧版本的 Xalan**。

尝试改用**[`xalan:evaluate()`](http://xml.apache.org/xalan-j/extensionslib.html#evaluate)**扩展名。

在**[此线程](http://marc.info/?l=xalan-j-users&m=105060163017129&w=2)**中阅读更多信息。

# vba - 以编程方式在 VBA 宏中设置 DLL 搜索路径

> ID：450177
> 
> 赞同：10
> 
> 时间：2009-01-16T11:47:44.753
> 
> 标签：vba, dll, ms-word

**问题**

*   我有一个 word 模板，它使用 VBA 的`Declare`语句链接到一个 dll，其路径可以在 VBA 宏中确定
*   我想将此部署到用户 %APPDATA%\Microsoft\Word\STARTUP 目录
*   我不想永久更改用户的 PATH 环境变量（暂时可以，但这似乎不起作用，因为在应用程序重新启动之前它们不会刷新）

**尝试的解决方案**

我尝试使用从普通目录加载模板时`Declare`使用的语句动态添加代码`ThisDocument.VBProject.CodeModule.AddFromString(code)`，但是当模板位于 Word\STARTUP 中时，会出现以下错误：

> 运行时错误“50289”：
> 
> 由于项目受到保护，无法执行操作。

当模板位于 Word\STARTUP 中时，将注册表项“HKEY___LOCAL_MACHINE\Software\Microsoft\Office\11.0\Word\Security\AccessVBOM”设置为 1 并不能解决此问题

* * *

我真的很难找到解决方案。如果有人知道这样做的方法，那就太好了。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2012-06-24T05:07:38.287

坦率地说，我不知道使用所有这些 VBA 代码注入、LoadLibrary() 调用的程序集生成以及我见过的用于这个简单任务的技术有什么问题。在我的项目中，我使用简单的代码从与工作簿相同的位置加载 dll，如下所示：

```
Declare Function MyFunc Lib "MyDll.dll" (....) As ...

Sub Test()
  ....
  ChDir ActiveWorkbook.Path
  ... = MyFunc(....)
End Sub 
```

至少在 Excel 2003 中，从当前路径加载 dll 没有问题，将 ChDir 设置为 DLL 具有的任何路径。您可能还需要更改与当前路径分开的当前驱动器。您只需执行一次，在第一次函数调用之前，之后无论您当前的路径在哪里，DLL 都会保持连接状态，因此您可以在 workbook_open 中执行一次，以后不必担心路径。为此，我在 DLL 中提供了一个空的虚拟函数。我不认为 MS Word 在这方面有什么不同。

```
Private Declare Sub Dummy Lib "MyDLL.dll" ()

Private Sub Workbook_Open()
    ChDrive Left$(Me.Path, 1)
    ChDir Me.Path
    Dummy
End Sub 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-01-16T19:40:13.177

您可以使用 LoadLibrary api。

例如在我的项目中，代码如下所示：

```
If LibraryLoaded() Then
   Call MyFunc ...
End If

Public Function LibraryLoaded() As Boolean

 Static IsLoaded As Boolean
 Static TriedToLoadAlready As Boolean

 If TriedToLoadAlready Then
    LibraryLoaded = IsLoaded
    Exit Function
  End If
  Dim path As String
 path = VBAProject.ThisWorkbook.path
 path = Left(path, InStrRev(path, "\") - 1)
 IsLoaded = LoadLibrary(path & "\bin\" & cLibraryName)
 TriedToLoadAlready = True

 LibraryLoaded = IsLoaded

End Function 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-05-04T15:08:42.763

还有另一个非常非常丑陋的解决方案，但是这个博主想通了，我想不出任何其他方法：

[http://blogs.msdn.com/pranavwagh/archive/2006/08/30/How-To-Load-Win32-dl​​ls-Dynamically-In-VBA.aspx](http://blogs.msdn.com/pranavwagh/archive/2006/08/30/How-To-Load-Win32-dlls-Dynamically-In-VBA.aspx)

基本上，您编写一个在运行时在 VBA 中创建代码模块的过程。此模块必须创建对 dll 的引用，并且它必须创建一个虚拟函数（或过程）作为调用 dll 的此模块的一部分。然后，从您的代码中，您使用 Application.Run(dummyfunction(), arg1, arg2...)。这是必要的，否则项目将无法编译，因为 dummyfunction 还不是函数。

您会在他的代码中注意到，他使用 InputBox() 来获取 .dll 的位置，但显然您可以从电子表格中的某个范围内获取位置。以下代码片段可能很有用。

```
Dim cm As CodeModule
Dim vbc As VBComponent

Set cm = Application.VBE.ActiveVBProject.VBComponents.Add(vbext_ct_StdModule).CodeModule
cm.AddFromString (decString & funcString)
cm.Name = "MyNewModule"
Set vbc = cm.Parent
Application.VBE.ActiveVBProject.VBComponents.Remove vbc 
```

'decString' 和 'funcString' 只是我像他的 'ss' 一样构造的字符串。该片段显示了如何重命名代码模块，以便以后可以在需要时将其删除。显然，这只是在创建后立即删除它，您可能不想这样做，但至少它向您展示了它是如何完成的。

说了这么多，我们现在大多只是编写 .exe 和外壳。如果您需要 VBA 等待 shell 完成，也有针对该问题的解决方案。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2015-08-06T14:10:07.163

这就是我最终所做的，使用上面链接的 Pranav Wagh 的方法和 C Pearson 网站 ( [http://www.cpearson.com/excel/vbe.aspx](http://www.cpearson.com/excel/vbe.aspx) ) 中的代码。此代码提示用户使用打开文件窗口选择 dll 的路径，使用输入路径的声明函数和执行与 dll 握手的函数构建一个新模块。如果成功，dll 中的专用函数返回 1：

```
Public rtn As Integer

Sub LinkToDll()

Dim path As String, default As String
MsgBox "Select Geo_DLL.dll file from next window"

With Application.FileDialog(msoFileDialogOpen)
    .AllowMultiSelect = False
    .Title = "Select Geo_DLL.dll file"
    If .Show = True Then
        path = .SelectedItems(1)
    End If
End With

'Add a module
Dim VBProj As VBIDE.VBProject
Dim VBComp As VBIDE.VBComponent

Set VBProj = ActiveWorkbook.VBProject
Set VBComp = VBProj.VBComponents.Add(vbext_ct_StdModule)
VBComp.Name = "LinkModule"

'Add procedure to module
Dim CodeMod As VBIDE.CodeModule
Dim LineNum As Long

Set VBComp = VBProj.VBComponents("LinkModule")
Set CodeMod = VBComp.CodeModule

With CodeMod
LineNum = .CountOfLines + 1
.InsertLines LineNum, "Declare Function RegDll Lib " & Chr(34) & path & Chr(34) & " (ByRef rtn As Integer)"
LineNum = LineNum + 1
.InsertLines LineNum, "Sub runthisfunc(rtn)"
LineNum = LineNum + 1
.InsertLines LineNum, "On Error Resume Next"
LineNum = LineNum + 1
.InsertLines LineNum, "rtn = 0"
LineNum = LineNum + 1
.InsertLines LineNum, "RegDll rtn"
LineNum = LineNum + 1
.InsertLines LineNum, "If rtn = 1 Then MsgBox (" & Chr(34) & "DLL linked" & Chr(34) & ")"
LineNum = LineNum + 1
.InsertLines LineNum, "If rtn = 0 Then MsgBox (" & Chr(34) & "DLL not found" & Chr(34) & ")"
LineNum = LineNum + 1
.InsertLines LineNum, "End Sub"
End With

'This is what CodeMod.InsertLines is writing:
'--------------------------------------------
'Declare Function RegDll Lib "C:\path\Geo_DLL.dll" (ByRef rtn As Integer)
'Sub runthisfunc(rtn)
'On Error Resume Next
'rtn = 0
'RegDll rtn
'If rtn = 1 Then MsgBox ("DLL Linked")
'If rtn = 0 Then MsgBox (DLL not found")
'End Sub

Application.Run "runthisfunc", rtn

'Delete Module
VBProj.VBComponents.Remove VBComp

End Sub 
```

但是，一旦我将工作簿 (xlsm) 转换为插件 (xlam)，我发现 Excel 不会让宏创建新模块，因此我的 LinkToDll 将无法工作。修复方法是将 Declare 函数放回 LinkToDll，仅使用 dll 文件名（“Geo_DLL.dll”）作为 Lib 以及 runthisfunc 子。我发现让用户只需通过“打开文件”窗口选择 dll 文件就足以将 Excel 指向 dll，即使在 Declare Function 语句的 Lib 部分中只有文件名。

克里斯

# data-structures - 允许有效优先级更新的优先级队列？

> ID：450180
> 
> 赞同：22
> 
> 时间：2009-01-16T11:49:46.700
> 
> 标签：data-structures, timeout, queue, scheduling, priority-queue

**更新**：这是[我对 Hashed Timing Wheels 的实现](http://tinyurl.com/7zgwb4)。如果您有提高性能和并发性的想法，请告诉我。（2009 年 1 月 20 日）

```
// Sample usage:
public static void main(String[] args) throws Exception {
    Timer timer = new HashedWheelTimer();
    for (int i = 0; i < 100000; i ++) {
        timer.newTimeout(new TimerTask() {
            public void run(Timeout timeout) throws Exception {
                // Extend another second.
                timeout.extend();
            }
        }, 1000, TimeUnit.MILLISECONDS);
    }
} 
```

**更新**：我通过使用[Hierarchical 和 Hashed Timing Wheels](http://www.cse.wustl.edu/~cdgill/courses/cs6874/TimingWheels.ppt)解决了这个问题。（2009 年 1 月 19 日）

我正在尝试在 Java 中实现一个特殊用途的计时器，该计时器针对超时处理进行了优化。例如，用户可以注册一个带有截止期限的任务，并且计时器可以在截止期限结束时通知用户的回调方法。在大多数情况下，注册的任务会在很短的时间内完成，因此大多数任务将被取消（例如 task.cancel()）或重新安排到未来（例如 task.rescheduleToLater(1, TimeUnit.SECOND)） .

我想使用这个计时器来检测空闲的套接字连接（例如，在 10 秒内没有收到消息时关闭连接）和写入超时（例如，当写入操作在 30 秒内未完成时引发异常。）在大多数情况下，不会发生超时，客户端将发送一条消息并发送响应，除非存在奇怪的网络问题..

我不能使用 java.util.Timer 或 java.util.concurrent.ScheduledThreadPoolExecutor 因为他们认为大多数任务都应该超时。如果一个任务被取消，被取消的任务被存储在它的内部堆中，直到 ScheduledThreadPoolExecutor.purge() 被调用，这是一个非常昂贵的操作。（O（NlogN）也许？）

在我在 CS 课程中学到的传统堆或优先级队列中，在许多情况下更新元素的优先级是一项昂贵的操作 (O(logN)，因为它只能通过删除元素并重新插入它来实现新的优先级值。像斐波那契堆这样的堆有 O(1) 时间的 reductionKey() 和 min() 操作，但我至少需要快速 increaseKey() 和 min()（或 reductionKey() 和 max()） .

您是否知道针对此特定用例高度优化的任何数据结构？我正在考虑的一种策略是将所有任务存储在哈希表中并每秒左右迭代所有任务，但这并不是那么漂亮。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-01-17T15:31:25.173

尝试将事情快速完成的正常情况与错误情况分开处理怎么样？

同时使用哈希表和优先级队列。当一个任务开始时，它会被放入哈希表中，如果它很快完成，它会在 O(1) 时间内被删除。

每隔一秒，你就会扫描哈希表，任何已经很长时间的任务，比如 0.75 秒，都会被移动到优先级队列中。优先级队列应该总是很小并且易于处理。这假设一秒远小于您正在寻找的超时时间。

如果扫描哈希表太慢，您可以使用两个哈希表，基本上一个用于偶数秒，一个用于奇数秒。当一个任务开始时，它被放入当前的哈希表中。每秒将所有任务从非当前哈希表移动到优先级队列中并交换哈希表，以便当前哈希表现在为空，并且非当前表包含一到两秒前开始的任务。

有一些选项比仅使用优先级队列复杂得多，但很容易实现应该是稳定的。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-01-19T06:51:06.763

据我所知（我写了一篇关于新优先级队列的论文，其中还回顾了过去的结果），没有一个优先级队列实现得到斐波那契堆的边界，以及恒定时间增加键。

从字面上理解有一个小问题。如果你可以在 O(1) 中得到增加键，那么你可以在 O(1) 中得到删除——只需将键增加到 +infinity（你可以使用一些标准的摊销技巧来处理充满大量 +infinity 的队列）。但是如果 find-min 也是 O(1)，这意味着 delete-min = find-min + delete 变成 O(1)。这在基于比较的优先级队列中是不可能的，因为排序界限意味着（插入所有内容，然后一个接一个地删除）

> n * insert + n * delete-min > n log n。

**这里的重点**是，如果您希望优先级队列在 O(1) 中支持增加键，那么您必须接受以下惩罚之一：

*   不是基于比较的。实际上，这是一种很好的解决问题的方法，例如[vEB 树](http://en.wikipedia.org/wiki/Van_Emde_Boas_tree)。
*   接受 O(log n) 的插入和 O(n log n) 的 make-heap（给定 n 个起始值）。这很糟糕。
*   接受 O(log n) 的 find-min。如果您从未真正*执行*find-min （没有伴随的删除），这是完全可以接受的。

但是，再一次，据我所知，没有人做过最后一个选择。我一直将其视为在数据结构的一个非常基本的领域取得新成果的机会。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-01-19T06:23:35.897

使用[Hashed Timing Wheel](http://www.cse.wustl.edu/~cdgill/courses/cs6874/TimingWheels.ppt) - Google 'Hashed Hierarchical Timing Wheels' 了解更多信息。这是人们在这里做出的答案的概括。我更喜欢带有大轮尺寸的散列计时轮，而不是分层计时轮。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-01-17T22:14:03.583

哈希和 O(logN) 结构的某种组合应该可以满足您的要求。

我很想反驳你分析问题的方式。在你上面的评论中，你说

> 因为更新会非常频繁地发生。假设我们每个连接发送 M 条消息，那么总时间变成 O(MNlogN)，这是相当大的。– 信任李（6 小时前）

就目前而言，这是绝对正确的。但是我认识的大多数人都会关注*每条消息*的成本，因为你的应用程序有越来越多的工作要做，显然它需要更多的资源。

*因此，如果您的应用程序同时*打开了十亿个套接字 （这真的可能吗？），插入成本仅为每条消息大约 60 次比较。

我敢打赌这是过早的优化：您实际上还没有使用 CodeAnalyst 或 VTune 等性能分析工具测量系统中的瓶颈。

无论如何，可能有无数种方法可以满足您的要求，一旦您决定没有单一结构可以满足您的需求，并且您想要结合不同算法的优缺点。

一种可能性是将套接字域 N 划分为若干大小为 B 的桶，然后将每个套接字散列到其中一个 (N/B) 桶中。在那个桶中有一个堆（或其他），更新时间为 O(log B)。如果 N 的上限不是预先固定的，而是可以变化的，那么您可以动态创建更多的桶，这会增加一点复杂性，但肯定是可行的。

在最坏的情况下，看门狗定时器必须搜索（N / B）队列以寻找到期时间，但我认为*看门狗定时器不需要以任何特定顺序杀死空闲套接字！* 也就是说，如果 10 个套接字在最后一个时间片中空闲，它不必在该域中搜索第一个超时的那个，处理它，然后找到第二个超时的那个，等等。它只是必须扫描（N / B）组桶并枚举所有超时。

如果您对存储桶的线性数组不满意，您可以使用队列的优先级队列，但您希望避免在每条消息上更新该队列，否则您又回到了开始的地方。相反，定义一些小于实际超时的时间。（比如说，其中的 3/4 或 7/8），如果最长的时间超过了，你只会将低级队列放入高级队列。

并且冒着说明显而易见的风险，您不希望您的队列以*经过*的时间为键。关键应该是*开始*时间。对于队列中的每条记录，经过的时间必须不断更新，但每条记录的开始时间不会改变。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2012-03-22T03:23:54.557

有一种非常简单的方法可以在 O(1) 中执行所有插入和删除操作，利用以下事实：1) 优先级基于时间，以及 2) 您可能有少量固定数量的超时持续时间。

1.  创建一个常规的 FIFO 队列来保存所有在 10 秒内超时的任务。因为所有任务都有相同的超时持续时间，您可以简单地插入到末尾并从开头移除以保持队列排序。
2.  为具有 30 秒超时持续时间的任务创建另一个 FIFO 队列。为其他超时持续时间创建更多队列。
3.  要取消，请从队列中删除该项目。如果队列被实现为链表，则这是 O(1)。
4.  重新调度可以通过取消插入来完成，因为这两个操作都是 O(1)。请注意，任务可以重新安排到不同的队列。
5.  最后，要将所有 FIFO 队列组合成一个整体优先级队列，让每个 FIFO 队列的头部参与一个常规堆。此堆的头部将是所有任务中超时时间最短的任务。

如果你有 m 个不同的超时持续时间，那么整个结构的每个操作的复杂度是 O(log m)。由于需要查找要插入的队列，因此插入是 O(log m)。Remove-min 是 O(log m) 用于恢复堆。取消是 O(1) 但最坏的情况是 O(log m) 如果您要取消队列的头部。因为 m 是一个很小的固定数，所以 O(log m) 本质上是 O(1)。它不随任务数量而扩展。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-01-17T23:28:57.490

您的具体情况向我建议了一个循环缓冲区。如果最大。timeout 是 30 秒，我们希望至少每十分之一秒获取一次套接字，然后使用 300 个双向链表的缓冲区，在此期间每十分之一秒一个。要在条目上“增加时间”，请将其从其所在的列表中删除，并将其添加到新的第十秒周期（均为恒定时间操作）。当一个周期结束时，获取当前列表中剩余的任何东西（可能通过将其提供给一个收割线程）并推进当前列表指针。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-16T13:25:26.473

您对队列中的项目数量有硬性限制 - TCP 套接字有限制。

因此问题是有界的。我怀疑任何聪明的数据结构都会比使用内置类型慢。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-16T15:14:18.940

是否有充分的理由不使用 java.lang.PriorityQueue？remove() 不会在 log(N) 时间内处理您的取消操作吗？然后根据直到队列前面的项目的时间实现您自己的等待。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-01-17T09:14:04.610

我认为将所有任务存储在一个列表中并遍历它们是最好的。

您必须（将要）在一些非常强大的机器上运行服务器才能达到这个成本很重要的极限？

# java - Apache Roller Weblogger 软件

> ID：450183
> 
> 赞同：1
> 
> 时间：2009-01-16T11:50:30.333
> 
> 标签：java, apache-roller

我正在使用 Apache Roller Weblogger 软件创建一个博客，对此我很陌生。我将它部署在 Tomcat 上，并使用 PostgreSQL 数据库。我在`roller-custom.properties`.. 中进行了所有配置。如果我`http://localhost:8080/roller/`在浏览器我收到资源不可用错误，`roller.log`如果我在文件中检查，数据库加载正常..

请如果有人有相关建议，请分享..

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-05T23:58:01.007

我必须将此添加到我的 web.xml 中：

```
<resource-ref>
        <res-ref-name>jdbc/rollerdb</res-ref-name>
        <res-type>javax.sql.DataSource</res-type>
        <res-auth>Container</res-auth>
</resource-ref> 
```

这是我的 jboss-web.xml：

```
 <resource-ref>
     <res-ref-name>jdbc/rollerdb</res-ref-name>
     <jndi-name>java:/jdbc/rollerdb-31</jndi-name>
   </resource-ref> 
```

# forms - 在没有邮件客户端的情况下发送表单

> ID：450186
> 
> 赞同：1
> 
> 时间：2009-01-16T11:51:37.023
> 
> 标签：forms, scripting, email, client

所有人！你能帮我解决我的麻烦吗？我正在尝试创建填写简历的表格。用户不应使用邮件客户端提交表单。我怎样才能在 javascript 或 PHP 上实现这个想法？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-16T11:58:14.920

首先：您需要一个基于服务器的脚本。没有任何服务器交互，就无法发送邮件。

PHP 有一个[mail() 函数](http://de2.php.net/manual/en/function.mail.php)，如果你的服务器管理员启用了它，它工作得很好。非常简单的例子：

```
<?php
// The message
$message = "Line 1\nLine 2\nLine 3";

// In case any of our lines are larger than 70 characters, we should use wordwrap()
$message = wordwrap($message, 70);

// Send
mail('caffeinated@example.com', 'My Subject', $message);
?> 
```

如果 mail() 被禁用，您需要使用正确的凭据连接 SMTP 服务器，然后您可以通过此连接发送邮件。该功能在 phpBB2 的 emailer 模块中实现，例如

祝你好运！

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-16T11:55:19.310

如果表单作为文件上传...您可以将简历上传到网络服务器，然后使用您的应用程序使用您的帐户发送电子邮件。

# seam - 接缝 JNDI 注入

> ID：450195
> 
> 赞同：0
> 
> 时间：2009-01-16T11:56:03.550
> 
> 标签：seam, jndi

如何在 Seam 中注入 JNDI 值？我读到您可以使用@Resource 或@JndiInject，但它不起作用。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-16T14:30:10.230

如果您不需要将 EJB 作为 Seam 组件，只需使用标准 InitialContext().lookup("something")。

如果您想使用可以从 JNDI 访问的 EJB 并能够将其用作 Seam 组件，那么它会更加复杂。看到[这个](http://docs.jboss.com/seam/2.1.1.GA/reference/en-US/html/configuration.html#d0e23572)。

# crm - 我的网站有哪些免费的 CRM 可用？

> ID：450204
> 
> 赞同：13
> 
> 时间：2009-01-16T11:59:06.947
> 
> 标签：crm

努力搜索，但我发现的只是一个列出“商业开源”CRM 的页面，即您必须支付的费用。

正在寻找免费的 CRM，所以我不必构建一个！

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-01-16T12:05:14.657

获得了 10 个免费 CRM 的列表！

[十大开源 CRM 解决方案](http://www.insidecrm.com/features/top-open-source-solutions-121307/)

1.  [糖CRM](http://www.sugarcrm.com/)
2.  [锦绣CRM](http://www.splendidcrm.com/)
3.  [CentricCRM](http://www.centriccrm.com/)
4.  [海珀门](http://www.hipergate.org/)
5.  [编译器](http://www.compiere.com/)
6.  [Vtiger 客户关系管理](http://www.vtiger.com)
7.  [中心视图](http://www.centraview.com/)
8.  [XRMS 客户关系管理](http://sourceforge.net/projects/xrms/)
9.  [奶油CRM](http://www.linuxsoft.cz/en/sw_detail.php?id_item=4440)
10.  [Tustena 客户关系管理](http://www.tustena.com/crm/)

还有多功能套房。

[Compiere](http://www.compiere.com/products/capabilities/index.php)或[Dolibarr](http://www.dolibarr.org/features)

*   ERP - 企业资源计划
*   CRM - 客户关系管理

[XRMS](http://sourceforge.net/projects/xrms/)

*   CRM - 客户关系管理
*   SFA - 销售团队自动化套件
*   BI - 商业智能工具
*   CTI - 计算机电话集成

[Vtiger 客户关系管理](http://www.vtiger.com/index.php?option=com_content&task=view&id=27&Itemid=55)

*   CRM - 客户关系管理
*   SFA - 销售自动化
*   IM - 库存管理

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-16T12:04:11.693

这些天我看起来一样。看起来[SugarCRM](http://www.sugarcrm.com/)是一个不错的选择。昨天我在 SugarCRM、Zoho CRM 和 Salesforce 上玩了很多。只有 SugarCRM 的社区版是开源和免费的。Zoho 很不错（最多可以释放 3 个用户）。Salesforce 更贵。

编辑。我查看了 vTiger crm，它看起来比 SugarCRM 更好，并且还有一些插件可以集成到 Outlook、Thunderbird 和 iPhone 中。我想我会尽快安装它。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-06-19T14:34:15.280

我正在为 Vtiger CRM 开发一些模块来扩展一些现有的模块（例如：联系人、邮件、日历）。我的观点是 Vtiger Crm 涵盖了 80% 的标准要求。扩展系统有一些限制。硬编码查询和大量幻数。（例如： if (a==5) else b(a==6) 等等）。新版本 5.1 即将发布（在 rc1 中）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-16T12:04:41.957

在我以前的工作中，我们为销售人员设置了[Sugar CRM](http://www.sugarcrm.com/crm/)，并且效果非常好。你一定要检查一下。

# .net - 需要帮助解决 LINQ 中 And 运算符的谓词错误

> ID：450206
> 
> 赞同：1
> 
> 时间：2009-01-16T11:59:50.313
> 
> 标签：.net, linq, expression, predicate

我遇到了谓词 And 运算符的问题。代码是：

```
SQLDBDataContext sqlDS = new SQLDBDataContext();
Expression<Func<User,bool>> pred = null; //delcare the predicate to start with.

if (Request["Name"] != null && ! Request["Name"].Equals(string.Empty))
{  
   pred = c => ( c.ContactFirst.Contains(Request["Name"]) || c.ContactLast.Contains(Request["Name"]));
}

if (Request["Company"] != null && !Request["Company"].Equals(string.Empty))
{
   if (pred == null) { 
      pred = (c => c.Company.Contains(Request["Company"])); 
   }
   else {
      pred = pred.And(c => c.Company.Contains(Request["Company"]));
   }
} 
```

错误是行：[ else {pred = pred.And(c => ] 方法 'And' 没有重载需要 '1' 参数

谁能告诉我如何使用 .And 运算符进行谓词。

提前致谢。
[阿尼尔](http://www.ade-technologies.com)

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-16T12:08:01.810

`And`是二元 And 运算符；你`Expression.AndAlso`的意思是

```
pred = Expression.AndAlso(pred, {new bit}) 
```

但是，我怀疑您正在以艰难的方式做到这一点。使用以下内容更容易：

```
IQueryable<Foo> source = ...
if(condition1) {
    source = source.Where(predicate1);
}
if(condition2) {
    source = source.Where(predicate2);
} 
```

例如：

```
IQueryable<User> source = ...
string name = Request["Name"];
if(!string.IsNullOrEmpty(name)) {
    source = source.Where(user => user.ContactFirst.Contains(name)
               || user.ContactLast.Contains(name));
}
string company = Request["Company"];
if(!string.IsNullOrEmpty(company)) {
    source = source.Where(user => user.Company.Contains(company));
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-16T12:56:47.953

一个漂亮的小库是来自 C# 3.0 的 Predicate Builder in a Nutshell Guy - [http://www.albahari.com/nutshell/predicatebuilder.aspx](http://www.albahari.com/nutshell/predicatebuilder.aspx)

# windows - 轻量级便携式编辑器

> ID：450209
> 
> 赞同：2
> 
> 时间：2009-01-16T12:00:41.980
> 
> 标签：windows, editor

我正在寻找可以直接从闪存驱动器运行而无需任何安装的**免费轻量级编辑器。**

我想要支持尽可能多语言的编辑器，我有记事本++，但我并不特别关心它。

编辑：忘了提到我正在寻找 Windows 的编辑器。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-01-16T12:08:56.287

[我是vim](http://www.vim.org/)的忠实粉丝，Portable [GVim](http://portablegvim.sourceforge.net/)让 vim 的优点变得可移植。

它为我可以命名的更多语言和各种 vim 优点提供了语法突出显示。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-01-16T12:06:28.163

我发誓[notepad2](http://www.flos-freeware.ch/notepad2.html)，它不完全是一个代码编辑器，但它支持许多文本格式的语法突出显示，而且它们只是没有任何轻量级或更便携。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-16T12:11:42.147

我喜欢[SciTE](http://www.scintilla.org/SciTE.html)，还有[jEdit](http://www.jedit.org/)。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-01-16T12:11:52.457

[JEdi​​t](http://jedit.org/)是一个相当轻量级的文本编辑器，具有所有的修饰功能。您可以下载大量插件。它也是用java编写的，所以你可以跨平台使用它。

便携式版本[在这里](http://portableapps.com/node/11617)，感谢[@redsquare](https://stackoverflow.com/users/6440/redsquare)提供链接。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-01-16T18:51:31.620

赛特@[http://www.scintilla.org/SciTEDownload.html](http://www.scintilla.org/SciTEDownload.html)

支持的语言列表非常令人印象深刻。包括现代编辑器的大多数功能 - 语法突出显示、代码折叠、无限撤消/重做、使用正则表达式查找/替换、自动缩进等。它坚如磐石 - 在我 5 年多的时间里从未发生过崩溃或错误一直在使用它。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-16T12:06:01.503

查看[Programmer's Notepad](http://www.pnotepad.org/)，它有一个便携版本。但是我不会说记事本++更好。事实上，我认为在自由世界中没有比这更好的了。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-01-16T12:16:33.477

[Emacs](http://www.gnu.org/software/emacs/)呢？

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-01-16T15:38:56.517

[Windows 版的 Emacs](http://www.gnu.org/software/emacs/windows/ntemacs.html)应该这样做。众所周知，它以前会耗尽 CD。与此相比，闪存驱动器应该是小菜一碟。

为了检查，我刚刚从[http://ftp.gnu.org/gnu/emacs/windows/](http://ftp.gnu.org/gnu/emacs/windows/)下载了最新的“bin”版本。它解压到一个 45MB 的目录。如果你不能腾出那么多空间，你就有麻烦了。

为了比较（以及那些喜欢其他编辑器的人），我浏览了这里提到的所有内容的下载，以找到（未压缩的）大小。

*   Emacs（没有 Lisp 或代码源） - 45MB
*   GVim - 22MB
*   记事本2 - 300MB
*   JEdi​​t - 15MB
*   Scintilla（自解压版） - 500K
*   程序员记事本 - 6MB
*   记事本++ 便携式 - 9MB

如果是我，我会按照编辑偏好的顺序（从我最喜欢到最不喜欢）尝试它们，然后在第一个适合所需空间的地方停下来。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-01-16T12:08:59.420

在portableapps.com 上的选择有点有限： http: [//portableapps.com/apps/development](http://portableapps.com/apps/development)

有 NVU 看起来比 notepad++ 更全面，但个人 notepad++ 连接到 winscp 是我目前选择的 Web 开发工具。其他任何东西都会变得有点笨拙和反应迟钝。

不确定它是否可以通过闪存驱动器工作，但[Intype](http://intype.info/home/index.php)看起来也很有希望。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-01-16T12:29:01.033

PSPad 很不错，如果您不介意我问，您到底不喜欢 notepad++ 的什么地方，并且您确实意识到使用便携式 IDE 您需要全部工作才能使用它，或者您只是随身携带一个臃肿的编辑器（不管 IDE 多么轻量级）。

[这](http://www.portablefreeware.com/all.php)是一个很好的站点，可以找到各种便携式软件，[这里](http://www.portablefreeware.com/?sc=14&p=1)是编辑器页面。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-01-16T12:43:11.007

听起来您真正要寻找的是文本编辑器，而不是 IDE。我一直是[Crimson Editor](http://crimsoneditor.com/)的粉丝。有很多很棒的 Windows 编辑器，但我发现 Crimson Editor 有一个非常好的界面，以及我想要的文本编辑器中的每一个功能，所以每当我不使用 vim/ 时，我总是会回来使用它gvim。

* * *

## 回答 #12

> 赞同：-1
> 
> 时间：2009-01-16T12:07:33.590

查看portableapps.com，我能看到的唯一可能对您有用的应用程序是[Abiword](http://portableapps.com/apps/office/abiword_portable)，但它更像是一个文字处理器，而不仅仅是一个文本编辑器，但无论如何可能值得一试。

然后是Akelpad，看起来很轻巧：[http ://akelpad.sourceforge.net/en/index.php](http://akelpad.sourceforge.net/en/index.php)

**编辑：**这是一个相关且经过研究的答案。谁能评价这个，请在​​评论中解释为什么？那将是良好的礼节和礼貌，这没有任何意义。

* * *

## 回答 #13

> 赞同：-2
> 
> 时间：2009-01-16T12:06:04.730

虽然不是免费的，[ultraedit](http://www.ultraedit.com/)一直是我最喜欢的轻量级编辑器。我想我绝对物有所值。

# python - 如何检查是否可以在 MS XP/Vista 的给定目录中创建文件？

> ID：450210
> 
> 赞同：6
> 
> 时间：2009-01-16T12:01:24.867
> 
> 标签：python, windows, winapi, windows-vista, permissions

我有一个在用户指定的目录中创建文件的代码。用户可以指向一个他不能在其中创建文件的目录，但他可以重命名它。

我创建了用于测试目的的目录，我们称之为`C:\foo`.

我有以下权限`C:\foo`：

*   遍历目录/执行文件
*   删除子文件夹和文件
*   移除
*   读取权限
*   更改权限
*   取得所有权

我没有以下任何权限`C:\foo`：

*   完全控制
*   文件创建
*   文件夹创建

到目前为止，我尝试了以下方法：

 `os.access('C:\foo', os.W_OK) == True`

`st = os.stat('C:\foo')
mode = st[stat.ST_MODE]
mode & stat.S_IWRITE == True`

我相信这是因为我可以重命名文件夹，所以它对我来说是可变的。但它的内容 - 不是。

有谁知道如果当前用户有权在该目录中创建文件，我该如何编写代码来检查给定目录？

简而言之 - 我想检查当前用户是否具有给定文件夹名称的**文件创建**和**文件夹创建**权限。

编辑：对此类代码的需求源于“Certified for Windows Vista”程序的第 3 号测试用例，其中指出：

> 1.  应用程序不得允许最低权限用户将任何文件保存到 Windows 系统目录以通过此测试用例。

这是否应该被理解为“应​​用程序可能会尝试将文件保存在 Windows 系统目录中，但不应该在失败时崩溃？” 或者更确切地说“应用程序必须在尝试保存文件之前执行安全检查？”

我是否应该仅仅因为 Windows Vista 本身不允许最小特权用户将任何文件保存在 %WINDIR% 中而停止打扰？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-16T12:18:28.513

我不会浪费时间和 LOC 来检查权限。在 Windows 中创建文件的终极测试是创建本身。其他因素可能会发挥作用（例如具有相同名称的现有文件（或更糟的是文件夹）、磁盘空间、后台进程。这些条件甚至可能在您进行初始检查和您实际尝试创建文件。

所以，如果我有这样的场景，我会设计我的方法以在失败的情况下不丢失任何数据，继续尝试创建我的文件，并为用户提供更改所选目录并重试的选项如果创建失败。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-16T12:36:05.997

我最近编写了一个应用程序来通过一组测试以从 Microsoft 获得 ISV 状态，并且我还添加了该条件。我理解的方式是，如果用户是最低权限，那么他将无权写入系统文件夹。所以我按照 Ishmaeel 描述的方式解决了这个问题。我尝试创建文件并捕获异常，然后通知用户他无权将文件写入该目录。

据我了解，最低权限用户将没有必要的权限来写入这些文件夹，如果他有，那么他不是最低权限用户。

> 我是否应该仅仅因为 Windows Vista 本身不允许最小特权用户将任何文件保存在 %WINDIR% 中而停止打扰？

在我看来？是的。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-16T12:56:30.043

我同意其他答案，即尝试创建文件并捕获异常。

*但是*，在 Vista 上要小心 UAC！例如，请参阅[“为什么我的应用程序允许我将文件保存到 Vista 中的 Windows 和 System32 文件夹？”](https://stackoverflow.com/questions/370837/why-does-my-application-allow-me-to-save-files-to-the-windows-and-system32-folder) ：为了支持旧应用程序，Vista 会“假装”创建文件，而实际上它是在当前用户配置文件下的所谓虚拟商店中创建文件。

为避免这种情况，您必须通过在 .exe 的清单中包含适当的命令来明确告诉 Vista 您不需要管理权限，请参阅上面链接的问题。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-01-16T16:52:23.280

```
import os
import tempfile

def can_create_file(folder_path):
    try:
        tempfile.TemporaryFile(dir=folder_path)
        return True
    except OSError:
        return False

def can_create_folder(folder_path):
    try:
        name = tempfile.mkdtemp(dir=folder_path)
        os.rmdir(name)
        return True
    except OSError:
        return False 
```

# design-patterns - 对象级事务管理模式

> ID：450215
> 
> 赞同：5
> 
> 时间：2009-01-16T12:04:48.057
> 
> 标签：design-patterns, architecture, transactions

我试图找出在对象级别（而不是数据库级别）处理事务的最佳方法。简短示例：4 个对象 A、B、C 和 D。A 启动事务并调用 B 和 C 中的方法。在此事务中 C 也在调用 D。被调用的方法不应该总是参与此事务，但是也可以自己调用。**有没有在对象级别管理事务的模式？**

我并没有真正找到什么，所以我想出了这个：使用一个可以注册 TransactionListener 的 TransactionContext。如果使用 TransactionContext 启动事务，则它将正在运行的事务注入到每个已注册的侦听器中，而这些侦听器又将使用正在运行的事务，或者如果需要，将自行启动一个事务。这样我就可以很自由地决定我是否想要一个对象参与我的交易。

当有像上面这样的对象调用链时，问题就来了。开始事务时，我只知道 B 和 C 必须参与事务，所以我将它们添加到 TransactionContext。但是D呢？我真的不想将 TransactionContext 传递给 B 和 C。

我将不胜感激对我的方法的一些输入以及一些指向已证明模式的指针（甚至更好）。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-16T12:19:43.517

“我真的不想将 TransactionContext 传递给 B 和 C。”

为什么不？他们参与并委托给其他对象。

任何一个

*   每个人都需要注册。这意味着您必须委托注册。 `A`知道它交给`B`and `C`。每一个都可能（或可能没有）有更多的代表进行注册。使用“RegisterYourselfAndYourDelegates”方法实现这一点相对简单。

*   避开监听器设计模式。创建一个事务上下文并传递它。这用稍微简单的设计代替了注册和注入。但是，您需要有两个 Context 子类——真正的 Context 和一个不做任何事情并在事务上下文之外使用的存根 Context。

    这使您的函数定义稍微复杂一些。对于 Java，您可以使用重载命名来拥有两个具有不同签名的方法函数。

    对于 Python，这不是问题；上下文是一个可选参数。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-16T12:07:29.393

[Spring 框架](http://www.springsource.org/)（最初用于 Java，但现在也有一个 .Net 版本）可以做到这一点。方法标记为：

*   需要一个事务（如果还没有，则开始一个事务）；
*   需要一个新事务（总是创建一个新事务）；
*   等等

这通常通过注释来完成。听起来和你描述的完全一样。

查看[Spring 的事务管理](http://static.springframework.org/spring/docs/2.5.x/reference/transaction.html)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-16T13:39:30.753

我建议：[Prevayler](http://www.prevayler.org/wiki/)

```
Prevayler is an object persistence library for Java. It is an implementation of the
System Prevalence architectural style, in which data is kept hot in Memory with
changes journaled for system recovery.

Prevayler ' s architecture is illustrated in the diagram shown there. Prevayler [1]
serves as a transactional barrier for the business objects [2] of your application,
held in Memory. You encapsulate all modifications of your business objects into
instances of the Transaction interface [3], much like a " command " pattern
(though different from a command in some details of the pattern). Whenever 
you ask Prevayler to execute a transaction on your business objects [4], Prevayler
first writes the transaction object to a journal [5] so that data is not lost if your
system crashes. Prevayler can also write a snapshot of your entire business object
graph [6] as often as you wish. Prevayler uses the latest snapshot together with
the journals to automatically recover your business objects from disk [7] on
application startup by restoring the snapshot and then re-executing every
transaction that was originally executed after that snapshot was taken. 
```

当然，您可以禁用持久存储并仅使用内存中存储。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-16T19:40:33.970

强烈推荐Andrei Alexandrescu 和 Petru Marginean 撰写的[这篇论文](http://www.ddj.com/article/printableArticle.jhtml?articleID=184403758&dept_url=/cpp/)，它介绍了 ScopeGuard 模式。这是一个优雅且非常健壮的解决方案，专门用于在存在异常的情况下管理事务。

适用于您尝试解决的问题 ScopeGuard 将允许您定义事务的范围，并且无论事务涉及方法 A、B、C、D 还是调用单个方法，都可以轻松（即自动）为您管理该范围。

# iphone - 如何将参数传递给此函数？

> ID：450222
> 
> 赞同：10
> 
> 时间：2009-01-16T12:06:11.610
> 
> 标签：iphone, objective-c

我有以下代码：

```
[replyAllBtn addTarget:self.target action:@selector(ReplyAll:) forControlEvents:UIControlEventTouchUpInside];

- (void)replyAll:(NSInteger)tid {
// some code
} 
```

如何向`ReplyAll`函数发送参数？

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-01-19T01:07:47.173

replyAll 方法应该接受 (id)sender。如果 UIButton 触发了事件，那么相同的 UIButton 将作为发送者传递。UIButton 有一个属性“标签”，您可以将自己的自定义数据附加到（很像 .net winforms）。

因此，您可以将您的活动与：

```
[replyAllBtn addTarget:self.target action:@selector(ReplyAll:) forControlEvents:UIControlEventTouchUpInside];
replyAllBtn.tag=15; 
```

然后处理它：

```
(void) ReplyAll:(id)sender{
    NSInteger *tid = ((UIControl*)sender).tag;
    //... 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-16T13:12:44.723

选择器函数通常会这样定义：

```
- (void) ReplyAll:(id)sender; 
```

因此，动作将接收的唯一参数是调用它的实际控件。您可以在控件中添加一个可以在 replyAll 中读取的属性

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-19T08:40:00.163

如果要发送一个int值，设置按钮的标签=你要传递的int值。然后您可以访问按钮的标记值以获取所需的 int。

NSInteger 不是指针。试试这个

```
NSInteger tid = sender.tag; 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-19T09:02:47.137

它现在正在工作：D。

```
{
NSInteger tid = [sender tag];
} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-16T12:47:29.500

Cocoa 中使用的 MVC 模型的工作方式不同。基本上，这个想法是诸如按钮之类的控件（=视图）仅让功能知道它被按下，而不知道这意味着什么。然后该函数必须知道所有动态和依赖关系。在你的情况下，它是必须找到参数的函数。为此，您需要将其他对象“绑定”到该函数（= 控制器）。

如果你想在 iPhone 编程方面取得进步，我建议你先阅读一些 Cocoa 教程。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-17T20:51:30.303

有一些很好的方法可以做到这一点。最常见的两种实现方式是让控制器（接收动作的人）知道可能的发送者，或者让发送者本身有一个方法，您最终可以使用该方法来确定正确的行为。

第一种（我更喜欢的方式，但很容易反驳）将像这样实现：

```
@interface Controller : NSObject {
    UIButton *_replyToSender;
    UIButton *_replyToAll;
}
- (void)buttonClicked:(id)sender;
@end

@implementation Controller
- (void)buttonClicked:(id)sender {
    if (sender == _replyToSender) {
         // reply to sender...
    } else if (sender == _replyToAll) {
         // reply to all...
    }
}
@end 
```

第二种方式将以如下方式实施：

```
typedef enum {
    ReplyButtonTypeSender = 1,
    ReplyButtonTypeAll,
} ReplyButtonType;

@interface Controller : NSObject {
}
- (void)buttonClicked:(id)sender;
@end

@interface MyButton : UIButton {
}
- (ReplyButtonType)typeOfReply;
@end

@implementation Controller
- (void)buttonClicked:(id)sender {
    // You aren't actually assured that sender is a MyButton, so the safest thing
    // to do here is to check that it is one.
    if ([sender isKindOfClass:[MyButton class]]) {
        switch ([sender typeOfReply]) {
            case ReplyButtonTypeSender:
                // reply to sender...
                break;
            case ReplyButtonTypeAll:
                // reply to all...
                break;
        }
    }
}
@end 
```

# jstl - 比较字符串时出现 JSTL 异常

> ID：450226
> 
> 赞同：1
> 
> 时间：2009-01-16T12:06:53.560
> 
> 标签：jstl

我在 JSTL 文件中有下一个代码：

```
<c:choose>
    <c:when test="${application.lodging eq 'F'}"><bean:message key="courseapplication.lodgingF"/></c:when>
    <c:when test="${application.lodging eq 'H'}"><bean:message key="courseapplication.lodgingH"/></c:when>
    <c:when test="${application.lodging eq 'B'}"><bean:message key="courseapplication.lodgingB"/></c:when>
</c:choose> 
```

$application.lodging 是 F 但我收到下一个错误：

```
SEVERE: ServletException in '/administration/jsp/applications.jsp': An exception occured trying to convert String "F" to type "java.lang.Long"
org.apache.jasper.JasperException: Exception in JSP: /administration/jsp/applications.jsp:20

17: <h2><a href="application.do?id=${application.id}&amp;type=S">${application.name}</a></h2>
18: <h3>
19: <c:choose>
20:     <c:when test="${application.lodging eq 'F'}"><bean:message key="courseapplication.lodgingF"/></c:when>
21:     <c:when test="${application.lodging eq 'H'}"><bean:message key="courseapplication.lodgingH"/></c:when>
22:     <c:when test="${application.lodging eq 'B'}"><bean:message key="courseapplication.lodgingB"/></c:when>
23: </c:choose> 
```

在我使用 Apache Tomcat 6.0 的本地服务器中，这段代码没有出现任何问题。

在我的带有 tomcat 5.5 的应用程序服务器中出现上述错误。

有谁知道为什么会这样？

如果我使用*==*而不是*eq ，也会发生同样的情况*

```
SEVERE: ServletException in '/administration/jsp/applications.jsp': An exception occured trying to convert String "F" to type "java.lang.Long"
org.apache.jasper.JasperException: Exception in JSP: /administration/jsp/applications.jsp:20

17: <h2><a href="application.do?id=${application.id}&amp;type=S">${application.name}</a></h2>
18: <h3>
19: <c:choose>
20:     <c:when test="${application.lodging=='F'}"><bean:message key="courseapplication.lodgingF"/></c:when>
21:     <c:when test="${application.lodging=='H'}"><bean:message key="courseapplication.lodgingH"/></c:when>
22:     <c:when test="${application.lodging=='B'}"><bean:message key="courseapplication.lodgingB"/></c:when>
23: </c:choose> 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-19T19:03:14.430

异常表示这`application.lodging`是数字，而不是字符串。那正确吗？在这种情况下，您可能需要先将“F”、“H”、“B”字符串转换为数字（您想比较字符吗？）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-16T12:42:46.903

您是否尝试按照[此答案中的建议](https://stackoverflow.com/questions/123598#368526)对字符串进行简单比较？

```
<c:when test="${application.lodging=='F'}"><bean:message key="courseapplication.lodgingF"/></c:when> 
```

可能在两种环境中都可以工作...

# c# - 通用列表 - 在列表中移动项目

> ID：450233
> 
> 赞同：178
> 
> 时间：2009-01-16T12:08:38.860
> 
> 标签：c#, .net, generics, list

所以我有一个通用列表，一个`oldIndex`和一个`newIndex`值。

我想尽可能简单地将 , 的项目移动`oldIndex`到...。`newIndex`

有什么建议么？

## 笔记

该项目应该在它被移除之前`(newIndex - 1)`和`newIndex` *之前的项目之间结束。*

* * *

## 回答 #1

> 赞同：160
> 
> 时间：2011-03-30T04:14:07.097

我知道你说的是“通用列表”，但你没有指定你需要使用*List(T)*类，所以这里有一个不同的东西。

*ObservableCollection(T)*类有一个[Move 方法](http://msdn.microsoft.com/en-us/library/ms654933.aspx)，它完全符合您的要求。

```
public void Move(int oldIndex, int newIndex) 
```

下面*基本*是这样实现的。

```
T item = base[oldIndex];
base.RemoveItem(oldIndex);
base.InsertItem(newIndex, item); 
```

所以你可以看到其他人建议的交换方法本质上就是*ObservableCollection*在它自己的 Move 方法中所做的。

**2015-12-30 更新：您现在可以在 corefx 中查看**[Move](https://github.com/dotnet/corefx/blob/836f0480afbfc8fe7555530c6d98f70873db8ae4/src/System.ObjectModel/src/System/Collections/ObjectModel/ObservableCollection.cs#L70)和[MoveItem](https://github.com/dotnet/corefx/blob/836f0480afbfc8fe7555530c6d98f70873db8ae4/src/System.ObjectModel/src/System/Collections/ObjectModel/ObservableCollection.cs#L187)方法的源代码，而无需使用 Reflector/ILSpy，因为 .NET 是开源的。

* * *

## 回答 #2

> 赞同：145
> 
> 时间：2009-01-16T12:14:12.187

```
var item = list[oldIndex];

list.RemoveAt(oldIndex);

if (newIndex > oldIndex) newIndex--; 
// the actual index could have shifted due to the removal

list.Insert(newIndex, item); 
```

放入扩展方法中，它们看起来像：

```
 public static void Move<T>(this List<T> list, int oldIndex, int newIndex)
    {
        var item = list[oldIndex];

        list.RemoveAt(oldIndex);

        if (newIndex > oldIndex) newIndex--;
        // the actual index could have shifted due to the removal

        list.Insert(newIndex, item);
    }

    public static void Move<T>(this List<T> list, T item, int newIndex)
    {
        if (item != null)
        {
            var oldIndex = list.IndexOf(item);
            if (oldIndex > -1)
            {
                list.RemoveAt(oldIndex);

                if (newIndex > oldIndex) newIndex--;
                // the actual index could have shifted due to the removal

                list.Insert(newIndex, item);
            }
        }

    } 
```

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2015-02-19T01:36:06.213

我知道这个问题很老，但我将javascript 代码的[这个](https://stackoverflow.com/a/7180095/4171028)响应改编为 C#。希望能帮助到你

```
public static void Move<T>(this List<T> list, int oldIndex, int newIndex)
{
    // exit if positions are equal or outside array
    if ((oldIndex == newIndex) || (0 > oldIndex) || (oldIndex >= list.Count) || (0 > newIndex) ||
        (newIndex >= list.Count)) return;
    // local variables
    var i = 0;
    T tmp = list[oldIndex];
    // move element down and shift other elements up
    if (oldIndex < newIndex)
    {
        for (i = oldIndex; i < newIndex; i++)
        {
            list[i] = list[i + 1];
        }
    }
        // move element up and shift other elements down
    else
    {
        for (i = oldIndex; i > newIndex; i--)
        {
            list[i] = list[i - 1];
        }
    }
    // put element from position 1 to destination
    list[newIndex] = tmp;
} 
```

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2009-01-16T12:19:05.703

List<T>.Remove() 和 List<T>.RemoveAt() 不返回要删除的项目。

因此你必须使用这个：

```
var item = list[oldIndex];
list.RemoveAt(oldIndex);
list.Insert(newIndex, item); 
```

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-01-16T12:16:03.493

将当前所在的项目插入`oldIndex`到所在的位置`newIndex`，然后删除原始实例。

```
list.Insert(newIndex, list[oldIndex]);
if (newIndex <= oldIndex) ++oldIndex;
list.RemoveAt(oldIndex); 
```

您必须考虑到要删除的项目的索引可能会因插入而改变。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2012-08-07T10:48:25.960

我创建了一个扩展方法来移动列表中的项目。

*如果我们正在移动现有*项目，则索引不应移动，因为我们正在将项目移动到列表中的*现有*索引位置。

@Oliver 在下面提到的边缘情况（将项目移动到列表末尾）实际上会导致测试失败，但这是设计使然。要在列表末尾插入一个*新*`List<T>.Add`项目，我们只需调用. `list.Move(predicate, list.Count)` *应该*失败，因为这个索引位置在移动之前不存在。

无论如何，我已经创建了两个额外的扩展方法，`MoveToEnd`并且`MoveToBeginning`，其来源可以在[这里](https://github.com/benfoster/Fabrik.Common/tree/master/src/Fabrik.Common)找到。

```
/// <summary>
/// Extension methods for <see cref="System.Collections.Generic.List{T}"/>
/// </summary>
public static class ListExtensions
{
    /// <summary>
    /// Moves the item matching the <paramref name="itemSelector"/> to the <paramref name="newIndex"/> in a list.
    /// </summary>
    public static void Move<T>(this List<T> list, Predicate<T> itemSelector, int newIndex)
    {
        Ensure.Argument.NotNull(list, "list");
        Ensure.Argument.NotNull(itemSelector, "itemSelector");
        Ensure.Argument.Is(newIndex >= 0, "New index must be greater than or equal to zero.");

        var currentIndex = list.FindIndex(itemSelector);
        Ensure.That<ArgumentException>(currentIndex >= 0, "No item was found that matches the specified selector.");

        // Copy the current item
        var item = list[currentIndex];

        // Remove the item
        list.RemoveAt(currentIndex);

        // Finally add the item at the new index
        list.Insert(newIndex, item);
    }
}

[Subject(typeof(ListExtensions), "Move")]
public class List_Move
{
    static List<int> list;

    public class When_no_matching_item_is_found
    {
        static Exception exception;

        Establish ctx = () => {
            list = new List<int>();
        };

        Because of = ()
            => exception = Catch.Exception(() => list.Move(x => x == 10, 10));

        It Should_throw_an_exception = ()
            => exception.ShouldBeOfType<ArgumentException>();
    }

    public class When_new_index_is_higher
    {
        Establish ctx = () => {
            list = new List<int> { 1, 2, 3, 4, 5 };
        };

        Because of = ()
            => list.Move(x => x == 3, 4); // move 3 to end of list (index 4)

        It Should_be_moved_to_the_specified_index = () =>
            {
                list[0].ShouldEqual(1);
                list[1].ShouldEqual(2);
                list[2].ShouldEqual(4);
                list[3].ShouldEqual(5);
                list[4].ShouldEqual(3);
            };
    }

    public class When_new_index_is_lower
    {
        Establish ctx = () => {
            list = new List<int> { 1, 2, 3, 4, 5 };
        };

        Because of = ()
            => list.Move(x => x == 4, 0); // move 4 to beginning of list (index 0)

        It Should_be_moved_to_the_specified_index = () =>
        {
            list[0].ShouldEqual(4);
            list[1].ShouldEqual(1);
            list[2].ShouldEqual(2);
            list[3].ShouldEqual(3);
            list[4].ShouldEqual(5);
        };
    }
} 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-01-16T12:11:14.907

我希望：

```
// Makes sure item is at newIndex after the operation
T item = list[oldIndex];
list.RemoveAt(oldIndex);
list.Insert(newIndex, item); 
```

... 或者：

```
// Makes sure relative ordering of newIndex is preserved after the operation, 
// meaning that the item may actually be inserted at newIndex - 1 
T item = list[oldIndex];
list.RemoveAt(oldIndex);
newIndex = (newIndex > oldIndex ? newIndex - 1, newIndex)
list.Insert(newIndex, item); 
```

...可以解决问题，但是我在这台机器上没有 VS 可以检查。

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2009-01-16T12:22:29.283

最简单的方法：

```
list[newIndex] = list[oldIndex];
list.RemoveAt(oldIndex); 
```

**编辑**

这个问题不是很清楚......因为我们不关心`list[newIndex]`项目的去向，我认为最简单的方法如下（有或没有扩展方法）：

```
 public static void Move<T>(this List<T> list, int oldIndex, int newIndex)
    {
        T aux = list[newIndex];
        list[newIndex] = list[oldIndex];
        list[oldIndex] = aux;
    } 
```

此解决方案是最快的，因为它不涉及列表插入/删除。

* * *

## 回答 #9

> 赞同：-2
> 
> 时间：2016-06-26T23:46:33.853

更简单的人只是这样做

```
 public void MoveUp(object item,List Concepts){

        int ind = Concepts.IndexOf(item.ToString());

        if (ind != 0)
        {
            Concepts.RemoveAt(ind);
            Concepts.Insert(ind-1,item.ToString());
            obtenernombres();
            NotifyPropertyChanged("Concepts");
        }} 
```

对 MoveDown 执行相同操作，但更改 "if (ind !=Concepts.Count())" 的 if 和 Concepts.Insert(ind+1,item.ToString());

* * *

## 回答 #10

> 赞同：-3
> 
> 时间：2016-01-12T22:33:37.153

这就是我实现移动元素扩展方法的方式。它可以很好地处理元素的前后移动和极端移动。

```
public static void MoveElement<T>(this IList<T> list, int fromIndex, int toIndex)
{
  if (!fromIndex.InRange(0, list.Count - 1))
  {
    throw new ArgumentException("From index is invalid");
  }
  if (!toIndex.InRange(0, list.Count - 1))
  {
    throw new ArgumentException("To index is invalid");
  }

  if (fromIndex == toIndex) return;

  var element = list[fromIndex];

  if (fromIndex > toIndex)
  {
    list.RemoveAt(fromIndex);
    list.Insert(toIndex, element);
  }
  else
  {
    list.Insert(toIndex + 1, element);
    list.RemoveAt(fromIndex);
  }
} 
```

# c# - 划线还是不划线，这是个问题

> ID：450238
> 
> 赞同：154
> 
> 时间：2009-01-16T12:10:16.003
> 
> 标签：c#

如果二进制版本将被其他框架语言使用，那么在 C# 中不使用下划线前缀私有字段是否有任何问题？例如，由于 C# 区分大小写，您可以调用字段“foo”和公共属性“Foo”，它工作正常。

这会对不区分大小写的语言（例如 VB.NET）产生**任何影响，如果名称只能通过大小写来区分，是否会出现任何 CLS 合规性（或其他）问题？**

* * *

## 回答 #1

> 赞同：327
> 
> 时间：2013-07-30T02:22:34.070

**重要更新（2016 年 4 月 12 日）：**

引起我们注意的是，.NET CoreFX 团队的内部标准[坚持使用下划线表示法](https://github.com/dotnet/corefx/blob/368fdfd86ee3a3bf1bca2a6c339ee590f3d6505d/Documentation/coding-guidelines/coding-style.md)，而没有提供任何关于原因的见解。然而，如果我们仔细观察规则#3，就会发现有一个系统的`_`, `t_`,`s_`前缀表明了为什么`_`首先被选择。

> 3.  我们`_camelCase`用于内部和私有字段，并在可能的情况下使用只读。实例字段前缀为`_`，静态字段前缀为`s_`，线程静态字段前缀为`t_`。在静态字段上使用时，`readonly`应该放在后面`static`（即`static readonly`not `readonly static`）。
> 4.  我们避免`this.`，除非绝对必要。

因此**，如果您就像 .NET CoreFX 团队一样致力于一些性能关键、多线程、系统级代码**，那么强烈建议您：

*   遵守他们的编码标准和
*   使用下划线符号和
*   不再阅读此答案

**否则请继续阅读...**

**原始答案：**

让我们首先就我们正在谈论的内容达成一致。问题是如果可见性修饰符允许，我们如何从类/子类的非静态方法和构造函数中访问实例成员。

*下划线符号*

*   建议您在私有字段的名称中使用“_”前缀
*   它还说你不应该使用“this”，除非它是绝对必要的

*这个符号*

*   建议您始终使用“this”。访问任何实例成员

**为什么这个符号存在？**

因为这就是你的方式

*   当参数名称相同时，将参数与字段区分开来
*   确保您在当前实例的上下文中工作

例子

```
public class Demo
{
   private String name;
   public Demo(String name) {
       this.name = name;
   }
} 
```

**为什么存在下划线符号？**

有些人不喜欢输入“this”，但他们仍然需要一种区分字段和参数的方法，因此他们同意在字段前面使用“_”

例子

```
public class Demo
{
   private String _name;
   public Demo(String name) {
      _name = name;
   }
} 
```

有人可能认为这只是个人品味的问题，两种方式都同样好/坏。然而，在某些方面 this-notation 优于 underscore-notation：

**明晰**

*   下划线符号使名称混乱
*   这个符号保持名称完整

**认知负荷**

*   underscore-notation 不一致，它让你以特殊的方式对待字段，但你不能与其他成员一起使用，每次你需要问自己是否需要属性或字段

*   this-notation 是一致的，你不必思考，你只是总是用“this”来指代任何成员

**维护**

> 更新：正如所指出的，以下不是优势点
> 
> *   `_`下划线符号要求您在重构时密切关注，例如将字段转换为属性（删除`_`）或相反（添加`_`）
> *   这个符号没有这样的问题

**自动完成**

当您需要查看实例成员列表时：

*   下划线符号对您没有多大帮助，因为当您键入“_”时，自动完成弹出窗口会向您显示私有字段以及链接程序集中可用的所有类型以及其他实例成员
*   this-notation 给你一个明确的答案，通过输入“this”，你看到的只是成员列表，没有别的

**歧义**

有时您必须在没有 Intellisense 帮助的情况下处理代码。例如，当您进行代码审查或在线浏览源代码时。

*   下划线符号不明确：当您看到 Something.SomethingElse 时，您无法判断Something 是否是一个类而SomethingElse 是它的静态属性......或者Something 是一个当前实例属性，它具有自己的SomethingElse 属性

*   this-notation 很清楚：当您看到Something.SomethingElse 时，它​​只能表示具有静态属性的类，而当您看到this.Something.SomethingElse 时，您知道Something 是一个成员，而SomethingElse 是它的属性

**扩展方法**

如果不使用“this”，就不能在实例本身上使用扩展方法。

*   下划线表示法要求您不要使用“this”，但是对于扩展方法，您必须
*   this-notation 使您免于犹豫，您总是使用“this”，句号。

**视觉工作室支持**

*   下划线符号在 Visual Studio 中没有内置支持

*   Visual Studio 自然支持 this-notation：

    1.  [“这。” 资格](https://docs.microsoft.com/visualstudio/ide/editorconfig-language-conventions#this-and-me)：*在 C#**中优先使用非静态方法中使用的所有非静态字段`this.`*

**官方推荐**

有很多官方指南明确表示“不要使用下划线”，尤其是在 C# 中

*   **下划线符号**来自 C++，它是一种有助于避免命名冲突的一般做法，也建议 VisualBasic.Net 克服字段“值”和属性“值”实际上具有相同名称的问题，因为 VisualBasic不区分大小写

1.  [在 Visual Basic 中声明的元素名称](https://docs.microsoft.com/dotnet/visual-basic/programming-guide/language-features/declared-elements/declared-element-names)
2.  [VisualBasic.NET 中的支持字段](https://docs.microsoft.com/dotnet/visual-basic/programming-guide/language-features/procedures/auto-implemented-properties)

*   **建议 C# 使用this-notation**，而明确禁止使用“_”：

1.  [C# 中的 this 关键字](https://msdn.microsoft.com/en-us/library/dk1507sz%28v=vs.71%29.aspx)
2.  [字段使用指南](https://docs.microsoft.com/previous-versions/dotnet/netframework-1.1/ta31s3bc(v=vs.71))：*不要将前缀应用于字段名称或静态字段名称。*
3.  [名称准则： 类型成员的名称](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/ms229012(v=vs.100))：*不要为字段名称使用前缀。*
4.  [一般命名约定](https://docs.microsoft.com/dotnet/standard/design-guidelines/general-naming-conventions)：*X 不要使用下划线、连字符或任何其他非字母数字字符*
5.  [质量断言规则 CA1707](https://docs.microsoft.com/visualstudio/code-quality/ca1707)：*标识符不应包含下划线*
6.  [使用下划线不符合 CLS](https://docs.microsoft.com/dotnet/standard/language-independence-and-language-independent-components#naming)（对于公共和受保护的标识符）
7.  [.NET Framework 开发人员的内部命名约定](https://docs.microsoft.com/archive/blogs/brada/internal-coding-guidelines)：*不要为成员变量使用前缀。如果你想区分局部变量和成员变量，你应该使用“this”。在 C# 和“我”中。在 VB.NET 中。*

* * *

## 回答 #2

> 赞同：72
> 
> 时间：2009-01-16T13:36:13.363

取自 Microsoft StyleCop 帮助文件：

> **类型名称：** FieldNamesMustNotBeginWithUnderscore
> 
> **检查编号：** SA1309
> 
> **原因：** C# 中的字段名称以下划线开头。
> 
> **规则说明：**
> 
> 如果字段名称以下划线开头，则会违反此规则。
> 
> 默认情况下，StyleCop 不允许使用下划线、m_ 等来标记本地类字段，而支持“this”。字首。使用“this”的好处。是它同样适用于所有元素类型，包括方法、属性等，而不仅仅是字段，使得对类成员的所有调用都可以立即识别，无论使用哪个编辑器查看代码。另一个优点是它在实例成员和静态成员之间创建了一个快速、可识别的区别，它们不会加前缀。
> 
> 如果字段或变量名称旨在与与 Win32 或 COM 关联的项的名称匹配，因此需要以下划线开头，请将字段或变量放在特殊的 NativeMethods 类中。NativeMethods 类是包含以 NativeMethods 结尾的名称的任何类，旨在用作 Win32 或 COM 包装器的占位符。如果项目放置在 NativeMethods 类中，StyleCop 将忽略此违规。

不同的规则描述表明，除了上述之外，首选做法是以小写字母开头的私有字段，以及以大写字母开头的公共字段。

编辑：作为后续，StyleCop 的项目页面位于此处：[https](https://github.com/DotNetAnalyzers/StyleCopAnalyzers) ://github.com/DotNetAnalyzers/StyleCopAnalyzers 。通读帮助文件可以深入了解他们为什么建议各种风格规则。

* * *

## 回答 #3

> 赞同：50
> 
> 时间：2009-01-16T12:14:13.623

它不会有**任何**影响。

编写符合 CLS 的库的部分建议是不要有两个仅按大小写不同的公共/受保护实体，例如，您不**应该**有

```
public void foo() {...} 
```

和

```
public void Foo() {...} 
```

您所描述的不是问题，因为私人项目对图书馆的用户不可用

* * *

## 回答 #4

> 赞同：29
> 
> 时间：2009-01-16T12:29:03.640

由于我们谈论的是私有字段，因此它不会影响您班级的用户。

但我建议对私有字段使用下划线，因为它可以使代码更易于理解，例如：

```
private int foo;
public void SetFoo(int foo)
{
  // you have to prefix the private field with "this."
  this.foo = foo;

  // imagine there's lots of code here,
  // so you can't see the method signature

  // when reading the following code, you can't be sure what foo is
  // is it a private field, or a method-argument (or a local variable)??
  if (foo == x)
  {
    ..
  }
} 
```

在我们的团队中，我们总是为私有字段使用下划线前缀。因此，当阅读一些代码时，我可以很容易地识别私有字段并将它们与本地和参数区分开来。在某种程度上，下划线可以看作是“this”的简写形式。

* * *

## 回答 #5

> 赞同：19
> 
> 时间：2009-01-16T17:52:58.290

在一个有着非常具体和非常无意义的风格规则的环境中工作之后，我开始创造自己的风格。这是我经常来回翻转的一种类型。我最终决定私有字段总是_field，局部变量永远不会有_，并且是小写，控件的变量名将松散地遵循匈牙利符号，参数通常是驼峰式。

我讨厌这个`this.`关键字，我认为它只会增加太多的代码噪音。我喜欢 Resharper 的删除多余的这个。关键词。

**6 年更新：** 我正在分析`Dictionary<TKey,T>`并发访问的特定用法的内部结构，并将私有字段误读为局部变量。私有字段绝对不应该与局部变量使用相同的命名约定。如果有一个下划线，那将是非常明显的。

* * *

## 回答 #6

> 赞同：17
> 
> 时间：2009-01-16T19:00:47.030

我喜欢下划线，因为这样我可以使用小写名称作为方法参数，如下所示：

```
public class Person
{
    string _firstName;

    public MyClass(string firstName)
    {
        _firstName = firstName;
    }

    public string FirstName
    {
        get { return _firstName; }
    }
} 
```

* * *

## 回答 #7

> 赞同：10
> 
> 时间：2009-01-16T13:13:52.537

由于 Martin 提到的原因，我仍然非常喜欢在私有字段前使用下划线，也因为私有字段将在 IntelliSense 中一起排序。尽管匈牙利前缀符号通常是邪恶的。

然而，最近我发现对私人成员使用下划线前缀是不受欢迎的，即使我不太清楚为什么。也许别人知道？只是前缀原则吗？或者是否涉及泛型类型的名称修改，在编译的程序集中或其他东西中会出现下划线？

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2011-07-21T09:11:46.543

无论是否推荐 Style Cop，深入研究 .NET Framework 显示了成员变量的大量“_”用法。无论 Style Cop 的创建者推荐什么，大多数 MS 员工都不会使用它。:) 所以我会坚持使用下划线。因为我个人使用下划线比 this 犯的错误要少得多（例如：使用 varName = varName 而不是 this.varName = varName，它真的卡在我身上）

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2009-01-16T18:11:17.100

私有字段的 _fieldName 符号**很容易被破解**。使用“这个”。符号是不可能打破的。你将如何打破 _ 符号？观察：

```
private void MyMethod()
{
  int _myInt = 1; 
  return; 
} 
```

你去吧，我只是违反了你的命名约定，但它可以编译。我希望有一个命名约定，即 a) 不是匈牙利语和 b) 明确的。我赞成废除匈牙利命名，这在某种程度上是合格的。变量名前面不是对象的类型，而是它的访问级别。

将此与 Ruby 进行对比，其中变量`@my_number`的名称将名称与范围联系起来并且是牢不可破的。

编辑：这个答案是否定的。我不在乎，它还在。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2009-01-16T18:43:28.143

我认为总的来说，类级别的字段是语言设计中的一个错误。如果 C# 的属性有自己的本地范围，我会更喜欢它：

```
public int Foo
{
   private int foo;
   get
   {
      return foo;
   }
   set
   {
      foo = value;
   }
} 
```

这将使完全停止使用字段成为可能。

我唯一一次在私有字段前加上下划线是当一个属性需要一个单独的支持字段时。这也是我唯一一次*使用*私有字段。（而且由于我从不使用受保护的、内部的或公共的字段，这是我唯一一次使用字段期间。）就我而言，如果变量需要具有类范围，它是类的属性。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-01-16T12:45:30.253

当您希望您的程序集符合 CLS 时，您可以在您的程序集信息文件中使用 CLSCompliant 属性。当您的代码包含不符合 cls 的内容时，编译器会抱怨。

然后，当您有 2 个仅大小写不同的属性时，编译器将发出错误。另一方面，当你在同一个类中有一个私有字段和一个公共属性时，就不会有问题了。

（但是，我也总是在我的私有成员前面加上下划线。当我阅读我的代码时，它也有助于我清楚地知道某个变量是一个成员字段）。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2013-07-12T06:14:42.580

没有任何影响。编译代码时，对编译器来说重要的是字段/属性的命名空间和可见性。在命名标识符时，下划线与任何其他字符一样重要。真正的诀窍是使用您和您周围的人都会理解的约定。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2021-10-05T23:41:37.103

不强调。因为在视觉上它看起来太像空格，而不是文本。这会影响缩进的可读性，这是您理解代码控制流的方式。[而且它可能会不必要地触发您精心打磨的严重缩进代码检测器反射。]

现实世界的例子...

```
 {
            Region = Environment.GetEnvironmentVariable(Dimensions.Names.REGION);
            if (xyz)
            {
                InstanceId = Environment.GetEnvironmentVariable(Dimensions.Names.INSTANCEID);
                _rawData = (long)0; // Disabled by default
            }
            _additionalDimensions = new Dictionary<string, string>();
        } 
```

对比

```
 {
            Region = Environment.GetEnvironmentVariable(Dimensions.Names.REGION);
            if (xyz)
            {
                InstanceId = Environment.GetEnvironmentVariable(Dimensions.Names.INSTANCEID);
                rawData = (long)0; // Monitoring disabled by default
            }
            additionalDimensions = new Dictionary<string, string>();
        } 
```

* * *

## 回答 #14

> 赞同：-1
> 
> 时间：2009-01-16T18:00:51.567

我喜欢在私有字段前使用下划线有两个原因。已经提到了一个，这些字段从它们在代码和 Intellisense 中的相关属性中脱颖而出。第二个原因是无论我是用 VB 还是 C# 编码，我都可以使用相同的命名约定。

# python - 从 python 中执行命令行程序

> ID：450285
> 
> 赞同：330
> 
> 时间：2009-01-16T12:30:43.560
> 
> 标签：python, command-line

我正在构建一个 Web 应用程序，它将处理（填充、混合、合并等）声音文件，我发现[sox](http://sox.sourceforge.net/)完全符合我的要求。Sox 是一个 linux 命令行程序，我对让 python web 应用程序根据每个请求在我的服务器上启动新的 sox 进程感到有点不舒服。

例子：

```
import os
os.system('sox input.wav -b 24 output.aiff rate -v -L -b 90 48k') 
```

整个设置对我来说似乎有点不稳定。

所以我的问题是，从 python（或任何脚本语言）网络应用程序中运行命令行程序的最佳实践是什么？

为了绕过整个请求响应周期，消息队列将是一回事。但是还有其他方法可以让这些东西更优雅吗？

* * *

## 回答 #1

> 赞同：315
> 
> 时间：2009-01-16T12:48:08.453

该[`subprocess`](http://docs.python.org/library/subprocess.html)模块是从 Python 运行其他程序的首选方式——比`os.system`.

```
import subprocess
#subprocess.check_output(['ls', '-l'])  # All that is technically needed...
print(subprocess.check_output(['ls', '-l'])) 
```

* * *

## 回答 #2

> 赞同：28
> 
> 时间：2009-01-16T12:58:17.870

> 整个设置对我来说似乎有点不稳定。

与[ffmpegx](http://homepage.mac.com/major4/)人员讨论在命令行后端上使用[GUI](https://en.wikipedia.org/wiki/Graphical_user_interface)前端。这似乎并不打扰他们。

事实上，我认为[GUI](https://en.wikipedia.org/wiki/Graphical_user_interface)（或 Web）前端比命令行后端更稳定，因为您在[GUI](https://en.wikipedia.org/wiki/Graphical_user_interface)和命令之间有一个非常非常干净的界面。该命令可以以与 Web 不同的速度发展，只要命令行选项兼容，就没有损坏的可能性。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-16T18:11:19.113

如果您担心服务器性能，请考虑限制正在运行的 sox 进程的数量。如果达到上限，您始终可以缓存请求并在完成时以适合您应用程序的任何方式通知用户。

或者，在其他机器上使用 n 个工作脚本从数据库中提取请求并调用 sox，然后将生成的输出文件推送到需要的位置。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-16T12:36:32.843

我对 sox 不熟悉，但不是将程序作为命令行反复调用，是否可以将其设置为服务并连接到它以获取请求？大家可以看一下[sqlite](http://docs.python.org/library/sqlite3.html#sqlite3.Connection)等连接界面，找找灵感。

# python - 蟒蛇路径

> ID：450290
> 
> 赞同：2
> 
> 时间：2009-01-16T12:33:20.120
> 
> 标签：python

我正在安装活动的 python，django。我真的不知道如何在 vista 环境系统中设置 python 路径。首先它会在vista中工作。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-05-14T14:54:43.773

# 临时变更

要临时更改 python 路径（即，对于一个交互式会话），只需`sys.path`像这样追加：

```
>>> import sys
>>> sys.path
['',
 'C:\\Program Files\\PyScripter\\Lib\\rpyc.zip',
 'C:\\Windows\\system32\\python27.zip',
 'C:\\Python27\\DLLs',
 'C:\\Python27\\lib',
 'C:\\Python27\\lib\\plat-win',
 'C:\\Python27\\lib\\lib-tk',
 'C:\\Python27',
 'C:\\Python27\\lib\\site-packages']
>>> sys.path.append(directory_to_be_added) 
```

# 永久（或多或少）变化

去`Computer -> System Properties (Either by the big button near the title bar or in the context-menu by right-clicking) -> Advanced Settings (in the right-hand nav bar) -> Environment Variables`。在 中`System Variables`，添加一个名为的变量`PYTHONPATH`（如果它不存在，即，如果您之前没有这样做过）或编辑现有变量。

You should enter the directories normally (take care to use backslashes, not the normal ones) separated by a semicolon (`;`) w/o a space. Be careful not to end with a semicolon.

The directories that you just entered now will be *added* to `sys.path` whenever you open a interpreter, they won't replace it. Also, the changes will take place only after you've restarted the interpreter.

* * *

^(Source: [http://greeennotebook.com/2010/06/how-to-change-pythonpath-in-windows-and-ubuntu/](http://greeennotebook.com/2010/06/how-to-change-pythonpath-in-windows-and-ubuntu/))

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-16T12:37:56.507

也许这会有所帮助：它是[在 Windows Vista 中安装 Python 的指南](http://www.neuralwiki.org/index.php?title=Guide_to_installing_Python_in_Windows_Vista)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-16T14:28:41.933

请记住，除了`PYTHONPATH`在系统环境中设置之外，您还需要分配`DJANGO_SETTINGS_MODULE`.

# gwt - 按 T ab 键时 GWT 标签小部件接收焦点

> ID：450292
> 
> 赞同：2
> 
> 时间：2009-01-16T12:34:18.123
> 
> 标签：gwt, widget

当前解决方案：

*   用户单击标签，并使用文本区域切换以允许编辑
*   用户可以使用 tab / enter 离开编辑，并且 textarea 被切换回标签

问题是用户必须用鼠标点击标签才能进入编辑模式。当用户单击 TAB 键并且标签是下一个小部件时，我希望标签接收 onFocus 事件。

可能的解决方案（但尚未尝试）从 Label 小部件继承新小部件并实现 TabListener 接口。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-16T13:03:13.633

有一个面板叫做焦点面板。该面板允许通常不接收诸如键盘事件之类的事件的小部件（例如，标签为一）具有事件。

[在此处查看](http://google-web-toolkit.googlecode.com/svn/javadoc/1.5/com/google/gwt/user/client/ui/FocusPanel.html)文档

# python - 从 wx.TextCtrl 中删除行

> ID：450306
> 
> 赞同：3
> 
> 时间：2009-01-16T12:38:18.660
> 
> 标签：python, wxpython, wx.textctrl

我正在使用 wx.TextCtrl 从网络守护程序输出文本。
由于输出非常冗长，TextCtrl 中的文本大小可能会变得很大（顺便说一句，TextCtrl 内容的大小是否有任何限制？）
我想在 TextCtrl.GetNumberOfLines 时从 TextCtrl 中删除前 N 行() 超过预定义的阈值。实现这一目标的最佳方法是什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-16T12:44:11.957

SetMaxLength[参考](http://docs.wxwidgets.org/2.6/wx_wxtextctrl.html#wxtextctrlsetmaxlength)说限制取决于底层的本机文本控件，但至少应为 32KB。

关于删除前 N 行，您可以尝试调用[GetLineLength](http://docs.wxwidgets.org/2.6/wx_wxtextctrl.html#wxtextctrlgetlinelength)为 0..N-1，计算总和 S，然后调用[Remove](http://docs.wxwidgets.org/2.6/wx_wxtextctrl.html#wxtextctrlremove) (0,S)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-16T12:43:31.643

wx.TextCtrl 的 Remove 方法怎么样？

每当您要添加新文本时，您可以检查当前文本是否显得太长并从一开始就删除一些。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-16T12:46:25.493

Remove() 应该可以解决问题。

没有 wx.TE_RICH 标志的 TextCtrl 在 Windows 上不能超过 64 KB。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2016-08-08T07:02:59.943

您应该能够使用[`wx.TextCtrl.PositionToXY()`](https://wxpython.org/Phoenix/docs/html/wx.TextCtrl.html#wx.TextCtrl.PositionToXY)和[`wx.TextCtrl.XYToPosition()`](https://wxpython.org/Phoenix/docs/html/wx.TextCtrl.html#wx.TextCtrl.XYToPosition)转换位置（从开始以字符为单位）与一`(column, line_num)`对。

因此，您可以使用`i = wx.TextCtrl.XYToPosition(0, n)`获取`i`特定行*n*的位置（或*n+1*，具体取决于您如何从 0 或 1 开始计算它们），然后调用[`wx.TextCtrl.Remove(0, i)`](https://wxpython.org/Phoenix/docs/html/wx.TextEntry.html#wx.TextEntry.Remove)以删除前*n*行。

# actionscript - 谷歌地图如何制作全景图？

> ID：450307
> 
> 赞同：4
> 
> 时间：2009-01-16T12:39:44.710
> 
> 标签：actionscript, texture-mapping, google-street-view, panoramas, 3d-engine

谷歌地图如何在[街景中制作全景图？](http://maps.google.com/help/maps/streetview/)

是的，我知道它的 Flash，但是它们如何使用[正确的纹理映射来倾斜位图？](http://en.wikipedia.org/wiki/Texture_(computer_graphics)#Perspective_correctness)

[他们是否像大多数Flash 3D 引擎](http://www.noirmatstudios.com/blog/index.php/2008/06/18/3d-engines-for-flash/)一样在像素级别上进行操作？，或者只是对影片剪辑中的位图应用一些棘手的转换？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-16T12:53:51.733

[**Flash Panorama Player**](http://flashpanoramas.com/player/)可以帮助实现类似的效果！

它使用[6 个 equirectangular 图像](http://flashpanoramas.com/player/simple)（立方体面）与一些“魔法”ActionScript**无缝拼接在一起。**

另请参阅 flashpanos.com 的这些部分以获取[插件](http://www.flashpanos.com/category/page/plugin-flash-panorama-player)，以及[带有（可能）文档的教程。](http://www.flashpanos.com/category/page/tutorial-flash-panorama-player)

拍摄全景图的[快速指南，](http://flashpanoramas.com/forum/showthread.php?p=11311#post11311)以便您可以使用 FPP（Flash 全景播放器）查看它们。

> **立方投影**立方体面实际上是 90x90 度的直线图像，就像您从普通相机镜头获得的图像一样。~[什么是 VR 摄影？](http://www.panoramas.dk/panorama/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-16T14:28:01.467

查看[http://www.panoguide.com/](http://www.panoguide.com/)。他们有howtos，软件链接等。

在这个过程中基本上有两个组件：拼接软件，它从许多单独的图像源创建一张全景照片，然后是全景查看器，当你改变你的 POV 时它会扭曲图像，以模拟你的眼睛会看到的东西。实际上在那里。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-16T15:54:00.950

我的公司使用[Papervision3D](http://papervision3d.org)闪存渲染引擎，并将全景图像（静止图像*或*视频）映射到 3D 球体上。我们发现，与在立方体的六个面上映射相同图像相比，使用沿两个轴具有大约 25 个分区的球形物体可以提供更好的视觉效果。[在http://www.panocast.com](http://www.panocast.com)上亲自检查一下。

实际上，你当然可以提前扭曲你的图像，这样当它映射到立方体的面上时，它的透视就恰到好处，但这需要完全重新渲染你的图像。

借助一些额外的“魔法”，我们还可以根据用户的观看位置和缩放级别（与 Google 街景不同），根据需要逐步加载静止图像。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-21T02:32:39.997

就 Google 实际所做的而言，Bork 有这个权利。我不确定确切的细节（并且不确定我是否可以发布细节，即使我这样做了），但谷歌将各个 360 度街景场景存储在[等距矩形表示](http://en.wikipedia.org/wiki/Plate_carr%C3%A9e_projection)中以供服务。Flash 播放器然后使用一系列[仿射变换](http://en.wikipedia.org/wiki/Affine_transformation)以透视方式显示图像。仿射变换是近似的，但足以聚合成整体上不错的图像。

服务图像的计算非常复杂，因为必须完成图像处理的许多阶段，例如去除人脸、解释绽放等。在实际拼接全景图方面，有很多算法可以解决这个问题（[维基百科文章](http://en.wikipedia.org/wiki/Image_stitching)）。不过，我想指出一件有趣的事情，作为值得深思的地方，在街景的 360 度全景图中，您可以看到图像底部的道路，汽车上没有摄像头。现在是缝合。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-21T02:55:26.393

[昂贵的相机。](http://www.popularmechanics.com/technology/industry/4232286.html)制作 [360 度视频](http://demos.immersivemedia.com/fvdemo_1/data/CylindricalFlashPlayerDemoSite/PopularMechanicsNYCDriveAlong/PopularMechanicsNYCDriveAlong.php)

观看允许向各个方向平移的视频非常令人印象深刻......这就是街景在没有带宽来支持完整视频的情况下。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-01-26T07:28:19.113

对于那些想知道 Google VR 摄影师和编辑如何为他们的 Equirectangular 全景图添加地面的人，请查看名为 Viewpoint Correction 的功能，如 PTGui 等软件中所见：

ptgui.com/excamples/vptutorial.html

（请注意，这不是 Google 使用的软件）

如果您在街景中仔细观察地面，您会发现缝合线似乎拉长了，有时甚至会与当前视图旁边的视点信息重叠。（我的意思是你可以在一个地方看到一些东西，然后突然在下一个地方显示相同的特征作为地面，揭示了用于地面缝合的技术）。

# php - 跟踪用户推荐（PHP / MySQL）

> ID：450314
> 
> 赞同：2
> 
> 时间：2009-01-16T12:43:22.830
> 
> 标签：php, mysql, cookies

问候，

是否有任何脚本可以跟踪用户推荐并在被推荐的用户上设置 cookie，这样每当他们离开网站并返回时，它仍然会被视为由人推荐。

谢谢。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-16T12:51:44.063

```
//To set the cookie
if($refered)
 {
    setcookie('sitenameReferal', 'REFERER');
 }
//To retrieve it
if($_COOKIE['sitenameReferal'])
 {
    $referedBy = $_COOKIE['sitenameReferal'];
 } 
```

这很简单。

# html - html元素忽略CSS左+右属性？

> ID：450316
> 
> 赞同：23
> 
> 时间：2009-01-16T12:43:32.067
> 
> 标签：html, css, input, positioning

我注意到`<input>`HTML 中的元素忽略了 CSS 对“left”和“right”属性。对“顶部”和“底部”也是如此。请参阅下面的示例代码：

```
<html>
    <head>
        <style><!--
        #someid {
            position: absolute;
            left: 10px;
            right: 10px;
            top: 10px;
            bottom: 10px;
        }
        --></style>
    </head>
    <body>
        <input type="text" id="someid" value="something"/>
    </body>
</html> 
```

应该占据浏览器中的`<input>`几乎所有空间（除了它周围的 10px 边框）。它在 Safari 中运行良好，但在 FireFox 和 IE 中，它`<input>`在浏览器的左上角仍然很小。

如果我使用“left”和“width”，以及“top”和“height”，那么一切正常。但是我不知道宽度和高度是多少，我希望它们根据浏览器窗口的大小进行调整。

任何想法如何解决这个问题？

谢谢。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-01-16T13:24:18.723

您可以使用包装器 DIV

```
 <html> 
            <head> 
                    <style><!-- 
                #wrapper { 
                    position: absolute; 
                    left: 10px; 
                    right: 10px; 
                    top: 10px; 
                    bottom: 10px; 
                } 
                #someid { 
                  /*  position:relative;  EDIT: see comments*/
                    height:100%; 
                    width:100% 
                }
    --></style>
                </head>
            <body>
              <div id="wrapper">
              <input type="text" id="someid" value="something"/>
              </div>
           </body>
       </html> 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-16T13:02:44.307

它没有忽略左侧或顶部，您会看到它确实定位了 10px。正在发生的事情是权利和底部没有得到尊重。表单元素在布局引擎中被特别对待，FF/IE 完全有可能认为输入的宽度/最大长度更重要，我还没有真正研究过为什么会这样。

不过，这有点奇怪。也许你最好看看`<textarea>`哪个旨在提供大文本输入，你可以通过应用`width: 100%; height: 100%;`和处理容器 div 上的 10px 边距来将其推到 100% 尺寸。

* * *

WFM：

```
<html>
<head>
    <style>
    body
    {
        margin: 0px;
    }
    div
    {
        position: absolute; margin: 2%; width: 96%; height: 96%;
    }
    textarea
    {
        position: absolute; width: 100%; height: 100%; 
    }
    </style>
</head>
<body>
    <div>
        <textarea></textarea>
    </div>
</body> 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-16T13:27:20.853

[http://reference.sitepoint.com/css/bottom](http://reference.sitepoint.com/css/bottom) 说，关于 Internet Explorer (<= 6)

> 不支持同时使用 top、right、bottom 和 left 来指定绝对定位元素的位置和尺寸；他们将使用指定的最后一个垂直和水平位置，并且需要使用宽度和高度来指定尺寸

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-07-25T07:51:26.747

它在 Safari 中的显示方式不是它应该显示的方式。因为您没有指定高度值，所以`input`将默认为最后继承的字体大小。

右侧和底部定位也将被忽略，因为您试图同时设置顶部和左侧边距。看起来他们在这种情况下优先。

如果您需要使用该`input`字段并在看到它时让它显示在浏览器窗口的整个宽度和高度内，您需要像这样重做 CSS：

```
body{
    margin:10px;
}

#someid{
    display:block;
    margin:0 auto;
    width:100%;
    height:100%;
} 
```

这会将`input`字段拉伸到用户浏览器窗口的高度和宽度。它也将在浏览器窗口的每一侧有 10 个像素的边距。

如果你必须有一个边距，那么`body`在输入字段周围的样式或包装器 DIV 中设置它。

# unicode - Outlook 07 中的日语编码主题

> ID：450328
> 
> 赞同：0
> 
> 时间：2009-01-16T12:47:47.283
> 
> 标签：unicode, encoding, outlook, office-2007

我正在尝试阅读和处理日语电子邮件。我已在 XP 控制面板中将区域和语言选项设置为东亚和非 Unicode 语言。我必须处理 .pst 文件并保留真正的元数据，并且我在主题行以及有时 to: 和 cc: 字段方面遇到问题。我让我的消息正文显示日语很好，但随后我在主题中出现乱码，如下所示

```
CC FIELD: cc. ￨ﾨﾈ￧ﾔﾻ￣ﾀﾀ￦ﾝﾉ￥ﾱﾱ￦ﾙﾺ￦ﾁﾒ

SUBJECT FIELD: Re: ä¸‰è±ï¼¬ï¼£ï¼¤æ’¤é€€ã«é–¢ã™ã‚‹æƒ…å ±åŠã³åŒ—ç±³æ¶²æ™¶çŠ¶æ³

MESSAGE BODY: 佐藤さんへ：情報ありがとうございます。この機に是非とも三菱パークをリプレースしたいものです。ところでこのシニアマネージャーはどうされたのですか？内も苦しいですが。

中村マネージャー：ＡＤＩはＣＰＴへ売却打診中とのこと。うーん。 
```

我不是程序员，所以请简化您对如何修复主题行的任何建议。仅供参考，我使用的是 Outlook 07 Pro、Windows XP Pro 和 .pst 文件，因此它们是通过以下方式打开的：文件-->打开 Outlook 数据文件。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-16T12:57:37.140

最有可能的是，标题行包含以 ISO-2022-JP 编码的日文字符，但未指定，即 PST 文件中包含的电子邮件违反了规范。您可以通过在 Outlook 设置中手动指定编码来解决此问题 - 我没有 Outlook，所以我无法告诉您具体在哪里查看。如果 Outlook 没有该选项，那么您将非常烦恼 - 您必须找到日语版的 Outlook，或者可以读取 PST 文件并允许您手动设置编码的第三方应用程序。

# f# - F# 关键字“一些”

> ID：450335
> 
> 赞同：42
> 
> 时间：2009-01-16T12:51:55.420
> 
> 标签：f#, keyword

F# 关键字 ' **Some** ' - 这是什么意思？

* * *

## 回答 #1

> 赞同：51
> 
> 时间：2009-01-16T12:56:15.020

`Some`不是关键字。然而，有一种`option`类型，它是一个包含两件事的有区别的联合：

1.  `Some`它拥有某种类型的值。
2.  `None`这代表缺乏价值。

它定义为：

```
type 'a option =
    | None
    | Some of 'a 
```

它的行为有点像可空类型，您希望拥有一个可以保存某种类型的值或根本没有值的对象。

```
let stringRepresentationOfSomeObject (x : 'a option) =
    match x with
    | None -> "NONE!"
    | Some(t) -> t.ToString() 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-01-16T13:48:03.807

可以查看[F# 中的区分](http://lorgonblog.spaces.live.com/blog/cns!701679AD17B6D310!172.entry)联合，以获取有关 DU 的更多信息，特别是选项类型（一些，无）。正如前面的回答所说， Some 只是 option<'a> 类型的联合情况，这是代数数据类型的一个特别常见/有用的例子。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2017-08-11T19:20:46.920

`Some`用于指定选项类型，或者换句话说，可能存在也可能不存在的类型。

F# 与大多数语言的不同之处在于，控制流主要通过模式匹配完成，而不是传统的 if/else 逻辑。

在传统的 if/else 逻辑中，您可能会看到如下内容：

```
if (isNull(x)) {
   do ...  
} else {         //x exists
   do ...  
} 
```

使用模式匹配逻辑，如果值为 null 或在 F# 语法中，匹配我们需要类似的方式来执行某些代码，`None`

因此我们将有相同的代码

```
match x with 
  | None -> do ...
  | Some x -> do ... 
```

# silverlight - Silverlight 和混淆

> ID：450341
> 
> 赞同：10
> 
> 时间：2009-01-16T12:55:08.547
> 
> 标签：silverlight, obfuscation

我对 silverlight 很陌生，我真的觉得它很酷。我有一个关于它如何在客户端运行代码的问题。

例如，我有一个网站根据用户输入的金额计算一定的金额。这当然我很乐意做客户端。但问题在于，用于计算的公式是专有的并且是商业机密。如果我使用 SL 将这个公式放在客户端，它会安全吗？或者可以反映吗？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-01-16T13:09:22.247

如果您想对算法保密，请不要将其推送到客户端。任何形式的混淆或保护都不是完美的。

此外，当您在客户端进行计算时，您应该**始终**检查服务器上的结果，而不是仅仅假设它们是正确的。**假设客户端受到攻击。**

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-16T18:52:38.323

Silverlight 将 XAP 文件推送到客户端。XAP 文件只是一个包含 .NET 程序集的 zip 文件，然后可以将其解压缩并反映到该文件中。我工作的公司（PreEmptive Solutions）销售 Dotfuscator，它可以混淆 Silverlight 程序集。现在您必须解压缩 xap、混淆并重新压缩它们，但我们正在努力改进工作流程。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-28T09:05:22.160

请注意 Dotfuscator 用户：如果创建 Dotfuscator 项目，则必须使用“设置”选项卡中的“用户定义的程序集加载路径”属性浏览到 Silverlight 库。您需要的路径是：

1.  \Program Files\Microsoft SDKs\Silverlight\v2.0\Reference Assemblies
2.  \Program Files\Microsoft SDKs\Silverlight\v2.0\Libraries\Client

    或在 64 位操作系统上：

3.  \Program Files (x86)\Microsoft SDKs\Silverlight\v2.0\Reference Assemblies

4.  \Program Files (x86)\Microsoft SDKs\Silverlight\v2.0\Libraries\Client

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-11-03T18:59:57.743

IntelliLock 和 .NET Reactor（我的首选工具）很好地混淆了我的程序集。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-28T14:01:25.007

我必须完全同意马库斯的观点。对于优秀的程序员来说，即使是晦涩难懂的 .NET 程序集也很容易阅读。

我的解决方案是使用 WCF 服务进行计算。只需将所有数据推送到那里并给出答案。如果您的公式是最高机密且不明显（例如*x+b* y+c*z），那么即使有人会获得服务，那么他也很难获得它。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-28T14:33:42.370

不要陷入认为隐藏算法会保护它的陷阱。一旦你把它放到网上，不管你做什么，都会有人知道的。有了足够的样本数据，任何具有一定数学技能的人都应该能够弄清楚你的算法。

你所能做的就是让它变得更难。如果此算法是您购买的专有软件，那么它将需要在服务器端。将算法放在客户端本质上就是发布它，你可能要承担责任。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2010-06-25T01:02:35.533

另一个很酷的工具是 CodeFort。它有免费版。[在http://www.codefort.org](http://www.codefort.org)上查看它的实际应用

CodeFort .NET 和 Silverlight 混淆器

CodeFort 是用于 Microsoft .NET 和 Silverlight 应用程序的高级混淆器和保护工具。

BAML 和 XAML 混淆器 - 混淆 100% 的代码

CodeFort 是第一个能够在 Silverlight 和 WPF 应用程序中使用的 XAML 和 BAML 代码中混淆标识符的工具。这使得第一次可以混淆 100% 的代码。

针对攻击者的强大保护

将 XAML/BAML 混淆与强大的保护功能（如参考加扰和防篡改 CodeFort）相结合，是一种最先进的混淆工具。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-11-05T09:55:13.443

虽然混淆不是一种万无一失的方法，但它会让别人更难看到你的代码。如果混淆层很好的话，一个人必须真正跳过令人费解的圈子才能得到最终的代码。[Crypto Obfuscator](http://www.ssware.com/cryptoobfuscator/obfuscator-net.htm)是一种支持对 Silverlight 程序集进行混淆的混淆器。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-04-03T13:55:36.790

有许多公司支持混淆 Silverlight 2.0 应用程序。DeepSea Obfuscator 具有很好的集成体验，Dotfuscator 也可以工作，而且很快，免费的 Eazfuscator 也将支持它。

# visual-studio - 如何使用 Visual Studio 的内置自动化测试对文件写入方法进行单元测试？

> ID：450350
> 
> 赞同：5
> 
> 时间：2009-01-16T12:59:11.987
> 
> 标签：visual-studio, visual-studio-2008, unit-testing, mocking, automated-tests

1.  我使用 Visual Studio 2008 Professional 自动化测试。我有一个写入文件的函数。我想对文件写入功能进行单元测试。我在某处读到我必须以某种方式模拟文件。我不知道该怎么做。你能帮我吗？

2.  如何对从 Internet 下载页面的方法进行单元测试？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-16T13:02:22.637

如果该方法必须自己打开文件流，那么这很难模拟。但是，如果您可以将流传递给方法，并使其写入该方法，那么您可以传入 MemoryStream 代替。另一种重载可以采用更少的参数，打开文件并将 FileStream 传递给另一个方法。

这样您就不会获得完整的覆盖率（除非您编写一两个测试确实会影响磁盘），但您的大部分逻辑都在经过全面测试的代码中，在采用 Stream 参数的方法中。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-01-16T13:03:20.387

这取决于您的代码与具体细节的接近程度；例如，您可以改为在`Stream`s 中工作，并将 a 传递`MemoryStream`给代码（并检查内容）。您可以只写入文件系统（在临时区域中），检查内容并在之后放弃它。如果您的代码略高于文件系统，您可以`IFileSystem`使用您需要的高级方法（如`WriteAllBytes`/ `WriteAllText`）编写一个可模拟的接口。不过，模拟流式 API 会很痛苦。

对于从互联网下载（或假装）......您可以（例如）编写一个`IWebClient`包含您需要的功能（如`DownloadString`等）的界面；模拟它以返回固定内容，并使用类似的东西`WebClient`作为实际实现的基础。当然，您需要针对真实站点测试实际实现。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-16T13:09:53.917

如果您的测试目标是测试文件是否实际创建，则它是集成测试，而不是单元测试。

如果目标是测试是否将正确的内容写入文件，则将文件访问隐藏在接口后面，并提供内存实现。

网页访问也是如此。

```
interface IFileService
{
     Stream CreateFile(string filename); 
}

class InMemoryFileService : IFileService
{
    private Dictionary<string, MemoryStream> files = new Dictionary<string, MemoryStream>();

    public Stream CreateFile(string filename)
    {
       MemoryStream stream = new MemoryStream();
       files.Add(filename, stream);
       return stream;
    }

    public MemoryStream GetFile(string filename)
    {
         return files[filename];
    }
} 
```

使用 GetFile，您可以找到应该写入磁盘的内容。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-16T13:03:24.553

您实际上并不想调用直接在函数中写入文件，而是将文件 I/O 包装在具有接口的类中。

然后，您可以使用 Rhino Mocks 之类的东西来创建一个实现接口的模拟类。

# zend-framework - 使用上传图片时总是出现此错误 - 使用 Zend Framework

> ID：450352
> 
> 赞同：0
> 
> 时间：2009-01-16T13:01:47.723
> 
> 标签：zend-framework

```
Warning: include_once(Zend/Http/Client.php) [function.include-once]: failed to open stream: No such file or directory in /home/hotbuzz/public_html/include/Zend/Loader.php on line 83

Warning: include_once() [function.include]: Failed opening 'Zend/Http/Client.php' for inclusion (include_path='/home/hotbuzz/public_html/include;.:/usr/lib/php:/usr/local/lib/php') in /home/hotbuzz/public_html/include/Zend/Loader.php on line 83

    Warning: require_once(Zend/Exception.php) [function.require-once]: failed to open stream: No such file or directory in /home/hotbuzz/public_html/include/Zend/Loader.php on line 87

    Fatal error: require_once() [function.require]: Failed opening required 'Zend/Exception.php' (include_path='/home/hotbuzz/public_html/include;.:/usr/lib/php:/usr/local/lib/php') in /home/hotbuzz/public_html/include/Zend/Loader.php on line 87 
```

当我在脚本中使用图像上传时总是会出现这个错误。我正在使用 Zend 框架。我不知道该怎么办？

我的 Zend 路径：public_html/include/zend phpinfo：hotbuzz.in/phpinfo.php

我没有在 .htaccess 中配置 Zend 的路径

?

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-13T02:21:37.300

尝试这个

```
set_include_path(dirname(realpath(__FILE__)).PATH_SEPARATOR.get_include_path()); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-16T13:18:57.347

您的包含路径是指向库文件还是只是 Zend 项目的根目录。包含路径需要指向包含目录结构的目录

*   曾德
    *   亚克力
    *   认证
    *   ETC...

这可能是您下载的文件的库目录。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-16T13:17:20.530

您的包含路径中有一些奇怪的东西;.:

我想你可能已经在 linux 服务器中使用了 windows 的语法。

您应该使用 PATH_SEPARATOR 以确保您在每台服务器上都有正确的。

# .net - ASP.NET MVC AJAX 文档在哪里？

> ID：450367
> 
> 赞同：5
> 
> 时间：2009-01-16T13:12:20.120
> 
> 标签：.net, asp.net-mvc, ajax, asp.net-ajax

有谁知道在哪里可以找到 ASP.NET MVC Framework Beta 中使用的 AJAX 的在线文档？我似乎找不到它。我一直在寻找一些信息的[快速入门](http://quickstarts.asp.net/previews/mvc/mvc_AddingAjaxScriptsWalkthrough.htm)并在谷歌上搜索，但似乎很难找到。

它现在似乎有点有限。人们是使用它还是将它与其他 AJAX 框架（如[script.aculo.us](http://script.aculo.us/) ）结合使用？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-16T13:13:33.223

使用 MVC，jQuery 将是首选 (IMO)。这[在 VS2008 中具有智能感知功能](http://weblogs.asp.net/scottgu/archive/2008/11/21/jquery-intellisense-in-vs-2008.aspx)，并且使用非常广泛，因此很容易获取示例，并且[文档记录得很好](http://docs.jquery.com/)。

你也可能对此有兴趣：

*   [jQuery 在行动](http://www.manning.com/bibeault/)
*   [ASP.NET MVC 在行动](http://www.manning.com/palermo/)

# c# - C# 和 .NET 中的数据绑定

> ID：450373
> 
> 赞同：11
> 
> 时间：2009-01-16T13:14:37.527
> 
> 标签：c#, .net, winforms, visual-studio-2008, data-binding

我对 C# 和 .NET 还很陌生，我对数据绑定的整个概念有点挣扎。我要的是对这个概念的快速概述，或者更好的是，将我指向网络上的资源（首选）或印刷品，这可以帮助我理解这个想法。

编辑：

我在 vs2008 中进行开发，我们正在使用 winforms

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-01-16T13:19:51.133

那么，您使用的是什么架构？表格？ASP.NET? wpf?

高*层次*是，如果您有以下对象：

```
public class Person {
    public string Name {get;set;}
    public DateTime DateOfBirth {get;set;}
} 
```

然后你可以让绑定框架来做所有艰苦的工作，你只要说出你想要绑定的东西——例如（winforms）：

```
txtName.DataBindings.Add("Text", person, "Name"); 
```

这会根据人的姓名设置文本框的 Text 属性，并且可以在用户更改文本时更新人的姓名。

多记录绑定比较复杂，基于`IList`winforms/wpf，`IEunmerable`ASP.NET；这允许您绑定多个记录（例如到网格中）。如果该列表提供额外的功能（排序、过滤等，通过`IBindingList`、`IBindingListView`等），那么可能会提供更多功能。

绑定还允许“观察者”使用 - 即更改通知：如果您间接更改人员的姓名，则文本框会自动更新。这依赖于事件 - 形式`public event EventHandler NameChanged;`，或者（现在更常见）通过`INotifyPropertyChanged`事件（允许一个事件通知多个属性）。

某些列表（例如`BindingList<T>`, `DataView`）具有类似的通知循环。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-16T13:21:15.530

数据绑定的概念非常简单；它允许您将对象中包含的数据“绑定”到可视控件。该控件“显示”您的数据。当用户更改控件显示的值时，更改会自动保存到基础对象。反之亦然，当有人更改对象中的数据时，控件可以显示最新的值。

[http://msdn.microsoft.com/en-us/library/ms752347.aspx](http://msdn.microsoft.com/en-us/library/ms752347.aspx) [http://www.akadia.com/services/dotnet_databinding.html](http://www.akadia.com/services/dotnet_databinding.html)

# .net - 将 WinForms 应用程序升级到 WPF

> ID：450377
> 
> 赞同：15
> 
> 时间：2009-01-16T13:16:49.783
> 
> 标签：.net, wpf, winforms, visual-studio-2008, upgrade

我有一个几年前在 WinForms 中编写的副项目。为了更好地帮助我学习 WPF，我想用 WPF 重写它。理想情况下，我只想修改我拥有的当前项目并在 WPF 中重写 UI，而不是创建一个新项目。

我在这样做时遇到了一些问题。我做了以下（使用 Visual Studio 2008 SP1）：

1.  将目标框架从 2.0 更改为 3.5。
2.  添加了 PresentationCore、PresentationFramework 和 WindowsBase 引用。

在这一点上，我注意到有些不对劲。当我右键单击项目并选择添加 | 新项目，我没有创建 WPF 窗口的选项 - 我可以创建的唯一 WPF 类是 WPF 用户控件。由于我周围有其他一些 WPF 项目，因此我将 App.xaml.* 和 Window1.xaml.* 从该项目复制到我的项目中，并根据需要对其进行了更新（基本上只是将该项目的名称空间更改为我的项目的名称空间）。

然后我删除了 Program.cs（之前包含 Main 方法，它显示了主 WinForm 窗体），并构建了项目。我收到一个错误，表明没有 Main 方法。

似乎在内部 Visual Studio 知道该项目实际上是一个 WinForms 应用程序，而不是 WPF 应用程序。在 WPF 项目中（通过选择“WPF 应用程序”创建），在应用程序属性中，我可以将应用程序类的实例设置为启动对象。在我的 WinForms 转换项目中，这不是一个选项。

我在文本编辑器中快速查看了 .csproj 文件，但找不到任何可以告诉 Visual Studio 该项目实际上是 WinForms 而不是 WPF 的东西。

我还需要做什么才能将我的 WinForms 项目变成“真正的”WPF 项目？除了创建一个新项目并替换我当前的项目之外，我还有其他选择吗？

**更新：**我仔细查看了 .csproj 文件，发现 App.xaml 被添加为页面：

```
<Page Include="App.xaml">
  <Generator>MSBuild:Compile</Generator>
  <SubType>Designer</SubType>
</Page> 
```

但是，在我的其他 WPF 项目中，它是一个 ApplicationDefinition。一旦我改变了它，我可以将我的应用程序实例设置为启动对象，我的应用程序就会运行。不过，除了用户控件之外，我仍然没有创建任何 WPF 类型的选项。

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2009-01-16T15:52:12.777

我*不确定*项目文件中的哪些内容会告知 Visual Studio 正在使用哪种类型的项目，但我的猜测是“ProjectTypeGuids”是关键。

我的 WPF 项目有这个：

```
<ProjectTypeGuids>
   {60dc8134-eba5-43b8-bcc9-bb4bc16c2548};
   {FAE04EC0-301F-11D3-BF4B-00C04F79EFBC}
</ProjectTypeGuids> 
```

[这是我找到的一个链接](http://www.mztools.com/Articles/2008/MZ2008017.aspx)，它描述了指南以及它们代表的项目类型。您会注意到以“60DC”开头的 guid 与 WPF 应用程序链接中的列表相匹配。

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2009-04-29T14:56:58.850

Sailing Judo 的回答对我有用，可以将 WinForms 项目转换为 WPF，但没有详细描述需要什么；

1.  打开`csproj`要转换的项目的文件。
2.  搜索字符串`<ProjectTypeGuids>`- 很可能它不存在。
3.  在项目文件的标记中添加以下内容。如果您有多个`PropertyGroup`标签，请使用没有`Condition`属性的标签（例如默认属性）。

    > `<ProjectTypeGuids>{60dc8134-eba5-43b8-bcc9-bb4bc16c2548};{FAE04EC0-301F-11D3-BF4B-00C04F79EFBC}</ProjectTypeGuids>`

4.  保存 - 如果您打开了项目，VS 会要求重新加载项目。

从我看到和测试的结果来看，我现在可以轻松添加 WPF Windows**和**WinForms。我的旧 WinForms 也可以正常工作。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-16T13:43:28.887

可悲的是没有。

WPF 和 Windows 窗体项目不是很兼容。

*   尝试将尽可能多的繁琐逻辑代码提取到类库中
*   创建一个新的空白解决方案
*   将新的 WPF 项目添加到解决方案
*   将类库项目添加到解决方案
*   将类库设置为 WPF 项目的依赖项
*   在 WPF 中重新创建窗口

希望这对你有用。

祝你好运！

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2020-03-16T20:03:26.913

打开项目清单文件（一个带有 .csproj 扩展名的文件）并修改 PropertyGroup 节点（没有 Condition 元素的那个），如下所示：

```
 <PropertyGroup>
     <ProjectTypeGuids>
         {60dc8134-eba5-43b8-bcc9-bb4bc16c2548};{FAE04EC0-301F-11D3-BF4B-00C04F79EFBC}
     </ProjectTypeGuids>
  </PropertyGroup> 
```

修改后重启VS。现在您可以添加 WPF 窗口或其他 WPF 元素。您可能还必须添加引用 System.Xaml、PresentationCore 和 PresentationFramework。

# c# - 使用 HttpWebRequest 登录页面

> ID：450380
> 
> 赞同：13
> 
> 时间：2009-01-16T13:17:51.840
> 
> 标签：c#, login, httpwebrequest

如何使用 HttpWebRequest登录此页面[http://www.bhmobile.ba/portal/index ？](http://www.bhmobile.ba/portal/index)

登录按钮是“Pošalji”（左上角）。

### 登录页面的HTML源代码：

```
<table id="maintable" border="0" cellspacing="0" cellpadding="0" style="height:100%; width:100%">
  <tr>
    <td width="367" style="vertical-align:top;padding:3px"><script type="text/javascript">
function checkUserid(){
    if (document && document.getElementById){
        var f = document.getElementById('userid');
        if (f){
            if (f.value.length < 8){
                alert('Korisničko ime treba biti u formatu 061/062 xxxxxx !');
                return false;
            }
        }
    }
    return true;
}
</script>
<div style="margin-bottom:12px"><table class="leftbox" style="height:184px; background-image:url(/web/2007/slike/okvir.jpg);" cellspacing="0" cellpadding="0">
    <tr>
        <th style="vertical-align:middle"><form action="http://sso.bhmobile.ba/sso/login" method="post" onSubmit="return checkUserid();">

            <input type="hidden" name="realm" value="sso">
            <input type="hidden" name="application" value="portal">
            <input type="hidden" name="url" value="http://www.bhmobile.ba/portal/redirect?type=ssologin&amp;url=/portal/show?idc=1111">
            <table class="formbox" align="center" cellspacing="0" cellpadding="0">
                <tr>
                    <th style="vertical-align:middle; text-align:right;padding-right:4px;">Korisnik:</th>
                    <td><input type="text" size="20" id="userid" name="userid"/></td>
                </tr>

                <tr>
                    <th style="text-align:right;padding-right:4px;">Lozinka:</th>
                    <td><input type="password" size="20" name="password" /></td>
                </tr>
                <tr>
                    <th colspan="2">
                         <input class="dugmic" type="image" id="prijava1" alt="Prijava" src="/web/2007/dugmici/posalji_1.jpg" onmouseover="ChangeImage('prijava1','/web/2007/dugmici/posalji_2.jpg')" onmouseout="ChangeImage('prijava1','/web/2007/dugmici/posalji_1.jpg')">
                    </th>

                </tr>
            </table>
            <div style="padding:12px;">
                <a href="/portal/show?idc=1121">Da li ste novi BH Mobile korisnik?</a><br />
                <a href="/portal/show?idc=1121">Da li ste zaboravili lozinku(šifru)?</a><br />
            </div>
        </form></th>
    </tr>

</table></div> 
```

表单操作是[http://sso.bhmobile.ba/sso/login](http://sso.bhmobile.ba/sso/login)。如何将其与 HttpWebRequest 一起使用以获取 cookie 并使用此页面中的某些日期？

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2009-02-27T15:52:50.800

创建一个新的 default.aspx，并将其放在后面的代码中：根据您当前的问题，我无法进一步测试，因为您没有包含有效的用户名/密码。

```
 using System; 
    using System.Web;
    using System.Net; 
    using System.IO;
    using System.Web.UI;
    using System.Web.UI.WebControls; 

namespace Foo
{
    public partial class _Default : System.Web.UI.Page
    {
        protected void Page_Load(object sender, EventArgs e)
        {

            HttpWebRequest req = (HttpWebRequest)HttpWebRequest.Create("http://sso.bhmobile.ba/sso/login"); 
            req.UserAgent = "Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; .NET CLR 1.0.3705;)"; 
            req.Method = "POST";
            req.Accept = "text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8";
            req.Headers.Add("Accept-Language: en-us,en;q=0.5");
            req.Headers.Add("Accept-Encoding: gzip,deflate");
            req.Headers.Add("Accept-Charset: ISO-8859-1,utf-8;q=0.7,*;q=0.7");
            req.KeepAlive = true;
            req.Headers.Add("Keep-Alive: 300");
            req.Referer ="http://sso.bhmobile.ba/sso/login";

            req.ContentType = "application/x-www-form-urlencoded"; 

            String Username = "username";
            String PassWord = "Password";

            StreamWriter sw = new StreamWriter(req.GetRequestStream());
            sw.Write("application=portal&url=http%3A%2F%2Fwww.bhmobile.ba%2Fportal%2Fredirect%3Bjsessionid%3D1C568AAA1FB8B5C757CF5F68BE6ECE65%3Ftype%3Dssologin%26url%3D%2Fportal%2Fshow%3Bjsessionid%3D1C568AAA1FB8B5C757CF5F68BE6ECE65%3Fidc%3D1023278&realm=sso&userid=" + Username + "&password=" + password + "&x=16&y=11");
            sw.Close();

            HttpWebResponse response = (HttpWebResponse)req.GetResponse();

            StreamReader reader = new StreamReader(response.GetResponseStream());
            string tmp = reader.ReadToEnd();

            foreach (Cookie cook in response.Cookies)
            {
                tmp += "\n" + cook.Name + ": " + cook.Value;
            }

            Response.Write(tmp);
            Response.End();

        }
    }
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-05T23:44:09.480

您可以使用 WebClient 对象中的构建，而不是自己创建请求。

```
WebClient wc = new WebClient();
wc.Credentials = new NetworkCredential("username", "password");
string url = "http://foo.com";          
try
{
    using (Stream stream = wc.OpenRead(new Uri(url)))
    {
        using (StreamReader reader = new StreamReader(stream))
        {
            return reader.ReadToEnd();
             }
    }
}
catch (WebException e)
{
    //Error handeling
} 
```

# c# - 如何重叠两个控件

> ID：450381
> 
> 赞同：2
> 
> 时间：2009-01-16T13:18:16.380
> 
> 标签：c#, .net, controls, gdi+

我有一个 Circle 和一个 Line 控件。Circle 控件的 OnPaint 绘制一个圆，Line 控件的绘制一条线。这两个控件包含在另一个控件 (DrawingControl) 中。我需要在圆上放一条线，但圆的背景删除了这条线。我尝试启用透明度并覆盖 Circle 的 OnPaintBackground 方法，但它似乎不起作用。你有什么想法？谢谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-16T13:25:59.000

[本教程](http://www.c-sharpcorner.com/UploadFile/Nildo%20Soares%20de%20Araujo/TransparentControls11152005074108AM/TransparentControls.aspx)有帮助吗？它由**三个**步骤组成：启用透明度、覆盖 OnPaintBackground 和覆盖 OnMove

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-16T13:43:57.203

请参阅有关创建对角线控件的[此答案。](https://stackoverflow.com/questions/282838/drawing-on-top-of-controls-inside-a-panel-c-winforms#316526)这种技术不需要使用透明度，而是使用不规则形状的区域。以这种方式创建圆形控件会比直线示例稍微复杂一些，因为您需要使用贝塞尔曲线而不是线段来创建平滑的圆形。

# c# - 创建一个简单的“蜘蛛”

> ID：450383
> 
> 赞同：0
> 
> 时间：2009-01-16T13:18:31.480
> 
> 标签：c#, web-crawler

我研究了蜘蛛，并认为它对于我正在尝试制作的一个相当简单的应用程序来说有点太复杂了。网页上的某些数据无法在源中查看，因为它只是由浏览器显示。

如果我想从要在 WebBrowser 控件中显示的特定网页中获取值，是否有任何方法可以从该浏览器的内容中读取值？

如果没有，是否有人对他们如何解决这个问题有任何建议？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-16T13:24:32.203

您不是在寻找[蜘蛛](http://en.wikipedia.org/wiki/Web_crawler)，而是在寻找[屏幕抓取](http://en.wikipedia.org/wiki/Screen_Scraping)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-16T14:33:33.297

我不得不同意 Bombe，这听起来更像是您想要 HTML Screen Scraping。它需要大量的解析，如果你抓取的页面发生变化，你的应用就会崩溃，但是这里有一个小例子说明如何做到这一点：

```
WebClient webClient = new WebClient(); 
const string strUrl = "http://www.yahoo.com/"; 
byte[] reqHTML; 
reqHTML = webClient.DownloadData(strUrl); 
UTF8Encoding objUTF8 = new UTF8Encoding(); 
string html = objUTF8.GetString(reqHTML); 
```

现在 html 变量中包含了整个 HTML，您可以开始解析了。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-16T13:27:28.810

因为浏览器只是渲染底层内容，最灵活的方法是自己解析底层内容（html/css/js/whatever）。

我会创建一个解析引擎来寻找你的蜘蛛应用程序需要的东西。

这可能是一个基本的字符串搜索算法，例如查找 href="" 并读取值以产生新请求并继续爬取。你的引擎可以写成只寻找它感兴趣的东西，并以这种方式扩展以获得更多功能。

# ruby - 我在哪里可以找到关于 Ruby Shoe GUI Toolkit 中可用功能的文档？

> ID：450392
> 
> 赞同：4
> 
> 时间：2009-01-16T13:24:08.990
> 
> 标签：ruby, user-interface, api, documentation, shoes

是否有任何文档描述了鞋子中所有可用的功能和对象？

更新：2008.01.21 我正在寻找可以针对动画对象调用的所有方法的列表。

例如，我只是通过从鞋盒 ( [http://the-shoebox.org/](http://the-shoebox.org/) ) 中读取源代码来了解如何使用 toggle() 方法暂停动画。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-20T21:51:52.607

如果你跑

```
shoes -m 
```

在控制台（命令提示符）窗口中，鞋子将以帮助/手动模式运行。

在此模式下，它显示鞋子手册，并附有可运行的示例（手册是鞋子应用程序）。此模式具有内置的搜索功能，可直接跳转到文档的相关部分，非常方便参考。

大部分信息在上面提到的[help.shoooes.net](http://help.shoooes.net/)站点中被重新格式化为 html。

随着大多数开源项目的发展，它都有很好的文档记录。_why 似乎在文档中实际上表现出克制（他显然在没人知道鞋子手册中解决了他的卡通疯狂！）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-19T17:48:35.360

[鞋子帮助](http://help.shoooes.net/ "鞋子帮助")似乎有各种参考文档。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-16T13:36:50.570

我从来没有见过这样的鞋子。似乎为什么更喜欢用卡通和拼贴画来记录他的东西。

你读过《[没人知道鞋子](http://hackety.org/press/)》吗？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-27T17:13:33.420

Animation 对象继承自 TimerBase（就像 Every 对象和 Timer 对象一样），因此具有方法 draw、remove、start、stop 和 toggle。我知道的不多……这是我在挖掘鞋子来源时做的笔记。但这些将是一个很好的起点。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-27T22:38:03.027

似乎没有真正的文档，因此 - 你只需要从示例中收集它 [？] 尝试 rdoc 失败了[刚刚从 github repo 中运行 rdoc] [http://roger.doachristianturndaily.info /ruby/shoes/doc/](http://roger.doachristianturndaily.info/ruby/shoes/doc/) 你可以查看 C 代码以尝试发现它们 :)

# django - 为什么我的 django 视图返回零对象列表？

> ID：450396
> 
> 赞同：0
> 
> 时间：2009-01-16T13:25:03.667
> 
> 标签：django

我可能是懒惰或盲人！但以下代码返回零！项目，虽然我很清楚列表中有一些项目，

看法：

```
def post_answer(request, quest_id=None):
    answer_list = Answer.objects.filter
(questionis__pk=quest_id).select_related()
    ...
# if a put a print stmt here ( answer_list[0].answer ) there is
# data displayed on the console!!

return render_to_response('myapp/post_answer.html',{'answerobj':answer_list }} ) 
```

模板 post_answer.html：

```
{% regroup answerobj.object_list by answer as ans_list %}{{ ans_list|length }}
.... 
```

上面的代码打印 0。

我一定在某个地方闲逛，请协助

保罗

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-16T13:42:51.807

try : {% regroup answerobj by answer as ans_list %}{{ ans_list|length }} object_list 不是必需的。

# ruby-on-rails - 如何编辑 HABTM 表中的附加数据？

> ID：450408
> 
> 赞同：0
> 
> 时间：2009-01-16T13:30:52.547
> 
> 标签：ruby-on-rails, has-and-belongs-to-many

如何更新 HABTM 表中的其他数据。

例如：我有`movies`,`people`和 HABTM`movies_people`表，但表中还有一个额外`persontype_id`的字段`movies_people`表示此人在该特定电影中的角色。如何添加/更改此值？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-16T14:11:00.627

您可能应该使用 has_many :through 关联，它就是出于这个原因而引入的。除了movies_people 表之外，您还有一个额外的模型，称为Favorite 或Viewing 之类的东西（取决于您试图通过关联完成什么），它属于:movies 和:people，并且在您的Movie 模型中, 你会的

```
has_many :favorites
has_many :people, :through => :favorites 
```

这使您可以访问所有喜欢这部电影的人的 movie.people 和 movie.favorites 以访问您收藏夹表中的任何内容（如 persontype_id）

Josh Susser 的文章，[Many-to-Many Dance Off](http://blog.hasmanythrough.com/2006/4/20/many-to-many-dance-off)更好地解释了这一点，这是我希望的，所以如果需要更多帮助，我会看看它。[http://blog.hasmanythrough.com/2006/4/20/many-to-many-dance-off](http://blog.hasmanythrough.com/2006/4/20/many-to-many-dance-off)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-16T16:59:20.257

Ryan Bates 也有关于这个主题的精彩 Railscast：

[http://railscasts.com/episodes/47-two-many-to-many](http://railscasts.com/episodes/47-two-many-to-many)

# perl - 为什么不同编程语言中的模数不同？

> ID：450410
> 
> 赞同：23
> 
> 时间：2009-01-16T13:31:27.697
> 
> 标签：perl, vbscript, tcl, modulo

Perl

```
print 2 % -18; 
```

-->

```
-16 
```

Tcl

```
puts [expr {2 % -18}] 
```

-->

```
-16 
```

但是 VBScript

```
wscript.echo 2 mod -18 
```

-->

```
2 
```

为什么有区别？

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2009-01-16T13:50:15.083

维基[百科的答案](http://en.wikipedia.org/wiki/Modulo_operation)在这里很有帮助。

一个简短的总结是任何整数都可以定义为

a = qn + r

其中所有这些字母都是整数，并且

0 <= |r| < |n|。

几乎每种编程语言都要求 (a/n) * n + (a%n) = a。所以模数的定义几乎总是取决于整数除法的定义。整数除以负数有两种选择：2/-18 = 0 或 2/-18 = -1。根据您的语言的正确性，通常会更改 % 运算符。

这是因为 2 = (-1) * -18 + (-16) 和 2 = 0 * -18 + 2。

对于 Perl，情况很复杂。[手册页](http://perldoc.perl.org/perlop.html#Multiplicative-Operators)说：“请注意，当使用整数在范围内时，“％”使您可以直接访问由 C 编译器实现的模运算符。该运算符对于负操作数的定义不是很好，但它会执行得更快。 " 因此，如果使用整数在范围内，它可以为 Perl（如 C）选择任一选项。如果使用整数不在范围内，则手册说“如果 $b 为负数，则 $a % $b 是 $a 减去不小于 $a 的 $b 的最小倍数（即结果将小于或等于零）。”

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-01-16T13:39:03.950

维基百科的[“模运算”](http://en.wikipedia.org/wiki/Modulo_operation)页面很好地解释了这一点。我不会尝试在这里做得更好，因为我可能会犯一个微妙但重要的错误。

它的问题在于您可以以不同的方式定义“余数”或“模数”，并且不同的语言选择了不同的选项来实现。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-16T15:46:14.817

在除以一个数和一个除数（其中一个是负数）之后，您至少有两种方法可以将它们分成商和余数，例如商 * 除数 + 余数 = 数：您可以将商四舍五入到负无穷大，或趋向于零。

许多语言只选择一种。

我忍不住要指出[Common Lisp](http://www.lispworks.com/documentation/HyperSpec/Body/f_mod_r.htm)两者都提供。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-03-13T03:55:16.763

python，当然，明确地通知你

```
>>> divmod(2,-18)
(-1, -16) 
```

# c++ - Visual Studio：断点排除来自特定函数的调用

> ID：450415
> 
> 赞同：2
> 
> 时间：2009-01-16T13:35:09.433
> 
> 标签：c++, visual-studio, visual-studio-2005

我想在 Visual Studio 2005 中的非托管 C++ 中设置断点，但如果调用堆栈位于特定函数中，我想忽略此断点。有没有办法做到这一点？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-16T14:21:54.457

如果您有 Visual Studio 的商业版，您应该能够在调用例程的早期设置断点，然后将其“当命中...”行为更改为“运行宏”。您需要编写一个宏，以编程方式禁用被调用函数中的断点——将其用作要运行的宏。（希望其他人可以描述如何编写这样的宏。）然后在调用函数的所有退出点上设置其他断点，并更改它们的行为以重新启用被调用函数中的断点。

如果您有 Express Edition，您会发现“运行宏”复选框很遗憾是灰色的。在这种情况下，如果您可以访问调用函数的源代码，我建议如下：

1.  将全局`int`变量`bp_enabled`初始设置为 1。
2.  `--bp_enabled`在的第一行`calling_function()`。
3.  `++bp_enabled`的所有出口点`calling_function()`。
4.  将被调用函数中断点的“条件...”属性更改为仅在`bp_enabled == 1`. （转到 Debug | Windows | Breakpoints，然后右键单击断点。）

有点hack，但它完成了工作。

**[编辑：即使`calling_function()`碰巧递归调用自身（直接或间接），也可以正常工作...]**

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-16T13:40:50.717

您可以在调用方法上放置一个[DebuggerStepThrough](http://msdn.microsoft.com/en-us/library/system.diagnostics.debuggerstepthroughattribute.aspx)属性，尽管这将停止调用方法上的所有断点，而不仅仅是特定方法

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-16T14:07:07.403

**更新：** *在开始使用非托管 C++ 时，OP 最初并没有明确说明。所以这个答案现在非常没用，因为它只适用于托管代码。也就是说，我会留下它，以防有人偶然发现它有用或不了解 JMC：*

虽然`DebuggerStepThrough`仍然是防止单步进入代码的有效方法，但有时您确实想要介入。这意味着必须找到并注释掉该`DebuggerStepThrough`属性。

.NET 2.0 引入了一个新属性：[`DebuggerNonUserCode`](http://msdn.microsoft.com/en-us/library/system.diagnostics.debuggernonusercodeattribute.aspx). 这与Tools->Options->Debugging->General->Enable Just My Code 中的*Debug Just My Code设置结合使用。*

如果选中 Enable Just My Code，则任何使用该`DebuggerNonUserCode`属性修饰的方法都不会被单步执行。如果您确实想重新启用`DebuggerNonUserCode`定期标记的代码的调试，那么只需取消选中此设置。这样可以节省一些时间来查找和注释掉您通常不感兴趣的代码。

要使用任一属性，只需像这样装饰您选择的方法：

```
// The .NET 1.1 way
[DebuggerStepThrough]
public static void IgnoreMeAlways()
{
    Console.WriteLine("Hello...where is everybody!");
}

//The .NET2.0/VS2005/2008 way. Use in conjunction with Debug Just My Code
[DebuggerNonUserCode]
public static void NonUserCodeSomeTimes()
{
    Console.WriteLine("Longtime no see");
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-16T14:55:15.747

您可以在所有调用您的方法的行上放置中断（除了在您不想停止的一个调用程序例程中）。如果从很多地方调用例程，或者以不明显的方式调用例程，我可以看到这很困难。

更改仅用于调试的代码似乎是最简单的——如果可能的话。

# javascript - HTML中的下标文本

> ID：450424
> 
> 赞同：0
> 
> 时间：2009-01-16T13:38:50.583
> 
> 标签：javascript, html, dom

我正在使用以下代码来编写表格。现在我想在表格文本之后添加下标文本。如何实现？

我的代码有：

```
 oCell = document.createElement("TD");
  oCell.innerHTML = data;
  oRow.appendChild(oCell); 
```

如何在数据后添加下标文本？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-16T13:45:37.807

您可以使用以下内容将另一个元素附加到`td`元素：

```
var newElem = document.createElement("sub");
newElem.appendChild(document.createTextNode("foobar"));
oCell.appendChild(newElem); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-16T13:58:12.167

继续使用您正在使用的 innerHTML：

```
oCell.innerHTML = data+'<br /><sub>'+subText+'</sub>'; 
```

甚至

```
oCell.innerHTML = data+'<br />'+subText.sub(); 
```

对于一些 JavaScript 1.0，复古好吗？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-16T13:48:00.500

你可能是这个意思：

```
oCell = document.createElement("TD");
oSub = document.createElement("sub");
oSub.innerHTML = data;
oCell.appendChild(oSub);
oRow.appendChild(oCell); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-16T16:38:04.497

> oCell.innerHTML = 数据；

如果 'data' 可以包含 '<' 或 '&' 字符，那你就犯了一个错误。相反，使用 createTextNode 将纯文本放入 HTML：

```
oCell.appendChild(document.createTextNode(data));
oCell.appendChild(document.createElement('sub')).appendChild(document.createTextNode(subdata)); 
```

# java - Java 应用程序有没有办法检测屏幕是否被锁定？

> ID：450428
> 
> 赞同：9
> 
> 时间：2009-01-16T13:40:11.547
> 
> 标签：java

我正在寻找一种方法来了解 Java 应用程序（*没有*JNI - 它是一个多平台应用程序）可以检测屏幕是否被锁定。

有关信息......我们的应用程序在用户工作时记录时间 - 我们希望它在屏幕锁定时自动停止记录，而不是用户必须明确这样做。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-16T13:52:36.747

我不认为有一个 API 可以做到这一点，甚至没有办法做到这一切。解析由 java.awt.Robot 生成的屏幕截图既不依赖于平台，也不依赖于版本，甚至不依赖于配置，而且总的来说，我认为“屏幕被锁定”并不是一个定义良好的概念，可以在这个意义上使用 -在 Linux 上，可以有多个“屏幕”（X 服务器），您可以切换到控制台终端，您可以让运行一台（或多台）机器的应用程序通过网络在另一台机器上显示它们的 GUI...

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-16T14:06:11.680

我确认似乎没有 Java API 来检测屏幕锁定状态。

[Spark](http://www.igniterealtime.org/projects/spark/)开发人员在 2006 年尝试了它（就像这个[线程显示](http://www.igniterealtime.org/community/message/120674#120674)的那样），但没有给出任何关于具体实现的细节。
但是，它很可能涉及 JNI 和对[WTSQuerySessionInformation](http://msdn.microsoft.com/en-us/library/aa383838(VS.85).aspx)等函数的本机调用（检测是否断开连接`WTSQuerySessionInformation(NULL, WTS_CURRENT_SESSION, WTSConnectState)`并查找`WTSDisconnected`）。

因此，正如[迈克尔指出的那样](https://stackoverflow.com/questions/450428#450459)，没有“多平台”通用答案（据我所知）。

# c# - 使用 LoadControl 方法动态加载 UserControl (Type, object[])

> ID：450431
> 
> 赞同：22
> 
> 时间：2009-01-16T13:40:18.240
> 
> 标签：c#, asp.net

我正在尝试通过页面方法返回用户/服务器控件的 html 表示。它在我调用采用虚拟路径到用户控件的重载时起作用，但在我尝试调用采用类型的重载时不起作用。示例代码如下。有什么建议么？

```
[WebMethod]
public static string LoadAlternates(string productId, string pnlId)
{
    object[] parameters = new object[] { pnlId, productId };
    return ControlAsString(typeof(PopupControl), parameters);
}

private static string ControlAsString(Type controlType, object[] parameters)
{
    Page page = new Page();
    UserControl controlToLoad;
    /*
     *calling load control with the type results in the 
     *stringwriter returning an empty string
    */

    controlToLoad = page.LoadControl(controlType, parameters) as UserControl;
    /*
     *However, calling LoadControl with the following overload
     *gives the correct result, ie the string rep. of the control.
    */
     controlToLoad = page.LoadControl(@"~/RepeaterSamples/PopupControl.ascx") as UserControl;

    //some more code, then this... 
    page.Controls.Add(controlToLoad);

    StringWriter sw = new StringWriter();
    HttpContext.Current.Server.Execute(page, sw, false);
    return sw.ToString();
} 
```

任何想法为什么这个 StringWriter 会返回一个空字符串？我应该指出，无论选择调用 LoadControl 的方法如何，所有“页面”生命周期都能正确执行。

想添加-我*必须*使用`LoadControl(Type, object[])`重载。:-(

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2009-01-16T13:47:03.467

在[LoadControl 的 MSDN 页面](http://msdn.microsoft.com/en-us/library/ewtd66a0(v=VS.90).aspx#CommunityContent)上，底部有此评论：

> 描述
> 使用 Page.LoadControl(Type, Object[]) 加载用户控件的页面似乎不会创建其在 ascx 文件中添加的子项。使用 Page.LoadControl(String) 按预期工作。
> 
> 评论
> 感谢您提交此问题。我们正在调查，并会在获得更多信息时提供状态更新。
> 
> -Microsoft 于 2005 年 8 月 6 日上午 11:08 发布的Web 平台和工具团队
> 这是设计使然，因为类型“TestUC”实际上是部分类使用的基本类型，它不包含正确的代码实例化 TextBox1 引用，它实际上是在派生类型中定义的。有两种解决方法： 1\. 使用 LoadControl("TestControl.ascx")，实际上，这与 LoadControl(type) 的行为相同，但它实例化派生类型，它知道如何实例化 TextBox1。2\. 使用单文件页面，在页面中添加<%@Reference %>指令来引用用户控件，并为ascx页面分配一个类名。然后使用 LoadControl(type) 是安全的
> 
> 感谢您报告问题。
> 网络平台和工具团队。Microsoft 于 2005 年 6 月 14 日下午 6:31 发布

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-01-16T13:51:57.840

该重载会实例化基类，但不会实例化其上的任何控件，因此它不起作用。

如果您有兴趣，我写了一篇关于传递参数的解决方法的快速[博客文章。](http://www.grumpydev.com/2009/01/05/passing-parameters-using-loadcontrol/)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-16T15:00:59.933

If you want to have the control completely rendered one way to do this is to instantiate the control as you are now with `LoadControl` and then temporarily add it to the control collection of another control or the page itself. This will initialize the life-cycle for that control and cause all of the proper events to be raised. Once you have done this then you can get the rendered HTML or whatever you need from it.

Yes, this is a hack but it will work in a pinch.

# tfs - TFS over VPN 连接 - 有没有办法在客户端保存用户名/密码？

> ID：450447
> 
> 赞同：5
> 
> 时间：2009-01-16T13:46:25.513
> 
> 标签：tfs, vpn

我经常通过 VPN 连接到我的工作 TFS 实例。因为我的家用计算机不在域中，所以我不得不为每个 tf.exe 命令输入我的用户名/密码。有没有办法在本地缓存或保存它？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-10T14:29:06.253

你绝对可以做到！我在 Windows XP 上运行域外。我的一个同事刚刚教我怎么做。以下是步骤：

1.  打开**控制面板**。
2.  打开**用户帐户**。
3.  选择**更改帐户**，然后选择您当前的帐户。
4.  在左侧的“**相关任务**”下，选择“**管理我的网络密码**”，这将启动“**存储的用户名和密码**”对话框。
5.  在此处，单击“**添加**”按钮并输入 TFS 服务器的完整服务器路径 (server.abc.xyz)、完整的用户名 (ABC\username) 和用于 TFS 访问的密码。

那应该对你有用。我现在不那么讨厌 TFS 了。;)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2011-02-24T16:13:50.887

在带有 VS2010 的 Win7 中，当连接到我的 VPN 时，我能够执行以下操作，

1.  转到控制面板\用户帐户和家庭安全\凭据管理器
2.  添加 Windows 凭据
3.  输入您的 TFS 服务器名称（我的是“http://tfs:8080”，我输入了“tfs”）
4.  输入符合域的用户名（例如，mycompany\jdoe）
5.  完成后退出控制面板，然后重新启动 VS2010

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-20T22:09:11.510

虽然我不能完全解决你的问题，但我可以让它消失一半（这个命令设置为运行 SSMS，而不是 VS，尽管你可以更改它）：

```
%windir%\system32\runas.exe /netonly /user:DOMAIN\UserID "C:\Program Files\Microsoft SQL Server\90\Tools\Binn\VSShell\Common7\IDE\SqlWb.exe" 
```

RUNAS.exe 上的“/netonly”开关在目的地对其进行身份验证，这意味着您可以为其提供当前无权访问 DC 的用户名和密码。我们使用它来运行 SSMS 并使用集成身份验证登录到位于不同域的 SQL Server。即使我无法从我的计算机上看到该域的 DC，此命令仍然允许我将该域的用户名和密码传递给该服务器。

您可以设置此命令的快捷方式，它只会在您启动 VS 时提示您输入密码，这使得这更容易一些，因为您不必每次都输入您的域\用户名。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-16T14:18:05.293

您是否尝试过将用户名和密码设置为与您的工作环境完全相同？我似乎记得这适用于文件共享，因为它会传递散列凭据，只要它们匹配成功。

# c++ - 最小的 Qt 可执行文件大小

> ID：450455
> 
> 赞同：21
> 
> 时间：2009-01-16T13:50:11.230
> 
> 标签：c++, windows, qt

现在 Qt 进入 LGPL，我倾向于再试一次。几年前，我出于某些原因决定反对，其中一个原因是可执行文件的巨大尺寸（Windows 上的 Qt）。我找到了大约 5MB 的下限。Trolltech 应要求确认了这一点，但告诉我，粒度将得到改善，这将导致更小的尺寸（取决于所需的元素）。

与此同时，情况可能会发生变化。现在 Qt 中“hello world”（窗口和控制台）的大小是多少？

这是关于静态链接的。我认为 qtCore 和 qtGui 是必需的。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-16T13:55:27.927

这里有一个[2007 年的讨论](http://lists.trolltech.com/qt-interest/2007-08/thread00675-0.html)，我在快速浏览后看到的最小数字是 1.3 MB（使用[UPX](http://upx.sourceforge.net/)压缩），所以它似乎可以降低一点，但仍然相当大。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-18T13:40:33.380

我们的[Installbuilder for Qt](http://bitrock.com)产品是一个具有 Qt 前端的跨平台安装工具，并被许多商业开发人员使用（包括 Trolltech 本身用于打包他们的[QtCreator IDE](http://www.qtsoftware.com/developer/qt-creator/qt-creator)）。使用 4.4 并编译出我们不需要的部分，我们将 Linux x86 上的开销降低到 4.1 Mb，Linux x64 上的开销为 5.2M，Windows 上的开销为 5.3 Mb。考虑到这是在使用 UPX 处理它之前。此外，如果同一个二进制文件需要支持多个 Linux 发行版，您可能需要考虑发布 libstdc++，这将增加大约 800kb 的大小。

您将需要构建自己的版本，并且基本上为您不使用的小部件、您不需要支持的图像格式等启用/禁用 ifdef#。虽然 Qt 源代码已经为此准备好了，并且有一些应该有帮助的工具，现实情况是这是一个繁琐的手动过程（但对于我们这样的应用程序来说是必要的）。他们的嵌入式版本（以前称为 QTopia）和“常规”Qt 被合并到同一个代码库中，所以我确信继续前进，构建定制/精简版本将变得越来越容易。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-26T15:09:50.363

这在很大程度上取决于您的配置和部署方法。您当然可以编译为静态，这将排除未使用的代码。您还可以去除异常和 STL 之类的东西，这将使内存和磁盘占用空间更小。最后，无论您使用的是压缩文件系统，如 squashfs、cramf 还是 jffs2。尝试

```
configure --help 
```

有很多选择。使用 Qt for Embedded Linux 和 Windows CE 的嵌入式端口，您还可以使用 qconfig 加载配置文件，从而可以去除许多功能组。有关详细信息，请参阅[http://doc.trolltech.com/main-snapshot/fine-tuning-features.html](http://doc.trolltech.com/main-snapshot/fine-tuning-features.html)。

# dynamics-crm - Dynamics CRM 4.0 中的自定义搜索

> ID：450462
> 
> 赞同：6
> 
> 时间：2009-01-16T13:54:35.870
> 
> 标签：dynamics-crm, dynamics-crm-4

我有两个相关的问题。

首先：我希望针对 Dynamics CRM 4.0 中的自定义实体进行全文搜索。有没有人这样做过或知道怎么做？

我知道我可以使用 Web 服务和 sdk 构建 QueryExpressions，但是我可以使用这种方法使用布尔类型语法进行全文搜索吗？据我所知，这不会奏效。

第二：其他人是否觉得 Dynamics CRM 4.0 提供的搜索能力有限？我知道那里有一些 3rd parry 搜索产品，但我还没有找到我喜欢的。任何建议，将不胜感激。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-16T18:04:30.140

通过 CRM SDK 进行搜索和过滤确实需要一些时间来适应。为了模拟全文搜索，您需要使用嵌套的 FilterExpressions 作为您的 QueryExpression.Criteria。 [嵌套过滤器](http://msdn.microsoft.com/en-us/library/bb928435.aspx) 的 SDK 页面 最难的部分是弄清楚如何建立父子关系。有太多布尔逻辑，很容易迷路。

我需要为我们的一个自定义实体构建一个“搜索引擎”。将这种方法用于具有多个可搜索属性的复杂搜索字符串（“一和二或三”）很难看。如果你有兴趣，我可以挖掘它。虽然它并不真正受支持，但如果您可以直接访问数据库，我建议使用 SQL 的全文搜索功能。

——好的，给你。我认为您无法复制粘贴此内容并满足您的需求。我的客户只进行了两到三个关键词搜索，他们对此结果感到满意。您可以看到在一个简单的搜索场景中这样做是多么痛苦。我基本上吐出代码，直到它“工作”。

```
 private FilterExpression BuildFilterV2(string[] words, string[] seachAttributes)
    {
        FilterExpression filter = new FilterExpression();
        List<FilterExpression> allchildfilters = new List<FilterExpression>();

        List<string> andbucket = new List<string>();
        List<string> orBucket = new List<string>();

        // clean up commas, quotes, etc
        words = ScrubWords(words);

        int index = 0;

        while (index < words.Length)
        {
            // if current word is 'and' then add the next wrod to the ad bucket
            if (words[index].ToLower() == "and")
            {
                andbucket.Add(words[index + 1]);
                index += 2;
            }
            else
            {
                if (andbucket.Count > 0)
                {

                    List<FilterExpression> filters = new List<FilterExpression>();
                    foreach (string s in andbucket)
                    {
                        filters.Add(BuildSingleWordFilter(s, seachAttributes));
                    }

                    // send existing and bucket to condition builder 
                    FilterExpression childFilter = new FilterExpression();
                    childFilter.FilterOperator = LogicalOperator.And;
                    childFilter.Filters = filters.ToArray();

                    // add to child filter list
                    allchildfilters.Add(childFilter);

                    //new 'and' bucket
                    andbucket = new List<string>();
                }
                if (index + 1 < words.Length && words[index + 1].ToLower() == "and")
                {
                    andbucket.Add(words[index]);
                    if (index + 2 <= words.Length)
                    {
                        andbucket.Add(words[index + 2]);
                    }
                    index += 3;
                }
                else
                {
                    orBucket.Add(words[index]);
                    index++;
                }
            }
        }

        if (andbucket.Count > 0)
        {
            List<FilterExpression> filters = new List<FilterExpression>();
            foreach (string s in andbucket)
            {
                filters.Add(BuildSingleWordFilter(s, seachAttributes));
            }

            // send existing and bucket to condition builder 
            FilterExpression childFilter = new FilterExpression();
            childFilter.FilterOperator = LogicalOperator.And;
            childFilter.Filters = filters.ToArray();

            // add to child filter list
            allchildfilters.Add(childFilter);

            //new 'and' bucket
            andbucket = new List<string>();
        }
        if (orBucket.Count > 0)
        {
            filter.Conditions = BuildConditions(orBucket.ToArray(), seachAttributes);
        }
        filter.FilterOperator = LogicalOperator.Or;
        filter.Filters = allchildfilters.ToArray();

        return filter;
    }
    private FilterExpression BuildSingleWordFilter(string word, string[] seachAttributes)
    {
        List<ConditionExpression> conditions = new List<ConditionExpression>();

        foreach (string attr in seachAttributes)
        {
                ConditionExpression expr = new ConditionExpression();
                expr.AttributeName = attr;
                expr.Operator = ConditionOperator.Like;
                expr.Values = new string[] { "%" + word + "%" };

                conditions.Add(expr);
        }

        FilterExpression filter = new FilterExpression();
        filter.FilterOperator = LogicalOperator.Or;
        filter.Conditions = conditions.ToArray();

        return filter;
    }

    private ConditionExpression[] BuildConditions(string[] words, string[] seachAttributes)
    {
        List<ConditionExpression> conditions = new List<ConditionExpression>();

        foreach (string s in words)
        {
            foreach (string attr in seachAttributes)
            {
                ConditionExpression expr = new ConditionExpression();
                expr.AttributeName = attr;
                expr.Operator = ConditionOperator.Like;
                expr.Values = new string[] { "%" + s + "%" };

                conditions.Add(expr);
            }
        }

        return conditions.ToArray();
    } 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-17T20:49:27.170

嗯，这是一个非常有趣的场景......

您当然可以执行“喜欢”查询，并将您希望包含在搜索中的列/属性条件一起“或”。这似乎是 CRM 从实体列表上方的框中进行查询的方式（而且速度非常快）。看起来 CRM 数据库有一个全文索引，虽然在简短的浏览之后，究竟使用了哪些列来填充它对我来说有点模糊。

并记住[LinqtoCRM](http://www.codeplex.com/LINQtoCRM/)对 CRM 查询的热爱（我开始了这个项目，对于无耻的插件感到抱歉）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-04-15T05:30:07.357

其次 - 我可以推荐 Akvelon 的“全局搜索”，它提供了搜索所有自定义实体和属性以及开箱即用实体和属性的能力。他们还使用 FTS 在附加文档内容中进行搜索。您可以在他们的官方网站上找到更多详细信息：[http ://www.akvelon.com/Products/Dynamics%20CRM%20global%20Search/default.aspx](http://www.akvelon.com/Products/Dynamics%20CRM%20global%20Search/default.aspx)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-07-28T03:13:46.283

我建议使用数据库中为您提供的 Dynamics CRM 过滤视图。然后，您可以利用本机 SQL 的所有功能来执行您需要的任何 LIKE 或其他逻辑。此外，过滤后的视图经过安全调整，因此您不必担心用户访问他们无权访问的记录。

# c# - 如何使这个类通用？（.NET C#）

> ID：450463
> 
> 赞同：2
> 
> 时间：2009-01-16T13:55:11.360
> 
> 标签：c#, .net, generics, constructor, interface

我的班级有以下核心：

```
class SmartDbConnection
{
    private readonly IDbConnection Connection;

    public SmartDbConnection(string ConnectionString)
    {
        if(ConnectionString.Contains("MultipleActiveResultSets=true"))
        {
            Connection = new SqlConnection(ConnectionString);
        }
    }
} 
```

我不希望它硬编码“SqlConnection”。所以我想把它变成一个通用类（接受 IDbConnection 类）。但我不知道该怎么做。任何人都可以帮忙吗？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-01-16T14:00:33.893

首先 - 我已经添加`IDisposable`了这一点，因为我认为这很重要。

其次，请注意提供者是这里的替代方案：

```
class SmartDbConnection
{
    private DbConnection Connection;

    public SmartDbConnection(string provider, string connectionString)
    {
        Connection = DbProviderFactories.GetFactory(provider)
            .CreateConnection();
        Connection.ConnectionString = connectionString;
    }
    public void Dispose() {
        if (Connection != null)
        {
            Connection.Dispose();
            Connection = null;
        }
    }
} 
```

如果您必须通用，如何：

```
class SmartDbConnection<T> : IDisposable where T : class,
    IDbConnection, new()
{
    private T Connection;

    public SmartDbConnection(string connectionString)
    {
        T t = new T();
        t.ConnectionString = connectionString;
        // etc
    }
    public void Dispose() {
        if (Connection != null)
        {
            Connection.Dispose();
            Connection = null;
        }
    }
} 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-01-16T13:59:19.527

你为什么不接受 IDbConnection 而不是你的ctor的连接字符串？

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-16T13:59:39.400

也许...

```
class SmartDbConnection<T> where T : IDbConnection, new()
{
    private readonly IDbConnection Connection;

    public SmartDbConnection(string connectionString)
    {
        if (connectionString.Contains("MultipleActiveResultSets=true"))
        {
            Connection = new T();
            Connection.ConnectionString = connectionString;
        }
    }
} 
```

编辑：但[kaanbardak 的](https://stackoverflow.com/users/53378/kaanbardak)建议可能会更好......

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-16T14:00:17.247

如果您不想在此处指定 SqlConnection，您将在哪里指定它 - 以及仅当连接字符串包含“MultipleActiveResultSets=true”时您如何知道使用它？

我怀疑在某种程度上你想要一个连接工厂 -`Func<string, IDbConnection>`你可以传入或设置某个地方，或者可能只是一个类：

```
public static class ConnectionFactory
{
    public static IDbConnection CreateConnection(string connectionString)
    {
        // Hard-code stuff here
    }
} 
```

当然，它们只是同一枚硬币的两个方面——ConnectionFactory 只是`Func<string, IDbConnection>`.

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-16T14:03:57.753

```
 class SmartDbConnection<T> where T: IDbConnection , new()
  {
    private readonly T Connection;

    public SmartDbConnection(string ConnectionString)
    {
      if (ConnectionString.Contains("MultipleActiveResultSets=true"))
      {
        Connection = new T();
        Connection.ConnectionString = ConnectionString;
      }
    }
  } 
```

# visual-studio - Visual Studio 中的 Pascal 语法高亮显示？

> ID：450464
> 
> 赞同：1
> 
> 时间：2009-01-16T13:55:20.470
> 
> 标签：visual-studio, visual-studio-2008, syntax-highlighting, pascal

我正在用 C# 编写最初用 Delphi 编写的下一代旧应用程序。我经常不得不查看旧代码并想知道是否有在 Visual Studio 2008 编辑器中安装 Pascal 语法突出显示的方法。

TIA。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-15T08:09:02.663

[http://blog.cumps.be/visual-studio-2008-and-php-coloring/](http://blog.cumps.be/visual-studio-2008-and-php-coloring/) - 也许这可以从 PHP 调整为 delphi/pascal

计划项目：

[http://www.codeplex.com/Delphi4VisualStudio](http://www.codeplex.com/Delphi4VisualStudio) - 这（有一天）将支持语法突出显示（但它似乎也有点矫枉过正）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-07-22T21:50:17.193

I know the guy working on [Delphi4VisualStudio](http://www.codeplex.com/Delphi4VisualStudio). The project doesn't seem to be active any more, but I know he had syntax highlighting working in the editor. You could always ask him for just that piece.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-07-22T22:01:12.833

I could do it in about 1-2 day's work, but I'm busy trying to make ends meet (seriously). Let me know if you want me to do it.

Prior work (showing [almost] only the syntax highlighting):

Edit: Don't mark me down if this isn't allowed - just let me know. I'd seriously do it for free if I had any spare time at all, I just don't right now.

*   [UnrealScript](http://wiki.pixelminegames.com/images/3/31/Uc_autocomplete.png)
*   [INI Files](http://wiki.pixelminegames.com/images/0/0c/Uc_configfile.png)
*   [ANTLR grammars](http://wiki.pixelminegames.com/images/1/14/NFringeAntlr_QuickInfo.png)
*   [StringTemplate templating language](http://wiki.pixelminegames.com/images/7/78/NFringeAntlr_StringTemplate1.png)
*   [Chapel](http://www.pixelminegames.com/downloads/images/BasicChapelHighlighting.png)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-16T14:26:36.787

我不是专家，但您可能想看看[Delphi Prism](http://www.remobjects.com/oxygene.aspx)，它似乎将 Delphi 编译器结合到 Visual Studio 中。然而，这可能是矫枉过正。

# crystal-reports - Crystal Reports - 没有为此表、查询或过程返回任何行集 - 崩溃！

> ID：450469
> 
> 赞同：1
> 
> 时间：2009-01-16T13:57:37.127
> 
> 标签：crystal-reports, crash-reports

我正在使用 Crystal Reports 8.0.1.0 并将 OLEDB 连接设置为“收藏夹”。我们有几个报告正在针对数据库上的一些存储过程运行。我们的数据库是一个 SQLExpress 2005 命名实例。

其中一份报告涉及余额，即我们必须为特定公司或一组公司提供余额报告。

然而，客户特别要求我们为特定经济账户类型设置一个单独的部分作为最后一个部分，为此，我们必须将这一部分与其他部分分开，而是使用两个平行的子报表显示。

因此我们的结构应该如下：

```
 GENERAL HEADING
                          PATRIMONIAL STATE
                              ...data...
                           ECONOMIC COUNTS
                              ...data...
                         THIRD-PARTY EFFECTS
                              ...data... 
```

总标题下方的前两个部分是通过两个平行的子报表实现的，所以现在我们必须显示第三个部分。到现在还清楚吗？好吧，您可能很清楚，CR 子报表要求您设置数据库位置，无论您是否已经为主报表设置了一个。然而，问题是，如果我尝试将位置设置为指向我们的存储过程（它返回余额报告的**所有**数据），第一次它将显示主题中的消息，第二次再次显示，但这时间它也会崩溃。我们的存储过程有一个参数，并且之前的两个子报表（并行的子报表）都设置为相同的 SP，并且工作正常。

这次崩溃使我无法处理第三部分，而且我几乎不知道解决手头问题的最佳方法是什么。

有什么想法/建议吗？

我很**乐意**收到您的回答，并且希望我的问题足够清楚（如果需要，我非常愿意进一步深入研究以进行澄清）。

非常感谢您的参与，

安德里亚·雷蒙迪

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-16T15:04:13.250

Geez... changing the connection from OLEDB to SQLServer it correctly fetches the rowset and doesn't crash!

I am **speechless**.

Andrew

# c++ - C++ 内存指针练习中的未知崩溃

> ID：450471
> 
> 赞同：0
> 
> 时间：2009-01-16T13:58:40.153
> 
> 标签：c++, pointers, crash

我最近写了一个程序来帮助我理解 C++ 中内存指针的基础知识，我选择了一个简单的素数查找器。

我终于让它工作了。（是的调试！）

我让它运行看看它走了多远，它到达了 #815389，我的详细信息告诉我是第 65076 个素数，我遇到了应用程序崩溃。我能想到的一件事是我的整数溢出，所以我将它们改为长整数，它卡在同一个地方。

有人可以帮助解释是什么限制导致了这种情况吗？

comp：WinVista 64 位家庭高级版，6GB ram AMD 4800+ X2 程序在 4,664K 内存使用时崩溃

来源：

```
#include <cstdlib>

#include <iostream>

\\\\(Backslashes added for readability)

using namespace std;

long number;
long numnum;

class num;

class num {

  public:

         long i;
         void check();
         bool nxt;
         num* nxtnum;
};

void num::check() {

 if (number % i != 0) {
            if (nxt == true) {
                    (*nxtnum).check();
            } else {
                   nxtnum = new num();
                   (*nxtnum).i = number;
                   numnum++;
                   cout << numnum << ":" << number << ", ";
                   nxt = true;
            };
 };
};

int main(long argc, char *argv[]){

  numnum = 1;
  cout << numnum << ":" << 2 << ", ";
  num two;
  two.i = 2;
  for (number = 3; 1<=1000001; number++) {
    two.check();
  };
  cout << endl;
  system("PAUSE");
  return EXIT_SUCCESS;
}; 
```

（不要介意用户名，这只是我使用的别名，因此我可以使用 google 跟踪我的所有帖子）

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-16T14:06:12.493

堆栈溢出？我看到这`check`是递归的。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-16T14:06:14.443

我猜想 two.nxt 没有初始化。在 C 中，原始数据类型没有被初始化，这意味着它们的值与它现在占用的内存中发生的任何内容相同。这意味着在 main() 中，two.nxt = true 很可能会导致 check() 在无效指针上运行。尝试将其显式设置为 false，看看是否适合您。

[编辑] 如果这是问题，更重要的初始化将是当您在 check() 中分配新的 num 时。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-16T14:22:33.193

肖恩是对的，two.nxt 从未初始化。事实上，num.nxt 从未为任何 num 实例初始化。如果类变得更健壮，则不需要成员 nxt。可以使用 nxt 指针代替：

```
class num
{
private:
    long i;
    num *nxtnum;
public:
    num (long value) : i (value), nxtnum (0) { }
    void check ()
    {
      if (number % i != 0)
      {
        if (nxtnum)
        {
          nxtnum->check ();
        }
        else
        {
          nxtnum = new num (number);
          cout << ++numnum << ":" << number << ", ";
        }
     }
}; 
```

当然，递归性质可能是罪魁祸首，初始化问题被隐藏了，因为您可能正在运行调试版本。将递归形式转换为迭代形式留作练习。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-16T14:20:54.163

我可以看到几个问题：

*   您正在分配一堆数字，但您没有检查 std::bad_alloc 异常。您可能只是内存不足...
*   如果 nxtnum 为 != 0，则您不会在任何地方进行检查，即使我认为这样做是安全的，因为您取消引用它的唯一地方是保护它。然而，这并不是一个很好的练习。
*   正如 Sean Edwards 所提到的， num 类没有构造函数，因此新创建的 num 的成员充满了几乎随机的垃圾。并且该随机垃圾可能包括将 nxt 设置为非零值。我将添加以下构造函数来为其提供一组安全的默认值：

    num::num() : i(0), nxt(false), nxtnum(0) {}

*   你真的不需要布尔值，我只是检查 nxtnum 是否非零。

*   正如 Jeff Yates 所说，由于递归函数嵌套太深，您可能会遇到堆栈溢出，但看起来它不会递归*那么*深。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-16T15:23:26.767

顺便说一句，如果您使用的是 Microsoft 编译器，则 int 和 long 在针对 x64 时的大小相同。您的 main 函数中还有一个无限循环，因为 1 将始终 <= 1000001。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-16T16:34:34.657

我已经成功了，谢谢 Skizz

```
#include <cstdlib>
#include <iostream>
#include <windows.h>

using namespace std;

long number;
long numnum;
class num;
num *two;
num *nn;
num *bre;

class num
{
    private:
        long i;
        num *nxtnum;
    public:
        num (long value) : i (value), nxtnum (0) { }
        void *check ()
        {
          if (number % i != 0)
          {
            if (nxtnum)
            {
              //nxtnum->check ();
              nn = nxtnum;
            }
            else
            {
              nxtnum = new num(number);
              cout << ++numnum << ":" << number << ", ";
              nn = bre;
            }
         }else{nn=bre;}
        }
};

int main(long argc, char *argv[])
{
    numnum = 1;
    cout << numnum << ":" << 2 << ", ";
    two = new num(2);
    nn=two;
    for (number = 3; 1<=1000001; number++) {
        while (nn!=bre){
                nn->check();
                Sleep(0);
                }
        nn=two;
    };
    cout << endl;
    system("PAUSE");
    return EXIT_SUCCESS;
}; 
```

对于那些有兴趣的人

# c# - 保存时自动调用visual studio 2008“使用指令排序”？

> ID：450474
> 
> 赞同：8
> 
> 时间：2009-01-16T13:59:03.880
> 
> 标签：c#, visual-studio, visual-studio-2008, code-formatting, using-directives

Visual Studio 2008 为 c# 提供了两个很棒的功能，称为“使用指令排序”和“删除未使用的使用指令”。

每次我使用 ctrl+k,ctrl+d 格式化代码时，我都想调用“使用指令排序”。

或者，更好的是，我希望能够重新格式化项目中的所有 c# 源文件，并为所有源文件调用“使用指令排序”。

我怎样才能做到这一点？在每次签入之前手动打开每个 cs 文件并键入这些函数很乏味！

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-01-16T14:01:30.457

[您可以使用"PowerCommands for Visual Studio 2008"](http://code.msdn.microsoft.com/PowerCommands)为解决方案或项目完成这一切。安装后，您只需右键单击项目或解决方案，“删除和排序使用”在上下文菜单中。

编辑：如评论中所述，还有[PowerCommands for Visual Studio 2010](http://visualstudiogallery.msdn.microsoft.com/e5f41ad9-4edc-4912-bca3-91147db95b99)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-07-27T14:31:17.517

另一个选择是[CodeMaid](http://visualstudiogallery.msdn.microsoft.com/en-us/76293c4d-8c16-4f4a-aee6-21f83a571496)，一个免费的开源 Visual Studio 扩展。它允许您对 usings 进行排序、删除 usings、格式化文档、删除/插入空白行、删除空格以及更多的清理工作。它可以在保存、解决方案范围等情况下运行。点击 Visual Studio 画廊的链接以查看更多详细信息。

它还允许您有条件地启用/禁用各个部分，因此您可以禁用删除未使用的使用，并且仅在您想要时才进行排序，如您在评论中提到的那样。

免责声明：我写的；）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-16T14:03:44.527

ReSharper 可以为您执行此操作（以及其他重新格式化选项），它允许您一次性完成整个解决方案。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-16T14:06:25.377

我建议您录制一个手动调用该功能的宏。然后你可以保存宏并在工具栏上放一个按钮。通过这种方式，您还可以开始真正定制您的 IDE。

# php - 奇怪的编码问题

> ID：450476
> 
> 赞同：0
> 
> 时间：2009-01-16T13:59:28.653
> 
> 标签：php, mysql, encoding

我有一个以 latin5 字符集编码的数据表，表中的所有列也是 latin5。当我输入“SET NAMES 'latin5'”并查询表结果时，从 mysql 控制台。当我尝试删除或插入/更新时，所有新数据的编码都是完美的。但是，当我尝试将 Iso-8859 数据（也使用 mb_detect_encoding 验证）插入数据库并且我尝试在没有“SET NAMES”的情况下插入数据时，它不会以正确的编码插入/更新/选择，或者当我使用“SET NAMES 'latin5'" 它没有以正确的方式插入/更新，但选择没问题 latin5 数据以正确的编码形式出现，仅设置名称为 'latin5'。当我使用集合名称“utf8”时，选择查询编码错误，但插入/更新正常。

我要求我们去生产的原因。这让我思考未来可能出现的问题。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-16T16:42:49.587

`mb_detect_encoding`不知道你的字符串是什么编码。它做出了一个合格的猜测，但不能保证它会猜对。特别是如果候选都是单字节编码，例如 latin1 和 latin5。

如果您想获得正确的字符集，确实没有什么可以替代知道您在做什么。我建议您至少阅读这些页面几次：

*   [http://www.phpwact.org/php/i18n/charsets](http://www.phpwact.org/php/i18n/charsets)
*   [http://www.nicknettleton.com/zine/php/php-utf-8-cheatsheet](http://www.nicknettleton.com/zine/php/php-utf-8-cheatsheet)

特别要注意的是，网页使用 http 标头提供服务，该标头指定了对页面进行编码的字符集。除非您从 php 脚本中明确设置，否则您将使用 webservers 默认值，这可能因服务器而异。

此外，要小心实际了解正在发生的事情，而不是反复试验。后者可以很容易地为您提供在某些情况下有效的东西，但并非在所有情况下都有效。

最后。如果您有任何选择，我强烈建议您对所有内容都使用 utf-8。latin5 会让你很伤心。

# java - 图像生成模板引擎

> ID：450486
> 
> 赞同：7
> 
> 时间：2009-01-16T14:03:44.540
> 
> 标签：java, image, template-engine

有谁知道任何用于生成图像的模板引擎，最好是基于 Java 的？

我想到的是[StringTemplate 之](http://stringtemplate.org)类的东西，其中您有一组参数化模板，它们呈现为图像（或 SVG 等）而不是文本。它需要比“在此处插入文本以生成符号”更通用。基元将是各种形状、其他图像、文本等。

我意识到我可以使用生成 SVG 的文本模板引擎自己轻松地构建它，但我正在寻找“开箱即用”的东西。

谢谢！

为了详细说明，这里有一些我正在寻找的完全组成的语法。图片 我想生成一个带有一些状态覆盖的图标（如 Eclipse 中的图标）：

```
iconTemplate(base, status, svn) {
    image($base), // the base icon
    // create a 2x2 grid for status overlays
    gridlayout(2, 2) {
        // conditionally add overlays in corners based on parameters
        if($status == "error") {
            image("error.png") {
                layoutInfo : cell(1, 0)
            }
        }
        if($svn == "changed") {
            image("changed.png") {
                layoutInfo : cell(1, 1)
            }
        }
    }
} 
```

请注意，此语法已完成并且显然很烂，但也许它可以理解:)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-16T16:14:51.687

我不确定我是否了解您的需求，但是如何创建一个 JPanel（您可以使用布局、标签、其他形状......）并将其保存为图像？

[在这里](http://forums.sun.com/thread.jspa?threadID=173336&start=0)您可以找到有关如何将 JPanel 保存为图像的信息。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-16T14:17:22.347

不确定它是否是您正在寻找的东西，但也许像[Graphviz](http://www.graphviz.org/)、[Grappa](http://www.research.att.com/~john/Grappa/)或[Zest](http://www.eclipse.org/gef/zest/)这样的东西可以提供帮助？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2017-12-11T10:09:11.173

您可以使用[Jasper Report](https://community.jaspersoft.com/wiki/jasperreports-library-tutorial)从模板生成图像。它具有简化模板过程的IDE。

# c++ - 一个好的 SOAP 的 C++ 库

> ID：450488
> 
> 赞同：33
> 
> 时间：2009-01-16T14:03:48.567
> 
> 标签：c++, web-services, soap

C++ 中 SOAP 开发的替代方案是什么？您更喜欢哪一个并且最受支持/最现代？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-01-16T15:28:46.350

查看**Apache Axis**。那是我一直以来最喜欢的 SOAP 实现。肥皂做得对！存在于 C++ 和 Java 中。
[http://ws.apache.org/axis/在](http://ws.apache.org/axis/)**[Apache 基金会](http://ws.apache.org/)**
的最佳传统中，它是**免费**和**开放的**。 所以，享受吧！

 ***** * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-01-16T14:11:21.187

不久前，我不得不为一个项目进行 SOAP 调用，而我发现的唯一可接受的解决方案是 GSOAP。

[http://www.cs.fsu.edu/~engelen/soap.html](http://www.cs.fsu.edu/~engelen/soap.html)

它同时支持 C 和 C++ 代码，尽管使用 C++ 更好且更容易理解。虽然与我们的 WCF Web 服务不兼容，但它工作正常，这意味着我们必须手动编辑自动生成的源代码。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-01-16T14:18:12.593

不久前我偶然发现了 gsoap，但我并不是它的接口和代码生成器的忠实粉丝。正如我所记得的那样，文档明显缺乏（或者至少格式非常困难）。

不过，在不久的将来，[这个库](http://www.alhem.net/Sockets/index.html)可能会添加套接字支持。至少，我前段时间向开发人员提出了建议，他似乎认为是这个想法，几个月后，一个 XML 解析器出现在 API 中。我是那个库的忠实粉丝，如果它不是 GPL，我肯定会更多地使用它。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2014-07-24T19:26:01.380

如果您正在为 Windows 编写代码，Microsoft 有一个随 Windows 7 SDK（以及 Visual Studio 2013 及更高版本）一起提供的实用程序，称为 WSUTIL。它在给定 WDSL 文件的情况下生成 C 代理，如本例所示。

[http://msdn.microsoft.com/en-us/library/windows/desktop/gg288974.aspx](http://msdn.microsoft.com/en-us/library/windows/desktop/gg288974.aspx)

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2016-02-24T17:16:24.997

如果您使用的是 Qt C++，则为 KD Soap。这是网址 [https://www.kdab.com/kd-soap/](https://www.kdab.com/kd-soap/)

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-01-16T14:40:28.460

[SmartWin++](http://smartwin.sourceforge.net/)有一个名为 SmartSOAP 的副项目，我认为它非常简洁，它具有一个非常完整的堆栈，从 SocketStream 开始，一直到 HttpRequest/Response 对象。具有小型（对工作而言）XML DOM 类抽象，并升级到 SOAP。它甚至带有一个 WSDL 解析器来为您创建代理类。它大量使用模板和 STL。并且是非常棒的 C++。适用于 Windows 移动...

虽然它不是非常丰富，但没有 SSL 之类的东西。但由于代码是纯粹的艺术，我猜想它很容易被理解并扩展到你自己......

许可证是新的 BSD...

免责声明；我实现了它...

# c# - 如何将文本注入光标焦点

> ID：450491
> 
> 赞同：0
> 
> 时间：2009-01-16T14:05:05.787
> 
> 标签：c#, interop, cursor

我正在开发一个需要在光标所在位置插入文本的 .NET windows 应用程序。光标将位于我无法控制的不同应用程序中。我认为这里需要使用操作系统来实现这一点。你能帮忙吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-16T14:22:54.517

将要插入的文本放入剪贴板

找到窗口的句柄：

```
Process[] processes = Process.GetProcessesByName("notepad");
foreach (Process p in processes)
{
    IntPtr pFoundWindow = p.MainWindowHandle;
    // Do something with the handle...
} 
```

使用 pinvoke 向窗口发送“Ctrl+V”消息，请参阅[http://www.pinvoke.net/default.aspx/user32.SendMessage](http://www.pinvoke.net/default.aspx/user32.SendMessage)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-16T14:47:51.393

最简单的是使用 Windows.Forms 上的[SendKeys](http://msdn.microsoft.com/en-us/library/system.windows.forms.sendkeys.aspx)类。

否则，使用 windows api 中的[SendMessage](http://www.pinvoke.net/default.aspx/user32.SendMessage)按键发送（有关此的[一些信息](http://www.codeguru.com/forum/archive/index.php/t-49901.html)）。

不要使用剪贴板，用户通常不希望这样，也不期望那样。

# nlp - 自然英语单词

> ID：450493
> 
> 赞同：21
> 
> 时间：2009-01-16T14:05:56.907
> 
> 标签：nlp

我需要我能找到的最详尽的英语单词列表，用于几种类型的语言处理操作，但我在互联网上找不到任何质量足够好的东西。

英语中有 1,000,000 个单词，包括外来词和/或技术词。

您能否建议这样一个可以从互联网上下载的可能有点分类的来源（或接近 50 万字）？您的语言处理应用程序使用什么输入？

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2009-01-16T14:08:04.453

[凯文的](http://wordlist.sourceforge.net/)词表是我所知道的最好的词表。

如果您想了解名词、动词等、同义词等，[WordNet会更好。](http://wordnet.princeton.edu/)

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-02-22T21:37:22.683

` [“百万字”骗局滚滚而来](http://languagelog.ldc.upenn.edu/nll/?p=972)，我明白了 ;-)

如何让你的单词列表更长：给定一个名词，添加以下任何一个：non-，pseudo-，semi-，-arific，-geek，...；[比对动词](http://en.wikipedia.org/wiki/Mutatis_mutandis)等

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-16T14:20:19.233

我为普渡大学做过关于受控/自然英语和语言领域知识处理的研究。

我会看一下尝试项目：[http](http://attempto.ifi.uzh.ch/site/description/) ://attempto.ifi.uzh.ch/site/description/这是一个帮助建立受控的自然英语的项目。

您可以在以下位置下载他们的整个单词词典：[http](http://attempto.ifi.uzh.ch/site/downloads/files/clex-6.0-080806.zip) ://attempto.ifi.uzh.ch/site/downloads/files/clex-6.0-080806.zip它有大约 100,000 个自然英语单词。

您还可以为特定领域的单词提供自己的词典，这就是我们在研究中所做的。他们提供网络服务来解析和格式化自然英文文本。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-01-16T14:15:37.497

谁告诉你有一百万字的？根据[维基百科](http://en.wikipedia.org/wiki/English_language#Number_of_words_in_English)，牛津英语词典只有 600,000。OED 试图包含所有使用的技术和俚语术语。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2012-06-11T14:40:51.567

直接尝试维基百科的摘录：[http ://dbpedia.org](http://dbpedia.org)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2015-04-18T23:32:45.367

[没有太多的基本词（根据this- oxford](http://www.oxforddictionaries.com/us/words/how-many-words-are-there-in-the-english-language)的说法是171k 。这是我记得在大学的CS课程中被告知的内容。但是如果包括所有形式的词-那么它会大大增加。

也就是说，为什么不自己做一个呢？获取 Wikipedia 转储并对其进行解析并创建一组您遇到的所有令牌。

期待拼写错误 - 就像所有众包一样会有错误。

# dataflow-diagram - 什么是数据流图DFD？

> ID：450498
> 
> 赞同：1
> 
> 时间：2009-01-16T14:06:38.717
> 
> 标签：dataflow-diagram

什么是 DF 图，它们如何帮助项目经理完成工作？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-16T14:08:13.660

如您所见，[数据流图](http://en.wikipedia.org/wiki/Data_flow_diagram)是显示应用程序中数据流的图。

在最高级别，您拥有可以表示为的上下文图：

```
 +-------------+
input --> | Application | --> output
          +-------------+

You can zoom into the function to show detailed dataflow:

          +-------+      +--------+     +----------+
code  --> | lexer | -->  | parser | --> | treetool | --> grapical representation
          +-------+      +--------+     +----------+
              |              ^                 ^
              |              |                 |
              |              V                 |
              |    ================            |
              +--> | symbol table | -----------+
                   ================ 
```

如您所见，有函数和数据存储。函数可以更改数据，数据存储用于存储和检索数据。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-12-12T08:57:59.557

数据流图 (DFD) 是数据/信息流的图形表示。它用于显示数据如何在不同进程之间移动。

有4个基本符号元素：

*   圈子：操作
*   Box：信息的接收器，（输入/输出）
*   并行条：数据存储/文件/数据库
*   弧：信息/数据流

DFS 是在问题域中而不是在解决方案域中。它们基本上是基于信息流如何运作的顶级模型。在 DFD 中也不支持并发表示。

下面是一个例子：

![在此处输入图像描述](https://i.stack.imgur.com/kns17.png)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-16T14:19:51.107

上面解释了“什么”。

DFD 对项目经理没有帮助。DFD 主要用于开发人员很好地了解数据如何在（子）系统中的组件之间流动。

# c# - 构建搜索功能的最佳方式

> ID：450500
> 
> 赞同：4
> 
> 时间：2009-01-16T14:07:10.807
> 
> 标签：c#, sql-server, full-text-search

我有一个拥有超过 400,000 个项目的网站。有些相似，有些截然不同。我们希望提供一种以最佳方式搜索这些项目的方法。在交付网站后，它使用的是全文索引。解决方案充其量是基本的，最坏的情况是严重不足。

那么搜索这些项目的最佳方法是什么？它们存储在 SQL Server 数据库 (2005) 中。我们的网站是用 C# 2.0 设计的。

目前这里是这个过程：

1.  用户在文本框中输入值。
2.  我们“清理”这个条目。删除可能是黑客攻击的“可怕”字符。删除关键词（and, or, etc..）
3.  将值传递给存储过程以返回结果。
4.  返回结果。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-16T14:20:31.277

看看[Lucene.NET](http://lucenenet.apache.org/)。我认为这是对 SQL Server 中的全文搜索的巨大改进。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-16T14:30:28.107

SQL Server Central 有一篇关于使用 SQL Server 创建类似 Google 的全文搜索的好文章。不幸的是，您必须注册才能查看全文，但注册是免费的，而且他们发布了很多很好的信息。链接在这里：

[http://www.sqlservercentral.com/articles/Full-Text+Search+(2008)/64248/](http://www.sqlservercentral.com/articles/Full-Text+Search+(2008)/64248/)

摘抄：

> ...
> 
> 谷歌风格
> 
> 成功应用程序的关键是使其易于使用但功能强大。谷歌已经通过他们的网络搜索引擎做到了这一点。查询的语法简单直观，但功能齐全。虽然 Google 查询的基本构建块很简单，但您可以通过强大的方式将它们组合起来。我将从基本的 Google 查询语法开始，并添加一些额外的运算符以利用 SQL Server CONTAINS 谓词语法的强大功能。完整的 Google 语法在 [http://www.google.com/help/cheatsheet.html](http://www.google.com/help/cheatsheet.html)的 Google 帮助：备忘单中定义。
> 
> ...

这篇文章有完整的示例代码，甚至还有一个下载链接。即使您不打算实施它，它也是一本有趣的书。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-16T14:23:07.933

您可以查看 Lucene.net，它将最大限度地减少对搜索查询的数据库调用。

来自[http://incubator.apache.org/lucene.net/](http://incubator.apache.org/lucene.net/)

> Lucene.Net 是 Java Lucene 搜索引擎到使用 Microsoft .NET Framework 的 C# 和 .NET 平台的源代码、每个类、每个 API 和算法端口。
> 
> Lucene.Net 坚持使用 Lucene 的原始 Java 实现中使用的 API 和类。保留 API 名称和类名称的目的是使 Lucene.Net 具有 C# 语言和 .NET Framework 的外观和感觉。例如，Java 实现中的 Hits.length() 方法现在读取 C# 端口中的 Hits.Length()。
> 
> 除了 API 和类移植到 C# 之外，Java Lucene 的算法也移植到 C# Lucene。这意味着使用 Java Lucene 创建的索引与 C# Lucene 来回兼容；在阅读、写作和更新方面。事实上，可以使用 Java Lucene 和 C# Lucene 进程同时搜索和更新 Lucene 索引。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-16T14:47:52.643

您可以使用 Google 站点搜索来提供您的搜索结果。并不总是让您灵活地根据需要显示结果，但对于许多人来说已经足够了。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-16T14:22:17.750

第二步是相当有争议的——你认为哪些词是“可怕的”？如果您使用 SQL Server 内置的全文搜索，那么您可以在 sql server 中设置鼻子/停用词列表，而不是手动从输入查询中删除关键字。

这是我想在 StackOverflow 以及提供搜索功能的任何其他网站上看到的一项功能：

*   为文档的某些字段提供更多优先级（权重）（在 stackoverflow 的情况下 - 搜索应优先考虑主题标题）

还可以考虑为 FTS 使用 3rd 方解决方案，例如[Lucene](http://incubator.apache.org/lucene.net/)或[Sphinx](http://www.sphinxsearch.com/) - 它们可以提供比内置功能更好的用户体验。3rd 方 FTS 组件的一些优点是：减少数据库负载、更好的搜索结果相关性、更好的索引速度、更小的数据库大小。

# sql - 在实时数据库中迁移数据的查询？

> ID：450515
> 
> 赞同：2
> 
> 时间：2009-01-16T14:16:23.440
> 
> 标签：sql, sql-server, ms-access, migration

我正在编写代码以将数据从我们的实时 Access 数据库迁移到新的 Sql Server 数据库，该数据库具有不同的架构和重组的结构。此 Sql Server 数据库将与我们正在开发的应用程序的新版本一起使用。

我一直在用 C# 编写迁移代码，调用 Sql Server 和 Access 并根据需要转换数据。我第一次迁移了一个表，该表的条目与我最近未更新的另一个表的新条目相关，并且由于找不到 SQL Server 中相应表中的记录而导致错误

所以，我的 SqlServer 生产表的数据只到 09 年 1 月 14 日，我将继续从 Access 迁移更多表。所以我想写一个更新方法，可以弄清楚Access中没有反映在Sql Server中的新东西是什么。

我目前的想法是在 SQL 端编写一个查询，该查询执行 SELECT Max(RunDate) FROM ProductionRuns，为我提供表中该字段的最新日期。在访问端，我会编写一个查询，执行 SELECT * FROM ProductionRuns WHERE RunDate > ?，其中参数是在 SQL Server 中找到的最大日期，并在代码中执行我的翻译步骤，然后在 Sql Server 中插入新数据.

我想知道的是，我是否有正确的语法来获取该 Sql Server 表中的最新日期？有没有更好的方法来进行这种实时数据库的迁移？

编辑：我所做的是制作当前实时数据库的副本。然后我可以在不担心更改的情况下进行迁移，然后在开发期间使用它进行测试，然后我可以在新数据库和应用程序上线时迁移最新数据。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-16T14:31:54.780

我个人会将这个过程分为两个步骤。

1.  我将在 SQLServer 中创建 Access DB 的精确副本并复制所有数据
2.  将此临时 SQLServer 数据库中的数据复制到目标数据库

这样你就可以编写一组 SQL 代码来完成第二步任务

或者使用[SSIS](http://msdn.microsoft.com/en-us/library/ms141026.aspx)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-16T14:35:10.390

通常，当您将数据转换到将在生产中放置的新数据库时，您会关闭该数据库的所有用户一段时间，然后运行迁移并打开新数据库。这可确保在进行转换时不对数据进行任何更改。当然，我也永远不会使用 c# 来做到这一点。数据迁移是一项数据库任务，应该在 SSIS（或 DTS，如果您有旧版本的 SQL Server）中完成。

如果您要转换的数据库正在开发中，我会创建 Access 数据库的备份并从那里加载数据以测试数据加载过程并获取数据，以便您可以进行应用程序开发。然后，当需要进行真正的加载时，您只需向用户关闭真正的数据库并使用它来加载。如果您想在开发过程中保持两者同步，那么我不会这样做，但如果必须，请每晚备份文件并在早上使用您的流程加载第一件事。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-16T14:24:44.857

您可能想考虑投资[SQL Data Compare 之](http://www.red-gate.com/products/sql_data_compare/index.htm)类的工具。

我相信它也支持访问数据库，您可以下载试用版。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-16T14:37:15.270

我对你的 C# 代码很满意，但是由于目标数据库中的限制，它会失败，你可以暂时[禁用它们，然后在复制全部内容后启用](https://stackoverflow.com/questions/159038/can-foreign-key-constraints-be-temporarily-disabled-using-tsql#161410)。

我假设您的目标数据库是没有数据的全新数据库，并且在传输发生时未被任何人使用

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-16T14:56:10.817

听起来你有两个问题：

1.  您正在将数据从一个数据库迁移到另一个数据库。
2.  您正在更改您的架构。

如果您在人们使用数据的同时尝试迁移数据，那么执行这些操作中的任何一个都会很棘手。

最简单的方法是基于数据的静态副本迁移数据，并且从捕获静态副本的那一刻起将对该数据的更新排队。我不知道这在 Access 中有多容易，但在 SQLServer 或 Oracle 中，您可以为此使用重做日志或使用触发器的手动解决方案。穷人的做法是为所有记录已更改记录的主键的相关表创建触发器。然后在旧数据库关闭后，您可以遍历这些键并从旧数据库中获取这些记录并将它们放入新数据库中。只需复制整个记录；如果记录被删除，则将其从新数据库中删除。

您的问题因您不能简单地复制数据而变得更加复杂，您必须对其进行转换。这意味着您可能必须关闭两个数据库并根据更改列表重新迁移记录。需要进行大量计划才能确保您做对了，我建议您编写一个测试脚本来验证结果数据是否正确。

此外，如果可能，我会确保迁移代码在其中一个数据库中运行。否则，您将复制数据两次，这将严重损害性能。

# asp.net-mvc - asp.net mvc 发布会包含验证框架吗？

> ID：450516
> 
> 赞同：2
> 
> 时间：2009-01-16T14:16:36.370
> 
> 标签：asp.net-mvc

有谁知道验证将如何与 V1 一起工作？我正处于十字路口，使用其中一个框架还是等待 V1？

我的 asp.net mvc 开发已被搁置，直到我可以找到有关 v1 版本的更多信息以及验证将如何支持对象模型和 ui？有人有资料吗？

干杯!

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-16T15:40:14.300

来自[ASP.NET MVC 设计库和即将发布的 ASP.NET MVC 候选版本的视图改进](http://weblogs.asp.net/scottgu/archive/2008/12/19/asp-net-mvc-design-gallery-and-upcoming-view-improvements-with-the-asp-net-mvc-release-candidate.aspx#6798913)

> RC 还附带了许多其他功能和请求，包括：IDataErrorInfo 支持使模型能够显示验证错误消息，以及更丰富的错误验证可扩展性，使您能够使用自己的方法将模型验证错误显示到 ModelBinders（ IDataErrorInfo 支持建立在此之上）

.

> >>> 是否有计划提供一种基于模型规则提供客户端验证的方法，还是由开发人员决定？
> 
> 我们不会在 V1 中内置这个，尽管可以构建一个添加它的库。我们将考虑在未来启用一些涉及此的场景。
> 
> 希望这可以帮助，
> 
> 斯科特

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-17T00:14:41.297

正如 Scott Guthrie 所指出的，我们将支持 IDataErrorInfo，但是对于 1.0，我们将没有完整的端到端验证故事。IDataErrorInfo 支持是权宜之计。可以满足某些人的需求的东西，但不是每个人。

我们希望在 RTM 之后的某个时候有一个验证故事的原型。

# java - < 和 > 是什么意思，例如实现 Comparable ?

> ID：450520
> 
> 赞同：6
> 
> 时间：2009-01-16T14:19:26.443
> 
> 标签：java, generics, syntax, comparable

在[Java 1.4.2](http://www.oracle.com/technetwork/java/javase/index-jsp-138567.html)中，类[`java.math.BigInteger`](https://web.archive.org/web/20111208190928/https://docs.oracle.com/javase/1.4.2/docs/api/java/math/BigInteger.html)实现接口`Comparable`，`Serializable`.

在[Java 1.5.0](http://www.oracle.com/technetwork/java/javasebusiness/downloads/java-archive-downloads-javase5-419410.html)中，类[`java.math.BigInteger`](http://java.sun.com/j2se/1.5.0/docs/api/java/math/BigInteger.html)实现接口`Serializable`，`Comparable<BigInteger>`.

这只是帮助我询问`<`and的一个例子`>`。我真正想知道的是`<`和`>`东西。

我的问题有三个：

*   `<BigInteger>`声明的一部分是什么`implements`意思？
*   那语法叫什么？
*   它有什么作用？

PS：谷歌搜索真的很难，`<`而且一`>`开始就不可能搜索到。`<``>`

谢谢！

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-01-16T14:21:53.130

阅读[Java 泛型教程](http://java.sun.com/docs/books/tutorial/java/generics/index.html)。尖括号之间的东西是一个类型参数 - Comparable 是一个泛型类，在这种情况下，尖括号意味着该类可与其他 BigIntegers 进行比较。

对于这种情况的更多说明，请查看[Javadocs for Comparable](http://java.sun.com/j2se/1.5.0/docs/api/) in 1.5。请注意，它被声明为`Comparable<T>`，并且该`compareTo`方法采用类型的参数`T`。T 是一个类型参数，在使用接口时“填充”。因此在这种情况下，声明你实现`Comparable<BigInteger>`意味着你必须有一个`compareTo(BigInteger o)`方法。另一个类可能实现`Comparable<String>`意味着它必须实现一个`compareTo(String o)`方法。

希望您能从上面的代码片段中看到好处。在 1.4 中，签名`compareTo`只能采用 an，`Object`因为所有类型的类都实现了 Comparable，并且无法确切知道需要什么。但是，使用泛型，您可以指定您与特定类具有可比性，然后编写更具体的 compareTo 方法，该方法只将该类作为参数。

这里的好处是双重的。首先，您不需要`instanceof`在方法的实现中进行检查和强制转换。其次，编译器可以在编译时进行更多的类型检查——你不能不小心将 String 传递给 implements`Comparable<BigInteger>`的东西，因为类型不匹配。编译器能够向您指出这一点要好得多，而不是像在非泛型代码中通常发生的那样导致运行时异常。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-16T14:21:14.553

我很确定这是泛型

[http://java.sun.com/j2se/1.5.0/docs/guide/language/generics.html](http://java.sun.com/j2se/1.5.0/docs/guide/language/generics.html)

我问了类似的东西（C#），它有有用的信息[Method<ClassName> 是什么意思？](https://stackoverflow.com/questions/305651/what-does-methodclassname-mean)

# visual-studio-2008 - 查看 TFS 中所有更改的文件

> ID：450523
> 
> 赞同：10
> 
> 时间：2009-01-16T14:20:26.223
> 
> 标签：visual-studio-2008, tfs

我想生成在我的项目中已修改的所有文件的列表。我知道我可以查看项目的历史记录以获取所有变更集，然后查看包含文件的每个变更集，但是，此过程需要很长时间。有没有更简单的方法来生成这个列表？该列表不需要是唯一的，但这会很好。

谢谢！

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-05T20:23:26.113

在源代码管理资源管理器中，单击包含要检查的文件的文件夹，然后单击“比较文件夹”按钮。这将让您看到服务器源路径和本地路径之间的所有不同之处。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-23T13:08:49.197

您可以使用命令行来执行此操作。唯一的问题是您还会看到有关未更改的文件夹的信息。

例如：tf diff /format:Brief $/Path/To/Solution;C12345~C12355 /recursive

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-12-30T13:27:32.540

我最近遇到了类似的问题，我编写了一个程序来获取已更改文件的列表。这是我用来创建程序的示例的链接 [区分两棵树](http://blogs.msdn.com/roberthorvick/archive/2006/04/07/571043.aspx)

# ruby - 鞋子有列表视图控件吗？

> ID：450535
> 
> 赞同：3
> 
> 时间：2009-01-16T14:23:04.003
> 
> 标签：ruby, shoes

我正在查看 Shoes，它似乎是用于快速 GUI 应用程序的一个非常好的工具。然而，常见的元素/控件似乎不包括列表/报告视图的等效项（*例如*，Windows 中的 ListView，OS X 中的 NSTableView）。

我只是错过了这个，还是它（还）不存在？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-16T14:59:38.623

好像没有。鞋类[似乎](http://help.shoooes.net/Classes.html)没有提到任何类似的东西。

我想手动创建类似的东西应该不会太难。[good-vjot.rb](http://github.com/why/shoes/blob/f107ec71ca58ddeaea09d85f1f11197a13f15561/samples/good-vjot.rb)示例脚本可能是我能想到的最接近的，虽然它几乎不完全相同..

[Martin DeMello 的 Gooey Challenge（使用鞋子小部件构建自定义鞋子控件）](http://hackety.org/2008/06/12/martinDemellosGooeyChallenge.html)可能会有所帮助

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-11-20T00:22:21.537

如果您的意思是输出大量的文本数据，例如报告或表格，那么鞋盒中有一个非常简单的应用程序，称为[简单表格类](http://the-shoebox.org/apps/101)，它工作得非常好。在我找到它之前，我已经准备好放弃鞋子了——但这门课在几分钟内就解决了我的问题。

在寻找它时，我偶然发现了[鞋带](http://github.com/eveel/laces)，其中包括一个名为 The Tablie 的类。我还没试过，但我突然很感兴趣......

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-19T00:16:06.450

```
Shoes.app do
  stack do
    @l = list_box :items => ["YES", "NO"] do
      alert @l.text
    end
  end
end 
```

# windows - 如何在 Windows 中获得 common-lisp GUI？

> ID：450538
> 
> 赞同：17
> 
> 时间：2009-01-16T14:23:57.370
> 
> 标签：windows, graphics, common-lisp, slime

我正在使用带有 CLISP 和 Slime 的 Emacs，并且希望能够在屏幕上绘制图片。我特别考虑绘制图表，但任何能让我绘制基本形状并操纵它们的东西都可以让我开始。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-01-17T19:07:58.827

道格是对的；CAPI 可以正常工作。您可以尝试的其他事情：

cltk：[http ://www.cliki.net/Lisp-Tk](http://www.cliki.net/Lisp-Tk)

我知道 Allegro 也有一些用于 Windows 编程的东西，但我从未尝试过。

也可以工作的是细胞-gtk：[http ://common-lisp.net/project/cells-gtk/](http://common-lisp.net/project/cells-gtk/)

再说一次，我只能告诉你它存在，但不能告诉你它有多糟糕，或者它是否真的有效......

我也不能评论 [http://www.cliki.net/GTK%20binding的质量](http://www.cliki.net/GTK%20binding)

但这主要是可用的。

Corman Lisp 可能也为 Windows 编程提供了一些东西。

无论如何，Windows 上的选择相对较少。你可能对 CAPI 最有信心，它用于 Windows、Linux、MacOS X 和相当多的大型 unice 上的 LispWorks IDE...

问候

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-01-28T16:50:12.343

我想我已经找到了自己的答案。[Clojure](http://clojure.org/)似乎拥有我想要的一切，只是因为我现在可以在 LISP 中本地使用所有 Java GUI 项。它是与我使用的 Common-Lisp 不同的 LISP 方言，但似乎有很多社区支持，并且通过 SLIME 或通过 Inferior-Lisp 解释器与我的 Windows 安装的 Emacs 集成。到目前为止，我印象非常深刻。

哦，一个代码示例：

```
(. javax.swing.JOptionPane (showMessageDialog nil "Hello World")) 
```

任何猜测这是做什么的？:)

Bill Clementson 的博客有很多关于 Clojure 的内容，包括很多关于安装它的有用帖子。见这里：[他在 Clojure 上的帖子](http://www.google.com/search?q=clojure+site:bc.tech.coop/blog)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-17T19:01:45.843

您可以从 CLISP 切换到[免费的 LispWorks 个人版](http://www.lispworks.com/)并使用[CAPI](http://www.lispworks.com/products/capi.html)图形端口绘图 API。

或者您可以使用 Lisp 的[Foreign Function Interface](https://stackoverflow.com/questions/379136/can-i-extend-lisp-with-c#379144)并使用适用于您的操作系统的图形工具包之一。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-17T09:10:22.533

滚动你自己的（就像你说的，基本形状）尝试[Lispbuilder-SDL](http://lispbuilder.sourceforge.net/lispbuilder-sdl.html)或其中一个 cl-cairo FFI（不过我猜后者适用于 MS Windows）。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2010-01-20T18:04:22.107

我知道这是一篇旧帖子，但是这里的信息是为像我这样发现这个线程正在寻找相同内容的其他人提供的。

这个在 common lisp 中用于 tk 绑定的库似乎工作得相当好。 [http://www.peter-herth.de/ltk/](http://www.peter-herth.de/ltk/)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-12T18:06:26.013

Clojure 是一个优秀的 Lisp，而 Swing 是一个可靠的（如果不是特别令人兴奋的）窗口工具包。如果您想做更高级的图形和/或涉足游戏编程，您可能需要查看[Slick](http://slick.cokeandcode.com/)，这是一个通用图形/游戏库，位于 Swing 之上，可让您访问 OpenGL 和许多其他东西。

我发现 Clojure/Slick 组合是进行探索性图形编程的绝佳方式，因为您可以直接从 REPL 与图形窗口进行交互。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-10-25T17:46:14.253

有[cl-cairo2](http://common-lisp.net/project/cl-cairo2/) - 与 Cairo 矢量绘图库的绑定。它可用于在各种表面上绘制各种图片。有一个[cl-2d](http://www.cliki.net/cl-2d)库，它使用 cl-cairo2 来绘制图表。

还有[cl-gtk2](http://common-lisp.net/project/cl-gtk2/) - 与 Gtk+ 库的绑定。您可以创建使用 cl-cairo2（或 cl-2d）绘制的小部件，以绘制您想要的内容。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2011-03-24T01:39:29.370

CLISP 用户可能会发现以下内容对他们的图形应用程序很有用：

> cl-vectors 是一个纯 Common Lisp 库，用于创建、转换和渲染抗锯齿矢量路径。它可以使用 ASDF-Install 安装。 [http://projects.tuxee.net/cl-vectors/](http://projects.tuxee.net/cl-vectors/)
> 
> Vecto 是强大的 CL-VECTORS 矢量光栅化库的简化接口......结果可以保存到 PNG ......因为 Vecto 和所有支持库完全用 Common Lisp 编写，而不依赖于外部非 Lisp 库，它应该可以在任何 Common Lisp 环境中工作。Vecto 在类似 BSD 的许可证下可用。当前版本为 1.4.3，于 2009 年 8 月 26 日发布。 [http://www.xach.com/lisp/vecto/](http://www.xach.com/lisp/vecto/)

# winforms - VS 2008 WinForms 与 SourceSafe

> ID：450541
> 
> 赞同：0
> 
> 时间：2009-01-16T14:26:18.053
> 
> 标签：winforms, visual-studio-2008, visual-sourcesafe

我们正在使用 Visual Studio 2008 开发存储在 Visual Source Safe 2005 中的 winforms 应用程序。

如果我们的团队成员之一更改 *.Designer.cs 文件而不更改表单的源文件，则在“获取”操作期间不会出现更改。但是，如果在 Visual Studio 中对 *.Designer.cs 文件运行比较，则差异将显示在差异查看器中。

仅供参考：我们正在为 Visual Studio 使用默认的 Microsoft Visual SourceSafe 插件。

为什么“获取”操作不会检测到 *.Designer.cs 文件中的更改并建议我们下载最新版本的任何想法？

谢谢你的帮助！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-16T14:35:34.430

设计器文件不适用于手动操作。事实上，将部分类添加到流行的 .Net 语言的主要动机之一是将设计人员生成的代码与手动用户代码分开。手动操作重复生成的代码（在几乎任何环境中，而不仅仅是在 Visual Studio 中）都让人头疼。

您对设计器文件进行了哪些更改，为什么不能对非设计器源文件进行这些更改？

编辑：

IDE 中的项目是否正确绑定并连接到源代码管理数据库（通过 File->Source Control->Change Source Control）？在设计器视图中进行更改时，它应该会自动检出设计器文件。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-16T15:36:46.710

不得不使用 SourceSafe 让你有祸了。在我上一份工作中，我们使用了 SourceSafe，但遇到了无数问题。我们切换到环绕 SCM 并且对它非常满意。在那份工作之前我从未听说过它。

为了回答你的问题，每当我遇到这样的 SS 问题时，我都会做一个“强制获取”：当你获取最新版本时，在选项对话框中，告诉 SourceSafe 从服务器获取最新版本，不管它是否认为文件是最新的。

编辑：我认为问题在于 VSS 的 VS200X 插件。如果您有 VSS 独立应用程序，您应该能够从那里强制获取。我现在记得必须经常这样做，以至于我停止使用 VS200X 插件。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-16T15:46:46.563

我会尝试通过 VSS Explorer（即不通过 Visual Studio）手动执行 Get 并查看它是否有效。如果没有，请检查文件是否固定到以前的版本。

# jsf - 使用请求参数打开详细视图

> ID：450546
> 
> 赞同：4
> 
> 时间：2009-01-16T14:28:42.540
> 
> 标签：jsf, richfaces, myfaces

我使用 myfaces 和 richfaces 创建了一个简单的主/细节。通过单击 rich:dataTable 中的 ah:commandLink，用户可以打开详细视图并编辑实体。

现在我想创建一个允许用户直接打开详细视图的 URL。通常我会通过创建像 /detail.jsp?id=12 这样的 URL 来实现这一点 - 我如何使用 JSF 实现这一点？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-17T13:40:40.763

您可以使用链接控件上的参数构造 URL：

```
 <h:outputLink value="reqscope.faces">
        <f:param name="id" value="#{row.id}" />
        <h:outputText value="link" />
    </h:outputLink> 
```

在目标页面上，您可以直接使用表达式语言或通过托管 bean 从参数映射中读取 id。

看法：

```
<f:view>
    id= <h:outputText value="#{param['id']}" />
    <br />
    id= <h:outputText value="#{lookupBean.id}" />
</f:view> 
```

豆：

```
public class LookupBean implements Serializable {

    public String getId() {
        FacesContext context = FacesContext.getCurrentInstance();
        ExternalContext extContext = context.getExternalContext();
        Map<String, String> params = extContext.getRequestParameterMap();
        return params.get("id");
    }

} 
```

faces-config.xml 声明：

```
<managed-bean>
    <managed-bean-name>lookupBean</managed-bean-name>
    <managed-bean-class>reqscope.LookupBean</managed-bean-class>
    <managed-bean-scope>request</managed-bean-scope>
</managed-bean> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-20T15:43:34.330

我使用 a4j:commandlink 首先将要显示详细信息的实体的 id 传递给详细信息视图 bean。然后我只需使用 document.location 导航到视图。

```
<a4j:commandLink action="#{detailviewBean.setDetailID(entity.someid)}" value="#{entity.someid}" oncomplete="document.location='/app/detailview.seam'"/> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-26T13:52:11.927

如果您使用的是 JSF 1.2，则可以使用 f:setPropertyActionListener：

```
<h:commandLink action="#{reqscope.faces}">
    <h:outputText value="link"/>
    <f:setPropertyActionListener 
        value="#{id}" 
        target="#{lookupBean.id}"/>
</h:commandLink> 
```

[从 LinkBut​​ton 参数执行方法](http://wiki.apache.org/myfaces/ExecutingMethodsFromLinkButtonParameters)

# lucene - 如何使 Lucene 匹配查询中的所有单词？

> ID：450547
> 
> 赞同：15
> 
> 时间：2009-01-16T14:29:05.207
> 
> 标签：lucene, search

我正在使用 Lucene 允许用户在大量文档中搜索单词。Lucene 似乎默认返回包含输入的任何单词的所有文档。

是否有可能改变这种行为？我知道“+”可用于强制包含一个术语，但我想将其设为默认操作。

理想情况下，我希望类似于 Google 的功能：“-”排除单词，“abc xyz”对单词进行分组。

**只是为了澄清** 我还想过在查询中的所有空格中插入“+”。我只是想避免检测分组术语（括号、引号等）并可能破坏查询。还有另一种方法吗？

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2009-01-27T12:58:01.377

这看起来类似于[Lucene Sentence Search](https://stackoverflow.com/questions/465118/lucene-sentence-search)问题。如果你有兴趣，我是这样回答这个问题的：

```
String defaultField = ...;
Analyzer analyzer = ...;
QueryParser queryParser = new QueryParser(defaultField, analyzer);

queryParser.setDefaultOperator(QueryParser.Operator.AND);

Query query = queryParser.parse("Searching is fun"); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-29T08:36:59.373

就像[亚当](https://stackoverflow.com/questions/450547/how-to-make-lucene-match-all-words-in-query#483298)说的那样，不需要对查询字符串做任何事情。QueryParser 的[setDefaultOperator](http://hudson.zones.apache.org/hudson/job/Lucene-trunk/javadoc//org/apache/lucene/queryParser/QueryParser.html#setDefaultOperator(org.apache.lucene.queryParser.QueryParser.Operator))完全符合您的要求。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-16T14:43:57.267

为什么不直接[解析用户搜索输入并使用](http://lucene.apache.org/java/2_3_2/api/index.html)[Lucene 查询语法](http://lucene.apache.org/java/2_3_2/queryparsersyntax.html)对其进行调整以适应您的条件，然后再将其传递给 Lucene。或者，您可以创建一些关于如何使用标准语法创建特定查询的帮助文档，并让用户决定应该如何执行查询。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-16T14:45:18.373

Lucene 有一个广泛的查询语言，如[这里](http://lucene.apache.org/java/2_3_2/queryparsersyntax.html)所述，它描述了您想要的所有内容，除了 + 是默认值，但您可以通过将空格替换为 + 来简单处理。因此，您唯一需要做的就是定义您希望人们输入搜索查询的格式（我强烈建议您遵守默认的 Lucene 语法），然后您可以编写从您自己的语法到 Lucene 语法的转换。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-17T00:52:50.067

[该行为在类 org.apache.lucene.queryParser.QueryParser](http://lucene.apache.org/java/2_4_0/api/org/apache/lucene/queryParser/QueryParser.html#addClause(java.util.List,%20int,%20int,%20org.apache.lucene.search.Query))的方法 addClause(List, int, int, Query) 中被硬编码，因此更改行为的唯一方法（除了上述解决方法）是更改该方法. 该方法的结尾如下所示：

```
if (required && !prohibited)
  clauses.addElement(new BooleanClause(q, BooleanClause.Occur.MUST));
else if (!required && !prohibited)
  clauses.addElement(new BooleanClause(q, BooleanClause.Occur.SHOULD));
else if (!required && prohibited)
  clauses.addElement(new BooleanClause(q, BooleanClause.Occur.MUST_NOT));
else
  throw new RuntimeException("Clause cannot be both required and prohibited"); 
```

将“SHOULD”更改为“MUST”应该使子句（例如单词）默认需要。

# asp-classic - vbscript / Classic ASP - 有没有办法以编程方式获取您自己的文件名？

> ID：450552
> 
> 赞同：3
> 
> 时间：2009-01-16T14:30:41.633
> 
> 标签：asp-classic, vbscript, filenames

我只是在查看一些旧代码并发现以下内容（在 foo.asp 中）：

```
Const ASP_FILENAME = "foo.asp"  ' TODO: Update this to the name of this file (if changed) 
```

该变量仅用于记录错误。（即“foo.asp 中的错误 - 无法创建 xxxxx 对象。”）有没有办法避免这种情况？

谢谢！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-16T14:41:24.543

您可以解析`Request.ServerVariables("url")`以获取文件名部分。谷歌搜索发现[了这段代码](http://www.experts-exchange.com/Web_Development/Web_Languages-Standards/ASP/Q_22678316.html)，我不认为它使用了 SCRIPT_NAME 服务器变量，这似乎确实更有意义，还考虑了可能存在的任何 url 重写：

```
function getFileName(fpath, returnExtension)
        tmp = fpath
        if instrRev(tmp,"/") > 0 then
              tmp = mid(tmp, instrRev(tmp,"/")+1)
        end if
        if returnExtension = false then
              if instrRev(tmp,".") > 0 then
                    tmp = left(tmp, instrRev(tmp,".")-1)
              end if
        end if
        getFileName = tmp
  end function

  filename = request.ServerVariables("SCRIPT_NAME")
  Const ASP_FILENAME = getFileName(filename, true) 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-16T14:45:45.767

来自现已解散的 Aspfaq.com（感谢[Archive.org](https://web.archive.org/web/20070203053627/http://classicasp.aspfaq.com/files/directories-fso/how-do-i-get-the-name-of-the-current-url/page.html)）：

**如何获取当前 URL/页面的名称？**

这个很简单，但是有两个部分。

要检索当前文件的名称，您可以使用以下任何一种：

```
<% 
    Response.Write Request.ServerVariables("SCRIPT_NAME") & "<br>" 
    Response.Write Request.ServerVariables("PATH_INFO") & "<br>" 
    Response.Write Request.ServerVariables("URL") & "<br>" 
%> 
```

要使该路径成为本地路径（例如，与 FileSystemObject 一起使用），只需将 server.mappath() 方法应用于结果。

要获取整个 URL，包括 http:// 或 https:// 前缀，您可以这样做：

```
<% 
    prot = "http" 
    https = lcase(request.ServerVariables("HTTPS")) 
    if https <> "off" then prot = "https" 
    domainname = Request.ServerVariables("SERVER_NAME") 
    filename = Request.ServerVariables("SCRIPT_NAME") 
    querystring = Request.ServerVariables("QUERY_STRING") 
    response.write prot & "://" & domainname & filename & "?" & querystring 
%> 
```

要仅获取页面名称，请使用以下内容：

```
<% 
    scr = Request.ServerVariables("SCRIPT_NAME") & "<br>" 
    if instr(scr,"/")>0 then 
        scr = right(scr, len(scr) - instrRev(scr,"/")) 
    end if 
    response.write scr 
%> 
```

或者，没有 IF 逻辑：

```
<% 
    scr = Request.ServerVariables("SCRIPT_NAME") & "<br>" 
    loc = instrRev(scr,"/") 
    scr = mid(scr, loc+1, len(scr) - loc) 
    response.write scr 
%> 
```

现在。如果您的文件是另一个文件中的#INCLUDE，则上述脚本将生成 CALLING 文件的名称（由于包含的文件首先集成到调用脚本中，因此其中的 ASP 全部在“父”的上下文中执行' 文件）。解决此问题的一种方法是在加载每个包含文件之前重新填充 current_filename 变量，例如：

```
<% 
      current_filename = "filetoinclude.asp" 
 %> 

<!--#include file='filetoinclude.asp'--> 
```

（不，不要尝试将 current_filename 作为变量传递给 #INCLUDE 指令；请参阅文章 #2042。）

然后，在 filetoinclude.asp 中：

```
<% 
    Response.Write "Current file: " & current_filename 
%> 
```

当然，您也可以轻松地在每个包含文件中硬编码文件名。但是我认为该解决方案会在某种程度上破坏至少在某种程度上动态地检索该信息的目的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-16T14:42:46.647

我不知道 server.mappath 是否存在于传统的 asp 中，但如果存在，您可以使用 if 来了解页面文件名。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2015-09-21T19:27:18.513

并不是说这里的任何人 [在此处插入离散的清嗓子] 仍然使用 Classic ASP 来维护和支持遗留应用程序，但我最近需要做一些类似的事情。拒绝接受“经典 ASP 不可能”的回应，我开始寻找方法并提出以下解决方案。

这种方法基本上利用底层操作系统命令来逐字确定**当前文件名**（其结果等同于使用`__FILE__`PHP 中的魔术常量），无论它是文件包含（`*.inc`）还是脚本本身（`*.asp`）。

首先，为了支持一些清理（如果你愿意，你可以用其他一些更“最佳”的方式来做到这一点）：

```
'Regex helpers
Function NewRegex(ByVal pattern, ByVal ignore_case, ByVal global)
  Set NewRegex = New RegExp
  NewRegex.Pattern = pattern
  NewRegex.IgnoreCase = ignore_case
  NewRegex.Global = global
End Function

Function RegexMatch(ByVal pattern, ByVal subject)
  RegexMatch = RegexMatches(subject, pattern, True, False)
End Function

Function RegexMatches(ByVal subject, ByVal pattern, ByVal ignore_case, ByVal global)
  RegexMatches = NewRegex(pattern, ignore_case, global).Test(subject)
End Function 
```

现在是“反思”的时间：

```
Function GetCurrentFilename(ByVal uniqueId)
  '1\. Enforce uniqueId format
  If Not RegexMatch("^[0-9a-f]+$", uniqueId) Then
    Exit Function
  End If

  '2\. Use findstr to scan "readable" files in current directory for uniqueId
  Dim shell, cmd, process, fs, filename
  Set shell = Server.CreateObject("WScript.Shell")

  'See findstr /? for details on switches used below
  'cmd = C:\Windows\system32\cmd.exe /c findstr /P /M /C:"uniqueId" "C:\Inetpub\wwwroot\includes\*"
  cmd = shell.ExpandEnvironmentStrings("%COMSPEC%") & " /c findstr /P /M /C:""" & uniqueId & """ """ & Server.MapPath(".") & "\*"""
  Set process = shell.Exec(cmd)

  '3\. Use Scripting.FileSystemObject to return the filename portion of the first result returned
  Set fs = Server.CreateObject("Scripting.FileSystemObject")
  GetCurrentFilename = fs.GetFileName(process.StdOut.ReadLine())

  Set fs = Nothing
  Set process = Nothing
  Set shell = Nothing
End Function 
```

然后，在您想要“检查”当前文件名的任何文件中，只需删除以下行，传入一些唯一标识符，该标识符不应存在于当前目录中的任何其他文件中，但这个文件：

```
'myfile.inc
Response.Write "This is in " & GetCurrentFilename("908ab098c") 
```

结果：

```
This is in somefile.inc 
```

哦，如果你对我需要用它来做什么感兴趣，下面是它在一个简单的断点函数中使用的样子：

```
Function Breakpoint(ByVal line_no, ByVal uniqueId, ByVal msg)
  Dim fn
  fn = GetCurrentFilename(uniqueId)

  Response.Write "[!] Breakpoint hit at Line " & CLng(line_no) & " in " & fn & ": " & Server.HtmlEncode(msg) & vbNewLine
  Response.End
End Function 
```

这样在我的代码的第 20 行，如果我想添加自己的断点，它看起来像这样：

```
Breakpoint 20, "B0001", "Some debug output here" 
```

输出：

```
[!] Breakpoint hit at Line 20 in somefile.inc: Some debug output here 
```

快乐编码！

# java - 定制弹簧范围？

> ID：450557
> 
> 赞同：13
> 
> 时间：2009-01-16T14:33:10.630
> 
> 标签：java, spring

[任何人都知道除了Servlet Context Scope](http://www.springbyexample.org/examples/custom-servlet-context-scope-module.html)和[ThreadScope](http://www.springbyexample.org/examples/custom-thread-scope-module.html)之外的任何其他自定义弹簧范围？

如果您制作了一些闭源自定义范围，我真的很想听听它的作用以及它对您的效果。（我想有人会在桌面应用程序中制作 WindowScope 吗？）

我对所有用例持开放态度，我希望在这里扩大我的视野。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-01-16T14:52:46.487

We implemented our own custom Spring scope. A lot of our code works at a relatively low level, close to the database, and we maintain a conceptual level on top of that with its own object model of data sources, links, attributes etc.

Anyway, a lot of beans require a so-called StorageDictionary (an encapsulation of this object graph) to do their work. When we make non-trivial changes to the object graph, the dictionary sometimes needs to be blown away and recreated. Consequently, we implemented a custom scope for objects that were *dictionary scoped*, and part of the invalidation of a given dictionary involves clearing this custom scope. This lets Spring handle a nice form of automatic caching for these objects. You get the same object back every time up until the dictionary is invalidated, at which point you get a new object.

This helps not only with consistency but also allows the objects themselves to cache references to entities within the dictionary, safe within the knowledge that the cache will be valid for as long as they themselves are retrievable by Spring. This in turn lets us build these as immutable objects (so long as they can be wired via constructor injection), which is a very good thing to do anyway wherever possible.

This technique won't work everywhere and does depend heavily on the characteristics of the software (e.g. if the dictionary was modified regularly this would be horribly inefficient, and if it was updated never this would be unnecessary and slightly less efficient than direct access). However, it has definitely helped us pass off this management of lifecycle to Spring in a way that is conceptually straightforward and in my opinion quite elegant.

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-16T17:45:49.553

在我的公司，我们创建了两个自定义范围，一个将使用 Thread 或 Request，另一个将使用 Thread 或 Session。这个想法是单个作用域可以用于作用域 bean，而无需根据执行环境（JUnit 或 Servlet 容器）更改配置。当您在 Quartz 中运行项目并且不再有可用的请求或会话范围时，这也非常有用。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-06-09T18:23:43.337

背景：

我在一个 Web 应用程序上工作，该应用程序在同一个 servlet 上下文下运行 4 个不同的网站。每个站点都有自己的域名，例如 www.examplesite1.com、www.examplesite2.com 等。

问题：

站点有时需要来自应用程序上下文的自定义 bean 实例（通常用于自定义消息显示或对象格式）。

例如，假设站点 1 和 2 都使用“standardDateFormatter”bean，站点 3 使用“usDateFormatter”bean，站点 4 使用“ukDateFormatter”bean。

解决方案：

我打算使用“站点”范围。

我们有一个像这样的站点枚举：

```
enum Site {
    SITE1, SITE2, SITE3, SITE4;
} 
```

然后我们有一个过滤器，它使用 ThreadLocal 将这些站点值之一存储在请求的线程中。这是站点范围的“对话 ID”。

然后在应用程序上下文中会有一个名为“dateFormatter”的bean，带有“scope =“site”。然后，无论我们想在何处使用日期格式化程序，都将使用用户当前站点的正确格式化程序。

**后来补充：**

示例代码在这里：

[http://github.com/eliotsykes/spring-site-scope](http://github.com/eliotsykes/spring-site-scope)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2010-03-05T13:54:52.180

Apache Orchestra 提供[SpringConversationScope](http://myfaces.apache.org/orchestra/myfaces-orchestra-core/apidocs/org/apache/myfaces/orchestra/conversation/spring/SpringConversationScope.html)。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-01-25T13:31:34.790

[Oracle Coherence](http://www.oracle.com/technology/products/coherence/index.html)已经[为 Spring bean 实现了一个数据网格范围](http://wiki.tangosol.com/display/INCUBATOR/Data+Grid+Beans)。把它们加起来：

> **数据网格 Bean**是 java.io.Serializable Bean 实例的代理，该实例存储在未过期的 Coherence 分布式缓存（称为 near-datagridbeans）中。

我自己从未使用过它们，但它们看起来很酷。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2017-10-05T15:30:54.150

在 Spring Batch 应用程序中，我们实现了一个**item scope**。

### 背景

我们有很多`@Service`组件可以根据当前的批次项目计算一些东西。他们中的许多人需要相同的工作流程：

1.  确定相关的项目部分。
2.  根据项目初始化东西。
3.  对于每个项目部分，计算一些东西（使用东西）。

我们将工作流移到基类模板方法中，因此子类仅实现`findItemParts(Item)`（执行 1 和 2）和`computeSomething(ItemPart)`（执行 3）。因此它们变得有状态（在`findItemParts`中需要初始化的东西`computeSomething`），并且必须在下一个项目之前清除该状态。

其中一些服务还涉及注入的 Spring bean，它们也是从当前项目派生的，之后必须删除。

### 设计

我们实现了一个`AbstractScopeRegisteringItemProcessor`which 注册项目并允许子类注册派生 bean。在其`process`方法结束时，它从其范围上下文中删除该项目，并使用`DefaultSingletonBeanRegistry.destroySingleton`.

### 结果如何

它有效，但存在以下问题：

1.  我们没有设法在没有注册的情况下清理派生 bean（仅基于它们的`@Scope`）。具体处理器必须创建并注册它们。
2.  `AbstractScopeRegisteringItemProcessor`使用组合并动态实现底层处理器的所有接口会更好。但是结果`@StepScope`bean 是[声明的返回类型](https://jira.spring.io/browse/BATCH-2169)（即`AbstractScopeRegisteringItemProcessor`or `ItemProcessor`）的代理，没有所需的回调接口。

## 编辑

在@Eliot Sykes 的[解决方案](https://stackoverflow.com/a/971703/2099362)和共享代码以及@Cheetah 的[BeanDefinition 注册](https://stackoverflow.com/a/25673878/2099362%20BeanDefinition%20registration)的帮助下，我能够摆脱作为单例 bean 的注册。相反，`ItemScopeContext`（处理器和`Scope`实现都使用的存储；通过静态`@Bean`方法配置的 Java）实现`BeanDefinitionRegistryPostProcessor`. 它注册一个`FactoryBean`其`getObject()`返回当前项目或如果没有则抛出异常。现在，带`@Component`注释的 with`@Scope(scopeName = "Item", proxyMode = ScopedProxyMode.TARGET_CLASS)`可以简单地注入项目而无需注册以进行范围结束清理。

所以最后，效果很好。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2014-12-17T05:36:07.460

在我公司，我们也实现了 spring 自定义范围。我们有一个多租户系统，每个客户都可以自定义设置。**我们基于实例**的范围，缓存客户特定的 bean。因此，每次客户的用户登录时，这些设置都会被缓存并在同一客户的其他用户登录时再次重复使用。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2011-10-15T07:51:01.313

基于 Web 应用程序的用户区域设置的 Spring 区域设置范围

查看[相关的维基页面](http://code.google.com/p/utils-apl-derived/wiki/LocaleBeanScope)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2017-10-09T14:16:55.147

我曾经使用过一种*会话作用域*来存储会话作用域中的一些对象，以便在重新进入同一页面时保留它们，但仅限于单个页面以避免在会话中留下无用的对象。该实现只存储页面 URL 并在每个页面更改时清理*对话范围。*

# c++ - 用于计算循环缓冲区中剩余空间的简化算法？

> ID：450558
> 
> 赞同：8
> 
> 时间：2009-01-16T14:33:23.717
> 
> 标签：c++, circular-buffer

我想知道是否有比这更简单（单一）的方法来计算循环缓冲区中的剩余空间？

```
int remaining = (end > start)
                ? end-start
                : bufferSize - start + end; 
```

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-01-16T14:41:59.940

如果您担心预测不佳的条件会减慢 CPU 的流水线速度，可以使用以下方法：

```
int remaining = (end - start) + (-((int) (end <= start)) & bufferSize); 
```

但这可能是过早的优化（除非您确实将其确定为热点）。坚持您当前的技术，这更具可读性。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-01-16T15:11:35.683

嗯……

```
int remaining = (end - start + bufferSize) % bufferSize; 
```

13个代币，我赢了吗？

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2011-08-18T19:37:46.390

如果您的循环缓冲区大小是 2 的幂，您可以通过在虚拟流中使用`start`并表示位置而不是循环缓冲区存储中的索引来做得更好。`end`假设`start`和`end`是无符号的，上面变成：

```
int remaining= bufferSize - (end - start); 
```

实际上从缓冲区中取出元素有点复杂，但是开销通常足够小，具有 2 大小的循环缓冲区（只是用 屏蔽`bufferSize - 1`），以使循环缓冲区的所有其他逻辑更加简单和清晰。另外，您可以使用所有元素，因为您不再担心`end==start`！

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-16T14:51:28.500

根据 C++ 标准，第 5.6 节，第 4 段：

> 二元 / 运算符产生商，二元 % 运算符产生第一个表达式除以第二个表达式的余数。如果 / 或 % 的第二个操作数为零，则行为未定义；否则 (a/b)*b + a%b 等于 a。如果两个操作数都是非负数，则余数是非负数；如果不是，则余数的符号是​​实现定义的。

一个脚注建议最好将商四舍五入为零，这将使余数为负数。

因此，这些`(end - start) % bufferSize`方法不能可靠地工作。C++ 没有模运算（无符号整数类型提供的意义除外）。

j_random_hacker 推荐的方法不同，看起来不错，但我不知道它在简单性或速度方面有什么实际改进。boolean 到 int 的转换很巧妙，但需要心理解析，而且这种摆弄可能比使用 ?: 更昂贵，具体取决于编译器和机器。

我认为你已经有了最简单和最好的版本，我不会改变它。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-16T14:40:01.690

失去条件：

```
int remaining = (end + bufferSize - start - 1) % bufferSize + 1 
```

编辑：`-1`and`+1`适用于 when 的情况`end == start`。在这种情况下，此方法将假定缓冲区为空。根据缓冲区的具体实现，您可能需要调整这些以避免出现偏离 1 的情况。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2017-11-13T20:28:44.487

我知道较旧的线程，但认为这可能会有所帮助。

不确定这在 C++ 中实现的速度有多快，但在 rtl 中，如果大小为 n^2，我们会这样做

```
remaining = (end[n] ^ start[n])
            ? start[n-1:0] - end[n-1:0]
            : end[n-1:0] - start[n-1:0]; 
```

或者

```
remaining = if (end[n] ^ start[n]) {
              start[n-1:0] - end[n-1:0]
            } else { 
              end[n-1:0] - start[n-1:0] 
            }; 
```

# tfs - 仅在新的失败构建上创建 TFS 工作项

> ID：450560
> 
> 赞同：3
> 
> 时间：2009-01-16T14:34:19.130
> 
> 标签：tfs

我已经看到有关在所有失败的构建上禁用工作项创建的帖子，但我希望 TFS 仅在第一次失败时创建工作项。我们有一个非常复杂的遗留系统，其中涉及 VB6 COM 组件，并且经常在构建服务器上出现构建失败，这可以追溯到 VB6 对二进制文件（frx、ctl 等）所做的一些有趣的事情——如果您不必处理有一段时间，你不想）。解决这些问题的唯一方法是尝试在开发机器上进行更新，然后签入文件并再次运行构建（因为在开发机器上构建不会失败）。因此，在我们获得成功之前，我们可能有三到四个（或更多）失败的构建，这意味着我们将有三到四个工作项要关闭。

理想情况下，我想要以下内容：

1.  Joe 签入导致构建失败的更改
2.  一个工作项被创建并分配给 Joe
3.  Joe 签入另一个更改，但构建仍然失败
4.  无需创建额外的工作项
5.  Joe 签入构建成功的更改
6.  在上述步骤 2 中分配给 Joe 的工作项被标记为已关闭

但我会很高兴只有第 1 步到第 4 步。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-19T15:41:00.717

由于涉及到额外的签入，您如何确定第二个失败的构建与第一个相关？如果下一次签入实际上是其他开发人员提交的附加代码会发生什么 - 你希望他们知道他们的代码破坏了构建，或者它仍然被破坏，即使根据你的步骤，什么都不会被触发。

您要么需要找到一种方法来链接构建 - 例如，跟踪自动工作项分配给谁，然后在成功构建之前不要为该开发人员的签入创建另一个工作项，也许你可以以某种方式为其他开发人员排队构建。我不确定你会怎么做。

这会让你朝着正确的方向前进吗？

# c++ - 如何最好地实施 BCD 作为练习？

> ID：450561
> 
> 赞同：1
> 
> 时间：2009-01-16T14:34:30.843
> 
> 标签：c++, bitsets

我是一名学习 C++ 的初学者（自学）程序员，最近我决定实现一个二进制编码的十进制 (BCD) 类作为练习，因此我可以在[Project Euler](http://www.projecteuler.net)上处理非常大的数字。我想尽可能地从头开始正确地做这件事。

我开始使用一个整数数组，其中输入数字的每个数字都保存为一个单独的整数。我知道每个 BCD 数字只能用 4 位编码，所以我认为为此使用整个 int 有点矫枉过正。我现在正在使用一组 bitset<4>。

1.  是否也在使用像这样的库类？
2.  你会认为这是作弊吗？
3.  有一个更好的方法吗？

编辑：这样做的主要原因是作为一个练习——我不想使用像 GMP 这样的库，因为重点是我自己来上课。有没有办法确保每个十进制数字只使用 4 位？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-16T14:41:04.810

请注意，使用 's 数组`bitset<4>`将需要与 long 数组相同的空间量。bitset 通常是通过将字大小的整数数组作为位的后备存储来实现的，因此按位操作可以使用按位字操作，而不是字节操作，因此一次可以完成更多操作。

另外，我质疑你的动机。在系统之间发送数字时，BCD 通常用作数字字符串的打包表示。通常与算术没有任何关系。你真正想要的是一个任意大小的整数算术库，比如[GMP](http://gmplib.org/)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-16T14:44:22.400

> 是否也在使用像这样的库类？

我会将它与一系列整数进行基准测试，看看哪个整数表现更好。如果 bitset<4> 数组更快，那么不，这不是矫枉过正。每一点都有助于解决一些 PE 问题

> 你会认为这是作弊吗？

一点都不。

> 有一个更好的方法吗？

就像 Greg Rogers 建议的那样，任意精度库可能是更好的选择，除非您只是想从自己的滚动中学习。从这两种方法中都可以学到一些东西（使用库与编写库）。我很懒，所以我通常使用 Python。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-16T17:24:50.343

就像 Greg Rogers 所说，使用 bitset 可能不会为 int 节省任何空间，也不会真正提供任何其他好处。我可能会改用向量。它是需要的两倍大，但您可以更简单、更快地为每个数字建立索引。

如果你想使用打包的 BCD，你可以编写一个自定义索引函数并在每个字节中存储两个数字。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-16T19:55:39.277

> 1.  是否也在使用像这样的库类？
> 2.  你会认为这是作弊吗？
> 3.  有一个更好的方法吗？

1&2：不是真的

3：每个字节有 8 位，您可以在每个无符号字符中存储 2 个 BCD。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-27T21:54:10.497

一般来说，位运算是在整数的上下文中应用的，因此从性能方面来看，没有真正的理由去使用位。

如果您想通过bit方法获得经验，那么这可能会有所帮助

```
#include <stdio.h>
int main
(
    void
)
{
    typedef struct
    {
        unsigned int value:4;

    } Nibble;

    Nibble nibble;

    for (nibble.value = 0; nibble.value < 20; nibble.value++)
    {
        printf("nibble.value is %d\n", nibble.value);
    }

    return 0;
} 
```

问题的要点是，在该**struct**内部，您正在创建一个短整数，即 4 位宽。实际上，它仍然是一个整数，但对于您的预期用途，它看起来和行为就像一个 4 位整数。

**for**循环清楚地表明了这一点，它实际上是一个**无限循环**。当半字节值达到 16 时，该值实际上为零，因为只有 4 位可以使用。结果**nibble.value < 20**永远不会变为真。

如果您查看 K&R 白皮书，其中一个注释是这样的位操作**不可移植**，因此如果您想将程序移植到另一个平台，它可能会或可能不会工作。

玩得开心。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-11T12:03:40.107

您正在尝试获取 base-10 表示（即数组的每个单元格中的十进制数字）。这样，空间（每个数字一个 int）或时间（每个 dgit 4 位，但存在打包/解包的开销）都被浪费了。

例如，为什么不尝试使用 base-256 并使用字节数组？甚至是带有整数数组的base-2 ^ 32？这些操作的实现方式与 base-10 相同。唯一不同的是将数字转换为人类可读的字符串。

它可能是这样工作的：假设 base-256，每个“数字”有 256 个可能的值，所以数字 0-255 都是单个数字值。比 256 写成 1:0 （我将使用冒号分隔“数字”，我们不能使用 base-16 中的字母），base-10 中的类比是 9 之后有 10。同样 1030（base -10) = 4 * 256 + 6 = 4:6 (base-256)。1020 (base-10) = 3 * 256 + 252 = 3:252 (base-256) 也是 base-256 中的两位数。

现在让我们假设我们把数字放在字节数组中，首先是最低有效位：

```
unsigned short digits1[] = { 212, 121 }; // 121 * 256 + 212 = 31188
int len1 = 2;
unsigned short digits2[] = { 202, 20  }; // 20 * 256 + 202 = 5322
int len2 = 2; 
```

然后添加将像这样（警告：前面的记事本代码，可能会被破坏）：

```
unsigned short resultdigits[enough length] = { 0 };
int len = len1 > len2 ? len1 : len2; // max of the lengths
int carry = 0;
int i;
for (i = 0; i < len; i++) {
    int leftdigit = i < len1 ? digits1[i] : 0;
    int rightdigit = i < len2 ? digits2[i] : 0;
    int sum = leftdigit + rightdigit + carry;
    if (sum > 255) {
        carry = 1;
        sum -= 256;
    } else {
        carry = 0;
    }
    resultdigits[i] = sum;
}
if (carry > 0) {
    resultdigits[i] = carry;
} 
```

在第一次迭代中，它应该是这样的：

1.  总和 = 212 + 202 + 0 = 414
2.  414 > 256，所以进位 = 1 和 = 414 - 256 = 158
3.  结果数字[0] = 158

在第二次迭代中：

1.  总和 = 121 + 20 + 1 = 142
2.  142 < 256，所以进位 = 0
3.  结果数字[1] = 142

所以最终结果digits[] = { 158, 142 }，即142：158（base-256）= 142 * 256 + 158 = 36510（base-10），正好是31188 + 5322

请注意，将此数字转换为人类可读的形式绝非易事——它需要乘以 10 或 256，如果没有适当的研究，我无法将代码作为示例提供。优点是可以使“加法”、“减法”和“乘法”操作非常有效，并且在开始时和计算结束后只进行一次与 base-10 的大量转换。

说了这么多，就个人而言，我会在字节数组中使用以 10 为底的值，而不关心内存丢失。这需要将上面的常数 255 和 256 分别调整为 9 和 10。

# wpf - 在 Windows XP 上运行 WPF 应用程序

> ID：450563
> 
> 赞同：6
> 
> 时间：2009-01-16T14:35:22.870
> 
> 标签：wpf, deployment, windows-vista, windows-xp

我最近使用 WPF 构建了一个新应用程序，以便我可以学习新技术。现在我正在尝试部署应用程序，它看起来好像在 Vista 系统上运行良好，但在具有 .Net fx 3.5SP1 的 Windows XP SP2 机器上，它无法加载 PresentationFramework.dll 文件。

我对此进行了进一步调查，发现我的 xp 测试机器上的 PresentationFramework.dll 文件与我的 Vista 开发机器上的文件之间存在细微的构建差异。

我很好奇是否有其他人也遇到过这个问题，以及他们做了什么来补救这种情况，以便他们可以在 Windows Vista 上开发，但将开发的应用程序部署到 Vista 和 XP 客户端。

谢谢。

我需要补充一点……在 vista 机器和客户端机器上，我有 .Net Fx 3.5 SP1。我做了一些挖掘，发现 PresentationFramework.dll 文件是相同的，除了最后一组版本号。

有没有人找到解决这个问题的体面工作？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-09T10:04:49.167

对不起，我让这个停滞不前，但我发现了我遇到的问题。原来，我用作测试台的 Windows XP 机器损坏了。

我在 stackoverflow 和另一个论坛之间为我正在为其编写插件的包工作。当我得知答案时，这就是我发布的内容，以防我将来遇到问题。

> 我想我会在这里发布这个，以便我有参考，并且以防其他人将来需要参考它......我正在使用 WPF 开发另一个 Dinerware Add-on，虽然它在我的开发机器上运行良好，每次我在测试机器上运行它（一台机器就像在客户所在地的现场一样幻影），我不断收到奇怪的处理错误。
> 
> 我在网上搜索了几个小时，结果空手而归，直到我看到这篇文章：
> 
> [http://social.msdn.microsoft.com/Forums/en-US/wpf/thread/6e5de3d8-fc02-4504-b00f-7a2192d24a48/](http://social.msdn.microsoft.com/Forums/en-US/wpf/thread/6e5de3d8-fc02-4504-b00f-7a2192d24a48/)
> 
> 它提供了 WIC（Windows 映像组件）的下载链接，位于此处：
> 
> [http://www.microsoft.com/downloads/details.aspx?FamilyID=8e011506-6307-445b-b950-215def45ddd8&displaylang=en](http://www.microsoft.com/downloads/details.aspx?FamilyID=8e011506-6307-445b-b950-215def45ddd8&displaylang=en)
> 
> 出于某种原因，正在/正在发生的事情是，Windows Imaging 组件已经损坏了我的应用程序正在寻找的内容。要解决此问题，您必须：
> 
> 1) 导航到 %windir%\$NtUninstallWIC$\spuninst\ 并在其中运行 spuninst.exe 文件。这将删除 Windows 映像组件。2) 完全删除组件后，您将使用上面的第二个链接重新安装它们。
> 
> 到目前为止，我还没有遇到任何进一步的问题。
> 
> 那是什么疯狂的事情？！？！？！？！？！？！
> 
> 希望，如果其他人遇到这个问题，我可以通过把它放在那里来快速帮助他们。

正如我在那个论坛上所说......希望这可以帮助其他人在未来遇到这个问题。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-16T22:42:35.570

我做了更多的实验并构建了一个测试 WPF 项目，并使用了设置和部署项目而不是 WiX 安装程序。出于某种原因，该应用程序在使用 Setup and Deployment 安装程序安装时运行良好，但是在使用 WiX 时，它遇到了问题......

开始认为问题与 WiX 有关，而不是 .Net Fx 版本/构建

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-16T14:43:07.630

有时模板和 Blend 会出现这个问题，尽管我认为它已在最新的 Blend 中得到修复。基本上，当 Blend “引入”信息以制作新模板时，它有时可以仅从 Vista 中复制 Aero 中的内容，这意味着您随后创建的控件依赖于 Vista :-(

我确实认为这是固定的，尽管如果项目需要一段时间才能完成，你可能会被它咬住。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-16T14:44:36.300

确保您的 Vista 和 XP 机器上的 .NET 版本相同。

# mysql - MySQL 查询慢——可能是索引问题？

> ID：450573
> 
> 赞同：0
> 
> 时间：2009-01-16T14:40:11.597
> 
> 标签：mysql

所以首先这是我的查询：（*注意：我知道 SELECT * 是不好的做法，我只是将其切换为使查询更具可读性*）

```
SELECT pcln_cities.*,COUNT(pcln_hotels.cityid) AS hotelcount
  FROM pcln_cities
  LEFT OUTER JOIN pcln_hotels ON pcln_hotels.cityid=pcln_cities.cityid
  WHERE pcln_cities.state_name='California' GROUP BY pcln_cities.cityid
  ORDER BY hotelcount DESC
  LIMIT 5 
```

所以我知道要解决这样的问题，您可以将 EXPLAIN 添加到查询的开头，但我不能 100% 确定如何读取结果，所以它们是：

[替代文字 http://www.andrew-g-johnson.com/query-results.JPG](http://www.andrew-g-johnson.com/query-results.JPG)

奖金指向一个答案，告诉我在 EXPLAIN 结果中寻找什么

**编辑**城市表具有以下索引（或者是索引？）

*   城市标识
*   州名
*   我只是添加了一个，因为我认为它可能会有所帮助（它没有）

酒店表具有以下索引（或者是索引？）

*   城市标识

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-16T14:51:19.563

嗯，您的查询中有些地方不太正确。您使用聚合函数（计数），但您只需按 id 分组。通常，您应该对选择列表中的所有列进行分组，而不是聚合函数。

正如您现在指定的查询，恕我直言，DBMS 永远无法正确确定他应该为那些不是聚合的列显示哪些值......

如果您的查询写成这样会更正确：

```
select cityname, count(*)
from city inner join hotel on hotel.city_id = city_id
group by cityname
order by count(*) desc 
```

如果您在 cityName 上没有索引，并且您在 cityname 上进行过滤，那么如果您在该列上放置索引将提高性能。

简而言之：在您经常用于过滤或排序的列上添加索引可能会提高性能。（这很简单，您可以将其用作“指南”，但每种情况都不同。有时添加跨多列的索引会很有帮助。另外，请记住，如果您更新或插入记录，索引也需要更新，因此添加/更新/删除记录会有轻微的性能成本）

可以提高性能的另一件事是使用内部联接而不是外部联接。我认为这里没有必要使用外连接。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-16T14:43:03.183

看起来您在 pcln_cities.state_name 或 pcln_cities.cityid 上没有索引？尝试添加它们。

鉴于您已经更新了您的问题，说您确实有这些索引，我只能建议您的数据库目前在加利福尼亚的城市占优势，因此查询优化器决定进行表扫描并丢弃会更容易非加利福尼亚的比使用索引来挑选加利福尼亚的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-16T15:00:10.653

您的查询看起来不错。是否有其他东西锁定了您需要的记录？桌子特别大吗？我怀疑数据是问题，因为没有那么多酒店......

我遇到了与 MySQL 类似的问题。在花了一年多的时间调整、修补并认为我是一个 SQL 傻瓜之后，我切换到了 SQL Server Express。具有完全相同数据的完全相同的查询在 SQL Server Express 中运行速度会快 2-5 个数量级。MySQL 似乎在处理中等复杂的查询（超过 5 个表）时遇到了特别困难的时期。我认为 MySQL 优化器在 SUN 收购该组织后变得迟钝......

# javascript - OpenLaszlo 可以使用 JQuery 和 PrototypeJS 等 JavaScript 库吗？

> ID：450575
> 
> 赞同：5
> 
> 时间：2009-01-16T14:40:40.130
> 
> 标签：javascript, jquery, prototypejs, openlaszlo

我一直在查看 OpenLaszlo 并观察到客户端中的脚本是用 JavaScript 实现的。这是否意味着可以使用 JQuery 和 PrototypeJS 之类的库？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-16T15:35:55.353

将 JQuery 与其他库一起使用的说明：http: [//docs.jquery.com/Using_jQuery_with_Other_Libraries](http://docs.jquery.com/Using_jQuery_with_Other_Libraries)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-12-22T22:20:34.090

jQuery 和 Prototype 严重依赖浏览器的 DOM API，而不仅仅是 JavaScript。我对 OpenLaszlo 不是很熟悉，但如果它不提供用于操作要输出的文档的 DOM，那么围绕抽象跨浏览器 DOM 不兼容性的库将不太有用。Aptana 的[Jaxer](http://www.jaxer.org/) Web 服务器声称允许您在将 DOM 发送到客户端之前对其进行操作，即使使用事件侦听器和动画也是如此。可能值得一看。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-08-14T14:14:37.043

虽然您通常可以将任何 JavaScript 库与 OpenLaszlo 一起使用，但将 jQuery 或 Prototype 与它结合使用是没有意义的。OpenLaszlo 在底层 HTML DOM 之上提供了一个抽象层。OpenLaszlo 中的“视图”只是一个 JavaScript 对象，它包含一个 sprite 容器和一个具有 CSS 样式的相应 HTML div。LZX 语言提供了操作视图对象的 API 和一些与精灵交互的 API。视图 API 在 DHTML/HTML5 和 SWFx 运行时都是一致的，精灵是运行时特定的实现。如果您为 OpenLaszlo 中的视图分配 ID，则该 ID 不会附加到表示应用程序中视图的 div 对象。

与大多数 JavaScript 框架相比，这个抽象层使构建丰富的应用程序变得更加容易，但是如果不了解 OpenLaszlo 视图模型的内部工作原理，就很难集成其他 JavaScript 框架。

# sql - 如何平均时间间隔？

> ID：450581
> 
> 赞同：18
> 
> 时间：2009-01-16T14:41:56.163
> 
> 标签：sql, oracle, timestamp, ora-00932

在 Oracle 10g 中，我有一个表，其中包含显示某些操作花费多长时间的时间戳。它有两个时间戳字段：开始时间和结束时间。我想找到这些时间戳给出的持续时间的平均值。我尝试：

```
select avg(endtime-starttime) from timings; 
```

但是得到：

> SQL 错误：ORA-00932：不一致的数据类型：预期的 NUMBER 得到 INTERVAL DAY TO SECOND

这有效：

```
select
     avg(extract( second from  endtime - starttime) +
        extract ( minute from  endtime - starttime) * 60 +
        extract ( hour   from  endtime - starttime) * 3600) from timings; 
```

但是真的很慢。

将间隔转换为秒数的更好方法，或其他方式吗？

编辑：真正减慢速度的是我在开始时间之前有一些结束时间。出于某种原因，这使得这个计算变得异常缓慢。我的根本问题是通过从查询集中消除它们来解决的。我还刚刚定义了一个函数来更轻松地进行这种转换：

```
FUNCTION fn_interval_to_sec ( i IN INTERVAL DAY TO SECOND )
RETURN NUMBER
IS
  numSecs NUMBER;
BEGIN
  numSecs := ((extract(day from i) * 24
         + extract(hour from i) )*60
         + extract(minute from i) )*60
         + extract(second from i);
  RETURN numSecs;
END; 
```

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2011-12-06T22:22:35.590

在 Oracle 中，有一种更短、更快、更好的方法来获得 DATETIME 差异，而不是具有多个提取的毛茸茸的公式。

试试这个以秒为单位获得响应时间：

```
(sysdate + (endtime - starttime)*24*60*60 - sysdate) 
```

减去 TIMESTAMP 时，它还保留秒的小数部分。

有关详细信息，请参阅[http://kennethxu.blogspot.com/2009/04/converting-oracle-interval-data-type-to.html](http://kennethxu.blogspot.com/2009/04/converting-oracle-interval-data-type-to.html)。

* * *

请注意，[自定义 pl/sql 函数具有显着的性能开销](https://asktom.oracle.com/pls/apex/f?p=100:11:0::::P11_QUESTION_ID:60122715103602)，可能不适合繁重的查询。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-01-16T15:10:58.367

If your endtime and starttime aren't within a second of eachother, you can cast your timestamps as dates and do date arithmetic:

```
select avg(cast(endtime as date)-cast(starttime as date))*24*60*60 
  from timings; 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-16T15:01:47.777

It doesn't look like there is any function to do an explicit conversion of `INTERVAL DAY TO SECOND` to `NUMBER` in Oracle. See the table at the end of [this document](http://download-uk.oracle.com/docs/cd/B12037_01/server.101/b10759/sql_elements002.htm#i46862) which implies there is no such conversion.

Other sources seem to indicate that the method you're using is the only way to get a number from the `INTERVAL DAY TO SECOND` datatype.

The only other thing you could try in this particular case would be to convert to number before subtracting them, but since that'll do twice as many `extract`ions, it will likely be even slower:

```
select
     avg(
       (extract( second from endtime)  +
        extract ( minute from endtime) * 60 +
        extract ( hour   from  endtime ) * 3600) - 
       (extract( second from starttime)  +
        extract ( minute from starttime) * 60 +
        extract ( hour   from  starttime ) * 3600)
      ) from timings; 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2017-12-07T10:08:43.127

[SQL小提琴](http://sqlfiddle.com/#!4/8a681f/2)

**Oracle 11g R2 模式设置**：

创建执行自定义聚合时要使用的类型：

```
CREATE TYPE IntervalAverageType AS OBJECT(
  total INTERVAL DAY(9) TO SECOND(9),
  ct    INTEGER,

  STATIC FUNCTION ODCIAggregateInitialize(
    ctx         IN OUT IntervalAverageType
  ) RETURN NUMBER,

  MEMBER FUNCTION ODCIAggregateIterate(
    self        IN OUT IntervalAverageType,
    value       IN     INTERVAL DAY TO SECOND
  ) RETURN NUMBER,

  MEMBER FUNCTION ODCIAggregateTerminate(
    self        IN OUT IntervalAverageType,
    returnValue    OUT INTERVAL DAY TO SECOND,
    flags       IN     NUMBER
  ) RETURN NUMBER,

  MEMBER FUNCTION ODCIAggregateMerge(
    self        IN OUT IntervalAverageType,
    ctx         IN OUT IntervalAverageType
  ) RETURN NUMBER
);
/

CREATE OR REPLACE TYPE BODY IntervalAverageType
IS
  STATIC FUNCTION ODCIAggregateInitialize(
    ctx         IN OUT IntervalAverageType
  ) RETURN NUMBER
  IS
  BEGIN
    ctx := IntervalAverageType( INTERVAL '0' DAY, 0 );
    RETURN ODCIConst.SUCCESS;
  END;

  MEMBER FUNCTION ODCIAggregateIterate(
    self        IN OUT IntervalAverageType,
    value       IN     INTERVAL DAY TO SECOND
  ) RETURN NUMBER
  IS
  BEGIN
    IF value IS NOT NULL THEN
      self.total := self.total + value;
      self.ct    := self.ct + 1;
    END IF;
    RETURN ODCIConst.SUCCESS;
  END;

  MEMBER FUNCTION ODCIAggregateTerminate(
    self        IN OUT IntervalAverageType,
    returnValue    OUT INTERVAL DAY TO SECOND,
    flags       IN     NUMBER
  ) RETURN NUMBER
  IS
  BEGIN
    IF self.ct = 0 THEN
      returnValue := NULL;
    ELSE
      returnValue := self.total / self.ct;
    END IF;
    RETURN ODCIConst.SUCCESS;
  END;

  MEMBER FUNCTION ODCIAggregateMerge(
    self        IN OUT IntervalAverageType,
    ctx         IN OUT IntervalAverageType
  ) RETURN NUMBER
  IS
  BEGIN
    self.total := self.total + ctx.total;
    self.ct    := self.ct + ctx.ct;
    RETURN ODCIConst.SUCCESS;
  END;
END;
/ 
```

然后你可以创建一个自定义聚合函数：

```
CREATE FUNCTION AVERAGE( difference INTERVAL DAY TO SECOND )
RETURN INTERVAL DAY TO SECOND
PARALLEL_ENABLE AGGREGATE USING IntervalAverageType;
/ 
```

**查询 1**：

```
WITH INTERVALS( diff ) AS (
  SELECT INTERVAL '0' DAY FROM DUAL UNION ALL
  SELECT INTERVAL '1' DAY FROM DUAL UNION ALL
  SELECT INTERVAL '-1' DAY FROM DUAL UNION ALL
  SELECT INTERVAL '8' HOUR FROM DUAL UNION ALL
  SELECT NULL FROM DUAL
)
SELECT AVERAGE( diff ) FROM intervals 
```

**[结果](http://sqlfiddle.com/#!4/8a681f/2/0)**：

```
| AVERAGE(DIFF) |
|---------------|
|     0 2:0:0.0 | 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-16T15:05:07.770

Well, this is a really quick and dirty method, but what about storing the seconds difference in a separate column (you'll need to use a trigger or manually update this if the record changes) and averaging over that column?

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2020-06-15T16:05:12.287

不幸的是，Oracle 不支持大多数带间隔的函数。有许多解决方法，但它们都有一些缺点（值得注意的是，没有一个是符合 ANSI-SQL 的）。

最好的答案（正如@justsalt 后来发现的那样）是编写一个自定义函数来将间隔转换为数字，平均数字，然后（可选）转换回间隔。Oracle 12.1 及更高版本支持使用`WITH`块声明函数来执行此操作：

```
with
    function fn_interval_to_sec(i in dsinterval_unconstrained)
        return number is
    begin
        return ((extract(day from i) * 24
               + extract(hour from i) )*60
               + extract(minute from i) )*60
               + extract(second from i);
    end;
select numtodsinterval(avg(fn_interval_to_sec(endtime-starttime)), 'SECOND') 
  from timings; 
```

如果您使用的是 11.2 或更早版本，或者您不想在 SQL 语句中包含函数，则可以将其声明为存储函数：

```
create or replace function fn_interval_to_sec(i in dsinterval_unconstrained)
    return number is
begin
    return ((extract(day from i) * 24
           + extract(hour from i) )*60
           + extract(minute from i) )*60
           + extract(second from i);
end; 
```

然后，您可以按预期在 SQL 中使用它：

```
select numtodsinterval(avg(fn_interval_to_sec(endtime-starttime)), 'SECOND') 
  from timings; 
```

### 使用`dsinterval_unconstrained`

为函数参数使用 PL/SQL 类型别名`dsinterval_unconstrained`可确保您拥有最大的精度/规模；`INTERVAL DAY TO SECOND`默认`DAY`精度为 2 位（意味着 ±100 天或超过 100 天的任何内容都是溢出并引发异常）并`SECOND`缩放为 6 位。

此外，如果您尝试在参数中指定任何精度/比例，Oracle 12.1 将引发 PL/SQL 错误：

```
with
    function fn_interval_to_sec(i in interval day(9) to second(9))
        return number is
        ... 
```

`ORA-06553: PLS-103: Encountered the symbol "(" when expecting one of the following: to`

## 备择方案

### 自定义聚合函数

Oracle 支持用 PL/SQL 编写的自定义聚合函数，这将允许您对语句进行最小的更改：

```
select ds_avg(endtime-starttime) from timings; 
```

但是，这种方法有几个主要缺点：

*   您必须在数据库中创建[PL/SQL 聚合对象](http://asktom.oracle.com/pls/asktom/f?p=100:11:0::::P11_QUESTION_ID:5269744394385)，这可能是不希望或不允许的；
*   您无法命名它`avg`，因为 Oracle 将始终使用内置`avg`函数而不是您自己的。（从技术上讲你可以，但是你必须用模式来限定它，这违背了目的。）
*   正如@vadzim 所指出的，聚合 PL/SQL 函数具有显着的性能开销。

### 日期算术

如果您的价值观相距不远，@vadzim 的方法也适用：

```
select avg((sysdate + (endtime-starttime)*24*60*60*1000000 - sysdate)/1000000.0) 
  from timings; 
```

但请注意，如果间隔太大，`(endtime-starttime)*24*60*60*1000000`表达式将溢出并抛出`ORA-01873: the leading precision of the interval is too small`。在这个精度（1μs）下，差异不能大于或等于`00:16:40`幅度，因此对于小间隔是安全的，但不是全部。

最后，如果您愿意失去所有亚秒级精度，您可以将`TIMESTAMP`列转换为`DATE`; `DATE`从 a 中减去 a`DATE`将返回具有第二精度的天数（归功于@jimmyorr）：

```
select avg(cast(endtime as date)-cast(starttime as date))*24*60*60 
  from timings; 
```

# svn - 在提交之前跟踪和执行同行评审的最佳方法

> ID：450583
> 
> 赞同：5
> 
> 时间：2009-01-16T14:42:03.153
> 
> 标签：svn, qa

我想知道人们使用什么机制来执行和跟踪对 SVN 承诺的同行评审。

对于每个提交，我希望能够跟踪人们是否进行了同行评审（我不确定在他们不能提交的情况下执行规则是否是一个好主意，我的直觉是不应该像那里那样强制执行可能是在没有同行评审的情况下提交的正当理由），但是应该能够跟踪未经审查的提交，以便在发布之前我们可以查看所有这些提交。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-16T14:58:55.117

您可以要求每个开发人员以固定格式（如 [REV:XYZ]）将审查开发人员的标签添加到提交中。这允许您过滤历史记录。正如这里提到的，如果需要，您可以使用源代码版本控制工具的预提交挂钩来强制执行此操作。

然后，需要向所有开发人员传达未经同行评审不得提交任何代码的规则。还展示了在提交之前审查代码的优势。最初的几个月，应该有人检查提交历史中没有审阅者标签的提交。如果他们找到了一些，请询问开发人员为什么要进行审核以及与谁进行审核。当没有审查时，提醒他们注意规则。如果某些开发人员多次故意违反此规则，可能会产生影响，但同行压力通常会阻止这种情况发生。

通常，当该规则生效时，没有理由不进行审查。尤其是“但我必须快速修复这个错误才能向客户提供修复版本”不能成为借口，因为开发人员更容易在匆忙中犯错误。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-16T15:23:57.843

这个问题听起来像是 git 或 bzr 等分布式 VCS 的广告：您需要开发人员能够经常提交更改，但要提交到他们自己的分支，然后在被拉入中央存储库之前对其进行审查。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-16T14:51:57.393

就个人而言，我经常可以每天​​使用 svn 接近 50 次，所以我不会喜欢它；）

我知道 Atlassian 的 jira greenhopper 插件可以作为 pre-committ 钩子运行，以在提交中要求 jira 引用。如果您也使用 greenhopper 来规划开发任务，则可以强制所有提交都应连接到 jira 问题。

即使您不使用 greenhopper，您也可以创建一个 pre-committ 挂钩，强制执行包含一些问题跟踪参考号的提交评论。

这可能会让您收集与 jira 问题相关的已收集变更集，这对我来说听起来是一个更好的主意。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-30T13:29:10.213

开发人员可以为每个更改（不是每个提交）创建一个分支。他们可以在这个分支中提交任意多次。但是，在将更改合并到主干之前，您可以强制进行同行评审。所以你的主干只会包含同行评审的代码。

你可以通过权限来做到这一点，所以只有选择的人可以提交到主干，他们可以在这样做之前检查代码是否正常。

我一直在使用版本控制，并认为在分支模型中工作（而不是在主干中工作）很好。像 git 这样的 DVCS 系统更进一步，并且似乎对很多人都运行良好。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-08-19T18:34:28.090

您可以做到这一点的一种方法是在您的团队中使用审阅者提交规则。也就是说，不允许开发人员提交他们自己的代码，他们必须说服其他人代表他们提交他们的代码。

我以前做过这样的项目，而且效果很好。缺点是使用 Subversion，这意味着审阅者的姓名，而不是开发人员的姓名，会显示在日志中。使用 git，你可以保留开发者的名字，并且审阅者添加一个 Signed-off-by: 行。

# c++ - 退出后调试崩溃？（主要返回后）

> ID：450585
> 
> 赞同：7
> 
> 时间：2009-01-16T14:42:26.477
> 
> 标签：c++, multithreading, debugging, visual-c++, windows-vista

这是一个相当复杂的错误，我试图四处寻找其他帮助来源，但由于我不明白的原因，“Vista 中的程序崩溃”不是最有用的查询。

我遇到的问题是我正在处理的程序——一个使用 OpenGL 和 Windows API 的图形化、多线程数据可视化软件——在 WinMain() 返回后崩溃。我尝试逐步执行关闭例程以及查看堆栈跟踪，最后一点不是汇编的代码是_crtExitProcess，它在实际的ExitProcess(0) 调用中崩溃。之后，堆栈跟踪显示 kernel32.dll 和四个 ntdll.dll，这是它实际崩溃的地方。

这个bug只出现在Vista上，同样的代码在XP上运行正常退出。我真的想不出任何可以帮助我调试这个问题的东西，而调试这个问题是我从未真正学到的东西。任何帮助，将不胜感激。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-16T15:16:08.403

我已经做了一些挖掘，我发现了一些帖子表明你不是唯一一个遭受这种情况的人：

*   [http://developer.nvidia.com/forums/index.php?showtopic=318](http://developer.nvidia.com/forums/index.php?showtopic=318)
*   [http://objectmix.com/xml-soap/115379-problem-latest-ms-patches-msxml4-vista.html](http://objectmix.com/xml-soap/115379-problem-latest-ms-patches-msxml4-vista.html)

特别是，第二个很有趣，Tom Chm 提到：

> 我们相信我们已经确定了崩溃的根本原因，并且在我们的接口类包装器中添加一个虚拟析构函数似乎可以解决我们的问题。但我们想知道坠机的确切原因，以验证我们没有将实际问题扫在地毯下。

问题可能出在某处的析构函数上，*或者缺少*析构函数。如果您有一种附加调试器并逐步完成关闭过程的方法，它可能会有所帮助。

您可能想通读整个线程，看看是否有什么可以学习的。也就是说，当然，如果您还没有在搜索中找到这些帖子。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-16T15:08:34.863

听起来有点像析构函数的问题。

检查关闭时被破坏的对象。这将主要是全局或静态对象。仔细查看它们的析构函数以了解访问不再有效的内容的情况。在多线程环境中，它可能是一种竞争条件，其中一个对象被销毁，而另一个线程仍在使用它。

尝试在对象被销毁时写入日志。例如

```
SomeClass::~SomeClass()
{
    WriteLog("Begin ~SomeClass()");
    // do whatever
    WriteLog("End ~SomeClass()");
} 
```

WriteLog() 应该打开日志文件，写入然后关闭文件以确保文件被刷新。使用 Mutex 或 CriticalSection 来避免冲突是个好主意。

在崩溃后查看日志可能会给您一些关于正在发生的事情的线索。

# .net - IDisposable Winform

> ID：450596
> 
> 赞同：1
> 
> 时间：2009-01-16T14:46:10.040
> 
> 标签：.net, winforms, idisposable, generated-code

在 Winform 上实现 IDisposable 的最佳实践是什么？

*   我有一个扩展 System.Windows.Forms.Form 的对话框
*   生成的 Designer.cs 已经包含虚拟 Dispose(bool) 方法的实现
*   我的表单手动添加了一个实现 IDisposable 的字段

理想情况下，我将能够在生成的代码中挂接到 Dispos(bool) 覆盖以处置手动添加的 IDisposable 对象。关于如何正确执行此操作的任何建议？

谢谢。

斯科特

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-16T16:01:27.550

您可以将该 Dispose 实现移出 .designer.cs 和您的 .cs。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-16T15:05:25.650

但是，那么您的字段需要是一个组件（实现 IComponent 接口或类似的东西）。会不会有点矫枉过正？

也许您可以将事件处理程序附加到 Disposing 事件，并在该事件处理程序中处理您的字段？

（或者只是将它们添加到 Dispose 方法中 - 我认为这不会有问题，因为 afaik，Dispose 方法中的代码不会重新生成......理想情况下，Dispose 方法实现不应该在 * .designer.cs 类...）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-11-02T14:28:44.703

我在表单的 Designer.cs 中的 Dispose 方法中取消注册任何事件

```
 protected override void Dispose(bool disposing)
    {
        if (disposing && (components != null))
        {
            components.Dispose();
        }
        _frmFind.RaiseFindEvent -= _frmFind_RaiseFindEvent;
        base.Dispose(disposing);
    } 
```

# vb.net - 在运行时从主应用程序中的类库更改连接字符串

> ID：450598
> 
> 赞同：3
> 
> 时间：2009-01-16T14:46:24.503
> 
> 标签：vb.net, runtime, connection-string, app-config, class-library

您可以像这样在运行时更改连接字符串。您可以在 MySettings 类中将连接字符串设置作为单独的属性写入：

```
Partial Friend NotInheritable Class MySettings
    Public WriteOnly Property RunTimeConnectionString()
        Set(ByVal value)
            My.Settings("MyConnectionString") = value
        End Set
    End Property
End Class 
```

然后，在初始化应用程序的某个地方（在使用任何类型数据集的表适配器之前），编写如下内容：

```
My.Settings.RunTimeConnectionString = My.Settings.ProductionConnectionString 
```

其中 ProductionConnectionString 是一个简单的字符串设置。这是一个用户范围设置，因此每个用户都可以更改它（通过为其分配一个值，类似于上面的代码）并通过调用 My.Settings.Save() 来保存它

此代码适用于最初在主项目中创建并存储在其设置（= app.config 文件）中的连接字符串。

app.config 中的连接字符串实际上有一个更长的名称：MyApp.MySettings.MyConnectionString。

当您将连接字符串存储在类库项目的 app.config 中并在主项目中引用该项目时，app.config 文件将以某种方式合并，因此类库具有它的设置。

不知道该怎么做的事情是在运行时从类库中更改设置。我可以将连接字符串设置从类库复制到主项目的 app.config。我必须保持相同的名称，类似于：MyClassLibrary.My.MySettings.MyConnectionString。

我上面展示的相同原理能否以某种方式应用于第二个连接字符串？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-19T11:27:28.390

I tested a little more, and found out that **the same solution** ***can*** **be used inside a class library**.

I made a new class (in the class library) with a shared (static) method like this:

```
Public Class MySettingsChanger
    Public Shared Sub SetConnectionString(ByVal cnnString As String)
        My.Settings.RunTimeConnectionString = cnnString
    End Sub
End Class 
```

And extended the MySettings class (in the class library) the same way as in the main project:

```
Namespace My
    Partial Friend NotInheritable Class MySettings
        Public WriteOnly Property RunTimeConnectionString()
            Set(ByVal value)
                My.Settings("MyConnectionString") = value
            End Set
        End Property
    End Class
End Namespace 
```

At least it works in my case. The name of the connection in the main project and in the class library is the same only (the short name, not the whole ProjectNamespace.MySettings.ConnectionName). I haven't tested with having a different name of the connection in the class library, but think it should not matter.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-16T15:25:28.307

我搜索了更多，找到了一种方法，但它并不是真正的运行时。至少不像我希望的那样运行时。无论如何，这是代码，我对其进行了测试并且可以正常工作，但**需要我先重新启动应用程序**。*这对我来说不是很运行时。*

```
 Dim configLocation As String = Reflection.Assembly.GetExecutingAssembly().Location
    Dim config As Configuration.Configuration = Configuration.ConfigurationManager.OpenExeConfiguration(configLocation)
    config.ConnectionStrings.ConnectionStrings.Clear()
    For i As Integer = 0 To Configuration.ConfigurationManager.ConnectionStrings.Count - 1
        Dim connection As New Configuration.ConnectionStringSettings(Configuration.ConfigurationManager.ConnectionStrings(i).Name, My.Settings.ProductionConnectionString)
        connection.ProviderName = Configuration.ConfigurationManager.ConnectionStrings(i).ProviderName
        config.ConnectionStrings.ConnectionStrings.Add(connection)
    Next
    config.Save() 
```

[这是我找到此代码的文章。](http://colbyafrica.blogspot.com/2008/03/microsoft-net-20-strongly-typed.html)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-16T21:39:00.003

感谢您在博客上的留言。是的，它几乎不是运行时的，因为它需要您停止运行才能获取更改。不幸的是，由于设置只加载一次（加载应用程序域时），因此设置基础架构无法在运行时获取更改。

唯一的选择是重新启动应用程序或回收应用程序池（如果是 Web 应用程序）。除此之外，您将不得不自己动手。

我尽我所能:-)

# entity-framework - 使用 ADO.NET 实体框架拦截实体保存

> ID：450601
> 
> 赞同：3
> 
> 时间：2009-01-16T14:47:38.900
> 
> 标签：entity-framework

我想在实体对象与 ObjectContext#SaveChanges() 一起存储之前在实体对象中调用验证函数。现在，我可以自己跟踪所有更改的对象，然后遍历所有对象并调用它们的验证方法，但我认为更简单的方法是实现 ObjectContext 在保存每个实体之前调用的一些回调。后者能做到吗？有没有其他选择？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-01-19T11:03:13.790

我已经想通了。基本上，我们可以拦截 ObjectContext 的 SavingChanges 事件并循环通过新添加/修改的实体来调用它们的验证功能。这是我使用的代码。

```
 partial void OnContextCreated()
    {
        SavingChanges += PerformValidation;
    }

    void PerformValidation(object sender, System.EventArgs e)
    {
        var objStateEntries = ObjectStateManager.GetObjectStateEntries(
            EntityState.Added | EntityState.Modified);

        var violatedRules = new List<RuleViolation>();
        foreach (ObjectStateEntry entry in objStateEntries)
        {
            var entity = entry.Entity as IRuleValidator;
            if (entity != null)
                violatedRules.AddRange(entity.Validate());
        }
        if (violatedRules.Count > 0)
            throw new ValidationException(violatedRules);
    } 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-16T15:30:13.930

好吧，您可以这样做，但这意味着您允许您的客户直接访问 ObjectContext，而且，我个人喜欢将其抽象出来，以使客户更可测试。

我所做的是使用存储库模式，并在存储库上调用 save 时进行验证。

# apache - Limit number of concurrent connections in Apache2

> ID：450606
> 
> 赞同：8
> 
> 时间：2009-01-16T14:49:18.677
> 
> 标签：apache, concurrency, apache2

Is there a way I can limit the number of concurrent connections to the Web Application running on my Apache Server.

**My server version is Apache 2.2.11**

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-16T15:19:02.283

Have a look at [limitipconn](http://dominia.org/djao/limitipconn.html) module.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-16T15:14:09.703

I'm not sure if it will useful to you but definitely worth a chance.

Maybe you can use the directives [MaxClients](http://httpd.apache.org/docs/1.3/mod/core.html#maxclients) and [ListenBackLog](http://httpd.apache.org/docs/1.3/mod/core.html#listenbacklog)

Although they apply to the concurrent access to the entire server, not only your application, and on a resource base.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-06-05T21:14:00.223

确定的事情：

[http://apache.ivn.cl/#bandwidth](http://apache.ivn.cl/#bandwidth)

你也可以找到一个 debian 包

libapache2-mod-bw

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-07-16T14:03:45.833

我们完全构建了一个应用程序层的东西来存储、检查和限制可以同时登录的应用程序用户数的限制。

如果超过了，我们会将他们送到“候诊室”——就像一个魅力。

所以它都是由应用程序管理的——我们在一个集群中有多个 apache 服务器。

我们没有使用 Zend 集群的东西，IMO。

# user-experience - 拥有漂亮的小工具对于编程技能有多重要？

> ID：450616
> 
> 赞同：2
> 
> 时间：2009-01-16T14:53:14.847
> 
> 标签：user-experience

这个问题是 Ed Burns 在他的著作《骑在顶峰》中提出的。我记得几乎所有的摇滚明星程序员都发现如果有新的和酷的小工具会很有帮助。程序员与最新的设计、硬件和软件实现保持联系，这也可能影响他的工作。

你对这个问题有什么看法？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-16T15:19:46.370

如果新的小工具能扩展你的视野，它们就会很有用。

例如，我最近给自己买了一个 iPod touch；这极大地改变了我对触摸屏用户界面的欣赏——我只知道“销售点”触摸屏界面，这通常很糟糕。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-16T15:04:16.447

我相信这是无关紧要的。

首先，每个领域（例如 Web、OS X、iPhone、Windows）都有自己的美学，这意味着来自小工具的体验不一定能很好地传递，就像出色的 Windows UI 不一定是出色的 OS X界面。

拥有一个小工具几乎从来没有教过底层的硬件或软件实现。

然而，能够欣赏伟大的设计，无论它出现在哪里，无论是在小工具、文学还是建筑中，都必须是有用的。对世界的好奇心和让生活变得更好的决心可能往往会导致伟大的程序员得到小工具，但这是一个案例或相关性，而不是因果关系。这些小工具对编程技能没有帮助，但同样的特性推动了两者。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-16T15:43:40.160

我认为伯恩斯可能会**接触到其他设计范例**。如果您在 Windows 中编程并且获得了最新最好的 WinMo 手机，那么您将接触到不同的平台，但实际上它只是一个婴儿 Windows。与成为 Windows 程序员并获得 iPhone 或 G1 形成对比。你被展示了一种非常不同的方式来完成事情，你将能够从别人的视野中挑选出你喜欢的部分。

许多领域都存在软件通常缺乏的竞争方面。竞争通过向您展示其他人如何解决您正在研究的问题来帮助您。如果他们卖得像大片，而你不是，那么，有什么东西在那里吧？

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-16T15:03:46.637

小工具并不那么重要，PC 本身才是。拥有一台相当新的 PC，具有漂亮的屏幕、键盘和鼠标是必须的。毕竟，您一天中的大部分时间都在使用它们，因此在 PC 上花费大量负载并获得便宜的外围设备是没有意义的！

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-01-16T15:12:36.227

对我来说，一切都是为了让事情变得有趣，因为我可能会厌倦一遍又一遍地做同样的事情。

拥有一个新的小工具会给你带来一些新的玩意，从而增加热情并帮助你学习新事物，进而使你成为一个更好的开发者。

我想不是每个人都需要这种动力，但我发现它可以在平静期间有所帮助，甚至不需要新硬件，我很高兴能掌握一些新的技术/语言等，我发现它具有相同的效果。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-16T15:01:02.163

我不是所有小工具热潮的忠实粉丝。我总是试图与新技术保持同步，但我认为消费小工具与它没有任何关系。

炫酷的小玩意是花钱和增加炫酷因素的好借口。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-01-16T15:35:42.530

取决于程序员。许多程序员会对酷炫的小工具作为工作津贴感到满意，但我不会说这会直接影响他们的工作效率。如果让我选择，我宁愿买一把好*椅子*，也不愿买同价位的掌上电脑。

在各种规模的公司担任程序员时，我错过了一些事情：

*   一张像样的椅子（耶稣人）
*   一台好的、快速的计算机（即使它们不支持 3D）
*   一个大屏幕（如果可能，两个）
*   能够阅读邮件的手持设备（我想这适合作为“小工具”）

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-01-16T15:42:54.577

取决于你在做什么。我会说，如果你在做 UI 工作，有很多不同的 UI 可以玩。确保他们有一台 Mac 和一台 PC，可能是一两种不同类型的智能手机和/或 PDA——如果你是那种公司，甚至可能是休息室里的任天堂 Wii。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-01-16T15:23:09.887

如果我可以肯定地在小工具上编程。

如果我不对其进行编程，我会得到相当少的（编程）。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-01-16T15:32:23.410

这是一个自我形象维护的事情。拥有最新的 geekbling 有助于让人感觉自己是那种处于所有趋势之上的wired.com 海报男孩，这会激励人们紧跟趋势。

确实，您看到人们所做的几乎所有看起来有些莫名其妙的事情都可能是一种身份维护活动。

# algorithm - 大多数来自 4 位的二进制组合，每位更改一次

> ID：450617
> 
> 赞同：1
> 
> 时间：2009-01-16T14:53:28.683
> 
> 标签：algorithm, design-patterns, binary, combinations

我有 4 个二进制位

```
Bit 3  Bit 2  Bit 1  Bit 0 
```

通常答案很简单：2^4，或 16 种不同的组合；它看起来像下面这样：

0000 0001 0010 0011 0100 0101 0110 0111 1000 1001 1010 1011 1100 1101 1110 1111

但是，LSB（位 0）每次迭代都会改变状态。

我需要一种算法，其中位的状态在所有迭代中只改变一次；即，我需要我所有的位都像 MSB（位 3）一样工作。

我怎样才能做到这一点？

### 编辑

似乎大多数人都认为只有 5 种可能的解决方案。然而，这假设有一个值的起点和一个终点。这没关系，所以我将给出一个真实世界的场景来更好地解释。

假设我有一个数字闹钟，可以提供 4 个输出。每个输出都可以被编程为在某个时间打开和在某个时间关闭，并且可以彼此独立地进行编程，例如。我可以将输出 1 编程为在凌晨 1 点打开并在凌晨 3 点关闭，而我可以将输出 2 编程为在下午 7 点打开并在凌晨 2 点关闭。每个输出可以保持多长时间没有限制。

现在我想把这个闹钟挂在电脑上，尽可能接近当前的正确时间。例如，如果时钟显示时间是下午 2:15，我的电脑就知道闹钟在下午 12 点到下午 6 点的范围内。我希望能够获得尽可能小的范围。我能得到的最小范围是多少？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-01-16T15:01:35.237

1.  有 4 位。
2.  每个位只能改变一次状态。
3.  对于每个新值，至少有一个位必须从先前的值改变状态。

因此，您最多可以有 4 个状态更改，以及最多 5 个不同的值。

例子：

```
0000 -> 0001 -> 0011 -> 0111 -> 1111 
```

**编辑：**

很好，让我们重述你的意思，而不是你所说的。

1.  有 4 位。
2.  每个位只能改变**两次**状态。（一次从 0 到 1，一次从 1 到 0）
3.  对于每个新值，至少有一个位必须从先前的值改变状态。

因此，您最多可以有 8 个状态更改，以及最多 8 个不同的值（因为最后一次状态更改必然会使所有位恢复到初始状态）

例子：

```
0000 -> 0001 -> 0011 -> 0111 -> 1111 -> 1110 -> 1100 -> 1000 -> 0000 
```

因此，通过将输出设置为：上午 3 点 - 下午 3 点、上午 6 点 - 下午 6 点、上午 9 点 - 晚上 9 点和中午 - 午夜，您可以从输出中确定是哪个 3 小时时段。我建议将电线插入视觉输出。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-01-16T14:56:20.707

你想要一个[格雷码](http://en.wikipedia.org/wiki/Gray_code)。往下看“构造一个 n 位格雷码”。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-16T15:01:16.047

我相信不可能通过这种限制循环所有可能的位模式。

如果您有一个 n 位的想法，您可以在必须翻转您已经翻转的位之前循环总共 (n+1) 个状态。

例如，在一个 3 位的例子中，如果你从 111 开始，你会得到

```
111
110
100
000 
```

然后你被迫翻转你已经翻转的一个以获得新的状态。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-16T16:13:22.237

根据您的闹钟示例，我假设您需要完成您开始的组合，并且每个位可以循环打开然后关闭一次，例如

> 0000 -> 0001 -> 0011 -> 0111 -> 1111 -> 1110 -> 1100 -> 1000 -> 0000

步数是位数的两倍，因此使用 4 位可以将当前时间控制在 3 小时范围内。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-16T14:57:48.643

您希望每个位只更改一次吗？

像：

```
0000 -> 0001 -> 0011 -> 0111 -> 1111 
```

在这种情况下，您可以使用一个简单的计数器，每次迭代（或左移）将增量乘以 2。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-16T15:07:31.713

如果 Gamecat 正确理解了您，您的位掩码值将是：

```
 1 - 1 
 2 - 1 
 4 - 1
 8 - 1
 16 - 1
 etc.
 2^i - 1 
```

或者，使用移位： (1 << i) - 1 for i in 0..

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-16T15:11:01.660

“我需要一种算法，其中一点的状态在所有迭代中只改变一次”

如果从字面上理解上述陈述，那么每次迭代只有五个状态，如其他帖子中所述。

如果问题是“可以生成多少个可能的序列？”，那么：

第一个状态总是0000吗？

如果没有，那么您有 16 个可能的初始状态。

顺序重要吗？

如果是，那么你有 4 个！= 24 种可能的方式来选择首先翻转哪些位。

因此，这总共可以生成 16*24 = 384 个可能的序列。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-16T15:12:10.940

这是一个示例，说明如何避免仅翻转一次。不知道系统的所有参数，很难给出一个准确的例子，但无论如何这里有一个。

```
char bits = 0x05;
flipp_bit(char bit_flip)
{
    static char bits_flipped=0;
    if( (bits_flipped & bit_flip) == 0)
    {
        bits_flipped |= bit_flip;
        bits ^= bit_flip;
    }
} 
```

使用此功能进行翻转将只允许对每一位进行一次翻转。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-12-23T20:36:37.737

回顾最初的问题，我想我明白你的意思

简单地说，根据可能的位组合的数量，您可以用来对时钟进行编程的最小位数是多少

第一个问题是需要多少序列。

60Secs x 60 Mins x 24hrs = 86400（需要组合）下一步是计算需要多少位才能产生至少 86400 个组合

如果有人知道计算

how many bits can produce 86400 combinations then thats your answer. hopefully there is a formula online somewhere for this calculation

# sql-server - MSSQL 数据库中浮点字段中的 NaN 值

> ID：450618
> 
> 赞同：4
> 
> 时间：2009-01-16T14:53:59.620
> 
> 标签：sql-server, tsql, floating-point, nan

我正在研究从我的前辈那里继承的旧数据库。

其中，一些浮点字段包含 NaN，其中应该有一个空值。

以下 SQL 不起作用，因为它无法识别 NaN。

```
UPDATE xxx SET column= null WHERE column=NaN 
```

我怎样才能做到这一点？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-16T15:05:53.120

尝试

```
UPDATE xxx SET column= null WHERE IsNumeric(column)=0 
```

然后再次运行您的选择。

# ruby - 更改顶部的 ruby 进程名称

> ID：450620
> 
> 赞同：22
> 
> 时间：2009-01-16T14:54:34.487
> 
> 标签：ruby, linux, unix, top-command

我想更改在 linux/unix top 命令中显示的 ruby​​ 进程的名称。我试过了

```
$0='miname' 
```

方法，但它仅适用于 ps 命令，并且在顶部，该过程一直显示为“ruby”

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-01-16T19:40:59.540

Dave Thomas 有一篇关于在 Rails 中执行此操作的有趣[帖子。](http://pragdave.blogs.pragprog.com/pragdave/2008/11/trivial-request-logging-for-rails.html)实际的进程名称更改代码没有任何特定的轨道。他使用这种`$0='name'`方法。当我按照他的步骤进行时，名称已更改为`ps`和`top`。

在帖子中，`c`如果您的 top 版本默认不显示命令的简短版本，他建议使用键盘命令。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2015-03-12T17:58:51.423

Ruby 2.1为此[引入](http://docs.ruby-lang.org/en/2.1.0/NEWS.html)了一种方法：[`Process.setproctitle`](http://docs.ruby-lang.org/en/2.1.0/Process.html#method-c-setproctitle)

```
Process.setproctitle("My new title") 
```

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-01-16T15:07:17.173

我认为 Ruby 没有内置的工具 ( `setproctitle(3)`)。您可能应该尝试查看[ruby​​-ffi](http://kenai.com/projects/ruby-ffi)并创建`setproctitle(3)`.

编辑：我知道你有你的答案，但我想向你展示一些使用 ffi 的代码：

```
require "ffi"
#
module LibC
  extend FFI::Library

  attach_function :setproctitle, [:string, :varargs], :void
end

LibC.setproctitle("Ruby: executing %s", :string, $0) 
```

不适用于 OS X，因为`setproctitle(3)`不存在，适用于 FreeBSD。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2010-05-21T22:01:24.593

$0 = 'Foo' 方法有效——但许多版本的 top 将要求您使用 'c' 打开命令行模式。我们在 Rails 和 CentOS 中使用了这种方法。工作一种享受

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2011-06-09T18:34:52.787

我有一个类似的问题，通过将它放在机架中间件中而不是之前/之后模式，稍微更新了 Dave Thomas 帖子中的技术。

## 把它放在 lib/rack/set_process_title.rb 中：

```
# Set the process title to the URI being processed 
#- useful for debugging slow requests or those that get stuck
class Rack::SetProcessTitle
  def initialize(app)
    @app = app
  end
  def call(env)
    $0 = env['REQUEST_URI'][0..80]

    @status, @headers, @response = @app.call(env)

    $0 = env['REQUEST_URI'][0..80] + '*'

    [@status, @headers, @response]
  end
end 
```

## ...这在 config/environment.rb 的末尾：

```
Rails.configuration.middleware.insert_after Rack::Lock, Rack::SetProcessTitle 
```

博客文章中的更多文字：http: [//blog.actbluetech.com/2011/06/set-your-process-name-in-top-and-ps.html](http://blog.actbluetech.com/2011/06/set-your-process-name-in-top-and-ps.html)

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2012-05-09T20:33:09.867

我知道 Keltia 已经发布了一些非常相似的东西，但是 Linux 没有 setproctitle(3)。Linux 从 2.6.9 版开始在 prctl() 中具有此功能。我使用了 Fiddle/DL，因为它们默认包含在 Ruby 中。

```
require("fiddle")

def set_process_name_linux(name)
    Fiddle::Function.new(
        Fiddle::Handle["prctl".freeze], [
            Fiddle::TYPE_INT, Fiddle::TYPE_VOIDP,
            Fiddle::TYPE_LONG, Fiddle::TYPE_LONG,
            Fiddle::TYPE_LONG
        ], Fiddle::TYPE_INT
    ).call(15, name, 0, 0, 0)
end

def set_process_name_unknown(name)
    warn("No implementation for this OS.".freeze)
end

def set_process_name(name)
    case RUBY_PLATFORM.split("-".freeze)[1]
    when "linux".freeze
        set_process_name_linux(name)
    else
        set_process_name_unknown(name)
    end
end 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2016-03-15T16:19:25.870

来自@jessehz 的回答，以下代码在我的 linux X86_64 上完美运行。Ruby 1.9.3、2.0、2.1、2.2、2.3 已经过测试。

1.  它将更改 ps top 命令中的输出。
2.  它可以是 kill 或使用 pkill、pgrep、killall 发出信号。

完美的！

```
def set_process_name_linux(name)
  handle = defined?(DL::Handle) ? DL::Handle : Fiddle::Handle

  Fiddle::Function.new(
    handle['prctl'.freeze], [
      Fiddle::TYPE_INT, Fiddle::TYPE_VOIDP,
      Fiddle::TYPE_LONG, Fiddle::TYPE_LONG,
      Fiddle::TYPE_LONG
    ], Fiddle::TYPE_INT
  ).call(15, name, 0, 0, 0)
  $PROGRAM_NAME = name
end
set_process_name_linux('dummy') 
```

# wcf - 创建用于测试 IIS 设置的单个文件 WCF

> ID：450626
> 
> 赞同：0
> 
> 时间：2009-01-16T14:56:19.863
> 
> 标签：wcf, iis-6

是否可以创建一个可以上传到我的服务器并测试它是否正确处理 WCF 文件的 .svc 文件（WCF 服务）？即，它被配置为托管 WCF 服务。

（我有一个必须测试的 IIS6 盒子）

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-16T15:54:53.833

您可以在 svc 文件中使用内联编码：

```
%@ ServiceHost Language="C#" Debug="true" Service="MyService.MyService" %>
using System;
using System.Runtime.Serialization;
using System.ServiceModel;

namespace MyService
{
    [ServiceContract]
    public interface IMyService
    {
        [OperationContract]
        int MyMethod(int x, int y);
    }

    public class MyService : IMyService
    {
        public int MyMethod(int x, int y)
        {
            return ((x + y) * 2);
        }
    }
} 
```

但是您还需要一个 web.config 文件和一个在您的 Web 服务器上配置的虚拟目录：

```
<?xml version="1.0"?>
<configuration>

  <system.web>
    <compilation debug="false" />
  </system.web>

  <system.serviceModel>
    <services>
      <service name="MyService.MyService">
        <endpoint address="" binding="wsHttpBinding" contract="MyService.IMyService" />
      </service>
    </services>
  </system.serviceModel>
</configuration> 
```

但基本上，如果您的 Web 服务器安装了 IIS 6.0 和 .NET 3.0，那么在其上运行 WCF 服务应该没有问题。

# c++ - Visual C++ 2005 在 qt 构建期间挂起

> ID：450630
> 
> 赞同：0
> 
> 时间：2009-01-16T14:57:48.240
> 
> 标签：c++, qt, sql-server-2005, visual-studio-2005

在我的商店，主要的产品应用程序是基于 MFC、QT 和开发人员多年来投入的其他随机事物构建的杂种。在当前的堆栈中，Qt 工具包即将淘汰，但仍具有大量功能。

如果我打开了 SQL 2005 Management Studio 并且必须进行完整构建，它通常会在构建的 qt 特定部分（Moc'ing 和UIC'ing）

有人见过这样的吗？任何想法可能是什么问题？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-16T15:39:03.350

以我的经验，其中一些工具能够永远循环（肯定是 qt4：lupdate/lrelease）。

# vb.net - 如何在 Visual Studio 中为 Visual Basic Web 部署项目禁用警告

> ID：450632
> 
> 赞同：6
> 
> 时间：2009-01-16T14:58:35.100
> 
> 标签：vb.net, visual-studio, warnings, web-deployment-project

对于我们的 VB.NET 网站，我们使用 SVN 进行源代码控制和 CruiseControl.NET 进行持续集成。

要在 CruiseControl.NET 编译中使用 SVN 内部版本号，我们需要使用 Web 部署项目。然后，我们将配置文件中的 Version 字段替换为 SVN Labeller 中的此变量

*   $(CCNet标签)

这很好用，但我的问题是这个变量会在 Visual Studio 中导致针对解决方案的警告。我正在努力删除所有警告，只剩下这两个：

*   警告 1 为项目文件中的“AssemblyFileVersion”指定的版本字符串无效。C:\MyProject\MyProjectDeploy.wdproj
*   警告 1 为项目文件中的“AssemblyVersion”指定的版本字符串无效。C:\MyProject\MyProjectDeploy.wdproj

我已经搜索了禁用某些警告的方法，但它们都引用了 Windows 项目，而不是不包含编译选项卡的网站/部署项目。

我找到了有关使用 #pragma 警告（禁用：1000）的信息，但似乎这仅适用于 C++ 而不是 VB。

这不是一个表演停止者，但在这个懒惰的星期五下午让我很烦，任何帮助将不胜感激 - 如果声誉共享有效但我会为我的代表提供 20 个可行的解决方案:) 至少.. ..

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-01-16T17:21:16.357

可以忽略错误，它只是在 vb.net 的一个奇怪的地方。

使用记事本或等效工具打开 .vbproj 文件，找到 <NoWarn> 标记并在其中添加错误的 ID。

在默认的 2008 winforms 中，我已经忽略了这些警告。

```
<NoWarn>42016,41999,42017,42018,42019,42032,42036,42020,42021,42022</NoWarn> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-16T15:01:47.530

如果你在构建脚本中使用了 Nant，你可以让它在编译之前重写版本，当你在本地机器上工作时你不会看到警告。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2018-10-17T15:09:08.413

与旧的 VB Web 项目有非常相似的情况，我们不想在代码调用中添加#pragma 块。出于某种原因，向`<NoWarn>`字段中添加行不会使 Visual Studio 构建忽略/抑制警告。

但是，我发现了另一种方法。`<NoWarn></NoWarn>`通过在该区域忽略 VS 2017 中的过时警告 之后在 .vbproj 文件中添加此内容：**`<DisabledWarnings>612;618</DisabledWarnings>`**

[常用 MSBuild 项目属性](https://docs.microsoft.com/en-us/visualstudio/msbuild/common-msbuild-project-properties?view=vs-2017) 配置设置说明：

> DisabledWarnings 抑制指定的警告。只能指定警告标识符的数字部分。多个警告用分号分隔。此参数对应于 vbc.exe 编译器的 /nowarn 开关。

# windows - 如何在 Windows 上创建子域？

> ID：450636
> 
> 赞同：2
> 
> 时间：2009-01-16T14:59:03.307
> 
> 标签：windows, networking, dns

我只想向我的计算机 FQDN 添加几个子域，以便我可以拥有一些虚拟服务器（apache。）

有任何想法吗？

注意：我需要给我的机器添加别名，比如 a.foo.com 和 b.foo.com。我不认为 apache 会产生这些别名。

替代方案：我决定不再尝试向我的域名添加内容（从那时起我必须编辑 dns 服务器），而是为单独的端口配置虚拟主机。这样，一切都取决于我的电脑。尽管如此，还是感谢您的帮助！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-16T15:22:45.397

如果这是在 Windows 域上：进入 DC 上的 DNS 管理工具，并添加将所需名称指向原始计算机名称的主机条目（CN 记录，而不是 A 记录）。

如果您在一个（非服务器）框中执行所有操作：编辑主机文件，并将名称指向正确的 IP 地址。

# oracle - 如何从您不拥有的 oracle 表中获取列信息（不使用描述）？

> ID：450637
> 
> 赞同：9
> 
> 时间：2009-01-16T14:59:06.147
> 
> 标签：oracle

如何获得他不拥有但已授予选择的表上的列信息？这是，不使用`DESCRIBE table_name`. 考虑这个例子：

```
 // user bob owns table STUDENTS
grant select on students to josh;
// now josh logs in, normally he would do
describe bob.students;
// but he's looking for something along the lines
select column_name from user_tab_columns where table_name = 'STUDENTS';
// which doesn't work, as josh doesn't own any tables on his own 

```

有任何想法吗？这甚至可行吗？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-01-16T15:06:58.983

```
select column_name from all_tab_columns where table_name = 'STUDENTS'; 
```

**编辑：**或者，甚至更好

```
select owner, column_name from all_tab_columns where table_name = 'STUDENTS'; 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-16T15:07:28.453

看看[oracle 数据字典](http://download.oracle.com/docs/cd/B10501_01/server.920/a96524/c05dicti.htm)，它应该会有所帮助。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-11-14T08:46:18.333

```
CONN HR/HR@HSD;

GRANT SELECT ON EMPLOYEES TO SCOTT;

CONN SCOTT/TIGER@HSD;

SELECT owner, column_name FROM all_tab_columns WHERE table_name = 'EMPLOYEES'; 
```

# c# - ASP.NET MVC Standard Link/Href As Save Button And Model IS NUll

> ID：450640
> 
> 赞同：0
> 
> 时间：2009-01-16T14:59:55.723
> 
> 标签：c#, asp.net-mvc, html-helper

Okay so, i am totally new to MVC and I'm trying to wrap my head around a few of the concepts. I've created a small application...

This application has a view for creating a new Individual record. The view is bound to a model **ViewPage**... And I have a associated **IndividualController** which has a **New** method...

The **New** method of the IndividualController looks like this...

```
public ActionResult New()
    {
        var i = new Individual();

        this.Title = "Create new individual...";
        i.Id = Guid.NewGuid();

        this.ViewData.Model = new Individual();

        return View();
    } 
```

Now, the above all seems to be working. When the view loads I am able to retrieve the data from the Individual object. The issue comes into play when I try and save the data back through the controller...

In my **IndividualController** I also have a **Save** method which accepts an incoming parameter of type **Individual**. The method looks like...

```
 public ActionResult Save(IndividualService.Individual Individual)
    {
        return RedirectToAction("New");
    } 
```

Now, on my view I wanted to use a standard html link/href to be used as the "Save" button so I defined an ActionLink like so...

```
 <%=Html.ActionLink("Save", "Save") %> 
```

Also, defined in my view I have created a single textbox to hold the first name as a test like so...

```
 <% using (Html.BeginForm()) { %>
     <%=Html.TextBox("FirstName", ViewData.Model.FirstName)%>
 <% } %> 
```

So, if I put a break point in the **Save** method and click the "Save" link in my view the break point is hit within my controller. The issue is that the input parameter of the Save method is null; even if I type a value into the first name textbox...

Obviously I am doing something completely wrong. Can someone set me straight...

Thanks in advance...

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-16T15:13:11.873

Your New controller method doesn't need to create an individual, you probably just want it to set the title and return the view, although you may need to do some authorization processing. Here's an example from one of my projects:

```
 [AcceptVerbs( HttpVerbs.Get )]
    [Authorization( Roles = "SuperUser, EditEvent, EditMasterEvent")]
    public ActionResult New()
    {
        ViewData["Title"] = "New Event";
        if (this.IsMasterEditAllowed())
        {
            ViewData["ShowNewMaster"] = "true";
        }

        return View();
    } 
```

Your Save action should take the inputs from the form and create a new model instance and persist it. My example is a little more complex than what I'd like to post here so I'll try and simplify it. Note that I'm using a FormCollection rather than using model binding, but you should be able to get that to work, too.

```
 [AcceptVerbs( HttpVerbs.Post )]
    [Authorization( Roles = "SuperUser, EditEvent, EditMasterEvent")]
    public ActionResult Save( FormCollection form )
    {
         using (DataContext context = ...)
         {
              Event evt = new Event();
              if (!TryUpdateModel( evt, new [] { "EventName", "CategoryID", ... }))
              {
                  this.ModelState.AddModelError( "Could not update model..." );
                  return View("New");  // back to display errors...
              }
              context.InsertOnSubmit( evt );
              context.SubmitChanges();
              return RedirectToAction( "Show", "Event", new { id = evt.EventID } );
         }
    } 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-16T15:30:49.653

如果我没有在 New 方法中创建一个新的 Indvidual 对象，那么当我的视图尝试将文本框绑定到关联模型时，我会在我的视图中的下面一行得到一个 NullReferenceException ......

```
`<%=Html.TextBox("FirstName", ViewData.Model.FirstName)%>` 
```

关于 Save 方法。据我了解，由于我的视图是强类型的，我不应该能够拥有像...这样的方法签名。

```
 `public ActionResult New(IndividualService.Individual ind)
    {
        return View();
    }` 
```

我认为这是模型绑定背后的目的..？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-16T20:36:39.740

我强烈建议您从您正在做的事情中退后一步，并在此处浏览一些教程/视频[http://www.asp.net/learn/](http://www.asp.net/learn/)

If you have a strongly typed `View`it means that when the `Controller`picks that view to generate the ***output*** the view has better access to the `Model`.

但是，对于随后从客户端返回的内容（例如发布表单或以其他方式导航到的 URL）`View`不***负责。***

ASP.NET-MVC 使用 URL 中的信息来确定`Controller`将请求传递给哪个。之后，控制器负责将请求中的各种其他元素解析为`Model`类的实例。

由于 ASP.NET-MVC 路由为控制器提供的重要帮助，传入请求和控制器之间的关系变得模糊不清。例如，可以定义一个路由来为控制器方法提供参数，这就是控制器所需要的，因此您看不到与 http 请求相关的方法中的任何代码。但是应该理解，contoller方法*只是*处理一个http请求。

我希望您可以从上面看到，在请求生命周期中，将模型中的类的实例传递给控制器​​上的公共方法还为时过早。如果需要实例化，由控制器决定哪些模型类。

# windows - 在VS2005中将WinCE应用程序编译为PC应用程序

> ID：450643
> 
> 赞同：0
> 
> 时间：2009-01-16T15:00:16.893
> 
> 标签：windows, visual-studio-2005, windows-ce

任何人都知道如何在 VS2005 中将 WinCE 应用程序编译为 PC 应用程序。我想将标准 MFC 智能设备应用程序更改为 mfc windows 应用程序。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-12-02T11:14:25.040

您可能需要从一开始就设计您的应用程序以实现这一目标。

我们使用我们自己的框架（直接构建在 Win32 之上）并拥有一个针对多个平台的 vcproj 和 sln，包括桌面上的 Windows Mobile 和 Win32...

所以我可以保证这是可以实现的。问题是我必须手动编码我们的 vcproj 文件；）微软不允许在向导中使用它......

显然，CE 上的 MFC 现在更接近于桌面等效项，因此这可能会使它变得容易得多。

# html - 具有相同宽度的多个元素等于最宽的元素

> ID：450646
> 
> 赞同：4
> 
> 时间：2009-01-16T15:01:03.957
> 
> 标签：html, css

我有两个元素（一个按钮和一个锚标记），里面都有一个动态文本，可以增长到其内容的长度。
我不知道其中哪一个在编译时最长，也不知道最大/最小宽度是多少。
较短的应该总是适应最长的。

```
<span id="buttonsColumn">
    <button type="submit" name="powerSearchSubmitButton" id="powerSearchSubmitButton">
        <span><em><%=ViewData.Model.T9nProvider.TranslateById("CommonWeb.Search")%></em></span>
    </button>                    
    <a class="linkButton" href="something">
        <span><em><%=ViewData.Model.T9nProvider.TranslateById("CommonWeb.Advanced")%></em></span>
    </a>
</span> 
```

包装`span`可以更改为所需的任何内容。
有任何想法吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-16T15:42:41.517

你可以尝试这样的事情：

```
#buttonsColumn {
    display: block;
    float: left;
    background-color: #F88;
}
#buttonsColumn button,
#buttonsColumn a {
    display: block;
}
#buttonsColumn button {
    width: 100%;
    background-color: #8F8;
}
#buttonsColumn a {
    width: 100%;
    background-color: #88F;
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-16T15:30:49.357

在我看来，你可以通过两种方式做到这一点：

1.  找出 ASP 端的长度并设置一个长度较大的变量，然后在每个的 size 属性中使用它。
2.  编写一个javascript函数来确定两者中的哪一个更大，并将两者的长度设置为那个。

* * *

## 回答 #3

> 赞同：-2
> 
> 时间：2009-01-16T15:50:18.053

我可以建议你[放弃并使用表](http://www.giveupandusetables.com/)吗？

毕竟它们仍然是规范的一部分，您所做的可以解释为表格数据。您需要添加的只是`style="width:50%"`每个表数据标签和`style="width:100%"`按钮标签。

```
<table>
<tr>
    <td style="width:50%">
    <button type="submit" style="width:100%" name="powerSearchSubmitButton" id="powerSearchSubmitButton">
        <span><em><%=ViewData.Model.T9nProvider.TranslateById("CommonWeb.Search")%></em></span>
    </button>
    </td>
    <td style="width:50%">
    <a class="linkButton" href="something">
        <span><em><%=ViewData.Model.T9nProvider.TranslateById("CommonWeb.Advanced")%></em></span>
    </a>
    </td>
</tr>
</table>
```

您可能可以摆脱按钮和锚标记中的那些跨度，除非您的 CSS 对容器的跨度子项做某事，否则它们似乎没有用。

# java - Java 事件：这是一个很好的方法吗？

> ID：450653
> 
> 赞同：0
> 
> 时间：2009-01-16T15:03:19.443
> 
> 标签：java, events

我正在用 Java 重新实现一个 .Net API，API 指定了一大堆事件，ehich java 并不隐式支持。

我将使用观察者模式，但由于事件的数量，我真的不想弄乱界面。

我想知道声明一个“事件”类是否是一个好主意，该类具有一个订阅方法，该方法采用一个“事件处理程序接口”和一个抛出方法。

这样我就不会因为单独的事件处理它们而将无数订阅者列表弄乱我的父类。

我能看到的唯一问题是 throw 命令的参数，因为不同的事件会有不同的参数。

我想出的解决方案是让 throw 方法接受一个对象数组，或者创建一个像 IEventArguemnts 这样的接口，它可以传递给 throw 命令并由订阅事件的代码处理，这似乎使更多对我有感觉。

我将不胜感激任何改进这一点的建议。或任何改进。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-16T15:08:24.847

Java 有事件，也有对事件的 API 支持。检查`java.util`包裹。你会看到`java.util.EventListener`，`java.util.EventObject`还有一些其他的。还有用于维护订阅者等的支持类。例如，AWT 和 Swing API 都是基于事件的。

通常，`addXxxListener(XxxListener l)`方法（即订阅方法）将在触发事件的类上进行，而不是在事件类本身上。事件就是消息，它是从发布者到订阅者所触发的内容。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-16T15:08:26.923

为什么不直接使用 JavaBeans 事件模型？如果所有对象都在同一个 JVM 中运行，那将正常工作。

[Peter Coad](http://www2.sys-con.com/ITSG/virtualcd/java/archives/0210/schwell/index.html)对改进 Java 观察者模型有一些想法。也许你会发现这些很有帮助。

# svn - 如何实现源控制管理互通？

> ID：450666
> 
> 赞同：3
> 
> 时间：2009-01-16T15:07:35.723
> 
> 标签：svn, git, version-control, mercurial, clearcase

虽然在我想了解如何实现两个源代码控制管理 (SCM) 系统之间的互操作性之前已经提出了相关问题。例如，我们可以考虑任何 SCM（Mercurial、Git、SVN、CVS、Perforce、ClearCase ...）。

我主要感兴趣的是 ClearCase 是否可以与 SVN 或 Git/Mercurial 一起使用。

我怎样才能让另一个 SCM 也维护一个远程 ClearCase 维护的源代码树（在 ClearCase 旁边）？

虽然其他人可以使用 ClearCase，但我们希望使用“其他”SCM 并在该存储库中提交更改。ClearCase 存储库中的更改应立即或定期进行（并且应定期从 ClearCase 存储库进行更新，以确保我们拥有最新的资源）

欢迎任何（其他/相关）示例/经验。谢谢 ！

PS：这*不是*关于转储 ClearCase（我很乐意这样做），而是关于在同一个源代码树上同时使用两个源控件。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-16T15:34:10.990

我真的建议不要混合它们。管理一个 SCM 是一项足够复杂的任务，您不希望普通用户必须处理其中的几个。

如果你仍然想混合，像 Mercurial 或 git 这样的分布式 SCM 有一些不错的东西，那就是能够在不强加于任何人的情况下使用它们。每个开发人员/团队都可以在 git 或 mercurial 中管理他的本地副本/本地分支，而没有人知道它。

git + subversion 或 mercurial + subversion 的优点是推回主存储库是工具的一部分，但没有它也可以生活。

在您的情况下，ClearCase 似乎是强加给您的，但您想使用替代方法。您可以决定在您的团队中使用 git，并定期将主分支推送到 ClearCase。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-16T15:16:33.553

我想到的一件事是[git-svn](http://git-scm.com/docs/git-svn)：“它提供了 Subversion 和 git 存储库之间的双向更改流。”

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-16T15:17:41.177

只要你可以让其他 SCM 忽略彼此（通过`.cvsignore`/`.hgignore`类文件）或让他们合作（比如`git svn`），我不明白你为什么不能这样做。我已经通过 svn/Hg/git 和 CVS 完成了。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-16T15:30:49.780

以一种非常通用的方式，您始终可以将“外国”（在您的情况下为 ClearCase）回购的当前 HEAD 提交到 git 分支中，在此基础上重新设置您自己的分支并将结果提交回“外国”回购。起泡，冲洗，重复。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-16T15:44:25.993

两个源代码控制管理 (SCM) 之间的互操作性问题是，如果一个 SCM 具有比其他 SCM 更丰富的模型（例如，如果您不使用 svnmerge 或 SVK，则 1.5.0 之前的 Subversion 不会存储合并的所有父级，而大多数现代 SCM 记住合并；Mercurial 不支持章鱼合并，即与两个以上的父级合并）。

我知道至少有几种不同的解决方案：

*   **通用**SCM 互操作性解决方案，例如在 Git 中创建但由 Bazaar 支持的*快速导入交换标准，我认为也由 Mercurial 或*[Tailor](http://wiki.darcs.net/DarcsWiki/Tailor)等工具（但 Tailor 有其局限性）
*   **使用 SCM API 或 SCM 可脚本性的特定**工具，例如 Git 和 Subversion 之间的 git-svn（使用 Subversion Perl API）或 Git 和 Perforce 之间的 git-p4
*   **手动，**即使用公共工作区（工作目录）从一个 SCM 获取更改（签出）并将更改（提交）添加到其他 SCM。这需要设置适当的忽略文件，因此一个 SCM 会忽略其他 SCM 特定的帮助文件和目录。
*   **在集中式 SCM（如 CVS）和其他 SCM（如 Git）之间交互的情况下，通过模拟**集中式 SCM 的服务器，但在其他 SCM 中有存储库，如 git-svnserver
*   **数据后端**，其中一个 SCM（如 Bazaar 或 Darcs）以其他 SCM 格式将更改（数据）存储在存储库中。我不知道这种解决方案的例子。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-16T15:56:48.447

我同意[BlueBird75](https://stackoverflow.com/questions/450666#450761)的观点：混合两个不同的引用不是一个好主意，出于同样的原因，拥有多个具有相同类型信息的数据库也不是一个好主意。在这些情况下，同步和复制不容易管理。

We do "publish" some data managed in our ClearCase repositories (VOBs) to other VCS (Subversion, Perforce, ...) or repositories (like Maven), for other teams which do not use ClearCase. However, the data exported are only **deliveries**.

A "delivery unit" is a small ('small' as in the fewest number of files as possible) set of packaged files: jar, war and ear are all an example of such packaged files, but we also include sources (compressed in a zip file), javadoc (compressed also), script to execute this delivery, and so on.

That way, only a few files are exported to clients, and only when a delivery is build and represent a significant stable version.

# asp.net-mvc - 如何在 ASP.NET MVC 的 html.DropDownlist 中动态预选项目

> ID：450669
> 
> 赞同：4
> 
> 时间：2009-01-16T15:08:15.457
> 
> 标签：asp.net-mvc, html-select

有没有办法在页面加载或发布到服务器时预先选择一个项目..

这就是我现在所拥有的..

```
<%=Html.DropDownList("dllMonths", 
    new SelectList(new List<string>() {
       "", "January", "Feburary", "March", "April", "June", 
       "July", "August", "September", "October", "November", 
       "December"}), 
    new { onchange="this.form.submit();" })%> 
```

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-01-16T15:22:49.140

设置 SelectList 的 SelectedValue 属性，或将其作为第二个参数传递给 SelectList 构造函数。

```
<% = Html.DropDownList ( "dllMonths", 
                           new SelectList ( new List ( ) 
                                          { "", "January", "Feburary", "March", 
                                            "April", "June", "July", "August", 
                                            "September", "October", "November", 
                                            "December" },
                                          "April" ), 
                           new { onchange = "this.form.submit();" } 
                       )%> 
```

# .net - 你可以在没有办公室的情况下安装 Office 2007 PIA

> ID：450674
> 
> 赞同：4
> 
> 时间：2009-01-16T15:09:16.437
> 
> 标签：.net, ms-office, office-interop, office-2007, office-pia

首先，我的问题与

[是否可以在没有 Office 2007 的情况下部署 Office 2007 PIA？](https://stackoverflow.com/questions/370407/is-office-2007-pia-deployment-possible-without-office-2007)

我还不打算使用 PIA。理想情况下，IT 工程师希望在升级 Office 2007 之前将 2007 PIA 部署到每个人的计算机上。这样就可以减少需要一次性完成的事情。我想知道这是否可能

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-21T10:15:48.963

我最好的经验是使用您的应用程序/加载项部署 PIA，因为有一些尴尬的因素，可以通过这种方式解决。

如果您不将它们注册到 GAC，并且 tehy 将保留在您的应用程序/加载项的目录中，您不会影响其他任何内容。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-21T10:11:24.483

不，这是不可能的。Office PIA 要求首先安装正确版本的 Office。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-08-24T21:57:30.590

是的，有可能，我们最终做到了，而且效果很好。

# c# - DataTable internal index is corrupted

> ID：450675
> 
> 赞同：31
> 
> 时间：2009-01-16T15:09:37.467
> 
> 标签：c#, .net, datatable

I am working with a .NET WinForms app in C#, running against the 3.5 .NET framework. In this app, I am setting the .Expression member of a `DataColumn` in a `DataTable`, like so:

```
DataColumn column = dtData.Columns["TestColumn"];
column.Expression = "some expression"; 
```

The 2nd line, where I actually set `Expression`, will sometimes result in the following exception:

```
FileName=
LineNumber=0
Source=System.Data
TargetSite=Int32 RBInsert(Int32, Int32, Int32, Int32, Boolean)
System.InvalidOperationException: DataTable internal index is corrupted: '5'.
   at System.Data.RBTree`1.RBInsert(Int32 root_id, Int32 x_id, Int32 mainTreeNodeID, Int32 position, Boolean append)
   at System.Data.RBTree`1.RBInsert(Int32 root_id, Int32 x_id, Int32 mainTreeNodeID, Int32 position, Boolean append)
   at System.Data.Index.InitRecords(IFilter filter)
   at System.Data.Index.Reset()
   at System.Data.DataTable.ResetInternalIndexes(DataColumn column)
   at System.Data.DataTable.EvaluateExpressions(DataColumn column)
   at System.Data.DataColumn.set_Expression(String value) 
```

There is no perceptible rhyme or reason as to when the error will occur; in loading the same data set, it may work fine but then reloading it will fail, and vice versa. This leads me to think it is related to a race condition, where another write operation is occurring on the `DataTable` as I'm trying to modify one of its columns. However, the code relating to `DataTable`s is *not* multi-threaded and runs only on the UI thread.

I have searched the web and [Microsoft forums](http://social.msdn.microsoft.com/Forums/en-US/adodotnetdataproviders/thread/18544cd3-1083-45fe-b9e7-bb34482b68dd/#page:1), and there is much discussion and confusion over this issue. Back when the issue was first reported in 2006, the thought was that it was an flaw in the .NET framework, and there were some supposed hotfixes released that were presumably rolled into later versions of the .NET framework. However, people have reported mixed results in applying those hotfixes, which are no longer applicable to the current framework.

Another prevailing theory is that there are operations on the DataTable which, though seemingly innocuous, are actually write operations. For example, creating a new `DataView` based on a `DataTable` is actually a write operation on the table itself, because it creates an internal index in the `DataTable` for later reference. These write operations are not thread-safe, so it sometimes happens that a race condition leads to an unthread-safe write coinciding with our access of the `DataTable`. This, in turn, causes the internal index of the `DataTable` to become corrupted, leading to the exception.

I have tried putting `lock` blocks around each `DataView` creation in the code, but, as I mentioned before, code utilizing the `DataTable` is not threaded, and the `lock`s had no effect, in any case.

Has anyone seen this and successfully solved / worked around it?

* * *

No, unfortunately I can not. Loading the DataTable has already occurred by the time I get a hold of it to apply an Expression to one of its DataColumn's. I could remove the column and then re-add it using the code you suggested, but is there a particular reason why that would solve the internal index is corrupted problem?

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2011-04-14T15:26:26.070

我在导入行时遇到了同样的问题，看起来，`DataTable.BeginLoadData`在插入为我修复它之前调用。

**编辑：**事实证明，这只在一侧修复了它，现在添加行会引发此异常。

**Edit2：**[Robert Rossney](https://stackoverflow.com/questions/450675/datatable-internal-index-is-corrupted/663399#663399)建议的暂停绑定也为我解决了添加问题。我只是`DataSource`从 中删除`DataGridView`并在完成`DataTable`.

**Edit3：**仍然没有修复......自星期四以来，我的代码中所有不同的地方都出现了异常......这是迄今为止我在框架中遇到的最奇怪和最糟糕的错误（在我使用 .NET 2.0 的 3 年中，我看到了许多奇怪的事情，足以保证我未来的任何项目都不会建立在它之上）。不过废话不多说，回到正题。

我已经阅读[了 Microsoft 支持论坛上](http://social.msdn.microsoft.com/Forums/en/adodotnetdataproviders/thread/18544cd3-1083-45fe-b9e7-bb34482b68dd)的整个讨论，我会给你一个简短的总结。原始[错误报告源自 '05](http://connect.microsoft.com/VisualStudio/feedback/details/98279/funny-one-datatable-internal-index-is-corrupted#details)。

*   ***06 年 3 月：***第一次报告错误，开始调查。在接下来的一年中，它以不同的形式和不同的表现形式被报道。
*   ***07 年 3 月：***终于[发布了一个编号为 KB 932491 的修补程序](http://support.microsoft.com/kb/932491/en-us)（不要抱太大希望），它链接[到一个完全不相关的修补程序的下载](http://archive.msdn.microsoft.com/KB932491)，或者至少看起来如此。在接下来的几个月中，许多人报告说该**修补程序不起作用**，有些人报告说成功了。
*   ***07 年 7 月：***来自 Microsoft 的最后一个迹象（带有完全无用的答案），除此之外，Microsoft 没有进一步的回应。没有进一步的确认，没有尝试支持，没有要求提供更多信息……什么都没有。除此之外，只有社区相关信息。

不认真，这在我看来总结了它。我能够从整个讨论中提取以下信息：

*   `DataTable`不是**线程**安全的。如果你在任何地方都有多线程，你将不得不自己`Lock`/`Synchronize`它。
*   索引的损坏发生在引发实际异常**之前的某个地方。**
*   一种可能的损坏源是应用程序`Expression`或应用程序`Sort`。
*   另一个可能的来源是`DataTable.ListChanged()`事件，切勿修改此事件或由此产生的任何事件中的数据。这包括`Changed`来自绑定控件的不同事件。
*   `DefaultView`将与控件绑定时可能会出现问题。始终使用`DataTable.BeginLoadData()`和`DataTable.EndLoadData()`。
*   的创建和操作`DefaultView`是对（及其）的**写入操作**，飞行意大利面怪物知道原因。`DataTable``Index`

这可能的来源很可能是竞争条件，无论是在我们的源代码中还是在框架的代码中。看起来，Microsoft 无法修复此错误或无意修复此错误。无论哪种方式，请检查您的代码中的竞争条件，`DefaultView`我认为这与 . 在某些时候`Insert`，数据的一个或一个操作会破坏内部索引，因为这些更改没有正确地传播到整个`DataTable`.

当我找到更多信息或其他修复时，我当然会报告。对不起，如果我在这里有点情绪化，但我花了三天时间试图查明这个问题，它慢慢开始看起来像是找一份新工作的好理由。

**Edit4：**我能够通过完全删除绑定（`control.DataSource = null;`）并在数据加载完成后重新添加它来避免这个错误。这激发了我的想法，即它与`DefaultView`绑定控件产生的事件有关。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-01-29T05:22:27.987

就个人而言，这个特殊的错误已经以各种方式成为我 3 周的克星。我已经在我的代码库的一部分中解决了它，它出现在其他地方（我相信我今晚终于把它压扁了）。异常信息相当无用，鉴于缺乏 MS 来解决问题，强制重新索引的方法将是一个不错的功能。

我不会寻找 MS 的修补程序——他们有一篇关于它的知识库文章，然后将您重定向到一个完全不相关的 ASP.Net 修复程序。

好吧——抱怨够多了。让我们看看在我遇到的各个地方实际帮助我解决了这个特定问题：

*   避免使用默认视图，并尽可能修改默认视图。顺便说一句，.Net 2.0 在创建视图时有许多读/写锁，所以它们不是 2.0 之前的问题。
*   尽可能调用 AcceptChanges()。
*   小心 .Select(expression)，因为此代码中没有读取器/写入器锁——而且它是唯一的地方（至少根据 usenet 上的一个人的说法，所以把它带上一粒盐——但是，这与您的问题非常相似-因此使用互斥锁可能会有所帮助）
*   将 AllowDBNull 设置为有问题的列（有问题的值，但在 usenet 上报告——我只在有意义的地方使用它）
*   确保您没有将 null (C#)/Nothing (VB) 设置为 DataRow 字段。使用 DBNull.Value 而不是 null。在*您的*情况下，您可能希望检查该字段是否不为空，表达式语法*确实*支持 IsNull(val, alt_val) 运算符。
*   这可能对我帮助最大（听起来很荒谬）：如果一个值没有改变，不要分配它。因此，在*您的*情况下，请使用它而不是您的直接分配：

    if (column.Expression != "some expression") column.Expression = "some expression";

（我删除了方括号，不知道他们为什么在那里）。

编辑（2012 年 5 月 16 日）：刚刚反复遇到这个问题（使用 UltraGrid/UltraWinGrid）。使用删除 DataView 上的排序的建议，然后添加一个与 DataView 排序匹配的排序列，这解决了问题。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-17T16:19:26.887

你提到“不是线程安全的”。您是否正在从不同的线程操作对象？如果是这样，那么这很可能是腐败的原因。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2012-08-14T18:26:13.840

对于那些试图查看如何重现此错误的人来说，这只是一个说明。我有一些代码经常会产生该错误。它确实围绕并发读/写锁定，但对 DataView.FindRows 的调用是在该锁定之外完成的。OP 指出*创建*数据视图是一种隐藏的写入操作，是否也可以查询它？

```
//based off of code at http://support.microsoft.com/kb/932491
using System.Data;
using System.Collections.Concurrent;
using System.Threading.Tasks;
using System;
public class GenerateSomeDataTableErrors
{   
    public static void Main()
    {
        DataTable Table = new DataTable("Employee");
        Table.Columns.Add("Id", typeof(int));
        Table.Columns.Add("Name", typeof(string));
        Table.PrimaryKey = new DataColumn[] { Table.Columns["Id"] };

        DataSet Employees = new DataSet();
        Employees.Tables.Add(Table);

        DataRow ManagerB = Table.NewRow();
        ManagerB["ID"] = 392;
        ManagerB["Name"] = "somename";
        Table.Rows.Add(ManagerB);

        DataRow ManagerA = Table.NewRow();
        ManagerA["ID"] = 394;
        ManagerA["Name"] = "somename";
        Table.Rows.Add(ManagerA);

        Employees.AcceptChanges();

        object locker = new object();

        //key = exception string, value = count of exceptions with same text
        ConcurrentDictionary<string, int> exceptions = new ConcurrentDictionary<string, int>();

        DataView employeeNameView = new DataView(Table, string.Empty, "Name", DataViewRowState.CurrentRows);

        Parallel.For(0, 100000, (i, s) =>
        {
            try
            {
                #region do modifications to the table, in a thread-safe fashion
                lock (locker)
                {
                    var row = Table.Rows.Find(392);

                    if (row != null) //it's there, delete it
                    {
                        row.Delete();
                        Employees.AcceptChanges();
                    }
                    else //it's not there, add it
                    {
                        var newRow = Table.NewRow();
                        newRow["ID"] = 392;
                        newRow["Name"] = "somename";
                        Table.Rows.Add(newRow);
                        Employees.AcceptChanges();
                    }
                }
                #endregion

                //Apparently this is the dangerous part, finding rows 
                // without locking on the same object the modification work is using.
                //lock(locker)
                employeeNameView.FindRows("somename");
            }
            catch (Exception e)
            {
                string estring = e.ToString();
                exceptions.TryAdd(estring, 0);
                lock (exceptions)
                { exceptions[estring] += 1; }
            }
        });

        foreach (var entry in exceptions)
        {
            Console.WriteLine("==============The following occurred " + entry.Value + " times");
            Console.WriteLine(entry.Key);
        }
    }//Main
}//class 
```

如果您按原样运行它，您可以获得这样的输出（每次运行时输出都会有所不同）：

```
==============The following occurred 2 times
System.InvalidOperationException: DataTable internal index is corrupted: '13'.
   at System.Data.RBTree`1.GetNodeByIndex(Int32 userIndex)
   at System.Data.DataView.GetRow(Int32 index)
   at System.Data.DataView.GetDataRowViewFromRange(Range range)
   at System.Data.DataView.FindRowsByKey(Object[] key)
   at GenerateSomeDataTableErrors.<>c__DisplayClass9.<Main>b__8(Int32 i, ParallelLoopState s) in Program.cs:line 110
==============The following occurred 3 times
System.IndexOutOfRangeException: Index 1 is either negative or above rows count.
   at System.Data.DataView.GetRow(Int32 index)
   at System.Data.DataView.GetDataRowViewFromRange(Range range)
   at System.Data.DataView.FindRowsByKey(Object[] key)
   at GenerateSomeDataTableErrors.<>c__DisplayClass9.<Main>b__8(Int32 i, ParallelLoopState s) in line 110
==============The following occurred 1 times
System.NullReferenceException: Object reference not set to an instance of an object.
   at System.Data.DataView.GetRow(Int32 index)
   at System.Data.DataView.GetDataRowViewFromRange(Range range)
   at System.Data.DataView.FindRowsByKey(Object[] key)
   at GenerateSomeDataTableErrors.<>c__DisplayClass9.<Main>b__8(Int32 i, ParallelLoopState s) in Program.cs:line 110
Press any key to continue . . . 
```

如果您确实在 FindRows 调用上加了锁，则没有例外。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-19T18:18:18.817

从对这个问题的长期和痛苦的讨价还价中，我的理解是，它是非线程安全的写操作的产物，通常你不知道你正在制作它。

就我而言，罪魁祸首似乎是 BindingSource。我发现我需要暂停绑定，执行我尝试的任何操作，然后在完成后恢复绑定，问题就消失了。这是 18 个月前的事了，所以我不再清楚细节，但我记得得到的印象是 BindingSource 正在自己的线程上执行某种操作。（这对我来说现在比当时更有意义。）

另一个潜在的麻烦来源是 DataTable 的 RowChanging 事件。如果您做了一些修改该事件处理程序中的表的操作，那么会出现不好的情况。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2012-03-23T09:08:50.143

这就是我修复内部索引损坏问题的方法：

```
System.Data.DataTable dtNew = new DataTable();
for (int iCol = 0; iCol < dtOriginalData.Columns.Count; iCol++)
{
    dtNew.Columns.Add(dtOriginalData.Columns[iCol].ColumnName, dtOriginalData.Columns[iCol].DataType);
}
for (int iCopyIndex = 0; iCopyIndex < item.Data.Rows.Count; iCopyIndex++)
{
    dtNew.Rows.Add(dtOriginalData.Rows[iCopyIndex].ItemArray);
    //dtNew.ImportRow(dtOriginalData.Rows[iCopyIndex]); 
}
dtOriginalData = dtNew; 
```

享受吧，安德鲁 M

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2011-05-18T20:53:05.110

同样的问题在这里，并尝试了不同的方法。我没有将数据表用于任何与屏幕相关的内容（例如绑定）；我只是创建 DataRow 对象（在多个线程中）并将它们添加到表中。

我尝试过使用 lock()，还尝试将添加的行集中到一个单例中，认为这会有所帮助。它没有。作为参考，这是我使用的单例。也许其他人将能够在此基础上构建并解决一些问题？

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Data;

namespace EntityToDataSet
{
   public class RowAdder
   {
      #region Data
      private readonly object mLockObject = new object();
      private static RowAdder mInstance;

      public static RowAdder Instance
      {
         get
         {
            if (mInstance == null)
            {
               mInstance = new RowAdder();
            }
            return mInstance;
         }
      }

      object mSync;
      #endregion

      #region Constructor
      private RowAdder()
      {
      }
      #endregion

      public void Add(DataTable table, DataRow row)
      {
         lock (mLockObject)
         {
            table.Rows.Add(row);
         }
      }
   }
} 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2011-06-03T10:10:21.623

[在这种情况下尝试应用此处描述](http://msdn.microsoft.com/en-us/library/system.threading.mutex.aspx#Y2991)的互斥锁以 在线程中诱导睡眠的想法怎么样？

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2015-12-02T17:31:02.437

我以这种方式解决了我的数据表内部索引错误：

改为`CellEndEdit`事件`CellBeginEdit`。另外...避免不必要地使用NULL：

```
Private Sub User_role_groupDataGridView_CellBeginEdit(sender As Object, e As DataGridViewCellCancelEventArgs) Handles User_role_groupDataGridView.CellBeginEdit
    Try 
        If Not Me.User_role_groupDataGridView.Rows(e.RowIndex).IsNewRow Then Me.User_role_groupDataGridView.Rows(e.RowIndex).Cells("last_modified_user_group_role").Value = Now
    Catch ex As Exception
        Me.displayUserMessage(ex.ToString, Me.Text, True)
    End Try
End Sub 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2016-02-21T00:37:06.090

在以编程方式将行添加到绑定到 datagridview 的数据集时，我遇到了同样的问题（表索引损坏为 5）。我没有考虑到 datagridview 的 AddRow 事件上有一个事件处理程序，它会在用户通过 UI 启动新行的情况下进行一些初始化。在异常堆栈跟踪中没有看到它。通过禁用该事件，我可以快速解决这个问题。我只是通过深入阅读这里的一些评论来了解它。对于这样的问题，2 小时不算多 :-)，我认为。您可以通过在分配给链接到数据集的 datgridview 的每个事件处理程序中设置断点来找到它。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2015-12-08T11:12:06.960

我遇到了同样的问题，这就是为我解决的问题：[堆栈溢出 - 内部索引已损坏](https://stackoverflow.com/a/34154179/3119607)。

如果您将线程与数据集一起使用，则会发生该错误。

就我而言，我试图在线程中运行的方法中为数据集创建一个新行。

一种方法是在创建行的方法周围使用**SyncLock ，或者另一种方法（可能甚至更好）是在线程之外创建行。**

基本上我的代码看起来像这样：

```
 Dim elements As New List(Of element)
    Dim dataRows As New List(Of MyDataSet.Row)

    For i As Integer = 0 To elements.Count - 1
        dataRows.Add(Me.Ds.Elements.NewElementsRow)
    Next

    Parallel.For(0, elements.Count, Sub(i As Integer)
                                        Me.CreateElementRow(elements(i), dataRows(i))
                                    End Sub) 
```

在**CreateElementRow**方法中，我在线程中进行了大量计算。

希望这可以帮助。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2011-11-22T12:14:45.640

同样的事情也发生在我身上。Winforms，.NET 3.5，在尝试设置键入行中的一列时意外出现此错误。代码相当陈旧并且工作了很长时间，所以这有点令人不快......

我需要在数据集 TadaSet 的类型表 TadaTable 中设置新的 SortNo。

对我有什么帮助，你也可以试试这个：

```
int i = 0;
foreach (TadaSet.TadaTableRow row in source)
{
     row.BeginEdit(); //kinda magical operation but it helped :)
     // Also you can make EndEdit() for each row later if you need...
     short newNo = i++;
     if (newNo != row.SortNo) row.SortNo = newNo; //here was the crash
} 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2013-05-01T20:15:44.770

这似乎对我的同事 Karen 和我有用。我们在 DataGridView 中遇到了这个错误，但仅在将数据输入到一个特定列时才出现。

事实证明，我已经更改了网格中列的顺序，但不知道 DataGridView.CellValidated 子中的代码将导致问题的特定列中的值归零。

该代码引用了特定的列号。所以当原来的DataGridView第3列被移动变成了第1列，但DataGridView.CellValidated代码仍然引用第3列时，就出现了错误。更改我们的代码以使其引用正确的 e.ColumnIndex 似乎解决了我们的问题。

（在我们的代码中改变这个数字并不容易。我希望这个修复能成立。）

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-01-16T20:50:49.290

你不能只使用：

```
dtData.Columns.Add("TestColumn", typeof(Decimal), "Price * Quantity"); 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2012-04-20T13:33:53.203

可能是您同时在多个进程中使用相同的数据表。我刚刚使用`SYNCLOCK`...解决了这个问题

尝试这个..

```
SyncLock your datatable

'''' ----your datatable process

End SyncLock 
```

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2012-05-30T08:33:05.597

在我的情况下，框架版本是 2.0。问题的根源在于 DataView ListChanged 事件。下面的代码使用一些默认值初始化新行。

```
private void dataView_ListChanged(object sender, ListChangedEventArgs e)
{
    if (e.ListChangedType == ListChangedType.ItemAdded)
    {
        DataView v = (DataView)sender;
        DataRowView drv = v[e.NewIndex];

        // This "if" works fine
        if (drv["Foo"] == DBNull.Value)
        {
            drv["Foo"] = GetFooDefault();
        }

        // This "if" brakes the internal index     
        if (drv["Bar"] == DBNull.Value && drv["Buz"] != DBNull.Value)
        {
            drv["Bar"] = drv["Buz"];
        }
    }
} 
```

经过一番调查，很明显 ItemAdded 事件每行至少调用两次。第一次当 UI 创建新行以输入数据时，第二次，我不确定，但看起来像将 DataRowView 添加到 DataView 时。

第一个“if”仅在第一次调用 ItemAdded 时才有效。在第二次调用时，“Foo”列已填充并保持原样。

但是，“Bar”列的默认代码可以在两个调用中执行。实际上，在我的情况下，它仅在第二个 ItemAdded 事件中执行，当时用户有机会填写“Buz”列的数据（最初“Buz”具有 DBNull 值）。

所以这里是基于我的发现的建议：

*   ListChanged 事件中的数据只有在`e.ListChangedType == ListChangedType.ItemAdded`.
*   在设置列值之前，应执行检查以确保这是第一个 ItemAdded 事件（例如，如果在第二次调用时该值不能为空，请检查它是否为`DBNull.Value`等）

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2017-12-29T13:25:04.223

I had the same problem using Threads. What I did was create a delegate which is called when I need to merge the table.

```
internal delegate void MergeData (DataTable dataTable1, DataTable dataTable2);

internal static void MergeDataTable (DataTable dataTable1, DataTable dataTable2)
{
    dataTable1.Merge (dataTable2, true);
} 
```

Then during execution I call the delegate and the error does not occur.

```
Delegates.MergeData mergeData = new Delegates.MergeData (Delegates.MergeDataTable);

object [] paramsMerge = {dataTable1, dataTable2};

this.Invoke (mergeData, paramsMerge); 
```

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2019-06-13T08:34:30.667

与 .NET 4.5.2 win forms 应用程序相同。在我的情况下，原因似乎是多个控件绑定到单个 BindingSource 列。我知道将许多控件绑定到一个值是在自找麻烦，但由于布局相当复杂，这对我来说是一个较小的邪恶。

似乎从一侧更改值引发了多个 OnChange 事件，试图对 BindingSource 执行相同的操作，从而导致出现问题。

我试过暂停绑定但没有成功。我已经实现了一些标志，防止代码被并行执行多次，事情变得更好了。

# java - 为什么在 Linux 下键入 unicode 时不显示 KeyTyped 事件？

> ID：450676
> 
> 赞同：2
> 
> 时间：2009-01-16T15:09:54.720
> 
> 标签：java, windows, linux, unicode

我有一个在 Linux 下运行的 Swing 应用程序，它无法显示重音字符。

查看应用程序，我将问题跟踪到键盘。我添加了一个新的 EventQueueManager 来拦截所有收到的事件。

我在两个系统上都输入了“[dead rapid] [a]”序列。

在 Windows 中，我得到：

```
D 090116 100330.015000 AWT-EventQueue-1 [HotKeyManager.java : 133 - handleAWTEvent] java.awt.event.KeyEvent[KEY_PRESSED,keyCode=129,keyText=Dead Acute,keyChar='´',keyLocation=KEY_LOCATION_STANDARD] on frame0
D 090116 100330.109000 AWT-EventQueue-1 [HotKeyManager.java : 133 - handleAWTEvent] java.awt.event.KeyEvent[KEY_PRESSED,keyCode=65,keyText=A,keyChar='a',keyLocation=KEY_LOCATION_STANDARD] on frame0
D 090116 100330.109000 AWT-EventQueue-1 [HotKeyManager.java : 133 - handleAWTEvent] java.awt.event.KeyEvent[KEY_TYPED,keyCode=0,keyText=Unknown keyCode: 0x0,keyChar='á',keyLocation=KEY_LOCATION_UNKNOWN] on frame0
D 090116 100330.125000 AWT-EventQueue-1 [HotKeyManager.java : 133 - handleAWTEvent] java.awt.event.KeyEvent[KEY_RELEASED,keyCode=129,keyText=Dead Acute,keyChar='´',keyLocation=KEY_LOCATION_STANDARD] on frame0
D 090116 100330.203000 AWT-EventQueue-1 [HotKeyManager.java : 133 - handleAWTEvent] java.awt.event.KeyEvent[KEY_RELEASED,keyCode=65,keyText=A,keyChar='a',keyLocation=KEY_LOCATION_STANDARD] on frame0 
```

在 Linux 下我得到：

```
D 090116 151026.380000 AWT-EventQueue-0 [HotKeyManager.java : 132 - handleAWTEvent] java.awt.event.KeyEvent[KEY_RELEASED,keyCode=0,keyText=Unknown keyCode: 0x0,keyChar='?',keyLocation=KEY_LOCATION_UNKNOWN] on frame0 
```

因此，键盘的处理方式似乎有所不同。也许某种类型的字符编码问题？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-24T07:19:12.927

我可能离基地很远，但我认为死键可以通过按下并释放死键，然后按下并释放目标键来工作 - Windows 事件表明您正在使用死键，如 shift 键，按住，点击目标，释放死键。

否则，我相信您在 JVM 或键盘驱动程序中发现了一个错误。有人假设死键序列在本机应用程序中工作以产生重音字符，这会将手指指向 Java。什么JVM版本？是否可以选择升级到新的 JVM？您是否在 sun 网站上搜索过在此发布的错误？

我不相信这可能是任何类型的编码问题——关键事件是不同的抽象级别，本身不需要编码。它们（直接）产生虚拟键码和/或可输入的 Unicode 字符。

# ruby-on-rails - Rails 异常通知系统的困惑

> ID：450679
> 
> 赞同：0
> 
> 时间：2009-01-16T15:10:57.807
> 
> 标签：ruby-on-rails, error-handling

[update2] 我解决的问题之一，不记得是如何... :)

[update1] 这可能是模型中的问题吗？

```
 PAYPAL_CERT_PEM = File.read("#{Rails.root}/certs/paypal_cert.pem")
  APP_CERT_PEM = File.read("#{Rails.root}/certs/app_cert.pem")
  APP_KEY_PEM = File.read("#{Rails.root}/certs/app_key.pem") 
```

我试图在我的网站上访问的页面是贝宝购买的购物车页面。尽管在明显的 DoS 攻击中很难在生产日志中找到此错误，但我没有使用异常通知程序的经验。（由我的代码）调用的是模型中每个“立即购买”按钮的加密方法。请帮我诊断问题。

```
Rendering .../public/500.html (500 Error)
rendering section "request"
/!\ FAILSAFE /!\  Fri Jan 16 14:59:54 +0000 2009
  Status: 500 Internal Server Error

ActionView::TemplateError (protected method `filter_parameters' called for #<PurchaseController:0x7f053d26e280>) on line #3 of vendor/plugins/exception_notification/views/exception_notifier/_request.rhtml:
    1: * URL       : <%= @request.protocol %><%= @host %><%= @request.request_uri %>
    2: * IP address: <%= @request.env["HTTP_X_FORWARDED_FOR"] || @request.env["REMOTE_ADDR"] %>
    3: * Parameters: <%= filter_sensitive_post_data_parameters(@request.parameters).inspect %>
    4: * Rails root: <%= @rails_root %> 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-02T16:14:11.180

如果您使用的是“更新”版本的导轨，您可能需要进行此更改：[http ://www.floydprice.com/2008/08/exception-notifier-in-rails-21/](http://www.floydprice.com/2008/08/exception-notifier-in-rails-21/)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-16T19:15:59.590

不是您问题的答案，而是会有所帮助的东西。

我最近开始喜欢[Hoptoad](http://hoptoadapp.com/welcome) gem 和网站，用于在生产中使用我的应用程序进行分组和报告异常。安装极其简单，无需再翻阅我的生产日志。

我说从异常通知切换到这个，看看它是否有帮助。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-16T19:21:44.993

`ActionView::TemplateError`您发布的内容是由异常通知程序在呈现 500 错误页面时失败引起的（异常通知程序自己部分的第 3 行）`_request.html`。更有趣的例外可能是之前出现并首先导致 500 的例外。

# mysql - INSERT INTO .. ON DUPLICATE KEY UPDATE 为多个项目

> ID：450682
> 
> 赞同：76
> 
> 时间：2009-01-16T15:11:27.010
> 
> 标签：mysql

我想做这样的事情

```
INSERT INTO t (t.a, t.b, t.c) 
VALUES ('key1','key2','value') 
ON DUPLICATE KEY UPDATE 
t.c = 'value';
INSERT INTO t (t.a, t.b, t.c) 
VALUES ('key1','key3','value2') 
ON DUPLICATE KEY UPDATE 
t.c = 'value2'; 
```

ta 和 tb 是键。这一切都很好，但我在第二次插入时出错。使用 phpMyAdmin，这样的查询可以正常工作，但我猜它正在独立运行查询，因为它将查询的结果作为注释打印出来？

像这样的东西也很好，但我需要为每个项目设置不同的值。我更喜欢这个，但我不确定如何更改每个值的更新值。

```
INSERT INTO t (t.a, t.b, t.c)
VALUES ('key1','key2','value'), ('key1','key3','value2')
ON DUPLICATE KEY UPDATE
t.c = ??? 
```

问题出在问号中，我应该放什么以便每次插入/更新都具有正确的值？显然，如果我在那里输入一个值，所有字段都将获得该值。

如果有另一种方法可以在具有两个键的多个字段上执行“如果存在则更新，否则插入”查询，我也有其他想法。我想我可以单独运行每个查询（比如 phpMyAdmin？），但这将是很多查询，所以我真的想避免这种情况。

* * *

## 回答 #1

> 赞同：166
> 
> 时间：2009-01-16T15:16:07.017

使用 VALUES() 函数

```
INSERT INTO t (t.a, t.b, t.c)
VALUES ('key1','key2','value'), ('key1','key3','value2')
ON DUPLICATE KEY UPDATE
t.c = VALUES(t.c) 
```

见[http://dev.mysql.com/doc/refman/5.0/en/insert-on-duplicate.html](http://dev.mysql.com/doc/refman/5.0/en/insert-on-duplicate.html)

* * *

## 回答 #2

> 赞同：45
> 
> 时间：2014-01-28T23:20:51.167

代表太低无法评论，但我想添加一个稍微复杂的语法，灵感来自@ʞɔıu 响应。要更新重复键上的多个字段：

```
INSERT INTO t (t.a, t.b, t.c, t.d)
VALUES ('key1','key2','value','valueb'), ('key1','key3','value2','value2b')
ON DUPLICATE KEY UPDATE
t.c = VALUES(t.c),
t.d = VALUES(t.d) 
```

希望可以帮助那些希望在重复键更新上执行多个批量插入的人。语法逃脱了我。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2020-02-19T08:18:53.723

MySQL 8.0.19 之后，可以使用`as`关键字，例如：

```
INSERT INTO t1 (a,b,c) VALUES (1,2,3),(4,5,6) AS new
  ON DUPLICATE KEY UPDATE c = new.a+new.b; 
```

或者

```
INSERT INTO t1 (a,b,c) VALUES (1,2,3),(4,5,6) AS new(m,n,p)
  ON DUPLICATE KEY UPDATE c = m+n; 
```

参考：[https ://dev.mysql.com/doc/refman/8.0/en/insert-on-duplicate.html](https://dev.mysql.com/doc/refman/8.0/en/insert-on-duplicate.html)

# php - Programming Multi-Language PHP applications

> ID：450687
> 
> 赞同：13
> 
> 时间：2009-01-16T15:12:37.570
> 
> 标签：php, web-applications, internationalization

I'm developing a PHP application and I'm wondering about the best way to include multi-language support for users in other countries.

I'm proficient with PHP but have never developed anything with support for other languages.

I was thinking of putting the language into a PHP file with constants, example:

en.php could contain:

```
define('HZ_DB_CONN_ERR', 'There was an error connecting to the database.'); 
```

and fr.php could contain:

```
define('HZ_DB_CONN_ERR', 'whatever the french is for the above...'); 
```

I could then call a function and automatically have the correct language passed in.

```
hz_die('HZ_DB_CONN_ERR', $this); 
```

Is this a good way of going about it?

-- morristhebear.

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-01-17T02:02:48.287

诡异的。人们似乎忽略了明显的解决方案。您对特定于语言环境的文件的想法很好。有 en.php:

```
define('LOGIN_INCORRECT','Your login details are incorrect.');
... 
```

然后，假设你有一个全局配置/常量文件（我建议有很多原因），有这样的代码：

```
if ($language == 'en') {
  reqire_once 'en.php';
} else if ($language == 'de') {
  require_once 'de.php';
} 
```

您可以定义数字和货币显示、比较/排序（即德语、法语和英语都有不同的排序方法）等功能。

人们经常忘记 P​​HP 是一种动态语言，所以像这样：

```
if ($language == 'en') {
  function cmp($a, $b) { ... }
} else if ($language == 'de') {
  function cmp($a, $b) { ... }
} 
```

实际上是完全合法的。使用它们。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-01-16T15:20:58.020

You can use [gettext](http://no2.php.net/manual/en/book.gettext.php) or something which supports gettext as well as more such as [Zend_Translate](http://framework.zend.com/manual/en/zend.translate.html).

Edit:

Just for precision, Zend_Translate supports gettext without the gettext module. You can see here [the many different types of input it supports](http://framework.zend.com/manual/en/zend.translate.adapter.html).

If you use arrays as also suggested you can also use this with Zend_Translate. The point being, if you use arrays today and gettext, xml or something else tomorrow you only have to change your config for Zend_Translate.

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-26T05:36:54.080

感谢所有人的方法和解决方案。我带着同样的疑问来到这里，我可以得出结论，使用“定义方法”更现实，因为即使遇到不使用其他库或其他库的非常时尚的方法的奇怪问题，也是现实的和在富有成效的思维中，它很容易维护和理解，因此，您可以通过非编程技能的家伙获得其他语言。

我认为数组方法更好，因为您不需要分发那种大的多语言来获得一些翻译，此外，您使用的内存更少，因为您只加载所需的翻译字符串。

关于那些无法重新定义的事情；好吧，通常如果您要定义常量是因为它们不需要或不能更改，因此如果需要，您可以使用一个部分来定义字符串和变量。

我补充说我不喜欢那些定义文件的外观，但是考虑到您的访问者根本不担心习语的实现方式，这是一个完美有效的实现，您可以轻松获得一些翻译。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-01-19T14:01:48.763

我真的很喜欢以下方法：

一个文件是翻译器本身：

```
class Translator{
    private static $strs = array();
    private static $currlang = 'en';

    public static function loadTranslation($lang, $strs){
        if (empty(self::$strs[$lang]))
            self::$strs[$lang] = array();

        self::$strs[$lang] = array_merge(self::$strs[$lang], $strs);        
    }

    public static function setDefaultLang($lang){
        self::$currlang = $lang;        
    }

    public static function translate($key, $lang=""){
        if ($lang == "") $lang = self::$currlang;
        $str = self::$strs[$lang][$key];
        if (empty($str)){
            $str = "$lang.$key";            
        } 
        return $str;       
    }    

    public static function freeUnused(){
        foreach(self::$strs as $lang => $data){
            if ($lang != self::$currlang){
                $lstr = self::$strs[$lang]['langname'];
                self::$strs[$lang] = array();
                self::$strs[$lang]['langname'] = $lstr;                
            }            
        }        
    }

    public static function getLangList(){
        $list = array();
        foreach(self::$strs as $lang => $data){
            $h['name'] = $lang;
            $h['desc'] = self::$strs[$lang]['langname'];
            $h['current'] = $lang == self::$currlang;
            $list[] = $h;
        }
        return $list;        
    }

    public static function &getAllStrings($lang){
        return self::$strs[$lang];
    }

}

function generateTemplateStrings($arr){
    $trans = array();
    foreach($arr as $totrans){
        $trans[$totrans] = Translator::translate($totrans);
    }
    return $trans;    
} 
```

语言文件可以是简单的`include()`d 并且看起来像这样：

en.php:

```
Translator::loadTranslation('en', array(
  'textfield_1'          => 'This is some Textfield',
  'another_textfield '   => 'This is a longer Text showing how this is used',
)); 
```

de.php：

```
Translator::loadTranslation('de', array(
  'textfield_1'          => 'Dies ist ein Textfeld',
  'another_textfield '   => 'Dies ist ein längerer Text, welcher aufzeigt, wie das hier funktioniert.',
)); 
```

在您的应用程序中，您可以像这样翻译一个字符串：

```
$string = Translator::translate('textfield_1') 
```

甚至是一堆字符串：

```
$strings = generateTemplateStrings(array('textfield_1', 'another_textfield')); 
```

因为可以只包含语言文件，所以您可以非常轻松地堆叠，例如，首先包含一个全局文件，然后包含来自子模块的文件，这些文件可以添加新字符串或替换已定义的字符串（这不适用于`define()`-方法）。

因为它是纯 PHP，它甚至可以很容易地被操作码缓存。

我什至有脚本可以生成包含文件中未翻译字符串的 CSV 文件，甚至更好：将翻译后的 CSV 文件转换回语言文件。

自 2004 年以来，我一直将此解决方案投入生产使用，对此我感到非常满意。

当然，您甚至可以使用例如复数的约定来扩展它。本地化数字格式是您必须使用其他方式做的事情 - 想到 intl-extension。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-01-16T15:17:22.350

You might want to look at a framework like CakePHP or CodeIgniter that make writing internationalized applications much easier. It's not just strings you have to consider -- things like number formats and date formats also have to be accounted for

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-01-16T15:34:25.420

只要您的解决方案仅用于翻译，它就应该可以正常工作。正如其他人所提到的，还有许多其他基于语言环境的变量，例如货币和日期格式。

使您的应用程序区域设置证明的可靠方法是[`Zend_Locale`](http://framework.zend.com/manual/en/zend.locale.html)结合使用[`Zend_Translate`](http://framework.zend.com/manual/en/zend.translate.html).

**`Zend_Locale`**允许您轻松检测用户的语言环境，或根据需要进行设置。例如，此类对于自动设置正确的*货币格式*很有用。

**`Zend_Translate`**允许您使用多种不同[格式](http://framework.zend.com/manual/en/zend.translate.adapter.html)轻松翻译文本：

*   大批
*   CSV
*   获取文本
*   伊尼
*   TBX
*   tmx
*   Qt
*   克利夫
*   XmlTm

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-16T15:31:52.337

如果您根据用户选择的语言包含不同的常量文件，您的方法是可行的。

您也可以跳过常量部分，只需使用常量 => 转换定义一个大哈希表，以防止命名空间中的崩溃。

文件：en.php

```
$常量 = 数组（
 'CONSTANT_KEY' => '翻译后的字符串'
);

```

文件：functions.php

```
函数 getConstant($key, $fallback) {
   // ... 在此处返回常量或回退。
}

```

但是，当涉及到大量数据时，这种方法将难以维护。还有一些其他方法可以更好地满足您的目的，例如，理想的解决方案是将所有常量存储在整个站点的全局内存空间中，以避免每个请求/线程都将所有这些翻译数据保存在记忆。这需要某种 php 模块方法。这里有人建议的 Gettext 可能会使用这种方法。

Google for PHP 本地化以找到有用的资源。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-16T15:35:20.643

给您的一个提示是创建一个返回已翻译字符串的函数，如果它不在哈希表中，则返回您请求的哈希键，并在其后面加上 * 之类的东西，以通知您它需要翻译。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-01-18T13:01:15.603

这是我的做法：

父脚本.php：

```
$lang_pick = "EN";    //use your own method to set language choice

require_once('trans_index.php'); 

echo $txt['hello']; 
```

* * *

trans_index.php：

```
 $text = array();

    $text['hello'] = array (
     "EN"=> "Hello",
     "FR"=> "Bonjour",
     "DE"=> "Guten Tag",
     "IT"=> "Ciao"
    );                          //as many as needed

foreach($text as $key => $val) {

$txt[$key] = $text[$key][$lang_pick];

} 
```

这可能对您的需求来说太简单了，但我发现它非常可行。它还使得维护文本的多个版本变得非常容易。

# regex - 电子邮件地址的正确正则表达式是什么？

> ID：450696
> 
> 赞同：4
> 
> 时间：2009-01-16T15:16:07.593
> 
> 标签：regex, email

**重复**：[使用正则表达式验证电子邮件地址](https://stackoverflow.com/questions/201323/what-is-the-best-regular-expression-for-validating-email-addresses)

* * *

网上似乎有很多不同的变体，想知道是否有明确的答案？

最好使用正则表达式的 .net (Regex) 方言。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-16T15:22:27.113

这个问题已经被***问*过并*回答***了好几次：

[使用正则表达式验证电子邮件地址](https://stackoverflow.com/questions/201323/what-is-the-best-regular-expression-for-validating-email-addresses)

[为什么人们使用正则表达式进行电子邮件和其他复杂的验证？](https://stackoverflow.com/questions/211842/why-are-people-using-regexp-for-email-and-other-complex-validation)

[正则表达式识别电子邮件地址很难？](https://stackoverflow.com/questions/156430/regexp-recognition-of-email-address-hard)

**特别与 .NET 相关：**

[使用正则表达式 VB.Net 验证电子邮件](https://stackoverflow.com/questions/369543/validating-e-mail-with-regular-expression-vb-net)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-16T15:20:18.647

[正则表达式](http://www.regular-expressions.info/email.html)说这个匹配大约 99%

```
[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])? 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-16T15:21:21.747

*确定*的答案？还是*正常*的答案？

我问是因为**正式**的电子邮件地址规范允许大多数人不费心去解释的各种奇怪的事情（括号、引用的短语等）。

*有关全面*和*普通正*则表达式的列表，请参阅[此页面](http://regexlib.com/DisplayPatterns.aspx)。

 *** * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-16T15:21:27.020

我认为电子邮件正则表达式验证没有灵丹妙药。

人们通常做的是只验证错误，比如没有@和一个点。然后向该地址发送电子邮件验证。这是确保他们的电子邮件确实有效的唯一方法。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-16T15:21:06.880

前段时间我也遇到过同样的问题。[RFC 2822](https://www.rfc-editor.org/rfc/rfc2822#section-3.4.1)定义了它，根据[这个页面](http://www.regular-expressions.info/email.html)，这个很有用，是我选择的那个："[a-z0-9!#$%&' *+/=?^_ `{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)* @(? :a-z0-9?.)+(?:[AZ]{2}|com|org|net|gov|mil|biz|info|mobi|name|aero|jobs|museum)\b"

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-16T15:21:17.380

```
[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])? 
```

可能希望在所有小写版本旁边添加 AZ 以便也允许大写字母。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-16T15:29:39.483

我不知道这个问题是否有一个明确的答案，但如果你把实际检查域是否存在放在一边，电子邮件地址归结为`<username>@<domain>`，其中`<domain>`至少包含一个点和后缀中的两到四个字符。你可以做各种各样的事情来检查非法/特殊字符，但最简单的一个是：

```
^[\w-\.]+@([\w-]+\.)+[\w-]{2,4}$
```

# winapi - 可以调用 .exe 的 DllMain 吗？

> ID：450700
> 
> 赞同：1
> 
> 时间：2009-01-16T15:16:36.797
> 
> 标签：winapi, dll, exe

[我的问题与这个](https://stackoverflow.com/questions/186502/dllmain-in-an-exe)问题不完全相同（这不是理论上的，只有一个没有消息循环的主线程，InitInstance 和 ExitInstance 没有合适的调用）。

我正在使用没有消息循环的控制台应用程序；这个应用程序使用 LoadLibrary 函数加载一个 exe，以便它可以使用其导出的函数。坏消息：没有调用 exe 的 DllMain 函数（我验证了符号表，使用 def 文件，DllMain 显示正确）；[文档说](http://msdn.microsoft.com/en-us/library/ms682583.aspx)如果加载的模块是 DLL（太糟糕了），就会调用它。

在调用 LoadLibrary 时（可能在调用 FreeLibrary 时再次执行）可能导致执行 exe 的 DllMain 函数的条件是什么（如果存在）？

最好的祝福

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-16T15:34:45.200

最明显的情况是调用 LoadLibrary() 的进程显式获取 GetProcAddress("DllMain") 然后调用它。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2012-09-13T01:52:51.357

条件是：

1) 正在加载的二进制文件被编译为 DLL（使用 gcc/ld 时意味着使用`--shared`选项；如果使用`--shared`，生成的文件将是 dll，并且不会运行，见下文）

2)`IMAGE_FILE_DLL`在正在加载的二进制文件的 PE 文件头中设置。如果已设置，则 file 是一个 dll，当 Windows 链接器`DllMain()`将此文件链接到您的程序时，它将为您调用它的函数（不管它是如何链接的 -`LoadLibrary()`在运行时或`-llibraryname`编译时）。为此，该文件还必须满足 (1)。但是使用此标志，正在加载的二进制文件将无法运行。如果`IMAGE_FILE_DLL`未设置，`DllMain()`将不会在文件加载到程序中时调用。

编译 dll`--shared`然后手动`IMAGE_FILE_DLL`从其标题中删除（即使用十六进制编辑器）将不起作用 - 当您运行它时，只会`DllMain()`执行，并且`fdwReason`将是一个未定义的数字（`0x28ffd4`在我的机器上）。

**更新**

Windows 上的所有 DLL 和 EXE 文件都是 PE 文件，区别在于它们的链接方式以及在它们的标头中设置了哪些标志。这就是我写作的原因`file being loaded`，而不是`dll being loaded`。

最后一段还描述了您将文件编译为 dll，然后通过弄乱其标题将其转换为 exe 的场景。它不起作用。

命名与它无关（您可以选择任何名称，并且通过一些`pexports`+`dlltool`修补，您可以为 .exe 文件创建一个导入库并能够将其链接为`-lexenamewithoutextension`

澄清：

*   如果你编译它没有`--shared`：
    *   `IMAGE_FILE_DLL`不会在其中设置，它将是可运行的，但是当您链接它时不会调用 DllMain()。
*   如果你编译它`--shared`：
    *   `IMAGE_FILE_DLL`将在其中设置，它将无法运行，但是当您链接它时将调用 DllMain()。
*   如果您在没有 的情况下编译它`--shared`，则手动打开其中的`IMAGE_FILE_DLL`标志：
    *   它不再可运行，并且在链接它时不会调用 DllMain()。
*   如果您使用 编译它`--shared`，则手动关闭其中的`IMAGE_FILE_DLL`标志：
    *   它将是可运行的，但将执行 DllMain() 而不是 main()，并且在链接它时不会调用 DllMain()。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2013-08-21T20:41:54.640

实际上，Windows 完全忽略了函数的名称“DllMain”（Windows NT 3.x 的旧 Windows API 文档明确说明了这一点）。

加载 DLL 时，不是调用函数 DllMain()，而是调用位于文件入口点的函数。

当然，链接器将以 DllMain() 是这个函数的方式创建 DLL 文件。

但是对于 EXE 文件，入口函数（将调用 WinMain()）位于入口点。

所以很明显Windows在将EXE文件加载为DLL时不能调用这个函数。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-16T17:11:32.947

[完成MSalters](https://stackoverflow.com/users/15416/msalters)的好答案：

因此，然后，在 LoadLibrary 之后使用 DLL_XXX_ATTACH 调用“假” DllMain，在 FreeLibrary 之前使用 DLL_XXX_DETACH，然后手动进行其他调用。

~~下面的另一个实现是构建和加载一个接口 DLL，它可以自动回调其假 DllMain 上的 EXE（我不知道它是否可以工作）；但在许多情况下，它可能比手动调用假的 DllMain 更复杂。~~（不能在 DllMain 中加载库）

# javascript - jQuery 版本的 array.contains

> ID：450717
> 
> 赞同：55
> 
> 时间：2009-01-16T15:22:05.333
> 
> 标签：javascript, jquery

jQuery 可以测试数组是否存在对象（作为核心功能的一部分或通过可用插件）？

另外，我正在寻找类似的东西`array.remove`，它将从数组中删除给定的对象。jQuery 可以为我处理这个吗？

* * *

## 回答 #1

> 赞同：91
> 
> 时间：2009-01-16T15:25:25.640

[jQuery.inArray](http://docs.jquery.com/Utilities/jQuery.inArray)返回与您搜索的项目匹配的第一个索引，如果未找到则返回 -1：

```
if($.inArray(valueToMatch, theArray) > -1) alert("it's in there"); 
```

你不应该需要一个array.remove。使用拼接：

```
theArray.splice(startRemovingAtThisIndex, numberOfItemsToRemove); 
```

[或者，您可以使用jQuery.grep 实用](http://docs.jquery.com/Utilities/jQuery.grep)程序执行“删除” ：

```
var valueToRemove = 'someval';
theArray = $.grep(theArray, function(val) { return val != valueToRemove; }); 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2010-04-30T18:11:42.130

如果您的列表包含元素列表，那么您可以使用[jQuery.not](http://api.jquery.com/not/)或[jQuery.filter](http://api.jquery.com/filter/)来执行“array.remove”。（由于您原始问题的高谷歌分数而添加了答案）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-01-12T08:03:04.057

我找到了删除对象的方法：

```
foot = { bar : 'test'};
delete foot[bar]; 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-02-14T19:09:34.740

这不是 jQuery，但在一行中，您可以向数组添加一个方便的“包含”方法。我发现这有助于提高可读性（尤其是对于 python 人）。

```
Array.prototype.contains = function(a){ return this.indexOf(a) != -1 } 
```

示例用法

```
 > var a = [1,2,3]
 > a.contains(1)
true
 > a.contains(4)
false 
```

同样对于删除

```
Array.prototype.remove = function(a){if (this.contains(a)){ this.splice(this.indexOf(a),1)}; return this}

> var a = [1,2,3]
> a.remove(2)
[1,3] 
```

或者，如果您希望它返回删除的东西而不是更改的数组，那么

```
Array.prototype.remove = function(a){if (this.contains(a)){ return this.splice(this.indexOf(a),1)}}

> var a = [1,2,3]
> a.remove(2)
[2]
> a
[1,3] 
```

# c# - 动态创建asp.net页面的最佳方式

> ID：450718
> 
> 赞同：2
> 
> 时间：2009-01-16T15:22:16.193
> 
> 标签：c#, asp.net-2.0

我必须在运行时动态创建一个 asp.net 页面。

它应该像这样工作：

1) 用户使用`<authentication mode="Windows" />`
2) CheckUser(string Username){} 将被发送到连接到 MySQL 数据库的网络服务，并以 true 或 false 响应。
3) 如果 checkuser 为真，webservice 将检查用户的角色。
4) 根据角色，应使用不同的控件和不同的内容动态创建 aspx 页面

最好的方法是什么？我正在使用 .NET 2.0

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-16T15:25:50.240

使用动态内容构建静态页面，而不是凭空动态创建整个页面。然后让服务器重定向到正确的页面。使用您的 web.config 文件来实施安全性。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-16T16:01:27.423

创建单个 aspx 页面，然后在呈现该页面时，检查权限并根据需要打开/关闭内容。您可以在页面上构建功能作为用户控件，并根据需要根据这些权限在页面上动态加载用户控件，或者您可以将内容放在面板中并根据需要显示/隐藏面板。但是通过创建一个 aspx 页面来实现这一点，就像上面提到的那样。

# netbeans - 在 NetBeans 6.5 中绕过对生成代码的锁定？

> ID：450727
> 
> 赞同：4
> 
> 时间：2009-01-16T15:25:03.380
> 
> 标签：netbeans, netbeans6.5

在 NetBeans 中，GUI Builder 生成的代码对您来说是编辑器的禁区。

我知道您可以切换到设计模式并指定自定义代码，然后以这种方式间接输入编辑，但是无法编辑距离光标 2 行的文本很痛苦。

我可以允许在这些区域内进行编辑吗...我保证我会小心的 :)

谢谢。

注意：我不想丢失代码生成

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-16T15:40:17.763

如果您在记事本或写字板中打开 .java 文件，您会发现成对的注释说

```
// GEN-BEGIN: <name of section>
...
// GEN-END: <name of section> 
```

删除那些评论，会发生两件事。

1.  您将能够在 NetBeans 中的文件中的任何位置进行编辑。
2.  NetBeans 将无法从 GUI 编辑器重新生成文件。

所以它可以做到，但**除非你真的认真，否则不要这样做**。

* * *

编辑：“注意：我不想失去代码生成。” 好的，让我们看看这里。

1.  您想更改生成的内容。
2.  您不想丢失代码生成。
3.  您不想使用 NetBeans 提供的工具来添加自定义代码。

听起来你是在自找麻烦。:D

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-10T03:58:44.887

如果在外部编辑器中打开它，有两种可能：

*   无法保证您所做的更改将在 Netbeans UI 编辑器中起作用（并且不会破坏任何内容）
*   下次您在 Netbeans 中编辑该文件时，它将重新生成。

无论哪种方式，可能都不是您想要的。最好的办法可能是在 gui 编辑器中完成整个设计，当您对它感到满意时，删除评论并继续。

[讽刺] 使用拖放式 gui 编辑器，您还想手动更改什么？[/讽刺] ;)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2012-03-16T00:20:25.163

我有同样的问题。我用自己的面板类扩展了 JPanel，但我无法将它与 UI 的其余部分打包在一起。首先我搜索了网络，我发现了你的问题。我无法找到这个问题的优雅解决方案。因此，我决定创建另一个 java 类并将 NetBeans 创建的代码复制到其中。它就像一个魅力。我同意，如果我们可以像在 .NET 中那样修改现有代码，那就太好了。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2014-01-16T20:11:24.480

我复制 initcomponents() 方法，创建自己的方法 newInitComponents() 粘贴生成的代码，并在分发代码之前覆盖需要覆盖的内容。这样，当在编辑器中进行更改时，您仍然可以将代码复制粘贴到新方法中。您可以保留功能，而无需花费您在必要时覆盖的能力。只需在构造函数中调用 newInitComponents() 而不是原来的。这不是最有效的做事方式，但它会做你想做的事。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2014-09-03T03:04:31.500

您也可以尝试将`.form`文件移入

(项目名称)\src\(JFrame/JPanel 名称).form

NetBeans 现在将其视为一个`.java`文件。
如果您没有编辑 GUI 编辑器所需的任何内容，您可以将`.form`文件移回`src`文件夹中。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-16T16:08:41.717

你能继承这个类并重新定义这段代码所在的方法吗？当然，当您对 GUI 进行更改时，您必须随着时间的推移维护该方法。

您也许还可以查看 AspectJ。它将在构建时修改字节码并进行您定义的更改。不确定这是否能让您充分控制要更改的代码。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-16T07:40:41.587

如果您使用[APT](http://java.sun.com/j2se/1.5.0/docs/guide/apt/GettingStarted.html)，您可以在编译时重写源代码。这样您就可以覆盖当前存在的代码。您可以将新代码与注释一起保存在同一个 Java 文件中以解释发生了什么。[本教程](http://www.javalobby.org/java/forums/t17876)使入门变得非常容易。复制该代码，让它工作，然后根据自己的喜好进行调整。要找出代码中带注释的方法在声明中调用 getPosition() 的位置。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2013-04-30T10:16:33.287

转到设计页面并选择任何一个字段。右键单击任何选定的字段并选择定制程序代码，在定制程序代码中将所有默认代码更改为自定义创建。现在您可以根据需要编辑您的设计代码...

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2014-05-14T09:52:16.767

非常简单……糟糕的 UTF-8 并没有让我编译一个 JasperReport（一切都由 GUI 完成）。所以，我需要将项目更改为 iso-8859-1。结果？项目搞砸了，一些需要纠正的地方在代码的阻塞部分。所以，我真的需要编辑那些自动生成的部分。当它们重新生成时，它们会很好，因为该项目现在是 iso-8859-1。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2017-01-14T18:05:46.757

步骤 # 1 在 NetBeans 中关闭项目

步骤 # 2 从项目的源目录中删除 .form 文件

重新打开项目，它现在可以编辑了！

# database - 如何使用 Django 执行 SQL LEFT JOIN？

> ID：450729
> 
> 赞同：2
> 
> 时间：2009-01-16T15:25:20.633
> 
> 标签：database, django, performance, postgresql

基本上我需要计算每个条目评论：

```
SELECT e.*, COUNT(c.id) as comments FROM blog_entry e LEFT JOIN blog_comment c ON e.id = c.entry_id GROUP BY e.id, e.name, e.name_slug, e.date_published, e.category, e.image, e.body, e.is_published, e.views, e.subscription_sent ORDER BY e.date_published DESC LIMIT 15; 
```

但我不知道如何使用 Django 来解决这个问题。

这是我到目前为止所拥有的，它完美地工作，除了没有评论计数。有人可以指出我使用 Django 进行这样的连接的正确方向吗？

```
from project.blog.models import Entry, Comment

def index(request):
    latest_entry_list = Entry.objects.filter(is_published=True).order_by('-date_published')[:15]
    return render_to_response('blog/index.html', {'latest_entry_list': latest_entry_list) 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-16T15:28:17.867

django 1.1 支持聚合查询，您可以通过 svn trunk 获取最新版本。文档已经更新

[http://docs.djangoproject.com/en/dev/topics/db/aggregation/](http://docs.djangoproject.com/en/dev/topics/db/aggregation/)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-17T18:02:17.150

如果您不使用主干 Django（因此不能使用新的聚合内容），您可以通过传递给 extra() QuerySet 参数的子选择来实现这一点。[extra() 的 Django 文档在此处](http://docs.djangoproject.com/en/dev/ref/models/querysets/#extra-select-none-where-none-params-none-tables-none-order-by-none-select-params-none)使用您要实现的目标作为示例（在选择标题下）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-17T17:53:18.617

如果没有聚合分支，您可以执行以下返回 2 元组列表的操作：

```
 from project.blog.models import Entry, Comment

  def index(request):
    latest_entry_list = Entry.objects.filter(is_published=True).order_by('-date_published')[:15]
    latest_entry_list_comment_count = [(x, x.count()) for x in latest_entry_list]
    return render_to_response('blog/index.html', {
         'latest_entry_list': latest_entry_list,
) 
```

只需在您的模板中使用它：

```
{% for entry in latest_entry_list %}
    Entry: {{entry.0}}
    Comment count: {{entry.1}}
{% endif %} 
```

# unix - 如何将密码传递给“su”命令？

> ID：450732
> 
> 赞同：2
> 
> 时间：2009-01-16T15:25:31.240
> 
> 标签：unix, authentication, passwords

我有一个程序将密码作为输入，然后执行 shell 以在 UNIX 中执行“su”（切换用户）命令。但是，我不知道如何将密码变量传递给 UNIX su 命令。我必须使用的语言非常有限（UniBasic）。

有任何想法吗？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-01-16T15:29:33.400

好吧，最好的方法是使用 setuid-root 二进制文件，它要求输入密码，然后执行所需的任何命令，但它需要你说不要拥有的知识。我建议改为查看[sudo(1) 。](http://www.gratisoft.us/sudo/sudo.html)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-16T15:41:05.810

您可以作为另一个用户 ssh 到 localhost 来执行您想要的任何命令。或者，使用 sudo 并编辑 /etc/sudoers 以使 sudo 不要求输入密码。但是，可能存在安全隐患。

编辑：当你投票否决时，请告诉我为什么。我的回答可能并不完美，但至少它有效。我自己为一些只能以奇怪的用户名运行的许可软件这样做。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-16T17:19:52.243

您*不想*将密码指定为命令行参数。不是因为@unwind 的回答（脚本可以设为私有），而是因为如果有人运行进程列表，您可以看到命令参数，因此可以看到有问题的密码。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-16T15:35:58.083

我的 Linux 服务器上的 su 版本不支持这样的选项。我检查了sudo，但也没有。他们希望自己进行提示，以确保以安全的方式完成，并且（我猜）阻止人们将密码逐字写入脚本等。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-17T19:01:34.207

您还可以查看“expect”实用程序，该实用程序旨在将复杂的用户输入脚本写入一个不够灵活的程序，无法从标准输入以外的地方接收此输入。

# .net-3.5 - 如何测试我的服务器是否安装了 .net 3.5 SP1？

> ID：450735
> 
> 赞同：1
> 
> 时间：2009-01-16T15:26:03.797
> 
> 标签：.net-3.5, configuration, testing

有没有办法可以将文件上传到我的 Web 服务器来测试 .net 3.5 SP1 是否安装正确？

也许使用新功能或其他东西？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-16T15:35:42.360

对此进行了相当多的讨论：

[如何判断是否安装了 .NET 3.5 SP1？](https://stackoverflow.com/questions/198931/how-do-i-tell-if-net-3-5-sp1-is-installed)

[确定是否安装了 .NET 3.5 的最佳方法](https://stackoverflow.com/questions/16178/best-way-to-determine-if-net-3-5-is-installed)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-16T15:39:26.877

将此添加到`Web.config`文件并查看程序集是否存在：

```
<add assembly="System.Web.Abstractions, Version=3.5.0.0, Culture=neutral, PublicKeyToken=31BF3856AD364E35"/> 
```

* * *

## 回答 #3

> 赞同：-2
> 
> 时间：2009-01-16T15:29:50.187

我认为，没有。但是您可以编写一个纯 .net 3.5 aspx 网页并上传并请求它。如果它在您的机器上正常工作，则服务器已获得正确的 3.5 :)

# php - PHP Get Source and Search for Word

> ID：450740
> 
> 赞同：0
> 
> 时间：2009-01-16T15:27:24.560
> 
> 标签：php, regex, search

I need help i want to code a program that search for a word inside the source code.

Here a Example in Python:

```
import urllib2, re

site = "http://stackoverflow.com/"
tosearch = "Questions"
source = urllib2.urlopen(site).read()
if re.search(tosearch,source):
     print "Found The Word", tosearch 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-16T15:37:47.660

```
<?php

$site = "http://stackoverflow.com/";
$tosearch = "Questions";
$source = file_get_contents($site);
if(preg_match("/{$tosearch}/", $source)): // fixed, thanks meouw
  echo "Found the the word {$tosearch}";
endif;

?> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-16T15:45:29.047

CURL 是一个很好的方法：

```
 $toSearch = 'Questions';

    // create curl resource
    $ch = curl_init();

    // set url
    curl_setopt($ch, CURLOPT_URL, "http://stackoverflow.com/");

    //return the transfer as a string
    curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);

    // $output contains the output string
    $output = curl_exec($ch);

    // close curl resource to free up system resources
    curl_close($ch);

    //search for the string
    if(strpos($output, $toSearch ) !== FALSE ) {
       echo "Found The Word " . $toSearch;
    } 
```

# informix - informix 是否具有等效的“物化视图”或 DB 表同步

> ID：450742
> 
> 赞同：1
> 
> 时间：2009-01-16T15:27:41.643
> 
> 标签：informix, materialized-views

**问题：** Informix 是否具有与 Oracle 的“物化视图”等效的构造，或者是否有更好的方法来同步跨数据库链接的两个表（不是数据库）？我可以自己写一个同步（被要求），但这似乎是在重新发明轮子。

**背景：**最近我们不得不拆分（DB 的一部分一个服务器，另一部分在另一台服务器上）一个整体 Informix 9.30 DB（Valent 的 MPM），因为 AppServer 和 DB 服务器的组合无法再处理负载。

在这样做时，我们必须拆分一个用户定义的表空间（KPI 存储库），该表空间以巨大的事实表和明确定义的维度表的星形模式排列。

不幸的是，一位电信公司经理决定将维度表（标准化、无数据冗余、无需编码）集中在一台机器上，从而使它们作为另一台机器上的 DB-link 的视图可用。这既慢又不稳定，因为如果视图用于子查询（可演示），它时不时会导致数据库服务器崩溃，在产品服务器上非常不酷

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-16T15:42:31.377

我可能会得到您的要求，但您能否仅使用企业复制来跨数据库复制单个表？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-16T15:50:25.310

IDS 9.30 是过时的（四个主要版本关闭当前）。理想情况下，它不应仍在使用中；您应该计划升级到 IDS 11.50。

正如 MrWiggles 所说，您应该关注 Enterprise Replication (ER)；它允许您控制复制哪些表。ER 允许随处更新拓扑；也就是说，如果您有 2 个系统，您可以配置 ER，以便将其中一个系统上的更改复制到另一个系统。

请注意，IDS 9.40 和 10.00 都引入了许多功能以使 ER 更易于管理 - 更多升级的原因（如果 IDS 9.30 不支持这一事实还不够）。

（IDS 没有 MQT - 物化查询表。）

# open-source - 即使我想保留所有权利，我是否应该开源？

> ID：450749
> 
> 赞同：3
> 
> 时间：2009-01-16T15:30:07.923
> 
> 标签：open-source, licensing

几年前，我发布了一个名为[Banshee Screamer Alarm](http://www.hanovsolutions.com/?prod=alarm)的程序，当时它包含完整的源代码，“仅用于教育目的”。你不能扩展它来制作你自己的版本，但你可以从中学习。它实际上帮助某人修复了葡萄酒中的一个错误。

如果我发布更多这样的软件（开源，但受版权保护且非免费），是否有任何我应该知道的法律荆棘？是否有任何适合此目的的许可证？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-16T15:34:17.760

出于教育目的添加源对我来说听起来不错。微软在他们的共享源计划中也做了类似的事情。

但是，如果您不使用[OSI](http://opensource.org/about)批准的许可证，您可能希望避免使用[*开源名称。*](http://opensource.org/docs/osd)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-16T15:36:34.930

我没有看到任何问题，但是我不是律师，对专有软件许可证没有真正的兴趣。您应该能够轻松地发布源代码，就像过去解释 BASIC 一样。有很多专有程序以这种方式分发。

但是，如果您将其称为“包含源代码”或类似名称而不是“开源”，那么相当多的人会喜欢它。开源倡议对“开源”有明确的含义，而且你离他们的定义一点也不近。

# python - Python 中的 Cookie 问题

> ID：450787
> 
> 赞同：3
> 
> 时间：2009-01-16T15:39:35.503
> 
> 标签：python, cookies, urllib2

我正在为 python 2.6 中的 Hulu 开发一个简单的 HTML 抓取工具，并且在登录我的帐户时遇到问题。到目前为止，这是我的代码：

```
import urllib
import urllib2
from cookielib import CookieJar
#make a cookie and redirect handlers
cookies = CookieJar() 
cookie_handler= urllib2.HTTPCookieProcessor(cookies)
redirect_handler= urllib2.HTTPRedirectHandler()

opener = urllib2.build_opener(redirect_handler,cookie_handler)#make opener w/ handlers

#build the url
login_info = {'username':USER,'password':PASS}#USER and PASS are defined
data = urllib.urlencode(login_info)

req = urllib2.Request("http://www.hulu.com/account/authenticate",data)#make the request
test = opener.open(req) #open the page
print test.read() #print html results 
```

代码编译并运行，但打印的只是：

```
Login.onError("Please \074a href=\"/support/login_faq#cant_login\"\076enable cookies\074/a\076 and try again."); 
```

我认为我处理 cookie 的方式存在一些错误，但似乎无法发现它。我听说 Mechanize 是此类程序的一个非常有用的模块，但由于这似乎是剩下的唯一减速带，我希望能找到我的错误。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-16T17:33:52.340

你看到的是一个ajax返回。它可能是使用 javascript 来设置 cookie，并搞砸了您的身份验证尝试。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-16T19:21:48.953

您收到的错误消息可能具有误导性。例如，服务器可能正在查看*用户代理*并看到它不是受支持的浏览器之一，或者查看*HTTP_REFERER*期望它来自 hulu 域。我的观点是请求中有两个很多变量来不断猜测它们

我建议使用 http 分析器工具，例如[Charles](http://www.charlesproxy.com/)或[Firebug](https://addons.mozilla.org/en-US/firefox/addon/1843)中的工具来确定当您通过浏览器进行 hulu 登录时客户端向服务器发送的内容（标题字段、cookie、参数）。这将为您提供您需要在 python 代码中构建的**确切请求。**

# wcf - 使用 SSL 进行 WCF 身份验证

> ID：450788
> 
> 赞同：6
> 
> 时间：2009-01-16T15:39:40.837
> 
> 标签：wcf

我对 WCF 很陌生，我已经创建了一个服务，可以通过使用 basicHttpBinding 的 Windows 移动应用程序使用。我现在正在研究如何实现加密和身份验证，但我并没有走得太远。

我已将以下内容添加到我的服务器端服务配置中（我认为这是正确的）：

```
 <basicHttpBinding>
    <binding name="SecurityByTransport">
      <security mode="TransportWithMessageCredential">
        <message clientCredentialType="UserName" />
        <transport clientCredentialType="Certificate" />
      </security>
    </binding>
  </basicHttpBinding> 
```

现在，在我的 IIS 实例上安装临时证书后，我可以通过 https 导航到我的服务。

在这一点上，我使用了 Visual Studios 内置的工具来运行 svcutil.exe 并生成了我的代理，它连接得很好。

我遇到的问题出在客户端配置中，因为端点引用使用的是 http 而不是 https。如果我改变它，我会收到以下错误：

```
The provided URI scheme 'https' is invalid; expected 'http'. 
```

这显然是我不想要的。

同样在我的客户端配置中，指定的安全性似乎是“无”，对吗？

# java - 如果从 Java 程序调用，批处理不起作用

> ID：450789
> 
> 赞同：0
> 
> 时间：2009-01-16T15:39:46.500
> 
> 标签：java, batch-file

我写了一个批处理文件，它读入一个包含文件名列表的文本文件，然后一个一个地删除并重命名它们。我通过使用 for 循环来做到这一点，双击它可以完美地工作。

但是当我试图从 Java 程序中调用这个批处理时。它不再适用于这部分：

```
对于 (ListFile.txt) 中的 /f %%a 执行 (
    删除 %%a
    REN %%a_NEW %%~nxa
  )
```

如果我只指定某个文件名。它通过从 Java 调用来工作。说，

```
删除标签.jar
REN tag.jar_NEW tag.jar
```

“呼叫”命令也会发生同样的事情。如果从 Java 程序调用它不起作用，这使我不得不使用“开始”命令。

有人能告诉我为什么会这样吗？如果从 Java 程序调用，我怎样才能使它也能工作？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-16T15:43:16.913

你是如何从 Java 中调用它的？

当你这样做的时候到底发生了什么？

当您从 Java 调用批处理文件时，为什么要调用批处理文件而不是在 Java 中做同样的事情？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-16T17:17:39.970

你应该使用：

```
Runtime.getRuntime().exec("cmd /c update.bat"); 
```

反而。

[这](https://stackoverflow.com/questions/236737/language-showdown-how-do-you-make-a-system-call-that-returns-the-stdout-output-a#373223)是有关如何从 java 运行程序的片段。

下面是我如何测试它。

```
import java.io.*;
public class RunIt {
    public static void main( String [] args ) throws Throwable   { 
        Process p = Runtime.getRuntime().exec( "cmd /c update.bat");
        InputStream i = p.getInputStream();
        for(  int c = 0 ; ( c =  i.read() ) > -1  ; ) {}
        i.close();
    }
} 
```

由于某种超出我理解的原因，如果我不读取输入，则不会执行该过程，这就是上面*for*循环的原因。

这是我的测试：

```
C:\oreyes\samples\java\readinput>type update.bat
echo "x" >> x.txt

C:\oreyes\samples\java\readinput>dir x.txt
 Directorio de C:\oreyes\samples\java\readinput

 No se encuentra el archivo // That is file not found

C:\oreyes\samples\java\readinput>javac RunIt.java

C:\oreyes\samples\java\readinput>java RunIt

C:\oreyes\samples\java\readinput>dir x.txt

01/16/2009  11:14 AM                 6 x.txt // file created hence update.bat executed
               1 archivos              6 bytes 
```

我希望这有帮助。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-16T16:05:45.467

也许当前目录不是你想的那样，所以没有找到 ListFile.txt。

尝试类似：

```
set BAT_HOME=%~dp0
echo %BAT_HOME%

for /f %%a in (%BAT_HOME%\ListFile.txt) do (
    DEL %%a
    REN %%a_NEW %%~nxa
  ) 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-16T19:05:25.087

进程 p = Runtime.getRuntime().exec("update.bat");

p.waitFor();

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-16T19:22:43.943

您确定您可以执行 BAT 脚本吗？我认为 Windows 不像 Unix 那样将它们视为一流的可执行文件。你可能不得不做一些奇怪的事情，比如：

```
...exec("cmd /c update.bat") 
```

# shell - Shell命令对整数求和，每行一个？

> ID：450799
> 
> 赞同：993
> 
> 时间：2009-01-16T15:42:03.500
> 
> 标签：shell

我正在寻找一个命令，它将接受（作为输入）多行文本，每行包含一个整数，并输出这些整数的总和。

作为背景知识，我有一个包含时序测量的日志文件。通过对相关行的 grepping 和一些`sed`重新格式化，我可以列出该文件中的所有时间。我想算出总数。我可以将此中间输出通过管道传输到任何命令，以便进行最终总和。我过去一直使用`expr`，但除非它在 ​​RPN 模式下运行，否则我认为它不会处理这个问题（即使这样也会很棘手）。

我怎样才能得到整数的总和？

* * *

## 回答 #1

> 赞同：1499
> 
> 时间：2009-01-16T15:46:00.763

有点 awk 应该这样做吗？

```
awk '{s+=$1} END {print s}' mydatafile 
```

注意：如果您要添加超过 2^31 (2147483647) 的任何内容，某些版本的 awk 会出现一些奇怪的行为。有关更多背景信息，请参阅评论。一个建议是使用`printf`而不是`print`：

```
awk '{s+=$1} END {printf "%.0f", s}' mydatafile 
```

* * *

## 回答 #2

> 赞同：729
> 
> 时间：2009-01-16T17:05:33.177

粘贴通常会合并多个文件的行，但它也可用于将文件的各个行转换为单行。分隔符标志允许您将 x+x 类型的方程传递给 bc。

```
paste -s -d+ infile | bc 
```

或者，当从标准输入管道时，

```
<commands> | paste -s -d+ - | bc 
```

* * *

## 回答 #3

> 赞同：146
> 
> 时间：2009-01-16T15:52:06.460

Python 中的单行版本：

```
$ python -c "import sys; print(sum(int(l) for l in sys.stdin))" 
```

* * *

## 回答 #4

> 赞同：112
> 
> 时间：2014-08-11T13:55:54.793

我会对普遍认可的解决方案提出一个很大的警告：

```
awk '{s+=$1} END {print s}' mydatafile # DO NOT USE THIS!! 
```

这是因为在这种形式中，awk 使用 32 位有符号整数表示：对于超过 2147483647（即 2^31）的总和，它将溢出。

一个更一般的答案（对整数求和）是：

```
awk '{s+=$1} END {printf "%.0f\n", s}' mydatafile # USE THIS INSTEAD 
```

* * *

## 回答 #5

> 赞同：91
> 
> 时间：2009-01-16T15:55:54.940

普通的 bash：

```
$ cat numbers.txt 
1
2
3
4
5
6
7
8
9
10
$ sum=0; while read num; do ((sum += num)); done < numbers.txt; echo $sum
55 
```

* * *

## 回答 #6

> 赞同：75
> 
> 时间：2014-10-27T17:07:05.043

与[jq](http://stedolan.github.io/jq/)：

```
seq 10 | jq -s 'add' # 'add' is equivalent to 'reduce .[] as $item (0; . + $item)' 
```

* * *

## 回答 #7

> 赞同：68
> 
> 时间：2009-01-17T13:09:46.723

```
dc -f infile -e '[+z1<r]srz1<rp' 
```

请注意，以减号为前缀的负数应翻译为`dc`，因为它使用`_`前缀而不是`-`前缀。例如，通过`tr '-' '_' | dc -f- -e '...'`.

### 编辑：由于这个答案“默默无闻”得到了这么多票，这里有一个详细的解释：

该表达式`[+z1<r]srz1<rp` [执行以下操作](http://linux.die.net/man/1/dc)：

```
[   interpret everything to the next ] as a string
  +   push two values off the stack, add them and push the result
  z   push the current stack depth
  1   push one
  <r  pop two values and execute register r if the original top-of-stack (1)
      is smaller
]   end of the string, will push the whole thing to the stack
sr  pop a value (the string above) and store it in register r
z   push the current stack depth again
1   push 1
<r  pop two values and execute register r if the original top-of-stack (1)
    is smaller
p   print the current top-of-stack 
```

作为伪代码：

1.  将“add_top_of_stack”定义为：
    1.  从堆栈中删除两个顶部值并将结果添加回来
    2.  如果堆栈有两个或多个值，则递归运行“add_top_of_stack”
2.  如果堆栈有两个或更多值，请运行“add_top_of_stack”
3.  打印结果，现在是堆栈中剩下的唯一项目

要真正理解 的简单性和强大功能`dc`，这里有一个工作 Python 脚本，它实现了一些命令`dc`并执行上述命令的 Python 版本：

```
### Implement some commands from dc
registers = {'r': None}
stack = []
def add():
    stack.append(stack.pop() + stack.pop())
def z():
    stack.append(len(stack))
def less(reg):
    if stack.pop() < stack.pop():
        registers[reg]()
def store(reg):
    registers[reg] = stack.pop()
def p():
    print stack[-1]

### Python version of the dc command above

# The equivalent to -f: read a file and push every line to the stack
import fileinput
for line in fileinput.input():
    stack.append(int(line.strip()))

def cmd():
    add()
    z()
    stack.append(1)
    less('r')

stack.append(cmd)
store('r')
z()
stack.append(1)
less('r')
p() 
```

* * *

## 回答 #8

> 赞同：51
> 
> 时间：2012-12-20T09:55:27.893

纯粹而简短的 bash。

```
f=$(cat numbers.txt)
echo $(( ${f//$'\n'/+} )) 
```

* * *

## 回答 #9

> 赞同：39
> 
> 时间：2009-01-16T15:45:34.897

```
perl -lne '$x += $_; END { print $x; }' < infile.txt 
```

* * *

## 回答 #10

> 赞同：32
> 
> 时间：2013-08-21T10:35:27.613

我的十五美分：

```
$ cat file.txt | xargs  | sed -e 's/\ /+/g' | bc 
```

例子：

```
$ cat text
1
2
3
3
4
5
6
78
9
0
1
2
3
4
576
7
4444
$ cat text | xargs  | sed -e 's/\ /+/g' | bc 
5148 
```

* * *

## 回答 #11

> 赞同：30
> 
> 时间：2017-11-07T15:54:43.710

我已经对现有答案进行了快速基准测试

*   `lua`仅使用标准工具（对不起，或之类的东西`rocket`），
*   是真正的单线，
*   能够添加大量数字（1亿），并且
*   速度很快（我忽略了那些耗时超过一分钟的）。

我总是将 1 到 1 亿的数字相加，这在我的机器上可以在不到一分钟的时间内完成几个解决方案。

结果如下：

### Python

```
:; seq 100000000 | python -c 'import sys; print sum(map(int, sys.stdin))'
5000000050000000
# 30s
:; seq 100000000 | python -c 'import sys; print sum(int(s) for s in sys.stdin)'
5000000050000000
# 38s
:; seq 100000000 | python3 -c 'import sys; print(sum(int(s) for s in sys.stdin))'
5000000050000000
# 27s
:; seq 100000000 | python3 -c 'import sys; print(sum(map(int, sys.stdin)))'
5000000050000000
# 22s
:; seq 100000000 | pypy -c 'import sys; print(sum(map(int, sys.stdin)))'
5000000050000000
# 11s
:; seq 100000000 | pypy -c 'import sys; print(sum(int(s) for s in sys.stdin))'
5000000050000000
# 11s 
```

### awk

```
:; seq 100000000 | awk '{s+=$1} END {print s}'
5000000050000000
# 22s 
```

### 粘贴 & Bc

这在我的机器上耗尽了内存。它适用于输入大小的一半（5000 万个数字）：

```
:; seq 50000000 | paste -s -d+ - | bc
1250000025000000
# 17s
:; seq 50000001 100000000 | paste -s -d+ - | bc
3750000025000000
# 18s 
```

所以我猜这 1 亿个数字大约需要 35 秒。

### Perl

```
:; seq 100000000 | perl -lne '$x += $_; END { print $x; }'
5000000050000000
# 15s
:; seq 100000000 | perl -e 'map {$x += $_} <> and print $x'
5000000050000000
# 48s 
```

### 红宝石

```
:; seq 100000000 | ruby -e "puts ARGF.map(&:to_i).inject(&:+)"
5000000050000000
# 30s 
```

### C

只是为了比较，我编译了 C 版本并对其进行了测试，只是为了了解基于工具的解决方案的速度有多慢。

```
#include <stdio.h>
int main(int argc, char** argv) {
    long sum = 0;
    long i = 0;
    while(scanf("%ld", &i) == 1) {
        sum = sum + i;
    }
    printf("%ld\n", sum);
    return 0;
} 
```

```
:; seq 100000000 | ./a.out 
5000000050000000
# 8s 
```

### 结论

C 当然是最快的 8s，但是**Pypy 解决方案只增加了 11s 大约 30% 的非常小的开销**。但是，公平地说，Pypy 并不完全是标准的。大多数人只安装了速度明显较慢（22 秒）的 CPython，与流行的 Awk 解决方案一样快。

**基于标准工具的最快解决方案是 Perl (15s)。**

* * *

## 回答 #12

> 赞同：19
> 
> 时间：2009-01-16T15:52:23.573

BASH 解决方案，如果您想将其设为命令（例如，如果您需要经常执行此操作）：

```
addnums () {
  local total=0
  while read val; do
    (( total += val ))
  done
  echo $total
} 
```

然后用法：

```
addnums < /tmp/nums 
```

* * *

## 回答 #13

> 赞同：19
> 
> 时间：2011-10-11T01:50:31.127

普通的 bash 一班轮

```
$ cat > /tmp/test
1 
2 
3 
4 
5
^D

$ echo $(( $(cat /tmp/test | tr "\n" "+" ) 0 )) 
```

* * *

## 回答 #14

> 赞同：16
> 
> 时间：2019-03-28T08:02:04.207

使用[*GNU* `datamash`工具](https://savannah.gnu.org/projects/datamash/)：

```
seq 10 | datamash sum 1 
```

输出：

```
55 
```

* * *

如果输入数据不规则，在奇怪的地方有空格和制表符，这可能会造成混淆`datamash`，然后使用`-W`开关：

```
<commands...> | datamash -W sum 1 
```

...或用于`tr`清理空白：

```
<commands...> | tr -d '[[:blank:]]' | datamash sum 1 
```

* * *

如果输入足够大，输出将是科学计数法。

```
seq 100000000 | datamash sum 1 
```

输出：

```
5.00000005e+15 
```

要将其转换为十进制，请使用以下`--format`选项：

```
seq 100000000 | datamash  --format '%.0f' sum 1 
```

输出：

```
5000000050000000 
```

* * *

## 回答 #15

> 赞同：15
> 
> 时间：2009-01-16T16:00:08.410

您可以使用 num-utils，尽管它对于您的需要可能是多余的。这是一组用于在 shell 中操作数字的程序，可以做一些漂亮的事情，当然包括将它们相加。这有点过时了，但它们仍然有效，如果您需要做更多的事情，它们会很有用。

[https://suso.suso.org/programs/num-utils/index.phtml](https://suso.suso.org/programs/num-utils/index.phtml)

使用起来非常简单：

```
$ seq 10 | numsum
55 
```

但是大输入的内存不足。

```
$ seq 100000000 | numsum
Terminado (killed) 
```

* * *

## 回答 #16

> 赞同：11
> 
> 时间：2009-01-16T15:49:51.097

以下在 bash 中有效：

```
I=0

for N in `cat numbers.txt`
do
    I=`expr $I + $N`
done

echo $I 
```

* * *

## 回答 #17

> 赞同：10
> 
> 时间：2017-09-27T00:49:56.363

无法避免提交此问题，这是此问题最通用的方法，请检查：

```
jot 1000000 | sed '2,$s/$/+/;$s/$/p/' | dc 
```

在这里可以找到，我是OP，观众的回答是：

*   [最优雅的 unix shell 单行来总结任意精度的数字列表？](https://stackoverflow.com/questions/44771056/which-is-the-most-elegant-unix-shell-one-liner-to-sum-any-numbers-of-arbitrary-p/46248951#46248951)

**以下是它相对于awk**、**bc**、**perl**、**GNU 的 datamash**和朋友的特殊优势：

*   **它使用任何 Unix 环境中常见的标准实用程序**
*   **它不依赖于缓冲**，因此**它不会因很长的输入而窒息**。
*   **这意味着没有特定的精度限制**- 或整数大小 -，你好 AWK 朋友！
*   **不需要不同的代码，如果需要添加浮点数，而不是**.
*   **它理论上可以在最小的环境中畅通无阻地运行**

* * *

## 回答 #18

> 赞同：9
> 
> 时间：2009-01-17T13:44:36.780

```
sed 's/^/.+/' infile | bc | tail -1 
```

* * *

## 回答 #19

> 赞同：9
> 
> 时间：2009-10-15T00:34:32.627

我意识到这是一个老问题，但我很喜欢这个解决方案来分享它。

```
% cat > numbers.txt
1 
2 
3 
4 
5
^D
% cat numbers.txt | perl -lpe '$c+=$_}{$_=$c'
15 
```

如果有兴趣，我会解释它是如何工作的。

* * *

## 回答 #20

> 赞同：8
> 
> 时间：2012-10-07T14:43:49.937

纯 bash 和单线 :-)

```
$ cat numbers.txt
1
2
3
4
5
6
7
8
9
10

$ I=0; for N in $(cat numbers.txt); do I=$(($I + $N)); done; echo $I
55 
```

* * *

## 回答 #21

> 赞同：6
> 
> 时间：2015-01-08T16:53:11.140

替代纯 Perl，相当易读，不需要包或选项：

```
perl -e "map {$x += $_} <> and print $x" < infile.txt 
```

* * *

## 回答 #22

> 赞同：6
> 
> 时间：2015-10-28T06:20:29.927

对于红宝石爱好者

```
ruby -e "puts ARGF.map(&:to_i).inject(&:+)" numbers.txt 
```

* * *

## 回答 #23

> 赞同：5
> 
> 时间：2021-12-30T14:52:52.747

这是一个漂亮而干净的[Raku](https://raku.org/)（以前称为 Perl 6）单行：

```
say [+] slurp.lines 
```

我们可以这样使用它：

```
% seq 10 | raku -e "say [+] slurp.lines"
55 
```

它是这样工作的：

[`slurp`](https://docs.raku.org/language/independent-routines#sub_slurp)默认情况下从标准输入读取没有任何参数；它返回一个字符串。对字符串调用该[`lines`方法](https://docs.raku.org/routine/lines#(Str)_routine_lines)会返回字符串的行列表。

周围的括号`+`变成`+`了一个[归约元运算符](https://docs.raku.org/language/operators#Reduction_metaoperators)，它将列表*简化*为一个值：列表中值的总和。`say`然后用换行符将其打印到标准输出。

需要注意的一点是，我们从不将行显式转换为数字——Raku 足够聪明，可以为我们做到这一点。然而，这意味着我们的代码在输入肯定不是数字时中断：

```
% echo "1\n2\nnot a number" | raku -e "say [+] slurp.lines"
Cannot convert string to number: base-10 number must begin with valid digits or '.' in '⏏not a number' (indicated by ⏏)
  in block <unit> at -e line 1 
```

* * *

## 回答 #24

> 赞同：4
> 
> 时间：2009-01-16T15:46:20.840

如果您觉得舒服，您可以在 python 中执行此操作：

未测试，仅输入：

```
out = open("filename").read();
lines = out.split('\n')
ints = map(int, lines)
s = sum(ints)
print s 
```

塞巴斯蒂安指出了一个单行脚本：

```
cat filename | python -c"from fileinput import input; print sum(map(int, input()))" 
```

* * *

## 回答 #25

> 赞同：4
> 
> 时间：2009-01-16T15:55:58.683

以下应该有效（假设您的号码是每行的第二个字段）。

```
awk 'BEGIN {sum=0} \
 {sum=sum + $2} \
END {print "tot:", sum}' Yourinputfile.txt 
```

* * *

## 回答 #26

> 赞同：3
> 
> 时间：2009-10-15T00:49:19.773

```
$猫n
2
4
2
7
8
9

```

```
$ perl -MList::Util -le 'print List::Util::sum(<>)' < n
32 
```

或者，您可以在命令行中输入数字：

```
$ perl -MList::Util -le 'print List::Util::sum(<>)'
1
3
5
^D
9 
```

但是，这个会破坏文件，因此在大文件上使用并不是一个好主意。请参阅[j_random_hacker](https://stackoverflow.com/questions/450799/linux-command-to-sum-integers-one-per-line/450819#450819)避免啜饮的答案。

* * *

## 回答 #27

> 赞同：3
> 
> 时间：2012-11-03T23:08:56.143

球拍中的单线：

```
racket -e '(define (g) (define i (read)) (if (eof-object? i) empty (cons i (g)))) (foldr + 0 (g))' < numlist.txt 
```

* * *

## 回答 #28

> 赞同：3
> 
> 时间：2013-01-24T07:19:07.967

C（未简化）

```
seq 1 10 | tcc -run <(cat << EOF
#include <stdio.h>
int main(int argc, char** argv) {
    int sum = 0;
    int i = 0;
    while(scanf("%d", &i) == 1) {
        sum = sum + i;
    }
    printf("%d\n", sum);
    return 0;
}
EOF) 
```

* * *

## 回答 #29

> 赞同：3
> 
> 时间：2014-05-23T17:40:34.097

我的版本：

```
seq -5 10 | xargs printf "- - %s" | xargs  | bc 
```

* * *

## 回答 #30

> 赞同：2
> 
> 时间：2011-10-11T20:43:41.000

C++（简体）：

```
echo {1..10} | scc 'WRL n+=$0; n' 
```

SCC 项目 - [http://volnitsky.com/project/scc/](http://volnitsky.com/project/scc/)

SCC 是 shell 提示符下的 C++ 片段评估器

* * *

## 回答 #31

> 赞同：2
> 
> 时间：2012-03-06T00:01:46.867

为反引号（“`”）的可读性提前道歉，但这些在 bash 以外的 shell 中工作，因此更易于粘贴。如果您使用接受它的 shell，则 $(command ...) 格式比 `command ...` 更具可读性（因此可调试），因此请随意修改以保持理智。

我的 bashrc 中有一个简单的函数，它将使用 awk 计算一些简单的数学项

```
calc(){
  awk 'BEGIN{print '"$@"' }'
} 
```

这将执行 +,-,*,/,^,%,sqrt,sin,cos, 括号 ....（以及更多取决于您的 awk 版本）...您甚至可以使用 printf 和格式化浮点输出，但这就是我通常需要的

对于这个特定的问题，我会简单地为每一行执行此操作：

```
calc `echo "$@"|tr " " "+"` 
```

所以对每一行求和的代码块看起来像这样：

```
while read LINE || [ "$LINE" ]; do
  calc `echo "$LINE"|tr " " "+"` #you may want to filter out some lines with a case statement here
done 
```

那就是如果你只想逐行总结它们。但是对于数据文件中的*每个数字的总数*

```
VARS=`<datafile`
calc `echo ${VARS// /+}` 
```

顺便说一句，如果我需要在桌面上快速做一些事情，我会使用这个：

```
xcalc() { 
  A=`calc "$@"`
  A=`Xdialog --stdout --inputbox "Simple calculator" 0 0 $A`
  [ $A ] && xcalc $A
} 
```

* * *

## 回答 #32

> 赞同：1
> 
> 时间：2013-02-15T20:43:23.517

lua 解释器存在于所有基于 fedora 的系统 [fedora,RHEL,CentOS,korora 等，因为它嵌入了 rpm-package（包管理器 rpm 的包），即 rpm-lua] 如果你想学习 lua这种问题是理想的（你也会完成你的工作）。

```
cat filname | lua -e "sum = 0;for i in io.lines() do sum=sum+i end print(sum)" 
```

它有效。不过 Lua 很冗长，你可能不得不忍受一些反复的键盘敲击伤害 :)

* * *

## 回答 #33

> 赞同：1
> 
> 时间：2014-04-26T03:51:39.363

实时汇总，让您监控一些数字运算任务的进度。

```
$ cat numbers.txt 
1
2
3
4
5
6
7
8
9
10

$ cat numbers.txt | while read new; do total=$(($total + $new)); echo $total; done
1
3
6
10
15
21
28
36
45
55 
```

（在这种情况下无需设置`$total`为零。完成后您也无法访问 $total。）

* * *

## 回答 #34

> 赞同：1
> 
> 时间：2014-12-21T17:00:43.053

您可以使用 Alacon - [Alasql](http://github.com/agershun/alasql)数据库的命令行实用程序来完成。

它适用于 Node.js，因此您需要安装[Node.js](http://nodejs.org/)，然后安装[Alasql](https://www.npmjs.com/package/alasql)包：

要从标准输入计算总和，您可以使用以下命令：

```
> cat data.txt | node alacon "SELECT VALUE SUM([0]) FROM TXT()" >b.txt 
```

* * *

## 回答 #35

> 赞同：1
> 
> 时间：2015-03-20T00:36:11.367

您可以使用您喜欢的“expr”命令，您只需要先稍微调整一下输入：

```
seq 10 | tr '[\n]' '+' | sed -e 's/+/ + /g' -e's/ + $/\n/' | xargs expr 
```

过程是：

*   "tr" 将 eoln 字符替换为 + 符号，
*   sed 在 '+' 的每一边都用空格填充，然后从行中删除最后的 +
*   xargs 将管道输入插入命令行以供 expr 使用。

* * *

## 回答 #36

> 赞同：1
> 
> 时间：2017-04-03T14:14:01.143

只是为了完整性，还有一个`R`解决方案

```
seq 1 10 | R -q -e "f <- file('stdin'); open(f); cat(sum(as.numeric(readLines(f))))" 
```

* * *

## 回答 #37

> 赞同：0
> 
> 时间：2009-01-16T15:49:42.610

一个简单的解决方案是编写一个程序来为你做这件事。这可能在 python 中可以很快完成，例如：

```
sum = 0
file = open("numbers.txt","R")
for line in file.readlines(): sum+=int(line)
file.close()
print sum 
```

我还没有测试过该代码，但它看起来是正确的。只需将 numbers.txt 更改为文件名，将代码保存到名为 sum.py 的文件中，然后在控制台中键入“python sum.py”

* * *

## 回答 #38

> 赞同：0
> 
> 时间：2013-03-18T10:37:03.910

```
#include <iostream>

int main()
{
    double x = 0, total = 0;
    while (std::cin >> x)
        total += x;
    if (!std::cin.eof())
        return 1;
    std::cout << x << '\n';
} 
```

* * *

## 回答 #39

> 赞同：0
> 
> 时间：2013-03-22T09:42:43.613

...和 ​​PHP 版本，只是为了完整起见

```
cat /file/with/numbers | php -r '$s = 0; while (true) { $e = fgets(STDIN); if (false === $e) break; $s += $e; } echo $s;' 
```

* * *

## 回答 #40

> 赞同：0
> 
> 时间：2013-10-02T18:41:50.330

Rebol 中的单线：

```
rebol -q --do 's: 0 while [d: input] [s: s + to-integer d] print s' < infile.txt 
```

不幸的是，上面的内容还不能在 Rebol 3 中工作（**INPUT**不流式传输 STDIN）。

所以这里有一个临时解决方案，它也适用于 Rebol 3：

```
rebol -q --do 's: 0 foreach n to-block read %infile.txt [s: s + n] print s' 
```

* * *

## 回答 #41

> 赞同：0
> 
> 时间：2016-06-17T06:57:38.533

使用环境变量 tmp

```
tmp=awk -v tmp="$tmp" '{print $tmp" "$1}' <filename>|echo $tmp|sed "s/ /+/g"|bc

tmp=cat <filename>|awk -v tmp="$tmp" '{print $tmp" "$1}'|echo $tmp|sed "s/ /+/g"|bc 
```

谢谢。

* * *

## 回答 #42

> 赞同：-1
> 
> 时间：2013-10-22T07:15:33.370

简单的php

```
 cat numbers.txt | php -r "echo array_sum(explode(PHP_EOL, stream_get_contents(STDIN)));" 
```

* * *

## 回答 #43

> 赞同：-6
> 
> 时间：2020-02-11T21:19:23.637

好的，这是在 PowerShell 中的操作方法（PowerShell 核心，应该可以在 Windows、Linux 和 Mac 上运行）

```
Get-Content aaa.dat | Measure-Object -Sum 
```

# powershell - PowerShell 2 CTP3 ISE 的自定义读取主机对话框

> ID：450801
> 
> 赞同：2
> 
> 时间：2009-01-16T15:42:36.573
> 
> 标签：powershell, powershell-2.0, powershell-ise

是否可以将自定义对话框挂接到新的 PowerShell ISE（集成脚本环境）中，以替换现有的 .NET WinForms 对话框。我说的是`Read-Host`cmdlet 启动以请求用户输入的对话框。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-25T02:30:31.683

例如，请参阅此 URL： http: [//www.microsoft.com/technet/scriptcenter/resources/pstips/feb08/pstip0208.mspx](http://www.microsoft.com/technet/scriptcenter/resources/pstips/feb08/pstip0208.mspx)

1.  将完整代码拖放到记事本中。
2.  添加第一行：function read-host {
3.  添加最后一行：}
4.  从记事本复制所有内容。
5.  将其全部粘贴到您的 PowerShell 控制台中。

现在，如果您调用 read-host，您将看到一个新的 Windows 窗体。

现在，如果我打开其他窗口，它仍然在顶部，但它似乎不是最顶部的，因为我在其他所有窗口中都看到它，但仍然需要单击它以使其处于活动状态。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-16T21:12:45.033

您可以做的是创建一个覆盖 Read-Host 的自定义函数，因此您实际上是在篡夺 Read-Host 并替换您自己的功能。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-16T16:28:08.167

我不相信你可以，不。您需要编写自己的托管应用程序。ISE 确实有自己的对象模型——我问的是你所追求的是否可能。

# java - 如何使方法返回类型通用？

> ID：450807
> 
> 赞同：653
> 
> 时间：2009-01-16T15:43:08.693
> 
> 标签：java, generics, return-value

考虑这个例子（在 OOP 书籍中很典型）：

我有一个`Animal`班级，每个班级`Animal`可以有很多朋友。以及添加特定行为的
子类`Dog`，如`Duck`,等。`Mouse``bark()``quack()`

这是`Animal`课程：

```
public class Animal {
    private Map<String,Animal> friends = new HashMap<>();

    public void addFriend(String name, Animal animal){
        friends.put(name,animal);
    }

    public Animal callFriend(String name){
        return friends.get(name);
    }
} 
```

这是一些带有大量类型转换的代码片段：

```
Mouse jerry = new Mouse();
jerry.addFriend("spike", new Dog());
jerry.addFriend("quacker", new Duck());

((Dog) jerry.callFriend("spike")).bark();
((Duck) jerry.callFriend("quacker")).quack(); 
```

有什么方法可以使用泛型作为返回类型来摆脱类型转换，所以我可以说

```
jerry.callFriend("spike").bark();
jerry.callFriend("quacker").quack(); 
```

这是一些初始代码，其返回类型作为从未使用过的参数传递给方法。

```
public<T extends Animal> T callFriend(String name, T unusedTypeObj){
    return (T)friends.get(name);        
} 
```

有没有办法在运行时确定返回类型而无需使用额外的参数`instanceof`？或者至少通过传递一个类型的类而不是一个虚拟实例。
我了解泛型用于编译时类型检查，但是有解决方法吗？

* * *

## 回答 #1

> 赞同：988
> 
> 时间：2009-01-16T15:57:35.123

你可以这样定义`callFriend`：

```
public <T extends Animal> T callFriend(String name, Class<T> type) {
    return type.cast(friends.get(name));
} 
```

然后这样称呼它：

```
jerry.callFriend("spike", Dog.class).bark();
jerry.callFriend("quacker", Duck.class).quack(); 
```

此代码的好处是不会生成任何编译器警告。当然，这实际上只是从前通用时代开始的更新版本，并没有增加任何额外的安全性。

* * *

## 回答 #2

> 赞同：129
> 
> 时间：2009-01-16T15:50:05.403

不，编译器不知道`jerry.callFriend("spike")`会返回什么类型。此外，您的实现只是隐藏了方法中的强制转换，没有任何额外的类型安全。考虑一下：

```
jerry.addFriend("quaker", new Duck());
jerry.callFriend("quaker", /* unused */ new Dog()); // dies with illegal cast 
```

在这种特定情况下，创建一个抽象`talk()`方法并在子类中适当地覆盖它会更好地为您服务：

```
Mouse jerry = new Mouse();
jerry.addFriend("spike", new Dog());
jerry.addFriend("quacker", new Duck());

jerry.callFriend("spike").talk();
jerry.callFriend("quacker").talk(); 
```

* * *

## 回答 #3

> 赞同：127
> 
> 时间：2009-01-16T15:51:54.340

你可以像这样实现它：

```
@SuppressWarnings("unchecked")
public <T extends Animal> T callFriend(String name) {
    return (T)friends.get(name);
} 
```

（是的，这是合法代码；请参阅[Java Generics：Generic type defined as return type only](https://stackoverflow.com/questions/338887/java-generics-generic-type-defined-as-return-type-only)。）

返回类型将从调用者推断。但是，请注意`@SuppressWarnings`注释：它告诉您**此代码不是 typesafe**。您必须自己验证它，或者您可以`ClassCastExceptions`在运行时获取。

不幸的是，您使用它的方式（没有将返回值分配给临时变量），让编译器满意的唯一方法是这样调用它：

```
jerry.<Dog>callFriend("spike").bark(); 
```

虽然这可能比强制转换好一点，但正如 David Schmitt 所说，给`Animal`类一个抽象方法可能会更好。`talk()`

* * *

## 回答 #4

> 赞同：31
> 
> 时间：2009-01-16T17:06:24.580

**这个问题与Effective Java 中的第 29**条非常相似——“考虑类型安全的异构容器”。Laz 的答案最接近 Bloch 的解决方案。但是，为了安全起见， put 和 get 都应该使用 Class 字面量。签名将变为：

```
public <T extends Animal> void addFriend(String name, Class<T> type, T animal);
public <T extends Animal> T callFriend(String name, Class<T> type); 
```

在这两种方法中，您应该检查参数是否正常。有关详细信息，请参阅有效的 Java 和[类](http://java.sun.com/javase/6/docs/api/java/lang/Class.html)javadoc。

* * *

## 回答 #5

> 赞同：28
> 
> 时间：2017-07-15T15:20:43.627

这是更简单的版本：

```
public <T> T callFriend(String name) {
    return (T) friends.get(name); //Casting to T not needed in this case but its a good practice to do
} 
```

完整的工作代码：

```
 public class Test {
        public static class Animal {
            private Map<String,Animal> friends = new HashMap<>();

            public void addFriend(String name, Animal animal){
                friends.put(name,animal);
            }

            public <T> T callFriend(String name){
                return (T) friends.get(name);
            }
        }

        public static class Dog extends Animal {

            public void bark() {
                System.out.println("i am dog");
            }
        }

        public static class Duck extends Animal {

            public void quack() {
                System.out.println("i am duck");
            }
        }

        public static void main(String [] args) {
            Animal animals = new Animal();
            animals.addFriend("dog", new Dog());
            animals.addFriend("duck", new Duck());

            Dog dog = animals.callFriend("dog");
            dog.bark();

            Duck duck = animals.callFriend("duck");
            duck.quack();

        }
    } 
```

* * *

## 回答 #6

> 赞同：18
> 
> 时间：2016-06-24T05:12:36.600

此外，您可以要求该方法以这种方式返回给定类型的值

```
<T> T methodName(Class<T> var); 
```

Oracle Java 文档中的[更多](https://docs.oracle.com/javase/tutorial/extra/generics/methods.html)示例

* * *

## 回答 #7

> 赞同：9
> 
> 时间：2009-01-16T15:57:40.787

正如你所说的通过一个类就可以了，你可以这样写：

```
public <T extends Animal> T callFriend(String name, Class<T> clazz) {
   return (T) friends.get(name);
} 
```

然后像这样使用它：

```
jerry.callFriend("spike", Dog.class).bark();
jerry.callFriend("quacker", Duck.class).quack(); 
```

并不完美，但这几乎是您使用 Java 泛型所能获得的。有一种方法可以[使用 Super Type Tokens 来实现 Typesafe Heterogenous Containers (THC)](http://gafter.blogspot.com/2007/05/limitation-of-super-type-tokens.html)，但这也有它自己的问题。

* * *

## 回答 #8

> 赞同：9
> 
> 时间：2009-01-23T02:00:28.453

基于与 Super Type Tokens 相同的想法，您可以创建一个类型化的 id 来代替字符串：

```
public abstract class TypedID<T extends Animal> {
  public final Type type;
  public final String id;

  protected TypedID(String id) {
    this.id = id;
    Type superclass = getClass().getGenericSuperclass();
    if (superclass instanceof Class) {
      throw new RuntimeException("Missing type parameter.");
    }
    this.type = ((ParameterizedType) superclass).getActualTypeArguments()[0];
  }
} 
```

但我认为这可能会破坏目的，因为您现在需要为每个字符串创建新的 id 对象并保留它们（或使用正确的类型信息重建它们）。

```
Mouse jerry = new Mouse();
TypedID<Dog> spike = new TypedID<Dog>("spike") {};
TypedID<Duck> quacker = new TypedID<Duck>("quacker") {};

jerry.addFriend(spike, new Dog());
jerry.addFriend(quacker, new Duck()); 
```

但是您现在可以按照您最初想要的方式使用该类，而无需强制转换。

```
jerry.callFriend(spike).bark();
jerry.callFriend(quacker).quack(); 
```

这只是将类型参数隐藏在 id 中，尽管这确实意味着您可以稍后根据需要从标识符中检索类型。

如果您希望能够比较一个 id 的两个相同实例，您还需要实现 TypedID 的比较和散列方法。

* * *

## 回答 #9

> 赞同：9
> 
> 时间：2015-05-24T20:44:16.477

“有没有办法在运行时确定返回类型而无需使用 instanceof 的额外参数？”

作为替代解决方案，您可以像这样使用[访问者模式](http://en.wikipedia.org/wiki/Visitor_pattern)。使 Animal 抽象并使其实现 Visitable：

```
abstract public class Animal implements Visitable {
  private Map<String,Animal> friends = new HashMap<String,Animal>();

  public void addFriend(String name, Animal animal){
      friends.put(name,animal);
  }

  public Animal callFriend(String name){
      return friends.get(name);
  }
} 
```

Visitable 只是意味着 Animal 实现愿意接受访问者：

```
public interface Visitable {
    void accept(Visitor v);
} 
```

访问者实现能够访问动物的所有子类：

```
public interface Visitor {
    void visit(Dog d);
    void visit(Duck d);
    void visit(Mouse m);
} 
```

因此，例如 Dog 实现将如下所示：

```
public class Dog extends Animal {
    public void bark() {}

    @Override
    public void accept(Visitor v) { v.visit(this); }
} 
```

这里的技巧是，当 Dog 知道它是什么类型时，它可以通过传递“this”作为参数来触发访问者 v 的相关重载访问方法。其他子类将以完全相同的方式实现 accept() 。

想要调用子类特定方法的类必须实现 Visitor 接口，如下所示：

```
public class Example implements Visitor {

    public void main() {
        Mouse jerry = new Mouse();
        jerry.addFriend("spike", new Dog());
        jerry.addFriend("quacker", new Duck());

        // Used to be: ((Dog) jerry.callFriend("spike")).bark();
        jerry.callFriend("spike").accept(this);

        // Used to be: ((Duck) jerry.callFriend("quacker")).quack();
        jerry.callFriend("quacker").accept(this);
    }

    // This would fire on callFriend("spike").accept(this)
    @Override
    public void visit(Dog d) { d.bark(); }

    // This would fire on callFriend("quacker").accept(this)
    @Override
    public void visit(Duck d) { d.quack(); }

    @Override
    public void visit(Mouse m) { m.squeak(); }
} 
```

我知道它的接口和方法比您预想的要多得多，但它是一种标准方法，可以通过精确的零实例检查和零类型转换来处理每个特定子类型。而且这一切都是以与标准语言无关的方式完成的，因此它不仅适用于 Java，而且任何 OO 语言都应该以同样的方式工作。

* * *

## 回答 #10

> 赞同：6
> 
> 时间：2009-01-16T15:52:14.290

不可能。仅给定一个 String 键， Map 应该如何知道它将获得 Animal 的哪个子类？

唯一可行的方法是，如果每个 Animal 只接受一种类型的朋友（那么它可能是 Animal 类的参数），或者 callFriend() 方法的类型参数。但看起来你真的错过了继承的重点：只有在只使用超类方法时，你才能统一对待子类。

* * *

## 回答 #11

> 赞同：5
> 
> 时间：2009-04-07T00:18:00.653

我写了一篇文章，其中包含一个概念证明、支持类和一个测试类，它演示了您的类如何在运行时检索超级类型令牌。简而言之，它允许您根据调用者传递的实际通用参数委托替代实现。例子：

*   `TimeSeries<Double>`委托给一个私有内部类，它使用`double[]`
*   `TimeSeries<OHLC>`委托给一个私有内部类，它使用`ArrayList<OHLC>`

看：

*   [使用 TypeTokens 检索泛型参数](http://rgomes-info.blogspot.co.uk/2013/12/using-typetokens-to-retrieve-generic.html)（网络存档）
*   [使用 TypeTokens 检索泛型参数](https://rgomes.info/using-typetokens-to-retrieve-generic-parameters/)（博客）

谢谢

理查德·戈麦斯 -[博客](http://rgomes.info/)

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2017-06-30T17:17:50.300

这里有很多很好的答案，但这是我在 Appium 测试中采用的方法，其中对单个元素进行操作可能会导致根据用户设置进入不同的应用程序状态。虽然它不遵循 OP 示例的约定，但我希望它对某人有所帮助。

```
public <T extends MobilePage> T tapSignInButton(Class<T> type) throws NoSuchMethodException, IllegalAccessException, InvocationTargetException, InstantiationException {
    //signInButton.click();
    return type.getConstructor(AppiumDriver.class).newInstance(appiumDriver);
} 
```

*   MobilePage 是类型扩展的超类，这意味着您可以使用它的任何子级（duh）
*   type.getConstructor(Param.class, etc) 允许您与类型的构造函数进行交互。这个构造函数在所有预期的类之间应该是相同的。
*   newInstance 接受一个你想要传递给新对象构造函数的声明变量

如果你不想抛出错误，你可以像这样捕获它们：

```
public <T extends MobilePage> T tapSignInButton(Class<T> type) {
    // signInButton.click();
    T returnValue = null;
    try {
       returnValue = type.getConstructor(AppiumDriver.class).newInstance(appiumDriver);
    } catch (Exception e) {
        e.printStackTrace();
    }
    return returnValue;
} 
```

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2009-01-16T15:51:47.427

不是真的，因为正如您所说，编译器只知道 callFriend() 返回的是 Animal，而不是 Dog 或 Duck。

你能不能向 Animal 添加一个抽象的 makeNoise() 方法，它会被它的子类实现为 bark 或 quack？

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2014-05-21T17:02:15.547

您在这里寻找的是抽象。更多针对接口的代码，您应该减少强制转换。

下面的示例使用 C#，但概念保持不变。

```
using System;
using System.Collections.Generic;
using System.Reflection;

namespace GenericsTest
{
class MainClass
{
    public static void Main (string[] args)
    {
        _HasFriends jerry = new Mouse();
        jerry.AddFriend("spike", new Dog());
        jerry.AddFriend("quacker", new Duck());

        jerry.CallFriend<_Animal>("spike").Speak();
        jerry.CallFriend<_Animal>("quacker").Speak();
    }
}

interface _HasFriends
{
    void AddFriend(string name, _Animal animal);

    T CallFriend<T>(string name) where T : _Animal;
}

interface _Animal
{
    void Speak();
}

abstract class AnimalBase : _Animal, _HasFriends
{
    private Dictionary<string, _Animal> friends = new Dictionary<string, _Animal>();

    public abstract void Speak();

    public void AddFriend(string name, _Animal animal)
    {
        friends.Add(name, animal);
    }   

    public T CallFriend<T>(string name) where T : _Animal
    {
        return (T) friends[name];
    }
}

class Mouse : AnimalBase
{
    public override void Speak() { Squeek(); }

    private void Squeek()
    {
        Console.WriteLine ("Squeek! Squeek!");
    }
}

class Dog : AnimalBase
{
    public override void Speak() { Bark(); }

    private void Bark()
    {
        Console.WriteLine ("Woof!");
    }
}

class Duck : AnimalBase
{
    public override void Speak() { Quack(); }

    private void Quack()
    {
        Console.WriteLine ("Quack! Quack!");
    }
}
} 
```

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2015-06-28T19:07:21.253

我在我的 lib kontraktor 中执行了以下操作：

```
public class Actor<SELF extends Actor> {
    public SELF self() { return (SELF)_self; }
} 
```

子类化：

```
public class MyHttpAppSession extends Actor<MyHttpAppSession> {
   ...
} 
```

至少这在当前类中以及在具有强类型引用时有效。多重继承有效，但变得非常棘手:)

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2013-10-24T20:39:46.247

我知道这是一个完全不同的人问的事情。解决这个问题的另一种方法是反射。我的意思是，这并没有从泛型中受益，但它可以让你以某种方式模拟你想要执行的行为（让狗吠，让鸭子嘎嘎等等），而不需要照顾类型转换：

```
import java.lang.reflect.InvocationTargetException;
import java.util.HashMap;
import java.util.Map;

abstract class AnimalExample {
    private Map<String,Class<?>> friends = new HashMap<String,Class<?>>();
    private Map<String,Object> theFriends = new HashMap<String,Object>();

    public void addFriend(String name, Object friend){
        friends.put(name,friend.getClass());
        theFriends.put(name, friend);
    }

    public void makeMyFriendSpeak(String name){
        try {
            friends.get(name).getMethod("speak").invoke(theFriends.get(name));
        } catch (IllegalArgumentException e) {
            e.printStackTrace();
        } catch (SecurityException e) {
            e.printStackTrace();
        } catch (IllegalAccessException e) {
            e.printStackTrace();
        } catch (InvocationTargetException e) {
            e.printStackTrace();
        } catch (NoSuchMethodException e) {
            e.printStackTrace();
        }
    } 

    public abstract void speak ();
};

class Dog extends Animal {
    public void speak () {
        System.out.println("woof!");
    }
}

class Duck extends Animal {
    public void speak () {
        System.out.println("quack!");
    }
}

class Cat extends Animal {
    public void speak () {
        System.out.println("miauu!");
    }
}

public class AnimalExample {

    public static void main (String [] args) {

        Cat felix = new Cat ();
        felix.addFriend("Spike", new Dog());
        felix.addFriend("Donald", new Duck());
        felix.makeMyFriendSpeak("Spike");
        felix.makeMyFriendSpeak("Donald");

    }

} 
```

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2020-10-08T02:11:46.787

由于问题是基于假设数据，这里是一个很好的例子，它返回了一个扩展 Comparable 接口的泛型。

```
public class MaximumTest {
    // find the max value using Comparable interface
    public static <T extends Comparable<T>> T maximum(T x, T y, T z) {
        T max = x; // assume that x is initially the largest

        if (y.compareTo(max) > 0){
            max = y; // y is the large now
        }
        if (z.compareTo(max) > 0){
            max = z; // z is the large now
        }
        return max; // returns the maximum value
    }    

    //testing with an ordinary main method
    public static void main(String args[]) {
        System.out.printf("Maximum of %d, %d and %d is %d\n\n", 3, 4, 5, maximum(3, 4, 5));
        System.out.printf("Maximum of %.1f, %.1f and %.1f is %.1f\n\n", 6.6, 8.8, 7.7, maximum(6.6, 8.8, 7.7));
        System.out.printf("Maximum of %s, %s and %s is %s\n", "strawberry", "apple", "orange",
                maximum("strawberry", "apple", "orange"));
    }
} 
```

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2015-02-06T01:19:02.343

关于什么

```
public class Animal {
    private Map<String,<T extends Animal>> friends = new HashMap<String,<T extends Animal>>();

    public <T extends Animal> void addFriend(String name, T animal){
        friends.put(name,animal);
    }

    public <T extends Animal> T callFriend(String name){
        return friends.get(name);
    }
} 
```

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2017-05-08T18:23:43.950

还有另一种方法，您可以在覆盖方法时缩小返回类型。在每个子类中，您必须重写 callFriend 以返回该子类。代价是 callFriend 的多个声明，但您可以将公共部分隔离到内部调用的方法中。这对我来说似乎比上面提到的解决方案简单得多，并且不需要额外的参数来确定返回类型。

# sql-server - SSRS 不能有条件地从 XML 数据源中过滤“nil”值？

> ID：450815
> 
> 赞同：3
> 
> 时间：2009-01-16T15:44:48.580
> 
> 标签：sql-server, xml, web-services, reporting-services, ssrs-2008

我在 SSRS 2008 中有一份报告，它使用 Web 服务作为其数据源之一。返回的 XML 的基本外观是

```
<table>
    <row>
        <column1>data</column1>
        <column2 xsi:nil="true" />
        <column3>data</column3>
    </row>
</table> 
```

任何带有“nil”属性的标签在报告中都显示为空白。我想用破折号替换任何空白。由于它是一个数字字段并且零在报告中具有含义，因此我不能简单地将 Web 服务更改为返回零或空字符串。我尝试进行几种条件比较来交换它们，但它们都在报告中显示为“#Error”：

```
=iff(Field!column2.Value Is Nothing, "-", Field!column2.Value)
=iff(IsNothing(Field!column2.Value), "-", Field!column2.Value)
=iff(Field!column2.Value = "", "-", Field!column2.Value)
=iff(CStr(Field!column2.Value) = "", "-", Field!column2.Value) 
```

有任何想法吗？

**编辑：**不是空检查失败，而是第一个 IIF 内的嵌套条件。一旦删除，我就能让它工作。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-16T15:55:31.540

我没有遇到问题：

```
 =Iif(cstr(First(Fields!RegInceptionDate.Value, "spimRptPerfSummary")) = "", "-", First(Fields!RegInceptionDate.Value, "spimRptPerfSummary")) 
```

这是我的数据集的样子：

```
<Query>
   <Method Namespace="http://www.abc.com/" Name="TWRPerformanceSummary"/>
   <SoapAction>http://www.abc.com/TWRPerformanceSummary </SoapAction>   
   <ElementPath IgnoreNamespaces="true">
        TWRPerformanceSummaryResponse/TWRPerformanceSummaryResult/diffgram/NewDataSet/table{PkRegistration, InceptionDate(date),RegInceptionDate(string)}
   </ElementPath>
</Query> 
```

我的表达式在一个文本框中，这就是为什么我将它包含在 DataSet 上的 First() 中。我将数据集上的 RegInceptionDate 转换为字符串（它实际上是一个日期，但自从它返回 null 后就没关系了）。我不确定表达式中的 cstr() 是否必要，因为我对数据集本身进行了强制转换。

# .net - 测试 NetworkStream 是否关闭

> ID：450816
> 
> 赞同：2
> 
> 时间：2009-01-16T15:45:04.820
> 
> 标签：.net, networking, stream

我有一个类，它包装了一个 Stream 实例，所以我可以用它来包装 FileStreams 和 NetworkStreams。现在，我想测试流是否仍在传输任何数据，换句话说，我想测试 NetworkStream 是否仍然连接，或者 FileStream 是否到达终点。

是否有任何函数的返回值可以用来确定下一个 Stream.Read() 是否会导致异常？

提前致谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-16T16:00:09.547

`Stream.Read`最后不应该抛出异常；它返回一些非积极的东西。我只是 Read(...) 直到我得到这个 - 即

```
int read;
while((read = stream.Read(buffer, 0, buffer.Length) > 0) {
    // process "read"-many bytes
} 
```

请注意，`NetworkStream`有一个[`DataAvailable`](http://msdn.microsoft.com/en-us/library/system.net.sockets.networkstream.dataavailable.aspx)- 但这指的是**缓冲区**，而不是流本身（如[这里](https://stackoverflow.com/questions/166530/does-networkstream-dataavailable-see-buffered-data)所讨论的）。我只提到这一点，因此您**不要**尝试使用它来查看流是否已关闭，因为这不是它的意思。

如果您将您的包装`Stream`在 a 中`StreamReader`，那么您可以使用[`Peek`](http://msdn.microsoft.com/en-us/library/system.io.streamreader.peek.aspx)or[`EndOfStream`](http://msdn.microsoft.com/en-us/library/system.io.streamreader.endofstream.aspx)来测试关闭：

```
bool isEnd = reader.EndOfStream; 
```

或者：

```
int b = reader.Peek();
if(b < 0) {... was end ...} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-16T15:59:37.647

```
stream.CanRead 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-11-05T15:02:01.157

当对方关闭套接字时，NetworkStream 将返回 EOF（读取将返回 0 字节）。

# c# - C#：可以返回新添加对象的排序位置的通用排序容器？

> ID：450820
> 
> 赞同：3
> 
> 时间：2009-01-16T15:45:45.257
> 
> 标签：c#, .net, generics, sorting

我需要一个通用容器来保持其元素排序，并且可以询问它将在哪里（在哪个位置）插入一个新元素，而无需实际插入它。

.NET 库中是否存在这样的容器？最好的说明是一个示例（容器按 ASCII 值对字符进行排序，假设 unicode 不存在）：

```
sortedContainer.Add('d');
sortedContainer.Add('b');
sortedContainer.Add('g');

//container contains elements ordered like 'b' 'd' 'g'
//index  -------------------------------->  0   1   2

sortedContainer.GetSortedIndex('a'); //returns 0
sortedContainer.GetSortedIndex('b'); //returns 0

sortedContainer.GetSortedIndex('c'); //returns 1
sortedContainer.GetSortedIndex('d'); //returns 1

sortedContainer.GetSortedIndex('e'); //returns 2
sortedContainer.GetSortedIndex('f'); //returns 2
sortedContainer.GetSortedIndex('g'); //returns 2

sortedContainer.GetSortedIndex('h'); //returns 3
[...] 
```

对位置的搜索应该利用元素已排序的事实。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-16T15:52:17.020

如果您对 a 进行排序[`List<T>`](http://msdn.microsoft.com/en-us/library/6sh2ey19.aspx)然后使用[`List<T>.BinarySearch`](http://msdn.microsoft.com/en-us/library/3f90y839.aspx)它，它将为您提供条目的索引（如果它存在），或者如果您插入然后排序，*则将给出插入位置的索引的按位补码。*从此，您应该能够轻松地构建您的方法。

与您的示例匹配的示例代码，但与结果不匹配 - 如果您查看示例，您只有 3 个条目，因此“h”返回 4 或“g”返回 3 没有意义。我希望那是你的例子，有点偏离，而不是我误解了这个问题:) 请注意，排序不是自动的 - 你必须在调用 GetSortedIndex 之前明确地对列表进行排序。

```
using System;
using System.Collections.Generic;

static class Test
{
    static int GetSortedIndex<T>(this List<T> list, T entry)
    {
        int index = list.BinarySearch(entry);
        return index >= 0 ? index : ~index;
    }

    static void Main()
    {
        List<char> container = new List<char> { 'b', 'd', 'g' };
        Console.WriteLine(container.GetSortedIndex('a'));
        Console.WriteLine(container.GetSortedIndex('b'));
        Console.WriteLine(container.GetSortedIndex('c'));
        Console.WriteLine(container.GetSortedIndex('d'));
        Console.WriteLine(container.GetSortedIndex('e'));
        Console.WriteLine(container.GetSortedIndex('f'));
        Console.WriteLine(container.GetSortedIndex('g'));
        Console.WriteLine(container.GetSortedIndex('h'));
    }
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-16T15:53:03.853

与您正在寻找的最接近的类是[SortedList<TKey,TValue>](http://msdn.microsoft.com/en-us/library/ms132319.aspx)。此类将维护排序的列表顺序。

但是，没有任何方法可以让您获得要添加的新值的索引。但是，您可以编写一个扩展方法，为您提供新索引

```
public int GetSortedIndex<TKey,TValue>(this SortedList<TKey,TValue> list, TKey key) {
  var comp = list.Comparer;
  for ( var i = 0; i < list.Count; i++ ) {
    if ( comp.Compare(key, list.GetKey(i)) < 0 ) {
      return i;
    }
  }
  return list.Count;
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-16T16:11:59.540

听起来像一个有趣的测试，所以我试了一下。可能不是最优雅的，也不是最有效的，但这应该有效：

```
 public class SortedContainer<T> : IList<T> where T : IComparable<T>
    {
        private List<T> internalList = new List<T>();

        public int IndexOf(T item)
        {
            return internalList.IndexOf(item);
        }

        public void Insert(int index, T item)
        {
            internalList.Insert(index, item);
        }

        public void RemoveAt(int index)
        {
            internalList.RemoveAt(index);
        }

        public T this[int index]
        {
            get
            {
                return internalList[index];
            }
            set
            {
                internalList[index] = value;
            }
        }

        public void Add(T item)
        {
            internalList.Add(item);
            this.Sort();
        }

        public void Clear()
        {
            internalList.Clear();
        }

        public bool Contains(T item)
        {
            return internalList.Contains(item);
        }

        public void CopyTo(T[] array, int arrayIndex)
        {
            internalList.CopyTo(array, arrayIndex);
        }

        public int Count
        {
            get { return internalList.Count; }
        }

        public bool IsReadOnly
        {
            get { return false; }
        }

        public bool Remove(T item)
        {
            bool result = internalList.Remove(item);
            this.Sort();
            return result;
        }

        public IEnumerator<T> GetEnumerator()
        {
            return internalList.GetEnumerator();
        }

        System.Collections.IEnumerator System.Collections.IEnumerable.GetEnumerator()
        {
            return internalList.GetEnumerator();
        }

        private void Sort()
        {
            internalList.Sort();
        }

        private List<T> GetCopy()
        {
            return internalList.ToList();
        }

        public int GetSortedIndex(T item)
        {
            List<T> copy = GetCopy();
            copy.Add(item);
            copy.Sort();
            return copy.IndexOf(item);
        }

    } 
```

基本上，实现 IList，并保留一个内部列表。每次调用 Add 方法时，都会对内部列表调用 sort。然后，当您想在不实际添加的情况下获得排序索引时，它会创建该列表的副本，将项目插入副本，然后对副本进行排序。然后它返回该项目在副本中的索引。此时的内部名单并未受到影响。我测试了它并且它有效。

同样，可能不是最有效的。

# wpf - 使用WPF圆窗播放电影

> ID：450822
> 
> 赞同：3
> 
> 时间：2009-01-16T15:46:05.317
> 
> 标签：wpf, mediaelement, shape

是否可以使用 WPF 创建一个具有圆形形状并使用正在播放的电影作为背景的窗口？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-16T18:05:14.647

要制作一个非矩形窗口，首先需要做三件事。

1.  将 Window.WindowStyle 设置为 WindowStyle.None
2.  将 Window.AllowsTransparency 设置为 True
3.  将 Window.Background 设置为透明（或 {x:Null}）

现在，您的窗口是完全透明的。您可以使用此线程中的其他技巧将一块媒体绘制到窗口的几何图形上。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-16T16:20:32.610

你应该只需要在你的 xaml 中抛出这样的东西：

```
<Ellipse Height="80" Width="80">
    <Ellipse.Fill>
        <VisualBrush TileMode="None">
            <VisualBrush.Visual>
                <MediaElement Source="myMovie.wmv" />
            </VisualBrush.Visual>
        </VisualBrush>
    </Ellipse.Fill>
</Ellipse> 
```

实际上使窗户变圆会更加困难。如果您希望窗户是圆形的，请看一下[这个](http://blog.opennetcf.com/ayakhnin/PermaLink,guid,23a7be17-d833-4e45-b498-34ef04d98cb2.aspx)，它应该有助于弄清楚那部分。

高温高压

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-20T14:40:23.443

不要使用 AllowsTransparency，它的性能很差，兼容性问题很多，请访问此链接以获取替代方案：

[http://blogs.msdn.com/wpfsdk/archive/2008/09/08/custom-window-chrome-in-wpf.aspx](http://blogs.msdn.com/wpfsdk/archive/2008/09/08/custom-window-chrome-in-wpf.aspx)

编辑：有一个示例，如何使用 SetWindowRgn 为矩形窗口获取圆角，如果您传递一个椭圆区域而不是圆角矩形区域，您将获得一个椭圆窗口，很容易为您创建任何形状的区域可以想象。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-16T15:51:03.827

你可以有一个画布作为你的父容器（设置为透明），然后添加一个带有媒体画笔的圆圈作为它的背景。应该这样做。:)

# asp.net - “临时 ASP.NET 文件”文件夹的用途是什么？

> ID：450831
> 
> 赞同：159
> 
> 时间：2009-01-16T15:47:38.683
> 
> 标签：asp.net, caching

我发现了这个文件夹`C:\WINDOWS\Microsoft.NET\Framework\v2.0.50727\Temporary ASP.NET Files`并有几个问题。

*   ASP.NET 使用这个文件夹做什么，这里存储了什么样的文件？
*   文件如何存储在这里，何时更新？
*   文件夹是否需要任何形式的维护？

* * *

## 回答 #1

> 赞同：177
> 
> 时间：2009-01-16T16:05:51.813

这些就是所谓的卷影复制文件夹。

简单地说……我是认真的：

> 当 ASP.NET 第一次运行您的应用程序时，它会复制 /bin 文件夹中的所有程序集，复制所有源代码文件（例如在 App_Code 文件夹中）并将您的 aspx、ascx 文件解析为 c# 源文件。然后 ASP.NET 将所有这些代码构建/编译成一个可运行的应用程序。

这样做的一个优点是它可以防止 .NET 程序集 DLL 的 #（在 /bin 文件夹中）被 ASP.NET 工作进程锁定，从而无法更新。

ASP.NET 监视您网站中的文件更改，并在必要时重新开始整个过程​​。

从理论上讲，该文件夹不应该需要任何维护，但有时，您可能需要删除内容的情况很少见。也就是说，我在一家托管公司工作，每台共享服务器最多可运行 1200 个站点，而且多年来我不必在 250 台左右的机器上碰过这个文件夹。

这在 MSDN 文章[了解 ASP.NET 动态编译中进行了概述](http://msdn.microsoft.com/en-us/library/ms366723.aspx)

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-01-16T15:50:35.793

CLR 在运行时编译时使用它。这是[MSDN](http://msdn.microsoft.com/en-us/library/ms366723.aspx)的链接，进一步解释。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-16T15:50:04.047

这就是asp.net 放置动态编译程序集的地方。

# c++ - 如何让 Microsoft VCC 在第一次构建错误时崩溃？

> ID：450832
> 
> 赞同：2
> 
> 时间：2009-01-16T15:47:58.870
> 
> 标签：c++, windows, visual-studio, compiler-construction

我的自动构建过程使用命令行来构建类似这样的内容：

```
devenv.exe myproj.sln /build release 
```

这是一个非常长的构建过程，它集成了由一组开发人员制作的组件。在发布模式下运行大约需要半小时。通常，如果一件事出错，那么很多其他依赖项也会出错，所以我偶尔会收到如下消息：

```
---------------------- Done ----------------------
Rebuild All: 18 succeeded, 6 failed, 0 skipped 
```

**实际上，我希望在发现第一个错误后立即中止**构建。如果有任何错误，则构建失败。我需要尽快知道这一点，而不是等着看到所有其他的东西都失败了。

有没有办法改变构建过程，而不是运行整个过程，一旦出现问题，它就会死掉？

我正在使用 Visual Studio .Net 2003（是的，我知道它很旧）。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-16T17:10:00.390

我在 Visual Studio 2005 中使用以下宏来执行此操作，但它在 2003 中也应该可以工作。将其添加到宏 IDE 中的 EnvironmentEvents 模块中：

```
 Private Sub BuildEvents_OnBuildProjConfigDone(ByVal Project As String, ByVal ProjectConfig As String, ByVal Platform As String, ByVal SolutionConfig As String, ByVal Success As Boolean) Handles BuildEvents.OnBuildProjConfigDone
        If Success = False Then
            DTE.ExecuteCommand("Build.Cancel")
        End If
    End Sub 
```

当任何单个项目构建失败时，这将导致构建取消。

[此页面](http://visualstudiohacks.com/articles/general/customize-your-project-build-process/)包含有关所涉及宏的更多详细信息。

# c# - 基于 .NET 服务器的 PDF 生成

> ID：450833
> 
> 赞同：9
> 
> 时间：2009-01-16T15:48:02.007
> 
> 标签：c#, .net, pdf, printing, html2pdf

我想动态生成内容，然后呈现为 ​​PDF 文件。此处理将在远程托管服务器上进行，因此无法使用虚拟打印机等。有没有人推荐一个可行的.NET库（pref C#）？

我知道我可以生成一堆 PS 代码并自己打包，但在这个阶段我更喜欢一些不那么棘手的东西。

谢谢！

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-16T15:51:48.677

看看[http://itextsharp.sourceforge.net/](http://itextsharp.sourceforge.net/)。它的开源。
教程：http: [//itextdocs.lowagie.com/tutorial/](http://itextdocs.lowagie.com/tutorial/)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-16T15:51:30.453

我使用[SharpPDF](http://sharppdf.sourceforge.net/index.html)取得了很好的成功。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-16T20:53:34.980

我使用 Siberix 取得了成功

[http://www.siberix.com/](http://www.siberix.com/)

企业许可证：350 美元（单个许可证涵盖无限数量的公司开发人员席位、无限数量的公司 Web 服务器和无限数量的分发，作为您应用程序的一部分。）

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2013-09-09T06:05:23.100

免费的[PDF Generator .NET](http://www.nrecosite.com/pdf_generator_net.aspx)（WkHtmlToPdf 包装器）可以使用一行代码从 HTML 模板生成漂亮的 PDF：

```
var pdfBytes = (new NReco.PdfGenerator.HtmlToPdfConverter()).GeneratePdf(htmlContent); 
```

（您只需要一个 DLL，无需外部依赖）

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-01-16T20:57:29.620

我在[Winnovative 的 HTML to PDF](http://www.winnovative-software.com/)方面有很好的经验。

开源[HTML 文档](https://www.msweet.org/projects.php?Z1)（表单元素 + CSS 的问题）的坏处。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2010-10-27T14:17:53.600

我们使用[Amyuni PDF Converter](http://www.amyuni.com/en/developer/pdfconverter/)并且已经成功使用了几年。我们的使用是通过 COM 接口，但它确实支持 .NET 接口。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2018-09-11T11:36:41.730

一段时间以来，我一直在寻找高性能的 docx 到 pdf 工具。我们的系统具有电子政务方面，并且正在向用户社区生成大量报告。在这一点上，性能是最重要的。

我使用的早期工具没有进行同时转换，而是每个 exe 都需要等待另一个完成。我已经尝试过 Aspose.words，我对结果非常满意。

首先，在我们的项目中集成和部署非常容易和无缝。非常顺利。

其次，由于多个作业并行运行，转换速度要快得多。

第三，不仅速度快，而且即使没有格式错误。考虑到我们正在提供多语言系统，并且一些报告同时包含英语和阿拉伯语字段（注意从右到左对齐！），这非常重要。

最后，文件非常小，这也是非常重要的，因为通过我们的系统创建了数以万计的文档。

我们的第一个实现是 Microsoft Office 互操作库。我们使用以下代码将 docx 转换为 pdf 文档。该库将 docx 文档完美地转换为 pdf 文件，我们决定将其上传到报告生成服务器。但过了一会儿，我们注意到转换操作正在等待每个可执行文件。这会导致同时转换文档时出现很大延迟，这就是为什么我们开始搜索将 docx 文件转换为 pdf 文件的新工具的原因。 [看图片](https://i.stack.imgur.com/I2cJR.png)

下面的代码展示了如何使用 Aspose.Words for .NET 工具将 docx 文档转换为 pdf 文件。 [见图 2](https://i.stack.imgur.com/GL15D.png)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-16T15:50:45.980

RDLC 和报告查看器控件可以根据客户的判断或服务器命令生成 PDF，然后可以将其用作 PDF mime 类型。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-01-16T15:56:02.303

我使用 O2solutions 的 PDF4NET 取得了很大的成功。它们支持 pdf 的各种场景和数字签名。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-01-16T16:02:28.310

如果您的数据主要是 XML，您还可以查看 XSL-FO 解决方案 - 我们使用[Alt-Soft 的 Xml2Pdf](http://www.alt-soft.com/)取得了巨大成功。“服务器”版本有点用词不当——它实际上只是您需要包含在 Winform、WPF 或 ASP.NET 应用程序中的单个 DLL——仅此而已！

像魅力一样工作（如果您熟悉 XSLT 和 XSL-FO，或者愿意学习它）。

马克

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-01-16T16:23:23.760

[我们使用了一组来自PDFSharp](http://www.pdfsharp.com/PDFsharp/index.php?option=com_frontpage&Itemid=1 "PDFSharp")的第三方 DLL，后者又使用来自 MigraDoc 的 DLL。我不知道我们朝着这个方向发展的所有原因（决定是由高级开发人员做出的），但我可以告诉你：

*   它似乎正在积极开发中。
*   它具有我们需要的大部分功能。
*   源代码可用。尽管它使用了一些我以前从未见过的模式和约定，但一旦我了解它们，进行更改就相当容易了。我添加了对直接使用 System.Drawing.Image 而不是保存文件的支持。
*   内部或外部都没有很好地记录它。

# scripting - 阻止脚本编写者抨击您的网站

> ID：450835
> 
> 赞同：497
> 
> 时间：2009-01-16T15:49:20.443
> 
> 标签：scripting, e-commerce, bots, detection

> 我已经接受了一个答案，但遗憾的是，我相信我们陷入了最初的最坏情况：**CAPTCHA 每个人都在购买废话**。简短说明：缓存/网络农场无法跟踪点击，任何解决方法（发送非缓存网络信标、写入统一表等）都会比机器人更慢地降低网站速度。可能有来自 Cisco 或类似公司的一些昂贵的硬件可以提供高水平的帮助，但如果每个人都可以进行 CAPTCHA 验证，则很难证明其成本是合理的。稍后我将尝试更完整的解释，并为将来的搜索者清理它（尽管欢迎其他人尝试，因为它是社区 wiki）。

## 情况

这是关于 woot.com 上的垃圾袋销售。我是 Woot Workshop 的总裁，Woot 的子公司负责设计、撰写产品描述、播客、博客文章并主持论坛。我使用 CSS/HTML，对其他技术几乎不熟悉。我与开发人员密切合作，并讨论了这里的所有答案（以及我们拥有的许多其他想法）。

可用性是我工作的重要组成部分，而让网站变得令人兴奋和有趣是剩下的大部分内容。这就是下面三个目标的来源。CAPTCHA 损害了可用性，机器人从我们的垃圾销售中窃取了乐趣和兴奋。

机器人会在第二次屏幕抓取（和/或扫描我们的 RSS）中猛烈抨击我们的首页数十次，以进行 Random Crap 销售。当他们看到这一点时，它会触发程序的第二阶段登录，点击我想要一个，填写表格，然后购买垃圾。

## 评估

> [lc](https://stackoverflow.com/questions/450835/how-would-you-stop-scripters-from-slamming-your-site-hundreds-of-times-a-second#answer-450899)：在使用此方法的 stackoverflow 和其他站点上，它们几乎总是与经过身份验证（登录）的用户打交道，因为正在尝试的任务需要这样做。

在 Woot 上，匿名（未登录）用户可以查看我们的主页。换句话说，slamming 机器人可以是未经身份验证的（并且除了 IP 地址之外基本上是不可追踪的）。

所以我们回到扫描IP，a）在这个云网络和垃圾邮件僵尸时代相当无用，b）考虑到来自一个IP地址的企业数量，它捕获了太多的无辜者（更不用说问题了）非静态 IP ISP 和试图跟踪此问题的潜在性能损失）。

哦，让人们打电话给我们将是最糟糕的情况。我们可以让他们给你打电话吗？

> [BradC](https://stackoverflow.com/questions/450835/how-would-you-stop-scripters-from-slamming-your-site-hundreds-of-times-a-second/450931#450931)：Ned Batchelder 的方法看起来很酷，但它们的设计非常牢固，可以击败为网站网络构建的机器人。我们的问题是机器人是专门为击败我们的网站而构建的。其中一些方法可能会在短时间内起作用，直到脚本编写者将他们的机器人进化为忽略蜜罐，屏幕抓取附近的标签名称而不是表单 ID，并使用支持 javascript 的浏览器控件。

> [lc 再次](https://stackoverflow.com/questions/450835/how-would-you-stop-scripters-from-slamming-your-site-hundreds-of-times-a-second/450946#450946)：“当然，除非炒作是你营销计划的一部分。” 是的，绝对是。物品出现时的惊喜，以及如果你设法得到一件的兴奋，可能与你最终得到的废话一样重要或更重要。任何消除先到先得的行为都会损害“赢得”垃圾的快感。

> [novatrust](https://stackoverflow.com/questions/450835/how-would-you-stop-scripters-from-slamming-your-site-hundreds-of-times-a-second/450928#450928)：首先，我欢迎我们的新机器人霸主。实际上，我们确实提供 RSSfeeds 以允许 3rd 方应用程序扫描我们的站点以获取产品信息，但不会在主站点 HTML 之前。如果我的解释是正确的，那么您的解决方案确实通过完全牺牲目标 1 来帮助目标 2（性能问题），并且只是放弃机器人将购买大部分废话的事实。我对你的回答投了赞成票，因为你最后一段的悲观主义对我来说是准确的。这里似乎没有灵丹妙药。

其余的响应通常依赖于 IP 跟踪，这似乎既无用（僵尸网络/僵尸/云网络）又有害（捕获许多来自相同 IP 目的地的无辜者）。

还有其他方法/想法吗？我的开发人员一直在说“让我们做 CAPTCHA”，但我希望对于所有想要我们的废话的实际人类来说，有更少的侵入性方法。

## 原始问题

假设您正在销售具有很高感知价值的廉价商品，而您的数量非常有限。没有人确切知道您何时会出售此商品。超过 100 万人定期来看看你在卖什么。

您最终会遇到脚本编写者和机器人试图以编程方式 [a] 找出您何时出售所述物品，并 [b] 确保他们是第一批购买它的人。这很糟糕有两个原因：

1.  您的网站遭到非人类的猛烈抨击，使所有人的一切都变慢了。
2.  脚本编写者最终“赢得”了产品，导致常客感到受骗。

一个看似显而易见的解决方案是在下订单之前为您的用户创建一些跳线，但这至少存在三个问题：

*   用户体验对人类来说很糟糕，因为他们必须破译验证码、挑选猫或解决数学问题。
*   如果感知到的好处足够高，并且人群足够多，那么一些群体会找到解决任何调整的方法，从而导致军备竞赛。（更简单的调整尤其如此；隐藏的“评论”表单、​​重新排列表单元素、错误标记它们、隐藏的“陷阱”文本都将工作一次，然后需要进行更改以对抗针对此特定表单.)
*   即使脚本编写者无法“解决”您的调整，也不会阻止他们猛击您的首页，然后发出警报让脚本编写者手动填写订单。鉴于他们从解决 [a] 中获得了优势，他们可能仍然会赢得 [b]，因为他们将是第一个到达订单页面的人。此外，1\. 仍然会发生，导致服务器错误和每个人的性能下降。

另一种解决方案是监视 IP 访问频率过高，阻止它们进入防火墙，或者以其他方式阻止它们排序。这可以解决 2\. 并防止 [b] 但扫描 IP 对性能的影响是巨大的，并且可能会导致像 1\. 这样的问题，而不是脚本编写者自己造成的问题。此外，云网络和垃圾邮件僵尸的可能性使得 IP 检查毫无用处。

第三个想法，强制加载订单表格一段时间（比如半秒）可能会减慢快速订单的进度，但同样，脚本编写者仍然是第一个进入的人，只要速度不损害实际用户。

## 目标

1.  将项目出售给非脚本人员。
2.  保持网站以不被机器人减慢的速度运行。
3.  不要让“普通”用户完成任何任务来证明他们是人类。

* * *

## 回答 #1

> 赞同：241
> 
> 时间：2009-01-16T16:02:02.993

如何使用 CAPTCHA 实现类似 SO 的功能？

如果您正常使用该网站，您可能永远不会看到一个。如果您碰巧经常重新加载同一页面，太快地发布连续评论，或者触发警报的其他内容，请让他们证明他们是人类。在您的情况下，这可能是同一页面的不断重新加载，快速跟踪页面上的每个链接，或者填写订单的速度太快而无法成为人类。

如果他们连续 x 次未通过检查（例如，2 或 3 次），则给该 IP 一个超时或其他此类措施。然后在超时结束时，再次将它们转储回检查。

* * *

由于您有未注册的用户访问该站点，因此您确实只有 IP 可以继续。您可以向每个浏览器发出会话并根据需要进行跟踪。当然，如果连续（重新）创建了太多会话（以防机器人不断删除 cookie），请进行人工检查。

至于抓到太多无辜者，您可以在人工检查页面上提出免责声明：“如果太多匿名用户从同一位置查看我们的网站，也可能会出现此页面。我们建议您注册或登录以避免这。” （适当调整措辞。）

此外，X 个人同时从一个 IP 加载相同页面的几率是多少？如果它们很高，那么您的机器人警报可能需要不同的触发机制。

* * *

编辑：另一种选择是，如果他们失败太多次，并且您对产品的需求充满信心，请阻止他们并让他们亲自打电话给您删除阻止。

让人们打电话似乎是一种愚蠢的措施，但它*可以确保在计算机后面的某个地方有人*。关键是只有在一个几乎永远不会发生的情况下才设置块，除非它是一个机器人（例如，连续多次失败检查）。然后它强制人机交互——拿起电话。

为了回应让他们给我打电话的评论，这里显然需要权衡取舍。您是否足够担心确保您的用户在打折时能够接听几个电话？如果我非常担心产品会接触到人类用户，我将不得不做出这个决定，也许会在此过程中牺牲我的一小部分时间。

由于您似乎决心不让机器人占上风/抨击您的网站，我相信手机可能是一个不错的选择。由于我没有从您的产品中获利，因此我没有兴趣接听这些电话。但是，如果您分享其中的一些利润，我可能会感兴趣。由于这是您的产品，因此您必须决定您关心的程度并相应地实施。

* * *

释放块的其他方法没有那么有效：超时（但他们会在之后再次抨击您的网站，冲洗重复），长时间超时（如果真的是人试图购买您的产品，他们将是 SOL 并因未通过检查而受到惩罚）、电子邮件（很容易由机器人完成）、传真（相同）或蜗牛邮件（花费太长时间）。

当然，您可以改为在每次超时时增加每个 IP 的超时时间。只要确保你不会无意中惩罚真正的人类。

* * *

## 回答 #2

> 赞同：203
> 
> 时间：2009-02-07T08:55:07.343

你需要想办法让机器人购买价格过高的东西：12 毫米翼形螺母：20 美元。看看有多少机器人在编剧决定你玩它们之前抢购一空。

利用利润购买更多服务器并支付带宽费用。

* * *

## 回答 #3

> 赞同：164
> 
> 时间：2009-02-07T09:19:27.997

我的解决方案是通过为“机器人和脚本”延迟大约 10 分钟来使屏幕抓取变得毫无价值。

这是我的做法：

*   **记录并识别任何重复击球手。**

您不需要在每次点击时记录每个 IP 地址。每 20 次左右只跟踪一次。屡犯者仍会出现在随机的偶尔跟踪中。

*   **保留大约 10 分钟前的页面缓存。**

*   **当重复点击者/机器人点击您的网站时，给他们 10 分钟前的缓存页面。**

他们不会立即知道他们正在获得一个旧网站。他们将能够刮掉它，以及一切，但他们将不再赢得任何比赛，因为“真正的人”将有 10 分钟的领先优势。

**好处：**

*   对用户来说没有麻烦或问题（如验证码）。
*   在服务器端完全实现。（不依赖 Javascript/Flash）
*   提供较旧的缓存页面应该比实时页面的性能密集程度低。您实际上可以通过这种方式减少服务器上的负载！

**缺点**

*   需要跟踪一些 IP 地址
*   需要保留和维护旧页面的缓存。

你怎么看？

* * *

## 回答 #4

> 赞同：54
> 
> 时间：2009-01-16T16:09:27.003

在[此处查看 ned Batchelder 的这篇文章](http://nedbatchelder.com/text/stopbots.html)。他的文章是关于阻止垃圾邮件机器人的，但同样的技术可以很容易地应用于您的网站。

> 与其通过让人们识别自己来阻止机器人，我们可以通过让他们难以成功发布帖子或让他们无意中将自己识别为机器人来阻止机器人。这减轻了人们的负担，并使评论表单没有可见的反垃圾邮件措施。
> 
> 这种技术是我防止此站点上的垃圾邮件程序的方法。有用。这里描述的方法根本不看内容。

其他一些想法：

*   创建一个*官方*的自动通知机制（RSS 提要？Twitter？），当你的产品开始销售时，人们可以订阅它。这减少了人们制作脚本的*需要。*
*   在新商品开始销售*之前*更改您的混淆技术。所以即使编剧可以升级军备竞赛，他们也总是落后一天。

* * *

编辑：为了完全清楚，上面 Ned 的文章描述了通过防止 BOT 通过表单提交订单来防止自动购买物品的方法。他的技术对于防止机器人抓取主页以确定何时出售胡萝卜带没有用处。我不确定阻止这是否真的有可能。

关于您对 Ned 策略有效性的评论：是的，他讨论了蜜罐，但我认为这不是他最强的策略。他对**SPINNER**的讨论是我提到他的文章的最初原因。对不起，我没有在我的原始帖子中说得更清楚：

> 微调器是一个隐藏字段，用于一些事情：它将许多防止篡改和重放的值散列在一起，并用于隐藏字段名称。微调器是一个 MD5 哈希：
> 
> *   时间戳，
> *   客户端的IP地址，
> *   被评论的博客条目的条目 ID，以及
> *   一个秘密。

以下是您在 WOOT.com 上实现该功能的方法：

每次新商品开始销售时，更改用作散列一部分的“秘密”值。这意味着如果有人要设计一个 BOT 来自动购买物品，*它只能在下一个物品开始销售之前工作*！

即使有人能够快速重新构建他们的机器人，所有其他实际用户都已经购买了 BOC，您的问题就解决了！

他讨论的另一个策略是不时*更改蜜罐技术（同样，在新产品上市时更改）：*

*   使用 CSS 类（当然是随机的）将字段或包含元素设置为 display:none。
*   将字段着色为与页面背景相同（或非常相似）。
*   使用定位将字段移出页面的可见区域。
*   使元素太小而无法显示包含的蜜罐字段。
*   使字段可见，但使用定位以用遮蔽元素覆盖它们。
*   使用 Javascript 来实现任何这些更改，要求机器人具有完整的 Javascript 引擎。
*   让蜜罐像其他字段一样显示，但告诉人们不要在其中输入任何内容。

我想我的总体想法是在每件新商品上市时改变形式设计。或者至少，在新的 BOC 上市时更改它。

这是什么，几次/月？

如果你接受这个答案，你会在下一个到期时给我一个提示吗？:)

* * *

## 回答 #5

> 赞同：44
> 
> 时间：2009-02-07T04:22:32.200

问：您将如何阻止脚本编写者每秒数百次抨击您的网站？
答：你没有。外部代理无法*阻止*这种行为。

您可以使用大量技术来分析传入的请求，并试探性地尝试确定谁是人类，谁不是人类……但它会失败。最终，如果不是立即。

唯一可行的长期解决方案是*改变游戏*，使网站不适合机器人，或者对脚本编写者的吸引力降低。

你是怎样做的？好吧，这是一个不同的问题！;-)

...

好的，上面已经给出（并拒绝）了一些选项。我对您的网站并不熟悉，只看过一次，但由于人们可以阅读图像中的文本，而机器人不能轻易做到这一点，请将公告更改为图像。*不是验证码*，只是图像 -

*   请求页面时生成图像（当然是缓存的）
*   保持图像源名称相同，这样就不会泄露游戏
*   大多数情况下，图像中会包含普通文本，并被对齐以显示为内联 HTML 页面的一部分
*   当游戏“开启”时，图像变为公告文本
*   *公告文本显示必须手动输入*才能获得奖品的 URL 和/或代码。如果您愿意，可以验证码，但这可能不是必需的。
*   为了增加安全性，代码可以是专门为请求/IP/代理生成的一次性令牌，这样重复的请求会生成不同的代码。或者，如果按需生成过于繁琐，您可以预先生成一堆随机代码（一次性填充）。

运行真实的人对此响应的时间试验，并忽略（'哎呀，发生错误，对不起！请再试一次'）响应快于（比方说）这个时间的一半。此事件还应该向开发人员发出警报，表明至少有一个机器人已经找出了代码/游戏，因此是时候更改代码/游戏了。

无论如何都要定期更改游戏，即使没有机器人触发它，也只是浪费脚本编写者的时间。最终脚本编写者应该厌倦了游戏并去其他地方......我们希望;-)

最后一个建议：当对您的主页的请求进入时，*将其放入队列中*并在单独的过程中按顺序响应请求（您可能必须破解/扩展网络服务器才能做到这一点，但它很可能是值得）。如果第一个请求在队列中时来自同一 IP/代理的另一个请求进入，则忽略它。这应该会自动减轻机器人的负担。

编辑：除了使用图像之外，另一种选择是使用 javascript 填写购买/不购买文本；机器人很少解释 javascript，所以他们不会看到它

* * *

## 回答 #6

> 赞同：30
> 
> 时间：2009-02-07T06:58:46.987

我不知道这是多么可行：……继续进攻。

找出机器人正在扫描的数据。当你不卖垃圾时，向他们提供他们正在寻找的数据。以不会打扰或混淆人类用户的方式执行此操作。当机器人触发第二阶段时，他们将登录并填写表格以购买 100 美元的 roombas 而不是 BOC。当然，这是假设机器人不是特别健壮。

另一个想法是在袋子或垃圾销售期间实施随机降价。当你明确表示它只值 20 美元时，谁会花 150 美元买一个随机包或垃圾？除了过分热心的机器人之外，没有人。但是 9 分钟后是 35 美元……然后 17 分钟后是 9 美元。管他呢。

当然，丧尸王也能做出反应。关键是要让他们的错误对他们来说代价高昂（并让他们付钱让你与他们作斗争）。

所有这一切都假设您想激怒一些机器人领主，这可能不是 100% 可取的。

* * *

## 回答 #7

> 赞同：22
> 
> 时间：2009-02-13T08:36:21.850

所以问题似乎真的是：机器人想要他们的“垃圾袋”，因为它以低感知价格具有高感知价值。有时你提供这个项目，机器人潜伏，等着看它是否可用，然后他们购买这个项目。

由于看起来机器人所有者正在获利（或可能获利），因此诀窍是通过*鼓励*他们购买垃圾来使他们无利可图。

首先，*总是*提供“bag 'o crap”。

其次，确保废话通常是废话。

第三，经常轮换垃圾。

很简单，不是吗？

你需要一个永久的“为什么我们的废话有时是废话？” 报价旁边的链接，向人们解释正在发生的事情。

当机器人看到有垃圾并且垃圾被自动购买时，接收者会非常沮丧，因为他们为一根断牙签支付了 10 美元。然后是一个空垃圾袋。然后是鞋底的一些污垢。

如果他们在相对较短的时间内购买了足够多的这种垃圾（并且您到处都有大量的免责声明来解释您为什么这样做），他们将在您的“袋'o废话'。如果您经常旋转废话，即使是他们的人工干预（检查以确保废话不是废话）也可能会失败。哎呀，也许机器人会注意到并且不会购买任何在轮换中时间太短的东西，但这意味着人类会购买非废话。

哎呀，您的常客可能会很开心，以至于您可以将其转化为巨大的营销胜利。开始发布出售了多少“废话”鲤鱼。人们会回来看看机器人被咬的有多厉害。

**更新：** 我希望你可能会接到一些抱怨的电话。我不认为你可以完全阻止它。但是，如果这会杀死机器人，您可以随时停止它并稍后重新启动它。

* * *

## 回答 #8

> 赞同：17
> 
> 时间：2009-02-07T16:56:39.120

> 1.  将项目出售给非脚本人员。
>     
>     
> 2.  保持网站以不被机器人减慢的速度运行。
>     
>     
> 3.  不要让“普通”用户完成任何任务来证明他们是人类。

你可能不想听到这个，但#1 和#3 是互斥的。

![在互联网上，没人知道你是条狗](https://upload.wikimedia.org/wikipedia/en/f/f8/Internet_dog.jpg)

好吧，也没有人知道你是机器人。没有程序化的方式来判断连接的另一端是否有人，而不需要该人做某事。防止脚本/机器人在网络上做事是验证码被发明的全部原因。这并不是一个新的问题，还没有花费大量的精力。如果有更好的方法来做到这一点，一种不会像 CAPTCHA 那样给真实用户带来麻烦，那么每个人都已经在使用它了。

我认为你需要面对这样一个事实，如果你想让机器人远离你的订购页面，一个好的 CAPTCHA 是唯一的方法。如果对您的随机垃圾的需求足够高，以至于人们愿意竭尽全力去获取它，那么合法用户就不会被 CAPTCHA 推迟。

* * *

## 回答 #9

> 赞同：13
> 
> 时间：2009-02-07T09:05:53.750

Woot 用来解决这个问题的方法正在改变游戏规则——从字面上看。当他们展示一个非常受欢迎的商品进行销售时，他们会让用户玩视频游戏来订购它。

这不仅可以成功地对抗机器人（它们可以轻松地对游戏进行微小的更改以避免自动玩家，甚至为每次销售提供一个新游戏），而且它还给用户留下了在减速的同时“赢得”所需物品的印象订购过程。

它仍然很快售罄，但我认为解决方案很好 - 重新评估问题并更改参数导致了一个成功的策略，其中根本不存在严格的技术解决方案。

* * *

您的整个商业模式都是基于“先到先得”。您不能做广播电台所做的事情（他们不再让第一个呼叫者成为赢家，而是让第 5 个或第 20 个或第 13 个呼叫者成为赢家） - 它与您的主要功能不匹配。

不，如果不改变真实用户的订购体验，就无法做到这一点。

假设您实施了所有这些策略。如果我认为这很重要，我只需让 100 人与我一起工作，我们将构建软件以在我们的 100 台独立计算机上运行，​​并每秒访问您的站点 20 次（每个用户访问之间 5 秒/ cookie/帐户/IP 地址）。

你有两个阶段：

1.  看首页
2.  订购

您不能设置验证码阻止＃1 - 这会失去真正的客户（“什么？每次我想看到最新的 woot 时我都必须解决验证码？！？”）。

所以我的小组一起看，定时在一起，所以我们每秒大约进行 20 次检查，谁首先看到更改（自动）提醒所有其他人，谁将再次加载首页，点击订单链接，并执行交易（这也可能会自动发生，除非您实施验证码并为每个 wootoff/boc 更改它）。

您可以在 #2 前面放置一个验证码，虽然您不愿意这样做，但这可能是确保即使机器人观看首页，真实用户也能获得产品的唯一方法。

但即使有了验证码，我的 100 人小乐队仍然具有显着的先发优势——而且你无法判断我们不是人类。如果您开始计时我们的访问，我们只会添加一些抖动。我们可以随机选择要刷新的计算机，这样访问的顺序就会不断变化——但看起来仍然足够像人类。

# 首先，摆脱简单的机器人

你需要有一个自适应防火墙来监视请求，如果有人在做明显愚蠢的事情——在同一个 IP 上每秒刷新一次以上，然后使用策略来减慢它们的速度（丢弃数据包、发回被拒绝或 500 错误等）。

这应该会显着降低您的流量并改变机器人用户使用的策略。

# 其次，使服务器速度极快。

你真的不想听这个……但是……

我认为您需要的是自下而上的完全定制的解决方案。

您不需要弄乱 TCP/IP 堆栈，但您可能需要开发一个非常、非常、非常快速的自定义服务器，专门用于关联用户连接并对各种攻击做出适当反应。

Apache、lighthttpd 等都非常灵活，但您运行的是一个单一用途的网站，并且您确实需要能够做比当前服务器能够做的更多的事情（无论是在处理流量方面，还是在适当地打击机器人方面） ）。

通过在自定义服务器上提供一个基本上是静态的网页（每 30 秒左右更新一次），您不仅应该能够处理 10 倍的请求和流量（因为服务器除了获取请求和阅读之外什么都不做）从内存到 TCP/IP 缓冲区的页面），但它还可以让您访问可能有助于减慢机器人速度的指标。例如，通过关联 IP 地址，您可以简单地阻止每个 IP 每秒一个以上的连接。人类无法比这更快，即使是使用相同 NATed IP 地址的人也只会偶尔被阻止。您想要做一个慢速阻塞 - 在正式终止会话之前让连接保持一秒钟。这可以馈入防火墙，为特别严重的罪犯提供更长期的阻止。

但现实情况是，无论你做什么，当机器人是由人类为单一目的定制时，都无法区分人类和机器人。机器人只是人类的代理。

# 结论

归根结底，您无法通过观看首页来区分人和计算机。您可以在订购步骤停止机器人，但机器人用户仍然具有先发优势，您仍然需要管理大量负载。

您可以为简单的机器人添加块，这将提高标准并减少使用它的人。这可能就足够了。

但是如果不改变你的基本模型，你就不走运了。你能做的最好的就是处理简单的情况，让服务器变得如此之快，普通用户不会注意到，并出售如此多的物品，即使你有几百万个机器人，只要有多少普通用户想要他们就会得到它们.

您可能会考虑设置一个蜜罐并将用户帐户标记为机器人用户，但这会引起巨大的负面社区反弹。

每次我想到“好吧，怎么做……”我总是可以用合适的机器人策略来应对它。

即使您将首页设置为验证码以进入订购页面（“此商品的订购按钮是蓝色的，带有粉红色的闪光，位于此页面的某处”）机器人将简单地打开页面上的所有链接，并使用任何一个来返回订购页面。这只是没有办法赢得这个。

使服务器快速，在订购页面上放置一个 reCaptcha（我发现唯一一个不容易被愚弄的，但它可能对您的应用程序来说太慢了），并考虑稍微改变模型的方法所以普通用户与机器人用户一样有机会。

-亚当

* * *

## 回答 #10

> 赞同：11
> 
> 时间：2009-01-16T16:08:35.630

我说使用 API 公开价格信息。这是不直观的解决方案，但它确实可以让您控制情况。为 API 添加一些限制，使其功能略逊于网站。

您可以对订购做同样的事情。您可以尝试对 API 功能/性能进行小的更改，直到获得所需的效果。

有代理和僵尸网络可以击败 IP 检查。有非常好的验证码阅读脚本。印度甚至有一群工人以低廉的价格击败了验证码。您可以提出的任何解决方案都可能被合理地击败。甚至 Ned Batchelder 的解决方案也可以通过使用 WebBrowser 控件或其他模拟浏览器结合僵尸网络或代理列表来跳过。

* * *

## 回答 #11

> 赞同：11
> 
> 时间：2009-01-16T16:12:26.653

免责声明：这个答案完全与编程无关。但是，它确实首先尝试攻击脚本的原因。

另一个想法是，如果您的销售数量确实有限，您为什么不改变先到先得的方法呢？当然，除非炒作是您营销计划的一部分。

还有很多其他选择，我相信其他人可以想到一些不同的选择：

*   订购队列（预购系统） - 一些脚本可能仍会排在队列的最前面，但手动输入信息可能会更快。

*   抽奖系统（每个尝试订购的人都会进入系统） - 这样，有剧本的人与没有剧本的人有相同的机会。

*   一个紧急优先队列——如果确实有很高的感知价值，人们可能愿意支付更多。实施订购队列，但允许人们支付更多费用以排在队列中的更高位置。

*   拍卖（这要归功于 David Schmitt，评论是我自己的）——人们仍然可以在最后一分钟使用脚本进行狙击，但这不仅会改变定价结构，人们还期待与其他人争吵. 您还可以做一些事情来限制给定时间段内的出价数量，让人们提前打电话获取授权码等。

* * *

## 回答 #12

> 赞同：11
> 
> 时间：2009-02-07T10:33:28.580

无论纳粹认为他们的通信有多安全，盟军经常会破坏他们的信息。无论您如何尝试阻止机器人使用您的网站，机器人所有者都会找到解决方法。如果这让你成为纳粹，我很抱歉:-)

我认为需要不同的心态

*   不要试图阻止机器人使用您的网站
*   不要寻求立即起作用的修复，玩长时间的游戏

进入这样一种心态，即您网站的客户是人还是机器人都没有关系，两者都只是付费客户；但一个比另一个有不公平的优势。一些没有太多社交生活的用户（隐士）对于您网站的其他用户来说可能与机器人一样烦人。

**记录您发布优惠的时间以及帐户选择购买的时间。**

> 这可以让您记录客户购买东西的速度。

**改变一天中发布优惠的时间。**

> 例如，从一天中某个不知名的时间（午夜？）开始有一个 3 小时的窗口，只有机器人和隐士会不断刷新页面 3 小时，以便在几秒钟内获得订单。永远不要改变基准时间，只改变窗口的大小。

久而久之就会出现一张图。

01：您可以在产品上线后的几秒钟内查看哪些账户定期购买产品。暗示他们可能是机器人。

02：您也可以查看报价所用的时间窗口，如果窗口是 1 小时，那么一些早期购买者将是人类。不过，人类很少会刷新 4 小时。如果无论窗口持续时间如何，发布/购买之间经过的时间都非常一致，那么这就是机器人。如果小窗口的发布/购买时间短，大窗口的发布/购买时间长，那就是隐士！

现在，您不必阻止机器人使用您的网站，而是有足够的信息来告诉您哪些帐户肯定被机器人使用，哪些帐户可能被隐士使用。您如何处理这些信息取决于您自己，但您当然可以使用它来使您的网站对有生活的人更公平。

我认为禁止机器人帐户毫无意义，这类似于给希特勒打电话并说“感谢您的 U 艇的位置！” 不知何故，您需要以帐户所有者不会意识到的方式使用这些信息。让我们看看我是否可以梦想任何东西......

**在队列中处理订单：**

当客户下订单时，他们会立即收到一封确认电子邮件，告诉他们他们的订单已排入队列，并会在订单处理完毕后收到通知。我在亚马逊上的订单/发货时遇到过这种事情，它根本不会打扰我，我不介意几天后收到一封电子邮件，告诉我我的订单已经发货，只要我立即收到一封电子邮件告诉我亚马逊知道我想要这本书。在您的情况下，这将是一封电子邮件

1.  您的订单已下达并正在排队。
2.  您的订单已处理。
3.  您的订单已派出。

用户认为他们在一个公平的队列中。每 1 小时处理一次队列，让普通用户也体验一次队列，以免引起怀疑。仅在“平均人工订购时间 + x 小时”的队列中处理来自机器人和隐士帐户的订单。有效地将机器人减少到人类。

* * *

## 回答 #13

> 赞同：8
> 
> 时间：2009-02-07T09:42:28.950

我们目前正在使用 F5 的最新一代 BigIP 负载均衡器来执行此操作。BigIP 具有先进的流量管理功能，可以根据频率和使用模式识别抓取工具和机器人，甚至可以从单个 IP 背后的一组来源中识别出来。然后，它可以限制这些内容，为它们提供替代内容或简单地用标头或 cookie 标记它们，以便您可以在应用程序代码中识别它们。

* * *

## 回答 #14

> 赞同：7
> 
> 时间：2009-02-08T20:45:14.973

首先，让我回顾一下我们需要在这里做什么。我意识到我只是在解释最初的问题，但重要的是我们要做到 100% 正确，因为有很多很棒的建议可以在 4 个中有 2 个或 3 个正确，但正如我将展示的那样，你需要一个涵盖所有需求的多方面方法。

**要求1：摆脱'bot slamming'：**

首页的快速“猛烈抨击”正在损害您网站的性能，并且是问题的核心。“砰砰”声来自单 IP 机器人和——据说——也来自僵尸网络。我们想摆脱两者。

**要求 2：不要扰乱用户体验：**

我们可以通过实施令人讨厌的验证程序来非常有效地解决机器人问题，例如给人工操作员打电话、解决一堆验证码或类似的问题，但这就像强迫每个无辜的飞机乘客跳过疯狂的安全圈，只是为了微小的机会抓住最愚蠢的恐怖分子。哦等等 - 我们实际上是这样做的。但是让我们看看我们是否*不能*在 woot.com 上做到这一点。

**要求 3：避免“军备竞赛”：**

正如您所提到的，您不想卷入垃圾邮件机器人的军备竞赛。因此，您不能使用简单的调整，例如隐藏或混乱的表单字段、数学问题等，因为它们本质上是可以很容易地自动检测和规避的模糊措施。

**要求 4：阻止“警报”机器人：**

这可能是您的要求中最困难的。即使我们可以进行有效的人工验证挑战，机器人仍然可以轮询您的首页并在有新报价时提醒脚本编写者。我们也想让这些机器人不可行。这是第一个要求的更强版本，因为机器人不仅不能发出破坏性能的快速请求——它们甚至不能发出足够多的重复请求来及时向脚本编写者发送“警报”以赢得胜利报价。

* * *

好的，让我们看看我们是否能满足所有四个要求。首先，正如我所提到的，没有任何一种措施可以解决问题。您将不得不结合一些技巧来实现它，并且您将不得不吞下两个烦恼：

1.  少数用户将被要求跳过箍
2.  少数用户将无法获得特别优惠

我知道这些很烦人，但如果我们能让“小”数字*足够小*，我希望你会同意正面大于负面。

**第一个措施：基于用户的节流：**

> 这个很简单，我相信你已经这样做了。如果用户登录并保持每秒刷新 600 次（或其他），您将停止响应并告诉他冷却它。事实上，你可能会比这更早地限制他的请求，但你明白了。这样，登录的机器人将在开始轮询您的网站后立即被禁止/限制。这是简单的部分。未经身份验证的机器人是我们真正的问题，因此对他们来说：

**第二个措施：某种形式的 IP 限制，几乎每个人都建议：**

> 无论如何，您都必须进行*一些*基于 IP 的节流来阻止“bot slamming”。由于允许未经身份验证（未登录）的访问者获得特别优惠对您来说似乎很重要，因此您最初只有 IP 可供使用，尽管它们并不完美，但它们*确实*适用于单 IP 机器人。僵尸网络是另一种野兽，但我会回到那些。现在，我们将做一些简单的节流来击败速射单 IP 机器人。
> 
> 如果您在所有其他处理之前运行 IP 检查，使用代理服务器进行限制逻辑，并将 IP 存储在 memcached 查找优化的树结构中，则性能损失可以忽略不计。

**第三个措施：用缓存的响应掩盖油门：**

> 随着速射单 IP 机器人受到限制，我们仍然必须解决慢速单 IP 机器人，即。机器人经过专门调整以“在雷达下飞行”，将请求间隔得比节流所阻止的稍远。
> 
> 要立即使缓慢的单 IP 机器人无用，只需使用 abelenky 建议的策略：将 10 分钟前的缓存页面提供给过去 24 小时（左右）内发现的所有 IP。这样，每个 IP 每天/每小时/每周都会获得一次“机会”（取决于您选择的时间段），并且对于刚刚点击“重新加载”的真实用户不会有明显的烦恼，除非他们没有获胜报价。
> 
> 这项措施的美妙之处在于，它**也可以**阻止“警报机器人”，只要它们不是来自僵尸网络。
> 
> （我知道如果允许真实用户一遍又一遍地刷新，你可能会更喜欢它，但是如果没有验证码或类似的东西，就无法区分刷新垃圾邮件的人和发送垃圾邮件的机器人）

**第四步：reCAPTCHA：**

> 你是对的，验证码会损害用户体验，应该避免。但是，在*_one_*情况下，它们可能是您最好的朋友：如果您设计了一个非常严格的系统来阻止机器人，那么 - 由于其限制性 - 也会捕获许多误报；那么*作为最后手段*的验证码将允许那些被抓到的真实用户被你的限制滑倒（从而避免恼人的 DoS 情况）。
> 
> 当然，最佳时机是当所有机器人都进入您的网络时，而很少有真正的用户会受到验证码的困扰。
> 
> 如果您在提供 10 分钟前的缓存页面时，还提供替代的、*可选*的、CAPTCHA 验证的“首页刷新器”，那么**真正**想要保持刷新的人仍然可以这样做，而无需获取旧的缓存页面，但代价是每次刷新都必须解决一个验证码。这*是*一个烦恼，但对于顽固的用户来说是**一个可选的，他们往往更宽容，因为他们***知道*他们正在玩系统来提高他们的机会，而提高的机会并不是免费的。

**第五招：诱饵废话：**

> 克里斯托弗·马汉（Christopher Mahan）有一个我很喜欢的想法，但我会对其进行不同的解释。每次你准备一个新的报价时，也要准备另外两个没有人会选择的“报价”，比如 20 美元的 12 毫米蝶形螺母。当优惠出现在首页时，将所有三个“优惠”放在同一张图片中，每个优惠对应的数字。当用户/机器人实际继续订购商品时，他们将不得不选择（单选按钮）他们想要的报价，并且由于大多数机器人只是猜测，在三分之二的情况下，机器人将购买毫无价值垃圾。
> 
> 当然，这并没有解决“警报机器人”问题，并且有一个（很小的）机会可以构建一个能够选择正确项目的机器人。然而，意外购买垃圾的风险应该会让脚本编写者完全摆脱全自动机器人。

**第六招：僵尸网络节流：**

> [删除]

好的............我现在大部分时间都在思考这个问题，尝试不同的方法......全局延迟......基于cookie的令牌......排队服务...... '陌生人节流'....而且它不起作用。它没有。我意识到您尚未接受任何答案的主要原因是没有人提出一种方法来阻止分布式/僵尸网络/僵尸网络攻击......所以我真的很想破解它。我相信我在[另一个线程](https://stackoverflow.com/questions/479233/what-is-the-best-distributed-brute-force-countermeasure)中破解了用于身份验证的僵尸网络问题，所以我也对你的问题寄予厚望。但我的方法并没有转化为这一点。你只有 IP 可以通过，一个足够大的僵尸网络不会在任何基于 IP 地址的分析中暴露自己。

**所以你有它**：我的第六步是无效的。没有。压缩。除非僵尸网络足够小和/或足够快以陷入通常的 IP 限制，否则我看不到***任何***针对不涉及明确人工验证的僵尸网络的有效措施，例如 CAPTHA。很抱歉，但我认为结合上述五项措施是您最好的选择。并且您可能仅使用 abelenky 的 10 分钟缓存技巧就可以做得很好。

* * *

## 回答 #15

> 赞同：6
> 
> 时间：2009-01-16T16:17:14.053

引入一个需要人工交互的延迟怎么样，比如一种“验证码游戏”。例如，它可能是一个小 Flash 游戏，他们必须在 30 秒内爆破方格球并避免爆破实心球（避免色盲问题！）。游戏将获得一个随机数种子，游戏将点击点的坐标和时间戳以及使用的种子传回服务器。

在服务器上，您使用该种子模拟游戏机制，以查看点击是否确实会爆破球。如果他们这样做了，他们不仅是人类，而且需要 30 秒来验证自己。给他们一个会话ID。

你让那个会话 id 做它喜欢做的事，但是如果发出太多请求，他们将无法继续，除非再次播放。

* * *

## 回答 #16

> 赞同：5
> 
> 时间：2009-01-16T16:18:07.657

已经发布了一些其他/更好的解决方案，但为了完整起见，我想我会提到这一点：

如果您主要关心的是性能下降，并且您正在寻找真正的**锤击**，那么您实际上是在处理 DoS 攻击，您可能应该尝试相应地处理它。一种常见的方法是在每秒/分钟/等多个连接后简单地从防火墙中的 IP 丢弃数据包。例如，标准 Linux 防火墙 iptables 具有标准操作匹配函数“hashlimit”，可用于将每个时间单位的连接请求与 IP 地址相关联。

虽然，这个问题可能更适合上一个 SO-podcast 中提到的下一个 SO-derivate，但它还没有发布，所以我想可以回答 :)

**编辑：**
正如 novatrust 所指出的，仍然有 ISP 实际上没有将 IP 分配给他们的客户，因此有效地，这样的 ISP 的脚本客户会禁用该 ISP 的所有客户。

* * *

## 回答 #17

> 赞同：5
> 
> 时间：2009-02-08T01:45:49.237

在应用程序前面的 apache 服务器上编写一个反向代理，它实现了 Tarpit [（维基百科文章）](http://en.wikipedia.org/wiki/Tarpit_(networking))来惩罚机器人。它只会管理最近几秒钟内连接的 IP 地址列表。您检测到来自单个 IP 地址的大量请求，然后在响应之前以指数方式延迟这些请求。

当然，如果多个人在经过 NAT 的网络连接上，他们可以来自同一个 IP 地址，但人们不太可能介意您的响应时间为 2 毫秒到 4 毫秒（甚至 400 毫秒），而机器人会受到阻碍由于延迟增加很快。

* * *

## 回答 #18

> 赞同：4
> 
> 时间：2009-01-16T16:18:08.047

1.  提供 RSS 提要，这样他们就不会占用您的带宽。
2.  **购买时，让每个人随机**等待 最多 45 秒或其他时间，具体取决于您要查找的内容。您的时间限制究竟是什么？
3.  给每个人 1 分钟的时间把他们的名字写进去，然后随机选择人。我认为这是最公平的方式。
4.  监控帐户（在会话中包括一些时间并存储它？）并向看起来低于人类速度阈值的帐户添加延迟。这至少会使机器人被编程为减速并与人类竞争。

* * *

## 回答 #19

> 赞同：4
> 
> 时间：2009-02-07T10:15:48.617

首先，根据定义，不可能支持无状态的，即真正匿名的交易，同时也能够将机器人与合法用户分开。

如果我们可以接受这样一个前提，即我们可以在一个全新的 woot 访问者的首页点击量上强加一些成本，我想我有一个可能的解决方案。由于没有更好的名称，我将这个解决方案粗略地称为“访问 DMV”。

假设有一家汽车经销商每天提供不同的新车，并且在某些日子里，您可以以每辆 5 美元（限制 3）的价格购买一辆异国情调的跑车，外加 5 美元的目的地费用。

问题是，经销店要求您访问经销店并出示有效的驾驶执照，然后您才被允许通过门查看正在出售的汽车。此外，您必须出示有效的驾驶执照才能进行购买。

因此，第一次来这家汽车经销商的访客（我们叫他 Bob）被拒绝进入，并被转介到 DMV 办公室（就在隔壁很方便）以获得驾驶执照。

其他持有效驾照的游客在出示驾照后即可进入。一个整天闲逛、缠着推销员、拿小册子、倒空免费咖啡和饼干的人最终会被拒之门外。

现在，回到没有执照的鲍勃身上——他所要做的就是忍受一次对 DMV 的访问。之后，他可以随时去经销商处买车，除非他不小心把钱包忘在家里，或者他的驾照被毁或吊销。

这个世界上的驾照几乎是不可能伪造的。

访问 DMV 需要首先在“从这里开始”队列中获取申请表。Bob 必须将完成的申请带到 1 号窗口，在那里，许多乖戾的公务员中的第一个将接受他的申请，处理它，如果一切正常，就在窗口的申请上盖章，然后将他送到下一个窗口。因此，Bob 从一个窗口走到另一个窗口，等待他的申请的每一步都通过，直到他最终到达终点并获得他的驾照。

试图“短路” DMV 是没有意义的。如果表格一式三份没有正确填写，或者在任何窗口中给出的任何错误答案，申请就会被撕毁，倒霉的客户会被送回起点。

有趣的是，无论办公室有多满或多空，在每个连续的窗口获得服务所需的时间都差不多。即使你是唯一一个排队的人，工作人员似乎也喜欢让你在黄线后面等一分钟，然后说：“下一个！”

然而，DMV 的情况并没有那么糟糕。在所有等待和处理获得许可证的过程中，您可以在 DMV 大厅观看一个非常有趣且信息丰富的汽车经销商信息广告。事实上，电视广告的播放时间足以涵盖您获得许可证所花费的时间。

稍微技术性的解释：

正如我在最上面所说的，有必要在客户端-服务器关系上具有一些状态性，这允许您将人类与机器人分开。您希望以一种不会过度惩罚匿名（未经身份验证的）人类访问者的方式来执行此操作。

这种方法可能需要 AJAX-y 客户端处理。一个全新的访客被授予“欢迎新用户！” 充满文本和图形的页面（通过适当的服务器端限制）需要几秒钟才能完全加载。当这种情况发生时（并且访问者可能正忙于阅读欢迎页面），他的识别令牌正在慢慢组装。

假设，为了讨论，令牌（又名“驾照”）由 20 个块组成。为了获得每个连续的块，客户端代码必须向服务器提交有效请求。服务器包含故意延迟（假设200 毫秒），在发送下一个块以及发出下一个块请求所需的“标记”之前（即，从一个 DMV 窗口到下一个窗口所需的标记）。总而言之，必须经过大约 4 秒才能完成chunk-challenge-response-chunk-challenge-response-...-chunk-challenge-response-completion 过程。

在这个过程结束时，访问者有一个令牌，允许他进入产品描述页面，然后进入购买页面。令牌是每个访问者的唯一 ID，可用于限制他的活动。

在服务器端，您只接受来自具有有效令牌的客户端的页面视图。或者，如果每个人最终都能看到该页面很重要，那么对缺少有效令牌的请求施加时间惩罚。

现在，为了对合法的人类访问者相对温和，让令牌发行过程在后台相对非侵入性地发生。因此，欢迎页面需要带有有趣的副本和图形，故意稍微放慢速度。

这种方法强制限制机器人使用现有令牌，或者花费最少的设置时间来获取新令牌。当然，这对使用分布式虚假访问者网络的复杂攻击没有多大帮助。

* * *

## 回答 #20

> 赞同：4
> 
> 时间：2009-02-07T18:15:57.883

即使使用验证码，您也无法完全阻止机器人。但是，您可以让编写和维护机器人变得很痛苦，从而减少数量。特别是通过强迫他们每天更新他们的机器人，你会让大多数人失去兴趣。

这里有一些想法可以让编写机器人变得更加困难：

*   需要运行 javascript 函数。Javascript 让编写机器人变得更加痛苦。如果他们没有运行 javascript 仍然允许实际的非 javascript 用户（最少），可能需要验证码。

*   在输入表单时计时（再次通过 javascript）。如果它不像人类，那就拒绝它。在机器人中模仿人类打字很痛苦。

*   编写代码以使用新的随机值每天更新您的字段 ID。这将迫使他们每天更新他们的机器人，这很痛苦。

*   编写代码以每天对字段重新排序（显然以某种方式对您的用户来说不是随机的）。如果他们依赖现场命令，这将使他们绊倒，并再次迫使他们的机器人代码进行日常维护。

*   您可以更进一步并使用 Flash 内容。编写一个机器人来对付 Flash 完全是一件痛苦的事。

一般来说，如果你开始采取一种不阻止它们的心态，而是让它对它们更有效，你可能会实现你正在寻找的目标。

* * *

## 回答 #21

> 赞同：4
> 
> 时间：2009-02-09T14:43:47.343

对未注册用户的所有产品公告延迟 5 分钟。休闲用户不会真正注意到这一点，非休闲用户无论如何都会注册。

* * *

## 回答 #22

> 赞同：3
> 
> 时间：2009-01-16T17:13:35.780

我没有看到您声称检查传入 IP 的巨大负担。相反，我为我的一个客户完成了一个项目，该项目每五分钟分析一次 HTTP 访问日志（它可能是实时的，但由于某种我从未完全理解的原因，他不希望这样做）并且创建防火墙规则以阻止来自任何生成过多请求的 IP 地址的连接，除非该地址可以确认属于合法搜索引擎（google、yahoo 等）。

此客户端运行 Web 托管服务，并在三台服务器上运行此应用程序，这些服务器总共处理 800-900 个域。峰值活动在每秒千次点击范围内，并且从未出现过性能问题 - 防火墙在丢弃来自黑名单地址的数据包方面非常有效。

而且，是的，确实存在 DDOS 技术可以打败这个计划，但他没有看到现实世界中会发生这种情况。相反，他说这大大减少了他的服务器上的负载。

* * *

## 回答 #23

> 赞同：3
> 
> 时间：2009-02-07T09:49:29.263

我的方法是专注于非技术解决方案（否则你将进入一场军备竞赛，你会输掉，或者至少会花费大量时间和金钱）。我将专注于计费/发货部分 - 您可以通过查找多个交付到同一地址或通过对单一付款方式进行多次收费来找到机器人。您甚至可以在几周内跨项目执行此操作，因此如果用户获得了前一个项目（通过非常快速的响应），这次他可能会被分配某种“障碍”。

这也会产生副作用（我认为是有益的，但对于您的情况，我在营销方面可能是错误的）可能会扩大幸运并购买 woot 的人的圈子。

* * *

## 回答 #24

> 赞同：3
> 
> 时间：2009-02-07T18:47:16.273

已经提供了大多数纯技术解决方案。因此，我将建议对问题的另一种看法。

据我了解，这些机器人是由**真正**想购买你所卖包的人设置的。问题是 -

1.  其他不操作机器人的人应该有机会购买，而您提供的袋子数量有限。
2.  您想吸引人们到您的网站并只是出售袋子。

您可以让潜在的包包购买者订阅电子邮件，甚至是短信更新，而不是试图避免机器人，以便在销售发生时得到通知。您甚至可以给他们一两分钟的先机（销售开始的特殊 URL，随机生成并与邮件/SMS 一起发送）。

当这些买家去购买他们在您的网站时，您可以在侧横幅或其他内容中向他们展示您想要的任何内容。那些运行机器人的人会更喜欢简单地注册到您的通知服务。

机器人运行者可能仍会在您的通知上运行机器人以更快地完成购买。一些解决方案可以提供一键购买。

顺便说一句，你提到你的用户没有注册，但听起来那些购买这些包的人不是随机购买者，而是期待这些销售的人。因此，他们可能愿意注册以获得试图“赢得”一个包的优势。

本质上，我的建议是尝试将问题视为社会问题，而不是技术问题。

阿萨夫

* * *

## 回答 #25

> 赞同：2
> 
> 时间：2009-01-16T16:12:39.150

每分钟发出如此多请求的时间块用户代理。例如，如果有人在 10 分钟内每 5 秒准确地请求一个页面，那么他们可能不是用户……但要做到这一点可能会很棘手。

如果他们触发警报，则将每个请求重定向到具有尽可能少的 DB-IO 的静态页面，并发出一条消息，让他们知道他们将在 X 分钟内被允许重新打开。

重要的是要补充一点，您可能应该只将其应用于页面请求并忽略所有媒体请求（js、图像等）。

* * *

## 回答 #26

> 赞同：2
> 
> 时间：2009-01-16T17:35:33.740

防止 DoS 会破坏他在上面概述的@davebug 目标中的第 2 个目标，“保持网站的速度不会被机器人减慢”，但不必解决第一个问题，“将项目出售给非脚本人类”

我敢肯定，一个脚本编写者可以写一些东西来滑冰，这仍然比人类通过订购表格的速度要快。

* * *

## 回答 #27

> 赞同：2
> 
> 时间：2009-02-07T07:52:14.770

好吧，所以垃圾邮件发送者要与普通人竞争以赢得“垃圾沼泽”拍卖？为什么不让下一次拍卖成为一个字面上的“垃圾袋”？垃圾邮件发送者可以花很多钱买一袋装满狗的东西，我们都嘲笑他们。

* * *

## 回答 #28

> 赞同：2
> 
> 时间：2009-02-07T11:19:37.457

这里重要的是改变系统以从您的服务器中移除负载，防止机器人赢得垃圾袋而不让机器人领主知道您正在与他们博弈，否则他们会修改他们的策略。我认为没有任何方法可以做到这一点，而无需在您的最后进行一些处理。

所以你在你的主页上记录点击。每当有人点击该页面时，该连接就会与它的最后一次点击进行比较，如果它太快，那么它会被发送一个没有报价的页面版本。这可以通过某种负载平衡机制来完成，该机制将机器人（命中太快）发送到仅提供主页缓存版本的服务器；真实的人被发送到好的服务器。这减轻了主服务器的负担，并使机器人认为他们仍在正确地获得页面服务。

如果可以以某种方式拒绝报价，那就更好了。然后你仍然可以在人造服务器上提供报价，但是当机器人填写表格时说“对不起，你不够快”:) 那么他们肯定会认为他们还在游戏中。

* * *

## 回答 #29

> 赞同：2
> 
> 时间：2009-02-09T18:49:33.120

怎么样：创建一个表单以在有新商品打折时接收电子邮件，并添加一个捕获系统，该系统将在不到 X 秒的时间内为任何刷新的人提供相同的内容。

这样你就赢得了所有的场景：你摆脱了刮板（他们可以刮掉他们的电子邮件帐户），你给那些不会为了在你的网站上购买东西而编写代码的人提供机会！如果我真的想买东西，我相信我会在我的手机中收到电子邮件并登录购买东西。

* * *

## 回答 #30

> 赞同：2
> 
> 时间：2009-02-11T13:21:07.457

**你怎么知道有编剧下单？**

您的问题的症结在于您无法将脚本编写者与合法用户分开，因此无法阻止它们，那么您怎么知道有脚本编写者呢？

如果您有办法回答这个问题，那么您就有了一组可以用来过滤脚本编写者的特征。

* * *

## 回答 #31

> 赞同：2
> 
> 时间：2009-02-13T00:01:52.600

让我们把问题转过来——你让机器人购买你想让真人购买的东西，让机器人真正有机会购买你**不**希望真人购买的东西怎么样。

抓取机器人会认为是真实情况，但真实的人不会看到的一些未显示的 html 的随机机会（并且不要忘记真实的人包括盲人，因此也要考虑屏幕阅读器等），并且这会通过购买一些非常昂贵的东西（或者不进行实际购买，但会获得付款详细信息以供您列入禁令名单）。

即使机器人切换到“提醒用户”而不是“进行购买”，如果你能得到足够多的误报，你也可以让它对人们来说毫无价值（也许不是每个人，但诈骗的减少是总比没有好）不要打扰。

* * *

## 回答 #32

> 赞同：2
> 
> 时间：2009-06-22T15:54:57.843

顺便说一句：在我看来，问题在于，您的用户预期行为与机器人非常相似（大浪淘沙，未经身份验证，点击每个按钮 :)），因此验证码可能是唯一的图灵测试能够辨别它:))。

* * *

## 回答 #33

> 赞同：1
> 
> 时间：2009-01-16T16:00:42.073

您可以尝试使脚本更难阅读的价格。这可以通过将其转换为图像来实现，但文本识别算法仍然可以解决这个问题。如果有足够多的脚本编写者绕过它，您可以尝试将类似验证码的东西应用于此图像，但显然是以牺牲用户体验为代价的。价格可以在 Flash 应用程序中显示，而不是图像。

或者，您可以尝试设计一种方法来以某种不影响呈现的方式“洗牌”页面的 HTML。我想不出一个很好的例子，但我确信它是可行的。

* * *

## 回答 #34

> 赞同：1
> 
> 时间：2009-02-09T18:35:12.903

不是一个完整的修复，但我还没有在这里看到它。

跟踪“猛烈抨击”地址，并张贴免责声明，说明 BOC/物品不会被运送到任何不遵守您的 TOS 的地址。

这将对一些人产生心理影响，而其他想要利用您的网站的人将不得不改变方法，但您将为他们否定一种途径。

* * *

## 回答 #35

> 赞同：1
> 
> 时间：2009-02-11T08:30:13.710

如上所述，我通过使用存储在表单中的结果的预期值的预先计算的哈希值对非验证码表单进行了一些工作。这个想法适用于两个 Wordpress 反垃圾邮件插件：[WP-Morph](http://neuromancer.inf.um.es/blog/index.php?s=wp-morph&submit=Search)和[WP-HashCash](http://wordpress-plugins.feifei.us/hashcash/)。唯一的缺点是客户端浏览器必须能够解释 JavaScript。

* * *

## 回答 #36

> 赞同：1
> 
> 时间：2009-02-11T13:43:34.220

所以你的问题是业务太多了？人们在狙击你的销售？这是假设这些脚本编写者正在产生合格的销售？问题是他们抢在别人之前抢购了你所有的产品？

您如何为“脚本编写者”创建一个完整的 Web 服务 API 以与之交互。然后提供一点折扣或某种福利，让他们按照你的规则行事。使您的业务翻倍，并进行网络销售和 API 销售。

要么这样，要么只是获得更多库存-您无法抗拒-接受并适应它。

* * *

## 回答 #37

> 赞同：1
> 
> 时间：2009-02-12T20:47:43.317

这是我的看法。攻击机器人所有者的投资回报率，这样他们就会做你想让他们做的合法事情，而不是作弊。让我们从他们的角度来看。他们的资产是什么？显然，无限数量的一次性机器、IP 地址，甚至可能还有大量不熟练的人愿意做空洞的任务。他们想要什么？始终在其他合法人获得之前获得您提供的特别优惠。

好消息是，他们赢得比赛的时间窗口有限。我不认为他们拥有的是无限数量的聪明人，他们随时待命，在您达成交易的那一刻对您的网站进行逆向工程。因此，如果您可以让他们跳过一个他们难以理解但对您的合法客户来说是自动的（他们甚至不知道它在那里），您可以延迟他们的努力，让他们被击败大量真实的人，他们只是渴望得到您的优惠。

第一步是使您的身份验证概念非二进制，我的意思是，对于任何给定的用户，您都有可能分配给他们，即他们是真实的人或机器人。你可以使用一些提示来建立这个概率，其中许多已经在这个线程上讨论过：可疑率活动、IP 地址、外国地理位置、cookie 等。我最喜欢的是只关注确切的版本他们正在使用的窗口。更重要的是，您可以通过强有力的提示为您的长期客户提供一种清晰的身份验证方式：通过与网站互动、购买、为论坛做贡献等。这些事情不是您必须做的，但如果您这样做了，那么您在看到特价商品时会有一点优势。

每当您被要求做出身份验证决定时，请使用此概率使您正在与之交谈的计算机完成或多或少的工作，然后再为他们提供他们想要的东西。例如，您网站上的某些 javascript 可能要求客户端在后台执行一项计算量很大的任务，只有当该任务完成时，您才会让他们知道特价。对于普通客户来说，这可能非常快速和轻松，但对于诈骗者来说，这意味着他们需要更多的计算机来保持持续的覆盖范围（因为每台计算机都必须做更多的工作）。然后，您可以使用上面的概率分数来增加他们必须做的工作量。

为确保此延迟不会导致任何公平问题，我建议将其设置为某种加密任务，其中包括来自个人计算机的当前时间。由于骗子不知道交易什么时候开始，他不能只是编造一些东西，他必须使用接近一天中实时的东西（你可以忽略任何声称在交易开始之前进来的请求）。然后，您可以利用这些时间来调整先到先得的规则，而无需真正的人对此有所了解。

最后一个想法是在您发布新交易时（以及其他时间随机）更改生成工作所需的算法。每次你这样做，正常人都不会受到影响，但机器人会停止工作。他们将不得不让一个人开始进行逆向工程，希望这将比你的交易窗口花费更长的时间。更好的是，如果你从不告诉他们他们是否提交了正确的结果，这样他们就不会收到任何关于他们做错事的警告。为了打败这个解决方案，他们将不得不真正自动化一个真正的浏览器（或至少一个真正的 javascript 解释器），然后你真的在抬高诈骗的成本。另外，使用真正的浏览器，您可以执行此线程其他地方建议的技巧，例如计时每个条目的击键时间并寻找其他可疑行为。

因此，对于您认识的任何人（一个常见的 IP、会话、cookie 等），您都有办法让每个请求的成本更高一些。这意味着诈骗者总是希望向您展示您最困难的案例——您从未见过的全新计算机/浏览器/IP 组合。但是，通过投入一些额外的工作来了解他们是否让机器人正常工作，你会迫使他们浪费大量这些宝贵的资源。尽管它们实际上可能有无限数量，但生成它们并非没有成本，而且您再次推高了它们的 ROI 方程的成本部分。最终，他们只做你想做的事情会更有利可图:)

希望对你有帮助

埃里克

* * *

## 回答 #38

> 赞同：1
> 
> 时间：2009-02-12T21:05:48.967

使用[哈希现金](http://www.hashcash.org/)。

> Hashcash 是一种拒绝服务反措施工具。它目前的主要用途是帮助 hashcash 用户避免由于基于内容和基于黑名单的反垃圾邮件系统而丢失电子邮件。

* * *

## 回答 #39

> 赞同：1
> 
> 时间：2009-02-12T21:59:02.567

为什么不将内容设为 CAPTCHA？

在您显示奖品的页面上，始终在相同位置有一个同名的图像文件，当一个袋子或垃圾销售开始时，动态生成并加载一个带有文字等宣传奖品的图像，当没有销售时只要有一些与网站很好地集成的默认图像。似乎它与 CAPTCHA 的概念相同......如果机器人无法弄清楚图像的含义，他们将无法“赢得”它，如果他们能够的话，他们无论如何都能够弄清楚您的 CAPTCHA 图像。

* * *

## 回答 #40

> 赞同：1
> 
> 时间：2009-02-13T00:06:53.867

我不知道这是否已经被建议了，但与其保留一个机器人的 IP 列表，你需要在每个页面请求上扫描它，为什么不设置一个 cookie 或会话变量来跟踪机器人？这是 PHP 中的一个示例：

```
<?php
// bot check
$now = microtime(true);
// bot counter var
$botCounter = 0;
if (array_key_exists('botCheck_panicCounter', $_REQUEST))
{
  $botCounter = $_REQUEST['botCheck_panicCounter'];
}

// if this seems to be a bot
if ($botCounter > 5)
{
  die('Die()!!');
}

// if this user visited before
if (array_key_exists('botCheck_lastVisit', $_REQUEST))
{
  $lastVisit = $_SESSION['botCheck_lastVisit'];
  $diff = $now - $lastVisit;

  // if it's less than a second
  if ($diff < 1)
  {
    // increase the bot counter
    $botCounter += 1;
    // and save it
    $_REQUEST['botCheck_panicCounter'] = $botCounter;
  }
}

// set the var for future use
$_SESSION['botCheck_lastVisit'] = $now;

// ---------------
// rest of the content goes here
?> 
```

我没有检查语法错误，但你明白了。

* * *

## 回答 #41

> 赞同：1
> 
> 时间：2009-02-13T06:37:01.777

首先不要试图用技术打败技术。

你的问题：

1.  网站的可用性
2.  列表使网站令人兴奋和有趣
3.  由脚本编写者引起的服务器负载。

你的目标：

1.  保持网站以不被机器人减慢的速度运行。
2.  将项目出售给非脚本人员。
3.  不要让“普通”用户完成任何任务来证明他们是人类。

**目标#1：保持网站以不被机器人减慢的速度运行。**

这实际上很简单。让其他人托管该页面。不是在您的服务器上托管首页，而是让 Amazon S3 / Akamai 托管该页面。无论如何，大部分页面都是“静态的”。每 5 分钟左右重新生成一次页面，以便刷新更多动态项目。（见鬼，如果你愿意，可以每 1 分钟重新生成一次）。但现在机器人没有攻击您的服务器 - 它们攻击的是 Akamai 的 CDN，这当然可以承担负载。

当然，对 RSS 提要也这样做。没有理由为什么其他服务不能为您承担带宽/负载。在相关说明中，所有图像均由 Akamai 等提供。为什么要受到打击？

**目标 #2：将项目出售给不会编写脚本的人**

我同意其他人的说法，即让脚本编写没有真正的优势。然而，脚本也是一个热情的客户的标志，所以你也不想成为一个混蛋。

所以我想说让他们购买，但让他们支付夸大的金额（或更优选地）只是放慢他们的速度，以便其他人有机会。

因此，每次用户访问该网站时，都会以 29.99 美元的价格提供一袋垃圾，并有一个随机速度下降或提高价格的计时器。有一张图片或其他一些指标告诉人们，如果他们有耐心，价格是否会更低。

用户有一个“立即购买！” 当他们看到价格/# 项目是他们想要的东西时点击该按钮。

例子：

用户：

*   0 秒 29.99 美元（1 件） 图片说：“等待更低的价格！”
*   7 sec $31.99 (1 item) 图片上写着：“等待更低的价格！”
*   13 秒 27.99 美元（1 件） 图片上写着：“打赌你会做得更好！”
*   16 秒 1.99 美元（0 件） 图片上写着：“如果你不劳而获，那就太疯狂了！”
*   21 秒 4.99 美元（两件） 图片说：“情况越来越好！”
*   24 秒 4.99 美元 (tres itemos) 图片说：“没有比这更好的了！”
*   26 秒 8.99 美元（2 件） 图片上写着：“打赌你会做得更好！”

重复....

在逐渐收紧的周期中，这将延长正确显示“$4.99 (tres itemos)”的时间

如果机器人点击刷新，则循环重新开始。如果用户错过并选择了错误的商品数量/价格 - 决定是否让他们以该价格购买。

例如，如果他们“超支”，他们会为 3 件商品支付 24.99 美元，而 woot 只会向他们收取 3 件商品的 4.99 美元，然后在下次购买 woot 时附上一张 20 美元的优惠券。

**目标 3：不要让“普通”用户完成任何任务来证明他们是人类。**

你在这里犯了一个逻辑谬误。您假设任何图灵测试（[http://en.wikipedia.org/wiki/Turing_test](http://en.wikipedia.org/wiki/Turing_test)）都必须令人讨厌。这不是真的！

这里有一些想法：

1.  创建一个游戏。玩游戏的奖励是下一个订单的 5 美元优惠券。
2.  将 2 个随机用户配对并让他们互相聊天。每个用户被告知要向另一个用户回答 2 个问题：“问你的头发是什么颜色的？” “下周末你打算做什么？” 一些用户与 woot 随机句子生成器配对。然后询问每个用户是否另一个用户是人。如果用户说 woot 随机句子生成器是人类，则回复“不，我不是，可能你也来自火星。你想再试一次吗？”
3.  简单的 Flash 游戏，需要用户通过障碍物来获得折扣券。
4.  询问他们在哪个城市。反向地理编码 IP 地址以查看它们是否接近正确。
5.  问一些愚蠢的问题——“你认为约翰麦凯恩是一位伟大的总统吗？” “你的驾照上是谁的照片？”

只问 3 次，因为你真正想做的就是减慢脚本的速度。

* * *

## 回答 #42

> 赞同：1
> 
> 时间：2009-02-13T14:22:28.070

我同意上面的海报，他说有时会出售真正“垃圾”的垃圾袋。

您似乎提出了一种业务模型，该模型在服务器上受到您尝试交付它的技术的限制。然而，像大多数有技术头脑的人一样（不是批评，毕竟这就是这个网站的目的），你正试图提出一个技术解决方案。但这是一个商业问题。这是由技术失败引起的，但这并不意味着技术就是答案。任何人提出的大多数解决方案（并且会有很多选择）最终都会被那些决心“自动购买”（因为需要更好的简短描述）你的“垃圾袋”的人绕过。

恕我直言，您向错误的人提出了错误的问题，您将在错误的解决方案上浪费大量时间和资源。

* * *

## 回答 #43

> 赞同：1
> 
> 时间：2009-02-13T19:26:17.030

我在这里同意 OP - 请不要验证码 - 这不是一种非常愚蠢的做事方式。

首先设置一些机器人陷阱。我会在主页上更频繁地提到 BOC，以诱使机器人认为机器人不聪明，因此每次都使用不同的措辞，例如“BOC 投诉！” - 所以只扫描关键字的机器人会被困住。

但是，我认为这里的真正问题是双重的，首先是您需要解决的性能问题，今天是机器人引起了问题，但它向我表明有一个性能问题需要解决。

其次，这是一个转移一些真正的废话以获利的商机。所以我会保持整体的 woot 风格并声明“我们检查机器人。如果我们认为你是机器人，你会得到一盒 botcrap。”

机器人检查将在销售完成后的某个时间离线进行，使用机器人陷阱、IP 号码、cookie、会话、浏览器字符串等。对您拥有的购买者数据进行一些认真的分析，以确定谁得到了机器人。如果您决定运送 botcrap - 那么您可以腾出一些普通的垃圾卖给其他人。

* * *

## 回答 #44

> 赞同：1
> 
> 时间：2009-02-13T20:22:04.850

一些想法：

1.  很简单：不要将其命名为“随机垃圾”。每次都更改项目的名称，以便机器人更难识别它。他们可能仍会寻找 1.00 美元的商品，在这种情况下，我建议偶尔在几分钟内出售 1 美元的口香糖。5 美元的运费应该让您物有所值。

2.  更难：不要让用户做任何额外的事情——让用户的计算机做额外的事情。编写一个 JavaScript 函数，该函数执行一个需要大量处理能力的密集计算——例如，第 1000 万个素数——并让用户的计算机计算该值并在您接受订单之前将其传回（甚至可能创建“下订单”网址）。更改每个 BoC 的功能，以便机器人无法预先计算和缓存结果（但您可以）。计算开销可能只会减慢机器人的速度，足以让它们远离你 - 如果不出意外，它会减慢你服务器上的命中，以便它们可以呼吸。

    *   乙

* * *

## 回答 #45

> 赞同：1
> 
> 时间：2009-07-12T13:38:31.750

前期注意事项：

我不识字；我还没有阅读这里的许多其他评论。

今天早上我从 Woot 的描述中偶然发现了这一点。我认为来自 woot 网站的温和用户（以及 BOC 的两次手动购买者）的一些评论可能会有所帮助。

Woot 处于一个独特的位置，它既是*一个*商业网站，也是一个拥有忠实用户的目的地，我理解这种平衡的微妙之处。但就我个人而言，我觉得您对 Crap-CAPCHA（“CRAPCHA”——不知何故我怀疑我是第一个做出这种恶作剧的人）对用户的“负面用户影响”的担忧被夸大了。作为用户，我很乐意证明我是人类。我相信 Woot 会让这个过程变得有趣和有趣，并将其融入整体体验。

这会导致假设的“军备竞赛”吗？我不知道，但它只能提供帮助。例如，如果要购买的关键信息包含在产品图像中或产品描述中（每次都以不同的方式），那么脚本可以做的最好的事情就是在检测到 C 字时打开购买页面. 实际上，我认为这很好：您仍然需要在线，先到先得仍然适用——Wootalyzer 和类似工具只是提高*意识*，而不是在我睡觉或工作时自动购买。

祝你好运弄清楚这一点，并继续努力。

日通用汽车

* * *

## 回答 #46

> 赞同：1
> 
> 时间：2009-07-12T13:56:28.717

向每个用户出售 RSA 密钥怎么样 :) 嘿，如果他们能为 WoW 做到这一点，你们应该能够做到。

我希望我的回答得到 BoC ;)

* * *

## 回答 #47

> 赞同：1
> 
> 时间：2009-07-12T20:54:49.307

两种解决方案，一种高科技，一种低科技。

首先是高科技：BOC 产品在几秒钟内就卖光了，因为机器人在最初的几毫秒内获得了很多产品。因此，与其试图击败机器人，不如卖给他们他们正在扫描的东西：一袋垃圾。毫无价值的废话，当然：弯曲的回形针和 Rosie O'Donnell 的脏照片。然后在服务器上一次有几秒钟的内置随机延迟。随着销售的继续，所售产品的实际价值会增加，而售价则不会。这样，第一个买家（最初几毫秒内的机器人）将得到比他们支付的价格低得多的东西（棕色洋葱蛋糕？），下一个买家（速度较慢的机器人或速度较快的人类）将得到一些不起眼但物有所值的东西（寄售购买？），最后的买家（几乎所有人类）将得到比购买价格更有价值的东西（爆发香槟？）。那台平板电视可能是中国银行最后一次购买的。

任何等待太久的人都会错过，但同时任何购买太快的人都会被淘汰。诀窍是等待一段时间……但不要太多。有一些运气，这是应该的。

低技术含量的解决方案是将 BOC 的名称更改为人类可以解释但机器人不能解释的名称。排泄物的酒袋？有臭味的麻袋？与各种商品相邻的拓扑平面？永远不要重复使用相同的名称，使用略有不同的图片，并在产品描述中说明实际销售的是什么。

* * *

## 回答 #48

> 赞同：1
> 
> 时间：2016-10-10T06:23:24.970

我可能不完全理解这个问题，但我想到了这个想法。使用 AJAX 以固定间隔绘制和更新动态内容，同时使用刷新故意使整个页面加载缓慢。

例如，让整个页面在第一次被访问时花费整整 15 秒来绘制，然后在设定的时间（例如 5 秒）后使用 AJAX 自动刷新动态内容。重新加载整页将是一个主要缺点。该页面可能会定期显示新信息（包括广告），但使用重新加载的整个页面重绘会相当慢。

脚本小子有可能找出 AJAX 查询并将其自动化，但是，对来自同一 IP 的请求进行速率限制也很容易。由于标准人类用户没有从浏览器发起这些请求的典型方法，因此很明显，来自同一 IP 的对 AJAX URL 的高速请求将由某种形式的自动化系统发起。

* * *

## 回答 #49

> 赞同：0
> 
> 时间：2009-02-07T04:50:20.927

与其阻止可疑的 IP，不如减少您提供给地址的数据量，因为它的命中/分钟上升。因此，如果机器人对您的攻击超过了一个随机变化的秘密阈值，它将看不到数据。登录的用户将始终看到数据。经常访问服务器的登录用户将被迫重新进行身份验证，或者获得验证码。

* * *

## 回答 #50

> 赞同：0
> 
> 时间：2009-02-07T08:38:07.223

对此的解决方案可能是将一点客户端处理附加到登录和购买操作中。处理的数量可以忽略不计，因此个人不会受到影响，但尝试多次执行任务的机器人将受到额外工作量的阻碍。

除非您不想在您的网站上使用 javascript，否则该处理可以是一个用 javascript 完成的简单方程式。

* * *

## 回答 #51

> 赞同：0
> 
> 时间：2009-02-07T08:43:51.250

嗯，我记得读过“Linux 防火墙”攻击检测和响应……那里的情况似乎非常相似。其他人也提出了这一建议。只需暂时或逐步阻止客户端以限制他们。如果它是来自几个站点的 realyl，这一定非常有效

问候

* * *

## 回答 #52

> 赞同：0
> 
> 时间：2009-02-07T12:57:47.650

使用 JavaScript 将信息动态写入页面。如果没有 JS 渲染引擎，屏幕抓取器和机器人肯定无法读取信息。

* * *

## 回答 #53

> 赞同：0
> 
> 时间：2009-02-07T16:32:46.220

我将描述的方法有两个要求。1) 强制执行 Javascript 2) 具有有效[http://msdn.microsoft.com/en-us/library/bb894287.aspx](http://msdn.microsoft.com/en-us/library/bb894287.aspx)浏览器会话的 Web 浏览器。

如果没有这些中的任何一个，您将“按设计”不走运。互联网是设计为允许匿名客户查看内容的。使用简单的 HTML 无法解决这个问题。哦，我只是想说简单的、基于图像的验证码很容易被打败，甚至作者也承认这一点。

继续解决问题和解决方案。问题分为两部分。首先是你不能阻止一个人“做坏事”。要解决此问题，您设置了一个方法，该方法接收浏览器有效会话并生成 md5sum + salt + 哈希（您自己的私人设备）并将其发送回浏览器。然后，浏览器需要在每次发布/获取期间返回该散列密钥。如果您没有获得有效的浏览器会话，那么您会回复“请使用有效的网络浏览器等等等等”。所有流行的浏览器都有有效的浏览器会话 ID。

现在我们至少有一个浏览器会话的身份（我知道它不会永久锁定，但是通过简单的脚本“更新”浏览器会话是相当困难的）我们可以有效地锁定一个会话（即；让它脚本编写者很难真正访问您的网站而不会对有效用户造成任何惩罚）。

现在，下一部分就是它需要 javascript 的原因。在客户端上，您为来自键盘的每个字符与 textarea 中的文本值构建一个简单的散列。该有效密钥作为简单的散列传入服务器，并且必须进行验证。虽然这种方法可以很容易地进行逆向工程，但它确实使它成为个人在提交数据之前必须经历的一个额外环节。请注意，这只会阻止自动发布数据，而不是经常访问该网站的 DOS。如果您甚至可以访问 ajax，则有一种方法可以通过网络发送盐和哈希密钥，并使用 javascript 来构建通过网络发送的 onkeypress 字符“有效令牌”。是的，就像我说的那样，它可以很容易地被逆向工程，但你看到我希望这个去哪里。

现在是为了防止通过流量不断滥用。一旦给定了有效的会话 ID，就有多种方法可以建立模式。这些模式（即使使用 Random 来抵消请求时间）的 epsilon 比假设人类试图重现相同的误差幅度要低。由于您有一个会话 ID，并且您有一个“似乎是机器人”的模式，那么您可以使用 20 字节而不是 200000 字节的简单轻量级响应来阻止该会话。

您在这里看到，目标是 1) 使匿名非匿名（即使它只是每个会话）和 2) 开发一种方法，通过建立模式来识别机器人与普通人使用您的系统的方式。你不能说后者是不可能的，因为我以前做过。虽然，我的实现是用于跟踪视频游戏机器人，但我似乎认为那些用于识别机器人与用户的算法可以推广到网站访问的形式。如果您减少机器人消耗的流量，您就可以减少系统的负载。请注意，这仍然不能防止 DOS 攻击，但它确实减少了机器人对系统产生的压力。

* * *

## 回答 #54

> 赞同：0
> 
> 时间：2009-02-07T17:04:21.757

我认为沙盒某些 IP 值得研究。一旦 IP 超过阈值，当它们访问您的站点时，将它们重定向到在提供文件之前有数秒延迟的网络服务器。我编写的 Linux 服务器可以在几乎没有任何 CPU 的情况下处理开放的 50K 连接，因此减慢大量机器人的速度并不难。服务器需要做的就是在充当常规站点的代理之前保持连接打开 N 秒。这仍然可以让普通用户使用该网站，即使他们真的很激进，只是体验略有下降。

[您可以使用这里](http://simonwillison.net/2009/Jan/7/ratelimitcache/)描述的 memcached来廉价地跟踪每个 IP 的命中数。

* * *

## 回答 #55

> 赞同：0
> 
> 时间：2009-02-07T17:05:46.993

要解决机器人猛击您的首页的第一个问题，请尝试使蜜罐与真正的垃圾袋完全相同。使首页的 html 标记包含与一袋垃圾相同的标记，但将其隐藏。这将迫使机器人包含 CSS 引擎来确定垃圾代码包是显示还是隐藏。或者，您只能在一个真正的垃圾袋上升之前随机输出这个“假”袋子 html 的时间（小时？）。这将导致机器人过早发出警报（但不知道多快）。

为了涵盖实际购买垃圾袋的第二步，添加简单的问题。我更喜欢常识问题而不是上面建议的数学问题。比如，“冰是热的还是冷的？” “蚂蚁是大还是小”？当然，这些需要随机化，并从源源不断的问题中提取出来，否则机器人可以被编程来回答它们。但是，这些问题仍然比 CAPTCHA 少得多。

* * *

## 回答 #56

> 赞同：0
> 
> 时间：2009-02-07T17:47:37.033

使用 Flash 怎么样？

是的，我知道使用 Flash 的开销，再加上某些用户将无法购买 bag-o-crap（即：iPhone 用户）这一事实可能会造成不利影响，但在我看来 Flash 会阻止屏幕截图或至少让它变得困难。

我错了吗？

**编辑添加**

在您的提交表单中包含几个“隐藏”字段怎么样？如下所示：

> 实际上，最佳实践似乎是使用两个隐藏字段，一个有初始值，一个没有。这是可以忽略这两个字段的罕见机器人。检查一个字段是否为空白，另一个字段是否具有初始值。并使用 CSS 隐藏它们，而不是通过将它们设为“隐藏”字段：
> 
> .important { 显示：无；}
> 
> 请不要更改接下来的两个字段。
> 
> 机器人倾向于喜欢名称如“地址”的字段。段落中的文字是为少数拥有非 CSS 浏览器的少数人准备的。如果您不担心它们，可以将其排除在外。
> 
> 在处理表单的逻辑中，您可以执行以下操作：
> 
> if (address2 == "xyzzy" and address3 == "") { /* OK to send */ } else { /*可能有机器人 */ }

* * *

## 回答 #57

> 赞同：0
> 
> 时间：2009-02-07T17:49:40.120

*   追逐资金流。这比跟踪 IP 端要容易得多。让机器人支付太多次（白底白字的公告及其所有变体）会迅速扼杀他们的业务案例。您应该仔细准备，并充分利用机器人的优势：它们的速度。你有没有在几秒钟内尝试过几千个假公告？如果他们每秒打十次，你可以走得更快。只要他们继续购买，您就想保持这种状态，因此请仔细考虑您想要开始此操作的一天/一周中的哪个时刻。理想情况下，他们会停止付款，因此您可以将您的案件交给银行。
*   确保您的网站已完全生成，并且每个页面访问都返回不同的页面内容（html、javascript 和 css）。解析比生成更难，并且很容易内置比机器人开发人员可以处理的更多变体。继续更改内容以及生成方式。
*   您需要知道机器人能够以多快的速度适应您所做的更改，最好是它们所在的时区。它是一个僵尸网络还是多个，它们是在同一个时区，不同的时区，还是一个全球开发者网络？你希望你的反击时机正确。
*   当前最先进的机器人让人类进入验证码（针对色情/游戏提供）。
*   让快速反应变得没有吸引力。
*   正如 Ned Batchelder 解释的那样，使用散列和蜜罐。

[编辑] 你不能防御僵尸网络是不正确的。特别是我的第二个建议提供了对自动购买者的充分防御。不过，这需要对您正在使用的技术进行彻底的重新思考。你可能想用 Seaside 做一些实验，或者直接在 c.

* * *

## 回答 #58

> 赞同：0
> 
> 时间：2009-02-07T23:34:14.353

假定不可协商：

第一个屏幕需要是简单的低开销 HTML，带有一个易于识别的（机器人或人）按钮来单击或等效以明确表示“我想要我的废话”。因为我们假设最坏的情况——你有相当于来自机器人和非机器人组合的 DOS 攻击，所有首先点击网站（就可识别性而言）。因此，让我们尽快从缓存、良性回声机器人等中分发这些内容。

（注意：就 wooter 而言，无论如何都会发生这种情况；这对用户来说和 Woot 一样痛苦，因此任何有助于吸收或减轻第一次屏幕获取的事情都符合所有相关 3 方的利益。）

然后，对于非机器人来说，这个过程不需要比现在更严重，合法的过程不需要额外的步骤（或痛苦）。（当前设计的背景说明：当前的wooters通常已经登录，或者可以在购买过程中登录。新买家需要在购买过程中注册。所以实际上已经注册更快，尚未登录更快.)

要完成垃圾销售，需要导航一系列交易屏幕（例如 5，加减，具体取决于具体情况）。获胜者是第一个完成完整导航的人。当前流程奖励最快完成整个 5 个屏幕序列的机器人（或其他任何人）；但整个进程都偏向于快速响应（即机器人）。

毫无疑问，机器人将在第一个屏幕上占据优势；从那一刻起，无论他们取得了什么优势，他们都会通过其余的屏幕，再加上botness在其他阶段提供的任何优势。

* * *

如果 Woot 在第一个屏幕之后故意将排队过程解耦，并将从该点开始的每个会话输入到一系列固定的最小时间步骤中会怎样？直到 30 秒过去，第二个屏幕才会出现；提交后，以下屏幕相同。我敢打赌，如果他们被告知，在第一个屏幕之后，他们会在队列中等待（这已经是真的），这将随着时间的推移以一种不应该比以前更长时间的方式分散负载，我敢打赌健壮，并帮助清除机器人。在这一点上，您可以加入上面列出的一些 bot speedbumps（DOM 对象的细微变化等）。Woot 对事物的控制能力更强的看法会有所帮助。

如果更高比例的 BOC 初始点击可以在他们的第一次点击（或接近它）时进入一个对机器人不友好的非时间关键过程，而不是重试，那么超过那个点的真实人将更有信心. 肯定会比目前的情况不那么敌对。即使在正常的 Woot-Off 情况下，它也可能会降低一直在发生的背景噪音环境机器人速率。机器人会关闭主页，并在没有优势的情况下彼此（以及其他所有人）排队。

* * *

嗯......“公寓线程”的概念浮现在脑海中。我想知道该模式是否大致有用？

* * *

这里一个有用的核心概念是能够在第一个屏幕之后跟踪队列中累积的总时间并能够调整到标准。作为一种机器人缓解策略，您将有一点灵活性，可以将最早的会话推迟 5-10 秒；这样做可能无法检测到，但会导致更丰富的非机器人购买组合。我敢肯定，您有统计数据可以在事后帮助评估此类事情。

* * *

只是为了好玩，您可以（至少一次 wootoff）将您自己的机器人组合在一起，该机器人结合了您所见过的最佳功能，然后在前一天将其分发给所有人。那么至少每个人都会装备同样的武器。（然后鸭子......进来......）

* * *

## 回答 #59

> 赞同：0
> 
> 时间：2009-02-08T01:15:10.517

我喜欢[BradC 的回答](https://stackoverflow.com/questions/450835/stop-scripters-from-slamming-your-website-hundreds-of-times-a-second/450931#450931)（使用 Ned Batchelder 文章中的建议），但我想为其添加另一个级别。您不仅可以随机化字段名称，还可以随机化字段位置和**使它们不可见的代码**。

现在，最后一点是困难的部分，我不知道该怎么做，但是有更多 JavaScript 和 CSS 经验的人可能会弄清楚。当然，您不能一直保持相同的位置，因为脚本编写者只会发现位置为 (x,y) 的元素是真实的。您必须有一些代码来更改表单元素相对于其他元素的位置，以便将它们移出页面，将它们相互叠加等。然后**混淆执行此操作的代码**引入了一些随机性。在新项目可用之前，每天自动更改混淆。这个想法是，如果没有适当的 CSS 和 JavaScript 实现（以及像人类一样读取页面布局的代码），机器人将无法确定哪些元素正在显示给用户。当然，您的服务器端代码知道哪些字段是真实的，哪些是假的。

总之：

*   字段名称是随机的
*   字段顺序是随机的
*   字段隐藏代码复杂
*   字段隐藏代码被混淆 - 随机
*   服务器端代码每天都会自动更改随机因素

鉴于您给出的限制，我认为没有办法避免某种“军备竞赛”，但这并不意味着一切都会失败。如果你可以自动化你的军备竞赛而脚本编写者不能，那么你每次都会赢得它。

* * *

## 回答 #60

> 赞同：0
> 
> 时间：2009-02-08T03:26:59.267

让它对机器人用户无利可图，他们很快就会离开——也就是说，偶尔会出售一些人类可能永远不会想要的东西（也许是一袋*字面*的废话）。

* * *

## 回答 #61

> 赞同：0
> 
> 时间：2009-02-09T01:22:41.967

用户必须等待图像中显示的延迟的延迟页面怎么样？

如果他们在图像中指定的足够短的时间段内单击，您只能从他们到达的页面进行排序，也许图像可能在动画 gif 或非常小的 javascript 或 flash 计时器中进行倒计时。

如果他们在时间限制之外跳转到详细信息页面，他们会看到一个昂贵的项目，如之前的答案中所讨论的。

* * *

## 回答 #62

> 赞同：0
> 
> 时间：2009-02-09T18:13:39.197

我不是 100% 肯定这会奏效，至少没有尝试过。

但似乎应该有可能，虽然在技术上具有挑战性，但编写一个服务器端 HTML/CSS 加扰器，将一个普通的 html 页面 + 相关文件作为其输入，并输出一个或多或少的空白 html 页面，以及一个能够重建页面的混淆 javascript 文件。当然，javascript 不能只打印简单的 DOM 节点……但它可以输出一组复杂的重叠、绝对定位的 div 和段落，每个都包含一个字母，因此它完全可读。

机器人将无法读取它，除非它们使用完整的渲染引擎和足够的人工智能来重建人类将看到的内容。

然后，因为它是一个自动化的过程，您可以根据您的计算能力频繁地重新打乱站点 - 每分钟，或每十分钟，或每小时，甚至每个页面加载。

诚然，编写这样一个混淆器会很困难，而且可能不值得。但这是一个想法。

* * *

## 回答 #63

> 赞同：0
> 
> 时间：2009-02-10T08:47:39.703

这里有很多建议，如果已经发布，请原谅我。

我要做的第一件事是将订购分为两步。第一步将在记录 IP 地址时传回 GUID。第二步将接收 GUID 并将其与已记录的 IP 地址进行比较。结合阻止向网站发送垃圾邮件的 IP 地址（IE：比人类点击刷新速度更快），此技术可以阻止垃圾邮件发送者成功购买，从而解决 1 和 3。

第二项是有问题的，但我会保留您的常规用户 IP 地址的运行列表，并为任何新用户限制流量。这可能会使首次访问者和拨号用户（由于更改 IP 地址）陷入困境，但我认为通过优先考虑重复业务...和拨号用户，这只是在糟糕的情况下做出最好的选择......即使没有任何垃圾邮件发送者，他们是否会“获胜”也值得怀疑。

* * *

## 回答 #64

> 赞同：0
> 
> 时间：2009-02-10T22:10:17.100

为什么不阻止您识别为机器人的用户的信用卡？

1.  在您的网站上发布使用机器人是非法的
2.  找到某些识别机器人的启发式方法（例如，这可以通过短期 IP 跟踪或通过他们感觉表格所花费的时间来完成）
3.  如果您标记为机器人的人购买了该商品，请阻止他的信用卡以备将来使用
4.  下次他尝试购买时，拒绝购买并将商品退回库存

我想即使是专业人士最终也会用完信用卡。

一旦botters放弃了你，你的服务器负载应该随着时间的推移而减少。另一个想法是在服务器之间分离您的页面 - 例如，一个服务器上的 RSS 提要，另一个服务器上的主页，另一个服务器上的结帐。

祝你好运。

* * *

## 回答 #65

> 赞同：0
> 
> 时间：2009-02-11T16:46:05.360

我很确定您的服务器已经记录了传入请求的所有 IP（大多数都记录了）-因此数据已经存在。

**也许你可以：**

只需通过验证它的 IP 在日志中显示小于某个阈值来验证“获胜者”（我使用“grep | wc -l”来获取计数）。如果超过您的阈值，请暂时阻止该 IP（小时左右？）。

取消与“最后”获胜者具有相同送货地址或付款信息的任何“获胜者”的资格，或者在特定时间范围内获胜的“获胜者”以传播“获胜”。

机器人不会那样做。

**为了惹恼刮板中的废话：** 当“随机废话”项目出现时，通过“代码混淆器”运行该页面的 HMTL 输出......这不会改变页面的“显示”......只是用随机生成的 ID 等来打乱代码。

**更阴险：**

根据获胜 IP 在日志中出现的次数增加对“获胜”项目收取的价格。那么即使机器人赢了，你也赢了。:-)

* * *

## 回答 #66

> 赞同：0
> 
> 时间：2009-02-11T21:26:30.797

试图以 BOT 本身为目标永远无法解决问题——编写它们的人会想出一种新的方法来解决你已经实施的任何问题。然而，强迫用户在购买前思考将是一个更有效的解决方案。我能想到的最好的方法是进行荷兰式拍卖。从高价开始（您在商店购买的价格的两倍）并随着时间的推移降低价格。第一个点击购买的人得到它。我认为没有任何机器人足够聪明，无法计算出该商品的最佳价格。

* * *

## 回答 #67

> 赞同：0
> 
> 时间：2009-02-12T18:45:50.660

**限制您发布优惠的时间：** 例如：仅从一小时开始后的 7 分钟到 8 分钟。不要偏离这一点，对在发布时间前半小时内检查很多的 IP 给予几秒钟的惩罚。然后，对于机器人所有者来说，每小时只筛选几分钟而不是全部筛选抓取变得有利。这。时间。此外，由于普通人可以每小时而不是每秒检查一次站点，因此您可以让普通人与机器人更加平等。

**Cookies：** 使用仅由唯一 ID（数据库表的键）组成的跟踪 cookie。对没有 cookie、无效 cookie、使用来自新 IP 的相同 cookie 或使用频率很高的 cookie 的客户端给予“发布延迟”。

**识别可能** 的机器人：Cookie 将导致机器人为它们控制的每个 IP 请求多个 cookie，这是可以跟踪的行为。只有一个发出的 cookie 的 IP 很可能是普通客户端。具有许多已发布 cookie 的 IP 要么是大型 NAT 网络，要么是机器人。我不确定你会如何区分这些，但公司可能更有可能拥有诸如 DNS 服务器、网页和类似性质的东西。

* * *

## 回答 #68

> 赞同：0
> 
> 时间：2009-02-12T18:55:54.333

也许您需要一个解决方案，让机器人完全无法区分袋装销售和所有其他内容。

这是验证码主题的一种变体，但不是用户通过解决验证码来验证自己的身份，而是验证码是对销售的描述，以视觉上令人愉悦的方式呈现（但可能有点被背景遮蔽）。

* * *

## 回答 #69

> 赞同：0
> 
> 时间：2009-02-12T21:24:37.610

我认为你最好的选择是观察 IP 的到来，但要通过几种方式来缓解你提到的问题。首先，使用概率散列（例如，[布隆过滤器](http://en.wikipedia.org/wiki/Bloom_filter)）来标记以前见过的 IP。这类算法非常快，并且可以很好地扩展到绝对庞大的集合大小。其次，使用分级响应，即根据您“最近”看到 IP 的次数为每个请求添加服务器延迟。

* * *

## 回答 #70

> 赞同：0
> 
> 时间：2009-02-12T21:47:21.363

以屏幕阅读器的可用性为代价，您可以在 90% 的页面上使用未标记、无法标记的图片按钮。定期旋转图片并使用随机生成器和随机排序来布置两个按钮，上面写着“我想要这个”和“我是机器人”。以不同的顺序将它们并排放置。在每个阶段，用户都可以朝着他们的目标前进，但机器人更有可能犯错误（50% * 步数）。这就像每个阶段的捕获，对于用户来说更容易，而对于需要在每一步都提示他们的主人的机器人来说更慢。将价格、确认按钮、商品描述放在图片中。它很糟糕，但可能更成功。

* * *

## 回答 #71

> 赞同：0
> 
> 时间：2009-02-12T22:05:24.503

只是让机器人在平坦的地面上竞争。加密时间戳并将其粘贴在隐藏的表单字段中。当您收到提交时，请解密它并查看已经过去了多少时间。如果它超过了人类打字能力的阈值，则拒绝它。现在机器人和人类只能尝试以相同的速度购买一袋垃圾。

* * *

## 回答 #72

> 赞同：0
> 
> 时间：2009-02-12T22:22:05.163

如果你不能打败他们......改变规则！

为什么不提供比脚本编写者自己制作的更好的系统呢？
修改您的网站，使其对不使用机器人脚本的人更公平。人们注册（验证码或电子邮件验证）并有效地参加彩票比赛以获胜！

“赢”让它更有趣。并且每个人都支付少量入场费，因此获胜者以更少的价格获得产品

* * *

## 回答 #73

> 赞同：0
> 
> 时间：2009-02-12T22:44:16.767

我不是网络开发人员，所以请稍加注意，但这是我的建议 -

每个用户都有一个 cookie（包含随机数据串），用于确定他们是否看到当前的垃圾销售。

（如果您没有 cookie，则看不到它们。因此，未启用 cookie 的用户永远不会看到垃圾销售；新用户在第一次查看页面时永远不会看到它们，但之后会看到） .

每次用户刷新网站时，他都会将他当前的cookie传递给服务器，服务器使用它来决定是给他一个新的cookie还是保持当前的cookie不变；并在此基础上决定是否显示带有或不带有垃圾销售的页面。

为了在服务器端保持简单，您可以在任何给定时间说，只有一个 cookie 可以让您看到垃圾销售；还有一些其他的 cookie 标记为“在最后 2 秒内生成”，它们将始终保持不变。因此，如果您刷新页面的速度比这更快，您将无法获得新页面。

（……啊，好吧，我想这并不能阻止机器人恢复旧的 cookie 并将其传回给你。不过，也许这里有一个解决方案。）

* * *

## 回答 #74

> 赞同：0
> 
> 时间：2009-02-12T22:45:52.377

停止所有机器人将非常困难，尤其是在不使用验证码的情况下。我认为您应该从实施各种措施以使脚本编写者的生活更加艰难的角度来处理这个问题。

我相信这是一种可以淘汰其中一些的措施：

您可以尝试在每个响应中**随机化标签的 ID 和类名。**这将迫使机器人依赖重要标签的位置和上下文，这需要更复杂的机器人。此外，如果您想在 CSS 中使用相对或绝对定位，您可以随机化标签的位置。

这种方法的最大缺点是您必须采取措施确保您的 CSS 文件不会在客户端缓存，因为它当然需要包含随机 ID 和类名。克服这个问题的一种方法是不使用外部 CSS 文件，而是将带有随机选择器的 CSS 放在`<head></head>`页面的部分中。这将允许随机 CSS 与页面的其余部分一起在客户端缓存。

* * *

## 回答 #75

> 赞同：0
> 
> 时间：2009-02-12T22:53:19.863

# 脚步：

（结合另一张海报和 gif 垃圾邮件发送者的想法）

*   将**整个报价页面显示为图像**、广告文案等。

*   **加密 URL 中的价格**。

# 攻击：

1.  **机器人转到 URL 以查看结帐页面上的价格**

    *   **将结帐价格标签变成图像**，或

    *   **在用户进入订单页面之前**应用验证码。****

***   **咀嚼带宽**

    *   使用图像提供特别优惠，**使用 HTML 提供普通优惠**。*   **鲁莽的机器人订购**

    *   一些特殊的“形象”优惠实际上是正常价格。*   **RSS 抓取**

    *   **RSS 提要必须通过 hashcash 或验证码**支付。****

    ***   这必须基于**每个请求**。

        *   它可以是**预付费**的，例如用户可以输入 20 个验证码进行 200 次 RSS 查找

        *   一旦 DDOS 的威胁得到缓解，您就可以 实施报价**的电子邮件通知****** 

 ***** * *

## 回答 #76

> 赞同：0
> 
> 时间：2009-02-12T22:54:01.233

如何想出一种方法来识别机器人，可能是基于 IP，但不阻止它们访问该站点，只是不允许它们实际购买任何东西。也就是说，如果他们购买，他们实际上并没有得到它，因为机器人违反了使用条款。

* * *

## 回答 #77

> 赞同：0
> 
> 时间：2009-02-12T23:19:12.453

CAPTCHA 的问题在于，当您在 Woot 上看到垃圾销售时，如果您希望收到您的垃圾袋，您必须非常迅速地作为消费者采取行动。因此，如果您要使用一种 CAPTCHA 形式，它对客户来说必须非常快。

如果你有一张大图像，比如 600 x 600，它只是一个白色背景，图像上随机放置了不同颜色或图案的点。图像上会有图像映射。该地图将有一个链接映射到图像的小块。比如说，10 x 10 块。用户只需单击特定类型的点即可。最终用户会很快，而机器人开发人员编码会有些困难。但是对于一个优秀的机器人创建者来说，仅仅这一点可能并不难。我会添加加密的 URL。

一段时间前，我正在开发一个可以加密 URL 的系统。如果这些页面上的每个 URL 都使用随机 IV 加密，那么它们对于机器人来说都是唯一的。我设计这个是为了混淆探测机器人。我还没有完成这项技术，但我确实有一个在这个庄园中运作的小型网站。

虽然这些建议不是一个完整的解决方案，但它们会使构建工作机器人变得更加困难，同时仍然易于人类使用。

* * *

## 回答 #78

> 赞同：0
> 
> 时间：2009-02-12T23:46:31.873

只要垃圾袋的意外分布只与一个时间点相关联，就可能没有好的解决方案——因为机器人有足够的时间，并且有足够的资源在很短的时间间隔内不断抨击网站。

我认为您必须添加一个额外的标准，即机器人无法从其末端进行屏幕抓取或操作。例如，假设任何时候有 5000 人每分钟几次点击页面寻找垃圾袋，并且每秒有 50 个机器人猛击它。在它出现后的最初几秒钟内，50 个机器人将把它全部抢购一空。

因此，您可以添加一个条件，即废话首先出现在其整数 IP 的模数 30 是随机数（例如 17）的任何用户身上。也许每秒会添加另一个随机数，因此废话会逐渐向所有客户端显示30秒。

现在想象一下前几秒钟会发生什么：目前，所有 50 个机器人都能够立即抢购所有垃圾，而人类得到 0。在这个方案下，6 秒后只有 10 个机器人通过，而 1000 个人类有通过了，大部分垃圾都归于人类。您可以使用时间和随机模数来尝试优化该间隔，具体取决于用户数量和可用单位。

不是完美的解决方案，而是改进。好处是人类比机器人受益的要多得多。有几个缺点，主要是不是每个人在任何特定的日子都能得到平等的机会 - 尽管他们现在没有太多机会，我猜即使没有机器人，他们中的大多数人也会被拒之门外随机的，除非它们恰好在正确的一秒刷新。而且，它不适用于具有大量分布式 IP 的僵尸网络。不知道是否有人真的使用僵尸网络只是为了胡说八道。

* * *

## 回答 #79

> 赞同：0
> 
> 时间：2009-02-12T23:59:04.247

你的最终目标是扩展到更大的用户群，他们可以购买东西。

如果您在一两个小时内通过一系列 IP 地址释放您的 w00t 包，而不是同时将它们全部释放到任何 IP 地址会怎样。

假设您有 255 袋 w00t。1.0.0.0 可以在第一分钟购买，2.0.0.0 可以在第二分钟购买（可能有 2 袋 w00t 可用）等等。

然后，在 255 分钟后，您已经为每个人提供了 w00t 袋，尽管很可能并非所有 255 袋 w00t 都剩下。

这限制了对拥有超过 255 台计算机的用户的真正攻击，尽管机器人用户可能能够“拥有”分配给其 IP 范围的 w00t 包。

没有要求你公平地将包与 IP 匹配（你肯定应该使用某种类型的 MD5 / 随机种子）......如果你增量分发 10 包 w00t，你只需要确保它被分发~均匀地~在你的人群中。

如果 IP 不好，那么您可以使用 cookie 并排除向非 cookie 用户提供一袋 w00t 的用例。

如果您注意到特定 IP、cookie 或地址范围的流量非常大，请按比例稍后/最后将 w00t 包提供给他们，以便在重度/快速/可能之前为偶尔/稳定/慢速访问者提供机会机器人用户。

——罗伯特

* * *

## 回答 #80

> 赞同：0
> 
> 时间：2009-02-13T00:46:48.983

我会推荐一个基于防火墙的解决方案。与大多数防火墙一样，Netfilter/iptables 允许您设置单位时间内新页面请求的最大数量。

例如，要限制分配给人类的页面查看次数（例如，每 30 秒 6 次请求），您可以发出以下规则：

```
iptables -N BADGUY
iptables -t filter -I BADGUY -m recent --set --name badguys

iptables -A INPUT -p tcp --dport http -m state --state NEW -m recent --name http --set
iptables -A INPUT -p tcp --dport http -m state --state NEW -m recent --name http --rcheck --seconds 30 --hitcount 6 -j BADGUY
iptables -A INPUT -p tcp --dport http -m state --state NEW -m recent --name http --rcheck --seconds  3 --hitcount 2 -j DROP 
```

请注意，此限制将单独适用于每个访问者，因此一个用户对网站的滥用不会影响任何其他访问者。

希望这可以帮助！

* * *

## 回答 #81

> 赞同：0
> 
> 时间：2009-02-13T00:52:30.483

您可以通过同时更新 RSS 和 HTML 来减少服务器上的负载，因此机器人不会对您的网站进行屏幕抓取。当然，这为机器人提供了购买装备的优势。

如果您只接受通过信用卡付款（可能是这种情况，可能不是，但它显示了我的思路）只允许用户使用相同的帐户和/或信用卡每 10 次销售购买一次 BOC。脚本小子很容易获得大量 IP，而对于他们来说，将一大堆信用卡放在一起则不那么容易。正如你所说，IP 真的很难被禁止，而对信用卡的临时禁令应该是在公园里散步。

您可以让每个人都知道限制是什么，或者您可以告诉他们，由于需求量大和/或机器人兴趣高，因此在购买时实施了节流，而对机制不具体。

在节流期间的每次购买尝试都可能引发指数回退 - 您购买 BOC，您必须在再次尝试之前通过 10 次销售。无论如何，你在下一次销售时再试一次，现在你必须等待 20 次销售，然后是 40 次，然后是 80 次......

仅当人类用户不太可能在不到 10 次的销售中获得两次 BOC 时，这才真正有用。适当调整数字。

* * *

## 回答 #82

> 赞同：0
> 
> 时间：2009-02-13T01:35:23.173

根据您想要进入的复杂程度，您可以采取一些解决方案。

这些都基于 IP 跟踪，在僵尸网络和云计算下有些分崩离析，但应该会阻止绝大多数僵尸网络攻击者。Joe Random 拥有大量机器人供他使用的可能性远低于他只是运行他在某处下载的 Woot 机器人以获取他的垃圾袋的可能性。

**普通的旧节流**

在一个非常基本的粗略级别上，您可以限制每个时间段每个 IP 的请求。进行一些分析并确定合法用户每小时访问该站点的次数不超过 X 次。将每小时每个 IP 的请求限制在该数量，机器人将不得不大幅降低其轮询频率，否则它们将在接下来的 58 分钟内将自己锁定并完全失明。这本身并不能解决机器人问题，但它确实减少了负载，并增加了合法用户对项目进行拍摄的机会。

**自适应节流**

该解决方案的一个变体可能是实现负载平衡队列，其中最近发出的请求数与您在队列中的位置有关。也就是说，如果您继续抨击该网站，您的请求将变得较低优先级。在诸如垃圾销售袋之类的高流量情况下，这将为合法用户提供优于机器人的优势，因为他们将具有更高的连接优先级，并且可以更快地获取页面，而机器人继续等待直到流量减少到足以使他们的人数增加为止。

**终端验证码**

第三，虽然您不想使用验证码，但在交易完成之前，在流程的最后使用验证码可能不是一个坏主意。到那时，人们已经承诺出售，即使有轻微的烦恼，也可能会完成它。它可以防止机器人完成销售，这意味着它们至少能做的就是敲击您的网站，以尽快提醒人们有关销售的信息。这并不能解决问题，但它确实意味着人类获得销售的机会比机器人目前要好得多。这不是一个解决方案，但它是一种改进。

**以上的组合**

实施基本的、慷慨的限制以阻止最滥用的机器人，同时考虑到单个公司 IP 背后的多个合法用户的潜力。截止数字会非常高 - 您引用的机器人以 10 次/秒的速度访问您的站点，即 216 万次请求/小时，这显然*远远*高于任何合法使用量，即使对于最大的公司网络或共享 IP 也是如此。

实施负载平衡队列，以便您因占用超过您的服务器连接和带宽份额而受到惩罚。这会惩罚共享公司池中的人，但不会阻止他们使用该网站，并且他们的违规行为应该远没有你的botter那么可怕，因此他们的惩罚应该不那么严重。

最后，如果您超过了每小时请求的某个阈值（这可能远远低于“自动断开连接”截止值），则要求用户使用验证码进行验证。

这样，合法使用该站点并且每小时只有 84 个请求的用户，即使他们非常兴奋，也根本不会注意到站点速度的变化。然而，乔·博特发现自己陷入了两难境地。他可以：

*   以他当前的行为超出了他的请求配额，并且根本无法访问该站点，**或者**
*   请求刚好不会超出请求配额，这为他提供了较低流量级别的实时信息，但导致他在高流量时间的请求之间有大量延迟，这严重影响了他在库存耗尽之前完成销售的能力，**或者**
*   请求比普通用户更多，最终被卡在验证码后面，**或者**
*   请求不超过普通用户，因此对普通用户没有优势。

只有滥用的用户遭受服务降级或复杂性增加。合法用户不会注意到任何变化，除了他们更容易购买他们的垃圾袋。

**附录**

以远低于注册用户的速度限制对未注册用户的请求。这样，机器人所有者将不得不通过经过身份验证的帐户运行机器人，以通过应该是相对限制性的节流率。

然后，本发明的漫游器将注册多个用户 ID 并使用这些用户 ID 来实现他们想要的查询率；您可以通过将在给定时间段内从同一 IP 显示的任何 ID 视为相同 ID 并受到共享限制来解决此问题。

这使得机器人别无选择，只能运行一个机器人网络，每个 IP 有一个机器人，每个机器人都有一个注册的 Woot 帐户。不幸的是，这与大量不相关的合法用户实际上无法区分。

您可以将此策略与上述一种或多种策略结合使用，以产生向不参与滥用使用模式的注册用户提供最佳服务的总体效果，同时逐步惩罚其他注册用户和未注册用户，根据他们的状态（匿名或已注册）和由您的流量指标确定的滥用程度。

* * *

## 回答 #83

> 赞同：0
> 
> 时间：2009-02-13T03:30:02.880

我的第一个想法是您说机器人正在抓取您的网页，这表明它们只是在获取 HTML 内容。因此，让您的订单屏幕验证（来自 http-logs）是否从机器人加载了与报价相关的图形

* * *

## 回答 #84

> 赞同：0
> 
> 时间：2009-02-13T03:44:23.830

开发一个不在浏览器中本地运行的首页组件和购物车。如果您使用 Flex/Flash 或 Silverlight 之类的东西，则抓取起来要困难得多，并且您可以完全控制服务器通信，因此可以完全屏蔽脚本编写者的内容。

* * *

## 回答 #85

> 赞同：0
> 
> 时间：2009-02-13T04:24:04.310

如果机器人用户使用无效的信用卡或其他东西付款，这只是一个问题。那么非技术解决方案呢？

将机器人用户视为普通用户，只要他们的付款有效，并确保您有足够的库存来满足总需求。

结果：更多的销售。你做生意是为了赚钱，对吧？

* * *

## 回答 #86

> 赞同：0
> 
> 时间：2009-02-13T05:25:30.107

为了保证只向非脚本人员销售商品，您能否检测到在首页上显示的商品与下订单之间的非人道快速响应？这改变了延迟策略，而不是通过 0.5 秒的延迟人为地限制每个人，而是尽可能快地允许请求并打击显然是超人的机器人:)

用户点击和做出决定的速度存在一些物理限制，并且通过在所有请求都通过*之后*进行检测（而不是故意减慢所有交互），您不会影响非脚本人类的性能。

*如果仅在某些*时候使用 CAPTCHA是可以接受的，您可以将延迟时间增加到快速人类（而不是超人类），并且如果有人点击非常快，则需要一个后确认 CAPTCHA。类似于如果有人快速发布多个帖子，某些网站需要验证码确认。

可悲的是，我不知道有什么好的方法可以阻止你的产品列表的屏幕刮板:(

* * *

## 回答 #87

> 赞同：0
> 
> 时间：2009-02-13T06:05:17.080

我只是想知道是否有一个简单的解决方案。

我假设指示垃圾销售的消息是以文本形式发布的，这是抓取工具寻找的信息。

如果您使用图像来发布公告会怎样？这样做可能会带来一些设计问题，但它们可以被克服，并可能成为一些巧妙创造力的动力。

问题 #1
必须有一些专门用于图像的设计空间。（想要变得非常棘手吗？通过此插槽旋转本地广告。当然，图像的名称需要是静态的，以避免给刮板带来气味。这是一个永远不必担心广告失明的插槽......）

问题 #2
RSS。我不确定是否每个人都可以在他们的提要阅读器中查看图像。如果有足够多的用户可以，那么您可以开始发送包含图像的每日提要更新。您可以在大多数日子发送您想要的任何杂项内容，然后根据需要将其切换为您的垃圾销售警报。

我不知道......他们是否会编程他们的机器人以在每次提要项出现时访问您的网站？

其他问题？可能很多。不过，也许这将有助于进行一些头脑风暴。

保重，
布赖恩

* * *

## 回答 #88

> 赞同：0
> 
> 时间：2009-02-13T06:07:47.073

以下是您可以做出的一些有效假设：

*   任何自动化解决方案都可能而且将会被打破。
*   使网站完全需要人工输入（例如验证码）将大大增加登录/签出/等的难度。
*   您可以出售数量有限的卷心菜绷带。
*   您可以通过客户端 cookie 按会话跟踪用户。
*   您不是在这里与极其顽固的罪犯打交道；这些只是技术人员，他们在弯曲而不是违反法律。通过机器人成功的订单将发送到该人的家中，并且可能不会发送到第三方邮件。

解决方案不是技术解决方案。这是一项政策。

*   在您的网络服务器上记录所有客户端会话 ID。
*   制定“有限机器人”政策；比如说，每 X 秒刮一个屏幕，让使用普通浏览器的人能够点击刷新。任何发现超过此限制的用户都不会赢得胜利。
*   通过向已知的机器人所有者发送一堆 Leakfrogs 来跟进这一点。

* * *

## 回答 #89

> 赞同：0
> 
> 时间：2009-02-13T06:17:38.750

这是我要做的：

1.  要求所有垃圾袋销售的投标人在网站上注册。
2.  当您想开始销售时，请在您的主页上发布“中银销售即将开始，检查您的电子邮件以查看您是否符合条件”。
3.  向随机选择的注册玩家发送邀请，并在销售开始时使用该特定销售独有的 URL。
4.  确保每个销售活动使用的 URL 都不同。
5.  根据用于购买的信用卡、贝宝账户或送货地址，调整随机选择邀请算法以降低频繁获奖者的可能性。

这会阻止机器人，因为您的主页仅显示未决的 BOC 事件。如果不通过电子邮件收到 URL，机器人将无法访问该 URL，并且无法保证他们会收到它。

如果您担心销售影响，您还可以通过为每次销售赠送一两个 BOC 来激励参与。如果您在给定的时间间隔内没有看到对报价的足够吸收，您会自动向其他注册用户发送邮件，从而增加每个报价中的参与者池。

中提琴。公平的竞争环境，没有大量的启发式和网络流量分析。设置大量电子邮件帐户的人仍然可以对系统进行游戏，但通过 CC#、贝宝帐户、送货地址调整参与者选择标准可以缓解这种情况。

* * *

## 回答 #90

> 赞同：0
> 
> 时间：2009-02-13T06:59:42.363

**ASP.net AJAX 控件工具包中的[NoBot 控件](http://www.asp.net/AJAX/AjaxControlToolkit/Samples/NoBot/NoBot.aspx)怎么样？**

它会执行一些自动 javascript 请求和计时技巧，以防止机器人在没有用户交互的情况下访问该站点。

抱歉，如果这不符合某些要求，我只需要致电
tl;dr >D

* * *

## 回答 #91

> 赞同：0
> 
> 时间：2009-02-13T07:26:22.877

将页面的某些部分变成图像，这样机器人就无法理解它们。

例如，创建整数 0-9、美元符号和小数点的小图像。当页面加载时缓存客户端计算机上的图像......然后使用通过运行服务器端的代码选择的图像显示价格。大多数人类用户不会注意到差异，机器人不会知道任何物品的价格。

* * *

## 回答 #92

> 赞同：0
> 
> 时间：2009-02-13T07:26:28.897

**我作为长期 WOOTer 的看法**

我很高兴在订购时有一个验证码，***仅针对 BOC 开启***。我想大多数追求者都会同意。另外，99.9% 的时间你甚至都没有进入订单屏幕，因为它卖光的速度太快了，所以几乎没有人会知道！！

如果你把验证码变成一道非常难的数学题，我终于可以向我妈妈解释这么多年学习数学的实际好处了。

* * *

## 回答 #93

> 赞同：0
> 
> 时间：2009-02-13T07:34:03.543

我不明白为什么 IP 地址过滤必须非常昂贵。使用 IIS，您可以构建一个 ISAPI 过滤器以在本机代码中执行此操作。我确信apache有类似的接口。使用客户端的 IP 地址，您可以为不依赖于禁止列表或其他此类废话的 HTTP 请求编写一个简单的速率限制器。

* * *

## 回答 #94

> 赞同：0
> 
> 时间：2009-02-13T09:20:04.037

1.  焦油坑。将页面浏览量限制为每秒 1 次不会打扰人类用户。
2.  通过 JavaScript 链接。简单的机器人不会挖掘那个。就可用性而言，统计数据显示，不到 1% 的用户不使用 JS。2a。以上的硬核版本。Flash 中的链接。
3.  参数存储在会话中，而不是查询字符串中。大多数机器人是无状态的。

* * *

## 回答 #95

> 赞同：0
> 
> 时间：2009-02-13T09:54:49.087

从没想过我会为任何事情推荐闪光灯，但是闪光灯呢？让您的服务器将异步、加密的内容发送到 flash 文件，以表明是否有交易时间。只要响应是相同大小的交易或没有交易，机器人就无法判断它是什么。

在更一般的层面上，您需要专注于人类和浏览器拥有的资源，而脚本机器人没有，并利用对人类/浏览器来说容易而对机器人来说很难的东西。Captcha 显然是一种简单的尝试，但并不像您所说的那样适合您的网站。Flash 会淘汰大量的机器人，只留下驱动真正浏览器的（较慢的）机器人。如果只需要用户点击正确的位置，该解决方案可能比验证码简单得多。

利用人类的大规模并行图像处理能力！

* * *

## 回答 #96

> 赞同：0
> 
> 时间：2009-02-13T12:56:04.160

使扫描网站变得昂贵。

我不知道这可以让机器人远离您的网站。我什至知道一项服务，其中有人为您扫描网站。你会怎么处理？

机器人最糟糕的事情是，当网站发生变化时。一段时间后，保持机器人运行会变得昂贵或无聊。您的网站上可能有看起来像新产品的更新，但实际上并非如此。如果您不定期和不可预测地更新，机器人就会变得非常困难。

禁止 IP 可能是一种对策，只要它是已知 IP。罪犯需要使用代理。我认识的代理运行良好，但会拖慢你的速度。

* * *

## 回答 #97

> 赞同：0
> 
> 时间：2009-02-13T14:03:15.840

我的想法（其他的没查过，不知道是不是小说）

**处理群发：**

1.  将每天的头版内容转换为 flash/flex 对象。

    *   是的，有些人会抱怨，但我们在这里寻找的是常见的情况，而不是理想的情况。
    *   您还应该随机化您的 Flash 对象的名称，因此它们不是任何可预测的名称模式。
2.  使用 Akamai 或其他 CDN，提前将此闪存对象部署到外部世界。Akamai 生成看似随机的 URL，因此难以预测。

3.  当需要进行新的销售时，您只需在本地更改 URL 以引用 Akamai 的适当对象，然后人们会从他们那里获取 flash 对象以发现该交易是否为 BoC。

一天结束 - 您现在让 Akamai 处理您的午夜流量群

**处理自动购买**

1.  您创建的每个 Flash 对象都可以在其中隐藏大量内容 - 图像、链接、任意 ID，包括一千个地方的“垃圾袋”。您也应该能够混淆闪光灯。
2.  当 Flash 对象“上线”时，人们就会开始攻击它。但是有太多误报，简单的字符串扫描是没有用的——他们必须模拟在本地运行闪存。
3.  但是闪光灯不写文字。它绘制线条和形状。不同颜色的形状都连接到计时器，使它们在不同的时间出现和消失。
    *   如果您看过科尔伯特报告，您就会知道介绍中有数百个描述科尔伯特的词。想象一下类似的东西作为你的介绍，其中总是包括 Bag O Crap。
    *   现在，假设介绍需要任意时间 - 有时几秒钟，有时长达一分钟或更长时间（让它变得有趣）
    *   与此同时，“Bag O Crap”不断出现，但同样，作为介绍的一部分。
    *   最后，显示当天的实际交易，具有活跃的“闪光”效果，使画布的任何单个快照都难以显示实际的产品名称。它漂浮在一个动画背景之上，仍然在说“bag O crap”，并且一直在运动
    *   同样，所有这些都是用线条和形状处理的，而不是文本字符串

最终结果 - 您的黑客被迫拍摄大量交易的图像快照，找出如何区分所有误报并识别实际交易。同时，人类只是看着它，在眼睛疲劳和我们填补文本空白的能力之间，我们可以按原样阅读交易。

这不会永远有效，但会有效一段时间。

另一个想法是简单地限制人们购买 BoC，除非他们以前使用该帐户购买过东西，并且永远不要让他们再次购买 BoC。

* * *

## 回答 #98

> 赞同：0
> 
> 时间：2009-02-13T14:44:29.843

1.  通过 IP 或其他机制识别机器人。

2.  始终为那些被识别为机器人的正常首页提供服务。

被错误识别为机器人的真人不会得到特价，但他们无论如何也不会注意到。

机器人所有者不会意识到您已经识别了他们，因此他们将停止调整他们的脚本。

* * *

## 回答 #99

> 赞同：0
> 
> 时间：2009-02-13T15:41:32.060

我的解决方案是营销变革和技术变革的结合。

目前，销售一袋垃圾促销的技术方面是作为正常的销售来处理的。销售开始，人们争相购买，所有物品都卖光了。用于日常销售的相同统计图表用于垃圾销售袋。

涉及几个市场目标：

*   让客户每天访问该网站一次（冲动购买）。看到一袋垃圾销售的可能性是原因/奖励。
*   客户看到一袋垃圾销售的网络/病毒/八卦效应正在发挥作用，他们将 IM/EMail/给他们的朋友打电话。
*   还有我称之为一般的“善意”。Woot 是一个非常酷的地方，因为它偶尔会以惊人的销售奖励其客户（包括平板电视的垃圾袋）......并且它以公平的“先到先得”的方式完成。

前两个似乎是最重要的。访问者的绝对数量会影响正常交易的销售（或售罄）速度。传统上，新客户几乎都是通过口耳相传来吸引的，让客户将他们的朋友发送到 woot.com 是一种胜利。

所以......我的解决方案是将促销交付改为更多的彩票。

有时用户可以做一些有趣的事情来看看他们是否有资格获得一袋垃圾。有趣的事情可能是一个愚蠢的 Flash 游戏，类似于“打猴子”或 Orbitz 迷你推杆、棒球、曲棍球。这里的目标是机器人无法编写脚本的游戏，因此需要相当小心。目标不仅是向游戏获胜者奖励垃圾袋……而是向所有游戏玩家。

该游戏的技术核心是在游戏结束时向服务器发出请求，该服务器执行“即时抽奖”以确定用户是否赢得了一袋垃圾销售机会。服务器请求将需要包含游戏本身计算的内容（粗略地说“哈希现金”......一个复杂的、消耗 CPU 周期的计算，并且希望是一个难以重现的计算）。这是为了防止机器人重复进入彩票只是查询彩票服务器/服务。

游戏本身会随着时间而改变。您可以为万圣节、圣诞节、情人节、复活节等制作特殊活动游戏。有趣的营销创意有很多空间可以匹配 woot 的“wootiness”。

如果用户获胜，他们可以购买 N 袋垃圾（在限时窗口内）......但他们也可以向 N 个朋友发送限时邀请购买一袋垃圾（有效期为 24 小时）。这提供了超强的网络效应......客户肯定会告诉他们的朋友。或者您也可以将其作为“买 1 送 1”... 让客户购买最多 N 个，但强制每隔一个发送给朋友。这里的关键是让网络/八卦效应成为一个成熟的部分……帮助客户向世界讲述 woot 的美妙之处。

垃圾销售概念袋周围的宣传材料也需要改进。一袋废品售罄的速度图表不再相关。大致上是人们在一个月内有机会购买的频率。有多少人告诉他们的朋友。材料应该巧妙地强调每天一次的实地考察是个好主意。

您还可以宣传为什么垃圾袋销售正在发生变化。尤其是您免费聘请了最好的废话顾问包。

* * *

## 回答 #100

> 赞同：0
> 
> 时间：2009-02-13T17:04:16.653

老实说，我认为您最好的解决方案是在 Woot-Off 期间使项目仅对登录用户可见，并将每个登录用户限制为每 500 毫秒左右刷新一次主页。（或者可能只让未经身份验证的用户在 Woot-Off 期间看到该项目的图片，并确保您不会总是将相同的图片用于 Random Crap。）我认为 Woot 用户会愿意接受这一点，如果你将其作为一种措施出售以帮助他们获得奶油碗，您还可以指出这将帮助他们更快地结账。其他任何事情——即使是使用验证码——都会受到你典型的军备竞赛的影响。

* * *

## 回答 #101

> 赞同：0
> 
> 时间：2009-02-13T18:48:29.240

## 构建更好的机器人

市场告诉你一些事情。他们想得到那个袋子或废话。所以与其对抗脚本（RIAA v 文件共享任何人？）构建一个更好的机器人。

为每个人提供一个安装的应用程序，该应用程序与脚本孩子可以组合的任何东西一样好或更好。每次提供垃圾袋时，用户都会安装*您的品牌应用程序。*该应用程序将自动尝试购买它。如果错过了当前的中银，该应用程序将有一张“票”，以使其有更好的机会进行下一次中银销售。因此，如果用户滚动他们自己的脚本，他们不会获得下一次 boc 销售的“门票”，而官方应用程序的用户却可以获得。

在 boc 销售之间，该应用程序可以显示当前待售物品。地狱，让用户可以告诉woot应用程序寻找“记忆棒”

当官方 woot bo-c+ 脚本应用程序同样好或不好时，谁将构建自己的脚本？

此外，woot 获得了另一种与客户建立联系的方式。

您的客户正在告诉您他们想要什么。

* * *

## 回答 #102

> 赞同：0
> 
> 时间：2009-02-13T18:56:01.983

让用户在原价和高得多的价格之间做出选择。您将必须找到某种方法将按钮与它们各自的价格相关联——颜色、位置，也许是按钮的“情感内涵”——这很难以编程方式确定，但只需要用户将按钮连接到价格。对用户来说简单、直观且无忧，但对脚本编写者来说困难且更重要的是有风险——尤其是在您改变关联方法时。

* * *

## 回答 #103

> 赞同：0
> 
> 时间：2009-02-13T20:31:41.567

如果您愿意强制使用 javascript，则可以使用[hashcash](http://hashcash.org)方案来要求，例如，每个请求大约需要 30 秒的客户端计算。（当然，这可能是 iPhone 上的 5 分钟或 30 台计算机的僵尸网络上的 1 秒：这是一个很大的缺点。）

您还可以通过使用（混淆的）javascript 或（gag）flash 生成页面来使抓取更加困难。

您还可以使用不可见的（通过 CSS 和 javascript）随机垃圾链接来寻找机器人。

您可以检测“类似机器人”的 IP 地址（通过速率和对蜜罐链接的访问）并将它们重定向到一个特殊的服务器（例如，一个带有额外 CC 验证的服务器，例如“通过签证验证”——或者仅一个带有验证码的服务器。 )

但实际上，这是一场军备竞赛。:) 而且你很可能最终不得不升级甚至超越验证码。

这让我想到：为什么不从先到先得的模式转变为彩票模式，在这种模式下，机器人对真正的购物者没有这么大的优势？

* * *

## 回答 #104

> 赞同：0
> 
> 时间：2009-02-14T08:46:56.807

好的，除了答案之外，我还有几个问题，因为我没有使用该技术的经验，不知道它是否可以/会起作用或会有所帮助。

具有以下目标：
1\. 将项目出售给不会编写脚本的人。
2\. 保持网站以不被机器人减慢的速度运行。
3\. 不要让“普通”用户完成任何任务来证明他们是人类。

我的问题是：
-。Flash 应用程序、Java 小程序、Silverlight 或类似的东西是否会降低屏幕抓取的难易程度，足以减少机器人的影响？
我很好奇这些是否像典型的 javascript/html 一样对外部操作开放。虽然它不是 Web 开发的标准，并且从 SEO 的角度来看可能不是“好”，但如果您拥有数百万用户，听起来搜索可见性不是您的问题。我相信这些中的任何一个仍然可以提供一个非常漂亮的界面，这样你的人就不会被设计所推迟。

-。你能把你所有的信息都放在一张图片里吗？我也从未见过您所指的 woot 部分，但我的建议是将人类需要知道的任何文本放在人类友好的图像中，而不是机器人友好的文本框中。

哦，还有其他一些回应中提到的第二件事。不要错过您拥有的大好机会：您对 Bots 有很多需求，而那些拥有 Bots 的人真的买对了吗？你还想要他们的钱吗？（因为如果没有，我会接受它。）

这些使用 Bots 的人是否有其他选择可以向您购买？把你的垃圾袋分开。

为机器人构建一个 woot 子站点，面向机器人，让脚本编写者获得很多乐趣，并为此付钱给你。卖给他们废话，让他们挑战自己与其他脚本编写者对抗。这是一个完全独立的市场供您使用。

如果他们有另一种选择，他们可以赢得一些东西并获得吹嘘的权利，他们可能不太愿意殴打这个小老头。

* * *

## 回答 #105

> 赞同：0
> 
> 时间：2009-02-18T15:01:17.207

如果这个答案已经提交，请原谅我。有很多答案可以尝试阅读和理解所有这些。

为什么你不能偶尔**改变你的购买 API**？这不是对人类用户完全透明，并且几乎杀死了大多数机器人购买者吗？

一种实现方式是更改用户在点击“我想要一个”按钮后必须填写并在页面上提交的字段名称。您一年实际卖出多少次 BOC？不是那么频繁。因此，每次 BOC 上市时，对不同的采购 API 进行编程、测试并准备好使用，这不会是一个巨大的编程负担。

只要确保使用旧的和不正确的 API 的机器人不会让您的服务器停机。也许每次也将 BOC 购买 API 托管在不同的服务器上。这样，机器人可以关闭我们人类 BOC 购买者实际上并未使用的服务器。

* * *

## 回答 #106

> 赞同：0
> 
> 时间：2009-03-07T09:34:38.740

如果我理解正确，您最大的问题是屏幕抓取，而不是自动购买本身。

如果是这样，您最有效的步骤是通过随机编码页面来阻止屏幕抓取，使其看起来相同（种类）但在代码级别始终不同。（使用十六进制代码，java编码，图片，改变周围的代码结构......）

这将迫使他们不断地重写他们的抓取代码，从而使他们自动购买你的“垃圾”变得更加昂贵。如果他们可以管理。他们可能会继续访问您的网站一段时间，直到他们意识到他们无法从中获得任何东西并放弃它。

混淆机器人的缺点是它也会混淆搜索引擎爬虫。

* * *

## 回答 #107

> 赞同：0
> 
> 时间：2009-05-15T08:18:06.120

通过服务器上的 iptables（如果它是基于 Linux）或使用专用的“路由器”使用每个 IP 地址的并发连接限制

* * *

## 回答 #108

> 赞同：0
> 
> 时间：2009-07-12T06:01:41.263

您应该有一些最常购买 BOC 的用户的记录，为什么不直接禁止这些帐户或其他东西。当然，合法用户将在此过程中被禁止，但您是一家提供产品的企业，如果您被一群用户滥用，您有权拒绝为他们提供服务。你有很多关于你的用户的信息，包括贝宝和银行账户，你可以禁止这些账户，迫使机器人用户获得新账户。当然，我可以一直想出一个脚本来购买 BOC，或者只是从网上下载一个，但我的道德比这更好。从未真正成功购买过 BOC，我知道想要获得 BOC 并希望获得大量优惠的合法用户的挫败感。也许不是每隔一段时间就提供一个 BOC 作为单独的项目，您可以每天将其提供给随机用户。当他们收到一件物品时，他们会收到一张小纸条和一个额外的物品，说明他们还收到了 BOC。那么，某人获得 BOC 的唯一方法是，如果他们合法购买了只有真正的人类才会想要的东西。除了合法购买之外，没有什么比购买咖啡机或其他东西更好的了他们还必须承诺购买超过 10 美元。那么，某人获得 BOC 的唯一方法是，如果他们合法购买了只有真正的人类才会想要的东西。除了合法购买之外，没有什么比购买咖啡机或其他东西更好的了他们还必须承诺购买超过 10 美元。那么，某人获得 BOC 的唯一方法是，如果他们合法购买了只有真正的人类才会想要的东西。除了合法购买之外，没有什么比购买咖啡机或其他东西更好的了他们还必须承诺购买超过 10 美元。

* * *

## 回答 #109

> 赞同：0
> 
> 时间：2009-07-12T18:23:10.563

为什么不让首页只是一个图像映射图形（一张没有标签、标签等的图片）？人类几乎可以在任何设备上轻松阅读和理解，但机器人无法询问。本质上使整个首页成为验证码。

* * *

## 回答 #110

> 赞同：0
> 
> 时间：2009-07-12T19:28:50.993

您今天将在灯光上赚到足够的钱来支付思科的 CAPTCHA 计划！我们都习惯了他们购买音乐会门票和其他东西。这似乎是公平的。今天的做法让一些人感到不安，并提出了关于彩票或扫地的问题。我相信您在尝试之前已经检查过了，但这并不是购买 BOC 的真正有趣的方式……它消除了所有的兴奋！

首先获得 BOC 或即使在视线范围内也能获得出色的产品会吸引人们到 Woot。如果在等待随机 BOC 出现时没有理由闲逛并购买大量不需要的东西，那么销售额将会下降。CAPTCHA 可能是打败这些人并仍然保持 Woot 兴奋的唯一方法。

上次我是第一个订购 BOC 的人之一，我的第一个订单被丢弃了百万运费，第二个订单通过但后来被从我的帐户中删除。我生气。我离开了 Woot，并没有像过去那样购买物品。我愿意今天再试一次，就这样。我怀疑我将来会不会因为有趣的东西而没有验证码。

有许多网站试图像 Woot 一样。当然，他们达不到你的水平。我发现自己正在阅读产品描述，不是因为我想要该产品，而是我签到甚至是为了笑。我不想看到有人带着更公平的计划进来并夺走你的大部分业务。

只是我的观点。因为我是一名护士，所以我对机器人和计算机几乎一无所知。但我的投票是升级到更高的水平......拥有机器人的人只需要与我们其他人保持一致，这就是方式应该是:) 萝莉

* * *

## 回答 #111

> 赞同：0
> 
> 时间：2009-07-12T19:38:03.970

至于验证每个人，为什么不使用谷歌解决方案，只要求你怀疑是机器人的 IP 的验证码，甚至只是敲击网站的用户？我敢肯定，如果他们一直在敲击该网站，那么在购买时向某人询问 CAPTCHA 并不是那么糟糕，这与熬夜并反复按 F5 几乎相同。在敲击时，或者可能需要定期验证码，比如每一百次（可能更小？）刷新一次，以阻止警报机器人工作。您需要某种 CAPTCHA 来防止机器人，但您还需要考虑到您的真实用户会像机器人一样行事。

* * *

## 回答 #112

> 赞同：0
> 
> 时间：2009-07-12T19:46:55.060

作为 Woot.com 的长期（4 年）用户和几袋垃圾的购买者，以及现在占用我车库空间的许多其他物品，似乎该解决方案应该成为整个 Woot 主题的一部分。

使用验证码，但要幽默。就像 1,000,000 美元的促销活动一样，通过将自己识别为一个人来制作游戏。这在过去将中国银行的“售罄”推迟了一段合理的时间，而像我这样的人们争先恐后地想出输入优惠券代码的相当简单但幽默的难题。

此外，虽然人们无休止地抱怨服务器错误，但他们并没有停止回来。在我看来，BOC 令人兴奋的部分原因在于有无数其他人试图获得一个。如果服务器抛出一个错误，或者一个时髦的页面，这表明我在一群试图获得 1500 种产品中的太多人中的某个地方。

如果你在拼图上投入尽可能多的创造力，而且它足够新颖，它会延迟机器人足够长的时间，让其他人有机会。包含一个作为代码捕获的随机单词，在“我想要一个”和购买页面之间放置一个中间页面，这需要一些独特的人工交互，你已经在那里阻止了机器人，直到他们弄清楚需要发生什么。

• 您没有实施无聊且有时难以阅读的验证码 • 您让流程变得更有趣， • 您减少了实际安全购买服务器的负载 • 您将培训用户他们需要“做”某事以获得 BOC • 您将在临时页面阻止机器人，延迟他们的购买，直到大多数人至少有机会尝试找出有趣但不是非常困难的谜题。
• 由于随机是 BOC 的全部意义所在，一个随机的、不断变化的谜题/任务将与 BOC 的整个音调相匹配。

在您进行实验时，中间页面背后的技术会变得更加先进，可以捕获随机信息以在购买页面中使用。自从

自 2005 年 5 月 31 日以来，我已经购买了 7 个 BOC，没有机器人的帮助，或者除了 wootalyzer 以外的任何脚本，我认为这是可以接受的帮助。最好的，但我没有得到，是 Please Please Me BOC。B&D 电池也很有趣，但我猜并没有难倒机器人，只会让普通用户感到沮丧。

有时，技术问题的最佳解决方案不是更多的技术。

* * *

## 回答 #113

> 赞同：0
> 
> 时间：2009-07-12T21:57:27.680

对您的特定问题（而不是一般问题）的潜在解决方案是要求用户登录，如果他们想看到“废话”。仅向碰巧登录的用户显示垃圾奖品。所有其他项目可以像往常一样对未登录的用户保持可见。然后，您的忠实用户将被优先考虑废话。

您显然必须将此通知您的用户，可能会通知您这样做是为了增加真实用户发现废话的机会。

如果您的特定问题是机器人为一种特定类型的项目收获，那么请采取限制最少的替代方案，并且只防御该特定攻击。然后，此选项将防止您担心的验证码和可用性问题。

如果机器人登录并开始发送垃圾邮件，您可以强制他们注销并锁定帐户。

如果他们只是为了得到垃圾袋，他们会很快离开，您的页面不会受到巨大的打击。忘记技术含量高的解决方案。

* * *

## 回答 #114

> 赞同：0
> 
> 时间：2009-07-13T00:35:18.413

2件事：

服务器层解决方案：mod_evasive（如果你使用 apache）

[http://www.zdziarski.com/projects/mod_evasive/](http://www.zdziarski.com/projects/mod_evasive/)

前层解决方案：反向验证码，或其他非侵入式验证码

[http://www.ccs.uottawa.ca/webmaster/reverse-captcha.html](http://www.ccs.uottawa.ca/webmaster/reverse-captcha.html)

* * *

## 回答 #115

> 赞同：0
> 
> 时间：2009-07-13T02:48:20.087

如果您对表单名称和 ID 进行随机化或加密，将表单字段的顺序随机化，并使表单标签成为随机验证码图像，这会使脚本攻击变得更加困难 :-D

* * *

## 回答 #116

> 赞同：0
> 
> 时间：2009-07-13T02:52:42.903

让整个血腥页面成为验证码！
有点像芝麻街……这八样东西，不属于这里……

在屏幕上放置 9 个项目、9 个 HTML 表单、9 个 I WANT ONE 按钮。
（9 只是当天的数字......选择你想让布局看起来仍然不错的任何数字。也许是 12。也许为加载浏览器的分辨率定制一些......）

并为每个人争夺它们。
确保 BOC 必须“看到”才能知道它是哪一个……当然这意味着其他 8 个也必须“只看到”才能知道它们不是要购买的物品。
确保您只使用疯狂的数字来引用页面源代码幕后的所有内容。很好，所以 BOT 看到了它的 BOC 时间……但是选择正确的 HTML 表单提交回去进行处理将是一个疯狂的猜测。

* * *

## 回答 #117

> 赞同：0
> 
> 时间：2009-07-13T19:08:45.820

可能没有灵丹妙药可以对付机器人，但这些建议的组合可能有助于阻止它们，并将它们减少到更易于管理的数量。
如果您需要对以下任何建议进行任何澄清，请告诉我：

*   任何描述该项目的图像都应始终使用相同的图像名称（例如“current_item.jpg”），或者应为随每个请求而更改的随机名称。服务器应该知道当前项目是什么，并将提供适当的图像。该图像还应具有随机数量的填充，以减少机器人比较图像大小。（可能会更改某种水印以阻止更复杂的机器人）。
*   从这些图像中删除 ALT 文本。该文本通常是可以在页面其他位置找到的冗余信息，或者使它们成为通用替代文本（例如“当前项目图像将在此处”）。
*   每次出现一袋废话时，描述可能会发生变化。它可以（随机）在多个不同名称之间轮换：“Random Crap”、“BoC”、“Crappy Crap”等……
*   Woot 还可以以“随机垃圾”价格提供更多商品，或者价格为 0.95 美元到 1.05 美元之间的随机金额（为了公平起见，每次出现垃圾时只更改一次价格，而不是针对每个用户）
*   将 BoC 与其他 Woot 区分开来的价格、描述和其他区域可能是图像而不是文本。
*   这些字段也可以是 Java（不是 javaScript）或 Flash。虽然依赖于第三方插件，但它会使机器人更难以有用的方式抓取您的网站。
*   使用图像、Java、Flash 和其他技术的组合可能是另一种让机器人更难的方法。这将更难管理，因为管理员必须了解许多不同的平台。
*   还有其他方法可以混淆此信息。在不影响用户体验的情况下，结合使用客户端脚本（javascript 等）和服务器端混淆（随机图像名称）是最可行的方法。添加一些混淆的 Java 和/或 Flash 或类似内容会使其更加困难，同时可能对某些用户的影响最小。
*   将其中一些策略与上面提到的一些策略结合起来：如果页面每分钟重新加载超过 x 次，则更改图像名称（如果您有上面建议的静态图像名称），或者给他们一个两分钟前的缓存页面.
*   您可以通过用户行为跟踪在后端做一些非常复杂的事情，这些事情可能不需要太多的处理。您可以将该工作卸载到专用服务器，以最大限度地减少对性能的影响。从请求中获取一些数据并将其发送到可以处理该数据的专用服务器。如果它发现可疑的机器人，根据其行为，它可以向另一台服务器（前端路由防火墙、服务器、路由器等或后端 Web 或内容服务器）发送一个钩子，为这些用户增加一些额外的安全性。可能会为这些用户添加 Java 小程序，或者需要用户提供其他信息（不要预先填写订单页面中的所有字段，每次随机将不同的字段留空等）。

* * *

## 回答 #118

> 赞同：0
> 
> 时间：2009-07-14T17:57:29.530

为什么不每次提供 BOC 时都更改 BOC 的名称和图片？看到 BOC 的最新版本将成为追求乐趣的一部分。

* * *

## 回答 #119

> 赞同：0
> 
> 时间：2009-10-10T20:12:30.147

创建一个简单的 ip 防火墙规则，如果您检测到的 IP 地址超过最大值，则将其列入黑名单。每秒传入的请求数。

* * *

## 回答 #120

> 赞同：0
> 
> 时间：2009-10-28T23:55:05.170

你正在让这种方式变得艰难。我可能会踢自己，因为我今天刚刚用一个机器人网站从该网站赢得了 BOC，但只是将 RANDOM CRAP 文本放入网站主页上的验证码中。机器人都在寻找文本“RANDOM CRAP”。因此，您基本上只是首先避免触发它们。任何用眼睛看的人都会看到它说“随机废话”。

* * *

## 回答 #121

> 赞同：0
> 
> 时间：2010-03-06T11:23:35.360

一个相当简单的解决方案是跟踪呈现表单和获得响应之间的时间差：机器人通常具有极短的毫秒响应时间，没有用户可以这样做；或几个小时的极长响应时间。

有一个 django 片段，以及更详细的描述：

[验证码的替代品（无需人工干预）](http://www.djangosnippets.org/snippets/1092/)

* * *

## 回答 #122

> 赞同：0
> 
> 时间：2010-05-25T15:46:02.697

你知道，如果你使用 pubsubhubbub 发布你的 RSS 提要，人们就不必一遍又一遍地点击你的网页来查看 Woot-off 中的下一件事，他们只需等待它出现在他们的谷歌上读者。

* * *

## 回答 #123

> 赞同：0
> 
> 时间：2011-12-20T22:43:26.187

为此，我使用 Cloudflare，因为它不会影响我的网站，但会自动使用 CAPTCHA 阻止任何恶意用户并为您提供更多功能。

* * *

## 回答 #124

> 赞同：-1
> 
> 时间：2009-02-08T08:20:45.650

我想唯一要做的就是让努力超过对垃圾邮件发送者的好处。所以这是一个“头脑风暴”的想法，我不知道如何实施的所有技术细节。我将不得不做一些研究，但根据我目前的知识，如果其他建议的方法被拒绝，值得调查。

您已经在您的网站上使用了 Flash，那么为什么不使用 Flash 控件来协助或提交表单呢？控件可以使用密钥对或其他算法对 Web 服务器进行一些加密通信以散列值？

我想整个表格可以在闪存中？我个人会使用 Java 小程序，因为那是我最喜欢的语言。

* * *

## 回答 #125

> 赞同：-1
> 
> 时间：2009-02-08T09:31:46.147

目标的可能解决方案，不一定是问题标题：

与其向每个人提供特别优惠，不如一次将其提供给随机的 IP 地址集。例如，将 IP 空间划分为 256 个唯一块，在 time=0 时，只允许第一个块中具有 ip 地址的人，在 time=5 秒时，允许来自第一个块和第二个块的人......直到最后一个时间段到了，让大家看到deal。将其随机化的一个想法是根据交易取其 IP 的 md5/sha 的最低有效位加上一些盐。

这将使脚本编写者仍然具有优势，因为他们的响应时间接近于零，并且具有多个 IP 地址的优势，但这意味着给定的机器人不会比另一个客户有任何优势因为他们的 IP 地址，他们比他们“幸运”。

将此与其他一些想法结合起来似乎是个好主意。

* * *

## 回答 #126

> 赞同：-1
> 
> 时间：2009-02-12T19:06:41.047

1.  将项目出售给非脚本人员。
2.  不要让“普通”用户完成任何任务来证明他们是人类。

所以基本上你想知道一个特定的用户是否是一个人，而不需要让他们证明这一点。据我所知，这在互联网上是不可能的，抱歉。

我建议将机制更改为拍卖。

* * *

## 回答 #127

> 赞同：-1
> 
> 时间：2010-11-29T20:14:59.017

我有一个（可能）没有列出的解决方案（因为我还没有通读这里的所有解决方案......）

您可以通过浏览器的用户代理字符串跟踪唯一用户。本质上，通过检查哪些信息是“唯一的”可用，您将能够获得足够的信息来区分不同的人（即使在相同的 IP 地址上）。

查看由[EFF](http://www.eff.org/deeplinks/2010/01/tracking-by-user-agent)编写的这篇文章 以及[这个站点](https://panopticlick.eff.org/)（也是由 EFF 编写的），它将根据您`User Agent`在浏览器中的“测试”您的唯一性。

为了获得更好的唯一性，您可以在来自唯一性和 IP 地址的信息位之间进行比较，以真正将可能性归结为犯罪者/机器人。

* * *

也从 EFF 签出这个[pdf](https://panopticlick.eff.org/browser-uniqueness.pdf)

* * *

## 回答 #128

> 赞同：-1
> 
> 时间：2010-12-27T02:47:34.130

如何使用多个订单按钮（四个或更多）。`image1`通过 对它们进行文件命名`image4`，三个在视觉上是相同的图像（“不要点击这里”），一个是“点击这里”。

对于每次销售，为每个选项随机分配图像`#`。使它们相当大，这样用户就不会不小心点击错误的。图像将是相同的文件大小。
一旦 IP 单击按钮，任何按钮，它们就会被带到相应的网页（订购过程，或“糟糕，您单击了错误的按钮”），并在 2 分钟后重新访问服务器。

* * *

## 回答 #129

> 赞同：-2
> 
> 时间：2009-02-13T02:42:07.503

这总是很困难，我赞赏您避免使用验证码的愿望。我建议首先根据您可以通过 HTTP 请求确定的行为来阻止它们。看看这个被称为[不良行为](http://www.bad-behavior.ioerror.us/)的工具，在我在几个网站上使用它的这一年里，它还没有阻止一个真实的人。大多数机器人在伪装成网络浏览器方面做得并不好。我还推荐使用项目蜜罐 API。

其次，随机更改您的表格，包括标签。这不是为了欺骗机器人，而是为了让你发现他们的 IP 地址/代理。将条目 xx 次搞砸的东西应该列在该列表中。

最后，如果您发现自己处于必须使用某种人工验证过程的位置，请尝试以下操作：

```
[ image of a pig ]

The image above is a: [ ] dog  [ ] house [ ] pig 
```

这对人类来说不会很烦人。

简而言之，您的问题没有“一个”解决方案，不要期望 100% 成功。设定你的目标，将烦恼减少到非常沉闷的咆哮，你应该能够相当快地做到这一点。

# ide - 用于 Windows Mobile 开发的免费 IDE？

> ID：450859
> 
> 赞同：3
> 
> 时间：2009-01-16T15:52:25.727
> 
> 标签：ide, open-source, windows-mobile

自从 Microsoft 停止支持 Embedded Visual C++ 4.0 (eVC 4) 以来已经有一段时间了，他们不允许您将 Windows Mobile SDK 与 Express 版本的 VS 2008 一起使用。现在，我很好，因为我获得了 MSDN 许可证通过工作（包括 VS 2008 Pro），但我想从事几个开源项目，并不是所有其他有贡献的开发人员都这么幸运。因此，他们坚持使用 eVC，即使它根本无法在 Vista 上运行。

这里有（免费！）共同点吗？一个将构建 MFC（和/或 .NET！）应用程序的 IDE，它可以在 XP 和 Vista 上运行？它本身并不一定很花哨，但它拥有的 VS 级别的细节越多，我想我们就会越开心。

*也欢迎提供廉价*商业软件的建议，当然最好的选择是开源的，尤其是跨平台的。我认为 MS 通过阻止这样的开发对 WM OS 造成了严重损害。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-16T16:16:57.610

不幸的是，我认为你不走运。在让[SharpDevelop 编译托管智能设备应用程序](http://www.codeproject.com/KB/mobile/WiMoSansVS.aspx)方面取得了一些成功，尽管 SharpDevelop也曾[有一段时间被打破](http://community.icsharpcode.net/forums/p/4021/11728.aspx#11728)。不过，我不相信直接针对设备或模拟器进行调试是可行的，所以我非常倾向于不打扰。在没有调试器的情况下进行开发是令人难以置信的痛苦。

即使这样，您也没有本机支持。你有什么选择？好吧，有[CeGCC](http://cegcc.sourceforge.net/docs/using.html)和[PocketGCC](http://pocketgcc.sourceforge.net/)，但在过去的几年里，这两个项目都没有太多的活动——我会说它们已经枯萎和死亡。

所以说真的，Visual Studio 是唯一可行的选择。

当微软停止为智能设备开发提供免费解决方案时，开发社区中的许多人（包括我自己）都发出了抱怨。相信我，我们坐在雷德蒙德几个封闭的房间里，为此对几个人大喊大叫——早在 03 年的 Studo 时代，我们就开始大喊大叫。标准的反应是开发方（我们与之交谈）不处理业务方（定价、SKU 功能等）。不幸的是，我明白这一点，我相信他们说的是实话。

更糟糕的是，微软做出了令人难以置信的愚蠢决定，在 VS '08 中他们不仅需要标准（就像他们在 VS05 中所做的那样），而且他们再次将其移回专业和更好的 SKU 功能（在 '03 ) 从而增加了开发成本。

那你有什么办法？我建议，如果您买不起许可证，请四处寻找可能提供许可证的程序和优惠。曾经有一段时间，如果“驱动程序开发人员”承诺在一年内开发和销售驱动程序，微软就会向他们提供免费副本。我认为他们从未检查过您是否确实这样做了（如果他们这样做了，那么创建一个执行很少的驱动程序只需几个小时的任务）。如果您是学生，请尝试获得学生折扣。如果您玩硬件，请寻找 VS 附带的套件。如果您在工作中与任何 Microsoft 代表有任何联系，请抱怨缺少此功能。即使是给办公室代表。

编辑：仅供参考，今天早上我与 Visual Studio for Devices 团队再次将其运行在旗杆上，告诉他们告诉他们的经理考虑 VS 10 下的免费选项。不知道它是否会帮助或改变事情，但我我已经看到另外六个人加入并同意我的观点，所以肯定有来自外部的支持和压力。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-16T16:06:08.193

这是一篇关于[没有 Visual Studio 的 Windows Mobile 开发](http://www.codeproject.com/KB/mobile/WiMoSansVS.aspx)的文章。它仅用于 Compact Framework 开发，它使用 SharpDevelop 作为 IDE。但是，我不知道在没有 Visual Studio 的情况下下载和安装 Windows Mobile SDK 是否可能/合法。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-16T16:10:19.620

一些快速的谷歌研究表明[SharpDevelop](http://www.icsharpcode.net/OpenSource/SD/)对此提供支持，但目前可能有点错误。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-16T20:28:55.840

好吧，我想大多数人已经说过了，但是如果您准备花一点钱，那么 Basic4PPC 可能是一个不错的选择。

如果我记得大约是 50,00 美元。不要被 BASIC 这个词所迷惑——它实际上非常强大。它基于 NET Framework，您可以为桌面和设备编写程序。它甚至有一个可以在设备上运行的 IDE。您可以在[Basic4PPC](http://www.basic4ppc.com)找到更多信息。如果你也看看论坛，你会发现有很多用户，而且论坛的活跃度很高，这是非常积极的。

最后，看看XDA-developers上的这个[线程。](http://forum.xda-developers.com/showthread.php?t=445396)在那里你可以找到很多好东西。

祝你好运。

# java - 持久化 Java 对象的轻量级选项是什么

> ID：450864
> 
> 赞同：15
> 
> 时间：2009-01-16T15:54:14.723
> 
> 标签：java, persistence

持久化 Java 对象的轻量级选项是什么？

我正在寻找最简单的解决方案。我不想要任何花哨的功能，只想要一些简单的东西，它可以与合理简单的对象（一些集合、关系和简单继承）一起工作，并且不会给现有代码库带来太多明显的复杂性（如果有的话）。

我知道的选项包括 Hibernate 和 EMF 等框架，但它们听起来（并且已经经历过）过于复杂和耗时。我想要一些开箱即用的东西，最好是面向文件而不是面向 dababase，我可以把它放在我普通的旧 java 对象之上。

这是一个新手问题，提前感谢任何类似教程的上下文澄清指导。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-01-16T16:00:04.650

**[db4o](http://www.db4o.com/)**是一个对象数据库，因此没有模式设置，它可以很好地适应对象结构随时间的变化。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-01-16T16:07:24.760

如果您正在查看一些简单的东西，您可能还希望数据采用您可以读取的格式（不是二进制文件或数据库）。如果是这种情况，您应该查看 JAXB（Java 的 XML 绑定），它是 Java 6 及更高版本的一部分。还有其他技术可能能够更好地做到这一点，例如 XML Beans，但这是内置的。

从 Java 的 API 看一下这个页面。序列化和反序列化 Java 对象非常简单。

[http://java.sun.com/javase/6/docs/api/javax/xml/bind/JAXBContext.html](http://java.sun.com/javase/6/docs/api/javax/xml/bind/JAXBContext.html)

基本上你使用以下内容：

```
 JAXBContext jc = JAXBContext.newInstance( "com.acme.foo" );

    // unmarshal from foo.xml
    Unmarshaller u = jc.createUnmarshaller();
    FooObject fooObj = (FooObject)u.unmarshal( new File( "foo.xml" ) );

    // marshal to System.out
    Marshaller m = jc.createMarshaller();
    m.marshal( fooObj, System.out ); 
```

只需确保您的 FooObject 具有 @XmlRootElement 注释。Java bean 属性是自动解释的，但您可以使用其他注释来控制 XML 的外观并为更复杂的对象建模。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-01-16T15:59:38.490

ObjectOutputStream 和 ObjectInputStream 可以做到这一点。它内置在 Java 中，允许您非常轻松地序列化/反序列化对象。

这些的坏处是，如果您更改对象，则无法导入现有的旧对象。您必须想办法与可能已经保存在用户计算机上的现有对象保持兼容，例如向您的类添加版本号并创建将旧对象转换为新对象的能力。

更多信息在这里：

*   [http://java.sun.com/j2se/1.4.2/docs/api/java/io/ObjectOutputStream.html](http://java.sun.com/j2se/1.4.2/docs/api/java/io/ObjectOutputStream.html)
*   [http://java.sun.com/j2se/1.4.2/docs/api/java/io/ObjectInputStream.html](http://java.sun.com/j2se/1.4.2/docs/api/java/io/ObjectInputStream.html)

编辑：您也可以考虑立即将以下属性添加到您的所有课程中。这可能允许您向类添加属性并且仍然能够加载旧的对象文件。在 RMI-land 这工作，但我不确定文件。永远不要删除属性。

```
static final long serialVersionUID = 1L; 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-01-16T16:04:07.433

尝试简单 XML 持久性[http://simple.sourceforge.net](http://simple.sourceforge.net)。它非常简单，无需配置。只需获取您现有的 POJO 并对其进行注释，然后您就可以读取它们并将它们写入文件。支持循环对象图以及所有 Java 集合。可以这样使用。

```
Serializer serializer = new Persister();
MyObject object = serializer.read(MyObject.class, new File("file.xml)); 
```

和写作一样容易

```
serializer.write(myInstance, new File("file.xml")); 
```

这是一种非常轻量级的方法，除了标准 Java 1.5 之外没有其他依赖项。与其他依赖于一大堆其他项目的 XML 技术（如 JAXB、XStream、Castor）相比，简单 XML 非常轻量级且内存高效。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-01-16T16:01:44.723

请参阅此类似问题[Light-weight Alternative to hibernate](https://stackoverflow.com/questions/296587/light-weight-alternative-to-hibernate#296669)。我所知道的最轻量级的框架是[iBatis](http://ibatis.apache.org/)

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-01-16T22:33:43.887

你可以试试[XStream](http://xstream.codehaus.org/)，它是一个开源库。它所做的只是将您的 POJO 转换为 XML，然后您可以将其保存到磁盘。它非常易于使用，只需要几行代码即可使用。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-01-16T16:00:47.097

一种简单的方法是将对象序列化（如在 Serializable 中）到磁盘。

[http://www.devx.com/Java/Article/9931/1954](http://www.devx.com/Java/Article/9931/1954)

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-01-16T20:12:28.930

我知道的最简单的选择是使用[Xstream](http://xstream.codehaus.org/)从任何 java obect 中制作一个 xml 文件。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-01-16T16:01:27.300

我不得不说 Hibernate 的初始学习曲线相对较浅。您应该能够在不到一天的时间内启动并运行测试系统。只有当您想要更高级的功能时，它才会开始变得更陡峭。我会建议你一定要看看，我的意思是如果你最终不选择它是什么日子？

话虽如此，您是否考虑过将对象直接序列化到磁盘，如果您只是想要一些快速和肮脏的东西？

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2013-05-02T17:37:36.910

我在生产代码中广泛使用了[PersistentObject](http://dellroad-stuff.googlecode.com/svn/trunk/publish/reports/javadoc/index.html?org/dellroad/stuff/pobj/PersistentObject.html)，它很好地满足了我的需求。

# c - Win32 API 中的 Posix popen() 等价物是什么？

> ID：450865
> 
> 赞同：33
> 
> 时间：2009-01-16T15:54:27.157
> 
> 标签：c, linux, winapi, api, posix

Win32 API 中是否有与 Linux/Unix stdio.h popen() 函数大致等效的函数？如果是这样，我在哪里可以找到它？

编辑：我需要知道这一点来修补 D 标准库中的遗漏。任何答案都必须**仅**使用标准 Win32 API，不得使用特定于 MSVC 的函数。另外，如果存在的话，我更喜欢不是非常低级的东西。

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2009-01-16T16:12:55.717

[MSDN 解释了如何使用Pipe Handle Inheritance](http://msdn.microsoft.com/en-us/library/aa365782%28VS.85%29.aspx)中的 Windows API 执行 popen 所做的事情。[在这里](http://msdn.microsoft.com/en-us/library/ms682499%28VS.85%29.aspx)，它提供了一个有据可查的示例。`_popen`它比Jason 链接的运行时库中的函数更底层，但只使用 Win32 API。

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2009-01-16T16:07:19.893

`_popen`如果您正在编写控制台应用程序，则可以调用。有关详细信息，请参阅 MSDN 站点上的文档：http: [//msdn.microsoft.com/en-us/library/96ayss4b (VS.80).aspx](http://msdn.microsoft.com/en-us/library/96ayss4b(VS.80).aspx)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-19T21:38:38.547

可悲的是，这并不是特别容易。

您需要使用 win32 函数 (CreatePipe) 创建一个管道，然后通常需要复制您提供给子进程的管道末端 (DuplicateHandle) 以允许它被继承，否则它不会是和因此不能使用。

然后，您需要使用 CreateProcess（它需要大量结构指针，包括 STARTUPINFO）创建一个进程，并将您复制的句柄作为其标准输出传递给 STARTUPINFO。

然后您可以从管道的读取端（ReadFile 等）读取直到到达 eof，然后您需要通过关闭所有各种 win32 句柄来进行清理。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2012-11-27T01:49:51.430

挖一个旧线程...

对上面 Jason Coco 的回复做出反应，与链接的 MSDN 页面声称的相反，现在显然可以从非控制台应用程序调用 _popen() 。我从一个 QuickTime 导入器组件中调用它，基本上是一个伪装的 DLL。它会打开一个控制台窗口，但会显示预期的行为。使用 mingw32 的 -mwindows 选项编译标准控制台工具以使其成为 GUI 应用程序，_popen 继续正常工作（但即使从另一个控制台运行该工具也会打开一个控制台窗口。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2020-09-16T18:00:29.963

这是一篇旧文章，但几年前我还需要在 Windows 环境中使用类似[popen()](https://pubs.opengroup.org/onlinepubs/009695399/functions/popen.html)的调用。正如此处答案中的一些评论所指出的那样，使用 Windows API 来实现任何接近经典 POSIX`popen()`的东西都很有趣。

我创建了一个提交给[Code Review](https://codereview.stackexchange.com/q/162546/138048)的实现。此实现使用`pipes`to`stdin`和 from`stdout`以及用于`CreateProcess(...)`.

链接代码旨在构建到具有非常小的 API 的 dll 中。

```
int __declspec(dllexport) cmd_rsp(const char *command, char **chunk, unsigned int size); 
```

简单的使用示例：

```
#include "cmd_rsp.h"
int main(void)
{
    char *buf = {0};
    buf = calloc(100, 1);
    if(!buf)return 0;
    cmd_rsp("dir /s", &buf, 100);
    printf("%s", buf);
    free(buf);
    //or a custom exe
    char *buf2 = {0};
    buf2 = calloc(100, 1);
    cmd_rsp("some_custom_program.exe arg_1 arg_2 arg_n", &buf2, 100);
    printf("%s", buf2);
    free(buf2);

    return 0;
} 
```

例如，它接受可以从 发出的任何命令`stdin`，创建一个单独的进程来执行命令，然后将所有响应内容（如果有）返回到缓冲区，并且在不显示 CMD 窗口弹出窗口的情况下执行此操作。缓冲区根据需要增长以适应响应的大小。

# c++ - ctors 和 setter 参数的命名约定

> ID：450866
> 
> 赞同：8
> 
> 时间：2009-01-16T15:54:35.363
> 
> 标签：c++, naming-conventions

对于那些没有像`m_foo`or之类的特殊符号来命名成员变量的人`foo_`，如何将参数命名为 ctor 和 setter？

到目前为止我尝试过的一些选项......

```
Obj(int foo) : foo(foo) { }
void set_foo(int foo) { this->foo = foo; }

Obj(int _foo) : foo(_foo) { }
void set_foo(int _foo) { foo = _foo; }

Obj(int a_foo) : foo(a_foo) { } // a for "argument"
void set_foo(int a_foo) { foo = a_foo; }

Obj(int init_foo) : foo(init_foo) { }
void set_foo(int new_foo) { foo = new_foo; } 
```

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-01-16T16:00:21.263

我正在使用 foo_，它比 _foo 更好，因为它不会与实现特定的函数名称和关键字冲突。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-01-16T16:29:44.387

我要去

```
Obj(int foo) : mFoo(foo) { }
void setFoo(int foo) { mFoo = foo; } 
```

在我的程序中。对于复制构造函数和 operator=，我倾向于称它为

```
Obj(Obj const& that):mFoo(that.mFoo) { } 
```

对于运营商，我会选择

```
Obj operator+(Obj const& lhs, Obj const& rhs) { ... } 
```

因为那些是**它****的****左侧**和右侧以及**右侧****。****_** _

 ******* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-17T09:23:56.930

我避免（避免意味着从不使用）下划线作为任何标识符的第一个字符。我知道它矫枉过正，但值得努力。

阅读本文： [在 C++ 标识符中使用下划线的规则是什么？](https://stackoverflow.com/questions/228783/what-are-the-rules-about-using-an-underscore-in-a-c-identifier#228797)

虽然不是规则，但我限制使用下划线并更喜欢驼峰式大小写以使我的变量可读。但这只是个人喜好，我不介意阅读使用它的代码。

此外，我从不将参数命名为与成员变量相同的名称。编译器不会帮助您捕捉这可能产生的错误类型（而这一切都是为了让编译器完成真正的工作，这样您就可以完成编译器无法完成的表达工作）。

```
int X::setWork(int work)
{
    this->work = work;  // OK. But more Java like.

    work = work;        // Compiler won't see that problem.
}

int X::setWork(int newWork)
{
    work = newWork;    // A bit harder to get wrong.
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-16T16:02:51.367

我倾向于遵循正在设置的参数的第一个字母，并消除歧义......

```
void setFoo(int f) { foo = f; } 
```

对于一个简单的设置器，对于一个变量，它非常清楚。

另外，我经常这样做

```
int setFoo(const int f) { foo = f; } 
```

所以我可以把事情串起来。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-20T13:11:13.447

我总是这样做：

```
Obj(int foo) : foo(foo) {} 
```

我曾经玩过附加有趣符号的游戏，直到有一次我被这个击中：

```
Obj(Bar& b) : b_(b_) {} 
```

你能看出错误吗？（是的， b_ 是一个私有成员引用变量）。它编译时没有警告。花了我 3 天的调试时间（那时我是一名绿色程序员）。

现在我总是使用相同的名称来避免这样的拼写错误（以及随后的崩溃）。初始化列表中没有歧义。这部分语言是专门为这种情况设计的，所以好好利用它。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-16T16:32:11.903

对于课程：

```
Obj(int foo) : _foo(foo) {}; 
```

对于结构：

```
obj_t(int foo_) : foo(foo_) {}; 
```

二传手：

```
Obj.setFoo(int foo) { _foo = foo; } 
```

我同意 litb 的使用`lhs`和`rhs`操作员呼叫。

我`camelCase`用于类成员函数以及`names_with_underscores`结构字段和方法。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-26T17:22:14.027

第二个作为惯例存在问题，尽管在您的情况下它可能是无害的。具有前导下划线后跟大写字符的名称保留用于实现，并且所有具有前导下划线的名称都保留在全局上下文中。如果您从来没有以大写字母开头的类成员（我没有），那么您可以安全地使用所示的约定（仅使用 _foo 作为函数参数），但我不喜欢任何接近限制的命名约定。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-07-29T00:52:32.567

我遵循**[Google C++ 风格指南](http://google-styleguide.googlecode.com/svn/trunk/cppguide.xml)**

> 变量名都是小写的，单词之间有下划线。类成员变量有尾随下划线。例如：my_exciting_local_variable、my_exciting_member_variable_。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-01-16T15:58:34.543

我总是选择 Param 或 Arg 后缀，但只有在需要消歧时。

```
Obj(int fooArg) : foo(fooArg) 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-01-16T17:37:42.410

我曾经遵循 Microsoft 为成员变量添加前缀的约定`m_`，例如`m_foo`. 在我目前的公司，约定是成员变量的尾随下划线：`foo_`.

通常，如果您自己工作，则使用您喜欢的任何约定。如果您在团队中工作，请使用团队同意的任何内容。代码库中的整体一致性是重要的，而不是特定的约定。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-07-29T00:07:54.373

我用尾随下划线命名实际成员，所以我这样做：

```
Foo(int bar) : bar_(bar) { } 
```

原因是我可以在没有 getBar() 之类的东西的情况下使用 getter 函数（bar() 更好）。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-07-29T00:12:54.550

我这样做：

```
obj(int foo) : _foo(foo) { }
int foo() const { return _foo; }
void foo(int value) { _foo = value; } 
```

这里唯一的技巧是确保下划线后面的字母是小写的。但是，我在任何地方都避免在标识符名称中使用大写字母，因为它与标准库（`foo_bar_baz`用于所有标识符）使用的约定不一致。

# php - 如何在使用 PHP 将图像上传到服务器时将文件名与其他信息一起存储在数据库中？

> ID：450876
> 
> 赞同：26
> 
> 时间：2009-01-16T15:58:29.583
> 
> 标签：php, mysql, database, image-processing, file-upload

嗨，我已经阅读了许多论坛和网站，它们告诉您如何将图像上传到服务器，并且我已经设法让它工作，我可以将文件上传到我的服务器，但存储文件名确实适用于我发现的以下示例而且我还需要创建一个允许将更多数据输入数据库的表单。我坚持这一点，因为以前做过很多 PHP。我已经尝试了不同的网站教程，但没有取得多大成功，任何人都可以帮助我！我需要为我正在做的项目完成它。

我基本上是在尝试制作一个 CMS，它允许用户上传乐队成员的照片并存储有关他们的信息，以便可以将其显示在网页上供公众查看。

* * *

我的表如下所示：

```
Field              Type             Null    Default     
id                 int(10)          No                   
nameMember         varchar(25)      No                   
bandMember         text             No                   
photo              varchar(30)      No                   
aboutMember        text             No                   
otherBands         text             No 
```

我想要的表格如下所示：

```
 <h1>Adding a new Band Member or Affiliate</h1>
      <form method="post" action="addMember.php" enctype="multipart/form-data">
       <p>
              Please Enter the Band Members Name.
            </p>
            <p>
              Band Member or Affiliates Name:
            </p>
            <input type="text" name="nameMember"/>
            <p>
              Please Enter the Band Members Position. Example:Drums.
            </p>
            <p>
              Member's Position:
            </p>
            <input type="text" name="bandMember"/>
            <p>
              Please Upload a Photo in gif or jpeg format. The file name should be named after the Members name. If the same file name is uploaded twice it will be overwritten!
            </p>
            <p>
              Photo:
            </p>
            <input type="file" name="filep" size=35 />
            <p>
              Please Enter any other information about the band member here.
            </p>
            <p>
              Other Member Information:
            </p>
<textarea rows="10" cols="35" name="aboutMember">
</textarea>
            <p>
              Please Enter any other Bands the Member has been in.
            </p>
            <p>
              Other Bands:
            </p>
            <input type="text" name="otherBands" size=30 />
            <br/>
            <br/>
            <input TYPE="submit" title="Add data to the Database" value="Add Member"/>
          </form> 
```

仅将图像上传到服务器的示例，即：

```
<?

if ($_POST["action"] == "Load")
{
$folder = "images/";

move_uploaded_file($_FILES["filep"]["tmp_name"] , "$folder".$_FILES["filep"]["name"]);

echo "
<p align=center>File ".$_FILES["filep"]["name"]."loaded...";

$result = mysql_connect("localhost", "******", "*****") or die ("Could not save image name

Error: " . mysql_error());

mysql_select_db("project") or die("Could not select database");
mysql_query("INSERT into dbProfiles (photo) VALUES('".$_FILES['filep']['name']."')");
if($result) { echo "Image name saved into database

"; }

}

?> 
```

我必须使用的示例表格是这样的：

```
<form action=addMember.php method=post enctype="multipart/form-data">
<table border="0" cellspacing="0" align=center cellpadding="3" bordercolor="#cccccc">
<tr>
<td>File:</td>
<td><input type="file" name="filep" size=45></td>
</tr>
<tr>
<td colspan=2><p align=center>
<input type=submit name=action value="Load">
</td>
</tr>
</table>
</form> 
```

PS：图像文件已打开以供写入。

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2009-01-29T11:41:00.247

**Here is the *answer* for those of you looking like I did all over the web trying to find out how to do this task. Uploading a photo to a server with the file name stored in a mysql database and other form data you want in your Database.** Please let me know if it helped.

Firstly the form you need:

```
 <form method="post" action="addMember.php" enctype="multipart/form-data">
    <p>
              Please Enter the Band Members Name.
            </p>
            <p>
              Band Member or Affiliates Name:
            </p>
            <input type="text" name="nameMember"/>
            <p>
              Please Enter the Band Members Position. Example:Drums.
            </p>
            <p>
              Band Position:
            </p>
            <input type="text" name="bandMember"/>
            <p>
              Please Upload a Photo of the Member in gif or jpeg format. The file name should be named after the Members name. If the same file name is uploaded twice it will be overwritten! Maxium size of File is 35kb.
            </p>
            <p>
              Photo:
            </p>
            <input type="hidden" name="size" value="350000">
            <input type="file" name="photo"> 
            <p>
              Please Enter any other information about the band member here.
            </p>
            <p>
              Other Member Information:
            </p>
<textarea rows="10" cols="35" name="aboutMember">
</textarea>
            <p>
              Please Enter any other Bands the Member has been in.
            </p>
            <p>
              Other Bands:
            </p>
            <input type="text" name="otherBands" size=30 />
            <br/>
            <br/>
            <input TYPE="submit" name="upload" title="Add data to the Database" value="Add Member"/>
          </form> 
```

Then this code processes you data from the form:

```
 <?php

// This is the directory where images will be saved
$target = "your directory";
$target = $target . basename( $_FILES['photo']['name']);

// This gets all the other information from the form
$name=$_POST['nameMember'];
$bandMember=$_POST['bandMember'];
$pic=($_FILES['photo']['name']);
$about=$_POST['aboutMember'];
$bands=$_POST['otherBands'];

// Connects to your Database
mysqli_connect("yourhost", "username", "password") or die(mysqli_error()) ;
mysqli_select_db("dbName") or die(mysqli_error()) ;

// Writes the information to the database
mysqli_query("INSERT INTO tableName (nameMember,bandMember,photo,aboutMember,otherBands)
VALUES ('$name', '$bandMember', '$pic', '$about', '$bands')") ;

// Writes the photo to the server
if(move_uploaded_file($_FILES['photo']['tmp_name'], $target))
{

// Tells you if its all ok
echo "The file ". basename( $_FILES['uploadedfile']['name']). " has been uploaded, and your information has been added to the directory";
}
else {

// Gives and error if its not
echo "Sorry, there was a problem uploading your file.";
}
?> 
```

Code edited from [www.about.com](http://www.about.com)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2012-12-30T11:47:12.953

每张照片都有一个 ID，所以我的建议是重命名照片。例如，您按日期重命名它

```
<?php
 $date = getdate();
 $name .= $date[hours];
 $name .= $date[minutes];
 $name .= $date[seconds];
 $name .= $date[year];
 $name .= $date[mon];
 $name .= $date[mday];
?> 
```

注意：不要忘记文件的文件扩展名，或者您可以为照片生成随机字符串，但我不建议这样做。我还建议您在将文件上传到目录之前检查文件扩展名。

```
<?php 
if ((($_FILES["photo"]["type"] == "image/jpeg")
            || ($_FILES["photo"]["type"] == "image/pjpg"))
            && ($_FILES["photo"]["size"] < 100000000))
            {
                move_uploaded_file($_FILES["photo"]["tmp_name"], $target.$name);

                if(mysql_query("your query"))
                {
                    //success handling
                }
                else 
                {
                    //failed handling
                }
            }
            else
            {
                //error handling
            }
?> 
```

希望这可能会有所帮助。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2010-02-17T18:42:14.427

```
<form method="post" action="addMember.php" enctype="multipart/form-data">
    <p>
              Please Enter the Band Members Name.
            </p>
            <p>
              Band Member or Affiliates Name:
            </p>
            <input type="text" name="nameMember"/>
            <p>
              Please Enter the Band Members Position. Example:Drums.
            </p>
            <p>
              Band Position:
            </p>
            <input type="text" name="bandMember"/>
            <p>
              Please Upload a Photo of the Member in gif or jpeg format. The file name should be named after the Members name. If the same file name is uploaded twice it will be overwritten! Maxium size of File is 35kb.
            </p>
            <p>
              Photo:
            </p>
            <input type="hidden" name="size" value="350000">
            <input type="file" name="photo"> 
            <p>
              Please Enter any other information about the band member here.
            </p>
            <p>
              Other Member Information:
            </p>
<textarea rows="10" cols="35" name="aboutMember">
</textarea>
            <p>
              Please Enter any other Bands the Member has been in.
            </p>
            <p>
              Other Bands:
            </p>
            <input type="text" name="otherBands" size=30 />
            <br/>
            <br/>
            <input TYPE="submit" name="upload" title="Add data to the Database" value="Add Member"/>
          </form> 
```

**将其保存为 addMember.php**

```
<?php

//This is the directory where images will be saved
$target = "your directory";
$target = $target . basename( $_FILES['photo']['name']);

//This gets all the other information from the form
$name=$_POST['nameMember'];
$bandMember=$_POST['bandMember'];
$pic=($_FILES['photo']['name']);
$about=$_POST['aboutMember'];
$bands=$_POST['otherBands'];

// Connects to your Database
mysql_connect("yourhost", "username", "password") or die(mysql_error()) ;
mysql_select_db("dbName") or die(mysql_error()) ;

//Writes the information to the database
mysql_query("INSERT INTO tableName (nameMember,bandMember,photo,aboutMember,otherBands)
VALUES ('$name', '$bandMember', '$pic', '$about', '$bands')") ;

//Writes the photo to the server
if(move_uploaded_file($_FILES['photo']['tmp_name'], $target))
{

//Tells you if its all ok
echo "The file ". basename( $_FILES['photo']['name']). " has been uploaded, and your information has been added to the directory";
}
else {

//Gives and error if its not
echo "Sorry, there was a problem uploading your file.";
}
?> 
```

在上面的代码中有一个小错误，我修复了那个错误。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-05-20T16:54:26.847

添加以下内容可以避免文件名中的引号问题，例如

```
"freddy's pic.jpg" 
```

这在某些操作系统上是可以接受的。

前：

```
$pic=($_FILES['photo']['name']); 
```

后：

```
$pic=(mysql_real_escape_string($_FILES['photo']['name'])); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-16T17:19:43.820

如果要在表单中输入更多数据，只需通过 $_POST 访问提交的数据。

如果你有

```
<input type="text" name="firstname" /> 
```

你访问它

```
$firstname = $_POST["firstname"]; 
```

然后您可以更新您的查询行以读取

```
mysql_query("INSERT INTO dbProfiles (photo,firstname)
             VALUES('{$filename}','{$firstname}')"); 
```

**注意：**始终过滤和清理您的数据。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-16T17:39:09.053

你的部分：

```
$result = mysql_connect("localhost", "******", "*****") or die ("Could not save image name

Error: " . mysql_error());

mysql_select_db("project") or die("Could not select database");
mysql_query("INSERT into dbProfiles (photo) VALUES('".$_FILES['filep']['name']."')");
if($result) { echo "Image name saved into database

"; 
```

没有多大意义，您的连接不应该命名为 $result 但这是一个命名问题而不是编码问题。

什么是编码问题是 if($result)，如果您说无论插入查询失败还是成功都可以连接到数据库，您将输出“图像保存到数据库中”。

尝试添加做

```
$realresult = mysql_query("INSERT into dbProfiles (photo) VALUES('".$_FILES['filep']['name']."')"); 
```

并将 if($result) 更改为 $realresult

我怀疑您的查询失败了，也许您还有其他列或其他内容？

尝试复制/粘贴您的查询，替换“.$_FILES['filep']['name']。” 在您的查询浏览器中测试并运行它，看看它是否进入。

# python - 使用 Google App Engine 时出现 ImportError

> ID：450883
> 
> 赞同：1
> 
> 时间：2009-01-16T15:59:54.790
> 
> 标签：python, google-app-engine, import

当我将以下行添加到 Google 的 helloworld 示例中时：

```
 from reportlab.pdfgen import canvas 
```

我收到以下错误：

```
 <type 'exceptions.ImportError'>: No module named reportlab.pdfgen 
```

我可以从 python 控制台访问 reportlab.pdfgen 库。为什么我不能从谷歌的 dev_appserver 得到它？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-16T16:12:15.810

在本地复制模块工作。

从

```
Python\Lib\site-packages\reportlab 
```

至

```
helloworld\reportlab 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-16T16:12:56.387

我相信谷歌应用引擎不包括所有标准的 python 模块。我知道任何与 sockes 一起使用的东西都被禁用，例如 urllib.urlopen()。

# email - 使用外部 IP 地址访问内部网络资源

> ID：450894
> 
> 赞同：2
> 
> 时间：2009-01-16T16:01:36.770
> 
> 标签：email, networking

如何使用外部 IP 地址但从网络内部访问内部资源（电子邮件服务器/FTP 服务器）？

情况是许多用户每周有几天在办公室外工作，并且有笔记本电脑。我不希望他们每次进入办公室时都必须将连接详细信息从 217.xxx 更改为 10.0.0.x，然后在他们离开时再次更改。

我有外部访问工作，所以他们在路上可以使用 217.xxx IP 连接，但在办公室时它不起作用。

我们有一个路由器提供对网络的 NAT 访问以及用于 FTP、电子邮件等的不同服务器。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-16T16:42:32.647

这就是 DNS 的用途 - 您的外部 DNS 为名称提供 217.xxx 地址，而您的内部 DNS 返回 10.0.0.x IP 地址。客户端通过主机名访问资源，而不是 IP 地址，然后就完成了。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-16T16:07:31.530

除非您有过滤器禁止从内部客户端访问外部 NAT'ed 地址，否则我不明白为什么它不应该工作。

# delphi - Delphi 中的函数和过程（默认值和可选参数）

> ID：450897
> 
> 赞同：0
> 
> 时间：2009-01-16T16:01:58.750
> 
> 标签：delphi

编辑：

有没有更好的方法来做到这一点？

```
TPendingBets = class(TDataModule)
  private
  public
    function    GetBdy(out IdEvent : Integer                           )                                                           : Boolean; overload;
    function    GetBdy(out IdEvent : Integer; out idBetType : TBetTypes)                                                           : Boolean; overload;
    function    GetBdy(out IdEvent : Integer; out idBetType : TBetTypes; Out TotalOrgStake,Price : Double; out PriceError :Boolean): Boolean; overload;
  end;

implementation 
```

///////////////////

```
function    TPendingBets.GetBdy(out IdEvent : Integer ): Boolean;
var idBetType : TBetTypes;
    TotalOrgStake,Price : Double;
    PriceError :Boolean;
begin
   result :=  GetBdy(IdEvent,idBetType,TotalOrgStake,Price,PriceError);
end; 
```

///////////////////

```
function    TPendingBets.GetBdy(out IdEvent : Integer; out idBetType : TBetTypes): Boolean;
var TotalOrgStake,Price : Double;
    PriceError :Boolean;
begin
   result :=  GetBdy(IdEvent,idBetType,TotalOrgStake,Price,PriceError);
end; 
```

///////////////////

```
function    TPendingBets.GetBdy(out IdEvent : Integer; out idBetType : TBetTypes; Out TotalOrgStake,Price : Double; out PriceError :Boolean): Boolean;
begin
    result :=  false;
    if cdBdy.Eof = False then
    begin
       IdEvent   :=   cdBdy.FieldByName(IdEvent ).AsInteger);
       idBetType :=   TBetTypes(cdBdy.FieldByName(idBetType ).AsInteger);
       //.
       //.
       result := True;
    end;  
end; 
```

**笔记：**

由于我最初的问题不是很清楚，我已经删除了一部分

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-01-16T18:10:41.267

重载并不意味着函数中有 5 个*代码*副本。您可能有 5 个函数，但其​​中 4 个*只是*使用正确的参数调用主函数。

我一般不喜欢**输出**参数。您是否考虑过返回包含所有结果的记录？

```
Fn1Result = record
  A: Extended;
  B: Integer;
  C, D, E, F: Extended
  S: String;
end; 
```

然后像这样声明你的函数：

```
function Fn1: Fn1Result;
begin
  Fn1.A := C_ConstA;
  // etc. . . .
end; 
```

当然，我假设您没有使用输出参数作为输入。根据 Delphi 帮助：

> out 参数和可变参数一样，是通过引用传递的。但是，使用 out 参数时，引用变量的初始值会被传递给它的例程丢弃。out 参数仅用于输出；也就是说，它告诉函数或过程在哪里存储输出，但不提供任何输入。

我有一种有趣的感觉，您正在使用输出参数作为输入参数。不。如果您希望它们双向使用，请将 它们作为**var传递。**

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-16T17:03:33.587

我认为重载解决方案是一个很好的解决方案，至少它是一个。其他编程语言要求您声明具有不同名称的函数。

另一种方法可能是动态数组参数，例如：

```
type
  TExtendedDynArray = array of Extended;  // if not already declared elsewhere

function Fn1(out arr: TExtendedDynArray): Boolean; 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-16T17:17:44.760

除了 Uwe 写的（我同意重载在这里是一个更好的解决方案；赞成）之外，您永远不应该假定 out 参数在函数开始时具有任何值。这就是out的意思。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-16T17:30:17.493

您可以使用类似这样的重载函数

函数 Fn1(Out A:string; B:integer=5) : boolean; 超载;

函数 Fn1(Out A:string) : boolean; 超载;

您必须定义这两个功能。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-29T20:33:45.467

正如[Jim](https://stackoverflow.com/questions/450897/function-procedures-in-delphi-defaults-optional-parameters/451403#451403)所展示的，您不需要在重载时复制代码。

我不太喜欢将参数与默认值**和**重载混合使用，因为（不小心这样做）你会造成混乱。

通常，如果我必须支持很多语法：

1）我用**ALL PARAMETERS**定义了一个完整的签名。让我们称它为“大师”。

2）所有重载都调用那个。或者相互调用，但最后每个重载链都必须调用“主”链来执行任务。

对我来说，重载是“参数处理器”或“翻译器”。稍后，如果我需要修改主控行为，我会在“主控”上创建新参数（可以有默认值——事实上，大部分都有）。

如果我需要新参数的重载，我会创建一个新参数并将其简单地传递给“主”过程。副作用是旧的继续表现相同。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-16T19:31:14.753

默认值只能用于输入参数（即：按值和常量）。对于 var 和 out 参数，默认值是不可能的。

正如 Jim 已经指出的那样：您可以通过让大多数重载函数调用接受所有参数的函数来避免重复代码，因此它们只是原始函数的薄层。从 Delphi 2005 开始，您可以将它们声明为内联，因此编译器实际上可能会生成更高效的代码。

# html - 如何使 div 不大于其内容？

> ID：450903
> 
> 赞同：2359
> 
> 时间：2009-01-16T16:03:07.467
> 
> 标签：html, css, width

我的布局类似于：

```
<div>
    <table>
    </table>
</div> 
```

我希望`div`只扩展到我的范围`table`。

* * *

## 回答 #1

> 赞同：2685
> 
> 时间：2010-10-12T16:47:57.150

解决方案是将您的设置`div`为`display: inline-block`.

* * *

## 回答 #2

> 赞同：356
> 
> 时间：2009-01-16T16:40:24.180

你想要一个块元素，它具有 CSS 所称的收缩以适应宽度，而规范没有提供获得这种东西的幸运方式。在 CSS2 中，缩小以适应不是目标，而是意味着处理浏览器“必须”凭空获得宽度的情况。这些情况是：

*   漂浮
*   绝对定位元素
*   内联块元素
*   表格元素

当没有指定宽度时。我听说他们想在 CSS3 中添加你想要的东西。现在，请使用上述方法之一。

不直接公开该功能的决定可能看起来很奇怪，但这是有充分理由的。它是昂贵的。Shrink-to-fit 意味着至少要格式化两次：在知道元素宽度之前不能开始格式化元素，并且不能计算不经过整个内容的宽度。另外，人们不需要像人们想象的那样经常收缩以适应元素。为什么你的桌子周围需要额外的 div？也许表格标题就是您所需要的。

* * *

## 回答 #3

> 赞同：249
> 
> 时间：2009-01-16T16:41:43.363

我认为使用

```
display: inline-block; 
```

可以，但是我不确定浏览器的兼容性。

* * *

另一种解决方案是将您包装`div`在另一个中`div`（如果您想保持块行为）：

HTML：

```
<div>
    <div class="yourdiv">
        content
    </div>
</div> 
```

CSS：

```
.yourdiv
{
    display: inline;
} 
```

* * *

## 回答 #4

> 赞同：246
> 
> 时间：2012-05-12T23:39:02.783

`display: inline-block`为您的元素添加额外的边距。

我会推荐这个：

```
#element {
    display: table; /* IE8+ and all other modern browsers */
} 
```

**奖励：**您现在还可以`#element`通过添加`margin: 0 auto`.

* * *

## 回答 #5

> 赞同：164
> 
> 时间：2013-05-27T00:41:54.347

你可以试试[`fit-content`](https://developer.mozilla.org/en-US/docs/Web/CSS/width)（CSS3）：

```
div {
  width: fit-content; 
  /* To adjust the height as well */ 
  height: fit-content;
} 
```

*   [浏览器支持](http://caniuse.com/#feat=intrinsic-width)
*   [规格](http://www.w3.org/TR/css3-sizing/#fit-content)

* * *

## 回答 #6

> 赞同：104
> 
> 时间：2016-05-10T20:16:25.937

有两个更好的解决方案

1.  `display: inline-block;`

    或者

2.  `display: table;`

**这两个`display:table;`更好，**因为`display: inline-block;`增加了额外的利润。

因为`display:inline-block;`您可以使用负边距方法来修复额外的空间

* * *

## 回答 #7

> 赞同：90
> 
> 时间：2012-01-11T12:01:10.487

对我有用的是：

```
display: table; 
```

在`div`. （在**Firefox**和**Google Chrome**上测试）。

* * *

## 回答 #8

> 赞同：85
> 
> 时间：2010-08-25T19:36:26.493

```
display: -moz-inline-stack;
display: inline-block;
zoom: 1;
*display: inline; 
```

[Foo Hack – 对内联块样式的跨浏览器支持 (2007-11-19)](http://foohack.com/2007/11/cross-browser-support-for-inline-block-styling/)。

* * *

## 回答 #9

> 赞同：48
> 
> 时间：2009-01-16T16:08:27.237

不知道这会出现在什么上下文中，但我相信 CSS 样式的属性`float`或者`left`会`right`产生这种效果。另一方面，它也会有其他副作用，例如允许文本在其周围浮动。

如果我错了，请纠正我，我不是 100% 确定，目前无法自己测试。

* * *

## 回答 #10

> 赞同：44
> 
> 时间：2013-12-11T13:07:16.147

你的问题的答案在未来我的朋友......

即“内在”是最新的 CSS3 更新

```
width: intrinsic; 
```

不幸的是**IE**落后了所以它还不支持它

有关它的更多信息：[CSS 内部和外部大小调整模块第 3 级](http://dev.w3.org/csswg/css-sizing/)，[*我可以使用吗？*：内在和外在尺寸](http://caniuse.com/intrinsic-width)。

现在你必须满足`<span>`或`<div>`设置为

```
display: inline-block; 
```

* * *

## 回答 #11

> 赞同：39
> 
> 时间：2011-08-26T08:14:09.403

```
width:1px;
white-space: nowrap; 
```

对我来说很好:)

* * *

## 回答 #12

> 赞同：37
> 
> 时间：2009-01-16T16:13:07.183

与 CSS2 兼容的解决方案是使用：

```
.my-div
{
    min-width: 100px;
} 
```

您还可以浮动您的 div，这将迫使它尽可能小，但如果您的 div 内的任何内容浮动，您将需要使用[clearfix ：](http://www.webtoolkit.info/css-clearfix.html)

```
.my-div
{
    float: left;
} 
```

* * *

## 回答 #13

> 赞同：30
> 
> 时间：2017-06-17T05:57:07.907

**好的，**在许多情况下，您甚至不需要像默认的 div`height`和`width`auto 那样做任何事情，但如果不是您的情况，应用`inline-block`display 会为您工作...看看我为您创建的代码就可以了你在找什么：

```
div {
  display: inline-block;
}
```

```
<div>
  <table>
    <tr>
      <td>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Morbi ultrices feugiat massa sed laoreet. Maecenas et magna egestas, facilisis purus quis, vestibulum nibh.</td>
      <td>Nunc auctor aliquam est ac viverra. Sed enim nisi, feugiat sed accumsan eu, convallis eget felis. Pellentesque consequat eu leo nec pharetra. Aenean interdum enim dapibus diam.</td>
      <td>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Morbi ultrices feugiat massa sed laoreet. Maecenas et magna egestas, facilisis purus quis, vestibulum nibh.</td>
    </tr>
  </table>
</div>
```

* * *

## 回答 #14

> 赞同：28
> 
> 时间：2018-06-08T00:04:24.983

这已在评论中提到，并且很难在其中一个答案中找到，因此：

如果您`display: flex`出于任何原因使用，您可以改为使用：

```
div {
    display: inline-flex;
} 
```

[这也得到了跨浏览器的广泛支持。](https://caniuse.com/#search=inline-flex)

* * *

## 回答 #15

> 赞同：24
> 
> 时间：2019-07-11T03:19:05.467

你可以试试这段代码。按照 CSS 部分中的代码进行操作。

```
div {
  display: inline-block;
  padding: 2vw;
  background-color: green;
}

table {
  width: 70vw;
  background-color: white;
}
```

```
<div>
    <table border="colapsed">
      <tr>
        <td>Apple</td>
        <td>Banana</td>
        <td>Strawberry</td>
      </tr>
      <tr>
        <td>Apple</td>
        <td>Banana</td>
        <td>Strawberry</td>
      </tr>
      <tr>
        <td>Apple</td>
        <td>Banana</td>
        <td>Strawberry</td>
      </tr>

    </table>
</div>
```

* * *

## 回答 #16

> 赞同：23
> 
> 时间：2018-04-21T16:11:32.750

只需将样式放入您的 CSS 文件

```
div { 
    width: fit-content; 
} 
```

* * *

## 回答 #17

> 赞同：21
> 
> 时间：2020-08-31T09:30:01.277

尝试使用`width: max-content`属性通过它的内容大小调整 div 的宽度。

试试这个例子，

```
<!DOCTYPE html>
<html>
<head>
<style>
div.ex1 {
  width:500px;
  margin: auto;
  border: 3px solid #73AD21;
}

div.ex2 {
  width: max-content;
  margin: auto;
  border: 3px solid #73AD21;
}
</style>
</head>
<body>

<div class="ex1">This div element has width 500px;</div>
<br>
<div class="ex2">Width by content size</div>

</body>
</html> 
```

* * *

## 回答 #18

> 赞同：20
> 
> 时间：2011-08-03T16:59:09.537

```
<table cellpadding="0" cellspacing="0" border="0">
    <tr>
        <td>
            <div id="content_lalala">
                this content inside the div being inside a table, needs no inline properties and the table is the one expanding to the content of this div =)
            </div>
        </td>
    </tr>
</table> 
```

I know people don't like tables sometimes, but I gotta tell you, I tried the css inline hacks, and they kinda worked in some divs but in others didn't, so, it was really just easier to enclose the expanding div in a table...and...it can have or not the inline property and still the table is the one that's gonna hold the total width of the content. =)

* * *

## 回答 #19

> 赞同：20
> 
> 时间：2014-10-05T09:36:06.453

您可以简单地使用`display: inline;`(或`white-space: nowrap;`) 来完成。

希望这个对你有帮助。

* * *

## 回答 #20

> 赞同：20
> 
> 时间：2016-10-14T16:00:28.110

您可以使用`inline-block`@user473598，但请注意旧版浏览器..

```
/* Your're working with */
display: inline-block;

/* For IE 7 */
zoom: 1;
*display: inline;

/* For Mozilla Firefox < 3.0 */
display:-moz-inline-stack; 
```

Mozilla 根本不支持 inline-block，但它们几乎`-moz-inline-stack`相同

`inline-block`围绕显示属性 的一些跨浏览器： [https ://css-tricks.com/snippets/css/cross-browser-inline-block/](https://css-tricks.com/snippets/css/cross-browser-inline-block/)

您可以在以下位置看到一些具有此属性的测试：[https ://robertnyman.com/2010/02/24/css-display-inline-block-why-it-rocks-and-why-it-sucks/](https://robertnyman.com/2010/02/24/css-display-inline-block-why-it-rocks-and-why-it-sucks/)

* * *

## 回答 #21

> 赞同：15
> 
> 时间：2016-03-23T09:45:09.703

一个工作演示在这里-

```
.floating-box {
    display:-moz-inline-stack;
    display: inline-block;

    width: fit-content; 
    height: fit-content;

    width: 150px;
    height: 75px;
    margin: 10px;
    border: 3px solid #73AD21;  
}
```

```
<h2>The Way is using inline-block</h2>

Supporting elements are also added in CSS.

<div>
   <div class="floating-box">Floating box</div>
   <div class="floating-box">Floating box</div>
   <div class="floating-box">Floating box</div>
   <div class="floating-box">Floating box</div>
   <div class="floating-box">Floating box</div>
   <div class="floating-box">Floating box</div>
   <div class="floating-box">Floating box</div>
   <div class="floating-box">Floating box</div>
</div>
```

* * *

## 回答 #22

> 赞同：12
> 
> 时间：2016-07-14T19:33:56.260

我的 CSS3 flexbox 解决方案有两种风格：顶部的一个表现得像一个跨度，底部的一个表现得像一个 div，在包装器的帮助下占据所有宽度。它们的类分别是“top”、“bottom”和“bottomwrapper”。

```
body {
    font-family: sans-serif;
}
.top {
    display: -webkit-inline-flex;
    display: inline-flex;
}
.top, .bottom {
    background-color: #3F3;
    border: 2px solid #FA6;
}
/* bottomwrapper will take the rest of the width */
.bottomwrapper {
    display: -webkit-flex;
    display: flex;
}
table {
    border-collapse: collapse;
}
table, th, td {
    width: 280px;
    border: 1px solid #666;
}
th {
    background-color: #282;
    color: #FFF;
}
td {
    color: #444;
}
th, td {
    padding: 0 4px 0 4px;
}
```

```
Is this
<div class="top">
	<table>
        <tr>
            <th>OS</th>
            <th>Version</th> 
        </tr>
        <tr>
            <td>OpenBSD</td>
            <td>5.7</td> 
        </tr>
        <tr>
            <td>Windows</td>
            <td>Please upgrade to 10!</td> 
        </tr>
    </table>
</div>
what you are looking for?
<br>
Or may be...
<div class="bottomwrapper">
    <div class="bottom">
    	<table>
            <tr>
                <th>OS</th>
                <th>Version</th> 
            </tr>
            <tr>
                <td>OpenBSD</td>
                <td>5.7</td> 
            </tr>
            <tr>
                <td>Windows</td>
                <td>Please upgrade to 10!</td> 
            </tr>
        </table>
    </div>
</div>
this is what you are looking for.
```

* * *

## 回答 #23

> 赞同：11
> 
> 时间：2012-06-06T09:54:56.863

篡改 Firebug，我发现了`-moz-fit-content`完全符合 OP 要求的属性值，可以按如下方式使用：

```
width: -moz-fit-content; 
```

虽然它只适用于 Firefox，但我找不到其他浏览器（如 Chrome）的等效项。

* * *

## 回答 #24

> 赞同：11
> 
> 时间：2017-02-22T11:04:51.290

```
<div class="parentDiv" style="display:inline-block">
    // HTML elements
</div> 
```

这将使父 div 宽度与最大元素宽度相同。

* * *

## 回答 #25

> 赞同：11
> 
> 时间：2017-06-21T20:48:46.103

试试`display: inline-block;`。要使其跨浏览器兼容，请使用以下 css 代码。

```
div {
  display: inline-block;
  display:-moz-inline-stack;
  zoom:1;
  *display:inline;
  border-style: solid;
  border-color: #0000ff;
}
```

```
<div>
  <table>
    <tr>
      <td>Column1</td>
      <td>Column2</td>
      <td>Column3</td>
    </tr>
  </table>
</div>
```

* * *

## 回答 #26

> 赞同：9
> 
> 时间：2020-11-24T23:12:22.843

```
div{
width:fit-content;
}
```

```
<div>
    <table>
    </table>
</div>
```

* * *

## 回答 #27

> 赞同：9
> 
> 时间：2021-10-18T14:35:01.173

只需将宽度和高度设置为适合内容。这很简单。

```
div {

    width: fit-content;
    height: fit-content;
    padding: 10px;

} 
```

> 我正在添加**填充：10px；**. 如果省略，div 元素将完全贴在表格上，看起来有点笨拙。填充将在元素的边框和它的内容之间创建给定的空间。但这是你的愿望，不是强制性的。

* * *

## 回答 #28

> 赞同：9
> 
> 时间：2021-04-06T02:54:57.553

```
 .outer{
          width:fit-content;   
          display: flex;
          align-items: center;
    }
    .outer .content{
         width: 100%;
    }

<div class=outer>
    <div class=content>
       Add your content here

    </div>

</div> 
```

* * *

## 回答 #29

> 赞同：7
> 
> 时间：2012-08-25T18:54:02.907

我通过在标签内添加标签并将 CSS 格式从外部标签移动到新的内部标签来解决了类似的问题（我不想使用`display: inline-block`，因为项目居中）。如果不适合您，则将其作为另一个替代想法扔掉。`span``div``div``span``display: inline block`

* * *

## 回答 #30

> 赞同：7
> 
> 时间：2016-09-30T05:00:55.360

**`div`**我们可以在元素 上使用以下两种方式中的任何一种：

```
display: table; 
```

或者，

```
display: inline-block; 
```

我更喜欢使用`display: table;`，因为它自己处理所有额外的空格。虽然`display: inline-block`需要一些额外的空间固定。

* * *

## 回答 #31

> 赞同：6
> 
> 时间：2016-12-06T19:36:51.180

```
div{
  width:auto;
  height:auto;
} 
```

* * *

## 回答 #32

> 赞同：5
> 
> 时间：2014-09-29T06:08:24.327

修订（如果您有多个孩子则有效）：您可以使用 jQuery（查看 JSFiddle 链接）

```
var d= $('div');
var w;

d.children().each(function(){
 w = w + $(this).outerWidth();
 d.css('width', w + 'px')
}); 
```

不要忘记包含 jQuery...

[在这里查看 JSfiddle](https://jsfiddle.net/wyx2mnyy/)

* * *

## 回答 #33

> 赞同：5
> 
> 时间：2015-11-04T03:24:41.010

如果你有容器断线，经过几个小时寻找一个好的 CSS 解决方案却没有找到，[我现在使用](https://stackoverflow.com/a/33511762/274502)jQuery 代替：

```
$('button').click(function(){

  $('nav ul').each(function(){

    $parent = $(this).parent();

    $parent.width( $(this).width() );

  });
});
```

```
nav {
  display: inline-block;
  text-align: left; /* doesn't do anything, unlike some might guess */
}
ul {
  display: inline;
}

/* needed style */
ul {
  padding: 0;
}
body {
  width: 420px;
}

/* just style */
body {
  background: #ddd;
  margin: 1em auto;
}
button {
  display: block;
}
nav {
  background: #bbb;
  margin: 1rem auto;
  padding: 0.5rem;
}
li {
  display: inline-block;
  width: 40px;
  height: 20px;
  border: solid thin #777;
  margin: 4px;
  background: #999;
  text-align: center;
}
```

```
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>

<button>fix</button>

<nav>
  <ul>
    <li>3</li>
    <li>.</li>
    <li>1</li>
    <li>4</li>
  </ul>
</nav>

<nav>
  <ul>
    <li>3</li>
    <li>.</li>
    <li>1</li>
    <li>4</li>
    <li>1</li>
    <li>5</li>
    <li>9</li>
    <li>2</li>
    <li>6</li>
    <li>5</li>
    <li>3</li>
    <li>5</li>
  </ul>
</nav>
```

* * *

## 回答 #34

> 赞同：4
> 
> 时间：2013-03-07T17:37:59.793

我试过`div.classname{display:table-cell;}`了，它奏效了！

* * *

## 回答 #35

> 赞同：4
> 
> 时间：2018-07-29T22:18:23.980

您可以`display: flex`用于父元素

```
#parentElement {
   display: flex;
   flex-direction: column;
   align-items: flex-start;
 } 
```

* * *

## 回答 #36

> 赞同：3
> 
> 时间：2016-10-21T17:22:09.353

我会设置`padding: -whateverYouWantpx;`

* * *

## 回答 #37

> 赞同：3
> 
> 时间：2019-06-04T07:35:52.127

我有一个`span`内部的`div`，只是设置`margin: auto`到容器`div`为我工作。

* * *

## 回答 #38

> 赞同：1
> 
> 时间：2015-05-24T15:32:56.627

Personnaly，我只是这样做：

HTML 代码：

```
<div>
    <table>
    </table>
</div> 
```

CSS 代码：

```
div {
    display: inline;
} 
```

如果你在你的 div 上应用一个浮点数，它也可以工作，但很明显，你需要在下一个 HTML 元素上应用一个“清除两个”CSS 规则。

* * *

## 回答 #39

> 赞同：1
> 
> 时间：2016-06-23T19:20:12.963

简单地

```
<div style="display: inline;">
    <table>
    </table>
</div> 
```

* * *

## 回答 #40

> 赞同：1
> 
> 时间：2019-03-26T14:48:36.197

如果我们定义一个全局变量并将其用于两者会怎样。

```
:root {
    --table-width: 400px;
}

.container{
     width:var(--table-width);
     border: 1px solid black;   // easy visualization
}
.inner-table {
     width:var(--table-width);
     border: 1px solid red;   // easy visualization
}
```

```
<div class="container">
    <table class="inner-table">
       <tr>
           <td>abc</td>
       </tr>
    </table>
</div>
```

* * *

## 回答 #41

> 赞同：-3
> 
> 时间：2012-04-29T21:01:37.613

这似乎对我在所有浏览器上都有效。示例是我在网上和时事通讯中使用的实际广告。只需更改 div 的内容。它将根据您指定的填充量进行调整和收缩。

```
<div style="float:left; border: 3px ridge red; background: aqua; padding:12px">
    <font color=red size=4>Need to fix a birth certificate? Learn <a href="http://www.example.com">Photoshop in a Day</a>!
    </font>
</div> 
```

* * *

## 回答 #42

> 赞同：-4
> 
> 时间：2019-09-14T16:02:34.417

您可以使用`height: 100%`和宽度供您选择。这使得 div 不大于其内容。

# java - 学习的重要框架/工具

> ID：450906
> 
> 赞同：10
> 
> 时间：2009-01-16T16:04:02.317
> 
> 标签：java, frameworks

海亚，

“Java有什么特别之处？”这个问题的常用答案。是“工具和框架”。我想这是正确的。当我看到所有让您作为开发人员的生活更轻松的工具和框架时，我惊呆了。

我的 Java 技能并不完美，但平均水平不错，我仍在努力。例如，我已经开始学习 Ant，我不想错过它。这很棒。与休眠相同。现在我问自己接下来应该学什么。我想为自己积累经验，尤其是我的简历。不幸的是，它有很多。每个人都在谈论它，比如 Spring、Struts、JavaServer Faces、Maven，......

什么在现实世界中被广泛使用？除了 Ant 或 Subversion/CVS 之外，还有哪些工具很重要？学习被接受为“真正的 Java 程序员”并获得有趣的工作需要什么框架？;-)

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-01-16T16:56:58.123

如果我们谈论的是适销性，那么理想情况下，您希望成为能够在生产应用程序的任何层都高效的开发人员。所以了解每一层的一些东西。

*   **MVC：** Struts、Spring MVC。
*   **数据访问：** Hibernate、iBatis、JPA。
*   **IOC：** Spring（用于集成大型系统的huuuuge。如果可以，请学习Spring所基于的AOP原理）
*   **应用服务器：** Tomcat、JBoss。
*   **测试：** JUnit
*   **介绍：** JSF、JSP。

此外，不要忽视您需要了解的非 Java 技术：

*   SQL - 因为您*需要*直接与数据库对话
*   HTML
*   JQuery - 永远不要低估简洁 UI 功能的重要性。对于大多数用户来说，这是他们理解的唯一部分。

如果我必须从这个列表中选择一件事，我会选择春天。如果选择两个，我会选择 Spring 和 JQuery。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-01-16T16:11:02.130

如果您想被视为专家级 Java 程序员，那么了解标准 Java 类库是无可替代的。我见过太多 Java 程序员的例子，甚至是经验丰富的程序员，他们从标准类库中重新实现了一些东西，因为他们不知道他们在那里。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-01-16T16:11:48.400

JUnit 是需要学习的最重要的 Java 框架。它不仅是一个用于单元测试的有价值的工具，它还教你一个框架应该是什么：小而专注于做好一件事。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-01-16T16:07:09.520

Maven 值得学习，但我建议使用 Spring。 [Spring](http://springsource.org)将使您的编码生活变得更加简单。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-01-16T16:13:28.053

[Apache Commons](http://commons.apache.org/)项目提供了许多有用的工具，可以避免重新发明轮子。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-01-16T16:19:55.547

+1 春天。

Struts 1.x 不是最新的炒作，但可能值得了解，因为已经用它编写了数百万行代码。如果您从事咨询业务，那么您总有一天会遇到它。

另外，如果你正在提高你的 Java 技能，我绝对推荐 Joshua Bloch 的书“Effective Java, 2nd edition”。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-01-17T08:53:00.673

两个建议，有点离题：

1.  除非你真的知道并记得使用它，否则永远不要在你的简历上放一些东西。我遇到了太多将 COM 放在简历上的候选人，他们甚至不知道首字母缩略词代表什么或如何定义它。

2.  恕我直言，快速找到答案、学习和理解的能力远远大于特定知识。今天是 Java 和 Spring，明天是 Ruby on Rails。谁在乎。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-01-16T16:06:25.417

Eclipse 是必须的。它不仅是一个很棒的 IDE，而且它与其他工具（SVN、Ant...）的集成非常好。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-01-16T16:55:17.907

我强烈推荐[Find Bugs](http://findbugs.sourceforge.net/)工具。它是一种静态代码分析工具，可以报告代码中可能存在的错误。Eclipse 的插件非常棒，这也是我不使用其他 IDE 的主要原因之一。

# sharepoint - 通过 FTP 将文件上传到 Sharepoint 文档库

> ID：450915
> 
> 赞同：8
> 
> 时间：2009-01-16T16:06:16.167
> 
> 标签：sharepoint, upload, ftp

我想知道是否有人知道如何或是否可以通过 FTP 将文件上传到共享点 (v3/MOSS) 文档库。我知道使用 webdav 是可能的。如果有可能这甚至得到微软的支持吗？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-01-16T16:08:49.467

我不这么认为。我认为你的选择是：

1.  HTTP（通过上传页面）
2.  网络视频
3.  网页服务
4.  对象模型

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-16T18:11:26.630

您可以将驱动器映射到 SharePoint 文档库，例如 \\serveraddress.domain.com\Documents。所以我会尝试在您的 FTP 服务器上映射一个驱动器，然后确保通过 FTP 传入的文件被发送到该驱动器。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-04-20T18:11:44.997

大编辑：你们中有人知道如何上传到 SharePoint (WSS) 吗？我尝试过驱动器映射，然后使用[Robocopy](http://technet.microsoft.com/en-us/magazine/2006.11.utilityspotlight.aspx)和 Synctoy 来复制文件，认为工具可能会提供更大的控制（即**复制日期已修改**控制）。据我了解，文件实际上作为数据库对象存储在 SharePoint 中，因此 SharePoint 视图在新用户希望看到文件属性的文档库中显示数据库对象（SQL 对象的）属性。这些文件属性仍然存在！他们只需要被不同的观点发现。我特别喜欢 SharePoint 文档库的映射网络驱动器视图。文件属性对我的团队来说非常重要，所以我们一开始就担心这一点。不过，作为意见说明，显示不正确属性的默认视图简直令人讨厌！

我们提出的将大文件迁移到 SharePoint的**最佳解决方案是映射网络驱动器，然后使用**[SourceForge 提供的名为 FreeFileSync](http://sourceforge.net/projects/freefilesync/)的工具来移动文件和文件夹。这很棒，因为它会产生详细的错误消息并提供大量控制，尤其是对于 SharePoint 尝试阻止特定文件名或文件扩展名的实例。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-17T04:10:19.807

将 FTP 直接导入 SharePoint 不是您的选择之一。您需要运行一个计时器作业来检查您的 FTP 目录并上传到文档库。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2013-05-23T21:05:05.840

是的，有可能。

WebDav Redirector 允许您通过UNC 路径访问webdav 资源（包括Share Point），即\yourspserver\site\doclib。IIS FTP 服务器接受 UNC 路径作为虚拟目录的后备存储。

在您的 ftp 服务器上，右键单击 IIS 管理器中的 ftp 站点并选择“添加虚拟目录”。为其命名并为物理路径指定共享点 unc 路径。您需要将“连接身份”用户设置为有权访问您要连接的共享点文件夹的域用户。

连接到 ftp 文件夹，您应该能够“cd”进入目录并毫无问题地放置/获取文件（我自己确认了）。唯一需要注意的是 IISFTP 的一个古老的错误/功能，它不会在 ls/dir 命令列表中显示虚拟目录。解决方法是创建一个反映虚拟目录位置的物理文件夹。例如，如果您的 ftp 根目录是 c:\inetpub\ftproot，那么您需要在此位置创建一个与您的虚拟目录名称匹配的目录。然后它将显示在 ls/dir 列表中，但 cd 命令仍将移动到虚拟目录，而不是物理目录。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2020-10-18T23:01:20.630

[您可以使用Couchdrop](http://couchdrop.io)直接通过 SFTP/FTP 进入您的 SharePoint 文档库。它将您的 SharePoint 变成一个本地 SFTP/FTP 服务器，您可以创建其他用户等。如果您需要帮助而不是乐于提供帮助，请大声说出来。

全面披露：我代表 Couchdrop

# windows - 数据库/Web 服务器作为虚拟机与裸机？

> ID：450917
> 
> 赞同：1
> 
> 时间：2009-01-16T16:06:24.887
> 
> 标签：windows, database, performance, virtualization

我管理一个数据库 (Oracle 8i) 和 Web 服务器 (IIS)，平均可容纳大约 50 个并发用户，理论上限制为 100 个并发用户。中级系统。

我们刚刚获得了双插槽四核 XEON - 16GB RAM - SAS-RAID-10 野兽，我正在探索将这两个独立服务器合并到两个虚拟机中的可能性，这两个虚拟机都在新服务器上运行（Server 2009 Hyper -V)。

1) 一般来说，在一台大型服务器上将数据库和 Web 服务器作为虚拟机运行与在两个单独的较慢的机器上运行它们的性能损失（以及任何陷阱和隐藏的后果）是什么？对于一个永远不需要扩展的中级系统来说，这是一个很大的 NO-NO 还是值得尝试的东西？

2) 仅虚拟化数据库服务器的一般性能损失（百分比）和陷阱是什么？我们运行 Oracle 8i（但正在考虑迁移到 MS SQL Server）。

3）如果只有压力测试可以确定一个合理的答案，那么测试这些场景（工具/配置）的最简单方法是什么。

提前感谢任何慷慨的知识分享。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-16T16:32:48.797

如果您希望这样做，我会查看 Microsoft 的网站以及如何做到这一点的最佳实践。Deep Fried Bytes 上有一个播客，其中讨论了 Microsoft.com 网站是如何设置为使用虚拟服务器的，以及他们如何实施虚拟服务器的一些实践。他们似乎对如何运行它没有性能损失，但我不确定细节（它还谈到了他们如何像一个真正的组织那样使用服务器虚拟化，而不是一个可以无限量投资的公司一个问题）。

我相信这是播客：

[http://deepfriedbytes.com/podcast/episode-8-behind-the-scenes-at-microsoft-com/](http://deepfriedbytes.com/podcast/episode-8-behind-the-scenes-at-microsoft-com/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-16T16:12:24.827

关于数据库，请参阅以下问题：
[虚拟化 SQL Server：为什么不呢？](https://stackoverflow.com/questions/149318/virtualized-sql-server-why-not)

请注意，这是特定于 sql server 的，但许多相同的原则也适用于 oracle。

对于 Web 服务器，虚拟化是一个好主意。它可以更容易地提高可靠性和可扩展性。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-24T18:33:39.447

请注意，Oracle 对在虚拟机中运行有自己的指导方针。

我使用的产品在后端使用 Oracle，对于大量使用，VM 的开销对其产生了负面影响。

8i 已经过了 EOL，并且在虚拟化成为大事之前就已经存在，因此在迁移到虚拟化时迁移到新版本的 Oracle 也可能是一个不错的计划。

有关 VM 中 11g 的 Oracle 博客文章 - [http://blogs.oracle.com/MingMan/2007/11/oracle_database_11g_successful.html](http://blogs.oracle.com/MingMan/2007/11/oracle_database_11g_successful.html)

如果您担心时间问题，还要注意管理程序中已知的时钟漂移问题，以及可用的修复程序（来自操作系统或虚拟化供应商）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-16T21:13:47.403

我认为在您的并发用户连接级别和机器的功能上，您不会在 VM 上运行 SQL Server 时遇到太多性能问题。

我们混合了 VMWare ESX 虚拟机和裸机操作系统的运行应用程序、Web 和 DB 服务器，毫无疑问，负载最重的 DBMS 系统位于裸机机器（Quad proc 四核等）上。然而，所有的小家伙都生活在虚拟机上，我们没有发现任何问题（即使使用基于 GigE 的 iSCSI）。

需要考虑的一件事是，您不会从像这样的单一设置中获得任何容错，因为 CPU 故障会导致整个机器崩溃，从而炸毁整个应用程序。

有关 SQL Server HA 和 Hyper-V 的更多信息，仅供参考：http: [//blogs.technet.com/andrew/archive/2008/11/10/sql-server-2008-hyper-v-and-high-availability。 aspx](http://blogs.technet.com/andrew/archive/2008/11/10/sql-server-2008-hyper-v-and-high-availability.aspx)

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-01-16T16:28:14.827

我最近看到[一篇关于虚拟化安全的文章](http://pandalabs.pandasecurity.com/archive/Virtualization-Security-Part-2.aspx)。我认为这里值得一提。

# visual-studio - How to make a visual studio add-in that cannot be unloaded?

> ID：450933
> 
> 赞同：0
> 
> 时间：2009-01-16T16:09:38.420
> 
> 标签：visual-studio, visual-c++, add-in

I'm writing a Visual Studio add-in using C/C++. I am not familiar with the COM architecture. In fact I'm learning Windows programming.

I can see an OnDisconnect() call back into my add-in. I tried returning S_FALSE, but that does not seem to stop the add-in from being unloaded.

So my questions is, is it possible to make an add-in that cannot be unloaded (either through the Tools menu or programatically), and if yes, will some magic return value from OnDisconnect() do the job, or some other trick is required?

I also saw another [question](https://stackoverflow.com/questions/346674/visual-studio-and-add-in-unloading) that asks exactly the opposite. From the answer, it seems that the DLL still resides in the memory when an add-in is unloaded. So maybe there is a way to reload the add-in as soon as it is unloaded?

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-18T23:59:33.940

I don't know of any way to do this. If you really need functionalty that cannot be unloaded while VS is running, you should write a package instead of an add-in.

# jquery - 使用 jQuery tablesorter 对 mm/yy 日期进行排序

> ID：450936
> 
> 赞同：6
> 
> 时间：2009-01-16T16:10:42.070
> 
> 标签：jquery, tablesorter

我正在使用 jquery tablesorter 插件对表进行排序。在我表中的列中，以 mm/yy 格式显示日期。

```
<tr>
    <td class="col-name">...</td>
    ...
    <td rel="2000" class="col-dob">10/00</td>
    ...
</tr>
<tr>
    <td class="col-name">...</td>
    ...
    <td rel="1986" class="col-dob">11/86</td>
    ...
</tr> 
```

笔记：

*   每个单元格都有一个独特的类
*   日期以 mm/yy 格式显示
*   带日期的单元格也接收年份

我的jQuery代码如下：

```
// add parser through the tablesorter addParser method
$.tablesorter.addParser({
        // set a unique id
        id: 'user-birthdate',
        is: function(s) {
                // return false so this parser is not auto detected
                return false;
        },
        format: function(s) {
                // format your data for normalization

                var dateSplit = s.split('/');

                if(2 !== dateSplit.length)
                        return 0;

                return new Date(dateSplit[1], dateSplit[0], 1);
        },
        // set type, either numeric or text
        type: 'numeric'
});

myClass.init = function() {
        $('.module .user table').tablesorter({
                sortList: [[0,0]],     
             widgets: ['zebra'],
                headers: {
                        5: {
                                sorter:'user-birthdate'
                        }
                }
        });
}

myClass.init(); 
```

我的问题是 tableSorter 将 00 解释为 1900 年而不是 2000 年，因此排序的数据不正确。

任何线索我该如何解决这个问题？我正在使用 jQuery 1.2.6 和最新版本的 tablesorter。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-01-17T05:12:09.700

我发现，tablesorter 文档通常没有什么帮助。它*看起来*说了很多，但缺乏细节。

在这种情况下，它不会告诉您解析器的函数签名。幸运的是，您可以阅读[未缩小的代码](http://tablesorter.com/jquery.tablesorter.js)来找到它。

在那里，我们发现`metadata`解析器这样做：

```
format: function(s,table,cell) { 
```

这意味着您可以将格式方法调整为：

```
format: function(s, table, cell) {
    // format your data for normalization

    var dateSplit = s.split('/');
    var year = $(cell).attr('rel');

    if(2 !== dateSplit.length)
        return 0;

    return new Date(year, dateSplit[0], 1);
}, 
```

或者至少与此类似。我还没有实际测试过这个。但它至少应该非常接近。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-16T16:15:55.710

我想你会发现你的问题是 Date 构造函数和你传递的 2 位数年份字符串，没有消除歧义：`new Date(dateSplit[1], dateSplit[0], 1);`

我认为您不能（轻松）在解析器中基于 s 访问 rel 。s 是否包含单元格的全部内容？你可以在单元格中的数据中做一些事情，比如：`<span style="display : none">CC</span>MM/YY`，去掉标签，然后在你的解析中将 CC 和 YY 结合起来吗？

# c# - C# 的 Wiki 渲染引擎？像红布，蓝布，或者像样的东西

> ID：450937
> 
> 赞同：3
> 
> 时间：2009-01-16T16:10:46.033
> 
> 标签：c#, wiki

我们在 Ruby 中使用了 redcloth 和 bluecloth wiki 渲染器，基本上你可以做这样的事情......

html = RedCloth.to_html(wiki_content)

噗，你得到了 HTML。

C#/.NET 有什么东西吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2010-04-23T17:55:34.490

try [http://wikiplex.codeplex.com/](http://wikiplex.codeplex.com/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-16T16:35:54.967

有一些 wiki 渲染引擎，但名称现在让我无法理解。也许看看这些[开源选项](http://csharp-source.net/open-source/wiki-engines)中的一些？我之前从该应用程序列表中查看了[MindTouch](http://wiki.developer.mindtouch.com/Deki_Wiki)，它非常丰富，但它比我需要做的要多得多。

如果您只是需要将文本转换为 HTML 内容，我使用[Halide](http://www.codeplex.com/halide)，它可以让人们在文本区域中输入，然后它会 HTML 化链接、删除危险内容、添加`<p></p>`和`<br />`等。非常简单但没有内置格式选项。

SO 使用自定义版本的[Markdown](http://daringfireball.net/projects/markdown/)进行文本编辑器和 HTML 内容呈现。[在 Google 上搜索 Markdown.NET](http://www.google.com/search?q=markdown.net)以获取多个端口。

# asp-classic - 找出真正的文件类型

> ID：450947
> 
> 赞同：7
> 
> 时间：2009-01-16T16:12:29.647
> 
> 标签：asp-classic, analysis, file-type

我正在处理一个处理文件上传的 ASP 网页。仅允许上传特定类型的文件，例如 .XLS、.XML、.CSV、.TXT、.PDF、.PPT 等。

我必须确定一个文件是否真的与扩展名显示的类型相同。换句话说，如果将*trojan.exe*重命名为*harmless.pdf*并上传，应用程序必须能够发现上传的文件不是.PDF 文件。

您将使用什么技术来分析这些上传的文件？我在哪里可以获得有关这些文件格式的最佳信息？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-16T16:17:11.590

一种方法是检查文件中的某些签名或幻数。此页面有一个方便的已知文件签名列表，并且似乎是最新的：

[http://www.garykessler.net/library/file_sigs.html](http://www.garykessler.net/library/file_sigs.html)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-16T17:06:27.497

> 换句话说，如果将 trojan.exe 重命名为harmless.pdf 并上传，应用程序必须能够发现上传的文件不是.PDF 文件。

这不是一个真正的问题。如果 .exe 以 .pdf 格式上传，并且您正确地将其作为 application/pdf 提供给下载器，则下载器将得到的所有内容都将是损坏的 PDF。他们必须手动将其重新键入 .exe 才能受到伤害。

真正的问题是：

1.  某些浏览器可能会嗅探文件的内容，并认为它们比您更了解文件的类型。IE 在这方面特别糟糕，如果它发现任何 HTML 标签潜伏在文件的开头附近，它倾向于将文件呈现为 HTML。这特别无益，因为这意味着脚本可以注入您的站点，可能会损害任何应用程序级别的安全性（cookie 窃取等）。解决方法包括始终使用 Content-Disposition 将文件作为附件提供，和/或从不同的主机名提供文件，因此它不能跨站点脚本回到您的主站点。

2.  PDF 文件无论如何都不安全！它们可能充满了脚本，并且存在严重的安全漏洞。利用 PDF 阅读器浏览器插件中的漏洞是目前在网络上安装木马的最常见手段之一。而且您通常几乎无能为力来尝试检测这些漏洞，因为它们可能会被高度混淆。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-16T16:15:39.580

获取“安全”文件类型的文件头 - 可执行文件总是有自己的头文件类型，您可能可以检测到这些文件头。但是，您必须熟悉您打算接受的每种格式。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-16T16:23:31.107

我知道你说的是 C#，但这可能会被移植。此外，它还有一个 XML 文件，其中已经包含许多常见文件类型的描述符。

这是一个名为 JMimeMagic 的 Java 库。它在这里：http: [//jmimemagic.sourceforge.net/](http://jmimemagic.sourceforge.net/)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-16T16:42:25.453

也许你可以从不同的方向来解决这个问题。与其识别所有上传的文件类型（仅 Excel 对我来说似乎一团糟，因为它现在有多种格式），为什么不**通过病毒扫描程序运行所有上传**？各种各样的文件都可能包含病毒和木马。它可能对您的服务器更有效，但它是最安全的解决方案。

然后由用户正确识别他们的文件类型，这似乎是合理的。添加大量代码（也需要测试）只是为了仔细检查您的用户似乎是一大步。如果我说它是 .pdf2 文件，您会将其重命名为 .pdf 吗？如果这是在公司环境中，那么期望用户对其文件具有正确的扩展名是合理的。我也会跟踪谁上传了什么。如果它是公开的，那么扫描文件类型可能是值得的，但我绝对也会进行病毒扫描。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-16T17:08:14.263

在 **NIX* 系统上，我们有一个名为*file(1)*的实用程序。尝试为 Windows 找到类似的东西，但如果 self 已被移植，则文件实用程序。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2011-03-15T07:29:06.237

以下 C++ 代码可以帮助您：

```
//-1 : File Does not Exist or no access
//0 : not an office document
//1 : (General) MS office 2007
//2 : (General) MS office older than 2007
//3 : MS office 2003 PowerPoint presentation
//4 : MS office 2003 Excel spreadsheet
//5 : MS office applications or others 
int IsOffice2007OrOlder(wchar_t * fileName)
{
    int iRet = 0;
    byte msgFormatChk2007[8]    = {0x50, 0x4B, 0x03, 0x04, 0x14, 0x00, 0x06, 0x00};     //offset 0 for office 2007 documents
    byte possibleMSOldOffice[8] = {0xD0, 0xCF, 0x11, 0xE0, 0xA1, 0xB1, 0x1A, 0xE1};     //offset 0 for possible office 2003 documents

    byte msgFormatChkXLSPPT[4]  = {0xFD, 0xFF, 0xFF, 0xFF};     // offset 512: xls, ppt: FD FF FF FF 
    byte msgFormatChkOnlyPPT[4] = {0x00, 0x6E, 0x1E, 0xF0};     // offset 512: another ppt offset PPT   
    byte msgFormatChkOnlyDOC[4] = {0xEC, 0xA5, 0xC1, 0x00};     //offset 512: EC A5 C1 00 
    byte msgFormatChkOnlyXLS[8] = {0x09, 0x08, 0x10, 0x00, 0x00, 0x06, 0x05, 0x00};     //offset 512: XLS

    int iMsgChk = 0;
    HANDLE fileHandle = CreateFile(fileName, GENERIC_READ,
        FILE_SHARE_READ, NULL, OPEN_EXISTING, FILE_ATTRIBUTE_READONLY, NULL  );
    if(INVALID_HANDLE_VALUE == fileHandle) 
    { 
        return -1; 
    }

    byte buff[20];
    DWORD bytesRead;
    iMsgChk = 1;
    if(0 == ReadFile(fileHandle, buff, 8, &bytesRead, NULL )) 
    { 
        return -1; 
    }

    if(buff[0] == msgFormatChk2007[0]) 
    {
        while(buff[iMsgChk] == msgFormatChk2007[iMsgChk] && iMsgChk < 9)
            iMsgChk++;

        if(iMsgChk >= 8) {  
            iRet = 1; //office 2007 file format
        }
    } 
    else if(buff[0] == possibleMSOldOffice[0])
    {
        while(buff[iMsgChk] == possibleMSOldOffice[iMsgChk] && iMsgChk < 9)
            iMsgChk++;

        if(iMsgChk >= 8)
        {   
            //old office file format, check 512 offset further in order to filter out real office format
            iMsgChk = 1;
            SetFilePointer(fileHandle, 512, NULL, FILE_BEGIN);
            if(ReadFile(fileHandle, buff, 8, &bytesRead, NULL ) == 0) { return 0; }

            if(buff[0] == msgFormatChkXLSPPT[0])
            {
                while(buff[iMsgChk] == msgFormatChkXLSPPT[iMsgChk] && iMsgChk < 5)
                    iMsgChk++;

                if(iMsgChk == 4)
                    iRet = 2;
            }
            else if(buff[iMsgChk] == msgFormatChkOnlyDOC[iMsgChk])
            {
                while(buff[iMsgChk] == msgFormatChkOnlyDOC[iMsgChk] && iMsgChk < 5)
                    iMsgChk++;
                if(iMsgChk == 4)
                    iRet = 2;

            }
            else if(buff[0] == msgFormatChkOnlyPPT[0])
            {
                while(buff[iMsgChk] == msgFormatChkOnlyPPT[iMsgChk] && iMsgChk < 5)
                    iMsgChk++;

                if(iMsgChk == 4)
                    iRet = 3;
            }
            else if(buff[0] == msgFormatChkOnlyXLS[0])
            {

                while(buff[iMsgChk] == msgFormatChkOnlyXLS[iMsgChk] && iMsgChk < 9)
                    iMsgChk++;

                if(iMsgChk == 9)
                    iRet = 4;
            } 

            if(0 == iRet){
                iRet = 5;
            }
        }
    }

    CloseHandle(fileHandle);

    return iRet;
} 
```

# windows - PowerShell Windows 安装程序 Com 对象

> ID：450953
> 
> 赞同：5
> 
> 时间：2009-01-16T16:13:14.733
> 
> 标签：windows, powershell, installation, comobject

我正在尝试使用 Powershell 修改 MSI 文件的内容。为此，我创建了一个 WindowsInstaller.Installer 实例，然后使用 $installer.OpenDatabase 和 $database.OpenView。类似的功能可以在 VBScript 中使用，而且我已经在网上看到了似乎可以使用的示例。

```
$installer = new-object -comobject "WindowsInstaller.Installer"
$database = $installer.OpenDatabase("C:\Temp\Setup.msi", 1) 
```

对于上面的代码，我收到错误“方法调用失败，因为 [System.__ComObject] 不包含名为 'OpenDatabase' 的方法。”

```
$installer = new-object -comobject "WindowsInstaller.Installer"
$database = $installer.InvokeMethod("OpenDatabase","C:\Temp\Setup.msi", 1) 
```

如果我尝试使用 $installer.InvokeMethod，我会收到相同的错误“方法调用失败，因为 [System.__ComObject] 不包含名为‘InvokeMethod’的方法。”

任何帮助将非常感激。

谢谢。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-16T16:25:07.033

有关一些指导，请参阅[此](http://www.vistax64.com/powershell/12743-windows-installer-automation-interface-problems-powershell.html)线程。基本上，MSI COM 对象是以混淆 PS 的方式实现的。有一个链接指向在该线程中讨论它的博客文章。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-08-16T10:19:01.660

最初接受的答案链接不再有效。

在评论中，JohnB 发布了一个链接，其中包含一个很好的示例，说明如何使用 Powershell 中的 Windows 安装程序。

还有一个 CodePlex 项目，它包含很多功能并且可能很有用：
[Windows Installer PowerShell Module](http://psmsi.codeplex.com/)

# html - 超越 iframe

> ID：450960
> 
> 赞同：0
> 
> 时间：2009-01-16T16:14:23.980
> 
> 标签：html, iframe

我正在尝试让 iframe B 与站点 A 进行通信。我进行了搜索和搜索，并且我读到的每一件事都说，如果它们属于不同的域（iframe src 来自子域），这是不可能的。

我想交流，因为我的公司在其页面上有广告，并且需要每 X 分钟刷新一次。如果它是一个正常的添加，这没关系，但有些添加扩展。就像我添加的那样，从 300x250 开始，然后到 800x300。我想与 iframe 沟通以了解添加何时会扩展，但这似乎不是一种方式。有没有办法让添加超出 iframe 的初始大小？

如果添加是 300x250，则 iframe 也将具有 300x250，但是当添加扩展时，它会被切断，所以我真的需要让 iframe 也扩展或者让添加超出 iframe 的大小。

任何人都知道如何做到这一点，或者有一些教程展示了如何与 iframe 进行一些基本的通信。

注意：有些网站还提供具有完全不同域的添加，因此如果有人知道如何使其超越 iframe，那就太好了。

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-16T16:27:44.360

如果您希望两个 iframe 进行通信，并且您说其中一个位于不同的子域但**相同的顶级域上**，则可以执行帧间脚本。请参阅[http://ajaxian.com/archives/how-to-make-xmlhttprequest-calls-to-another-server-in-your-domain](http://ajaxian.com/archives/how-to-make-xmlhttprequest-calls-to-another-server-in-your-domain)。

诀窍是让页面 A 和 B 都设置

```
document.domain = 'SameTopLevelDomain.com'; 
```

然后浏览器将让页面进行通信（例如从其他页面获取数据、调用函数等）。

但是，如果这两个页面完全位于不同的域中，则您必须采用前面回答的服务器端代理方法。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-16T16:19:34.407

出于安全原因，您不能跨越 iframe 边界，如果可能的话，很容易将您的登录凭据窃取到任何站点。

但是，您可以制作服务器端代理，它将每个查询从 iframe 重定向到广告服务器。这样，您的 iframe 实际上可以在同一域（或子域）中具有源

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-16T17:24:02.967

也许我的回答[Cross-site AJAX requests](https://stackoverflow.com/questions/333532/cross-site-ajax-requests#333770)会对你有所帮助。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-18T13:25:28.127

有一种使用 iframe 进行跨域通信的方法，在[Resizing an iframe based on content](https://stackoverflow.com/questions/153152/resizing-an-iframe-based-on-content#362564)的答案中进行了描述。

许多广告服务公司通过 iframe 在您的网站上投放横幅，并使用上述答案中概述的技术来确保 iframe 可以扩展到广告素材所需的全部尺寸。

# java - 通用 JAR 是否必须在 EAR 中跨 WAR 重复？

> ID：450965
> 
> 赞同：6
> 
> 时间：2009-01-16T16:15:08.393
> 
> 标签：java, jakarta-ee, enterprise-library

我有一个用于授权的 JAR 文件。我的每个 WAR 文件都需要它。所有 WAR 文件都打包在一个 EAR 文件中。我是否必须在每个 WAR 中重复这个通用 JAR，或者是否有通用库的结构？

所以我的例子看起来像这样......

```
big.ear
  - META-INF
    - MANIFEST.MF
    - application.xml
  - appl1.war
    - META-INF
      - MANIFEST.MF
    - WEB-INF
      - web.xml
      - lib
        - unique1.jar
        - unique2.jar
        - unique3.jar
        - common1.jar
    - jsps/html/etc
  - appl2.war
    - META-INF
      - MANIFEST.MF
    - WEB-INF
      - web.xml
      - lib
        - unique3.jar
        - unique4.jar
        - common1.jar
    - jsps/html/etc
  - appl3.war
    - META-INF
      - MANIFEST.MF
    - WEB-INF
      - web.xml
      - lib
        - unique5.jar
        - common1.jar
    - jsps/html/etc 
```

我的每个 WAR 应用程序都可以看到 common1.jar，但它是在 EAR 中的 3 次。

我可以在 EAR 结构中的哪个位置放置 common1.jar 以便 appl1、appl2 和 appl3 可以看到它而无需重复 3 次？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-16T16:34:22.647

标准方法是将 JAR 放在 EAR 的根目录中，并在`Class-Path`WARs' 的属性中引用它们`META-INF/MANIFEST.MF`。见[这篇文章](http://java.sun.com/j2ee/verified/packaging.html)。

检查容器的文档以确保它受支持。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-12-12T13:39:46.020

它在 JEE5 规范的 EE 8.2.1 章中：

> .ear 文件可能包含一个目录，该目录包含打包在 JAR 文件中的库。.ear 文件的部署描述符的 library-directory 元素包含此目录的名称。如果未指定 library-directory 元素，或者 .ear 文件不包含部署描述符，则使用名为**lib**的目录。

* * *

## 回答 #3

> 赞同：-4
> 
> 时间：2009-01-16T16:33:21.977

你的应用服务器应该有一个类似 shared/lib 的文件夹，你可以在其中放置多个 webapp 可以在同一个实例中共享的 jar 文件。

# windows - 查看作为系统帐户或服务运行的进程的窗口

> ID：450966
> 
> 赞同：0
> 
> 时间：2009-01-16T16:15:30.313
> 
> 标签：windows, service, window, system

假设您有一个作为系统帐户作为服务运行的进程，是否可以查看由该服务创建的进程创建的窗口的内容。

例如，假设您有一个服务作为一种启动 Excel 的包装器运行。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-21T22:49:00.213

服务将（在正常情况下）与交互式桌面的不同窗口站相关联，并且它们无法交互 - 您可以[在 MSDN 上的 Window Stations 上阅读更多信息](http://msdn.microsoft.com/en-us/library/ms681928(VS.85).aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-16T16:25:25.737

微软间谍++

在那里选择`Spy/Processes`并找到您的流程

如果它的一些线程创建了任何窗口，您会将它们视为子树。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-16T16:47:30.297

创建**和填充**窗口的进程不应该作为服务运行。话虽如此，如果这是在 Win2K3 或更早版本上，请将服务设置为与桌面交互，您可以自己查看内容。如果是在 Vista 或更高版本上，则无法检查任意窗口的内容。

如果它是支持检索其内容的特定类型的窗口（即 EDIT 控件），您可能能够运行另一个服务，该服务将 Windows 消息发送到第一个服务以获得您想要的内容。

# django - 如何在 Flex 中读取 Django HTTPResponse？

> ID：450976
> 
> 赞同：2
> 
> 时间：2009-01-16T16:17:45.627
> 
> 标签：django, apache-flex, flex3

我是一个完整的 Flex 菜鸟，所以如果我遗漏了一些明显的东西，我提前道歉。

我在 Flex 中编写了一个相当简单的文件上传器，它通过 URLRequest 调用我的 Django 后端（FileReference 对象处理上传）。我的上传按预期工作，我让 Django 返回一个 HTTPResponse 对象。因此，我想阅读 HTTPResponse 对象的内容。

有什么想法吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-16T16:20:07.917

当它到达客户端时，它只是一个普通的 HTTP 响应，所以像对待任何其他响应一样对待它

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-16T16:38:47.847

类似的东西

```
<mx:HTTPService id="myHTTPRequest" 
    url="{whatever your url request is}"
    result="resultHandler(event)" 
    fault="faultHandler(event)"
    showBusyCursor="true" 
    resultFormat="object"> 
```

然后在 resultHandler 里面是这样的

```
private function resultHandler (event : ResultEvent) : void {
    var obj : Object = event.result;
    //do something with returned object

} 
```

在 resultHandler 处进行调试以查看返回的确切内容，确保它是您认为应该返回的内容。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-12-04T09:30:21.990

我也是 flex 新手，在上传到 Java Rest 后端时遇到了同样的问题，我使用 FileReference 上的 DateEvent 解决了这个问题。要获取响应数据，请使用以下内容。：

```
var fileRef:FileReference = new FileReference();
fileRef.addEventListener(DataEvent.UPLOAD_COMPLETE_DATA, responseHandler);
var request:URLRequest = new URLRequest("yourUrl");
fileRef.upload(request, "fileData"); 

private function responseHandler(event:DataEvent):void {
    var response:XML = new XML(event.data); 
//Note the DataEvent: this is the event that holds the response. 
//I sent back data as xml
} 
```

您的响应应该始终是成功的 HTTP 状态代码 (200)，如果您的后端发送状态 500 代码，它将不会触发 DateEvent。服务器错误仍然可以通过 HTTPStatusEvent 捕获，但是您无权访问响应。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-10-23T08:23:40.083

您可以在 onComplete 事件处理程序中访问响应：

```
private function saveCompleteHandler(event:Event):void {
    var loader:URLLoader = event.currentTarget as URLLoader;
    trace("saveCompleteHandler - event returned:" + loader.data as String);
} 
```

我们这样做是为了从 java web 服务中获取 json。

您只需要首先使用 URLLoader 来加载 URLRequest：

```
var loader:URLLoader = new URLLoader();
loader.addEventListener(HTTPStatusEvent.HTTP_STATUS, statusHandler, 10000);
loader.addEventListener(IOErrorEvent.IO_ERROR, saveErrorHandler, 10000);
loader.addEventListener(Event.COMPLETE, saveCompleteHandler, 10000);

var request:URLRequest = new URLRequest("http:/whereverer");
request.method = URLRequestMethod.GET;
loader.load(request); 
```

# c# - 创建 Exchange 邮箱 (CDOEXM.IMailboxStore.CreateMailbox) 时出现错误 HRESULT E_FAIL

> ID：450992
> 
> 赞同：1
> 
> 时间：2009-01-16T16:23:22.963
> 
> 标签：c#, .net, active-directory, exchange-server

我正在尝试自动化为 AD 用户创建 Exchange 邮箱的过程，但遇到了问题。调用 CreateMailbox 方法时，我收到错误“错误 HRESULT E_FAIL 已从对 COM 组件的调用中返回”。我已经安装并引用了 Exchange 管理工具，并且正在使用模拟来获取权限。

这是代码：

```
 ActiveDs.IADsUser adUser = (ActiveDs.IADsUser)user.NativeObject;
            adUser.AccountDisabled = !Active;
            user.CommitChanges();

            //Set Password
            user.Invoke("SetPassword", Password);
            user.CommitChanges();            

            //Create Mailbox
            IMailboxStore mailbox;
            mailbox = (IMailboxStore)adUser;
            mailbox.CreateMailbox("LDAP://CN=StandardUsers,CN=StandardUsers,CN=InformationStore,CN=xxxxx," +
                "CN=Servers,CN=First Administrative Group,CN=Administrative Groups," +
                "CN=xxxxx Main,CN=Microsoft Exchange,CN=Services,CN=Configuration,DC=xxxxx,DC=com");             
            user.CommitChanges(); 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-16T16:43:57.977

我最初的反应有点古怪。我完全误读了代码。您所拥有的与我们在 Exch 2003 期间在生产中工作的类似。我们从一个 Web 服务调用代码，该服务作为一个在 AD 和 Exchange 中具有管理员权限的帐户运行。

无论如何，这就是 MSDN 现在所说的[链接](http://msdn.microsoft.com/en-us/library/aa142616(EXCHG.65).aspx)：

**重要** 由于在多线程运行时环境中观察到多跳身份验证问题和意外结果，Microsoft® 不支持在 Microsoft ASP.NET 页面、ASP 网页或 Web 服务中使用 CDO for Exchange Management (CDOEXM)。要创建使用 CDOEXM 功能的基于 Web 的 Microsoft Exchange 管理应用程序，Microsoft 建议将 CDOEXM 包装在分布式组件对象模型 (DCOM) 包中并从您的应用程序中调用该包。

# database - 不断增长的 MS Access 文件大小问题

> ID：450995
> 
> 赞同：7
> 
> 时间：2009-01-16T16:24:44.053
> 
> 标签：database, ms-access

我有一个大型 MS Access 应用程序，在 VBA 代码中有大量计算。当我运行它时，它最终由于文件大小过大而崩溃。有很多中间表和查询创建并随后删除，但 Access 不会回收空间。我已经努力关闭所有中间记录集并将所有临时对象设置为空，但没有任何帮助。我可以让我的代码运行的唯一方法是运行它的一部分，停止并修复/压缩文件，然后重新启动代码。

没有更好的方法吗？

谢谢

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-01-16T16:32:22.447

您应该能够从您的 VBA 代码中运行 compact 函数。

很久以前，当我进行访问工作时，我将以下片段添加为书签。

```
Public Sub CompactDB() 
    CommandBars("Menu Bar").Controls("Tools").Controls("Database utilities").Controls("Compact and repair database...").accDoDefaultAction 
End Sub 
```

你可以把它放在你的代码中来解决它。

注意：如果您遇到这些类型的扩展问题，您也可以考虑发展到更大的数据库系统。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-16T16:30:14.730

你在处理什么尺寸？崩溃时的错误代码是什么？如果仅仅是因为文件“太大”，我会感到惊讶，但我想有一个限制。从您对所有临时材料的描述中可以看出，设计改进可能会有所帮助。

编辑：我希望您意识到用其他东西替换数据库并非易事——即使您尝试保留 mdb 中除了表之外的其他任何东西。Access querydefs 是独一无二的，Access SQL 是非标准的，你基本上是从头开始的。

我见过的大多数 Access 应用程序都有很多重构的机会；如果 a) 您了解逻辑和业务规则，并且 b) 您对 Access 编程有扎实的了解，这通常并不难。但对于任何替代方案来说，这或多或少都是正确的。如果我是你，而你在这两个方面都有点不足，也许你可以得到一些帮助。但我会先尝试拯救 Access 应用程序。

还有来自另一张海报的关于将表移动到一个或多个附加的 MDB 中的建议。一般来说，这是一种可靠的、经过充分验证的技术。但首先我要弄清楚问题的真正原因是什么。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-16T17:27:57.030

我会将数据推送到 MS SQL（永久数据和中间表）；并且您可以暂时将代码部分留在 MS Access 中。

这解决了两个大问题：

1.  数据本质上将更加稳定/可靠（我无法告诉您我有多少次损坏的 MS Access 数据库）。
2.  您的 Access 数据库不会增长/变化很大（一旦运行和编译了所有代码，它应该达到平衡）。

这两者都意味着不再需要压缩/修复数据库；您可以获得 MS SQL 的免费版本（Express Edition），这并不难。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-04-14T20:52:23.897

关于 Jet 文件大小的状况对我来说是无休止的问题。

我目前正在查看 Access 数据库 A 中的一段我自己的 VBA 代码，因为它执行了一系列单记录字段*更新*对 Access 数据库 B 上的表使用 ADO（通过数据库 A 中的可更新查询引用）。单个字段是 CHAR(8)。每进行 4 次更新，数据库 B 就会增长大约 8 KB。没有什么好的借口。文件大小的增加会严重降低性能；随着每个文件的增长，更新速度从大约每秒一次（在大约 30-40K 记录的表中，使用单记录 SQL 查找并且在任何地方都没有索引）到每 5-10 秒更新一次。现在，我承认，在运行此更新代码之前，我已经压缩/修复了数据库 B；也许如果我没有这样做，表现就不会这么糟糕。如果更新的目标字段是，比如说，键入备忘录，那么我会预料到这一点。但是对 CHAR() 字段进行更新并得到这个结果是不合理的。

以上大部分内容（对任何一种解决方案都没有特别的批评）对于使用相对永久的业务应用程序安排（始终与相同的目标数据库对话）的应用程序似乎是有效的解决方案。我的不是这样。. . 我无法更改目标数据库（数据库 B），因为它是由供应商的工具生成和使用的，我们使用该工具从他们的应用程序中导出和导入数据。

我理解并赞扬上述作家提出解决用户问题的方法。*但是，当糟糕的*软件设计/实施妨碍用户使用产品时，我不能让它站起来，因为用户期望它能够发挥作用。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-18T13:11:23.490

如果您不想切换到 SQL Express 或类似的，您可以挖掘以下想法：

*   为所有临时表打开另一个“外部”访问数据库（mdb 文件），这样您就可以将所有临时数据放在外部文件中，在关闭应用程序时丢弃 mdb 文件。然后，您将在代码中操作“currentDb”对象和您在启动时构建并通过 jet、OLEDB 或 ODBC 连接连接到的另一个数据库
*   将永久表与代码分开，并在需要时将数据带入本地客户端界面以构建临时表。例如，这可以通过使用“DoCmd.transferDatabase acLink”将外部数据库链接到本地​​/客户端文件来完成。这也可以通过 OLEDB 连接连接到永久数据、打开所需的记录集并将它们在本地保存为 XML 文件来完成。还有许多其他解决方案可以在这里实现。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-16T16:27:56.840

我不是 MVP，但 Google 找到了这些。也许他们会帮助你：

[http://www.mvps.org/access/general/gen0041.htm](http://www.mvps.org/access/general/gen0041.htm) [http://forums.devarticles.com/microsoft-access-development-49/compact-database-via-vba-24958.html](http://forums.devarticles.com/microsoft-access-development-49/compact-database-via-vba-24958.html)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-16T16:28:22.563

不幸的是，当您变得太大时，MS Access 会出现问题 - 我认为访问数据库的最大大小为 2GB。

您可以考虑迁移到 Sql Express、VistaDB 等。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-16T17:18:50.310

根据[http://office.microsoft.com/en-us/access/HP051868081033.aspx](http://office.microsoft.com/en-us/access/HP051868081033.aspx)，Access 2003 和 2007 有 2 GB 的限制。但是，很容易将部分或全部表移动到单独的 .mdb 文件中，然后链接到这些表。无论如何，最好有两个文件，一个用于您的数据，一个用于所有宏、查询等。如果您的表格文件接近 2 GB 限制，您甚至可以拥有多个文件。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2018-04-09T16:22:16.100

我遇到了一个类似的问题，我的数据库在导入原始数据时膨胀。我决定使用数据库对象 (DAO) 创建临时数据库，导入数据，查询/修改临时数据库中的数据，通过 SQL 将其拉到原始数据库中，而不是常规地拆分数据库和压缩后端然后删除它。YBase 代码如下所示：

```
Sub tempAccessDatabaseImport()
    Dim mySQL As String
    Dim tempDBPath As String
    Dim myWrk As DAO.Workspace
    Dim tempDB As DAO.Database
    Dim myObject

    'Define temp access database path
    tempPathArr = Split(Application.CurrentProject.Path, "\")
    For i = LBound(tempPathArr) To UBound(tempPathArr)
        tempDBPath = tempDBPath + tempPathArr(i) + "\"
    Next i
    tempDBPath = tempDBPath + "tempDB.accdb"

    'Delete temp access database if exists
    Set myObject = CreateObject("Scripting.FileSystemObject")
    If myObject.FileExists(tempDBPath) Then
        myObject.deleteFile (tempDBPath)
    End If

    'Open default workspace
    Set myWrk = DBEngine.Workspaces(0)

    'DAO Create database
    Set tempDB = myWrk.CreateDatabase(tempDBPath, dbLangGeneral)

    'DAO - Import temp xlsx into temp Access table
    mySQL = "SELECT * INTO tempTable FROM (SELECT vXLSX.*FROM [Excel 12.0;HDR=YES;DATABASE=" & RAWDATAPATH & "].[" & WORKSHEETNAME & "$] As vXLSX)"

    'DAO Execute SQL
    Debug.Print mySQL
    Debug.Print
    tempDB.Execute mySQL, dbSeeChanges

    'Do Something Else

    'Close DAO Database object
    tempDB.Close
    Set tempDB = Nothing

    myWrk.Close
    Set myWrk = Nothing

    'Delete temp access database if exists
    If myObject.FileExists(tempDBPath) Then
        'myObject.deleteFile (tempDBPath)
    End If
End Sub 
```

# php - PHP 会话变量超时

> ID：450997
> 
> 赞同：1
> 
> 时间：2009-01-16T16:25:06.033
> 
> 标签：php

我的应用程序使用了一些超时的会话变量，即使我认为它们不会超时，因为我在 php.ini 中有以下设置：

session.cookie_lifetime = 0

php.ini 中的其他会话设置几乎都设置为默认值。如何确保会话变量在浏览器窗口关闭之前一直存在？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-16T16:30:44.010

**我认为您使用session.gc_maxlifetime**设置会话超时，默认为 1440 秒 - 24 分钟

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-16T17:08:44.713

请注意，从 PHP 4.2.3 开始，生命周期是根据修改日期而不是访问日期计算的（请参阅 参考资料[`session.gc_maxlifetime`](http://docs.php.net/manual/en/session.configuration.php#ini.session.gc-maxlifetime)）。因此，您必须在每个请求上更新会话数据以“重置计时器”。

# visual-studio - “您是否缺少程序集参考？” 编译错误 - Visual Studio

> ID：450999
> 
> 赞同：33
> 
> 时间：2009-01-16T16:25:15.583
> 
> 标签：visual-studio, compiler-errors, reference, assemblies

我目前正在为我们公司的其他应用程序开发服务器控件，以与 WCF 服务交互。每次我进行更改代码更改并重新编译控件时，我都会将 AsseemblyInfo.cs 中的 AssemblyVerison 和 AssemblyFileVersion 类加一。例如，我的最新版本从 1.0.07.0 升级到 1.0.08.0。

当消费应用程序通过复制 bin 目录中的最新文件来更新文件并尝试编译时，它们会收到以下错误：

> 命名空间“MyNamespace”中不存在类型或命名空间名称“MyControl”（您是否缺少程序集引用？）

为了解决此错误，他们必须删除当前引用并重新添加引用。

有什么方法可以更新服务器控件而无需删除并重新添加引用？

我不强命名服务器控件。
@JPunyon - 你的意思是让消费应用程序将服务器控制项目添加到他们的解决方案中吗？

* * *

## 回答 #1

> 赞同：38
> 
> 时间：2014-07-15T10:44:24.200

在我的例子中，它是一个使用 Target Framework：“.NET Framework 4.0 Client Profile”定义的项目，它试图引用使用 Target Framework：“.NET Framework 4.0”定义的 dll 项目。

一旦我将项目设置更改为使用目标框架：“.NET Framework 4.0”，一切都构建得很好。

右键单击项目->属性->应用程序->目标框架

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2009-01-16T17:56:26.897

右键单击解决方案资源管理器中的程序集引用，属性，禁用“特定版本”选项。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2020-03-02T15:05:18.313

如果上述解决方案均无效，请尝试此 10 秒修复。

在解决方案资源管理器中导航到启动项目。右键单击，**属性**>**应用程序**>**目标框架**。将目标框架更改为其他任何内容。按**是**确认对话框。让更改几秒钟后生效，然后将框架切换回之前的状态。

该错误有望像对我一样为您消失！

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-16T16:32:26.237

您是否对您的程序集进行了强命名？在这种情况下，自动增加您的内部版本号不是一个好主意，因为对于每个新的内部版本号，您还必须更新所有参考。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-12-13T00:05:58.913

我碰到了指向正确方向的答案，但是...

对于那些使用 Visual C++ 的人：

如果您需要关闭版本的自动增量，您可以在“AssemblyInfo.cpp”文件中更改此值（所有 CLR 项目都有一个）。给它一个不带星号的真实版本号，它会按照你想要的方式工作。

只是不要忘记在您的程序集上实现您自己的版本控制！

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2016-08-17T17:04:09.017

就我而言，我必须将 Copy Local 设置更改为 true（在解决方案资源管理器中右键单击程序集，选择属性，找到并更改 Copy Local 属性的值）。更改此设置后，我的 WCF 服务的发布将文件复制到服务器并且错误消失了。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2018-04-21T02:43:31.657

在 Visual Studio 2017 社区中创建新的空白 UWP 项目时，出现此错误：

[![在此处输入图像描述](https://i.stack.imgur.com/MgZ7M.png)](https://i.stack.imgur.com/MgZ7M.png)

还原 NuGet 缓存后，引用在项目中重新出现。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2019-03-28T16:51:28.800

我在 TFVC 存储库上的 Azure DevOps Services（MS 托管）构建管道中遇到了这个错误。

就我而言，我在一个分支中工作，并且不小心从主干中的包文件夹而不是分支中添加了引用。一旦我从分支中添加了引用，它就开始成功编译。

即，在处理\branch-beta\sierra.csproj 时，我不小心引用了\trunk\packages\delta.dll。显然，我需要引用 \branch-beta\packages\delta.dll 来代替。发生混淆是因为路径没有在“*添加引用*”窗口中突出显示，而且我没有仔细检查。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2020-02-03T08:31:28.437

我在**Visual Studio 2019 版本 16.4.4中发现了这个问题**

我通过发现

```
packages.config 
```

缺少适当的参考

例如：

```
<package id="System.Runtime" version="4.3.0" targetFramework="net461" /> 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2021-01-13T01:00:45.713

删除解决方案目录的“Web.Debug.config”和“Web.Release.config”文件，它应该会删除所有错误

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2021-03-22T07:19:14.760

如果代码以前正常工作并且现在抛出错误，如上述答案中所述，可能已修改其中一个配置。在蛮力方法中，关闭 VS 编辑器并删除 .sln 文件同一目录中的 .vs 文件夹。所有配置都将被清除并从 repo 文件中提取。**********************************