# StackOverflow 问答 000356000-000356999

# sql-server - 如何在 SQL Server 中测试用户是否存在？

> ID：356000
> 
> 赞同：22
> 
> 时间：2008-12-10T13:17:33.167
> 
> 标签：sql-server, sql-server-2008, sql-server-2005, sql-server-2012

我想在 SQL Server 脚本中删除一个用户，但我需要先测试是否存在，否则我会收到脚本错误。删除表或存储过程时，我检查 sysobjects 表，如下所示：

```
IF EXISTS (
    SELECT * 
    FROM   sysobjects 
    WHERE  id = object_id(N'[dbo].[up_SetMedOptions]') 
    AND    OBJECTPROPERTY(id, N'IsProcedure') = 1
)
Drop Procedure up_SetMedOptions;
GO 
```

检查用户的推论是什么？请注意，我不是在询问服务器的数据库登录！该问题与特定数据库中的用户有关。

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2008-12-10T13:25:54.833

SSMS 以下列方式编写脚本：

对于 SQL 2005/2008 及更高版本：

```
IF  EXISTS (SELECT * FROM sys.database_principals WHERE name = N'username')
DROP USER [username] 
```

对于 SQL 2000：

```
IF  EXISTS (SELECT * FROM dbo.sysusers WHERE name = N'username')
EXEC dbo.sp_revokedbaccess N'username' 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-10T13:22:58.430

在 SQL 2005 中：

```
select * from sys.sysusers 
```

在 SQL 2000 中：

```
select * from sysusers 
```

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2013-11-03T23:59:56.380

下面的代码对我有用。

```
IF EXISTS (SELECT * FROM sys.syslogins WHERE name = N'MyUserName') 
DROP LOGIN [MyUserName] 
```

# c++ - 如何从 boost::ptr_vector 中删除元素

> ID：356002
> 
> 赞同：7
> 
> 时间：2008-12-10T13:17:39.080
> 
> 标签：c++, boost, ptr-vector

所以我试图通过使用 boost::ptr_vector 来摆脱我的 std::vector 。现在我正在尝试从一个元素中删除一个元素，并将删除的元素也删除。对我来说最明显的事情是：

```
class A
{ int m; };

boost::ptr_vector<A> vec;
A* a = new A;
vec.push_back(a);
vec.erase(a); 
```

但这甚至不会编译（完整的错误信息见下文）。我已经像在 std::vector 上一样尝试了擦除/删除习语，但 boost::ptr_vector 的所有算法都与 std::vector 中的算法略有不同。

所以我的问题：

*   如何从 ptr_vector 中删除指针？
*   我还需要手动删除（）我删除的那个元素吗？

编译器错误：

```
1>------ Build started: Project: ptr_vector_test, Configuration: Debug Win32 ------
1>Compiling...
1>ptr_vector_test.cpp
1>c:\users\rvanhout\svn\trunk\thirdparty\boost\range\const_iterator.hpp(37) : error C2825: 'C': must be a class or namespace when followed by '::'
1>        c:\users\rvanhout\svn\trunk\thirdparty\boost\mpl\eval_if.hpp(63) : see reference to class template instantiation 'boost::range_const_iterator<C>' being compiled
1>        with
1>        [
1>            C=A *
1>        ]
1>        c:\users\rvanhout\svn\trunk\thirdparty\boost\range\iterator.hpp(63) : see reference to class template instantiation 'boost::mpl::eval_if_c<C,F1,F2>' being compiled
1>        with
1>        [
1>            C=true,
1>            F1=boost::range_const_iterator<A *>,
1>            F2=boost::range_mutable_iterator<A *const >
1>        ]
1>        c:\users\rvanhout\svn\trunk\thirdparty\boost\ptr_container\detail\reversible_ptr_container.hpp(506) : see reference to class template instantiation 'boost::range_iterator<C>' being compiled
1>        with
1>        [
1>            C=A *const 
1>        ]
1>        c:\tmp\ptr_vector_test\ptr_vector_test.cpp(21) : see reference to function template instantiation 'boost::void_ptr_iterator<VoidIter,T> boost::ptr_container_detail::reversible_ptr_container<Config,CloneAllocator>::erase<A*>(const Range &)' being compiled
1>        with
1>        [
1>            VoidIter=std::_Vector_iterator<void *,std::allocator<void *>>,
1>            T=A,
1>            Config=boost::ptr_container_detail::sequence_config<A,std::vector<void *,std::allocator<void *>>>,
1>            CloneAllocator=boost::heap_clone_allocator,
1>            Range=A *
1>        ]
1>c:\users\rvanhout\svn\trunk\thirdparty\boost\range\const_iterator.hpp(37) : error C2039: 'const_iterator' : is not a member of '`global namespace''
1>c:\users\rvanhout\svn\trunk\thirdparty\boost\range\const_iterator.hpp(37) : error C2146: syntax error : missing ';' before identifier 'type'
1>c:\users\rvanhout\svn\trunk\thirdparty\boost\range\const_iterator.hpp(37) : error C2208: 'boost::type' : no members defined using this type
1>c:\users\rvanhout\svn\trunk\thirdparty\boost\range\const_iterator.hpp(37) : fatal error C1903: unable to recover from previous error(s); stopping compilation
1>Build log was saved at "file://c:\tmp\ptr_vector_test\Debug\BuildLog.htm"
1>ptr_vector_test - 5 error(s), 0 warning(s)
========== Build: 0 succeeded, 1 failed, 0 up-to-date, 0 skipped ========== 
```

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-12-10T18:18:58.783

好吧，您也可以使用 std::vector 来做到这一点。

在这两种情况下，erase 都将迭代器作为参数。
因此，在您从向量（或 ptr_vector）中删除某些内容之前，您需要找到它。

另请注意，ptr_vector 将其内容视为您存储了一个对象而不是指针。所以任何搜索都是通过对象完成的。

所以基本上

```
 std::vector<A>       x;
 std::ptr_vector<A>   y;

 // These two object should behave in exactly the same way.
 // The ONLY difference is inserting values which for y are pointers.
 // Y take ownership of the pointer and all subsequent acesses to the
 // members of y look like they are objects 
```

例子：

```
#include <boost/ptr_container/ptr_vector.hpp>
#include <vector>

class A
{ int m;
    public:
    A(int x):m(x)   {}
    bool operator==(A const& rhs)   {return m = rhs.m;}
};

int main()
{
    boost::ptr_vector<A>    x;
    x.push_back(new A(1));
    x.erase(std::find(x.begin(),x.end(),A(1)));

    std::vector<A>          y;
    y.push_back(A(2));
    y.erase(std::find(y.begin(),y.end(),A(2)));

    // To find an exact pointer don't modify the equality.
    // Use find_if and pass a predicate that tests for a pointer
    A* a = new A(3);
    boost:ptr_Vector<A>     z;
    z.push_back(a);
    z.erase(std::find_if(y.begin(),y.end(),CheckPointerValue(a));
}

struct CheckPointerValue
{
     CheckPointerValue(A* a):anA(a) {}
     bool operator()(A const& x)    { return &X == anA;}
     private:
        A* anA;
}; 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-10T13:29:50.303

我认为您想在向量上调用 .release() 而不是擦除。这将删除条目并删除内存。

[有关教程](http://www.boost.org/doc/libs/1_37_0/libs/ptr_container/doc/tutorial.html)中的详细信息，请参阅“新功能”部分，或查看[参考资料](http://www.boost.org/doc/libs/1_37_0/libs/ptr_container/doc/ptr_sequence_adapter.html)。

或者，您需要获取一个元素的迭代器才能调用擦除（），我不确定 A* 是否按 ptr_vector 计算。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-10T13:22:16.153

您可以使用 erase_if 模板方法。

```
vec.erase_if( predicate() ); 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-10T14:11:05.523

的语义与`ptr_vector`正则非常相似`vector`。您必须先找到一个元素，然后才能擦除它。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-11T23:29:18.720

奇怪的是： [STL::vector<>](http://www.sgi.com/tech/stl/Vector.html)是一个[Random Access Container](http://www.sgi.com/tech/stl/RandomAccessContainer.html)，这意味着它使用[Random Access Iterators](http://www.sgi.com/tech/stl/RandomAccessIterator.html)。

所以**vec.erase(vec.begin()+N)**将删除索引 N 处的元素。

请注意，这样做会破坏整个*迭代器*模因，您不能再在向量和列表之间轻松切换......

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-10T13:33:09.750

您需要使用带有合适谓词的成员 erase_if 方法。无需删除指针，容器拥有所有权。

```
struct delete_a {
    bool operator()(boost::ptr_vector<A>::value_type inA) {
       return inA == a;
    }
}

vec.erase_if(delete_a()); 
```

（请注意，这只是为简单起见而选择的一个示例，对于实际代码中的这种情况，我想人们会编写一个合适的 bind/equal_to 组合，或者使用 lambda）

或者，作为替代方案，如果您仍想使用该对象，请在正确的迭代器上调用 release。

# java - 单例工厂方法

> ID：356004
> 
> 赞同：4
> 
> 时间：2008-12-10T13:18:01.653
> 
> 标签：java

工厂方法中是否可以有一个单例？我有很多使用工厂方法的域。我该如何解决这个问题。请帮我举个例子。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-11T00:28:26.683

在这个例子中，我相信你会想要同步你的 getInstance() 方法以确保两个线程不会同时进入它。否则，两个线程可能会在单例实例化的块内结束，这是非常有问题的。此解决方案的唯一问题是每次调用 getInstance() 时您都需要为方法的同步支付额外费用。例子：

```
public static synchronized Singleton getInstance()
{
   // since whole method is synchronized only 1 thread can 
   // enter the following block ensuring only one instance 
   // is ever created. however we pay a synchronization
   // penalty every time this method is called.
   if(mInstance==null) { 
      mInstance=new Singleton();
   }
   return mInstance;
} 
```

或者，如果初始化很便宜，您也可以切换到使用单例实例的即时初始化而不是延迟初始化，这可以保证并发性并且不会为调用 getInstance() 方法支付同步惩罚。例子：

```
// no synchronization penalty, but penalty for eager init
private static Singleton mInstance = new Singleton();                          

public static Singleton getInstance()
{
    return mInstance;
} 
```

最优化的方法是使用双重检查锁定，由于 volatile 关键字在 1.4 或更早版本 JVM 中的不同实现，您需要 Java 1.5 或更高版本才能可靠使用（请参阅“Head First Design Patterns”第 5 章 p.182由 O'Reilly Media, Inc. 出版——这是我第一次读到这一点的地方。）示例：

```
private volatile static Singleton mInstance;

private Singleton(){}

public static Singleton getInstance()
{
   if(mInstance==null) {
      synchronized (Singleton.class) { 
          // only pay synchronization penalty once
          if(mInstance==null){
              mInstance=new Singleton();
          }
      }
   }
   return mInstance;
} 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-10T13:22:35.573

“...为创建 Singleton 类实例的对象创建一个接口。这本质上是 GoF 书中抽象工厂、工厂方法和仿函数模式的组合。”

```
/**
 * An interface defining objects that can create Singleton
 * instances.
 */
public interface SingletonFactoryFunctor {
   /**
    * @return An instance of the Singleton.
    */
   public Singleton makeInstance();
} 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-10T13:22:56.603

您应该从工厂方法中调用您的[Singleton](http://en.wikipedia.org/wiki/Singleton_pattern) `getInstance()`方法。逻辑应该处理返回单例的一个实例的`getInstance()`细节。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-10T20:03:25.937

你可以像这样实现单例：

```
public class Singleton {

private static Singleton mInstance;

private Singleton(){}

public static Singleton getInstance()
{
   if(mInstance==null){
      mInstance=new Singleton();
   }
return mInstance;
}

} 
```

这个类你可以在你想要的每个工厂方法中返回，就像之前描述的 mepcotterell。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-10-26T16:10:20.040

此示例不是正式的工厂模式 (GoF)，但如果您像[静态工厂方法一样使用它仍然很有帮助](https://rads.stackoverflow.com/amzn/click/com/0321356683)

```
abstract class Product {}

class ConcreteProduct extends Product{}

class ProductSupportFactory {
    private static ProductSupportFactory instance = null;
    private ConcreteProduct product = null;

    static {
        instance = new ProductSupportFactory();
    }
    private ProductSupportFactory() {
        product = new ConcreteProduct(); //object initialization
    }
    public static ProductSupportFactory getInstance(){
        return instance;
    }
    public ConcreteProduct getProduct() {
        return product;
    }
    public void setProduct(ConcreteProduct product) {
        this.product = product;
    }
}

public class ProductConsumer {  
    public static void main(String args[]){ //client
        ConcreteProduct uniqueInstance = ProductSupportFactory.getInstance().getProduct();
        ConcreteProduct sharedInstance = ProductSupportFactory.getInstance().getProduct(); //same object hash
    }
} 
```

# c# - 让 ReSharper 继续“使用系统；” 优化使用时

> ID：356010
> 
> 赞同：13
> 
> 时间：2008-12-10T13:19:28.497
> 
> 标签：c#, visual-studio-2008, resharper, using-directives

我想知道是否有一些选项可以阻止 ReSharper 仅删除`using System;`指令？也许这可以在某处配置？

另外，有没有办法让 ReSharper 像 Visual Studio 2008 那样对剩余的指令进行排序（我认为按字母顺序）？

谢谢。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-12-10T13:30:03.093

是的，有这样一个选项：ReSharper->Languages->C#->Namespace Imports。您可以添加不应删除的命名空间以及应始终导入的命名空间。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-12-10T13:26:27.720

是的，在选项 ( `Resharper`> `Options`> `Languages`> `C#`) 中，有一个`Namespace Imports`部分允许您指定永远不应删除的命名空间。你会`System`输入它给出的提示。

# iphone - iPhone - 入门

> ID：356025
> 
> 赞同：7
> 
> 时间：2008-12-10T13:24:43.650
> 
> 标签：iphone, xcode

我找到了在 iPhone 上开发应用程序的“入门”文档。

1.  我想要社区对**我应该知道/学习什么**（在语言或概念方面）的意见？

2.  一个普通的程序员需要多长时间来学习和构建一个管理列表、连接到某些网站等的应用程序？

3.  如何将我制作的应用程序下载到 iPhone 上？只需 ZIP，然后使用 .ipa 文件安装？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-12-10T13:44:39.820

> 我想要社区对我应该知道/学习什么（在语言或概念方面）的意见？

您将使用 Objective-C 和 Cocoa。如果你以前没有做过 MAC 编程，这些都是相当奇怪的概念，但不久之后你可能会爱上它们。iPhone 开发中要记住的最重要的概念是**内存管理**，因为该设备没有垃圾收集的概念。

> 一个普通的程序员需要多长时间来学习和构建一个管理列表、连接到某些网站等的应用程序？

不会太长。互联网上有大量示例应用程序，stackoverflow.com 上有许多有用的人

> 如何将我制作的应用程序下载到 iPhone 上？只需 ZIP，然后使用 .ipa 文件安装？

您将需要下载 SDK，在 Mac 上使用 xcode 创建一个应用程序（或类似的 Windows 环境，如果有的话） - 您可以在不给苹果任何东西的情况下使用模拟器进行测试，但为了在设备上进行*合法*测试，您需要成为苹果开发者。

但是，如果您越狱您的设备，您将能够按照几种方法之一让您的应用程序绕过苹果限制在 iphone 上运行。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-10T14:00:03.847

整个 iPhone UI 开发（UITableView 等）都基于 MVC（模型-视图-控制器）模式，因此对此有很好的理解至关重要。

内存管理也很重要，刚开始可能有点麻烦。我刚开始不久，所以不能在这里给你一个很好的描述而不自欺欺人:)。[苹果内存管理](http://developer.apple.com/iphone/library/documentation/Cocoa/Conceptual/MemoryMgmt/MemoryMgmt.html)

最后，开发环境一开始可能有点奇怪。特别是连接视图控制器和界面元素。所以检查一下。

然后它基本上是通过 iPhone 开发者网站和互联网上的教程来了解不同 UI 元素和控制器（表格、文本框等）的内部结构。

您需要为 iPhone 开发者计划付费才能合法地使用您的 iPhone 来调试您的应用程序（尽管 Xcode 开发环境带有一个模拟器）。将应用程序提交到应用商店允许所有人访问。付款后可获得执行此操作的全部详细信息。您可以通过其他方式在 iPhone 上获取应用程序，但我不会提供这样做的详细信息 - 搜索互联网。

我想说，浏览文档和遵循教程将使您能够开始构建应用程序。这不应该花很长时间。一本好书也可以帮助你，试试[iPhone Developers Cookbook](https://rads.stackoverflow.com/amzn/click/com/0321555457)，它提供了很好的讨论和分解的例子，关于特定问题和更广泛的覆盖范围，比如表格等。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-10T13:52:45.170

1.  目标-C。密切关注内存管理，即保留、释放和自动释放。

2.  我花了大约一个月（兼职）来获得一些非常有效的东西。然后在了解我第一次做错了什么之后再进行一个月的重构。这是在 NDA 到位的时候，所以现在可能会更容易。

3.  您需要加入 iPhone 开发者计划。对证书进行排序后，安装开发应用程序只需从 XCode 运行即可。（检查 iTunes Connect 文档。它非常好。）

在别人的 iPhone 上安装是搞清楚临时部署（困难）或上传到 iTunes（容易）的问题。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-10T13:33:32.433

首先：如果您还没有Mac，请购买Mac，Windows工具管道基本上不存在。在大多数情况下，试图在非苹果硬件上运行 OSX 是非法的。

下载 iPhone SDK。[http://developer.apple.com/iphone/](http://developer.apple.com/iphone/)应该有你需要的一切。

Objective-C 有点奇怪，但一个中等的程序员应该能够很快地掌握它。

安装：我不知道对不起...使用应用商店；）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-10T13:34:33.943

学习目标 C 并使用 Cocoa。有比 iPhone 代码更多的例子。根据您使用的环境，Xcode 和为 iPHone 开发的经验可能会发生很大变化，所以准备好购买一些书籍并花大量时间摸索吧！

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-10T14:44:40.370

了解如何浏览 Apple 的文档。

例如[UIView 类参考](http://developer.apple.com/iphone/library/documentation/UIKit/Reference/UIView_Class/UIView/UIView.html)。我花了一点时间来了解情况。XCode 还具有集成到 IDE 中的出色文档浏览器。一旦您可以将文档告诉您的内容翻译成代码，整个 API 就会打开。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-14T03:40:38.403

使用 XCode 中的研究助理。（在帮助菜单下）那东西震撼了我的世界。突出显示像 ABRecordRef 这样的类，它会给你一个关于它是什么以及如何使用它的快速概要，并带有参考文档的链接。

Apple 文档的一个坏处是，他们在讨论方法时没有明确的示例说明如何调用方法。这是一个明显的疏忽，IMO。很多时候，我只是希望有一个简单的例子来说明如何使用某些东西，然后我就去谷歌了。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-06-16T20:32:15.477

上面的信息非常好，但我要补充一点，熟悉 XCode 中的文档非常有价值。这意味着您需要转到 Developer Documentation 窗口的 DOC SETS 部分，并确保您拥有正在编写代码的 iPhone OS 的文档。我花了很多时间编写代码，这些代码依赖于 NSObject 中的方法，这些方法在 Cocoa 中可用，但在 iPhone OS 上不可用。

# algorithm - 用于检测点“簇”的算法

> ID：356035
> 
> 赞同：43
> 
> 时间：2008-12-10T13:28:26.017
> 
> 标签：algorithm, data-structures, image-processing

我有一个 2D 区域，该区域上分布有“点”。我现在正在尝试检测点的“簇”，即具有一定高密度点的区域。

关于如何优雅地检测这些区域的任何想法（或有想法的文章的链接）？

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2008-12-10T13:40:43.650

如何为您的空间定义任意分辨率，并计算该矩阵中的每个点，测量从该点到所有点的距离，然后您可以制作“热图”并使用阈值来定义集群。

这是一个很好的处理练习，也许稍后我会发布一个解决方案。

编辑：

这里是：

```
//load the image
PImage sample;
sample = loadImage("test.png");
size(sample.width, sample.height);
image(sample, 0, 0);
int[][] heat = new int[width][height];

//parameters
int resolution = 5; //distance between points in the gridq
int distance = 8; //distance at wich two points are considered near
float threshold = 0.5;
int level = 240; //leven to detect the dots
int sensitivity = 1; //how much does each dot matters

//calculate the "heat" on each point of the grid
color black = color(0,0,0);
loadPixels();
for(int a=0; a<width; a+=resolution){
  for(int b=0; b<height; b+=resolution){
    for(int x=0; x<width; x++){
      for(int y=0; y<height; y++){
        color c = sample.pixels[y*sample.width+x];        
        /**
         * the heat should be a function of the brightness and the distance, 
         * but this works (tm)
         */
        if(brightness(c)<level && dist(x,y,a,b)<distance){
          heat[a][b] += sensitivity;
        }
      }
    }
  }
}

//render the output
for(int a=0; a<width; ++a){
  for(int b=0; b<height; ++b){
    pixels[b*sample.width+a] = color(heat[a][b],0,0);
  }
}
updatePixels();
filter(THRESHOLD,threshold); 
```

编辑 2（效率稍低但输出相同的代码）：

```
//load the image
PImage sample;
sample = loadImage("test.png");
size(sample.width, sample.height);
image(sample, 0, 0);
int[][] heat = new int[width][height];
int dotQ = 0;
int[][] dots = new int[width*height][2];
int X = 0;
int Y = 1;

//parameters
int resolution = 1; //distance between points in the grid
int distance = 20; //distance at wich two points are considered near
float threshold = 0.6;
int level = 240; //minimum brightness to detect the dots
int sensitivity = 1; //how much does each dot matters

//detect all dots in the sample
loadPixels();
for(int x=0; x<width; x++){
 for(int y=0; y<height; y++){
   color c = pixels[y*sample.width+x];
   if(brightness(c)<level) {
       dots[dotQ][X] += x;
       dots[dotQ++][Y] += y;
   }
 }
}

//calculate heat
for(int x=0; x<width; x+=resolution){
 for(int y=0; y<height; y+=resolution){
   for(int d=0; d<dotQ; d++){
     if(dist(x,y,dots[d][X],dots[d][Y]) < distance)
       heat[x][y]+=sensitivity;
   }
 }
}

//render the output
for(int a=0; a<width; ++a){
 for(int b=0; b<height; ++b){
   pixels[b*sample.width+a] = color(heat[a][b],0,0);
 }
}
updatePixels();
filter(THRESHOLD,threshold);

/** This smooths the ouput with low resolutions
* for(int i=0; i<10; ++i) filter(DILATE);
* for(int i=0; i<3; ++i) filter(BLUR);
* filter(THRESHOLD);
*/ 
```

以及（减少的）肯特样本的输出：

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2009-01-05T18:28:04.540

我建议使用**均值偏移内核**来找到点的密度中心。

[均值偏移图 http://cvr.yorku.ca/members/gradstudents/kosta/compvis/file_mean_shift_path.gif](http://cvr.yorku.ca/members/gradstudents/kosta/compvis/file_mean_shift_path.gif)

*该图显示了一个均值偏移内核（最初以集群边缘为中心）向集群的最高密度点收敛。*

## 理论上（简而言之）：

这个问题的几个答案已经暗示了平均转移方式：

*   [P Daddy 对图像进行模糊和寻找最暗点](https://stackoverflow.com/questions/356035/algorithm-for-detecting-clusters-of-dots#356109)其实是一种[核密度估计](http://en.wikipedia.org/wiki/Kernel_density_estimation)（KDE）方法，它是mean-shift 的理论基础。

*   j0rd4n和[Bill the Lizard](https://stackoverflow.com/questions/356035/algorithm-for-detecting-clusters-of-dots#356070)[都](https://stackoverflow.com/questions/356035/algorithm-for-detecting-clusters-of-dots#356124)建议将你的空间离散成块并检查它们的密度。

您在动画图中看到的是这两个建议的组合：它使用移动的“块”（即内核）来寻找局部最高密度。

均值偏移是一种迭代方法，它使用称为*内核*的像素邻域（类似于[这个](https://stackoverflow.com/questions/356035/algorithm-for-detecting-clusters-of-dots#356109)）并使用它来计算基础图像数据的*平均值*。在这种情况下，*平均值*是内核坐标的像素加权平均值。

在每次迭代中，*内核的均值*定义了下一次迭代的中心坐标——这称为*shift*。因此名称为*mean-shift*。迭代的停止条件是当移动距离下降到 0 时（即我们在附近最密集的点）。

可以在[这个 ppt 演示文稿中找到对均值偏移的全面介绍（理论和应用）。](http://www.wisdom.weizmann.ac.il/~deniss/vision_spring04/files/mean_shift/mean_shift.ppt)

## 在实践中：

[OpenCV](http://opencv.willowgarage.com/wiki/CvReference)中提供了均值偏移的实现：

```
int cvMeanShift( const CvArr* prob_image, CvRect window,
                 CvTermCriteria criteria, CvConnectedComp* comp ); 
```

[O'Reilly 的 Learning OpenCv（谷歌书摘录）](http://books.google.com/books?id=seAgiOfu2EIC&pg=PA337&dq=opencv+mean+shift&ei=5CpiSfr6HoysNrX8regC#PPA337,M1)也很好地解释了它的工作原理。基本上只是给它你的点图像（prob_image）。

**在实践中，诀窍是选择适当的内核大小**。内核越小，您就越需要将其启动到集群。内核越大，您的初始位置就越随机。但是，如果图像中有多个点簇，内核可能会在它们之间收敛。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2008-12-10T13:56:30.967

[为了给Trebs](https://stackoverflow.com/questions/356035/algorithm-for-detecting-clusters-of-dots#356058)的声明添加一点帮助，我认为重要的是首先实际定义集群的定义是什么，当然，“点更靠近”，这是相当模糊的。

以我生成的这个样本集为例，我知道那里有一个簇形状，我创建了它。

但是，以编程方式识别这个“集群”可能很困难。

人类可能认为这是一个大的环形星团，但您的自动化程序更有可能将其确定为一系列半近距离的较小星团。

另外，请注意，在大局的背景下，存在超高密度区域，只是分散注意力

您需要考虑这种行为，并可能将密度相似的集群链接在一起，仅由低密度的微不足道的空隙隔开，具体取决于具体的应用。

无论您开发什么，我至少会对它如何识别该集合中的数据感兴趣。

（我认为研究 HDRI ToneMapping 背后的技术可能是有序的，因为这些或多或少在光密度上起作用，并且有“局部”色调贴图和“全局”色调贴图，每个都会产生不同的结果）

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2008-12-10T13:57:14.287

对 2D 区域的副本应用模糊滤镜。就像是

```
1 2 3 2 1
2 4 6 4 2
3 6 9 6 3
2 4 6 4 2
1 2 3 2 1 
```

“较暗”区域现在识别点簇。

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2008-12-10T13:31:32.700

您可以尝试创建数据的[四叉树](http://en.wikipedia.org/wiki/Quadtree)表示。图中较短的路径对应于高密度区域。

或者，更清楚地说：给定四叉树和层序遍历，每个由“点”组成的低层节点将代表一个高密度区域。随着节点级别的增加，这些节点代表“点”的较低密度区域

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2008-12-10T13:38:00.987

形态学方法怎么样？

将阈值图像扩大一些数字（取决于点的目标密度），然后集群中的点将显示为单个对象。

OpenCV 支持形态学操作（一系列图像处理库也是如此）：

[http://www.seas.upenn.edu/~bensapp/opencvdocs/ref/opencvref_cv.htm#cv_imgproc_morphology](http://www.seas.upenn.edu/~bensapp/opencvdocs/ref/opencvref_cv.htm#cv_imgproc_morphology)

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-12-10T14:02:38.490

这听起来确实像一个学术问题。

想到的解决方案涉及 r* 树。这将您的总面积划分为单独大小且可能重叠的框。完成此操作后，您可以通过计算平均距离来确定每个框是否代表一个“集群”。

[R* 树](http://www.sciencedirect.com/science?_ob=ArticleURL&_udi=B6V14-4JVSWH9-1&_user=2312441&_rdoc=1&_fmt=&_orig=search&_sort=d&view=c&_acct=C000056871&_version=1&_urlVersion=0&_userid=2312441&md5=ae55911bd270ab06b07927338a094733)

如果这种方法变得难以实施，您最好将数据网格分成大小相等的细分并确定每个细分中是否出现集群；但是，您必须非常注意这种方法的边缘条件。我建议在初始划分之后，您通过定义边缘的某个阈值内的数据点重新组合区域。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2009-02-04T19:06:12.527

1.  为数据拟合概率密度函数。我将使用“高斯混合”并使用由 K-means 算法启动的期望最大化学习来拟合它。如果没有 EM，K-means 本身有时就足够了。集群的数量本身需要使用模型顺序选择算法来启动。
2.  然后，可以使用模型用 p(x) 对每个点进行评分。即得到该点由模型生成的后验概率。
3.  找到最大 p(x) 以找到聚类质心。

这可以使用机器学习工具箱在 Matlab 等工具中快速编码。MoG/EM 学习/K-Means 聚类在网络/标准文本中得到广泛讨论。我最喜欢的文本是 Duda/Hart 的“模式分类”。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2008-12-10T13:40:48.580

“具有一定高密度的区域”意味着您大约知道每单位面积有多少个点您认为高。这导致我采用网格方法，您可以将总区域分成适当大小的子区域，然后计算每个区域中的点数。一旦您在阈值附近找到网格区域，您也可以搜索网格的相邻区域。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2008-12-10T14:46:43.953

我认为这取决于点和簇之间有多少分离。如果距离很大且不规则，我会首先对这些点进行[三角剖分](http://en.wikipedia.org/wiki/Delaunay_triangulation)，然后删除/隐藏所有边长在统计上较大的三角形。剩余的子三角剖分形成任意形状的簇。遍历这些子三角剖分的边缘会产生多边形，这些多边形可用于确定哪些特定点位于每个集群中。根据需要，还可以将多边形与已知形状进行比较，例如 Kent Fredric 的圆环。

IMO，网格方法适用于快速和肮脏的解决方案，但在稀疏数据上很快就会变得非常饥饿。四叉树更好，但对于任何更复杂的分析，TIN 是我个人的最爱。

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2010-09-01T14:34:55.927

让我把它组织成一篇研究论文

**一种。问题陈述**

引用[Epaga](https://stackoverflow.com/q/356035/191241)的话：“我有一个 2D 区域，该区域上分布着“点”。我现在正在尝试检测点的“簇”，即点的密度一定很高的区域。

请注意，没有任何地方提到这些点来自图像。（尽管它们可以作为一个订购）。

**b.方法** 案例1：如果点只是点（点=二维空间中的点）。在这种情况下，您将已经拥有所有点的 x 和 y 位置。问题归结为对点进行聚类之一。[Ivan](https://stackoverflow.com/questions/356035/algorithm-for-detecting-clusters-of-dots/414042#414042)在提出解决方案方面做得很好。他还总结了其他类似的答案。除了他的帖子之外，我的 2cts 是您考虑是否先验地知道集群的数量。算法（可以相应地选择有监督与无监督聚类）。

情况 2：如果这些点确实来自图像。这里需要澄清问题。让我用这张图解释一下![替代文字](https://i.stack.imgur.com/ZjubB.jpg) 如果不区分点的灰度值，那么组 1、2、3、4 和 5 都是“不同的簇”。但是，如果根据灰度值进行区分，则簇 5 是棘手的，因为点具有不同的灰度值。

无论如何，通过光栅扫描图像并存储非零（非白色）像素的坐标，可以将此问题简化为情况 1。如前所述，聚类算法可以用来计算聚类和聚类中心的数量。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-12-10T13:37:20.070

我会计算从每个点到所有其他点的距离。然后对距离进行排序。彼此之间的距离低于阈值的点被视为*Near*。一组彼此*靠近的点是一个簇。*

问题是，当人们看到图表时，*集群*可能很清楚，但没有明确的数学定义。您需要定义您的*接近*阈值，可能需要根据经验对其进行调整，直到您的算法结果（或多或少）等于您认为是聚类的结果。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-12-10T14:02:17.100

你可以在你的平面上覆盖一个逻辑网格。如果网格包含一定数量的点，则将其视为“密集”，然后可以对其进行细化。这在 GIS 应用程序中使用集群容差时会做很多事情。使用网格有助于划分细化算法。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-12-10T14:30:25.173

您可以为此使用遗传算法。如果您将“集群”定义为具有高点密度的矩形子区域，您可以创建一组初始“解决方案”，每个解决方案都包含一些随机生成的非重叠矩形集群. 然后，您将编写一个评估每个解决方案的“适应度函数”——在这种情况下，您希望适应度函数最小化簇的总数，同时最大化每个簇中的点密度。

您最初的一组“解决方案”很可能都很糟糕，但有些可能会比其他的稍微不那么糟糕。您使用适应度函数消除最差的解决方案，然后通过杂交上一代的“赢家”来创建下一代解决方案。通过一代又一代地重复这个过程，你应该最终得到一个或多个解决这个问题的好方法。

为了使遗传算法起作用，问题空间的不同可能解决方案在解决问题的能力方面必须彼此逐渐不同。点簇非常适合这一点。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2009-02-25T12:32:05.997

Cluster 3.0 包括一个用于进行统计聚类的 C 方法库。它有几种不同的方法，可能会也可能不会解决您的问题，具体取决于您的点簇采用什么形式。该库可在[此处](http://bonsai.ims.u-tokyo.ac.jp/~mdehoon/software/cluster/software.htm)获得，并在 Python 许可下分发。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2009-06-15T18:41:36.383

您是否尝试过 Accusoft Pegasus 的 ImagXpress 等简单的现成解决方案？

BlobRemoval 方法可以针对像素数和密度进行调整，以找到打孔，即使它们不是连续的。（您也可以尝试使用扩张功能来缩小差距）

在绝大多数情况下，只要稍微玩一下，你就可以得到你需要的结果，只需要很少的代码或科学。

C#:
public void DocumentBlobRemoval(矩形区域, int MinPixelCount, int MaxPixelCount, short MinDensity)

# xslt - 列表中的元素测试

> ID：356039
> 
> 赞同：5
> 
> 时间：2008-12-10T13:30:17.820
> 
> 标签：xslt

对于我正在编写的样式表（实际上是一组样式表，每个都生成不同的输出格式），我需要评估某个值是否存在于值列表中。在这种情况下，被测试的值取自元素的属性。要对其进行测试的列表来自样式表的调用，并被视为顶级（在我调用或 Saxon 等效调用`<xsl:param>`时在命令行上提供）。`xsltproc`例如，输入值可能是：

```
v0_01,v0_10,v0_99 
```

而每个属性值看起来都非常像*一个*这样的值。（使用逗号分隔值还是使用空格并不重要——我现在选择了逗号，因为我计划通过命令行开关将值传递给`xsltproc`，而使用空格则需要引用参数，并且我很懒惰，不想输入额外的两个字符。）

我正在寻找类似于 Perl 的东西`grep`，其中我可以查看我当前拥有的值是否包含在列表中。它可以通过子字符串测试来完成，但这必须很聪明，以免得到误报（`v0_01`不应该匹配包含 的字符串`v0_011`）。XSL/XSLT 支持的唯一非标量数据类型似乎是节点集。我想可以将列表转换为一组文本节点，但这似乎有点过头了，即使与使用额外的边界检查进行子字符串测试以防止错误匹配相比也是如此。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-10T13:43:10.447

实际上，使用 XPath 字符串函数是正确的方法。您必须确保也测试定界符：

```
contains(concat(',' $list, ','), concat(',', $value, ',')) 
```

将返回一个布尔值。或者您可以使用其中之一：

```
substring-before(concat('|,' $list, ',|'), concat(',', $value, ',')) 
```

或者

```
substring-after(concat('|,' $list, ',|'), concat(',', $value, ',')) 
```

如果结果是空字符串，`$value`则不在列表中。

编辑：

@Dimitre 的评论是正确的：`substring-before()`(or `substring-after()`) 如果找到的字符串是列表中的第一个（或最后一个），也会返回空字符串。为了避免这种情况，我在列表的开头和结尾添加*了一些内容。*仍然`contains()`是推荐的方法。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-10T17:03:47.297

除了 Tomalak 提供的 XPath 1.0 解决方案之外，

**使用 XPath 2.0**还可以标记值列表：

    **`exists(tokenize($list, ',')[. = $value])`**

计算`true()`当且仅当`$value`包含在值列表中`$list`

# javascript - 如何找出 TabSelection

> ID：356060
> 
> 赞同：0
> 
> 时间：2008-12-10T13:37:58.117
> 
> 标签：javascript, jquery

我使用以下代码来开发选项卡。

```
$(document).ready(function() {
    $('#container-1').tabs();
}
 ....
<div id="container-1">
    <ul>
        <li><a href="#fragment-1"><span>Home</span></a></li>
        <li><a href="#fragment-2"><span>Contact</span></a></li>
    </ul>
</div>

... 
```

它工作正常！我需要标签点击事件。如果是*主页*选项卡单击，我必须这样做`alert();`。我如何实现这一目标？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-10T14:07:16.547

*设置Home*选项卡 span 元素的 id ：

```
<li><a href="#fragment-1"><span id="home">Home</span></a></li> 
```

并将点击处理程序添加到某处：

```
$("#home").click(function()
{
    alert("Home tab is selected!");
}); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-10T20:10:05.410

就个人而言，我会在选项卡配置本身中处理这一切，而不是将点击事件添加到最终将成为选项卡的可点击部分的元素。如果您通过选项卡配置执行此操作，那么您的所有选项卡逻辑都是集中的，从而使事情变得更清洁，您无需熟悉选项卡的实现细节：

```
 $(document).ready(function() {
      $('#container-1').tabs({
          selected : function(e, ui) {
            if (ui.index == 0) {
                alert('Home clicked!');
            }
          }        
      }); 
  });
   ....
  <div  id="container-1">
        <ul>
            <li><a href="#fragment-1"><span>Home</span></a></li>
            <li><a href="#fragment-2"><span>Contact</span></a></li>

         </ul>
  </div> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-10T14:04:46.410

如果您想要选项卡单击事件，您可以执行以下操作之一。

```
$("#tabid").click(function(e) {
    e.preventDefault();
    // Do tab click logic
}); 
```

或者

```
$(".tabclass").click(function(e) {
    e.preventDefault();
    // Do tab click logic
}); 
```

搜索[jQuery 备忘单](http://www.google.co.uk/search?hl=en&q=jquery+cheatsheet&meta=&btnG=Google+Search)，为自己找到一个非常有用的 jQuery 备忘单。

# c# - C#/.NET 作为新标准游戏开发平台的可行性？

> ID：356068
> 
> 赞同：23
> 
> 时间：2008-12-10T13:39:53.137
> 
> 标签：c#, mono, xna

长期以来，C++ 一直是主导的游戏开发语言。许多 AAA 质量的 3D 引擎可满足任何预算。

我的问题是，随着 XNA 的兴起，C# 和 .NET 框架的定位是否足以成为新的标准游戏开发平台？显然，XNA 框架（Windows、Xbox、Zune）固有的跨平台特性有其优势，但这些优势足以吸引大型游戏开发工作室转换吗？

就个人而言，我在为新项目使用 C#/XNA 和通过 jMonkeyEngine 使用 Java 之间纠结。我非常希望我的游戏可以移植到多个平台，而我知道的唯一能够实现这一点的语言是 C# 和 Java。我很想看到一个由 OpenGL 提供支持并在 Mono 上运行的 XNA 代码库的实现，但我认为这只是一厢情愿的想法。

我很想知道其他人在用 C++ 以外的东西构建 3D 游戏时的经历。

* * *

## 回答 #1

> 赞同：66
> 
> 时间：2008-12-17T10:13:04.317

我认为 C++ 将在未来 10 年内过时，就像汇编一样。我是一名超过 15 年的专业游戏程序员。在 90 年代初期，很多人说 C 语言对于游戏来说不够高效。在 90 年代后期，同样的人说 C 还可以，但 C++ 对于性能关键的应用程序（例如游戏）来说太慢了。现在 C++ 是标准的高性能语言，人们认为其他语言会太慢。与此同时，今天的游戏使用 Lua、Python 或 Unrealscript 等脚本语言来编写游戏逻辑，其速度比 C# 或 Java 慢十倍。

当您在游戏中进行数学运算时，C++ 的速度要快得多。在 C# 或 Java 中做线性代数非常慢。然而，这只是游戏的一部分（10 - 25%）。说到游戏逻辑瓶颈是内存访问，因此使用其他语言不会显着降低性能。游戏的工具方面，过去占代码的 50-80%，实际上不需要任何 C++。它在 C# 中愉快地运行，对于几乎任何工具来说都足够快。

也不要忘记 C++ 是从 C 派生的，C 是在 70 年代初提出的。所以 C++ 在很多方面都已经过时了。最烦人的可能是预处理器，它会破坏透明度并导致编译时间过长。一个最先进的 C++ 游戏引擎的平均编译时间为 30-60 分钟。在这种情况下，您可以编译人类曾经制作的每一个 C# 和 Java 项目。缺乏自我反思和动态代码创建也是一个缺点。克服这些缺点通常需要花费大量的开发时间。

然而，C++ 开发成本很高，如果游戏工作室冒着失败的风险，转而使用尚未在游戏开发中得到证实的新技术，则成本会更高。这也是一个重要因素，大多数有经验的游戏程序员只使用 C/C++，他们没有使用其他语言的经验，这肯定会增加切换的风险。正因为如此，在接下来的几年中，您可能不会看到游戏工作室转向 C#。然而，微软旗下的工作室很可能会在未来 5 年内通过 C# 游戏大获成功，这将使其他工作室相信用 C# 制作 AAA 游戏是可行的，然后你会看到越来越多的工作室转向使用 C# C＃。

目前，我的建议是：如果你想制作一个 AAA 多平台游戏，除了 C++ 游戏的运行部分，你别无选择。考虑在工具端使用 C#。有效地连接托管和非托管代码有点棘手，但从长远来看，值得您为此付出努力。如果你做一个爱好项目或一个 B 标题，其中性能不如开发成本/时间重要，那么忘记 C++，只使用 C# 来做所有事情，并花一些额外的时间来优化数学。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2008-12-10T13:52:03.377

大型游戏工作室可能不会很快采用 XNA。一些独立开发者正在使用它，但绝对有可能最终非常成功并将 C++ 抛在后面。

XNA 提供了许多可用于游戏开发的类，但许多其他类通常选择使用成熟的游戏引擎。尽管如果您是编程游戏新手，XNA 对于初学者来说是相当不错的。

C# 是用于游戏开发的好语言。游戏开发产生需要声音、高级图形、人工智能、物理等的应用程序。所有这些都需要强大且相当快速的语言环境。虽然大多数顶级 PC 和主机游戏都是用 C++ 编写的，但 C# 有一个路线图，可能会将 C++ 抛在后面。C++0x 即将到来的变化无疑会在一段时间内重新振兴 C++，但 C# 看起来已经准备好超越它。

如果你真的想成为一名游戏开发者，我会敦促你至少学习 C++ 并编写自己的游戏引擎。使用预制的游戏引擎很容易，您可以编写一些“没问题”的代码，但您会遇到许多无法编写代码的限制。您将有效地受限于游戏引擎的功能（除非您可以访问源代码，然后您可以根据自己的喜好对其进行修改）。

学习 C++，最好学习 OpenGL :) 一旦你了解了 OpenGL，你就可以很容易地学习 DirectX。

一旦你了解了 C++，C# 就是小菜一碟。

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2008-12-10T14:11:22.013

虽然前一段时间 XNA Professional 发布了，但微软现在似乎专注于 Express 版本（尽管它失去了名称中的“Express”），这似乎是针对爱好者市场而不是商业市场。除其他外，这在很大程度上使 XBox 360 社区受益，因为他们现在允许爱好者开发者为 Windows 和 XBox 360 开发他们的游戏，然后*在 XBox 网络上销售他们的游戏*，这是一件好事。

我真的很想看到 XNA 在职业世界中获得动力，但这不会发生，除非它可用于其他主要游戏平台（PS3 和 Wii）。问题不仅在于 XNA 框架/API，还在于语言/框架要求，所以你甚至不能用 C# 编写游戏，然后在 Microsoft 平台上使用 XNA 和在其他平台上使用 OpenGL。

XNA 的性能配置文件也针对业余爱好者市场而非商业市场，尽管性能似乎相当不错，并且在野外也有令人印象深刻的演示。

编辑：

如果您的问题实际上是“我现在是否应该在预算远低于一百万的项目中使用 XNA”，我的回答肯定是肯定的。去试试吧，它是免费的。而且它很强大。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2008-12-10T14:27:04.413

90 年代末，我在一个叫 Newfire 的地方工作。在资金枯竭之前，我们有一个引擎可以渲染一个 10,000 平方公里的沉浸式世界，分辨率为 10 厘米。您可以一次吸引大量玩家并持续地扭曲景观。该引擎在带有 Voodoo 2 卡的 P200 上以帧速率运行。

大部分引擎都是用精心调校的 C++ 编写的。所有的游戏代码都是用 C 或 C++ 或 Java 编写的。我也有原型代码，可以使用下推自动机定义对象行为，该自动机可以做非常好的人工智能。它几乎没有占用 CPU 时间。游戏逻辑的执行与渲染相比相形见绌。

有一次，我使用我们的软件渲染器演示了在 Java 中运行的康威生命游戏。这些细胞是放置在平面上的立方体，随着年龄的增长，它们会出现或消失并改变颜色。当游戏以每秒 4 代的固定生成速率运行时，3D 显示以 20+ FPS 的速度运行，同样在带有**软件**渲染器的 P200 上运行。

所以答案不一定是 C++。与任何问题领域一样，答案是在该领域内表现最佳的语言。C++ 在渲染引擎的领域中运行良好，但对于实际的游戏逻辑和规则，许多语言运行良好。Python很棒。C# 很棒。Java很棒。

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2009-01-02T07:43:45.227

正如海报所提到的，XNA 目前仅限于微软平台，但您仍然可以使用 C#、.NET 和任何 .NET 编程语言以跨平台的方式开发游戏。

Mono 运行时确实提供了一个跨平台引擎，可用于在各种桌面平台（Windows、MacOS、Linux）以及游戏机（Novell 支持的 Wii，PS3 即将推出）下运行您的 C#（或 .NET 代码）很快和 Xbox360 “靠你自己”）。

还有一个名为 Unity3D 的商业游戏平台使用 Mono 创造了奇迹。作为游戏开发环境，它们是一款超越 XNA 的游戏 IDE：物理、图形、灯光、模型、碰撞均由原生 C++ 代码处理，而所有游戏逻辑（AI、相机控制、视图等）均由通常用 C# 或 UnityScript 编写的托管代码（一种强类型的 Javascript 实现，可以为您提供两全其美的优势：Javascript 语法，但可以提高性能的强类型）。

* * *

## 回答 #6

> 赞同：9
> 
> 时间：2009-02-15T20:45:35.733

我不是游戏开发者（除非你算上我在 1982 年用 Atari 6502 汇编语言编写的黑白棋游戏），但我确实有很多用 Assembly -> C -> Objective-C 编写商业应用软件的经验（任何人都记得下一个立方体？）-> C++ -> Java，现在是 C#。

我无法比较游戏库，但我确实对 C++ 与 C# 有一些想法。

IMO，由于性能原因，C++ 优于 C# 的论点并不像某些人所相信的那么简单。我工作的软件对性能至关重要。我们与编译为本机代码（可能是用 C/C++/Assembly 编写）的产品竞争，我们在性能上获胜，以至于我们的竞争对手甚至在[某些应用程序](http://www.spreadsheetgear.com/customers/microsoft.msn.money.aspx)中使用我们的软件而不是他们自己的软件。

如果 C++ 比 C# 快，那怎么可能呢？以我的经验，答案是对于任何复杂的系统，架构和算法比语言更重要（假设潜在的性能在同一个范围内——C++ 和 C# 肯定是这样）。尽管我是一名全职 C++ 开发人员的时间比我使用 C# 的时间长，但我在 C# 方面的工作效率比 C++ 高得多。这意味着我可以花比以前更多的时间来重构和完善我的架构和算法。

现在，有时我不得不承认我很想用 C++ 重写我的应用程序的核心引擎，因为我知道我可以让它运行得更快并且使用更少的内存。到目前为止，我一直抵制这种冲动，因为我相信生产力的下降意味着我的 C++ 代码库比我继续使用 C# 时的速度慢只是时间问题。

我相信游戏开发过渡到 C# 和/或 Java 和/或其他比 C++ 更高效的语言只是时间问题。使用 Java 数年，现在使用 C# 数年，我会押注 C# - 但这只是一个猜测。

如果我今天开始从事游戏开发，我肯定会押注 Silverlight 和/或 WPF。WPF 基于 Direct3D 构建。微软已经宣布 Silverlight 3 将支持硬件辅助 3D 渲染。Silverlight 在各种浏览器和 Mac 上运行。使用 Moonlight，它可以在 Linux 上运行。它已针对某些电话平台宣布。由于 Silverlight 本质上是 WPF 的轻量级版本（它最初是作为“WPF/E”引入的，其中“E”表示无处不在），您可以在不花费大量额外精力的情况下同时定位两者。您可以在浏览器中使用 Silverlight 为您的游戏提供轻量级版本（免费或广告支持），以及使用 WPF 并在 Windows 上运行的严肃游戏玩家的真正优惠。

Better yet, be the person to create an excellent gaming library which allows for easy targeting of both WPF and Silverlight 3 (or Silverlight 2 if you don't need hardware assisted 3D rendering).

While I have seen no official announcement, it is hard to believe that the next generation of XBox will not support Silverlight. Of course, I would not look for it on Sony or Nintendo gaming systems.

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2008-12-10T14:39:23.190

我认为当人们谈论 XNA 或 java 游戏框架或 pygame 或其他什么时，就会出现一种 BS 精英主义。是的，专业游戏公司将长期使用 C++。但是 Atmospherian 正在为他自己的项目询问一些事情，所以我会假设他是一个业余爱好者（如果他是 Epic 的首席执行官或者我怀疑他会在 SO 上发帖）

无论如何，仅仅因为你不能在其中编写 FarCry 并不意味着它是一个毫无价值的框架。大型工作室级别的游戏需要数百万美元和数十人，但 XNA/Java/pygame/etc 允许业余爱好者做一些非常棒的事情。业余游戏和大型工作室游戏是两种不同的野兽，需要两套不同的工具。

为了回答您的问题，大气：

-是的，XNA 可以做一些很酷的东西，人们用它来制作一些很酷的游戏。

- 如果您希望 XNA 跨平台并与单声道一起工作，我认为这在技术上是可行的，但我不会屏住呼吸。

- 如果你想最终在游戏行业找到一份工作，你将需要学习 C++。

-我认为目前获得工作的跨平台游戏引擎的阻力最小的路径是[pyglet](http://pyglet.org/)。与 java 或 C++ 相比，易用性可能会以速度为代价。

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2008-12-10T18:05:47.530

只需添加到对话中... C#/.NET 在其他非微软平台上肯定是可用的。

*   [单声道.Wii](http://www.mono-project.com/Mono:Wii)
*   [道框架](http://www.mono-project.com/Tao)

在这两者之间，您可以定位 linux、mac、wii ...我敢肯定，如果有足够的资金/兴趣，他们也可以让 Mono 在 ps3 上运行。那时，您将能够使用 C# 为所有主要游戏平台编写代码（尽管可能不使用 XNA 本身）。

此外，对于任何想知道性能的人......很多很棒的事情正在开发中，例如 Mono 使用他们的 SIMD 扩展（当然，现在仅限 x86）对快速浮点数学的新支持：http: [//tirania.org /blog/archive/2008/Nov-03.html](http://tirania.org/blog/archive/2008/Nov-03.html)

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2008-12-10T14:44:43.037

令人惊讶的是，没有人提到移动游戏的可能性。我看不到任何托管代码在短期内与 C++ 竞争半条命和光环之类的游戏，但对于不太密集的移动设备游戏来说，它似乎有腿。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2008-12-13T15:07:10.360

作为这个问题的后续，我开始研究一些用 C++ 编写的基于 OpenGL 的 3D 引擎（CrystalSpace、Irrlicht、Panda3D），它们看起来都相当可靠。关于 Panda3D 的一个有趣说明是它是用 C++ 编写的，但您使用它的主要方式是通过 Python。在我看来，这种方法可以兼得两全其美，因为它是一个用 C++ 编写的快速引擎，并结合了 Python 编程的易用性。我将提出另一个比较这些引擎的问题。感谢您的回复。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-12-10T13:48:28.923

好吧，在这两者之间，我认为 C#/XNA 显然是基于库支持的赢家，而且考虑到微软在 DirectX 方面的经验，它确实是成熟的。话虽如此，我认为 C#/XNA 不会在很长一段时间内（如果有的话）取代 C++ 成为严肃的 3D 游戏编程（即大型开发公司）的通用语言。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-12-10T13:59:35.423

不仅要考虑工作室，还要考虑观众。只要有索尼和任天堂存在，他们就不太可能迁移 C#/XNA 平台。至少对于任天堂来说，当你拥有他们目前的大众市场吸引力时，他们将继续支配他们的开发平台。

我喜欢 XNA，因为我现在可以为我的 Zune 编写应用程序，但是用于游戏开发平台的 C++ 将存在很长时间。微软设备可能会有新的独立开发人员涌入，但我们距离看到 XNA 被全面使用（如果有的话）还有很长的路要走。

* * *

## 回答 #13

> 赞同：-1
> 
> 时间：2009-02-15T19:43:20.190

您应该对 [Lua感兴趣，因为您可以将它嵌入 C# 并从 LuaScript 访问您的对象。](http://www.lua.org/)

# wpf - 是否可以在 WPF NavigationWindow 上显示动画？

> ID：356076
> 
> 赞同：1
> 
> 时间：2008-12-10T13:42:44.880
> 
> 标签：wpf, animation, navigationwindow

我有一个承载一系列页面的 NavigationWindow。出于设计原因，页面固定为 780x580，但可以将 NavigationWindow 设置为最大化，从而在我的页面周围留下大量黑色背景。

我想展示一个相当简单、不显眼的动画（只是一些不同不透明度/大小的标签从一边流到另一边）在所有页面*后面*连续运行......合乎逻辑的地方是 NavigationWindow，这样就不会出现中断用户从一个页面导航到另一个页面。

当我在设计器中有 NavigationPage 时，Blend 和 Visual Studio 都不能让我访问控件，所以我的猜测是我不能那样做。

任何人都有关于如何做到这一点的建议，或者让我得到相同结果的解决方法？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-11T22:01:32.483

昨晚我在这个小地方闲逛，如果我想出什么，我会告诉你的。你看过[MSDN NavigationWindow ControlTemplate Example](http://msdn.microsoft.com/en-us/library/aa970054.aspx)

# apache-flex - 利用导入的 Web 服务部署 Flex 项目

> ID：356081
> 
> 赞同：0
> 
> 时间：2008-12-10T13:46:42.157
> 
> 标签：apache-flex, flexbuilder

我确信对此有一个简单的解释，但我还没有找到答案，所以我想我会把这个词告诉我的同事，因为我相信你们中的一些人已经跑了进入这个之前。

在我的（简单）开发环境中，我正在使用一些 WCF Web 服务，这些服务导入到我的 FB3 项目中，并针对 ASP.NET 开发 Web 服务器的本地实例。一切都好，没有问题——但我现在想知道的是，将这个项目部署到测试、登台和生产环境的正确方法是什么？如果我导入的代理都指向[http://localhost:1234/service.svc](http://localhost:1234/service.svc)（从中导入它们的 WSDL），而我正在部署的只是一个编译的 SWF，那么 Flex Builder 是否希望我“管理 Web服务 > 删除"、">添加"，每次我想将我编译的 Flex 项目从开发转移到测试，再到登台，最终进入生产时，重新编译和发布？有没有更简单的工作流程？

在此先感谢-希望我的问题很清楚。

干杯，克里斯

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-30T21:58:24.367

如果您的路径名会根据环境而改变，那么您可能需要为每个环境重新编译，因为这些将在 swf 中编译。

从开发和生产环境迁移时，我通常使用 ANT 脚本来处理我的编译/部署过程。这使我能够在编译期间动态更改任何路径名。这些构建文件可以集成到 Flex Builder 中，一旦您完成所有设置，这个过程就变得非常容易，并且可以通过单击或计划完成。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-31T19:06:02.810

谢谢布雷特。无论如何，我一直想深入研究自动化我的构建过程，所以现在可能和任何时候一样好。:)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-31T03:50:54.810

您不需要为每个环境构建 SWF。这是我常用的一种技术：

1.  将您的配置属性外部化为 XML 文件；在这种情况下，它可以是每个服务的 URL 或所有服务使用的基本 URL
2.  当应用程序启动时，进行 HTTPService 调用以加载 XML 文件，对其进行解析，并将您的属性存储到某个可绑定的“配置对象”中
3.  将该对象的值与依赖于 URL 的对象绑定
4.  调度指示您的配置已完成的事件。如果您的应用程序中的某些组件使用了某种单例事件调度程序，请使用它，以便通知是全局的
5.  现在继续您的应用程序的其余初始化

编排您的应用程序需要做一些工作，以使某些部分在执行步骤 1-5 之前不会初始化。但是，我认为显式处理大量此类初始化而不是在构造函数或组件的各种初始化或创建完成事件中处理是一种很好的做法。当用户注销并且其他用户登录时，您可能需要重新初始化；如果您已经将应用程序设置为可以控制的初始化，那么重新初始化将不是问题。

# python - 如何计算一个非常大的整数的第 n 个根

> ID：356090
> 
> 赞同：29
> 
> 时间：2008-12-10T13:49:19.390
> 
> 标签：python, math, nth-root

我需要一种方法来计算 Python 中长整数的第 n 个根。

我试过`pow(m, 1.0/n)`了，但它不起作用：

> 溢出错误：long int 太大而无法转换为浮点数

有任何想法吗？

长整数是指真正的长整数，例如：

> 11968003966030964356885611480383408833172346450467339251 196093144141045683463085291115677488411620264826942334897996389 485046262847265769280883237649461122479734279424416861834396522 819159219215308460065265520143082728303864638821979329804885526 557893649662037092457130509980883789368448042961108430809620626 059287437887495827369474189818588006905358793385574832590121472 680866521970802708379837148646191567765584039175249171110593159 305029014037881475265618958103073425958633163441030267478942720 703134493880117805010891574606323700178176718412858948243785754 898788359757528163558061136758276299059029113119763557411729353 915848889261125855717014320045292143759177464380434854573300054 940683350937992500211758727939459249163046465047204851616590276 724564411037216844005877918224201569391107769029955591465502737961776799311859881060956465198859727495735498887960494256488224 613682478900505821893815926193600121890632

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2008-12-10T14:22:21.443

如果这是一个非常大的数字。您可以使用二进制搜索。

```
def find_invpow(x,n):
    """Finds the integer component of the n'th root of x,
    an integer such that y ** n <= x < (y + 1) ** n.
    """
    high = 1
    while high ** n <= x:
        high *= 2
    low = high/2
    while low < high:
        mid = (low + high) // 2
        if low < mid and mid**n < x:
            low = mid
        elif high > mid and mid**n > x:
            high = mid
        else:
            return mid
    return mid + 1 
```

例如：

```
>>> x = 237734537465873465
>>> n = 5
>>> y = find_invpow(x,n)
>>> y
2986
>>> y**n <= x <= (y+1)**n
True
>>>
>>> x = 119680039660309643568856114803834088331723464504673392511960931441>
>>> n = 45
>>> y = find_invpow(x,n)
>>> y
227661383982863143360L
>>> y**n <= x < (y+1)**n
True
>>> find_invpow(y**n,n) == y
True
>>> 
```

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2008-12-10T14:17:08.303

[Gmpy](http://code.google.com/p/gmpy/)是一个 C 编码的 Python 扩展模块，它包装了 GMP 库，为 Python 代码提供快速多精度算术（整数、有理数和浮点数）、随机数生成、高级数论函数等。

包括一个`root`功能：

> x.root(n)：返回一个 2 元素元组 (y,m)，使得 y 是 x 的（可能被截断的）第 n 个根；m，一个普通的 Python int，如果根是精确的 (x==y**n)，则为 1，否则为 0。n 必须是一个普通的 Python int，>=0。

例如，第 20 个根：

```
>>> import gmpy
>>> i0=11968003966030964356885611480383408833172346450467339251 
>>> m0=gmpy.mpz(i0)
>>> m0
mpz(11968003966030964356885611480383408833172346450467339251L)
>>> m0.root(20)
(mpz(567), 0) 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-12-11T00:44:34.683

您可以通过避免使用 while 循环来使其运行速度稍快一些，而支持将低设置为 10 ** (len(str(x)) / n) 并将高设置为低 * 10。可能更好的是替换 len(str(x )) 具有按位长度并使用位移位。根据我的测试，我估计第一次加速 5%，第二次加速 25%。如果整数足够大，这可能很重要（并且加速可能会有所不同）。不要在没有仔细测试的情况下相信我的代码。我做了一些基本的测试，但可能错过了一个边缘案例。此外，这些加速会因所选数量而异。

如果您使用的实际数据比您在此处发布的数据大得多，则此更改可能是值得的。

```
from timeit import Timer

def find_invpow(x,n):
    """Finds the integer component of the n'th root of x,
    an integer such that y ** n <= x < (y + 1) ** n.
    """
    high = 1
    while high ** n < x:
        high *= 2
    low = high/2
    while low < high:
        mid = (low + high) // 2
        if low < mid and mid**n < x:
            low = mid
        elif high > mid and mid**n > x:
            high = mid
        else:
            return mid
    return mid + 1

def find_invpowAlt(x,n):
    """Finds the integer component of the n'th root of x,
    an integer such that y ** n <= x < (y + 1) ** n.
    """
    low = 10 ** (len(str(x)) / n)
    high = low * 10

    while low < high:
        mid = (low + high) // 2
        if low < mid and mid**n < x:
            low = mid
        elif high > mid and mid**n > x:
            high = mid
        else:
            return mid
    return mid + 1

x = 237734537465873465
n = 5
tests = 10000

print "Norm", Timer('find_invpow(x,n)', 'from __main__ import find_invpow, x,n').timeit(number=tests)
print "Alt", Timer('find_invpowAlt(x,n)', 'from __main__ import find_invpowAlt, x,n').timeit(number=tests) 
```

标准 0.626754999161

替代 0.566340923309

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-03-12T04:04:59.007

如果您正在寻找标准的东西，请快速以高精度编写。我会使用十进制并将精度（getcontext（）.prec）调整到至少x的长度。

## 代码（Python 3.0）

```
from decimal import *

x =   '11968003966030964356885611480383408833172346450467339251\
196093144141045683463085291115677488411620264826942334897996389\
485046262847265769280883237649461122479734279424416861834396522\
819159219215308460065265520143082728303864638821979329804885526\
557893649662037092457130509980883789368448042961108430809620626\
059287437887495827369474189818588006905358793385574832590121472\
680866521970802708379837148646191567765584039175249171110593159\
305029014037881475265618958103073425958633163441030267478942720\
703134493880117805010891574606323700178176718412858948243785754\
898788359757528163558061136758276299059029113119763557411729353\
915848889261125855717014320045292143759177464380434854573300054\
940683350937992500211758727939459249163046465047204851616590276\
724564411037216844005877918224201569391107769029955591465502737\
961776799311859881060956465198859727495735498887960494256488224\
613682478900505821893815926193600121890632'

minprec = 27
if len(x) > minprec: getcontext().prec = len(x)
else:                getcontext().prec = minprec

x = Decimal(x)
power = Decimal(1)/Decimal(3)

answer = x**power
ranswer = answer.quantize(Decimal('1.'), rounding=ROUND_UP)

diff = x - ranswer**Decimal(3)
if diff == Decimal(0):
    print("x is the cubic number of", ranswer)
else:
    print("x has a cubic root of ", answer) 
```

## 回答

x是22873918786185635329056863961725521583023133411 451452349318109627653540670761962215971994403670045614485973722724603798 107719978813658857014190047742680490088532895666963698551709978502745901 704433723567548799463129652706705873694274209728785041817619032774248488 2965377218610139128882473918261696612098418立方数

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-12-10T14:29:36.250

哦，对于*那么*大的数字，您将使用十进制模块。

ns: 你的数字作为一个字符串

```
ns = "11968003966030964356885611480383408833172346450467339251196093144141045683463085291115677488411620264826942334897996389485046262847265769280883237649461122479734279424416861834396522819159219215308460065265520143082728303864638821979329804885526557893649662037092457130509980883789368448042961108430809620626059287437887495827369474189818588006905358793385574832590121472680866521970802708379837148646191567765584039175249171110593159305029014037881475265618958103073425958633163441030267478942720703134493880117805010891574606323700178176718412858948243785754898788359757528163558061136758276299059029113119763557411729353915848889261125855717014320045292143759177464380434854573300054940683350937992500211758727939459249163046465047204851616590276724564411037216844005877918224201569391107769029955591465502737961776799311859881060956465198859727495735498887960494256488224613682478900505821893815926193600121890632"
from decimal import Decimal
d = Decimal(ns)
one_third = Decimal("0.3333333333333333")
print d ** one_third 
```

答案是：2.287391878618402702753613056E+305

TZ 指出这不准确……他是对的。这是我的测试。

```
from decimal import Decimal

def nth_root(num_decimal, n_integer):
    exponent = Decimal("1.0") / Decimal(n_integer)
    return num_decimal ** exponent

def test():
    ns = "11968003966030964356885611480383408833172346450467339251196093144141045683463085291115677488411620264826942334897996389485046262847265769280883237649461122479734279424416861834396522819159219215308460065265520143082728303864638821979329804885526557893649662037092457130509980883789368448042961108430809620626059287437887495827369474189818588006905358793385574832590121472680866521970802708379837148646191567765584039175249171110593159305029014037881475265618958103073425958633163441030267478942720703134493880117805010891574606323700178176718412858948243785754898788359757528163558061136758276299059029113119763557411729353915848889261125855717014320045292143759177464380434854573300054940683350937992500211758727939459249163046465047204851616590276724564411037216844005877918224201569391107769029955591465502737961776799311859881060956465198859727495735498887960494256488224613682478900505821893815926193600121890632"
    nd = Decimal(ns)
    cube_root = nth_root(nd, 3)
    print (cube_root ** Decimal("3.0")) - nd

if __name__ == "__main__":
    test() 
```

大约关闭 10**891

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-12-10T23:42:49.893

可能出于你的好奇心：

[http://en.wikipedia.org/wiki/Hensel_Lifting](http://en.wikipedia.org/wiki/Hensel_Lifting)

这可能是 Maple 用来实际找到大数的第 n 个根的技术。

摆出事实`x^n - 11968003.... = 0 mod p`，然后从那里开始......

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2016-05-11T18:55:54.423

我想出了自己的答案，它采用了@Mahmoud Kassem 的想法，简化了代码，并使其更可重用：

```
def cube_root(x):
    return decimal.Decimal(x) ** (decimal.Decimal(1) / decimal.Decimal(3)) 
```

我在 Python 3.5.1 和 Python 2.7.8 中对其进行了测试，似乎运行良好。

结果将具有与运行函数的十进制上下文指定的位数相同的位数，默认情况下为 28 位小数。根据模块中`power`函数的文档，“[结果定义明确，但只是“几乎总是正确舍入”。](https://docs.python.org/3/library/decimal.html#decimal.Context.power) “。如果您需要更准确的结果，可以按以下方式完成：`decimal`

```
with decimal.localcontext() as context:
    context.prec = 50
    print(cube_root(42)) 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-10T13:57:42.993

在旧版本的 Python 中，`1/3`等于 0。在 Python 3.0 中，`1/3`等于 0.33333333333（并且`1//3`等于 0）。

因此，要么更改您的代码以使用`1/3.0`或切换到 Python 3.0。

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2008-12-10T13:54:39.240

尝试将指数转换为浮点数，因为 / 在 Python 中的默认行为是整数除法

n**(1/浮点数(3))

* * *

## 回答 #10

> 赞同：-3
> 
> 时间：2008-12-10T14:23:20.227

好吧，如果你不是特别担心精度，你可以把它转换成一个字符串，去掉一些数字，使用指数函数，然后将结果乘以你切掉的根数。

例如 32123 约等于 32 * 1000，立方根约等于 32 * 1000 的立方根。后者可以通过将 0 的个数除以 3 来计算。

这避免了使用扩展模块的需要。

# xml - linq to xml：如何从元素中选择值

> ID：356091
> 
> 赞同：2
> 
> 时间：2008-12-10T13:49:57.923
> 
> 标签：xml, linq

我需要返回一个元素列表`<AssetText>`。我下面的查询只返回第一个`AssetText`。任何想法都非常感谢。

```
var q = from c in xDoc.Descendants("Product")
        where (int) c.Element("ProductView").Element("ViewId") == 44
        select (string) c.Element("ProductView").Element("AssetText").Element("Text"); 
```

```
<Product>
  <ProductView>
    <ViewId>44</ViewId>
    <AssetText>
      <Text>my first Asset Text</Text>
    </AssetText>
    <AssetText>
      <Text>my second Asset Text</Text>
    </AssetText>
  </ProductView>
  <ProductView>
    <ViewId>45</ViewId>
    <AssetText>
      <Text>my third Asset Text</Text>
    </AssetText>
  </ProductView>
</Product> 
```

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-10T14:00:02.690

更改`Element("AssetText")`为`Elements("AssetText")`获取所有 AssetText 元素。请注意，您还需要更改查询的其余部分，否则它只会在第一个 ProductView 的 ViewId 为 44 时匹配。我建议您使用第二个“from”子句：

```
var q = from c in xDoc.Descendants("Product")
        from view in c.Elements("ProductView")
        where (int) view.Element("ViewId") == 44
        from assetText in view.Elements("AssetText")
        select assetText.Element("Text"); 
```

# bash - 如何在 bash 中等待几个子进程完成，并在任何子进程以代码结束时返回退出代码！=0 ！= 0？

> ID：356100
> 
> 赞同：670
> 
> 时间：2008-12-10T13:54:26.353
> 
> 标签：bash, process, wait

如何在 bash 脚本中等待从该脚本生成的几个子进程完成，然后`!=0`在任何子进程以 code 结尾时返回退出代码`!=0`？

简单的脚本：

```
#!/bin/bash
for i in `seq 0 9`; do
  doCalculations $i &
done
wait 
```

上面的脚本将等待所有 10 个生成的子进程，但它总是会给出退出状态`0`（请参阅 参考资料`help wait`）。如何修改此脚本，以便`1`在任何子进程以 code 结尾时发现生成的子进程的退出状态并返回退出代码`!=0`？

有没有比收集子进程的 PID、按顺序等待它们并对退出状态求和更好的解决方案？

* * *

## 回答 #1

> 赞同：644
> 
> 时间：2008-12-10T14:07:51.350

[`wait`](https://www.gnu.org/software/bash/manual/html_node/Job-Control-Builtins.html#index-wait)还（可选）采用`PID`等待的进程，并`$!`获得`PID`在后台启动的最后一个命令的 。修改循环以将`PID`每个生成的子进程的 存储到一个数组中，然后再次循环等待每个`PID`.

```
# run processes and store pids in array
for i in $n_procs; do
    ./procs[${i}] &
    pids[${i}]=$!
done

# wait for all pids
for pid in ${pids[*]}; do
    wait $pid
done 
```

* * *

## 回答 #2

> 赞同：328
> 
> 时间：2009-02-05T09:36:30.007

[http://jeremy.zawodny.com/blog/archives/010717.html](http://jeremy.zawodny.com/blog/archives/010717.html)：

```
#!/bin/bash

FAIL=0

echo "starting"

./sleeper 2 0 &
./sleeper 2 1 &
./sleeper 3 0 &
./sleeper 2 0 &

for job in `jobs -p`
do
echo $job
    wait $job || let "FAIL+=1"
done

echo $FAIL

if [ "$FAIL" == "0" ];
then
echo "YAY!"
else
echo "FAIL! ($FAIL)"
fi 
```

* * *

## 回答 #3

> 赞同：93
> 
> 时间：2016-03-16T14:12:28.557

这是使用`wait`.

运行一些进程：

```
$ sleep 10 &
$ sleep 10 &
$ sleep 20 &
$ sleep 20 & 
```

`wait`然后用命令等待他们：

```
$ wait < <(jobs -p) 
```

^(或者只是`wait`（没有参数）所有人。)

这将等待后台的所有作业都完成。

^(如果`-n`提供了该选项，则等待下一个作业终止并返回其退出状态。)

请参阅：`help wait`和`help jobs`语法。

但是缺点是这只会返回最后一个 ID 的状态，因此您需要检查每个子进程的状态并将其存储在变量中。

或者使您的计算功能在失败时创建一些文件（空或带有失败日志），然后检查该文件是否存在，例如

```
$ sleep 20 && true || tee fail &
$ sleep 20 && false || tee fail &
$ wait < <(jobs -p)
$ test -f fail && echo Calculation failed. 
```

* * *

## 回答 #4

> 赞同：56
> 
> 时间：2014-10-07T16:05:48.917

简单地说：

```
#!/bin/bash

pids=""

for i in `seq 0 9`; do
   doCalculations $i &
   pids="$pids $!"
done

wait $pids

...code continued here ... 
```

**更新：**

正如多位评论者所指出的，上述等待所有进程完成后再继续，但如果其中一个失败，则不会退出并失败，这可以与@Bryan、@SamBrightman 和其他人建议的以下修改有关：

```
#!/bin/bash

pids=""
RESULT=0

for i in `seq 0 9`; do
   doCalculations $i &
   pids="$pids $!"
done

for pid in $pids; do
    wait $pid || let "RESULT=1"
done

if [ "$RESULT" == "1" ];
    then
       exit 1
fi

...code continued here ... 
```

* * *

## 回答 #5

> 赞同：55
> 
> 时间：2012-02-16T12:16:01.183

如果您安装了 GNU Parallel，您可以执行以下操作：

```
# If doCalculations is a function
export -f doCalculations
seq 0 9 | parallel doCalculations {} 
```

GNU Parallel 会给你退出代码：

*   0 - 所有作业均无错误地运行。

*   1-253 - 一些作业失败。退出状态给出失败作业的数量

*   254 - 超过 253 个作业失败。

*   255 - 其他错误。

观看介绍视频以了解更多信息：http: [//pi.dk/1](http://pi.dk/1)

* * *

## 回答 #6

> 赞同：41
> 
> 时间：2009-06-26T10:29:48.990

到目前为止，这是我想出的。如果孩子终止，我想看看如何中断睡眠命令，这样就不必调整`WAITALL_DELAY`到一个人的使用情况。

```
waitall() { # PID...
  ## Wait for children to exit and indicate whether all exited with 0 status.
  local errors=0
  while :; do
    debug "Processes remaining: $*"
    for pid in "$@"; do
      shift
      if kill -0 "$pid" 2>/dev/null; then
        debug "$pid is still alive."
        set -- "$@" "$pid"
      elif wait "$pid"; then
        debug "$pid exited with zero exit status."
      else
        debug "$pid exited with non-zero exit status."
        ((++errors))
      fi
    done
    (("$#" > 0)) || break
    # TODO: how to interrupt this sleep when a child terminates?
    sleep ${WAITALL_DELAY:-1}
   done
  ((errors == 0))
}

debug() { echo "DEBUG: $*" >&2; }

pids=""
for t in 3 5 4; do 
  sleep "$t" &
  pids="$pids $!"
done
waitall $pids 
```

* * *

## 回答 #7

> 赞同：23
> 
> 时间：2013-06-13T05:14:14.787

为了并行化这个......

```
for i in $(whatever_list) ; do
   do_something $i
done 
```

翻译成这个...

```
for i in $(whatever_list) ; do echo $i ; done | ## execute in parallel...
   (
   export -f do_something ## export functions (if needed)
   export PATH ## export any variables that are required
   xargs -I{} --max-procs 0 bash -c ' ## process in batches...
      {
      echo "processing {}" ## optional
      do_something {}
      }' 
   ) 
```

*   **如果一个进程发生错误**，它不会中断其他进程，但**会导致整个序列的退出代码非零**。
*   在任何特定情况下，可能需要也可能不需要导出函数和变量。
*   您可以`--max-procs`根据需要多少并行度进行设置（`0`意思是“一次全部”）。
*   [GNU Parallel](https://www.gnu.org/software/parallel)提供了一些额外的功能来代替`xargs`-- 但它并不总是默认安装。
*   在此示例中，`for`循环并不是绝对必要的，因为`echo $i`基本上只是重新生成`$(whatever_list`) 的输出。我只是认为使用`for`关键字可以更容易地了解正在发生的事情。
*   Bash 字符串处理可能会令人困惑——我发现使用单引号最适合包装非平凡的脚本。
*   您可以轻松地中断整个操作（使用 ^C 或类似方法），[这与更直接的 Bash 并行方法不同](https://stackoverflow.com/q/16865123/86967)。

这是一个简化的工作示例...

```
for i in {0..5} ; do echo $i ; done |xargs -I{} --max-procs 2 bash -c '
   {
   echo sleep {}
   sleep 2s
   }' 
```

* * *

## 回答 #8

> 赞同：15
> 
> 时间：2019-05-03T14:41:18.837

这是我使用的东西：

```
#wait for jobs
for job in `jobs -p`; do wait ${job}; done 
```

* * *

## 回答 #9

> 赞同：10
> 
> 时间：2016-02-24T21:35:00.003

我看到这里列出了很多很好的例子，也想把我的也扔进去。

```
#! /bin/bash

items="1 2 3 4 5 6"
pids=""

for item in $items; do
    sleep $item &
    pids+="$! "
done

for pid in $pids; do
    wait $pid
    if [ $? -eq 0 ]; then
        echo "SUCCESS - Job $pid exited with a status of $?"
    else
        echo "FAILED - Job $pid exited with a status of $?"
    fi
done 
```

我使用与并行启动/停止服务器/服务非常相似的东西并检查每个退出状态。对我很有用。希望这可以帮助某人！

* * *

## 回答 #10

> 赞同：9
> 
> 时间：2011-10-03T19:51:05.460

*如果任何一个doCalculations*失败，以下代码将等待所有计算完成并返回退出状态 1 。

```
#!/bin/bash
for i in $(seq 0 9); do
   (doCalculations $i >&2 & wait %1; echo $?) &
done | grep -qv 0 && exit 1 
```

* * *

## 回答 #11

> 赞同：8
> 
> 时间：2008-12-10T14:28:32.417

我不相信 Bash 的内置功能是可能的。

您**可以**在孩子退出时收到通知：

```
#!/bin/sh
set -o monitor        # enable script job control
trap 'echo "child died"' CHLD 
```

但是，没有明显的方法可以在信号处理程序中获取孩子的退出状态。

获取该子状态通常是`wait`较低级别 POSIX API 中的函数族的工作。不幸的是，Bash 对此的支持是有限的——您可以等待*一个*特定的子进程（并获得其退出状态），或者您可以等待*所有*子进程，并且总是得到 0 结果。

看起来不可能做的是相当于`waitpid(-1)`, 直到*任何子*进程返回为止。

* * *

## 回答 #12

> 赞同：7
> 
> 时间：2013-09-06T21:01:22.220

如果您有 bash 4.2 或更高版本，以下内容可能对您有用。它使用关联数组来存储任务名称及其“代码”以及任务名称及其 pid。我还内置了一个简单的速率限制方法，如果您的任务消耗大量 CPU 或 I/O 时间并且您想要限制并发任务的数量，它可能会派上用场。

该脚本在第一个循环中启动所有任务，并在第二个循环中使用结果。

这对于简单的情况来说有点矫枉过正，但它允许非常整洁的东西。例如，可以将每个任务的错误消息存储在另一个关联数组中，并在一切稳定后打印它们。

```
#! /bin/bash

main () {
    local -A pids=()
    local -A tasks=([task1]="echo 1"
                    [task2]="echo 2"
                    [task3]="echo 3"
                    [task4]="false"
                    [task5]="echo 5"
                    [task6]="false")
    local max_concurrent_tasks=2

    for key in "${!tasks[@]}"; do
        while [ $(jobs 2>&1 | grep -c Running) -ge "$max_concurrent_tasks" ]; do
            sleep 1 # gnu sleep allows floating point here...
        done
        ${tasks[$key]} &
        pids+=(["$key"]="$!")
    done

    errors=0
    for key in "${!tasks[@]}"; do
        pid=${pids[$key]}
        local cur_ret=0
        if [ -z "$pid" ]; then
            echo "No Job ID known for the $key process" # should never happen
            cur_ret=1
        else
            wait $pid
            cur_ret=$?
        fi
        if [ "$cur_ret" -ne 0 ]; then
            errors=$(($errors + 1))
            echo "$key (${tasks[$key]}) failed."
        fi
    done

    return $errors
}

main 
```

* * *

## 回答 #13

> 赞同：7
> 
> 时间：2016-08-03T23:36:10.890

这是我的版本，适用于多个 pid，如果执行时间过长，则记录警告，如果执行时间超过给定值，则停止子进程。

```
function WaitForTaskCompletion {
    local pids="${1}" # pids to wait for, separated by semi-colon
    local soft_max_time="${2}" # If execution takes longer than $soft_max_time seconds, will log a warning, unless $soft_max_time equals 0.
    local hard_max_time="${3}" # If execution takes longer than $hard_max_time seconds, will stop execution, unless $hard_max_time equals 0.
    local caller_name="${4}" # Who called this function
    local exit_on_error="${5:-false}" # Should the function exit program on subprocess errors       

    Logger "${FUNCNAME[0]} called by [$caller_name]."

    local soft_alert=0 # Does a soft alert need to be triggered, if yes, send an alert once 
    local log_ttime=0 # local time instance for comparaison

    local seconds_begin=$SECONDS # Seconds since the beginning of the script
    local exec_time=0 # Seconds since the beginning of this function

    local retval=0 # return value of monitored pid process
    local errorcount=0 # Number of pids that finished with errors

    local pidCount # number of given pids

    IFS=';' read -a pidsArray <<< "$pids"
    pidCount=${#pidsArray[@]}

    while [ ${#pidsArray[@]} -gt 0 ]; do
        newPidsArray=()
        for pid in "${pidsArray[@]}"; do
            if kill -0 $pid > /dev/null 2>&1; then
                newPidsArray+=($pid)
            else
                wait $pid
                result=$?
                if [ $result -ne 0 ]; then
                    errorcount=$((errorcount+1))
                    Logger "${FUNCNAME[0]} called by [$caller_name] finished monitoring [$pid] with exitcode [$result]."
                fi
            fi
        done

        ## Log a standby message every hour
        exec_time=$(($SECONDS - $seconds_begin))
        if [ $((($exec_time + 1) % 3600)) -eq 0 ]; then
            if [ $log_ttime -ne $exec_time ]; then
                log_ttime=$exec_time
                Logger "Current tasks still running with pids [${pidsArray[@]}]."
            fi
        fi

        if [ $exec_time -gt $soft_max_time ]; then
            if [ $soft_alert -eq 0 ] && [ $soft_max_time -ne 0 ]; then
                Logger "Max soft execution time exceeded for task [$caller_name] with pids [${pidsArray[@]}]."
                soft_alert=1
                SendAlert

            fi
            if [ $exec_time -gt $hard_max_time ] && [ $hard_max_time -ne 0 ]; then
                Logger "Max hard execution time exceeded for task [$caller_name] with pids [${pidsArray[@]}]. Stopping task execution."
                kill -SIGTERM $pid
                if [ $? == 0 ]; then
                    Logger "Task stopped successfully"
                else
                    errrorcount=$((errorcount+1))
                fi
            fi
        fi

        pidsArray=("${newPidsArray[@]}")
        sleep 1
    done

    Logger "${FUNCNAME[0]} ended for [$caller_name] using [$pidCount] subprocesses with [$errorcount] errors."
    if [ $exit_on_error == true ] && [ $errorcount -gt 0 ]; then
        Logger "Stopping execution."
        exit 1337
    else
        return $errorcount
    fi
}

# Just a plain stupid logging function to be replaced by yours
function Logger {
    local value="${1}"

    echo $value
} 
```

例如，等待所有三个进程完成，如果执行时间超过 5 秒，则记录警告，如果执行时间超过 120 秒，则停止所有进程。不要在失败时退出程序。

```
function something {

    sleep 10 &
    pids="$!"
    sleep 12 &
    pids="$pids;$!"
    sleep 9 &
    pids="$pids;$!"

    WaitForTaskCompletion $pids 5 120 ${FUNCNAME[0]} false
}
# Launch the function
someting 
```

* * *

## 回答 #14

> 赞同：7
> 
> 时间：2020-01-13T20:44:08.287

等待所有作业并返回最后一个失败作业的退出代码。与上述解决方案不同，这不需要 pid 保存或修改脚本的内部循环。离开，然后等待。

```
function wait_ex {
    # this waits for all jobs and returns the exit code of the last failing job
    ecode=0
    while true; do
        [ -z "$(jobs)" ] && break
        wait -n
        err="$?"
        [ "$err" != "0" ] && ecode="$err"
    done
    return $ecode
} 
```

编辑：修复了可能被运行不存在的命令的脚本愚弄的错误。

* * *

## 回答 #15

> 赞同：6
> 
> 时间：2012-03-20T11:42:08.120

只需将结果存储在外壳之外，例如在文件中。

```
#!/bin/bash
tmp=/tmp/results

: > $tmp  #clean the file

for i in `seq 0 9`; do
  (doCalculations $i; echo $i:$?>>$tmp)&
done      #iterate

wait      #wait until all ready

sort $tmp | grep -v ':0'  #... handle as required 
```

* * *

## 回答 #16

> 赞同：6
> 
> 时间：2014-02-13T09:37:12.980

我对此进行了尝试，并结合了此处其他示例中的所有最佳部分。该脚本将在*任何*`checkpids`后台进程退出时执行该函数，并输出退出状态而不诉诸轮询。

 *```
#!/bin/bash

set -o monitor

sleep 2 &
sleep 4 && exit 1 &
sleep 6 &

pids=`jobs -p`

checkpids() {
    for pid in $pids; do
        if kill -0 $pid 2>/dev/null; then
            echo $pid is still alive.
        elif wait $pid; then
            echo $pid exited with zero exit status.
        else
            echo $pid exited with non-zero exit status.
        fi
    done
    echo
}

trap checkpids CHLD

wait 
```

* * *

## 回答 #17

> 赞同：5
> 
> 时间：2014-01-10T01:17:04.613

```
#!/bin/bash
set -m
for i in `seq 0 9`; do
  doCalculations $i &
done
while fg; do true; done 
```

*   `set -m`允许您在脚本中使用 fg & bg
*   `fg`，除了把最后一个进程放在前台之外，和它前台的进程有相同的退出状态
*   `while fg``fg`当任何以非零退出状态退出时将停止循环

不幸的是，当后台进程以非零退出状态退出时，这将无法处理。（循环不会立即终止。它会等待前面的进程完成。）

* * *

## 回答 #18

> 赞同：5
> 
> 时间：2014-12-03T13:01:08.090

我刚刚将脚本修改为后台并并行化进程。

我做了一些实验（在 Solaris 上同时使用 bash 和 ksh）并发现 'wait' 输出退出状态，如果它不为零，或者在没有提供 PID 参数时返回非零退出的作业列表。例如

重击：

```
$ sleep 20 && exit 1 &
$ sleep 10 && exit 2 &
$ wait
[1]-  Exit 2                  sleep 20 && exit 2
[2]+  Exit 1                  sleep 10 && exit 1 
```

克什：

```
$ sleep 20 && exit 1 &
$ sleep 10 && exit 2 &
$ wait
[1]+  Done(2)                  sleep 20 && exit 2
[2]+  Done(1)                  sleep 10 && exit 1 
```

此输出被写入 stderr，因此 OP 示例的简单解决方案可能是：

```
#!/bin/bash

trap "rm -f /tmp/x.$$" EXIT

for i in `seq 0 9`; do
  doCalculations $i &
done

wait 2> /tmp/x.$$
if [ `wc -l /tmp/x.$$` -gt 0 ] ; then
  exit 1
fi 
```

虽然这样：

```
wait 2> >(wc -l) 
```

还将返回一个计数但没有 tmp 文件。这也可以这样使用，例如：

```
wait 2> >(if [ `wc -l` -gt 0 ] ; then echo "ERROR"; fi) 
```

但这并不比 tmp 文件 IMO 有用得多。我找不到一种有用的方法来避免 tmp 文件，同时也避免在子 shell 中运行“等待”，这根本不起作用。

* * *

## 回答 #19

> 赞同：4
> 
> 时间：2016-10-28T17:14:07.097

这里已经有很多答案，但我很惊讶似乎没有人建议使用数组......所以这就是我所做的 - 这可能对未来的某些人有用。

```
n=10 # run 10 jobs
c=0
PIDS=()

while true

    my_function_or_command &
    PID=$!
    echo "Launched job as PID=$PID"
    PIDS+=($PID)

    (( c+=1 ))

    # required to prevent any exit due to error
    # caused by additional commands run which you
    # may add when modifying this example
    true

do

    if (( c < n ))
    then
        continue
    else
        break
    fi
done 

# collect launched jobs

for pid in "${PIDS[@]}"
do
    wait $pid || echo "failed job PID=$pid"
done 
```

* * *

## 回答 #20

> 赞同：4
> 
> 时间：2017-02-13T10:41:38.223

这行得通，应该和@HoverHell 的回答一样好，甚至更好！

```
#!/usr/bin/env bash

set -m # allow for job control
EXIT_CODE=0;  # exit code of overall script

function foo() {
     echo "CHLD exit code is $1"
     echo "CHLD pid is $2"
     echo $(jobs -l)

     for job in `jobs -p`; do
         echo "PID => ${job}"
         wait ${job} ||  echo "At least one test failed with exit code => $?" ; EXIT_CODE=1
     done
}

trap 'foo $? $$' CHLD

DIRN=$(dirname "$0");

commands=(
    "{ echo "foo" && exit 4; }"
    "{ echo "bar" && exit 3; }"
    "{ echo "baz" && exit 5; }"
)

clen=`expr "${#commands[@]}" - 1` # get length of commands - 1

for i in `seq 0 "$clen"`; do
    (echo "${commands[$i]}" | bash) &   # run the command via bash in subshell
    echo "$i ith command has been issued as a background job"
done

# wait for all to finish
wait;

echo "EXIT_CODE => $EXIT_CODE"
exit "$EXIT_CODE"

# end 
```

当然，我已经在一个 NPM 项目中永久保存了这个脚本，它允许您并行运行 bash 命令，这对测试很有用：

[https://github.com/ORESoftware/generic-subshel​​l](https://github.com/ORESoftware/generic-subshell)

* * *

## 回答 #21

> 赞同：4
> 
> 时间：2019-09-02T07:38:38.700

正是出于这个目的，我编写了一个`bash`名为`:for`.

*注意*：`:for`不仅保留并返回失败函数的退出代码，还会终止所有并行运行的实例。在这种情况下可能不需要。

```
#!/usr/bin/env bash

# Wait for pids to terminate. If one pid exits with
# a non zero exit code, send the TERM signal to all
# processes and retain that exit code
#
# usage:
# :wait 123 32
function :wait(){
    local pids=("$@")
    [ ${#pids} -eq 0 ] && return $?

    trap 'kill -INT "${pids[@]}" &>/dev/null || true; trap - INT' INT
    trap 'kill -TERM "${pids[@]}" &>/dev/null || true; trap - RETURN TERM' RETURN TERM

    for pid in "${pids[@]}"; do
        wait "${pid}" || return $?
    done

    trap - INT RETURN TERM
}

# Run a function in parallel for each argument.
# Stop all instances if one exits with a non zero
# exit code
#
# usage:
# :for func 1 2 3
#
# env:
# FOR_PARALLEL: Max functions running in parallel
function :for(){
    local f="${1}" && shift

    local i=0
    local pids=()
    for arg in "$@"; do
        ( ${f} "${arg}" ) &
        pids+=("$!")
        if [ ! -z ${FOR_PARALLEL+x} ]; then
            (( i=(i+1)%${FOR_PARALLEL} ))
            if (( i==0 )) ;then
                :wait "${pids[@]}" || return $?
                pids=()
            fi
        fi
    done && [ ${#pids} -eq 0 ] || :wait "${pids[@]}" || return $?
} 
```

### 用法

`for.sh`：

```
#!/usr/bin/env bash
set -e

# import :for from gist: https://gist.github.com/Enteee/c8c11d46a95568be4d331ba58a702b62#file-for
# if you don't like curl imports, source the actual file here.
source <(curl -Ls https://gist.githubusercontent.com/Enteee/c8c11d46a95568be4d331ba58a702b62/raw/)

msg="You should see this three times"

:(){
  i="${1}" && shift

  echo "${msg}"

  sleep 1
  if   [ "$i" == "1" ]; then sleep 1
  elif [ "$i" == "2" ]; then false
  elif [ "$i" == "3" ]; then
    sleep 3
    echo "You should never see this"
  fi
} && :for : 1 2 3 || exit $?

echo "You should never see this" 
```

```
$ ./for.sh; echo $?
You should see this three times
You should see this three times
You should see this three times
1 
```

* * *

### 参考

*   [1]：[博客](https://duckpond.ch/bash/2018/03/08/for.html)
*   [2]：[要点](https://gist.github.com/Enteee/c8c11d46a95568be4d331ba58a702b62)

* * *

## 回答 #22

> 赞同：4
> 
> 时间：2022-01-11T17:18:03.490

这是[@Luca Tettamanti 对最受好评的答案的](https://stackoverflow.com/a/356154/4561887)扩展，以制作一个*完全可运行的*示例。

这个答案[让我想知道](https://stackoverflow.com/questions/356100/how-to-wait-in-bash-for-several-subprocesses-to-finish-and-return-exit-code-0?page=1&tab=votes#comment124931411_356154)：

> 是什么类型的变量`n_procs`，它包含什么？是什么类型的变量`procs`，它包含什么？有人可以通过为这些变量添加定义来更新此答案以使其可运行吗？我不明白怎么做。

...并且：

*   子进程完成后如何从子进程中获取返回码（这是这个问题的全部症结所在）？

无论如何，我想通了，所以这是一个*完全可运行的*示例。

笔记：

1.  `$!`是[如何获取最后执行的子进程的PID（进程ID）](https://unix.stackexchange.com/a/30371/114401)。
2.  运行任何带有`&`其后的命令`cmd &`，例如，使其在后台作为与主进程的并行 suprocess 运行。
3.  `myarray=()`是如何在 bash 中创建数组。
4.  要了解有关`wait`内置命令的更多信息，请参阅`help wait`. 另请参阅，尤其是有关作业控制内置程序的*官方 Bash 用户手册*，例如`wait`和`jobs`，此处：[https ://www.gnu.org/software/bash/manual/html_node/Job-Control-Builtins.html#索引等待](https://www.gnu.org/software/bash/manual/html_node/Job-Control-Builtins.html#index-wait)。

## 完整的、可运行的程序：等待所有进程结束

[**multi_process_program.sh**](https://github.com/ElectricRCAircraftGuy/eRCaGuy_hello_world/blob/master/bash/multi_process_program.sh)（来自我的[eRCaGuy_hello_world 存储](https://github.com/ElectricRCAircraftGuy/eRCaGuy_hello_world)库）：

```
#!/usr/bin/env bash

# This is a special sleep function which returns the number of seconds slept as
# the "error code" or return code" so that we can easily see that we are in
# fact actually obtaining the return code of each process as it finishes.
my_sleep() {
    seconds_to_sleep="$1"
    sleep "$seconds_to_sleep"
    return "$seconds_to_sleep"
}

# Create an array of whatever commands you want to run as subprocesses
procs=()  # bash array
procs+=("my_sleep 5")
procs+=("my_sleep 2")
procs+=("my_sleep 3")
procs+=("my_sleep 4")

num_procs=${#procs[@]}  # number of processes
echo "num_procs = $num_procs"

# run commands as subprocesses and store pids in an array
pids=()  # bash array
for (( i=0; i<"$num_procs"; i++ )); do
    echo "cmd = ${procs[$i]}"
    ${procs[$i]} &  # run the cmd as a subprocess
    # store pid of last subprocess started; see:
    # https://unix.stackexchange.com/a/30371/114401
    pids+=("$!")
    echo "    pid = ${pids[$i]}"
done

# OPTION 1 (comment this option out if using Option 2 below): wait for all pids
for pid in "${pids[@]}"; do
    wait "$pid"
    return_code="$?"
    echo "PID = $pid; return_code = $return_code"
done
echo "All $num_procs processes have ended." 
```

通过运行将上面的文件更改为可执行`chmod +x multi_process_program.sh`，然后像这样运行它：

```
time ./multi_process_program.sh 
```

样本输出。查看`time`调用中命令的输出如何显示运行时间为 5.084 秒。我们还能够成功地从每个子流程中检索返回码。

> ```
> eRCaGuy_hello_world/bash$ time ./multi_process_program.sh 
> num_procs = 4
> cmd = my_sleep 5
>     pid = 21694
> cmd = my_sleep 2
>     pid = 21695
> cmd = my_sleep 3
>     pid = 21697
> cmd = my_sleep 4
>     pid = 21699
> PID = 21694; return_code = 5
> PID = 21695; return_code = 2
> PID = 21697; return_code = 3
> PID = 21699; return_code = 4
> All 4 processes have ended.
> PID 21694 is done; return_code = 5; 3 PIDs remaining.
> PID 21695 is done; return_code = 2; 2 PIDs remaining.
> PID 21697 is done; return_code = 3; 1 PIDs remaining.
> PID 21699 is done; return_code = 4; 0 PIDs remaining.
> 
> real    0m5.084s
> user    0m0.025s
> sys 0m0.061s 
> ```

## 更进一步：确定每个单独流程何时结束

如果您想在每个进程完成时执行一些操作，并且您不知道它们何时完成，您可以在无限`while`循环中轮询以查看每个进程何时终止，然后执行您想要的任何操作。

**只需注释掉上面的“OPTION 1”代码块，并用这个“OPTION 2”块代替它：**

```
# OR OPTION 2 (comment out Option 1 above if using Option 2): poll to detect
# when each process terminates, and print out when each process finishes!
while true; do
    for i in "${!pids[@]}"; do
        pid="${pids[$i]}"
        # echo "pid = $pid"  # debugging

        # See if PID is still running; see my answer here:
        # https://stackoverflow.com/a/71134379/4561887
        ps --pid "$pid" > /dev/null
        if [ "$?" -ne 0 ]; then
            # PID doesn't exist anymore, meaning it terminated

            # 1st, read its return code
            wait "$pid"
            return_code="$?"

            # 2nd, remove this PID from the `pids` array by `unset`ting the
            # element at this index; NB: due to how bash arrays work, this does
            # NOT actually remove this element from the array. Rather, it
            # removes its index from the `"${!pids[@]}"` list of indices,
            # adjusts the array count(`"${#pids[@]}"`) accordingly, and it sets
            # the value at this index to either a null value of some sort, or
            # an empty string (I'm not exactly sure).
            unset "pids[$i]"

            num_pids="${#pids[@]}"
            echo "PID $pid is done; return_code = $return_code;" \
                 "$num_pids PIDs remaining."
        fi
    done

    # exit the while loop if the `pids` array is empty
    if [ "${#pids[@]}" -eq 0 ]; then
        break
    fi

    # Do some small sleep here to keep your polling loop from sucking up
    # 100% of one of your CPUs unnecessarily. Sleeping allows other processes
    # to run during this time.
    sleep 0.1
done 
```

完整程序的示例运行和输出，其中选项 1 已注释掉且选项 2 正在使用中：

> ```
> eRCaGuy_hello_world/bash$ ./multi_process_program.sh 
> num_procs = 4
> cmd = my_sleep 5
>     pid = 22275
> cmd = my_sleep 2
>     pid = 22276
> cmd = my_sleep 3
>     pid = 22277
> cmd = my_sleep 4
>     pid = 22280
> PID 22276 is done; return_code = 2; 3 PIDs remaining.
> PID 22277 is done; return_code = 3; 2 PIDs remaining.
> PID 22280 is done; return_code = 4; 1 PIDs remaining.
> PID 22275 is done; return_code = 5; 0 PIDs remaining. 
> ```

`PID XXXXX is done`在该过程终止后，这些行中的每一行都会立即打印出来！请注意，尽管`sleep 5`（在本例中为 PID `22275`）的进程首先运行，但它最后完成，并且我们在每个进程终止后立即成功检测到它。我们还成功地检测到了每个返回码，就像在选项 1 中一样。

## 其他参考：

1.  *****+ [非常有帮助][获取后台进程的退出代码](https://stackoverflow.com/a/1570356/4561887)- 这个答案教会了我关键原则（强调添加）：

    > `wait <n>`等到带有 PID 的进程完成（它会阻塞直到进程完成，**所以你可能不想在确定进程完成之前调用它**），然后返回已完成进程的退出代码。

    换句话说，它帮助我知道*即使在该过程完成后，您仍然可以调用`wait`它来获取它的返回码！*

2.  [如何检查进程ID（PID）是否存在](https://stackoverflow.com/a/15774758/4561887)

    1.  [我的答案](https://stackoverflow.com/a/71134379/4561887)
3.  [从 Bash 数组中删除一个元素](https://stackoverflow.com/a/16861932/4561887)- 请注意，bash 数组中的元素实际上并没有被删除，它们只是“未设置”。请参阅我在上面代码中的评论以了解这意味着什么。

4.  如何使用命令行可执行文件`true`在 bash 中进行无限循环：[https ://www.cyberciti.biz/faq/bash-infinite-loop/](https://www.cyberciti.biz/faq/bash-infinite-loop/)

* * *

## 回答 #23

> 赞同：3
> 
> 时间：2013-11-05T11:33:24.490

我需要这个，但目标进程不是当前 shell 的子进程，在这种情况下`wait $PID`不起作用。我确实找到了以下替代方法：

```
while [ -e /proc/$PID ]; do sleep 0.1 ; done 
```

这取决于**procfs**的存在，它可能不可用（例如，Mac 不提供它）。因此，为了便携性，您可以改用它：

```
while ps -p $PID >/dev/null ; do sleep 0.1 ; done 
```

* * *

## 回答 #24

> 赞同：3
> 
> 时间：2015-08-27T14:50:21.643

陷阱是你的朋友。您可以在许多系统中捕获 ERR。您可以捕获 EXIT，或在 DEBUG 上执行每个命令后的一段代码。

这是除所有标准信号之外的。

# 编辑

这是错误帐户的意外登录，因此我没有看到示例请求。

在这里尝试，在我的常规帐户上。

[处理 bash 脚本中的异常](https://stackoverflow.com/questions/55042320/handle-exceptions-in-bash-scripts/55047096#55047096)

* * *

## 回答 #25

> 赞同：3
> 
> 时间：2016-06-24T16:18:02.950

```
set -e
fail () {
    touch .failure
}
expect () {
    wait
    if [ -f .failure ]; then
        rm -f .failure
        exit 1
    fi
}

sleep 2 || fail &
sleep 2 && false || fail &
sleep 2 || fail
expect 
```

`set -e`顶部使您的脚本在失败时停止。

`expect``1`如果任何子作业失败，将返回。

* * *

## 回答 #26

> 赞同：2
> 
> 时间：2013-09-26T09:45:30.387

我最近使用了这个（感谢 Alnitak）：

```
#!/bin/bash
# activate child monitoring
set -o monitor

# locking subprocess
(while true; do sleep 0.001; done) &
pid=$!

# count, and kill when all done
c=0
function kill_on_count() {
    # you could kill on whatever criterion you wish for
    # I just counted to simulate bash's wait with no args
    [ $c -eq 9 ] && kill $pid
    c=$((c+1))
    echo -n '.' # async feedback (but you don't know which one)
}
trap "kill_on_count" CHLD

function save_status() {
    local i=$1;
    local rc=$2;
    # do whatever, and here you know which one stopped
    # but remember, you're called from a subshell
    # so vars have their values at fork time
}

# care must be taken not to spawn more than one child per loop
# e.g don't use `seq 0 9` here!
for i in {0..9}; do
    (doCalculations $i; save_status $i $?) &
done

# wait for locking subprocess to be killed
wait $pid
echo 
```

从那里可以轻松推断，并触发（触摸文件，发送信号）并更改计数标准（计数触摸的文件或其他）以响应该触发。或者，如果您只想要“任何”非零 rc，只需从 save_status 中终止锁。

* * *

## 回答 #27

> 赞同：2
> 
> 时间：2015-06-25T07:57:50.917

捕获 CHLD 信号可能不起作用，因为如果它们同时到达，您可能会丢失一些信号。

```
#!/bin/bash

trap 'rm -f $tmpfile' EXIT

tmpfile=$(mktemp)

doCalculations() {
    echo start job $i...
    sleep $((RANDOM % 5)) 
    echo ...end job $i
    exit $((RANDOM % 10))
}

number_of_jobs=10

for i in $( seq 1 $number_of_jobs )
do
    ( trap "echo job$i : exit value : \$? >> $tmpfile" EXIT; doCalculations ) &
done

wait 

i=0
while read res; do
    echo "$res"
    let i++
done < "$tmpfile"

echo $i jobs done !!! 
```

* * *

## 回答 #28

> 赞同：2
> 
> 时间：2018-10-02T12:45:16.000

等待多个子进程并在其中任何一个以非零状态码退出时退出的解决方案是使用“wait -n”

```
#!/bin/bash
wait_for_pids()
{
    for (( i = 1; i <= $#; i++ )) do
        wait -n $@
        status=$?
        echo "received status: "$status
        if [ $status -ne 0 ] && [ $status -ne 127 ]; then
            exit 1
        fi
    done
}

sleep_for_10()
{
    sleep 10
    exit 10
}

sleep_for_20()
{
    sleep 20
}

sleep_for_10 &
pid1=$!

sleep_for_20 &
pid2=$!

wait_for_pids $pid2 $pid1 
```

状态代码“127”用于不存在的进程，这意味着孩子可能已经退出。

* * *

## 回答 #29

> 赞同：2
> 
> 时间：2020-04-22T18:23:23.310

差点掉进了`jobs -p`用来收集PID的陷阱，如果孩子已经退出了就不行了，如下脚本所示。我选择的解决方案是简单地调用`wait -n`N 次，其中 N 是我拥有的孩子的数量，我碰巧确定地知道。

```
#!/usr/bin/env bash

sleeper() {
    echo "Sleeper $1"
    sleep $2
    echo "Exiting $1"
    return $3
}

start_sleepers() {
    sleeper 1 1 0 &
    sleeper 2 2 $1 &
    sleeper 3 5 0 &
    sleeper 4 6 0 &
    sleep 4
}

echo "Using jobs"
start_sleepers 1

pids=( $(jobs -p) )

echo "PIDS: ${pids[*]}"

for pid in "${pids[@]}"; do
    wait "$pid"
    echo "Exit code $?"
done

echo "Clearing other children"
wait -n; echo "Exit code $?"
wait -n; echo "Exit code $?"

echo "Waiting for N processes"
start_sleepers 2

for ignored in $(seq 1 4); do
    wait -n
    echo "Exit code $?"
done 
```

输出：

```
Using jobs
Sleeper 1
Sleeper 2
Sleeper 3
Sleeper 4
Exiting 1
Exiting 2
PIDS: 56496 56497
Exiting 3
Exit code 0
Exiting 4
Exit code 0
Clearing other children
Exit code 0
Exit code 1
Waiting for N processes
Sleeper 1
Sleeper 2
Sleeper 3
Sleeper 4
Exiting 1
Exiting 2
Exit code 0
Exit code 2
Exiting 3
Exit code 0
Exiting 4
Exit code 0 
```

* * *

## 回答 #30

> 赞同：1
> 
> 时间：2018-08-09T06:20:10.777

可能存在在等待进程之前进程已完成的情况。如果我们触发等待一个已经完成的进程，它将触发一个错误，比如 pid is not a child of this shell。为避免此类情况，可以使用以下函数来判断流程是否完成：

```
isProcessComplete(){
PID=$1
while [ -e /proc/$PID ]
do
    echo "Process: $PID is still running"
    sleep 5
done
echo "Process $PID has finished"
} 
```

* * *

## 回答 #31

> 赞同：0
> 
> 时间：2018-08-16T03:07:55.427

我认为并行运行作业并检查状态的最直接方法是使用临时文件。已经有几个类似的答案（例如 Nietzche-jou ​​和 mug896）。

```
#!/bin/bash
rm -f fail
for i in `seq 0 9`; do
  doCalculations $i || touch fail &
done
wait 
! [ -f fail ] 
```

上面的代码不是线程安全的。如果您担心上面的代码会与其自身同时运行，最好使用更独特的文件名，例如 fail.$$。最后一行是为了满足要求：“当任何子进程以代码结束时返回退出代码 1 ！= 0？” 我在那里提出了一个额外的要求来清理。像这样写可能更清楚：

```
#!/bin/bash
trap 'rm -f fail.$$' EXIT
for i in `seq 0 9`; do
  doCalculations $i || touch fail.$$ &
done
wait 
! [ -f fail.$$ ] 
```

这是从多个作业收集结果的类似片段：我创建了一个临时目录，将所有子任务的输出记录在一个单独的文件中，然后将它们转储以供审查。这与问题不符-我将其作为奖励：

```
#!/bin/bash
trap 'rm -fr $WORK' EXIT

WORK=/tmp/$$.work
mkdir -p $WORK
cd $WORK

for i in `seq 0 9`; do
  doCalculations $i >$i.result &
done
wait 
grep $ *  # display the results with filenames and contents 
```

* * *

## 回答 #32

> 赞同：0
> 
> 时间：2021-06-03T18:01:14.537

我也遇到过类似的情况，但是循环子shell 存在各种问题，确保这里的其他解决方案不起作用，所以我让循环编写我要运行的脚本，最后等待。有效地：

```
#!/bin/bash
echo > tmpscript.sh
for i in `seq 0 9`; do
    echo "doCalculations $i &" >> tmpscript.sh
done
echo "wait" >> tmpscript.sh
chmod u+x tmpscript.sh
./tmpscript.sh 
```

愚蠢，但简单，并在事后帮助调试了一些东西。

如果我有时间，我会更深入地了解 GNU*并行*，但我自己的“doCalculations”过程很难。

* * *

## 回答 #33

> 赞同：0
> 
> 时间：2021-10-31T11:05:00.337

从**Bash 5.1**开始，由于引入了以下功能，有一种很好的新方法可以等待和处理多个后台作业的结果`wait -p`：

```
#!/usr/bin/env bash

# Spawn background jobs
for ((i=0; i < 10; i++)); do
    secs=$((RANDOM % 10)); code=$((RANDOM % 256))
    (sleep ${secs}; exit ${code}) &
    echo "Started background job (pid: $!, sleep: ${secs}, code: ${code})"
done

# Wait for background jobs, print individual results, determine overall result
result=0
while true; do
    wait -n -p pid; code=$?
    [[ -z "${pid}" ]] && break
    echo "Background job ${pid} finished with code ${code}"
    (( ${code} != 0 )) && result=1
done

# Return overall result
exit ${result} 
```

* * *

## 回答 #34

> 赞同：-1
> 
> 时间：2008-12-10T15:11:50.517

我在想可能`doCalculations; echo "$?" >>/tmp/acc`在发送到后台的*子shell*`wait`中运行，然后, then`/tmp/acc`将包含退出状态，每行一个。不过，我不知道附加到累加器文件的多个进程的任何后果。

以下是此建议的试用版：

*文件：做计算*

```
#!/bin/sh

random -e 20
sleep $?
random -e 10 
```

*档案：试试*

```
#!/bin/sh

rm /tmp/acc

for i in $( seq 0 20 ) 
do
        ( ./doCalculations "$i"; echo "$?" >>/tmp/acc ) &
done

wait

cat /tmp/acc | fmt
rm /tmp/acc 
```

*运行输出`./try`*

```
5 1 9 6 8 1 2 0 9 6 5 9 6 0 0 4 9 5 5 9 8 
```

# asp.net - 在集群环境中的多台服务器上部署 ASP.NET Web 应用程序的最佳方法是什么

> ID：356105
> 
> 赞同：2
> 
> 时间：2008-12-10T13:55:26.383
> 
> 标签：asp.net, deployment, web-farm

我有 6 台服务器需要将我的 ASP.NET Web 应用程序部署到。在部署增强功能时，我通常从集群中删除 3 个，部署应用程序，将它们重新轮换，然后删除其他 3 个并执行相同操作。

在部署应用程序更改时，您将遵循哪些最佳实践来最小化/消除任何客户影响

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-10T14:04:03.527

我们通常像您一样从集群中移除并换出。我们目前正在运行六台虚拟机作为我们的服务器场（它是从四台物理机扩展的，以解决虚拟机开销）。我们也一次轮换三个。我们遵循的经验法则是，在任何给定时间至少需要有一半的节点可用以保持站点正常运行，否则，我们会拉取整个站点。

此外，我们非常认真地考虑使用集群外的暖“镜像”服务器，该服务器可以部署到、测试，然后镜像以进行部署。假设图像将被完全测试，我们可以最大限度地减少部署的停机时间，而不必为每个节点进行一系列完整的冒烟测试。

# security - MOSS 域配置

> ID：356116
> 
> 赞同：0
> 
> 时间：2008-12-10T13:59:01.820
> 
> 标签：security, sharepoint, configuration, moss, dns

我们在让 SharePoint 按我们希望的方式工作时遇到了一些问题。

我们的域上有一个企业 MOSS 配置，并且在端口 80 上有指向它的条目[http://intranet 。](http://intranet)

我们还有另一个网站集，并在其中指定了一个互联网域名 http://nww.oursector.nhs.uk。我们这样做是为了允许域外但在同一物理网络上的人查看它。我们的网络管理员已将防火墙配置为将对此 url 的任何请求重定向到我们的共享点服务器。

这样做的问题是我们必须打开匿名访问，否则 SharePoint 会将此 URL 视为外部 URL，并阻止对站点的经过身份验证的访问。这意味着所有用户都需要手动登录到该网站，这使得使用 SharePoint 非常成问题。

有没有办法配置 SharePoint 以允许 url http://nww.oursector.nhs.uk 访问网站集，而无需为网站打开匿名访问？我希望用户能够浏览到该站点，并且如果经过身份验证则很好，如果没有则提示他们登录。

任何人都可以提出一种方法来实现这一目标吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-10T14:16:45.293

我想说您需要使用 SharePoint 的备用访问映射来使用正确的身份验证类型，具体取决于用户用于访问网站的方法。

基本上我认为这将适用于您的情况如下：

1.  对于内部用户，使用默认区域，使用配置了 SSO 的 NTLM。
    因此，用户应该无需登录就可以透明地登录。
2.  对于外部用户，扩展 Web 应用程序，使用 Extranet 区域，使用匿名访问。
    这将允许外部用户在不登录的情况下浏览网站。

请参阅：http: [//blogs.msdn.com/sharepoint/archive/2007/03/06/what-every-sharepoint-administrator-needs-to-know-about-alternate-access-mappings-part-1.aspx](http://blogs.msdn.com/sharepoint/archive/2007/03/06/what-every-sharepoint-administrator-needs-to-know-about-alternate-access-mappings-part-1.aspx)

# refactoring - 为清晰起见重构嵌套的 IF 语句

> ID：356121
> 
> 赞同：10
> 
> 时间：2008-12-10T14:00:32.737
> 
> 标签：refactoring, coding-style

我想重构这种笨拙的方法以使其更具可读性，它可以根据我的喜好使用许多嵌套的 IF。

你将如何重构它？

```
public static void HandleUploadedFile(string filename)
{
  try
  {
    if(IsValidFileFormat(filename)
    {
      int folderID = GetFolderIDFromFilename(filename);
      if(folderID > 0)
      {
        if(HasNoViruses(filename)
        {
          if(VerifyFileSize(filename)
          {
            // file is OK
            MoveToSafeFolder(filename);
          }
          else
          {
            DeleteFile(filename);
            LogError("file size invalid");
          }
        }
        else
        {
          DeleteFile(filename);
          LogError("failed virus test");
        }
      }
      else
      {
        DeleteFile(filename);
        LogError("invalid folder ID");
      }
    }
    else
    {
      DeleteFile(filename);
      LogError("invalid file format");
    }
  }
  catch (Exception ex)
  {
    LogError("unknown error", ex.Message);
  }
  finally
  {
    // do some things
  }
} 
```

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2008-12-10T14:06:55.703

我会将测试中的条件反转为*if bad 然后 deleteAndLog*如下例所示。这可以防止嵌套并将操作放在测试附近。

```
try{
    if(IsValidFileFormat(filename) == false){
        DeleteFile(filename);
        LogError("invalid file format");
        return;
    }

    int folderID = GetFolderIDFromFilename(filename);
    if(folderID <= 0){
        DeleteFile(filename);
        LogError("invalid folder ID");
        return;
    }
    ...

}... 
```

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-12-10T14:09:31.423

保护条款。

对于每个条件，取反，将 else 块更改为 then 块，然后返回。

因此

```
if(IsValidFileFormat(filename)
{
   // then
}
else
{
   // else
} 
```

变成：

```
if(!IsValidFileFormat(filename)
{
    // else 
    return;     
}
// then 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-10T14:22:28.607

如果您不反对使用异常，则可以在不嵌套的情况下处理检查。

警告，前方空气代码：

```
public static void HandleUploadedFile(string filename)
{
  try
  {
    int folderID = GetFolderIDFromFilename(filename);

    if (folderID == 0)
      throw new InvalidFolderException("invalid folder ID");

    if (!IsValidFileFormat(filename))
      throw new InvalidFileException("invalid file format!");

    if (!HasNoViruses(filename))
      throw new VirusFoundException("failed virus test!");

    if (!VerifyFileSize(filename))
      throw new InvalidFileSizeException("file size invalid");

    // file is OK
    MoveToSafeFolder(filename);
  }
  catch (Exception ex)
  {
    DeleteFile(filename);
    LogError(ex.message);
  }
  finally
  {
    // do some things
  }
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-10T14:05:25.520

一种可能的方法是使用单个 if 语句来检查条件何时不成立。对这些支票中的每一项都有回报。这会将您的方法变成一系列“if”块而不是嵌套。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-10T14:07:57.980

这里没有太多需要重构的地方，因为错误消息与执行的测试相关，因此您将 3 个测试分开保存。您可以选择让测试方法将错误报告回记录，这样您就不会在 if/else 树中包含它们，这可以使事情变得更简单，因为您可以简单地测试错误并记录它+删除文件.

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-10T14:53:56.857

在 David Waters 的回复中，我不喜欢重复的 DeleteFile LogError 模式。我要么编写一个名为 DeleteFileAndLog(string file, string error) 的辅助方法，要么编写如下代码：

```
public static void HandleUploadedFile(string filename)
{
    try
    {
        string errorMessage = TestForInvalidFile(filename);
        if (errorMessage != null)
        {
             LogError(errorMessage);
             DeleteFile(filename);
        }
        else
        {
            MoveToSafeFolder(filename);
        }
    }
    catch (Exception err)
    {
        LogError(err.Message);
        DeleteFile(filename);
    }
    finally { /* */ }
}

private static string TestForInvalidFile(filename)
{
    if (!IsValidFormat(filename))
        return "invalid file format.";
    if (!IsValidFolder(filename))
        return "invalid folder.";
    if (!IsVirusFree(filename))
        return "has viruses";
    if (!IsValidSize(filename))
        return "invalid size.";
    // ... etc ...
    return null;
 } 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-10T14:25:48.177

是上面的其他东西引起了我的注意。这是**一个**替代方案，在 try {}

您可以通过在 MoveToSafeFolder 之后返回来使其更短（即使您返回 finally 块也会被执行。）然后您不需要为 errorMessage 分配一个空字符串，也不需要检查 errorString 是否为空在删除文件并记录消息之前）。我没有在这里这样做，因为许多人认为提前返回令人反感，我同意在这种情况下，因为在返回之后执行 finally 块对许多人来说是不直观的。

希望这可以帮助

```
 string errorMessage = "invalid file format";
            if (IsValidFileFormat(filename))
            {
                errorMessage = "invalid folder ID";
                int folderID = GetFolderIDFromFilename(filename);
                if (folderID > 0)
                {
                    errorMessage = "failed virus test";
                    if (HasNoViruses(filename))
                    {
                        errorMessage = "file size invalid";
                        if (VerifyFileSize(filename))
                        {
                            // file is OK                                        
                            MoveToSafeFolder(filename);
                            errorMessage = "";
                        }
                    }
                }
            }
            if (!string.IsNullOrEmpty(errorMessage))
            {
                DeleteFile(filename);
                LogError(errorMessage);
            } 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-10T14:53:26.217

我会这样：

```
public enum FileStates {

MoveToSafeFolder = 1,

InvalidFileSize = 2,

FailedVirusTest = 3,

InvalidFolderID = 4,

InvalidFileFormat = 5,
}

public static void HandleUploadedFile(string filename) {
    try {
        switch (Handledoc(filename)) {
            case FileStates.FailedVirusTest:
                deletefile(filename);
                logerror("Virus");
                break;
            case FileStates.InvalidFileFormat:
                deletefile(filename);
                logerror("Invalid File format");
                break;
            case FileStates.InvalidFileSize:
                deletefile(filename);
                logerror("Invalid File Size");
                break;
            case FileStates.InvalidFolderID:
                deletefile(filename);
                logerror("Invalid Folder ID");
                break;
            case FileStates.MoveToSafeFolder:
                MoveToSafeFolder(filename);
                break;
        }
    }
    catch (Exception ex) {
        logerror("unknown error", ex.Message);
    }
}

private static FileStates Handledoc(string filename) {
    if (isvalidfileformat(filename)) {
        return FileStates.InvalidFileFormat;
    }
    if ((getfolderidfromfilename(filename) <= 0)) {
        return FileStates.InvalidFolderID;
    }
    if ((HasNoViruses(filename) == false)) {
        return FileStates.FailedVirusTest;
    }
    if ((VerifyFileSize(filename) == false)) {
        return FileStates.InvalidFileSize;
    }
    return FileStates.MoveToSafeFolder;
} 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-12-10T15:40:20.617

这个怎么样？

```
public static void HandleUploadedFile(string filename)
{  
   try  
   {    
       if(!IsValidFileFormat(filename))        
       { DeleteAndLog(filename, "invalid file format"); return; }
       if(GetFolderIDFromFilename(filename)==0) 
       { DeleteAndLog(filename, "invalid folder ID");   return; }
       if(!HasNoViruses(filename))             
       { DeleteAndLog(filename, "failed virus test");   return; }
       if(!!VerifyFileSize(filename))          
       { DeleteAndLog(filename, "file size invalid");   return; }
       // --------------------------------------------------------
       MoveToSafeFolder(filename); 
   }
   catch (Exception ex)  { LogError("unknown error", ex.Message); throw; }
   finally {    // do some things  }
}     
private void DeleteAndLog(string fileName, string logMessage)
{
    DeleteFile(fileName);
    LogError(logMessage));
} 
```

或者，更好的是……这个：

```
public static void HandleUploadedFile(string filename)
{  
   try  
   {    
       if(ValidateUploadedFile(filename))       
           MoveToSafeFolder(filename); 
   }
   catch (Exception ex)  { LogError("unknown error", ex.Message); throw; }
   finally {    // do some things  }
} 
private bool ValidateUploadedFile(string fileName)
{
   if(!IsValidFileFormat(filename))        
    { DeleteAndLog(filename, "invalid file format"); return false; }
   if(GetFolderIDFromFilename(filename)==0) 
    { DeleteAndLog(filename, "invalid folder ID");   return false; }
   if(!HasNoViruses(filename))             
    { DeleteAndLog(filename, "failed virus test");   return false; }
   if(!!VerifyFileSize(filename))          
    { DeleteAndLog(filename, "file size invalid");   return false; }
   // ---------------------------------------------------------------
   return true;

}    
private void DeleteAndLog(string fileName, string logMessage)
{
    DeleteFile(fileName);
    LogError(logMessage));
} 
```

注意：你不应该在不重新抛出它的情况下捕获和吞下通用异常......

# c# - .NET 中的程序集绑定问题

> ID：356122
> 
> 赞同：3
> 
> 时间：2008-12-10T14:00:49.490
> 
> 标签：c#, .net, app-config, assembly.load

我正在编写一个 .NET 库，由于各种原因无法在 GAC 中注册。这个 dll（我们称之为 SDK.dll）依赖于其他 DLL 才能被加载。

在编写使用此 SDK.dll 的程序时，我注意到我的程序无法加载 dll 并引发 FileNotFoundException。发生这种情况是因为虽然我能够找到引用的 SDK.dll，但 CLR 未能加载其依赖项。

我发现解决问题的唯一方法是“复制本地”SDK.dll 及其所有依赖项（由于部署问题我不能这样做），或者将我的程序编译到与 SDK.dll 相同的目录中

有没有办法告诉 SDK.dll 在哪里寻找它的依赖项而不管它的位置？也许 SDK.dll.config 文件可以提供帮助？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-10T15:25:58.227

您可以通过订阅此事件在运行时处理此问题：

```
AppDomain.CurrentDomain.AssemblyResolve 
```

当运行时无法解析程序集时会触发它。在您的事件处理程序方法中，编写您的逻辑以查找程序集并使用 Assembly.LoadFrom() 加载它。它看起来像这样：

```
public SDKClass()
{
  AppDomain.CurrentDomain.AssemblyResolve += new ResolveEventHandler(FindAssembly);
}

private Assembly FindAssembly(object sender, ResolveEventArgs args)
{
  string assemblyPath = "c:\PathToAssembly";
  string assemblyName = args.Name.Substring(0, args.Name.IndexOf(",")) + ".dll";
  string assemblyFullName = Path.Combine(assemblyPath, assemblyName);

  Assembly theAssembly = Assembly.Load(assemblyFullName);

  return theAssembly;
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-10T14:05:29.967

要在 GAC 中注册您的程序集，它必须使用[强名称](http://msdn.microsoft.com/en-us/library/szdke3d6.aspx)进行签名。

如果它依赖于其他程序集，那些应该在 GAC 中。

贝奥武夫

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-10T14:10:10.657

您不能 GAC SDK 但您可以 GAC 依赖项吗？

另请阅读有关程序集绑定的 msdn 文章：

[http://msdn.microsoft.com/en-us/library/efs781xb(VS.71).aspx](http://msdn.microsoft.com/en-us/library/efs781xb(VS.71).aspx)

如果您的程序集是强命名的，您可以使用代码库，如果它们不是，代码库必须是您的 isntall 的子目录，这将无济于事。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-10T14:53:41.617

尝试使用 DEVPATH 环境变量。

[http://msdn.microsoft.com/en-us/library/cskzh7h6.aspx](http://msdn.microsoft.com/en-us/library/cskzh7h6.aspx)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-09-29T14:17:37.297

回复：Snooganz

您可能的意思是使用加载**文件**而不是加载，如下所示：

```
Assembly theAssembly = Assembly.LoadFile(assemblyFullName); 
```

`Assembly.Load`可能会让你陷入无限循环 =)

# vim - 如何自动删除vim中的尾随空格

> ID：356126
> 
> 赞同：211
> 
> 时间：2008-12-10T14:02:31.267
> 
> 标签：vim, automation, whitespace, removing-whitespace

我在尝试在 Git 中提交一些文件时遇到“尾随空格”错误。

我想在保存 Python 文件之前自动删除这些尾随空格字符。

你能配置 Vim 来做到这一点吗？如果是这样，怎么做？

* * *

## 回答 #1

> 赞同：217
> 
> 时间：2008-12-10T14:03:53.387

[我在这里](https://vim.fandom.com/wiki/Remove_unwanted_spaces#Automatically_removing_all_trailing_whitespace)找到了答案。

将以下内容添加到我的 .vimrc 文件中就可以了：

```
autocmd BufWritePre *.py :%s/\s\+$//e 
```

最后的`e`标志意味着如果搜索模式失败，该命令不会发出错误消息。查看[`:h :s_flags`](https://vimhelp.org/change.txt.html#%3As_flags)更多。

* * *

## 回答 #2

> 赞同：178
> 
> 时间：2009-10-24T16:10:50.663

上面的编译加上保存光标位置：

```
function! <SID>StripTrailingWhitespaces()
  if !&binary && &filetype != 'diff'
    let l:save = winsaveview()
    keeppatterns %s/\s\+$//e
    call winrestview(l:save)
  endif
endfun

autocmd FileType c,cpp,java,php,ruby,python autocmd BufWritePre <buffer> :call <SID>StripTrailingWhitespaces() 
```

如果您想在保存时将其应用于任何文件，请忽略第二个`autocmd`并使用通配符`*`：

```
autocmd BufWritePre,FileWritePre,FileAppendPre,FilterWritePre *
  \ :call <SID>StripTrailingWhitespaces() 
```

* * *

## 回答 #3

> 赞同：70
> 
> 时间：2008-12-10T14:23:20.897

我通常也有一个：

```
match Todo /\s\+$/ 
```

在我的`.vimrc`文件中，因此行尾空白被突出显示。

Todo 是一种语法高亮[组名](http://vimdoc.sourceforge.net/htmldoc/syntax.html#group-name)，用于高亮关键字，如`TODO`,`FIXME`或`XXX`. 它有一个令人讨厌的难看的淡黄色背景颜色，我发现最好在代码中突出显示你**不**想要的东西:-)

* * *

## 回答 #4

> 赞同：53
> 
> 时间：2012-12-10T05:06:52.680

我既突出了现有的尾随空格，又去掉了尾随空格。

我将我的编辑器（vim）配置为在最后显示空白，例如

![在此处输入图像描述](https://i.stack.imgur.com/5ZxFP.png)

在我的 .vimrc 底部有这个：

```
highlight ExtraWhitespace ctermbg=red guibg=red
match ExtraWhitespace /\s\+$/
autocmd BufWinEnter * match ExtraWhitespace /\s\+$/
autocmd InsertEnter * match ExtraWhitespace /\s\+\%#\@<!$/
autocmd InsertLeave * match ExtraWhitespace /\s\+$/
autocmd BufWinLeave * call clearmatches() 
```

我在保存文件时从文件中“自动剥离”它，在我的情况下 *.rb 用于 ruby​​ 文件，再次在我的 ~/.vimrc 中

```
function! TrimWhiteSpace()
    %s/\s\+$//e
endfunction
autocmd BufWritePre     *.rb :call TrimWhiteSpace() 
```

* * *

## 回答 #5

> 赞同：13
> 
> 时间：2012-01-13T21:22:11.197

这是一种按多个 FileType 过滤的方法。

```
autocmd FileType c,cpp,python,ruby,java autocmd BufWritePre <buffer> :%s/\s\+$//e 
```

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2011-08-31T10:33:18.970

[从http://blog.kamil.dworakowski.name/2009/09/unobtrusive-highlighting-of-trailing.html](http://blog.kamil.dworakowski.name/2009/09/unobtrusive-highlighting-of-trailing.html)复制和粘贴（链接不再有效，但您需要的位在下面）

“这样做的好处是不会突出显示您在行尾键入的每个空格，只有在您打开文件或离开插入模式时才会突出显示。非常整洁。”

```
highlight ExtraWhitespace ctermbg=red guibg=red
au ColorScheme * highlight ExtraWhitespace guibg=red
au BufEnter * match ExtraWhitespace /\s\+$/
au InsertEnter * match ExtraWhitespace /\s\+\%#\@<!$/
au InsertLeave * match ExtraWhiteSpace /\s\+$/ 
```

* * *

## 回答 #7

> 赞同：8
> 
> 时间：2017-03-13T06:31:08.783

我在 [VIM Wikia 的评论中看到了这个解决方案 - 删除不需要的空格](http://vim.wikia.com/wiki/Remove_unwanted_spaces#Automatically_removing_all_trailing_whitespace)

我真的很喜欢它。`.`在不需要的空白处添加 a 。

[![在此处输入图像描述](https://i.stack.imgur.com/Mqh59.png)](https://i.stack.imgur.com/Mqh59.png)

# 把这个放在你的`.vimrc`

```
" Removes trailing spaces
function TrimWhiteSpace()
  %s/\s*$//
  ''
endfunction

set list listchars=trail:.,extends:>
autocmd FileWritePre * call TrimWhiteSpace()
autocmd FileAppendPre * call TrimWhiteSpace()
autocmd FilterWritePre * call TrimWhiteSpace()
autocmd BufWritePre * call TrimWhiteSpace() 
```

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2008-12-11T23:20:23.557

我就是这样做的。我不记得我从哪里偷来的。

```
autocmd BufWritePre * :call <SID>StripWhite()
fun! <SID>StripWhite()
    %s/[ \t]\+$//ge
    %s!^\( \+\)\t!\=StrRepeat("\t", 1 + strlen(submatch(1)) / 8)!ge
endfun 
```

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2014-03-16T17:30:17.273

仅从文件中删除尾随空格的解决方案在所有情况下都是不可接受的。它将在从一开始就具有此策略的项目中工作，因此没有这样的空白，您不只是将自己添加到即将到来的提交中。

假设您只想不添加尾随空白的新实例，而不影响您未编辑的行中的现有空白，以使您的提交免受与您的工作无关的更改。

在这种情况下，使用 git，您可以使用如下脚本：

```
#!/bin/sh

set -e # bail on errors

git stash save commit-cleanup
git stash show -p | sed '/^\+/s/ *$//' | git apply
git stash drop 
```

也就是说，我们存储更改，然后`+`在将更改重新应用到工作目录时过滤 diff 中的所有行以删除它们的尾随空格。如果此命令管道成功，我们将删除存储。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2014-10-10T12:53:56.127

当在文件中使用时，这里的其他方法在 MacVim 中对我不起作用`.vimrc`。所以这是一个突出尾随空格的方法：

```
set encoding=utf-8
set listchars=trail:·
set list 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2016-08-11T18:34:07.060

对于想要为特定文件类型运行它的人（文件类型并不总是可靠的）：

```
autocmd BufWritePre *.c,*.cpp,*.cc,*.h,*.hpp,*.py,*.m,*.mm :%s/\s\+$//e 
```

或者使用 vim7：

```
autocmd BufWritePre *.{c,cpp,cc,h,hpp,py,m,mm} :%s/\s\+$//e 
```

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2016-09-29T20:50:57.967

如果您修剪空白，您应该*只*对已经干净的文件执行此操作。“在罗马的时候...”。在处理不受欢迎的虚假更改的代码库时，这是一种很好的礼仪。

此函数检测尾随空格并仅在它已经干净时才打开修剪。

这个想法的功劳归功于这里的评论： [https](https://github.com/atom/whitespace/issues/10) ://github.com/atom/whitespace/issues/10 （有史以来最长的错误票评论流）

```
autocmd BufNewFile,BufRead *.test call KarlDetectWhitespace()

fun! KarlDetectWhitespace()
python << endpython
import vim
nr_unclean = 0
for line in vim.current.buffer:
    if line.rstrip() != line:
        nr_unclean += 1

print "Unclean Lines: %d" % nr_unclean
print "Name: %s" % vim.current.buffer.name
cmd = "autocmd BufWritePre <buffer> call KarlStripTrailingWhitespace()"
if nr_unclean == 0:
    print "Enabling Whitespace Trimming on Save"
    vim.command(cmd)
else:
    print "Whitespace Trimming Disabled"
endpython
endfun

fun! KarlStripTrailingWhitespace()
    let l = line(".")
    let c = col(".")
    %s/\s\+$//e
    call cursor(l, c)
endfun 
```

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2021-09-08T09:09:53.890

```
autocmd BufWritePre *.py execute 'norm m`' | %s/\s\+$//e | norm g`` 
```

这将使光标保持在与保存之前相同的位置

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2015-06-01T16:37:44.993

`autocmd BufWritePre * :%s/\s\+$//<CR>:let @/=''<CR>`

# php - 我可以在 PHP 中使用多个类来扩展一个类吗？

> ID：356128
> 
> 赞同：169
> 
> 时间：2008-12-10T14:02:56.540
> 
> 标签：php, class, oop, extends

如果我有几个具有我需要的功能但想单独存储以进行组织的类，我可以扩展一个类以同时具有这两个功能吗？

IE`class a extends b extends c`

编辑：我知道如何一次扩展一个类，但我正在寻找一种方法来使用多个基类立即扩展一个类 - AFAIK 你不能在 PHP 中做到这一点，但应该有办法绕过它而不诉诸于`class c extends b`,`class b extends a`

* * *

## 回答 #1

> 赞同：181
> 
> 时间：2008-12-10T15:18:14.360

如果你真的想在 PHP 5.3 中伪造多重继承，你可以使用神奇的函数 __call()。

尽管从 A 类用户的角度来看，这很丑陋：

```
class B {
    public function method_from_b($s) {
        echo $s;
    }
}

class C {
    public function method_from_c($s) {
        echo $s;
    }
}

class A extends B
{
  private $c;

  public function __construct()
  {
    $this->c = new C;
  }

  // fake "extends C" using magic function
  public function __call($method, $args)
  {
    $this->c->$method($args[0]);
  }
}

$a = new A;
$a->method_from_b("abc");
$a->method_from_c("def"); 
```

打印“abcdef”

* * *

## 回答 #2

> 赞同：144
> 
> 时间：2008-12-10T14:12:37.783

你不能有一个扩展两个基类的类。您不能拥有以下内容：

```
// this is NOT allowed (for all you google speeders)
Matron extends Nurse, HumanEntity 
```

但是，您可以具有如下层次结构...

```
Matron extends Nurse    
Consultant extends Doctor

Nurse extends HumanEntity
Doctor extends HumanEntity

HumanEntity extends DatabaseTable
DatabaseTable extends AbstractTable 
```

等等。

* * *

## 回答 #3

> 赞同：66
> 
> 时间：2011-06-24T10:50:44.420

您可以使用特征，希望从 PHP 5.4 开始提供。

Traits 是一种在 PHP 等单继承语言中重用代码的机制。Trait 旨在通过使开发人员能够在生活在不同类层次结构中的多个独立类中自由地重用方法集来减少单继承的一些限制。Traits 和类组合的语义以某种方式定义，这降低了复杂性并避免了与多继承和 Mixins 相关的典型问题。

它们因其在支持更好的组合和重用方面的潜力而受到认可，因此它们可以集成到新版本的语言中，例如 Perl 6、Squeak、Scala、Slate 和 Fortress。特征也已移植到 Java 和 C#。

更多信息：[https ://wiki.php.net/rfc/traits](https://wiki.php.net/rfc/traits)

* * *

## 回答 #4

> 赞同：18
> 
> 时间：2008-12-10T14:48:10.143

类不只是方法的集合。一个类应该代表一个抽象概念，具有状态（字段）和改变状态的行为（方法）。使用继承只是为了获得一些期望的行为听起来像糟糕的 OO 设计，而这正是许多语言不允许多重继承的原因：为了防止“意大利面条式继承”，即扩展 3 个类，因为每个类都有你需要的方法，并以一个继承了 100 个方法和 20 个字段的类，但只使用了其中的 5 个。

* * *

## 回答 #5

> 赞同：18
> 
> 时间：2008-12-11T06:22:08.637

我相信很快就会有添加混音的计划。

但在那之前，请接受公认的答案。您可以将其抽象出来以创建一个“可扩展”类：

```
class Extendable{
  private $extender=array();

  public function addExtender(Extender $obj){
    $this->extenders[] = $obj;
    $obj->setExtendee($this);
  }

  public function __call($name, $params){
    foreach($this->extenders as $extender){
       //do reflection to see if extender has this method with this argument count
       if (method_exists($extender, $name)){
          return call_user_func_array(array($extender, $name), $params);
       }
    }
  }
}

$foo = new Extendable();
$foo->addExtender(new OtherClass());
$foo->other_class_method(); 
```

请注意，在此模型中，“OtherClass”会“了解”$foo。OtherClass 需要有一个名为“setExtendee”的公共函数来建立这种关系。然后，如果它的方法是从 $foo 调用的，它可以在内部访问 $foo。但是，它不会像真正的扩展类那样访问任何私有/受保护的方法/变量。

* * *

## 回答 #6

> 赞同：14
> 
> 时间：2017-09-15T12:51:33.463

使用特征作为基类。然后在父类中使用它们。扩展它。

```
trait business{
  function sell(){

  }

  function buy(){

  }

  function collectMoney(){
  }

}

trait human{

   function think(){

   }

   function speak(){

   }

}

class BusinessPerson{
  use business;
  use human;
  // If you have more traits bring more
}

class BusinessWoman extends BusinessPerson{

   function getPregnant(){

   }

}

$bw = new BusinessWoman();
$bw ->speak();
$bw->getPregnant(); 
```

现在看看女商人在逻辑上继承了商业和人类两者；

* * *

## 回答 #7

> 赞同：13
> 
> 时间：2015-09-17T08:16:35.140

# 编辑：2020 PHP 5.4+ 和 7+

从 PHP 5.4.0 开始，有“[特性](https://www.php.net/manual/en/language.oop5.traits.php)”——你可以在一个类中使用更多特性，所以最终的决定点是你是否想要**真正的继承**，或者你**只需**​​要**一些“特性”（特性）**。Trait 模糊地说，是一个已经实现的接口，意味着只是`use`d。

* * *

@Franck 目前接受的答案将起作用，但它实际上不是多重继承，而是定义超出范围的类的子实例，还有 `__call()` 简写 - 考虑仅使用 `$this->childInstance->method (args)` 在“扩展”类中需要 ExternalClass 类方法的任何地方。

## 确切答案

不，你不能，分别，不是真的，正如[关键字](http://php.net/manual/en/keyword.extends.php)[手册`extends`](http://php.net/manual/en/keyword.extends.php)所说：

> 扩展类始终依赖于单个基类，即不支持多重继承。

## 真实答案

但是，正如@adam 正确建议的那样，这并不禁止您使用多层次继承。

你可以扩展一个类，用另一个类，另一个类和另一个类，依此类推......

所以非常简单的例子是：

```
class firstInheritance{}
class secondInheritance extends firstInheritance{}
class someFinalClass extends secondInheritance{}
//...and so on... 
```

## 重要的提示

您可能已经注意到，**如果您可以控制流程中包含的所有类，则只能按层次结构执行多个（2+）集成**- 这意味着，您不能应用此解决方案，例如使用内置类或使用您的类根本无法编辑 - 如果你想这样做，你会得到@Franck 解决方案 - 子实例。

...最后是一些输出的例子：

```
class A{
  function a_hi(){
    echo "I am a of A".PHP_EOL."<br>".PHP_EOL;  
  }
}

class B extends A{
  function b_hi(){
    echo "I am b of B".PHP_EOL."<br>".PHP_EOL;  
  }
}

class C extends B{
  function c_hi(){
    echo "I am c of C".PHP_EOL."<br>".PHP_EOL;  
  }
}

$myTestInstance = new C();

$myTestInstance->a_hi();
$myTestInstance->b_hi();
$myTestInstance->c_hi(); 
```

哪个输出

```
I am a of A 
I am b of B 
I am c of C 
```

* * *

## 回答 #8

> 赞同：10
> 
> 时间：2014-10-07T00:17:59.640

```
<?php
// what if we want to extend more than one class?

abstract class ExtensionBridge
{
    // array containing all the extended classes
    private $_exts = array();
    public $_this;

    function __construct() {$_this = $this;}

    public function addExt($object)
    {
        $this->_exts[]=$object;
    }

    public function __get($varname)
    {
        foreach($this->_exts as $ext)
        {
            if(property_exists($ext,$varname))
            return $ext->$varname;
        }
    }

    public function __call($method,$args)
    {
        foreach($this->_exts as $ext)
        {
            if(method_exists($ext,$method))
            return call_user_method_array($method,$ext,$args);
        }
        throw new Exception("This Method {$method} doesn't exists");
    }

}

class Ext1
{
    private $name="";
    private $id="";
    public function setID($id){$this->id = $id;}
    public function setName($name){$this->name = $name;}
    public function getID(){return $this->id;}
    public function getName(){return $this->name;}
}

class Ext2
{
    private $address="";
    private $country="";
    public function setAddress($address){$this->address = $address;}
    public function setCountry($country){$this->country = $country;}
    public function getAddress(){return $this->address;}
    public function getCountry(){return $this->country;}
}

class Extender extends ExtensionBridge
{
    function __construct()
    {
        parent::addExt(new Ext1());
        parent::addExt(new Ext2());
    }

    public function __toString()
    {
        return $this->getName().', from: '.$this->getCountry();
    }
}

$o = new Extender();
$o->setName("Mahdi");
$o->setCountry("Al-Ahwaz");
echo $o;
?> 
```

* * *

## 回答 #9

> 赞同：6
> 
> 时间：2008-12-10T17:02:06.847

我读过几篇文章，不鼓励在项目中继承（而不是库/框架），并鼓励对接口进行编程，而不是反对实现。
他们还提倡组合式 OO：如果您需要 a 和 b 类中的函数，请让 c 具有这种类型的成员/字段：

```
class C
{
    private $a, $b;

    public function __construct($x, $y)
    {
        $this->a = new A(42, $x);
        $this->b = new B($y);
    }

    protected function DoSomething()
    {
        $this->a->Act();
        $this->b->Do();
    }
} 
```

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2017-02-06T10:44:13.353

多重继承似乎在接口级别起作用。我在 php 5.6.1 上做了一个测试。

这是一个工作代码：

```
<?php

interface Animal
{
    public function sayHello();
}

interface HairyThing
{
    public function plush();
}

interface Dog extends Animal, HairyThing
{
    public function bark();
}

class Puppy implements Dog
{
    public function bark()
    {
        echo "ouaf";
    }

    public function sayHello()
    {
        echo "hello";
    }

    public function plush()
    {
        echo "plush";
    }

}

echo PHP_VERSION; // 5.6.1
$o = new Puppy();
$o->bark();
$o->plush();
$o->sayHello(); // displays: 5.6.16ouafplushhello 
```

我不认为这是可能的，但我在 SwiftMailer 源代码中偶然发现了 Swift_Transport_IoBuffer 类，它具有以下定义：

```
interface Swift_Transport_IoBuffer extends Swift_InputByteStream, Swift_OutputByteStream 
```

我还没有玩过它，但我认为分享它可能会很有趣。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2012-02-01T10:24:45.180

我刚刚解决了我的“多重继承”问题：

```
class Session {
    public $username;
}

class MyServiceResponsetype {
    protected $only_avaliable_in_response;
}

class SessionResponse extends MyServiceResponsetype {
    /** has shared $only_avaliable_in_response */

    public $session;

    public function __construct(Session $session) {
      $this->session = $session;
    }

} 
```

这样我就有能力在 SessionResponse 中操作会话，它扩展了 MyServiceResponsetype 仍然能够自己处理会话。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2013-12-23T10:07:19.687

如果要检查函数是否公开，请参阅此主题：[https ://stackoverflow.com/a/4160928/2226755](https://stackoverflow.com/a/4160928/2226755)

并对许多或不使用参数使用 call_user_func_array(...) 方法。

像这样 ：

```
class B {
    public function method_from_b($s) {
        echo $s;
    }
}

class C {
    public function method_from_c($l, $l1, $l2) {
        echo $l.$l1.$l2;
    }
}

class A extends B {
    private $c;

    public function __construct() {
        $this->c = new C;
    }

    public function __call($method, $args) {
        if (method_exists($this->c, $method)) {
            $reflection = new ReflectionMethod($this->c, $method);
            if (!$reflection->isPublic()) {
                throw new RuntimeException("Call to not public method ".get_class($this)."::$method()");
            }

            return call_user_func_array(array($this->c, $method), $args);
        } else {
            throw new RuntimeException("Call to undefined method ".get_class($this)."::$method()");
        }
    }
}

$a = new A;
$a->method_from_b("abc");
$a->method_from_c("d", "e", "f"); 
```

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2016-03-24T13:56:15.840

您可以使用自 PHP 5.4 起宣布的 PHP 中的 Traits 来做到这一点

这是给你的快速教程，[http://culttt.com/2014/06/25/php-traits/](http://culttt.com/2014/06/25/php-traits/)

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2017-05-06T11:13:28.347

PHP 作为一种编程语言的问题之一是您只能具有单一继承这一事实。这意味着一个类只能从另一个类继承。

但是，很多时候从多个类继承是有益的。例如，可能需要从几个不同的类继承方法以防止代码重复。

这个问题可能导致类具有很长的家族继承历史，这通常是没有意义的。

在 PHP 5.4 中添加了该语言的一个新特性，称为 Traits。Trait 有点像 Mixin，因为它允许您将 Trait 类混合到现有类中。这意味着您可以减少代码重复并获得好处，同时避免多重继承问题。

[性状](http://php.net/manual/en/language.oop5.traits.php)

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-12-10T14:07:28.027

PHP 还不支持多类继承，但是它支持多接口继承。

有关一些示例，请参见[http://www.hudzilla.org/php/6_17_0.php](http://www.hudzilla.org/php/6_17_0.php)。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2008-12-10T15:21:00.890

PHP 不允许多重继承，但您可以实现多个接口。如果实现很“重”，则为单独的类中的每个接口提供**骨架实现**。然后，您可以通过**对象包含****将所有接口类委托给这些骨架实现**。

 *** * *

## 回答 #17

> 赞同：0
> 
> 时间：2009-01-25T05:26:45.977

不确切知道您要实现的目标，我建议您考虑重新设计您的应用程序以在这种情况下使用组合而不是继承的可能性。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2011-05-01T11:02:47.173

总是好主意是制作具有功能的父类......即将所有功能添加到父类。

并“移动”所有使用此分层的类。我需要 - 重写功能，这是特定的。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2019-09-10T10:46:15.920

这不是一个真正的答案，我们有重复的课程

...但它有效:)

```
class A {
    //do some things
}

class B {
    //do some things
} 
```

类 copy_B 是复制所有 B 类

```
class copy_B extends A {

    //do some things (copy class B)
}

class A_B extends copy_B{} 
```

现在

```
class C_A extends A{}
class C_B extends B{}
class C_A_b extends A_B{}  //extends A & B 
```

* * *

## 回答 #20

> 赞同：-3
> 
> 时间：2018-06-14T14:31:17.543

A 类扩展 B {}

B 类扩展 C {}

然后 A 扩展了 B 和 C

# python - IIS下的Python FastCGI——stdout写入问题

> ID：356138
> 
> 赞同：2
> 
> 时间：2008-12-10T14:04:51.090
> 
> 标签：python, iis, stdout, fastcgi

我的 Python FastCGI 代码有一个非常特殊的问题 - sys.stdout 的文件描述符为“-1”，所以我无法写入它。我在我的程序的第一行检查这个，所以我知道我的任何代码都没有改变它。

我试过`sys.stdout = os.fdopen(1, 'w')`了，但是那里写的任何东西都不会进入我的浏览器。

相同的应用程序在 Apache 下可以毫无困难地工作。

我正在使用 Microsoft 提供的用于 IIS 的 FastCGI 扩展，此处记录：[http ://learn.iis.net/page.aspx/248/configuring-fastcgi-extension-for-iis60/](http://learn.iis.net/page.aspx/248/configuring-fastcgi-extension-for-iis60/)

我在 fcgiext.ini 中使用这些设置：

```
    ExePath=C:\Python23\python.exe
    参数=-u C:\app\app_wsgi.py
    FlushNamedPipe=1
    请求超时=45
    空闲超时=120
    活动超时=30

```

谁能告诉我出了什么问题或告诉我应该去哪里寻找？

非常感谢所有建议...

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-09-30T20:58:52.560

你必须使用 FastCGI 吗？如果没有，您可能想尝试 ISAPI WSGI 方法。我已经成功使用：

[http://code.google.com/p/isapi-wsgi/](http://code.google.com/p/isapi-wsgi/)

并且过去也使用过 PyISAPIe：

[http://sourceforge.net/apps/trac/pyisapie](http://sourceforge.net/apps/trac/pyisapie)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-11T13:24:48.503

如果这是一个愚蠢的问题，请原谅我，但我在您的配置文件中注意到这一行：

> 参数=-u C:\app\app_wsgi.py

您正在运行 WSGI 应用程序还是 FastCGI 应用程序？有*区别*。在 WSGI 中，写入标准输出并不是一个好主意。你的程序应该有一个应用程序对象，可以使用环境字典和 start_response 函数调用（有关更多信息，请参阅[PEP 333](http://www.python.org/dev/peps/pep-0333/)）。无论如何，您的应用程序的返回方法将是返回一个包含响应正文的可迭代对象，而不是写入标准输出。

无论哪种方式，您还应该考虑使用[isapi-wsgi](http://code.google.com/p/isapi-wsgi/)。我自己从未使用过它，但我听到了关于它的好消息。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-03-31T00:05:02.630

我相信标准输出关闭/无效符合[FastCGI 规范](http://www.fastcgi.com/devkit/doc/fcgi-spec.html)：

> 当应用程序开始执行时，Web 服务器会留下一个单独的文件描述符 FCGI_LISTENSOCK_FILENO。该描述符指的是由 Web 服务器创建的侦听套接字。
> 
> FCGI_LISTENSOCK_FILENO 等于 STDIN_FILENO。标准描述符 STDOUT_FILENO 和 STDERR_FILENO 在应用程序开始执行时关闭。应用程序确定它是使用 CGI 还是 FastCGI 调用的可靠方法是调用 getpeername(FCGI_LISTENSOCK_FILENO)，该方法返回 -1，并且对于 FastCGI 应用程序将 errno 设置为 ENOTCONN。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-11T15:01:21.320

在 Windows 上，可以在没有有效标准输入和标准输出的情况下启动进程。例如，如果您使用 pythonw.exe 执行 python 脚本，stdout 是无效的，如果您坚持写入它，它将在 140 个字符后阻塞。

写入到 stdout 以外的另一个目的地似乎是最安全的解决方案。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-08-25T14:14:01.837

在 PEP 333 之后，您可以尝试登录到 environ['wsgi.errors']，这通常是您使用 fastcgi 时 Web 服务器本身的记录器。当然，这仅在调用请求时可用，但在应用程序启动期间不可用。

您可以在 pylons 代码中获取示例：http: [//pylonshq.com/docs/en/0.9.7/logging/#logging-to-wsgi-errors](http://pylonshq.com/docs/en/0.9.7/logging/#logging-to-wsgi-errors)

# ms-access - MS Access 中的目标搜索

> ID：356139
> 
> 赞同：0
> 
> 时间：2008-12-10T14:05:16.363
> 
> 标签：ms-access

在 MS Excel 中，有一个工具可以在给定另一个连接单元格中的条件的情况下对一个单元格进行迭代计算（目标搜索显然是我从瑞典语翻译而来的非常糟糕的翻译）。我现在想在 MS Access 中执行此操作。任何提示或至少一个正确的英语术语都会有很大帮助。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-10T14:20:25.660

目标搜索称为**目标搜索**Excel

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-10T21:57:36.673

好吧，我的建议是不要尝试在 Access 中这样做！让 Excel 做 Excel 的事情（比如处理这个“目标搜索”算法），让 Access 做 Access 的事情：表、视图、关系、查询、数据完整性、外键等。如果您的数据在 Access 下，先导出到Excel！

# wpf - 具有动态定义的 WPF GridView

> ID：356144
> 
> 赞同：13
> 
> 时间：2008-12-10T14:05:51.040
> 
> 标签：wpf, gridview, listview

我想使用 ListView 的 GridView 模式来显示我的程序将从外部源接收的一组数据。数据将包含两个数组，一个是列名，另一个是用于填充控件的字符串值。

我看不到如何创建可以用作 ListView 中的 Item 的合适类。我知道填充项目的唯一方法是将其设置为具有表示列的属性的类，但在运行时之前我不知道这些列。

我可以动态地创建一个 ItemTemplate，如：[在运行时动态创建 WPF ItemTemplate](https://stackoverflow.com/questions/125638/create-wpf-itemtemplate-dynamically-at-runtime)但它仍然让我不知道如何描述实际数据。

感激地收到任何帮助。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-12-10T19:35:45.150

您可以使用以下方法将 GridViewColumns 添加到 GridView 动态给定第一个数组：

```
private void AddColumns(GridView gv, string[] columnNames)
{
    for (int i = 0; i < columnNames.Length; i++)
    {
        gv.Columns.Add(new GridViewColumn
        {
            Header = columnNames[i],
            DisplayMemberBinding = new Binding(String.Format("[{0}]", i))
        });
    }
} 
```

我假设包含值的第二个数组将是 ROWS * COLUMNS 长度。在这种情况下，您的项目可以是长度为 COLUMNS 的字符串数组。您可以使用 Array.Copy 或 LINQ 来拆分数组。原理如下：

```
<Grid>
    <Grid.Resources>
        <x:Array x:Key="data" Type="{x:Type sys:String[]}">
            <x:Array Type="{x:Type sys:String}">
                <sys:String>a</sys:String>
                <sys:String>b</sys:String>
                <sys:String>c</sys:String>
            </x:Array>
            <x:Array Type="{x:Type sys:String}">
                <sys:String>do</sys:String>
                <sys:String>re</sys:String>
                <sys:String>mi</sys:String>
            </x:Array>
        </x:Array>
    </Grid.Resources>
    <ListView ItemsSource="{StaticResource data}">
        <ListView.View>
            <GridView>
                <GridViewColumn DisplayMemberBinding="{Binding Path=[0]}" Header="column1"/>
                <GridViewColumn DisplayMemberBinding="{Binding Path=[1]}" Header="column2"/>
                <GridViewColumn DisplayMemberBinding="{Binding Path=[2]}" Header="column3"/>
            </GridView>
        </ListView.View>
    </ListView>
</Grid> 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-12-18T19:56:47.650

谢谢，这很有帮助。

我用它来创建一个动态版本，如下所示。我按照您的建议创建了列标题：

```
private void AddColumns(List<String> myColumns)
{
    GridView viewLayout = new GridView();
    for (int i = 0; i < myColumns.Count; i++)
    {
        viewLayout.Columns.Add(new GridViewColumn
        {
            Header = myColumns[i],
            DisplayMemberBinding = new Binding(String.Format("[{0}]", i))
        });
    }
    myListview.View = viewLayout;
} 
```

在 XAML 中非常简单地设置 ListView：

```
<ListView Name="myListview" DockPanel.Dock="Left"/> 
```

为 ObservableCollection 创建了一个包装类来保存我的数据：

```
public class MyCollection : ObservableCollection<List<String>>
{
    public MyCollection()
        : base()
    {
    }
} 
```

并将我的 ListView 绑定到它：

```
results = new MyCollection();

Binding binding = new Binding();
binding.Source = results;
myListview.SetBinding(ListView.ItemsSourceProperty, binding); 
```

然后填充它，这只是清除所有旧数据并添加新数据的情况：

```
results.Clear();
List<String> details = new List<string>();
for (int ii=0; ii < externalDataCollection.Length; ii++)
{
    details.Add(externalDataCollection[ii]);
}
results.Add(details); 
```

可能有更简洁的方法，但这对我的应用程序非常有用。再次感谢。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-05-16T23:30:24.937

CodeProject 上的这篇文章准确解释了如何创建动态 ListView - 当数据仅在运行时已知时。 [http://www.codeproject.com/KB/WPF/WPF_DynamicListView.aspx](http://www.codeproject.com/KB/WPF/WPF_DynamicListView.aspx)

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2010-06-30T23:37:32.910

不确定它是否仍然相关，但我找到了一种使用单元格模板选择器设置单个单元格样式的方法。这有点麻烦，因为您必须使用 ContentPresenter 的内容来获得单元格的正确 DataContext（因此您可以绑定到单元格模板中的实际单元格项）：

```
 public class DataMatrixCellTemplateSelectorWrapper : DataTemplateSelector
    {
        private readonly DataTemplateSelector _ActualSelector;
        private readonly string _ColumnName;
        private Dictionary<string, object> _OriginalRow;

        public DataMatrixCellTemplateSelectorWrapper(DataTemplateSelector actualSelector, string columnName)
        {
            _ActualSelector = actualSelector;
            _ColumnName = columnName;
        }

        public override DataTemplate SelectTemplate(object item, DependencyObject container)
        {
            // The item is basically the Content of the ContentPresenter.
            // In the DataMatrix binding case that is the dictionary containing the cell objects.
            // In order to be able to select a template based on the actual cell object and also
            // be able to bind to that object within the template we need to set the DataContext
            // of the template to the actual cell object. However after the template is selected
            // the ContentPresenter will set the DataContext of the template to the presenters
            // content. 
            // So in order to achieve what we want, we remember the original DataContext and then
            // change the ContentPresenter content to the actual cell object.
            // Therefor we need to remember the orginal DataContext otherwise in subsequent calls
            // we would get the first cell object.

            // remember old data context
            if (item is Dictionary<string, object>)
            {
                _OriginalRow = item as Dictionary<string, object>;
            }

            if (_OriginalRow == null)
                return null;

            // get the actual cell object
            var obj = _OriginalRow[_ColumnName];

            // select the template based on the cell object
            var template = _ActualSelector.SelectTemplate(obj, container);

            // find the presenter and change the content to the cell object so that it will become
            // the data context of the template
            var presenter = WpfUtils.GetFirstParentForChild<ContentPresenter>(container);
            if (presenter != null)
            {
                presenter.Content = obj;
            }

            return template;
        }
    } 
```

注意：我从 CodeProject 文章中更改了 DataMatrix，以便行是字典（列名 -> 单元格对象）。

我不能保证这个解决方案不会破坏某些东西，或者在未来的 .Net 版本中不会破坏。它依赖于 ContentPresenter 在将模板选择为它自己的内容后设置 DataContext 的事实。（反射器在这些情况下有很大帮助:)）

创建 GridColumns 时，我会执行以下操作：

```
 var column = new GridViewColumn
                          {
                              Header = col.Name,
                              HeaderTemplate = gridView.ColumnHeaderTemplate
                          };
            if (listView.CellTemplateSelector != null)
            {
                column.CellTemplateSelector = new DataMatrixCellTemplateSelectorWrapper(listView.CellTemplateSelector, col.Name);
            }
            else
            {
                column.DisplayMemberBinding = new Binding(string.Format("[{0}]", col.Name));
            }
            gridView.Columns.Add(column); 
```

注意：我扩展了 ListView 以便它具有可以在 xaml 中绑定的 CellTemplateSelector 属性

@Edit 15/03/2011：我写了一篇小文章，附有一个小演示项目：http: [//codesilence.wordpress.com/2011/03/15/listview-with-dynamic-columns/](http://codesilence.wordpress.com/2011/03/15/listview-with-dynamic-columns/)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-08-04T11:01:07.953

完全程序化的版本：

```
 var view = grid.View as GridView;
        view.Columns.Clear();
        int count=0;
        foreach (var column in ViewModel.GridData.Columns)
        {
            //Create Column
            var nc = new GridViewColumn();
            nc.Header = column.Field;
            nc.Width = column.Width;
            //Create template
            nc.CellTemplate = new DataTemplate();
            var factory = new FrameworkElementFactory(typeof(System.Windows.Controls.Border));
            var tbf = new FrameworkElementFactory(typeof(System.Windows.Controls.TextBlock));

            factory.AppendChild(tbf);
            factory.SetValue(System.Windows.Controls.Border.BorderThicknessProperty, new Thickness(0,0,1,1));
            factory.SetValue(System.Windows.Controls.Border.MarginProperty, new Thickness(-7,0,-7,0));
            factory.SetValue(System.Windows.Controls.Border.BorderBrushProperty, Brushes.LightGray);
            tbf.SetValue(System.Windows.Controls.TextBlock.MarginProperty, new Thickness(6,2,6,2));
            tbf.SetValue(System.Windows.Controls.TextBlock.HorizontalAlignmentProperty, column.Alignment);

            //Bind field
            tbf.SetBinding(System.Windows.Controls.TextBlock.TextProperty, new Binding(){Converter = new GridCellConverter(), ConverterParameter=column.BindingField});
            nc.CellTemplate.VisualTree = factory;

            view.Columns.Add(nc);
            count++;
        } 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2013-01-03T19:20:18.160

我将通过向 GridView 添加一个 AttachedProperty 来执行此操作，我的 MVVM 应用程序可以在其中指定列（可能还有一些额外的元数据）。然后行为代码可以直接与 GridView 对象动态工作以创建列。通过这种方式，您可以遵守 MVVM，并且 ViewModel 可以动态指定列。

# python - Python 编码标准/最佳实践

> ID：356161
> 
> 赞同：121
> 
> 时间：2008-12-10T14:10:07.337
> 
> 标签：python, coding-style

在 python 中，您通常使用[PEP 8 -- Python 代码样式指南](http://www.python.org/dev/peps/pep-0008/)作为您的编码标准/指南吗？您是否喜欢其他任何正式的标准？

* * *

## 回答 #1

> 赞同：156
> 
> 时间：2008-12-10T14:30:03.193

> “在 Python 中，您通常使用 PEP 8 -- Python 代码样式指南作为您的编码标准/指南吗？还有其他您喜欢的正式标准吗？”

正如您所提到的，主要文本遵循[PEP 8](http://www.python.org/dev/peps/pep-0008/)，文档字符串约定遵循 PEP [257](http://www.python.org/dev/peps/pep-0257/)

除了 Python 样式指南，我建议您参考以下内容：

1.  [像 Pythonista 一样编写代码：惯用的 Python](http://python.net/~goodger/projects/pycon/2007/idiomatic/)
2.  [常见错误和疣](http://learnpython.pbwiki.com/PythonTricks)
3.  [如何不写 Python 代码](http://eikke.com/how-not-to-write-python-code/)
4.  [Python 陷阱](http://eikke.com/python-gotcha/)

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2008-12-10T14:19:08.317

我遵循 Rob Knight 的[Python Idioms and Efficiency](https://www.memonic.com/user/pneff/folder/python/id/1bufp)指南。我认为它们与 PEP 8 完全相同，但更加综合并基于示例。

如果您使用的是 wxPython，您可能还想查看Chris Barker[的 wxPython 代码样式指南。](http://wiki.wxpython.org/wxPython%20Style%20Guide)

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-03-26T01:48:44.690

我非常严格地坚持 PEP-8。

有三件具体的事情我懒得换成 PEP-8。

*   避免紧接在圆括号、方括号或大括号内的无关空格。

    建议：`spam(ham[1], {eggs: 2})`

    无论如何我都会这样做： `spam( ham[ 1 ], { eggs: 2 } )`

    为什么？30 多年的根深蒂固的习惯是将 () 与函数名称或 (在 C 中) 语句关键字相结合。从 70 年代的 Fortran IV 开始。

*   在算术运算符周围使用空格：

    建议： `x = x * 2 - 1`

    无论如何我都会这样做：`x= x * 2 - 1`

    为什么？Gries 的 The Science of Programming 建议以此作为强调赋值与状态正在改变的变量之间的联系的一种方式。

    它不适用于多重分配或增强分配，因为我使用了很多空间。

*   For function names, method names and instance variable names

    Suggested: lowercase, with words separated by underscores as necessary to improve readability.

    I do this anyway: camelCase

    Why? 20+ years of ingrained habit of camelCase, starting with Pascal in the 80's.

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-12-10T14:45:36.110

PEP 8 很好，我唯一希望它更难解决的是 Tabs-vs-Spaces 圣战。

基本上，如果您在 python 中开始一个项目，您需要选择 Tabs 或 Spaces，然后在视线范围内射击所有违规者。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-12-10T15:17:46.170

要添加到[bhadra 的](https://stackoverflow.com/users/30289/bhadra) 惯用指南[列表中：](https://stackoverflow.com/questions/356161/python-coding-standardsbest-practices#356238)

查看 Anthony Baxter 关于[有效 Python 编程](http://www.slideshare.net/champguru/effective-python-programming)的演讲（来自 OSON 2005）。

摘录：

```
# dict's setdefault method turns this:
if key in dictobj:
    dictobj[key].append(val)
else:
    dictobj[key] = [val]
# into this:
dictobj.setdefault(key,[]).append(val) 
```

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-12-10T14:16:04.453

我非常严格地遵循它。PEP-8 之前的唯一神是现有的代码库。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-12-10T14:11:27.160

是的，我尝试尽可能密切地关注它。

我不遵循任何其他编码标准。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2011-08-13T15:09:53.950

I follow the PEP8, it is a great piece of coding style.

# asp.net-mvc - OutputCache 和记录独特的视图？

> ID：356164
> 
> 赞同：2
> 
> 时间：2008-12-10T14:10:25.337
> 
> 标签：asp.net-mvc, outputcache, custom-action-filter

图像我有一个使用 OutputCache 属性缓存的视图，但我仍然需要增加一个记录该页面已被查看的计数器，我该怎么做？

我考虑过创建自己的自定义 ActionFilterAttribute，并使用 Action Filter Order of Execution 来记录这个......但我不确定它是否会起作用。

例如。

```
[IncrementViewCountFilter(Order=1)]
[OutputCache(Duration=60,Order=2)]
public ActionResult Index(int questionId)
{ ... } 
```

首先，我在这里的假设是，如果调用了 OutputCache，并且缓存了页面，那么控制器代码将不会运行。

我猜的下一个问题是 IncrementViewCountFilter 不知道 questionId，那么它怎么知道要增加什么（因为它是在执行主索引代码之前执行的）。

其次，如果 IncrementViewCountFilter 确实知道 questionId .. 并且它得到了很多点击，那么您不希望它一直写入数据库 .. 但只有当它达到某个数字时 .. 然后 'flush ' 输出。

有人有什么想法吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-10T15:01:09.777

好吧，你有几个选择。

## 甜甜圈缓存

一种服务器端选项是“甜甜圈缓存”。 **甜甜圈缓存**允许缓存大部分页面，并且不缓存部分页面（甜甜圈中间的洞）。甜甜圈缓存[在此处进行了描述](http://haacked.com/archive/2008/11/05/donut-caching-in-asp.net-mvc.aspx)，我使用它取得了巨大的成功。

## 基于图像的跟踪器

另一种选择是让页面上**的图像**实际加载记录点击的服务器端操作。这看起来像

```
<img src="/controller/action"> 
```

在页面上，该操作在最后[提供了一个空图像](http://blog.rodj.org/archive/2008/09/24/asp.net-mvc-image-handler.aspx)。

## 客户端跟踪

最后一个选项是**客户端跟踪**——其中一些脚本在客户端运行并使用 AJAX 调用服务器上的某些内容来记录命中。谷歌在他们的分析包中使用了类似的东西。如果您与跟踪机制位于同一个域中……例如，如果您的主页是：

```
http://www.domain.com/home/action 
```

跟踪器已开启

```
http://www.domain.com/tracking/action 
```

那你应该没事。

当您的跟踪器位于不同的域时，这会变得很棘手（您需要使用[JSONP](http://remysharp.com/2007/10/08/what-is-jsonp/)或其他一些允许相对安全的跨站点脚本编写的机制来处理这个问题）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-10T14:42:38.907

过滤器可以从 ActionExecutingContext.ActionParameters 中获取 questionId，传递给 OnActionExecuting。至于缓存命中计数，好吧，使用缓存。:)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-07-13T19:52:16.737

您还可以使用 HttpModule，这是一个不错的选择，因为它可用于不使用 MVC 管道的页面和其他资产。我使用 Donut 缓存 (http://mvcdonutcaching.codeplex.com/)、MVC 过滤器和 HttpModule 的组合来记录缓存页面的所有类型的分析。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-10T14:22:46.780

我不知道 MVC 方面，但如果我在 WebForms 中这样做，这听起来像是[输出缓存替换](http://tinyurl.com/donutcaching)又名甜甜圈缓存的候选者。

# asp.net - 创建 asp.net az 列表

> ID：356167
> 
> 赞同：0
> 
> 时间：2008-12-10T14:11:08.957
> 
> 标签：asp.net

如果有时间，我可以自己做，但是有没有人有一个很好的 asp.net 实现来自 sql 查询的 az 列表。我希望它以以下形式出现：

土
豚
变位
苹果

B
巴里布朗
....

也就是说，每个条目都是一个链接。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-10T14:13:24.520

无论您的 sql 是什么，只需添加`Upper(Substring([myfield],1,1)) AS Letter`到选择列表中即可。然后只需在字母发生变化时显示字母即可。

不幸的是，这说起来容易做起来难。ASP.Net 对控制/中断样式输出没有很好的内置支持。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-10T14:14:06.127

您需要选择“名称”列和“链接”列。按“名称”升序对列表进行排序。在您的 ASP.Net 中，您需要检查字符串的第一个字母何时发生变化……如果它发生变化，请写下第一个字母，这样您就会得到您想要的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-10T14:19:58.593

想知道你是否可以做这样的事情，但我不确定你是否可以通过工会订购。

```
select word from 
    (select word from table 
     union all 
     select Upper(Substring([word],1,1)) as letter from table
     ) t order by word 
```

# php - PHP 的布尔值

> ID：356174
> 
> 赞同：0
> 
> 时间：2008-12-10T14:13:07.377
> 
> 标签：php

**[一些基本 PHP 问题](https://stackoverflow.com/questions/330709/some-basic-php-questions#330829)的副本**

你好，

我在需要用 PHP 显示的 mysql 数据库中有一堆 tinyint 字段。目前我正在做这样的事情：

```
if ($row['PAYPAL_ACCEPT'] == "1"){

$paypal = "Yes";

else

$paypal = "No";

} 
```

对于每个字段，这很乏味，似乎应该有更好的方法，而不是为每个字段使用 if 子句。如果有，它是什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-10T14:15:39.117

如果您愿意，请尝试：

```
$paypal = $row['PAYPAL_ACCEPT'] ? 'YES' : 'NO'; 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-10T14:16:30.160

就像是

```
$paypal = ($row['PAYPAL_ACCEPT'] ? "Yes" : "No"); 
```

也许？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-10T14:32:55.603

基于已经提出的建议：

```
// $columns = string array of column names
// $columns = array('PAYPAL_ACCEPT' ... );
foreach($columns as $column) {
  $$column = $row[$column] ? 'YES' : 'NO';
} 
```

然后您可以使用列名作为变量名访问变量：

```
print $PAYPAL_ACCEPT; 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-10T14:17:51.500

你可以把它写得更短，比如：

```
$paypal = ($row['PAYPAL_ACCEPT']?'Yes':'No'); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-10T14:19:12.963

或者您可以不使用 tinyint，而是使用值为“是”和“否”的枚举，然后使用简单的输出字段

```
$paypal = $row['PAYPAL_ACCEPT']; 
```

# unix - 如何编写一个每 N 行只输出一行的 unix 过滤器

> ID：356180
> 
> 赞同：3
> 
> 时间：2008-12-10T14:15:13.517
> 
> 标签：unix, shell, scripting, awk

假设使用以下行提供过滤器标准输入：

```
line 1 
line 2
line 3
line 4 
line 5
line 6
line 7
line 8
line 9
line 10 
```

如果有人告诉我如何编写一个仅每 4 行打印一次的脚本，那就更好了，在上面的示例输入的情况下：

```
line 1
line 5
line 9 
```

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-12-10T14:20:18.703

```
$ yes | cat -n | head -10 | awk 'NR % 4 == 1'
     1  y
     5  y
     9  y 
```

也就是说，你的答案是“ `awk 'NR % 4 == 1'`”。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-10T14:21:47.203

```
awk '{ if ((NR-1) %4 ==0) print}' 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-10T14:22:35.423

```
awk 'NR%4 == 1 {print}'</etc/hosts 
```

当然，将 4 替换为您想要的任何值。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2016-08-11T02:03:59.547

```
sed -ne '1~4p’ 
```

（GNU `sed`。未在 OSX 等上测试）

# java - 为应用程序设计地址验证

> ID：356190
> 
> 赞同：1
> 
> 时间：2008-12-10T14:18:58.533
> 
> 标签：java, street-address

我计划为在我的应用中注册的用户设计地址验证。可能通过邮政编码和州验证。

知道如何处理来自全球的地址吗？

我是否需要在数据库中插入所有邮政编码，然后验证地址。任何可能的实施建议？

谢谢和欢迎 :) Krisp

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-10T14:29:18.700

由于邮政编码没有国际标准，并且在您完成将其放在一起之前，世界上所有邮政编码的列表已经过时，我建议采用较小的方法：

确定您最需要处理的国家/地区，并为每个国家/地区制定单独的验证规则。确保通过这个您可以处理绝大多数用户（例如 95% 或 98%）。对于所有其他国家/地区，只需接受他们输入的内容，无需进一步验证。

世界上有这么多不同的地址格式，不值得努力（如果可能的话）处理它们。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-10T14:30:08.760

地址和邮政编码格式之间存在巨大差异，因此没有任何“标准”方式可以做到这一点。请参阅“[弗兰克的邮政地址强制性指南](http://www.columbia.edu/kermit/postal.html)”...

您真正需要多少/什么样的验证？例如，如果用户输入他们的送货地址，他们比您更可能知道他们当地的邮政/运输提供商需要什么特定格式。只需给他们一个多行文本区域即可输入。如果您需要其中的一部分来计算运费，只需请求您需要的信息（例如，城市/国家/地区）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-10T14:59:55.300

邮政编码实际上可能令人头疼，因为在某些地方，它们可以代表非常小的区域，而在美国，它们通常代表相对较大的区域（在大城市中它们可能代表几个街区）。

看看加拿大，他们的邮政编码实际上可以代表非常非常小的区域。街对面的两家商店通常有不同的加拿大邮政编码。同样在加拿大企业列表中，合并列表时，经常会看到相同地址但邮政编码略有不同。这只是表明很多人都弄错了。在客户的基础上，我不知道他们实际上得到了正确的邮政编码是多么现实。

[http://www.columbia.edu/kermit/postal-ca.html](http://www.columbia.edu/kermit/postal-ca.html)

基本上，每个公寓或商业住宅似乎都有自己的邮政编码，根据我在加拿大商业地址中看到的情况，这是有道理的。

另一点是，这只是加拿大。每个欧洲国家都会有自己的地址/邮政编码，澳大利亚、俄罗斯等也会有自己的地址/邮政编码。如果你真的想做地址验证，这是一个重大项目。

要实际验证地址，您需要验证邮政编码、城市和街道。在美国，人口普查会发布 TIGER 数据库文件，其中通常包含街道列表。但是对于其他国家/地区，我不知道您如何获得街道列表。最好查看一个商业包（也许是其中一个 GIS 包，尽管其中很多只提供美国/加拿大的详细地址，有时还提供一些欧洲国家的详细地址）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-09-21T10:21:30.850

一个完美的地址验证不能完全放在已经开发的应用程序中，但是邮政编码/邮政编码的验证可以根据国家名称来完成。

请检查源[xml-files 源中的 '](http://unicode.org/cldr/trac/browser/tags/release-2-0-1/common/supplemental) [supplementalData.xml](http://unicode.org/cldr/trac/browser/tags/release-2-0-1/common/supplemental/postalCodeData.xml) ' xml 文件中的正则表达式。通过解析xml，您可以找到运行时传递的国家/地区代码对应的邮政编码正则表达式，您可以在其中检查它是否与国家/地区匹配。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-10-13T01:37:28.790

正如许多用户之前提到的，验证国际地址基本上是不可能的，因为各国没有标准，许多国家没有邮政系统的资源。从技术上讲，即使在美国，USPS 也在苦苦挣扎。

您至少可以按国家/地区提供地址验证。美国是您获得大量报道的最简单的国家之一。为此，您需要连接到某种地址验证网络服务。有几家公司为此提供网络服务。需要注意的一件事是确保每个提供商都有其 API 的地理分布，以确保他们的任何中断都不会回流到您并杀死您的应用程序。除此之外，只需确保结果经过 CASS 认证。

为了全面披露，我是 SmartyStreets 的创始人。我们有一个名为 LiveAddress的[地址验证 Web 服务 API 。](http://www.smartystreets.com/Products/LiveAddress-API/)如果您有任何问题，非常欢迎您亲自与我联系。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-09-30T09:24:56.747

已经找到了另一个答案：请参考*wiki*的链接：[http](http://en.wikipedia.org/wiki/List_of_postal_codes) ://en.wikipedia.org/wiki/List_of_postal_codes 。

在这里您可以找到大多数国家/地区的大多数邮政编码模式，您可以将其中的正则表达式编写并维护到数据库中，这将帮助您轻松验证邮政编码，也是一种优化的方法！

# wpf - 值不为空的 DataTrigger？

> ID：356194
> 
> 赞同：178
> 
> 时间：2008-12-10T14:19:17.393
> 
> 标签：wpf, xaml, binding, visibility, datatrigger

我知道我可以创建一个 setter 来检查值是否为 NULL 并执行某些操作。例子：

```
<TextBlock>
  <TextBlock.Style>
    <Style>
      <Style.Triggers>
        <DataTrigger Binding="{Binding SomeField}" Value="{x:Null}">
          <Setter Property="TextBlock.Text" Value="It's NULL Baby!" />
        </DataTrigger>
      </Style.Triggers>
    </Style>
  </TextBlock.Style>
</TextBlock> 
```

但是如何检查“非”值......如“NOT NULL”或“NOT = 3”？这在 XAML 中可能吗？

**结果：**感谢您的回答...我知道我可以做一个值转换器（这意味着我必须编写代码，而这不会是我希望的纯 XAML）。但是，这确实回答了您不能在纯 XAML 中有效地“不”执行此操作的问题。然而，选择的答案可能显示了*创建*这种功能的最佳方式。很好的发现。

* * *

## 回答 #1

> 赞同：175
> 
> 时间：2009-02-27T02:12:11.320

这有点作弊，但我只是设置了默认样式，然后如果值为空，则使用 DataTrigger 覆盖它...

```
 <Style> 
      <!-- Highlight for Reviewed (Default) -->
      <Setter Property="Control.Background" Value="PaleGreen" /> 
      <Style.Triggers>
        <!-- Highlight for Not Reviewed -->
        <DataTrigger Binding="{Binding Path=REVIEWEDBY}" Value="{x:Null}">
          <Setter Property="Control.Background" Value="LightIndianRed" />
        </DataTrigger>
      </Style.Triggers>
  </Style> 
```

* * *

## 回答 #2

> 赞同：163
> 
> 时间：2008-12-10T16:35:23.453

您可以为此使用 IValueConverter：

```
<TextBlock>
    <TextBlock.Resources>
        <conv:IsNullConverter x:Key="isNullConverter"/>
    </TextBlock.Resources>
    <TextBlock.Style>
        <Style>
            <Style.Triggers>
                <DataTrigger Binding="{Binding SomeField, Converter={StaticResource isNullConverter}}" Value="False">
                    <Setter Property="TextBlock.Text" Value="It's NOT NULL Baby!"/>
                </DataTrigger>
            </Style.Triggers>
        </Style>
    </TextBlock.Style>
</TextBlock> 
```

IsNullConverter 在其他地方定义（并且 conv 设置为引用其命名空间）：

```
public class IsNullConverter : IValueConverter
{
    public object Convert(object value, Type targetType, object parameter, CultureInfo culture)
    {
        return (value == null);
    }

    public object ConvertBack(object value, Type targetType, object parameter, CultureInfo culture)
    {
        throw new InvalidOperationException("IsNullConverter can only be used OneWay.");
    }
} 
```

一个更通用的解决方案是实现一个 IValueConverter，它检查与 ConverterParameter 是否相等，因此您可以检查任何内容，而不仅仅是 null。

* * *

## 回答 #3

> 赞同：41
> 
> 时间：2008-12-10T16:33:25.220

我在使用 DataTriggers 时遇到了类似的限制，看来您只能检查是否相等。我见过的可能对您有所帮助的最接近的事情是一种用于进行除相等以外的其他类型比较的技术。

[这篇博](http://blogs.msdn.com/mikehillberg/archive/2008/09/30/ComparableDataTrigger.aspx)文描述了如何在 DataTrigger 中进行 LT、GT 等比较。

正如 Robert Macnee 的回答中所建议的那样，DataTrigger 的这种限制可以在某种程度上通过使用 Converter 将数据按摩成一个特殊的值来解决，然后您可以进行比较。

* * *

## 回答 #4

> 赞同：32
> 
> 时间：2012-05-09T14:21:30.783

与 null 比较（正如 Michael Noonan 所说）：

```
<Style>
    <Style.Triggers>
       <DataTrigger Binding="{Binding SomeProperty}" Value="{x:Null}">
           <Setter Property="Visibility" Value="Collapsed" />
        </DataTrigger>
     </Style.Triggers>
</Style> 
```

与 not null 比较（没有转换器）：

```
<Style>
    <Setter Property="Visibility" Value="Collapsed" />
    <Style.Triggers>
       <DataTrigger Binding="{Binding SomeProperty}" Value="{x:Null}">
           <Setter Property="Visibility" Value="Visible" />
        </DataTrigger>
     </Style.Triggers>
</Style> 
```

* * *

## 回答 #5

> 赞同：17
> 
> 时间：2011-09-02T01:08:01.057

如果选择了列表视图项（即不为空），我只使用它来启用按钮：

```
<Style TargetType="{x:Type Button}">
    <Setter Property="IsEnabled" Value="True"/>
    <Style.Triggers>
        <DataTrigger Binding="{Binding ElementName=lvMyList, Path=SelectedItem}" Value="{x:Null}">
            <Setter Property="IsEnabled" Value="False"/>
        </DataTrigger>
    </Style.Triggers>
</Style> 
```

* * *

## 回答 #6

> 赞同：15
> 
> 时间：2013-04-23T10:52:49.577

您可以使用**Expression Blend**附带的**Microsoft.Expression.Interactions.dll**`DataTrigger`中的类。

 ****代码示例：

```
<i:Interaction.Triggers>
    <i:DataTrigger Binding="{Binding YourProperty}" Value="{x:Null}" Comparison="NotEqual">
       <ie:ChangePropertyAction PropertyName="YourTargetPropertyName" Value="{Binding YourValue}"/>
    </i:DataTrigger
</i:Interaction.Triggers> 
```

`GreaterThan`使用这种方法，您也可以触发反对`LessThan`。为了使用此代码，您应该引用两个 dll：

> System.Windows.Interactivity.dll
> 
> Microsoft.Expression.Interactions.dll

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2013-08-30T20:47:22.673

```
<StackPanel.Style>
  <Style>
    <Setter Property="StackPanel.Visibility" Value="Visible"></Setter>
    <Style.Triggers>
      <DataTrigger  Binding="{Binding ElementName=ProfileSelectorComboBox, Path=SelectedItem.Tag}" Value="{x:Null}">
          <Setter Property="StackPanel.Visibility" Value="Collapsed"></Setter>
      </DataTrigger>
    </Style.Triggers>
  </Style>
</StackPanel.Style> 
```

我只是在这里使用了逆逻辑......当我的组合项没有填充时，将我的堆栈面板设置为不可见，它工作得很好！

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2015-12-09T13:57:53.510

停止！没有转换器！我不想“出售”这个人的库，但我讨厌每次我想比较 XAML 中的东西时都做转换器的事实。

所以有了这个库：[https ://github.com/Alex141/CalcBinding](https://github.com/Alex141/CalcBinding)

你可以做到这一点[还有更多]：

首先，在 windows/userControl 的声明中：

```
<Windows....
     xmlns:conv="clr-namespace:CalcBinding;assembly=CalcBinding"
> 
```

然后，在文本块中

```
<TextBlock>
      <TextBlock.Style>
          <Style.Triggers>
          <DataTrigger Binding="{conv:Binding 'MyValue==null'}" Value="false">
             <Setter Property="Background" Value="#FF80C983"></Setter>
          </DataTrigger>
        </Style.Triggers>
      </TextBlock.Style>
    </TextBlock> 
```

神奇的部分是**conv:Binding 'MYValue==null'**。事实上，您可以设置任何您想要的条件 [查看文档]。

请注意，我不是第三方的粉丝。但这个库是免费的，影响不大（只需在项目中添加 2 个 .dll 即可）。

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2012-03-10T09:01:10.297

我的解决方案在 DataContext 实例中（如果使用 MVVM，则为 ViewModel）。如果满足我想要的 Not Null 条件，我添加一个返回 true 的属性。

```
 Public ReadOnly Property IsSomeFieldNull() As Boolean
        Get
            Return If(SomeField is Null, True, False)
        End Get
    End Property 
```

并将 DataTrigger 绑定到上述属性。注意：在 VB.NET 中，请务必使用运算符 If 而不是 IIf 函数，该函数不适用于 Null 对象。那么 XAML 是：

```
 <DataTrigger Binding="{Binding IsSomeFieldNull}" Value="False">
      <Setter Property="TextBlock.Text" Value="It's NOT NULL Baby!" />
    </DataTrigger> 
```

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2016-06-10T10:33:30.207

如果您正在寻找不使用 IValueConverter 的解决方案，您可以随时使用以下机制

```
 <StackPanel>
            <TextBlock Text="Border = Red when null value" />
            <Border x:Name="border_objectForNullValueTrigger" HorizontalAlignment="Stretch" Height="20"> 
                <Border.Style>
                    <Style TargetType="Border">
                        <Setter Property="Background" Value="Black" />
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding ObjectForNullValueTrigger}" Value="{x:Null}">
                                <Setter Property="Background" Value="Red" />
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </Border.Style>
            </Border>
            <TextBlock Text="Border = Green when not null value" />
            <Border HorizontalAlignment="Stretch" Height="20">
                <Border.Style>
                    <Style TargetType="Border">
                        <Setter Property="Background" Value="Green" />
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding Background, ElementName=border_objectForNullValueTrigger}" Value="Red">
                                <Setter Property="Background" Value="Black" />
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </Border.Style>
            </Border>
            <Button Content="Invert Object state" Click="Button_Click_1"/>
        </StackPanel> 
```

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2012-05-10T12:35:18.993

转换器：

```
public class NullableToVisibilityConverter: IValueConverter
{
    public object Convert(object value, Type targetType, object parameter, CultureInfo culture)
    {
        return value == null ? Visibility.Collapsed : Visibility.Visible;
    }
} 
```

捆绑：

```
Visibility="{Binding PropertyToBind, Converter={StaticResource nullableToVisibilityConverter}}" 
```

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2016-02-26T10:49:29.297

您可以使用转换器或在 ViewModel 中创建新属性，如下所示：

```
public bool CanDoIt
{
    get
    {
        return !string.IsNullOrEmpty(SomeField);
    }
} 
```

并使用它：

```
<DataTrigger Binding="{Binding SomeField}" Value="{Binding CanDoIt}"> 
```

# artificial-intelligence - 哪种方法在 TSP 问题中产生更短的旅行：最近邻或遗传算法？

> ID：356207
> 
> 赞同：4
> 
> 时间：2008-12-10T14:22:23.240
> 
> 标签：artificial-intelligence, genetic-algorithm, nearest-neighbor, heuristics, traveling-salesman

在过去的几天里，我注意到一些[网站](http://www.heatonresearch.com/articles/65/page1.html)[展示](http://www.generation5.org/content/2001/tspapp.asp) 了使用遗传算法的 TS 解决方案。

哪种方法会在 TSP 问题中产生更短的行程：最近邻算法还是遗传算法？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-10T16:48:09.670

由于这两种技术都不能保证最佳解决方案，因此您的里程会有所不同。运气好的话，任何一种技术都可以胜过另一种。这两种技术都有优点和缺点。

最近的邻居：+fast，+simple，-通常不是最优的

遗传算法：-更慢，-更复杂，+随着时间的推移，解决方案趋于最优

最大的区别在于，[模拟退火](http://www.ph.biu.ac.il/~rapaport/java-apps/travel.html)和遗传算法等随机算法可能会随着时间的推移而不断改进——让它们运行的​​时间越长，获得最佳解决方案的机会就越大（尽管不能保证）。

由于 NN 速度很快，因此没有什么能阻止您结合这些技术。运行 NN 以找到可能优于随机的起始解决方案。然后，将该解决方案输入到您的遗传算法中，并让它在您认为合适的时候运行。

如果您对最佳解决方案感兴趣，请查看[Lin-Kernighan 启发式](http://www.akira.ruc.dk/~keld/research/LKH/)和[线性规划](http://en.wikipedia.org/wiki/Linear_programming)。两者都被用来为大型旅游寻找最佳解决方案，包括[这个解决方案](http://www.tsp.gatech.edu/pla85900/compute/software.htm)用于[85,900 城市旅游](http://www.tsp.gatech.edu/pla85900/index.html)和[24,978 城市瑞典旅游](http://www.tsp.gatech.edu/sweden/index.html)。

[佐治亚理工学院 TSP 网站](http://www.tsp.gatech.edu/index.html)是一个很好的资源。

# language-agnostic - 我应该使用 `!IsGood` 还是 `IsGood == false`？

> ID：356217
> 
> 赞同：47
> 
> 时间：2008-12-10T14:23:51.630
> 
> 标签：language-agnostic, boolean, not-operator

我不断看到执行这样检查的代码

```
if (IsGood == false)
{
   DoSomething();
} 
```

或这个

```
if (IsGood == true)
{
   DoSomething();
} 
```

我讨厌这种语法，并且总是使用以下语法。

```
if (IsGood)
{
   DoSomething();
} 
```

或者

```
if (!IsGood)
{
   DoSomething();
} 
```

有任何理由使用' `== true`'或' `== false`'吗？

这是可读性的东西吗？人们只是不理解布尔变量吗？

另外，两者之间有性能差异吗？

* * *

## 回答 #1

> 赞同：103
> 
> 时间：2008-12-10T14:26:26.430

我遵循与您相同的语法，它不那么冗长。

人们（更多初学者）更喜欢使用`== true`只是为了确保它是他们想要的。他们习惯于在条件中使用运算符……他们发现它更具可读性。但是一旦你变得更高级，你会发现它很烦人，因为它太冗长了。

* * *

## 回答 #2

> 赞同：40
> 
> 时间：2008-12-10T15:55:45.297

当我遇到

```
if (someBoolean == true) { /* ... */ } 
```

因为当然，如果您不能依赖比较返回布尔值这一事实，那么您也不能依赖将结果与 true 进行比较，因此代码应该变为

```
if ((someBoolean == true) == true) { /* ... */ } 
```

但是，当然，这真的应该是

```
if (((someBoolean == true) == true) == true) { /* ... */ } 
```

但是当然 ...

（啊，编译失败。重新开始工作。）

* * *

## 回答 #3

> 赞同：32
> 
> 时间：2008-12-10T14:31:17.620

我更喜欢**较短的**变体。但有时`== false`有助于使您的代码更短：

对于使用 C# 2.0 的项目中的实际场景，我认为只有一个很好的理由这样做：`bool?`类型。三态`bool?`很有用，并且很容易以这种方式检查其可能值之一。

实际上你不能使用`(!IsGood)`if `IsGood`is `bool?`。但是写作`(IsGood.HasValue && IsGood.Value)`比`(IsGood == true)`.

玩这个示例以获得想法：

```
bool? value = true; // try false and null too

if (value == true)
{
    Console.WriteLine("value is true");
}
else if (value == false)
{
    Console.WriteLine("value is false");
}
else
{
    Console.WriteLine("value is null");
} 
```

还有一种情况我刚刚发现 where`if (!IsGood) { ... }`与`if (IsGood == false) { ... }`. 但是这个是不现实的 ;) 运算符重载在这里可能会有所帮助 :) （以及运算符 true/false 表示在 C# 2.0 中不鼓励 AFAIK，因为它的预期目的是为用户定义的类型提供类似 bool? 的行为，现在您可以使用标准类型获得它！）

```
using System;

namespace BoolHack
{
    class Program
    {
        public struct CrazyBool
        {
            private readonly bool value;

            public CrazyBool(bool value)
            {
                this.value = value;
            }

            // Just to make nice init possible ;)
            public static implicit operator CrazyBool(bool value)
            {
                return new CrazyBool(value);
            }

            public static bool operator==(CrazyBool crazyBool, bool value)
            {
                return crazyBool.value == value;
            }

            public static bool operator!=(CrazyBool crazyBool, bool value)
            {
                return crazyBool.value != value;
            }

            #region Twisted logic!

            public static bool operator true(CrazyBool crazyBool)
            {
                return !crazyBool.value;
            }

            public static bool operator false(CrazyBool crazyBool)
            {
                return crazyBool.value;
            }

            #endregion Twisted logic!
        }

        static void Main()
        {
            CrazyBool IsGood = false;

            if (IsGood)
            {
                if (IsGood == false)
                {
                    Console.WriteLine("Now you should understand why those type is called CrazyBool!");
                }
            }
        }
    }
} 
```

所以...请谨慎使用运算符重载:(

* * *

## 回答 #4

> 赞同：18
> 
> 时间：2008-12-10T14:35:27.347

根据[Code Complete](http://www.codinghorror.com/blog/archives/000020.html)一本书[，Jeff 得名](http://www.codinghorror.com)并高度重视以下是您应该处理布尔值的方式。

```
if (IsGood)
if (!IsGood) 
```

我习惯于实际比较布尔值，但我想为什么要在过程中添加一个额外的步骤并将布尔值视为二流类型。在我看来，比较返回一个布尔值，而布尔类型已经是一个布尔值，所以为什么不直接使用布尔值。

真正的争论归结为为你的布尔值使用好名字。就像你在上面所做的那样，我总是用问题的 for 来表达我的布尔对象。如

*   很好
*   有值
*   等等

* * *

## 回答 #5

> 赞同：15
> 
> 时间：2008-12-10T16:39:09.373

如果所讨论的变量确实应该用作布尔值（即使它的类型不是布尔值），那么专门针对真假进行测试的技术绝对是不好的做法——尤其是在 C/C++ 中。测试`true`可以（并且可能会）导致细微的错误：

这些明显相似的测试给出了相反的结果：

```
// needs C++ to get true/false keywords
// or needs macros (or something) defining true/false appropriately
int main( int argc, char* argv[])
{
    int isGood = -1;

    if (isGood == true) {
        printf( "isGood == true\n");
    }
    else {
        printf( "isGood != true\n");
    }

    if (isGood) {
        printf( "isGood is true\n");
    }
    else {
        printf( "isGood is not true\n");
    }

    return 0;
} 
```

这将显示以下结果：

```
isGood != true
isGood is true 
```

如果您觉得需要针对 true/false 测试用作布尔标志的变量（我认为不应该这样做），您应该使用始终针对 false 进行测试的习惯用法，因为 false 只能有一个值 ( `0`)而一个 true 可以有多个可能的值（除 之外的任何值`0`）：

```
if (isGood != false) ...  // instead of using if (isGood == true) 
```

有些人会认为这是 C/C++ 中的一个缺陷，这可能是真的。但这是这些语言（可能还有许多其他语言）的生活事实，所以我会坚持使用简短的习语，即使在 C# 等不允许您使用整数值作为布尔值的语言中也是如此。

有关此问题实际咬人的示例，请参见此 SO 问题...

*   [isalpha() == true 计算结果为 false??](https://stackoverflow.com/questions/2519627/isalphamychar-true-evaluates-to-false)

* * *

## 回答 #6

> 赞同：13
> 
> 时间：2008-12-10T14:27:19.530

我同意你的看法（我也对此感到恼火）。我认为这只是一个轻微的误解，`IsGood == true`评估为 `bool`，这是`IsGood`开始的。

我经常看到这些附近的实例`SomeStringObject.ToString()`。

也就是说，在使用类型较宽松的语言中，这可能是合理的。但不是在 C# 中。

* * *

## 回答 #7

> 赞同：9
> 
> 时间：2008-12-10T14:29:21.103

有些人发现对已知值的显式检查更具可读性，因为您可以通过阅读来推断变量类型。我不知道一个是否比另一个更好。他们都工作。我发现如果变量固有地持有一个“逆”，那么我似乎倾向于检查一个值：

```
if(IsGood) DoSomething(); 
```

或者

```
if(IsBad == false) DoSomething(); 
```

代替

```
if(!IsBad) DoSomething(); 
```

但同样，这对我来说并不重要，而且我确信它最终会成为同一个 IL。

* * *

## 回答 #8

> 赞同：7
> 
> 时间：2008-12-10T14:27:33.120

仅可读性..

如果您喜欢的任何方式在编译成机器代码时效率更高。但是我希望它们产生**完全相同**的机器代码。

* * *

## 回答 #9

> 赞同：7
> 
> 时间：2008-12-10T17:19:52.320

从到目前为止的答案来看，这似乎是共识：

1.  在大多数情况下，简短的形式是最好的。（IsGood 和 !IsGood）
2.  布尔变量应写为正数。（IsGood 而不是 IsBad）
3.  由于大多数编译器会以任何一种方式输出相同的代码，因此没有性能差异，除了解释型语言。
4.  这个问题没有明确的赢家，大概可以看作是编码风格的宗教战争。

* * *

## 回答 #10

> 赞同：6
> 
> 时间：2008-12-10T17:20:25.907

我更喜欢使用：

```
if (IsGood)
{
    DoSomething();
} 
```

和

```
if (IsGood == false)
{
    DoSomething();
} 
```

因为我发现这更具可读性 - ！太容易错过（在阅读和打字方面）；还有“if not IsGood then...”听起来不太对劲，而不是“if IsGood is false then...”听起来更好。

* * *

## 回答 #11

> 赞同：5
> 
> 时间：2008-12-10T16:01:08.250

有可能（尽管不太可能，至少我希望如此）在 C 代码中 TRUE 和 FALSE 被 #定义为 1 和 0 以外的事物。例如，程序员可能决定将 0 用作“真”，将 -1 用作“假” " 在特定的 API 中。遗留 C++ 代码也是如此，因为“true”和“false”并不总是 C++ 关键字，尤其是在 ANSI 标准出现之前。

还值得指出的是，某些语言——尤其是像 Perl、JavaScript 和 PHP 这样的脚本语言——可以对哪些值算为真和哪些值算作假有有趣的解释。“foo == false”的含义可能与“！foo”有细微的不同（尽管希望不大）。这个问题被标记为“语言不可知论”，一种语言可以定义 == 运算符，使其不能以与 ! 兼容的方式工作。操作员。

* * *

## 回答 #12

> 赞同：5
> 
> 时间：2008-12-10T18:51:43.007

我已将以下内容视为 C/C++ 样式要求。

```
if ( true == FunctionCall()) {
  // stuff
} 
```

原因是如果你不小心把“=”而不是“==”，编译器将放弃为常量赋值。与此同时，它损害了每个 if 语句的可读性。

* * *

## 回答 #13

> 赞同：4
> 
> 时间：2008-12-10T14:28:58.827

有时它在可读性方面有用途。有时，命名变量或函数调用最终可能会成为双重否定，这可能会令人困惑，并且像这样使预期的测试明确有助于提高可读性。

一个很好的例子可能是 strcmp() C/C++，如果字符串相等，则返回 0，否则返回 < 或 > 0，具体取决于差异所在的位置。所以你会经常看到：

```
if(strcmp(string1, string2)==0) { /*do something*/ } 
```

但总的来说，我同意你的看法

```
if(!isCached)
{
    Cache(thing);
} 
```

阅读起来更清晰。

* * *

## 回答 #14

> 赞同：3
> 
> 时间：2008-12-10T14:26:23.947

我更喜欢`!IsGood`，因为对我来说，它更清晰和简洁。检查是否 a`boolean == true`是多余的，所以我会避免这种情况。虽然在语法上，我认为检查 if 没有区别`IsGood == false`。

* * *

## 回答 #15

> 赞同：3
> 
> 时间：2008-12-10T14:37:22.100

我更喜欢*!IsGood*方法，而且我认为大多数来自 c 风格语言背景的人也会更喜欢它。我只是在这里猜测，但我认为大多数编写*IsGood == False*的人都来自更冗长的语言背景，例如 Visual Basic。

* * *

## 回答 #16

> 赞同：3
> 
> 时间：2008-12-10T15:02:03.160

为了可读性，您可能会考虑依赖于其他属性的属性：

```
public bool IsBad => !IsGood; 
```

然后，您就可以真正理解含义：

```
if (IsBad)
{
    ...
} 
```

* * *

## 回答 #17

> 赞同：3
> 
> 时间：2008-12-10T18:21:47.997

唯一更糟糕的是

```
if (true == IsGood) {.... 
```

从来不明白这种方法背后的想法。

* * *

## 回答 #18

> 赞同：3
> 
> 时间：2008-12-10T19:18:37.807

与简化为正则表达式相比，该`!IsGood`模式更容易找到。`IsGood == false`

```
/\b!IsGood\b/ 
```

对比

```
/\bIsGood\s*==\s*false\b/
/\bIsGood\s*!=\s*true\b/
/\bIsGood\s*(?:==\s*false|!=\s*true)\b/ 
```

* * *

## 回答 #19

> 赞同：2
> 
> 时间：2008-12-10T17:41:25.897

在许多语言中，不同之处在于，在一种情况下，您让编译器/解释器决定真或假的含义，而在另一种情况下，它是由代码定义的。C 就是一个很好的例子。

```
if (something) ... 
```

在上面的示例中，“某事”与编译器对“真”的定义进行了比较。通常这意味着“不为零”。

```
if (something == true) ... 
```

在上面的例子中，“something”与“true”进行了比较。“真”的类型（以及可比性）和“真”的值可能由语言和/或编译器/解释器定义，也可能不定义。

通常两者并不相同。

* * *

## 回答 #20

> 赞同：2
> 
> 时间：2008-12-10T21:55:46.787

你忘了：

> 如果（IsGood == [FileNotFound](http://thedailywtf.com/Articles/What_Is_Truth_0x3f_.aspx)）

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2008-12-10T14:30:18.497

就个人而言，我更喜欢 Bob 大叔在 Clean Code 中谈到的形式：

```
(...)
    if (ShouldDoSomething())
    {
        DoSomething();
    }
(...)

bool ShouldDoSomething()
{
    return IsGood;
} 
```

其中，除了最琐碎的条件之外，条件句都放在谓词函数中。那么布尔表达式的实现的可读性就不那么重要了。

* * *

## 回答 #22

> 赞同：1
> 
> 时间：2008-12-10T14:42:16.427

在我看来（尽管我没有证据支持这一点）以 C#/java 类型语言开始的人更喜欢“if (CheckSomething())”方法，而以其他语言开始的人（C++：特别是 Win32 C++) 出于习惯倾向于使用其他方法：在 Win32 中，如果 CheckSomething 返回 BOOL（而不是 bool），“if (CheckSomething())”将不起作用；在许多情况下，API 函数显式返回 0/1 int/INT 而不是真/假值（这就是 BOOL）。

再次，出于习惯，我总是使用更详细的方法。它们在语法上是相同的；我不相信“冗长使我恼火”的废话，因为程序员不是需要被代码打动的人（计算机需要）。而且，在现实世界中，查看我编写的代码的任何特定人员的技能水平都会有所不同，而且我没有时间或倾向向可能不了解一点不重要的人解释语句评估的特殊性像这样的位。

* * *

## 回答 #23

> 赞同：1
> 
> 时间：2008-12-10T16:30:18.910

啊，我有一些同事喜欢较长的形式，认为它比小形式更具可读性！

我开始“修复”这个问题，因为布尔值是自给自足的，所以我放弃了十字军东征...... ^_^ 他们不喜欢在这里清理代码，无论如何，他们认为这使得分支之间的集成变得困难（这是真的，但是那么你永远生活在丑陋的代码中......）。

如果你正确地写出你的布尔变量名，它应该自然地读起来：
`if (isSuccessful)`vs.`if (returnCode)`

在某些情况下，我可能会沉迷于布尔比较，例如：
`if (PropertyProvider.getBooleanProperty(SOME_SETTING, true) == true)`因为它读起来不那么“自然”。

* * *

## 回答 #24

> 赞同：1
> 
> 时间：2008-12-10T16:53:46.037

不知为何我一直很喜欢

```
if (IsGood) 
```

多于

```
if (!IsBad) 
```

这就是为什么我有点喜欢 Ruby 的除非（但它有点太容易被滥用）：

```
unless (IsBad) 
```

如果像这样使用甚至更多：

```
raise InvalidColor unless AllowedColors.include?(color) 
```

* * *

## 回答 #25

> 赞同：1
> 
> 时间：2008-12-10T21:18:22.883

Cybis，在 C++ 中编码时，您也可以使用*not*关键字。很久以前它就是标准的一部分，所以这段代码是完全有效的：

```
if (not foo ())
   bar (); 
```

编辑：顺便说一句，我忘了提到该标准还定义了其他布尔关键字，例如*and* (&&)、*bitand* (&)*或*(||)、*bitor* (|)、*xor* (^)...它们被称为运算符同义词。

* * *

## 回答 #26

> 赞同：1
> 
> 时间：2008-12-11T14:30:15.907

我不使用`==`，但有时我会使用`!=`，因为它在我的脑海中更加清晰。但在我的工作中，我们不使用`!=`or `==`。`hasXYZ()`如果使用or ，我们会尝试获得一个有意义的名称`isABC()`。

* * *

## 回答 #27

> 赞同：1
> 
> 时间：2009-10-30T17:33:46.723

如果你真的认为你需要：

```
if (Flag == true) 
```

那么由于条件表达式本身是布尔值，您可能希望将其扩展为：

```
if ((Flag == true) == true) 
```

等等。这棺材还需要多少钉子？

* * *

## 回答 #28

> 赞同：1
> 
> 时间：2009-10-30T17:51:31.290

如果你碰巧在 perl 中工作，你可以选择

```
unless($isGood) 
```

* * *

## 回答 #29

> 赞同：0
> 
> 时间：2008-12-10T14:43:55.317

我们倾向于在这里做以下事情：

```
if(IsGood) 
```

或者

```
if(IsGood == false) 
```

这样做的原因是因为我们有一些由一个不再在这里（在 Delphi 中）的人编写的遗留代码，看起来像：

```
if not IsNotGuam then 
```

这在过去给我们带来了很大的痛苦，所以我们决定总是尝试检查阳性；如果那不可能，那么将否定与错误进行比较。

* * *

## 回答 #30

> 赞同：0
> 
> 时间：2008-12-10T15:12:40.923

唯一一次我能想到更冗长的代码有意义的地方是在 .NET Visual Basic 之前的版本中，其中 true 和 false 实际上是整数（true=-1，false=0），如果布尔表达式求值为 0 和对任何其他非零值都为真。因此，在旧 VB 的情况下，列出的两种方法实际上并不等效，如果您只希望某些东西在评估为 -1 时为真，则必须明确比较“真”。因此，如果计算为整数（因为它不为零），则计算结果为“+1”的表达式将为真，但它不等于“真”。我不知道为什么 VB 是这样设计的，但我看到很多布尔表达式在旧的 VB 代码中将变量与真假进行比较。

* * *

## 回答 #31

> 赞同：0
> 
> 时间：2008-12-10T15:47:24.767

虽然这不是实际的区别，但我一直将 == 视为数字运算符，因此它不适用于布尔类型。最接近的布尔运算符是“等价”（非异或），它没有 C 风格的运算符。

这样严格的布尔测试就变成了

```
if (!(IsGood ^ true)) 
```

作为布尔数值运算符问题的说明，什么是布尔值

```
true / 2 
```

* * *

## 回答 #32

> 赞同：0
> 
> 时间：2008-12-10T16:08:12.277

这两种形式在语义上是相同的，并且产生相同的机器代码，那么为什么不使用更易读的那一种呢？

`if (IsGood == false)`好于`if(!IsGood)`。

扫码时，很容易弄错“！” 在 bool 变量中的字符的 bool 变量之前。

* * *

## 回答 #33

> 赞同：0
> 
> 时间：2008-12-10T16:10:04.893

在某些情况下，这样做实际上是有用的，尽管并不经常。

这是一个例子。在 Actionscript 2 中，布尔值有 3 个可能的值：

*   真的
*   错误的
*   空/未定义

我通常会在采用可选布尔参数的方法中执行类似的操作：

```
function myFunc(b:Boolean):Void {
  if(b == true) {
    // causes b to default to false, as null/undefined != true
  }
} 
```

或者

```
function myFunc(b:Boolean):Void {
  if(b != false) {
    // causes b to default to true, as null/undefined != false
  }
} 
```

取决于我想将值默认为什么。虽然如果我需要多次使用布尔值，我会做这样的事情：

```
function myFunc(b:Boolean):Void {
  b = (b == true); // default to false
} 
```

或者

```
function myFunc(b:Boolean):Void {
  b = (b != false); // default to true
} 
```

* * *

## 回答 #34

> 赞同：0
> 
> 时间：2008-12-10T22:10:16.570

我认为这真的取决于语言。

比如说，在 PHP 中，某些函数要么返回 false，要么返回非负数。

然后：

```
if(foo(bar)) { ... } 
```

方案不会很好地工作，因为您无法区分返回 false 或 0。

在其他没有这种讨厌的小 FUBAR 的语言中，我认为这两种形式都是可以接受的。

* * *

## 回答 #35

> 赞同：0
> 
> 时间：2008-12-11T08:13:35.447

只要我们有`if (isGood)`或`if (!isGood)`它都可以。

有时我会遇到这样的代码...

```
if (!getGreatGrandFateher.getGrandFather().getFather().getFirstChild().isMale())
{
   doSomething();
} 
```

乍一看这会误导，`doSomething`如果它是男性的话。小'​​！' 在“if”在像上面这样的大代码结构中迷失之后。

像下面这样的显式检查提供了更好的可读性

```
if(getGreatGrandFateher.getGrandFather().getFather().getFirstChild().isMale() == false)
{
   doSomething();
} 
```

* * *

## 回答 #36

> 赞同：0
> 
> 时间：2008-12-11T08:56:40.400

一种尺寸并不适合所有人。有时可以使更简洁的形式变得简单或惯用，例如 !(x % y) ，如果 y 是 x 的因子，则返回“True”。

其他时候，更明确的比较会更有用。[(x, y) for x in range(10) for y in range(10) if not (x and y)] 不像 [(x, y) for x in range(10) for y in range (10) 如果 (x == 0 或 y == 0)]

* * *

## 回答 #37

> 赞同：0
> 
> 时间：2008-12-12T22:10:02.333

在像 C 这样没有“布尔”类型的语言中，我推荐更长的方式，即

```
if (is_good == True)
{
} 
```

原因是 is_good 不仅是`true`/ `false`（很可能实现为字符），因此可能会被其他值破坏或设置不正确。

那么这有什么好处呢？您的代码将能够发现任何`is_good`设置不正确的问题，因为没有 == True 或 == False 检查任何东西都会为 true ;) 如果你真的是指布尔值，那就太糟糕了。

* * *

## 回答 #38

> 赞同：0
> 
> 时间：2008-12-13T16:53:30.303

我喜欢根据变量的命名使用不同的样式，例如：

以 Is、Has 等前缀命名的变量通过查看名称很明显是我使用的布尔值：

```
if(IsSomething) 
```

但是如果我有没有我喜欢使用的前缀的变量

```
if(Something == true) 
```

无论您使用哪种形式，您都应该根据您使用的编程语言来决定。

```
if(Something) and if(Something == true) 
```

在不同的编程语言中可以有非常不同的含义。

* * *

## 回答 #39

> 赞同：0
> 
> 时间：2009-10-16T00:33:24.160

有人可能会争辩说，像 if isValidDate==true 这样的测试会导致过度嵌套。考虑一个验证我们是否拥有来自用户的有效数据的代​​码块，例如：

```
if (isValidDate == true) {
    if (isValidQuantity == true) {
         if (isOtherThingValid == true) {
              bool result = doThing();
              if (result == true) {
                   thatWorked();
         } // long block of code that tries to compensate for OtherThing's invalidness
    } // obtuse function call to a third party library to send an email regarding the invalid quantity
} // is this the function close brace or the if... 
```

这让我发疯，这也是为什么我养成了反过来做事的习惯的部分原因：

```
if (isValidDate == false) {
    logThisProblem("Invalid date provided.");
    return somethingUseful;
}

if (isValidQuantity == false) {
    logThisProblem("Invalid quantity provided.");
    return somethingUseful;
}

if (isOtherThingValid == false) {
    logThisProble("Other thing not valid.");
    return somethingUseful;
}

// OK ... we've made it this far...
bool result = doThing(date, quantity, otherThing); 
```

* * *

## 回答 #40

> 赞同：-1
> 
> 时间：2008-12-10T19:12:44.337

用 C#/C++/Java/etc 编码...我总是喜欢

`if (something == true)
if (something == false)`

超过

`if (something)
if (!something)`

因为感叹号很难一目了然，除非我使用大字体（但是我会在页面上看到更少的代码 - 并不是我们所有人都能买得起 24 英寸以上的显示器）。我特别不喜欢不一致和使用`if (something)`和`if (something == false)`

然而，当我用 Python 编码时，我几乎总是更喜欢

`if something:
if not something:`

因为“不”是显而易见的。

* * *

## 回答 #41

> 赞同：-2
> 
> 时间：2009-10-16T00:41:57.233

我会

```
if (isGood) {
  doSomething();
} 
```

和

```
if (isNotGood) {
    doSomethngElse();
} 
```

读起来更好。

# moores-law - 摩尔定律问题

> ID：356219
> 
> 赞同：3
> 
> 时间：2008-12-10T14:24:41.923
> 
> 标签：moores-law

假设你需要在世界上最快的超级计算机上运行一个需要 10 年才能完成的程序。你可以：

*   现在花费 2.5 亿美元
*   计划 9 年，[摩尔定律](http://en.wikipedia.org/wiki/Moore%27s_Law)加速（快 4,000 倍），10 年花费 100 万美元，2 周内完成。

**什么是最优策略？**

[“[长期存储趋势与你](https://research.microsoft.com/~Gray/talks/IO_talk_2006.ppt)”的问题]

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-12-10T14:34:36.880

[摩尔定律](http://en.wikipedia.org/wiki/Moore%27s_law)与速度无关，它与给定硅区域中晶体管的数量有关。不能保证在 9 年内速度会提高 4000 倍。如果有的话，GHz 速度近年来已经趋于平稳。目前正在增加的是 CPU 中的内核数量。

在您的问题中，如果程序不适合矢量化（即可以拆分为可以并行计算的不同部分），那么等待 9 年不会带来任何好处，它不会像时钟速度那样快得多在随后的几年中不太可能筹集到太多资金。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-12-10T17:42:05.393

**假设**程序是无限可并行化的（因此它总是可以利用所有可用 CPU 的所有内核）......
**假设**程序不能在运行中暂停并移动到另一台机器......
**假设**时间是唯一的问题（也许我们有一大笔研究经费，而且我们总是使用最好的电脑）......

我们有四个方程（嗯，实际上其中两个是函数）：

1.  `endtime(startyear) = startyear + (calculations / speed(startyear))`
2.  `speed(year) = speed(year-1.5)`⁴（问题假设硬件和软件速度每 18 个月翻一番）
3.  `endtime(0) = 0 + (calculations/speed(0)) = 10 years`
4.  `speed(0) = calculations/(10 years)`（由#3暗示）

我开始使用导数来最小化结束时间，但我意识到我不能很好地记住我的微分方程。所以我将#2 转换为[等效的指数增长公式](http://en.wikipedia.org/wiki/Exponential_growth#Basic_formula)：

> `speed(year) = speed(0)*4`^((年/1.5)) `= (calculations/10)*4`^((年/1.5))

然后我写了这个小 BeanShell 脚本：

```
calculations() {
    return 10000000; // random constant (gets cancelled out anyway)
}
speed(year) {
    speed0 = calculations()/10; // constant factor
    return speed0*Math.pow(4.0, year/1.5);
}
endtime(startyear) {
    return startyear + calculations()/speed(startyear);
}
findmin() {
    start = 0.0;
    finish = 10.0;
    result = 0.0;
    // home in on the best solution (there should only be one minimum)
    for (inc = 1; inc > 0.00000001; inc /= 2.0) {
        result = findmin(start,finish,inc);
        start = result-2*inc;
        finish = result+inc;
    }
    print("Minimum value is " + result + ", taking a total of " +
            endtime(result) + " years");
}
findmin(start,finish,inc) {
    lastNum = 0;
    lastVal = Double.MAX_VALUE;
    for (i = start; i < finish; i += inc) {
        result = endtime(i);
        if (result > lastVal) {
            print("Minimum value between " + start + " and " + finish +
                    " is " + lastVal + ", occurring at " + lastNum);
            return i;
        }
        lastNum = i;
        lastVal = result;
    }
    return lastNum;
} 
```

输出：

```
bsh % source("moore.bsh");
bsh % findmin();
Minimum value between 0.0 and 10.0 is 3.5749013123685915, occurring at 2.0
Minimum value between 1.0 and 4.0 is 3.4921256574801243, occurring at 2.5
Minimum value between 2.0 and 3.5 is 3.4921256574801243, occurring at 2.5
Minimum value between 2.25 and 3.0 is 3.4886233976754246, occurring at 2.375
Minimum value between 2.25 and 2.625 is 3.488620519067143, occurring at 2.4375
Minimum value between 2.375 and 2.5625 is 3.488170701257679, occurring at 2.40625
Minimum value between 2.375 and 2.46875 is 3.488170701257679, occurring at 2.40625
Minimum value between 2.390625 and 2.4375 is 3.488170701257679, occurring at 2.40625
(snip)
Minimum value between 2.406149387359619 and 2.4061494767665863 is 3.4881706965827037,
occurring at 2.4061494171619415
Minimum value is 2.4061494320631027, taking a total of 3.488170696582704 years 
```

因此，根据我之前所说的假设，答案是等待**2.406149... 年**（或大约**2 年 148 天**，根据谷歌）。

* * *

**编辑：**我注意到用上面重写的第二个公式，解决只需要简单的微积分。

```
endtime(x) = x + c/speed(x) (where c = calculations)
speed(x) = speed(0) * 4^(x/1.5) = (c/10)*4^(2x/3)
=> endtime(x) = x + c/((c/10)*4^(2x/3))
              = x + 10*(4^(-2x/3))
d/dx endtime(x) = 1 + 10*ln(4)*(-2/3)*(4^(-2x/3)) 
```

[临界点](http://en.wikipedia.org/wiki/Critical_point_(mathematics))是当 d/dx = 0 时，所以

```
1 + 10*ln(4)*(-2/3)*(4^(-2x/3)) = 0
=> 4^(-2x/3) = 1/(10*ln(4)*(2/3)) 
```

取两边的 log4：（记住[log4(x) = ln(x)/ln(4)](http://en.wikipedia.org/wiki/Logarithm#Change_of_base)和[ln(1/x) = -ln(x)](http://en.wikipedia.org/wiki/List_of_logarithmic_identities#Algebraic_identities)）

```
-2x/3 = ln(1/(10*ln(4)*(2/3))) / ln(4)
      = -ln(10*ln(4)*2/3) / ln(4)
=> x = (-3/2) * -ln(1/(10*ln(4)*2/3)) / ln(4)
     = 3*ln(10*ln(4)*(2/3)) / 2*ln(4) 
```

这看起来像一团糟（这里没有显示数学公式的好方法也无济于事）。但是如果你把它插入你的计算器，你应该得到**2.4061494159159814141268120293221**（至少如果你使用 Windows 计算器，就像我刚刚做的那样）。所以我之前的回答正确到小数点后七位（当然，这在这样的问题中毫无意义）。

（我应该注意，这只是一个临界点，不一定是最小值。但是二阶导数（形式为`-(some constant)*4`^(-2x/3)）总是负数。所以函数总是向上凹的，因此唯一的临界点是最低。）

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-12-10T14:38:27.323

[摩尔定律](http://en.wikipedia.org/wiki/Moore%27s_law)与**将放置在单个芯片中的晶体管数量**有关，通常与微处理器**的速度无关**。

也就是说，从我们所看到的当前趋势来看，我们可能会看到越来越多的内核被装入单个处理器芯片中，因此并发编程将变得越来越重要，以利用处理器中可用的原始处理能力。处理器。

所以，很难说是现在做还是等待——然而，无论哪种方式，**并发编程或分布式计算都将发挥作用**，因为**我们不会看到单核处理器以指数级速度增长**（就时钟速度）由于当前半导体技术的物理限制和自然规律。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-12-10T14:37:05.533

确保您的程序可以暂停和继续，然后在它们出现时将其放在越来越快的机器上。两全其美...

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-10T14:33:41.250

现在花钱——现在美元的价格/价值与 10 年后的估计相比，就像试图预测 3 个月后的天气一样。另外，这没有考虑到诸如 10 年内编程趋势之类的因素，以及事情实际上是否会快 4,000 倍或可扩展/并行性提高 4,000 倍，这似乎是最近的趋势。

此外，根据玛雅人的说法，世界将在 2012 年结束，所以现在就花掉战利品吧！

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-10T14:36:34.847

简化模型以做出您现在可以运行的估计。随着更多/更好的资源可用，优化模型以获得更准确的结果。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-12-10T14:37:24.580

完成它的最快方法是：

*   为当前的技术编写一个可以移植到每一代新一代的版本。
*   除了迁移之外，继续对算法等方面的任何改进进行编程。

最便宜的方法显然是将其放置更长时间。您确实需要考虑编程时间（这将是足够恒定的）。

另外，我不想在摩尔定律继续上投入太多。

还要记住，摩尔定律与晶体管的密度有关，而不是与特定问题的计算速度有关。即使总体上计算能力提高了这么多，也并不一定意味着您的应用程序会受益。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-10T14:32:33.640

但是摩尔定律并没有加速编程。

9年的编程永远不会浓缩为2周。

除非你成功地用了 9 年的时间来编写一台自动思维阅读机，否则我想。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-12-10T14:34:03.713

编程 4 年，然后在 2.5 中运行？

（我敢肯定在 4 到 5 年之间会有一个“完美”的答案......）

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-12-10T14:35:28.407

最佳策略取决于您必须运行程序的原因。

在这种情况下，第二个选项是最好的，因为您将获得结果（这实际上很重要）的那一刻将是相同的。

实际上，我相信如果每个人都选择第一个（并且有钱这样做）......摩尔定律将受到损害。我假设如果我们所有的计算需求都得到满足……我们就不会如此致力于保持技术发展向前发展。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-12-10T14:38:56.497

这是一个有缺陷的假设，即摩尔定律实际上是一个定律。它可能会更好地命名为摩尔理论。你等待的风险是，10 年后，它可能还需要 10 年才能运行。现在启动程序（如果可能，内置暂停和重新启动），组建一个团队，寻找其他更快的方法来解决问题。一旦您确信其中一个会提供更快的解决方案，请切换。

**编辑**：作为一个问题，我认为这个问题的最佳价值是它让你检查你的假设是否有效。显而易见的解决方案——因为根据问题定义，你在相同的时间内用更少的钱得到相同的结果——是等待，但这取决于一些隐含的假设。如果这些假设不成立，那么显而易见的解决方案不一定是这里许多答案所证明的最佳解决方案。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-12-10T15:17:57.213

问题中指定问题在超级计算机上运行，​​因此问题必须是可向量化的。超级计算机的速度比摩尔定律快得多，因此根据实际问题空间，一种方法是聘请黑客土匪创建一个全球分布式沃霍尔蠕虫，获取 85% 计算机的资源在网上寻找像梅森素数搜索（GIMPS）这样的短的大规模分布式网格，并在 20 分钟内解决问题。

（解决问题的方法很多，但我当然希望这被标记为幽默）

# html - 通过 HTML 播放简单的音乐或曲调？

> ID：356239
> 
> 赞同：0
> 
> 时间：2008-12-10T14:30:06.763
> 
> 标签：html, xml

我正在寻找一种在网站上发布音乐“曲调”的简单方法。

所以这里有一个类比来解释我的问题：

假设我想在我的网页上放置几个大三角形作为图片。我可以画一个位图并保存为 GIF/JPG/PNG，把它放在互联网上的某个地方，然后用一个元素链接到它。这可行，但图片越大，我的图像文件占用的空间就越多。

或者，我可以使用[SVG](http://en.wikipedia.org/wiki/Scalable_Vector_Graphics)（即使缺少 Internet Explorer 支持，grr）并使用矢量图形，无论图像大小如何，它都使用很少的带宽。

在音乐界，我可以使用 WAV 或 MP3 文件。效果很好——但如果我只想发布一首 1 分钟的简单音符歌曲，通过了解持续时间和音高，并且不在乎它听起来 100% 完全像钢琴或手风琴，有没有办法（ a) 用歌曲创建一个文件，(b) 以节省空间的格式将其放到网上？1 分钟的 MP3 通常占用数百千字节。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-10T14:37:09.543

您可以使用 MIDI 文件，它会按照您的建议存储持续时间/音高等。您应该能够轻松找到创建此类文件的软件。但是，您可能会发现结果听起来很糟糕，因为它非常依赖于最终用户机器上可用的合成器硬件/软件。

对于您需要的东西，这可能是合理的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-10T14:35:17.130

研究使用 Flash 在网站上播放音乐文件。

您可以通过 JavaScript 调用来控制 Flash。

这是目前在网站中播放小音频剪辑的“推荐”方式。

对于较大的媒体文件，请使用 Flash 播放器查看流式 FLV 文件。

希望这可以帮助 ：）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-10T14:39:47.790

查看乐器的 MIDI 格式。 [http://en.wikipedia.org/wiki/MIDI](http://en.wikipedia.org/wiki/MIDI)

# javascript - 带有隐藏标签的表格到网络购物车 - 在同一页面上显示它？

> ID：356243
> 
> 赞同：1
> 
> 时间：2008-12-10T14:30:36.700
> 
> 标签：javascript, forms, input, cgi-bin

我想要做的基本上是这样的：在**一个**页面上，我的客户可以单击**查看购物**车链接，他们的购物车内容显示在同一页面下方。这是我的基本链接形式：

```
 <FORM METHOD=post ACTION="http://www.123websiteservices.com/cgi-bin/cybercart.pl">
 <INPUT TYPE=hidden NAME=merchant VALUE="jessicas"/>
 <INPUT TYPE=hidden NAME=action VALUE=order/>
 <INPUT TYPE=hidden NAME=page_name VALUE="homepage.html"/>
 <INPUT TYPE=image src="http://www.123websiteservices.com/~jessicas/images/viewcart.gif"     border=0/></FORM> 
```

我不知道如何将 JavaScript 包装在它周围以使其工作。任何帮助是极大的赞赏！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-10T14:37:18.030

这应该让您开始了解如何在单击 viewcart.gif 时显示购物车。

```
< script>
function ShowScript() {
   // Do Your Show cart stuff here 
   return false
}
< /script>

...

< input type="image" src="viewcart.gif" onClick="return ShowScript();" /> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-10T15:18:00.427

像这样？？

```
< FORM METHOD=post ACTION="http://www.123websiteservices.com/cgi-bin/cybercart.pl">
< INPUT TYPE=hidden NAME=merchant VALUE="jessicas">
< INPUT TYPE=hidden NAME=action VALUE=order>
< INPUT TYPE=hidden NAME=page_name VALUE="viewcart.html">
< script>function ShowScript() { 
       // !!! Don't know what "show cart stuff needs to go here!!!
    return false}< /script>...<input type="image" src="viewcart.gif" onClick="return ShowScript();" /></FORM > 
```

非常感谢您的帮助，我仍然在学习很多东西！哈哈

# java - 从 Java 中的方法返回状态标志和消息的最佳方法

> ID：356248
> 
> 赞同：30
> 
> 时间：2008-12-10T14:32:31.893
> 
> 标签：java, exception, return-value

我有一个看似简单的场景，我想要一个简单的解决方案，但不清楚哪个是“最正确”或“最 Java”。

假设我在某个类中有一个小的身份验证（客户端客户端）方法。身份验证可能由于多种原因而失败，我想为控制流返回一个简单的布尔值，但也为用户返回一个字符串消息。这些是我能想到的可能性：

*   返回一个布尔值，并传入一个 StringBuilder 来收集消息。这是最接近 C 风格的方式。
*   抛出异常而不是返回 false，并包含该消息。我不喜欢这样，因为失败并不例外。
*   使用布尔值和字符串创建一个名为 AuthenticationStatus 的新类。对于一种小方法来说，这似乎有点矫枉过正。
*   将消息存储在成员变量中。这会引入一个潜在的竞争条件，我不喜欢它暗示一些不存在的状态。

还有其他建议吗？

**编辑**错过了这个选项关闭

*   成功返回 null - 这不安全吗？

**编辑**解决方案：

我选择了最面向对象的解决方案并创建了一个小的 AuthenticationResult 类。我不会用任何其他语言来做这件事，但我喜欢用 Java 做。我也喜欢返回 String[] 的建议，因为它类似于 null 返回，但更安全。Result 类的一个优点是，如果需要，您可以收到包含更多详细信息的成功消息。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-12-10T14:36:26.440

返回一个带有布尔标志和内部字符串的小对象可能是最类似于 OO 的方式，尽管我同意对于像这样的简单案例来说这似乎有点矫枉过正。

另一种选择是始终返回一个字符串，并让 null（或空字符串 - 您选择哪个）表示成功。只要在 javadocs 中清楚地解释了返回值，就不应该有任何混淆。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-12-10T14:40:15.527

你可以使用异常......

```
try {
    AuthenticateMethod();
} catch (AuthenticateError ae) {         
    // Display ae.getMessage() to user..
    System.out.println(ae.getMessage());
    //ae.printStackTrace();    
} 
```

然后如果您的 AuthenticateMethod 发生错误，您将发送一个新的 AuthenticateError （扩展异常）

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2008-12-10T15:15:41.307

避免返回“哨兵值”，尤其是 null。您最终将得到一个代码库，其中调用者在不阅读实现的情况下无法理解方法。在 null 的情况下，如果调用者忘记（或不知道）您的方法可能返回 null，他们可能会以 NullPointerExceptions 结束。

如果我想从一个方法返回多个值，Bas Leijdekkers 的元组建议是一个很好的建议。我们使用的一个[`P2<A, B>`](http://functionaljava.googlecode.com/svn/artifacts/2.16/javadoc/fj/P2.html)来自[Functional Java](http://functionaljava.org/)库。这种类型是其他两种类型的联合联合（它包含每种类型的一个值）。

为控制流抛出异常有点代码味道，但检查异常是从方法中获取不止一种类型值的一种方式。不过，还存在其他更清洁的可能性。

1.  您可以拥有一个[`Option<T>`](http://functionaljava.googlecode.com/svn/artifacts/2.16/javadoc/fj/data/Option.html)包含两个子类的抽象类，`Some<T>`并且`None<T>`. 这有点像 null 的类型安全替代方案，也是实现部分函数（未为某些参数定义返回值的函数）的好方法。[函数式 Java](http://functionaljava.org)库有一个实现的全功能`Option`类`Iterable<T>`，因此您可以执行以下操作：

    ```
    public Option<String> authenticate(String arg) {
       if (success(arg))
          return Option.some("Just an example");
       else
          return Option.none();
    }

    ...

    for(String s : authenticate(secret)) {
       privilegedMethod();
    } 
    ```

2.  或者，您可以将两种类型的不相交并集用作一个[`Either<L, R>`](http://functionaljava.googlecode.com/svn/artifacts/2.16/javadoc/fj/data/Either.html)类。它包含一个值为 type`L`或的值`R`。这个类同时实现`Iterable<T>`了`L`and `R`，所以你可以做这样的事情：

    ```
    public Either<Fail, String> authenticate(String arg) {
       if (success(arg))
          return Either.right("Just an example");
       else
          return Either.left(Fail.authenticationFailure());
    }

    ...

    Either<Fail, String> auth = authenticate(secret);
    for(String s : auth.rightProjection()) {
       privilegedMethod();
    }
    for(Fail f : auth.leftProjection()) {
       System.out.println("FAIL");
    } 
    ```

所有这些类，`P2`，`Option`， 和`Either`在各种各样的情况下都很有用。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-12-10T14:42:24.103

还有一些选择：

*   为每种类型的失败返回一个单独的枚举值。枚举对象可以包含消息
*   返回一个 int 并有一个单独的方法从数组中查找适当的消息
*   创建一个可以包含两个值的通用实用程序元组类。这样的类可以在更多的地方有用。

简单的元组示例，实际实现可能需要更多：

```
class Tuple<L, R> {

    public final L left;
    public final R right;

    public Tuple( L left, R right) {
        this.left = left;
        this.right = right;
    }
} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-10T14:35:18.843

您可以返回一个错误消息集合，为空表示没有问题。这是对您的第三个建议的改进。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-10T14:37:00.247

我个人认为使用布尔值和字符串创建一个名为 AuthenticationStatus 的新类是最类似于 Java 的方式。虽然这看起来有点矫枉过正（很可能是这样），但它对我来说似乎更干净，更容易理解。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-12-10T15:34:29.647

仅仅因为失败的身份验证是司空见惯的并不意味着它不是例外。

在我看来，身份验证失败是检查异常的典型用例*。*（嗯......也许文件不存在是典型的用例，但身份验证失败是关闭＃2。）

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-10T14:37:50.900

我自己使用“小类”，通常使用内部类。我不喜欢使用参数来收集消息。

此外，如果可能失败的方法是“低级别”——比如来自应用服务器或数据库层，我更愿意返回一个带有返回状态的 Enum，然后在 GUI 级别将其转换为字符串。如果您要国际化您的代码，请不要在低级别传递用户字符串，因为这样您的应用服务器一次只能以一种语言响应，而不是让不同的客户端以不同的语言工作。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-12-10T14:39:24.170

这是您有这种要求的唯一方法吗？如果没有，只需生成一个带有 isSuccessful 标志和消息字符串的通用 Response 类，并在任何地方使用它。

或者您可以让方法返回 null 以显示成功（不漂亮，并且不允许返回成功和消息）。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-12-10T14:52:52.180

我很可能会选择类似的东西：

```
 class SomeClass {
public int authenticate (Client client) {
//returns 0 if success otherwise one value per possible failure
}
public String getAuthenticationResultMessage (int authenticateResult) {}
//returns message associated to authenticateResult
} 
```

使用这种“设计”，您可以仅在身份验证失败时询问消息（我希望这是 99,99% 时间发生的场景；））

将消息解析委托给另一个类也可能是一种很好的做法。但这取决于您的应用程序需求（主要是，它需要 i18n 吗？）

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-12-10T17:07:24.293

这似乎是其他编程语言中的一个常见习语，但我无法弄清楚是哪一个（我在问题中读到的 CI 猜测）。

几乎相同的问题张贴[在这里](https://stackoverflow.com/questions/342638/java-string-parameters)和[这里](https://stackoverflow.com/questions/345626/how-can-i-avoid-using-exceptions-for-flow-control)

试图从单个函数返回两个值可能会产生误导。但正如这样做的尝试所证明的那样，它也可能非常有用。

如果这是之前发布的应用程序中的常见流程，那么绝对创建带有结果的小班应该是正确的方法。

这是关于从函数返回两个值的引用：

> 就编程风格而言，这种想法在面向对象的编程语言中并不吸引人。返回对象表示计算结果是返回多个值*的习惯用法。*有些人建议您不必为不相关的值声明类，但也不应该从单个方法返回不相关的值。

我在 java 的功能请求中发现它允许[多个返回值](http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=4222792)

*查看日期为：2005-05-06 09:40:08 的“评估”部分*

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-12-10T17:26:40.777

成功的身份验证应该是“正常”情况，因此身份验证失败是例外情况。

无论如何，用户的不同状态字符串是什么。我只能看到两个，成功或失败。任何进一步的信息都是潜在的安全问题。异常解决方案的另一个优点是不能以错误的方式调用，并且失败的情况更明显。没有例外，你写：

```
if (authenticate()) {
  // normal behaviour...
}
else {
  // error case...
} 
```

您可能会不小心调用忽略返回值的方法。然后在没有成功验证的情况下执行“正常行为”代码：

```
authenticate();
// normal behaviour... 
```

如果您使用异常，则不会发生这种情况。如果您决定不使用异常，请至少命名该方法，以便清楚地知道它返回一个状态，例如：

```
if (isAuthenticated()) {
//...
} 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-12-10T18:04:58.280

这里有很多很好的答案，所以我会保持简短。

我认为用户无法进行身份验证可以被认为是检查异常的有效案例。如果您的编程风格倾向于处理异常，那么没有理由不这样做。它还删除了“如何从一个方法返回多个值，我的方法只做一件事它验证用户”

如果您要返回多个值，则花 10 分钟创建一个通用的 PairTuple（也可以是多个 TripleTuple，我不会重复上面列出的示例）并以这种方式返回您的值。我讨厌有小的 dto 样式对象来返回各种多个值，它们只会使这个地方变得混乱。

* * *

## 回答 #14

> 赞同：-1
> 
> 时间：2008-12-10T14:36:54.643

返回一个字符串怎么样。Empty 或 Null 表示成功。失败时的错误消息。最简单的方法。但是不确定它是否读得好。

* * *

## 回答 #15

> 赞同：-1
> 
> 时间：2008-12-10T14:48:46.883

我会首先选择异常选项。

但是，其次，我更喜欢 C 风格的技术：

```
public boolean authenticate(Client client, final StringBuilder sb) {
    if (sb == null)
        throw new IllegalArgumentException();
    if (isOK()) {
        sb.append("info message");
        return true;
    } else {
        sb.append("error message");
        return false;
    }
} 
```

这并不奇怪，它在框架的许多地方都完成了。

* * *

## 回答 #16

> 赞同：-1
> 
> 时间：2008-12-10T16:21:56.197

返回对象。如果需要，它允许您将其他功能放入类中。Java 中的短期对象可以快速创建和收集。

* * *

## 回答 #17

> 赞同：-3
> 
> 时间：2008-12-10T14:50:13.977

我通常不会为返回类型创建特殊对象，而是返回一个存储所有返回信息的数组。好处是您可以使用新元素扩展此数组，而无需创建新类型和混乱。不利的一面是，您必须确切知道从特定方法返回数组时应该显示哪些元素才能正确解析它。通常我同意某些结构，比如第一个元素总是布尔指示成功，第二个是带有描述的字符串，其余的都是可选的。例子：

```
public static void main(String[] args)
{
    Object[] result = methodReturningStatus();
    if(!(Boolean)result[0])
        System.out.println("Method return: "+ result[1]);
}

static Object[] methodReturningStatus()
{
    Object[] result = new Object[2];

    result[0] = false;
    result[1] = "Error happened";

    return result;
} 
```

# c# - 远程性能监视器无法检索 GC 堆

> ID：356271
> 
> 赞同：1
> 
> 时间：2008-12-10T14:37:17.750
> 
> 标签：c#, .net, compact-framework

嗨*，

我正在使用 .net 3.5 紧凑型框架 powertoys 中的 .NET 紧凑型框架远程性能监视器。

它能够运行应用程序并从中获取统计信息，但一段时间后它无法查看平台上的 GC 堆，但出现以下异常：http://files.stormenet.be/cfrpm_exc1.JPG

[http](http://files.stormenet.be/cfrpm_exc1.JPG) [://files。 stormenet.be/cfrpm_exc2.JPG](http://files.stormenet.be/cfrpm_exc2.JPG)

我在 x86 cpu 上运行 WIN CE 6。

任何人都知道如何解决这个问题？（或知道另一种工具......）

**编辑：**似乎我不是唯一一个有[这个问题](https://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=331277)的人。所以我想我应该寻找替代工具......

> 致电 Microsoft 的支持得到答复，即 Microsoft 不支持 .NETCF 3.5 的远程性能监视器 (RPM)（可能是 RPM 附带的整个“Power Toys”包）。因此，尽管在去年的 MEDC 会议上大肆宣传这些工具，但如果它们对您不起作用，那么您就不走运了（至少就 MS 支持而言）。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-23T15:34:01.243

如果有什么安慰的话，我咨询了 CF 团队，他们终于回复了我。他们已经把它作为一个开放的错误，并正在研究它。我认为这意味着不是您，并且在某些情况下可能会导致这种情况（到目前为止，我从未在任何设备上看到过它）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-19T20:38:33.097

您是否尝试过针对它运行 2.00 版本？

我也不会这么快把矛头指向 MS。问题可能与 OEM 对操作系统的定制有关。

# components - 我们是否放弃了代码重用的想法？

> ID：356275
> 
> 赞同：12
> 
> 时间：2008-12-10T14:37:25.767
> 
> 标签：components, soa, code-reuse

几年前，媒体上充斥着各种各样的文章，说明代码重用的想法是如何提高生产力和代码质量的一种简单方法。

从我定期查看的博客和网站来看，“代码重用”的想法似乎已经过时了。也许“代码重用”的倡导者都加入了 SOA 的行列？:-)

有趣的是，当您在 Google 中搜索“代码重用”时，第二个结果的标题是：

“内部代码重用被认为是危险的”！

代码重用的想法对我来说只是常识，毕竟看看 apache commons 项目的成功！

我想知道的是：

*   您或您的公司是否尝试重用代码？
*   如果是这样，如何以及在什么级别，即低级 api、组件或共享业务逻辑？您或您的公司如何重用代码？
*   它有效吗？

讨论？

* * *

我完全意识到有许多可用的开源库，并且任何使用过 .NET 或 Java 的人都以某种形式重用了代码。这是常识！

我更多地指的是组织内的代码重用，而不是通过共享库等跨社区重用。

我最初问的是；

*   您或您的公司是否尝试重用代码？
*   如果是这样，如何以及在什么级别，即低级 api、组件或共享业务逻辑？您或您的公司如何重用代码？

从我坐的地方，我看到很少有公司试图在内部重用代码的例子？

如果您有一段可能在中型组织中共享的代码，您将如何通知公司的其他成员该 lib/api/etc 存在并且可能有用？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-12-10T14:50:58.203

您所指的文章的标题具有误导性，实际上是一本非常好的读物。代码重用是非常有益的，但任何事情都有缺点。基本上，如果我没记错的话，这篇文章的主旨是你将代码密封在一个黑盒子里，而不是重新访问它，所以当原始开发人员离开时，你就会失去知识。虽然我明白这一点，但我不一定同意它——至少不赞成“天塌下来”的看法。

实际上，我们将代码重用分组为不仅仅是可重用的类，我们着眼于整个企业。更像是框架增强或解决横切关注点的东西被放入我们所有应用程序都使用的开发框架中（想想验证前和验证后、日志记录等）。我们还有适用于多个应用程序的业务逻辑，因此这些事情被转移到可在任何地方访问的 BAL 核心。

我认为重要的是，如果它们不会真正被重用，就不要提倡重用。它们应该有很好的文档记录，以便新开发人员也可以拥有资源来帮助他们跟上进度。很有可能，如果不共享知识，代码最终会在其他地方重新发明，如果您在文档和知识共享方面不严格，则会导致重复。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-12-10T15:27:30.673

我们重用代码——事实上，我们的开发人员专门编写可以在其他项目中重用的代码。这得到了很好的回报——我们能够快速启动新项目，并且我们迭代地强化我们的核心库。

但是不能只写代码并期望它被重用；**代码重用需要团队成员**和其他用户之间的沟通，以便人们知道哪些代码可用，以及如何使用它。

要使代码重用有效地工作，需要以下几点：

*   代码或库本身
*   跨多个项目或工作对代码的需求
*   代码特性/功能的通信
*   关于如何使用代码的说明
*   承诺随着时间的推移维护和改进代码

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-10T15:09:51.457

代码重用是必不可少的。我发现它也迫使我尽可能地概括，也使代码更适应不同的情况。理想情况下，您编写的几乎每个较低级别的库都应该能够适应不同应用程序的一组新要求。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-10T14:45:32.287

我认为代码重用在很大程度上是通过开源项目完成的。任何可以重用或扩展的东西都是通过库来完成的。Java 有数量惊人的开源库可用于做大量的事情。将其与 C++ 进行比较，以及使用 MFC 或 Win32 API 从头开始​​实现所有内容的时间有多早。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-10T14:41:46.273

我们重用代码。

在小范围内，我们尽量避免代码重复。我们有一个完整的库，里面有很多常用的代码。

通常代码是为一个应用程序开发的。如果它足够通用，它就会被提升到库中。这效果很好。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-10T14:46:04.080

代码重用的想法不再是一个新颖的想法......因此显然缺乏兴趣。但这仍然是一个好主意。整个 .NET 框架和 Java API 都是代码重用的好例子。

我们已经习惯于为我们的项目开发 OO 代码库并在其他项目中重用它们。它是一个想法的自然生命周期的一部分。争论了一会，大家都接受了，没有再讨论的理由了。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-12-10T14:46:16.140

当然我们重用代码。

有几乎无限数量的可用于所有语言的包、库和共享对象，整个开发人员社区都在支持和更新它们。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-12-10T14:57:13.090

我觉得没有“媒体关注”是因为大家都在做，不值得再写了。我没有听到很多人像以前那样提高对面向对象编程和单元测试的认识。每个人都已经知道这些概念（无论他们是否使用它们）。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-12-11T13:10:53.147

媒体对一个问题的关注程度与其重要性无关，无论我们是在谈论软件开发还是政治！避免因重新发明（或重新维护！）轮子而浪费开发工作很重要，但现在这已广为人知，编辑可能不会对有关该主题的另一篇文章感到兴奋。

与其将当前文章和博客文章的数量作为衡量重要性（或紧迫性）的标准，不如关注已成为经典或进入行话的概念和流行语（另一种重用形式！）例如，Google for uses DRY 的首字母缩写词，用于很好地讨论可以在软件和开发过程中消除的多种形式的冗余。

对重用成本与在何处实现收益进行成熟判断也有一定的作用。一些作者主张等到真正出现第二次或第三次使用时再担心重用，而不是在第一次编写代码时花精力概括代码。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-07-30T11:36:09.147

我个人的看法，基于我公司的实践：

> *   您或您的公司是否尝试重用代码？

显然，如果我们有另一段代码已经满足我们的需求，我们将重用它。不过，我们不会特意在圆孔中使用方钉。

> *   如果是这样，如何以及在什么级别，即低级 api、组件或共享业务逻辑？您或您的公司如何重用代码？

在每个级别。它被写入我们的编码标准，开发人员应该始终假设他们的代码将被重用——即使实际上这极不可能。*见下文*

如果您的 OO 模型很好，您的 API 可能反映了您的业务领域，因此可重用类可能等同于可重用业务逻辑而无需额外的努力。

对于实际重用，一个关键点是知道哪些代码已经可用。我们通过将所有内容记录在一个中心位置来解决这个问题。我们只需要一点纪律来确保文档是最新的并且可以以有意义的方式进行搜索。

> *   它有效吗？

是的，但不是因为潜在的或实际的重用！实际上，除了几个核心库和 UI 组件之外，并没有大量的重用。

在我个人看来，**真正的价值在于使代码可重用**。在这样做的过程中，除了一个希望更清洁的 API 之外，代码将 (a) 有足够的文档记录以供其他开发人员使用它*而无需搜索源代码*，并且 (b) 它也将是*可替换*的。这些点对持续的软件维护有很大的好处。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2018-02-05T06:00:25.907

> 您或您的公司是否尝试重用代码？如果是这样，如何以及在什么级别，即低级 api、组件或共享业务逻辑？您或您的公司如何重用代码？

我曾经在一个代码库中工作，使用 uber 代码重用，但由于重用代码不稳定，因此很难维护。它很容易以级联到所有使用它的方式进行设计更改和弃用。在此之前，我在一个没有代码重用的代码库中工作，其中老年人实际上鼓励复制和粘贴作为重用甚至应用程序特定代码的一种方式，所以我看到了两个极端，我不得不说一个不一定很多在极端情况下比另一个更好。

我曾经是一个超级自下而上的程序员。你让我构建一些特定的东西，我最终构建了通用工具。然后使用这些工具，我构建了更复杂的通用工具，然后开始构建 DIP 抽象来表达低级工具的设计要求，然后我构建更复杂的工具并重复，在某个时候我开始编写真正的代码你要我做什么。尽管这听起来适得其反，但我的速度非常快，并且可以以令人惊讶的方式运送复杂的产品。

问题是几个月、几年的维护！在我构建了这些通用库的一层又一层并重用它们之后，每个人都希望服务于比您要求我做的更大的目的。每一层都想解决世界的饥饿需求。所以每个人都非常雄心勃勃：一个想要令人惊叹并解决世界饥饿需求的数学图书馆。然后建立在数学库之上的东西，比如想要令人惊叹并解决世界饥饿需求的几何库。当您尝试发布产品时，您知道出了点问题，但是当您应该处理动画时，您的大脑正在考虑您的超级通用几何库在渲染和建模方面的效果如何，因为您正在处理的动画代码on 需要一些新的几何函数。

**平衡每个人的需求**

我发现在设计这些超级通用的库时，我必须着迷于每个团队成员的需求，我必须学习光线追踪是如何工作的，流体动力学是如何工作的，网格引擎是如何工作的，反向运动学是如何工作的，如何角色动画工作，等等等等等等。我必须学习如何完成团队中几乎每个人的工作，因为我在设计这些超级通用库时平衡了他们的所有特定需求，我在走钢丝平衡行为时留下了所有代码重用的设计妥协（试图让正在使用其中一个库的 Bob 进行光线跟踪但又不会伤害到 John 正在研究物理的同时也在使用它但不会使库的设计复杂化的情况太多了，无法让他们俩都开心）。

到了这样一个地步，我试图用策略类对边界框进行参数化，以便它们可以存储为一个人想要的中心和一半大小，或者其他人想要的最小/最大范围，并且实现变得非常复杂快速尝试疯狂地跟上每个人的需求。

**委员会设计**

而且由于每一层都试图满足如此广泛的需求（比我们实际需要的要广泛得多），他们找到了许多需要更改设计的理由，有时是委员会要求的设计（通常有点粗俗）。然后这些设计更改会向上级联并影响所有使用它的更高级别的代码，并且这些代码的维护开始成为真正的 PITA。

我认为您可以在志同道合的团队中共享更多代码。我们的想法完全不同。这些不是真名，但我这里有比尔，他是一个高级 GUI 程序员和脚本编写者，他创建了很好的用户端设计，但有很多 hack 的有问题的代码，但对于那种类型的代码来说往往没问题。我在这里找到了 Bob，他是一位自打孔卡时代以来一直在编程的老手，他喜欢编写带有 goto 的 10,000 行函数，但仍然不明白面向对象编程的重点。我在这里找到了乔，他就像一个数学向导，但编写的代码没有其他人可以理解，并且总是提出数学上一致的建议，但从计算的角度来看不一定如此有效。

试图在想出一个体面的设计的同时满足这里每个人的需求，回想起来可能是不可能的。在每个人都试图分享彼此的代码时，我认为我们变得适得其反。每个人都在某个领域胜任，但试图提出每个人都满意的设计和标准只会导致各种不稳定并减慢每个人的速度。

**权衡取舍**

所以这些天我发现平衡是避免代码重用最底层的东西。我可能会使用中层自上而下的方法（与您要求我做的事情*相差*不远），并在那里建立一些独立的图书馆，我仍然可以在很短的时间内完成，但是图书馆不打算生产试图解决世界饥饿需求的迷你库。通常，此类库的用途比较低级别的库要窄一些（例如：物理库，而不是广义几何交叉库）。

YMMV，但是如果这些年来我以最艰难的方式学到了什么，那就是可能存在一种平衡行为，并且我们可能希望在某个细粒度级别故意避免在团队设置中重用代码，放弃一些支持解耦的最低级别代码的通用性，拥有可延展的代码，我们可以更好地塑造以服务于更具体而不是笼统的需求，等等——甚至可能只是让每个人都有更多的自由以自己的方式做事。但是当然所有这一切都是为了仍然产生一个非常可重用的通用库，但不同的是，库可能不会分解成最小的通用库，因为我发现跨越某个阈值并试图制造太多蝇头，

> 如果您有一段可能在中型组织中共享的代码，您将如何通知公司的其他成员该 lib/api/etc 存在并且可能有用？

这些天我实际上更不情愿，如果同事做一些多余的工作，我会觉得更可原谅，因为我想确保代码做一些相当有用和不平凡的事情，并且在我尝试分享之前也经过很好的测试和设计和人在一起，积累了一堆对它的依赖。如果我与团队的其他成员分享，那么从那时起，设计应该有非常非常少的理由要求进行任何更改。

否则，它可能会导致比实际节省更多的悲伤。

我曾经非常不能容忍冗余（在代码或工作中），因为它似乎转化为一个在内存使用方面非常有问题和爆炸性的产品。但是我把冗余作为关键问题过分强调了，而真正的问题是质量差、仓促编写的代码以及缺乏可靠的测试。即使有些人在这里和那里复制一些数学函数，经过良好测试、可靠、高效的代码也不会在很大程度上受到这个问题的影响。

要注意并记住我当时没有注意的常识之一是，当我们使用非常可靠的第三方库时，我们如何不介意一些冗余。你们可能会使用一两个第三方库，这些库与您的团队正在做的事情有一些多余的工作。但是我们不介意在这些情况下，因为第三方库很棒并且经过了很好的测试。我建议将相同的思维方式应用于您自己的内部代码。目标应该是创建一些很棒且经过良好测试的东西，而不是像我很久以前错误地做的那样在这里和那里大惊小怪。

因此，这些天来，我已经将我的不容忍转变为缺乏测试。与其对多余的工作感到不安，我发现对其他人缺乏单元和集成测试感到不安更有效率！:-D

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-12-10T15:21:36.037

虽然我认为代码重用很有价值，但我可以看到这种情绪的根源。我参与过很多项目，在这些项目中，我特别注意创建可重用的代码，而这些代码从未被重用过。当然重用比复制代码更可取，但是我已经看到了许多非常广泛的对象模型，其目标是在多个项目中跨企业使用对象（就像 SOA 中的相同服务可以在不同的项目中使用的方式一样）应用程序），但从未见过实际使用过多次的对象。也许我只是没有加入充分利用重用原则的组织。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-12-10T15:22:24.320

也许更好的问题是这些天我们什么时候不重用代码？我们要么处于使用其他人观察到的“最佳实践”或预先发现的“设计模式”构建的状态，要么实际上只是在遗留代码、库或复制上构建。

似乎代码 A 被重用于代码 B 的程度通常取决于代码 A 中用于代码 B 的想法被抽象为设计模式/习语/书籍/短暂的想法/实际代码/库的程度。困难的部分是将所有这些好的想法应用到您的实际代码中。

非技术人员对重用的事情过于热心。他们不明白为什么所有东西都不能复制粘贴。他们不明白为什么 greemelfarm 需要一个特殊的适配器来将与旧系统相同的信息传递给新系统，不幸的是，由于无数其他原因，我们也无法更改。

我认为技术人员从第一天开始就一直在重复使用，就像音乐家从第一天开始重复使用一样。这是一个持续的有机进化和综合，将继续进行。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-12-10T15:26:13.593

我从事的两个软件项目都是长期开发的。一个大约有 10 年的历史，另一个已经存在了 30 多年，一路上用几个版本的 Fortran 重写。两者都广泛重用代码，但都很少依赖外部工具或代码库。DRY 是新项目的一个重要口头禅，它使用 C++，在实践中更容易做到这一点。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2009-02-07T14:11:34.570

代码重用是一个极其重要的问题——如果代码没有被重用，项目需要更长的时间，并且新团队成员更难进入。
但是，编写可重用代码需要更长的时间。

就个人而言，我尝试以可重用的方式编写所有代码，这需要更长的时间，但这导致我的大部分代码已成为我组织中的官方基础架构，并且基于这些基础架构的新项目所需的时间明显减少。

重用代码的危险在于，如果重用代码不是作为基础设施编写的——以一种通用和封装的方式，尽可能少的假设和尽可能多的文档和单元测试，那么代码最终可能会做意想不到的事情。
此外，如果发现并修复了错误或添加了功能，这些更改很少会返回到源代码中，从而导致重用代码的不同版本，没人知道或理解。

解决方案是：
1\. 设计和编写代码时不仅要考虑一个项目，还要考虑未来的需求，并尝试使设计足够灵活，以最少的代码更改覆盖它们。
2\. 将代码包含在要按原样使用且未在使用项目中修改的库中。
3\. 允许用户查看和修改库的代码***及其***解决方案（不在使用项目的解决方案内）。
4\. 在现有基础设施的基础上设计未来的项目，必要时对基础设施进行更改。
5\. 负责对所有项目的基础设施进行维护，从而保持基础设施的资金来源。

* * *

## 回答 #16

> 赞同：-1
> 
> 时间：2008-12-25T08:36:47.250

Maven 解决了代码重用问题。我是认真的。

# c++ - 部分类模板专业化是这个设计问题的答案吗？

> ID：356294
> 
> 赞同：8
> 
> 时间：2008-12-10T14:42:38.563
> 
> 标签：c++, oop, templates, specialization

假设您有一个班级，其工作是连接到远程服务器。我想抽象这个类来提供两个版本，一个通过UDP连接，另一个通过TCP连接。我想构建尽可能精简的运行时代码，而不是使用多态性，我正在考虑模板。这是我的设想，但我不确定这是最好的方法：

```
class udp {};
class tcp {};

template<class T,typename X>
class service
{
private:
  // Make this private so this non specialized version can't be used
   service();
};

template<typename X>
class service<udp, X>
{
private:
   udp _udp;
   X _x;
};

template<typename X>
class service<tcp, X>
{
private:
   tcp _tcp;
   X _x;
}; 
```

所以最终的好处是 T 的通用性仍然可用，但是设置 UDP 或 TCP 连接所需的非常不同的代码已经被专门化了。我想你可以把它放在一个类中，或者提供另一个类，它遵循一些纯虚拟接口来设置网络连接，比如 IConnectionManager。

但这确实留下了泛型 T 的代码现在必须在两个专用版本中编写和维护的问题，它们最终是相同的。如何最好地解决这个问题？我有一种感觉，我对这一切都错了。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-12-10T15:58:36.663

这最好使用传输协议的策略来完成：

```
template<typename Transport>
class service : Transport {
public:
    typedef Transport transport_type;

    // common code
    void do_something() { 
        this->send(....);
    }
};

class tcp {
public:
    void send(....) {

    }
};

class udp {
public:
    void send(....) {

    }
};

typedef service<tcp> service_tcp;
typedef service<udp> service_udp; 
```

请注意，这也是多态的。它被称为编译时多态性。将策略放入基类将受益于 Empty-Base-Class-Optimization。也就是说，您的基类不需要占用任何空间。将策略设置为成员还有另一个缺点，即您总是必须将事情委派给该成员，这可能会随着时间的推移而变得烦人。[Modern C++ Design](https://rads.stackoverflow.com/amzn/click/com/0201704315)一书深入描述了这种模式。

理想情况下，传输协议不需要知道任何关于它上面的协议的信息。但是如果由于某种原因你必须得到一些关于它的信息，你可以使用 crtp 模式^([wiki](https://en.wikipedia.org/wiki/Curiously_recurring_template_pattern))：

```
template<template<typename Service> class Transport>
class service : Transport<service> {

    // since we derive privately, make the transport layer a friend of us, 
    // so that it can cast its this pointer down to us. 
    friend class Transport<service>;

public:
    typedef Transport<service> transport_type;

    // common code
    void do_something() { 
        this->send(....);
    }
};

template<typename Service>
class tcp {
public:
    void send(....) {

    }
};

template<typename Service>
class udp {
public:
    void send(....) {

    }
};

typedef service<tcp> service_tcp;
typedef service<udp> service_udp; 
```

您不必将模板放入标题中。如果您显式实例化它们，您将获得更快的编译时间，因为需要包含的代码更少。将其放入 service.cpp：

```
template class service<tcp>;
template class service<udp>; 
```

现在，使用服务的代码不需要知道服务的模板代码，因为该代码已经生成到 service.cpp 的目标文件中。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-10T14:48:23.217

我会使用奇怪的重复模板模式，也就是五点手掌爆炸 Alexandrescu 技术：

```
template <typename Underlying>
class Transmit
{
public:
   void send(...)
   {
      _U.send(...)
   };

private:
    Underlying _U;
};

class Tcp
{
public:
   void send(...) {};
};

class Udp
{
public:
   void send(...) {};
}; 
```

可能会有更多的模板参数和子类，但你明白了，你也可以使用静态方法。

*顺便说一句，模板代码通常更有效，但也更大。*

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-10T17:42:24.817

模板不是必需的（尽管可能的解决方案）。这只是通过模板而不是通过构造函数的依赖注入。我个人会通过构造函数来做到这一点。但是通过模板执行它会给您带来更便宜的方法调用的**可疑好处**（它不需要是虚拟的）。但也允许更容易的编译器优化。

udp 和 tcp 对象都**必须仍然支持相同的接口**。
如果您通过继承来实现，它们都必须实现一个通用接口（虚拟基类），它是通过模板完成的，这不是必需的，但编译器将检查它们是否支持服务对象所需的相同方法调用。

正如原始问题中所问的那样，我认为部分模板专业化没有明确的需要（或好处）（在所描述的情况下）。

### 模板法

```
class udp {/*Interface Plop*/static void plop(Message&);};
class tcp {/*Interface Plop*/static void plop(Message&);};
template<typename T>
class Service
{
    public:
        void doPlop(Message& m) { T::plop(m);}
    // Do not actually need to store an object if you make the methods static.
    // Alternatively:
    public:
        void doPlop(Message& m) { protocol.plop(m);}
    private:
        T protocol;
}; 
```

### 多态版本

```
class Plop{virtual void plop(Message&) = 0;} // Destruct or omitted for brevity
class upd:public Plop {/*Interface Plop*/void plop(Message&);};
class tcp:public Plop {/*Interface Plop*/void plop(Message&);};
class Service
{
    public:
        Service(Plop& p):protocol(p)  {};
        void doPlop(Message& m) { protocol.plop(m);}
    private:
        Plop& protocol;
}; 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-10T15:07:42.257

我认为，至少在这种特殊情况下，在多态性或模板专业化中进行选择的要点是，如果您想选择在运行时或编译时使用哪种行为。
例如，如果您想基于提供给用户的连接字符串来建立 udp 或 tcp 连接，那么多态最适合您的需求；创建一个具体类，然后将其传递给处理指向基接口的指针的通用代码。
否则，您可能会考虑使用模板 - 我不确定您是否需要模板专业化。

希望这可以帮助 ：）

# java - 黑莓线程模型

> ID：356297
> 
> 赞同：10
> 
> 时间：2008-12-10T14:42:42.730
> 
> 标签：java, multithreading, blackberry, java-me

我读过很多评论，顺便提到 BlackBerry 线程模型偏离 Java 标准并可能导致问题，但没有多少谷歌搜索让我明白这究竟意味着什么。

我一直在为 BlackBerry 开发一个相当大的业务应用程序，虽然我以前没有任何 Java 多线程应用程序的经验，但没有遇到任何我们可以归咎于线程的问题，除了我们自己造成的。

有人可以准确描述 BlackBerry 线程模型的不同之处，以及我作为开发人员应该如何考虑这一点？显然，有关该主题的任何链接也会很棒。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-04-30T16:11:49.503

1.UI 用户界面操作**总是**需要在UI线程中运行。要执行`LabelField.setText("foo");`您需要执行的此类功能：

```
UiApplication.getUiApplication().invokeLater(new Runnable(){
  public void run(){
    myLabelField.setText("foo");
    myLabelField.setDirty(true);
  }
}); 
```

很容易吧？

2.Network 网络操作不应该**在**UI 线程中运行。要做这样的事情：

```
new Thread(){
  public void run(){
    HttpConnection hc = 
            (HttpConnection)Connector.open("http://www.stackoverflow.com");
  }
}.start(); 
```

这两个主要原则非常重要。您应该始终注意您在哪个线程中操作。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-23T02:46:09.727

我在黑莓论坛发现的两个怪癖：

1.  向量不是线程安全的。
2.  如果您正在创建本机黑莓 CLDC 应用程序，则静态不一定是 VM 上的单例。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-04-02T16:47:21.880

区别不在于线程模型，而在于您使用它们的方式，正如最初的帖子所说，您不能使用 ui 线程进行网络连接，也不能使用网络连接来更新 ui。

你所说的桌面java和黑莓java在这件事上有很多不同......相信我！

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-12T20:15:35.713

我能想到的唯一问题在[另一个 stackoverflow question](https://stackoverflow.com/questions/292587/interacting-with-ui-threads-in-javaj2me)的答案中讨论。

# gwt - GWT - GXT - 如何获取单选按钮值？

> ID：356298
> 
> 赞同：3
> 
> 时间：2008-12-10T14:43:32.307
> 
> 标签：gwt, extjs, radio-button, gwt-rpc, gxt

我正在使用 GWT (Google Web Toolkit) 1.5.3 et GXT (ExtJS) 1.2 我只想创建一个简单的表单，其中包含在 RPC 调用后生成的一些单选按钮，以获取一些值

代码：

```
final FormPanel simple = new FormPanel();
        simple.setFrame(true);
        simple.setWidth(350);
        simple.setHeaderVisible(false);

        DateField date = new DateField();
        date.setFieldLabel("Date");
        simple.add(date);

        ListFluxServiceAsync service = (ListFluxServiceAsync)
        GWT.create(ListFluxService.class);
        ServiceDefTarget target = (ServiceDefTarget)service;
        String url = GWT.getModuleBaseURL() + "flux.rpc";
        target.setServiceEntryPoint(url);

        final RadioGroup radioGroup = new RadioGroup("RadioGroup");
        radioGroup.setFieldLabel("Flux");
        radioGroup.setOrientation(Orientation.VERTICAL);

        service.getAllFlux(new AsyncCallback<List<FluxModelData>>(){

            public void onFailure(Throwable caught) {
                GWT.log("flux.rpx::onFailure",  caught);
                MessageBox.alert("what?", "onFailure :" + caught.getMessage(), null);
            }

            public void onSuccess(List<FluxModelData> result) {

                Iterator<FluxModelData> it = result.iterator();
                while ( it.hasNext() ){
                    FluxModelData fmd = it.next();
                    Radio radio = new Radio();
                    radio.setName("flux");
                    radio.setValue(true);
                    //radio.setRawValue("my very long value");
                    radio.setBoxLabel(fmd.getDescription());
                    radioGroup.add(radio);
                }

                simple.add(radioGroup);
                simple.layout(); //we need it to show the radio button

            }
        });

        simple.setButtonAlign(HorizontalAlignment.CENTER);

        Button button = new Button("Récupérer");
        button.addSelectionListener(new SelectionListener<ButtonEvent>(){

            @Override
            public void componentSelected(ButtonEvent ce) {

                MessageBox.alert("what?", radioGroup.getValue().getRawValue() , null);

            }});

        simple.addButton(button);

        RootPanel.get().add(simple); 
```

我的问题是我无法设置/获取单选按钮值。如果我尝试 setRawValue("xxxxxxx")，我会得到一些 null 错误，而设置 setValue(boolean) 是有效的，但我期望得到无线电值而不是标签值。

任何想法？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2011-05-05T15:21:05.633

创建收音机

```
Radio radio = new Radio();  
radio.setBoxLabel("Si");  
radio.setValue(true);
radio.setValueAttribute("true");

Radio radio2 = new Radio();  
radio2.setBoxLabel("No");
radio2.setValueAttribute("false");

RadioGroup radioGroup = new RadioGroup();  
radioGroup.setFieldLabel("Afecto");  
radioGroup.add(radio);  
radioGroup.add(radio2); 
```

获取选定的值

```
Boolean b = Boolean.parseBoolean(radioGroup.getValue().getValueAttribute()); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-05-13T04:26:24.783

您需要扩展 GWT RadioButton 类，例如：

```
public class ExtRadioButton extends RadioButton {
    public ExtRadioButton(String name, String label) {
        super(name, label);
        // TODO Auto-generated constructor stub
    }

    public void setValue(String value)
    {
        Element span = getElement();
        Element input = DOM.getChild(span,0);
        DOM.setElementAttribute(input,"value",value);
     }

} 
```

默认它只允许布尔值。初始化单选按钮后，您需要设置值。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-10T17:22:50.987

Using radioButton.setItemId() and getItemId() resolve it.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-06-08T08:55:33.713

看看这个

```
 Radio radio1 = new Radio();
.............
 Radio radio2 = new Radio();
.............

in order to get value you can do as follow

String value = (radio1.getValue()) ? radio1.getText() : radio2.getText(); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-11-06T14:25:33.267

我使用`radio.setAttributeValue()`方法来设置单选按钮的值。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-05-18T12:32:36.283

另一种方法是使用该`radio.setValueAttribute(String)`方法。然后您可以在 RadioGroup 上使用以下代码来获取单击的单选按钮的 set 'value' 属性：

```
radioGroup.addListener(Events.Change, new Listener<BaseEvent>() {
  @Override
  public void handleEvent(BaseEvent be) 
  {
    final RadioGroup radioGroup = (RadioGroup)be.getSource();

    final Radio clickedRadioBtn = radioGroup.getValue();

    final String valueAttribute = clickedRadioBtn.getValueAttribute(); // Correct !!!

  }
}); 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2012-07-16T10:58:39.660

```
 Radio includeButton = new Radio();
        Radio excludeButton = new Radio();
        RadioGroup radioGroup = new RadioGroup();

            radioGroup.add(includeButton);
    radioGroup.add(excludeButton);

           includeButton.setvalue(true)//false 
```

# windows - Windows下的脚本文件下载

> ID：356321
> 
> 赞同：0
> 
> 时间：2008-12-10T14:48:47.507
> 
> 标签：windows, internet-explorer, batch-file, proxy

我将被迫编写一个脚本来在 Windows XP 下下载一些文件。将运行脚本的机器都在代理之后，并且代理设置输入到 IE 配置中。

我想到的是从命令行以某种方式调用 IE，并使用我需要的配置下载文件。甚至可以使用一些shell技术吗？

其他选项是`wget`在 Win 下使用，但我需要将代理设置传递给它。如何从 IE 配置中恢复这些设置？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-10T14:59:09.607

原则上，我会采用这种`wget`方法，而不是以`IE`某种方式使用。

配置脚本的路径存储在注册表中`HKCU\Software\Microsoft\Windows\CurrentVersion\Internet Settings\Connections\DefaultConnectionSettings`。它是一个二进制值，脚本地址从位置 0x18 开始，看起来是 ASCII 编码的。

我不知道是否`wget`可以自行评估脚本，或者您是否需要在脚本中显式解析它，然后将代理地址传递给`wget`.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-10T15:07:13.537

我同意 Treb，您应该更喜欢使用 wget，代理设置的路径可以在“HKCU\Software\Microsoft\Windows\CurrentVersion\Internet Settings\ProxyServer”中找到

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-10T15:10:53.157

使用 JScript：

```
function ie_NavigateComplete2(pDisp, url)
{
    // output for testing
    WScript.Echo('navigation to', url, 'complete');
    // clear timer
    t = 0;
}

// create ActiveX object
var ie = WScript.CreateObject('InternetExplorer.Application', 'ie_');
ie.Height = 200;
ie.Width = 200;
ie.Visible = true;
ie.Navigate('http://www.example.com/worddoc.doc');
var t = (+new Date()) + 30000;
// sleep 1/2 second for 30 seconds, or until NavigateComplete2 fires
while ((+new Date()) < t)
{
    WScript.Sleep(500);
}
// close the Internet Explorer window
ie.Quit(); 
```

然后你用`start download.js`or调用它`cscript download.js`。你可以用 VBScript 做类似的事情，但我更喜欢 JScript。

请注意，这仅在目标`ie.Navigate()`是提示打开/保存/取消的文件时才有效。如果是在浏览器中打开的文件类型（例如 PDF），那么 IE 将简单地打开资源，然后关闭窗口，这可能不是您想要的。显然你可以根据自己的需要调整脚本，比如下载完成后不关闭 IE 窗口，或者将窗口放大等。

有关可用事件、方法和属性的更多信息，请参阅[InternetExplorer 对象文档。](http://msdn.microsoft.com/en-us/library/aa752084.aspx)

使用这种方法，您不必担心读取 Internet Explorer 的代理设置，因为您正在使用 Internet Explorer 进行下载，所以它们将被使用。

# git - 由于权限，无法将所有文件添加到 git

> ID：356323
> 
> 赞同：44
> 
> 时间：2008-12-10T14:49:07.460
> 
> 标签：git

我想将当前目录中的所有文件添加到git：

```
git add .
error: open(".mysql_history"): Permission denied
fatal: unable to index file .mysql_history 
```

没关系。该文件恰好位于此目录中并由 root 拥有。我想添加所有*其他*文件。有没有办法做到这一点而不必手动添加每个文件？

我知道我可以将文件添加到排除或 .gitignore，但我想让它忽略基于权限的内容（很有可能其他类似的文件最终会出现在目录中，并将它们添加到 .gitignore一直都是痛苦的）。

* * *

## 回答 #1

> 赞同：70
> 
> 时间：2008-12-11T15:23:06.533

采用`git add --ignore-errors .`

对于不可读的文件，这仍然会出错，但不是致命的。将添加其他文件。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2019-04-05T09:16:42.943

关闭您的 IDE 或任何使用您要上传的相关文件的东西解决了我的问题

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-12-10T14:52:33.210

如果您将该文件添加到您的 .gitignore 文件中会有所帮助吗？因此，所有其他文件都将被版本化，并且该文件将被忽略（除非您需要它）。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2018-08-21T13:28:23.727

正如[@Dhanuka777 在评论中指出的那样](https://stackoverflow.com/questions/356323/cant-add-all-files-to-git-due-to-permissions/70923886#comment62060185_359696)，如果您使用的是 Visual Studio 或 Unity，则必须先关闭所有 Visual Studio 和 Unity 实例，然后再执行`git add .`

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-12-10T14:52:47.747

只需排除该文件。您可以添加`.mysql_history`到`.gitignore`文件，或将其添加到`.git/info/exclude`.

添加一个条目`.gitignore`将使用 repo 传播设置（因为`.gitignore`与 repo 一起存储）；添加它`.git/info/exclude`使其成为“个人”，因为该文件*不*与 repo 一起传播。无论哪种方式，`.mysql_history`都会被`git-add`和朋友忽略。

[您可以在此手册页](http://git-scm.com/docs/gitignore)上阅读有关使用 Git 忽略文件的更多信息。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2012-05-29T15:33:13.587

```
sudo chown $(whoami): .git/objects/ -R; git add --ignore-errors . 
```

为我修好了。前半部分固定所有权，（有人以 root 身份签入，顽皮），后半部分使错误成为非致命的。后半部分本身帮助我找到了 root 拥有的目录。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2017-11-13T19:33:38.733

我正在使用[@matli 的解决方案](https://stackoverflow.com/a/359696/2745495)，但有时仍然会遇到麻烦。

我最终使用

```
git add --ignore-errors --force . 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2019-10-20T07:03:05.827

关闭了所有为我工作的视觉工作室实例

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2020-01-06T04:32:14.297

请指定您要添加的文件名；例子：

```
git add index.html 
```

我希望这对你也有帮助

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2020-04-30T10:44:46.423

检查是否有一些与后台运行的文件相关的任务/进程。

我意识到试图清空我的 Temp 文件夹。当文件无法删除时，Windows 会通知您与哪个进程相关。杀死那个过程解决了我的问题。

这就是为什么完成 IDE 或重新启动系统通常可以工作的原因。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2021-05-14T15:28:23.090

```
chmod 755 file.xxx 
```

为我工作。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2021-09-08T06:43:52.333

在我的情况下，我试图将 excel 文件添加到 git，但是那些打开的 excel 文件，因此“git add”试图添加 $filename.xlsx（在我们工作时与原始文件一起创建的文件在该文件的打开实例上）。关闭 excel 文件对我有用

* * *

## 回答 #13

> 赞同：-2
> 
> 时间：2019-08-13T03:38:07.907

重新启动系统（Windows）解决了我的问题。

* * *

## 回答 #14

> 赞同：-2
> 
> 时间：2021-09-04T19:28:07.830

这个白痴（我）试图将文件添加到 onedrive 上的 git （我知道的 git repo 的可怕地方），没有运行 onedrive...

# openmp - OpenCL：它是否与 OpenMP 配合得很好，我可以将其他语言连接到它，等等

> ID：356328
> 
> 赞同：10
> 
> 时间：2008-12-10T14:50:55.880
> 
> 标签：openmp, opencl

OpenCL 的 1.0 规范几天前刚刚发布（规范在[这里](http://www.khronos.org/registry/cl/)），我刚刚开始通读它。我想知道它是否与其他高性能多处理 API（如 OpenMP（[规范](http://openmp.org/wp/)））配合得很好，我想知道我应该学习什么。所以，这是我的基本问题：

1.  如果我已经在使用 OpenMP，是否会破坏 OpenCL，反之亦然？
2.  OpenCL 比 OpenMP 更强大吗？或者它们是为了互补？
3.  是否有将 OpenCL 程序连接到标准 C99 程序（或任何其他语言）的标准方法？它是什么？
4.  有谁知道是否有人在写一本 OpenCL 书？我正在阅读规范，但我发现书籍更有帮助。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-07T05:40:30.767

OpenMP 和 OpenCL 是不同的，但可以一起工作。他们都不应该“破坏”另一个。

为了争论，我们假设在最小化现有代码库的更改与性能或计算能力之间进行权衡。OMP 是“简单”的，因为您可以通过一两个快速编译指示“神奇地”将其应用于令人尴尬的并行问题。

OpenCL 引入了超越典型操作系统线程模型的全新高级概念。Khronos 可能不想大声说出来，但它的起源是在 NVIDIA 的 CUDA 中。如果您想看看它是如何工作的，请下载 CUDA SDK 并开始玩。如果您没有任何 NVIDIA GPU，请不要担心，有一个 GPU 仿真器软件选项。OpenCL 是一种方便的 GPU 抽象，应该适用于 CPU、DSP、“加速器”（Khronos 对 IBM 的 CellBE 和可能是英特尔的 Larrabee 的昵称）。

OpenCL 不应该是“直接用 C99 编写的”。它被称为 C99 扩展，因为它的语法与 C99 相似/相同，但有一些新的关键字。您不能从内核调用 libc（或任何其他库）。

您可以同时使用两者，但从理论上讲，如果您愿意移植代码，OpenCL 应该“更好”（因为它可以移植到更多的计算设备上）。您不能在 OpenCL 内核中使用 OpenMP 编译指示。

也可以看看：

*   [http://wikipedia.org/wiki/OpenCL](http://wikipedia.org/wiki/OpenCL "开放式")
*   [CUDA](http://www.nvidia.com/object/cuda_home.html "CUDA")
*   [LLVM](http://llvm.org/ "LLVM")

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-23T14:30:44.243

大多数情况下，OpenMP 和 OpenCL 是相互独立的。它们都是让开发人员在其平台上访问并行性的两种方式。

OpenMP 旨在与多个（相同的）处理器一起工作，其中大致相等的工作可以（几乎）在它们之间自动分流。

OpenCL 是一个有点不同的野兽，因为它在使用特殊的协处理器硬件时非常出色。它将允许您将一些繁重的数字运算卸载到 GPU 或其他一些协处理器，例如 Cell 中的协处理器。然而，它的构建也是基于它可以用于利用其他主处理器的想法，这在多核计算机中很常见。我认为这个特性是次要的，如果这就是你打算使用 OpenCL 的全部，我不建议使用 OpenCL。

话虽如此，我想这会有些挑战，但让 OpenMP 和 OpenCL 在同一个问题上协同工作绝对不是不可能的。

首先要考虑的是您为 OpenCL 所做的工作。这肯定是您只希望 OpenCL 在 GPU/协处理器上运行......而不是在其他主处理器/内核上运行的情况，因为 OpenMP 已经在使用它们。在同一主处理器上运行 OpenCL 和 OpenMP 不会（不应该）导致应用程序错误，但会导致不希望的调度，其中 OpenMP 和 OpenCL 运行速度较慢，因为它们花费大量时间切换回来和第四个彼此之间。如果您同时在同一核心上运行任何其他需要大量处理器的进程，也会发生这种情况。

要考虑的另一件大事是您将如何安排在协处理器上运行的任务。确实，您可以将大量工作投入到现代 GPU 中，但在管道和内存使用方面需要考虑很多事情。您不希望发生的是有 8 个不同的 OpenMP 线程，每个线程都试图同时将自己的工作发送到协处理器。我建议只使用一个线程来管理与协处理器的所有交互，因此它可以确保以有效的方式为其提供工作。

也就是说，我确信有些程序会同时发生多种类型的任务，其中一种类型的任务总是可以外包给协处理器，而另一种类型的任务可以由多核处理主处理器。这将是混合 OpenMP 和 OpenCL 的一个很好的例子。

祝你好运！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-19T08:51:56.553

1.  ?
2.  ?
3.  OpenCL is supposed to be written directly in C99 afaik? There are header files available now for it anyhow.
4.  ?

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-04-12T23:23:56.267

By the way, [there is a work](http://www.multicoreinfo.com/research/papers/2009/ppopp09-9-omp2gpu-lee.pdf) about openMp to gpgpu using CUDA.

# c# - 从 csproj 文件构建依赖树

> ID：356330
> 
> 赞同：3
> 
> 时间：2008-12-10T14:51:54.770
> 
> 标签：c#, optimization, msbuild

我目前正在使用 msbuild 解决 600 多个项目。

想象一下，我更改了 10 个项目使用的 1 个库的代码。而不是将所有 600 个项目提供给 msbuild 并让它编译所有项目并找出依赖关系。我想知道是否有我可以使用的程序或库来分析所有 600 个项目的依赖关系，并允许我只编译必要的 11 个。

换句话说，给定要扫描的所有 600 个项目的输入，并将 BaseLibrary.csproj 作为已修改参数的项目，只提供我需要编译的 11 个项目作为输出。

我在编写自定义任务方面经验丰富，如果已经有一个第三方库，我宁愿使用第三方库来进行依赖分析。

我的公司每 3-4 个月对生产进行增量发布。作为一个实验，我编写了一个自定义任务，查看以前版本的“Subversion 标记”并评估所有已编译的文件，这些文件自那时以来发生了变化，并将它们映射到一个项目。

我能想到的唯一一个不起作用的用例是我提到的一个基础库被更改并且系统不知道所有依赖它的项目的情况。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-10T15:41:42.813

您是否尝试过[.NET 程序集依赖分析器](http://www.drewnoakes.com/code/dependancyanalyser/)？

它是开源的，[点脚本](http://www.graphviz.org/doc/info/lang.html)中的图形输出可能是您所需要的。网站上的一个例子：

```
digraph G { 
      size="100,69"
      center=""
      ratio=All
      node[width=.25,hight=.375,fontsize=12,color=lightblue2,style=filled]
      1 -> 9;
      1 -> 11;
      9 -> 10;
      11 -> 10;
      1 [label="Drew.Controls.Map"];
      9 [label="Drew.Types"];
      10 [label="nunit.framework"];
      11 [label="Drew.Util"];
 } 
```

使用项目列表和此脚本输出，您可以创建编译列表。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-10T15:57:33.407

我有一些代码可以做到这一点；我在我们的定制构建过程中使用它来 a：找出构建顺序（无需维护它），以及 b：通过随机项目树向上级联更改。不幸的是，我现在不在我平常的办公室里，而且代码太复杂而无法“即兴发挥”（它做了很多图形映射和依赖跟踪）。

我应该补充一点，它目前通过在每个项目的根目录中都有一个自定义标记（xml 文件）来跟踪需要构建的内容；我们的代码提升过程设置标志，构建过程清除它。

目前它的工作方式是你到达包含所有项目的根目录（在任何深度），只需键入`depends`（带有几个开关），它就会以正确的顺序发出所有需要构建的项目路径。

让我知道是否有兴趣...

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-10T15:03:52.827

项目依赖关系是一个图，如果项目 P 依赖于 Q，则项目 P 具有项目 Q 的有向边。这意味着 Q 必须在 P 之前构建。

通常，图的拓扑排序揭示了整个图的依赖顺序，但您只对从 P 到图根（或根，如果有更多）的图感兴趣。

此图中的根是不依赖于其他项目但其他项目依赖于该项目的项目。

当您更改 P 时，所有从 P 到您正在运行的根目录的项目都将以相反的顺序（根目录优先）进行编译。最简单的方法是创建该路径的子图（带有子节点）并使用拓扑排序来确定正确的顺序。

也就是说，这是一个复杂的问题，因为更改项目中的代码必须以某种方式将该项目标记为“已更改”，而且您还必须手动解析项目文件的依赖项。

如果我没记错的话，MSBuild 只编译过时的项目。（虽然确实会处理它们，但它必须这样做，否则它无法确定哪个项目被“更改”）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-10T14:57:40.047

[MSBuild Tasks](http://msbuildtasks.tigris.org/)没有您正在寻找的内容，但它会为您提供编写自己的任务的简单入口点。

# sql - 在文本列中存储数字数据时出现问题 - SELECT...BETWEEN

> ID：356336
> 
> 赞同：0
> 
> 时间：2008-12-10T14:53:16.093
> 
> 标签：sql, performance

几年前，我在一个系统上工作，其中数字主键存储在 [SQL Server] varchar 列中，因此在使用 BETWEEN 运算符进行查询时，我很快就陷入了困境：

```
SELECT ID FROM MyTable WHERE ID BETWEEN 100 AND 110; 
```

结果：

```
100
102
103
109
110
11 
```

这简直是​​糟糕的设计。但是，我正在开发一个第三方 ERP 系统，您可以想象它需要通用且灵活；因此，我们有各种表格，其中提供了字母数字字段，而业务仅使用数字 - 因此可能会出现类似的问题。

我猜这是一个很常见的问题。我有一个足够简单的解决方案，但我很好奇其他人如何处理这些问题。

我的简单解决方案是：

```
SELECT ID FROM MyTable 
WHERE ID BETWEEN iStartValue AND iEndValue 
AND (LENGTH(ID) = LENGTH(iStartValue)
 OR LENGTH(ID) = LENGTH(iEndValue)); 
```

您可能会说，这是一个 Oracle 系统，但我通常在 SQL Server 中工作 - 所以也许与数据库无关的解决方案更可取。

编辑1：从头开始-我不明白为什么也不欢迎专有解决方案。

编辑2：感谢所有回复。我不确定我是否对没有一个明显的、复杂的解决方案感到失望，但我相应地很高兴我似乎没有错过任何明显的东西！

我想我还是更喜欢我自己的解决方案；它很简单而且很有效——我有什么理由不应该使用它吗？我不敢相信它比其他解决方案提供的效率要低得多（如果有的话）。

我意识到在理想的世界中，这个问题不会存在；但不幸的是，我不是在一个理想的世界里工作，而且往往是在糟糕的情况下充分利用。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-10T14:55:31.940

如果您确定 ID 中的值只是数字，为什么不只是 CAST 它们

```
WHERE CAST(ID as int) BETWEEN iStartValue AND iEndValue 
```

编辑1：应该工作的转换方法的扩展是使用子查询来提取所有数字记录。请注意-我认为这种方法并不比上面建议的方法更好，我将其包括在内，因为它可以解决问题！！！

```
SELECT ID 
FROM    (
    SELECT  ID
    FROM    MyTable 
    WHERE   ISNUMERIC(ID) = 1
    AND CHARINDEX ('.', ID) = 0
    AND CHARINDEX ('-', ID) = 0
    ) a
WHERE   CONVERT(bigint, ID)  BETWEEN 0 AND 12000
ORDER BY LENGTH(ID) ASC, ID 
```

检查“-”和“。” 字符并不是真正需要的。我假设您的 ID 不能为负数或小数。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-10T15:13:46.427

我不知道这是否适用于您的情况，但是...

如何向表中添加一个实际的数字列，填充该值，（SQL Server 你可以使用一个在其上建立持久索引的计算列）

在其他供应商中，数据库使用其他一些机制来填充（触发器、物化视图等）

然后使用该列而不是 varchar 列...

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-10T14:58:58.687

换个演员怎么样。

```
SELECT ID FROM MyTable 
WHERE cast(ID as signed) BETWEEN cast(iStartValue as signed) AND cast(iEndValue as signed) 
```

给出的这个语法是 MySQL，但 T-SQl 有类似的 CAST 运算符。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-10T15:14:00.373

也许**LPAD(id, 12,' ')**对你有用。它应该使所有列值宽 12，并在左侧填充空格。

另外我会有点担心 varchar2 列中的数字。

如果你做任何数字的事情，比如分析，你可能会在非数字数据上得到一个例外。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-10T15:20:54.010

另一种选择是用零填充您的数字并在其上使用 between 运算符。出于 sargability 的原因，最好将此作为第二个 where 条件包含在内（以便仍然可以使用可能的索引）。像这样的东西...

```
SELECT ID FROM MyTable 
WHERE  ID BETWEEN iStartValue AND iEndValue 
       And Right('0000000000' + ID, 10) Between iStartValue and iEndValue 
```

我在 SQL Server 中对此进行了测试，它返回了正确的值。您可能需要修改它以使用 Oracle。

# perl - 如何在我的 Perl 程序中覆盖硬编码配置？

> ID：356337
> 
> 赞同：1
> 
> 时间：2008-12-10T14:53:25.483
> 
> 标签：perl, configuration, getopt-long

我有一个 Perl 脚本，它在顶部附近为它将使用的目录和文件设置变量。它还需要将一些变量设置为命令行参数。例子：

```
use Getopt::Long;

my ($mount_point, $sub_dir, $database_name, $database_schema);
# Populate variables from the command line:
GetOptions(
    'mount_point=s'       => \$mount_point,
    'sub_dir=s'           => \$sub_dir,
    'database_name=s'     => \$database_name,
    'database_schema=s'   => \$database_schema
);
# ...  validation of required arguments here

################################################################################
# Directory variables
################################################################################
my $input_directory    = "/${mount_point}/${sub_dir}/input";
my $output_directory   = "/${mount_point}/${sub_dir}/output";
my $log_directory      = "/${mount_point}/${sub_dir}/log";
my $database_directory = "/db/${database_name}";
my $database_scripts   = "${database_directory}/scripts";

################################################################################
# File variables
################################################################################
my $input_file       = "${input_dir}/input_file.dat";
my $output_file      = "${output_dir}/output_file.dat";
# ... etc 
```

这在我的开发、测试和生产环境中运行良好。但是，我试图让覆盖某些变量（无需进入调试器）更容易进行开发和测试。（例如，如果我想设置我的 input_file = "/tmp/my_input_file.dat"）。我的想法是使用 GetOptions 函数来处理这个问题，如下所示：

```
GetOptions(
    'input_directory=s'      => \$input_directory,
    'output_directory=s'     => \$output_directory,
    'database_directory=s'   => \$database_directory,
    'log_directory=s'        => \$log_directory,
    'database_scripts=s'     => \$database_scripts,
    'input_file=s'           => \$input_file,
    'output_file=s'          => \$output_file
); 
```

GetOptions 只能调用一次（据我所知）。我的第一个片段中的前 4 个参数是必需的，上面的最后 7 个是可选的。我认为理想的情况是在我的第一个代码片段中设置默认值，然后以某种方式覆盖在命令行中传递参数时已设置的任何默认值。我考虑过将所有选项存储在哈希中，然后在使用默认值设置每个变量时使用该哈希，除非哈希中存在条目，但这似乎增加了很多额外的逻辑。有没有办法在脚本的两个不同位置调用 GetOptions？

不确定这是否有意义。

谢谢！

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-10T15:23:01.807

听起来您需要更改程序以使用配置文件而不是硬编码配置。[我在Mastering Perl](http://oreilly.com/catalog/9780596527242/)中用了整整一章来讨论这个问题。您不想更改源代码来测试程序。

CPAN 上有许多 Perl 模块，它们使配置文件成为易于添加的功能。选择最适合您的输入数据的一种。

一旦获得了更好的配置模型，您就可以轻松地设置默认值，从多个位置（文件、命令行等）获取值，并轻松地使用不同的值测试程序。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-12-10T16:05:04.093

这是另一种方法。它使用名称数组和散列来存储选项。它使所有选项真正成为可选的，但会验证所需的选项，除非您在命令行中包含“--debug”。无论您是否使用“--debug”，您都可以覆盖其他任何一个。

当然，如果这对您很重要，您可以进行更明确的逻辑检查。我将“--debug”作为一个示例，说明如果您要覆盖“input_file”和“output_file”变量，如何省略“mount_point”等基本选项。

这里的主要思想是，通过将选项名称集保存在数组中，您可以使用相对较少的代码对组进行逻辑检查。

```
use Getopt::Long;

my @required_opts = qw(
    mount_point
    sub_dir
    database_name
    database_schema
);

my @internal_opts = qw(
    input_directory
    output_directory
    log_directory
    database_directory
    database_scripts
    input_file
    output_file
);

my @opt_spec = ("debug", map { "$_:s" } @required_opts, @internal_opts);

# Populate variables from the command line:
GetOptions( \(my %opts), @opt_spec );

# check required options unless 
my @errors = grep { ! exists $opts{$_} } @required_options;
if ( @errors && ! $opts{debug} ) {
    die "$0: missing required option(s): @errors\n";
}

################################################################################
# Directory variables
###############################################################################
my $opts{input_directory}    ||= "/$opts{mount_point}/$opts{sub_dir}/input";
my $opts{output_directory}   ||= "/$opts{mount_point}/$opts{sub_dir}/output";
my $opts{log_directory}      ||= "/$opts{mount_point}/$opts{sub_dir}/log";
my $opts{database_directory} ||= "/db/$opts{database_name}";
my $opts{database_scripts}   ||= "$opts{database_directory}/scripts";

################################################################################
# File variables
################################################################################
my $opts{input_file}    ||= "$opts{input_directory}/input_file.dat";
my $opts{output_file}   ||= "$opts{output_directory}/output_file.dat";
# ... etc 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-10T15:20:37.020

我想我要做的是将`input_directory`et al 设置为“undef”，然后将它们放入 getopts 中，然后测试它们是否仍然是 undef，如果是，则如图所示分配它们。如果您的用户在技术上足够成熟，可以理解“如果我给出一个相对路径是相对于`$mount_point/$sub_dir`”，那么我会进行额外的解析以寻找初始的“/”。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-10T15:12:59.360

可以使用数组作为其输入数据调用 GetOptions。阅读[文档](http://perldoc.perl.org/Getopt/Long.html#Parsing-options-from-an-arbitrary-array)。

# c# - 用于提取 HTML 正文内容的正则表达式

> ID：356340
> 
> 赞同：22
> 
> 时间：2008-12-10T14:53:56.373
> 
> 标签：c#, html, regex, xhtml

我正在寻找一个正则表达式语句，它可以让我从 XHTML 文档的 body 标记之间提取 HTML 内容。

我需要解析的 XHTML 将是非常简单的文件，例如，我不必担心 JavaScript 内容或`<![CDATA[`标签。

下面是我必须解析的 HTML 文件的预期结构。因为我确切地知道我将要使用的 HTML 文件的所有内容，所以这个 HTML 片段几乎涵盖了我的整个用例。如果我能得到一个正则表达式来提取这个例子的主体，我会很高兴。

```
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>
    </title>
  </head>
  <body contenteditable="true">
    <p>
      Example paragraph content
    </p>
    <p>
      &nbsp;
    </p>
    <p>
      <br />
      &nbsp;
    </p>
    <h1>Header 1</h1>
  </body>
</html> 
```

从概念上讲，我一直在尝试构建一个匹配除内部正文内容之外的所有内容的正则表达式字符串。有了这个，我将使用 C#`Regex.Split()`方法来获取正文内容。我认为这个正则表达式：

```
((.|\n)*<body (.)*>)|((</body>(*|\n)*) 
```

...可以解决问题，但它似乎根本不适用于我在 RegexBuddy 中的测试内容。

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2008-12-10T15:05:25.990

这行得通吗？

```
((?:.(?!<body[^>]*>))+.<body[^>]*>)|(</body\>.+) 
```

当然，您需要添加必要`\s`的才能考虑到`< body ...>`（带空格的元素），如：

```
((?:.(?!<\s*body[^>]*>))+.<\s*body[^>]*>)|(<\s*/\s*body\s*\>.+) 
```

再想一想，我不知道为什么我需要一个消极的前瞻......这也应该有效（对于格式良好的 xhtml 文档）：

```
(.*<\s*body[^>]*>)|(<\s*/\s*body\s*\>.+) 
```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-12-10T15:04:25.057

使用 XML 解析器比使用正则表达式更容易解析 XHTML。我知道这不是您要的，但是 XML 解析器将能够快速导航到正文节点并将其内容返回给您，而不会出现正则表达式给您带来的任何标签映射问题。

编辑：回应这里的评论；XML 解析器太慢了。

有两种 XML 解析器，一种叫做 DOM，它又大又重，简单友好，它在你做任何事情之前就从文档中构建出一棵树。另一种称为 SAX，速度快、重量轻、工作量大，它按顺序读取文件。您将希望 SAX 找到 Body 标记。

DOM 方法适用于多种用途，拉标签并找出谁是孩子。SAX 解析器按顺序读取文件并快速获取您需要的信息。正则表达式不会比 SAX 解析器快，因为它们都只是遍历文件和模式匹配，除了正则表达式在找到正文标记后不会退出，因为正则表达式没有内置XML的知识。事实上，您的 SAX 解析器可能使用小块正则表达式来查找每个标记。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2011-07-11T13:19:47.243

```
String toMatch="aaaaaaaaaaabcxx sldjfkvnlkfd <body>i m avinash</body>";
Pattern pattern=Pattern.compile(".*?<body.*?>(.*?)</body>.*?");
Matcher matcher=pattern.matcher(toMatch);
if(matcher.matches()) {
    System.out.println(matcher.group(1));
} 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-12-10T15:07:09.950

```
/<body[^>]*>(.*)</body>/s 
```

用。。。来代替

```
\1 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-12-10T15:07:27.140

你为什么不能把它分开

```
</{0,1}body[^>]*> 
```

并取第二个字符串？我相信它会比寻找一个巨大的正则表达式要快得多。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2016-09-14T03:21:08.597

匹配第一个 body 标签：`<\s*body.*?>`

匹配最后一个 body 标签：`<\s*/\s*body.*?>`

（注意：我们考虑了标签中间的空格，顺便说一句，这是完全有效的标记）

像这样将它们组合在一起，您将获得介于两者之间的所有内容，包括 body 标签：`<\s*body.*?>.*?<\s*/\s*body.*?>`. 并确保您使用的是`Singleline`忽略换行符的模式。

这适用于 VB.NET，希望其他人也适用！

# java - 查找所有未使用的变量

> ID：356345
> 
> 赞同：9
> 
> 时间：2008-12-10T14:54:54.983
> 
> 标签：java, netbeans

通常很容易在 Netbeans 中看到未使用的变量，只是一条灰色的波浪线。

但是如何在我的项目或单个类中找到所有这些未使用的变量？

***原因：***我正在调试一个包含大量复制和粘贴的代码库，但没有仔细完成。复制和粘贴后没有用正确的变量替换有很多错误。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-12-10T15:08:48.713

你可以在上面运行 FindBugs 之类的东西。

[查找错误](http://findbugs.sourceforge.net/)

查看它的错误列表

UuF：未使用字段 (UUF_UNUSED_FIELD) 此字段从未使用过。考虑将其从课堂上移除。

您可以仅对此进行过滤，但是始终在所有代码上运行它是一个好主意，它的发现令人惊讶。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-10T15:42:43.437

[PMD](http://pmd.sourceforge.net/)将为您找到未使用的局部变量（以及许多其他内容）。[我在这里](http://www.billthelizard.com/2008/11/netbeans-pmd-plugin.html)提供了一个 NetBeans 插件的安装说明（警告：无耻插件，链接到我的博客）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-10T15:29:30.123

编译器将警告未使用的变量，为您提供列表。

编译器将删除未使用的方法变量，但保留未使用的成员变量，这取决于您的代码库的状态，这可能会使这成为一个装饰性问题，可以在修改每个文件时处理，而不是努力删除所有未使用的变量一气呵成。

话虽如此，我通常喜欢我的构建在没有警告的情况下运行，所以当我真正破坏某些东西时，我会注意到警告。也许这就是你正在寻找的清理;-)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-10T15:17:30.193

在 Eclipse 中，那条灰色波浪线是称为警告的黄色波浪线。然后警告会传播到包级别和项目级别（这样您的项目几乎**总是**带有警告图标的黄色下划线）。无论如何，它确实可以帮助您查看哪些源文件中有警告。

那么你的任务就是解决整个项目中的每一个警告，你就会抓住未处理的变量。

我假设 netbeans 在某处具有相同的功能。

# javascript - JavaScript/Greasemonkey：从安全页面提交表单时避免 FireFox 安全警告

> ID：356347
> 
> 赞同：1
> 
> 时间：2008-12-10T14:55:22.767
> 
> 标签：javascript, firefox, forms, ssl, greasemonkey

我正在编写一个 Greasemonkey 脚本来连接两个公司内部网页。一种是 SSL，另一种是不安全的，只能通过 POST 请求访问。如果我在安全页面上创建一个隐藏表单并通过`onclick()`in提交它`<a>`，它可以正常工作，但 FF 会发出警告：

> 尽管此页面已加密，但您输入的信息将通过未加密的连接发送，并且很容易被第三方读取。
> 
> 您确定要继续发送此信息吗？”

无法通过 SSL 访问不安全页面，而没有它则无法访问另一个页面，并且我无法修改任一服务器 =\ 有没有办法通过执行某种 JavaScript/Greasemonkey 来避免此警告重定向魔法？谢谢！

编辑：无法禁用警告（出于相当充分的理由，因为很难判断您要发送的内容是否安全，否则）。我主要想知道是否有一种方法可以在 JavaScript 中发布，而不会看起来像是在提交表单。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-11T09:16:04.823

这可以通过执行 GM_xmlhttpRequest 来实现。例如，

```
GM_xmlhttpRequest({
  method: 'POST',
  url: 'http://your.insecure.site.here',
  onload: function(details) {

      // look in the JavaScript console 
      GM_log(details.responseText);

      /* This function will be called when the page (url) 
      has been loaded. Do whatever you need to do with the remote page here.*/
  }
}); 
```

API/更多信息在这里：[GM_xmlhttpRequest wiki](http://wiki.greasespot.net/GM_xmlhttpRequest)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-10T16:20:53.797

您可以设置一个新的 SSL 站点作为代理，将数据传回不安全的站点。或者只是让您的所有用户关闭该特定安全警告。（对不起 FF 团队，但这并不是一个非常有用的信息。）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-10T16:14:55.413

这是一个浏览器配置设置，它不能（或不应该）被 Javascript 更改。

除非脚本需要由多个用户使用，否则工具 -> 选项 -> 安全。您可以单击设置以显示显示哪些警告消息。请注意，这目前会影响所有站点，而不仅仅是您的内部系统。

# yui - 雅虎自动完成

> ID：356348
> 
> 赞同：3
> 
> 时间：2008-12-10T14:55:26.807
> 
> 标签：yui, yui-autocomplete

我有点想实现 YUI 自动完成文本框。这是代码：

```
<div id="myAutoComplete"> 
<input id="myInput" type="text" /> 
<div id="myContainer"></div> 
</div>
<script type="text/javascript">
YAHOO.example.BasicRemote = function() {
oDS = new YAHOO.util.XHRDataSource("../User/Home2.aspx");
// Set the responseType
oDS.responseType = YAHOO.util.XHRDataSource.TYPE_TEXT;
// Define the schema of the delimited results
oDS.responseSchema = {
recordDelim: "\n",
fieldDelim: "\t"
};
// Enable caching
oDS.maxCacheEntries = 5;

// Instantiate the AutoComplete
var oAC = new YAHOO.widget.AutoComplete("myInput", "myContainer", oDS);
oDS.generateRequest = function(sQuery) {
return "../User/Home2.aspx?method=" + "SA&Id="+document.getElementById("lbAttributes")[document.getElementById("lbAttributes").selectedIndex].value +"&query="+sQuery;
};
oAC.queryQuestionMark =false;
oAC.allowBrowserAutoComplete=false;
 return {
 oDS: oDS,
 oAC: oAC
 };
}
</script> 
```

我已经添加了所有 yahoo javascript 引用和样式表，但是当我更改 myInput 框中的文本并且它也没有显示任何内容时，它似乎从来没有进行 ajax 调用......我想我错过了一些东西。 .

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-10T18:04:28.143

@Kriss——你能发布一个链接到你遇到问题的页面吗？如果不查看从服务器返回的内容并查看页面的整个上下文，就很难调试 XHR 自动完成功能。

@Adam —— jQuery 非常棒，是的，但是 YUI 的小部件都有统一的文档和统一的许可。这是今天引人注目的差异化来源。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-10T15:42:34.277

老实说，我知道这不是最有帮助的答案……这些天你应该考虑使用 jQuery，因为它在易用性、语法和社区关注方面完全把 YUI 从水中吹走了。

然后你可以蹒跚学步地访问[http://plugins.jquery.com](http://plugins.jquery.com)并找到一大堆带有示例代码等的很酷的自动完成插件。

希望这可以帮助。

# c# - Excel 互操作 - 效率和性能

> ID：356371
> 
> 赞同：63
> 
> 时间：2008-12-10T15:03:46.213
> 
> 标签：c#, excel, performance, interop, vsto

我想知道我能做些什么来提高 Excel 自动化的性能，因为如果你在工作表中有很多事情，它可能会很慢......

以下是我自己发现的一些：

*   `ExcelApp.ScreenUpdating = false`-- 关闭屏幕重绘

*   `ExcelApp.Calculation = Excel.XlCalculation.xlCalculationManual`-- 关闭计算引擎，以便 Excel 在单元格值更改时不会自动重新计算（完成后重新打开）

*   减少调用，`Worksheet.Cells.Item(row, col)`并且`Worksheet.Range`——我不得不轮询数百个单元来找到我需要的单元。实施一些单元位置缓存，将执行时间从约 40 秒减少到约 5 秒。

什么样的互操作调用会严重影响性能并且应该避免？您还能做些什么来避免进行不必要的处理？

* * *

## 回答 #1

> 赞同：49
> 
> 时间：2010-02-19T04:34:06.993

使用 C# 或 VB.Net 获取或设置范围时，请计算范围的总大小，然后获取一个大型二维对象数组...

```
//get values
object[,] objectArray = shtName.get_Range("A1:Z100").Value2;
iFace = Convert.ToInt32(objectArray[1,1]);

//set values
object[,] objectArray = new object[3,1] {{"A"}{"B"}{"C"}};
rngName.Value2 = objectArray; 
```

请注意，了解 Excel 存储的数据类型（文本或数字）很重要，因为当您将类型从对象数组转换回时，它不会自动为您执行此操作。如果您无法事先确定数据类型，则在必要时添加测试以验证数据。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2011-10-06T15:37:59.587

这适用于任何想知道从数据库结果集中填充 excel 工作表的最佳方法的人。这绝不是一个完整的列表，但它确实列出了一些选项。

尝试在旧的 Pentium 4 3GHz 机器上填充具有 155 列和 4200 条记录的 Excel 工作表时的一些性能数据，包括从最慢到最快的顺序从不超过 10 秒的数据检索时间如下...

1.  一次一个单元格 -*不到 11 分钟*

2.  通过转换为 html 来填充数据集 + 将 html 保存到磁盘 + 将 html 加载到 excel 中并将工作表保存为 xls/xlsx - *5 分钟*

3.  一次一列 - *4 分钟*

4.  使用 SQL 2005 中已弃用的 sp_makewebtask 过程创建 HTML 文件 - 9 秒 + 然后在 excel 中加载 html 文件并保存为 XLS/XLSX -*大约 2 分钟。*

5.  将 .Net 数据集转换为 ADO RecordSet 并使用 WorkSheet.Range[].CopyFromRecordset 函数填充 excel - *45 秒！*

我最终使用了选项 5。希望这会有所帮助。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-12-15T18:31:10.523

If you're polling values of many cells you can get all the cell values in a range stored in a variant array in one fell swoop:

```
Dim CellVals() as Variant
CellVals = Range("A1:B1000").Value 
```

There is a tradeoff here, in terms of the size of the range you're getting values for. I'd guess if you need a thousand or more cell values this is probably faster than just looping through different cells and polling the values.

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-12-10T15:12:32.077

尽可能使用 excels 内置功能，例如：不要在整个列中搜索给定的字符串，而是使用`find`GUI 中通过 Ctrl-F 提供的命令：

```
Set Found = Cells.Find(What:=SearchString, LookIn:=xlValues, _
    SearchOrder:=xlByRows, SearchDirection:=xlNext, _
    MatchCase:=False, SearchFormat:=False)

If Not Found Is Nothing Then
    Found.Activate
    (...)
EndIf 
```

如果要对某些列表进行排序，请使用 excel`sort`命令，不要在 VBA 中手动进行：

```
Selection.Sort Key1:=Range("A1"), Order1:=xlAscending, Header:=xlGuess, _
    OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, _
    DataOption1:=xlSortNormal 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2015-02-08T12:40:29.583

正如匿名类型所说：读/写大范围块对性能非常重要。

如果 COM-Interop 开销仍然太大，您可能希望切换到使用 XLL 接口，这是最快的 Excel 接口。

尽管 XLL 接口主要是为 C++ 用户设计的，但 XL DNA 和 Addin Express 都提供了 .NET 到 XLL 的桥接功能，这比 COM-Interop 快得多。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-12-10T15:11:19.083

性能还很大程度上取决于您如何自动化 Excel。VBA 比 COM 自动化快，比 .NET 自动化快。而且通常早期（编译时）绑定也比后期绑定更快。

如果您遇到严重的性能问题，您可以考虑将代码的关键部分移至 VBA 模块并从您的 COM/.NET 自动化代码中调用该代码。

如果您使用 .NET，您还应该使用 Microsoft 提供的优化的主互操作程序集，而不是使用自定义构建的互操作程序集。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2015-07-16T23:36:37.590

您可以在 VBA 中做的另一件大事是使用 Option Explicit 并尽可能避免 Variants。在 VBA 中，变体不是 100% 可以避免的，但它们会使解释器在运行时做更多的工作并浪费内存。

当我开始在 Excel 中使用 VBA 时，我发现这篇文章非常有帮助。
[http://www.ozgrid.com/VBA/SpeedingUpVBACode.htm](http://www.ozgrid.com/VBA/SpeedingUpVBACode.htm)

还有这本书

[http://www.amazon.com/VB-VBA-Nutshell-Language-OReilly/dp/1565923588](https://rads.stackoverflow.com/amzn/click/com/1565923588)

如同

```
 app.ScreenUpdates = false //and
 app.Calculation = xlCalculationManual 
```

你也可以设置

```
 app.EnableEvents = false //Prevent Excel events
 app.Interactive = false  //Prevent user clicks and keystrokes 
```

尽管它们似乎没有前两个那么大。

与将范围值设置为数组类似，如果您正在处理的数据主要是在列的每一行中具有相同公式的表格，您可以为您的公式使用 R1C1 公式表示法并将整个列设置为等于要设置的公式字符串一次通话即可完成所有工作。

```
app.ReferenceStyle = xlR1C1
app.ActiveSheet.Columns(2) = "=SUBSTITUTE(C[-1],"foo","bar")" 
```

此外，使用 ExcelDNA 和 .NET（或 C 中的硬方法）创建 XLL 插件也是使 UDF 在多个线程上运行的唯一方法。（请参阅 Excel DNA 的 ExcelFunction 属性的 IsThreadSafe 属性。）

在完全过渡到 Excel DNA 之前，我还尝试在 .NET 中创建 COM 可见库以在 VBA 项目中引用。这样，繁重的文本处理比 VBA 快一点，使用包装的 .NET List 类而不是 VBA 的 Collection，但 Excel DNA 更好。

# c# - 如何在 CLR UDF 中返回 nvarchar(max)？

> ID：356373
> 
> 赞同：11
> 
> 时间：2008-12-10T15:04:23.200
> 
> 标签：c#, sql-server, clr, nvarchar

假设以下定义：

```
/// <summary>
/// Replaces each occurrence of sPattern in sInput with sReplace. This is done 
/// with the CLR: 
/// new RegEx(sPattern, RegexOptions.Multiline).Replace(sInput, sReplace). 
/// The result of the replacement is the return value.
/// </summary>
[SqlFunction(IsDeterministic = true)]
public static  SqlString FRegexReplace(string sInput, string sPattern, 
      string sReplace)
{
    return new Regex(sPattern, RegexOptions.Multiline).Replace(sInput, sReplace);
} 
```

传入长度大于 4000 的`nvarchar(max)`值`sInput`将导致该值被截断（即调用此 UDF 的结果`nvarchar(4000)`与`nvarchar(max)`.

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2008-12-10T15:07:25.783

哦，无论如何，我自己找到了答案：

```
/// <summary>
/// Replaces each occurrence of sPattern in sInput with sReplace. This is done 
/// with the CLR: 
/// new RegEx(sPattern, RegexOptions.Multiline).Replace(sInput, sReplace). 
/// The result of the replacement is the return value.
/// </summary>
[SqlFunction(IsDeterministic = true)]
[return: SqlFacet(MaxSize = -1)]
public static  SqlString FRegexReplace([SqlFacet(MaxSize = -1)]string sInput, 
       string sPattern, string sReplace)
{
    return new Regex(sPattern, RegexOptions.Multiline).Replace(sInput, sReplace);
} 
```

这个想法是向 SQL Server 提示输入和返回值不是默认值`nvarchar(4000)`，而是具有不同的大小。

我学到了一个关于属性的新技巧：它们可以添加到参数以及方法本身（非常明显），*也*`[return: AttributeName(Parameter=Value, ...)]`可以使用语法添加到返回值。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2015-06-29T17:13:15.810

另请参阅[如何使用 Nvarchar(max) 参数创建 CLR 存储过程](https://stackoverflow.com/questions/4213788/how-to-create-clr-stored-procedure-with-nvarcharmax-parameter)，您将了解如何/为什么真正应该使用 SqlChars 数据类型。请参阅在 MSDN[中的 CLR 中处理大对象 (LOB) 参数。](https://docs.microsoft.com/en-us/sql/relational-databases/clr-integration-database-objects-types-net-framework/handling-large-object-lob-parameters-in-the-clr)

# mmc - 我的 MMC 管理单元中不必要的操作窗格项目

> ID：356375
> 
> 赞同：0
> 
> 时间：2008-12-10T15:05:02.200
> 
> 标签：mmc

我正在开发一个 MMC 3.0 管理单元。我有自定义操作要显示在右侧 MMC 操作窗格中，我已经使用

ParentFormView.SelectionData.ActionsPaneItems.Add(CustomAction)

到目前为止一切正常。

我的问题是 - 默认情况下，当我的管理单元加载时，Windows 还会在操作窗格中绘制诸如“查看”、“从此处新建窗口”、“帮助”等操作。如何以编程方式禁用这些默认操作？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-18T00:16:22.027

这些是“默认”操作，Microsoft 尚未发布任何有关如何执行此操作的文档。

# delphi - Delphi 菜单合并问题

> ID：356379
> 
> 赞同：3
> 
> 时间：2008-12-10T15:06:27.097
> 
> 标签：delphi, vcl, menu

我正在尝试将两个主菜单合并在一起，但在使用子项获得正确结果时遇到问题。我在 MenuItems 上使用 GroupIndex 属性来控制合并/插入。

Menu1（带有 groupindices）是这样的

*   文件=10
    *   打开=11
    *   关闭=12
*   编辑=20
    *   切=21
    *   粘贴=22
*   帮助=90
    *   关于=91

Menu2是这样的

*   编辑=20
    *   清除=23
*   小部件=30
    *   小部件1=31
    *   小部件2=32

我在做

```
 Menu1.Merge(Menu2); 
```

我希望组合菜单在编辑菜单中有一个新的顶部菜单“小部件”和一个新的“清除”命令。“小部件”工作正常，但编辑菜单丢失了剪切和粘贴，这不是我想要的。

如何阻止剪切和粘贴命令消失？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-10T17:25:12.027

Delphi 中的菜单合并功能与您所期望的有点不同：它是非递归的（不幸的是！）。这意味着当您调用 时`Menu1.Merge`，Menu1 的“编辑”菜单将*被*Menu2 的。

你有两个选择：

*   将“剪切”和“粘贴”手动添加到 Menu2。
*   编写自己的合并函数。

不久前我遇到了同样的问题（请参阅[这个 SO question](https://stackoverflow.com/questions/152405/how-do-i-merge-tmainmenus-that-use-separate-imagelists-and-retain-the-correct-i#153799)）：

> 我最终得到的结果是，我的所有菜单和工具栏都使用了 [Toolbar2000](http://jrsoftware.org/tb2k.php) 包。然后，您可以下载一段非常棒的代码，称为 [TB2Merge](http://flocke.vssd.de/prog/code/pascal/tb2merge/)，它完全符合您的要求。

您还可以将任何自定义编写的菜单合并代码基于 TB2Merge，我猜...

# asp.net-mvc - 添加不是聚合根的实体的首选 URL 是什么？

> ID：356382
> 
> 赞同：0
> 
> 时间：2008-12-10T15:07:18.513
> 
> 标签：asp.net-mvc, model-view-controller, controller, domain-driven-design

示例：Order 对象（聚合根）具有 OrderLine 对象（子实体）的集合。将 OrderLine 添加到订单的 URL 是什么？考虑使用聚合根的控制器和为子实体使用单独的控制器之间的区别。

1：[http ://example.com/orders/add-orderline?order-id=42&product-id=12&quantity=2](http://example.com/orders/details/42/add-orderline?product-id=12&quantity=2)

或者

2：[http ://example.com/order-lines/add?order-id=42&product-id=12&quantity=2](http://example.com/order-lines/add?order-id=42&product-id=12&quantity=2)

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-10T15:22:54.990

订单行能否独立于订单而存在？可能不会，因此，我会在订单控制器上执行操作。

我更喜欢以下内容：

```
http://example.com/orders/addline?order-id=42&product-id=12&quantity=2 
```

或者即使`addproduct`一个产品在一个订单中只能存在于一条线上。

据推测，这将在成功时呈现整个订单的视图，这是将其放在订单控制器上的另一个原因。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-10T15:33:45.467

遵循您的域模型。

是否存在 Orderline 对象，是否可以对其执行操作？（根据领域，不是代码中的对象，而是现实生活中的对象。）很可能不是，或者它将是聚合根。

Order 对象存在，并且您正在向其添加 Orderline。因此，根对象是 Order，具有添加 Orderline 的操作。

您的 URL 路由将遵循这一点，带有对象的控制器和添加 Orderline 的操作。

从您的示例中，这是遵循该逻辑的示例：

```
http://example.com/orders/add-orderline?order-id=42&product-id=12&quantity=2 
```

# css - CSS 定位，希望在调整窗口大小时固定内容的宽度。

> ID：356390
> 
> 赞同：4
> 
> 时间：2008-12-10T15:09:34.610
> 
> 标签：css

我有一个div，里面有两个嵌套的div，（float：left）一个是菜单栏，右边（float：right）应该显示页面的任何内容，当窗口处于最大值时它可以正常工作，但是当我调整它的大小时，内容被折叠，直到它不再有任何空间，它被强制显示在左侧菜单栏下方，如何使宽度固定，以便用户在调整大小时可以滚动？（css宽度不起作用，我在浮动正确的内容和不浮动之间交替），这是代码：

```
<div style="width:100%">
  <div style="float:left; background:#f5f5f5; border-right:1px solid black; height:170%; width:120px;"></div>   
  <div style="margin-right:2px;margin-top:15px; margin-bottom:5px; width:100%; border:1px solid #f5f5f5"></div> 
</div> 
```

我现在只需要在内部资源管理器上工作。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-10T15:17:45.157

应该这样做（容器是包含 2 个 div 的父 div）：

```
.container {
    width: 1024px;
    display: block;
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-10T15:27:34.887

您可能希望在包含的 div 上设置宽度并设置溢出属性

```
#containing_div {
    width: 200px;
    overflow: auto;
} 
```

如果有意义的话，也可以在页面上使用 min-width 属性，但是 CSS 属性并不真正适用于 IE6，这通常是我在那种情况下所做的（支持 Firefox、IE7、IE6 等）

```
#container {
    min-width: 1000px;
    _width: 1000px; /* This property is only read by IE6, which gives a fixed width */
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-10T15:12:34.057

好吧，放置一个`width`或`min-width`属性是要走的路。

现在，没有示例或实际页面的链接，回答起来有点棘手。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-10T15:13:45.553

只是不要让正确的 div 浮动。菜单已经漂浮在任何其他内容的左侧。只需为右侧 div 设置一个左边距，这样 div 中的内容就不会被浮动 div 包裹。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-10T15:15:53.677

如果两个 div 占用了 100% 的可用宽度，可以尝试使用百分比宽度并显示：在需要的地方与另一个具有固定最小宽度/宽度（boo IE）的 div 内联。

如果没有一些 HTML 继续下去，这*是相当困难的*

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-10T15:16:22.520

您的包含 div 的宽度应该足以包含两个内部 div

因此，如果您的两个内部 div 每个都是 300 像素，并且假设您没有边距/填充，那么您应该将外部 div 设置为 600 像素；

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-10T15:23:29.870

我有点困惑：
固定宽度意味着节点的宽度不会改变。绝不。你说当屏幕变得太小而不适合你的内容时你想滚动，所以我认为你的意思是固定宽度的完全相反。

如果我的假设是正确的，您可以如前所述选择百分比宽度。注意宽度建议的“最小宽度”解决方案，因为它没有得到很好的支持。

```
<div id="container" style="width:100%">
    <div id="primaryNav" style="float:left; width:150px; background-color: Orange">someNav</div>
    <div id="content" style="margin-left: 10px; background-color: Red; overflow: auto;">
        loadsOfSuperInterestingContentI'mSuperSerious<br/>
        <br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/>
        <br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/>
        <br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/>
        Seriously
    </div>
</div> 
```

这应该是相当跨浏览器

# .net - 调试 Windows 服务，添加数据库日志记录来捕捉线索是个坏主意？

> ID：356406
> 
> 赞同：0
> 
> 时间：2008-12-10T15:13:34.633
> 
> 标签：.net, windows-services, error-handling

我有一个正在尝试调试的 Windows 服务。

在 Catch() 子句中添加错误日志记录是个坏主意吗？

我的日志记录是使用数据库来记录错误。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-10T15:19:38.287

当您提到调试和日志记录时，我不是 100% 清楚您正在尝试做什么。

如果作为整体日志记录方法的一部分，在 catch 子句上进行日志记录通常是一个好主意。

如果您在调试服务之后，您有两个选择 - 如果您可以控制尝试从服务外部调试的代码（通过一些外部刺激），或者如果您在执行代码之前有一段时间，您可以简单地打开VS 中的源代码，并且只要您在调试模式下编译，您就可以将 VS 附加到服务进程。

然后在您的源代码中设置的任何断点都可以让您访问调试中的代码。

但是，如果您不能这样做（例如，如果您需要调试启动事件），您可以将 System.Diagnostics.Debugger.Break() 添加到源代码中，这将在运行时命中此行时启动调试器.

我通常通过编译符号将此类语句包装在#if #endif 区域控件中。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-10T15:20:16.493

在我负责的服务中，初始化后发生的任何错误（在代码确认它可以连接到数据库、可以访问日志文件并开始工作之后）都会被放入其日志文件中。启动或关闭时发生的错误会发送到事件日志。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-10T15:26:14.607

一般来说，记录异常是个好主意。尤其是在调试服务时，这总是一项令人讨厌的任务。

您可能遇到的唯一问题是日志记录本身会导致异常。当我登录到事件日志时，这发生在我身上（有关详细信息，请参阅[此问题](https://stackoverflow.com/questions/313839/what-is-the-best-way-to-write-event-log-entries)）。这意味着您无法获得有关导致服务失败的异常的信息。

出于调试目的，我认为将异常记录到本地文本文件中很有用，除了您执行的任何其他日志记录。这是最不可能失败的。完成调试后，您可以删除那些额外的日志记录命令。（好吧，你必须小心不要在这样做时引入新的错误......）

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-10T15:18:25.543

这取决于代码。在我的一些服务中，我将信息记录到数据库中（因为这是这里的策略），但是我有一个辅助记录机制，可以在记录到数据库失败的情况下将消息添加到事件日志中。您必须问自己的问题是“如果无法连接到数据库，错误会发生什么？”

# wpf - 如何将滚动条添加到扩展面板？

> ID：356411
> 
> 赞同：4
> 
> 时间：2008-12-10T15:14:25.083
> 
> 标签：wpf

我在扩展面板中有一个堆栈面板，我以编程方式向其中添加了复选框。目前 exanpander 停止在表单的底部，但堆栈面板不断增长。我希望堆栈面板以扩展器为界并滚动以显示复选框。我是否需要将复选框放在列表框中才能获得滚动功能？

```
<Grid>
    <Expander Header="Expander1"  Margin="0,0,0,2" Name="Expander1" VerticalAlignment="Top" Background="Coral">
        <StackPanel Name="StackScroll" Margin="0,0,0,2"  Background="Aqua"></StackPanel>
    </Expander>
</Grid> 
```

");

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-12-10T15:23:21.493

您可以将 StackPanel 嵌套在 ScrollViewer 中：

```
 <Grid>  
    <Expander Header="Expander1"  Margin="0,0,0,2" Name="Expander1" VerticalAlignment="Top" Background="Coral">
      <ScrollViewer VerticalScrollBarVisibility="Auto">
        <StackPanel Name="StackScroll" Margin="0,0,0,2"  Background="Aqua">
        </StackPanel>
      </ScrollViewer>
    </Expander>
  </Grid> 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-10T15:20:00.737

在 StackPanel 声明中设置**ScrollViewer.VerticalScrollBarVisibility="Auto" 。**

# sql-server - 如何使用 SMO 查找正在执行的 SqlAgent 作业的 SPID

> ID：356418
> 
> 赞同：1
> 
> 时间：2008-12-10T15:16:04.893
> 
> 标签：sql-server, smo, sql-server-agent

通过使用 Server.JobServer.jobs 获取作业列表的 SMO 对象，我可以找到每个作业的状态。对于那些当前正在执行的，我想找到它正在执行的 SPID。我还可以使用 Server.EnumProcesses() 获取服务器进程的列表。这给了我当前活动的 SPID 的列表。我想匹配两者。

我能想到的最好的方法是将 jobid 转换为字符串，并将 jobId 从 EnumProcesses 表中的程序字符串中取出（至少在我的系统上，该表将 jobId 嵌入到此描述中）。这真的很难看，有几个原因，其中最重要的原因是程序描述中的 Guid 和 jobID 的 guid 在字符串表示的前 3 段中切换了它们的字节。呸。

有没有更好的方法使用 SMO 来做到这一点？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-06T08:25:16.443

使用 SMO，我不知道。

我已经使用 T/SQL 完成了这项工作。获取 job_id 值并将其转换为 varbinary。这应该与应用程序名称中的值匹配（在“SQL 代理”部分之后）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2013-02-07T06:05:48.643

使用 SP_who2 ，在结果“程序”字段中，您将找到 SQLAgent-Jobid。您将从 MSDB 表中的 sysjobs 中获取 jobID。现在您可以获得作业的 sp_id

# gridview - Infragistics UltraWebGrid - 页脚总计

> ID：356423
> 
> 赞同：1
> 
> 时间：2008-12-10T15:17:21.303
> 
> 标签：gridview, infragistics, ultrawebgrid

我目前正在使用`UltraWebGrid`Infragistics 的控件，并且在页脚中显示列的值的总和。

问题是，由于我使用分页，页脚中显示的总数**仅由当前页面的值计算**，但我想要源中所有元素的总和，而不仅仅是当前页面

有没有人遇到过这个问题？

这是代码：

```
myGrid.Columns.FromKey("NoOfSubs").Footer.Total = UltraWebGrid.SummaryInfo.Sum
myGrid.Columns.FromKey("NoOfSubs").Footer.Formula = "SUM([NoOfSubs])" 
```

`myGrid`是 UltraWebGridControl

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-10T18:52:11.180

不幸的是，我认为你最好的选择是运行一个单独的查询来获取你的总数并将其用于显示。这不仅解决了数据在页面级别求和的问题，而且还通过 Infragistics Table Summary 将您从仅表底部的定位限制中解耦。

# c# - 如何获取包含来自 excel 数据的列的计数

> ID：356432
> 
> 赞同：2
> 
> 时间：2008-12-10T15:18:15.187
> 
> 标签：c#, .net, excel

我想知道 Excel 互操作中是否有一个简单的属性可以返回给定工作表中使用的列（包含数据的列）的计数。

例如：如果 myWorksheet.Columns.Count 返回给定工作表中的总列数，是否没有类似的等效项：myWorksheet.Columns.UsedCount？

我不确定这个问题是否太基本以至于不能问，但是在搜索谷歌时，我似乎只能找到相当神秘的解决方案，这些解决方案似乎是一个人在与 Excel 交互时想要做的相当基本的事情.

我试图通过不提出一堆不相关的代码来保持简短。但如果我不够明确，请告诉我。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-10T15:29:52.790

使用互操作，您可以获得使用元素的范围

oXLSheet.UsedRange.Address

其中 oXLSheet 是您的 Worksheet 对象

# vb.net - Visual Studio 2008 设计师搞砸了大型 VB 项目

> ID：356434
> 
> 赞同：0
> 
> 时间：2008-12-10T15:18:57.697
> 
> 标签：vb.net, visual-studio-2008

我们有 3 名开发人员都使用相同的版本（VS 2008 SP1），我们都使用大型 VB 项目（Windows 窗体）。IDE 会不时出现各种问题，例如锁定、崩溃，甚至无法拖动表单对象，或者它会立即消失。

在我们最大的项目中（实际上是一个解决方案文件中的 5 个项目），这里的几个人只能重新构建项目进行 2-3 次测试，然后他们必须关闭工作室并重新打开它。

有没有其他人经历过这个？大型 C# 项目会发生这种情况吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-10T15:22:20.623

是的，我一直都在经历这个！如果你能相信的话，它在 2008 年变得更好了。

我通常发现原因与我自己的代码中的异常有关。UI 可能会引入在设计模式下表现不佳的自定义控件，从而导致问题。

有时，我会调出 VS2008 的第二次执行并将调试器附加到 VS 的第一次执行。然后，我可以调试我自己的代码，因为它正在第一个实例的设计器中运行。通常，会引发异常，我可以修复我的代码以在设计器中更好地发挥作用。

在其他情况下，我不知道为什么会这样。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-10T15:22:13.727

我听说有人有这个问题，但是，我自己从来没有遇到过问题。

我听说许多人将问题追溯到使用 ReSharper 作为主要原因。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-10T16:02:18.170

我遇到的导致设计器崩溃的最常见问题是，当我创建一个只有构造函数需要参数的表单时。

为了缓解这种情况，当我只需要使用参数实例化表单时，我创建了一个设计者可以使用但表单的消费者不会看到的私有无参数构造函数。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-10T16:13:10.363

我亲身体验过VS2008 sp1的各种设计师恶行。我卸载了服务包以恢复我的开发环境的稳定性。这是一个不幸的答案，但请尝试一下。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-05-06T09:58:14.507

我唯一遇到的就是设计视图崩溃并出现错误，以前导致我不得不重新创建表单并复制和粘贴代码，直到我学会了如何修复它。

我的问题是因为我经常使用 ctrl+fa 而发生的。如果您使用的是大文件，这可能是正在发生的事情。

# java - 如何从 JSP2 标记文件访问初始化参数？

> ID：356437
> 
> 赞同：0
> 
> 时间：2008-12-10T15:19:29.473
> 
> 标签：java, jsp, jsp-tags, init-parameters

我正在尝试创建一个 jsp 标记文件，但是当我尝试使用时它无法编译`pageContext.getServletConfig().getInitParameter("myInitParam")`

我正在使用 tomcat，当我尝试查看包含该文件的页面时，我得到一个 jasper 编译错误 pageContext 无法解析。我也尝试过使用`getInitParameter`，但也失败了。我可以使用请求对象，所以我知道其他一切都很好。

有谁知道从 jsp 标记文件（最好是在 scriptlet 中）访问 web.xml 中设置的 init 参数的方法？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-11T05:25:51.433

我刚刚发现诀窍是使用隐式对象之一，在这种情况下，配置或应用程序取决于 init-parameters 范围。它们在[http://today.java.net/pub/a/today/2003/11/14/tagfiles.html列出](http://today.java.net/pub/a/today/2003/11/14/tagfiles.html)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-10T15:27:12.797

您是否尝试过请求而不是 pageContext？或者就在 servlet 本身之外：

```
getInitParameter("myInitParam"); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-10T15:30:29.763

你在扩展[TagSupport](http://java.sun.com/j2ee/1.4/docs/api/javax/servlet/jsp/tagext/TagSupport.html)类吗？

如果是这样，这个类有一个名为 的成员`pageContext`，Tag 接口声明了一个方法`setPageContext(PageContext pc)`，文档声明

> 此方法由 JSP 页面实现对象在 doStartTag() 之前调用。

所以你应该能够`this.pageContext`很好地引用 - 除非你正在扩展一个不同的类？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-04-21T08:04:02.793

```
application.getInitParameter("<Name>"); 
```

# python - 满足我的应用程序脚本需求的最小 Python 构建？

> ID：356452
> 
> 赞同：2
> 
> 时间：2008-12-10T15:22:41.527
> 
> 标签：python, scripting, python-embedding

对于为我的应用程序的脚本需求构建一个非常简约的 Python(2.x) 版本，您有什么建议。

我在这里的主要动机是尽可能降低占用空间（内存和磁盘方面），这样我的本机应用程序就不会受到任何重大的性能影响。甚至 Python DLL 的大小也在考虑之中，因为可能会增加我的应用程序的启动时间。

我们可以像[Lua](http://www.lua.org/)或其他轻量级解决方案一样低吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-10T16:00:10.797

你试过[Tiny Python](http://www.tinypy.org/)吗？

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2010-04-30T11:39:18.990

您只能使用 dll

# analysis - Web 服务器日志分析工具

> ID：356459
> 
> 赞同：10
> 
> 时间：2008-12-10T15:23:49.980
> 
> 标签：analysis, logging

对于准确的 Web 日志分析工具以生成 IIS 日志报告有什么建议吗？我们使用了 WebTrends，但我觉得它并不准确。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-11T06:08:35.433

分析博客，我不认为Analog会出错：[http ://www.analog.cx/](http://www.analog.cx/)

如果您正在分析自己的日志（通常是巨大的文件），您将需要您能找到的最快的分析器。模拟速度很快。

你会想要一个已经存在一段时间并且仍然受支持的。Analog刚刚庆祝了它的10岁生日。

Analog声称是世界上最流行的日志文件分析器。

多种语言。

我说它是免费和开源的吗？

就准确性而言，没有任何工具可以提供完美的结果。Javascript 在捕获命中时经常失败。试图通过网站跟踪个人的路径（即出于分析目的）充满了问题。甚至试图区分点击量和访问量并筛选出机器人，这更像是一门黑色艺术而不是一门科学。

最好的办法就是拥有一个工具，它可以提供体面的基本统计数据，告诉你你需要知道什么。

我查看了其他工具，例如 Deep Log Analyzer： http: [//www.deep-software.com/](http://www.deep-software.com/)，它试图从您的博客中进行分析。但是速度是个问题。他们声称他们的新版本 3.5 - 2008 年 4 月（我没有尝试过）提高了性能。像这样的程序的一大优势是您可以执行高级报告，包括自定义 SQL 请求。您必须购买他们的专业版（200 美元）才能进行大部分分析和自定义查询。如果 Analog 对您来说太简单了，那么试试 Deep Log Analyzer 的免费版本。

你也可以试试微软自己的日志解析器，推荐的答案是：[https](https://stackoverflow.com/questions/157677/a-good-iis-log-viewer-for-large-log-files) ://stackoverflow.com/questions/157677/a-good-iis-log-viewer-for-large-log-files 。但是你需要一些额外的技能才能使用它。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-10T19:02:08.277

**简短的回答**：

你对结果的质疑是正确的；日志分析不足以报告实际流量。

**更长的答案**：

WebTrends 是一个伟大的工具，它提供了什么。但作为 WebTrends 安装的前任管理员，我发现 Web 日志在捕获感兴趣的指标方面是出了名的糟糕。

例如，如果您的 Web 交付堆栈中存在任何缓存（或在消费者方面 - *我在向您挥舞拳头**，AOL**！），那么您的 Web 日志将立即不反映您网站的实际活动。这是因为日志分析假定所有用户消费都将转换为返回 Web 服务器的 HTTP 请求，因此已记录在 IIS 日志中。在缓存的情况下，情况并非如此。

将来，如果您想要更可靠的结果，您最终需要确保存在一种方法来破坏任何缓存策略。显而易见的答案是动态内容。但是，如果您不想以这种方式重写所有内容，只需确保您的网络流量分析使用动态调用。

WebTrends 实际上为这个问题提供了一个解决方案，称为 SDC 服务器。这正是谷歌分析所提供的——它是一个对分析服务器的 javascript 回调。

...我可以在这上面呆几天。如果您想了解更多具体信息，请回复评论。;)

***编辑***：特别是使用 WebTrends，在默认 IP/userAgent 配置之外配置会话跟踪非常重要。如果您的网络服务器分配了会话 cookie，您会发现这会增加您的可靠性；特别是用于区分可能位于同一 NAT 后面的用户。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-10T19:15:27.517

您想从日志中分析什么？有一堆工具 - 免费或付费 - 将通过日志并吐出各种各样的数字。有些具有真正的意义，有些则最好与一粒盐一起使用。

没有人会告诉你“有多少人真正在阅读我精彩的网页”。那些试图显示“不同的网站访问者”或任何详细指标的人充其量只是对模糊趋势的粗略近似......

但是对于它的价值，我们使用[Analog](http://www.analog.cx/)。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-10T15:26:18.087

[来自SmarterTools](http://www.smartertools.com)的 SmarterStats 让我非常幸运。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-10T15:28:21.077

MSFT 提供了一个免费的日志记录包，用于使用 SQL Reporting Services 查看此信息。去谷歌上查询。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-10T18:12:07.050

如果它是内部的，那么使用日志只是一个好主意 - 我会使用谷歌分析来处理互联网上的任何事情

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-10-02T20:23:50.090

多年来，我一直在使用为软件付费的 Summary，并且喜欢它。更新的成本对我来说很重要，而支付更新以从交易中获取用户代理字符串更新变得越来越麻烦。并不是说没有其他修复，我只是倾向于不需要它们。

如果他们使用摘要与模拟相比，有人愿意分享吗？

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-12-02T13:41:09.590

看看 XpoLog 日志分析平台的 web 应用服务器和 web 服务器日志。它是一个日志管理和分析平台，可集成到 Web 服务器日志并创建报告，提供搜索和日志查看器以及监控问题。[XpoLog](http://www.xpolog.com)

# sql-server - LINQ to SQL 对象版本控制

> ID：356460
> 
> 赞同：3
> 
> 时间：2008-12-10T15:24:11.273
> 
> 标签：sql-server, vb.net, linq-to-sql

我正在尝试创建一个代表其“最新”版本的 LINQ to SQL 类。

现在，这个实体表示的表有一个自动递增的 ID，我在想我应该给主键添加一个版本号。我从来没有做过这样的事情，所以我不知道如何进行。我希望能够从使用它的人那里抽象出对象版本的想法。换句话说，您有一个代表最新版本的实体的实例，并且无论何时提交任何更改，都会存储该对象的新副本，并带有递增的版本号。

我应该如何处理这个？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-10T17:39:02.890

如果您可以避免保留历史记录，请执行此操作。这是一种痛苦。

如果无法避免完整的历史记录（受监管的财务和医疗数据等），请考虑添加历史记录表。使用触发器“版本”到历史表中。这样，您就不必依赖您的应用程序来确保记录版本 - 无论来源如何，都会捕获所有插入/更新/删除。

如果您的应用需要与历史数据交互，请确保它是只读的。如果有人可以简单地更改它们，那么捕获交易历史是没有意义的。

如果您关心的是并发更新，请考虑使用记录更改时间戳。当用户 A 和用户 B 都在中午查看记录时，他们会获取记录的时间戳。当用户 A 更新记录时，她的时间戳与记录匹配，因此更新通过并且时间戳也被更新。当用户 B 在五分钟后更新记录时，他的时间戳与记录不匹配，因此他收到警告，自上次查看以来记录已更改。也许它会自动重新加载...

无论您做出什么决定，我都会避免将当前数据和历史数据混在一起。

* * *

每个评论触发资源：

*   [MSDN](http://msdn.microsoft.com/en-us/library/ms189799(SQL.90).aspx)
*   [SQL 团队介绍](http://www.sqlteam.com/article/an-introduction-to-triggers-part-i)
*   Stackoverflow 的[Jon Galloway](https://stackoverflow.com/users/5/jon-galloway)描述了一个[通用的数据更改记录触发器](http://weblogs.asp.net/jgalloway/archive/2008/01/27/adding-simple-trigger-based-auditing-to-your-sql-server-database.aspx)

审计触发器的关键是[虚拟表 'inserted' 和 'deleted'](http://msdn.microsoft.com/en-us/library/ms191300(SQL.90).aspx)。这些表包含受 INSERT、UPDATE 或 DELETE 影响的行。您可以使用它们来审核更改。就像是：

```
CREATE TRIGGER tr_TheTrigger
ON [YourTable]
FOR INSERT, UPDATE, DELETE 
AS
    IF EXISTS(SELECT * FROM inserted)
    BEGIN
        --this is an insert or update
        --your actual action will vary but something like this
        INSERT INTO [YourTable_Audit]
            SELECT * FROM inserted
    END
    IF EXISTS(SELECT * FROM deleted)
    BEGIN
        --this is a delete, mark [YourTable_Audit] as required
    END
GO 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-10T15:43:43.840

最好的方法是停下来认真地重新考虑你的方法。

如果要保留不同版本的“对象”，那么最好将其序列化为 xml 格式并将其存储在带有版本号字段的 XML 列中。

尝试在围绕应用程序维护的 sql server 中维护版本化数据时，需要认真考虑。

**每条评论更新：**

这些考虑因素包括：无法在未来的“版本”中删除字段或更改字段的数据类型。新字段必须可以为空，或者至少在数据库中为它们存储一个默认值。因此，您将无法在唯一索引中或作为主键的一部分使用它们。

简而言之，您的应用程序唯一能做的就是扩展。前提是之前的代码层可以忽略扩展。

这是桌面软件制造商多年来一直在努力解决的经典向后兼容性问题。这就是您可能想要远离它的原因。

# c# - DisplayNameAttribute 的本地化

> ID：356464
> 
> 赞同：127
> 
> 时间：2008-12-10T15:25:21.257
> 
> 标签：c#, visual-studio-2008, localization, attributes

我正在寻找一种方法来本地化显示在 PropertyGrid 中的属性名称。可以使用 DisplayNameAttribute 属性“覆盖”属性的名称。不幸的是，属性不能有非常量表达式。所以我不能使用强类型资源，例如：

```
class Foo
{
   [DisplayAttribute(Resources.MyPropertyNameLocalized)]  // do not compile
   string MyProperty {get; set;}
} 
```

我环顾四周，发现了一些从 DisplayNameAttribute 继承的建议，以便能够使用资源。我最终会得到如下代码：

```
class Foo
{
   [MyLocalizedDisplayAttribute("MyPropertyNameLocalized")] // not strongly typed
   string MyProperty {get; set;}
} 
```

但是，我失去了强类型资源的好处，这绝对不是一件好事。然后我遇到了可能是我正在寻找的[DisplayNameResourceAttribute 。](http://msdn.microsoft.com/en-us/library/microsoft.visualstudio.modeling.design.displaynameresourceattribute.aspx)但它应该在 Microsoft.VisualStudio.Modeling.Design 命名空间中，我找不到应该为这个命名空间添加的引用。

有谁知道是否有更简单的方法来以一种好的方式实现 DisplayName 本地化？或者是否有办法使用微软似乎在 Visual Studio 中使用的东西？

* * *

## 回答 #1

> 赞同：119
> 
> 时间：2010-10-06T21:47:31.737

.NET 4 中有来自 System.ComponentModel.DataAnnotations 的[Display 属性](http://msdn.microsoft.com/en-us/library/system.componentmodel.dataannotations.displayattribute.aspx)。它适用于 MVC 3 `PropertyGrid`。

```
[Display(ResourceType = typeof(MyResources), Name = "UserName")]
public string UserName { get; set; } 
```

这会查找文件中命名的`UserName`资源`MyResources.resx`。

* * *

## 回答 #2

> 赞同：80
> 
> 时间：2008-12-10T18:03:04.963

我们正在为许多属性执行此操作以支持多种语言。我们对 Microsoft 采取了类似的方法，它们覆盖其基本属性并传递资源名称而不是实际字符串。然后使用资源名称在 DLL 资源中查找要返回的实际字符串。

例如：

```
class LocalizedDisplayNameAttribute : DisplayNameAttribute
{
    private readonly string resourceName;
    public LocalizedDisplayNameAttribute(string resourceName)
        : base()
    {
      this.resourceName = resourceName;
    }

    public override string DisplayName
    {
        get
        {
            return Resources.ResourceManager.GetString(this.resourceName);
        }
    }
} 
```

在实际使用该属性时，您可以更进一步，并将您的资源名称指定为静态类中的常量。这样，你会得到类似的声明。

```
[LocalizedDisplayName(ResourceStrings.MyPropertyName)]
public string MyProperty
{
  get
  {
    ...
  }
} 
```

**更新**
`ResourceStrings`看起来像（注意，每个字符串都会引用指定实际字符串的资源的名称）：

```
public static class ResourceStrings
{
    public const string ForegroundColorDisplayName="ForegroundColorDisplayName";
    public const string FontSizeDisplayName="FontSizeDisplayName";
} 
```

* * *

## 回答 #3

> 赞同：42
> 
> 时间：2008-12-11T13:37:57.367

这是我最终在一个单独的程序集中得到的解决方案（在我的例子中称为“Common”）：

```
 [AttributeUsage(AttributeTargets.Class | AttributeTargets.Method | AttributeTargets.Property | AttributeTargets.Event)]
   public class DisplayNameLocalizedAttribute : DisplayNameAttribute
   {
      public DisplayNameLocalizedAttribute(Type resourceManagerProvider, string resourceKey)
         : base(Utils.LookupResource(resourceManagerProvider, resourceKey))
      {
      }
   } 
```

使用代码查找资源：

```
 internal static string LookupResource(Type resourceManagerProvider, string resourceKey)
  {
     foreach (PropertyInfo staticProperty in  resourceManagerProvider.GetProperties(BindingFlags.Static | BindingFlags.NonPublic))
     {
        if (staticProperty.PropertyType == typeof(System.Resources.ResourceManager))
        {
           System.Resources.ResourceManager resourceManager = (System.Resources.ResourceManager)staticProperty.GetValue(null, null);
           return resourceManager.GetString(resourceKey);
        }
     }

     return resourceKey; // Fallback with the key name
  } 
```

典型用法是：

```
class Foo
{
      [Common.DisplayNameLocalized(typeof(Resources.Resource), "CreationDateDisplayName"),
      Common.DescriptionLocalized(typeof(Resources.Resource), "CreationDateDescription")]
      public DateTime CreationDate
      {
         get;
         set;
      }
} 
```

当我使用文字字符串作为资源键时，这非常难看。在那里使用常量意味着修改 Resources.Designer.cs 这可能不是一个好主意。

结论：我对此并不满意，但我更不满意微软无法为如此常见的任务提供任何有用的东西。

* * *

## 回答 #4

> 赞同：22
> 
> 时间：2016-09-24T19:36:46.483

使用 C# 6 中的[Display](https://msdn.microsoft.com/en-us/library/system.componentmodel.dataannotations.displayattribute(v=vs.110).aspx)属性（来自 System.ComponentModel.DataAnnotations）和[nameof()](https://msdn.microsoft.com/en-us/library/dn986596.aspx)表达式，您将获得本地化和强类型的解决方案。

```
[Display(ResourceType = typeof(MyResources), Name = nameof(MyResources.UserName))]
public string UserName { get; set; } 
```

* * *

## 回答 #5

> 赞同：14
> 
> 时间：2010-07-22T16:32:24.863

您可以使用 T4 生成常量。我写了一个：

```
<#@ template debug="false" hostspecific="true" language="C#" #>
<#@ output extension=".cs" #>
<#@ assembly name="System.Xml.dll" #>
<#@ import namespace="System.Xml" #>
<#@ import namespace="System.Xml.XPath" #>
using System;
using System.ComponentModel;

namespace Bear.Client
{
 /// <summary>
 /// Localized display name attribute
 /// </summary>
 public class LocalizedDisplayNameAttribute : DisplayNameAttribute
 {
  readonly string _resourceName;

  /// <summary>
  /// Initializes a new instance of the <see cref="LocalizedDisplayNameAttribute"/> class.
  /// </summary>
  /// <param name="resourceName">Name of the resource.</param>
  public LocalizedDisplayNameAttribute(string resourceName)
   : base()
  {
   _resourceName = resourceName;
  }

  /// <summary>
  /// Gets the display name for a property, event, or public void method that takes no arguments stored in this attribute.
  /// </summary>
  /// <value></value>
  /// <returns>
  /// The display name.
  /// </returns>
  public override String DisplayName
  {
   get
   {
    return Resources.ResourceManager.GetString(this._resourceName);
   }
  }
 }

 partial class Constants
 {
  public partial class Resources
  {
  <# 
   var reader = XmlReader.Create(Host.ResolvePath("resources.resx"));
   var document = new XPathDocument(reader);
   var navigator = document.CreateNavigator();
   var dataNav = navigator.Select("/root/data");
   foreach (XPathNavigator item in dataNav)
   {
    var name = item.GetAttribute("name", String.Empty);
  #>
   public const String <#= name#> = "<#= name#>";
  <# } #>
  }
 }
} 
```

* * *

## 回答 #6

> 赞同：9
> 
> 时间：2011-08-04T15:30:31.090

这是一个老问题，但我认为这是一个非常普遍的问题，这是我在 MVC 3 中的解决方案。

首先，需要一个 T4 模板来生成常量以避免讨厌的字符串。我们有一个资源文件“Labels.resx”包含所有标签字符串。因此T4模板直接使用资源文件，

```
<#@ template debug="True" hostspecific="True" language="C#" #>
<#@ output extension=".cs" #>
<#@ Assembly Name="C:\Project\trunk\Resources\bin\Development\Resources.dll" #>
<#@ import namespace="System.Collections.Generic" #>
<#@ import namespace="System.Collections" #>
<#@ import namespace="System.Globalization" #>
<#@ import namespace="System" #>
<#@ import namespace="System.Resources" #>
<#
  var resourceStrings = new List<string>();
  var manager = Resources.Labels.ResourceManager;

  IDictionaryEnumerator enumerator = manager.GetResourceSet(CultureInfo.CurrentCulture,  true, true)
                                             .GetEnumerator();
  while (enumerator.MoveNext())
  {
        resourceStrings.Add(enumerator.Key.ToString());
  }
#>     

// This file is generated automatically. Do NOT modify any content inside.

namespace Lib.Const{
        public static class LabelNames{
<#
            foreach (String label in resourceStrings){
#>                    
              public const string <#=label#> =     "<#=label#>";                    
<#
           }    
#>
    }
} 
```

然后，创建一个扩展方法来本地化“DisplayName”，

```
using System.ComponentModel.DataAnnotations;
using Resources;

namespace Web.Extensions.ValidationAttributes
{
    public static class ValidationAttributeHelper
    {
        public static ValidationContext LocalizeDisplayName(this ValidationContext    context)
        {
            context.DisplayName = Labels.ResourceManager.GetString(context.DisplayName) ?? context.DisplayName;
            return context;
        }
    }
} 
```

'DisplayName' 属性被 'DisplayLabel' 属性替换，以便自动从 'Labels.resx' 中读取，

```
namespace Web.Extensions.ValidationAttributes
{

    public class DisplayLabelAttribute :System.ComponentModel.DisplayNameAttribute
    {
        private readonly string _propertyLabel;

        public DisplayLabelAttribute(string propertyLabel)
        {
            _propertyLabel = propertyLabel;
        }

        public override string DisplayName
        {
            get
            {
                return _propertyLabel;
            }
        }
    }
} 
```

在所有这些准备工作之后，是时候接触那些默认的验证属性了。我以“必需”属性为例，

```
using System.ComponentModel.DataAnnotations;
using Resources;

namespace Web.Extensions.ValidationAttributes
{
    public class RequiredAttribute : System.ComponentModel.DataAnnotations.RequiredAttribute
    {
        public RequiredAttribute()
        {
          ErrorMessageResourceType = typeof (Errors);
          ErrorMessageResourceName = "Required";
        }

        protected override ValidationResult IsValid(object value, ValidationContext  validationContext)
        {
            return base.IsValid(value, validationContext.LocalizeDisplayName());
        }

    }
} 
```

现在，我们可以在我们的模型中应用这些属性，

```
using Web.Extensions.ValidationAttributes;

namespace Web.Areas.Foo.Models
{
    public class Person
    {
        [DisplayLabel(Lib.Const.LabelNames.HowOldAreYou)]
        public int Age { get; set; }

        [Required]
        public string Name { get; set; }
    }
} 
```

默认情况下，属性名称用作查找“Label.resx”的键，但如果您通过“DisplayLabel”设置它，它将改用它。

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2008-12-10T15:45:36.627

您可以通过重写其中一种方法来继承 DisplayNameAttribute 以提供 i18n。像这样。**编辑：**您可能不得不接受使用常量作为键。

```
using System;
using System.ComponentModel;
using System.Windows.Forms;

class Foo {
    [MyDisplayName("bar")] // perhaps use a constant: SomeType.SomeResName
    public string Bar {get; set; }
}

public class MyDisplayNameAttribute : DisplayNameAttribute {
    public MyDisplayNameAttribute(string key) : base(Lookup(key)) {}

    static string Lookup(string key) {
        try {
            // get from your resx or whatever
            return "le bar";
        } catch {
            return key; // fallback
        }
    }
}

class Program {
    [STAThread]
    static void Main() {
        Application.Run(new Form { Controls = {
            new PropertyGrid { SelectedObject =
                new Foo { Bar = "abc" } } } });
    }
} 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2015-01-12T15:04:04.437

我用这种方式解决我的情况

```
[LocalizedDisplayName("Age", NameResourceType = typeof(RegistrationResources))]
 public bool Age { get; set; } 
```

用代码

```
public sealed class LocalizedDisplayNameAttribute : DisplayNameAttribute
{
    private PropertyInfo _nameProperty;
    private Type _resourceType;

    public LocalizedDisplayNameAttribute(string displayNameKey)
        : base(displayNameKey)
    {

    }

    public Type NameResourceType
    {
        get
        {
            return _resourceType;
        }
        set
        {
            _resourceType = value;
            _nameProperty = _resourceType.GetProperty(base.DisplayName, BindingFlags.Static | BindingFlags.Public);
        }
    }

    public override string DisplayName
    {
        get
        {
            if (_nameProperty == null)
            {
                return base.DisplayName;
            }

            return (string)_nameProperty.GetValue(_nameProperty.DeclaringType, null);
        }
    }

} 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-12-10T15:36:03.183

好吧，大会是`Microsoft.VisualStudio.Modeling.Sdk.dll`。它带有 Visual Studio SDK（带有 Visual Studio 集成包）。

但它的使用方式与您的属性几乎相同；仅仅因为它们不是常量，就无法在属性中使用强类型资源。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-12-10T15:47:06.593

我为 VB.NET 代码道歉，我的 C# 有点生疏……但你会明白的，对吧？

首先，创建一个新类：`LocalizedPropertyDescriptor`，它继承`PropertyDescriptor`. 像这样覆盖`DisplayName`属性：

```
Public Overrides ReadOnly Property DisplayName() As String
         Get
            Dim BaseValue As String = MyBase.DisplayName
            Dim Translated As String = Some.ResourceManager.GetString(BaseValue)
            If String.IsNullOrEmpty(Translated) Then
               Return MyBase.DisplayName
            Else
               Return Translated
           End If
    End Get
End Property 
```

`Some.ResourceManager`是包含您的翻译的资源文件的 ResourceManager。

接下来，`ICustomTypeDescriptor`在具有本地化属性的类中实现，并覆盖该`GetProperties`方法：

```
Public Function GetProperties() As PropertyDescriptorCollection Implements System.ComponentModel.ICustomTypeDescriptor.GetProperties
    Dim baseProps As PropertyDescriptorCollection = TypeDescriptor.GetProperties(Me, True)
    Dim LocalizedProps As PropertyDescriptorCollection = New PropertyDescriptorCollection(Nothing)

    Dim oProp As PropertyDescriptor
    For Each oProp In baseProps
        LocalizedProps.Add(New LocalizedPropertyDescriptor(oProp))
    Next
    Return LocalizedProps
End Function 
```

您现在可以使用“DisplayName”属性来存储对资源文件中值的引用...

```
<DisplayName("prop_description")> _
Public Property Description() As String 
```

`prop_description`是资源文件中的键。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2020-12-19T13:07:28.953

显示名称：

```
 public sealed class LocalizedDisplayNameAttribute : DisplayNameAttribute
{
    public string ResourceKey { get; }
    public string BaseName { get; set; }
    public Type ResourceType { get; set; }

    public LocalizedDisplayNameAttribute(string resourceKey)
    {
        ResourceKey = resourceKey;
    }

    public override string DisplayName
    {
        get
        {
            var baseName = BaseName;
            var assembly = ResourceType?.Assembly ?? Assembly.GetEntryAssembly();

            if (baseName.IsNullOrEmpty())
            {
                // ReSharper disable once PossibleNullReferenceException
                baseName = $"{(ResourceType != null ? ResourceType.Namespace : assembly.GetName().Name)}.Resources";
            }

            // ReSharper disable once AssignNullToNotNullAttribute
            var res = new ResourceManager(baseName, assembly);

            var str = res.GetString(ResourceKey);

            return string.IsNullOrEmpty(str)
                ? $"[[{ResourceKey}]]"
                : str;
        }
    }
} 
```

描述：

```
public sealed class LocalizedDescriptionAttribute : DescriptionAttribute
{
    public string ResourceKey { get; }
    public string BaseName { get; set; }
    public Type ResourceType { get; set; }

    public LocalizedDescriptionAttribute(string resourceKey)
    {
        ResourceKey = resourceKey;
    }

    public override string Description
    {
        get
        {
                var baseName = BaseName;
                var assembly = ResourceType?.Assembly ?? Assembly.GetEntryAssembly();

                if (baseName.IsNullOrEmpty())
                {
                    // ReSharper disable once PossibleNullReferenceException
                    baseName = $"{(ResourceType != null ? ResourceType.Namespace : assembly.GetName().Name)}.Resources";
                }

                // ReSharper disable once AssignNullToNotNullAttribute
                var res = new ResourceManager(baseName, assembly);
                var str = res.GetString(ResourceKey);

                return string.IsNullOrEmpty(str)
                    ? $"[[{ResourceKey}]]"
                    : str;
        }
    }
} 
```

类别（PropertyGrid）：

```
 public sealed class LocalizedCategoryAttribute : CategoryAttribute
{
    public string ResourceKey { get; }
    public string BaseName { get; set; }
    public Type ResourceType { get; set; }

    public LocalizedCategoryAttribute(string resourceKey) 
        : base(resourceKey)
    {
        ResourceKey = resourceKey;
    }

    protected override string GetLocalizedString(string resourceKey)
    {
        var baseName = BaseName;
        var assembly = ResourceType?.Assembly ?? Assembly.GetEntryAssembly();

        if (baseName.IsNullOrEmpty())
        {
            // ReSharper disable once PossibleNullReferenceException
            baseName = $"{(ResourceType != null ? ResourceType.Namespace : assembly.GetName().Name)}.Resources";
        }

        // ReSharper disable once AssignNullToNotNullAttribute
        var res = new ResourceManager(baseName, assembly);
        var str = res.GetString(resourceKey);

        return string.IsNullOrEmpty(str)
            ? $"[[{ResourceKey}]]"
            : str;
    }
} 
```

例子： `[LocalizedDisplayName("ResourceKey", ResourceType = typeof(RE))]`

“RE”存在于包含资源文件的程序集中，例如“Resources.de.resx”或“Resources.en.resx”。

适用于枚举和属性。

干杯

# image - 将 CMYK 转换为 RGB 的首选库和/或方法

> ID：356465
> 
> 赞同：1
> 
> 时间：2008-12-10T15:25:28.027
> 
> 标签：image, scripting, imagemagick, cmyk

每个月我都会收到新的 CMYK 和 RGB 图像，这些图像将在网络上使用。

我有一个使用修补过的 ImageMagick 执行此操作的脚本，但它被删除了。所以我需要再做一次，但上次很难。

如何*轻松*快速地将 CMYK 图像文件转换为 RGB？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-18T22:52:21.357

像这样：

```
convert CMYK.tiff -profile "RGB.icc" RGB.tiff 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-04-12T10:58:55.197

> 转换 cmyk_image.jpg -colorspace rgb rgb_image.jpg

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-07-14T08:14:24.493

gb1981的答案基本上是正确的（+1），但是……

为了使它工作可靠，我发现我必须添加`-type truecolor`到命令行：

```
convert cmyk.jpg -colorspace rgb -type truecolor rgb.jpg 
```

# c# - C#从字符串中提取名称

> ID：356480
> 
> 赞同：3
> 
> 时间：2008-12-10T15:31:22.973
> 
> 标签：c#, regex, string

我想从下面的字符串中提取 'James\, Brown' 但我并不总是知道名字是什么。逗号让我有些困惑，那么您建议如何提取 James\，Brown？

OU=James\, Brown,OU=Test,DC=Internal,DC=Net

谢谢

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-10T15:43:37.443

正则表达式可能是您最好的方法

```
static string ParseName(string arg) {
    var regex = new Regex(@"^OU=([a-zA-Z\\]+\,\s+[a-zA-Z\\]+)\,.*$");
    var match = regex.Match(arg);
    return match.Groups[1].Value;
} 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-10T15:49:59.740

您可以使用正则表达式：

```
string input = @"OU=James\, Brown,OU=Test,DC=Internal,DC=Net";
Match m = Regex.Match(input, "^OU=(.*?),OU=.*$");
Console.WriteLine(m.Groups[1].Value); 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-10T15:36:38.813

一个非常脆弱的方法可能是......

```
string name = @"OU=James\, Brown,OU=Test,DC=Internal,DC=Net";
string[] splitUp = name.Split("=".ToCharArray(),3);
string namePart = splitUp[1].Replace(",OU","");
Console.WriteLine(namePart); 
```

我不一定会提倡这种方法，但我刚从部门圣诞午餐回来，我的大脑还没有完全投入。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-10T16:03:08.573

我将从一个正则表达式开始拆分组：

```
 Regex rx = new Regex(@"(?<!\\),");
    String test = "OU=James\\, Brown,OU=Test,DC=Internal,DC=Net";
    String[] segments = rx.Split(test); 
```

但是从那里我将通过手动拆分数组中的参数来拆分它们，这样您就不必使用依赖于所用分隔符以外的正则表达式。由于这看起来像一个 LDAP 查询，因此您是否总是查看 params[0] 可能无关紧要，但有可能将名称设置为“CN=”。您可以通过阅读这样的查询来涵盖这两种情况：

```
 String name = segments[0].Split('=', 2)[1]; 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-10T16:14:00.330

这看起来很像根据[RFC 2253](http://www.ietf.org/rfc/rfc2253.txt) / [4514](http://www.ietf.org/rfc/rfc4514.txt)格式化的 LDAP 或 Active Directory 专有名称。

除非您使用的是众所周知的名称和/或对脆弱的hackaround（如正则表达式解决方案）没问题 - 那么您应该从阅读规范开始。

如果你和我一样，通常讨厌根据 RFC 实现代码 - 那么希望[这个人](http://www.codeproject.com/KB/IP/dnparser.aspx)在遵循规范方面做得比你做得更好。至少他*声称*符合 2253 标准。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-10T15:35:49.660

如果格式始终相同：

```
string line = GetStringFromWherever();

int start = line.IndexOf("=") + 1;//+1 to get start of name
int end = line.IndexOf("OU=",start) -1; //-1 to remove comma

string name = line.Substring(start, end - start); 
```

如果语法不完全正确，请原谅 - 从记忆中。显然，如果格式发生变化，这不是很健壮并且会失败。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-10T15:47:40.883

如果斜线始终存在，我会考虑使用 RegEx 进行匹配，您可以使用匹配组来表示姓氏和名字。

^OU=([a-zA-Z] *)\,\s([a-zA-Z]* )

该 RegEx 将匹配仅包含字符的名称，您需要对其进行一些改进以便更好地匹配非标准名称。 如果你走这条路，[这里有一个 RegEx 测试器可以帮助你。](http://www.iowacomputergurus.com/free-products/regular-expression-tester.aspx)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-10T16:27:01.053

用您自己喜欢的魔法字符串（可能是 & #44;）替换 \，拆分剩余的逗号或搜索到第一个逗号，然后用单个逗号替换您的魔法字符串。

即类似的东西：

```
string originalStr = @"OU=James\, Brown,OU=Test,DC=Internal,DC=Net";
string replacedStr = originalStr.Replace("\,", "&#44;");

string name = replacedStr.Substring(0, replacedStr.IndexOf(","));
Console.WriteLine(name.Replace("&#44;", ",")); 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2012-11-21T13:49:30.260

假设您在 Windows 中运行，请将 PInvoke 与[`DsUnquoteRdnValueW`](http://msdn.microsoft.com/en-us/library/windows/desktop/ms676054(v=vs.85).aspx). 有关代码，请参阅我对另一个问题的回答：[https ://stackoverflow.com/a/11091804/628981](https://stackoverflow.com/a/11091804/628981)

# eclipse - 日食颜色

> ID：356482
> 
> 赞同：3
> 
> 时间：2008-12-10T15:32:42.270
> 
> 标签：eclipse, colors, syntax-highlighting

我使用 eclipse 几个月了，我真的更喜欢 gvim，但是 eclipse 使用 pydev 和 phpeclipse 让我的生活更轻松。一切都很好，我有一个黑色的 Fluxbox 和黑色的 GTK 主题，我已经更改了 py 和 php 的语法颜色，现在一切都是深色背景，浅色前景（包括 eclipse 菜单/边框/等），非常好。

但是.. 我找不到更改 html 文件的语法颜色的方法。真的很糟糕，偶尔我会想在eclipse中打开一个html文件并且标准文本是黑色的（和我的背景一样）。我已经更改了我能找到的所有与背景相关的颜色设置，但 html 编辑器的颜色没有改变。我错过了什么吗？有谁知道如何改变这个？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-10T15:48:20.583

您需要安装[WTP](http://www.eclipse.org/webtools/)插件来添加所有 HTML/JS/CSS 支持。

我还建议使用[PDT](http://www.eclipse.org/pdt/)插件来满足您的所有 PHP 需求。

安装这些插件后.. 您应该能够在 Window>Preferences... 中访问它们的属性。

希望这可以帮助 ：）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-12T20:54:02.330

对于可能不熟悉 Eclipse 首选项的其他人，您可以在以下位置找到这些颜色设置中的大部分（一旦您安装了此处提到的插件）：

首选项 > 文本编辑器 > 外观颜色选项

和

首选项 > 外观 > 颜色和字体

不要忘记使用 Eclipse 首选项窗格中内置的搜索功能来查找您尝试修改的确切元素。

# python - Python正则表达式查找所有数字和点

> ID：356483
> 
> 赞同：11
> 
> 时间：2008-12-10T15:33:09.600
> 
> 标签：python, regex, findall

我正在使用 re.findall() 从 HTML 文件中提取一些版本号：

```
>>> import re
>>> text = "<table><td><a href=\"url\">Test0.2.1.zip</a></td><td>Test0.2.1</td></table> Test0.2.1"
>>> re.findall("Test([\.0-9]*)", text)
['0.2.1.', '0.2.1', '0.2.1'] 
```

但我只想得到那些不以点结尾的。文件名可能并不总是 .zip，所以我不能只将 .zip 粘贴在正则表达式中。

我想结束：

```
['0.2.1', '0.2.1'] 
```

任何人都可以建议使用更好的正则表达式吗？:)

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-12-10T15:36:07.800

```
re.findall(r"Test([0-9.]*[0-9]+)", text) 
```

或者，更短一点：

```
re.findall(r"Test([\d.]*\d+)", text) 
```

顺便说一句 - 您不需要在字符类中转义点。里面`[]`没有`.`特殊含义，它只是匹配一个字面点。逃避它没有任何效果。

# asp.net - 如何在 IIS 中为我 的网站关闭自定义错误处理？

> ID：356484
> 
> 赞同：4
> 
> 时间：2008-12-10T15:33:23.797
> 
> 标签：asp.net, error-handling, web-config

您甚至如何查看 web.config 文件？我不知道去哪里关闭自定义错误...帮助！

我尝试了命令提示符和 java 脚本....任何人都可以帮助我吗？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2012-06-18T18:22:20.277

请记住，IIS 错误和 asp.net 错误是两个不同的东西，

对于远程请求，默认情况下 IIS 启用了自定义错误，这意味着如果您从应用程序返回 none 200 响应，IIS 将丢弃您发送回的正文并将其替换为自己的自定义页面。如果您托管的 REST 服务需要以 json 或 XML 形式向客户端返回错误详细信息，这可能会非常麻烦。

要关闭 ASP.net 自定义错误，请使用[customErrors 元素（ASP.NET 设置架构）](https://msdn.microsoft.com/en-gb/library/h0hfz6fc(v=vs.85).aspx)

关闭 IIS 自定义错误使用[IIS HTTP 错误 httpErrors](http://www.iis.net/ConfigReference/system.webServer/httpErrors)

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-12-10T15:47:24.737

从“管理工具”运行 Internet 信息服务 (IIS) 管理器工具（如果在开始菜单中启用了管理工具）。打开系统，然后右键单击您的网站。选择属性。选择 ASP.NET 选项卡。单击“编辑配置”。单击自定义错误选项卡。选择`Off`自定义错误模式。

或者导航到包含您的应用程序的文件夹并在文本编辑器中打开 web.config 文件并手动编辑，然后将自定义错误标记更改为 <customErrors mode="Off" />。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-12-10T15:54:03.117

根据[MSDN 文档](http://msdn.microsoft.com/en-us/library/h0hfz6fc.aspx)，模式的有效值为：

**On**：*指定启用自定义错误。如果未指定 defaultRedirect 属性，用户会看到一般错误。自定义错误会显示给远程客户端和本地主机。*

**Off** *指定禁用自定义错误。详细的 ASP.NET 错误会显示给远程客户端和本地主机。*

**RemoteOnly** *指定仅向远程客户端显示自定义错误，并向本地主机显示 ASP.NET 错误。这是默认值。*

默认值为 RemoteOnly。

# prototype - 如何在 Visio 图表中实现手绘外观？

> ID：356487
> 
> 赞同：3
> 
> 时间：2008-12-10T15:33:50.427
> 
> 标签：prototype, visio

我想做一个网站的原型。是否有任何 visio 模板可以为原型提供手绘外观？我找到了一个这样的模板，它的形状很少，但这些还不足以轻松创建原型：

[http://www.visguy.com/2008/08/20/indexed-shapes-for-that-hand-drawn-look/](http://www.visguy.com/2008/08/20/indexed-shapes-for-that-hand-drawn-look/)

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-10T15:38:10.713

你应该看看[Balsamiq Mockups](http://www.balsamiq.com/products/mockups) - 太棒了！

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2013-05-28T16:02:21.280

我已经构建了一组“手绘”控件形状的 visio 模板，主要用于 winforms 应用程序，但也用于具有表单感觉的 Web 应用程序（文本框、组合、复选框、列表、树等）。我计划未来更多的形状，请随时通过 github 发送请求。

[https://github.com/ICornwell/Visio.Handdrawn.Wireframes](https://github.com/ICornwell/Visio.Handdrawn.Wireframes)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-10T15:43:43.293

看起来不错，但我认为我不能向我的雇主证明购买的合理性。Visio 附带 MSDN 订阅，所以有一个模板会很好

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2013-10-28T14:53:36.287

你最好的选择是 balsamiq，这是表达你的想法的最佳视觉方式

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2008-12-10T15:50:41.750

铅笔、纸、剪刀和 Pritt-Stick 和扫描仪。

这真的是你应该花雇主的钱做的事吗？

# pdf - 如何在 PDF 之上进行邮件合并？

> ID：356502
> 
> 赞同：13
> 
> 时间：2008-12-10T15:38:41.277
> 
> 标签：pdf, pdf-generation, mailmerge, adobe-indesign

我经常从我们的设计师（内置于 Adob​​e InDesign）那里得到一个 PDF，它应该发送给成千上万的人。

我有所有人的名单，在 OpenOffice.org 中进行邮件合并很容易。但是，OpenOffice.org 不支持高级 PDF。我只想在每一页上输出一些文本并打印出来。

我现在是这样做的：打印出 6.000 份 PDF，然后将它们全部重新放入打印机，然后在上面打印出姓名、地址和其他信息。但这很昂贵。

可悲的是，我无法将 PDF 制作成图像并在 OpenOffice.org 中使用它，因为它会使计算机停止运行。将此作业发送到打印机也需要很长时间。

那么，有没有一种简单的方法可以在不支付第三方封闭解决方案的情况下进行这种邮件合并（最好在 Python 中）？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-09-28T01:32:11.853

现在我已经开户了。我使用巧妙的 pdftk 修复了它。

在我的任务中，我完全忽略了“背景”和“叠加”功能。我的解决方案是这样的：

```
pdftk names.pdf background boat_background.pdf output out.pdf 
```

使用 Python reportlab 或类似的 PDF创建`names.pdf`脚本可以轻松创建。最好使用代码来做到这一点，在 LibreOffice/OpenOffice 中创建 6k 页面需要几个小时，而使用 Python 只需要几秒钟。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-07-05T23:34:57.963

有两种更简单、更便宜的解决方案。

首先，您可以使用 DataMerge 在 InDesign 中直接进行邮件合并。这是在 CS 中添加到 InDesign 的实用程序。您以 CSV 格式导出或保存您的姓名。将数据导入 InDesign 模板，然后将您的姓名、地址和布局中的此类字段放入其中。按开始。它将创建一个包含所有已完成字母的新文档，或者您可以直接进入打印机。

或者，您可以将数据导出到 XML 文件并在 InDesign 中使用 XML 占位符创建动态布局。

Adobe InDesign 和 XML 设计师指南一书将教您如何做到这一点，或者您可以查看 Lynda.com 视频，了解 InDesign 和 XML 的动态工作流程。

很容易做到。

如果您想为邮件合并创建单独的 PDF 文件，您可以用一个文件中的所有名称运行一个长 PDF，然后在 Acrobat Pro 本身中执行提取以分离 PDF 文件。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-10T15:48:19.603

您可能会查看像[iText](http://www.lowagie.com/iText/)这样的 PDF 库。如果您有一些编程知识和一点时间，您可以编写一些代码，将联系信息添加到 PDF

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-10T17:17:54.103

对于一个没有混乱，没有大惊小怪的解决方案，使用 iText 将文本简单地添加到 pdf 中。例如，您可以执行以下操作以在加载后将文本添加到 pdf 文档：

```
PdfContentByte cb= ...;
cb.BeginText();
cb.SetFontAndSize(font, fontSize);
float x = ...;
float y = ...;
cb.SetTextMatrix(x, y);
cb.ShowText(fieldValue);
cb.EndText(); 
```

从那里开始，将其另存为不同的文件，然后打印。

但是，我发现表单字段是从模板生成 pdf 文档的方法。

如果您有一个带有表单域的模板（使用 Adob​​e Acrobat 添加），您有以下两种选择之一：

*   创建一个 FDF 文件，它本质上是表单上字段的值列表。FDF 是一个简单的文本文档，它引用原始文档，因此当您打开 PDF 时，文档会加载 FDF 提供的字段值。
*   或者，使用 iText / iTextSharp 之类的库加载模板，手动填写表单字段，然后将其保存为单独的 pdf。

示例 FDF 文件如下所示（从[Planet PDF](http://www.planetpdf.com/developer/article.asp?ContentID=developing_with_pdf_forms&gid=6623)窃取）：

```
%FDF-1.2
%âãÏÓ
1 0 obj
<<<
 /F(Example PDF Form.pdf)
 /Fields[
  <<
  /T(myTextField)
  /V(myTextField default value)
  >>
  ]
 >>
>> endobj trailer
<>
%%EOF 
```

由于 FDF 的简单格式和小尺寸，这是首选方法，并且该方法应该适用于任何语言。

至于以编程方式填充字段，您可以通过以下方式使用 iText：

```
PdfAcroForm acroForm = writer.AcroForm;
acroForm.Put(new PdfName(fieldInfo.Name), new PdfString(fieldInfo.Value)); 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-10T15:49:34.123

如果您无法以 PDF 以外的其他格式获取模板，则一个简单的临时解决方案是

*   将 PDF 转换为图像
*   将图像放在 (OpenOffice.org) 文档的背景中
*   将邮件合并字段放在图像顶部
*   做邮件合并和打印

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-10T16:36:51.110

可能最好的方法是生成另一个带有缺失文本的 PDF，并将一个 PDF 覆盖在另一个上。快速谷歌发现这个链接显示如何在 Acrobat 中执行此操作，我相信还有其他方法。

[http://forums.macrumors.com/showthread.php?t=508226](http://forums.macrumors.com/showthread.php?t=508226)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2011-12-17T21:15:30.370

如何使用可变数据程序，例如 Adob​​e Indesign 的 XMPie。这是一个应该引用您的人员列表的插件（尽管认为它可能必须是 Excel 中的列表）。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2019-07-31T16:53:47.357

有人询问具体情况。我不想用它来玷污我的最佳答案，因为您可以按照自己的喜好进行操作（只要知道 pdftk 由它决定就应该给人们这个想法）。

但这是我多年前使用的一些脚本：

`csv_to_pdf.py`

```
#!/usr/bin/python
# This makes one PDF page per name in the CSV file
# csv_to_pdf.py <CSV_FILE>

import csv
import sys
from reportlab.pdfgen.canvas import Canvas
from reportlab.lib.units import cm, mm

in_db = csv.reader(open(sys.argv[1], "rb"));
outname = sys.argv[1].replace("csv", "pdf")
pdf = Canvas(outname)
in_db.next()

i = 0
for rad in in_db:
        pdf.setFontSize(11)
        adr = rad[1]

        tekst = pdf.beginText(2*cm, 26*cm)

        for a in adr.split('\n'):
            if not a.strip():
                continue
            if a[-1] == ',':
                a = a[:-1]
            tekst.textLine(a)
        pdf.drawText(tekst)
        pdf.showPage()

        i += 1
        if i % 1000 == 0:
                print i
pdf.save() 
```

运行此程序后，您将拥有一个包含数千页的文件，其中只有一个名称。这是您可以在所有这些下放置精美 PDF 的背景：

```
pdftk <YOUR_NEW_PDF_FILE.pdf> background <DESIGNED_FILE.pdf> <MERGED.pdf> 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2019-07-19T15:28:24.923

一种简单的方法是从 Acrobat 中的原始文档创建一个可填写的 pdf 表单，并与表单和 csv 进行邮件合并。

[PDF 邮件合并在 python 和pdftk](https://www.pdflabs.com/tools/pdftk-the-pdf-toolkit/)中相对容易。Fdfgen ( `pip install fdfgen`) 是一个 python 库，它将从 python 数组创建 fdf，因此您可以将 excel 网格保存到 csv，确保 csv 标题与您要填充该列的 pdf 表单字段的名称匹配，并做类似的事情

```
import csv
import subprocess

from fdfgen import forge_fdf

PDF_FORM = 'path/to/form.pdf'
CSV_DATA = 'path/to/data.csv'

infile = open(CSV_DATA, 'rb')
reader = csv.DictReader(infile)
rows = [row for row in reader]
infile.close()

for row in rows:
    # Create fdf
    filename = row['filename'] # Construct filename
    fdf_data = [(k,v) for k, v in row.items()]
    fdf = forge_fdf(fdf_data_strings=fdf_data)
    fdf_file = open(filename+'.fdf', 'wb')
    fdf_file.write(fdf)
    fdf_file.close()

    # Use PDFTK to create filled, flattened, pdf file
    cmds = ['pdftk', PDF_FORM, 'fill_form', filename+'.fdf',
            'output', filename+'.pdf', 'flatten', 'dont_ask']
    process = subprocess.Popen(cmds, stdout=subprocess.PIPE)
    stdout, stderr = process.communicate()
    returncode = process.poll()
    os.remove(filename+'.fdf') 
```

我已经遇到了足够多的问题来编写我自己的免费解决方案[PdfZero](https://www.pdfzero.com)。PdfZero 具有邮件合并功能，可将电子表格与 PDF 表单合并。您仍然需要创建一个 PDF 表单，但您可以将表单和 csv 上传到 pdfzero，选择要填充哪些列的表单字段，如果需要，使用 csv 数据为每个填充的 pdf 创建命名约定，然后批量生成填充的 PDfs。

**免责声明：我写了 PdfZero**

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2015-05-18T05:34:11.500

您可以使用 InDesign 的数据合并功能，或者您可以执行您一直在做的事情，打印一部分作业，然后使用 Word 或 Open Office 在其上打印邮件合并。但也要考虑寻找一家可以进行可变数据胶印或动态出版的公司。前期可能会贵一点，但在时间、测试、甚至包装和邮寄方面可以节省一大笔钱。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2017-01-25T00:10:37.357

**免责声明**：我是这个工具的作者。

我遇到这个问题的次数足够多，为此我构建了一个免费的在线工具：[https ://pdfbatchfill.com/](https://pdfbatchfill.com/)

它假定 PDF 表单作为模板，并将其与 CSV 表单数据一起使用以生成单个 PDF 或 zip 文件中的单个 PDF。

# delphi - TService 不会处理消息

> ID：356506
> 
> 赞同：1
> 
> 时间：2008-12-10T15:39:53.223
> 
> 标签：delphi, windows-services, windows-messages

我创建了一个使用 Windows 消息系统的 Windows 服务。当我从调试器测试应用程序时，消息很好地通过，但是当我安装它时，我的消息... 14 分钟前问

弗拉基米尔 1tuga

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-10T16:44:57.240

服务通常不接收窗口消息。它们根本不一定有窗把手。即使他们这样做，它们也会在单独的桌面上运行。程序无法从一个桌面向另一个桌面发送消息，因此服务只能接收来自另一个服务或由服务启动的程序的消息。

在 Windows Vista 之前，您可以将服务配置为与桌面交互。这使得服务与登录用户在同一桌面上运行，因此以该用户身份运行的程序可以将消息发送到服务的窗口。不过，Windows Vista 隔离了服务；他们不能再与任何用户的桌面交互。

还有许多其他方式与服务进行通信。它们包括命名管道、邮槽、内存映射文件、信号量、事件和套接字。

例如，使用套接字，您的服务可以侦听打开的端口，并且需要与其通信的程序可以连接到该端口。这可能会打开远程管理的大门，但您也可以将服务限制为仅侦听本地连接。

以上所有内容都试图告诉您您采取了错误的方法。但也有手头的问题。您的程序在调试器中以一种方式运行，而在调试器外部以另一种方式运行。如果未安装，您首先如何调试该服务？您的服务以什么用户帐户运行？你的调试器？您尝试过哪些不涉及调试器的调试技术（例如`writeln`，使用日志文件跟踪程序的操作）？

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-12-10T16:37:55.260

当您说它“使用”Windows 消息系统时，您是什么意思？您是否正在使用或发送 Windows 消息？

如果您发送 Windows 消息，您需要确保正确执行。我建议编写一个消息循环以确保您的消息被正确发送。我还建议阅读消息循环及其工作原理。

[**什么是消息循环**](http://www.winprog.org/tutorial/message_loop.html)（单击标题以转到此信息的来源）

```
while(GetMessage(&Msg, NULL, 0, 0) > 0)
{
    TranslateMessage(&Msg);
    DispatchMessage(&Msg);
} 
```

1.  消息循环调用 GetMessage()，它在您的消息队列中查找。如果消息队列为空，您的程序基本上会停止并等待一个（它阻塞）。
2.  当发生事件导致消息被添加到队列时（例如系统注册鼠标单击） GetMessages() 返回一个正值，表示有消息要处理，并且它已经填充了 MSG 的成员结构我们通过了它。如果命中 WM_QUIT 则返回 0，如果发生错误则返回负值。
3.  我们获取消息（在 Msg 变量中）并将其传递给 TranslateMessage()，这会进行一些额外的处理，将虚拟键消息转换为字符消息。这一步实际上是可选的，但如果它不存在，某些事情将无法工作。
4.  完成后，我们将消息传递给 DispatchMessage()。DispatchMessage() 所做的是获取消息，检查它是针对哪个窗口的，然后查找该窗口的窗口过程。然后它调用该过程，将窗口句柄、消息以及 wParam 和 lParam 作为参数发送。
5.  在您的窗口过程中，您检查消息及其参数，然后对它们做任何您想做的事情！如果您不处理特定消息，您几乎总是调用 DefWindowProc() 它将为您执行默认操作（这通常意味着它什么都不做）。
6.  处理完消息后，您的 windows 过程返回，DispatchMessage() 返回，然后我们回到循环的开头。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-10T18:21:59.307

谢谢大家的回答，问题是操作系统（vista），我用我的windows 2000测试过，一切正常。

谢谢你的光罗。

# javascript - 有没有办法在框架中打开链接并禁止外部站点上的所有弹出窗口？

> ID：356512
> 
> 赞同：0
> 
> 时间：2008-12-10T15:41:32.080
> 
> 标签：javascript

我想知道是否可以在框架中（或通过其他方式）打开指向另一个站点的链接，并抑制在外部站点上加载的 1-2 个弹出窗口。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-10T15:47:17.640

我不认为有一个简单的方法来实现这一点。您最好的选择是让您的服务器上的一个页面充当从其他站点获取页面的代理，然后修改您返回的 html 以删除弹出窗口。这不是一件容易的事，但有可能。作为 POC，您可以通过查找它们打开的页面 url 来明确定位您知道的弹出窗口。

# .net - 应用程序恢复

> ID：356515
> 
> 赞同：2
> 
> 时间：2008-12-10T15:42:19.317
> 
> 标签：.net, windows-vista

您是否在 vista 中使用过应用程序恢复 API？

[http://msdn.microsoft.com/en-us/library/aa373347(VS.85).aspx](http://msdn.microsoft.com/en-us/library/aa373347(VS.85).aspx)

您是否发现它们可靠且易于使用？

我正在阅读一些文档，似乎滚动我自己的文档可能是更好的方法，因为我可以使我的解决方案与 XP 兼容。有没有人尝试写自己的？本机方法可以提供哪些不能轻易手工复制的东西？编写此类解决方案有哪些潜在方法，我觉得我可能需要运行后台服务来监控我的应用程序的健康状况，这是唯一的方法吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-17T20:49:07.407

如果您描述为什么需要监控它，将会很有帮助。

它是否在没有 GUI 的情况下无人看管？然后，您可以改为创建 Windows 服务。XP 中已有服务的重新启动选项。

它是一个 GUI 应用程序，即使用户不在也能提供一些后台服务？考虑将其分为一个 Windows 服务（需要一直运行）和一个 GUI 应用程序，后者可以在不影响服务操作的情况下崩溃。

或者你正在编写一个不能依赖用户重启的“kiosk”应用程序？

您可以编写一个小型“包装器”应用程序，它只是启动您的真实应用程序并等待它退出。当它退出时，例如检查退出代码以确定它是否崩溃或定期退出。

要监视应用程序挂起，请让您的真实应用程序定期“Ping”包装器（使用计时器）。如果包装器在一定时间内没有收到 ping，它可以杀死并重新启动真正的应用程序。

由于包装器很小，它崩溃的风险也很低。但如果这对您来说是个问题，那么真正的应用程序可能会反向监控包装器。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-10T15:47:41.943

唯一的方法是让服务监控应用程序。

原因是如果应用程序有一个应用程序本身无法处理的真正致命错误，那么它之外的东西必须执行恢复操作。

后台服务可以使用 WMI（适用于 XP、Vista 等）来监控应用程序。什么时候开始，它使用了多少内存，什么时候关闭等等。

# asp.net - ASP.NET 3.5 Gridview 控件

> ID：356526
> 
> 赞同：0
> 
> 时间：2008-12-10T15:45:42.463
> 
> 标签：asp.net

如果您单击以下链接中的“搜索”按钮

[链接文本](http://www.bmwusa.com/Standard/Content/CPO/ModelSearch.aspx)

出现一个网格视图。我正在尝试在宽度设置为自动的表格中做类似的事情。我目前的方法是在设计视图中创建 gridview，但是，我的 gridview 没有调整到表格宽度。我知道我在一个问题中提出了 2 个不同的问题。

我目前的gridview就是这样。在“源”视图中定义

```
<asp:GridView ID="gridView" runat="server"
             AutoGenerateColumns="False"
             EnableSortingAndPagingCallbacks="True"
             AllowPaging="True" DataSourceID="FilesByJobObjectDataSource" 
             PageSize="5" OnRowCommand="gridView_RowCommand" DataKeyNames="FileID"  
             HorizontalAlign="Left" >
             <Columns>
                 <asp:BoundField DataField="RID" HeaderText="RID" 
                    ReadOnly="True" ItemStyle-Width="50px"  >
                     <ItemStyle Width="50px" />
                 </asp:BoundField>
                <asp:BoundField DataField="Category" HeaderText="Category" 
                    ReadOnly="True" ItemStyle-Width="100 px" >
                    <ItemStyle Width="100px" />
                 </asp:BoundField>
                <asp:BoundField DataField="FileName" HeaderText="Type" 
                     ReadOnly="True" ItemStyle-Width="575 px" > 
                    <ItemStyle Width="575px" />
                 </asp:BoundField>
                <asp:BoundField DataField="FileID" Visible="false" />
                <asp:ButtonField Text="X" ButtonType="Button" ItemStyle-Width="20px" >
                    <ItemStyle Width="20px" />
                 </asp:ButtonField>
            </Columns>
             <RowStyle CssClass="RowStyle" />
            <EmptyDataRowStyle CssClass="EmptyRowStyle" />
            <PagerStyle CssClass="PagerStyle" />
            <SelectedRowStyle CssClass="SelectedRowStyle" />
            <HeaderStyle CssClass="HeaderStyle" />
            <EditRowStyle CssClass="EditRowStyle" />
            <AlternatingRowStyle CssClass="AltRowStyle" />
     </asp:GridView>
     </ContentTemplate> 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-10T16:09:25.270

不要设置列宽....

# c# - 使用 Visual Studio 时可以自动增加文件构建版本吗？

> ID：356543
> 
> 赞同：383
> 
> 时间：2008-12-10T15:51:05.790
> 
> 标签：c#, asp.net, visual-studio, version-control, assemblyinfo

我只是想知道如何使用 Visual Studio (2005)*自动*增加文件的构建（和版本？）。

如果我查看 say 的属性`C:\Windows\notepad.exe`，版本选项卡会给出“文件版本：5.1.2600.2180”。我也想在我的 dll 版本中获得这些很酷的数字，而不是 1.0.0.0 版本，让我们面对它有点沉闷。

我尝试了一些东西，但它似乎不是开箱即用的功能，或者我只是在寻找错误的地方（像往常一样）。

我主要从事网络项目....

我看了两个：

1.  [http://www.codeproject.com/KB/dotnet/Auto_Increment_Version.aspx](http://www.codeproject.com/KB/dotnet/Auto_Increment_Version.aspx)
2.  [http://www.codeproject.com/KB/dotnet/build_versioning.aspx](http://www.codeproject.com/KB/dotnet/build_versioning.aspx)

我简直不敢相信做某事付出这么大的努力是标准做法。

编辑： **据我所知，它在 VS2005 中不起作用（[http://www.codeproject.com/KB/dotnet/AutoIncrementVersion.aspx](http://www.codeproject.com/KB/dotnet/AutoIncrementVersion.aspx)）**

* * *

## 回答 #1

> 赞同：448
> 
> 时间：2008-12-10T16:35:54.593

在 Visual Studio 2008 中，以下工作。

找到 AssemblyInfo.cs 文件并找到以下 2 行：

```
[assembly: AssemblyVersion("1.0.0.0")]
[assembly: AssemblyFileVersion("1.0.0.0")] 
```

您可以尝试将其更改为：

```
[assembly: AssemblyVersion("1.0.*")]
[assembly: AssemblyFileVersion("1.0.*")] 
```

但这不会给你想要的结果，你最终会得到**1.0.*的产品版本和****1.0.0.0**的文件版本。不是你想要的！

但是，如果您删除这些行中的第二行并且只拥有：

```
[assembly: AssemblyVersion("1.0.*")] 
```

然后编译器会将文件版本设置为等于产品版本，您将获得所需的自动递增产品和文件版本同步的结果。例如**1.0.3266.92689**

* * *

## 回答 #2

> 赞同：157
> 
> 时间：2008-12-10T15:54:19.450

打开 AssemblyInfo.cs 文件并更改

```
// You can specify all the values or you can default the Build and Revision Numbers 
// by using the '*' as shown below:
// [assembly: AssemblyVersion("1.0.*")]
[assembly: AssemblyVersion("1.0.0.0")]
[assembly: AssemblyFileVersion("1.0.0.0")] 
```

到

```
[assembly: AssemblyVersion("1.0.*")]
//[assembly: AssemblyFileVersion("1.0.0.0")] 
```

您可以在 IDE 中通过转到项目 -> 属性 -> 程序集信息来执行此操作

但是，这只允许您自动增加程序集版本，并为您提供

> 程序集文件版本：此字段中不允许使用通配符 ("*")

如果您尝试在文件版本字段中放置 *，则消息框。

所以只需打开 assemblyinfo.cs 并手动完成。

* * *

## 回答 #3

> 赞同：55
> 
> 时间：2010-01-15T09:21:09.373

在每个构建中更改版本号的另一个选项是使用[MSBuild.Community.Tasks的](https://github.com/loresoft/msbuildtasks)*Version*任务。只需下载他们的安装程序，安装它，然后修改以下代码并将其粘贴到您的文件中：`<Import Project="$(MSBuildBinPath)\Microsoft.CSharp.targets" />``.csproj`

```
<Import Project="$(MSBuildExtensionsPath)\MSBuildCommunityTasks\MSBuild.Community.Tasks.Targets" />
<Target Name="BeforeBuild">
    <Version VersionFile="Properties\version.txt" Major="1" Minor="0" BuildType="Automatic" StartDate="12/31/2009" RevisionType="BuildIncrement">
      <Output TaskParameter="Major" PropertyName="Major" />
      <Output TaskParameter="Minor" PropertyName="Minor" />
      <Output TaskParameter="Build" PropertyName="Build" />
      <Output TaskParameter="Revision" PropertyName="Revision" />
    </Version>
    <AssemblyInfo CodeLanguage="CS"
                  OutputFile="Properties\VersionInfo.cs"
                  AssemblyVersion="$(Major).$(Minor)"
                  AssemblyFileVersion="$(Major).$(Minor).$(Build).$(Revision)" />
</Target> 
```

*注意：*根据您的语言环境调整 StartDate 属性。[它目前不使用不变的文化。](http://msbuildtasks.tigris.org/issues/show_bug.cgi?id=116)

对于 2010 年 1 月 14 日的第三个版本，这将创建一个`VersionInfo.cs`具有以下内容的：

```
[assembly: AssemblyVersion("1.0")]
[assembly: AssemblyFileVersion("1.0.14.2")] 
```

然后必须将此文件添加到项目中（通过*Add existing item*），并且`AssemblyVersion`必须`AssemblyFileVersion`从`AssemblyInfo.cs`.

用于更改版本组件的不同算法在*版本属性*`$(MSBuildExtensionsPath)\MSBuildCommunityTasks\MSBuild.Community.Tasks.chm`中进行了描述。

 ** * *

## 回答 #4

> 赞同：30
> 
> 时间：2011-06-24T18:28:27.360

我想出了一个类似于 Christians 但不依赖于社区 MSBuild 任务的解决方案，这对我来说不是一个选项，因为我不想为我们所有的开发人员安装这些任务。

我正在生成代码并编译为程序集，并希望自动增加版本号。但是，我不能使用 VS 6.0.* AssemblyVersion 技巧，因为它每天都会自动增加内部版本号并破坏与使用旧版本号的程序集的兼容性。相反，我想要一个硬编码的 AssemblyVersion 但自动递增的 AssemblyFileVersion。我通过在 AssemblyInfo.cs 中指定 AssemblyVersion 并像这样在 MSBuild 中生成 VersionInfo.cs 来完成此操作，

```
 <PropertyGroup>
    <Year>$([System.DateTime]::Now.ToString("yy"))</Year>
    <Month>$([System.DateTime]::Now.ToString("MM"))</Month>
    <Date>$([System.DateTime]::Now.ToString("dd"))</Date>
    <Time>$([System.DateTime]::Now.ToString("HHmm"))</Time>
    <AssemblyFileVersionAttribute>[assembly:System.Reflection.AssemblyFileVersion("$(Year).$(Month).$(Date).$(Time)")]</AssemblyFileVersionAttribute>
  </PropertyGroup>
  <Target Name="BeforeBuild">
    <WriteLinesToFile File="Properties\VersionInfo.cs" Lines="$(AssemblyFileVersionAttribute)" Overwrite="true">
    </WriteLinesToFile>
  </Target> 
```

这将生成一个带有 AssemblyFileVersion 的 Assembly 属性的 VersionInfo.cs 文件，其中版本遵循 YY.MM.DD.TTTT 的架构和构建日期。您必须在项目中包含此文件并使用它进行构建。

* * *

## 回答 #5

> 赞同：17
> 
> 时间：2009-04-22T05:20:26.187

安装[构建版本增量](http://autobuildversion.codeplex.com/)加载项。它为您提供比 * 选项更多的控制权。

* * *

## 回答 #6

> 赞同：16
> 
> 时间：2017-03-30T08:24:45.100

有一个 Visual Studio 扩展[自动版本](https://marketplace.visualstudio.com/items?itemName=PrecisionInfinity.AutomaticVersions)，它支持 Visual Studio（2012、2013、2015）2017 和 2019。

**屏幕截图** [![在此处输入图像描述](https://i.stack.imgur.com/I33C5.png)](https://i.stack.imgur.com/I33C5.png)

[![在此处输入图像描述](https://i.stack.imgur.com/AWDsz.png)](https://i.stack.imgur.com/AWDsz.png)

* * *

## 回答 #7

> 赞同：13
> 
> 时间：2008-12-10T15:54:12.150

要获取版本号，请尝试

```
 System.Reflection.Assembly assembly = System.Reflection.Assembly.GetExecutingAssembly();
 System.Reflection.AssemblyName assemblyName = assembly.GetName();
 Version version = assemblyName.Version; 
```

要设置版本号，请创建/编辑 AssemblyInfo.cs

```
 [assembly: AssemblyVersion("1.0.*")]
 [assembly: AssemblyFileVersion("1.0.*")] 
```

另外作为旁注，第三个数字是自 2000 年 2 月 1 日以来的天数，第四个数字是一天中总秒数的一半。所以如果你在午夜编译它应该是零。

* * *

## 回答 #8

> 赞同：8
> 
> 时间：2008-12-10T15:56:24.703

如其他帖子中所述，在 AssemblyInfo 或项目属性中的版本号中设置 * 不适用于所有版本的 Visual Studio / .NET。

Afaik 它在 VS 2005 中不起作用（但在 VS 2003 和 VS 2008 中）。对于 VS 2005，您可以使用以下内容：[Auto Increment Visual Studio 2005 version build and revision number on compile time](http://www.codeproject.com/KB/dotnet/Auto_Increment_Version.aspx)。

但请注意，不建议对强名称程序集自动更改版本号。原因是每次重建引用的程序集时都必须更新对此类程序集的所有引用，因为强名称程序集引用始终是对特定程序集版本的引用。仅当接口发生更改时，Microsoft 自己才会更改 .NET Framework 程序集的版本号。（注意：我仍在寻找我读到的 MSDN 中的链接。）

* * *

## 回答 #9

> 赞同：7
> 
> 时间：2019-05-24T16:27:09.397

# 在 Visual Studio 2019 中

这对我来说还不够

```
[assembly: AssemblyVersion("1.0.*")] 
```

构建它时会抛出这个错误

> 指定的版本字符串不符合要求的格式

## 解决方案

在我设置后格式终于被`Deterministic`接受`False`了`project.csproj`

```
<Deterministic>false</Deterministic> 
```

* * *

# 编辑：

出于某种原因，设置`Deterministic`搞砸`False`了我的配置文件，加载它并将其保存在不同的位置。

## 解决方法：

我设置了一个构建后事件来增加修订号：

### 构建后事件批处理脚本

这将调用一个名为的 powershell 脚本`autoincrement_version.ps1`，将路径作为参数传递`AssemblyInfo.cs`

```
if $(ConfigurationName) == Release (
PowerShell -ExecutionPolicy RemoteSigned $(ProjectDir)autoincrement_version.ps1 '$(ProjectDir)My Project\AssemblyInfo.cs'
) 
```

### Poweshell 脚本

它使用正则表达式自动增加修订号

```
param( [string]$file );
  $regex_revision = '(?<=Version\("(?:\d+\.)+)(\d+)(?="\))'
  $found = (Get-Content $file) | Select-String -Pattern $regex_revision
  $revision = $found.matches[0].value
  $new_revision = [int]$revision + 1
  (Get-Content $file) -replace $regex_revision, $new_revision | Set-Content $file -Encoding UTF8 
```

* * *

## 回答 #10

> 赞同：6
> 
> 时间：2012-07-10T18:37:31.577

将递增 (DateTime) 信息添加到 AssemblyFileVersion 属性中，该属性具有不破坏任何依赖关系的优点。

* * *

基于 Boog 的解决方案（对我不起作用，可能是因为 VS2008？），您可以使用生成文件的预构建事件的组合，添加该文件（包括其版本属性），然后使用一种方式读出再次使用这些值。那是..

预建事件：

```
echo [assembly:System.Reflection.AssemblyFileVersion("%date:~-4,4%.%date:~-7,2%%date:~-10,2%.%time:~0,2%%time:~3,2%.%time:~-5,2%")] > $(ProjectDir)Properties\VersionInfo.cs 
```

将生成的 VersionInfo.cs 文件（Properties 子文件夹）包含到您的项目中

获取日期的代码（几年到几秒）：

```
var version = assembly.GetName().Version;
var fileVersionString = System.Diagnostics.FileVersionInfo.GetVersionInfo(assembly.Location).FileVersion;
Version fileVersion = new Version(fileVersionString);
var buildDateTime = new DateTime(fileVersion.Major, fileVersion.Minor/100, fileVersion.Minor%100, fileVersion.Build/100, fileVersion.Build%100, fileVersion.Revision); 
```

不太舒服..另外，我不知道它是否会创建很多强制重建（因为文件总是会更改）。

例如，如果您仅每隔几分钟/小时更新 VersionInfo.cs 文件（通过使用临时文件，然后在检测到足够大的更改时复制/覆盖真实的 VersionInfo.cs），您可以使其更智能。我曾经非常成功地做到了这一点。

* * *

## 回答 #11

> 赞同：5
> 
> 时间：2008-12-10T15:54:35.627

将版本号设置为“1.0.*”，它会自动用日期（从某个点开始的天数）和时间（从午夜开始的半秒）填充最后两个数字

* * *

## 回答 #12

> 赞同：5
> 
> 时间：2008-12-10T15:55:03.880

它位于***发布下的项目属性中***

![http://screencast.com/t/Vj7rhqJO](https://content.screencast.com/users/Zeus/folders/Jing/media/bab092e4-5cdf-4073-a7d2-b804b12cdf8d/2008-12-10_1054.png)
（〜http [://screencast.com/t/Vj7rhqJO](http://screencast.com/t/Vj7rhqJO)）

* * *

## 回答 #13

> 赞同：4
> 
> 时间：2016-03-03T19:27:56.073

[Cake](http://cakebuild.net/)支持 AssemblyInfo 文件打补丁。有了蛋糕，您就有无限的方法来实现自动版本递增。

像 C# 编译器这样递增版本的简单示例：

```
Setup(() =>
{
    // Executed BEFORE the first task.
    var datetimeNow = DateTime.Now;
    var daysPart = (datetimeNow - new DateTime(2000, 1, 1)).Days;
    var secondsPart = (long)datetimeNow.TimeOfDay.TotalSeconds/2;
    var assemblyInfo = new AssemblyInfoSettings
    {
        Version = "3.0.0.0",
        FileVersion = string.Format("3.0.{0}.{1}", daysPart, secondsPart)
    };
    CreateAssemblyInfo("MyProject/Properties/AssemblyInfo.cs", assemblyInfo);
}); 
```

这里：

*   版本 - 是汇编版本。最佳做法是锁定主要版本号并保留零（如“1.0.0.0”）。
*   FileVersion - 是程序集文件版本。

请注意，您不仅可以修补版本，[还可以修补所有其他必要信息](http://cakebuild.net/api/cake.common.solution.project.properties/8f09cb16)。

* * *

## 回答 #14

> 赞同：4
> 
> 时间：2016-07-09T13:53:47.653

# 如何获取版本`{major}.{year}.1{date}.1{time}`

这是一种实验性的，但我喜欢它。灵感来自 Jeff Atwood @ CodingHorror（[链接](https://blog.codinghorror.com/whats-in-a-version-number-anyway/)）。

生成的版本号变为`1.2016.10709.11641`（意思是 2016-07-09 16:41），它允许

*   可怜的人零填充（带有愚蠢的前导`1`s）
*   嵌入到版本号中的几乎人类可读的*本地日期时间*
*   让主要版本单独进行真正重大的重大更改。

向您的项目添加一个新项目，选择 General -> Text Template，将其命名为类似的名称并（如果适用）`CustomVersionNumber`注释掉.`AssemblyVersion``AssemblyFileVersion``Properties/AssemblyInfo.cs`

然后，当保存此文件或构建项目时，这将重新生成一个文件，该`.cs`文件位于已创建文件下的子项中`.tt`。

```
<#@ template language="C#" #>
<#@ assembly name="System.Core" #>
<#@ import namespace="System.Linq" #>

//
// This code was generated by a tool. Any changes made manually will be lost
// the next time this code is regenerated.
//

using System.Reflection;

<#
    var date = DateTime.Now;
    int major = 1;
    int minor = date.Year;
    int build = 10000 + int.Parse(date.ToString("MMdd"));
    int revision = 10000 + int.Parse(date.ToString("HHmm"));
#>

[assembly: AssemblyVersion("<#= $"{major}.{minor}.{build}.{revision}" #>")]
[assembly: AssemblyFileVersion("<#= $"{major}.{minor}.{build}.{revision}" #>")] 
```

* * *

## 回答 #15

> 赞同：3
> 
> 时间：2008-12-10T15:54:09.963

前往项目 | 属性，然后是组装信息，然后是组装版本，并在最后一个或倒数第二个框中放一个 *（您不能自动增加主要或次要组件）。

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2008-12-11T20:26:07.730

截至目前，对于我的申请，

```
string ver = Application.ProductVersion; 
```

返回`ver = 1.0.3251.27860`

值 3251 是自 2000 年 1 月 1 日以来的天数。我用它在我的应用程序的启动屏幕上放置版本创建日期。在与用户打交道时，我可以询问创建日期，这比一些长数字更容易沟通。

（我是一个支持小公司的单人部门。这种方法可能不适合你。）

* * *

## 回答 #17

> 赞同：2
> 
> 时间：2008-12-15T05:20:35.877

使用 MSBuild 社区任务 ( [http://msbuildtasks.tigris.org/](http://msbuildtasks.tigris.org/) ) 项目中的 AssemblyInfo 任务，并将其集成到您的 .csproj/.vbproj 文件中。

它有许多选项，包括将版本号与一天中的日期和时间联系起来的选项。

受到推崇的。

* * *

## 回答 #18

> 赞同：2
> 
> 时间：2013-05-13T22:26:24.440

也许，对于这个任务，你可以使用这样的代码：

```
 private bool IncreaseFileVersionBuild()
    {
        if (System.Diagnostics.Debugger.IsAttached)
        {
            try
            {
                var fi = new DirectoryInfo(AppDomain.CurrentDomain.BaseDirectory).Parent.Parent.GetDirectories("Properties")[0].GetFiles("AssemblyInfo.cs")[0];
                var ve = System.Diagnostics.FileVersionInfo.GetVersionInfo(System.Reflection.Assembly.GetExecutingAssembly().Location);
                string ol = ve.FileMajorPart.ToString() + "." + ve.FileMinorPart.ToString() + "." + ve.FileBuildPart.ToString() + "." + ve.FilePrivatePart.ToString();
                string ne = ve.FileMajorPart.ToString() + "." + ve.FileMinorPart.ToString() + "." + (ve.FileBuildPart + 1).ToString() + "." + ve.FilePrivatePart.ToString();
                System.IO.File.WriteAllText(fi.FullName, System.IO.File.ReadAllText(fi.FullName).Replace("[assembly: AssemblyFileVersion(\"" + ol + "\")]", "[assembly: AssemblyFileVersion(\"" + ne + "\")]"));
                return true;
            }
            catch
            {
                return false;
            }
        }
        return false;
    } 
```

并从表单加载中调用它。
使用此代码，您可以更新 AssemblyInfo.cs 中文件信息的任何部分（但您必须使用“标准”目录结构）。

* * *

## 回答 #19

> 赞同：2
> 
> 时间：2014-01-24T06:01:49.440

更改 AssemblyInfo 在 VS2012 中有效。在 Visual Studio 中没有对此提供更多支持似乎很奇怪，您会认为这是构建/发布过程的基本部分。

* * *

## 回答 #20

> 赞同：2
> 
> 时间：2017-06-23T11:16:44.593

我创建了一个应用程序来自动增加文件版本。

1.  下载[申请](https://github.com/telsonalva/IncrementAssemblyFileVersion/releases/tag/v1.0)
2.  将以下行添加到预构建事件命令行

    C:\temp\IncrementFileVersion.exe $(SolutionDir)\Properties\AssemblyInfo.cs

3.  构建项目

为简单起见，该应用程序仅在出现错误时抛出消息，以确认它工作正常，您需要检查“程序集信息”中的文件版本

注意：您必须在 Visual Studio 中重新加载解决方案以获取“程序集信息”按钮以填充字段，但是您的输出文件将具有更新版本。

如有建议和要求，请发送电子邮件至 telson_alva@yahoo.com

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2014-05-08T06:30:01.387

[装配信息实用程序](http://www.codeproject.com/Articles/31236/How-To-Update-Assembly-Version-Number-Automaticall)。自由。开源。

* * *

## 回答 #22

> 赞同：1
> 
> 时间：2015-04-23T11:07:45.383

我正在使用这种方法 [https://stackoverflow.com/a/827209/3975786](https://stackoverflow.com/a/827209/3975786)，将 T4 模板放在“解决方案项目”中，并将其与每个项目中的“添加为链接”一起使用。

* * *

## 回答 #23

> 赞同：1
> 
> 时间：2017-03-09T10:35:33.717

也许在这里回答为时已晚，但希望这能解决某人的忙碌问题。

**一种使用 PowerShell 脚本自动**更改所有项目的程序集版本的方法。[本文](https://asimplify.com/powershell-how-to-update-assemblyversions-of-net-projects-using-ps-script/)将解决您的许多问题。

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2008-12-10T15:54:06.563

每次我进行构建时，它都会自动增加最低有效数字。

我不知道如何更新其他人，但你至少应该已经看到了......

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2020-03-23T11:03:39.633

对于使用 Tortoise Subversion 的任何人，您可以将您的版本号之一与源代码的 subversion 修订号联系起来。我觉得这非常有用（审核员也非常喜欢这个！）。您可以通过在预构建中调用 WCREV 实用程序并从模板生成 AssemblyInfo.cs 来执行此操作。

如果您的模板名为 AssemblyInfo.wcrev 并且位于普通的 AssemblyInfo.cs 目录中，并且 tortoise 位于默认安装目录中，那么您的 Pre-Build 命令如下所示（注意全部在一行中）：

```
"C:\Program Files\TortoiseSVN\bin\SubWCRev.exe" "$(ProjectDir)." "$(ProjectDir)Properties\AssemblyInfo.wcrev"  "$(ProjectDir)Properties\AssemblyInfo.cs" 
```

模板文件将包含 wcrev 令牌替换字符串：$WCREV$，
例如

```
[assembly: AssemblyFileVersion("1.0.0.$WCREV$")] 
```

注意：
由于您的 AssemblyInfo.cs 现在已生成，您不希望它受版本控制。

# sql - 如何在 SQL Server 2000 中正确排序字母数字

> ID：356547
> 
> 赞同：0
> 
> 时间：2008-12-10T15:52:45.333
> 
> 标签：sql, sorting, sql-server-2000

微软 SQL 服务器 2000

我在表 A 中有一个名为 Name 的列。我希望对名称字段进行排序。许多但不是所有名称的记录都以 KL 开头，后面跟着一个数字（KL 1234、KL 2、KL 323 等）。

## 表 A

## 姓名

Able
Bravo
KL 2
KL 323
KL 1234
斑马

如果我使用

```
Select Name from A 
Order by Name 
```

我明白了

Able
Bravo
KL 1234
KL 2
KL 323
斑马

我想

Able
Bravo
KL 2
KL 323
KL 1234
斑马

如果他们都从 KL 开始，我可以使用

```
Select Name from A
Order by cast(replace(name, 'KL', '') as big int) 
```

但这会为不以 KL 开头的值生成“无法将名称转换为大整数”错误

谢谢你的帮助。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-10T16:13:21.440

试试这个：

```
Order By 
    Case When Left(name, 2) = 'KL' 
        Then 'KL' + Replace(Str(Cast(replace(name, 'KL', '') as BigInt), 12), ' ', '0')
        Else name End 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-10T16:21:59.003

```
ORDER BY 
    CASE WHEN CHARINDEX(' ', name)=0 THEN name 
        ELSE LEFT(name, CHARINDEX(' ', name)) END,
    CASE WHEN CHARINDEX(' ', name)=0 THEN 0
        ELSE CONVERT(BIGINT, 
            SUBSTRING(name, CHARINDEX(' ', name)+1, LEN(name))) END 
```

更新错误关闭）评论后

# c# - C# BinaryWrite over SSL

> ID：356548
> 
> 赞同：4
> 
> 时间：2008-12-10T15:53:01.527
> 
> 标签：c#, .net, file, binary

我正在尝试使用存储在 MSSQL varbinary(MAX) 字段中的 PDF 回复客户。该响应通过 http 连接在我的本地主机和测试服务器上工作，但在通过 https 连接的生产服务器上不起作用。我只使用了一个简单的 BinaryWrite（下面的代码）。

```
 byte[] displayFile = DatabaseFiles.getPdfById(id);

    Response.ContentType = "application/pdf";
    Response.BinaryWrite(displayFile); 
```

这里没有什么花哨的。只需抓取二进制数据，设置内容类型，然后写回客户端。为了以这种方式通过 https 进行响应，是否需要做任何特别的事情？

**编辑：**不起作用，我的意思是我在浏览器中得到一个空白文档。Acrobat 无法在浏览器中加载。

**编辑：**我刚刚注意到这个问题只发生在 IE 7 中。PDF 在 Firefox 3 中正确加载。我们的客户端专门使用 IE 7（比我说服他们升级的 IE 6 更好......哈哈）。

**编辑：**尝试添加标题“content-disposition”以使文件充当附件。浏览器无法在 SSL 下加载，并出现 IE 错误“Internet Explorer 无法从 ProductionServer.net 下载 displayFile.aspx”。（代码如下）

```
 byte[] displayFile = DatabaseFiles.getPdfById(id);
    Response.Clear();
    Response.AddHeader("content-disposition", String.Format("attachment;filename={0}", fileName));
    Response.ContentType = "application/pdf";
    Response.BinaryWrite(displayFile); 
```

**编辑：**如果在生产服务器上通过 http 查看文件，浏览器会显示 PDF 的代码，就像通过记事本查看它一样。（例如 %PDF-1.4 %âãÏÓ 6 0 obj <> endobj xref 6 33 ...等）

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-18T16:42:15.870

我只是设法通过替换来解决这个问题

```
Response.Clear(); 
```

和

```
Response.ClearContent();
Response.ClearHeaders(); 
```

所以整个事情看起来像：

```
byte[] downloadBytes = doc.GetData();
Response.ClearContent();
Response.ClearHeaders();

Response.Buffer = true;
Response.ContentType = "application/pdf";
Response.AddHeader("Content-Length", downloadBytes.Length.ToString());
Response.AddHeader("Content-Disposition", "attachment; filename=myFile.pdf");
Response.BinaryWrite(downloadBytes);
Response.Flush();
Response.End(); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-10T17:22:45.417

IE 7 对 PDF 有一个[mime 类型“问题”](http://support.microsoft.com/kb/945686)，与[复杂的 mime 类型规则](http://msdn.microsoft.com/en-us/library/ms775147.aspx)有关。您可能想验证客户端是否有该补丁。

由于其他原因（其中包括脚本标签、response.flush 和 keepalives），还有一些关于 IE 7 空白页的零星投诉，AFAIK 尚未得到可靠解决。

幸运的是，这听起来像每次都在发生——所以你应该能够很快地找到它的底部。

您可以尝试将 .pdf 与 ASP.NET 关联，以便 IE 将 url 作为 PDF 文件拾取。那应该覆盖 mime 类型问题。

重定向（HTTP Response.Redirect、基于 Javascript 和链接）似乎有助于解决其他一些问题。

检查生产服务器上的 IIS keepalive 设置，或使用 Fiddler 观看，将告诉您是否 keepalive 是一个问题。

*也许*添加一个内容处置标题会有所帮助......不过，这不是我的想法。

我的猜测是 SSL 关系是一个红鲱鱼，所以我也会在生产服务器上检查非 SSL。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-02-18T22:50:29.560

遇到同样的问题。也只能用 IE。`<%@ OutputCache Location="None" %>`通过从 .aspx 页面中删除来修复我的问题。这也许可以解释为什么`Response.ClearHeaders`上面的调用有效。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-10T16:01:21.057

几年前我遇到了同样的问题。我们找到的解决方案并不是最漂亮的。我们将文件写入磁盘并对其执行 Response.Redirect。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-10T16:13:39.537

您可以使用 Wireshark（或类似的）查看客户端的内容吗？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-10T18:12:45.690

这是在 Fiddler 中查看的原始请求

```
GET /displayFile.aspx?id=128 HTTP/1.1
Accept: */*
Accept-Language: en-us
UA-CPU: x86
Accept-Encoding: gzip, deflate
User-Agent: Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 6.0; SLCC1; .NET CLR 2.0.50727; Media Center PC 5.0; .NET CLR 3.5.21022; .NET CLR 3.5.30729; .NET CLR 3.0.30618)
Host: ProductionServer.net
Connection: Keep-Alive 
```

**编辑：**这是在 Fiddler 中查看的原始响应标头

```
HTTP/1.1 200 OK
Date: Wed, 10 Dec 2008 18:39:54 GMT
Server: Microsoft-IIS/6.0
X-Powered-By: ASP.NET
X-AspNet-Version: 2.0.50727
Cache-Control: no-cache
Pragma: no-cache
Expires: -1
Content-Type: application/pdf; charset=utf-8
Content-Length: 102076 
```

# java - 将 PDF 转换为 TIFF 的好库？

> ID：356550
> 
> 赞同：5
> 
> 时间：2008-12-10T15:53:41.807
> 
> 标签：java, pdf, tiff

我需要一个 Java 库来将 PDF 转换为 TIFF 图像。PDF 是传真，我将转换为 TIFF，以便我可以在图像上进行条形码识别。谁能推荐一个好的免费开源库来将 PDF 转换为 TIFF？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-10T16:01:26.317

我不能推荐任何代码库，但使用 GhostScript 将 PDF 转换为位图格式很容易。我个人使用下面的脚本（也使用 netpbm 实用程序）将 PDF 的*第一*页转换为 JPEG 缩略图：

```
#!/bin/sh

/opt/local/bin/gs -q -dLastPage=1 -dNOPAUSE -dBATCH -dSAFER -r300 \
    -sDEVICE=pnmraw -sOutputFile=- $* |
    pnmcrop |
    pnmscale -width 240 |
    cjpeg 
```

您可以使用`-sDEVICE=tiff...`从 GhostScript 获取各种 TIFF 子格式的直接 TIFF 输出。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-06-26T20:31:33.037

免责声明：我为 Atalasoft 工作

[我们有一个可以将 PDF 转换为 TIFF 的 SDK](http://www.atalasoft.com/products/dotimage/)。渲染由 Foxit 软件提供支持，该软件是一个非常强大和高效的 PDF 渲染器。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-11-24T14:21:30.453

我们在这里还进行转换 PDF -> G3 tiffs 的高分辨率和低分辨率。根据我的经验，你可以拥有的最好的工具是 Adob​​e PDF SDK，唯一的问题是它的疯狂价格。所以我们不使用它。

对我们有用的是**ghostscript**，最新版本非常强大，并且可以正确渲染大多数 pdf。我们有很多人在白天来。在生产中使用 gsdll32.dll 完成转换；但如果您想尝试使用以下命令行：

```
gswin32c -dNOPAUSE -dBATCH -dMaxStripSize=8192 -sDEVICE=tiffg3 -r204x196 -dDITHERPPI=200 -sOutputFile=test.tif prefix.ps test.pdf 
```

它会将您的 PDF 转换为高分辨率 G3 TIFF。和 prefix.ps 代码在这里：

```
<< currentpagedevice /InputAttributes get
0 1 2 index length 1 sub {1 index exch undef } for
/InputAttributes exch dup 0 <</PageSize [0 0 612 1728]>> put
/Policies << /PageSize 3 >> >> setpagedevice 
```

这个sdk的另一件事是它是开源的；你得到了它的 c 和 ps (postscript) 源代码。此外，如果您要使用其他工具检查他们必须为 pdf 渲染提供动力的引擎类型，则可能会发生他们正在使用 gs 的情况；就像 LeadTools 一样。

希望这会有所帮助，问候

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2012-10-10T15:32:08.317

您可以使用 icepdf 库（Apache 2.0 许可证）。他们甚至提供这个确切的用例作为他们的示例源代码之一： [http ://wiki.icesoft.org/display/PDF/Multi-page+Tiff+Capture](http://wiki.icesoft.org/display/PDF/Multi-page+Tiff+Capture)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-10T18:21:27.657

也许不需要将 PDF 转换为 TIFF。传真很可能是 PDF 中的嵌入图像，因此您可以再次提取这些图像。这应该可以通过已经提到的 iText 库来实现。

我不知道这是否比其他方法更容易。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-11-24T14:08:06.890

看看[Apache PDFBox - 一个 Java PDF 库](http://pdfbox.apache.org/)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-17T16:41:43.043

没有 Itext 不能将 PDF 转换为 Tiff。

但是，有一些商业图书馆可以做到这一点。jPDFImages 是一个 100% 的 java 库，可以将 PDF 转换为 TIFF、JPEG 或 PNG 格式的图像（也许是 JBIG？我不确定）。它也可以反过来，从图像创建 PDF。一台服务器的起价为 300 美元。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2011-11-30T09:03:41.793

Here is a good article and wrapper classes for using GhostScript with C# .NET...最终在生产中使用它

[http://www.codeproject.com/KB/cs/GhostScriptUseWithCSharp.aspx](http://www.codeproject.com/KB/cs/GhostScriptUseWithCSharp.aspx)

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2011-03-30T12:15:40.140

我对 iText 有一些很好的经验（现在，我使用的是 5.0.6 版本），这是将 tiff 转换为 pdf 的代码：

```
private static String convertTiff2Pdf(String tiff) {

    // target path PDF
    String pdf = null;

    try {

        pdf = tiff.substring(0, tiff.lastIndexOf('.') + 1) + "pdf";

        // New document A4 standard (LETTER)
        Document document = new Document(PageSize.LETTER, 0, 0, 0, 0);

        PdfWriter writer = PdfWriter.getInstance(document, new FileOutputStream(pdf));
        int pages = 0;
        document.open();
        PdfContentByte cb = writer.getDirectContent();
        RandomAccessFileOrArray ra = null;
        int comps = 0;
        ra = new RandomAccessFileOrArray(tiff);
        comps = TiffImage.getNumberOfPages(ra);

        // Convertion statement
        for (int c = 0; c < comps; ++c) {
            Image img = TiffImage.getTiffImage(ra, c + 1);
            if (img != null) {
                System.out.println("page " + (c + 1));
                img.scalePercent(7200f / img.getDpiX(), 7200f / img.getDpiY());
                document.setPageSize(new Rectangle(img.getScaledWidth(), img.getScaledHeight()));
                img.setAbsolutePosition(0, 0);
                cb.addImage(img);
                document.newPage();
                ++pages;
            }
        }

        ra.close();
        document.close();

    } catch (Exception e) {
        logger.error("Convert fail");
        logger.debug("", e);
        pdf = null;
    }

    logger.debug("[" + tiff + "] -> [" + pdf + "] OK");
    return pdf;

} 
```

# javascript - 防止过时的 CSS 和 JavaScript 的最佳实践是什么

> ID：356551
> 
> 赞同：11
> 
> 时间：2008-12-10T15:53:46.517
> 
> 标签：javascript, css, spring-mvc, amazon-s3

我正在为一个项目研究这个，我想知道其他人正在做什么来防止每个新版本都提供陈旧的 CSS 和 JavaScript 文件。我不想附加时间戳或类似的东西，这可能会阻止对每个请求进行缓存。

我正在使用 Spring 2.5 MVC 框架，并且我已经在使用 google api 来提供原型和脚本。我还在考虑使用 Amazon S3 和新的 Cloudfront 产品来最大限度地减少网络延迟。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-12-10T16:12:39.990

我在请求中添加了一个带有修订号的参数，例如：

```
<script type="text/javascript" src="/path/to/script.js?ver=456"></script> 
```

'ver' 参数会在每次构建时自动更新（从构建更新的文件中读取）。这确保脚本仅针对当前修订进行缓存。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2012-09-12T22:35:37.383

与@eran-galperin 一样，我在对 JS 文件的引用中使用了一个参数，但我包含了一个服务器生成的对文件“最后修改”日期的引用。@stein-g-strindhaug 建议使用这种方法。它看起来像这样：

```
<script type="text/javascript" src="/path/to/script.js?1347486578"></script> 
```

服务器忽略静态文件的参数，客户端可能会缓存脚本，直到日期代码更改。如果（且仅当）您修改服务器上的 JS 文件，日期代码将自动更改。

例如，在 PHP 中，我创建此代码的脚本如下所示：

```
function cachePreventCode($filename) {
    if (!file_exists($filename))
        return "";
    $mtime = filemtime($filename);
    return $mtime;
} 
```

因此，当您的 PHP 文件包含对 CSS 文件的引用时，它可能如下所示：

```
<link rel="stylesheet" type="text/css" href="main.css?<?= cachePreventCode("main.css") ?>" /> 
```

...这将创建...

```
<link rel="stylesheet" type="text/css" href="main.css?1347489244" /> 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-10T20:03:50.460

关于缓存文件，我还没有通过使用查询字符串方法遇到与过时缓存文件相关的错误问题。

然而，关于性能，并回应[Todd B](https://stackoverflow.com/users/45046/todd-berman)提到的按文件名加速，请查看 Steve Souders 的工作以了解有关该主题的更多信息：

*“Squid 是一种流行的代理，它不会使用查询字符串缓存资源。当代理缓存后面的多个用户请求同一个文件时，这会损害性能 - 而不是使用每个人都必须向源服务器发送请求的缓存版本。”*

*“代理管理员可以更改配置以支持使用查询字符串缓存资源，当缓存标头指示合适时。但默认配置是 Web 开发人员最常遇到的。”*

[http://www.stevesouders.com/blog/2008/08/23/revving-filenames-dont-use-querystring/](http://www.stevesouders.com/blog/2008/08/23/revving-filenames-dont-use-querystring/)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-10T15:58:12.360

使用带有标头的`conditional get`请求`If-Modified-Since`

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-10T16:12:18.710

这实际上是一个非常困难的问题，您可以花一些时间来设计正确的解决方案。

我建议使用 url 中内置的时间戳和/或版本发布您的文件，而不是：

/media/js/my.js 你最终得到：

/media/js/v12/my.js 或类似的东西。

您可以使用任何工具自动执行版本控制/时间戳。

这具有在推出新版本时不会破坏站点的额外好处，并允许您进行真正的并行测试（与仅剥离版本并发回最新文件的重写规则不同）。

使用 JS 或 CSS 需要注意的一件事是，当您在其中包含依赖 url（背景图像等）时，您需要确保 JS/CSS 时间戳/版本在内部资源发生变化时发生变化（以及重写它们，但这可以通过非常简单的正则表达式和资源清单来实现）。

无论您做什么，请确保不要在最后扔一个 ?vblah，因为当您这样做时，您基本上会将缓存扔出窗口（这是不幸的，因为它是迄今为止处理此问题的最简单方法）

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-10T18:12:36.487

如果您将文件的“修改时间”作为时间戳获取，它将被缓存，直到文件被修改。只需使用辅助函数（或在其他框架中调用的任何函数）来添加从文件中获取时间戳的 script/css/image 标记。在类似unix的系统（大多数幸存者都是）上，您可以简单地`touch`文件强制修改时间在必要时进行更改。

Ruby on Rails 在生产模式下使用此策略（默认情况下我会离开），并在开发模式下使用普通时间戳（以确保没有缓存某些内容）。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2015-08-14T18:44:24.783

如果你使用 MAVEN，你可以使用这个，在 pom.xml 上添加：

```
<properties>
   <maven.build.timestamp.format>yyyyMMddHHmm</maven.build.timestamp.format>
   <timestamp>${maven.build.timestamp}</timestamp>
</properties> 
```

有了这个，你可以在你的视图中访问 ${timestamp}。像这个样本：

```
<script type="text/javascript" src="/js/myScript.js?t=${timestamp}"></script> 
```

# vb.net - VB .NET (.NET 2.0) Class Library configuration

> ID：356557
> 
> 赞同：2
> 
> 时间：2008-12-10T15:54:27.467
> 
> 标签：vb.net, configuration, class-library

I have created a class library in VB .NET. Some code in the library connects to the database. I want to create a config file that would hold the connection string.

I have created a "Settings.settings" file and stored the connection string in there.

When a class library having a settings file is built, it generates a ".dll.config" file which has the key value pairs defined in the settings file.

Problem with this is when i change the connection string in the ".dll.config" file, the library does not references these changes. I would still need to recompile the class library which would then overwrite my changes in the .dll.config file.

I need to be able to change the connection strings on the fly without having to recompile the library.

Is there a mechanism in VB.NET class library (.NET 2.0) that would let me do this?

Passing the connection string to the class library from the web page that uses its method is not a option.

I have listed a sample below, this is how i would access the string.

```
    Public Function getsettings(ByVal Setting As String) As String
        If Setting = "Demo" Then
            Return My.Settings.Demo
        Else
            Return My.Settings.Live
        End If
    End Function

```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-10T15:57:33.327

If you have an application which uses your library called MyApp, then the connection string defined in MyApp.exe.config will be available to your library. Generally speaking the client program should set the configuration environment, not the library.

```
If GetApplicationSetting("connectionString") Is Nothing Then
    Throw New Exception("Could not retrieve connection string from .config file")
Else
    Return ConfigurationManager.AppSettings.Item("connectionString")
End If 
```

Make sure you have the System.Configuration framework loaded to access the ConfigurationManager.

EDIT 1: If you are using it in a web-application, then set the connection string in web.config.

EDIT 2: If you set the connection string in the ConnectionStrings section of the .exe.config or web.config you can access it using :

```
ConfigurationManager.ConnectionStrings("MyConnectionString") 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-10T15:58:15.370

Config files are specific to the application. So if your DLL is used by an application, the app.config or web.config needs to have the entries you are trying to use in the DLL config.

Unfortunately the "Not an option" is probably the correct option.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-10T16:03:16.983

We have multiple libraries that have the same requirement. We set it up so that our class library directly retrieves the connection string from the web.config file of the application that is using it. When you say:

> Passing the connection string to the class library from the web page that uses its method is not a option.

In theory, the web page is not passing the con str as a parameter, but the class library is just directly taking it from the web.config file.

# asp.net - Web 身份验证状态 - 会话与 Cookie？

> ID：356562
> 
> 赞同：28
> 
> 时间：2008-12-10T15:55:41.413
> 
> 标签：asp.net, security, authentication, cookies, session-variables

从页面到页面进行身份验证和跟踪用户身份验证状态的最佳方法是什么？有人说会话状态，有人说 cookie？

我可以只使用具有用户 ID 的会话变量，并在身份验证后，实例化一个包含用户信息的自定义用户类。然后，在每个页面上，验证会话变量是否仍然处于活动状态并从 User 对象访问基本用户数据？

有什么想法吗？有什么好的例子吗？

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2008-12-10T16:17:37.173

为了“安全”而偏爱会话而不是 cookie 的问题是会话使用 cookie 来识别用户，因此会话存在任何关于 cookie 的问题。

使用 Sessions 时要记住的一件事是数据局部性。如果您计划在任何时候扩展到多个网络服务器，则需要非常小心地将大量数据存储在会话对象中。

由于您使用的是 .NET，因此您基本上必须编写自己的会话存储提供程序来处理这个问题，因为 InProc 不会扩展到超过 1 个服务器，数据库提供程序完全是一个坏主意（重点是要避免数据库读取这里边扩容，不加多），而且StateServer有很多容量问题。（过去，我曾使用过 memcached 会话存储提供程序并取得了一些成功来解决这个问题）。

我会在谷歌上搜索签名的 cookie，并考虑使用它而不是常规的 cookie 或会话。它解决了很多安全问题，并消除了会话的局部性问题。请记住，它们会根据每个请求来回返回，因此请谨慎存储数据。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2008-12-10T16:04:08.540

没有*完美*的方法来做到这一点。如果您将其存储在 cookie 中，您会认为 cookie 可能会被盗。如果您将其存储在会话中，您将受到攻击，因为会话可能被劫持。

就个人而言，我倾向于认为会话更可靠一些，因为唯一存储在客户端上的是会话密钥。实际数据保留在服务器上。如果你愿意的话，它会在离胸部更近的地方打牌。然而，这只是我的偏好，一个好的黑客无论如何都能够通过伪劣的安全性。

无论您做什么，都不要尝试自己实现。你会弄错的。使用您的特定平台提供的身份验证系统。您还需要确保有足够的安全预防措施来保护身份验证令牌。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-10T16:06:07.290

我不知道这是否是最好的方式，但我们对我们的方式感到满意。

我们有一个自定义用户对象，我们在用户进行身份验证时实例化它，然后我们使用 Session 在整个应用程序中维护这个对象。

在某些应用程序中，我们将其与 cookie 的使用结合起来以持续扩展会话。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-11T01:06:04.547

Cookies 和 Sessions 本身还不够。它们是用于跟踪用户及其行为的工具，但您确实需要考虑使用数据库来保存有关用户的信息，这些信息也可用于保护应用程序。

* * *

## 回答 #5

> 赞同：-3
> 
> 时间：2009-03-10T15:43:02.137

会话是 Cookie...

# c# - 当属性等于 NHibernate 的 Max 时选择对象

> ID：356570
> 
> 赞同：11
> 
> 时间：2008-12-10T15:57:30.223
> 
> 标签：c#, nhibernate

我们有一个查询，它根据另一个值来选择行，即。最大。我认为这没有多大意义，所以这里是查询：

```
var deatched = DetachedCriteria.For<Enquiry>("e2")
   .SetProjection(Projections.Alias(Projections.Max("Property"), "maxProperty"))
   .Add(Restrictions.EqProperty("e2.EnquiryCode", "e.EnquiryCode"));

session.CreateCriteria(typeof(Enquiry), "e")
   .Add(Subqueries.PropertyEq("Property", deatched))
   .AddOrder(Order.Asc("EnquiryCode")); 
```

我的问题是，这是最好的方法吗？任何人都可以提出更好的方法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2011-12-01T18:58:42.890

对于聚合，最好使用 SQL 而不是 HQL。仅将 Nhibernate 用于主要实体及其关系（非常可维护的设计）。存储过程是这些聚合和函数的更好位置，因为它们依赖于数据而不依赖于对象

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-08-28T01:29:33.440

您应该能够通过投影来做到这一点：

```
session.CreateCriteria(typeof(Customer))
  .SetProjection( Projections.Max("Id") )
  .UniqueResult(); 
```

如所述[Nhibernate Criteria: 'select max(id)...'](https://stackoverflow.com/questions/1278276/nhibernate-criteria-select-maxid)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-07-19T16:50:03.590

我认为这必须有效：

```
(from e in NHibernateSession().Query<Enquiry>()
    where e.Property == (
    (
        from e2 NHibernateSession().Query<Enquiry>()
        where e2.EnqueryCode == e.EnquiryCode
        select e2.Property).Max()
    )
    select e
).ToList<Enquiry>() 
```

# mysql - 如何以 CSV 格式输出 MySQL 查询结果？

> ID：356578
> 
> 赞同：1347
> 
> 时间：2008-12-10T15:59:51.733
> 
> 标签：mysql, csv, quotes

有没有一种简单的方法可以从 Linux 命令行运行 MySQL 查询并以[CSV](http://en.wikipedia.org/wiki/Comma-separated_values)格式输出结果？

这就是我现在正在做的事情：

```
mysql -u uid -ppwd -D dbname << EOQ | sed -e 's/        /,/g' | tee list.csv
select id, concat("\"",name,"\"") as name
from students
EOQ 
```

当有很多列需​​要用引号括起来，或者结果中有引号需要转义时，它会变得混乱。

* * *

## 回答 #1

> 赞同：1935
> 
> 时间：2008-12-10T16:07:55.443

从*[将 MySQL 查询结果保存到文本或 CSV 文件中](http://www.tech-recipes.com/rx/1475/save-mysql-query-results-into-a-text-or-csv-file/)*：

```
SELECT order_id,product_name,qty
FROM orders
WHERE foo = 'bar'
INTO OUTFILE '/var/lib/mysql-files/orders.csv'
FIELDS TERMINATED BY ','
ENCLOSED BY '"'
LINES TERMINATED BY '\n'; 
```

注意：该语法可能需要重新排序为

```
SELECT order_id,product_name,qty
INTO OUTFILE '/var/lib/mysql-files/orders.csv'
FIELDS TERMINATED BY ','
ENCLOSED BY '"'
LINES TERMINATED BY '\n'
FROM orders
WHERE foo = 'bar'; 
```

在最新版本的 MySQL 中。

使用此命令，列名将不会被导出。

另请注意，`/var/lib/mysql-files/orders.csv`它将在运行 MySQL的*服务器上。*运行 MySQL 进程的用户必须具有写入所选目录的权限，否则命令将失败。

[如果您想从远程服务器（尤其是托管或虚拟化机器，如Heroku](https://en.wikipedia.org/wiki/Heroku)或[Amazon RDS](https://en.wikipedia.org/wiki/Amazon_Relational_Database_Service) ）将输出写入本地机器，则此解决方案不适合。

* * *

## 回答 #2

> 赞同：525
> 
> 时间：2010-04-08T16:53:24.607

```
mysql your_database --password=foo < my_requests.sql > out.csv 
```

这是制表符分隔的。像这样通过管道获取真正的 CSV（感谢[用户*John Carter*](https://stackoverflow.com/questions/356578/how-to-output-mysql-query-results-in-csv-format#comment9895539_2601837)）：

```
... .sql | sed 's/\t/,/g' > out.csv 
```

* * *

## 回答 #3

> 赞同：227
> 
> 时间：2009-09-30T10:51:27.487

> mysql --批处理，-B
> 
> 使用制表符作为列分隔符打印结果，每行换行。使用此选项，mysql 不使用历史文件。批处理模式导致非表格输出格式和特殊字符转义。使用 raw 模式可以禁用转义；请参阅 --raw 选项的说明。

这将为您提供一个制表符分隔的文件。由于逗号（或包含逗号的字符串）没有转义，因此将分隔符更改为逗号并不简单。

* * *

## 回答 #4

> 赞同：173
> 
> 时间：2011-03-22T17:31:58.460

这是一种相当粗糙的方法^([1])：

```
mysql --user=wibble --password wobble -B -e "select * from vehicle_categories;" | sed "s/'/\'/;s/\t/\",\"/g;s/^/\"/;s/$/\"/;s/\n//g" > vehicle_categories.csv 
```

它工作得很好。不过，正则表达式再一次证明是只写的。

* * *

正则表达式解释：

*   s/// 表示将第一个之间的内容替换为 // 与第二个之间的内容 //
*   最后的“g”是一个修饰符，意思是“所有实例，而不仅仅是第一个”
*   ^（在此上下文中）表示行首
*   $（在这种情况下）表示行尾

所以，把它们放在一起：

```
s/'/\'/          Replace ' with \'
s/\t/\",\"/g     Replace all \t (tab) with ","
s/^/\"/          at the beginning of the line place a "
s/$/\"/          At the end of the line, place a "
s/\n//g          Replace all \n (newline) with nothing 
```

^([1] 我在某个地方找到了它，无法获得任何信任。)

* * *

## 回答 #5

> 赞同：114
> 
> 时间：2012-10-11T15:19:41.340

通过 'tr' 管道（仅限 Unix/ [Cygwin](http://en.wikipedia.org/wiki/Cygwin)）：

```
mysql <database> -e "<query here>" | tr '\t' ',' > data.csv 
```

注意：这既不处理嵌入的逗号，也不处理嵌入的选项卡。

* * *

## 回答 #6

> 赞同：71
> 
> 时间：2016-01-29T13:52:47.823

这救了我几次。它速度快而且有效！

> [--batch](http://dev.mysql.com/doc/refman/5.7/en/mysql-command-options.html#option_mysql_batch) *使用**制表符**作为列分隔符打印结果，每行换行。*
> 
> [--raw](http://dev.mysql.com/doc/refman/5.7/en/mysql-command-options.html#option_mysql_raw) *禁用字符转义（\n、\t、\0 和 \）*

例子：

```
mysql -udemo_user -p -h127.0.0.1 --port=3306 \
   --default-character-set=utf8mb4 --database=demo_database \
   --batch --raw < /tmp/demo_sql_query.sql > /tmp/demo_csv_export.tsv 
```

为了完整起见，您可以[转换为 CSV](https://stackoverflow.com/a/23055159/2450431)（但**要小心**，因为选项卡可能位于字段值内 - 例如，文本字段）

> `tr '\t' ',' < file.tsv > file.csv`

* * *

## 回答 #7

> 赞同：42
> 
> 时间：2010-06-22T13:48:00.397

[Paul Tomblin 给出](https://stackoverflow.com/questions/356578/how-can-i-output-mysql-query-results-in-csv-format/356605#356605)的 OUTFILE 解决方案导致将文件写入 MySQL 服务器本身，因此只有当您具有[FILE](http://dev.mysql.com/doc/refman/5.0/en/privileges-provided.html#priv_file)访问权限以及登录访问权限或从该框中检索文件的其他方式时，这才有效。

如果您没有这样的访问权限，并且制表符分隔的输出是 CSV 的合理替代品（例如，如果您的最终目标是导入 Excel），那么[serbaut 的解决方案](https://stackoverflow.com/questions/356578/how-can-i-output-mysql-query-results-in-csv-format/1497377#1497377)（使用`mysql --batch`和可选`--raw`）是可行的方法。

* * *

## 回答 #8

> 赞同：41
> 
> 时间：2012-06-26T17:15:54.913

[MySQL Workbench](https://www.mysql.com/products/workbench/)可以将记录集导出为 CSV，而且它似乎很好地处理了字段中的逗号。[CSV 可以在OpenOffice](https://en.wikipedia.org/wiki/OpenOffice.org) [Calc](https://en.wikipedia.org/wiki/LibreOffice_Calc)中正常打开。

* * *

## 回答 #9

> 赞同：34
> 
> 时间：2011-11-10T18:41:05.193

采用：

```
mysql your_database -p < my_requests.sql | awk '{print $1","$2}' > out.csv 
```

* * *

## 回答 #10

> 赞同：33
> 
> 时间：2013-10-11T05:04:34.450

迄今为止，这里的所有解决方案，除了[MySQL Workbench 之一](https://stackoverflow.com/questions/356578/how-can-i-output-mysql-query-results-in-csv-format/11212611#11212611)，对于 MySQL 数据库中的至少一些可能的内容都是不正确的并且很可能是不安全的（即安全问题）。

MySQL Workbench（和类似的[phpMyAdmin](https://en.wikipedia.org/wiki/PhpMyAdmin)）提供了形式上正确的解决方案，但它们旨在将输出下载到用户的位置。它们对于自动数据导出之类的事情不是那么有用。

无法从 的输出中生成可靠正确的 CSV 内容，`mysql -B -e 'SELECT ...'`因为它无法对字段中的回车和空格进行编码。'-s' 标志`mysql`确实会进行反斜杠转义，并可能导致正确的解决方案。但是，使用脚本语言（一种具有良好内部数据结构的语言，而不是 Bash）和已经仔细解决了编码问题的库要安全得多。

我曾想过为此编写一个脚本，但一想到我会如何称呼它，我就想到要搜索已存在的同名作品。虽然我还没有彻底了解它，[但 mysql2csv](https://github.com/robmiller/mysql2csv)看起来很有希望。根据您的应用程序，指定 SQL 命令的 YAML 方法可能会或可能不会有吸引力。我对 Ruby 的更新版本的要求也并不感到兴奋，而不是我的[Ubuntu 12.04](https://en.wikipedia.org/wiki/Ubuntu_version_history#Ubuntu_12.04_LTS_.28Precise_Pangolin.29)（Precise Pangolin）笔记本电脑或[Debian 6.0](https://en.wikipedia.org/wiki/Debian_version_history#Debian_6.0_(Squeeze))（Squeeze）服务器的标准配置。是的，我知道我可以使用 RVM，但我不想为了这么简单的目的而维护它。

* * *

## 回答 #11

> 赞同：31
> 
> 时间：2016-02-01T05:52:26.810

此页面上的许多答案都很薄弱，因为它们不处理 CSV 格式中可能发生的一般情况。例如，嵌入在字段中的逗号和引号以及最终总会出现的其他条件。我们需要一个适用于所有有效 CSV 输入数据的通用解决方案。

这是 Python 中一个简单而强大的解决方案：

```
#!/usr/bin/env python

import csv
import sys

tab_in = csv.reader(sys.stdin, dialect=csv.excel_tab)
comma_out = csv.writer(sys.stdout, dialect=csv.excel)

for row in tab_in:
    comma_out.writerow(row) 
```

命名那个文件`tab2csv`，把它放在你的路径上，给它执行权限，然后像这样使用它：

```
mysql OTHER_OPTIONS --batch --execute='select * from whatever;' | tab2csv > outfile.csv 
```

Python CSV 处理函数涵盖了 CSV 输入格式的极端情况。

这可以通过流式处理改进以处理非常大的文件。

* * *

## 回答 #12

> 赞同：27
> 
> 时间：2015-06-25T06:50:02.497

在命令行中，您可以执行以下操作：

```
mysql -h *hostname* -P *port number* --database=*database_name* -u *username* -p -e *your SQL query* | sed 's/\t/","/g;s/^/"/;s/$/"/;s/\n//g' > *output_file_name.csv* 
```

**致谢：** *[将表从 Amazon RDS 导出到 CSV 文件](https://stackoverflow.com/questions/9536224/exporting-table-from-amazon-rds-into-a-csv-file)*

* * *

## 回答 #13

> 赞同：18
> 
> 时间：2017-01-24T23:02:33.973

此答案使用 Python 和流行的第三方库[PyMySQL](https://github.com/PyMySQL/PyMySQL)。我添加它是因为 Python 的[csv](https://docs.python.org/3/library/csv.html)库足够强大，可以*正确*处理许多不同的风格，`.csv`并且没有其他答案是使用 Python 代码与数据库进行交互。

```
import contextlib
import csv
import datetime
import os

# https://github.com/PyMySQL/PyMySQL
import pymysql

SQL_QUERY = """
SELECT * FROM my_table WHERE my_attribute = 'my_attribute';
"""

# embedding passwords in code gets nasty when you use version control
# the environment is not much better, but this is an example
# https://stackoverflow.com/questions/12461484
SQL_USER = os.environ['SQL_USER']
SQL_PASS = os.environ['SQL_PASS']

connection = pymysql.connect(host='localhost',
                             user=SQL_USER,
                             password=SQL_PASS,
                             db='dbname')

with contextlib.closing(connection):
    with connection.cursor() as cursor:
        cursor.execute(SQL_QUERY)
        # Hope you have enough memory :)
        results = cursor.fetchall()

output_file = 'my_query-{}.csv'.format(datetime.datetime.today().strftime('%Y-%m-%d'))
with open(output_file, 'w', newline='') as csvfile:
    # http://stackoverflow.com/a/17725590/2958070 about lineterminator
    csv_writer = csv.writer(csvfile, lineterminator='\n')
    csv_writer.writerows(results) 
```

* * *

## 回答 #14

> 赞同：15
> 
> 时间：2020-02-16T10:39:33.843

我遇到了同样的问题，[Paul's Answer](https://stackoverflow.com/a/356605/1318648)不是一个选项，因为它是[Amazon RDS](https://en.wikipedia.org/wiki/Amazon_Relational_Database_Service)。用逗号替换制表符不起作用，因为数据已嵌入逗号和制表符。我发现[mycli](https://www.mycli.net/)是 mysql-client 的替代方案，它支持开箱即用的 CSV 输出，带有以下`--csv`标志：

```
mycli db_name --csv -e "select * from flowers" > flowers.csv 
```

* * *

## 回答 #15

> 赞同：14
> 
> 时间：2011-12-06T18:50:13.263

这很简单，它适用于任何东西，而不需要批处理模式或输出文件：

```
select concat_ws(',',
    concat('"', replace(field1, '"', '""'), '"'),
    concat('"', replace(field2, '"', '""'), '"'),
    concat('"', replace(field3, '"', '""'), '"'))

from your_table where etc; 
```

解释：

1.  在每个字段中替换`"`为-->`""``replace(field1, '"', '""')`
2.  将每个结果用引号括起来 -->`concat('"', result1, '"')`
3.  在每个引用的结果之间放置一个逗号 -->`concat_ws(',', quoted1, quoted2, ...)`

就是这样！

* * *

## 回答 #16

> 赞同：14
> 
> 时间：2018-01-13T15:17:10.527

此外，如果您在 Bash 命令行上执行查询，我相信该`tr`命令可用于将默认制表符替换为任意分隔符。

```
$ echo "SELECT * FROM Table123" | mysql Database456 | tr "\t" , 
```

* * *

## 回答 #17

> 赞同：11
> 
> 时间：2008-12-10T23:34:58.460

您可以拥有一个使用 CSV 引擎的 MySQL 表。

然后，您将在硬盘上拥有一个始终为 CSV 格式的文件，您可以直接复制它而无需处理它。

* * *

## 回答 #18

> 赞同：10
> 
> 时间：2014-10-23T16:09:02.107

为了扩展先前的答案，以下单行将单个表导出为制表符分隔的文件。适用于自动化，每天左右导出数据库。

```
mysql -B -D mydatabase -e 'select * from mytable' 
```

方便的是，我们可以使用相同的技术列出 MySQL 的表，并描述单个表上的字段：

```
mysql -B -D mydatabase -e 'show tables'

mysql -B -D mydatabase -e 'desc users'

Field   Type    Null    Key Default Extra
id  int(11) NO  PRI NULL    auto_increment
email   varchar(128)    NO  UNI NULL    
lastName    varchar(100)    YES     NULL    
title   varchar(128)    YES UNI NULL    
userName    varchar(128)    YES UNI NULL    
firstName   varchar(100)    YES     NULL 
```

* * *

## 回答 #19

> 赞同：8
> 
> 时间：2011-07-07T17:34:02.467

这就是我所做的：

```
echo $QUERY | \
  mysql -B  $MYSQL_OPTS | \
  perl -F"\t" -lane 'print join ",", map {s/"/""/g; /^[\d.]+$/ ? $_ : qq("$_")} @F ' | \
  mail -s 'report' person@address 
```

Perl 脚本（从别处截取）在将制表符间隔字段转换为 CSV 方面做得很好。

* * *

## 回答 #20

> 赞同：8
> 
> 时间：2015-05-29T18:36:18.417

基于 user7610，这是最好的方法。有`mysql outfile`60 分钟的文件所有权和覆盖问题。

这并不酷，但它在 5 分钟内工作。

`php csvdump.php localhost root password database tablename > whatever-you-like.csv`

```
<?php

$server = $argv[1];
$user = $argv[2];
$password = $argv[3];
$db = $argv[4];
$table = $argv[5];

mysql_connect($server, $user, $password) or die(mysql_error());
mysql_select_db($db) or die(mysql_error());

// fetch the data
$rows = mysql_query('SELECT * FROM ' . $table);
$rows || die(mysql_error());

// create a file pointer connected to the output stream
$output = fopen('php://output', 'w');

// output the column headings

$fields = [];
for($i = 0; $i < mysql_num_fields($rows); $i++) {
    $field_info = mysql_fetch_field($rows, $i);
    $fields[] = $field_info->name;
}
fputcsv($output, $fields);

// loop over the rows, outputting them
while ($row = mysql_fetch_assoc($rows)) fputcsv($output, $row);

?> 
```

* * *

## 回答 #21

> 赞同：5
> 
> 时间：2014-05-29T18:14:01.920

不完全是 CSV 格式，但MySQL**客户端的**[`tee`命令](https://dev.mysql.com/doc/refman/5.0/en/mysql-commands.html#idm47025436151712)可用于将输出保存到**本地**文件中：

 ****```
tee foobar.txt
SELECT foo FROM bar; 
```

您可以使用禁用它`notee`。

问题`SELECT … INTO OUTFILE …;`在于它需要在服务器上写入文件的权限。

* * *

## 回答 #22

> 赞同：5
> 
> 时间：2018-11-07T06:15:26.320

什么对我有用：

```
SELECT *
FROM students
WHERE foo = 'bar'
LIMIT 0,1200000
INTO OUTFILE './students-1200000.csv'
FIELDS TERMINATED BY ',' ESCAPED BY '"'
ENCLOSED BY '"'
LINES TERMINATED BY '\r\n'; 
```

这个线程上的解决方案都不适用于我的特殊情况。我在其中一列中有漂亮的 JSON 数据，这会在我的 CSV 输出中搞砸。对于那些有类似问题的人，请尝试以 \r\n 结尾的行。

对于那些试图用 Microsoft Excel 打开 CSV 的人来说，还有另一个问题，请记住，单个单元格可以容纳的字符数限制为 32,767 个，超过该字符数会溢出到下面的行。要确定列中的哪些记录存在问题，请使用以下查询。然后，您可以截断这些记录或根据需要处理它们。

```
SELECT id,name,CHAR_LENGTH(json_student_description) AS 'character length'
FROM students
WHERE CHAR_LENGTH(json_student_description)>32767; 
```

* * *

## 回答 #23

> 赞同：4
> 
> 时间：2020-09-21T10:12:35.653

在我的情况下`from table_name .....` ，之前`INTO OUTFILE .....` 给出了一个错误：

> 子句的意外排序。（靠近位置 10 的“FROM”）

什么对我有用：

```
SELECT *
INTO OUTFILE '/Volumes/Development/sql/sql/enabled_contacts.csv'
FIELDS TERMINATED BY ','
ENCLOSED BY '"'
LINES TERMINATED BY '\n'
FROM table_name
WHERE column_name = 'value' 
```

* * *

## 回答 #24

> 赞同：3
> 
> 时间：2013-05-16T08:04:06.547

使用[Tim Harding 发布的解决方案](https://stackoverflow.com/questions/356578/how-can-i-output-mysql-query-results-in-csv-format/5395421#5395421)，我创建了这个 Bash 脚本来简化该过程（需要 root 密码，但您可以轻松修改脚本以询问任何其他用户）：

```
#!/bin/bash

if [ "$1" == "" ];then
    echo "Usage: $0 DATABASE TABLE [MYSQL EXTRA COMMANDS]"
    exit
fi

DBNAME=$1
TABLE=$2
FNAME=$1.$2.csv
MCOMM=$3

echo "MySQL password: "
stty -echo
read PASS
stty echo

mysql -uroot -p$PASS $MCOMM $DBNAME -B -e "SELECT * FROM $TABLE;" | sed "s/'/\'/;s/\t/\",\"/g;s/^/\"/;s/$/\"/;s/\n//g" > $FNAME 
```

它将创建一个名为：**database.table.csv的文件**

* * *

## 回答 #25

> 赞同：3
> 
> 时间：2018-05-16T10:19:23.233

如果您在服务器上设置了 PHP，则可以使用[mysql2csv](https://gist.github.com/paslandau/37bf787eab1b84fc7ae679d1823cf401)为任意 MySQL 查询导出（实际有效的）CSV 文件。请参阅[我在 MySQL - SELECT * INTO OUTFILE LOCAL 的回答？](https://stackoverflow.com/a/50367870/413531)了解更多上下文/信息。

我试图维护选项名称，`mysql`因此提供`--file`and`--query`选项就足够了：

```
./mysql2csv --file="/tmp/result.csv" --query='SELECT 1 as foo, 2 as bar;' --user="username" --password="password" 
```

**“安装”`mysql2csv`通过**

```
wget https://gist.githubusercontent.com/paslandau/37bf787eab1b84fc7ae679d1823cf401/raw/29a48bb0a43f6750858e1ddec054d3552f3cbc45/mysql2csv -O mysql2csv -q && (sha256sum mysql2csv | cmp <(echo "b109535b29733bd596ecc8608e008732e617e97906f119c66dd7cf6ab2865a65  mysql2csv") || (echo "ERROR comparing hash, Found:" ;sha256sum mysql2csv) ) && chmod +x mysql2csv 
```

（下载 gist 的内容，检查校验和并使其可执行。）

* * *

## 回答 #26

> 赞同：3
> 
> 时间：2019-07-16T19:48:24.490

以下生成**制表符分隔且有效的**CSV 输出。与大多数其他答案不同，此技术可以正确处理制表符、逗号、引号和换行符的转义，而无需任何流过滤器，例如[sed](https://en.wikipedia.org/wiki/Sed)、[AWK](https://en.wikipedia.org/wiki/AWK)或[tr](https://en.wikipedia.org/wiki/Tr_(Unix))。

该示例展示了如何使用流将远程 MySQL 表直接通过管道传输到本地[SQLite](https://en.wikipedia.org/wiki/SQLite)数据库。这无需 FILE 权限或 SELECT INTO OUTFILE 权限即可工作。为了便于阅读，我添加了新行。

```
mysql -B -C --raw -u 'username' --password='password' --host='hostname' 'databasename'
-e 'SELECT
    CONCAT('\''"'\'',REPLACE(`id`,'\''"'\'', '\''""'\''),'\''"'\'') AS '\''id'\'',
    CONCAT('\''"'\'',REPLACE(`value`,'\''"'\'', '\''""'\''),'\''"'\'') AS '\''value'\''
    FROM sampledata'
2>/dev/null | sqlite3 -csv -separator $'\t' mydb.db '.import /dev/stdin mycsvtable' 
```

需要在`2>/dev/null`命令行上禁止有关密码的警告。

如果您的数据有 NULL，您可以在查询中使用 IFNULL() 函数。

* * *

## 回答 #27

> 赞同：3
> 
> 时间：2021-08-03T16:07:48.227

Python 中的一个简单解决方案，它使用标头编写标准格式的 CSV 文件并将数据作为流写入（低内存使用）：

```
import csv

def export_table(connection, table_name, output_filename):
    cursor = connection.cursor()
    cursor.execute("SELECT * FROM " + table_name)

    # thanks to https://gist.github.com/madan712/f27ac3b703a541abbcd63871a4a56636 for this hint
    header = [descriptor[0] for descriptor in cursor.description]

    with open(output_filename, 'w') as csvfile:
        csv_writer = csv.writer(csvfile, dialect='excel')
        csv_writer.writerow(header)
        for row in cursor:
            csv_writer.writerow(row) 
```

你可以像这样使用它：

```
import mysql.connector as mysql
# (or https://github.com/PyMySQL/PyMySQL should work but I haven't tested it)

db = mysql.connect(
    host="localhost",
    user="USERNAME",
    db="DATABASE_NAME",
    port=9999)

for table_name in ['table1', 'table2']:
    export_table(db, table_name, table_name + '.csv')

db.close() 
```

为简单起见，这故意不包括来自[另一个答案](https://stackoverflow.com/a/41840534/69707)的一些更花哨的东西，比如使用环境变量作为凭据，`contextlib`等等。那里提到了一个关于我没有评估的行尾的微妙之处。

* * *

## 回答 #28

> 赞同：2
> 
> 时间：2018-03-01T12:23:23.677

*[受Tim Harding 的回答](https://stackoverflow.com/questions/356578/how-can-i-output-mysql-query-results-in-csv-format/5395421#5395421)*启发，用于对 CSV 转储进行简单查询的 Tiny Bash 脚本。

```
#!/bin/bash

# $1 = query to execute
# $2 = outfile
# $3 = mysql database name
# $4 = mysql username

if [ -z "$1" ]; then
    echo "Query not given"
    exit 1
fi

if [ -z "$2" ]; then
    echo "Outfile not given"
    exit 1
fi

MYSQL_DB=""
MYSQL_USER="root"

if [ ! -z "$3" ]; then
    MYSQL_DB=$3
fi

if [ ! -z "$4" ]; then
    MYSQL_USER=$4
fi

if [ -z "$MYSQL_DB" ]; then
    echo "Database name not given"
    exit 1
fi

if [ -z "$MYSQL_USER" ]; then
    echo "Database user not given"
    exit 1
fi

mysql -u $MYSQL_USER -p -D $MYSQL_DB -B -s -e "$1" | sed "s/'/\'/;s/\t/\",\"/g;s/^/\"/;s/$/\"/;s/\n//g" > $2
echo "Written to $2" 
```

* * *

## 回答 #29

> 赞同：2
> 
> 时间：2019-12-20T15:27:01.237

如果您遇到错误，`secure-file-priv`那么在将您的目标文件位置转移到内部`C:\ProgramData\MySQL\MySQL Server 8.0\Uploads`之后以及在查询之后 -

`SELECT * FROM attendance INTO OUTFILE 'C:\ProgramData\MySQL\MySQL Server 8.0\Uploads\FileName.csv' FIELDS TERMINATED BY ',' ENCLOSED BY '"' LINES TERMINATED BY '\n';`

不起作用，您只需将`\`(backsplash) 从查询更改为`/`(forwardsplash)

那行得通！

例子：

> SELECT * FROM Attendance INTO OUTFILE 'C:/ProgramData/MySQL/MySQL Server 8.0/Uploads/FileName.csv' FIELDS TERMINATED BY ',' ENCLOSED BY '"' LINES TERMINATED BY '\n';

每次运行成功查询时，每次都会生成新的 CSV 文件！很酷，对吧？

* * *

## 回答 #30

> 赞同：1
> 
> 时间：2018-05-14T15:19:27.377

以下 Bash 脚本适用于我。它还可以选择获取所请求表的架构。

```
#!/bin/bash
#
# Export MySQL data to CSV
#https://stackoverflow.com/questions/356578/how-to-output-mysql-query-results-in-csv-format
#

# ANSI colors
#http://www.csc.uvic.ca/~sae/seng265/fall04/tips/s265s047-tips/bash-using-colors.html
blue='\033[0;34m'
red='\033[0;31m'
green='\033[0;32m' # '\e[1;32m' is too bright for white bg.
endColor='\033[0m'

#
# A colored message
#   params:
#     1: l_color - the color of the message
#     2: l_msg - the message to display
#
color_msg() {
  local l_color="$1"
  local l_msg="$2"
  echo -e "${l_color}$l_msg${endColor}"
}

#
# Error
#
# Show the given error message on standard error and exit
#
#   Parameters:
#     1: l_msg - the error message to display
#
error() {
  local l_msg="$1"
  # Use ANSI red for error
  color_msg $red "Error:" 1>&2
  color_msg $red "\t$l_msg" 1>&2
  usage
}

#
# Display usage
#
usage() {
  echo "usage: $0 [-h|--help]" 1>&2
  echo "               -o  | --output      csvdirectory"    1>&2
  echo "               -d  | --database    database"   1>&2
  echo "               -t  | --tables      tables"     1>&2
  echo "               -p  | --password    password"   1>&2
  echo "               -u  | --user        user"       1>&2
  echo "               -hs | --host        host"       1>&2
  echo "               -gs | --get-schema"             1>&2
  echo "" 1>&2
  echo "     output: output CSV directory to export MySQL data into" 1>&2
  echo "" 1>&2
  echo "         user: MySQL user" 1>&2
  echo "     password: MySQL password" 1>&2
  echo "" 1>&2
  echo "     database: target database" 1>&2
  echo "       tables: tables to export" 1>&2
  echo "         host: host of target database" 1>&2
  echo "" 1>&2
  echo "  -h|--help: show help" 1>&2
  exit 1
}

#
# show help
#
help() {
  echo "$0 Help" 1>&2
  echo "===========" 1>&2
  echo "$0 exports a CSV file from a MySQL database optionally limiting to a list of tables" 1>&2
  echo "   example: $0 --database=cms --user=scott --password=tiger  --tables=person --output person.csv" 1>&2
  echo "" 1>&2
  usage
}

domysql() {
  mysql --host $host -u$user --password=$password $database
}

getcolumns() {
  local l_table="$1"
  echo "describe $l_table" | domysql | cut -f1 | grep -v "Field" | grep -v "Warning" | paste -sd "," - 2>/dev/null
}

host="localhost"
mysqlfiles="/var/lib/mysql-files/"

# Parse command line options
while true; do
  #echo "option $1"
  case "$1" in
    # Options without arguments
    -h|--help) usage;;
    -d|--database)     database="$2" ; shift ;;
    -t|--tables)       tables="$2" ; shift ;;
    -o|--output)       csvoutput="$2" ; shift ;;
    -u|--user)         user="$2" ; shift ;;
    -hs|--host)        host="$2" ; shift ;;
    -p|--password)     password="$2" ; shift ;;
    -gs|--get-schema)  option="getschema";;
    (--) shift; break;;
    (-*) echo "$0: error - unrecognized option $1" 1>&2; usage;;
    (*) break;;
  esac
  shift
done

# Checks
if [ "$csvoutput" == "" ]
then
  error "output CSV directory is not set"
fi
if [ "$database" == "" ]
then
  error "MySQL database is not set"
fi
if [ "$user" == "" ]
then
  error "MySQL user is not set"
fi
if [ "$password" == "" ]
then
  error "MySQL password is not set"
fi

color_msg $blue "exporting tables of database $database"
if [ "$tables" = "" ]
then
tables=$(echo "show tables" | domysql)
fi

case $option in
  getschema)
   rm $csvoutput$database.schema
   for table in $tables
   do
     color_msg $blue "getting schema for $table"
     echo -n "$table:" >> $csvoutput$database.schema
     getcolumns $table >> $csvoutput$database.schema
   done
   ;;
  *)
for table in $tables
do
  color_msg $blue "exporting table $table"
  cols=$(grep "$table:" $csvoutput$database.schema | cut -f2 -d:)
  if [  "$cols" = "" ]
  then
    cols=$(getcolumns $table)
  fi
  ssh $host rm $mysqlfiles/$table.csv
cat <<EOF | mysql --host $host -u$user --password=$password $database
SELECT $cols FROM $table INTO OUTFILE '$mysqlfiles$table.csv'
FIELDS TERMINATED BY ','
ENCLOSED BY '"'
LINES TERMINATED BY '\n';
EOF
  scp $host:$mysqlfiles/$table.csv $csvoutput$table.csv.raw
  (echo "$cols"; cat $csvoutput$table.csv.raw) > $csvoutput$table.csv
  rm $csvoutput$table.csv.raw
done
  ;;
esac 
```

* * *

## 回答 #31

> 赞同：1
> 
> 时间：2020-09-10T13:49:41.267

站在[Chris Johnson 的肩膀上](https://stackoverflow.com/questions/356578/how-can-i-output-mysql-query-results-in-csv-format/35123787#35123787)，我从 2016 年 2 月开始用一种习惯阅读的方言扩展了答案。

这个 shell 管道工具不需要连接到您的数据库，处理输入中的随机逗号和引号，并且在 Python 2*和*Python 3 中运行良好！

```
#!/usr/bin/env python
import csv
import sys

# fields are separated by tabs; double-quotes may occur anywhere
csv.register_dialect("mysql", delimiter="\t", quoting=csv.QUOTE_NONE)
tab_in = csv.reader(sys.stdin, dialect="mysql")
comma_out = csv.writer(sys.stdout, dialect=csv.excel)
for row in tab_in:
    # print("row: {}".format(row))
    comma_out.writerow(row) 
```

使用该打印语句来说服自己它正在正确解析您的输入:)

一个主要的警告：在 Linux 术语中处理回车符，^M aka control-M，\r。尽管批处理模式的 MySQL 输出正确地转义了嵌入的换行符，所以每行确实有一行（由 Linux 换行符 \n 定义），MySQL 没有在列数据周围加上引号。如果数据项具有嵌入的回车符，则 csv.reader 会拒绝该输入，但会出现以下异常：

```
new-line character seen in unquoted field -
do you need to open the file in universal-newline mode? 
```

请不要@我说我应该通过使用模式“rU”重新打开*sys.stdin.fileno*来使用通用文件模式。我试过了，它导致嵌入的 \r 字符被视为记录结束标记，因此单个输入记录被错误地转换为许多不完整的输出记录。

对于 Python 的 csv.reader 模块的这种限制，我还没有找到 Python 解决方案。我认为根本原因是他们的文档*[csv.reader](https://docs.python.org/3/library/csv.html#csv.reader)**中提到的csv.reader*实施/限制：

```
The reader is hard-coded to recognise either '\r' or '\n' as end-of-line,
and ignores lineterminator. 
```

我可以提供的弱且不令人满意的解决方案是在 Python 的 csv.reader 看到数据之前将每个 \r 字符更改为两个字符序列 '\n'。我使用了[`sed`](https://en.wikipedia.org/wiki/Sed)命令。这是一个带有 MySQL 选择和上面的 Python 脚本的管道示例：

```
mysql -u user db --execute="select * from table where id=12345" \
  | sed -e 's/\r/\\n/g' \
  | mysqlTsvToCsv.py 
```

经过一段时间的斗争，我认为 Python 不是正确的解决方案。如果你能忍受[Perl](https://en.wikipedia.org/wiki/Perl)，我认为[artfulrobot 提供的单行脚本](https://stackoverflow.com/questions/356578/how-can-i-output-mysql-query-results-in-csv-format?page=1&tab=oldest#comment72742000_6614691)可能是最有效和最简单的解决方案。

* * *

## 回答 #32

> 赞同：0
> 
> 时间：2012-03-17T08:46:57.200

如果您使用的机器上安装了 PHP，您可以编写一个 PHP 脚本来执行此操作。它要求 PHP 安装已安装 MySQL 扩展。

您可以像这样从命令行调用 PHP 解释器：

```
php --php-ini path/to/php.ini your-script.php 
```

我将`--php-ini`开关包括在内，因为您可能需要使用自己的 PHP 配置来启用 MySQL 扩展。在 PHP 5.3.0+ 上默认启用该扩展，因此不再需要使用配置来启用它。

然后你可以像任何普通的 PHP 脚本一样编写你的导出脚本：

```
<?php
    #mysql_connect("localhost", "username", "password") or die(mysql_error());
    mysql_select_db("mydb") or die(mysql_error());

    $result = mysql_query("SELECT * FROM table_with_the_data p WHERE p.type = $typeiwant");

    $result || die(mysql_error());

    while($row = mysql_fetch_row($result)) {
      $comma = false;
      foreach ($row as $item) {

        # Make it comma separated
        if ($comma) {
          echo ',';
        } else {
          $comma = true;
        }

        # Quote the quotes
        $quoted = str_replace("\"", "\"\"", $item);

        # Quote the string
        echo "\"$quoted\"";
      }
        echo "\n";
    }
?> 
```

这种方法的优点是，它对包含换行符的文本的 varchar 和文本字段没有任何问题。这些字段被正确引用，其中的换行符将被 CSV 阅读器解释为文本的一部分，而不是记录分隔符。这是事后很难用[sed](http://en.wikipedia.org/wiki/Sed)左右纠正的东西。

* * *

## 回答 #33

> 赞同：0
> 
> 时间：2014-09-08T12:06:50.867

试试这个代码：

```
SELECT 'Column1', 'Column2', 'Column3', 'Column4', 'Column5'
UNION ALL
SELECT column1, column2,
column3 , column4, column5 FROM demo
INTO OUTFILE '/tmp/demo.csv'
FIELDS TERMINATED BY ','
ENCLOSED BY '"'
LINES TERMINATED BY '\n'; 
```

欲了解更多信息：[http ://dev.mysql.com/doc/refman/5.1/en/select-into.html](http://dev.mysql.com/doc/refman/5.1/en/select-into.html)

* * *

## 回答 #34

> 赞同：0
> 
> 时间：2020-02-02T21:19:50.773

此解决方案将 SQL 查询放在[heredoc](https://en.wikipedia.org/wiki/Here_document#PHP)中，并通过过滤器管道输出：

### 文件*查询.sh*

```
#!/bin/bash

mysql --defaults-group-suffix=[DATABASE_NAME] --batch << EOF | python query.py
SELECT [FIELDS]
FROM [TABLE]
EOF 
```

此版本的 Python 过滤器无需使用`csv`模块即可工作：

### 文件*查询.sh*

```
import sys

for line in sys.stdin:
    print(','.join(["\"" + str(element) + "\"" for element in line.rstrip('\n').split('\t')])) 
```

这个版本的 Python 过滤器使用 CSV 模块，涉及的代码稍微多一些，但可以说更清楚一点：

### 文件*查询.sh*

```
import csv, sys

csv_reader = csv.reader(sys.stdin, delimiter='\t')
csv_writer = csv.writer(sys.stdout, quoting=csv.QUOTE_NONNUMERIC)

for line in csv_reader:
    csv_writer.writerow(line) 
```

或者你可以使用[Pandas](https://en.wikipedia.org/wiki/Pandas_%28software%29)：

### 文件*查询.py*

```
import csv, sys
import pandas as pd

df = pd.read_csv(sys.stdin, sep='\t')
df.to_csv(sys.stdout, index=False, quoting=csv.QUOTE_NONNUMERIC) 
```

* * *

## 回答 #35

> 赞同：0
> 
> 时间：2020-03-25T02:34:08.647

对于那些可能想要以 CSV 格式下载查询结果但无法访问服务器文件但无法访问数据库的人。

首先，它不是 Linux 命令。步骤如下：

1.  使用查询创建视图。例如： ( `Create VIEW v as (Select * from user where status = 0)`)
2.  该视图将在`view`您的数据库部分下创建。
3.  现在将视图导出为`CSV`.
4.  如果您需要表格列作为 CSV 的标题，请设置`Export method:`为`Custom - display all possible options`并选中`Put columns names in the first row`.

* * *

## 回答 #36

> 赞同：0
> 
> 时间：2020-04-04T14:38:22.287

如果您在尝试导出文件时遇到此错误

> 错误 1290 (HY000)：MySQL 服务器正在使用 --secure-file-priv 选项运行，因此无法执行此语句

并且你无法解决这个错误，你可以通过简单地运行这个 Python 脚本来做一件事

```
import mysql.connector
import csv

con = mysql.connector.connect(
    host="localhost",
    user="root",
    passwd="Your Password"
)

cur = con.cursor()

cur.execute("USE DbName")
cur.execute("""
select col1,col2 from table
where <cond>
""")

with open('Filename.csv',mode='w') as data:
    fieldnames=["Field1","Field2"]
    writer=csv.DictWriter(data,fieldnames=fieldnames)
    writer.writeheader()
    for i in cur:
        writer.writerow({'Field1':i[0],'Field2':i[1]}) 
```

* * *

## 回答 #37

> 赞同：0
> 
> 时间：2021-04-08T16:00:16.997

这避免了必须将输出写入文件，只需要`expat`安装，正确转义值，并`NULL`为空值输出空字符串（而不是文字）。

您告诉 MySQL 以 XML 格式输出结果（使用`--xml`标志），然后通过下面的 C 程序通过管道传输结果。

这也应该非常接近执行此操作的最快方法。

```
 // mysql-xml-to-csv.c

#include <assert.h>
#include <ctype.h>
#include <err.h>
#include <expat.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>

/*
    Example of MySQL XML output:

    <?xml version="1.0"?>

    <resultset xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" statement="SELECT id as IdNum, lastName, firstName FROM User">
        <row>
            <field name="IdNum">100040</field>
            <field name="lastName" xsi:nil="true"/>
            <field name="firsttName">Cher</field>
        </row>
    </resultset>
*/

#define BUFFER_SIZE     (1 << 16)

// These accumulate the first row column names and values until first row is entirely read (unless the "-N" flag is given)
static XML_Char **column_names;
static size_t num_column_names;
static XML_Char **first_row_values;
static size_t num_first_row_values;

// This accumulates one column's value
static XML_Char *elem_text;                     // note: not nul-terminated
static size_t elem_text_len;

// Flags
static int first_column;
static int reading_value;

// Expat callback functions
static void handle_elem_start(void *data, const XML_Char *el, const XML_Char **attr);
static void handle_elem_text(void *userData, const XML_Char *s, int len);
static void handle_elem_end(void *data, const XML_Char *el);

// Helper functions
static void output_csv_row(XML_Char **values, size_t num);
static void output_csv_text(const char *s, size_t len);
static void add_string(XML_Char ***arrayp, size_t *lengthp, const XML_Char *string, size_t len);
static void add_chars(XML_Char **strp, size_t *lenp, const XML_Char *string, size_t nchars);
static size_t xml_strlen(const XML_Char *string);
static void free_strings(XML_Char ***arrayp, size_t *lengthp);
static void usage(void);

int
main(int argc, char **argv)
{
    char buf[BUFFER_SIZE];
    int want_column_names = 1;
    XML_Parser p;
    FILE *fp;
    size_t r;
    int i;

    // Parse command line
    while ((i = getopt(argc, argv, "hN")) != -1) {
        switch (i) {
        case 'N':
            want_column_names = 0;
            break;
        case 'h':
            usage();
            exit(0);
        case '?':
        default:
            usage();
            exit(1);
        }
    }
    argv += optind;
    argc -= optind;
    switch (argc) {
    case 0:
        fp = stdin;
        break;
    case 1:
        if ((fp = fopen(argv[0], "r")) == NULL)
            err(1, "%s", argv[0]);
        break;
    default:
        usage();
        exit(1);
    }

    // Initialize arrays for column names and first row values
    if (want_column_names) {
        if ((column_names = malloc(10 * sizeof(*column_names))) == NULL)
            err(1, "malloc");
        if ((first_row_values = malloc(10 * sizeof(*first_row_values))) == NULL)
            err(1, "malloc");
    }

    // Initialize parser
    if ((p = XML_ParserCreate(NULL)) == NULL)
        errx(1, "can't initialize parser");
    XML_SetElementHandler(p, handle_elem_start, handle_elem_end);
    XML_SetCharacterDataHandler(p, handle_elem_text);

    // Process file
    while (1) {
        if ((r = fread(buf, 1, sizeof(buf), fp)) == 0 && ferror(fp))
            errx(1, "error reading input");
        if (XML_Parse(p, buf, r, r == 0) == XML_STATUS_ERROR)
            errx(1, "line %u: %s", (unsigned int)XML_GetCurrentLineNumber(p), XML_ErrorString(XML_GetErrorCode(p)));
        if (r == 0)
            break;
    }

    // Clean up
    XML_ParserFree(p);
    fclose(fp);

    // Done
    return 0;
}

static void
handle_elem_start(void *data, const XML_Char *name, const XML_Char **attr)
{
    if (strcmp(name, "row") == 0)
        first_column = 1;
    else if (strcmp(name, "field") == 0) {
        if (column_names != NULL) {
            while (*attr != NULL && strcmp(*attr, "name") != 0)
                attr += 2;
            if (*attr == NULL)
                errx(1, "\"field\" element is missing \"name\" attribute");
            add_string(&column_names, &num_column_names, attr[1], xml_strlen(attr[1]));
        } else {
            if (!first_column)
                putchar(',');
            putchar('"');
        }
        reading_value = 1;
    }
}

static void
handle_elem_text(void *userData, const XML_Char *s, int len)
{
    if (!reading_value)
        return;
    if (column_names != NULL)
        add_chars(&elem_text, &elem_text_len, s, len);
    else
        output_csv_text(s, len);
}

static void
handle_elem_end(void *data, const XML_Char *name)
{
    if (strcmp(name, "row") == 0) {
        if (column_names != NULL) {
            output_csv_row(column_names, num_column_names);
            output_csv_row(first_row_values, num_first_row_values);
            free_strings(&column_names, &num_column_names);
            free_strings(&first_row_values, &num_first_row_values);
        } else
            putchar('\n');
    } else if (strcmp(name, "field") == 0) {
        if (column_names != NULL) {
            add_string(&first_row_values, &num_first_row_values, elem_text, elem_text_len);
            free(elem_text);
            elem_text = NULL;
            elem_text_len = 0;
        } else
            putchar('"');
        first_column = 0;
        reading_value = 0;
    }
}

static void
output_csv_row(XML_Char **values, size_t num_columns)
{
    int i;

    for (i = 0; i < num_columns; i++) {
        if (i > 0)
            putchar(',');
        putchar('"');
        output_csv_text(values[i], xml_strlen(values[i]));
        putchar('"');
    }
    putchar('\n');
}

static void
output_csv_text(const XML_Char *s, size_t len)
{
    while (len-- > 0) {
        if (*s == '"')
            putchar('"');
        putchar(*s);
        s++;
    }
}

static void
add_string(XML_Char ***arrayp, size_t *lengthp, const XML_Char *string, size_t nchars)
{
    char **new_array;

    if ((new_array = realloc(*arrayp, (*lengthp + 1) * sizeof(**arrayp))) == NULL)
        err(1, "malloc");
    *arrayp = new_array;
    if (((*arrayp)[*lengthp] = malloc((nchars + 1) * sizeof(XML_Char))) == NULL)
        err(1, "malloc");
    memcpy((*arrayp)[*lengthp], string, nchars * sizeof(XML_Char));
    (*arrayp)[*lengthp][nchars] = (XML_Char)0;
    (*lengthp)++;
}

static void
add_chars(XML_Char **strp, size_t *lenp, const XML_Char *string, size_t nchars)
{
    XML_Char *new_array;

    if ((new_array = realloc(*strp, (*lenp + nchars) * sizeof(XML_Char))) == NULL)
        err(1, "malloc");
    *strp = new_array;
    memcpy(*strp + *lenp, string, nchars * sizeof(XML_Char));
    *lenp += nchars;
}

static size_t
xml_strlen(const XML_Char *string)
{
    size_t len;

    len = 0;
    while (string[len] != (XML_Char)0)
        len++;
    return len;
}

static void
free_strings(char ***arrayp, size_t *lengthp)
{
    while (*lengthp > 0)
        free((*arrayp)[--*lengthp]);
    free(*arrayp);
    *arrayp = NULL;
}

static void
usage(void)
{
    fprintf(stderr, "Usage: mysql-xml-to-csv [options] [file.xml]\n");
    fprintf(stderr, "Options:\n");
    fprintf(stderr, "  -N\tDo not output column names as the first row\n");
    fprintf(stderr, "  -h\tShow this usage info\n");
} 
```

对于那些不经常使用 C 的人，您可以通过运行以下命令来构建此代码（假设您已安装 expat 库）：

```
gcc mysql-xml-to-csv.c -lexpat -o mysql-xml-to-csv 
```

使用 openSUSE 15.2 和 gcc 7.5.0 测试。

`Update:`现在作为[github 上的开源项目提供](https://github.com/archiecobbs/mysql-xml-to-csv)。

* * *

## 回答 #38

> 赞同：0
> 
> 时间：2021-12-19T05:30:59.333

**这又脏又丑**。它仅适用于您只有一个 PHP-*-admin 并且服务器正在使用该选项运行的特定情况`--secure-file-priv`，因此您不能`INTO OUTFILE '/path/to/export.csv'`在查询中使用该子句。

您可以做的是用 ... 等待它！, 解析 CSV 行`CONCAT`，然后复制结果并将它们粘贴到文件中。

这是一个示例，我需要 SQL 格式（将其调整为 CSV 很简单）：

```
SELECT CONCAT(
"('",
`username`, "', '",
`password`, "', '",
`first_name`, "', '",
`last_name`, "', '",
`gender`, "'),"
) AS `row` 
FROM `users`
WHERE `role` != 'Not set'
AND `user_status` = 'Active'
ORDER BY `role`, `gender`, `user_id`
LIMIT 200 
```

这提供了很好的、准备好导入的输出，类似于：

```
('jane', '3d7ff...', 'Jane', 'Doe', 'Female'),  
('john', 'd2a33...', 'John', 'Doe', 'Male'),
... 
```

* * *

## 回答 #39

> 赞同：-3
> 
> 时间：2018-09-24T12:43:18.043

您可以在 SQL 编辑器/终端中使用以下命令：

```
mysql -h(hostname/IP>) -u(username) -p(password) databasename <(query.sql) > outputFILE(.txt/.xls) 
```

例如，

*   主机名-xxxx

*   unname - 用户名

*   密码 - 密码

*   DBName - 员工数据库

*   查询文件-employee.sql

*   输出文件 - 输出文件.xls

**mysql -hx.xxx -uusername -ppassword employeeDB<employee.sql> outputFile.xls**

确保从 SQL 查询所在的目录执行命令，或在上述命令中提及 SQL 查询位置的完整路径。

* * *

## 回答 #40

> 赞同：-3
> 
> 时间：2019-11-06T04:23:58.517

如果您在生产或任何其他无法访问文件系统的服务器上，您可以使用这个简单的技巧和一点点手动工作来获得您想要的东西。

第 1 步。只需将所有列包装在下面`CONCAT`并使用`as CSVFormat`MySQL 提供的选项来获得逗号分隔的结果（或使用您想要的任何分隔符）。这是一个例子：

```
SELECT
    CONCAT(u.id,
            ',',
            given,
            ',',
            family,
            ',',
            email,
            ',',
            phone,
            ',',
            ua.street_number,
            ',',
            ua.route,
            ',',
            ua.locality,
            ',',
            ua.state,
            ',',
            ua.country,
            ',',
            ua.latitude,
            ',',
            ua.longitude) AS CSVFormat
FROM
    table1 u
        LEFT JOIN
    table2 ua ON u.address_id = ua.id
WHERE
    role_policy = 31 and is_active = 1; 
```

步骤 2\. 将结果从终端复制到文件并使用任何文本编辑器清理所有管道字符（形成结果布局）。

第 3 步。另存为 .csv 文件，就是这样。

# java - 我可以在 java 中反射性地实例化一个泛型类型吗？

> ID：356583
> 
> 赞同：15
> 
> 时间：2008-12-10T16:01:47.530
> 
> 标签：java, generics, reflection

是否可以在 Java 中反射性地实例化泛型类型？使用[这里](http://www.velocityreviews.com/forums/t149816-generics-and-forname.html)描述的技术我得到一个错误，因为类标记不能是通用的。举个例子。我想实例化一些实现 Creator 的 Creator 子类。实际的类名作为命令行参数传入。这个想法是能够在运行时指定 Creator 的实现。还有另一种方法可以完成我在这里尝试做的事情吗？

```
public interface Creator<T> {
    T create();
}
public class StringCreator implements Creator<String> {
    public String create() { return new String(); }
}
public class FancyStringCreator implements Creator<String> {
    public String create() { return new StringBuffer().toString(); }
}
public static void main(String[] args) throws Exception {
    Class<?> someClass = Class.forName(args[0]);
    /*ERROR*/Class<? extends Creator<String>> creatorClass = someClass.asSubclass(Creator.class);
    Constructor<? extends Creator<String>> creatorCtor = creatorClass.getConstructor((Class<?>[]) null);
    Creator<String> creator = creatorCtor.newInstance((Object[]) null);
} 
```

编辑：我喜欢 Marcus 的方法，因为它是最简单、最实用的方法，而且没有规避整个泛型。我可以在我的情况下使用它，因为我可以指定传递的类必须是 StringCreator 的子类。但正如 Ericson 指出的那样，泛型信息仍然存在于类型级别，只是不在运行时级别，因此仍然可以反思性地检查给定类是否实现了正确的泛型类型。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-12-10T17:43:03.507

通用信息在运行时丢失。没有 Creator<String>.class 的运行时等效项。您可以在 Creator 和 StringCreator 之间创建一个类型来修复泛型类型：

```
public interface Creator<T> {
        T create();
}
public interface StringCreator extends Creator<String> { }
public class StringCreatorImpl implements StringCreator  {
        public String create() { return new String(); }
}
public class FancyStringCreator implements StringCreator  {
        public String create() { return new StringBuffer().toString(); }
}
public static void main(String[] args) throws Exception {
        Class<?> someClass = Class.forName(args[0]);
        Class<? extends StringCreator> creatorClass = someClass.asSubclass(StringCreator.class);
        Constructor<? extends StringCreator> creatorCtor = creatorClass.getConstructor((Class<?>[]) null);
        Creator<String> creator = creatorCtor.newInstance((Object[]) null);
} 
```

但是当然你失去了一点灵活性，因为你不能使用下面的创建者类：

```
public class AnotherCreator implements Creator<String> {
    public String create() { return ""; }
} 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-12-10T17:37:02.487

这将在提供类型安全的同时完成您正在尝试做的事情。没有办法避免未经检查的警告，但这里所做的类型检查证明了它的抑制是合理的。

```
 public static void main(String[] args)
    throws Exception
  {
    Class<? extends Creator<String>> clz = load(argv[0], String.class);
    Constructor<? extends Creator<String>> ctor = clz.getConstructor();
    Creator<String> creator = ctor.newInstance();
    System.out.println(creator.create());
  }

  public static <T> Class<? extends Creator<T>> load(String fqcn, Class<T> type)
    throws ClassNotFoundException
  {
    Class<?> any = Class.forName(fqcn);
    for (Class<?> clz = any; clz != null; clz = clz.getSuperclass()) {
      for (Object ifc : clz.getGenericInterfaces()) {
        if (ifc instanceof ParameterizedType) {
          ParameterizedType pType = (ParameterizedType) ifc;
          if (Creator.class.equals(pType.getRawType())) {
            if (!pType.getActualTypeArguments()[0].equals(type))
              throw new ClassCastException("Class implements " + pType);
            /* We've done the necessary checks to show that this is safe. */
            @SuppressWarnings("unchecked")
            Class<? extends Creator<T>> creator = (Class<? extends Creator<T>>) any;
            return creator;
          }
        }
      }
    }
    throw new ClassCastException(fqcn + " does not implement Creator<String>");
  } 
```

您必须遵守的主要限制是层次结构中的类必须指定类型参数。例如`class MyCreator implements Creator<String>`. 您不能将其与`class GenericCreator<T> implements Creator<T>`.

它目前不处理您创建新接口的有效情况`interface StringCreatorIfc extends Creator<String>`，并让一个类实现它。这样做可以得到增强，但我会把它作为练习留给那些有倾向的人。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-10T16:06:11.267

你不需要那条线。您也不需要构造函数，因为您只是使用默认构造函数。直接实例化类：

```
public static void main(String[] args) throws Exception {
        Class<?> someClass = Class.forName(args[0]);
        Creator<String> creator = (Creator<String>) someClass.newInstance();
} 
```

如果你坚持，你只能做到一半：

```
public static void main(String[] args) throws Exception {
    Class<?> someClass = Class.forName(args[0]);
    Class<? extends Creator> creatorClass = someClass.asSubclass(Creator.class);
    Constructor<? extends Creator> creatorCtor = creatorClass.getConstructor((Class<?>[]) null);
    Creator<String> creator = (Creator<String>) creatorCtor.newInstance((Object[]) null);
} 
```

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2008-12-10T16:31:47.080

不太清楚你为什么在这里使用泛型。

使用反射的对象的实例化会建议一般用途，但大概您将`create`在某个时候调用并将结果分配给 a `String`，否则为什么要使用泛型来控制返回类型。

但是如果你编写了以下 Creator 的实现：

```
public class IntegerCreator implements Creator<Integer> 
{
  public Integer create() 
  { 
    ...
  }
} 
```

并将其作为参数传入，在调用`create`和分配结果时会得到 ClassCastException。

# visual-studio - 在 Visual Studio 中以不同用户身份运行测试

> ID：356585
> 
> 赞同：5
> 
> 时间：2008-12-10T16:02:18.077
> 
> 标签：visual-studio, visual-studio-2008, unit-testing, windows-xp

我有一个程序需要以单独的 NT 用户身份运行才能连接到 SQL Server 数据库。对于运行程序本身，这没什么大不了的，因为我可以在 Windows 资源管理器中右键单击它并选择运行方式。有没有办法以不同的用户身份运行我的测试？（如果我能在 Visual Studio 中这样做就好了）

**更新**：截至目前，我只是使用 Visual Studio 2008 Pro 中的集成单元测试框架进行单元测试。我只是使用“在当前解决方案中运行所有测试”菜单选项来运行它们。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-10T16:07:08.083

有一个命令行程序“runas”，只要它们是独立程序，您就可以使用它来运行您的测试。我不确定如何将它与您的测试完全集成，因为我可能需要更多关于如何运行它们的信息。

此方法将要求您输入密码。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-10T16:09:25.287

您可以抽象和模拟确定当前用户的机制。这将允许您像任何人一样进行测试。

# c# - 将 Html 渲染或转换为“格式化”文本 (.NET)

> ID：356597
> 
> 赞同：10
> 
> 时间：2008-12-10T16:06:13.700
> 
> 标签：c#, .net, html, string, html-encode

我正在将一些数据从另一个测试/错误跟踪工具导入到 tfs，我想将它的描述转换为简单的 HTML，因此是一个纯字符串，其中保留了 HTML 的“布局”。

例如：

```
<body>
  <ol>
    <li>Log on with user Acme &amp; Co.</li>
    <li>Navigate to the details tab</li>
    <li>Check the official name</li>
  </ol>
  <br>
  <br>
  Expected Result:<br>
  official name is filled in<br>
  <br>
  Actual Result:<br>
  The &amp;-sign is not shown correctly<br>
  See attachement.
</body> 
```

将变为插入换行符的纯文本，HTML 实体翻译如下：

```
1\. 使用用户 Acme & Co 登录。
2\. 导航到详细信息选项卡
3.查看正式名称

预期结果：
正式名称填写

实际结果：
&-符号显示不正确
详见附件

```

我目前可以使用正则表达式用换行符替换一些标签并去除其余部分，但是替换 HTML 实体和类似的东西，`<ol>`并且`<ul>`似乎我正在重新发明一些东西（浏览器？）。所以我想知道是否有人在我之前做过这件事。我用谷歌找不到它。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-10T16:08:13.603

您可以尝试将其加载到[HTML 敏捷包](http://www.codeplex.com/htmlagilitypack)中，而不是正则表达式？如果是 xhtml，那么 xslt 转换可能是一个不错的选择。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-01-20T12:01:02.530

最后，一旦我对 TFS 更加熟悉，我就自定义了工作项类型以包含一个新的 HTML 字段，并将内容复制到该字段中。

这个解决方案好多了，因为我们现在可以看到该字段的预期格式。

# outlook - 使用 iCalendar 文件导入删除日历事件（Outlook 2003 问题）？

> ID：356598
> 
> 赞同：20
> 
> 时间：2008-12-10T16:06:15.167
> 
> 标签：outlook, icalendar

有没有办法让我使用 iCalendar 导入从日历中删除项目？

我知道有一个 METHOD:CANCEL，但是当我尝试它时，它对日历事件没有任何作用。

这是我的 iCalendar 文件中的内容。当我尝试将其导入 Outlook 时，它只会添加这些事件。

```
BEGIN:VCALENDAR
VERSION:2.0
PRODID:-//DDay.iCal//NONSGML ddaysoftware.com//EN
METHOD:CANCEL
BEGIN:VEVENT
CREATED:20081210T155315Z
DESCRIPTION:
DTEND:20081213T093000
DTSTAMP:20081210T155315Z
DTSTART:20081213T093000
LOCATION:
ORGANIZER:MAILTO:user@domain.com
SEQUENCE:1
SUMMARY:From FCS 13th
UID:20367b86-2123-4930-87ef-5c2a6626bd9f
BEGIN:VALARM
ACTION:DISPLAY
SUMMARY: Event 13th
TRIGGER:-PT30M
END:VALARM
END:VEVENT
BEGIN:VEVENT
CREATED:20081210T155315Z
DESCRIPTION:
DTEND:20081211T093000
DTSTAMP:20081210T155315Z
DTSTART:20081211T093000
LOCATION:7 West
ORGANIZER:MAILTO:user@domain.com
SEQUENCE:1
SUMMARY:Event 11th
UID:f212ab15-86c3-46c8-8592-af0716a40ea2
BEGIN:VALARM
ACTION:DISPLAY
SUMMARY:Event on 11th
TRIGGER:-PT30M
END:VALARM
END:VEVENT    
END:VCALENDAR 
```

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-12-10T21:16:49.500

我忘了添加`STATUS:CANCELLED`

现在这应该根据[http://en.wikipedia.org/wiki/ICalendar#Events_.28VEVENT.29取消项目](http://en.wikipedia.org/wiki/ICalendar#Events_.28VEVENT.29)

这适用于 Google 日历，但不适用于 Outlook 2003。Outlook 仍会创建重复条目。

这里是修改后的“取消”事件，带有“状态：取消”。（带有两个 L 的英式拼写）

```
BEGIN:VCALENDAR
VERSION:2.0
PRODID:-//DDay.iCal//NONSGML ddaysoftware.com//EN
X-WR-RELCALID:928C8448-048A-4aa2-BE27-A920773AF3DC
METHOD:CANCEL
BEGIN:VEVENT
CREATED:20081210T210344Z
DESCRIPTION:
DTEND:20081213T093000
DTSTAMP:20081210T210344Z
DTSTART:20081213T093000
LOCATION:
ORGANIZER:MAILTO:user@domain.com
SEQUENCE:1
STATUS:CANCELLED
SUMMARY:Event to export 1
UID:20367b86-2123-4930-87ef-5c2a6626bd9f
BEGIN:VALARM
ACTION:DISPLAY
SUMMARY:Event to export 1
TRIGGER:-PT30M
END:VALARM
END:VEVENT
BEGIN:VEVENT
CREATED:20081210T210344Z
DESCRIPTION:
DTEND:20081211T093000
DTSTAMP:20081210T210344Z
DTSTART:20081211T093000
LOCATION:7 West
ORGANIZER:MAILTO:user@domain.com
SEQUENCE:1
STATUS:CANCELLED
SUMMARY:Event to export 2
UID:f212ab15-86c3-46c8-8592-af0716a40ea2
BEGIN:VALARM
ACTION:DISPLAY
SUMMARY:Event to export 2
TRIGGER:-PT30M
END:VALARM
END:VEVENT
END:VCALENDAR 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2011-09-12T14:57:59.660

我为此苦苦挣扎了一段时间。

正如其他一些人提到的，您必须包括：

方法：取消

和

状态：已取消

VEVENT 的线条。UID 必须与原始事件相同，并且 SEQUENCE: 编号必须是 CURRENT 序列号！（您不需要从最后一个序列号中添加 1，因为取消事件不算作更新）。

我遇到了问题，因为我认为取消算作更新，因此增加了我的序列号，但您不必这样做！

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2013-07-31T19:43:37.273

**此答案适用于 iCal URL 提要，而不是用于导入 iCal 文件！**

我研究了很长一段时间，因为给出的答案实际上并没有解决 Outlook 的问题，所以我想我会发布我发现的适用于 Outlook、iCal 和 Google 日历的内容。

您只是简单地不发送事件，如果事件完全不在提要中，那么 Outlook、Google 日历和 iCal（来自我的测试）都只是删除事件，就好像它从未存在一样。因此，如果事件已被取消，只需假装它从未存在，当本地日历同步时，它们将显示在提要中明确提供给它们的事件。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2014-06-24T15:51:18.830

这可能是一项痛苦且不可预测的业务，并且可能依赖于 Outlook 版本。我有使用 Outlook 2010 (v14) 的事件取消。我将我的 icalendar 作为单部分消息发送，键入文本/日历，如[本](https://stackoverflow.com/questions/24259827/why-are-my-icalendar-invitations-not-processed-by-the-outlook-sniffer)线程中所述。正如其他答案中提到的那样，我在 MIME 类型中有 method=CANCEL，在 icalendar 中也有。

对我来说关键的一步是将 DTSTART 添加到事件中。如果没有此字段，则消息不会显示为取消，预览窗格中没有任何内容，日历显示为文件名为“不支持的日历 message.ics”的附件。**但是**您可以在该字段中输入您喜欢的任何日期！DTEND 并不重要。SEQUENCE 可以相同或更大。DTSTAMP 并不重要，但如果存在，则必须在与初始邀请一起发送的 DTSTAMP 之后，否则会出现文本“未激活”而不是“从日历中删除”按钮。

这是一个最小的工作取消......

```
BEGIN:VCALENDAR
VERSION:2.0
PRODID:-//www.notilus.com//Dimo Gestion Notilus//FR
CALSCALE:GREGORIAN
METHOD:CANCEL
BEGIN:VEVENT
DTSTART:20140625T123000Z
SEQUENCE:1
STATUS:CANCELLED
UID:Kerry
END:VEVENT
END:VCALENDAR 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-10T21:30:29.630

我可能需要设置**X-WR-RELCALID**标签，根据这个[http://www.oesf.org/forum/index.php?act=Print&client=printer&f=63&t=2650](http://www.oesf.org/forum/index.php?act=Print&client=printer&f=63&t=2650)

它指出：“在第一次同步之前，您必须在 mycalendar.ics 文件中添加一个 X-WR-RELCALID 标签，否则 iCal 将更改所有条目的 UID 编号，从而导致重复。”

[但是我在协议https://www.rfc-editor.org/rfc/rfc2446](https://www.rfc-editor.org/rfc/rfc2446)中找不到任何关于 RELCALID 标记的文档

当我设置 X-WR-RELCALID 时，Outlook 仍然会创建重复的事件，而不是删除这些事件。

有没有关于 X-WR-RELCALID 的文档？我找不到它。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-10T17:44:58.880

我不知道这是否有帮助，请尝试设置 SEQUENCE: 2

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2011-08-04T11:58:14.687

对我来说，它通过`X-WR-RELCALID`在 ics 文件的标题中设置标签来工作。然后 Outlook 将事件识别为相同。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-11-04T11:32:04.340

如果您更改 UID 属性，Outlook 会创建重复事件。您必须使用相同的 UID 创建另一个事件。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2019-02-19T18:11:00.977

您应该执行以下步骤来删除日历事件

1.  UID 必须相同
2.  添加方法：取消
3.  添加状态：已取消
4.  SEQUENCE 必须大于创建的事件

# model-view-controller - 使用 ASP.NET 网络表单的 MVC

> ID：356599
> 
> 赞同：2
> 
> 时间：2008-12-10T16:06:37.693
> 
> 标签：model-view-controller, webforms

我继承了一个建立在 webforms 之上的 ASP.NET 应用程序，该应用程序的所有业务逻辑都嵌入在代码隐藏中。因此，无法对该应用程序进行单元测试。

我想将每个表单的功能分解为 MVC 样式，但我发现 ASP.NET 拒绝我为重构它所做的一切努力。一般来说，我喜欢按如下方式分离我的 MVC 类：

```
 public class LoginModel
{
    public string Username, Password;
    public bool IsAuthenticated;
}

public interface ILoginView
{
    event Action UserLoggedIn;
    void SetMode(bool isAuthenticated);
}

public class LoginController
{
    ILoginView View;
    LoginModel Model;

    public LoginController(ILoginView view, LoginModel model)
    {
        this.View = view;
        this.Model = model;

        // hook onto view events
    }
}
```

一旦我设置好我的类并进行了很好的单元测试，我就可以`ILoginView`在我的用户控件或页面上实现接口：

```
 public class LoginView : UserControl, ILoginView
{
    public LoginView() : base()
    {
        new LoginController(this); // registers view with the controller
    }
} 
```

如果这是一个 winform 应用程序，它会很好地工作。但是 ASP.NET 生命周期导致这种风格崩溃。

*   ASP.NET 在每次页面加载时创建和销毁视图。由于我的控制器由视图持有，模型由控制器持有，每次回发都会导致我的页面丢失其状态。

*   我可以通过在用户会话中持有我的控制器来解决上述问题，但这会带来很多问题。特别是，将控制器放在会话中会导致内存问题，因为模型和控制器在会话到期之前不会被垃圾收集回收。从一个页面导航到另一个页面会创建几十个控制器，但是当用户离开一个页面时，这些控制器不会自行处理。

*   由于视图在每次回发时都被销毁/重新创建，因此我必须在每次回发时向控制器重新注册视图。这比听起来更难做到，因为模型的状态需要在每次回发时复制回视图，但同时我们不想覆盖用户在之前的回发中对视图所做的更改。当使用这种 MVC 样式处理动态创建或 AJAXed 控件时，您不知道这会变成什么样的额外噩梦。

我知道我想多了，有一种更简单的方法可以获得我想要的结果，但是如何使用 webforms 正确实现 MVC 样式？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-10T16:15:05.320

使用 asp.net mvc 重写它不是更容易吗？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-07-12T15:35:25.987

看来您必须重新编写。要么完全采用 MVC（并停止使用 DNN），要么采用更好的 WebForms 实现（意味着将逻辑与显示分开并考虑页面生命周期问题）。还有第三种选择 - 结合 MVC 和 ASP.NET WebForms，但您应该仔细查看它，同时考虑到您平台中的所有变量。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-07-12T16:24:46.463

那么 POSTback 的性质决定了你的状态变化，所以你应该对此做出反应。您使用的任何框架都将以几乎相同的方式工作，它将重建/绑定每个请求的状态。您应该将状态（读取数据）保存到用户的会话中。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-02-04T18:23:21.757

ViewState 应该用于将所有加载的数据存储在 WebForms 中，因此只有在创建页面时才会实例化控制器，从而无需在用户会话中存储任何对象。

# version-control - 如何在 Visual Sourcesafe 中修复我的目录结构？

> ID：356603
> 
> 赞同：1
> 
> 时间：2008-12-10T16:07:39.360
> 
> 标签：version-control, visual-sourcesafe

我将 Visual SourceSafe 与 Visual Studio 一起使用。每次我在一个项目上工作一段时间，我硬盘上的目录结构就会变得混乱。文件的最新版本将进入它们自己的嵌套文件夹，所以我最终得到`C:\VS2005\Projects\MyProject\MyProject\MyProject\MyProject`

这是什么原因造成的？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-10T17:34:05.723

对于您的特定问题，我无能为力，但我记得几年前我自己使用 SourceSafe 的痛苦。

如果您可以选择使用的源代码控制系统，我建议您查看其他选项。有几个不错的可供选择。

我切换到[SVN](http://subversion.tigris.org/)，再也没有回头。它比 SourceSafe 好几光年，如果您使用[visualsvn 服务器](http://www.visualsvn.com/server/)（免费产品），安装只需几分钟。至于Visual Studio集成，[visualsvn客户端](http://www.visualsvn.com/visualsvn/)大概50美元，或者直接用[ANKH](http://ankhsvn.open.collab.net/) + [Tortoise](http://tortoisesvn.net/downloads)（都是开源的，很好用）。底线是交换机不需要花费任何钱，安装程序包可以快速让系统在客户端和服务器上运行。

希望对您有所帮助，如果您必须继续使用 SourceSafe，祝您好运。

**更新：** 另见，[这个线程](https://stackoverflow.com/questions/115493/how-do-i-convince-my-team-to-drop-sourcesafe-and-move-to-svn)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-12-05T02:05:34.290

你需要一个老牧师和一个年轻牧师……或者更好的版本控制系统。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-11T09:07:04.280

这是什么原因造成的？

恐怕只是一般的反预期精神错乱，即 VSS 和 VS 相结合。您可以花时间真正了解 VSS 以及它如何看待事物以及如何避免怪癖和陷阱，但它是如此过时的野兽，我支持 Robert 的断言，让自己获得一份更有利可图SVN 和 VisualSVN，再也不用担心这个了。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-11T09:39:26.960

我不禁同意其他先生的意见，尽快逃离VSS。如果你还没有被它咬过，你会的。任何工具都会更好，无论是 Subversion、Mercurial 还是其他工具。前两个具有名为 Tortoise{SVN,HG} 的扩展名，如果您不喜欢 CLI 工具，这将使您能够使用用户友好的界面进行操作。我自己的选择是 HG（也称为[Mercurial](http://selenic.com/wiki/Mercurial)），因为它是一个去中心化/分布式 VCS，它支持离线工作/提交和更轻松的分布式工作。

# iphone - iPhone 界面生成器教程

> ID：356607
> 
> 赞同：8
> 
> 时间：2008-12-10T16:08:08.003
> 
> 标签：iphone, cocoa-touch, interface-builder

有人知道如何使用 Interface Builder 进行 iPhone 开发的一些教程材料吗？我可以找到示例项目和东西，这非常有帮助，但它们并没有揭示在 Interface Builder 中的设置方式。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-10T16:30:34.837

Pragmatic Programmers 有一些关于构建 iphone 应用程序的[截屏视频。](http://www.pragprog.com/screencasts/v-bdiphone/writing-your-first-iphone-application)我没有看过那些，但我看过他们的一些其他视频，它们非常好。

他们还有一个免费的 Xcode 和 Interface Builder 入门集，这可能是您想要的。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-11T01:31:23.153

您实际上可以从这些截至目前免费的截屏视频中获得很多：http: [//www.cocoacast.com/? q=blog/1](http://www.cocoacast.com/?q=blog/1)

请注意，它们与 Aaron Hillegass 有关 Mac 编程的书非常“相关”（这也是一个很好的资源）。其中一些向他展示了使用 IB（但当然不是全部）。这本书更侧重于 Mac 而不是 iPhone，但如果你只是想开始，这是一个很好的出发点。我正在开发我的第一个 iPhone 项目，但从未使用 Objective C、XCode IDE 和 Interface Builder 进行编程。我阅读了前 200 页，之后使用了 Apple 的文档。现在已经几个月了，我找到了上面的屏幕截图，希望我能开始！祝你好运

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-10T17:33:57.033

Pragmatic Programmers 这本书[iPhone SDK Development](http://pragprog.com/titles/amiphd/iphone-sdk-development)包括一些 Interface Builder 演练。

# java - 使用 Java 进行图像转码（JPEG 到 PNG）

> ID：356616
> 
> 赞同：21
> 
> 时间：2008-12-10T16:10:17.297
> 
> 标签：java, png, jpeg, image-transcoding

在我的 Java 应用程序中，我想下载 JPEG，将其传输到 PNG 并使用生成的字节做一些事情。

我几乎可以肯定我记得存在一个这样做的图书馆，我不记得它的名字。

* * *

## 回答 #1

> 赞同：38
> 
> 时间：2008-12-10T16:23:39.343

这就是我最终要做的，当我问这个问题时，我想得太远了。

```
// these are the imports needed
import java.awt.image.BufferedImage;
import java.io.File;
import javax.imageio.ImageIO;
import java.io.ByteArrayOutputStream;

// read a jpeg from a inputFile
BufferedImage bufferedImage = ImageIO.read(new File(inputFile));

// write the bufferedImage back to outputFile
ImageIO.write(bufferedImage, "png", new File(outputFile));

// this writes the bufferedImage into a byte array called resultingBytes
ByteArrayOutputStream byteArrayOut = new ByteArrayOutputStream();
ImageIO.write(bufferedImage, "png", byteArrayOut);
byte[] resultingBytes = byteArrayOut.toByteArray(); 
```

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2008-12-10T16:16:08.890

[javax.imageio](http://java.sun.com/javase/6/docs/api/javax/imageio/ImageIO.html "javax.imageio")应该足够了。将您的 JPEG 文件放入 BufferedImage，然后使用以下命令保存：

```
File file = new File("newimage.png");
ImageIO.write(myJpegImage, "png", file); 
```

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2008-12-10T16:16:15.443

[ImageIO](http://docs.oracle.com/javase/6/docs/api/javax/imageio/ImageIO.html)可用于加载 JPEG 文件和保存 PNG 文件（`ByteArrayOutputStream`如果您不想写入文件，也可用于保存）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2014-10-11T06:44:43.860

```
BufferedImage bufferGambar;
try {

    bufferGambar = ImageIO.read(new File("ImagePNG.png"));
    // pkai type INT karna bertipe integer RGB bufferimage
    BufferedImage newBufferGambar = new BufferedImage(bufferGambar.getWidth(), bufferGambar.getHeight(), BufferedImage.TYPE_INT_RGB);

    newBufferGambar.createGraphics().drawImage(bufferGambar, 0, 0, Color.white, null);
    ImageIO.write(newBufferGambar, "jpg", new File("Create file JPEG.jpg"));

    JOptionPane.showMessageDialog(null, "Convert to JPG succes YES");

} catch(Exception e) {
    JOptionPane.showMessageDialog(null, e);
} 
```

# asp.net - 为什么更新面板在选择另一个列表框中时取消选择列表框中的当前选择？

> ID：356629
> 
> 赞同：1
> 
> 时间：2008-12-10T16:14:53.887
> 
> 标签：asp.net, asp.net-ajax, updatepanel

我有一个包装在 asp:UpdatePanel 中的 asp:ListBox。列表框包含所有美国。例如，如果我选择 Alaska，然后向下滚动以选择 Wyoming，则列表框会跳回列表顶部，而不是停留在 Wyoming，并且它会取消选择 Alaska，但 Wyoming 仍处于选中状态。有没有人遇到过这个？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-10T18:32:02.953

听起来您将列表框设置为自动回发。这将解释页面或部分页面（在您的更新面板内）重新加载时的跳转。

至于取消选择默认选项（阿拉斯加），这是默认行为。通过单击只能选择 1 个选项（即使您将 SelectionMode 设置为多个）。要选择多个选项，如果启用，您需要按住 Ctrl 并单击选项。这是您无法直接控制的浏览器/操作系统行为。

# python - 你将如何解析缩进（python 风格）？

> ID：356638
> 
> 赞同：11
> 
> 时间：2008-12-10T16:17:25.520
> 
> 标签：python, parsing, indentation, lexer

您将如何定义解析器和词法分析器规则来解析使用缩进定义范围的语言。

我已经用谷歌搜索并找到了一种通过在词法分析器中生成 INDENT 和 DEDENT 标记来解析它的聪明方法。

如果我遇到有趣的事情，我会更深入地研究这个问题并发布答案，但我想看看解决这个问题的其他方法。

编辑：正如查理指出的那样，[如果不一样的话，已经有另一个非常相似的线程了。](https://stackoverflow.com/questions/232682/how-would-you-go-about-implementing-off-side-rule)我的帖子应该被删除吗？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-12-10T17:48:55.130

这是一种假设，因为它取决于您的词法分析器和解析器拥有什么技术，但最简单的方法似乎是使用类似于 C 中的大括号的 BEGINBLOCK 和 ENDBLOCK 标记。使用您的词法分析器需要的[“越位规则”](http://en.wikipedia.org/wiki/Off-side_rule)跟踪一堆缩进级别。当缩进级别增加时，为解析器发出一个 BEGINBLOCK ；当缩进级别降低时，发出 ENDBLOCK 并从堆栈中弹出级别。

这是关于SO[的另一个讨论，顺便说一句。](https://stackoverflow.com/questions/232682/how-would-you-go-about-implementing-off-side-rule)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-10T17:18:57.983

Also you can track somewhere in lexer how many ident items are preceding first line and pass it to parser. Most interesting part would be trying to pass it to parser correctly :) If your parser uses lookahead (here I mean parser may query for variable number of tokens before it really going to match even one) then trying to pass it through one global variable seems to be very bad idea (because lexer can slip on next line and change value of indent counter while parser is still trying to parse previous line). Also globals are evil in many other cases ;) Marking first line 'real' token in someway with indent counter is more reasonable. I can't give you exact example (I don't even know what parser and lexer generators are you going to use if any...) but something like storing data on first line tokens (it could be non comfortable if you can't easily get such token from parser) or saving custom data (map that links tokens to indent, array where every line in source code as index and indent value as element value) seems to be enough. One downside of this approach is additional complexity to parser that will need to distinguish between ident values and change its behavior based on it. Something like LOOKAHEAD({ yourConditionInJava }) for JavaCC may work here but it is **NOT** a very good idea. A lot of additional tokens in your approach seems to be less evil thing to use :)

As another alternative I would suggest is to mix this two approaches. You could generate additional tokens only when indent counter changes its value on next line. It is like artificial BEGIN and END token. In this way you may lower number of 'artificial' tokens in your stream fed into parser from lexer. Only your parser grammar should be adjusted to understand additional tokens...

I didn't tried this (have no real experience with such languages parsing), just sharing my thoughts about possible solutions. Checking already built parsers for this kinds of languages could be of great value for you. Open source is your friend ;)

# asp.net - OOP 设计问题 - 跟踪许多类似的事情

> ID：356640
> 
> 赞同：1
> 
> 时间：2008-12-10T16:19:09.900
> 
> 标签：asp.net, design-patterns, oop

我正在为 C#/ASP.net 应用程序设计数据访问层，并且我对 sql 查询中的参数处理有疑问。

目前，当查询需要为 Where 子句动态设置参数时，我必须 (1) 定义一个变量来保存该值，(2) 将一个新的 QueryStringParameter 添加到 SqlDataSource 的 SelectParameters 集合中，(3) 设置临时值调用包含查询的方法时的参数的值， (4) 并在 SqlDataSource 的 Selecting 事件上设置参数的值。

我有一个大约 20 个参数的列表，这些参数在不同的查询中使用，似乎我应该能够定义每个参数并简单地告诉使用哪个方法（并适当地更新它的值）。

有没有好的方法来设置它？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-10T16:27:19.307

我最喜欢的方法是设置一个对象数据源，然后在您的表适配器中，您可以使用各种选择所需的不同参数为您想要执行的所有不同查询添加查询。这使您能够忽略实际参数，只使用类来调用方法并传递适当的参数。您还可以获得返回一流对象或对象集合的好处，而不必担心对每个返回值进行类型转换。如果您返回的架构针对每个查询进行了修改，则此方法效果不佳。

Scott Gu 博客中的这篇文章似乎更深入地涵盖了我正在谈论的内容，但老实说，我只是略读了一下：

[http://weblogs.asp.net/scottgu/archive/2006/01/15/435498.aspx](http://weblogs.asp.net/scottgu/archive/2006/01/15/435498.aspx)

# asp.net - 引发了“System.OutOfMemoryException”类型的异常。为什么？

> ID：356645
> 
> 赞同：16
> 
> 时间：2008-12-10T16:22:06.210
> 
> 标签：asp.net, sql-server, tsql

我有一个动态查询，它返回大约 590,000 条记录。它第一次运行成功，但如果我再次运行它，我会不断得到一个`System.OutOfMemoryException`. 这可能发生的一些原因是什么？

错误发生在这里：

```
 public static DataSet GetDataSet(string databaseName,string
                                   storedProcedureName,params object[] parameters)
    {
        //Creates blank dataset
        DataSet ds = null;

        try
        {
            //Creates database
            Database db = DatabaseFactory.CreateDatabase(databaseName);
            //Creates command to execute
            DbCommand dbCommand = db.GetStoredProcCommand(storedProcedureName);
            dbCommand.CommandTimeout = COMMAND_TIMEOUT;
            //Returns the list of SQL parameters associated with that stored proecdure
            db.DiscoverParameters(dbCommand);

            int i = 1;
            //Loop through the list of parameters and set the values
            foreach (object parameter in parameters)
            {
                dbCommand.Parameters[i++].Value = parameter;
            }
            //Retrieve dataset and set to ds
            ds = db.ExecuteDataSet(dbCommand);
        }
            //Check for exceptions
        catch (SqlException sqle)
        {
            throw sqle;
        }
        catch (Exception e)
        {
            throw e; // Error is thrown here.
        }
        //Returns dataset
        return ds;
    } 
```

这是单击按钮时运行的代码：

```
protected void btnSearchSBIDatabase_Click(object sender, EventArgs e)
{

        LicenseSearch ls = new LicenseSearch();

        DataTable dtSearchResults = new DataTable();

        dtSearchResults = ls.Search();

        Session["dtSearchResults"] = dtSearchResults;

        Response.Redirect("~/FCCSearch/SearchResults.aspx");
        }
        else
            lblResults.Visible = true;
    } 
```

* * *

## 回答 #1

> 赞同：42
> 
> 时间：2008-12-10T17:08:51.327

> 它第一次运行成功，但如果我再次运行它，我会不断收到 System.OutOfMemoryException。这可能发生的一些原因是什么？

不管其他人怎么说，该错误与忘记处置您的 DBCommand 或 DBConnection 无关，并且您不会通过处置其中任何一个来修复您的错误。

该错误与包含近 600,000 行数据的数据集有关。显然，您的数据集消耗了您机器上 50% 以上的可用内存。显然，当您在第一个数据集被垃圾收集之前返回另一个相同大小的数据集时，您将耗尽内存。就那么简单。

您可以通过以下几种方式解决此问题：

*   考虑返回更少的记录。我个人无法想象返回 600K 记录对用户有用的时候。要最小化返回的记录，请尝试：

    *   将查询限制为前 1000 条记录。如果查询返回的结果超过 1000 个，则通知用户缩小搜索结果的范围。

    *   如果您的用户真的坚持要一次查看这么多数据，请尝试分页数据。请记住：Google 不会一次向您显示全部 22 亿条搜索结果，它一次向您显示 20 条左右的记录。Google 可能不会一次将所有 22 个 bajillion 结果保存在内存中，它可能会发现重新查询其数据库以生成新页面的内存效率更高。

*   如果您只需要遍历数据并且不需要随机访问，请尝试返回数据读取器。数据读取器一次仅将一条记录加载到内存中。

如果这些都不是一个选项，那么您需要强制 .NET 在使用以下方法之一调用您的方法之前释放数据集使用的内存：

*   删除对旧数据集的所有引用。任何对数据集的引用都会阻止它被内存回收。

*   如果您不能对数据集的所有引用都清空，请清除数据集中的所有行以及绑定到这些行的所有对象。这将删除对数据行的引用并允许它们被垃圾收集器吃掉。

我不相信你需要打电话`GC.Collect()`来强制生成循环。调用 不仅通常是个坏主意`GC.Collect()`，因为足够的内存压力会导致 .NET 自行调用垃圾收集器。

*注意：对数据集调用 Dispose 不会释放任何内存，也不会调用垃圾收集器，也不会删除对数据集的引用。Dispose 用于清理非托管资源，但 DataSet 没有任何非托管资源。它只实现 IDispoable，因为它是 MarshalByValueComponent 固有的，因此数据集上的 Dispose 方法几乎没有用。*

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-12-10T16:25:06.267

也许您没有处理上一次运行中的先前连接/结果类，这意味着它们仍然在内存中徘徊。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-10T16:32:36.550

你显然不是在处理东西。

在临时使用实现 IDisposable 的对象时考虑“使用”命令。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-04-13T06:39:51.210

尝试尽可能多地破坏您的大数据，因为我已经多次遇到此类问题。其中我有超过 100 万条记录，有 15 列。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-10T17:54:25.260

它在哪里失败？

我同意您的问题可能是您的 600,000 行数据集可能太大了。我看到您随后将其添加到 Session. 如果您使用的是 Sql 会话状态，它也必须序列化该数据。

即使你正确地处理了你的对象，如果你运行它两次，一次在会话中，一次在程序代码中，你将始终在内存中至少有 2 个此数据集的副本。这永远不会在 Web 应用程序中扩展。

算一下，600,000 行，即使每行 1-128 位 guid 也会产生 9.6 兆字节 (600k * 128 / 8) 的数据，更不用说数据集开销了。

减少你的结果。

# asp.net - 随机“virtualPath”错误 - Asp.Net 应用程序

> ID：356651
> 
> 赞同：1
> 
> 时间：2008-12-10T16:23:41.917
> 
> 标签：asp.net, internationalization

完整的错误是-“值不能为空。参数名称：virtualPath”。这发生在我们的 QA 和培训环境（Win 2003 Server 和 IIS6）中，但当然无法在调试器中重新创建。更糟糕的是，尽管有一个合理的全局错误处理程序，但没有堆栈跟踪伴随错误，并且没有任何内容写入事件日志。该应用程序是在 2.0 框架下运行的大型完全全球化的 Asp.Net (VB) Web 应用程序。它对 resx 文件使用通常的“App_LocalResources”结构，并且迄今为止表现得非常好。应用程序中有几个地方使用了这样的代码：

```
Dim x As New Compilation.ExpressionBuilderContext(Control.TemplateControl)  
Dim path As String = x.VirtualPath  
Dim res As String = HttpContext.GetLocalResourceObject(path, resourceKey).ToString 
```

但是，当我强制“路径”变量为空时，此代码周围的 Try/Catch 块可以正常工作。我们还在任何地方对数据网格列标题使用这种语法：

```
<asp:TemplateColumn HeaderText="<%$ Resources:resHeader %>" > 
```

我们还使用了大量的 Ajax 并不断地将 ascx 控件动态加载到占位符中。如果有人对此有任何见解，我将非常感谢您的帮助。

谢谢，拉里

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-22T20:23:44.593

跟进 - 确保您的服务器达到正确的补丁级别。
其根本原因是没有安装
2.0 .Net Framework SP1 的 3 个 QA VM。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-10T16:34:50.773

这可能听起来很傻，但我以前也遇到过这种情况。

如果您复制并粘贴错误，我注意到它显示“virtualPath”（小写 v）；在您的示例代码中，您使用的属性具有 VirtualPath（大写 V）。

另外，您得到的实际异常是什么？NullReferenceException？

# sql-server - SQL Server 2000 中当前正在运行的 SQL 语句的执行计划

> ID：356657
> 
> 赞同：2
> 
> 时间：2008-12-10T16:26:02.600
> 
> 标签：sql-server, sql-server-2000

DBA 有什么方法可以查看 SQL Server 2000 中长时间运行的查询的执行计划？我知道如何使用 fn_get_sql() 运行 SQL。是的，理论上如果打开一个新连接并设置相同的环境标志，它应该为 SQL 生成相同的计划。但是，我在数据仓库环境中，这个查询已经运行了 12 个小时，中间有数据加载，所以不能保证新计划会匹配旧计划。我只想确切地知道服务器在做什么。

不，我当然不会终止当前正在运行的语句，除非我能看到计划并确定我可以使用索引和连接提示做得更好。

更新：我感觉如此接近，但我仍然认为可以做到。它绝对可以在 2K5 及更高版本中完成。如果查看 syscacheobjects 虚拟表，每个缓存计划都有对象 ID。您可以在这些 id 上调用 sp_OA* 方法，但是如果不了解对象模型（这是专有的），我将无处可去。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-10T21:22:08.337

你不能。您可以做的最好的事情是在查询过程中运行[DBCC INPUTBUFFER](http://msdn.microsoft.com/en-us/library/aa178303(SQL.80).aspx)并查看最后执行的语句是什么。然后，您可以在查询分析器中运行它并获取执行计划。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-10T17:58:16.923

我不认为你可以做这样的事情，它需要与原始查询一起提交给服务器：

[http://msdn.microsoft.com/en-us/library/aa178303(SQL.80).aspx](http://msdn.microsoft.com/en-us/library/aa178303(SQL.80).aspx)。

您可以加载查询并获得估计的执行计划。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-11T17:53:17.463

也许...

运行分析器，并展开“性能”事件节点。选择 SHOWPLAN 选项之一。

希望您能够捕获执行结束。我知道您可以记录查询计划，但我不知道它在这种情况下是否有效。

我没有 SQL 2k 探查器，只有 2k5 来测试某些东西或查看选项。

# wpf - 如何解决 WPF 设计器错误“类型 {0} 不支持直接内容”。

> ID：356663
> 
> 赞同：7
> 
> 时间：2008-12-10T16:27:36.200
> 
> 标签：wpf, designer, contentproperty

以下 XAML（如下）在资源中定义了一个自定义集合，并尝试使用自定义对象填充它；

```
<UserControl x:Class="ImageListView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml" Width="300" Height="300"
    xmlns:local="clr-namespace:MyControls" >
    <UserControl.Resources>
        <local:MyCustomCollection x:Key="MyKey">
            <local:MyCustomItem>
            </local:MyCustomItem>
        </local:MyCustomCollection>
    </UserControl.Resources>
</UserControl> 
```

问题是我在“类型'MyCustomCollection'不支持直接内容”的设计器中遇到错误。我已尝试按照 MSDN 中的建议设置 ContentProperty，但无法弄清楚将其设置为什么。我使用的自定义集合对象如下，非常简单。我已经尝试过 Item、Items 和 MyCustomItem，但想不出还有什么可以尝试的。

```
<ContentProperty("WhatGoesHere?")> _
Public Class MyCustomCollection
    Inherits ObservableCollection(Of MyCustomItem)
End Class 
```

任何关于我哪里出错的线索都将不胜感激。还提示如何深入研究 WPF 对象模型以查看在运行时公开了哪些属性，我也许也可以通过这种方式弄清楚。

问候

瑞安

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-10T17:02:29.093

您必须使用将代表您的类内容的属性名称来初始化 ContentPropertyAttribute。在您的情况下，因为您从 ObservableCollection 继承，所以这将是 Items 属性。不幸的是，Items 属性是只读的，这是不允许的，因为 Content 属性必须有一个设置器。因此，您必须在 Items 周围定义一个自定义包装器属性并在您的属性中使用它 - 如下所示：

```
public class MyCustomItem
{ }

[ContentProperty("MyItems")]
public class MyCustomCollection : ObservableCollection<MyCustomItem>
{
    public IList<MyCustomItem> MyItems
    {
        get { return Items; }
        set 
        {
            foreach (MyCustomItem item in value)
            {
                Items.Add(item);
            }
       }
    }
} 
```

你应该没事。很抱歉，当您的示例在 VB 中时，在 C# 中这样做，但我真的很讨厌 VB，甚至连这么简单的事情都做不好......无论如何，转换它很容易，所以 - 希望有帮助。

# windows - Qmake中win64配置的标识符

> ID：356666
> 
> 赞同：34
> 
> 时间：2008-12-10T16:28:54.980
> 
> 标签：windows, qt, 64-bit, qt4, qmake

Qmake 项目文件中是否有“win64”标识符？[Qt Qmake高级](http://doc.trolltech.com/4.4/qmake-advanced-usage.html)文档除了unix/macx/win32之外没有提到。

到目前为止，我已经尝试使用：

```
win32:message("using win32")
win64:message("using win64")
amd64:message("using amd64") 
```

结果总是“使用win32”。

我必须为 x32 和 x64 项目使用单独的项目文件，以便它们可以针对正确的库进行编译吗？有没有其他方法可以识别 32 位和 64 位环境？

* * *

## 回答 #1

> 赞同：35
> 
> 时间：2010-04-17T11:25:38.860

我这样做

```
win32 {

    ## Windows common build here

    !contains(QMAKE_TARGET.arch, x86_64) {
        message("x86 build")

        ## Windows x86 (32bit) specific build here

    } else {
        message("x86_64 build")

        ## Windows x64 (64bit) specific build here

    }
} 
```

* * *

## 回答 #2

> 赞同：32
> 
> 时间：2015-06-09T05:47:04.343

从 Qt5 开始，您可以使用`QT_ARCH`来检测您的配置是 32 还是 64。当目标是 32 位时，返回`i386`，如果是 64 位目标，它的值为`x86_64`. 所以它可以像这样使用：

```
contains(QT_ARCH, i386) {
    message("32-bit")
} else {
    message("64-bit")
} 
```

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2010-04-24T10:18:17.963

更新：最近以来，Qt 有一种透明且轻松的方式，无需手动操作：

```
win32-g++:contains(QMAKE_HOST.arch, x86_64):{
    do something
} 
```

来源：[全新的 Qt Dev FAQ](http://developer.qt.nokia.com/faq/answer/how_can_i_detect_in_the_.pro_file_if_i_am_compiling_for_a_32_bit_or_a_64_bi)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-01T09:58:20.167

我想出了一种方法来做到这一点。

Qt 允许您传递可用于分隔目标的任意配置参数。

通过在项目文件中进行条件配置：

```
CONFIG(myX64, myX64|myX32) {
    LIBPATH += C:\Coding\MSSDK60A\Lib\x64
} else {
    LIBPATH += C:\Coding\MSSDK60A\Lib
} 
```

并将该自定义配置传递给`qmake`with

```
qmake CONFIG+=myX64 
```

你得到想要的结果。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-10T19:44:24.960

不，但是您可以创建和使用新的 mkspec，我认为 qmake 还定义了一个以当前 mkspec 命名的平台标识符。为什么需要测试 64 位？

芦苇

# java - 如何使用 JFileChooser.showSaveDialog(...) 设置建议的文件名？

> ID：356671
> 
> 赞同：65
> 
> 时间：2008-12-10T16:30:47.160
> 
> 标签：java, swing, jfilechooser

`JFileChooser`似乎缺少一个功能：一种在保存文件时建议文件名的方法（通常被选中的东西，以便在用户开始输入时被替换）。

有没有解决的办法？

* * *

## 回答 #1

> 赞同：115
> 
> 时间：2008-12-10T16:38:58.313

如果我理解正确，您需要使用该`setSelectedFile`方法。

```
JFileChooser jFileChooser = new JFileChooser();
jFileChooser.setSelectedFile(new File("fileToSave.txt"));
jFileChooser.showSaveDialog(parent); 
```

该文件不需要存在。

如果您传递带有绝对路径的文件，`JFileChooser`将尝试将自己定位在该目录中（如果存在）。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2012-02-02T20:23:30.090

setSelectedFile 不适用于上述目录，解决方案是

```
try {
    FileChooserUI fcUi = fileChooser.getUI();
    fcUi.setSelectedFile(defaultDir);
    Class<? extends FileChooserUI> fcClass = fcUi.getClass();
    Method setFileName = fcClass.getMethod("setFileName", String.class);
    setFileName.invoke(fcUi, defaultDir.getName());
} catch (Exception e) {
    e.printStackTrace();
} 
```

不幸的是，`setFileName`不包含在 UI 界面中，因此需要动态调用它。仅在 Mac 上测试。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-07-11T15:18:24.593

如果这不起作用，这里有一个解决方法：

```
dialog.getUI().setFileName( name ) 
```

但是你应该检查选择模式是`FILES_ONLY`还是`FILES_AND_DIRECTORIES`。如果是`DIRECTORIES_ONLY`，`setSelectedFile()`则将删除文件名。

# asp.net-mvc - ASP.NET MVC 索引与索引和列表视图

> ID：356674
> 
> 赞同：1
> 
> 时间：2008-12-10T16:31:23.073
> 
> 标签：asp.net-mvc, model-view-controller

我正在开发我的第一个 ASP.NET MVC 应用程序。此应用程序跟踪慈善组织的事件、用户、捐助者等。在我的事件控制器中，我支持带有新建/编辑/显示视图的标准 CRUD 操作（删除是通过显示视图上的按钮完成的）。但我也想列出所有的事件。

是拥有一个从索引视图导航到的列表视图还是让“列表”视图成为索引视图更好。索引视图是控制器的默认视图。如果您将索引/列表分开，您会在索引视图中放置什么？

现在我倾向于将它们分开并将基本帮助信息放在索引视图上。我是否应该考虑更改它并让列表视图成为默认视图并将索引重命名为帮助？

TIA 为 SO 的集体智慧。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-25T14:38:57.920

我决定将 Index 操作重定向到 List 操作。这使我不必创建和维护索引视图，但留下了我可以实现除模型列表之外的索引操作的可能性。

```
public ActionResult Index()
{
    return RedirectToAction( "List" );
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-10T18:01:42.827

您的索引视图页面可能包括

```
<body>
    <% RenderPartial("List", "Events") %>
</body> 
```

这相当于调用

```
/Views/Events/List.ascx 
```

列表视图是一个 asp.net mvc 用户控件。这将为您提供一个包含事件列表的索引视图。

# sql - 在 WHERE 子句中使用别名

> ID：356675
> 
> 赞同：70
> 
> 时间：2008-12-10T16:31:39.670
> 
> 标签：sql, oracle, alias, decode, ora-00904

我有一个查询，旨在向我显示表 A 中最近没有足够更新的任何行。（每行应在“month_no”之后的 2 个月内更新。）：

```
SELECT A.identifier
     , A.name
     , TO_NUMBER(DECODE( A.month_no
             , 1, 200803 
             , 2, 200804 
             , 3, 200805 
             , 4, 200806 
             , 5, 200807 
             , 6, 200808 
             , 7, 200809 
             , 8, 200810 
             , 9, 200811 
             , 10, 200812 
             , 11, 200701 
             , 12, 200702
             , NULL)) as MONTH_NO
     , TO_NUMBER(TO_CHAR(B.last_update_date, 'YYYYMM')) as UPD_DATE
  FROM table_a A
     , table_b B
 WHERE A.identifier = B.identifier
   AND MONTH_NO > UPD_DATE 
```

WHERE 子句中的最后一行导致“ORA-00904 Invalid Identifier”错误。不用说，我不想在 WHERE 子句中重复整个 DECODE 函数。有什么想法吗？（接受修复和解决方法......）

* * *

## 回答 #1

> 赞同：115
> 
> 时间：2008-12-10T16:36:56.570

这是不可能的，因为按时间顺序，WHERE 发生*在*SELECT 之前，它始终是执行链中的最后一步。

您可以对其进行子选择和过滤：

```
SELECT * FROM
(
  SELECT A.identifier
    , A.name
    , TO_NUMBER(DECODE( A.month_no
      , 1, 200803 
      , 2, 200804 
      , 3, 200805 
      , 4, 200806 
      , 5, 200807 
      , 6, 200808 
      , 7, 200809 
      , 8, 200810 
      , 9, 200811 
      , 10, 200812 
      , 11, 200701 
      , 12, 200702
      , NULL)) as MONTH_NO
    , TO_NUMBER(TO_CHAR(B.last_update_date, 'YYYYMM')) as UPD_DATE
  FROM table_a A
    , table_b B
  WHERE A.identifier = B.identifier
) AS inner_table
WHERE 
  MONTH_NO > UPD_DATE 
```

有趣的信息从评论中移了出来：

> 应该没有性能损失。Oracle 不需要在应用外部条件之前实现内部查询——Oracle 将考虑在内部转换此查询并将谓词下推到内部查询中，如果它具有成本效益，它将这样做。–[贾斯汀洞穴](https://stackoverflow.com/users/10397/justin-cave)

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2012-01-06T06:48:21.243

```
 SELECT A.identifier
 , A.name
 , TO_NUMBER(DECODE( A.month_no
         , 1, 200803 
         , 2, 200804 
         , 3, 200805 
         , 4, 200806 
         , 5, 200807 
         , 6, 200808 
         , 7, 200809 
         , 8, 200810 
         , 9, 200811 
         , 10, 200812 
         , 11, 200701 
         , 12, 200702
         , NULL)) as MONTH_NO
 , TO_NUMBER(TO_CHAR(B.last_update_date, 'YYYYMM')) as UPD_DATE
FROM table_a A, table_b B
WHERE .identifier = B.identifier
HAVING MONTH_NO > UPD_DATE 
```

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2009-10-15T18:57:39.320

或者你可以在一个`HAVING`子句中使用你的别名

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2017-02-14T05:49:23.200

正如您可以做的另一种方法一样：

```
WITH inner_table AS
(SELECT A.identifier
    , A.name
    , TO_NUMBER(DECODE( A.month_no
      , 1, 200803 
      , 2, 200804 
      , 3, 200805 
      , 4, 200806 
      , 5, 200807 
      , 6, 200808 
      , 7, 200809 
      , 8, 200810 
      , 9, 200811 
      , 10, 200812 
      , 11, 200701 
      , 12, 200702
      , NULL)) as MONTH_NO
    , TO_NUMBER(TO_CHAR(B.last_update_date, 'YYYYMM')) as UPD_DATE
  FROM table_a A
    , table_b B
  WHERE A.identifier = B.identifier)

    SELECT * FROM inner_table 
    WHERE MONTH_NO > UPD_DATE 
```

您还可以为队列创建永久视图并从视图中选择。

```
CREATE OR REPLACE VIEW_1 AS (SELECT ...);
SELECT * FROM VIEW_1; 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2018-04-17T13:22:22.100

可以有效地定义一个可以在 SELECT、WHERE 和其他子句中使用的变量。

子查询不一定允许对引用的表列进行适当的绑定，但是 OUTER APPLY 可以。

```
SELECT A.identifier
     , A.name
     , vars.MONTH_NO
     , TO_NUMBER(TO_CHAR(B.last_update_date, 'YYYYMM')) as UPD_DATE
FROM table_a A
     , table_b B ON A.identifier = B.identifier
OUTER APPLY (
   SELECT
        -- variables
        MONTH_NO = TO_NUMBER(DECODE( A.month_no
                     , 1, 200803 
                     , 2, 200804 
                     , 3, 200805 
                     , 4, 200806 
                     , 5, 200807 
                     , 6, 200808 
                     , 7, 200809 
                     , 8, 200810 
                     , 9, 200811 
                     , 10, 200812 
                     , 11, 200701 
                     , 12, 200702
                     , NULL))
) vars
WHERE vars.MONTH_NO > UPD_DATE 
```

向[Syed Mehroz Alam 致敬](https://smehrozalam.wordpress.com/2010/01/25/referring-computedcalculated-columns-in-the-where-and-group-by-clause/)。

# asp.net - 混淆 .NET Web 应用程序

> ID：356680
> 
> 赞同：2
> 
> 时间：2008-12-10T16:33:07.687
> 
> 标签：asp.net, obfuscation, web-applications

是否可以混淆 .NET Web 应用程序？我尝试使用 Visual Studio 2005 附带的 Dotofuscator 工具，并且能够混淆预编译网站的 dll，但是当我将灵魂部署到 IIS 服务器时，我无法处理应用程序的页面。

所以问题是：你们中的任何人都能够混淆一个完整的 .NET Web 应用程序吗？

感谢您的回答

编辑：我混淆了 bin 文件夹中的所有 dll。该站点是在不允许更新 aspx 文件的情况下构建的。之后，当我转到[http://serveradress/main.aspx](http://serveradress/main.aspx)时，我收到一条错误消息，指出 main.aspx 不存在

PD：我需要混淆代码，因为应用程序会执行一些许可证检查，并且我想让删除许可证检查代码变得更加困难

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-10T16:38:32.527

请记住，如果您混淆了使用反射的应用程序，它可能会导致问题。

我个人认为没有必要进行混淆，因为***真正*****想查看您的代码的****人***，无论您是否混淆它，都会努力获得它。*

 ** * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-04-06T13:58:26.810

事实上，你可以。你混淆了dll。问题是，您必须排除重命名许多类，继承 System.Web.UI.Page、UserControl 的类，并且您还必须排除 HttpAplicattion。一些混淆器，如[BitHelmet Obfuscator](http://www.bithelmet.com) ( [http://www.bithelmet.com](http://www.bithelmet.com) ) 和 DeepSea ( [http://www.deepseaobfuscator.com](http://www.deepseaobfuscator.com) ) 提供“智能排除”，因此您不必手动执行此操作。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-10T16:56:18.297

确保将库设置与混淆软件一起使用。如果您不这样做，您的所有类和方法都将被重命名。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-09-26T00:04:39.173

如果您可以找到 aspx 文件的代码隐藏类的混淆名称，那么您可以使用新的命名空间和类名设置继承属性。您可以使用 Reflector 并通过方法声明进行查询，或者您的混淆程序可能会输出 old_name - obfuscated_name 列表。

# apache-flex - 在哪里可以找到有关开始为 Flex/AIR 创建外观的信息？

> ID：356692
> 
> 赞同：1
> 
> 时间：2008-12-10T16:35:36.607
> 
> 标签：apache-flex, air, skins

我没有任何创建皮肤的经验，但我有工具（烟花等）。我习惯于尽可能多地使用样式，但是，我想打破常规并开始更多地使用皮肤，尤其是这样我的应用程序的外观可以移植到其他平台。我从哪里开始？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-10T16:53:58.363

[http://www.adobe.com/devnet/flex/quickstart/skinning_components/](http://www.adobe.com/devnet/flex/quickstart/skinning_components/)

[http://flashenabledblog.com/2008/06/27/tutorials-developing-extending-and-styling-flex-components/](http://flashenabledblog.com/2008/06/27/tutorials-developing-extending-and-styling-flex-components/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-10T18:57:10.423

您可以在此处找到更多 Adob​​e Flex 皮肤：[scalenine.com](http://www.scalenine.com/)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-10T17:00:00.410

这真的是我一直在寻找的：http: [//www.adobe.com/devnet/flex/articles/skins_styles.html](http://www.adobe.com/devnet/flex/articles/skins_styles.html)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-10T19:22:36.363

Juan Sanchez 和 Andy McIntosh 刚刚发布了一本很棒的书，详细介绍了蒙皮和一般 UI 美化：

[使用 Flex 3.0 创建视觉体验](http://www.amazon.com/gp/redirect.html?ie=UTF8&location=http%3A%2F%2Fwww.amazon.com%2Fs%3Fie%3DUTF8%26x%3D0%26ref%255F%3Dnb%255Fss%255Fgw%26y%3D0%26field-keywords%3Dvisial%2520experiences%2520flex%25203%26url%3Dsearch-alias%253Daps&tag=chrtos-20&linkCode=ur2&camp=1789&creative=390957)

我已经读到一半了，绝对值得一读——如果没有良好的指导，剥皮可能会让人头疼。

干杯。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-13T04:07:48.240

我还阅读了《使用 Flex 3.0 创建视觉体验》一书，并为您想要做的事情点赞。章节特别关注在各种软件中设计皮肤，其中之一是 Fireworks。

# .net - .Net Windows 更新查询

> ID：356693
> 
> 赞同：3
> 
> 时间：2008-12-10T16:35:47.337
> 
> 标签：.net, powershell, windows-update

我很好奇是否有一个 .Net API 可以让我确定哪些更新正在等待“Windows Update”

如果做不到这一点，是否有可以获取它的 windows powershell 命令？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-12T02:36:02.523

这是一个 VBScript，您可以使用它来安装更新

[http://msdn.microsoft.com/en-us/library/aa387102(VS.85).aspx](http://msdn.microsoft.com/en-us/library/aa387102(VS.85).aspx)

您可以在 PowerShell 中非常轻松地使用 COM 对象。鉴于上述 VBScript 示例，您也可以在 PS 中使用该对象

```
PS C:\> $updateSession = new-object -com Microsoft.update.Session
PS C:\> $updateSession | get-member

   TypeName: System.__ComObject#{918efd1e-b5d8-4c90-8540-aeb9bdc56f9d}

Name                       MemberType Definition
----                       ---------- ----------
CreateUpdateDownloader     Method     IUpdateDownloader CreateUpdateDownloader ()
CreateUpdateInstaller      Method     IUpdateInstaller CreateUpdateInstaller ()
CreateUpdateSearcher       Method     IUpdateSearcher CreateUpdateSearcher ()
CreateUpdateServiceManager Method     IUpdateServiceManager2 CreateUpdateServiceManager ()
QueryHistory               Method     IUpdateHistoryEntryCollection QueryHistory (string, int, int)
ClientApplicationID        Property   string ClientApplicationID () {get} {set}
ReadOnly                   Property   bool ReadOnly () {get}
UserLocale                 Property   uint UserLocale () {get} {set}
WebProxy                   Property   IWebProxy WebProxy () {get} {set}

PS C:\> $searcher = $updateSession.CreateUpdateSearcher()
PS C:\> $searcher | gm

   TypeName: System.__ComObject#{04c6895d-eaf2-4034-97f3-311de9be413a}

Name                                MemberType Definition
----                                ---------- ----------
BeginSearch                         Method     ISearchJob BeginSearch (string, IUnknown, Variant)
EndSearch                           Method     ISearchResult EndSearch (ISearchJob)
EscapeString                        Method     string EscapeString (string)
GetTotalHistoryCount                Method     int GetTotalHistoryCount ()
QueryHistory                        Method     IUpdateHistoryEntryCollection QueryHistory (int, int)
Search                              Method     ISearchResult Search (string)
CanAutomaticallyUpgradeService      Property   bool CanAutomaticallyUpgradeService () {get} {set}
ClientApplicationID                 Property   string ClientApplicationID () {get} {set}
IgnoreDownloadPriority              Property   bool IgnoreDownloadPriority () {get} {set}
IncludePotentiallySupersededUpdates Property   bool IncludePotentiallySupersededUpdates () {get} {set}
Online                              Property   bool Online () {get} {set}
SearchScope                         Property   SearchScope SearchScope () {get} {set}
ServerSelection                     Property   ServerSelection ServerSelection () {get} {set}
ServiceID                           Property   string ServiceID () {get} {set}

PS C:\> 
```

您可以继续使用 get-member 来找出所有不同的选项，并基本上将该 VBScript 转换为 PowerShell 并对其进行调整以执行您需要执行的任何操作。

安迪

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-10T16:40:44.957

Windows 更新代理 API 可能是您正在寻找的：

[http://msdn.microsoft.com/en-us/library/aa387287%28VS.85%29.aspx](http://msdn.microsoft.com/en-us/library/aa387287%28VS.85%29.aspx)

它是一个 COM 接口（不是 .NET 本机接口），但您可以从应用程序中使用它。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-10T16:50:04.580

这一点都不是那么简单，但您只需引用 COM/WUAPI 2.0 类型库，VS 就会为您创建一个托管包装器，并将其作为 WuApiLib.dll 复制到构建目录。

小心内存泄漏。

# curl - 如何通过 cURL 调用使用 HTTP 请求发送标头？

> ID：356705
> 
> 赞同：1761
> 
> 时间：2008-12-10T16:38:57.003
> 
> 标签：curl, http-headers

我希望在 Linux 机器上向我的 Apache 服务器发送标头。如何通过 cURL 调用实现此目的？

* * *

## 回答 #1

> 赞同：2087
> 
> 时间：2008-12-10T16:41:02.087

[`man curl`](https://curl.haxx.se/docs/manpage.html)：

```
 -H/--header <header>
          (HTTP)  Extra header to use when getting a web page. You may specify
          any number of extra headers. Note that if you should  add  a  custom
          header that has the same name as one of the internal ones curl would
          use, your externally set header will be used instead of the internal
          one.  This  allows  you  to make even trickier stuff than curl would
          normally do. You should not replace internally set  headers  without
          knowing  perfectly well what you're doing. Remove an internal header
          by giving a replacement without content on the  right  side  of  the
          colon, as in: -H "Host:".

          curl  will  make sure that each header you add/replace get sent with
          the proper end of line marker, you should thus not  add  that  as  a
          part  of the header content: do not add newlines or carriage returns
          they will only mess things up for you.

          See also the -A/--user-agent and -e/--referer options.

          This option can be used multiple times to add/replace/remove  multi-
          ple headers. 
```

# **例子：**

```
curl --header "X-MyHeader: 123" www.google.com 
```

`-v`您可以通过添加选项查看 curl 发送的请求。

* * *

## 回答 #2

> 赞同：834
> 
> 时间：2013-10-07T05:15:07.597

**得到：**

*使用 JSON：*

```
curl -i -H "Accept: application/json" -H "Content-Type: application/json" http://hostname/resource 
```

*使用 XML：*

```
curl -H "Accept: application/xml" -H "Content-Type: application/xml" -X GET http://hostname/resource 
```

**邮政：**

*对于发布数据：*

```
curl --data "param1=value1&param2=value2" http://hostname/resource 
```

*对于文件上传：*

```
curl --form "fileupload=@filename.txt" http://hostname/resource 
```

*RESTful HTTP 帖子：*

```
curl -X POST -d @filename http://hostname/resource 
```

*登录网站（auth）：*

```
curl -d "username=admin&password=admin&submit=Login" --dump-header headers http://localhost/Login
curl -L -b headers http://localhost/ 
```

* * *

## 回答 #3

> 赞同：291
> 
> 时间：2010-04-03T09:49:51.773

在*PHP*中：

```
curl_setopt($ch, CURLOPT_HTTPHEADER, array('HeaderName:HeaderValue')); 
```

或者您可以设置多个：

```
curl_setopt($ch, CURLOPT_HTTPHEADER, array('HeaderName:HeaderValue', 'HeaderName2:HeaderValue2')); 
```

* * *

## 回答 #4

> 赞同：60
> 
> 时间：2008-12-10T16:41:37.810

使用[`-H or --header`](http://curl.haxx.se/docs/manpage.html#-H).

手册页：[http ://curl.haxx.se/docs/manpage.html#-H](http://curl.haxx.se/docs/manpage.html#-H)

* * *

## 回答 #5

> 赞同：48
> 
> 时间：2015-10-14T09:44:51.610

GET（多个参数）：

```
curl -X  GET "http://localhost:3000/action?result1=gh&result2=ghk" 
```

或者

```
curl --request  GET "http://localhost:3000/action?result1=gh&result2=ghk" 
```

或者

```
curl  "http://localhost:3000/action?result1=gh&result2=ghk" 
```

或者

```
curl -i -H "Application/json" -H "Content-type: application/json"  "http://localhost:3000/action?result1=gh&result2=ghk" 
```

* * *

## 回答 #6

> 赞同：25
> 
> 时间：2019-04-09T11:03:45.940

我使用邮递员。

执行您想做的任何呼叫。然后，postman 提供了一个方便的工具来显示 curl 代码。

在终端中运行它。 [![在此处输入图像描述](https://i.stack.imgur.com/ByU2a.png)](https://i.stack.imgur.com/ByU2a.png)

[![在此处输入图像描述](https://i.stack.imgur.com/7jlsh.png)](https://i.stack.imgur.com/7jlsh.png)

* * *

## 回答 #7

> 赞同：24
> 
> 时间：2019-01-07T20:34:58.467

您还可以发送多个标头、数据（例如 JSON），并将调用方法（POST、GET）指定到单个 CUrl 调用中，如下所示：

```
curl -X POST(Get or whatever) \
  http://your_url.com/api/endpoint \
  -H 'Content-Type: application/json' \
  -H 'header-element1: header-data1' \
  -H 'header-element2: header-data2' \ 
```

......更多标题......

```
 -d '{
  "JsonExArray": [
    {
      "json_prop": "1",
    },
    {
      "json_prop": "2",
    }
  ]
}' 
```

* * *

## 回答 #8

> 赞同：10
> 
> 时间：2015-09-02T20:39:59.003

我已经从 curl 切换到[Httpie](https://github.com/jkbrzt/httpie)；语法如下：

```
http http://myurl HeaderName:value 
```

* * *

## 回答 #9

> 赞同：7
> 
> 时间：2017-08-09T10:27:04.257

如果您想发送**自定义标头**，您可以这样做：

```
curl -v -H @{'custom_header'='custom_header_value'} http://localhost:3000/action?result1=gh&result2=ghk 
```

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2020-02-13T14:23:27.423

在通过**windows的****anaconda**环境中，命令应该是：GET，例如：

 **```
curl.exe http://127.0.0.1:5000/books 
```

发布或修补数据，例如：

```
curl.exe http://127.0.0.1:5000/books/8 -X PATCH -H "Content-Type: application/json" -d '{\"rating\":\"2\"}' 
```

PS：为json数据添加反斜杠以避免此类错误=>`Failed to decode JSON object: Expecting value: line 1 column 1 (char 0)`

并使用`curl.exe`而`curl`不仅仅是为了避免这个问题：

```
Invoke-WebRequest : Cannot bind parameter 'Headers'. Cannot convert the "Content-Type: application/json" value of type
"System.String" to type "System.Collections.IDictionary".
At line:1 char:48
+ ... 0.1:5000/books/8 -X PATCH -H "Content-Type: application/json" -d '{\" ...
+                                  ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidArgument: (:) [Invoke-WebRequest], ParameterBindingException
    + FullyQualifiedErrorId : CannotConvertArgumentNoMessage,Microsoft.PowerShell.Commands.InvokeWebRequestCommand 
```

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2022-01-12T13:17:05.713

以下是最常见的 http 方法的一些 curl 命令。

这里考虑的域对象是

```
@Data
@NoArgsConstructor
@AllArgsConstructor
@Document
@Validated
public class Movie {
    @Id
    private String id;
    private String name;
    @NotNull
    private Integer year;
    @NotNull
    private List<String> cast;
    private LocalDate release_date;
} 
```

## 后期制作电影

```
curl -i \
-d '{"id":1, "name": "Dhoom", "year":2004,"cast":["John Abraham", "Abhishek Bachan"],"release_date": "2004-06-15"}' \
-H "Content-Type: application/json" \
-X POST http://localhost:8080/v1/movies 
```

## 获取所有电影

```
curl -i http://localhost:8080/v1/movies 
```

## 按 ID 获取电影

```
curl -i http://localhost:8080/v1/movies/1 
```

## 放更新电影

```
curl -i \
-d '{"id":1, "name": "Dhoom", "year":2005,"cast":["John Abhraham", "Abhishek Bachhan", "Uday Chopra", "Isha Deol"],"release_date": "2005-03-25"}' \
-H "Content-Type: application/json" \
-X PUT http://localhost:8080/v1/movies/1 
```

## 删除电影

```
curl -i -X DELETE http://localhost:8080/v1/movies/1 
```

# python - 如何在 Python 中处理具有不同参数集（或类型）的构造函数或方法？

> ID：356718
> 
> 赞同：15
> 
> 时间：2008-12-10T16:42:08.917
> 
> 标签：python

在 Python 中有没有一种方法可以拥有多个构造函数或多个具有*相同名称*的方法，它们接受*的参数数量或**一个或多个参数的类型*不同？

如果不是，那么处理这种情况的最佳方法是什么？

例如，我创建了一个颜色类。*这个类应该只作为一个基本的例子来讨论这个*，那里有很多不必要的和/或多余的东西。

如果我可以使用不同的对象（列表、其他颜色对象或三个整数......）调用构造函数并且构造函数相应地处理它们，那就太好了。在这个基本示例中，它在某些情况下适用于 * args 和 * * kwargs，但使用类方法是我想出的唯一通用方法。什么是“**最佳实践**”之类的解决方案？

除了构造函数，如果我也想实现一个 _ _ **add** _ _ 方法，我怎样才能让这个方法接受所有这些：一个普通整数（添加到所有值），三个整数（第一个是添加到红色值等等）或另一个颜色对象（两个红色值加在一起等）？

**编辑**

*   我添加了一个*替代*构造函数（初始化器，_ _ **init** _ _），它基本上可以完成我想要的所有事情。

*   但我坚持第一个和工厂方法。似乎更清楚了。

*   我还添加了一个_ _ **add** _ _，它完成了上面提到的所有事情，但我不确定它是否是*好的风格*。我尝试使用迭代协议并退回到“单值模式”，而不是检查特定类型。也许仍然很丑。

*   我看过_ _ **new** _，谢谢你的链接。

*   我的第一次快速尝试失败了：我从 * args 和 * * kwargs 中过滤 rgb 值（它是一个类、一个列表等）然后用正确的 args 调用超类的 _ _ new _ _ （只是 r， g,b) 将其传递给 init。对“Super(cls, self)._ _ new _ _ (....)”的调用有效，但由于我生成并返回与我调用的对象相同的对象（如预期的那样），所有原始参数传递给 _ _ init _ _ （按预期工作），所以它保释了。

*   我可以完全摆脱 _ _ init _ _ 并在 _ _ new _ _ 中设置值，但我不知道......感觉就像我在这里滥用东西 ;-) 我应该好好看看我猜是元类和新的。

来源：

```
#!/usr/bin/env python
# -*- coding: UTF-8 -*-

class Color (object):

  # It's strict on what to accept, but I kinda like it that way.
  def __init__(self, r=0, g=0, b=0):
    self.r = r
    self.g = g
    self.b = b

  # Maybe this would be a better __init__?
  # The first may be more clear but this could handle way more cases...
  # I like the first more though. What do you think?
  #
  #def __init__(self, obj):
  #  self.r, self.g, self.b = list(obj)[:3]

  # This methods allows to use lists longer than 3 items (eg. rgba), where
  # 'Color(*alist)' would bail
  @classmethod
  def from_List(cls, alist):
    r, g, b = alist[:3]
    return cls(r, g, b)

  # So we could use dicts with more keys than rgb keys, where
  # 'Color(**adict)' would bail
  @classmethod
  def from_Dict(cls, adict):
    return cls(adict['r'], adict['g'], adict['b'])

  # This should theoreticaly work with every object that's iterable.
  # Maybe that's more intuitive duck typing than to rely on an object
  # to have an as_List() methode or similar.
  @classmethod
  def from_Object(cls, obj):
    return cls.from_List(list(obj))

  def __str__(self):
    return "<Color(%s, %s, %s)>" % (self.r, self.g, self.b)

  def _set_rgb(self, r, g, b):
    self.r = r
    self.g = g
    self.b = b
  def _get_rgb(self):
    return  (self.r, self.g, self.b)
  rgb = property(_get_rgb, _set_rgb)

  def as_List(self):
    return [self.r, self.g, self.b]

  def __iter__(self):
    return (c for c in (self.r, self.g, self.b))

  # We could add a single value (to all colorvalues) or a list of three
  # (or more) values (from any object supporting the iterator protocoll)
  # one for each colorvalue
  def __add__(self, obj):
    r, g, b = self.r, self.g, self.b
    try:
      ra, ga, ba = list(obj)[:3]
    except TypeError:
      ra = ga = ba = obj
    r += ra
    g += ga
    b += ba
    return Color(*Color.check_rgb(r, g, b))

  @staticmethod
  def check_rgb(*vals):
    ret = []
    for c in vals:
      c = int(c)
      c = min(c, 255)
      c = max(c, 0)
      ret.append(c)
    return ret

class ColorAlpha(Color):

  def __init__(self, r=0, g=0, b=0, alpha=255):
    Color.__init__(self, r, g, b)
    self.alpha = alpha

  def __str__(self):
    return "<Color(%s, %s, %s, %s)>" % (self.r, self.g, self.b, self.alpha)

  # ...

if __name__ == '__main__':
  l = (220, 0, 70)
  la = (57, 58, 61, 255)
  d = {'r': 220, 'g': 0, 'b':70}
  da = {'r': 57, 'g': 58, 'b':61, 'a':255}
  c = Color(); print c # <Color(0, 0, 0)>
  ca = ColorAlpha(*la); print ca # <Color(57, 58, 61, 255)>
  print '---'
  c = Color(220, 0, 70); print c # <Color(220, 0, 70)>
  c = Color(*l); print c # <Color(220, 0, 70)>
  #c = Color(*la); print c # -> Fail
  c = Color(**d); print c # <Color(220, 0, 70)>
  #c = Color(**da); print c # -> Fail
  print '---'
  c = Color.from_Object(c); print c # <Color(220, 0, 70)>
  c = Color.from_Object(ca); print c # <Color(57, 58, 61, 255)>
  c = Color.from_List(l); print c # <Color(220, 0, 70)>
  c = Color.from_List(la); print c # <Color(57, 58, 61, 255)>
  c = Color.from_Dict(d); print c # <Color(220, 0, 70)>
  c = Color.from_Dict(da); print c # <Color(57, 58, 61, 255)>
  print '---'
  print 'Check =', Color.check_rgb('1', 0x29a, -23, 40)
  # Check = [1, 255, 0, 40]
  print '%s + %s = %s' % (c, 10, c + 10)
  # <Color(57, 58, 61)> + 10 = <Color(67, 68, 71)>
  print '%s + %s = %s' % (c, ca, c + ca)
  # <Color(57, 58, 61)> + <Color(57, 58, 61, 255)> = <Color(114, 116, 122)> 
```

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-12-10T17:14:02.020

你可以有工厂方法，这很好。但是为什么不直接称呼它呢？

```
Color(r, g, b)
Color(*[r, g, b])
Color(**{'r': r, 'g': g, 'b': b}) 
```

这是蟒蛇的方式。至于 from 对象构造函数，我更喜欢这样的东西：

```
Color(*Color2.as_list()) 
```

*显式优于隐式*- Python Zen

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-12-10T19:22:09.843

一般来说，使用工厂方法，标记为`@classmethod`s。它们也可以在子类上正常工作。从设计的角度来看，它们更加明确，尤其是在给定一个好名字的时候。

在这种情况下，将所有内容混合在一起可能更方便，但也会使构造函数的合同更加困难。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-12-10T18:02:06.337

Python 不接受具有相同名称和句号的多个方法。一种方法做一件事。

我已经看到了关于如何处理这个......类方法（如你上面概述的）或工厂函数的不同方法。我最喜欢关键字参数。

```
class Color (object):

   def __init__(self, **parms):
      if parms.get('list'):
         self.r, self.g, self.b = parms['list'] 
      elif parms.get('color'):
         color = parms['color']
         self.r = color.r
         self.g = color.g
         self.b = color.b
      else:
         self.r = parms['red']
         self.g = parms['green']
         self.b = parms['blue']

c1 = Color(red=220, green=0, blue=270)
c2 = Color(list=[220, 0, 70])
c3 = Color(color=c1) 
```

这符合 Python 的显式和可读方式，此外，它还允许您在需要时轻松添加新参数。

编辑：另外，我不必查看实际的构造函数代码来理解参数。解释由关键字提供。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-10T19:30:23.537

关于这个`__add__`问题：

首先，你不能得到“三个整数”，我假设你的意思是一个 3 元组的整数？

在这种情况下，您将无法绕过一些`isinstance`电话：

```
def __add__(self, other):
    if isinstance(other, Color):
        ...
    elif isinstance(other, (int, long)):
        ...
    elif len(other) == 3 and all(isinstance(e, (int, long)) for e in other):
        ...
    else:
        raise TypeError("Can only add Color to Color, int or three-tuple") 
```

您可能还想添加 , 的实现`__radd__`，以便您可以处理

```
1 + Color(1, 2, 3) 
```

但这只是

```
def __radd__(self, other):
    return self.__add__(other) 
```

虽然严格来说，它永远不会被调用 when `type(other) is Color`。

另外，别忘`__iadd__`了支持`+=`。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-10-16T00:54:16.120

我的第一个建议是使用工厂方法。

虽然如果你真的想要一个方法，给它一些调度来处理参数。

```
def __init__(self, method, *args, **kw):
    getattr(self, '_init_'+method)(*args, **kw)

def _init_coponents(self, r, g, b):
    ...
def _init_fromColor(self, color):
    ... 
```

并使用如下：

```
c1 = Color('components', 0, 0, 0,)
c2 = Color('fromColor', c1) 
```

虽然这增加了另一个参数，但它仍然比类型测试好得多，并且保持明确。它为非法调用提供了很好的开箱即用异常，并且即使在子类中也很容易扩展。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-10T18:02:28.677

Python 总是完全替换同名的方法。与 C# 不同的是，如果我没记错的话，它将为不同的参数输入创建具有相同名称选项的方法。

如果关键字中只有一个变体，例如 3 个或 4 个相同类型的参数，我会说使用最后一个参数的预设，或者全部使用它们，将是要走的路。

但是，如果您想要列表、元组和其他类型，您可能应该选择任意参数列表并在函数中测试其内容

```
def function(*args):
    if type(args[0]) is int:
        dothis()
    #and so on 
```

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2008-12-10T17:05:22.613

您可以在内部检查传递给构造函数的参数类型：

```
def __init__(self, r = 0, g = 0, b = 0):
    # if r is a list
    if (type(r) == type([1,2,3])):
        r, g, b = r[0], r[1], r[2]
    # if r is a color
    if (type(r) == type(self)):
        r, g, b = r.r, r.g, r.b
    self.r = r
    self.g = g
    self.b = b 
```

也许这会有所帮助。

# unix - 在 UNIX 系统上杀死一个已失效的进程

> ID：356722
> 
> 赞同：51
> 
> 时间：2008-12-10T16:42:52.083
> 
> 标签：unix, process, kill, zombie-process

我的系统上有一个已失效的进程：

```
abc      22093 19508  0 23:29 pts/4    00:00:00 grep ProcA
abc      31756     1  0 Dec08 ?        00:00:00 [ProcA_my_collect] <defunct> 
```

如何在不重新启动机器的情况下终止上述进程？我试过了

```
kill -9 31756
sudo kill -9 31756 
```

* * *

## 回答 #1

> 赞同：41
> 
> 时间：2008-12-10T18:07:27.963

你已经杀死了进程，但是一个死进程不会从进程表中消失，直到它的父进程执行一个名为“reaping”的任务（本质上是调用`wait(3)`那个进程来读取它的退出状态）。没有被收割的死进程被称为“[僵尸进程](http://en.wikipedia.org/wiki/Zombie_process)”。

您看到的 31756 的父进程 id 是进程 id 1，它始终属于`init`. 该进程应该定期获取其僵尸进程，但如果不能，它们将在进程表中保持僵尸进程，直到您重新启动。

* * *

## 回答 #2

> 赞同：23
> 
> 时间：2008-12-10T17:33:33.947

您是否检查过可能需要先终止的子进程？有时，果酱已经结束了……试试`ps -ef --forest`

看看它下面可能有什么（如果有的话）然后先杀死那个，然后是你已经知道的那个

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-03-10T12:07:31.267

如果 kill -9 未能杀死进程，原因几乎总是驱动程序或操作系统错误。

init进程已经采用了进程，但是无法reap。也就是说：当 init 调用 wait(2) 时，该进程没有返回。init 的主要目的之一是收割死去的孤儿，所以问题不在于它的父母在收割之前就死了。想一想：否则，谁会在注销后获得 nohup 进程的结果？

杀死已失效进程的子进程不太可能有帮助，除非它们与您所看到的特定错误有关。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-10T17:19:20.620

如果杀死父母不能解决它，你可能无法做到。无论出于何种原因，系统都没有收集该僵尸进程。

FWIW，我在我曾经管理的 SCO Openserver boxen 上看到了很多。大量的多用户使用和低系统资源，但它似乎并没有伤害任何东西。只是惹恼了我。:)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-12-07T22:21:05.150

该过程可能会挂起，例如忽略 SIGPIPE 之类的信号，检查`strace -p <pid>`这里发生的情况。

# windows - 有没有办法在 Windows 上获得比 Meta 和 Ctrl 更多的东西？长期 Emacs 用户想要 Hyper/Super

> ID：356724
> 
> 赞同：12
> 
> 时间：2008-12-10T16:43:12.317
> 
> 标签：windows, emacs, user-interface

我已经在 Linux 上使用 Emacs 多年了，我有很多个人有用的键绑定放在`Hyper`和`Super`. 现在我在 Windows 上使用 Emacs 并且缺少那些额外的键绑定。

在 Windows 中有什么方法可以获取除`Ctrl`and之外的修饰键`Meta`吗？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-12-12T21:05:19.000

[这个 google-groups 线程](http://groups.google.com/group/gnu.emacs.help/browse_thread/thread/93ee43478903f273)中提到了一些设置：

```
; setting the PC keyboard's various keys to Super or Hyper
(setq w32-pass-lwindow-to-system nil
      w32-pass-rwindow-to-system nil
      w32-pass-apps-to-system nil
      w32-lwindow-modifier 'super ;; Left Windows key
      w32-rwindow-modifier 'super ;; Right Windows key
      w32-apps-modifier 'hyper) ;; Menu key 
```

更新：所以，我实际上在我自己的 Win32 emacs 设置中*尝试了上面的代码。*瞧，它有效！尴尬的演示如下：

```
(defun super-test ()
  (interactive)
  (message "Super"))

(defun hyper-test ()
  (interactive)
  (message "Hyper"))

(global-set-key [(super h)] 'super-test)
(global-set-key [(hyper h)] 'hyper-test) 
```

除非我做了其他时髦的事情，否则这些都是本机工作的；我在 LENNART-69DE564（已修补）上运行 2008 年 8 月 19 日的 GNU Emacs 23.0.60.1 (i386-mingw-nt5.1.2600)

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2008-12-12T15:47:20.390

你可能会觉得这很困难，因为 Super（我相信 Hyper）在它们到达你的应用程序之前就被 Windows Shell (explorer.exe) 拦截了。

# c++ - 'bool' 是 C++ 中的基本数据类型吗？

> ID：356726
> 
> 赞同：59
> 
> 时间：2008-12-10T16:44:40.160
> 
> 标签：c++

我在编写一些代码时遇到了这个疑问。'bool' 是 C++ 标准中定义的基本数据类型，还是编译器提供的某种扩展？我有这个疑问是因为 Win32 有 'BOOL' 这不过是 long 的 typedef。如果我做这样的事情会发生什么：

```
int i = true; 
```

是“始终”保证变量 i 的值为 1 还是再次取决于我使用的编译器？此外，对于一些接受 BOOL 作为参数的 Win32 API，如果我传递 bool 变量会发生什么？

* * *

## 回答 #1

> 赞同：78
> 
> 时间：2008-12-10T16:48:03.913

bool 是 C++ 中的基本数据类型。转换`true`为整数类型将产生 1，转换`false`将产生 0（4.5/4 和 4.7/4）。在 C 中，直到 C99，没有 bool 数据类型，人们做了类似的事情

```
enum bool {
    false, true
}; 
```

Windows API 也是如此。从 C99 开始，我们将`_Bool`其作为基本数据类型。包括`stdbool.h`将~~typedef~~ `#define`和提供`bool`常量`true`和`false`. 由于与现有代码的兼容性问题，他们没有使 bool 成为基本数据类型（因此也成为关键字）。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-12-10T16:50:11.473

是的，bool 是一种内置类型。

WIN32是C代码，不是C++，而且C没有bool，所以他们提供了自己的typedef BOOL。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-12-10T16:48:26.003

C++ 为你做了很多自动转换——也就是说，如果你有一个类型的变量`bool`并将它传递给期望 an 的东西`int`，它会将它变成一个`int`for you - `0`for`false`和`1`for `true`。

我没有我的标准来确定这是否得到保证，但是我使用的每个编译器都会这样做（因此可以假设它总是可以工作）。

但是，依赖这种转换是一个坏主意。如果添加了重载`int`签名的新方法等，代码可能会停止编译。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-10T16:49:47.183

是的，它是在 1993 年推出的。

供进一步参考：[布尔数据类型](http://en.wikipedia.org/wiki/Boolean_datatype#C.2B.2B)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-12-10T16:58:38.900

C 意味着比汇编语言高出一步。C if 语句实际上只是“branch-if-zero”的语法糖，因此布尔值作为独立数据类型的想法在当时是一个外来概念。(1)

即使是现在，C/C++ 布尔值通常也只是单字节数据类型的别名。因此，它实际上更像是一个有目的的标签，而不是一个独立的数据类型。

(1) 当然，现代编译器在处理 if 语句方面更先进一些。这是从 C 作为一种新语言的角度来看的。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2011-09-26T18:06:58.513

Turbo c 和 c++ 编译器不支持 boolean（bool 关键字）数据类型，但 dev c++ 编译器支持 boolean（bool 关键字）数据类型。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2021-01-19T05:53:04.353

是的，C++ 支持 bool 并且它是一种数据类型。供参考 - [Bool 数据类型](https://www.studytonight.com/cpp/datatypes-and-modifiers-in-cpp.php)

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2008-12-10T17:00:46.757

尽管它现在是本机类型，但它仍然在幕后定义为整数（我认为是 int），其中文字`false`为 0 和`true`1。但我认为所有逻辑仍然认为除 0 之外的任何东西都是真的，所以严格来说，真正的文字是可能是编译器测试某事是否为假的关键字。

```
if(someval == true){ 
```

大概翻译成：

```
if(someval !== false){ // e.g. someval !== 0 
```

由编译器

# jquery - 有没有人在使用 Themeroller 主题时修复了 IE6 中的 jQuery 对话框按钮格式？

> ID：356751
> 
> 赞同：1
> 
> 时间：2008-12-10T16:53:17.397
> 
> 标签：jquery, css, jquery-ui, themeroller, jquery-ui-theme

我曾经[`Themeroller`](http://jqueryui.com/themeroller/)生成一个应用程序主题，我正在使用`jQuery`并`jQuery UI`创建一些`modal dialog`警报。

它们在 Firefox 2 和 3 上运行良好（并且看起来很棒），但在 IE 6 和 7 上按钮向右移动。

看起来它被 IE 边缘错误所困扰，但我想看看在深入研究 Themeroller CSS 或更糟糕的 jQuery 生成代码之前是否有一个简单的修复方法，以找到解决方法。

这是两个 Firefoxen 中的盒子的样子：

![替代文字](https://farm4.static.flickr.com/3264/3097571133_6c67cae83b_o.png)

以下是 IE6/7 中同一个框的样子：

![替代文字](https://farm4.static.flickr.com/3163/3098408266_ae31d474db_o.png)

jQuery UI 演示页面的按钮在 IE 下看起来更好一些，但在调整大小栏下它们是半模糊的。如果这里没有人说“哦，是的，这就是你修复它的方法......”我将不得不将两个 CSS 文件并排放置并找出区别。

我看到了一个[半相关的问题](https://stackoverflow.com/questions/43458/how-do-i-make-the-jquery-dialog-work-with-the-themeroller-themes)，但那里的答案不适用于我的问题（因为我的对话框容器确实有 ui-dialog 类。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-10T17:13:03.893

我通过一些试验和错误发现了似乎可行的方法。我仍然会对更好的综合解决方案感兴趣（和/或我需要向 ThemeRoller 团队指出这一点）。

我对以下内容进行了更改`jquery-ui-themeroller.css`：

```
.ui-dialog-buttonpane {
    position: absolute;
    bottom: 0;
    left:0;  /* Added this line and it makes the button pane anchor to the left */
    width: 100%;
    text-align: left;
    border-top: 1px solid #707c5a;
    background: #faf7eb;
} 
```

我还在做一些测试，但它似乎适用于 IE6/7 和 FF2/3。

# css - CSS 边距和填充速记属性顺序的助记符

> ID：356759
> 
> 赞同：89
> 
> 时间：2008-12-10T16:56:52.100
> 
> 标签：css, mnemonics

我永远记不起在一个声明中设置边距或填充的简写属性的顺序。那是：

```
margin-top:    2px;
margin-bottom: 4px;
margin-left:   3px;
margin-right:  8px; 
```

可以写成

```
margin: 2px 8px 4px 3px; 
```

是的，我知道人们可以通过考虑时钟来形象化顺序，从中午开始并顺时针移动。但我一直忘记这件事。我需要以文字方式回忆上、右、下、左的顺序。

因此，~~TBLR~~ TRB L。

This [R-noun] [B-verb] [L-nouns] 这样的东西也许是要走的路，但我觉得自己缺乏灵感。如果有人遇到过有用的助记符，我很想听听。就像一个好的模因一样，我敢肯定，一旦我的大脑中有一些东西，我就不太可能忘记它。

**注意**：这个问题提供了不正确的信息 - 顺序（如一些评论和答案中所述）是**Top Right Bottom Left**。（嘿，明白我的意思吗？--dland）

* * *

## 回答 #1

> 赞同：181
> 
> 时间：2008-12-10T16:59:50.097

如果你没有做对，就会有麻烦

* * *

## 回答 #2

> 赞同：78
> 
> 时间：2008-12-10T17:01:59.390

实际上时钟的东西工作得很好。这是最直观的记忆方式，至少对我而言。

* * *

## 回答 #3

> 赞同：25
> 
> 时间：2008-12-10T17:05:10.710

棘手的矩形边框逻辑？

* * *

## 回答 #4

> 赞同：21
> 
> 时间：2012-05-25T21:17:40.093

为什么不记住顺序从 TOP 开始顺时针方向：

**上 -> 右 -> 下 -> 左**

* * *

## 回答 #5

> 赞同：15
> 
> 时间：2008-12-10T17:03:18.203

另一种尝试：

霸王龙：大蜥蜴

* * *

## 回答 #6

> 赞同：12
> 
> 时间：2008-12-10T17:06:40.927

顺时针想想，这是最简单的方法。从顶部开始并四处走动......比一些愚蠢的短语更容易记住（前提是你知道如何阅读时钟......）

* * *

## 回答 #7

> 赞同：12
> 
> 时间：2008-12-10T17:19:40.713

真正的大莱博夫斯基

* * *

## 回答 #8

> 赞同：8
> 
> 时间：2008-12-10T17:00:38.443

**T** **R** ou **B** **L** e。

* * *

## 回答 #9

> 赞同：8
> 
> 时间：2008-12-10T17:15:11.300

时间旋转，有点蹩脚？

* * *

## 回答 #10

> 赞同：6
> 
> 时间：2008-12-10T17:07:15.230

试试烤牛肉剩菜？

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2008-12-10T20:07:15.447

“上、右、下、左” **R** **eally** **B** ad **L** imerick

 ******* * *

## 回答 #12

> 赞同：2
> 
> 时间：2014-02-08T16:25:26.853

麻烦对我来说是最好的。如果只显示 3 个值，那就是 Top、Sides、Bottom - 对于英国用户来说，这拼写为 TSB（政府不得不用我们的钱救助的银行） - 所以 TRouBLe 和 TSB 密切相关！

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2014-04-21T06:53:09.590

TROUBLE 对我来说总是一个次要的提醒，因为我首先想到的是顺时针方向，但可能需要记住你从哪里开始；但是，在我意识到中间（或第二个）值需要表示两个值（边）之前，3 值速记总是让我感到困惑。所以，三个值——第二个是 2 个值——帮助我记住了这一点。

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2016-08-19T11:30:58.813

时钟技巧适用于 4 号快捷方式，但 3 号和 2 号快捷方式有什么逻辑吗？1 个数字，它适用于所有事物，这是有道理的，但是

```
1 = (T/R/b/l) 
2 = (T=b) (R=l)   
3 = (T) (R=l) (b)  
4 = (T) (R) (b) (l) 
```

这似乎根本不合逻辑。但是......第一个值属于顶部，第二个属于右边，第三个是底部，第四个是左边；如果数字与其相反，则不指定数字。除非所有值都相同，否则必须声明水平和垂直。

换句话说，您始终根据需要指定 Top 和 Right 值，bottom 和 left 落在其中。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2008-12-10T17:00:01.283

~~这是~~

 ~~```
top
right 
bottom 
left 
```~~ 

~~不是你所拥有的~~

**三思**而后 行**_** _ **_** _ **_**

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2008-12-10T17:12:10.447

认为您正在阅读阿拉伯文或希伯来文：从页面顶部，从右到左到底部阅读。;P 这个“规则”的好处是它也适用于 3 值版本： `top right-and-left bottom`

其实，我也觉得很难记住，但当我发现它是时钟的方向时，它就容易多了。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2009-04-27T14:22:32.193

康涅狄格州总有 TRumBuLl 镇

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2014-01-30T01:01:20.303

* *T* *op * *R* *amen, * *B* *ottom, * *L* *unch

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2016-05-30T06:18:39.820

记住驾驶课：

先右转左

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2018-08-05T21:22:30.133

如果你的年龄足以记住最初的星际迷航电视剧（你知道，与柯克上尉一起），那么首先，你太老了。但是有“ **Tribbles 的麻烦**”一集。标题中的两个名词都起作用。我过去曾使用过它，但也更喜欢时钟类比。

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2019-02-28T21:43:52.960

每当您遇到给定情况时，只需考虑顺时针旋转，即时钟从 0 到 60 以圆周旋转的方式旋转。

在我看来，时钟的东西比 TRouBLe （作为标记的答案）这个词更容易记住，因为这个词`trouble`属于英语，所有那些以英语为母语的人可能会发现更容易记住与给定情况相关的 TRouBLe 这个词，但不是其他只在真正需要时才使用英语的人。

时钟的顺时针旋转并非如此，当涉及到记住某些东西时（如问题所问），因为顺时针旋转是世界上非常知名的现象。

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2020-06-13T14:14:41.487

一些缩写（可能会认为听起来很熟悉）：

1.  **TR** OU **BL** E（***TR*** *OU **BL** ESHOOT*，***TR*** *OU **BL** ESOME*）
2.  **T** E **R** RI **BL** E
3.  **TR** IB **BL** E
4.  **英国**皇家军团_ **_** **_** **_** _
5.  **烟草**路篮球联盟**_** **_** _ **_**
6.  **临时收益**Borrowing** Limit **_** **_** **_** _**
***   **以变**​​革**规则为**基础****的****L**收益****

 ******# perl - 如何使用 bash 或 Perl 重新格式化 mbox 文件中的消息？

> ID：356763
> 
> 赞同：2
> 
> 时间：2008-12-10T16:59:29.817
> 
> 标签：perl, bash, mbox

我有一个巨大的 mbox 文件，其中可能包含 500 封电子邮件。

它如下所示：

```
From x@blah.com Fri Aug 12 09:34:09 2005
Message-ID: <42FBEE81.9090701@blah.com>
Date: Fri, 12 Aug 2005 09:34:09 +0900
From: me <x@blah.com>
User-Agent: Mozilla Thunderbird 1.0.6 (Windows/20050716)
X-Accept-Language: en-us, en
MIME-Version: 1.0
To: someone <someone@hotmail.com>
Subject: Re: (no subject)
References: <BAY101-F9353854000A4758A7E2CCA9BD0@phx.gbl>
In-Reply-To: <BAY101-F9353854000A4758A7E2CCA9BD0@phx.gbl>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 8bit
Status: RO
X-Status: 
X-Keywords:                 
X-UID: 371
X-Evolution-Source: imap://x+blah.com@blah.com/
X-Evolution: 00000002-0010

Hey

the actual content of the email

someone wrote:

> lines of quotedtext 
```

我想知道如何删除所有引用的文本，去掉除 To、From 和 Date 行之外的大多数标题，并且仍然让它有点连续。

我的目标是能够将这些电子邮件打印为一种书籍格式，并且目前每个程序都希望每页打印一封电子邮件，或者所有标题和引用的文本。关于使用 shell 工具从哪里开始编写小程序的任何建议？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-10T17:25:37.207

[Mail::Box::Mbox](http://search.cpan.org/~markov/Mail-Box-2.084/lib/Mail/Box/Mbox.pod)可让您轻松地将文件解析为单独的消息。[来自 YAPC::Europe 2002](http://perl.overmeer.net/yapc2002-mailbox/img0.html)的 Mark Overmeer 的幻灯片详细说明了为什么解析比看起来要困难得多。使用这个库还将处理 mh、IMAP 和许多其他格式，而不仅仅是 mbox。

```
 #!/usr/bin/perl
    use warnings;
    use strict;
    use Mail::Box::Manager;

    my $file = shift || $ENV{MAIL};
    my $mgr = Mail::Box::Manager->new(
        access      => 'r',
    );

    my $folder = $mgr->open( folder => $file )
    or die "$file: Unable to open: $!\n";

    for my $msg ($folder->messages)
    {
        my $to      = join( ', ', map { $_->format } $msg->to );
        my $from    = join( ', ', map { $_->format } $msg->from );
        my $date    = localtime( $msg->timestamp );
        my $subject = $msg->subject;
        my $body    = $msg->body;

        # Strip all quoted text
        $body =~ s/^>.*$//msg;

        print <<"";
    From: $from
    To: $to
    Date: $date
    $body

    } 
```

您可能需要重新考虑删除引用文本的请求——如果您发送的电子邮件格式为交错回复，该怎么办？去掉引用的文本会使这种电子邮件很难理解：

```
  福写道：
  > 我喜欢酒吧。

  酒吧？谁喜欢酒吧？

  > 这比 baz 好。

  每个人都知道这一点。

  --
  曲

```

此外，您打算如何处理附件、非文本/纯 MIME 类型、编码文本实体和其他奇怪的东西？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-10T17:04:15.923

首先，我可能会使用“formail”来提取仅包含您想要的标题的邮件。要么这样，要么在 awk 中使用某种状态表来查看您是否在标题中，如果您在标题中，则去掉除所需标题之外的所有内容，如果不在，则去掉引号。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-10T17:10:13.260

使用 shell 工具可能不是最好的答案，因为有许多语言的库可以处理 mbox，无论是 Ruby、Perl 还是其他语言。您还必须考虑引用字符并不总是“>”，这可能会破坏您的取消引用过程。至于提取您想要的标题，这在任何语言中都应该不难。我知道这是一个笼统的答案，可能还不够具体......

# asp.net - 创建 HTMLControls 与输出 HTML 字符串

> ID：356775
> 
> 赞同：2
> 
> 时间：2008-12-10T17:02:31.590
> 
> 标签：asp.net, vb.net, htmlcontrols

我最近试图向程序员解释为什么在 ASP.Net 中他们应该创建 HTMLControls 而不是创建 HTML 字符串来创建网页。

我知道这是一种更好的做事方式，但除了“这种方式更好”之外，我真的无法给出具体的理由。

如果让你回答这个问题，你的答案是什么？

为什么是

```
将 divA 调暗为 New HtmlControls.HtmlGenericControl("div")
将 ulList1 调暗为新 HtmlControls.HtmlGenericControl("ul")
将 liObj1、liObj2、liObj3 调暗为 New HtmlControls.HtmlGenericControl("li")
liObj1.innerText = "列表项目 1"
liObj2.innerText = "列表项 2"
liObj3.innerText = "列表项 3"
ulList1.Controls.Add(liObj1)
ulList1.Controls.Add(liObj2)
ulList1.Controls.add(liObj3)
divA.Controls.add(ulList1)
```

“更好”比：

```
Dim strHTML as String
strHTML = "<div><ul><li>List item 1</li><li>List item 2</li><li>List item 3</li></ul></div>" 
```

? 它看起来并不好。看看所有的代码！而且，这是一个非常简单的示例，以节省空间。我认为我实际上不会像那样手动创建列表，而是会遍历集合或使用更高级的 Web 控件，但我试图说明一点。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-10T17:19:04.177

我也不做。相反，我：

1.  创建一个封装所需构造的自定义控件
2.  或（非常相似）创建一个具有我想要的属性的简单类并覆盖该`.ToString()`方法以创建所需的 HTML。

但是在您的两个选择中，前者更好的几个原因是：

*   您可以在页面生命周期的后期更改 html 控件的属性或将其他控件添加到树中
*   ASP.Net 负责呈现 html。保证您不会有任何可能破坏 xhtml 合规性的错误。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-10T17:23:11.157

一大优势：将 HTML 编写为字符串非常容易出现人为错误，并且有可能很快变得不可读和难以管理。

生成的 HTML 将受到更好的保护，并且可以自我记录。

*（作为记录，我鄙视这两种方法，并使用 XSLT 作为我的模板）*

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-10T17:57:41.870

您可能更喜欢大多数现代 Web 开发框架提供的模板系统。我不确定可用于 ASP 的选项，但肯定有一些。使用模板系统可以避免在代码中放置任何标记或编写详细的文档构造块，就像您在问题中提供的两个示例一样。

尝试使用谷歌搜索“asp.net 模板模板”作为开始的地方。如果 asp.net 有如下页面，那就太好了。如果您找到了，请告诉我们：

[http://wiki.python.org/moin/Templating](http://wiki.python.org/moin/Templating)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-10T17:13:16.030

只有在两种情况下才真正更好：

1.  您需要对代码中的这些控件做一些事情
2.  生成的手动 HTML 非常混乱，以字符串形式维护是不切实际的。

从代码的角度来看，两者都不是更好的解决方案。就显示而言，它们都工作得很好。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-11T01:01:21.937

就个人而言，我只会在必要时创建控件，因为很多 Microsoft 的 HTML 只能在怪癖模式下工作，而且我同意创建 HTML 字符串很容易出错。

我使用 XML 解析器创建 XHTML，然后从 XMLDocument 对象中获取 .toString。它很冗长，但输出格式始终正确，并且始终有效。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-24T03:37:29.740

好处是 ASP.NET 生成的代码在不同条件下呈现不同。浏览器版本、软件更新/补丁、趋势、额外的框架等。当您自己编写 HTML 并将其转储到屏幕上时，它永远不会改变。它永远是你写它的样子。

但是，如果您使用 .NET 对象（推荐的方式）添加它，最终用户浏览器中呈现的实际代码是在运行时创建的。一个很好的例子是使用“用于 ASP.NET 2.0 的 CSS 控件适配器工具包”，它改变了 .NET 控件的呈现方式，将呈现控件的默认方法更改为使用纯 CSS。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2010-08-02T05:53:30.540

像你一样构建控件是 ASP.NET 最糟糕的事情。MVC 或带有 Partials 的方法是构造 HTML 的更好（更容易维护）的方法。

# php - PHP - 每次迭代查询单个值或在开始时获取所有值并从数组中检索？

> ID：356778
> 
> 赞同：7
> 
> 时间：2008-12-10T17:03:49.230
> 
> 标签：php, database, performance

我有一个看起来像这样的函数：

```
//iteration over scales
foreach ($surveyScales as $scale)
{
    $surveyItems = $scale->findDependentRowset('SurveyItems');

    //nested iteration over items in scale
    foreach ($surveyItems as $item)
    {
        //retrieve a single value from a result table and do some stuff
        //depending on certain params from $item / $scale
    }
} 
```

**问题**：最好对内部 foreach 中的每个值进行 db 查询，还是将所有结果值提取到数组中并从那里获取值更好？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-12-10T17:06:27.540

一个返回十几条数据的查询几乎比返回一条数据的 12 次查询快 12 倍。

哦，永远不要把 SQL 放在循环中，它总是会导致灾难。

根据您的应用程序的工作方式，可能会为每个查询打开一个新连接，这尤其糟糕，因为每个数据库服务器都有连接数限制。然后还要意识到每个用户都会发生这种情况，所以 50 个查询有 5 个用户，而您在任何给定时刻已经有 250 个查询。但是，即使所有查询都只共享一个连接，您也会对 DB 服务器多征 X 倍，使其在其他所有内容、每个页面上都变慢，因为用户在此页面上占用了 DB 服务器，每个人都必须共享。

过去我曾看到整个应用程序由于这个 1 设计缺陷而失败，只是不要这样做。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-12-10T17:24:58.580

我同意其他人的观点——我是在您正在使用的 Zend 框架中设计和编码表关系 API 的人！

`findDependentRowset()`如果您*已经*有对父行的引用，并且您*可能*需要获取相关行，这很有用。与连接两个表的查询相比，此功能至少效率不高。`findDependentRowset()`如果性能是一个优先事项，你永远不应该循环调用。相反，编写一个包含两个表的 JOIN 的 SQL 查询。

不幸的是，Zend 的框架目标是设计简单，而不是性能。

如果我继续在 Zend 工作，我会尝试改进 Table 接口，用一种方便的方式对相关的 Zend_Db_Table 对象执行联合查询。我离开项目后实现的解决方案是构建一个 Select 对象并将其传递给`fetchAll()`，这非常难看。

**编辑：** 在回复您的评论时，我尽我所能创建一个给定一组要求的解决方案。我对自己的所作所为感觉很好。但是 Zend 是一家 IDE 工具公司，因此它们的价值自然在于编码的便利性，而不是运行时性能。“快速应用程序开发”可以意味着开发快速应用程序，或快速开发应用程序。对于一家工具公司来说，这意味着后者。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-10T17:07:26.573

绝对获取所有并从数组中检索。

# html - （如何）我可以在新窗口中打开表单提交的结果吗？

> ID：356779
> 
> 赞同：1
> 
> 时间：2008-12-10T17:03:50.307
> 
> 标签：html, forms

我在桌子里有一个小表格。发布该表单会创建一个新实体。然后，我希望用户看到该新实体，但它应该在新窗口中打开，以免丢失原始视图。

（如何）我可以在新窗口中打开表单提交的结果吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-10T17:07:01.533

```
<form ... target="windowName"> 
```

或者

```
<form ... target="windowName" onsubmit="window.open(this.action, this.target, '...attributes...');return true;"> 
```

...属性...可以包含在[mozilla 开发人员中心](https://developer.mozilla.org/en/DOM/window.open#Position_and_size_features)或[MSDN中记录的内容](http://msdn.microsoft.com/en-us/library/ms536651.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-10T17:06:39.477

一个请求，一个响应。这就是网络的方式。

如果您在发布后想要一个新窗口，则需要首先从新窗口发布请求（可能通过 javascript 打开），或者将您的数据从该页面发布到*同一*页面并保存一个令牌，以便当页面重新加载可以再次打开一个新窗口，可能使用 javascript，并且该新窗口的请求已经知道上一篇文章。

# c# - 是否有任何 IDictionary 的实现 具有更好性能的 BCL 之一？

> ID：356785
> 
> 赞同：0
> 
> 时间：2008-12-10T17:06:08.557
> 
> 标签：c#, .net, dictionary, hashtable

我正在寻找一种具有更好的标准 BCL 性能的 IDictionary 实现。

我正在寻找具有恒定查找时间的东西，它在大量元素（> 10K）时性能非常好，并且对 GC 更友好。

Ps：不，我一个人写不出来：）

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-10T17:10:43.837

BCL 字典已经在摊销常数时间内执行，并且可以轻松处理 10K 元素。

您说它应该“对 GC 更友好”——当前版本有什么困扰您的地方？

您是否经常向字典添加元素？如果是这样，请使用较大的初始容量创建它以避免流失。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-10T17:59:11.100

我无法对实现进行基准测试，但哥本哈根大学提供了一个替代的 - 更全面的 - 通用集合类选择：

[http://www.itu.dk/research/c5/](http://www.itu.dk/research/c5/)

他们提供了许多具有不同支持解决方案（树、哈希表等）的通用 Dictionary 实现。其中一种可能适合您的需求。性能是开发此类库的主要因素。

当然，我建议您首先尝试 BCL 通用 Dictionary 类，因为它可以节省您的时间，并且可以很好地满足您的性能要求。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-10T18:05:58.327

我认为您将很难找到比 BCL 更快的托管字典。我试图写一个，我很快发现当你平衡读\写性能时，它的速度差不多。

# model-view-controller - 敌人/机器人 AI 是 MVC 游戏中模型或控制器的一部分

> ID：356791
> 
> 赞同：5
> 
> 时间：2008-12-10T17:07:20.130
> 
> 标签：model-view-controller, artificial-intelligence

它可能是模型的一部分，因为它是游戏业务逻辑的一部分。

它可能是控制器的一部分，因为它可以被视为模拟玩家输入，这将被视为控制器的一部分，对吧？还是会？

一个普通的敌人呢，比如马里奥里的 goomba？

更新：哇，这真的不是我期待的答案。据我所知，人工智能是自主游戏系统的内部部分，因此是模型。我仍然不相信。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-12-10T18:19:40.310

MVC 非常适合作为大量应用程序的架构。一些应用程序可能会发现 MVC 非常适合*外部接口*，尤其是作为更复杂架构的一部分的用户接口。

如果您发现自己试图将问题“强制拟合”到模式中，那么它可能不是正确的模式。为 UI 使用 MVC - 为 AI 使用其他模式（消息总线或观察者/侦听器等）或其他 OO 技术（@Bill the Lizard 的策略建议仍然适用）。

使用您的整个工具箱 - 而不仅仅是锤子。;-)

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-12-10T17:19:21.290

想象一个简单的游戏，比如井字游戏，您希望在其中玩不同的计算机难度级别。如果您将每个难度级别都设置为[Strategy](http://en.wikipedia.org/wiki/Strategy_pattern)，则很容易放入不同的实现中。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-12-10T17:20:24.597

敌方 AI**有一个模型**——它的智能内脏指定了如何玩游戏——它使用人类玩家和 NPC 都可以**使用的控制器**来操纵它在游戏环境中的状态。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-01-09T12:23:48.790

请记住，MVC 最初纯粹是一种 GUI 架构模式。因此，它不能很好地映射到人工智能、网络或其他方面也就不足为奇了。但是在这里使用它仍然有一些好处。但是代码实现了什么并不像它在链中的位置那么重要。仅仅因为某些东西看起来像是内部的，并不意味着它是内部的，因此不应被视为内部的。

例如。如果您正在编写一个机器人，那么您很可能基本上只是在编写脚本来操纵角色。所以从这个意义上说，脚本接口是预先存在的控制器，你的脚本完全是外部的。你甚至不用靠近模型来编写高级 AI。

现在，如果您是最初的程序员，必须编写低级 AI 功能，该功能由玩家交互（例如，点击某处开始行走）或机器人风格的脚本触发，那么您将一直在编写进入模型。

将任何单一概念（例如“AI”）从模型、控制器一直延伸到操纵控制器的任何人或任何事物，这似乎是不直观的，但是当您尝试将两个非常不同的概念映射到彼此。很明显，当您从开发人员的角度来看时，他们试图为非玩家角色呈现与玩家角色相同的界面 - 最终，人工智能必须同时包含外部演员的高级决策除了系统内的玩家和非玩家通常存在的低级实现之外，该系统还将进行。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-10T17:11:08.390

在我看来，它就像是在模拟人类玩家，因此它应该与人类玩家处于相同的位置。因此，它是与控制器交互的外部元素。（出于显而易见的原因，显示器实际上并不是必需的。）

编辑：实际上，我收回了这一点。它将有一个显示器，只是不是一个人类可读的显示器。“显示器”将负责将游戏状态信息传达给 AI，即使这意味着将序列化数据流式传输给它。

第 2 部分：哦，我明白了……这和我想的 AI 类型不太一样。我想它仍然可以以相同的方式处理，但这将迫使新功能在控制器中公开，这可能没有意义。（例如，控制器必须公开移动玩家单位和计算机单位。）

我会将行为放入模型中：

```
Goomba.move()
{
    /* Move Goomba forward one unit. */
} 
```

然后对该行为的调用进入控制器。

```
Controller.advanceTime()
{
    foreach(Goomba goomba in state.getGoombas())
    {
        goomba.move();
    }
} 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-10T17:21:18.993

敌方 AI 模型将了解游戏规则并根据这些规则改变其内部状态。游戏控制器向 AI 提供外部游戏状态的知识，它可以用来决定如何改变其内部状态。

> （我首先在这里写的：）
> 
> 与游戏世界交互的 AI 部分将在控制器中。作为自主代理做出决策的人工智能部分将在模型中。控制器将根据其决策所需的状态更新 AI 模型，并且控制器还将根据 AI 模型中的任何更改修改游戏并渲染视图。

对于 Goomba，游戏控制器将使用马里奥的位置（如果它在它的视线内）更新 Goomba 模型，并且 Goomba 模型将自行更新它打算移动的位置。如果没有任何障碍物，控制器将移动 Goomba（即更新模型的位置）并使用 Goomba 的新状态渲染视图。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-10T18:52:16.797

我不确定它在哪里适合 MVC。这个伪代码是我如何完成 A* 路径查找 AI 的一个极其简化的版本。

```
sprite {
  x,y
  image // this object contains everything about drawing
  path[] // an array of path nodes generated by my AI
  onNode(node) {
    if (x == node.x) && (y == node.y) return true
    return false
  }
  update () {
    moveto(path.last())
    if (onNode(path.last())) path.pop()
    if (path.empty()) path = doAI()
  }
  doAI() {
    ...
    return newPath
  }
  moveto(node) {
    ...
  }
  draw (screen) {
    if (screen.over(x, y)) image.draw(x-screen.x, y-screen.y)
  }
}

screen = //something the platform would create
spriteCollection = //my game objects

foreach (sprite in spriteCollection) {
  sprite.update()
  sprite.draw(screen)
} 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-12T18:09:47.230

在我看来，在任何 MVC 实现中，模型都应该包含域逻辑——只要它是自主对象（逻辑被固定在方法中）或套接字流包装器（逻辑是通过外部资源执行的——是的，想想多人游戏） . 控制器应该用作基于一些外部变量（例如 CLI 参数、事件调度程序）的模型的调用者/处理程序。然后将所需的数据（作为数组、序列化变量或某种数据传输对象）返回到正确的视图（游戏屏幕、控制台终端）。

干杯，艾伦

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2009-01-05T13:41:16.710

两者都不。我会将 AI 编程为通过控制器与模型通信的独立代理。或者，如果您愿意，AI 是*A*模型，但不是*模型*。

# javascript - 重新格式化 JavaScript/JScript 代码？

> ID：356794
> 
> 赞同：1
> 
> 时间：2008-12-10T17:07:28.273
> 
> 标签：javascript, pretty-print

我的页面上有一个 JScript 错误。我知道错误发生在哪里，但我正试图破译该页面上的 JScript（以找出它的来源——它位于 ASPX 页面上，因此任何数量的用户控件都可以注入它）。

如果缩进正确会更容易。是否有适用于 Windows 的免费 JScript 重新格式化程序？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-10T17:09:49.890

您确实应该使用 Firebug 或一些类似的调试工具来实际*找到*问题，但是，如果您只想格式化您的 JavaScript 代码，[这是我在 Google 上找到的重新格式化](http://javascript.about.com/library/blformat.htm)程序。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-10T17:13:20.430

您可以使用[Aptana Studio](http://www.aptana.com/studio)，它免费且非常好，并且您可以[自定义您的格式偏好](http://www.aptana.com/docs/index.php/Customizing_your_formatting_preferences)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-10T17:09:19.330

如果你只运行 Firebug，它会告诉你错误是什么，并带你到它所在的位置。

像 phpDesigner（有免费试用版）这样的工具有一个可以在 JavaScript 上运行的代码美化器，但没有什么能比得上旧的 TAB 键（和 shift tab 以删除垃圾缩进）：P

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-10T17:11:24.160

使用**Visual Studio 2008**

1.  创建一个新的 Web 表单
2.  将您的js代码粘贴到**源代码中**
3.  全选 ( `ctrl + a`)
4.  右键单击以打开上下文菜单
5.  点击**格式选择**

然后将相应地格式化 js 和 html

# asp.net - 使用 UpdatePanel 动态刷新 HTML 表中的行

> ID：356796
> 
> 赞同：6
> 
> 时间：2008-12-10T17:08:23.013
> 
> 标签：asp.net, html, ajax, asp.net-ajax, updatepanel

我最近一直在使用 ASP.NET AJAX UpdatePanel 控件来处理我一直在开发的一些 Intranet 应用程序，并且在大多数情况下，我一直在使用它来动态刷新数据或隐藏和显示基于表单的控件用户的操作。

有一个地方我遇到了一些麻烦，我想知道是否有人有任何建议。我的表单使用非常典型的基于表格的布局，其中表格用于显示标签和字段的网格供用户填写。（我已经知道有些人会避开基于表格的布局，我理解其利弊。但这是我做出的选择，所以请不要回答“不要使用基于表格的布局”。）

现在我的问题是，有时我想将*UpdatePanel*包裹在一组行周围，以便我可以动态地隐藏和显示它们，但 UpdatePanel 并没有真正让你这样做。基本问题是它在它们周围包裹了一个 div，据我所知，您不能在表格行周围包裹一个 div。它不是有效的 HTML。

所以我一直在处理它的方式是让我的动态行完全成为一个全新表的一部分，这没关系，但是你必须手动将所有列与上面的表对齐，这是一个真正的痛苦而且相当脆弱。

所以，问题是......有没有人知道使用 UpdatePanel 或类似的东西动态生成或刷新行的任何技术？希望该解决方案几乎就像在页面上放置一个 UpdatePanel 一样简单，但即使不是，我仍然希望听到它。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-10T17:15:27.040

UpdatePanel 呈现为 DIV 标记，因此在表行之间无效。如果您只想在保持（非常非常糟糕的）表格布局的同时隐藏内容，请在行中包含一个样式标记，其中包含一个 ASP var 用于可见性值，如下所示：

```
<tr style="display: <%= visible %>">
     <td></td>
</tr> 
```

然后根据需要操作可见变量。

也就是说，忽略适当的布局会在这里伤害你。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-11T23:40:01.320

UpdatePanels（或一般的 AJAX 回发）不应仅用于隐藏或显示元素。如果您需要更新数据，那是一回事......但除此之外，只需使用 javascript 更改显示 css 属性。

如果你使用像 jQuery 这样的客户端框架，那就更容易了——你可以这样做：

```
<button onclick="$('.inactive').toggle();">Toogle Inactive</button>

<table>
<tr class="inactive"><td>Inactive 1</td></tr>
<tr class="inactive"><td>Inactive 2</td></tr>
<tr><td>Active 1</td></tr>
<tr><td>Active 2</td></tr>
</table> 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-11T23:36:07.410

如果您正在动态创建控件，则可以在生成控件时决定显示或隐藏哪些内容。

您还可以执行以下操作：

```
<table>
    <tr id="row1" runat="server">
        <td>Label</td><td>Field</td>
    </tr>
</table> 
```

从后面的代码：

```
row1.visible = false; 
```

@Rob Allen 的答案的修改，这样做：

CSS

```
.hidden_row {
    display: none;
} 
```

ASPX

```
<tr class="<%= variable %>"> 
```

同样的想法，只是使用一个类而不是将 CSS 直接编码到表中。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-19T07:37:40.320

回答：最后，没有办法使用 UpdatePanel 来做到这一点。您可以实现的最佳效果是刷新整个表，而不是单个行。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2012-05-26T03:49:39.403

我有同样的问题，我偶然发现了一个解决方案。

如果整个表本身也在更新面板中，您可以更新表的 TD 部分！

不知道为什么。这个对我有用。

```
<asp:UpdatePanel ID="UpdatePanel1" runat="server"><ContentTemplate> <table ID="Table1">
<tr>
<td >
...
</td>
<asp:UpdatePanel ID="UpdatePanel2" runat="server" UpdateMode="Conditional">
<ContentTemplate>
<td >
....
</td>
<td >
...
</td>
<td >
...
</td>
</ContentTemplate>
</asp:UpdatePanel> 

</tr>

 </table></ContentTemplate></asp:UpdatePanel> 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2012-11-07T08:29:21.300

ASP代码：

```
<asp:ScriptManager ID="ScriptManager1" runat="server">
</asp:ScriptManager>
<table width="100%">
    <tr>
        <td style="width: 300px">
            Employee First Name
        </td>
        <td>
            <asp:TextBox ID="txtFname" runat="server"></asp:TextBox>
        </td>
    </tr>
    <asp:UpdatePanel ID="UpdatePanel1" runat="server">
        <ContentTemplate>
            <tbody>
                <tr>
                    <td style="width: 300px">
                        Date Of Birth
                    </td>
                    <td>
                        <asp:TextBox ID="txtDOB1" runat="server" OnTextChanged="txtDOB_TextChanged" AutoPostBack="true"></asp:TextBox>
                        <asp:CalendarExtender ID="txtDOB1_CalendarExtender" runat="server" Enabled="True"
                            TargetControlID="txtDOB1">
                        </asp:CalendarExtender>
                    </td>
                </tr>
                <tr>
                    <td style="width: 300px">
                        Age
                    </td>
                    <td>
                        <asp:TextBox ID="txtAge" Style="font-weight: bold; font-size: large" runat="server"
                            Enabled="false"></asp:TextBox>
                    </td>
                </tr>
            </tbody>
        </ContentTemplate>
    </asp:UpdatePanel>
    <tr>
        <td align="right" style="width: 300px">
            <asp:Button ID="btnSubmit" runat="server" CssClass="button" Text="Submit" />
        </td>
        <td>
            <asp:Button ID="btnClear" runat="server" CssClass="button" Text="Reset" />
        </td>
    </tr>
</table> 
```

班级代码：

```
protected void txtDOB_TextChanged(object sender, EventArgs e)
{
    try
    {
        DateTime Today = DateTime.Now;
        DateTime DOB = Convert.ToDateTime(txtDOB1.Text);
        ArrayList arr = new ArrayList();
        arr = span(Today, DOB);
        arr[0].ToString();//For Years
        arr[1].ToString();//For Months
        arr[2].ToString();//For Days
        txtAge.Text = "Y: " + arr[0].ToString()+",M: "+arr[1].ToString()+",D: "+arr[2].ToString();

    }
    catch (Exception ex)
    {

        lblError.Text = "Error : " + ex.Message ;
    }
}
public ArrayList span(DateTime f, DateTime l)
{
    int days;
    int months;
    int years;

    int fird = f.Day;
    int lasd = l.Day;

    int firm = f.Month;
    int lasm = l.Month;

    if (fird >= lasd)
    {
        days = fird - lasd;
        if (firm >= lasm)
        {
            months = firm - lasm;
            years = f.Year - l.Year;
        }
        else
        {
            months = (firm + 12) - lasm;
            years = f.AddYears(-1).Year - l.Year;
        }
    }
    else
    {
        days = (fird + 30) - lasd;
        if ((firm - 1) >= lasm)
        {
            months = (firm - 1) - lasm;
            years = f.Year - l.Year;
        }
        else
        {
            months = (firm - 1 + 12) - lasm;
            years = f.AddYears(-1).Year - l.Year;
        }
    }

    if (days < 0)
    {
        days = 0 - days;
    }
    if (months < 0)
    {
        months = 0 - months;
    }
    ArrayList ar = new ArrayList();
    ar.Add(years.ToString());
    ar.Add(months.ToString());
    ar.Add(days.ToString());
    return ar;
} 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2011-04-19T22:56:35.153

在我们的项目中，我们找到了这个问题的一些解决方案。我们必须创建复杂的报告，每行中有许多活动元素（编辑、接受等按钮）。

我们创建了放置在 updatepanel 中的 div（用于在需要时更新整个表）。在这个 div 中，我们创建了带有标题定义的表，并为每一行创建了单独的表（这些表放在更新面板中）。为了在每行中创建相等的列，我们必须为每个表格单元格使用 css 类。

所以，我们有这样的东西（在每一行中，我们有几个按钮、下拉菜单、工具提示等，但为了理解我将其截断为单列的想法）：

```
<UpdatePanel>
<DIV>
    <TABLE>
    <TR>
    <TH class="h1">Name</TH>
    </TR>
    </TABLE>

    <UpdatePanel Id='InnerPanel1'>
        <TABLE>
        <TR>
        <TD class="h1">John</TD>
        </TR>
        </TABLE>
    </UpdatePanel>
</DIV>
</UpdatePanel> 
```

它并不优雅并且会生成大的 HTML，但是可以工作。

# java - Java 双重比较 epsilon

> ID：356807
> 
> 赞同：53
> 
> 时间：2008-12-10T17:11:15.083
> 
> 标签：java, floating-point, currency

我写了一个类，用 Java 中的两个双精度来测试相等、小于和大于。我的一般情况是比较可以精确到半美分的价格。59.005 与 59.395 相比。我为这些情况选择的 epsilon 是否足够？

```
private final static double EPSILON = 0.00001;

/**
 * Returns true if two doubles are considered equal.  Tests if the absolute
 * difference between two doubles has a difference less then .00001\.   This
 * should be fine when comparing prices, because prices have a precision of
 * .001.
 *
 * @param a double to compare.
 * @param b double to compare.
 * @return true true if two doubles are considered equal.
 */
public static boolean equals(double a, double b){
    return a == b ? true : Math.abs(a - b) < EPSILON;
}

/**
 * Returns true if two doubles are considered equal. Tests if the absolute
 * difference between the two doubles has a difference less then a given
 * double (epsilon). Determining the given epsilon is highly dependant on the
 * precision of the doubles that are being compared.
 *
 * @param a double to compare.
 * @param b double to compare
 * @param epsilon double which is compared to the absolute difference of two
 * doubles to determine if they are equal.
 * @return true if a is considered equal to b.
 */
public static boolean equals(double a, double b, double epsilon){
    return a == b ? true : Math.abs(a - b) < epsilon;
}

/**
 * Returns true if the first double is considered greater than the second
 * double.  Test if the difference of first minus second is greater then
 * .00001\.  This should be fine when comparing prices, because prices have a
 * precision of .001.
 *
 * @param a first double
 * @param b second double
 * @return true if the first double is considered greater than the second
 *              double
 */
public static boolean greaterThan(double a, double b){
    return greaterThan(a, b, EPSILON);
}

/**
 * Returns true if the first double is considered greater than the second
 * double.  Test if the difference of first minus second is greater then
 * a given double (epsilon).  Determining the given epsilon is highly
 * dependant on the precision of the doubles that are being compared.
 *
 * @param a first double
 * @param b second double
 * @return true if the first double is considered greater than the second
 *              double
 */
public static boolean greaterThan(double a, double b, double epsilon){
    return a - b > epsilon;
}

/**
 * Returns true if the first double is considered less than the second
 * double.  Test if the difference of second minus first is greater then
 * .00001\.  This should be fine when comparing prices, because prices have a
 * precision of .001.
 *
 * @param a first double
 * @param b second double
 * @return true if the first double is considered less than the second
 *              double
 */
public static boolean lessThan(double a, double b){
    return lessThan(a, b, EPSILON);
}

/**
 * Returns true if the first double is considered less than the second
 * double.  Test if the difference of second minus first is greater then
 * a given double (epsilon).  Determining the given epsilon is highly
 * dependant on the precision of the doubles that are being compared.
 *
 * @param a first double
 * @param b second double
 * @return true if the first double is considered less than the second
 *              double
 */
public static boolean lessThan(double a, double b, double epsilon){
    return b - a > epsilon;
} 
```

* * *

## 回答 #1

> 赞同：112
> 
> 时间：2008-12-10T17:24:11.250

You do NOT use double to represent money. Not ever. Use [`java.math.BigDecimal`](https://docs.oracle.com/javase/9/docs/api/java/math/BigDecimal.html) instead.

Then you can specify how exactly to do rounding (which is sometimes dictated by law in financial applications!) and don't have to do stupid hacks like this epsilon thing.

Seriously, using floating point types to represent money is extremely unprofessional.

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2008-12-10T17:15:12.797

是的。Java 双精度将比您给定的 epsilon 0.00001 更好地保持其精度。

由于存储浮点值而发生的任何舍入误差都将小于 0.00001。我经常`1E-6`在 Java 中使用 or 0.000001 作为双 epsilon，没有任何问题。

在相关说明中，我喜欢 的格式，`epsilon = 1E-5;`因为我觉得它更具可读性（Java 中的 1E-5 = 1 x 10^-5）。1E-6 在阅读代码时很容易与 1E-5 区分开来，而 0.00001 和 0.000001 在查看代码时看起来非常相似，我认为它们是相同的值。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2008-12-10T17:21:13.517

Whoa whoa whoa. Is there a specific reason you're using floating-point for currency, or would things be better off with an [arbitrary-precision, fixed-point number format](https://stackoverflow.com/questions/285680/representing-monetary-values-in-java)? I have no idea what the specific problem that you're trying to solve is, but you should think about whether or not half a cent is really something you want to work with, or if it's just an artifact of using an imprecise number format.

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-12-10T17:30:29.053

如果您正在处理金钱，我建议检查金钱设计模式（最初来自[Martin Fowler 的企业架构设计书](https://rads.stackoverflow.com/amzn/click/com/0321127420)）。

我建议阅读此链接以获得动机： [http ://wiki.moredesignpatterns.com/space/Value+Object+Motivation+v2](http://wiki.moredesignpatterns.com/space/Value+Object+Motivation+v2)

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2014-02-04T17:06:49.193

如果您可以使用 BigDecimal，则使用它，否则：

```
/**
  *@param precision number of decimal digits
  */
public static boolean areEqualDouble(double a, double b, int precision) {
   return Math.abs(a - b) <= Math.pow(10, -precision);
} 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2015-02-26T17:42:43.643

正如其他评论者正确指出的那样，当需要精确值时，您不应该*使用*浮点运算，例如货币值。主要原因确实是浮点固有的舍入行为，但我们不要忘记处理浮点也意味着必须处理无穷大和 NaN 值。

为了说明您的方法根本行不通，这里有一些简单的测试代码。我只是将您添加`EPSILON`到`10.0`并查看结果是否等于`10.0`- 它不应该是，因为差异显然不*小于*`EPSILON`：

```
 double a = 10.0;
    double b = 10.0 + EPSILON;
    if (!equals(a, b)) {
        System.out.println("OK: " + a + " != " + b);
    } else {
        System.out.println("ERROR: " + a + " == " + b);
    } 
```

惊喜：

```
 ERROR: 10.0 == 10.00001 
```

如果两个浮点值具有不同的指数，则如果减法时有效位丢失，则会发生错误。

如果您想像其他评论者建议的那样应用更高级的“相对差异”方法，您应该阅读 Bruce Dawson 的优秀文章[Comparing Floating Point Numbers, 2012 Edition](https://randomascii.wordpress.com/2012/02/25/comparing-floating-point-numbers-2012-edition/)，它表明这种方法具有类似的缺点并且实际上*没有*失败-适用于所有浮点数范围的安全近似浮点比较。

简而言之：`double`对于货币价值，不要使用 s，并使用精确的数字表示，例如`BigDecimal`. 为了提高效率，您也可以使用`longs`解释为“毫”（十分之一美分），只要您可靠地防止上溢和下溢。这会产生 的最大可表示值`9'223'372'036'854'775.807`，这对于大多数实际应用程序来说应该足够了。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2010-10-21T19:09:10.103

虽然我同意双倍不利于金钱的观点，但比较双倍的想法仍然很有趣。特别是 epsilon 的建议使用仅适用于特定范围内的数字。这是一个更普遍的 epsilon 用法，相对于两个数字的比率（省略 0 的测试）：

```
boolean equal(double d1, double d2) {
  double d = d1 / d2;
  return (Math.abs(d - 1.0) < 0.001);
} 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-12-10T17:24:55.930

Floating point numbers only have so many significant digits, but they can go much higher. If your app will ever handle large numbers, you will notice the epsilon value should be different.

0.001+0.001 = 0.002 BUT 12,345,678,900,000,000,000,000+1=12,345,678,900,000,000,000,000 if you are using floating point and double. It's not a good representation of money, unless you are damn sure you'll never handle more than a million dollars in this system.

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-12-10T17:27:41.600

Cents? If you're calculationg money values you really shouldn't use float values. Money is actually countable values. The cents or pennys etc. could be considered the two (or whatever) least significant digits of an integer. You could store, and calculate money values as integers and divide by 100 (e.g. place dot or comma two before the two last digits). Using float's can lead to strange rounding errors...

Anyway, if your epsilon is supposed to define the accuracy, it looks a bit too small (too accurate)...

# html - 居中的最佳方法 在页面上垂直和水平？

> ID：356809
> 
> 赞同：588
> 
> 时间：2008-12-10T17:11:33.303
> 
> 标签：html, css, alignment, vertical-alignment, centering

`<div>`在页面上垂直和水平居中元素的最佳方法？

我知道这`margin-left: auto; margin-right: auto;`将以水平为中心，但是垂直的最佳方法是什么？

* * *

## 回答 #1

> 赞同：790
> 
> 时间：2012-11-13T06:27:16.413

## 最好最灵活的方式

这个演示的主要技巧是在元素的正常流动中从上到下，所以`margin-top: auto`设置为零。然而，一个绝对定位的元素对于自由空间的分配是一样的，同样可以在指定的`top`和垂直居中`bottom`（在 IE7 中不起作用）。

##此技巧适用于任何大小的`div`.

```
div {
    width: 100px;
    height: 100px;
    background-color: red;

    position: absolute;
    top:0;
    bottom: 0;
    left: 0;
    right: 0;

    margin: auto;
}
```

```
<div></div>
```

* * *

## 回答 #2

> 赞同：153
> 
> 时间：2013-09-04T15:43:57.953

尽管当 OP 提出这个问题时这不起作用，但我认为，至少对于现代浏览器，最好的解决方案是使用**display: flex**或**pseudo classes**。

您可以在以下[小提琴](http://jsfiddle.net/sFM7C/)中看到一个示例。这是[更新的小提琴](http://jsfiddle.net/sFM7C/287/)。

对于**伪类**，示例可能是：

```
.centerPseudo {
    display:inline-block;
    text-align:center;
}

.centerPseudo::before{
    content:'';
    display:inline-block;
    height:100%;
    vertical-align:middle;
    width:0px;
} 
```

**display: flex**的用法，根据[css-tricks](https://css-tricks.com/snippets/css/a-guide-to-flexbox/)和[MDN](https://developer.mozilla.org/en-US/docs/Web/Guide/CSS/Flexible_boxes)如下：

```
.centerFlex {
  align-items: center;
  display: flex;
  justify-content: center;
} 
```

还有其他可用于 flex 的属性，在上述链接中进行了解释，并提供了更多示例。

如果您必须支持不支持 css3 的旧浏览器，那么您可能应该使用 javascript 或其他答案中显示的固定宽度/高度解决方案。

* * *

## 回答 #3

> 赞同：107
> 
> 时间：2015-01-16T16:03:17.100

这种技术的简单性令人惊叹：（
这种方法虽然有其含义，但如果您只需要居中元素而不管其余内容的流动，那很好。小心使用）

标记：

```
<div>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Vestibulum accumsan tellus purus, et mollis nulla consectetur ac. Quisque id elit at diam convallis venenatis eget sed justo. Nunc egestas enim mauris, sit amet tempor risus ultricies in. Sed dignissim magna erat, vel laoreet tortor bibendum vitae. Ut porttitor tincidunt est imperdiet vestibulum. Vivamus id nibh tellus. Integer massa orci, gravida non imperdiet sed, consectetur ac quam. Nunc dignissim felis id tortor tincidunt, a eleifend nulla molestie. Phasellus eleifend leo purus, vel facilisis massa dignissim vitae. Pellentesque libero sapien, tincidunt ut lorem non, porta accumsan risus. Morbi tempus pharetra ex, vel luctus turpis tempus eu. Integer vitae sagittis massa, id gravida erat. Maecenas sed purus et magna tincidunt faucibus nec eget erat. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nunc nec mollis sem.</div> 
```

和 CSS：

```
div {
  color: white;
  background: red;
  padding: 15px;
  position: absolute;
  top: 50%;
  left: 50%;
  -ms-transform: translateX(-50%) translateY(-50%);
  -webkit-transform: translate(-50%,-50%);
  transform: translate(-50%,-50%);
} 
```

这也将水平和垂直居中元素。没有负边距，只有转换的力量。此外，我们应该已经忘记了 IE8，不是吗？

* * *

## 回答 #4

> 赞同：83
> 
> 时间：2016-04-19T11:42:58.610

我会使用`translate`：

首先将 div 的左上角定位在页面的中心（使用`position: fixed; top: 50%; left: 50%`）。然后，`translate`将其向上移动 div 高度的 50%，使其在页面上垂直居中。最后， translate 还将 div 向右移动 50% 的宽度以使其水平居中。

我实际上认为这种方法比许多其他方法更好，因为它不需要对父元素进行任何更改。

`translate``translate3d`由于它受到更多浏览器的支持，因此比某些情况下要好。[https://caniuse.com/#feat=transforms2d](https://caniuse.com/#feat=transforms2d)

综上所述，Chrome、Firefox 3.5+、Opera 11.5+、Safari、IE 9+、Edge所有版本都支持这种方法。

```
.centered {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  -webkit-transform: translate(-50%, -50%);
  -moz-transform: translate(-50%, -50%);
  -o-transform: translate(-50%, -50%);
  -ms-transform: translate(-50%, -50%);

  font-size: 20px;
  background-color: cyan;
  border: darkgreen 5px solid;
  padding: 5px;
  z-index: 100;
}

table {
    position: absolute;
    top: 0;
    left: 0;
}

td {
    position: relative;
    top: 0;
    left: 0;
}
```

```
<table>
<tr>
    <td>
        <div class="centered">This div<br />is centered</div>
        <p>
            Lorem ipsum dolor sit amet, nam sint laoreet at, his ne sumo causae, simul decore deterruisset ne mel. Exerci atomorum est ut. At choro vituperatoribus usu. Dico epicurei persequeris quo ex, ea ius zril phaedrum eloquentiam, duo in aperiam admodum fuisset. No quidam consequuntur usu, in amet hinc simul eos. Ex soleat meliore percipitur mea, nihil omittam salutandi ut eos. Mea et impedit facilisi pertinax, ea viris graeci fierent pri, te sonet intellegebat his. Vis denique albucius instructior ad, ex eum iudicabit elaboraret. Sit ea intellegam liberavisse. Nusquam quaestio maiestatis ut qui, eam decore altera te. Unum cibo aliquip ut qui, te mea doming prompta. Ex rebum interesset nam, te nam zril suscipit, qui suavitate explicari appellantur te. Usu brute corpora mandamus eu. Dicit soluta his eu. In sint consequat sed, quo ea tota petentium. Adhuc prompta splendide mel ad, soluta delenit nec cu.
        </p>
    </td>
    <td>
        <p>
            Lorem ipsum dolor sit amet, dico choro recteque te cum, ex omnesque consectetuer sed, alii esse utinam et has. An qualisque democritum usu. Ea has habeo labores, laoreet intellegat te mea. Eius equidem inermis vel ne. Ne eum sonet labitur, nec id natum munere. Primis graecis est cu, quis dictas eu mea, eu quem offendit forensibus nec. Id animal mandamus his, vis in sonet tempor luptatum. Ne civibus oporteat comprehensam vix, per facete discere atomorum eu. Mucius probatus volutpat sit an, sumo nominavi democritum eam ut. Ea sit choro graece debitis, per ex verear voluptua epicurei. Id eum wisi dicat, ea sit velit doming cotidieque, eu sea amet delenit. Populo tacimates dissentiunt has cu. Has wisi hendrerit at, et quo doming putent docendi. Ea nibh vide omnium usu.
        </p>
    </td>
</tr>
</table>
```

但是请注意，此方法使该 div 在页面滚动时停留在一个位置。这可能是您想要的，但如果不是，还有另一种方法。

现在，如果我们尝试相同的 CSS，但将位置设置为绝对，它将位于最后一个具有绝对位置的父级的中心。

```
.centered {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  -webkit-transform: translate(-50%, -50%);
  -moz-transform: translate(-50%, -50%);
  -o-transform: translate(-50%, -50%);
  -ms-transform: translate(-50%, -50%);

  font-size: 20px;
  background-color: cyan;
  border: darkgreen 5px solid;
  padding: 5px;
  z-index: 100;
}

table {
    position: absolute;
    top: 0;
    left: 0;
}

td {
    position: relative;
    top: 0;
    left: 0;
}
```

```
<table>
<tr>
    <td>
        <div class="centered">This div<br />is centered</div>
        <p>
            Lorem ipsum dolor sit amet, nam sint laoreet at, his ne sumo causae, simul decore deterruisset ne mel. Exerci atomorum est ut. At choro vituperatoribus usu. Dico epicurei persequeris quo ex, ea ius zril phaedrum eloquentiam, duo in aperiam admodum fuisset. No quidam consequuntur usu, in amet hinc simul eos. Ex soleat meliore percipitur mea, nihil omittam salutandi ut eos. Mea et impedit facilisi pertinax, ea viris graeci fierent pri, te sonet intellegebat his. Vis denique albucius instructior ad, ex eum iudicabit elaboraret. Sit ea intellegam liberavisse. Nusquam quaestio maiestatis ut qui, eam decore altera te. Unum cibo aliquip ut qui, te mea doming prompta. Ex rebum interesset nam, te nam zril suscipit, qui suavitate explicari appellantur te. Usu brute corpora mandamus eu. Dicit soluta his eu. In sint consequat sed, quo ea tota petentium. Adhuc prompta splendide mel ad, soluta delenit nec cu.
        </p>
    </td>
    <td>
        <p>
            Lorem ipsum dolor sit amet, dico choro recteque te cum, ex omnesque consectetuer sed, alii esse utinam et has. An qualisque democritum usu. Ea has habeo labores, laoreet intellegat te mea. Eius equidem inermis vel ne. Ne eum sonet labitur, nec id natum munere. Primis graecis est cu, quis dictas eu mea, eu quem offendit forensibus nec. Id animal mandamus his, vis in sonet tempor luptatum. Ne civibus oporteat comprehensam vix, per facete discere atomorum eu. Mucius probatus volutpat sit an, sumo nominavi democritum eam ut. Ea sit choro graece debitis, per ex verear voluptua epicurei. Id eum wisi dicat, ea sit velit doming cotidieque, eu sea amet delenit. Populo tacimates dissentiunt has cu. Has wisi hendrerit at, et quo doming putent docendi. Ea nibh vide omnium usu.
        </p>
    </td>
</tr>
</table>
```

* * *

## 回答 #5

> 赞同：28
> 
> 时间：2015-01-09T20:58:07.890

利用 Flex Display 的简单解决方案

```
 <div style = 'display:flex; position:absolute; top:0; bottom:0; right:0; left:0; '>
      <div id = 'div_you_want_centered' style = 'margin:auto;'> 
           This will be Centered 
      </div>
 </div> 
```

查看[http://css-tricks.com/snippets/css/a-guide-to-flexbox/](http://css-tricks.com/snippets/css/a-guide-to-flexbox/)

第一个 div 占据了整个屏幕，并为每个浏览器设置了 display:flex。第二个 div（居中的 div）利用了 display:flex div，其中 margin:auto 工作得很好。

**注意**IE11+ 兼容性。（带前缀的 IE10）。

* * *

## 回答 #6

> 赞同：25
> 
> 时间：2013-07-06T11:37:08.837

我认为有两种方法可以通过 CSS 使 div 中心对齐。

```
.middleDiv {
    position : absolute;    
    width    : 200px;
    height   : 200px;
    left     : 50%;
    top      : 50%;
    margin-left : -100px; /* half of the width  */
    margin-top  : -100px; /* half of the height */
} 
```

这是最简单也是最好的方法。有关演示，请访问以下链接：

[http://w3webpro.blogspot.in/2013/07/how-to-make-div-horizo​​ntally-and.html](http://w3webpro.blogspot.in/2013/07/how-to-make-div-horizontally-and.html)

* * *

## 回答 #7

> 赞同：23
> 
> 时间：2018-09-10T23:25:42.543

在我看来使用 Flex-box：

```
#parent {
  display: flex;
  justify-content: center;
  align-items: center;
}
```

```
<div id="parent">
  <div id="child">Hello World!</div>
</div>
```

您会看到只有三个 CSS 属性可用于将子元素垂直和水平居中。`display: flex;`通过激活 Flex-box 显示来完成主要部分，`justify-content: center;`将子元素垂直`align-items: center;`居中并水平居中。为了看到最好的结果，我只是添加了一些额外的样式：

```
#parent {
  display: flex;
  justify-content: center;
  align-items: center;
  height: 500px;
  width: 500px;
  background: yellow;
}

#child {
  width: 100px;
  height: 100px;
  background: silver;
}
```

```
<div id="parent">
  <div id="child">Hello World!</div>
</div>
```

如果您想了解更多关于 Flex-box 的信息，您可以访问[W3Schools](https://www.w3schools.com/css/css3_flexbox.asp)、[MDN](https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_Flexible_Box_Layout/Basic_Concepts_of_Flexbox)或[CSS-Tricks](https://css-tricks.com/snippets/css/a-guide-to-flexbox/)以获取更多信息。

* * *

## 回答 #8

> 赞同：22
> 
> 时间：2015-07-26T17:38:31.500

如果您正在查看新的浏览器（IE10+），

然后您可以使用 transform 属性将 div 对齐在中心。

```
<div class="center-block">this is any div</div> 
```

而这方面的 css 应该是：

```
.center-block {
  top:50%;
  left: 50%;
  transform: translate3d(-50%,-50%, 0);
  position: absolute;
} 
```

这里的问题是您甚至不必指定 div 的高度和宽度，因为它会自行处理。

此外，如果您想将一个 div 定位在另一个 div 的中心，那么您只需将外部 div 的位置指定为**相对**位置，然后这个 CSS 就开始为您的 div 工作。

**这个怎么运作：**

当您将 left 和 top 指定为 50% 时，div 位于页面的右下角四分之一处，其左上角固定在页面的中心。这是因为，左侧/顶部属性（以 % 给出时）是根据外部 div 的高度（在您的情况下为窗口）计算的。

但是 transform 使用元素的高度/宽度来确定平移，因此您的 div 将向左移动（50% 宽度）和顶部（50% 高度），因为它们以负数给出，从而将其与页面中心对齐。

如果您必须支持较旧的浏览器（很抱歉还包括 IE9），那么表格单元格是最流行的使用方法。

* * *

## 回答 #9

> 赞同：16
> 
> 时间：2016-07-25T15:45:36.180

```
position: absolute;
left: 50%;
top: 50%;
-webkit-transform: translate(-50%, -50%);
-ms-transform: translate(-50%, -50%);
transform: translate(-50%, -50%); 
```

解释：

给它一个绝对定位（父级应该有相对定位）。然后，左上角移动到中心。因为您还不知道宽度/高度，所以您使用 css 变换将位置相对于中间平移。translate(-50%, -50%) 确实将左上角的 x 和 y 位置减少了宽度和高度的 50%。

* * *

## 回答 #10

> 赞同：15
> 
> 时间：2016-02-25T23:22:01.397

我最喜欢的将盒子垂直和水平居中的方法是以下技术：

## 外容器

*   应该有`display: table;`

## 内部容器

*   应该有`display: table-cell;`
*   应该有`vertical-align: middle;`
*   应该有`text-align: center;`

## 内容框

*   应该有`display: inline-block;`
*   应该将水平文本对齐重新调整为例如。`text-align: left;`或`text-align: right;`，除非您希望文本居中

这种技术的优雅之处在于，**您可以将内容添加到内容框中，而无需担心其高度或宽度！**

## 演示

```
body {
    margin : 0;
}

.outer-container {
    position : absolute;
    display: table;
    width: 100%; /* This could be ANY width */
    height: 100%; /* This could be ANY height */
    background: #ccc;
}

.inner-container {
    display: table-cell;
    vertical-align: middle;
    text-align: center;
}

.centered-content {
    display: inline-block;
    text-align: left;
    background: #fff;
    padding : 20px;
    border : 1px solid #000;
}
```

```
<div class="outer-container">
   <div class="inner-container">
     <div class="centered-content">
        You can put anything here!
     </div>
   </div>
</div>
```

另见[**这个小提琴**](http://jsfiddle.net/WXLsY/621/)！

* * *

## 编辑

`transform: translate(-50%, -50%);`是的，我知道您可以使用or获得或多或少相同的灵活性，`transform: translate3d(-50%,-50%, 0);`我提出的技术具有更好的浏览器支持。即使使用像`-webkit`,`-ms`或`-moz`,这样的浏览器前缀`transform`也不提供完全相同的浏览器支持。

因此，如果您关心较旧的浏览器（例如 IE9 及以下），则不应该`transform`用于定位。

* * *

## 回答 #11

> 赞同：13
> 
> 时间：2008-12-10T17:16:16.960

这是我不久前写的一个脚本（*它是使用 jQuery 库编写的*）：

```
var centerIt = function (el /* (jQuery element) Element to center */) {
    if (!el) {
        return;
    }
    var moveIt = function () {
        var winWidth = $(window).width();
        var winHeight = $(window).height();
        el.css("position","absolute").css("left", ((winWidth / 2) - (el.width() / 2)) + "px").css("top", ((winHeight / 2) - (el.height() / 2)) + "px");
    }; 
    $(window).resize(moveIt);
    moveIt();
}; 
```

* * *

## 回答 #12

> 赞同：12
> 
> 时间：2017-07-28T11:43:45.570

这是将 div 机器人水平和垂直居中的最佳代码

```
div
{
  position:absolute;
  top:50%;
  left:50%;
  transform:translate(-50%,-50%);
}
```

* * *

## 回答 #13

> 赞同：8
> 
> 时间：2014-07-24T13:48:05.940

我知道我迟到了，但这是一种将未知维度的 div 居中在未知维度的父级中的方法。

风格：

```
<style>

    .table {
      display: table;
      height: 100%;
      margin: 0 auto;
    }
    .table-cell {
      display: table-cell;
      vertical-align: middle;      
    }
    .centered {
      background-color: red;
    }
  </style> 
```

HTML：

```
<div class="table">
    <div class="table-cell"><div class="centered">centered</div></div>
</div> 
```

演示：

看看这个[演示](http://jsbin.com/yotaqagu/1/edit)。

* * *

## 回答 #14

> 赞同：8
> 
> 时间：2018-04-26T04:58:51.197

虽然我来晚了，但这很容易和简单。页面中心始终位于 50% 和顶部 50%。所以减去 div 的宽度和高度 50% 并设置左边距和右边距。希望它适用于任何地方 -

```
body{
  background: #EEE;
}
.center-div{
  position: absolute;
  width: 200px;
  height: 60px;
  left: 50%;  
  margin-left: -100px;
  top: 50%;
  margin-top: -30px;
  background: #CCC;
  color: #000;
  text-align: center;
}
```

```
<div class="center-div">
  <h3>This is center div</h3>
</div>
```

* * *

## 回答 #15

> 赞同：7
> 
> 时间：2018-01-28T10:15:23.813

# **2018 年使用 CSS Grid 的方式：**

```
.parent{
    display: grid;
    place-items: center center;
} 
```

检查浏览器支持，[Caniuse](https://caniuse.com/#feat=css-grid)建议它适用于 Chrome 57、FF 52、Opera 44、Safari 10.1、Edge 16。我没有检查自己。

请参阅下面的片段：

```
.parent{
    display: grid;
    place-items: center center;
    /*place-items is a shorthand for align-items and justify-items*/

    height: 200px;
    border: 1px solid black;
    background: gainsboro;
}

.child{
    background: white;
}
```

```
<div class="parent">
    <div class="child">Centered!</div>
</div>
```

* * *

## 回答 #16

> 赞同：6
> 
> 时间：2014-07-22T11:45:32.853

```
div {
    border-style: solid;
    position: fixed;
    width: 80%;
    height: 80%;
    left: 10%;
    top: 10%;
} 
```

左右调整宽度和高度，即 (100% - 80%) / 2 = 10%

* * *

## 回答 #17

> 赞同：6
> 
> 时间：2014-09-22T16:06:54.373

实际上有一个解决方案，使用css3，它可以垂直居中一个未知高度的div。诀窍是将 div 向下移动 50%，然后使用`transformY`将其恢复到中间。唯一的前提是要居中的元素有父元素。例子：

```
<div class="parent">
    <div class="center-me">
        Text, images, whatever suits you.
    </div>
</div>

.parent { 
    /* height can be whatever you want, also auto if you want a child 
       div to be responsible for the sizing */ 
    height: 200px;
}

.center-me { 
    position: relative;
    top: 50%;
    transform: translateY(-50%);
    /* prefixes needed for cross-browser support */
    -ms-transform: translateY(-50%);
    -webkit-transform: translateY(-50%);
} 
```

支持所有主流浏览器，以及 IE 9 及更高版本（不要担心 IE 8，因为它在今年秋天与 win xp 一起死了。感谢上帝。）

**[JS 小提琴演示](http://jsfiddle.net/f5ffo7bL/)**

* * *

## 回答 #18

> 赞同：6
> 
> 时间：2017-08-14T23:28:35.477

**解决方案**

仅使用两行 CSS，利用 Flexbox 的神奇力量

```
.parent { display: flex; }
.child { margin: auto } 
```

* * *

## 回答 #19

> 赞同：5
> 
> 时间：2014-10-09T15:44:29.513

使用“display：table”规则从[这里获取的另一种方法（防弹）：](https://webdesign.tutsplus.com/tutorials/the-holy-grail-of-css-centering--cms-22114)

标记

```
<div class="container">
  <div class="outer">
    <div class="inner">
      <div class="centered">
        ...
      </div>
    </div>
  </div>
</div> 
```

CSS：

```
.outer {
  display: table;
  width: 100%;
  height: 100%;
}
.inner {
  display: table-cell;
  vertical-align: middle;
  text-align: center;
}
.centered {
  position: relative;
  display: inline-block;

  width: 50%;
  padding: 1em;
  background: orange;
  color: white;
} 
```

* * *

## 回答 #20

> 赞同：5
> 
> 时间：2015-03-24T20:19:50.473

我正在查看 Laravel 的视图文件，并注意到它们将文本完美地居中。我立刻想起了这个问题。他们是这样做的：

```
<html>
<head>
    <title>Laravel</title>

    <!--<link href='//fonts.googleapis.com/css?family=Lato:100' rel='stylesheet' type='text/css'>-->

    <style>
        .container {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            display: table;

        }

        .inside {
            text-align: center;
            display: table-cell;
            vertical-align: middle;
        }

    </style>
</head>
<body>
    <div class="container">
            <div class="inside">This text is centered</div>
    </div>
</body> 
```

结果看起来是这样的：

![在此处输入图像描述](https://i.stack.imgur.com/d7jpZ.png)

* * *

## 回答 #21

> 赞同：4
> 
> 时间：2014-12-11T14:16:49.093

另一个答案是[this](http://jsfiddle.net/psokp7os/1/)。

```
<div id="container"> 
    <div id="centered"> </div>
</div> 
```

和CSS：

```
#container {
    height: 400px;
    width: 400px;
    background-color: lightblue;
    text-align: center;
}

#container:before {
    height: 100%;
    content: '';
    display: inline-block;
    vertical-align: middle;
}

#centered {
    width: 100px;
    height: 100px;
    background-color: blue;
    display: inline-block;
    vertical-align: middle;
    margin: 0 auto;
} 
```

* * *

## 回答 #22

> 赞同：4
> 
> 时间：2018-02-24T08:43:55.120

我很惊讶这还没有被提及，但最简单的方法是使用视口大小设置高度、边距（和宽度，如果你愿意的话）。
您可能知道，视口的总高度 = 100vh。
假设您希望`height`您的容器占据屏幕的 60% (60vh)，您可以将其余的 (40vh) 平均分配在顶部和底部边距之间，以便元素自动在中心对齐。
将`margin-left`and设置`margin-right`为`auto`, 将确保容器水平居中。

```
.container {
         width: 60vw; /*optional*/
         height: 60vh;
         margin: 20vh auto;
         background: #333;
 }
```

```
<div class="container">
</div>
```

* * *

## 回答 #23

> 赞同：3
> 
> 时间：2013-09-18T10:09:22.380

如果你们正在使用 JQuery，则可以使用`.position()`;

```
<div class="positionthis"></div> 
```

CSS

```
.positionthis {
    width:100px;
    height:100px;
    position: absolute;
    background:blue;
} 
```

Javascript (JQuery)

```
$(document).ready(function () {
    $('.positionthis').position({
        of: $(document),
        my: 'center center',
        at: 'center center',
        collision: 'flip flip'
    });
}); 
```

JSFiddle：http: [//jsfiddle.net/vx9gV/](http://jsfiddle.net/vx9gV/)

* * *

## 回答 #24

> 赞同：3
> 
> 时间：2017-09-23T02:17:30.300

```
div {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    -ms-transform: translate(-50%, -50%); /* IE 9 */
    -webkit-transform: translate(-50%, -50%); /* Chrome, Safari, Opera */	    
}
```

```
<body>
    <div>Div to be aligned vertically</div>
</body>
```

**位置：正文文档中的绝对**div

具有位置的元素：绝对；相对于最近的定位祖先定位（而不是*相*对于视口（主体标签）定位，如固定）。

然而; 如果绝对定位元素没有定位的祖先，它使用文档正文，并随着页面滚动移动。

来源：[CSS位置](https://www.w3schools.com/css/css_positioning.asp)

* * *

## 回答 #25

> 赞同：3
> 
> 时间：2016-06-16T11:59:42.373

如果您知道为您定义的尺寸，您`div`可以使用`calc`.

现场示例：[https ://jsfiddle.net/o8416eq3/](https://jsfiddle.net/o8416eq3/)

注意：这只有在你在 CSS 中硬编码 `div` 的宽度和高度时才有效。

```
#target {
  position:fixed;
  top: calc(50vh - 100px/2);
  left: calc(50vw - 200px/2);
  width:200px;
  height:100px;
  background-color:red;
}
```

```
<div id='target'></div>
```

* * *

## 回答 #26

> 赞同：3
> 
> 时间：2017-08-17T08:39:48.153

`display:grid`在父级上使用并设置`margin:auto` 为 centerrd 元素可以解决问题：

见下面的片段：

```
html,body {
  width :100%;
  height:100%;
  margin:0;
  padding:0;
}

.container {
  display:grid;
  height:90%;
  background-color:blue;
}

.content {
  margin:auto;
  color:white;
}
```

```
<div class="container">
  <div class="content"> cented div  here</div>
</div>
```

* * *

## 回答 #27

> 赞同：2
> 
> 时间：2015-08-04T13:42:14.503

是浏览器支持吗，使用翻译功能强大。

```
position: absolute;
background-color: red;

width: 70%;     
height: 30%; 

/* The translate % is relative to the size of the div and not the container*/ 
/* 21.42% = ( (100%-70%/2) / 0.7 ) */
/* 116.666% = ( (100%-30%/2) / 0.3 ) */
transform: translate3d( 21.42%, 116.666%, 0); 
```

* * *

## 回答 #28

> 赞同：0
> 
> 时间：2013-10-16T14:58:45.710

抱歉回复晚了最好的方法是

```
 div {
      position: fixed;
      top: 50%;
      left: 50%;
      margin-top: -50px;
      margin-left: -100px;
    } 
```

margin-top 和 margin-left 应该根据你的 div 框大小

* * *

## 回答 #29

> 赞同：0
> 
> 时间：2012-08-24T14:03:22.603

这个解决方案对我有用

```
 .middleDiv{
        position : absolute;
        height : 90%;
        bottom: 5%;
    } 
```

（或高度：70% / 底部：15%

高度：40% / 底部：30% ...)

* * *

## 回答 #30

> 赞同：0
> 
> 时间：2017-10-06T08:44:32.710

请使用以下 CSS 属性水平和垂直居中对齐元素。这对我来说很好。

```
div {
  position: absolute;
  left: 0;
  top: 0;
  right: 0;
  bottom: 0px;
  margin: auto;
  width: 100px;
  height: 100px;
} 
```

# ftp - SQL Server 2000 FTP

> ID：356818
> 
> 赞同：0
> 
> 时间：2008-12-10T17:13:23.753
> 
> 标签：ftp, sql-server-2000, dts

我正在尝试使用 SQL Server 2000 DTS 包从 FTP 服务器下载文件。但是，DTS 中的 FTP 模块只显示我的 ftp 登录“主”目录中的文件。连接后，我需要更改远程目录。我该怎么做呢？我可以很高兴地浏览到 FTP 任务的“文件”选项卡中的目录。我需要浏览的目录在我的主目录“上方”。

非常感谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-12T20:15:52.330

在 FTP 任务之前添加一个“动态属性任务”。

更改 SourceFilename 的 FTP 任务设置。它只是一个常数。

源值应该是：'FILENAME';'/FTPSTARTUP/PATH';'FILESIZE'

# c# - C# - 获取参考文献

> ID：356819
> 
> 赞同：2
> 
> 时间：2008-12-10T17:13:37.027
> 
> 标签：c#, .net, dll, .net-2.0, class-library

我已经建立了一个类库项目，它引用了几个 dll。在我的类库项目的构造函数中，我使用了来自引用的 dll 之一的一些枚举。在另一个项目中使用我的类库时，是否可以不必添加对我的 dll 的引用以及我的类库项目在内部引用的那些？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-10T17:26:42.617

It depends on what you mean by *reference internally*.

If your application project uses type A from your class library, and that class does not expose any public types from other libraries, 3rd party or not, you don't need to add any references to more than your class library containing type A.

However, if type A exposes some public properties, methods returning types, or taking parameters of types, or perhaps type A is descended from a type, that is located in some other assembly, then you need a reference to that other assembly as well.

So if you indeed mean *uses internally*, then it should not be necessary to add more than just the one reference to your class library.

However, if the compiler complains, then that's what matters.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-10T17:17:57.800

您只需要引用 DLL。您只引用您在程序集中使用的内容；这些程序集是完全自我描述的单个单元，因此不需要引用引用的程序集引用的引用（顺便说一句，我在这里反复使用“引用”这个词是在开玩笑:-)。

想象一下，如果您*确实*必须这样做 - BCL 引用了许多不同的东西，更不用说第 3 方组件了，想象一下您必须付出多少努力才能获得正确的引用！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-10T17:29:53.390

如果您正在引用被引用程序集所公开的任何类型（即使只是它们的成员或类型化实例），那么您还必须包含对该程序集的引用。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-10T18:04:54.477

在 ctor 中获取您自己的枚举，并将其转换为 3rd 方枚举。我相信这将使您的调用者不必引用第 3 方程序集（当然，它仍然需要在运行时可用才能使您的代码正常工作）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-10T18:48:05.700

我认为 lassevk 简洁地解释了它，但只是想补充一点，尽管您不需要*引用*DLL 使用的那些附加程序集（再次假设它们仅在内部使用而不公开），但您*仍然*需要使它们可访问你的申请。也就是说，它们必须是可找到的——在应用程序旁边或在 GAC 中，否则使用它们的 DLL 将无法找到它们。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2008-12-10T17:43:05.487

我不确定您要做什么，但如果您不想，则不必引用任何程序集。您可以使用反射。它通常被认为是一种 hack，不推荐，但有时是必要的。 [在这里你有一篇文章](http://www.codeproject.com/KB/cs/DynLoadClassInvokeMethod.aspx)解释了如何。

# language-agnostic - 生成唯一参考编号策略

> ID：356828
> 
> 赞同：6
> 
> 时间：2008-12-10T17:16:00.267
> 
> 标签：language-agnostic, uniqueidentifier

嗯……这就是我的 CS 知识让我失望的地方。我想编写一个生成唯一参考号的算法。

我不想使用序列号，因为它们会带来安全风险，我想使用字母数字。ref 也将具有最小和最大长度。（我不能使用 GUID 它太长了）

理想情况下，我不想查询我的持久层以查看以前是否使用过 ref。

我可以采用什么策略？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-10T17:18:25.380

如果您担心安全风险，那么您需要一个加密安全的随机数生成器。您应该能够告诉它您想要多少字节（即数字可以有多长）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-10T17:23:55.197

If this number will be ever be referenced by humans, I encourage you to follow these guidelines in your solution:

[What is the best format for a customer number, order number?](https://stackoverflow.com/questions/178572/what-is-the-best-format-for-a-customer-number-order-number)

If you can't synchorize with the database to see what the next number will be, and you can't use GUIDs or a comparably long random string, then you need to include some sort of local value in the ID.

e.g., if all clients will be on a known network, you can end each number in each client's ip address D block.

Or, if clients have to login and each user can login only once at a time, you can include their userid in the number somewhere.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-10T17:38:00.677

我在这里暗中尝试，但是...您想要一个唯一的随机值，但小于 16 个字节。你最好的选择仍然是一个只有 16 个字节的 GUID……你想使用字母数字所以……一些选项。

使用 GUID，但将其编码为 base64，看起来像 7QDBkvCA1+B9K/U0vrQx1A，它是 22 个字节，仍然比本机 Guid 长……但比典型的字符串表示形式短。

请参阅此处的文本编码：[http ://en.wikipedia.org/wiki/Globally_Unique_Identifier](http://en.wikipedia.org/wiki/Globally_Unique_Identifier)

另一种选择是对 Guid 进行哈希处理，但您会失去一些唯一性，那么您对非唯一项目的容忍度是多少？

==========

假设您有一个插入表的进程，您可以使用 HiLo 算法并确信您不必每次都访问数据库。您只需将最后一个高值存储在内存中......当进程启动时，您将访问数据库以找出您停止的位置：[什么是 Hi/Lo 算法？](https://stackoverflow.com/questions/282099/whats-the-hilo-algorithm)

我仍然说 Guid 是您最好的选择....16 字节还不错，并且与您想出的大多数字母数字解决方案一样小。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-11T09:14:48.460

一种方法可能是基于较小的数字子集生成数字。例如，您可以使用基于 godel 编号的二进制序列来生成。例如，在 5z、3y、2x 上将 000 映射到 111 会产生 0、2、3、6、5、10、15、30。

当然，这过于简单化了。但是通过迭代“盐”数字来生成参考编号，您根本不必跟踪参考编号。前提是，或者当然，你有理由确定你不必考虑碰撞。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-11T09:41:35.113

如果可能在您的应用程序/环境中，您是否考虑将时间作为一部分添加到伪随机生成的数字中？

即 microtime() + rand(10000,99999)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-11T09:44:54.903

我一直在成功的生产系统中这样做：

*   取当前时间（UTC，精度为微秒）
*   你的进程id，线程id
*   您的计算机名称
*   盐值（基本上只是您的程序独有的字符串）
*   一个随机值（最好是加密级 PRNG）

把它放在内存中，或者作为一个字符串，或者将这些值放在一起或类似的东西。然后：

*   用例如 SHA-1 散列它
*   对结果数执行 mod N 以将输出缩小到 N 个字节
*   如果需要，转换为十六进制或可打印的内容。

请注意，将 UID 缩小到 N 字节会增加 UID 冲突的机会。

第一个列表中的所有输入数据是为了确保如果您有一个由许多计算机组成的集群，您可以获得一个唯一的散列基础。您可以省略其中的一些，但您必须确定它包含的内容对于您将在其上生成 UID 的每台计算机都不同。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2008-12-10T17:33:02.637

将 GUID 截断为所需的大小。

如果您正在生成数字，除非它们是随机且巨大的，否则您最好检查它们是否已被使用。

# python - Pexpect，运行 ssh-copy-id 在尝试生成第二个进程时挂起

> ID：356830
> 
> 赞同：7
> 
> 时间：2008-12-10T17:16:31.453
> 
> 标签：python, process, pexpect

我正在编写一个 Python 脚本，我需要在其中生成几个 ssh-copy-id 进程，并且它们需要我输入密码，所以我使用的是 PExpect。

我基本上有这个：

```
child = pexpect.spawn('command')
child.expect('password:')
child.sendline('the password') 
```

然后我想产生另一个进程，我不再关心这个了，不管它是否结束。

```
child = pexpect.spawn('command2')
child.expect('password:')
child.sendline('the password') 
```

并且代码挂在第二个“spawn”

但是，如果我注释掉第一个电话，第二个电话有效，所以我猜测第一个电话仍在运行或某些东西使其无法正常工作。

现在，我无法做的另一件事是等到第一个停止。我试过：
child.close() - 它挂起（以 True 和 False 作为参数） child.read(-1) - 它挂起
child.expect(pexpect.EOF) - 它挂起。
child.terminate() - 它挂起（以 True 和 False 作为参数）

关于可能发生什么的任何想法？
注意：我不是 Python 专家，而且我以前从未使用过 pexpect，所以任何想法都非常受欢迎。

谢谢！

* * *

更新：这肯定与 ssh-copy-id 有关，因为对于其他进程，即使它们不返回，spawn 也能正常工作。此外，显然 ssh-copy-id 永远不会返回 EOF。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-11-02T18:49:35.387

幸运与否，但 OpenSSH 客户端似乎对密码及其来源非常挑剔。

您可以尝试使用[Paramiko](http://www.lag.net/paramiko/) Python SSH2 库。这是一个简单的[示例，如何将其与密码身份验证一起使用](http://www.lag.net/pipermail/paramiko/2006-January/000180.html)，然后发出一些 shell 命令（`echo "..." >> $HOME/.ssh/authorized_keys`最简单）以在远程主机上添加您的公钥。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-10T21:53:02.097

我认为问题在于，SSH 试图打开 PTY，但出于安全原因，它在 PTY 以外的任何东西上都不起作用。这不适用于 pexpect。

我有另一个 ssh 客户端：

[http://www.digmia.com/index.php?option=com_content&view=article&id=54:Digmia%20Enterprise%20SSH&Itemid=56](http://www.digmia.com/index.php?option=com_content&view=article&id=54:Digmia%20Enterprise%20SSH&Itemid=56)

它是开源的，你可以使用它。你想要做的是更多的命令，但你根本不需要期望。

1.  首先按照手册进行安装，然后执行以下操作：

2.  运行 dssh-agent，添加您需要的密码，如下所示：

    ```
    dssh-add -l < passwordfile 
    ```

    *   或者如果它是一台安全机器，即没有其他人可以在那里登录，这*非常*重要，否则这将是一个巨大的安全漏洞：

        ```
        echo "name-of-server;22;root;password;" | dssh-add -l 
        ```

    *   `password`文件将类似于：

        ```
        name-of-server;22;root;password; 
        ```

3.  并执行类似的操作（替换`CONTENTS OF ...`为该文件的实际内容）：

    ```
    dssh root@name-of-server -- echo "CONTENTS OF ~/.ssh/identity.pub" > .ssh/authorized_keys \; chmod og-w .ssh .ssh/authorized_keys 
    ```

    *   你可以（可选）做

        ```
        dssh-add -f passwords 
        ```

    （确保没有其他人在做所有这些事情，否则你会有一个竞争条件）。

此外，pexpect 可能应该与 dssh 本身一起使用（因此您不需要使用 dssh-agent）。但是使用 dssh-agent 更简单、更安全。

DSSH 的安装手册包含在 tarball 中。

我不知道任何更简单的方法，OpenSSH ssh-copy-id 对密码的来源非常挑剔......

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-10T18:10:05.197

阅读[spawn 的 pexpect 文档](http://pexpect.sourceforge.net/pexpect.html#spawn)，我认为它正在等待命令终止。

我会根据您的需要提出几种不同的可能性：

1）杀死产生的进程。但是，这可能会导致您的操作腐败，所以我不知道这是否是您想要的。

```
child = pexpect.spawn('command')
child.expect('password:')
child.sendline('the password')
child.close(True) 
```

2) 等待初始任务完成后再进行下一个任务

```
child = pexpect.spawn('command')
child.expect('password:')
child.sendline('the password')
child.wait()
child = pexpect.spawn('command2')
... 
```

3）为所有孩子使用不同的实例，然后在最后等待所有孩子——这很可能是最好的解决方案

```
def exec_command(cmd):
  child = pexpect.spawn(cmd)
  child.expect('password:')
  child.sendline('the password')
  return child

commands = ['command1', 'command2']
childrens = [exec_command(cmd) for cmd in commands]
for child in childrens:
  child.wait() 
```

注意：这里的所有代码都未经测试，并且是在脚本挂起的假设下编写的，因为删除 spawn 对象将挂起，直到命令终止。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-10T18:43:21.963

实际上，我尝试了许多这些替代方法，但都没有奏效。

*   调用 close() 或 terminate() 挂起（以 True 和 False 作为参数）
*   调用 wait() 或 read(-1) 或 expect(pexpect.EOF) 挂起
*   再次调用 spawn 而不关心之前的 spawn 命令挂起

我用其他命令进行了一些测试（比如'ftp'，它们按我的预期工作，例如，如果你调用.expect（'something'），并且在EOF之前没有找到某些东西，它们不会永远等待，他们抛出一个异常，所以我相信这与 ssh-copy-id 命令特别有关。

# rpgle - 在 RPGLE 子过程中模拟本地文件规范

> ID：356831
> 
> 赞同：2
> 
> 时间：2008-12-10T17:17:04.400
> 
> 标签：rpgle, rpg, ibm-midrange

我对 V6R1 中的新“本地 F 规范”感到非常兴奋 - 请参阅：

[http://www.mcpressonline.com/programming/rpg/v6r1-rpg-enhancements.html](http://www.mcpressonline.com/programming/rpg/v6r1-rpg-enhancements.html)

有谁知道在 SRVPGM 程序中在 V5R4 中模拟这个的方法？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-11T04:14:39.190

据我所知，您只能在全局范围内定义它们，但您可以在一个子过程中只处理该文件。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-12T10:00:17.633

您只能通过制作仅全局处理*一个文件的模块来模拟它。*所以文件范围仍然是全局的，但你不与其他文件共享它。如果您真的希望每个过程都有一个文件，则必须为每个过程创建一个模块。我不建议这样做。模块太多了。但也许你对每个文件一个模块的风格很满意，否则你必须像我一样等待 v6r1 ;)

# html - 使用 DIV 和 CSS

> ID：356835
> 
> 赞同：5
> 
> 时间：2008-12-10T17:17:59.030
> 
> 标签：html, css

好的，如果有人可以帮助我，我将不胜感激。如果您复制并粘贴以下内容并在 IE 或 Firefox 中打开

```
<div style="border: solid 1px navy; float: left;">
    <ul>
        <li>Item 1</li>
        <li>Item 2</li>
        <li>Item 3</li>
        <li>Item 4</li>
        <li>Item 5</li>
    </ul>
</div>
<div style="background-color: blue;">
    <p>Some Text</p>
    <p>Another paragraph</p>
</div> 
```

为什么具有蓝色背景的第二个 div 扩展为包含项目列表的第一个 div 后面？如何让它真正漂浮在第一个 div 旁边？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-10T17:44:44.670

你看到你描述的行为的原因是因为这些是你给 DIV 的指令。

让我们分解一下：

```
<div style="border: solid 1px navy; float: left;"> 
```

这依赖于除边框之外的所有内容的默认行为，并且通过浮动它，您告诉框将自己固定到左边距（它的父级，这里假定为主体），而不管那里还有什么。DIV 的默认宽度是父对象宽度的 100%（仍然是 body 标签）。默认位置是流中的下一个块元素 - 因为没有任何其他块元素，所以它与上边距垂直对齐。

然后您要求另一个 DIV 执行此操作：

```
<div style="background-color: blue; float:left;"> 
```

这本质上是一样的。在这里，您没有给 DIV 一个新的宽度或关于它们现在应该在布局中的位置的任何附加说明，因此它将自己固定到左边距，并且它的上边距找到要固定到最近的块元素（仍然是主体）。

要让它们并排排列，请执行以下操作：

```
 <style type="text/css">
    .leftBox, .rightBox
    {
       width: 48%; /*leave some room for varying browser definitions */
       border: 1px solid navy;
       float: left;
       display: inline; /* follow the semantic flow of the page and don't break the line */
       clear: left; /* don't allow any other elements between you and the left margin */
     }

    .rightBox
    {
       border: none;
       background-color: blue;
       clear: right;
    }
</style>
<div class="leftBox">
    <ul>
        <li>Item 1</li>
        <li>Item 2</li>
        <li>Item 3</li>
        <li>Item 4</li>
        <li>Item 5</li>
    </ul>
</div>
<div class="rightBox">
    <p>
        some other text</p>
</div> 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-10T17:25:39.000

如果您希望蓝色框位于列表旁边，您还需要浮动它：

```
<div style="border: solid 1px navy; float: left;">
<ul>
    <li>Item 1</li>
    <li>Item 2</li>
    <li>Item 3</li>
    <li>Item 4</li>
    <li>Item 5</li>
</ul>
</div>
<div style="background-color: blue; float:left;"><p>Some Text</p><p>Another paragraph</p></div> 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-10T17:25:53.867

当第一个 div 向左浮动时，第二个 div 的位置就好像它不存在一样（尽管第二个 div 中的任何文本都会围绕浮动的 div 流动）。有关浮动元素行为的更多信息，请参阅[CSS2 规范。](http://www.w3.org/TR/CSS2/visuren.html#floats)

要让第二个 div 浮动在第一个 div 旁边，您可以添加`float: left`到第二个 div。

或者，如果第一个 div 的宽度已知，您可以将左边距添加到第二个 div。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-10T17:26:51.073

**添加`overflow: auto; zoom: 1.0;`到第二个 div**

这与放置第二个 div 不同（并且在某种意义上更接近所要求的内容），`float: left;`因为它保留了第二个 div 的宽度，尽可能向右扩展，而无需硬编码宽度值。 `zoom: 1.0;`需要在 IE 中给出元素布局。

```
<div style="border: solid 1px navy; float: left;">
<ul>
    <li>Item 1</li>
    <li>Item 2</li>
    <li>Item 3</li>
    <li>Item 4</li>
    <li>Item 5</li>
</ul>
</div>
<div style="background-color: blue; overflow: auto; zoom: 1.0;"><p>Some Text</p><p>Another paragraph</p></div> 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-10T17:27:17.843

您希望第二个 div 浮动在第一个 div 旁边吗？然后你添加`float:left`到第二个 div。

**不要**纯粹为了清除而创建另一个 div，这非常没有语义。

编辑：`overflow: auto`不适用于 IE，在这种情况下，您需要提供 div hasLayour，这涉及添加`zoom:1.0`或强制您可能无法执行的固定维度的技巧。当存在有效的解决方案时不要破解。你想让它浮动，使用浮动。

# c# - Reporting Services as PDF through WebRequest in C# 3.5 "Not Supported File Type"

> ID：356839
> 
> 赞同：5
> 
> 时间：2008-12-10T17:18:59.187
> 
> 标签：c#, pdf, reporting-services

I've inherited a legacy application that is supposed to grab an on the fly pdf from a reporting services server. Everything works fine up until the point where you try to open the pdf being returned and adobe acrobat tells you:

> Adobe Reader could not open 'thisStoopidReport'.pdf' because it is either not a supported file type or because the file has been damaged(for example, it was sent as an email attachment and wasn't correctly decoded).

I've done some initial troubleshooting on this. If I replace the url in the WebRequest.Create() call with a valid pdf file on my local machine ie: @"C:temp/validpdf.pdf") then I get a valid PDF.

The report itself seems to work fine. If I manually type the URL to the reporting services report that should generate the pdf file I am prompted for user authentication. But after supplying it I get a valid pdf file.

I've replace the actual url,username,userpass and domain strings in the code below with bogus values for obvious reasons.

```
 WebRequest request = WebRequest.Create(@"http://x.x.x.x/reportServer?/reports/reportNam&rs:format=pdf&rs:command=render&rc:parameters=blahblahblah");
        int totalSize = 0;
        request.Credentials = new NetworkCredential("validUser", "validPass", "validDomain");
        request.Timeout = 360000; // 6 minutes in milliseconds.
        request.Method = WebRequestMethods.Http.Post;
        request.ContentLength = 0;
        WebResponse response = request.GetResponse();
        Response.Clear();
        BinaryReader reader = new BinaryReader(response.GetResponseStream());
        Byte[] buffer = new byte[2048];
        int count = reader.Read(buffer, 0, 2048);
        while (count > 0)
        {
            totalSize += count;
            Response.OutputStream.Write(buffer, 0, count);
            count = reader.Read(buffer, 0, 2048);
        }
        Response.ContentType = "application/pdf";
        Response.Cache.SetCacheability(HttpCacheability.Private);
        Response.CacheControl = "private";
        Response.Expires = 30;
        Response.AddHeader("Content-Disposition", "attachment; filename=thisStoopidReport.pdf");
        Response.AddHeader("Content-Length", totalSize.ToString());
        reader.Close();
        Response.Flush();
        Response.End(); 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-10T20:36:07.010

查看您在 notepad.exe 中返回的 pdf 文件。我怀疑你会在那里看到 HTML。如果您调用一个作为传递页面的网页，则会分割一个 pdf 文件。Web 请求将返回 HTML 而不是 PDF 文件。

如果您直接调用具有 pdf 文件的网站，例如[http://www.somesite.com/file.pdf](http://www.somesite.com/file.pdf) ，您的代码将起作用。问题是您可能有一个隐藏pdf文件真实位置的网页。

我解决这个问题的方法是创建一个 ISAPI DLL，它允许您传递它需要的参数来确定需要发回的 pdf 文件。比 ISAPI DLL 会流回具有“应用程序/pdf”内容类型的 pdf。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-10T23:10:30.863

那些提出问题是从 URL 返回的 HTML 的人指出了我正确的方向。事实上，当我意识到这里的原始程序员使用 PUT 而不是 GET 方法时。

因此，通过更正单行：

```
request.Method = WebRequestMethods.Http.Post; 
```

现在一切都在玫瑰花... err pdf ......不管它的工作原理。

感谢您为我指明正确的方向。有时它只需要第二双眼睛。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-10T20:36:05.760

您的问题是否是由于将字节数组声明为 2048 的长度而不是基于 GetResponseStream() 返回的流的长度而引起的？

# asp.net-mvc - How to use multiple view engines in ASP.NET MVC application

> ID：356843
> 
> 赞同：3
> 
> 时间：2008-12-10T17:19:23.973
> 
> 标签：asp.net-mvc, brail

I'd like to use two view engines in my asp.net mvc web application. The first one is the Brail view engine from MVCContrib project, and another one is my custom view engine for generating javascript code. However, I can't configure the application to use both engines. I'd like to use view file extension to discern which engine should handle the request - .brail for Brail engine - .json - for my custom engine

When I add two engines to the ViewEngines collection in global.asax.cs, the system is always looking for *.brail views and throws exception if it doesn't find one. It never looks for my *.json views... Is it a problem with the ASP.Net mvc framework, with Brail view engine or with my code? How should it be handled?

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-11T14:19:40.717

[像这样。](http://haacked.com/archive/2008/11/16/composing-multiple-view-engines.aspx "使用多个 ViewEngine 渲染单个视图")

编辑：如果您的自定义 ViewEngine 没有处理 *.json，那么您的视图引擎中很可能有错误。处理此问题的最简单方法是子类型 VirtualPathProviderViewEngine 并在构造函数中设置 MasterLocationFormats、ViewLocationFormats 和 PartialViewLocationFormats。请参阅 WebFormViewEngine 的源代码以获取一个非常简单的示例。这样，框架代码就可以为您完成所有工作。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-10T19:57:06.323

我相信您可以在控制器中更改视图引擎。因此，我将扩展您的控制器以通过扩展选择视图引擎。

# c# - 使用'var'会影响性能吗？

> ID：356846
> 
> 赞同：243
> 
> 时间：2008-12-10T17:19:45.113
> 
> 标签：c#, performance, variables, var

早些时候我问了一个问题，[为什么我看到这么多示例使用`var`关键字](https://stackoverflow.com/questions/335682/mvc-examples-use-of-var)并得到答案，虽然它只对匿名类型是必需的，但它仍然用于使编写代码“更快”/更容易和“只是因为”。

按照[这个链接（“C# 3.0 - Var is not Objec”）](http://www.interact-sw.co.uk/iangblog/2005/09/23/varisntobject)，我看到它`var`在 IL 中被编译为正确的类型（你将在文章的中途看到它）。

我的问题是，如果有的话，使用关键字的 IL 代码还需要多少，如果在任何地方都使用`var`它，它是否接近于代码性能的可测量水平？

* * *

## 回答 #1

> 赞同：324
> 
> 时间：2008-12-10T17:21:40.507

关键字没有额外的 IL 代码`var`：对于非匿名类型，生成的 IL 应该是相同的。如果编译器因为无法确定您打算使用的类型而无法创建该 IL，则会出现编译器错误。

唯一的技巧是，`var`如果您要手动设置类型，它将推断出您可能选择了接口或父类型的确切类型。

* * *

## 回答 #2

> 赞同：75
> 
> 时间：2008-12-10T17:24:20.157

正如 Joel 所说，编译器在*编译时*计算出 var 应该是什么类型，实际上这只是编译器为保存击键而执行的一个技巧，例如

```
var s = "hi"; 
```

被取代

```
string s = "hi"; 
```

*在生成任何 IL 之前*由编译器执行。*生成的 IL 将与您键入字符串*完全相同。**

 ** * *

## 回答 #3

> 赞同：30
> 
> 时间：2009-11-18T14:42:02.213

由于还没有人提到反射器...

如果编译以下 C# 代码：

```
static void Main(string[] args)
{
    var x = "hello";
    string y = "hello again!";
    Console.WriteLine(x);
    Console.WriteLine(y);
} 
```

然后在上面使用反射器，你会得到：

```
// Methods
private static void Main(string[] args)
{
    string x = "hello";
    string y = "hello again!";
    Console.WriteLine(x);
    Console.WriteLine(y);
} 
```

所以答案显然不会影响运行时性能！

* * *

## 回答 #4

> 赞同：17
> 
> 时间：2011-02-22T20:15:20.613

对于以下方法：

```
 private static void StringVsVarILOutput()
    {
        var string1 = new String(new char[9]);

        string string2 = new String(new char[9]);
    } 
```

IL 输出是这样的：

```
 {
          .method private hidebysig static void  StringVsVarILOutput() cil managed
          // Code size       28 (0x1c)
          .maxstack  2
          .locals init ([0] string string1,
                   [1] string string2)
          IL_0000:  nop
          IL_0001:  ldc.i4.s   9
          IL_0003:  newarr     [mscorlib]System.Char
          IL_0008:  newobj     instance void [mscorlib]System.String::.ctor(char[])
          IL_000d:  stloc.0
          IL_000e:  ldc.i4.s   9
          IL_0010:  newarr     [mscorlib]System.Char
          IL_0015:  newobj     instance void [mscorlib]System.String::.ctor(char[])
          IL_001a:  stloc.1
          IL_001b:  ret
        } // end of method Program::StringVsVarILOutput 
```

* * *

## 回答 #5

> 赞同：14
> 
> 时间：2008-12-10T17:23:28.943

C# 编译器在编译时推断`var`变量的真实类型。生成的 IL 没有区别。

* * *

## 回答 #6

> 赞同：14
> 
> 时间：2015-08-20T15:29:44.593

所以，要清楚，这是一种懒惰的编码风格。如果可以选择，我更喜欢原生类型；我将采取额外的“噪音”来确保我正在编写和阅读我认为我在代码/调试时的内容。*耸耸肩*

* * *

## 回答 #7

> 赞同：8
> 
> 时间：2008-12-10T17:30:41.113

我认为你没有正确理解你所读的内容。如果它被编译为正确的类型，那么就*没有*区别。当我这样做时：

```
var i = 42; 
```

编译器*知道*它是一个 int，并像我写的那样生成代码

```
int i = 42; 
```

正如您链接到的帖子所说，它被*编译*为相同的类型。这不是运行时检查或其他任何需要额外代码的东西。编译器只是弄清楚类型必须是什么，并使用它。

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2008-12-10T17:41:10.450

使用 var 没有运行时性能成本。不过，我怀疑编译器需要推断类型时会产生编译性能成本，尽管这很可能可以忽略不计。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2008-12-10T17:28:33.863

如果编译器可以进行自动类型推断，那么性能不会有任何问题。这两个都将生成相同的代码

```
var    x = new ClassA();
ClassA x = new ClassA(); 
```

但是，如果您正在动态构建类型（LINQ ...），那么`var`这是您唯一的问题，并且还有其他机制可以比较，以便说出什么是惩罚。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2014-07-21T01:55:18.803

我总是在网络文章或指南文章中使用 var 这个词。

在线文章的文本编辑器的宽度很小。

如果我写这个：

```
SomeCoolNameSpace.SomeCoolClassName.SomeCoolSubClassName coolClass = new SomeCoolNameSpace.SomeCoolClassName.SomeCoolSubClassName(); 
```

您会看到上面呈现的预代码文本太长并且开箱即用，它被隐藏了。读者需要向右滚动才能看到完整的语法。

这就是为什么我总是在网络文章中使用关键字 var。

```
var coolClass = new SomeCoolNameSpace.SomeCoolClassName.SomeCoolSubClassName(); 
```

整个渲染的预代码正好适合屏幕。

在实践中，对于声明对象，我很少使用var，我依靠intellisense来更快地声明对象。

例子：

```
SomeCoolNamespace.SomeCoolObject coolObject = new SomeCoolNamespace.SomeCoolObject(); 
```

但是，为了从方法返回对象，我使用 var 来更快地编写代码。

例子：

```
var coolObject = GetCoolObject(param1, param2); 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2016-04-01T20:17:50.503

“var”是人们喜欢或讨厌的事物之一（例如区域）。但是，与区域不同，在创建匿名类时 var 是绝对必要的。

对我来说，当你直接新建一个对象时， var 是有意义的，例如：

```
var dict = new Dictionary<string, string>(); 
```

话虽如此，您可以轻松地做到：

`Dictionary<string, string> dict =`new 和 intellisense 将在这里为您填写其余部分。

如果您只想使用特定接口，则不能使用 var ，除非您调用的方法直接返回该接口。

Resharper 似乎完全支持使用“var”，这可能会促使更多人这样做。但我有点同意，如果您正在调用一个方法，则更难阅读，而且名称返回的内容并不明显。

var 本身并不会减慢速度，但是有一个警告是很多人都没有想到的。如果你这样做`var result = SomeMethod();`了，那么之后的代码会期待某种结果，你会调用各种方法或属性或其他任何东西。如果`SomeMethod()`将其定义更改为其他类型，但仍符合其他代码所期望的约定，那么您只是创建了一个非常讨厌的错误（当然，如果没有单元/集成测试）。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2019-05-24T00:25:06.073

这取决于情况，如果你尝试使用，下面的代码。

该表达式被转换为“OBJECT”并大大降低了性能，但这是一个孤立的问题。

代码：

```
public class Fruta
{
    dynamic _instance;

    public Fruta(dynamic obj)
    {
        _instance = obj;
    }

    public dynamic GetInstance()
    {
        return _instance;
    }
}

public class Manga
{
    public int MyProperty { get; set; }
    public int MyProperty1 { get; set; }
    public int MyProperty2 { get; set; }
    public int MyProperty3 { get; set; }
}

public class Pera
{
    public int MyProperty { get; set; }
    public int MyProperty1 { get; set; }
    public int MyProperty2 { get; set; }
}

public class Executa
{
    public string Exec(int count, int value)
    {
        int x = 0;
        Random random = new Random();
        Stopwatch time = new Stopwatch();
        time.Start();

        while (x < count)
        {
            if (value == 0)
            {
                var obj = new Pera();
            }
            else if (value == 1)
            {
                Pera obj = new Pera();
            }
            else if (value == 2)
            {
                var obj = new Banana();
            }
            else if (value == 3)
            {
                var obj = (0 == random.Next(0, 1) ? new Fruta(new Manga()).GetInstance() : new Fruta(new Pera()).GetInstance());
            }
            else
            {
                Banana obj = new Banana();
            }

            x++;
        }

        time.Stop();
        return time.Elapsed.ToString();
    }

    public void ExecManga()
    {
        var obj = new Fruta(new Manga()).GetInstance();
        Manga obj2 = obj;
    }

    public void ExecPera()
    {
        var obj = new Fruta(new Pera()).GetInstance();
        Pera obj2 = obj;
    }
} 
```

以上结果与 ILSPY。

```
public string Exec(int count, int value)
{
    int x = 0;
    Random random = new Random();
    Stopwatch time = new Stopwatch();
    time.Start();

    for (; x < count; x++)
    {
        switch (value)
        {
            case 0:
                {
                    Pera obj5 = new Pera();
                    break;
                }
            case 1:
                {
                    Pera obj4 = new Pera();
                    break;
                }
            case 2:
                {
                    Banana obj3 = default(Banana);
                    break;
                }
            case 3:
                {
                    object obj2 = (random.Next(0, 1) == 0) ? new Fruta(new Manga()).GetInstance() : new Fruta(new Pera()).GetInstance();
                    break;
                }
            default:
                {
                    Banana obj = default(Banana);
                    break;
                }
        }
    }
time.Stop();
return time.Elapsed.ToString();
} 
```

如果您希望执行此代码，请使用下面的代码，并获取时间差。

```
 static void Main(string[] args)
    {
        Executa exec = new Executa();            
        int x = 0;
        int times = 4;
        int count = 100000000;
        int[] intanceType = new int[4] { 0, 1, 2, 3 };

        while(x < times)
        {                
            Parallel.For(0, intanceType.Length, (i) => {
                Console.WriteLine($"Tentativa:{x} Tipo de Instancia: {intanceType[i]} Tempo Execução: {exec.Exec(count, intanceType[i])}");
            });
            x++;
        }

        Console.ReadLine();
    } 
```

问候

# c# - 在 C# 中，如何调用返回包含字符串指针的非托管结构的 DLL 函数？

> ID：356851
> 
> 赞同：3
> 
> 时间：2008-12-10T17:21:04.050
> 
> 标签：c#, interop

我得到了一个 DLL（“InfoLookup.dll”），它在内部分配结构并从查找函数返回指向它们的指针。这些结构包含字符串指针：

```
extern "C"
{
   struct Info
   {
      int id;
      char* szName;
   };

   Info* LookupInfo( int id );
} 
```

在 C# 中，如何声明结构布局、声明 Interop 调用以及（假设返回非空值）利用字符串值？换句话说，我如何将以下内容翻译成 C#？

```
#include "InfoLookup.h"
void foo()
{
   Info* info = LookupInfo( 0 );
   if( info != 0 && info->szName != 0 )
      DoSomethingWith( info->szName );
   // NOTE: no cleanup here, the DLL is caching the lookup table internally
} 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-10T17:37:30.740

试试下面的布局。[使用PInvoke Interop Assistant](http://www.codeplex.com/clrinterop/Release/ProjectReleases.aspx?ReleaseId=14120)自动生成的代码。手工编码的 LookpInfoWrapper()

```
[System.Runtime.InteropServices.StructLayoutAttribute(System.Runtime.InteropServices.LayoutKind.Sequential)]
public struct Info {

    /// int
    public int id;

    /// char*
    [System.Runtime.InteropServices.MarshalAsAttribute(System.Runtime.InteropServices.UnmanagedType.LPStr)]
    public string szName;
}

public partial class NativeMethods {

    /// Return Type: Info*
    ///id: int
    [System.Runtime.InteropServices.DllImportAttribute("InfoLookup.dll", EntryPoint="LookupInfo")]
public static extern  System.IntPtr LookupInfo(int id) ;

    public static LoopInfoWrapper(int id) {
       IntPtr ptr = LookupInfo(id);
       return (Info)(Marshal.PtrToStructure(ptr, typeof(Info));
    }

} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-10T17:30:48.723

例如，请参阅此[netapi32.NetShareAdd](http://www.pinvoke.net/default.aspx/netapi32.NetShareAdd)互操作声明。它包括一个`SHARE_INFO_502`结构和一个`public string shi502_netname`成员。[Pinvoke.net](http://www.pinvoke.net/)上提供了更多示例。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-10T17:27:10.433

使用编组：

[http://www.csharphelp.com/archives/archive63.html](http://www.csharphelp.com/archives/archive63.html)

* * *

## 回答 #4

> 赞同：-2
> 
> 时间：2008-12-10T17:26:24.460

您还需要在 C# 中实现该结构，确保正确使用 Marshal 类中的属性，以确保内存布局与非托管版本匹配。

所以，这个的一些变化：

```
using System.Runtime.InteropServices;

[DllImport("mydll.dll")]
public static extern Info LookupInfo(int val);

[StructLayout(LayoutKind.Sequential)]
struct Info
{
   int id;
   String szName;
}

private void SomeFunction
{
   Info info = LookupInfo(0);
   //Note here that the returned struct cannot be null, so check the ID instead
   if (info.id != 0 && !String.IsNullOrEmpty(info.szName))
      DoSomethingWith(info.szName);
} 
```

# iphone - 如何横向显示一个 UIView？

> ID：356882
> 
> 赞同：12
> 
> 时间：2008-12-10T17:27:45.097
> 
> 标签：iphone, rotation

到目前为止，我已经查看了每个问题，但似乎没有人真正回答这个问题。

我创建了一个 UITabBarController 并向其中添加了几个视图控制器。大多数视图都是纵向查看的，但应该以横向查看。我不想使用加速度计或检测用户何时旋转设备，我只想在他们从底部的选项卡中选择视图时以横向模式显示视图。

我希望在他们选择该项目时发生常规动画，例如选项卡退出，视图旋转等，而当他们选择不同的视图时发生相反的情况。

是否没有内置属性或方法来告诉系统将视图显示为什么方向？

据我所知，覆盖 shouldautorotate... 方法绝对没有任何作用。

我不喜欢的答案类型是“RTFM”，因为我已经有了，到目前为止，为 iPhone 开发的任何人都知道 F-ing R 几乎没有有用的 M。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-12-10T17:34:17.593

论坛上的帖子可能会有所帮助[。](http://www.iphonedevsdk.com/forum/iphone-sdk-development/3219-force-landscape-mode-one-view-2.html)简短的回答是，一旦视图被绘制，您必须在 viewWillAppear: 方法中手动旋转视图或控制器

```
CGAffineTransform landscapeTransform = CGAffineTransformMakeRotation(degreesToRadian(90));
landscapeTransform = CGAffineTransformTranslate (landscapeTransform, +80.0, +100.0);

[[appDelegate navController].view setTransform:landscapeTransform]; 
```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-01-21T04:02:52.250

这是我正在做的事情：

首先，将此定义放在文件顶部，就在您的#imports 下方：

```
#define degreesToRadian(x) (M_PI * (x) / 180.0) 
```

然后，在 viewWillAppear: 方法中

```
[[UIApplication sharedApplication] setStatusBarHidden:YES animated:NO];     
if (self.interfaceOrientation == UIInterfaceOrientationPortrait) {  
    self.view.transform = CGAffineTransformIdentity;
    self.view.transform = CGAffineTransformMakeRotation(degreesToRadian(90));
    self.view.bounds = CGRectMake(0.0, 0.0, 480, 320);
} 
```

如果你想让它被动画化，那么你可以将整个东西包装在一个动画块中，如下所示：

```
[UIView beginAnimations:@"View Flip" context:nil];
[UIView setAnimationDuration:1.25];
[UIView setAnimationCurve:UIViewAnimationCurveEaseInOut];

[[UIApplication sharedApplication] setStatusBarHidden:YES animated:NO];     
if (self.interfaceOrientation == UIInterfaceOrientationPortrait) {  
    self.view.transform = CGAffineTransformIdentity;
    self.view.transform = CGAffineTransformMakeRotation(degreesToRadian(90));
    self.view.bounds = CGRectMake(0.0, 0.0, 480, 320);
}
[UIView commitAnimations]; 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-01-13T21:06:20.513

覆盖控制器类中的 Orientation 方法并强制它为 Landscape，如下所示：

```
- (BOOL)shouldAutorotateToInterfaceOrientation:(UIInterfaceOrientation)interfaceOrientation 
{
    // Overriden to allow any orientation.
    return UIInterfaceOrientationIsLandscape(interfaceOrientation);
} 
```

简单高效！

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-04-20T15:28:42.450

shouldAutorotateToInterfaceOrientation 仅在 tabbarcontroller 中的所有视图或 navigationcontroller 中的所有视图控制器都同意旋转时才有效。

# internet-explorer - 有什么办法可以改变windows中浏览器的任务栏图标吗？

> ID：356883
> 
> 赞同：2
> 
> 时间：2008-12-10T17:27:58.030
> 
> 标签：internet-explorer, firefox, browser, add-in, taskbar

有什么办法可以改变windows中浏览器的任务栏图标吗？

我打开了很多浏览器窗口，我喜欢按窗口对类似的网站（在标签中）进行分组。所以我想知道是否有一种方法可以为它们分配一个任务栏图标，以便您可以更轻松地区分它们。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-10T19:04:49.020

这是我在不到 5 分钟的时间内整理出来的，用于更改特定窗口上的图标。您可以轻松地使用此代码创建一个 Winform，该 Winform 将枚举当前打开的窗口并允许您为它们分配任意图标。（下面的 C# 代码）

```
[DllImport("user32.dll", CharSet=CharSet.Auto)]
public static extern IntPtr FindWindow(string strClassName, string strWindowName);

[DllImport("user32.dll",CharSet=CharSet.Auto)]  
private static extern int SendMessage(IntPtr hWnd, int wMsg, IntPtr wParam, IntPtr lParam); 

[DllImport("user32.dll")] 
public static extern int DrawMenuBar(int currentWindow);

const int WM_GETICON = 0x7F;
const int WM_SETICON = 0x80;
const int ICON_SMALL = 0; //16
const int ICON_BIG = 1; //32

public static void SetIcon()
{
    //Load an icon. This has to be a *.ico.
    System.Drawing.Icon i = new Icon("path\to\icon");
    //Find the target window. The caption must be entered exactly 
    //as it appears in the title bar
    IntPtr hwnd = FindWindow(null, "Caption of Target Window");
    //Set the icon
    SendMessage(hwnd, WM_SETICON, (IntPtr)ICON_SMALL, (IntPtr)i.Handle);
    //Update the title bar with the new icon. Note: the taskbar will
    //update without this, you only need this if you want the title
    //bar to also display the new icon
    DrawMenuBar((int)hwnd);
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-10T17:48:24.507

我相信任务栏使用嵌入在可执行文件中的图标资源。我尝试为 Internet Explorer 创建多个快捷方式，每个快捷方式都有一个唯一的快捷方式图标，但它们在任务栏上打开时都有相同的图标。

我认为您必须运行浏览器可执行文件的多个实例，并且每个实例都必须具有不同的嵌入式图标资源。

# iis - Specifying cfhttp referring IP address on shared server

> ID：356886
> 
> 赞同：0
> 
> 时间：2008-12-10T17:29:11.287
> 
> 标签：iis, coldfusion, windows-server-2008, payment-gateway, cfhttp

I'm using CFHTTP to post data to my payment gateway (Protx).

Protx requires that I whitelist the IP that will send this request.

I am hosted on a shared server running Windows 2008.

This morning, my hosting company assigned a new IP to this server for a customer who required an SSL certificate. Since then, my CFHTTP post appears to be coming from this new IP (which was not on the Protx whitelist).

My hosting company, being the worst imaginable, doesn't know why this is and aren't willing to look into it further.

Does anyone have any idea how I can specify which referring IP address CFHTTP will use to post data?

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-10T18:35:57.313

您本质上想要做的是欺骗您传递给 Protx 的 IP 地址。

这可以使用 cfhttparam 标签来完成。

```
<cfhttpparam type="header" name="host" value=""> 
```

前任。

```
<cfhttpparam type="header" name="host" value="10.1.1.1"> 
```

有关更多信息，请参阅[Nabble 帖子](http://www.nabble.com/Cfhttp...-Referer-question-td20564541.html)，还请查看cfhttpparam的[livedocs](http://livedocs.adobe.com/coldfusion/8/htmldocs/help.html?content=Tags_g-h_10.html#3989813)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-10T18:38:07.623

我不相信这是直接可能的。CF 将依赖底层操作系统来处理 TCP/IP 请求，因此操作系统将确定将用于请求的 IP。可以通过指定主机标头来欺骗 IP，但我不确定如何做到这一点或效果如何。

首先，我建议您让 Protx 将新 IP 列入白名单。

其次，如果您有可用的代理服务器，这可能会提供解决方案。CFHTTP 可以使用代理，您可以将代理的 IP 列入白名单。这样，无论 CFHTTP 在哪个 IP 上，Protx 服务器都会看到代理的地址。

# performance - 负载测试软件

> ID：356888
> 
> 赞同：5
> 
> 时间：2008-12-10T17:29:41.270
> 
> 标签：performance, testing, stress-testing

我正在为我的公司提出购买一些负载测试软件的建议。我必须给出 2 个选择。我建议的选择之一是 HP(Mecurary) Loadrunner。是否有其他程序可以与 Loadrunner 相媲美？我们正在研究使用该软件来测试以下性能。

C# .NET 模板

Microsoft® .NE​​T 2.0、3.0

Microsoft® SQL Server Informix

网页 (HTTP/HTML)

网页服务

网络和多媒体

无线应用协议 (WAP)

域名系统 (DNS)

Microsoft® Exchange (MAPI)

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-10T19:09:23.597

OpenSourceTesting.com 有一个[OSS 性能工具列表](http://www.opensourcetesting.org/performance.php)。

软件测试常见问题解答也有一个[商业和 OSS 性能测试工具列表](http://www.testingfaqs.org/t-load.html)。

由于您看起来像是在 Windows 平台上，因此您还可以使用以下工具：

*   Visual Studio [Application Center 测试](http://msdn.microsoft.com/en-us/library/aa287410.aspx)（仅限企业版？）
*   Microsoft [Web Application Stress](http://www.microsoft.com/downloads/details.aspx?familyid=e2c0585a-062a-439e-a67d-75a89aa36495&displaylang=en)工具（又名 WAS，又名“Homer”；Application Center Test 的前身）

那里有很多选择，但似乎您对自己的要求有很好的处理。我建议对您的首选产品进行贸易研究，使用加权标准和每种产品的得分排名（有点像自定义的“消费者报告”风格比较）。这将帮助您减少对产品的任何先入为主的观念，并为您的管理层提供一个合理的经验理由，说明您为什么选择您使用的工具。这可以在很大程度上证明大件物品的成本是合理的。

此外，对于商业工具，供应商通常会到现场并设置演示系统来测试您的代码。几年前，我们使用 Mercury、Rational 和 NuMega 做到了这一点。它确实有助于通过演示 BS 并准确了解产品如何与我们的应用程序一起使用。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-10T17:38:20.660

我们使用[JMeter](http://jakarta.apache.org/jmeter/)进行 HTTP 和 SOAP 负载测试

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-10T17:41:26.317

来自自动化 QA 的 TestComplete 也很受推崇：

[http://www.automatedqa.com](http://www.automatedqa.com)

该产品功能全面，您可以使用多种语言编写脚本，包括 C#。我会尝试 30 天试用，以及它与 LoadRunner 相比如何满足您的特定要求。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-10T18:42:46.693

我用过[openSTA](http://www.opensta.org/)。

这允许记录与网站的会话，然后通过相对简单的脚本语言进行回放。

您可以轻松地测试 Web 服务并编写自己的脚本。

它允许您以任何您想要的方式将脚本放在测试中，并配置迭代次数、每次迭代中的用户数、引入每个新用户的加速时间以及每次迭代之间的延迟。将来也可以安排测试。

它是开源和免费的。

它会生成许多报告，这些报告可以保存到电子表格中。然后，我们使用数据透视表轻松分析和绘制结果。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-04-28T07:59:49.343

我在之前的项目中使用过[WebLOAD](http://www.radview.com/) - 它与 LoadRunner 相当，但更具成本效益。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-04-29T12:25:21.777

如果您必须注意所有接口，那么您只会查看商业工具。商业领域中最接近的可比产品是 Microfocus 的 SilkPerformer 产品，但您的接口的广度可能会将您推回到 Loadrunner 领域，因为它确实拥有最多的开箱即用协议支持的任何工具。从企业销售的角度来看，这是其显着特征之一。

# reporting-services - 在 Reporting Services 中，表格详细信息未显示在预览中

> ID：356895
> 
> 赞同：0
> 
> 时间：2008-12-10T17:32:42.340
> 
> 标签：reporting-services

我在报告中放入了一个表格，第一列中有标签，第二列中有映射，但是当我单击预览（在 IDE 中）时，该表格没有显示。

“初始可见性”设置为“可见”。

我正在使用 VS 2005 Team Explorer Edition（从 Sql Server 2005 BI 打开）

这是一个示例 XML（代码），如果有帮助的话。

```
 <TableRow>
          <TableCells>
            <TableCell>
              <ReportItems>
                <Textbox Name="labelRID">
                  <Style>
                    <FontFamily>Times New Roman</FontFamily>
                    <FontSize>12pt</FontSize>
                    <TextAlign>Right</TextAlign>
                    <PaddingLeft>2pt</PaddingLeft>
                    <PaddingRight>2pt</PaddingRight>
                    <PaddingTop>2pt</PaddingTop>
                    <PaddingBottom>2pt</PaddingBottom>
                  </Style>
                  <ZIndex>7</ZIndex>
                  <CanGrow>true</CanGrow>
                  <Value>RID:</Value>
                </Textbox>
              </ReportItems>
            </TableCell>
            <TableCell>
              <ReportItems>
                <Textbox Name="textboxRID">
                  <Style>
                    <FontFamily>Times New Roman</FontFamily>
                    <FontSize>12pt</FontSize>
                    <TextAlign>Left</TextAlign>
                    <PaddingLeft>2pt</PaddingLeft>
                    <PaddingRight>2pt</PaddingRight>
                    <PaddingTop>2pt</PaddingTop>
                    <PaddingBottom>2pt</PaddingBottom>
                  </Style>
                  <ZIndex>6</ZIndex>
                  <CanGrow>true</CanGrow>
                  <Value>=Fields!rid.Value</Value>
                </Textbox>
              </ReportItems>
            </TableCell>
          </TableCells>
          <Height>0.25in</Height>
        </TableRow> 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-11T16:39:00.687

感谢微软的论坛，这是我的问题。

“选择表格并按‘F4’，您可以看到数据选项卡，因为您有一个名为 No Row 的属性，当数据集没有返回数据时，您可以打印文本。例如“无可用数据”。”

所以基本上，由于此时我没有数据通过（客户尚未提供任何数据），我的带有标签的表格将不会显示。

# web2py - 我可以在 Web2Py 中做到这一点吗？

> ID：356907
> 
> 赞同：5
> 
> 时间：2008-12-10T17:35:48.183
> 
> 标签：web2py

作为评估 Web2Py 的一种方式，我尝试在 Web2Py 中重新实现网页。开始似乎很简单，但我不确定它是否按我的想法工作。

我有一个简单的页面，其中包含一个输入字段和添加电子邮件地址的按钮。

它有一个链接到其他页面的菜单栏

它有几个可滚动的 DIV，其内容来自数据库。

要在 Web2Py 中实现这一点，我可以将操作链接到各种按钮和输入字段吗？从我对示例代码的快速浏览来看，所有输入请求似乎都是从我几乎无法控制格式的数据库表中驱动的

我确定我只是看错了，因为我来自 J2EE 背景，我只是需要将我的想法切换到不同的模式。

非常感谢任何帮助我朝正确方向前进的帮助。

肯

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-10T19:21:42.277

是的，你可以做到。自动生成的表单使用回发（自我提交），但这可以更改，此外，您可以使用自定义表单。

我建议将问题发布到 web2py 邮件列表，可能带有屏幕截图或示例 java 代码。我们将向您发送一个等效的 web2py。

# google-chrome - 小公司是否应该对其网站进行编码以支持 Chrome？

> ID：356908
> 
> 赞同：21
> 
> 时间：2008-12-10T17:35:48.183
> 
> 标签：google-chrome, cross-browser

我在晒黑沙龙之类的小网站上工作。我们不支持 IE 上特定于 ActiveX 的东西，我们支持 Firefox。我注意到 Chrome 有一些奇怪的行为。我的浏览器统计数据显示，<1% 的访问者使用 Chrome。

我听说人们说它远非同类最佳。但我喜欢一切都在自己的过程和东西中运行的方式。

Chrome 会变得足够流行以至于我需要为它编写代码吗？当它流行起来的时候，它奇怪的渲染会得到修复吗？

* * *

## 回答 #1

> 赞同：42
> 
> 时间：2008-12-10T17:42:18.687

首先根据标准编写代码，然后根据需要为不同的渲染引擎编写代码。永远不要为特定的浏览器设计网站，这是一个非常滑的斜坡。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2008-12-10T17:39:47.223

总体而言，这是改善对 WebKit 浏览器支持的一个很好的理由（您没有任何客户在 Mac 上使用 Safari 吗？）

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2008-12-10T17:39:14.980

Chrome 仍处于早期测试阶段，它的渲染并非没有错误，我在 Chrome 中也遇到了严重的 UI 问题。我确实计划在 Chrome 中运行我的网络应用程序，但我已决定在 Chrome 达到更成熟的水平之前不进行任何更改。

[谷歌最近表示，他们将很快将 Chrome 带入非 beta 状态](http://news.cnet.com/8301-17939_109-10120049-2.html)（不像他们过去将东西留在 beta 5 年左右的历史）。

此外，如果您计划在此 beta 状态下使用 Chrome 进行 webdev，您将需要[安装“开发者频道”](http://dev.chromium.org/getting-involved/dev-channel/)，它可以让您访问比公共版本更新的版本，这在浏览器的这个阶段非常重要。截至 2008 年 12 月 10 日，Chrome 的开发版本为 0.4.154.33

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2008-12-10T17:40:27.347

Chrome 使用 WebKit，一个相当标准的渲染引擎。Safari 也使用它，而且听起来 WebKit 并没有消失。如果您有必要的资源，我建议您考虑修复它。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-12-10T17:44:16.420

Jimmy 有一个很好的观点，Chrome 和 Safari 都基于 WebKit。如果它在 Chrome 上失败，很有可能它在 Safari、诺基亚 S60 浏览器和其他浏览器上也失败了。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-12-10T17:50:16.750

关键是使用语义正确和格式良好的标记来编写标准。使基本实现适用于大多数浏览器（尽可能多），并进行调整以处理其余浏览器。

编写为“最佳浏览”特定浏览器而定制的网站会使浏览器供应商无法努力实现标准合规性。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-12-10T17:50:53.333

如果您正在做 Javascript 工作并且这会导致浏览器之间存在明显差异，那么我肯定会推荐使用第三方框架，例如 jQuery，这样您就可以使用与浏览器无关的通用界面。但是，如果您的差异是由于页面上的 HTML/CSS 造成的，那么我总是会根据您网站的统计数据优先考虑最受欢迎的浏览器。如果<1% 正在使用 Chrome，那么我会认真考虑将时间花在其他任务上，而不是调查可能实际上是仍处于早期测试阶段的新浏览器存在的问题。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-12-10T17:40:47.283

可能还没有：Chrome 仍在快速变化，他们的目标是完全符合各种标准和测试。如果您现在尝试关注 Chrome，您可能会跟踪许多您最终想要扭转的微小变化。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-12-10T17:43:21.600

我会用 Chrome 测试页面。如果你做得很好，应该不会有那么多问题。

实际上，可以编写一种适用于所有浏览器的代码（好吧，也许不是 IE 6 或更早版本）；）

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-12-10T17:46:26.557

在我看来，这一切都取决于您的客户和他们的用户。我会检查你的博客，看看它是否占很大比例。

如果它变得重要，以至于您的客户可能会赔钱，我会与他们讨论，看看他们是否愿意支付额外费用以使您的网站与 Chrome 保持一致。

就我个人而言，在它持续达到至少 1% 之前，我不会担心它。即使那样，我仍然会先与您的客户讨论它。

另一方面，它很有可能在明年左右获得 5% 的市场份额。毕竟是谷歌。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-12-10T17:51:17.077

作为最终用户，如果某些网站不支持 Chrome，我会有点恼火：基本上，我开始忽略它，但在先写投诉之前不会。也就是说，有时可能是 Chrome 的错，而不是设计师的错。但是，我并不在乎是谁的错，因为我想要的只是页面正确呈现并按预期运行。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-12-10T17:56:34.413

我知道有几家大公司已经禁止使用 Chrome，直到它允许安装在 C 驱动器以外的地方。我猜想如果 Chrome 克服了这个问题以及其他地方提到的一些 UI 问题，它会变得非常流行。我认为您应该计划支持 Chrome。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2008-12-10T18:36:04.710

我个人与之合作的大型网络企业和小型网络企业都没有使用 Chrome。它不在他们的浏览器雷达上。其中一些较大的是大型电子商务。

因此，我不会将编码时间用于支持 Chrome。我确实出于研究和市场开发的目的而运行它。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2008-12-10T18:40:22.593

我从不编写代码来支持测试版产品。在您开始更改您的软件以支持它之前，请等待他们完成他们的软件。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2008-12-10T18:52:37.000

您应该根据您的*客户使用*的浏览器来定位浏览器。如果您的客户中有 80% 使用 IE，那么主要在 IE 上测试您的网站是明智的。如果您知道您的客户正在使用 FF，那么谨慎的做法是主要在 FF 上测试您的网站。

也就是说，谷歌浏览器的市场份额基本上是一个四舍五入的错误，所以不——我不会打扰。当然，除非您提前知道大量用户正在使用它。

（例如，对于我编写的一个 iphone 应用程序，我们发现我们的大多数用户都*从 iphone*浏览我们的网站——我知道，这绝对是惊人的，惊天动地的概念。因此，我们开始对我们的网站进行大部分测试iphone浏览器）

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2008-12-11T12:49:18.747

首先针对当前的标准，然后根据用户的骚动程度来确定优先级（如果你有一个非常大声的 1% 仍然是你的用户群中非常有声的 1%）

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2008-12-15T12:59:54.653

即使 Chrome 已退出测试版，对我来说仍处于测试版中。因为 Chrome 无法通过不透明度更改很好地显示 png24（我尝试在 png 图像上使用 jquery 进行淡入/淡出，并且在图像动画之前出现令人讨厌的白色闪光；您可以在[此处](http://claudiunenu.ro)看到问题）

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2008-12-10T17:50:35.003

我认为您不需要为 Chrome 编写任何特定的代码。如果他们说网络标准对他们很重要，那么 Chrome 最终会遵循这些标准。

我也不相信 Chrome 会变得非常流行。当我看到它时，我首先想到的是“哇……Mozilla 上面印有 G 字样。” 从那以后，我并没有真正印象深刻。

底线：您应该尝试使您的网站支持主流浏览器。歌剧，IE，火狐。通常，遵循 Web 标准和最佳实践将实现这一点。其他时候，您需要创建变通方案或强制浏览器以某种方式运行。IE Firefox 和 IE 使用不同的边框模型。您至少可以强制 FF 使用与 IE 相同的边框模型。

# c - c中的二分搜索优化？

> ID：356928
> 
> 赞同：0
> 
> 时间：2008-12-10T17:42:23.007
> 
> 标签：c, binary-search

我正在写一个键记录查找我在键和记录号之间有一个索引的位置。这是按键排序的。有没有比我在速度优化方面做得更好的方法？

```
typedef struct
{
    char key[MAX_KEYLEN];
    int  rec;
} KeyRecPair;

typedef struct
{
    KeyRecPair *map;
    int         numRecs;
} KeyRecMap;

int GetRecFromKey(char *key, KeyRecMap *theMap)
{
    int cmpValue, bottom = 0;
    int half = theMap->numRecs / 2;
    int top = theMap->numRecs - 1;

    while (bottom != top)
    {
        cmpValue = strncmp(key, theMap->map[half].key, MAX_KEY_LEN); 

        if (cmpValue > 0)
        {
            /*top stays*/
            bottom = half + 1;
            half  = bottom + (top - bottom) / 2;
            continue;
        }
        if (cmpValue < 0)
        {
            /*bottom stays*/
            top = half - 1;
            half  = bottom + (top - bottom) / 2;
            continue;
        }
        return theMap->map[half].rec;
    }

    if (0 == strncmp(key, theMap->map[half].key, MAX_KEY_LEN))
        return theMap->map[half].rec;
    return 0;
} 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-10T17:45:30.753

给定您实现的合适比较函数，[`bsearch`](http://www.opengroup.org/onlinepubs/007908799/xsh/bsearch.html)库函数对数组执行二进制搜索。作为一个库函数，它经过了很好的优化并且（希望）没有错误。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-11T19:35:18.380

您的大部分时间将花在 strncmp 上。

我建议强制将其[内联](http://en.wikipedia.org/wiki/Inlining)或重写内联，以避免函数调用过头。

如果您感到勇敢，则可以[展开循环](http://en.wikipedia.org/wiki/Loop_unwinding)一次或两次并看到性能提升。

如果您的字符串实际上是一个固定长度的 char 数组，您可以将长度设为 4 的倍数，并一次将 4 个字节与 unsigned int 比较，而不是一次比较 1 个字节。

如果你没有[profiler](http://en.wikipedia.org/wiki/Profiler_(computer_science))，你应该得到一个。Profiler 可以很容易地查看各种实现的相对成本是多少。

另一种选择是选择一种不同的方式来组织您的数据。查看[AVL 树](http://en.wikipedia.org/wiki/Avl_tree)以获取灵感。选择某种[散列](http://en.wikipedia.org/wiki/Hash_function)函数，就像提到的其他函数一样，可能是一个可行的选择

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-11T11:20:19.237

与其使用二分搜索来定位项目，哈希映射可能更合适，因为它具有 O(1) 查找特性。然而，这可能会因为使用天真的方法的碰撞负载而变慢。然而[，本文](http://www.google.com/url?sa=t&source=web&ct=res&cd=1&url=http%3A%2F%2Flamp.epfl.ch%2Fpapers%2Fidealhashtrees.pdf&ei=ZTICSdbuDpSa1wbTpPGvDg&usg=AFQjCNG3s5oYB13F1gBsOsH81nvst2rscg&sig2=yW5rBcQCYjCM8JNhmRYHVg)描述了一种创建类似树的哈希图的方法，该树具有 O(log(n) / log(32)) 访问时间，通常优于普通哈希图实现。（固定数组+链表实现）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-11T19:37:40.793

您有机会使用不是字符串的键吗？或者至少是最短的字符串？（MAX_KEYLEN 的值是多少）strcmp 循环的每次迭代可能是搜索速度较慢的部分之一。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-11T19:52:41.793

有没有理由要优化这个？您是否使用探查器运行程序并确定查找占总运行时间的很大一部分？你只是好奇你能多快得到它吗？（在我看来，两者都是很好的理由。）如果您只是随机优化它，请不要。

另外，请记住进行基准测试。在现代系统上很难判断两个版本的函数中哪一个更快（在我的 Z80 上更容易）。有多少缓存未命中可能比错误预测的分支数更重要，也可能不重要。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-11T10:26:44.307

我能想到的唯一可能的优化是在计算中使用类似于黄金分割率的东西，`half`而不是将剩余的子集分成元素数量相等的两半，即

```
 if (cmpValue > 0)
        {
                /*top stays*/
                bottom = half + 1;
                half = bottom + (top - bottom) * 3 / 5;
                continue;
        }
        if (cmpValue < 0)
        {
                /*bottom stays*/
                top = half - 1;
                half = bottom + (top - bottom) * 2 / 5;
                continue;
        } 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-11T10:59:00.607

而不是除以 2 U 可以利用位移运算符。

=> for /2 你可以使用 >> 1

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-11T11:13:27.817

既然每个循环都必须计算`half`一次，为什么不在使用它之前只做一次呢？这将减少两行看起来很复杂（至少相对而言）的代码。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-12-11T20:36:12.530

尽管我希望有一个体面的优化器为您执行此操作，但我会将 theMap->map 放入本地，以便它有一半的机会最终进入寄存器，而不是在每次访问时取消引用它。同样，我希望优化器为您执行此操作，因此您可能还想检查程序集输出。

我在发布时查看了 Visual Studio 2008 的输出，它在代码上做得非常好。例如，比较代码如下所示：

```
; 30   :         if (cmpValue > 0)
test    eax, eax
jle SHORT $LN11@GetRecFrom
; 31   :         {
; omitted inner block for > case.
$LN11@GetRecFrom:
; 37   :         if (cmpValue < 0)
jge SHORT $LN2@GetRecFrom 
```

基本上，它是一个分支到分支，无需重新测试 cmpValue。不错的触感。

将 theMap->map 放入本地有一点好处，但它很小。如果 MAX_KEY_LEN 不是 4 的好倍数并且没有填充结构，则绝对应该将 int 放在结构的首位。

# sql - 我可以在 SQL Server 中删除之前检查约束吗？

> ID：356929
> 
> 赞同：4
> 
> 时间：2008-12-10T17:42:24.287
> 
> 标签：sql, database, sql-server-2005, constraints

我有以下情况。一个主表和许多其他表通过外键链接在一起。现在，当我想删除主表中的一行时，会发生 ConstraintsViolation，这是有意且好的。

现在我希望能够在触发删除行事件之前检查 ConstraintsViolation 是否会发生。

这可能吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-11T12:04:32.797

这是一个表面上看起来很好，但有含义的问题。

首先，您需要确保在阅读了这些关系的状态后，没有人可以更改它们，因此显然您需要使用事务并锁定有问题的行。

然后，您需要一种方法来确定要检查的关系，正如我在此处的评论中看到的那样，您的问题是如果有人稍后添加新关系会发生什么。所以你需要查询模式，或者从模式中自动生成这段代码，这样检测机制只需要在每次更改模式时运行。

现在，在经历了这次磨难之后，你得到的例外真的看起来那么昂贵吗？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-10T17:45:20.817

```
If Exists ( Select * From OtherTable
            Where OtherTableFKColumn = MainTablePrimaryKey) 
   Begin
       Rollback Transaction
       RaisError('Violating FK Constraint in Table [OtherTable]', 16, 1)
   End 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-10T17:46:13.217

除了检查`COUNT(*)`每个相关表的之外？我不这么认为。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-11T11:51:40.233

一个丑陋的尝试是在事务中尝试删除，然后在成功时强制回滚。但这对我来说太脏了。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-11-27T18:18:11.843

我认为尝试这样的事情不是一个好主意，因为这意味着每个外键都必须检查两次：事先由您检查一次，然后在您执行 SQL 时由服务器再次检查。性能影响可能很严重。

但是，如果您下定决心这样做，最通用的方法是使用数据库的数据字典。我不熟悉 SQL Server 数据字典，但其他关系数据库将其所有元数据存储在您可以查询的数据库表中。您可以找到引用您的表的所有外键并动态构建查找相关行的查询。

# model-view-controller - 在游戏开发中，MVC中的控制器纯粹是为了处理用户输入吗？

> ID：356935
> 
> 赞同：3
> 
> 时间：2008-12-10T17:43:26.890
> 
> 标签：model-view-controller, controller

我读过这方面的矛盾。

来自维基百科：

> 控制器 处理和响应事件，通常是用户操作，并可能调用模型上的更改。

通常令人困惑的是这个词。如果不只是用户输入，那么还有什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-10T19:07:08.047

我将控制器视为*Coordinator*，我的大部分代码通常在控制器中。这是大多数分支发生的地方。在视图或模型中，您的大部分代码都将自己处理（数据对象对视图对象一无所知）。然而，控制器将数据对象（模型）与视图对象匹配，因此我认为它是*协调*器。

一个通用的“测试”可以应用于他们的应用程序，看看他们是否足够遵循 MVC：重新设计你的应用程序是否很容易？（在不重写一大堆代码的情况下交换视图）。

不要陷入所有围绕 MVC 的宗教辩论和严格的“规则”中，仅遵循 80% 的 MVC“规则”即可赚钱的产品比尚未完成且过于复杂而无法实际使用的产品要好向右跑……

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-10T17:47:51.967

不，在经典模式中，控制器可以从任何来源获取输入。对于基于 Web 的 MVC 框架，例如 Ruby/Rails 或 ASP.NET MVC，控制器从查询和表单参数中获取输入。

有关 MVC 的更多信息，请访问[http://en.wikipedia.org/wiki/Model-view-controller](http://en.wikipedia.org/wiki/Model-view-controller)

**编辑**：当我说来自任何来源的输入时，我正在考虑可能具有 GUI 和其他输入源接口的应用程序，例如与控制器交互以更新模型的传感器子系统。

**编辑**：根据您的更新，如果游戏是多人网络游戏，控制器可以响应网络事件。这些将不会由用户输入设备的控制器处理。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-10T17:53:09.663

控制器的职责是管理应用程序流。它处理请求，组合适当的模型/视图/帮助器，并可选择发出响应。

请求可以来自许多不同的来源，例如 Web 和本地服务、定时事件等等。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-10T17:48:48.970

我称验证和清理视图的用户输入部分。

我将控制器称为背后的逻辑，即获取经过验证、清理过的数据并使用它的部分。这样您就可以编写一个充当视图的测试工具，为控制器提供数据并测试结果。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-10T17:50:06.003

不，它应该用于模型和视图（UI 屏幕）之间的所有交互这包括从模型检索到的 UI 屏幕上的数据显示（更新屏幕），以及响应用户输入/交互用户界面屏幕...

它还可能包括由于该用户在 OTHER 屏幕上的操作或（在多用户并发系统中）其他用户对存储库（数据库）

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-10T17:52:04.783

不必要。控制器可以处理用户输入，更新您的模型，并可能决定直接返回 JSON 结果甚至动态生成的图像而不是视图页面。

控制器还可以决定页面流。用户单击您网站上的“我的帐户”链接但尚未登录，因此他们会被定向到登录页面。成功登录后，控制器可以决定是否通过 ReturnUrl 查询参数将它们重定向回“我的帐户”页面。

您也可以将验证逻辑放在您的控制器中，但我不建议将这种方法用于大型项目。该逻辑属于您的模型。

# objective-c - 为 10.5+ 编写代码时应该使用 Objective-C 垃圾收集吗？

> ID：356938
> 
> 赞同：11
> 
> 时间：2008-12-10T17:44:21.380
> 
> 标签：objective-c, memory-management, garbage-collection

在 OS X 10.5+ 环境中编写相当典型的 Mac 代码时，使用垃圾收集有哪些缺点？

到目前为止，我编写的所有其他内容要么与 10.4 兼容，要么在 iPhone 上，所以我对保留/发布已经相当满意，但现在我正在处理一个只有 10.5 的更大项目，我想知道是否有继续使用 Objective-C 2.0 垃圾收集器有什么缺点吗？

你们有什么感想？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-12-11T10:28:07.393

如果您正在编写新的 Cocoa 代码并针对 Mac OS X 10.5，请使用 Objective-C 垃圾回收。

如果您正在编写一些可能还需要在 iPhone 上运行的代码，您可以非常轻松地为这两个模型编写*和测试*该代码，方法是将该代码保存在一个单独的框架中，使用属性`-retain`和`-release`用途编写它，并设置您的框架和您的单元测试目标为*GC-supported*而不是*GC-only*。

Xcode 将运行你的单元测试包两次，一次开启 GC，一次关闭 GC，你的框架将在两种执行模型下都可用。然后，如果您最终想要将该模型级代码带到 iPhone 中，您可以将其放入一个针对 iPhone 的静态库中，或者将其直接包含在您的 iPhone 项目中。

不过，无论您是否考虑在 iPhone 上运行代码，如果您的应用程序需要 Leopard，则绝对应该以垃圾收集为目标。它将简化开发并且Objective-C 垃圾收集器执行得非常好。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-10T17:51:56.793

如果有可能将您的应用程序移植到 iPhone，您不应该使用它。

如果您有特殊用例，垃圾收集**可能会对性能产生不利影响。**没有 GC，您可以精确控制对象的销毁，而 GC 世界则不是这样。在大多数项目中，打开 GC 是值得的，因为它不易出错且更容易。

**理论上**，没有 GC 的内存管理总是比使用 GC 更快，但是，在大多数实际应用中并非如此（因为 GC 通常比人类更优化）。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-10T18:02:18.223

我更喜欢自己处理内存管理，仅仅是因为我喜欢拥有那种级别的控制权。我从其他语言 (C#) 的经验中知道，GC 不允许您完全忽略内存问题，这在 Cocoa 中也是一样的，例如弱引用和使用 (void *) 的回调，其中对象没有被明确拥有由另一个对象。您基本上是在用一组挑战（内存泄漏）换取另一组挑战。就我个人而言，这些天我不会犯太多的内存管理错误，而且我所犯的错误很容易追踪。

在某些情况下（例如为 NSOutlineView 实现数据源方法，您不想保留提供给大纲视图的对象）我认为 GC 会非常有用，但我没有做任何真正的测试呢。

[Apple 在GC 编程指南](http://developer.apple.com/documentation/Cocoa/Conceptual/GarbageCollection/Articles/gcAdoption.html#//apple_ref/doc/uid/TP40002457)中列出了其他一些优点和缺点。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2012-12-12T15:33:28.233

从 10.8 开始不推荐使用 GC。实际上，采用这项技术从来都不是一个好主意，除了啦啦队，因为性能和稳定性目标从未达到。

“手动”管理内存实际上非常简单，因为管理代码可以在很大程度上被分解出来。我的代码库中与内存管理相关的代码少于 1%，这比它需要的要大。所以我也对 ARC 持怀疑态度，因为它所解决的问题是如此之小，以至于即使是相当小的技术陷阱也让它变得不值得。

# c# - 将默认值和唯一约束、代码或 SQL 服务器放在哪里？

> ID：356939
> 
> 赞同：1
> 
> 时间：2008-12-10T17:44:21.897
> 
> 标签：c#, sql

我们正在设计一个新的数据库，我想在哪里放置一些东西，比如默认值。有3种情况：

1：新值，created_date 字段。插入时该列是否应该具有默认值？

2：更新值，updated_date 字段。我一直在考虑实现一个将其设置为 getdate() 的触发器，其他选项在代码中。

3: 带有 country_name 的国家表，我们应该直接在表上强制执行唯一约束还是确保代码执行此操作？

最后一点，但我们在每个表中也有一个 updated_by 和 created_by (int)，它们引用了用户表中的一个 user_id。是否值得努力实现这个 fk. 所有表的约束？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-10T17:53:46.137

我的最佳实践：

*   对于创建/上次更新日期，这取决于您是否要将它们用作业务逻辑的一部分——如果它们仅用于审计，请在数据库上使用时间戳。如果您可能希望将它们公开为业务属性，则应在代码中分配它们。

*   独特的约束——我在数据库和代码中都实现了它们。这是一个备份验证规则的数据库示例，在两个地方都定义它们并没有什么坏处。代码定义应该捕获并处理它们，但是如果代码无法捕获某些东西，您需要一个安全网，让约束防止数据被破坏。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-10T17:57:44.163

1.  **created_date, updated_date**：如果这些是纯粹的审计列，显示所做的更改以及由谁 - 触发器是合适的。如果您的数据模型依赖于这些（也许最后一个 updated_date 的记录被认为是当前的），那么您的应用程序应该这样做。然后，您的应用程序可以决定什么应该是最新的，而不是将其硬编码到架构中，即“根据服务器的当前时钟设置，它是最后插入的记录”。

2.  **国家表**：是的，使用唯一约束。没有它，您的数据（以及您的查询）将毫无意义……您将获得意外的连接匹配，并且您将无法强制执行参照完整性。然后，您的应用程序也可以可靠地依赖于它的唯一命名（例如，通过将它们存储在 SortedList 中）。

3.  **用户表的外键**是。如果一开始就值得保存数据，那么确保它是有效的也是值得的。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-10T17:57:58.700

约束必须至少进入数据库。如果您必须在代码中复制它们（或从数据库中推断它们）以提供更好的用户体验，那就这样吧。

数据库必须一致。我浪费了很多时间来追踪“无效数据”导致的问题。

这些可以通过添加适当的约束并修复创建无效数据的任何应用程序来解决。我宁愿有 10 张票，因为有人无法保存发票（易于追踪），而不是一张票，因为不知何故，由于发票数据错误，报告得到了一个奇怪的值。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-12-10T18:01:12.003

Put as much as possible in the database. You can still manipulate/view from your application if necessary, but this helps with both data integrity and future application versions (i.e., you won't have to replicate the logic for your 'web app' version down the road).

# c# - 域对象构造函数中的未知语法

> ID：356947
> 
> 赞同：0
> 
> 时间：2008-12-10T17:46:52.560
> 
> 标签：c#, design-patterns, oop, dns

有人可以帮我确定这种不明语法的目的是什么。这是该对象的构造函数中的一个额外的小东西。我想弄清楚类声明行末尾的“<IdT>”是什么？我认为这是我觉得有用的东西，我只需要了解为什么这么多人似乎这样做。

```
using BasicSample.Core.Utils;

namespace BasicSample.Core.Domain
{
    /// <summary>
    /// For a discussion of this object, see 
    /// http://devlicio.us/blogs/billy_mccafferty/archive/2007/04/25/using-equals-gethashcode-effectively.aspx
    /// </summary>
    public abstract class DomainObject<IdT>
    {
        /// <summary>
        /// ID may be of type string, int, custom type, etc.
        /// Setter is protected to allow unit tests to set this property via reflection and to allow 
        /// domain objects more flexibility in setting this for those objects with assigned IDs.
        /// </summary>
        public IdT ID {
            get { return id; }
            protected set { id = value; }
        } 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-10T17:53:59.990

阅读泛型： [MSDN](http://msdn.microsoft.com/en-us/library/512aeb7t.aspx)

这就是定义泛型类的方式。因此调用

```
new DomainObject<string>(); 
```

将创建一个具有字符串类型 ID 的域对象。

您定义 ID 的方式必须是 int。

它的定义方式 id 可以是您想要的任何类型。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-10T17:57:36.207

从 C# 规范：

> 声明为采用类型参数的类类型称为泛型类类型。结构、接口和委托类型也可以是通用的。使用泛型类时，必须为每个类型参数提供类型参数

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-10T18:03:38.067

在这种情况下，它允许 ID 属性采用各种值，而无需为每个 ID 属性类型定义一个类。例如，ID 可以是`int`、 或 或`long`，`Guid`具体取决于数据库中的基础数据类型。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-10T17:58:54.080

是的，我有点了解泛型是什么，使用过列表、委托等。我不明白的是，在类声明之后放置“<dataType>”会产生什么影响，以及为什么要这样做。如果我要声明这个对象，我会执行以下操作：

公共类 DomainObject { Public DomainObject(int ID) { this.ID = ID; } ....

# .net - 从 .NET 应用程序引用 Google 的 V8 引擎

> ID：356948
> 
> 赞同：35
> 
> 时间：2008-12-10T17:47:07.617
> 
> 标签：.net, javascript, interop, v8, serverside-javascript

我正在构建一个 .NET 3.5 应用程序，并且需要在服务器上评估 JS 代码 - 基本上是用户提供的可以在浏览器或服务器上工作的规则集。托管 JS 不是一个选项，因为 JS 代码将在运行时提供。Aptana 的 Jaxer 也不是一个选择。所以我正在考虑在我的应用程序中使用 V8 引擎的构建。

我成功地将源代码构建到 DLL 中，但该 DLL 不是托管库，也不是 COM。V8 只是普通的 C++。

关于如何在 C# 中与这种类型的 DLL 互操作的任何想法？此外，我对 SpiderMonkey 或其他 JS 引擎的其他建议持开放态度。

提前致谢。

**更新：**

我能够使用 Ryan 的解决方案。我刚刚更新了对来自主干的最新构建的引用。效果很好。谢谢瑞恩。

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2008-12-10T19:29:02.807

*我意识到这可能不是您问题的确切答案，但我想我会投入我的 2 美分，因为我怀疑很多人都尝试过这个。*

我通过使用混合模式 C++ 创建了一个托管包装器来使其工作。还有其他方法可以做到这一点，但我将尝试制作一个可以从任何 .NET 语言使用的完整包装器。

让 lib 以一种可以包含在混合模式项目中的方式进行编译是一个挑战。我必须修改用于 /MD 和 /MDd 的运行时库（在 SConstruct 文件中），以便它与 /clr 开关兼容。

到目前为止，我只运行了简单的脚本，因为我还没有实现回调、自定义方法、对象等。

这是我的一个测试应用程序的使用情况的快速示例：

```
V8DotNet.Shell shell = new V8DotNet.Shell();

shell.ExecuteScript(@"print('V8 version is: ' + version());"); 
```

它也可以运行更复杂的脚本，例如 base64 编码器。但现在我只能从 c++ 端添加自定义项。

如果有人感兴趣，我愿意提供更多信息+代码，因为我可能永远不会选择这个项目。但是，恐怕这里的帖子要写很多代码，所以我们必须找到其他媒体，比如 google code 或 codePlex。

**编辑：**

* * *

好的，我已经上传了代码。我必须对此发表免责声明：*该项目还很早，而且我充其量只是 C++ 的业余爱好者，所以不要抱太大希望。此外，该项目是在 chrome 发布后创建/完成的，因此包含的 v8 版本可能是旧的。*

也就是说，这里是：[http](http://ryanscook.com/Files/V8-DotNet.zip) ://ryanscook.com/Files/V8-DotNet.zip (21.5 MB)

在包中，您会发现以下感兴趣的项目：

> **V8Net-Library\V8.Net\V8.Net.sln -**这是具有托管 C++ 包装器项目和用于测试的 C# 控制台应用程序的解决方案。
> 
> **Dependencies\V8 -**这是我用来构建 V8 库的 V8 代码。

希望能帮助到你！

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2010-07-05T22:34:49.377

您可以尝试 Javascript .NET：

[http://javascriptdotnet.codeplex.com/](http://javascriptdotnet.codeplex.com/)

它允许您从 .NET 创建 V8 上下文并在其中注册 CLI 对象，以便您可以操作它们并从 Javascript 代码调用成员。它在运行时编译 Javascript。

看看这个。

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2010-06-30T02:54:44.673

查看[v8sharp](http://v8sharp.codeplex.com)。它支持在 .NET 应用程序中执行 JS。它还允许您使用 v8 引擎注册 .NET 类型，以便您的 JS 代码可以与您的 .NET 代码交互。我正在添加对挂钩函数/委托支持的支持。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-10T20:13:14.530

Microsoft[正在使用 DLR 在 CLR 上构建真正的 javascript - 而不是“JScript” - 运行时](http://blogs.msdn.com/hugunin/archive/2007/04/30/a-dynamic-language-runtime-dlr.aspx)（以及 IronPython、IronRuby 和 VB10），但我找不到任何下载或内容。也许这将与 C# 4 一起出现？

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2013-06-01T19:50:28.207

您也可以尝试 V8.NET。

[https://www.nuget.org/packages/V8.Net/](https://www.nuget.org/packages/V8.Net/)

它允许您在比许多其他包装器更低的级别轻松地将代码与 V8 集成。它还支持 .Net 4.6.1+ 和 .Net Standard 2.0+ (.Net Core)。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-10T19:48:16.530

从我听到的用 IJW（托管 C++）编译它应该可以工作 - 但我可能真的错了，我从未接触过 MC++。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2012-05-05T17:59:18.230

我猜 gatapia 已经用[jish](https://stackoverflow.com/a/6210086/966)取代了[js.net](https://github.com/gatapia/jish)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2018-07-22T19:31:33.143

死灵术。
根据 2018 和 .NET Core 2.0+
，您可以使用[vroomjs-core](https://github.com/pauldotknopf/vroomjs-core)

执行一些 Javascript：

```
using (var engine = new JsEngine())
{
    using (var context = engine.CreateContext())
    {
        var x = (double)context.Execute("3.14159+2.71828");
        Console.WriteLine(x);  // prints 5.85987
    }
} 
```

创建并返回一个 Javascript 对象，然后在其上调用一个方法：

```
using (JsEngine js = new JsEngine(4, 32))
{
    using (JsContext context = js.CreateContext())
    {
        // Create a global variable on the JS side.
        context.Execute("var x = {'answer':42, 'tellme':function (x) { return x+' '+this.answer; }}");
        // Get it and use "dynamic" to tell the compiler to use runtime binding.
        dynamic x = context.GetVariable("x");
        // Call the method and print the result. This will print:
        // "What is the answer to ...? 42"
        Console.WriteLine(x.tellme("What is the answer to ...?"));
    }
} 
```

从 Javascript 访问 CLR 对象的属性和调用方法：

```
class Test
{
    public int Value { get; set; }
    public void PrintValue(string msg)
    {
        Console.WriteLine(msg+" "+Value);
    }
}

using (JsEngine js = new JsEngine(4, 32))
{
    using (JsContext context = js.CreateContext())
    {
        context.SetVariable("m", new Test());
        // Sets the property from Javascript.
        context.Execute("m.Value = 42");
        // Call a method on the CLR object from Javascript. This prints:
        // "And the answer is (again!): 42"
        context.Execute("m.PrintValue('And the answer is (again!):')");
    }
} 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2020-12-04T15:05:06.927

由于这个问题是不久前发布的，我想我会提供一些更新。

微软制作了[ClearScript](https://github.com/microsoft/ClearScript)脚本引擎，支持 V8、JScript 和 VBScript。

您可以轻松添加控制台等 C# 类型并在脚本中使用它。添加 WPF 按钮类型并创建一个也没有问题。github 中有一些很好的例子，所以我建议任何阅读这篇文章的人快速浏览一下。

# c++ - 什么是 C++ 函子及其用途？

> ID：356950
> 
> 赞同：988
> 
> 时间：2008-12-10T17:47:21.077
> 
> 标签：c++, functor, function-object, function-call-operator

我一直听到很多关于 C++ 中的函子的信息。有人可以概述一下它们是什么以及它们在什么情况下有用吗？

* * *

## 回答 #1

> 赞同：1140
> 
> 时间：2008-12-10T17:58:35.843

函子几乎只是一个定义 operator() 的类。这使您可以创建“看起来像”函数的对象：

```
// this is a functor
struct add_x {
  add_x(int val) : x(val) {}  // Constructor
  int operator()(int y) const { return x + y; }

private:
  int x;
};

// Now you can use it like this:
add_x add42(42); // create an instance of the functor class
int i = add42(8); // and "call" it
assert(i == 50); // and it added 42 to its argument

std::vector<int> in; // assume this contains a bunch of values)
std::vector<int> out(in.size());
// Pass a functor to std::transform, which calls the functor on every element 
// in the input sequence, and stores the result to the output sequence
std::transform(in.begin(), in.end(), out.begin(), add_x(1)); 
assert(out[i] == in[i] + 1); // for all i 
```

关于函子有几件好事。一是与常规函数不同，它们可以包含状态。上面的例子创建了一个函数，它将 42 添加到你给它的任何东西上。但是这个值 42 不是硬编码的，它在我们创建仿函数实例时被指定为构造函数参数。我可以创建另一个加法器，它添加了 27，只需调用具有不同值的构造函数。这使得它们可以很好地定制。

正如最后几行所示，您经常将仿函数作为参数传递给其他函数，例如 std::transform 或其他标准库算法。您可以对常规函数指针执行相同的操作，除非如上所述，仿函数可以“自定义”，因为它们包含状态，使它们更加灵活（如果我想使用函数指针，我必须编写一个函数它的参数正好加了 1。函子是通用的，并且添加了你初始化它的任何东西），而且它们也可能更有效。在上面的例子中，编译器确切地知道`std::transform`应该调用哪个函数。它应该调用`add_x::operator()`. 这意味着它可以内联该函数调用。这使得它就像我在向量的每个值上手动调用函数一样高效。

如果我传递了一个函数指针，编译器不能立即看到它指向哪个函数，所以除非它执行一些相当复杂的全局优化，否则它必须在运行时取消引用指针，然后进行调用。

* * *

## 回答 #2

> 赞同：128
> 
> 时间：2008-12-10T19:15:42.303

一点补充。您可以使用[`boost::function`](http://www.boost.org/doc/libs/1_51_0/doc/html/boost/function.html), 从函数和方法创建仿函数，如下所示：

```
class Foo
{
public:
    void operator () (int i) { printf("Foo %d", i); }
};
void Bar(int i) { printf("Bar %d", i); }
Foo foo;
boost::function<void (int)> f(foo);//wrap functor
f(1);//prints "Foo 1"
boost::function<void (int)> b(&Bar);//wrap normal function
b(1);//prints "Bar 1" 
```

你可以使用 boost::bind 来给这个函子添加状态

```
boost::function<void ()> f1 = boost::bind(foo, 2);
f1();//no more argument, function argument stored in f1
//and this print "Foo 2" (:
//and normal function
boost::function<void ()> b1 = boost::bind(&Bar, 2);
b1();// print "Bar 2" 
```

最有用的是，使用 boost::bind 和 boost::function 你可以从类方法创建仿函数，实际上这是一个委托：

```
class SomeClass
{
    std::string state_;
public:
    SomeClass(const char* s) : state_(s) {}

    void method( std::string param )
    {
        std::cout << state_ << param << std::endl;
    }
};
SomeClass *inst = new SomeClass("Hi, i am ");
boost::function< void (std::string) > callback;
callback = boost::bind(&SomeClass::method, inst, _1);//create delegate
//_1 is a placeholder it holds plase for parameter
callback("useless");//prints "Hi, i am useless" 
```

您可以创建仿函数的列表或向量

```
std::list< boost::function<void (EventArg e)> > events;
//add some events
....
//call them
std::for_each(
        events.begin(), events.end(), 
        boost::bind( boost::apply<void>(), _1, e)); 
```

所有这些东西都有一个问题，编译器错误消息不是人类可读的:)

* * *

## 回答 #3

> 赞同：117
> 
> 时间：2008-12-10T17:58:28.950

Functor 是一个像函数一样工作的对象。基本上，一个定义`operator()`.

```
class MyFunctor
{
   public:
     int operator()(int x) { return x * 2;}
}

MyFunctor doubler;
int x = doubler(5); 
```

真正的优势是仿函数可以保持状态。

```
class Matcher
{
   int target;
   public:
     Matcher(int m) : target(m) {}
     bool operator()(int x) { return x == target;}
}

Matcher Is5(5);

if (Is5(n))    // same as if (n == 5)
{ ....} 
```

* * *

## 回答 #4

> 赞同：61
> 
> 时间：2009-11-21T16:59:01.823

早在 C++ 出现之前，“函子”这个名字就已经被传统地用于[范畴论了。](https://en.wikipedia.org/wiki/Functor)这与函子的 C++ 概念无关。最好使用名称**函数对象**而不是我们在 C++ 中所谓的“函子”。这就是其他编程语言调用类似结构的方式。

用于代替普通功能：

特征：

*   函数对象可能有状态
*   函数对象适合 OOP（它的行为与其他所有对象一样）。

缺点：

*   给程序带来了更多的复杂性。

* * *

用于代替函数指针：

特征：

*   函数对象通常可以内联

缺点：

*   函数对象在运行时不能与其他函数对象类型交换（至少除非它扩展了某些基类，因此会产生一些开销）

* * *

代替虚函数使用：

特征：

*   函数对象（非虚拟）不需要 vtable 和运行时调度，因此在大多数情况下它更有效

缺点：

*   函数对象在运行时不能与其他函数对象类型交换（至少除非它扩展了某些基类，因此会产生一些开销）

* * *

## 回答 #5

> 赞同：44
> 
> 时间：2008-12-10T18:10:16.617

就像其他人提到的那样，仿函数是一个像函数一样工作的对象，即它重载了函数调用运算符。

函子通常用于 STL 算法。它们很有用，因为它们可以在函数调用之前和之间保持状态，就像函数式语言中的闭包一样。例如，您可以定义一个`MultiplyBy`将其参数乘以指定数量的函子：

```
class MultiplyBy {
private:
    int factor;

public:
    MultiplyBy(int x) : factor(x) {
    }

    int operator () (int other) const {
        return factor * other;
    }
}; 
```

然后你可以将一个`MultiplyBy`对象传递给像 std::transform 这样的算法：

```
int array[5] = {1, 2, 3, 4, 5};
std::transform(array, array + 5, array, MultiplyBy(3));
// Now, array is {3, 6, 9, 12, 15} 
```

函子相对于指向函数的指针的另一个优点是在更多情况下可以内联调用。如果您将函数指针传递给`transform`，除非*该*调用被内联并且编译器知道您总是将相同的函数传递给它，否则它不能通过指针内联调用。

* * *

## 回答 #6

> 赞同：42
> 
> 时间：2013-01-04T20:06:56.653

对于我们中间像我这样的新手：经过一番研究，我弄清楚了 jalf 发布的代码做了什么。

仿函数是可以像函数一样“调用”的类或结构对象。这可以通过重载`() operator`. （`() operator`不确定它叫什么）可以接受任意数量的参数。其他运算符只取两个，即`+ operator`只能取两个值（运算符的每一侧一个）并返回您为其重载的任何值。您可以在 a`() operator`中放置任意数量的参数，这使其具有灵活性。

要创建一个仿函数，首先你要创建你的类。然后，您使用您选择的类型和名称的参数为该类创建一个构造函数。在同一个语句中，紧随其后的是一个初始化列表（它使用单个冒号运算符，我也是新手），它使用先前声明的构造函数参数构造类成员对象。然后`() operator`超载。最后，您声明您创建的类或结构的私有对象。

我的代码（我发现 jalf 的变量名令人困惑）

```
class myFunctor
{ 
    public:
        /* myFunctor is the constructor. parameterVar is the parameter passed to
           the constructor. : is the initializer list operator. myObject is the
           private member object of the myFunctor class. parameterVar is passed
           to the () operator which takes it and adds it to myObject in the
           overloaded () operator function. */
        myFunctor (int parameterVar) : myObject( parameterVar ) {}

        /* the "operator" word is a keyword which indicates this function is an 
           overloaded operator function. The () following this just tells the
           compiler that () is the operator being overloaded. Following that is
           the parameter for the overloaded operator. This parameter is actually
           the argument "parameterVar" passed by the constructor we just wrote.
           The last part of this statement is the overloaded operators body
           which adds the parameter passed to the member object. */
        int operator() (int myArgument) { return myObject + myArgument; }

    private: 
        int myObject; //Our private member object.
}; 
```

如果其中任何一个不准确或完全错误，请随时纠正我！

* * *

## 回答 #7

> 赞同：25
> 
> 时间：2013-05-06T05:47:47.547

仿函数是将函数应用于参数化（即模板化）类型[的高阶函数。](https://en.wikipedia.org/wiki/Higher-order_function)它是[map](https://en.wikipedia.org/wiki/Map_(higher-order_function)#Generalization)高阶函数的推广。例如，我们可以`std::vector`像这样定义一个仿函数：

```
template<class F, class T, class U=decltype(std::declval<F>()(std::declval<T>()))>
std::vector<U> fmap(F f, const std::vector<T>& vec)
{
    std::vector<U> result;
    std::transform(vec.begin(), vec.end(), std::back_inserter(result), f);
    return result;
} 
```

当给定一个接受 a 并返回 a 的函数时，此函数接受 a`std::vector<T>`并返回。函子不必在容器类型上定义，它也可以为任何模板类型定义，包括：`std::vector<U>``F``T``U``std::shared_ptr`

```
template<class F, class T, class U=decltype(std::declval<F>()(std::declval<T>()))>
std::shared_ptr<U> fmap(F f, const std::shared_ptr<T>& p)
{
    if (p == nullptr) return nullptr;
    else return std::shared_ptr<U>(new U(f(*p)));
} 
```

这是一个将类型转换为 a 的简单示例`double`：

```
double to_double(int x)
{
    return x;
}

std::shared_ptr<int> i(new int(3));
std::shared_ptr<double> d = fmap(to_double, i);

std::vector<int> is = { 1, 2, 3 };
std::vector<double> ds = fmap(to_double, is); 
```

函子应该遵循两条定律。第一个是恒等律，它规定如果给函子一个恒等函数，它应该与将恒等函数应用于类型相同，即`fmap(identity, x)`应该与 相同`identity(x)`：

```
struct identity_f
{
    template<class T>
    T operator()(T x) const
    {
        return x;
    }
};
identity_f identity = {};

std::vector<int> is = { 1, 2, 3 };
// These two statements should be equivalent.
// is1 should equal is2
std::vector<int> is1 = fmap(identity, is);
std::vector<int> is2 = identity(is); 
```

下一个定律是合成定律，它规定如果给定函子一个由两个函数组成的函数，则它应该与将函子应用于第一个函数然后再应用于第二个函数相同。所以，`fmap(std::bind(f, std::bind(g, _1)), x)`应该是一样的`fmap(f, fmap(g, x))`：

```
double to_double(int x)
{
    return x;
}

struct foo
{
    double x;
};

foo to_foo(double x)
{
    foo r;
    r.x = x;
    return r;
}

std::vector<int> is = { 1, 2, 3 };
// These two statements should be equivalent.
// is1 should equal is2
std::vector<foo> is1 = fmap(std::bind(to_foo, std::bind(to_double, _1)), is);
std::vector<foo> is2 = fmap(to_foo, fmap(to_double, is)); 
```

* * *

## 回答 #8

> 赞同：9
> 
> 时间：2011-12-26T06:54:56.320

这是我被迫使用 Functor 解决问题的实际情况：

我有一组函数（比如说，其中 20 个），它们都是相同的，除了每个函数在 3 个特定位置调用不同的特定函数。

这是令人难以置信的浪费和代码重复。通常我只会传入一个函数指针，然后在 3 个位置调用它。（所以代码只需要出现一次，而不是二十次。）

但后来我意识到，在每种情况下，特定功能都需要完全不同的参数配置文件！有时 2 个参数，有时 5 个参数，等等。

另一种解决方案是拥有一个基类，其中特定函数是派生类中的重写方法。但是我真的想构建所有这些继承，只是为了我可以传递一个函数指针？？？？

解决方案：所以我所做的是，我创建了一个包装类（“Functor”），它能够调用我需要调用的任何函数。我提前设置了它（使用它的参数等），然后我将它而不是函数指针传递给它。现在被调用的代码可以触发 Functor，而不知道里面发生了什么。它甚至可以多次调用它（我需要它调用 3 次。）

* * *

就是这样——一个实际的例子，Functor 被证明是显而易见且简单的解决方案，它使我能够将代码重复从 20 个函数减少到 1 个。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2011-10-06T04:44:10.793

在 gtkmm 中使用函子将一些 GUI 按钮连接到实际的 C++ 函数或方法。

* * *

如果您使用 pthread 库使您的应用程序成为多线程的，Functors 可以为您提供帮助。
要启动一个线程，参数之一`pthread_create(..)`是要在他自己的线程上执行的函数指针。
但是有一个不便之处。此指针不能是指向方法的指针，除非它是**静态方法**，或者除非您**指定它是类**，例如`class::method`. 还有一件事，你方法的接口只能是：

```
void* method(void* something) 
```

所以你不能（以一种简单明显的方式）在一个线程中运行你的类中的方法而不做额外的事情。

在 C++ 中处理线程的一个非常好的方法是创建自己的`Thread`类。如果您想从`MyClass`类中运行方法，我所做的是将这些方法转换为`Functor`派生类。

此外，`Thread`该类具有此方法： `static void* startThread(void* arg)`
指向此方法的指针将用作 call 的参数`pthread_create(..)`。在 arg中`startThread(..)`应该接收的是对任何派生类`void*`的堆中实例的强制转换引用，该引用将在执行时被强制转换，然后调用它的方法。`Functor``Functor*``run()`

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2012-03-07T07:03:17.387

除了在回调中使用外，C++ 仿函数还可以帮助提供对**矩阵** 类的**Matlab**喜欢的访问方式。有一个[例子](http://www.learncpp.com/cpp-tutorial/99-overloading-the-parenthesis-operator/)。

 *** * *

## 回答 #11

> 赞同：3
> 
> 时间：2014-02-08T05:26:50.577

就像已经重复的那样，函子是可以被视为函数的类（重载运算符（））。

它们对于您需要将某些数据与对函数的重复或延迟调用相关联的情况最有用。

例如，函子的链表可用于实现基本的低开销同步协程系统、任务分派器或可中断的文件解析。例子：

```
/* prints "this is a very simple and poorly used task queue" */
class Functor
{
public:
    std::string output;
    Functor(const std::string& out): output(out){}
    operator()() const
    {
        std::cout << output << " ";
    }
};

int main(int argc, char **argv)
{
    std::list<Functor> taskQueue;
    taskQueue.push_back(Functor("this"));
    taskQueue.push_back(Functor("is a"));
    taskQueue.push_back(Functor("very simple"));
    taskQueue.push_back(Functor("and poorly used"));
    taskQueue.push_back(Functor("task queue"));
    for(std::list<Functor>::iterator it = taskQueue.begin();
        it != taskQueue.end(); ++it)
    {
        *it();
    }
    return 0;
}

/* prints the value stored in "i", then asks you if you want to increment it */
int i;
bool should_increment;
int doSomeWork()
{
    std::cout << "i = " << i << std::endl;
    std::cout << "increment? (enter the number 1 to increment, 0 otherwise" << std::endl;
    std::cin >> should_increment;
    return 2;
}
void doSensitiveWork()
{
     ++i;
     should_increment = false;
}
class BaseCoroutine
{
public:
    BaseCoroutine(int stat): status(stat), waiting(false){}
    void operator()(){ status = perform(); }
    int getStatus() const { return status; }
protected:
    int status;
    bool waiting;
    virtual int perform() = 0;
    bool await_status(BaseCoroutine& other, int stat, int change)
    {
        if(!waiting)
        {
            waiting = true;
        }
        if(other.getStatus() == stat)
        {
            status = change;
            waiting = false;
        }
        return !waiting;
    }
}

class MyCoroutine1: public BaseCoroutine
{
public:
    MyCoroutine1(BaseCoroutine& other): BaseCoroutine(1), partner(other){}
protected:
    BaseCoroutine& partner;
    virtual int perform()
    {
        if(getStatus() == 1)
            return doSomeWork();
        if(getStatus() == 2)
        {
            if(await_status(partner, 1))
                return 1;
            else if(i == 100)
                return 0;
            else
                return 2;
        }
    }
};

class MyCoroutine2: public BaseCoroutine
{
public:
    MyCoroutine2(bool& work_signal): BaseCoroutine(1), ready(work_signal) {}
protected:
    bool& work_signal;
    virtual int perform()
    {
        if(i == 100)
            return 0;
        if(work_signal)
        {
            doSensitiveWork();
            return 2;
        }
        return 1;
    }
};

int main()
{
     std::list<BaseCoroutine* > coroutineList;
     MyCoroutine2 *incrementer = new MyCoroutine2(should_increment);
     MyCoroutine1 *printer = new MyCoroutine1(incrementer);

     while(coroutineList.size())
     {
         for(std::list<BaseCoroutine *>::iterator it = coroutineList.begin();
             it != coroutineList.end(); ++it)
         {
             *it();
             if(*it.getStatus() == 0)
             {
                 coroutineList.erase(it);
             }
         }
     }
     delete printer;
     delete incrementer;
     return 0;
} 
```

当然，这些例子本身并没有那么有用。它们只展示了仿函数如何有用，仿函数本身非常基本且不灵活，这使得它们不如 boost 提供的有用。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2013-01-28T06:50:37.297

另外，我使用函数对象将现有的遗留方法适应命令模式；（唯一让我感受到OO范式真正OCP之美的地方）；还在这里添加了相关的功能适配器模式。

假设您的方法具有签名：

```
int CTask::ThreeParameterTask(int par1, int par2, int par3) 
```

我们将看到如何使它适合命令模式——为此，首先，您必须编写一个成员函数适配器，以便可以将其作为函数对象调用。

注意 - 这很丑，可能你可以使用 Boost 绑定助手等，但如果你不能或不想，这是一种方法。

```
// a template class for converting a member function of the type int        function(int,int,int)
//to be called as a function object
template<typename _Ret,typename _Class,typename _arg1,typename _arg2,typename _arg3>
class mem_fun3_t
{
  public:
explicit mem_fun3_t(_Ret (_Class::*_Pm)(_arg1,_arg2,_arg3))
    :m_Ptr(_Pm) //okay here we store the member function pointer for later use
    {}

//this operator call comes from the bind method
_Ret operator()(_Class *_P, _arg1 arg1, _arg2 arg2, _arg3 arg3) const
{
    return ((_P->*m_Ptr)(arg1,arg2,arg3));
}
private:
_Ret (_Class::*m_Ptr)(_arg1,_arg2,_arg3);// method pointer signature
}; 
```

此外，我们需要`mem_fun3`上述类的辅助方法来帮助调用。

```
template<typename _Ret,typename _Class,typename _arg1,typename _arg2,typename _arg3>
mem_fun3_t<_Ret,_Class,_arg1,_arg2,_arg3> mem_fun3 ( _Ret (_Class::*_Pm)          (_arg1,_arg2,_arg3) )
{
  return (mem_fun3_t<_Ret,_Class,_arg1,_arg2,_arg3>(_Pm));
} 
```

现在，为了绑定参数，我们必须编写一个绑定函数。所以，这里是：

```
template<typename _Func,typename _Ptr,typename _arg1,typename _arg2,typename _arg3>
class binder3
{
public:
//This is the constructor that does the binding part
binder3(_Func fn,_Ptr ptr,_arg1 i,_arg2 j,_arg3 k)
    :m_ptr(ptr),m_fn(fn),m1(i),m2(j),m3(k){}

 //and this is the function object 
 void operator()() const
 {
        m_fn(m_ptr,m1,m2,m3);//that calls the operator
    }
private:
    _Ptr m_ptr;
    _Func m_fn;
    _arg1 m1; _arg2 m2; _arg3 m3;
}; 
```

并且，一个使用 binder3 类的辅助函数 - `bind3`：

```
//a helper function to call binder3
template <typename _Func, typename _P1,typename _arg1,typename _arg2,typename _arg3>
binder3<_Func, _P1, _arg1, _arg2, _arg3> bind3(_Func func, _P1 p1,_arg1 i,_arg2 j,_arg3 k)
{
    return binder3<_Func, _P1, _arg1, _arg2, _arg3> (func, p1,i,j,k);
} 
```

现在，我们必须将它与 Command 类一起使用；使用以下类型定义：

```
typedef binder3<mem_fun3_t<int,T,int,int,int> ,T* ,int,int,int> F3;
//and change the signature of the ctor
//just to illustrate the usage with a method signature taking more than one parameter
explicit Command(T* pObj,F3* p_method,long timeout,const char* key,
long priority = PRIO_NORMAL ):
m_objptr(pObj),m_timeout(timeout),m_key(key),m_value(priority),method1(0),method0(0),
method(0)
{
    method3 = p_method;
} 
```

这是你如何称呼它的：

```
F3 f3 = PluginThreadPool::bind3( PluginThreadPool::mem_fun3( 
      &CTask::ThreeParameterTask), task1,2122,23 ); 
```

注意：`f3();`将调用方法`task1->ThreeParameterTask(21,22,23);`。

此模式的完整上下文在以下[链接](http://www.codeproject.com/Articles/26078/A-C-Plug-in-ThreadPool-Design)

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2017-01-15T10:51:57.317

将函数实现为函子的一大优势是它们可以在调用之间维护和重用状态。例如，许多动态规划算法，如用于计算字符串之间的[Levenshtein 距离的](https://en.wikipedia.org/wiki/Levenshtein_distance)[Wagner-Fischer 算法](https://en.wikipedia.org/wiki/Wagner%E2%80%93Fischer_algorithm)，都是通过填写一个大的结果表来工作的。每次调用函数时都分配这张表是非常低效的，所以将函数实现为仿函数并将表设为成员变量可以大大提高性能。

下面是一个将 Wagner-Fischer 算法实现为函子的示例。注意表是如何在构造函数中分配的，然后在 中重用`operator()`，并根据需要调整大小。

```
#include <string>
#include <vector>
#include <algorithm>

template <typename T>
T min3(const T& a, const T& b, const T& c)
{
   return std::min(std::min(a, b), c);
}

class levenshtein_distance 
{
    mutable std::vector<std::vector<unsigned int> > matrix_;

public:
    explicit levenshtein_distance(size_t initial_size = 8)
        : matrix_(initial_size, std::vector<unsigned int>(initial_size))
    {
    }

    unsigned int operator()(const std::string& s, const std::string& t) const
    {
        const size_t m = s.size();
        const size_t n = t.size();
        // The distance between a string and the empty string is the string's length
        if (m == 0) {
            return n;
        }
        if (n == 0) {
            return m;
        }
        // Size the matrix as necessary
        if (matrix_.size() < m + 1) {
            matrix_.resize(m + 1, matrix_[0]);
        }
        if (matrix_[0].size() < n + 1) {
            for (auto& mat : matrix_) {
                mat.resize(n + 1);
            }
        }
        // The top row and left column are prefixes that can be reached by
        // insertions and deletions alone
        unsigned int i, j;
        for (i = 1;  i <= m; ++i) {
            matrix_[i][0] = i;
        }
        for (j = 1; j <= n; ++j) {
            matrix_[0][j] = j;
        }
        // Fill in the rest of the matrix
        for (j = 1; j <= n; ++j) {
            for (i = 1; i <= m; ++i) {
                unsigned int substitution_cost = s[i - 1] == t[j - 1] ? 0 : 1;
                matrix_[i][j] =
                    min3(matrix_[i - 1][j] + 1,                 // Deletion
                    matrix_[i][j - 1] + 1,                      // Insertion
                    matrix_[i - 1][j - 1] + substitution_cost); // Substitution
            }
        }
        return matrix_[m][n];
    }
}; 
```

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2014-02-20T03:08:47.930

Functor 还可用于模拟在函数中定义局部函数。参考 [问题](https://stackoverflow.com/questions/9772446/c-local-class-as-functor)和[另一个](https://stackoverflow.com/questions/21794275/why-i-cannot-pass-a-functor-defined-in-a-function-to-another-function)。

但是本地函子不能访问外部自动变量。lambda (C++11) 函数是更好的解决方案。

# java - Java窗口缓冲击键直到用户用鼠标点击

> ID：356957
> 
> 赞同：1
> 
> 时间：2008-12-10T17:50:08.857
> 
> 标签：java, swing

这是基本思想：

有一个 java 窗口（主）打开另一个 java 窗口（子）。创建子窗口时，初始化的一部分将焦点设置在子窗口的相应文本字段中：

```
childTextField.requestFocusInWindow();
childTextField.setCaretPosition(0); 
```

孩子通常通过命令行类型的界面通过一系列击键打开。当请求窗口时，90% 的时间，焦点正确地转到子窗口文本字段，用户可以在框中键入。如果打开子窗口的命令被发送（按下回车键）并且用户在新窗口创建之前立即开始输入，则文本被正确缓冲并在窗口打开后出现在新文本字段中。

但是，每隔一段时间，当用户请求打开子窗口然后开始输入时，他们的文本不会出现在文本字段中。只有在他们用鼠标在字段中单击后，他们输入的文本才会出现。就好像它被存储在某个地方，直到他们点击才出来。

真正令人沮丧的是，我似乎根本无法可靠地重现该问题。它肯定会发生，但不足以很好地调试。

当然，幕后还有各种其他的魔力，包括与服务器应用程序的通信，但我不相信它是相关的。

任何想法或想法将不胜感激。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-10T18:08:17.120

I had an issue similar to this. try adding this after your `init()`

```
EventQueue.invokeLater(new Runnable() {
    public void run() {
        childtextfield.requestFocus();
        childTextField.setCaretPosition(0);
    }
}); 
```

It's worked for me.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-10T17:56:24.553

乍一看，这听起来可能是实现中的错误；键应该与鼠标事件在同一个事件队列中。不过可能还有另一个问题：事件队列在与程序主程序分开的线程中运行；在不知道应用程序的其余部分发生了什么的情况下，很容易怀疑事件队列线程是否以某种方式被阻塞。

实际上，您在复制它时遇到的困难使这种声音更有可能发生。

调试该案例将需要一些技巧和技巧。如果您使用的是 Solaris 10 或 OS/X，我建议您使用 dtrace；您可以轻松地将跟踪点放在事件队列上。否则，您可能希望有另一个线程定期在事件队列中删除某些内容。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-10T18:04:29.220

The event queue thread being blocked sounds VERY likely. Unfortunately I'm on windows, so no dtrace for me, but I'm definitely going to explore that more thoroughly.

Of course anybody else who might have other ideas would be very welcome.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-10T18:55:16.870

It turns out the answer wasn't all that interesting. After you mentioned the event queue, I dug into the code a bit more. It turns out the application has a custom keyboard focus manager in place. It would do things like buffer the text typed while waiting for a child window to open. In the code to open the child window, it calls a function (via a listener) that flushes the buffer and thus displays it to the screen. In that 10% or less of the time, that doesn't happen. However the same flush function is also attached to mouse clicks that happen inside of text fields. So, you guessed it, it didn't flush with the opening of the window, but did when the mouse was clicked.

Thanks for the help...even though it wasn't exactly what the solution was, it definitely pointed me in the right direction. Now I just have to figure out why the flush function isn't always getting called when the window opens...

# algorithm - 绘制立体二维多边形的好算法？

> ID：356968
> 
> 赞同：6
> 
> 时间：2008-12-10T17:52:15.967
> 
> 标签：algorithm, 2d, polygons

在内存中绘制纯色（如以单一纯色——无纹理映射）2D 多边形的最简单（也是最简单的，虽然这是主观的）算法是什么？最有效的方法是什么？

我对使用 GPU 或任何渲染方法不感兴趣，因为我的程序的输出不会出现在屏幕上。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-10T18:15:33.627

[多边形填充教学工具](http://www.cs.rit.edu/~icss571/filling/index.html)将向您展示一个非常好的、简单的算法，用于绘制任何复杂的填充多边形。

我已经为嵌入式图形实现了它，它实际上是一个简洁（而且有趣！）的算法。

-亚当

# vb.net - VB.net：没有时间的日期

> ID：356972
> 
> 赞同：18
> 
> 时间：2008-12-10T17:54:09.380
> 
> 标签：vb.net, formatting

你如何将日期时间格式化为日期？

例如，这是我从数据库中检索到的：12/31/2008 12:00:00 AM，但我只想显示日期而不显示时间。

* * *

## 回答 #1

> 赞同：36
> 
> 时间：2008-12-10T17:56:22.027

要么使用仅指定日期的[标准日期和时间格式字符串](http://msdn.microsoft.com/en-us/library/az4se3k1.aspx)之一（例如“D”或“d”），要么使用仅使用日期部分的[自定义日期和时间格式字符串](http://msdn.microsoft.com/en-us/library/8kb3ddd4.aspx)（例如“yyyy/MM/dd” ）。

* * *

## 回答 #2

> 赞同：32
> 
> 时间：2008-12-10T17:58:49.650

FormatDateTime（现在，DateFormat.ShortDate）

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2008-12-10T19:47:58.933

我几乎总是使用标准格式 ShortDateString，因为我希望用户能够控制日期的实际输出。

## **代码**

```
 Dim d As DateTime = Now
   Debug.WriteLine(d.ToLongDateString)
   Debug.WriteLine(d.ToShortDateString)
   Debug.WriteLine(d.ToString("d"))
   Debug.WriteLine(d.ToString("yyyy-MM-dd")) 
```

## **结果**

```
Wednesday, December 10, 2008
12/10/2008
12/10/2008
2008-12-10 
```

请注意，这些结果会因计算机上的文化设置而异。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2017-06-16T21:46:50.160

将日期时间格式化为短日期字符串并转换回日期

```
CDate(YourDate.ToString("d")) 
```

或使用短日期字符串

```
CDate(YourDate.ToShortDateString) 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-10T18:17:36.617

或者，如果由于某种原因您不喜欢任何更明智的答案，只需丢弃该空间右侧（包括）的所有内容。

# .net - 托管 C++ 中未解析的令牌

> ID：356974
> 
> 赞同：3
> 
> 时间：2008-12-10T17:54:59.067
> 
> 标签：.net, .net-2.0, polymorphism, managed-c++

我手上有一个谜。我正在尝试学习来自 C# 背景的托管 C++，但遇到了障碍。如果我的项目包含两个类，一个基类**Soup**和一个派生类**TomatoSoup**，我将其编译为静态库 (.lib)，我会在**Soup**中的虚拟方法上获得未解析的标记。这是代码：

* * *

## Abstracts.proj

**汤.h**

```
namespace Abstracts
{
    public ref class Soup abstract
    {
    public:
        virtual void heat(int Degrees);
    };
} 
```

**番茄汤.h**

```
#include "Soup.h"

namespace Abstracts
{
    public ref class TomatoSoup : Abstracts::Soup
    {
    public:
        virtual void heat(int Degrees) override;
    };
} 
```

**番茄汤.cpp**

```
#include "TomatoSoup.h"

void Abstracts::TomatoSoup::heat(int Degrees)
{
    System::Console::WriteLine("Soup's on.");
} 
```

## 主项目

**主文件**

```
#include "TomatoSoup.h"

using namespace System;

int main(array<System::String ^> ^args)
{
    Abstracts::TomatoSoup^ ts = gcnew Abstracts::TomatoSoup();

    return 0;
} 
```

* * *

**我在Main.proj**上收到此链接时错误：

```
1>Main.obj : error LNK2020: unresolved token (06000001) Abstracts.Soup::heat 
```

1.  我试过设置

    ```
    virtual void heat(int Degrees)=0; 
    ```

2.  我尝试在基类中实现热量

    ```
    virtual void heat(int Degrees){} 
    ```

    并将未引用的形式参数警告视为错误。

3.  我已经在 Soup 类上尝试了 1 和 2 有和没有 abstract 关键字

这个问题让我发疯了，我希望能防止它在未来让其他开发人员发疯。

**更新：**当在头文件中实现 TomatoSoup::heat 时，这与 Greg Hewgill 的参数名称注释方法一起使用，但是当我将实现移动到 TomatoSoup.cpp 时错误又回来了。我已经修改了问题以反映这一点。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-10T18:01:43.310

您收到的错误（LNK2020）意味着链接器无法在`Abstracts.Soup::heat`任何地方找到该函数的定义。当您将函数声明为`virtual void heat(int Degrees);`链接器时，将期望在某处找到定义的函数体。

如果您不打算提供函数体，并要求子类最终覆盖该函数，则应按照解决方案 1 中的指示进行操作：

```
virtual void heat(int Degrees) = 0; 
```

这告诉编译器你不会实现这个函数。当你这样做时会发生什么？

另外，参考您的第二个解决方案：

```
virtual void heat(int Degrees) {} 
```

编译器告诉您您没有在函数中引用 Degrees 参数。在 C++ 中避免此警告的一种方法是不给参数命名：

```
virtual void heat(int /*Degrees*/) {} 
```

`= 0`不过，提供一个空实现与纯 virtual ( ) 声明有点不同。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-10T23:21:45.320

我认为这个错误可能是因为我试图将 Abstracts.proj 构建为静态库。当我将其更改为 .DLL 时，一切正常。

我已经看到静态库不支持托管代码，但没有任何官方支持。有没有人有一个很好的参考说明这一点？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-10T18:15:14.813

我没有太多 CLI 经验，但我认为您应该使用 public 继承：

公共参考类番茄汤：**公共**摘要：：汤

# ms-access - 在文件名中使用用户定义的参数

> ID：356980
> 
> 赞同：2
> 
> 时间：2008-12-10T17:56:35.227
> 
> 标签：ms-access, vba

我有一个以 Excel 格式输出报告的 Access 数据库。

该报告取决于用户选择的日期参数。此参数通过具有弹出日历的文本框 (text100) 选择。

我想在文件名的文本框（text100）中使用日期。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-10T18:16:42.860

您必须负责要求参数。我喜欢使用可以通过全局函数获取/设置的全局参数——这样它们可以在任何地方设置，并且查询也可以访问它们。

**只需要模块中的几个子/功能：**

```
Some Module

Dim vParam1 as variant
Dim vParam1 as variant

Public Sub ParameterSet(byval pParamName as String, byval pParamValue as variant)

Select Case pParamName 
  Case "Param1": vParam1 = pParamValue 
  Case "Param2": vParam2 = pParamValue 
  Case Else
    msgbox pParamName & " parameter not defined"
End Select

End Sub

Public Function ParameterGet(byval pParamName as String) as variant

Select Case pParamName 
  Case "Param1": ParamGet = vParam1 
  Case "Param2": ParamGet = vParam2 
  Case Else
    msgbox pParamName & " parameter not defined"
End Select

End Sub 
```

**然后在您的查询中**（删除日期参数）

```
WHERE Field1 = ParameterGet("Param1") 
```

**然后在您运行导出的代码中**

```
Private Sub Export_Click()

  dim vParam1 as variant

  vParam1 = inputbox("Enter the parameter:")

  ParameterSet "param1", vParam1

  Transferspreadsheet blah, blah, FileName:= vParam1 & ".xls"

End Sub 
```

显然，这段代码需要稍微调整才能编译... :-)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-17T15:00:24.317

对我来说很明显你想从文件名中解析出日期，然后使用这个日期来执行查询......如果这不是你想要的，请重新制定问题。

我认为最后一部分非常明显：将字符串转换日期与查询字符串的其余部分连接起来，然后将其提交给执行。

不太明显的部分是解析。您需要定义文件名格式。是吗：

*   “OUTDATA-YYYYMMDD”
*   “输出数据 _YY _MM _DD”
*   “DD _MM _YYY _OUTDATA”
*   或者是其他东西？

我们需要知道标记的相对位置（年、月、日和普通文件名）。

假设“YYYY_ MM_ DD_ OUTDATA.DAT”，这里有一个想法......

```
function toQueryDate(aFileName as String) as Date
Dim theQueryDate as Date
Dim theParsedDate as String

theParsedDate=Mid(aFileName,1,4)+"/"+Mid(aFileName,6,2)+"/"+Mid(aFileName,9,2)
'IMPROVE:there's no error checking here.... we could see if the individual tokens are numbers

On Error Resume Next
theQueryDate=Cdate(theParsedDate)
If err.number then
   Msgbox "Bad filename: "+aFilename
   End 'or something else less fatal 
Endif

'we should be OK so:
toQueryDate=theParsedDate
End function 
```

# .net - 如何在 ASP.NET MVC 中重定向到动态登录 URL

> ID：356982
> 
> 赞同：96
> 
> 时间：2008-12-10T17:57:05.130
> 
> 标签：.net, asp.net-mvc, authentication, forms-authentication, asp.net-routing

我正在创建一个为客户托管页面的多租户网站。URL 的第一段将是一个标识客户端的字符串，在 Global.asax 中使用以下 URL 路由方案定义：

```
"{client}/{controller}/{action}/{id}" 
```

这可以正常工作，使用 /foo/Home/Index 等 URL。

但是，当使用 [Authorize] 属性时，我想重定向到也使用相同映射方案的登录页面。因此，如果客户端是 foo，则登录页面将是 /foo/Account/Login 而不是 web.config 中定义的固定 /Account/Login 重定向。

MVC 使用 HttpUnauthorizedResult 返回 401 未授权状态，我认为这会导致 ASP.NET 重定向到 web.config 中定义的页面。

那么有人知道如何覆盖 ASP.NET 登录重定向行为吗？还是通过创建自定义授权属性在 MVC 中重定向会更好？

**编辑 - 回答：**在深入研究 .Net 源代码后，我决定自定义身份验证属性是最佳解决方案：

```
public class ClientAuthorizeAttribute: AuthorizeAttribute
{
    public override void OnAuthorization( AuthorizationContext filterContext )
    {
        base.OnAuthorization( filterContext );

        if (filterContext.Cancel && filterContext.Result is HttpUnauthorizedResult )
        {
            filterContext.Result = new RedirectToRouteResult(
                new RouteValueDictionary
                {
                    { "client", filterContext.RouteData.Values[ "client" ] },
                    { "controller", "Account" },
                    { "action", "Login" },
                    { "ReturnUrl", filterContext.HttpContext.Request.RawUrl }
                });
        }
    }
} 
```

* * *

## 回答 #1

> 赞同：41
> 
> 时间：2009-07-08T13:38:18.740

在 RTM 版本的 ASP.NET MVC 中，缺少 Cancel 属性。此代码适用于 ASP.NET MVC RTM：

```
using System;
using System.Web;
using System.Web.Mvc;
using System.Web.Mvc.Resources;

namespace ePegasus.Web.ActionFilters
{
    public class CustomAuthorize : AuthorizeAttribute
    {
        public override void OnAuthorization(AuthorizationContext filterContext)
        {
            base.OnAuthorization(filterContext);
            if (filterContext.Result is HttpUnauthorizedResult)
            {
                filterContext.Result = new RedirectToRouteResult(
                    new System.Web.Routing.RouteValueDictionary
                        {
                                { "langCode", filterContext.RouteData.Values[ "langCode" ] },
                                { "controller", "Account" },
                                { "action", "Login" },
                                { "ReturnUrl", filterContext.HttpContext.Request.RawUrl }
                        });
            }
        }
    }
} 
```

* * *

**编辑：**您可能希望禁用 web.config 中的默认表单身份验证 loginUrl - 以防有人忘记您有自定义属性并错误地使用了内置的 [Authorize] 属性。

修改 web.config 中的值：

```
 <forms loginUrl="~/Account/ERROR" timeout="2880" /> 
```

然后创建一个操作方法“错误”，记录错误并将用户重定向到您拥有的最通用的登录页面。

* * *

## 回答 #2

> 赞同：30
> 
> 时间：2008-12-11T06:16:22.987

我认为主要问题是，如果您要搭载内置的 ASP.NET FormsAuthentication 类（并且没有充分的理由不应该这样做），那么一天结束时会调用`FormsAuthentication.RedirectToLoginPage()`正在发生的事情查看一个配置的 URL。永远只有一个登录 URL，这就是他们设计的方式。

我对这个问题的尝试（可能是 Rube Goldberg 的实现）是让它重定向到所有客户端共享的根目录下的单个登录页面，比如 /account/login。这个登录页面实际上不会显示任何内容；它检查 ReturnUrl 参数或我在会话中获得的某个值或标识客户端的 cookie，并使用它来发出立即 302 重定向到特定的 /client/account/login 页面。这是一个额外的重定向，但可能不会引人注意，它允许您使用内置的重定向机制。

另一种选择是在描述时创建自己的自定义属性，并避免调用类`RedirectToLoginPage()`上的方法的任何内容`FormsAuthentication`，因为您将用自己的重定向逻辑替换它。（您可以创建自己的类似类。）由于它是一个静态类，我不知道有任何机制可以注入您自己的替代接口并让它与现有的 [Authorize] 属性一起神奇地工作，它打击，但[人们以前也做过类似的事情](http://www.codeproject.com/KB/web-security/PartialAuthentication.aspx)。

希望有帮助！

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-07-16T15:35:26.610

我对这个问题的解决方案是一个自定义`ActionResult`类：

```
 sealed public class RequiresLoginResult : ActionResult
    {
        override public void ExecuteResult (ControllerContext context)
        {
            var response = context.HttpContext.Response;

            var url = FormsAuthentication.LoginUrl;
            if (!string.IsNullOrWhiteSpace (url))
                url += "?returnUrl=" + HttpUtility.UrlEncode (ReturnUrl);

            response.Clear ();
            response.StatusCode = 302;
            response.RedirectLocation = url;
        }

        public RequiresLoginResult (string returnUrl = null)
        {
            ReturnUrl = returnUrl;
        }

        string ReturnUrl { get; set; }
    } 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2019-02-08T07:56:17.260

尽管如此，如果决定使用内置的 ASP.NET FormsAuthentication，则可以`Application_AuthenticateRequest`按`Global.asax.cs`如下方式覆盖：

```
protected void Application_AuthenticateRequest(object sender, EventArgs e)
{
    string url = Request.RawUrl;

    if (url.Contains(("Account/Login"))
    {
        return;
    }

    if (Context.User == null)
    {
        // Your custom tenant-aware logic
        if (url.StartsWith("/foo"))
        {
            // Your custom login page.
            Response.Redirect("/foo/Account/Login");
            Response.End();
            return;
        }
    }
} 
```

# jquery - 如何克隆 jQuery Listen 插件事件？

> ID：356990
> 
> 赞同：1
> 
> 时间：2008-12-10T17:58:13.320
> 
> 标签：jquery, jquery-plugins, clone, listen

我的页面上有一些`<tr>`元素，其中一个`click()`事件附加到每个元素内部的图像上。我使用此代码

```
$(this).clone(true).appendTo("table#foo"); 
```

执行以下操作：

*   将那些 s 复制`<tr>`到不同的表中
*   保留`<tr>`s 内图像上的点击事件（由于`true`参数）

所有这些工作正常。现在我为这些 s 添加了一个[jQuery Listen](http://plugins.jquery.com/project/Listen)事件`<tr>`，这样用户就不必精确瞄准：他/她可以单击 s 上的任意位置`<tr>`，我可以将单击传递给图像。

它的编码如下：

```
$('tr.record').listen('click','td',function(){
  $(this).parent().find("img.clickable").click();
}); 
```

listen() 事件在原始项目上运行良好，但**在克隆项目上，listen() 事件失败。**图像的点击事件仍然可以正常工作。

这是 Firebug 告诉我的：

```
m(this, e.type) is undefined 
```

...它引用了 jquery.listen-1.0.3-min.js 的第 9 行。

**如何使 listen() 事件对克隆的元素起作用？**

## 更新

默认情况下，jQuery 不会在克隆元素上复制事件，但[这个插件](http://plugins.jquery.com/project/copyEvents)就是为此而生的。

同时，listen() 插件的作者提出了不同的策略 - 请参阅下面的答案。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-13T22:59:58.907

Listen() 插件的创建者 Ariel Flesler 通过电子邮件给了我这个建议：

*“我认为这可以通过另一种方式解决。Listen（和事件委托）的想法实际上是避免为新元素复制所有事件。”*

*“你可以简单地做：”*

```
$('table#foo').listen('click','td',function(){
 $(this).parent().find("img.clickable").click();
}); 
```

*“甚至：”*

```
$.listen('click','td',function(){
 $(this).parent().find("img.clickable").click();
}); 
```

*“第一个示例将使用表作为侦听器。在第二个示例中，使用 `<html>`标签。因此，无论您添加新的 td/tr/tables。它仍然可以工作。”*

# objective-c - MVC 和可可绑定最佳实践问题

> ID：356997
> 
> 赞同：5
> 
> 时间：2008-12-10T17:58:58.060
> 
> 标签：objective-c, cocoa, model-view-controller, cocoa-bindings

假设我有一个视图 myView、一个视图控制器 myViewController 和某种模型对象 myModel。此外，假设模型有两个符合 KVO 的属性，`arrayOfPeopleNames`和`arrayOfAnimalKinds`（都是 NSStrings）。

在我看来，我希望将两个弹出窗口绑定到这两个数组的内容。

我的问题是，如果 myController 有对 myModel 的引用，并且下拉列表绑定到 myViewController，那么按照以下方式设置 keypath 是一种好习惯`myModel.arrayOfPeopleNames`吗？

或者我是否需要在 myViewController 中设置一个额外的 NSArray 来镜像 myModel 中的那个并绑定到该键路径？

从实现的角度来看，前者似乎要简单得多（我不必使控制器数组镜像模型数组），但我想知道它是否将模型暴露给视图。

意见？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-10T18:12:19.763

您不应该在控制器中镜像模型的阵列。尽管在一个非常简单的情况下我不会太担心直接绑定到模型的数组，但您也可以将 UI 对象绑定到管理模型数组的 NSArrayController。这将提供模型和 UI 之间的分离，更重要的是处理诸如排序、选择、添加和删除对象等任务。

我可以通过担心 KVO 和绑定违反“纯”模型视图控制器设计来了解您的来源，但这不是您应该担心的事情。即使 KVO 通知直接从模型传递到视图，设置和更改视图和模型之间的连接仍然是控制器的责任（仅在这种情况下它是通过 IB 完成的）。例如，您不希望模型对象获得对视图的引用，并将其自身绑定到 UI，这将是控制器的职责。

作为要避免的另一个示例，请考虑您的模型是否具有“动物 ID”数组而不是名称。您可能希望创建一个值转换器或格式化程序来进行转换，而不是创建一种方法来将模型中的动物 ID 转换为人类可读的动物名称。这允许您保持模型和视图之间的分离级别。

还要记住，设计模式的目的是降低编写问题解决方案的复杂性，而不是增加它。您会发现这正是 Cocoa 的工作方式，尽管它可能并不总是遵循最严格的模式定义。******************************