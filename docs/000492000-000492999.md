# StackOverflow 问答 000492000-000492999

# c# - C# 转换十六进制值

> ID：492005
> 
> 赞同：1
> 
> 时间：2009-01-29T15:18:34.533
> 
> 标签：c#, hex

我正在从交换邮箱读取分配权限的列表，这些值是通过 AccessFlag 属性返回的，该属性以十六进制返回 20001，看起来 2000 代表 READ 权限，1 代表 FULL 权限。

我想要做的是将该值显示为 READ & FULL 权限集。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-29T15:27:36.903

如果你想作为一个字符串，你需要一个枚举。

所以如果你有这样的事情：

```
[Flags]
enum Permissions
{
  Read = 0x20000,
  Full = 0x00001
} 
```

然后你可以转换你的返回值并使用 ToString()

```
string val = ((Permissions )myValue).ToString(); 
```

它会出现这样的结果：

```
Read, Full 
```

请注意，Flags 属性对于这种类型的枚举很重要。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-29T15:31:50.700

老实说，我不确定你在问什么。

如果您有来自 AccessFlag 的值，并且您想查看它是否具有这些标志中的任何一个，您可以使用按位，例如

```
If((accessFlag & 0x2000) != 0) // It has FULL
If((accessFlag & 0x1) != 0) // It has READ
If((accessFlag & 0x2001) != 0) // It has READ AND FULL 
```

这是你要找的吗？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-29T15:21:38.943

您可以使用按位 XOR 运算符过滤掉您需要的值并从中推断出权限集。

# php - 如何开始用 C++ 编写 PHP5 扩展

> ID：492014
> 
> 赞同：20
> 
> 时间：2009-01-29T15:19:48.823
> 
> 标签：php, c++, gcc, php-extension

我正在编写一个 PHP5 扩展，虽然我可以用 C 编写它，但使用 C++ 并利用 STL 和 Boost 会更容易。

麻烦的是，我看到的[教程](http://devzone.zend.com/node/view/id/1021)只处理 C，我正在寻找一个使用 C++ 的基本示例

这是我到目前为止所尝试的：

### 配置.m4

```
[ --enable-hello   Enable Hello World support])

if test "$PHP_HELLO" = "yes"; then
  AC_DEFINE(HAVE_HELLO, 1, [Whether you have Hello World])
  PHP_NEW_EXTENSION(hello, hello.cpp, $ext_shared)
fi 
```

### php_hello.h

请注意我尝试将 PHP 接口的位声明为 extern "C"

```
#ifndef PHP_HELLO_H
#define PHP_HELLO_H 1

extern "C" {

#define PHP_HELLO_WORLD_VERSION "1.0"
#define PHP_HELLO_WORLD_EXTNAME "hello"

PHP_FUNCTION(hello_world);

extern zend_module_entry hello_module_entry;
#define phpext_hello_ptr &hello_module_entry

}
#endif 
```

### 你好.cpp

```
#ifdef HAVE_CONFIG_H
#include "config.h"
#endif

#include "php.h"
#include "php_hello.h"

static function_entry hello_functions[] = {
    PHP_FE(hello_world, NULL)

    {NULL, NULL, NULL}
};

zend_module_entry hello_module_entry = {
#if ZEND_MODULE_API_NO >= 20010901
    STANDARD_MODULE_HEADER,
#endif
    PHP_HELLO_WORLD_EXTNAME,
    hello_functions,
    NULL,
    NULL,
    NULL,
    NULL,
    NULL,
#if ZEND_MODULE_API_NO >= 20010901
    PHP_HELLO_WORLD_VERSION,
#endif
    STANDARD_MODULE_PROPERTIES
};

#ifdef COMPILE_DL_HELLO
ZEND_GET_MODULE(hello)
#endif

PHP_FUNCTION(hello_world)
{
    RETURN_STRING("Hello World", 1);
} 
```

### ....这是我的构建错误：

如果我 phpize、configure 和 make 这个，我得到以下（为了清晰起见重新格式化）

```
$ make
/bin/bash /home/paul/php5/php-5.2.8/ext/hello2/libtool 
   --mode=compile  
   -I. 
   -I/home/paul/php5/php-5.2.8/ext/hello2 -DPHP_ATOM_INC 
   -I/home/paul/php5/php-5.2.8/ext/hello2/include 
   -I/home/paul/php5/php-5.2.8/ext/hello2/main 
   -I/home/paul/php5/php-5.2.8/ext/hello2 
   -I/usr/local/include/php 
   -I/usr/local/include/php/main 
   -I/usr/local/include/php/TSRM 
   -I/usr/local/include/php/Zend 
   -I/usr/local/include/php/ext 
   -I/usr/local/include/php/ext/date/lib  
   -DHAVE_CONFIG_H     
   -c /home/paul/php5/php-5.2.8/ext/hello2/hello.cpp 
   -o hello.lo 
libtool: compile: unrecognized option `-I.'
libtool: compile: Try `libtool --help' for more information.
make: *** [hello.lo] Error 1 
```

我怀疑我需要对 config.m4 做更多的工作才能创建一个有效的 makefile，但我对 GCC 工具链还很陌生。

如果有帮助，我只针对 php 5.2.6+，并且只针对 Linux（特别是 Ubuntu 8.04）。我的构建环境是使用 Ubuntu 8.10，使用 gcc 4.3.2

收到指点，感激不尽！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-29T16:36:15.547

发布后，我遇到了[CodeGen_PECL](http://php-baustelle.de/CodeGen_PECL/manual.html)，它从基于 XML 的扩展描述中创建了一个骨架扩展。这包括一个标签让它输出 C++

除了确保头文件使用 extern "C" 之外，生成的 cpp 文件还确保 ZEND_GET_MODULE(hello) 也在 extern "C" 块内。

正如预期的那样，最大的不同在于 m4 文件，它看起来像这样：

```
dnl
dnl $ Id: $
dnl

PHP_ARG_ENABLE(hello, whether to enable hello functions,
[  --enable-hello         Enable hello support])

if test "$PHP_HELLO" != "no"; then
  PHP_REQUIRE_CXX
  AC_LANG_CPLUSPLUS
  PHP_ADD_LIBRARY(stdc++,,HELLO_SHARED_LIBADD)
  export OLD_CPPFLAGS="$CPPFLAGS"
  export CPPFLAGS="$CPPFLAGS $INCLUDES -DHAVE_HELLO"

  AC_MSG_CHECKING(PHP version)
  AC_TRY_COMPILE([#include <php_version.h>], [
#if PHP_VERSION_ID < 40000
#error  this extension requires at least PHP version 4.0.0
#endif
],
[AC_MSG_RESULT(ok)],
[AC_MSG_ERROR([need at least PHP 4.0.0])])

  export CPPFLAGS="$OLD_CPPFLAGS"

  PHP_SUBST(HELLO_SHARED_LIBADD)
  AC_DEFINE(HAVE_HELLO, 1, [ ])

  PHP_NEW_EXTENSION(hello, hello.cpp , $ext_shared)

fi 
```

因此，如果您遇到同样的问题，请使用[CodeGen_PECL](http://php-baustelle.de/CodeGen_PECL/manual.html)或调整上面的 m4 示例（以及确保您在标题和 ZEND_GET_MODULE 宏周围使用了 extern "C"）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-10-05T23:08:36.170

这里还有包装类的快速介绍（并以 Class::Method 样式导出函数）：http: [//devzone.zend.com/article/4486](http://devzone.zend.com/article/4486)

对我来说，最有用的部分是为 C++ 编译器/链接规则添加到 config.m4 以用于 phpize 的行。

# internet-explorer - 如何强制ie要求数字证书

> ID：492018
> 
> 赞同：5
> 
> 时间：2009-01-29T15:21:07.900
> 
> 标签：internet-explorer, digital-certificate

嗯...我有一个需要数字证书的网页。

当我第一次加载页面时，我得到一个对话窗口，要求提供证书。如果我选择它，那么一切都很好:) 但是，如果我按取消然后重新进入页面，我不会提示我输入证书...页面被呈现并显示“页面需要客户端证书”错误.

每次进入页面时，如何“强制”对话窗口选择要显示的证书？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-29T16:56:48.830

这不是 IE 问题，而是网络服务器问题。您必须在服务器上配置您的网站以要求数字证书。在 IIS 中，这是通过站点属性的目录安全选项卡完成的。您必须选中“需要 SSL”，然后您可以选择“需要客户端证书”选项。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2015-08-20T12:20:12.947

对于 IE，您必须这样做：在工具 > Internet 选项 > 安全 > 自定义级别... UI 中，解释性文本已更改。

*   在 IE6 和 IE7 中显示：当没有证书或仅存在一个证书时，不提示选择客户端证书。
*   在 IE8 中，它现在显示为：仅存在一个证书时不提示选择客户端证书。

禁用它！

# c# - 阻塞和等待事件

> ID：492020
> 
> 赞同：36
> 
> 时间：2009-01-29T15:21:14.233
> 
> 标签：c#, .net, events

它有时想在等待事件发生时阻塞我的线程。

我通常这样做：

```
private AutoResetEvent _autoResetEvent = new AutoResetEvent(false);

private void OnEvent(object sender, EventArgs e){
  _autoResetEvent.Set();
}

// ...
button.Click += OnEvent;
try{
  _autoResetEvent.WaitOne();
}
finally{
  button.Click -= OnEvent;
} 
```

但是，这似乎应该是我可以提取到公共类的东西（或者甚至可能是框架中已经存在的东西）。

我希望能够做这样的事情：

```
EventWaiter ew = new EventWaiter(button.Click);
ew.WaitOne();
EventWaiter ew2 = new EventWaiter(form.Closing);
ew2.WaitOne(); 
```

但是我真的找不到构造这样一个类的方法（我找不到一个很好的有效方法来将事件作为参数传递）。任何人都可以帮忙吗？

为了举例说明为什么这很有用，请考虑以下内容：

```
var status = ShowStatusForm();
status.ShowInsertUsbStick();
bool cancelled = WaitForUsbStickOrCancel();
if(!cancelled){
  status.ShowWritingOnUsbStick();
  WriteOnUsbStick();
  status.AskUserToRemoveUsbStick();
  WaitForUsbStickToBeRemoved();
  status.ShowFinished();
}else{
  status.ShowCancelled();
}
status.WaitUntilUserPressesDone(); 
```

这比使用在许多方法之间展开的逻辑编写的等效代码更加简洁和易读。但是要实现 WaitForUsbStickOrCancel()、WaitForUsbStickToBeRemoved 和 WaitUntilUserPressesDone()（假设我们在插入或移除 USB 记忆棒时收到一个事件），我每次都需要重新实现“EventWaiter”。当然，您必须小心不要在 GUI 线程上运行它，但有时这对于更简单的代码来说是值得权衡的。

替代方案看起来像这样：

```
var status = ShowStatusForm();
status.ShowInsertUsbStick();
usbHandler.Inserted += OnInserted;
status.Cancel += OnCancel;
//...
void OnInserted(/*..*/){
  usbHandler.Inserted -= OnInserted;
  status.ShowWritingOnUsbStick();
  MethodInvoker mi = () => WriteOnUsbStick();
  mi.BeginInvoke(WritingDone, null);
}
void WritingDone(/*..*/){
  /* EndInvoke */
  status.AskUserToRemoveUsbStick();
  usbHandler.Removed += OnRemoved;
}
void OnRemoved(/*..*/){
  usbHandler.Removed -= OnRemoved;
  status.ShowFinished();
  status.Done += OnDone;
}
/* etc */ 
```

我发现阅读起来要困难得多。诚然，流程并非总是如此线性，但当它是这样时，我喜欢第一种风格。

它与使用 ShowMessage() 和 Form.ShowDialog() 相当——它们也会阻塞，直到发生一些“事件”（尽管如果在 gui 线程上调用它们，它们将运行消息循环）。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2013-10-04T08:47:12.567

我修改了 Dead.Rabit 的 EventWaiter 类来处理`EventHandler<T>`. 因此，您可以使用等待所有事件类型`EventHandler<T>`，这意味着您的委托类似于`delegate void SomeDelegate(object sender, T EventsArgs)`.

```
 public class EventWaiter<T>
{

    private AutoResetEvent _autoResetEvent = new AutoResetEvent(false);
    private EventInfo _event = null;
    private object _eventContainer = null;

    public EventWaiter(object eventContainer, string eventName)
    {
        _eventContainer = eventContainer;
        _event = eventContainer.GetType().GetEvent(eventName);
    }

    public void WaitForEvent(TimeSpan timeout)
    {
        EventHandler<T> eventHandler = new EventHandler<T>((sender, args) => { _autoResetEvent.Set(); });
        _event.AddEventHandler(_eventContainer, eventHandler);
        _autoResetEvent.WaitOne(timeout);
        _event.RemoveEventHandler(_eventContainer, eventHandler);
    }
} 
```

例如，当我注册到 Windows 推送通知服务时，我使用它来等待从 HttpNotificationChannel 获取 Url。

```
 HttpNotificationChannel pushChannel = new HttpNotificationChannel(channelName);
            //ChannelUriUpdated is event 
            EventWaiter<NotificationChannelUriEventArgs> ew = new EventWaiter<NotificationChannelUriEventArgs>(pushChannel, "ChannelUriUpdated");
            pushChannel.Open();
            ew.WaitForEvent(TimeSpan.FromSeconds(30)); 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-29T15:27:14.250

不要传递事件，传递与事件处理程序签名匹配的委托。这对我来说实际上听起来很老套，所以要注意潜在的死锁问题。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-05-09T16:17:02.957

我已经在 LinqPad 中使用反射将一个工作示例拼凑在一起，使用字符串获取对 EventInfo 对象的引用（在您放松编译时检查时要小心）。明显的问题是，没有任何保证会触发事件，或者您期望的事件可能会在 EventWaiter 类准备好开始阻塞之前被触发，所以我不确定如果我把它放进去我会睡得舒服一个生产应用程序。

```
void Main()
{
    Console.WriteLine( "main thread started" );

    var workerClass = new WorkerClassWithEvent();
    workerClass.PerformWork();

    var waiter = new EventWaiter( workerClass, "WorkCompletedEvent" );
    waiter.WaitForEvent( TimeSpan.FromSeconds( 10 ) );

    Console.WriteLine( "main thread continues after waiting" );
}

public class WorkerClassWithEvent
{
    public void PerformWork()
    {
        var worker = new BackgroundWorker();
        worker.DoWork += ( s, e ) =>
        {
            Console.WriteLine( "threaded work started" );
            Thread.Sleep( 1000 ); // <= the work
            Console.WriteLine( "threaded work complete" );
        };
        worker.RunWorkerCompleted += ( s, e ) =>
        {
            FireWorkCompletedEvent();
            Console.WriteLine( "work complete event fired" );
        };

        worker.RunWorkerAsync();
    }

    public event Action WorkCompletedEvent;
    private void FireWorkCompletedEvent()
    {
        if ( WorkCompletedEvent != null ) WorkCompletedEvent();
    }
}

public class EventWaiter
{
    private AutoResetEvent _autoResetEvent = new AutoResetEvent( false );
    private EventInfo _event               = null;
    private object _eventContainer         = null;

    public EventWaiter( object eventContainer, string eventName )
    {
        _eventContainer = eventContainer;
        _event = eventContainer.GetType().GetEvent( eventName );
    }

    public void WaitForEvent( TimeSpan timeout )
    {
        _event.AddEventHandler( _eventContainer, (Action)delegate { _autoResetEvent.Set(); } );
        _autoResetEvent.WaitOne( timeout );
    }
} 
```

输出

```
// main thread started
// threaded work started
// threaded work complete
// work complete event fired
// main thread continues after waiting 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-10-15T05:34:47.353

你也可以试试这个：

```
class EventWaiter<TEventArgs> where TEventArgs : EventArgs
{
    private readonly Action<EventHandler<TEventArgs>> _unsubHandler;
    private readonly Action<EventHandler<TEventArgs>> _subHandler;

    public EventWaiter(Action<EventHandler<TEventArgs>> subHandler, Action<EventHandler<TEventArgs>> unsubHandler)
    {
        _unsubHandler = unsubHandler;
        _subHandler = subHandler;
    }

    protected void Handler(object sender, TEventArgs args)
    {
        _unsubHandler.Invoke(Handler);
        TaskCompletionSource.SetResult(args);
    }

    public  TEventArgs WaitOnce()
    {
        TaskCompletionSource = new TaskCompletionSource<TEventArgs>();
        _subHandler.Invoke(Handler);
        return TaskCompletionSource.Task.Result;
    }

    protected TaskCompletionSource<TEventArgs> TaskCompletionSource { get; set; } 

} 
```

用法：

```
EventArgs eventArgs = new EventWaiter<EventArgs>((h) => { button.Click += new EventHandler(h); }, (h) => { button.Click -= new EventHandler(h); }).WaitOnce(); 
```

* * *

## 回答 #5

> 赞同：-7
> 
> 时间：2009-01-30T00:04:23.333

我认为这些应该可以工作，没有尝试过只是编码。

```
public class EventWaiter<T> where T : EventArgs
{
    private System.Threading.ManualResetEvent manualEvent;

    public EventWaiter(T e)
    {
        manualEvent = new System.Threading.ManualResetEvent(false);
        e += this.OnEvent;
    }

    public void OnEvent(object sender, EventArgs e)
    {
        manualEvent.Set();
    }

    public void WaitOne()
    {
        manualEvent.WaitOne();
    }

    public void Reset()
    {
        manualEvent.Reset();
    }
} 
```

没有想太多，但是想不通怎么让它和EventArgs隔离。

看看[MSDN ManualResetEvent](http://msdn.microsoft.com/en-us/library/system.threading.manualresetevent.aspx)，你会发现你可以将等待和一些奇怪的东西串联起来。

# sql-server - Win 2k3/SQL Server 2005 上的“启用高级性能”是否覆盖 FILE_FLAG_WRITETHROUGH

> ID：492023
> 
> 赞同：1
> 
> 时间：2009-01-29T15:21:19.613
> 
> 标签：sql-server, sql-server-2005, windows-server-2003, write-through

SQL Server 使用 FILE_FLAG_WRITETHROUGH 打开文件，这似乎会强制写入物理磁盘。在 SQL Server 中，这称为“强制单元访问 (FUA)”；[可以在此处](http://www.microsoft.com/technet/prodtechnol/sql/2000/maintain/sqlIObasics.mspx)找到讨论此问题的白皮书。许多 SAN 似乎都尊重这一点，这可能解释了我在连接到 IBM Shark 的服务器上开发的 ETL 过程性能缓慢的原因。

在 Windows 2003 服务器磁盘管理器的对话框中，可以选择“启用高级性能”。我可以找到间接和杜撰的文档，暗示这会覆盖强制直写行为。

有谁确切地知道是这种情况还是这个选项实际上是做什么的？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-30T12:50:19.433

不是这种情况。SQL Server 将始终对其打开的文件启用直写。这可确保任何写入都不会在本地 Windows 磁盘缓存中缓冲。磁盘控制器（RAID 控制器等）或 SAN 上的任何内容都将拥有自己的缓存（希望电池支持和镜像），并且无论文件在操作系统下如何打开，都将拥有单独的缓存策略。永远不要在没有备用电池的缓存上启用回写。如果您在写入期间断电，您的数据库将损坏。

# asp.net - 元素 使用用户控件时不是 Visual Studio 中的已知元素警告

> ID：492027
> 
> 赞同：22
> 
> 时间：2009-01-29T15:22:16.447
> 
> 标签：asp.net, visual-studio, webforms, user-controls, warnings

我有一个 Visual Studio 2008 项目，在使用用户控件时显示以下警告，但我无法在任何地方找到解决方案。

> 元素`<element>`不是已知元素

我怎样才能解决这个问题？

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2009-09-24T23:42:06.527

这听起来像是一个经典的重新构建您的解决方案和“关闭并重新打开 Visual Studio”的问题。

它也可能与我在[解决 Visual Studio 2005/2008 中的 Resolving "Validation (): Element 'xxxx' is not supported" 警告中](https://stackoverflow.com/questions/1474716/resolving-validation-element-xxxx-is-not-supported-warning-in-visual-stud)回答的类似问题有关。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2016-01-22T18:30:36.330

如果您尝试添加的元素位于另一个不应包含的元素的标签内，也会发生这种情况。

例如：

```
<asp:Button ID="button" runat="server" >
    <asp:Repeater ID="repeater" runat="server"></asp:Repeater>
</asp:Button> 
```

或者在我的情况下，将一个`<asp:Repeater>`放在 an 中`<asp:UpdatePanel>`而忘记将它放在`<ContentTemplate>`：

```
<asp:UpdatePanel ID="upPanel" runat="server">
    <ContentTemplate>
        <asp:Repeater ID="rep" runat="server">

        </asp:Repeater>
    </ContentTemplate>
</asp:UpdatePanel> 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2010-09-16T01:30:38.810

显然，如果 .ascx 文件中的命名空间名称与 ascx.cs（代码隐藏）文件中的命名空间不匹配，也会发生这种情况。还有一个问题要检查。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2019-05-30T20:48:02.520

从OP：

> 对此的明显解决方案是确保 TagName 是控件类的名称。
> 
> 因此，对于我的示例，以下显示了警告：
> 
> ```
> <%@ Register Src="~/path/to/Control.ascx" TagName="tagName" TagPrefix="tagprefix" %> 
> ```
> 
> `<tagprefix:tagName runat="server" id="controlID" />`
> 
> 但将其更改为：
> 
> ```
> <%@ Register Src="~/path/to/Control.ascx" TagName="Control" TagPrefix="tagprefix" %> 
> ```
> 
> `<tagprefix:Control runat="server" id="controlID" />`
> 
> 修复它。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2016-08-02T13:02:38.593

检查您可能在 Asp.net 上的 ContentPlaceHolderID="MainContent" 上，因此将代码放在新的占位符上

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2019-09-06T11:31:55.990

当我将 .ascx 文件的构建操作从“内容”更改为“编译”并随后将其改回时，我发现问题已解决。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2017-01-17T15:02:19.793

如果您的 web.config 中也缺少某些内容，则可能会发生这种情况。我在将自定义控件从一个解决方案复制到另一个解决方案时遇到了这个错误，页面仍然找不到该元素。如果上述方法都不能解决问题，请检查 web.config 的这一部分并确保包含您的控件：

```
<controls>
    <add tagPrefix="fu" namespace="Fubar.Base" assembly="Fubar" />
    ...
</controls> 
```

添加后，然后关闭/重新打开解决方案，问题就消失了。

# ruby-on-rails - 在 rails 中重命名路线（map、link_to、to_param）

> ID：492042
> 
> 赞同：2
> 
> 时间：2009-01-29T15:25:42.977
> 
> 标签：ruby-on-rails, map, routes, link-to

我有一个小问题...我设置了一个为德国网站提供服务的 Rails 应用程序。为了利用 Rails 的内部复数功能，我将所有模型都保留为英文（例如模型“ `JobDescription`”）。现在，如果我打电话给“ `http://mysite.com/job_descriptions/`”，我会得到我所有的`job_descriptions`……到目前为止，太好了。因为我不想`job_descriptions`在我的网址中使用英文术语“”，所以我将以下内容放入了我的 routes.rb

```
map.german_term '/german_term', :controller => 'job_descriptions', :action => 'index'
map.german_term '/german_term/:id', :controller => 'job_descriptions', :action => 'show' 
```

如果我打电话给“ `http://mysite.com/german_term/`”或“ `http://mysite.com/german_term/283`”我得到所有我的`job_descriptions`，这很好。

但是，为了使 URL 对 SEO 更友好，我想将 id 换成 URL 中对用户更友好的 slug。因此，我将以下内容放入我的`job_description.rb`：

```
def to_param
"#{id}-#{name.gsub(/[^a-z0-9]+/i, '-')}"
end 
```

每当我`job_description_path`在任何`link_to`方法中使用“”时，都会将我的 URL 呈现为“ [http://mysite/job_descriptions/13-my-job-description-title](http://mysite/job_descriptions/13-my-job-description-title) ”之类的东西。

但是，这就是我卡住的地方，我想得到“ `http://mysite/german_term/13-my-job-description-title`”。我已经尝试在 link_to 代码中将“ `job_description_path`”与“ `german_term_path`”交换，但这只会生成“ `http://mysite/german_term/13`”。显然，`to_param`不叫。我发现的一种解决方法是建立链接：

```
<%= link_to job_description.name, german_term_path(job_description.to_param) %> 
```

但是更改`link_to`我的代码中的所有调用是相当乏味的。我想要的是在 URL 中出现时将“ `job_description`”替换为“”。`german_term`

有什么想法吗？！？

问候，

塞巴斯蒂安

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-29T15:54:44.180

我认为您将需要使用 restful 路线助手来获得您想要的东西。

在这种情况下，不需要太多重构（假设您已将 JobDescriptions 映射为资源）。保留您的 to_param 并将您的 JobDescriptions 路由更改为以下内容：

```
map.resources :job_descriptions, :as => 'german_term' 
```

希望这可以帮助！

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-29T15:46:12.077

Rails 只使用

```
def to_params 
end 
```

当您使用宁静的路由/链接助手时的 URL 构建器。我知道的唯一方法是像你做的那样做，除非你愿意放弃你的英语链接并用德语做这一切。在这种情况下，只需去掉命名的路线并更改 to_params 以使用数据库中的正确名称字段。此时，REST 路由应该正确运行。

# c# - ASP.Net 中的数据缓存与会话对象

> ID：492043
> 
> 赞同：11
> 
> 时间：2009-01-29T15:26:05.080
> 
> 标签：c#, asp.net, session, caching

站点的动态业务对象应该存储在用户会话中还是使用 ASP.Net 缓存（订单、配置文件信息等对象）？

我曾与使用会话存储业务对象的站点合作过，但我想知道......缓存的优点或缺点是什么？

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2009-01-29T15:33:31.120

如果对象可在用户会话之间共享，则使用缓存。如果对象对于每个会话都是唯一的——可能是因为它们受权限控制——那么将其存储在会话中。进程内会话本身存储在缓存中，因此决定因素实际上应该是数据的范围。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-01-29T15:37:22.810

缓存就是——缓存。您永远不能依赖那里的条目，因此在这方面不必做出任何假设：准备好直接进入数据库（或其他任何地方）以重新获取数据。

另一方面，Session 更适合存储对象，尽管我个人尽量避免使用会话存储来支持 DB。*我通常通过在不透明的ISessionStoreService*接口后面抽象出存储来做到这一点：

```
interface ISessionStore
{
    T GetEntry<T>(string key);
    void SaveEntry<T>(string key, T entry);
} 
```

然后“依赖注入”适当的实现，无论是*InmemorySessionStore*、*DbSessionStore*还是其他。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-29T15:33:57.513

ASP.NET 系统缓存对应用程序是全局的，因为会话对当前用户是唯一的。如果您选择使用全局缓存来存储对象，则需要创建对象识别策略，以便您可以为每个用户获取正确的对象。

如果您希望提高性能，最好将 ASP.NET 会话状态替换为分布式内存缓存，例如 Microsoft 的速度。Microsoft 已发布有关如何替换会话使用以针对 Velocity 的文章。您还可以以相关方式使用 Memcache 或其他类似产品。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-29T15:36:50.847

Session 对象适用于 user-only-data，而 Cache 对象更适用于应用程序共享的数据。
保存其中一个或另一个的关键是确定您要存储的内容是仅限用户数据还是需要在所有应用程序中共享。

会话 => 具有分步界面的网页（例如在线测试）。
缓存 => 在某种天气小部件中显示的信息（例如 google 在其 igoogle.com 页面中的那个）。
希望这可以帮助。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2013-08-22T19:30:31.247

虽然您可以将业务对象存储在 Cache 中，但 Cache 是为提高性能而不是状态管理而设计的。想象一下，您有一个从数据库中获取 1000 条记录的过程（大约需要 3 秒），您需要几分钟。您可以将对象存储在缓存中并设置过期日期、优先级和依赖项（如 SqlDependency 或 FileDependency），因此对于下一个请求，您可以使用缓存数据而不是从数据库中检索它。您可以将对象存储在 Session 中，但默认情况下不能为 Session 设置依赖项。缓存还有一个独特的行为，当系统需要内存时，它会根据其优先级从缓存中释放对象。缓存对象对应用程序是全局的，并在所有用户之间共享，但 Session 不是共享的，它可用于每个用户（会话）。

# logging - 什么是 Windows 服务日志文件位置的“最佳实践”？

> ID：492044
> 
> 赞同：8
> 
> 时间：2009-01-29T15:26:11.307
> 
> 标签：logging, windows-services

许多Windows服务将每日日志文件写入“程序文件”下的应用程序安装目录。

Windows 系统应用程序（例如 IIS）使用 %SystemRoot%\System32\LogFiles。我应该为我的服务做些什么吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-29T17:19:51.107

我们使日志目录可配置。根据使用情况，您可能不希望将日志记录在 OS 驱动器上，或者在需要授予超出您需要的权限的位置。

事件日志并不总是更详细的日志记录的最佳解决方案。我们将事件日志用于错误和警告以及主要状态更改（启动/停止/等），但我们将日志文件用于更详细的操作。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-29T15:42:44.797

我不建议，这两个通常会在 Vista（和 XP 但不那么频繁）中中断，因为它们需要管理员权限才能写入。相反，我会建议 %AllUsersProfile%\application data\yourService\

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-29T15:43:14.267

使用事件日志 - 它可以以丰富的格式存储数据并支持通过 WMI 进行良好的查询（例如，管理员可以一次从所有 100 个服务器查询日志以获取包含文件名“Payroll.xml”的警告 - 无需挖掘日志文件来进行故障排除服务）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-29T15:47:28.733

在我的 Windows 服务上，我将日志输出到“C:\App Log Files\”的默认目录，并允许用户选择其他位置。我会自动循环它们，所以我有 Monday.log、Tuesday.log 等。周二早上，我删除了周三的日志，所以第二天它会是空的。最后，如果一周不够，我将旧的重命名为周三.V01。这个每周循环的原因是在其他人完成的以前的版本中，日志是按日期的，并且默默地填满硬盘，直到一切都崩溃了。鉴于大多数系统没有人来维护它们，自我维护是值得的。

最后，虽然系统事件日志是偶尔显示消息的好地方，但它不适合详细的事务日志等。通过在系统日志之外拥有日志文件，您可以将它们发送回开发人员进行更多分析容易地。

* * *

## 回答 #5

> 赞同：-3
> 
> 时间：2009-01-29T15:30:27.023

一种选择是使用事件日志，这是许多 IT 人员希望找到日志的地方。

如果你想使用日志文件，一个好的位置应该是在 %Temp% 目录中。

# java - 什么是最好的 java 日期重复模式计算器

> ID：492055
> 
> 赞同：6
> 
> 时间：2009-01-29T15:28:30.490
> 
> 标签：java, date, recurrence

任何人都知道（可靠的）日期重复计算器，我们正在尝试在我们的应用程序中实现一些允许创建时间表的东西，类似于 Outlook 中的重复会议。我们已经尝试过 chronos，但发现了一些它崩溃的情况，如果有人成功使用了其他任何选项，我真的很感激。

干杯，罗宾

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-29T16:11:01.497

这是 joda time 邮件列表上的一个常见问题，通常的答案是尝试[RFC 2445](http://code.google.com/p/google-rfc-2445/)。免责声明：我自己没有使用过。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-30T10:48:15.810

查看 Quartz，它是一个非常方便的工具：

[http://www.quartz-scheduler.org/](http://www.quartz-scheduler.org/)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2014-06-26T19:26:57.197

查看[Lamma 日期](http://lamma.io)（我最近写的），它旨在根据重复模式生成日期。

例如：

```
import static io.lamma.LammaJavaImports.*;
Dates.from(2010, 1, 1).to(2019, 12, 31).byYears(3).on(Locators.nth(3, FRIDAY).of(FEBRUARY)).build(); 
```

将**在 2010 年代每 3 年生成 2 月的第三个星期五**

输出：

```
List(2010-02-19, 2013-02-15, 2016-02-19, 2019-02-15) 
```

# .net - 如何使用 .Net 的 RegEx 从字符串中提取所有 {} 标记？

> ID：492060
> 
> 赞同：2
> 
> 时间：2009-01-29T15:30:06.553
> 
> 标签：.net, regex, extract, token

我需要从给定的字符串中提取用大括号标记的标记。

我已经尝试使用 Expresso 来构建可以解析的东西......

```
-------------------------------------------------------------
"{Token1}asdasasd{Token2}asd asdacscadase dfb db {Token3}"
------------------------------------------------------------- 
```

并产生“Token1”、“Token2”、“Token3”

我试过用..

```
-------------------------------------------------------------
({.+})
------------------------------------------------------------- 
```

...但这似乎与整个表达式相匹配。

有什么想法吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-29T15:32:32.947

尝试

```
\{(.*?)\} 
```

```
\{ 将转义“{”（在 RegEx 中具有含义）。
\} 同样转义结束的 } 备份。
这 。*？将采用最少的数据，而不仅仅是 .*
这是“贪婪的”，并尽其所能。

```

```
如果您确信您的代币将（或需要）
具有特定格式，您可以将 .* 替换为适当的
字符类。例如，在可能的情况下，您
只需要单词，您可以使用 (\w*) 代替 (.*?)
这样做的好处是关闭 } 字符不是
在内部表达式中匹配的类的一部分，
所以你不需要？修饰符）。

```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-29T15:31:47.347

尝试：

```
\{([^}]*)\} 
```

这会将搜索夹在波浪形大括号内以停止在右大括号上。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-29T19:19:02.067

另一种解决方案：

```
(?<=\{)([^\}]+)(?=\}) 
```

这使用了前瞻和后瞻，因此根本不消耗括号。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-29T15:32:57.437

花括号在正则表达式中具有特殊含义，因此您必须对其进行转义。使用`\{`和`\}`来匹配它们。

# c++ - 为什么 std::string 不提供到 char* 的隐式转换？

> ID：492061
> 
> 赞同：29
> 
> 时间：2009-01-29T15:30:24.557
> 
> 标签：c++, string, stl

`std::string`提供[const char* c_str ( ) const](http://www.cplusplus.com/reference/string/string/c_str.html)其中：

> 获取等效的 C 字符串
> 
> 生成与字符串对象具有相同内容的以空字符结尾的字符序列（c-string），并将其作为指向字符数组的指针返回。
> 
> 自动附加终止空字符。
> 
> 返回的数组指向一个内部位置，该位置具有此字符序列所需的存储空间加上其终止的空字符，但此数组中的值不应在程序中修改，并且仅允许保持不变，直到下一次调用字符串对象的非常量成员函数。

他们为什么不直接定义`operator const char*() const {return c_str();}`？

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2009-01-29T15:40:00.013

来自 C++ Programming Language 20.3.7（强调我的）：

> 转换为 C 风格的字符串可以由操作符 const char*() 而不是 c_str() 提供。**在这种转换出乎意料的情况下，这会以意外为代价**提供隐式转换的便利。

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2009-01-29T16:12:51.163

我看到隐式转换至少有两个问题：

*   即使是`c_str()`提供的显式转换也足够危险。我见过很多情况，其中存储了指针以在原始字符串对象的生命周期结束后使用（或者对象被修改，从而使指针无效）。通过对您的明确调用，`c_str()`希望您能意识到这些问题。但是使用隐式转换很容易导致未定义的行为，如下所示：

    ```
    const char *filename = string("/tmp/") + name;
    ofstream tmpfile(filename); // UB
    ```

*   转换也会发生在某些您不期望的情况下，并且语义至少可以说是令人惊讶的：

    ```
    string name;
    if (name) // always true
     ;
    name-2; // pointer arithmetic + UB
    ```

    这些可以通过某种方式避免，但为什么要首先陷入这个麻烦呢？

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-01-29T15:41:44.673

因为隐式转换几乎永远不会像您期望的那样运行。它们可以在重载解析中给出令人惊讶的结果，因此*通常*最好像 std::string 那样提供显式转换。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-01-29T15:42:02.210

Josuttis 的书说：

> 这是出于安全原因，以防止意外的类型转换导致奇怪的行为（类型`char *`通常具有奇怪的行为）和歧义（例如，在组合 a`string`和 C 字符串的表达式中，可以转换`string`为`char *`，反之亦然） .

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-01-29T20:17:52.277

除了规范中提供的基本原理（意想不到的惊喜）之外，如果您将 C API 调用与 混合使用`std::string`，您真的需要养成使用该`::c_str()`方法的习惯。如果您曾经调用需要 a 的 varargs 函数（例如：`printf`或等效函数）`const char*`，并且您直接传递 a `std::string`（不调用提取方法），您将不会收到编译错误（不对 varargs 函数进行类型检查），但是您将出现运行时错误（类布局与 a 的二进制文件不同`const char*`）。

顺便说一下，`CString`（在 MFC 中）采用相反的方法：它具有隐式转换，并且类布局与二进制兼容`const char*`（或者`const w_char*`，如果为宽字符串编译，即：“Unicode”）。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-01-29T15:38:47.630

这可能是因为这种转换会有令人惊讶和奇特的语义。特别是你引用的第四段。

另一个原因是存在一个隐式转换`const char* -> string`，而这恰恰相反，这意味着重载决议的奇怪行为（你不应该同时进行隐式转换`A->B`和`B->A`）。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-01-29T15:41:27.063

因为 C 风格的字符串是 bug 和许多安全问题的来源，所以最好明确地进行转换。

# ascii - 普通文本中最少使用的分隔符 < ASCII 128

> ID：492090
> 
> 赞同：90
> 
> 时间：2009-01-29T15:35:35.857
> 
> 标签：ascii, delimiter, csv

由于编码原因会让您感到恐惧（我不好意思说），我需要将多个文本项存储在一个字符串中。

我将使用一个字符来分隔它们。

哪个字符最好用于此，即哪个字符最不可能出现在文本中？必须是可打印的，并且在 ASCII 中可能小于 128，以避免语言环境问题。

* * *

## 回答 #1

> 赞同：51
> 
> 时间：2017-01-09T19:31:19.600

我会选择“单位分隔符”ASCII 码“US”：ASCII 31 (0x1F)

在过去，大多数事情都是连续完成的，没有随机访问。这意味着一些控制代码被嵌入到 ASCII 中。

```
ASCII 28 (0x1C) File Separator - Used to indicate separation between files on a data input stream.
ASCII 29 (0x1D) Group Separator - Used to indicate separation between tables on a data input stream (called groups back then).
ASCII 30 (0x1E) Record Separator - Used to indicate separation between records within a table (within a group).  These roughly map to a tuple in modern nomenclature.
ASCII 31 (0x1F) Unit Separator - Used to indicate separation between units within a record.  The roughly map to fields in modern nomenclature. 
```

单位分隔符是 ASCII 格式，并且有 Unicode 支持来显示它（通常是同一字形中的“我们”），但许多字体不显示它。

如果必须显示它，我建议在将其解析为字段后在应用程序中显示它。

* * *

## 回答 #2

> 赞同：37
> 
> 时间：2009-01-29T15:48:32.023

假设由于某些令人尴尬的原因您不能使用 CSV，我会说使用数据。取一些样本数据，并为每个值 0-127 进行简单的字符计数。选择一个不会发生的。如果选择太多，请获取更大的数据集。不会花太多时间来写，你会得到最适合你的答案。

对于不同的问题域，答案会有所不同，所以 | (pipe) 在 shell 脚本中很常见， ^ 在数学公式中很常见，对于大多数其他字符来说可能也是如此。

我个人认为我会去| （管道）如果可以选择但使用真实数据是最安全的。

不管你做什么，确保你已经制定了一个逃生计划！

* * *

## 回答 #3

> 赞同：23
> 
> 时间：2010-09-01T16:49:34.990

使用不同语言时，此符号： ¬

被证明是最好的。不过我还在测试。

* * *

## 回答 #4

> 赞同：22
> 
> 时间：2009-01-29T15:38:49.737

可能| 或 ^ 或 ~ 你也可以组合两个字符

* * *

## 回答 #5

> 赞同：17
> 
> 时间：2009-01-30T01:29:35.113

您说的是“可打印”，但它可以包括诸如制表符 (0x09) 或换页 (0x0c) 之类的字符。我几乎总是为分隔文件选择制表符而不是逗号，因为逗号有时会出现在文本中。

（有趣的是，[ascii 表](http://en.wikipedia.org/wiki/ASCII)有字符 GS (0x1D)、RS (0x1E) 和 US (0x1F) 用于组、记录和单位分隔符，无论它们是/曾经是什么。）

如果“可打印”是指用户可以识别并轻松输入的字符，我会选择管道 | 首先是符号，还有一些其他奇怪的字符（`@`或`~`或`^`或`\`，或我似乎无法在此处输入的反引号）作为一种可能性。这些字符`+=!$%&*()-'":;<>,.?/`似乎更有可能出现在用户输入中。至于下划线`_`和哈希`#`以及括号`{}[]`我不知道。

* * *

## 回答 #6

> 赞同：14
> 
> 时间：2009-01-29T15:38:31.873

您如何使用 CSV 样式格式？字符可以以标准的 CSV 格式转义，并且已经编写了很多解析器。

* * *

## 回答 #7

> 赞同：9
> 
> 时间：2009-01-29T15:38:20.033

你可以使用管道符号吗？这通常是逗号或制表符分隔字符串之后最常见的分隔符。大多数文本不太可能包含管道，并且 ord('|') 为我返回 124，因此这似乎符合您的要求。

* * *

## 回答 #8

> 赞同：9
> 
> 时间：2011-08-13T07:58:20.427

为了快速转义，我使用这样的东西：假设你想连接 str1、str2 和 str3，我所做的是：

```
delimitedStr=str1.Replace("@","@a").Replace("|","@p")+"|"+str2.Replace("@","@a").Replace("|","@p")+"|"+str3.Replace("@","@a").Replace("|","@p"); 
```

然后检索原始用途：

```
splitStr=delimitedStr.Split("|".ToCharArray());
str1=splitStr[0].Replace("@p","|").Replace("@a","@");
str2=splitStr[1].Replace("@p","|").Replace("@a","@");
str3=splitStr[2].Replace("@p","|").Replace("@a","@"); 
```

注意：替换的顺序很重要

它牢不可破且易于实施

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2009-01-30T01:09:42.687

我们使用 ascii 0x7f，它是伪可打印的，几乎不会在常规使用中出现。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2009-01-29T15:41:43.177

管为胜利！|

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-01-29T15:39:34.647

好吧，它在某种程度上取决于文本的性质，但垂直条 0x7C 不会经常出现在文本中。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-02-11T05:28:27.640

我认为我从未见过自然文本中的 & 后跟逗号，但是您可以先检查文件以查看它是否包含分隔符，如果是，请使用替代方法。如果您希望始终能够知道您使用的分隔符不会导致冲突，那么请循环检查文件中是否存在您想要的分隔符，如果存在，则将字符串加倍，直到文件不再有匹配项. 是否有类似的字符串并不重要，因为您的程序只会查找完全匹配的分隔符。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2009-02-11T05:59:43.413

根据情况和语言，这可能是好是坏（通常是坏的），但请记住，您始终可以对整个事物进行 Base64 编码。然后，您不必担心在每一侧转义和取消转义各种模式，您可以根据 Base64 字符集中未使用的字符简单地分离和拆分字符串。

面对将 XML 文档放入 XML 属性/节点时，我不得不求助于这个解决方案。属性中根本不能有 CDATA 块，并且作为 CDATA 转义的节点显然不能在不破坏结构的情况下在其中有更多的 CDATA 块。

不过，对于大多数情况，CSV 可能是一个更好的主意。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2013-08-19T23:55:17.233

pipe 和 caret 都是显而易见的选择。我会注意到，如果希望用户键入整个响应，则插入符号在任何键盘上都比管道更容易找到。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2021-02-13T13:22:11.003

我以前使用过双管和双插入符号。如果您不手动创建或修改文件，则不可打印字符的想法有效。使用快速随机访问文件存储和检索字段宽度。您甚至不必阅读文件..您实际上是通过引用从文件中提取的。这就是数据库进行一些存储的方式。但它们也管理记录之间的空间等。并引入了最大数据元素宽度的问题。（索引附加一个标头，用于定义每个元素的宽度及其原始数据类型。后来他们引入了重新映射字符的压缩。这允许文本文件在传输中获得大约 1/8 的大小.. win 的可变长度字符编码

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2021-05-10T06:21:15.593

让它充满活力:)

在文件头中宣布你的控制字符

例如

```
delimiter: ~
escape: \
wrapline: $
width: 19

hello world~this i$
s \\just\\ a sampl$
e text~$someVar$~h$
ere is some \~\~ma$
rkdown strikethrou$
gh\~\~ text 
```

会给字符串
`hello world`
`this is \just\ a sample text`
`$someVar$`
`here is some ~~markdown strikethrough~~ text`

我已经实现了类似的东西：
一种`plaintar`文本容器格式，
用于在 ascii 中转义和包装 utf16 文本，
作为 mime 多部分消息的替代方案。
见[https://github.com/milahu/live-diff-html-editor](https://github.com/milahu/live-diff-html-editor)

# c# - C++ 扫描器 (string-fu!)

> ID：492091
> 
> 赞同：2
> 
> 时间：2009-01-29T15:36:43.827
> 
> 标签：c#, java, c++, string

我正在编写一个扫描仪作为编译器的一部分。

我在尝试写这一部分时非常头疼：

我需要能够解析标记流并将它们一个一个推入向量中，忽略空格并标记特殊符号（简单的情况，让我们只考虑括号和大括号）

例子： `int main(){ }`

应该解析成 6 个不同的标记：

1.  整数
2.  主要的
3.  (
4.  )
5.  {
6.  }

你将如何解决这个问题？我是用 C++ 编写的，但也可以使用 java/C# 解决方案。

几点：

1.  不，我不能使用 Boost，我不能保证这些库对我可用。（别问……）

2.  我不想使用 lex 或任何其他特殊工具。我以前从来没有这样做过，只是想尝试一次，说我已经做到了。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-29T15:44:23.297

Stroustrup 的书*The C++ Programming Language*中有一个关于为简单的计算器程序构建词法分析器/解析器的很好的示例。它应该作为一个很好的起点来学习如何做你想做的事。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-29T15:41:05.957

购买《[编译器：原理、技术和工具](http://en.wikipedia.org/wiki/Compilers:_Principles,_Techniques,_and_Tools)》（龙书）。您尝试编写的是词法分析器，而不是“扫描仪”。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-29T15:49:12.430

为什么要自己编写 - 看看 Lex。

如果您必须拥有自己的，您只需逐个字符读取输入并保持一些最小状态以累积标识符。

问题本身并不难。如果解决不了，那你肯定是筋疲力尽了，你只需要休息一下。早上再看一遍。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-29T16:14:58.290

如果你真的想从这个练习中学到一些东西，那就开始编码吧。它不需要大量代码，因此您可以反复失败而不会超过一个下午。

在这一点上，你会对这个问题有一个很好的感觉。

*然后*查看任何随机编译器书籍以了解“常用”方法是什么，然后您会立即了解。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-29T16:05:00.540

嗯..我只是用迭代器做一个while循环，测试每个字符的类型，只有一个alpha到非alpha的变化，如果字符串不为空，则转储字符串。如果它是非 alpha 非空白字符，我只需将其推送到令牌堆栈上，这确实是一个微不足道的解析任务。射击，我一直想学习 lexx/yacc，但是你想要的解析级别*真的很*容易。我曾经写过一个 html 标记器，它比这更复杂.. 我的意思是你只是在寻找名称、空格和单个非字母数字字符.. 就这样做。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-29T16:38:32.097

如果您想从头开始编写此代码，您可以考虑编写一个有限状态机（枚举中的状态，用于状态切换的大型 switch/case 块）。您必须将状态推送到堆栈，因为所有内容都可以嵌套。

我知道这不是理想的方法；我只是想直接解决这个问题。

# java - 适合枚举的持久化数据

> ID：492096
> 
> 赞同：22
> 
> 时间：2009-01-29T15:37:49.393
> 
> 标签：java, types, enums, persistence

大多数项目都有某种数据，这些数据在版本之间基本上是静态的，非常适合用作枚举，例如状态、事务类型、错误代码等。例如，我将只使用一个常见的状态枚举：

```
public enum Status {
    ACTIVE(10, "Active");
    EXPIRED(11, "Expired");
    /* other statuses... */

    /* constructors, getters, etc. */
} 
```

我想知道其他人在对此类数据的持久性方面做了什么。我看到了几个选项，每个选项都有一些明显的优点和缺点：

*   将可能的状态保存在状态表中，并缓存所有可能的状态域对象以供在整个应用程序中使用
*   只使用枚举而不持久化可用状态列表，在我和我的 DBA 之间制造了一场数据一致性圣战
*   持久化状态并在代码中维护一个枚举，但不要将它们捆绑在一起，创建重复数据

我的偏好是第二种选择，尽管我的 DBA 声称我们的最终用户可能希望访问原始数据以生成报告，并且不持久化状态会导致数据模型不完整（反驳：这可以通过文档解决） .

是否有大多数人在这里使用的约定？人们的经验是什么？还有其他选择吗？

**编辑：**

在考虑了一段时间之后，我真正的持久性斗争来自处理与数据库中的状态相关的 id 值。这些值将在安装应用程序时作为默认数据插入。此时，他们将拥有可用作其他表中的外键的 id。我觉得我的代码需要了解这些 id，以便我可以轻松检索状态对象并将它们分配给其他对象。我该怎么办？我可以添加另一个字段，例如“代码”，以查找内容，或者仅按名称查找状态，这很恶心。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-01-29T15:42:04.080

我们使用数据库中的一些显式字符串或字符值来存储枚举值。然后从数据库值返回枚举，我们在枚举类上编写一个静态方法来迭代并找到正确的方法。

如果您期望有很多枚举值，您可以创建一个静态映射`HashMap<String,MyEnum>`来快速翻译。

不要存储实际的枚举名称（即您的示例中的“ACTIVE”），因为开发人员很容易对其进行重构。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-31T17:47:31.770

我正在使用您记录的三种方法的混合...

使用数据库作为 Enum 值的权威来源。将值存储在某种“代码”表中。每次构建时，为要包含在项目中的 Enum 生成一个类文件。

这样，如果枚举更改数据库中的值，您的代码将正确失效，并且您将从持续集成服务器收到适当的编译错误。您对数据库中的枚举值有一个强类型绑定，您不必担心在代码和数据之间手动同步值。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-29T16:36:32.647

[Joshua Bloch 在他的“ Effective Java, Second Edition](http://java.sun.com/docs/books/effective/Im) ”一书中对枚举以及如何使用它们进行了出色的解释（第 147 页）

在那里，您可以找到各种技巧，如何定义枚举、持久化它们以及如何在数据库和代码之间快速映射它们 (p.154)。

在 Jazoon 2007 的一次演讲中，Bloch 给出了使用额外属性将枚举映射到 DB 字段并返回的原因如下： 枚举是常量，但代码不是。为了确保编辑源代码的开发人员不会通过重新排序枚举或重命名来意外破坏数据库映射，您应该向枚举添加特定属性（如“dbName”）并使用它来映射它。

枚举有一个固有的 id（在 switch() 语句中使用），但是当您更改元素的顺序时（例如通过对它们进行排序或在中间添加元素），此 id 会发生变化。

所以最好的解决方案是添加一个 toDB() 和 fromDB() 方法和一个附加字段。我建议为这个新字段使用简短易读的字符串，这样您就可以解码数据库转储而无需查找枚举。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-02T15:27:46.627

虽然我不熟悉 Java 中“属性”的概念（而且我不知道您使用的是什么语言），但我通常使用代码表（或域特定表）的概念，并且我已经将我的枚举值归因于更具体的数据，例如人类可读的字符串（例如，如果我的枚举值是 NewStudent，我会将其归因于“New Student”作为显示值）。然后我使用反射检查数据库中的数据并插入或更新记录，以使它们与我的代码保持一致，使用实际的枚举值作为键 ID。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-03T17:02:30.383

我在几个场合使用的是在代码中定义枚举和在持久层（数据库、文件等）中定义存储表示，然后有转换方法将它们相互映射。只有在读取或写入持久存储时才需要使用这些转换方法，并且应用程序可以在任何地方使用类型安全的枚举。在转换方法中，我使用 switch 语句进行映射。如果要转换新的或未知的状态，这也允许抛出异常（通常是因为应用程序或数据比另一个更新，并且已经声明了新的或附加的状态）。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-06T11:45:41.977

如果值列表需要更新的可能性很小，则为 1。否则，为 3。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-06T12:09:49.890

好吧，我们没有 DBA 可以回答，所以我们更喜欢选项 2）。

我们只需将 Enum 值保存到数据库中，当我们将数据从数据库中加载到域对象中时，我们只需将整数值转换为 enum 类型。这避免了选项 1) 和 3) 的任何同步问题。该列表在代码中定义一次。

但是，我们有一个政策，没有其他人可以直接访问数据库；他们必须通过我们的网络服务来访问任何数据。所以这就是为什么它对我们很有效。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-04-06T15:32:27.640

在您的数据库中，此“域”表的主键不必是数字。只需使用 varchar pk 和描述列（出于您的 dba 所关注的目的）。如果您需要在不依赖字母排序的情况下保证值的排序，只需添加一个名为“order 或“sequence”的数字列。

在您的代码中，创建一个带有常量的静态类，其名称（无论是否为驼峰式大小写）映射到描述，值映射到 pk。如果您需要更多，请创建一个具有必要结构和比较运算符的类，并将其实例用作常量的值。

如果您这样做太多，请构建一个脚本来生成实例化/声明代码。

# visual-studio - Visual Studio 中的文件拖放功能

> ID：492097
> 
> 赞同：1
> 
> 时间：2009-01-29T15:37:49.720
> 
> 标签：visual-studio, visual-studio-2005, plugins, drag-and-drop

我想知道是否有人知道插件或方法：

我希望能够将文件从解决方案资源管理器拖到 Windows 资源管理器窗口，并将文件复制到资源管理器中的位置。

目前使用VS2005

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-12T10:28:23.763

请参阅[VS Explorer](http://www.ssware.com/vsexplorer/vsexplorer.htm) - 一个向 Visual Studio 添加文件和文件夹浏览窗口的插件。它允许您将文件从解决方案资源管理器拖放到外部文件夹，反之亦然等等。

# cocoa-touch - Interface Builder 是否使用 -init 方法来初始化视图控制器？

> ID：492106
> 
> 赞同：20
> 
> 时间：2009-01-29T15:39:30.670
> 
> 标签：cocoa-touch, interface-builder

我使用界面构建器设置了标签栏控制器，每个标签栏项目都链接到一个视图控制器（4 个标签，4 个视图控制器）。我想知道 Interface Builder 是否使用一种`-init`方法来初始化视图控制器，因为显然这个方法没有被调用：

```
- (id)initWithNibName:(NSString *)nibNameOrNil bundle:(NSBundle *)nibBundleOrNil; 
```

...我想做一些初始化。我无法添加它，`-viewDidLoad`因为它会在内存警告的情况下被召回。任何的想法？

* * *

## 回答 #1

> 赞同：47
> 
> 时间：2009-01-29T16:20:40.150

从 a 加载的对象`*.(nib|xib)`初始化为：

```
- (id)initWithCoder:(NSCoder *)inCoder; 
```

因此，您可以覆盖它，或者如果在`-initWithCoder:`调用之后进行设置不是您可以使用的问题：

```
- (void)awakeFromNib; 
```

来自 NSNibAwaking 协议。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-01-29T16:28:58.480

我还要提到`initWithCoder`vs `awakeFromNib`。

通常，我`initWithCoder`在为对象分配内存或设置值时会覆盖。当您需要在连接 IBOutlets 后进行一些设置时，请覆盖`awakeFromNib`. 在此之前，IBOutlet 实例变量不会与其他视图和控件连接。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-01-29T16:12:47.140

听起来你想实现`-(void) awakeFromNib`.

[NSNibAwaking 协议参考（需要 ADC 登录）](http://developer.apple.com/DOCUMENTATION/Cocoa/Reference/ApplicationKit/Protocols/NSNibAwaking_Protocol/Reference/Reference.html)

# c# - C#枚举作为函数参数？

> ID：492115
> 
> 赞同：20
> 
> 时间：2009-01-29T15:40:38.577
> 
> 标签：c#, enums, loops, function-parameter

您可以将标准的 c# 枚举作为参数传递吗？

例如：

```
enum e1
{
    //...
}

enum e2
{
    //...
}

public void test()
{
    myFunc( e1 );
    myFunc( e2 );
}

public void myFunc( Enum e )
{
    // Iterate through all the values in e
} 
```

通过这样做，我希望检索任何给定枚举中的所有名称。迭代代码会是什么样子？

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2009-01-29T15:44:29.240

这！

```
 public void Foo(Enum e)
        {
            var names = Enum.GetNames(e.GetType());

            foreach (var name in names)
            {
                // do something!
            }
        } 
```

编辑：我的错，你*确实*说*iterate*。

注意：我知道我可以在我的 foreach 语句中调用 GetNames()，但我更喜欢先将这种类型的东西分配给方法调用，因为它便于调试。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-29T15:43:23.313

使用 Enum.GetNames( typeof(e) ) 方法，这将返回带有名称的字符串数组。

您还可以使用 Enum.GetValues 来获取对应值。

编辑 -Whoops - 如果您将参数作为 Enum 传递，则需要使用 e.GetType() 而不是 typeof() ，如果您将参数作为实际 Enum 类型名称传递，您将使用它。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-29T15:43:45.857

你的意思是像 Enum.GetNames 这样的东西？

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-01-29T15:44:39.163

枚举.GetValues 枚举.GetNames

所以像...

```
foreach(e1 value in Enum.GetValues(typeof(e1))) 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2012-11-07T18:23:02.623

如果您尝试将一个`enum`直接传递给，您将遇到麻烦`myFunc`，如下例所示：

```
enum e1 {something, other};
myFunc(e1);  // Syntax error: "e1 is a type, but is being used like a variable" 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-01-29T15:46:04.823

像这样：

```
 public void myFunc(Enum e)
    {
        foreach (var name in Enum.GetNames(typeof(e)))
        {
            Console.WriteLine(name);
        }
    } 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-06-19T12:51:20.557

正确的是：

```
public void myFunc(Enum e)
{
    foreach (var name in Enum.GetNames(e.GetTye()))
    {
        Console.WriteLine(name);
    }
} 
```

# c# - WPF：创建半椭圆按钮

> ID：492131
> 
> 赞同：1
> 
> 时间：2009-01-29T15:42:54.487
> 
> 标签：c#, wpf, button, ellipse

我认为这不太可能，但值得一试，看看你们怎么说。我正在尝试在 C# 中创建一个半椭圆按钮（不是 XAML，可能通过另一个曲线球）。如果我想要按钮的预定大小，我会使用图像或类似的东西，但由于大小发生变化，情况并非如此。这里有更多细节：

1.  我有一个带有 x 半径和 y 半径（或宽度和高度，分别乘以 2）的椭圆。

2.  我想要两个按钮来填充整个椭圆，每个按钮占据椭圆的一半。

3.  我不想要超出椭圆并被剪辑到父级的矩形按钮，我想要实际的椭圆按钮，除了每个按钮只有一半椭圆。

4.  如果这不能使用按钮完成，而是使用其他一些控件，那么我希望该控件能够像按钮一样工作。

任何帮助或建议或指示都会有很大帮助。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-29T16:08:10.673

在我回答这个问题之前，我很想知道为什么你必须在 WPF 应用程序中避免使用 XAML？无论如何，您几乎肯定会间接使用 XAML，所以为什么不使用它 - 让您的按钮变得轻而易举！这正是它的用途！

这就像当你站在砖头和砂浆旁边时试图用胶带盖房子一样！:)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-29T16:29:53.610

使用 XAML，说真的 XAML 乍一看可能会让人望而生畏，但它完全不像你试图在背后的代码中这样做而为自己创造的头痛。

[自定义 WPF 按钮样式](http://mark-dot-net.blogspot.com/2007/07/creating-custom-wpf-button-template-in.html)

[使用 Blend 进行造型的分步介绍](http://expression.microsoft.com/en-us/dd279541.aspx)

[XAML 级别 100](http://www.danielmoth.com/Blog/2008/05/xaml-level-100.html)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-07-28T19:47:43.427

您必须添加其他触发器（例如 IsPressed），但这应该会给您一个很好的主意：

```
<Button Height="30" Width="30">
    <Button.Style>
        <Style TargetType="{x:Type Button}">
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate>
                        <Path Name="HalfEllipse" Stroke="Black" StrokeThickness="1" Fill="Blue">
                            <Path.Data>
                                <PathGeometry>
                                    <PathFigure IsFilled="True" StartPoint="0,0">
                                        <PolyBezierSegment Points="5,30 25,30 30,0" />
                                    </PathFigure>
                                </PathGeometry>
                            </Path.Data>
                        </Path>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="HalfEllipse" Property="Fill">
                                    <Setter.Value>
                                        <SolidColorBrush Color="Green"/>
                                    </Setter.Value>
                                </Setter>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Button.Style>
</Button> 
```

有关更多信息，请参阅此页面：http: [//www.codeproject.com/KB/WPF/glassbuttons.aspx](http://www.codeproject.com/KB/WPF/glassbuttons.aspx)

# asp.net - 多个 UpdatePanel 和状态

> ID：492139
> 
> 赞同：1
> 
> 时间：2009-01-29T15:44:07.633
> 
> 标签：asp.net, ajax, asp.net-ajax, updatepanel, user-controls

我有一个具有多个更新面板的用户控件

在页面加载时，我将一个子用户控件动态加载到 PlaceHolder 上（我每次都这样做并且不检查回发）

我希望能够维护用户在 Child 用户控件中所做的更改的状态。（子用户控件具有 html 控件以及 asp.net 控件和其他自定义控件）。

每当单击导致回发的按钮 A 或 B 时，子用户控件都会丢失状态。UpdatePanels 的模式已设置为有条件的。

在 OnPageLoad 中，

1.  我将子控件加载到 PlaceHolderA
2.  这个子控件有另一个带有很多 JS 的用户控件。用户可能会在子控件中进行更改。
3.  当他们单击作为父控件一部分的按钮 A 时，OnPageLoad 会导致子控件重新加载，从而导致它丢失用户所做的客户端更改。

我想防止这种情况发生。

这是 ASPX 页面的 HTML 结构

```
<UpdatePanel1>
<UpdatePanelChild1>
    <Button A>
    <Button B>
</UpdatePanelChild1>
<UpdatePanelChild2>
    <PlaceHolderA>
</UpdatePanelChild2> 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-05T17:09:42.917

动态添加控件时，您需要在每次页面加载时重新添加它们。我不得不解决类似的困难，我通过两种方式做到这一点。在动态添加动态字段的地方，我实际上会在用户单击以填充或自己添加之前将隐藏控件添加到页面。通过创建这种占位符，系统有时间开始正确处理视图状态，这会保留用户的更改。我听到您提到的第二个问题是 chich 更新面板更新可能存在问题。可以将它们设置为有条件但在您的代码隐藏中，如果您需要从代码中触发更新，您还可以触发其他面板中的更新。这只是更新面板#.update()

或者，您也可以将所有更新面板包装在另一个面板中，但我建议不要这样做，因为它会浪费资源。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-10T16:42:34.250

看起来您正在丢失动态添加的子控件的 ViewState。

这是因为您在页面生命周期中添加它为时已晚： ViewState 在 Page.Load 事件之前加载。

尝试在 Page.Init 中添加您的子控件。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-29T16:10:38.687

> Blockquote //Asp.Net 代码中的代码

```
<form runat="server" id="form1">
           <asp:ScriptManager id="ScriptManager1" runat="server" >
                 <Services>
                    <asp:ServiceReference Path="/WebServices/MyService.asmx"/>
                 </Services>
            </asp:ScriptManager> 
        </form>    
            <script language="javascript" type="text/javascript">
                //call with namespace "WebSite" included 
                WebSite.WebServices.HelloWorld(EndHelloWorld);

                function EndHelloWorld()
                {
                    //do whatever
                }
            </script>    
    </form> 
```

> Blockquote //Web服务类中的代码

```
[ScriptService]
    public class MyService : System.Web.Services.WebService
    {
        [WebMethod]
        public void HelloWorld()
        {
           return "Hello world";
        }            
    } 
```

从我的页面脚本中，我将对我的 web 服务执行 Ajax，而回调 EndHelloWorld 你可以在不丢失状态的情况下做任何事情。

希望它有所帮助...亲切的问候。何塞马。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-29T15:49:03.613

您可以在控件中使用带有表单 runat 服务器的 ScriptManager，而不是更新面板。

这样你就没有回帖了。

这里有一个很好的参考：[http ://www.asp.net/Ajax/Documentation/Live/overview/ScriptManagerOverview.aspx](http://www.asp.net/Ajax/Documentation/Live/overview/ScriptManagerOverview.aspx)

问候。何塞马。 [http://www.learning-workshop.com](http://www.learning-workshop.com)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-29T16:16:45.073

看起来您需要删除嵌套的 UpdatePanel。在这样的结构中：

```
<ParentUpdatePanel>
  <ChildUpdatePanel1 />
  <ChildUpdatePanel2 />
</ParentUpdatePanel /> 
```

所有更新面板都将始终更新，即使子 UpdatePanel 设置为有条件的，因为实际上是父更新面板。因此，其中一个子级中的回发事件将导致父级更新。

使用这种类型的模式通常是不好的......如果您需要来自一个 UpdatePanel 的事件来导致另一个更新，您应该这样做：

```
<asp:UpdatePanel ID="up1" runat="server" UpdateMode="Conditional">
  <ContentTemplate>
    <asp:Button ID="buttonA" runat="server" />
    <asp:Button ID="buttonB" runat="server" />
  </ContentTemplate>
</asp:UpdatePanel>
<asp:UpdatePanel ID="up2" runat="server" UpdateMode="Conditional">
  <ContentTemplate>
    <asp:Placeholder ID="ph" runat="server" />
  </ContentTemplate>
  <Triggers>
    <asp:AsyncPostBackTrigger ControlID="buttonB" EventName="Click" />
  </Triggers>
</asp:UpdatePanel> 
```

# c# - 关于图案/设计的建议

> ID：492144
> 
> 赞同：0
> 
> 时间：2009-01-29T15:44:27.103
> 
> 标签：c#, design-patterns

我可以对我开发的软件使用一些建议/帮助。

该应用程序是一个向导风格的应用程序，用户在选择转到下一个表单或返回上一个表单之前填写每个表单上的字段。相当简单。

现在菜单调用 frmWiz1(InitialData) 并且当 frmWiz1 返回 DialogResult.OK 时，菜单将调用 frmWiz2(frmWiz1.Data) （不完全是，它存储来自每个表单的所有数据，并将这些引用传递给下一个表单）。每个数据对象都继承自 IPrintable 接口，该接口定义了打印自身的方法，因此在向导的最后一页（打印预览/签名）中，它将每个数据对象添加到仅遍历数据对象的自定义 PrintDocument 对象中，调用它们的打印功能和管理分页等。

最初我认为这是一个好主意，但现在我在想： - 菜单表单处理了太多的流逻辑。- 数据对象（处理适用于其特定数据集的所有业务逻辑）应该与打印逻辑分离（因为它们现在位于打印命名空间中 - 也许只是重定位会让我心生疑惑安逸）。

我不知道。我的语言不错，但我还是个设计新手。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-29T15:54:59.953

拧“frm”前缀！

关于应用程序的整体流程，我建议使用[应用程序控制器](http://martinfowler.com/eaaCatalog/applicationController.html)或类似的东西来集中逻辑。

就 UI 而言，每个向导阶段都应该是一个单独的用户控件（没有“取消”、“完成”、“下一步”或任何按钮），它被放置在带有上述按钮的根窗体上。

任何对象都不应该负责打印本身 - 使用*IPrinterService*来执行此操作。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-29T15:54:52.980

只是一些一般的想法：

*   [这是一个很棒的向导控件。](http://www.codeproject.com/KB/miscctrl/DesignTimeWizard.aspx)我们在工作中使用它，我必须说这个人用它做得很好。不确定它是否对您有用，但请查看

*   弄清楚你需要知道什么才能打印出一个对象。尝试提出您需要一个对象才能“可打印”的方法和/或事件。将它们放入接口中，并让您的业务对象实现该接口。然后，让您的打印助手类严格处理接口。

# php - 显示与标签相关的项目数量的最佳方式是什么？

> ID：492147
> 
> 赞同：0
> 
> 时间：2009-01-29T15:44:41.797
> 
> 标签：php, mysql

在遵循有关标签表结构[的](https://stackoverflow.com/questions/20856/how-do-you-recommend-implementing-tags-or-tagging/20871#20871)建议后，我实现了以下设计：

```
Table: Item
Columns: ItemID, Title, Content

Table: Tag
Columns: TagID, Title

Table: ItemTag
Columns: ItemID, TagID 
```

我面临另一个问题，我想显示每个标签出现在系统中的数字。就搜索查询/ php 代码而言，最好的方法是什么，不会造成严重的性能影响（每个项目都会出现标签计数）。

谢谢，

罗伊

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-29T15:51:08.667

> ```
> select count(*)
> from ItemTag
> where TagId = X 
> ```

是动态获取它的mySQL。

如果您担心性能下降，您应该在标签表中存储一个计数，并在您标记或取消标记项目时增加/减少它。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-29T15:51:55.137

很确定以下（SQL）将获得所有标签标题和它们在项目上出现频率的相关计数。

```
select tag.title, count(itemtag.tagid) 
from tag, itemtag
where itemtag.tagid = tag.tagid
group by tag.title 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-29T15:55:28.530

```
SELECT Tag.Title, COUNT(Tag.TagID) AS TagCount
FROM ItemTag
LEFT JOIN Tag ON
(ItemTag.TagID = Tag.TagID)
GROUP BY Tag.Title
ORDER BY Tag.Title 
```

为您提供标签列表（按字母顺序），后跟标签用于项目的次数。未使用的标签不会出现。

# c# - asp.net mvc框架信息传播

> ID：492158
> 
> 赞同：0
> 
> 时间：2009-01-29T15:47:22.277
> 
> 标签：c#, asp.net, html, asp.net-mvc

我有一个 asp 页面，其中包含一个包含两个字段的表单，客户应该在其中写入他/她的信息。

```
<td><%=Html.TextBox("Date")%></td>
<td><%=Html.TextBox("City")%></td> 
```

我的动作的签名（目前）看起来像这样：

```
public ActionResult XXX(string Date, string City) {...} 
```

问题是我想将一个简单的整数从我的视图传播到动作。是否有可能有一个隐藏的文本框或类似的东西？我希望我的动作签名看起来像这样：

```
public ActionResult CreateCourseDate(string Date, string City, int id) 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-29T15:56:27.717

有两种方法可以做到这一点。要么使用隐藏字段方法（我不建议这样做），要么将其添加到 url（路由值）。后者更适合 MVC 喜欢的类似 REST 的 url。因此，如果您使用的是新表单，那么您的 url 将如下所示：

```
http://example.com/course/newcoursedate/1 
```

这将编辑`course`id `1`。您将有一个相应的`create`操作，您的新表单将发布到该操作。下面的示例假设您的视图是使用`Course`模型进行强类型化的。如有必要，您还可以将 id 从 ViewData 中提取出来。

```
<% using (Html.BeginForm( "CreateCourseDate",
                          "Course",
                          new { id = ViewData.Model.CourseID }, ...

    ...

    <td><%=Html.TextBox("Date")%></td>
    <td><%=Html.TextBox("City")%></td>

<% } %> 
```

我没有看参数的顺序，但我相信至少有一个签​​名在控制器名称之后有路由值。请咨询源（或智能感知）以确定。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-29T15:56:23.523

您可以像这样传递其他值：

```
<%  using (Html.BeginForm("YourActionName", "YourControllerName", new { id = yourid })) { %>
...
<td><%=Html.TextBox("Date")%></td>
<td><%=Html.TextBox("City")%></td>
...
<input type="submit" value="Submit" />
<% } %> 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-29T15:55:50.183

是的，隐藏的输入将为此工作。显然，它必须采用相同的形式。

使用 Html.Hidden。

# apache-flex - 如何使用 Content-Type: image/jpeg 在 flex 中显示图像？

> ID：492160
> 
> 赞同：0
> 
> 时间：2009-01-29T15:47:45.067
> 
> 标签：apache-flex, actionscript-3

我有一个生成缩略图的 .aspx 页面。它接受一个 ID 并返回一个带有响应 Content-Type: image/jpeg 的图像。

如何在 Flex 中显示此图像？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-29T16:04:53.473

我相信这应该有效：

```
 <mx:Image source="http://localhost/webform.aspx?ID=1"/> 

```

您显然可以在 ActionScript 中设置源或使 URL 成为可绑定的字符串，以便您可以传入 ID。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-29T17:17:04.233

通常您使用`Image`标签，并且如果您在服务器上设置响应标头并正确编码字节（并且您正在安全沙箱中工作），您应该能够设置该`source`标签的属性（它需要不是@Embed-ded），然后完成：

```
<mx:Image source="http://someurl.com/myimagegenerator.php?id=123" /> 
```

您是否对这种方法有疑问，或者这只是一个一般信息问题？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-29T16:03:53.897

看看[装载机](http://livedocs.adobe.com/flex/3/langref/)

```
var loader:Loader = new Loader();
loader.load(new URLRequest("http://www.yoursite.com/yourasp.aspx?img=01001"));
addChild(loader); 
```

# delphi - 音频文件标记（读/写）库？

> ID：492170
> 
> 赞同：0
> 
> 时间：2009-01-29T15:49:55.750
> 
> 标签：delphi, file, audio

TagLib 似乎是一个不错的选择，但我不使用 C++ 并且对其他语言的绑定是有限的。目前我使用 ATL 库，但它自 2005 年以来就没有维护过，我自己也很难做到这一点。所以我正在寻找另一种正在积极开发的开源替代方案。你知道一个吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-05T16:50:18.757

你是说id3标签吗？Jedi 项目具有执行此操作的组件：http: [//sourceforge.net/project/showfiles.php](http://sourceforge.net/project/showfiles.php?group_id=45786) ?group_id=45786 查找 JvID3v1 和 JvID3v2。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-10-25T14:34:19.187

有一个名为 newac [http://code.google.com/p/newac/](http://code.google.com/p/newac/)的 Delphi 组件库，它具有 TagLib 的绑定。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-29T16:34:53.007

我没有亲自使用过它，但看起来[Audio::TagLib（在 CPAN 中）](http://search.cpan.org/~dongxu/Audio-TagLib-1.43/lib/Audio/TagLib.pm)是一个 Perl 接口/TagLib 的替代品。

# asp.net - ASP.net 下拉动态样式，然后记住中止提交的样式

> ID：492177
> 
> 赞同：0
> 
> 时间：2009-01-29T15:52:12.127
> 
> 标签：asp.net, drop-down-menu, postback, styles, dynamic-css

所以，我有一个 ASP 下拉列表（这是 .net 2.0）。我将它与数据绑定。基本上，当页面加载并且它不是回发时，我们将获取记录数据，绑定所有下拉菜单，并将它们设置为适当的值（严格来说，我们：使用数据库中的基本数据集初始化页面，绑定下拉菜单从数据库中，从数据库中获取实际记录数据，此时将溺水设置为适当的设置）。我想要做的是有选择地设置列表选项的样式。所以数据库返回 3 个项目：ID、文本和一个标志，指示我的记录是否是“活动的”（我会适当地设置样式）。这很容易做到，我已经做到了。

我的问题是当表单提交停止时会发生什么。我们稍微扩展了 Page 类并创建了一个 AddError() 方法，该方法将从失败的业务规则检查中创建一个错误列表，然后将它们显示在 ValidationSummary 中。在提交按钮的点击事件中，它的工作原理如下：

```
CheckBizRules();

if(Page.IsValid)
{
    SaveData();
} 
```

如果任何业务规则检查失败，则页面将无效。问题是，当页面重新渲染（启用视图，但没有数据反弹）时，我美丽的条件样式现在很遗憾地消失了，去生活在丢失袜子的土地上。我需要保存它。

我希望在这里避免另一个数据库调用（例如，如果页面无效，则再次从数据库中获取列表数据，只是为了重新设置列表样式）。但是，如果这是我的行动方针，那还不是世界末日。我希望有人可能有其他建议。

我想不出如何更好地表达这个问题，如果有人有任何建议或需要澄清，请毫不犹豫地得到它，如果需要的话。;)

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-30T12:32:18.957

*好吧，除了在页面无效*时去数据库重新检索我的列表数据并重新设置控件样式外，我什么也想不出来。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-20T17:40:43.923

我不确定我是否完全理解您将哪种样式应用于下拉项，但似乎这种样式是控件不保留跨回发的东西。因此，通常这种信息需要保存在 ViewState 中。我看到两个选项（除了从数据库重新加载）：

第一种方法：创建自己的下拉控件，继承自 DropDownList。然后在设置项目样式时将样式数据保存在控件的 ViewState 包中：

```
public void SetItemActive(ListItem item)
       {
         ViewState[item.Value] = "active";           
        } 
```

然后覆盖 OnRender

```
protected override void Render(HtmlTextWriter writer)
{

   ....

   foreach(ListItem item in Items)
   {
    if ( ViewState[item.Value] == "active")
    { 
            ** RenderActiveItem **
    }
    else 
    {
            ** RenderNormalItem **

    }

} 
```

第二种方法：将活动 ID 保存在页面的 ViewState 中，然后使用来自 ViewState 而不是来自数据库的数据重新设置每个回发的下拉菜单的样式

# c# - WINOLEAPI 的 C# 数据类型是什么？

> ID：492181
> 
> 赞同：0
> 
> 时间：2009-01-29T15:52:41.877
> 
> 标签：c#, com

我正在使用一些本机方法来绑定到基于 COM 的应用程序中正在运行的对象。其中一种方法是 CreateBindCtx，它具有以下签名（来自 MSDN）

```
WINOLEAPI CreateBindCtx(DWORD reserved, LPBC FAR * ppbc) 
```

我已将包装器定义为

```
public static extern void CreateBindCtx(int reserved, out IBindCtx ppbc); 
```

但 FXCop 抱怨返回类型为 void。.Net/C# 数据类型应该是什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-29T15:55:54.367

```
[DllImport("ole32.dll")]
static extern int CreateBindCtx(uint reserved, out IBindCtx ppbc); 
```

pinvoke 信息的最佳位置之一是[PInvoke.Net](http://pinvoke.net)

# java - 如何在 Java 中找到给定类的所有子类？

> ID：492184
> 
> 赞同：222
> 
> 时间：2009-01-29T15:53:02.780
> 
> 标签：java, class, interface, subclass

如何在 Java 中查找给定类的所有子类（或给定接口的所有实现者）？到目前为止，我有一种方法可以做到这一点，但我发现它效率很低（至少可以这么说）。方法是：

1.  获取类路径上存在的所有类名的列表
2.  加载每个类并测试它是否是所需类或接口的子类或实现者

在 Eclipse 中，有一个很好的特性，称为类型层次结构，它可以非常有效地显示这一点。如何以编程方式进行操作？

* * *

## 回答 #1

> 赞同：138
> 
> 时间：2009-01-30T15:13:56.260

使用纯 Java 扫描类并不容易。

Spring 框架提供了一个名为[ClassPathScanningCandidateComponentProvider](http://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/context/annotation/ClassPathScanningCandidateComponentProvider.html)的类，可以满足您的需要。以下示例将在包 org.example.package 中找到 MyClass 的所有子类

```
ClassPathScanningCandidateComponentProvider provider = new ClassPathScanningCandidateComponentProvider(false);
provider.addIncludeFilter(new AssignableTypeFilter(MyClass.class));

// scan in org.example.package
Set<BeanDefinition> components = provider.findCandidateComponents("org/example/package");
for (BeanDefinition component : components)
{
    Class cls = Class.forName(component.getBeanClassName());
    // use class cls found
} 
```

这种方法的额外好处是使用字节码分析器来查找候选者，这意味着它*不会*加载它扫描的所有类。

* * *

## 回答 #2

> 赞同：81
> 
> 时间：2009-01-29T15:58:52.300

除了您所描述的，没有其他方法可以做到这一点。想一想——如果不扫描类路径上的每个类，谁能知道哪些类扩展了 ClassX？

Eclipse 只能在看似“有效”的时间内告诉您有关超类和子类的信息，因为它已经在您按下“在类型层次结构中显示”按钮时加载了所有类型数据（因为它是不断地编译你的类，知道类路径上的一切，等等）。

* * *

## 回答 #3

> 赞同：49
> 
> 时间：2009-01-29T16:02:26.537

仅使用内置的 Java 反射 API 无法做到这一点。

存在一个项目，对您的类路径进行必要的扫描和索引，以便您可以访问此信息...

## [思考](https://github.com/ronmamo/reflections)

> **Java 运行时元数据分析，本着 Scannotations 的精神**
> 
> Reflections 扫描您的类路径，索引元数据，允许您在运行时查询它，并且可以为项目中的许多模块保存和收集该信息。
> 
> 使用反射，您可以查询元数据：
> 
> *   获取某种类型的所有子类型
> *   获取所有带有一些注释的类型
> *   获取所有带有一些注解的类型，包括注解参数匹配
> *   获取所有带有一些注释的方法

（免责声明：我没有使用它，但该项目的描述似乎完全符合您的需求。）

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2015-09-24T14:55:53.397

试试[ClassGraph](https://github.com/classgraph/classgraph)。（免责声明，我是作者）。ClassGraph 支持在运行时或构建时扫描给定类的子类，但还支持更多。ClassGraph 可以在内存中为类路径上的所有类或选定包中的类构建整个类图（所有类、注释、方法、方法参数和字段）的抽象表示，但是您可以查询这个类图你要。ClassGraph 支持比任何其他扫描器[更多的类路径规范机制和类加载器](https://github.com/classgraph/classgraph/wiki/Classpath-Specification-Mechanisms)，并且还可以与新的 JPMS 模块系统无缝协作，因此如果您的代码基于 ClassGraph，您的代码将具有最大的可移植性。[请参阅此处的 API。](https://github.com/classgraph/classgraph/wiki/ClassGraph-API)

* * *

## 回答 #5

> 赞同：11
> 
> 时间：2009-01-29T22:57:11.317

不要忘记为一个类生成的[Javadoc](http://java.sun.com/j2se/javadoc/)将包含一个已知子类的列表（对于接口，还有已知的实现类）。

* * *

## 回答 #6

> 赞同：9
> 
> 时间：2011-04-20T19:29:56.580

我知道我参加这个聚会晚了几年，但我遇到了这个问题，试图解决同样的问题。如果您正在编写 Eclipse 插件（并因此利用它们的缓存等），您可以以编程方式使用 Eclipse 的内部搜索来查找实现接口的类。这是我的（非常粗略的）第一次剪辑：

```
 protected void listImplementingClasses( String iface ) throws CoreException
  {
    final IJavaProject project = <get your project here>;
    try
    {
      final IType ifaceType = project.findType( iface );
      final SearchPattern ifacePattern = SearchPattern.createPattern( ifaceType, IJavaSearchConstants.IMPLEMENTORS );
      final IJavaSearchScope scope = SearchEngine.createWorkspaceScope();
      final SearchEngine searchEngine = new SearchEngine();
      final LinkedList<SearchMatch> results = new LinkedList<SearchMatch>();
      searchEngine.search( ifacePattern, 
      new SearchParticipant[]{ SearchEngine.getDefaultSearchParticipant() }, scope, new SearchRequestor() {

        @Override
        public void acceptSearchMatch( SearchMatch match ) throws CoreException
        {
          results.add( match );
        }

      }, new IProgressMonitor() {

        @Override
        public void beginTask( String name, int totalWork )
        {
        }

        @Override
        public void done()
        {
          System.out.println( results );
        }

        @Override
        public void internalWorked( double work )
        {
        }

        @Override
        public boolean isCanceled()
        {
          return false;
        }

        @Override
        public void setCanceled( boolean value )
        {
        }

        @Override
        public void setTaskName( String name )
        {
        }

        @Override
        public void subTask( String name )
        {
        }

        @Override
        public void worked( int work )
        {
        }

      });

    } catch( JavaModelException e )
    {
      e.printStackTrace();
    }
  } 
```

到目前为止，我看到的第一个问题是我只捕获直接实现接口的类，而不是它们的所有子类——但是一点递归不会伤害任何人。

* * *

## 回答 #7

> 赞同：9
> 
> 时间：2012-05-14T21:08:28.590

几年前我就这样做了。最可靠的方法（即使用官方 Java API 且没有外部依赖项）是编写自定义 doclet 以生成可在运行时读取的列表。

您可以像这样从命令行运行它：

```
javadoc -d build -doclet com.example.ObjectListDoclet -sourcepath java/src -subpackages com.example 
```

或者像这样从 ant 运行它：

```
<javadoc sourcepath="${src}" packagenames="*" >
  <doclet name="com.example.ObjectListDoclet" path="${build}"/>
</javadoc> 
```

这是基本代码：

```
public final class ObjectListDoclet {
    public static final String TOP_CLASS_NAME =  "com.example.MyClass";        

    /** Doclet entry point. */
    public static boolean start(RootDoc root) throws Exception {
        try {
            ClassDoc topClassDoc = root.classNamed(TOP_CLASS_NAME);
            for (ClassDoc classDoc : root.classes()) {
                if (classDoc.subclassOf(topClassDoc)) {
                    System.out.println(classDoc);
                }
            }
            return true;
        }
        catch (Exception ex) {
            ex.printStackTrace();
            return false;
        }
    }
} 
```

为简单起见，我删除了命令行参数解析，并且正在写入 System.out 而不是文件。

* * *

## 回答 #8

> 赞同：7
> 
> 时间：2013-08-11T18:34:56.513

请记住其他答案中提到的限制，您还可以通过以下方式使用[openpojo`PojoClassFactory`](https://code.google.com/p/openpojo/wiki/Documentation#Reflection_package)（[在 Maven 上可用）：](http://search.maven.org/#search%7Cga%7C1%7Copenpojo)

```
for(PojoClass pojoClass : PojoClassFactory.enumerateClassesByExtendingType(packageRoot, Superclass.class, null)) {
    System.out.println(pojoClass.getClazz());
} 
```

`packageRoot`您希望搜索的包的根字符串在哪里（例如`"com.mycompany"`，甚至只是`"com"`），并且`Superclass`是您的超类型（这也适用于接口）。

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2017-02-02T17:32:36.130

我只是写了一个简单的演示来使用`org.reflections.Reflections`来获取抽象类的子类：

[https://github.com/xmeng1/ReflectionsDemo](https://github.com/xmeng1/ReflectionsDemo)

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2017-08-10T04:05:41.860

根据您的特定要求，在某些情况下，Java 的[服务加载器](https://docs.oracle.com/javase/8/docs/api/java/util/ServiceLoader.html)机制可能会实现您所追求的。

简而言之，它允许开发人员通过在 JAR/WAR 文件`META-INF/services`目录中的文件中列出某个类来显式声明某个类是某个其他类的子类（或实现某个接口）。然后可以使用[`java.util.ServiceLoader`](https://docs.oracle.com/javase/8/docs/api/java/util/ServiceLoader.html)类发现它，当给定一个`Class`对象时，该类将生成该类的所有声明的子类的实例（或者，如果`Class`代表一个接口，则所有实现该接口的类）。

这种方法的主要优点是不需要手动扫描整个类路径中的子类——所有发现逻辑都包含在`ServiceLoader`类中，它只加载`META-INF/services`目录中显式声明的类（不是类路径上的每个类） .

但是，也有一些缺点：

*   它不会找到**所有**子类，只会找到那些明确声明的子类。因此，如果您需要真正找到所有子类，这种方法可能不够用。
*   它需要开发者显式声明`META-INF/services`目录下的类。这对开发人员来说是一个额外的负担，并且容易出错。
*   `ServiceLoader.iterator()`生成子类实例，而不是它们的对象`Class`。这会导致两个问题：
    *   您对如何构造子类没有任何发言权 - 无参数构造函数用于创建实例。
    *   因此，子类必须具有默认构造函数，或者必须显式声明无参数构造函数。

显然，Java 9 将解决其中一些缺点（特别是关于子类实例化的缺点）。

### 一个例子

假设您有兴趣查找实现接口的类`com.example.Example`：

```
package com.example;

public interface Example {
    public String getStr();
} 
```

该类`com.example.ExampleImpl`实现了该接口：

```
package com.example;

public class ExampleImpl implements Example {
    public String getStr() {
        return "ExampleImpl's string.";
    }
} 
```

您可以通过创建包含 text的文件来声明该类`ExampleImpl`是 的实现。`Example``META-INF/services/com.example.Example``com.example.ExampleImpl`

然后，您可以获得每个实现的`Example`实例（包括 的实例`ExampleImpl`），如下所示：

```
ServiceLoader<Example> loader = ServiceLoader.load(Example.class)
for (Example example : loader) {
    System.out.println(example.getStr());
}

// Prints "ExampleImpl's string.", plus whatever is returned
// by other declared implementations of com.example.Example. 
```

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2009-01-29T16:31:31.610

还应该注意的是，这当然只会找到当前类路径中存在的所有子类。大概这对于您当前正在查看的内容是可以的，并且您可能确实考虑过这一点，但是如果您在任何时候将非`final`类释放到野外（对于不同级别的“野生”），那么完全可行的是其他人编写了他们自己的子类，您不会知道。

因此，如果您碰巧想要查看所有子类，因为您想要进行更改并且将要查看它如何影响子类的行为 - 那么请记住您看不到的子类。理想情况下，您的所有非私有方法和类本身都应该有详细的文档；根据本文档进行更改而不更改方法/非私有字段的语义，并且您的更改应该是向后兼容的，至少对于遵循您的超类定义的任何子类。

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2009-01-29T23:10:50.227

您看到您的实现与 Eclipse 之间存在差异的原因是因为您每次都扫描，而 Eclipse（和其他工具）只扫描一次（在大多数情况下在项目加载期间）并创建索引。下次您请求数据时，它不会再次扫描，而是查看索引。

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2017-08-03T08:48:39.707

我正在使用反射库，它会扫描您的所有子类的类路径：[https ://github.com/ronmamo/reflections](https://github.com/ronmamo/reflections)

这是如何完成的：

```
Reflections reflections = new Reflections("my.project");
Set<Class<? extends SomeType>> subTypes = reflections.getSubTypesOf(SomeType.class); 
```

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2015-04-14T04:15:21.300

将它们添加到父类构造函数（或创建默认构造函数）内部的静态映射（this.getClass().getName()），但这将在运行时更新。如果延迟初始化是一个选项，您可以尝试这种方法。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2018-04-20T16:51:31.237

我需要将其作为测试用例来执行，以查看是否已将新类添加到代码中。这就是我所做的

```
final static File rootFolder = new File(SuperClass.class.getProtectionDomain().getCodeSource().getLocation().getPath());
private static ArrayList<String> files = new ArrayList<String>();
listFilesForFolder(rootFolder); 

@Test(timeout = 1000)
public void testNumberOfSubclasses(){
    ArrayList<String> listSubclasses = new ArrayList<>(files);
    listSubclasses.removeIf(s -> !s.contains("Superclass.class"));
    for(String subclass : listSubclasses){
        System.out.println(subclass);
    }
    assertTrue("You did not create a new subclass!", listSubclasses.size() >1);     
}

public static void listFilesForFolder(final File folder) {
    for (final File fileEntry : folder.listFiles()) {
        if (fileEntry.isDirectory()) {
            listFilesForFolder(fileEntry);
        } else {
            files.add(fileEntry.getName().toString());
        }
    }
} 
```

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2020-03-05T11:07:57.773

您可以使用 org.reflections 库，然后创建 Reflections 类的对象。使用此对象，您可以获得给定类的所有子类的列表。 [https://www.javadoc.io/doc/org.reflections/reflections/0.9.10/org/reflections/Reflections.html](https://www.javadoc.io/doc/org.reflections/reflections/0.9.10/org/reflections/Reflections.html)

```
 Reflections reflections = new Reflections("my.project.prefix");
    System.out.println(reflections.getSubTypesOf(A.class))); 
```

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2020-12-11T08:59:36.680

如果您打算加载同一包中给定类的所有子类，您可以这样做：

```
public static List<Class> loadAllSubClasses(Class pClazz) throws IOException, ClassNotFoundException {
    ClassLoader classLoader = pClazz.getClassLoader();
    assert classLoader != null;
    String packageName = pClazz.getPackage().getName();
    String dirPath = packageName.replace(".", "/");
    Enumeration<URL> srcList = classLoader.getResources(dirPath);

    List<Class> subClassList = new ArrayList<>();
    while (srcList.hasMoreElements()) {
        File dirFile = new File(srcList.nextElement().getFile());
        File[] files = dirFile.listFiles();
        if (files != null) {
            for (File file : files) {
                String subClassName = packageName + '.' + file.getName().substring(0, file.getName().length() - 6);
                if (! subClassName.equals(pClazz.getName())) {
                    subClassList.add(Class.forName(subClassName));
                }
            }
        }
    }

    return subClassList;
} 
```

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2021-04-22T04:47:52.540

查找类路径中的所有类

```
public static List<String> getClasses() {
        URLClassLoader urlClassLoader = (URLClassLoader) Thread.currentThread().getContextClassLoader();
        List<String> classes = new ArrayList<>();
        for (URL url : urlClassLoader.getURLs()) {
            try {
                if (url.toURI().getScheme().equals("file")) {
                    File file = new File(url.toURI());
                    if (file.exists()) {
                        try {
                            if (file.isDirectory()) {
                                for (File listFile : FileUtils.listFiles(file, new String[]{"class"}, true)) {
                                    String classFile = listFile.getAbsolutePath().replace(file.getAbsolutePath(), "").replace(".class", "");
                                    if (classFile.startsWith(File.separator)) {
                                        classFile = classFile.substring(1);
                                    }
                                    classes.add(classFile.replace(File.separator, "."));
                                }
                            } else {
                                JarFile jarFile = new JarFile(file);
                                if (url.getFile().endsWith(".jar")) {
                                    Enumeration<JarEntry> entries = jarFile.entries();
                                    while (entries.hasMoreElements()) {
                                        JarEntry jarEntry = entries.nextElement();
                                        if (jarEntry.getName().endsWith(".class")) {
                                            classes.add(jarEntry.getName().replace(".class", "").replace("/", "."));
                                        }
                                    }
                                }
                            }
                        } catch (IOException e) {
                            e.printStackTrace();
                        }
                    }
                }
            } catch (URISyntaxException e) {
                e.printStackTrace();
            }
        }
        return classes;
    } 
```

# vb.net - Windows Server 2003 上的 SocketException

> ID：492188
> 
> 赞同：1
> 
> 时间：2009-01-29T15:53:55.400
> 
> 标签：vb.net, sockets, windows-server-2003

我正在尝试在 Windows Server 2003 上启动并运行一个 FTP 应用程序，在此应用程序在 Windows XP Professional 上运行之前没有问题。我已经尝试在谷歌上搜索答案，但我似乎在微软网站上找到的唯一“解决方法”并没有纠正问题（正在编辑注册表并添加一个值为 1 的新字段 DisableRawSecurity（在正确的区域） . 我在 VB .Net 中调试这个应用程序

例外：试图以访问权限禁止的方式访问套接字。这里要求的是子的源代码，它遇到了问题：

```
Private Sub Listen()
        Try

            ListenerSocket.Bind(LocalEndPoint)
            ListenerSocket.Listen(100)
            While True 
            ListenerSocket.BeginAccept(New AsyncCallback(AddressOf AcceptCallback), ListenerSocket)
            End While
        Catch ex As System.Exception
            Stop
        End Try
        ListenerSocket.Shutdown(SocketShutdown.Both)
    End Sub 
```

任何帮助，将不胜感激。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-16T18:26:20.913

您可能会遇到问题，因为对 BeginAccept 的调用处于无限循环中。您应该只调用一次，直到 AsyncCallback 被击中，然后再次调用 EndAccept 和 BeginAccept。所以基本上你调用 BeginAccept 一次开始，然后在每个连接建立后再次调用。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-01T16:33:43.413

Windows 中的所有内容都有一个访问控制列表 (ACL)。在我看来，运行您的应用程序的用户在 ACL 中没有适当的权限来执行您要求它执行的操作。我不确定您将如何寻找原始套接字的 ACL，但这就是我要开始寻找的地方。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-09-19T20:51:37.067

您甚至在您的应用程序中使用原始套接字吗？如果不是，则该知识库文章不适用，并且您的例外是由于其他原因。

# can-bus - CAN接口物理内存地址

> ID：492195
> 
> 赞同：-1
> 
> 时间：2009-01-29T15:55:43.010
> 
> 标签：can-bus

我在哪里/如何找到我的 CAN 接口卡的物理内存地址？

我需要用它来打开一个端口。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-29T16:28:14.503

由于它是 PCI 卡，图书馆应该知道它在哪里以及如何访问它。但是，如果您必须拥有用于特定目的的物理地址，则可以在 Windows 的设备管理器中查找，或者在 linux 或 Mac 的等效项中查找。在很多情况下，由 BIOS 分配的地址不会被操作系统更改，因此您通常可以在启动时找到。

您还可以在您的软件中获取 PCI 供应商和卡 ID，并通过这种方式获取分配的内存范围。

但是，图书馆应该透明地处理所有这些。您是否联系过供应商以正确使用库？应该有一个“查找卡”功能，它返回已安装和可用的卡，然后您可以使用简单的索引来访问给定的卡。

如果您提供卡制造商的名称和类型，那么我们可以提供更好的帮助 - Vector 的卡几乎易于查找和控制，而且我使用过的大多数 CAN 卡都很容易处理。

-亚当

# xml - 任何拥有描述 Delphi TClientDataSet XML 文件的 METADATA 部分的部分 XSD 的人？

> ID：492198
> 
> 赞同：9
> 
> 时间：2009-01-29T15:56:12.477
> 
> 标签：xml, delphi, xsd, tclientdataset

我知道您无法使用 XSD 架构完全描述 TClientDataSet 的 XML，因为 ROW 元素具有名称随内容变化的属性。

但是，这种 XML 的 METADATA 部分应该是。

那么：有没有人有一个（部分）XSD 来描述可以用 Delphi TClientDataSets 保存的 XML 的元数据部分？

问候。

PS：

感谢指向 XML->XSD 转换工具/站点的指针；我应该写到我自己也这样做了，但是以适当的方式生成 XSD（即涵盖所有可能性的方式）将需要涵盖所有可能性的输入 XML（如往返、行状态等）。我将尝试以这种方式提出一个体面的 XSD 并将其发布在这里。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-01-29T16:30:13.390

好吧，我也找不到，所以我使用[这个网站](http://www.hitsw.com/xml_utilites/)基于 ClientDataSet XML 文件生成了这个模式。

```
<?xml version="1.0" encoding="UTF-8" ?>

<xs:schema xmlns:xs="http://www.w3.org/2001/XMLSchema">
  <xs:element name="DATAPACKET">
    <xs:complexType>
      <xs:sequence>
        <xs:element ref="METADATA" />
        <xs:element ref="ROWDATA" />
      </xs:sequence>
      <xs:attribute name="Version" type="xs:NMTOKEN" use="required" />
    </xs:complexType>
  </xs:element>

  <xs:element name="FIELD">
    <xs:complexType>
      <xs:attribute name="fieldtype" type="xs:NMTOKEN" use="required" />
      <xs:attribute name="WIDTH" type="xs:NMTOKEN" use="optional" />
      <xs:attribute name="attrname" type="xs:NMTOKEN" use="required" />
      <xs:attribute name="required" type="xs:NMTOKEN" use="optional" />
    </xs:complexType>
  </xs:element>

  <xs:element name="FIELDS">
    <xs:complexType>
      <xs:sequence>
        <xs:element ref="FIELD" maxOccurs="unbounded" />
      </xs:sequence>
    </xs:complexType>
  </xs:element>

  <xs:element name="METADATA">
    <xs:complexType>
      <xs:sequence>
        <xs:element ref="FIELDS" />
        <xs:element ref="PARAMS" />
      </xs:sequence>
    </xs:complexType>
  </xs:element>

  <xs:element name="PARAMS">
    <xs:complexType>
      <xs:attribute name="CHANGE_LOG" type="xs:string" use="required" />
    </xs:complexType>
  </xs:element>

  <xs:element name="ROW">
    <xs:complexType>
    </xs:complexType>
  </xs:element>

  <xs:element name="ROWDATA">
    <xs:complexType>
      <xs:sequence>
        <xs:element ref="ROW" maxOccurs="unbounded" />
      </xs:sequence>
    </xs:complexType>
  </xs:element>

</xs:schema> 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-31T20:13:55.903

**编辑：**
将 XSD 分成两部分，并通过在`Delphi XE`: `dsconst.h`, `dspickle.h`, . 中使用这些文件使其更加完整`dsxml.h`。
如有补充请PM或评论。

到目前为止，下面的 XSD 文件似乎工作正常；如果您的 TClientDataSet XML 无法通过此验证，请将您的 XML 电子邮件发送给我（谷歌我或在下面评论我的邮件地址）。

首先是文件`CDS.xsd`，其中包括`CDS_METADATA_FIELDS_include.xsd`进一步的文件。
它定义了 TClientDataSet XML 文档的基本结构：`DATAPACKET`、包含`METADATA`和`ROWDATA`、其中`METADATA`包含`FIELDS`和`PARAMS`、以及`ROWDATA`包含`ROW`元素：

```
<?xml version="1.0" encoding="UTF-8"?>
<xs:schema xmlns:xs="http://www.w3.org/2001/XMLSchema">
    <xs:include schemaLocation="CDS_METADATA_FIELDS_include.xsd"/>
    <!-- DATAPACKET/datapacket -->
    <xs:element name="DATAPACKET" type="datapacket"/>
    <xs:complexType name="datapacket">
        <xs:sequence>
            <xs:element ref="METADATA"/>
            <xs:element ref="ROWDATA"/>
        </xs:sequence>
        <xs:attribute name="Version" type="xs:NMTOKEN" use="required"/>
    </xs:complexType>
    <!-- METADATA/metadata -->
    <xs:element name="METADATA" type="metadata"/>
    <xs:complexType name="metadata">
        <xs:sequence>
            <xs:element ref="FIELDS"/>
            <xs:element ref="PARAMS"/>
        </xs:sequence>
    </xs:complexType>
    <!-- PARAMS/params -->
    <xs:element name="PARAMS" type="params"/>
    <xs:complexType name="params">
        <xs:attribute name="MD_FIELDLINKS" type="xs:string" use="optional"/>
        <xs:attribute name="DEFAULT_ORDER" type="xs:positiveInteger"/>
        <xs:attribute name="LCID" type="xs:positiveInteger"/>
        <xs:attribute name="CHANGE_LOG" type="xs:string" use="optional"/>
        <xs:attribute name="PRIMARY_KEY" type="xs:positiveInteger" use="optional"/>
    </xs:complexType>
    <!-- ROWDATA/rowdata -->
    <xs:element name="ROWDATA" type="rowdata"/>
    <xs:complexType name="rowdata">
        <xs:sequence>
            <xs:element ref="ROW" minOccurs="0" maxOccurs="unbounded"/>
        </xs:sequence>
    </xs:complexType>
    <!-- ROW/row -->
    <xs:element name="ROW" type="row"/>
    <xs:complexType name="row">
        <xs:sequence>
            <xs:any namespace="##any" processContents="lax" minOccurs="0" maxOccurs="unbounded"/>
        </xs:sequence>
        <xs:attribute name="RowState" type="xs:NMTOKEN" use="optional"/>
        <xs:anyAttribute namespace="##any" processContents="lax"/>
    </xs:complexType>
</xs:schema> 
```

请注意，`ROW`元素的类型非常松散，因为它们将包含动态定义的属性名称。

然后是`CDS_METADATA_FIELDS_include.xsd`包含`FIELDS`和`PARAMS`元素使用的基础元数据的文件。
它还没有完全完成，因为我还没有找到包含下面评论中提到的关键字的 CDS XML 文件。

```
<?xml version="1.0" encoding="UTF-8"?>
<!-- include portion of the METADATA FIELDS that CDS uses -->
<xs:schema xmlns:xs="http://www.w3.org/2001/XMLSchema">
  <!-- FIELDS/fields -->
  <xs:element name="FIELDS" type="fields"/>
  <xs:complexType name="fields">
    <xs:sequence>
      <xs:element ref="FIELD" maxOccurs="unbounded"/>
    </xs:sequence>
  </xs:complexType>
  <!-- FIELD/field -->
  <xs:element name="FIELD" type="field"/>
  <xs:complexType name="field">
    <xs:sequence>
      <xs:element ref="PARAM" minOccurs="0"/>
      <!-- FIELDS is for nested datasets -->
      <xs:element ref="FIELDS" minOccurs="0" maxOccurs="unbounded"/>
      <!-- PARAMS is for nested datasets -->
      <xs:element name="PARAMS" type="fieldParams" minOccurs="0" maxOccurs="unbounded"/>
    </xs:sequence>
    <!-- fieldname is used when the DBMS allows for non-identifier characters (like spaces) in fieldnames -->
    <xs:attribute name="fieldname" use="optional" type="xs:string"/>
    <xs:attribute name="fieldtype" use="required" type="FIELDTYPE"/>
    <xs:attribute name="SUBTYPE" use="optional" type="subtype"/>
    <!-- DECIMALS is for BCD -->
    <xs:attribute name="DECIMALS" type="xs:positiveInteger" use="optional"/>
    <!-- WIDTH is for Character, BCD, Bytes and Unicode -->
    <xs:attribute name="WIDTH" type="xs:positiveInteger" use="optional"/>
    <xs:attribute name="attrname" type="xs:Name" use="required"/>
<!-- need to incorporate these; probably as attributes as FIELD :
#define szUNIQUE_KEY          "UNIQUE_KEY"
#define szSERVER_COL          "SERVER_COL"
#define szCONSTRAINTS         "CONSTRAINTS"
#define szDATASET_CONTEXT     "DATASET_CONTEXT"
#define szDATASET_DELTA       "DATASET_DELTA"
#define szREADONLY            "READONLY"
#define szBDEDOMX             "BDEDOMAIN_X"
#define szBDERECX             "BDERECORD_X"
#define szBDEDEFX             "BDEDEFAULT_X"
#define szAUTOINCVALUE        "AUTOINCVALUE"
#define szELEMENTS            "ELEMENTS"
#define szTABLENAME           "TABLENAME"
#define szTYPENAME            "TYPENAME"
#define szUPDATEMODE          "UPDATEMODE"
#define szMD_SEMANTICS        "MD_SEMANTICS"
#define szCALCULATED          "CALCULATED"
#define szFIELDNAME          "FIELDNAME"
-->
  </xs:complexType>
  <!-- fieldParams -->
  <xs:complexType name="fieldParams">
    <xs:attribute name="DEFAULT_ORDER" type="xs:positiveInteger"/>
    <xs:attribute name="PRIMARY_KEY" type="xs:positiveInteger"/>
    <xs:attribute name="LCID" type="xs:positiveInteger"/>
  </xs:complexType>
  <!-- FIELDTYPE -->
  <xs:simpleType name="FIELDTYPE">
    <xs:restriction base="xs:Name">
      <!-- observed in real life CDS XML: -->
      <xs:enumeration value="byte"/>
      <!-- from Delphi XE file dsxml.h: -->
      <xs:enumeration value="i1"/>
      <xs:enumeration value="i2"/>
      <xs:enumeration value="i4"/>
      <xs:enumeration value="i8"/>
      <xs:enumeration value="ui1"/>
      <xs:enumeration value="ui2"/>
      <xs:enumeration value="ui4"/>
      <xs:enumeration value="ui8"/>
      <xs:enumeration value="r4"/>
      <xs:enumeration value="r8"/>
      <xs:enumeration value="r10"/>
<!-- szXMLFloat/szXMLNumber <xs:enumeration value="r8"/> -->
      <xs:enumeration value="fixed"/>
      <xs:enumeration value="fixedFMT"/>
      <xs:enumeration value="boolean"/>
      <xs:enumeration value="date"/>
      <xs:enumeration value="dateTime"/>
      <xs:enumeration value="time"/>
      <xs:enumeration value="array"/>
      <xs:enumeration value="struct"/>
      <xs:enumeration value="nested"/>
      <xs:enumeration value="string.uni"/>
      <xs:enumeration value="string"/>
      <xs:enumeration value="bin.hex"/>
      <xs:enumeration value="IntArray"/>
      <xs:enumeration value="UIntArray"/>
      <xs:enumeration value="SQLdateTime"/>
      <xs:enumeration value="SQLdateTimeOffset"/>
    </xs:restriction>
  </xs:simpleType>
  <!-- subtype -->
  <xs:simpleType name="subtype">
    <xs:restriction base="xs:Name">
      <xs:enumeration value="Text"/>
      <xs:enumeration value="Binary"/>
      <xs:enumeration value="Formatted"/>
      <xs:enumeration value="Ole"/>
      <xs:enumeration value="Graphics"/>
      <xs:enumeration value="dBASEOle"/>
      <xs:enumeration value="TypedBinary"/>
      <xs:enumeration value="Money"/>
      <xs:enumeration value="Autoinc"/>
      <xs:enumeration value="AccessOle"/>
      <xs:enumeration value="HMemo"/>
      <xs:enumeration value="HBinary"/>
      <xs:enumeration value="ADTNestedTable"/>
      <xs:enumeration value="FixedChar"/>
      <xs:enumeration value="Reference"/>
      <xs:enumeration value="BFile"/>
      <xs:enumeration value="ADTDate"/>
      <xs:enumeration value="Guid"/>
      <xs:enumeration value="WideText"/>
      <!-- Binary is required for fieldtype="bin.hex" -->
      <!-- FixedChar is required for fieldtype="string" when the field is CHAR (but not NCHAR) -->
      <!-- Guid is required for fieldtype="string" when the field is GUID -->
      <!-- Text is required for fieldtype="bin.hex" when the underlying field is TEXT or NTEXT (memo?) -->
      <!-- Money is required for fieldtype="float" when the underlying field is CURRENCY -->
    </xs:restriction>
  </xs:simpleType>
  <!-- PARAM/param -->
  <xs:element name="PARAM" type="param"/>
  <xs:complexType name="param">
    <xs:attribute name="Name" type="paramName" use="required"/>
    <!-- two forms of Value are possible; xs:Name is for ORIGIN; xs:postiveInteger is for PROVFLAGS (in combination with Type)
        <xs:attribute name="Value" type="xs:Name" use="required"/>
        <xs:attribute name="Value" type="xs:postiveInteger" use="required"/>
-->
    <xs:attribute name="Value" type="xs:string" use="required"/>
    <xs:attribute name="Type" type="FIELDTYPE" use="optional"/>
    <xs:attribute name="Roundtrip" type="xs:Name" use="required" fixed="True"/>
  </xs:complexType>
  <!-- paramName -->
  <xs:simpleType name="paramName">
    <xs:restriction base="xs:Name">
      <xs:enumeration value="ORIGIN"/>
      <xs:enumeration value="PROVFLAGS"/>
    </xs:restriction>
  </xs:simpleType>
</xs:schema> 
```

问候。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-01-28T19:25:33.067

我是 Delphi 的新手，但必须处理 XML 格式的 TClientDataSet 解析。我还需要字段类型的所有可能值的列表。对 Delphi 源代码进行了一些挖掘，并提出了这个列表。

如果要在架构中包含字段类型，则应包含此处列出的所有类型：

```
<xs:enumeration value="string" />
<xs:enumeration value="id" />
<xs:enumeration value="idref" />
<xs:enumeration value="idrefs" />
<xs:enumeration value="entity" />
<xs:enumeration value="entities" />
<xs:enumeration value="nmtoken" />
<xs:enumeration value="nmtokens" />
<xs:enumeration value="number" />
<xs:enumeration value="int" />
<xs:enumeration value="enumeration" />
<xs:enumeration value="notation" />
<xs:enumeration value="fixed" />
<xs:enumeration value="boolean" />
<xs:enumeration value="dateTime" />
<xs:enumeration value="dateTime.tz" />
<xs:enumeration value="date" />
<xs:enumeration value="time" />
<xs:enumeration value="time.tz" />
<xs:enumeration value="i1" />
<xs:enumeration value="byte" />
<xs:enumeration value="i2" />
<xs:enumeration value="i4" />
<xs:enumeration value="i8" />
<xs:enumeration value="ui1" />
<xs:enumeration value="ui2" />
<xs:enumeration value="ui4" />
<xs:enumeration value="ui8" />
<xs:enumeration value="r4" />
<xs:enumeration value="r8" />
<xs:enumeration value="float" />
<xs:enumeration value="char" />
<xs:enumeration value="uuid" />
<xs:enumeration value="bin.hex" />
<xs:enumeration value="bin.base64" /> 
```

感谢您出色地定义了此架构。这很有帮助。

# c# - 行号不正确的异常错误消息

> ID：492201
> 
> 赞同：8
> 
> 时间：2009-01-29T15:56:27.017
> 
> 标签：c#, asp.net, sharepoint, .net-2.0, gac

当在 Asp.Net 网页中引发异常时，会显示一条错误消息以及完整的堆栈跟踪。

下面的例子：

> 堆栈跟踪：
> IndexOutOfRangeException：索引超出了数组的范围。
> 
> **MyNameSpace.SPAPP.ViewDetailsCodeBehind.LoadView() +5112** MyNameSpace.SPAPP.ViewDetailsCodeBehind.Page_Load(Object sender, EventArgs e) +67
> System.Web.Util.CalliHelper.EventArgFunctionCaller(IntPtr fp, Object o, Object t, EventArgs e) + 13
> System.Web.Util.CalliEventHandlerDelegateProxy.Callback（对象发送者，EventArgs e）+43
> System.Web.UI.Control.OnLoad（EventArgs e）+98
> ... ...

问题是显示的行号与我的代码中引发异常的行不对应。
在上面的示例中，堆栈显示行号 5111，但我在 .cs 文件后面的代码只有 250 行！

aspx 页面存储在 SharePoint 站点中，并且包含后面代码的程序集已部署到 GAC。另外，我已经在调试模式下编译。

**鉴于上述设置，我怎样才能找出我的代码中的哪一行导致了异常？** 

*[strelokstrelok](https://stackoverflow.com/users/2788/strelokstrelok)指出的澄清：*

> 在**发布模式下**，异常前面的数字不是代码行。相反，它是对本机编译代码的偏移，这对人类没有任何意义。更多关于这里的信息：http: [//odetocode.com/Blogs/scott/archive/2005/01/24/963.aspx](http://odetocode.com/Blogs/scott/archive/2005/01/24/963.aspx)
> 
> 在**调试模式下**，PDB 文件将自动将本机代码偏移量映射到代码中的 .cs 行，并且显示的数字将是代码中的相应行。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-02-02T11:12:29.647

这些数字不是行号。在发布模式下，堆栈跟踪包含本地编译代码的偏移量，而不是行号。你可以在这里阅读更多关于它的信息：http: [//odetocode.com/Blogs/scott/archive/2005/01/24/963.aspx](http://odetocode.com/Blogs/scott/archive/2005/01/24/963.aspx)

在堆栈跟踪中获取行号的唯一方法是在调试模式下使用可用的 PDB 文件构建代码。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-29T16:00:33.030

您的代码隐藏文件不是完整的类，它只是整个类由 ASP.NET 编译时使用的一部分。要找到该行的真正内容，请使用 Reflector 之类的工具查看已编译的类/程序集。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-02T10:35:35.647

也许正在运行的代码不是您在屏幕上看到的。有些伙伴可能已经为你重构了它。:)

# sql - 如何定位 SQL 表中 xPath 所在的行

> ID：492204
> 
> 赞同：0
> 
> 时间：2009-01-29T15:56:49.170
> 
> 标签：sql, sql-server, xml, xpath

想象一下下表：

```
-------------------------------------------------------------
   ID   |    XML
-------------------------------------------------------------
    1   | <Form><object ID="1" /></Form>
    2   | <Form><object ID="2" /></Form>
    3   | <Form><object ID="2" /></Form>
------------------------------------------------------------- 
```

我需要一些 SQL 来查找 ID 和 Form/object@ID 不相同的所有行

我正在使用 SQL2000。ID 是 int 字段，XML 是 Text 字段。

上表中的数据也被简化了，表单标签内会有额外的变化元素。

我该怎么做呢？我可以这样做吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-29T19:17:56.377

我认为在 SQL2000 中没有很好的方法来做到这一点。使用 SQL2005，您可以使用 xml 数据类型来提取值。

我的建议是

```
SELECT *
FROM TABLE t
WHERE CHARINDEX('ID="' + CAST(t.ID AS VARCHAR) + '"',t.XML) = 0 
```

但这很讨厌而且很慢。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-29T16:08:04.670

您可以尝试在您的选择语句中包含，但您需要确保您的表是全文索引的。

顺便说一句，不错的字段名称...

# java - 我可以在同一个 Windows 服务器上使用 Java 1.4.2_12 和 Java 1.5 的应用程序吗

> ID：492207
> 
> 赞同：3
> 
> 时间：2009-01-29T15:58:13.113
> 
> 标签：java, windows

我有几个在 Java 1.4.2_12 上运行的应用程序，现在需要添加一个使用 Java 1.5 的新应用程序。我可以在 Windows 服务器上同时拥有两个 java 版本吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-29T15:59:37.867

是的。您只需要确保每个在其 CLASSPATH、PATH 和 JAVA_HOME 环境变量中都有正确版本的 Java/JRE。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-29T16:03:08.203

是的：实际上 JDK 或 JRE 可以随心所欲地“复制”，而不是“安装”（避免将任何内容放在 c:\Windows\System32 中）

我还建议*不要*使用*全局*环境变量。

这样，您的应用程序完全依赖于本地设置（应用程序的本地设置），而不是外部 Java 安装的副作用

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-29T16:03:46.907

您确定*必须*使用特定的 Java VM 运行 Java 1.4.2_12 应用程序吗？大多数应用程序应该在较新的 VM 上运行良好，因此您可以简单地让它们都使用 1.5。

如果您确实需要使用特定的 VM 版本，那么您可以按照其他海报的建议进行操作。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-30T04:15:37.180

是的。看上面。当然，运行两个 VM（任何版本）需要两倍的 RAM。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-30T05:21:45.410

我可以建议您使用[Java WebStart](http://java.sun.com/javase/technologies/desktop/javawebstart/index.jsp)，它允许您在 JNLP 文件中指定目标 J2SE 版本。或者; 始终通过绝对路径在“程序文件”下执行正确版本的“java.exe”。

您不必为 JRE 设置**CLASSPATH**（并且不应该在现代 JRE 中）。JRE 自动拥有自己的引导类路径。**CLASSPATH**由您的应用程序使用。

通常您不必设置**JAVA_HOME**除非您的应用程序正在从 JDK\lib\ 寻找资源（例如包含编译器的 tools.jar）

但我不确定你的问题是什么。您正在运行客户端应用程序（swing）吗？两个Java进程提供服务？还是两个应用程序共享同一个 Java 应用程序服务器？

# image-processing - 有没有一种简单的方法可以比较两种颜色彼此的接近程度？

> ID：492211
> 
> 赞同：25
> 
> 时间：2009-01-29T15:59:30.597
> 
> 标签：image-processing, comparison, colors

有没有办法比较两种颜色彼此的接近程度？如果说他们两个都是蓝色的。
目前我们比较它们的方式是手动将每种可能的颜色分配给一个颜色系列（红色、绿色、蓝色......）。然后只比较字符串 :)
但可以肯定的是，手动任务可以分配给一个简洁的小算法。

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-01-29T16:03:31.807

您可能希望将颜色转换为 HSL 模型（色相、饱和度、亮度），然后按 HSL 顺序比较阈值内的值。如果色调在被视为“接近”的容差范围内，则检查饱和度的“接近度”，然后检查亮度。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-01-29T16:06:06.607

我不确定任何算法，您可能需要考虑将 RGB（红色、绿色、蓝色）值转换为 HSB（色相、饱和度、亮度）。

色调本质上是“颜色”，因此您可以简单地比较色调值的接近程度。

见[http://en.wikipedia.org/wiki/HSV_color_space](http://en.wikipedia.org/wiki/HSV_color_space)

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2013-07-20T18:18:30.943

[Delta-e](http://www.colorwiki.com/wiki/Delta_E%3a_The_Color_Difference)是一个数字，表示两种颜色之间的感知“距离”。数字越小，颜色越接近人眼。

有几种不同的计算方法...CIE76（又名 CIE 1976 或 dE76）是最受欢迎的。

*   [CIE76](http://www.colorwiki.com/wiki/Delta_E%3a_The_Color_Difference#Delta-E_1976)
*   [CMC l:c](http://www.colorwiki.com/wiki/Delta_E%3a_The_Color_Difference#CMC_l%3ac)
*   [dE94](http://www.colorwiki.com/wiki/Delta_E%3a_The_Color_Difference#dE94)
*   [dE2000](http://www.colorwiki.com/wiki/Delta_E%3a_The_Color_Difference#dE2000)

每个人都以不同的方式处理事情，但在大多数情况下，它们都要求您转换为比 RGB 更好（用于比较）的颜色模型。

对于 CIE76，您基本上只需将颜色转换为 LAB 颜色空间，然后计算它们之间的 3 维距离。

维基百科有所有的公式：[http ://en.wikipedia.org/wiki/Color_difference](http://en.wikipedia.org/wiki/Color_difference)

您可以使用在线颜色计算器检查您的工作：

*   [CIE76](http://colormine.org/delta-e-calculator)
*   [CMC l:c](http://colormine.org/delta-e-calculator/cmc)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2019-09-11T16:56:05.577

我知道这个问题已有 10 年历史，但扩展了 Joe Zack 的答案：

这是我的 Kotlin 代码

```
//Entry point here
//Color must be hexa for example "#829381"
fun calculateColorDistance(colorA: String, colorB: String): Double {
    val aColorRGBArray = getColorRGBArray(colorA)
    val bColorRGBArray = getColorRGBArray(colorB)
    val aColorLAB = getColorLab(aColorRGBArray)
    val bColorLAB = getColorLab(bColorRGBArray)
    return calculateColorDistance(aColorLAB, bColorLAB)
}

private fun calculateColorDistance(aColorLAB: DoubleArray, bColorLAB: DoubleArray): Double {
    val lab = aColorLAB[0] - bColorLAB[0]
    val aab = aColorLAB[1] - bColorLAB[1]
    val bab = aColorLAB[2] - bColorLAB[2]
    val sqrtlab = lab.pow(2)
    val sqrtaab = aab.pow(2)
    val sqrtbab = bab.pow(2)

    val sum = sqrtlab + sqrtaab + sqrtbab
    return sqrt(sum)
}

private fun getColorRGBArray(color: String): IntArray {
    val cleanColor = color.replace("#", "")
    val colorInt = Integer.parseInt(cleanColor, 16)
    val r = Color.red(colorInt)
    val g = Color.green(colorInt)
    val b = Color.blue(colorInt)
    return intArrayOf(r, g, b)
}

private fun getColorLab(colorRGB: IntArray): DoubleArray {
    val outLab = doubleArrayOf(0.0,0.0,0.0)
    ColorUtils.RGBToLAB(colorRGB[0], colorRGB[1], colorRGB[2], outLab)
    return outLab
} 
```

`calculateColorDistance`将返回一个 Double 值。该值越低，颜色越相似。

希望这可以帮助某人

# sql-server - SQL Server 2008 备份压缩标准版

> ID：492220
> 
> 赞同：15
> 
> 时间：2009-01-29T16:00:52.233
> 
> 标签：sql-server, sql-server-2008, compression, backup

我正在尝试在 SQL Server 2008 中备份数据库并使用新的压缩功能压缩数据库。但是，当我运行以下代码时，会收到一条奇怪的错误消息：

```
Backup Database <Database> To Disk 'C:\Backup' With Compression 
```

我收到此错误消息：

> 标准版不支持带压缩的备份数据库

这是否意味着我必须升级到完整版或者有办法在标准版中启用压缩？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2010-06-04T16:26:57.930

我意识到这是一篇旧帖子，但只是把它扔在那里，因为它显示为谷歌搜索的前几个条目之一 - SQL Server 2008 R2，标准版也获得备份压缩。更多信息在这里：[http ://technet.microsoft.com/en-us/library/bb964719.aspx](http://technet.microsoft.com/en-us/library/bb964719.aspx)

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2009-01-29T16:10:09.390

SQL 2008 Express、Workgroup 或 Standard 版本不支持备份压缩，仅企业版支持。如果不将您的版本升级到 Enterprise，则无法打开此功能。

尽管您无法在这些版本上进行压缩备份，但您可以从压缩备份中恢复。

有关详细信息，请参阅[http://technet.microsoft.com/en-us/library/bb964719.aspx](http://technet.microsoft.com/en-us/library/bb964719.aspx)。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-11-01T23:11:13.383

可能也有帮助 - 要确定您正在运行的 SQL Server 版本，请运行以下 SQL 查询：

```
SELECT SERVERPROPERTY('productversion'), SERVERPROPERTY ('productlevel'), SERVERPROPERTY ('edition') 
```

请参阅[http://support.microsoft.com/kb/321185](http://support.microsoft.com/kb/321185)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-29T16:16:14.463

你需要企业版

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2014-04-14T11:25:28.900

`BACKUP DATABASE WITH COMPRESSION`Express Edition（64 位）不支持。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2017-12-08T10:50:52.753

确认一下，从 SQL Server 2012 开始，所有版本（Express 和 Web 除外）都支持备份压缩：[https ://technet.microsoft.com/en-us/library/cc645993(v=sql.110).aspx](https://technet.microsoft.com/en-us/library/cc645993(v=sql.110).aspx)

# python - 如何根据 sqlalchemy 中子项的某些属性对对象进行排序？

> ID：492223
> 
> 赞同：3
> 
> 时间：2009-01-29T16:01:51.763
> 
> 标签：python, sqlalchemy

情况如下：我有一个父模型说`BlogPost`。它有很多`Comment`s。我想要的是`BlogPost`按其创建日期排序的 s列表`Comment`。即具有最新评论的博客文章应该在列表的顶部。使用 SQLAlchemy 可以做到这一点吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-29T16:35:02.837

[http://www.sqlalchemy.org/docs/05/mappers.html#controlling-ordering](http://www.sqlalchemy.org/docs/05/mappers.html#controlling-ordering)

> 从 0.5 版开始，除非明确配置，否则 ORM 不会为任何查询生成排序。
> 
> 集合的“默认”排序，适用于基于列表的集合，可以使用 relation() 上的 order_by 关键字参数进行配置：

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-08-04T14:53:02.777

使用 ORM 时，我和父母有同样的问题，GHZ 的链接包含了如何实现的答案。在 sqlalchemy 中，假设 BlogPost.comments 是到 Comments 表的映射关系，你不能这样做：

> session.query(BlogPost).order_by(BlogPost.comments.creationDate.desc())

，但你可以这样做：

> session.query(BlogPost).join(Comments).order_by(Comments.creationDate.desc())

# graphics - 如何在我的 matlab 图中将冲浪设置为一种颜色（无渐变）？

> ID：492232
> 
> 赞同：17
> 
> 时间：2009-01-29T16:03:37.003
> 
> 标签：graphics, matlab

我的数据集由三个向量（x、y 和 z）组成。我用 plot3(x,y,z) 将这些值绘制为 3d 图中的点，这很好。我也想在同一个情节中展示一架飞机。为了得到这个图的数据，我对 x 和 y 使用线性回归来得到一个新的 z。

这是它的外观：

[![替代文字](https://i.stack.imgur.com/udUoD.gif)](https://i.stack.imgur.com/udUoD.gif)
[（来源：[bildr.no](https://bildr.no/image/334949.jpeg)）]

我希望冲浪只填充一种颜色（比如浅蓝色或灰色）并设置不透明度，使其透明。我怎样才能做到这一点？

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2009-01-29T16:40:50.157

创建只有一种颜色和给定透明度值的表面的最简单方法是设置表面对象的“FaceColor”和“FaceAlpha”属性：

```
hSurface = surf(...your arguments to create the surface object...);
set(hSurface,'FaceColor',[1 0 0],'FaceAlpha',0.5); 
```

此示例将表面颜色设置为红色，并将透明度设置为 0.5。您也可以设置边缘属性（使用“EdgeColor”和“EdgeAlpha”）。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-29T18:52:13.183

我不清楚你想做什么。当您为冲浪说一种颜色时，您是指完全一种颜色，还是您的意思是您想要灰色阴影？

这里有一些代码可以做很多事情，你可以选择使用哪些行：

```
x = rand(1,20);
y = rand(1,20);
z = rand(1,20);

[X,Y] = meshgrid(linspace(0,1,10),linspace(0,1,10));
Z = rand(10)*0.1;

clf
plot3(x,y,z,'.');
hold on
h = surf(X,Y,Z)
hold off

%% This will change the color
colormap(copper)
%% This will remove colordata
set(h, 'cdata',zeros(10))
%% This will make transparent
alpha(0.5) 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2012-09-15T10:59:18.640

`set(hsurface...)`完成 gnovice 的答案，可能需要额外的成分（Matlab R2010b 64）：

```
hSurface = surf(...your arguments to create the surface object...);
set(hSurface, 'FaceColor',[1 0 0], 'FaceAlpha',0.5, 'EdgeAlpha', 0); 
```

使绘制曲面的点对点边缘不可见

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-29T19:02:54.877

我认为@matlabDoug有你需要的东西[。](https://stackoverflow.com/questions/492232/how-do-i-set-a-surf-to-one-color-no-gradient-in-my-matlab-plot/492915#492915)该属性`cdata`保存颜色数据，该数据获取应用到它的颜色映射。将其设置为与您的表面数据大小相同的数组，该数组中的每个元素具有相同的值，将使您的表面成为一种颜色。使用默认颜色图，将 cdata 中的所有内容设置为零将使表面变为蓝色，将所有内容设置为 1 将使表面变为红色。然后您可以使用 alpha 使其透明。

# sql - 如何为最小的列数显示一行？

> ID：492241
> 
> 赞同：2
> 
> 时间：2009-01-29T16:05:00.133
> 
> 标签：sql, odbc

这个问题很复杂，所以例子效果最好......我有下表关于 ODBC，而不是 SQL 服务器管理

```
NAME     SEQNUM     

JOHN     2          
JOHN     4
JOHN     7
MARY     12
MIKE     4
MIKE     9
PETER    7
PETER    12 
```

所以，我想撤回一个具有最低 seqNum 的名字......

```
NAME     SEQNUM
JOHN     2
MARY     12
MIKE     4
PETER    7 
```

此数据不适用于`SELECT (MIN(SEQNUM))`. 这会返回一个数字。我希望将实际数据放入我的数据集中。有谁知道这是怎么做到的吗？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-01-29T16:08:19.753

```
select Name, MIN(SEQNUM)
from TABLE
Group By Name 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-29T16:45:35.060

我相信这就是你想要的：

```
select NAME, min(SEQNUM) as SEQNUM
from TABLE
group by NAME 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-29T16:06:27.963

```
SELECT TOP 1 Name, SeqNum FROM yourtable ORDER BY SeqNum DESC 
```

将显示具有最高 SeqNum 的那个

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-29T23:11:46.577

将 Ian 和 Bill 的答案结合在一起可以让您两全其美 - 访问完整的记录，而不必进行可能非常昂贵的联接（任何不是等值联接的联接都可能会像您不相信的那样把事情搞砸）。

```
SELECT t1.* 
FROM yourtable t1,
     (SELECT name, MIN(seqnum) as seqnum
      FROM yourtable
      GROUP BY name) t2
WHERE t1.name=t2.name
      AND t1.seqnum=t2.seqnum 
```

您还可以使用连接语法来实现相同的结果（而不是 WHERE），但在这种情况下，我认为如果您使用 where 会更清楚发生了什么。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-29T16:41:19.623

```
SELECT t1.*
FROM yourtable t1
 LEFT OUTER JOIN yourtable t2 
 ON (t1.name = t2.name AND t1.seqnum > t2.seqnum)
WHERE t2.seqnum IS NULL; 
```

* * *

关于。德姆斯评论：

如果您只是使用`GROUP BY name`，那么您的选择列表只能包含`name`和聚合函数`MIN()`。通常情况下，您真的想要每组出现最小值的整行。

如果您使用该`TOP`解决方案（或者`LIMIT`如果您使用 MySQL、PostgreSQL、SQLite），那么您无法获得基于 的多个组的最小值`name`，您只能获得一个的最小值`name`。

我在 OP 问题的行之间阅读并猜测他们想要整行，列比问题中显示的列多（总是有），并且所需的查询应该返回多个名称的结果，而不仅仅是一个.

* * *

关于。SquareCog 的评论：

您建议的解决方案也是一个连接：

```
SELECT t1.*
FROM yourtable t1
  JOIN (SELECT name, MIN(seqnum) AS seqnum FROM yourtable GROUP BY name) t2
  USING (name, seqnum); 
```

但是，这个解决方案可能不能使用索引来评估连接，而我给出的解决方案可以。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-29T16:47:15.043

select name from table t where seq_num = (select max(sequnum) from table tt where t.name = tt.name)

但我更喜欢分组一个。

# html - XML/HTML 特殊字符代码

> ID：492247
> 
> 赞同：0
> 
> 时间：2009-01-29T16:05:36.997
> 
> 标签：html, xml

字符代码是否有正式名称，将 & 表示为 & 的代码以区分文本字符及其编码用途，用于 XML 和 HTML 内容？

另外，这些是 XML 或 HTML 标准的一部分，还是第三方标准？而且，有没有官方网站可以告诉我关于它们的信息？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-29T16:09:12.217

[字符实体引用](http://www.w3.org/TR/html4/sgml/entities.html)

其中一些是在上面链接的 HTML 标准中定义的

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-29T16:08:00.817

它们被称为**字符实体引用**，并在 XML、SGML 和 HTML 中定义了略有不同的细节（仅与外来的相关）。

[Wikipedia](http://en.wikipedia.org/wiki/List_of_XML_and_HTML_character_entity_references)有一个很好的概述，而 W3C 提供了[完整的列表](http://www.w3.org/TR/xml-entity-names/)。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-29T16:13:14.893

[XHTML 字符实体参考](http://www.digitalmediaminute.com/reference/entity/index.php)

[HTML 实体](http://htmlhelp.com/reference/html40/entities/)

# java - 为什么 Java Web Start 不适用于 64 位 Java 环境？

> ID：492248
> 
> 赞同：1
> 
> 时间：2009-01-29T16:05:46.403
> 
> 标签：java, 64-bit, java-web-start

[Java Web Start 不附带 JDK 的 64 位版本](http://java.com/en/download/help/webstart_64bits.xml)。为什么是这样？缺少什么使其无法构建和工作？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-29T17:06:01.917

显然，*没有*理由，因为它在 JRE6u12 中。[http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=4626735](http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=4626735)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-07T18:40:03.980

以为您可能想知道新的更新已经发布：http: [//java.sun.com/javase/6/webnotes/6u12.html](http://java.sun.com/javase/6/webnotes/6u12.html)

> 64 位浏览器支持 Java 插件和 Java Webstart 此版本在 Windows 平台上支持 AMD64 架构上的新 Java 插件和 Java Webstart。提供了 Java 离线安装程序（JRE 和 JDK）。请注意，如果您交替使用 32 位和 64 位浏览器，则需要同时安装 32 位和 64 位 JRE，以便为这两种浏览器安装 Java 插件。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-07T20:05:55.243

主要是需求不足。如果您打算为 web start 客户端运行超过 1200 MB 的内存，则只需要 64 位版本。否则没有太大区别。

您知道使用这么多内存的 Web 启动应用程序的任何示例吗？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-07-16T23:49:32.107

是的，Javawebstart 不仅用于通过浏览器简单地访问 Web 来启动应用程序。它也用于 JNLP 部署。确实存在需要超过 2-3 GB 的应用程序。JavaWebStart DID 过去以 64 位模式启动。但是现在 javawebstart 不再支持赋予 VM 命令行参数的 -D64 命令行标志（更糟糕的是，即使我们传递了 VM 参数 -Xmx （不再支持），我们甚至被限制在大约 247MB也 ！！）

现在不可能使用 JNLP 应用程序。我们需要完全支持 64 位模式（以及传递 VM 创建参数的方法）。这不仅是一个限制，而且是对旧时代的严重回归，Java VM 现在变得非常缓慢并且可以交换。

看起来 Java 文档现在是错误的，或者它的支持参数已更改。如果您曾经安装过一些提供 JNLP 与命令关联的工具，则可能是它使用在 \windows\syswow64 中安装的 32 位版本的 Javawebstart 更改了映射（Java 控制面板不会检测到而不是更新），同时您在 \windows\system32 中安装了最新的更新，其中包含支持 32 位和 64 位 VM 的 64 位 javaws laucnher。

要在安装了 32 位和 64 位版本的情况下以 64 位启动 java，您需要检查在桌面或开始菜单上创建的快捷方式，以查看它是否有效地使用了 \windows\system32 中的正确路径，并且存在参数“-J-d64”（以及“-J-Mx=3048m”，如果您想增加 VM 的最大大小。否则您的 VM 将是 32 位并限制为 247 MB​​ ！！！

我讨厌那些在其他地方安装和更改 Java 安装的工具，而没有使用受支持的安装方法在 Windows 注册表中正确注册它们（不仅仅是为了它们自己使用，而是试图更改文件类型的关联。

Anyway there's a bug in the Java control panel for Windows if it does not help restoring the file associations, and does not detect that another JRE has been setup (most often oan outdated version !) And the documentation still incorrectly states that we must use the folllowing VM parameter "-D64" when it should be "-d64" (the former is just used to define a property with an unset value in the environment).

# http - 服务器不存在时是否通过 HTTP POST 发送数据？

> ID：492255
> 
> 赞同：2
> 
> 时间：2009-01-29T16:06:48.540
> 
> 标签：http, ssl, post

我在一家大型广告公司工作。我们创建了一个非常轻量级的 PayPal IPN 克隆，因此我们可以为我们的顶级广告商提供 CC 处理服务。

与 PP IPN 一样，它是一个简单的 RESTful 接口。

我特意指示我们的管理员为这个 Web 应用程序配置 vhost，使其仅响应端口 443 上的请求。

这个特定的问题超出了我的 HTTP 协议知识范围：

这可能因浏览器而异，但是当用户提交表单并且该表单的操作是[http://www.somesite.com](http://www.somesite.com)时，如果浏览器无法解析该站点，是否会发送帖子有效负载在电线上？

我知道这有点深奥，它更多的是一个实现问题，而不是 HTTP RFC 中存在的问题（据我所知）。有接盘侠吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-29T16:10:25.647

在发送任何数据之前，浏览器需要打开到目标站点的 TCP 连接。由于无法打开与目标站点的连接，因此无法发送任何数据。

**更新**（感谢评论中的提示）：使用 POST 之类的 HTTP 请求来避免通过网络发送数据，这些数据可能在检查目标存在*之前被代理拦截。*使用代理，TCP 连接总是成功建立，并且 HTTP-request-header 被发送给它。POST 请求在其请求正文中包含附加数据，只有在请求标头没有返回错误时才应发送这些数据。尽管如此，代理的实现不同，如果目标站点不存在，我不能保证没有代理返回错误。但在这种情况下，我不知道有什么方法可以避免通过网络发送完整的数据......

# c# - 控制 Windows 窗体 C# 应用程序中的更改

> ID：492261
> 
> 赞同：4
> 
> 时间：2009-01-29T16:08:26.227
> 
> 标签：c#, .net, winforms

我有一个包含多个组件的表单，例如`TextBox`and `ComboBox`，如果表单有任何更改，我需要知道何时单击 out 按钮。有没有办法做到这一点？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-29T16:40:11.420

您可以创建一个通用的更改事件处理程序，该处理程序在更改时设置一个标志，然后将所有控件的更改事件分配给它。

这可能很容易通过循环访问所有控件来完成。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-29T16:59:25.750

您可以遍历所有控件，但这必须是递归的，因为控件可以包含控件，例如（为简洁起见，没有空检查）：

```
private void IterateOverControls( Control parent )
{
    ProcessControl( parent );

    foreach( Control control in parent.Controls )
        IterateOverControls( control );
} 
```

在 ProcessControl 中，您可以连接事件处理程序来处理 OnEnter（存储状态）和 OnLeave（根据存储状态检查当前状态）。处置时，您需要解开所有事件处理程序。此外，存储检查状态的代码必须针对不同的控件类型进行更改，例如 TextBox 将是 Text 属性，但单选按钮将是索引等。显然，如果您可以将表单状态与底层进行比较，这将变得更简单数据存储状态，在这种情况下，您可以对每个 OnLeave 事件进行比较。

还要考虑的一件事是您是否需要跟踪实际变化？例如，我有 2 个单选按钮：A 和 B。我检查 B（更改），因此 out 按钮或任何具有其 Enabled 属性的按钮都会更改。然后我点击A（即回到我原来的状态）。你需要在那个时候恢复按钮吗？

这就是为什么您应该寻找模型视图控制器方法的原因:)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-29T16:10:57.533

最简单的方法是在表单上使用一个名为“IsChanged”之类的变量。最初显示表单时将其设置为 false，如果他们进行任何更改，则将其设置为 true。

或者，您可以在显示表单时记录所有内容的值，当它们完成时，检查当前值与旧值是否有任何变化。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-29T17:04:58.500

如果这已经快完成了，并且你需要一些快速的东西，那么总是假设某些东西已经改变可能会更容易，然后在你的更新逻辑中（无论它在做什么）不要更新仍然相同的东西。

正如其他人所提到的，某人很可能会更改某些内容，然后再将其更改回来。在这种情况下你想做什么？如果没有相当多的额外工作，您将无法保持表单的正确脏状态。这是您在开始之前需要计划的事情，真的。

# .net - .NET 中是否有等效于“sscanf()”的功能？

> ID：492262
> 
> 赞同：18
> 
> 时间：2009-01-29T16:08:31.873
> 
> 标签：.net, string

.NET Framework 为我们提供了[Format](http://msdn.microsoft.com/en-us/library/b1csw23d.aspx)方法：

```
string s = string.Format("This {0} very {1}.", "is", "funny");
// s is now: "This is very funny." 
```

我想要一个“取消格式化”功能，例如：

```
object[] params = string.Unformat("This {0} very {1}.", "This is very funny.");
// params is now: ["is", "funny"] 
```

我知道 ANSI-C 库（[printf](http://en.wikipedia.org/wiki/Printf) vs [scanf](http://en.wikipedia.org/wiki/Scanf)）中存在类似的东西。

问题：C# 中有类似的东西吗？

更新：使用正则表达式捕获组不是我需要的解决方案。它们也是一种方式。我正在寻找一种可以以单一格式**双向工作的系统。**放弃一些功能（如类型和格式信息）是可以的。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-01-29T16:13:00.633

没有这样的方法，可能是因为解决歧义的问题：

```
string.Unformat("This {0} very {1}.", "This is very very funny.")
// are the parameters equal to "is" and "very funny", or "is very" and "funny"? 
```

针对这个问题制作了正则表达式[捕获](http://www.regular-expressions.info/brackets.html) [组；](http://www.regular-expressions.info/named.html)你可能想看看他们。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-29T16:12:50.760

带分组的正则表达式？

```
/This (.*?) very (.*?)./ 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2011-02-25T06:27:44.400

如果有人感兴趣，我刚刚发布了`scanf()`.NET 的替代品。如果正则表达式不适合您，我的代码`scanf()`非常接近格式字符串。

[您可以在http://www.blackbeltcoder.com/Articles/strings/a-sscanf-replacement-for-net](http://www.blackbeltcoder.com/Articles/strings/a-sscanf-replacement-for-net)查看并下载我编写的代码。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-01-29T16:11:03.523

您可以执行 string[] parts = string.Split(' ')，然后在您的示例中按索引位置 parts[1] 和 parts [3] 提取。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-01-29T16:13:38.853

是的。这些被称为“正则表达式”。会做这件事的人是

```
This (?<M0>.+) very (?<M1>.+)\. 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-29T19:02:48.950

@mquander：实际上，PHP 以不同的方式解决它：

```
$s = "This is very very funny.";
$fmt = "This %s very %s.";
sscanf($s, $fmt, $one, $two);
echo "<div>one: [$one], two: [$two]</div>\n";
//echo's: "one: [is], two: [very]" 
```

但也许你的正则表达式评论可以帮助我。我只需要重写`"This {0} very {1}."`为：`new Regex(@"^This (.*) very (.*)\.$")`. 这应该以编程方式完成，因此我可以在公共类接口上使用一种格式字符串。

顺便说一句：我已经有一个解析器来查找参数：请参阅[Phil Haack的](http://haacked.com/)[Named Format Redux](http://haacked.com/archive/2009/01/14/named-formats-redux.aspx)博客条目（是的，我也希望命名参数可以双向工作）。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-05-20T13:08:43.393

我遇到了同样的问题，我相信有一个使用 REGEX 的优雅解决方案......但是在 C# 中提出了一个“UnFormat”函数，效果很好。很抱歉没有评论。

```
 /// <summary>
    /// Unformats a string using the original formating string. 
    /// 
    /// Tested Situations:
    ///    UnFormat("<nobr alt=\"1\">1<nobr>", "<nobr alt=\"{0}\">{0}<nobr>") : "1"
    ///    UnFormat("<b>2</b>", "<b>{0}</b>") : "2"
    ///    UnFormat("3<br/>", "{0}<br/>") : "3"
    ///    UnFormat("<br/>4", "<br/>{0}") : "4"
    ///    UnFormat("5", "") : "5"
    ///    UnFormat("<nobr>6<nobr>", "<nobr>{0}<nobr>") : "6"
    ///    UnFormat("<nobr>2009-10-02<nobr>", "<nobr>{0:yyyy-MM-dd}<nobr>") : "2009-10-02"
    ///    UnFormat("<nobr><nobr>", "<nobr>{0}<nobr>") : ""
    ///    UnFormat("bla", "<nobr>{0}<nobr>") : "bla"
    /// </summary>
    /// <param name="original"></param>
    /// <param name="formatString"></param>
    /// <returns>If an "unformat" is not possible the original string is returned.</returns>
    private Dictionary<int,string> UnFormat(string original, string formatString)
    {
       Dictionary<int, string> returnList = new Dictionary<int, string>();

       try{
          int index = -1;

          // Decomposes Format String
          List<string> formatDecomposed = new List<string> (formatString.Split('{'));
          for(int i = formatDecomposed.Count - 1; i >= 0; i--)
          {
             index = formatDecomposed[i].IndexOf('}') + 1;

             if (index > 0 && (formatDecomposed[i].Length - index) > 0)
             {
                formatDecomposed.Insert(i + 1, formatDecomposed[i].Substring(index, formatDecomposed[i].Length - index));
                formatDecomposed[i] = formatDecomposed[i].Substring(0, index);
             }
             else
                //Finished
                break;
          }

          // Finds and indexes format parameters
          index = 0;
          for (int i = 0; i < formatDecomposed.Count; i++)
          {
             if (formatDecomposed[i].IndexOf('}') < 0)
             {
                index += formatDecomposed[i].Length;
             }
             else
             {
                // Parameter Index
                int parameterIndex;
                if (formatDecomposed[i].IndexOf(':')< 0)
                   parameterIndex = Convert.ToInt16(formatDecomposed[i].Substring(0, formatDecomposed[i].IndexOf('}')));
                else
                   parameterIndex = Convert.ToInt16(formatDecomposed[i].Substring(0, formatDecomposed[i].IndexOf(':')));

                // Parameter Value
                if (returnList.ContainsKey(parameterIndex) == false)
                {
                   string parameterValue;

                   if (formatDecomposed.Count > i + 1)
                      if (original.Length > index)
                         parameterValue = original.Substring(index, original.IndexOf(formatDecomposed[i + 1], index) - index);
                      else
                         // Original String not valid
                         break;
                else
                   parameterValue = original.Substring(index, original.Length - index);

                returnList.Add(parameterIndex, parameterValue);
                index += parameterValue.Length;
             }
             else
                index += returnList[parameterIndex].Length;

             }
          }

          // Fail Safe #1
          if (returnList.Count == 0) returnList.Add(0, original);
       } 
       catch
       {
          // Fail Safe #2
          returnList = new Dictionary<int, string>();
          returnList.Add(0, original);
       }

       return returnList;
    } 
```

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2016-05-13T06:40:47.403

我参考了较早的回复，写了一个示例，见下文

```
string sampleinput = "FirstWord.22222";

Match match = Regex.Match(sampleinput, @"(\w+)\.(\d+)$", RegexOptions.IgnoreCase);

if(match.Success){

    string totalmatchstring = match.Groups[0]; // FirstWord.22222
    string firstpart = match.Groups[1]; // FirstWord`
    string secondpart = match.Groups[2]; // 22222

} 
```

# printer-control-language - 将 pcl 转换为图像

> ID：492267
> 
> 赞同：1
> 
> 时间：2009-01-29T16:10:04.133
> 
> 标签：printer-control-language

我正在通过 RS232 与逻辑分析仪 (HP 1660A) 通信。我发出一个命令，告诉分析仪打印屏幕并通过串行通信将其发送到控制器（我的电脑）。我将结果（通常约为 25kB）保存到我的计算机中，我想将其视为 TIFF 或其他格式。问题是分析仪的响应是 PCL 格式的，因此适合发送到打印机并直接打印，但不能作为图像打开。我已经尝试了一些 PCL 到图像转换器来完成这项工作，我找到了一个可以正常工作的，但是我使用了试用版并且我不愿意购买它。我已经给你介绍了我的工作背景。我将不胜感激任何形式的帮助，对 pcl 1 中命令的引用以及我应该怎么做才能从 PCL 文件中提取数据并正确格式化。我对 PCL 和图像处理没有任何经验，所以请帮帮我。谢谢你。

PS我已经从分析器中获得了C#和matlab中的PCL文件......我在C#中的串口控制有一个小问题，当使用上述转换器时，一些图像在图像中有一些未解释的字符。我说所有这些是因为我需要一个算法或一些指示，不管是什么编程语言，所以请随时发布。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-03T17:11:00.250

PCL 阅读起来很复杂。只有少数工具可以很好地完成此任务。我们拥有大量 PCL 专业知识，并且仍然经常寻求其他提供 PDF 和其他格式的转换。如果 PCL 非常简单，即只有文本、一些字体和一两个图形，则几个 RegEx 命令可以处理文本的提取，然后您可以使用任何您希望的工具模拟一个新文档.

在 stackoverflow 中查看这些文件可能很困难。如果您可以在 ftp 上获取它们并发布链接，我可以快速查看并在此处发布我的发现/想法。另一种选择是寻找外部工具。我们已经取得了一些成功。我们的需求很广泛，所以我选择了一种最适用于许多不同 PCL 流的方法（一些 PCL 编码比其他编码更好）。当您处理已知数量的 PCL 时，您可能有几个选择。以下是我们已经使用并取得了一些成功的一些（按对我们有用的顺序）

[PageTech 的 PCLWorks](http://www.pclworks.com)（他们有一个 GUI 查看器和完整的 SDK）

[VeryPDF PCL 转换器](http://www.verypdf.com/pcltools/index.html)（命令行工具）

[斯威夫特视图](http://www.swiftview.com/swiftconvert.htm)

还有其他的，甚至是处理 PCL 的 Ghostscript 的开源变体（我们从来没有这么幸运，因为我们使用的 PCL 经常包含非常自定义的字体、符号集和大量似乎令人窒息的宏。

[鬼PCL](http://www.ghostscript.com/)

**编辑：**最近我们一直在使用 LincPDF ( [http://www.lincolnco.com/](http://www.lincolnco.com/) )。这也是一款优秀的产品，有一个很大的好处，部署简单。其他一些工具具有复杂的软件安装。这个解决方案对我们来说很容易部署为应用程序中的一个功能。它也比我们迄今为止测试过的任何工具都更快（至少使用我们从应用程序生成的 PCL，因为它们包含专门的字体和宏，所以相当复杂）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-12T12:08:56.667

根据 HP 1660 ( [pdf](http://cp.literature.agilent.com/litweb/pdf/5963-2172E.pdf) ) 系列的规格表可以发送 TIFF、PCX 和 postscript。

使用 TIFF 不是更容易吗？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-07-15T17:18:57.723

该项目被搁置了一段时间，但我想提供一个完整且可用的解决方案。

@Adrian您可以将图像保存到软盘，我已经做到了，将其保存为TIFF，一切正常。不幸的是，它只通过 RS232 发送 PCL。通过串行通信保存打印屏幕的想法是避免使用过多的软盘，设备用于引导。

@Douglas 感谢您的详尽回答。我会看一下指定的工具，但是，我希望提供一个完整的前端解决方案，它可以直接生成图形。我在[这里](http://s10.transfer.ro/storage/transfer_ro-eee1fab3315cf2bbc75a.zip)放了一些我的测试文件，以了解 PCL 结构的复杂性。您是否知道我可以集成到我的应用程序中的可能的 API，它可以解析文件并解释 PCL？

问候， 科斯敏

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-12-31T18:11:35.057

我们通过监视 COM1: 的串行假脱机程序捕获串行输入。它被称为 SSpool.exe。它将 PCL 作为输入重定向到 PCLXForm。PCLXForm 将其转换为任何光栅格式（TIFF、JPG、PDF、BMP 等）。但是，我们也可以在转换过程中提取文本，我们可以从 PCL 中提取单个光栅对象，以便在下游应用程序中重新排列。我们的定价模型适用于需要每月将多达 50,000 页发票转换为索引 PDF 的被许可人。但是，这种类型的应用程序通常需要自定义许可证才能将我们的定价降低到所需的水平。为了做到这一点，我们经常不得不限制我们的产品转换无限的文件，但最多只能在任何一个 PCL 打印文件中的第 20 页。这提供了足够的页面量，并使我们能够降低单位价格。要进行演示，您需要 PCLTool SDK。

# java - 如何使用免费方法从 Java 执行 COM+ 库

> ID：492280
> 
> 赞同：0
> 
> 时间：2009-01-29T16:12:48.823
> 
> 标签：java, com+

我有一个用 VB6 开发的 COM+ 组件。

将它注册到组件服务管理器 COM+ 应用程序后，我可以像这样从 ASP 使用它

```
Set Comando = Server.CreateObject("JuiciosComando.clsComando")
ComandoExecute = Comando.execute(Xml)
Set Comando = Nothing 
```

这就是我所需要的，组件只接收一个（可能是巨大的）字符串并返回另一个（也可能是巨大的）字符串......

有什么方法可以从 Java 访问这个相同的组件吗？

到目前为止，我发现的是[J-Integra](http://j-integra.intrinsyc.com/support/com/doc/servlet_com/ServletToComPlusExample.html)，但它是一种商业产品。

我也在[codeguru.com 上找到了这个线程，](http://www.codeguru.com/forum/archive/index.php/t-383429.html)但我的 C++.NET 知识相当贫乏，此外我宁愿找到一个免费的纯 Java 解决方案。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-29T17:32:32.440

正如 Eddie 所提到的，您有两种通过 java 使用 COM 的主要方法：使用 C++ 和编写 JNI 包装器或使用第三方 JAR 来包装 COM 对象。

过去我曾尝试使用 C++ 来包装 COM 对象——它不适合胆小的人——这并不容易，而且很容易泄漏资源。

我还使用了两个第三方 JAR：ComfyJ 和 JACOB。

ComfyJ 非常易于使用，并且还包含一个 codegen 实用程序来为您的 COM 类生成 java 包装类。

它可以通过[http://www.teamdev.com/comfyj/index.jsf下载和试用](http://www.teamdev.com/comfyj/index.jsf)

（我与 TeamDev 没有任何关系！）

如果您迫切需要完全免费的解决方案，您也可以尝试 JACOB ( [http://sourceforge.net/projects/jacob-project/](http://sourceforge.net/projects/jacob-project/) )。

我在文档方面遇到了问题，但它相对稳定。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-30T11:08:22.213

我可以确认[JACOB](http://danadler.com/jacob/)工作得很好。我已经将它用于许多 COM 自动化项目，没有任何问题。而且是免费的...

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-29T17:11:30.267

我曾经使用过一个应用程序，该应用程序最初尝试使用 JNI 与本机代码交互以访问 COM，但它最终变得非常难以维护和调试。（幸运的是，我不是处理应用程序那部分的人！）由于这次经历，我现在建议需要访问 COM 的 Java 代码通过编写 C# 应用程序来进行 COM 访问，并使用两个应用程序之间的固定插座。

与 C# 中的等效项相比，Java 中的 JNI 具有不必要的风险和困难，因此从 Java 中执行此操作的最稳定方法是不从 Java 中执行此操作。将 COM 访问权委托给具有 COM 访问权的专业知识：C#。

您的另一种选择是许可一些本身为您管理 JNI 的第三方库。但除非您享受痛苦，否则我强烈建议您不要推出自己的 JNI 解决方案。

稍后添加：正如您在引用的链接中看到的，JNI 代码可能会使整个 JVM 崩溃。至少如果 COM 访问位于套接字的另一端，如果 C# 应用程序崩溃，您只会丢失您的套接字，当 C# 应用程序返回时您可以轻松地重新建立。但是，C#在访问 COM 时崩溃的可能性要小得多**。**是的，拥有一个纯 100% Java 解决方案会更好，但有时将任务委托给另一种语言确实要好得多。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-30T12:26:19.483

也许你应该试试 com4j，它对我很有用，而且还支持 com 事件。你可以在这里找到它：[https ://com4j.dev.java.net/](https://com4j.dev.java.net/)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-30T02:26:48.650

抱歉，我知道这个线程很旧，但 j-Interop 可以帮助你。

*从**j-interop.org**网站：*

> “j-Interop 是一个 Java 开源库（在 LGPL 下），它实现了 DCOM 有线协议 (MSRPC)，以支持开发可以与任何 COM 组件互操作的纯、双向、非本地 Java 应用程序。”

干杯，马特

# .net - 何时使用 .NET BufferedStream 类？

> ID：492283
> 
> 赞同：59
> 
> 时间：2009-01-29T16:12:51.243
> 
> 标签：.net, performance, buffer

[MSDN 网站](http://msdn.microsoft.com/en-us/library/system.io.bufferedstream.aspx)指出：

> 缓冲区是内存中用于缓存数据的字节块，从而减少了对操作系统的调用次数。缓冲区提高了读写性能。缓冲区可以用于读取或写入，但不能同时用于两者。BufferedStream 的 Read 和 Write 方法会自动维护缓冲区。

我应该在每一个可能的场合使用这个类吗？

* * *

## 回答 #1

> 赞同：73
> 
> 时间：2010-01-15T03:32:12.913

根据布拉德艾布拉姆斯的说法，几乎从不：[链接](http://blogs.msdn.com/brada/archive/2004/04/15/114329.aspx)

> 不，将 BufferedStream 包装在 FileStream 周围的好处为零。大约 4 年前，我们将 BufferedStream 的缓冲逻辑复制到 FileStream 中，以鼓励更好的默认性能......事实上，我认为 .NET Framework 中没有任何 Streams 需要它，但自定义 Stream 实现可能需要它，如果他们默认不做缓冲。

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2009-01-29T16:22:18.960

以下是我正在学习的在线课程中的一些文字：

> BufferedStream 类是一个扩展 Stream 类的具体类，用于为另一种类型的流（同步和异步）提供额外的内存缓冲区。创建类的实例时，必须将 BufferedStream 类配置为读取或写入，但不能将 BufferedStream 配置为同时执行这两项任务。
> 
> Microsoft 通过包含一个内置缓冲区提高了 .NET Framework 中所有流的性能。通过将 BufferedStream 应用于现有流（例如 FileStream 或 MemoryStream），性能显着提高。将 BufferedStream 应用到现有的 .NET Framework 流会产生双缓冲区。
> 
> BufferedStream 类最常见的应用是在不包含内置缓冲区的自定义流类中。

* * *

## 回答 #3

> 赞同：20
> 
> 时间：2011-09-05T07:11:17.963

我知道的最好的情况是 BinaryFormatter 直接从 NetworkStream 序列化/反序列化。在中间使用 BufferedStream 可将性能提高十倍。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-01-29T16:17:14.680

普通文件 I/O 流已经使用 StreamReader/StreamWriter 进行缓冲。

由于对流的读/写操作，通常使用带字节数组的读/写方法，你自然会自己提供一些缓冲。

如果您使用非常小的数组或使用 WriteByte，则可以通过在两者之间使用 BufferedStream 获得更好的性能。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2020-03-25T23:53:13.957

迟到的答案，但无论如何都会回答。如果您了解它的工作原理，您就可以理解为什么在某些情况下使用它没有意义，以及为什么在其他情况下不使用它是有意义的。

为了证明这一点，我正在使用`StreamWrapper`类。只用这个类来看看你打断点的次数！在这个类中放置断点。我们的目标是查看调用 Write、Read 和其他方法的次数。

```
// This class is only used for demo purposes. Place a breakpoint on all parts
class StreamWrapper : Stream
{
    Stream stream;

    public StreamWrapper(Stream s)
    {
        stream = s;
    }

    public override bool CanRead => stream.CanRead;

    public override bool CanSeek => stream.CanSeek;

    public override bool CanWrite => stream.CanWrite;

    public override long Length => stream.Length;

    public override long Position { get => stream.Position; set => stream.Position = value; }

    public override void Flush()
    {
        stream.Flush();
    }

    public override int Read(byte[] buffer, int offset, int count)
    {
        return stream.Read(buffer, offset, count);
    }

    public override long Seek(long offset, SeekOrigin origin)
    {
        return stream.Seek(offset,origin);
    }

    public override void SetLength(long value)
    {
        stream.SetLength(value);
    }

    public override void Write(byte[] buffer, int offset, int count)
    {
        stream.Write(buffer, offset, count);
    }

} 
```

现在您已经拥有了基本上是现有 strem 的包装器的包装器类，您可以进行以下测试：

**示例写作：**

```
// in real life you want this to be larger. 
int bufferSize = 8;

// Use BufferedStream to buffer writes to a MemoryStream.
using (var memory_test = new StreamWrapper(new MemoryStream()))
using (BufferedStream stream = new BufferedStream(memory_test, bufferSize))
{

    // all this will only send one write to memory_test!
    stream.Write(new byte[] { 1, 2 });
    stream.Write(new byte[] { 1, 2 });
    stream.Write(new byte[] { 1, 2 });
    stream.Write(new byte[] { 1, 2 });
    // BREAKPOINT ONLY HITS ONE TIME 

    // All this will also send only one write to memory_test
    for (int i = 0; i < 8; i++)                            
        stream.WriteByte(5);
    // BREAKPOINT ONLY HITS ONE TIME AGAIN INSTAD OF 8

    // this will send one write to memory_test. Writes of more than 8 bytes can happen!
    stream.Write(new byte[] { 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18 });
    // ALL THIS WILL SEND ONE WRITE AGAIN
} 
```

**示例阅读：**

```
// example reading
{
    // create stream with some data in it that we will be reading
    var ms = new MemoryStream();
    {
        // Write 256 bytes
        for (int i = 0; i <= byte.MaxValue; i++)
        {
            ms.WriteByte((byte)i);
        }
        ms.Position = 0;
    }

    // Use BufferedStream to buffer writes to a MemoryStream.
    using (var memory_test = new StreamWrapper(ms))
    {                                                        
        using (BufferedStream stream = new BufferedStream(memory_test, 8))
        {
            // note I do not care about the output of each read for demo breakpoint. On real life you will store that output
            // for now we only care how many times we hit the breakpoint because on real life that could be a slow/expensive 
            // operation such as opening a file for writing and you want to do those as few as possible.

            // hit breakpoint only one time with all this reads
            stream.ReadByte();
            stream.ReadByte();
            stream.ReadByte();
            stream.ReadByte();
            stream.ReadByte();
            stream.ReadByte();
            stream.ReadByte();
            stream.ReadByte();

            // hit breakpoint only one time with all this reads
            stream.Read(new byte[2] );
            stream.Read(new byte[2] );
            stream.Read(new byte[2] );
            stream.Read(new byte[2] );

            // hit breakpoint only one time even though it is larger than our buffer size 8
            // our goal is to hit the breakpoint as fewest time as possible because in real life
            // this could be slow/expensive operations
            stream.Read(new byte[1024] );

        }
    }
} 
```

**例如，如果这是对文件的写入操作，则可以通过确保始终一次写入至少 8 个字节而不是 1 个字节来提高性能。在现实生活中，您希望这个数字约为 4 KB**

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-01-29T16:17:08.190

在每一个可能的场合都必须*使用*的是常识。在从 MemoryStream 读写时使用此类没有用处，但在进行网络或磁盘 IO 时它可能非常有用（如果这些子系统的 Streams 不自己进行缓冲）。

# c# - 用于 C/C++/C# 的免费静态代码扫描器

> ID：492286
> 
> 赞同：6
> 
> 时间：2009-01-29T16:13:33.910
> 
> 标签：c#, c++, c, open-source, static-analysis

有谁知道用于 C#、C 或 C++ 中自动代码分析的开源和/或免费代码扫描器？

我知道 Java 有一些很棒的东西，比如 FindBugs（Eclipse 集成）、PMD 或 Hammurapi。

C语言有类似的东西吗？

愿望

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-29T16:17:45.710

FxCop 是一个免费的 .Net 扫描仪。

[http://msdn.microsoft.com/en-us/library/bb429476(vs.80).aspx](http://msdn.microsoft.com/en-us/library/bb429476(vs.80).aspx)

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-01-29T16:31:55.773

对于 .NET 语言，您可以查看[Reflector CodeMetrics](http://www.codeplex.com/reflectoraddins/Wiki/View.aspx?title=CodeMetrics&referringTitle=Home)，它提供了一些代码分析和设计指标。还可以查看所有[Reflector 插件](http://www.codeplex.com/reflectoraddins)。

我也支持 FxCop 和 StyleCop 的建议。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-29T16:23:32.343

StyleCop 进行源代码级别分析。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-29T16:24:08.520

[NDepend](http://www.ndepend.com/)有一个为期两周的试用许可证。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-08-31T14:06:06.917

对于 C 代码，您可以查看[Coccinelle](http://coccinelle.lip6.fr/)。它已经用于查找和修复 Linux 内核中的错误。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-29T18:32:11.633

Resharper 做了一些代码分析，特别是用于指出冗余代码和逻辑错误。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-29T17:01:27.230

您可能能够从使用 /analyze 开关运行 VC++ 中获得一些价值。虽然，并非每个版本都提供此特定开关。获取 Windows SDK 附带的编译器。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-29T17:12:40.920

通过这里的评论和一些谷歌魔法，我来到了夹板： [http ://splint.org/](http://splint.org/)

*   似乎对 C 很有帮助。
*   便于使用
*   不依赖于 Visual Studio

对于 VisualStudio 和 .Net，FxCop 和 StyleCop 扩展看起来非常复杂。

到目前为止，谢谢，希望

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-01-30T11:56:19.450

您可以[在此处](http://en.wikipedia.org/wiki/List_of_tools_for_static_code_analysis)找到免费且不那么免费的静态分析工具列表。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2011-12-19T12:33:06.100

[Gendarme](http://www.mono-project.com/Gendarme.Roadmap) is free and open source. It analyses at IL level and provides information related to the source files using the pdb. Even without pdb's it provides results but difficult to localize in the code.

Note that it is best to use it on release code, what is unusual for static analyzers. This is because of the IL analysis: the debug code is cluttered and leads to more false positives.

Gendarme generates a nice HTML report and can be integrated easily in a continuous build server like cc.net.

# linux - Linux 上的 Fitnesse RestFixture

> ID：492288
> 
> 赞同：1
> 
> 时间：2009-01-29T16:13:41.803
> 
> 标签：linux, testing, rest, fitnesse

我一直在[Fitnesse中使用](http://fitnesse.org/)[RestFixture](http://code.google.com/p/rest-fixture/)来测试在 Tomcat 下运行的 REST 服务。当 Fitnesse 在 Linux（准确地说是 Redhat）上运行时，fixture 不会将任何查询字符串传递给 Tomcat（日志条目证明了这一点）。但是，在 Windows 机器上通过 Fitnesse 运行的完全相同的固定装置可以按预期工作。

有没有其他人尝试过这种操作系统和夹具的组合并且有任何可能有帮助的经验？

或者，是否有人知道批量测试 REST 服务的任何好方法（以非开发人员可以创建新测试的方式）。

任何帮助将不胜感激！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-18T00:07:34.087

我自己刚刚遇到了这个问题。我没有在 Windows 上尝试过，但 RestFixture 绝对不会填充我的查询参数。

事实上，RestFixture 列表上有一个关于它的[问题。](http://code.google.com/p/rest-fixture/issues/detail?id=13&can=1)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-11T19:15:55.633

所描述的实际上是一个错误。它已固定在后备箱中，并将在 4 月 9 日结束的下一个版本中提供。

# iis - [DBNETLIB][ConnectionOpen (SECDoClientHandshake()).]SSL 安全错误

> ID：492297
> 
> 赞同：4
> 
> 时间：2009-01-29T16:16:10.503
> 
> 标签：iis, asp-classic, ado, ssl-security

我们的 ASP/IIS Web 服务器与 SQL 2005 db 服务器通信。

最终，在没有模式的情况下，一些页面开始显示错误而不是页面内容：

[DBNETLIB][ConnectionOpen (SECDoClientHandshake()).]SSL 安全错误。

重启网络服务器即可解决。

有人知道吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-21T19:37:39.780

你应该看的一些事情：

*   到数据库服务器的低带宽（请参阅[http://support.microsoft.com/kb/322144](http://support.microsoft.com/kb/322144)）
*   数据库服务器上有问题的证书，例如自签名证书
*   SQL 身份验证模式 - 仅限 Windows，或 SQL 和 Windows

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-07-14T00:33:24.260

万一其他人在他们的证书到期时碰巧遇到这种情况，并想知道为什么他们的 SQL Server 会给出 SSL 错误......

删除不需要的证书后，这对我有用...在注册表中设置 Certificate=0：

HKLM\SOFTWARE\Microsoft\MSSQLServer\MSSQLServer\SuperSocketNetLib REG_SZ Certificate=0

在此处阅读更多信息：http: [//blogs.technet.com/b/taraj/archive/2009/01/07/sql-server-the-best-database-server-to-work-on.aspx](http://blogs.technet.com/b/taraj/archive/2009/01/07/sql-server-the-best-database-server-to-work-on.aspx)

# javascript - 使您的 javascript 可维护

> ID：492300
> 
> 赞同：10
> 
> 时间：2009-01-29T16:16:48.347
> 
> 标签：javascript, jquery

我正在将内部应用程序转换为通过 jQuery 使用更多 Ajax。我正在远离当前 ASP.NET 应用程序背后的标准代码，并合并将在客户端运行的 JavaScript 方法。我关心的是什么是让这个应用程序对那些落后于我的人保持可维护性的最佳方法。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-01-29T17:55:14.687

我发现构建脚本是可维护 Javascript 成功的关键。本质上，为了在最后一页上获得快速简洁的内容，您需要一个脚本来使其在开发中可维护。

如果您使用构建过程，您可以根据功能将 JS 分解为文件。您可以在开发过程中使用库的调试版本，并在您的代码周围留下精彩的代码注释而不受惩罚。

构建脚本应该：

*   [整理](http://www.jslint.com)所有代码
*   剥离评论
*   将文件连接在一起
*   [缩小](http://javascript.crockford.com/jsmin.html)/混淆/压缩代码
*   用于部署的版本文件
*   将版本文件推送到准备在生产中“开启”的服务器

这使您可以处理具有逻辑意义的文件，并在生产后进行整理。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-01-29T16:22:13.127

我想说，将相同类型的 OOP 原则应用于您的 javascript，就像应用于服务器端代码一样，是增强可维护性的最佳方法之一。考虑创建封装 JavaScript 方法和数据的类，而不是全局函数。使用 javascript 单元测试框架来测试此代码以确保它是健壮的。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-01-29T16:26:44.397

运行[JSLint](http://jslint.com/)作为构建的一部分，并确保如果它没有通过，它会导致**构建失败**。

确保您的 JS 有效并不是可维护性的关键，但它会充实一些浏览器问题，否则这些问题可能会被忽略。

如果可能，开始使用 Rhinounit、JSUnit 或 QUnit 等框架编写单元测试。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-01-29T16:21:24.330

创建一个在构建期间运行的脚本，该脚本会从 javascript 中删除所有注释。

然后自由地发表评论，并鼓励其他人也这样做，因为知道评论不会进入生产环境。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-01-29T16:19:04.287

我建议将尽可能多的 javascript 代码放入外部脚本文件中，以添加一些模块化。但除此之外，注释和保持代码和标记尽可能干净是在任何编程项目中可以做到的最好的，无论语言如何。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-01-29T16:24:00.440

另外，如果可以的话，尽量做一些面向对象的设计。我曾经在一个项目中，涉及到很多 jQuery/Javascript，而且它没有面向对象的设计，这让我们有一段时间很难开发和维护它。随着时间的推移，我们实际上最终重写了部分内容以使其更好。

所以我最好的建议是提前思考，发表评论（就像其他人所说的那样），并确保你编写 Javascript 的方式与编写其他任何东西的方式相同（例如，遵循你将使用的所有良好设计原则服务器端语言。）

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-01-29T17:09:04.123

[Nicholas Zakas：](http://www.yuiblog.com/blog/2007/05/25/video-zakas/ "例子") Yahoo! 上的“可维护 JavaScript” 视频

# php - 通过 HTTP 上传大文件

> ID：492307
> 
> 赞同：16
> 
> 时间：2009-01-29T16:17:59.890
> 
> 标签：php, c++, http, upload

我需要将潜在的大文件（如 10 到 100 兆字节）从桌面应用程序上传到服务器。服务器代码是用 PHP 编写的，它是 C++/MFC 中的桌面应用程序。我希望能够在上传中途失败时恢复文件上传，因为该软件将用于不可靠的连接。我有哪些选择？我发现了许多用于 C++ 的 HTTP 上传组件，例如[http://www.chilkatsoft.com/refdoc/vcCkUploadRef.html](http://www.chilkatsoft.com/refdoc/vcCkUploadRef.html)这看起来很棒，但它似乎无法处理一半完成上传的“恢复”（我认为这是因为 HTTP 1.1 不支持它）。我还查看了 BITS 服务，但对于上传它需要一个 IIS 服务器。到目前为止，我唯一的选择似乎是将要上传的文件切成小块（比如每个 1 兆），将它们全部上传到服务器，用 PHP 重新组装它们并运行校验和以查看是否一切正常。要恢复，我需要在上传开始时进行某种形式的“握手”，以找出哪些片段已经在服务器上。我是否必须手动编写代码，或者是否有人知道为我完成所有这些工作的库，或者甚至是完全不同的解决方案？一世'

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-09-30T18:18:58.253

我迟到了八个月，但我偶然发现了这个问题，并对没有提到 webDAV 感到惊讶。您可以使用 HTTP PUT 方法进行上传，并包含一个 Content-Range 标头来处理恢复等。HEAD 请求会告诉您文件是否已经存在以及它有多大。所以也许是这样的：

1) HEAD 远程文件

2）如果存在并且size ==本地大小，则上传已经完成

3) 如果 size < local size，则添加 Content-Range 标头以请求并查找本地文件中的适当位置。

4) 发出 PUT 请求以上传文件（或文件的一部分，如果恢复）

5) 如果在 PUT 请求期间连接失败，请从步骤 1 重新开始

您还可以列出 (PROPFIND) 和重命名 (MOVE) 文件，并使用 dav 创建目录 (MKCOL)。

我相信 Apache 和 Lighttpd 都有 dav 扩展。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-29T23:37:40.207

您需要标准尺寸（例如 256k）。如果用户 x 上传的文件“abc.txt”为 78.3MB，它将是 313 个完整块和一个较小的块。

1.  您发送一个上传请求，说明文件名和大小，以及初始线程数。
2.  您的 php 代码将创建一个以 IP 地址和文件名命名的临时文件夹，
3.  然后，您的应用程序可以使用 MULTIPLE 连接在不同的线程中发送数据，因此您可以同时发送 1,111,212,313 个块（使用单独的校验和）。
4.  您的 php 代码将它们保存到不同的文件中，并在验证校验和后确认接收，给出要发送的新块的数量，或停止此线程。
5.  所有线程完成后，您会要求 php 加入所有文件，如果缺少某些内容，它将转到 3

您可以随意增加或减少线程数，因为应用程序正在控制发送。

您可以轻松地显示进度指示器，可以是简单的进度条，也可以是类似于 downthemall 的块详细视图的东西。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-10-09T09:31:44.057

libcurl (C api) 可能是一个可行的选择

*-C/--continue-at 继续/恢复给定偏移量的先前文件传输。给定的偏移量是将被跳过的确切字节数，从源文件的开头开始计数，然后再传输到目标。如果与上传一起使用，则 curl 不会使用 FTP 服务器命令 SIZE。使用“-C -”告诉 curl 自动找出在哪里/如何恢复传输。然后它使用给定的输出/输入文件来解决这个问题。如果多次使用此选项，将使用最后一个*

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2012-08-04T14:28:02.277

谷歌创建了一个可恢复的 HTTP 上传协议。请参阅[https://developers.google.com/gdata/docs/resumable_upload](https://developers.google.com/gdata/docs/resumable_upload)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-29T16:20:47.047

逆转整个过程是一种选择吗？我的意思是，不要将文件推送到服务器，而是让服务器使用标准 HTTP GET 和所有花里胡哨（如接受范围等）拉文件。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-29T18:32:38.590

也许最简单的方法是创建一个上传页面，该页面将接受参数中的文件名和范围，例如[http://yourpage/.../upload.php?file=myfile&from=123456](http://yourpage/.../upload.php?file=myfile&from=123456)并在客户端处理简历（也许您可以添加一个函数来检查服务器已收到哪些范围）

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2010-11-12T22:31:10.063

@ Anton Gogolev Lol，我只是在想同样的事情——把整个事情颠倒过来，让服务器成为客户端，而客户端成为服务器。感谢 Roel，为什么它不起作用，我现在更清楚了。

@Roel 我建议实现 Java 上传器 [JumpLoader 很好，它的 JScript 接口甚至是 PHP 服务器端示例代码]。当涉及到 BIIIGGG 文件时，Flash 上传者遭受了严重的损失 :) ，以千兆字节为单位。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2013-07-17T23:14:41.113

F*EX 可以通过 HTTP 上传高达 TB 范围的文件，并且能够在链接失败后恢复。它不能完全满足您的需要，因为它是用 Perl 编写的，并且需要基于 UNIX 的服务器，但客户端可以在任何操作系统上。也许它对你有帮助：http: [//fex.rus.uni-stuttgart.de/](http://fex.rus.uni-stuttgart.de/)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2021-01-28T13:39:32.133

存在称为[TUS](https://tus.io/protocols/resumable-upload.html)的协议，用于可恢复上传，并在[PHP](https://github.com/ankitpokhrel/tus-php)和[C++中实现了一些实现](https://github.com/umitkablan/betus)

# java - 使用 jsf 进行多个 CRUD 的最佳策略

> ID：492315
> 
> 赞同：1
> 
> 时间：2009-01-29T16:18:54.273
> 
> 标签：java, hibernate, jsf, crud

在我的公司，我们正在使用 java 和 jsf 开发一个类似 ERP 的应用程序，到目前为止，设计团队已经确定了大约 20 个实体，每个实体都有不同的属性，通常我们会构建 20 页的 CRUD，有没有更好的方法来做这个？，我们使用hibernate作为数据库访问，所以我们想出了一个单一的DAO系统的这一部分的想法，你遇到过类似的情况吗？你对此有什么想法？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-18T10:51:43.170

你真的应该看看Seam。它有一个名为[Seam-Gen](http://docs.jboss.com/seam/2.1.1.GA/reference/en-US/html/gettingstarted.html)的功能，可以从数据库中对整个应用程序的 CRUD 页面进行逆向工程。您可以编辑 Seam-Gen 模板（基于 Freemarker）来自定义将根据您的喜好生成的页面。

我使用 Eclipse 插件[Azzurri Clay](http://www.azzurri.jp/en/clay/index.html)为我的数据库建模并生成 DDL。然后我运行 Seam-Gen，几秒钟后你就有了一个正在运行的应用程序。这是一个非常方便的组合。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-29T16:24:07.070

您可能会考虑代码生成这 20 个屏幕，就像 Ruby 中的脚手架一样。就 DAO 而言，您可以将 CUD 操作拉到一些通用的 IBusinessObjectDao 中，将特定的 R 操作（通过各种参数查询）留给具体的 DAO 实现。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-11-05T18:58:33.750

我知道为时已晚，但我认为我的小框架非常适合这种情况。查看[http://code.google.com/p/happyfacescud/](http://code.google.com/p/happyfacescrud/)。它具有开箱即用的搜索、识别实体数据类型的自定义组件、惰性数据模型以及代码生成器无法提供的灵活性。这是带有惰性数据表和搜索的页面的小示例：

```
 <hf:searchPanel columns="4" backingBean="#{accountBean}">
        <hf:searchField label="#{messages['account.accountNumber']}" field="accountNumber" />
        <hf:searchField label="#{messages['account.active']}" field="active" isMessage="true" />
        <hf:searchEntityField label="#{messages['account.customer']}" field="customer" childField="name" popup="true" />
        <hf:searchField label="#{messages['account.openingDate']}" field="openingDate" rangeSearch="false" />
    </hf:searchPanel>
    <hf:dataList label="#{messages['account.search.results']}" backingBean="#{accountBean}">
        <hf:column label="#{messages['account.accountNumber']}" field="accountNumber" />
        <hf:column label="#{messages['account.active']}" field="active" isMessage="true" />
        <hf:column label="#{messages['account.customer']}" field="customer" childField="name" entityView="/pages/customerEdit.xhtml" popupFields="email,phone,address" />
        <hf:column label="#{messages['account.openingDate']}" field="openingDate" isDate="true" />
        <hf:actionsColumn />
    </hf:dataList> 
```

# xml - 什么类型的 X509 证书用于 XML 签名？

> ID：492323
> 
> 赞同：1
> 
> 时间：2009-01-29T16:21:20.337
> 
> 标签：xml, certificate, pki, x509, xml-signature

我目前正在开发一些使用 XML 签名在两台机器之间安全传输文件的软件。我们使用来自我们自己的 CA 的 X.509 证书作为密钥。

CA（Windows 2003 服务器）提供多种类型的证书（电子邮件证书、服务器证书……）

我需要为 XML 签名生成哪一个？据我所知，签署证书需要“数字签名”扩展，但在填写证书请求时，它如何映射到 Windows Server 2003 提供的功能？

同样有用的是一些指向良好文档的指针，关于 x509 的谷歌搜索淹没在关于证书的其他主题的文章的白噪声中。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-06T08:00:18.110

XML 签名只是存储签名的格式，XML 签名本身不需要特殊的密钥用法。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-31T04:02:15.287

我没有直接的答案，但也许你可以在 Thawte.com 上找到它。我使用他们的证书来签署我的 .Net 程序集没有问题。您可以在 IE 中查看（和编辑）证书属性，见下文。

[替代文字 http://heeroz.com/thawte.jpg](http://heeroz.com/thawte.jpg)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-31T08:18:48.810

如果您在管理工具中打开 microsoft CA。在树的底部，您将看到证书模板。右键单击，您将获得管理选项。选择这个。

将打开一个新窗口，其中列出了所有证书模板。然后，您将能够查看它们的属性。这些将显示为选项卡式显示。在其中一个选项卡上将列出用途。在这里，您将看到诸如签名或密钥加密之类的内容。您将能够选择要使用的模板。服务器一个应该没问题。

我会更准确，但我面前没有 CA。

选择要使用的内容后，请确保已发布。

转到第一个窗口，看看它是否在已发布的模板列表中。

如果没有右键单击管理模板并从所有任务中选择发布。这将为您提供发布的选项。

# c++ - Eclipse C++ dll 导入

> ID：492329
> 
> 赞同：4
> 
> 时间：2009-01-29T16:22:30.067
> 
> 标签：c++, eclipse, dll, import

如何将 dll 导入 Eclipse C++ 项目？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-17T13:51:55.417

您不需要自己导入库文件，因为它们是二进制代码并且几乎没有用处。通常你会得到一个带有一堆头文件的二进制 lib/dll。您在程序源代码中包含头文件，在程序中使用 lib 中的函数。最后，在项目构建设置中，您在链接器步骤中指定您还希望与二进制 lib/dll 链接。该产品将是一个使用二进制库的可执行文件。

顺便说一句，这不是 Eclipse 独有的:)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-29T16:34:21.650

[http://www.jinvoke.com/book/export/html/37](http://www.jinvoke.com/book/export/html/37) - 用于在 Eclipse 下使用 Java 中的 dll

# sql-server - 我可以在 SQL Server 2005/08 中将“每个存储过程的参数”设置为高于 2100 吗？

> ID：492339
> 
> 赞同：1
> 
> 时间：2009-01-29T16:25:06.710
> 
> 标签：sql-server, linq-to-sql

任何单个 SQL 语句可以具有的参数数量有一个硬性限制，即 2100（对于 SQL Server 2005）或 1024（对于 SQL Server 2000）。

有谁知道增加这个数字的方法？

如果您想知道“为什么”（因为我自己会因为好奇而死），那么答案就在：

```
MyL2SDataContext.Accounts.Where(acct=> selectedAccountIDs.Contains(acct.ID))... 
```

谢谢，

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-29T16:27:15.207

这是一个硬性限制 - 我会认真考虑重新考虑扩展它的真正需要，特别是鉴于您提供的示例代码。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-29T16:28:18.420

没有办法增加这个数字。您可以将所需的值放在另一个表（或多个表）中，使用键将记录插入该表中，然后将该键传递给存储过程。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-07-23T12:06:42.290

我的目标是使用 xml 为这个问题提供更长期和永久的解决方案。对于 SQL Server 2005 及更高版本，xml 类型可能用于将 Linq 中的本地集合作为单个参数引入 SQL，并且可能 OpenXml 可用于 SQL Server 2000。

至于能够增加这个限制，我不确定，这就是我最终在这篇文章中的最终结果。我会在我的研究之后发回我在这里找到的任何东西。

请参阅我在 Microsoft Connect 站点上的帖子，如果您也希望修复此问题，请投票。

[https://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=475984](https://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=475984)

# php - 完成后不关闭与数据库的连接有什么安全隐患？

> ID：492340
> 
> 赞同：2
> 
> 时间：2009-01-29T16:26:01.230
> 
> 标签：php, database, security

使用后不关闭数据库连接会引发哪些安全问题？一旦新页面加载，PHP 不会自动关闭它吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-29T16:32:04.153

正如[`mysql_close()`](http://uk.php.net/mysql_close)文档所说：

> 通常不需要使用 mysql_close()，因为非持久打开的链接会在脚本执行结束时自动关闭。另请参阅释放资源。

由于连接由 PHP 管理，因此不应该存在安全风险。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-29T16:37:27.697

PHP*应该*是一种“无共享”架构。即为每个请求分配所有资源，然后在请求完成后进行清理。因此，应该释放或关闭内存、文件句柄、套接字、数据库连接等资源。

但是，您可以使用未关闭但被重新用于下一个请求的[持久数据库连接。](http://php.net/mysql_pconnect)如果你这样做，会有一些安全隐患。任何连接状态都会被下一个 PHP 请求继承。因此，如果您的应用程序使用数据库用户定义的变量或临时表，甚至是`LAST_INSERT_ID()`，下一个 PHP 请求可能会看到它不应该看到的特权数据。

如果您关闭数据库连接以避免这种情况，那么您基本上是在破坏持久连接的价值。因此，您不妨使用普通的数据库连接。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-29T16:30:02.720

我不能说页面是否关闭连接（这取决于管理它的任何内容），但一般来说，完成后关闭它是个好主意，因为让它打开更长时间可能会导致饥饿问题对于同时处理的其他想要连接到同一数据源的页面。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-29T16:41:32.073

[Jeff Atwood](https://stackoverflow.com/users/1/jeff-atwood)就这个主题写[了一篇有趣的博客文章，您可能会觉得很有趣。](http://www.codinghorror.com/blog/archives/001211.html)

# c# - 获取浏览器控件中当前光标位置的链接 ID

> ID：492345
> 
> 赞同：1
> 
> 时间：2009-01-29T16:27:00.137
> 
> 标签：c#, hyperlink, browser

我们在 c# winforms 中使用 WebBrowser 控件，需要能够获取有关光标所在的 Url 的信息。

所以我们有一个设计模式的网页，它有多个 url，当光标在一个上时，我想调用一个返回链接 id 的方法。

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-09T11:54:33.493

您可以使用获取当前范围内的元素，`IHTMLCaret`从那里获取光标位置。`IMarkupPointer`

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-29T17:13:31.587

webBrowser 控件有一个 Document 属性，该属性有一个 Links 集合。每个链接都是一个 HTMLElement，其中包含您可以访问的事件。同样，我不确定您的意思是“光标”，因为在网络世界中，除非您在文本框中，否则真的没有“光标”（这是我在评论中要问的）但是你可以点击 MouseOver 事件和其他类似的东西。

例子：

```
 foreach (HtmlElement element in this.webBrowser1.Document.Links)
    {
        element.MouseOver += (o, ex) =>
        {
            Console.WriteLine(ex.ToElement.GetAttribute("HREF"));
        };
    } 
```

这将打印出鼠标所在的实际 URL。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-29T17:13:46.987

您可以查看这篇文章 -[在 C# winform 中托管 Web 浏览器组件](http://blog.monstuff.com/archives/000052.html)- 它解释了执行该操作的几种方法。或者直接转到这个 -[在 Windows 窗体中托管网页](http://www.codeproject.com/KB/cs/winformiehost.aspx)- 基本上你需要做的是处理 IE 的 COM WebBrowser 内的 DOM 对象的单击。您可以通过处理 C# 代码中的 Js 事件来实现这一点。

我记得这种自定义必须使用 AxSHDocVw.AxWebBrowser COM 对象而不是较新版本的 .Net Framework 中的 System.Windows.Forms.WebBrowser 类来完成。

我可以向您发送有关此的更多数据，我做了一些项目，请给我时间找到它；）。同时尝试使用这些链接。

经过！

# asp.net - ASP.NET MVC 和 httpRuntime executionTimeout

> ID：492346
> 
> 赞同：42
> 
> 时间：2009-01-29T16:27:14.723
> 
> 标签：asp.net, asp.net-mvc, configuration, timeout, httpruntime

我想增加`httpRuntime` `executionTimeout`一个 ASP.NET MVC 应用程序的一个小节。

在常规 Web 应用程序中，您可以使用：

```
<configuration>
  <location path="UploadPage.aspx">
    <httpRuntime executionTimeout="600"/>
  </location>
</configuration> 
```

然而，在 ASP.NET MVC 中确实没有“文件夹”的想法，那么我将如何去做呢？

让我们假设 ASP.NET MVC 路径`/Images/Upload`带有一个 ImagesController 和 Upload Action。

* * *

## 回答 #1

> 赞同：51
> 
> 时间：2009-03-11T22:19:34.530

您可以在 <location> 标记的路径属性中包含整个 MVC 路径（控制器和操作）。像这样的东西应该工作：

```
<location path="Images/Upload">
    <system.web>
        <httpRuntime executionTimeout="600" />
    </system.web>
</location> 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-03-14T05:33:57.470

[Chris Hynes 解决方案](https://stackoverflow.com/a/636609/7724)有效！请确保不要将 ~/ 包含在您的路径中。

[这个答案](https://stackoverflow.com/questions/29686/set-asp-net-executiontimeout-in-code-refresh-request/29754#29754)详细说明了另一种方式 - 只需`ScriptTimeout`在您的操作代码中设置：

```
public ActionResult NoTimeout()
{
    HttpContext.Server.ScriptTimeout = 60 * 10; // Ten minutes..
    System.Threading.Thread.Sleep(1000 * 60 * 5); // Five minutes..
    return Content("NoTimeout complete", "text/plain"); // This will return..
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-20T20:00:18.117

如果操作在默认控制器中，则 home/upload 不起作用，您只需输入操作名称。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-07-19T13:37:31.227

我注意到您正在专门尝试增加上传页面的超时时间。我在名为 plupload 的“分块”上传器上取得了一些成功。可以设置一个相对简单的 MVC 操作来接收上传的块，并在收到每个块时附加它。使用小块，您无需增加超时。当然可能会有一些浏览器限制，但是 n

[http://plupload.com/](http://plupload.com/)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-12-15T08:25:02.800

看看一个 AsyncController，如果你使用它，你将有可能在一个动作方法上设置一个 AsyncTimeout 属性，这样你就可以使请求超时。

帮助我的链接： [http ://forums.asp.net/p/1564303/3922462.aspx](http://forums.asp.net/p/1564303/3922462.aspx) [http://dariosantarelli.wordpress.com/2010/10/16/asp-net-mvc-2-handling-timeouts-异步控制器/](http://dariosantarelli.wordpress.com/2010/10/16/asp-net-mvc-2-handling-timeouts-in-asynchronous-controllers/)

# sharepoint - 如何访问启动工作流的用户的 uiserID

> ID：492355
> 
> 赞同：2
> 
> 时间：2009-01-29T16:28:34.550
> 
> 标签：sharepoint, workflow, sharepoint-designer

**欺骗：**见下面的链接

我有一个 SharePoint Designer 工作流，我需要向启动该工作流的用户发送一封电子邮件。它仅设置为手动启动，因此它应该始终在特定用户的上下文中运行。

我看不到让我执行此操作的 SharePoint Designer 操作，只能获取创建列表项的用户或访问列表上的“修改者”列。其中没有一个保证是调用工作流的用户。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-30T09:31:22.863

发现之前发布的相同问题。这似乎是不可能的，但[可以在此处找到自定义工作流活动的代码。](https://stackoverflow.com/questions/131238/in-sharepoint-designers-workflow-editor-how-do-i-get-the-workflow-initiators-use)

# sql-server - Microsoft 同步服务 - 适合我的解决方案吗？

> ID：492359
> 
> 赞同：3
> 
> 时间：2009-01-29T16:29:13.003
> 
> 标签：sql-server, sql-server-ce, microsoft-sync-framework

我们将商店的销售交易上传到总部服务器。目前，我们使用 DTS（SQL Server 数据转换服务），但我们计划将其替换为适用于 ADO.NET 的 Microsoft Sync 服务，因为这似乎是 Microsoft 对此类设置的首选解决方案，我们希望遵循标准（有望长期存在）。以下是我们设置的详细信息以及我们的计划。我正在寻找一些建议，尤其是关于 Sync Services 是否适合我们的解决方案。

**情况**

每家商店都有一个第 3 方 EPOS 系统，它将销售额存储在我们可以访问的 Microsoft Access 2000 数据库中。我们的总部数据库是SQL Server 2005，但将升级到2008。总部不在与所有商店的VPN上，但我们可以打开我们的防火墙到商店的IP地址，这样他们就可以直接向SQL发送数据服务器。这些商店总是通过 ADSL 连接到互联网，尽管它们确实失去了连接，我们不想丢失销售数据。我们只是从商店上传交易——不需要下载定义。

**当前解决方案**

我们编写了一个在商店 PC 上运行的 Windows 服务。该服务从服务器下载一个 DTS 包（其中包含上传的所有详细信息）并在商店中运行它——这会将销售上传到我们的服务器。我们选择了 DTS，因为安装 MSDE 时它是免费的。我们不能使用 SSIS，因为这需要每个商店都有 SQL Server 许可证。我们选择 DTS 的另一个原因是上传的详细信息（即要包含哪些表和字段）存储在我们的总部服务器上，因此如果我们需要更改内容，我们可以集中完成，而无需安装任何新内容商店。这不是一个炫耀，但在我们的新解决方案中拥有这种能力会很好。

**潜在的解决方案 - 适用于 ADO.NET 的 Microsoft Sync 服务**

我们目前正在使用 Microsoft Sync 服务为 ADO.NET 构建概念验证。这个想法是将 SQL CE (SQL Server Compact 3.5) 放在每个商店（客户端）中，并将其同步到总部 SQL Server 2005 数据库（服务器）。我们将通过 (1) 将数据与 Access 2000 数据库同步或 (2) 让 EPOS 系统开发人员将销售额直接写入 SQL CE 数据库——可能是 (2) 将数据输入 SQL CE 数据库。但我们主要关心的是从商店获取数据到总部服务器。这种方法似乎是微软对偶尔连接系统的首选解决方案，这也是我们认真看待同步服务的原因。我希望使用它意味着上传销售所需的大部分工作将内置到同步服务中，我们不必重新发明轮子。

**潜在的解决方案 - 上传到自定义 Web 服务**

也可以将销售交易上传到我们总部服务器上的自定义 Web 服务，然后上传到我们的 SQL Server 数据库。这意味着我们必须建立自己的机制来确定哪些行是新的，以及在系统断开连接时进行缓存。此外，我们可能会错过同步服务中内置的其他功能。

如果您有任何有用的建议，请告诉我，尤其是：“同步服务是正确的解决方案吗！”。我们试图解决的问题似乎非常普遍（从商店上传销售）——我想用一个通用的解决方案来解决它。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-29T19:00:55.193

Microsoft Sync 服务超出了您的需要，但它肯定会满足您的需求，并且它是根据您的应用程序类型构建的。

与大多数来自 microsoft 的新技术一样，（注意：泛化！）您可能会发现它并不像您希望的那样成熟。它会做你需要做的事情，但你可能会遇到不容易解决的问题，因为它没有通过振铃器。但是，作为早期采用者，您可能会发现 Sync 开发人员在您遇到困难时会急于帮助您，因此这并不是看起来那么大的问题。

确保你通读了所有关于它的文献，其中一些在这里，或者在以下站点中链接：

*   [http://msdn.microsoft.com/en-us/sync/default.aspx](http://msdn.microsoft.com/en-us/sync/default.aspx)
*   [http://msdn.microsoft.com/en-us/sync/bb887608.aspx](http://msdn.microsoft.com/en-us/sync/bb887608.aspx)
*   [http://en.wikipedia.org/wiki/Microsoft_Sync_Framework](http://en.wikipedia.org/wiki/Microsoft_Sync_Framework)

但是，考虑到您的单向信息流和集中式布局，我希望您在设置和使用它时应该很少（如果有的话）出现问题。

请务必在此处报告您的体验！

-亚当

# wxpython - ScrolledWindow 和 wx.EVT_LEAVE_WINDOW

> ID：492365
> 
> 赞同：1
> 
> 时间：2009-01-29T16:30:05.670
> 
> 标签：wxpython, wxwidgets

我有一个带有 textctrl 的框架。当鼠标进入 textctrl (EVT_ENTER_WINDOW) 时，我在 textctrl 顶部显示一个 PopupWindow，当鼠标离开弹出窗口 (EVT_LEAVE_WINDOW) 时，我再次隐藏它。

一切正常，除非在 PopupWindow 内有一个 ScrolledWindow*和显示的滚动条*。当我将鼠标移动到滚动条顶部时，EVT_LEAVE_WINDOW 会被触发，所以看起来 wxPython 认为滚动条不是滚动窗口的一部分。：/我尝试将事件绑定到弹出窗口或滚动窗口本身，但没有任何变化。 . 有没有办法解决这个问题？

非常感谢！

（Xubuntu 8.10 上的 wxPython 2.8.8.0）

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-05T19:07:59.010

由于工具提示通常会在用户移动鼠标时消失，因此您也可以绑定到`EVT_MOTION`而不是`EVT_LEAVE_WINDOW`在用户移动鼠标时隐藏工具提示。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-07-30T07:26:44.617

Robin Dunn 告诉我：“滚动窗口上的任何其他小部件都会发生同样的事情，就像当鼠标移动到滚动窗口时框架将获得 EVT_LEAVE_WINDOW 一样（假设框架的某些部分是可见的，所以它可以也收到了进入窗口事件）”

# c++ - 使用事件处理程序

> ID：492366
> 
> 赞同：1
> 
> 时间：2009-01-29T16:30:12.143
> 
> 标签：c++, c, events, mouse, handler

有没有办法在 c/c++ 中使用鼠标作为事件处理程序，我是一名学生并有一个迷你项目要做，我在蛇和梯子（著名的棋盘游戏）上制作游戏，并尝试使用基本的 borland c++ 编译器制作它使用名为 graphics.h 的头文件，它非常基本，输出为 640 X 480 res，所以我想知道是否有可能使用鼠标作为事件处理程序（我没有经验）来控制在板上的palyer 硬币。

我在二年级工程（计算机科学分支）

提前谢谢您的帮助！

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-29T16:40:06.990

您可以使用 Win32 编程（在 Visual Studio 中）使用鼠标和键盘事件。

是否需要使用 borland c++。

我认为 borland c++ 中有类似的 API。

您可以参考[http://www.functionx.com/win32/index.htm](http://www.functionx.com/win32/index.htm)以获取有关使用 Win32 编程在 Visual Studio 中处理事件的更多信息。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-29T16:41:32.103

我不确定您碰巧拥有哪个版本的 graphics.h，但有函数`getmousey`、`getmousey`和. 有关可能对您有用的一些文档，[请参阅此内容。](http://www.stefansundin.se/programmering/proga/WINBGIM-%20MANUAL.pdf)`clearmouseclick``getmouseclick`

您可以使用`registermousehandler`回调函数来执行某种级别的基于事件的编程。这是我发给你的文件中的一个样本。

```
// The click_handler will be called whenever the left mouse button is
// clicked. It checks copies the x,y coordinates of the click to
// see if the click was on a red pixel. If so, then the boolean
// variable red_clicked is set to true. Note that in general
// all handlers should be quick. If they need to do more than a little
// work, they should set a variable that will trigger the work going,
// and then return.
bool red_clicked = false;
void click_handler(int x, int y)
{
    if (getpixel(x,y) == RED)
    red_clicked = true;
}

// Call this function to draw an isosoles triangle with the given base and
// height. The triangle will be drawn just above the botton of the screen.
void triangle(int base, int height)
{
    int maxx = getmaxx( );
    int maxy = getmaxy( );
    line(maxx/2 - base/2, maxy - 10, maxx/2 + base/2, maxy - 10);
    line(maxx/2 - base/2, maxy - 10, maxx/2, maxy - 10 - height);
    line(maxx/2 + base/2, maxy - 10, maxx/2, maxy - 10 - height);
}
void main(void)
{
    int maxx, maxy; // Maximum x and y pixel coordinates
    int divisor; // Divisor for the length of a triangle side
    // Put the machine into graphics mode and get the maximum coordinates:
    initwindow(450, 300);
    maxx = getmaxx( );
    maxy = getmaxy( );
    // Register the function that handles a left mouse click
    registermousehandler(WM_LBUTTONDOWN, click_handler);
    // Draw a white circle with red inside and a radius of 50 pixels:
    setfillstyle(SOLID_FILL, RED);
    setcolor(WHITE);
    fillellipse(maxx/2, maxy/2, 50, 50);
    // Print a message and wait for a red pixel to be double clicked:
    settextstyle(DEFAULT_FONT, HORIZ_DIR, 2);
    outtextxy(20, 20, "Left click in RED to end.");
    setcolor(BLUE);
    red_clicked = false;
    divisor = 2;
    while (!red_clicked)
    {
        triangle(maxx/divisor, maxy/divisor);
        delay(500);
        divisor++;
    }
    cout << "The mouse was clicked at: ";
    cout << "x=" << mousex( );
    cout << " y=" << mousey( ) << endl;
    // Switch back to text mode:
    closegraph( );
} 
```

# windows - 如何在纹理的 3d 空间中显示 windows/X 窗口系统窗口？

> ID：492370
> 
> 赞同：2
> 
> 时间：2009-01-29T16:30:25.653
> 
> 标签：windows, linux, 3d, desktop

我想知道，如何捕捉一个窗口并将其显示在 3D 空间的纹理上。以及如何将鼠标和键盘输入从 3D 应用程序重定向到后台运行的应用程序？我的意思是全3D桌面。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-29T16:54:03.967

这可能有点复杂，“完整”的答案可能不适合这个论坛。不过，这是一个想法/大纲：

一种方法是通过[VNC](http://www.realvnc.com/)。在 VNC 服务器中运行一个单独的、不可见的“虚拟”桌面，然后以它作为显示启动所需的应用程序。然后，您在“真实”桌面上的 3D 渲染程序可以连接到 VNC 服务器，并以位图格式访问其桌面，并将其投射到纹理多边形上。输入事件的管道也是非常可行的。

我实际上已经做到了这一点，或者至少完成了一半（显示）。这是我当时设法做的一个非常古老的屏幕截图：（ [来源：][[sourceforge.net](http://verse.sourceforge.net/shots/vnc-screen.png)][）] 黑色的天空和蓝色/紫色的“地面”由真实桌面上的 3D 程序渲染，而倾斜的四边形在“虚拟”VNC 桌面中显示一个窗口。[![替代文字](https://i.stack.imgur.com/Qmoas.gif)](https://i.stack.imgur.com/Qmoas.gif)

乐趣！

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-30T14:08:58.463

该解决方案的一个关键部分是 OpenGL/GLX 扩展[`GLX_EXT_texture_from_pixmap`](http://www.opengl.org/registry/specs/EXT/texture_from_pixmap.txt)，它弥合了 X11 和 OpenGL 世界之间的差距。

至于其余的...... [Compiz](http://www.freedesktop.org/wiki/Software/Compiz)和[CompizFusion](http://wiki.compiz-fusion.org/)已经实现了 3D 桌面。试一试；如果您对事情的工作方式有一些具体的想法，则可以免费获得源代码（并且它们也支持插件的想法）。

# asp.net - ASP.NETDatagrid，显示格式化数据

> ID：492372
> 
> 赞同：0
> 
> 时间：2009-01-29T16:30:40.753
> 
> 标签：asp.net, data-binding

我有一个 ASPX 页面，我在其中呈现带有一些值的 Datagrid。我在后面的代码中动态创建 BoundCoulmns，如下所示，

```
 BoundColumn iCustomer = new BoundColumn();
        iCustomer.HeaderText = "Customer";
        iCustomer.DataField = "CustomerName";
        dgridProspList.Columns.Add(iCustomer);
        dgridProspList.DataBind(); 
```

这将显示 CustomerName，因为我已将其分配给 datafield 属性。现在我想对这个 CustomerName.ie 做一些修改；我想传递这个“CustomerName”和函数的返回值，我需要指定为 DAtaField。有什么办法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-29T16:41:26.427

如果我掌握了正确的方法，那么您可以通过使用 datagrids ondatabound 事件来做到这一点。在此事件中，您需要选择其中包含客户名称的单元格（类似于 row.cells[3]）。从这里您应该能够根据需要设置内容。

希望这会有所帮助

# linq-to-sql - 与 DDD、存储库模式和相关领域模型作斗争

> ID：492373
> 
> 赞同：2
> 
> 时间：2009-01-29T16:30:49.613
> 
> 标签：linq-to-sql, design-patterns, activerecord, domain-driven-design

我真的很难理解这些东西。让我举一个我在哪里挣扎的例子。

我使用 Linq-2-Sql 作为我的应用程序的 DAL，以及 Rob Conery 的 MVC Storefront 示例应用程序中使用的 IRepository 模式。

在我的域中，我有一个包含地址模型集合的客户模型。在我的 UI 中有一个按钮，允许用户向客户添加新地址。这会打开一个地址编辑器，让他们填写所有信息。

接下来发生什么？地址是否保存到数据库中，然后添加到我的客户对象的列表中？它只是被添加到列表中，但在保存 Customer 对象之前不会更新？如果用户想删除一个地址怎么办？我是否删除数据库中的地址，然后将其从列表中删除？还是他们只是进行他们想要的所有删除/添加，我每次都从数据库中转储所有内容并使用 Customer.Addresses 集合中的任何内容进行更新？这里的正确流程是什么？

地址的集合是否应该只通过存储库通过调用这样的东西来更新：

```
public void AddAddressToCustomer(Customer c, Address a)
{
    //validate and save address to db
    //add the newly saved address to the Customer Object
} 
```

帮助...

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-29T17:31:46.090

DDD 是一个我很感兴趣但经验很少的领域，所以请谨慎对待我的建议。我之所以提供它们，是因为没有其他更权威的答案。

在 Eric Evans 的“[书](http://domaindrivendesign.org/books/)”中，地址作为示例给出了通常应该被视为值对象而不是实体的东西。所以我相信 Add 方法将属于客户：

客户。添加（地址）；

将有一个客户存储库（但没有一个用于地址的）。这可能会像这样使用：

customerRepository.Update(客户);

这样做的有意影响是，您提出的关于如何在 DB 层实现这一点的所有困难问题​​都不是领域对象（即客户对象）的关注点。恐怕我也无能为力。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-29T21:56:01.330

听起来您并不像您需要的那样了解您的域的上下文。提出更多问题并获得更好的用户故事。您提出的任何方案都可能满足业务需求，具体取决于它是什么。当您了解需求时，我相信这个问题会自行解决。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-04T14:30:15.797

这取决于答案的良好开端。将地址添加到客户并使用以下方式保存客户后：

```
customer.Add(address);
customerRepository.Update(customer); 
```

然后，您的存储库会将您的客户和地址域层实体[映射](http://www.martinfowler.com/eaaCatalog/dataMapper.html)到 LINQ to SQL。这可能涉及创建一个新的 DataContext 对象，获取相关的 LINQ to SQL 实体（或创建新实体），然后将域层实体映射到您的 LINQ to SQL 实体。

```
var context = new MyDataContext();
var linqCustomer = MapCustomerToLinqCustomer(context, customer);
var linqAddress = MapAddressToLinqAddress(context, customer.Addresses.First());
context.SubmitChanges(); 
```

您也可以使用 DataMapper 类进行映射，但 MapXYZ 方法更接近于 Rob Conery 的示例。如果您需要更多有关 MapXYZ 方法的帮助，请告诉我。

# c++ - g++：静态库和动态库应该以什么顺序链接？

> ID：492374
> 
> 赞同：25
> 
> 时间：2009-01-29T16:31:07.540
> 
> 标签：c++, linker, shared-libraries, static-libraries, dynamic-linking

假设我们有一个名为“my_app”的主可执行文件，它使用了其他几个库：3 个库是静态链接的，另外 3 个是动态链接的。它们应该按什么顺序与“my_app”相关联？

但是这些应该以什么顺序联系起来呢？

假设我们得到了依赖于 libSB 的 libSA（如在静态 A 中）和依赖于 libSB 的 libSC：

```
libSA -> libSB -> libSC 
```

和三个动态库：（`libDA -> libDB -> libDC`是`libDA`基本的，`libDC`是最高的）

这些应该按什么顺序链接？基本的第一个还是最后一个？

```
g++ ... -g libSA libSB libSC -lDA -lDB -lDC -o my_app 
```

似乎是正确的顺序，但是这样吗？如果任何动态库与静态库或其他方式之间存在依赖关系怎么办？

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2009-01-29T17:02:23.873

在静态情况下，这并不重要，因为您实际上并没有链接静态库 - 您所做的只是将一些目标文件打包到一个存档中。您所要做的就是编译您的目标文件，并且您可以立即创建静态库。

动态库的情况比较复杂，有两个方面：

1.  共享库的工作方式与静态库完全相同（共享段除外，如果它们存在的话），这意味着您可以做同样的事情 - 只要您拥有目标文件就链接您的共享库。这意味着例如来自 libDA 的符号将在 libDB 中显示为未定义

2.  链接共享对象时，您可以在命令行上指定要链接的库。这与 1\. 具有相同的效果，但将 libDB 标记为需要 libDA。

不同之处在于，如果使用前一种方式，则在链接可执行文件时，必须在命令行中指定所有三个库（-lDA、-lDB、-lDC）。如果您使用后者，您只需指定 -lDC ，它会在链接时自动拉取其他人。请注意，链接时间就在您的程序运行之前（这意味着您可以获得不同版本的符号，甚至来自不同的库）。

这一切都适用于 UNIX；Windows DLL 的工作方式完全不同。

## 澄清问题后编辑：

从`ld`信息手册中引用。

> 链接器只会在命令行中指定的位置搜索存档一次。如果存档定义了在命令行上出现在存档之前的某个对象中未定义的符号，则链接器将包含存档中的适当文件。但是，稍后在命令行上出现的对象中的未定义符号不会导致链接器再次搜索存档。
> 
> 有关强制链接器多次搜索档案的方法，请参见 `-(' 选项。
> 
> 您可以在命令行上多次列出同一个存档。
> 
> 这种类型的归档搜索是 Unix 链接器的标准。但是，如果您在 AIX 上使用 `ld'，请注意它与 AIX 链接器的行为不同。

这意味着：

任何依赖于其他库的静态库或对象都应放在命令行中的前面。如果静态库相互依赖循环，你可以例如。使用`-(`命令行选项，或将库放在命令行上两次 ( `-lDA -lDB -lDA`)。动态库的顺序无关紧要。

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2009-01-29T19:36:38.303

这种问题最好通过一个简单的例子来解决。真的！花 2 分钟，编写一个简单的示例，然后尝试一下！你会学到一些东西，而且比问更快。

例如，给定文件：

a1.cc

```
#include <stdio.h>
void a1() { printf("a1\n"); } 
```

a2.cc

```
#include <stdio.h>
extern void a1();
void a2() { printf("a2\n");  a1(); } 
```

a3.cc

```
#include <stdio.h>
extern void a2();
void a3() { printf("a3\n"); a2(); } 
```

aa.cc

```
extern void a3();
int main()
{
  a3();
} 
```

跑步：

```
g++ -Wall -g -c a1.cc
g++ -Wall -g -c a2.cc
g++ -Wall -g -c a3.cc
ar -r liba1.a a1.o
ar -r liba2.a a2.o
ar -r liba3.a a3.o
g++ -Wall -g aa.cc -o aa -la1 -la2 -la3 -L. 
```

显示：

```
./liba3.a(a3.o)(.text+0x14): In function `a3()':
/tmp/z/a3.C:4: undefined reference to `a2()' 
```

然而：

```
g++ -Wall -g -c a1.C
g++ -Wall -g -c a2.C
g++ -Wall -g -c a3.C
ar -r liba1.a a1.o
ar -r liba2.a a2.o
ar -r liba3.a a3.o
g++ -Wall -g aa.C -o aa -la3 -la2 -la1 -L. 
```

成功。（只是更改了 -la3 -la2 -la1 参数顺序。）

PS：

```
nm --demangle liba*.a

liba1.a:
a1.o:
                 U __gxx_personality_v0
                 U printf
0000000000000000 T a1()

liba2.a:
a2.o:
                 U __gxx_personality_v0
                 U printf
                 U a1()
0000000000000000 T a2()

liba3.a:
a3.o:
                 U __gxx_personality_v0
                 U printf
                 U a2()
0000000000000000 T a3() 
```

来自***man nm***：

*   如果是小写，则符号是本地的；如果是大写，则符号是全局的（外部的）。

*   “T”符号在文本（代码）部分。

*   "U" 符号未定义。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-29T21:51:45.910

我在一个项目中使用了一堆内部库，不幸的是这些库相互依赖（随着时间的推移，情况变得更糟）。我们最终通过设置 SCons 以在链接时指定所有库两次来“解决”这个问题：

```
g++ ... -la1 -la2 -la3 -la1 -la2 -la3 ... 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-29T16:42:03.367

链接库或可执行文件的依赖项必须在链接时存在，因此您不能在 libXB 存在之前链接 libXC。不管是静态的还是动态的。

从最基本的开始，它没有（或只是在您的项目之外）依赖项。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-29T17:01:51.753

保持库彼此独立以避免链接顺序问题是一种很好的做法。

# sql - 为表的子集生成序列

> ID：492375
> 
> 赞同：0
> 
> 时间：2009-01-29T16:31:17.383
> 
> 标签：sql, sql-server

我在 SqlServer 9 中有一个表格，其中的数据为

```
Code    Number
J       0
J       5
J       8
Y       2
Y       8 
```

我想添加一个列，该列有一个带有每个代码内部数字序列的数字，以便我的表格看起来像这样；

```
Code    Number   Seq
J       0        1
J       5        2
J       8        3
Y       2        1
Y       8        2 
```

有没有人对实现这一目标的最佳方法有任何建议？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-29T16:41:43.773

查看[ROW_NUMBER()](http://msdn.microsoft.com/en-us/library/ms186734.aspx)函数。

```
DECLARE @Number TABLE (
    Code        nvarchar(1)
,   Number      int
)

INSERT @Number VALUES ('J', 0)
INSERT @Number VALUES ('J', 5)
INSERT @Number VALUES ('J', 8)
INSERT @Number VALUES ('Y', 2)
INSERT @Number VALUES ('Y', 8)

SELECT * FROM @Number

SELECT  Code
,       Number
,       ROW_NUMBER() OVER(PARTITION BY Code ORDER BY Code) AS Seq
FROM    @Number 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-29T16:40:37.473

在 Books On Line 中查找函数 row_number() 和 RANK()

# python - 如何使用 ctypes 将库的外部函数指针设置为 Python 回调函数？

> ID：492377
> 
> 赞同：3
> 
> 时间：2009-01-29T16:31:41.330
> 
> 标签：python, ctypes

一些 C 库导出函数指针，以便库的用户将该函数指针设置为他们自己函数的地址以实现挂钩或回调。

在这个示例库`liblibrary.so`中，如何使用 ctypes 将 library_hook 设置为 Python 函数？

图书馆.h：

```
typedef int exported_function_t(char**, int);
extern exported_function_t *library_hook; 
```

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-01-29T17:39:14.423

这在 ctypes 中很棘手，因为 ctypes 函数指针不实现`.value`用于设置其他指针的属性。相反，将您的回调函数和外部函数指针`void *`与`c_void_p`函数一起转换。如图所示设置函数指针后`void *`，C 可以调用您的 Python 函数，并且您可以将该函数作为函数指针检索并使用正常的 ctypes 调用来调用它。

```
from ctypes import *

liblibrary = cdll.LoadLibrary('liblibrary.so')

def py_library_hook(strings, n):
    return 0

# First argument to CFUNCTYPE is the return type:
LIBRARY_HOOK_FUNC = CFUNCTYPE(c_int, POINTER(c_char_p), c_int)
hook = LIBRARY_HOOK_FUNC(py_library_Hook)
ptr = c_void_p.in_dll(liblibrary, 'library_hook')
ptr.value = cast(hook, c_void_p).value 
```

# sql-server - 如何将字符串与位 (documentTitle+Archive) SQL server 2005 连接

> ID：492383
> 
> 赞同：4
> 
> 时间：2009-01-29T16:33:31.373
> 
> 标签：sql-server, string, bit, concatenation

当我尝试连接操作数类型冲突时出现以下错误：文本与位不兼容数据类型的无效运算符：运算符等于添加，类型等于位

```
SELECT
  F.SubmissionId, F.FormId, 
  F.DocumentTitle + F.Archive AS DocumentTitle,
  F.Keywords, F.PublishDate, F.PostedDate, F.ExpiredDate, 
  F.IsFlag, F.IsAdminOnly, F.IsCompleted, F.IsPublished,
  F.CreatedDate, F.AllowComments, 
  CASE WHEN F.Archive = 1 THEN 'Yes' ELSE 'No' END AS Archive, 
  I.ItemId, I.SubmissionId AS Expr1, I.ParamId, I.ParamValue
FROM
  dbo.app_FormSubmission AS F
    INNER JOIN dbo.app_FormSubmissionItems AS I ON 
      F.SubmissionId = I.SubmissionId 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-29T16:39:29.037

你需要转换，运行这个看看我的意思

```
declare @i bit
select @i = 1

select 'abc'  + convert(varchar(1),@i) -- fine
select 'abc'  + @i  -- will fail 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-29T16:36:39.633

无论您的情况如何，您为什么不在表示层中执行此操作？

如果这不是一个选项，那么这就是我会做的。首先，我会检查*case*语句是否按预期工作，如果是，我会使用*concat* SQL 函数来连接字符串。

并确保在 F.DocumentTitle + F.Archive 中使用 F.Archive 时，您实际上指的是*case*子句的结果，而不是原始列。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-29T18:19:52.517

我必须这样做才能使它工作。感谢 SQLMenace

SELECT CONVERT(varchar(50), F.DocumentTitle) + CONVERT(varchar(1), F.Archive) AS Expr1

# c - 如何找到“sizeof”（指向数组的指针）？

> ID：492384
> 
> 赞同：370
> 
> 时间：2009-01-29T16:33:34.413
> 
> 标签：c, arrays, pointers, sizeof

首先，这里有一些代码：

```
int main() 
{
    int days[] = {1,2,3,4,5};
    int *ptr = days;
    printf("%u\n", sizeof(days));
    printf("%u\n", sizeof(ptr));

    return 0;
} 
```

有没有办法找出`ptr`指向的数组的大小（而不是仅仅给出它的大小，在 32 位系统上是四个字节）？

* * *

## 回答 #1

> 赞同：321
> 
> 时间：2009-01-29T16:39:57.740

不，你不能。编译器不知道指针指向什么。有一些技巧，比如用一个已知的带外值结束数组，然后计算大小直到该值，但这不是使用`sizeof()`.

另一个技巧是[Zan](https://stackoverflow.com/users/13422/zan-lynx)提到的一个技巧，即将尺寸存储在某处。例如，如果您正在动态分配数组，请分配一个比您需要的大一个 int 的块，将大小存储在第一个 int 中，然后`ptr+1`作为指向数组的指针返回。当您需要大小时，减小指针并查看隐藏的值。请记住从头开始释放整个块，而不仅仅是数组。

* * *

## 回答 #2

> 赞同：107
> 
> 时间：2009-01-29T16:42:28.530

答案是不。”

C 程序员所做的是将数组的大小存储在某处。它可以是结构的一部分，或者程序员可以欺骗`malloc()`比请求更多的内存，以便在数组开始之前存储长度值。

* * *

## 回答 #3

> 赞同：52
> 
> 时间：2009-01-29T17:12:46.160

对于动态数组（*malloc*或 C++ *new*），您需要存储其他人提到的数组的大小，或者可能构建一个数组管理器结构来处理添加、删除、计数等。不幸的是，C 并没有做到这一点C ++，因为您基本上必须为要存储的每种不同的数组类型构建它，如果您需要管理多种类型的数组，这会很麻烦。

对于静态数组，例如您的示例中的那个，有一个用于获取大小的通用宏，但**不建议**这样做，因为它不检查参数是否真的是静态数组。该宏在实际代码中使用，例如在 Linux 内核头文件中，尽管它可能与下面的稍有不同：

```
#if !defined(ARRAY_SIZE)
    #define ARRAY_SIZE(x) (sizeof((x)) / sizeof((x)[0]))
#endif

int main()
{
    int days[] = {1,2,3,4,5};
    int *ptr = days;
    printf("%u\n", ARRAY_SIZE(days));
    printf("%u\n", sizeof(ptr));
    return 0;
} 
```

您可以出于对此类宏保持警惕的原因进行谷歌搜索。当心。

如果可能的话，C++ 标准库，比如vector，它更安全、更容易使用。

* * *

## 回答 #4

> 赞同：19
> 
> 时间：2012-04-19T11:53:43.050

有一个使用 C++ 模板的干净解决方案，无需使用**sizeof()**。以下**getSize()**函数返回任何静态数组的大小：

```
#include <cstddef>

template<typename T, size_t SIZE>
size_t getSize(T (&)[SIZE]) {
    return SIZE;
} 
```

这是一个带有**foo_t**结构的示例：

```
#include <cstddef>

template<typename T, size_t SIZE>
size_t getSize(T (&)[SIZE]) {
    return SIZE;
}

struct foo_t {
    int ball;
};

int main()
{
    foo_t foos3[] = {{1},{2},{3}};
    foo_t foos5[] = {{1},{2},{3},{4},{5}};
    printf("%u\n", getSize(foos3));
    printf("%u\n", getSize(foos5));

    return 0;
} 
```

输出：

```
3
5 
```

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2013-04-09T17:21:56.207

正如所有正确答案所述，您无法仅从数组的衰减指针值中获取此信息。如果衰减的指针是函数接收的参数，则必须以其他方式提供原始数组的大小，以便函数知道该大小。

这是一个与迄今为止提供的不同的建议，它将起作用：改为传递指向数组的指针。此建议类似于 C++ 样式建议，只是 C 不支持模板或引用：

```
#define ARRAY_SZ 10

void foo (int (*arr)[ARRAY_SZ]) {
    printf("%u\n", (unsigned)sizeof(*arr)/sizeof(**arr));
} 
```

但是，这个建议对您的问题来说有点愚蠢，因为该函数被定义为确切知道传入的数组的大小（因此，几乎不需要在数组上使用 sizeof）。不过，它所做的是提供某种类型的安全性。它将禁止您传入不需要大小的数组。

```
int x[20];
int y[10];
foo(&x); /* error */
foo(&y); /* ok */ 
```

如果该函数应该能够对任何大小的数组进行操作，那么您必须将大小作为附加信息提供给该函数。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2011-04-13T21:04:15.477

对于这个具体的例子，是的，如果你使用 typedefs（见下文）。当然，如果你这样做，你也可以使用 SIZEOF_DAYS，因为你知道指针指向什么。

如果您有一个 (void *) 指针，如 malloc() 等返回的那样，那么，不，无法确定指针指向的数据结构，因此无法确定其大小。

```
#include <stdio.h>

#define NUM_DAYS 5
typedef int days_t[ NUM_DAYS ];
#define SIZEOF_DAYS ( sizeof( days_t ) )

int main() {
    days_t  days;
    days_t *ptr = &days; 

    printf( "SIZEOF_DAYS:  %u\n", SIZEOF_DAYS  );
    printf( "sizeof(days): %u\n", sizeof(days) );
    printf( "sizeof(*ptr): %u\n", sizeof(*ptr) );
    printf( "sizeof(ptr):  %u\n", sizeof(ptr)  );

    return 0;
} 
```

输出：

```
SIZEOF_DAYS:  20
sizeof(days): 20
sizeof(*ptr): 20
sizeof(ptr):  4 
```

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2016-07-25T20:50:19.193

没有神奇的解决方案。C 不是反射语言。对象不会自动知道它们是什么。

但是你有很多选择：

1.  显然，添加一个参数
2.  将调用包装在宏中并自动添加参数
3.  使用更复杂的对象。定义一个包含动态数组以及数组大小的结构。然后，传递结构的地址。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2018-06-22T11:42:34.097

你可以这样做：

```
int days[] = { /*length:*/5, /*values:*/ 1,2,3,4,5 };
int *ptr = days + 1;
printf("array length: %u\n", ptr[-1]);
return 0; 
```

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2015-10-05T14:45:29.833

我对这个问题的解决方案是将数组的长度保存到结构数组中，作为数组的元信息。

```
#include <stdio.h>
#include <stdlib.h>

struct Array
{
    int length;

    double *array;
};

typedef struct Array Array;

Array* NewArray(int length)
{
    /* Allocate the memory for the struct Array */
    Array *newArray = (Array*) malloc(sizeof(Array));

    /* Insert only non-negative length's*/
    newArray->length = (length > 0) ? length : 0;

    newArray->array = (double*) malloc(length*sizeof(double));

    return newArray;
}

void SetArray(Array *structure,int length,double* array)
{
    structure->length = length;
    structure->array = array;
}

void PrintArray(Array *structure)
{       
    if(structure->length > 0)
    {
        int i;
        printf("length: %d\n", structure->length);
        for (i = 0; i < structure->length; i++)
            printf("%g\n", structure->array[i]);
    }
    else
        printf("Empty Array. Length 0\n");
}

int main()
{
    int i;
    Array *negativeTest, *days = NewArray(5);

    double moreDays[] = {1,2,3,4,5,6,7,8,9,10};

    for (i = 0; i < days->length; i++)
        days->array[i] = i+1;

    PrintArray(days);

    SetArray(days,10,moreDays);

    PrintArray(days);

    negativeTest = NewArray(-5);

    PrintArray(negativeTest);

    return 0;
} 
```

但是你必须关心设置你要存储的数组的正确长度，因为没有办法检查这个长度，就像我们的朋友大量解释的那样。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2016-03-15T11:22:40.720

不，你不能`sizeof(ptr)`用来查找数组`ptr`指向的大小。

如果您想将长度存储在额外的空间中，虽然分配额外的内存（超过数组的大小）会很有帮助。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2016-07-10T10:32:16.210

```
int main() 
{
    int days[] = {1,2,3,4,5};
    int *ptr = days;
    printf("%u\n", sizeof(days));
    printf("%u\n", sizeof(ptr));

    return 0;
} 
```

days[] 的大小为 20，即没有元素 * 数据类型的大小。而指针的大小是 4 无论它指向什么。因为指针通过存储它的地址来指向其他元素。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2021-03-14T18:51:33.767

这就是我个人在代码中的做法。我喜欢让它尽可能简单，同时仍然能够获得我需要的值。

```
typedef struct intArr {
    int size;
    int* arr; 
} intArr_t;

int main() {
    intArr_t arr;
    arr.size = 6;
    arr.arr = (int*)malloc(sizeof(int) * arr.size);

    for (size_t i = 0; i < arr.size; i++) {
        arr.arr[i] = i * 10;
    }

    return 0;
} 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2014-03-11T08:27:39.657

```
 #define array_size 10

 struct {
     int16 size;
     int16 array[array_size];
     int16 property1[(array_size/16)+1]
     int16 property2[(array_size/16)+1]
 } array1 = {array_size, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9};

 #undef array_size 
```

array_size 传递给***size***变量：

```
#define array_size 30

struct {
    int16 size;
    int16 array[array_size];
    int16 property1[(array_size/16)+1]
    int16 property2[(array_size/16)+1]
} array2 = {array_size};

#undef array_size 
```

用法是：

```
void main() {

    int16 size = array1.size;
    for (int i=0; i!=size; i++) {

        array1.array[i] *= 2;
    }
} 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2017-03-11T11:56:01.917

在字符串中，末尾有一个`'\0'`字符，因此可以使用诸如`strlen`. `NULL`例如，整数数组的问题是您不能使用任何值作为结束值，因此一种可能的解决方案是寻址数组并将指针用作结束值。

```
#include <stdio.h>
/* the following function will produce the warning:
 * ‘sizeof’ on array function parameter ‘a’ will
 * return size of ‘int *’ [-Wsizeof-array-argument]
 */
void foo( int a[] )
{
    printf( "%lu\n", sizeof a );
}
/* so we have to implement something else one possible
 * idea is to use the NULL pointer as a control value
 * the same way '\0' is used in strings but this way
 * the pointer passed to a function should address pointers
 * so the actual implementation of an array type will
 * be a pointer to pointer
 */
typedef char * type_t; /* line 18 */
typedef type_t ** array_t;
int main( void )
{
    array_t initialize( int, ... );
    /* initialize an array with four values "foo", "bar", "baz", "foobar"
     * if one wants to use integers rather than strings than in the typedef
     * declaration at line 18 the char * type should be changed with int
     * and in the format used for printing the array values 
     * at line 45 and 51 "%s" should be changed with "%i"
     */
    array_t array = initialize( 4, "foo", "bar", "baz", "foobar" );

    int size( array_t );
    /* print array size */
    printf( "size %i:\n", size( array ));

    void aprint( char *, array_t );
    /* print array values */
    aprint( "%s\n", array ); /* line 45 */

    type_t getval( array_t, int );
    /* print an indexed value */
    int i = 2;
    type_t val = getval( array, i );
    printf( "%i: %s\n", i, val ); /* line 51 */

    void delete( array_t );
    /* free some space */
    delete( array );

    return 0;
}
/* the output of the program should be:
 * size 4:
 * foo
 * bar
 * baz
 * foobar
 * 2: baz
 */
#include <stdarg.h>
#include <stdlib.h>
array_t initialize( int n, ... )
{
    /* here we store the array values */
    type_t *v = (type_t *) malloc( sizeof( type_t ) * n );
    va_list ap;
    va_start( ap, n );
    int j;
    for ( j = 0; j < n; j++ )
        v[j] = va_arg( ap, type_t );
    va_end( ap );
    /* the actual array will hold the addresses of those
     * values plus a NULL pointer
     */
    array_t a = (array_t) malloc( sizeof( type_t *) * ( n + 1 ));
    a[n] = NULL;
    for ( j = 0; j < n; j++ )
        a[j] = v + j;
    return a;
}
int size( array_t a )
{
    int n = 0;
    while ( *a++ != NULL )
        n++;
    return n;
}
void aprint( char *fmt, array_t a )
{
    while ( *a != NULL )
        printf( fmt, **a++ );   
}
type_t getval( array_t a, int i )
{
    return *a[i];
}
void delete( array_t a )
{
    free( *a );
    free( a );
} 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2021-08-03T17:46:09.190

大多数实现都会有一个函数告诉你用`malloc()`or分配的对象的保留大小`calloc()`，例如 GNU 有`malloc_usable_size()`

但是，这将返回反转块的大小，它可能大于给`malloc()`/的值`realloc()`。

* * *

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2021-12-09T19:28:14.127

有一个流行的宏，您可以定义它来查找数组中的元素数量（Microsoft CRT 甚至为它提供了带有 name 的 OOB `_countof`）：

```
#define countof(x) (sizeof(x)/sizeof((x)[0])) 
```

然后你可以写：

```
int my_array[] = { ... some elements ... };
printf("%zu", countof(my_array)); // 'z' is correct type specifier for size_t 
```

# python - IndentationError: unindent 不匹配任何外部缩进级别

> ID：492387
> 
> 赞同：729
> 
> 时间：2009-01-29T16:34:46.893
> 
> 标签：python, indentation

当我编译下面的 Python 代码时，我得到

> IndentationError: unindent 不匹配任何外部缩进级别

* * *

```
import sys

def Factorial(n): # Return factorial
    result = 1
    for i in range (1,n):
        result = result * i
    print "factorial is ",result
    return result 
```

为什么？

* * *

## 回答 #1

> 赞同：811
> 
> 时间：2009-01-29T16:37:18.510

其他海报可能是正确的……您的标签中可能混有空格。尝试进行搜索和替换以用几个空格替换所有选项卡。

试试这个：

```
import sys

def Factorial(n): # return factorial
    result = 1
    for i in range (1,n):
        result = result * i
    print "factorial is ",result
    return result

print Factorial(10) 
```

* * *

## 回答 #2

> 赞同：319
> 
> 时间：2014-05-08T11:44:49.773

**重要提示**： ***空格是首选方法***- 请参阅 PEP 8[缩进](https://www.python.org/dev/peps/pep-0008/#indentation)和[制表符或空格？](https://www.python.org/dev/peps/pep-0008/#tabs-or-spaces). （为此感谢@Siha。）

对于**Sublime Text**用户：

将**Sublime Text**设置为使用制表符进行缩进： **查看**-->**缩进**-->**将缩进转换为制表符**

在上面的同一子菜单中取消选中**使用空格缩进选项。**这将立即解决此问题。

* * *

## 回答 #3

> 赞同：150
> 
> 时间：2009-02-04T21:50:28.420

要轻松检查制表符/空格的问题，您实际上可以这样做：

```
python -m tabnanny yourfile.py 
```

或者你当然可以正确设置你的编辑器:-)

* * *

## 回答 #4

> 赞同：48
> 
> 时间：2009-01-29T16:41:15.240

您确定没有在缩进空白中混合制表符和空格吗？（这将导致该错误。）

请注意，建议您不要在 Python 代码中使用制表符。请参阅[样式指南](http://www.python.org/dev/peps/pep-0008/)。您应该配置 Notepad++ 为制表符插入空格。

* * *

## 回答 #5

> 赞同：28
> 
> 时间：2009-01-29T16:45:19.430

每当我遇到此错误时，都是因为我在编辑器中以某种方式混淆了制表符和空格。

* * *

## 回答 #6

> 赞同：18
> 
> 时间：2015-05-07T09:43:20.837

如果您使用的是 Vim，请点击 escape，然后键入

gg=G

此自动缩进所有内容并将清除您输入的所有空格。

* * *

## 回答 #7

> 赞同：17
> 
> 时间：2013-06-13T15:26:00.760

如果您使用 Python 的 IDLE 编辑器，您可以按照它在类似错误消息之一中的建议进行操作：

1) 全选，例如`Ctrl`+`A`

2）转到格式 - >取消区域

3）仔细检查您的缩进是否仍然正确，保存并重新运行您的程序。

我正在使用 Python 2.5.4

* * *

## 回答 #8

> 赞同：11
> 
> 时间：2009-01-29T16:38:04.560

行：`result = result * i`应该缩进（它是 for 循环的主体）。

或者 - 你有混合的空格和制表符

* * *

## 回答 #9

> 赞同：10
> 
> 时间：2015-03-11T14:27:23.440

在[原子上](https://atom.io/)

去

```
Packages > Whitespace > Convert Spaces to Tabs 
```

然后再次检查您的文件缩进：

```
python -m tabnanny yourFile.py 
```

或者

```
>python
>>> help("yourFile.py") 
```

* * *

## 回答 #10

> 赞同：10
> 
> 时间：2020-01-05T16:56:55.533

对于 Spyder 用户，请转到 **Source > Fix Indentation** 以立即解决问题

* * *

## 回答 #11

> 赞同：8
> 
> 时间：2014-03-20T17:23:01.500

如果您使用记事本++，请使用扩展搜索模式执行“替换”以查找 \t 并替换为四个空格。

* * *

## 回答 #12

> 赞同：8
> 
> 时间：2020-07-24T08:01:24.113

**使用 Visual Studio 代码**

如果您使用的是 vs code than，它将使用以下简单步骤将所有混合缩进转换为空格或制表符。

1.  按`Ctrl + Shift + p`

2.  类型`indent using spaces`

3.  按`Enter`

* * *

## 回答 #13

> 赞同：7
> 
> 时间：2012-07-31T20:27:51.850

看起来是一个缩进问题。您不必匹配 Python 中的大括号，但您*必须*匹配缩进级别。

防止空格/制表符问题的最佳方法是在文本编辑器中显示不可见字符。这将为您提供一种快速的方法来防止和/或解决与缩进相关的错误。

此外，注入复制粘贴代码是此类问题的常见来源。

* * *

## 回答 #14

> 赞同：5
> 
> 时间：2015-11-12T21:42:44.137

只是一个补充。Notepad ++中的两个缩进都有类似的问题。

1.  无例外的缩进
2.  外部缩进级别

    转到---->搜索选项卡---->点击**替换---->点击下面的****扩展**单选按钮--->现在用四个空格替换\t

    转到---->搜索选项卡---->点击**替换**---->点击下面的单选按钮**扩展**--->现在将\n替换为空

* * *

## 回答 #15

> 赞同：5
> 
> 时间：2018-12-15T04:48:05.587

我正在使用 Jupyter notebook 并尝试了几乎所有上述解决方案（适应我的场景）都没有用。然后我逐行删除每一行的所有空格并替换为制表符。这解决了这个问题。

* * *

## 回答 #16

> 赞同：5
> 
> 时间：2019-03-05T23:00:45.870

对于它的价值，我的文档字符串缩进太多，这也会引发同样的错误

```
class junk: 
     """docstring is indented too much""" 
    def fun(): return 
```

`IndentationError: unindent does not match any outer indentation level`

* * *

## 回答 #17

> 赞同：5
> 
> 时间：2021-03-03T10:28:51.550

我在 Ubuntu 操作系统中使用**Sublime 文本。**要解决此问题，请访问

> 查看 -> 缩进 -> 将缩进转换为制表符

* * *

## 回答 #18

> 赞同：2
> 
> 时间：2014-02-14T02:52:13.967

这可能是因为它上面的函数没有以相同的方式缩进。IE

```
class a:
    def blah:
      print("Hello world")
    def blah1:
      print("Hello world") 
```

* * *

## 回答 #19

> 赞同：2
> 
> 时间：2015-07-28T12:41:15.563

对于 Atom 用户，`Packages ->whitspace -> remove trailing whitespaces` 这对我有用

* * *

## 回答 #20

> 赞同：2
> 
> 时间：2018-12-07T13:42:26.443

由于我意识到没有特定于 的答案`spyder`，所以我会添加一个：基本上，仔细查看您的`if`陈述并确保所有`if`，`elif`并`else`具有相同的间距，即它们在开始时位于同一行，如下所示：

```
def your_choice(answer):
    if answer>5:
        print("You're overaged")
    elif answer<=5 and answer>1: 
            print("Welcome to the toddler's club!")
    else:
            print("No worries mate!") 
```

* * *

## 回答 #21

> 赞同：2
> 
> 时间：2020-06-30T15:52:40.497

我正在使用带有 Flask 项目的 Sublime Text 3。我使用 View > Indentation > Tab Width: 4 after unselected Indent Using Spaces 修复了错误

* * *

## 回答 #22

> 赞同：2
> 
> 时间：2021-11-25T03:40:10.697

如果您使用 colab，那么您可以通过此命令避免错误。

> 1.  < Ctrl-A >
> 2.  <标签>
> 3.  < Shift-Tab >

都是 [tab] 缩进转换为 [space] 缩进。然后确定。

* * *

## 回答 #23

> 赞同：1
> 
> 时间：2014-03-05T13:43:15.200

这是因为制表符和空格混合在一起。您可以删除所有空格并用制表符替换它们。

或者，尝试这样写：

```
#!/usr/bin/python -tt 
```

在代码的开头。此行解决了制表符和空格之间的任何差异。

* * *

## 回答 #24

> 赞同：1
> 
> 时间：2014-06-26T15:57:37.433

我昨天遇到了同样的问题，是缩进错误，使用的是 sublime 文本编辑器。我花了几个小时试图修复它，最后我将代码复制到 VI 文本编辑器中，它运行良好。ps python 对空格太敏感，请确保不要混合空格和制表符。

* * *

## 回答 #25

> 赞同：1
> 
> 时间：2018-12-10T14:07:07.620

我定义了一个函数，但除了函数注释之外*没有任何内容......*

```
def foo(bar):
    # Some awesome temporary comment.
    # But there is actually nothing in the function!
    # D'Oh! 
```

它喊道：

```
 File "foobar.py", line 69

                                ^
IndentationError: expected an indented block 
```

（注意`^`标记指向的行是空的）

--

多种解决方案：

1：只需注释掉函数

2：添加功能注释

```
def foo(bar):
    '' Some awesome comment. This comment could be just one space.'' 
```

3：添加什么都不做的行

```
def foo(bar):
    0 
```

在任何情况下，请务必*明确* **说明为什么**它是一个空函数 - 为您自己或将使用您的代码的同行

* * *

## 回答 #26

> 赞同：1
> 
> 时间：2018-12-25T11:49:39.063

首先，提醒您有一个逻辑错误，您最好保持 result=1 ，否则即使在循环运行后，您的输出也会是 result=0。

其次，你可以这样写：

```
import sys

def Factorial(n): # Return factorial
  result = 0
  for i in range (1,n):
     result = result * i

  print "factorial is ",result
  return result 
```

留下一行将告诉 python shell FOR 语句已经结束。如果您有使用 python shell 的经验，那么您可以理解为什么我们必须留下一行。

* * *

## 回答 #27

> 赞同：1
> 
> 时间：2020-07-24T07:52:41.453

即使我的代码中没有任何选项卡，我也会收到此错误，原因是我的代码中某处有一个多余的右括号。我应该早点弄清楚这一点，因为它在一些等号之前和之后弄乱了空格......如果即使在`Reformat code`IDE 中运行（或手动运行 autopep8）后发现任何问题，请确保所有括号匹配，从后面开始第一个等号之前/之后的奇怪空格。

* * *

## 回答 #28

> 赞同：0
> 
> 时间：2014-03-08T11:13:10.263

就我而言，问题是 Eclipse 上的 pydev 配置

![pydev@Eclipse](https://i.stack.imgur.com/Ve5TD.png)

* * *

## 回答 #29

> 赞同：0
> 
> 时间：2014-12-02T19:47:04.327

如果您使用 Komodo 编辑器，则可以按照类似错误消息之一中的建议进行操作：

1) 全选，例如 Ctrl + A

2）转到代码 - >取消区域

3）仔细检查您的缩进是否仍然正确，保存并重新运行您的程序。

我正在使用 Python 3.4.2

* * *

## 回答 #30

> 赞同：0
> 
> 时间：2015-01-28T07:18:27.623

如果你使用 Sublime text 进行 python 开发，可以通过使用 Anaconda 包来避免该错误。安装 Anaconda 后，

> 1.  用崇高的方式打开你的文件
> 2.  右键单击开放空间
> 3.  选择蟒蛇
> 4.  点击自动格式化
> 5.  完成或按 CTRL+ALT+R。

* * *

## 回答 #31

> 赞同：0
> 
> 时间：2019-07-29T17:28:19.710

在带有 python 插件的 intellij 中，Ctrl + Shift + Alt 重新格式化文档修复了缩进/制表符/空格问题

* * *

## 回答 #32

> 赞同：0
> 
> 时间：2019-08-13T08:13:59.637

对于**SPYDER**用户：我将 spyder 3.3.2 与 python 3.7.1 一起使用，我解决了这个问题，将缩进设置为使用制表符，通过以下步骤，单击：

*   工具。
*   优先。
*   编辑。
*   高级设置。
*   缩进字符 -> 制表符。

然后我使用制表键重置“未识别”行。

出于某种原因，如果没有这个设置，我有时会得到*幽灵*IndentationError。

* * *

## 回答 #33

> 赞同：0
> 
> 时间：2020-04-11T06:48:39.947

例如：

```
1\. def convert_distance(miles):
2\.   km = miles * 1.6
3\.   return km 
```

在这段代码中，我也发生了同样的情况。只需删除第 2 行和第 3 行之前的缩进空格，然后**使用制表符或空格。永远不要同时使用**。在 python 中编写代码时给予适当的缩进。对于 Spyder 转到源 > 修复缩进。VC 代码和 sublime text 或任何其他编辑器也是如此。修复缩进。

* * *

## 回答 #34

> 赞同：0
> 
> 时间：2021-06-20T03:18:58.210

尝试使用其他编辑器打开文件，并检查行的组织方式是否有任何问题。

* * *

## 回答 #35

> 赞同：0
> 
> 时间：2021-11-17T15:20:22.107

我今天遇到了这个问题，没有看到我犯的错误，所以我想我会添加它——也许可以为其他人节省几个小时:)

我在函数中使用回车，在这种情况下，空白行没有正确缩进。这导致 Python 抛出此错误并退出。

* * *

## 回答 #36

> 赞同：-1
> 
> 时间：2021-10-01T14:19:37.510

由于另一件事，我遇到了同样的错误，这与制表符与空格无关。我的第一个`if`缩进略多于`else:`更远的缩进。如果它只有一两个空格，您可能会在一段长代码块后对其进行监督。与文档字符串相同：

```
"""comment comment 
comment
""" 
```

它们还需要对齐，请参阅此处同一页面上的[其他答案。](https://stackoverflow.com/a/55012979/11154841)

用几行即可重现：

```
if a==1:
    print('test')
 else:
    print('test2') 
```

抛出：

```
 File "<ipython-input-127-52bbac35ad7d>", line 3
    else:
         ^
IndentationError: unindent does not match any outer indentation level 
```

* * *

## 回答 #37

> 赞同：-5
> 
> 时间：2018-01-29T03:53:33.427

这主要是因为编辑器。尝试将制表符更改为空格（4）。最好的 python 友好 IDE 或编辑器是 pycharm，sublime，vim for linux。
即使我也遇到过同样的问题，后来我发现有一个编码问题。我建议你也改变你的编辑器。

# c# - 如何获取域控制器 IP 地址

> ID：492391
> 
> 赞同：2
> 
> 时间：2009-01-29T16:35:47.110
> 
> 标签：c#, networking, active-directory, network-programming

如何以编程方式获取域控制器 IP 地址`C#`？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-29T17:54:34.767

这就是我将如何做到的。

您需要使用 System.Net 和 System.DirectoryServices。

```
// get root of the directory data tree on a directory server
DirectoryEntry dirEntry = new DirectoryEntry("LDAP://rootDSE");
// get the hostname of the directory server of your root (I'm assuming that's what you want)
string dnsHostname = dirEntry.Properties["dnsHostname"].Value.ToString();
IPAddress[] ipAddresses = Dns.GetHostAddresses(dnsHostname); 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-07T12:47:42.647

谢谢大家，

我按照这段代码完成了

```
 using System;
    using System.Collections.Generic;
    using System.Text;
    using System.Net;
    using System.Net.Sockets;
    using System.DirectoryServices.AccountManagement;
    using System.DirectoryServices.ActiveDirectory;
public doIt()
        {
            DirectoryContext mycontext = new DirectoryContext(DirectoryContextType.Domain,"project.local");
            DomainController dc = DomainController.FindOne(mycontext);
            IPAddress DCIPAdress = IPAddress.Parse(dc.IPAddress);
        } 
```

再次感谢

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-29T17:00:53.190

好吧，这里是如何获取它的一般工作流程，如 MS 站点所述：

[http://support.microsoft.com/kb/247811](http://support.microsoft.com/kb/247811)

这是来自 PInvoke.net 的链接，用于调用引用的**DsGetDcName**函数：

[http://pinvoke.net/default.aspx/netapi32/DsGetDcName.html](http://pinvoke.net/default.aspx/netapi32/DsGetDcName.html)

您可以按照第一个链接中的描述进行原始 DNS A 记录查询，但我认为 PInvoke 调用应该可以解决问题。

希望有帮助，

麦克风

# c# - C#中的垃圾收集器问题

> ID：492393
> 
> 赞同：1
> 
> 时间：2009-01-29T16:36:23.877
> 
> 标签：c#, garbage-collection

在 C# 代码中，我有三个对象**A**、**B**和**C**。**A**和**B**各自持有对**C**的引用。当**A**被销毁时，我希望从**B**到**C**的引用也被删除，以便**C**可以被垃圾收集器销毁。

有没有办法在不从**B**手动删除它的情况下做到这一点？**（ C**中的析构函数在**B**对**C**的引用被删除之前没有被调用，所以这里是无效的。）

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-01-29T16:40:03.620

它闻起来像是[WeakReference](http://msdn.microsoft.com/en-us/library/system.weakreference.aspx)的工作：

> 弱引用允许垃圾收集器收集对象，同时仍允许应用程序访问该对象。如果您需要该对象，您仍然可以获得对它的强引用并防止它被收集。

听起来您应该通过 WeakReference 从 B 引用到 C，而不是直接引用。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-01-29T16:38:01.287

首先，定义“删除”。然后考虑使用 Wea​​kReference 类。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-01-29T16:52:49.103

**解决方案 1**

B 是否从您的应用程序的其他任何地方引用？

如果 B 只能通过 A 访问，那么当 A 被“移除”时，B 和 C 将被“移除”。

**解决方案 2**

当 A 被“移除”时，您应该向 B 发送信号。如果 A 知道 B，您可以从 A 向 B 发出信号。我会为此使用[IDisposable](http://msdn.microsoft.com/en-us/library/system.idisposable.aspx)模式

**解决方案 3**

您可以使用来自 B 的 WeakReference 来访问 C，而不是直接从 B 引用 C。

# wcf - OperationFormatter 遇到无效的消息正文

> ID：492407
> 
> 赞同：1
> 
> 时间：2009-01-29T16:38:49.007
> 
> 标签：wcf, rest

我正在为外部 REST API 创建 WCF 客户端，但出现以下错误：

> OperationFormatter 遇到无效的消息正文

客户端正确地访问服务器并执行我需要的“发布”，但它期待不同的响应元素，基本上将“响应”附加到 OperationContract 名称的名称中，例如：

> OperationFormatter 遇到无效的消息正文。预计会找到名称为“companyResponse”和命名空间“”的节点类型“元素”。找到名称为“公司”和命名空间“”的节点类型“元素”

有谁知道如何使它删除将“响应”添加到名称中的要求？

其他详细信息（我添加了 ReplyAction 但没有任何区别）：

```
[OperationContract(Name="company", Action = "company", ReplyAction = "company")]
        [WebInvoke(
        Method = "POST",
        BodyStyle = WebMessageBodyStyle.WrappedResponse,
        ResponseFormat = WebMessageFormat.Xml,
        UriTemplate = "companies.xml"
        )]
        Company AddCompany(Company company); 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-18T03:50:47.490

操作合约中的 BodyStyle 已设置为**WrappedResponse**。将 BodyStyle 更改为**WebMessageBodyStyle.Bare**。

这告诉 WCF 运行时不要包含作为 XML 节点的包装器，其 Name= MethodName+ 单词“Response”

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-29T16:43:06.250

如果您发布了您正在使用的合同定义，将会有所帮助。通常，您将必须设置附加到您尝试调用的合同上的方法的 OperationContractAttribute 实例上的 Name 属性，并且可能还设置 Action 和 ReplyAction 属性。

# php - 为长期部署选择 PHP 框架

> ID：492418
> 
> 赞同：3
> 
> 时间：2009-01-29T16:41:07.987
> 
> 标签：php, frameworks, choice

我们正在开始一个新项目，我想知道我们应该使用哪个 PHP 框架以及是否应该使用框架。

我们决定选择 PHP 而不是 ASP.NET 的部分原因是我们不想陷入不灵活的范式（WebForms，一切自动但不那么灵活），但我相信 PHP 框架可以让我们在同样的情况下。

该应用程序现在将被开发，并且可能多年来不会积极维护。我们需要能够经久不衰的东西，因为下一次重大的重新开发不会在 10 年之前。我们需要一些标准且易于理解的东西。

我正在考虑 Zend Framework，也许 ADODB 作为数据库层，但我不确定。我还从列表中排除了 PEAR，因为它的依赖树很重。

最好将显示与逻辑分开，因为未来几年外观可能会发生变化。所以一个好的模板语言应该做。

你怎么看？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-29T16:47:19.877

根据最近的民意调查，Zend 框架似乎是目前最流行的 PHP 框架，比例为 2 比 1：

“[哪个 PHP 框架对未来有希望？](http://www.opensourceuniverse.com/component/poll/17-which-php-framework-holds-a-promise-for-the-future) ”

免责声明：我作为 Zend 项目 1.0 版本的负责人在 Zend 工作。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-29T23:57:12.397

Symfony 非常可靠并且非常可配置。

[http://www.symfony-project.org/](http://www.symfony-project.org/)

有点慢，但是当你开始理解它的“胆量”时，你真的可以把它拆掉。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-29T16:44:40.820

我同意你的观点，Zend 可能是要走的路。出于同样的原因，我最近一直在研究许多框架，Zend 似乎是支持最多、基础最强大的框架。

*   **StackOverflow**：[您会为新应用程序选择什么 PHP 框架，为什么？](https://stackoverflow.com/questions/2648/what-php-framework-would-you-choose-for-a-new-application-and-why)
*   [框架比较图](http://www.phpit.net/demo/framework%20comparison/chart.php)
*   [PHP 框架 - 哪一个最适合您？](http://www.thecredence.com/php-frameworks-which-one-is-most-suitable-for-you/)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-29T20:17:39.377

Zend Framework 对我来说工作得很好，虽然我只在大型项目中使用过它。我在更小、更简单的网站上使用过 Code Igniter，效果也很好。

至于数据库层，我一直只使用 ZF 提供的东西（尽管我所做的 99% 几乎完全是 MySQL）。ADODB 是安全的......也许也考虑 Doctrine？

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-29T17:02:04.200

看看[CodeIgniter](http://codeigniter.com/)。这是简单性、实用性和 MVC 框架开发之间的一个很好的折衷。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-29T20:18:27.737

在我尝试过的框架中，CakePHP 和 CodeIgniter，我更喜欢 CakePHP。CakePHP 与 Ruby on Rails 非常相似，开箱即用，您可以获得非常明智的 MVC 功能。

我工作的咨询公司已经成功地为非常大的请求重客户端部署了许多 CakePHP 应用程序，到非常小规模的轻量级内部网应用程序。

我们最近倾向于在 Flex 中为许多图形和动画密集型应用程序构建前端，并使用 AMF 插件和 CakePHP 为前端提供服务

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-07-09T13:17:16.843

我喜欢 PHP 面对 mvc

```
use mvc\Controller;
use mvc\View;
class PF2 implements Controller
{
    public function Controller() {
        return new View("view",array("name"=>"bora"));
    }
} 
```

# asp.net - 将 xml 数据从一台服务器发送到另一台服务器

> ID：492431
> 
> 赞同：0
> 
> 时间：2009-01-29T16:43:18.810
> 
> 标签：asp.net, xml

谁能告诉我在 asp.net 应用程序中将一些 xml 数据从一台服务器发送到另一台服务器的最佳方式。

基本上在某个应用程序中，我想触发将一些 xml 值发送到另一个接收 asp.net 应用程序，该应用程序将处理数据并将用户返回到发送站点。

如果有人有任何其他更简单的 javascript/url/html 类型的解决方案，我也很想听听。

* * *

情况是我需要将一些信息从发送站点发送到我们的服务器进行处理 - 理想情况下它需要是安全的。

这些值将来自购物车，例如价格、商家 ID 和电子邮件地址。

我们将向购物车所有者提供代码以添加到他们的网站，因此越简单越好。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-29T16:46:47.570

您可以在目标服务器上创建由客户端服务器使用的 Web 服务。只在目标服务器上创建一个接受 http POST 中的 xml 的页面可能会更简单。然后客户端服务器可以使用 HttpWebRequest 发送数据。

下面解释一下如何使用 HttpWebRequest：

[http://msdn.microsoft.com/en-us/library/debx8sh9.aspx](http://msdn.microsoft.com/en-us/library/debx8sh9.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-29T16:46:41.580

在您的接收 asp.net 应用程序上创建 Web 服务可能是您最好的选择。你也可以做一个简单的 Ajax 调用。这真的取决于你的具体情况。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-29T16:48:30.763

使用[XML-RPC](http://www.xmlrpc.com/)或 Web 服务。

# asp.net - 更新面板渲染表行错误

> ID：492436
> 
> 赞同：6
> 
> 时间：2009-01-29T16:45:01.740
> 
> 标签：asp.net, asp.net-ajax, updatepanel

当我的 asp.net AJAX 更新面板更新时，我遇到了一个问题，它在我的表格顶部而不是在它所属的位置呈现内容是我的代码：

```
<tr>
   <td>
   </td>
   <td>
      <asp:CheckBox ID="ddCheckbox" runat="server" Text="Checkbox"
           AutoPostBack="true" OnCheckedChanged="ddCheckboxChanged" />
   </td>
</tr>

    <asp:UpdatePanel ID="uxUpdatePanel" runat="server" RenderMode="Inline" UpdateMode="Conditional">
       <ContentTemplate>
          <tr>
             <td>
               Some Field:
             </td>
              <td>
                 <asp:TextBox ID="ddSomeField" runat="server" />
              </td>
            </tr>
          </ContentTemplate>
          <Triggers>
            <asp:AsyncPostBackTrigger ControlID="ddCheckbox" EventName="CheckedChanged" />
          </Triggers>
    </asp:UpdatePanel> 
```

在我的服务器端事件中，我只是启用/禁用文本框。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-29T20:48:35.207

1）创建自定义更新面板控件（从[SingingEels](http://www.singingeels.com/Articles/Making_Your_Own_Semantic_Controls.aspx)复制/粘贴）

2) 将此自定义更新面板控件与属性一起使用`RenderedElement="TBODY"`

3）嵌套你的表如下：

```
<TABLE>
  <TR>
    <TD>outside updatepanel</TD>
  </TR>
  <SingingEels:SemanticUpdatePanel ID="myUpdatePanel" runat="server" RenderedElement="TBODY">
    <ContentTemplate>
      <TR>
        <TD>inside updatepanel - 1th row</TD>
      </TR>
      <TR>
        <TD>inside updatepanel - 2nd row</TD>
      </TR>
      <TR>
        <TD>inside updatepanel - last row</TD>
      </TR>
    </ContentTemplate>
  </SingingEels:SemanticUpdatePanel>
  <TR>
    <TD>outside updatepanel</TD>
  </TR>
</TABLE> 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-29T16:55:46.880

我相信这是由于您嵌套更新面板的方式。如果您将更新面板更改为 td 的子项，而不是表的子项：

```
<tr>
  <td>
    Some Field:
  </td>
  <td>
    <asp:UpdatePanel ID="uxUpdatePanel" runat="server" RenderMode="Inline" UpdateMode="Conditional">
       <ContentTemplate>
         <asp:TextBox ID="ddSomeField" runat="server" />
       </ContentTemplate>
       <Triggers>
          <asp:AsyncPostBackTrigger ControlID="ddCheckbox" EventName="CheckedChanged" />
       </Triggers>
    </asp:UpdatePanel>
   </td>
 </tr> 
```

你应该都修好了。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-29T16:52:45.640

您是否完成了查看源代码以确认它实际上是在 HTML 本身的那个位置呈现它？如果表格格式错误，浏览器有时会在表格之外呈现标签。它可能看起来在 HTML 本身中被正确定义，但缺少结束标记等可能会导致它以这种方式呈现。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-29T16:55:45.540

当更新面板回发到服务器时，它会发回所有内容（包括视图状态）。为什么不只做一些简单的javascript？这会更有效率。

# python - 使用 Python split 将变量拼接在一起

> ID：492452
> 
> 赞同：1
> 
> 时间：2009-01-29T16:49:56.270
> 
> 标签：python, split

我有这个清单

```
["camilla_farnestam@hotmail.com : martin00", ""], 
```

我如何拆分，所以它只剩下：

```
camilla_farnestam@hotmail.com:martin00 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-29T16:51:45.110

你想拥有：`aList[0]`？

**编辑::**
哦，你有一个包含列表的元组！现在我明白了：

```
al = ["camilla_farnestam@hotmail.com : martin00", ""],
#type(al) == tuple
#len(al) == 1
aList = al[0]
#type(aList) == list
#len(aList) == 2
#Now you can type:
aList[0]
#and you get:
"camilla_farnestam@hotmail.com : martin00" 
```

`aList[0].replace(' : ', ':')`如果您想删除冒号前后的空格，您可以使用，以满足您的需要。我认为这里最令人困惑的是第一行结尾的昏迷。它创建一个新的元组，其中包含您的列表。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-29T17:03:32.217

```
al = ["camilla_farnestam@hotmail.com : martin00", ""],
print al[0][0].replace(" : ", ":") 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-29T16:56:37.597

最后的逗号表示该列表是元组的第一个成员，但是对于您的问题：

```
in_list = ["camilla_farnestam@hotmail.com : martin00", ""]
result = ''.join(in_list[0].split(' ')) 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-29T16:53:49.740

确切地。

```
    $蟒蛇
    Python 2.6（r26:66714，2008 年 12 月 4 日，11:34:15）
    [GCC 4.0.1 (Apple Inc. build 5488)] 在 darwin
    输入“帮助”、“版权”、“信用”或“许可”以获取更多信息。
    >>> al = ["camilla_farnestam@hotmail.com : martin00", ""]
    >>> 打印 al[0]
    camilla_farnestam@hotmail.com : martin00
    >>>

```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-29T16:54:02.767

Abgan，可能是正确的，但如果你仍然想要一个列表，即，

```
["camilla_farnestam@hotmail.com : martin00"] 
```

你想要：

```
the_list[:1] 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-29T16:54:16.760

列表可以通过索引访问或分割成更小的列表。
[http://diveintopython3.ep.io/native-datatypes.html](http://diveintopython3.ep.io/native-datatypes.html)

# c# - 从字节数组读取行（不将字节数组转换为字符串）

> ID：492454
> 
> 赞同：7
> 
> 时间：2009-01-29T16:50:55.317
> 
> 标签：c#, .net, bytearray, networkstream

我有一个从 NetworkStream 读取的字节数组。前两个字节表示随后的数据包的长度，然后将数据包读入该长度的字节数组中。我需要从 NetworkStream/byte 数组中读取的数据有一些字符串，即由换行符终止的可变长度数据，以及一些固定宽度的字段，如字节和长整数。所以，像这样：

```
// I would have delimited these for clarity but I didn't want
// to imply that the stream was delimited because it's not.
StringbyteStringStringbytebytebytelonglongbytelonglong 
```

我知道（并且有一些发言权）正在遇到的数据包的格式，我需要做的是为每个字符串值读取一个“行”，但为字节和 long 读取固定数量的字节。到目前为止，我提出的解决方案是使用`while`循环将字节读入临时字节数组，直到出现换行符。然后，将字节转换为字符串。这对我来说似乎很笨拙，但我没有看到另一种明显的方式。我意识到我可以使用`StreamReader.ReadLine()`，但这将涉及另一个流，而且我已经有一个`NetworkStream`. 但如果这是更好的解决方案，我会试一试。

我考虑的另一个选择是让我的后端团队为这些字符串值的长度写入一个或两个字节，以便我可以读取长度，然后根据指定的长度读取字符串。

所以，正如你所见，我有一些关于如何去做的选择，我希望你能就你认为最好的方法提供意见。这是我现在拥有的用于将整个数据包作为字符串读取的代码。接下来就是将数据包的各个字段打出来，根据数据包中的数据做实际需要做的编程工作，创建对象，更新UI等。

```
string line = null;  
while (stream.DataAvailable)
{  
    //Get the packet length;  
    UInt16 packetLength = 0;  
    header = new byte[2];  
    stream.Read(header, 0, 2);  
    // Need to reverse the header array for BitConverter class if architecture is little endian.  
    if (BitConverter.IsLittleEndian)
        Array.Reverse(header);  
    packetLength = BitConverter.ToUInt16(header,0);

    buffer = new byte[packetLength];
    stream.Read(buffer, 0, BitConverter.ToUInt16(header, 0));
    line = System.Text.ASCIIEncoding.ASCII.GetString(buffer);
    Console.WriteLine(line);
} 
```

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-01-29T16:54:44.450

我个人会

1.  将 Int16 放在字符串的开头，这样您就知道它们会持续多长时间，并且
2.  使用 IO.BinaryReader 类进行读取，它会将整数、字符串、字符等“读取”到变量中，例如 BinReader.ReadInt16() 将读取两个字节，返回它们代表的 int16，然后在溪流

希望这可以帮助。

PS 使用 ReadString 方法时要小心，它假定字符串前面带有自定义的 7 位整数，即它是由 BinaryWriter 类编写的。以下来自此[CodeGuru](http://www.codeguru.com/csharp/csharp/cs_data/streaming/article.php/c4223/)帖子

> BinaryWriter 类有两种写入字符串的方法：重载的 Write() 方法和 WriteString() 方法。前者根据类使用的编码将字符串写入字节流。WriteString() 方法也使用指定的编码，但它在字符串的字节流前面加上字符串的实际长度。这样的前缀字符串通过 BinaryReader.ReadString() 读回。
> 
> 关于长度值的有趣之处在于，它使用尽可能少的字节来保存这个大小，它被存储为一种称为 7 位编码整数的类型。如果长度适合 7 位，则使用单个字节，如果大于此长度，则设置第一个字节的高位，并通过将值移位 7 位来创建第二个字节。这会以连续的字节重复，直到有足够的字节来保存该值。此机制用于确保长度不会成为序列化字符串占用的大小的重要部分。BinaryWriter 和 BinaryReader 具有读取和写入 7 位编码整数的方法，但它们是受保护的，因此只有从这些类派生时才能使用它们。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-29T17:11:58.440

我会使用以长度为前缀的字符串。它会让你的生活变得更简单，这意味着你可以用换行符来表示字符串。不过，对你的代码有一些评论：

*   不要使用 Stream.DataAvailable。仅仅因为*现在*没有可用数据并不意味着您已经阅读了流的结尾。
*   除非您绝对确定您永远不需要 ASCII 以外的文本，否则不要使用 ASCIIEncoding。
*   不要假设 Stream.Read 会读取您要求它读取的所有数据。*始终*检查返回值。
*   BinaryReader 使这一切变得容易得多（包括以长度为前缀的字符串和一个 Read 循环，直到它读取你所要求的内容）
*   您在同一数据上调用 BitConverter.ToUInt16 两次。为什么？

# java - 如何使用 JFreeChart 固定自动范围避免负值

> ID：492457
> 
> 赞同：2
> 
> 时间：2009-01-29T16:51:59.603
> 
> 标签：java, swing, charts, graph, jfreechart

我有一个 JFreeChart 线图，它会为我的算法的每次迭代使用一个数据点动态更新。因为数据点的数量很快就会变得非常大，所以我在域轴上使用了[setFixedAutoRange(double)方法。](http://www.jfree.org/jfreechart/api/javadoc/org/jfree/chart/axis/ValueAxis.html#setFixedAutoRange(double))这将图表限制为显示最近的 n 次迭代（在我的情况下为 200 次）。

除了前 200 次迭代外，这很有效。问题是，在 200 次迭代之前，轴包含负值（例如，在 50 次迭代之后，范围是从 -150 到 50）。负迭代没有意义。我希望轴从零而不是负值开始。我怎样才能做到这一点？

我不介意轴最初是从 0 到 200（图表的右侧部分留空，直到绘图填满）还是从 0 到 1 开始并增长（这样绘图总是被拉伸横跨图表的整个宽度）。两者都可以接受，尽管我对前者略有偏好。

我尝试过的事情：

*   调用[setLowerBound](http://www.jfree.org/jfreechart/api/javadoc/org/jfree/chart/axis/ValueAxis.html#setLowerBound(double))不能很好地与 setFixedAutoRange 配合使用。
*   调用[setRangeType(RangeType.POSITIVE)](http://www.jfree.org/jfreechart/api/javadoc/org/jfree/chart/axis/NumberAxis.html#setRangeType(org.jfree.data.RangeType))似乎没有任何区别。

有任何想法吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2013-04-03T10:17:08.873

我遇到了同样的问题，我解决了：

```
axis.setAutoRangeMinimumSize(100); // Ensures graph always shows at least 0-100.
axis.setRangeType(RangeType.POSITIVE); 
```

我正在使用 JFreeChart v1.0.14。`setAutoRangeType`自从问题最初发布以来，也许他们已经修复了一个错误？

这种方法的一个缺点是零值不可见。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-29T21:09:08.447

看起来您正在寻找一种解决方案，该解决方案涉及配置 JFreeChart 来为您做这件事，而不是手动设置范围。

我对此无能为力....但是这里有一些其他丑陋的解决方案：P ....

你可以做这样的事情（对不起伪代码）：

```
while(producingData) {
   this.produceData();
   if(!allDataButton.isSelected()) {
      domainAxis.setRange((count < 200) ? 0 : count-200), count);
    } else {
      domainAxis.setRange(0, count);
    }
} 
```

如果我是 perl 编码器，我会这样写，只是为了让它更难阅读：P

```
while(producingData) {
   this.produceData();
   domainAxis.setRange(
       (((count < 200) || allDataButton.isSelected()) ? 0 : count-200), count);

} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-29T18:22:58.953

我现在有一个可行的解决方案，虽然我仍然对更好的方法感兴趣，

最初，我将域轴的范围设置为 0 到 200 的固定范围：

```
domainAxis.setRange(0, 200); 
```

在将数据添加到绘图的代码中，我检查它是否是正在添加的第 200 个值，如果是，我将范围切换到 200 的固定自动范围。虽然有点笨拙，但这是可行的（特别是因为我还必须检查用户是否选择了完全禁用固定窗口并让它显示所有值的选项）。

```
if (!allDataButton.isSelected() && count == 200)
{
    domainAxis.setAutoRange(true);
    domainAxis.setFixedAutoRange(200);
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-10-27T09:20:25.900

> 我尝试过的事情：
> 
> 调用 setLowerBound 不能很好地与 setFixedAutoRange 配合使用。调用 setRangeType(RangeType.POSITIVE) 似乎没有任何区别。有任何想法吗？

你试过了吗`axis.setRange(0, 200);`

# visual-studio-2008 - 在我的单元测试中包含数据

> ID：492463
> 
> 赞同：0
> 
> 时间：2009-01-29T16:53:36.637
> 
> 标签：visual-studio-2008, unit-testing

我有一些文件想在单元测试中使用，但我想让这些文件相对于包含单元测试的 dll 的位置，这可能吗？

换句话说，我已经包含了一个资源文件夹，其中包含一些文件供我的单元测试在测试中使用，我标记了文件“构建操作”=“内容”和“复制到输出直接”=“始终复制”但那不是不要做我认为它会做的事。我认为它会复制内容，但是当我的测试运行时，他们说文件不存在。

我宁愿不通过放置显式路径来解决这个问题，因为这些路径会因开发人员机器而异。

我还尝试将以下内容添加为 Pre-build 事件和 Post-build 事件，但这也没有解决我的问题。

```
xcopy "$(ProjectDir)Resources\*.*" "$(OutDir)Resources\*.*" /i /d /s /y
```

如果我将之前的事件设为构建前或构建后事件，我会看到数据已复制到我的 outdir 中，但它没有进入 TestResults 文件夹，该文件夹还必须复制 Resources 文件夹以使测试包含任何数据进行测试。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-29T16:56:45.600

unittest 运行器必须将您的 unittest 程序集复制到某个临时文件夹。与其复制这些资源文件，不如考虑将它们作为嵌入式资源包括在内，然后使用 Assembly.GetManifestResourceStream() 从程序集中加载它们。

# c++ - 重新加载内联 ostringstream 宏

> ID：492475
> 
> 赞同：1
> 
> 时间：2009-01-29T16:56:14.853
> 
> 标签：c++, visual-c++, macros, ostringstream

参考[C++格式宏/内联ostringstream](https://stackoverflow.com/questions/303562/c-format-macro-inline-ostringstream)

问题在于允许内联对象以创建 iostream 样式的字符串的宏。

答案是：

```
#define SSTR( x ) dynamic_cast< std::ostringstream & >( \
        ( std::ostringstream().seekp( 0, std::ios_base::cur ) << x ) \
    ).str() 
```

用法（例如）：

```
throw std::runtime_error(
        SSTR( "FooBar error: Value " << x << " exceeds " << y )
); 
```

这很好用 - 使用 GCC。它也在 Visual C++ 2005 下编译和运行。但是对于后者，宏的所有使用都会导致空字符串，我对为什么以及如何修复它感到非常傻眼......？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-29T20:19:04.757

不幸的是，我无法使用 MSVC 编译器进行测试。

在我过去使用微软工具的经验中，微软似乎将语言定义和标准视为一个粗略的指南。（我在项目上浪费了很多时间，却发现微软用 C99 等基本的东西打破了传统。）

鉴于这种令人遗憾的情况，我建议您尝试一系列琐碎的程序。像：

```
std::ostringstream() o;
o.seekp( 0, std::ios_base::cur ) << "foo";
cout << "Test1:  " << o << endl; 
```

也许：

```
std::ostringstream() o;
cout << "Test2:  " << typeid(o).name() << endl;
cout << "Test3:  " << typeid(o.seekp( 0, std::ios_base::cur )).name() << endl; 
```

试着看看事情在什么时候停止工作。然后从那里解决问题。

# asp.net - 我可以使用 Mono 和 mod_mono 托管 ASP.NET MVC 网站吗？

> ID：492476
> 
> 赞同：3
> 
> 时间：2009-01-29T16:56:29.063
> 
> 标签：asp.net, asp.net-mvc, linux, mono

我在某处听说 MVC 许可证阻止您在非微软技术上使用它，这将阻止我在单声道中开发和在 Linux 中托管。

这是真的？

有人用过单声道吗？

任何人都可以指出我的许可证方向吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-29T16:59:55.063

从法律上讲，您不应该这样做，至少在它仍处于 beta/ctp 阶段时。从技术上讲，它可能并不难开始。看到这个：
[ASP.NET MVC Preview 5 on Mono](https://stackoverflow.com/questions/202430/asp-net-mvc-preview-5-on-mono/203784)

# ruby - Ruby - Expect 和 Pty 的问题

> ID：492482
> 
> 赞同：4
> 
> 时间：2009-01-29T16:57:56.220
> 
> 标签：ruby, expect, pty

我正在尝试编写一个 Ruby 脚本，它将通过 ssh 连接到服务器，运行给定的命令，并从中获取输出。到目前为止，这是我所得到的，主要改编自[Programming Ruby](http://www.pragprog.com/titles/ruby/programming-ruby)书：

```
require 'pty'
require 'expect'

$expect_verbose = true
PTY.spawn("ssh root@x.y") do |reader, writer, pid|
  reader.expect(/root@x.y's password:.*/)
  writer.puts("password")
  reader.expect(/.*/)
  writer.puts("ls -l")
  reader.expect(/.*/)
  answer = reader.gets
  puts "Answer = #{answer}"
end 
```

不幸的是，我得到的只是这个：

```
Answer = .y's password: 
```

知道我做错了什么以及如何减轻这种情况吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-30T10:35:56.040

为此，我建议使用 net-ssh gem：： http `sudo gem install net-ssh`: [//net-ssh.rubyforge.org/ssh/v2/api/index.html](http://net-ssh.rubyforge.org/ssh/v2/api/index.html)

代码有点像这样：

```
require 'rubygems'
require 'net/ssh'

Net::SSH.start('your-server', 'username', :password => "password") do |ssh|
  puts ssh.exec!("ls -la")
end 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2011-08-26T09:10:40.497

查看[http://www.42klines.com/2010/08/14/what-to-expect-from-the-ruby-expect-library.html](http://www.42klines.com/2010/08/14/what-to-expect-from-the-ruby-expect-library.html) - 它有一些使用 PTY 的很好的例子，有和没有 Ruby 的期望。

我经常发现只使用 PTY 更容易，因为我可以查看我的“缓冲区”并弄清楚发生了什么。

# python - 在 Python 中管道标准输出时设置正确的编码

> ID：492483
> 
> 赞同：362
> 
> 时间：2009-01-29T16:57:59.700
> 
> 标签：python, encoding, terminal, stdout, python-2.x

当管道输出 Python 程序的输出时，Python 解释器对编码感到困惑，并将其设置为 None。这意味着这样的程序：

```
# -*- coding: utf-8 -*-
print u"åäö" 
```

正常运行时会正常工作，但会失败：

> UnicodeEncodeError：“ascii”编解码器无法在位置 0 编码字符 u'\xa0'：序数不在范围内（128）

在管道序列中使用时。

管道时完成这项工作的最佳方法是什么？我可以告诉它使用外壳/文件系统/正在使用的任何编码吗？

到目前为止，我看到的建议是直接修改您的 site.py，或使用此 hack 硬编码默认编码：

```
# -*- coding: utf-8 -*-
import sys
reload(sys)
sys.setdefaultencoding('utf-8')
print u"åäö" 
```

有没有更好的方法来使管道工作？

* * *

## 回答 #1

> 赞同：169
> 
> 时间：2009-01-29T18:03:18.150

您的代码在脚本中运行时有效，因为 Python 将输出编码为您的终端应用程序使用的任何编码。如果你是管道，你必须自己编码。

一条经验法则是：始终在内部使用 Unicode。解码您收到的内容，并对您发送的内容进行编码。

```
# -*- coding: utf-8 -*-
print u"åäö".encode('utf-8') 
```

另一个教学示例是一个 Python 程序，用于在 ISO-8859-1 和 UTF-8 之间进行转换，使介于两者之间的所有内容都大写。

```
import sys
for line in sys.stdin:
    # Decode what you receive:
    line = line.decode('iso8859-1')

    # Work with Unicode internally:
    line = line.upper()

    # Encode what you send:
    line = line.encode('utf-8')
    sys.stdout.write(line) 
```

设置系统默认编码不是一个好主意，因为您使用的某些模块和库可能依赖于它是 ASCII 的事实。不要这样做。

* * *

## 回答 #2

> 赞同：168
> 
> 时间：2009-07-23T02:05:58.510

首先，关于这个解决方案：

```
# -*- coding: utf-8 -*-
print u"åäö".encode('utf-8') 
```

每次都使用给定的编码显式打印是不切实际的。这将是重复且容易出错的。

更好的解决方案是**`sys.stdout`**在程序开始时进行更改，以使用选定的编码进行编码。这是我在[Python 上找到的一种解决方案：如何选择 sys.stdout.encoding？](http://drj11.wordpress.com/2007/05/14/python-how-is-sysstdoutencoding-chosen/)，特别是“toka”的评论：

```
import sys
import codecs
sys.stdout = codecs.getwriter('utf8')(sys.stdout) 
```

* * *

## 回答 #3

> 赞同：138
> 
> 时间：2010-10-26T20:30:35.287

您可能想尝试将环境变量“PYTHONIOENCODING”更改为“utf_8”。我已经写了[一页关于这个问题的磨难](http://daveagp.wordpress.com/2010/10/26/what-a-character/)。

Tl;博士博客文章：

```
import sys, locale, os
print(sys.stdout.encoding)
print(sys.stdout.isatty())
print(locale.getpreferredencoding())
print(sys.getfilesystemencoding())
print(os.environ["PYTHONIOENCODING"])
print(chr(246), chr(9786), chr(9787)) 
```

给你

```
utf_8
False
ANSI_X3.4-1968
ascii
utf_8
ö ☺ ☻ 
```

* * *

## 回答 #4

> 赞同：63
> 
> 时间：2011-06-15T18:40:18.733

```
export PYTHONIOENCODING=utf-8 
```

做这项工作，但不能在python本身上设置它......

我们可以做的是验证是否没有设置并告诉用户在调用脚本之前设置它：

```
if __name__ == '__main__':
    if (sys.stdout.encoding is None):
        print >> sys.stderr, "please set python env PYTHONIOENCODING=UTF-8, example: export PYTHONIOENCODING=UTF-8, when write to stdout."
        exit(1) 
```

更新以回复评论：问题只是在管道到 stdout 时存在。我在 Fedora 25 Python 2.7.13 中测试过

```
python --version
Python 2.7.13 
```

猫b.py

```
#!/usr/bin/env python
#-*- coding: utf-8 -*-
import sys

print sys.stdout.encoding 
```

运行./b.py

```
UTF-8 
```

运行./b.py | 较少的

```
None 
```

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2015-06-21T02:54:18.990

[上周](https://stackoverflow.com/questions/30857027/youtube-api-unicodeencodeerror-in-python-3-4)我遇到了类似的问题。在我的 IDE (PyCharm) 中很容易修复。

这是我的修复：

从 PyCharm 菜单栏开始：文件 -> 设置... -> 编辑器 -> 文件编码，然后设置：“IDE 编码”、“项目编码”和“属性文件的默认编码”全部为 UTF-8，她现在可以工作了像一个魅力。

希望这可以帮助！

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2015-04-13T10:24:12.263

Craig McQueen 答案的一个有争议的净化版本。

```
import sys, codecs
class EncodedOut:
    def __init__(self, enc):
        self.enc = enc
        self.stdout = sys.stdout
    def __enter__(self):
        if sys.stdout.encoding is None:
            w = codecs.getwriter(self.enc)
            sys.stdout = w(sys.stdout)
    def __exit__(self, exc_ty, exc_val, tb):
        sys.stdout = self.stdout 
```

用法：

```
with EncodedOut('utf-8'):
    print u'ÅÄÖåäö' 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2012-03-15T09:59:11.367

我可以通过调用来“自动化”它：

```
def __fix_io_encoding(last_resort_default='UTF-8'):
  import sys
  if [x for x in (sys.stdin,sys.stdout,sys.stderr) if x.encoding is None] :
      import os
      defEnc = None
      if defEnc is None :
        try:
          import locale
          defEnc = locale.getpreferredencoding()
        except: pass
      if defEnc is None :
        try: defEnc = sys.getfilesystemencoding()
        except: pass
      if defEnc is None :
        try: defEnc = sys.stdin.encoding
        except: pass
      if defEnc is None :
        defEnc = last_resort_default
      os.environ['PYTHONIOENCODING'] = os.environ.get("PYTHONIOENCODING",defEnc)
      os.execvpe(sys.argv[0],sys.argv,os.environ)
__fix_io_encoding() ; del __fix_io_encoding 
```

是的，如果这个“setenv”失败，这里可能会出现无限循环。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2014-03-07T20:44:05.803

我只是想在这里提一些我必须花很长时间试验的东西，然后我才最终意识到发生了什么。这对这里的每个人来说可能都很明显，以至于他们都懒得提它。但如果他们有的话，它会帮助我，所以按照这个原则......！

注意：我正在使用[Jython](http://en.wikipedia.org/wiki/Jython)，v 2.7，所以这可能不适用于[CPython](http://en.wikipedia.org/wiki/CPython) ...

NB2：我的 .py 文件的前两行是：

```
# -*- coding: utf-8 -*-
from __future__ import print_function 
```

“%”（又名“插值运算符”）字符串构造机制也会导致其他问题......如果“环境”的默认编码是 ASCII 并且您尝试执行类似的操作

```
print( "bonjour, %s" % "fréd" )  # Call this "print A" 
```

您在 Eclipse 中运行不会有任何困难...在 Windows CLI（DOS 窗口）中，您会发现编码是[代码页 850](http://en.wikipedia.org/wiki/Code_page_850)（我的 Windows 7 操作系统）或类似的东西，它至少可以处理欧洲重音字符，所以它会工作的。

```
print( u"bonjour, %s" % "fréd" ) # Call this "print B" 
```

也将工作。

如果，OTOH，您从 CLI 定向到文件，则标准输出编码将为无，默认为 ASCII（无论如何在我的操作系统上），它将无法处理上述任何一种打印...（可怕的编码错误）。

那么你可能会考虑通过使用重定向你的标准输出

```
sys.stdout = codecs.getwriter('utf8')(sys.stdout) 
```

并尝试在 CLI 管道中运行到文件...很奇怪，上面的 print A 可以工作...但是上面的 print B 会抛出编码错误！但是，以下将正常工作：

```
print( u"bonjour, " + "fréd" ) # Call this "print C" 
```

我得出的结论（暂时）是，如果将使用“u”前缀指定为[Unicode](http://en.wikipedia.org/wiki/Unicode)字符串的字符串提交给 %-handling 机制，它似乎涉及使用默认环境编码，**而不管您是否已将标准输出设置为重定向！**

人们如何处理这是一个选择问题。我会欢迎 Unicode 专家说出为什么会发生这种情况，我是否在某些方面弄错了，对此的首选解决方案是什么，它是否也适用于[CPython](http://en.wikipedia.org/wiki/CPython)，是否发生在 Python 3 中等等，等等。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2018-02-22T12:55:56.397

我在遗留应用程序中遇到了这个问题，并且很难确定打印的位置。我帮助自己解决了这个问题：

```
# encoding_utf8.py
import codecs
import builtins

def print_utf8(text, **kwargs):
    print(str(text).encode('utf-8'), **kwargs)

def print_utf8(fn):
    def print_fn(*args, **kwargs):
        return fn(str(*args).encode('utf-8'), **kwargs)
    return print_fn

builtins.print = print_utf8(print) 
```

在我的脚本之上，test.py：

```
import encoding_utf8
string = 'Axwell Λ Ingrosso'
print(string) 
```

请注意，这会将所有对 print 的调用更改为使用编码，因此您的控制台将打印以下内容：

```
$ python test.py
b'Axwell \xce\x9b Ingrosso' 
```

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2019-11-15T12:50:30.180

在 Windows 上，我在从编辑器（如 Sublime Text）运行 Python 代码时经常遇到这个问题，但如果从命令行运行它则不会*。*

在这种情况下，请检查编辑器的参数。在 SublimeText 的情况下，这`Python.sublime-build`解决了它：

```
{
  "cmd": ["python", "-u", "$file"],
  "file_regex": "^[ ]*File \"(...*?)\", line ([0-9]*)",
  "selector": "source.python",
  "encoding": "utf8",
  "env": {"PYTHONIOENCODING": "utf-8", "LANG": "en_US.UTF-8"}
} 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2021-10-11T11:48:02.327

从 Python 3.7 开始，我们可以使用 Python UTF-8 模式，通过使用命令行选项 -X utf8：

```
 python -X utf8 testzh.py 
```

脚本 testzh.py 包含

```
print("Content-type: text/html; charset=UTF-8\n") 
print("地球你好!") 
```

要将 Windows 10 Internet 服务 IIS 设置为 CGI 脚本处理程序，

我们将 Executable 设置为：

```
"C:\Program Files\Python39\python.exe" -X utf8 %s 
```

[![在此处输入图像描述](https://i.stack.imgur.com/9ezXd.png)](https://i.stack.imgur.com/9ezXd.png)

这适用于浏览器 Microsoft.Edge 上预期的中文表意文字，如下图所示：否则，会发生错误。

[![在此处输入图像描述](https://i.stack.imgur.com/dZrFs.png)](https://i.stack.imgur.com/dZrFs.png)

请参阅[https://docs.python.org/3/library/os.html#utf8-mode](https://docs.python.org/3/library/os.html#utf8-mode)

# sharepoint - 重命名目录时的stsadm差异备份？

> ID：492484
> 
> 赞同：1
> 
> 时间：2009-01-29T16:58:32.053
> 
> 标签：sharepoint, sharepoint-2007, backup, stsadm

目前，我每天都在 SharePoint 中运行完整备份。进一步复制的自动化过程将完整备份目录重命名为 backup_((date in yyyymmdd))_full。我想修改为每日增量/每周完整计划，但差异似乎无法找到最后一次完整备份。我正在考虑进一步扩展批处理作业以记录 SharePoint 名称并在差异执行之前进行快速重命名，但有人有更简单的方法吗？谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-29T17:16:40.410

差异不起作用的原因是 SharePoint 找不到 spbrtoc.xml 文件。此文件记录备份的历史记录，并在您执行备份时更新。重命名备份目录会阻止 SharePoint 找到此文件，因此它无法确定如何执行差异。

我强烈建议在 Web 上搜索 SharePoint 备份脚本，因为许多其他人已经走上了这条路，您应该能够适应他们所做的事情。以下是我找到的一些链接：

*   [使用 Powershell 进行 SharePoint 备份](http://www.codeplex.com/spbackup)
*   [使用 VBScript 进行 SharePoint 备份](http://www.blogaboutsharepoint.com/?p=268)

[备份和恢复场](http://www.blogaboutsharepoint.com/?p=268)下的 Technet 文章也可能会有所帮助。祝你好运！

# .net - 我应该使用哪种 .NET 数据结构？

> ID：492500
> 
> 赞同：3
> 
> 时间：2009-01-29T17:02:46.773
> 
> 标签：.net, vb.net, data-structures

以下是我的对象需要公开的数据结构（数据并未真正存储在 XML 中，它只是说明布局的最简单方法）：

```
<Department id="Accounting">
  <Employee id="1234">Joe Jones</Employee>
  <Employee id="5678">Steve Smith</Employee>
</Department>
<Department id="Marketing">
  <Employee id="3223">Kate Connors</Employee>
  <Employee id="3218">Noble Washington</Employee>
  <Employee id="3233">James Thomas</Employee>
</Department> 
```

当我反序列化数据时，我应该如何根据对象的属性公开它？如果只是 Department 和 EmployeeID，我想我会使用字典。但我也需要关联 EmployeeName。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-29T17:08:53.093

```
Class Department
   Public Id As Integer
   Public Employees As List(Of Employee)
End Class

Class Employee
   Public Id As Integer
   Public Name As String
End Class 
```

类似的东西（不记得我的VB语法）。请务必使用属性与公共成员...

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-01-29T17:07:02.100

一个 Department 类（带有 ID 和 Name），其中包含 Employee（以及 ID 和 Name）对象的集合。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-29T17:39:14.627

```
Public Class Employee

    Private _id As Integer
    Public Property EmployeeID() As Integer
        Get
            Return _id
        End Get
        Set(ByVal value As Integer)
            _id = value
        End Set
    End Property

    Private _name As String
    Public Property Name() As String
        Get
            Return _name
        End Get
        Set(ByVal value As String)
            _name = value
        End Set
    End Property

End Class

Public Class Department

    Private _department As String
    Public Property Department() As String
        Get
            Return _department
        End Get
        Set(ByVal value As String)
            _department = value
        End Set
    End Property

    Private _employees As List(Of Employee)
    Public Property Employees() As List(Of Employee)
        Get
            Return _employees
        End Get
        Set(ByVal value As List(Of Employee))
            _employees = value
        End Set
    End Property

End Class 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-29T17:06:15.613

*   部门对象
*   员工对象
*   一个employeeCollection 对象。（可选，您可以只使用 List(of Employee)）

将它们全部标记为可序列化，然后您可以将它们（反）序列化为您喜欢的任何格式。

# asp.net - 可以使用 HTTPModules 保护 Classic ASP 应用程序吗？

> ID：492507
> 
> 赞同：1
> 
> 时间：2009-01-29T17:05:02.930
> 
> 标签：asp.net, asp-classic, single-sign-on, httpmodule, isapi

我有一个经典的 ASP 应用程序，目前使用在 IIS 6 上运行的 ASP.NET 表单身份验证进行保护，问题是我们的目的是要求此应用程序使用 Entrust TruePass 实现单点登录安全模型，我相信它使用客户端证书。这可以使用 ASP.NET Http 模块实现还是我必须编写一个 ISAPI 过滤器？还有其他选择吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-29T17:49:25.837

为了触发 HttpModule，您必须让 IIS 将请求发送到 aspnet_isapi.dll，然后再发送到常规的 asp.dll。在大多数情况下，如果 .net 中有一个端点，它不会将请求传递回 IIS，但在 IIS6 中，您可以为通配符定义一个处理程序，请参阅这篇关于使用表单身份验证保护非 .net 内容的文章[https://web.archive .org/web/20111127051259/http://www.15seconds.com/issue/070104.htm](https://web.archive.org/web/20111127051259/http://www.15seconds.com/issue/070104.htm)

所以你要做的是创建你的模块，在 web.config 中注册并使用它来进行身份验证，只要端点不匹配任何 .net 将处理的东西，它就应该让它回到 IIS 去到 asp.dll

[以上链接来自 2011 年 11 月的 Internet Archive。文章之前位于[http://www.15seconds.com/issue/070104.htm](http://www.15seconds.com/issue/070104.htm) ]

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-29T17:21:53.630

首先让我声明，我对 HTTPModules 了解不多，但我认为您可以编写自己的 IHttpModule 实现来处理 TruePass。有关详细信息，请参阅此链接：[MSDN HttpModules](http://msdn.microsoft.com/en-us/library/zec9k340(VS.71).aspx)。

根据我的经验，在经典 ASP 和 .NET 之间来回切换的最大麻烦是处理 Session 信息。.NET 无法读取存储在经典 ASP 会话变量中的内容，反之亦然。但是由于您的 FormsAuthentication 很可能使用 cookie，因此您现在可以来回切换。

我不确定其他选择。如果您的业务要求是保留经典的 asp 代码并使用 TruePass，那么我认为您可以使其工作。

希望有帮助。

# php - 如何在数据库中存储轻量级格式（Textile、Markdown）？

> ID：492515
> 
> 赞同：19
> 
> 时间：2009-01-29T17:07:07.153
> 
> 标签：php, database, markdown, markup, textile

我将在我正在从事的项目中实现一种轻量级格式化语言（可能是 Textile，可能是 Markdown），我想知道如何最好地将它存储在数据库中。

如果用户能够编辑他们发布的内容，对我来说存储原始的、未转换的标记是有意义的，这样用户下次就不必编辑 HTML。但由于内容将比编辑的内容更多地显示，因此存储内容的转换副本也是有意义的，这样就不必在每次页面查看时都通过 Textile 发送原始内容。

那么，将原始内容和转换后的内容并排存储在数据库中是一种常见的做法吗？有没有更好的办法？

谢谢！

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2009-01-29T17:12:03.900

商店降价：

*   每次观看 = 转化
*   每次编辑 = 不处理

存储html

*   每个视图 = 不处理
*   每次编辑 = 转换为降价并返回

存储两者

*   每个视图 = 不处理
*   每次编辑 = 编辑后转换为 html

您必须权衡处理成本与存储成本。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-29T17:09:49.317

您应该明确地存储原始 Textile/Markdown 标记并使用标准 HTTP 缓存内容（Last-modified、Expires-At、ETag）来缓存渲染页面或仅缓存处理标记的结果。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-29T17:10:45.587

我目前正在将 Markdown 与 PHP 一起使用。我将降价源存储在数据库中，并根据要求显示转换后的版本。我没有性能问题，并且对此设置非常满意。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-29T17:11:02.827

我所看到的确实是将编译后的 HTML 存储在数据库中的单独行中。只需有一行“content”和另一行“content_html”，并将编译后的 HTML 保存在“content_html”行中。

（您肯定有某种可以覆盖的保存方法来执行此操作吗？）

# linker - cppunit 链接错误

> ID：492518
> 
> 赞同：0
> 
> 时间：2009-01-29T17:08:14.140
> 
> 标签：linker, cppunit

再次编译我的测试套件时，我收到以下链接错误：

```
error LNK2019: unresolved external symbol "public: virtual __thiscall CppUnit::TextTestRunner::~TextTestRunner(void)" (??1TextTestRunner@CppUnit@@UAE@XZ) referenced in function _wmain 
```

我不明白这个问题，因为提供的示例链接很好。

我正在使用宏来注册我的测试：

```
 CPPUNIT_TEST_SUITE_REGISTRATION
 CPPUNIT_TEST_SUITE
 etc 
```

我的测试类派生自 CPPUNIT_NS::TestFixture

这是“主要”代码：

```
int _tmain(int argc, _TCHAR* argv[])
{
     // Get the top level suite from the registry
     CPPUNIT_NS::Test *suite = CPPUNIT_NS::TestFactoryRegistry::getRegistry().makeTest();

     // Adds the test to the list of test to run
     CPPUNIT_NS::TextUi::TestRunner runner;
     runner.addTest( suite );

     // Change the default outputter to a compiler error format outputter
     runner.setOutputter( new CPPUNIT_NS::CompilerOutputter( &runner.result(),
                                                      CPPUNIT_NS::stdCOut() ) );
     // Run the test.
     bool wasSucessful = runner.run();

     // Return error code 1 if the one of test failed.
    return wasSucessful ? 0 : 1;
} 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-29T18:12:51.890

您确定已将适当的库添加到项目的链接器 -> 输入 -> 附加依赖项文本框中吗？我相信它应该是（对于 Release / Unicode 版本）：

> testrunneru.lib cppunit.lib

您还需要确保链接器可以通过将适当的目录名称添加到 Linker -> General -> Additional Library Directories 来找到该库。

一个真正的延伸，但它曾经发生在我身上，我需要重建 cppunit。我认为我的编译器已升级或修补。

如果您可以发布一个非常简短但完整的源文件来重现该问题，这也可能会有所帮助。我认为您只是在这里缺少包含语句吗？

# python - 函数调用超时

> ID：492519
> 
> 赞同：411
> 
> 时间：2009-01-29T17:08:29.163
> 
> 标签：python, multithreading, timeout, python-multithreading

我在 Python 中调用一个函数，我知道它可能会停止并迫使我重新启动脚本。

如何调用该函数或将其包装在什么中，以便如果它花费超过 5 秒的时间，脚本将取消它并执行其他操作？

* * *

## 回答 #1

> 赞同：290
> 
> 时间：2009-01-30T02:14:04.117

如果您在 UNIX 上运行，则可以使用[信号包：](http://docs.python.org/library/signal.html)

```
In [1]: import signal

# Register an handler for the timeout
In [2]: def handler(signum, frame):
   ...:     print("Forever is over!")
   ...:     raise Exception("end of time")
   ...: 

# This function *may* run for an indetermined time...
In [3]: def loop_forever():
   ...:     import time
   ...:     while 1:
   ...:         print("sec")
   ...:         time.sleep(1)
   ...:         
   ...:         

# Register the signal function handler
In [4]: signal.signal(signal.SIGALRM, handler)
Out[4]: 0

# Define a timeout for your function
In [5]: signal.alarm(10)
Out[5]: 0

In [6]: try:
   ...:     loop_forever()
   ...: except Exception, exc: 
   ...:     print(exc)
   ....: 
sec
sec
sec
sec
sec
sec
sec
sec
Forever is over!
end of time

# Cancel the timer if the function returned before timeout
# (ok, mine won't but yours maybe will :)
In [7]: signal.alarm(0)
Out[7]: 0 
```

调用后 10 秒`signal.alarm(10)`，处理程序被调用。这会引发一个异常，您可以从常规 Python 代码中截取该异常。

这个模块不能很好地使用线程（但是，谁呢？）

**请注意，**由于我们在超时发生时引发异常，它最终可能会在函数内部被捕获并忽略，例如一个这样的函数：

```
def loop_forever():
    while 1:
        print('sec')
        try:
            time.sleep(10)
        except:
            continue 
```

* * *

## 回答 #2

> 赞同：200
> 
> 时间：2013-02-17T18:00:10.430

你可以用它`multiprocessing.Process`来做到这一点。

**代码**

```
import multiprocessing
import time

# bar
def bar():
    for i in range(100):
        print "Tick"
        time.sleep(1)

if __name__ == '__main__':
    # Start bar as a process
    p = multiprocessing.Process(target=bar)
    p.start()

    # Wait for 10 seconds or until process finishes
    p.join(10)

    # If thread is still active
    if p.is_alive():
        print "running... let's kill it..."

        # Terminate - may not work if process is stuck for good
        p.terminate()
        # OR Kill - will work for sure, no chance for process to finish nicely however
        # p.kill()

        p.join() 
```

* * *

## 回答 #3

> 赞同：99
> 
> 时间：2015-07-28T03:43:52.750

> # 如何调用该函数或将其包装在什么中，以便如果它花费的时间超过 5 秒，脚本会取消它？

我发布了一个[要点](https://gist.github.com/aaronchall/6331661fe0185c30a0b4)，用一个装饰器和一个`threading.Timer`. 这是一个故障。

## 导入和设置以实现兼容性

它使用 Python 2 和 3 进行了测试。它也应该在 Unix/Linux 和 Windows 下工作。

首先是进口。无论 Python 版本如何，这些都试图保持代码一致：

```
from __future__ import print_function
import sys
import threading
from time import sleep
try:
    import thread
except ImportError:
    import _thread as thread 
```

使用与版本无关的代码：

```
try:
    range, _print = xrange, print
    def print(*args, **kwargs): 
        flush = kwargs.pop('flush', False)
        _print(*args, **kwargs)
        if flush:
            kwargs.get('file', sys.stdout).flush()            
except NameError:
    pass 
```

现在我们已经从标准库中导入了我们的功能。

## `exit_after`装饰师

接下来我们需要一个函数来终止`main()`子线程：

```
def quit_function(fn_name):
    # print to stderr, unbuffered in Python 2.
    print('{0} took too long'.format(fn_name), file=sys.stderr)
    sys.stderr.flush() # Python 3 stderr is likely buffered.
    thread.interrupt_main() # raises KeyboardInterrupt 
```

这是装饰器本身：

```
def exit_after(s):
    '''
    use as decorator to exit process if 
    function takes longer than s seconds
    '''
    def outer(fn):
        def inner(*args, **kwargs):
            timer = threading.Timer(s, quit_function, args=[fn.__name__])
            timer.start()
            try:
                result = fn(*args, **kwargs)
            finally:
                timer.cancel()
            return result
        return inner
    return outer 
```

## 用法

这是直接回答您关于 5 秒后退出的问题的用法！：

```
@exit_after(5)
def countdown(n):
    print('countdown started', flush=True)
    for i in range(n, -1, -1):
        print(i, end=', ', flush=True)
        sleep(1)
    print('countdown finished') 
```

演示：

```
>>> countdown(3)
countdown started
3, 2, 1, 0, countdown finished
>>> countdown(10)
countdown started
10, 9, 8, 7, 6, countdown took too long
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
  File "<stdin>", line 11, in inner
  File "<stdin>", line 6, in countdown
KeyboardInterrupt 
```

第二个函数调用不会完成，而是进程应该退出并回溯！

## `KeyboardInterrupt`并不总是停止睡眠线程

请注意，在 Windows 上的 Python 2 上，键盘中断并不总是会中断睡眠，例如：

```
@exit_after(1)
def sleep10():
    sleep(10)
    print('slept 10 seconds')

>>> sleep10()
sleep10 took too long         # Note that it hangs here about 9 more seconds
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
  File "<stdin>", line 11, in inner
  File "<stdin>", line 3, in sleep10
KeyboardInterrupt 
```

除非明确检查，否则它也不太可能中断在扩展中运行的代码`PyErr_CheckSignals()`，请参阅 [Cython、Python 和 KeyboardInterrupt 被忽略](https://stackoverflow.com/q/16769870/541136)

在任何情况下，我都会避免让线程休眠超过一秒 - 这是处理器时间的一个永恒。

> 如何调用该函数或将其包装在什么中，以便如果它花费超过 5 秒的时间，脚本将取消它**并执行其他操作？**

要捕获它并执行其他操作，您可以捕获 KeyboardInterrupt。

```
>>> try:
...     countdown(10)
... except KeyboardInterrupt:
...     print('do something else')
... 
countdown started
10, 9, 8, 7, 6, countdown took too long
do something else 
```

* * *

## 回答 #4

> 赞同：61
> 
> 时间：2012-12-11T13:41:31.363

我有一个不同的建议，它是一个纯函数（与线程建议具有相同的 API）并且似乎工作正常（基于这个线程的建议）

```
def timeout(func, args=(), kwargs={}, timeout_duration=1, default=None):
    import signal

    class TimeoutError(Exception):
        pass

    def handler(signum, frame):
        raise TimeoutError()

    # set the timeout handler
    signal.signal(signal.SIGALRM, handler) 
    signal.alarm(timeout_duration)
    try:
        result = func(*args, **kwargs)
    except TimeoutError as exc:
        result = default
    finally:
        signal.alarm(0)

    return result 
```

* * *

## 回答 #5

> 赞同：36
> 
> 时间：2016-02-01T20:02:32.617

在单元测试中搜索超时调用时，我遇到了这个线程。我在答案或 3rd 方包中没有找到任何简单的东西，所以我在下面编写了装饰器，您可以直接放入代码中：

```
import multiprocessing.pool
import functools

def timeout(max_timeout):
    """Timeout decorator, parameter in seconds."""
    def timeout_decorator(item):
        """Wrap the original function."""
        @functools.wraps(item)
        def func_wrapper(*args, **kwargs):
            """Closure for function."""
            pool = multiprocessing.pool.ThreadPool(processes=1)
            async_result = pool.apply_async(item, args, kwargs)
            # raises a TimeoutError if execution exceeds max_timeout
            return async_result.get(max_timeout)
        return func_wrapper
    return timeout_decorator 
```

然后就像这样简单地使测试或您喜欢的任何功能超时：

```
@timeout(5.0)  # if execution takes longer than 5 seconds, raise a TimeoutError
def test_base_regression(self):
    ... 
```

* * *

## 回答 #6

> 赞同：33
> 
> 时间：2015-02-15T12:43:32.453

在 pypi 上找到的`stopit`包似乎可以很好地处理超时。

我喜欢`@stopit.threading_timeoutable`装饰器，它`timeout`为被装饰的函数添加了一个参数，它可以满足你的期望，它会停止函数。

在 pypi 上查看：[https ://pypi.python.org/pypi/stopit](https://pypi.python.org/pypi/stopit)

* * *

## 回答 #7

> 赞同：19
> 
> 时间：2017-05-03T06:28:40.240

有很多建议，但没有一个使用 concurrent.futures，我认为这是处理这个问题的最清晰的方法。

```
from concurrent.futures import ProcessPoolExecutor

# Warning: this does not terminate function if timeout
def timeout_five(fnc, *args, **kwargs):
    with ProcessPoolExecutor() as p:
        f = p.submit(fnc, *args, **kwargs)
        return f.result(timeout=5) 
```

超级简单的阅读和维护。

我们创建一个池，提交一个进程，然后等待最多 5 秒，然后引发 TimeoutError，您可以根据需要捕获和处理该错误。

原生于 python 3.2+ 并向后移植到 2.7（pip install futures）。

在线程和进程之间切换就像替换`ProcessPoolExecutor`为`ThreadPoolExecutor`.

如果您想在超时时终止进程，我建议您查看[Pebble](http://pythonhosted.org/Pebble/)。

* * *

## 回答 #8

> 赞同：17
> 
> 时间：2018-08-08T12:06:25.813

伟大的，易于使用和可靠的*PyPi*项目**超时装饰器**（[https://pypi.org/project/timeout-decorator/](https://pypi.org/project/timeout-decorator/)）

**安装**：

```
pip install timeout-decorator 
```

**用法**：

```
import time
import timeout_decorator

@timeout_decorator.timeout(5)
def mytest():
    print "Start"
    for i in range(1,10):
        time.sleep(1)
        print "%d seconds have passed" % i

if __name__ == '__main__':
    mytest() 
```

* * *

## 回答 #9

> 赞同：16
> 
> 时间：2019-04-23T18:02:43.637

我是wrapt_timeout_decorator的作者

乍一看，这里介绍的大多数解决方案在 Linux 下都可以正常工作——因为我们有 fork() 和 signals()——但在 Windows 上看起来有点不同。当涉及到 Linux 上的子线程时，你不能再使用信号了。

为了在 Windows 下生成一个进程，它需要是可挑选的——许多装饰函数或类方法不是。

所以你需要使用更好的pickler，比如dill和multiprocess（不是pickle和multiprocessing）——这就是为什么你不能使用ProcessPoolExecutor（或者只有有限的功能）。

对于超时本身 - 您需要定义超时的含义 - 因为在 Windows 上生成进程需要相当长的时间（并且无法确定）。这对于短暂的超时可能会很棘手。让我们假设，产生这个过程大约需要 0.5 秒（很容易！！！）。如果你给 0.2 秒的超时应该发生什么？函数是否应该在 0.5 + 0.2 秒后超时（所以让方法运行 0.2 秒）？或者被调用的进程是否应该在 0.2 秒后超时（在这种情况下，装饰函数将始终超时，因为在那个时候它甚至没有产生）？

嵌套装饰器也可能很讨厌，您不能在子线程中使用信号。如果你想创建一个真正通用的、跨平台的装饰器，所有这些都需要考虑（和测试）。

其他问题是将异常传递回调用者，以及日志记录问题（如果在修饰函数中使用 - 不支持记录到另一个进程中的文件）

我试图涵盖所有边缘情况，您可能会查看包 wrapt_timeout_decorator，或者至少测试您自己的解决方案，灵感来自那里使用的单元测试。

@Alexis Eggermont - 不幸的是我没有足够的评论点 - 也许其他人可以通知你 - 我想我解决了你的导入问题。

* * *

## 回答 #10

> 赞同：16
> 
> 时间：2020-08-23T12:09:09.363

在@piro 的基础上构建和增强答案，您可以构建一个上下文管理器。这允许非常易读的代码在成功运行后禁用警报信号（设置 signal.alarm(0)）

```
from contextlib import contextmanager
import signal
import time

@contextmanager
def timeout(duration):
    def timeout_handler(signum, frame):
        raise Exception(f'block timedout after {duration} seconds')
    signal.signal(signal.SIGALRM, timeout_handler)
    signal.alarm(duration)
    yield
    signal.alarm(0)

def sleeper(duration):
    time.sleep(duration)
    print('finished') 
```

示例用法：

```
In [19]: with timeout(2):
    ...:     sleeper(1)
    ...:     
finished

In [20]: with timeout(2):
    ...:     sleeper(3)
    ...:         
---------------------------------------------------------------------------
Exception                                 Traceback (most recent call last)
<ipython-input-20-66c78858116f> in <module>()
      1 with timeout(2):
----> 2     sleeper(3)
      3 

<ipython-input-7-a75b966bf7ac> in sleeper(t)
      1 def sleeper(t):
----> 2     time.sleep(t)
      3     print('finished')
      4 

<ipython-input-18-533b9e684466> in timeout_handler(signum, frame)
      2 def timeout(duration):
      3     def timeout_handler(signum, frame):
----> 4         raise Exception(f'block timedout after {duration} seconds')
      5     signal.signal(signal.SIGALRM, timeout_handler)
      6     signal.alarm(duration)

Exception: block timedout after 2 seconds 
```

* * *

## 回答 #11

> 赞同：8
> 
> 时间：2018-08-29T22:28:56.207

`timeout-decorator`不能在windows系统上工作，因为windows支持`signal`不好。

如果你在 windows 系统中使用 timeout-decorator 你会得到以下

```
AttributeError: module 'signal' has no attribute 'SIGALRM' 
```

有些人建议使用`use_signals=False`，但对我没有用。

作者@bitranox 创建了以下包：

```
pip install https://github.com/bitranox/wrapt-timeout-decorator/archive/master.zip 
```

代码示例：

```
import time
from wrapt_timeout_decorator import *

@timeout(5)
def mytest(message):
    print(message)
    for i in range(1,10):
        time.sleep(1)
        print('{} seconds have passed'.format(i))

def main():
    mytest('starting')

if __name__ == '__main__':
    main() 
```

给出以下异常：

```
TimeoutError: Function mytest timed out after 5 seconds 
```

* * *

## 回答 #12

> 赞同：5
> 
> 时间：2020-08-10T22:57:55.300

# 强调

*   **Raises`TimeoutError`**使用异常来提醒超时 - 可以轻松修改
*   **跨平台**：Windows & Mac OS X
*   **兼容性**：Python 3.6+（我也在 python 2.7 上进行了测试，它可以通过小的语法调整）

有关并行映射的完整解释和扩展，请参见此处[https://flipdazed.github.io/blog/quant%20dev/parallel-functions-with-timeouts](https://flipdazed.github.io/blog/quant%20dev/parallel-functions-with-timeouts)

# 最小的例子

```
>>> @killer_call(timeout=4)
... def bar(x):
...        import time
...        time.sleep(x)
...        return x
>>> bar(10)
Traceback (most recent call last):
  ...
__main__.TimeoutError: function 'bar' timed out after 4s 
```

正如预期的那样

```
>>> bar(2)
2 
```

# 完整代码

```
import multiprocessing as mp
import multiprocessing.queues as mpq
import functools
import dill

from typing import Tuple, Callable, Dict, Optional, Iterable, List, Any

class TimeoutError(Exception):

    def __init__(self, func: Callable, timeout: int):
        self.t = timeout
        self.fname = func.__name__

    def __str__(self):
            return f"function '{self.fname}' timed out after {self.t}s"

def _lemmiwinks(func: Callable, args: Tuple, kwargs: Dict[str, Any], q: mp.Queue):
    """lemmiwinks crawls into the unknown"""
    q.put(dill.loads(func)(*args, **kwargs))

def killer_call(func: Callable = None, timeout: int = 10) -> Callable:
    """
    Single function call with a timeout

    Args:
        func: the function
        timeout: The timeout in seconds
    """

    if not isinstance(timeout, int):
        raise ValueError(f'timeout needs to be an int. Got: {timeout}')

    if func is None:
        return functools.partial(killer_call, timeout=timeout)

    @functools.wraps(killer_call)
    def _inners(*args, **kwargs) -> Any:
        q_worker = mp.Queue()
        proc = mp.Process(target=_lemmiwinks, args=(dill.dumps(func), args, kwargs, q_worker))
        proc.start()
        try:
            return q_worker.get(timeout=timeout)
        except mpq.Empty:
            raise TimeoutError(func, timeout)
        finally:
            try:
                proc.terminate()
            except:
                pass
    return _inners

if __name__ == '__main__':
    @killer_call(timeout=4)
    def bar(x):
        import time
        time.sleep(x)
        return x

    print(bar(2))
    bar(10) 
```

# 笔记

由于工作方式，您将需要在函数内部导入`dill`。

`doctest`这也意味着如果您的目标函数中有导入，这些函数可能不兼容。您将遇到`__import__`未找到的问题。

* * *

## 回答 #13

> 赞同：4
> 
> 时间：2013-07-23T11:10:10.393

我们可以使用相同的信号。我认为下面的示例对您有用。与线程相比，它非常简单。

```
import signal

def timeout(signum, frame):
    raise myException

#this is an infinite loop, never ending under normal circumstances
def main():
    print 'Starting Main ',
    while 1:
        print 'in main ',

#SIGALRM is only usable on a unix platform
signal.signal(signal.SIGALRM, timeout)

#change 5 to however many seconds you need
signal.alarm(5)

try:
    main()
except myException:
    print "whoops" 
```

* * *

## 回答 #14

> 赞同：3
> 
> 时间：2020-08-10T09:36:40.840

另一个使用 asyncio 的解决方案：

如果您想取消后台任务而不仅仅是在运行的主代码上超时，那么您需要来自主线程的显式通信以要求任务的代码取消，例如 threading.Event()

```
import asyncio
import functools
import multiprocessing
from concurrent.futures.thread import ThreadPoolExecutor

class SingletonTimeOut:
    pool = None

    @classmethod
    def run(cls, to_run: functools.partial, timeout: float):
        pool = cls.get_pool()
        loop = cls.get_loop()
        try:
            task = loop.run_in_executor(pool, to_run)
            return loop.run_until_complete(asyncio.wait_for(task, timeout=timeout))
        except asyncio.TimeoutError as e:
            error_type = type(e).__name__ #TODO
            raise e

    @classmethod
    def get_pool(cls):
        if cls.pool is None:
            cls.pool = ThreadPoolExecutor(multiprocessing.cpu_count())
        return cls.pool

    @classmethod
    def get_loop(cls):
        try:
            return asyncio.get_event_loop()
        except RuntimeError:
            asyncio.set_event_loop(asyncio.new_event_loop())
            # print("NEW LOOP" + str(threading.current_thread().ident))
            return asyncio.get_event_loop()

# ---------------

TIME_OUT = float('0.2')  # seconds

def toto(input_items,nb_predictions):
    return 1

to_run = functools.partial(toto,
                           input_items=1,
                           nb_predictions="a")

results = SingletonTimeOut.run(to_run, TIME_OUT) 
```

* * *

## 回答 #15

> 赞同：3
> 
> 时间：2021-03-07T11:26:17.423

以防万一它对任何人都有帮助，基于@piro 的答案，我制作了一个函数装饰器：

```
import time
import signal
from functools import wraps

def timeout(timeout_secs: int):
    def wrapper(func):
        @wraps(func)
        def time_limited(*args, **kwargs):
            # Register an handler for the timeout
            def handler(signum, frame):
                raise Exception(f"Timeout for function '{func.__name__}'")

            # Register the signal function handler
            signal.signal(signal.SIGALRM, handler)

            # Define a timeout for your function
            signal.alarm(timeout_secs)

            result = None
            try:
                result = func(*args, **kwargs)
            except Exception as exc:
                raise exc
            finally:
                # disable the signal alarm
                signal.alarm(0)

            return result

        return time_limited

    return wrapper 
```

在具有`20 seconds`超时的函数上使用包装器看起来像：

```
 @timeout(20)
    def my_slow_or_never_ending_function(name):
        while True:
            time.sleep(1)
            print(f"Yet another second passed {name}...")

    try:
        results = my_slow_or_never_ending_function("Yooo!")
    except Exception as e:
        print(f"ERROR: {e}") 
```

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2016-04-27T13:27:21.877

```
#!/usr/bin/python2
import sys, subprocess, threading
proc = subprocess.Popen(sys.argv[2:])
timer = threading.Timer(float(sys.argv[1]), proc.terminate)
timer.start()
proc.wait()
timer.cancel()
exit(proc.returncode) 
```

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2016-01-25T18:36:02.653

我需要不会被 time.sleep 阻塞的**可嵌套**定时中断（SIGALARM 无法做到）（这是基于线程的方法无法做到的）。我最终从这里复制并稍微修改了代码：http: [//code.activestate.com/recipes/577600-queue-for-managing-multiple-sigalrm-alarms-concurr/](http://code.activestate.com/recipes/577600-queue-for-managing-multiple-sigalrm-alarms-concurr/)

代码本身：

```
#!/usr/bin/python

# lightly modified version of http://code.activestate.com/recipes/577600-queue-for-managing-multiple-sigalrm-alarms-concurr/

"""alarm.py: Permits multiple SIGALRM events to be queued.

Uses a `heapq` to store the objects to be called when an alarm signal is
raised, so that the next alarm is always at the top of the heap.
"""

import heapq
import signal
from time import time

__version__ = '$Revision: 2539 $'.split()[1]

alarmlist = []

__new_alarm = lambda t, f, a, k: (t + time(), f, a, k)
__next_alarm = lambda: int(round(alarmlist[0][0] - time())) if alarmlist else None
__set_alarm = lambda: signal.alarm(max(__next_alarm(), 1))

class TimeoutError(Exception):
    def __init__(self, message, id_=None):
        self.message = message
        self.id_ = id_

class Timeout:
    ''' id_ allows for nested timeouts. '''
    def __init__(self, id_=None, seconds=1, error_message='Timeout'):
        self.seconds = seconds
        self.error_message = error_message
        self.id_ = id_
    def handle_timeout(self):
        raise TimeoutError(self.error_message, self.id_)
    def __enter__(self):
        self.this_alarm = alarm(self.seconds, self.handle_timeout)
    def __exit__(self, type, value, traceback):
        try:
            cancel(self.this_alarm) 
        except ValueError:
            pass

def __clear_alarm():
    """Clear an existing alarm.

    If the alarm signal was set to a callable other than our own, queue the
    previous alarm settings.
    """
    oldsec = signal.alarm(0)
    oldfunc = signal.signal(signal.SIGALRM, __alarm_handler)
    if oldsec > 0 and oldfunc != __alarm_handler:
        heapq.heappush(alarmlist, (__new_alarm(oldsec, oldfunc, [], {})))

def __alarm_handler(*zargs):
    """Handle an alarm by calling any due heap entries and resetting the alarm.

    Note that multiple heap entries might get called, especially if calling an
    entry takes a lot of time.
    """
    try:
        nextt = __next_alarm()
        while nextt is not None and nextt <= 0:
            (tm, func, args, keys) = heapq.heappop(alarmlist)
            func(*args, **keys)
            nextt = __next_alarm()
    finally:
        if alarmlist: __set_alarm()

def alarm(sec, func, *args, **keys):
    """Set an alarm.

    When the alarm is raised in `sec` seconds, the handler will call `func`,
    passing `args` and `keys`. Return the heap entry (which is just a big
    tuple), so that it can be cancelled by calling `cancel()`.
    """
    __clear_alarm()
    try:
        newalarm = __new_alarm(sec, func, args, keys)
        heapq.heappush(alarmlist, newalarm)
        return newalarm
    finally:
        __set_alarm()

def cancel(alarm):
    """Cancel an alarm by passing the heap entry returned by `alarm()`.

    It is an error to try to cancel an alarm which has already occurred.
    """
    __clear_alarm()
    try:
        alarmlist.remove(alarm)
        heapq.heapify(alarmlist)
    finally:
        if alarmlist: __set_alarm() 
```

和一个用法示例：

```
import alarm
from time import sleep

try:
    with alarm.Timeout(id_='a', seconds=5):
        try:
            with alarm.Timeout(id_='b', seconds=2):
                sleep(3)
        except alarm.TimeoutError as e:
            print 'raised', e.id_
        sleep(30)
except alarm.TimeoutError as e:
    print 'raised', e.id_
else:
    print 'nope.' 
```

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2021-06-06T08:53:20.670

我遇到了同样的问题，但我的情况是需要在子线程上工作，信号对我不起作用，所以我写了一个 python 包： timeout-timer 来解决这个问题，支持用作上下文或装饰器，使用信号或子线程模块触发超时中断：

```
from timeout_timer import timeout, TimeoutInterrupt

class TimeoutInterruptNested(TimeoutInterrupt):
    pass

def test_timeout_nested_loop_both_timeout(timer="thread"):
    cnt = 0
    try:
        with timeout(5, timer=timer):
            try:
                with timeout(2, timer=timer, exception=TimeoutInterruptNested):
                    sleep(2)
            except TimeoutInterruptNested:
                cnt += 1
            time.sleep(10)
    except TimeoutInterrupt:
        cnt += 1
    assert cnt == 2 
```

查看更多：[https ://github.com/dozysun/timeout-timer](https://github.com/dozysun/timeout-timer)

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2012-09-06T08:25:33.683

这是对给定的基于线程的解决方案的轻微改进。

下面的代码支持**异常**：

```
def runFunctionCatchExceptions(func, *args, **kwargs):
    try:
        result = func(*args, **kwargs)
    except Exception, message:
        return ["exception", message]

    return ["RESULT", result]

def runFunctionWithTimeout(func, args=(), kwargs={}, timeout_duration=10, default=None):
    import threading
    class InterruptableThread(threading.Thread):
        def __init__(self):
            threading.Thread.__init__(self)
            self.result = default
        def run(self):
            self.result = runFunctionCatchExceptions(func, *args, **kwargs)
    it = InterruptableThread()
    it.start()
    it.join(timeout_duration)
    if it.isAlive():
        return default

    if it.result[0] == "exception":
        raise it.result[1]

    return it.result[1] 
```

以 5 秒超时调用它：

```
result = timeout(remote_calculate, (myarg,), timeout_duration=5) 
```

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2020-08-08T15:29:44.007

这是一个 POSIX 版本，它结合了许多以前的答案以提供以下功能：

1.  阻止执行的子进程。
2.  在类成员函数上使用超时函数。
3.  对终止时间的严格要求。

这是代码和一些测试用例：

```
import threading
import signal
import os
import time

class TerminateExecution(Exception):
    """
    Exception to indicate that execution has exceeded the preset running time.
    """

def quit_function(pid):
    # Killing all subprocesses
    os.setpgrp()
    os.killpg(0, signal.SIGTERM)

    # Killing the main thread
    os.kill(pid, signal.SIGTERM)

def handle_term(signum, frame):
    raise TerminateExecution()

def invoke_with_timeout(timeout, fn, *args, **kwargs):
    # Setting a sigterm handler and initiating a timer
    old_handler = signal.signal(signal.SIGTERM, handle_term)
    timer = threading.Timer(timeout, quit_function, args=[os.getpid()])
    terminate = False

    # Executing the function
    timer.start()
    try:
        result = fn(*args, **kwargs)
    except TerminateExecution:
        terminate = True
    finally:
        # Restoring original handler and cancel timer
        signal.signal(signal.SIGTERM, old_handler)
        timer.cancel()

    if terminate:
        raise BaseException("xxx")

    return result

### Test cases
def countdown(n):
    print('countdown started', flush=True)
    for i in range(n, -1, -1):
        print(i, end=', ', flush=True)
        time.sleep(1)
    print('countdown finished')
    return 1337

def really_long_function():
    time.sleep(10)

def really_long_function2():
    os.system("sleep 787")

# Checking that we can run a function as expected.
assert invoke_with_timeout(3, countdown, 1) == 1337

# Testing various scenarios
t1 = time.time()
try:
    print(invoke_with_timeout(1, countdown, 3))
    assert(False)
except BaseException:
    assert(time.time() - t1 < 1.1)
    print("All good", time.time() - t1)

t1 = time.time()
try:
    print(invoke_with_timeout(1, really_long_function2))
    assert(False)
except BaseException:
    assert(time.time() - t1 < 1.1)
    print("All good", time.time() - t1)

t1 = time.time()
try:
    print(invoke_with_timeout(1, really_long_function))
    assert(False)
except BaseException:
    assert(time.time() - t1 < 1.1)
    print("All good", time.time() - t1)

# Checking that classes are referenced and not
# copied (as would be the case with multiprocessing)

class X:
    def __init__(self):
        self.value = 0

    def set(self, v):
        self.value = v

x = X()
invoke_with_timeout(2, x.set, 9)
assert x.value == 9 
```

# ms-access - 从 Microsoft Access 计算字符串的 MD5

> ID：492523
> 
> 赞同：6
> 
> 时间：2009-01-29T17:09:34.950
> 
> 标签：ms-access, hash, md5

如何在 Microsoft Access 中计算字符串客户端的 MD5？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-29T17:23:41.270

如果您通过 VBA 模块实现 MD5，那么有几个选项。

我没有尝试过，但是快速搜索“md5 vba”返回了这个[basMD5.bas](http://www.di-mgt.com.au/src/basMD5.bas.html)文件。但是，它不是常见的开源许可证之一。

来自Visual Basic 部分的“ [MD5 Homepage (unofficial) ”：](http://userpages.umbc.edu/~mabzug1/cs/md5/md5.html)

*   Francisco Carlos Piragibe de Almeida 创建了一个带有[BAS 包装器模块](http://www.esquadro.com.br/md5bas.zip)的 DLL，用于 VB 项目（19K 下载）和[一个围绕原始 DLL](http://www.esquadro.com.br/md5server.zip)（包括 DLL）的 ActiveX 进程内服务器包装器（1394K 下载）。（似乎坏了——2005-11-14）
*   [用于 VB 的 MD5](http://www.freevbcode.com/ShowCode.Asp?ID=741)。本杰明·普里查德参考。
*   [用于 VB 和 VBScript 的 MD5](http://www.frez.co.uk/freecode.htm#md5)。Dominik Deobald 的参考资料。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-29T17:20:48.140

看起来 DW Fenton 几年前在[bytes.com上问过同样的事情](http://bytes.com/groups/ms-access/576536-md5-vb)

这是他找到[解决方案的地方](http://www.frez.co.uk/freecode.htm#md5)

这是列出的 ASP 示例中的相关代码，这应该非常接近 VBA：

```
' Derived from the RSA Data Security, Inc. MD5 Message-Digest Algorithm,
' as set out in the memo RFC1321.
'
' See the VB6 project that accompanies this sample for full code comments on how
' it works.
'
' ASP VBScript code for generating an MD5 'digest' or 'signature' of a string. The
' MD5 algorithm is one of the industry standard methods for generating digital
' signatures. It is generically known as a digest, digital signature, one-way
' encryption, hash or checksum algorithm. A common use for MD5 is for password
' encryption as it is one-way in nature, that does not mean that your passwords
' are not free from a dictionary attack.
'
' This is 'free' software with the following restrictions:
'
' You may not redistribute this code as a 'sample' or 'demo'. However, you are free
' to use the source code in your own code, but you may not claim that you created
' the sample code. It is expressly forbidden to sell or profit from this source code
' other than by the knowledge gained or the enhanced value added by your own code.
'
' Use of this software is also done so at your own risk. The code is supplied as
' is without warranty or guarantee of any kind.
'
' Should you wish to commission some derivative work based on this code provided
' here, or any consultancy work, please do not hesitate to contact us.
'
' Web Site:  http://www.frez.co.uk
' E-mail:    sales@frez.co.uk

Private Const BITS_TO_A_BYTE = 8
Private Const BYTES_TO_A_WORD = 4
Private Const BITS_TO_A_WORD = 32

Private m_lOnBits(30)
Private m_l2Power(30)

    m_lOnBits(0) = CLng(1)
    m_lOnBits(1) = CLng(3)
    m_lOnBits(2) = CLng(7)
    m_lOnBits(3) = CLng(15)
    m_lOnBits(4) = CLng(31)
    m_lOnBits(5) = CLng(63)
    m_lOnBits(6) = CLng(127)
    m_lOnBits(7) = CLng(255)
    m_lOnBits(8) = CLng(511)
    m_lOnBits(9) = CLng(1023)
    m_lOnBits(10) = CLng(2047)
    m_lOnBits(11) = CLng(4095)
    m_lOnBits(12) = CLng(8191)
    m_lOnBits(13) = CLng(16383)
    m_lOnBits(14) = CLng(32767)
    m_lOnBits(15) = CLng(65535)
    m_lOnBits(16) = CLng(131071)
    m_lOnBits(17) = CLng(262143)
    m_lOnBits(18) = CLng(524287)
    m_lOnBits(19) = CLng(1048575)
    m_lOnBits(20) = CLng(2097151)
    m_lOnBits(21) = CLng(4194303)
    m_lOnBits(22) = CLng(8388607)
    m_lOnBits(23) = CLng(16777215)
    m_lOnBits(24) = CLng(33554431)
    m_lOnBits(25) = CLng(67108863)
    m_lOnBits(26) = CLng(134217727)
    m_lOnBits(27) = CLng(268435455)
    m_lOnBits(28) = CLng(536870911)
    m_lOnBits(29) = CLng(1073741823)
    m_lOnBits(30) = CLng(2147483647)

    m_l2Power(0) = CLng(1)
    m_l2Power(1) = CLng(2)
    m_l2Power(2) = CLng(4)
    m_l2Power(3) = CLng(8)
    m_l2Power(4) = CLng(16)
    m_l2Power(5) = CLng(32)
    m_l2Power(6) = CLng(64)
    m_l2Power(7) = CLng(128)
    m_l2Power(8) = CLng(256)
    m_l2Power(9) = CLng(512)
    m_l2Power(10) = CLng(1024)
    m_l2Power(11) = CLng(2048)
    m_l2Power(12) = CLng(4096)
    m_l2Power(13) = CLng(8192)
    m_l2Power(14) = CLng(16384)
    m_l2Power(15) = CLng(32768)
    m_l2Power(16) = CLng(65536)
    m_l2Power(17) = CLng(131072)
    m_l2Power(18) = CLng(262144)
    m_l2Power(19) = CLng(524288)
    m_l2Power(20) = CLng(1048576)
    m_l2Power(21) = CLng(2097152)
    m_l2Power(22) = CLng(4194304)
    m_l2Power(23) = CLng(8388608)
    m_l2Power(24) = CLng(16777216)
    m_l2Power(25) = CLng(33554432)
    m_l2Power(26) = CLng(67108864)
    m_l2Power(27) = CLng(134217728)
    m_l2Power(28) = CLng(268435456)
    m_l2Power(29) = CLng(536870912)
    m_l2Power(30) = CLng(1073741824)

Private Function LShift(lValue, iShiftBits)
    If iShiftBits = 0 Then
        LShift = lValue
        Exit Function
    ElseIf iShiftBits = 31 Then
        If lValue And 1 Then
            LShift = &H80000000
        Else
            LShift = 0
        End If
        Exit Function
    ElseIf iShiftBits < 0 Or iShiftBits > 31 Then
        Err.Raise 6
    End If

    If (lValue And m_l2Power(31 - iShiftBits)) Then
        LShift = ((lValue And m_lOnBits(31 - (iShiftBits + 1))) * m_l2Power(iShiftBits)) Or &H80000000
    Else
        LShift = ((lValue And m_lOnBits(31 - iShiftBits)) * m_l2Power(iShiftBits))
    End If
End Function

Private Function RShift(lValue, iShiftBits)
    If iShiftBits = 0 Then
        RShift = lValue
        Exit Function
    ElseIf iShiftBits = 31 Then
        If lValue And &H80000000 Then
            RShift = 1
        Else
            RShift = 0
        End If
        Exit Function
    ElseIf iShiftBits < 0 Or iShiftBits > 31 Then
        Err.Raise 6
    End If

    RShift = (lValue And &H7FFFFFFE) \ m_l2Power(iShiftBits)

    If (lValue And &H80000000) Then
        RShift = (RShift Or (&H40000000 \ m_l2Power(iShiftBits - 1)))
    End If
End Function

Private Function RotateLeft(lValue, iShiftBits)
    RotateLeft = LShift(lValue, iShiftBits) Or RShift(lValue, (32 - iShiftBits))
End Function

Private Function AddUnsigned(lX, lY)
    Dim lX4
    Dim lY4
    Dim lX8
    Dim lY8
    Dim lResult

    lX8 = lX And &H80000000
    lY8 = lY And &H80000000
    lX4 = lX And &H40000000
    lY4 = lY And &H40000000

    lResult = (lX And &H3FFFFFFF) + (lY And &H3FFFFFFF)

    If lX4 And lY4 Then
        lResult = lResult Xor &H80000000 Xor lX8 Xor lY8
    ElseIf lX4 Or lY4 Then
        If lResult And &H40000000 Then
            lResult = lResult Xor &HC0000000 Xor lX8 Xor lY8
        Else
            lResult = lResult Xor &H40000000 Xor lX8 Xor lY8
        End If
    Else
        lResult = lResult Xor lX8 Xor lY8
    End If

    AddUnsigned = lResult
End Function

Private Function F(x, y, z)
    F = (x And y) Or ((Not x) And z)
End Function

Private Function G(x, y, z)
    G = (x And z) Or (y And (Not z))
End Function

Private Function H(x, y, z)
    H = (x Xor y Xor z)
End Function

Private Function I(x, y, z)
    I = (y Xor (x Or (Not z)))
End Function

Private Sub FF(a, b, c, d, x, s, ac)
    a = AddUnsigned(a, AddUnsigned(AddUnsigned(F(b, c, d), x), ac))
    a = RotateLeft(a, s)
    a = AddUnsigned(a, b)
End Sub

Private Sub GG(a, b, c, d, x, s, ac)
    a = AddUnsigned(a, AddUnsigned(AddUnsigned(G(b, c, d), x), ac))
    a = RotateLeft(a, s)
    a = AddUnsigned(a, b)
End Sub

Private Sub HH(a, b, c, d, x, s, ac)
    a = AddUnsigned(a, AddUnsigned(AddUnsigned(H(b, c, d), x), ac))
    a = RotateLeft(a, s)
    a = AddUnsigned(a, b)
End Sub

Private Sub II(a, b, c, d, x, s, ac)
    a = AddUnsigned(a, AddUnsigned(AddUnsigned(I(b, c, d), x), ac))
    a = RotateLeft(a, s)
    a = AddUnsigned(a, b)
End Sub

Private Function ConvertToWordArray(sMessage)
    Dim lMessageLength
    Dim lNumberOfWords
    Dim lWordArray()
    Dim lBytePosition
    Dim lByteCount
    Dim lWordCount

    Const MODULUS_BITS = 512
    Const CONGRUENT_BITS = 448

    lMessageLength = Len(sMessage)

    lNumberOfWords = (((lMessageLength + ((MODULUS_BITS - CONGRUENT_BITS) \ BITS_TO_A_BYTE)) \ (MODULUS_BITS \ BITS_TO_A_BYTE)) + 1) * (MODULUS_BITS \ BITS_TO_A_WORD)
    ReDim lWordArray(lNumberOfWords - 1)

    lBytePosition = 0
    lByteCount = 0
    Do Until lByteCount >= lMessageLength
        lWordCount = lByteCount \ BYTES_TO_A_WORD
        lBytePosition = (lByteCount Mod BYTES_TO_A_WORD) * BITS_TO_A_BYTE
        lWordArray(lWordCount) = lWordArray(lWordCount) Or LShift(Asc(Mid(sMessage, lByteCount + 1, 1)), lBytePosition)
        lByteCount = lByteCount + 1
    Loop

    lWordCount = lByteCount \ BYTES_TO_A_WORD
    lBytePosition = (lByteCount Mod BYTES_TO_A_WORD) * BITS_TO_A_BYTE

    lWordArray(lWordCount) = lWordArray(lWordCount) Or LShift(&H80, lBytePosition)

    lWordArray(lNumberOfWords - 2) = LShift(lMessageLength, 3)
    lWordArray(lNumberOfWords - 1) = RShift(lMessageLength, 29)

    ConvertToWordArray = lWordArray
End Function

Private Function WordToHex(lValue)
    Dim lByte
    Dim lCount

    For lCount = 0 To 3
        lByte = RShift(lValue, lCount * BITS_TO_A_BYTE) And m_lOnBits(BITS_TO_A_BYTE - 1)
        WordToHex = WordToHex & Right("0" & Hex(lByte), 2)
    Next
End Function

Public Function MD5(sMessage)
    Dim x
    Dim k
    Dim AA
    Dim BB
    Dim CC
    Dim DD
    Dim a
    Dim b
    Dim c
    Dim d

    Const S11 = 7
    Const S12 = 12
    Const S13 = 17
    Const S14 = 22
    Const S21 = 5
    Const S22 = 9
    Const S23 = 14
    Const S24 = 20
    Const S31 = 4
    Const S32 = 11
    Const S33 = 16
    Const S34 = 23
    Const S41 = 6
    Const S42 = 10
    Const S43 = 15
    Const S44 = 21

    x = ConvertToWordArray(sMessage)

    a = &H67452301
    b = &HEFCDAB89
    c = &H98BADCFE
    d = &H10325476

    For k = 0 To UBound(x) Step 16
        AA = a
        BB = b
        CC = c
        DD = d

        FF a, b, c, d, x(k + 0), S11, &HD76AA478
        FF d, a, b, c, x(k + 1), S12, &HE8C7B756
        FF c, d, a, b, x(k + 2), S13, &H242070DB
        FF b, c, d, a, x(k + 3), S14, &HC1BDCEEE
        FF a, b, c, d, x(k + 4), S11, &HF57C0FAF
        FF d, a, b, c, x(k + 5), S12, &H4787C62A
        FF c, d, a, b, x(k + 6), S13, &HA8304613
        FF b, c, d, a, x(k + 7), S14, &HFD469501
        FF a, b, c, d, x(k + 8), S11, &H698098D8
        FF d, a, b, c, x(k + 9), S12, &H8B44F7AF
        FF c, d, a, b, x(k + 10), S13, &HFFFF5BB1
        FF b, c, d, a, x(k + 11), S14, &H895CD7BE
        FF a, b, c, d, x(k + 12), S11, &H6B901122
        FF d, a, b, c, x(k + 13), S12, &HFD987193
        FF c, d, a, b, x(k + 14), S13, &HA679438E
        FF b, c, d, a, x(k + 15), S14, &H49B40821

        GG a, b, c, d, x(k + 1), S21, &HF61E2562
        GG d, a, b, c, x(k + 6), S22, &HC040B340
        GG c, d, a, b, x(k + 11), S23, &H265E5A51
        GG b, c, d, a, x(k + 0), S24, &HE9B6C7AA
        GG a, b, c, d, x(k + 5), S21, &HD62F105D
        GG d, a, b, c, x(k + 10), S22, &H2441453
        GG c, d, a, b, x(k + 15), S23, &HD8A1E681
        GG b, c, d, a, x(k + 4), S24, &HE7D3FBC8
        GG a, b, c, d, x(k + 9), S21, &H21E1CDE6
        GG d, a, b, c, x(k + 14), S22, &HC33707D6
        GG c, d, a, b, x(k + 3), S23, &HF4D50D87
        GG b, c, d, a, x(k + 8), S24, &H455A14ED
        GG a, b, c, d, x(k + 13), S21, &HA9E3E905
        GG d, a, b, c, x(k + 2), S22, &HFCEFA3F8
        GG c, d, a, b, x(k + 7), S23, &H676F02D9
        GG b, c, d, a, x(k + 12), S24, &H8D2A4C8A

        HH a, b, c, d, x(k + 5), S31, &HFFFA3942
        HH d, a, b, c, x(k + 8), S32, &H8771F681
        HH c, d, a, b, x(k + 11), S33, &H6D9D6122
        HH b, c, d, a, x(k + 14), S34, &HFDE5380C
        HH a, b, c, d, x(k + 1), S31, &HA4BEEA44
        HH d, a, b, c, x(k + 4), S32, &H4BDECFA9
        HH c, d, a, b, x(k + 7), S33, &HF6BB4B60
        HH b, c, d, a, x(k + 10), S34, &HBEBFBC70
        HH a, b, c, d, x(k + 13), S31, &H289B7EC6
        HH d, a, b, c, x(k + 0), S32, &HEAA127FA
        HH c, d, a, b, x(k + 3), S33, &HD4EF3085
        HH b, c, d, a, x(k + 6), S34, &H4881D05
        HH a, b, c, d, x(k + 9), S31, &HD9D4D039
        HH d, a, b, c, x(k + 12), S32, &HE6DB99E5
        HH c, d, a, b, x(k + 15), S33, &H1FA27CF8
        HH b, c, d, a, x(k + 2), S34, &HC4AC5665

        II a, b, c, d, x(k + 0), S41, &HF4292244
        II d, a, b, c, x(k + 7), S42, &H432AFF97
        II c, d, a, b, x(k + 14), S43, &HAB9423A7
        II b, c, d, a, x(k + 5), S44, &HFC93A039
        II a, b, c, d, x(k + 12), S41, &H655B59C3
        II d, a, b, c, x(k + 3), S42, &H8F0CCC92
        II c, d, a, b, x(k + 10), S43, &HFFEFF47D
        II b, c, d, a, x(k + 1), S44, &H85845DD1
        II a, b, c, d, x(k + 8), S41, &H6FA87E4F
        II d, a, b, c, x(k + 15), S42, &HFE2CE6E0
        II c, d, a, b, x(k + 6), S43, &HA3014314
        II b, c, d, a, x(k + 13), S44, &H4E0811A1
        II a, b, c, d, x(k + 4), S41, &HF7537E82
        II d, a, b, c, x(k + 11), S42, &HBD3AF235
        II c, d, a, b, x(k + 2), S43, &H2AD7D2BB
        II b, c, d, a, x(k + 9), S44, &HEB86D391

        a = AddUnsigned(a, AA)
        b = AddUnsigned(b, BB)
        c = AddUnsigned(c, CC)
        d = AddUnsigned(d, DD)
    Next

    MD5 = LCase(WordToHex(a) & WordToHex(b) & WordToHex(c) & WordToHex(d))
End Function 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-29T17:22:03.647

据我所知，Access 中没有用于计算 MD5 哈希的内置函数。您需要一个外部 API（如 casperOne 所述），或者您可以在 VBA 中使用自己的 MD5 实现。

谷歌搜索我想出了[这个模块](http://files.codes-sources.com/fichier.aspx?id=33423&f=modMD5.bas)，你可以将它添加到你的项目中，但我不能保证任何事情。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-29T17:24:32.097

您可以安装一个像[这样](http://xstandard.com/en/documentation/xmd5/)的免费 COM 组件，然后从 VBA 使用它

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2018-10-25T06:16:34.100

从这[本维基书](https://en.wikibooks.org/wiki/Visual_Basic_for_Applications/String_Hashing_in_VBA)

```
Public Function Hash_MD5(ByVal sIn As String) As String
    'Set a reference to mscorlib 4.0 64-bit

    Dim oT As Object, oMD5 As Object
    Dim TextToHash() As Byte
    Dim bytes() As Byte

    Set oT = CreateObject("System.Text.UTF8Encoding")
    Set oMD5 = CreateObject("System.Security.Cryptography.MD5CryptoServiceProvider")

    TextToHash = oT.GetBytes_4(sIn)
    bytes = oMD5.ComputeHash_2((TextToHash))

    Hash_MD5 = ConvToHexString(bytes)

    Set oT = Nothing
    Set oMD5 = Nothing
End Function

Private Function ConvToHexString(ByVal vIn As Variant) As Variant
    Dim oD As Object
    Set oD = CreateObject("MSXML2.DOMDocument")

    With oD
        .LoadXML "<root />"
        .DocumentElement.DataType = "bin.Hex"
        .DocumentElement.nodeTypedValue = vIn
    End With
    ConvToHexString = Replace(oD.DocumentElement.text, vbLf, "")

    Set oD = Nothing
End Function 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-29T17:15:53.970

您可以使用 Cryptography API：Next Generation，其参考可在此处找到：

[http://msdn.microsoft.com/en-us/library/aa376210(VS.85).aspx](http://msdn.microsoft.com/en-us/library/aa376210(VS.85).aspx)

通过 VBA 中的 DECLARE 语句使用它可能有点困难（您必须使用它），因此您始终可以使用 COM 互操作来调用 .NET 中的方法，这些方法访问 System.Security.Cryptography 命名空间中的 MD5 类。

# asp.net - 如何获取 asp:ListBox 中的第一个选定项目，其中 SelectionMode="Multiple" 出现在顶部？

> ID：492535
> 
> 赞同：1
> 
> 时间：2009-01-29T17:12:34.257
> 
> 标签：asp.net, html, webforms

在 asp.net 中，如果你定义一个 asp:ListBox 如下：

```
<asp:ListBox ID="listBox2" runat="server" SelectionMode="Single" Rows="3">
  <asp:ListItem>1</asp:ListItem>
  <asp:ListItem>2</asp:ListItem>
  <asp:ListItem>3</asp:ListItem>
  <asp:ListItem>4</asp:ListItem>
  <asp:ListItem>5</asp:ListItem>
  <asp:ListItem>6</asp:ListItem>
  <asp:ListItem>7</asp:ListItem>
  <asp:ListItem Selected="True">8</asp:ListItem>
  <asp:ListItem>9</asp:ListItem>
  <asp:ListItem>10</asp:ListItem>
</asp:ListBox> 
```

您将看到所选项目在顶部可见。但是如果将其定义为多选列表框，则所选项目是不可见的，您必须向下滚动列表才能找到它们。

```
<asp:ListBox ID="listBox1" runat="server" SelectionMode="Multiple" Rows="3">
  <asp:ListItem>1</asp:ListItem>
  <asp:ListItem>2</asp:ListItem>
  <asp:ListItem>3</asp:ListItem>
  <asp:ListItem>4</asp:ListItem>
  <asp:ListItem>5</asp:ListItem>
  <asp:ListItem>6</asp:ListItem>
  <asp:ListItem>7</asp:ListItem>
  <asp:ListItem Selected="True">8</asp:ListItem>
  <asp:ListItem Selected="True">9</asp:ListItem>
  <asp:ListItem>10</asp:ListItem>
</asp:ListBox> 
```

我做了一些谷歌搜索，发现这不是一个不常见的问题。但是我没有找到任何好的解决方案，所以我想我会在这里问。

我的第一个想法是尝试一些 JQuery 来解决这个问题。你的一些解决方案是什么？

有几个答案甚至不明白我的问题。我只关心确保第一个选择的选项是可见的。确保它滚动到视图中。

我玩弄了 JQuery，并想出了以下内容：

```
<script type="text/javascript">
$(document).ready(function() {
   $("#listBox1 option:nth-child(8)").attr('selected',true);
 });
</script> 
```

但我认为我最喜欢@Cerebrus 的回答。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-29T18:33:28.633

这是我过去的做法。请注意，这会将视图滚动到列表框中的最后一项。

```
function FocusSelected()
{
  var lb = document.getElementById("listBox1");
  if (lb != null)
  {
    var options = lb.options;
    for (var i = options.length - 1; i > 0 ; i--)
    {
      if (options[i].selected == true)
      {
        options[i].focus();
        options[i].selected = true;
        return;
      }
    }
  }
} 
```

它适用于 IE 7 和 FF 3.0。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-29T17:24:51.033

这有点笨拙，但我已经做过一次，并且欢迎更好的解决方案。

```
 //get the selected value
        var selected = (from l in lstFilterUsers.Items.Cast<ListItem>()
                 orderby l.Value
                where l.Selected == true
                select l).Take(1);
        //get all the values except for that first selection
        var all = (from l in lstFilterUsers.Items.Cast<ListItem>()
                   where l != selected
                 orderby l.Value
                 select l);
        //create a temp array and fill it
        ListItem[] lic = new ListItem[lstFilterUsers.Items.Count];
        lic[0] = (ListItem)selected;
        int i = 1;
        foreach (var li in all)
        {
            lic[i++] = li;
        }
        //clear the listbox
        lstFilterUsers.Items.Clear();
        //readd the list
        lstFilterUsers.Items.AddRange(lic); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-29T17:28:45.503

你怎么称呼这个？

来自 Javascript：

```
<script type="text/javascript">

var myselect=document.getElementById("listBox1")
for (var i=0; i<myselect.options.length; i++){
    if (myselect.options[i].selected==true){
        alert("Selected Option's index: "+i)
        break;
    }
} 
```

从背后的代码：

```
foreach (ListItem li in listBox1.Items)
{
    if (li.Selected)
    {
        return li;
    }
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-29T18:25:11.850

在我有限的实验中，Chrome 和 Firefox 都会自动滚动。

对于 IE，我编写了这段 jQuery 代码（在 IE7 上测试）：

```
$(document).ready(function(){
    scrollToFirstSelection('select');       
});

function scrollToFirstSelection(query) {
    var select = $(query);
    var singleOption = select.find('option')[0];
    var heightOfSingleOption = select[0].offsetHeight / select.attr('size');
    var indexOfFirstSelection = select.find('option').index($('option[selected=true]:first'));
    select[0].scrollTop = heightOfSingleOption * indexOfFirstSelection;
} 
```

如果您使用任何疯狂的填充或边距，可能并不准确，但它应该足够接近。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-11-08T00:47:20.600

我修改了代码，以便**在 IE 和 FF 中获得一致的结果**，使用 FF 的 scrollTo 依赖项：

```
 $('select').each(function () {

        var options = $(this).find('option');
        for (var i = options.length - 1; i > 0; i--) {
            if (options[i].selected == true) {

                var x = options[i];                

                if (jQuery.browser.msie) {
                    x.focus();
                    x.selected = true;
                } else {
                    $(x).parents('select:eq(0)').scrollTo(x, 0);
                }

                return;
            }
        }
    }); 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2013-03-14T17:34:02.620

我发现一行客户端 jQuery 代码解决了这个问题。对于带有一个或多个选定选项的多选列表框，请使用选择器的强大功能来查找第一个选定选项。出于某种原因，单独调用 focus() 是行不通的，但是将选定的元素重新设置为选定的，然后它会将选定的元素滚动到视图中。

```
$(document).ready(function () {

  // Scroll to **FIRST** selected option in multi select list
  $("#lstCountries option:selected(:first)").focus().prop('selected', 'selected');

  // Scroll to **LAST** selected option in multi select list
  $("#lstStates option:selected").focus().prop('selected', 'selected');

}); 
```

# c# - 分配事件的区别是什么……正确的方法？

> ID：492539
> 
> 赞同：0
> 
> 时间：2009-01-29T17:12:48.733
> 
> 标签：c#, events, click, delegates, new-operator

你能告诉我这些附加事件处理程序的方法有什么区别吗？

```
//Method 1
this.button4.Click += new RoutedEventHandler(button4_Click);

//Method 2
this.button4.Click += button4_Click;

...

void button4_Click(object sender, RoutedEventArgs e) { } 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-29T17:29:05.957

正如安东所说，没有区别。

就像更多背景一样，这并不特定于事件。这只是 C# 2.0 中该功能的一种用途，即方法组到委托的隐式转换。所以你可以类似地这样使用它：

```
EventHandler handler = button4_click; 
```

C# 2.0 中委托的另一个变化是它们现在是变体 - 这意味着（例如）您可以使用使用 EventHander 签名声明的方法作为 MouseEventHandler：

```
MouseEventHandler handler = button4_click; 
```

当然还有匿名方法，但那是完全不同的球赛:)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-29T17:14:48.777

没有任何区别 - 第二个只是在 C# 2.0 中添加的语法 shugar。而在 C# 3.0 中，lambda 表达式更加简洁。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-29T17:35:57.097

它确实是语法糖（它编译成相同的 CIL）

第一种方法的好处是它在调用站点上明确说明您正在使用什么事件类型。

第二个的好处是，如果委托类型改变但保持兼容，则代码不需要改变，如果它改变但不兼容，你只需要修复方法，而不是它附加到事件的位置。

与以往一样，这是一种平衡，哪个赞成/反对更适合手头的情况

# php - 寻找 PHP/Ajax/MySQL 代码片段来添加/编辑标签 - 与 stackOverflow 相同

> ID：492547
> 
> 赞同：3
> 
> 时间：2009-01-29T17:15:32.550
> 
> 标签：php, mysql, ajax

我正在向我的网站添加标记系统。我希望能够轻松添加/编辑项目标签。

我当前的标签表结构是：

```
Table: Item
Columns: ItemID, Title, Content

Table: Tag
Columns: TagID, Title, Tag_Counter

Table: ItemTag
Columns: ItemID, TagID 
```

我真的很喜欢 StackOverflow 中标记的实现，谁能指导我一个我可以使用的代码片段（PHP/Ajax/MySQL）？

我知道，这是一个艰难的...

谢谢，

罗伊。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-30T06:41:39.850

如果您不想手动编写所有代码，可以尝试开源解决方案。

例如， [https://code.google.com/p/phptagengine/](https://code.google.com/p/phptagengine/)

如果您想要与 Flicker、Technorati、Delicious 等集成的更强大的东西，ZEND_Service 框架有一些非常酷的库。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-03-21T02:31:41.443

这是您想要的脚本的链接......

[http://www.amitpatil.me/facebook-style-add-friends-script/](http://www.amitpatil.me/facebook-style-add-friends-script/)

享受！！

# php - 如何使用 PHP 在 MySQL db 中插入大文件？

> ID：492549
> 
> 赞同：9
> 
> 时间：2009-01-29T17:16:26.903
> 
> 标签：php, mysql, blob, large-files

我想将一个最大为 10MB 的大文件上传到我的 MySQL 数据库。使用`.htaccess`我将 PHP 自己的文件上传限制更改为“10485760”= 10MB。我可以毫无问题地上传最大 10MB 的文件。

但如果文件大小超过 1 MB，我无法将其插入数据库中。

我正在使用`file_get_contents`读取所有文件数据并将其作为要插入 LONGBLOB 字段的字符串传递给插入查询。

但是大于 1 MB 的文件不会添加到数据库中，尽管我可以使用`print_r($_FILES)`它来确保文件正确上传。任何帮助将不胜感激，我将在接下来的 6 小时内需要它。所以，请帮忙！

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-01-29T17:21:10.777

您将需要检查 MySQL 配置值“max_allowed_pa​​cket”，它可能设置得太小，从而防止发生 INSERT（本身很大）。

从 mysql 命令提示符运行以下命令：

```
mysql> show variables like 'max_allowed_packet'; 
```

确保它足够大。有关此配置选项的更多信息，请参阅

[MySQL max_allowed_pa​​cket](http://dev.mysql.com/doc/refman/5.1/en/packet-too-large.html)

这也会影响 PHP 中的 mysql_escape_string() 和 mysql_real_escape_string() 限制字符串创建的大小。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-01-29T17:29:04.660

据我所知，通常更快更好的做法是不要将文件存储在数据库中，因为它会很快变得庞大并减慢速度。最好将文件存储在目录中，然后将文件的位置存储在数据库中。

我们为工作中的 CMS 中的图像/pdfs/mpegs 等执行此操作，方法是为从 url-safe 文件名命名的文件创建一个文件夹并将文件夹名称存储在 db.xml 中。然后在表示层中写出它的url就很容易了。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-29T17:21:33.913

MySQL 的一些 PHP 扩展在 LONGBLOB 和 LONGTEXT 数据类型方面存在问题。扩展可能不支持 blob 流式传输（一次发布一个段），因此它们必须一次性发布整个对象。

因此，如果 PHP 的内存限制或 MySQL 的数据包大小限制限制了您可以发布到数据库的对象的大小，您可能需要更改 PHP 或 MySQL 上的一些配置以允许这样做。

您没有说明您使用的是哪个 PHP 扩展（MySQL 至少有三个），并且您没有显示用于将 blob 发布到数据库的任何代码。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-01-29T20:30:00.973

最好的答案是使用更好的实现，也可以解决这个问题。[你可以在这里](http://www.dreamwerx.net/phpforum/?id=1)阅读一篇文章。存储 10MB、1000MB 没关系。该实现将文件分块/切割成许多较小的部分并将它们存储在多行中。这有助于加载和获取，因此内存也不会成为问题。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-01-29T17:24:29.460

您可以使用 MySQL 的[LOAD_FILE 函数](http://dev.mysql.com/doc/refman/5.0/en/string-functions.html#function_load-file)来存储文件，但您仍然必须遵守 max_allowed_pa​​cket 值以及文件必须与 MySQL 实例位于同一服务器上的事实。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-29T17:18:49.767

你没有说你得到了什么错误（[`mysql_error()`](http://www.php.net/mysql_error)用来找出），但我怀疑你可能达到了最大数据包大小。

如果是这种情况，您需要[更改 MySQL 配置`max_allowed_packet`](http://www.vbulletin.com/forum/showthread.php?t=80745)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2015-06-06T16:35:13.450

> 你没有说你得到了什么错误（使用 mysql_error() 找出），但我怀疑你可能达到了最大数据包大小。
> 
> 如果是这种情况，您需要更改 MySQL 配置 max_allowed_pa​​cket

好吧，我有同样的问题。并且无法在“io模式”中通过chunck将数据输入mysql数据库

```
loop for : 
   read $data from file,
   write $data to blob
end loop
close file
close blob 
```

一种解决方案似乎是创建一个包含多部分 blob 的表，例如 create table data_details ( id int pk auto_increment, chunck_number int not null, dataPart blob ); ？？？

# java - 与 Java 小程序交互

> ID：492550
> 
> 赞同：2
> 
> 时间：2009-01-29T17:16:34.437
> 
> 标签：java, .net, applet

有谁知道是否可以通过.net 与 java 小程序进行交互？

编辑：我能够使用 UI 自动化框架来定位 Java 小程序，并从那里使用 OCR 读取数据并模拟鼠标/键盘输入到小程序中。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-29T23:37:28.740

您很可能可以使用可访问性 API 来做到这一点，这些 API 旨在让屏幕阅读器等与程序交互。看一下：

[http://en.wikipedia.org/wiki/Microsoft_UI_Automation](http://en.wikipedia.org/wiki/Microsoft_UI_Automation)

# iphone - EAGL：它到底代表什么？

> ID：492551
> 
> 赞同：17
> 
> 时间：2009-01-29T17:16:38.837
> 
> 标签：iphone, opengl-es

我忘记了，但 EAGL 是否代表任何特定的东西？或者它只是核心动画 OpenGL 命名约定的一部分（CAEAGLLayer 等）？

* * *

## 回答 #1

> 赞同：46
> 
> 时间：2009-01-29T17:53:59.073

“AGL”是 Apple 针对 OS X 的 OpenGL 扩展名。我相信“EAGL”是“Embedded AGL”或“ES AGL”的缩写。

或者，EAGL 是 Apple 的[EGL](http://en.wikipedia.org/wiki/EGL_(OpenGL))版本。“EGL”正式指的是“Khronos 原生平台图形接口”，但早期版本的规范将其称为“嵌入式系统图形库”。所以也许正确的答案是 EAGL 的意思是“嵌入式系统苹果图形库”。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-08-29T09:14:01.807

可能是 Apple 的嵌入式图形库

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2013-09-17T11:49:36.423

[http://db-in.com/blog/2011/02/khronos-egl-and-apple-eagl/](http://db-in.com/blog/2011/02/khronos-egl-and-apple-eagl/)

“..t EGL API 和 EAGL（Apple 实现的 EGL API）......”

# php - 如何使用 CakePHP APP 类从 URL 加载 XML 文件？

> ID：492556
> 
> 赞同：2
> 
> 时间：2009-01-29T17:17:42.937
> 
> 标签：php, xml, cakephp

我正在使用 CakePHP XmlHelper 来解析 XML 文件，例如：

```
App::import('Xml');
$file = "my_xml_file.xml";
$parsed_xml =& new XML($file); 
```

如何使用它从[http://www.site.com/file.xml等 URL 加载 XML 文件](http://www.site.com/file.xml)

谢谢！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-03T20:03:10.120

这很简单

```
App::import('Xml');
$url = "http://www.example.com/xml_file.xml";
$parsed_xml =& new XML($url); 
```

只是使用 URL 而不是文件，Cake 会在内部选择打开文件的方式

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-29T17:29:19.560

```
$contents = file_get_contents("http://www.site.com/file.xml");
$file = fopen("temp.xml", "rb");
fwrite($file, $contents);
fclose($file);
unset($contents)

App::import('Xml');
$file = "temp.xml";
$parsed_xml =& new XML($file); 
```

:)

# git - 从 Git 存储库中删除已从磁盘中删除的多个文件

> ID：492558
> 
> 赞同：1357
> 
> 时间：2009-01-29T17:18:14.777
> 
> 标签：git, git-commit, git-add, git-rm

我有一个 Git 存储库，我已从使用`rm`( **not** `git rm` ) 中删除了四个文件，我的 Git 状态如下所示：

```
#    deleted:    file1.txt
#    deleted:    file2.txt
#    deleted:    file3.txt
#    deleted:    file4.txt 
```

如何从 Git 中删除这些文件，而无需手动检查并添加每个文件，如下所示：

```
git rm file1 file2 file3 file4 
```

`git add .`理想情况下，如果可能的话，我正在寻找以相同方式工作的东西。

* * *

## 回答 #1

> 赞同：2341
> 
> 时间：2009-09-10T00:13:25.730

### 对于 Git 1.x

```
$ git add -u 
```

这告诉 git 自动暂存跟踪的文件——包括删除以前跟踪的文件。

### 对于 Git 2.0

暂存整个工作树：

```
$ git add -u :/ 
```

仅暂存当前路径：

```
$ git add -u . 
```

* * *

## 回答 #2

> 赞同：1381
> 
> 时间：2011-02-28T20:21:49.430

```
git ls-files --deleted -z | xargs -0 git rm 
```

可能是您正在寻找的东西..它对我有用..

* * *

## 回答 #3

> 赞同：744
> 
> 时间：2009-01-29T17:25:48.787

您可以使用

```
git add -u 
```

将删除的文件添加到暂存区，然后提交它们

```
git commit -m "Deleted files manually" 
```

* * *

## 回答 #4

> 赞同：360
> 
> 时间：2009-09-10T00:15:12.293

如果您只是运行：

```
git add -u 
```

git 将更新其索引以知道您已删除的文件实际上应该是下一次提交的一部分。然后您可以运行“git commit”来签入该更改。

或者，如果您运行：

```
git commit -a 
```

它将自动接受这些更改（以及任何其他更改）并提交它们。

*更新*：如果您只想添加已删除的文件，请尝试：

```
git ls-files --deleted -z | xargs -0 git rm
git commit 
```

* * *

## 回答 #5

> 赞同：169
> 
> 时间：2009-01-29T18:10:14.173

您可能正在寻找-A：

```
git add -A 
```

这类似于 git add -u，但也会添加新文件。这大致相当于 hg 的`addremove`命令（虽然移动检测是自动的）。

* * *

## 回答 #6

> 赞同：95
> 
> 时间：2011-11-26T10:34:06.133

仅暂存*已删除的*文件：

```
for x in $(git status | grep deleted | awk '{print $2}'); do git rm $x; done 
```

或者（xargs 方式）：

```
git status | awk '/deleted/ {print $2}' | xargs git rm 
```

您可以为您喜欢的命令集设置[别名](https://stackoverflow.com/questions/2553786/how-do-i-alias-commands-in-git)，以方便以后使用。

* * *

## 回答 #7

> 赞同：64
> 
> 时间：2009-09-10T00:13:29.777

```
git rm test.txt 
```

在您删除实际文件之前或之后。

* * *

## 回答 #8

> 赞同：50
> 
> 时间：2009-01-31T04:50:22.773

通过使用带有 '--all' 或 '--update' 选项的 git-add，你可能会得到比你想要的更多的东西。新的和/或修改过的文件也将被添加到索引中。当我想从 git 中删除已删除的文件而不触及其他文件时，我有一个 bash 别名设置：

```
alias grma='git ls-files --deleted -z | xargs -0 git rm' 
```

已从文件系统中删除的所有文件都将作为已删除添加到索引中。

* * *

## 回答 #9

> 赞同：41
> 
> 时间：2012-04-09T11:24:42.170

并不是说它真的很重要，但我不同意选择的答案：

```
git add -u 
```

... 如果工作树中的相应文件已被删除，则将从索引中删除文件，但它也会暂存已修改的跟踪文件的新内容。

```
git rm $(git ls-files --deleted) 
```

...另一方面，只会 rm 跟踪的已删除文件。

所以我认为后者是更好的选择。

* * *

## 回答 #10

> 赞同：31
> 
> 时间：2009-01-29T17:29:39.853

如果这些是唯一的变化，你可以简单地做

```
git commit -a 
```

提交所有更改。这将包括已删除的文件。

* * *

## 回答 #11

> 赞同：21
> 
> 时间：2012-10-01T19:36:48.733

```
git ls-files --deleted | xargs git rm 
```

是仅添加已删除文件的最佳选择。

这是其他一些选项。

```
git add .  => Add all (tracked and modified)/new files in the working tree.

git add -u => Add all modified/removed files which are tracked.

git add -A => Add all (tracked and modified)/(tracked and removed)/new files in the working tree.

git commit -a -m "commit message" - Add and commit modified/removed files which are tracked. 
```

* * *

## 回答 #12

> 赞同：18
> 
> 时间：2014-08-26T12:24:42.123

git 添加 -u

-u --update 只匹配索引中已经跟踪的文件而不是工作树。这意味着它永远不会暂存新文件，但它将暂存已修改的跟踪文件的新内容，并且如果工作树中的相应文件已被删除，它将从索引中删除文件。

如果没有给出，默认为“。”；换句话说，更新当前目录及其子目录中的所有跟踪文件。

* * *

## 回答 #13

> 赞同：14
> 
> 时间：2015-11-06T13:32:13.260

这个简单的解决方案对我来说很好：

```
git rm $(git ls-files --deleted) 
```

* * *

## 回答 #14

> 赞同：11
> 
> 时间：2012-07-25T20:47:58.067

如果你想将它添加到你的`.gitconfig`这样做：

```
[alias]
  rma = !git ls-files --deleted -z | xargs -0 git rm 
```

然后你所要做的就是运行：

```
git rma 
```

* * *

## 回答 #15

> 赞同：9
> 
> 时间：2014-01-04T20:34:56.423

```
git ls-files --deleted -z | xargs -0 git rm --cached 
```

这将删除之前由 git 跟踪的所有已删除文件，并处理文件名中包含空格的情况。

根据您的 POSIX 变体，您可能需要使用`xargs -0 -r`: 这将导致`xargs`在管道空内容时正常退出。

编辑：`--cached`和`--deleted`标志一起使用，以防止意外删除尚未删除的文件。

* * *

## 回答 #16

> 赞同：8
> 
> 时间：2018-12-10T08:19:17.227

```
git rm $(git ls-files -d) 
```

删除命令列出的所有文件`git ls-files`（-d 仅显示已删除的文件）。不适用于文件名或路径中有空格但易于记忆的文件

* * *

## 回答 #17

> 赞同：7
> 
> 时间：2015-03-09T15:05:17.987

告诉命令自动暂存已修改和删除的文件，但您没有告诉 Git 的新文件不受影响：

> -a --
> 全部

```
git add . && git commit -m -a "Your commit" 
```

或者

```
git add --all && git commit -m "Your commit" 
```

* * *

## 回答 #18

> 赞同：6
> 
> 时间：2012-02-21T18:43:33.530

如前所述

```
git add -u 
```

暂存已删除的文件以进行删除，同时还修改了文件以进行更新。

要取消暂存修改过的文件，您可以执行

```
git reset HEAD <path> 
```

如果你想保持你的提交有条理和干净。
***注意：****这也可以取消暂存已删除的文件，因此请小心使用这些通配符。*

* * *

## 回答 #19

> 赞同：6
> 
> 时间：2013-05-24T13:45:17.003

即使您有很多文件要处理，以下操作也将起作用：

```
git ls-files --deleted | xargs git rm 
```

您可能还想发表评论。

有关详细信息，请参阅： [有用的 Git 脚本](http://lexsheehan.blogspot.com/2013/05/useful-git-scripts.html)

* * *

## 回答 #20

> 赞同：6
> 
> 时间：2016-04-17T15:00:07.647

请使用`-t`查看实际运行的是哪个命令

我只是调整了 Virender 的答案来做同样的事情：

```
git ls-files --deleted -z | xargs -t -0 git rm 
```

* * *

## 回答 #21

> 赞同：5
> 
> 时间：2009-07-25T23:41:05.943

git-add 的任何标志都不会只暂存已删除的文件；如果您修改的只是已删除的文件，那么您很好，否则，您需要运行 git-status 并解析输出。

根据杰里米的回答，这就是我得到的：

```
git status |  sed -s "s/^.*deleted: //" | grep "\(\#\|commit\)" -v | xargs git rm 
```

1.  获取文件状态。
2.  对于已删除的文件，隔离文件名。
3.  删除所有以#s 开头的行，以及其中包含“已删除”一词的状态行；我不记得它到底是什么，而且它不再存在了，所以你可能需要针对不同的情况进行修改。我认为表达式分组可能是 GNU 特有的功能，所以如果您不使用 gnutils，则可能需要添加多`grep -v`行。
4.  将文件传递给`git rm`.

现在将其粘贴在 shell 别名中...

* * *

## 回答 #22

> 赞同：4
> 
> 时间：2014-08-05T14:40:38.460

```
git commit -m 'commit msg' $(git ls-files --deleted) 
```

在我删除文件后，这对我有用。

* * *

## 回答 #23

> 赞同：3
> 
> 时间：2011-11-15T14:29:42.397

我需要相同的并使用 git gui “stage changed”按钮。它还添加了所有内容。

在“阶段改变”之后，我做出了“承诺”......

所以我的工作目录又干净了。

* * *

## 回答 #24

> 赞同：3
> 
> 时间：2013-03-07T01:29:28.253

您只能用于`git add -u <filenames>`暂存已删除的文件。

例如，如果您删除了文件`templates/*.tpl`，则使用`git add -u templates/*.tpl`.

`-u`为了引用存储库中存在但不再存在于工作目录中的文件，这是必需的。否则，默认`git add`为在工作目录中查找文件，如果您指定已在该目录中删除的文件，则不会找到它们。

* * *

## 回答 #25

> 赞同：2
> 
> 时间：2014-02-19T12:16:55.400

添加用于暂存已删除文件的系统别名作为命令`rm-all`

UNIX `alias rm-all='git rm $(git ls-files --deleted)'`

视窗 `doskey rm-all=bash -c "git rm $(git ls-files --deleted)"`

*笔记*

*Windows 需要已`bash`安装。*

* * *

## 回答 #26

> 赞同：2
> 
> 时间：2016-11-23T10:32:10.720

（另一种变体）

我想从磁盘文件中删除所有已删除的文件，但从一个特定文件夹中删除，而其他文件夹保持不变。以下对我有用：

```
git ls-files --deleted  | grep <folder-name> | xargs git rm 
```

* * *

## 回答 #27

> 赞同：1
> 
> 时间：2009-01-29T17:28:52.820

就像是

```
git status | sed -s "s/^.*deleted: //" | xargs git rm 
```

可以做到。

* * *

## 回答 #28

> 赞同：1
> 
> 时间：2014-02-04T15:34:59.457

对于视觉工作室项目

```
'git ls-files --deleted | sed 's/(.*)/"\1"/'| xargs git rm' 
```

当删除的文件路径有空间时，这很有用

* * *

## 回答 #29

> 赞同：0
> 
> 时间：2021-02-02T08:55:46.740

简直了

```
git add . && git commit -m "the message for commit" && git push 
```

* * *

## 回答 #30

> 赞同：0
> 
> 时间：2021-12-09T13:33:11.373

### 从 Repo 中删除所有以 .log 结尾的文件，但不删除本地存储

`git rm --cached $(git ls-files | grep "\.log$")`

* * *

## 回答 #31

> 赞同：-1
> 
> 时间：2012-10-03T14:28:18.240

迄今为止我发现的最灵活的解决方案是

```
git cola 
```

并选择我要暂存的所有已删除文件。

（请注意，我通常在 git 中执行所有命令行操作，但 git 处理删除的文件有点尴尬）。

# cocoa-touch - 单个 UiTableView 中有多个 UiTableViewCell 子类？为什么这段代码不起作用

> ID：492559
> 
> 赞同：4
> 
> 时间：2009-01-29T17:18:20.503
> 
> 标签：cocoa-touch

好的，这是我的问题。我有一个表格，有点像 Apple 的 addressBook.app，它使用不同的单元格子类以不同的方式显示信息。在这个特定的应用程序中，我有 3 个不同的 UiTableViewCell 子类，它们都有自己的 nib。

我无法正确获取代码:-(如果我尝试在 CellForRowPath 方法中访问我的单元格的实例变量，它会说'（对成员'类型'的错误请求不是结构或联合'）现在我假设“某事”这个词是我问题的根源。我要粘贴的代码显然没有正确设置我的单元格。这是代码：

根据被调用的部分，有 3 个 if 语句可以获取正确的单元格子类：

```
- (UITableViewCell *)tableView:(UITableView *)tableView cellForRowAtIndexPath:(NSIndexPath *)indexPath {

static NSString *PoolFacilityCellIdentifier = @"PoolFacilityCellIdentifier";
static NSString *PoolFacilityAddressCellIdentifier = @"PoolFacilityAddressCellIdentifier";
static NSString *PoolFacilityPoolCellIdentifier = @"PoolFacilityPoolCellIdentifier";
NSUInteger section = indexPath.section;

//Creat a generic container for cell which will be cast during one of the next two statements
id cell;

//Change the identifier depending on cell type. MIGHT NEED TO ADD SOMETHING ELSE FOR POOLS AND PRICES
if (section == KAddressIndex) {
    cell = (PoolFacilityAddressCell *)[tableView dequeueReusableCellWithIdentifier:PoolFacilityAddressCellIdentifier];

    if (cell == nil) {

        //Load the appropriate nib for the type of cell being asked for.

            NSArray *nib = [[NSBundle mainBundle] loadNibNamed:@"PoolFacilityAddressCell" owner:self options:nil];

            for (id object in nib) {

                if ([object isMemberOfClass:[PoolFacilityAddressCell class]]) 
                    cell = (PoolFacilityAddressCell *) object;

            }
    }

}
else if (section == KPoolIndex) {
    cell = (PoolFacilityPoolCell *)[tableView dequeueReusableCellWithIdentifier:PoolFacilityPoolCellIdentifier];

    if (cell == nil) {

        //Load the appropriate nib for the type of cell being asked for.

        NSArray *nib = [[NSBundle mainBundle] loadNibNamed:@"PoolFacilityPoolCell" owner:self options:nil];

        for (id object in nib) {

            if ([object isMemberOfClass:[PoolFacilityPoolCell class]]) 
                cell = (PoolFacilityPoolCell *) object;

        }
    }
}
else {
    cell = (PoolFacilityCell *)[tableView dequeueReusableCellWithIdentifier:PoolFacilityCellIdentifier];

    if (cell == nil) {

        //Load the appropriate nib for the type of cell being asked for.

        NSArray *nib = [[NSBundle mainBundle] loadNibNamed:@"PoolFacilityCell" owner:self options:nil];

        for (id object in nib) {

            if ([object isMemberOfClass:[PoolFacilityCell class]]) 
                cell = (PoolFacilityCell *) object;
        }
    }

} 
```

任何帮助将不胜感激！！！我为我的单元子类导入所有头文件。

引发我的错误的代码是这个（特别是 cell.type.text = thePool.type）cell.type 是一个 Iboutlet UiLabel：

```
if (section == KPoolIndex) {

    NSMutableArray *thePools = [allSections objectForKey:sectionAsNumber];

    if ([thePools count] > 0) {
        [cell setPromptMode:NO];
        //Set the label and Pool from the Pool Object
        Pool *thePool = [thePools objectAtIndex:row];
        cell.type.text = thePool.type;

    }

} 
```

谢谢，

担

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-29T18:32:14.907

Matt Gallagher 有一篇文章提出了一种更简洁的方法来完成这种类型的表格。他将单元格特定代码分解为它们自己的类。使其更易于管理。

[cocoawithlove.com - UITableViewController 中的异构单元格](http://cocoawithlove.com/2008/12/heterogeneous-cells-in.html)

在您的代码中，这一行看起来很麻烦

```
cell.type.text = thePool.type; 
```

thePool 是一个“Pool”对象，它有一个名为“type”的属性吗？检查 @property 和 @synthesize 是否为“池”对象中的“类型”正确设置。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-29T19:54:07.100

我相信这可能是由于您的单元格被声明为 id 并且您试图访问您的单元格子类之一的**属性。**您可以将所需的所有**消息**发送到 id 类型的对象，但尝试访问 id 类型的对象的属性将在编译时失败。此外，请务必导入包含您的子类的 .h 文件。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-29T19:59:09.163

对于我自己的问题，我可能有几个答案：

1 - 如前所述，单元格仍然是 ID 类型。我认为我的以下 if 函数会将单元格类型转换为特定的单元格类型，但似乎并非如此。

2 - 一种解决方案是为每种类型的单元格设置 3 个大的 if 语句。每个以 a 结尾的 if 语句

返回单元格；

称呼。

3 - 我现在要尝试的解决方案是只有一个单元子类而不是 3，并且在我的单元子类中有一个名为的方法

-(void)setCellBehaviour:(int)definedNumber

这样我就可以隐藏图层/标签等并按照我的意愿自定义它。

**更新**

我已经达到了这样的要求结果：

我只有一个单元子类，它有一个带有许多不同 UIlabels 的 NIB。

一旦单元格被分配/初始化，我在我的 uiviewcontroller 的 cellForRowAtIndexPath: 方法中调用它。

```
//Set the behaviour
    [cell setCellBehaviour:KCellBehaviourName]; 
```

这引用了我在视图控制器的头文件中设置的定义：

```
//Definitions for cell type behaviour. Passed to cell during creation. 
```

(HASH)define KCellBehaviourStandard 0 (HASH)define KCellBehaviourName 1 (HASH)define KCellBehaviourAddress 2 (HASH)define KCellBehaviourPool 3

（似乎不能在这篇文章中做散列）

然后我的 UITableViewCellSubclass 有我们之前调用的这个方法：

```
-(void)setCellBehaviour:(NSUInteger)definedBehaviour {

switch (definedBehaviour) {
    case KCellBehaviourStandard:
        self.label.hidden = NO;
        self.value.hidden = NO;
        self.length.hidden = YES;
        self.poolType.hidden = YES;
        break;
    case KCellBehaviourName:
        self.label.hidden = NO;
        self.value.hidden = NO;
        self.length.hidden = YES;
        self.poolType.hidden = NO;
        break;
    case KCellBehaviourAddress:
        self.label.hidden = NO;
        self.value.hidden = NO;
        self.length.hidden = YES;
        self.poolType.hidden = YES;
        break;
    case KCellBehaviourPool:
        self.label.hidden = NO;
        self.value.hidden = NO;
        self.length.hidden = NO;
        self.poolType.hidden = YES;
    default:
        break;
} 
```

}

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-04T09:09:26.570

哦，天哪，这比所有答案都简单得多。我不会讨论你的整体设计，只关注你的代码为什么不起作用。

这是触发错误的行：

```
cell.type.text = thePool.type; 
```

您可以通过用以下几行替换它来修复它：

```
PoolFacilityCell* poolCell = (PoolFacilityCell *)cell;
poolCell.type.text = thePool.type; 
```

仅当编译器知道您正在使用什么类时，用于访问属性的点语法才有效。它无法处理，`cell.type`因为`cell`它被声明为 type `id`，所以在编译时它不知道它`type`应该是一个 Objective-C 属性。错误消息称它为“不是结构或联合的东西”，因为它认为您正在`cell`像普通 C 结构一样对待，但事实并非如此，因此出现了错误。

顺便说一句，你写的行：

```
cell = (PoolFacilityAddressCell *) object; 
```

是没有意义的。由于`cell`被声明为`id`（任何通用对象），因此不需要强制转换。根据较早的评论，您似乎认为这样的类型转换会以`cell`某种方式影响变量。它不是。上面的行编译成指令，简单地将实例的内存地址从 复制`object`到`cell`。类型转换是为了避免在编译时出现警告和错误。

# sql - Oracle：将子查询中的多个结果组合成一个逗号分隔值

> ID：492563
> 
> 赞同：10
> 
> 时间：2009-01-29T17:19:42.840
> 
> 标签：sql, oracle, subquery, string-aggregation

我正在尝试将单列子查询转换为以命令分隔`VARCHAR`的类型的值列表。

这与[此问题](https://stackoverflow.com/questions/111341/combine-multiple-results-in-a-subquery-into-a-single-comma-separated-value)相同，但适用于 Oracle 而不是 SQL Server 或 MySQL。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-01-29T19:19:57.993

在 Tim Hall 的网站上有一个很好的关于[可用字符串聚合技术的总结。](http://www.oracle-base.com/articles/10g/StringAggregationTechniques.php)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-29T17:49:47.943

我发现这似乎有效。想法？

```
SELECT SUBSTR (c, 2) concatenated
  FROM (SELECT     SYS_CONNECT_BY_PATH ( myfield, ',') c, r
              FROM (SELECT   ROWNUM ID, myfield,
                             RANK () OVER (ORDER BY ROWID DESC) r
                        FROM mytable
                    ORDER BY myfield)
        START WITH ID = 1
        CONNECT BY PRIOR ID = ID - 1)
 WHERE r = 1; 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2010-02-03T15:30:40.370

11.2 引入了[LISTAGG](http://download.oracle.com/docs/cd/E11882_01/server.112/e10592/functions087.htm#SQLRF30030)，与 WM_CONCAT 不同的是，它被记录在案。我们还没有使用 11.2，所以我们使用自定义聚合函数。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-08-25T19:44:10.667

SELECT deptno, wm_concat(ename) AS employees FROM emp GROUP BY deptno;

参考： http://forums.oracle.com/forums/thread.jspa?messageID=1186901& [#1186901](http://forums.oracle.com/forums/thread.jspa?messageID=1186901&#1186901)

# java - 使用 JNA 链接到自定义 dll

> ID：492567
> 
> 赞同：11
> 
> 时间：2009-01-29T17:20:46.627
> 
> 标签：java, dll, jna

如何使用 JNA 访问自定义 .lib / .dll 函数？有人可以提供一个例子吗？

谢谢你。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-01-29T19:40:41.043

示例（[来自维基百科](http://en.wikipedia.org/wiki/Java_Native_Access#Example)）：

```
import com.sun.jna.win32.StdCallLibrary;
import com.sun.jna.Native;

/** Simple example of Windows native library declaration and usage. */
public class BeepExample {
   public interface Kernel32 extends StdCallLibrary {
       // FREQUENCY is expressed in hertz and ranges from 37 to 32767
       // DURATION is expressed in milliseconds
       public boolean Beep(int FREQUENCY, int DURATION);
       public void Sleep(int DURATION);
   }
   public static void main(String[] args) {
    Kernel32 lib = (Kernel32) Native.loadLibrary("kernel32", 
           Kernel32.class);
    lib.Beep(698, 500);
    lib.Sleep(500);
    lib.Beep(698, 500);
   }
} 
```

在这种情况下，我们从“kernel32.dll”库中加载它。我希望这使 JNA 更清晰。

编辑：我将解释代码：您需要使用库中所需的功能定义一个接口（扩展 com.sun.jna.Library）。然后，调用 com.sun.jna.Native.loadLibrary("LibraryName", InterfaceName.class)。最后，将输出存储在具有接口类型的变量中。只需从该变量调用函数。

# javascript - 如何从 iframe 刷新父窗口？

> ID：492573
> 
> 赞同：10
> 
> 时间：2009-01-29T17:22:23.893
> 
> 标签：javascript, iframe

我在该页面中有一个父页面和一个 iframe。父级中的链接控制在​​ iframe 中加载的页面。我想要做的是在加载 iframe 时刷新父页面。我在 iframe 中有这个：

```
RefreshParent(){
    parent.location.reload();
}

<body onload="RefreshParent();"> 
```

但是，上面的代码会刷新整个父页面以及其中的 iframe，从而重新加载父页面并进入无限循环。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-01-29T17:26:32.997

如果不重新加载 iframe，您将无法刷新父页面。

您可以做的是使用[AJAX](http://en.wikipedia.org/wiki/AJAX)来更新父级的内容，但这可能是相当多的工作（使用 jQuery 或 Prototype 框架会更容易）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2011-07-19T12:13:53.240

您也不需要使用 ajax 技术。您可以简单地从父页面的 iframe 中包含的页面调用父页面中的 javascript 函数。这样您就可以轻松地在父页面上执行操作。[如何在不影响 iframe 的情况下从 iframe 中的页面部分刷新父页面](http://dotnetspidor.blogspot.com/2011/07/refresh-parent-page-partially-from.html)说明了如何。

希望这可以帮助。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-29T17:27:03.417

您不能告诉父窗口刷新并排除其自身页面的任何部分，包括其中包含的 iframe。不过，您可以使用 AJAX 技术来做到这一点。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2014-03-28T13:13:34.303

只要您在同一个域上，您就可以使用以下内容：

```
window.parent.location = window.parent.location + '?parent-updated=true' 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-29T18:47:27.110

您需要让 iframe 成为“常规”框架，以便在刷新页面的另一部分时保留它。由于 iframe 在技术上是父框架的一部分（毕竟它是内联框架），刷新父框架也会重新加载 iframe 内容。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-29T19:02:39.887

取决于您的布局是什么，但正如其他帖子所观察到的，您无法在不刷新 iframe 本身的情况下刷新父框架，因为它是页面的一部分。

如果您不想使用 ajax，并且布局允许，一种解决方案是将父框架的内容放在 iframe 本身中。然后，您可以告诉父页面在加载 iframe 时刷新包含“父内容”的 iframe。如果您的“父”iframe 是无边界的并且没有滚动，那么这对用户来说都是透明的。

您可以将这种技术推广到父内容的几个 iframe，它可以比 ajax 更快更简单地实现，除此之外，您也可以硬着头皮实现 ajax 解决方案。

# xpath - 如何使用 libxml 连续应用两个 xpath 表达式？

> ID：492577
> 
> 赞同：2
> 
> 时间：2009-01-29T17:23:30.973
> 
> 标签：xpath, libxml2

总而言之，我完全是 libxml 的初学者，我必须使用现有的源代码。主要思想是应用第一个 xpath 表达式从 xml 文件中提取一组节点。然后，对于每个节点，应应用第二个 xpath 表达式来提取一些值。

现有的源代码是：

```
int xt_parseXmlResult(xmlDocPtr doc, const char *xpath, assoc_arrayc_t expr, arrayc_t *result)
{
    xmlXPathContextPtr xpathCtx = xmlXPathNewContext(doc);

    // Register namespaces ...

    /*
     * Evaluate main xpath expression
     */
    xmlXPathObjectPtr xpathNodes = xmlXPathEvalExpression((xmlChar *)xpath, xpathCtx);

    /*
     * Now we apply the xpath expressions on each node returned by the first xpath request
     */
    // First loop is on the XML document as we have to create a new context each
    // time we change the document
    int nbDocs = xpathNodes->nodesetval->nodeNr;

    for (row = 0; row < nbDocs; row++)
    {
        xmlXPathContextPtr  subCtx = xmlXPathNewContext(doc);

        // Register namespaces ...

        // Update context to use the nodeset related to this row
        subCtx->node = xpathNodes->nodesetval->nodeTab[row];

        for (col = 0; col < expr.nbItems; col++)
        {
            // Evaluate expression
            xpathRows = xmlXPathEvalExpression((xmlChar *)expr.itemList[col].val, subCtx);

            result->data[(row + 1) * result->nbCols + col] = strdup((char *)xmlXPathCastToString(xpathRows)); 
            xmlXPathFreeObject(xpathRows);
        }
        xmlXPathFreeContext(subCtx);
        subCtx = NULL;
    }

    xmlFreeDoc(doc); 
    xmlXPathFreeContext(xpathCtx);
    xmlXPathFreeObject(xpathNodes);
    return 0;
} 
```

我认为问题出在这条线上

```
 // Update context to use the nodeset related to this row
subCtx->node = xpathNodes->nodesetval->nodeTab[row]; 
```

因为第二个 xpath 表达式是从 xml 文件的根目录应用的，而不是每个节点的根目录。

关于如何做这样的事情的任何想法？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-29T17:32:56.353

你可以连接你的 xpath 表达式。

*编辑*

//FORECAST/DAY/descendant::content/meteo/desc 应该可以工作

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-02-07T11:01:25.610

正如我在 xmlXPathContext::node 中看到的，它是供内部库使用的，所以我们不能使用它

xmlXPtrNewContext 可能会有所帮助，但我无法使用它。

我目前通过连接两个 xpath 并查询整体来做到这一点。新的 xpath 是："(" + xpath1 + ")" + "[num]" + xpath2。其中 num 可以替换为 1 和 xpath1 结果集大小之间的任何数字。它似乎有效。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-29T19:03:16.467

一些示例代码。修改以适合您的需求和语言。这是 C#，但应该大致相同。请注意，第二个 xpath 不是以“/”开头的，而是使用从第一个返回的节点的实例。两个 xpath 都不以“/”结尾。

```
XmlDocument doc = new XmlDocument();
doc.Load(docfile);
XmlNodeList items = doc.SelectNodes("/part1/part2");
foreach (item in items)
{
    XMLNode x = item.SelectNodes("part3");
    //Dostuff
} 
```

# jquery - jQuery 和闭包

> ID：492580
> 
> 赞同：1
> 
> 时间：2009-01-29T17:23:52.643
> 
> 标签：jquery, events, function, arguments, traversal

我的页面上有一个多个菜单，它们都使用相同的鼠标悬停和单击事件，所以我决定将它放入一个函数中。然而 vars 似乎总是被分配给 hover(function, function) 函数的最后一个参数。

```
$(document).ready( function() {
menuMouseOver = function() {
    for(i=0, u=arguments.length; i<u; i++){
        var parent = arguments[i].parent;
        var active = arguments[i].active;
        var childSelect = arguments[i].childSelect;
        console.log(active); //logs the correct active
            $(parent).children(childSelect)
                .not('.'+active).each( function(i, e) {console.log(active);})
 //The above console.log logs the correct active 
                    .hover( function() {
                            console.log(active); //this one always logs menu2_active
                            $(this).addClass(active);
                        }, function() {
                            $(this).removeClass(active);
                        });
    }
}
menuMouseOver( { parent: '#menu1',
                active: 'menu1_active',
                childSelect: ':gt(0)'},
            { parent: '#menu2',
                active: 'menu2_active',
                childSelect: ':gt(0)'});
}); 
```

为什么最后一个console.log 将始终记录最后一个*活动*而不是属于arguments[i].active 的那个。（在这个例子中，它总是记录参数 [1].active 的*活动*）我做错了什么？

此外，实际功能更复杂，但此变体中也存在问题。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-29T18:05:42.387

JavaScript 没有块作用域，因此您在 for 循环中声明的那些变量的值在每次迭代时都会更改，并且所有这些函数都引用相同的变量。诀窍是在 for 循环中创建一个新的函数范围，以便在该迭代期间绑定您声明的变量。

您可以通过在循环内执行匿名函数来完成此操作：

```
menuMouseOver = function() {
    for(i=0, u=arguments.length; i<u; i++){
      (function(){ // anonymous function to create new scope
        var parent = arguments[i].parent;
        var active = arguments[i].active;
        var childSelect = arguments[i].childSelect;
        console.log(active); //logs the correct active
            $(parent).children(childSelect)
                .not('.'+active).each( function(i, e) {console.log(active);})
 //The above console.log logs the correct active 
                    .hover( function() {
                            console.log(active); //this one always logs menu2_active
                            $(this).addClass(active);
                        }, function() {
                            $(this).removeClass(active);
                        });
       })(); // execute the anonymous function
    }
} 
```

就像你以前的方式一样，所有函数都关闭了相同的变量引用，因此使用了最后一个值，而不是创建函数时的值。使用函数范围将使其行为符合您的预期。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-29T17:40:38.087

您的问题是**悬停事件**发生在执行方法的范围之外。因此，当悬停执行您的活动变量时，您的*活动*变量已经通过了整个集合并停留在最后一个元素的活动状态。所以你看到了这个问题，因为最后一个日志是一个事件，它超出了范围，而另外两个在循环的范围内。

试试这个：

```
 $(parent).children(childSelect)
            .not('.'+active).each( function(i, e) {
                console.log(active);
                $(this).data("active", active);
            })
            .hover( function() {
                $(this).addClass($(this).data("active"));
            }, function() {
                $(this).removeClass($(this).data("active")));
            }); 
```

这实际上会将“活动”值存储在 DOM 元素内，以便可以在范围内访问它。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-29T18:04:27.867

我正在绞尽脑汁，因为这是一个奇怪的问题，但我稍微重构了函数，可能有用（哦，同时有人更聪明地回答了）：

```
$("#menu1,#menu2").each(function(){
    var id = $(this).attr("id");
    $(">li",this).not("."+id+"_active,:eq(0)").hover(function(){
        $(this).addClass(id+"_active");
    },function(){
        $(this).removeClass(id+"_active");
    });
}); 
```

# windows - 如何在项目构建时检测 Windows 服务

> ID：492587
> 
> 赞同：0
> 
> 时间：2009-01-29T17:25:10.613
> 
> 标签：windows, winforms, build, service

我正在开发一个包含 Windows 服务和与该服务交互的 WinForms 客户端的解决方案。

在我的预构建和构建后事件中，我有一些命令来启动`net start`和`net stop`停止服务，但有时这会导致问题（未找到文件、服务已停止等）。

**有没有办法在发布之前测试服务是否正在运行或安装`net start?`**

我想将此测试放在 .cmd 文件中并在项目的预构建事件中运行它。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-29T17:28:53.413

您实际上不需要每次都安装、启动和停止服务。相反，请考虑将命令行键添加到您的服务可执行文件，以便在指定时作为服务运行（即执行通常的 ServiceBase.Run() 内容），并且当此键不存在时，它作为常规控制台运行应用。您将获得一个额外的好处，即能够将记录器输出直接转储到控制台，从而使调试变得更加容易。

```
if(args.GetLength(0) == 1 && args[0].ToUpper() == "/SERVICE")
{
    ServiceBase[] services = new ServiceBase[] { new MyService() };
    ServiceBase.Run(services);        
} // if
else
{
    InitAndStartWhateverIsNecessaryToRunServer();
    Console.ReadLine();    
} // else 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-29T17:34:32.433

将其粘贴到 vb 脚本文件中并添加到构建前和构建后事件中。

```
strComputer = "."
Set objWMIService = GetObject("winmgmts:{impersonationLevel=impersonate}!\\" & strComputer & "\root\cimv2")
Set colRunningServices = objWMIService.ExecQuery _
             ("SELECT * FROM Win32_Service WHERE Name = 'someService'") 
Set objService = colRunningServices(0) 
If objService.State <> "Running" And objService.State <> "Starting" Then
  objService.StartService()
End If 
```

# c# - 如何获取调用方法的参数值？

> ID：492600
> 
> 赞同：22
> 
> 时间：2009-01-29T17:27:50.967
> 
> 标签：c#, reflection, dynamic

## 问题

我正在编写一些代码，这些代码需要能够从调用类的方法中获取参数的**值。**我知道如何一直到 ParameterInfo[] 数组，但我不知道如何获取这些值。这甚至可能吗？

如果是，我认为它与使用 MethodInfo 对象中的 MethodBody 属性有关，它允许您检查 IL 流，包括属性，但我不知道该怎么做，我还没有找到Google 上的适用代码。

## 代码

```
// Finds calling method from class that called into this one
public class SomeClass
{
    public static void FindMethod()
    {
        for (int i = 1; i < frameCount; i++)
        {
            var frame = new StackFrame(i);
            var methodInfo = frame.GetMethod();
            if (methodInfo.DeclaringType != this.GetType())
            {
                string methodName = frame.GetMethod().Name;
                var paramInfos = methodInfo.GetParameters();

                // Now what?? How do I get the values from the paramInfos

                break;
            }
            else if (i == frameCount - 1)
            {
                throw new TransportException("Couldn't find method name");
            }
        }
    }
} 
```

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-01-29T17:41:59.003

如果不自己自省堆栈，您就无法做到这一点（这很脆弱，因为许多优化可能意味着堆栈帧不是您所期望的，或者甚至传递的参数实际上不是方法签名所暗示的（这完全有可能一个优化的 JIT 编译器，以发现您仅使用对象/结构的子字段并传递它）。

ParameterInfo 只是告诉您编译时方法的*签名*，而不是传递的值。

自动实现这一点的唯一现实方法是通过代码注入（通过 AOP 之类的东西）来创建数据并根据分析 IL 来做你想做的事情。

这通常不是一个好主意，如果您需要调试某些东西，请使用调试器，如果您需要记录某些内容，请明确说明您正在记录的内容。

需要明确的是，简单的反思技术**不能**完全概括地实现你想要的

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-29T17:40:48.397

Microsoft 的 Jonathan Keljo 在[此新闻组帖子](http://groups.google.com/group/microsoft.public.dotnet.framework.clr/tree/browse_frm/thread/c17adcb277967565/b66c524f39aa4030?hl=en&rnum=1&_done=%2Fgroup%2Fmicrosoft.public.dotnet.framework.clr%2Fbrowse_frm%2Fthread%2Fc17adcb277967565%3Fhl%3Den%26lr%3D%26ie%3DUTF-8%26oe%3DUTF-8%26rnum%3D7%26prev%3D%252Fgroups%253Fhl%253Den%2526lr%253D%2526ie%253DUTF-8%2526oe%253DUTF-8%2526q%253DStackTrace%252Bclass%252BValue%26#doc_71890d2ce5924b0d "显示异常堆栈跟踪")中说：

> 不幸的是，今天从调用堆栈中获取参数信息的唯一简单方法是使用调试器。如果您尝试将此作为应用程序中错误记录的一部分，并且您计划将错误日志发送回您的支持部门，我们希望您将来可以为此目的使用小型转储。（今天，使用托管代码的小型转储有点问题，因为它没有包含足够的信息，甚至默认情况下都无法获得堆栈跟踪。带有堆的小型转储更好，但如果你知道我的意思，它就不是那么“迷你”了。）
> 
> 纯粹主义者会说，允许人们编写可以从调用堆栈上其他地方的函数获取参数的代码将鼓励他们打破封装并创建在面对变化时非常脆弱的代码。（您的场景没有这个特殊问题，但我听说过其他对此功能的请求。无论如何，这些请求中的大多数都可以通过其他方式解决，例如使用线程存储。）但是，更重要的是会有安全隐患其中——允许插件的应用程序将面临这些插件从堆栈中获取敏感信息的风险。我们当然可以将该功能标记为需要完全信任，但这会使它在我听说过的几乎所有场景中都无法使用。
> 
> 乔纳森

所以......我想简短的回答是“我不能”。太糟糕了。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2011-05-22T18:25:12.390

是的，你可以这样做。

您需要做的是使用 IL 反汇编程序（可在 System.Reflection.Emit 命名空间中实现）来查找包含您要查找的参数值的操作数。

从这个 SO 问题开始：[C# 反射和查找所有引用](https://stackoverflow.com/questions/5490025/c-reflection-and-find-all-references)

然后使用答案中提到的类（来自 Mono.Reflection）进行检查。像这样的东西：

```
 var instructions = method.GetInstructions();
            foreach (var instruction in instructions)
            {
                var methodInfo = instruction.Operand as MethodInfo;
                if(methodInfo == null)
                {
                    continue;
                }
                if (instruction.OpCode.Name.Equals("call") && methodInfo.Name.Equals("YourMethodHere"))
                {
                    var value = (CastToMyType)instruction.Previous.Operand;
                    // Now you have the value...
                }
            } 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-29T17:33:31.953

你不能用 StackFrame 或 StackTrace 来做到这一点。但是，您可以使用一些拦截框架（例如 Spring.NET 中的 AOP 东西），以便您可以获取参数值。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-29T17:43:02.853

看这里：

[您可以在 C# 中获取堆栈上的变量列表吗？](https://stackoverflow.com/questions/376256/can-you-get-a-list-of-variables-on-the-stack-in-c)

根据那里对我的回答的所有评论，我认为这是不可能的。PropertyInfo 类确实有一个 GetValue 方法，但这需要您拥有一个要从中获取值的实际对象。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2020-09-07T19:50:57.860

不确定这是否算作一个解决方案，但适用于我所拥有的特定情况，我想在每次修改浮点数时以最少的代码更改进行记录，

读取堆栈跟踪行上的文件以找出参数

```
public static Score operator +(Score x,float y) {
    var st = new StackTrace(true);
    var sf = st.GetFrame(1);                
    string paramName = File.ReadLines(sf.GetFileName()).ElementAtOrDefault(sf.GetFileLineNumber()-1).Split(new[] { "+=" }, StringSplitOptions.None)[1];

    x.DebugString += (paramName+" "+y);
    x.DebugString += System.Environment.NewLine;

    x.val += y;
    return x;
}

void Main(){
    Score score = new Score();
    float firstScore = 2;
    float secondScore = -13;
    score+=firstScore;
    score+=secondScore;
    Console.WriteLine(score.DebugString);
}

Output : 
firstscore  2
secondScore -13 
```

# delphi - 为什么我的程序在 Vista 64 上找不到它的 DLL？

> ID：492611
> 
> 赞同：10
> 
> 时间：2009-01-29T17:29:32.960
> 
> 标签：delphi, dll, windows-vista, 64-bit

我最近买了一台新笔记本电脑。不幸的是，它是随 Vista 一起提供的。让它工作起来是一大麻烦，而且 comp 有没有 XP 驱动程序的硬件组件，所以我不能“升级”到实际工作的操作系统。我大部分时间都在工作，但是一个特别奇怪的问题让我很难过。

我安装了 Delphi 并尝试构建一个项目。它编译，但不会运行。“此应用程序无法启动，因为未找到 sdl.dll。” 很公平。所以我抓起 SDL.dll 并将其放入`C:\windows\system32`文件夹中。（使用 Vista 64 位家庭高级版。不过，这是一个 32 位 dll，所以我把它放在 32 文件夹而不是 64 文件夹中。）

再次点击运行。同样的问题。但为什么？这就是它的去向，对吧？并且`C:\windows\system32`在系统路径中。有谁知道为什么它不能链接到DLL？

（是的，我知道我可以通过将 DLL 与 .exe 放在同一个文件夹中来解决这个问题。我目前正在这样做作为一种解决方法。但从长远来看，这是一个坏主意，因为我有少数几个都需要 SDL 的不同项目。）

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2009-01-29T17:34:42.933

这不是 Vista 问题，而是 64 位 Windows 问题：*System32*的名称确实令人困惑，但这实际上是系统（64 位）DLL 所在的文件夹。

所以在任何 64 位版本的 Windows 上...

...所有**64 位**系统 DLL 都位于 C:\Windows\ **System32**中。

...所有**32 位**系统 DLL 都位于 C:\Windows\ **SysWOW64**中。

该名称来自**W** indows on **W** **indows** 64 **(** WOW64 [)](http://en.wikipedia.org/wiki/WOW64) ，它是允许 32 位应用程序使用本机 64 位系统资源的转换层的名称。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-01-29T19:22:53.387

[Raymond Chen 最近解决了32 位系统目录在 64 位 Windows 上奇怪](http://blogs.msdn.com/oldnewthing/archive/2008/12/22/9244582.aspx)的基本原因。该条目的第一段确实是理解隔离 32 位目录背后原因的关键：

> 在 64 位 Windows 上，32 位程序在仿真层中运行……如果 32 位程序尝试查看系统，它将看到 32 位系统。

我认为您必须拥有单独的目录才能使这些东西全部分开并正常工作。[当您认为WOW64](http://en.wikipedia.org/wiki/WOW64)表示 Windows On Windows 64 位（即上面提到的仿真器的名称）时，文件所在目录的 SysWOW64 看似违反直觉的名称更有意义。

# sql - 使用 SQL CASE 语句动态更改要从中选择的表

> ID：492613
> 
> 赞同：9
> 
> 时间：2009-01-29T17:30:52.770
> 
> 标签：sql, sql-server, dynamic-sql

我正在尝试编写一个存储过程，并根据某个列值，我希望能够更改我从中选择的表。我将尝试举一个例子：

```
SELECT ItemNumber,
       ItemType, 
       Description
FROM

CASE ItemType
WHEN 'A' THEN TableA
ELSE TableB
END

WHERE 

CASE ItemType
WHEN 'A' THEN ItemNumber = @itemNumber
ELSE PartNumber = @itemNumber
END 
```

如您所见，我不仅动态更改了我从中选择的表，而且由于这两个表是由两个不同的人在两个不同的时间制作的，所以列名也不同。

所以，我的问题是：什么是完成此任务的最佳方法，因为 SQL Server 似乎不喜欢我构建的查询。

如果有人看到我正在尝试做的事情可以提出更好的方法来做到这一点，我会全神贯注:-)

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-29T18:02:44.517

您不能在 FROM 子句中使用 CASE 语句，但可以使用以下语句：

```
SELECT itemnumber, itemtype, description
  FROM tablea
 WHERE itemnumber = @itemnumber AND itemtype = 'A'
UNION ALL
SELECT itemnumber, itemtype, description
  FROM tableb
 WHERE partnumber = @itemnumber AND itemtype <> 'A' 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-29T17:35:18.300

您可以尝试将动态 SQL 语句构建为字符串，然后调用 sp_executesql 存储过程来执行该字符串。

有关更多信息和示例，请参见[此处](http://www.mssqltips.com/tip.asp?tip=1160)。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-29T18:42:36.307

我不确定你为什么要在一个 SQL 语句中做事.. 我不是 SQL Server 人员，但在 Oracle 存储过程中你可以写这样的东西

```
If itemtype = 'A' 
Then 
 <statement for table A>
Else
 <statement for Table B>
End if 
```

像这样的东西也应该在 SQL Server 中工作......也许有人可以对此进行扩展？

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-29T17:40:36.197

你真的没有解释`ItemType`来自哪里。如果您只是组合两个表，则建议`UNION`可能适用。

这是另一种可能与您的问题有关的可能性：

```
SELECT ItemNumber,
       ItemType, 
       COALESCE(TableA.Description, TableB.Description) AS Description
FROM Items
LEFT JOIN TableA
    ON Items.ItemType = 'A'
    AND TableA.ItemNumber = Items.ItemNumber
LEFT JOIN TableB
    ON Items.ItemType <> 'A'
    AND TableB.ItemNumber = Items.ItemNumber 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-29T17:35:10.950

您最好先使用 UNION 查询来连接表，然后再使用 SELECT。

此外，您可以考虑为其中一个表创建一个视图，以便在重命名它们时只提取您需要的列，然后是 UNION，然后从 UNION 中选择。

或者使用临时表来存储每个查询的结果。将临时表的创建放在 CASE 中（伪代码，未测试）：

```
CASE @itemType
   WHEN 'A'
      SELECT ACol1 AS Col1, ACol2 AS Col2
      FROM TABLE_A
      INTO #tempTable
      WHERE ItemNumber = @itemNumber
   ELSE
      SELECT BCol1 AS Col1, BCol2 AS Col2
      FROM TABLE_B
      INTO #tempTable
      WHERE PartNumber = @itemNumber
END

SELECT * FROM #tempTable 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2020-08-11T05:59:27.207

它可以是动态查询，或者您可以继续使用以下方法：

```
SELECT 
  CASE ItemType
    WHEN 'A' THEN (Select ItemNumber from TableA Where ItemNumber = @itemNumber)
    When 'B' THEN (Select ItemNumber from TableB Where ItemNumber = @itemNumber)
  End as ItemNumber,
  CASE ItemType
    WHEN 'A' THEN (Select ItemType from TableA Where ItemNumber = @itemNumber)
    When 'B' THEN (Select ItemType from TableB Where ItemNumber = @itemNumber)
  End as ItemType,
  CASE ItemType
    WHEN 'A' THEN (Select Description from TableA Where ItemNumber = @itemNumber)
    When 'B' THEN (Select Description from TableB Where ItemNumber = @itemNumber)
  End as Description 
```

# mysql - 将数据从 MySQL DB 1 传输到 MySQl DB 2 的最快方法

> ID：492614
> 
> 赞同：1
> 
> 时间：2009-01-29T17:31:05.297
> 
> 标签：mysql, data-transfer

我有一个新数据库，类似于旧数据库，但有更多的列和表。所以旧表上的数据仍然可用，需要转移。

旧数据库与新数据库位于不同的服务器上。我想将数据从一个数据库传输到另一个数据库。

我有navicat，但使用主机到主机数据传输似乎需要很长时间。还下载一个 sql 文件然后执行也需要很长时间（它每秒执行大约 4 次插入）。

下载的 SQL 文件大约 40mb（带有完整的插入语句）。最后一个可能是 60mb 到 80mb。

传输这些数据的最佳方式是什么？（我需要重复几次测试的过程）

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-29T17:44:46.097

在源机器上做一个 mysqldump 然后在另一边把它吃掉，即使是在一个 40-100MB 的文件上也是合理的。从命令行执行。

```
(source machine)
mysqldump -u user -p password database > database.sql 
```

..将文件传输到收件人机器...

```
(recipient machine)
mysql -u user -p password database < database.sql 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-29T17:41:24.807

不能先只传输一部分数据进行测试吗？然后，稍后，当您对测试结果满意时，转移整个事情？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-29T17:44:59.247

> （它每秒执行大约 4 次插入）

这听起来更像是你的数据库有问题。你确定没问题吗？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-09-04T19:39:45.807

科迪谢谢你的指导。出于某种原因，它对我不起作用，但在我的 redhat linux 服务器上执行以下操作：

（接收方机器）mysql -u [用户名] -p -h localhost 数据库 < database.sql

（源机）我刚用过 php myadmin

是否有可以运行的命令从另一台服务器中提取数据库，类似于：mysqldump -u [username] -p -h [host address] [dbname] > [filename].sql 谢谢

# asp.net-mvc - ASP.NET MVC 路由问题

> ID：492625
> 
> 赞同：0
> 
> 时间：2009-01-29T17:33:43.560
> 
> 标签：asp.net-mvc, model-view-controller, routing

我有一个页面，我希望它有 2 条不同的路线：“/Admin/Schedules”和“/Schedules”

“/Admin/Schedules”如果对于管理员用户并且页面将呈现一些管理功能并且它需要登录......另一方面，“/Schedules”适用于未登录的用户并且它将呈现非管理员功能...

但是，页面是一样的，我特别需要这两条路线......

有谁知道如何做到这一点？

谢谢！！！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-29T18:07:02.463

正如ajma所说，您可以在控制器中完成此操作，只需在检查用户是否存在的方法中使用 if 条件和 switch 语句，如下所示：

```
 if(UserID !=null)
       {

       switch(UserPreference)
       {
           case 1:
                            action = "Schedules"; 

                            top = TypeOfPage.Admin;
                            view = "Schedules";

                            break;
           default:
                            action = "Schedules"; 
                            top = TypeOfPage.Nonuser;
                            view = "Schedules";
                            break;
       }
 } 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-29T17:43:57.097

您可以在控制器中而不是路由中执行此操作。RedirectToAction 或 RedirectToRoute 可以帮助你。

# html - 更改边框颜色HTML 表单是否可以更改 HTML 表单中 <select/> 元素的边框颜色？边框颜色样式在 Firefox 中有效，但在 IE 中无效。我在谷歌上找不到真正的答案。不，<select> 控件是系统级控件，而不是 IE 中的客户端级控件。有几个版本，它甚至不能很好地与 z-index 配合使用，几乎将自己置于一切之上。要做任何花哨的事情，您必须使用 CSS 和您自己的元素来模拟功能。正如 Diodeus 所说，IE 只允许 <select&gt

> ID：492627
> 
> 赞同：20
> 
> 时间：2009-01-29T17:34:15.650
> 
> 标签：html, css, html-select

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2009-01-29T17:47:52.157

我会考虑将该选择块包含在一个 div 块中，并像这样设置边框属性：

```
<div style="border: 2px solid blue;">
  <select style="width: 100%;">
    <option value="Sal">Sal</option>
    <option value="Awesome">Awesome!</option>
  </select>
</div>
```

您应该能够使用它来完成您所需要的。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-01-29T17:42:43.167

正如 Diodeus 所说，IE 只允许`<select>`元素的默认边框。但是，我知道有两种技巧可以达到类似的效果：

1.  使用与下拉菜单绝对放置在同一位置的 DIV 并设置它的边框。看起来下拉菜单有一个边框。

2.  使用 Javascript 解决方案，例如，[此处](http://webfx.eae.net/dhtml/select/jsGenerated.html)提供的解决方案。

然而，这可能证明是太多的努力，所以你应该评估你是否真的需要边界。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-29T17:37:53.863

不，该`<select>`控件是系统级控件，而不是 IE 中的客户端级控件。有几个版本，它甚至不能很好地与 z-index 配合使用，几乎将自己置于一切之上。

要做任何花哨的事情，您必须使用 CSS 和您自己的元素来模拟功能。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2011-02-15T09:52:14.550

```
select{
    filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=-1, OffY=-1,color=#FF0000) progid:DXImageTransform.Microsoft.dropshadow(OffX=1, OffY=1,color=#FF0000);
} 
```

为我工作。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-29T18:16:59.727

~~您可以在 IE 中设置边框颜色，但存在一些问题。~~

啊……我本可以发誓你可以做到这一点……刚刚测试并意识到我是不正确的。下面的注释仍然适用。

1.  在 IE8 (Beta1 -> RC1) 中更改边框颜色或背景颜色/图像会导致 WindowsXP 中的控件去主题化（下拉箭头和框看起来像 Windows 95）

2.  您仍然无法很好地设置选择控件中的选项样式，因为 IE 不支持它。（[见错误＃291](http://webbugtrack.blogspot.com/2007/11/bug-291-no-styling-options-in-ie.html)）

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2019-09-19T17:31:35.873

用轮廓颜色替换边框颜色应该可以。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2020-06-29T05:44:41.080

```
<style>
.form-error {
        border: 2px solid #e74c3c;
    }
</style>

<div class="form-error">
                                {!! Form::select('color', $colors->prepend('Please Select Color', ''),           ,['class' => 'form-control dropselect form-error'
                                ,'tabindex' => $count++, 'id' => 'color']) !!}
                                </div> 
```

# design-patterns - DDD - 值对象与。实体对象

> ID：492636
> 
> 赞同：9
> 
> 时间：2009-01-29T17:36:35.847
> 
> 标签：design-patterns, domain-driven-design, value-objects, entityobject

我是 DDD 的新手，并努力理解一些概念。您如何确定在您的域中哪些对象是 Entity 对象，哪些是 Value 对象，以及它们究竟是如何区别对待的？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-29T17:40:20.940

正如我所看到的，领域对象基本上代表您的业务领域的名词并且*确实*具有身份，而值对象对业务没有任何特殊意义（想想 MonetaryAmount）并且没有身份。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2014-03-28T11:48:26.477

来自[Jak Charlton 的博客](http://devlicio.us/blogs/casey/archive/2009/02/13/ddd-entities-and-value-objects.aspx)：

> 实体“这是我的实体，有很多喜欢的，但这个是我的”</p>
> 
> 一个实体的关键定义特征是它具有一个身份——它在系统中是唯一的，并且没有其他实体，无论同一个实体多么相似，除非它具有相同的身份。
> 
> 身份可以在实体上以多种方式表示——它可以是数字标识符（经典的 CustomerID），也可以是 Guid（经典的......哦，没关系），或者它可以是自然键（如 CustomerNumber 您的客户当他们第一次向您购买时，由您的 CRM 系统提供）。
> 
> 无论您选择哪种方式来表示它，实体都是通过拥有一个身份来定义的。
> 
> 值对象 值对象的关键定义特征是它没有身份。好吧，也许有点简单，但值对象的目的是仅通过它的属性来表示某些东西。两个 VO 可能具有相同的属性，在这种情况下它们是相同的。然而，除了它们的属性之外，它们没有任何价值。
> 
> VO 的另一个共同点是它们可能应该是不可变的，一旦创建它们就不能更改或更改。您可以创建一个新的，并且由于它们没有身份，这与更改另一个相同。

在汽车工厂系统应用程序中的 POO 中的 Car Class 中思考（无牌照）。即使两辆车相同（相同的型号、发动机、颜色、重量等），每辆车都是独一无二的，并且可以通过身份[车辆识别号](http://en.wikipedia.org/wiki/Vehicle_identification_number)来区分。

两辆车可以相等，因为它的属性`Car1.equals(Car2)`，但不能是同一辆车，因为它的 VIN `Car1 != Car2`。如果一辆汽车改变了它的颜色，它就不是其他汽车，它是具有其他属性的同一辆汽车。这是一个实体。

现在想想 Color Class (for the car) with`name`和`RGB`字段。青色有`'Cyan'`名称和`R = 0 G = 255 B = 255`。不需要其他身份字段，因为它的属性是它的身份。颜色是 VO 并且必须是不可变的，因为更改名称或 RBG（或两者）代表其他颜色......或者如果名称和 RGB 不匹配，则在这种情况下出现错误；）

`Color1.equals(Color)`并且`Color1 == Color2`必须始终具有相同的结果。

# wpf - 在 UserControl 中公开子控件以在 XAML 中使用

> ID：492642
> 
> 赞同：1
> 
> 时间：2009-01-29T17:39:51.050
> 
> 标签：wpf, xaml

我有一个包含 TreeView 的 UserControl。我希望用户能够通过 XAML 设置内部 TreeView 控件的属性，但我不知道该怎么做。

我尝试在 UserControl 上为 TreeView 创建一个公共属性，但这仅允许我设置 SelectedItemChanged 触发器。

我想做类似的事情：

```
<ExampleUserControl>
    <ExampleUserControl.TreeView.ItemTemplate>
        ...
    </ExampleUserControl.TreeView.ItemTemplate>
</ExampleUserControl> 
```

或者：

```
<ExampleUserControl TreeView.ItemsSource="{Binding Foo}" /> 
```

我不希望在 UserControl 中为每个 TreeView 属性创建属性，并且我不想强制用户在 C# 中定义控件。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-30T16:27:47.950

至于将多个属性传递给用户控件中的子控件，您始终可以公开一个 Style 属性。

即儿童风格

对于 ItemsSource，除非您使用 [Josh Smith's Element Spy / Data Context Spy / Freezable][1] 技巧，否则您将在 DataContexts 上断开连接。

因此，您要么使用这些技巧，要么仅拥有 2 个属性。

1) ItemsSource 2) ChildStyle

xaml 最终...

```
 <ChildTreeAnswer:MyControl ItemsSource="{Binding Items}">
        <ChildTreeAnswer:MyControl.ChildStyle>
            <Style>
                <Setter Property="ItemsControl.ItemTemplate">
                    <Setter.Value>
                        <DataTemplate>
                            <Border BorderBrush="Black"
                                    BorderThickness="1"
                                    Margin="5">
                                <TextBlock Text="{Binding }" />
                            </Border>
                        </DataTemplate>
                    </Setter.Value>
                </Setter>
            </Style>
        </ChildTreeAnswer:MyControl.ChildStyle>                           
    </ChildTreeAnswer:MyControl> 
```

然后在你的用户控件中做......（为了简单起见，我使用了一个列表框）

```
 <ListBox ItemsSource="{Binding ItemsSource}"
             Style="{Binding ChildStyle}" /> 
```

# wcf - WCF 自定义绑定/扩展导致 app.config 中的验证错误

> ID：492662
> 
> 赞同：3
> 
> 时间：2009-01-29T17:44:35.550
> 
> 标签：wcf

我很好奇是否有人知道如何解决此问题：当我将 bindingExtension 或 bindingElementExtension 添加到我的 WCF 配置时，Visual Studio 会引发架构验证警告，因为扩展名不在 system.serviceModel 架构中：

警告 1 元素“绑定”具有无效的子元素“nmsBinding”。可能元素的列表预计： 'basicHttpBinding的，customBinding，msmqIntegrationBinding，netPeerTcpBinding，netMsmqBinding，netNamedPipeBinding，NetTcpBinding的，wsFederationHttpBinding，ws2007FederationHttpBinding，的wsHttpBinding，ws2007HttpBinding，wsDualHttpBinding，mexHttpBinding，mexHttpsBinding，mexNamedPipeBinding，mexTcpBinding，的WebHttpBinding，netTcpContextBinding，wsHttpContextBinding，basicHttpContextBinding'。

这可能是一个愚蠢的问题，但是有没有办法“动态地”向 Visual Studio 注册这些扩展，以便它们验证？我在想我可以在 Visual Studio 配置中的某个地方放置一个 xsd，但如果有其他神奇的方式，我宁愿不这样做。

这是我的 serviceModel 配置的样子：

```
<system.serviceModel>

    <services>
        <service name="Zed.Apache.NMS.WCF.Test.Server.TestApacheNMSService">
            <endpoint
                name="nmsServiceEndpoint"
                address="tcp://localhost:61616"
                binding="nmsBinding"
                bindingConfiguration="defaultNmsBinding" 
                contract="Zed.Apache.NMS.WCF.Test.Server.ITestApacheNMSService" />
        </service>
    </services>

    <bindings>
        <nmsBinding> <!-- VALIDATION ERROR HERE -->
            <binding name="defaultNmsBinding"
                     destination="TestApacheNMSQueue"
                     destinationType="Queue" />
        </nmsBinding>
    </bindings>

    <extensions>
        <bindingExtensions>
            <add name="nmsBinding"
                 type="Apache.NMS.WCF.NmsBindingCollection, Zed.Apache.NMS.WCF, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null" />
        </bindingExtensions>
    </extensions>

</system.serviceModel> 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-12T09:22:07.770

我相信 VS2008 使用文件“C:\Program Files\Microsoft Visual Studio 9.0\xml\Schemas\DotNetConfig.xsd”（默认安装）来验证配置文件。您可以更改此文件或在配置文件的“属性”下指定另一个架构。

但是，只要您只收到设计时警告，就可能不值得麻烦。

# c# - C# 4.0 中的合同

> ID：492668
> 
> 赞同：2
> 
> 时间：2009-01-29T17:45:51.490
> 
> 标签：c#, .net, contracts

如果我有一个`Vector3.Normalize()`方法指定结果`Vector3`的长度为 1 的后置条件，编译器将如何在编译时（或之前）检查这个？它只是将随机`Vector3`变量传递给方法吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-29T20:43:01.680

这不是 C# 4.0 的特性。它是 CLR 4.0 的一个独立于语言的特性，在 IL 级别上工作。它确实有一些执行静态检查的能力，但不是针对每种情况。它实际上会针对您使用的任何语言分析由普通编译器生成的 IL，找到您放入代码中的约束，然后查看代码以确定它是否符合合同。静态检查（至少在我见过的演示中）是一个可选功能。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-29T20:25:00.873

我很确定 C# 4.0 中的代码契约内容将在运行时发生，而不是在编译时发生，并且您需要在调用中实际指定条件。假设你的 Vector3 类有一个 Length 属性，你最终会得到这样的结果：

```
Expects(vector3.Length == 1); 
```

这实际上会在某种编译后步骤中遇到一些 IL 重写，最终基本上将方法的主体包装在 try..finally 中，其中后置条件测试位于 finally 块中。

# asp.net-mvc - 在 ASP.NET MVC RC1 中为强类型视图使用“添加视图”对话框时出现问题

> ID：492671
> 
> 赞同：4
> 
> 时间：2009-01-29T17:47:53.937
> 
> 标签：asp.net-mvc, visual-studio-2008

我喜欢随 RC1 发布的新添加视图对话框。如果您指定视图数据类，它会为您生成一个脚手架视图。在我的解决方案中的项目中定义的类似乎可以正常工作。我的一些域类继承自在外部程序集中定义的基类（并在我的 Web 项目中引用）。当我指定这些域类之一时出现错误。Visual Studio 在外部基类上报告 TypeLoadException。

我对 ProcMon 进行了一些调试，发现它正在一个临时文件夹中寻找基类 DLL。该文件夹确实包含包含我的派生域模型类的 DLL。我没有看到基类的 DLL。所以为了好玩，我把它复制到那里，瞧，我可以添加视图。

这是一个错误吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-29T17:54:00.930

是的，这是一个错误。[请在http://codeplex.com/aspnet](http://codeplex.com/aspnet)上归档

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-08-02T11:35:18.767

您实际上忘记在查看文件夹中添加 Web.Config 文件。请参阅这篇小文章：[http ://www.graytechnology.com/Blog/post/ASPNET-MVC-strongly-typed-view-error-Could-not-load-type.aspx](http://www.graytechnology.com/Blog/post/ASPNET-MVC-strongly-typed-view-error-Could-not-load-type.aspx)

在我目前的项目中，它也让我摸不着头脑！:)

# java - JspWriter 写入与打印

> ID：492672
> 
> 赞同：6
> 
> 时间：2009-01-29T17:48:25.823
> 
> 标签：java, jsp, jsp-tags

我正在开发一些自定义 JSP 标记。在我的`SimpleTag.doTag()`我抓住`JspContext`并打电话`getOut()`来获取`JspWriter`. 写信给时和`JspWriter`有什么区别？我应该打电话而不是打电话吗？`write(String)``print(String)`

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-01-29T17:54:17.840

print() 方法可以缓冲，write() 方法是从 Writer 类继承的，不能 - 所以你可以从 JspWriter 的 print() 方法中获得更好的性能。

此外，print() 方法被重载以将许多不同类型的对象作为参数，而 write 方法仅处理字符串和字符。

有关更多详细信息，请参阅[JspWriter javadocs](http://java.sun.com/j2ee/1.4/docs/api/javax/servlet/jsp/JspWriter.html)。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-29T17:56:15.840

来自javadoc：

' **write** ' 函数是从 java.io.writer 继承的。

' **print** ' 函数：如果参数为 null，则打印“null”。否则，字符串的字符将被写入 JspWriter 的缓冲区，或者，如果没有使用缓冲区，则直接写入底层写入器。

# versioning - Eclipse 建模框架中的元模型演变

> ID：492678
> 
> 赞同：1
> 
> 时间：2009-01-29T17:51:10.827
> 
> 标签：versioning, eclipse-emf

我正在尝试评估 EMF 以在项目中使用。我正在研究的一件事是元模型（M2 或 .ecore 模型）级别的某种版本控制支持。

在元模型演化方面，我已经阅读了[某些讨论](http://www.eclipse.org/newsportal/article.php?id=32702&group=eclipse.tools.emf)并遇到了[这篇论文](http://www.cs.vu.nl/csmr2007/workshops/p15.pdf)。但是，我想知道在 EMF 中是否在这个方向上发生了任何具体的事情。

一般来说，对涉及版本控制的功能的支持级别是多少——例如合并和比较、进化、迁移、多个版本同时共存等。我意识到实际的版本控制本身将由源代码控制系统提供可以用来存储这些元模型，但是语义版本控制功能（例如我上面提到的那些）应该由 EMF 本身提供，对吗？

我知道某些计划，例如[EMF Compare](http://www.eclipse.org/modeling/emft/?project=compare#compare)和[Temporality](http://www.eclipse.org/modeling/emft/?project=temporality#temporality)，它们适用于 EMF 模型。我不确定这些是否适用于元模型级别。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-23T05:09:43.973

我正在研究我的博士论文中的元模型演化。为了展示我的想法的适用性，我为 EMF 中的元模型演化开发了工具支持，称为 COPE。在[网站上](http://cope.in.tum.de)，您可以访问许多关于 COPE 的出版物以及下载该工具本身。此外，我目前正在提议一个[项目](http://www.eclipse.org/proposals/edapt/)，将 COPE 贡献给 EMF。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-18T15:39:30.507

一般来说，每个适用于 Ecore**模型**的工具也适用于Ecore**元模型**，因为 Ecore 的元模型是 Ecore。（花点时间让这个下沉，我知道我必须......）

我已经成功地将 EMF 与我的 Ecore 元模型进行比较，不知道你提到的其他工具。

# sql - 带有行计数器的 SQLServer SQL 查询

> ID：492679
> 
> 赞同：24
> 
> 时间：2009-01-29T17:52:21.103
> 
> 标签：sql, sql-server

我有一个 SQL 查询，它返回一组行：

```
SELECT id, name FROM users where group = 2 
```

我还需要包含一个具有递增整数值的列，因此第一行需要在计数器列中有一个 1，第二个是 2，第三个是 3 等等

此处显示的查询只是一个简化的示例，实际上查询可以是任意复杂的，具有多个连接和嵌套查询。

我知道这可以使用带有自动编号字段的临时表来实现，但是有没有办法在查询本身中做到这一点？

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2009-01-29T18:11:18.197

对于初学者来说，大致如下：

```
SELECT my_first_column, my_second_column,
    ROW_NUMBER() OVER (ORDER BY my_order_column) AS Row_Counter
FROM my_table 
```

但是，重要的是要注意`ROW_NUMBER() OVER (ORDER BY ...)`构造仅确定 的值`Row_Counter`，它不保证结果的顺序。

除非它`SELECT`本身有一个显式`ORDER BY`子句，否则结果可以以任何顺序返回，这取决于 SQL Server 决定如何优化查询。（[有关更多信息，请参阅本文](http://blogs.msdn.com/queryoptteam/archive/2006/05/02/588731.aspx)。）

保证结果*总是*按顺序返回的唯一方法是对 the和`Row_Counter`应用完全相同的排序：`SELECT``ROW_NUMBER()`

```
SELECT my_first_column, my_second_column,
    ROW_NUMBER() OVER (ORDER BY my_order_column) AS Row_Counter
FROM my_table
ORDER BY my_order_column  -- exact copy of the ordering used for Row_Counter 
```

上述模式将始终以正确的顺序返回结果，并且适用于简单的查询，但是对于`ORDER BY`子句中可能包含数十个表达式的“任意复杂”查询呢？在这些情况下，我更喜欢这样的东西：

```
SELECT t.*
FROM
(
    SELECT my_first_column, my_second_column,
        ROW_NUMBER() OVER (ORDER BY ...) AS Row_Counter  -- complex ordering
    FROM my_table
) AS t
ORDER BY t.Row_Counter 
```

使用嵌套查询意味着不需要复制复杂的`ORDER BY`子句，这意味着更少的混乱和更容易维护。外部`ORDER BY t.Row_Counter`还使查询的意图对您的开发人员来说更加清晰。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-01-29T17:56:17.507

在 SQL Server 2005 及更高版本中，您可以使用该[`ROW_NUMBER()`](http://msdn.microsoft.com/en-us/library/ms186734.aspx)函数，该函数具有排序顺序和完成计数（和重置）的组的选项。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2016-12-20T18:15:13.680

最简单的方法是使用可变行计数器。然而，这将是两个实际的 SQL 命令。一是设置变量，然后查询如下：

```
SET @n=0;
SELECT @n:=@n+1, a.* FROM tablename a 
```

您的查询可以像连接等一样复杂。我通常将其设为存储过程。您可以从变量中获得各种乐趣，甚至可以使用它来计算字段值。关键是`:=`

* * *

## 回答 #4

> 赞同：-3
> 
> 时间：2016-03-01T12:42:51.560

这是一种不同的方法。如果您有多个不可连接的数据表，或者您出于某种原因不想同时计算所有行但仍希望它们从相同的行数中分离出来，您可以创建一个可以完成这项工作的表为你。

例子：

```
create table #test (
        rowcounter int identity,
        invoicenumber varchar(30)
        )

insert into #test(invoicenumber) select [column] from [Table1]

insert into #test(invoicenumber) select [column] from [Table2]

insert into #test(invoicenumber) select [column] from [Table3]

select * from #test

drop table #test 
```

# c# - 如何将 LINQ 左外连接限制为一行

> ID：492683
> 
> 赞同：39
> 
> 时间：2009-01-29T17:53:22.380
> 
> 标签：c#, asp.net, database, linq, join

我有一个左外连接（如下）按预期返回结果。我需要将“正确”表中的结果限制为“第一次”命中。我能以某种方式做到这一点吗？目前，我为两个表中的每条记录都得到一个结果，无论我在右表（照片）中有多少结果，我都只想从左边的表（项目）中看到一个结果。

```
 var query = from i in db.items
                join p in db.photos
                on i.id equals p.item_id into tempPhoto
                from tp in tempPhoto.DefaultIfEmpty()
                orderby i.date descending 
                select new
                {
                    itemName = i.name,
                    itemID = i.id,
                    id = i.id,
                    photoID = tp.PhotoID.ToString()
                };

    GridView1.DataSource = query;
    GridView1.DataBind(); 
```

* * *

## 回答 #1

> 赞同：74
> 
> 时间：2009-01-29T18:00:36.297

这将为您完成工作。

```
from i in db.items
let p = db.photos.Where(p2 => i.id == p2.item_id).FirstOrDefault()
orderby i.date descending
select new
{
  itemName = i.name,
  itemID = i.id,
  id = i.id,
  photoID = p == null ? null : p.PhotoID.ToString();
} 
```

当我针对我自己的模型生成它时，我得到了这个 sql（并且在投影中没有 name 和第二个 id 列）。

```
SELECT [t0].[Id] AS [Id], CONVERT(NVarChar,(
    SELECT [t2].[PhotoId]
    FROM (
        SELECT TOP (1) [t1].[PhotoId]
        FROM [dbo].[Photos] AS [t1]
        WHERE [t1].[Item_Id] = ([t0].[Id])
        ) AS [t2]
    )) AS [PhotoId]
FROM [dbo].[Items] AS [t0]
ORDER BY [t0].[Id] DESC 
```

当我询问计划时，它表明子查询是由这个连接实现的：

```
<RelOp LogicalOp="Left Outer Join" PhysicalOp="Nested Loops"> 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-01-29T18:02:16.717

您要做的是对表格进行分组。最好的方法是：

```
 var query = from i in db.items
                join p in (from p in db.photos
                           group p by p.item_id into gp
                           where gp.Count() > 0
                           select new { item_id = g.Key, Photo = g.First() })
            on i.id equals p.item_id into tempPhoto
            from tp in tempPhoto.DefaultIfEmpty()
            orderby i.date descending 
            select new
            {
                itemName = i.name,
                itemID = i.id,
                id = i.id,
                photoID = tp.Photo.PhotoID.ToString()
            }; 
```

* * *

编辑：这是 Amy B 说话。我这样做只是因为尼克要求我这样做。尼克，请在您认为合适的情况下修改或删除此部分。

生成的 SQL 相当大。int 0（与计数比较）通过参数传入。

```
SELECT [t0].X AS [id], CONVERT(NVarChar(MAX),(
    SELECT [t6].Y
    FROM (
        SELECT TOP (1) [t5].Y
        FROM [dbo].[Photos] AS [t5]
        WHERE (([t4].Y IS NULL) AND ([t5].Y IS NULL)) OR (([t4].Y IS NOT NULL) AND ([t5].Y IS NOT NULL) AND ([t4].Y = [t5].Y))
        ) AS [t6]
    )) AS [PhotoId]
FROM [dbo].[Items] AS [t0]
CROSS APPLY ((
        SELECT NULL AS [EMPTY]
        ) AS [t1]
    OUTER APPLY (
        SELECT [t3].Y
        FROM (
            SELECT COUNT(*) AS [value], [t2].Y
            FROM [dbo].[Photos] AS [t2]
            GROUP BY [t2].Y
            ) AS [t3]
        WHERE (([t0].X) = [t3].Y) AND ([t3].[value] > @p0)
        ) AS [t4])
ORDER BY [t0].Z DESC 
```

执行计划显示了三个左连接。至少有一个是微不足道的，不应该被计算（它带来了零）。这里有足够的复杂性，我无法清楚地指出任何效率问题。它可能运行得很好。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-29T18:03:41.003

您可以执行以下操作：

```
var q = from c in
          (from s in args
           select s).First()
        select c; 
```

围绕查询的最后一部分。不确定它是否会起作用或会产生什么样的怪异 SQL :)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2019-11-01T21:11:15.810

使用内部查询。包括`DefaultIfEmpty`没有照片`orderby`的情况和多于一张的情况。以下示例拍摄 最大的照片`id`。

```
var query = 
    from i in db.items
    let p = from p in db.photos where i.id == p.item_id orderby p.id select p).DefaultIfEmpty().Last()
    orderby i.date descending
    select new {
      itemName = i.name,
      itemID = i.id,
      id = i.id,
      photoID = p.PhotoID
    }; 
```

如果需要专门处理没有照片的情况，可以省略`DefaultIfEmpty`，改用`FirstOrDefault`/ `LastOrDefault`。

# excel - 从 Excel 中理解/建模公式

> ID：492692
> 
> 赞同：2
> 
> 时间：2009-01-29T17:55:36.247
> 
> 标签：excel, actionscript

我有一个 Excel 电子表格，它基于 4 个单元格执行许多计算以得出某个数字。我的任务是将此电子表格转换为可以嵌入到 Web 应用程序中的组件之类的小部件。

是否有一种简单的方法可以显示或理解 Excel 电子表格中的嵌入公式，以便我可以更轻松地将它们转换为 ActionScript？

谢谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-29T18:14:13.010

如果我理解正确的话。工具|选项|Windows 选项，然后选中公式框。这将显示公式而不是值。它应该打开公式审核工具栏。这些工具应该可以满足您的需求。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-30T00:03:29.373

你看过 Calc4Web 吗？我从未使用过它，所以我无法给出评论，但基本思想是它从电子表格逻辑生成 C++ 代码。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-30T00:43:46.967

如果您只想查看实际公式，而不是结果（值），那么当您在具有您希望查看的公式的单元格上处于活动状态时，`(grave accent). The grave accent is usually one key to the left of the number 1 key on most keyboards. This works as a toggle, so if you press CTRK +`再次按 CTRL +（重音键） - 值将显示为这是在您按下该按键组合之前。

额外的：

如果您希望显示整个工作簿的所有论坛，请按照以下步骤操作：

1.  单击左上角的**Office 按钮，然后单击出现的窗口右下角的****Excel 选项**按钮。
2.  单击左侧窗格中的“高级”选项卡。
3.  向下滚动到“此工作表”部分的显示选项
4.  选中“在单元格中显示公式而不是计算结果”复选框，然后单击“**确定**” 。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-30T00:57:51.103

由于似乎没有一种简单的方法可以将 excel 电子表格转换为 ActionScript，因此我建议您查看公式并在数据量不大时尝试手动解决它们，或者如果数据量很大则编写丢弃脚本的数据是必需的。这样，您将了解计算并可以在 ActionScript 中实现它们，而不是依赖您可能了解或不了解其代码的向导。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-30T01:51:44.193

您也可以通过 Ctrl+~ 从键盘切换此设置（这是波浪号，第一个数字行中的第一个键）

因此，如果您想快速查看单元格中的公式并返回正常视图，只需按两次 Ctrl+~

# c# - LINQ，查询上的大过滤器

> ID：492698
> 
> 赞同：3
> 
> 时间：2009-01-29T17:57:33.840
> 
> 标签：c#, asp.net-mvc, linq

我正在构建一个应用程序的一部分，该部分围绕从数据库中提取有关事务的信息。由于数据的性质，我想过滤表中的许多列。我有一个包含 15 个字段的过滤器选择框，我希望能够为 LINQ 语句构建 where 子句。当我希望某些字段为空时，有趣的部分就出现了。例如，我希望能够过滤任何或全部：

*   交易类型
*   响应代码
*   交易金额
*   还有很多

我可以建立一个看起来像的谓词

```
Func<Transaction, bool> pred = t => t.ResponseCode == ResponseCode && t.TransactionType == TransactionType && t.TransactionAmount > 100.00; 
```

但是为了能够选择要包含在谓词中的字段，我[将谓词连接](https://stackoverflow.com/questions/491780/concatenating-lambda-functions-in-c)在一起：

```
Func<Transaction, bool> pred = t => true;
if(ResponseCode != null)
   pred.AndAlso(t => t.ResponseCode == ResponseCode);
// Rinse and repeat 
```

然后将该谓词传递给 LINQ 语句的 where 子句。

这完全按照我想要的方式工作，但相当复杂。有没有其他方法可以做到这一点？

更新：感谢正义的评论。我没有使用 LINQ to SQL，而是在存储库中的对象集合上使用 LINQ。您将如何以编程方式构建表达式过滤器？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-01-29T21:28:48.810

*   在动态 SQL... 由于您只有一个 WHERE 子句 - 您必须将谓词与 AND 连接。
*   在 linq 查询构造中......您可以根据需要获得尽可能多的 WHERE 子句。当 Linq 翻译查询时，它会为您将它们 AND 在一起。

例子：

```
IQueryable<Transaction> query = db.Transactions;

if (filterByTransactionType)
{
  query = query.Where(t => t.TransactionType == theTransactionType);
}
if (filterByResponseCode)
{
  query = query.Where(t => t.ResponseCode == theResponseCode);
}
if (filterByAmount)
{
  query = query.Where(t => t.TransactionAmount > theAmount);
} 
```

另一个例子：

```
List<Expression<Func<Transaction, bool>>> filters = GetFilterExpressions();

IQueryable<Transaction> query = db.Transactions;
filters.ForEach(f => query = query.Where(f)); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-29T18:12:17.600

首先，您需要使用`Expression<Func<Transaction, bool>>`LINQ-to-SQL（这就是您要使用的，它与 LINQ 不同）。

其次，您可以通过编程方式构建一个`Expression<Func<Transaction, bool>>`using`System.Linq.Expression`命名空间。

您将无法使用 LINQ 本身使用以编程方式构建的表达式来查询数据库。您需要使用查询扩展方法，而不是使用查询运算符：例如，`from p in db.People where p.Age > 50 select p.Name`您需要使用`db.People.Where(p => p.Age > 50)`. 您可以使用此样式添加过滤器：`db.People.Where(myFilter)`, where `myFilter = new Expression<Func<Person, bool>>(p => p.Age > 50)`。在您的情况下，`myFilter`将是您以编程方式构建的过滤器，而不是使用 lambda 表达式语法创建的过滤器。

# c# - 如何在保留行尾的同时拆分字符串？

> ID：492700
> 
> 赞同：3
> 
> 时间：2009-01-29T17:58:34.163
> 
> 标签：c#, .net, string, split

我有一段文本，我想在**不**丢失结尾的 \r 和 \n 的情况下获得它的行。现在，我有以下（次优代码）：

```
string[] lines = tbIn.Text.Split('\n')
                     .Select(t => t.Replace("\r", "\r\n")).ToArray(); 
```

所以我想知道 - 有没有更好的方法呢？

**接受的答案**

```
string[] lines =  Regex.Split(tbIn.Text, @"(?<=\r\n)(?!$)"); 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-29T19:05:13.047

以下似乎可以完成这项工作：

```
string[] lines =  Regex.Split(tbIn.Text, @"(?<=\r\n)(?!$)"); 
```

(?<=\r\n) 在 \r\n 之后使用“正向后视”来匹配而不消耗它。

(?!$) 使用负前瞻来防止在输入末尾匹配，从而避免最后一行只是一个空字符串。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-29T18:08:00.743

如果您只是要替换换行符 ( `\n`)，请执行以下操作：

```
string[] lines = tbIn.Text.Split('\n')
                     .Select(t => t + "\r\n").ToArray(); 
```

### 编辑：Regex.Replace 允许您拆分字符串。

```
string[] lines = Regex.Split(tbIn.Text, "\r\n")
             .Select(t => t + "\r\n").ToArray(); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-29T18:11:01.050

类似于使用此正则表达式的内容： [^\n\r]*\r\n

然后使用 Regex.Matches()。问题是您需要 Group(1) 从每个匹配项中创建您的字符串列表。在 Python 中，您只需使用 map() 函数。不确定在 .NET 中执行此操作的最佳方法，您可以从那里获取 ;-)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-29T18:25:35.280

Dmitri，您的解决方案实际上非常简洁明了。唯一更有效的方法是将字符串拆分字符***保留***在生成的数组中，但 API 根本不允许这样做。因此，每个解决方案都需要遍历数组并执行某种修改（这在 C# 中意味着每次都分配新字符串）。我认为你能希望的最好的就是不要重新创建数组：

```
string[] lines = tbIn.Text.Split('\n');
for (int i = 0; i < lines.Length; ++i)
{
    lines[i] = lines[i].Replace("\r", "\r\n");
} 
```

...但正如您所见，这看起来更麻烦！如果性能很重要，这可能会好一些。如果***真的很***重要，您应该考虑使用 IndexOf() 手动解析字符串，一次找到 '\r 的一个，然后自己创建数组。不过，这要多得多的代码，而且可能没有必要。

您的解决方案和这个解决方案的副作用之一是，如果 TextBox 中还没有最后一行，您***将不会在最后一行获得终止的“\r\n”。***这是你所期望的吗？空白行呢……您希望它们出现在“行”中吗？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-29T18:37:19.470

您可以使用正则表达式来实现这一点。这是一个扩展方法：

```
 public static string[] SplitAndKeepDelimiter(this string input, string delimiter)
    {
        MatchCollection matches = Regex.Matches(input, @"[^" + delimiter + "]+(" + delimiter + "|$)", RegexOptions.Multiline);
        string[] result = new string[matches.Count];
        for (int i = 0; i < matches.Count ; i++)
        {
            result[i] = matches[i].Value;
        }
        return result;
    } 
```

我不确定这是否是一个更好的解决方案。你的非常紧凑和简单。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-29T18:38:48.217

与往常一样，扩展方法好东西:)

```
public static class StringExtensions
{
    public static IEnumerable<string> SplitAndKeep(this string s, string seperator)
    {
        string[] obj = s.Split(new string[] { seperator }, StringSplitOptions.None);

        for (int i = 0; i < obj.Length; i++)
        {
            string result = i == obj.Length - 1 ? obj[i] : obj[i] + seperator;
            yield return result;
        }
    }
} 
```

用法：

```
 string text = "One,Two,Three,Four";
        foreach (var s in text.SplitAndKeep(","))
        {
            Console.WriteLine(s);
        } 
```

输出：

一，

二，

三，

四

# c# - .Net 与 Java 垃圾收集器

> ID：492703
> 
> 赞同：66
> 
> 时间：2009-01-29T18:00:27.267
> 
> 标签：c#, java, garbage-collection

有谁知道 Java 和 .Net 垃圾收集器之间的主要区别？网络搜索并没有透露太多，这是一个测试中出现的问题。

* * *

## 回答 #1

> 赞同：119
> 
> 时间：2009-01-29T18:28:11.407

区别在于 CLR (.Net) GC 和 JVM GC 而不是语言本身。两者都可能发生变化，并且它们的行为规范松散，以允许对其进行更改而不影响程序的正确性。

有一些历史差异主要是由于 .Net 的设计借鉴了 java（和其他基于 gc 的平台）的演变。在下文中，不要假设 .Net 在某种程度上优于它，因为它从一开始就包含功能，它只是后来出现的结果。

一个显着的公开可见的区别是 MS GC 暴露了它的代际性质（通过 GC api），这可能会在一段时间内保持正确，因为这是基于大多数程序表现出的行为的明显方法：大多数分配都非常短暂的。

最初的 JVM 没有分代垃圾收集器，尽管这个特性被迅速添加。~~Sun~~ Oracle 和其他人实现的第一代收集器往往是 Mark and Sweep。人们意识到标记-扫描-压缩方法将导致更好的内存局部性，从而证明额外的复制开销是合理的。CLR 运行时以这种行为首次亮相。

~~Sun~~ Oracle 和 Microsoft 的 GC 实施“精神”之间的区别之一是可配置性。

~~Sun~~提供了大量选项（在命令行中）来调整 GC 的各个方面或在不同模式之间切换。许多选项都属于 -X 或 -XX 以表明它们缺乏跨不同版本或供应商的支持。相比之下，CLR 几乎没有提供可配置性。您唯一真正的选择是使用分别针对吞吐量和延迟进行优化的服务器或客户端收集器。

两家公司（以及开源实现）都在积极研究 GC 策略作为 pre-tenuring 方法，它试图避免将某些分配放入伊甸园代。

* * *

## 回答 #2

> 赞同：34
> 
> 时间：2009-01-30T09:12:30.607

这只是为了增加 ShuggyCoUk 的出色答案。.NET GC 还使用所谓的大对象堆 (LOH)。CLR 在 LOH 上预分配了一堆对象，并且所有用户分配的至少 85000 字节的对象也都分配在 LOH 上。此外，`double[]`由于一些内部优化，LOH 上也分配了 1000 个或更多元素。

LOH 的处理方式与分代堆不同：

*   它仅在完整收集期间被清理，并且永远不会像世代堆一样被压缩。
*   来自 LOH 的分配是通过一个空闲列表完成的，就像`malloc`在 C 运行时中处理的那样，而来自分代堆的分配基本上是通过在第 0 代中移动一个指针来完成的。

我不知道 JVM 是否有类似的东西，但它是关于如何在 .NET 中处理内存的基本信息，因此希望您会发现它很有用。

* * *

## 回答 #3

> 赞同：20
> 
> 时间：2009-01-30T09:16:02.660

如果我没记错的话，JVM 不会像 CLR 那样将释放的内存释放回操作系统。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-01-29T18:30:51.697

Java 5 对其 GC 算法进行了许多更改。

我不是 C# 专家，但这两篇文章向我表明，它们都已经从简单的标记和扫描演变为新一代模型：

[http://java.sun.com/docs/hotspot/gc5.0/gc_tuning_5.html](http://java.sun.com/docs/hotspot/gc5.0/gc_tuning_5.html) [http://www.csharphelp.com/archives2/archive297.html](http://www.csharphelp.com/archives2/archive297.html)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-29T18:26:41.130

我找到了这个：

> 在 J2SE 平台版本 1.4.2 中，有四个垃圾收集器可供选择，但在用户没有明确选择的情况下，总是选择串行垃圾收集器。在 5.0 版中，收集器的选择基于启动应用程序的机器的类别。

[这里](http://java.sun.com/docs/hotspot/gc5.0/gc_tuning_5.html)和这个

> 就像 JVM 管理对象的销毁一样，CLR 也通过 Mark 和 Compact 垃圾收集算法来管理对象的销毁

[这里](http://www.25hoursaday.com/CsharpVsJava.html#heap)

我希望这有帮助...

# sql - 有没有办法在 oracle 10g 中记录所有失败的 sql 语句

> ID：492705
> 
> 赞同：5
> 
> 时间：2009-01-29T18:00:37.797
> 
> 标签：sql, oracle

有没有办法将 oracle 10g 中所有失败的 sql 语句记录到表或文件中？

失败是指格式错误的 sql 语句或没有表或对象权限的 sql 语句。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-01-31T01:54:23.673

您可能希望像这样使用审计：

审核选择表、插入表、删除表、在不成功时通过访问执行过程；

By ACCESS 适用于每个语句（这似乎是您想要的）。通过 SESSION 将记录每个会话（高容量环境）的一条记录。

Oracle 内置审计的开销比触发器少。其他答案包含的触发器允许您记录所需的确切信息。审计也只会捕获对现有对象的命中。如果有人在不存在的表（拼写错误或诸如此类）上进行选择，审计将无法捕捉到它。上面的触发器会。

安全指南中的更多信息：http: [//download.oracle.com/docs/cd/B19306_01/network.102/b14266/auditing.htm#i1011984](http://download.oracle.com/docs/cd/B19306_01/network.102/b14266/auditing.htm#i1011984)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-29T21:48:25.853

不像 Demge 的回答那样点击系统视图，有一个 ora_sql_txt 函数可以给出相关的语句。

```
create or replace TRIGGER log_err after servererror on schema
DECLARE
  v_stack VARCHAR2(2000) := substr(dbms_utility.format_error_stack,1,2000);
  v_back VARCHAR2(2000);-- := substr(dbms_utility.format_error_backtrace,1,2000);
  v_num NUMBER;
  v_sql_text ora_name_list_t;
  procedure track(p_text in varchar2) is
  begin
     insert into .... values (p_text);
  end;
begin
  v_stack := translate(v_stack,'''','"');
  track(v_stack);
  v_back := translate(v_back,'''','"');
  if v_back is not null then track(v_back); end if;
  v_num  := ora_sql_txt(v_sql_text);
  BEGIN
    FOR i IN 1..v_num LOOP
      track(to_char(i,'0000')||':'||v_sql_text(i));
    END LOOP;
  EXCEPTION
    WHEN VALUE_ERROR THEN NULL;
  END;
end; 
```

在我自己的环境中，我实际上将“TRACK”作为一个使用自主事务的单独过程，而不是上面的块。

```
create or replace procedure track (p_text IN VARCHAR2) IS
  PRAGMA AUTONOMOUS_TRANSACTION;
  cursor c_user is
    select   sys_context('USERENV','CLIENT_INFO')       client_info,
             sys_context('USERENV','CURRENT_SCHEMA')    curr_schema,
             sys_context('USERENV','CURRENT_USER')      curr_user,
             sys_context('USERENV','DB_NAME')           db_name,
             sys_context('USERENV','HOST')              host,
             sys_context('USERENV','IP_ADDRESS')        ip,
             sys_context('USERENV','OS_USER')           osuser,
             sys_context('USERENV','SESSIONID')         sessid,
             sys_context('USERENV','SESSION_USER')      sess_user,
             sys_context('USERENV','TERMINAL')          terminal
  from dual;
  user_rec c_user%rowtype;
  v_mod  VARCHAR2(48);
  v_act  VARCHAR2(32);
  v_cli_info varchar2(64);
begin
  open c_user;
  fetch c_user into user_rec;
  close c_user;
  DBMS_APPLICATION_INFO.READ_MODULE (v_mod, v_act);
  --DBMS_APPLICATION_INFO.READ_CLIENT_INFO(v_cli_info);
  insert into track_detail
    (id, track_time, detail, client_info, curr_schema, curr_user, db_name, 
     host, ip, osuser, sessid, sess_user, terminal, module, action)
  values (track_seq.nextval, systimestamp, p_text,
          user_rec.client_info, user_rec.curr_schema, user_rec.curr_user, 
          user_rec.db_name,     user_rec.host,        user_rec.ip, 
          user_rec.osuser,      user_rec.sessid,      user_rec.sess_user, 
          user_rec.terminal,    v_mod,                v_act);
  commit;
end; 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-29T19:13:28.990

您可以使用系统触发器来执行此操作。

[我直接从http://www.psoug.org/reference/system_trigger.html](http://www.psoug.org/reference/system_trigger.html)复制了这段代码。

```
CREATE TABLE servererror_log (
error_datetime  TIMESTAMP,
error_user      VARCHAR2(30),
db_name         VARCHAR2(9),
error_stack     VARCHAR2(2000),
captured_sql    VARCHAR2(1000));

 CREATE OR REPLACE TRIGGER log_server_errors
    AFTER SERVERERROR
    ON DATABASE
    DECLARE
     captured_sql VARCHAR2(1000); 
    BEGIN
      SELECT q.sql_text
      INTO captured_sql
      FROM gv$sql q, gv$sql_cursor c, gv$session s
      WHERE s.audsid = audsid
      AND s.prev_sql_addr = q.address
      AND q.address = c.parent_handle;

      INSERT INTO servererror_log
      (error_datetime, error_user, db_name,
       error_stack, captured_sql)
      VALUES
      (systimestamp, sys.login_user, sys.database_name,
      dbms_utility.format_error_stack, captured_sql);
    END log_server_errors;
    / 
```

# vb.net - IntelliSense 不工作 VS2008 VB.Net

> ID：492707
> 
> 赞同：1
> 
> 时间：2009-01-29T18:01:17.653
> 
> 标签：vb.net, visual-studio-2008, intellisense

我意识到以前有人问过这个问题，但我还没有找到任何对我有用的东西。

我尝试过的事情：

*   将设置切换回默认值（多种方式）
*   项目构建/编译正常
*   关闭VS并重新启动

我唯一无法尝试的是删除“.ncb”文件，但这只是因为我找不到它。事实上，我们所有的项目中没有一个有这样的文件！

所以第一个问题是为什么我在解决方案的根目录中找不到这个文件？除了 .sln 之外，我在那里拥有的唯一文件是 .suo。

那么，如果这不起作用，我还有哪些其他选项可以卸载和重新安装？

至于它是如何发生的，这可能会有所帮助。在使用 VS2008 和 VSS6.0（糟糕）时，我通过 Find&Replace 对很多文件进行了一些我无意的更改（选择了整个解决方案而不是当前文档）。要撤消我在未保存的情况下退出的更改，请重新打开解决方案，然后取消结帐。在那之后我失去了智能！我无法想象它们之间的关系，但它可能会有所帮助。

谢谢，杰夫

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-29T18:19:33.653

这是用于 C++ 代码的吗？如果是这样，我的建议是根本不要尝试修复内置 IntelliSense，而是尝试一些 3rd 方替换。我最喜欢的绝对是[Visual Assist X](http://www.wholetomato.com/)，它更加健壮（它几乎永远不会停止工作，它甚至能够解析非常复杂的模板化和预处理的东西，这常常使 IntelliSense “丢失”。

Visual Assist 可与包括 Visual Basic 在内的其他语言一起使用，但我没有实际经验。尽管如此，还是有免费试用版的——你可以试试，我希望它甚至对于 VB 也会优于 IntelliSense。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-29T18:30:03.540

IntelliSense 通常在无法正确编译时停止工作。从头开始尝试一个新的简单项目，看看它是否有效，如果它有你的答案。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-29T18:36:23.933

回答：

我想出了如何解决它。显然，当我撤消这些更改时，我以某种方式排除了我没有从项目中获得智能感知的文件。

我只是右键单击它并说“包含在项目中”和中提琴！智能感知再次起作用。

很抱歉误报，但我感谢您的努力。

杰夫

# linux - 在 Linux 中捕获密码更改

> ID：492712
> 
> 赞同：1
> 
> 时间：2009-01-29T18:03:19.100
> 
> 标签：linux

当用户更改密码或其他用户的密码时，我如何捕获（或访问，如果某处有日志文件）？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-29T18:05:40.500

[PAM](http://www.kernel.org/pub/linux/libs/pam/)默认为我将它记录到 syslog 中。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-02T11:57:14.830

只需将 $PATH 环境变量上的 passwd 命令替换为 shell 脚本，例如执行以下操作：

*   将 $USER 环境变量内容记录到文件中
*   呼叫密码

或者您可以通过为 passwd 命令创建用户别名来执行相同操作：

```
alias passwd='echo "On `date +%Y%m%d` user $USER call passwd utility" && passwd' 
```

问候

**编辑：**如果您想记录用户调用 passwd 命令的位置，这是正确的，如果您想记录用户是否成功更改密码，请使用 shell 的 passwd 返回值。

# python - 在 Python 中反转正则表达式

> ID：492716
> 
> 赞同：43
> 
> 时间：2009-01-29T18:05:22.420
> 
> 标签：python, regex

我想反转一个正则表达式。即给定一个正则表达式，我想生成*任何*与该正则表达式匹配的字符串。

我知道如何使用有限状态机从理论计算机科学背景中做到这一点，但我只想知道是否有人已经编写了一个库来做到这一点。:)

我正在使用 Python，所以我想要一个 Python 库。

重申一下，我只想要*一个*与正则表达式匹配的字符串。像 ”。” 或 ".*" 会使无限数量的字符串与正则表达式匹配，但我并不关心所有选项。

我愿意让这个库只处理正则表达式的某个子集。

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2012-02-02T18:45:41.837

[其他人在这里](https://stackoverflow.com/questions/4627464/generate-a-string-that-matches-a-regex-in-python)有类似的（重复的？）问题，我想提供一个小助手库，用于使用我一直在研究[的 Python 生成随机字符串。](https://github.com/leapfrogonline/rstr)

它包括一个方法，`xeger()`允许您从正则表达式创建字符串：

```
>>> import rstr
>>> rstr.xeger(r'[A-Z]\d[A-Z] \d[A-Z]\d')
u'M5R 2W4' 
```

现在，它适用于大多数基本的正则表达式，但我确信它可以改进。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2009-02-02T02:59:15.647

虽然我认为这没有多大意义，但这里是：

```
import re
import string

def traverse(tree):
    retval = ''
    for node in tree:
        if node[0] == 'any':
            retval += 'x'
        elif node[0] == 'at':
            pass
        elif node[0] in ['min_repeat', 'max_repeat']:
            retval += traverse(node[1][2]) * node[1][0]
        elif node[0] == 'in':
            if node[1][0][0] == 'negate':
                letters = list(string.ascii_letters)
                for part in node[1][1:]:
                    if part[0] == 'literal':
                        letters.remove(chr(part[1]))
                    else:
                        for letter in range(part[1][0], part[1][1]+1):
                            letters.remove(chr(letter))
                retval += letters[0]
            else:
                if node[1][0][0] == 'range':
                    retval += chr(node[1][0][1][0])
                else:
                    retval += chr(node[1][0][1])
        elif node[0] == 'not_literal':
            if node[1] == 120:
                retval += 'y'
            else:
                retval += 'x'
        elif node[0] == 'branch':
            retval += traverse(node[1][1][0])
        elif node[0] == 'subpattern':
            retval += traverse(node[1][1])
        elif node[0] == 'literal':
            retval += chr(node[1])
    return retval

print traverse(re.sre_parse.parse(regex).data) 
```

我从[正则表达式语法](http://docs.python.org/library/re.html#regular-expression-syntax)到组的所有内容——这似乎是一个合理的子集——我忽略了一些细节，比如行尾。错误处理等作为练习留给读者。

在正则表达式中的 12 个特殊字符中，我们可以完全忽略 6 个（即使使用它们所应用的原子也可以忽略 2 个），4.5 导致微不足道的替换，1.5 让我们真正思考。

我认为由此产生的结果并不太有趣。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2009-01-30T18:27:24.713

我不知道有任何模块可以做到这一点。如果您在 Cookbook 或 PyPI 中没有找到类似的内容，您可以尝试使用（未记录的）re.sre_parse 模块自行滚动。这可能有助于您入门：

```
In [1]: import re

In [2]: a = re.sre_parse.parse("[abc]+[def]*\d?z")

In [3]: a
Out[3]: [('max_repeat', (1, 65535, [('in', [('literal', 97), ('literal', 98), ('literal', 99)])])), ('max_repeat', (0, 65535, [('in', [('literal', 100), ('literal', 101), ('literal', 102)])])), ('max_repeat', (0, 1, [('in', [('category', 'category_digit')])])), ('literal', 122)]

In [4]: eval(str(a))
Out[4]: 
[('max_repeat',
  (1, 65535, [('in', [('literal', 97), ('literal', 98), ('literal', 99)])])),
 ('max_repeat',
  (0,
   65535,
   [('in', [('literal', 100), ('literal', 101), ('literal', 102)])])),
 ('max_repeat', (0, 1, [('in', [('category', 'category_digit')])])),
 ('literal', 122)]

In [5]: a.dump()
max_repeat 1 65535
  in
    literal 97
    literal 98
    literal 99
max_repeat 0 65535
  in
    literal 100
    literal 101
    literal 102
max_repeat 0 1
  in
    category category_digit
literal 122 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-01-29T18:08:43.007

除非您的正则表达式非常简单（即没有星号或加号），否则将有无数个匹配它的字符串。如果您的正则表达式只涉及串联和交替，那么您可以将每个交替扩展到其所有可能性，例如`(foo|bar)(baz|quux)`可以扩展到列表中`['foobaz', 'fooquux', 'barbaz', 'barquux']`。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-02-04T02:36:11.370

虽然其他答案使用 re 引擎解析出我自己创建的元素，这些元素解析 re 并返回匹配的最小模式。（注意它不处理 [^ads]、花哨的分组结构、行首/行尾特殊字符）。如果你真的喜欢，我可以提供单元测试:)

```
import re
class REParser(object):
"""Parses an RE an gives the least greedy value that would match it"""

 def parse(self, parseInput):
    re.compile(parseInput) #try to parse to see if it is a valid RE
    retval = ""
    stack = list(parseInput)
    lastelement = ""
    while stack:
        element = stack.pop(0) #Read from front
        if element == "\\":
            element = stack.pop(0)
            element = element.replace("d", "0").replace("D", "a").replace("w", "a").replace("W", " ")
        elif element in ["?", "*"]:
            lastelement = ""
            element = ""
        elif element == ".":
            element = "a"
        elif element == "+":
            element = ""
        elif element == "{":
            arg = self._consumeTo(stack, "}")
            arg = arg[:-1] #dump the }     
            arg = arg.split(",")[0] #dump the possible ,
            lastelement = lastelement * int(arg)
            element = ""
        elif element == "[":
            element = self._consumeTo(stack, "]")[0] # just use the first char in set
            if element == "]": #this is the odd case of []<something>]
                self._consumeTo(stack, "]") # throw rest away and use ] as first element
        elif element == "|":
            break # you get to an | an you have all you need to match
        elif element == "(":
            arg = self._consumeTo(stack, ")")
            element = self.parse( arg[:-1] )

        retval += lastelement
        lastelement = element
    retval += lastelement #Complete the string with the last char

    return retval

 def _consumeTo(self, stackToConsume, endElement ):
    retval = ""
    while not retval.endswith(endElement):
        retval += stackToConsume.pop(0)
    return retval 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-01-29T18:09:52.893

我还没有看到一个 Python 模块来做到这一点，但我确实在 Perl: 中看到了一个（部分）实现[`Regexp::Genex`](http://search.cpan.org/~bowmanbs/Regexp-Genex-0.07/lib/Regexp/Genex.pm)。从模块的描述来看，它的实现似乎依赖于 Perl 正则表达式引擎的内部细节，所以即使从理论的角度来看，它也可能没有用（我没有研究过实现，只是按照文档中的注释进行的） ）。

我认为按照您的建议做一般是一个难题，可能需要使用非确定性编程技术。首先是解析正则表达式并构建解析树，然后遍历树并构建示例字符串。具有挑战性的位可能是诸如反向引用和避免实现中的无限循环之类的事情。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2017-04-06T13:22:11.170

[Exrex](https://github.com/asciimoo/exrex)可以从正则表达式创建字符串。

> Exrex 是一个命令行工具和 python 模块，可生成与给定正则表达式等的所有或随机匹配的字符串。

例子：

```
>>> exrex.getone('\d{4}-\d{4}-\d{4}-[0-9]{4}')
'3096-7886-2834-5671' 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2022-01-25T18:55:23.263

该`hypothesis`软件包有一个策略[`from_regex`](https://hypothesis.readthedocs.io/en/latest/data.html#hypothesis.strategies.from_regex)可以做到这一点：

```
>>> from hypothesis import strategies as st
>>> regex_strategy = st.from_regex(r'[0-9]{4}-[0-9]{8}-[0-9]{16}', fullmatch=True)
>>> regex_strategy.example()
'5000-00000000-0000000000000000'
>>> regex_strategy.example()
'8934-72779254-0542308893797380'
>>> regex_strategy.example()
'0000-00000000-0000000000000000'
>>> regex_strategy.example()
'9000-00000000-0000000000000000'
>>> regex_strategy.example()
'2791-03881838-5840296980736661' 
```

请注意，这`hypothesis`是一个用于模糊测试的库，而不仅仅是一个简单的数据生成器。因此建议谨慎：如果您将上述示例中的模式修改为`\d{4}-\d{8}-\d{16}`，则生成的示例可能类似于`'۵෫൮۹-๕꯱౦໓᠘௮᭒৮-꯳೩꘥៦६༣߃੮８༡႑۹᪒٩꧶'`看似出乎意料但与模式匹配的内容。

# unit-testing - 如何测试应用程序？

> ID：492719
> 
> 赞同：0
> 
> 时间：2009-01-29T18:05:46.460
> 
> 标签：unit-testing, testing, profiling

我一直在构建 IMO 一个非常酷的 RIA。但它现在接近完成，我需要对其进行测试，看看是否有任何错误或违反直觉的部分或类似的东西。但是怎么做？每当我要求某人尝试打破它时，他们都会看着它 3 分钟并说“它很坚固”。你们是怎么测试的？我以前从未使用过单元测试，实际上大约 3 个月前我什至从未听说过单元测试，我仍然不明白它是什么。我是否必须构建一个全新的应用程序来运行每个功能？这将花费很长时间，而且某些功能可能只会在某些情况下产生错误，所以我不了解单元测试。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-29T18:11:55.353

首先是系统地确保一切都以您期望的方式运行。然后，您想针对每个现实的硬件与可行且适当的软件安装组合进行尝试。然后，您希望了解人机交互的每一个点，并尝试放入尽可能多的数据、不放入任何数据以及可能导致异常的特殊数据。尝试按照您意想不到的顺序或工作流程做事，有时某些操作依赖于其他操作。您和您的朋友自然会按顺序执行这些步骤，如果有人不这样做会怎样？此外，让完全新手使用它是查看用户可能尝试的奇怪事物的好方法。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-29T18:22:08.720

这个问题非常开放，所以这篇文章不会回答你所有的问题。如果您可以改进您正在寻找的内容，那将有所帮助。

您可能想要进行两项主要的测试。第一个是单元测试，第二个是所谓的验收测试。

单元测试是在相对隔离的情况下尝试每个类/方法并确保它们工作。您可以使用 jUnit、nUnit 等作为框架来保存测试。采取一种方法，看看它可能期望的不同输入以及它的结果是什么。然后为这些输入/输出对中的每一个编写一个测试用例。这将告诉您大部分部件都按预期工作。

验收测试（或有时称为端到端测试）正在运行整个系统并确保其正常工作。列出您希望用户执行的场景列表。现在系统地尝试它们。尝试它们的变体。做他们的工作？如果是这样，您可能已经准备好将其推广给至少有限的受众。

另外，请查看James Whittaker 的[How to Break Software](https://rads.stackoverflow.com/amzn/click/com/0201796198)。它是最好的测试书籍之一，而且读起来很短。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-29T18:11:20.067

在测试版中发布它？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-29T18:11:32.033

它基于 Xcode 和 Cocoa 开发，但是[这个视频](http://www.vimeo.com/2725498)仍然是单元测试的一个很好的介绍。单元测试确实应该与开发一起完成，因此如果您的应用程序几乎完成，则需要一段时间才能实现。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-29T18:19:04.840

[Firebug](http://getfirebug.com/)有一个很好的 web 应用程序分析器。至于测试 JS 文件，我使用[Scriptaculous](http://wiki.github.com/madrobby/scriptaculous/unit-testing)。无论您使用什么后端，都需要进行全面测试。

但在你这样做之前，你需要了解什么是单元测试。单元测试正在验证所有单独的源代码单元是否按预期运行。这意味着您验证所有函数/方法的输出。基本上，读[这个](http://en.wikipedia.org/wiki/Unit_testing)。除了单元测试之外，还有不同的测试策略，例如集成测试，即测试不同模块之间的集成。您要求人们做的是验收测试，即验证它的外观和行为是否符合原始计划。 [这里](http://en.wikipedia.org/wiki/V-Model_(software_development))有更多关于各种测试策略的信息。

PS：总是测试边界条件

# sharepoint - 在 SharePoint 中使用表单身份验证 (FBA) 减少了功能

> ID：492729
> 
> 赞同：2
> 
> 时间：2009-01-29T18:09:08.963
> 
> 标签：sharepoint, forms-authentication

我有一个启用了 FBA 和 AD 身份验证的 moss 文档中心网站。创建图片库后，通过 FBA URL 访问该站点时，我的功能似乎有所减少。

我比较了每个 IIS 网站的 web.config 文件，它们是相同的（除了需要添加的 FBA 信息）。

这里有两张图片来说明我的意思。

**此图为通过AD认证访问网站时图片库中可用的选项：**

[替代文字 http://www.abbeylegal.com/Downloads/2006-07-26/Ad%20Authentication.jpg](http://www.abbeylegal.com/Downloads/2006-07-26/Ad%20Authentication.jpg)

**此图为通过FBA认证访问网站时图片库中可用的缩减选项：**

[替代文字 http://www.abbeylegal.com/Downloads/2006-07-26/FBA%20Authentication.jpg](http://www.abbeylegal.com/Downloads/2006-07-26/FBA%20Authentication.jpg)

其他人看到这种行为吗？我觉得真的很奇怪。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-29T18:23:30.260

此功能是设计使然。[根据微软](http://msdn.microsoft.com/en-us/library/bb977430.aspx "SharePoint 产品和技术中的表单身份验证（第 3 部分）：表单身份验证与 Windows 身份验证")：

当您将区域配置为使用表单身份验证时，默认情况下会清除启用客户端集成框。如果以这种方式配置区域，则会在功能上发生以下变化：

*   对远程接口的支持已关闭。这包括 WebDAV、SOAP 和 Microsoft Office FrontPage 远程过程调用 (RPC)。某些功能不可用，例如用于访问该站点中的内容的 Web 文件夹或 Web 服务。
*   一些工具栏项目不再出现：
    *   新文件
    *   在 Outlook 中打开
    *   在 Windows 资源管理器中打开
    *   导出到电子表格
    *   用数据库程序打开
    *   资源管理器视图选项被隐藏。
    *   创建访问视图选项被隐藏。
*   在图片库中，删除了以下功能：
    *   上传多个
    *   编辑图片
    *   下载
    *   发送至
*   在编辑控制块 (ECB) 菜单上，单击时出现的下拉菜单 - 文档库中的项目，以下项目被删除：
    *   在 Word 中编辑
    *   在 Excel 中编辑
    *   在 PowerPoint 中编辑
    *   讨论
    *   连接到 Outlook
*   在幻灯片库中，删除了以下功能：
    *   发布幻灯片
    *   发送到 PowerPoint
*   此外，将 SharePoint 数据与 Microsoft Office Outlook 同步不再有效。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-02-12T09:14:22.107

表单身份验证会减少一些功能，例如文档库中的功能。我们不会看到新文档，能够在电子表格中编辑它，能够用 Windows 资源管理器打开它等等。

为此，我们需要在 Authentication Provider中启用名为**Client Integration的功能。**启用后，我们将获得所有菜单项。

# jquery - jquery $.ajax 函数调用第一次很慢

> ID：492730
> 
> 赞同：3
> 
> 时间：2009-01-29T18:09:33.440
> 
> 标签：jquery, ajax

我正在使用 $.ajax 来更新数据库中的一些值。当页面第一次进行ajax调用时，它很慢。返回结果大约需要 5 或 6 秒。在第一次请求之后，它很快。我不确定是否有办法让第一个电话也很快。如果您有任何想法，请告诉我。

谢谢，斯里达尔

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-29T18:16:14.737

我的怀疑是数据库正在做一些缓存，随后的请求是从缓存中填充的。如果这仅发生在数据的第一个请求上，无论涉及的数据如何，那么我怀疑您要连接的 Web 服务需要在第一次操作时加载到内存中。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-29T18:12:27.787

方法调用的是什么类型的服务？可能是它调用的服务很慢，而不是 jQuery。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-29T18:30:40.870

为 IE 安装 Fiddler，或在 firefox 中运行 Firebug 控制台并查看请求/响应标头。你会看到延迟发生在哪里。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-30T16:21:09.040

感谢您的回复。慢的不是服务器端代码。如果是，那么每次都会很慢。这就是我们为了让它更快地工作而做的。当页面加载时，在 document.ready 函数中，我们进行了一个虚假的 Web 服务调用以消除初始延迟。现在它工作正常。服务器端代码实际上不是 Web 服务，而是 asp.net 中的页面方法。页面方法可以用作 asp.net 中的 web 服务。我将运行Firefox，看看会发生什么。

谢谢，斯里达尔。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-29T18:14:06.990

您的 ajax 调用是针对 ASP.NET 处理程序的吗？如果是这样，那么它可能是从 ASP.NET 加载应用程序域。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-29T18:14:12.603

您应该记录服务器端脚本执行时间。我同意[John](https://stackoverflow.com/questions/492730/jquery-ajax-function-call-is-slow-first-time/492745#492745)的观点，并建议您此时专注于服务器而不是 jQuery。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-07-08T15:48:25.053

If it only happens in IE7, this is because of IE7 rendering slowly. It might only happen the first time since jquery get/ajax will use the request in a way that can be cached by the browser.

Basically, it isn't clear if it's the rendering or the server.

It still could be the server though - query caching (or other kinds of caching) means the query can be slow first time only, then fast.

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2014-12-03T10:42:49.343

如果您在 ASP.NET 应用程序上发现问题

当然，第一个请求总是需要更长的时间。这个开销加载时间来自于为请求的应用程序进行 JIT 编译，除非您预编译了网站。

换句话说， **仅当您在 ASP.NET 应用程序上将发布标志设置为“调试”时才会发生如果将其设置为“发布”，您会发现它只是第一次对于每个请求的 url 会变慢，但下一次会继续惊人的。**

（英语不是我的母语）

# java - Java：没有接口实现？

> ID：492741
> 
> 赞同：0
> 
> 时间：2009-01-29T18:11:33.407
> 
> 标签：java, c++, interface, design-patterns

今天我在邮件中收到了我的书“Head First Design Patterns”。到目前为止非常有趣的东西，但是我确实对它的内容有疑问。

我没有 Java/C# 背景，也不希望现在跳入这些语言（我试图首先专注于 C++）。书中说java没有接口的实现......这意味着对于该接口的每次更改，您都必须修改实现该接口的所有子类。

这是如何在 C++ 中完成的？我错过了什么？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-01-29T18:15:37.093

本书作者的意思是，如果您更改接口成员的签名或添加新的签名，您将需要在实现类中进行这些更改，以便它们继续实现接口。

只要您使用完全相同的签名（即具有相同的名称、返回类型以及参数的顺序和类型）实现接口的成员，您就可以以任何您想要的方式更改实现类。

我的印象是你不太了解接口是如何工作的，所以我建议阅读[MSDN 上的 C# 接口规范，](http://msdn.microsoft.com/en-us/library/ms173156.aspx)这对我认为的主题非常清楚（除了你使用的 Java 之外，它在 Java 中几乎相同） “ **implements** ”关键字而不是冒号 (:) 来声明一个类实现了一个特定的接口）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-29T18:19:31.987

...如果您想更改接口中方法的签名，一个好的 IDE（eclipse、netbeans...）可以帮助您重构所有实现此接口的类。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-29T18:20:09.597

在 C++ 中也是如此。

C++没有interface关键字，但是纯虚类，所有纯虚方法，都是一样的想法。

如果您更改了纯虚拟类中的方法签名，则它的所有子类都必须遵循才能编译。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-29T18:19:29.287

Java 接口的 C++ 等价物将是一个只有纯虚拟方法的类。

你提到你已经“看到了很多这些 Runnable/Threadable 接口，可以在不触及这些子类的情况下进行修改。” 从您的描述中很难确定，但您之前可能看到的是这样的：

```
Runnable r = new Runnable() {
    public void run() {
        // do something here
    }
}; 
```

`Runnable`这是一个实现接口的匿名类；它不会以任何方式修改界面。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-29T18:22:39.607

[接口](http://en.wikipedia.org/wiki/Interface_(Java))定义了实现该接口的类应遵循的约定。这类似于抽象基类——它基本上将方法的实现委托给派生类。

是的，如果您修改接口 - 您将必须修改*实现*该接口的所有类。我的猜测是，您在 Java 代码中看到的 Runnable 实例是匿名类，它们实际上实现了 Runnable，而不是修改接口本身。

```
Runnable myOwnThread = new Runnable() {
  public void run() {
   // Do something here
  }
}; 
```

在 Java 中，不允许修改标准库中提供的接口（和类）。C++ 中的等价物可能是**纯虚拟类**。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-29T22:47:54.190

好的，我会问他明显的问题：

如果你想用 C++ 做设计模式，你为什么要阅读除了最初的“四种[设计模式](https://rads.stackoverflow.com/amzn/click/com/0201633612)帮”的书之外的任何东西？

是的，具有纯虚拟方法的 C++ 类相当于 Java 或 C# 接口。

# binary - 帮助对二进制文件格式进行逆向工程的工具

> ID：492751
> 
> 赞同：83
> 
> 时间：2009-01-29T18:13:10.907
> 
> 标签：binary, reverse-engineering, file-format, binary-data

**有哪些工具可以帮助解码未知的二进制数据格式？**

我知道 Hex Workshop 和 010 Editor 都支持结构。对于已知的固定格式，这些在有限的范围内是可以的，但对于更复杂的东西很难使用，尤其是对于未知格式。我想我正在寻找脚本语言或可编写脚本的 GUI 工具的模块。

例如，我希望能够从有限的已知信息（也许是一个幻数）中找到一个数据块中的结构。一旦我找到了一个结构，然后按照已知的长度和偏移量词来找到其他结构。然后在有意义的地方递归和迭代地重复这个。

在我的梦想中，甚至可能会根据我已经告诉系统的内容自动识别可能的偏移量和长度！

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2009-02-18T21:41:58.663

以下是我想到的一些提示：

根据我的经验，交互式脚本语言（我使用 Python）可以提供很大帮助。你可以编写一个简单的框架来处理二进制流和一些简单的算法。然后你可以编写脚本来获取你的二进制文件并检查各种事情。例如：

对各个部分做一些统计分析。例如，随机数据会告诉您这部分可能已被压缩/加密。零可能意味着部件之间的填充。零散的零可能意味着整数值或 Unicode 字符串等等。尝试发现各种偏移。尝试将部分二进制文件转换为 2 或 4 字节整数或浮点数，打印它们并查看它们是否有意义。编写一些函数来搜索数据中重复或非常相似的部分，这样您就可以轻松地发现标题。

尝试找到尽可能多的字符串，尝试不同的编码（c 字符串、pascal 字符串、utf8/16 等）。有一些很好的工具（我认为 Hex Workshop 有这样的工具）。字符串可以告诉你很多。

祝你好运！

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2011-12-08T16:45:15.943

对于 Mac OS X，有一个比我的 iBored 更好的工具：Synalyze It！( [http://www.synalysis.net/](http://www.synalysis.net/) )

与[iBored](http://apps.tempel.org/iBored/)相比，它更适合非阻塞文件，同时还可以完全控制结构，包括可编写脚本（使用 Lua）。它也可以更好地可视化结构。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2009-10-23T16:55:21.320

**图普尼**；据我所知，微软研究院没有直接提供，但是有一篇关于这个工具的论文可能会引起想要编写类似程序（可能是开源）的人的兴趣：

[Tupni：输入格式的自动逆向工程](http://research.microsoft.com/apps/pubs/default.aspx?id=101326)（ @ACM[数字图书馆](http://portal.acm.org/citation.cfm?id=1455820)）

> **抽象的**
> 
> 最近的工作已经确立了协议或文件格式规范的自动逆向工程的重要性。但是，以前的工具逆向工程的格式错过了对安全应用程序至关重要的重要信息。在本文中，我们介绍了 Tupni，这是一种可以对具有丰富信息集的输入格式进行逆向工程的工具，包括记录序列、记录类型和输入约束。Tupni 可以将格式规范推广到多个输入。我们已经实现了 Tupni 的原型，并在 10 种不同的格式上对其进行了评估：五种文件格式（WMF、BMP、JPG、PNG 和 TIF）和五种网络协议（DNS、RPC、TFTP、HTTP 和 FTP）。Tupni 识别了测试输入中的所有记录序列。我们还表明，通过聚合多个 WMF 文件，Tupni 可以为 WMF 导出更完整的格式规范。此外，我们通过使用它为零日漏洞签名生成提供的丰富信息展示了 Tupni 的实用性，这在以前的逆向工程工具中是不可能的。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2009-01-29T18:53:17.317

我最近发布的我自己的工具“iBored”可以完成其中的一部分。我编写了可视化和调试文件系统格式（UDF、HFS、ISO9660、FAT 等）的工具，并实现了搜索、复制以及后来的结构和模板支持。结构支持非常简单，模板是一种动态识别结构的方法。

整个事情都可以用 Visual BASIC 方言进行编程，允许您测试值、读取特定块等等。

该工具是免费的，适用于所有平台（Win、Mac、Linux），但由于它是我刚刚向公众发布以共享它的个人工具，因此没有太多文档记录。

但是，如果您想尝试一下，并想提供反馈，我可能会添加更多有用的功能。

我什至会开源它，但由于它是用[REALbasic](http://www.realbasic.com/)编写的，我怀疑很多人会加入这样的项目。

链接：[iBored 主页](http://apps.tempel.org/iBored/ "iBored 主页")

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2009-02-24T21:37:36.893

我仍然偶尔使用一个旧的十六进制编辑器，称为 AXE，高级十六进制编辑器。它现在似乎已经从互联网上基本消失了，尽管谷歌应该仍然可以为你找到它。我知道的最后一个版本是 3.4 版，但我真的只使用了免费供个人使用的 2.1 版。

它最有趣的功能，也是我最常用于破译各种游戏和图形格式的功能，是它的图形视图模式。这基本上只是向您展示了每个字节都变成了颜色编码像素的文件。听起来很简单，它有时让我的逆向工程尝试变得容易得多。

不过，我想用眼睛做这件事与做自动分析完全相反，而且图形模式对于查找和跟踪偏移量没有多大用处......

较新的版本有一些听起来可以满足您需求的功能（脚本、规律查找器、语法生成器），但我不知道它们有多好。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2013-05-23T12:52:29.773

Hachoir是一个 Python 库，用于[将](https://github.com/vstinner/hachoir3)任何二进制格式解析为字段，然后浏览字段。它有很多常见格式的解析器，但您也可以为您的文件编写自己的解析器（例如，当使用读取或写入二进制文件的代码时，我通常首先编写一个 Hachoir 解析器以帮助调试）。不过，看起来该项目现在几乎没有活动。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2013-01-26T22:03:18.203

我的项目[icebuddha.com](http://icebuddha.com)支持使用 python 来描述浏览器中的格式。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2022-02-07T10:02:53.320

[Kaitai](https://github.com/kaitai-io/kaitai_struct)是一种用于描述数据流中二进制结构的开源语言。它带有一个翻译器，可以输出许多编程语言的解析代码，以包含在您自己的程序代码中。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2011-12-07T07:27:10.347

我对类似问题的回答的剪切粘贴：

一种工具是[WinOLS](http://www.evc.de/en/product/ols/software/default.asp "WinOLS")，它设计用于解释和编辑车辆发动机管理计算机二进制图像（主要是查找表中的数字数据）。它支持各种字节序格式（尽管我认为不是 PDP），并以各种宽度和偏移量查看数据，定义数组区域（地图）并使用各种缩放和偏移选项以 2D 或 3D 可视化它们。它还具有启发式/统计自动地图查找器，可能对您有用。

它是一个商业工具，但免费的演示可以让您做所有事情，除了保存对二进制文件的更改并使用您不需要的引擎管理功能。

# java - 如何在 MacOS 10.5.6 上运行 Eclipse 3.4.1？

> ID：492754
> 
> 赞同：2
> 
> 时间：2009-01-29T18:13:47.207
> 
> 标签：java, eclipse, macos

我想在 MacOS 10.5.6 上运行 Eclipse 3.4.1？我想我在运行 eclipse 时使用的是 java 1.5：

$ which java /usr/bin/java $ java -version java version "1.5.0_16" Java(TM) 2 Runtime Environment, Standard Edition (build 1.5.0_16-b06-284) Java HotSpot(TM) Client VM (build 1.5 .0_16-133，混合模式，共享）

然后我点击 eclipse 图标。

在 Preferences->Java->Installed JREs 中，我确实单击了“JVM 1.6.0”，因为我的项目需要使用 1.6。

但是在 .log 文件中，我得到了这些错误，为什么有类文件错误的版本号？我该如何解决？

```
 !SESSION 2009-01-29 10:07:29.618 -----------------------------------------------
eclipse.buildId=M20080911-1700
java.version=1.5.0_16
java.vendor=Apple Inc.
BootLoader constants: OS=macosx, ARCH=x86, WS=carbon, NL=en_US
Framework arguments:  -keyring /Users/samuel/.eclipse_keyring -showlocation
Command-line arguments:  -os macosx -ws carbon -arch x86 -keyring /Users/samuel/
.eclipse_keyring -consoleLog -showlocation

!ENTRY com.android.ide.eclipse.adt 4 0 2009-01-29 10:07:42.947
!MESSAGE Failed to start com.android.ide.eclipse.editors
!STACK 0
org.osgi.framework.BundleException: Exception in com.android.ide.eclipse.editors
.EditorsPlugin.start() of bundle com.android.ide.eclipse.editors.
        at org.eclipse.osgi.framework.internal.core.BundleContextImpl.startActiv
ator(BundleContextImpl.java:1028)
        at org.eclipse.osgi.framework.internal.core.BundleContextImpl.start(Bund
leContextImpl.java:984)
        at org.eclipse.osgi.framework.internal.core.BundleHost.startWorker(Bundl
eHost.java:346)
        at org.eclipse.osgi.framework.internal.core.AbstractBundle.start(Abstrac
tBundle.java:265)
        at com.android.ide.eclipse.adt.AdtPlugin$11.run(Unknown Source)
Caused by: java.lang.UnsupportedClassVersionError: Bad version number in .class 
file
        at java.lang.ClassLoader.defineClass1(Native Method)
        at java.lang.ClassLoader.defineClass(ClassLoader.java:675)
        at java.lang.ClassLoader.defineClass(ClassLoader.java:520)
        at com.android.ide.eclipse.editors.resources.manager.ProjectClassLoader.
findClass(Unknown Source)
        at java.lang.ClassLoader.loadClass(ClassLoader.java:316)
        at java.lang.ClassLoader.loadClass(ClassLoader.java:251)
        at com.android.ide.eclipse.editors.resources.manager.CompiledResourcesMo
nitor.loadAndParseRClass(Unknown Source)
        at com.android.ide.eclipse.editors.resources.manager.CompiledResourcesMo
nitor.projectOpenedWithWorkspace(Unknown Source)
        at com.android.ide.eclipse.editors.resources.manager.ResourceMonitor.add
ProjectListener(Unknown Source)
        at com.android.ide.eclipse.editors.resources.manager.CompiledResourcesMo
nitor.setupMonitor(Unknown Source)
        at com.android.ide.eclipse.editors.resources.manager.ResourceManager.set
up(Unknown Source)
        at com.android.ide.eclipse.editors.EditorsPlugin.start(Unknown Source)
        at org.eclipse.osgi.framework.internal.core.BundleContextImpl$2.run(Bund
leContextImpl.java:1009)
        at java.security.AccessController.doPrivileged(Native Method)
        at org.eclipse.osgi.framework.internal.core.BundleContextImpl.startActiv
ator(BundleContextImpl.java:1003)
        ... 4 more
Root exception:
java.lang.UnsupportedClassVersionError: Bad version number in .class file
        at java.lang.ClassLoader.defineClass1(Native Method)
        at java.lang.ClassLoader.defineClass(ClassLoader.java:675)
        at java.lang.ClassLoader.defineClass(ClassLoader.java:520)
        at com.android.ide.eclipse.editors.resources.manager.ProjectClassLoader.
findClass(Unknown Source)
        at java.lang.ClassLoader.loadClass(ClassLoader.java:316)
        at java.lang.ClassLoader.loadClass(ClassLoader.java:251)
        at com.android.ide.eclipse.editors.resources.manager.CompiledResourcesMo
nitor.loadAndParseRClass(Unknown Source)
        at com.android.ide.eclipse.editors.resources.manager.CompiledResourcesMo
nitor.projectOpenedWithWorkspace(Unknown Source)
        at com.android.ide.eclipse.editors.resources.manager.ResourceMonitor.add
ProjectListener(Unknown Source)
        at com.android.ide.eclipse.editors.resources.manager.CompiledResourcesMo
nitor.setupMonitor(Unknown Source)
        at com.android.ide.eclipse.editors.resources.manager.ResourceManager.set
up(Unknown Source)
        at com.android.ide.eclipse.editors.EditorsPlugin.start(Unknown Source)
        at org.eclipse.osgi.framework.internal.core.BundleContextImpl$2.run(Bund
leContextImpl.java:1009)
        at java.security.AccessController.doPrivileged(Native Method)
        at org.eclipse.osgi.framework.internal.core.BundleContextImpl.startActiv
ator(BundleContextImpl.java:1003)
        at org.eclipse.osgi.framework.internal.core.BundleContextImpl.start(Bund
leContextImpl.java:984)
        at org.eclipse.osgi.framework.internal.core.BundleHost.startWorker(Bundl
eHost.java:346)
        at org.eclipse.osgi.framework.internal.core.AbstractBundle.start(Abstrac
tBundle.java:265)
        at com.android.ide.eclipse.adt.AdtPlugin$11.run(Unknown Source) 

```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-29T18:19:29.927

Intel 上 Mac OS X 上的 Eclipse 仅适用于 JDK 5（这太可怕了）。我总是必须创建两个版本的插件。

但是，您使用的 Android 编辑器插件似乎是针对 1.6 编译的，所以我不确定是否有解决方案...

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-29T18:15:28.110

看看这一行：

```
java.lang.UnsupportedClassVersionError: Bad version number in .class file 
```

该错误意味着您正在尝试在比您用于编译的 JDK 更旧的 JRE 中执行字节码。在您的情况下，版本 5 JRE 无法识别 v6 JDK 添加的文件魔法，并在遇到无法理解的字节码之前退出。

解决方案是为编译器指定一个目标版本，或者升级您的 JRE。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-29T18:19:48.583

如果你想在你的项目中安装 1.6，你需要在你的 Mac 上安装 java 6。您应该可以在这里获得 java 6：

[http://developer.apple.com/java/download/](http://developer.apple.com/java/download/)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-21T01:24:45.790

我能够让 Eclipse 3.5M5 以 JDK 1.6.0 作为其基本 VM 运行，并从上面稍微修改了路径：

> ./eclipse -vm /System/Library/Frameworks/JavaVM.framework/Versions/1.6.0

更好的是，我可以将它放在 /Applications/eclipse3.5/Eclipse.app/Contents/MacOS 中的 eclipse.ini 文件中，只要它高于“-vmargs”即可。例如：

```
-startup
../../../plugins/org.eclipse.equinox.launcher_1.0.200.v20090128-1500.jar
--launcher.library
../../../plugins/org.eclipse.equinox.launcher.cocoa.macosx.x86_64_1.0.0.v20081125-1800
-vm
/System/Library/Frameworks/JavaVM.framework/Versions/1.6.0
-showsplash
org.eclipse.platform
-vmargs
... 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-29T19:58:52.737

您可以尝试最新的 Galileo (Eclipse 3.5) 里程碑。它不是很稳定，但可以在 Apple 的 JDK 1.6 上运行。[在这里](http://download.eclipse.org/eclipse/downloads/)获取（3.5M4 是最新的）。确保您获得可可 64 位版本。

开始它`-vm /System/Library/Frameworks/JavaVM.framework/Versions/1.6/Commands/java`

再次，具有所有含义的早期测试版。

# jquery - ASP.NET MVC 中的 jQuery 与 MicrosoftAjax

> ID：492770
> 
> 赞同：12
> 
> 时间：2009-01-29T18:15:56.110
> 
> 标签：jquery, asp.net-mvc, asp.net-ajax

在什么情况下，您会在 ASP.NET MVC 应用程序中使用 MicrosoftAjax 而不是 jQuery？

根据 Scott Cate 在这个播客中的说法，Scott Cate 的[面向对象的 AJAX](http://www.hanselminutes.com/default.aspx?showID=146) MicrosoftAjax 非常适合向服务器发送和检索数据。一旦数据到达客户端，jQuery 非常适合通过 DOM 操作数据。然而，通过一个简单的 jQuery 表单插件，您可以非常轻松地使用 jQuery 发送和检索数据。通常只有一行代码。

所以我想知道 ASP.NET MVC 中的 MicrosoftAjax 和 jQuery 之间有什么区别？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-01-29T18:20:15.480

使用 jQuery —— 甚至微软也看到了他们方法的错误。下一版本的 Visual Studio 将包含 jQuery 并通过智能感知支持它。关于简单插件，您也是完全正确的。MS Ajax 虽然最初有时更易于使用，但速度缓慢且臃肿。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-29T20:18:48.140

我试图或多或少地并排使用两者。

内置的 ajax 助手工作正常。

但是jquery占用空间更小，使用起来更透明。

当使用 ajax 助手时，我得到了立竿见影的结果，但不知道幕后发生了什么

此外，如果您必须桥接 jquery 以扩展您的 ajax 场景，您不妨从那里开始。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-29T18:27:38.117

jQuery 重量更轻，更容易集成到标准的 javascript 函数中，并且拥有强大的社区支持。MS Ajax 很重，但我怀疑他们正在重写所有 AJAX。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-11T03:15:00.773

请务必使用该[`jQuery.ajax`](http://docs.jquery.com/Ajax/jQuery.ajax#options)功能，而不是[`jQuery.get`](http://docs.jquery.com/Ajax/jQuery.get#urldatacallbacktype)- 它更冗长，但对于错误处理至关重要。

**不要仅仅因为`jQuery.get()`更容易而忽略错误处理代码。它可能适用于您的测试，但在许多情况下您需要某种错误处理它不起作用。**

我真的不确定为什么 get 没有错误处理，但这里引用了 jQuery 文档中的 get ：

> 这是向服务器发送简单的 GET 请求而无需使用更复杂的 $.ajax 函数的简单方法。它允许指定将在请求完成时执行的单个回调函数（并且仅当响应具有成功的响应代码时）。如果您需要同时拥有错误和成功回调，您可能需要使用 $.ajax。

# c# - 使用 locbaml 方法在运行时更改 CurrentUICulture

> ID：492778
> 
> 赞同：1
> 
> 时间：2009-01-29T18:17:26.060
> 
> 标签：c#, wpf, localization

使用 locbaml 方法，我创建了一个新的资源 dll，并试图以编程方式即时更改 CurrentCulture 和 CurrentUICulture，但它似乎不起作用。

```
System.Globalization.CultureInfo ci = new System.Globalization.CultureInfo("ar-SA");
System.Threading.Thread.CurrentThread.CurrentUICulture = ci;
System.Threading.Thread.CurrentThread.CurrentCulture = ci; 
```

我错过了一些明显的东西吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-28T19:53:53.707

据我所知，使用“locbaml”方法您无法即时切换语言，因此如果需要，您必须在显示任何 UI 之前适当地设置 Current[UI]Culture。

# css - CSS选择器用于选择另一个元素之前的元素？

> ID：492786
> 
> 赞同：67
> 
> 时间：2009-01-29T18:19:27.197
> 
> 标签：css, css-selectors

我正在为我的网站创建一个登录页面，当文本框获得焦点时，我想将输入框**之前的标签加粗。**现在我有以下标记：

```
<label for="username">Username:</label>
<input type="textbox" id="username" />

<label for="password">Password:</label>
<input type="textbox" id="password" /> 
```

我可以使用相邻选择器来选择文本框**之后**的标签，但是我不能选择它之前的元素。我可以使用这个 CSS 选择器规则，但它只选择之后的标签，所以当用户名文本框获得焦点时，密码标签变为粗体。

```
input:focus + label {font-weight: bold} 
```

我能做些什么来完成这项工作吗？我知道可以使用 JavaScript 轻松地做到这一点，但如果可能的话，我想使用纯基于 CSS 的解决方案，我只是想不出办法。

* * *

## 回答 #1

> 赞同：38
> 
> 时间：2012-07-25T17:14:58.800

[CSS Selectors 4 Spec](http://www.w3.org/TR/selectors4/#subject)提供了一种语法来定义选择器的“主题”，使用`!`. 截至 2016 年初，这在任何浏览器中均不可用。我将其包括在内，因为一旦浏览器实现此语法，这将是使用纯 CSS 执行此操作的正确方法。

鉴于问题中的标记

```
<label for="username">Username:</label>
<input type="textbox" id="username" />

<label for="password">Password:</label>
<input type="textbox" id="password" /> 
```

这个 CSS 可以解决问题。

```
label:has(+ input:focus) {font-weight: bold} 
```

当然，这假设浏览器实际上实现了主题选择器，并且没有与此语法如何与`:focus`伪类一起使用相关的错误。

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2009-01-29T18:39:52.177

如果`input`在`label`. 只是把`input`之前的`label`，然后修改布局放到`label`之前`input`。这是一个例子：

```
<head runat="server">
    <title></title>
    <style type="text/css">
    input:focus + label {font-weight: bold}
    </style>
</head>
<body>
    <form id="form1" runat="server">
    <div style="direction:rtl">
        <input type="text" id="username" />
        <label for="username">Username:</label>
    </div>
    <div style="direction:rtl">
        <input type="password" id="password" />
        <label for="password">Password:</label>
    </div>
    </form>
</body> 
```

（这是一种 hack，我个人会使用 javascript 来做到这一点）

```
input:focus + label {font-weight: bold}
```

```
<form id="form1" runat="server">
  <div style="direction:rtl">
    <input type="text" id="username" />
    <label for="username">Username:</label>
  </div>
  <div style="direction:rtl">
    <input type="password" id="password" />
    <label for="password">Password:</label>
  </div>
</form>
```

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-01-29T18:30:12.260

没有选择器可以使用 CSS 为您提供上一个元素。

您将需要使用 javascript 来处理您所追求的。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-01-29T18:35:29.003

使用这个选择器：

```
label[for=username]
{
font-weight: bold
} 
```

这将选择属性“for”中值为“username”的标签

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-01-29T19:58:43.313

将输入元素浮动到右侧，实现正确的元素顺序，而无需更改使用方向：rtl 获得的标签文本中“用户名”和“：”的顺序。

```
<style type="text/css">
    form {text-align: right;}
    input:focus + label {font-weight: bold}
    input {float:right; clear:right;}
</style>
<form>
    <div>
        <input type="text" id="username" />
        <label for="username">Username:</label>
    </div>
    <div>
        <input type="password" id="password" />
        <label for="password">Password:</label>
    </div>
</form> 
```

# c# - InvariantCulture 和 Ordinal 字符串比较之间的区别

> ID：492799
> 
> 赞同：633
> 
> 时间：2009-01-29T18:21:45.257
> 
> 标签：c#, .net, string-comparison, ordinal

在c#中比较两个字符串是否相等时，InvariantCulture和Ordinal比较有什么区别？

* * *

## 回答 #1

> 赞同：338
> 
> 时间：2009-01-29T18:44:33.433

## 不变文化

使用一组“标准”字符顺序（a、b、c、...等）。这与某些特定的语言环境形成对比，后者可能以不同的顺序对字符进行排序（“a-with-acute”可能在“a”之前***或***之后，具体取决于语言环境，等等）。

## 序数

另一方面，纯粹查看代表字符的原始字节的值。

* * *

[http://msdn.microsoft.com/en-us/library/e6883c06.aspx](http://msdn.microsoft.com/en-us/library/e6883c06.aspx)上有一个很好的示例，它显示了各种 StringComparison 值的结果。一直到最后，它显示（摘录）：

```
StringComparison.InvariantCulture:
LATIN SMALL LETTER I (U+0069) is less than LATIN SMALL LETTER DOTLESS I (U+0131)
LATIN SMALL LETTER I (U+0069) is less than LATIN CAPITAL LETTER I (U+0049)
LATIN SMALL LETTER DOTLESS I (U+0131) is greater than LATIN CAPITAL LETTER I (U+0049)

StringComparison.Ordinal:
LATIN SMALL LETTER I (U+0069) is less than LATIN SMALL LETTER DOTLESS I (U+0131)
LATIN SMALL LETTER I (U+0069) is greater than LATIN CAPITAL LETTER I (U+0049)
LATIN SMALL LETTER DOTLESS I (U+0131) is greater than LATIN CAPITAL LETTER I (U+0049) 
```

你可以看到 InvariantCulture 产生 (U+0069, U+0049, U+00131)，Ordinal 产生 (U+0049, U+0069, U+00131)。

* * *

## 回答 #2

> 赞同：324
> 
> 时间：2013-11-20T00:40:49.873

例如，它确实很重要 - 有一种叫做字符扩展的东西

```
var s1 = "Strasse";
var s2 = "Straße";

s1.Equals(s2, StringComparison.Ordinal);           //false
s1.Equals(s2, StringComparison.InvariantCulture);  //true 
```

随着`InvariantCulture`ß 字符扩展为 ss。

* * *

## 回答 #3

> 赞同：137
> 
> 时间：2014-02-25T10:48:40.357

指向[在 .NET Framework 中使用字符串的最佳实践](http://msdn.microsoft.com/en-us/library/dd465121.aspx)：

*   使用`StringComparison.Ordinal`or`StringComparison.OrdinalIgnoreCase`进行比较作为与文化无关的字符串匹配的安全默认值。
*   使用比较`StringComparison.Ordinal`或`StringComparison.OrdinalIgnoreCase`以获得更好的性能。
*   根据比较在语言上不相关（例如，符号）时使用非语言`StringComparison.Ordinal`或`StringComparison.OrdinalIgnoreCase`值而不是字符串操作。`CultureInfo.InvariantCulture`

最后：

*   **`StringComparison.InvariantCulture`在大多数情况下不要使用基于的字符串操作**。少数例外之一是当您保留具有语言意义但与文化无关的数据时。

* * *

## 回答 #4

> 赞同：60
> 
> 时间：2009-02-09T19:06:20.740

另一个方便的区别（在英语中重音不常见）是 InvariantCulture 比较首先按不区分大小写的方式比较整个字符串，然后如果有必要（并且要求）在首先比较不同的字母后按大小写进行区分。（当然，您也可以进行不区分大小写的比较，这不会区分大小写。） **更正：**重音字母被认为是相同字母的另一种风格，首先比较字符串，忽略重音符号，然后在通用字母全部匹配时考虑它们（很像不同的大小写，除非在不区分大小写的比较中最终被忽略）。这将其他相同单词的重音版本组合在一起，而不是在第一个重音差异处完全分开。这是您通常会在字典中找到的排序顺序，大写的单词紧挨着它们的小写字母，重音字母靠近相应的非重音字母。

序数比较严格比较数字字符值，在第一个差异处停止。这将大写字母与小写字母完全分开（并且重音字母可能与这些字母分开），因此大写单词的排序与它们的小写等价词相去甚远。

InvariantCulture 还认为大写字母大于小写字母，而 Ordinal 认为大写字母小于小写字母（在计算机使用小写字母之前的旧时代 ASCII 的保留，大写字母首先分配，因此其值低于小写字母稍后添加）。

例如，按序数：`"0" < "9" < "A" < "Ab" < "Z" < "a" < "aB" < "ab" < "z" < "Á" < "Áb" < "á" < "áb"`

通过 InvariantCulture：`"0" < "9" < "a" < "A" < "á" < "Á" < "ab" < "aB" < "Ab" < "áb" < "Áb" < "z" < "Z"`

* * *

## 回答 #5

> 赞同：35
> 
> 时间：2014-06-10T23:39:49.960

尽管问题是关于*平等*的，但为了快速直观地参考，这里使用几种文化对一些字符串*进行排序，说明了那里的一些特质。*

```
Ordinal          0 9 A Ab a aB aa ab ss Ä Äb ß ä äb ぁ あ ァ ア 亜 Ａ
IgnoreCase       0 9 a A aa ab Ab aB ss ä Ä äb Äb ß ぁ あ ァ ア 亜 Ａ
--------------------------------------------------------------------
InvariantCulture 0 9 a A Ａ ä Ä aa ab aB Ab äb Äb ss ß ァ ぁ ア あ 亜
IgnoreCase       0 9 A a Ａ Ä ä aa Ab aB ab Äb äb ß ss ァ ぁ ア あ 亜
--------------------------------------------------------------------
da-DK            0 9 a A Ａ ab aB Ab ss ß ä Ä äb Äb aa ァ ぁ ア あ 亜
IgnoreCase       0 9 A a Ａ Ab aB ab ß ss Ä ä Äb äb aa ァ ぁ ア あ 亜
--------------------------------------------------------------------
de-DE            0 9 a A Ａ ä Ä aa ab aB Ab äb Äb ß ss ァ ぁ ア あ 亜
IgnoreCase       0 9 A a Ａ Ä ä aa Ab aB ab Äb äb ss ß ァ ぁ ア あ 亜
--------------------------------------------------------------------
en-US            0 9 a A Ａ ä Ä aa ab aB Ab äb Äb ß ss ァ ぁ ア あ 亜
IgnoreCase       0 9 A a Ａ Ä ä aa Ab aB ab Äb äb ss ß ァ ぁ ア あ 亜
--------------------------------------------------------------------
ja-JP            0 9 a A Ａ ä Ä aa ab aB Ab äb Äb ß ss ァ ぁ ア あ 亜
IgnoreCase       0 9 A a Ａ Ä ä aa Ab aB ab Äb äb ss ß ァ ぁ ア あ 亜 
```

观察：

*   `de-DE`, `ja-JP`, 并`en-US`以相同的方式排序
*   `Invariant`仅与上述三种文化`ss`不同`ß`
*   `da-DK`排序完全不同
*   `IgnoreCase`旗帜对所有采样文化都很重要

用于生成上表的代码：

```
var l = new List<string>
    { "0", "9", "A", "Ab", "a", "aB", "aa", "ab", "ss", "ß",
      "Ä", "Äb", "ä", "äb", "あ", "ぁ", "ア", "ァ", "Ａ", "亜" };

foreach (var comparer in new[]
{
    StringComparer.Ordinal,
    StringComparer.OrdinalIgnoreCase,
    StringComparer.InvariantCulture,
    StringComparer.InvariantCultureIgnoreCase,
    StringComparer.Create(new CultureInfo("da-DK"), false),
    StringComparer.Create(new CultureInfo("da-DK"), true),
    StringComparer.Create(new CultureInfo("de-DE"), false),
    StringComparer.Create(new CultureInfo("de-DE"), true),
    StringComparer.Create(new CultureInfo("en-US"), false),
    StringComparer.Create(new CultureInfo("en-US"), true),
    StringComparer.Create(new CultureInfo("ja-JP"), false),
    StringComparer.Create(new CultureInfo("ja-JP"), true),
})
{
    l.Sort(comparer);
    Console.WriteLine(string.Join(" ", l));
} 
```

* * *

## 回答 #6

> 赞同：28
> 
> 时间：2010-06-02T20:56:59.143

不变量是一种语言上合适的比较类型。
序数是一种二进制类型的比较。（更快）
见[http://www.siao2.com/2004/12/29/344136.aspx](http://www.siao2.com/2004/12/29/344136.aspx)

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2015-07-11T21:22:57.947

这是一个示例，其中使用 InvariantCultureIgnoreCase 和 OrdinalIgnoreCase 进行字符串相等性比较不会给出相同的结果：

```
string str = "\xC4"; //A with umlaut, Ä
string A = str.Normalize(NormalizationForm.FormC);
//Length is 1, this will contain the single A with umlaut character (Ä)
string B = str.Normalize(NormalizationForm.FormD);
//Length is 2, this will contain an uppercase A followed by an umlaut combining character
bool equals1 = A.Equals(B, StringComparison.OrdinalIgnoreCase);
bool equals2 = A.Equals(B, StringComparison.InvariantCultureIgnoreCase); 
```

如果你运行它，equals1 将为 false，equals2 将为 true。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2017-11-29T20:09:08.430

无需使用花哨的 unicode 字符示例来显示差异。这是我今天发现的一个简单示例，令人惊讶，它仅包含 ASCII 字符。

根据 ASCII 表，`0`(48, 0x30) 按顺序比较时小于`_`(95, 0x5F)。InvariantCulture 会说相反（下面的 PowerShell 代码）：

```
PS> [System.StringComparer]::Ordinal.Compare("_", "0")
47
PS> [System.StringComparer]::InvariantCulture.Compare("_", "0")
-1 
```

* * *

## 回答 #9

> 赞同：-8
> 
> 时间：2009-02-18T14:52:55.837

始终尝试在那些接受它作为重载的字符串方法中使用 InvariantCulture。通过使用 InvariantCulture，您就安全了。许多 .NET 程序员可能不使用此功能，但如果您的软件将被不同文化使用，InvariantCulture 是一个非常方便的功能。

# c# - 是否有实现静态函数的最佳实践，该函数在同时访问时具有独特的价值

> ID：492802
> 
> 赞同：0
> 
> 时间：2009-01-29T18:22:20.187
> 
> 标签：c#, multithreading

静态函数`retUnique()`返回唯一值。我的问题是，如果有很多用户在给定时间点使用相同的功能，会发生什么？是否有最佳实践来确保访问此静态函数的每个用户同时获得唯一值并且也不会面临线程问题。

谁能给我一个例子？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-29T18:26:47.977

静态函数没有什么特别之处，可以使它们在多线程上使用或多或少安全。相反，您需要检查函数访问和修改的数据，并确保它在并发调用时仍然尊重该数据的完整性。

这是一个可能与您的问题相关的示例：

```
private static int myUniqueID = 1;
public static int GetFreshUniqueID()
{
    lock(someObject)
    {
        return myUniqueID++;
    }
} 
```

在这种情况下，保持线程安全的关键是将函数锁定在某个同步上下文中，这样我们就不会遇到两个线程在它们中的任何一个开始递增 ID 之前获得相同 ID 的情况。您的情况可能会有所不同。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-29T18:26:53.983

这不是一个简单的同步问题吗？

在函数的开头应用锁并在结束时释放它。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-29T19:13:04.513

假设您只想返回一个唯一的递增整数值，最简单的安全方法可能是使用私有静态计数器和私有静态锁对象。就像是：

```
private static int s_UniqueCounter; // starts at 0 by default
private static readonly object s_UniqueCounterLock = new object();

public static int GetUnique()
{
    lock (s_UniqueCounterLock)
    {
        s_UniqueCounter++;
        return s_UniqueCounter;
    }
} 
```

您可以确保使用特定的锁定对象来保护对静态计数器成员的任何其他访问（这就是为什么它们被声明为私有的，当然，因此拥有它们的类控制任何访问）。对于这种用途，它可能不应该在其他任何地方访问，但您可能会查看当前值以查看它被调用了多少次。这可能也应该受到锁的保护（以确保结果是最新的）：

```
internal static int QueryUniqueCount() // or this could be private, or public
{
    lock (s_UniqueCounterLock)
    {
        return s_UniqueCounter;
    }
} 
```

# winforms - Winforms 中的输入验证

> ID：492805
> 
> 赞同：3
> 
> 时间：2009-01-29T18:23:25.503
> 
> 标签：winforms, validation

在良好的旧 MFC 中，DDX 例程将内置验证表单条目。例如，可以自动检查用户是否在用于数字输入的文本框中输入了字符串。

Winforms中是否有这样的机制？显然，可以为“onChange”等类型的事件添加处理程序并在那里进行处理，但我想问是否有任何内置机制。

谢谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-29T18:44:32.090

您当然可以使用经过验证的 Regex 属性实现您自己的 ValidatingTextBox，基本上，只要您决定要对其进行验证（击键、Enter 键、失去焦点，...）

在最简单的级别上，纯文本框上有 Validated 和 Validating 事件，您可以为各个实例提供处理程序。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-29T18:47:29.090

有几次尝试在 Windows 窗体上复制更丰富的 ASP.NET 验证器。看看[比利霍利斯的这个](http://msdn.microsoft.com/en-us/library/ms951078.aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-29T18:44:14.463

不，我不这么认为，但是您可以轻松派生一个自定义文本框，该文本框根据您在其实例上设置的参数或属性应用您所需的验证类型。然后你会有一个*内置的*机制。;-)

# html - 何时使用 IMG 与 CSS 背景图像？

> ID：492809
> 
> 赞同：777
> 
> 时间：2009-01-29T18:25:06.327
> 
> 标签：html, css, image, background-image

`IMG`在什么情况下使用 HTML标签来显示图像比 CSS更合适，`background-image`反之亦然？

因素可能包括可访问性、浏览器支持、动态内容或任何类型的技术限制或可用性原则。

* * *

## 回答 #1

> 赞同：879
> 
> 时间：2009-09-23T23:58:07.937

### Proper uses of IMG

1.  Use `IMG` if you intend to have people [print your page](https://stackoverflow.com/questions/492809/when-to-use-img-instead-of-css-background-image/492835#492835) and you want the image to be included by default. —[JayTee](https://stackoverflow.com/users/20153/jaytee)
2.  Use `IMG` (with `alt` text) when the image has an important semantic meaning, such as [a warning icon](http://24ways.org/2005/naughty-or-nice-css-background-images). This ensures that the meaning of the image can be communicated in all user-agents, including screen readers.

### Pragmatic uses of IMG

1.  Use `IMG` plus alt attribute if the image is [part of the content](http://stackoverflow.com/questions/492809/when-to-use-img-instead-of-css-background-image/492834#492834) such as a logo or diagram or person (real person, not stock photo people). —[sanchothefat](http://stackoverflow.com/users/42147/sanchothefat)
2.  Use `IMG` if you rely on browser scaling to render an image in proportion to text size.
3.  Use `IMG` for [multiple overlay images in IE6](http://blog.neatlysliced.com/2007/07/ie6-hides-css-images/).
4.  ~~Use `IMG` with a `z-index` in order to [stretch a background image](http://www.quackit.com/html/codes/html_stretch_background_image.cfm) to fill its entire window.~~
    Note, this is no longer true with CSS3 background-size; see #6 below.
5.  Using `img` instead of `background-image` can dramatically improve performance of animations over a background.

### When to use CSS background-image

1.  Use CSS background images if the image [is not part of the content](https://stackoverflow.com/questions/492809/when-to-use-img-instead-of-css-background-image/492834#492834). —[sanchothefat](https://stackoverflow.com/users/42147/sanchothefat)
2.  Use CSS background images when doing [image-replacement of text](https://stackoverflow.com/questions/492809/when-to-use-img-instead-of-css-background-image/492834#492834) eg. paragraphs/headers. —[sanchothefat](https://stackoverflow.com/users/42147/sanchothefat)
3.  Use `background-image` if you intend to have people [print your page](https://stackoverflow.com/questions/492809/when-to-use-img-instead-of-css-background-image/492835#492835) and you do not want the image to be included by default. —[JayTee](https://stackoverflow.com/users/20153/jaytee)
4.  Use `background-image` if you need to improve download times, as with [CSS sprites](http://css-tricks.com/css-sprites/).
5.  Use `background-image` if you need for only a portion of the image to be visible, as with CSS sprites.
6.  Use `background-image` with `background-size:cover` in order to stretch a background image to fill its entire window.

* * *

## 回答 #2

> 赞同：305
> 
> 时间：2009-01-29T18:31:43.257

对我来说，这是一个非黑即白的决定。如果图像是内容的一部分，例如徽标或图表或人物（真人，而不是照片人物），则使用`<img />`标签加 alt 属性。对于其他所有内容，都有 CSS 背景图像。

另一个使用 CSS 背景图像的时间是在对文本进行图像替换时，例如。段落/标题。

* * *

## 回答 #3

> 赞同：119
> 
> 时间：2013-08-07T19:15:51.910

I'm surprised no one's mentioned this yet: **CSS transitions**.

You can natively transition a `div`'s background image:

```
#some_div {
    background-image:url(image_1.jpg);
    -webkit-transition:background-image 0.5s;
    /* Other vendor-prefixed transition properties */
    transition:background-image 0.5s;
}

#some_div:hover {
    background-image:url(image_2.jpg);
} 
```

This saves any kind of JavaScript or jQuery animation to fade an `<img/>`'s `src`.

More information about transitions on [MDN](https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_Transitions/Using_CSS_transitions).

* * *

## 回答 #4

> 赞同：80
> 
> 时间：2014-05-23T06:44:00.530

Above answers considers only Design aspect . I am listing it in SEO aspects.

When to use `<img />`

1.  When Your Image need to be **indexed by search engine**
2.  If it has relation to content, including cards (click areas), but not related to design. Design is probably the most difficult thing to parse here because so it's all design right. I would say perhaps functional design (Cards, thumbnails, profile images, things you can click) vs Aesthetic design which is mostly used for sites appeal.
3.  List item
4.  If your image is not too small ( not iconic images ).
5.  Images where you can add `alt` and `title` attribute.
6.  Images from a webpage which you want to print using print media css

When to use CSS `background-image`

1.  Images Purely Used to Design.
2.  No Relation With Content.
3.  Small Images which we can play with CSS3.
4.  Repeating Images ( In blog author icon , date icon will be repeated for each article etc.,).

As i will use them based on these reasons. These are Good practices of Search Engine Optimization of Images.

* * *

## 回答 #5

> 赞同：56
> 
> 时间：2009-01-29T18:32:03.537

默认情况下，浏览器并不总是设置为打印背景图像；如果您打算让人们打印您的页面:)

* * *

## 回答 #6

> 赞同：53
> 
> 时间：2009-04-10T06:18:29.613

如果您将 CSS 保存在外部文件中，那么将站点中经常使用的图像（例如标题图像）显示为背景图像通常会很方便，因为这样您以后可以灵活地更改图像。

例如，假设您有以下 HTML：

```
<div id="headerImage"></div> 
```

...和CSS：

```
#headerImage {
    width: 200px;
    height: 100px;
    background: url(Images/headerImage.png) no-repeat;
} 
```

几天后，您更改了图像的位置。您所要做的就是更新 CSS：

```
#headerImage {
    width: 200px;
    height: 100px;
    background: url(../resources/images/headerImage.png) no-repeat;
} 
```

Otherwise, you'd have to update the `src` attribute of the appropriate `<img>` tag in every HTML file (assuming you're not using a server-side scripting language or [CMS](http://en.wikipedia.org/wiki/Content_management_system) to automate the process).

Also background images are useful if you don't want the user to be able to save the image (although I haven't ever needed to do this).

* * *

## 回答 #7

> 赞同：47
> 
> 时间：2009-04-20T17:01:58.933

About the same as [sanchothefat's answer](https://stackoverflow.com/questions/492809/when-to-use-img-vs-css-background-image/492834#492834), but from a different aspect. I always ask myself: if I would completely remove the stylesheets from the website, do the remaining elements *only* belong to the content? If so, I did my job well.

* * *

## 回答 #8

> 赞同：45
> 
> 时间：2013-06-22T08:46:17.007

Some answers overcomplicate the scenario here. This is a dead simple situation.

Just answer to this question every time you'd like to place an image:

***Is this part of the content or part of the design?***

If you can't answer this, you probably don't know what you're doing or what you want to do!

*Also, DO NOT consider beside the two technique, just because you'd wish to be "printer friendly" or not. Also DO NOT hide content from a SEO point of view with CSS. If you find yourself managing your content in CSS files, you shot yourself in the leg. This is just a trivial decision of what is content or not. Every other aspect should be ignored.*

* * *

## 回答 #9

> 赞同：28
> 
> 时间：2011-08-24T16:03:18.703

I would add another two arguments:

*   An **img** tag is good if you need to **resize** the image. E.g. if the original image is 100px by 100 px, and you want it to be 80px by 80px, you can set the CSS width and height of the img tag. ~~I don't know of any good way to do this using background-image.~~ EDIT: This can now also be done with a background-image, using the [`background-size`](http://www.css3.info/preview/background-size/) CSS3 attribute.

*   Using **background-image** is good when you need to dynamically **switch between sprites**. E.g. if you have a button image, and you want a separate image displayed when the cursor is hovering over the element, you can use a background image containing both the normal and hover sprites, and dynamically change the background-position.

* * *

## 回答 #10

> 赞同：23
> 
> 时间：2013-04-10T10:23:02.373

One more benefit from using the <IMG> tag is related to SEO - i.e. you can provide additional information about the image in the ALT attribute of the image tag, while there's no way to provide such information when specifying the image through CSS and in that case only the image file name may be indexed by search engines. The ALT attribute definitely gives the <IMG> tag SEO advantage over the CSS approach. That's why according to me it is better to specify the images you want to rank well in the image search results (e.g. Google Image Search) using the <IMG> tag.

* * *

## 回答 #11

> 赞同：19
> 
> 时间：2009-05-22T18:03:51.397

Foreground = img.

Background = CSS background.

* * *

## 回答 #12

> 赞同：14
> 
> 时间：2010-09-18T14:14:18.913

Use background images only when necessary e.g. containers with image that tiles.

One of the major PROS by using **IMAGES** is that it is **better for SEO**.

* * *

## 回答 #13

> 赞同：12
> 
> 时间：2010-07-07T20:07:00.370

Using a background image, you need to absolutely specify the dimensions. This can be a significant problem if you don't actually know them in advance or cannot determine them.

A big problem with `<img />` is overlays. What if I want an CSS inner shadow on my image (`box-shadow:inset 0 0 5px rgb(0,0,0,.5)`)? In this case, since `<img />` can't have child elements, you need to use positioning and add empty elements which equates to useless markup.

In conclusion, it's quite situational.

* * *

## 回答 #14

> 赞同：11
> 
> 时间：2012-12-12T00:00:50.083

A couple of other scenarios where `background-image` should be used:

*   When you want the image to change when the mouse is hovered upon it.
*   ~~When you want to add rounded corners to the image. If you use `img`, the image leaks out of the rounded corners.~~

* * *

## 回答 #15

> 赞同：10
> 
> 时间：2009-02-13T18:29:07.383

在多个皮肤或设计版本的情况下使用 CSS background-image。Javascript 可用于动态更改元素的类，这将迫使它呈现不同的图像。使用 IMG 标签，可能会更棘手。

* * *

## 回答 #16

> 赞同：7
> 
> 时间：2009-02-02T22:30:31.540

这是一个技术考虑：图像会动态生成吗？在 HTML中生成标签往往`<img>`比尝试动态编辑 CSS 属性容易得多。

* * *

## 回答 #17

> 赞同：7
> 
> 时间：2009-05-22T18:00:17.520

What about the size of the image? If I use the img tag, the browser scales the image. If I use css background, the browser just cuts a chunk from the larger image.

* * *

## 回答 #18

> 赞同：7
> 
> 时间：2013-01-11T21:21:30.043

In regards to animating images using CSS TranslateX/Y (The proper way to animate html) - If you do a Chrome Timeline recording of CSS background-images being animated vs IMG tags being animated you will see the paint times are drastically shorter for the CSS background-images.

* * *

## 回答 #19

> 赞同：7
> 
> 时间：2013-01-28T13:44:40.367

There's another reason! If you have a responsive design and want to split usage of low, medium, and high-res images for devices through media queries, you should use backgrounds as well.

* * *

## 回答 #20

> 赞同：6
> 
> 时间：2011-01-26T00:40:42.257

**img** is an html tag for a reason, therefore it should be used. For referencing or to illustrate things, people e.g: in articles.

Also if the image ***has a meaning*** or has to be clickable an **img** is better than a **css background**. For all other situation, I think, a **css background** can be used.

Although, it is a subject that needs to be discussed over and over.

Web Student from Paris, France

* * *

## 回答 #21

> 赞同：6
> 
> 时间：2011-05-31T17:52:52.087

Also, i have a gallery section which has inconsistent picture sizes so even though those images are obviously considered content, I use background images and center them in divs with a set size. This is similar to what facebook does in their albums..

* * *

## 回答 #22

> 赞同：5
> 
> 时间：2011-11-21T12:52:56.433

Just a small one to add, you should use the img tag if you want users to be able to 'right click' and 'save-image'/'save-picture', so if you intend to provide the image as a resource for others.

Using background image will (as far as I'm aware on most browsers) disable the option to save the image directly.

* * *

## 回答 #23

> 赞同：5
> 
> 时间：2013-09-06T06:56:07.710

A small input, I have had problems with responsive images slowing down the rendering on iphone for up to a minute, even with small images:

```
<!-- Was super slow -->
<div class="stuff">
    <img src=".." width="100%" />
</div> 
```

But when switching to using background images the problem went away, this is only viable if targeting newer browsers.

* * *

## 回答 #24

> 赞同：4
> 
> 时间：2014-02-15T05:03:49.593

HTML is for content and CSS is for design. Is the image necessary and does it need to be picked up by screen readers? If the answer is yes, then put the image in the HTML. If it is purely for styling, then you can use the background-image property in CSS to inject the image. Just as a lot of people here have already mentioned, you can then use a pseudo element on the image if you like.

* * *

## 回答 #25

> 赞同：4
> 
> 时间：2014-04-10T13:34:43.103

`IMG` load first because the `src` is in the html file itself whereas in the case of `background-image` the source is mentioned in stylesheet so the image loads after the stylesheet loaded, delaying the loading of the webpage.

* * *

## 回答 #26

> 赞同：3
> 
> 时间：2014-03-03T22:28:32.817

**Another background-image PRO: Background-images for `<ul>`/`<ol>` lists.**

Use background images if they are part of the overall-design and are repeated on multiple pages. Preferably in background sprite form for optimization.

Use tags for all images that are not part of the overall design, and are most likely placed once, like specific images for articles, people, and important images that deserve to be added to ***google images.***

** The only repeated image that I enclose in a `<img>` tag is the site/company logo. Because people tend to click it to go to the homepage, thus you wrap it with an `<a>` tag.

* * *

## 回答 #27

> 赞同：3
> 
> 时间：2014-04-16T08:39:39.753

Also note that most search engine spiders don't index CSS background images therefore the background images will be ignored and you won't be able to get any traffic from search engines (no SEO benefit in short).

Where as all images defined with tags are indexed (unless manually excluded) and can bring in traffic from search engines if their title/alt attributes and filenames are optimized properly (w.r.t some keyword).

* * *

## 回答 #28

> 赞同：2
> 
> 时间：2012-05-05T03:23:17.750

You can use IMG tags if you want the images to be fluid and scale to different screen sizes. For me these images are mostly part of the content. For most elements that are not part of the content, I use CSS sprites to keep the download size minimal unless I really want to animate icons etc.

* * *

## 回答 #29

> 赞同：2
> 
> 时间：2013-01-14T16:49:11.660

I use image instead of background-image when i want to make them 100% stretchable which supported in most browsers.

* * *

## 回答 #30

> 赞同：2
> 
> 时间：2013-04-27T19:52:26.960

If you want to add an image only for the special content on the page or for only one page the you should use IMG tag and if you want to put image on more than one pages then you should use CSS Background Image.

* * *

## 回答 #31

> 赞同：0
> 
> 时间：2010-04-22T13:11:48.453

Just to throw a spanner in the works - i'm of the opinion that you should never use the img tag. HTML was meant for content, not visual style. all the images on your page should come from the CSS, leaving your HTML code pure. (even if it does take a bit longer to build)

# asp.net - 在 ASP.NET 中浏览文件服务器端

> ID：492812
> 
> 赞同：3
> 
> 时间：2009-01-29T18:25:25.110
> 
> 标签：asp.net, vb.net, scheduled-tasks, server-side

我正在创建一个 ASP.NET Web 应用程序，以使用 .NET Wrapper for Scheduled Tasks 从远程位置在我们的服务器上安排任务。但是，我被困住了。

用户需要能够浏览服务器上的文件系统，以检索用户在此应用程序中创建的新任务的“要运行的文件”。我需要获取文件路径/文件名并将其传递给 .NET 包装器。

我尝试过使用 HTMLInputFile，但我还没有找到一种方法来让我工作。

任何帮助表示赞赏。

谢谢

* * *

更新：
对于这个项目，我们决定简单地在一个下拉框中列出用户可以使用的可执行文件，因为他们并不需要完全访问文件系统，只是为了安全起见。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-29T18:38:14.897

HTMLInputFile 用于浏览客户端的文件系统并将文件上传到服务器。它不用于浏览服务器的文件系统。

你将需要一些完全不同的东西。您将需要一些服务器端代码来通过浏览器向用户显示服务器端文件夹结构。

[这里](http://www.java2s.com/Code/ASP/Components/WebbasedfilebrowserC.htm)有一个基本实现的例子。

**更新：**

使用该示例，您替换“yourfolderHere”的路径需要是虚拟路径，而不是绝对路径。因此，例如“C:\Inetpub\wwwroot\uploads”将不起作用，但“uploads”将起作用。

我希望不言而喻，在实施这样的事情时需要考虑严重的安全问题。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-29T18:35:24.323

HTMLInputFile 只能在客户端机器上工作。

您需要用 ASPX/HTML 编写一个在服务器端浏览的文件系统浏览器。做起来应该不难。

你不能使用`<input type="file"`标签
这会打开一个浏览客户端机器的客户端对话框。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-29T18:37:22.073

据我所知，您需要创建自己的“浏览器”。

例如，您可以使用 My.Computer.Filesystem 类来检索文件夹中的文件列表并在网页上显示这些文件。然后，用户选择相关文件并将响应发送回服务器。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-29T18:41:55.280

您可以使用 System.IO.Directory 来获取目录和文件。这些可以通过多种方式显示。一个简单的浏览器/文件选择应该可以在少于 50 行代码中完成。

另请注意，您可能需要向运行 Web 应用程序的用户授予额外权限，以便可以访问文件系统。

围绕此还有各种安全隐患，因此除非您确实需要，否则不要授予对所有内容的访问权限。

# c# - C# 属性中“值”保留字的类型是什么

> ID：492822
> 
> 赞同：1
> 
> 时间：2009-01-29T18:28:14.730
> 
> 标签：c#, properties, types, keyword

我想知道属性中的“值”关键字采用什么类型。

所以：

```
public class Test
{
    string _numberAsString;
    int _number = -1;

    public Test() {}

    public string NumberAsString
    {
        get { return _numberAsString; }
        set { _numberAsString= value; }
    }

    public int Number
    {
        get { return int.Parse(_numberAsString); }
        set { _number = value; }
    }
}

//elsewhere
Test t = new Test();
t.Number = 5; 
```

现在，正如我所料，这不会编译。“值”的类型由属性的返回类型决定，对吗？我找不到任何效果，也许它太明显了（我没有阅读语言规范，大概那里有一些东西）。

我问，因为我想使用一种类型设置属性，然后将其转换为 getter 的类型。我想这真的没有意义。

看来我必须通过创建几个方法来实现这一点。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-29T18:36:41.497

是的，“值”的类型由属性的返回类型决定。你到底想完成什么？您是否希望能够将 Number 或 NumberAsString 设置为有效值并从任一属性中获取结果？

如果是这种情况，您需要执行以下操作：

```
public class Test
{
   string _numberAsString;
   int _number = -1;

   public Test() {}
   public string NumberAsString
   {
       get { return _numberAsString; }
       set { _numberAsString= value; }
   }
   public int Number
   {
       get { return int.Parse(_numberAsString); }
       set { _numberAsString = value.ToString(); }
   }
} 
```

这将允许您这样做：

```
Test t = new Test();
t.Number = 5;
Console.WriteLine(t.NumberAsString); // should print out "5"
t.NumberAsString = "5";
Console.WriteLine(t.Number); // should print out "5" 
```

对于采用不同类型的属性，您不能拥有 get 和 set。您唯一的选择是将其作为一种类型在内部存储，然后在 get 或 set（或两者）中执行从一种类型到另一种类型的转换。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-29T18:37:44.523

setter 中值的类型是属性的类型 - 您不能将字符串传递给 int 的属性，必须首先将其解析为 int。

.net 中的字符串不能被强制转换为任何其他类型（以 perl、awk 和许多其他动态语言允许的方式），它们只能被视为字符串或它们的父类对象。

您可以执行以下操作：

```
private int _number;
private string  _numberAsString;

public string NumberAsString
{
    get { return _numberAsString; }
    set { LinkedSet(value); }
}

public int Number
{
    get { return _number; }
    set { LinkedSet(value); }
}

private void LinkedSet(string s)
{
    this._number = int.Parse(s);
    this._numberAsString = s;
}  

private void LinkedSet(int i)
{
    this._numberAsString = i.ToString();
    this._number = i;
} 
```

显然 NumberAsString 设置器可以抛出数字设置器不能的 FormatException。

我一般不建议这样做，除非您**确实**需要避免定期将数字转换为字符串并将字符串转换为数字（此时您可以让设置者在评估链接值时变得懒惰 - 尽管会改变从字符串的集合到 int 的异常的语义 - 可能充其量是烦人的，或者最坏的情况是一个讨厌的错误。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-29T19:00:57.503

对我来说，允许 NumberAsString 上的设置器是没有意义的。

为什么不是这个？：

```
public class Test
{
   int _number = -1;

   public Test() {}
   public string NumberAsString
   {
       get { return _number.ToString(); }
   }
   public int Number
   {
       get { return _number; }
       set { _number= value; }
   }
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-29T19:11:45.953

为什么不只是做

```
Test t = new Test();
t.Number = 5;
Console.WriteLine(t.Number.ToString()); 
```

令我震惊的是，您无缘无故地试图狡猾。

我认为您正在尝试在更合适的方法时在这里使用属性。属性不应该有任何不可预见的副作用，这将通过对其执行类型转换（如果可能的话）。

# javascript - 从 JQuery 中的输入数组中获取正确的索引

> ID：492833
> 
> 赞同：12
> 
> 时间：2009-01-29T18:31:10.933
> 
> 标签：javascript, jquery, html

如何使用 JQuery 从一组具有不规则编号索引的输入元素中获取所选输入的正确索引？JQuery 的“索引”函数总是返回一个从 0 开始的值，而不是我使用的索引。我的代码如下：

查询：

```
$("input[name^=myboxes]").click(function() {
        var element_id = $("input[name^=myboxes]").index(this);
        alert(element_id); //will alert 0, 1, or 2 instead of 3, 8, or 10
}); 
```

HTML：

```
<input type="checkbox" id="myboxes[3]" name="myboxes[3]" value="CHECKED"  >
<input type="checkbox" id="myboxes[8]" name="myboxes[8]" value="CHECKED"  >
<input type="checkbox" id="myboxes[10]" name="myboxes[10]" value="CHECKED" CHECKED > 
```

谢谢！

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-29T18:39:34.237

以下是一直对我有用的。

查询：

```
$("input[name^=myboxes]").click(function() {
        var element_id = $(this).attr("meta:index");
        alert(element_id);
}); 
```

HTML：

```
<input type="checkbox" id="myboxes[3]" name="myboxes[3]" meta:index="3" value="CHECKED"  >
<input type="checkbox" id="myboxes[8]" name="myboxes[8]" meta:index="8" value="CHECKED"  >
<input type="checkbox" id="myboxes[10]" name="myboxes[10]" meta:index="10" value="CHECKED" CHECKED > 
```

希望这可以帮助。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2010-06-01T16:08:27.250

所选答案有一些语法问题，应该是：

```
$("input[name^=myboxes]").click(function() {
    var element_id = $(this).attr('id');
    //the initial starting point of the substring is based on "myboxes["
    var ix = element_id.substring(8,element_id.length - 1);
    alert(ix);
}); 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-01-29T18:39:33.410

您的 ID 值没有“索引”属性。这只是一个字符串。

一个建议：解析 id 字符串以获取您的值：

```
$("input[name^=myboxes]").click(function() {
    var element_id = $(this).attr('id');
    //the initial starting point of the substring is based on "myboxes["
    var ix = element_id.substring(8,element_id.length - 1)
    alert(ix);
}); 
```

希望这可以帮助

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2017-01-07T13:29:02.900

如果你这样做，它会更短：

```
 var id = $(this).attr('id');
       // remove everything that is not a number
       id = id.replace(/[^0-9]/g, '');
       alert(id); 
```

# perl - 为什么我的 Perl 测试因使用编码“utf8”而失败？

> ID：492838
> 
> 赞同：9
> 
> 时间：2009-01-29T18:32:37.327
> 
> 标签：perl, testing, utf-8

我对这个测试脚本感到困惑：

```
#!perl

use strict;
use warnings;
use encoding 'utf8';
use Test::More 'no_plan';

ok('áá' =~ m/á/, 'ok direct match');

my $re = qr{á};
ok('áá' =~ m/$re/, 'ok qr-based match');

like('áá', $re, 'like qr-based match'); 
```

这三个测试都失败了，但我期望`use encoding 'utf8'`它将把文字`áá`和`qr`基于 - 的正则表达式升级为 utf8 字符串，从而通过测试。

如果我删除该`use encoding`行，测试会按预期通过，但我无法弄清楚为什么它们会在`utf8`模式下失败。

我在 Mac OS X（系统版本）上使用 perl 5.8.8。

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-01-29T21:25:44.560

**不要**使用[`encoding`编译指示](http://perldoc.perl.org/encoding.html)。它坏了。（Juerd Waalboer 做了一场精彩的演讲，他在 YAPC::EU 2k8 上提到了这一点。）

它至少同时做两件不属于一起的事情：

1.  它指定源文件的编码。
2.  它为您的文件输入/输出指定编码。

并且为了增加侮辱性，它还以一种破坏的方式执行＃1：它将`\xNN`序列重新解释为未解码的八位字节，而不是将它们视为代码点，并对它们进行解码，从而阻止您表达您指定的编码之外的字符并制作您的源代码根据编码意味着不同的东西。这简直是​​大错特错。

仅使用 ASCII 或 UTF-8 编写源代码。在后一种情况下，**pragma[`utf8`是](http://perldoc.perl.org/utf8.html)**正确的使用方法。如果您不想使用 UTF-8，但确实想包含非 ASCII 字符，请显式转义或解码它们。

并显式使用 I/O 层或使用**[pragma](http://perldoc.perl.org/open.html)****设置它们以使[`open`](http://perldoc.perl.org/open.html)**I/O 自动正确转码。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-29T19:20:12.783

它在我的计算机上运行良好（在 perl 5.10 上）。也许您应该尝试将其替换`use encoding 'utf8'`为`use utf8`.

你用的是什么版本的perl？我认为旧版本在正则表达式中存在 UTF-8 错误。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2011-12-02T02:19:48.137

[Test::More 文档](http://perldoc.perl.org/Test/More.html)包含针对此问题的修复程序，这是我今天刚刚找到的（并且此条目在 google 中显示得更高）。

> **utf8 / "打印中的宽字符"**
> 
> 如果您在 Test::More 中使用 utf8 或其他非 ASCII 字符，您可能会收到“打印中的宽字符”警告。使用 binmode STDOUT，":utf8" 不会修复它。Test::Builder（为 Test::More 提供支持）复制 STDOUT 和 STDERR。因此，对它们的任何更改，包括更改它们的输出规则，都不会被 Test::More 显示出来。解决方法是直接更改 Test::Builder 使用的文件句柄。
> 
> ```
> my $builder = Test::More->builder;
> binmode $builder->output,         ":utf8";
> binmode $builder->failure_output, ":utf8";
> binmode $builder->todo_output,    ":utf8"; 
> ```

我在我的测试代码中添加了一些样板文件，它很有魅力。

# unit-testing - 有没有办法按特定顺序执行 NUnit 测试？

> ID：492843
> 
> 赞同：8
> 
> 时间：2009-01-29T18:33:07.340
> 
> 标签：unit-testing, nunit

当我测试我的 DAL 时，由于依赖关系，我需要先创建一些数据库实体，有没有办法通过方法属性或其他方法让 NUnit 按我指定的顺序执行我的测试？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-01-29T18:35:16.773

在测试中使用[Setup 和 Teardown](http://www.nunit.org/index.php?p=setup&r=2.2.10)方法。在标有 [Setup] 属性的方法中创建测试所需的所有内容。使用标有 [Teardown] 属性的方法来关闭您的连接等...

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-29T18:46:11.247

理想情况下，以特定顺序执行测试违背了单元测试的理念，其中每个测试都应该是自包含的并且独立于其他测试。按字母顺序执行它们的原因是因为反射按此顺序返回方法。话虽如此，使用 Setup 和 Teardown 方法会在某种程度上帮助您。说了这么多，看看这个链接，它可能有点读，但写文章系列的人有一点

[链接Pt1](http://www.codeproject.com/csharp/autp1.asp)

[链接 Pt2](http://www.codeproject.com/csharp/autp2.asp)

[链接Pt3](http://www.codeproject.com/csharp/autp3.asp)

[链接 Pt4](http://www.codeproject.com/csharp/autp4.asp)

[链接 Pt5](http://www.codeproject.com/gen/design/autp5.asp)

# python - python：重新启动循环

> ID：492860
> 
> 赞同：31
> 
> 时间：2009-01-29T18:37:51.713
> 
> 标签：python, loops

我有：

```
for i in range(2,n):
    if(something):
       do something
    else:
       do something else
       i = 2 **restart the loop 
```

但这似乎不起作用。有没有办法重新启动那个循环？

谢谢

* * *

## 回答 #1

> 赞同：46
> 
> 时间：2009-01-29T18:42:22.313

您可能需要考虑在该逻辑适用的情况下使用不同类型的循环，因为这是最明显的答案。

也许是：

```
i=2
while i < n:
    if something:
       do something
       i += 1
    else: 
       do something else  
       i = 2 #restart the loop 
```

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2009-01-29T18:38:57.873

从循环中更改索引变量`i`不太可能达到您的预期。您可能需要改用`while`循环，并自己控制循环变量的递增。每次`for`循环时，`i`都会重新分配来自 的下一个值`range()`。所以像：

```
i = 2
while i < n:
    if(something):
        do something
    else:
        do something else
        i = 2 # restart the loop
        continue
    i += 1 
```

在我的示例中，[`continue`](http://python.org/doc/2.5/ref/continue.html)语句跳回到循环的顶部，跳过该`i += 1`迭代的语句。否则，`i`按预期递增（与`for`循环相同）。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2014-01-10T15:22:05.560

这是使用生成器[`send()`方法](http://docs.python.org/2/reference/expressions.html#generator.send)的示例：

```
def restartable(seq):
    while True:
        for item in seq:
            restart = yield item
            if restart:
                break
        else:
            raise StopIteration 
```

示例用法：

```
x = [1, 2, 3, 4, 5]
total = 0
r = restartable(x)
for item in r:
    if item == 5 and total < 100:
        total += r.send(True) 
    else:
        total += item 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2014-01-10T15:00:48.513

只是想发布一个可能更普遍可用的替代方案。大多数现有解决方案使用循环索引来避免这种情况。但是您不必使用索引 - 这里的关键是，与 for 循环不同，循环变量是隐藏的，循环变量是公开的。

你可以用迭代器/生成器做非常相似的事情：

```
x = [1,2,3,4,5,6]
xi = iter(x)
ival = xi.next()
while not exit_condition(ival):
    # Do some ival stuff
    if ival == 4:
        xi = iter(x)
    ival = xi.next() 
```

它不那么干净，但仍然保留了写入循环迭代器本身的能力。

*通常*，当你认为你想这样做时，你的算法是错误的，你应该更干净地重写它。可能您真正想要做的是使用生成器/协程。但这至少是可能的。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2016-02-16T17:12:35.633

```
a = ['1', '2', '3']
ls = []
count = False

while ls != a :
    print(a[count])
    if a[count] != a[-1] :
        count = count + 1
    else :
        count = False 
```

重启while循环。

# javascript - jQuery keypress() 事件没有触发？

> ID：492865
> 
> 赞同：37
> 
> 时间：2009-01-29T18:39:04.380
> 
> 标签：javascript, jquery, internet-explorer

我正在尝试使用 jQuery 在左右箭头键上触发一个事件。使用以下代码，我可以在任何字母数字键上触发事件，但光标键（上、下、左、右）什么也不触发。我主要为 IE 用户开发该站点，因为它是一个业务线应用程序。我在这里做错了吗？

```
$('document').keypress(function(e){
    switch (e.which) {
        case 40:
            alert('down');
            break;
        case 38:
            alert('up');
            break;
        case 37:
            alert('left');
            break;
        case 39:
            alert('right');
            break;
        default:
            alert('???');  
            }      
}); 
```

* * *

## 回答 #1

> 赞同：47
> 
> 时间：2009-01-29T18:41:14.890

**e.which**在 IE 中不起作用尝试**e.keyCode**，如果您以 IE 为目标，您可能还想使用 keydown() 而不是 keypress() 。

有关详细信息，请参阅[http://unixpapa.com/js/key.html](http://unixpapa.com/js/key.html)。

* * *

## 回答 #2

> 赞同：41
> 
> 时间：2009-01-29T18:54:25.643

使用 jQuery，我是[这样做的](http://www.rambeck.com/blog/2008/05/jquery-enter-tab)：

```
function checkKey(e){
     switch (e.keyCode) {
        case 40:
            alert('down');
            break;
        case 38:
            alert('up');
            break;
        case 37:
            alert('left');
            break;
        case 39:
            alert('right');
            break;
        default:
            alert('???');  
            }      
}

if ($.browser.mozilla) {
    $(document).keypress (checkKey);
} else {
    $(document).keydown (checkKey);
} 
```

另外，试试这些插件，它们看起来对你有用：

[http://www.openjs.com/scripts/events/keyboard_shortcuts](http://www.openjs.com/scripts/events/keyboard_shortcuts)

[http://www.webappers.com/2008/07/31/bind-a-hot-key-combination-with-jquery-hotkeys/](http://www.webappers.com/2008/07/31/bind-a-hot-key-combination-with-jquery-hotkeys/)

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2009-06-10T15:20:14.673

您在字符串中有“文档”一词。改变：

```
$('document').keypress(function(e){ 
```

到

```
$(document).keypress(function(e){ 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2014-08-06T01:28:10.923

您的原始代码有 $('document')... 当它应该有 $(document) 没有引号时。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-07-29T11:43:19.920

当然这是一个封闭的问题，我想在您的讨论中添加一些内容

在 Mozilla 中，我观察到此代码的奇怪行为

```
$(document).keydown(function(){
//my code 
}); 
```

代码被触发两次。调试时我发现实际上有两个事件被触发：'keypress'和'keydown'。我禁用了其中一个事件，代码向我展示了预期的行为。

```
$(document).unbind('keypress');
$(document).keydown(function(){
//my code
}); 
```

这适用于所有浏览器，也无需检查特定于浏览器的 (if($.browser.mozilla){ })。

希望这可能对某人有用

# c# - 在 .NET 中初始化基类

> ID：492872
> 
> 赞同：8
> 
> 时间：2009-01-29T18:41:12.690
> 
> 标签：c#, .net, oop

如果我需要用现有对象初始化对象的基础，我该怎么办？例如，在这种情况下：

```
public class A
{
    public string field1;
    public string field2;
}

public class B : A
{
    public string field3;
    public void Assign(A source)
    {
        this.base = source; // <-- will not work, what can I do here?
    }
} 
```

显然，Assign() 方法可以逐个字段地为基类赋值，但没有更好的解决方案吗？由于类 B 继承自 A，因此必须有一种方法可以将 A 分配给 B.base

在 C++ 中，这将是一件微不足道的事情，但我似乎无法掌握如何在 .NET 中做到这一点

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-01-29T18:45:03.103

不幸`base`的是只读的。

[编辑]
好吧，也许不是那么不幸。基类和子类之间的关系`IS-A`不是`HAS-A`。通过允许子类更改基类的实例，您允许子类更改其自己的引用，因为它是`IS-A`基类。如果您确实需要此功能，那么我建议您更改继承模型以反映您真正想做的事情。

像这样的东西：

```
public class A
{
    public string field1;
    public string field2;
}

public class B
{
    public string field3;
    public A a;

    public void Assign(A source)
    {
        this.a = source;
    }
} 
```

似乎更合适，具有更清晰的含义和功能。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-01-29T18:45:15.710

```
 public Assign(A a)
        {
            foreach (var prop in typeof(A).GetProperties())
            {
                this.GetType().GetProperty(prop.Name).SetValue(this, prop.GetValue(a, null),null);
            }
        } 
```

基本上，它使用反射来获取基的所有属性并将其值分配给 A 中存在的所有值。

编辑：对于所有反对者，我现在用一个有 100 个整数变量的基类快速测试了这一点。然后我在子类中有这个分配方法。运行时间为 46 毫秒。我不了解你，但我完全可以接受。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-01-29T19:04:13.753

虽然这里有很多很好的答案，但我认为正确的方法是链接构造函数：

```
public class A
{
    public string field1;
    public string field2;

    public A(string field1, string2 field2)
    {
         this.field1 = field1;
         this.field2 = field2;
    }
}

public class B : A
{
    public string field3;

    public B(string field1, string2 field2, string field3)
        : base(field1, field2)
    {
        this.field3 = field3;
    }
} 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-01-29T18:44:54.993

不，您尝试的语法是不可能的。在 C# .NET 中，您需要执行以下操作：

```
public void Assign(A source) {
    field1 = source.field1;
    field2 = source.field2; 
} 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-01-29T20:33:18.830

这些字段的意图是在对象构造期间初始化一次，还是在对象的生命周期内多次调用“分配”？如果是后者，您可以忽略其余部分:)

Andrew 对 IS-A 和 HAS-A 的区分很重要。如果关系真的是HAS-A，那么他的组合解决方案就是要走的路。

如果 IS-A 关系更有意义（并且您可以修改 A），则复制构造函数可能是个好主意：

```
public class A
{
    public string field1;
    public string field2;

    public A(A copyFrom)
    {
        this.field1 = copyFrom.field1;
        this.field2 = copyFrom.field2;
    }
}

public class B : A
{
    public string field3;

    public B(A source)
        : base(source)
    {
    }
} 
```

您最终不得不复制 A 的每个属性，但这样做的责任在于它所属的 A。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-29T18:46:28.077

为什么你需要？通过声明一个新的 B，CLR 自动调用这两个类的构造函数。

```
B myB = new B(); 
```

B new 具有两个类的字段。但是，除非您喜欢 null，否则您应该使用初始化程序声明它们：

```
public string field1 = "";
public string field2 = string.Empty; 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-01-29T19:09:58.250

我希望我不是唯一一个认为换掉基类是一种糟糕的设计模式的人。另一种方法是用组合代替继承：

```
public class A
{
    public string Field1 { get; set; }
    public string Field2 { get; set; }
}

public class B
{
    public A A { get; set; }
    public string Field3 { get; set; }

    public B(A a) { this.A = a; }
} 
```

现在写这样的东西很简单：

```
B b = new B ( new A { Field1 = "hello", Field2 = "world" } );

b.A = new A { Field1 = "hola", Field2 = "luna" }; 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-01-29T19:53:07.787

错误的问题。你显然在这里滥用继承权。尝试重构它，以便保留对 A 的引用作为成员字段。如果您需要多态性，请考虑使用通用基类或更好的接口 - 接口。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-01-29T18:46:19.467

根据 MSDN，“base”只能用于以下操作：

*   调用已被另一个方法覆盖的基类上的方法。
*   指定在创建派生类的实例时应调用哪个基类构造函数。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2014-07-30T09:15:49.230

```
 [TestMethod]
    public void TestMethod()
    {
        A a = new A();
        a.field1 = "test";
        string xml = Serialize(a);
        xml = xml.Replace("A", "B");
        B b = Deserialize(xml);

        Assert.AreEqual("test", b.field1);
    }

    public string Serialize(A a)
    {
        System.IO.StreamReader streamReader = null;
        System.IO.MemoryStream memoryStream = null;
        try
        {
            memoryStream = new System.IO.MemoryStream();
            XmlSerializer serializer = new XmlSerializer(typeof(A));
            serializer.Serialize(memoryStream, a);
            memoryStream.Seek(0, System.IO.SeekOrigin.Begin);
            streamReader = new System.IO.StreamReader(memoryStream);
            return streamReader.ReadToEnd();
        }
        finally
        {
            if ((streamReader != null))
            {
                streamReader.Dispose();
            }
            if ((memoryStream != null))
            {
                memoryStream.Dispose();
            }
        }
    }

    public static B Deserialize(string xml)
    {
        System.IO.StringReader stringReader = null;
        try
        {
            stringReader = new System.IO.StringReader(xml);
            XmlSerializer serializer = new XmlSerializer(typeof(B));
            return ((B)(serializer.Deserialize(System.Xml.XmlReader.Create(stringReader))));
        }
        finally
        {
            if ((stringReader != null))
            {
                stringReader.Dispose();
            }
        }
    } 
```

# scripting - 隐藏控制台而不丢失标准错误/输出流

> ID：492876
> 
> 赞同：2
> 
> 时间：2009-01-29T18:41:59.490
> 
> 标签：scripting, batch-file, cmd

我的问题类似于[Running a CMD or BAT in silent mode](https://stackoverflow.com/questions/411247/running-a-cmd-or-bat-in-silent-mode)，但有一个额外的限制。

如果您在 vbscript 中使用[WshScript.Run](http://msdn.microsoft.com/en-us/library/d5fk67ky(VS.85).aspx)，​​您将无法访问该过程的标准输入/错误/输出流。 [WshScript.Exec](http://msdn.microsoft.com/en-us/library/ateytk4a(VS.85).aspx)允许您访问标准流，但您不能隐藏您的窗口。你怎么能得到你的蛋糕（隐藏窗户）并吃掉它（直接访问控制台流）？

我目前正在考虑一个 C++ 可执行文件，它创建一个新的 Windows Station 和 Desktop，（请参阅[MSDN](http://msdn.microsoft.com/en-us/library/ms687098(VS.85).aspx)）并在该新桌面中运行指定的脚本（我还不是 Window Stations 和 Desktops 方面的专家，所以这个想法可能是迟钝）。

这个想法松散地基于[Condor](http://www.cs.wisc.edu/condor/)的 [`USE_VISIBLE_DESKTOP`](http://www.cs.wisc.edu/condor/manual/v7.2/3_3Configuration.html#16051)功能，如果禁用，它会在不可见的桌面上运行 Condor 作业。我还没有完全弄清楚这是否需要提升特权。

这种方法的权衡是，如果它阻止用户输入，您的脚本可能会消失。

有没有人有任何额外的想法？或对上述方法的反馈？

**编辑：**

此外，我们脚本的目的是设置用户环境，因此作为另一个用户运行或作为系统计划任务运行并不是一个真正的选择（除非有我不知道的聪明技巧）。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-04T18:50:08.427

我对上面的 VBScript 片段没有任何运气 - 窗口仍然会弹出。但是我确实找到了一个名为[hstart](http://www.ntwind.com/software/utilities/hstart.html)的工具，它看起来就像我需要的一样。不幸的是，它不是开源的，也不是免费用于商业用途的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-04T19:05:08.723

Cygwin ( [http://www.cygwin.com/](http://www.cygwin.com/) ) 带有一个名为 run.exe 的实用程序，它可以满足您对通用进程的要求。您可以使用它来包装对 cscript 的调用。Cygwin 是 GNU，因此可免费用于商业或个人用途。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-29T19:39:58.640

我只测试了一点，所以 YMMV ......

将以下代码放入一个 .vbs 文件中（我叫我的 HideWindow.vbs）：

```
Const HIDDEN_WINDOW = 12

computer = "."
Set oWmiService = GetObject("winmgmts:" & _
                            "{impersonationLevel=impersonate}!\\" & _
                            computer & "\root\cimv2")
Set oStartup = oWmiService.Get("Win32_ProcessStartup")

Set oConfig = oStartup.SpawnInstance_
oConfig.ShowWindow = HIDDEN_WINDOW
Set oProcess = GetObject("winmgmts:root\cimv2:Win32_Process")
ret = oProcess.Create("cmd.exe /c C:\Scripts\test.cmd", null, oConfig, pid) 
```

从批处理文件或命令行调用它，如下所示：

```
CSCRIPT HideWindow.vbs 
```

您输入的任何内容都将在`test.cmd`不显示窗口的情况下运行。这可以通过多种方式改进，尤其是通过参数化由`oProcess.Create`.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-03-03T20:02:06.797

您可以使用[Exec](http://www.westmesatech.com/misctools.html)，这是我编写的一个免费软件工具，它为 CreateProcess Windows API 调用提供命令行界面。GUI 版本本身没有控制台，您可以使用它在隐藏窗口中启动 shell 脚本（批处理文件）。

账单

# .net - .NET - 对数据库中的代码和状态进行单元测试

> ID：492895
> 
> 赞同：0
> 
> 时间：2009-01-29T18:47:27.903
> 
> 标签：.net, sql-server, unit-testing, database-design, state

假设：我们针对 SQL Server 2005 使用 .NET 编码

我只是想知道大多数人如何将状态合并到影响他们数据库的单元测试中？我知道何时何地使用模拟，但是当你想超越它并实际进行一些数据库测试时......你使用什么策略来设置和拆除你的数据库？你每次测试都这样做吗？或在数据库中设置某个场景并针对该“世界状态”运行多个测试。任何建议都会有所帮助。谢谢。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-29T18:50:52.733

我针对空数据库运行大部分测试用例，这意味着只存在数据库模式，但没有数据。实际数据由测试用例或设置和拆卸根据需要创建和删除。这比准备好数据库需要更长的时间，但更能抵抗数据库架构更改。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-29T18:49:48.820

以下是我在 NUnit 中所做的...在标有 [Setup] 属性的方法中启动数据库事务。根据需要设置数据库状态。NUnit 然后针对该状态运行测试。在一个标有 [TearDown] 属性的方法中回滚数据库事务。您永远不会以这种方式更改数据库的状态。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-29T18:55:04.067

首先，我所有的数据库 DDL“脚本”都是用 C# 类编写的。我使用 Migrator.NET 来执行此操作：我有几个类，其中每个类都包含一些升级或降级数据库的逻辑。

我有一个名为“projectname_test”的数据库，我用它来运行我的单元测试，以应对需要访问数据库的需求。我的 Migrator.NET 类正在升级这个数据库。该数据库由 CI 进程 (CC.NET) 升级。

访问该数据库的单元测试将在运行后删除该数据库中的所有内容。而且，当我想彻底玩它时，我可以简单地删除我的测试数据库；它将由 CC.NET 进程重建。:)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-01T17:49:28.787

如果您使用 NHibernate 作为 ORM，则可以轻松地将真正的 SQL Server 数据库（app.config 中的几行）与内存中的[SQLite](http://www.sqlite.org/)数据库交换，该数据库可以在每次测试时轻松重新创建。这样，将执行单元测试的集成/构建服务器不再需要访问 SQL Server。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-01T17:43:23.140

看看这个问题和答案 [如何使用 NUnit 测试与数据库相关的代码？](https://stackoverflow.com/questions/321180/how-do-i-test-database-related-code-with-nunit/367294#367294)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2014-01-30T05:35:50.053

在大多数产品中，无论是大型托管网站还是带有数据库的收缩包装产品，您通常都有两个想要进行单元测试的场景（我理解有些人可能会超越简单的单元测试）

1.  **全新安装路径**- 当您从头开始创建数据库时
    *   使用 MsBuild 和 SQLCMD 自动创建数据库，传入参数
    *   将 PowerShell 用于任何服务器级管理的东西
2.  **升级路径**- 当您升级现有客户的数据库时
    *   将已清理的 Real World DB 的备份还原为您的基线
    *   如果必须在升级后应用升级
    *   再次使用 PowerShell、MsBuild、SQLCMD 来编排线束

对我来说，即使在进行单元测试时，我也喜欢使用“真实世界”数据进行测试，尤其是真实世界的数据量，以便尽早发现接近**实施阶段的问题。**所以总的来说，我什至不做模拟测试，而是去寻找一个更好的单元测试工具，它可以按需重建和运行。基本上是持续集成方法，或部分 CI（矛盾修饰法）方法。

请注意，如果您采用持续集成方法，即使在实施和开发过程中，您也要牢记的是可交付成果/发布到生产中的部署自动化。基本上从一开始就牢记“**结束**”，因为如果您的新功能不容易部署，那么它就毫无价值。当今天的**大数据**水平可扩展性通常意味着您将客户分隔在不同的数据库中并且必须以可预测的方式在其中几个数据库上重复运行部署脚本时，尤其如此。

有多少次开发人员声明他们**“完成”了**，但是您甚至不知道如何开始对其进行功能测试，因为它不能部署到开发人员环境以外的任何地方。

因此，您正在创建的单元测试工具不仅可以真正测试您的代码，还可以测试部署脚本。一般来说，为了实现这一点，我使用 Jenkins、MsBuild、PowerShell。如果涉及浏览器，我会使用 VirtualBox 为 VM 启动不同的浏览器。

# user-interface - 在两个列表框之间移动项目。你把这种类型的表格叫做什么？

> ID：492897
> 
> 赞同：5
> 
> 时间：2009-01-29T18:47:40.523
> 
> 标签：user-interface, forms, naming

您如何称呼具有两个列表框和按钮以将列表框项目从一个移动到另一个的表单？我一直称它为“切换列表”。

[切换列表 http://img136.imageshack.us/img136/9123/formtypegh0.png](http://img136.imageshack.us/img136/9123/formtypegh0.png)

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-01-29T18:50:27.587

互斥名单

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-29T18:51:47.460

[双重名单](http://www.cs.helsinki.fi/u/salaakso/patterns/Double-List.html)？

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-29T18:51:56.180

老实说，我一直认为它被简单地称为**“在两个列表框之间移动项目”**。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-29T18:52:12.763

子集选择对话框

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-29T19:07:39.830

在我工作的地方，我们称之为“添加删除框”。不知道为什么，事情就是这样发生的，而且似乎一直在坚持。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-29T18:49:49.787

切换列表很好。

交换对话框也很好。

顺便说一句，你也有拖放界面吗？

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-29T18:49:50.770

尽管听起来很傻，但我一直使用“双列表选择器”。技术含量高。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-29T19:06:01.407

让我们更清楚地了解这里的功能..

你展示它的方式，它基本上是一种不同的方式来做一个允许多项选择的列表（然后我称之为“选择器”）。

我见过的更典型的使用场景是使用一些排序功能（隐式 - 新项目被添加到底部，或显式使用向上/向下/顶部/底部按钮）将事物放在“添加”列表中一定的顺序。

不知道我会怎么称呼它，因为它正在选择和订购..有序列表选择器或选择器。

# c++ - 使用 C++ 在 Linux 中监视磁盘安装的最佳方法？

> ID：492916
> 
> 赞同：8
> 
> 时间：2009-01-29T18:52:20.547
> 
> 标签：c++, linux

我目前正在构建一个 Carputer 前端，它需要的一个功能是能够识别何时插入外部媒体，例如 USB/SD 记忆棒或 iPod。插入后，我将扫描设备中的音乐/视频/图像并将它们添加到媒体库中。或者，我需要知道这些设备何时被删除，以便我可以从当前可用的媒体中删除添加的项目。

**我的问题是，使用 C++ 在 Linux 环境中监视磁盘插入/删除的最佳方法是什么？**

我可以监视 /media 文件夹以了解 Linux 何时自动挂载磁盘，但这是完成任务的最佳方式吗？感谢您的任何见解！

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-29T18:55:27.653

您可以从 NetLink 套接字读取[内核 uevents](http://www.kernel.org/doc/pending/hotplug.txt)。它提供有关设备添加/删除、挂载/卸载的事件。

> -- 网联
> 
> 监听 netlink 套接字的守护进程会为每个热插拔事件接收一个数据包，其中包含用户模式助手将在环境变量中接收到的相同信息。
> 
> netlink 数据包包含一组以空字符结尾的文本行。netlink 数据包的第一行结合了`$ACTION`和`$DEVPATH`值，用@（at 符号）分隔。第一行之后的每一行都包含一 `KEYWORD=VALUE`对定义热插拔事件变量。
> 
> [...]
> 
> 行动
> 
> 当前热插拔操作：“add”添加设备，“remove”删除它。2.6.22 内核还可以生成“更改”、“在线”、“离线”和“移动”动作。

您可能想要监视`mount`和`umount`操作。请注意，事件不会为您提供设备节点或实际安装点，仅提供设备的 sysfs 节点。如果设备节点管理和挂载管理由外部进程（例如 udev）处理，则您必须自己使用主要和次要设备号和`/proc/mounts`.

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-29T21:13:55.660

如果[`hald`](http://www.freedesktop.org/wiki/Software/hal)在您的系统上运行，您可以观察`org.freedesktop.Hal.Manager.DeviceAdded`DBUS 信号。

坐骑需要注意一些技巧，如果您无法控制挂载器，则可能需要轮询`/proc/mounts`。我看不到任何从[pmount](http://pmount.alioth.debian.org/)或[gnome-volume-manager](http://ftp.gnome.org/pub/gnome/sources/gnome-volume-manager/)获取通知的方法。KDE 4 的[Solid](http://solid.kde.org/)可能为此提供了一个接口，但我还没有深入研究它。

# sharepoint - 找不到程序集 System.ServiceModel

> ID：492921
> 
> 赞同：5
> 
> 时间：2009-01-29T18:54:22.307
> 
> 标签：sharepoint, .net-3.5

我在 sharepoint 上部署 webpart 并遇到一些错误。Web 部件使用来自 Web 服务的数据并使用 Microsoft Chart (Framework 3.5) 显示图表。当我尝试访问它时，出现以下错误：

> 无法加载文件或程序集“System.ServiceModel，Version=3.0.0.0，Culture=neutral，PublicKeyToken=b77a5c561934e089”或其依赖项之一。该系统找不到指定的文件。
> 
> StackTrace：在 System.Web.Services.Protocols.SoapHttpClientProtocol.Invoke （String methodName，Object[] 参数）的 System.Web.Services.Protocols.SoapHttpClientProtocol.ReadResponse（SoapClientMessage 消息，WebResponse 响应，流 responseStream，布尔 asyncCall ）

我尝试将 System.Servicemodel.dll 复制到 bin 文件夹并在 GAC 上注册，但错误没有改变。任何的想法？

谢谢

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-30T07:07:56.787

要扩展上述答案：

听起来您的站点确实在 asp.net 2.x 上运行。由于 System.ServiceModel 是 3.x 组件，因此不会加载程序集。您需要在服务器上安装 3.5，或者如果您已经将 IIS 设置为在 3.5 下运行该站点

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2011-05-23T18:12:04.247

我遇到了类似的问题，但这是因为我的 .NET 框架搞砸了/损坏了，所以我会发布为我修复它的内容。也许这是矫枉过正，但它在没有其他方法的情况下起作用。

[从http://blogs.msdn.com/b/astebner/archive/2008/08/28/8904493.aspx](http://blogs.msdn.com/b/astebner/archive/2008/08/28/8904493.aspx)获取“dotnetfx_cleanup_tool” （我认为其中一个下载链接失败，所以使用另一个）

卸载框架 2.0 及更高版本（我做了 3.5、3.0、2.0。2.0 让我重新启动）。

重要提示：转到 C:\WINDOWS\Microsoft.NET\Framework 并删除或重命名您删除的 .NET 版本的文件夹。

然后我安装了 .NET Framework 2.0 SP2（之后重新启动）。错误消失了。我还安装了 .NET Framework 3.5 SP1（无需重新启动即可工作），错误仍然消失。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-29T18:59:02.640

您的网站是否配置为使用 ASP.NET 2.0.5.something ？

也许这篇文章会有所帮助：

[在 IIS 上强制使用 ASP.NET 3.5](http://www.paraesthesia.com/archive/2008/12/01/forcing-asp.net-3.5-on-iis6.aspx)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-29T20:07:16.107

尝试在您的共享点服务器上安装 .NET Framework 3.5。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-30T07:24:25.893

听起来 Web 部件本身是针对旧版本的 System.ServiceModel 程序集（可能是测试版）构建的。如果您有权访问 Web 部件的源代码，则应针对最新的稳定版本重新编译它。否则，您必须找到完全相同版本的 System.ServiceModel 并将其注册到您的 GAC 中。

编辑：您也可以尝试进入您的网络应用程序的 Web.config 并将您的 System.ServiceModel 引用替换为：

```
<Reference Include="System.ServiceModel">
  <SpecificVersion>False</SpecificVersion>
</Reference> 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-08T03:09:13.517

问题出在 Web 服务中，而不是 webpart。部署 Web 服务的机器安装了框架 2.0。该异常已在 Webpart 上捕获并报告回来。谢谢大家的意见。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2011-11-08T17:23:39.063

启动 Visual Studio 2010 命令提示符或浏览到“C:\Windows\Microsoft.NET\Framework\ v4.0.30319”。并从命令提示符运行以下命令：

aspnet_regiis.exe -iru

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2012-03-13T08:56:45.247

我在 Silverlight 4 应用程序中遇到了同样的问题，并通过关闭调试异常检查来解决它

```
 Common Language Runtime exceptions 
```

在调试 => 异常

希望有帮助

麦克风

# c# - 如何在二维整数数组中找到最常见的整数？

> ID：492923
> 
> 赞同：5
> 
> 时间：2009-01-29T18:54:32.930
> 
> 标签：c#, paint.net

好的，所以我刚刚开始考虑如何为 Paint.NET 实现一个新的图形插件，我需要知道如何在二维整数数组中找到最常见的整数。是否有内置的 C# 方法来执行此操作？或者，有没有人有一个巧妙的方法来做到这一点？

该数组将如下所示：

```
300 300 300 300 300 300 300
  0 150 300 300 300 300 300
  0   0 150 300 300 300 300
  0   0   0   0 300 300 300
  0   0   0   0 150 300 300
  0   0   0   0   0 150 300
  0   0   0   0   0   0 300 
```

我需要知道 300 是数组中最常见的数字。如果没有“最常见”，则只需返回中心数（数组尺寸总是奇数 x 奇数）0。

我将使用“蛮力”算法来实现这一点，除非您的专家可以更快地想出一些东西。

任何帮助将不胜感激。

谢谢！

编辑：更多信息...

这些值几乎总是非常多样化（比我的示例数组更多样化）。这些值将在 0-360 的范围内。根据算法的速度，数组的大小将是 5x5 到大约 17x17。结果将为大图像中的每个像素计算一次……所以越快越好。;)

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-29T19:04:38.353

无论如何，它至少是 O(n*m) ——你必须至少查看每个单元格一次。节省的地方是在寻找最常见的值之前累积每个值的计数；如果您的整数在相对较小的范围内变化（比如说，它们是 uint16），那么您也许可以简单地使用平面数组而不是地图。

我想你也可以保留当前最接近和第二接近的“最常见”候选的运行计数*x*，*y*并且只要你剩下的单元格少于 (n*m)-(xy) 就可以提前退出看，因为在那一点上，亚军不可能超过头号候选人。

像这样的整数运算非常快；即使是百万像素图像，蛮力算法也只需要几毫秒。

我注意到您已经编辑了原始问题，说像素值从 0..255 开始——在这种情况下，肯定会使用简单的平面数组；它足够小，可以轻松放入 l1 dcache，并且在平面数组中查找速度很快。

**[编辑] ：**一旦你建立了直方图数组，处理“没有最常见的数字”的情况就非常简单了：你要做的就是通过它找到“最常见的”和“第二常见的”常见数字；如果它们同样频繁，那么根据定义，没有最常见的。

```
const int numLevels = 360; // you said each cell contains a number [0..360)
int levelFrequencyCounts[numLevels]; // assume this has been populated such that levelFrequencyCounts[i] = number of cells containing "i"
int mostCommon = 0, runnerUp = 0;
for (int i = 1 ; i < numLevels ; ++i)
{
  if ( levelFrequencyCounts[i] > levelFrequencyCounts[mostCommon] )
  {
    runnnerUp = mostCommon;
    mostCommon = i;
  }
}

if ( levelFrequencyCounts[mostCommon] != levelFrequencyCounts[runnerUp] )
{
   return mostCommon;
}
else
{
   return CenterOfInputData; // (something like InputData[n/2][m/2])
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-29T19:06:59.050

> 我将如何在 C# 中做这样的事情？

像这样的东西：

```
Dictionary<int, int> d = new Dictionary<int, int>();
foreach (int value in matrix)
{
 if (!d.ContainsKey(value))
  d.Add(value, 1);
 else
  d[value] = d[value] + 1;
}
KeyValuePair<int, int> biggest = null;
foreach (KeyValuePair<int, int> found in d)
{
  if ((biggest == null) || (biggest.Value < found.Value))
    biggest = found;
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-29T19:07:37.520

一种选择是 LINQ - 效率有点低，但对于非大型数组来说还可以：

```
 var max = (from cell in data.Cast<int>()
               group cell by cell into grp
               select new { Key = grp.Key, Count = grp.Count() } into agg
               orderby agg.Count descending
               select agg).First();
    Console.WriteLine(max.Key + ": " + max.Count); 
```

或者使用锯齿状数组：

```
 var max = (from row in data
              from cell in row
              group cell by cell into grp
              select new {Key = grp.Key, Count = grp.Count()} into agg
              orderby agg.Count descending
              select agg).First();
    Console.WriteLine(max.Key + ": " + max.Count); 
```

实际上，我可能会使用字典/计数。这个例子没有 LINQ，只是“因为”：

```
 Dictionary<int, int> counts = new Dictionary<int, int>();
    foreach (int value in data)
    {
        int count;
        counts.TryGetValue(value, out count);
        counts[value] = count + 1;
    }
    int maxCount = -1, maxValue = 0;
    foreach (KeyValuePair<int, int> pair in counts)
    {
        if (pair.Value > maxCount)
        {
            maxCount = pair.Value;
            maxValue = pair.Key;
        }
    }
    Console.WriteLine(maxCount + ": " + maxValue); 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-29T19:54:30.170

如果速度是您最关心的问题，请不要使用字典。坚持使用字节数组。试试这个：

```
// stores hit counts (0-360)
short[] hitCounts = new short[361];

// iterate through 2d array and increment hit counts
for (int i = 0; i < toEvaluate.Length; i++)
{
    for (int j = 0; j < toEvaluate[i].Length; j++)
        hitCounts[toEvaluate[i][j]]++;
}

int greatestHitCount = 0; // the hit count of the current greatest value
int greatest = -1; // the current greatest valeu

// iterate through values (0-360) and evalute hit counts
for (int i = 0; i < hitCounts.Length; i++)
{
    // the hit count of hitCounts[i] is higher than the current greatest hit count value
    if (hitCounts[i] > greatestHitCount)
    {
        greatestHitCount = vals[i]; // store the new hit count
        greatest = i; // store the greatest value
    }
    // there is already a value with the same hit count (which is the greatest)
    else if (hitCounts[i] == greatestHitCount)
        greatest = -1; // there are more than one value, we can't use this if it ends up being the greatest
}

if (greatest >= 0) // no greatest value found
    return greatest;

// figure out the middle x and y value
int x = (toEvaluate.Length - 1) / 2 + 1;
int y = (toEvaluate[x].Length - 1) / 2 + 1;

// return the value at the center of the 2d array as the value
return toEvaluate[x][y]; 
```

当速度成为对可读性的关注时，您最终会得到一定丑陋的代码。上述内容肯定可以从重构中受益（因此过度评论），但它应该运行得很快。如果速度不够快，您可以通过将其移至非托管代码来获得更多优化。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-29T22:43:29.863

你的形象：

```
300+ 300+ 300+ 300 300 300 300
  0+ 150+ 300+ 300 300 300 300
  0+   0+ 150+ 300 300 300 300
  0    0    0    0 300 300 300
  0    0    0    0 150 300 300
  0    0    0    0   0 150 300
  0    0    0    0   0   0 300 
```

标记 (+) 数字是您的窗口。w,h 是您的窗口尺寸。应用[桶排序](http://en.wikipedia.org/wiki/Bucket_sort)（正如其他人建议的那样，因为您的值范围非常有限）。不要像[Crashworks](https://stackoverflow.com/questions/492923/how-to-find-the-most-common-int-in-a-2d-array-of-ints/492960#492960)建议的那样中途削减您的评估。不要抛出你的结果。这是第一步。

```
300- 300- 300- 300 300 300 300
  0\. 150\. 300\. 300 300 300 300
  0\.   0\. 150\. 300 300 300 300
  0+   0+   0+   0 300 300 300
  0    0    0    0 150 300 300
  0    0    0    0   0 150 300
  0    0    0    0   0   0 300 
```

移动你的窗口。而不是添加，减去您传递的最后一行/列中的存储桶并添加新的存储桶。这样，您检查每个像素 2(w+h) 次，即当它穿过窗口边界时，而不是 w*h 次，即当该像素在窗口中时，在一个幼稚的实现中。

换句话说，您需要像这样移动窗口：

```
|  ^->|  ^
|  |  |  |
|  |  |  |
V->|  V->| 
```

我假设您正在尝试实现非线性卷积滤波器。

欢迎指正。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-03T17:30:03.890

查看 Paint.NET 中的 LocalHistogramEffect 代码，尤其是 LocalHistorgramEffect.RenderRect。

我遍历输入图像，维护每个源像素的强度直方图，其中包含目标像素的“r”个像素。当遍历输出像素时，它将前沿添加到直方图并减去后沿。它可以很好地处理所有边缘情况，而且速度非常快。它是 Median、Unfocus、Outline 和 Remove Noise 效果的基础。

调整它以支持 Hue 而不是 RGB 强度将是相当微不足道的。

性能非常好，对于您的目的，它在 O(r^2+w *r+n* w) 中运行，其中 r 是半径，w 是图像的宽度，n 是直方图中的级别数.

-tjackson

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-29T20:03:37.890

迈克尔击败了我，但我也会这样做，如下所示：

```
 int MaxValueIn2dArray(int[,] matrix)
    {
        var d = new int[360];
        int MaxValue = 0;
        for (int x = 0; x <= matrix.GetUpperBound(0); x++)
        {
            for (int y = 0; y <= matrix.GetUpperBound(1); y++)
            {
                d[matrix[x, y]]++;
            }
        }
        foreach (int value in d)
        {
            if (value > MaxValue) MaxValue = value;
        }
        return MaxValue;
    } 
```

它需要针对您的特定需求进行优化。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-20T17:22:15.120

我将提供的只是检查每个单元格的任何算法（这几乎是您期望做的）做两件额外的事情：

1.) 确保在当前最常用值的计数 > (M x N / 2) 时退出例程。如果某些东西在您的网格上具有 >50% 的覆盖率，那么它是最常见的值，无需继续。如果您的例程只需要在大多数情况下正确，那么您可以降低百分比并将其视为启发式。您甚至可以运行一些分析，例如如果覆盖率 > 37.6%，那么 99.9% 的时间它将是最常见的值，然后使用该百分比。

2.) 如果有任何方法可以确定最常见的值可能在哪一侧、角落或一般位置（外边缘、中间等），然后您可以按照上面的优化 1 的顺序进行扫描可以减少您的大量扫描。例如，在您的示例中，右上角的公共值很重。如果这可以通过某种启发式方法确定，您可以以某种方式从右上角扫描到左下角。如果所需的扫描模式很复杂，请预先生成它。

# richtextbox - 回发时不保留 FreeTextBox 选项卡

> ID：492927
> 
> 赞同：0
> 
> 时间：2009-01-29T18:56:21.223
> 
> 标签：richtextbox, richtextediting, freetextbox

我们在 Intranet 上使用 FreeTextBox 3.1.6。该控件出现在 Visual Studio 2008 中构建的 ASP.Net 项目中。

当客户端在文本框中输入选项卡时，这些选项卡不会在回发时保留。相反，选项卡会丢失。其他文本格式（如粗体、斜体或字体大小）将被保留。

即使网页上发生的回发事件没有将任何内容保存到数据库中，我们也会丢失选项卡。根据[http://wiki.freetextbox.com/default.aspx/FreeTextBoxWiki.Installation，FreeTextBox](http://wiki.freetextbox.com/default.aspx/FreeTextBoxWiki.Installation)使用的 JavaScript 和 XML 存储在 dll 中。所以我无法编辑这些文件的内容。

**有没有人遇到过 FreeTextBox 的这个问题？如果是这样，您是如何解决的？**

这是发生的行为。在 FreeTextBox 控件中输入带有选项卡的文本。

[替代文字 http://img132.imageshack.us/img132/4826/ftb1postcz4.gi​​f](http://img132.imageshack.us/img132/4826/ftb1postcz4.gif)

然后选择“保存”按钮。这是一个回发页面的命令按钮。在我的测试场景中，没有任何内容可以从数据库中保存和加载。FreeTextBox 控件严格显示已发布的文本。我的猜测是 ViewState 中的机制处理，但我不确定。

[替代文字 http://img132.imageshack.us/img132/175/ftb2postbd6.gif](http://img132.imageshack.us/img132/175/ftb2postbd6.gif)

如您所见，所有选项卡都消失了。甚至在单词之间插入的标签也消失了。谢谢你的帮助。

肯

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-29T20:43:18.810

将 TabMode 设置为“InsertSpaces”并不能解决此问题。我用于实例化控件的源代码如下。我发布的图片以前没有出现过。访问这些链接以查看它们。 [http://img132.imageshack.us/img132/4826/ftb1postcz4.gi](http://img132.imageshack.us/img132/4826/ftb1postcz4.gif) [​​f http://img132.imageshack.us/img132/175/ftb2postbd6.gif](http://img132.imageshack.us/img132/175/ftb2postbd6.gif)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-29T20:43:57.747

```
<FTB:FREETEXTBOX id="txtDocument" EnableHtmlMode="False" Width="100%" runat="server" AllowHtmlMode="True"
StripAllScripting="True" Height="400px" FormatHtmlTagsToXhtml="False"
AutoGenerateToolbarsFromString="true"
ToolbarLayout="ParagraphMenu, FontFacesMenu, FontSizesMenu, FontForeColorsMenu, FontForeColorPicker| Bold, Italic, Underline, Strikethrough; Superscript, Subscript, RemoveFormat| JustifyLeft, JustifyRight, JustifyCenter, JustifyFull; BulletedList, NumberedList, Indent, Outdent; CreateLink, Unlink, InsertImage, InsertRule| Cut, Copy, Paste; Undo, Redo, Print"
TabMode="InsertSpaces"
> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-29T22:08:09.513

我在以前的一些开发中一直在使用自由文本框，但它有一些怪癖并且在 IE 中无法正常工作。

尝试移至 FCKEditor 或 TinyMCE。他们似乎比 FTB 更好的体验。我选择了 FCK，我认为 WordPress 使用的是 TinyMCE。如果可以选择切换编辑器，请尝试它们。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-29T21:52:50.730

我找到了答案。原始程序员的代码在提交时截取了文本框的内容。该代码为日元、欧元和英镑等特殊货币字符重新格式化了文本。

这是代码的样子。

Dim hstrg As String = txtDocument.Text Dim f As New FreeTextBoxControls.Support.Formatter hstrg = f.HtmlToXhtml(hstrg)

**解决这个问题的是注释掉 HtmlToXhtml() 方法。** 我们不需要内容与 Xhtml 兼容，所以这对我们来说是一个可行的选择。

# visual-studio-2008 - Visual Studio 2008 自动保存

> ID：492932
> 
> 赞同：6
> 
> 时间：2009-01-29T18:59:16.727
> 
> 标签：visual-studio-2008, autosave

当我的电脑崩溃时，我刚刚失去了大约一个小时的工作。Visual Studio 2008 中是否有定时自动保存功能？

如果是，它在哪里配置。

这可能很明显，但我没有找到它。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-29T19:01:28.297

工具/选项/环境/自动恢复

?

似乎备份文件位于此文件夹中：

```
\...\My Documents\Visual Studio <version>\Backup Files\<projectname> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2015-08-05T18:51:25.420

这里有一个插件：http: [//cbates.net/document-autosave-for-visual-studio/](http://cbates.net/document-autosave-for-visual-studio/) 它在失去焦点时保存（非常方便）。

# c# - 免费的高级下拉列表控件（Windows Forms .Net）

> ID：492936
> 
> 赞同：3
> 
> 时间：2009-01-29T19:00:09.970
> 
> 标签：c#, .net, winforms, user-controls, combobox

我正在寻找一个免费的高级下拉列表控件。基本上是提供一个下拉列表的东西，它可以有图标，每个条目有多个文本（最好是一大段文本，然后是下面一小段文本）。

有人知道这样的控制吗？我已经看了一下，但似乎找不到。

如果我找不到它，我想我将不得不自己创建它。我已经对自定义控件做了一些工作，但我不确定我会怎么做……如何使用 ComboBox 或其他东西，但要让每个条目都可以完全以图形方式自定义？

任何指向控件的链接或有关如何创建控件的提示将不胜感激。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-29T19:02:18.653

这不是一个下拉列表，但我认为您可以使用[这里](http://www.codeproject.com/KB/list/OAKListView.aspx)的知识来做同样的事情

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-03T01:28:49.213

Check out [Krypton Toolkit](http://www.componentfactory.com) which is free.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-29T19:17:23.833

我没有在 WinForms 的免费方面找到任何可以让您执行此操作的内容。但是，如果您有绿色字段，WPF 会为您提供开箱即用的内容。

# language-agnostic - 如何通过在线 Web 服务从美国邮政编码中获取州和城市信息？

> ID：492951
> 
> 赞同：13
> 
> 时间：2009-01-29T19:02:58.217
> 
> 标签：language-agnostic

我希望能够通过 Web 应用程序对邮政编码所在的城市和州进行最佳猜测。是否有一些网络服务可以用来解决这个问题？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-01-29T19:09:14.630

讨厌这样对你，但[看这里](http://www.google.com/search?hl=en&sa=X&oi=spell&resnum=1&ct=result&cd=1&q=zip+code+to+city+state&spell=1)......

我相信[USPS 有](http://www.usps.com/webtools/welcome.htm)一些查询的 API，你应该调查一下。

但是，这里有一些来自上述资源：

*   [http://www.cedar.buffalo.edu/AdServ/zip-search.html](http://www.cedar.buffalo.edu/AdServ/zip-search.html) - 包括数据库，因此您可以自己托管一个
*   [http://www.zipinfo.com/search/zipcode.htm](http://www.zipinfo.com/search/zipcode.htm) - 商业网站，但他们有一个简单的搜索
*   [http://zip4.usps.com/zip4/citytown_zip.jsp](http://zip4.usps.com/zip4/citytown_zip.jsp) - USPS 接口，可能有[API](http://www.usps.com/webtools/welcome.htm)
*   [http://www.webservicex.net/uszip.asmx?op=GetInfoByZIP](http://www.webservicex.net/uszip.asmx?op=GetInfoByZIP) - SOAP 接口

-亚当

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-29T19:06:44.370

USPS 对此有一个 API，但您必须注册：

[USPS 网络工具](http://www.usps.com/webtools/welcome.htm)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2012-04-24T01:56:47.190

我发现了几种使用基于 Web 的 API 的方法。我认为[美国邮政服务](http://www.usps.com/)将是最准确的，因为邮政编码是他们的东西，但[Ziptastic](http://ziptasticapi.com)看起来更容易。

## 使用美国邮政服务 HTTP/XML API

根据[美国邮政服务网站上的此页面，该页面记录了他们基于 XML 的 Web API ，特别是](https://www.usps.com/business/webtools-technical-guides.htm)[此 PDF 文档](https://www.usps.com/webtools/_pdf/Address-Information-v3-1b.pdf)的第 4.0 节（第 22 页），他们有一个 URL，您可以在其中发送包含 5 位邮政编码的 XML 请求，他们将使用包含相应城市和州的 XML 文档进行响应。

根据他们的文档，您将发送以下内容：

```
http://SERVERNAME/ShippingAPITest.dll?API=CityStateLookup&XML=<CityStateLookupRequest%20USERID="xxxxxxx"><ZipCode ID= "0"><Zip5>90210</Zip5></ZipCode></CityStateLookupRequest> 
```

以下是您将收到的回复：

```
<?xml version="1.0"?> 
<CityStateLookupResponse> 
    <ZipCode ID="0"> 
        <Zip5>90210</Zip5> 
        <City>BEVERLY HILLS</City> 
        <State>CA</State> 
    </ZipCode> 
</CityStateLookupResponse> 
```

USPS*确实*要求您在使用 API 之前向他们注册，但据我所知，访问是免费的。顺便说一句，他们的 API 还有一些其他功能：您可以进行地址标准化和邮政编码查找，以及一整套跟踪、运输、标签等。

## 使用 Ziptastic HTTP/JSON API

这是一项相当新的服务，但根据他们的文档，看起来您需要做的就是向[http://ziptasticapi.com](http://ziptasticapi.com)发送一个 GET 请求，如下所示：

```
GET http://ziptasticapi.com/48867 
```

他们将返回一个 JSON 对象，如下所示：

```
{"country": "US", "state": "MI", "city": "OWOSSO"} 
```

确实，它有效。您可以通过执行以下操作从命令行对此进行测试：

```
curl http://ziptasticapi.com/48867 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-29T19:07:12.950

这些人似乎暴露了一个...

[http://www.webservicex.net/uszip.asmx](http://www.webservicex.net/uszip.asmx)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-29T19:09:23.290

您可以获得一个将邮政编码映射到经度/纬度的数据库，以及另一个提供所有美国城市的经度/纬度的数据库。然后你就可以在你身边做这件事，而不必发送到网络服务。

我已经看过这两个数据库，但我不记得现在在哪里可以找到它们。我会四处寻找并尝试记住添加评论。

# c# - 如何从 C# webservice 检索客户端的 PC 名称

> ID：492952
> 
> 赞同：1
> 
> 时间：2009-01-29T19:02:58.560
> 
> 标签：c#, web-services

我有一个在单独的服务器机器上运行的 C# Web 服务。我希望能够在 Web 服务上使用特定方法时检索客户端计算机名称。我在网上搜索过，人们提到如果客户端连接到路由器，这将很难检索客户端机器名称。

更新：如果没有办法解决路由器问题，我将如何获取客户端的信息（ei ip 地址、机器名称、....任何东西）

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-29T19:16:12.387

```
HttpContext.Current.Request.UserHostAddress
HttpContext.Current.Request.UserHostName 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-29T19:05:04.983

我不认为这真的是可能的。如果用户在路由器后面，那么您将得到的只是路由器报告的任何内容。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-29T20:46:43.310

我不知道从 Web 服务中检索客户端 PC 名称的方法。但是，您可以将名称作为参数发送到您的 Web 服务。我们将 的值`Environment.MachineName`作为参数发送到我们的 Web 服务之一。这将使信息在 Web 服务中可用。

当然，我们只有 WinForms 客户端访问 Web 服务。你可能无法做同样的事情。

# c++ - 从非托管 C++ 调用 PowerShell 脚本

> ID：492953
> 
> 赞同：2
> 
> 时间：2009-01-29T19:02:59.497
> 
> 标签：c++, windows, powershell

Microsoft 似乎正在将大量配置和查询功能转移到 PowerShell（可从 C# 或托管 C++ 访问），同时弃用甚至删除旧 API（可用于 C 或非托管 C++）。我们这些拥有大量非托管 C++ 程序但无法切换到托管 C++ 的人可能需要调用 PowerShell cmdlet（至少，我现在有一个）——我们该怎么做呢？

有人建议反向 PInvoke（托管/非托管 thunking）可能能够做一些事情，但我希望有一种比 thunking 或解析 PowerShell 脚本的文本输出更好的方法。

[[注意：这是我昨天提出](https://stackoverflow.com/questions/489023/querying-exchange-2007-storage-group-database-details-with-unmanaged-c)的一个经过修改和概括的查询，可能过于专业化。]

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-29T20:10:44.757

MS 的建议可能是将通常非托管 C++ 应用程序中的特定类/模块编译为托管代码（使用 /clr 编译单个文件），并让 IJW 转换代码管理对其的调用（并从管理位）。我被告知（来自 MS VC++ 人员）这是向大型非托管应用程序添加托管调用位的预期方法。

希望有帮助。

# c# - 这种 ASP.Net 身份验证模型的安全性如何？

> ID：492954
> 
> 赞同：3
> 
> 时间：2009-01-29T19:03:00.697
> 
> 标签：c#, asp.net, security

我已经使用 c# 和 asp.net 创建了一个 Web 身份验证应用程序，并希望了解您认为它的安全性。所有导航都是通过https完成的。

**用户注册**

1.  用户输入 3 个数据点（SSN、Lname 和 DOB）。如果在我们的系统中找到该组合，则会设置会话变量并导航到下一页。
2.  如果设置了#1 的会话变量，继续并询问用户名、密码、安全问答等。使用 Linq 保存数据并在实际保存事件之前验证会话变量。PWD 和安全答案使用 salt 和 sha 进行哈希处理。（使用验证控件和文本框限制来限制输入）

**重设密码**

1.  与注册中的#1 相同，但包括用户名。如果没问题，设置第 1 步会话变量。
2.  如果设置了第 1 步会话变量，则最多询问 3 次安全问题。加盐/散列并验证数据库加盐/散列。如果匹配，则设置第 2 步会话变量。（使用验证控件和文本框限制来限制输入）
3.  检查步骤 2 会话变量。求新密码。使用 LINQ 散列/加盐并保存。

**登录**（使用验证控件和文本框限制来限制输入）

1.  收集用户名和密码。与用户名匹配的哈希/盐密码，并查看密码是否与哈希匹配。如果没问题，实例化用户对象并传递到默认页面。
2.  所有页面都继承自母版页。Masterpage 具有验证用户对象是否设置为有效实例的代码。如果不是有效的用户对象，则调用注销，重定向到主登录页面。

有点罗嗦，但想清楚。

我在这里错过了什么吗？我想使用 MS 的表单身份验证，但决定推出自己的身份验证，因为我在使用 FBA 完成一些我想要完成的自定义内容时遇到了一些问题。通过使用会话变量作为步骤完成标记，这是否足以防止会话窃取或书签？有一个更好的方法吗？

请问有什么想法吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-29T19:27:34.047

ASP.NET 表单身份验证或使用成员资格提供程序位的哪些方面不符合您的需求？我发现两者在许多不同的情况下都非常灵活？

自己动手通常会让未来的生活变得艰难，尤其是当你需要开始做出改变的时候。此外，您现在使用母版页来验证用户登录状态等可能还不错，但是当您需要更多母版页时，您就开始需要在每个母版页中复制相同的代码块并保持一致。这可能会成为未来某个地方的维护噩梦。

如果您没有在框架中使用现成的身份验证工具，那么您应该在其他地方使用这种东西，例如在 HttpModule 中。

我认为你应该重新审视你正在做的事情。如果您需要将用户特定的数据/对象挂在用户对象之外，请查看实现您自己的自定义`IIdentity`对象。然后分配给`IPrincipal`您可以`Context.User`在 ASP.NET 中附加的自定义。

@asp316 和 @Jack（评论）我建议抓住这两本书：

[Dominick Baier](http://www.leastprivilege.com/)开发更安全的[Microsoft® ASP.NET 2.0 应用程序](https://rads.stackoverflow.com/amzn/click/com/0735623317)

Stefan Schackow 的[专业 ASP.NET 2.0 安全性、成员资格和角色管理](https://rads.stackoverflow.com/amzn/click/com/0764596985)

您会惊讶于 .NET 中内置的安全基础结构的真正灵活性。`<authentication mode="Forms">`除了在 web.config 中添加设置并`<asp:login runat="server"/>`在页面上添加控件之外，它还有很多其他功能。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-01-29T19:52:33.203

“自己动手”的问题在于，它很容易以微妙的方式出错，以至于它*看起来*有效。然后，您当然会部署此代码并继续处理其他事情，而不知道有任何问题。毕竟，它通过了你所有的测试。

一年后，事实证明您的网站在六个月前被黑客入侵，而直到那时您才知道。

找到一种依赖安全专家编写的实现的方法要好得多。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-29T19:40:21.493

我认为你已经准备好了；我还会在一定数量的错误登录尝试后将用户锁定一段时间（5 次错误尝试后 1 小时？）并检查请求之间的时间（根据我的经验，AjaxControlToolkit“nobot”在这里可以创造奇迹）。

一种选择，而不是使用您的母版页作为安全代码，是实现一个页面（或母版页）可以继承的接口；这样，如果您确实扩展到多个母版页，或者如果您有母版页之外的页面，您可以继续使用相同的安全检查代码。

根据您的要求，我会回避（必需的）安全问题；我总是忘记我的。您已经在检查 SSN、生日、姓氏、用户名和密码；任何知道这一切的人都可能猜出你母亲的娘家姓。

[编辑]

另外，我**确实**认为自己动手是可以的，只要你疯狂地审查它。扔一些其他人，看看它是如何支撑的。我完全理解 ASP.NET 控件选项的不灵活；他们的控件*可能*会更安全（尽管，你永远不应该盲目相信任何东西，尤其是你不知道神奇黑匣子背后发生了什么的东西），但有时你只需要在它不够灵活时自己动手。

# c# - 表单显示是否依赖于 Visual Studio 中的开发机器？

> ID：492957
> 
> 赞同：0
> 
> 时间：2009-01-29T19:03:28.417
> 
> 标签：c#, visual-studio

我在 Visual Studio 中有一个 C# Windows 应用程序（即不是 Web 应用程序）。最初的开发环境是具有 1920x1200 像素屏幕的 Dell Latitude D800。由于大量像素使文本非常小，我以可读性为名调整了许多不同的默认字体。

我已经将开发转移到新的笔记本电脑上，一台配备 1440x900 显示屏的 Latitude D630。通过在新机器上创建一个新项目并添加现有对象/文件/等来移动该应用程序。

问题是我的许多表格不再统一显示。现在有些太大了，以至于右侧的项目超出了框架，而其他的则较小，框架右侧有多余的空间。就好像“像素”的值现在从一种形式到另一种形式不同。当可执行文件安装在生产机器上时，这些更改仍然存在。

关于发生了什么以及如何恢复秩序的任何想法？谢谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-29T19:07:11.593

一个不错的选择是检查您的字体 DPI 设置。默认情况下，它设置为 96。它是您的窗口显示设置的一部分。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-30T15:08:01.840

一些实验表明，当显示为最大化的 MDI 子项时，表单的声明大小显然会影响表单比例（每屏幕英寸的长度和宽度单位）中对象的大小。

我不知道为什么它会影响它。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-29T22:30:21.933

Winforms 包含许多围绕使表单的显示合理地独立于分辨率的问题而设计的技术。但是很多这种技术需要你理解和使用它——例如锚定、停靠、布局面板和自动缩放。如果您误用了这些属性，您通常直到您第一次以不同的分辨率测试您的应用程序的那一天才知道它。

不幸的是，对于“为什么我的表格搞砸了？”这个问题并没有真正的灵丹妙药答案。您的表格被搞砸了，因为它们没有设计独立于分辨率的内容。有很多可能的问题：您可能将控件锚定到错误的东西上，有人可以通过覆盖控件上的自动缩放来“修复”布局问题，实际上，它是无止境的。

通常，在遗留应用程序中解决此类问题的最佳方法是在测试应用程序中缓慢构建违规表单的原型副本，并在调整其大小和更改屏幕分辨率时观察其行为。这将帮助您确定最初应该如何设计表单；然后，您可以将所学内容恢复到原始形式并进行修复。

然后从一开始就将其设计到您的开发过程中。我正在构建的大型 UI 密集型桌面应用程序中没有这些问题的原因之一是我已经使程序中的每个表单都可调整大小，并且我在测试期间一直调整它们的大小以查看它们是否搞砸了。当然，我也使用不同的屏幕分辨率进行测试。这些问题一旦成为系统性问题就很难解决；及早发现它们让我的生活充满了痛苦。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-29T21:39:57.650

据我所知，这并不能解释为什么某些形式受到的影响与其他形式不同。

# c# - 如何自动登录到asp.net应用程序

> ID：492964
> 
> 赞同：0
> 
> 时间：2009-01-29T19:05:28.443
> 
> 标签：c#, web-applications

我正在构建一个 Intranet 应用程序，要求是登录用户而不要求使用他登录到计算机的 windows 凭据的凭据，如果需要，用户可以从应用程序注销并使用弹出的 windows 凭据登录。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-29T19:07:09.253

[使用 Windows 身份验证。](http://msdn.microsoft.com/en-us/library/ms998358.aspx)

不过，我认为没有真正的方法可以使用 Windows 身份验证退出网站。您要么已通过身份验证，要么没有。

另外，我相信自动登录只会发生：

*   使用 IE 时
*   在其他浏览器中首次登录后保存凭据后
*   编辑浏览器特定设置后（如[FireFox 的 NTLM 设置](http://sivel.net/2007/05/firefox-ntlm-sso/)）

# javascript - 动态加载多个脚本描述相同的 JS 脚本

> ID：492966
> 
> 赞同：0
> 
> 时间：2009-01-29T19:06:04.060
> 
> 标签：javascript, oop

我有一个有趣的问题，我不确定如何最好地解决。

我有包含以下内容的 JS 脚本：

```
 var obj = new namespace.MyObjectName("key", [12, 11, 22, 33, 454, 552, 222], [33, 22, 33, 11, 22, 222, 111]);

   namespace.MyObjectName = function(keyName, data1, data2) {
    this.myData1 = data1;
    this.myData2 = data2;

    this.holder = [
        [keyName, [myData1, myData2]]
    ];
   };

   namespace.MyObjectName.prototype.DoSomething = function(arg1, argArray) {
    this.globalVar = [
      "Display " + arg1 + " into string using " + argArray[0] + "<br> for visual purposes",

      "Display " + arg1 + " into string using " + argArray[2] + "<br> for visual purposes"
    ];
   }; 
```

自动化正在创建这些 JS 文件的副本，每个文件都包含与上述相同的对象声明，文件名如下：

*   文件1.js
*   文件2.js

每个文件的区别在于*DoSomething*方法名称内容总是不同/生成的，传递给构造函数的数组值也是如此。

在独立使用 JS 的生命周期中，以上所有内容都很好。

* * *

我现在要做的是让 HTML 页面动态加载 1 个或多个这些文件（以便稍后通过要编写的代码进行比较），为此我可能会选择[这个答案](https://stackoverflow.com/questions/203113/use-javascript-to-inject-script-references-as-needed)，但是因为每个脚本都声明对象相同方式，当我加载多个副本时，我面临着弄清楚如何阻止它们相互践踏。

以下是我正在考虑的一些选项：

1.  以这样的方式编写 JS，使每个脚本文件对象都具有唯一的命名空间，但是当加载时，它会以某种方式注册自己，并在 HTML 中使用一段主 JS 代码来保存所有对象引用
    *   以这样一种方式编写 HTML，即每个脚本都以隔离的方式加载（据我所知，在 JS 中没有办法做到这一点，但我可能是错的）
    *   其他一些人们可能有想法的未知方法

我目前的偏见是（1），但我把整个事情都拿出来讨论，因为这种方法可能有固有的问题，或者其他方法可能被清楚地证明是优越的。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-29T19:17:33.833

关于 (2)，可以使用 iframe 在沙箱中运行 javascript，例如查看 Dean Edwards 的[Sandbox.eval()](http://dean.edwards.name/weblog/2006/11/sandbox/)或[Slickspeed Selectors Test](http://mootools.net/slickspeed/)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-29T19:32:16.503

我真的不明白这个问题，但为了避免你可以做的命名空间的践踏：

```
var namespace = namespace || function() {} 
```

# .net - 是否有用于验证安装的 .NET 版本的命令行命令

> ID：492967
> 
> 赞同：65
> 
> 时间：2009-01-29T19:06:32.623
> 
> 标签：.net, windows, batch-file, cmd

我有一组用于执行脚本安装的脚本。您可以在任何服务器 2008 机器上使用这些脚本。但是，我需要使用 dos 批处理文件检查是否已安装 .NET 3.5（在脚本运行之前）。那可能吗？

我知道我可以检查一个文件是否`C:\WINDOWS\Microsoft.NET\Framework\v3.5`存在，但如果有一些更可靠的东西会很好。

我想检查它是否实际安装，而不仅仅是目录/文件是否存在。

谢谢

* * *

## 回答 #1

> 赞同：75
> 
> 时间：2011-07-29T09:51:04.323

既然您说您想知道它是否实际安装，我认为最好的方法（缺少运行版本特定代码）是检查令人放心的名为“安装”的注册表项。0x1 表示是：

```
C:\>reg query "HKLM\SOFTWARE\Microsoft\NET Framework Setup\NDP\v3.5"| findstr Install

   Install     REG_DWORD       0x1
   InstallPath REG_SZ  c:\WINNT\Microsoft.NET\Framework\v3.5\ 
```

这也恰好是“微软推荐”的[官方方法](http://support.microsoft.com/kb/318785)。

WMI 是另一种可能性，但似乎不切实际（慢？在我的 C2D、SSD 上需要 2 分钟）。也许它在您的服务器上效果更好：

```
C:\>wmic product where "Name like 'Microsoft .Net%'" get Name, Version

Name                                                Version
Microsoft .NET Compact Framework 1.0 SP3 Developer  1.0.4292
Microsoft .NET Framework 3.0 Service Pack 2         3.2.30729
Microsoft .NET Framework 3.5 SP1                    3.5.30729
Microsoft .NET Compact Framework 2.0                2.0.5238
Microsoft .NET Framework 4 Client Profile           4.0.30319
Microsoft .NET Framework 4 Multi-Targeting Pack     4.0.30319
Microsoft .NET Framework 2.0 Service Pack 2         2.2.30729
Microsoft .NET Framework 1.1                        1.1.4322
Microsoft .NET Framework 4 Extended                 4.0.30319

C:\>wmic product where "name like 'Microsoft .N%' and version='3.5.30729'" get name

Name  
Microsoft .NET Framework 3.5 SP1 
```

除了这些，我认为 100% 确定的唯一方法是实际运行一个针对您的框架版本编译的简单控制台应用程序。就个人而言，我认为这是不必要的，并且相信注册表方法就好了。

最后，您可以设置一个可从您的服务器访问的 Intranet 测试站点，并嗅探用户代理以确定 .NET 版本。但这当然不是批处理文件解决方案。另请参阅[此处的文档](http://msdn.microsoft.com/en-us/library/aa480198.aspx#netfx30_topic14)。

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2011-03-22T03:55:36.290

您的意思是如下所示的 DOS 命令将完成显示已安装的 .NET 框架的工作：

```
wmic /namespace:\\root\cimv2 path win32_product where "name like '%%.NET%%'" get version 
```

然后可能会显示以下内容：

```
Version
4.0.30319 
```

一旦您掌握了 WMIC 的使用方法，它就非常有用，这比根据您想要实现的目标在脚本中编写 WMI 容易得多。

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2009-01-29T19:15:40.140

不幸的是，最好的方法是检查该目录。我不确定您的意思，但“实际安装”是因为 .NET 3.5 使用与 .NET 3.0 和 .NET 2.0 相同的 CLR，因此所有新功能都包含在该目录中的新程序集中。基本上，如果目录在那里，则安装 3.5。

我唯一要补充的是以这种方式找到目录以获得最大的灵活性：

```
%windir%\Microsoft.NET\Framework\v3.5 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-01-29T19:26:42.567

您可以自己编写一个小控制台应用程序并使用 System.Environment.Version 找出版本。Scott Hanselman 发表了一篇关于它的[博客文章。](http://www.hanselman.com/blog/ProgrammaticallyDetermineWhatVersionOfASPNETYoureRunning.aspx)

或者在注册表中查找已安装的版本。HKLM\Software\Microsoft\NETFramework Setup\NDP

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2010-04-28T00:20:30.900

如果您要运行一个小控制台应用程序，您也可以`clrver.exe`从 .NET SDK 安装。我认为没有比这更干净的了。这不是我的答案（但我碰巧同意），我在[这里](https://stackoverflow.com/questions/139891/140816#140816)找到了。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2014-01-26T17:56:55.503

`REM`搜索 CONFIG 文件，如果没有退出则说明用户没有 .Net framework 2.0 `

```
SET FileName=%windir%\Microsoft.NET\Framework\v2.0.50727\CONFIG
IF EXIST %FileName% GOTO INSTALL_DIALER
ECHO.You currently do not have the Microsoft(c) .NET Framework 2.0 installed. 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2015-09-24T18:01:16.537

这对我有用：

```
@echo off
SETLOCAL ENABLEEXTENSIONS

echo Verify .Net Framework Version

for /f "delims=" %%I in ('dir /B /A:D %windir%\Microsoft.NET\Framework') do (
    for /f "usebackq tokens=1,3 delims= " %%A in (`reg query "HKLM\SOFTWARE\Microsoft\NET Framework Setup\NDP\%%I" 2^>nul ^| findstr Install`) do (
        if %%A==Install (
            if %%B==0x1 (
                echo %%I
            )
        )
    )
)

echo Do you see version v4.5.2 or greater in the list?

pause

ENDLOCAL 
```

将`2^>nul`错误重定向到蒸汽。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2017-01-07T12:28:56.447

您可以检查已安装的 c# 编译器和 .net 的打印版本：

```
@echo off

for /r "%SystemRoot%\Microsoft.NET\Framework\" %%# in ("*csc.exe") do (
    set "l="
    for /f "skip=1 tokens=2 delims=k" %%$ in ('"%%# #"') do (
        if not defined l (
            echo Installed: %%$
            set l=%%$
        )
    )
)

echo latest installed .NET %l% 
```

没有开关，但它`csc.exe`会`-version`在其徽标中打印 .net 版本。您也可以尝试使用 msbuild.exe，但 .net framework 1.* 没有 msbuild。

* * *

## 回答 #9

> 赞同：-2
> 
> 时间：2015-10-15T18:19:55.950

您可以查看 .NET 4 的此页面： [http ://www.itninja.com/question/batch-script-to-check-and-install-dotnet4-0](http://www.itninja.com/question/batch-script-to-check-and-install-dotnet4-0)

# iis - IIS 中的匿名访问和 NTLM 身份验证

> ID：492977
> 
> 赞同：9
> 
> 时间：2009-01-29T19:09:06.863
> 
> 标签：iis, authentication, ntlm, mixed-authentication

我有一个使用 IIS 设置的服务器，并且我的站点有一些页面应该允许匿名访问和一些页面应该需要“集成 Windows 身份验证”。在 IIS 的身份验证方法屏幕上，您似乎可以同时启用“集成 Windows 身份验证”和匿名访问，但我阅读的文档似乎表明您只能使用其中一种。

有谁知道如何允许匿名访问某些页面并要求对其他人进行 NTLM 身份验证？

谢谢，

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-01-29T19:51:20.177

同时启用匿名访问和 Windows 身份验证意味着它将首先尝试匿名访问，如果失败，它将回退到 Windows 身份验证。如果两者都需要，您可以按照 web.config 的建议进行操作，或者将需要保护的页面放在 IIS 的子文件夹中，然后仅启用 Windows 身份验证。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-29T19:13:53.967

您必须使用[web.config 中的授权部分](http://msdn.microsoft.com/en-us/library/8d82143t(v=vs.100).aspx)。

要仅使特定文件夹需要身份验证，您可以让 web.config 仅在子文件夹中包含授权元素，如下所示：

```
<configuration>
   <system.web>
      <authorization>
         <deny users="?" />
      </authorization>
   </system.web>
</configuration> 
```

# .net - 处置时托管资源和本机资源有什么区别？（。网）

> ID：492984
> 
> 赞同：28
> 
> 时间：2009-01-29T19:11:02.413
> 
> 标签：.net, resources, native, idisposable

我正在阅读[有关如何实现 IDisposable 的 MSDN 文章](http://msdn.microsoft.com/en-us/ms244737.aspx)，但我不确定文章中引用的托管资源和本机资源之间的区别。

我有一个类，在处理它时必须处理它的 2 个字段。我应该将它们视为托管资源（仅在处置 = true 时处置）还是本机资源？

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2009-04-21T17:47:25.197

为布赖恩的回答和您的评论/问题添加一点：

托管/非托管资源之间的区别在于垃圾收集器知道托管资源而不知道非托管资源。我知道答案不是很具体，但差异很大。

为了帮助划清界限，这里是 GC 如何运行和清理内存的简短版本（并且可能充满了小错误）：

垃圾收集器知道所有托管对象，但是当垃圾收集运行时，它最初并不知道任何给定对象是否仍在使用中或是否可以被释放。它通过最初将所有对象标记为垃圾，然后从应用程序根遍历到所有引用的对象来确定它是否可以清理对象。每个与根有关系的对象（直接或间接的引用）都被标记为可访问的，不再被视为垃圾。在 GC 运行完每个可到达的对象后，它会清理其余的对象，因为它们不再使用。

在几乎所有使用 .NET 框架对象的情况下，您都可以确保对象是托管的（.NET 提供了几乎所有非托管资源的托管包装器，以确保它们被正确清理）；其他与 Win32 API 挂钩的第三方组件（或执行此操作的组件）是可能引起关注的对象。

有一些 .NET 对象可以被认为有些不受管理。图形库的组件就是一个例子。

大多数“.NET 内存泄漏”并不是真正意义上的内存泄漏。通常，当您*认为*您已从使用中删除了一个对象但实际上该对象仍然对应用程序有一些引用时，它们会发生。一个常见的例子是添加事件处理程序（obj.SomeEvent += OnSomeEvent -or- AddHandler obj.SomeEvent, AddressOf OnSomeEvent）而不是删除它们。

这些“延迟引用”在技术上不是内存泄漏，因为您的应用程序在技术上仍在使用它们；但是，如果它们足够多，您的应用程序可能会遭受严重的性能影响，并可能显示资源问题的迹象（OutOfMemoryExceptions、无法获得窗口句柄等）。

我是一名中级 .NET 开发人员，不幸的是，我亲身了解了这些问题。我建议使用 ANTS Profiler 来帮助熟悉挥之不去的引用（有免费试用版），或者如果您想使用 WinDbg 和 SOS.DLL 进行更深入的研究来查看托管堆。如果您决定研究后者，我建议您阅读 Tess Ferrandez 的博客；她有很多关于有效使用 Windbg 的很棒的教程和建议

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2009-01-29T19:15:57.550

托管资源是另一种托管类型，它实现`IDisposable`. 您需要调用您使用`Dispose()`的任何其他`IDisposable`类型。本机资源是托管世界之外的任何东西，例如本机 Windows 句柄等。

* * *

**编辑**：在评论中回答问题（评论太长）

不，那只是一种托管类型。未实现的正确构造的类型`IDisposable`将由垃圾收集器处理，您无需执行任何其他操作。如果您的类型直接使用本机资源（例如通过调用 Win32 库），您必须`IDisposable`在您的类型上实现并在`Dispose`方法中处理资源。如果您的类型使用由另一种实现的类型封装的本机资源`IDisposable`，则必须在您的类型的方法中调用`Dispose()`此类型的实例。`Dispose`

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-21T18:10:32.613

简短的回答是您在 CLR 背后（到操作系统）获得的任何东西都可以称为“**本机**”。

*   非托管内存分配。如果您在托管类 CantStayManaged 中“新建”一块内存，则 CantStayManaged 负责释放此内存（资源）。
*   文件、管道、事件、同步结构等的句柄 - 作为一个经验法则，如果您调用 WinAPI 来获取指向资源的指针/句柄，那么这些就是“本机资源”

所以现在 CantStayManaged 在出价之前有两件事需要清理。

1.  托管：成员字段和 CLR 分配的任何资源。这通常等同于在您的“Disposable”成员对象上调用 Dispose。
2.  Unmanaged：我们把所有偷偷摸摸的低级东西放在背后。

现在可以通过两种方式触发对象清理。

1.  Dispose(true) 案例：您在类型上显式调用了 Dispose。好程序员。
2.  Dispose(false) 情况：您忘记调用 Dispose，在这种情况下，终结器应该启动并仍然确保正确清理。

在这两种情况下，都应该释放非托管资源，否则“泄漏！”，“崩溃！” 等所有表面。但是您应该只在 Dispose() 前一种情况下尝试清理托管资源。在后者/终结器的情况下 - CLR 可能已经完成并收集了您的一些成员，因此您不应该访问它们（CLR 不保证最终确定对象图的顺序。）因此您可以通过保护来避免问题带`if (AmIBeingCalledFromDispose)`警卫检查的托管清理

高温高压

# django - 如何在 django 评论中包含用户个人资料的图像/徽标

> ID：492987
> 
> 赞同：3
> 
> 时间：2009-01-29T19:12:50.037
> 
> 标签：django, comments

我已经在 django-users 上发布了这个，但还没有收到回复！

所以我有自己的用户个人资料对象（用户的子类）。其中一个字段是 imagefield，它（显然）用于用户上传他们的徽标/缩略图。

问题是我如何将其包含在他们的评论中？

有任何想法吗？提前致谢！

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-01-29T19:40:17.720

在 Django 中不推荐子类化用户。相反，创建一个单独的配置文件模型。

假设您有您的应用程序*foo*。

在 foo 的*models.py*中，添加：

```
class FooUserProfile(models.Model):
   user = models.ForeignKey(User, unique=True)
   user_image = models.ImageField() 
```

然后，在您的*settings.py 中*，添加：

```
AUTH_PROFILE_MODULE = 'foo.FooUserProfile' 
```

现在，只要您有一个用户对象，就可以使用 get_profile() 函数获取其配置文件对象。在您的情况下，您可以在模板中添加：

```
<img src="{{ comment.user.get_profile.user_image }}"/> 
```

一个警告：您需要创建一个 FooUserProfile 并将其与您的用户相关联，每当您创建新用户时。

您可以在 Django 文档、[存储有关用户](http://docs.djangoproject.com/en/dev/topics/auth/#storing-additional-information-about-users)的其他信息或文章[Django 技巧：扩展用户模型中阅读更多内容](http://www.b-list.org/weblog/2006/jun/06/django-tips-extending-user-model/)

# ruby-on-rails - 从 ActiveRecord 的查找中获取最近 10 秒内更新的对象

> ID：492992
> 
> 赞同：0
> 
> 时间：2009-01-29T19:13:52.873
> 
> 标签：ruby-on-rails, activerecord, find

我想从 ActiveRecord 的查找中获取最近 10 秒内更新的对象。

我试着这样做

```
@chats = Chat.find(:all, :conditions => ["updated_at > ?", 10.seconds.ago] ) 
```

也

```
@chats = Chat.find(:all, :conditions => ["updated_at > ?", Time.now-10.seconds] ) 
```

乃至

```
@chats = Chat.find(:all, :conditions => {:updated_at => 10.seconds.ago..0.seconds.ago}] 
```

但我仍然无法让它工作:(

编辑：我正在从另一个应用程序更新该列以使其保持活动状态，并且我正在查看我在过去 10 秒内保持活动状态的所有行，以处理死聊天。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-29T20:19:44.957

你确定你在右边的列上查询吗？我认为您可能需要查看 created_at 时间戳。我不知道你的应用程序，但我很惊讶你正在更新现有的聊天，而不是仅仅插入新的。

所以......如果我的假设是正确的，这可能就是你要找的：

```
@chats = Chat.find(:all, :conditions => ["created_at > ?", 10.seconds.ago] ) 
```

如果不是...请提供更多信息。查询应该可以正常工作，我猜 updated_at 可能没有更新。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-29T23:01:08.983

问题出在 Rails 的 UTC 默认值中。我将其更改为 config.time_zone = 'Pacific Time (US & Canada)' 现在它可以正常工作了:)

# javascript - 用 JavaScript 比较两个日期

> ID：492994
> 
> 赞同：2449
> 
> 时间：2009-01-29T19:14:06.757
> 
> 标签：javascript, date, datetime, compare

有人可以建议一种方法来使用 JavaScript 比较**两个日期**的值大于、小于和不过去吗？这些值将来自文本框。

* * *

## 回答 #1

> 赞同：2934
> 
> 时间：2009-01-29T19:20:10.787

[Date 对象](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date)将执行您想要的操作 - 为每个日期构造一个，然后使用、`>`或比较它们。`<``<=``>=`

, `==`,`!=`和运算`===`符`!==`要求您使用`date.getTime()`as in

```
var d1 = new Date();
var d2 = new Date(d1);
var same = d1.getTime() === d2.getTime();
var notSame = d1.getTime() !== d2.getTime(); 
```

需要明确的是，直接使用日期对象检查是否相等是行不通的

```
var d1 = new Date();
var d2 = new Date(d1);

console.log(d1 == d2);   // prints false (wrong!) 
console.log(d1 === d2);  // prints false (wrong!)
console.log(d1 != d2);   // prints true  (wrong!)
console.log(d1 !== d2);  // prints true  (wrong!)
console.log(d1.getTime() === d2.getTime()); // prints true (correct) 
```

不过，我建议您使用下拉菜单或一些类似的受限日期输入形式而不是文本框，以免您发现自己陷入输入验证地狱。

* * *

对于好奇的[`date.getTime()`文档](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date)：

> 返回指定日期的数值，作为自 1970 年 1 月 1 日 00:00:00 UTC 以来的毫秒数。（之前的时间返回负值。）

* * *

## 回答 #2

> 赞同：475
> 
> 时间：2009-01-31T00:18:07.330

在 javascript 中比较日期的最简单方法是首先将其转换为 Date 对象，然后比较这些日期对象。

您可以在下面找到一个具有三个功能的对象：

*   **日期.比较（a，b）**

    返回一个数字：

    *   -1 如果 a < b
    *   0 如果 a = b
    *   1 如果 a > b
    *   如果 a 或 b 是非法日期，则为 NaN
*   **日期.inRange**（d，开始，结束）

    返回一个布尔值或 NaN：

    *   *如果*d*在*开始*和*结束*（包括）之间，则为*真**
    **   *如果*d*在*start*之前或*end之后，则为**false*。***   如果一个或多个日期是非法的，则为 NaN。**
***   **日期转换**

    由其他函数用于将其输入转换为日期对象。输入可以是

    *   a **date** -object ：输入按原样返回。
    *   一个**数组**：解释为 [年、月、日]。**注意**月份是 0-11。
    *   一个**数字**：解释为自 1970 年 1 月 1 日以来的毫秒数（时间戳）
    *   一个**字符串**：支持几种不同的格式，如“YYYY/MM/DD”、“MM/DD/YYYY”、“2009 年 1 月 31 日”等。
    *   an **object**：解释为具有年、月、日属性的对象。 **注意**月份是 0-11。**

 **.

```
// Source: http://stackoverflow.com/questions/497790
var dates = {
    convert:function(d) {
        // Converts the date in d to a date-object. The input can be:
        //   a date object: returned without modification
        //  an array      : Interpreted as [year,month,day]. NOTE: month is 0-11.
        //   a number     : Interpreted as number of milliseconds
        //                  since 1 Jan 1970 (a timestamp) 
        //   a string     : Any format supported by the javascript engine, like
        //                  "YYYY/MM/DD", "MM/DD/YYYY", "Jan 31 2009" etc.
        //  an object     : Interpreted as an object with year, month and date
        //                  attributes.  **NOTE** month is 0-11.
        return (
            d.constructor === Date ? d :
            d.constructor === Array ? new Date(d[0],d[1],d[2]) :
            d.constructor === Number ? new Date(d) :
            d.constructor === String ? new Date(d) :
            typeof d === "object" ? new Date(d.year,d.month,d.date) :
            NaN
        );
    },
    compare:function(a,b) {
        // Compare two dates (could be of any type supported by the convert
        // function above) and returns:
        //  -1 : if a < b
        //   0 : if a = b
        //   1 : if a > b
        // NaN : if a or b is an illegal date
        // NOTE: The code inside isFinite does an assignment (=).
        return (
            isFinite(a=this.convert(a).valueOf()) &&
            isFinite(b=this.convert(b).valueOf()) ?
            (a>b)-(a<b) :
            NaN
        );
    },
    inRange:function(d,start,end) {
        // Checks if date in d is between dates in start and end.
        // Returns a boolean or NaN:
        //    true  : if d is between start and end (inclusive)
        //    false : if d is before start or after end
        //    NaN   : if one or more of the dates is illegal.
        // NOTE: The code inside isFinite does an assignment (=).
       return (
            isFinite(d=this.convert(d).valueOf()) &&
            isFinite(start=this.convert(start).valueOf()) &&
            isFinite(end=this.convert(end).valueOf()) ?
            start <= d && d <= end :
            NaN
        );
    }
} 
```

* * *

## 回答 #3

> 赞同：419
> 
> 时间：2013-05-23T12:21:09.730

像往常一样比较`<`和，但任何涉及或应该使用前缀的东西。像这样：`>``==``===``+`

```
const x = new Date('2013-05-23');
const y = new Date('2013-05-23');

// less than, greater than is fine:
console.log('x < y', x < y); // false
console.log('x > y', x > y); // false
console.log('x <= y', x <= y); // true
console.log('x >= y', x >= y); // true
console.log('x === y', x === y); // false, oops!

// anything involving '==' or '===' should use the '+' prefix
// it will then compare the dates' millisecond values

console.log('+x === +y', +x === +y); // true
```

* * *

## 回答 #4

> 赞同：189
> 
> 时间：2013-01-31T16:04:16.903

关系运算符`<` `<=` `>` `>=`可用于比较 JavaScript 日期：

```
var d1 = new Date(2013, 0, 1);
var d2 = new Date(2013, 0, 2);
d1 <  d2; // true
d1 <= d2; // true
d1 >  d2; // false
d1 >= d2; // false 
```

但是，等式运算符`==` `!=` `===` `!==`不能用于比较日期（的值），[因为](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Comparison_Operators)：

> *   对于严格或抽象比较，两个不同的对象永远不会相等。
> *   仅当操作数引用相同的对象时，比较对象的表达式才为真。

您可以使用以下任何方法比较日期值是否相等：

```
var d1 = new Date(2013, 0, 1);
var d2 = new Date(2013, 0, 1);
/*
 * note: d1 == d2 returns false as described above
 */
d1.getTime() == d2.getTime(); // true
d1.valueOf() == d2.valueOf(); // true
Number(d1)   == Number(d2);   // true
+d1          == +d2;          // true 
```

两者都[`Date.getTime()`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date/getTime)返回`Date.valueOf()`自 1970 年 1 月 1 日 00:00 UTC 以来的毫秒数。`Number`函数和一元运算符都在后台`+`调用方法。`valueOf()`

* * *

## 回答 #5

> 赞同：95
> 
> 时间：2011-11-01T00:48:12.353

到目前为止，最简单的方法是从另一个日期中减去一个日期并比较结果。

```
var oDateOne = new Date();
var oDateTwo = new Date();

alert(oDateOne - oDateTwo === 0);
alert(oDateOne - oDateTwo < 0);
alert(oDateOne - oDateTwo > 0);
```

* * *

## 回答 #6

> 赞同：87
> 
> 时间：2017-07-11T09:59:46.477

在 JavaScript 中比较**日期**非常简单...... JavaScript 有**内置的****日期**比较系统，这使得比较很容易......

只需按照以下步骤比较 2 个日期值，例如，您有 2 个输入，每个输入都有一个日期值`String`，您可以比较它们...

**1.**你有 2 个从输入中得到的字符串值，你想比较它们，它们如下：

```
var date1 = '01/12/2018';
var date2 = '12/12/2018'; 
```

**2.**需要将它们`Date Object`作为日期值进行比较，所以只需将它们转换为日期，使用`new Date()`，我只是为了解释的简单而重新分配它们，但你可以随心所欲地做：

```
date1 = new Date(date1);
date2 = new Date(date2); 
```

**3.**现在简单地比较它们，使用`>` `<` `>=` `<=`

```
date1 > date2;  //false
date1 < date2;  //true
date1 >= date2; //false
date1 <= date2; //true 
```

[![比较javascript中的日期](https://i.stack.imgur.com/r078N.png)](https://i.stack.imgur.com/r078N.png)

* * *

## 回答 #7

> 赞同：52
> 
> 时间：2013-09-27T15:38:23.410

仅比较日期（忽略时间部分）：

```
Date.prototype.sameDay = function(d) {
  return this.getFullYear() === d.getFullYear()
    && this.getDate() === d.getDate()
    && this.getMonth() === d.getMonth();
} 
```

用法：

```
if(date1.sameDay(date2)) {
    // highlight day on calendar or something else clever
} 
```

* * *

我不再建议修改`prototype`内置对象的。试试这个：

```
function isSameDay(d1, d2) {
  return d1.getFullYear() === d2.getFullYear() &&
    d1.getDate() === d2.getDate() &&
    d1.getMonth() === d2.getMonth();
}

console.log(isSameDay(new Date('Jan 15 2021 02:39:53 GMT-0800'), new Date('Jan 15 2021 23:39:53 GMT-0800')));
console.log(isSameDay(new Date('Jan 15 2021 10:39:53 GMT-0800'), new Date('Jan 16 2021 10:39:53 GMT-0800')));
```

*注意您的时区*将返回年/月/日；如果您想检查两个日期是否在不同时区的同一天，我建议使用时区感知库。

例如

```
> (new Date('Jan 15 2021 01:39:53 Z')).getDate()  // Jan 15 in UTC
14  // Returns "14" because I'm in GMT-08 
```

* * *

## 回答 #8

> 赞同：39
> 
> 时间：2009-01-29T19:19:21.583

什么格式？

如果您构造一个 Javascript [Date 对象](https://developer.mozilla.org/en/Core_JavaScript_1.5_Reference/Global_Objects/Date)，您可以减去它们以获得毫秒差异（编辑：或只是比较它们）：

```
js>t1 = new Date()
Thu Jan 29 2009 14:19:28 GMT-0500 (Eastern Standard Time)
js>t2 = new Date()
Thu Jan 29 2009 14:19:31 GMT-0500 (Eastern Standard Time)
js>t2-t1
2672
js>t3 = new Date('2009 Jan 1')
Thu Jan 01 2009 00:00:00 GMT-0500 (Eastern Standard Time)
js>t1-t3
2470768442
js>t1>t3
true 
```

* * *

## 回答 #9

> 赞同：22
> 
> 时间：2019-06-28T06:47:49.670

简单的方法是，

```
var first = '2012-11-21';
var second = '2012-11-03';

if (new Date(first) > new Date(second) {
    .....
} 
```

* * *

## 回答 #10

> 赞同：21
> 
> 时间：2017-03-14T17:10:14.773

**注意 - 仅比较日期部分：**

当我们在javascript中比较两个日期时。它还需要考虑小时、分钟和秒。所以如果我们只需要比较日期，这就是方法：

```
var date1= new Date("01/01/2014").setHours(0,0,0,0);

var date2= new Date("01/01/2014").setHours(0,0,0,0); 
```

现在：`if date1.valueOf()> date2.valueOf()`将像魅力一样工作。

* * *

## 回答 #11

> 赞同：18
> 
> 时间：2013-08-02T21:06:16.267

**简短的回答**

这是一个返回 {boolean} 的函数，如果从 dateTime > 到 dateTime[演示正在运行](http://jsfiddle.net/NTghK/)

```
var from = '08/19/2013 00:00'
var to = '08/12/2013 00:00 '

function isFromBiggerThanTo(dtmfrom, dtmto){
   return new Date(dtmfrom).getTime() >=  new Date(dtmto).getTime() ;
}
console.log(isFromBiggerThanTo(from, to)); //true 
```

**解释**

[jsFiddle](http://jsfiddle.net/minagabriel/Fu7Ag/1/)

```
var date_one = '2013-07-29 01:50:00',
date_two = '2013-07-29 02:50:00';
//getTime() returns the number of milliseconds since 01.01.1970.
var timeStamp_date_one = new Date(date_one).getTime() ; //1375077000000 
console.log(typeof timeStamp_date_one);//number 
var timeStamp_date_two = new Date(date_two).getTime() ;//1375080600000 
console.log(typeof timeStamp_date_two);//number 
```

因为您现在同时拥有数字类型的日期时间，您可以将它们与任何比较操作进行比较

( >, < ,= ,!= ,== ,!== ,>= AND <=)

**然后**

如果您熟悉自定义日期和时间格式字符串，则无论您是传入日期时间字符串还是 unix 格式，`C#`此库都应该执行完全相同的操作并帮助您格式化日期和时间[dtmFRM](https://rawgithub.com/minagabriel/dtmFRM/master/dtmFRM.js)

**用法**

```
var myDateTime = new dtmFRM();

alert(myDateTime.ToString(1375077000000, "MM/dd/yyyy hh:mm:ss ampm"));
//07/29/2013 01:50:00 AM

alert(myDateTime.ToString(1375077000000,"the year is yyyy and the day is dddd"));
//this year is 2013 and the day is Monday

alert(myDateTime.ToString('1/21/2014', "this month is MMMM and the day is dd"));
//this month is january and the day is 21 
```

[演示](http://jsfiddle.net/minagabriel/8fPtd/2/)

您所要做的就是在库`js`文件中传递任何这些格式

* * *

## 回答 #12

> 赞同：17
> 
> 时间：2012-08-09T10:49:00.450

您使用此代码，

```
var firstValue = "2012-05-12".split('-');
var secondValue = "2014-07-12".split('-');

 var firstDate=new Date();
 firstDate.setFullYear(firstValue[0],(firstValue[1] - 1 ),firstValue[2]);

 var secondDate=new Date();
 secondDate.setFullYear(secondValue[0],(secondValue[1] - 1 ),secondValue[2]);     

  if (firstDate > secondDate)
  {
   alert("First Date  is greater than Second Date");
  }
 else
  {
    alert("Second Date  is greater than First Date");
  } 
```

并查看此链接 [http://www.w3schools.com/js/js_obj_date.asp](http://www.w3schools.com/js/js_obj_date.asp)

* * *

## 回答 #13

> 赞同：14
> 
> 时间：2009-07-20T03:36:57.953

```
function datesEqual(a, b)
{
   return (!(a>b || b>a))
} 
```

* * *

## 回答 #14

> 赞同：13
> 
> 时间：2009-01-29T19:17:51.680

```
var date = new Date(); // will give you todays date.

// following calls, will let you set new dates.
setDate()   
setFullYear()   
setHours()  
setMilliseconds()   
setMinutes()    
setMonth()  
setSeconds()    
setTime()

var yesterday = new Date();
yesterday.setDate(...date info here);

if(date>yesterday)  // will compare dates 
```

* * *

## 回答 #15

> 赞同：12
> 
> 时间：2016-07-05T05:53:00.543

**通过[Moment.js](https://momentjs.com/)**

jsfiddle：http: [//jsfiddle.net/guhokemk/1/](http://jsfiddle.net/guhokemk/1/)

```
function compare(dateTimeA, dateTimeB) {
    var momentA = moment(dateTimeA,"DD/MM/YYYY");
    var momentB = moment(dateTimeB,"DD/MM/YYYY");
    if (momentA > momentB) return 1;
    else if (momentA < momentB) return -1;
    else return 0;
}

alert(compare("11/07/2015", "10/07/2015")); 
```

`dateTimeA`如果大于，该方法返回 1`dateTimeB`

`dateTimeA`如果等于，该方法返回 0`dateTimeB`

`dateTimeA`如果小于，该方法返回 -1`dateTimeB`

* * *

## 回答 #16

> 赞同：12
> 
> 时间：2017-10-20T09:51:47.973

**当心时区**

javascript 日期*没有 timezone 的概念*。这是一个时间点（自纪元以来的滴答声），具有用于在“本地”时区中转换字符串和从字符串转换的便捷功能。如果您想使用日期对象处理日期，就像这里的每个人都在做的那样，**您希望您的日期代表相关日期开始时的 UTC 午夜。**这是一个常见且必要的约定，可让您使用日期，而不管其创建的季节或时区如何。因此，您需要非常警惕地管理时区的概念，尤其是在您创建午夜 UTC Date 对象时。

大多数时候，您会希望您的日期反映用户的时区。**如果今天是您的生日，请单击**。新西兰和美国的用户同时点击并获得不同的日期。在这种情况下，这样做...

```
// create a date (utc midnight) reflecting the value of myDate and the environment's timezone offset.
new Date(Date.UTC(myDate.getFullYear(),myDate.getMonth(), myDate.getDate())); 
```

有时，国际可比性胜过本地准确性。在这种情况下，这样做...

```
// the date in London of a moment in time. Device timezone is ignored.
new Date(Date.UTC(myDate.getUTCYear(), myDate.getyUTCMonth(), myDate.getUTCDate())); 
```

**现在您可以按照其他答案的建议直接比较您的日期对象。**

在创建时注意管理时区，当您转换回字符串表示时，您还需要确保将时区排除在外。**这样您就可以安全地使用...**

*   `toISOString()`
*   `getUTCxxx()`
*   `getTime() //returns a number with no time or timezone.`
*   `.toLocaleDateString("fr",{timezone:"UTC"}) // whatever locale you want, but ALWAYS UTC.`

**并完全避免其他一切，尤其是...**

*   `getYear()`, `getMonth()`,`getDate()`

* * *

## 回答 #17

> 赞同：11
> 
> 时间：2014-03-26T15:41:05.623

只是为许多现有选项添加另一种可能性，您可以尝试：

```
if (date1.valueOf()==date2.valueOf()) ..... 
```

...这似乎对我有用。当然，您必须确保两个日期都不是未定义的......

```
if ((date1?date1.valueOf():0)==(date2?date2.valueOf():0) ..... 
```

这样，如果两者都未定义，我们可以确保进行正比较，或者......

```
if ((date1?date1.valueOf():0)==(date2?date2.valueOf():-1) ..... 
```

...如果您希望它们不相等。

* * *

## 回答 #18

> 赞同：9
> 
> 时间：2012-11-15T09:54:18.180

减去两个日期得到毫秒的差异，如果你得到`0`它是相同的日期

```
function areSameDate(d1, d2){
    return d1 - d2 === 0
} 
```

* * *

## 回答 #19

> 赞同：8
> 
> 时间：2011-07-23T03:03:35.653

假设你得到了日期对象 A 和 B，得到它们的 EPOC 时间值，然后减去得到以毫秒为单位的差异。

```
var diff = +A - +B; 
```

就这样。

* * *

## 回答 #20

> 赞同：8
> 
> 时间：2012-06-23T14:08:15.677

如果以下是您的日期格式，则可以使用此代码：

```
var first = '2012-11-21';
var second = '2012-11-03';
if(parseInt(first.replace(/-/g,""),10) > parseInt(second.replace(/-/g,""),10)){
   //...
} 
```

它将检查`20121121`数字是否大于`20121103`或不大于。

* * *

## 回答 #21

> 赞同：8
> 
> 时间：2016-08-31T17:00:39.267

要比较两个日期，我们可以使用 date.js JavaScript 库，该库位于：[https ://code.google.com/archive/p/datejs/downloads](https://code.google.com/archive/p/datejs/downloads)

并使用该`Date.compare( Date date1, Date date2 )`方法并返回一个**数字**，表示以下结果：

-1 = date1 小于 date2。

0 = 值相等。

1 = date1 大于 date2。

* * *

## 回答 #22

> 赞同：7
> 
> 时间：2009-01-29T19:35:19.773

为了从 Javascript 中的自由文本创建日期，您需要将其解析为 Date() 对象。

您可以使用 Date.parse() 尝试将自由文本转换为新日期，但如果您可以控制页面，我建议您使用 HTML 选择框或日期选择器，例如[YUI 日历控件](http://developer.yahoo.com/yui/calendar/)或[jQuery UI日期选择器](http://docs.jquery.com/UI/Datepicker)。

一旦您有其他人指出的日期，您可以使用简单的算术减去日期并将其转换回天数，方法是将数字（以秒为单位）除以一天中的秒数（60 * 60 * 24 = 86400)。

* * *

## 回答 #23

> 赞同：7
> 
> 时间：2020-02-27T18:54:33.947

## 表现

今天 2020.02.27 我在 MacOs High Sierra v10.13.6 上的 Chrome v80.0、Safari v13.0.5 和 Firefox 73.0.1 上执行所选解决方案的测试

### 结论

*   解决方案`d1==d2`(D) 和`d1===d2`(E) 对于所有浏览器都是最快的
*   解决方案`getTime`(A) 比 `valueOf`(B) 快（两者都是中快）
*   解决方案 F,L,N 对于所有浏览器来说都是最慢的

[![在此处输入图像描述](https://i.stack.imgur.com/jedLE.png)](https://i.stack.imgur.com/jedLE.png)

### 细节

下面介绍了性能测试中使用的代码段解决方案。您可以在您的机器上进行测试[这里](https://jsbench.me/ofk73h7x6r/1)

```
function A(d1,d2) {
	return d1.getTime() == d2.getTime();
}

function B(d1,d2) {
	return d1.valueOf() == d2.valueOf();
}

function C(d1,d2) {
	return Number(d1)   == Number(d2);
}

function D(d1,d2) {
	return d1 == d2;
}

function E(d1,d2) {
	return d1 === d2;
}

function F(d1,d2) {
	return (!(d1>d2 || d2>d1));
}

function G(d1,d2) {
	return d1*1 == d2*1;
}

function H(d1,d2) {
	return +d1 == +d2;
}

function I(d1,d2) {
	return !(+d1 - +d2);
}

function J(d1,d2) {
	return !(d1 - d2);
}

function K(d1,d2) {
	return d1 - d2 == 0;
}

function L(d1,d2) {
	return !((d1>d2)-(d1<d2));
}

function M(d1,d2) {
  return d1.getFullYear() === d2.getFullYear()
    && d1.getDate() === d2.getDate()
    && d1.getMonth() === d2.getMonth();
}

function N(d1,d2) {
	return (isFinite(d1.valueOf()) && isFinite(d2.valueOf()) ? !((d1>d2)-(d1<d2)) : false );
}

// TEST

let past= new Date('2002-12-24'); // past
let now= new Date('2020-02-26');  // now

console.log('Code  d1>d2  d1<d2  d1=d2')
var log = (l,f) => console.log(`${l}     ${f(now,past)}  ${f(past,now)}  ${f(now,now)}`);

log('A',A);
log('B',B);
log('C',C);
log('D',D);
log('E',E);
log('G',G);
log('H',H);
log('I',I);
log('J',J);
log('K',K);
log('L',L);
log('M',M);
log('N',N);
```

```
p {color: red}
```

```
<p>This snippet only presents tested solutions (it not perform tests itself)</p>
```

铬的结果

[![在此处输入图像描述](https://i.stack.imgur.com/N0eSg.png)](https://i.stack.imgur.com/N0eSg.png)

* * *

## 回答 #24

> 赞同：6
> 
> 时间：2015-05-06T11:25:28.447

```
var date_today=new Date();
var formated_date = formatDate(date_today);//Calling formatDate Function

var input_date="2015/04/22 11:12 AM";

var currentDateTime = new Date(Date.parse(formated_date));
var inputDateTime   = new Date(Date.parse(input_date));

if (inputDateTime <= currentDateTime){
    //Do something...
}

function formatDate(date) {
    var hours = date.getHours();
    var minutes = date.getMinutes();
    var ampm = hours >= 12 ? 'PM' : 'AM';

    hours = hours % 12;
    hours = hours ? hours : 12; // the hour '0' should be '12'
    hours   = hours < 10 ? '0'+hours : hours ;

    minutes = minutes < 10 ? '0'+minutes : minutes;

    var strTime = hours+":"+minutes+ ' ' + ampm;
    return  date.getFullYear()+ "/" + ((date.getMonth()+1) < 10 ? "0"+(date.getMonth()+1) :
    (date.getMonth()+1) ) + "/" + (date.getDate() < 10 ? "0"+date.getDate() :
    date.getDate()) + " " + strTime;
} 
```

* * *

## 回答 #25

> 赞同：5
> 
> 时间：2011-08-20T04:02:04.713

“some”发布的代码的改进版本

```
/* Compare the current date against another date.
 *
 * @param b  {Date} the other date
 * @returns   -1 : if this < b
 *             0 : if this === b
 *             1 : if this > b
 *            NaN : if a or b is an illegal date
*/ 
Date.prototype.compare = function(b) {
  if (b.constructor !== Date) {
    throw "invalid_date";
  }

 return (isFinite(this.valueOf()) && isFinite(b.valueOf()) ? 
          (this>b)-(this<b) : NaN 
        );
}; 
```

用法：

```
 var a = new Date(2011, 1-1, 1);
  var b = new Date(2011, 1-1, 1);
  var c = new Date(2011, 1-1, 31);
  var d = new Date(2011, 1-1, 31);

  assertEquals( 0, a.compare(b));
  assertEquals( 0, b.compare(a));
  assertEquals(-1, a.compare(c));
  assertEquals( 1, c.compare(a)); 
```

* * *

## 回答 #26

> 赞同：5
> 
> 时间：2012-08-22T01:40:14.863

我通常存储`Dates`在`timestamps(Number)`数据库中。

当我需要比较时，我只是比较这些时间戳或

将其转换为日期对象，然后`> <`在必要时进行比较。

**请注意，== 或 === 不能正常工作，除非您的变量是同一日期对象的引用。**

**首先将这些 Date 对象转换为时间戳（数字），然后比较它们的相等性。**

* * *

## 日期到时间戳

```
var timestamp_1970 = new Date(0).getTime(); // 1970-01-01 00:00:00
var timestamp = new Date().getTime(); // Current Timestamp 
```

## 迄今为止的时间戳

```
var timestamp = 0; // 1970-01-01 00:00:00
var DateObject = new Date(timestamp); 
```

* * *

## 回答 #27

> 赞同：3
> 
> 时间：2013-10-24T17:34:25.213

在比较`Dates`对象之前，请尝试将它们的毫秒数都设置为零，例如`Date.setMilliseconds(0);`.

在某些情况下，`Date`对象是在 javascript 中动态创建的，如果您继续打印`Date.getTime()`，您会看到毫秒数发生变化，这将阻止两个日期相等。

* * *

## 回答 #28

> 赞同：2
> 
> 时间：2014-06-23T22:22:18.493

假设您处理这种`2014[:-/.]06[:-/.]06`或这种`06[:-/.]06[:-/.]2014`日期格式，那么您可以通过这种方式比较日期

```
var a = '2014.06/07', b = '2014-06.07', c = '07-06/2014', d = '07/06.2014';

parseInt(a.replace(/[:\s\/\.-]/g, '')) == parseInt(b.replace(/[:\s\/\.-]/g, '')); // true
parseInt(c.replace(/[:\s\/\.-]/g, '')) == parseInt(d.replace(/[:\s\/\.-]/g, '')); // true
parseInt(a.replace(/[:\s\/\.-]/g, '')) < parseInt(b.replace(/[:\s\/\.-]/g, '')); // false
parseInt(c.replace(/[:\s\/\.-]/g, '')) > parseInt(d.replace(/[:\s\/\.-]/g, '')); // false 
```

如您所见，我们去除分隔符，然后比较整数。

* * *

## 回答 #29

> 赞同：1
> 
> 时间：2012-07-10T10:20:12.907

```
 from_date ='10-07-2012';
        to_date = '05-05-2012';
        var fromdate = from_date.split('-');
        from_date = new Date();
        from_date.setFullYear(fromdate[2],fromdate[1]-1,fromdate[0]);
        var todate = to_date.split('-');
        to_date = new Date();
        to_date.setFullYear(todate[2],todate[1]-1,todate[0]);
        if (from_date > to_date ) 
        {
            alert("Invalid Date Range!\nStart Date cannot be after End Date!")

            return false;
        } 
```

使用此代码使用 javascript 比较日期。

谢谢 D.Jeeva

* * *

## 回答 #30

> 赞同：1
> 
> 时间：2013-02-12T10:31:13.633

```
var curDate=new Date();
var startDate=document.forms[0].m_strStartDate;

var endDate=document.forms[0].m_strEndDate;
var startDateVal=startDate.value.split('-');
var endDateVal=endDate.value.split('-');
var firstDate=new Date();
firstDate.setFullYear(startDateVal[2], (startDateVal[1] - 1), startDateVal[0]);

var secondDate=new Date();
secondDate.setFullYear(endDateVal[2], (endDateVal[1] - 1), endDateVal[0]);
if(firstDate > curDate) {
    alert("Start date cannot be greater than current date!");
    return false;
}
if (firstDate > secondDate) {
    alert("Start date cannot be greater!");
    return false;
} 
```

* * *

## 回答 #31

> 赞同：1
> 
> 时间：2013-09-20T15:37:31.070

这是我在我的一个项目中所做的，

```
function CompareDate(tform){
     var startDate = new Date(document.getElementById("START_DATE").value.substring(0,10));
     var endDate = new Date(document.getElementById("END_DATE").value.substring(0,10));

     if(tform.START_DATE.value!=""){
         var estStartDate = tform.START_DATE.value;
         //format for Oracle
         tform.START_DATE.value = estStartDate + " 00:00:00";
     }

     if(tform.END_DATE.value!=""){
         var estEndDate = tform.END_DATE.value;
         //format for Oracle
         tform.END_DATE.value = estEndDate + " 00:00:00";
     }

     if(endDate <= startDate){
         alert("End date cannot be smaller than or equal to Start date, please review you selection.");
         tform.START_DATE.value = document.getElementById("START_DATE").value.substring(0,10);
         tform.END_DATE.value = document.getElementById("END_DATE").value.substring(0,10);
         return false;
     }
} 
```

在表单提交时调用它。希望这可以帮助。

* * *

## 回答 #32

> 赞同：1
> 
> 时间：2016-04-08T13:45:34.807

嗨，这是我比较日期的代码。就我而言，我正在检查不允许选择过去的日期。

```
var myPickupDate = <pick up date> ;
var isPastPickupDateSelected = false;
var currentDate = new Date();

if(currentDate.getFullYear() <= myPickupDate.getFullYear()){
    if(currentDate.getMonth()+1 <= myPickupDate.getMonth()+1 || currentDate.getFullYear() < myPickupDate.getFullYear()){
                        if(currentDate.getDate() <= myPickupDate.getDate() || currentDate.getMonth()+1 < myPickupDate.getMonth()+1 || currentDate.getFullYear() < myPickupDate.getFullYear()){
                                            isPastPickupDateSelected = false;
                                            return;
                                        }
                    }
}
console.log("cannot select past pickup date");
isPastPickupDateSelected = true; 
```

* * *

## 回答 #33

> 赞同：1
> 
> 时间：2016-11-09T18:22:28.730

比较两个日期的另一种方法是通过[`toISOString()`](https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Global_Objects/Date/toISOString)方法。这在与保存在字符串中的固定日期进行比较时特别有用，因为您可以避免创建短暂的对象。凭借 ISO 8601 格式，您可以按字典顺序比较这些字符串（至少在您使用相同时区时）。

我不一定说它比使用时间对象或时间戳更好；只是提供这个作为另一种选择。这可能会失败，但我还没有偶然发现它们:)

* * *

## 回答 #34

> 赞同：1
> 
> 时间：2020-01-31T17:27:06.770

上面给出的所有答案只解决了一件事：比较两个日期。

确实，它们似乎是问题的答案，但缺少很大一部分：

**如果我想检查一个人是否已满 18 岁，该怎么办？**

**不幸的是，以上给出的答案都无法回答这个问题。**

例如，当前时间（大约是我开始输入这些单词的时间）是 Fri Jan 31 2020 10:41:04 GMT-0600（Central Standard Time），而客户输入他的出生日期为“01/31 /2002”。

如果我们使用**"365 days/year"**，也就是**"31536000000"**毫秒，我们会得到以下结果：

```
 let currentTime = new Date();
       let customerTime = new Date(2002, 1, 31);
       let age = (currentTime.getTime() - customerTime.getTime()) / 31536000000
       console.log("age: ", age); 
```

带有以下打印输出：

```
 age: 17.92724710838407 
```

但从**法律上讲**，该客户已经 18 岁。即使他输入“01/30/2002”，结果仍然是

```
 age: 17.930039743467784 
```

小于18。系统会报“under age”错误。

这将持续到“01/29/2002”、“01/28/2002”、“01/27/2002”……“01/05/2002”，**直到**“01/04/2002”。

**这样的系统只会杀死所有出生在 18 岁 0 天和 18 岁 26 天前的客户，因为他们在法律上是 18 岁，而系统显示“未满年龄”。**

**以下是对此类问题的回答：**

```
invalidBirthDate: 'Invalid date. YEAR cannot be before 1900.',
invalidAge: 'Invalid age. AGE cannot be less than 18.',

public static birthDateValidator(control: any): any {
    const val = control.value;
    if (val != null) {
        const slashSplit = val.split('-');
        if (slashSplit.length === 3) {
            const customerYear = parseInt(slashSplit[0], 10);
            const customerMonth = parseInt(slashSplit[1], 10);
            const customerDate = parseInt(slashSplit[2], 10);
            if (customerYear < 1900) {
                return { invalidBirthDate: true };
            } else {
                const currentTime = new Date();
                const currentYear = currentTime.getFullYear();
                const currentMonth = currentTime.getMonth() + 1;
                const currentDate = currentTime.getDate();
                if (currentYear - customerYear < 18) {
                    return { invalidAge: true };
                } else if (
                    currentYear - customerYear === 18 &&
                    currentMonth - customerMonth < 0) {
                    return { invalidAge: true };
                } else if (
                    currentYear - customerYear === 18 &&
                    currentMonth - customerMonth === 0 &&
                    currentDate - customerDate < 0) {
                    return { invalidAge: true };
                } else {
                    return null;
                }
            }
        }
    }
} 
```

* * *

## 回答 #35

> 赞同：0
> 
> 时间：2017-09-20T11:11:40.503

您可以以最简单易懂的方式进行日期比较。

```
<input type="date" id="getdate1" />
<input type="date" id="getdate2" /> 
```

假设您有两个要比较它们的日期输入。

所以先写一个常用的方法来解析日期。

```
 <script type="text/javascript">
            function parseDate(input) {
             var datecomp= input.split('.'); //if date format 21.09.2017

              var tparts=timecomp.split(':');//if time also giving
              return new Date(dparts[2], dparts[1]-1, dparts[0], tparts[0], tparts[1]);
// here new date(  year, month, date,)
            }
        </script> 
```

parseDate() 是用于解析日期的常用方法。现在您可以检查您的日期 =、>、< 任何类型的比较

```
 <script type="text/javascript">

              $(document).ready(function(){
              //parseDate(pass in this method date);
                    Var Date1=parseDate($("#getdate1").val());
                        Var Date2=parseDate($("#getdate2").val());
               //use any oe < or > or = as per ur requirment 
               if(Date1 = Date2){
         return false;  //or your code {}
}
 });
    </script> 
```

当然，这段代码会帮助你。

* * *

## 回答 #36

> 赞同：0
> 
> 时间：2021-10-28T15:55:29.927

我对这个问题的简单回答

```
checkDisabled(date) {
    const today = new Date()
    const newDate = new Date(date._d)
    if (today.getTime() > newDate.getTime()) {
        return true
    }
    return false
} 
```

* * *

## 回答 #37

> 赞同：-1
> 
> 时间：2017-06-15T12:42:21.430

试试这个，而比较日期应该是 iso 格式“yyyy-MM-dd”如果你只想比较日期使用这个 datehelper

```
<a href="https://plnkr.co/edit/9N8ZcC?p=preview"> Live Demo</a> 
```

* * *

## 回答 #38

> 赞同：-1
> 
> 时间：2021-03-16T07:17:30.680

## 使用 momentjs 进行日期操作。

**通过使用检查一个日期与另一个日期相同或之后**

`isSameOrAfter()` **方法**

```
moment('2010-10-20').isSameOrAfter('2010-10-20') //true; 
```

**使用** `isAfter()` **方法检查一个日期之后是另一个日期**

```
moment('2020-01-20').isAfter('2020-01-21'); // false
moment('2020-01-20').isAfter('2020-01-19'); // true 
```

**使用** `isBefore()` **方法检查一个日期在另一个之前。**

```
moment('2020-01-20').isBefore('2020-01-21'); // true
moment('2020-01-20').isBefore('2020-01-19'); // false 
```

**使用** `isSame()` **方法检查一个日期与另一个日期相同**

```
moment('2020-01-20').isSame('2020-01-21'); // false
moment('2020-01-20').isSame('2020-01-20'); // true 
```

* * *

## 回答 #39

> 赞同：-1
> 
> 时间：2021-07-28T13:17:20.160

```
function compare_date(date1, date2){
const x = new Date(date1)
const y = new Date(date2)
function checkyear(x, y){
    if(x.getFullYear()>y.getFullYear()){
        return "Date1 > Date2"
    }
    else if(x.getFullYear()<y.getFullYear()){
        return "Date2 > Date1"
    }
    else{
        return checkmonth(x, y)
    }
}
function checkmonth(x, y){
    if(x.getMonth()>y.getFullYear()){
        return "Date1 > Date2"
    }
    else if(x.getMonth()<y.getMonth){
        return "Date2 > Date1"
    }
    else {
        return checkDate(x, y)
    }
}
function checkDate(x, y){
    if(x.getDate()>y.getFullYear()){
        return "Date1 > Date2"
    }
    else if(x.getDate()<y.getDate()){
        return "Date2 > Date1"
    }
    else {
        return checkhour(x,y)
    }
}
function checkhour(x, y){
    if(x.getHours()>y.getHours()){
        return "Date1 > Date2"
    }
    else if(x.getHours()<y.getHours()){
        return "Date2 > Date1"
    }
    else {
        return checkhmin(x,y)
    }
}
function checkhmin(x,y){
    if(x.getMinutes()>y.getMinutes()){
        return "Date1 > Date2"
    }
    else if(x.getMinutes()<y.getMinutes()){
        return "Date2 > Date1"
    }
    else {
        return "Date1 = Date2"
    }
}
return checkyear(x, y) 
```

* * *

## 回答 #40

> 赞同：-2
> 
> 时间：2014-01-30T04:42:01.510

尝试使用此代码

```
var f =date1.split("/");

var t =date2.split("/");

var x =parseInt(f[2]+f[1]+f[0]);

var y =parseInt(t[2]+t[1]+t[0]);

if(x > y){
    alert("date1 is after date2");
}

else if(x < y){
    alert("date1 is before date2");
}

else{
    alert("both date are same");
} 
```

* * *

## 回答 #41

> 赞同：-2
> 
> 时间：2020-12-29T21:05:58.233

```
If you are using **REACT OR REACT NATIVE**, use this and it will work (Working like charm) 
```

如果两个日期相同，则返回 TRUE，否则返回 FALSE

```
const compareDate = (dateVal1, dateVal2) => {
        if (dateVal1.valueOf() === dateVal2.valueOf()){
            return true;
        }
        else { return false;}
    } 
```

* * *

## 回答 #42

> 赞同：-8
> 
> 时间：2011-04-16T11:30:40.763

日期比较：

```
var str1  = document.getElementById("Fromdate").value;
var str2  = document.getElementById("Todate").value;
var dt1   = parseInt(str1.substring(0,2),10); 
var mon1  = parseInt(str1.substring(3,5),10);
var yr1   = parseInt(str1.substring(6,10),10); 
var dt2   = parseInt(str2.substring(0,2),10); 
var mon2  = parseInt(str2.substring(3,5),10); 
var yr2   = parseInt(str2.substring(6,10),10); 
var date1 = new Date(yr1, mon1, dt1); 
var date2 = new Date(yr2, mon2, dt2); 

if(date2 < date1)
{
   alert("To date cannot be greater than from date");
   return false; 
} 
else 
{ 
   alert("Submitting ...");
   document.form1.submit(); 
} 
```**