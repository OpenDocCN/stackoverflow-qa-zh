# StackOverflow 问答 000127000-000127999

# java - 什么是好的 Java 压缩库？

> ID：127001
> 
> 赞同：5
> 
> 时间：2008-09-24T13:05:39.400
> 
> 标签：java, compression

我需要压缩我们应用程序的部分网络流量以提高性能。我认为这意味着我需要远离一些较新的算法，例如 bzip2，我认为我听说过的算法速度较慢。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-09-24T13:07:50.440

您可以使用JDK 中内置的[Deflater](https://docs.oracle.com/javase/8/docs/api/java/util/zip/Deflater.html) / [Inflater 。](http://docs.oracle.com/javase/7/docs/api/java/util/zip/Inflater.html)也有 GZIPInputStream 和 GZIPOutputStream ，但是这真的取决于你的确切用途。

编辑：

阅读进一步的评论，看起来网络流量是 HTTP。根据服务器的不同，它可能支持压缩（尤其是 deflate/gzip）。然后问题就出现在客户端上。如果客户端是浏览器，它可能已经支持它。如果您的客户端是 Web 服务客户端或[http 客户端](http://hc.apache.org/httpclient-3.x/)，请检查该软件包的文档以查看它是否受支持。

看起来 jakarta-commons httpclient 可能需要您手动进行压缩。要在客户端启用此功能，您需要执行类似的操作

```
.addRequestHeader("Accept-Encoding","gzip,deflate"); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-24T13:12:00.523

如果网络流量通过 HTTP，大多数各种 Web 服务器/servlet 容器都支持协商压缩，例如 Apache 的 mod_deflate。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-08-20T05:23:04.087

您的压缩算法取决于您尝试优化的内容以及可用的带宽。

如果您在千兆 LAN 上，几乎任何压缩算法都会使您的程序变慢一点。如果您通过 WAN 或 Internet 进行连接，则可以进行更多压缩。如果您连接到拨号，您应该尽可能地压缩。

如果这是一个 WAN，您可能会发现[Riverbed 之](http://www.riverbed.com)类的硬件解决方案更有效，因为它们适用于各种流量，并且不需要对软件进行任何更改。

我有一个测试用例，它显示了[Deflate、Filtered、BZip2 和 lzma](http://www.theeggeadventure.com/wikimedia/index.php/Java_Data_Compression)之间的相对压缩差异。只需插入数据样本，然后测试两台机器之间的时间。

# vba - VBA PowerPoint 在线指南和如何录制宏

> ID：127006
> 
> 赞同：4
> 
> 时间：2008-09-24T13:07:07.383
> 
> 标签：vba, powerpoint

任何人都可以向我推荐一个很好的 PowerPoint VBA 在线指南吗？另外，有人对如何在 PowerPoint 中录制宏有建议吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2011-09-01T00:56:29.540

Microsoft 从 PowerPoint 2007 中删除了宏记录器。

要查看对象的结构，请在对象中使用 Watch (Shift +F9)。

例如

```
dim ppt as powerpoint.Presentation

set ppt =activepresentation 
```

添加watch到ppt查看对象Presentation的struct

否则

添加一个新的类模块

在类中声明

```
Private WithEvents ppt As PowerPoint.Application 
```

在通用模块中，使用 classCreate（默认为 Class1）声明一个实例

```
set x= new class1 
```

现在在模块类中，您可以获取演示文稿的事件（在代码窗口的左侧组合中）

布鲁诺·莱特

[办公开发人员](http://officevb.com)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-24T13:28:59.487

录制 PowerPoint 宏：

1.  在菜单栏中，单击工具
2.  将鼠标悬停在 Macro > 上，将显示子菜单
3.  单击“记录”按钮 - 将显示一个新工具栏
4.  做你的事
5.  单击新宏工具栏上的停止按钮

点击工具->宏->宏。找到您刚刚录制的宏，然后单击“编辑”按钮。这将向您显示记录的内容。进行修改并单击三角形运行按钮（或按 F5）运行您的代码。

就在线指南而言，我通常会想到一个问题并使用[Google](http://www.google.com/)或在 StackOverflow.com 上提问。我已经能够以这种方式回答我的大部分问题，我还没有找到适用于所有 Powerpoint VBA 的特定主要资源。

此外，您可以通过查看其他 MS Office 产品的 VBA 文章找到可以帮助您的答案 - 很多不是 Powerpoint 特定（通用 VBA）的内容与其他产品相同。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-24T13:17:50.010

你能描述一下你希望完成的事情吗？市面上有数十种适用于 Word、Excel 等的 VBA 书籍，但 PowerPoint 中的“编程”并不常见。

以下是针对新手的简短在线“常见问题解答”：

[http://skp.mvps.org/index.html#newbie](http://skp.mvps.org/index.html#newbie)

和一般方法：

[http://www.pptfaq.com/FAQ00033.htm](http://www.pptfaq.com/FAQ00033.htm)

# c++ - 返回“任何类型的输入迭代器”而不是 vector::iterator 或 list::iterator

> ID：127009
> 
> 赞同：2
> 
> 时间：2008-09-24T13:07:35.027
> 
> 标签：c++, stl, iterator

假设我想在 C++ 中实现一个数据结构来存储有向图。由于 STL 容器，弧将存储在节点中。我希望用户能够以类似 STL 的方式迭代节点的弧。

我遇到的问题是我不想在 Node 类（实际上是一个抽象基类）中公开我将在具体类中实际使用的 STL 容器。因此，我不想让我的方法返回 std::list::iterator 或 std::vector::iterator ...

我试过这个：

```
class Arc;

typedef std::iterator<std::random_access_iterator_tag, Arc*> ArcIterator;  // Wrong!

class Node {
public:
  ArcIterator incomingArcsBegin() const {
    return _incomingArcs.begin();
  }
private:
  std::vector<Arc*> _incomingArcs;
}; 
```

但这是不正确的，因为 vector::const_iterator 不能用于创建 ArcIterator。那么这个 ArcIterator 是什么？

我找到了这篇关于[STL 的自定义迭代器的](http://www.oonumerics.org/tmpw00/becker.html)论文，但它没有帮助。我今天一定有点重... ;)

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-24T13:46:59.800

尝试这个：

```
class Arc;
class Node {
private:
  std::vector<Arc*> incoming_;
public:
  typedef std::vector<Arc*>::iterator iterator;
  iterator incoming_arcs_begin()
  { return incoming_.begin(); }
}; 
```

并在其余代码中使用 Node::iterator。当/如果您更改容器时，您必须在一个地方更改 typedef。（您可以更进一步，使用额外的 typedef 进行存储，在本例中为向量。）

至于 const 问题，要么将 vector 的 const_iterator 定义为您的迭代器，要么像 vector 一样定义双迭代器类型（const 和非 const 版本）。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-24T16:51:07.220

Have a look at Adobe's [`any_iterator`](http://stlab.adobe.com/classadobe_1_1any__iterator.html): this class uses a technique called *type erase* by which the underyling iterator type is hidden behind an abstract interface. Beware: the use of `any_iterator` incurs a runtime penalty due to virtual dispatching.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-24T14:06:56.243

要隐藏您的迭代器基于您的事实，`std::vector<Arc*>::iterator`您需要一个委托给`std::vector<Arc*>::iterator`. `std::iterator`不这样做。

如果您查看编译器的 C++ 标准库中的头文件，您可能会发现它`std::iterator`本身并不是很有用，除非您只需要一个为 、 等定义 typedef 的`iterator_category`类`value_type`。

正如 Doug T. 在他的回答中提到的，boost 库有一些类可以更容易地编写迭代器。特别是，[`boost::indirect_iterator`](http://www.boost.org/doc/libs/1_36_0/libs/iterator/doc/indirect_iterator.html)如果您希望迭代器`Arc`在取消引用时返回 an 而不是`Arc*`.

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-24T13:41:51.247

我想认为应该有一种方法可以通过直接的 STL 来做到这一点，类似于你正在尝试做的事情。

如果没有，您可能需要考虑使用[boost 的迭代器外观和适配器](http://www.boost.org/doc/libs/1_35_0/libs/fusion/doc/html/fusion/extension/iterator_facade.html)，您可以在其中定义自己的迭代器或将其他对象调整为迭代器。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-08-05T03:49:03.837

考虑使用[访问者模式](http://en.wikipedia.org/wiki/Visitor_pattern)并反转关系：不是向图结构询问数据容器，而是给图一个函子，让图将该函子应用于其数据。

访问者模式是图上常用的模式，请查看 boost 的访问者概念图库文档。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-25T18:51:33.773

好吧，因为`std::vector`保证有连续的存储，所以这样做应该是完美的：

```
class Arc;
typedef Arc* ArcIterator;

class Node {
public:
    ArcIterator incomingArcsBegin() const {
        return &_incomingArcs[0]
    }

    ArcIterator incomingArcsEnd() const {
        return &_incomingArcs[_incomingArcs.size()]
    }
private:
    std::vector<Arc*> _incomingArcs;
}; 
```

基本上，指针的功能足以像随机访问迭代器一样，它们是足够的替代品。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-24T13:55:29.563

我查看了头文件 VECTOR.

```
vector<Arc*>::const_iterator 
```

是一个 typedef

```
allocator<Arc*>::const_pointer 
```

那可能是你的 ArcIterator 吗？喜欢：

```
typedef allocator<Arc*>::const_pointer ArcIterator; 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-24T14:44:12.860

C++0x 将允许您通过[自动类型确定来](http://en.wikipedia.org/wiki/C%2B%2B0x#Type_determination)执行此操作。

在新标准中，这
`for (vector::const_iterator itr = myvec.begin(); itr != myvec.end(); ++itr`
可以替换为
`for (auto itr = myvec.begin(); itr != myvec.end(); ++itr)`

出于同样的原因，您将能够返回任何合适的迭代器，并将其存储在一个`auto`变量中。

在新标准生效之前，您必须对类进行模板化，或者提供一个抽象接口来访问列表/向量的元素。例如，您可以通过在成员变量中存储迭代器并提供成员函数（如`begin()`和）来做到这一点`next()`。当然，这意味着一次只有一个循环可以安全地迭代您的元素。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-24T14:18:00.880

您可以模板化 Node 类，并在其中 typedef iterator 和 const_iterator 。

例如：

```
class Arc {};

template<
  template<class T, class U> class Container = std::vector,
  class Allocator = std::allocator<Arc*>
>
class Node
{
  public:
    typedef typename Container<Arc*, Allocator>::iterator ArcIterator;
    typedef typename Container<Arc*, Allocator>::Const_iterator constArcIterator;

    constArcIterator incomingArcsBegin() const {
      return _incomingArcs.begin();
    }

    ArcIterator incomingArcsBegin() {
      return _incomingArcs.begin();
    }
  private:
    Container<Arc*, Allocator> _incomingArcs;
}; 
```

我没有尝试过这段代码，但它给了你想法。但是，您必须注意，使用 ConstArcIterator 只会禁止修改指向 Arc 的指针，而不是修改 Arc 本身（例如通过非常量方法）。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-24T13:37:55.907

如果您真的不希望该类的客户端知道它在下面使用了一个向量，但仍希望他们能够以某种方式对其进行迭代，那么您很可能需要创建一个将其所有方法转发到 std 的类::向量::迭代器。

另一种方法是根据它应该在下面使用的容器类型对 Node 进行模板化。然后客户具体知道它使用的是什么类型的容器，因为他们告诉他们使用它。

就我个人而言，我认为将向量封装在远离用户的地方通常是没有意义的，但仍提供其大部分（甚至部分）接口。它的封装层太薄，无法真正提供任何好处。

# c - 如何检查我的字节标志，验证特定位是 1 还是 0？

> ID：127027
> 
> 赞同：25
> 
> 时间：2008-09-24T13:11:06.813
> 
> 标签：c, math, binary, bit-manipulation

我使用一个字节来存储一些标志，例如`10101010`，我想知道如何验证特定位是否位于`1`or `0`。

* * *

## 回答 #1

> 赞同：52
> 
> 时间：2008-09-24T13:16:29.360

这是一个可用于测试任何所需位的函数：

```
bool is_bit_set(unsigned value, unsigned bitindex)
{
    return (value & (1 << bitindex)) != 0;
} 
```

一点解释：

左移运算符 (<<) 用于创建位掩码。(1 << 0) 将等于 00000001，(1 << 1) 将等于 00000010，(1 << 3) 将等于 00001000，依此类推。因此，0 的移位测试最右边的位。移位 31 将是 32 位值的最左边位。

按位与运算符 (&) 给出了一个结果，其中设置了两边都是 1 的所有位。示例：1111 & 0001 = 0001；1111 & 0010 == 0010; 0000 & 0001 = 0000。因此，表达式 (value & (1 << bitindex)) 如果关联位的值是 1，则返回位掩码，如果关联位为 0，则返回 0。

最后，我们只检查结果是否为非零。（这实际上可以省略，但我想明确表示。）

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-09-24T13:18:00.777

作为[Patrick Desjardins 回答](https://stackoverflow.com/questions/127027/how-can-i-check-my-byte-flag-verifying-that-a-specific-bit-is-at-1-or-0/127033#127033)的延伸：

在进行位操作时，对[位运算符](http://en.wikipedia.org/wiki/Bitwise_operation)有非常扎实的知识**真的**很有帮助。

C中的按位“AND”运算符也是`&`，所以你想这样做：

```
unsigned char a = 0xAA; // 10101010 in hex
unsigned char b = (1 << bitpos); // Where bitpos is the position you want to check

if(a & b) {
    //bit set
}

else {
    //not set
} 
```

上面我使用了按位“AND”（C 中的 &）来检查是否设置了特定位。我还使用了两种不同的方式来表示二进制数。我强烈建议您查看上面的维基百科链接。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-24T13:11:45.127

您可以使用 AND 运算符。你有的例子：10101010，你想检查你可以做的第三位：(10101010 AND 00100000)，如果你得到 00100000，你知道你在第三个位置有标志为 1。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-09-24T14:37:54.780

[如果您喜欢像这样处理单个领域， Kristopher Johnson 的回答](https://stackoverflow.com/questions/127027/how-can-i-check-my-byte-flag-verifying-that-a-specific-bit-is-at-1-or-0/127062#127062)非常好。我更喜欢通过在 C 中使用位字段来使代码更易于阅读。

例如：

```
struct fieldsample
{
  unsigned short field1 : 1;
  unsigned short field2 : 1;
  unsigned short field3 : 1;
  unsigned short field4 : 1;
} 
```

这里有一个简单的结构，它有四个字段，每个字段大小为 1 位。然后，您可以使用简单的结构访问来编写代码。

```
void codesample()
{
  //Declare the struct on the stack.
  fieldsample fields;
  //Initialize values.
  fields.f1 = 1;
  fields.f2 = 0;
  fields.f3 = 0;
  fields.f4 = 1;
  ...
  //Check the value of a field.
  if(fields.f1 == 1) {}
  ...
} 
```

您可以获得相同的小尺寸优势，以及可读的代码，因为您可以在结构中为字段提供有意义的名称。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-24T14:25:07.667

如果您使用 C++ 并且允许使用标准库，我建议将您的标志存储在 bitset 中：

```
#include <bitset>
//...
std::bitset<8> flags(someVariable); 
```

然后您可以使用 [] 索引运算符检查和设置标志。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-24T13:20:02.783

到目前为止，没有人出错，但要提供一种检查任意位的方法：

```
int checkBit( byte in, int bit )
{
  return in & ( 1 << bit );
} 
```

如果函数返回非零，则设置该位。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-24T13:14:28.473

```
byte THIRDBIT = 4; // 4 = 00000100 i.e third bit is set

int isThirdBitSet(byte in) {
 return in & THIRDBIT; // Returns 1 if the third bit is set, 0 otherwise
} 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-24T13:14:46.010

您可以按照[Patrick Desjardins 的说法](https://stackoverflow.com/questions/127027/how-can-i-check-my-byte-flag-verifying-that-a-specific-bit-is-at-1-or-0/127033#127033)进行操作，并对前一个 AND 操作的结果进行逐位或运算。

在这种情况下，您将得到 1 或 0 的最终结果。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-24T13:19:11.210

传统上，要检查是否设置了最低位，这将类似于：

```
int MY_FLAG = 0x0001;
if ((value & MY_FLAG) == MY_FLAG)
    doSomething(); 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-24T13:18:15.143

使用按位（非逻辑！）AND 将值与位掩码进行比较。

```
if (var & 0x08) {
  /* The fourth bit is set */
} 
```

# windows - 比较冷启动和热启动

> ID：127029
> 
> 赞同：13
> 
> 时间：2008-09-24T13:11:34.050
> 
> 标签：windows, performance, reboot

与已经打开一次（热启动）相比，我们的应用程序在重新启动（冷启动）后启动所需的时间要长得多。

大多数（如果不是全部）差异似乎来自加载 DLL，当 DLL 位于缓存的内存页面中时，它们的加载速度要快得多。我们尝试使用[ClearMem](http://mypchell.com/content/view/40/1/)来模拟重新启动（因为它比实际重新启动花费的时间要少得多）并且得到了好坏参半的结果，在某些机器上它似乎非常一致地模拟了重新启动，而在某些机器上则不是。

总结一下我的问题是：

1.  您是否经历过冷启动和热启动之间的启动时间差异？
2.  你是如何处理这些差异的？
3.  你知道一种可靠地模拟重启的方法吗？

**编辑：**

澄清评论：

*   该应用程序主要是带有一些 .NET 的本机 C++（加载的第一个 .NET 程序集为 CLR 付费）。
*   我们正在寻求改善加载时间，显然我们做了我们的分析并改进了代码中的热点。

我忘了提到的是，我们通过重新构建所有二进制文件得到了一些改进，因此加载程序不必在加载时执行此操作。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-24T13:12:47.700

至于模拟重启，您是否考虑过从[虚拟 PC](http://en.wikipedia.org/wiki/Virtual_machine)运行您的应用程序？使用虚拟化，您可以方便地一遍又一遍地复制一组条件。

我还会考虑使用某种类型的[分析应用程序](http://en.wikipedia.org/wiki/Code_profiler)来发现导致时间延迟的代码位，然后判断该代码中有多少是真正需要的，或者是否可以以不同的方式实现。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-24T13:15:06.850

很难在软件中真正模拟重启。当您重新启动时，您机器中的所有设备的重置位都会被置位，这应该会导致系统范围内的所有内存丢失。

在现代机器中，内存和缓存无处不在：VM 子系统为程序存储内存页面，然后操作系统在内存中缓存文件的内容，然后您就可以-硬盘驱动器本身扇区的磁盘缓冲区。您可能可以重置操作系统缓存，但是驱动器上的磁盘缓冲区？我不知道有什么办法。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-24T18:53:32.123

你是如何分析你的代码的？并非所有分析方法都是平等的，有些方法比其他方法更好地发现热点。您是否正在加载大量文件？如果是这样，磁盘碎片和寻道时间可能会起作用。

甚至可能将基本的时间信息粘贴到代码中，写入日志文件并在冷/热启动时检查文件将有助于确定应用程序*在哪里*花费时间。

如果没有更多信息，我会倾向于文件系统/磁盘缓存作为这两种环境之间的可能差异。如果是这种情况，那么您要么需要花更少的时间预先加载文件，要么找到更快的方法来加载文件。

示例：如果您要加载大量二进制数据文件，则通过将它们组合成一个文件来加快加载速度，然后一次读取整个文件到内存中并解析它们的内容。更少的磁盘寻道和读取磁盘的时间。同样，也许这不适用。

我不知道任何清除磁盘/文件系统缓存的工具，但是您可以编写一个快速应用程序来从磁盘读取一堆不相关的文件，从而导致文件系统/磁盘缓存加载不同的信息。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-25T07:27:45.460

@Morten [Christiansen](https://stackoverflow.com/questions/127029/comparing-cold-start-to-warm-start#127355)说：

> 例如，Adobe reader 使用了一种使应用程序更快地启动冷启动（有点）的方法，通过在启动时加载一些文件，从而对用户隐藏冷启动。这仅在程序不应该立即启动时才可用。

这使得客户在每次启动时为初始化我们的应用程序付费，即使它没有被使用，我真的不喜欢这个选项（[Raymond](http://blogs.msdn.com/oldnewthing/archive/2005/03/11/394249.aspx)也不喜欢）。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-25T10:53:04.140

加速应用程序启动的一种成功方法是将 DLL 切换为延迟加载。这是一个低成本的改变（一些对项目设置的摆弄），但可以使启动速度显着加快。然后，在分析模式下运行depends.exe，以确定在启动期间加载了哪些DLL，并恢复它们的延迟加载。请记住，您还可以延迟加载所需的大多数 Windows DLL。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-12-18T20:11:56.980

改善应用程序冷启动时间的一个非常有效的技术是优化函数链接排序。

Visual Studio 链接器允许您传入一个文件，其中列出了正在链接的模块中的所有函数（或只是其中的一些 - 不必是所有函数），并且链接器会将这些函数彼此相邻放置记忆。

当您的应用程序启动时，通常会在整个应用程序中调用 init 函数。其中许多调用将针对尚未在内存中的页面，从而导致页面错误和磁盘寻道。这就是慢启动的来源。

优化您的应用程序以使所有这些功能结合在一起可能是一个巨大的胜利。

查看 Visual Studio 2005 或更高版本中的配置文件引导优化。PGO 为您做的一件事是函数链接排序。

在构建过程中工作有点困难，因为使用 PGO，您需要链接、运行您的应用程序，然后与配置文件运行的输出重新链接。这意味着您的构建过程需要有一个运行时环境并在错误构建之后进行清理等等，但回报通常是 10+ 或更多更快的冷启动，无需更改代码。

这里有更多关于 PGO 的信息：

[http://msdn.microsoft.com/en-us/library/e7k32f4k.aspx](http://msdn.microsoft.com/en-us/library/e7k32f4k.aspx)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-03-17T11:38:57.920

作为函数顺序列表的替代方法，只需对将在相同部分中调用的代码进行分组：

```
#pragma code_seg(".startUp")
 //...
#pragma code_seg

#pragma data_seg(".startUp")
 //...
#pragma data_seg 
```

随着代码的更改，它应该易于维护，但与函数顺序列表具有相同的好处。

我不确定函数顺序列表是否也可以指定全局变量，但使用这个#pragma data_seg 就可以了。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-24T14:08:35.613

例如，Adobe reader 使用了一种使应用程序更快地启动冷启动（有点）的方法，通过在启动时加载一些文件，从而对用户隐藏冷启动。这仅在程序不应该立即启动时才可用。

另一个注意事项是，.NET 3.5SP1 据说已经大大提高了冷启动速度，但我不能说多少。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-24T18:56:29.760

它可能是 NIC（LAN 卡），并且您的应用程序依赖于需要网络启动的某些其他服务。因此，单独分析您的应用程序可能无法完全告诉您这一点，但您应该检查应用程序的依赖关系。

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2009-03-18T11:25:34.877

如果您的应用程序不是很复杂，您可以将所有可执行文件复制到另一个目录，它应该类似于重新启动。（剪切和粘贴似乎不起作用，Windows 足够聪明，可以知道移动到另一个文件夹的文件缓存在内存中）

# javascript - 为什么使用 SOAP 与前端（即 Web 浏览器）进行通信不是一个好主意？

> ID：127038
> 
> 赞同：24
> 
> 时间：2008-09-24T13:12:47.310
> 
> 标签：javascript, soap

为什么使用 SOAP 与前端通信不是一个好主意？例如，使用 JavaScript 的 Web 浏览器。

* * *

## 回答 #1

> 赞同：42
> 
> 时间：2008-09-24T13:14:33.123

*   因为肿了
*   因为 JavaScript 本身就可以理解 JSON
*   因为用 JavaScript 操作 XML 并不快。

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2008-09-24T13:13:58.117

因为 SOAP 在寻求协议独立性的过程中重新发明了很多 HTTP 轮子。如果您*知道*无论如何都要通过 HTTP 提供响应（因为您的客户端是 Web 浏览器），那又有什么意义呢？

更新：我第二个小发明（暗示）对 JSON 的建议。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-09-24T13:47:54.510

如果 Web 浏览器是您唯一的客户端，那么我不得不同意 SOAP 是矫枉过正。

但是，如果您要在不同平台上运行多种类型的前端客户端，那么 SOAP 可能是合适的。SOAP 的好处在于，有很多工具可以生成代码，供您处理基于 WSDL 文件的 SOAP 发送、接收和解析。

例如，如果您想开发一个 C++ 前端客户端，那么您只需要 WSDL 文件，Microsoft 的工具将生成所有 C++ 代码，以基于数据结构生成 SOAP 请求、发送请求、接收响应以及将响应解析为返回数据结构。

在客户端和服务器端都有工具可以做到这一点。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-24T13:15:08.567

可以做到的。请记住，SOAP 并不是交换信息的最快方式，因为开销很大（必须来回发送大 XML）——这可能是您不经常看到它使用的原因

# javascript - 使用 FireFox、Safari 和 Chrome 在剪贴板上复制/放置文本

> ID：127040
> 
> 赞同：114
> 
> 时间：2008-09-24T13:12:57.510
> 
> 标签：javascript, dom, clipboard

在 Internet Explorer 中，我可以使用 clipboardData 对象来访问剪贴板。如何在 FireFox、Safari 和/或 Chrome 中做到这一点？

* * *

## 回答 #1

> 赞同：50
> 
> 时间：2008-09-24T13:17:23.460

出于安全原因，Firefox 不允许您在剪贴板上放置文本。但是，有一个使用 Flash 的解决方法。

```
function copyIntoClipboard(text) {

    var flashId = 'flashId-HKxmj5';

    /* Replace this with your clipboard.swf location */
    var clipboardSWF = 'http://appengine.bravo9.com/copy-into-clipboard/clipboard.swf';

    if(!document.getElementById(flashId)) {
        var div = document.createElement('div');
        div.id = flashId;
        document.body.appendChild(div);
    }
    document.getElementById(flashId).innerHTML = '';
    var content = '<embed src="' +
        clipboardSWF +
        '" FlashVars="clipboard=' + encodeURIComponent(text) +
        '" width="0" height="0" type="application/x-shockwave-flash"></embed>';
    document.getElementById(flashId).innerHTML = content;
} 
```

唯一的缺点是这需要启用 Flash。

来源目前已死：[http](http://bravo9.com/journal/copying-text-into-the-clipboard-with-javascript-in-firefox-safari-ie-opera-292559a2-cc6c-4ebf-9724-d23e8bc5ad8a/) ://bravo9.com/journal/copying-text-into-the-clipboard-with-javascript-in-firefox-safari-ie-opera-292559a2-cc6c-4ebf-9724-d23e8bc5ad8a/ （它的[Google 缓存](http://webcache.googleusercontent.com/search?q=cache:DaMt_LgPWUYJ:rokr-blargh.appspot.com/copying-text-into-the-clipboard-with-javascript-in-firefox-safari-ie-opera-292559a2cc6c4ebf9724d23e8bc5ad8a%20&cd=1&hl=en&ct=clnk&gl=us)也是如此）

* * *

## 回答 #2

> 赞同：22
> 
> 时间：2015-12-02T18:32:30.907

现在有一种方法可以在大多数现代浏览器中使用

```
document.execCommand('copy'); 
```

这将复制当前选定的文本。您可以使用选择 textArea 或输入字段

```
document.getElementById('myText').select(); 
```

要隐形复制文本，您可以快速生成一个 textArea，修改框中的文本，选择它，复制它，然后删除 textArea。在大多数情况下，这个 textArea 甚至不会闪现到屏幕上。

出于安全原因，浏览器仅允许您在用户采取某种操作（即单击按钮）时进行复制。一种方法是将 onClick 事件添加到调用复制文本的方法的 html 按钮。

一个完整的例子：

```
function copier(){
  document.getElementById('myText').select();
  document.execCommand('copy');
}
```

```
<button onclick="copier()">Copy</button>
<textarea id="myText">Copy me PLEASE!!!</textarea>
```

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2009-06-01T08:33:34.150

在线电子表格应用程序挂钩`Ctrl`+`C`和`Ctrl`+`V`事件并将焦点转移到隐藏的 TextArea 控件，并将其内容设置为所需的新剪贴板内容以进行复制或在事件完成后读取其内容以进行粘贴。

另请参阅*[是否可以使用 JavaScript 在 Firefox、Safari 和 Chrome 中读取剪贴板？](https://stackoverflow.com/questions/233719/is-it-possible-to-read-the-clipboard-in-firefox-safari-and-chrome-using-javascri)*.

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2015-08-11T15:26:21.270

现在是 2015 年夏天，Flash 周围有如此多的动荡，这里是如何完全避免使用它的方法。

[clipboard.js](https://www.npmjs.com/package/clipboard-js)是一个不错的实用程序，它允许将文本或 html 数据复制到剪贴板。它非常易于使用，只需包含 .js 并使用如下内容：

```
<button id='markup-copy'>Copy Button</button>

<script>
document.getElementById('markup-copy').addEventListener('click', function() {
  clipboard.copy({
    'text/plain': 'Markup text. Paste me into a rich text editor.',
    'text/html': '<i>here</i> is some <b>rich text</b>'
  }).then(
    function(){console.log('success'); },
    function(err){console.log('failure', err);
  });

});
</script> 
```

clipboard.js 也在[GitHub 上](https://github.com/lgarron/clipboard.js)。

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2017-04-18T22:35:04.813

截至 2017 年，您可以这样做：

```
function copyStringToClipboard (string) {
    function handler (event){
        event.clipboardData.setData('text/plain', string);
        event.preventDefault();
        document.removeEventListener('copy', handler, true);
    }

    document.addEventListener('copy', handler, true);
    document.execCommand('copy');
} 
```

现在复制`copyStringToClipboard('Hello, World!')`

如果您注意到这`setData`条线，并且想知道是否可以设置不同的数据类型，答案是肯定的。

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2008-09-24T13:22:08.737

Firefox 确实允许您将数据存储在剪贴板中，但出于安全考虑，默认情况下它是禁用的。在 Mozilla Firefox 知识库中的[“授予对剪贴板的 JavaScript 访问权限”](http://support.mozilla.com/en-US/kb/Granting+JavaScript+access+to+the+clipboard)中查看如何启用它。

如果您有很多用户并且无法配置他们的浏览器，amdfan 提供的解决方案是最好的。如果用户精通技术，您可以测试剪贴板是否可用并提供更改设置的链接。JavaScript 编辑器[TinyMCE](http://tinymce.moxiecode.com/)遵循这种方法。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2009-01-13T22:12:49.037

copyIntoClipboard() 函数适用于 Flash 9，但它似乎因 Flash 播放器 10 的发布而被破坏。这是一个适用于新 Flash 播放器的解决方案：

[http://bowser.macminicolo.net/~jhuckaby/zeroclipboard/](http://bowser.macminicolo.net/~jhuckaby/zeroclipboard/)

这是一个复杂的解决方案，但它确实有效。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2009-02-07T02:01:46.447

我不得不说，这些解决方案都没有*真正*起作用。我已经从接受的答案中尝试了剪贴板解决方案，但它不适用于 Flash Player 10。我也尝试过 ZeroClipboard，有一段时间我对它非常满意。

我目前在我自己的网站（[http://www.blogtrog.com](http://www.blogtrog.com)）上使用它，但我一直注意到它有一些奇怪的错误。ZeroClipboard 的工作方式是在页面元素的顶部放置一个不可见的 flash 对象。我发现如果我的元素移动（例如当用户调整窗口大小并且我将事物正确对齐时），ZeroClipboard flash 对象就会失控并且不再覆盖该对象。我怀疑它可能仍然坐在原来的位置。他们有应该阻止这种情况的代码，或者将其重新粘贴到元素上，但它似乎不能很好地工作。

所以……在下一个版本的 BlogTrog 中，我想我会效仿我在野外看到的所有其他代码荧光笔，并删除我的 Copy to Clipboard 按钮。:-(

（我注意到 dp.syntaxhiglighter 的 Copy to Clipboard 现在也坏了。）

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2011-04-08T22:32:32.930

检查此链接：

*[授予对剪贴板的 JavaScript 访问权限](http://kb.mozillazine.org/Granting_JavaScript_access_to_the_clipboard)*

就像大家说的那样，出于安全原因，默认情况下它是禁用的。上面的页面显示了如何启用它的说明（通过在 Firefox 中编辑*about:config或**user.js*文件）。

幸运的是，有一个名为“AllowClipboardHelper”的插件，只需单击几下即可轻松完成。但是，您仍然需要指导您网站的访问者如何在 Firefox 中启用访问。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2017-01-09T10:50:44.497

使用现代的 document.execCommand("copy") 和 jQuery。请参阅[此堆栈溢出答案](https://stackoverflow.com/questions/22581345/click-button-copy-to-clipboard-using-jquery/41545988#41545988)。

```
var ClipboardHelper = { // As Object

    copyElement: function ($element)
    {
        this.copyText($element.text())
    },
    copyText:function(text) // Linebreaks with \n
    {
        var $tempInput =  $("<textarea>");
        $("body").append($tempInput);
        $tempInput.val(text).select();
        document.execCommand("copy");
        $tempInput.remove();
    }
}; 
```

如何称呼它：

```
ClipboardHelper.copyText('Hello\nWorld');
ClipboardHelper.copyElement($('body h1').first()); 
```

```
// jQuery document
;(function ( $, window, document, undefined ) {

    var ClipboardHelper = {

        copyElement: function ($element)
        {
           this.copyText($element.text())
        },
        copyText:function(text) // Linebreaks with \n
        {
            var $tempInput =  $("<textarea>");
            $("body").append($tempInput);

            //todo prepare Text: remove double whitespaces, trim

            $tempInput.val(text).select();
            document.execCommand("copy");
            $tempInput.remove();
        }
    };

    $(document).ready(function()
    {
        var $body = $('body');

        $body.on('click', '*[data-copy-text-to-clipboard]', function(event)
        {
            var $btn = $(this);
            var text = $btn.attr('data-copy-text-to-clipboard');
            ClipboardHelper.copyText(text);
        });

        $body.on('click', '.js-copy-element-to-clipboard', function(event)
        {
            ClipboardHelper.copyElement($(this));
        });
    });
})( jQuery, window, document );
```

```
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>

<span data-copy-text-to-clipboard=
    "Hello
     World">
    Copy Text
</span>

<br><br>
<span class="js-copy-element-to-clipboard">
    Hello
    World
    Element
</span>
```

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2010-06-27T21:42:08.860

我使用 GitHub 的[Clippy](http://github.com/mojombo/clippy)来满足我的需要，它是一个简单的基于 Flash 的按钮。如果不需要样式并且对预先在服务器端插入*要粘贴的内容感到满意，它就可以正常工作。*

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-06-01T08:42:35.070

Flash 解决方案的一个小改进是使用 swfobject 检测 Flash 10：

[http://code.google.com/p/swfobject/](http://code.google.com/p/swfobject/)

然后，如果它显示为 Flash 10，请尝试使用 JavaScript 加载 Shockwave 对象。[Shockwave 也可以使用Lingo](https://en.wikipedia.org/wiki/Lingo_(programming_language))中的 copyToClipboard() 命令读取/写入剪贴板（在所有版本中）。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2010-06-25T02:50:08.103

[http://www.rodsdot.com/ee/cross_browser_clipboard_copy_with_pop_over_message.asp](http://www.rodsdot.com/ee/cross_browser_clipboard_copy_with_pop_over_message.asp)适用于 Flash 10 和所有支持 Flash 的浏览器。

此外，ZeroClipboard 也已更新，以避免提到的有关页面滚动的错误导致 Flash 电影不再位于正确的位置。

由于该方法“要求”用户单击按钮进行复制，这对用户来说是一种方便，并且不会发生任何恶意行为。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2011-03-24T14:46:57.250

尝试创建一个存储选择的内存全局变量。然后另一个函数可以访问变量并进行粘贴。例如，

```
var memory = ''; // Outside the functions but within the script tag.

function moz_stringCopy(DOMEle, firstPos, secondPos) {

    var copiedString = DOMEle.value.slice(firstPos, secondPos);
    memory = copiedString;
}

function moz_stringPaste(DOMEle, newpos) {

    DOMEle.value = DOMEle.value.slice(0, newpos) + memory + DOMEle.value.slice(newpos);
} 
```

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2013-08-20T17:53:10.657

如果您支持 Flash，您可以使用*[https://everyplay.com/assets/clipboard.swf](https://everyplay.com/assets/clipboard.swf)*并使用 flashvars 文本来设置文本。

[https://everyplay.com/assets/clipboard.swf?text=It%20Works](https://everyplay.com/assets/clipboard.swf?text=It%20Works)

那是我用来复制的，如果它不支持这些选项，您可以设置为额外。您可以使用：

**对于 Internet Explorer：**

window.clipboardData.setData(DataFormat, Text) 和 window.clipboardData.getData(DataFormat)

您可以使用DataFormat 的Text 和URL 来getData 和setData。

并删除数据：

您可以使用 DataFormat 的文件、HTML、图像、文本和 URL。PS：你需要使用`window.clipboardData.clearData(DataFormat);`.

对于不支持 window.clipboardData 和 swf Flash 文件的其他文件，您还可以在 Windows 的键盘上使用`Control`+`C`按钮，对于 Mac 使用它的`Command`+ `C`。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2014-12-31T23:35:59.067

**从插件代码：**

对于如何从 Chrome 代码执行此操作，您可以使用此处描述的 nsIClipboardHelper 界面：[https ://developer.mozilla.org/en-US/docs/Using_the_Clipboard](https://developer.mozilla.org/en-US/docs/Using_the_Clipboard)

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2016-04-13T23:09:58.647

使用`document.execCommand('copy')`. 最新版本的 Chrome、Firefox、Edge 和 Safari 都支持它。

```
function copyText(text){
  function selectElementText(element) {
    if (document.selection) {
      var range = document.body.createTextRange();
      range.moveToElementText(element);
      range.select();
    } else if (window.getSelection) {
      var range = document.createRange();
      range.selectNode(element);
      window.getSelection().removeAllRanges();
      window.getSelection().addRange(range);
    }
  }
  var element = document.createElement('DIV');
  element.textContent = text;
  document.body.appendChild(element);
  selectElementText(element);
  document.execCommand('copy');
  element.remove();
}

var txt = document.getElementById('txt');
var btn = document.getElementById('btn');
btn.addEventListener('click', function(){
  copyText(txt.value);
})
```

```
<input id="txt" value="Hello World!" />
<button id="btn">Copy To Clipboard</button>
```

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2019-02-03T14:10:35.557

[剪贴板 API](https://devdocs.io/dom/clipboard_api)旨在取代[`document.execCommand`](https://devdocs.io/dom/document/execcommand). Safari 仍在努力提供支持，因此您应该提供一个回退，直到规范确定并且 Safari 完成实施。

```
const permalink = document.querySelector('[rel="bookmark"]');
const output = document.querySelector('output');
permalink.onclick = evt => {
  evt.preventDefault();
  window.navigator.clipboard.writeText(
    permalink.href
  ).then(() => {
    output.textContent = 'Copied';
  }, () => {
    output.textContent = 'Not copied';
  });
};
```

```
<a href="https://stackoverflow.com/questions/127040/" rel="bookmark">Permalink</a>
<output></output>
```

出于安全原因[`Permissions`](https://w3c.github.io/permissions/)，可能需要剪贴板才能从剪贴板读取和写入。如果代码段在 Stack Overflow 上不起作用，请在[localhost](https://en.wikipedia.org/wiki/Localhost)或其他受信任的域上试一试。

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2019-10-30T20:55:10.220

[基于来自 Studio.201 的 David](https://stackoverflow.com/questions/127040/copy-put-text-on-the-clipboard-with-firefox-safari-and-chrome/41546309#41546309)的出色回答，它适用于 Safari、Firefox 和 Chrome。`textarea`通过将其放置在屏幕外，它还可以确保不会发生闪烁。

```
// ================================================================================
// ClipboardClass
// ================================================================================
var ClipboardClass = (function() {

    function copyText(text) {
        // Create temp element off-screen to hold text.
        var tempElem = $('<textarea style="position: absolute; top: -8888px; left: -8888px">');
        $("body").append(tempElem);

        tempElem.val(text).select();
        document.execCommand("copy");
        tempElem.remove();
    }

    // ============================================================================
    // Class API
    // ============================================================================
    return {
        copyText: copyText
    };
})(); 
```

# c# - 如何 UAC 使用 .NET 提升 COM 组件

> ID：127042
> 
> 赞同：16
> 
> 时间：2008-09-24T13:13:17.713
> 
> 标签：c#, com, uac, elevation, moniker

我找到了[一篇](http://chrison.net/UACElevationInManagedCodeStartingElevatedCOMComponents.aspx)关于如何通过调用 `CoCreateInstanceAsAdmin`. 但是我无法找到或做的是一种将我的 .NET (c#) 应用程序的组件实现为 COM 对象然后调用该对象以执行需要 UAC 提升的任务的方法。MSDN 将此记录为[管理 COM 对象模型](http://msdn.microsoft.com/en-us/library/bb756990.aspx)。

我知道以管理员身份启动应用程序（或另一个应用程序）是可能且非常容易的，以在单独的进程中执行任务（例如参见[Daniel Moth 的帖子](http://www.danielmoth.com/Blog/2006/12/launch-elevated-and-modal-too.html)，但我正在寻找的是一种方法在同一个未提升的 .NET 可执行文件中执行所有操作。这样做当然会在新进程中生成 COM 对象，但由于透明编组，.NET COM 对象的调用者不应该（太很多）意识到这一点。

关于如何通过`CoCreateInstanceAsAdmin`API 从 C# 项目中实例化用 C# 编写的 COM 对象的任何想法都会非常有帮助。所以我真的很想学习如何用 C# 编写 COM 对象，然后我可以通过 COM 提升 API 从 C# 调用它。

如果提升的 COM 对象不在同一进程中运行，请不要介意。我只是不想启动整个应用程序。我只想提升将执行代码的 COM 对象。如果我可以写一些类似的东西：

```
// in a dedicated assembly, marked with the following attributes:
[assembly: ComVisible (true)]
[assembly: Guid ("....")]

public class ElevatedClass
{
    public void X() { /* do something */ }
} 
```

然后让我的主应用程序`ElevatedClass`通过`CoCreateInstanceAsAdmin`调用进行实例化。但也许我只是在做梦。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-22T21:52:39.127

查看[Windows Vista UAC 演示示例代码](http://www.microsoft.com/downloads/details.aspx?FamilyID=2cd92e43-6cda-478a-9e3b-4f831e899433&DisplayLang=en)

（对于 UnsafeNativeMethods.CoGetObject 方法，您还需要[Vista Bridge示例）](http://msdn.microsoft.com/en-us/library/ms756482.aspx)

它为您提供了 C# 代码，显示了几种不同的提升方式，包括 COM 对象

*（不完整的代码示例 - 获取上面的文件）*

```
[return: MarshalAs(UnmanagedType.Interface)]
static internal object LaunchElevatedCOMObject(Guid Clsid, Guid InterfaceID)
   {
   string CLSID = Clsid.ToString("B"); // B formatting directive: returns {xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx} 
   string monikerName = "Elevation:Administrator!new:" + CLSID;

   NativeMethods.BIND_OPTS3 bo = new NativeMethods.BIND_OPTS3();
   bo.cbStruct = (uint)Marshal.SizeOf(bo);
   bo.hwnd = IntPtr.Zero;
   bo.dwClassContext = (int)NativeMethods.CLSCTX.CLSCTX_ALL;

   object retVal = UnsafeNativeMethods.CoGetObject(monikerName, ref bo, InterfaceID);

   return (retVal);
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-26T21:00:35.217

我认为 CoCreateInstanceAsAdmin 工作的唯一方法是您提前注册了 COM 组件。如果您希望您的应用程序在 XCopy 部署设置中工作，这可能是个问题。

在 Gallio 中，出于我自己的目的，我决定在带有清单的一侧创建一个小托管进程，以要求管理员权限。然后，当我需要执行提升的操作时，我启动一个托管进程的实例并通过 .Net 远程处理指示它执行在 Gallio 的控制反转容器中注册的特定命令。

这是一项相当大的工作，但 Gallio 已经拥有一个进程外托管设施，因此在混合中添加提升并不是太难。此外，这种机制确保 Gallio 可以执行特权提升，而无需事先在注册表中安装任何其他 COM 组件。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-24T15:00:13.417

提升的要素是过程。因此，如果我正确理解了您的问题，并且您想要一种在您的流程中提升 COM 对象的方法，那么答案是您不能。CoCreateInstanceAsAdmin 的全部意义在于不在您的进程中运行它。

# python - 在 Python 正则表达式中找出捕获组的数量

> ID：127055
> 
> 赞同：46
> 
> 时间：2008-09-24T13:14:50.377
> 
> 标签：python, regex

有没有办法确定给定正则表达式中有多少个捕获组？

我希望能够做到以下几点：

```
def groups(regexp, s):
    """ Returns the first result of re.findall, or an empty default

    >>> groups(r'(\d)(\d)(\d)', '123')
    ('1', '2', '3')
    >>> groups(r'(\d)(\d)(\d)', 'abc')
    ('', '', '')
    """
    import re
    m = re.search(regexp, s)
    if m:
        return m.groups()
    return ('',) * num_of_groups(regexp) 
```

这使我可以执行以下操作：

```
first, last, phone = groups(r'(\w+) (\w+) ([\d\-]+)', 'John Doe 555-3456') 
```

但是，我不知道如何实现`num_of_groups`. （目前我只是解决它。）

**编辑：根据**[rslite](https://stackoverflow.com/questions/127055/find-out-number-of-capture-groups-in-python-regular-expressions/127089#127089)的建议，我替换`re.findall`为`re.search`.

`sre_parse`似乎是最强大和最全面的解决方案，但需要树遍历并且似乎有点重。

MizardX 的正则表达式似乎涵盖了所有基础，所以我将继续使用它。

* * *

## 回答 #1

> 赞同：53
> 
> 时间：2008-09-25T21:18:49.207

```
def num_groups(regex):
    return re.compile(regex).groups 
```

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2015-02-02T18:42:26.900

```
f_x = re.search(...)
len_groups = len(f_x.groups()) 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-24T13:23:34.117

sre_parse 内部的一些东西可能会有所帮助。

乍一看，可能是这样的：

```
>>> import sre_parse
>>> sre_parse.parse('(\d)\d(\d)')
[('subpattern', (1, [('in', [('category', 'category_digit')])])), 
('in', [('category', 'category_digit')]), 
('subpattern', (2, [('in', [('category', 'category_digit')])]))] 
```

即计算“子模式”类型的项目：

```
import sre_parse

def count_patterns(regex):
    """
    >>> count_patterns('foo: \d')
    0
    >>> count_patterns('foo: (\d)')
    1
    >>> count_patterns('foo: (\d(\s))')
    1
    """
    parsed = sre_parse.parse(regex)
    return len([token for token in parsed if token[0] == 'subpattern']) 
```

请注意，我们在这里仅计算根级别模式，因此最后一个示例仅返回 1。要更改这一点，需要递归搜索*令牌。*

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-24T13:21:55.180

首先，如果您只需要 re.findall 的第一个结果，最好只使用返回匹配项或 None 的 re.search。

对于组数，您可以计算开括号 '(' 的数量，但那些被 '\' 转义的除外。您可以为此使用另一个正则表达式：

```
def num_of_groups(regexp):
    rg = re.compile(r'(?<!\\)\(')
    return len(rg.findall(regexp)) 
```

请注意，如果正则表达式包含非捕获组，并且如果 '(' 通过将其用作 '[(]' 进行转义，则此方法不起作用。所以这不是很可靠。但取决于您使用的正则表达式可能帮助。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-24T13:25:54.313

可能是错的，但我认为没有办法找到匹配正则表达式的组数。我能想到的使这项工作按您希望的方式工作的唯一方法是将您的特定正则表达式期望的匹配数作为参数传递。

澄清一下：当 findall 成功时，您只希望返回第一个匹配项，但是当它失败时，您想要一个空字符串列表？因为评论似乎显示所有匹配项都作为列表返回。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-24T14:12:57.320

使用您的代码作为基础：

```
def groups(regexp, s):
    """ Returns the first result of re.findall, or an empty default

    >>> groups(r'(\d)(\d)(\d)', '123')
    ('1', '2', '3')
    >>> groups(r'(\d)(\d)(\d)', 'abc')
    ('', '', '')
    """
    import re
    m = re.search(regexp, s)
    if m:
        return m.groups()
    return ('',) * len(m.groups()) 
```

# .net-3.5 - .NET Framework 3.5 SP1 是否需要重新启动？

> ID：127073
> 
> 赞同：13
> 
> 时间：2008-09-24T13:18:48.793
> 
> 标签：.net-3.5

我们有一台生产机器，正在尝试在我们的 Web 应用程序中慢慢引入一些 3.0 及更高版本的功能。安装了3.5但我想升级到SP1，我想知道它是否需要重新启动机器，以便我可以安排一些停机时间。

谢谢！

编辑：所以它确实需要重新启动，谢谢大家的回答......但托管公司没有给我们这样做的权利......哈哈

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2008-09-24T14:55:24.363

3.5 SP1 将 3.0 更新为 SP2，将 2.0（包含 CLR）更新为 SP2。如果在任何进程中加载​​了 CLR，则 DLL 将不可写，并且需要重新启动。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-09-24T13:27:05.793

呵呵。我在大约 4 台机器上安装了它……两台需要重启，两台不需要。它们之间的配置相似，因此没有明显的方法可以确定为什么有些需要重新启动而有些则不需要。我目前最好的理论是，需要重新启动的往往是那些更活跃的（它们都在运行 ASP.Net 站点），所以框架位可能还没有被 IIS 加载那些不需要重新启动的。

为了安全起见，请计划重新启动并相应地安排更新。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-24T13:28:42.013

我的没有。但无论如何我都会这样做。清除位。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-24T13:31:39.790

我昨天在 Windows XP 机器上运行了更新，它不需要重新启动。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-09T15:11:28.017

我使用 SP1 for .Net 3.5 接触过的每台机器都需要重新启动。它完全破坏了我的 Team Foundation Server 盒子。

# asp.net - GridView 行到对象类型

> ID：127076
> 
> 赞同：2
> 
> 时间：2008-09-24T13:19:12.817
> 
> 标签：asp.net, vb.net

在 ASP.NET 中，如果我将 gridview 与对象数组进行数据绑定，可以说，当用户选择行时，如何检索和使用 foo(index)？

IE

```
dim fooArr() as foo;
gv1.datasource =  fooArr;
gv1.databind(); 
```

在行选择

```
Private Sub gv1_RowCommand(ByVal sender As Object, ByVal e As System.Web.UI.WebControls.GridViewCommandEventArgs) Handles gv1.RowCommand

        If e.CommandName = "Select" Then
            'get and use foo(index)    
        End If
    End Sub 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-24T13:52:34.217

如果您可以确定数据源中项目的顺序没有更改，则可以使用 CommandEventArgs 的 CommandArgument 属性。

然而，更可靠的方法是使用 GridView 的 DataKeys/SelectedDataKey 属性。唯一需要注意的是，您的命令必须是“Select”类型（因此，默认情况下，RowCommand 将无法访问 DataKey）。

假设您在构成列表的实体中有一些唯一性，您可以在 GridView 的 DataKeys 属性中设置一个或多个键属性名称。设置 GridView 中的选定项目后，您可以检索键值并在绑定列表中找到该项目。此方法使您摆脱了 GridView 中的序号位置与数据源中元素的序号位置不匹配的问题。

例子：

```
<asp:GridView ID="GridView1" runat="server" AutoGenerateSelectButton="True" 
    DataKeyNames="Name" onrowcommand="GridView1_RowCommand1" 
    onselectedindexchanged="GridView1_SelectedIndexChanged">
</asp:GridView> 
```

然后页面的代码隐藏（或内联）将类似于：

```
protected void GridView1_SelectedIndexChanged(object sender, EventArgs e)
{
   // Value is the Name property of the selected row's bound object.
   string foo = GridView1.SelectedDataKey.Value as string; 
} 
```

另一种选择是深入研究 GridView 的 Rows 集合，通过获取控制值一次获取一列的值，但除非必须这样做，否则不建议这样做。

希望这可以帮助。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-24T13:27:27.553

理论上行的索引，应该是 foo 的索引（对于标题行可能 +1，你需要测试）。所以，你应该能够按照这些思路做一些事情

```
dim x as object = foo(e.row.selectedIndex) 
```

另一种选择是找到一种方法将索引数据绑定到按钮的 commandArgument 属性。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-24T13:28:44.650

这样做可能有一种更简洁的方法，但您可以将行的 CommandArgument 属性设置为其索引。然后类似的东西`foo(CInt(e.CommandArgument))`可以解决问题。

# visual-studio-2008 - 为什么 VS2008 在进入调试模式时为每个网站/应用程序生成一个 Cassini？

> ID：127093
> 
> 赞同：4
> 
> 时间：2008-09-24T13:23:00.030
> 
> 标签：visual-studio-2008, cassini

我在这里有一个相当大的解决方案，其中包含许多不同的 Web 应用程序和站点，其中大约 10-15 个。

当我将 VS2008 附加到任何进程（很可能是 Nunit.exe 或类似的东西）时，我会在解决方案中为每个网站/应用程序获得一个 Cassini 进程。有没有一种快速的方法来摆脱 VS 中的这种行为，还是我必须将它们连接到 IIS？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-04-17T06:37:11.207

我认为您要做的是将每个网站项目的“调试时始终启动”属性设置为“false”。只需在解决方案资源管理器中单击项目，按 F4，它就是列表中的第一个属性。

这个属性很烦人，因为即使您将调试器附加到 IIS（即您甚至没有构建解决方案），小型服务器也会自动启动。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-12T16:19:07.003

正如多个应用程序不能具有相同的 URL，您需要多个 Cassini 实例来在本地公开应用程序（即项目）。这更接近地模仿了代码最终部署的方式。您不会从多个项目中获取输出并将它们粘贴到生产应用服务器上的单个文件夹中，因此 VS 也不会这样做。此外，为每个项目生成一个新进程会为它们提供自己的资源，从而防止它们在调试过程中相互干扰。

VS 2008 公开了一个项目级别设置，该设置阻止 Cassini 启动，除非项目被明确调试。如果您只想运行单元测试（因为它们在单独的项目中，对吗？），设置此选项可以防止您的网站启动。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-24T13:24:51.837

据我所知，Visual Studio 附带的迷你 Web 服务器一次只能托管一个 Web 应用程序。对于你想要的，你真的必须使用 IIS。

# javascript - 注释 JavaScript 对象和方法的首选方法是什么？

> ID：127095
> 
> 赞同：62
> 
> 时间：2008-09-24T13:23:09.000
> 
> 标签：javascript, comments

我习惯了 Atlas，其中首选（据我所知）方法是使用 XML 注释，例如：

```
/// <summary>
///   Method to calculate distance between two points
/// </summary>
///
/// <param name="pointA">First point</param>
/// <param name="pointB">Second point</param>
///
function calculatePointDistance(pointA, pointB) { ... } 
```

最近我一直在研究其他第三方 JavaScript 库，我看到的语法如下：

```
/*
 * some comment here
 * another comment here
 * ...
 */
 function blahblah() { ... } 
```

作为奖励，是否有用于 JavaScript 的 API 生成器可以读取“首选”评论风格？

* * *

## 回答 #1

> 赞同：91
> 
> 时间：2008-09-24T13:26:00.117

有[JSDoc](https://jsdoc.app/)

```
/**
 * Shape is an abstract base class. It is defined simply
 * to have something to inherit from for geometric 
 * subclasses
 * @constructor
 */
function Shape(color){
 this.color = color;
} 
```

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2013-01-19T22:38:19.060

越简单越好，评论很好，用吧:)

```
var something = 10; // My comment

/*
Lorem ipsum dolor sit amet, consectetur adipisicing elit,
sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.
Ut enim ad minim veniam, quis nostrud exercitation ullamco
nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor
in reprehenderit in voluptate velit esse cillum dolore eu
fugiat nulla pariatur.
*/

function bigThing() {
    // ...
} 
```

但是对于自动生成的文档...

```
/**
 * Adds two numbers.
 * @param {number} num1 The first number to add.
 * @param {number} num2 The second number to add.
 * @return {number} The result of adding num1 and num2.
 */
function bigThing() {
    // ...
} 
```

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-12-18T20:40:35.500

雅虎提供[YUIDoc](http://developer.yahoo.com/yui/yuidoc/)。

它有据可查，受到 Yahoo 的支持，并且是一个 Node.js 应用程序。

它还使用了许多相同的语法，因此不必进行太多更改即可从一个到另一个。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-24T13:24:41.010

在第一个示例中使用三重注释实际上用于外部 XML 文档工具和（在 Visual Studio 中）智能感知支持。它仍然是一个有效的注释，但它的特殊性:) 实际的注释“操作符”是 // 唯一的限制是它的单行。

第二个示例使用 C 样式的块注释，它允许跨多行或在一行中间进行注释。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-24T14:43:27.590

尝试将以下内容粘贴到 Visual Studio 08 中的 javascript 文件中并使用它：

```
var Namespace = {};
    Namespace.AnotherNamespace = {};

Namespace.AnotherNamespace.annoyingAlert = function(_message)
{
    /// <param name="_message">The message you want alerted two times</param>
    /// <summary>This is really annoying!!</summary>

    alert(_message);
    alert(_message);
}; 
```

智能感知丰富！

有关这方面的更多信息（包括如何引用外部 javascript 文件，以便在大型库中使用）可以在[Scott Gu 的博客](http://weblogs.asp.net/scottgu/archive/2007/06/21/vs-2008-javascript-intellisense.aspx)上找到。

# daemon - 那么，谁应该守护进程？脚本还是调用者？

> ID：127107
> 
> 赞同：1
> 
> 时间：2008-09-24T13:26:03.970
> 
> 标签：daemon, process-monitoring

我总是想知道谁应该这样做。在[Ruby](http://ruby-lang.org/)中，我们有[Daemons](http://daemons.rubyforge.org/)库，它允许 Ruby 脚本自己守护进程。然后，查看[God](http://god.rubyforge.org/)（一个进程监控工具，类似于[monit](http://www.tildeslash.com/monit/)）页面，我看到 God 可以守护进程。

有没有明确的答案？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-24T13:47:56.913

您可能无法得到明确的答案，因为我们通常会同时得到这两种情况：进程能够自行守护进程，而进程监视器能够守护其子进程。

就个人而言，我更喜欢让进程监视器或脚本来执行它，原因如下：
1\. 如果进程监视器希望密切关注其子进程以在它们死后重新启动它们，它可以选择不守护它们。当其子进程之一退出时，将向监视器传递 SIGCHLD。在嵌入式系统中，我们经常这样做。
2\. 通常在守护进程时，您还设置了 euid 和 egid。我不喜欢在每个子进程中编码系统级策略的知识，比如要使用的 uid。
3\. 它允许重复使用相同的应用程序作为命令行工具或守护程序（我坦率地承认这在实践中很少发生）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-24T13:38:45.733

我会说最好让你的脚本来做。我不知道您那里的过程监控工具，但我认为用户可能会使用替代工具，这意味着让脚本执行它会更好。

如果您可以设想脚本以非守护程序方式运行，我会在脚本中添加一个选项来启用或禁用守护程序。

# sql - SQL Server 将整数转换为二进制字符串

> ID：127116
> 
> 赞同：27
> 
> 时间：2008-09-24T13:27:46.087
> 
> 标签：sql, sql-server

我想知道 SQL 中是否有一种简单的方法可以将整数转换为其二进制表示，然后将其存储为 varchar。

例如，5 将转换为“101”并存储为 varchar。

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2012-06-30T09:43:21.333

实际上，使用普通的旧 SQL 真的很简单。只需使用按位与。我有点惊讶，网上没有发布一个简单的解决方案（不涉及 UDF）。就我而言，我真的想检查位是打开还是关闭（数据来自 dotnet eNums）。

因此，这里有一个示例，它将分别为您提供 - 位值和二进制字符串（大联合只是一种产生可跨 DB 工作的数字的 hacky 方式：

```
 select t.Number
    , cast(t.Number & 64 as bit) as bit7
    , cast(t.Number & 32 as bit) as bit6
    , cast(t.Number & 16 as bit) as bit5
    , cast(t.Number & 8 as bit) as bit4
    , cast(t.Number & 4 as bit) as bit3
    , cast(t.Number & 2 as bit)  as bit2
    ,cast(t.Number & 1 as bit) as bit1

    , cast(cast(t.Number & 64 as bit) as CHAR(1)) 
    +cast( cast(t.Number & 32 as bit) as CHAR(1))
    +cast( cast(t.Number & 16 as bit)  as CHAR(1))
    +cast( cast(t.Number & 8 as bit)  as CHAR(1))
    +cast( cast(t.Number & 4 as bit)  as CHAR(1))
    +cast( cast(t.Number & 2 as bit)   as CHAR(1))
    +cast(cast(t.Number & 1 as bit)  as CHAR(1)) as binary_string
    --to explicitly answer the question, on MSSQL without using REGEXP (which would make it simple)
    ,SUBSTRING(cast(cast(t.Number & 64 as bit) as CHAR(1)) 
                    +cast( cast(t.Number & 32 as bit) as CHAR(1))
                    +cast( cast(t.Number & 16 as bit)  as CHAR(1))
                    +cast( cast(t.Number & 8 as bit)  as CHAR(1))
                    +cast( cast(t.Number & 4 as bit)  as CHAR(1))
                    +cast( cast(t.Number & 2 as bit)   as CHAR(1))
                    +cast(cast(t.Number & 1 as bit)  as CHAR(1))
                    ,
                    PATINDEX('%1%', cast(cast(t.Number & 64 as bit) as CHAR(1)) 
                                        +cast( cast(t.Number & 32 as bit) as CHAR(1))
                                        +cast( cast(t.Number & 16 as bit)  as CHAR(1))
                                        +cast( cast(t.Number & 8 as bit)  as CHAR(1))
                                        +cast( cast(t.Number & 4 as bit)  as CHAR(1))
                                        +cast( cast(t.Number & 2 as bit)   as CHAR(1))
                                        +cast(cast(t.Number & 1 as bit)  as CHAR(1)  )
                    )
,99)

from (select 1 as Number union all select 2 union all select 3 union all select 4 union all select 5 union all select 6 
    union all select 7 union all select 8 union all select 9 union all select 10) as t 
```

产生这个结果：

```
num  bit7 bit6 bit5 bit4 bit3 bit2 bit1 binary_string   binary_string_trimmed 
1    0    0    0    0    0    0    1    0000001         1
2    0    0    0    0    0    1    0    0000010         10
3    0    0    0    0    0    1    1    0000011         11
4    0    0    0    1    0    0    0    0000100         100
5    0    0    0    0    1    0    1    0000101         101
6    0    0    0    0    1    1    0    0000110         110
7    0    0    0    0    1    1    1    0000111         111
8    0    0    0    1    0    0    0    0001000         1000
9    0    0    0    1    0    0    1    0001001         1001
10   0    0    0    1    0    1    0    0001010         1010 
```

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2008-09-24T14:10:26.173

以下可以编码成一个函数。您需要修剪前导零以满足您的问题的要求。

```
declare @intvalue int
set @intvalue=5

declare @vsresult varchar(64)
declare @inti int
select @inti = 64, @vsresult = ''
while @inti>0
  begin
    select @vsresult=convert(char(1), @intvalue % 2)+@vsresult
    select @intvalue = convert(int, (@intvalue / 2)), @inti=@inti-1
  end
select @vsresult 
```

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2011-07-19T16:42:58.230

这是一个通用的基础转换器

[http://dpatrickcaldwell.blogspot.com/2009/05/converting-decimal-to-hexadecimal-with.html](http://dpatrickcaldwell.blogspot.com/2009/05/converting-decimal-to-hexadecimal-with.html)

你可以做

```
select reverse(dbo.ConvertToBase(5, 2))   -- 101 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2017-09-14T16:41:20.653

[这是对Sean 接受](/a/127371/5764553)的答案的一些更改，因为我发现它限制为仅允许输出中的硬编码位数。在我的日常使用中，我发现要么只获取最高 1 位数字，要么指定我期望返回的数字位数更有用。它会自动用 0 填充边，以便它最多排列 8、16 或任何您想要的位数。

```
Create function f_DecimalToBinaryString
    (
        @Dec int,
        @MaxLength int = null
    )
Returns varchar(max)
as Begin

    Declare @BinStr varchar(max) = '';

    -- Perform the translation from Dec to Bin
    While @Dec > 0 Begin

        Set @BinStr = Convert(char(1), @Dec % 2) + @BinStr;
        Set @Dec = Convert(int, @Dec /2);

    End;

    -- Either pad or trim the output to match the number of digits specified.
    If (@MaxLength is not null) Begin
        If @MaxLength <= Len(@BinStr) Begin -- Trim down
            Set @BinStr = SubString(@BinStr, Len(@BinStr) - (@MaxLength - 1), @MaxLength);
        End Else Begin -- Pad up
            Set @BinStr = Replicate('0', @MaxLength - Len(@BinStr)) + @BinStr;
        End;
    End;

    Return @BinStr;

End; 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2016-04-11T11:59:40.247

我使用以下 ITVF 函数将十进制转换为二进制，因为它是一个内联函数，您无需“担心”优化器执行的多次读取。

```
 CREATE FUNCTION dbo.udf_DecimalToBinary 
    (
        @Decimal VARCHAR(32)
    )

    RETURNS TABLE AS RETURN

    WITH Tally (n) AS
    (
        --32 Rows
        SELECT TOP 30 ROW_NUMBER() OVER (ORDER BY (SELECT NULL)) -1
        FROM (VALUES (0),(0),(0),(0)) a(n)
        CROSS JOIN (VALUES(0),(0),(0),(0),(0),(0),(0),(0)) b(n)

     ) 

     , Anchor (n, divisor , Result) as 
     (
     SELECT t.N , 
            CONVERT(BIGINT, @Decimal) / POWER(2,T.N) ,  
            CONVERT(BIGINT, @Decimal) / POWER(2,T.N) % 2 
     FROM Tally t 
     WHERE CONVERT(bigint,@Decimal) >= POWER(2,t.n)
     )

     SELECT TwoBaseBinary =  '' +
        (SELECT Result 
          FROM Anchor
          ORDER BY N DESC 
          FOR XML PATH ('') , TYPE).value('.','varchar(200)')

   /*How to use*/
   SELECT TwoBaseBinary 
   FROM dbo.udf_DecimalToBinary ('1234')

   /*result -> 10011010010*/ 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-24T16:33:06.827

```
declare @i int /* input */
set @i = 42

declare @result varchar(32) /* SQL Server int is 32 bits wide */
set @result = ''
while 1 = 1 begin
  select @result = convert(char(1), @i % 2) + @result,
         @i = convert(int, @i / 2)
  if @i = 0 break
end

select @result 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-07-09T13:29:10.753

```
declare @intVal Int 
set @intVal = power(2,12)+ power(2,5) + power(2,1);
With ComputeBin (IntVal, BinVal,FinalBin)
As
    (
    Select @IntVal IntVal, @intVal %2 BinVal , convert(nvarchar(max),(@intVal %2 ))     FinalBin
    Union all
    Select IntVal /2, (IntVal /2) %2, convert(nvarchar(max),(IntVal /2) %2) + FinalBin     FinalBin
    From ComputeBin
    Where IntVal /2 > 0
)
select FinalBin from ComputeBin where intval = ( select min(intval) from ComputeBin); 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2016-06-11T11:12:17.883

```
with t as (select * from (values (0),(1)) as t(c)),

t0 as (table t),
t1 as (table t),
t2 as (table t),
t3 as (table t),
t4 as (table t),
t5 as (table t),
t6 as (table t),
t7 as (table t),
t8 as (table t),
t9 as (table t),
ta as (table t),
tb as (table t),
tc as (table t),
td as (table t),
te as (table t),
tf as (table t)

select  '' || t0.c || t1.c || t2.c || t3.c || t4.c || t5.c || t6.c || t7.c || t8.c || t9.c || ta.c || tb.c || tc.c || td.c || te.c || tf.c as n
from  t0,t1,t2,t3,t4,t5,t6,t7,t8,t9,ta,tb,tc,td,te,tf
order by n 

limit 1 offset 5 
```

标准 SQL（在 PostgreSQL 中测试）。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2017-05-03T10:29:08.253

在 SQL Server 上，您可以尝试以下示例：

```
DECLARE  @Int int = 321

SELECT @Int
,CONCAT
(CAST(@Int & power(2,15)    AS bit)
,CAST(@Int & power(2,14)    AS bit)
,CAST(@Int & power(2,13)    AS bit)
,CAST(@Int & power(2,12)    AS bit)
,CAST(@Int & power(2,11)    AS bit)
,CAST(@Int & power(2,10)    AS bit)
,CAST(@Int & power(2,9)     AS bit)
,CAST(@Int & power(2,8)     AS bit)
,CAST(@Int & power(2,7)     AS bit)
,CAST(@Int & power(2,6)     AS bit)
,CAST(@Int & power(2,5)     AS bit)
,CAST(@Int & power(2,4)     AS bit)
,CAST(@Int & power(2,3)     AS bit)
,CAST(@Int & power(2,2)     AS bit)
,CAST(@Int & power(2,1)     AS bit)
,CAST(@Int & power(2,0)     AS bit) ) AS BitString

,CAST(@Int & power(2,15)    AS bit) AS BIT15
,CAST(@Int & power(2,14)    AS bit) AS BIT14
,CAST(@Int & power(2,13)    AS bit) AS BIT13
,CAST(@Int & power(2,12)    AS bit) AS BIT12
,CAST(@Int & power(2,11)    AS bit) AS BIT11
,CAST(@Int & power(2,10)    AS bit) AS BIT10
,CAST(@Int & power(2,9)     AS bit) AS BIT9 
,CAST(@Int & power(2,8)     AS bit) AS BIT8 
,CAST(@Int & power(2,7)     AS bit) AS BIT7 
,CAST(@Int & power(2,6)     AS bit) AS BIT6 
,CAST(@Int & power(2,5)     AS bit) AS BIT5 
,CAST(@Int & power(2,4)     AS bit) AS BIT4 
,CAST(@Int & power(2,3)     AS bit) AS BIT3 
,CAST(@Int & power(2,2)     AS bit) AS BIT2 
,CAST(@Int & power(2,1)     AS bit) AS BIT1 
,CAST(@Int & power(2,0)     AS bit) AS BIT0 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2019-11-13T19:29:05.847

我知道我在这里玩游戏有点晚了，但我最近想出了一个巧妙的解决方案，它利用了一个计数表（类似于上面的@hkravitz 解决方案。）主要区别在于我利用了我所说的*虚拟索引****在执行计划中不使用排序运算符***对结果进行降序排序。我使用`dbo.rangeAB`本文末尾包含的内容来完成此操作。

请注意，这将按升序返回数字 0 到 30（作为 RowNumber 的“RN”）：

```
SELECT   r.RN
FROM     dbo.rangeAB(0,30,1,0) AS r
ORDER BY r.RN; 
```

它这样做没有排序。RN 可以定义为 ROW_NUMBER() OVER (ORDER BY (SELECT NULL))。同样，按 RN 排序不需要排序 - 这就是*虚拟索引*。

[![在此处输入图像描述](https://i.stack.imgur.com/AJZH4.png)](https://i.stack.imgur.com/AJZH4.png)

但是，当我尝试降序排序时，我***确实***在执行计划中*得到了排序。*

[![在此处输入图像描述](https://i.stack.imgur.com/sgyuO.png)](https://i.stack.imgur.com/sgyuO.png)

输入**有限对立**。RangeAB 包含一个名为**Op** - OP RN 的*Finite **Op** posite* Number 的列。我所说的“有限对立”是指，0 是 30 的对立面，1 是 29 的对立面，依此类推。与传统的对立数不同（-1 与 1 对立）。有限对立面按降序返回。

```
SELECT   r.RN, r.OP
FROM     dbo.rangeAB(0,30,1,0) AS r
ORDER BY r.RN; 
```

**回报：**

```
RN    OP
----- -------
0     30
1     29
2     28
3     27
....
27    3
28    2
29    1
30    0 
```

我可以使用 Op 我可以利用 RN 的有限对立来按降序获取数字，同时仍然利用虚拟索引来避免排序。这两个查询返回相同的内容，但是在比较执行计划时，根据 SSMS，删除排序将查询成本降低了 50 倍。

[![在此处输入图像描述](https://i.stack.imgur.com/HCdcO.png)](https://i.stack.imgur.com/HCdcO.png)

**功能**

```
CREATE FUNCTION dbo.NumberToBinary(@input INT)
RETURNS TABLE WITH SCHEMABINDING AS RETURN
/* Created By Alan Burstein 20191112, Requires RangeAB (code below) */
SELECT BIN = (
  SELECT       @input/f.Np2%2
  FROM        dbo.rangeAB(0,30,1,0)   AS r
  CROSS APPLY (VALUES(POWER(2,r.Op))) AS f(NP2)
  WHERE       (@input = 0 AND f.Np2 = 1) OR @input >= f.Np2
  ORDER BY     ROW_NUMBER() OVER (ORDER BY (SELECT NULL))
  FOR XML PATH('')); 
```

**范围AB**

```
CREATE FUNCTION dbo.rangeAB
(
  @low  bigint, 
  @high bigint, 
  @gap  bigint,
  @row1 bit
)
/****************************************************************************************
[Purpose]:
 Creates up to 531,441,000,000 sequentia1 integers numbers beginning with @low and ending 
 with @high. Used to replace iterative methods such as loops, cursors and recursive CTEs 
 to solve SQL problems. Based on Itzik Ben-Gan's getnums function with some tweeks and 
 enhancements and added functionality. The logic for getting rn to begin at 0 or 1 is 
 based comes from Jeff Moden's fnTally function. 

 The name range because it's similar to clojure's range function. The name "rangeAB" as 
 used because "range" is a reserved SQL keyword.

[Author]: Alan Burstein

[Compatibility]: 
 SQL Server 2008+ and Azure SQL Database

[Syntax]:
 SELECT r.RN, r.OP, r.N1, r.N2
 FROM dbo.rangeAB(@low,@high,@gap,@row1) AS r;

[Parameters]:
 @low  = a bigint that represents the lowest value for n1.
 @high = a bigint that represents the highest value for n1.
 @gap  = a bigint that represents how much n1 and n2 will increase each row; @gap also
         represents the difference between n1 and n2.
 @row1 = a bit that represents the first value of rn. When @row = 0 then rn begins
         at 0, when @row = 1 then rn will begin at 1.

[Returns]:
 Inline Table Valued Function returns:
 rn = bigint; a row number that works just like T-SQL ROW_NUMBER() except that it can 
      start at 0 or 1 which is dictated by @row1.
 op = bigint; returns the "opposite number that relates to rn. When rn begins with 0 and
      ends with 10 then 10 is the opposite of 0, 9 the opposite of 1, etc. When rn begins
      with 1 and ends with 5 then 1 is the opposite of 5, 2 the opposite of 4, etc...
 n1 = bigint; a sequential number starting at the value of @low and incrimentingby the
      value of @gap until it is less than or equal to the value of @high.
 n2 = bigint; a sequential number starting at the value of @low+@gap and  incrimenting 
      by the value of @gap.

[Dependencies]:
N/A

[Developer Notes]:

 1\. The lowest and highest possible numbers returned are whatever is allowable by a 
    bigint. The function, however, returns no more than 531,441,000,000 rows (8100^3). 
 2\. @gap does not affect rn, rn will begin at @row1 and increase by 1 until the last row
    unless its used in a query where a filter is applied to rn.
 3\. @gap must be greater than 0 or the function will not return any rows.
 4\. Keep in mind that when @row1 is 0 then the highest row-number will be the number of
    rows returned minus 1
 5\. If you only need is a sequential set beginning at 0 or 1 then, for best performance
    use the RN column. Use N1 and/or N2 when you need to begin your sequence at any 
    number other than 0 or 1 or if you need a gap between your sequence of numbers. 
 6\. Although @gap is a bigint it must be a positive integer or the function will
    not return any rows.
 7\. The function will not return any rows when one of the following conditions are true:
      * any of the input parameters are NULL
      * @high is less than @low 
      * @gap is not greater than 0
    To force the function to return all NULLs instead of not returning anything you can
    add the following code to the end of the query:

      UNION ALL 
      SELECT NULL, NULL, NULL, NULL
      WHERE NOT (@high&@low&@gap&@row1 IS NOT NULL AND @high >= @low AND @gap > 0)

    This code was excluded as it adds a ~5% performance penalty.
 8\. There is no performance penalty for sorting by rn ASC; there is a large performance 
    penalty for sorting in descending order WHEN @row1 = 1; WHEN @row1 = 0
    If you need a descending sort the use op in place of rn then sort by rn ASC. 

Best Practices:
--===== 1\. Using RN (rownumber)
 -- (1.1) The best way to get the numbers 1,2,3...@high (e.g. 1 to 5):
 SELECT RN FROM dbo.rangeAB(1,5,1,1);
 -- (1.2) The best way to get the numbers 0,1,2...@high-1 (e.g. 0 to 5):
 SELECT RN FROM dbo.rangeAB(0,5,1,0);

--===== 2\. Using OP for descending sorts without a performance penalty
 -- (2.1) The best way to get the numbers 5,4,3...@high (e.g. 5 to 1):
 SELECT op FROM dbo.rangeAB(1,5,1,1) ORDER BY rn ASC;
 -- (2.2) The best way to get the numbers 0,1,2...@high-1 (e.g. 5 to 0):
 SELECT op FROM dbo.rangeAB(1,6,1,0) ORDER BY rn ASC;

--===== 3\. Using N1
 -- (3.1) To begin with numbers other than 0 or 1 use N1 (e.g. -3 to 3):
 SELECT N1 FROM dbo.rangeAB(-3,3,1,1);
 -- (3.2) ROW_NUMBER() is built in. If you want a ROW_NUMBER() include RN:
 SELECT RN, N1 FROM dbo.rangeAB(-3,3,1,1);
 -- (3.3) If you wanted a ROW_NUMBER() that started at 0 you would do this:
 SELECT RN, N1 FROM dbo.rangeAB(-3,3,1,0);

--===== 4\. Using N2 and @gap
 -- (4.1) To get 0,10,20,30...100, set @low to 0, @high to 100 and @gap to 10:
 SELECT N1 FROM dbo.rangeAB(0,100,10,1);
 -- (4.2) Note that N2=N1+@gap; this allows you to create a sequence of ranges.
 --       For example, to get (0,10),(10,20),(20,30).... (90,100):
 SELECT N1, N2 FROM dbo.rangeAB(0,90,10,1);
 -- (4.3) Remember that a rownumber is included and it can begin at 0 or 1:
 SELECT RN, N1, N2 FROM dbo.rangeAB(0,90,10,1);

[Examples]:
--===== 1\. Generating Sample data (using rangeAB to create "dummy rows")
 -- The query below will generate 10,000 ids and random numbers between 50,000 and 500,000
 SELECT
   someId    = r.rn,
   someNumer = ABS(CHECKSUM(NEWID())%450000)+50001 
 FROM rangeAB(1,10000,1,1) r;

--===== 2\. Create a series of dates; rn is 0 to include the first date in the series
 DECLARE @startdate DATE = '20180101', @enddate DATE = '20180131';

 SELECT r.rn, calDate = DATEADD(dd, r.rn, @startdate)
 FROM dbo.rangeAB(1, DATEDIFF(dd,@startdate,@enddate),1,0) r;
 GO

--===== 3\. Splitting (tokenizing) a string with fixed sized items
 -- given a delimited string of identifiers that are always 7 characters long
 DECLARE @string VARCHAR(1000) = 'A601225,B435223,G008081,R678567';

 SELECT
   itemNumber = r.rn, -- item's ordinal position 
   itemIndex  = r.n1, -- item's position in the string (it's CHARINDEX value)
   item       = SUBSTRING(@string, r.n1, 7) -- item (token)
 FROM dbo.rangeAB(1, LEN(@string), 8,1)  r;
 GO

--===== 4\. Splitting (tokenizing) a string with random delimiters
 DECLARE @string VARCHAR(1000) = 'ABC123,999F,XX,9994443335';

 SELECT
   itemNumber = ROW_NUMBER() OVER (ORDER BY r.rn), -- item's ordinal position 
   itemIndex  = r.n1+1, -- item's position in the string (it's CHARINDEX value)
   item       = SUBSTRING
               (
                 @string,
                 r.n1+1,
                 ISNULL(NULLIF(CHARINDEX(',',@string,r.n1+1),0)-r.n1-1, 8000)
               ) -- item (token)
 FROM dbo.rangeAB(0,DATALENGTH(@string),1,1) r
 WHERE SUBSTRING(@string,r.n1,1) = ',' OR r.n1 = 0;
 -- logic borrowed from: http://www.sqlservercentral.com/articles/Tally+Table/72993/

--===== 5\. Grouping by a weekly intervals
 -- 5.1\. how to create a series of start/end dates between @startDate & @endDate
 DECLARE @startDate DATE = '1/1/2015', @endDate DATE = '2/1/2015';
 SELECT 
   WeekNbr   = r.RN,
   WeekStart = DATEADD(DAY,r.N1,@StartDate), 
   WeekEnd   = DATEADD(DAY,r.N2-1,@StartDate)
 FROM dbo.rangeAB(0,datediff(DAY,@StartDate,@EndDate),7,1) r;
 GO

 -- 5.2\. LEFT JOIN to the weekly interval table
 BEGIN
  DECLARE @startDate datetime = '1/1/2015', @endDate datetime = '2/1/2015';
  -- sample data 
  DECLARE @loans TABLE (loID INT, lockDate DATE);
  INSERT @loans SELECT r.rn, DATEADD(dd, ABS(CHECKSUM(NEWID())%32), @startDate)
  FROM dbo.rangeAB(1,50,1,1) r;

  -- solution 
  SELECT 
    WeekNbr   = r.RN,
    WeekStart = dt.WeekStart, 
    WeekEnd   = dt.WeekEnd,
    total     = COUNT(l.lockDate)
  FROM dbo.rangeAB(0,datediff(DAY,@StartDate,@EndDate),7,1) r
  CROSS APPLY (VALUES (
    CAST(DATEADD(DAY,r.N1,@StartDate) AS DATE), 
    CAST(DATEADD(DAY,r.N2-1,@StartDate) AS DATE))) dt(WeekStart,WeekEnd)
  LEFT JOIN @loans l ON l.lockDate BETWEEN  dt.WeekStart AND dt.WeekEnd
  GROUP BY r.RN, dt.WeekStart, dt.WeekEnd ;
 END;

--===== 6\. Identify the first vowel and last vowel in a along with their positions
 DECLARE @string VARCHAR(200) = 'This string has vowels';

 SELECT TOP(1) position = r.rn, letter = SUBSTRING(@string,r.rn,1)
 FROM dbo.rangeAB(1,LEN(@string),1,1) r
 WHERE SUBSTRING(@string,r.rn,1) LIKE '%[aeiou]%'
 ORDER BY r.rn;

 -- To avoid a sort in the execution plan we'll use op instead of rn
 SELECT TOP(1) position = r.op, letter = SUBSTRING(@string,r.op,1)
 FROM dbo.rangeAB(1,LEN(@string),1,1) r
 WHERE SUBSTRING(@string,r.rn,1) LIKE '%[aeiou]%'
 ORDER BY r.rn;

---------------------------------------------------------------------------------------
[Revision History]:
 Rev 00 - 20140518 - Initial Development - Alan Burstein
 Rev 01 - 20151029 - Added 65 rows to make L1=465; 465^3=100.5M. Updated comment section
                   - Alan Burstein
 Rev 02 - 20180613 - Complete re-design including opposite number column (op)
 Rev 03 - 20180920 - Added additional CROSS JOIN to L2 for 530B rows max - Alan Burstein
****************************************************************************************/
RETURNS TABLE WITH SCHEMABINDING AS RETURN
WITH L1(N) AS 
(
  SELECT 1
  FROM (VALUES
   (0),(0),(0),(0),(0),(0),(0),(0),(0),(0),(0),(0),(0),(0),(0),(0),(0),(0),(0),(0),(0),(0),
   (0),(0),(0),(0),(0),(0),(0),(0),(0),(0),(0),(0),(0),(0),(0),(0),(0),(0),(0),(0),(0),(0),
   (0),(0),(0),(0),(0),(0),(0),(0),(0),(0),(0),(0),(0),(0),(0),(0),(0),(0),(0),(0),(0),(0),
   (0),(0),(0),(0),(0),(0),(0),(0),(0),(0),(0),(0),(0),(0),(0),(0),(0),(0),(0),(0),(0),(0),
   (0),(0)) T(N) -- 90 values 
),
L2(N)  AS (SELECT 1 FROM L1 a CROSS JOIN L1 b CROSS JOIN L1 c),
iTally AS (SELECT rn = ROW_NUMBER() OVER (ORDER BY (SELECT 1)) FROM L2 a CROSS JOIN L2 b)
SELECT
  r.RN,
  r.OP,
  r.N1,
  r.N2
FROM
(
  SELECT
    RN = 0,
    OP = (@high-@low)/@gap,
    N1 = @low,
    N2 = @gap+@low
  WHERE @row1 = 0
  UNION ALL -- ISNULL required in the TOP statement below for error handling purposes
  SELECT TOP (ABS((ISNULL(@high,0)-ISNULL(@low,0))/ISNULL(@gap,0)+ISNULL(@row1,1)))
    RN = i.rn,
    OP = (@high-@low)/@gap+(2*@row1)-i.rn,
    N1 = (i.rn-@row1)*@gap+@low,
    N2 = (i.rn-(@row1-1))*@gap+@low
  FROM iTally AS i
  ORDER BY i.rn
) AS r
WHERE @high&@low&@gap&@row1 IS NOT NULL AND @high >= @low AND @gap > 0;
GO 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2016-02-29T19:30:27.817

我相信这种方法简化了其他人提出的许多其他想法。它使用按位算术以及带有`FOR XML`CTE 的技巧来生成二进制数字。

```
DECLARE @my_int INT = 5

;WITH CTE_Binary AS
(
    SELECT 1 AS seq, 1 AS val
    UNION ALL
    SELECT seq + 1 AS seq, power(2, seq)
    FROM CTE_Binary
    WHERE
        seq < 8
)
SELECT
(
    SELECT
        CAST(CASE WHEN B2.seq IS NOT NULL THEN 1 ELSE 0 END AS CHAR(1))
    FROM
        CTE_Binary B1
    LEFT OUTER JOIN CTE_Binary B2 ON
        B2.seq = B1.seq AND
        @my_int & B2.val = B2.val
    ORDER BY
        B1.seq DESC
    FOR XML PATH('')
) AS val 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2020-05-01T22:05:10.170

您可以使用递归 CTE 表来执行此操作。在此示例代码中，它设置为 16 位，但您可以通过更改 16-> 您的选择来设置任何长度。此外，您要转换的数据是表 DecimalTable

```
WITH DecimalTable AS (SELECT 10 decimal_num UNION SELECT 20),
     DtoB AS (SELECT decimal_num
                     ,1 n
                     ,CAST(CAST(decimal_num%2 AS bit) AS VARCHAR(16)) binary_num
               FROM DecimalTable 
               UNION ALL
               SELECT decimal_num
                     ,n*2 n
                     ,CAST(CONCAT(CAST(decimal_num&n as bit), binary_num)
                           AS VARCHAR(16)) binary_num
                FROM DtoB
                WHERE n<POWER(2,16))

    SELECT decimal_num, binary_num
    FROM DtoB 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2021-01-14T22:34:29.827

此函数是一个通用转换器，允许将整数转换为任何基本编号系统的字符串描述，如二进制、八进制、十六进制等。

```
-- specify a string and numbering system Base value, for example 16 for hexadecimal
CREATE FUNCTION udf_IntToBaseXStr(@baseVal BIGINT,
                                    @baseX   BIGINT)
returns VARCHAR(63)
AS
    BEGIN
        --bigint : -2^63 (-9,223,372,036,854,775,808) to 2^63-1 (9,223,372,036,854,775,807)  
        --         or 63 ones (1111111,11111111,11111111,11111111,11111111,11111111,11111111,11111111) in binary
        DECLARE @val BIGINT -- value from all
        DECLARE @cv BIGINT -- value from a single char
        DECLARE @baseStr VARCHAR(63)
        SET @baseStr = '';
        -- assumes a numbering method of 0123456789ABCDEF..... 
        SET @val = @baseVal
        WHILE ( @val > 0 )
            BEGIN
                SET @cv = @val % @basex -- calculate the right most char's value
                SET @baseStr = -- add it to (any existing) string
                CASE
                    WHEN @cv < 10 THEN Char(Ascii('0') + @cv)
                    ELSE Char(Ascii('A') + ( @cv - 10 ))
                END
                + @baseStr
                SET @val = ( @val - @cv ) / @basex
            END
        RETURN @baseStr
    END
GO 
```

如果您需要保证最小长度，则下一个函数包装上述函数，在前面加上一些零，强制返回的字符串为您想要的最小长度。它不会截断到指定的长度。

```
-- specify a string and numbering system Base value, for example, 16 for hexadecimal
-- prepends LEADING ZEROS to force length of returned string to be AT LEAST minLength chars
CREATE FUNCTION udf_IntToBaseXStr_MinLength(@baseVal   BIGINT,
                                            @baseX     BIGINT,
                                            @minLength INT)
returns VARCHAR(63)
AS
    BEGIN
        DECLARE @baseStr VARCHAR(63)
        SET @baseStr = dbo.udf_IntToBaseXStr(@baseVal, @baseX)
        IF Len(@baseStr) < @minLength
            SET @baseStr = Replicate('0', @minLength - Len(@baseStr))
                                         + @baseStr
        RETURN @baseStr
    END
GO 
```

udf_IntToBaseXStr 用法：

```
;with CTE as 
(
    SELECT BaseX = 2, AKA = 'binary' 
    UNION SELECT 8, 'octal' 
    UNION SELECT 10, 'decimal' 
    UNION SELECT 15, 'pentadecimal' 
    UNION SELECT 16, 'hexadecimal' 
)
SELECT BaseX, AKA, Result = dbo.udf_IntToBaseXStr(328239523, BaseX) FROM CTE 
```

udf_IntToBaseXStr 结果：

| BaseX | 又名 | 结果 |
| --- | --- | --- |
| 2 | 二进制 | 10011100100001000100110100011 |
| 8 | 八进制 | 2344104643 |
| 10 | 十进制 | 328239523 |
| 15 | 五进制 | 1DC3B24D |
| 16 | 十六进制 | 139089A3 |

udf_IntToBaseXStr_MinLength 用法：

```
;with CTE as 
(
    SELECT BaseX = 2, AKA = 'binary' 
    UNION SELECT 8, 'octal' 
    UNION SELECT 10, 'decimal' 
    UNION SELECT 15, 'pentadecimal' 
    UNION SELECT 16, 'hexadecimal' 
)
SELECT BaseX, AKA, Result = dbo.udf_IntToBaseXStr_MinLength(328239523, BaseX, 24) FROM CTE 
```

udf_IntToBaseXStr_MinLength 结果：

| BaseX | 又名 | 结果 |
| --- | --- | --- |
| 2 | 二进制 | 10011100100001000100110100011 |
| 8 | 八进制 | 000000000000002344104643 |
| 10 | 十进制 | 000000000000000328239523 |
| 15 | 五进制 | 00000000000000001DC3B24D |
| 16 | 十六进制 | 0000000000000000139089A3 |

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2021-05-19T17:02:13.857

想要轻松吗？做一些按位数学来映射出每个二进制数字。

```
CREATE FUNCTION dbo.BinaryRep (@val INT)
RETURNS VARCHAR(32)
WITH EXECUTE AS CALLER
AS

BEGIN
    DECLARE @ret VARCHAR(32)
    DECLARE @cnt INT = 30; -- 30 to 0 inclusive in loop

    -- handle negative (we're using signed magnitude because that's simple)
    SET @ret = IIF(@val < 0, '1', '0');
    SET @val = ABS(@val); -- totally cheating here.

    -- bitwise masking madness, one digit at a time.   
    WHILE @cnt > -1
    BEGIN
        SET @ret = CONCAT(@ret, IIF(@val & POWER(2, @cnt) = 0, 0, 1));
        SET @cnt = @cnt - 1;
    END;

    RETURN @ret;
END 
```

唯一的转折正是[康斯坦丁所说](https://stackoverflow.com/questions/127116/sql-server-convert-integer-to-binary-string/67607735#comment30757_127116)的：你喜欢你的底片吗？

这个版本便宜并使用有[符号的幅度](https://en.wikipedia.org/wiki/Signed_number_representations#Signed_magnitude_representation)，你只有第一个比特作为`1`底片，没有其他变化。`-123`并且`123`只有高位不同。

```
select dbo.BinaryRep(123) as plus, dbo.BinaryRep(-123) as minus

plus                             minus
-------------------------------- --------------------------------
00000000000000000000000001111011 10000000000000000000000001111011 
```

请注意，SQL Server`INT`支持 2 ^(-31)到 2 ^(31)，因此我们需要循环 31 次（包括 30 到 0），而不是 32。

* * *

## 回答 #15

> 赞同：-1
> 
> 时间：2021-06-24T15:39:11.643

为什么不简单...

```
declare @num int = 75

select
@num [Dec]
, convert (varchar(1), @num / 128 % 2)
+ convert (varchar(1), @num / 64 % 2)
+ convert (varchar(1), @num / 32 % 2)
+ convert (varchar(1), @num / 16 % 2)
+ convert (varchar(1), @num / 8 % 2)
+ convert (varchar(1), @num / 4 % 2)
+ convert (varchar(1), @num / 2 % 2)
+ convert (varchar(1), @num % 2) as [Bin] 
```

* * *

## 回答 #16

> 赞同：-3
> 
> 时间：2015-03-06T23:00:20.843

这个怎么样...

```
SELECT number_value
,MOD(number_value / 32768, 2) AS BIT15
,MOD(number_value / 16384, 2) AS BIT14
,MOD(number_value /  8192, 2) AS BIT13
,MOD(number_value /  4096, 2) AS BIT12
,MOD(number_value /  2048, 2) AS BIT11
,MOD(number_value /  1024, 2) AS BIT10
,MOD(number_value /   512, 2) AS BIT9 
,MOD(number_value /   256, 2) AS BIT8 
,MOD(number_value /   128, 2) AS BIT7 
,MOD(number_value /    64, 2) AS BIT6 
,MOD(number_value /    32, 2) AS BIT5 
,MOD(number_value /    16, 2) AS BIT4 
,MOD(number_value /     8, 2) AS BIT3 
,MOD(number_value /     4, 2) AS BIT2 
,MOD(number_value /     2, 2) AS BIT1 
,MOD(number_value      , 2) AS BIT0 
FROM your_table; 
```

# firebird - 如何在 Firebird SQL 中测试对象是否存在？

> ID：127118
> 
> 赞同：8
> 
> 时间：2008-09-24T13:28:07.693
> 
> 标签：firebird

我需要测试给定数据库中是否存在各种类型的数据库对象，我不知道如何在 Firebird SQL 中制定这些测试。每个测试的格式为“是否存在名为*Y的类型**X*的对象？”。例如，我需要测试是否存在具有给定名称的表。我需要测试的对象类型是：

 **   桌子
*   看法
*   领域
*   扳机
*   程序
*   例外
*   产生
*   UDF
*   角色

可以在 Internet 上找到如何查询给定表的方法，但其他类型更难找到...

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-09-24T13:33:32.250

我认为您所问的很多内容都可以在[此论坛帖子](http://dn.codegear.com/article/25259)中找到。如果你想深入一点，[这个网站](http://www.felix-colibri.com/papers/db/interbase/using_interbase_system_tables/using_interbase_system_tables.html)似乎有表格的图形表示。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-24T13:33:28.023

您似乎需要查询系统表才能可靠地获取该信息。这是一个看起来可以提供帮助的教程：

[http://www.alberton.info/firebird_sql_meta_info.html](http://www.alberton.info/firebird_sql_meta_info.html)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-13T20:37:44.873

每年，Martijn Tonies 都会在 Firebird Conference 上开会

所以在 2005 年的时间表中找到 [http://www.ibphoenix.com/main.nfs?a=ibphoenix&page=fb_conf_timetable_2005](http://www.ibphoenix.com/main.nfs?a=ibphoenix&page=fb_conf_timetable_2005)

2006 年 [http://www.ibphoenix.com/main.nfs?a=ibphoenix&page=fb_conf_timetable_2006](http://www.ibphoenix.com/main.nfs?a=ibphoenix&page=fb_conf_timetable_2006)

还有 2007 年和 2008 年的

[http://www.firebirdconference.net/index.php?option=com_content&view=article&id=3&Itemid=3](http://www.firebirdconference.net/index.php?option=com_content&view=article&id=3&Itemid=3)

但是不知道在哪里下载论文

# windows - 将 Windows 设备路径解析为驱动器号

> ID：127124
> 
> 赞同：13
> 
> 时间：2008-09-24T13:28:51.013
> 
> 标签：windows, path, device

你如何解析一个 NT 风格的设备路径，例如`\Device\CdRom0`，到它的逻辑驱动器号，例如`G:\`？

编辑：卷名与设备路径不同，因此很遗憾`GetVolumePathNamesForVolumeName()`不起作用。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-25T08:02:45.797

希望下面的代码足以解决这个问题——在你初始化它之后，你只需要遍历集合来找到你的匹配项。您可能希望在插入集合之前将所有内容转换为大写/小写，以帮助提高查找性能。

```
typedef basic_string<TCHAR> tstring;
typedef map<tstring, tstring> HardDiskCollection;

void Initialise( HardDiskCollection &_hardDiskCollection )
{
    TCHAR tszLinkName[MAX_PATH] = { 0 };
    TCHAR tszDevName[MAX_PATH] = { 0 };
    TCHAR tcDrive = 0;

    _tcscpy_s( tszLinkName, MAX_PATH, _T("a:") );
    for ( tcDrive = _T('a'); tcDrive < _T('z'); ++tcDrive )
    {
        tszLinkName[0] = tcDrive;
        if ( QueryDosDevice( tszLinkName, tszDevName, MAX_PATH ) )
        {
            _hardDiskCollection.insert( pair<tstring, tstring>( tszLinkName, tszDevName ) );
        }
    }
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-24T13:35:39.407

也许您可以使用 GetVolumeNameForMountPoint 并遍历所有挂载点 A:\ 到 Z:\，找到匹配项时中断？

[http://msdn.microsoft.com/en-us/library/aa364994(VS.85).aspx](http://msdn.microsoft.com/en-us/library/aa364994(VS.85).aspx)

（这个我没试过）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2016-07-06T19:14:09.543

以下函数仅使用 C 完成工作

```
BOOL GetWin32FileName(const TCHAR* pszNativeFileName, TCHAR *pszWin32FileName)
{
    BOOL bFound = FALSE;

    // Translate path with device name to drive letters.
    TCHAR szTemp[MAX_PATH];
    szTemp[0] = '\0';

    if (GetLogicalDriveStrings(MAX_PATH - 1, szTemp))
    {
        TCHAR szName[MAX_PATH];
        TCHAR szDrive[3] = TEXT(" :");
        TCHAR* p = szTemp;

        do
        {
            // Copy the drive letter to the template string
            *szDrive = *p;

            // Look up each device name
            if (QueryDosDevice(szDrive, szName, MAX_PATH))
            {
                size_t uNameLen = _tcslen(szName);

                if (uNameLen < MAX_PATH)
                {
                    bFound = _tcsnicmp(pszNativeFileName, szName, uNameLen) == 0
                        && *(pszNativeFileName + uNameLen) == _T('\\');

                    if (bFound)
                    {
                        // Replace device path with DOS path
                        StringCchPrintf(pszWin32FileName,
                            MAX_PATH,
                            TEXT("%s%s"),
                            szDrive,
                            pszNativeFileName + uNameLen);
                    }
                }
            }
            // Go to the next NULL character.
            while (*p++);
        } while (!bFound && *p);
    }

    return(bFound);
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2018-07-17T02:38:22.240

您可以查找所有卷的名称以匹配设备名称并获取驱动器号。这是一个示例：

```
int DeviceNameToVolumePathName(WCHAR *filepath) {
    WCHAR fileDevName[MAX_PATH];
    WCHAR devName[MAX_PATH];
    WCHAR fileName[MAX_PATH];
    HANDLE FindHandle = INVALID_HANDLE_VALUE;
    WCHAR  VolumeName[MAX_PATH];
    DWORD  Error = ERROR_SUCCESS;
    size_t Index = 0;
    DWORD  CharCount = MAX_PATH + 1;

    int index = 0;
    // \Device\HarddiskVolume1\windows,locate \windows.
    for (int i = 0; i < lstrlenW(filepath); i++) {
        if (!memcmp(&filepath[i], L"\\", 2)) {
            index++;
            if (index == 3) {
                index = i;
                break;
            }
        }
    }
    filepath[index] = L'\0';

    memcpy(fileDevName, filepath, (index + 1) * sizeof(WCHAR));

    FindHandle = FindFirstVolumeW(VolumeName, ARRAYSIZE(VolumeName));

    if (FindHandle == INVALID_HANDLE_VALUE)
    {
        Error = GetLastError();
        wprintf(L"FindFirstVolumeW failed with error code %d\n", Error);
        return FALSE;
    }
    for (;;)
    {
        //  Skip the \\?\ prefix and remove the trailing backslash.
        Index = wcslen(VolumeName) - 1;

        if (VolumeName[0] != L'\\' ||
            VolumeName[1] != L'\\' ||
            VolumeName[2] != L'?' ||
            VolumeName[3] != L'\\' ||
            VolumeName[Index] != L'\\')
        {
            Error = ERROR_BAD_PATHNAME;
            wprintf(L"FindFirstVolumeW/FindNextVolumeW returned a bad path: %s\n", VolumeName);
            break;
        }
        VolumeName[Index] = L'\0';
        CharCount = QueryDosDeviceW(&VolumeName[4], devName, 100);
        if (CharCount == 0)
        {
            Error = GetLastError();
            wprintf(L"QueryDosDeviceW failed with error code %d\n", Error);
            break;
        }
        if (!lstrcmpW(devName, filepath)) {
            VolumeName[Index] = L'\\';
            Error = GetVolumePathNamesForVolumeNameW(VolumeName, fileName, CharCount, &CharCount);
            if (!Error) {
                Error = GetLastError();
                wprintf(L"GetVolumePathNamesForVolumeNameW failed with error code %d\n", Error);
                break;
            }

            // concat drive letter to path
            lstrcatW(fileName, &filepath[index + 1]);
            lstrcpyW(filepath, fileName);

            Error = ERROR_SUCCESS;
            break;
        }

        Error = FindNextVolumeW(FindHandle, VolumeName, ARRAYSIZE(VolumeName));

        if (!Error)
        {
            Error = GetLastError();

            if (Error != ERROR_NO_MORE_FILES)
            {
                wprintf(L"FindNextVolumeW failed with error code %d\n", Error);
                break;
            }

            //
            //  Finished iterating
            //  through all the volumes.
            Error = ERROR_BAD_PATHNAME;
            break;
        }
    }

    FindVolumeClose(FindHandle);
    if (Error != ERROR_SUCCESS)
        return FALSE;
    return TRUE;

} 
```

如果您想在驱动程序中解决它，您可以查看此[链接](https://github.com/JKornev/hidden/blob/master/Hidden/Helper.c)以供参考。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2020-01-25T10:25:43.080

这是解决方案的重构版本。

我用 wchar_t 替换了 TChAR，因为在大多数项目中使用它并不是一个好主意。

```
std::map<std::wstring, std::wstring> GetDosPathDevicePathMap()
{
    // It's not really related to MAX_PATH, but I guess it should be enough.
    // Though the docs say "The first null-terminated string stored into the buffer is the current mapping for the device.
    //                      The other null-terminated strings represent undeleted prior mappings for the device."
    wchar_t devicePath[MAX_PATH] = { 0 };
    std::map<std::wstring, std::wstring> result;
    std::wstring dosPath = L"A:";

    for (wchar_t letter = L'A'; letter <= L'Z'; ++letter)
    {
        dosPath[0] = letter;
        if (QueryDosDeviceW(dosPath.c_str(), devicePath, MAX_PATH)) // may want to properly handle errors instead ... e.g. check ERROR_INSUFFICIENT_BUFFER
        {
            result[dosPath] = devicePath;
        }
    }
    return result;
} 
```

# r - R 的示例代码？

> ID：127137
> 
> 赞同：24
> 
> 时间：2008-09-24T13:31:07.500
> 
> 标签：r

有谁知道一个很好的在线资源，例如 R 代码？

这些程序不必为了说明目的而编写，我真的只是在寻找一些已经编写了一堆 R 代码的地方，以便让我了解该语言的语法和功能？

**编辑：**我已阅读主站点上的基本文档，但想知道是否有一些代码示例甚至程序显示了不同人如何使用 R。

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-09-24T13:33:48.897

为什么不查看文档下的[www.r-project.org](http://www.r-project.org)并至少阅读介绍？该语言与您习惯使用的语言有很大不同，仅查看代码示例不足以让您掌握它。（至少，不会超出基本的类似计算器的功能。）

如果你想更深入一点，你可能想看看[CRAN](http://cran.r-project.org)：一个带有源代码的 R 模块的在线集合：[cran.r-project.org](http://cran.r-project.org)

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2008-11-24T15:01:37.363

我刚刚发现了这个问题，并认为我会向它添加一些资源。我真的很喜欢 Quick-R 网站：

[http://www.statmethods.net/](http://www.statmethods.net/)

如果您来自 SAS 或 SPSS，Muenchen 写了一本关于使用 R 的书。最初，Springer 鼓励他制作一本 400 多页的书，这是一份 80 页的在线文档。原始的简短形式以及这本书在这里：

[http://rforsasandspssusers.com/](http://rforsasandspssusers.com/)

您可能已经看过这些，但值得列出： http: [//cran.r-project.org/doc/manuals/R-intro.pdf](http://cran.r-project.org/doc/manuals/R-intro.pdf) [http://cran.r-project.org/doc/contrib/Owen -TheRGuide.pdf](http://cran.r-project.org/doc/contrib/Owen-TheRGuide.pdf) [http://cran.r-project.org/doc/contrib/Kuhnert+Venables-R_Course_Notes.zip](http://cran.r-project.org/doc/contrib/Kuhnert+Venables-R_Course_Notes.zip)

我不想听起来像一个陈词滥调的 RTFM 人，但帮助文件通常有很短的工作代码片段作为示例。我不是 R 专业人士，所以我最终不得不解构这些例子来理解它们。这个过程虽然乏味，但非常有用。

祝你好运！

**编辑：**好吧，我犹豫要不要自我链接（感觉有点自慰），但这是我自己的 R 资源列表，每个资源都有描述和评论：[http ://www.cerebralmastication.com/?page_id=62](http://www.cerebralmastication.com/?page_id=62)

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2008-09-26T19:51:12.753

**[Rosetta Code](http://www.rosettacode.org/wiki/Category:R)**项目展示了 R 与其他语言的比较 。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2008-09-25T11:45:38.337

[克兰](http://cran.r-project.org/)怎么样？您有超过一千个代码包可供选择。

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2008-09-25T13:14:20.930

查看代码的最简单方法是

1.  安装 R
2.  键入“help.start()”或查看在线文档，以获取函数名称
3.  在提示符处输入函数名称

这将在提示符处打印源代码，并说明各种奇怪而有趣的语法角落。

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2009-07-26T09:29:21.580

[Learning R](http://learnr.wordpress.com/)博客有很多很好的例子。最近，作者一直在做一个可视化系列，比较 Lattice 和 ggplot2。

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2009-02-22T04:49:50.640

google 很难`r`，因为名字太短了。试试[http://rseek.org/](http://rseek.org/)，它提供了一个 r 自定义的 Google 搜索。搜索示例、存储库中的代码等。

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2009-03-26T18:03:47.813

一些简单的例子可以在[Mathesaurus](http://mathesaurus.sourceforge.net/)上找到——如果你知道 Python 或 Matlab，请查看相应的比较图表以找到与你熟悉的其他语言习语相对应的 R 习语。

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2009-05-04T20:36:26.853

我使用[R Graph Gallery](http://addictedtor.free.fr/graphiques/)。它对绘图本身有很大帮助。很多很好的例子。

Freenode 上的#R 也非常有用。

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2009-07-23T21:24:48.563

[http://had.co.nz/ggplot2/](http://had.co.nz/ggplot2/)有很多带有示例代码的图形。您只需要一个包即可创建几乎所有您需要的图表。

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2009-07-26T21:14:15.140

还有正在缓慢增长的[**R Wiki 。**](http://wiki.r-project.org/rwiki/doku.php)

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2008-09-24T13:37:30.917

您可能知道，R 和 S 非常相似（除了成本！）。

我以前都用过，我强烈推荐[S Poetry](http://www.burns-stat.com/pages/spoetry.html)。

我还可以强烈推荐[MJ Crawley](http://www.amazon.co.uk/Statistics-Introduction-Michael-J-Crawley/dp/0470022981/ref=sr_1_8?ie=UTF8&s=books&qid=1222263584&sr=8-8)的书，以及较短的[Venables & Ripley](http://www.amazon.co.uk/Programming-Statistics-Computing-W-N-Venables/dp/0387989668/ref=sr_1_1?ie=UTF8&s=books&qid=1222263649&sr=1-1)书。

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2010-02-18T18:44:50.293

[这](http://www.linkedin.com/groupAnswers?viewQuestionAndAnswers=&gid=77616&discussionID=10138417&sik=1266518565780&trk=ug_qa_q&goback=%2Eanh_77616%2Eana_77616_1266518565780_3_1)是 Linkedin 上 R 项目组的链接。我把这个链接列表放在一起，很多人发现它很有用（有些人还做了非常有用的补充）

* * *

## 回答 #14

> 赞同：3
> 
> 时间：2010-08-05T16:52:40.567

通过命令“lang:r”和您的关键字使用[Google 代码搜索](http://www.google.com/codesearch)

* * *

## 回答 #15

> 赞同：-1
> 
> 时间：2008-09-24T13:38:20.883

[http://www.climateaudit.org/](http://www.climateaudit.org/)上的Steve McIntyre是 R 的忠实粉丝，并且经常发布工作代码。

有一个[scripts类](http://www.climateaudit.org/?cat=57)，[Statistics和R](http://www.climateaudit.org/?page_id=372)列出了一些其他的资源

# internationalization - 是否可以创建国际永久链接？

> ID：127144
> 
> 赞同：3
> 
> 时间：2008-09-24T13:33:19.630
> 
> 标签：internationalization, permalinks

我想知道您如何处理国际网站上的永久链接。永久链接是指一些独特且人类可读的链接。

例如，对于英语短语，它没有问题，例如**/product/some-title/**

但是如果产品标题是中文的，你会怎么做？你如何处理这个问题？

我正在实施一个国际站点，其中一项要求是具有人类可读的 URL。感谢您的每一条评论

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-24T13:57:26.313

[根据此规范](http://www.w3.org/Addressing/URL/uri-spec.html)，在 URL 中不允许使用 ISO Latin-1 集之外的字符，因此中文字符串将立即被淘汰。

在产品名称可以本地化的地方，您可以使用 url `<DOMAIN>/<LANGUAGE>/DIR/<PRODUCT_TRANSLATED>`，例如：

```
http://www.example.com/en/products/cat/
http://www.example.com/fr/products/chat/ 
```

伴随着一个[mod_rewrite](http://www.htmlist.com/how-to/a-simplemod_rewrite-tutorial/)规则，效果如下：

```
RewriteRule ^([a-z]+)/product/([a-z]+)? product_lookup.php?lang=$1&product=$2 
```

对于上面的第一个示例，此规则将调用. 在此脚本中，您可以访问内部翻译引擎（在这种情况下，从参数）进行与在面向用户的一侧所做的相同的翻译，例如翻译法语页面上的“Chat”，“Cat”关于英语等`product_lookup.php?lang=**en**&product=**cat**``lang`**`en`**

使用外部翻译 API 将是一个好主意，但要获得一个在您的业务领域中正常工作的可靠 API 会很棘手。谷歌已经开放了[翻译 API](http://research.google.com/university/translate/)，但目前只支持有限数量的语言。

> *   英语 <=> 阿拉伯语
> *   英文<=>中文
> *   英语 <=> 俄语

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-24T16:01:04.753

我通常音译非ASCII字符。例如“täst”会变成“taest”。GNU iconv 可以为您做到这一点（我确定还有其他库）：

```
$ echo täst | iconv -t 'ascii//translit'
taest 
```

唉，这些音译取决于语言环境：例如，在德语以外的语言中，“ä”可以简单地音译为“a”。但另一方面，每个（常用）字符集都应该有一个音译为 ASCII。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-24T18:54:49.233

看看[维基百科](http://wikipedia.org/)。他们在 URL 中使用国家字符。

例如，俄语主页 URL 是：[http](http://ru.wikipedia.org/wiki/%D0%97%D0%B0%D0%B3%D0%BB%D0%B0%D0%B2%D0%BD%D0%B0%D1%8F_%D1%81%D1%82%D1%80%D0%B0%D0%BD%D0%B8%D1%86%D0%B0) ://ru.wikipedia.org/wiki/Заглавная_страница 。浏览器对所有非 ASCII 字符进行透明编码，并在向服务器发送 URL 时将其替换为它们的代码。但在网页上，所有 URL 都是人类可读的。

所以你不需要做任何特别的事情——只需将你的产品名称原样放入 URL 中。网络服务器应该能够为您的应用程序自动解码它们。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-24T13:58:47.557

像 /productid/{product-id-number}/some-title/ 这样的方案怎么样，网站查看 {number} 并完全忽略“some-title”部分。您可以将其放入您喜欢的任何语言或编码中，因为它没有被使用。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-24T13:38:57.463

如果没记错的话，您只能在 URL 中使用英文字母。有一个讨论要改变它，但我相当肯定它尚未实施。

也就是说，您需要有一个查找表，您可以在其中将产品/标题的翻译分配为其他语言中的任何单词。例如：

foo.com/cat 需要翻译查找“cat”“gato”“neko”等。

然后，将那些人类阅读对象解析为精确 url 的 HTTP 模块将根据翻译知道要提供哪个页面。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-24T13:48:30.407

为这样的事情创建一个查找对我来说似乎是一种溢出。我无法为所有语言中的所有不同单词创建查找。也许访问翻译 API 是个好主意。

据我所知，由于 URL 的规范不允许，因此无法在永久链接中使用外来字符。

您如何看待对特殊字符进行编码？那么这些 URL 会被 Google 识别吗？

# testing - QTP_errObject CaptureBitmap

> ID：127150
> 
> 赞同：1
> 
> 时间：2008-09-24T13:34:43.997
> 
> 标签：testing, qa, qtp

我可以请您澄清我对 QTP err 对象的问题。

我正在尝试捕获发生错误的对象的屏幕截图。我使用代码`object.captureBitmap(filename)`来实现这一点。

我想知道是否可以在突出显示 err 对象的情况下获取整个页面的屏幕截图。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-24T19:47:37.860

你可以在你的结果文件中得到它。转到工具-> 选项并选择运行选项卡。选中“将静止图像捕获到结果”框并选择始终或错误。当您运行测试时，它将显示全屏并突出显示有问题的对象（如果可以找到）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-07-30T13:50:37.937

（如果我的回复还不算太晚）

对问题对象和对象的父对象都使用 CaptureBitmap 方法。然后您可以使用自动生成的简单 html 页面以多种方式显示它。

阿尔伯特

# algorithm - 如何确定两个数据列表的差异

> ID：127151
> 
> 赞同：4
> 
> 时间：2008-09-24T13:34:44.667
> 
> 标签：algorithm, list, diff, edit-distance

这是一个让 CS 家伙用理论大放异彩的练习。

想象一下，您有 2 个带有元素的容器。文件夹、URL、文件、字符串，真的没关系。

什么是计算添加和删除的算法？

**注意**：如果有很多方法可以解决这个问题，请每个答案发布一个，以便分析和投票。

**编辑**：所有答案都用 4 个容器解决了这个问题。是否可以只使用最初的 2？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-24T13:46:33.187

假设您有两个唯一项目列表，并且顺序无关紧要，您可以将它们都视为集合而不是列表

如果你想到一个维恩图，列表 A 是一个圆圈，列表 B 是另一个圆圈，那么这两者的交集就是常量池。

从 A 和 B 中删除该交集的所有元素，并且 A 中剩余的所有元素都已删除，而 B 中剩余的所有元素都已添加。

因此，遍历 A 以查找 B 中的每个项目。如果找到，请将其从 A 和 B 中删除

那么A是被删除的东西的列表，B是被添加的东西的列表

我认为...

[编辑] 好的，有了新的“只有 2 个容器”限制，同样的情况仍然成立：

```
foreach( A ) { 
  if( eleA NOT IN B ) {
    DELETED
  }
}
foreach( B ) {
  if( eleB NOT IN A ) {
    ADDED
  }
} 
```

然后你不会构建一个新列表，或者破坏你的旧列表......但是与前面的例子一样，它会花费更长的时间，你可以循环较短的列表并从较长的列表中删除元素。在这里你需要做两个列表

我认为我的第一个解决方案没有使用 4 个容器，它只是破坏了两个 ;-)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-24T13:43:34.007

我有一段时间没有这样做了，但我相信算法是这样的......

```
sort left-list and right-list
adds = {}
deletes = {}
get first right-item from right-list
get first left-item from left-list
while (either list has items)
  if left-item < right-item or right-list is empty
    add left-item to deletes
    get new left-item from left-list
  else if left-item > right-item or left-list is empty
    add right-item to adds
    get new right-item from right-list
  else
    get new right-item from right-list
    get new left-item from left-list 
```

关于右列表与左列表的关系，*删除*包含删除的项目，*添加*现在包含新项目。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-24T13:47:08.693

乔说的。而且，如果列表太大而无法放入内存，请使用外部文件排序实用程序或合并排序。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-24T14:09:40.370

缺失信息：您如何定义添加/删除？例如，如果列表（A 和 B）在服务器 A 和服务器 B 上显示相同的目录，则表示同步。如果我现在等待 10 天，再次生成列表并比较它们，我如何判断是否已删除某些内容？我不能。我只能说在服务器 B 上找不到服务器 A 上的文件和/或相反。这是因为文件已添加到服务器 A（因此在 B 上找不到文件）还是在服务器 B 上删除了文件（因此**不再**在 B 上找到文件）是我无法确定的文件名列表。

对于我建议的解决方案，我将假设您有一个名为 OLD 的列表和一个名为 NEW 的列表。在 OLD 上找到但在 NEW 上找不到的所有内容都已删除。在 NEW 上找到的所有内容，但在 OLD 上没有的内容都已添加（例如，同一服务器上同一目录的内容，但列表已在不同日期创建）。

此外，我将假设没有重复项。这意味着任一列表中的每个项目在以下意义上都是独一无二的：如果我将此项目与列表中的任何其他项目进行比较（无论此比较如何进行），我总是可以说该项目*小于*或*大于*我的那个'正在比较它，但永远不会相等。例如，在处理字符串时，我可以按字典顺序比较它们，并且相同的字符串在列表中永远不会出现两次。

在这种情况下，最简单（但不一定是最佳解决方案）是：

1.  对旧列表进行排序。例如，如果列表由字符串组成，则按字母顺序对它们进行排序。排序是必要的，因为这意味着我可以使用二进制搜索在列表中快速找到一个对象，假设它确实存在于列表中（或者快速确定它根本不存在于列表中）。如果列表未排序，则查找对象的复杂度为 O(n)（我需要查看列表中的每一项）。如果列表已排序，复杂度仅为 O(log n)，因为每次尝试匹配列表中的项目后，我总是可以排除列表中不匹配的 50% 的项目。即使列表有 100 个项目，找到一个项目（或检测该项目不在列表中）最多需要 7 次测试（或者是 8 次？反正远少于 100 次）。*新列表不必排序。*

2.  现在我们执行列表消除。对于 NEW 列表中的每个项目，尝试在 OLD 列表中找到该项目（使用二进制搜索）。如果找到该项目，则将该项目从 OLD 列表中**删除**，并将其从 NEW 列表中删除。这也意味着列表会随着消除的进行而变得更小，因此查找将变得越来越快。由于从 a 列表中删除一个项目对列表的正确排序顺序没有影响，因此在消除阶段没有必要使用 OLD 列表。

3.  在消除结束时，两个列表可能都是空的，在这种情况下它们是相等的。如果它们不为空，则仍在 OLD 列表中的所有项目都是 NEW 列表中缺少的项目（否则我们已将其删除），因此这些是已*删除的项目*。仍然在 NEW 列表中的所有项目都是不在 OLD 列表中的项目（同样，我们已经删除了它们），因此这些是*添加的项目*。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-24T14:13:00.223

列表中的对象是否“唯一”？在这种情况下，我将首先构建两个映射（哈希映射），然后扫描列表并查找映射中的每个对象。

```
map1
map2
removedElements
addedElements

list1.each |item|
{
    map1.add(item)
}
list2.each |item|
{
    map2.add(item)
}
list1.each |item|
{
    removedElements.add(item) unless map2.contains?(item)
}
list2.each |item|
{
    addedElements.add(item) unless map1.contains?(item)
} 
```

很抱歉混合了 Ruby 和 Java 的可怕元语言：-P

最后**removedElements**将包含属于list1 的元素，但不包含属于list2 的元素，并且**addedElements**将包含属于list2 的元素。

整个操作的成本是 O(4*N)，因为在地图/字典中的查找可能被认为是恒定的。另一方面，线性/二进制搜索列表中的每个元素将使 O(N^2)。

**编辑**：再三考虑将最后一个检查移到第二个循环中，您可以删除其中一个循环......但这很难看...... :)

```
list1.each |item|
{
    map1.add(item)
}
list2.each |item|
{
    map2.add(item)
    addedElements.add(item) unless map1.contains?(item)
}
list1.each |item|
{
    removedElements.add(item) unless map2.contains?(item)
} 
```

# sql-server-2005 - 如何将慢速参数化插入更改为快速批量复制（甚至从内存中）

> ID：127152
> 
> 赞同：3
> 
> 时间：2008-09-24T13:34:44.977
> 
> 标签：sql-server-2005, insert, copy, performance, bulk

我的代码中有这样的东西（.Net 2.0，MS SQL）

```
SqlConnection connection = new SqlConnection(@"Data Source=localhost;Initial
Catalog=DataBase;Integrated Security=True");
  connection.Open();

  SqlCommand cmdInsert = connection.CreateCommand();
  SqlTransaction sqlTran = connection.BeginTransaction();
  cmdInsert.Transaction = sqlTran;

  cmdInsert.CommandText =
     @"INSERT INTO MyDestinationTable" +
      "(Year, Month, Day, Hour,  ...) " +
      "VALUES " +
      "(@Year, @Month, @Day, @Hour, ...) ";

  cmdInsert.Parameters.Add("@Year", SqlDbType.SmallInt);
  cmdInsert.Parameters.Add("@Month", SqlDbType.TinyInt);
  cmdInsert.Parameters.Add("@Day", SqlDbType.TinyInt);
  // more fields here
  cmdInsert.Prepare();

  Stream stream = new FileStream(fileName, FileMode.Open, FileAccess.Read);

  StreamReader reader = new StreamReader(stream);
  char[] delimeter = new char[] {' '};
  String[] records;
  while (!reader.EndOfStream)
  {
    records = reader.ReadLine().Split(delimeter, StringSplitOptions.None);

    cmdInsert.Parameters["@Year"].Value = Int32.Parse(records[0].Substring(0, 4));
    cmdInsert.Parameters["@Month"].Value = Int32.Parse(records[0].Substring(5, 2));
    cmdInsert.Parameters["@Day"].Value = Int32.Parse(records[0].Substring(8, 2));
    // more here complicated stuff here
    cmdInsert.ExecuteNonQuery()
  }
  sqlTran.Commit();
  connection.Close(); 
```

使用*cmdInsert.ExecuteNonQuery()*注释掉此代码将在 2 秒内执行。使用 SQL 执行需要 1m 20 秒。大约有 50 万条记录。表之前是空的。类似功能的 SSIS 数据流任务大约需要 20 秒。

*   批量插入**不是**一种选择（见下文）。我在这次导入期间做了一些花哨的事情。
*   我的测试机器是带有 2 GB RAM 的 Core 2 Duo。
*   在任务管理器中查看 CPU 时未完全处理。IO 似乎也没有被充分利用。
*   Schema 简单得像地狱：一张以 AutoInt 作为主索引且少于 10 个整数、小整数和字符（10）的表。

在这里得到一些答案后，我发现可以**从内存中执行批量复制**！我拒绝使用批量复制，因为我认为必须从文件中完成...

现在我使用它，它需要大约 20 秒（如 SSIS 任务）

```
 DataTable dataTable = new DataTable();

  dataTable.Columns.Add(new DataColumn("ixMyIndex", System.Type.GetType("System.Int32")));   
  dataTable.Columns.Add(new DataColumn("Year", System.Type.GetType("System.Int32")));   
  dataTable.Columns.Add(new DataColumn("Month", System.Type.GetType("System.Int32")));
  dataTable.Columns.Add(new DataColumn("Day", System.Type.GetType("System.Int32")));
 // ... and more to go

  DataRow dataRow;
  object[] objectRow = new object[dataTable.Columns.Count];

  Stream stream = new FileStream(fileName, FileMode.Open, FileAccess.Read);

  StreamReader reader = new StreamReader(stream);
  char[] delimeter = new char[] { ' ' };
  String[] records;
  int recordCount = 0;
  while (!reader.EndOfStream)
  {
    records = reader.ReadLine().Split(delimeter, StringSplitOptions.None);

    dataRow = dataTable.NewRow();
    objectRow[0] = null; 
    objectRow[1] = Int32.Parse(records[0].Substring(0, 4));
    objectRow[2] = Int32.Parse(records[0].Substring(5, 2));
    objectRow[3] = Int32.Parse(records[0].Substring(8, 2));
    // my fancy stuf goes here

    dataRow.ItemArray = objectRow;         
    dataTable.Rows.Add(dataRow);

    recordCount++;
  }

  SqlBulkCopy bulkTask = new SqlBulkCopy(connection, SqlBulkCopyOptions.TableLock, null);
  bulkTask.DestinationTableName = "MyDestinationTable"; 
  bulkTask.BatchSize = dataTable.Rows.Count;
  bulkTask.WriteToServer(dataTable);
  bulkTask.Close(); 
```

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-09-24T14:43:56.123

[尝试使用SqlBulkCopy](http://msdn.microsoft.com/en-us/library/system.data.sqlclient.sqlbulkcopy.aspx)类一次批量插入所有记录，而不是单独插入每条记录。

创建一个 DataTable 并将所有记录添加到 DataTable，然后使用[SqlBulkCopy](http://msdn.microsoft.com/en-us/library/system.data.sqlclient.sqlbulkcopy.aspx)。[WriteToServer](http://msdn.microsoft.com/en-us/library/ex21zs8x.aspx)一次批量插入所有数据。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-24T13:38:10.913

是否需要交易？使用事务比简单的命令需要更多的资源。

此外，如果您确定插入的值是正确的，则可以使用 BulkInsert。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-24T13:38:24.360

对于 50 万条记录来说，1 分钟听起来很合理。这是每 0.00012 秒的记录。

该表是否有任何索引？如果可以选择，删除这些并在批量插入后重新应用它们将提高插入的性能。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-24T13:40:29.147

每秒处理 8,333 条记录对我来说似乎不是不合理的……您期望什么样的吞吐量？

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-24T13:41:03.060

如果您需要更快的速度，您可以考虑实现批量插入：

[http://msdn.microsoft.com/en-us/library/ms188365.aspx](http://msdn.microsoft.com/en-us/library/ms188365.aspx)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-24T14:54:54.163

如果不能选择某种形式的批量插入，另一种方法是多线程，每个线程都有自己的数据库连接。

当前系统的问题是您有 500,000 次往返数据库，并且在开始下一次之前等待第一次往返完成 - 任何类型的延迟（即机器之间的网络）都意味着大部分你的时间都花在等待上。

如果您可以拆分工作，也许使用某种形式的生产者/消费者设置，您可能会发现您可以更多地利用所有资源。

但是，要做到这一点，您将不得不丢失一个大事务 - 否则第一个写入线程将阻塞所有其他线程，直到其事务完成。您仍然可以使用交易，但您必须使用很多小交易而不是 1 个大交易。

SSIS 会很快，因为它使用批量插入方法 - 首先进行所有复杂的处理，生成要插入的最终数据列表，并同时将所有数据提供给批量插入。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-24T13:41:21.420

我假设大约需要 58 秒的是 500,000 条记录的物理插入 - 所以你每秒插入大约 10,000 条。在不知道您的数据库服务器机器的规格的情况下（我看到您使用的是 localhost，因此网络延迟应该不是问题），很难说这是好、坏还是糟糕透顶。

我会查看您的数据库架构 - 表上是否有一堆索引必须在每次插入后更新？这可能来自其他具有引用您正在处理的表的外键的表。SQL Server 中内置了 SQL 分析工具和性能监控工具，但我从未使用过它们。但它们可能会出现诸如锁之类的问题。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-24T13:53:33.233

首先在所有记录上对数据做一些花哨的事情。然后批量插入它们。

（因为你没有在插入之后进行选择..我没有看到在 BulkInsert 之前对数据应用所有操作的问题

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-24T13:53:54.590

如果我不得不猜测，我首先要查找的是 tbTrafficLogTTL 表上的索引太多或类型错误。如果不查看表的架构定义，我真的不能说，但是在以下情况下我遇到了类似的性能问题：

1.  主键是 GUID，主索引是 CLUSTERED。
2.  一组字段上有某种 UNIQUE 索引。
3.  表上的索引太多。

当您开始索引 50 万行数据时，创建和维护索引所花费的时间就会增加。

我还要注意，如果您可以选择将年、月、日、小时、分钟、秒字段转换为单个 datetime2 或时间戳字段，您应该这样做。你为你的数据架构增加了很多复杂性，没有任何收获。我什至考虑使用这样的拆分字段结构的唯一原因是，如果您正在处理因任何原因无法更改的预先存在的数据库模式。在这种情况下，做你很糟糕。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-24T13:58:46.933

我在上一份合同中遇到了类似的问题。您正在执行 500,000 次 SQL 访问以插入数据。为了显着提高性能，您需要研究 SQL 命名空间中的 BulkInsert 方法。实施批量导入后，我的“重新加载”过程从 2 多个小时将几十个表还原到 31 秒。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-24T14:19:00.473

这最好使用类似 bcp 命令的东西来完成。如果这不可用，上面关于使用 BULK INSERT 的建议是您最好的选择。您对数据库进行了 500,000 次往返，并将 500,000 个条目写入日志文件，更不用说需要为日志文件、表和索引分配的任何空间。

如果您以与聚集索引不同的顺序插入，您还必须处理重新组织磁盘上的物理数据所需的时间。这里有很多变量可能会使您的查询运行得比您希望的要慢。

每秒约 10,000 个事务对于来自代码往返的单个插入来说并不可怕/

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-10-14T18:56:10.980

BULK INSERT = 来自权限的 bcp

您可以批量插入以减少往返 SQLDataAdaptor.UpdateBatchSize = 10000 给出 50 次往返

不过，您仍然有 500k 插入...

[文章](http://www.dotnetspider.com/resources/4467-Multiple-Inserts-Single-Round-trip-using-ADO-NE.aspx)

[MSDN](http://msdn.microsoft.com/en-us/library/kbbwt18a(VS.80).aspx)

# mysql - 如何检查MySQL中表字段上是否存在索引

> ID：127156
> 
> 赞同：117
> 
> 时间：2008-09-24T13:35:13.963
> 
> 标签：mysql, indexing

如何检查 MySQL 中表字段上是否存在索引？

我已经多次需要谷歌了，所以我分享了我的 Q/A。

* * *

## 回答 #1

> 赞同：152
> 
> 时间：2008-09-24T13:35:35.960

`SHOW INDEX`像这样使用：

```
SHOW INDEX FROM [tablename] 
```

文档：[https ://dev.mysql.com/doc/refman/5.0/en/show-index.html](https://dev.mysql.com/doc/refman/5.0/en/show-index.html)

* * *

## 回答 #2

> 赞同：39
> 
> 时间：2012-01-29T06:57:23.780

尝试：

```
SELECT * FROM information_schema.statistics 
  WHERE table_schema = [DATABASE NAME] 
    AND table_name = [TABLE NAME] AND column_name = [COLUMN NAME] 
```

它会告诉您某个列上是否有任何类型的索引，而无需知道索引的名称。它也可以在存储过程中工作（而不是显示索引）

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2012-05-06T13:26:57.337

```
SHOW KEYS FROM  tablename WHERE Key_name='unique key name' 
```

将显示表中是否存在唯一键。

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2015-03-18T06:00:26.233

```
show index from table_name where Column_name='column_name'; 
```

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2017-12-30T18:36:56.057

使用以下语句：

```
SHOW INDEX FROM *your_table* 
```

然后检查字段的结果：`row["Table"]`,`row["Key_name"]`

确保正确写入“Key_name”

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-24T13:36:50.543

要从 CLI 查看表的布局，您可以使用

```
desc mytable 
```

或者

```
show table mytable 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2021-03-06T02:24:58.383

添加到 GK10 建议的内容：

> 使用以下语句：SHOW INDEX FROM your_table
> 
> 然后检查字段的结果： row["Table"], row["Key_name"]
> 
> 确保正确写入“Key_name”

可以将其转化为 PHP（或其他语言），并包裹在一条 sql 语句中以查找索引列。基本上，您可以将 SHOW INDEX FROM 'mytable' 的结果提取到 PHP 中，然后使用列 'Column_name' 来获取索引列。

制作您的数据库连接字符串并执行以下操作：

```
$mysqli = mysqli_connect("localhost", "my_user", "my_password", "world");

$sql =  "SHOW INDEX FROM 'mydatabase.mytable' WHERE Key_name = 'PRIMARY';" ;
$result = mysqli_query($mysqli, $sql);

while ($row = $result->fetch_assoc()) {
    echo $rowVerbatimsSet["Column_name"];
} 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2017-06-29T09:21:13.147

您可以使用以下 SQL 来检查表上的给定列是否被索引：

```
select  a.table_schema, a.table_name, a.column_name, index_name
from    information_schema.columns a
join    information_schema.tables  b on a.table_schema  = b.table_schema and
                                    a.table_name = b.table_name and 
                                    b.table_type = 'BASE TABLE'
left join (
 select     concat(x.name, '/', y.name) full_path_schema, y.name index_name
 FROM   information_schema.INNODB_SYS_TABLES  as x
 JOIN   information_schema.INNODB_SYS_INDEXES as y on x.TABLE_ID = y.TABLE_ID
 WHERE  x.name = 'your_schema'
 and    y.name = 'your_column') d on concat(a.table_schema, '/', a.table_name, '/', a.column_name) = d.full_path_schema
where   a.table_schema = 'your_schema'
and     a.column_name  = 'your_column'
order by a.table_schema, a.table_name; 
```

由于连接是针对 INNODB_SYS_*，匹配索引仅来自 INNODB 表。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2019-02-04T11:26:55.737

如果您需要检查列的索引是否作为数据库函数存在，您可以使用/采用此代码。如果您想检查索引是否存在而不管多列索引中的位置，那么只需删除 part `AND SEQ_IN_INDEX = 1`。

```
DELIMITER $$
CREATE FUNCTION `fct_check_if_index_for_column_exists_at_first_place`(
    `IN_SCHEMA` VARCHAR(255),
    `IN_TABLE` VARCHAR(255),
    `IN_COLUMN` VARCHAR(255)
)
RETURNS tinyint(4)
LANGUAGE SQL
DETERMINISTIC
CONTAINS SQL
SQL SECURITY DEFINER
COMMENT 'Check if index exists at first place in sequence for a given column in a given table in a given schema. Returns -1 if schema does not exist. Returns -2 if table does not exist. Returns -3 if column does not exist. If index exists in first place it returns 1, otherwise 0.'
BEGIN

-- Check if index exists at first place in sequence for a given column in a given table in a given schema. 
-- Returns -1 if schema does not exist. 
-- Returns -2 if table does not exist. 
-- Returns -3 if column does not exist. 
-- If the index exists in first place it returns 1, otherwise 0.
-- Example call: SELECT fct_check_if_index_for_column_exists_at_first_place('schema_name', 'table_name', 'index_name');

-- check if schema exists
SELECT 
    COUNT(*) INTO @COUNT_EXISTS
FROM 
    INFORMATION_SCHEMA.SCHEMATA
WHERE 
    SCHEMA_NAME = IN_SCHEMA
;

IF @COUNT_EXISTS = 0 THEN
    RETURN -1;
END IF;

-- check if table exists
SELECT 
    COUNT(*) INTO @COUNT_EXISTS
FROM 
    INFORMATION_SCHEMA.TABLES
WHERE 
    TABLE_SCHEMA = IN_SCHEMA
AND TABLE_NAME = IN_TABLE
;

IF @COUNT_EXISTS = 0 THEN
    RETURN -2;
END IF;

-- check if column exists
SELECT 
    COUNT(*) INTO @COUNT_EXISTS
FROM 
    INFORMATION_SCHEMA.COLUMNS
WHERE 
    TABLE_SCHEMA = IN_SCHEMA
AND TABLE_NAME = IN_TABLE
AND COLUMN_NAME = IN_COLUMN
;

IF @COUNT_EXISTS = 0 THEN
    RETURN -3;
END IF;

-- check if index exists at first place in sequence
SELECT 
    COUNT(*) INTO @COUNT_EXISTS
FROM 
    information_schema.statistics 
WHERE 
    TABLE_SCHEMA = IN_SCHEMA
AND TABLE_NAME = IN_TABLE AND COLUMN_NAME = IN_COLUMN
AND SEQ_IN_INDEX = 1;

IF @COUNT_EXISTS > 0 THEN
    RETURN 1;
ELSE
    RETURN 0;
END IF;

END$$
DELIMITER ; 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2020-05-13T07:29:19.827

尝试使用这个：

```
SELECT TRUE
FROM INFORMATION_SCHEMA.KEY_COLUMN_USAGE 
WHERE TABLE_SCHEMA = "{DB_NAME}" 
AND TABLE_NAME = "{DB_TABLE}"
AND COLUMN_NAME = "{DB_INDEXED_FIELD}"; 
```

* * *

## 回答 #11

> 赞同：-3
> 
> 时间：2016-11-09T16:46:30.150

您不能运行特定的显示索引查询，因为如果索引不存在，它将引发错误。因此，如果您想避免任何 SQL 错误，则必须将所有索引抓取到一个数组中并循环遍历它们。

这是我的做法。我从表中获取所有索引（在本例中为`leads`），然后在 foreach 循环中检查列名（在本例中为`province`）是否存在。

```
$this->name = 'province';

$stm = $this->db->prepare('show index from `leads`');
$stm->execute();
$res = $stm->fetchAll();
$index_exists = false;

foreach ($res as $r) {
    if ($r['Column_name'] == $this->name) {
        $index_exists = true;
    }
} 
```

这样您就可以真正缩小索引属性的范围。做一个`print_r`为了`$res`看看你可以使用什么。

# .net - 你能解释一下STA和MTA吗？

> ID：127188
> 
> 赞同：405
> 
> 时间：2008-09-24T13:40:23.250
> 
> 标签：.net, multithreading, com, apartments

你能用你自己的话解释一下 STA 和 MTA 吗？

另外，什么是单元线程，它们是否只与 COM 相关？如果是这样，为什么？

* * *

## 回答 #1

> 赞同：371
> 
> 时间：2008-09-24T13:48:48.097

COM 线程模型称为“公寓”模型，其中初始化 COM 对象的执行上下文与单个线程（单线程单元）或多个线程（多线程单元）相关联。在此模型中，COM 对象一旦在一个单元中初始化，在其运行期间就是该单元的一部分。

STA 模型用于非线程安全的 COM 对象。这意味着他们不处理自己的同步。它的一个常见用途是 UI 组件。因此，如果另一个线程需要与对象交互（例如按下表单中的按钮），则消息将被编组到 STA 线程上。Windows 窗体消息泵系统就是一个例子。

如果 COM 对象可以处理自己的同步，则可以在允许多个线程与对象交互而无需编组调用的情况下使用 MTA 模型。

* * *

## 回答 #2

> 赞同：215
> 
> 时间：2008-09-24T14:04:59.087

这完全取决于如何处理对对象的调用，以及它们需要多少保护。COM 对象可以要求运行时保护它们不被多个线程同时调用；那些不能从不同线程并发调用的，所以他们必须保护自己的数据。

此外，如果从用户界面线程进行调用，运行时还必须防止 COM 对象调用阻塞用户界面。

*公寓*是对象居住的地方，它们包含一个或多个线程。公寓定义了拨打电话时会发生什么。对单元中对象的调用将在该单元中的任何线程上接收和处理，但已在正确单元中的线程的调用由其自身处理（即直接调用对象）除外。

线程可以在单线程单元中（在这种情况下，它们是该单元中的唯一线程）或在多线程单元中。它们指定线程何时为该线程初始化 COM。

STA 主要是为了与绑定到特定线程的用户界面兼容。STA通过接收到隐藏窗口的窗口消息来接收调用进程的通知；当它进行出站调用时，它会启动一个模态消息循环，以防止处理其他窗口消息。您可以指定要调用的消息过滤器，以便您的应用程序可以响应其他消息。

相比之下，所有 MTA 线程都为进程共享一个 MTA。如果没有可用的线程，COM 可能会启动一个新的工作线程来处理传入呼叫，直至达到池限制。进行出站调用的线程只是阻塞。

为简单起见，我们将只考虑在 DLL 中实现的对象，这些对象通过设置`ThreadingModel`类键的值在注册表中通告它们所支持的内容。有四个选项：

*   主线程（`ThreadingModel`值不存在）。该对象在主机的主 UI 线程上创建，所有调用都编组到该线程。类工厂只会在该线程上被调用。
*   `Apartment`. 这表明该类可以在任何单线程模式线程上运行。如果创建它的线程是 STA 线程，则该对象将在该线程上运行，否则它将在主 STA 中创建 - 如果不存在主 STA，将为它创建一个 STA 线程。（这意味着创建单元对象的 MTA 线程将把所有调用编组到不同的线程。）类工厂可以由多个 STA 线程同时调用，因此它必须保护其内部数据免受这种情况的影响。
*   `Free`. 这表示设计为在 MTA 中运行的类。即使由 STA 线程创建，它也将始终加载到 MTA 中，这再次意味着 STA 线程的调用将被编组。这是因为一个`Free`对象通常是在编写时期望它可以阻塞的。
*   `Both`. 这些类是灵活的，可以加载到它们创建的任何公寓中。但是，它们的编写必须满足两组要求：它们必须保护其内部状态免受并发调用，以防它们被加载到 MTA 中，但不能阻塞，以防它们被加载到 STA 中。

从 .NET Framework 开始，基本上只`[STAThread]`在创建 UI 的任何线程上使用。工作线程应该使用 MTA，除非他们要使用 -`Apartment`标记的 COM 组件，在这种情况下，如果从多个线程调用相同的组件（因为每个线程必须等待组件依次）。如果您对每个线程使用单独的 COM 对象，无论组件是在 STA 还是 MTA 中，这一切都会变得容易得多。

* * *

## 回答 #3

> 赞同：87
> 
> 时间：2010-07-02T04:00:33.193

我发现现有的解释太gobbledygook。这是我用简单的英语解释：

STA：如果一个线程创建了一个设置为 STA 的 COM 对象（在调用 CoCreateXXX 时，您可以传递一个将 COM 对象设置为 STA 模式的标志），那么只有这个线程可以访问这个 COM 对象（这就是 STA 的意思 - 单线程公寓)，试图调用此 COM 对象上的方法的其他线程在后台默默地转为向创建（拥有）该 COM 对象的线程传递消息。这很像只有创建 UI 控件的线程才能直接访问它。这种机制旨在防止复杂的锁定/解锁操作。

MTA：如果一个线程创建了一个设置为 MTA 的 COM 对象，那么几乎每个线程都可以直接调用它的方法。

这就是它的要点。尽管从技术上讲，有些细节我没有提到，例如在“STA”段落中，创建者线程本身必须是 STA。但这几乎是您要了解 STA/MTA/NA 所需要知道的全部内容。

* * *

## 回答 #4

> 赞同：27
> 
> 时间：2008-09-24T13:56:52.617

STA（单线程单元）基本上是一次只有一个线程与您的代码交互的概念。通过 Windows 消息（使用不可见）窗口对进入您公寓的呼叫进行编组。这允许调用排队并等待操作完成。

MTA（多线程单元）是许多线程可以同时运行的地方，作为开发人员，您有责任处理线程安全性。

关于 COM 中的线程模型还有很多需要了解，但是如果您无法理解它们是什么，那么我会说了解 STA 是什么以及它是如何工作的将是最好的起点，因为大多数 COM 对象都是 STA。

单元线程，如果一个线程与其正在使用的对象位于同一个单元中，那么它就是一个单元线程。我认为这只是一个 COM 概念，因为它只是谈论与之交互的对象和线程的一种方式……</p>

* * *

## 回答 #5

> 赞同：21
> 
> 时间：2008-09-24T13:44:10.540

每个承载 COM 或 OLE 控件的 EXE 都定义了它的公寓状态。公寓状态默认是 STA（对于大多数程序来说应该是 STA）。

**STA** - 所有 OLE 控件都必须存在于 STA 中。STA 意味着您的 COM 对象必须始终在 UI 线程上进行操作，并且不能传递给其他线程（很像 MFC 中的任何 UI 元素）。但是，您的程序仍然可以有很多线程。

**MTA** - 您可以在程序中的任何线程上操作 COM 对象。

* * *

## 回答 #6

> 赞同：13
> 
> 时间：2011-04-21T03:11:25.020

据我了解，“公寓”用于保护 COM 对象免受多线程问题的影响。

如果 COM 对象不是线程安全的，则应将其声明为 STA 对象。然后只有创建它的线程才能访问它。创建线程应将自己声明为 STA 线程。在后台，线程将 STA 信息存储在其 TLS（线程本地存储）中。我们将此行为称为线程进入 STA 单元。当其他线程想要访问这个 COM 对象时，它应该封送对创建线程的访问。基本上，创建线程使用消息机制来处理入站调用。

如果 COM 对象是线程安全的，则应将其声明为 MTA 对象。MTA 对象可以被多线程访问。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2014-05-30T14:19:42.547

调用 COM 对象 dll 的代码（例如，读取专有数据文件）可能在用户界面中运行良好，但在服务中神秘挂起。原因是从 .Net 2.0 开始，用户界面假定为 STA（线程安全），而服务假定为 MTA（（在此之前，服务假定为 STA）。必须为服务中的每个 COM 调用创建一个 STA 线程会增加大量开销。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2021-07-06T13:03:15.450

旁注：如果您使用某些 PowerShell 2.0 管理单元，则需要使用 -MTA 选项启动 PowerShell 版本 3 或更高版本才能使用它们。PowerShell 2 单元模型是 MTA，而更高版本默认使用 STA。另一点是位。公寓中的正常呼叫没有编组（直接呼叫），因此如果您的呼叫者是 x64，那么被呼叫者也必须是 x64。解决此问题的唯一方法是使用远程过程调用 (RPC)，这会增加大量开销（生成一个新的 32 位进程以通过某种方式加载管理单元 DLL 和查询结果）。对于开发人员：始终发布类型库 -它使您的 COM 对象发现和使用更加容易！每个接口都应该是公共的和唯一的——实现可以是专有的或开源的。

另一种情况

例子：

```
 IStorage_vtbl** reference; // you got it by some means of factory

 public unsafe int OpenStorage(char* pwcsName, IStorage pstgPriority, uint grfMode, char** snbExclude, uint reserved, IStorage* ppstg)
 {
     IStorage_vtbl** @this = (IStorage_vtbl**)reference;
     IStorage_vtbl* vtbl = *@this;
     if (vtbl == null)
         throw new InvalidComObjectException();
     Delegate genericDelegate = Marshal.GetDelegateForFunctionPointer(vtbl->method_6, typeof(delegate_6));
     delegate_6 method = (delegate_6)genericDelegate;
     return method(@this, pwcsName, pstgPriority, grfMode, snbExclude, reserved, ppstg);
 } 
```

这段代码只是添加了实例的“this”指针，以便真正调用 COM 子系统 那么，这个调用是打开 IStorage STA 还是 MTA 的实例？

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2022-03-02T04:27:47.470

这篇文章非常清楚地解释了 STA & MTA。

[了解 COM 公寓，第一部分](https://www.codeguru.com/soap/understanding-com-apartments-part-i/)
[了解 COM 公寓，第二部分](https://www.codeguru.com/soap/understanding-com-apartments-part-ii/)

关于什么是公寓的要点：

> *   公寓是并发边界；它是一个围绕对象和客户端线程绘制的假想框，用于分隔 COM 客户端和具有不兼容线程特性的 COM 对象。
> *   每个使用 COM 的线程以及这些线程创建的每个对象都分配给一个单元。
> *   当一个线程调用 COM`CoInitialize`或`CoInitializeEx`函数时，该线程被放置在一个单元中。当一个对象被创建时，它也被放置在一个公寓里。
> *   每当创建一个新公寓时，COM 都会在堆上分配一个公寓对象，并使用公寓 ID 和公寓类型等重要信息对其进行初始化。当它为一个单元分配一个线程时，COM 将相应的单元对象的地址记录在线程本地存储 (TLS) 中。

# haskell - if/else 控制块的良好 Haskell 编码风格？

> ID：127190
> 
> 赞同：30
> 
> 时间：2008-09-24T13:40:35.743
> 
> 标签：haskell, coding-style

我正在学习 Haskell，希望它能帮助我更接近函数式编程。以前，我主要使用具有类 C 语法的语言，如 C、Java 和 D。

[我对 Wikibooks 教程](http://en.wikibooks.org/wiki/Haskell/Simple_input_and_output)`if`使用的/`else`控制块的编码风格有一点疑问。代码如下所示：

```
doGuessing num = do
   putStrLn "Enter your guess:"
   guess <- getLine
   if (read guess) < num
     then do putStrLn "Too low!"
             doGuessing num
     else if (read guess) > num
            then do putStrLn "Too high!"
                    doGuessing num
            else do putStrLn "You Win!" 
```

这让我很困惑，因为这种编码风格完全违反了类 C 语言中推荐的风格，我们应该在同一列缩进`if`,`else if`和。`else`

我知道它在 Haskell 中不起作用，因为如果我缩进`else`与`if`.

但是下面的风格呢？我认为它比上面的要清楚得多。但是由于上面的内容被 Wikibooks 和 Yet Another Haskell Tutorial 使用，在 Haskell 官方网站上被标记为“最佳在线教程”，我不确定这种编码风格是否是 Haskell 程序中的约定。

```
doGuessing num = do
    putStrLn "Enter your guess:"
    guess <- getLine
    if (read guess) < num then
        do 
            putStrLn "Too low!"
            doGuessing num
        else if (read guess) > num then do 
            putStrLn "Too high!"
            doGuessing num
        else do 
            putStrLn "You Win!" 
```

所以，我很好奇哪种编码风格更常用——或者这段代码是否还有另一种编码风格？

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2010-01-19T18:52:21.287

Haskell 风格是功能性的，而不是强制性的！与其“做这个然后那个”，不如考虑组合函数并描述*你*的程序将做什么，而不是如何做。

在游戏中，您的程序要求用户猜测。一个正确的猜测是赢家。否则，用户重试。游戏一直持续到用户猜对为止，所以我们这样写：

```
main = untilM (isCorrect 42) (read `liftM` getLine) 
```

这使用了一个重复运行一个动作的组合器（在这种情况下`getLine`拉出一行输入`read`并将该字符串转换为整数）并检查其结果：

```
untilM :: Monad m => (a -> m Bool) -> m a -> m ()
untilM p a = do
  x <- a
  done <- p x
  if done
    then return ()
    else untilM p a 
```

谓词（部分应用于`main`）根据正确值检查猜测并做出相应响应：

```
isCorrect :: Int -> Int -> IO Bool
isCorrect num guess =
  case compare num guess of
    EQ -> putStrLn "You Win!"  >> return True
    LT -> putStrLn "Too high!" >> return False
    GT -> putStrLn "Too low!"  >> return False 
```

在玩家猜对之前要运行的动作是

```
read `liftM` getLine 
```

为什么不保持简单，只组合这两个函数呢？

```
*Main> ：类型读取。获取线

<交互式>:1:7:
    无法匹配预期的类型 `a -> String'
           针对推断类型“IO String”
    在 `(.)' 的第二个参数中，即 `getLine'
    在表达式中： read 。获取线
```

的类型`getLine`是`IO String`，但`read`要纯的`String`。

Control.Monad 中的函数[`liftM`](http://www.haskell.org/ghc/docs/latest/html/libraries/base/Control-Monad.html#v%3AliftM)采用纯函数并将其“提升”为 monad。表达式的类型告诉我们很多关于它的作用：

```
*Main> :type read `liftM` getLine
读取 `liftM` getLine :: (Read a) => IO a
```

这是一个 I/O 操作，在运行时会返回一个用 转换的值`read`，`Int`在我们的例子中是一个。回想一下，这`readLine`是一个产生`String`值的 I/O 操作，因此您可以将其`liftM`视为允许我们在`read`“内部”应用`IO`monad。

示例游戏：

```
1
太低！
100
太高！
42
你赢了！
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-09-24T21:58:54.610

您可以使用“案例”结构：

```
doGuessing num = do
    putStrLn "Enter your guess:"
    guess <- getLine
    case (read guess) of
        g | g < num -> do 
            putStrLn "Too low!"
            doGuessing num
        g | g > num -> do 
            putStrLn "Too high!"
            doGuessing num
        otherwise -> do 
            putStrLn "You Win!" 
```

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-09-29T01:46:11.493

mattiast 的 case 语句的一个小改进（我会编辑，但我缺少 karma）是使用 compare 函数，它返回三个值之一，LT、GT 或 EQ：

```
doGuessing num = do
   putStrLn "Enter your guess:"
   guess <- getLine
   case (read guess) `compare` num of
     LT -> do putStrLn "Too low!"
              doGuessing num
     GT -> do putStrLn "Too high!"
              doGuessing num
     EQ -> putStrLn "You Win!" 
```

我真的很喜欢这些 Haskell 问题，我鼓励其他人发布更多内容。通常你觉得必须*有*一种更好的方式来表达你的想法，但 Haskell 最初是如此陌生，以至于什么都不会浮现在脑海中。

Haskell journyman 的额外问题：doGuessing 的类型是什么？

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2010-01-19T22:36:59.570

`if ... then ... else`Haskell在块中解释的方式`do`非常符合 Haskell 的整个语法。

但是很多人更喜欢稍微不同的语法，允许`then`和`else`出现在与相应的 . 相同的缩进级别`if`。因此，GHC 带有一个名为 的可选语言扩展`DoAndIfThenElse`，它允许这种语法。

[在 Haskell 规范的最新版本Haskell 2010](http://www.haskell.org/pipermail/haskell-prime/2009-July/002812.html)中，该`DoAndIfThenElse`扩展成为核心语言的一部分。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-11-11T23:40:41.743

请注意，您必须在“do”块中缩进“then”和“else”这一事实被许多人认为是一个错误。它可能会在 Haskell 规范的下一个版本 Haskell'（Haskell prime）中得到修复。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-24T13:51:17.420

您还可以使用带有花括号的显式分组。[请参阅http://www.haskell.org/tutorial/patterns.html](http://www.haskell.org/tutorial/patterns.html)的布局部分

不过我不建议这样做。除了在一些特殊情况下，我从未见过有人使用显式分组。我通常查看[标准前奏代码](http://www.haskell.org/onlinereport/standard-prelude.html)以获取样式示例。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-31T19:36:42.080

我使用的编码风格就像您在 Wikibooks 中的示例一样。当然，它不遵循 C 指南，但 Haskell 不是 C，而且它的可读性很强，尤其是在你习惯了它之后。它也模仿了许多教科书（如 Cormen）中使用的算法风格。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2010-08-29T10:21:01.223

你会看到 Haskell 有很多不同的缩进样式。如果没有设置为以任何样式精确缩进的编辑器，它们中的大多数都很难维护。

你展示的风格要简单得多，对编辑器的要求也不高，我认为你应该坚持下去。我能看到的唯一不一致之处是您将第一个 dos 放在自己的行上，而将其他 dos 放在 then/else 之后。

注意关于如何在 Haskell 中思考代码的其他建议，但要坚持你的缩进风格。

# visual-studio-2008 - 如何从 SQL Reporting Services 2008 报告中获取当前用户的全名？

> ID：127199
> 
> 赞同：0
> 
> 时间：2008-09-24T13:41:57.240
> 
> 标签：visual-studio-2008, sql-server-2008, reporting-services, active-directory, account

我知道可以从内置变量 User!UserID 中检索用户帐户的名称，但是如何获取用户的完整用户名？

我想可以连接一些 .NET 代码并进行 Active Directory 查找，但有其他选择吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-25T09:30:36.460

在我的一个项目中，我使用 SQL Server 中的一个表来存储来自 Active Directory 的用户数据（“displayName”、“sAMAccountName”、“userPrincipalName”），使用 C# 应用程序进行数据传输。该表每晚更新一次，并且在 Active Directory 发生任何可能影响我的项目用户的更改之后更新。

就我而言（Sharepoint 上托管的 Infopath 表单），我使用 Web 服务从 Sharepoint 获取当前用户的帐户名，以显示对应的用户全名。

# java - 在构造函数中使用“this”作为方法调用的参数

> ID：127205
> 
> 赞同：6
> 
> 时间：2008-09-24T13:42:47.097
> 
> 标签：java, constructor, methods, call, this

我有一个如下构造函数：

```
public Agent(){

    this.name = "John";
    this.id = 9;
    this.setTopWorldAgent(this, "Top_World_Agent", true);

} 
```

我在方法调用中得到了一个空指针异常。这似乎是因为我在 setTopWorldAgent 方法中使用“this”作为参数。通过删除此方法调用，一切看起来都很好。为什么会这样？有没有其他人经历过这个？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-24T13:45:45.513

~~您可以将其传递给方法，但 setTopWorldAgent() 不能是抽象的。您不能在构造函数中进行虚拟调用。~~

~~在对象的构造函数中，您可以调用在该对象或基类中定义的方法，但不能期望调用将由派生类提供的东西，因为部分派生类尚未构造。如果 setTopWorldAgent() 是抽象的，我会预料到某种编译器错误。~~

在 Java 中，您可以使用构造函数和派生类获得令人惊讶的行为——这是一个示例

[http://en.wikipedia.org/wiki/Virtual_functions#Java_3](http://en.wikipedia.org/wiki/Virtual_functions#Java_3)

如果您习惯于 C# 或 C++，您可能会认为调用虚函数而不是调用被覆盖的函数是安全的。在 Java 中，即使派生类没有完全构造，也会进行虚拟调用。

如果这不是正在发生的事情，那么大概是 setTopWorldAgent() 需要的 this 的所有部分都已初始化——如果不是，它可能是需要初始化的 this 的成员之一。

编辑：认为这是 C#

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-24T13:51:11.727

出于好奇，您为什么将“this”传递给同一类的成员函数？setTopWorldAgent() 可以直接使用 'this'。它看起来不像你的构造函数或 setTopWorldAgent() 是静态的，所以我不确定你为什么要传递一个它已经可以访问的成员函数。

除非我错过了什么...

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-24T13:49:32.930

为什么`setTopWorldAgent`需要`this`作为论据？基于调用，它是一个实例方法，因此它可以引用`this`而不需要将其作为参数接收。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-24T13:49:52.430

我认为更重要的是，你到底为什么将“this”作为参数传递给“this”中的方法？

以下将测试您所说的发生在您身上的事情，我对此没有任何问题。

```
public class Test {
  public Test() {
    this.hi(this);
  }
  public void hi(Test t) {
    System.out.println(t);
  }

  public static void main(String[] args) throws Exception {
    Test t = new Test();
  }
} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-24T13:50:06.487

鉴于 setTopWorldAgent 似乎是一个实例方法，你为什么还要通过它呢？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-24T13:45:41.427

`this`不为空，这是肯定的。已经分配了

也就是说，不需要传入`this`方法，它在所有实例方法中自动可用。如果方法是静态的，您可能希望将其重构为实例方法。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-24T13:46:30.847

“this”永远不应该为空。您确定因此引发了异常吗？

需要注意的是，如果方法是虚拟的，或者调用任何虚拟方法，则属于子类的方法可能会在子类的变量初始化之前运行。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-24T13:46:53.280

错误必须在其他地方，因为上面的代码肯定有效，空引用必须是其他地方。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-24T13:52:01.753

如果您的代理正在实施 ITopWorldAgent 那么您实际上应该这样做：

```
 Agent agent = new Agent("John", 9);
agent.setTopWorldAgent(agent, "Top_World_Agent", true); 

```

如果不是，那你为什么要以你现在的方式设置一些东西？

我认为 setTopWorldAgent 方法中的某些内容正在使用尚未在构造函数中初始化的值。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-24T17:24:18.140

Java 的规则规定你永远不应该将“this”从它的构造函数传递给另一个方法，原因很简单，对象还没有完全构造。它引用的对象可能处于不一致的状态。我很惊讶实际的“this”引用为空，但一点也不惊讶“this”的某些成员在传递给 setTopWorldAgent 时为空，并且该方法因此引发异常。

通常，只要您实际上不访问任何成员或调用方法，例如如果您想在另一个对象中设置对“this”的引用，您就可以从构造函数中传递“this”。

在这种情况下，参数当然是不必要的，因为该方法已经引用了“this”。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-25T03:17:20.540

很高兴你得到了答案。我想补充一点，将“this”作为参数传递可能会导致意外的并发问题。您基本上提供了对象状态被潜在的非线程安全代码不安全地操作的可能性。

# c# - log4net/c# - 基于级别的不同布局

> ID：127224
> 
> 赞同：9
> 
> 时间：2008-09-24T13:46:26.883
> 
> 标签：c#, log4net

使用 log4net 时，有什么方法可以根据日志消息的级别进行不同的布局？比如说，如果是致命错误，我想查看所有可能的信息——类名、方法名、行号等。但是对于正常、调试和警告，我只想看到消息（我希望，这可以提高性能）。

我在 C# WinForms 中使用 log4net。我的要求是在发生致命错误时将所有先前的 512 条消息记录到文件中，并且我只想查看致命错误的类名、方法名、行号等，对于所有其他级别，只是一条消息。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-24T14:13:31.827

这篇文章对 log4net 配置文件有很好的解释：

[log4net 配置](http://weblogs.asp.net/tgraham/archive/2007/03/15/a-realistic-log4net-config.aspx)

注意 appenders 中的布局元素。它们定义了如何输出错误和您选择的任何信息的模式。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-10-22T17:26:23.747

我认为您正在寻找 LevelRangeFilter 和两个附加器组合。一个用于 FATAL 级别的附加器/过滤器组合（致命是最小值和最大值）和一个用于其他任何东西的附加器/过滤器组合（错误或信息是最大值，具体取决于您是否想包含用于调试目的的错误）

此处的示例：[您的 log4net 配置中有什么？黑客、优化、观察？](https://stackoverflow.com/questions/619532/what-do-you-have-in-your-log4net-config-hacks-optimizations-observations)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-24T13:53:33.780

您可以为每个“关卡”使用不同的 Appender，并让它们相同，但用于模式布局。

# c# - Class 是否需要实现 IEnumerable 才能使用 Foreach

> ID：127233
> 
> 赞同：16
> 
> 时间：2008-09-24T13:47:17.803
> 
> 标签：c#, foreach, ienumerable

这是在 C# 中，我有一个从其他人的 DLL 中使用的类。它没有实现 IEnumerable，但有 2 个方法可以传回 IEnumerator。有没有办法可以在这些上使用 foreach 循环。我使用的类是密封的。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-09-24T13:50:47.107

`foreach`不需要，*与*`IEnumerable`流行的看法相反。它所需要的只是一个方法，该方法返回具有该方法和具有适当签名的 get-property的`GetEnumerator`任何对象。`MoveNext``Current`

/编辑：但是，在您的情况下，您不走运。但是，您可以简单地包装您的对象，使其可枚举：

```
class EnumerableWrapper {
    private readonly TheObjectType obj;

    public EnumerableWrapper(TheObjectType obj) {
        this.obj = obj;
    }

    public IEnumerator<YourType> GetEnumerator() {
        return obj.TheMethodReturningTheIEnumerator();
    }
}

// Called like this:

foreach (var xyz in new EnumerableWrapper(yourObj))
    …; 
```

/编辑：如果该方法返回一个，则由几个人提出的以下方法*不起作用*`IEnumerator`：

```
foreach (var yz in yourObj.MethodA())
    …; 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-09-24T13:59:52.080

回复：如果 foreach 不需要显式的接口契约，它会使用反射找到 GetEnumerator 吗？

（我无法发表评论，因为我没有足够高的声誉。）

如果您暗示*运行时*反射，那么没有。它在编译时完成，另一个鲜为人知的事实是它还检查*可能*实现 IEnumerator 的返回对象是否是一次性的。

要查看此操作，请考虑此（可运行）代码段。

```
 using System;
using System.Collections.Generic;
using System.Text;

namespace ConsoleApplication3
{
    class FakeIterator
    {
        int _count;

        public FakeIterator(int count)
        {
            _count = count;
        }
        public string Current { get { return "Hello World!"; } }
        public bool MoveNext()
        {
            if(_count-- > 0)
                return true;
            return false;
        }
    }

    class FakeCollection
    {
        public FakeIterator GetEnumerator() { return new FakeIterator(3); }
    }

    class Program
    {
        static void Main(string[] args)
        {
            foreach (string value in new FakeCollection())
                Console.WriteLine(value);
        }
    }
} 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-09-24T13:57:35.453

根据[MSDN](http://msdn.microsoft.com/en-us/library/ttw7t8t6(VS.71).aspx)：

```
foreach (type identifier in expression) statement 
```

其中表达式为：

> 对象集合或数组表达式。集合元素的类型必须可转换为标识符类型。不要使用计算结果为 null 的表达式。求值为实现 IEnumerable 的类型或声明 GetEnumerator 方法的类型。在后一种情况下，GetEnumerator 应返回实现 IEnumerator 的类型或声明 IEnumerator 中定义的所有方法。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-09-24T14:01:11.420

## 简短的回答：

您需要一个具有名为*GetEnumerator*的方法的类，该方法返回您已有的 IEnumerator。用一个简单的包装器实现这一点：

```
class ForeachWrapper
{
  private IEnumerator _enumerator;

  public ForeachWrapper(Func<IEnumerator> enumerator)
  {
    _enumerator = enumerator;
  }

  public IEnumerator GetEnumerator()
  {
    return _enumerator();
  }
} 
```

## 用法：

```
foreach (var element in new ForeachWrapper(x => myClass.MyEnumerator()))
{
  ...
} 
```

## 来自[C# 语言规范](http://www.ecma-international.org/publications/files/ECMA-ST/Ecma-334.pdf)：

> foreach 语句的编译时处理首先确定表达式的集合类型、枚举类型和元素类型。该确定过程如下：
> 
> *   如果表达式的 X 类型是数组类型，则存在从 X 到 System.Collections.IEnumerable 接口的隐式引用转换（因为 System.Array 实现了此接口）。集合类型为 System.Collections.IEnumerable 接口，枚举类型为 System.Collections.IEnumerator 接口，元素类型为数组类型 X 的元素类型。
>     
>     
> *   否则，确定类型 X 是否具有适当的 GetEnumerator 方法：
>     
>     
>     *   对带有标识符 GetEnumerator 且没有类型参数的类型 X 执行成员查找。如果成员查找没有产生匹配，或者它产生歧义，或者产生不是方法组的匹配，则如下所述检查可枚举接口。如果成员查找产生除方法组以外的任何内容或不匹配，建议发出警告。
>         
>         
>     *   使用生成的方法组和空参数列表执行重载决议。如果重载决议导致没有适用的方法，导致歧义，或导致单个最佳方法但该方法是静态的或不是公共的，请检查如下所述的可枚举接口。如果重载决议产生除了明确的公共实例方法或没有适用的方法之外的任何内容，建议发出警告。
>         
>         
>     *   如果 GetEnumerator 方法的返回类型 E 不是类、结构或接口类型，则会产生错误并且不采取进一步的步骤。
>         
>         
>     *   成员查找在 E 上执行，标识符为 Current，没有类型参数。如果成员查找没有产生匹配，则结果是错误，或者结果是除了允许读取的公共实例属性之外的任何内容，则会产生错误并且不采取进一步的步骤。
>         
>         
>     *   成员查找在 E 上执行，标识符为 MoveNext，没有类型参数。如果成员查找不匹配，结果是错误，或者结果是方法组以外的任何内容，则会产生错误并且不采取进一步的步骤。
>         
>         
>     *   对具有空参数列表的方法组执行重载解决方案。如果重载决议导致没有适用的方法，导致歧义，或者导致单个最佳方法但该方法是静态的或不是公共的，或者它的返回类型不是 bool，则会产生错误并且不采取进一步的步骤。
>         
>         
>     *   集合类型为 X，枚举类型为 E，元素类型为 Current 属性的类型。
>         
>         
> *   否则，检查可枚举接口：
>     
>     
>     *   如果只有一种类型 T 存在从 X 到接口 System.Collections.Generic.IEnumerable<T> 的隐式转换，则集合类型是此接口，枚举器类型是接口 System.Collections.Generic。 IEnumerator<T>，元素类型为 T。
>         
>         
>     *   否则，如果存在不止一个这样的类型 T，则会产生错误并且不采取进一步的步骤。
>         
>         
>     *   否则，如果存在从 X 到 System.Collections.IEnumerable 接口的隐式转换，则集合类型为该接口，枚举器类型为接口 System.Collections.IEnumerator，元素类型为对象。
>         
>         
>     *   否则，将产生错误并且不采取进一步的步骤。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-24T13:52:32.393

不严格。只要该类具有所需的 GetEnumerator、MoveNext、Reset 和 Current 成员，它将与 foreach 一起使用

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-24T13:57:22.320

不，您不需要，甚至不需要 GetEnumerator 方法，例如：

```
class Counter
{
    public IEnumerable<int> Count(int max)
    {
        int i = 0;
        while (i <= max)
        {
            yield return i;
            i++;
        }
        yield break;
    }
} 
```

就是这样称呼的：

```
Counter cnt = new Counter();

foreach (var i in cnt.Count(6))
{
    Console.WriteLine(i);
} 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-24T13:51:32.443

你总是可以包装它，并且作为“可访问”的旁白，你只需要一个名为“GetEnumerator”的方法，并带有适当的签名。

```
 class EnumerableAdapter
{
  ExternalSillyClass _target;

  public EnumerableAdapter(ExternalSillyClass target)
  {
    _target = target;
  }

  public IEnumerable GetEnumerator(){ return _target.SomeMethodThatGivesAnEnumerator(); }

} 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-24T13:57:05.737

给定类 X 的方法 A 和 B 都返回 IEnumerable，您可以像这样在类上使用 foreach：

```
foreach (object y in X.A())
{
    //...
}

// or

foreach (object y in X.B())
{
   //...
} 
```

大概 A 和 B 返回的可枚举的含义是明确定义的。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-24T14:37:27.027

@Brian：不确定您是否尝试遍历方法调用或类本身的返回值，如果您想要的是类，则可以将其设置为可以与 foreach 一起使用的数组。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-25T20:58:11.567

对于一个可以与 foeach 一起使用的类，它所要做的就是拥有一个返回的公共方法和名为 GetEnumerator() 的 IEnumerator，就是这样：

采取以下类，它不实现 IEnumerable 或 IEnumerator ：

```
public class Foo
{
    private int[] _someInts = { 1, 2, 3, 4, 5, 6 };
    public IEnumerator GetEnumerator()
    {
        foreach (var item in _someInts)
        {
            yield return item;
        }
    }
} 
```

或者，可以编写 GetEnumerator() 方法：

```
 public IEnumerator GetEnumerator()
    {
        return _someInts.GetEnumerator();
    } 
```

在 foreach 中使用时（注意没有使用包装器，只是一个类实例）：

```
 foreach (int item in new Foo())
    {
        Console.Write("{0,2}",item);
    } 
```

印刷：

> 1 2 3 4 5 6

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2013-12-01T03:54:32.570

该类型只需要有一个名为 public/non-static/non-generic/parameterless 的方法`GetEnumerator`，它应该返回具有公共`MoveNext`方法和公共`Current`属性的东西。当我在某处回忆 Eric Lippert 先生时，**它的设计是为了在值类型的情况下适应类型安全和与拳击相关的性能问题的前通用时代。**

例如这有效：

```
class Test
{
    public SomethingEnumerator GetEnumerator()
    {

    }
}

class SomethingEnumerator
{
    public Something Current //could return anything
    {
        get { }
    }

    public bool MoveNext()
    {

    }
}

//now you can call
foreach (Something thing in new Test()) //type safe
{

} 
```

然后编译器将其翻译为：

```
var enumerator = new Test().GetEnumerator();
try {
   Something element; //pre C# 5
   while (enumerator.MoveNext()) {
      Something element; //post C# 5
      element = (Something)enumerator.Current; //the cast!
      statement;
   }
}
finally {
   IDisposable disposable = enumerator as System.IDisposable;
   if (disposable != null) disposable.Dispose();
} 
```

[从规范的 8.8.4 部分开始。](http://msdn.microsoft.com/en-us/library/aa664754%28v=vs.71%29.aspx)

* * *

值得注意的是所涉及的枚举器优先级 - 如果您有一个`public GetEnumerator`方法，那么`foreach`无论谁在实现它，这都是默认选择。例如：

```
class Test : IEnumerable<int>
{
    public SomethingEnumerator GetEnumerator()
    {
        //this one is called
    }

    IEnumerator<int> IEnumerable<int>.GetEnumerator()
    {

    }
} 
```

（*如果您没有公共实现（即只有显式实现），则优先级类似于`IEnumerator<T>`> `IEnumerator`。*）

# .net - 上下文自然语言资源，我从哪里开始？

> ID：127238
> 
> 赞同：2
> 
> 时间：2008-09-24T13:48:24.103
> 
> 标签：.net, nlp

我在哪里可以找到一些 .Net 或概念资源来开始使用自然语言，在那里我可以从文本中提取上下文和主题。我不希望使用词频算法。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-24T14:24:59.553

要在词性标记（自然语言处理任务）中查找资源，请查看以下内容：

*   [自然语言工具包](http://nltk.sourceforge.net/index.php/Book)
*   [perl 中的 PoS 标记器](http://search.cpan.org/dist/Lingua-EN-Tagger/Tagger.pm)
*   [支持向量机工具](http://www.lsi.upc.es/~nlp/SVMTool/)
*   [斯坦福大学 NLP 小组](http://nlp.stanford.edu/software/tagger.shtml)

希望能帮助到你。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-24T13:57:47.387

对于英语，有[WordNet](http://wordnet.princeton.edu/)文件，这些是您正在寻找的资源吗？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-24T14:06:55.290

Hank 的标记更改导致[解析器列表](https://stackoverflow.com/questions/88984/your-favorite-natural-language-parser)和[库](https://stackoverflow.com/questions/25332/whats-a-good-natural-language-library-to-use-for-paraphrasing)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-24T14:33:48.377

亚历克斯。S 语音你是指语音处理还是文本处理？我目前正在寻找文本处理资源。我已经下载了这本书，并将通过它。

# .net - .NET 客户端应用程序：在代理的情况下如何访问 Web 服务？

> ID：127241
> 
> 赞同：4
> 
> 时间：2008-09-24T13:48:48.330
> 
> 标签：.net, winforms, proxy

我们正在开发一个 .NET 2.0 winform 应用程序。应用程序需要访问[Web 服务](http://ws.lokad.com/)。然而，我们遇到了代理背后的用户问题。

流行的 Windows 备份应用程序（想想[Mozy](http://mozy.com/)）提供了一个适度复杂的对话框窗口，专门用于代理设置。然而，重新实现另一个代理处理逻辑和 GUI 对我来说完全是浪费时间。

使用 .NET 客户端应用程序处理代理的最佳方法是什么？

更具体地说，我们有一个案例，用户在 Internet Explorer 中记录了他的代理设置（包括用户名和密码），因此.NET的*默认代理行为应该可以工作。*然而，在启动 IE 时仍会提示用户输入他的用户名和密码（这两个字段都已预先填写，用户只需单击确定） - 我们的 winform 应用程序仍然无法处理代理。

我们应该怎么做才能强制在启动 IE 时不提示用户输入用户名和密码？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-09-24T14:04:19.713

将其放入应用程序的配置文件中：

```
<configuration>
  <system.net>
    <defaultProxy>
      <proxy autoDetect="true" />
    </defaultProxy>
  </system.net>
</configuration> 
```

并且您的应用程序将使用 IE 中的代理设置。如果您可以使用代理服务器在 IE 中看到您的 Web 服务，那么您应该能够从您的应用程序中“看到”它。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-24T13:57:09.527

使用 WebProxy 和 WebRequest 类。一次将其包装到您自己的库中，并在您希望与代理一起使用的任何地方使用。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-24T13:55:56.377

研究使用 .NET [WebProxy](http://msdn.microsoft.com/en-us/library/system.net.webproxy.aspx)类。它支持自动选择正确的默认设置。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-24T13:52:21.347

最简单的方法是使用 IE Explorer 中的代理设置。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-24T16:00:07.157

如果你打开 IE，点击 OK 到代理对话框，然后（让 IE 打开）尝试连接你的 winforms 应用程序，你的应用程序可以工作吗？还是您的应用无论如何都无法处理代理？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-24T16:03:42.267

您遇到代理问题的客户是否都在同一个网络上（即他们都使用同一个代理服务器）？

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-27T00:48:08.327

我认为提问者明白如果用户需要代理，他必须使用 WebProxy，问题是“我如何获取 IE 的代理设置，这样我就不必要求用户也将它们输入到我的应用程序中？”

System.Net.WebProxy.GetDefaultProxy 已过时，您必须使用 System.Net.WebRequest.DefaultWebProxy。[在http://msdn.microsoft.com/en-ca/magazine/cc300743.aspx](http://msdn.microsoft.com/en-ca/magazine/cc300743.aspx)上有一篇描述它的文章。

# asp.net - 如何将扩展程序绑定到客户端的控件

> ID：127246
> 
> 赞同：1
> 
> 时间：2008-09-24T13:49:36.847
> 
> 标签：asp.net, calendarextender, maskededitextender

我有一些不是服务器端控件的动态创建的输入。我想将它们与客户端的一些 CalendarExtender 和 MaskedEditExtender 相关联。有没有办法做到这一点？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-24T14:55:30.540

是的，我认为这可能是这样的：

在服务器端将`BehaviourID`Ajax 控件的属性设置为已知值：

```
_calendarExtender.BehaviorID = "_behaviour_id" 
```

这使您可以在您的 javascript 中使用以下函数获取底层 CalendarBehaviour 对象`$find`：

```
var calBehaviour = $find('_behaviour_id' ); 
```

您现在可以调用各种对象函数，例如 hide() 和 show() ：

```
calBehaviour.show(); 
```

您可以按如下方式获取 CalendarExtender 的基础 TextBox 输入字段：

```
var tbElement = calBehaviour._textbox._element; 
```

我没有尝试过，但如果这是您想要做的，或者只是以其他方式操作扩展器，您可以将原始文本框换成您自己的客户端输入控件。

# c# - LINQ to XML 新手问题：返回多个结果

> ID：127258
> 
> 赞同：4
> 
> 时间：2008-09-24T13:51:29.167
> 
> 标签：c#, linq-to-xml

问候！

我正在努力解决 LINQ 问题。如果我将诸如此类的一些 XML 加载到 XDocument 对象中：

```
<Root>
    <GroupA>
        <Item attrib1="aaa" attrib2="000" attrib3="true" />
    </GroupA>
    <GroupB>
        <Item attrib1="bbb" attrib2="111" attrib3="true" />
        <Item attrib1="ccc" attrib2="222" attrib3="false" />
        <Item attrib1="ddd" attrib2="333" attrib3="true" />
    </GroupB>
    <GroupC>
        <Item attrib1="eee" attrib2="444" attrib3="true" />
        <Item attrib1="fff" attrib2="555" attrib3="true" />
    </GroupC>
</Root> 
```

我想获取 Group 元素的所有 Item 子元素的属性值。这是我的查询的样子：

```
var results = from thegroup in l_theDoc.Elements("Root").Elements(groupName)
              select new
              { 
                 attrib1_val = thegroup.Element("Item").Attribute("attrib1").Value,      
                 attrib2_val = thegroup.Element("Item").Attribute("attrib2").Value,
              }; 
```

查询有效，但如果 groupName 变量包含“GroupB”，则只返回一个结果（第一个 Item 元素）而不是三个。我错过了什么吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-24T14:01:33.743

```
XElement e = XElement.Parse(testStr);

string groupName = "GroupB";
var items = from g in e.Elements(groupName)
            from i in g.Elements("Item")
            select new {
                           attr1 = (string)i.Attribute("attrib1"),
                           attr2 = (string)i.Attribute("attrib2")
                       };

foreach (var item in items)
{
    Console.WriteLine(item.attr1 + ":" + item.attr2);
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-24T13:58:44.047

是的， .Element() 只返回第一个匹配的元素。你想要 .Elements() 并且你需要重新编写你的查询：

```
var results = from group in l_theDoc.Root.Elements(groupName)
              select new
              {
                  items = from i in group.Elements("Item")
                          select new 
                          {
                              attrib1_val = i.Attribute("attrib1").Value,
                              attrib2_val = i.Attribute("attrib2").Value
                          }
              }; 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-24T14:17:59.990

这是答案的查询方法形式：

```
var items = 
  e.Elements("GroupB")
    .SelectMany(g => g.Elements("Item"))
    .Select(i => new {
      attr1 = i.Attribute("attrib1").Value,
      attr2 = i.Attribute("attrib2").Value,
      attr3 = i.Attribute("attrib3").Value
    } )
    .ToList() 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-24T14:08:43.460

另一种可能性是使用 where 子句：

```
var groupName = "GroupB";
var results = from theitem in doc.Descendants("Item")
              where theitem.Parent.Name == groupName
              select new 
              { 
                  attrib1_val = theitem.Attribute("attrib1").Value,
                  attrib2_val = theitem.Attribute("attrib2").Value, 
              }; 
```

# asp.net-mvc - NHaml 是否具有 content_for 布局能力？

> ID：127267
> 
> 赞同：5
> 
> 时间：2008-09-24T13:53:16.463
> 
> 标签：asp.net-mvc, nhaml

我目前正在启动一个使用 ASP.NET MVC 的项目，并且想使用 NHaml 作为我的视图引擎，因为我喜欢 Rails/Merb 的 Haml。我面临的主要问题是我的页面布局。在 Webforms 中，我会在头部放置一个 ContentPlaceHolder，以便其他页面可以有特定的 CSS 和 JavaScript 文件。

在 Rails 中，这是使用 yield 和 content_for 完成的

文件：application.haml

```
%html
  %head
    - yield :style 
```

文件：page.haml

```
- content_for :style do 
  / specific styles for this page 
```

在 NHaml 中，我可以使用局部变量来执行此操作，但是任何局部变量对于整个控制器文件夹都是全局的。

文件：application.haml

```
!!!
%html{xmlns="http://www.w3.org/1999/xhtml"}
  %head
    _ Style 
```

文件：_Style.haml

```
%link{src="http://www.thescore.com/css/style.css?version=1.1" type="text/css"} 
```

有谁知道让 NHaml 在 Rails 场景中工作的方法？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-31T20:31:20.987

在母版页中使用 ^ 评估器，并在每个布局（内容页面）中设置它的值。

请参阅[Google Code](http://code.google.com)上的[NHaml 示例](http://code.google.com/p/nhaml/source/browse/tags/1.4.0/src/Samples/NHaml.Samples.Mvc/)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-08-06T11:02:13.600

The "content placeholders" are not yet supported.
But there is a [request for that](http://code.google.com/p/nhaml/issues/detail?id=5#c10).

You can vote [for it too](http://nhaml.uservoice.com/pages/18694-general/suggestions/276848-multiple-content-placeholders)

BUT this is how I provided per-page content in NHAML:
[http://dnagir.blogspot.com/2009/07/nhaml-scripts-and-styles-code-block.html](http://dnagir.blogspot.com/2009/07/nhaml-scripts-and-styles-code-block.html)

# c# - ScriptManager.RegisterClientScript 在异步面板内 FormView 内的 UserControl 中

> ID：127283
> 
> 赞同：1
> 
> 时间：2008-09-24T13:55:34.243
> 
> 标签：c#, .net, ajax, formview, scriptmanager

我在异步面板的表单视图中从用户控件内部注册 javascript 事件时遇到了烦人的问题。我转到我的表单视图，然后按一个按钮切换到插入模式。这不会进行整页回发。在插入模式下，我的用户控件的 page_load 事件应该使用 ScriptManager.RegisterStartupScript 注册一个 javascript 事件：

```
ScriptManager.RegisterStartupScript(base.Page, this.GetType(), ("dialogJavascript" + this.ID), "alert(\"Registered\");", true); 
```

但是，当我查看我的 HTML 源代码时，该事件不存在。因此警告框永远不会显示。这是我实际的 aspx 文件的设置：

```
<igmisc:WebAsyncRefreshPanel ID="WebAsyncRefreshPanel1" runat="server">
    <asp:FormView ID="FormView1" runat="server" DataSourceID="odsCurrentIncident">
        <EditItemTemplate>
            <uc1:SearchSEDUsers ID="SearchSEDUsers1" runat="server" />
        </EditItemTemplate>
        <ItemTemplate>
            Hello
            <asp:Button ID="Button1" runat="server" CommandName="Edit" Text="Button" />
        </ItemTemplate>
    </asp:FormView>
</igmisc:WebAsyncRefreshPanel> 
```

有谁知道我在这里可能会错过什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-24T14:23:28.277

您是否尝试过使用 RegisterClientSideScript？您始终可以使用 IsClientSideScriptRegistered 检查脚本的密钥，以确保您不会多次注册它。

我假设异步面板正在执行部分页面过去，这不会触发 mechansim 重新生成启动脚本。也许对 ASP.Net 页面生命周期和 CLR 有更好理解的人可以填补这些空白。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-11-05T18:44:20.217

对我来说效果很好。 `resizeChartMid()`是一个函数名。

```
ScriptManager.RegisterStartupScript(this, typeof(string), "getchart48", "resizeChartMid();", true); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-09-27T03:51:40.207

试试这个，我也遇到了同样的问题

```
ScriptManager.RegisterClientScriptBlock(MyBase.Page, Me.[GetType](),
                     ("dialogJavascript" + this.ID), "alert(\"Registered\");", True) 
```

这对我有用！

# deployment - 无法在 Visual Studio 2005 安装项目中选择主输出作为快捷方式的目标

> ID：127288
> 
> 赞同：2
> 
> 时间：2008-09-24T13:56:51.650
> 
> 标签：deployment, visual-studio-2005, installation

我已经在我的解决方案中添加了一个安装项目（没有使用向导）然后我将我编码的 Windows 应用程序的主要输出添加到应用程序文件夹节点（右键单击解决方案资源管理器中的安装项目并选择查看 - > 文件系统）。我右键单击用户的桌面节点并在上下文菜单中选择“创建用户桌面的快捷方式”。键入快捷方式的名称，然后在属性窗口中单击目标属性的省略号按钮。将显示一个对话框，但它不会展开应用程序文件夹节点，让我选择主输出作为目标！怎么回事？？？

我已经在另一个项目上做到了这一点，但我一生都无法弄清楚为什么我不能在这个项目上做到这一点。地狱！这些项目在其他方面几乎相同。呸！秃顶。希望外面的人今天过得比我好，有时间给我可能非常明显的解决方案，让我觉得很蹩脚。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-24T14:02:27.253

您实际上必须在安装项目中右键单击“主要输出来源”，然后创建一个快捷方式。然后，您可以将快捷方式移动到安装项目中的“用户桌面”位置。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-24T14:04:52.847

我想你已经在桌面上创建了一个桌面快捷方式。

尝试单击用户的桌面，然后在右侧窗格中单击鼠标右键，然后从那里选择“创建新快捷方式”。

# c++ - 是否可以在 C++ 中对 C 结构进行子类化并在 C 代码中使用指向该结构的指针？

> ID：127290
> 
> 赞同：24
> 
> 时间：2008-09-24T13:56:53.023
> 
> 标签：c++, c, gcc, extern-c

这样做是否有副作用：

C代码：

```
struct foo {
      int k;
};

int ret_foo(const struct foo* f){ 
    return f.k; 
} 
```

C++ 代码：

```
class bar : public foo {

   int my_bar() { 
       return ret_foo( (foo)this ); 
   }

}; 
```

`extern "C"`C++ 代码周围有一个，每个代码都在它自己的编译单元内。

这可以跨编译器移植吗？

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2008-09-24T16:30:06.163

这是完全合法的。在 C++ 中，类和结构是相同的概念，除了所有结构成员默认情况下都是公共的。这是唯一的区别。因此，询问是否可以扩展结构与询问是否可以扩展类没有什么不同。

这里有一个警告。不*保证*编译器之间的布局一致性。因此，如果您使用与 C++ 代码不同的编译器编译 C 代码，您可能会遇到与成员布局相关的问题（尤其是填充）。当使用来自同一供应商的 C 和 C++ 编译器时，甚至会发生这种情况。

我用 gcc 和 g++ 发生过这种情况*。*我参与了一个使用多个大型结构的项目。不幸的是，g++ 对结构的打包比 gcc 松散得多，这导致了在 C 和 C++ 代码之间共享对象的严重问题。我们最终不得不手动设置打包和插入填充，以使 C 和 C++ 代码对结构进行相同的处理。但是请注意，无论子类化如何，都可能发生此问题。事实上，在这种情况下，我们并没有继承 C 结构。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-09-24T14:04:18.683

我当然不建议使用这种奇怪的子类化。最好将您的设计更改为使用组合而不是继承。只做一名成员

> 富* m_pfoo;

在酒吧课上，它会做同样的工作。

您可以做的另一件事是再创建一个类 FooWrapper，它本身包含结构和相应的 getter 方法。然后你可以子类化包装器。这样，虚拟析构函数的问题就消失了。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-24T14:21:38.970

> “永远不要从具体类派生。” — 萨特
> 
> “使非叶类抽象。” — 迈耶斯

子类化非接口类是完全错误的。你应该重构你的库。

从技术上讲，您可以做您想做的事，只要您不调用未定义的行为，例如，通过指向其基类子对象的指针删除指向派生类的指针。您甚至不需要`extern "C"`C++ 代码。是的，它是便携式的。但这是糟糕的设计。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-24T14:31:06.340

这是完全合法的，尽管它可能会让其他程序员感到困惑。

您可以使用继承来扩展具有方法和构造函数的 C 结构。

样本 ：

```
struct POINT { int x, y; }
class CPoint : POINT
{
public:
    CPoint( int x_, int y_ ) { x = x_; y = y_; }

    const CPoint& operator+=( const POINT& op2 )
    { x += op2.x; y += op2.y; return *this; }

    // etc.
}; 
```

扩展结构可能“更”邪恶，但不是你被禁止做的事情。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-24T14:00:55.057

哇，太邪恶了

> 这可以跨编译器移植吗？

绝对不是。考虑以下：

```
foo* x = new bar();
delete x; 
```

为了使它工作，foo 的析构函数必须是虚拟的，而它显然不是。但是，只要您不使用`new`并且只要派生对象没有自定义析构函数，您就会很幸运。

/编辑：另一方面，如果代码仅用于问题中，则继承与组合没有优势。只需遵循 m_pGladiator 给出的建议即可。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-24T15:43:36.400

这是完全合法的，您可以通过 MFC CRect 和 CPoint 类在实践中看到它。CPoint 派生自 POINT（在 windef.h 中定义），而 CRect 派生自 RECT。您只是用成员函数装饰一个对象。只要您不使用更多数据扩展对象，就可以了。事实上，如果你有一个复杂的 C 结构，默认初始化很麻烦，那么使用包含默认构造函数的类对其进行扩展是处理该问题的一种简单方法。

即使你这样做：

```
foo *pFoo = new bar;
delete pFoo; 
```

那么你很好，因为你的构造函数和析构函数是微不足道的，而且你没有分配任何额外的内存。

您也不必用'extern "C"' 包装您的C++ 对象，因为您实际上并没有将C++*类型*传递给C 函数。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-24T14:07:49.750

我认为这不一定是一个问题。行为是明确定义的，只要您小心处理生命周期问题（不要在 C++ 和 C 代码之间混合和匹配分配），就会做您想做的事情。它应该可以完美地跨编译器移植。

析构函数的问题是真实存在的，但在基类析构函数不是虚拟的任何时候都适用，不仅适用于 C 结构。这是您需要注意的事情，但不排除使用此模式。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-24T14:08:50.717

它可以工作，并且可以移植，但是您不能使用任何虚拟函数（包括析构函数）。

我建议不要这样做，而是让 Bar 包含一个 Foo。

```
class Bar
{
private:
   Foo  mFoo;
}; 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-24T14:10:12.850

我不明白你为什么不简单地将 ret_foo 设为成员方法。您当前的方式使您的代码非常难以理解。首先使用带有成员变量和 get/set 方法的真实类有什么困难？

我知道可以在 C++ 中对结构进行子类化，但危险在于其他人将无法理解您编写的代码，因为很少有人真正做到这一点。我会选择一个强大且通用的解决方案。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-24T14:20:14.510

它可能会起作用，但我不相信它可以保证。以下是来自 ISO C++ 10/5 的引用：

> 基类子对象的布局 (3.7) 可能与相同类型的最派生对象的布局不同。

很难看出在“现实世界”中实际情况如何。

**编辑：**

底线是标准没有限制基类子对象布局可以与具有相同基本类型的具体对象不同的位置数量。结果是您可能拥有的任何假设，例如 POD 特性等，对于基类子对象不一定正确。

**编辑：**

另一种方法，其行为被明确定义的方法是使 'foo' 成为 'bar' 的成员，并在必要时提供转换运算符。

```
class bar {
public:    
   int my_bar() { 
       return ret_foo( foo_ ); 
   }

   // 
   // This allows a 'bar' to be used where a 'foo' is expected
   inline operator foo& () {
     return foo_;
   }

private:    
  foo foo_;
}; 
```

# java - 在java中有什么方法可以检查windows服务的状态吗？

> ID：127299
> 
> 赞同：6
> 
> 时间：2008-09-24T13:57:52.800
> 
> 标签：java, windows-services, system-monitoring, system-status

我正在寻找一个库，它允许我查找 Windows 服务的状态以验证该服务是否已启动并正在运行。我查看了 Sigar 库，但它是 GPL，因此我无法使用它。需要商业或 BSD(ish) 许可证，因为这将捆绑到商业软件中。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-24T15:15:09.293

如果没有其他帮助，请尝试考虑一种稍微不同的方法（当然，如果可以的话），例如：

*   有很多免费/非免费软件可以进行监控，包括 Windows 服务监控（例如 nagios、Zabbix 等）。这些监视器通常具有开放的 API，您的 Java 应用程序可以通过多种不同的方式集成到其中。
*   如果您可以控制依赖的服务应用程序，请公开另一种不同的 Java 应用程序检查方式（例如，在端口上运行虚拟侦听器、创建文件等）。Windows 服务不是一个跨平台的东西，因此你不会期望很快就会得到支持。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-24T14:12:30.037

我认为没有任何纯 Java 方法可以做到这一点，因为某些操作系统没有 Windows 那样的“服务”概念。在我们的项目中，我们为从命令行调用“sc”命令编写了一个包装器。要获取服务的状态，您可以执行以下操作：

> sc \\some-computer 查询“我的服务名称”

您必须手动解析输出，但这非常简单。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-24T14:03:24.643

我不知道任何库，但根据您需要了解的详细程度，您可能会使用一些 shell 命令并解析输出。

NET START*服务名称*

将启动该服务，或者给您返回一条错误消息，告诉您它已经启动。不过，我不知道有任何命令可以为您提供状态。

# networking - 是否有任何一体化软件包可帮助在生产服务器上安装 wamp？

> ID：127305
> 
> 赞同：0
> 
> 时间：2008-09-24T13:59:10.770
> 
> 标签：networking, wamp

我需要在 windows2003 生产服务器上安装 amp。如果可能的话，我想要一个集成的安装/管理工具，这样我就不必单独安装/集成 amp 的组件。我发现的那些是“开发”服务器。是否有任何软件包可以在生产就绪（锁定状态）下安装 amp？

我知道 LAMP ... Windows，因为我们已经有 IIS 应用程序并且我们已经为这个盒子付费，所以这是一个要求。我会处理所有其他的挂断。我只想要一种简单的方法来安装、集成和管理 AMP。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-24T18:45:03.203

我不确定将 WAMP 作为生产服务器运行是个好主意。我使用 wamp 来暂存项目，然后将它们移动到 Linux 服务器。您可以尝试以下任何一种解决方案： [http](http://www.uniformserver.com/) ://www.uniformserver.com/ 有些人说他们在[WAMP Server上](http://www.wampserver.com/)[工作得很好](http://www.webmasterworld.com/apache/3421092.htm)，但同样，我不推荐它。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-24T18:28:53.337

似乎没有任何一体式包装是最新的并且“设计”用于生产。您只是不能相信默认安装是安全的。

我最终只是手动执行此操作。不过这并不痛苦。每个组件的安装过程都记录得相当好。花了我大约3.5小时。所涉及的设置的一个很好的副作用是它让我更好地理解了每个组件的依赖关系以及它们接触的方式。事后看来，我应该从一开始就手动完成。

注意：确保您阅读了每个组件文档页面下方的评论。有些包含对安装过程的有价值的更正。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-24T19:41:29.387

Xampp 很受欢迎，我只是不知道它的“生产水平”如何：

[http://www.apachefriends.org/en/xampp.html](http://www.apachefriends.org/en/xampp.html)

不想听起来像精英：对于“真正的”生产环境，单独设置和配置组件可能不是一个坏主意，但这需要比“点击设置并运行”更深入的知识。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-14T03:33:46.320

自从提出这个问题以来，Zend 已经发布了[Zend Server](http://www.zend.com/products/server/)。

> Zend Server 是一个完整的企业级 Web 应用程序服务器，用于运行和管理需要高度可靠性、性能和安全性的 PHP 应用程序。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-06-02T01:09:01.013

> 似乎没有任何一体式包装是最新的并且“设计”用于生产。您只是不能相信默认安装是安全的。

[WampDeveloper Pro](http://www.devside.net/server/webdeveloper)是一个商业 WAMP 包，专为生产使用（我使用）而设计。

我认为当被问到这个问题时，上述问题没有可行的解决方案。

# scrum - 在发布冲刺期间衡量进度的哪些方法是有效的

> ID：127308
> 
> 赞同：0
> 
> 时间：2008-09-24T14:00:25.743
> 
> 标签：scrum, release, sprint

编辑以提高清晰度

Scrum 建议您将开发拆分为多个 sprint。每个冲刺都是固定的持续时间。在每个 sprint 结束时，您都会询问客户是否应该发布该软件。如果他们说是，您将执行**发布冲刺**，在此期间您会​​连续执行所有您想做但成本太高的任务，例如外部用户测试、性能负载测试和签核、刻录 CD（如果相关） ，编写以用户为中心的文档等

在我当前的项目中，我们刚刚完成了我们的第一个发布冲刺。我们发现我们失去了 scrum 的很多优势，例如烧毁（因为很多事情都是在修复微小的调整或暂时从站点中删除安全性以便进行负载测试），一个明确的目标是要完成多少工作接下来完成等等。基本上，发布任务太接近消防，无法通过普通的 scrum 工具轻松跟踪。

在发布冲刺期间，其他人使用了哪些方法，您发现应该避免哪些陷阱？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-24T14:28:53.070

其实，我更喜欢[这个工具](http://en.wikipedia.org/wiki/Sharpie_(marker))。它进行任务跟踪、燃尽图、燃尽图，*对*项目笔记很有用。

但要回答这个问题，跟踪燃尽的剩余时间应该仍然有效。它仍然会告诉您是否要及时完成所有发布冲刺任务（错误/调整）以进行发布。如果答案是“不是全部”，那么是时候让产品负责人来做一些优先级排序，并将一些任务排除在 sprint 之外。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-24T14:10:34.113

我们正在使用带有 scrum的[看板。](http://www.agilemanagement.net/Articles/Weblog/KanbaninAction.html)每个产品项目都由白板上的便利贴表示。在每个人都在完成每项任务的每日站会中，这一点非常明显，我们可以看到我们在黑板上的“待处理”区域与另一端的“完成”区域相比排队了多少张票。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-24T15:21:25.550

您的目标应该是达到不需要发布冲刺即可部署到生产环境的程度：) 但是话虽如此，您在发布冲刺中正在做什么？还有一些任务要完成，但它们比开发代码更容易预测。除了通常涉及从操作人员向团队添加人员之外，我从未见过燃尽/计划的工作方式有什么不同。这当然可能是它自己的问题。也许您可以快速了解一下您的组织中的发布冲刺是什么样的。

# asp.net - 将 DataGrid 导出到 Excel 时出现问题

> ID：127316
> 
> 赞同：0
> 
> 时间：2008-09-24T14:01:25.383
> 
> 标签：asp.net

我首先在使用下面的代码时遇到了一个错误，解释说“DataGridLinkBut​​ton”必须放在带有 runat=server 的表单标签内。

现在我尝试将 AllowSorting 设置为 false，以及从每一列中删除排序表达式，但出现相同的错误。然后我尝试使用相同的数据源创建一个新的、普通的 DataGrid，但现在我得到一个空白页，FF 不再正确识别内容类型。请帮忙。

```
Response.Clear();
base.Response.Buffer = true;
base.Response.ContentType = "application/vnd.ms-excel";
base.Response.AddHeader("Content-Disposition", "attachment;filename=file.xls");
base.Response.Charset = "";
this.EnableViewState = false;
StringWriter writer = new StringWriter();
HtmlTextWriter writer2 = new HtmlTextWriter(writer);
this.lblExport.RenderControl(writer2);
base.Response.Write(writer.ToString()); 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-24T14:03:39.510

将以下空方法添加到您的代码中。那应该解决它。

```
public override void VerifyRenderingInServerForm(Control control)
    {
    } 
```

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2009-04-01T12:15:50.283

公共覆盖无效验证RenderingInServerForm（控制控制）{}

更多帮助请查看
[http://techdotnets.blogspot.com/](http://techdotnets.blogspot.com/)

# windows - cmd.exe 是否有类似 sed 的实用程序？

> ID：127318
> 
> 赞同：174
> 
> 时间：2008-09-24T14:01:42.277
> 
> 标签：windows, sed, cmd

我想使用 Windows 命令行 ( [cmd.exe](http://en.wikipedia.org/wiki/Windows_command_line) ) 以编程方式编辑文件内容。在 *nix 中有用于此任务的[sed](http://en.wikipedia.org/wiki/Sed)。Windows中有任何有用的本机等价物吗？

* * *

## 回答 #1

> 赞同：148
> 
> 时间：2011-05-17T09:35:12.447

今天powershell救了我。

因为`grep`有：

```
get-content somefile.txt | where { $_ -match "expression"} 
```

或者

```
select-string somefile.txt -pattern "expression" 
```

因为`sed`有：

```
get-content somefile.txt | %{$_ -replace "expression","replace"} 
```

有关替换 PowerShell 功能的更多详细信息，请参阅[此 Microsoft 文章](https://devblogs.microsoft.com/scripting/use-powershell-to-replace-text-in-strings/)。

* * *

## 回答 #2

> 赞同：105
> 
> 时间：2008-09-24T14:37:54.360

`sed`（及其同类）包含在几个 Unix 命令包中。

*   [Cygwin](http://cygwin.com/)有效，但非常庞大。
*   [UnxUtils](http://unxutils.sourceforge.net/)更苗条。
*   [GnuWin32](http://gnuwin32.sourceforge.net/)是另一个有效的端口。
*   另一种选择是 AT&T Research 的[UWIN 系统](http://www.research.att.com/sw/download/)。
*   [MinGw 的MSYS](http://www.mingw.org/wiki/msys)是另一种选择。
*   [适用于 Linux 的 Windows 子系统](https://en.wikipedia.org/wiki/Windows_Subsystem_for_Linux)是最“原生”的选项，但默认情况下它并未安装在 Windows 上；`sed`但是，它具有`grep`开箱即用的等功能。
*   [https://github.com/mbuilov/sed-windows](https://github.com/mbuilov/sed-windows)提供最新的 4.3 和 4.4 版本，与列出的上层端口不同，它们支持[`-z`选项](https://www.gnu.org/software/sed/manual/sed.html#Command_002dLine-Options-1)

如果您不想安装任何东西并且您的系统不是 Windows Server 系统，那么您*可以*为此使用脚本语言（例如 VBScript）。下面是一个粗暴的，即兴的刺伤它。你的命令行看起来像

```
cscript //NoLogo sed.vbs s/(oldpat)/(newpat)/ < inpfile.txt > outfile.txt 
```

其中 oldpat 和 newpat 是[Microsoft vbscript 正则表达式模式](http://msdn.microsoft.com/en-us/library/f97kw5ka(VS.85).aspx)。显然我只实现了替代命令并假设了一些事情，但您可以充实它以更智能并了解更多`sed`命令行。

```
Dim pat, patparts, rxp, inp
pat = WScript.Arguments(0)
patparts = Split(pat,"/")
Set rxp = new RegExp
rxp.Global = True
rxp.Multiline = False
rxp.Pattern = patparts(1)
Do While Not WScript.StdIn.AtEndOfStream
  inp = WScript.StdIn.ReadLine()
  WScript.Echo rxp.Replace(inp, patparts(2))
Loop 
```

* * *

## 回答 #3

> 赞同：23
> 
> 时间：2008-09-24T14:05:15.420

[UnxUtils](http://unxutils.sourceforge.net/)为 Win32 提供 sed，[GNUWin32 也是如此](http://gnuwin32.sourceforge.net/packages/sed.htm)。

* * *

## 回答 #4

> 赞同：18
> 
> 时间：2011-04-20T10:38:50.983

如果您不想安装任何东西（我假设您想将脚本添加到将在其他机器上运行的某个解决方案/程序/等中），您可以尝试创建一个 vbs 脚本（比如说，replace.vbs）：

```
Const ForReading = 1
Const ForWriting = 2

strFileName = Wscript.Arguments(0)
strOldText = Wscript.Arguments(1)
strNewText = Wscript.Arguments(2)

Set objFSO = CreateObject("Scripting.FileSystemObject")
Set objFile = objFSO.OpenTextFile(strFileName, ForReading)

strText = objFile.ReadAll
objFile.Close
strNewText = Replace(strText, strOldText, strNewText)

Set objFile = objFSO.OpenTextFile(strFileName, ForWriting)
objFile.Write strNewText
objFile.Close 
```

你像这样运行它：

```
cscript replace.vbs "C:\One.txt" "Robert" "Rob" 
```

类似于“bill weaver”提供的sed版本，但我认为这个在特殊(' > < / )字符方面更友好。

顺便说一句，我没有写这个，但我不记得我从哪里得到它。

* * *

## 回答 #5

> 赞同：12
> 
> 时间：2013-11-05T12:35:37.053

```
> (Get-content file.txt) | Foreach-Object {$_ -replace "^SourceRegexp$", "DestinationString"} | Set-Content file.txt 
```

这是的行为

```
sed -i 's/^SourceRegexp$/DestinationString/g' file.txt 
```

* * *

## 回答 #6

> 赞同：10
> 
> 时间：2009-05-26T17:49:20.830

[Super Sed](http://sed.sourceforge.net/grabbag/ssed/)是sed的增强版。对于 Windows，这是一个独立的 .exe，用于从命令行运行。

* * *

## 回答 #7

> 赞同：8
> 
> 时间：2008-09-24T14:11:24.860

你可以试试powershell。您可以使用内置的[get-content](http://technet.microsoft.com/en-us/library/bb978599.aspx)和[set-content命令行开关。](http://technet.microsoft.com/en-us/library/bb978562.aspx)

* * *

## 回答 #8

> 赞同：7
> 
> 时间：2008-09-24T14:11:32.177

我使用[Cygwin](http://www.cygwin.com)。我遇到很多人没有意识到如果将 Cygwin 二进制文件放在 PATH 上，则可以在 Windows Command shell 中使用它们。您不必运行 Cygwin 的 Bash。

您还可以查看Microsoft 提供的适用[于 Unix 的 Windows 服务](http://technet.microsoft.com/en-us/library/bb496506.aspx)（但仅限于专业版及更高版本的 Windows）。

* * *

## 回答 #9

> 赞同：7
> 
> 时间：2012-07-18T21:23:21.863

试试放屁.exe。它是一个查找和替换文本实用程序，可用于命令批处理程序。

[http://sourceforge.net/projects/fart-it/](http://sourceforge.net/projects/fart-it/)

* * *

## 回答 #10

> 赞同：6
> 
> 时间：2008-09-24T14:03:12.633

您可以安装 Cygwin ( [http://www.cygwin.com/](http://www.cygwin.com/) ) 并从那里使用 sed。

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2008-09-24T14:03:27.297

埃德林或编辑

另外还有适用于 Unix 的 Windows 服务，它带有许多适用于 windows 的 unix 工具。 [http://technet.microsoft.com/en-us/interopmigration/bb380242.aspx](http://technet.microsoft.com/en-us/interopmigration/bb380242.aspx)

2012 年 12 月 7 日更新 在 Windows 2003 R2、Windows 7 和 Server 2008 等中，上述内容被基于 UNIX 应用程序的子系统 (SUA) 作为附加组件取代。但您必须下载实用程序：http: [//www.microsoft.com/en-us/download/details.aspx?id=2391](http://www.microsoft.com/en-us/download/details.aspx?id=2391)

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2008-09-24T14:03:38.840

您可以查看[GNU Tools](http://gnuwin32.sourceforge.net/)，它们在 Windows 上提供（除其他外） sed。

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2013-11-05T13:04:14.927

有一个名为 Windows 的帮助程序批处理文件，`repl.bat`它具有 SED`doesn't require any additional download`或安装的大部分功能。它是一个混合批处理文件，用于`Jscript`实现功能等`swift`，以及`doesn't suffer from the usual poison characters`批处理和轻松处理空白行。

`repl`从 - [https://www.dropbox.com/s/qidqwztmetbvklt/repl.bat](https://www.dropbox.com/s/qidqwztmetbvklt/repl.bat)下载

替代链接 - [https://www.dostips.com/forum/viewtopic.php?f=3&t=6044](https://www.dostips.com/forum/viewtopic.php?f=3&t=6044)

作者是来自堆栈溢出和 dostips.com 的@dbenham

另一个名为的帮助程序批处理文件`findrepl.bat`为 Windows 用户提供了很多功能，`GREP`它也基于`Jscript`混合批处理文件，同样也是一个混合批处理文件。它共享 repl.bat 的好处

`findrepl`从 - [https://www.dropbox.com/s/rfdldmcb6vwi9xc/findrepl.bat](https://www.dropbox.com/s/rfdldmcb6vwi9xc/findrepl.bat)下载

作者是来自堆栈溢出和 dostips.com 的@aacini

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2008-09-24T14:08:31.887

据我所知，没有什么像 sed 与 windows 捆绑在一起的。但是，sed 以几种不同的形式可用于 Windows，包括作为 Cygwin 的一部分，如果你想要一个完整的 POSIX 子系统，或者作为一个 Win32 本机可执行文件，如果你想在命令行上运行 sed。

[用于 Windows 的 Sed（GnuWin32 项目）](http://gnuwin32.sourceforge.net/packages/sed.htm)

如果它需要原生于 Windows，那么我唯一可以建议的另一件事是使用 Windows 支持的脚本语言，无需附加组件，例如 VBScript。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2008-09-24T14:06:43.653

Cygwin 有效，但[这些](http://unxutils.sourceforge.net/)实用程序也可用。只需将它们放在您的驱动器上，将目录放入您的路径中，您就会拥有许多友好的 unix 实用程序。Cygwin 的轻量级恕我直言（尽管效果也一样）。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2013-04-24T15:17:37.420

我需要一个适用于 Windows cmd.exe 提示符的 sed 工具。[Eric Pement 将**sed**移植到单个 DOS .exe](http://www.pement.org/sed/)对我来说效果很好。

它有[据可查](http://www.pement.org/sed/sedfaq.html)。

# apache - gss_acquire_cred 返回 Key table entry not found 错误

> ID：127324
> 
> 赞同：2
> 
> 时间：2008-09-24T14:02:25.113
> 
> 标签：apache, authentication, kerberos

我一直在尝试按照[这篇 Microsoft 文章](http://support.microsoft.com/?id=555092)中的指南使用 Kerberos 和 AD 对 Apache 进行身份验证。我已经用kinit成功测试了apache服务器和AD服务器之间的通信。但是，当我尝试使用 IE 访问服务器上的受限页面时，出现内部服务器错误，并且 apache 错误日志中出现以下内容。

```
[Wed Sep 24 14:18:15 2008] [debug] src/mod_auth_kerb.c(1483): [client 172.31.37.38] kerb_authenticate_user entered with user (NULL) and auth_type Kerberos
[Wed Sep 24 14:18:15 2008] [debug] src/mod_auth_kerb.c(1174): [client 172.31.37.38] Acquiring creds for HTTP/srvnfssol1.dev.local@DEV.LOCAL
[Wed Sep 24 14:18:15 2008] [error] [client 172.31.37.38] gss_acquire_cred() failed: Miscellaneous failure (see text) (Key table entry not found) 
```

我已经在 apache 进程上运行了一个 truss，并确认它实际上正在加载 keytab 文件。我想知道keytab文件的格式是否有问题......

```
HTTP/srvnfssol1.dev.local@DEV.LOCAL 
```

我不确定我错过了什么。或者还有什么要检查的。

有什么建议么？

谢谢

彼得

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-06-11T03:41:21.807

行。密钥表应该包含服务主体名称，在本例中为“HTTP/srvnfssol1.dev.local@DEV.LOCAL”和加密密钥。我看到 MS 文档在哪里说只是将其回显到文件中，但我认为这是不对的。

您需要使用 ktpass 实用程序来创建密钥表。MS 文档在[这里](http://technet.microsoft.com/en-us/library/cc776746(WS.10).aspx)。

特别是，您需要指定`KRB5_NT_SRV_HST`，其余大部分选项都可以是默认选项。

我的机器上的示例：

```
C:\>ktpass /out test.keytab /princ HTTP/srvnfssol1.dev.local@DEV.LOCAL 
           /ptype KRB5_NT_SRV_HST /pass *
Type the password for HTTP/srvnfssol1.dev.local:
Key created.

Output keytab to test.keytab:

Keytab version: 0x502
keysize 62 HTTP/srvnfssol1.dev.local@DEV.LOCAL 
ptype 3 (KRB5_NT_SRV_HST) vno 1 etype 0x1 (DES-CBC-CRC) 
keylength 8 (0xa7f1fb38041c199e) 
```

如果活动目录服务器是 KDC，则需要使用`/map <name>`参数，`<name>`活动目录中代表服务器的计算机帐户在哪里。

关于这一切如何运作的一些细节。当您浏览到该网站时，它应该以 WWW-Authenticate: Negotiate 标头进行响应，并且您的浏览器将向 KDC（活动目录服务器）发送请求以获取该服务的 kerberos 票证。AD 服务器将使用服务主体名称查找票证的加密密钥，并将加密的服务票证发送回浏览器。一旦浏览器获得服务票证，它将重新发出带有包含票证的身份验证标头的 HTTP 请求。apache 服务器将在 keytab 中查找其密钥，解密票证并授予访问权限。

发生“未找到密钥表条目”错误是因为 apache 未在密钥表中找到自身。如果名称解析/领域设置不正确，也会发生这种情况。

You should be able to see all the kerberos requests AP-REQ/AP-REP/TGS-REQ/TGS-REP using wireshark on the client, tcp or udp port 88.

# java - JSP 中的 Java 常量

> ID：127328
> 
> 赞同：20
> 
> 时间：2008-09-24T14:02:53.677
> 
> 标签：java, jsp, constants, jsp-tags

我有一个定义各种常量名称的类，例如

```
class Constants {
    public static final String ATTR_CURRENT_USER = "current.user";
} 
```

我想在 JSP 中使用这些常量**而不**使用 Scriptlet 代码，例如：

```
<%@ page import="com.example.Constants" %>
<%= Constants.ATTR_CURRENT_USER %> 
```

[Apache非标准](http://jakarta.apache.org/taglibs/sandbox/doc/unstandard-doc/index.html#useConstants)标记库中似乎有一个提供此功能的标记。但是，我找不到任何下载此标记库的方法。我开始怀疑它是否已被弃用并且功能已移至另一个（Apache）标签库？

有谁知道我在哪里可以获得这个库，或者如果它不可用，是否有其他方法可以在不使用 scriptlet 代码的情况下访问 JSP 中的常量？

干杯，唐

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-24T14:17:36.437

在应用程序启动时，您可以将 Constants 类添加到 servletContext 中，然后在任何 jsp 页面中访问它

```
servletContext.setAttribute("Constants", com.example.Constants); 
```

然后在jsp页面中访问

```
<c:out value="${Constants.ATTR_CURRENT_USER}"/> 
```

（您可能必须为每个常量创建吸气剂）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-24T16:25:19.733

原来还有另一个提供相同功能的[标签库。](http://www.javaranch.com/journal/200601/Journal200601.jsp#a3)它也适用于枚举常量。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-07-16T20:56:21.743

[看起来像是在 JSP](https://stackoverflow.com/questions/122254/accessing-constants-in-jsp-without-scriptlet)中访问常量的副本（没有 scriptlet）

我的回答是：

在 EL 中无法访问静态属性。我使用的解决方法是创建一个将自身分配给静态值的非静态变量。

```
public final static String MANAGER_ROLE = 'manager';
public String manager_role = MANAGER_ROLE; 
```

我使用 lombok 来生成 getter 和 setter，这样就很好了。你的 EL 看起来像这样：

```
${bean.manager_role} 
```

完整代码在[https://rogerkeays.com/access-java-static-methods-and-constants-from-el](https://rogerkeays.com/access-java-static-methods-and-constants-from-el)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-24T15:25:50.827

你想使用什么样的功能？该标签应该能够通过类名和字段名访问任何公共类字段吗？

Scriptlet 链接在编译时完成，但 taglib 类字段访问必须在运行时使用 Java API 作为反射。你真的需要那个吗？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-24T16:33:22.147

我将在我的项目中使用 jakarta-taglibs-unstandard-20060829.jar 但是，你说得对，它似乎[不再可供下载了](http://jakarta.apache.org/taglibs/sandbox/doc/unstandard-doc/intro.html)。

我已经在我的 pom.xml 中获得了该库，但我认为它只会起作用，因为该库现在在我的本地存储库中（我在官方存储库中找不到它）：

```
 <dependency>
        <groupId>jakarta</groupId>
        <artifactId>jakarta-taglibs-unstandard</artifactId>
        <version>20060829</version>
    </dependency> 
```

我不知道是否还有其他选择。

我希望如此，因为这是在 JSP 中访问常量的好方法。

* * *

## 回答 #6

> 赞同：-3
> 
> 时间：2008-09-24T14:11:24.860

为什么要在 JSP 上打印常量的值？您肯定是在定义它们，以便在 JSP 中您可以从会话中提取对象并在呈现它们之前请求它们？

```
<%@ page import="com.example.Constants" %>
<%@ page import="com.example.model.User" %>
<%
用户 user = (User) session.getAttribute(Constants.ATTR_CURRENT_USER);
%>

<h1>欢迎<%=user.getFirstName()%></h1>

```

# outlook - 解密 Microsoft Outlook 的客户端规则二进制定义

> ID：127336
> 
> 赞同：7
> 
> 时间：2008-09-24T14:04:16.000
> 
> 标签：outlook

Outlook 将其客户端规则定义保存在配置文件默认存储的收件箱文件夹中隐藏消息中的二进制 blob 中。隐藏的邮件名为*“Outlook 规则管理器”*，邮件类别为`IPM.RuleOrganizer`。二进制 blob 保存在属性 0x6802 中。当您通过规则和警报向导手动导出规则时，相同的二进制 blob 会写入导出的 RWZ 文件。

有没有人破译过这个二进制 blob 的布局？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-25T23:39:58.837

嗯，这是一个艰难的...

这是[服务器端规则协议](http://209.85.173.104/search?q=cache:TUrkQGhrNpgJ:download.microsoft.com/download/5/D/D/5DD33FDF-91F5-496D-9884-0A0B0EE698BB/%255BMS-OXORULE%255D.pdf+%22IPM.RuleOrganizer%22&hl=en&ct=clnk&cd=7&gl=us)

根据这个[神秘的事件](http://msdn.microsoft.com/en-us/library/aa579224(EXCHG.80).aspx)，看起来你可能还需要在 Reflector 上花一些时间......

啊，这些看起来更接近标记和有希望的，给他们看：

[使用 Outlook 规则编程的说明](http://support.microsoft.com/kb/324568)

[如何使用 Rule.dll 示例在 Visual Basic 中创建收件箱规则](http://support.microsoft.com/kb/251125/)

一般来说，微软明确表示它没有在最后两个版本中保持文档符合规则，因此需要注意......

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2020-08-16T16:36:27.933

我遇到了完全相同的问题，所以我花了（太）长时间研究格式。

我开发了一个库[https://github.com/hughbe/OutlookRulesReader](https://github.com/hughbe/OutlookRulesReader)，其中包含一个规范和参考实现库（在 Swift 中），用于读取和编写 Outlook 规则文件

格式的完整描述可以在[这里找到](https://github.com/hughbe/OutlookRulesReader/raw/master/docs/RWZ%20Format.pdf)

# c# - .net 的 S/MIME 库？

> ID：127363
> 
> 赞同：9
> 
> 时间：2008-09-24T14:09:37.983
> 
> 标签：c#, encryption, mime

我需要使用 C# 创建 S/MIME 消息（如 RFC 2633、“S/MIME 版本 3 消息规范”和 RFC 3335 中所指定）。我能找到的唯一 S/MIME 库是一个商业库 ( [http://www.example-code.com/csharp/smime.asp](http://www.example-code.com/csharp/smime.asp) )，这对我们没有好处。

是否有任何现有的库来完成创建 S/MIME 消息，特别是 .p7s 文件？

我有所有需要进入此文件的加密和签名元素，但我想创建 .p7s 文件而不借助 RFC 文档手动处理我自己的库...

* * *

编辑：我找到了另一个[商业 S/MIME 库](http://www.eldos.com/sbb/desc-mime.php)，这仍然不符合我们的要求。它看起来越来越像我将不得不手动滚动一个 S/MIME 库，这很可悲。.net 中需要 S/MIME 的每个人都使用商业的封闭源代码库来实现吗？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2013-09-24T13:35:17.710

我编写了自己的 MIME 库，它支持名为[MimeKit](http://github.com/jstedfast/MimeKit)的 S/MIME ，它比基于 System.Net.Mail 的任何东西都要强大得多，后者被严重破坏了。

它支持原始 8 位标头、rfc822 组地址、从地址标头（To/Ccc/Bcc/etc）中的 rfc822 注释中提取名称、解析 mbox 格式的消息假脱机（包括支持基于 Content-Length 的 SunOS 格式），它是一个比任何其他 C# MIME 解析器快一个数量级，因为它基于字节流而不是基于 TextReader（这也是它比任何其他 C# 解析器更好地支持原始 8 位标头的方式）。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2013-08-22T22:53:44.813

我花了很多时间为 .NET 寻找一个好的 S/MIME 库，但没有成功。我最终创建了自己的，称为 OpaqueMail。

它是开源的并且完全免费。它继承自 System.Net.Mail.SmtpClient 类，因此移植现有代码很简单。它还包括使用 POP3 和 IMAP 的类。

[在http://opaquemail.org/](http://opaquemail.org/)上查看。

发送 S/MIME 三重包装消息（经过数字签名、加密，然后再次进行数字签名）的示例如下：

```
// Instantiate a new SMTP connection to Gmail using TLS/SSL protection.
SmtpClient smtpClient = new SmtpClient("smtp.gmail.com", 587);
smtpClient.Credentials = new NetworkCredential("username@gmail.com", "Pass@word1");
smtpClient.EnableSsl = true;

// Create a new MailMessage class with lorem ipsum.
MailMessage message = new MailMessage("username@gmail.com", "user@example.com", "Example subject", "Lorem ipsum body.");

// Specify that the message should be signed, have its envelope encrypted, and then be signed again (triple-wrapped).
message.SmimeSigned = true;
message.SmimeEncryptedEnvelope = true;
message.SmimeTripleWrapped = true;

// Specify that the message should be timestamped.
message.SmimeSigningOptionFlags = SmimeSigningOptionFlags.SignTime;

// Load the signing certificate from the Local Machine store.            
message.SmimeSigningCertificate = CertHelper.GetCertificateBySubjectName(StoreLocation.LocalMachine, "username@gmail.com");

// Send the message.
await smtpClient.SendAsync(message); 
```

希望这可以帮助。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-10-15T11:00:09.917

看看[Rebex Secure Mail](http://www.rebex.net/secure-mail.net/)。这是我使用多年的一个非常稳定的库。它是 100% 托管代码，并且源代码也可用。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-10-27T22:48:57.600

CodeProject 上有一个相当不错的 S/MIME 类。

[http://www.codeproject.com/KB/security/CPI_NET_SecureMail.aspx](http://www.codeproject.com/KB/security/CPI_NET_SecureMail.aspx)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-24T14:37:08.807

我没有使用过这个 S/MIME 库，但我的应用程序使用了来自同一供应商的另一个库，并且运行良好：

[http://www.chilkatsoft.com/mime-dotnet.asp](http://www.chilkatsoft.com/mime-dotnet.asp)

他们执行 p7s 签名的库是独立的，这可能是一个问题，具体取决于您的预算：

[http://www.chilkatsoft.com/crypt-dotnet.asp](http://www.chilkatsoft.com/crypt-dotnet.asp)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-20T09:48:18.557

实现完整的 s/mime 非常困难，因为它需要大量额外的工作。您可以将[SecureBlackbox 中的 SMIME 组件](http://www.eldos.com/sbbdev/net-mime.php)用于您的任务。

更新：SecureBlackbox 是我们的产品。它完全支持 Silverlight 和 Windows Phone（包括 Mango）。

# design-patterns - 编程语言和设计模式

> ID：127377
> 
> 赞同：3
> 
> 时间：2008-09-24T14:11:04.517
> 
> 标签：design-patterns, programming-languages

不同的编程语言具有不同的特性或缺少某些特性。设计模式是解决这些缺点的一种方法。我看过关于静态、面向对象语言（Java、C++）的设计模式的书籍和列表，还有关于 Python 设计模式的视频。

我有兴趣看到其他语言（如 Forth、Icon、Lisp 等）中的一些常见设计模式。简短描述它们的外观以及为什么需要它们在一种语言中会很好。也许与另一种无需设计模式即可解决此问题的语言进行简短比较。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-09-24T16:47:09.960

设计模式有时被称为“惯用语”。在非 OO 语言（C、Forth、COBOL 等）中，它们只是“通常的做事方式”。有时，它们被称为“算法”。每种语言（实际上，每个学科）都有设计解决方案的模式。

如果你已经看到了两三次，你就看到了一个模式。如果你能描述上下文、问题、解决方案和后果，你就已经将模式从模糊的东西提升到了具体和具体的东西。

在非 OO 语言中，模式通常不会被命名和分类。不知道为什么会这样，好像是这样。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-24T14:25:00.927

对于 LISP 中的设计模式，您可以阅读Peter Norvig 的[这篇文章。](http://www.norvig.com/design-patterns/)

引用[这张幻灯片](http://www.norvig.com/design-patterns/img010.gif)：

> 23 种设计模式中有 16 种是不可见的或更简单的

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-24T14:24:06.733

在 Lisp 中，您使用的不是设计模式：

*   lambda 和闭包（匿名函数和捕获环境）
*   高阶函数（处理函数的函数）
*   宏（语法扩展）
*   不同的评估策略（惰性评估、回溯）
*   一流的函数、类、命名空间、模块等。
*   动态环境（例如随时更换功能）
*   等等

我真的不知道设计模式在这种情况下意味着什么。如果设计模式是解决某些类型问题应该遵循的配方，那么它就是编程语言或环境中缺乏特性。计算机可以很好地处理重复性任务，因此必须实现设计模式并使用实际参数调用。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-24T14:29:44.253

设计模式并不是真的要与任何语言联系在一起。它们是针对常见问题的更通用的解决方案。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-24T14:30:24.843

C# 和 .Net 中的委托和事件使得实现[观察者模式](http://en.wikipedia.org/wiki/Observer_pattern)变得微不足道，因为它非常常用，例如处理 GUI 事件。

# debugging - 在 Visual Studio C++ 中，内存分配表示形式是什么？

> ID：127386
> 
> 赞同：233
> 
> 时间：2008-09-24T14:11:46.277
> 
> 标签：debugging, visual-c++

在 Visual Studio 中，我们都有过“baadf00d”，在运行时检查 C++ 调试器中的变量时见过“CC”和“CD”。

据我了解，“CC”处于调试模式仅表示内存何时被 new() 或 alloc() 和未初始化。而“CD”代表删除或释放的内存。我只在 RELEASE 版本中看到过“baadf00d”（但我可能错了）。

有时，我们会遇到处理内存泄漏、缓冲区溢出等情况，这些信息会派上用场。

有人愿意指出何时以及以何种模式将内存设置为可识别的字节模式以进行调试？

* * *

## 回答 #1

> 赞同：345
> 
> 时间：2008-09-24T14:14:34.710

此链接有更多信息：

[https://en.wikipedia.org/wiki/Magic_number_(programming)#Debug_values](https://en.wikipedia.org/wiki/Magic_number_(programming)#Debug_values)

```
* 0xABABABAB : Microsoft 的 HeapAlloc() 用于在分配堆内存后标记“无人区”保护字节
* 0xABADCAFE : 启动此值以初始化所有空闲内存以捕获错误指针
* 0xBAADF00D : 被微软的 LocalAlloc(LMEM_FIXED) 用来标记未初始化的分配堆内存
* 0xBADCAB1E : 与调试器的连接断开时返回到 Microsoft eVC 调试器的错误代码
* 0xBEEFCACE：被 Microsoft .NET 用作资源文件中的幻数
* 0xCCCCCCCC : 被微软的 C++ 调试运行时库用来标记未初始化的堆栈内存
* 0xCDCDCDCD : 被微软的 C++ 调试运行时库用来标记未初始化的堆内存
* 0xDDDDDDDD : 被微软的 C++ 调试堆用来标记释放的堆内存
* 0xDEADDEAD：用户手动启动崩溃时使用的 Microsoft Windows STOP 错误代码。
* 0xFDFDFDFD : 被微软的 C++ 调试堆用来标记分配堆内存前后的“无人区”保护字节
* 0xFEEEFEEE：被微软的 HeapFree() 用来标记释放的堆内存

```

* * *

## 回答 #2

> 赞同：114
> 
> 时间：2008-12-09T17:41:30.450

实际上，调试分配中添加了很多有用的信息。这张表更完整：

[http://www.nobugs.org/developer/win32/debug_crt_heap.html#table](http://www.nobugs.org/developer/win32/debug_crt_heap.html#table)

```
HeapAlloc() 之后的地址偏移量 malloc() 之后 free() HeapFree() 之后的地址
0x00320FD8 -40 0x01090009 0x01090009 0x01090009 0x0109005A Win32堆信息
0x00320FDC -36 0x01090009 0x00180700 0x01090009 0x00180400 Win32堆信息
0x00320FE0 -32 0xBAADF00D 0x00320798 0xDDDDDDDD 0x00320448 Ptr 到下一个 CRT 堆块（分配时间较早）
0x00320FE4 -28 0xBAADF00D 0x00000000 0xDDDDDDDD 0x00320448 Ptr 到上一个 CRT 堆块（稍后分配）
0x00320FE8 -24 0xBAADF00D 0x00000000 0xDDDDDDDD 0xFEEEFEEE malloc() 调用的文件名
0x00320FEC -20 0xBAADF00D 0x00000000 0xDDDDDDDD 0xFEEEFEEE malloc() 调用的行号
0x00320FF0 -16 0xBAADF00D 0x00000008 0xDDDDDDDD 0xFEEEFEEE 要 malloc() 的字节数
0x00320FF4 -12 0xBAADF00D 0x00000001 0xDDDDDDDD 0xFEEEFEEE 类型（0=释放，1=正常，2=CRT使用等）
0x00320FF8 -8 0xBAADF00D 0x00000031 0xDDDDDDDD 0xFEEEFEEE 请求编号，从0增加
0x00320FFC -4 0xBAADF00D 0xFDFDFDFD 0xDDDDDDDD 0xFEEEFEEE 无人区
0x00321000 +0 0xBAADF00D 0xCDCDCDCD 0xDDDDDDDD 0xFEEEFEEE 你想要的 8 个字节
0x00321004 +4 0xBAADF00D 0xCDCDCDCD 0xDDDDDDDD 0xFEEEFEEE 你想要的 8 个字节
0x00321008 +8 0xBAADF00D 0xFDFDFDFD 0xDDDDDDDD 0xFEEEFEEE 无人区
0x0032100C +12 0xBAADF00D 0xBAADF00D 0xDDDDDDDD 0xFEEEFEEE Win32 堆分配四舍五入到 16 字节
0x00321010 +16 0xABABABAB 0xABABABAB 0xABABABAB 0xFEEEFEEE Win32堆簿记
0x00321014 +20 0xABABABAB 0xABABABAB 0xABABABAB 0xFEEEFEEE Win32堆记账
0x00321018 +24 0x00000010 0x00000010 0x00000010 0xFEEEFEEE Win32堆簿记
0x0032101C +28 0x00000000 0x00000000 0x00000000 0xFEEEFEEE Win32堆簿记
0x00321020 +32 0x00090051 0x00090051 0x00090051 0xFEEEFEEE Win32堆簿记
0x00321024 +36 0xFEEE0400 0xFEEE0400 0xFEEE0400 0xFEEEFEEE Win32堆簿记
0x00321028 +40 0x00320400 0x00320400 0x00320400 0xFEEEFEEE Win32堆簿记
0x0032102C +44 0x00320400 0x00320400 0x00320400 0xFEEEFEEE Win32堆簿记

```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2018-01-15T00:25:48.377

`0xCC`特别是，`0xCD`这些是1980 年代**英特尔**8088 **/** **[8086](https://en.wikipedia.org/wiki/Intel_8086)**处理器指令集的遗留**[物。](https://en.wikipedia.org/wiki/Intel_8088)**[是软件中断](https://en.wikipedia.org/wiki/Interrupt)操作码 `0xCC`的特例。特殊的单字节版本允许程序生成**中断 3**。[`INT`](https://en.wikipedia.org/wiki/INT_(x86_instruction)) `0xCD``0xCC`

 **尽管软件中断号原则上是任意的，`INT 3`但传统上用于**调试器中断**或[断点](https://en.wikipedia.org/wiki/Breakpoint)功能，这一惯例一直保留到今天。每当启动调试器时，它都会安装一个中断处理程序，`INT 3`以便在执行该操作码时触发调试器。通常，它会暂停当前正在运行的程序并显示交互式提示。

通常，x86`INT`操作码是两个字节：`0xCD`后跟从 0 到 255 的所需中断号。现在，尽管您可以发出`0xCD 0x03`，`INT 3`但英特尔决定添加一个特殊版本——`0xCC`没有额外的字节——因为操作码必须只有一个字节才能用作未使用内存的可靠“填充字节”。

*这里的重点是在处理器错误地跳转到不包含任何预期指令的内存中*时允许优雅恢复。多字节指令不适合此目的，因为错误跳转可能会落在任何可能的字节偏移处，它必须继续使用正确形成的指令流。

显然，单字节操作码对此工作很简单，但也可能有一些奇怪的例外：例如，考虑到填充序列`0xCDCDCDCD`（也在本页中提到），我们可以看到它相当可靠，因为无论[指令指针](https://en.wikipedia.org/wiki/Program_counter)落在哪里（除了最后一个填充字节），CPU*可以*继续执行有效的**两字节**x86 指令`CD CD`，在这种情况下用于生成软件中断 205 (0xCD)。

更奇怪的是，虽然`CD CC CD CC`是 100% 可解释的 - 给出`INT 3`或`INT 204`- 序列`CC CD CC CD`不太可靠，如图所示只有 75%，但当作为 int 大小的内存填充符重复时通常为 99.99%。

[![来自同时代 8088/8086 指令集手册的页面显示 INT 指令](https://i.stack.imgur.com/sZNVv.png)](https://i.stack.imgur.com/sZNVv.png)
[*宏汇编器参考*, 1987]

# php - 关于 Url 编码的变音符号的路由问题（使用 Zend 框架）

> ID：127389
> 
> 赞同：2
> 
> 时间：2008-09-24T14:12:05.777
> 
> 标签：php, zend-framework

今天我偶然发现了一个问题，这似乎是 Zend 框架中的一个错误。给定以下路线：

```
<test>
    <route>citytest/:city</route>
    <defaults>
        <controller>result</controller>
        <action>test</action>
    </defaults>
    <reqs>
        <city>.+</city>
    </reqs>
</test> 
```

和三个网址：

*   mysite.local/citytest/柏林
*   mysite.local/citytest/汉堡
*   mysite.local/citytest/M%FCnchen

最后一个 Url 不匹配，因此不会调用正确的控制器。有人知道为什么吗？

仅供参考，Zend-Framework 1.0 在哪里使用（是的，我知道那很古老，但我不负责改变它：-/）

编辑：据我所知，我们将很快升级到 Zend 1.5.6，但我不知道什么时候，所以补丁会很棒。

编辑：我已经追踪到以下行（Zend/Controller/Router/Route.php:170）：

```
$regex = $this->_regexDelimiter . '^' . 
  $part['regex'] . '$' . 
  $this->_regexDelimiter . 'iu'; 
```

如果我将其更改为

```
 $this->_regexDelimiter . 'i'; 
```

有用。据我了解，u-修饰符用于处理亚洲字符。因为我不使用它们，所以我知道那个补丁很好。谢谢阅读。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2011-06-23T10:06:00.017

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-24T15:19:03.747

u 修饰符使正则表达式期望 utf-8 输入。这表明 ZF 需要 utf-8 编码输入，而不是 ISO-8859-1（我对 ZF 不太熟悉，所以我只是在这里猜测）。

如果是这种情况，您必须先对[utf-8 进行编码](http://www.php.net/utf8_encode)，`ü`然后才能在 URL 中使用它。然后它会变成：`mysite.local/citytest/M%C3%BCnchen`

请注意，由于您的应用程序的其余部分可能使用 ISO-8859-1（这是 PHP <= 5 的默认值），因此您必须使用[utf8_decode](http://www.php.net/utf8_decode)显式解码变量，然后才能使用它。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-27T18:25:27.770

问题如下：

> 使用 /u 模式修饰符可以防止单词被破坏，而是 PCRE 会跳过代码值大于 127 的字符串。因此，\w 根本不会匹配多字节（非低 ascii）单词（但也不会返回部分）。从 pcrepattern 手册页；
> 
> 在 UTF-8 模式下，值大于 128 的字符永远不会匹配 \d、\s 或 \w，而始终匹配 \D、\S 和 \W。即使 Unicode 字符属性支持可用，也是如此。

来自[使用 PHP 处理 UTF-8](http://www.phpwact.org/php/i18n/utf-8#w_w_b_b_meta_characters)。因此，如果您的 URL 是 ISO-8859-1 编码 (mysite.local/citytest/M%FCnchen) 或 UTF-8 编码 (mysite.local/citytest/M%C3%BCnchen)，这实际上是无关紧要的，默认的正则表达式不会匹配。

我还在 Zend Framework 中对 URL 中的变音符号进行了实验，得出的结论是，您实际上并不希望在 URL 中使用变音符号。问题是，您不能依赖浏览器对 URL 使用的编码。例如，Firefox（3.0 之前）不会对输入地址文本框的 URL 进行 UTF-8 编码（如果未在 about:config 中指定），并且 IE 在其选项中确实有一个复选框，可以在其 URL 的常规编码和 UTF-8 编码之间进行选择. 但是，如果您单击页面内的链接，两个浏览器都会使用给定编码的 URL（UTF-8 页面上的 UTF-8）。因此，您无法确定将 URL 以哪种编码方式发送到您的应用程序 - 并且检测所使用的编码方式并非易事。

也许最好在你的 URL 中使用音译参数（例如将 Ä 更改为 Ae 等）。有一个非常简单的方法（我不知道这是否适用于每种语言，但我将它与德语字符串一起使用并且效果很好）：

```
function createUrlFriendlyName($name) // $name must be an UTF-8 encoded string
{
    $name=mb_convert_encoding(trim($name), 'HTML-ENTITIES', 'UTF-8');
    $name=preg_replace(
        array('/&szlig;/', '/&(..)lig;/', '/&([aouAOU])uml;/', '/&(.)[^;]*;/', '/\W/'),
        array('ss', '$1', '$1e', '$1', '-'),
        $name);
    $name=preg_replace('/-{2,}/', '-', $name);
    return trim($name, '-');
} 
```

# c - 在 C 中查找变量的名称

> ID：127391
> 
> 赞同：3
> 
> 时间：2008-09-24T14:12:50.567
> 
> 标签：c, constants, c-preprocessor

昨晚有人问我一个 C 的问题，我不知道答案，因为我从大学开始就没有经常使用 C，所以我想也许我可以在这里找到答案，而不是忘记它。

如果一个人有一个定义，例如：

```
#define count 1 
```

该人可以使用其中的 1 找到变量名称`count`吗？

我不这么认为，因为我认为计数会指向 1，但看不到 1 如何指向计数。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-24T14:16:50.243

基于@Cade Roux 的回答，如果您使用预处理器#define 将值与符号相关联，则一旦预处理器运行，代码将不会对该符号有任何引用：

```
#define COUNT (1)
...
int myVar = COUNT;
... 
```

预处理器运行后：

```
...
int myVar = (1);
... 
```

正如其他人所指出的，这基本上意味着“不”，出于上述原因。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-09-24T14:16:06.207

简单的答案是否定的，他们不能。#Defines 这样的定义由预处理器处理，它们只指向一个方向。当然，另一个问题是即使编译器也不知道——因为“1”可以指向任何东西——多个变量可以同时具有相同的值。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-09-24T14:15:58.827

> > 那个人能用里面的 1 找到变量名“count”吗？

不

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-09-24T14:16:14.427

正如我确信比我更有说服力和精通的人会指出#define'd 的东西没有编译到源代码中，你所拥有的是一个预处理器宏，它将通过源代码并更改所有实例 'count ' 它找到一个 '1'。

但是，为了更清楚地说明您被问到的问题，因为 C 是一种编译语言，直到机器代码，您永远不会对 Java 或 C# 等语言进行反射和自省。除非你有一个围绕你的源代码/编译器构建的框架来做一些漂亮的事情，否则编译后所有的命名都会丢失。

希望**这**会有所帮助。（请原谅双关语）

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-24T14:17:27.107

不幸的是，这是不可能的。

`#define`语句是预处理器的指令，所有实例`count`都替换为`1`. 在运行时没有与 关联的内存位置`count`，因此努力显然是徒劳的。

即使您使用变量，编译后也不会残留程序中使用的原始标识符。这通常仅在动态语言中才有可能。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-24T14:25:48.367

C 中使用的一种技巧是在宏中使用 # 语法来获取宏参数的字符串文字。

```
#define displayInt(val) printf("%s: %d\n",#val,val)
#define displayFloat(val) printf("%s: %d\n",#val,val)
#define displayString(val) printf("%s: %s\n",#val,val)

int main(){
  int foo=123;
  float bar=456.789;
  char thud[]="this is a string";

  displayInt(foo);
  displayFloat(bar);
  displayString(thud);

  return 0;
} 
```

输出应如下所示：

```
foo: 123
bar: 456.789
thud: this is a string 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-09-24T14:42:57.060

`#define count 1`是一个非常糟糕的主意，因为它会阻止您命名任何变量或结构字段`count`。

例如：

```
void copyString(char* dst, const char* src, size_t count) {
   ...
} 
```

您的`count`宏将导致变量名称被替换为`1`，从而阻止此函数编译：

```
void copyString(char* dst, const char* src, size_t 1) {
   ...
} 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-24T14:15:57.483

C 定义是预处理器指令，而不是变量。在编译之前，预处理器将遍历您的 C 文件并用您定义的内容替换您编写 count 的位置。查看混淆的 C 竞赛条目，了解此和其他预处理器指令的一些特别开明的用途。

关键是没有“计数”指向“1”值。它只是在代码真正编译*之前*发生的简单/查找替换操作。

我会将这个可编辑的内容留给真正了解 C 的人来纠正。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-24T14:33:12.700

`count`不是变量。它没有分配给它的存储空间，也没有符号表中的条目。在将源代码传递给编译器之前，它是一个被预处理器替换的宏。

如果您没有提出完全正确的问题，有一种方法可以使用宏获取名称：

```
#define SHOW(sym) (printf(#sym " = %d\n", sym))
#define count 1

SHOW(count); // prints "count = 1" 
```

运算符将`#`宏参数转换为字符串文字。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-24T14:14:19.377

“发现”是什么意思？

线

```
#define count 1 
```

定义一个值为 1 的符号“count”。

编译过程的第一步（称为预处理）会将每次出现的符号计数替换为 1，这样如果您有：

```
if (x > count) ... 
```

它将被替换为：

```
if (x > 1) ... 
```

如果你明白了，你可能会明白为什么“查找计数”是没有意义的。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-24T14:14:46.257

`#define`是预处理器指令，因此它不是“变量”

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-09-24T14:16:36.657

你所拥有的实际上不是一个变量，它是一个预处理器指令。当您编译代码时，预处理器将通过并将该文件中单词“count”的所有实例替换为 1。

你可能会问我是否知道 1 我可以找到 count 指向它吗？不，因为变量名称和值之间的关系不是双射，所以没有退路。考虑

```
int count = 1;
int count2 = 1; 
```

完全合法，但 1 应该解决什么问题？

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-09-24T14:16:51.897

一般来说，没有。

首先，#define 不是变量，它是编译器预处理器宏。

到编译器的主要阶段开始工作时，名称已被替换为值，并且名称“count”将不存在于编译的代码中的任何地方。

对于变量，在运行时无法在 C 代码中找出变量名。不保留该信息。与 Java 或 C# 等语言不同，C 在编译为汇编语言时根本不保留太多元数据。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-09-24T14:16:59.230

以“#”开头的指令由预处理器处理，该预处理器通常在将代码传递给“真实”编译器之前进行文本替换。因此，没有名为 count 的变量，就好像代码中的所有“count”字符串都被神奇地替换为“1”字符串。

所以，不，没有办法找到那个“变量”。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-09-24T14:17:08.090

如果是宏，则会对其进行预处理并编译生成的输出。所以绝对没有办法找出这个名字，因为在预处理器完成他的工作后，生成的文件将在文件中的任何地方包含“1”而不是“count”。

所以答案是否定的。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2008-09-24T14:18:43.280

如果他们正在查看 C 源代码（他们将在调试器中），那么他们将看到类似

```
int i = count; 
```

那时，他们可以向后搜索并找到该行

```
#define count 1 
```

但是，如果他们所拥有的只是变量 iDontKnowWhat，并且他们可以看到它包含 1，则无法将其追溯到“计数”。

为什么？因为#define 是在预处理器时评估的，这甚至发生在编译之前（尽管对于几乎所有人来说，它可以被视为编译的第一阶段）。因此，源代码是唯一包含有关“计数”的任何信息的东西，就像知道它曾经存在过一样。到编译器查看时，对“count”的每个引用都已替换为数字“1”。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2008-09-24T14:18:54.857

它不是一个指针，它只是一个字符串/令牌替换。预处理器会在您的代码编译之前替换所有#defines。大多数编译器都包含一个 -E 或类似的参数来发出预编译代码，因此您可以看到处理完所有#directives 后代码的样子。

更直接地回答您的问题，没有办法告诉代码正在替换令牌。您的代码甚至无法区分 (count == 1) 和 (1 == 1)。

如果您真的想这样做，则可以使用源文件文本分析，例如使用差异工具。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2008-09-24T14:26:11.157

问这个问题的人（这是一个面试问题吗？）可能一直试图让你区分使用#define 常量和枚举。例如：

```
#define ZERO 0
#define ONE 1
#define TWO 2 
```

对比

```
enum {
  ZERO,
  ONE,
  TWO
}; 
```

给定代码：

```
x = TWO; 
```

如果您使用枚举而不是 #defines，一些调试器将能够向您显示值的符号形式 TWO，而不仅仅是数值 2。

# .net - .NET SOAP 常用类型

> ID：127395
> 
> 赞同：2
> 
> 时间：2008-09-24T14:13:29.753
> 
> 标签：.net, soap, types

有没有办法在创建 Web 服务时指定要使用的类型？具体来说，我希望能够在客户端和服务器上使用相同的类型，以减少代码重复。

过度简化的例子：

```
 public class Name
    {
        public string FirstName {get; set;}
        public string Surname { get; set; }

        public override string ToString()
        {
            return string.Concat(FirstName, " ", Surname);
        }
    } 
```

我不想在我的课堂上重新编码一些功能。另一件事是存在的任何操纵此类的代码都不会在客户端工作，因为生成的客户端类将是不同的类型。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-27T06:26:50.790

好的，我知道这是 SOAP 的明确设计决定，因此您实际上不应该这样做。我发现以下[页面](http://msdn.microsoft.com/en-us/library/ms978594.aspx)解释了原因：

> **服务共享模式和契约，而不是类**。服务仅在其通过模式的结构表达和通过合同的行为上进行交互。该服务的契约描述了消息的结构和消息的排序约束。表达式的形式允许对传入消息进行机器验证。传入消息的机器验证允许您保护服务的完整性。合同和模式必须随着时间的推移保持稳定，因此灵活地构建它们很重要。

话虽如此，还有另外两种可能：

1.  在 Visual Studio 中或使用 wsdl.exe 生成 Web 引用。然后进入生成的 Reference.cs（或 .vb）文件并显式删除类型。然后重定向到您想要位于另一个程序集中的类型。
2.  您可以通过 wsdl.exe 和 /sharetypes 参数在客户端的 Web 服务之间共享类型。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-24T15:34:42.117

如果您想在您的 Web 服务和您的客户端之间共享一个类型或结构，请向您的 Web 服务项目添加一个公共结构，如下所示：

```
public struct Whatever
{
    public string A;
    public int B;
} 
```

然后向您的 Web 服务添加一个方法，该方法具有此结构作为其返回类型：

```
[WebMethod]
public Whatever GiveMeWhatever()
{
    Whatever what = new Whatever();
    what.A = "A";
    what.B = 42;
    return what;
} 
```

更新客户端的 Web 引用后，您将能够在客户端应用程序中创建类型为“Whatever”的结构，如下所示：

```
Webreference.Whatever what = new Webreference.Whatever();
what.A = "that works?";
what.B = -1; // FILENOTFOUND 
```

这种技术使您可以维护需要在一个地方（Web 服务项目）来回传递的任何结构的定义。

# java - 设计模式的Java注释？

> ID：127411
> 
> 赞同：16
> 
> 时间：2008-09-24T14:15:30.717
> 
> 标签：java, design-patterns, annotations

是否有维护模式注释的项目？

例如，当我编写一个构建器时，我想用`@Builder`.

以这种方式进行注释可以立即清楚地了解代码实现了什么。此外，`@Builder`注解的 Javadoc 可以参考构建器模式的解释。此外，从构建器实现的 Javadoc 导航到`@Builder`Javadoc 可以通过`@Builder`使用`@Documented`.

我正在放慢为我的代码中的模式和习语积累一小组此类注释的速度，但我想利用一个更完整的现有项目（如果存在）。如果没有这样的项目，也许我可以通过将其拆分为单独的模式/习语注释项目来分享我拥有的东西。

更新：我创建了[Pattern Notes 项目](http://code.google.com/p/patternnotes)来响应这个讨论。欢迎投稿！这是[`@Builder`](http://code.google.com/p/patternnotes/source/browse/trunk/trunk/src/com/iparelan/annotations/patterns/Builder.java)

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-24T15:03:14.703

这对我来说似乎是对注释的滥用。当然，我可以理解为什么您可能想注意一个类正在帮助实现的设计模式，但是只使用 Javadoc 和/或类的名称似乎更合适。您正在使用的模式的名称对代码本身并不重要......模式只是解决问题的常用方法的指南。注释就足够了，而不是为您使用的每个模式创建一个新文件。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-04-23T21:40:19.307

这是一个有趣的解决方案，但我一直想知道您要解决的真正问题是什么？或者换句话说，你从使用这样的东西中得到了什么，而你在课堂上对它的使用进行了适当的评论却没有得到什么？

我可以想到一些缺点，但除了这是一种很好的标准化代码文档方式之外，我想不出其他好处。

缺点是，即：

1.  程序员要考虑的另一件事，这绝不是一件好事
2.  未注释的模式可能会令人困惑 - 有人可能忘记记录它，但也许它不是模式..？
3.  你真的能注释所有模式吗..？那些不依赖于单个类/方法的模式，例如三层架构模式，或线程池，甚至 MVC 呢？

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2010-07-28T06:33:13.697

Michael Hunger 和我已经启动了一个用于注释的开源项目，以指定类所属的模式。我们正处于起步阶段，但很想听听您的意见。

我想采用 KISS 原则，以使人们尽可能容易地使用注释。例如，如果你正在编写一个适配器，你可以简单地说：

```
@AdapterPattern
public class EnumerationIteratorAdapter<T> implements Enumeration<T> {
  ...
} 
```

当然，您可以根据需要指定更多信息，例如角色、参与者和评论。我们希望这将使开发人员更容易清楚地标记他们的类。

项目主页位于[http://www.jpatterns.org](http://www.jpatterns.org)，您还可以从中访问初始源代码树。如果您想为该项目做出贡献，请通过 javaspecialists dot eu 与我联系。

Heinz（Java 专家时事通讯）

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-10-09T13:51:57.297

我刚刚偶然发现了另一篇对您来说很有趣的文章：[Design Markers - Explicit Programming for the Rest of Us](http://onjava.com/lpt/a/3340)，其中讨论了标记接口，例如`Serializable`.

用他们的话来说：

> ...仅仅因为一个类声明它“实现了 Serializable”并不意味着它已经正确地实现了 Serializable 契约。
> 
> 由于 Java 无法真正判断合同是否已得到满足，因此使用标记接口更像是程序员的明确承诺。
> 
> 标记界面被忽视的好处是它们还记录了应满足合同的意图......

> 为什么设计选择传统上没有记录在源代码中？主要是因为没有明确的地方放置它们。
> 
> 即使每个“类型安全枚举”类都有注释指出它遵循该模式，也不会添加任何详细说明（更不用说教程信息），因为必须重复复制它，或者更糟糕的是，将其零星地放置在任意位置。
> 
> 在创建附加到每个 Design Marker 接口的 JavaDoc 注释时，可以比典型的更详细，因为注释不需要在其他任何地方重复。

他们还提到了一些缺点，这是一个很好的思考！

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-12-03T21:56:41.923

更好的是使用注释来实际构建构建器的样板。让我们面对它最标准。

```
@Builder("buildMethodName")
Class Thing {
  String thingName;
  String thingDescr;
} 
```

典型用途：

```
Thing thing =
      new Thing.Builder().setThingName("X").setThingDescr("x").buildMethodName(); 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-10-07T09:54:21.253

首先，您要做的是记录意图（或意图*s*）。

那么，为什么不使用注释的通用版本，例如使用[@Documented的](http://java.sun.com/j2se/1.5.0/docs/api/java/lang/annotation/Documented.html)**@UsePattern 之**类的标记注释（[来自 IBM 的不错的教程](http://www.ibm.com/developerworks/library/j-annotate2.html#N101FE)）？我不喜欢的是注释在运行时保留，除非您想影响程序语义，否则这是一种浪费。

或者看起来更合适的[自定义 Javadoc 标记。](http://java.sun.com/j2se/1.5.0/docs/tooldocs/windows/javadoc.html#tag)

关于比较的一些信息：[Comparing Annotations and Javadoc Tags](http://java.sun.com/j2se/javadoc/writingdoccomments/index.html#annotations) with a nice one sentence summmary：

<<**一般来说，如果标记是为了影响或产生文档，它可能应该是一个 javadoc 标记；否则，它应该是一个注释。**>>

关于[文档作为注释或 javadoc 标签](http://forums.java.net/jive/thread.jspa?threadID=247)也存在/曾经有过一些争论。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2010-04-08T20:58:07.453

对我来说，这似乎是对注释的滥用。除非打算使用这些注释来实现行为，否则我会使用 KISS 原则：Plain ol' javadoc 可以很好地记录工件应该做什么/应该做什么；用于扩展 javadoc 的自定义 doclet；对于那些想知道 X 或 Y 模式是什么（或网络上某个地方的链接）的人来说，谷歌。

对于大多数模式，都有出色的、准官方的解释。为什么要自己写？是否有对项目至关重要的其他信息？使用注释确保可以从一个类的 javadoc 导航到自定义编写的模式 javadoc 就像 CEO 组建了一个开发团队来创建一个包含两个现有季度报告总数的报告的故事 - 这太难了（而且更便宜）每年用计算器将两者相加 4 次：-/

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-10-13T13:38:02.080

另外还有这篇 2008 年计算机科学论文：[Java 和 AspectJ 中的设计模式实现](http://www.cs.ubc.ca/labs/spl/papers/2002/oopsla02-patterns.pdf)，它在 OOPSLA 2008 上发表，应该可以说明它的质量。

一个很好的报价：

> ...仅仅存在专门包含模式代码的类就可以作为正在使用的模式的记录。在 AspectJ 案例中，我们观察到两个额外的改进。首先，与特定模式实例相关的所有代码都包含在单个模块中（定义参与者、分配角色等）。这意味着模式实例的整个描述都是本地化的，并且不会在系统中“丢失”[21] 或“退化”[7]。其次，在当前的 AspectJ IDE 支持下，所有引用、建议方法等都是超链接，允许开发人员概览角色分配以及感兴趣的概念操作在哪里……

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-08-18T11:01:06.963

如果您还可以编写一个注释处理器来验证模式的某些属性 - 例如在实现模式时检查常见错误 - 这将非常有用。编译器和程序员的文档。

* * *

## 回答 #10

> 赞同：-2
> 
> 时间：2010-07-08T14:01:48.357

首先，这是一个非常好的主意，我只是在这里闲逛，因为我搜索了一个“设计模式注释”库。很好，我找到了这个！我会检查它并尽快给予反馈。

致所有怀疑论者：很抱歉，你们中的大多数人在设计模式的话题上并不是很有经验。例如，Martin Harris 的帖子从 09 年 12 月 3 日 21:56 开始......我了解您想要保持您的“示例”简单。但这不是设计模式意义上的构建器。

我想对那些根本看不到有用性的人说同样的话。如果类与它们在设计模式中的角色的关系被注释到类中，我可以使用生成器来制作样板代码。我在源代码中看到类顶部的所有关系，并且可以使用我的 IDE 快捷方式导航到相关类。

如果你学会了用模式思考并且所有模式在源代码中都很明显（通过注释或注释），你可以在不到一个小时的时间内掌握一个由 200 个类组成的系统。

关于使用@UsePattern() 或@Builder("buildMethodName") 等建议......在这里我们不得不问，如何让它“typesave”？毕竟这些字符串很容易出现拼写错误。

正确注释的一个优点是您可以注释角色……大多数设计模式不是由单个类（如 Singleton）组成，而是由几个一起工作的类组成！例如，如果您有一个构建器，则结果（用@Product 注释）也可能是一个@Composite。因此，构建器组合在一起的部分将是@Component（关于@Composite）和一个@Part（关于@Builder 和@Product）。

此类注释的最佳论据可能是 java.lang.class，因此您可以表达这一点。

无论如何，只是一些想法......我迫不及待地想回家玩你目前拥有的东西^^

# search-engine - 使用 Google 桌面进行源代码搜索

> ID：127412
> 
> 赞同：15
> 
> 时间：2008-09-24T14:15:35.193
> 
> 标签：search-engine, code-search-engine, google-desktop-search

是否有允许源代码搜索的 GDS 索引插件？我看到一些用于特定类型（Java、C++、...），另一种用于“任何文本”。这些很好，但我想要一个允许许多/可配置的扩展（HTML、CSS、JS、VB、C#、Java、Python ......）。一个巨大的好处是允许在缓存中突出显示语法（ [http://pygments.org/ ）。](http://pygments.org/)

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2011-10-04T00:53:11.843

我刚刚发现 Dropout，它似乎工作得很好。将 Dropout 放在任何文件夹中，它将索引该文件夹中的所有文件。我把它放在我的项目文件夹中，它爬取了我所有的代码。非常快速和灵活的搜索。 [辍学](http://dropout.codeplex.com/)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-24T14:37:59.927

您可以改用[OpenGrok](http://opengrok.github.io/OpenGrok/)或其他一些特定于代码的搜索引擎。

不久前，我对其中一些进行[了快速评论。](http://bugsquash.blogspot.com/2007/09/code-search-engines-mini-review.html)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-24T14:53:33.043

已经很长时间了，但是我上次尝试使用 Google 桌面搜索来搜索代码时，我发现它非常不适合该任务，正如我在 [ [http://perlmonks.org/?node_id=490310]](http://perlmonks.org/?node_id=490310])中概述的那样，其要点是 GDS（默默地）只索引了许多源代码文件中的一小部分（并且很难弄清楚为什么搜索经常无法找到源代码文件中的这么多内容）。

我发现 Copernic Desktop Search 在代码文件上工作得更好（但我也遇到了更高版本的问题，因为它无法找到所有匹配项，所以我一直使用 2.1.1 版本）。但是这些天我用的不多（主要是因为我没有权限在我的新雇主提供的笔记本电脑上安装这些东西）。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-07-17T06:44:38.803

你可以试试[Larry 的 Any Text File Indexer](http://desktop.google.com/plugins/i/indexitall.html)。您可以在安装时指定扩展名列表，它将对这些文件类型进行全文搜索。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-03-10T11:05:16.893

我只是试一试：

[http://desktop.google.com/plugins/i/java.html?hl=en](http://desktop.google.com/plugins/i/java.html?hl=en)

..您也可以在 Google 桌面中使用以下语法搜索 Java 树中的内容：

```
<YOUR SEARCH> filetype:java under:"C:\hft\trunk" 
```

..我将代码保存在“C:\hft\trunk”中

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-03-10T16:13:55.860

这不是 Google 桌面插件，但可以满足我们的需要。

我们已经开始使用[http://svnquery.tigris.org/](http://svnquery.tigris.org/)并且它似乎工作并且非常快。我希望它支持每个站点的多个存储库。我们每个项目都有一个存储库，所以目前我必须为我们拥有的每个项目创建一个虚拟目录。不是一个显示停止器，只是我们需要在我们的项目设置脚本中自动化的东西。

# asp.net - 控件不会出现在动态创建的用户控件上

> ID：127413
> 
> 赞同：5
> 
> 时间：2008-09-24T14:15:36.830
> 
> 标签：asp.net, user-controls, dynamic-controls

我有一个名为 DateTimeUC 的用户控件，它的标记上有两个文本框：

```
<asp:TextBox ID="dateTextBox" runat="server"></asp:TextBox>
<asp:TextBox ID="timeTextBox" runat="server"></asp:TextBox> 
```

我在另一个用户控件中动态创建此控件：

```
Controls.Add(GenerateDateTime(parameter));
private DateTimeUC GenerateDateTime(SomeParameter parameter)
{
    DateTimeUC uc = new DateTimeUC();
    uc.ID = parameter.Name;
    return uc;
} 
```

但是当我渲染页面时，DateTimeUC 什么都不渲染。我是这样检查的：

```
protected override void Render(HtmlTextWriter writer)
{
    base.Render(writer);

    StringBuilder builder = new StringBuilder();
    StringWriter swriter = new StringWriter(builder);
    HtmlTextWriter hwriter = new HtmlTextWriter(swriter);
    base.Render(hwriter);
    string s = builder.ToString();
} 
```

s 为空，Controls.Count 为 0。我做错了什么？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-09-24T14:17:27.293

您必须使用该`LoadControl( "your_user_control_app_relative_path.ascx" )`方法而不是“DateTimeUC uc = new DateTimeUC();”

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-24T14:22:26.750

不久前，我自己也遇到了这个问题。您需要使用 LoadControl() 方法。看看[这个页面](http://www.dotnetjunkies.com/WebLog/leon/archive/2004/08/28/23559.aspx)就可以了。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-24T14:24:39.977

我认为您想将控件添加到页面的表单而不是表单本身。

你的代码：

```
Controls.Add( GenerateDateTime(parameter) ); 
```

尝试：

```
Page.Form.Controls.Add( GenerateDateTime(parameter) ); 
```

# visual-sourcesafe - 历史在 VSS 中不可见，现在怎么办？

> ID：127423
> 
> 赞同：1
> 
> 时间：2008-09-24T14:16:16.703
> 
> 标签：visual-sourcesafe

我的任务是“修复”一个旧的 VSS 数据库。目前，我们正在考虑迁移到 TFS，但就目前而言，如果我们能让 VSS 恢复到稳定状态，它会让人安心。

我们开始担心 VSS 会死在我们身上，因为当我们尝试查看任何文件的历史记录时，似乎什么都没有发生——对话似乎只是被忽略了。也就是说，我们从 Visual Studio 签出和签入似乎没有任何问题，并且将更改的文件与 VSS 的最新文件进行比较似乎有效（尽管我怀疑这是 VSS 的功能以及 Visual Studio 的更多功能）。

我备份了项目文件夹，然后运行分析实用程序，它说它没有发现任何问题。我不确定还能尝试什么。帮助！

我们在 Windows 2000 上运行 VSS 2005。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-24T14:29:57.030

这是问题吗？

[http://support.microsoft.com/kb/910793/en-us?spid=10433&sid=global](http://support.microsoft.com/kb/910793/en-us?spid=10433&sid=global)

# login - 使用 OpenID 作为我网站的登录名 - 冗余提供商

> ID：127424
> 
> 赞同：1
> 
> 时间：2008-09-24T14:16:18.840
> 
> 标签：login, openid, replication, reliability, redundancy

如何在我的 OpenID 登录网站上支持冗余？

例如，我的用户要求 100% 的正常运行时间（是的，没错，但让我们尽可能接近）。

他们中的一些人使用较少可用的提供程序（即，他们自己网站上的 myphpid，或者经常停机的初创公司的 ID）。现在我可以把他们送到更可靠的供应商那里，但我也想有一些冗余。

我希望我可以部署的一种解决方案，但对 OpenID 了解不够，可以尝试：

在具有相同凭据（哈希/密钥/等）但不同域的不同托管服务上设置多个 phpmyid（理想情况下，我有一个循环 DNS 和相同名称，但我也想考虑它们不同的情况域）。

这行得通吗？换句话说，我在不同的服务器上拥有完全相同的 phpmyid 文件，包括凭据。我可以使用 example.com/id 和 example2.com/id 并期望它在我的终端看起来相同，这样我就不必将多个 OpenId 帐户链接到我系统中的每个用户？

虽然我使用 phpmyid 的示例，但问题更笼统 - 凭据是重要的，还是域/ip/？？？还以防止这种方式链接？

是否存在或是否存在一种标准，允许人们将自己的 OpenID 从一个提供商转移到另一个提供商，而不必在他们使用该 openid 的每个网站上断开和重新链接？

-亚当

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-24T20:24:56.910

OpenID 是一个 URL。example.com/id 和 example2.com/id 是两个不同的 OpenID，无论是哪个提供商托管它们或用户与这些提供商共享什么凭据。OpenID 的可靠性实际上归结为托管该 URL 的可靠性。是的，您可以在 XRDS 文档中定义后备提供程序，但您仍然必须首先能够从 OpenID URL 中发现该文档。

因此，OpenID 的可靠性技术在很大程度上与任何其他具有固定 URL 的 Web 资源相同。而且，作为依赖方，您对此无能为力。正如您所说，由您的用户选择适合他们自己要求的 OpenID 提供程序。您可能会建议您的用户询问他们的 OpenID 提供商是否有可用的服务级别协议。

您可以做的一件事是允许您的用户将他们在您的应用程序中的帐户与多个 OpenID 相关联。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-24T14:22:39.637

我最近发布[了对“如何使用多个 OpenID？”这个问题的回答。](https://stackoverflow.com/questions/4661/how-do-i-use-more-than-one-openid#112662)这可能会解决您的担忧。

专业提供商应该有一个冗余服务，通常通过在两个单独的服务器前面安装一个负载平衡器来归档，但是用户应该在一个自定义域（或使用 i-name）上托管一个 XRDS 文档，并引用不同的提供商（用于回退目的）

您还可以在不同的服务器上托管相同的数据，但循环不会帮助您。这是因为轮询只是充当一个简单的负载均衡器（它不检查主机是否可访问）。

# c++ - GNU 编译器警告“类具有虚函数但非虚析构函数”

> ID：127426
> 
> 赞同：59
> 
> 时间：2008-09-24T14:16:22.290
> 
> 标签：c++, gcc

我在 C++ 中定义了一个接口，即一个只包含纯虚函数的类。

我想明确禁止接口的用户通过指向接口的指针删除对象，所以我为接口声明了一个受保护的非虚拟析构函数，例如：

```
class ITest{
public:
    virtual void doSomething() = 0;

protected:
    ~ITest(){}
};

void someFunction(ITest * test){
    test->doSomething(); // ok
    // deleting object is not allowed
    // delete test; 
} 
```

GNU 编译器给我一个警告说：

> 类“ITest”具有虚函数但非虚析构函数

一旦析构函数受到保护，将其设为虚拟或非虚拟有什么区别？

您认为可以安全地忽略或消除此警告吗？

* * *

## 回答 #1

> 赞同：66
> 
> 时间：2008-09-24T14:26:09.317

这或多或少是编译器中的一个错误。请注意，在最新版本的编译器中，不会抛出此警告（至少在 4.3 中不会）。在您的情况下，让析构函数受到保护且非虚拟是完全合法的。

请参阅[此处](http://www.gotw.ca/publications/mill18.htm)查看 Herb Sutter 撰写的关于该主题的优秀文章。来自文章：

准则 #4：基类析构函数应该是公共的和虚拟的，或者是受保护的和非虚拟的。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-09-24T14:21:48.047

关于这个答案的一些评论与我之前给出的答案有关，这是错误的。

受保护的析构函数意味着它只能从基类调用，不能通过删除。这意味着不能直接删除 ITest*，只有派生类可以。派生类可能需要一个虚拟析构函数。您的代码完全没有问题。

但是，由于您不能在 GCC 中本地禁用警告，并且您已经有一个 vtable，因此您可以考虑将析构函数设为虚拟。程序最多需要 4 个字节（不是每个类实例）。由于您可能已经为派生类提供了一个虚拟 dtor，因此您可能会发现它没有任何成本。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-24T14:37:01.490

如果您坚持这样做，请继续并传递`-Wno-non-virtual-dtor`给 GCC。默认情况下似乎没有打开此警告，因此您必须使用`-Wall`或启用它`-Weffc++`。但是，我认为这是一个有用的警告，因为在大多数情况下，这将是一个错误。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-24T14:39:17.973

它是一个接口类，因此您不应该删除通过该接口实现该接口的对象是合理的。一个常见的情况是工厂创建的对象的接口应该返回工厂。（让对象包含指向其工厂的指针可能非常昂贵）。

我同意 GCC 抱怨的观察。相反，它应该在您删除 ITest* 时发出警告。这才是真正的危险所在。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-24T14:40:07.787

我个人的观点是，您会做正确的事情并且编译器已损坏。如果可能，我会禁用警告（在定义接口的文件中本地），

我发现我经常使用这种模式（小“p”）。事实上，我发现我的接口拥有受保护的 dtor 比拥有公共的更常见。但是我不认为它实际上是一个常见的习语（它并没有被谈论那么多），我猜想当警告被添加到 GCC 时，尝试强制执行旧的 'dtor 必须是虚拟的，如果你有虚函数的规则。就我个人而言，我将该规则更新为“如果您具有虚拟功能并希望用户能够通过接口删除接口的实例，则 dtor 必须是虚拟的，否则 dtor 应该受到保护并且是非虚拟的”；）

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-24T14:19:41.313

如果析构函数是虚拟的，它确保在清理之前也调用基类析构函数，否则该代码可能会导致一些泄漏。所以你应该确保程序没有这样的警告（最好根本没有警告）。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-24T14:23:17.577

如果您在`ITest`'s 方法之一中尝试了`delete`自己的代码（这是一个坏主意，但合法），则不会调用派生类的析构函数。即使您从不打算通过基类指针删除派生实例，您仍然应该使您的析构函数成为虚拟的。

# .net - 您在编码时使用的命名约定是什么？

> ID：127427
> 
> 赞同：2
> 
> 时间：2008-09-24T14:16:22.867
> 
> 标签：.net, naming-conventions

您在编码时使用的命名约定是什么？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-09-24T14:17:58.183

我希望我们不会在这里讨论字段名称和大括号样式的前缀:)

这是我的 .NET 圣经：

[![替代文字](https://i.stack.imgur.com/aZnVG.jpg)](https://i.stack.imgur.com/aZnVG.jpg)

[MSDN](http://msdn.microsoft.com/en-us/library/xzf533w0(VS.71).aspx)也提供了可靠的指导方针。

另一个有用的来源是[MS 内部编码指南](http://blogs.msdn.com/brada/articles/361363.aspx)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-24T14:17:27.607

这是来自 MSDN的[一般命名约定列表。](http://msdn.microsoft.com/en-us/library/ms229045.aspx)

然而，我倾向于随波逐流。无论目前有什么标准，通常最容易遵循它们，也许随着时间的推移慢慢改变它。仅仅带着你自己的“标准”想法进入一个项目并尝试实施它们是不切实际的。

使用什么标准并不重要，imo——只是有一些标准，人们知道它们是什么。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-09-24T14:25:54.373

我结合使用[Hungarian](http://en.wikipedia.org/wiki/Hungarian_notation)、camel case 和我在项目开始时提出的其他规则。就像现在：

*   方法是大写的（DoThis）
*   变量是驼峰式（thisThing）
*   页面级变量以 _ (_thisWorksEverywhere) 开头
*   区域都是小写（#region 外国属性）
*   属性和对象都是大写的（Object.Property）
*   外部属性以 _ (Object._ForeignGroups) 开头
*   控件在一定程度上是匈牙利语，例如 (txtTextBox) 和 (rptRepeater)。我对什么是习惯并不太严格，因为“水印”可以是 wm 或 wk 或其他，只要它们在我的应用程序中都相互匹配。

...ETC。有些事情是标准的，有些事情取决于解释，但最重要的是整个应用程序的一致性。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-24T14:20:13.870

可以使用[匈牙利符号。](http://en.wikipedia.org/wiki/Hungarian_notation)我不打扰自己，但我给各种事物（变量、控件等）起合理的名称。

例如，我对控件名称使用匈牙利风格的前缀，例如 txt 代表文本框，btn 代表按钮，pic 代表图片框，lbl 代表标签等。这有助于轻松识别控件是什么。

对于函数名称，我尝试使用合理的解释性名称，但没有任何特定规则。对于变量名，我只是使用解释性名称，但没什么特别的。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-25T01:21:36.557

为了补充@Aku 的答案，Framework Design Guidelines 的作者已经发布了他们指南的在线摘要版本，重点是命名约定。

[框架设计指南摘要 v2](http://blogs.msdn.com/kcwalina/archive/2008/04/09/FDGDigest.aspx)

[在这里下载](http://code.msdn.microsoft.com/fds/Release/ProjectReleases.aspx?ReleaseId=873)

一致性是关键。根据您的开发团队的规模，使用一致且记录在案的对流将更容易获取别人的代码并让其他人更容易获取您自己的代码。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-24T14:31:25.980

伙计们，请不要发布“我喜欢 __field”或“我喜欢 m__field”之类的答案。这是一个非常个人和主观的问题，没有单一的答案。

如果*您有任何指导方针*，那已经是一个巨大的胜利。开发团队中更糟糕的是缺乏共同的约定。

如果能尝试描述给定指南的一些好处，那就太好了。
例如：

> 带有下划线的字段前缀可以提高智能感知的自动完成

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-24T14:53:50.967

在保持一致时选择一个。更改名称样式会导致混淆。

# com - 如何为 OLE 自动化编写类库？

> ID：127440
> 
> 赞同：0
> 
> 时间：2008-09-24T14:17:29.617
> 
> 标签：com, activex, typelib, ole-automation

我有 Excel 插件，我添加了很多类模块，现在它非常庞大。我想将其转换为类型库或 COM 包，以便我可以将其重新用于 MS Office 套件中的其他应用程序。

我将加载项作为类库项目移植到 Visual Studio，但 Excel 自动化无法识别已编译的 .dll 文件中的类。直觉上，我认为我的代码中需要一个清单、一个接口或类似的东西。

为了公开类的方法和属性以在 OLE 自动化中使用，我需要知道什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-24T22:42:52.913

我假设由于您使用了短语 manifest，您正在使用 .net 开发平台 VS2003、VS2005 或 VS2008 组装此 DLL，而不是 VS 6.0

此[链接](http://dn.codegear.com/article/32754)提供了注册 .NET 程序集以用作 COM 组件所需的一组详细步骤。

文章没有提到我经常做的一件事是创建我自己的 GUID。使用“工具”菜单中的“创建 GUID”项，然后将它们插入到要为 COM 公开的类、接口和枚举之上。

```
[Guid("3838ADC1-E901-4003-BD0C-A889A7CF25A1")]
public interface IMyCOMClass  {
    void MyMethod(); 
}

[Guid("476BDEB6-B933-4ed5-8B86-7D9330A59356"),
ClassInterface(ClassInterfaceType.None)]
public class MyCOMClass : IMyCOMClass {
    public void MyMethod() { 
        //implementation here
    }
} 
```

我要做的第二件事是为类实现的 COM 部分使用单独的接口。这样做的原因与接口更改时 COM 的可破坏性有关，想想 DLL Hell。

希望这会有所帮助，比尔。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-24T22:47:44.667

（假设它是一个 .NET 项目）

除了必须将 Guid 添加到您的接口和类之外，您还需要用 ComVisible 属性标记它们（除非您已经用它标记了整个程序集）。此外，您需要使用 tlbexp.exe 将元数据导出为 COM 类型库，以便在非托管客户端中进行引用。

# python - 为 Python 做贡献

> ID：127454
> 
> 赞同：13
> 
> 时间：2008-09-24T14:20:06.163
> 
> 标签：python

我是一个非常缺乏经验的程序员（可以制作 tk 应用程序，文本处理，有点理解 oop），但是 Python 太棒了，我想帮助社区。初学者贡献的最佳方式是什么？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-24T14:43:35.827

1.  添加到文档中。这是彻头彻尾的蹩脚

2.  帮助开发人员和用户邮件列表中的其他用户。

3.  测试 Python。编程语言中的错误非常糟糕。我已经看到有人在 python 中发现了至少 1 个错误

4.  经常在 irc.freenode.net 上的#python 频道

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-24T14:54:21.543

用 Python 构建一些很酷的东西并与他人分享。酷的小值仍然很酷。不是每个人都能编写史诗般的、改变世界的软件。

使用 Python 解决的每一个问题都是展示 Python 有多酷的一种方式。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-24T14:23:58.370

我想一种方法是帮助文档（翻译、更新），直到您对语言有足够的了解。此外，关注开发人员和用户邮件组将使您对社区正在做什么和需要做什么有一个很好的了解。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-25T09:01:24.440

我看到了两种解决方法：直接使用 Python 或使用 Python 进行工作

由于您是初学者，您可能对使用核心 Python 语言犹豫不决，或者觉得无法以有意义的方式做出贡献，这是可以理解的。但是，作为初学者，您可以帮助改进对学习 Python 至关重要的文档和其他项目。

例如，至少在我看来，Python 教程与其说是一个教程（在标准意义上），不如说是一个功能列表。当我试图从中学习时，我从来没有感觉到我正在积累我的知识，就像创建一个应用程序一样。感觉更像是向我展示了构成 Python 的所有部分，而不是如何将它们组合成一个有凝聚力的结构。

一旦我对这门语言变得更加熟悉（主要是通过书籍和大量练习），我最终编写了[自己的教程](http://www.gidnetwork.com/b-26.html)，试图不仅提供技术信息，还提供经验教训和“新手陷阱”。

或者，您可以通过在程序中使用 Python 来为 Python 世界做出贡献。您可以为已经建立的项目做出贡献，例如 Django、PyGame 等，或者您可以制作自己的程序来“抓痒”。无论哪种方式，您不仅可以积累 Python 知识，还可以回馈社区。

最后，你可以成为 Python 的倡导者，鼓励其他人学习这门语言。在我上一份工作时，我一直建议我的主管在考虑新项目使用什么时使用 Python 而不是 Java。我告诉我认识的每个人 Python 的乐趣，并鼓励他们尝试一下。我说服了我经常去的一个计算机论坛的管理员为 Python 创建了一个部分。而且，正如我已经说过的，我为 Python 编写了一个教程，并且正在为 wxPython 编写一个新教程。

您可以通过多种方式为 Python 做出贡献，而这些方式不一定与编程相关。随着您的编程技能的提高，您可能希望进一步参与代码贡献。但是，通过帮助他人找到与 Python 相同的乐趣，您可能会获得更多的满足感。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-24T14:24:47.010

如果你没有真正在 Python 核心上工作，仍然有很多方法可以贡献.. 2 立即浮现在脑海的是：

处理文档..它总是可以改进的。使用您最喜欢的模块并查看文档并在可以添加的地方添加。

报告描述性错误对开发过程非常有帮助。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-24T14:25:23.593

参与社区： http: [//www.python.org/dev/](http://www.python.org/dev/)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-24T15:15:24.800

首先为您使用和享受的 Python 项目做出贡献。这可以像在邮件列表或 IRC 频道上回答问题一样简单，提供帮助文档和测试编写或修复错误。

# php - 使用 shell_exec('passwd') 更改用户密码

> ID：127459
> 
> 赞同：3
> 
> 时间：2008-09-24T14:20:37.270
> 
> 标签：php, sudo, shell-exec, passwd

我需要能够通过网页（在受控环境中）更改用户的密码。因此，为此，我正在使用以下代码：

```
<?php
$output = shell_exec("sudo -u dummy passwd testUser testUserPassword");
$output2 = shell_exec("dummyPassword");
echo $output;
echo $output2;
echo "done";
?> 
```

我的问题是这个脚本没有更改用户“testUser”的密码。我究竟做错了什么？

谢谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-24T14:42:55.313

另一种选择是有一个 shell 脚本，比如说在某个地方叫做 passwd_change.sh，看起来像这样：

```
#!/usr/bin/expect -f
set username [lindex $argv 0]
set password [lindex $argv 1]

spawn passwd $username
expect "(current) UNIX password: " 
send "$password\r"
expect "Enter new UNIX password: "
send "$password\r"
expect "Retype new UNIX password: "
send "$password\r"
expect eof 
```

然后在您的 php 代码中执行以下操作：

```
<?php
shell_exec("sudo -u root /path/to/passwd_change.sh testUser testUserPass");
?> 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-24T14:24:07.950

我对 PHP 不够熟悉，无法告诉您如何修复它，但您的问题是这两个`shell_exec`命令是完全独立的。似乎您正在尝试使用第二个命令将输入​​通过管道传输到第一个命令，但这是不可能的。第一个命令在该进程执行之前不应该返回，当您运行第二个命令时，它将尝试运行该程序`dummyPassword`，我们可能会失败。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-24T14:35:47.517

使用[proc_open](http://www.php.net/manual/en/function.proc-open.php)，它可以让您与进程的标准输入进行交互。

请在手册中特别查看此评论：[http ://www.php.net/manual/en/function.proc-open.php#58044](http://www.php.net/manual/en/function.proc-open.php#58044)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-24T14:38:38.880

第一个回答是正确的。您可能想要使用或其他一些将返回管道的函数，您可以像使用or`popen()`打开的文件一样写入管道。 `fopen()``file()`

```
<?php
$pipe = popen("sudo -u dummy passwd testUser testUserPassword", 'r');
fwrite($pipe, "dummyPasswd\r\n");
pclose($pipe);
echo "done";
?> 
```

我还没有测试过，但这是你似乎想要的一般想法。您会注意到此设置不提供您执行的命令的输出。为此，您需要使用`proc_open()`更难使用但确实提供双向支持的方法。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-24T14:52:02.420

使用 chpasswd：

```
$tmpfname = tempnam('/tmp/', 'chpasswd');
$handle = fopen($tmpfname, "w");
fwrite($handle, "$username:".crypt($password)."\n");
fclose($handle);
shell_exec("sudo sh -c \"chpasswd -e < $tmpfname\""); 
```

谨防！如果有人可以控制 $username，那么他可以更改系统上的任何密码。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-20T19:36:03.350

我知道的一个简单且有效的方法（至少对于 Debian 4.0r5）是：

```
#!/bin/bash

USER="root"
NEWPASS="bullsheit123"

echo $USER:$NEWPASS | chpasswd
echo $? 
```

只需将此适应 php 脚本，它应该可以正常工作。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-25T09:49:15.183

您应该使用[crypt()](http://no2.php.net/crypt)函数来加密密码。然后你可以像这样调用`usermod`程序`usermod --password username encryptedpassword`。

加密 UNIX 登录密码的最常见方法是这样的：

> crypt('密码', '$1$salt1234$')

（`Where salt1234`是八个字母的盐）

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2011-08-03T13:16:35.813

我为时已晚，但这适用于仍在寻找答案的人。这就是我们使用的。极其简单。

```
 file_put_contents("passd", "$pass\n$pass\n");
    echo "$uname: $pass\n";
    `passwd $uname --stdin < passd`;
    `rm -rf passd`; 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2012-09-20T23:13:02.707

我更喜欢使用 2 个单独的进程：[http ://sylnsr.blogspot.com/2012/09/keep-unix-password-in-sync-with.html](http://sylnsr.blogspot.com/2012/09/keep-unix-password-in-sync-with.html)

# sql-server - SQL Server Management Studio 无法启动

> ID：127461
> 
> 赞同：1
> 
> 时间：2008-09-24T14:20:42.060
> 
> 标签：sql-server

我的一个同事有这个问题，显然是在安装 Re# 之后，这似乎完全无关紧要。但也许不是。

无法加载文件或程序集“SqlManagerUi，Version=9.0.242.0...”或其依赖项之一。该模块应包含程序集清单。(mscorlib)。

为什么是这样？

谢谢

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2019-06-14T14:53:34.230

我遇到了类似的问题，我无法打开我的 SQL Server Management Studio。这个步骤对我有用：

在文件`C:\Program Files (x86)\Microsoft SQL Server Management Studio 18\Common7\IDE\Ssms.exe.config`中，擦除项目`<NgenBind_OptimizeNonGac enabled="1" />`。

例子：

```
<?xml version="1.0" encoding="utf-8"?>
<configuration>
    <!-- ...snip... -->
    <runtime>
        <!-- ...snip... -->
        <!-- Remove this line (~line 38) -->
        <NgenBind_OptimizeNonGac enabled="1" />
        <!-- ...snip... -->
    </runtime>
    <!-- ...snip... -->
</configuration> 
```

我希望这有帮助。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2014-06-22T18:56:05.487

重新安装 .Net 框架对我没有帮助，但这些后续步骤对我有帮助。我不得不完全卸载并重新安装共享组件，但很难找到如何做到这一点。

确保您有方便的安装介质。在我的情况下，这是从下载的 SQLEXPRWT_x64_ENU ed 2014.exe 中解压缩的文件夹

1.  首先，通过控制面板 -> 卸载程序，找到“Microsoft SQL Server 2014 (x64)”。
2.  右键单击并选择卸载/更改。
3.  当您看到一个包含“添加”、“修复”或“删除”产品选项的对话框时，请选择最后一个（不用担心，如果您仔细按照这些步骤操作，您的 SQL Server 将不会被触及。
4.  从最初的空白下拉列表中选择 << 仅删除共享功能 >>
5.  从那里开始执行所有步骤，您现在可以重新安装共享功能。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-24T14:21:57.627

Management Studio 需要 .Net 框架。尝试删除/重新安装它。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-24T14:33:35.930

是否涉及安装/卸载VS？不要让我开始处理 SQL 2005 和 VS intall 的冲突。

# vb.net - 在VB中寻找模拟退火实现

> ID：127474
> 
> 赞同：3
> 
> 时间：2008-09-24T14:22:04.677
> 
> 标签：vb.net, algorithm, vb6, simulated-annealing

有没有人知道我可以检查和适应的 Visual Basic 中模拟退火的合理记录示例？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-24T15:11:37.633

这个项目看起来很好记录： http: [//www.codeproject.com/KB/recipes/simulatedAnnealingTSP.aspx](http://www.codeproject.com/KB/recipes/simulatedAnnealingTSP.aspx)。它是 C#，但只包含一个重要的源文件 (TravellingSalesmanProblem.cs)，因此很容易通过转换器运行它。也许： http: [//labs.developerfusion.co.uk/convert/csharp-to-vb.aspx](http://labs.developerfusion.co.uk/convert/csharp-to-vb.aspx)？

MSDN 杂志也有一篇关于[神经网络](http://msdn.microsoft.com/en-us/magazine/cc300677.aspx)的有趣文章。据我了解模拟退火，您可以将其添加到其他函数估计方法（如神经网络）中。因此，您可以通过随着时间的推移缩小 Momentum，将模拟退火添加到 MSDN VB 代码中。网络通过具有大动量的反向传播误差开始“热”，然后通过缩小动量慢慢“冷却”，从而减少反向传播中输出误差的影响。

干杯。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-24T18:12:35.763

对于所有的伪代码，我通常参考“C/C++ 中的数值配方”，并在以后适应我自己的。这是你能找到的最好的文档/实现。有时您甚至可以找到更好的算法或另一种解决方法。（如果 Newton Raphshon 不是要走的路）

# wpf - 检测 WPF 验证错误

> ID：127477
> 
> 赞同：118
> 
> 时间：2008-09-24T14:22:10.700
> 
> 标签：wpf, validation, data-binding

`ExceptionValidationRule`在 WPF 中，您可以使用或设置基于数据绑定期间数据层中抛出的错误的验证`DataErrorValidationRule`。

假设您以这种方式设置了一堆控件，并且有一个保存按钮。当用户单击“保存”按钮时，您需要确保在继续保存之前没有验证错误。如果存在验证错误，您想对它们大喊大叫。

在 WPF 中，如何确定是否有任何数据绑定控件设置了验证错误？

* * *

## 回答 #1

> 赞同：141
> 
> 时间：2011-01-10T18:59:56.813

这篇文章非常有帮助。感谢所有做出贡献的人。这是一个您会喜欢或讨厌的 LINQ 版本。

```
private void CanExecute(object sender, CanExecuteRoutedEventArgs e)
{
    e.CanExecute = IsValid(sender as DependencyObject);
}

private bool IsValid(DependencyObject obj)
{
    // The dependency object is valid if it has no errors and all
    // of its children (that are dependency objects) are error-free.
    return !Validation.GetHasError(obj) &&
    LogicalTreeHelper.GetChildren(obj)
    .OfType<DependencyObject>()
    .All(IsValid);
} 
```

* * *

## 回答 #2

> 赞同：50
> 
> 时间：2008-09-24T16:56:22.280

以下代码（来自 Chris Sell 和 Ian Griffiths 的 Programming WPF 书籍）验证依赖对象及其子对象上的所有绑定规则：

```
public static class Validator
{

    public static bool IsValid(DependencyObject parent)
    {
        // Validate all the bindings on the parent
        bool valid = true;
        LocalValueEnumerator localValues = parent.GetLocalValueEnumerator();
        while (localValues.MoveNext())
        {
            LocalValueEntry entry = localValues.Current;
            if (BindingOperations.IsDataBound(parent, entry.Property))
            {
                Binding binding = BindingOperations.GetBinding(parent, entry.Property);
                foreach (ValidationRule rule in binding.ValidationRules)
                {
                    ValidationResult result = rule.Validate(parent.GetValue(entry.Property), null);
                    if (!result.IsValid)
                    {
                        BindingExpression expression = BindingOperations.GetBindingExpression(parent, entry.Property);
                        System.Windows.Controls.Validation.MarkInvalid(expression, new ValidationError(rule, expression, result.ErrorContent, null));
                        valid = false;
                    }
                }
            }
        }

        // Validate all the bindings on the children
        for (int i = 0; i != VisualTreeHelper.GetChildrenCount(parent); ++i)
        {
            DependencyObject child = VisualTreeHelper.GetChild(parent, i);
            if (!IsValid(child)) { valid = false; }
        }

        return valid;
    }

} 
```

您可以在页面/窗口中像这样在保存按钮单击事件处理程序中调用它

```
private void saveButton_Click(object sender, RoutedEventArgs e)
{

  if (Validator.IsValid(this)) // is valid
   {

    ....
   }
} 
```

* * *

## 回答 #3

> 赞同：34
> 
> 时间：2009-02-19T14:31:20.810

使用 ListBox 时，发布的代码对我不起作用。我重写了它，现在它可以工作了：

```
public static bool IsValid(DependencyObject parent)
{
    if (Validation.GetHasError(parent))
        return false;

    // Validate all the bindings on the children
    for (int i = 0; i != VisualTreeHelper.GetChildrenCount(parent); ++i)
    {
        DependencyObject child = VisualTreeHelper.GetChild(parent, i);
        if (!IsValid(child)) { return false; }
    }

    return true;
} 
```

* * *

## 回答 #4

> 赞同：16
> 
> 时间：2009-10-23T12:06:54.333

有同样的问题并尝试了提供的解决方案。H-Man2 和skiba_k 的解决方案组合对我来说几乎可以正常工作，但有一个例外：我的窗口有一个TabControl。并且验证规则仅针对当前可见的 TabItem 进行评估。所以我用LogicalTreeHelper替换了VisualTreeHelper。现在它起作用了。

```
 public static bool IsValid(DependencyObject parent)
    {
        // Validate all the bindings on the parent
        bool valid = true;
        LocalValueEnumerator localValues = parent.GetLocalValueEnumerator();
        while (localValues.MoveNext())
        {
            LocalValueEntry entry = localValues.Current;
            if (BindingOperations.IsDataBound(parent, entry.Property))
            {
                Binding binding = BindingOperations.GetBinding(parent, entry.Property);
                if (binding.ValidationRules.Count > 0)
                {
                    BindingExpression expression = BindingOperations.GetBindingExpression(parent, entry.Property);
                    expression.UpdateSource();

                    if (expression.HasError)
                    {
                        valid = false;
                    }
                }
            }
        }

        // Validate all the bindings on the children
        System.Collections.IEnumerable children = LogicalTreeHelper.GetChildren(parent);
        foreach (object obj in children)
        {
            if (obj is DependencyObject)
            {
                DependencyObject child = (DependencyObject)obj;
                if (!IsValid(child)) { valid = false; }
            }
        }
        return valid;
    } 
```

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2012-10-31T22:06:53.457

除了 Dean 出色的 LINQ 实现之外，我还很高兴将代码包装到 DependencyObjects 的扩展中：

```
public static bool IsValid(this DependencyObject instance)
{
   // Validate recursivly
   return !Validation.GetHasError(instance) &&  LogicalTreeHelper.GetChildren(instance).OfType<DependencyObject>().All(child => child.IsValid());
} 
```

This makes it extremely nice considering reuseablity.

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2010-07-01T08:40:31.737

我会提供一个小的优化。

如果您对同一个控件多次执行此操作，则可以添加上述代码以保留实际具有验证规则的控件列表。然后，每当您需要检查有效性时，只检查那些控件，而不是整个可视化树。如果您有许多这样的控件，这将证明会好得多。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2016-02-10T11:19:37.423

Here is a [library](https://github.com/JohanLarsson/Gu.Wpf.ValidationScope) for form validation in WPF. [Nuget package here](https://www.nuget.org/packages/Gu.Wpf.ValidationScope).

Sample:

```
<Border BorderBrush="{Binding Path=(validationScope:Scope.HasErrors),
                              Converter={local:BoolToBrushConverter},
                              ElementName=Form}"
        BorderThickness="1">
    <StackPanel x:Name="Form" validationScope:Scope.ForInputTypes="{x:Static validationScope:InputTypeCollection.Default}">
        <TextBox Text="{Binding SomeProperty}" />
        <TextBox Text="{Binding SomeOtherProperty}" />
    </StackPanel>
</Border> 
```

The idea is that we define a validation scope via the attached property telling it what input controls to track. Then we can do:

```
<ItemsControl ItemsSource="{Binding Path=(validationScope:Scope.Errors),
                                    ElementName=Form}">
    <ItemsControl.ItemTemplate>
        <DataTemplate DataType="{x:Type ValidationError}">
            <TextBlock Foreground="Red"
                       Text="{Binding ErrorContent}" />
        </DataTemplate>
    </ItemsControl.ItemTemplate>
</ItemsControl> 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-24T14:29:35.033

您可以递归地遍历所有控件树并检查附加属性 Validation.HasErrorProperty，然后专注于您在其中找到的第一个。

您还可以使用许多已经编写的解决方案您可以查看[此](http://social.msdn.microsoft.com/Forums/en-US/wpf/thread/e7a0ae3b-75f3-4090-8bbc-51eaa841867e/)线程以获取示例和更多信息

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-07-06T06:42:45.467

在回答形式 aogan 中，与其显式地遍历验证规则，不如直接调用`expression.UpdateSource():`

```
if (BindingOperations.IsDataBound(parent, entry.Property))
{
    Binding binding = BindingOperations.GetBinding(parent, entry.Property);
    if (binding.ValidationRules.Count > 0)
    {
        BindingExpression expression 
            = BindingOperations.GetBindingExpression(parent, entry.Property);
        expression.UpdateSource();

        if (expression.HasError) valid = false;
    }
} 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2010-08-16T17:19:46.470

您可能对**[WPF 应用程序框架 (WAF)](http://waf.codeplex.com)****的BookLibrary**示例应用程序感兴趣。它展示了如何在 WPF 中使用验证，以及在存在验证错误时如何控制“保存”按钮。

# jakarta-ee - 如何将 EAR 中的 WAR 部署为 Glassfish 中的根 (/) 上下文？

> ID：127492
> 
> 赞同：9
> 
> 时间：2008-09-24T14:23:37.933
> 
> 标签：jakarta-ee, glassfish, ear

我有一个 EAR 文件，其中包含两个 WAR，war1.war 和 war2.war。我的 application.xml 文件如下所示：

```
<?xml version="1.0" encoding="UTF-8"?>
<application version="5" xmlns="http://java.sun.com/xml/ns/javaee" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/application_5.xsd">
  <display-name>MyEAR</display-name>
  <module>
    <web>
      <web-uri>war1.war</web-uri>
      <context-root>/</context-root>
    </web>
  </module>
  <module>
    <web>
      <web-uri>war2.war</web-uri>
      <context-root>/war2location</context-root>
    </web>
  </module>
</application> 
```

这导致 war2.war 在**[http://localhost:8080/war2location](http://localhost:8080/war2location)**上可用，这是正确的，但 war1.war 在**[http://localhost:8080//](http://localhost:8080//)**上- 请注意两个斜杠。

我究竟做错了什么？

请注意，WAR 的 sun-web.xml 文件在包含在 EAR 中时会被忽略。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2010-08-31T11:20:41.150

在 Glassfish 3.0.1 中，您可以在管理控制台中定义默认 Web 应用程序：“Configuration\Virtual Servers\server\Default Web Module”。下拉框包含所有部署的战争模块。

然后可以从[http://localhost:8080/](http://localhost:8080/)访问默认的 Web 模块。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-24T14:37:53.000

在我看来，这似乎是 glassfish 应用程序服务器中的一个错误。它应该可以工作，因为它已经定义了您的 application.xml 文件。

也许您可以尝试以下方法：

```
<context-root>ROOT</context-root> 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-24T15:19:03.777

这似乎是一个错误/功能。

您可以将 Glassfish 设置为使用某个 Web 应用程序作为根应用程序，即。当没有其他上下文匹配时，应用程序仍然认为它在原始上下文而不是根上运行。

我的解决方案是在 /w 上运行第一个 WAR，并使用 Apache 使用 RedirectMatch 将 /whatever 重定向到 /w/whatever。不是很漂亮，但它解决了问题（有点）。

```
RewriteEngine On
RedirectMatch ^/(w[^/].*) /w/$1
RedirectMatch ^/([^w].*) /w/$1 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2013-04-08T11:09:37.353

通过@jiriki 和@SteveGreenslade 描述的相同解决方案，但通过asadmin。发现于：[http ://www.java.net/node/681176](http://www.java.net/node/681176)

> 或者，您可以使用 CLI 更改此默认 Web 模块。

```
asadmin get server.http-service.virtual-server.server.default-web-module 
```

> 应该向您显示该应用程序，然后您可以使用 asadmin set 命令对其进行更改。

**更新（Glassfish 3.1+）：** 使用 glassfish 3.1+，您无需设置 default-web-module 即可实现它。您唯一需要修改的地方是

```
<your_ear>.ear/META-INF/application.xml 
```

您应该为您的网络模块放置的位置：

```
<context-root/> 
```

这就是工作。

根据此处提供的其他答案，我有一个错误的印象，需要更多的东西。看混淆引起的相关问题：[http ://www.java.net/forum/topic/glassfish/glassfish/asadmin-restart-domain-not-working-war-inside-ear-default-web-module](http://www.java.net/forum/topic/glassfish/glassfish/asadmin-restart-domain-not-working-war-inside-ear-default-web-module)

基本上：

```
<context-root>/</context-root> 
```

应该也可以工作，基于代码（[https://svn.java.net/svn/glassfish~svn/tags/3.1.2/web/web-glue/src/main/java/com/sun/enterprise/网络/WebContainer.java](https://svn.java.net/svn/glassfish~svn/tags/3.1.2/web/web-glue/src/main/java/com/sun/enterprise/web/WebContainer.java)）：

```
 if (wmContextPath.length() == 0)
        displayContextPath = "/";
    else
        displayContextPath = wmContextPath; 
```

但是我没有测试这个选项

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-10-22T08:05:48.590

谢谢吉里基。完美答案！也适用于 Galssfish 2.1.1！

配置> HTTP 服务> 虚拟服务器> 服务器

或更改`default-web-module`参数`domain.xml`

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-24T14:33:28.770

`http://localhost:8080//`仍应是等效于的有效 URL`http://localhost:8080/`

我会尝试将 war1 的上下文根留空（尽管我不确定这是否允许）。或将其更改为`<context-root>.</context-root>`.

否则我不得不说生成的 URI 是 glassfish 的一个错误，因为我从未见过使用 sun 的。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-06-26T02:57:46.457

您是否在更新版本的 Glassfish 上再次尝试过？（3.0.1 刚出来）。

我已经能够使用 Glassfish 3.0.1在爆炸的 EAR 中获得 -single- WAR 以部署到[http://localhost/ 。](http://localhost/)就像您提到的那样， sun-web.xml 似乎被忽略了（至少在爆炸的耳朵内）。

# .net - 在混合的托管/非托管进程中转储 CCW 和 RCW

> ID：127496
> 
> 赞同：2
> 
> 时间：2008-09-24T14:24:17.900
> 
> 标签：.net, interop, windbg, com-interop, mixed-mode

我有一个混合的托管/非托管环境（Visual Studio 和 ReSharper），我怀疑 CCW 或 RCW 泄漏。有没有办法转储所有当前分配的包装器并识别它们的源/目标？我有 WinDbg、SOS 和 SOSEx，所以我可以使用 !syncblk 命令查看 RCW 和 CCW 的总数。我只想查看对象，所以我可以对它们调用 !gcroot 并检查嫌疑人。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-24T15:28:12.007

您应该可以使用它`!dumpheap`来执行此操作。 `!dumpheap -stat`会让你找到类型名称（如果你还不知道它们），然后`!dumpheap -type {typename}`会给你可以传递给`!gcroot`.

# html - 有哪些 HTML 电子邮件设计指南？

> ID：127498
> 
> 赞同：102
> 
> 时间：2008-09-24T14:24:22.380
> 
> 标签：html, email

您可以为电子邮件中的丰富 HTML 格式提供哪些指导，同时在许多客户端和基于 Web 的电子邮件界面中保持良好的视觉稳定性？

Stack Overflow 上一个问题的不相关答案建议：

[http://www.campaignmonitor.com/blog/archives/2008/05/2008_email_design_guidelines.html](http://www.campaignmonitor.com/blog/archives/2008/05/2008_email_design_guidelines.html)

其中包含以下准则：

1.  **放置样式表`<body>`而不是`<head>`**
    某些电子邮件客户端会将 CSS 从头部剥离，但如果样式块（无效）在正文中，则将其保留。
2.  **尽可能使用内联样式**
    Gmail 将删除任何样式表，无论是在 中`<head>`还是在 中`<body>`，但尊重使用`style=""`属性分配的内联样式
3.  **回到表格**
    由于 Outlook 2007 使用了 Microsoft Word 渲染引擎，近年来电子邮件标准实际上已经倒退了一大步。忘掉你在没有样式表的情况下学到的大部分定位知识。
4.  **不要依赖图像**
    大多数客户端和大多数基于 Web 的电子邮件客户端不会显示图像，除非用户明确要求显示它们。

我也有一些“未经证实”的事实，我不记得我在哪里读到它们了。

1.  **不要在表格中使用超过两层的嵌套**
    这是真的吗。如果我这样做，可能会发生什么？是否有任何特定的客户/客户对此感到窒息？
2.  **小心在单元格/表格中嵌套背景图像**
    据我了解，您可能会遇到背景图像完全重新应用于降序表格/单元格的情况，而不仅仅是“闪耀”。再次，真实与否？哪些客户？

我想用更多的指导方针和从战壕中获得的经验来充实这个列表。

**你能提供任何进一步的建议吗？**

**更新：**我特别要求HTML**设计部分**的指南及其一致性。关于[避免垃圾邮件过滤器](https://stackoverflow.com/questions/371/how-do-you-make-sure-email-you-send-programmatically-is-not-automatically-marke)的一般准则和[常见礼貌](https://stackoverflow.com/questions/120107/guidelines-for-email-newsletter-service)的问题已经在 SO 上。

* * *

## 回答 #1

> 赞同：64
> 
> 时间：2008-09-24T14:39:01.923

如果您从“现代 HTML 和 CSS”的角度来处理它，实际上*很难制作出像样的 HTML 电子邮件。*

为了获得最佳结果，想象一下 1999 年。

*   返回表格进行布局（或者最好不要尝试任何复杂的布局）
*   害怕背景图像（它们在 Outlook 2007 和 Gmail 中中断）。
*   style-tag-in-the-body 是因为 Hotmail 曾经以这种方式接受它——不过我很确定他们现在把它去掉了。`style`如果必须使用 CSS，请使用带有属性的内联样式。
*   完全忘记`float`
*   请记住，您的图像可能会被阻止 - 使用背景和文本颜色对您有利 - 确保有一些可读的文本禁用图像
*   对链接要非常小心，尤其要警惕链接文本中任何看起来像 URL 的东西——你会激怒“网络钓鱼”过滤器（例如`<a href="http://domain.tld">www.someotherdomain.tld</a>`，**不好的**）
*   请记住，网络邮件客户端上的“折叠”往往在页面上非常高（在 1024x768 屏幕上，大多数界面不会显示超过 100 像素左右） - 将您的身份信息放在顶部，以便收件人知道你是谁。
*   最新版本的 Outlook 有一个“纵向”预览窗格，它比您预期的要窄得多 - 要非常小心固定宽度的布局，如果您必须使用它们，请尽可能缩小它们。
*   甚至不要*考虑*flash、Javascript、SVG、canvas 或类似的东西。
*   测试，很多。确保您在最近的 Outlook 中进行了测试（情况发生了很大变化！它现在使用 Word 作为其 HTML 呈现引擎，并且它已经瘫痪：[Word 2007 HTML/CSS 支持](http://msdn.microsoft.com/en-us/library/aa338201.aspx)）。Gmail 也很挑剔。令人惊讶的是，Yahoo 的 webmail 非常好，有很好的 CSS 支持。

祝你好运 ;）

更新以回答更多问题：

> 不要在表格中使用超过两层的嵌套

我相信这是与 Lotus Notes 有关的旧指南。嵌套表*应该*没问题，但实际上，如果您的布局复杂到需要它们，那么您可能无论如何都会遇到麻烦。保持您的布局**简单**。

> 小心在单元格/表格中嵌套背景图像

这可能与上述有关，并且同样适用，如果您变得那么复杂，那么您*将*遇到问题。最新版本的 Outlook 根本不支持背景图像，因此最好建议您完全忘记它们。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-09-24T14:25:40.893

始终使用多部分 mime 并提供纯文本替代方案。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2008-09-24T14:42:35.720

Campaign Monitor 背后的人还创建了一个包含大量有用信息的[电子邮件标准项目](http://www.email-standards.org/)网站。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2011-12-22T09:39:09.520

看看这个样板，它就像 html5boilerplate，但对于电子邮件： [http ://htmlemailboilerplate.com/](http://htmlemailboilerplate.com/)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-24T15:02:42.847

我认为这比您提出的问题要低一些，但是如果您真的希望尽可能多的客户正确查看 html 电子邮件，请确保它使用有效的 MIME。特别是，对于被视为有效 MIME 的电子邮件，标头必须（在该词的 RFC 意义上）包含以下两个标头：

```
MIME-Version:
Content-Type: 
```

如果缺少其中一个或另一个，非常严格的客户端会将您的 HTML 显示为原始文本。您会惊讶于有多少本应更了解的大型在线供应商把这件事搞砸了（值得注意的是，我收到过缺少 MIME-Version：来自亚马逊和 ACM 的标头的 HTML 电子邮件）

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-24T14:31:35.247

*   背景图像不可靠。
*   几乎不费吹灰之力，但**没有 javascript**。
*   使用可以让您将当前文件/缓冲区作为电子邮件发送的编辑器，或者至少找到一个可以让您将文件内容作为 HTML 电子邮件发送的程序。 **不要通过复制 HTML 并将其粘贴到 Outlook**（或任何其他邮件程序）来测试您的电子邮件。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-19T16:45:51.777

建议三个字：测试、测试、测试。

查看 LitmusApp.com 的电子邮件测试服务。您向他们发送一条消息，然后他们将其呈现在一堆客户端中，并向您显示结果的屏幕截图。它并不完美，但它非常好。

（顺便说一下，8.0 之前的 Lotus Notes 真的非常讨厌 HTML 邮件）

此外，除了内联 CSS 样式，我建议尽可能切换到标签。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2010-11-25T15:08:20.830

嵌入您的图像，不要链接到它们。

这是不好的 ：

```
<img src="http://myserver.com/myImage.jpg" alt="Lolkat"/> 
```

这很好：

```
<img src=cid:myImage/> 
```

是的，这看起来很奇怪，但请查看本[指南关于在电子邮件中嵌入图像](http://www.systemnetmail.com/faq/4.4.aspx)。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-06-19T16:13:38.933

如果您包含样式块，请不要以“.classname”或“.”开始任何新行。任何事物。在月经前放一个支架什么的。如果您不这样做，一些网络邮件系统将无法正确显示您的样式表。

由于这种行为，许多人错误地认为他们不能在电子邮件中使用 CSS 块...... IIRC“。” 是 SMTP 的正文分隔符。系统将倾向于在其邮件存储中逃逸，以防止将一封邮件的内容误识别为新邮件。这种处理方式往往会破坏从带有句点的新行开始的任何样式。

# c++ - 在 MFC 中调整控件大小

> ID：127514
> 
> 赞同：14
> 
> 时间：2008-09-24T14:25:58.240
> 
> 标签：c++, mfc

我正在编写一个有两个窗格（通过`CSplitter`）的程序，但是我在弄清楚调整每个框架中控件的大小时遇到​​了问题。为简单起见，有人可以告诉我如何为带有单个`CEdit`控件的基本框架执行此操作吗？

我很确定这与`CEdit::OnSize()`功能有关......但我并没有真正到达任何地方......

谢谢！:)

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-09-24T14:46:16.197

窗口在调整大小后立即收到 WM_SIZE 消息（由 MFC 中的 OnSize 处理程序处理），因此 CEdit::OnSize 不是您要查找的。

您应该在框架类和此处理程序中添加 OnSize 处理程序，正如 Rob[指出的那样，](https://stackoverflow.com/questions/127514/resizing-controls-in-mfc#127520)您将获得框架客户区域的宽度和高度，然后您应该添加调整控件大小和位置的代码。

像这样的东西

```
void MyFrame::OnSize(UINT nType, int w, int h)
{
    // w and h parameters are new width and height of your frame
    // suppose you have member variable CEdit myEdit which you need to resize/move
    myEdit.MoveWindow(w/5, h/5, w/2, h/2);
} 
```

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-09-24T14:28:10.200

当您的框架收到 OnSize 消息时，它将为您提供新的宽度和高度 - 您可以简单地调用 CEdit SetWindowPos 方法并将这些值传递给它。

假设 CMyPane 是您的拆分器窗格，它包含您在 OnCreate 中创建的名为 m_wndEdit 的 CEdit：

```
void CMyPane::OnSize(UINT nType, int cx, int cy)
{
    m_wndEdit.SetWindowPos(NULL, 0, 0, cx, cy, SWP_NOMOVE | SWP_NOACTIVATE | SWP_NOZORDER);
} 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-09-24T14:36:00.620

GetDlgItem(IDC_your_slidebar)->SetWindowPos(...) // 实际上你可以移动，调整大小...等

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-24T14:32:49.177

为此目的，SetWindowPos 有点繁重。MoveWindow 正是需要的。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-24T15:39:28.250

其他人指出 WM_SIZE 是您应该在此时处理和调整子控件大小的消息。WM_SIZE 在调整大小完成后发送。

您可能还想处理在调整大小进行时发送的 WM_SIZING 消息。这将允许您在用户仍在拖动鼠标时主动调整子窗口的大小。处理 WM_SIZING 不是绝对必要的，但它可以提供更好的用户体验。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-24T21:23:25.243

我使用 CodeGuru 的 CResize 类自动调整所有控件的大小。你告诉你希望如何调整每个控件的大小，它会为你完成这项工作。

调整大小范例是指定在调整对话框大小时控件的每一侧将移动多少。

```
SetResize(IDC_EDIT1, 0,   0,   0.5, 1);
SetResize(IDC_EDIT2, 0.5, 0,   1,   1); 
```

当您有大量对话框控件时非常方便。

[源代码](http://www.codeguru.com/cpp/w-d/dislog/resizabledialogs/article.php/c1925/)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2019-01-08T07:51:16.880

当涉及到窗口大小更改时，您可能会感兴趣的三个窗口消息：`ON_WM_SIZE()`、`ON_WM_SIZING()`和`ON_WM_GETMINMAXINFO()`。

正如[官方文档](https://docs.microsoft.com/en-us/cpp/mfc/reference/cwnd-class?view=vs-2017)所说：

*   `ON_WM_SIZE``::OnSize()`在 CWnd 的大小发生变化后触发其消息处理程序；
*   `ON_WM_SIZING``::OnSizing()`当 clipbord-viewer 窗口的客户区大小发生变化时触发其消息处理程序；
*   `ON_WM_GETMINMAXINFO``::OnGetMinMaxInfo()`每当窗口需要知道最大化的位置或尺寸，或者最小或最大跟踪大小时，就会触发其消息处理程序。

如果您想将大小限制在`cwnd`某个范围内，可以参考消息`ON_WM_GETMINMAXINFO`；如果您想实时检索尺寸变化，您可以参考其他两条消息。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2020-10-14T18:50:26.290

最好在属性部分使用每个控件的动态布局功能。

假设您想要一个特定的控件，例如标题，始终位于视图/对话框的中心，然后您只需选择控件的动态布局的属性，将移动类型设置为水平，将移动 X 设置为 50，但您继续调整大小为无。这样，当您调整视图大小时，标题始终保持在中心。当您在资源视图中设计控件时，您必须记住，调整大小/移动的最小值是对话框/视图中控件的大小/位置。

这样，您就可以减轻几何和变换的负担。

# vba - 在 Outlook 邮件内容上捕获右键单击的文本

> ID：127525
> 
> 赞同：3
> 
> 时间：2008-09-24T14:29:06.673
> 
> 标签：vba, outlook

我想知道当用户右键单击 Outlook 邮件时是否可以捕获文本，然后根据文本类型将项目添加到右键菜单中。

这是我想做的一个例子。如果有一条消息（邮件项）具有以下内容：“您好，关于项目 A1234，请致电 555-8474 与我联系”并且用户右键单击数字“8”，弹出的上下文菜单将有一个额外的底部名为“Call 555-8474”的项目，如果选中，将运行“PhoneCall”子程序。如果用户右键单击“A1234”上的任意位置，则会显示不同的项目（即“查找 A1234”）。

我们正在运行 Outlook 2003，如果可能的话，我想知道这是否可以使用 VBA 完成。我也对其他想法持开放态度。谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-24T15:25:42.527

您可以在 VBA 中使用[此示例](http://www.outlookcode.com/codedetail.aspx?id=1635)开始

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-24T14:56:49.320

SmartTags 是 Office 2003 的一项功能，专为此类事情而设计。老实说，我对 SmartTags 的了解还不够多，只能在大方向上挥手，所以我希望你能从领域专家那里得到更好的答案....

# sharepoint - 如何重新排序 SharePoint 视图中的字段/列？

> ID：127530
> 
> 赞同：4
> 
> 时间：2008-09-24T14:30:59.367
> 
> 标签：sharepoint

我正在向列表和视图中添加一个新字段。要将字段添加到视图中，我使用以下代码：

```
view.ViewFields.Add("My New Field"); 
```

然而，这只是将它附加到视图的末尾。如何将字段添加到特定列，或重新排列字段顺序？view.ViewFields 是一个从 SPBaseCollection 继承的 SPViewFieldCollection 对象，并且没有可用的 Insert / Reverse / Sort / RemoveAt 方法。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-24T15:25:25.897

我发现从列表中删除所有项目并按照我想要的顺序阅读它们效果很好（虽然有点激烈）。这是我正在使用的代码：

```
string[] fieldNames = new string[] { "Title", "My New Field", "Modified", "Created" };
SPViewFieldCollection viewFields = view.ViewFields;
viewFields.DeleteAll();
foreach (string fieldName in fieldNames)
{
    viewFields.Add(fieldName);
}
view.Update(); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2015-11-03T18:51:04.160

您可以使用默认方法：

```
 int newFieldOrderIndex = 1;
    SPViewFieldCollection viewFields = view.ViewFields;
    viewFields.MoveFieldTo(fieldName, newFieldOrderIndex);
    view.Update(); 
```

[https://msdn.microsoft.com/EN-US/library/microsoft.sharepoint.spviewfieldcollection.movefieldto.aspx](https://msdn.microsoft.com/EN-US/library/microsoft.sharepoint.spviewfieldcollection.movefieldto.aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-24T18:30:36.373

您必须使用以下方法重新排序字段

```
 string reorderMethod = @"<?xml version=""1.0"" encoding=""UTF-8""?> 
                          <Method ID=""0,REORDERFIELDS""> 
                          <SetList Scope=""Request"">{0}</SetList>  
                          <SetVar Name=""Cmd"">REORDERFIELDS</SetVar>  
                          <SetVar Name=""ReorderedFields"">{1}</SetVar>  
                          <SetVar Name=""owshiddenversion"">{2}</SetVar>  
                          </Method>"; 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2017-11-02T11:45:45.263

我有两个不同的列表和相似的观点。如果用户在源视图中更改顺序，我想更新目标列表视图字段顺序。

```
ViewFieldCollection srcViewFields = srcView.ViewFields;
ViewFieldCollection destViewFields = destView.ViewFields;

var srcArray = srcViewFields.ToArray<string>();
var destArray = destViewFields.ToArray<string>();

foreach (var item in destArray)
{
    destViewFields.MoveFieldTo(item, Array.IndexOf(srcArray, item));
    destView.Update();
} 
```

# php - 我应该在 PHP 中允许“allow_url_fopen”吗？

> ID：127534
> 
> 赞同：34
> 
> 时间：2008-09-24T14:31:18.447
> 
> 标签：php, configuration

我们有几个开发人员要求`allow_url_fopen`在我们的服务器上启用。这些天的规范是什么，如果`libcurl`启用，真的有什么好的理由允许吗？

环境是：Windows 2003，PHP 5.2.6，FastCGI

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-09-24T16:19:18.313

我认为答案归结为您对开发人员负责任地使用该功能的信任程度如何？来自外部 URL 的数据应该像任何其他不受信任的输入一样对待，只要理解这一点，有什么大不了的？

我的看法是，如果您像对待孩子一样对待您的开发人员，并且从不让他们处理尖锐的事情，那么您将拥有永远不会学习编写安全代码的责任的开发人员。

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2008-09-24T14:37:31.800

您肯定希望`allow_url_include`设置为关闭，这也可以减轻许多风险`allow_url_fopen`。

但是因为不是所有版本的 PHP 都有`allow_url_include`，所以很多人的最佳做法是关闭 fopen。与所有功能一样，现实情况是，如果您的应用程序不需要它，请禁用它。如果您确实需要它，curl 模块可能会做得更好，并且重构您的应用程序以使用 curl 禁用`allow_url_fopen`可能会阻止最不坚定的破解者。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-24T16:39:53.660

这取决于开发的类型。如果您的原型设计那么启用“allow_url_fopen”就可以了，但是 libcurl 和 file_get_contents 之间没有显着的速度差异，启用它只是为了方便。

对于生产服务器，任何对 libcurl 的调用都应标记为进行安全审计。如果启用了“allow_url_fopen”，fopen 和 file_get_contents 也应该如此。禁用 'allow_url_fopen' 并不能阻止漏洞利用，它只会稍微限制它们可以完成的方式数量。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-24T14:38:50.720

跨站点脚本攻击很痛苦，所以投反对票。而且您绝对应该将“ [allow_url_include](http://us.php.net/manual/en/filesystem.configuration.php#ini.allow-url-include) ”设置为关闭，否则您将陷入痛苦的世界。

* * *

## 回答 #5

> 赞同：-3
> 
> 时间：2009-12-23T13:37:29.063

最大的问题是**allow_url_fopen 不是更安全**的，所以如果你想使用 curl 从 url 保存文件，你必须从 fopen/file_get 传递来保存文件。

> *   CURL 仅适用于从 URL 检索远程内容。 **（allow_url_fopen 不是必需的）**
> *   如果要将远程文件保存到服务器，则必须使用 Fopen 或 File_get 添加 CURL。 **（allow_url_fopen 必须使用 CURL）**

PHP 必须找到其他方法来使其更加安全。

# inversion-of-control - 为依赖注入设计类的指南

> ID：127552
> 
> 赞同：6
> 
> 时间：2008-09-24T14:35:15.613
> 
> 标签：inversion-of-control

[这个关于单元测试最佳实践](https://stackoverflow.com/questions/124210/best-practices-of-test-driven-development-using-c-and-rhinomocks#127113)的问题提到了为依赖注入设计类。这让我开始思考这究竟意味着什么。

刚刚开始使用控制容器的反转，我对这个问题有一些想法，所以让我把它们扔到墙上，看看有什么能坚持下去。

在我看来，一个对象可以拥有三种基本类型的依赖关系。

1.  **对象依赖性**- 将由相关类使用的实际对象。例如 LogInFormController 中的 LogInVerifier。这些应该通过构造函数注入。如果该类的级别足够高以至于在构造函数中需要超过 4 个这些对象，请考虑将其分解或至少使用工厂模式。您还应该考虑为依赖项提供接口并针对该接口进行编码。
2.  **简单设置**- 例如阈值或超时时间。这些通常应该有一个默认值，并通过工厂模式的构建器进行设置。您还可以提供设置它们的构造函数重载。但是在大多数情况下，您可能不应该强迫客户端必须明确设置它。
3.  **消息对象**- 从一个类传递到另一个类的对象，接收类可能用于业务逻辑。一个示例是 LogInCompleRouter 类的用户对象。在这里，我发现最好不要在构造函数中指定消息，因为您必须在 IoC 容器中注册 User 实例（使其成为全局），或者在您拥有 User 实例之前不实例化 LogInCompleteRouter （为此您不能使用 DI，或者至少需要对容器的显式依赖）。在这种情况下，最好仅在方法调用需要它时才传入消息对象（即 LoginInCompleteRouter.Route(User u); ）。

另外，我应该提一下，并不是*所有*的东西都应该 DI，如果你有一些简单的功能可以方便地分解到一次性类中，那么当场实例化可能是可以的。显然，这是一个判断电话；如果我发现编写一个类如

```
class PasswordEqualsVerifier {
  public bool Check(string input, string actual) { return input===actual;}
} 
```

我可能不会打扰依赖注入它，只会让一个对象直接在 using 块内实例化它。推论是，如果值得为其编写单元测试，那么它可能值得注入。

那你们怎么看？欢迎任何额外的指导方针或对比意见。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-24T14:45:01.503

重要的是尝试对接口进行编码，并让您的类接受这些接口的实例，而不是自己创建实例。你显然会为此发疯，但无论单元测试还是 DI，这都是一种普遍的好习惯。

例如，如果您有一个数据访问对象，您可能倾向于为所有 DAO 编写一个基础，如下所示：

```
public class BaseDAO
{
    public BaseDAO(String connectionURL, 
                   String driverName, 
                   String username, String password)
    {
        // use them to create a connection via JDBC, e.g.
    }

    protected Connection getConnection() { return connection; }
} 
```

但是，最好从类中删除它以支持接口

```
public interface DatabaseConnection
{
    Connection getConnection();
}

public class BaseDAO
{
    public BaseDAO(DatabaseConnection dbConnection)
    {
        this.dbConnection = dbConnection;
    }

    protected Connection getConnection() { return dbConnection.getConnection(); }
} 
```

现在，您可以提供`DatabaseConnection`. 即使忽略单元测试，如果我们假设我们使用的是 JDBC，也有两种方法可以获取`Connection`：从容器中获取连接池，或者直接通过使用驱动程序。现在，您的 DAO 代码未与任一策略耦合。

对于测试，您可以`MockDatabaseConnection`使用固定数据制作一个连接到某些嵌入式 JDBC 实现的代码，以测试您的代码。

# wpf - WPF ListBoxItem 选择问题

> ID：127556
> 
> 赞同：19
> 
> 时间：2008-09-24T14:36:58.433
> 
> 标签：wpf, listbox

我有一个列表框，其中的项目包含复选框：

```
<ListBox Style="{StaticResource CheckBoxListStyle}" Name="EditListBox">
    <ListBox.ItemTemplate>
        <DataTemplate>
            <CheckBox Click="Checkbox_Click" IsChecked="{Binding Path=IsChecked, Mode=TwoWay}" Content="{Binding Path=DisplayText}" />
        </DataTemplate>
    </ListBox.ItemTemplate>
</ListBox> 
```

我遇到的问题是，当我单击复选框或其内容时，父 ListBoxItem 没有被选中。如果我单击复选框旁边的空白区域，则 ListBoxItem 会被选中。

我试图获得的行为是能够选择列表中的一个或多个项目并使用空格键打开和关闭复选框。

更多信息：

```
private void Checkbox_Click(object sender, RoutedEventArgs e)
{
    CheckBox chkBox = e.OriginalSource as CheckBox;
} 
```

在上面的代码中，当我单击复选框时，e.Handled 为 false，chkBox.Parent 为空。

肯特的回答让我走上了正确的道路，这就是我最终得到的结果：

```
<ListBox Style="{StaticResource CheckBoxListStyle}" Name="EditListBox" PreviewKeyDown="ListBox_PreviewKeyDown">
    <ListBox.ItemTemplate>
        <DataTemplate>
            <StackPanel Orientation="Horizontal">
                <CheckBox IsChecked="{Binding Path=IsChecked, Mode=TwoWay}" />
                <TextBlock Text="{Binding DisplayText}"/>
            </StackPanel>
        </DataTemplate>
    </ListBox.ItemTemplate>
</ListBox> 
```

我不得不使用 PreviewKeyDown 因为默认情况下，当您在列表框中点击空格键时，它会取消选择除最近选择的项目之外的所有内容。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-09-24T14:42:04.303

首先，将内容放在`CheckBox`：

```
<StackPanel Orientation="Horizontal">
    <CheckBox IsChecked="{Binding IsChecked}"/>
    <TextBlock Text="{Binding DisplayText}"/>
</StackPanel> 
```

之后，您将需要确保按空格键会`ListBoxItem`导致`CheckBox`被检查。有很多方法可以做到这一点，包括在`ListBoxItem`. 或者您可以为您的以下内容指定一个处理程序`UIElement.KeyUp`或任何内容`DataTemplate`：

```
<CheckBox IsChecked="{Binding IsChecked}" UIElement.KeyUp="..."/> 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-25T14:56:37.113

您还可以绑定 CheckBox 的 IsChecked 属性和 ListBoxItem 的 IsSelected 属性：

```
<ListBox>
    <ListBox.ItemTemplate>
        <DataTemplate>
            <CheckBox Content="{Binding DisplayText}" IsChecked="{Binding Path=IsSelected, RelativeSource={RelativeSource AncestorType={x:Type ListBoxItem}}}"/>
        </DataTemplate>
    </ListBox.ItemTemplate>
</ListBox> 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2011-10-19T06:12:33.180

`ItemsControl`在您的用例中，使用 a而不是列表框会更简单。ItemsControl 类似于 Listbox，只是它不包含自动选择行为。这意味着使用它来托管本质上是复选框的列表非常简单，您不必解决 ListBox 的选择行为。

只需切换到 ItemsControl 即可满足您的需求：

```
<ItemsControl Style="{StaticResource CheckBoxListStyle}" Name="EditListBox">
    <ItemsControl .ItemTemplate>
        <DataTemplate>
            <CheckBox Click="Checkbox_Click" IsChecked="{Binding Path=IsChecked, Mode=TwoWay}" Content="{Binding Path=DisplayText}" />
        </DataTemplate>
    </ItemsControl.ItemTemplate>
</ItemsControl> 
```

您可以单击文本以选中复选框（默认行为），您也可以使用键盘，而无需连接任何事件处理程序。

# asp.net - 缓存活动是否会阻止 IIS 卸载 ASP.NET 应用程序？

> ID：127563
> 
> 赞同：2
> 
> 时间：2008-09-24T14:37:34.967
> 
> 标签：asp.net

我想将计划任务添加到客户端的 ASP.NET 应用程序。这些帖子很好地涵盖了这个想法：

*   [https://blog.stackoverflow.com/2008/07/easy-background-tasks-in-aspnet/](https://blog.stackoverflow.com/2008/07/easy-background-tasks-in-aspnet/)
*   [在 ASP.NET 上启动维护过程的最佳实践是什么](https://stackoverflow.com/questions/45841/what-is-the-best-practice-to-kick-off-maintenance-process-on-aspnet)
*   [asp.net 应用程序的“带外”处理技术](https://stackoverflow.com/questions/42822/out-of-band-processing-techiniques-for-aspnet-applications)

我的问题有两个部分：首先，如果没有足够的请求活动，尽管有缓存活动，IIS 会卸载应用程序吗？我的客户不像 stackoverflow 那样享受那么多的流量，所以他们不能依赖用户请求来保持应用程序“活跃”。显然，我无法在未加载的应用程序中安排任务。

其次，如果是这样，有没有办法阻止 IIS 在配置或外部“保持活动”请求之外卸载应用程序？我的客户端主机不允许进行太多的配置调整，并且保持活动的实用程序引入了我试图通过 ASP.NET 缓存解决方案避免的部署复杂性。

谢谢一堆。

编辑/结论：TheXenocide 的解决方案是完全正确的问题。但是，我认为这是一个非常糟糕的问题。偷工减料的诱惑总是迫在眉睫。我已经恢复了理智，并告诉我的客户使用网站监控工具来保持网站活跃。此外，尽管有额外的部署麻烦，计划任务仍在 Windows 服务中进行。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-24T14:47:59.560

不幸的是，超出了更改超时配置的范围（我相信在 Web.config 中是可能的，尽管我不知道托管服务提供商允许和不允许什么，其中大多数使用中等信任）我不相信除了 Web 请求之外，还有任何其他方法可以防止应用程序结束。您可能会尝试的一件事可能比在本地机器上使用一些保活服务更简单一些，这可能是向 Session_Start/Session_End 添加一些逻辑，以确保始终至少有一个会话处于活动状态；您可以在应用程序中使用[WebRequest](http://msdn.microsoft.com/en-us/library/system.net.webrequest.aspx)类来调用您自己的站点，它仍应启动一个新会话。

祝你好运，让我们知道你在做什么:)

更新：这些细节现在很大程度上取决于您运行的 IIS 版本和 .NET 版本。每个版本的较新版本都有配置“始终运行”应用程序的方法。

# c++ - 你最喜欢的 Windbg 提示/技巧是什么？

> ID：127564
> 
> 赞同：45
> 
> 时间：2008-09-24T14:37:38.977
> 
> 标签：c++, windows, debugging, windbg

我开始意识到 Windbg 是一个非常强大的 Windows 平台调试器，我偶尔会学到一些关于它的新东西。Windbg 用户可以分享他们的一些疯狂技能吗？

ps：我不是在寻找一个漂亮的命令，这些可以在文档中找到。分享一些无法想象可以用 windbg 完成的事情的技巧怎么样？例如，当进程在windbg 下运行时，某种方式可以生成有关内存分配的统计信息。

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2008-09-24T15:28:29.573

我最喜欢的是命令`.cmdtree <file>`（未记录，但在以前的发行说明中引用）。这可以帮助调出另一个窗口（可以停靠）以显示有用的或常用的命令。这有助于提高用户使用该工具的效率。

最初讲到这里，以`<file>`参数为例：http: [//blogs.msdn.com/debuggingtoolbox/archive/2008/09/17/special-command-execute-commands-from-a-customized-user-interface- with-cmdtree.aspx](http://blogs.msdn.com/debuggingtoolbox/archive/2008/09/17/special-command-execute-commands-from-a-customized-user-interface-with-cmdtree.aspx)

示例： [替代文本 http://blogs.msdn.com/photos/debuggingtoolbox/images/8954736/original.aspx](http://blogs.msdn.com/photos/debuggingtoolbox/images/8954736/original.aspx)

* * *

## 回答 #2

> 赞同：28
> 
> 时间：2009-02-11T16:37:34.583

调查崩溃转储中的内存泄漏（因为到目前为止我更喜欢 UMDH 用于实时进程）。该策略是相同类型的对象都以相同的大小分配。

*   将`!heap -h 0`命令提供给 WinDbg 的命令行版本 cdb.exe（以获得更快的速度）以获取所有堆分配：

> ```
> "C:\Program Files\Debugging Tools for Windows\cdb.exe" -c "!heap -h 0;q" -z [DumpPath] > DumpHeapEntries.log 
> ```

*   使用[Cygwin](http://en.wikipedia.org/wiki/Cygwin)对分配列表进行 grep，按大小对它们进行分组：

> ```
> grep "busy ([[:alnum:]]\+)" DumpHeapEntries.log \
> | gawk '{ str = $8; gsub(/\(|\)/, "", str); print "0x" str " 0x" $4 }' \
> | sort \
> | uniq -c \
> | gawk '{ printf "%10.2f %10d %10d ( %s = %d )\n", $1*strtonum($3)/1024, $1, strtonum($3), $2, strtonum($2) }' \
> | sort > DumpHeapEntriesStats.log 
> ```

*   例如，您会得到一个看起来像这样的表，它告诉我们 0x24 字节的 25529270 次分配占用了将近 1.2 GB 的内存。

> ```
>  8489.52        707      12296 ( 0x3000 = 12288 )
>   11894.28       5924       2056 ( 0x800 = 2048 )
>   13222.66     846250         16 ( 0x2 = 2 )
>   14120.41     602471         24 ( 0x2 = 2 )
>   31539.30    2018515         16 ( 0x1 = 1 )
>   38902.01    1659819         24 ( 0x1 = 1 )
>   40856.38        817      51208 ( 0xc800 = 51200 )
> 1196684.53   25529270         48 ( 0x24 = 36 ) 
> ```

*   然后，如果您的对象有 vtables，只需使用该`dps`命令在 DumpHeapEntries.log 中查找一些 0x24 字节的堆分配，以了解占用所有内存的对象的类型。

> ```
> 0:075> dps 3be7f7e8
> 3be7f7e8  00020006
> 3be7f7ec  090c01e7
> 3be7f7f0  0b40fe94 SomeDll!SomeType::`vftable'
> 3be7f7f4  00000000
> 3be7f7f8  00000000 
> ```

这很俗气，但它有效:)

* * *

## 回答 #3

> 赞同：20
> 
> 时间：2008-10-01T19:50:56.080

在使用 vtables 在堆栈上查找 C++ 对象时，以下命令非常方便，尤其是在使用发布版本时，当很多东西都被优化掉时。

> dpp esp*范围*

能够将任意 PE 文件作为转储加载是很巧妙的：

> windbg -z mylib.dll

使用以下命令查询 GetLastError()：

> !gle

这有助于解码常见的错误代码：

> !error error_number

* * *

## 回答 #4

> 赞同：18
> 
> 时间：2008-10-01T20:12:09.230

我每天使用的几乎 60% 的命令..

```
dv /i /t
?? this
kM (kinda undocumented) generates links to frames
.frame x
!analyze -v
!lmi
~ 
```

解释

1.  `dv /i /t` [[文档]](https://docs.microsoft.com/en-us/windows-hardware/drivers/debugger/dv--display-local-variables-)
    1.  `dv`- 显示当前范围内局部变量的名称和值
    2.  `/i`- 指定变量的类型：局部、全局、参数、函数或未知
    3.  `/t`- 显示变量的数据类型
2.  `?? this` [[文档]](https://docs.microsoft.com/en-us/windows-hardware/drivers/debugger/----evaluate-c---expression-)
    1.  `??`- 评估 C++ 表达式
    2.  `this`- C++ 这个指针
3.  `kM` [[文档]](https://docs.microsoft.com/en-us/windows-hardware/drivers/debugger/k--kb--kc--kd--kp--kp--kv--display-stack-backtrace-)
    1.  `k`- 显示堆栈回溯
    2.  `M`- DML 模式。帧号是特定帧的超链接。有关 kM 的更多信息，请参阅[http://windbg.info/doc/1-common-cmds.html](http://windbg.info/doc/1-common-cmds.html)
4.  `.frame x` [[文档]](https://docs.microsoft.com/en-us/windows-hardware/drivers/debugger/-frame--set-local-context-)
    1.  切换到帧号 x。0 是堆栈顶部的帧，1 是第 0 帧下方的第 1 帧，依此类推。
    2.  要显示堆栈上另一帧的局部变量，首先切换到该帧 - `.frame x`，然后使用`dv /i /t`. 默认情况下`d`将显示来自顶部框架的信息。
5.  `!analyze -v` [[doc1]](https://docs.microsoft.com/en-us/windows-hardware/drivers/debugger/-analyze) [[doc2 - 使用 !analyze 扩展]](https://docs.microsoft.com/en-us/windows-hardware/drivers/debugger/using-the--analyze-extension)
    1.  `!analyze`-`analyze`扩展。显示有关当前异常或错误检查的信息。请注意，要运行扩展，我们添加前缀`!`.
    2.  `-v`- 详细输出
6.  `!lmi` [[文档]](https://docs.microsoft.com/en-us/windows-hardware/drivers/debugger/-lmi)
    1.  `!lmi`-`lmi`扩展。显示有关模块的详细信息。
7.  `~` [[文档]](https://docs.microsoft.com/en-us/windows-hardware/drivers/debugger/---thread-status-)
    1.  `~`- 显示指定线程或当前进程中所有线程的状态。

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2009-02-11T06:15:59.820

我最常使用的“提示”可以让您不必经常触摸那个讨厌的鼠标：`Alt`+`1`

`Alt`+`1`将焦点放在命令窗口中，以便您可以实际键入命令，并且向上箭头实际上滚动浏览命令历史记录。但是，如果您的焦点已经在可滚动的命令历史记录中，则它不起作用。

Peeve：为什么在焦点位于源窗口时忽略按键？这不像您可以从 WinDbg 内部编辑源代码。`Alt`+`1`救援。

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2009-08-03T10:38:36.057

一个词（好吧，三个）：**DML**，即**Debugger Markup Language**。

这是对 WinDbg 的一个相当新的添加，它没有记录在帮助文件中。但是，在 Windows 调试工具的安装目录中的“dml.doc”中有一些文档。

基本上，这是一种类似于 HTML 的语法，您可以将其添加到调试器脚本中以进行格式化，更重要的是，进行链接。您可以使用链接来调用其他脚本，甚至是同一个脚本。

我的日常工作涉及维护一个元建模器，它为大型 C++ 软件提供通用对象和对象之间的关系。起初，为了便于调试，我编写了一个简单的转储脚本，从这些对象中提取相关信息。

现在，使用 DML，我已经能够向输出添加链接，允许在相关对象上再次调用相同的脚本。这允许更快地探索模型。

这是一个简化的例子。假设自省下的对象与另一个对象有一种称为“引用”的关系。r @$t0 = $arg1 $$ arg1 是要检查的对象的地址

```
$$ dump some information from $t0

$$ allow the user to examine our reference
aS /x myref @@(&((<C++ type of the reference>*)@$t0)->reference )
.block { .printf /D "<link cmd=\"$$>a< <full path to this script> ${myref}\">dump Ref</link> " } 
```

显然，这是一个非常固定的例子，但这些东西对我来说真的是无价之宝。无需在非常复杂的对象中寻找正确的数据成员（这通常需要一分钟以及各种强制转换和取消引用技巧），只需单击一下即可自动完成！

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2010-04-28T16:10:33.670

*   `.prefer_dml 1`

    这会修改许多内置命令（例如`lm`）以显示 DML 输出，从而允许您单击链接而不是运行命令。很方便...

*   `.reload /f /o file.dll`（`/o`将覆盖您拥有的符号的当前副本）

*   `.enable_unicode 1`//将调试器切换为默认为字符串的[Unicode](http://en.wikipedia.org/wiki/Unicode)，因为所有 Windows 组件内部都使用 Unicode，这非常方便。

*   `.ignore_missing_pages 1`//如果你做了很多内核转储分析，你会看到很多关于内存被分页的错误。此命令将告诉调试器停止抛出此警告。

别名别名别名...

在调试器中节省一些时间。以下是我的一些：

```
aS !p !process;
aS !t !thread;
aS .f .frame;
aS .p .process /p /r
aS .t .thread /p /r
aS dv dv /V /i /t //make dv do your favorite options by default
aS f !process 0 0 //f for find, e.g. f explorer.exe 
```

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2009-11-28T22:50:46.110

另一个答案提到了命令窗口和`Alt`+`1`以专注于命令输入窗口。有没有人觉得不使用鼠标滚动命令输出窗口很困难？

好吧，我最近使用[AutoHotkey](http://en.wikipedia.org/wiki/AutoHotkey)使用键盘滚动命令输出窗口，而无需离开命令输入窗口。

```
; WM_VSCROLL = 0x115 (277)
ScrollUp(control="")
{
    SendMessage, 277, 0, 0, %control%, A
}

ScrollDown(control="")
{
    SendMessage, 277, 1, 0, %control%, A
}

ScrollPageUp(control="")
{
    SendMessage, 277, 2, 0, %control%, A
}

ScrollPageDown(control="")
{
    SendMessage, 277, 3, 0, %control%, A
}

ScrollToTop(control="")
{
    SendMessage, 277, 6, 0, %control%, A
}

ScrollToBottom(control="")
{   
    SendMessage, 277, 7, 0, %control%, A
}

#IfWinActive, ahk_class WinDbgFrameClass
    ; For WinDbg, when the child window is attached to the main window
    !UP::ScrollUp("RichEdit50W1")
    ^k::ScrollUp("RichEdit50W1")
    !DOWN::ScrollDown("RichEdit50W1")
    ^j::ScrollDown("RichEdit50W1")
    !PGDN::ScrollPageDown("RichEdit50W1")
    !PGUP::ScrollPageUp("RichEdit50W1")
    !HOME::ScrollToTop("RichEdit50W1")
    !END::ScrollToBottom("RichEdit50W1")
#IfWinActive, ahk_class WinBaseClass
    ; Also for WinDbg, when the child window is a separate window
    !UP::ScrollUp("RichEdit50W1")
    !DOWN::ScrollDown("RichEdit50W1")
    !PGDN::ScrollPageDown("RichEdit50W1")
    !PGUP::ScrollPageUp("RichEdit50W1")
    !HOME::ScrollToTop("RichEdit50W1")
    !END::ScrollToBottom("RichEdit50W1") 
```

运行此脚本后，您可以使用`Alt`+ `up`/`down`滚动命令输出窗口的一行，使用`Alt`+ `PgDn`/`PgUp`滚动一屏。

注意：似乎不同版本的 WinDbg 对窗口和控件有不同的类名，因此您可能需要先使用 AutoHotkey 提供的 window spy 工具来查找实际的类名。

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2010-09-13T14:30:14.950

基于 .NET 框架版本（v2.0 / v4.0）加载[SOS的脚本：](http://msdn.microsoft.com/en-us/library/bb190764%28v=vs.110%29.aspx)

```
!for_each_module .if(($sicmp( "@#ModuleName" , "mscorwks") = 0) ) 
{.loadby sos mscorwks} .elsif ($sicmp( "@#ModuleName" , "clr") = 0) 
{.loadby sos clr} 
```

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2008-12-22T20:37:43.660

我喜欢使用高级断点命令，例如使用断点创建新的一次性断点。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-10-05T12:59:56.833

不要**使用**WinDbg 的`.heap -stat`命令。它有时会给你不正确的输出。相反，使用 DebugDiags 内存报告。

有了正确的数字，您就可以使用 WinDbg 的`.heap -flt ...`命令了。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2011-02-02T01:33:14.590

适用于 x86/x64 的托管代码的平台无关转储字符串：

```
j $ptrsize = 8 'aS !ds .printf "%mu \n", c+';'aS !ds .printf "%mu \n", 10+' 
```

这是一个示例用法：

```
0:000> !ds 00000000023620b8

MaxConcurrentInstances 
```

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2010-07-16T15:19:58.113

对于使用调试器的命令和直接（静态或可自动化）例程，能够将要运行的所有调试器命令放在文本命令文件中并通过 kd.exe 或 cdb.exe 作为输入运行是非常酷的，可通过批处理脚本等调用。

每当您需要执行相同的旧例程时运行它，而无需启动 WinDbg 并手动执行操作。太糟糕了，当您不确定要查找的内容时，这不起作用，或者某些命令参数需要手动分析才能找到/获取。

# c# - 如何以编程方式关闭 C# 中的 InfoPath 表单？

> ID：127572
> 
> 赞同：3
> 
> 时间：2008-09-24T14:38:31.563
> 
> 标签：c#, infopath

是否可以以编程方式关闭 InfoPath 表单？我知道它可以配置为表单规则/操作，但我想通过代码关闭表单。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-24T14:50:15.250

使用 ApplicationClass.XDocuments.Close 方法并将您的文档对象传递给它：

```
using System;
using Microsoft.Office.Interop.InfoPath;

namespace ConsoleApplication1
{
    class Program
    {
        static void Main(string[] args)
        {
            var app = new ApplicationClass();
            var uri = @".\form1.xml";
            var doc = app.XDocuments.Open(uri, 0);

            app.XDocuments.Close(doc);
        }
    }
} 
```

# c# - WPF locbaml-ed 应用程序和运行时语言切换？

> ID：127579
> 
> 赞同：2
> 
> 时间：2008-09-24T14:39:45.010
> 
> 标签：c#, .net, wpf, localization, locbaml

我想知道是否有一个简单的解决方案可以在运行时更改 wpf 应用程序的语言。我使用 locbaml 来全球化所有资源。在 App-constructor 中设置当前线程的 UICulture 工作正常，但是当我稍后尝试更改它时，我不再反映更改。使用winforms实际上很容易，但我不知道如何用wpf解决同样的问题。有任何想法吗？关于 j。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-06T22:21:18.260

不。

加载程序集并将其绑定到您的应用程序后，您将无法在工作中更改类。您可以创建一个加载当前语言的引导程序程序集，当您更改语言时，您会自动关闭并重新打开您的应用程序，但我怀疑这是您想要或需要的。

我在我的一个项目中所做的是使用转换器等创建一个全球化的应用程序框架。你可以看到我在[这里](http://weblogs.asp.net/okloeten/archive/tags/WPF/default.aspx)遇到的一些问题，尤其是[这篇](http://weblogs.asp.net/okloeten/archive/2007/12/12/5443446.aspx)展示了它的外观的帖子。如果你决定像我一样走同样的路。

# java - 如何使用 JVLC（VLC 的 Java 绑定）？

> ID：127587
> 
> 赞同：1
> 
> 时间：2008-09-24T14:41:38.483
> 
> 标签：java, vlc, libvlc, jvlc

我正在尝试使用[JVLC](http://trac.videolan.org/jvlc/)，但似乎无法正常工作。我已经下载了 jar，安装了[VLC](http://www.videolan.org/vlc/)并将 -D 参数传递给 JVM，告诉它 VLC 的安装位置。我也试过：

```
NativeLibrary.addSearchPath("libvlc", "C:\\Program Files\\VideoLAN\\VLC"); 
```

没有运气。我总是得到：

> 线程“主”java.lang.UnsatisfiedLinkError 中的异常：无法加载库“libvlc”：找不到指定的模块。

有没有人让它工作？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-24T14:44:51.783

如果您尝试加载的 dll 需要其他不可用的 dll，则您可以获得该异常。抱歉，我无法提供更具体的帮助，但需要检查一下。您可以使用[依赖](http://www.dependencywalker.com/)来遍历 dll 依赖项。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-03-28T12:54:50.993

我也有同样的问题，我注意到它只发生在 64 位 jdk/jre 上。在 Win7 x64 下使用 32 位 jdk 像魅力一样工作。

有一个很好的编码！

-Sipe

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-24T16:29:20.520

不确定那个 NativeLibrary 类。通常在使用本机库时，您需要将系统属性“java.library.path”设置为本机库的位置。如建议的那样，如果您的本机库（dll、so 等）依赖于其他本机库，则操作系统将接管以解决这些依赖关系。通过搜索本机库的操作系统特定路径，操作系统将不知道 java.library.path 和 beging。在 windows 上，这包括当前的 PATH 环境变量以及 windows 目录中的 System32。在 linux 上，这是 LD_LIBRARY_PATH / ld.conf 设置。

尝试将 PATH (LD_LIBRARY_PATH) 设置为指向与 java.library.path 相同的位置。唯一的问题是你不能设置这个你的进程启动（JVM），已经太晚了。您需要在 JVM 启动之前设置环境。您可以通过批处理文件、shell 脚本、Ant 或直接从您的 IDE 执行此操作。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-05-08T10:24:14.850

你应该试试

```
System.load("C:\\Path\\To\\libvlc.dll"); 
```

至少要验证您的库是否可以加载。如果没有，它可能会给你有用的错误信息（它对我有用）。

（正如 Sipe 所提到的，您可能正在使用 64 位 JRE/JDK，在这种情况下将永远找不到 libvlc（它只是 32 位）。在这种情况下，您必须切换到使用 32 位 JRE/JDK。）

# macos - 在 Mac OS X 中使用 Caps Lock 作为 Esc

> ID：127591
> 
> 赞同：487
> 
> 时间：2008-09-24T14:42:21.977
> 
> 标签：macos, vim, capslock

我如何`Caps Lock`像`Esc`在 Mac OS X 中一样工作？

* * *

## 回答 #1

> 赞同：408
> 
> 时间：2011-12-08T20:57:01.390

**编辑：**如[本答案](https://stackoverflow.com/a/40254864/665488)中所述，较新版本的 MacOS 现在具有对重新绑定`Caps Lock`到`Escape`. 因此，不再需要安装第三方软件来实现这一点。

* * *

这是我对如何使用[Seil](https://pqrs.org/macosx/keyremap4macbook/seil.html.en)`PCKeyboardHack`（以前称为

1.  首先，进入**System Preferences**，选择**Keyboard**，然后选择**Keyboard Tab**（第一个选项卡），然后单击**Modifier Keys**：

![步骤1](https://i.stack.imgur.com/Mx67Z.png)

在弹出对话框中将**Caps Lock Key**设置为`No Action`：

![选择不采取行动](https://i.stack.imgur.com/ac7zb.png)

2) 现在，[点击这里下载**Seil**](https://pqrs.org/macosx/keyremap4macbook/seil.html.en)并安装它：

![](https://puu.sh/9Bufd/616b2ffb0d.png)

3）安装后，您将安装一个新的应用程序（Mountain Lion 和更新版本），如果您使用的是旧操作系统，您可能需要检查新的系统偏好设置窗格：

![打开 seil 或首选项窗格](https://i.stack.imgur.com/7L3U2.png)

4）选中“更改大写锁定”框并输入“53”作为转义键的代码：

![设置键盘代码](https://i.stack.imgur.com/ZqBe1.png)

**你完成了！**如果它不能立即工作，您可能需要重新启动计算机。

## 印象深刻？想要更多控制权？

您可能还想查看[KeyRemap4MacBook](https://pqrs.org/macosx/keyremap4macbook/)，它实际上是旗舰键盘重新映射工具`pqrs.org`- 它也是免费的。

如果您喜欢这些工具，您可以[捐款](https://pqrs.org/macosx/keyremap4macbook/donation.html.en)。我与他们没有任何关系，但我已经使用这些工具很长时间了，不得不说那里的人在维护这些工具、添加功能和修复错误方面做得非常出色。

这是一个屏幕截图，显示了几个（数百个）预选选项：

![图片1.png](https://i.stack.imgur.com/fMsmp.png)

PQRS 还有一个很棒的实用程序，称为[NoEjectDelay](https://pqrs.org/macosx/keyremap4macbook/noejectdelay.html.en)，您可以将它与[KeyRemap4MacBook](https://pqrs.org/macosx/keyremap4macbook/)结合使用，以重新编程 Eject 键。稍作调整后，我设置为切换 AirPort Wifi。

这些实用程序在重新映射 Mac 键盘时提供了无限的灵活性。玩得开心！

* * *

## 回答 #2

> 赞同：340
> 
> 时间：2016-10-26T06:07:17.597

从 macOS 10.12.1 开始，可以重新映射`Caps Lock`到`Esc`本机（系统偏好设置 -> 键盘 -> 修改键）。

[![在此处输入图像描述](https://i.stack.imgur.com/GDvHY.png)](https://i.stack.imgur.com/GDvHY.png)

* * *

## 回答 #3

> 赞同：58
> 
> 时间：2017-09-28T02:52:57.167

我对这里的任何答案都不满意，于是开始寻找**命令行解决方案**。

在 macOS Sierra 10.12 中，Apple 为用户引入了一种重新映射键的新方法。

*   无需摆弄系统 GUI
*   不需要特殊特权
*   完全可定制
*   无需安装任何 3rd-party 废话，例如 PCKeyboardHack / Seil / Karabiner / KeyRemap4MacBook / DoubleCommand / NoEjectDelay

如果这对您来说听起来不错，请查看[`hidutil`](https://developer.apple.com/library/content/technotes/tn2450/_index.html).

例如，要将 caps-lock 重新映射为 escape，请参阅[key 表](https://developer.apple.com/library/content/technotes/tn2450/_index.html#//apple_ref/doc/uid/DTS40017618-CH1-KEY_TABLE_USAGES)，发现 caps-lock 的用法代码为 0x39，而 escape 的用法代码为 0x29。将这些代码或十六进制值 0x700000000 放在源和目标中，如下所示：

```
hidutil property --set '{"UserKeyMapping":[{"HIDKeyboardModifierMappingSrc":0x700000039,"HIDKeyboardModifierMappingDst":0x700000029}]}' 
```

您可以在同一命令中添加其他映射。就个人而言，我喜欢将大写锁定重新映射到退格键，并将退格键重新映射为删除：

```
hidutil property --set '{"UserKeyMapping":[{"HIDKeyboardModifierMappingSrc":0x700000039,"HIDKeyboardModifierMappingDst":0x70000002A}, {"HIDKeyboardModifierMappingSrc":0x70000002A,"HIDKeyboardModifierMappingDst":0x70000004C}]}' 
```

查看当前映射：

```
hidutil property --get "UserKeyMapping" 
```

您的更改将在系统重新启动时丢失。如果您希望它们持续存在，请在启动代理中配置它们。这是我的：

```
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<!-- Place in ~/Library/LaunchAgents/ -->
<!-- launchctl load com.ldaws.CapslockBackspace.plist -->
<plist version="1.0">
  <dict>
    <key>Label</key>
    <string>com.ldaws.CapslockEsc</string>
    <key>ProgramArguments</key>
    <array>
      <string>/usr/bin/hidutil</string>
      <string>property</string>
      <string>--set</string>
      <string>{"UserKeyMapping":[{"HIDKeyboardModifierMappingSrc":0x700000039,"HIDKeyboardModifierMappingDst":0x70000002A},{"HIDKeyboardModifierMappingSrc":0x70000002A,"HIDKeyboardModifierMappingDst":0x70000004C}]}</string>
    </array>
    <key>RunAtLoad</key>
    <true/>
  </dict>
</plist> 
```

我已将此内容放入位于 `~/Library/LaunchAgents/com.ldaws.CapslockBackspace.plist`然后执行的文件中：

```
launchctl load com.ldaws.CapslockBackspace.plist 
```

* * *

## 回答 #4

> 赞同：38
> 
> 时间：2008-09-24T15:28:39.447

我唯一知道如何做的就是将 Caps Lock 映射到 Control、Option 或 Command。这可以通过系统偏好设置的键盘和鼠标面板来完成。单击左下角的“修改键”，您将能够将 Caps Lock、Control、Option 和 Command 重新映射到其中的任何一个。

@Craig：这表明 Caps Lock*可以*用作普通键——即非切换键。在我的 MacBook 上，由于我已将 Caps Lock 重新映射到 Control，因此 Caps Lock 灯永远不会亮起。它的作用就像控制键。

![在此处输入图像描述](https://i.stack.imgur.com/EjbLa.png)

* * *

## 回答 #5

> 赞同：36
> 
> 时间：2016-12-31T03:26:42.350

现在使用 macOS Sierra映射`Caps Lock`密钥要容易得多。`Esc`

1.  打开系统偏好设置→键盘。

2.  单击右下角的修改键按钮。

3.  单击要重新映射的硬件密钥旁边的下拉框，然后选择 Escape。

4.  单击确定并关闭系统偏好设置。

[![在此处输入图像描述](https://i.stack.imgur.com/AhI7t.jpg)](https://i.stack.imgur.com/AhI7t.jpg)

[https://9to5mac.com/2016/10/25/remap-escape-key-action-macbook-pro-macos-sierra-10-12-1-modifier-keys/](https://9to5mac.com/2016/10/25/remap-escape-key-action-macbook-pro-macos-sierra-10-12-1-modifier-keys/)

* * *

## 回答 #6

> 赞同：34
> 
> 时间：2008-10-30T11:53:06.140

这是可能的。

## 解决方案 1

来自[TrueAffection.net](http://trueaffection.net/post/48417577/map-caps-lock-to-esc)上的一篇文章。

> *   下载 PCKeyboardHack 并安装它。
> *   转到系统偏好设置中的 PCKeyboardHack。
> *   启用“更改大写锁定”并将密钥代码设置为 53。

## 解决方案 2

此解决方案不涉及修补键盘驱动程序，而是为您提供 Vim 特定的解决方案。

OS X 支持将 Caps Lock 键映射到一大堆键，但您必须“手动”完成，编辑 .plist 文件。该过程在[本文](http://hints.macworld.com/article.php?story=20060825072451882)中进行了描述。作为该提示的附录，我建议您首先在系统偏好设置中将 Caps-Lock 设置为 None，然后您只需要更改 .plist 文件中的一个值。此外，您当然可以使用属性列表编辑器来代替 XML 转换步骤。

诀窍是将 Caps Lock 键映射到 Help 键（代码 6），这在大多数键盘上都没有。但如果是，它将被视为插入键，您可能不会使用它，因为您询问重新映射 Caps Lock 以防止伸手；）

然后，您可以将帮助和`Insert`密钥映射到`Esc`vim 中。

```
map  <Help> <Esc>
map! <Help> <Esc>
map  <Insert> <Esc>
map! <Insert> <Esc> 
```

这适用于 gvim (Vim.app)。我没有让它在终端中与 vim 一起工作，我还没有用 MacVim 测试它。

因此，这是一个相当复杂的、半生不熟的解决方案或安装第三方黑客。你的选择;）

编辑：刚刚注意到解决方案 3，如果您使用的是[MacVim](http://code.google.com/p/macvim/)，您可以使用`Ctrl`,`Option`和`Command`as `Esc`。使用 System Preferences 将 Caps Lock 映射到其中一个键是微不足道的。

* * *

## 回答 #7

> 赞同：14
> 
> 时间：2016-07-18T09:59:46.783

Seil 在 macOS Sierra（10.12 测试版）上尚不可用。因此，我一直在使用具有以下设置的键盘大师：[![在此处输入图像描述](https://i.stack.imgur.com/cW1RK.png)](https://i.stack.imgur.com/cW1RK.png)

归功于此 github 评论：[https ://github.com/tekezo/Seil/issues/68#issuecomment-230131664](https://github.com/tekezo/Seil/issues/68#issuecomment-230131664)

* * *

## 回答 #8

> 赞同：10
> 
> 时间：2009-06-03T22:03:44.760

在尝试了其中几种解决方案后，我有一些注意事项：

[DoubleCommand](http://doublecommand.sourceforge.net/)*不允许*您交换 esc 和 caps-lock。

[PCKeyboardHack](http://www.pqrs.org/tekezo/macosx/keyremap4macbook/extra.html) *将*允许您映射 capslock 以逃避，~~但无法将转义映射到大写锁定~~. 最近的版本将允许您通过编辑两个键来执行完整的交换。

这可能足以满足您的需求，也可能不足以满足您的需求（我知道它适合我的）。

* * *

## 回答 #9

> 赞同：10
> 
> 时间：2014-05-12T01:34:23.823

如果您不想安装第三方应用程序并且您真的只关心 iTerm 中的 vim，则可以使用以下方法：

[如此处所述，](http://hints.macworld.com/article.php?story=20060825072451882)将 CapsLock 重新映射到帮助。

短版：使用 plutil 或类似的 edit `~/Library/Preferences/ByHost/.GlobalPreferences*.plist`，它应该看起来像这样：

```
<key>HIDKeyboardModifierMappingDst</key>
<integer>6</integer>
<key>HIDKeyboardModifierMappingSrc</key>
<integer>0</integer> 
```

重新开始！一个简单的注销和登录对我不起作用。

在 iTerm 中，为 Help 添加一个新的键映射：发送十六进制代码 0x1b，对应 Escape。

我知道这并不完全是所要求的，但我认为许多人寻找这样的解决方案的意图实际上是这个更专业的变体。

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2012-02-28T19:28:28.540

为了使用 PCKeyboardHack 和 KeyRemap4MacBook 将转义键与大写锁定键（不仅仅是映射到另一个）实际交换，您必须按照[此线程](http://groups.google.com/group/keyremap4macbook/browse_thread/thread/e9ad288294d28be7/d56c8474dc8e2039)中的说明，将大写锁定键映射到未使用的键码键盘，但由 KeyRemap4MacBook（例如 110）占。然后，在PCKeyBoardHack中，选择适当的选项，该选项映射要逃脱的密钥代码（在110的情况下，是“逃脱的应用程序密钥”）。这是您的 KeyRemap4MacBook 首选项的外观（前提是您选择了“仅显示启用”复选框）。

![在此处输入图像描述](https://i.stack.imgur.com/kFwzi.png)

我最初试图将此信息发布为对[cwd 的出色答案](https://stackoverflow.com/a/8437594/148680)[的编辑](https://stackoverflow.com/suggested-edits/210587)，但被拒绝了。我鼓励任何想要走我描述的路线的人首先阅读他/她的回复。

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2011-03-28T02:38:05.083

打开键盘首选项并单击修饰键...您可以将大写锁定键更改为控制、选项、转义或命令。

![在此处输入图像描述](https://i.stack.imgur.com/d3n7x.png)

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2016-10-13T08:28:28.227

Seil 还不能在 macOS Sierra 上运行，所以我使用的是[Karabiner Elements](https://github.com/tekezo/Karabiner-Elements)，从[https://pqrs.org/latest/karabiner-elements-latest.dmg](https://pqrs.org/latest/karabiner-elements-latest.dmg)下载。

使用 GUI 或将以下内容放入`~/.karabiner.d/configuration/karabiner.json`：

```
{
  "profiles" : [
    {
      "name" : "Default profile",
      "selected" : true,
      "simple_modifications" : {
        "caps_lock" : "escape"
      }
    }
  ]
} 
```

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2008-11-03T06:54:05.397

您还可以使用 DoubleCommand 重新映射此键和其他键。

IIRC，它将 Caps Lock 映射到 Esc。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2019-10-14T16:35:32.017

Karabiner-Elements 一个强大而稳定的 macOS 键盘定制器。（免费软件）

[https://pqrs.org/osx/karabiner/index.html](https://pqrs.org/osx/karabiner/index.html)

为我工作，为 Mojave 将大写锁定更改为退格键

# soundex - 如何制作国际 Soundex？

> ID：127592
> 
> 赞同：17
> 
> 时间：2008-09-24T14:42:26.343
> 
> 标签：soundex

例如，Soundex 算法针对英语进行了优化。是否有更通用的算法适用于大型语言系列？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-09-24T15:51:59.097

SOUNDEX 确实是面向英语的。考虑到更广泛的语音差异的另外两个是：[Double Metaphone](http://en.wikipedia.org/wiki/Double_Metaphone)和[NYSIIS](http://search.cpan.org/~krburton/String-Nysiis-1.00/Nysiis.pm)。

它们将编码生成到比 SOUNDEX 更大的可能空间中。Double Metaphone，具体来说，包括减少处理基于比英语更多的语言的替代发音的明确目的。

我最近做了一个关于模糊字符串匹配的演示，[这些幻灯片](https://github.com/kyleburton/fuzzy-string/blob/master/fuzzy-matching.pdf?raw=true)可能会有所帮助。

# maintenance - 软件维护工程的最佳工具

> ID：127594
> 
> 赞同：8
> 
> 时间：2008-09-24T14:42:50.883
> 
> 标签：maintenance, code-search-engine

是的，可怕的“M”字。

您拥有一个工作站、源代码控制和 50 万行不是您编写的源代码。该文件在被批准和发布的那一刻就已经过时了。最初的开发者是 LTAO，在下一个项目/startup/loony bin 并且不回复电子邮件。

你会怎样做？

{最喜欢的编辑器}和 Grep 将帮助您开始探索代码库的复杂内容，但是维护工程师工具箱中还应该包含哪些其他工具？

开始滚球；我认为如果没有C/C++ 探索的[源代码洞察力，我就无法生存。](http://www.sourceinsight.com)（免责声明：我不为他们工作）。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-24T15:54:26.640

就像吃大象一样——一次咬一口 :)

有时，大局可能是一个真正的消极因素，你需要选择一个点，一点一点地解决它。

当然，您仍然需要选择开始的位。通常，这主要由用户/业务驱动，需要进行最优先的特定更改（昨天），但如果您有一点灵活性或熟悉时间，指标通常很有用。这里的工具因技术和语言而异，但像[NDepend](http://www.ndepend.com/)和[JDepend](http://clarkware.com/software/JDepend.html)这样的工具、任何内置的 Code Metrics （如在 Visual Studio Team System 中或各种可用的 Eclipse 插件中）或像[Simian](http://www.redhillconsulting.com.au/products/simian/)这样的工具来感受复制和粘贴问题。

希望单元测试的数量和覆盖率大于零，因此一个好的第一步是始终获得可以在持续集成环境中运行的任何测试，作为在学习时添加更多测试的基础。

正如其他人所说 - 假设该语言有可用选项 - 一个具有代码导航和自动重构的良好 IDE 是必须的（Eclipse、带有或不带有 ReSharper 的 Visual Studio）。

几本鼓舞士气的书：

*   Michael C. Feathers：[有效地使用遗留代码](https://rads.stackoverflow.com/amzn/click/com/0131177052)
*   Martin Fowler：[重构：改进现有代码的设计](https://rads.stackoverflow.com/amzn/click/com/0201485672)

祝你好运 ：）

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-24T14:58:06.400

.Net 领域中最好的工具之一是[ReSharper](http://www.jetbrains.com/resharper/index.html)。这个工具在开发生命周期的各个方面为我节省了时间。他们还帮助我在加入无证项目/解决方案时生存下来。

*   代码重构
*   代码导航
*   代码分析

这些是帮助执行耗时任务的众多功能中的一部分。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-08-22T20:46:52.537

代码搜索引擎可以帮助您找到庞大的源代码库。

可以在[SD Source Code Search Engine](http://www.semanticdesigns.com/Products/SearchEngine)找到对语言敏感的源代码搜索引擎。它可以同时处理多种语言。可以对特定语言的模式或跨语言的模式执行搜索（例如“查找涉及 TAX 的标识符”）。通过对语言标记敏感，可以减少误报的数量，从而为用户节省时间。它理解 C、C++、C#、COBOL、Java、ECMAScript、Java、XML、Verilog、VHDL 和许多其他语言。

（我是工具架构师）

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-24T14:59:23.357

我通常从 Linux 上的 Emacs + CScope 开始。Visual Studio 有一些检查工具，可以为您提供类似的 Windows 功能。Doxygen 也非常有用 - 即使源没有文档注释，它也会生成有用的文档。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-24T14:59:28.287

我将运行一些 UML 工具（可能是带有笔 = 的简单笔记本）和/或用于构建类、调用、方法层次结构的工具（集成在 IDE 中）。然后我将使用调试器或简单的单元测试来观察动态。有了这些东西，我将尝试执行某种逆向工程来找出设计。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-24T15:26:56.300

在这种情况下，我会[为 C++ 使用理解](http://www.scitools.com/products/understand/)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-24T18:42:14.083

使用[签名调查](http://c2.com/doc/SignatureSurvey/)过程是鸟瞰代码的好方法。有了一个好的脚本语言和一些使用它的魔力，用任何语言为你自己的代码库构建一个高度定制的签名调查根本不是一项艰巨的任务。

错误跟踪软件，特别是如果它链接到您的源代码控制软件将是非常宝贵的，因为它可以让您深入了解为什么做出一些错误的决定。如果维护程序员也计划进行一些重构，这一点就更重要了。

书面日志也很有帮助，这样您就可以在进行过程中记录系统。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-24T14:54:44.927

是的，一针见血。unix shell 和方便的 No​​tepad++ 是我在 ColdFusion、PHP、Perl 等中进行维护工作时使用的工具。最好不要切换编辑器，并跟踪对名称/参数/变量的所有引用。

现在我只需右键单击并在 Visual Studio 中点击“查找所有引用”，老实说这似乎是在作弊。PHP 的人非常嫉妒，因为他们被迫使用 vi 进行编辑。;)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-24T15:02:46.017

关键工具是允许您导航（和编辑）代码库以帮助您理解的东西。

拥有可以显示类关系的东西（如果使用 OO 语言）是非常有用的。当您想要衡量您将要进行的更改的影响时，显示（静态）调用树的能力也非常有用。

你提到源洞察力。一个长期运行的开源项目是[source navigator](http://sourcenav.sourceforge.net/)。在停滞了一段时间后，似乎又开始了发展。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-24T18:58:09.943

我发现 Lutz 的 Reflector 对此很有用，尤其是当您混合使用代码和二进制文件时。你会得到调用和依赖图（依赖、使用、暴露、实例化等）、程序集图和一些很棒的插件。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-10-06T11:33:38.147

您需要能够**浏览**整个代码库。如果您最喜欢的 IDE 确实允许这样做，那么您可以使用索引器，例如[为 C++ 理解的](http://www.scitools.com/products/understand/)（已引用）、[lxr](http://lxr.sourceforge.net/)或[OpenGrok](http://opengrok.github.io/OpenGrok/)。

匆忙中，您可以依靠[grep(1s)](http://unixhelp.ed.ac.uk/CGI/man-cgi?grep)或 - 更好 - [Ack](http://petdance.com/ack/)。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2010-09-01T15:10:49.607

NDepend 是一个专门用于[重新设计遗留代码](http://www.NDepend.com)的工具，尤其是大型纠缠的遗留代码库*免责声明：我是工具开发人员之一*

引用[曾经在他的博客中写道的 Scott Hanselman 的](http://www.hanselman.com/blog/ExitingTheZoneOfPainStaticAnalysisWithNDepend.aspx)话：*“NDepend 让我深入了解了我以前从未有过的应用程序 (...) 一旦我意识到我正在查看的信息的深度和广度，我就像糖果店里的孩子一样。”*

NDepend 的一些对重新设计有用的特性是：

*   [Dependency Matrix](http://www.ndepend.com/Doc_Matrix.aspx) / [Dependency Graph](http://www.ndepend.com/Doc_VS_Arch.aspx)，了解代码的结构。
*   [Code Rule over LINQ Query (CQLinq)](http://www.ndepend.com/Features.aspx#CQL)要求代码库给我它最好的秘密。默认提出超过[200 条代码规则。](http://www.ndepend.com/DefaultRules/webframe.html)
*   [Diff on code base](http://www.ndepend.com/Features.aspx#BuildComparison)，以查看在任何 2 个代码版本之间添加/重构/删除的内容。

# apache-flex - Flex：将资产加载到外部加载的模块中

> ID：127598
> 
> 赞同：3
> 
> 时间：2008-09-24T14:43:11.053
> 
> 标签：apache-flex, flash, actionscript-3

所以，我有一个使用 ModuleManager 加载模块的 Flex 项目，而不是模块加载器。我遇到的问题是要加载外部资产（如视频或图像），加载该资产的路径必须相对于模块 swf...而不是相对于加载模块的 swf。

问题是 - 如何使用相对于父 swf 而不是模块 swf 的路径将资产加载到加载的模块中？

* * *

精氨酸！因此，在挖掘 SWFLoader 类时，我在私有函数 loadContent 中发现了这段代码：

```
 // make relative paths relative to the SWF loading it, not the top-level SWF
    if (!(url.indexOf(":") > -1 || url.indexOf("/") == 0 || url.indexOf("\\") == 0))
    {
         var rootURL:String;
         if (SystemManagerGlobals.bootstrapLoaderInfoURL != null && SystemManagerGlobals.bootstrapLoaderInfoURL != "")
              rootURL = SystemManagerGlobals.bootstrapLoaderInfoURL;
         else if (root)
              rootURL = LoaderUtil.normalizeURL(root.loaderInfo);
         else if (systemManager)
              rootURL = LoaderUtil.normalizeURL(DisplayObject(systemManager).loaderInfo);

              if (rootURL)
              {
                   var lastIndex:int = Math.max(rootURL.lastIndexOf("\\"), rootURL.lastIndexOf("/"));
                    if (lastIndex != -1)
                         url = rootURL.substr(0, lastIndex + 1) + url;
               }
          }
} 
```

显然，Adobe 已经付出了额外的努力来使图像加载到实际的 swf 而不是顶级 swf 中（没有其他标志可供选择......），所以我想我应该提交一个功能请求以获得某种“相对于 swf 加载”标志，直接编辑 SWFLoader，或者我应该拥有与单个 swf 相关的所有内容，而不是顶级...有什么建议吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-25T11:14:42.997

您可以导入`mx.core.Application`然后使用[Application.application.url](http://livedocs.adobe.com/flex/3/langref/mx/core/Application.html#url)来获取模块中主机应用程序的路径，并将其用作构建 URL 的基础。

有关处理 URL 的帮助，请参阅[标准 Flex 库中的 URLUtil 类](http://livedocs.adobe.com/flex/3/langref/mx/utils/URLUtil.html)和[as3corelib 项目中的 URI 类](http://as3corelib.googlecode.com/svn/trunk/docs/com/adobe/net/URI.html)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-02-12T15:04:28.577

您可以在模块中使用 this.url 并将其用作 baseURL。

```
var urlParts:Array = this.url.split("/");
urlParts.pop();
baseURL = urlParts.join("/");
Alert.show(baseURL); 
```

并使用`{baseURL + "/location/file.ext"}`而不是`/location/file.ext`

# c# - 从 C# 将具有未知编码的扩展 ascii 字符传输到 Twisted XMLRPC

> ID：127599
> 
> 赞同：1
> 
> 时间：2008-09-24T14:43:22.240
> 
> 标签：c#, encoding, twisted, xml-rpc

基本上，我想传递一个包含西班牙语文本的字符串，该文本可能是几种编码之一（Latin-1、CP-1252 或 UTF-8 等等）。一旦它到达 XMLRPC，我就可以检测到编码，但在那之前我不会知道它。C#，默认情况下似乎会杀死 ASCII 之外的任何字符。我已经通过对字符串进行 base64 编码解决了这个问题，但我真的很想不这样做。

我正在使用 CookComputing.XmlRpc... 这是我的界面的代码片段：

```
public interface ISpanishAnalyzer
{
    [XmlRpcMethod("analyzeSpanishString")]
    int analyzeSpanishString(string text);
} 
```

任何帮助，将不胜感激。谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-24T18:02:33.307

我认为没有比 base64 编码更好的方法了。只要您不知道编码，就没有其他可能将其作为字节数组处理。我建议的唯一更改是通过使用 byte[] 参数而不是字符串并让 XmlRpc 库处理 base64 编码（假设它支持这一点）来明确这一点。

# macos - 如何在 Mac Firefox 3.0.1 上启用小程序？

> ID：127603
> 
> 赞同：0
> 
> 时间：2008-09-24T14:44:10.770
> 
> 标签：macos, firefox, applet

我在 Mac OS 机器上安装了 Java 1.5.0。我在首选项面板上安装了 Java 嵌入插件 0.9.6.4 并启用了 java。当我访问[http://java.com/en/download/help/testvm.xml](http://java.com/en/download/help/testvm.xml)时，小程序显示为空白。有谁知道发生了什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-24T16:36:13.543

我找到了解决方案。Java 嵌入插件使用已安装的 JVM，它本身从 MacOS 而非 Firefox 获取其代理定义。因此，必须为 MacOS/Safari 和 Firefox 定义代理定义。我还更新了 Firefox 并在 Java 首选项面板上选择了 Java 1.5。但是我不确定这两个操作是否有助于解决问题。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-15T20:42:29.367

applets that require java 1.6 don't work in mac os x, even though java 1.6 (aka java se 6) is installed and at the top of the list in the java preferences.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-06T10:41:31.833

Mac OS X 10.5 上的 Firefox 3.0.1 应该支持 java 小程序，而无需任何额外的 Java 嵌入插件。

# python - 在 python 中将 XML 编辑为字典？

> ID：127606
> 
> 赞同：8
> 
> 时间：2008-09-24T14:44:45.777
> 
> 标签：python, xml, dictionary

我正在尝试从 python 中的模板 xml 文件生成自定义的 xml 文件。

从概念上讲，我想读入模板 xml，删除一些元素，更改一些文本属性，然后将新的 xml 写入文件。我希望它像这样工作：

```
conf_base = ConvertXmlToDict('config-template.xml')
conf_base_dict = conf_base.UnWrap()
del conf_base_dict['root-name']['level1-name']['leaf1']
del conf_base_dict['root-name']['level1-name']['leaf2']

conf_new = ConvertDictToXml(conf_base_dict) 
```

现在我想写入文件，但我不知道如何到达 ElementTree.ElementTree.write()

```
conf_new.write('config-new.xml') 
```

有没有办法做到这一点，或者有人可以建议以不同的方式做到这一点？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2010-02-20T21:07:56.783

这会给你一个 dict 减属性。我不知道，这是否对任何人有用。当我想出这个时，我正在寻找一个 xml 来自己解决解决方案。

```
 import xml.etree.ElementTree as etree

tree = etree.parse('test.xml')
root = tree.getroot()

def xml_to_dict(el):
  d={}
  if el.text:
    d[el.tag] = el.text
  else:
    d[el.tag] = {}
  children = el.getchildren()
  if children:
    d[el.tag] = map(xml_to_dict, children)
  return d 
```

这个：[http ://www.w3schools.com/XML/note.xml](http://www.w3schools.com/XML/note.xml)

```
<note>
 <to>Tove</to>
 <from>Jani</from>
 <heading>Reminder</heading>
 <body>Don't forget me this weekend!</body>
</note> 
```

等于：

```
 {'note': [{'to': 'Tove'},
          {'from': 'Jani'},
          {'heading': 'Reminder'},
          {'body': "Don't forget me this weekend!"}]} 
```

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-09-24T14:58:52.437

我不确定首先将信息集转换为嵌套字典是否更容易。使用 ElementTree，您可以这样做：

```
import xml.etree.ElementTree as ET
doc = ET.parse("template.xml")
lvl1 = doc.findall("level1-name")[0]
lvl1.remove(lvl1.find("leaf1")
lvl1.remove(lvl1.find("leaf2")
# or use del lvl1[idx]
doc.write("config-new.xml") 
```

ElementTree 的设计目的是让您不必先将 XML 树转换为列表和属性，因为它在内部完全使用它。

它还支持[XPath](http://effbot.org/zone/element-xpath.htm)的小子集。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-09-24T15:56:06.323

为了在 python 中轻松操作 XML，我喜欢[Beautiful Soup](http://www.crummy.com/software/BeautifulSoup/)库。它的工作原理是这样的：

示例 XML 文件：

```
<root>
  <level1>leaf1</level1>
  <level2>leaf2</level2>
</root> 
```

Python代码：

```
from BeautifulSoup import BeautifulStoneSoup, Tag, NavigableString

soup = BeautifulStoneSoup('config-template.xml') # get the parser for the xml file
soup.contents[0].name
# u'root' 
```

您可以使用节点名称作为方法：

```
soup.root.contents[0].name
# u'level1' 
```

也可以使用正则表达式：

```
import re
tags_starting_with_level = soup.findAll(re.compile('^level'))
for tag in tags_starting_with_level: print tag.name
# level1
# level2 
```

添加和插入新节点非常简单：

```
# build and insert a new level with a new leaf
level3 = Tag(soup, 'level3')
level3.insert(0, NavigableString('leaf3')
soup.root.insert(2, level3)

print soup.prettify()
# <root>
#  <level1>
#   leaf1
#  </level1>
#  <level2>
#   leaf2
#  </level2>
#  <level3>
#   leaf3
#  </level3>
# </root> 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2011-05-22T13:06:04.733

我修改了丹尼尔的答案，以提供一个稍微整洁的字典：

```
def xml_to_dictionary(element):
    l = len(namespace)
    dictionary={}
    tag = element.tag[l:]
    if element.text:
        if (element.text == ' '):
            dictionary[tag] = {}
        else:
            dictionary[tag] = element.text
    children = element.getchildren()
    if children:
        subdictionary = {}
        for child in children:
            for k,v in xml_to_dictionary(child).items():
                if k in subdictionary:
                    if ( isinstance(subdictionary[k], list)):
                        subdictionary[k].append(v)
                    else:
                        subdictionary[k] = [subdictionary[k], v]
                else:
                    subdictionary[k] = v
        if (dictionary[tag] == {}):
            dictionary[tag] = subdictionary
        else:
            dictionary[tag] = [dictionary[tag], subdictionary]
    if element.attrib:
        attribs = {}
        for k,v in element.attrib.items():
            attribs[k] = v
        if (dictionary[tag] == {}):
            dictionary[tag] = attribs
        else:
            dictionary[tag] = [dictionary[tag], attribs]
    return dictionary 
```

namespace 是 xmlns 字符串，包括大括号，ElementTree 将它添加到所有标签之前，所以在这里我已经清除了它，因为整个文档都有一个命名空间

请注意，我也调整了原始 xml，因此“空”标签最多会在 ElementTree 表示中生成一个“”文本属性

```
spacepattern = re.compile(r'\s+')
mydictionary = xml_to_dictionary(ElementTree.XML(spacepattern.sub(' ', content))) 
```

例如会给

```
{'note': {'to': 'Tove',
         'from': 'Jani',
         'heading': 'Reminder',
         'body': "Don't forget me this weekend!"}} 
```

它是为特定的xml设计的，基本上相当于json，应该处理元素属性，例如

```
<elementName attributeName='attributeContent'>elementContent</elementName> 
```

也

有可能合并属性字典/子标签字典，类似于如何合并重复子标签，尽管嵌套列表似乎有点合适:-)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2012-05-15T11:37:03.080

添加这一行

```
d.update(('@' + k, v) for k, v in el.attrib.iteritems()) 
```

在[user247686 的代码](https://stackoverflow.com/a/2303733/1395962)中，您也可以拥有节点属性。

在这篇文章中找到它[https://stackoverflow.com/a/7684581/1395962](https://stackoverflow.com/a/7684581/1395962)

**例子：**

```
import xml.etree.ElementTree as etree
from urllib import urlopen

xml_file = "http://your_xml_url"
tree = etree.parse(urlopen(xml_file))
root = tree.getroot()

def xml_to_dict(el):
    d={}
    if el.text:
        d[el.tag] = el.text
    else:
        d[el.tag] = {}
    children = el.getchildren()
    if children:
        d[el.tag] = map(xml_to_dict, children)

    d.update(('@' + k, v) for k, v in el.attrib.iteritems())

    return d 
```

调用为

```
xml_to_dict(root) 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-24T15:05:01.500

你试过这个吗？

```
print xml.etree.ElementTree.tostring( conf_new ) 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-03-30T12:57:33.753

对我最直接的方式：

```
root        = ET.parse(xh)
data        = root.getroot()
xdic        = {}
if data > None:
    for part in data.getchildren():
        xdic[part.tag] = part.text 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2012-03-22T01:31:08.193

XML 具有丰富的信息集，它需要一些特殊的技巧才能在 Python 字典中表示它。元素是有序的，属性与元素主体区分开来，等等。

一个处理 XML 和 Python 字典之间往返的项目，以及一些用于以不同方式处理权衡的配置选项是[Pickling Tools 中的 XML 支持](http://www.picklingtools.com/html/xmldoc.html)。需要 1.3 和更新版本。它不是纯 Python（实际上旨在使 C++/Python 交互更容易），但它可能适用于各种用例。

# c++ - 访问 DSN 有哪些访问限制

> ID：127608
> 
> 赞同：0
> 
> 时间：2008-09-24T14:44:52.377
> 
> 标签：c++, windows-services, odbc, dsn

我们将应用程序的一部分作为 Windows 服务运行，它需要能够访问 DSN 才能通过 ODBC 导入。但是，通过反复试验发现它可以访问的 DSN 似乎存在很多限制。例如，它似乎无法 1\. 访问系统 DSN，除非运行该服务的帐户具有管理员权限。（尝试连接时出现访问被拒绝错误） 2\. 访问由其他用户创建的用户 DSN（这是可以理解的）。3.通过网络访问文件DSN

我读过文件 DSN 的目的是允许其他计算机使用它进行连接，但是我似乎无法做到这一点。

任何人都知道，或者知道在哪里可以找到使用 Windows 服务时访问 DSN 的所有规则和限制。谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-24T15:12:38.457

我想你自己已经发现了三个主要规则。:-)

除了您可能不需要您的服务帐户的管理员权限。IANANA（我不是网络管理员），但您的服务帐户可能只需要对 ODBC 文件或目录之一的读取权限。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-09T23:30:54.133

这介于您的 #1 和 #2 之间：有时还需要正确的文件权限。我曾经在连接到 DB2 DSN 的 Vista 机器上遇到麻烦，因为无论出于何种原因（可能是写出临时文件；虽然我不知道为什么它会在这个位置而不是用户特定的位置做这样的事情） ，驱动程序需要对 IBM 安装客户端二进制文件和库的目录的写访问权，该目录由管理员完成，位于 C 驱动器的根目录中。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-08-04T22:51:41.733

您无法使用服务连接到映射驱动器。映射的驱动器必须与称为桌面堆的内存进行交互，它跟踪桌面上的图标。服务无权访问该内存。如果您必须使用 dsn，请创建一个 systemdsn。更好的办法是使用连接字符串并将其存储在 app.config 中，并使用加密 API 来加密用户名和密码。

# web-services - 如何从 Access 2003 运行时安装中获得 Web 服务连接？

> ID：127609
> 
> 赞同：1
> 
> 时间：2008-09-24T14:44:53.453
> 
> 标签：web-services, ms-access

我有一个 Access 2003 应用程序，它与 Web 服务通信以从中央数据库获取文章。它在完整的 Access 安装中运行良好，但是当我使用 Access 2003 开发人员扩展中包含的包向导进行运行时安装时，它失败并显示错误消息“429 无法在 active-x 组件中创建对象”用于 web 服务通信的 DLL是 mssoap30.dll。该 dll 不随运行时安装一起提供，当我尝试手动将其添加到运行时安装时，它就在那里，但是当我尝试注册 DLL 时，它失败并显示消息：“注册失败原因无法启动 DLL”相同当我将 DLL 放在应用程序文件夹或 Microsoft 共享/Office11 中时的结果。有没有人用 Web 服务通信制作了 Access 运行时应用程序？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-24T14:53:39.907

如果 mssoap30.dll 注册失败，这可能意味着 mssoap30.dll 本身缺少依赖项。

您可以在此处下载 SOAP 工具包安装程序：

[http://www.microsoft.com/downloads/details.aspx?FamilyID=ba611554-5943-444c-b53c-c0a450b7013c&DisplayLang=en](http://www.microsoft.com/downloads/details.aspx?FamilyID=ba611554-5943-444c-b53c-c0a450b7013c&DisplayLang=en)

它只有 1.4 MB，应该可以解决问题。根据您用于构建安装程序的内容，您应该能够嵌入 SOAP 安装程序并在安装期间运行它（或者只需将两个文件都提供给您的用户并告诉他们安装这两个文件 - 这不会杀死任何人）。

# sql-server - 如何以编程方式更改 SSIS 控制流任务之间的工作流？

> ID：127610
> 
> 赞同：3
> 
> 时间：2008-09-24T14:44:54.200
> 
> 标签：sql-server, ssis

我有一个 SSIS 包，它取决于一个布尔变量，应该转到脚本任务或电子邮件任务。（注意：路径*来自*脚本任务）

我记得在旧的 dts 设计器中，有一种方法可以通过代码来做到这一点。在 SSIS 中完成此任务的正确方法是什么？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-24T15:21:36.017

> 条件拆分不是数据流任务吗，它取一行数据并根据数据的某些属性将其推向两个方向之一？？？

糟糕，这是正确的。我发现[这篇](http://dichotic.wordpress.com/2006/11/01/ssis-test-for-data-files-existence/)博客文章解释了如何根据布尔值进行适当的控制流条件分支。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-24T19:03:00.587

在控制流中，将绿色箭头拖到电子邮件任务上，然后右键单击它，您将看到您可以将其从“已完成”设置为“条件”，然后您可以在条件上设置表达式。然后箭头将变为蓝色。然后，您应该能够将另一个箭头拖动到另一个脚本，并将其设置为有条件的。

我经常有这个设置，如果某个条件适用，你想多次发送电子邮件。条件约束的标准语法类似于：

```
@[User::SendEmail] == True 
```

假设您的 SendEmail 变量是一个布尔值。如果您使用其他任何东西，只需构造一个计算结果为真或假的表达式。

请记住将条件设置为 OR 而不是 AND，否则它将无法完成，除非它可以同时采用两条路线！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-24T14:56:14.893

条件拆分任务可以满足您的需求。添加条件拆分任务，添加额外的输出（提供默认输出），并为该输出设置条件。然后根据需要将输出（默认和新）与脚本和电子邮件任务联系起来。

# .net - Excel (2002) 中的 WinForms 和附加组件

> ID：127615
> 
> 赞同：3
> 
> 时间：2008-09-24T14:46:01.953
> 
> 标签：.net, forms, excel, add-on

早上好，

我即将开始为 Excel 2002 编写一个 Excel 加载项。加载项需要调用一个表单。显然，我可以在 VBA 中编写表单。

我的问题是——有没有一种简单/好的方法可以从 Excel 调用 .NET（我使用的是 3.5），并且表单能够像原生 Excel 2002 表单一样将内容写回 Excel？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-24T14:56:03.957

Office XP ...是的，从功能上讲，您可以从加载项或其他方式操作 excel，但与 VBA 相比，它显然需要更多的编码。

最强大的解决方案是使用 OLE 自动化，但它并不是最容易编码和支持的解决方案。如果你真的需要它并且有这个选项 - 获取类似[http://www.add-in-express.com/](http://www.add-in-express.com/)的东西- 它为 Excel 自动化提供了一个很好的包装并解决了最常见的问题。无论如何，add-in-express 看起来是支持 Office XP 的最成熟的产品，值得一试以更好地了解 .Net 代码和 Excel 如何交互。

有多种方法可以在加载项中实现 Excel 和 .Net 代码之间的数据交换：OLE 自动化、从 VBA 调用 COM 函数、RTD，不确定是否还有人使用 DDE。每一个都有一些设置工作、编程挑战和维护/稳定性问题。

# language-agnostic - 对于仅运行自包含计算的类，哪种设计更好？

> ID：127625
> 
> 赞同：0
> 
> 时间：2008-09-24T14:48:28.857
> 
> 标签：language-agnostic, oop

我目前正在研究一个计算两个对象之间差异的类。我正在尝试确定该课程的最佳设计是什么。我看到两个选项：

1) 一次性类实例。将对象在构造函数中进行 diff 并为此计算 diff。

```
public class MyObjDiffer {
  public MyObjDiffer(MyObj o1, MyObj o2) {
    // Calculate diff here and store results in member variables
  }

  public boolean areObjectsDifferent() {
    // ...
  }

  public Vector getOnlyInObj1() {
    // ...
  }

  public Vector getOnlyInObj2() {
    // ...
  }

  // ...
} 
```

2) 可重用的类实例。构造函数不接受任何参数。有一个“calculateDiff()”方法，将对象进行比较，并返回结果。

```
public class MyObjDiffer {
  public MyObjDiffer() { }

  public DiffResults getResults(MyObj o1, MyObj o2) {
    // calculate and return the results.  Nothing is stored in this class's members.
  }
}

public class DiffResults {
  public boolean areObjectsDifferent() {
    // ...
  }

  public Vector getOnlyInObj1() {
    // ...
  }

  public Vector getOnlyInObj2() {
    // ...
  }
} 
```

差异将相当复杂（问题的细节无关紧要），因此需要一些辅助函数。如果我采用解决方案 1，那么我可以将数据存储在成员变量中，而不必传递所有内容。它稍微紧凑一些，因为所有内容都在一个类中处理。

但是，从概念上讲，“不同”特定于一组结果似乎很奇怪。选项 2 将结果与实际计算它们的逻辑分开。

编辑：选项 2 还提供了使“MyObjDiffer”类静态的能力。谢谢kitsune，我忘了说。

我很难看到任何一个选项的任何重要的利弊。我认为这种事情（一个只处理一些一次性计算的类）必须经常出现，也许我错过了一些东西。所以，我想我会向云端提出这个问题。这里的一个或另一个选项有显着的优点或缺点吗？天生就更好吗？有关系吗？

我在 Java 中这样做，所以可能会有一些限制，但设计的整体问题可能与语言无关。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-24T15:09:51.833

### 使用面向对象编程

使用选项 2，但不要*将*其设为静态。

### 策略模式

这样，`MyObjDiffer`可以将实例传递给任何需要[策略](http://en.wikipedia.org/wiki/Strategy_pattern)来计算对象之间差异的人。

如果以后，您发现在不同的上下文中使用不同的规则进行计算，您可以创建一个新的策略来适应。使用您的代码，您将扩展 MyObjDiffer 并覆盖其方法，这当然是可行的。更好的方法是定义一个接口，并将 MyObjDiffer 作为一个实现。

如果您想延迟决策，任何体面的重构工具都可以从 MyObjDiffer 中“提取接口”，并在稍后将对该类型的引用替换为接口类型。将“选项 2”与实例方法而不是类过程一起使用可为您提供这种灵活性。

### 配置实例

即使您从不需要编写新的比较方法，您也可能会发现指定选项来定制基本方法的行为很有用。如果您考虑使用“diff”命令来比较文本文件，您会记得有多少不同的选项：空格和大小写敏感、输出选项等。在 OO 编程中最好的模拟是考虑每个diff 进程作为一个对象，选项设置为该对象的属性。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-24T15:14:06.410

我真的不能说我有充分的理由说明它是“最佳”方法，但我通常为可以与之“对话”的对象编写类。因此，它就像您的“一次性使用”选项 1，除了通过调用设置器，您将“重置”它以供其他用途。

而不是提供实现（这很明显），这里有一个示例调用：

```
MyComparer cmp = new MyComparer(obj1, obj2);
boolean match = cmp.isMatch();
cmp.setSubjects(obj3,obj4);
List uniques1 = cmp.getOnlyIn(MyComparer.FIRST);
cmd.setSubject(MyComparer.SECOND,obj5);
List uniques = cmp.getOnlyIn(MyComparer.SECOND); 
```

... 等等。

这样，调用者就可以决定是要实例化大量对象，还是继续重用一个对象。

如果对象需要大量设置，这将特别有用。假设您的比较器接受选项。可能有很多。设置一次，然后多次使用。

```
// set up cmp with options and the master object
MyComparer cmp = new MyComparer();
cmp.setIgnoreCase(true);
cmp.setIgnoreTrailingWhitespace(false);
cmp.setSubject(MyComparer.FIRST,canonicalSubject);

// find items that are in the testSubjects objects,
// but not in the master.
List extraItems = new ArrayList();
for (Iterator it=testSubjects.iterator(); it.hasNext(); ) {
    cmp.setSubject(MyComparer.SECOND,it.next());
    extraItems.append(cmp.getOnlyIn(MyComparer.SECOND);
} 
```

编辑：顺便说一句，我称它为 MyComparer 而不是 MyDiffer 因为拥有 isMatch() 方法似乎比 isDifferent() 方法更自然。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-24T15:17:54.777

出于多种原因，您需要解决方案 #2。而且你不希望它是静态的。

虽然静态看起来很有趣，但当您提出 (a) 具有相同要求的新算法或 (b) 新要求时，这将是一场维护噩梦。

一个一流的对象（没有太多内部状态）允许您演变成一个不同的类层次结构——一些更慢，一些更快，一些内存更多，一些内存更少，一些用于旧需求，一些用于新需求。

您的一些差异可能会导致复杂的内部状态或内存，或增量差异或基于哈希码的差异。各种可能性都*可能*存在。

可重用对象允许您在应用程序启动时使用属性文件选择您的不同之处。

从长远来看，您希望尽量减少分散在整个应用程序中的新操作的数量。您希望将新操作集中在可以找到和控制它们的地方。要从旧的不同算法更改为新的不同算法，您需要执行以下操作。

1.  编写新的子类。

2.  更新属性文件以开始使用新的子类。

并且完全确信没有什么隐藏的东西`d= new MyObjDiffer( x, y )`是你不知道的。

你想在`d= theDiffer.getResults( x, y )`任何地方使用。

Java 库所做的是它们有一个静态的 DifferFactory。该因子检查属性并发出正确的差异。

```
DifferFactory df= new DifferFactory();
MyObjDiffer mod= df.getDiffer();
mod.getResults( x, y ); 
```

工厂通常缓存单个副本——它不必每次`getDiffer`调用时都物理读取属性。

这种设计为您在未来提供了最大的灵活性。它看起来像 Java 库的其他部分。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-24T14:50:08.683

我会选择 2 号并考虑是否应该将其设为静态。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-24T14:57:16.043

这取决于您将如何使用差异。在我看来，将差异视为一个逻辑实体是有意义的，因为它需要支持一些操作，如“getDiffString()”、“numHunks()”或“apply()”。我可能会拿你的第一个，然后更像这样：

```
public class Diff
{
    public Diff(String path1, String path2)
    {
        // get diff

        if (same)
            throw new EmptyDiffException();
    }

    public String getDiffString()
    {

    }

    public int numHunks()
    {

    }

    public bool apply(String path1)
    {
        // try to apply diff as patch to file at path1\.  Return
        // whether the patch applied successfully or not.
    }

    public bool merge(Diff diff)
    {
        // similar to apply(), but do merge yourself with another diff
    }
} 
```

使用这样的 diff 对象也可能适用于保留一堆补丁，或序列化到压缩存档，可能是“撤消”队列等。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-24T15:00:12.713

为什么要编写一个唯一目的是计算两个对象之间差异的类？这听起来像是静态函数或类的成员函数的任务。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-24T15:00:44.383

我会选择一个静态构造函数方法，比如。

```
Diffs diffs = Diffs.calculateDifferences(foo, bar); 
```

这样，在计算差异时就很清楚了，并且没有办法滥用对象的接口。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-24T15:01:51.040

我喜欢明确地开始工作而不是让它在实例化时发生的想法。此外，我认为结果足以保证他们自己的班级。你的第一个设计对我来说并不干净。使用这个类的人必须明白，在执行计算之后，其他一些类成员现在持有结果。选项 2 更清楚地说明了正在发生的事情。

# perl - 为什么我不能安装 DBD::mysql 以便可以将它与 Maatkit 一起使用？

> ID：127626
> 
> 赞同：0
> 
> 时间：2008-09-24T14:48:29.793
> 
> 标签：perl, macos, cpan

我正在尝试按照[maatkit 说明安装](http://maatkit.sourceforge.net/doc/maatkit.html#installation)[Maatkit](http://www.maatkit.org/)。我无法摆脱必须安装 DBD::mysql。“警告：未找到先决条件 DBD::mysql 1。” 当我尝试从 cpan 安装 DBD::mysql 时，我得到了非常有帮助的“make 已返回错误状态，安装似乎不可能”。

Perl 是“为 darwin-thread-multi-2level 构建的 v5.8.8”，是 OS X 附带的。我也尝试从源代码[构建，结果相同。](http://search.cpan.org/dist/DBD-mysql/lib/DBD/mysql.pm#INSTALLATION)

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-24T15:36:21.660

我们需要更多的错误信息。很可能，您缺少 MySQL 客户端开发文件。我不知道如何在 OSX 上安装这些。另请参阅[OSX 10.5.2 上的这篇较早的帖子](http://perlmonks.org/?node_id=678893)，其中发现了 mysql 客户端库的其他一些故障。

如果 stackoverflow 不允许方便地粘贴会话或者更确切地说是会话的最后 20 或 10 行，则可以在[perlmonks.org](http://perlmonks.org)上发布此问题以及错误消息的更多部分。`make`

更多的谷歌搜索`site:perlmonks.org`也发现了[这篇文章](http://perlmonks.org/index.pl?node_id=318334)，其中有更多关于安装 DBD::MySQL 时要注意的事情的详细信息。根据您对安装的舒适程度，您可能希望手动运行测试，提供测试数据库和测试用户，甚至跳过测试模块。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-06T17:44:24.673

经过一番谷歌搜索后，这对我有用：

```
sudo ln -s /usr/local/mysql/lib /usr/local/mysql/lib/mysql
sudo ln -s /usr/local/mysql/include /usr/local/mysql/include/mysql
sudo perl -MCPAN -e 'install Bundle::DBD::mysql' 
```

按 Enter 很多次，然后在您的 maatkit 文件夹中：

```
perl Makefile.PL
sudo make install 
```

你会在 /usr/local/bin/ 中找到 mk-* 程序

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-24T18:21:03.963

您需要先[安装 MySQL](http://dev.mysql.com/doc/refman/5.0/en/mac-os-x-installation.html)。我通常使用它们为 OS X 提供的[二进制包](http://dev.mysql.com/downloads/mysql/5.0.html#macosx-dmg)。这些包确实包括 DBD::MySQL 所需的头文件和 MySQL 客户端库。一旦安装了 MySQL 包，DBD::MySQL 应该安装没有问题。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-05T14:52:55.740

这是我的输出：

```
$ perl Makefile.PL
Checking if your kit is complete...
Looks good
Warning: prerequisite DBD::mysql 1 not found.
Writing Makefile for maatkit

$ mysql --version
mysql  Ver 14.12 Distrib 5.0.51b, for apple-darwin9.0.0b5 (i686) using readline 5.0 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-06T17:53:05.577

我注意到在[fink](http://finkproject.org/)存储库中有有效的 DBD::MySQL 包。例如：

```
ayaz@ayazs-macbook$ fink list | grep -i 'dbd-mysql'
    dbd-mysql-pm586 3.0008-10   Perl5 Database Interface to MySQL
    dbd-mysql-pm588 3.0008-10   Perl5 Database Interface to MySQL 
```

也许通过 fink 安装其中一个软件包可能有助于减轻您的麻烦。

另外，我不能确定这一点，您可能希望为 MySQL-5.x（如果您安装了该版本）安装 mysql15-dev 和 mysql15-shlibs 软件包。我通过 fink 安装了这些：

```
$ sudo fink --use-binary-dist install mysql15-dev 
```

# java - 通过 JMS 或 JavaSpaces 分发多阶段任务的优点/缺点是什么？

> ID：127629
> 
> 赞同：1
> 
> 时间：2008-09-24T14:49:51.303
> 
> 标签：java, scalability, jms, distributed, javaspaces

在尝试分配需要多阶段处理管道的工作时，JMS 与 JavaSpaces 的通信、同步和吞吐量成本限制是什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-29T09:52:02.543

如果您想要 SEDA，从一个阶段到另一个阶段发送消息，那么 JMS 实现通常更快且更具可扩展性，因为 MOM 被设计为不需要锁，因此它们可以是高度异步和并发的。使用 JMS，您可以在启动时设置使用者，消息代理通常会尽快将消息推送到您的应用程序，以便在您的应用程序可以处理它们时随时处理许多可用的内存对象 - 避免任何网络循环行程或锁定等。例如，请参阅[预取如何与 ActiveMQ 一起工作](http://activemq.apache.org/what-is-the-prefetch-limit-for.html)

使用 JavaSpaces 进行消息传递往往效率较低，因为它们通常是使用更以数据库为中心的方法来实现的，即使用锁读取/写入条目等。因此，您倾向于查询对象，然后使用 JavaSpaces 处理它们，这往往有点更健谈，消息传递效率更低。

JavaSpaces 方法的最大赢家是如果您想要共享状态；您可以将 JavaSpace 用作一种数据库。虽然如果你真的想要一个数据库，你可以使用带有 JMS 的关系数据库；但是 JavaSpace 的人们喜欢使用单一系统来共享状态和消息传递。

FWIW 通常没有中间件的灵丹妙药；有时在内存中 SEDA 是您所需要的，有时是 JMS，有时是关系数据库，有时是目录中的文件。这完全取决于您的要求、可扩展性、吞吐量、可靠性等。我倾向于建议人们[从他们的代码中隐藏中间件 API，以便他们可以通过简单的一行配置更改（例如使用 Apache Camel）轻松切换到他们想要的任何中间件](http://activemq.apache.org/camel/hiding-middleware.html)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-24T17:27:08.210

JMS 是 API，而不是产品。它不能有任何“通信、同步和吞吐量成本”。具体实现JMS（Weblogic、JBoss、Tibco、...）即可。

JMS 中没有同步功能，顺便说一句——队列就是队列，你不能让一条消息（在一个队列中）等待另一条消息（在另一个队列中）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-02T18:07:18.497

要考虑的另一点是，JMS 队列不提供基于大小进行阻塞的能力，因此纯 SEDA 实现很难使用纯 JMS 队列，因为它依赖于队列“填满”并在上游阶段施加背压.

# mysql - 是否有一个很好的 MySQL 工具可以帮助我优化查询和索引设置？

> ID：127630
> 
> 赞同：9
> 
> 时间：2008-09-24T14:50:04.440
> 
> 标签：mysql, optimization

我在一个相当复杂的网站（PHP 驱动）中使用 MySQL。

理想情况下，我可以使用一个工具来帮助我测试我正在使用的 SQL 查询，并建议更好的表索引来提高性能并避免表扫描。

如果做不到这一点，它会告诉我每个查询的确切内容，这样我就可以自己执行优化。

编辑：理解 EXPLAIN ... 输出的简单指南也会很有用。

谢谢你。

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-09-26T18:34:23.733

以下是关于 EXPLAIN 的一些信息（引用自 O'Reilly 的高性能 MySQL 书）：

当您在查询上运行 EXPLAIN 时，它会以查询中涉及的每个表的报告的形式告诉您 MySQL 所知道的关于该查询的所有信息。

这些报告中的每一个都会告诉您...

*   表的 ID（在查询中）
*   表在更大选择中的作用（如果适用，如果它只有一个表，可能只会说简单）
*   表的名称（duh）
*   连接类型（如果适用，默认为*const*）
*   表上的索引列表（如果没有，则为 NULL），*possible_keys*
*   MySQL 决定使用的索引的名称，*key*
*   键值的大小（以字节为单位）
*   *ref*显示用于匹配键的列或值
*   *rows*是 MySQL 认为它需要检查以满足查询的行数。**这应该尽可能接近您计算的最小值！**
*   ...然后 MySQL 希望传达的任何额外信息

这本书在提供这样的信息方面非常棒，所以如果你还没有，让你的老板签字同意购买。

否则，我希望一些知识渊博的 SO 用户可以提供帮助:)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-24T15:08:15.283

作为最简单的事情，启用慢查询日志并查看哪些查询很慢，然后按照建议尝试分析它们。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-24T14:52:48.487

那里可能有查询分析器，但对于简单的第一次切入，请使用 mysql 命令行，然后键入“explain select * from foo where bar = 'abc'”。确保您最常见的查询使用索引，尽量避免顺序扫描或大表排序。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2020-05-30T20:52:27.097

EverSQL [https://www.eversql.com](https://www.eversql.com)

它将分析您的慢查询并生成索引并为您提供一些提示。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-24T14:56:57.277

您应该研究一下[Maatkit](http://www.maatkit.org/)，这是一个用于执行各种 MySQL 任务的开源工具包。如果没有关于您要调整的确切内容的更多信息，很难告诉您将使用哪些工具以及如何使用，但文档非常好，它涵盖了很多应用程序。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-10T11:49:25.117

我用于其余 sql 调整的工具 ( [SQLyog](http://www.webyog.com) ) 有一个包含分析器的新版本，这太棒了！（我不为他们工作——我只是使用他们的产品）

![在此处输入图像描述](https://i.stack.imgur.com/csDfU.png)

[http://www.webyog.com/en/screenshots_sqlyog.php](http://www.webyog.com/en/screenshots_sqlyog.php)

# php - 防止在 php 上传时伪造 mime

> ID：127638
> 
> 赞同：0
> 
> 时间：2008-09-24T14:51:52.047
> 
> 标签：php, security

有没有办法防止有人在文件上传时伪造 mime 类型，然后运行 ​​php/exe/etc...

我必须使文件上传目录可写和可执行，以便可以存储文件，但这允许任何人在之后运行脚本。我可以做的一件事是在文件名中添加随机数据，这样他们就无法猜测之后的文件名（因为他们仍然无法从目录中读取以获取列表）。

我第一次使用 php 文件上传，我试图涵盖所有的安全问题。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-24T14:55:29.760

Web 浏览器应该无法访问文件上传目录。即不允许某人上传文件，说“ `remove_all_my_files.php`”，然后通过给它的 url 来在你的系统上执行它，说“ `http://xample.com/uploads/remove_all_my_files.php`”。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-24T15:00:38.297

中的信息`$_FILES`始终来自客户端，因此您要做的是接受文件并在服务器上扫描它。我要么推荐使用[finfo](http://php.net/manual/en/ref.fileinfo.php)，它是一个 PHP 扩展，它使它变得简单：

```
<?php
// example :-)
$finfo = finfo_open(FILEINFO_MIME);
echo finfo_file($finfo, '/path/to/your/upload/file);
finfo_close($finfo);
?> 
```

如果您不喜欢程序化，还有一个 OO 接口。

如果 finfo 不是一个选项，您可以使用 unix 命令[文件](http://unixhelp.ed.ac.uk/CGI/man-cgi?file)进行检查。

此外，许多人建议通过包装器提供文件。我对此感到很痛苦，它可能是一种解决方案，但远非理想，因为a）文件仍在您的服务器上，并且b）提供这样的文件很昂贵。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-24T15:20:08.580

不要直接提供文件。将上传内容保存在不可公开访问的位置。从文件中读取，输出缓冲区以允许下载。

这是基本思想：

```
function ReadAndOutputFileChunked ($filename) { 
    $chunksize = 1*(1024*1024); // how many bytes per chunk 
    $buffer = ''; 
    $handle = @fopen($filename, 'rb'); 
    if ($handle === false) { 
        return false; 
    } 
    while (!feof($handle)) { 
        $buffer = @fread($handle, $chunksize); 
        print $buffer; 
    } 
    return @fclose($handle); 
}

header("Content-type: application/octet-stream");
ReadAndOutputFileChunked('/private/path/to/upload/files/' . $nameOfFile); 
```

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2008-09-24T15:09:09.183

在我的 Apache Web 服务器配置中，我不相信实际的文件内容决定了文件是否作为脚本运行。通过匹配文件结尾来确定是否将文件显示为文本或图像格式，或者将其作为脚本运行。

比如apache配置文件中的一个指令，httpd.conf的

AddType application/x-httpd-php .php

告诉服务器运行以 .php 结尾的文件以作为 php 脚本运行。因此，只需确保没有以 .php 结尾或任何其他脚本可执行文件结尾或您用于包含文件的任何文件结尾保存上传的文件。

# vb6 - 是否可以在 VB6 中以编程方式检索调用堆栈？

> ID：127645
> 
> 赞同：14
> 
> 时间：2008-09-24T14:53:15.990
> 
> 标签：vb6, runtime, callstack

当函数中发生错误时，我想知道导致错误的事件顺序，尤其是当从十几个不同的地方调用该函数时。有什么方法可以在 VB6 中检索调用堆栈，还是我必须以艰难的方式进行（例如，每个函数和错误处理程序中的日志条目等）？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-10-15T22:13:41.503

您确实必须以艰难的方式来做，但这并不是那么***难***……说真的，一旦您编写了模板，就可以快速复制/粘贴/修改以匹配 Err.Raise 语句中的函数名称到实际的函数名称。

```
Private Function DoSomething(ByVal Arg as String)

    On Error GoTo Handler

    Dim ThisVar as String
    Dim ThatVar as Long

    ' Code here to implement DoSomething...

    Exit Function

Handler:
    Err.Raise Err.Number, , "MiscFunctions.DoSomething: " & Err.Description

End Function 
```

当您有嵌套调用时，这会在每个例程命中其处理程序并将其名称添加到错误描述时展开。在顶层函数中，您会获得一个“调用堆栈”，其中显示了被调用的例程列表，以及实际发生的错误的错误号和描述。这并不完美，因为您没有获得行号，但我发现您通常不需要它们来找到解决问题的方法。（如果你真的想要行号，你可以把它们放在函数中，并使用 Erl 变量在 Err.Raise 语句中引用它们。没有行号，它只返回 0。）

另外，请注意，在函数本身中，您可以使用消息中有趣变量的值引发您自己的错误，如下所示：

```
Err.Raise PCLOADLETTER_ERRNUM, , "PC Load Letter error on Printer """ & PrinterName & """" 
```

（预览中的语法突出显示看起来很奇怪......我想知道它在发布时会是什么样子？）

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-09-24T15:13:31.497

我很确定你必须以艰难的方式做到这一点。在我以前的工作中，我们有一个非常优雅的带有 DCOM 组件的 VB6 错误处理过程。但是，每个方法都必须添加大量冗余代码，以至于我们有自己开发的工具可以为您插入所有代码。

我无法提供太多关于其实施的见解（因为我已经忘记了大部分内容，而且他们有可能将其视为商业机密）。值得注意的一件事是方法名称无法在运行时派生，因此它被添加为字符串变量（一些开发人员会复制粘贴而不是使用该工具，这会导致错误堆栈撒谎。 ..)。

高温高压

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-24T16:43:52.917

硬的手动方法几乎是唯一的方法。如果您查看[此](https://stackoverflow.com/questions/116289/what-is-the-better-way-to-handle-errors-in-vb6)问题，有人建议使用名为 MZTools 的工具来为您完成大部分繁重的工作。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-11-25T10:59:18.770

正如其他人所说（几年前，我明白了......但是还有很多人仍在使用 VB6！:)），我认为不可能以编程方式检索调用堆栈，除非您使用一些第 3 方工具。

但是，如果您出于调试目的需要这样做，您可以考虑在被调用例程中添加一个可选输入字符串变量，如果您将输入调用者的名称。

```
Sub MyRoutine
    (...)  ' Your code here
    call DoSomething (Var1, Var2, Var3, "MyRoutine")
    '                                       ^
    '     Present routine's name -----------+

    (...)  ' Your code here

End Sub

Public DoSomething (DoVar1, DoVar2, DoVar3, Optional Caller as string = "[unknown]")
    Debug.Print " DoSomething Routine Called. Caller = " & Caller

    ... ' (your code here)

End Sub 
```

也许不是那么优雅，但它对我有用。

问候， Max - 意大利

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2008-10-12T22:18:22.307

Compuware（或者当时是 Numega）DevStudio for Visual Basic 6 曾经这样做过。方法是在每个调用中添加添加工具，该调用调用添加到代码堆栈的非常小的片段。在出现任何错误时，它会转储该调用堆栈，然后执行诸如邮件或将所有调试信息发布到网络服务器之类的操作。添加和删​​除检测是一个潜在的致命操作（尤其是在当时，当我们使用 VSS 作为我们的源代码控制时），但如果它有效，它就会运作良好。

正如[Darrel 指出的那样](https://stackoverflow.com/questions/127645/is-it-possible-to-retrieve-the-call-stack-programmatically-in-vb6#128285)，您可以通过使用 MZTools 并设置模板来添加一些非常相似的东西。这需要大量的工作，并且可能比奖励更努力，但如果你很难找到错误，它可能会有所帮助）。

# visual-studio - 在 VS 2005 中更改 Crystal Report 的 Catalog 属性

> ID：127654
> 
> 赞同：1
> 
> 时间：2008-09-24T14:54:46.377
> 
> 标签：visual-studio, crystal-reports

我正在处理现有报告，我想用数据库对其进行测试。问题是在初始报告创建期间设置的目录不再存在。我只需要将目录参数更改为新数据库。该报告为其数据使用存储过程。看起来如果尝试删除 proc 以重新添加它，报告上的所有字段都会消失，我将不得不重新开始。

我在 Studio 的设计器中工作，只需要调整目录属性即可获得预览。我有代码可以从程序中正确处理事情。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-25T19:22:38.690

如果您只需要在设计器中执行此操作，则右键单击一些空白并单击数据库-> 设置数据源位置。从那里您可以使用当前连接或添加新连接。使用新目录设置新连接。然后单击顶部的当前连接，然后单击更新。您的数据源将发生变化。但是如果您需要在运行时执行此操作，那么以下代码是最好的方式。

```
#'SET REPORT CONNECTION INFO
        For i = 0 To rsource.ReportDocument.DataSourceConnections.Count - 1
            rsource.ReportDocument.DataSourceConnections(i).SetConnection(crystalServer, crystalDB, crystalUser, crystalPassword)
        Next 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-24T14:57:49.880

编辑：看到你的编辑，所以我会保留我原来的帖子，但不得不说..我从来没有在 VS 的设计模式下有过水晶报告，所以对不起，我帮不上什么忙。

```
report.SetDatabaseLogon(UserID, Password, ServerName, DatabaseName); 
```

之后，您必须遍历报告中所有引用的表并递归子报告并根据报告连接信息将其登录信息重置为一个。

```
 private void FixDatabase(ReportDocument report)
    {
        ConnectionInfo crystalConnectionInfo = someConnectionInfo;

        foreach (Table table in report.Database.Tables)
        {
            TableLogOnInfo logOnInfo = table.LogOnInfo;

            if (logOnInfo != null)
            {
                logOnInfo.ConnectionInfo = crystalConnectionInfo;

                table.LogOnInfo.TableName = table.Name;
                table.LogOnInfo.ConnectionInfo.UserID = someConnectionInfo.UserID;
                table.LogOnInfo.ConnectionInfo.Password = someConnectionInfo.Password;
                table.LogOnInfo.ConnectionInfo.DatabaseName = someConnectionInfo.DatabaseName;
                table.LogOnInfo.ConnectionInfo.ServerName = someConnectionInfo.ServerName;
                table.ApplyLogOnInfo(table.LogOnInfo);

                table.Location = someConnectionInfo.DatabaseName + ".dbo." + table.Name;
            }
        }

        //call this method recursively for each subreport
        foreach (ReportObject reportObject in report.ReportDefinition.ReportObjects)
        {
            if (reportObject.Kind == ReportObjectKind.SubreportObject)
            {
                this.FixDatabase(report.OpenSubreport(((SubreportObject)reportObject).SubreportName));
            }
        }
    } 
```

# visual-studio - 在 Vista 计算机上调试 XP 应用程序

> ID：127664
> 
> 赞同：1
> 
> 时间：2008-09-24T14:56:36.700
> 
> 标签：visual-studio, debugging, windows-vista, remote-debugging

我正在为 XP 和 Vista 构建一个 MFC 应用程序。我在 XP 机器上安装了 Visual Studio 2008，但我需要在 Vista 上调试应用程序。我怎样才能做到这一点？我真的必须在 Vista 机器上安装 Visual Studio 吗？

使用远程调试时，我假设所有可执行文件和库文件都必须在我的 Vista 虚拟机中。但我似乎可以将 MFC 调试 DLL 复制到 Vista VM，因此我不断收到并排配置错误。

我宁愿远程调试应用程序而不必复制任何文件，我该怎么做？如果我不能，我如何安装 MFC DLL 而无需在 Vista 机器上安装 Visual Studio？

注意：我在使用 Virtual PC 的虚拟机上安装了 Vista。我只是不知道如何在那里运行我的应用程序的调试版本。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-24T14:59:46.037

您可以安装 VirtualPC（或其他虚拟化软件）并将 Vista 安装为虚拟系统，因此您不需要两台计算机。对于这部分调试，最好不要明确**安装**Visual Studio，以确保 Visual Studio 提供的程序中没有隐藏的依赖项。此时，您想要测试应用程序的完全部署版本。

到目前为止，我发现为 vista 开发的最大规则是确保您*永远不会*向安装程序的同一文件夹写入任何内容。改为写入 Application Data 文件夹。这也是 XP 的规则，但在 vista 中执行得更加严格。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-24T15:18:15.307

如果你有 Visual Studio Pro 或 Team，你可以尝试[远程调试](http://msdn.microsoft.com/en-us/library/y7f5zaaa.aspx)。只有一个小存根安装在远程计算机上。

如果要运行应用程序的调试版本，还需要在虚拟 PC 上安装调试运行时文件。

# bash - 跨多个目录同步文件修改时间

> ID：127669
> 
> 赞同：4
> 
> 时间：2008-09-24T14:57:14.313
> 
> 标签：bash, file

我有一台带有两个目录树的计算机 A。第一个目录包含可以追溯到几年前的原始 mod 日期。第二个目录是第一个目录的副本，其中包含一些附加文件。有第二台计算机包含一个目录树，该目录树与计算机 A 上的第二个目录相同（新的修改时间和附加文件）。如何更新两台机器上两个较新目录中的文件，以使文件上的修改时间与原始文件相同？请注意，这些目录树大约为 10 GB，因此解决方案必须包括一些仅将日期信息发送到第二台计算机的方法。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2013-05-20T10:36:07.743

保罗的回答部分正确，`rsync`能够做到这一点，但参数不同。正确的命令是

```
rsync -Prt --size-only original_dir copy_dir 
```

where`-P`启用部分传输并显示进度指示器，`-r`通过子目录递归，`-t`保留时间戳并且`--size-only`不传输大小匹配的文件。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-24T17:06:27.857

以下命令将确保 TEST2 获得与 TEST1 相同的日期

```
touch -t `stat -t '%Y%m%d%H%M.%S' -f '%Sa' TEST1` TEST2 
```

现在，您可以使用“查找”实用程序查找文件，然后在远程计算机上通过 SSH 运行 touch，而不是在这里使用硬编码值。但是，这意味着您可能必须为每个文件输入密码，除非您将 SSH 切换到证书身份验证。我宁愿不要在一个超级花哨的单衬里做这一切。相反，让我们使用临时文件。首先转到有问题的目录并运行查找（您可以按文件类型、大小、扩展名进行过滤，无论您喜欢什么，有关详细信息，请参阅“man find”。我只是在这里按文件类型过滤以排除任何目录）：

```
find . -type f -print -exec stat -t '%Y%m%d%H%M.%S' -f '%Sm' "{}" \; > /tmp/original_dates.txt 
```

现在我们有一个看起来像这样的文件（在我的示例中只有两个条目）：

```
# cat /tmp/original_dates.txt 
./test1
200809241840.55
./test2
200809241849.56 
```

现在只需将文件复制到另一台机器并将其放在目录中（因此相对文件路径匹配）并应用日期：

```
cat original_dates.txt | (while read FILE && read DATE; do touch -t $DATE "$FILE"; done) 
```

也适用于包含空格的文件名。

一个注释：我在 stat 使用了最后一个“修改”日期，因为这就是你在问题中写的。但是，听起来好像您想使用“创建”日期（每个文件都有创建日期、最后修改日期和最后访问日期），您需要稍微更改 stat 调用。

```
'%Sm' - last modification date
'%Sc' - creation date
'%Sa' - last access date 
```

但是，触摸只能改变修改时间和访问时间，我认为它不能改变文件的创建时间......所以如果这是你的真正意图，我的解决方案可能不是最佳的......但在那如果你的问题也是;-)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-24T16:48:13.437

I would go through all the files in the source directory tree and gather the modification times from them into a script that I could run on the other directory trees. You will need to be careful about a few 'gotchas'. First, make sure that your output script has relative paths, and make sure you run it from the proper target directory, which should be the root directory of the target tree. Also, when changing machines make sure you are using the same timezone as you were on the machine where you generated the script.

Here's a Perl script I put together that will output the `touch` commands needed to update the times on the other directory trees. Depending on the target machines, you may need to tweak the date formats or command options, but this should give you a place to start.

```
#!/usr/bin/perl

my $STARTDIR="$HOME/test";

chdir $STARTDIR;
my @files = `find . -type f`;
chomp @files;

foreach my $file (@files) {
   my $mtime = localtime((stat($file))[9]);
   print qq(touch -m -d "$mtime" "$file"\n);
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-24T16:50:28.953

The other approach you could try is to attach the remote directory using NFS and then copy the times using `find` and `touch -r`.

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-24T16:47:41.787

I think rsync (with the right options) will do this - it claims to only send file differences, so presumably will work out that there are no differences to be transferred.

--times preserves the modification times, which is what you want.

See (for instance) [http://linux.die.net/man/1/rsync](http://linux.die.net/man/1/rsync)

Also add -I, --ignore-times don't skip files that match size and time

so that all files are "transferred' and trust to rsync's file differences optimisation to make it "fairly efficient" - see excerpt from the man page below.

> -t, --times This tells rsync to transfer modification times along with the files and update them on the remote system. Note that if this option is not used, the optimization that excludes files that have not been modified cannot be effective; in other words, a missing -t or -a will cause the next transfer to behave as if it used -I, causing all files to be updated (though the rsync algorithm will make the update fairly efficient if the files haven't actually changed, you're much better off using -t).

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2013-12-04T14:49:21.527

我改用了以下 Python 脚本。

Python 脚本的运行速度比为每个文件创建新进程的方法（如使用`find`and `stat`）快得多。下面的解决方案也适用于系统之间的时区差异，因为它使用 UTC 时间。它也适用于包含空格的路径（但不适用于包含换行符的路径！）。它没有为符号链接设置时间，因为[操作系统没有提供修改符号链接时间戳的机制](http://bugs.python.org/issue623782)，但是在文件管理器中，符号链接指向的文件的时间无论如何都会显示。它使用一个`maxTime`参数来避免重置从原始目录复制后实际修改的文件的日期。

**listMTim​​es.py：**

```
import os
from datetime import datetime
from pytz import utc

for dirpath, dirnames, filenames in os.walk('./'):
    for name in filenames+dirnames:
        path = os.path.join(dirpath, name)
        # Avoid symlinks because os.path.getmtime and os.utime get and
        # set the time of the pointed file, and in the new directory,
        # the link may have been redirected.
        if not os.path.islink(path):
            mtime = datetime.fromtimestamp(os.path.getmtime(path), utc)
            print(mtime.isoformat()+" "+path) 
```

**setMTim​​es.py：**

```
import datetime, fileinput, os, sys, time
import dateutil.parser
from pytz import utc

# Based on
# http://stackoverflow.com/questions/6999726/python-getting-millis-since-epoch-from-datetime
def unix_time(dt):
    epoch = datetime.datetime.fromtimestamp(0, utc)
    delta = dt - epoch
    return delta.total_seconds()

if len(sys.argv) != 2:
    print('Syntax: '+sys.argv[0]+' <maxTime>')
    print('  where <maxTime> an ISO time, e. g. "2013-12-02T23:00+02:00".')
    exit(1)

# A file with modification time newer than maxTime is not reset to
# its original modification time.
maxTime = unix_time(dateutil.parser.parse(sys.argv[1]))

for line in fileinput.input([]):
    (datetimeString, path) = line.rstrip('\r\n').split(' ', 1)
    mtime = dateutil.parser.parse(datetimeString)
    if os.path.exists(path) and not os.path.islink(path):
        if os.path.getmtime(path) <= maxTime:
            os.utime(path, (time.time(), unix_time(mtime))) 
```

**用法：**在第一个目录（原）运行

```
python listMTimes.py >/tmp/original_dates.txt 
```

然后在第二个目录（原始的副本，可能带有一些修改/添加/删除的文件）中运行如下内容：

```
python setMTimes.py 2013-12-02T23:00+02:00 </tmp/original_dates.txt 
```

# mysql - 在 MySQL 中查看授权

> ID：127679
> 
> 赞同：34
> 
> 时间：2008-09-24T14:58:55.633
> 
> 标签：mysql

如何在 MySQL 中查看给定用户的授权（访问权限）？

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2008-09-24T20:04:14.107

MySQL 最新版本的另一种方法是：

```
select * from information_schema.user_privileges where grantee like "'user'%"; 
```

这种格式的可能优点是增加了检查来自任何主机的“用户”授权（假设用户名一致）或检查具有附加条件的特定权限（例如，privilege_type = 'delete'）的灵活性。

这个版本可能更适合在脚本中使用，而“show grants”语法更适合交互式会话（更“人类可读”）。

* * *

## 回答 #2

> 赞同：27
> 
> 时间：2008-09-24T14:59:23.557

```
mysql> show grants for 'user'@'host' 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2012-11-11T03:13:44.233

你可以试试这个：

```
SELECT GRANTEE, PRIVILEGE_TYPE FROM information_schema.user_privileges;
SELECT User,Host,Db FROM mysql.db; 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-09-24T17:53:53.937

您可能想查看[Maatkit](http://www.maatkit.org/)中的 mk-show-grants ，它将以规范的形式为所有用户输出当前的授权集，从而使版本控制或复制更加直接。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-24T15:03:08.527

如果您已经在使用 PHP 运行 Web 服务器，那么[phpMyAdmin](http://www.phpmyadmin.net/)是一个相当友好的管理工具。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2020-08-14T07:31:54.487

您可能需要[出示赠款声明](https://dev.mysql.com/doc/refman/5.7/en/show-grants.html)

```
SHOW GRANTS [FOR user] 
```

此语句以必须执行以复制权限分配的 GRANT 语句的形式显示分配给 MySQL 用户帐户的权限。

要显示授予当前用户（您用于连接服务器的帐户）的权限，您可以使用以下任何语句：

```
SHOW GRANTS;
SHOW GRANTS FOR CURRENT_USER;
SHOW GRANTS FOR CURRENT_USER(); 
```

**注意：**
SHOW GRANTS 需要 mysql 系统数据库的 SELECT 权限，但显示当前用户的权限除外。\

直接来自官网

# http - 为 REST 请求禁用 Jetty 服务器的客户端缓存

> ID：127684
> 
> 赞同：3
> 
> 时间：2008-09-24T14:59:26.007
> 
> 标签：http, rest, caching, jetty, jersey

我有一个 REST Java 服务器，使用在 Jetty 上运行的 Jersey 实现。似乎某些浏览器（IE7）在内部缓存了对服务器的所有请求。

我想做的是在来自 REST 服务器的响应中发送某个 HTTP 标头，指示浏览器它不应该缓存该响应，因此下次它需要访问该资源时将再次查询服务器。

关于如何为此配置 Jersey/Jetty 的任何想法？或者配置它的唯一方法是客户端？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-04T03:24:52.563

> response.setHeader("Pragma", "no-cache");

不不不！

使用 pragma 标头来禁用客户端缓存是错误的，它是一个请求标头，对响应的影响*为零。*

[http://www.mnot.net/cache_docs/#PRAGMA](http://www.mnot.net/cache_docs/#PRAGMA)

[http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html#sec14.32](http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html#sec14.32)

此外，设置 Expires: 0 不正确，Expires 应该是一个日期，而不是秒数，但是这*将*作为无效的 http 日期被解释为“已经过期”

[http://www.mnot.net/cache_docs/#EXPIRES](http://www.mnot.net/cache_docs/#EXPIRES)

[http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html#sec14.21](http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html#sec14.21)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-24T15:04:09.427

对于恶意客户端，您无能为力，但 Jetty 可以发送适当的 HTTP 标头。尝试[在此处](http://docs.codehaus.org/display/JETTY/LastModifiedCacheControl)获取有关配置 Last-Modified 和 Cache-Control 标头的信息。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-24T15:05:53.263

在服务器端，如果您可以访问响应，则可以尝试此操作（您可能可以通过过滤器进行操作）。

```
response.setHeader("Pragma", "no-cache");
response.setHeader("Cache-Control", "no-cache");
response.setHeader("Expires", "0"); 
```

您可以在客户端尝试的另一个技巧是向 url 添加一个多余的参数，例如“ [http://www.company.com/services/staff?id=xxx&requestTime=](http://www.company.com/services/staff?id=xxx&requestTime=) "+(new Date()).getTime() ; 这样每次请求的url都不一样，不能缓存。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-02-02T14:58:11.803

@Dave Cheney：嗯，我从[http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html#sec14.9](http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html#sec14.9)了解到缓存控制对请求和响应都有意义。当响应是缓存控制的响应时，它是客户端（浏览器）应该如何处理资源的规范（参见下一节，14.9.1）。

@all：此外，在同一文档的第 14.21 节中，指定设置为 0 的 Expires 标头表示“无效日期”，并且可以被客户端忽略。我的测试将过期日期发送到 1970 年 1 月 1 日（时间戳 0）只会导致 IE 忽略（以及 ff ），它仍然会缓存响应。

我的解决方案是发送 Expires 字段的当前日期，这就是规范所说的。

# unit-testing - 最喜欢的 .NET 单元测试框架

> ID：127687
> 
> 赞同：5
> 
> 时间：2008-09-24T15:00:01.340
> 
> 标签：unit-testing, nunit, automated-tests

我已经使用 NUnit 几年了。我已经尝试了一段时间的 MBUnit 以及 Zenebug 和 XUnit，但我一直回到 NUnit。

你最喜欢/最常用的单元测试框架是什么？你能解释一下你为什么使用它吗？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-09-24T15:01:52.740

Nunit为胜利！它简单易行。没有混乱，没有大惊小怪。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-09-24T15:07:52.557

xUnit.net，但我几乎没有偏见。:)

为什么我使用它：[http ://www.codeplex.com/xunit/Wiki/View.aspx?title=WhyDidWeBuildXunit](http://www.codeplex.com/xunit/Wiki/View.aspx?title=WhyDidWeBuildXunit)

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-09-24T15:05:49.377

[兆单位](http://www.mbunit.com)

我喜欢它处理报告的方式，我期待着我听说过的一些即将推出的功能，例如与 JsUnit 的集成。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-09-26T17:11:48.363

我已经使用 nUnit 多年了，但是当我们迁移到 VS2008 和 TFS 2008（使用 TeamBuild）时，我们决定尝试 MSTest。没有什么大的抱怨……我们真的很喜欢它与 IDE 以及 CI 构建服务器的集成程度。

我们正在尝试的一个看起来具有巨大潜力的新东西是来自 Microsoft Research 的另一个名为[Pex](http://research.microsoft.com/pex)的附加组件（需要 VS2008）。正如他们所说：“Pex 通过基于动态符号执行的自动探索性测试，从手写参数化单元测试生成单元测试。” 我的说法是：这个东西对你的单元测试和目标代码以及codegen的单元测试进行静态分析，以实现超高的代码覆盖率（如果你手动这样做通常是不切实际的）。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-09-24T16:43:03.387

**[Gallio](http://www.gallio.org/)** looks like it's going to be awesome once it gets more stable (currently alpha).

It's not just a test framework, but a test automation platform, so it will work with many existing test frameworks (MbUnit, NUnit, xUnit.net) yet be fully extensible, with a number of built-in additional features such as report generation in many formats and code analysis tools.

I've also heard that it will be able to

*   output image streams, so for example WatiN test failures can be output as screenshots, so you can see what state the browser was in when the test failed.
*   filter by namespace, so you can easily uncheck tests for an entire namespace before running them

Edit: It is indeed out of alpha now. We've tried it at our company and we really hated it. It was horrible to use and very slow. What a shame.

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-09-24T15:01:58.717

我使用 Nunit 已经有一段时间了，但我碰巧更喜欢嵌入 VS 的东西。所以，我现在正在使用 MSUnit。只是喜欢在 VS 中安装较少的插件。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-09-24T15:35:55.733

单元。我们可以在 CC 上使用它。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-10-01T07:46:09.973

Resharper 中对 NUnit 测试的支持非常好，并且为我离开 NUnit 设置了很高的标准。我可以直接从 Visual Studio 运行解决方案中的所有测试，也可以深入研究并专注于特定测试。签入我的代码后，我的持续集成构建运行相同的测试。这让我对自己的开发过程充满信心。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-07-02T22:12:21.447

测试

[http://en.wikipedia.org/wiki/MSTest](http://en.wikipedia.org/wiki/MSTest)

我不知道它是否是我最喜欢的（还没有真正尝试过很多其他的），但它很方便，因为它内置在 Visual Studio 中。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-09-24T15:04:07.167

我喜欢 xUnit，因为它使用构造函数和 Dispose 方法的方式，而不必将属性应用到其他方法进行初始化等等。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2008-09-24T15:36:10.177

[MbUnit](http://www.mbunit.com/)具有与 NUnit 兼容的语法，但具有更多功能（尤其是数据驱动测试）。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-07-02T22:21:20.323

1.  xUnit - 少仪式，支持数据驱动测试和其他扩展

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2010-11-16T17:14:47.330

我使用过 NUnit 和 MS Test。我喜欢 MS Test 与 IDE 的集成以及代码覆盖率的额外好处。但是由于性能原因以及流畅的断言之类的原因，我更喜欢使用 NUnit 而不是 MS 测试。

您可以使用名为 Should 的库编写与框架无关的断言。它还有一个非常好的流畅语法，如果你喜欢流畅的界面，可以使用它。我有一篇与此相关的博客文章。

[http://nileshgule.blogspot.com/2010/11/use-should-assertion-library-to-write.html](http://nileshgule.blogspot.com/2010/11/use-should-assertion-library-to-write.html)

如果我们对断言使用像应该这样的东西，那么两个版本的测试几乎是一样的，我看不出两个框架之间有太大的区别。

我在我的[一篇博客](http://nileshgule.blogspot.com/2009/09/comparing-unit-testing-framework.html)中对 NUnit 和 MSTest 单元测试框架进行了比较。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2009-10-26T20:43:17.063

我已经使用 NUnit 大约 4 年了，肯定会推荐使用它。Reshaper - JetBrains 的 VisualStudio 插件包括一个 UnitTestRunner，它与 VisualStudio 完美集成，让您可以直接从 IDE 运行/调试测试。Resharper、NUnit 和 RhinoMocks 是我首选的单元测试工具套件。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2008-09-24T15:06:30.670

我以前使用 NUnit，但现在我更喜欢 Visual Studio 2008 附带的框架，因为它具有更紧密的集成并且更易于设置以测试私有方法。

在保持 NUnit 版本与团队其他成员同步方面，我们也遇到了问题。这是一个小烦恼（去升级，或修复项目引用），但它随着开关而消失了。

# performance - 多次修改后的SVN性能

> ID：127692
> 
> 赞同：50
> 
> 时间：2008-09-24T15:00:32.637
> 
> 标签：performance, svn, repository, fsfs

我的项目目前正在使用一个 svn 存储库，它每天会获得数百个新修订。该存储库位于 Win2k3 服务器上，并通过 Apache/mod_dav_svn 提供服务。

我现在担心随着时间的推移性能会因为太多的修改而下降。
这种恐惧合理吗？
我们已经计划升级到 1.5，因此从长远来看，在一个目录中拥有数千个文件不会成为问题。

> Subversion on 存储 2 个修订版之间的 delta（差异），因此这有助于节省大量空间，特别是如果您只提交代码（文本）而没有二进制文件（图像和文档）。

这是否意味着为了检查文件 foo.baz 的修订版 10，svn 将采用修订版 1，然后应用 deltas 2-10？

* * *

## 回答 #1

> 赞同：60
> 
> 时间：2008-09-25T01:54:19.350

你有什么类型的回购？FSFS 还是 BDB？

（我们现在假设 FSFS，因为这是默认设置。）

在 FSFS 的情况下，每个版本都存储为与前一个版本的差异。所以，你会认为是的，经过多次修改，它会很慢。

然而，事实并非如此。FSFS 使用所谓的“跳过增量”来避免对以前的转速进行过多的查找。

（因此，如果您使用的是 FSFS 存储库，Brad Wilson 的回答是错误的。）

在 BDB 存储库的情况下，HEAD（最新）修订版是全文，但较早的修订版是作为一系列针对 head 的差异构建的。这意味着每次提交后必须重新计算以前的转速。

欲了解更多信息：http: [//svn.apache.org/repos/asf/subversion/trunk/notes/skip-deltas](http://svn.apache.org/repos/asf/subversion/trunk/notes/skip-deltas)

PS 我们的 repo 大约 20GB，大约有 35,000 次修订，我们没有注意到任何性能下降。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2008-09-24T15:14:44.317

Subversion 将最新版本存储为全文，并带有向后看的差异。这意味着对 head 的更新总是很快，而您逐步支付的费用是在历史上越来越远。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-09-24T15:17:49.270

对于实际项目，我个人没有处理过代码库大于 80K LOC 的 Subversion 存储库。我实际拥有的最大存储库大约是 1.2 gig，但这包括项目使用的所有库和实用程序。

我认为日常使用不会受到太大影响，但是任何需要查看不同修订版的东西都可能会减慢一点。它甚至可能不明显。

现在，从系统管理员的角度来看，有一些事情可以帮助您最大限度地减少性能瓶颈。由于 Subversion 主要是一个基于文件的系统，你可以这样做：

*   将实际存储库放在不同的驱动器中
*   确保除了 svn 之外没有文件锁定应用程序在上面的驱动器上工作
*   使驱动器至少达到 7,500 RPM。您可以尝试获得 10,000 RPM，但这可能是矫枉过正
*   如果每个人都在同一个办公室，请将 LAN 更新为千兆。

对于您的情况，这可能有点矫枉过正，但这是我通常为其他文件密集型应用程序所做的。

如果您曾经“超越” Subversion，那么[Perforce](http://perforce.com/)将是您的下一步。它是超大型项目最快的源代码控制应用程序。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-09-24T15:20:39.997

我们正在运行一个带有数千兆字节代码和二进制文件的颠覆服务器，它的修订版多达两万多个。还没有减速。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-24T15:04:59.113

Subversion 仅存储 2 个修订版之间的 delta（差异），因此这有助于节省大量空间，特别是在您仅提交代码（文本）而没有二进制文件（图像和文档）的情况下。

此外，我见过很多非常大的项目使用 svn，并且从未抱怨过性能。

也许您担心结帐时间？那么我想这真的是一个网络问题。

哦，我曾经在 CVS 存储库上工作过 2Gb+ 的东西（代码、imgs、文档），从来没有遇到过性能问题。由于 svn 对 cvs 有很大的改进，我认为您不必担心。

希望它可以帮助您放松一下；）

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2013-11-18T16:54:59.747

我不认为我们的颠覆会因老化而减慢。我们目前有几个 TeraBytes 的数据，大部分是二进制的。我们每天签出/提交最多 50 GB 的数据。我们目前总共有 50000 次修订。我们使用 FSFS 作为存储类型，并直接连接 SVN：（Windows 服务器）或通过 Apache mod_dav_svn（Gentoo Linux 服务器）。

我无法确认这会使 svn 随着时间的推移而变慢，因为我们设置了一个干净的服务器来进行性能比较，我们可以进行比较。我们无法测量出显着的退化。

但是我不得不说，我们的颠覆在默认情况下非常慢，显然它本身就是颠覆，因为我们尝试使用另一个计算机系统。

由于某些未知原因，颠覆似乎完全受到服务器 CPU 的限制。我们的结帐/提交率限制在每个客户端 15-30 兆字节/秒之间，因为这样一个服务器 CPU 内核就会完全用完。这对于一个几乎空的存储库（1 GigaByte，5 个修订版）和我们的完整服务器（~5 TeraByte，50000 个修订版）是一样的。像将压缩设置为 0 = 关闭这样的调整并没有改善这一点。

我们的高带宽（提供约 1 GigaByte/s）FC 阵列空闲，其他内核空闲和网络（当前客户端为 1 GigaBit/s，服务器为 10 GigaBits/s）也空闲。好吧，不是真的空转，但如果只使用了 2-3% 的可用容量，我称之为空转。

看到所有组件都处于空闲状态并不是很有趣，我们需要等待我们的工作副本被检出或提交。基本上我不知道服务器进程在结帐/提交期间一直完全消耗一个 CPU 内核在做什么。

但是我只是想找到一种方法来调整颠覆。如果这是不可能的，我们可能需要切换到另一个系统。

因此： 答：没有 SVN 不会降低性能，它最初很慢。

当然，如果您不需要（高）性能，您不会有问题。顺便提一句。以上所有适用于 subversion 1.7 最新稳定版本

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-09-24T15:10:59.693

唯一可能减慢速度的操作是从多个修订版中读取信息的操作（例如 SVN Blame）。

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2009-04-17T18:52:30.770

我不确定.....我在 Centos 5.2 上使用 SVN 和 apache。工作正常。修订号是 8230 之类的……在所有客户端计算机上，提交非常慢，以至于我们必须等待至少 2 分钟才能获得 1kb 的文件。我说的是 1 个没有大文件大小的文件。

然后我创建了一个新的存储库。从转速开始。1\. 现在工作正常。快速地。使用 svnadmin 创建 xxxxxx。没有检查它是FSFS还是BDB.....

* * *

## 回答 #9

> 赞同：-2
> 
> 时间：2010-02-26T09:07:14.133

也许您应该考虑改进您的工作流程。

**我不知道回购在这些情况下是否会出现性能问题，但是您能够回到理智的修订版。**

在您的情况下，您可能希望包含一个验证过程，因此团队负责人存储库中的团队提交，并且他们每个人都提交给团队经理存储库，团队经理存储库提交到只读干净的公司存储库。你已经在它的阶段做出了一个干净的选择，什么提交必须放在顶部。

这样，任何人都可以返回到干净的副本，并具有易于浏览的历史记录。合并要容易得多，开发人员仍然可以随意提交他们的烂摊子。

# firefox - Firefox XPCOM 组件 - 调用方法 UnnamedClass 的权限被拒绝

> ID：127693
> 
> 赞同：2
> 
> 时间：2008-09-24T15:00:37.300
> 
> 标签：firefox, xpcom, firefox-3

firefox XPCOM 组件可以跨多个页面读写页面内容吗？

场景：一堆本地 HTML 和 javascript 文件。“Main.html”文件打开一个窗口“pluginWindow”，并使用以下方法创建插件：

`netscape.security.PrivilegeManager.enablePrivilege('UniversalXPConnect');
var obj = Components.classes[cid].createInstance();
plugin = obj.QueryInterface(Components.interfaces.IPlugin);
plugin.addObserver(handleEvent);`

具有 3 种方法的插件。

`IPlugin.Read`- 从插件读取数据
`IPlugin.Write`- 将数据写入插件
`IPlugin.addObserver`- 添加回调处理程序以进行读取。

“Main.html”然后调用pluginWindow 并尝试调用插件方法Write。

我收到一个错误：

`Permission denied to call method UnnamedClass.Write`

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-25T15:22:31.607

Main.html 和其他窗口是否以 chrome 权限运行？如果您“正常”访问 Main.html，只需将其放在 Firefox 的地址栏上，那么它的功能就会受到限制（否则，任意网页都可以完全一样）。

如果您正在创建一个 firefox 插件，请将您的代码放在 XUL 覆盖中。

如果您真的想允许任何网页执行您的插件所做的任何事情，您可以建立一些机制，通过该机制页面可以要求插件使用其 chrome 权限执行操作，然后将结果发送到页面。

如果您没有制作 Firefox 扩展...那么恐怕我误解了一些东西，您能解释一下吗？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-28T21:44:37.690

首先，您的 C++ 代码真的是[插件](http://developer.mozilla.org/en/Plugins)还是[XPCOM 组件](http://developer.mozilla.org/en/XPCOM)，可能作为[扩展](http://developer.mozilla.org/en/Extensions)的一部分安装？好像是后者。

如果是这样，它就不能从不受信任的 JS 代码中使用——任何网页或本地 HTML 文件。它完全可以从特权代码中使用，其中最常见的类型是[扩展](http://developer.mozilla.org/en/Extensions)代码。

`enablePrivilege('UniversalXPConnect')`使用调用创建组件时，您正在解决此问题。这不是真正推荐的，除非它不会分发给用户（因为这个调用会弹出一个令人困惑的框，并且如果您将首选项设置为始终允许 file:// 脚本使用 XPCOM，这可能是一个安全问题，因为并非所有本地页面是受信任的 - 想想保存的网页）。

`Write`由于同样的原因，您的调用失败 - 不信任 file:// 页面使用 XPCOM 组件。`enablePrivilege`如果您在与 Write 调用本身相同的函数中添加另一个调用，您可能可以让它工作。

根据情况，可能会有更好的解决方案。

如果您的文件必须被视为可信文件，您可能希望将它们打包为扩展并通过 chrome:// URL 访问它们。这使这些页面中的代码有权调用任何 XPCOM 组件，包括您的组件。

[如果组件的方法可以从任何页面安全使用，或者如果环境受到控制并且浏览器中没有加载不受信任的页面，则可以使组件可访问内容（在mozilla 代码](http://mxr.mozilla.org/mozilla-central/)中搜索 nsSidebar 以获取示例，也可以搜索`nsISecurityCheckedComponent`）。

哦，当您在这里没有得到好的答案时，您绝对应该尝试使用 mozilla 新闻组/邮件列表。

[编辑回复评论] 考虑将需要调用组件的代码放在 chrome:// 脚本中。或者，您应该能够使用这样的代码“祝福”您的页面具有 chrome 权限[（](http://mxr.mozilla.org/mozilla-central/source/docshell/base/nsAboutRedirector.cpp#91)请注意，它与您需要的相反 - 剥夺 chrome 权限）。

# sharepoint - 您可以在 Intranet 上使用 SharePoint 做什么？

> ID：127696
> 
> 赞同：2
> 
> 时间：2008-09-24T15:00:45.473
> 
> 标签：sharepoint, integration, intranet

我们已经有我在其中工作了一段时间的 SharePoint，但我们并没有做很多工作。我们有一个包含数百个 ASP/ASP.Net 应用程序的 Intranet，我想知道可以做什么样的事情来与 SharePoint 集成以创建一个更加无缝的环境？我们现在将文档和生产移动请求等放在 SharePoint 中，但它更像是自己的独立系统，而不是我们内部网上的集成工具。

我四处寻找其他人在使用 SharePoint 做什么，但我发现了很多无用的信息。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-24T15:12:21.437

典型的 Intranet 门户按部门划分功能。每个部门都可能有一些自定义的基于 Web 的应用程序，您可能曾经在 ASP.Net 中实现过这些应用程序，并从 Intranet 门户链接到这些应用程序。使用 sharepoint，您可以开始将这些自定义 Web 应用程序的有用部分作为模块化部分引入，以便门户的业务所有者可以更好地控制信息的结构和向他/她的用户显示的方式。

想想仪表板，其中填充了仅对各个部门有意义的自定义指标。这是最明显的起点之一。人力资源、会计、IT，他们都有想要跟踪和显示的指标。他们都有遗留系统，他们可能希望从中关联信息。所有这些都可以在可重用的 Web 部件中完成。由于 Sharepoint 为最终用户提供了对布局、显示、受众控制等的控制权，因此您最终不会整天都在重新发明轮子。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-24T15:12:41.840

SharePoint 被设计成一个协作门户和文档存储库。如果您在其他内部网站中包含其他业务流程，则将这些网站转换为 SharePoint 子网站可能不会带来太多好处。

但是，如果您的应用程序（联系人列表、库存、规格等）存在显着重叠，您可能希望进行投资合并。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-24T22:41:29.063

将最常用的 asp.net 应用程序移动到在 SharePoint 站点中运行对您来说是一个好主意。每个应用程序既可以作为控件直接添加到页面布局上，也可以集成到 Web 部件中（使用 Web 部件加载子控件）。

这将允许您使用灵活的 moss 界面将 asp.net 应用程序移动到统一的信息架构中，以便人们可以轻松找到该应用程序。

SharePoint 很容易推出一些可行的东西，但是创建一个无缝的 Intranet 确实需要在 SharePoint 本身之外进行一些思考（即应该去哪里，用户需要看到什么，导航结构......）

这确实是很多工作，并且需要 IT 领域以外的人员提供大量投入。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-24T15:14:12.853

如果您有 InfoPath，则可以创建联机表单。您可以共享您的文档并在线编辑它们。您可以在这些文档上启动审批工作流程。您可以创建民意调查。您可以创建工作组。

基本上，SharePoint 是一个巨大而强大的文档存储，但您可以做任何您可以在任何 ASP.NET Web 应用程序中做的事情。您可以创建例如自定义工作流来自动化业务流程。我们已经为几个客户创建了企业内部网，有时还创建了互联网站点，所以它确实有效。:)

但有时很难实现所要求的功能（很多变通方法）。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-24T15:15:45.797

真的它是一个盒子里的内部网。我们几乎所有的日常开发任务都离不开它。我们保留文档、跟踪缺陷、管理人员休假等。您可以迁移您的 asp.net 和 asp 应用程序以在 sharepoint 站点下运行。在管理部分，您可以将 Web 应用程序设置为在同一站点下运行，但不受 sharepoint 的控制。这可能有助于它完全独立的“感觉”。

Sharepoint 确实改变了人们思考 Web 开发的方式，这是关键。您不再开发独立的应用程序，而是添加到现有框架。我会说它类似于拥有“数据孤岛”与包含公司所有数据的集中式数据库系统。一旦人们意识到一切都是相互联系的，就会感觉更像是一种无缝的整合。我的建议是积极尝试在 sharepoint 中创建应用程序，并考虑如何将现有应用程序迁移到它上面。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2012-06-23T14:28:52.117

来自 ERP 的 BI 和报告如何？当我们知道 IE 无法处理具有 10000 个表格行的页面（没有分页）时，许多人没有意识到，但报告工具的成功取决于所使用的网格对象的性能 - Excel 和来自已失效 Office Web 的 SpreadSheet obj组件仍然是用户（会计师、经理、首席执行官）选择的第一名。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-24T15:05:15.633

我认为这取决于您的环境。在我们的环境中，我们为每个部门设置了自己的页面，并将其用于基本信息、调查和员工主页。我们使用 Tim Huer 的 RSS 控件构建了 Google/Live Search 和 Weather.com 小部件并滚动 RSS 提要。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-24T20:55:59.973

您可以做的一件事是创建 Web 部件以提供对现有应用程序数据的访问。最初它们可能只是只读视图，但根据您的经验，它们可以被充实以允许写入。

另一个想法是在 SharePoint 和您的应用程序之间添加链接（假设它们是基于 Web 的）；这至少会允许它们之间的流动。

我还没有这样做，但理论上您也可以对 SharePoint 进行外观设计，使其看起来像您的 Intranet 的其余部分。

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2010-08-17T05:19:19.283

创建库

表单库、文档库、幻灯片库

创建标准或自定义列表

标准列表 - 公告、任务、联系人

自定义列表 - 供应商、承包商、库存、订单

设置安全的团队讨论区

建立共享团队日历

在文档和列表上创建简单的工作流程

# algorithm - 从 n 返回 k 个元素的所有组合的算法

> ID：127704
> 
> 赞同：623
> 
> 时间：2008-09-24T15:02:24.957
> 
> 标签：algorithm, combinations

我想编写一个函数，它将一组字母作为参数，并选择其中的一些字母。

假设您提供了一个包含 8 个字母的数组，并希望从中选择 3 个字母。那么你应该得到：

```
8! / ((8 - 3)! * 3!) = 56 
```

数组（或单词）作为回报，每个包含 3 个字母。

* * *

## 回答 #1

> 赞同：445
> 
> 时间：2008-09-24T15:24:50.300

[计算机编程艺术第 4 卷：分册 3](http://portal.acm.org/citation.cfm?id=1036677&dl=&coll=)有很多这些内容可能比我描述的更适合您的特定情况。

## 格雷码

您将遇到的一个问题当然是内存，而且很快，您的集合中的 20 个元素就会出现问题 - ^(20) C [3] = 1140。如果您想遍历集合，最好使用修改后的灰色代码算法，因此您不会将所有这些都保存在内存中。这些从前一个组合生成下一个组合并避免重复。其中有许多用于不同的用途。我们想最大化连续组合之间的差异吗？最小化？等等。

一些描述格雷码的原始论文：

1.  [一些汉密尔顿路径和最小变化算法](http://portal.acm.org/citation.cfm?id=2422.322413)
2.  [相邻立交组合生成算法](http://portal.acm.org/citation.cfm?id=49203&jmp=indexterms&coll=GUIDE&dl=GUIDE&CFID=81503149&CFTOKEN=96444237)

以下是一些涵盖该主题的其他论文：

1.  [Eades, Hickey, Read Adjacent Interchange Combination Generation Algorithm 的有效实现](http://www.cs.uvic.ca/%7Eruskey/Publications/EHR/HoughRuskey.pdf)（PDF，Pascal 代码）
2.  [组合生成器](http://portal.acm.org/citation.cfm?doid=355826.355830)
3.  [组合格雷码调查](http://www4.ncsu.edu/%7Esavage/AVAILABLE_FOR_MAILING/survey.ps)(PostScript)
4.  [格雷码算法](https://link.springer.com/content/pdf/10.1007/BF02248780.pdf)

## Chase's Twiddle (算法)

Phillip J Chase，“[算法 382：N 个对象中 M 个的组合](http://portal.acm.org/citation.cfm?id=362502)”（1970 年）

[C中的算法](http://www.netlib.no/netlib/toms/382)...

## 按字典顺序排列的组合索引（Buckles 算法 515）

您还可以通过索引（按字典顺序）引用组合。意识到索引应该是基于索引从右到左的一些变化，我们可以构造一些应该恢复组合的东西。

所以，我们有一个集合 {1,2,3,4,5,6}... 我们想要三个元素。假设 {1,2,3} 我们可以说元素之间的差异是一个且有序且最小。{1,2,4} 有一个变化，按字典顺序排列为 2。因此，最后一个位置的“变化”数说明了字典顺序的一个变化。第二位，有一个变化 {1,3,4} 有一个变化，但由于它位于第二位（与原始集合中的元素数量成正比），所以它解释了更多变化。

我描述的方法是一种解构，看起来，从集合到索引，我们需要做相反的事情——这要复杂得多。这就是[Buckles](http://portal.acm.org/citation.cfm?id=355739)解决问题的方法。我写了一些[C 来计算它们](https://stackoverflow.com/questions/561/using-combinations-of-sets-as-test-data#794)，稍作改动——我使用集合的索引而不是数字范围来表示集合，所以我们总是从 0...n 开始工作。笔记：

1.  由于组合是无序的，{1,3,2} = {1,2,3}——我们按字典顺序排列它们。
2.  此方法有一个隐含的 0 来启动第一个差异的集合。

## 按字典顺序排列的组合索引 (McCaffrey)

还有[另一种方式](https://web.archive.org/web/20170325012457/https://msdn.microsoft.com/en-us/library/aa289166.aspx)：它的概念更容易掌握和编程，但它没有 Buckles 的优化。幸运的是，它也不会产生重复的组合：

[![x_k...x_1 在 N](https://i.stack.imgur.com/Txetz.gif)](https://i.stack.imgur.com/Txetz.gif)最大化的集合[![i = C(x_1,k) + C(x_2,k-1) + ... + C(x_k,1)](https://i.stack.imgur.com/HOj5o.gif)](https://i.stack.imgur.com/HOj5o.gif)，其中[![C(n,r) = {n 选择 r}](https://i.stack.imgur.com/vIeiI.gif)](https://i.stack.imgur.com/vIeiI.gif)。

举个例子：`27 = C(6,4) + C(5,3) + C(2,2) + C(1,1)`。所以，第 27 个字典组合的四件事是：{1,2,5,6}，这些是您想要查看的任何集合的索引。下面的示例（OCaml），需要`choose`函数，留给读者：

```
(* this will find the [x] combination of a [set] list when taking [k] elements *)
let combination_maccaffery set k x =
    (* maximize function -- maximize a that is aCb              *)
    (* return largest c where c < i and choose(c,i) <= z        *)
    let rec maximize a b x =
        if (choose a b ) <= x then a else maximize (a-1) b x
    in
    let rec iterate n x i = match i with
        | 0 -> []
        | i ->
            let max = maximize n i x in
            max :: iterate n (x - (choose max i)) (i-1)
    in
    if x < 0 then failwith "errors" else
    let idxs =  iterate (List.length set) x k in
    List.map (List.nth set) (List.sort (-) idxs) 
```

## 一个小而简单的组合迭代器

出于教学目的，提供了以下两种算法。他们实现了迭代器和（更通用的）文件夹整体组合。它们尽可能快，复杂度为 O( ^n C [k] )。内存消耗受`k`.

我们将从迭代器开始，它将为每个组合调用用户提供的函数

```
let iter_combs n k f =
  let rec iter v s j =
    if j = k then f v
    else for i = s to n - 1 do iter (i::v) (i+1) (j+1) done in
  iter [] 0 0 
```

更通用的版本将调用用户提供的函数以及状态变量，从初始状态开始。由于我们需要在不同状态之间传递状态，我们不会使用 for 循环，而是使用递归，

```
let fold_combs n k f x =
  let rec loop i s c x =
    if i < n then
      loop (i+1) s c @@
      let c = i::c and s = s + 1 and i = i + 1 in
      if s < k then loop i s c x else f c x
    else x in
  loop 0 0 [] x 
```

* * *

## 回答 #2

> 赞同：206
> 
> 时间：2009-12-14T03:24:55.617

在 C# 中：

```
public static IEnumerable<IEnumerable<T>> Combinations<T>(this IEnumerable<T> elements, int k)
{
  return k == 0 ? new[] { new T[0] } :
    elements.SelectMany((e, i) =>
      elements.Skip(i + 1).Combinations(k - 1).Select(c => (new[] {e}).Concat(c)));
} 
```

用法：

```
var result = Combinations(new[] { 1, 2, 3, 4, 5 }, 3); 
```

结果：

```
123
124
125
134
135
145
234
235
245
345 
```

* * *

## 回答 #3

> 赞同：92
> 
> 时间：2013-04-27T19:36:38.657

简短的java解决方案：

```
import java.util.Arrays;

public class Combination {
    public static void main(String[] args){
        String[] arr = {"A","B","C","D","E","F"};
        combinations2(arr, 3, 0, new String[3]);
    }

    static void combinations2(String[] arr, int len, int startPosition, String[] result){
        if (len == 0){
            System.out.println(Arrays.toString(result));
            return;
        }       
        for (int i = startPosition; i <= arr.length-len; i++){
            result[result.length - len] = arr[i];
            combinations2(arr, len-1, i+1, result);
        }
    }       
} 
```

结果将是

```
[A, B, C]
[A, B, D]
[A, B, E]
[A, B, F]
[A, C, D]
[A, C, E]
[A, C, F]
[A, D, E]
[A, D, F]
[A, E, F]
[B, C, D]
[B, C, E]
[B, C, F]
[B, D, E]
[B, D, F]
[B, E, F]
[C, D, E]
[C, D, F]
[C, E, F]
[D, E, F] 
```

* * *

## 回答 #4

> 赞同：82
> 
> 时间：2010-05-14T21:15:34.873

我可以介绍我对这个问题的递归 Python 解决方案吗？

```
def choose_iter(elements, length):
    for i in xrange(len(elements)):
        if length == 1:
            yield (elements[i],)
        else:
            for next in choose_iter(elements[i+1:len(elements)], length-1):
                yield (elements[i],) + next
def choose(l, k):
    return list(choose_iter(l, k)) 
```

示例用法：

```
>>> len(list(choose_iter("abcdefgh",3)))
56 
```

我喜欢它的简单性。

* * *

## 回答 #5

> 赞同：70
> 
> 时间：2008-09-24T15:31:36.757

假设您的字母数组如下所示：“ABCDEFGH”。您有三个索引 (i, j, k) 指示您要为当前单词使用哪些字母，您可以从以下内容开始：

```
ABCDEFGH
^ ^ ^
伊克

```

首先你改变k，所以下一步看起来像这样：

```
ABCDEFGH
^ ^ ^
伊克

```

如果你到达终点，你继续改变 j ，然后再改变 k 。

```
ABCDEFGH
^ ^ ^
伊克

ABCDEFGH
^ ^ ^
伊克

```

一旦你 j 达到 G，你也开始改变 i。

```
ABCDEFGH
  ^ ^ ^
  伊克

ABCDEFGH
  ^ ^ ^
  伊克
...

```

写在代码中，看起来像这样

```
void print_combinations(const char *string)
{
    int i, j, k;
    int len = strlen(string);

    for (i = 0; i < len - 2; i++)
    {
        for (j = i + 1; j < len - 1; j++)
        {
            for (k = j + 1; k < len; k++)
                printf("%c%c%c\n", string[i], string[j], string[k]);
        }
    }
} 
```

* * *

## 回答 #6

> 赞同：57
> 
> 时间：2008-09-24T17:40:35.713

以下递归算法从有序集中挑选所有 k 元素组合：

*   `i`选择组合的第一个元素
*   与从大于 的元素集合中递归选择的元素组合`i`中的每一个组合。`k-1``i`

`i`对集合中的每个重复上述内容。

必须选择大于 的其余元素`i`，以避免重复。这样 [3,5] 将只被选择一次，因为 [3] 与 [5] 结合，而不是两次（条件消除了 [5] + [3]）。如果没有这个条件，你会得到变化而不是组合。

* * *

## 回答 #7

> 赞同：32
> 
> 时间：2013-08-01T14:27:35.970

Python中的简短示例：

```
def comb(sofar, rest, n):
    if n == 0:
        print sofar
    else:
        for i in range(len(rest)):
            comb(sofar + rest[i], rest[i+1:], n-1)

>>> comb("", "abcde", 3)
abc
abd
abe
acd
ace
ade
bcd
bce
bde
cde 
```

为了解释，递归方法用下面的例子来描述：

示例：ABCDE
3 的所有组合将是：

*   A 与其余 2 的所有组合 (BCDE)
*   B 与其余 2 的所有组合 (CDE)
*   C 与其余 2 的所有组合 (DE)

* * *

## 回答 #8

> 赞同：26
> 
> 时间：2009-10-24T11:58:21.873

在 C++ 中，以下例程将生成范围 [first,last) 之间的长度距离 (first,k) 的所有组合：

```
#include <algorithm>

template <typename Iterator>
bool next_combination(const Iterator first, Iterator k, const Iterator last)
{
   /* Credits: Mark Nelson http://marknelson.us */
   if ((first == last) || (first == k) || (last == k))
      return false;
   Iterator i1 = first;
   Iterator i2 = last;
   ++i1;
   if (last == i1)
      return false;
   i1 = last;
   --i1;
   i1 = k;
   --i2;
   while (first != i1)
   {
      if (*--i1 < *i2)
      {
         Iterator j = k;
         while (!(*i1 < *j)) ++j;
         std::iter_swap(i1,j);
         ++i1;
         ++j;
         i2 = k;
         std::rotate(i1,j,last);
         while (last != j)
         {
            ++j;
            ++i2;
         }
         std::rotate(k,i2,last);
         return true;
      }
   }
   std::rotate(first,k,last);
   return false;
} 
```

它可以这样使用：

```
#include <string>
#include <iostream>

int main()
{
    std::string s = "12345";
    std::size_t comb_size = 3;
    do
    {
        std::cout << std::string(s.begin(), s.begin() + comb_size) << std::endl;
    } while (next_combination(s.begin(), s.begin() + comb_size, s.end()));

    return 0;
} 
```

这将打印以下内容：

```
123
124
125
134
135
145
234
235
245
345 
```

* * *

## 回答 #9

> 赞同：26
> 
> 时间：2011-11-17T17:42:48.387

我发现这个线程很有用，并认为我会添加一个可以弹出到 Firebug 的 Javascript 解决方案。根据您的 JS 引擎，如果起始字符串很大，可能需要一些时间。

```
function string_recurse(active, rest) {
    if (rest.length == 0) {
        console.log(active);
    } else {
        string_recurse(active + rest.charAt(0), rest.substring(1, rest.length));
        string_recurse(active, rest.substring(1, rest.length));
    }
}
string_recurse("", "abc"); 
```

输出应如下所示：

```
abc
ab
ac
a
bc
b
c 
```

* * *

## 回答 #10

> 赞同：21
> 
> 时间：2008-09-24T15:37:26.807

```
static IEnumerable<string> Combinations(List<string> characters, int length)
{
    for (int i = 0; i < characters.Count; i++)
    {
        // only want 1 character, just return this one
        if (length == 1)
            yield return characters[i];

        // want more than one character, return this one plus all combinations one shorter
        // only use characters after the current one for the rest of the combinations
        else
            foreach (string next in Combinations(characters.GetRange(i + 1, characters.Count - (i + 1)), length - 1))
                yield return characters[i] + next;
    }
} 
```

* * *

## 回答 #11

> 赞同：20
> 
> 时间：2011-12-24T17:49:38.670

Haskell中的简单递归算法

```
import Data.List

combinations 0 lst = [[]]
combinations n lst = do
    (x:xs) <- tails lst
    rest   <- combinations (n-1) xs
    return $ x : rest 
```

我们首先定义特殊情况，即选择零元素。它产生一个结果，即一个空列表（即包含一个空列表的列表）。

对于 n > 0，`x`遍历列表的每个元素并且`xs`是 之后的每个元素`x`。

`rest`使用对 的递归调用来挑选`n - 1`元素。该函数的最终结果是一个列表，其中每个元素都是（即具有作为头部和作为尾部的列表）对于每个不同的值和。`xs``combinations``x : rest``x``rest``x``rest`

```
> combinations 3 "abcde"
["abc","abd","abe","acd","ace","ade","bcd","bce","bde","cde"] 
```

当然，由于 Haskell 是惰性的，列表会根据需要逐渐生成，因此您可以部分评估指数级大组合。

```
> let c = combinations 8 "abcdefghijklmnopqrstuvwxyz"
> take 10 c
["abcdefgh","abcdefgi","abcdefgj","abcdefgk","abcdefgl","abcdefgm","abcdefgn",
 "abcdefgo","abcdefgp","abcdefgq"] 
```

* * *

## 回答 #12

> 赞同：14
> 
> 时间：2012-11-21T09:47:28.207

COBOL 出现了，这是一种备受诟病的语言。

让我们假设一个包含 34 个元素的数组，每个元素 8 个字节（纯粹是任意选择）。这个想法是枚举所有可能的 4 元素组合并将它们加载到一个数组中。

我们使用 4 个索引，每个索引对应 4 个组中的每个位置

数组的处理方式如下：

```
 idx1 = 1
    idx2 = 2
    idx3 = 3
    idx4 = 4 
```

我们将 idx4 从 4 变化到末尾。对于每个 idx4，我们得到一个独特的四组组合。当 idx4 到达数组末尾时，我们将 idx3 加 1 并将 idx4 设置为 idx3+1。然后我们再次运行 idx4 到最后。我们以这种方式继续，分别增加 idx3、idx2 和 idx1，直到 idx1 的位置距离数组末尾小于 4。这样就完成了算法。

```
1          --- pos.1
2          --- pos 2
3          --- pos 3
4          --- pos 4
5
6
7
etc. 
```

第一次迭代：

```
1234
1235
1236
1237
1245
1246
1247
1256
1257
1267
etc. 
```

COBOL 示例：

```
01  DATA_ARAY.
    05  FILLER     PIC X(8)    VALUE  "VALUE_01".
    05  FILLER     PIC X(8)    VALUE  "VALUE_02".
  etc.
01  ARAY_DATA    OCCURS 34.
    05  ARAY_ITEM       PIC X(8).

01  OUTPUT_ARAY   OCCURS  50000   PIC X(32).

01   MAX_NUM   PIC 99 COMP VALUE 34.

01  INDEXXES  COMP.
    05  IDX1            PIC 99.
    05  IDX2            PIC 99.
    05  IDX3            PIC 99.
    05  IDX4            PIC 99.
    05  OUT_IDX   PIC 9(9).

01  WHERE_TO_STOP_SEARCH          PIC 99  COMP. 
```

* * *

```
* Stop the search when IDX1 is on the third last array element:

COMPUTE WHERE_TO_STOP_SEARCH = MAX_VALUE - 3     

MOVE 1 TO IDX1

PERFORM UNTIL IDX1 > WHERE_TO_STOP_SEARCH
   COMPUTE IDX2 = IDX1 + 1
   PERFORM UNTIL IDX2 > MAX_NUM
      COMPUTE IDX3 = IDX2 + 1
      PERFORM UNTIL IDX3 > MAX_NUM
         COMPUTE IDX4 = IDX3 + 1
         PERFORM UNTIL IDX4 > MAX_NUM
            ADD 1 TO OUT_IDX
            STRING  ARAY_ITEM(IDX1)
                    ARAY_ITEM(IDX2)
                    ARAY_ITEM(IDX3)
                    ARAY_ITEM(IDX4)
                    INTO OUTPUT_ARAY(OUT_IDX)
            ADD 1 TO IDX4
         END-PERFORM
         ADD 1 TO IDX3
      END-PERFORM
      ADD 1 TO IDX2
   END_PERFORM
   ADD 1 TO IDX1
END-PERFORM. 
```

* * *

## 回答 #13

> 赞同：10
> 
> 时间：2015-05-13T21:20:38.380

另一个具有延迟生成组合索引的 C# 版本。这个版本维护一个索引数组来定义所有值列表和当前组合值之间的映射，即在整个运行时不断使用*O(k)额外空间。**该代码在O(k)*时间内生成单独的组合，包括第一个组合。

```
public static IEnumerable<T[]> Combinations<T>(this T[] values, int k)
{
    if (k < 0 || values.Length < k)
        yield break; // invalid parameters, no combinations possible

    // generate the initial combination indices
    var combIndices = new int[k];
    for (var i = 0; i < k; i++)
    {
        combIndices[i] = i;
    }

    while (true)
    {
        // return next combination
        var combination = new T[k];
        for (var i = 0; i < k; i++)
        {
            combination[i] = values[combIndices[i]];
        }
        yield return combination;

        // find first index to update
        var indexToUpdate = k - 1;
        while (indexToUpdate >= 0 && combIndices[indexToUpdate] >= values.Length - k + indexToUpdate)
        {
            indexToUpdate--;
        }

        if (indexToUpdate < 0)
            yield break; // done

        // update combination indices
        for (var combIndex = combIndices[indexToUpdate] + 1; indexToUpdate < k; indexToUpdate++, combIndex++)
        {
            combIndices[indexToUpdate] = combIndex;
        }
    }
} 
```

测试代码：

```
foreach (var combination in new[] {'a', 'b', 'c', 'd', 'e'}.Combinations(3))
{
    System.Console.WriteLine(String.Join(" ", combination));
} 
```

输出：

```
a b c
a b d
a b e
a c d
a c e
a d e
b c d
b c e
b d e
c d e 
```

* * *

## 回答 #14

> 赞同：9
> 
> 时间：2008-09-24T16:59:58.683

如果您可以使用 SQL 语法 - 例如，如果您使用 LINQ 访问结构或数组的字段，或者直接访问具有名为“Alphabet”的表且只有一个字符字段“Letter”的数据库，则可以调整以下内容代码：

```
SELECT A.Letter, B.Letter, C.Letter
FROM Alphabet AS A, Alphabet AS B, Alphabet AS C
WHERE A.Letter<>B.Letter AND A.Letter<>C.Letter AND B.Letter<>C.Letter
AND A.Letter<B.Letter AND B.Letter<C.Letter 
```

这将返回 3 个字母的所有组合，无论您在表“Alphabet”中有多少个字母（可以是 3、8、10、27 等）。

如果您想要的是所有排列，而不是组合（即您希望“ACB”和“ABC”算作不同，而不是只出现一次），只需删除最后一行（AND 行）就可以了。

后期编辑：重新阅读问题后，我意识到需要的是*通用*算法，而不仅仅是选择3个项目的特定算法。亚当休斯的回答是完整的，不幸的是我不能投票（还）。这个答案很简单，但仅适用于您想要 3 个项目的情况。

* * *

## 回答 #15

> 赞同：9
> 
> 时间：2010-04-08T19:30:36.460

这是 Scala 中一个优雅的通用实现，如[99 Scala Problems](http://aperiodic.net/phil/scala/s-99/)中所述。

```
object P26 {
  def flatMapSublists[A,B](ls: List[A])(f: (List[A]) => List[B]): List[B] = 
    ls match {
      case Nil => Nil
      case sublist@(_ :: tail) => f(sublist) ::: flatMapSublists(tail)(f)
    }

  def combinations[A](n: Int, ls: List[A]): List[List[A]] =
    if (n == 0) List(Nil)
    else flatMapSublists(ls) { sl =>
      combinations(n - 1, sl.tail) map {sl.head :: _}
    }
} 
```

* * *

## 回答 #16

> 赞同：8
> 
> 时间：2008-09-25T07:13:00.783

我有一个用于项目 euler 的置换算法，在 python 中：

```
def missing(miss,src):
    "Returns the list of items in src not present in miss"
    return [i for i in src if i not in miss]

def permutation_gen(n,l):
    "Generates all the permutations of n items of the l list"
    for i in l:
        if n<=1: yield [i]
        r = [i]
        for j in permutation_gen(n-1,missing([i],l)):  yield r+j 
```

如果

```
n<len(l) 
```

你应该有你需要的所有组合而不重复，你需要吗？

它是一个生成器，所以你可以像这样使用它：

```
for comb in permutation_gen(3,list("ABCDEFGH")):
    print comb 
```

* * *

## 回答 #17

> 赞同：7
> 
> 时间：2012-07-15T21:05:57.150

[https://gist.github.com/3118596](https://gist.github.com/3118596)

JavaScript 有一个实现。它具有获取 k 组合和任何对象数组的所有组合的功能。例子：

```
k_combinations([1,2,3], 2)
-> [[1,2], [1,3], [2,3]]

combinations([1,2,3])
-> [[1],[2],[3],[1,2],[1,3],[2,3],[1,2,3]] 
```

* * *

## 回答 #18

> 赞同：6
> 
> 时间：2010-12-26T18:43:05.860

在这里，您有一个用 C# 编码的算法的惰性评估版本：

```
 static bool nextCombination(int[] num, int n, int k)
    {
        bool finished, changed;

        changed = finished = false;

        if (k > 0)
        {
            for (int i = k - 1; !finished && !changed; i--)
            {
                if (num[i] < (n - 1) - (k - 1) + i)
                {
                    num[i]++;
                    if (i < k - 1)
                    {
                        for (int j = i + 1; j < k; j++)
                        {
                            num[j] = num[j - 1] + 1;
                        }
                    }
                    changed = true;
                }
                finished = (i == 0);
            }
        }

        return changed;
    }

    static IEnumerable Combinations<T>(IEnumerable<T> elements, int k)
    {
        T[] elem = elements.ToArray();
        int size = elem.Length;

        if (k <= size)
        {
            int[] numbers = new int[k];
            for (int i = 0; i < k; i++)
            {
                numbers[i] = i;
            }

            do
            {
                yield return numbers.Select(n => elem[n]);
            }
            while (nextCombination(numbers, size, k));
        }
    } 
```

和测试部分：

```
 static void Main(string[] args)
    {
        int k = 3;
        var t = new[] { "dog", "cat", "mouse", "zebra"};

        foreach (IEnumerable<string> i in Combinations(t, k))
        {
            Console.WriteLine(string.Join(",", i));
        }
    } 
```

希望这对你有帮助！

* * *

## 回答 #19

> 赞同：6
> 
> 时间：2017-05-18T00:04:21.193

假设您的字母数组如下所示：“ABCDEFGH”。您有三个索引 (i, j, k) 指示您要为当前单词使用哪些字母，您可以从以下内容开始：

```
ABCDEFGH
^ ^ ^
伊克

```

首先你改变k，所以下一步看起来像这样：

```
ABCDEFGH
^ ^ ^
伊克

```

如果你到达终点，你继续改变 j ，然后再改变 k 。

```
ABCDEFGH
^ ^ ^
伊克

ABCDEFGH
^ ^ ^
伊克

```

一旦你 j 达到 G，你也开始改变 i。

```
ABCDEFGH
  ^ ^ ^
  伊克

ABCDEFGH
  ^ ^ ^
  伊克
...

```

```
function initializePointers($cnt) {
    $pointers = [];

    for($i=0; $i<$cnt; $i++) {
        $pointers[] = $i;
    }

    return $pointers;     
}

function incrementPointers(&$pointers, &$arrLength) {
    for($i=0; $i<count($pointers); $i++) {
        $currentPointerIndex = count($pointers) - $i - 1;
        $currentPointer = $pointers[$currentPointerIndex];

        if($currentPointer < $arrLength - $i - 1) {
           ++$pointers[$currentPointerIndex];

           for($j=1; ($currentPointerIndex+$j)<count($pointers); $j++) {
                $pointers[$currentPointerIndex+$j] = $pointers[$currentPointerIndex]+$j;
           }

           return true;
        }
    }

    return false;
}

function getDataByPointers(&$arr, &$pointers) {
    $data = [];

    for($i=0; $i<count($pointers); $i++) {
        $data[] = $arr[$pointers[$i]];
    }

    return $data;
}

function getCombinations($arr, $cnt)
{
    $len = count($arr);
    $result = [];
    $pointers = initializePointers($cnt);

    do {
        $result[] = getDataByPointers($arr, $pointers);
    } while(incrementPointers($pointers, count($arr)));

    return $result;
}

$result = getCombinations([0, 1, 2, 3, 4, 5], 3);
print_r($result); 
```

基于[https://stackoverflow.com/a/127898/2628125](https://stackoverflow.com/a/127898/2628125)，但更抽象，适用于任何大小的指针。

* * *

## 回答 #20

> 赞同：5
> 
> 时间：2012-05-21T18:53:51.963

```
Array.prototype.combs = function(num) {

    var str = this,
        length = str.length,
        of = Math.pow(2, length) - 1,
        out, combinations = [];

    while(of) {

        out = [];

        for(var i = 0, y; i < length; i++) {

            y = (1 << i);

            if(y & of && (y !== of))
                out.push(str[i]);

        }

        if (out.length >= num) {
           combinations.push(out);
        }

        of--;
    }

    return combinations;
} 
```

* * *

## 回答 #21

> 赞同：5
> 
> 时间：2014-01-04T03:56:13.673

Clojure 版本：

```
(defn comb [k l]
  (if (= 1 k) (map vector l)
      (apply concat
             (map-indexed
              #(map (fn [x] (conj x %2))
                    (comb (dec k) (drop (inc %1) l)))
              l)))) 
```

* * *

## 回答 #22

> 赞同：4
> 
> 时间：2011-12-13T20:20:33.953

这是一种从随机长度字符串中为您提供指定大小的所有组合的方法。类似于 quinmars 的解决方案，但适用于不同的输入和 k。

可以将代码更改为环绕，即输入'abcd' wk=3 中的'dab'。

```
public void run(String data, int howMany){
    choose(data, howMany, new StringBuffer(), 0);
}

//n choose k
private void choose(String data, int k, StringBuffer result, int startIndex){
    if (result.length()==k){
        System.out.println(result.toString());
        return;
    }

    for (int i=startIndex; i<data.length(); i++){
        result.append(data.charAt(i));
        choose(data,k,result, i+1);
        result.setLength(result.length()-1);
    }
} 
```

“abcde”的输出：

> abc abd abe acd ace ade bcd bce bde cde

* * *

## 回答 #23

> 赞同：4
> 
> 时间：2014-03-03T13:52:52.970

这里所说的和所做的都是 O'caml 代码。从代码中可以看出算法..

```
let combi n lst =
    let rec comb l c =
        if( List.length c = n) then [c] else
        match l with
        [] -> []
        | (h::t) -> (combi t (h::c))@(combi t c)
    in
        combi lst []
;; 
```

* * *

## 回答 #24

> 赞同：4
> 
> 时间：2017-02-12T17:38:54.173

算法：

*   从 1 数到 2^n。
*   将每个数字转换为其二进制表示。
*   根据位置将每个“开启”位转换为集合的元素。

在 C# 中：

```
void Main()
{
    var set = new [] {"A", "B", "C", "D" }; //, "E", "F", "G", "H", "I", "J" };

    var kElement = 2;

    for(var i = 1; i < Math.Pow(2, set.Length); i++) {
        var result = Convert.ToString(i, 2).PadLeft(set.Length, '0');
        var cnt = Regex.Matches(Regex.Escape(result),  "1").Count; 
        if (cnt == kElement) {
            for(int j = 0; j < set.Length; j++)
                if ( Char.GetNumericValue(result[j]) == 1)
                    Console.Write(set[j]);
            Console.WriteLine();
        }
    }
} 
```

为什么它有效？

在 n 元素集合的子集和 n 位序列之间存在双射。

这意味着我们可以通过计算序列来计算出有多少子集。

例如，下面的四个元素集合可以用{0,1} X {0, 1} X {0, 1} X {0, 1}（或2^4）个不同的序列来表示。

所以 -**我们所要做的就是从 1 数到 2^n 来找到所有的组合。**（我们忽略空集。）接下来，将数字转换为它们的二进制表示。然后将您的集合中的元素替换为“on”位。

如果您只需要 k 个元素结果，则仅在 k 位为“on”时打印。

（如果您想要所有子集而不是 k 个长度的子集，请删除 cnt/kElement 部分。）

（有关证明，请参阅 MIT 免费课件计算机科学数学，Lehman 等人，第 11.2.2 节[。https: //ocw.mit.edu/courses/electrical-engineering-and-computer-science/6-042j-mathematics- for-computer-science-fall-2010/readings/](https://ocw.mit.edu/courses/electrical-engineering-and-computer-science/6-042j-mathematics-for-computer-science-fall-2010/readings/) )

* * *

## 回答 #25

> 赞同：3
> 
> 时间：2008-09-25T07:00:54.120

这是我在 C++ 中的提议

我试图对迭代器类型施加尽可能少的限制，所以这个解决方案假设只是前向迭代器，它可以是一个 const_iterator。这应该适用于任何标准容器。在参数没有意义的情况下，它会抛出 std::invalid_argumnent

```
#include <vector>
#include <stdexcept>

template <typename Fci> // Fci - forward const iterator
std::vector<std::vector<Fci> >
enumerate_combinations(Fci begin, Fci end, unsigned int combination_size)
{
    if(begin == end && combination_size > 0u)
        throw std::invalid_argument("empty set and positive combination size!");
    std::vector<std::vector<Fci> > result; // empty set of combinations
    if(combination_size == 0u) return result; // there is exactly one combination of
                                              // size 0 - emty set
    std::vector<Fci> current_combination;
    current_combination.reserve(combination_size + 1u); // I reserve one aditional slot
                                                        // in my vector to store
                                                        // the end sentinel there.
                                                        // The code is cleaner thanks to that
    for(unsigned int i = 0u; i < combination_size && begin != end; ++i, ++begin)
    {
        current_combination.push_back(begin); // Construction of the first combination
    }
    // Since I assume the itarators support only incrementing, I have to iterate over
    // the set to get its size, which is expensive. Here I had to itrate anyway to  
    // produce the first cobination, so I use the loop to also check the size.
    if(current_combination.size() < combination_size)
        throw std::invalid_argument("combination size > set size!");
    result.push_back(current_combination); // Store the first combination in the results set
    current_combination.push_back(end); // Here I add mentioned earlier sentinel to
                                        // simplyfy rest of the code. If I did it 
                                        // earlier, previous statement would get ugly.
    while(true)
    {
        unsigned int i = combination_size;
        Fci tmp;                            // Thanks to the sentinel I can find first
        do                                  // iterator to change, simply by scaning
        {                                   // from right to left and looking for the
            tmp = current_combination[--i]; // first "bubble". The fact, that it's 
            ++tmp;                          // a forward iterator makes it ugly but I
        }                                   // can't help it.
        while(i > 0u && tmp == current_combination[i + 1u]);

        // Here is probably my most obfuscated expression.
        // Loop above looks for a "bubble". If there is no "bubble", that means, that
        // current_combination is the last combination, Expression in the if statement
        // below evaluates to true and the function exits returning result.
        // If the "bubble" is found however, the ststement below has a sideeffect of 
        // incrementing the first iterator to the left of the "bubble".
        if(++current_combination[i] == current_combination[i + 1u])
            return result;
        // Rest of the code sets posiotons of the rest of the iterstors
        // (if there are any), that are to the right of the incremented one,
        // to form next combination

        while(++i < combination_size)
        {
            current_combination[i] = current_combination[i - 1u];
            ++current_combination[i];
        }
        // Below is the ugly side of using the sentinel. Well it had to haave some 
        // disadvantage. Try without it.
        result.push_back(std::vector<Fci>(current_combination.begin(),
                                          current_combination.end() - 1));
    }
} 
```

* * *

## 回答 #26

> 赞同：3
> 
> 时间：2009-06-30T14:48:02.657

我为此在 SQL Server 2005 中创建了一个解决方案，并将其发布在我的网站上：http: [//www.jessemclain.com/downloads/code/sql/fn_GetMChooseNCombos.sql.htm](http://www.jessemclain.com/downloads/code/sql/fn_GetMChooseNCombos.sql.htm)

这是一个显示用法的示例：

```
SELECT * FROM dbo.fn_GetMChooseNCombos('ABCD', 2, '') 
```

结果：

```
Word
----
AB
AC
AD
BC
BD
CD

(6 row(s) affected) 
```

* * *

## 回答 #27

> 赞同：3
> 
> 时间：2010-03-13T13:10:35.313

这是我最近用 Java 编写的代码，它计算并返回“outOf”元素中“num”元素的所有组合。

```
// author: Sourabh Bhat (heySourabh@gmail.com)

public class Testing
{
    public static void main(String[] args)
    {

// Test case num = 5, outOf = 8.

        int num = 5;
        int outOf = 8;
        int[][] combinations = getCombinations(num, outOf);
        for (int i = 0; i < combinations.length; i++)
        {
            for (int j = 0; j < combinations[i].length; j++)
            {
                System.out.print(combinations[i][j] + " ");
            }
            System.out.println();
        }
    }

    private static int[][] getCombinations(int num, int outOf)
    {
        int possibilities = get_nCr(outOf, num);
        int[][] combinations = new int[possibilities][num];
        int arrayPointer = 0;

        int[] counter = new int[num];

        for (int i = 0; i < num; i++)
        {
            counter[i] = i;
        }
        breakLoop: while (true)
        {
            // Initializing part
            for (int i = 1; i < num; i++)
            {
                if (counter[i] >= outOf - (num - 1 - i))
                    counter[i] = counter[i - 1] + 1;
            }

            // Testing part
            for (int i = 0; i < num; i++)
            {
                if (counter[i] < outOf)
                {
                    continue;
                } else
                {
                    break breakLoop;
                }
            }

            // Innermost part
            combinations[arrayPointer] = counter.clone();
            arrayPointer++;

            // Incrementing part
            counter[num - 1]++;
            for (int i = num - 1; i >= 1; i--)
            {
                if (counter[i] >= outOf - (num - 1 - i))
                    counter[i - 1]++;
            }
        }

        return combinations;
    }

    private static int get_nCr(int n, int r)
    {
        if(r > n)
        {
            throw new ArithmeticException("r is greater then n");
        }
        long numerator = 1;
        long denominator = 1;
        for (int i = n; i >= r + 1; i--)
        {
            numerator *= i;
        }
        for (int i = 2; i <= n - r; i++)
        {
            denominator *= i;
        }

        return (int) (numerator / denominator);
    }
} 
```

* * *

## 回答 #28

> 赞同：3
> 
> 时间：2014-09-26T12:52:15.157

一个简洁的 Javascript 解决方案：

```
Array.prototype.combine=function combine(k){    
    var toCombine=this;
    var last;
    function combi(n,comb){             
        var combs=[];
        for ( var x=0,y=comb.length;x<y;x++){
            for ( var l=0,m=toCombine.length;l<m;l++){      
                combs.push(comb[x]+toCombine[l]);           
            }
        }
        if (n<k-1){
            n++;
            combi(n,combs);
        } else{last=combs;}
    }
    combi(1,toCombine);
    return last;
}
// Example:
// var toCombine=['a','b','c'];
// var results=toCombine.combine(4); 
```

* * *

## 回答 #29

> 赞同：3
> 
> 时间：2015-04-18T10:21:56.683

简短的python代码，产生索引位置

```
def yield_combos(n,k):
    # n is set size, k is combo size

    i = 0
    a = [0]*k

    while i > -1:
        for j in range(i+1, k):
            a[j] = a[j-1]+1
        i=j
        yield a
        while a[i] == i + n - k:
            i -= 1
        a[i] += 1 
```

* * *

## 回答 #30

> 赞同：3
> 
> 时间：2020-09-06T06:47:11.117

简短的 javascript 版本 (ES 5)

```
let combine = (list, n) =>
  n == 0 ?
    [[]] :
    list.flatMap((e, i) =>
      combine(
        list.slice(i + 1),
        n - 1
      ).map(c => [e].concat(c))
    );

let res = combine([1,2,3,4], 3);
res.forEach(e => console.log(e.join()));
```

* * *

## 回答 #31

> 赞同：2
> 
> 时间：2012-09-25T07:49:04.030

我编写了一个类来处理处理二项式系数的常用函数，这是您的问题所属的问题类型。它执行以下任务：

1.  将任何 N 选择 K 的所有 K 索引以良好的格式输出到文件。K-indexes 可以替换为更具描述性的字符串或字母。这种方法使得解决这类问题变得非常简单。

2.  将 K 索引转换为已排序二项式系数表中条目的正确索引。这种技术比依赖迭代的旧已发布技术快得多。它通过使用帕斯卡三角形固有的数学属性来做到这一点。我的论文谈到了这一点。我相信我是第一个发现并发表这种技术的人，但我可能是错的。

3.  将已排序二项式系数表中的索引转换为相应的 K 索引。

4.  使用[Mark Dominus](http://blog.plover.com/math/choose.html)方法计算二项式系数，它不太可能溢出并且适用于更大的数字。

5.  该类是用 .NET C# 编写的，并提供了一种通过使用通用列表来管理与问题相关的对象（如果有）的方法。此类的构造函数采用一个名为 InitTable 的 bool 值，当它为 true 时，将创建一个通用列表来保存要管理的对象。如果此值为 false，则不会创建表。无需创建表即可执行上述 4 种方法。提供了访问器方法来访问表。

6.  有一个关联的测试类，它显示了如何使用该类及其方法。它已经用 2 个案例进行了广泛的测试，并且没有已知的错误。

要了解此类并下载代码，请参阅[制表二项式系数](http://tablizingthebinomialcoeff.wordpress.com/)。

将此类转换为 C++ 应该不难。

* * *

## 回答 #32

> 赞同：2
> 
> 时间：2015-02-03T09:20:41.570

基于java解决方案的短php算法从n（二项式系数）返回k元素的所有组合：

```
$array = array(1,2,3,4,5);

$array_result = NULL;

$array_general = NULL;

function combinations($array, $len, $start_position, $result_array, $result_len, &$general_array)
{
    if($len == 0)
    {
        $general_array[] = $result_array;
        return;
    }

    for ($i = $start_position; $i <= count($array) - $len; $i++)
    {
        $result_array[$result_len - $len] = $array[$i];
        combinations($array, $len-1, $i+1, $result_array, $result_len, $general_array);
    }
} 

combinations($array, 3, 0, $array_result, 3, $array_general);

echo "<pre>";
print_r($array_general);
echo "</pre>"; 
```

相同的解决方案，但在 javascript 中：

```
var newArray = [1, 2, 3, 4, 5];
var arrayResult = [];
var arrayGeneral = [];

function combinations(newArray, len, startPosition, resultArray, resultLen, arrayGeneral) {
    if(len === 0) {
        var tempArray = [];
        resultArray.forEach(value => tempArray.push(value));
        arrayGeneral.push(tempArray);
        return;
    }
    for (var i = startPosition; i <= newArray.length - len; i++) {
        resultArray[resultLen - len] = newArray[i];
        combinations(newArray, len-1, i+1, resultArray, resultLen, arrayGeneral);
    }
} 

combinations(newArray, 3, 0, arrayResult, 3, arrayGeneral);

console.log(arrayGeneral); 
```

* * *

## 回答 #33

> 赞同：2
> 
> 时间：2015-05-16T17:44:19.743

这是我的 JavaScript 解决方案，通过使用 reduce/map 功能更强大，它消除了几乎所有变量

```
function combinations(arr, size) {
  var len = arr.length;

  if (size > len) return [];
  if (!size) return [[]];
  if (size == len) return [arr];

  return arr.reduce(function (acc, val, i) {
    var res = combinations(arr.slice(i + 1), size - 1)
      .map(function (comb) { return [val].concat(comb); });

    return acc.concat(res);
  }, []);
}

var combs = combinations([1,2,3,4,5,6,7,8],3);
combs.map(function (comb) {
  document.body.innerHTML += comb.toString() + '<br />';
});

document.body.innerHTML += '<br /> Total combinations = ' + combs.length;
```

* * *

## 回答 #34

> 赞同：2
> 
> 时间：2015-12-26T15:14:58.273

[The Art of Computer Programming, Volume 4A: Combinatorial Algorithms, Part 1](https://rads.stackoverflow.com/amzn/click/com/0201038048) 第 7.2.1.3 节中算法 L（字典组合）的 C 代码：

```
#include <stdio.h>
#include <stdlib.h>

void visit(int* c, int t) 
{
  // for (int j = 1; j <= t; j++)
  for (int j = t; j > 0; j--)
    printf("%d ", c[j]);
  printf("\n");
}

int* initialize(int n, int t) 
{
  // c[0] not used
  int *c = (int*) malloc((t + 3) * sizeof(int));

  for (int j = 1; j <= t; j++)
    c[j] = j - 1;
  c[t+1] = n;
  c[t+2] = 0;
  return c;
}

void comb(int n, int t) 
{
  int *c = initialize(n, t);
  int j;

  for (;;) {
    visit(c, t);
    j = 1;
    while (c[j]+1 == c[j+1]) {
      c[j] = j - 1;
      ++j;
    }
    if (j > t) 
      return;
    ++c[j];
  }
  free(c);
}

int main(int argc, char *argv[])
{
  comb(5, 3);
  return 0;
} 
```

* * *

## 回答 #35

> 赞同：2
> 
> 时间：2016-01-04T09:48:47.987

赶上潮流，并发布另一个解决方案。这是一个通用的 Java 实现。输入：`(int k)`是要选择的元素数量，是可供选择`(List<T> list)`的列表。返回组合列表`(List<List<T>>)`。

```
public static <T> List<List<T>> getCombinations(int k, List<T> list) {
    List<List<T>> combinations = new ArrayList<List<T>>();
    if (k == 0) {
        combinations.add(new ArrayList<T>());
        return combinations;
    }
    for (int i = 0; i < list.size(); i++) {
        T element = list.get(i);
        List<T> rest = getSublist(list, i+1);
        for (List<T> previous : getCombinations(k-1, rest)) {
            previous.add(element);
            combinations.add(previous);
        }
    }
    return combinations;
}

public static <T> List<T> getSublist(List<T> list, int i) {
    List<T> sublist = new ArrayList<T>();
    for (int j = i; j < list.size(); j++) {
        sublist.add(list.get(j));
    }
    return sublist;
} 
```

* * *

## 回答 #36

> 赞同：2
> 
> 时间：2019-05-30T16:06:56.027

JavaScript，基于生成器的递归方法：

```
function *nCk(n,k){
  for(var i=n-1;i>=k-1;--i)
    if(k===1)
      yield [i];
    else
      for(var temp of nCk(i,k-1)){
        temp.unshift(i);
        yield temp;
      }
}

function test(){
  try{
    var n=parseInt(ninp.value);
    var k=parseInt(kinp.value);
    log.innerText="";
    var stop=Date.now()+1000;
    if(k>=1)
      for(var res of nCk(n,k))
        if(Date.now()<stop)
          log.innerText+=JSON.stringify(res)+" ";
        else{
          log.innerText+="1 second passed, stopping here.";
          break;
        }
  }catch(ex){}
}
```

```
n:<input id="ninp" oninput="test()">
&gt;= k:<input id="kinp" oninput="test()"> &gt;= 1
<div id="log"></div>
```

这种方式（递减`i`和`unshift()`）以递减的顺序产生组合和组合内的元素，有点令人赏心悦目。
测试在 1 秒后停止，因此输入奇怪的数字相对安全。

* * *

## 回答 #37

> 赞同：1
> 
> 时间：2010-04-06T09:18:17.670

这是一些打印所有 C(n,m) 组合的简单代码。它通过初始化和移动一组指向下一个有效组合的数组索引来工作。索引被初始化为指向最低的 m 个索引（按字典顺序排列的最小组合）。然后，从第 m 个索引开始，我们尝试将索引向前移动。如果索引已达到其限制，我们会尝试前一个索引（一直到索引 1）。如果我们可以向前移动一个索引，那么我们会重置所有更大的索引。

```
m=(rand()%n)+1; // m will vary from 1 to n

for (i=0;i<n;i++) a[i]=i+1;

// we want to print all possible C(n,m) combinations of selecting m objects out of n
printf("Printing C(%d,%d) possible combinations ...\n", n,m);

// This is an adhoc algo that keeps m pointers to the next valid combination
for (i=0;i<m;i++) p[i]=i; // the p[.] contain indices to the a vector whose elements constitute next combination

done=false;
while (!done)
{
    // print combination
    for (i=0;i<m;i++) printf("%2d ", a[p[i]]);
    printf("\n");

    // update combination
    // method: start with p[m-1]. try to increment it. if it is already at the end, then try moving p[m-2] ahead.
    // if this is possible, then reset p[m-1] to 1 more than (the new) p[m-2].
    // if p[m-2] can not also be moved, then try p[m-3]. move that ahead. then reset p[m-2] and p[m-1].
    // repeat all the way down to p[0]. if p[0] can not also be moved, then we have generated all combinations.
    j=m-1;
    i=1;
    move_found=false;
    while ((j>=0) && !move_found)
    {
        if (p[j]<(n-i)) 
        {
            move_found=true;
            p[j]++; // point p[j] to next index
            for (k=j+1;k<m;k++)
            {
                p[k]=p[j]+(k-j);
            }
        }
        else
        {
            j--;
            i++;
        }
    }
    if (!move_found) done=true;
} 
```

* * *

## 回答 #38

> 赞同：1
> 
> 时间：2011-07-17T15:41:04.860

Lisp 宏为所有值 r 生成代码（一次获取）

```
(defmacro txaat (some-list taken-at-a-time)
  (let* ((vars (reverse (truncate-list '(a b c d e f g h i j) taken-at-a-time))))
    `(
      ,@(loop for i below taken-at-a-time 
           for j in vars 
           with nested = nil 
           finally (return nested) 
           do
             (setf 
              nested 
              `(loop for ,j from
                    ,(if (< i (1- (length vars)))
                         `(1+ ,(nth (1+ i) vars))
                         0)
                  below (- (length ,some-list) ,i)
                    ,@(if (equal i 0) 
                          `(collect 
                               (list
                                ,@(loop for k from (1- taken-at-a-time) downto 0
                                     append `((nth ,(nth k vars) ,some-list)))))
                          `(append ,nested)))))))) 
```

所以，

```
CL-USER> (macroexpand-1 '(txaat '(a b c d) 1))
(LOOP FOR A FROM 0 TO (- (LENGTH '(A B C D)) 1)
    COLLECT (LIST (NTH A '(A B C D))))
T
CL-USER> (macroexpand-1 '(txaat '(a b c d) 2))
(LOOP FOR A FROM 0 TO (- (LENGTH '(A B C D)) 2)
      APPEND (LOOP FOR B FROM (1+ A) TO (- (LENGTH '(A B C D)) 1)
                   COLLECT (LIST (NTH A '(A B C D)) (NTH B '(A B C D)))))
T
CL-USER> (macroexpand-1 '(txaat '(a b c d) 3))
(LOOP FOR A FROM 0 TO (- (LENGTH '(A B C D)) 3)
      APPEND (LOOP FOR B FROM (1+ A) TO (- (LENGTH '(A B C D)) 2)
                   APPEND (LOOP FOR C FROM (1+ B) TO (- (LENGTH '(A B C D)) 1)
                                COLLECT (LIST (NTH A '(A B C D))
                                              (NTH B '(A B C D))
                                              (NTH C '(A B C D))))))
T

CL-USER> 
```

和，

```
CL-USER> (txaat '(a b c d) 1)
((A) (B) (C) (D))
CL-USER> (txaat '(a b c d) 2)
((A B) (A C) (A D) (B C) (B D) (C D))
CL-USER> (txaat '(a b c d) 3)
((A B C) (A B D) (A C D) (B C D))
CL-USER> (txaat '(a b c d) 4)
((A B C D))
CL-USER> (txaat '(a b c d) 5)
NIL
CL-USER> (txaat '(a b c d) 0)
NIL
CL-USER> 
```

* * *

## 回答 #39

> 赞同：1
> 
> 时间：2012-01-20T19:26:06.900

这是一个递归程序，它生成集合的组合，`nCk.Elements`假设集合是从`1`到`n`

```
#include<stdio.h>
#include<stdlib.h>

int nCk(int n,int loopno,int ini,int *a,int k)
{
    static int count=0;
    int i;
    loopno--;
    if(loopno<0)
    {
        a[k-1]=ini;
        for(i=0;i<k;i++)
        {
            printf("%d,",a[i]);
        }
        printf("\n");
        count++;
        return 0;
    }
    for(i=ini;i<=n-loopno-1;i++)
    {
        a[k-1-loopno]=i+1;
        nCk(n,loopno,i+1,a,k);
    }
    if(ini==0)
    return count;
    else
    return 0;
}

void main()
{
    int n,k,*a,count;
    printf("Enter the value of n and k\n");
    scanf("%d %d",&n,&k);
    a=(int*)malloc(k*sizeof(int));
    count=nCk(n,k,0,a,k);
    printf("No of combinations=%d\n",count);
} 
```

* * *

## 回答 #40

> 赞同：1
> 
> 时间：2012-01-24T11:41:29.623

在 VB.Net 中，该算法从一组数字（PoolArray）中收集 n 个数字的所有组合。例如，来自“8,10,20,33,41,44,47”的 5 个选项的所有组合。

```
Sub CreateAllCombinationsOfPicksFromPool(ByVal PicksArray() As UInteger, ByVal PicksIndex As UInteger, ByVal PoolArray() As UInteger, ByVal PoolIndex As UInteger)
    If PicksIndex < PicksArray.Length Then
        For i As Integer = PoolIndex To PoolArray.Length - PicksArray.Length + PicksIndex
            PicksArray(PicksIndex) = PoolArray(i)
            CreateAllCombinationsOfPicksFromPool(PicksArray, PicksIndex + 1, PoolArray, i + 1)
        Next
    Else
        ' completed combination. build your collections using PicksArray.
    End If
End Sub

        Dim PoolArray() As UInteger = Array.ConvertAll("8,10,20,33,41,44,47".Split(","), Function(u) UInteger.Parse(u))
        Dim nPicks as UInteger = 5
        Dim Picks(nPicks - 1) As UInteger
        CreateAllCombinationsOfPicksFromPool(Picks, 0, PoolArray, 0) 
```

* * *

## 回答 #41

> 赞同：1
> 
> 时间：2012-03-15T19:05:33.060

由于没有提到编程语言，我假设列表也可以。所以这里有一个适合短列表（非尾递归）的 OCaml 版本。**给定一个包含任何**类型元素的列表***l***和一个整数***n*** ，如果我们假设结果列表中元素的顺序被忽略，它将返回包含***l的******n 个***元素的所有可能列表的列表，即 list ['a'; 'b'] 与 ['b';'a'] 相同，将报告一次。所以结果列表的大小将是（（List.length l）选择n）。

 *****递归的直觉如下：取列表的头部，然后进行两次递归调用：

*   递归调用 1 (RC1)：到列表的尾部，但选择 n-1 个元素
*   递归调用 2 (RC2)：到列表的尾部，但选择 n 个元素

结合递归结果，列表乘法（请使用奇数名称）列表的头部与 RC1 的结果，然后附加 (@) RC2 的结果。列表乘法是以下操作`lmul`：

```
a lmul [ l1 ; l2 ; l3] = [a::l1 ; a::l2 ; a::l3] 
```

`lmul`在下面的代码中实现为

```
List.map (fun x -> h::x) 
```

当列表的大小等于您要选择的元素数时，递归终止，在这种情况下，您只需返回列表本身。

所以这里有一个实现上述算法的 OCaml 中的四行代码：

```
 let rec choose l n = match l, (List.length l) with                                 
    | _, lsize  when n==lsize  -> [l]                                
    | h::t, _ -> (List.map (fun x-> h::x) (choose t (n-1))) @ (choose t n)   
    | [], _ -> [] 
```

* * *

## 回答 #42

> 赞同：1
> 
> 时间：2012-07-22T19:32:43.847

```
void combine(char a[], int N, int M, int m, int start, char result[]) {
    if (0 == m) {
        for (int i = M - 1; i >= 0; i--)
            std::cout << result[i];
        std::cout << std::endl;
        return;
    }
    for (int i = start; i < (N - m + 1); i++) {
        result[m - 1] = a[i];
        combine(a, N, M, m-1, i+1, result);
    }
}

void combine(char a[], int N, int M) {
    char *result = new char[M];
    combine(a, N, M, M, 0, result);
    delete[] result;
} 
```

在第一个函数中，m 表示您还需要选择多少，start 表示您必须从数组中的哪个位置开始选择。

* * *

## 回答 #43

> 赞同：1
> 
> 时间：2013-02-11T21:17:11.633

这是一个**Clojure**版本，它使用我在**OCaml**实现答案中描述的相同算法：

```
(defn select
  ([items]
     (select items 0 (inc (count items))))
  ([items n1 n2]
     (reduce concat
             (map #(select % items)
                  (range n1 (inc n2)))))
  ([n items]
     (let [
           lmul (fn [a list-of-lists-of-bs]
                     (map #(cons a %) list-of-lists-of-bs))
           ]
       (if (= n (count items))
         (list items)
         (if (empty? items)
           items
           (concat
            (select n (rest items))
            (lmul (first items) (select (dec n) (rest items))))))))) 
```

它提供了三种调用方式：

**(a)**对于问题要求的恰好*n 个*选定项目：

```
 user=> (count (select 3 "abcdefgh"))
  56 
```

**(b)**对于*n1*和*n2*之间的选定项目：

```
user=> (select '(1 2 3 4) 2 3)
((3 4) (2 4) (2 3) (1 4) (1 3) (1 2) (2 3 4) (1 3 4) (1 2 4) (1 2 3)) 
```

**(c)**对于*0*到集合大小之间的选定项：

```
user=> (select '(1 2 3))
(() (3) (2) (1) (2 3) (1 3) (1 2) (1 2 3)) 
```

* * *

## 回答 #44

> 赞同：1
> 
> 时间：2013-07-04T15:59:57.370

这是[我的 Scala 解决方案](https://github.com/vkostyukov/scalacaster)：

```
def combinations[A](s: List[A], k: Int): List[List[A]] = 
  if (k > s.length) Nil
  else if (k == 1) s.map(List(_))
  else combinations(s.tail, k - 1).map(s.head :: _) ::: combinations(s.tail, k) 
```

* * *

## 回答 #45

> 赞同：1
> 
> 时间：2013-07-14T12:19:34.560

```
#include <stdio.h>

unsigned int next_combination(unsigned int *ar, size_t n, unsigned int k)
{
    unsigned int finished = 0;
    unsigned int changed = 0;
    unsigned int i;

    if (k > 0) {
        for (i = k - 1; !finished && !changed; i--) {
            if (ar[i] < (n - 1) - (k - 1) + i) {
                /* Increment this element */
                ar[i]++;
                if (i < k - 1) {
                    /* Turn the elements after it into a linear sequence */
                    unsigned int j;
                    for (j = i + 1; j < k; j++) {
                        ar[j] = ar[j - 1] + 1;
                    }
                }
                changed = 1;
            }
            finished = i == 0;
        }
        if (!changed) {
            /* Reset to first combination */
            for (i = 0; i < k; i++) {
                ar[i] = i;
            }
        }
    }
    return changed;
}

typedef void(*printfn)(const void *, FILE *);

void print_set(const unsigned int *ar, size_t len, const void **elements,
    const char *brackets, printfn print, FILE *fptr)
{
    unsigned int i;
    fputc(brackets[0], fptr);
    for (i = 0; i < len; i++) {
        print(elements[ar[i]], fptr);
        if (i < len - 1) {
            fputs(", ", fptr);
        }
    }
    fputc(brackets[1], fptr);
}

int main(void)
{
    unsigned int numbers[] = { 0, 1, 2 };
    char *elements[] = { "a", "b", "c", "d", "e" };
    const unsigned int k = sizeof(numbers) / sizeof(unsigned int);
    const unsigned int n = sizeof(elements) / sizeof(const char*);

    do {
        print_set(numbers, k, (void*)elements, "[]", (printfn)fputs, stdout);
        putchar('\n');
    } while (next_combination(numbers, n, k));
    getchar();
    return 0;
} 
```

* * *

## 回答 #46

> 赞同：1
> 
> 时间：2016-06-08T13:42:05.230

我正在为 PHP 寻找类似的解决方案并遇到以下问题

```
class Combinations implements Iterator
{
    protected $c = null;
    protected $s = null;
    protected $n = 0;
    protected $k = 0;
    protected $pos = 0;

    function __construct($s, $k) {
        if(is_array($s)) {
            $this->s = array_values($s);
            $this->n = count($this->s);
        } else {
            $this->s = (string) $s;
            $this->n = strlen($this->s);
        }
        $this->k = $k;
        $this->rewind();
    }
    function key() {
        return $this->pos;
    }
    function current() {
        $r = array();
        for($i = 0; $i < $this->k; $i++)
            $r[] = $this->s[$this->c[$i]];
        return is_array($this->s) ? $r : implode('', $r);
    }
    function next() {
        if($this->_next())
            $this->pos++;
        else
            $this->pos = -1;
    }
    function rewind() {
        $this->c = range(0, $this->k);
        $this->pos = 0;
    }
    function valid() {
        return $this->pos >= 0;
    }

    protected function _next() {
        $i = $this->k - 1;
        while ($i >= 0 && $this->c[$i] == $this->n - $this->k + $i)
            $i--;
        if($i < 0)
            return false;
        $this->c[$i]++;
        while($i++ < $this->k - 1)
            $this->c[$i] = $this->c[$i - 1] + 1;
        return true;
    }
}

foreach(new Combinations("1234567", 5) as $substring)
    echo $substring, ' '; 
```

[来源](https://stackoverflow.com/a/3742837/563247)

我不确定这门课的效率如何，但我只是将它用于播种机。

* * *

## 回答 #47

> 赞同：1
> 
> 时间：2017-02-02T10:41:22.420

使用 C# 的另一种解决方案：

```
 static List<List<T>> GetCombinations<T>(List<T> originalItems, int combinationLength)
    {
        if (combinationLength < 1)
        {
            return null;
        }

        return CreateCombinations<T>(new List<T>(), 0, combinationLength, originalItems);
    }

 static List<List<T>> CreateCombinations<T>(List<T> initialCombination, int startIndex, int length, List<T> originalItems)
    {
        List<List<T>> combinations = new List<List<T>>();
        for (int i = startIndex; i < originalItems.Count - length + 1; i++)
        {
            List<T> newCombination = new List<T>(initialCombination);
            newCombination.Add(originalItems[i]);
            if (length > 1)
            {
                List<List<T>> newCombinations = CreateCombinations(newCombination, i + 1, length - 1, originalItems);
                combinations.AddRange(newCombinations);
            }
            else
            {
                combinations.Add(newCombination);
            }
        }

        return combinations;
    } 
```

使用示例：

```
 List<char> initialArray = new List<char>() { 'a','b','c','d'};
   int combinationLength = 3;
   List<List<char>> combinations = GetCombinations(initialArray, combinationLength); 
```

* * *

## 回答 #48

> 赞同：1
> 
> 时间：2017-06-27T17:09:38.250

我们可以使用位的概念来做到这一点。让我们有一个字符串“abc”，我们想要所有长度为 2 的元素组合（即“ab”、“ac”、“bc”。）

我们可以找到从 1 到 2^n（不包括）的数字中的设置位。这里是 1 到 7，无论我们设置 bits = 2，我们都可以从字符串中打印相应的值。

例如：

*   1 - 001
*   2 - 010
*   3 - 011 ->`print ab (str[0] , str[1])`
*   4 - 100
*   5 - 101 ->`print ac (str[0] , str[2])`
*   6 - 110 ->`print ab (str[1] , str[2])`
*   7 - 111。

代码示例：

```
public class StringCombinationK {   
    static void combk(String s , int k){
        int n = s.length();
        int num = 1<<n;
        int j=0;
        int count=0;

        for(int i=0;i<num;i++){
            if (countSet(i)==k){
                setBits(i,j,s);
                count++;
                System.out.println();
            }
        }

        System.out.println(count);
    }

    static void setBits(int i,int j,String s){ // print the corresponding string value,j represent the index of set bit
        if(i==0){
            return;
        }

        if(i%2==1){
            System.out.print(s.charAt(j));                  
        }

        setBits(i/2,j+1,s);
    }

    static int countSet(int i){ //count number of set bits
        if( i==0){
            return 0;
        }

        return (i%2==0? 0:1) + countSet(i/2);
    }

    public static void main(String[] arhs){
        String s = "abcdefgh";
        int k=3;
        combk(s,k);
    }
} 
```

* * *

## 回答 #49

> 赞同：1
> 
> 时间：2019-03-21T03:45:18.937

这是使用宏的 Lisp 方法。这适用于 Common Lisp 并且应该适用于其他 Lisp 方言。

`body`下面的代码创建“n”个嵌套循环，并为 list 中“n”个元素的每个组合执行任意代码块（存储在变量中） `lst`。该变量`var`指向一个包含用于循环的变量的列表。

```
(defmacro do-combinations ((var lst num) &body body)
  (loop with syms = (loop repeat num collect (gensym))
        for i on syms
        for k = `(loop for ,(car i) on (cdr ,(cadr i))
                         do (let ((,var (list ,@(reverse syms)))) (progn ,@body)))
                then `(loop for ,(car i) on ,(if (cadr i) `(cdr ,(cadr i)) lst) do ,k)
        finally (return k))) 
```

让我们来看看...

```
(macroexpand-1 '(do-combinations (p '(1 2 3 4 5 6 7) 4) (pprint (mapcar #'car p))))

(LOOP FOR #:G3217 ON '(1 2 3 4 5 6 7) DO
 (LOOP FOR #:G3216 ON (CDR #:G3217) DO
  (LOOP FOR #:G3215 ON (CDR #:G3216) DO
   (LOOP FOR #:G3214 ON (CDR #:G3215) DO
    (LET ((P (LIST #:G3217 #:G3216 #:G3215 #:G3214)))
     (PROGN (PPRINT (MAPCAR #'CAR P))))))))

(do-combinations (p '(1 2 3 4 5 6 7) 4) (pprint (mapcar #'car p)))

(1 2 3 4)
(1 2 3 5)
(1 2 3 6)
... 
```

由于默认情况下不存储组合，因此将存储量保持在最低限度。选择代码而不是存储所有结果的可能性`body`也提供了更大的灵活性。

* * *

## 回答 #50

> 赞同：1
> 
> 时间：2019-05-15T03:19:42.940

跟着 Haskell 代码同时计算**组合数和组合**，由于 Haskell 的懒惰，你可以得到其中一部分而不计算另一部分。

```
import Data.Semigroup
import Data.Monoid

data Comb = MkComb {count :: Int, combinations :: [[Int]]} deriving (Show, Eq, Ord)

instance Semigroup Comb where
    (MkComb c1 cs1) <> (MkComb c2 cs2) = MkComb (c1 + c2) (cs1 ++ cs2)

instance Monoid Comb where
    mempty = MkComb 0 []

addElem :: Comb -> Int -> Comb
addElem (MkComb c cs) x = MkComb c (map (x :) cs)

comb :: Int -> Int -> Comb
comb n k | n < 0 || k < 0 = error "error in `comb n k`, n and k should be natural number"
comb n k | k == 0 || k == n = MkComb 1 [(take k [k-1,k-2..0])]
comb n k | n < k = mempty
comb n k = comb (n-1) k <> (comb (n-1) (k-1) `addElem` (n-1)) 
```

它的工作原理如下：

```
*Main> comb 0 1
MkComb {count = 0, combinations = []}

*Main> comb 0 0
MkComb {count = 1, combinations = [[]]}

*Main> comb 1 1
MkComb {count = 1, combinations = [[0]]}

*Main> comb 4 2
MkComb {count = 6, combinations = [[1,0],[2,0],[2,1],[3,0],[3,1],[3,2]]}

*Main> count (comb 10 5)
252 
```

* * *

## 回答 #51

> 赞同：1
> 
> 时间：2019-11-30T00:35:22.740

我知道已经有很多答案了，但我想我会在 JavaScript 中添加我自己的个人贡献，它由两个函数组成 - 一个用于生成原始 n- 的所有可能不同的 k 子集元素集，以及使用第一个函数生成原始 n 元素集的幂集。

下面是这两个函数的代码：

```
//Generate combination subsets from a base set of elements (passed as an array). This function should generate an
//array containing nCr elements, where nCr = n!/[r! (n-r)!].

//Arguments:

//[1] baseSet :     The base set to create the subsets from (e.g., ["a", "b", "c", "d", "e", "f"])
//[2] cnt :         The number of elements each subset is to contain (e.g., 3)

function MakeCombinationSubsets(baseSet, cnt)
{
    var bLen = baseSet.length;
    var indices = [];
    var subSet = [];
    var done = false;
    var result = [];        //Contains all the combination subsets generated
    var done = false;
    var i = 0;
    var idx = 0;
    var tmpIdx = 0;
    var incr = 0;
    var test = 0;
    var newIndex = 0;
    var inBounds = false;
    var tmpIndices = [];
    var checkBounds = false;

    //First, generate an array whose elements are indices into the base set ...

    for (i=0; i<cnt; i++)

        indices.push(i);

    //Now create a clone of this array, to be used in the loop itself ...

        tmpIndices = [];

        tmpIndices = tmpIndices.concat(indices);

    //Now initialise the loop ...

    idx = cnt - 1;      //point to the last element of the indices array
    incr = 0;
    done = false;
    while (!done)
    {
    //Create the current subset ...

        subSet = [];    //Make sure we begin with a completely empty subset before continuing ...

        for (i=0; i<cnt; i++)

            subSet.push(baseSet[tmpIndices[i]]);    //Create the current subset, using items selected from the
                                                    //base set, using the indices array (which will change as we
                                                    //continue scanning) ...

    //Add the subset thus created to the result set ...

        result.push(subSet);

    //Now update the indices used to select the elements of the subset. At the start, idx will point to the
    //rightmost index in the indices array, but the moment that index moves out of bounds with respect to the
    //base set, attention will be shifted to the next left index.

        test = tmpIndices[idx] + 1;

        if (test >= bLen)
        {
        //Here, we're about to move out of bounds with respect to the base set. We therefore need to scan back,
        //and update indices to the left of the current one. Find the leftmost index in the indices array that
        //isn't going to  move out of bounds with respect to the base set ...

            tmpIdx = idx - 1;
            incr = 1;

            inBounds = false;       //Assume at start that the index we're checking in the loop below is out of bounds
            checkBounds = true;

            while (checkBounds)
            {
                if (tmpIdx < 0)
                {
                    checkBounds = false;    //Exit immediately at this point
                }
                else
                {
                    newIndex = tmpIndices[tmpIdx] + 1;
                    test = newIndex + incr;

                    if (test >= bLen)
                    {
                    //Here, incrementing the current selected index will take that index out of bounds, so
                    //we move on to the next index to the left ...

                        tmpIdx--;
                        incr++;
                    }
                    else
                    {
                    //Here, the index will remain in bounds if we increment it, so we
                    //exit the loop and signal that we're in bounds ...

                        inBounds = true;
                        checkBounds = false;

                    //End if/else
                    }

                //End if 
                }               
            //End while
            }
    //At this point, if we'er still in bounds, then we continue generating subsets, but if not, we abort immediately.

            if (!inBounds)
                done = true;
            else
            {
            //Here, we're still in bounds. We need to update the indices accordingly. NOTE: at this point, although a
            //left positioned index in the indices array may still be in bounds, incrementing it to generate indices to
            //the right may take those indices out of bounds. We therefore need to check this as we perform the index
            //updating of the indices array.

                tmpIndices[tmpIdx] = newIndex;

                inBounds = true;
                checking = true;
                i = tmpIdx + 1;

                while (checking)
                {
                    test = tmpIndices[i - 1] + 1;   //Find out if incrementing the left adjacent index takes it out of bounds

                    if (test >= bLen)
                    {
                        inBounds = false;           //If we move out of bounds, exit NOW ...
                        checking = false;
                    }
                    else
                    {
                        tmpIndices[i] = test;       //Otherwise, update the indices array ...

                        i++;                        //Now move on to the next index to the right in the indices array ...

                        checking = (i < cnt);       //And continue until we've exhausted all the indices array elements ...
                    //End if/else
                    }
                //End while
                }
                //At this point, if the above updating of the indices array has moved any of its elements out of bounds,
                //we abort subset construction from this point ...
                if (!inBounds)
                    done = true;
            //End if/else
            }
        }
        else
        {
        //Here, the rightmost index under consideration isn't moving out of bounds with respect to the base set when
        //we increment it, so we simply increment and continue the loop ...
            tmpIndices[idx] = test;
        //End if
        }
    //End while
    }
    return(result);
//End function
}

function MakePowerSet(baseSet)
{
    var bLen = baseSet.length;
    var result = [];
    var i = 0;
    var partialSet = [];

    result.push([]);    //add the empty set to the power set

    for (i=1; i<bLen; i++)
    {
        partialSet = MakeCombinationSubsets(baseSet, i);
        result = result.concat(partialSet);
    //End i loop
    }
    //Now, finally, add the base set itself to the power set to make it complete ...

    partialSet = [];
    partialSet.push(baseSet);
    result = result.concat(partialSet);

    return(result);
    //End function
} 
```

我以集合 ["a", "b", "c", "d", "e", "f"] 作为基集对此进行了测试，并运行代码以生成以下幂集：

```
[]
["a"]
["b"]
["c"]
["d"]
["e"]
["f"]
["a","b"]
["a","c"]
["a","d"]
["a","e"]
["a","f"]
["b","c"]
["b","d"]
["b","e"]
["b","f"]
["c","d"]
["c","e"]
["c","f"]
["d","e"]
["d","f"]
["e","f"]
["a","b","c"]
["a","b","d"]
["a","b","e"]
["a","b","f"]
["a","c","d"]
["a","c","e"]
["a","c","f"]
["a","d","e"]
["a","d","f"]
["a","e","f"]
["b","c","d"]
["b","c","e"]
["b","c","f"]
["b","d","e"]
["b","d","f"]
["b","e","f"]
["c","d","e"]
["c","d","f"]
["c","e","f"]
["d","e","f"]
["a","b","c","d"]
["a","b","c","e"]
["a","b","c","f"]
["a","b","d","e"]
["a","b","d","f"]
["a","b","e","f"]
["a","c","d","e"]
["a","c","d","f"]
["a","c","e","f"]
["a","d","e","f"]
["b","c","d","e"]
["b","c","d","f"]
["b","c","e","f"]
["b","d","e","f"]
["c","d","e","f"]
["a","b","c","d","e"]
["a","b","c","d","f"]
["a","b","c","e","f"]
["a","b","d","e","f"]
["a","c","d","e","f"]
["b","c","d","e","f"]
["a","b","c","d","e","f"] 
```

只需“按原样”复制并粘贴这两个函数，您将拥有提取 n 元素集的不同 k 子集所需的基础知识，并根据需要生成该 n 元素集**的**幂集。

我并不认为这很优雅，只是在经过大量测试后它可以工作（并在调试阶段变成蓝色:)）。

* * *

## 回答 #52

> 赞同：1
> 
> 时间：2021-03-22T21:52:35.267

另一个python recusive 解决方案。

```
def combination_indicies(n, k, j = 0, stack = []):   
    if len(stack) == k:            
        yield list(stack)
        return

    for i in range(j, n):
        stack.append(i)
        for x in combination_indicies(n, k, i + 1, stack):            
            yield x
        stack.pop()  

list(combination_indicies(5, 3)) 
```

输出：

```
[[0, 1, 2],
 [0, 1, 3],
 [0, 1, 4],
 [0, 2, 3],
 [0, 2, 4],
 [0, 3, 4],
 [1, 2, 3],
 [1, 2, 4],
 [1, 3, 4],
 [2, 3, 4]] 
```

* * *

## 回答 #53

> 赞同：0
> 
> 时间：2008-12-04T00:02:09.517

在像 Andrea Ambu 这样的 Python 中，但没有硬编码选择三个。

```
def combinations(list, k):
    """Choose combinations of list, choosing k elements(no repeats)"""
    if len(list) < k:
        return []
    else:
        seq = [i for i in range(k)]
        while seq:
            print [list[index] for index in seq]
            seq = get_next_combination(len(list), k, seq)

def get_next_combination(num_elements, k, seq):
        index_to_move = find_index_to_move(num_elements, seq)
        if index_to_move == None:
            return None
        else:
            seq[index_to_move] += 1

            #for every element past this sequence, move it down
            for i, elem in enumerate(seq[(index_to_move+1):]):
                seq[i + 1 + index_to_move] = seq[index_to_move] + i + 1

            return seq

def find_index_to_move(num_elements, seq):
        """Tells which index should be moved"""
        for rev_index, elem in enumerate(reversed(seq)):
            if elem < (num_elements - rev_index - 1):
                return len(seq) - rev_index - 1
        return None 
```

* * *

## 回答 #54

> 赞同：0
> 
> 时间：2011-12-24T16:34:58.143

在 Python 中，利用递归和一切都是通过引用完成的事实。对于非常大的集合，这将占用大量内存，但具有初始集合可以是复杂对象的优点。它只会找到唯一的组合。

```
import copy

def find_combinations( length, set, combinations = None, candidate = None ):
    # recursive function to calculate all unique combinations of unique values
    # from [set], given combinations of [length].  The result is populated
    # into the 'combinations' list.
    #
    if combinations == None:
        combinations = []
    if candidate == None:
        candidate = []

    for item in set:
        if item in candidate:
            # this item already appears in the current combination somewhere.
            # skip it
            continue

        attempt = copy.deepcopy(candidate)
        attempt.append(item)
        # sorting the subset is what gives us completely unique combinations,
        # so that [1, 2, 3] and [1, 3, 2] will be treated as equals
        attempt.sort()

        if len(attempt) < length:
            # the current attempt at finding a new combination is still too
            # short, so add another item to the end of the set
            # yay recursion!
            find_combinations( length, set, combinations, attempt )
        else:
            # the current combination attempt is the right length.  If it
            # already appears in the list of found combinations then we'll
            # skip it.
            if attempt in combinations:
                continue
            else:
                # otherwise, we append it to the list of found combinations
                # and move on.
                combinations.append(attempt)
                continue
    return len(combinations) 
```

你用这种方式。传递“结果”是可选的，因此您可以使用它来获取可能组合的数量……尽管这确实效率低下（最好通过计算来完成）。

```
size = 3
set = [1, 2, 3, 4, 5]
result = []

num = find_combinations( size, set, result ) 
print "size %d results in %d sets" % (size, num)
print "result: %s" % (result,) 
```

您应该从该测试数据中获得以下输出：

```
size 3 results in 10 sets
result: [[1, 2, 3], [1, 2, 4], [1, 2, 5], [1, 3, 4], [1, 3, 5], [1, 4, 5], [2, 3, 4], [2, 3, 5], [2, 4, 5], [3, 4, 5]] 
```

如果你的集合看起来像这样，它也能正常工作：

```
set = [
    [ 'vanilla', 'cupcake' ],
    [ 'chocolate', 'pudding' ],
    [ 'vanilla', 'pudding' ],
    [ 'chocolate', 'cookie' ],
    [ 'mint', 'cookie' ]
] 
```

* * *

## 回答 #55

> 赞同：0
> 
> 时间：2012-05-03T20:42:36.120

这是我在 javascript 中的贡献（无递归）

```
set = ["q0", "q1", "q2", "q3"]
collector = []

function comb(num) {
  results = []
  one_comb = []
  for (i = set.length - 1; i >= 0; --i) {
    tmp = Math.pow(2, i)
    quotient = parseInt(num / tmp)
    results.push(quotient)
    num = num % tmp
  }
  k = 0
  for (i = 0; i < results.length; ++i)
    if (results[i]) {
      ++k
      one_comb.push(set[i])
    }
  if (collector[k] == undefined)
    collector[k] = []
  collector[k].push(one_comb)
}

sum = 0
for (i = 0; i < set.length; ++i)
  sum += Math.pow(2, i)
 for (ii = sum; ii > 0; --ii)
  comb(ii)
 cnt = 0
for (i = 1; i < collector.length; ++i) {
  n = 0
  for (j = 0; j < collector[i].length; ++j)
    document.write(++cnt, " - " + (++n) + " - ", collector[i][j], "<br>")
  document.write("<hr>")
} 
```

* * *

## 回答 #56

> 赞同：0
> 
> 时间：2013-01-12T09:52:11.507

这个答案怎么样......这会打印长度为 3 的所有组合......它可以推广到任何长度......工作代码......

```
#include<iostream>
#include<string>
using namespace std;

void combination(string a,string dest){
int l = dest.length();
if(a.empty() && l  == 3 ){
 cout<<dest<<endl;}
else{
  if(!a.empty() && dest.length() < 3 ){
     combination(a.substr(1,a.length()),dest+a[0]);}
  if(!a.empty() && dest.length() <= 3 ){
      combination(a.substr(1,a.length()),dest);}
 }

 }

 int main(){
 string demo("abcd");
 combination(demo,"");
 return 0;
 } 
```

* * *

## 回答 #57

> 赞同：0
> 
> 时间：2013-04-27T15:33:21.040

简短的快速 C 实现

```
#include <stdio.h>

void main(int argc, char *argv[]) {
  const int n = 6; /* The size of the set; for {1, 2, 3, 4} it's 4 */
  const int p = 4; /* The size of the subsets; for {1, 2}, {1, 3}, ... it's 2 */
  int comb[40] = {0}; /* comb[i] is the index of the i-th element in the combination */

  int i = 0;
  for (int j = 0; j <= n; j++) comb[j] = 0;
  while (i >= 0) {
    if (comb[i] < n + i - p + 1) {
       comb[i]++;
       if (i == p - 1) { for (int j = 0; j < p; j++) printf("%d ", comb[j]); printf("\n"); }
       else            { comb[++i] = comb[i - 1]; }
    } else i--; }
} 
```

要查看它有多快，请使用此代码并对其进行测试

```
#include <time.h>
#include <stdio.h>

void main(int argc, char *argv[]) {
  const int n = 32; /* The size of the set; for {1, 2, 3, 4} it's 4 */
  const int p = 16; /* The size of the subsets; for {1, 2}, {1, 3}, ... it's 2 */
  int comb[40] = {0}; /* comb[i] is the index of the i-th element in the combination */

  int c = 0; int i = 0;
  for (int j = 0; j <= n; j++) comb[j] = 0;
  while (i >= 0) {
    if (comb[i] < n + i - p + 1) {
       comb[i]++;
       /* if (i == p - 1) { for (int j = 0; j < p; j++) printf("%d ", comb[j]); printf("\n"); } */
       if (i == p - 1) c++;
       else            { comb[++i] = comb[i - 1]; }
    } else i--; }
  printf("%d!%d == %d combination(s) in %15.3f second(s)\n ", p, n, c, clock()/1000.0);
} 
```

使用 cmd.exe (windows) 进行测试：

```
Microsoft Windows XP [Version 5.1.2600]
(C) Copyright 1985-2001 Microsoft Corp.

c:\Program Files\lcc\projects>combination
16!32 == 601080390 combination(s) in          5.781 second(s)

c:\Program Files\lcc\projects> 
```

祝你今天过得愉快。

* * *

## 回答 #58

> 赞同：0
> 
> 时间：2013-05-12T06:46:26.670

使用堆栈的另一个递归解决方案（您应该能够将其移植为使用字母而不是数字），虽然比大多数短一点：

```
stack = [] 
def choose(n,x):
   r(0,0,n+1,x)

def r(p, c, n,x):
   if x-c == 0:
      print stack
      return

   for i in range(p, n-(x-1)+c):
      stack.append(i)
      r(i+1,c+1,n,x)
      stack.pop() 
```

4 选择 3 或者我想要从 0 到 4 开始的所有 3 个数字组合

```
choose(4,3) 

[0, 1, 2]
[0, 1, 3]
[0, 1, 4]
[0, 2, 3]
[0, 2, 4]
[0, 3, 4]
[1, 2, 3]
[1, 2, 4]
[1, 3, 4]
[2, 3, 4] 
```

* * *

## 回答 #59

> 赞同：0
> 
> 时间：2013-06-26T19:07:23.980

这是一个咖啡脚本实现

```
combinations: (list, n) ->
        permuations = Math.pow(2, list.length) - 1
        out = []
        combinations = []

        while permuations
            out = []

            for i in [0..list.length]
                y = ( 1 << i )
                if( y & permuations and (y isnt permuations))
                    out.push(list[i])

            if out.length <= n and out.length > 0
                combinations.push(out)

            permuations--

        return combinations 
```

* * *

## 回答 #60

> 赞同：0
> 
> 时间：2014-05-28T11:21:17.283

也许我错过了重点（您需要算法而不是现成的解决方案），但似乎 scala 开箱即用（现在）：

```
def combis(str:String, k:Int):Array[String] = {
  str.combinations(k).toArray 
} 
```

使用这样的方法：

```
 println(combis("abcd",2).toList) 
```

将产生：

```
 List(ab, ac, ad, bc, bd, cd) 
```

* * *

## 回答 #61

> 赞同：0
> 
> 时间：2014-06-28T13:24:33.843

简短的快速 C# 实现

```
public static IEnumerable<IEnumerable<T>> Combinations<T>(IEnumerable<T> elements, int k)
{
    return Combinations(elements.Count(), k).Select(p => p.Select(q => elements.ElementAt(q)));                
}      

public static List<int[]> Combinations(int setLenght, int subSetLenght) //5, 3
{
    var result = new List<int[]>();

    var lastIndex = subSetLenght - 1;
    var dif = setLenght - subSetLenght;
    var prevSubSet = new int[subSetLenght];
    var lastSubSet = new int[subSetLenght];
    for (int i = 0; i < subSetLenght; i++)
    {
        prevSubSet[i] = i;
        lastSubSet[i] = i + dif;
    }

    while(true)
    {
        //add subSet ad result set
        var n = new int[subSetLenght];
        for (int i = 0; i < subSetLenght; i++)
            n[i] = prevSubSet[i];

        result.Add(n);

        if (prevSubSet[0] >= lastSubSet[0])
            break;

        //start at index 1 because index 0 is checked and breaking in the current loop
        int j = 1;
        for (; j < subSetLenght; j++)
        {
            if (prevSubSet[j] >= lastSubSet[j])
            {
                prevSubSet[j - 1]++;

                for (int p = j; p < subSetLenght; p++)
                    prevSubSet[p] = prevSubSet[p - 1] + 1;

                break;
            }
        }

        if (j > lastIndex)
            prevSubSet[lastIndex]++;
    }

    return result;
} 
```

* * *

## 回答 #62

> 赞同：0
> 
> 时间：2014-12-05T08:23:08.507

这是我使用递归和位移提出的 C++ 解决方案。它也可以在 C 中工作。

```
void r_nCr(unsigned int startNum, unsigned int bitVal, unsigned int testNum) // Should be called with arguments (2^r)-1, 2^(r-1), 2^(n-1)
{
    unsigned int n = (startNum - bitVal) << 1;
    n += bitVal ? 1 : 0;

    for (unsigned int i = log2(testNum) + 1; i > 0; i--) // Prints combination as a series of 1s and 0s
        cout << (n >> (i - 1) & 1);
    cout << endl;

    if (!(n & testNum) && n != startNum)
        r_nCr(n, bitVal, testNum);

    if (bitVal && bitVal < testNum)
        r_nCr(startNum, bitVal >> 1, testNum);
} 
```

[您可以在此处](https://stackoverflow.com/questions/27308438/how-to-cheaply-calculate-all-possible-length-r-combinations-of-n-possible-elem/27308439#27308439)找到有关其工作原理的说明。

* * *

## 回答 #63

> 赞同：0
> 
> 时间：2015-01-19T19:38:26.520

C# 简单算法。（我发布它是因为我尝试使用你们上传的那个，但由于某种原因我无法编译它 - 扩展一个类？所以我写了我自己的，以防其他人面临同样的问题我做到了）。顺便说一句，我对 c# 的兴趣并不多于基本编程，但是这个工作正常。

```
public static List<List<int>> GetSubsetsOfSizeK(List<int> lInputSet, int k)
        {
            List<List<int>> lSubsets = new List<List<int>>();
            GetSubsetsOfSizeK_rec(lInputSet, k, 0, new List<int>(), lSubsets);
            return lSubsets;
        }

public static void GetSubsetsOfSizeK_rec(List<int> lInputSet, int k, int i, List<int> lCurrSet, List<List<int>> lSubsets)
        {
            if (lCurrSet.Count == k)
            {
                lSubsets.Add(lCurrSet);
                return;
            }

            if (i >= lInputSet.Count)
                return;

            List<int> lWith = new List<int>(lCurrSet);
            List<int> lWithout = new List<int>(lCurrSet);
            lWith.Add(lInputSet[i++]);

            GetSubsetsOfSizeK_rec(lInputSet, k, i, lWith, lSubsets);
            GetSubsetsOfSizeK_rec(lInputSet, k, i, lWithout, lSubsets);
        } 
```

用法：`GetSubsetsOfSizeK(set of type List<int>, integer k)`

您可以修改它以迭代您正在使用的任何内容。

祝你好运！

* * *

## 回答 #64

> 赞同：0
> 
> 时间：2015-02-03T19:48:26.587

这是我想出的解决这个问题的算法。它是用 c++ 编写的，但几乎可以适应任何支持位运算的语言。

```
void r_nCr(const unsigned int &startNum, const unsigned int &bitVal, const unsigned int &testNum) // Should be called with arguments (2^r)-1, 2^(r-1), 2^(n-1)
{
    unsigned int n = (startNum - bitVal) << 1;
    n += bitVal ? 1 : 0;

    for (unsigned int i = log2(testNum) + 1; i > 0; i--) // Prints combination as a series of 1s and 0s
        cout << (n >> (i - 1) & 1);
    cout << endl;

    if (!(n & testNum) && n != startNum)
        r_nCr(n, bitVal, testNum);

    if (bitVal && bitVal < testNum)
        r_nCr(startNum, bitVal >> 1, testNum);
} 
```

[您可以在此处](https://stackoverflow.com/questions/27308438/how-to-cheaply-calculate-all-possible-length-r-combinations-of-n-possible-elem/27308439#27308439)查看其工作原理的说明。

* * *

## 回答 #65

> 赞同：0
> 
> 时间：2016-04-25T13:43:12.250

递归地，一个非常简单的答案`combo`，在 Free Pascal 中。

```
 procedure combinata (n, k :integer; producer :oneintproc);

        procedure combo (ndx, nbr, len, lnd :integer);
        begin
            for nbr := nbr to len do begin
                productarray[ndx] := nbr;
                if len < lnd then
                    combo(ndx+1,nbr+1,len+1,lnd)
                else
                    producer(k);
            end;
        end;

    begin
        combo (0, 0, n-k, n-1);
    end; 
```

“生产者”处理为每个组合制作的 productarray。

* * *

## 回答 #66

> 赞同：0
> 
> 时间：2016-12-14T22:35:37.177

不需要集合操作。这个问题几乎与循环 K 嵌套循环相同，但您必须小心索引和边界（忽略 Java 和 OOP 的东西）：

```
 public class CombinationsGen {
    private final int n;
    private final int k;
    private int[] buf;

    public CombinationsGen(int n, int k) {
        this.n = n;
        this.k = k;
    }

    public void combine(Consumer<int[]> consumer) {
        buf = new int[k];
        rec(0, 0, consumer);
    }

    private void rec(int index, int next, Consumer<int[]> consumer) {
        int max = n - index;

        if (index == k - 1) {
            for (int i = 0; i < max && next < n; i++) {
                buf[index] = next;
                next++;
                consumer.accept(buf);
            }
        } else {
            for (int i = 0; i < max && next + index < n; i++) {
                buf[index] = next;
                next++;
                rec(index + 1, next, consumer);
            }
        }
    }
} 
```

像这样使用：

```
 CombinationsGen gen = new CombinationsGen(5, 2);

 AtomicInteger total = new AtomicInteger();
 gen.combine(arr -> {
     System.out.println(Arrays.toString(arr));
     total.incrementAndGet();
 });
 System.out.println(total); 
```

获得预期结果：

```
[0, 1]
[0, 2]
[0, 3]
[0, 4]
[1, 2]
[1, 3]
[1, 4]
[2, 3]
[2, 4]
[3, 4]
10 
```

最后，将索引映射到您可能拥有的任何数据集。

* * *

## 回答 #67

> 赞同：0
> 
> 时间：2017-01-03T13:26:52.877

简单但缓慢的 C++ 回溯算法。

```
#include <iostream>

void backtrack(int* numbers, int n, int k, int i, int s)
{
    if (i == k)
    {
        for (int j = 0; j < k; ++j)
        {
            std::cout << numbers[j];
        }
        std::cout << std::endl;

        return;
    }

    if (s > n)
    {
        return;
    }

    numbers[i] = s;
    backtrack(numbers, n, k, i + 1, s + 1);
    backtrack(numbers, n, k, i, s + 1);
}

int main(int argc, char* argv[])
{
    int n = 5;
    int k = 3;

    int* numbers = new int[k];

    backtrack(numbers, n, k, 0, 1);

    delete[] numbers;

    return 0;
} 
```

* * *

## 回答 #68

> 赞同：0
> 
> 时间：2018-02-22T00:27:26.943

我为 C++ 中的组合制作了一个通用类。它是这样使用的。

```
char ar[] = "0ABCDEFGH";
nCr ncr(8, 3);
while(ncr.next()) {
    for(int i=0; i<ncr.size(); i++) cout << ar[ncr[i]];
    cout << ' ';
} 
```

我的库 ncr[i] 从 1 返回，而不是从 0 返回。这就是数组中有 0 的原因。如果要考虑顺序，只需将 nCr 类更改为 nPr。用法相同。

结果

ABC ABD ABE ABF ABG ABH ACD ACE ACF ACG ACH ADE ADF ADG ADH AEF AEG AEH AFG AFH AGH BCD BCE BCF BCG BCH BDE BDF BDG BDH BEF BEG BEH BFG BFH BGH CDE CDF CDG CDH CEF CEG CEH CFG CFH CGH DEF DEG DEH DFG DFH DGH EFG EFH EGH FGH

这里是头文件。

```
#pragma once
#include <exception>

class NRexception : public std::exception
{
public:
    virtual const char* what() const throw() {
        return "Combination : N, R should be positive integer!!";
    }
};

class Combination
{
public:
    Combination(int n, int r);
    virtual ~Combination() { delete [] ar;}
    int& operator[](unsigned i) {return ar[i];}
    bool next();
    int size() {return r;}
    static int factorial(int n);

protected:
    int* ar;
    int n, r;
};

class nCr : public Combination
{
public: 
    nCr(int n, int r);
    bool next();
    int count() const;
};

class nTr : public Combination
{
public:
    nTr(int n, int r);
    bool next();
    int count() const;
};

class nHr : public nTr
{
public:
    nHr(int n, int r) : nTr(n,r) {}
    bool next();
    int count() const;
};

class nPr : public Combination
{
public:
    nPr(int n, int r);
    virtual ~nPr() {delete [] on;}
    bool next();
    void rewind();
    int count() const;

private:
    bool* on;
    void inc_ar(int i);
}; 
```

和实施。

```
#include "combi.h"
#include <set>
#include<cmath>

Combination::Combination(int n, int r)
{
    //if(n < 1 || r < 1) throw NRexception();
    ar = new int[r];
    this->n = n;
    this->r = r;
}

int Combination::factorial(int n) 
{
    return n == 1 ? n : n * factorial(n-1);
}

int nPr::count() const
{
    return factorial(n)/factorial(n-r);
}

int nCr::count() const
{
    return factorial(n)/factorial(n-r)/factorial(r);
}

int nTr::count() const
{
    return pow(n, r);
}

int nHr::count() const
{
    return factorial(n+r-1)/factorial(n-1)/factorial(r);
}

nCr::nCr(int n, int r) : Combination(n, r)
{
    if(r == 0) return;
    for(int i=0; i<r-1; i++) ar[i] = i + 1;
    ar[r-1] = r-1;
}

nTr::nTr(int n, int r) : Combination(n, r)
{
    for(int i=0; i<r-1; i++) ar[i] = 1;
    ar[r-1] = 0;
}

bool nCr::next()
{
    if(r == 0) return false;
    ar[r-1]++;
    int i = r-1;
    while(ar[i] == n-r+2+i) {
        if(--i == -1) return false;
        ar[i]++;
    }
    while(i < r-1) ar[i+1] = ar[i++] + 1;
    return true;
}

bool nTr::next()
{
    ar[r-1]++;
    int i = r-1;
    while(ar[i] == n+1) {
        ar[i] = 1;
        if(--i == -1) return false;
        ar[i]++;
    }
    return true;
}

bool nHr::next()
{
    ar[r-1]++;
    int i = r-1;
    while(ar[i] == n+1) {
        if(--i == -1) return false;
        ar[i]++;
    }
    while(i < r-1) ar[i+1] = ar[i++];
    return true;
}

nPr::nPr(int n, int r) : Combination(n, r)
{
    on = new bool[n+2];
    for(int i=0; i<n+2; i++) on[i] = false;
    for(int i=0; i<r; i++) {
        ar[i] = i + 1;
        on[i] = true;
    }
    ar[r-1] = 0;
}

void nPr::rewind()
{
    for(int i=0; i<r; i++) {
        ar[i] = i + 1;
        on[i] = true;
    }
    ar[r-1] = 0;
}

bool nPr::next()
{   
    inc_ar(r-1);

    int i = r-1;
    while(ar[i] == n+1) {
        if(--i == -1) return false;
        inc_ar(i);
    }
    while(i < r-1) {
        ar[++i] = 0;
        inc_ar(i);
    }
    return true;
}

void nPr::inc_ar(int i)
{
    on[ar[i]] = false;
    while(on[++ar[i]]);
    if(ar[i] != n+1) on[ar[i]] = true;
} 
```

* * *

## 回答 #69

> 赞同：0
> 
> 时间：2018-02-27T22:43:50.580

作为迭代器对象实现的 MetaTrader MQL4 非常快速的组合。

代码很容易理解。

我对很多算法进行了基准测试，这个算法非常快——比大多数 next_combination() 函数快大约 3 倍。

```
class CombinationsIterator
{
private:
	int input_array[];  // 1 2 3 4 5
	int index_array[];  // i j k
	int m_elements;     // N
	int m_indices;      // K

public:
	CombinationsIterator(int &src_data[], int k)
	{
		m_indices = k;
		m_elements = ArraySize(src_data);
		ArrayCopy(input_array, src_data);
		ArrayResize(index_array, m_indices);

		// create initial combination (0..k-1)
		for (int i = 0; i < m_indices; i++)
		{
			index_array[i] = i;
		}
	}

	// https://stackoverflow.com/questions/5076695
	// bool next_combination(int &item[], int k, int N)
	bool advance()
	{
		int N = m_elements;
		for (int i = m_indices - 1; i >= 0; --i)
		{
			if (index_array[i] < --N)
			{
				++index_array[i];
				for (int j = i + 1; j < m_indices; ++j)
				{
					index_array[j] = index_array[j - 1] + 1;
				}
				return true;
			}
		}
		return false;
	}

	void getItems(int &items[])
	{
		// fill items[] from input array
		for (int i = 0; i < m_indices; i++)
		{
			items[i] = input_array[index_array[i]];
		}
	}
};
```

测试上述迭代器类的驱动程序：

```
//+------------------------------------------------------------------+
//|                                                                  |
//+------------------------------------------------------------------+
// driver program to test above class

#define N 5
#define K 3

void OnStart()
{
	int myset[N] = {1, 2, 3, 4, 5};
	int items[K];

	CombinationsIterator comboIt(myset, K);

	do
	{
		comboIt.getItems(items);

		printf("%s", ArrayToString(items));

	} while (comboIt.advance());

}
```

```
Output:
1 2 3 
1 2 4 
1 2 5 
1 3 4 
1 3 5 
1 4 5 
2 3 4 
2 3 5 
2 4 5 
3 4 5
```

* * *

## 回答 #70

> 赞同：0
> 
> 时间：2018-07-14T15:57:39.323

这是一个简单的JS解决方案：

```
function getAllCombinations(n, k, f1) {
	indexes = Array(k);
  for (let i =0; i< k; i++) {
  	indexes[i] = i;
  }
  var total = 1;
  f1(indexes);
  while (indexes[0] !== n-k) {
  	total++;
		getNext(n, indexes);
    f1(indexes);
  }
  return {total};
}

function getNext(n, vec) {
	const k = vec.length;
  vec[k-1]++;
	for (var i=0; i<k; i++) {
  	var currentIndex = k-i-1;
    if (vec[currentIndex] === n - i) {
	  	var nextIndex = k-i-2;
      vec[nextIndex]++;
      vec[currentIndex] = vec[nextIndex] + 1;
    }
  }

	for (var i=1; i<k; i++) {
    if (vec[i] === n - (k-i - 1)) {
      vec[i] = vec[i-1] + 1;
    }
  }
	return vec;
} 

let start = new Date();
let result = getAllCombinations(10, 3, indexes => console.log(indexes)); 
let runTime = new Date() - start; 

console.log({
result, runTime
});
```

* * *

## 回答 #71

> 赞同：0
> 
> 时间：2020-12-11T02:00:38.880

下面是 C++ 中的迭代算法，**它不使用**STL，也不使用递归，也不使用条件嵌套循环。这种方式速度更快，它不执行任何元素交换，也不会给堆栈带来递归负担，并且还可以通过分别替换、 和 、和`mallloc()`来`free()`轻松`printf()`移植到ANSI C。`new``delete``std::cout`

如果要显示具有不同或更长字母表的元素，则将`*alphabet`参数更改为指向与 不同的字符串`"abcdefg"`。

```
void OutputArrayChar(unsigned int* ka, size_t n, const char *alphabet) {
    for (int i = 0; i < n; i++)
        std::cout << alphabet[ka[i]] << ",";
    std::cout << endl;
}

void GenCombinations(const unsigned int N, const unsigned int K, const char *alphabet) {
    unsigned int *ka = new unsigned int [K];  //dynamically allocate an array of UINTs
    unsigned int ki = K-1;                    //Point ki to the last elemet of the array
    ka[ki] = N-1;                             //Prime the last elemet of the array.

    while (true) {
        unsigned int tmp = ka[ki];  //Optimization to prevent reading ka[ki] repeatedly

        while (ki)                  //Fill to the left with consecutive descending values (blue squares)
            ka[--ki] = --tmp;
        OutputArrayChar(ka, K, alphabet);

        while (--ka[ki] == ki) {    //Decrement and check if the resulting value equals the index (bright green squares)
            OutputArrayChar(ka, K, alphabet);
            if (++ki == K) {      //Exit condition (all of the values in the array are flush to the left)
                delete[] ka;
                return;
            }                   
        }
    }
}

int main(int argc, char *argv[])
{
    GenCombinations(7, 4, "abcdefg");
    return 0;
} 
```

重要提示：`*alphabet`参数必须指向至少包含`N`字符的字符串。您还可以传递在其他地方定义的字符串的地址。

**组合：在“7选4”中。** [![的组合](https://i.stack.imgur.com/Xa8st.png)](https://i.stack.imgur.com/Xa8st.png)

* * *

## 回答 #72

> 赞同：0
> 
> 时间：2020-12-12T10:21:51.297

这是一个简单且难以理解的递归 C++ 解决方案：

```
#include<vector>
using namespace std;

template<typename T>
void ksubsets(const vector<T>& arr, unsigned left, unsigned idx,
    vector<T>& lst, vector<vector<T>>& res)
{
    if (left < 1) {
        res.push_back(lst);
        return;
    }
    for (unsigned i = idx; i < arr.size(); i++) {
        lst.push_back(arr[i]);
        ksubsets(arr, left - 1, i + 1, lst, res);
        lst.pop_back();
    }
}

int main()
{
    vector<int> arr = { 1, 2, 3, 4, 5 };
    unsigned left = 3;
    vector<int> lst;
    vector<vector<int>> res;
    ksubsets<int>(arr, left, 0, lst, res);
    // now res has all the combinations
} 
```

* * *

## 回答 #73

> 赞同：0
> 
> 时间：2021-04-14T01:12:02.577

[最近IronScripter](https://ironscripter.us/another-powershell-math-challenge/)网站上出现了一个需要 n-choose-k 解决方案的 PowerShell 挑战。我在那里发布了一个解决方案，但这里有一个更通用的版本。

*   AllK 开关用于控制输出是仅长度为 ChooseK 的组合，还是长度为 1 到 ChooseK 的组合。
*   Prefix 参数实际上是输出字符串的累加器，但其效果是为初始调用传入的值实际上会为每一行输出添加前缀。

```
function Get-NChooseK
{

    [CmdletBinding()]

    Param
    (

        [String[]]
        $ArrayN

    ,   [Int]
        $ChooseK

    ,   [Switch]
        $AllK

    ,   [String]
        $Prefix = ''

    )

    PROCESS
    {
        # Validate the inputs
        $ArrayN = $ArrayN | Sort-Object -Unique

        If ($ChooseK -gt $ArrayN.Length)
        {
            Write-Error "Can't choose $ChooseK items when only $($ArrayN.Length) are available." -ErrorAction Stop
        }

        # Control the output
        $firstK = If ($AllK) { 1 } Else { $ChooseK }

        # Get combinations
        $firstK..$ChooseK | ForEach-Object {

            $thisK = $_

            $ArrayN[0..($ArrayN.Length-($thisK--))] | ForEach-Object {
                If ($thisK -eq 0)
                {
                    Write-Output ($Prefix+$_)
                }
                Else
                {
                    Get-NChooseK -Array ($ArrayN[($ArrayN.IndexOf($_)+1)..($ArrayN.Length-1)]) -Choose $thisK -AllK:$false -Prefix ($Prefix+$_)
                }
            }

        }
    }

} 
```

例如：

```
PS C:\>$ArrayN  = 'E','B','C','A','D'
PS C:\>$ChooseK = 3
PS C:\>Get-NChooseK -ArrayN $ArrayN -ChooseK $ChooseK
ABC
ABD
ABE
ACD
ACE
ADE
BCD
BCE
BDE
CDE 
```

* * *

## 回答 #74

> 赞同：0
> 
> 时间：2021-07-13T10:10:24.400

您可以使用 Asif 算法生成所有可能的组合。这可能是最简单和最有效的一种。你可以在[这里](https://sdah47.medium.com/generating-combinations-efficiently-with-asifs-algorithm-d453e803893#09eb-6dddd2657594)查看中篇文章。

让我们看一下 JavaScript 中的实现。

```
function Combinations( arr, r ) {
    // To avoid object referencing, cloning the array.
    arr = arr && arr.slice() || [];

    var len = arr.length;

    if( !len || r > len || !r )
        return [ [] ];
    else if( r === len ) 
        return [ arr ];

    if( r === len ) return arr.reduce( ( x, v ) => {
        x.push( [ v ] );

        return x;
    }, [] );

    var head = arr.shift();

    return Combinations( arr, r - 1 ).map( x => {
        x.unshift( head );

        return x;
    } ).concat( Combinations( arr, r ) );
}

// Now do your stuff.

console.log( Combinations( [ 'a', 'b', 'c', 'd', 'e' ], 3 ) ); 
```

* * *

## 回答 #75

> 赞同：-1
> 
> 时间：2012-09-16T12:53:19.387

[我在 C/C++ 中的实现](http://sss.chaoslab.ru/git/?p=misc.git;a=blob;f=main.cpp;h=a04b0db9b61ea67e4f5904702ca83481383ccb70;hb=080158c9c2eeb805eec9439cd01d0cb3e8c43d01)

```
#include <unistd.h>
#include <stdio.h>
#include <iconv.h>
#include <string.h>
#include <errno.h>
#include <stdlib.h>

int main(int argc, char **argv)
{
    int opt = -1, min_len = 0, max_len = 0;
    char ofile[256], fchar[2], tchar[2];
    ofile[0] = 0;
    fchar[0] = 0;
    tchar[0] = 0;
    while((opt = getopt(argc, argv, "o:f:t:l:L:")) != -1)
    {
            switch(opt)
            {
                    case 'o':
                    strncpy(ofile, optarg, 255);
                    break;
                    case 'f':
                    strncpy(fchar, optarg, 1);
                    break;
                    case 't':
                    strncpy(tchar, optarg, 1);
                    break;
                    case 'l':
                    min_len = atoi(optarg);
                    break;
                    case 'L':
                    max_len = atoi(optarg);
                    break;
                    default:
                    printf("usage: %s -oftlL\n\t-o output file\n\t-f from char\n\t-t to char\n\t-l min seq len\n\t-L max seq len", argv[0]);
            }
    }
if(max_len < 1)
{
    printf("error, length must be more than 0\n");
    return 1;
}
if(min_len > max_len)
{
    printf("error, max length must be greater or equal min_length\n");
    return 1;
}
if((int)fchar[0] > (int)tchar[0])
{
    printf("error, invalid range specified\n");
    return 1;
}
FILE *out = fopen(ofile, "w");
if(!out)
{
    printf("failed to open input file with error: %s\n", strerror(errno));
    return 1;
}
int cur_len = min_len;
while(cur_len <= max_len)
{
    char buf[cur_len];
    for(int i = 0; i < cur_len; i++)
        buf[i] = fchar[0];
    fwrite(buf, cur_len, 1, out);
    fwrite("\n", 1, 1, out);
    while(buf[0] != (tchar[0]+1))
    {
        while(buf[cur_len-1] < tchar[0])
        {
            (int)buf[cur_len-1]++;
            fwrite(buf, cur_len, 1, out);
            fwrite("\n", 1, 1, out);
        }
        if(cur_len < 2)
            break;
        if(buf[0] == tchar[0])
        {
            bool stop = true;
            for(int i = 1; i < cur_len; i++)
            {
                if(buf[i] != tchar[0])
                {
                    stop = false;
                    break;
                }
            }
            if(stop)
                break;
        }
        int u = cur_len-2;
        for(; u>=0 && buf[u] >= tchar[0]; u--)
            ;
        (int)buf[u]++;
        for(int i = u+1; i < cur_len; i++)
            buf[i] = fchar[0];
        fwrite(buf, cur_len, 1, out);
        fwrite("\n", 1, 1, out);
    }
    cur_len++;
}
fclose(out);
return 0;
} 
```

这是我在 C++ 中的实现，它将所有组合写入指定的文件，但是可以更改行为，我生成了各种字典，它接受最小和最大长度和字符范围，目前仅支持 ansi，它足以满足我的需要

* * *

## 回答 #76

> 赞同：-1
> 
> 时间：2016-12-27T11:27:04.553

我想介绍我的解决方案。没有递归调用，也没有嵌套循环`next`。代码的核心是`next()`方法。

```
public class Combinations {
    final int pos[];
    final List<Object> set;

    public Combinations(List<?> l, int k) {
        pos = new int[k];
        set=new ArrayList<Object>(l);
        reset();
    }
    public void reset() {
        for (int i=0; i < pos.length; ++i) pos[i]=i;
    }
    public boolean next() {
        int i = pos.length-1;
        for (int maxpos = set.size()-1; pos[i] >= maxpos; --maxpos) {
            if (i==0) return false;
            --i;
        }
        ++pos[i];
        while (++i < pos.length)
            pos[i]=pos[i-1]+1;
        return true;
    }

    public void getSelection(List<?> l) {
        @SuppressWarnings("unchecked")
        List<Object> ll = (List<Object>)l;
        if (ll.size()!=pos.length) {
            ll.clear();
            for (int i=0; i < pos.length; ++i)
                ll.add(set.get(pos[i]));
        }
        else {
            for (int i=0; i < pos.length; ++i)
                ll.set(i, set.get(pos[i]));
        }
    }
} 
```

以及用法示例：

```
static void main(String[] args) {
    List<Character> l = new ArrayList<Character>();
    for (int i=0; i < 32; ++i) l.add((char)('a'+i));
    Combinations comb = new Combinations(l,5);
    int n=0;
    do {
        ++n;
        comb.getSelection(l);
        //Log.debug("%d: %s", n, l.toString());
    } while (comb.next());
    Log.debug("num = %d", n);
} 
```

* * *

## 回答 #77

> 赞同：-1
> 
> 时间：2021-04-23T03:31:38.023

PowerShell 解决方案：

```
function Get-NChooseK
{
    <#
    .SYNOPSIS
    Returns all the possible combinations by choosing K items at a time from N possible items.

    .DESCRIPTION
    Returns all the possible combinations by choosing K items at a time from N possible items.
    The combinations returned do not consider the order of items as important i.e. 123 is considered to be the same combination as 231, etc.

    .PARAMETER ArrayN
    The array of items to choose from.

    .PARAMETER ChooseK
    The number of items to choose.

    .PARAMETER AllK
    Includes combinations for all lesser values of K above zero i.e. 1 to K.

    .PARAMETER Prefix
    String that will prefix each line of the output.

    .EXAMPLE
    PS C:\> Get-NChooseK -ArrayN '1','2','3' -ChooseK 3
    123

    .EXAMPLE
    PS C:\> Get-NChooseK -ArrayN '1','2','3' -ChooseK 3 -AllK
    1
    2
    3
    12
    13
    23
    123

    .EXAMPLE
    PS C:\> Get-NChooseK -ArrayN '1','2','3' -ChooseK 2 -Prefix 'Combo: '
    Combo: 12
    Combo: 13
    Combo: 23

    .NOTES
    Author : nmbell
    #>

    # Use cmdlet binding
    [CmdletBinding()]

    # Declare parameters
    Param
    (

        [String[]]
        $ArrayN

    ,   [Int]
        $ChooseK

    ,   [Switch]
        $AllK

    ,   [String]
        $Prefix = ''

    )

    BEGIN
    {
    }

    PROCESS
    {
        # Validate the inputs
        $ArrayN = $ArrayN | Sort-Object -Unique

        If ($ChooseK -gt $ArrayN.Length)
        {
            Write-Error "Can't choose $ChooseK items when only $($ArrayN.Length) are available." -ErrorAction Stop
        }

        # Control the output
        $firstK = If ($AllK) { 1 } Else { $ChooseK }

        # Get combinations
        $firstK..$ChooseK | ForEach-Object {

            $thisK = $_

            $ArrayN[0..($ArrayN.Length-($thisK--))] | ForEach-Object {
                If ($thisK -eq 0)
                {
                    Write-Output ($Prefix+$_)
                }
                Else
                {
                    Get-NChooseK -Array ($ArrayN[($ArrayN.IndexOf($_)+1)..($ArrayN.Length-1)]) -Choose $thisK -AllK:$false -Prefix ($Prefix+$_)
                }
            }

        }
    }

    END
    {
    }

} 
```

例如：

```
PS C:\>Get-NChooseK -ArrayN 'A','B','C','D','E' -ChooseK 3
ABC
ABD
ABE
ACD
ACE
ADE
BCD
BCE
BDE
CDE 
```

[IronScripter](https://ironscripter.us/another-powershell-math-challenge/)网站上最近发布了一个与此问题类似的挑战，您可以在其中找到我的链接和其他一些解决方案。

# visual-studio-2008 - 在衍生进程中捕获异常

> ID：127708
> 
> 赞同：2
> 
> 时间：2008-09-24T15:02:48.853
> 
> 标签：visual-studio-2008, debugging, exception

我正在使用 VS2008 调试启动新进程的应用程序。我相信生成的进程在其启动过程中会遭受（并处理）某种 CLR 异常，但不会通过在 Debug -> Exceptions 中打开 CLR 异常通知来捕获它。关于如何查看异常生成位置的任何建议？我通常只会附加到新生成的进程，但由于异常发生在启动时，所以没有足够的时间去做。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-24T15:08:08.233

您可以在进程启动代码中添加对 Debugger.Launch() 的调用。这将启动附加到进程的调试器（通常让您选择使用 VS2008 的运行副本或新副本）。同样的技巧对于调试服务启动问题也很方便。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-25T07:51:45.823

另一个值得考虑的技巧是使用“图像文件执行选项”，请查看 blogs.msdn.com 上的这篇文章：http: [//blogs.msdn.com/greggm/archive/2005/02/21/377663。 aspx](http://blogs.msdn.com/greggm/archive/2005/02/21/377663.aspx)因为这不需要对子可执行文件或父可执行文件进行任何更改。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-24T15:06:22.340

如果进程在启动期间失败，则 CreateProcess 应返回错误代码。检查错误代码。

如果进程在启动后直接失败，则检查进程返回码及其文档、日志等。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-24T15:07:49.903

那么你可以记录错误。但这不允许你看它。为此，您可能会考虑在异常处理程序中放置一个严重的延迟（或无限循环）。这将为您提供所有需要附加到进程并对其进行调试的时间。只要确保在投入生产之前将其删除！！

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-24T15:10:55.840

如果您可以控制此过程代码，请使用 Debugger.Launch()。

如果没有，请尝试：

只需从命令行启动此过程并查看输出。如果有未处理的异常，它将被显示。

如果它没有显示任何内容，请使用[命令行调试器](http://msdn.microsoft.com/en-us/library/ms229861.aspx)，并使用命令**ca[tch]**。

# java - 为什么“管道” CharBuffer 挂起？

> ID：127713
> 
> 赞同：0
> 
> 时间：2008-09-24T15:03:58.837
> 
> 标签：java, io, pipe

为什么以下方法会挂起？

```
公共无效管道（读入，写出）{
    CharBuffer buf = CharBuffer.allocate(DEFAULT_BUFFER_SIZE);
    而（in.read（buf）> = 0）{
      out.append(buf.flip());
    }
}

```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-24T15:07:41.370

回答我自己的问题：你必须在 s`buf.clear()`之间调用`read`。据推测，`read`是因为缓冲区已满而挂起。正确的代码是

```
公共无效管道（读入，写出）{
    CharBuffer buf = CharBuffer.allocate(DEFAULT_BUFFER_SIZE);
    而（in.read（buf）> = 0）{
      out.append(buf.flip());
      buf.clear();
    }
}

```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-24T15:08:45.377

我认为这是一个僵局。in.read(buf) 锁定 CharBuffer 并阻止 out.append(buf) 调用。

这是假设 CharBuffer 在实现中使用锁（某种）。API 对 CharBuffer 类有什么看法？

编辑：对不起，我的大脑短路了……我把它和别的东西弄混了。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-03-09T02:54:03.027

CharBuffers 不能像您期望的那样干净地与 Readers 和 Writers 一起工作。特别是没有`Writer.append(CharBuffer buf)`方法。问题片段调用的方法是`Writer.append(CharSequence seq)`，它只是调用`seq.toString()`. 该`CharBuffer.toString()`方法确实返回缓冲区的字符串值，但不会耗尽缓冲区。随后的调用`Reader.read(CharBuffer buf)`获得了一个已经满的缓冲区，因此返回 0，迫使循环无限期地继续。

尽管这感觉像是挂起，但实际上它是在每次通过循环时将第一次读取的缓冲区内容附加到写入器。因此，您要么开始在目的地看到大量输出，要么写入器的内部缓冲区会增长，具体取决于写入器的实现方式。

尽管很烦人，但我建议使用 char[] 实现，因为 CharBuffer 解决方案每次通过循环都会构建至少两个新的 char[] 。

```
public void pipe(Reader in, Writer out) throws IOException {
    char[] buf = new char[DEFAULT_BUFFER_SIZE];
    int count = in.read(buf);
    while( count >= 0 ) {
        out.write(buf, 0, count);
        count = in.read(buf);
    }
} 
```

如果您需要支持在两个字符编码之间进行转换，我建议仅使用它，否则即使您是管道字符，也最好使用 ByteBuffer/Channel 或 byte[]/IOStream 实现。

# asp.net - 如何验证列表框不为空（客户端）

> ID：127728
> 
> 赞同：3
> 
> 时间：2008-09-24T15:07:39.997
> 
> 标签：asp.net, validation, listbox, customvalidator

我正在使用 ASP.NET 3.5。我有一个用户必须添加项目的列表框（我已经为此编写了代码）。我的要求是必须将至少一项添加到列表框中，否则他们无法提交表单。我在页面上还有其他几个验证器，它们都写入 ValidationSummary 控件。我希望这个列表框验证也可以写入验证摘要控件。任何帮助是极大的赞赏。谢谢你。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-05T15:38:42.730

这对我不起作用：

```
function ListBoxValid(sender, args) 
{
        args.IsValid = sender.options.length > 0; 
} 
```

但这确实：

```
function ListBoxValid(sender, args)
{
        var ctlDropDown = document.getElementById(sender.controltovalidate);
        args.IsValid = ctlDropDown.options.length > 0; 
} 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-24T15:48:01.787

放入自定义验证器，向其中添加所需的错误消息，双击自定义验证器以获取事件处理程序背后的代码，然后您将像这样实现服务器端：

```
protected void CustomValidator1_ServerValidate(object source, ServerValidateEventArgs args) 
{
        args.IsValid = ListBox1.Items.Count > 0; 
} 
```

您也可以实现客户端javascript。

我只是把它放在一个页面上并快速测试它，所以你可能需要稍微调整一下：（button1 只将一个项目添加到列表框中）

```
<script language="JavaScript">
<!--
  function ListBoxValid(sender, args)
  {
      args.IsValid = sender.options.length > 0;
  }
// -->
</script>    
<asp:ListBox ID="ListBox1" runat="server"></asp:ListBox>
<asp:TextBox ID="TextBox1" runat="server"></asp:TextBox>
<asp:Button ID="Button1" runat="server" onclick="Button1_Click" Text="Button" ValidationGroup="NOVALID" />
<asp:Button ID="Button2" runat="server" Text="ButtonsUBMIT"  />

<asp:CustomValidator ID="CustomValidator1" runat="server" 
ErrorMessage="CustomValidator" 
onservervalidate="CustomValidator1_ServerValidate" ClientValidationFunction="ListBoxValid"></asp:CustomValidator> 
```

如果向页面添加验证摘要，如果 ListBox 或其他可收集控件中没有项目，则错误文本应显示在该摘要中，无论您想使用什么，只要 ValidationGroup 相同.

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2011-06-10T14:56:43.240

必须确保将这些属性添加到 CustomValidator：

```
Display="Dynamic" ValidateEmptyText="True" 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-05-03T17:41:39.220

实际上这是完成这项工作的正确方法（就 JavaScript 而言）。

ListBox.options.length 将始终是您的选项总数，而不是您选择的数量。我发现可行的唯一方法是使用 for 循环遍历列表。

```
function ListBoxValid(sender, args)
{

    var listBox = document.getElementById(sender.controltovalidate);

    var listBoxCnt = 0;

    for (var x =0; x<listBox.options.length; x++)
    {
        if (listBox.options[x].selected) listBoxCnt++;
    }

    args.IsValid = (listBoxCnt>0)

} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-20T22:49:33.237

```
<asp:CustomValidator 
     runat="server" 
     ControlToValidate="listbox1"
     ErrorMessage="Add some items yo!" 
     ClientValidationFunction="checkListBox"
/>

<script type="Text/JavaScript">
  function checkListBox(sender, args)
  {
      args.IsValid = sender.options.length > 0;
  }
</script> 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2016-11-17T08:52:57.653

这对我有用

```
<script language="JavaScript">
  function CheckListBox(sender, args)
  {
      args.IsValid = document.getElementById("<%=ListBox1.ClientID%>").options.length > 0;
  }
</script>    
<asp:ListBox ID="ListBox1" runat="server"></asp:ListBox>
<asp:CustomValidator ID="CustomValidator1" runat="server" 
ErrorMessage="*Required" ClientValidationFunction="CheckListBox"></asp:CustomValidator> 
```

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2008-09-24T15:17:13.080

您将希望通过发送 ClientID 向页面注册您的控件。然后，您可以使用 Microsoft AJAX 来获取您的控制权并检查值。

# python - 如何实现具有非本地平等的装饰器？

> ID：127736
> 
> 赞同：2
> 
> 时间：2008-09-24T15:08:50.213
> 
> 标签：python, decorator, multiple-inheritance

问候，目前我正在重构我的一个程序，我发现了一个有趣的问题。

我在自动机中有过渡。转换总是有一个开始状态和一个结束状态。一些转换有一个标签，它对遍历时必须执行的某个动作进行编码。没有标签就意味着没有行动。一些转换有一个条件，必须满足才能遍历这个条件，如果没有条件，则转换基本上是 NFA 中的 epsilon-transition 并且将在不消耗输入符号的情况下进行遍历。

我需要以下操作：

*   检查转换是否有标签
*   得到这个标签
*   为过渡添加标签
*   检查转换是否有条件
*   得到这个条件
*   检查平等

从前五点来看，这听起来像是一个清晰的装饰器，有一个基本的过渡和两个装饰器：Labeled 和 Condition。但是，这种方法有一个问题：如果两个转换的开始状态和结束状态相同，则两个转换被认为是相等的，两个转换处的标签相等（或不存在）并且两个条件相同（或不存在） . 使用装饰器，我可能有两个转换 Labeled("foo", Conditional("bar", Transition("baz", "qux"))) 和 Conditional("bar", Labeled("foo", Transition("baz) ", "qux"))) 需要非局部相等，也就是说，装饰器需要收集所有数据，并且转换必须在集合基础上比较这些收集的数据：

```
class Transition(object):
    def __init__(self, start, end):
        self.start = start
        self.end = end
    def get_label(self):
        return None
    def has_label(self):
        return False
    def collect_decorations(self, decorations):
        return decorations
    def internal_equality(self, my_decorations, other):
        try:
            return (self.start == other.start
                    and self.end == other.end
                    and my_decorations = other.collect_decorations())
    def __eq__(self, other):
        return self.internal_equality(self.collect_decorations({}), other)

class Labeled(object):
    def __init__(self, label, base):
        self.base = base
        self.label = label
    def has_label(self):
        return True
    def get_label(self):
        return self.label
    def collect_decorations(self, decorations):
        assert 'label' not in decorations
        decorations['label'] = self.label
        return self.base.collect_decorations(decorations)
    def __getattr__(self, attribute):
        return self.base.__getattr(attribute) 
```

这是一种干净的方法吗？我错过了什么吗？

我很困惑，因为我可以使用协作多重继承来解决这个问题——使用更长的类名：

```
class Transition(object):
    def __init__(self, **kwargs):
        # init is pythons MI-madness ;-)
        super(Transition, self).__init__(**kwargs)
        self.start = kwargs['start']
        self.end = kwargs['end']
    def get_label(self):
        return None
    def get_condition(self):
        return None
    def __eq__(self, other):
        try:
            return self.start == other.start and self.end == other.end
        except AttributeError:
            return False

class LabeledTransition(Transition):
    def __init__(self, **kwargs):
        super(LabeledTransition).__init__(**kwargs)
        self.label = kwargs['label']
    def get_label(self):
        return self.label
    def __eq__(self):
        super_result = super(LabeledTransition, self).__eq__(other)
        try:
            return super_result and self.label == other.label
        except AttributeError:
            return False

class ConditionalTransition(Transition):
    def __init__(self, **kwargs):
        super(ConditionalTransition, self).__init__(**kwargs)
        self.condition = kwargs['condition']

    def get_condition(self):
        return self.condition

    def __eq__(self, other):
        super_result = super(ConditionalTransition, self).__eq__(other)
        try:
            return super_result and self.condition = other.condition
        except AttributeError:
            return False

# ConditionalTransition about the same, with get_condition
class LabeledConditionalTransition(LabeledTransition, ConditionalTransition):
    pass 
```

LabledConditionalTransition 类的行为与预期完全一样——并且没有代码很吸引人，我不认为 MI 在这种大小下会令人困惑。

当然，第三种选择是将所有东西都锤入一个带有一堆 in has_label/has_transition 的转换类中。

所以......我很困惑。我错过了什么吗？哪个实现看起来更好？你如何处理类似的情况，即看起来像装饰器的对象可以处理它们，但是，这样的非本地方法出现了？

*编辑*：添加了 ConditionalTransition 类。基本上，这有点像装饰器，减去创建装饰器的顺序，过渡检查开始和结束是否正确，LabeledTransition 类检查标签是否正确，ConditionalTransition 检查条件是否正确。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-20T17:53:19.683

我认为很明显没有人真正理解你的问题。我建议将其放在上下文中并使其更短。例如，这是python中状态模式的一种可能实现，请研究它以获得一个想法。

```
class State(object):
    def __init__(self, name):
        self.name = name

    def __repr__(self):
        return self.name

class Automaton(object):
    def __init__(self, instance, start):
        self._state = start
        self.transitions = instance.transitions()

    def get_state(self):
        return self._state

    def set_state(self, target):
        transition = self.transitions.get((self.state, target))
        if transition:
            action, condition = transition
            if condition:
                if condition():
                    if action:
                        action()
                    self._state = target
            else:
                self._state = target
        else:
            self._state = target

    state = property(get_state, set_state)

class Door(object):
    open = State('open')
    closed = State('closed')

    def __init__(self, blocked=False):
        self.blocked = blocked

    def close(self):
        print 'closing door'

    def do_open(self):
        print 'opening door'

    def not_blocked(self):
        return not self.blocked

    def transitions(self):
        return {
            (self.open, self.closed):(self.close, self.not_blocked),
            (self.closed, self.open):(self.do_open, self.not_blocked),
        }

if __name__ == '__main__':
    door = Door()
    automaton = Automaton(door, door.open)

    print 'door is', automaton.state
    automaton.state = door.closed
    print 'door is', automaton.state
    automaton.state = door.open
    print 'door is', automaton.state
    door.blocked = True
    automaton.state = door.closed
    print 'door is', automaton.state 
```

该程序的输出将是：

```
door is open
closing door
door is closed
opening door
door is open
door is open 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-24T15:52:11.123

从发布的代码来看，Transition 和 Labeled Transition 之间的唯一区别是 get_lable() 和 has_label() 的返回。在这种情况下，您可以将这两个压缩为一个将标签属性设置为 None 和

```
return self.label is not None 
```

在 has_label() 函数中。

你可以发布`ConditionalTransition`课程的代码吗？我认为这会更清楚。

# php - 任何人都可以使用 json_encode 和 json_decode 来解释这个 PHP 代码吗？

> ID：127739
> 
> 赞同：2
> 
> 时间：2008-09-24T15:09:20.460
> 
> 标签：php, json

```
 $a = '{ "tag": "<b></b>" }';
  echo json_encode( json_decode($a) ); 
```

这输出：

```
{"tag":"<b><\/b>"} 
```

当您认为它会准确输出输入时。出于某种原因 json_encode 添加了一个额外的斜杠。

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-09-24T15:14:27.673

因为它是 JSON 标准的一部分

[http://json.org/](http://json.org/)

> 字符
> 
> ```
> any-Unicode-character-
>     except-"-or-\-or-
>     control-character
> \"
> \\
> \/ <---- see here?
> \b
> \f
> \n
> \r
> \t
> \u four-hex-digits 
> ```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2018-01-08T10:41:24.397

用这个：

```
echo json_encode($a,JSON_HEX_TAG) 
```

结果将是：

```
["\u003C\u003E"] 
```

你可以阅读这篇文章来提高你对 JSON_ENCODE 的知识 [http://php.net/manual/en/function.json-encode.php](http://php.net/manual/en/function.json-encode.php)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-24T15:16:32.393

这可能是一个安全功能。转义版本（例如输出）将被 Javascript 解析为类似于未转义版本（例如`\/`变成`/`）。像这样逃脱了斜线后，浏览器将 Javascript 字符串误解为 HTML 的可能性较小。当然，如果您正确处理数据，则不需要这样做，因此它更多的是防止笨拙的程序员为自己搞砸事情。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-24T22:10:05.723

您的输入不是有效的 JSON，但 PHP 的 JSON 解析器（像大多数 JSON 解析器一样）无论如何都会解析它。

# java - “管道”的 Java 习语

> ID：127753
> 
> 赞同：9
> 
> 时间：2008-09-24T15:11:16.650
> 
> 标签：java, io, pipe

是否有比以下更简洁/标准的习语（例如，JDK 方法）用于将输入“管道”到 Java 中的输出？

```
public void pipe(Reader in, Writer out) {
    CharBuffer buf = CharBuffer.allocate(DEFAULT_BUFFER_SIZE);
    while (in.read(buf) >= 0 ) {
        out.append(buf.flip());
        buf.clear();
    }
} 
```

[编辑] 请注意`Reader`and `Writer`are *given*。正确答案将演示如何采用`in`和`out`形成管道（最好不超过 1 或 2 个方法调用）。我会接受答案 where `in`and `out`are an `InputStream`and an `OutputStream`（最好是从/到`Reader`/的转换`Writer`）。`in`如果or`out`是/或/的*子类*，我将不接受答案。`Reader``InputStream``Writer``OutputStrem`

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-12-01T19:10:48.607

来自 Apache Commons 项目的 IOUtils 有许多[实用的](http://commons.apache.org/io/)[方法](http://commons.apache.org/io/api-1.4/org/apache/commons/io/IOUtils.html)可以完全满足您的需求。

`IOUtils.copy(in, out)`将对所有输入执行缓冲复制到输出。如果您的代码库中有多个地方需要`Stream`或`Reader`/`Writer`处理，则使用 IOUtils 可能是一个好主意。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-24T15:15:27.093

查看同一包中的[java.io.PipedInputStream](http://java.sun.com/javase/6/docs/api/java/io/PipedInputStream.html)和[PipedOutputStream](http://java.sun.com/javase/6/docs/api/java/io/PipedOutputStream.html)或[PipedReader](http://java.sun.com/javase/6/docs/api/java/io/PipedReader.html) / [PipedWriter](http://java.sun.com/javase/6/docs/api/java/io/PipedWriter.html)。

从 PipedInputStream 的文档中：

*管道输入流应该连接到管道输出流；然后，管道输入流提供写入管道输出流的任何数据字节。通常，数据由一个线程从 PipedInputStream 对象读取，数据由其他线程写入相应的 PipedOutputStream。不建议尝试从单个线程中使用这两个对象，因为它可能会使线程死锁。管道输入流包含一个缓冲区，在限制范围内将读取操作与写入操作分离。如果向连接的管道输出流提供数据字节的线程不再活动，则称该管道已损坏。*

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-24T19:11:17.290

唯一可用的优化是通过 NIO API 中的 FileChannels：[Reads](http://java.sun.com/javase/6/docs/api/java/nio/channels/FileChannel.html#transferFrom(java.nio.channels.ReadableByteChannel,%20long,%20long))、[Writes](http://java.sun.com/javase/6/docs/api/java/nio/channels/FileChannel.html#transferTo(long,%20long,%20java.nio.channels.WritableByteChannel))。JVM 可以优化此调用以将数据从文件移动到目标通道，而无需首先将数据移动到内核空间。有关详细信息，请参阅[本文](http://www.ibm.com/developerworks/library/j-zerocopy/index.html)。

# php - 在 OS X 上使用 Aptana Studio 和 Xdebug 或 Zend 调试器进行 PHP 调试

> ID：127761
> 
> 赞同：3
> 
> 时间：2008-09-24T15:12:24.697
> 
> 标签：php, debugging, macos, aptana, xdebug

您是否设法让 Aptana Studio 调试工作？我尝试遵循此操作，但在我的菜单中没有看到`Windows -> Preferences -> Aptana -> Editors -> PHP -> PHP Interpreters`（我已`PHP plugin`安装），并且在我尝试调试时，任何设置服务器菜单的尝试都会给我“套接字错误”。`Xdebug`已安装，通过确认`php info`。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-25T06:29:04.213

我一直在使用 ZendDebugger 和 Eclipse（在 OS X 上）有一段时间了，它工作得很好！

这是对我很有效的食谱。

1.  通过“一体化”包安装 Eclipse PDT：[http ://www.zend.com/en/community/pdt](http://www.zend.com/en/community/pdt)
2.  安装 ZendDebugger.so ( [http://www.zend.com/en/community/pdt](http://www.zend.com/en/community/pdt) )
3.  使用 ZendDebugger 扩展配置您的 php.ini（信息如下）

配置 ZendDebugger：

1.  编辑 php.ini
2.  添加以下内容：

    [Zend]
    zend_extension=/full/path/to/ZendDebugger.so
    zend_debugger.allow_hosts=127.0.0.1
    zend_debugger.expose_remotely=总是
    zend_debugger.connector_port=10013

现在在命令行中运行“php -m”来输出所有安装的模块。如果您看到以下内容，那么它安装得很好

```
[Zend Modules]  
Zend Debugger 
```

现在重新启动 Apache，以便它使用 ZendDebugger 重新加载 PHP。在其中创建一个虚拟页面并检查输出以确保 PHP apache 模块也选择了 ZendDebugger。如果设置正确，您将在 phpinfo() 的输出中的某处看到类似于以下文本的内容。

> Zend Debugger v5.2.14，版权所有 (c) 1999-2008，由 Zend Technologies 提供

好的 - 但您想要 Aptana Studio...此时我将 Aptana Studio 插件安装到 Eclipse 的 PDT 构建中。相关说明位于： http: [//www.aptana.com/docs/index.php/Plugging_Aptana_into_an_existing_Eclipse_configuration](http://www.aptana.com/docs/index.php/Plugging_Aptana_into_an_existing_Eclipse_configuration)

该设置已经为我服务了一段时间 - 希望它也可以帮助你

-阿林

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-24T17:43:37.673

这与 Aptana Studio 无关，但如果您正在寻找 OS X 上的 PHP XDebug 调试器客户端，您可以尝试[MacGDBp](http://www.bluestatic.org/software/macgdbp/)（免费/GPL）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-02-08T14:53:11.190

我意识到这是一个旧线程，但我在使用 Aptana Studio 3 和 FireFox 时遇到了同样的问题。如果有人遇到这个问题，请确保 FireFox 安装了 FireBug **V1.8.X**，任何其他版本都可能给你同样的问题......

希望这可以帮助

# unix - 如何在 solaris 中为进程预分配内存？

> ID：127771
> 
> 赞同：1
> 
> 时间：2008-09-24T15:13:57.547
> 
> 标签：unix, memory, solaris

我的问题是：

我有一个使用大量内存的 perl 脚本（由于缓存的预期行为）。但是，我注意到我做的缓存越多，它变得越慢，并且该过程大部分时间都处于睡眠模式。

我认为为进程预先分配内存可能会提高性能。

有人在这里有什么想法吗？

**更新**：

我想我在这里不是很清楚。我将更清楚地提出问题：

我不是在寻找在 perl 脚本中进行预分配的方法。我认为这对我没有多大帮助。我感兴趣的是一种告诉操作系统为我的 perl 脚本分配 X 内存量的方法，这样它就不必与以后进入的其他进程竞争。

假设我无法摆脱内存使用。虽然，我也在探索减少这种情况的方法，但不要指望那里有太大的改善。仅供参考，我正在使用 solaris 10 机器。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-27T00:25:00.020

我从您的帖子和评论中收集到的是：

*   当内存使用量增加时，您的程序会变慢
*   你的程序越来越多地花时间睡觉，而不是计算。

最可能的解释：睡眠意味着等待资源可用。在这种情况下，资源最有可能是内存。使用 vmstat 1 命令进行验证。看看 sr 列。如果它持续超过约 150，系统将不顾一切地释放页面以满足需求。这伴随着 pi、po 和 fr 列的高活性。

如果确实如此，您的最佳选择是：

*   升级系统内存以满足需求
*   将内存使用量减少到适合当前系统的水平。

预分配内存无济于事。在任何一种情况下，内存需求都会在某个时候超过可用的主内存。然后内核必须决定哪些页面现在需要在内存中，哪些页面可以被清除并重新用于更迫切需要的页面。如果所有经常需要的页面（工作集）都超过了主内存的大小，则系统会不断地将页面从二级存储（交换）移动到二级存储（交换）。然后，系统被认为是颠簸，并没有花太多时间做有用的工作。除了增加内存或减少使用内存之外，您对此无能为力。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-26T19:17:43.083

来自评论：

> 内存限制不是很严重，但内存占用很容易增长到 GB，当我们有竞争内存的进程时，它会变得非常慢。我想从操作系统中保留一些内存，这样即使有太多其他进程来了，抖动也很小。贾格马尔

那我们换个思路吧。问题并不在于您的 Perl 脚本。相反，机器上的所有进程都消耗太多内存，机器无法按照配置进行处理。

您可以“保留”内存，但这并不能防止颠簸。事实上，它可能会使问题变得更糟，因为操作系统不会知道您是在使用内存还是只是将其保存以备后用。

我怀疑你正在遭受[公地悲剧](http://en.wikipedia.org/wiki/Tragedy_of_the_commons)。我对很多其他用户在有问题的机器上是对的吗？如果是这样，这更像是一个社会问题而不是技术问题。您需要有人（可能是系统管理员）介入并协调机器上的所有进程。他们应该找到最奢侈的内存消耗者，并与他们的程序员一起减少系统资源的成本。此外，他们应该安排要调度的进程，以便资源分配是有效的。最后，他们可能需要获得更多或改进的硬件来处理预期的系统负载。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-24T15:16:21.583

你可能会问自己一些问题：

*   我的数据结构对手头的任务真的有用吗？
*   我真的需要缓存那么多吗？
*   我可以在一段时间后丢弃缓存的数据吗？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-24T15:32:54.663

看看[http://metacpan.org/pod/Devel::Size](http://metacpan.org/pod/Devel::Size)

您也可以内联 ac 函数来执行上述操作。

据我所知，您不能直接从 Perl 分配内存。您可以通过编写 XS 模块或使用我提到的内联 C 函数来解决此问题。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-24T15:46:34.037

```
my @array;
$#array = 1_000_000; # pre-extend array to one million elements,
                     # http://perldoc.perl.org/perldata.html#Scalar-values

my %hash;
keys(%hash) = 8192; # pre-allocate hash buckets 
                    # (same documentation section) 
```

不熟悉您的代码，我会在这里冒险一些疯狂的猜测 [笑] 这些技术不会为您的脚本提供新的高效率，但预分配可能会有所帮助。

祝你好运！

——道格拉斯·亨特

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-24T16:22:30.847

我最近重新发现了一篇很棒的[Randal L. Schwartz 文章](http://www.stonehenge.com/merlyn/UnixReview/col26.html)，其中包括预分配数组。假设这是您的问题，您可以使用该代码的变体来测试预分配。但一定要测试结果。

脚本因更多缓存而变慢的原因可能是[thrashing](http://en.wikipedia.org/wiki/Thrash_(computer_science))。大概缓存的原因首先是为了提高性能。所以一个快速的答案是：减少缓存。

现在可能有一些方法可以修改您的缓存方案，以便它使用更少的主内存并避免抖动。例如，您可能会发现缓存到文件或数据库而不是内存可以提高性能。我发现文件系统和数据库缓存比应用程序缓存更有效，并且可以在多个实例之间共享。

另一个想法可能是更改您的算法以减少其他区域的内存使用量。例如，不是将整个文件拉入内存，Perl 程序往往会更好地逐行读取。

最后，你探索[过 Memoize 模块](http://perl.plover.com/Memoize/)吗？它可能不会立即适用，但它可能是想法的来源。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-25T12:38:32.953

我还没有找到一种方法来做到这一点。

但是，我发现（有关详细信息，请参阅[此](http://perldoc.perl.org/perlfaq3.html#How-can-I-free-an-array-or-hash-so-my-program-shrinks%3f)）

> 分配给词法（即 my() 变量）的内存即使超出范围也无法回收或重用。它被保留以防变量返回范围。分配给全局变量的内存可以通过使用 undef()ing 和/或 delete() 重用（在您的程序中）。

所以，我相信这里的一种可能性是检查我是否可以在给定的时间点减少词汇变量的总内存打印。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-25T15:27:40.643

听起来您正在寻找*limit*或*ulimit*。但我怀疑这会导致超出限制的脚本失败，这可能不是你想要的。

更好的想法可能是在进程之间共享缓存数据。根据我的经验，将数据放入数据库或文件中效果很好。

我不想这么说，但是如果您的内存限制如此严重，那么 Perl 可能不是该应用程序的正确语言。我认为C将是一个更好的选择。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-01T06:49:20.283

您可以做的一件事是使用 solaris 区域（容器）。
您可以将您的进程放在一个区域中并为其分配 RAM 和 CPU 等资源。
以下是一些教程的两个链接：

1.  [Solaris 容器如何指导](http://www.sun.com/software/solaris/howtoguides/containersLowRes.jsp "Solaris 容器如何指导")
2.  [Solaris 10 08/07 操作系统中的区域资源控制](http://www.sun.com/bigadmin/content/submitted/zone_resource_control.jsp)

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-01-12T00:29:34.050

虽然它没有按照您的要求进行预分配，但您可能还想查看大页面大小选项，以便当 perl 必须向操作系统要求为您的程序提供更多内存时，它会以更大的块获取它。

请参阅[Solaris Internals：Multiple Page Size Support](http://www.solarisinternals.com/wiki/index.php/Multiple_Page_Size_Support)以获取有关其产生的差异以及如何做到这一点的更多信息。

# c# - 在哪里可以找到 C# 语言规范？

> ID：127776
> 
> 赞同：12
> 
> 时间：2008-09-24T15:14:35.673
> 
> 标签：c#, visual-studio

在哪里可以找到各种 C# 语言的规范？

*（编辑：似乎人们投了反对票，因为你可以“谷歌”这个，但是，我的初衷是用谷歌上找不到的信息给出答案。我已经接受了最好的谷歌结果的答案，因为它们与没买过VS的人）*

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-09-24T15:19:06.163

[微软的版本](http://msdn.microsoft.com/en-us/vcsharp/aa336809.aspx)（可能是你想要的）

[正式的标准化版本](http://www.ecma-international.org/publications/standards/Ecma-334.htm)（通过 ECMA，创建只是为了让他们可以说它是由某个外部机构“标准化”的。即使 ECMA“标准”实际上是“插入现金，出售标准”）。

[更多 ECMA 标准](http://www.ecma-international.org/publications/standards/Stnindex.htm)

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-09-24T15:15:29.197

如果您有 Visual Studio 2005 或 2008，它们已经在您的计算机上！

2005 年（英文）：

```
.\Microsoft Visual Studio 8\VC#\Specifications\1033 
```

2008 年（英文）：

```
.\Microsoft Visual Studio 9.0\VC#\Specifications\1033 
```

2010 年（英文）：

```
.\Microsoft Visual Studio 10.0\VC#\Specifications\1033 
```

2012 年（英文）：

```
.\Microsoft Visual Studio 11.0\VC#\Specifications\1033 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-24T15:16:27.433

使用谷歌找到：

[http://msdn.microsoft.com/en-us/vcsharp/aa336809.aspx](http://msdn.microsoft.com/en-us/vcsharp/aa336809.aspx)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-24T15:19:11.903

C# 语言是 ISO 标准，因此可以从 ISO 网站获取规范：[http ://www.iso.org/iso/iso_catalogue/catalogue_tc/catalogue_detail.htm?csnumber=42926](http://www.iso.org/iso/iso_catalogue/catalogue_tc/catalogue_detail.htm?csnumber=42926)

您也可以直接从 Microsoft 获取规范**（.Doc 警告）** [http://download.microsoft.com/download/3/8/8/388e7205-bc10-4226-b2a8-75351c669b09/CSharp%20Language%20Specification.doc](http://download.microsoft.com/download/3/8/8/388e7205-bc10-4226-b2a8-75351c669b09/CSharp%20Language%20Specification.doc) **（ .Doc 警告）**

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-24T15:15:32.803

来自：http: [//msdn.microsoft.com/en-us/vcsharp/aa336809.aspx](http://msdn.microsoft.com/en-us/vcsharp/aa336809.aspx)

.doc 格式：

[http://download.microsoft.com/download/3/8/8/388e7205-bc10-4226-b2a8-75351c669b09/CSharp%20Language%20Specification.doc](http://download.microsoft.com/download/3/8/8/388e7205-bc10-4226-b2a8-75351c669b09/CSharp%20Language%20Specification.doc)

# sql - 每个 DDL SQL 命令都是可逆的吗？【数据库版本控制】

> ID：127780
> 
> 赞同：3
> 
> 时间：2008-09-24T15:14:58.373
> 
> 标签：sql, version-control, migration, ddl

我想设置一种机制来跟踪数据库架构更改，例如[此答案](https://stackoverflow.com/questions/1607/mechanisms-for-tracking-db-schema-changes#1666)中描述的机制：

> 对于您对数据库所做的每一次更改，您都会编写一个新的迁移。迁移通常有两种方法：应用更改的“向上”方法和撤消更改的“向下”方法。单个命令使数据库保持最新，也可用于将数据库带入特定版本的模式。

我的问题如下：“向上”方法中的每个 DDL 命令是否可逆？换句话说，我们可以一直提供一个“down”的方法吗？你能想象任何不能“关闭”的 DDL 命令吗？

请不要考虑典型的数据迁移问题，在“向上”方法期间我们会丢失数据：例如，将字段类型从`datetime`( `DateOfBirth`) 更改为`int`( `YearOfBirth`)，我们会丢失无法恢复的数据。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-24T15:16:28.307

在 sql server 中，我知道的每个 DDL 命令都是一个向上/向下对。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-24T15:22:47.747

除了数据丢失之外，我所做的每一次迁移都是可逆的。也就是说，Rails 提供了一种将迁移标记为“破坏性”的方法：

> 某些转换以无法逆转的方式具有破坏性。这种迁移应该在其 down 方法中引发 ActiveRecord::IrreversibleMigration 异常。

[请参阅此处](http://api.rubyonrails.org/classes/ActiveRecord/Migration.html)的 API 文档。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-24T17:58:20.210

是的，您已经确定了丢失数据的情况，无论是通过转换它还是在“向上”迁移中简单地 DROP COLUMN。

另一个例子是你可以删除一个 SEQUENCE 对象，从而失去它的状态。“向下”迁移将重新创建序列，但它会从 1 重新开始。这可能会导致序列生成重复值。如果您在空数据库上执行迁移，并且您希望序列从 1 开始，这不是问题，但是如果您有一定数量的数据行，您希望将序列重置为最大值当前正在使用，这很难可靠地完成，除非您对该表具有排他锁。

任何其他依赖于数据库中数据状态的 DDL 都有类似的问题。首先，这可能不是一个好的架构设计，我只是想考虑任何适合您问题的案例。

# asp.net - ASP.NET 中自定义组合中的子控件初始化

> ID：127794
> 
> 赞同：4
> 
> 时间：2008-09-24T15:16:11.910
> 
> 标签：asp.net, controls, custom-server-controls

我正在处理的一系列控件的一部分显然涉及我将其中的一些组合在一起。我很快开始了解到这需要考虑（这对我来说是全新的！）:)

我基本上有一个`StyledWindow`控件，它本质上是一个`Panel`具有执行其他位（如添加边框等）的能力的荣耀。

这是在其中实例化子控件的代码。到目前为止，它似乎一直在使用普通的静态控件正常工作：

```
 protected override void CreateChildControls()
    {
        _panel = new Panel();

        if (_editable != null)
            _editable.InstantiateIn(_panel);

        _regions = new List<IAttributeAccessor>();
        _regions.Add(_panel);
    } 
```

今天当我尝试在其中嵌套一个更复杂的控件时，问题就来了。该控件使用对页面的引用，因为它注入了 JavaScript 以使其更加灵活和响应迅速（这`RegisterClientScriptBlock`是我需要页面引用的唯一原因）。

现在，这导致了“object null”错误，但我将其本地化为 render 方法，它当然试图针对 [null]`Page`对象调用该方法。

令我困惑的是，该控件作为独立的控件可以正常工作，但是当放置在其中时`StyledWindow`，一切都变得非常错误！

**所以，看起来我在 my`StyledWindow`或`ChildControl`. 有任何想法吗？**

## 更新

正如[Brad Wilson](https://stackoverflow.com/questions/127794/child-control-initialization-in-custom-composite-in-aspnet#127824)非常正确地指出的那样，您看不到控件被添加到`Controls`集合中。这就是`_panel`它的用途，它是为我处理的，基本上然后覆盖`Controls`（我从某处的指南中得到这个）：

```
 Panel _panel;    // Sub-Control to store the "Content".
    public override ControlCollection Controls
    {
        get
        {
            EnsureChildControls();
            return _panel.Controls;
        }
    } 
```

我希望这有助于澄清事情。道歉。

## 按照[Longhorn213 的回答更新](https://stackoverflow.com/questions/127794/child-control-initialization-in-custom-composite-in-aspnet#128299)

是的，我一直在玩控件，将一个放在复合材料中，一个放在外面。然后我在控件生命周期中的 event major event 中获取 Page 的状态并将其呈现到页面。

独立运行正常，页面按预期启动。但是，嵌套在 Composite 中的那个是不同的。它的`OnLoad`事件根本没有被解雇！所以我猜布拉德可能是对的，因为我没有正确设置控制层次结构，任何人都可以就我所缺少的内容提供一些建议吗？Panel方法还不够吗？（好吧，显然不是吗？！）：D

谢谢你们的帮助，不胜感激：）

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-24T15:19:25.867

我没有看到您将控件添加到任何地方的 Controls 集合中，这可以解释为什么他们无法访问页面（因为它们从未被正式放置在页面上）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-24T16:46:41.677

我总是将 JavaScript 调用放在 OnLoad 函数上。比如下面。

```
protected override void OnLoad(EventArgs e)
{

    // Do something to get the script
    string script = GetScript();

    this.Page.ClientScript.RegisterClientScriptBlock(this.Page.GetType(), "SomeJavaScriptName", script);

    // Could also use this function to determine if the script has been register. i.e. more than 1 of the controls exists
    this.Page.ClientScript.IsClientScriptBlockRegistered("SomeJavaScriptName");

    base.OnLoad(e);
} 
```

如果您仍然想进行渲染，那么您可以在响应中编写脚本。这就是 RegisterScriptBlock 所做的，它只是将脚本内嵌在页面上。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-25T13:41:47.590

# 解决了！

对，我今天下定决心要破解这个！以下是我的想法：

*   我认为使用`Panel`是一种 hack，所以我应该删除它并找出它是如何完成的。
*   我不想做类似`MyCtl.Controls[0].Controls`访问添加到组合中的控件之类的事情。
*   我想让这该死的东西工作！

所以，我搜索并点击了[MSDN](http://msdn.microsoft.com/)，[这篇文章](http://msdn.microsoft.com/en-us/library/aa478964(printer).aspx)**真的**很有帮助（即几乎复制“n”粘贴，并且解释得很好——MSDN 传统上不擅长的东西）。好的！

所以，我去掉了使用，`Panel`几乎遵循了文章，把它当作福音，边做边做笔记。

这是我现在拥有的：

*   我了解到我使用了错误的术语。我应该称它为***Templated Control***。虽然模板化控件在技术上是复合的，但有明显的区别。模板化控件可以定义添加到它们的项目的界面。
*   模板化控件非常强大，而且一旦你开始了解它们，实际上设置起来非常快速和容易！
*   我会在设计师的支持下多玩一些，以确保我完全理解这一切，然后写一篇博文：）
*   “模板”控件用于指定模板数据的接口。

例如，下面是模板化控件的 ASPX 标记：

```
<cc1:TemplatedControl ID="MyCtl" runat="server">
    <Template>
        <!-- Templated Content Goes Here -->
    </Template>
</cc1:TemplatedControl> 
```

### 这是我现在拥有的代码

```
public class DummyWebControl : WebControl
{
    // Acts as the surrogate for the templated controls.
    // This is essentially the "interface" for the templated data.
} 
```

在 TemplateControl.cs...

```
 ITemplate _template;
    // Surrogate to hold the controls instantiated from 
    // within the template.
    DummyWebControl _owner;

    protected override void CreateChildControls()
    {
        // Note we are calling base.Controls here
        // (you will see why in a min).
        base.Controls.Clear();
        _owner = new DummyWebControl();

        // Load the Template Content
        ITemplate template = _template;
        if (template == null)
            template = new StyledWindowDefaultTemplate();
        template.InstantiateIn(_owner);

        base.Controls.Add(_owner);
        ChildControlsCreated = true;
    } 
```

然后，提供对 [Surrogate] 对象的控件的轻松访问：

（这就是我们需要清除/添加到 base.Controls 的原因）

```
 public override ControlCollection Controls
    {
        get
        {
            EnsureChildControls();
            return _owner.Controls;
        }
    } 
```

差不多就是这样，当你知道怎么做时很容易！:)

**Next:**设计时区域支持！

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-25T09:48:54.060

是的，我开始玩了，我发现我的控件实例化有问题，因为 Longhorn 是对的，我应该能够`OnLoad`（但我不能）创建脚本引用，而 Brad 是对的，我需要确保我的层次结构是通过添加到复合集合中`Controls`来维护的。`Controls`

所以，我在这里有两件事：

1.  我已经重写了`Controls`组合的属性访问器以返回 this`Panel`的 Controls 集合，因为我不想去`ctl.Controls[0].Controls[0]`获得我想要的实际控件。**我已将其删除，但我需要对其进行排序。**
2.  我没有添加`Panel`到`Controls`集合中，**我现在已经这样做了。**

所以，它现在可以工作了，但是，**我如何获得`Controls`复合材料的属性以返回 中的项目`Panel`，而不是`Panel`本身？**

# python - 如何解析 ISO 8601 格式的日期？

> ID：127803
> 
> 赞同：803
> 
> 时间：2008-09-24T15:17:00.053
> 
> 标签：python, datetime, iso8601, datetime-parsing, rfc3339

我需要将[RFC 3339](https://www.rfc-editor.org/rfc/rfc3339)字符串解析`"2008-09-03T20:56:35.450686Z"`为 Python 的`datetime`类型。

我[`strptime`](https://docs.python.org/library/datetime.html#datetime.datetime.strptime)在Python标准库里找过，但不是很方便。

做这个的最好方式是什么？

* * *

## 回答 #1

> 赞同：592
> 
> 时间：2013-03-05T15:44:16.223

# `isoparse`来自*python-dateutil 的函数*

[*python-dateutil*](https://pypi.python.org/pypi/python-dateutil)包[`dateutil.parser.isoparse`](https://dateutil.readthedocs.io/en/stable/parser.html#dateutil.parser.isoparse)不仅必须解析像问题中那样的 RFC 3339 日期时间字符串，还必须解析其他不符合 RFC 3339 的[ISO 8601](https://en.wikipedia.org/wiki/ISO_8601)日期和时间字符串（例如没有 UTC 偏移量的字符串，或者仅代表一个日期）。

```
>>> import dateutil.parser
>>> dateutil.parser.isoparse('2008-09-03T20:56:35.450686Z') # RFC 3339 format
datetime.datetime(2008, 9, 3, 20, 56, 35, 450686, tzinfo=tzutc())
>>> dateutil.parser.isoparse('2008-09-03T20:56:35.450686') # ISO 8601 extended format
datetime.datetime(2008, 9, 3, 20, 56, 35, 450686)
>>> dateutil.parser.isoparse('20080903T205635.450686') # ISO 8601 basic format
datetime.datetime(2008, 9, 3, 20, 56, 35, 450686)
>>> dateutil.parser.isoparse('20080903') # ISO 8601 basic format, date only
datetime.datetime(2008, 9, 3, 0, 0) 
```

*python-dateutil*包也有[`dateutil.parser.parse`](https://dateutil.readthedocs.io/en/stable/parser.html#dateutil.parser.parse). 与 相比`isoparse`，它可能不那么严格，但它们都非常宽容，并会尝试解释您传入的字符串。如果您想消除任何误读的可能性，您需要使用比这两个函数中的任何一个更严格的东西.

#### 与 Python 3.7+ 内置的比较[`datetime.datetime.fromisoformat`](https://docs.python.org/3/library/datetime.html#datetime.datetime.fromisoformat)

`dateutil.parser.isoparse`是一个完整的 ISO-8601 格式解析器，但`fromisoformat`故意*不是*. 请参阅后一个函数的文档以了解此警告性警告。（见[这个答案](https://stackoverflow.com/a/49784038/247696)）。

* * *

## 回答 #2

> 赞同：381
> 
> 时间：2018-04-11T20:32:10.420

从 Python 3.7 开始，`datetime`标准库有一个用于反转`datetime.isoformat()`.

> [*类方法* **`datetime.fromisoformat(date_string)`**](https://docs.python.org/3/library/datetime.html#datetime.datetime.fromisoformat)：
> 
> 以and发出的格式之一返回`datetime`对应于 a 的 a 。`date_string``date.isoformat()``datetime.isoformat()`
> 
> 具体来说，此函数支持以下格式的字符串：
> 
> `YYYY-MM-DD[*HH[:MM[:SS[.mmm[mmm]]]][+HH:MM[:SS[.ffffff]]]]`
> 
> where`*`可以匹配任何单个字符。
> 
> **注意**：这不支持解析任意 ISO 8601 字符串 - 它仅用作`datetime.isoformat()`.
> 
> 例子：
> 
> ```
> >>> from datetime import datetime
> >>> datetime.fromisoformat('2011-11-04')
> datetime.datetime(2011, 11, 4, 0, 0) 
> ```
> 
> …</p>

**请务必阅读文档中的警告！**

* * *

## 回答 #3

> 赞同：212
> 
> 时间：2008-09-24T15:45:02.013

请注意，在 Python 2.6+ 和 Py3K 中，%f 字符会捕获微秒。

```
>>> datetime.datetime.strptime("2008-09-03T20:56:35.450686Z", "%Y-%m-%dT%H:%M:%S.%fZ") 
```

[在这里](http://bugs.python.org/issue1158)查看问题

* * *

## 回答 #4

> 赞同：181
> 
> 时间：2015-06-07T17:53:25.920

[这里的](https://stackoverflow.com/a/22700869/1709587)[几个](https://stackoverflow.com/a/127972/1709587)[答案](https://stackoverflow.com/a/127825/1709587) [建议](https://stackoverflow.com/a/28979667/1709587)使用时区来解析 RFC 3339 或 ISO 8601 日期时间，就像问题中展示的那样： [`datetime.datetime.strptime`](https://docs.python.org/library/datetime.html#datetime.datetime.strptime)

```
2008-09-03T20:56:35.450686Z 
```

这是一个坏主意。

假设您想要支持完整的 RFC 3339 格式，包括支持除零以外的 UTC 偏移量，那么这些答案建议的代码不起作用。事实上，它*不能*工作，因为使用解析 RFC 3339 语法`strptime`是不可能的。Python 的 datetime 模块使用的格式字符串无法描述 RFC 3339 语法。

问题是UTC偏移量。[RFC 3339 Internet 日期/时间格式](https://www.rfc-editor.org/rfc/rfc3339#section-5.6)要求每个日期时间都包含一个 UTC 偏移量，并且这些偏移量可以是`Z`（“祖鲁时间”的缩写）`+HH:MM`或`-HH:MM`格式，如`+05:00`or `-10:30`。

因此，这些都是有效的 RFC 3339 日期时间：

*   `2008-09-03T20:56:35.450686Z`
*   `2008-09-03T20:56:35.450686+05:00`
*   `2008-09-03T20:56:35.450686-10:30`

唉，格式字符串使用`strptime`并且`strftime`没有与 RFC 3339 格式中的 UTC 偏移相对应的指令。他们支持的指令的完整列表可以在[https://docs.python.org/3/library/datetime.html#strftime-and-strptime-behavior](https://docs.python.org/3/library/datetime.html#strftime-and-strptime-behavior)找到，列表中包含的唯一 UTC 偏移指令是`%z`：

> ### %z
> 
> 格式为 +HHMM 或 -HHMM 的 UTC 偏移量（如果对象是幼稚的，则为空字符串）。
> 
> 示例：（空）、+0000、-0400、+1030

这与 RFC 3339 偏移量的格式不匹配，实际上，如果我们尝试`%z`在格式字符串中使用并解析 RFC 3339 日期，我们将失败：

```
>>> ***from datetime import datetime***
>>> ***datetime.strptime("2008-09-03T20:56:35.450686Z", "%Y-%m-%dT%H:%M:%S.%f%z")***
Traceback (most recent call last):
  File "", line 1, in 
  File "/usr/lib/python3.4/_strptime.py", line 500, in _strptime_datetime
    tt, fraction = _strptime(data_string, format)
  File "/usr/lib/python3.4/_strptime.py", line 337, in _strptime
    (data_string, format))
ValueError: time data '2008-09-03T20:56:35.450686Z' does not match format '%Y-%m-%dT%H:%M:%S.%f%z'
>>> ***datetime.strptime("2008-09-03T20:56:35.450686+05:00", "%Y-%m-%dT%H:%M:%S.%f%z")***
Traceback (most recent call last):
  File "", line 1, in 
  File "/usr/lib/python3.4/_strptime.py", line 500, in _strptime_datetime
    tt, fraction = _strptime(data_string, format)
  File "/usr/lib/python3.4/_strptime.py", line 337, in _strptime
    (data_string, format))
ValueError: time data '2008-09-03T20:56:35.450686+05:00' does not match format '%Y-%m-%dT%H:%M:%S.%f%z'
```

（实际上，上面的内容正是您在 Python 3 中看到的。在 Python 2 中，我们会因为更简单的原因而失败，即在 Python 2 中[`strptime`根本没有实现该`%z`指令](https://bugs.python.org/issue17342)。）

这里推荐的多个答案都可以通过在其格式字符串中`strptime`包含一个文字来解决此问题，该字符串与提问者的示例日期时间字符串匹配（并丢弃它，生成一个没有时区的对象）：`Z``Z``datetime`

```
>>> ***datetime.strptime("2008-09-03T20:56:35.450686Z", "%Y-%m-%dT%H:%M:%S.%fZ")***
datetime.datetime(2008, 9, 3, 20, 56, 35, 450686)
```

由于这会丢弃原始日期时间字符串中包含的时区信息，因此我们是否应该将这个结果视为正确是值得怀疑的。但更重要的是，因为这种方法涉及*将特定的 UTC 偏移量硬编码到格式字符串*中，所以当它尝试解析任何具有不同 UTC 偏移量的 RFC 3339 日期时间时，它会阻塞：

```
>>> ***datetime.strptime("2008-09-03T20:56:35.450686+05:00", "%Y-%m-%dT%H:%M:%S.%fZ")***
Traceback (most recent call last):
  File "", line 1, in 
  File "/usr/lib/python3.4/_strptime.py", line 500, in _strptime_datetime
    tt, fraction = _strptime(data_string, format)
  File "/usr/lib/python3.4/_strptime.py", line 337, in _strptime
    (data_string, format))
ValueError: time data '2008-09-03T20:56:35.450686+05:00' does not match format '%Y-%m-%dT%H:%M:%S.%fZ'
```

除非您*确定*您只需要支持祖鲁时间的 RFC 3339 日期时间，而不是具有其他时区偏移量的日期时间，否则不要使用`strptime`. 请改用此处答案中描述的许多其他方法之一。

* * *

## 回答 #5

> 赞同：80
> 
> 时间：2008-09-24T15:38:17.147

试试[iso8601](https://pypi.org/project/iso8601/)模块；它正是这样做的。

[python.org wiki 上的WorkingWithTime](http://wiki.python.org/moin/WorkingWithTime)页面上还提到了其他几个选项。

* * *

## 回答 #6

> 赞同：46
> 
> 时间：2018-01-31T09:52:55.233

从 Python 3.7 开始，strptime 支持 UTC 偏移量 ( [source](https://github.com/python/cpython/commit/32318930da70ff03320ec50813b843e7db6fbc2e) ) 中的冒号分隔符。所以你可以使用：

```
import datetime
datetime.datetime.strptime('2018-01-31T09:24:31.488670+00:00', '%Y-%m-%dT%H:%M:%S.%f%z') 
```

编辑：

正如 Martijn 所指出的，如果您使用 isoformat() 创建了 datetime 对象，您可以简单地使用`datetime.fromisoformat()`.

* * *

## 回答 #7

> 赞同：36
> 
> 时间：2008-09-24T15:19:27.817

你得到的确切错误是什么？是不是像下面这样？

```
>>> datetime.datetime.strptime("2008-08-12T12:20:30.656234Z", "%Y-%m-%dT%H:%M:%S.Z")
ValueError: time data did not match format:  data=2008-08-12T12:20:30.656234Z  fmt=%Y-%m-%dT%H:%M:%S.Z 
```

如果是，您可以将输入字符串拆分为“。”，然后将微秒添加到您获得的日期时间。

尝试这个：

```
>>> def gt(dt_str):
        dt, _, us= dt_str.partition(".")
        dt= datetime.datetime.strptime(dt, "%Y-%m-%dT%H:%M:%S")
        us= int(us.rstrip("Z"), 10)
        return dt + datetime.timedelta(microseconds=us)

>>> gt("2008-08-12T12:20:30.656234Z")
datetime.datetime(2008, 8, 12, 12, 20, 30, 656234) 
```

* * *

## 回答 #8

> 赞同：32
> 
> 时间：2008-09-24T15:27:24.380

```
import re
import datetime
s = "2008-09-03T20:56:35.450686Z"
d = datetime.datetime(*map(int, re.split(r'[^\d]', s)[:-1])) 
```

* * *

## 回答 #9

> 赞同：31
> 
> 时间：2020-07-07T06:34:40.563

评论之一中的一个简单选项：替换`'Z'`为`'+00:00'`- 并使用 Python 3.7+ `fromisoformat`：

```
from datetime import datetime

s = "2008-09-03T20:56:35.450686Z"

datetime.fromisoformat(s.replace('Z', '+00:00'))
# datetime.datetime(2008, 9, 3, 20, 56, 35, 450686, tzinfo=datetime.timezone.utc) 
```

虽然`strptime`可以将字符解析`'Z'`为 UTC，但**`fromisoformat`速度更快 ~ x40**（另请参见：[更快的 strptime](https://stackoverflow.com/questions/13468126/a-faster-strptime)）：

```
%timeit datetime.fromisoformat(s.replace('Z', '+00:00'))
346 ns ± 22.3 ns per loop (mean ± std. dev. of 7 runs, 1000000 loops each)

%timeit datetime.strptime(s, '%Y-%m-%dT%H:%M:%S.%f%z')
14.2 µs ± 452 ns per loop (mean ± std. dev. of 7 runs, 100000 loops each)

%timeit dateutil.parser.parse(s)
80.1 µs ± 3.32 µs per loop (mean ± std. dev. of 7 runs, 10000 loops each) 
```

（Windows 10 上的 Python 3.8.7 x64）

* * *

## 回答 #10

> 赞同：22
> 
> 时间：2015-02-15T16:47:44.013

如今，[Arrow](http://arrow.readthedocs.org/)也可以用作第三方解决方案：

```
>>> import arrow
>>> date = arrow.get("2008-09-03T20:56:35.450686Z")
>>> date.datetime
datetime.datetime(2008, 9, 3, 20, 56, 35, 450686, tzinfo=tzutc()) 
```

* * *

## 回答 #11

> 赞同：21
> 
> 时间：2017-02-28T18:14:17.067

只需使用`python-dateutil`模块：

```
>>> import dateutil.parser as dp
>>> t = '1984-06-02T19:05:00.000Z'
>>> parsed_t = dp.parse(t)
>>> print(parsed_t)
datetime.datetime(1984, 6, 2, 19, 5, tzinfo=tzutc()) 
```

[文档](https://dateutil.readthedocs.io/en/stable/)

* * *

## 回答 #12

> 赞同：15
> 
> 时间：2017-03-27T18:41:55.233

我发现[ciso8601](https://github.com/closeio/ciso8601)是解析 ISO 8601 时间戳的最快方法。顾名思义，它是用 C 实现的。

```
import ciso8601
ciso8601.parse_datetime('2014-01-09T21:48:00.921000+05:30') 
```

[GitHub Repo README](https://github.com/closeio/ciso8601/blob/f9f75de38450996e1ad699d966508a739e2bdfdc/README.rst)显示了与其他答案中列出的所有其他库相比，它们的速度提高了 10 倍以上。

我的个人项目涉及大量的 ISO 8601 解析。能够切换通话并以 10 倍的速度运行真是太好了。:)

**编辑：**我已经成为 ciso8601 的维护者。现在比以往任何时候都快！

* * *

## 回答 #13

> 赞同：13
> 
> 时间：2014-03-27T22:50:16.067

如果不想使用 dateutil，可以试试这个功能：

```
def from_utc(utcTime,fmt="%Y-%m-%dT%H:%M:%S.%fZ"):
    """
    Convert UTC time string to time.struct_time
    """
    # change datetime.datetime to time, return time.struct_time type
    return datetime.datetime.strptime(utcTime, fmt) 
```

测试：

```
from_utc("2007-03-04T21:08:12.123Z") 
```

结果：

```
datetime.datetime(2007, 3, 4, 21, 8, 12, 123000) 
```

* * *

## 回答 #14

> 赞同：13
> 
> 时间：2015-09-30T21:42:22.070

如果您使用 Django，它提供了[dateparse 模块](https://docs.djangoproject.com/en/1.8/ref/utils/#module-django.utils.dateparse)，该模块接受一堆类似于 ISO 格式的格式，包括时区。

如果您不使用 Django 并且不想使用此处提到的其他库之一，则可以将[dateparse 的 Django 源代码调整](https://github.com/django/django/blob/262d4db8c4c849b0fdd84550fb96472446cf90df/django/utils/dateparse.py#L84-L109)为您的项目。

* * *

## 回答 #15

> 赞同：9
> 
> 时间：2013-03-02T13:31:49.793

我为 ISO 8601 标准编写了一个解析器并将其放在 GitHub 上：[https](https://github.com/boxed/iso8601) ://github.com/boxed/iso8601 。此实现支持规范中的所有内容，但持续时间、间隔、周期性间隔和 Python 的 datetime 模块支持的日期范围之外的日期除外。

包括测试！:P

* * *

## 回答 #16

> 赞同：9
> 
> 时间：2015-03-11T06:03:35.673

这适用于 Python 3.2 及更高版本的 stdlib（假设所有时间戳都是 UTC）：

```
from datetime import datetime, timezone, timedelta
datetime.strptime(timestamp, "%Y-%m-%dT%H:%M:%S.%fZ").replace(
    tzinfo=timezone(timedelta(0))) 
```

例如，

```
>>> datetime.utcnow().replace(tzinfo=timezone(timedelta(0)))
... datetime.datetime(2015, 3, 11, 6, 2, 47, 879129, tzinfo=datetime.timezone.utc) 
```

* * *

## 回答 #17

> 赞同：8
> 
> 时间：2016-10-26T05:20:18.800

我是iso8601utils的作者。它可以[在 GitHub](https://github.com/silverfernsys/iso8601utils)或[PyPI](https://pypi.python.org/pypi/iso8601utils)上找到。以下是解析示例的方法：

```
>>> from iso8601utils import parsers
>>> parsers.datetime('2008-09-03T20:56:35.450686Z')
datetime.datetime(2008, 9, 3, 20, 56, 35, 450686) 
```

* * *

## 回答 #18

> 赞同：7
> 
> 时间：2016-08-25T16:16:26.243

`datetime.datetime`在不安装第三方模块的情况下，将类似 ISO 8601 的日期字符串转换为所有支持的 Python 版本中的 UNIX 时间戳或对象的一种直接方法是使用[SQLite 的日期解析器](https://www.sqlite.org/lang_datefunc.html)。

```
#!/usr/bin/env python
from __future__ import with_statement, division, print_function
import sqlite3
import datetime

testtimes = [
    "2016-08-25T16:01:26.123456Z",
    "2016-08-25T16:01:29",
]
db = sqlite3.connect(":memory:")
c = db.cursor()
for timestring in testtimes:
    c.execute("SELECT strftime('%s', ?)", (timestring,))
    converted = c.fetchone()[0]
    print("%s is %s after epoch" % (timestring, converted))
    dt = datetime.datetime.fromtimestamp(int(converted))
    print("datetime is %s" % dt) 
```

输出：

```
2016-08-25T16:01:26.123456Z is 1472140886 after epoch
datetime is 2016-08-25 12:01:26
2016-08-25T16:01:29 is 1472140889 after epoch
datetime is 2016-08-25 12:01:29 
```

* * *

## 回答 #19

> 赞同：7
> 
> 时间：2016-09-08T09:42:18.843

Django 的**parse_datetime** () 函数支持带有 UTC 偏移量的日期：

```
parse_datetime('2016-08-09T15:12:03.65478Z') =
datetime.datetime(2016, 8, 9, 15, 12, 3, 654780, tzinfo=<UTC>) 
```

因此它可以用于解析整个项目中字段中的 ISO 8601 日期：

```
from django.utils import formats
from django.forms.fields import DateTimeField
from django.utils.dateparse import parse_datetime

class DateTimeFieldFixed(DateTimeField):
    def strptime(self, value, format):
        if format == 'iso-8601':
            return parse_datetime(value)
        return super().strptime(value, format)

DateTimeField.strptime = DateTimeFieldFixed.strptime
formats.ISO_INPUT_FORMATS['DATETIME_INPUT_FORMATS'].insert(0, 'iso-8601') 
```

* * *

## 回答 #20

> 赞同：6
> 
> 时间：2019-09-24T12:32:41.400

另一种方法是使用 ISO-8601 的专用解析器是使用dateutil 解析器的[*isoparse*](https://dateutil.readthedocs.io/en/stable/parser.html#dateutil.parser.isoparse)函数：

```
from dateutil import parser

date = parser.isoparse("2008-09-03T20:56:35.450686+01:00")
print(date) 
```

输出：

```
2008-09-03 20:56:35.450686+01:00 
```

[标准 Python 函数*datetime.fromisoformat*](https://docs.python.org/3/library/datetime.html#datetime.datetime.fromisoformat)的文档中也提到了这个函数：

> 第三方包 dateutil 中提供了功能更全的 ISO 8601 解析器 dateutil.parser.isoparse。

* * *

## 回答 #21

> 赞同：4
> 
> 时间：2016-06-28T19:54:18.820

因为 ISO 8601 允许存在许多可选的冒号和破折号，所以基本上`CCYY-MM-DDThh:mm:ss[Z|(+|-)hh:mm]`. 如果你想使用 strptime，你需要先去掉这些变化。

**目标是生成一个 UTC 日期时间对象。**

* * *

如果您只想要一个适用于带有 Z 后缀的 UTC 的基本案例，例如`2016-06-29T19:36:29.3453Z`：

```
datetime.datetime.strptime(timestamp.translate(None, ':-'), "%Y%m%dT%H%M%S.%fZ") 
```

* * *

如果您想处理时区偏移量`2016-06-29T19:36:29.3453-0400`或`2008-09-03T20:56:35.450686+05:00`使用以下内容。这些会将所有变体转换为没有变量分隔符的东西，例如 `20080903T205635.450686+0500`使其更一致/更易于解析。

```
import re
# this regex removes all colons and all 
# dashes EXCEPT for the dash indicating + or - utc offset for the timezone
conformed_timestamp = re.sub(r"[:]|([-](?!((\d{2}[:]\d{2})|(\d{4}))$))", '', timestamp)
datetime.datetime.strptime(conformed_timestamp, "%Y%m%dT%H%M%S.%f%z" ) 
```

* * *

如果您的系统不支持`%z`strptime 指令（您会看到类似 的内容`ValueError: 'z' is a bad directive in format '%Y%m%dT%H%M%S.%f%z'`），那么您需要手动从`Z`(UTC) 偏移时间。注意`%z`在 python 版本 < 3 中可能无法在您的系统上运行，因为它取决于 c 库支持，该支持因系统/python 构建类型（即 Jython、Cython 等）而异。

```
import re
import datetime

# this regex removes all colons and all 
# dashes EXCEPT for the dash indicating + or - utc offset for the timezone
conformed_timestamp = re.sub(r"[:]|([-](?!((\d{2}[:]\d{2})|(\d{4}))$))", '', timestamp)

# split on the offset to remove it. use a capture group to keep the delimiter
split_timestamp = re.split(r"[+|-]",conformed_timestamp)
main_timestamp = split_timestamp[0]
if len(split_timestamp) == 3:
    sign = split_timestamp[1]
    offset = split_timestamp[2]
else:
    sign = None
    offset = None

# generate the datetime object without the offset at UTC time
output_datetime = datetime.datetime.strptime(main_timestamp +"Z", "%Y%m%dT%H%M%S.%fZ" )
if offset:
    # create timedelta based on offset
    offset_delta = datetime.timedelta(hours=int(sign+offset[:-2]), minutes=int(sign+offset[-2:]))
    # offset datetime with timedelta
    output_datetime = output_datetime + offset_delta 
```

* * *

## 回答 #22

> 赞同：4
> 
> 时间：2021-07-28T14:22:38.257

如果[`pandas`](https://pandas.pydata.org/docs/index.html)无论如何都要使用，我可以[`Timestamp`](https://pandas.pydata.org/docs/reference/api/pandas.Timestamp.html)从`pandas`. 在那里你可以

```
ts_1 = pd.Timestamp('2020-02-18T04:27:58.000Z')    
ts_2 = pd.Timestamp('2020-02-18T04:27:58.000') 
```

Rant：令人难以置信的是，我们仍然需要担心 2021 年的日期字符串解析之类的事情。

* * *

## 回答 #23

> 赞同：2
> 
> 时间：2011-07-21T06:47:19.800

对于适用于 2.X 标准库的内容，请尝试：

```
calendar.timegm(time.strptime(date.split(".")[0]+"UTC", "%Y-%m-%dT%H:%M:%S%Z")) 
```

calendar.timegm 是 time.mktime 的缺失 gm 版本。

* * *

## 回答 #24

> 赞同：2
> 
> 时间：2013-08-09T15:53:22.103

如果解析无效的日期字符串，python-dateutil 将抛出异常，因此您可能希望捕获异常。

```
from dateutil import parser
ds = '2012-60-31'
try:
  dt = parser.parse(ds)
except ValueError, e:
  print '"%s" is an invalid date' % ds 
```

* * *

## 回答 #25

> 赞同：2
> 
> 时间：2018-09-24T18:21:02.863

* * *

## 回答 #26

> 赞同：1
> 
> 时间：2016-03-14T15:05:53.017

感谢伟大的[Mark Amery 的回答](https://stackoverflow.com/a/30696682/719457)，我设计了一个函数来解释所有可能的日期时间 ISO 格式：

```
class FixedOffset(tzinfo):
    """Fixed offset in minutes: `time = utc_time + utc_offset`."""
    def __init__(self, offset):
        self.__offset = timedelta(minutes=offset)
        hours, minutes = divmod(offset, 60)
        #NOTE: the last part is to remind about deprecated POSIX GMT+h timezones
        #  that have the opposite sign in the name;
        #  the corresponding numeric value is not used e.g., no minutes
        self.__name = '<%+03d%02d>%+d' % (hours, minutes, -hours)
    def utcoffset(self, dt=None):
        return self.__offset
    def tzname(self, dt=None):
        return self.__name
    def dst(self, dt=None):
        return timedelta(0)
    def __repr__(self):
        return 'FixedOffset(%d)' % (self.utcoffset().total_seconds() / 60)
    def __getinitargs__(self):
        return (self.__offset.total_seconds()/60,)

def parse_isoformat_datetime(isodatetime):
    try:
        return datetime.strptime(isodatetime, '%Y-%m-%dT%H:%M:%S.%f')
    except ValueError:
        pass
    try:
        return datetime.strptime(isodatetime, '%Y-%m-%dT%H:%M:%S')
    except ValueError:
        pass
    pat = r'(.*?[+-]\d{2}):(\d{2})'
    temp = re.sub(pat, r'\1\2', isodatetime)
    naive_date_str = temp[:-5]
    offset_str = temp[-5:]
    naive_dt = datetime.strptime(naive_date_str, '%Y-%m-%dT%H:%M:%S.%f')
    offset = int(offset_str[-4:-2])*60 + int(offset_str[-2:])
    if offset_str[0] == "-":
        offset = -offset
    return naive_dt.replace(tzinfo=FixedOffset(offset)) 
```

* * *

## 回答 #27

> 赞同：0
> 
> 时间：2019-05-15T01:32:49.600

最初我尝试过：

```
from operator import neg, pos
from time import strptime, mktime
from datetime import datetime, tzinfo, timedelta

class MyUTCOffsetTimezone(tzinfo):
    @staticmethod
    def with_offset(offset_no_signal, signal):  # type: (str, str) -> MyUTCOffsetTimezone
        return MyUTCOffsetTimezone((pos if signal == '+' else neg)(
            (datetime.strptime(offset_no_signal, '%H:%M') - datetime(1900, 1, 1))
          .total_seconds()))

    def __init__(self, offset, name=None):
        self.offset = timedelta(seconds=offset)
        self.name = name or self.__class__.__name__

    def utcoffset(self, dt):
        return self.offset

    def tzname(self, dt):
        return self.name

    def dst(self, dt):
        return timedelta(0)

def to_datetime_tz(dt):  # type: (str) -> datetime
    fmt = '%Y-%m-%dT%H:%M:%S.%f'
    if dt[-6] in frozenset(('+', '-')):
        dt, sign, offset = strptime(dt[:-6], fmt), dt[-6], dt[-5:]
        return datetime.fromtimestamp(mktime(dt),
                                      tz=MyUTCOffsetTimezone.with_offset(offset, sign))
    elif dt[-1] == 'Z':
        return datetime.strptime(dt, fmt + 'Z')
    return datetime.strptime(dt, fmt) 
```

但这不适用于负时区。然而，我在 Python 3.7.3 中工作得很好：

```
from datetime import datetime

def to_datetime_tz(dt):  # type: (str) -> datetime
    fmt = '%Y-%m-%dT%H:%M:%S.%f'
    if dt[-6] in frozenset(('+', '-')):
        return datetime.strptime(dt, fmt + '%z')
    elif dt[-1] == 'Z':
        return datetime.strptime(dt, fmt + 'Z')
    return datetime.strptime(dt, fmt) 
```

一些测试，请注意，输出仅在微秒精度上有所不同。在我的机器上达到 6 位精度，但是 YMMV：

```
for dt_in, dt_out in (
        ('2019-03-11T08:00:00.000Z', '2019-03-11T08:00:00'),
        ('2019-03-11T08:00:00.000+11:00', '2019-03-11T08:00:00+11:00'),
        ('2019-03-11T08:00:00.000-11:00', '2019-03-11T08:00:00-11:00')
    ):
    isoformat = to_datetime_tz(dt_in).isoformat()
    assert isoformat == dt_out, '{} != {}'.format(isoformat, dt_out) 
```

* * *

## 回答 #28

> 赞同：-1
> 
> 时间：2016-08-09T10:17:22.723

```
def parseISO8601DateTime(datetimeStr):
    import time
    from datetime import datetime, timedelta

    def log_date_string(when):
        gmt = time.gmtime(when)
        if time.daylight and gmt[8]:
            tz = time.altzone
        else:
            tz = time.timezone
        if tz > 0:
            neg = 1
        else:
            neg = 0
            tz = -tz
        h, rem = divmod(tz, 3600)
        m, rem = divmod(rem, 60)
        if neg:
            offset = '-%02d%02d' % (h, m)
        else:
            offset = '+%02d%02d' % (h, m)

        return time.strftime('%d/%b/%Y:%H:%M:%S ', gmt) + offset

    dt = datetime.strptime(datetimeStr, '%Y-%m-%dT%H:%M:%S.%fZ')
    timestamp = dt.timestamp()
    return dt + timedelta(hours=dt.hour-time.gmtime(timestamp).tm_hour) 
```

请注意，我们应该查看字符串是否不以 结尾`Z`，我们可以使用`%z`.

# scrum - Scrum master 整天都在做什么？

> ID：127807
> 
> 赞同：62
> 
> 时间：2008-09-24T15:17:36.930
> 
> 标签：scrum, methodology

引用维基百科：

> Scrum 由 ScrumMaster 促进，他的主要工作是消除团队交付 sprint 目标能力的障碍。ScrumMaster 不是团队的领导者（因为他们是自组织的），而是充当团队与任何分散注意力的影响之间的缓冲。ScrumMaster 确保按预期使用 Scrum 流程。ScrumMaster 是规则的执行者。”

在此基础上工作，以及大多数企业一次运行 2-3 个项目的事实，SM 需要完成哪些实际工作任务来填补全职工作？或者，这不是一份全职工作，而且那个人还做其他事情，比如开发、销售等？

有没有 SM 有什么要分享的？

* * *

## 回答 #1

> 赞同：46
> 
> 时间：2008-09-24T15:22:23.003

不幸的是，我们没有拥有专门的 Scrum Master 的奢侈。我也是一名团队负责人和高级开发人员，每天都忙得不可开交。

* * *

## 回答 #2

> 赞同：40
> 
> 时间：2009-05-19T01:29:20.923

我通常整天都在[Stack Overflow上。](http://stackoverflow.com)哦，我试着协调午餐。

* * *

## 回答 #3

> 赞同：21
> 
> 时间：2009-10-01T17:16:44.097

ScrumMaster 角色的关键是消除障碍。

* * *

## 回答 #4

> 赞同：16
> 
> 时间：2009-05-19T01:24:22.727

ScrumMaster/迭代管理器

*   构建发布计划
*   建立 Scrum/迭代计划
*   计划和主持
    *   Scrum/迭代计划会议
    *   展示与讲述
    *   发布计划会议
    *   回顾展
*   拥有拦截器板并积极与团队合作以识别和移除拦截器
*   更新团队 WIKI
*   更新团队房间中的大可见图表，包括故事卡墙
*   参加每日站会
*   参加每日 Scrum of Scrums

ScrumMaster/Iteration Manager 也是牧羊犬，即他们保护团队（羊群）。最后，ScrumMaster/迭代经理是团队与外部资源的联系点，但主要是项目经理。

* * *

## 回答 #5

> 赞同：15
> 
> 时间：2008-09-24T15:20:58.843

“充当团队与任何分散注意力的影响之间的缓冲”

那是一份全职工作。有很多人很想从团队中获取信息，而 SM 负责处理这些问题。要做好这项工作，重要的是要积极主动，而不是被动应对。因此，他们应该保持所有的车轮平稳运行。当 SM 运行良好时，这是一个惊人的转变。

* * *

## 回答 #6

> 赞同：11
> 
> 时间：2009-10-01T17:25:20.977

我认为有多少人回答这个问题，就会有多少人回答这个问题。在一个有敬业的人的小团队里，他们大多知道自己在做什么，SM 的作用几乎是无形的；在一个试图应对模糊要求和权力斗争的大型团队中，SM 将非常引人注目，并且可能永远不会有自己的时间，因为他们将成为团队（以及团队之外的利益相关者）所有挫折的避雷针。

知道自己想要实现什么并拥有一个知道如何实现它的小团队是无可替代的。如果你有这些，并且你“采用了 SCRUM”，你可能很快就会确信成为一名 Scrum Master 很容易。但是，如果相反，您的团队非常混乱，目标不明，并且正在进行大量的政治斗争，并且您“采用 SCRUM”，您可能会认为成为 Scrum Master 是全职的（也许不可能）需要结合非常稀有才能的工作。大多数真正的团队可能介于这两个极端之间。

* * *

## 回答 #7

> 赞同：9
> 
> 时间：2008-09-24T15:24:34.637

请注意：这个问题和答案已超过十二岁。从那时起，对 Scrum Master 角色的共识理解有了很大的发展，所以我不再认为这是对这个问题的有效答案，更不用说一个值得被接受的答案了。一定要对它投反对票。除此之外，不用理会。

* * *

Scrum Master 会做一些事情，比如确保 Scrums 发生、组织 sprint 计划会议、回顾等。此外，他将能够向管理层解释团队正在做什么以及为什么团队成员不能被挖到其他项目，直到冲刺结束。除此之外，Scrum Master 并没有任何明确的任务。因此，一个人应该很容易成为 3 个团队的 Scrum Master，并且仍然有时间去做管理类型的工作（假期请求、程序、参加与董事无聊的会议等等），或者可以自由地为开发做出贡献团队的资源。

* * *

## 回答 #8

> 赞同：7
> 
> 时间：2009-09-29T21:45:56.703

虽然 ScrumMaster 是 Scrum 框架中的一个角色，但履行该角色的个人必须是团队的成员。在 Scrum 中，**团队成员应该不惜一切代价全职**。团队成员应该能够接手 Sprint 积压的任务。它们可能是开发任务、测试任务、配置 CI 服务器任务等……如果你不能为燃尽做贡献，那为什么还要加入团队呢？[任何有自尊的 ScrumMaster 都应该做的最后一件事是偷懒加入另一个团队。](http://drivendevelopment.blogspot.com/2009/09/i-want-scrummaster-role-to-be.html)ScrumMasters 应该是*嵌入并致力于*他们的团队和产品。ScrumMaster 是团队中的一个角色，而不是一个职位。我不同意那些认为你可以同时成为多个项目的 ScrumMaster 并且仍然是世界级的人。事实是，这不是 Scrum。

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2010-08-17T10:15:59.663

首先也是最重要的：**消除障碍**。

最好让 Scrum Master 专注于一个团队，以便尽快消除障碍。其中一些可以主动完成，例如通过推动 PO 为下一个 Sprint 更好地分析某些故事。

如果有额外的时间，如果 SM 有一些技能可以让他在团队中担任开发人员或测试人员，那将是很方便的。我已经看到了 SM 的良好结果，他们尽可能多地委托给（经典）项目经理，并且大部分时间都专注于开发。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2008-09-24T15:33:48.827

长话短说，Scrum Master 负责让事情发生。在实践中，Scrum Master 通常是伪装的项目经理。至少我公司是这样的。

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2009-10-01T17:13:41.170

> 在此基础上工作，以及大多数企业一次运行 2-3 个项目的事实，SM 需要完成哪些实际工作任务来填补全职工作？

他们技能范围内的任何东西都可以帮助团队实现目标。

> 或者，这不是一份全职工作，而且那个人还做其他事情，比如开发、销售等？

ScrumMaster 最初并不打算成为一份全职工作。ScrumMaster 是由团队中的某个人担任的角色。该团队成员全职致力于产品。所以，当他/她不做 ScrumMaster 职责时，他们默认回到 Sprint Backlog 上的烧毁任务。

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2009-10-01T17:32:05.097

开发人员保持生产力所需的一切。订购比萨饼。去与管理员、管理层和其他团队交谈。做官僚主义的东西。如果没有其他人可用，请修复构建服务器。

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2011-05-02T07:06:44.470

这里的关键词是 Scrum Master 的角色是促进者的角色。正如上面有人正确提到的那样，他最重要的工作是确保为他的团队提供无缝的无干扰环境，这意味着消除障碍，确保他的团队始终拥有他们需要的任何东西。Scrum master 是产品团队和开发团队之间的纽带。决策由团队而不是 Scrum master 完成。在多个团队之间共享一个 Scrum Master 是一个坏主意，因为一个团队的要求可能会成为另一个团队的障碍，因此违背了 Scrum Master 的全部目的。此外，让您的经理作为您的 Scrum 主管是非常危险的，因为交付给经理的压力可能会迫使他进行微观管理，这对任何 Scrum 团队来说都是一个杀手。除了常规的东西

*   安排 Sprint 计划和回顾
*   促进每日站立 安排
*   sprint 迭代结束时的演示
*   解决团队在站立会议上提到的担忧

Scrum Master 每天必须管理的一些重要事情是

*   预见并消除对团队的任何干扰，甚至在它击中团队之前。
*   鼓励团队多沟通
*   与产品团队保持持续沟通，以检查为未来的冲刺做准备需要做什么
*   确保团队遵循他们共同商定的流程，因为有时在 sprint 忙碌期间，一些流程会从裂缝中溜走
*   不断寻找改进团队遵循的流程的方法

最重要的是，Scrum Master 必须待命并支持他的团队。

所有这些工作都会占用大量时间，并且确实需要一个专门的 Scrum Master，他不扮演其他角色。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2010-08-20T09:10:53.977

Scrum Master 就像团队的熊妈妈。他们照顾团队的健康（项目方面），保护他们免受讨厌的外来者的伤害，并为团队消除任何障碍。我为我的团队扮演 ScrumMaster，但我也是开发负责人（为同一团队！），参与技术讨论、设计讨论、开发人员和团队 QA 之间的协调（如果他们自己还没有这样做的话）。我确实会尝试承担实际的开发任务，以便在有时间的时候将图表烧毁。

ScrumMaster 在多个团队中扮演这个角色不是非常分散注意力吗？天哪，我会觉得这很混乱。哪个障碍再次阻挡了哪个团队？等等谁在做这个任务？？

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2010-04-14T16:44:30.630

正确实施的 Scrum Master 角色对项目来说是无价的，不应被视为兼职角色。该角色最重要的方面是为开发团队在 Scrum 会议上提出的任何问题排除障碍。技术 Scrum Master（大多数 SM 往往是这样）不应该是团队中的开发人员，但应该能够就设计和解决方案提供建议（如果您愿意，可以扩展结对编程）。

他们负责更新 ProductBackLog（故事应该由业务创建）、SprintBackLog 和 BurnLog，并负责与业务和 IT 管理人员联络以了解进度。他们还为任何需要调查的项目管理 SpikeLog，这些项目可能演变成故事（再次由业务驱动）。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2010-06-29T17:27:47.460

正如驱动开发所暗示的那样，ScrumMaster 是一个完整的团队成员，因此应该是全职的。我通常将我的角色视为“确保团队作为一台运转良好的机器”，这在不同的时间可能有多种含义。通常，SM 会花费大量时间来促进团队与团队外部人员的互动，尤其是那些与业务分析和利益相关者期望相关的人。除此之外，还需要满足 Cam 列出的机械项目并照顾团队的身体和情绪状态。

与较早的答案之一相关，我坚持的一个基本方面是，团队中的任何成员都不是我的直接下属，也不是彼此的直接下属。这排除了休假时间、费用等成为我工作的一部分，但在不弄乱必须存在的信任关系方面大有帮助。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2011-07-02T20:56:15.150

众所周知，scrum-master 列表中的第一优先级是消除团队报告的障碍。但这不应该就此止步，他应该不断地寻找潜在的障碍……更重要的是那些存在但尚未发现的障碍。肯说，障碍就是机会。因此，**scrum-master 应该整天利用这些机会，让他的团队提高生产力**。

Scrum 的最终目的是为项目带来成功。拥有 Scrum-master 的目的是确保 Scrum 成功实现 Scrum 的目的。现在要实现 Scrum-master 的目标，他/她也必须在战略层面思考和行动。这是全职工作。

# c# - C# 3.0 - 对象初始化器

> ID：127817
> 
> 赞同：2
> 
> 时间：2008-09-24T15:19:03.027
> 
> 标签：c#, .net-3.5

我有一个小问题，我不明白为什么，很容易绕过它，但我仍然想了解。

我有以下课程：

```
public class AccountStatement : IAccountStatement
{
     public IList<IAccountStatementCharge> StatementCharges { get; set; }

    public AccountStatement()
    {
        new AccountStatement(new Period(new NullDate().DateTime,newNullDate().DateTime), 0);
    }

    public AccountStatement(IPeriod period, int accountID)
    {
        StatementCharges = new List<IAccountStatementCharge>();
        StartDate = new Date(period.PeriodStartDate);
        EndDate = new Date(period.PeriodEndDate);
        AccountID = accountID;
    }

     public void AddStatementCharge(IAccountStatementCharge charge)
    {
        StatementCharges.Add(charge);
    } 
```

}

（注意 startdate、enddate、accountID 是自动属性...）

如果我这样使用它：

```
var accountStatement = new AccountStatement{
                                              StartDate = new Date(2007, 1, 1),
                                              EndDate = new Date(2007, 1, 31),
                                              StartingBalance = 125.05m
                                           }; 
```

当我尝试使用方法“AddStatementCharge：我最终得到一个“null”StatementCharges 列表时......一步一步我清楚地看到我的列表得到了一个值，但是一旦我退出实例化行，我的列表变为“空”

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-09-24T15:21:23.973

这段代码：

```
public AccountStatement()
{
    new AccountStatement(new Period(new NullDate().DateTime,newNullDate().DateTime), 0);
} 
```

无疑不是你想要的。这产生了 AccountStatement 的第二个实例，并且对它没有任何作用。

我认为您的意思是：

```
public AccountStatement() : this(new Period(new NullDate().DateTime, new NullDate().DateTime), 0)
{
} 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-24T15:23:56.010

采用

```
public AccountStatement() : this(new Period(new NullDate().DateTime,newNullDate().DateTime), 0) { } 
```

插入

```
public AccountStatement()
    {
        new AccountStatement(new Period(new NullDate().DateTime,newNullDate().DateTime), 0);
    } 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-24T15:22:38.197

您的无参数构造函数会创建自己的新实例，但不会将其分配给任何东西。

* * *

## 回答 #4

> 赞同：-2
> 
> 时间：2008-09-24T15:30:26.150

您正在调用无参数构造函数，因此永远不会初始化 AddStatementCharge。使用类似的东西：

```
var accountStatement = new AccountStatement(period, accountId) {
                                          StartDate = new Date(2007, 1, 1),
                                          EndDate = new Date(2007, 1, 31),
                                          StartingBalance = 125.05m
                                       }; 
```

# asp.net - 如何将 ASP.net ajax AccordionPane 绑定到 XMLDatasource？

> ID：127832
> 
> 赞同：0
> 
> 时间：2008-09-24T15:20:02.323
> 
> 标签：asp.net, data-binding, asp.net-ajax, accordionpane

我有一个愤怒的老板，如果我在这上面浪费一天，他会打败我：-P 许多业力指向可以解决我困境的 ajax 大师。

但更详细：我想要一个 AccordionPane，它从 XML 源中获取一堆链接并从所述源中填充自身。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-09-28T14:55:21.933

可能有更性感的方式，但这是可行的。随心所欲地填充数据源。这仅用于演示目的。PrettyTitle() 的同上 关键是要记住手风琴中有两种项目类型。

```
<html xmlns="http://www.w3.org/1999/xhtml" >
<head runat="server">
    <title>Accordion Binding</title>
</head>
<body>
    <form id="form1" runat="server">
    <asp:ScriptManager ID="AjaxScriptManager" runat="server">
    </asp:ScriptManager>
    <div>
        <cc1:Accordion ID="AccordionControl" runat="server" 
            onitemdatabound="AccordionControl_ItemDataBound">
            <Panes></Panes>
            <HeaderTemplate>
                <asp:Label ID="HeaderLabel" runat="server" />
            </HeaderTemplate>
            <ContentTemplate>
                <asp:Literal ID="ContentLiteral" runat="server" />
                <asp:HyperLink ID="ContentLink" runat="server" />
            </ContentTemplate>
        </cc1:Accordion><asp:xmldatasource runat="server" ID="RockNUGTwitter" ></asp:xmldatasource>
    </div>
    </form>
</body>

</html> 
```

代码隐藏是：

```
Using System;
using System.Web.UI.WebControls;
using System.Xml;

namespace Ajaxy
{
    public partial class _Default : System.Web.UI.Page
    {
        protected void Page_Load(object sender, EventArgs e)
        {
            Fill();
        }

        private void Fill()
        {

            PopulateDataSource();
            AccordionControl.DataSource = RockNUGTwitter.GetXmlDocument().SelectNodes("//item");
            AccordionControl.DataBind();

        }

        private void PopulateDataSource()
        {
            XmlDocument RockNugTwitterRSSDocument = new XmlDocument();
            RockNugTwitterRSSDocument.Load("http://twitter.com/statuses/user_timeline/15912811.rss");
            RockNUGTwitter.Data = RockNugTwitterRSSDocument.OuterXml;
        }

        protected void AccordionControl_ItemDataBound(object sender, AjaxControlToolkit.AccordionItemEventArgs e)
        {
            XmlNode ItemNode = (XmlNode)e.AccordionItem.DataItem;
            if(e.AccordionItem.ItemType == AjaxControlToolkit.AccordionItemType.Content)
            {
                HyperLink ContentLink = (HyperLink)e.AccordionItem.FindControl("ContentLink");
                ContentLink.NavigateUrl = ItemNode.SelectSingleNode("link").InnerText;
                Literal ContentLiteral = (Literal)e.AccordionItem.FindControl("ContentLiteral");
                ContentLiteral.Text = ItemNode.SelectSingleNode("title").InnerText;
                ContentLink.Text = "Link";
            }
            else if(e.AccordionItem.ItemType == AjaxControlToolkit.AccordionItemType.Header)
            {
                Label HeaderLabel = (Label) e.AccordionItem.FindControl("HeaderLabel");
                HeaderLabel.Text = PrettyTitle(ItemNode.SelectSingleNode("title").InnerText);
            }
        }

        private string PrettyTitle(string FullItem)
        {
            string PrettyString = FullItem.Replace("RockNUG: ", "");
            string[] Words = PrettyString.Split(' ');
            const int MAX_WORDS_TOSHOW = 4;
            int WordsToShow = MAX_WORDS_TOSHOW;
            if(Words.Length < MAX_WORDS_TOSHOW)
            {
                WordsToShow = Words.Length;
            }
            PrettyString = String.Join(" ", Words, 0, WordsToShow);
            if (Words.Length > WordsToShow)
            {
                PrettyString += "...";
            }
            return PrettyString;
        }
    }
} 
```

# asp.net - ASP.NET Ajax - 异步请求有单独的会话？

> ID：127842
> 
> 赞同：5
> 
> 时间：2008-09-24T15:21:29.887
> 
> 标签：asp.net, ajax, session, asp.net-ajax

我们正在编写一个搜索应用程序，它将搜索条件保存到会话状态并在 asp.net 更新面板中执行搜索。有时当我们连续执行多次搜索时，第二次或第三次搜索有时会返回第一组搜索条件的结果。

示例：我们的第一次搜索我们查找“John Smith” -> 显示 John Smith 结果。我们在“Bob Jones”上进行的第二次搜索 -> 显示 John Smith 结果。

正如我所说，我们将所有搜索条件保存在会话状态中，并从 ajax 请求内部的会话状态中读取它以格式化 DB 查询。当我们在 VS 中设置断点时，一切都会正常运行，但没有它们，我们会得到原始的搜索条件和结果。

我的猜测是因为它们保存在会话中，ajax 请求以某种方式获取自己的会话并将条件保存到该会话中，然后每次都从该会话中检索条件，但是非异步的东西能够看到条件何时被修改并相应地保存对状态的更改，但是因为它们来自两个不同的会话，所以保存和读取的内容存在差异。

编辑::: 为了详细说明，有人建议将搜索条件附加到查询字符串中，这通常是一种很好的做法，我同意它应该是这样的，但按照我们的要求，我认为它不可行。他们想要它，以便用户填写输入控件点击搜索并且没有页面重新加载，他们唯一看到的是页面上的进度指示器，并且他们仍然能够导航和使用当前页面上的其他功能。如果我要向查询字符串添加条件，我将不得不执行另一个请求，导致整个页面加载，这取决于搜索条件可能需要很长时间。这就是为什么我们使用 ajax 调用来执行搜索以及为什么我们没有引起另一个完整页面请求的原因......我希望这可以澄清情况。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-24T15:44:18.723

只是另一个想法，我总是遇到 updatepanel 的问题，并且更喜欢使用 PageMethods 直接通过库编写我的 atlas ajax 请求。您可以更好地控制发送和接收的内容。UpdatePanel 发送整个页面，并接收整个页面控件层次结构，然后解析出什么是“新鲜的”并显示出来。

编辑：您用于将条件保存到会话的代码是什么？并且您在方法中是否有代码可以实际检查会话是否有一些保存的标准，然后将其传回？也许这就是为什么 2nd/3rd updatepanel 回发返回第一组标准而不是预期结果的原因？顺便说一句，我通过做一些繁重的 atlas ajax 事情知道绝对没有两个会话（一个用于正常回发，一个用于异步）您是否有机会使用网络农场？

编辑＃2：如果我不是也回复的人的粉丝，我将无法写出我上面写的内容（第一段）：[https ://stackoverflow.com/users/60/大卫沃德](https://stackoverflow.com/users/60/dave-ward)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-24T15:32:41.887

您需要为正在调用的函数设置 WebMethod 特性的 EnableSession 属性。

```
[WebMethod( EnableSession=true )]
public static void DoSomething(){
    /// ....
} 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-25T04:52:46.723

在正常的 ASP.NET 页面加载、回发和 ASP.NET AJAX 部分回发之间没有多个会话。我可以肯定地告诉你。

与其将搜索字符串存储在会话中，不如直接使用搜索文本框的内容？我想不出您需要对其进行洗牌的任何理由，因为无论如何它在整个页面生命周期中都可用。

最后，关于您的要求...使用 UpdatePanel 并*不能*满足您的用户应该能够使用页面上的其他功能（如果该功能也引发部分回发）的要求。一次只能进行一个部分回发。如果在您的搜索过程中引发了另一个事件，则搜索请求将被取消，而不会发出任何通知。

使用页面方法或 Web 服务进行搜索将是一种*更快*、更容易、更健壮的方法。我通常不插入自己的网站，但我认为我的一些帖子与您正在做的事情完全相关：

您可以使用用户控件通过 Web 服务呈现搜索结果（比 UpdatePanel 快得多）：[http ://encosia.com/2008/02/05/boost-aspnet-performance-with-deferred-content-加载/](http://encosia.com/2008/02/05/boost-aspnet-performance-with-deferred-content-loading/)

或者，您可以将搜索结果作为 JSON 返回并在客户端呈现（甚至更快）：[http ://encosia.com/2008/06/26/use-jquery-and-aspnet-ajax-to-build-客户端中继器/](http://encosia.com/2008/06/26/use-jquery-and-aspnet-ajax-to-build-a-client-side-repeater/)

这些方法中的任何一种都可以使您的搜索功能脱离部分回发范例，从而使其运行速度更快，使用更少的带宽和服务器资源，并且不排除同时发生其他 UpdatePanel 活动。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-05-26T20:57:37.297

如果您使用通用处理程序 .ashx，只需从 IRequiresSessionState 接口派生

```
public class ActionRequest : IHttpHandler, IRequiresSessionState
{
} 
```

# java - 使用 JavaSpaces 的 Blitz 实现

> ID：127867
> 
> 赞同：1
> 
> 时间：2008-09-24T15:26:27.660
> 
> 标签：java, distributed-computing, javaspaces

我对这个论坛有很大的怀疑，但我愿意惊喜；）**对那些让我重回正轨的人表示敬意和巨大的业力。**

我正在尝试使用 JavaSpaces ( [http://www.dancres.org/blitz/blitz_js.html ) 的 blitz 实现来实现](http://www.dancres.org/blitz/blitz_js.html)[http://today.java.net/pub/a/today/](http://today.java.net/pub/a/today/2005/04/21/farm.html)提供的 ComputeFarm 示例[2005/04/21/farm.html](http://today.java.net/pub/a/today/2005/04/21/farm.html)

内存中的示例工作正常，但是每当我尝试使用 blitz 开箱即用的实现时，我都会收到以下错误：

（是**`com.sun.jini.mahalo.TxnMgrProxy`**的在类路径中）

```
2008-09-24 09:57:37.316 ERROR [Thread-4] JavaSpaceComputeSpace 155     - Exception while taking task.
java.rmi.ServerException: RemoteException in server thread; nested exception is: 
    java.rmi.UnmarshalException: unmarshalling method/arguments; nested exception is: 
    java.lang.ClassNotFoundException: com.sun.jini.mahalo.TxnMgrProxy
    at net.jini.jeri.BasicInvocationDispatcher.dispatch(BasicInvocationDispatcher.java:644)
    at com.sun.jini.jeri.internal.runtime.ObjectTable$6.run(ObjectTable.java:597)
    at net.jini.export.ServerContext.doWithServerContext(ServerContext.java:103)
    at com.sun.jini.jeri.internal.runtime.ObjectTable$Target.dispatch0(ObjectTable.java:595)
    at com.sun.jini.jeri.internal.runtime.ObjectTable$Target.access$700(ObjectTable.java:212)
    at com.sun.jini.jeri.internal.runtime.ObjectTable$5.run(ObjectTable.java:568)
    at com.sun.jini.start.AggregatePolicyProvider$6.run(AggregatePolicyProvider.java:527)
    at java.security.AccessController.doPrivileged(Native Method)
    at com.sun.jini.jeri.internal.runtime.ObjectTable$Target.dispatch(ObjectTable.java:565)
    at com.sun.jini.jeri.internal.runtime.ObjectTable$Target.dispatch(ObjectTable.java:540)
    at com.sun.jini.jeri.internal.runtime.ObjectTable$RD.dispatch(ObjectTable.java:778)
    at net.jini.jeri.connection.ServerConnectionManager$Dispatcher.dispatch(ServerConnectionManager.java:148)
    at com.sun.jini.jeri.internal.mux.MuxServer$2.run(MuxServer.java:244)
    at com.sun.jini.start.AggregatePolicyProvider$5.run(AggregatePolicyProvider.java:513)
    at java.security.AccessController.doPrivileged(Native Method)
    at com.sun.jini.jeri.internal.mux.MuxServer$1.run(MuxServer.java:241)
    at com.sun.jini.thread.ThreadPool$Worker.run(ThreadPool.java:136)
    at java.lang.Thread.run(Thread.java:595)
    at com.sun.jini.jeri.internal.runtime.Util.__________EXCEPTION_RECEIVED_FROM_SERVER__________(Util.java:108)
    at com.sun.jini.jeri.internal.runtime.Util.exceptionReceivedFromServer(Util.java:101)
    at net.jini.jeri.BasicInvocationHandler.unmarshalThrow(BasicInvocationHandler.java:1303)
    at net.jini.jeri.BasicInvocationHandler.invokeRemoteMethodOnce(BasicInvocationHandler.java:832)
    at net.jini.jeri.BasicInvocationHandler.invokeRemoteMethod(BasicInvocationHandler.java:659)
    at net.jini.jeri.BasicInvocationHandler.invoke(BasicInvocationHandler.java:528)
    at $Proxy0.take(Unknown Source)
    at org.dancres.blitz.remote.BlitzProxy.take(BlitzProxy.java:157)
    at compute.impl.javaspaces.JavaSpaceComputeSpace.take(JavaSpaceComputeSpace.java:138)
    at example.squares.SquaresJob.collectResults(SquaresJob.java:47)
    at compute.impl.AbstractJobRunner$CollectThread.run(AbstractJobRunner.java:28)
Caused by: java.rmi.UnmarshalException: unmarshalling method/arguments; nested exception is: 
    java.lang.ClassNotFoundException: com.sun.jini.mahalo.TxnMgrProxy
    at net.jini.jeri.BasicInvocationDispatcher.dispatch(BasicInvocationDispatcher.java:619)
    at com.sun.jini.jeri.internal.runtime.ObjectTable$6.run(ObjectTable.java:597)
    at net.jini.export.ServerContext.doWithServerContext(ServerContext.java:103)
    at com.sun.jini.jeri.internal.runtime.ObjectTable$Target.dispatch0(ObjectTable.java:595)
    at com.sun.jini.jeri.internal.runtime.ObjectTable$Target.access$700(ObjectTable.java:212)
    at com.sun.jini.jeri.internal.runtime.ObjectTable$5.run(ObjectTable.java:568)
    at com.sun.jini.start.AggregatePolicyProvider$6.run(AggregatePolicyProvider.java:527)
    at java.security.AccessController.doPrivileged(Native Method)
    at com.sun.jini.jeri.internal.runtime.ObjectTable$Target.dispatch(ObjectTable.java:565)
    at com.sun.jini.jeri.internal.runtime.ObjectTable$Target.dispatch(ObjectTable.java:540)
    at com.sun.jini.jeri.internal.runtime.ObjectTable$RD.dispatch(ObjectTable.java:778)
    at net.jini.jeri.connection.ServerConnectionManager$Dispatcher.dispatch(ServerConnectionManager.java:148)
    at com.sun.jini.jeri.internal.mux.MuxServer$2.run(MuxServer.java:244)
    at com.sun.jini.start.AggregatePolicyProvider$5.run(AggregatePolicyProvider.java:513)
    at java.security.AccessController.doPrivileged(Native Method)
    at com.sun.jini.jeri.internal.mux.MuxServer$1.run(MuxServer.java:241)
    at com.sun.jini.thread.ThreadPool$Worker.run(ThreadPool.java:136)
    at java.lang.Thread.run(Thread.java:595)
Caused by: java.lang.ClassNotFoundException: com.sun.jini.mahalo.TxnMgrProxy
    at java.net.URLClassLoader$1.run(URLClassLoader.java:200)
    at java.security.AccessController.doPrivileged(Native Method)
    at java.net.URLClassLoader.findClass(URLClassLoader.java:188)
    at java.lang.ClassLoader.loadClass(ClassLoader.java:306)
    at net.jini.loader.pref.PreferredClassLoader.loadClass(PreferredClassLoader.java:922)
    at java.lang.ClassLoader.loadClass(ClassLoader.java:251)
    at java.lang.ClassLoader.loadClassInternal(ClassLoader.java:319)
    at java.lang.Class.forName0(Native Method)
    at java.lang.Class.forName(Class.java:242)
    at net.jini.loader.pref.PreferredClassProvider.loadClass(PreferredClassProvider.java:613)
    at java.rmi.server.RMIClassLoader.loadClass(RMIClassLoader.java:247)
    at net.jini.loader.ClassLoading.loadClass(ClassLoading.java:138)
    at net.jini.io.MarshalInputStream.resolveClass(MarshalInputStream.java:296)
    at java.io.ObjectInputStream.readNonProxyDesc(ObjectInputStream.java:1544)
    at java.io.ObjectInputStream.readClassDesc(ObjectInputStream.java:1466)
    at java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:1699)
    at java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1305)
    at java.io.ObjectInputStream.defaultReadFields(ObjectInputStream.java:1908)
    at java.io.ObjectInputStream.readSerialData(ObjectInputStream.java:1832)
    at java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:1719)
    at java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1305)
    at java.io.ObjectInputStream.readObject(ObjectInputStream.java:348)
    at com.sun.jini.jeri.internal.runtime.Util.unmarshalValue(Util.java:221)
    at net.jini.jeri.BasicInvocationDispatcher.unmarshalArguments(BasicInvocationDispatcher.java:1049)
    at net.jini.jeri.BasicInvocationDispatcher.dispatch(BasicInvocationDispatcher.java:599)
    ... 17 more 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-24T19:05:34.200

所以 com.sun.jini.mahalo.TxnMgrProxy 包含在某个 jar 中，它包含在您的 CLASSPATH 环境变量中。

但可能您正在使用一些脚本来启动服务器。这很可能通过指定一个“-classpath”命令行开关来启动 java，该开关优先于您的环境 CLASSPATH 变量。

[http://java.sun.com/j2se/1.4.2/docs/tooldocs/windows/classpath.html](http://java.sun.com/j2se/1.4.2/docs/tooldocs/windows/classpath.html)

你可以通过执行来模拟这个：

javap -classpath someUnknownJar.jar com.sun.jini.mahalo.TxnMgrProxy

......突然间，这个班级再也找不到了。所以请您尝试找出客户端和服务器的java VM的启动方式并提供完整的命令行。（如果您使用某种脚本，只需在 java 命令前面添加一个“echo ...”并将输出粘贴到此处）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-03T13:14:44.260

这看起来像一个 RMI 类加载问题。似乎服务器进程正在尝试解组传递给它的 TxnMgrProxy 对象（我不知道该示例的细节，我从堆栈跟踪中猜测）。该对象需要使用可以找到类定义的代码库进行注释。您可能需要确保以 java.rmi.server.codebase 属性启动 Mahalo，该属性指向可以下载 mahalo-dl.jar（或一些包含类定义的 JAR）的 URL。

即使 JAR 在本地可用，也可能还不够。PreferredClassProvider（它隐藏在堆栈跟踪中）篡夺了普通的 Java 类加载器委托方案，因此即使该类在本地，它仍然希望通过代码库提取定义。

这些都是很难解决的问题。希望我能找到接近答案的东西。祝你好运。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-24T19:24:58.850

确保指定 -Djava.security.policy=/wherever/policy.all 和 -Djava.security.manager= 您可能还必须运行 RMI 代码服务器。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-24T16:38:06.707

好吧，您的 java 空间服务器似乎没有找到该类：

com.sun.jini.mahalo.TxnMgrProxy。

所以我猜你只需要在启动服务器时将 Mahalo（应该包含在 blitz 发行版中：[http](http://www.dancres.org/blitz/blitz_inst.html) ://www.dancres.org/blitz/blitz_inst.html页面）添加到你的类路径中。

如果此建议没有帮助，请发布有关如何启动服务器的更多信息。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-24T18:30:41.583

请注意我的原始帖子：是的 com.sun.jini.mahalo.TxnMgrProxy 在类路径中

如果您熟悉 javap - 如果您指定一个完全限定的类名，它将确定它是否在类路径上。

这是我在运行 javap com.sum.jini.mahalo.TxnMgrProxy 时得到的结果：

```
C:\dev\jini\blitz>javap com.sun.jini.mahalo.TxnMgrProxy
Compiled from "TxnMgrProxy.java"
class com.sun.jini.mahalo.TxnMgrProxy extends java.lang.Object implements net.jini.core.transaction.server.TransactionManager,net.jini.admin.Admi
nistrable,java.io.Serializable,net.jini.id.ReferentUuid{
    final com.sun.jini.mahalo.TxnManager backend;
    final net.jini.id.Uuid proxyID;
    static com.sun.jini.mahalo.TxnMgrProxy create(com.sun.jini.mahalo.TxnManager, net.jini.id.Uuid);
    public net.jini.core.transaction.server.TransactionManager$Created create(long)       throws net.jini.core.lease.LeaseDeniedException, java.r
mi.RemoteException;
    public void join(long, net.jini.core.transaction.server.TransactionParticipant, long)       throws net.jini.core.transaction.UnknownTransacti
onException, net.jini.core.transaction.CannotJoinException, net.jini.core.transaction.server.CrashCountException, java.rmi.RemoteException;
    public int getState(long)       throws net.jini.core.transaction.UnknownTransactionException, java.rmi.RemoteException;
    public void commit(long)       throws net.jini.core.transaction.UnknownTransactionException, net.jini.core.transaction.CannotCommitException,
 java.rmi.RemoteException;
    public void commit(long, long)       throws net.jini.core.transaction.UnknownTransactionException, net.jini.core.transaction.CannotCommitExce
ption, net.jini.core.transaction.TimeoutExpiredException, java.rmi.RemoteException;
    public void abort(long)       throws net.jini.core.transaction.UnknownTransactionException, net.jini.core.transaction.CannotAbortException, j
ava.rmi.RemoteException;
    public void abort(long, long)       throws net.jini.core.transaction.UnknownTransactionException, net.jini.core.transaction.CannotAbortExcept
ion, net.jini.core.transaction.TimeoutExpiredException, java.rmi.RemoteException;
    public java.lang.Object getAdmin()       throws java.rmi.RemoteException;
    public net.jini.id.Uuid getReferentUuid();
    public int hashCode();
    public boolean equals(java.lang.Object);
    com.sun.jini.mahalo.TxnMgrProxy(com.sun.jini.mahalo.TxnManager, net.jini.id.Uuid, com.sun.jini.mahalo.TxnMgrProxy$1);
} 
```

# c# - SAX 与 XmlTextReader - C# 中的 SAX

> ID：127869
> 
> 赞同：12
> 
> 时间：2008-09-24T15:26:43.663
> 
> 标签：c#, java, xml, sax

我正在尝试读取一个大型 XML 文档，并且我想以块 vs`XmlDocument`的方式将整个文件读入内存。我知道我可以`XmlTextReader`这样做，但我想知道是否有人使用过 SAX for .NET？我知道 Java 开发人员对此深信不疑，我想知道是否值得一试，如果值得一试，使用它有什么好处。我正在寻找细节。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-13T15:29:42.153

如果您只想快速完成工作，那么 XmlTextReader 就是为此目的而存在的（在 .NET 中）。

如果您想学习一个稳定的事实标准（并且可以在许多其他编程语言中获得），它将迫使您非常高效和优雅地编写代码，但它也非常灵活，那么请研究 SAX。*但是，除非您要创建高度深奥的 XML 解析器，否则不要浪费您的时间。相反，为您的特定平台寻找下一代解析器（如 XmlTextReader）的解析器。*

**SAX 资源**
SAX 最初是为 Java 编写的，您可以在此处找到已稳定数年的原始开源项目：http: [//sax.sourceforge.net/](http://sax.sourceforge.net/)

这里有同一个项目的 C# 端口（带有 HTML 文档作为源下载的一部分）；它也很稳定： [http ://saxdotnet.sourceforge.net/](http://saxdotnet.sourceforge.net/)

如果您不喜欢 C# 实现，您可以随时使用 MSXML3 或更高版本通过 COMInterop 引用 COM DLL：http: [//msdn.microsoft.com/en-us/library/ms994343.aspx](http://msdn.microsoft.com/en-us/library/ms994343.aspx)

来自 Java 世界的文章，但可能说明了使用这种方法取得成功所需的概念（也可能有可下载的 Java 源代码，这些代码可能很有用，并且很容易转换为 C#）：

*   输出大型 XML 文档，第 1 部分 ( [http://www.ibm.com/developerworks/xml/library/x-tipbigdoc.html](http://www.ibm.com/developerworks/xml/library/x-tipbigdoc.html) )
*   输出大型 XML 文档，第 2 部分 ( [http://www.ibm.com/developerworks/xml/library/x-tipbigdoc2.html](http://www.ibm.com/developerworks/xml/library/x-tipbigdoc2.html) )
*   使用 SAX 过滤器来处理数据 ( [http://www.ibm.com/developerworks/xml/library/x-tipsaxfilter/](http://www.ibm.com/developerworks/xml/library/x-tipsaxfilter/) )

这将是一个繁琐的实现。在我之前的 .NET 时代，我只使用过 SAX，但它需要一些非常先进的编码技术。*在这一点上，它只是不值得麻烦。*

**混合解析器的有趣概念**
这个线程描述了一个混合解析器，它使用 .NET XmlTextReader 来实现一个提供 DOM 和 SAX 优势组合的解析器...
[http://bytes.com/groups/net-xml/178403- xmltextreader 与 dom](http://bytes.com/groups/net-xml/178403-xmltextreader-versus-dom)

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-09-24T15:58:09.017

如果您在谈论[SAX for .NET](http://saxdotnet.sourceforge.net/)，则该项目似乎没有得到维护。上一次发布是在 2 年前。也许他们在上一个版本中做到了完美，但我不会打赌。作者 Karl Waclawek 似乎已经从网上消失了。

至于Java下的SAX？你敢打赌，这很棒。不幸的是，SAX 从未作为标准开发，因此所有非 Java 端口都在根据自己的需要调整 Java API。虽然 DOM 是一个非常糟糕的 API，但它的优点是针对多种语言和环境设计，因此很容易在 Java、C#、JavaScript、C 等中实现。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-09-24T23:16:22.710

我相信使用 SAX 没有任何好处，至少有两个原因：

1.  SAX 是“推”模型，而 XmlReader 是具有[许多优点](http://msdn.microsoft.com/en-us/library/sbw89de7(VS.71).aspx)的拉解析器。
2.  依赖于第 3 方库而不是使用标准的 .NET API。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-08-13T10:31:23.753

就个人而言，我更喜欢 SAX 模型，因为 XmlReader 有一些非常烦人的陷阱，这些陷阱可能会导致代码中的错误，从而可能导致代码跳过元素。大多数代码将围绕 while(rdr.Read()) 模型构建，但如果您在该循环中有任何“ReadString”或“ReadInnerXml()”，您会发现自己在下一次迭代中跳过了元素。

由于 SAX 是基于事件的，因此这永远不会发生，因为您无法执行任何会导致解析器提前搜索的操作。

我个人的感觉是，微软已经发明了 XmlReader 更好地解释推/拉模型的概念，但我并不真正相信它。所以微软认为你不需要用 XmlReader 创建状态机，这对我来说没有意义，但无论如何，这只是我的意见。

# visual-studio-2005 - Source Safe 6.0d 和 Visual Studio 2005 项目树问题

> ID：127878
> 
> 赞同：2
> 
> 时间：2008-09-24T15:28:49.713
> 
> 标签：visual-studio-2005, visual-sourcesafe

每当我尝试将新项目添加到我的 SourceSafe 存储库时，它都会创建 3 个相互嵌套的同名文件夹。我的驱动器上只有一个文件夹，但 Sourcesafe 中有 3 个？

任何人都可以提出可能导致这种情况的原因吗？

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-24T15:33:54.020

尝试在VS2005中创建与源代码管理断开的项目，然后在VSS中创建项目文件夹，正确设置工作文件夹，将文件从VSS添加到sourcesafe，然后在VS2005中编辑源代码管理绑定并将绑定的项目签入源代码管理.

有点笨拙，但这就是我的做法。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-24T15:40:17.673

如果您将一个新项目文件夹拖放到 VSS 中并进行递归添加，那么它就是这样工作的。否则，您必须在 VSS 中创建自己的根项目文件夹，并手动将每个文件一次添加到 VSS。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-05T09:41:16.603

好吧，这个问题来自于视觉工作室。因为 visual stuio 默认情况下将解决方案文件保存在我的文档/...../.../vs 2008/projects/ 位置，并且该地址也保存在 .sln 文件中。

这就是为什么每次您在visual stuio中获得最新信息时，它都会尝试创建相同的结构并在主项目文件夹中制作另一个副本。

解决方案，好吧，我仍在试图弄清楚如何解决它。

干杯，天才

# list - 如何将公告列表/webpart 添加到发布门户

> ID：127884
> 
> 赞同：4
> 
> 时间：2008-09-24T15:29:48.337
> 
> 标签：list, sharepoint

我有一个发布门户网站，我需要在某些页面上添加一些公告。我读过一篇文章说我必须创建一个公告列表才能添加公告 Web 部件，但我似乎找不到任何有关如何添加公告列表的资源。

任何帮助将不胜感激。

蒂亚！

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2011-08-11T17:19:27.253

您的问题是您没有在站点设置页面上激活相关功能。您需要转到网站集网站设置页面。然后选择站点操作 - 管理站点功能

然后激活称为团队协作列表的功能。您现在可以创建公告列表

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-24T16:34:14.580

从您网站的主页（或实际上从任何页面），您应该会在导航菜单的顶部看到“查看所有网站内容”链接。

[查看所有网站内容 http://friendfeed.s3.amazonaws.com/86fed07f0809beefaeeaee0013ee2b952079bc09](http://friendfeed.s3.amazonaws.com/86fed07f0809beefaeeaee0013ee2b952079bc09)

单击该链接，它将显示一个仪表板，其中列出了为当前站点配置的所有 SharePoint 列表。单击“创建”按钮以创建新的 SharePoint 列表。

[创建新的 SharePoint 列表 http://friendfeed.s3.amazonaws.com/6c0b244801826f8b3ee01811211b88668ba8f713](http://friendfeed.s3.amazonaws.com/6c0b244801826f8b3ee01811211b88668ba8f713)

从那里您将看到创建公告列表的选项（在通信标题下）。完成向导以完成列表。

创建列表后，您可以从网站中任何 SharePoint 页面上的“网站操作”菜单中选择“编辑页面”，然后在要放入“公告”Web 部件的 Web 部件区域上选择“添加 Web 部件”。您现在应该会看到一个与您刚刚创建的公告列表同名的 Web 部件。

选择该 Web 部件以将其添加到页面并显示。

希望有帮助。如果这不是您问题的答案，请发表评论或通过澄清更新您的问题，我会尽力提供帮助。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-24T16:04:44.227

向您提供有关如何创建列表的直接说明很可能会让您比以往任何时候都更加迷失。如果这是一个发布门户，那么除了创建一个列表之外，还有很多东西需要学习。内容必须经过批准，并且是版本化的。我强烈建议您不要开始在那里闲逛，因为您冒着弄乱门户的巨大风险。不要因为那些要求你在没有接受过任何培训的情况下做这些事情的人而感到压力。给自己喝杯咖啡，让老板动动手指，在[http://office.microsoft.com/en-us/sharepointserver/FX101211721033.aspx上观看一些相关的网络广播](http://office.microsoft.com/en-us/sharepointserver/FX101211721033.aspx)

希望这可以帮助，

奥辛

# asp.net-mvc - ASP.NET MVC 中的视图文件/目录结构应该是什么？

> ID：127886
> 
> 赞同：8
> 
> 时间：2008-09-24T15:30:21.317
> 
> 标签：asp.net-mvc, directory-structure

我对视图的组织方式感到困惑，理解这一点很重要，因为 ASP.NET MVC 使用约定来让一切正常工作。

在views 目录下，有子目录。在这些子目录中是视图。我假设子目录映射到控制器，并且控制器作用于其子目录中包含的视图。

是否对这些目录中包含哪些类型的视图有新的期望？例如，每个目录的默认页面是否应该是 index.aspx？页面是否应该遵循 Create[controller].aspx、List[controller].aspx 等命名约定？还是没关系？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-24T16:00:42.960

视图目录命名和文件命名很重要，因为 ASP.NET MVC 框架对它们做出了某些假设。如果你不符合这些假设，那么你必须编写代码让框架知道你在做什么。一般来说，除非您有充分的理由不这样做，否则您应该遵守这些假设。

让我们看看最简单的控制器动作：

```
 public ActionResult NotAuthorized()
    {
        return View();
    } 
```

因为在调用 View() 时没有指定视图名称，所以框架将假定视图文件名与操作名称相同。该框架有一个名为 ViewEngine 的类型，它将提供扩展。默认的 ViewEngine 是 WebFormViewEngine，它将采用该名称并向其附加一个 .aspx。因此，在这种情况下，完整的文件名将是 NotAuthorized.aspx。

但是该文件将在哪个文件夹中找到？同样，ViewEngine 提供该信息。使用 WebFormViewEngine，它将查看两个文件夹：~/Views/Shared 和 ~/Views/{controller}

因此，如果您的控制器名为 AccountController，它会在 ~/Views/Account 中查找

但有时您可能不想遵守这些规则。例如，两个不同的操作可能会返回相同的视图（使用不同的模型或其他东西）。在这种情况下，如果您在操作中明确指定视图名称：

```
 public ActionResult NotAuthorized()
    {
        return View("Foo");
    } 
```

请注意，对于 WebFormViewEngine，“视图名称”通常与文件名相同，但没有扩展名，但框架不需要其他视图引擎。

同样，您可能也有理由希望您的应用程序查找视图和非默认文件夹。您可以通过创建自己的 ViewEngine 来做到这一点。我在[这篇博](http://blogs.teamb.com/craigstuntz/2008/07/31/37827 "ASP.NET MVC 中的备用视图文件夹")文中展示了该技术，但类型名称不同，因为它是为早期版本的框架编写的。但是，基本思想仍然相同。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-24T18:39:06.463

关于视图的预期名称，我认为这是每个项目或组织都将尝试标准化的事情之一。

正如您在问题中所暗示的那样，其中一些视图（或更准确地说，呈现它们的操作）可能会全面流行，例如以下在采用 REST 范式的 RoR 应用程序中常见的视图：

*   /orders/（即索引）
*   /订单/表演/123
*   /订单/编辑/123
*   /订单/更新/123
*   /订单/新
*   /订单/创建
*   /订单/销毁/123

视图的选择/标准化在很大程度上取决于您如何为应用程序建模（很明显）以及您想要的细粒度。将控制器映射到各个模型类（咳嗽...资源...咳嗽）越接近，您的操作就越短，您将能够更容易地遵循一组标准操作（如上面的示例）。

我还相信，更短的操作有助于将越来越多的模型业务逻辑推入模型本身，也就是它所属的地方。

# design-patterns - 哪些设计模式未被充分利用？

> ID：127890
> 
> 赞同：11
> 
> 时间：2008-09-24T15:30:42.033
> 
> 标签：design-patterns

您是否经常使用特定的四人组设计模式，但在其他人的设计中却很少使用[？](http://en.wikipedia.org/wiki/Design_Patterns)如果可能，请描述一个简单的例子，这个模式可能有用。它不一定是四人组模式，但如果您选择非 GoF 模式，请包含指向模式描述的超链接。

换句话说：
**有哪些好的/有用的设计模式是我或其他对主要模式有所了解的人可能还不知道的？**

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-08T16:53:57.400

Steve Yegge 写了一篇（通常）很长[的关于解释器模式的博客文章](http://steve-yegge.blogspot.com/2007/12/codes-worst-enemy.html)，声称该模式是唯一可以使代码“更小”的 GoF 模式，并且被其他对其他 GoF 模式非常满意的程序员犯罪地利用不足. 我是那些程序员中的一员——我从未使用过解释器模式，尽管我认识到它对 DSL 之类的东西很重要。无论如何，如果你有足够的毅力阅读整篇叶格的文章，这将是一篇非常发人深省的文章。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-24T15:43:17.150

也许是战略模式？我看到使用它的人并不多，当计算发生变化或可以累积在一起时，它非常有用。当计算的一部分可以被另一个计算替换时，我会使用它。通常在用于产品的企业费率的程序中。

这是一些文档：

*   [维基百科](http://en.wikipedia.org/wiki/Strategy_pattern)
*   [做工厂](http://www.dofactory.com/Patterns/PatternStrategy.aspx)

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-11-08T17:57:50.623

访客名声不好，部分原因是一些实际问题

*   Vistor 和 Visited 层次结构之间的循环依赖关系
*   它应该通过暴露访问类内部来破坏封装

部分原因是 GOF 书中的阐述，它强调结构的遍历，而不是向封闭的层次结构添加虚函数。

这意味着它不会在适当的地方得到考虑，例如解决静态类型语言中的双重调度问题。示例：C++ 中的消息或事件传递系统，其中消息的类型是固定的，但我们希望通过添加新的接收者来扩展。在这里，消息只是结构，所以我们不关心封装它们。`SendTo()`不知道是什么类型`Message`的`MessageRecipient`。

```
#include <iostream>
#include <ostream>
using namespace std;

// Downside: note the cyclic dependencies, typically expressed in
// real life as include file dependency. 
struct StartMessage;
struct StopMessage;

class MessageRecipient
{
public:
    // Downside: hard to add new messages
    virtual void handleMessage(const StartMessage& start) = 0;
    virtual void handleMessage(const StopMessage& stop) = 0;
};

struct Message
{
    virtual void dispatchTo(MessageRecipient& r) const = 0;
};

struct StartMessage : public Message
{
    void dispatchTo(MessageRecipient& r) const
    {
        r.handleMessage(*this);
    }
    // public member data ...
};

struct StopMessage : public Message
{
    StopMessage() {}

    void dispatchTo(MessageRecipient& r) const
    {
        r.handleMessage(*this);
    }
    // public member data ...
};

// Upside: easy to add new recipient
class RobotArm : public MessageRecipient
{
public:
    void handleMessage(const StopMessage& stop)
    {
        cout << "Robot arm stopped" << endl;
    }

    void handleMessage(const StartMessage& start)
    {
        cout << "Robot arm started" << endl;
    }
};

class Conveyor : public MessageRecipient
{
public:
    void handleMessage(const StopMessage& stop)
    {
        cout << "Conveyor stopped" << endl;
    }

    void handleMessage(const StartMessage& start)
    {
        cout << "Conveyor started" << endl;
    }
};

void SendTo(const Message& m, MessageRecipient& r)
{
    // magic double dispatch
    m.dispatchTo(r);
}

int main()
{
    Conveyor c;
    RobotArm r;

    SendTo(StartMessage(), c);
    SendTo(StartMessage(), r);
    SendTo(StopMessage(), r);
} 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-09-24T15:46:22.883

对于许多新开发人员来说，访客模式似乎很难理解。当我有可能获得 Country>State>City>House 的值时，我将它用于微积分。这样我就不需要更改每个子集合中有多少数据。我只是选择了合适的访客，最终的答案是得到任何国家、州或城市的数量。

*   [游客](http://www.dofactory.com/Patterns/PatternVisitor.aspx)
*   [访客维基](http://en.wikipedia.org/wiki/Visitor_pattern)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-11-08T18:15:01.697

如果我们谈论的是非 GOF 模式，那么[Monitor Object](http://www.cs.wustl.edu/~schmidt/PDF/monitor.pdf)就是并发 OO 编程的“Hello World”。我很惊讶有多少程序员设法没有听说过它，或者更喜欢设计自己的临时同步方案。

# sharepoint - Sharepoint Workflow 中的多个修改表单

> ID：127894
> 
> 赞同：1
> 
> 时间：2008-09-24T15:31:18.910
> 
> 标签：sharepoint, workflow, state-machine, modification-form

我正在研究 Sharepoint Server 2007 Statemachine 工作流程。到目前为止，我有几个州和一个自定义关联/启动表单，我使用 InfoPath 2007 创建。目前我有修改表单的问题。我的工作流状态页面中的修改链接会显示出来，点击后会指向我的 InfoPath 表单。如果我单击“提交”按钮，表单将关闭。一切正常。现在我尝试在我的工作流程中添加第二个 ModificationForm。所以我创建了一个新的 InfoPath 表单，并以与第一个表单相同的方式将其添加到工作流中。工作流在构建或部署过程中没有错误。但是，如果我现在尝试单击状态页面中的第二个修改链接，则不会显示该表单。代替我的表格的文本是：“表格已关闭。” 显示。

我查看了中央管理，在“管理表单模板”下知道 InfoPath 表单。我为 Workflow.xml 中的每个修改都提供了他自己的 Guid。我使用了以下 ModificationUrl：ModificationUrl="_layouts/ModWrkflIP.aspx"

有人知道如何在我的工作流程中逐步使用两个或多个 ModificationForms 吗？

先感谢您。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-25T08:45:35.587

非常感谢。我在日志文件中发现以下错误消息：

“表单加载失败，出现验证错误”

我在网上搜索了这个问题的解决方案并找到了这个网站：

[http://social.msdn.microsoft.com/forums/en-US/sharepointworkflow/thread/83264f93-ebe3-49ec-bd6b-95ee02df4d8a/](http://social.msdn.microsoft.com/forums/en-US/sharepointworkflow/thread/83264f93-ebe3-49ec-bd6b-95ee02df4d8a/)

我有两个 sceme 文件，我应该对两种形式都使用一个。所以我不得不使用相同的数据源。就这些。谢谢你的提示。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-24T16:53:16.077

Look in your ULS logs for the error message. It will be listed there 100%. The category is "Forms Services" - the logs are located under the 12 hive in LOGS\

# jquery - 在用户控件中注册 js 以实现模块化的最佳方法

> ID：127899
> 
> 赞同：0
> 
> 时间：2008-09-24T15:31:38.457
> 
> 标签：jquery, .net, user-controls, relative-path, resolveurl

我有一个这样组织的控件

![替代文字](https://dl-web.getdropbox.com/get/jsstructure.GIF?w=faef1ed3)

并且我希望在调用母版页等上注册 javascript，以便在删除该控制文件夹然后注册的任何地方，它将知道如何找到 js 的 URL。

这是我到目前为止所拥有的（在用户控件中）

```
protected void Page_Load(object sender, EventArgs e)
{
    if(!Page.IsClientScriptBlockRegistered("jqModal"))
        Page.ClientScript.RegisterClientScriptInclude("jqModal", ResolveClientUrl("~js/jqModal.js"));
    if (!Page.IsClientScriptBlockRegistered("jQuery"))
        Page.ClientScript.RegisterClientScriptInclude("jQuery", ResolveClientUrl("~/js/jQuery.js"));
    if (!Page.IsClientScriptBlockRegistered("tellAFriend"))
        Page.ClientScript.RegisterClientScriptInclude("tellAFriend", ResolveClientUrl("js/tellAFriend.js"));
} 
```

有任何想法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-24T15:38:20.890

您可以使用带有静态方法的辅助类：

```
public static class PageHelper {
    public static void RegisterClientScriptIfNeeded( Page page, string key, string url ) {
        if( false == page.IsClientScriptBlockRegistered( key )) {
            page.ClientScript.RegisterClientScriptInclude( key , ResolveClientUrl( url ));
        }
    }
} 
```

或者您可以在页面/webcontrol/usercontrol 的某个基类中使用类似的实例方法，它会做同样的事情。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-24T15:49:20.070

我看不到你发的图片。

您还可以使用 Context.Items 确保每个请求仅添加一次该项目并通过控件本身呈现 javascript，尽管我认为 registerclient 脚本也很棒。

```
 protected override void Render(HtmlTextWriter writer)
    {
        base.Render(writer);
        string[] items = new string[] { "jqModal", "jQuery", "tellAFriend" };
        //Check if the Script has already been rendered during this request.
        foreach(string jsFile in items)
        {          
            if (!Context.Items.Contain(sjsFile))
            {
                //Specify that the Script has been rendered during this request.
                Context.Items.Add(jsFile,true);
                //Write the script to the page via the control
                writer.Write(string.Format(SCRIPTTAG, ResolveUrl(jsFile)));
            }
        }
     } 
```

# lisp - 如何在 Common Lisp 中为全文搜索创建反向索引？

> ID：127911
> 
> 赞同：6
> 
> 时间：2008-09-24T15:34:46.267
> 
> 标签：lisp, common-lisp

在 Common Lisp 中为全文搜索创建反向索引的最佳方法是什么？SBCL 或 LispWorks 是否有任何经过验证且（相对）无错误的开放库？

我设法在 AllegroCache 之上创建了我自己的库 - 它相当容易创建、可靠且快速，但缺少高级搜索选项（短语、短语中的通配符等）。

是否有任何可以与 SBCL 或 LispWorks 一起使用的开放库，这样我就不必通过编写自己的代码来重新发明轮子？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-09-24T16:22:44.403

[montezuma](http://www.cl-user.net/asp/libs/montezuma)和 lucene 是一样的东西，但是是用 lisp 写的。

我认为没有人积极使用它，也没有人对其进行过严格测试......但如果你想自己研究它，这是一个好的开始。它已经拥有最常用的功能。阅读 google-group 档案来感受一下……

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-24T15:43:07.447

我知道您问的是 Common Lisp，但有许多面向反向文本搜索服务的应用程序。[Lucene](http://lucene.apache.org/)是一个广为人知且受人尊敬的网站。

解决方案是否可以使用该搜索引擎，但通过 Web 服务 API 连接您的 Common Lisp 代码？（xml-rpc、xml over http 还是只是 text over http）？

您希望它出现在 Common Lisp 中还有其他原因吗？像 Lucene 这样的包可能涵盖了您需要的所有与搜索相关的功能，而使用远程 api 可能仍然允许您在 Common Lisp 中执行更复杂的逻辑。

# c# - 如何使用 IronPython 的 win32api

> ID：127912
> 
> 赞同：3
> 
> 时间：2008-09-24T15:34:49.900
> 
> 标签：c#, winapi, ironpython

在 IronPython 中编写一些测试脚本，我想验证一个窗口是否显示。我有主应用程序进程的 pid，并且想要获取与 pid 相关的窗口标题列表。

我试图避免使用诸如 FindWindowEx 之类的 win32api 调用，因为（据我所知）您无法直接从 IronPython 访问 win32api。有没有办法使用内置的 .net 类来做到这一点？我遇到的大多数东西都建议使用 win32api，如下所示。

[.NET (C#)：只有进程句柄或 PID 时获取子窗口？](https://stackoverflow.com/questions/79111/net-c-getting-child-windows-when-you-only-have-a-process-handle-or-pid)

更新：我找到了解决我想做的事情的方法。下面回答。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-08-07T07:47:03.770

从 IronPython 2.6 开始，支持[ctypes](http://docs.python.org/library/ctypes)模块。该模块提供 C 兼容的数据类型，并允许调用 DLL 中的函数。快速示例：

```
import ctypes
buffer = ctypes.create_string_buffer(100)
ctypes.windll.kernel32.GetWindowsDirectoryA(buffer, len(buffer))
print buffer.value 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-20T16:48:41.187

下面的文章展示了如何从 IronPython 间接访问 win32api。它使用 CSharpCodeProvider CompileAssemblyFromSource 方法从提供的 C# 源代码字符串编译内存中的程序集。IronPython 然后可以导入程序集。

[从 IronPython 动态编译 C#](http://www.voidspace.org.uk/ironpython/dynamically_compiling.shtml)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-24T19:28:30.557

这就像问你是否可以在不下水的情况下游泳。如果您需要来自 Windows 的信息，唯一的选择是使用 win32api。有很多关于如何做到这一点的例子。

如果您不喜欢这个答案，只需在您的问题中留下评论，我将删除此答案，因此您的问题将保留在未回答的问题列表中。

# c# - 紧凑的框架：任何手指友好的 GUI？

> ID：127914
> 
> 赞同：7
> 
> 时间：2008-09-24T15:35:10.460
> 
> 标签：c#, .net, compact-framework

我正在使用 WM6 SDK 在我的掌上电脑上开发一个小工具，但我想实现一个手指友好的用户界面（类似 iPhone）。所以我正在寻找一个免费的 .NET 框架，它提供了为 Windows Mobile 6 Pro 轻松集成手指友好界面的可能性。

有任何想法吗 ？

编辑：手指友好意味着大图标、大按钮、只需拇指轻触的可滚动屏幕......因为紧凑框架中的 Winforms 是为手写笔而不是手指制作的！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-25T21:32:08.863

我知道没有这样的接口 API。

我会从头开始编写这样的接口，覆盖 Paint 和鼠标事件。如果您需要紧凑框架提供的更多精美绘图工具，您应该寻找 pinvoke 来访问 GDI+。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-13T17:02:01.727

You should really check out [Resco's MobileForms Toolkit 2009](http://www.resco.net/developer/default.aspx).

I bet their controls are exactly what you are looking for. Plus they have a [whitepaper](http://www.resco.net/developer/company/articles.aspx?file=articles/article07) and videos to show off the controls.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-06-10T23:19:25.033

此线程上的任何当前读者都应该查看 SlideUI ( [http://www.devslide.com/products/slideui](http://www.devslide.com/products/slideui) )。它是当前（和受支持）的产品，提供触摸友好（类似 iPhone）的滚动和控制。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-07-09T08:03:45.857

查看[http://fluid.codeplex.com/](http://fluid.codeplex.com/)上提供的 Fluid windows mobile 控件 这可能是您正在寻找的内容，并且它是开源的。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-25T19:12:51.077

我不确定它是否是您正在寻找的东西（我自己还没有时间检查它，但我肯定打算这样做）；这个 UI 框架看起来很有趣： [http ://code.msdn.microsoft.com/uiframework](http://code.msdn.microsoft.com/uiframework)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-02-16T13:20:32.767

手指友好是触摸屏技术的结果（电容屏精度较低，但需要零压力；电阻屏需要物理压力，更难滑动、轻弹等）

在 Windows Mobile 6.5 中，他们引入了一个系统手势库（如果您不想 P/Invoke 它，[MSDN Code Gallery](http://code.msdn.microsoft.com/gestureswm/)上有一个示例包装器）。从理论上讲，可以写入这个新库，如果需要，还可以在 WM6.5 之前的设备上模拟手势。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-24T20:23:18.007

我不完全确定您在这里问什么... Windows Mobile 6.0 Pro支持触摸屏，*因此*您只需创建面向 Windows Mobile 6.0 Pro 的项目（但是请注意，您的应用程序不会与 Windows Mobile 6.0 标准设备兼容）。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-03T14:52:30.670

我完全知道你在说什么。所有 .NET 控件都是为触控笔设计的。当你把它们放大到手指上时，不能保证它们会反应良好。除此之外，每个硬件设备的灵敏度都不同，而且更难。

我最近构建了一个应用程序，试图加入一些类似触摸的功能。手工编码所有这些东西很痛苦。

与 Windows MObile 不同的是，第三方库的问题在于每个人都在设计自己的库和导航技术。希望MS在这方面会明智。

[http://sites.google.com/site/nebowiki/](http://sites.google.com/site/nebowiki/)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-11-24T21:31:24.813

如果您正在开发手指友好型应用程序，那么您的目标设备需要一个处理手指输入的进程，而不是手写笔。HTC 设备（如 Kaiser、Mogul、Touch Pro 等）为此目的使用 TouchFlo。TouchFlo 有几个不同的版本，我不确定是否有 SDK，但您需要将其合并到您的程序中。xda-developers.com 会有很多关于它的信息。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-04-25T17:57:21.727

令人惊奇的是，对于 WM6.1 Pro、.NET CF 3.5 和 VS2008，我们所拥有的只是极简的基本触控笔大小的控件。即，土狼丑陋。我准备好咬掉我的手，而不是在应用程序中使用它们。

那么，所有 WM 开发人员都涌向以提供触摸友好型应用程序的第三方控件集合在哪里？

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-05-02T00:57:01.153

对于大多数（包括我的）移动获胜应用程序来说，丑陋确实是正确的词。我正在开发一款带有单屏的旧硬件，这使得情况变得更糟。

看看这里： http: [//www.windowsfordevices.com/news/NS9328208835.html](http://www.windowsfordevices.com/news/NS9328208835.html)

在这里：http: [//msdn.microsoft.com/en-us/library/dd630622.aspx](http://msdn.microsoft.com/en-us/library/dd630622.aspx)

这不是免费的，但价格实惠 - 一些屏幕截图非常漂亮： [http ://www.basic4ppc.com/?gclid=CIiO1di1nJoCFRAhDQodYX8-9A](http://www.basic4ppc.com/?gclid=CIiO1di1nJoCFRAhDQodYX8-9A)

无论如何......对不起，如果这只是 googledragging - 也许它有你错过的东西。

——乔

# formatting - 编程风格重要吗？有多重要？

> ID：127916
> 
> 赞同：35
> 
> 时间：2008-09-24T15:35:16.483
> 
> 标签：formatting, coding-style

去年我正在对一个团队成员的代码进行故障排除，它缺少缩进和注释。我正在和他谈论这件事，告诉他这不是一个好主意，但他被冒犯了。他比我聪明，或者当然受过更多教育。

从那以后我发现他申请了微软，当他们让他做一个双向链表实现时，他写了没有缩进或评论，说他没有时间担心风格。（这是一封电子邮件提交，需要 2 小时才能完成）

微软没有给他回电话……你觉得他们怎么回应，你会怎么回应？

**微软的任何人都可以建议他们在这种情况下会做什么？**

* * *

## 回答 #1

> 赞同：54
> 
> 时间：2008-09-24T15:42:12.427

没有程序员是一座孤岛。有一天，有人将不得不阅读他们的代码。之前在这里重复过很多次：

> **始终编​​写代码，就好像最终维护您的代码的人将是一个知道您住在哪里的暴力精神病患者。** *——马丁·戈尔丁[[（也许）](https://stackoverflow.com/questions/876089/who-wrote-this-programing-saying-always-code-as-if-the-guy-who-ends-up-maintain)]*

也就是说，如果他们的风格足够好，那么在雇用程序员时还有其他更重要的事情需要评估。但是，如果他们完全拒绝使用注释或试图让他们的代码对其他人可读，那就是破坏交易了。

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2008-09-24T16:21:49.757

不关心风格的开发人员就像不关心颜色的艺术家、画家。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2008-09-24T15:38:58.533

几乎没有不评论的借口，也没有不缩进的借口。缩进由大多数最好的编辑处理，评论应该成为 MS 可能想雇用的人的第二天性。

它们当然都是人们进入的学科（无论是自然地还是通过学校教育），所以没有表现出来，也许表明缺乏纪律，或者，至少努力表达它。

编辑：链接列表需要 2 小时？！我明白他的意思是现在......在剩下的一小时五十分钟内适应所有格式会非常困难！（我只是在玩——我认为面试不仅仅是一个链接列表！）

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2008-09-24T15:41:49.760

代码由三个实体读取：计算机、程序员和最终的维护者。
样式和格式与计算机无关，可能对程序员很重要，但对维护者肯定很重要，他们必须尝试理解程序的功能。
拒绝通过使代码可读来适应其他开发人员是不尊重的。
使用有意义的变量名和注释创建有组织的代码是对其他任何阅读它的人的一种常见礼貌形式。

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2008-09-24T15:39:16.473

编程风格非常重要。评论更是如此。即使你一个人在自己的项目上工作，你也应该注释你的代码，因为一个月后你不会记得你做了什么以及为什么。如果你在一个团队中工作，那么不清楚、未格式化和未注释的代码可能会导致灾难。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-09-24T15:39:07.440

没有标识和可读风格的编程就像写一本没有段落和分页符的书。这只是一大堆文字，我永远不会花时间去理解它。

我完全理解微软的反应——我也不会给他回电话。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-09-24T15:44:39.800

我会解雇他，但幸运的是，他永远不会真正被雇用。

我宁愿他花 2 个小时编写干净、几乎可以正常工作的代码，而不是让他把一些有效的东西拼凑在一起。

编程风格很重要，尤其是在团队合作时。
在支持由几个人编写的遗留应用程序时，它变得至关重要。

作为专业人士的一部分，而不仅仅是一些脚本小子，关心代码。这是关于意识到其他人会在六个月后阅读这段代码（甚至是你！）。因此，您应该使其尽可能易于维护。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-09-24T15:37:02.267

我会尝试奉承他，告诉他因为他可以做比其他程序员更复杂的事情，所以他需要对它进行评论并很好地布局，以便我们其他人能够理解它。

我想如果有人在面试中对我表现出这种态度，我会非常仔细地考虑雇用他。我敢肯定，即使是微软也需要团队成员。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2008-09-24T16:29:23.513

格式化不需要任何时间。这是一个糟糕的借口。为了暴力精神病患者，当你完成后让你的编辑器格式化它。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-09-24T15:38:52.263

在面试中，不缩进或评论你的代码是完全可以的。事实上，如果你有时间这样做，我会感到惊讶——我们通常不会给那么多时间。

但是，作为一般做法，我完全希望您缩进代码并在必要时添加注释。事实上，我们的构建机器会在代码中包含制表符而不是空格等微小的事情上失败。

代码可读性很重要。就像没有人喜欢阅读一大段（而不是小的、结构化的段落）一样，没有人喜欢阅读一大段没有格式的代码。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2008-09-24T15:39:22.307

我很难相信有人会认为没有缩进是个好主意。太傻了，如果他在采访中为我这样做，我也不会给他回电话。

评论有点灰暗，伟大的代码在很大程度上是自我记录的。如果您编写了出色的代码，那么注释应该只在实际情况非常复杂且难以理解的地方出现。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2008-09-24T17:54:42.497

我想知道任何体面的程序员如何在没有缩进的情况下编写代码，无论是在 IDE、vi、记事本、白板上还是在便利贴上完成。缩进代码应该是自然而然的。如果他上交的内容看起来像这样，我不会给他回电话（我只是从 Wikipedia 复制实现，重点是缺少缩进）：

```
struct Node{
data
next
prev
}
struct List{
Node firstNode
Node lastNode
}
function insertAfter(List list, Node node, Node newNode) {
newNode.prev := node
newNode.next := node.next
if node.next = null
list.lastNode := newNode
else
node.next.prev := newNode
node.next := newNode
}
function insertBefore(List list, Node node, Node newNode) {
newNode.prev := node.prev
newNode.next := node
if node.prev is null
list.firstNode := newNode
else
node.prev.next := newNode
node.prev    := newNode
}
function remove(List list, Node node){
if node.prev = null
list.firstNode := node.next
else
node.prev.next := node.next
if node.next = null
list.lastNode := node.prev
else
node.next.prev := node.prev
destroy node
} 
```

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2008-09-24T15:48:21.023

当然，风格很重要。尤其是在涉及缩进和空格之类的事情时。代码应该很容易被人阅读，因为这是一个人以后必须维护该代码。代码的可读性越高，维护起来就越容易，代码的质量最终会变得越高。

有一个心理因素会影响代码风格。当代码“丑陋”且难以阅读/理解时，您希望减少对该代码的所有权，因此个人激励您尽力而为的动力就会减少。随着代码变得更具可读性/易于理解，您对所做的工作感觉更好，并希望获得更多所有权。您对代码的所有权越多，编写更好的代码对个人来说就越重要。

至于微软如何回应，我会以完全相同的方式回应。我认为他们没有给他回电话的回应可能是完全合理的（除了缺乏代码风格之外，可能还有其他因素，尽管我确信这是一个贡献者）。

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2008-09-24T15:49:51.097

好吧，事实是，它寿命最长的软件生命周期阶段是维护。在那段时间里，人们主要阅读和分析它，试图修复它、重用它、增强它等。这是保持它易于阅读和理解的最佳理由。有人说他没有时间担心明显影响可读性的风格，这只是表明他作为软件工程师的不成熟。或者可能根本不了解软件生命周期。

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2008-09-24T15:51:10.580

编程风格非常重要。干净的代码令人赏心悦目，并提高了程序的可维护性。因此，它与程序本身的质量和架构直接相关。

即使在一种强制缩进的语言中，也可以用糟糕的风格打破一切。因此，糟糕的风格可能不是缺少缩进或注释。实际上，我很少使用注释，我更喜欢文档字符串和整体编写更好的文档。如果您确实看到其中有一些需要修复或想知道的地方，我会将注释与您在代码中散布的小注释相关联。

我宁愿把不好的风格看作是不让编程语言为你做一些事情。在一两个地方正确、干净地编写宏确实是好风格而不是坏风格。

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2008-09-24T16:02:44.873

代码风格很重要还有另一个原因。它可以作为确定程序员专业程度的代理。正如孔雀的尾羽展示了他的健康和活力（一个不健康的有机体将无法投入稀缺的资源来建造一条长毛绒的尾巴），程序的风格可以揭示很多关于编写它的人的信息。

当我看到格式错误、命名约定不一致和注释稀少的代码时，我会避开它，不仅因为这样的代码本质上不可读，而且因为代码很可能在这个麻烦的表面下隐藏着更严重的问题。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2008-10-09T20:50:01.873

“他没时间担心风格……” 难怪他们没有给他回电话。他甚至没有参加面对面的采访，他已经拒绝做对他的要求？这是不通过任何专业面试的好方法。

风格是我们所做的一切所固有的。这不是覆盖。它不是一个附加组件。这不是福利。无论我们使用与否，它都存在。事物——程序、产品、你有什么——并没有因风格而得到改进；他们通过拥有良好的风格得到改进（与之相反的只是拥有糟糕的风格）。

从非常注重技术的角度来看，人们的问题是，如果没有任何审美兴趣或欣赏来平衡它，就会认为“风格”是程序员不使用的工具；“风格”的意思是“留给 UI 或营销人员”。这根本不是真的。在努力做到最好的时候，你必须改进工作的各个方面。这不仅意味着执行，还意味着演示。

人类是视觉导向的生物。我们根据它们的外观来选择东西（漂亮女孩！闪亮的包装！）。

在明确宣布他没有时间追求风格时，他基本上给人的印象是他不是微软正在购买的闪亮包装。通过如此明显的预先道歉，他还让评估者更清楚地看到了他缺乏缩进和评论（尽管我相信他们不会仅仅因为他缺乏评论而雇用他）。

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2008-09-24T17:16:26.817

编码风格相当重要。大多数主要的开发公司都有一个文档，其中定义了所需的命名约定、注释指南以及其他与代码样式和架构指南有关的小事。

所有这些都非常好，有助于营造一种工作环境，在这种环境中，团队成员可以对其同事的代码外观抱有良好的期望。

只要确保它不会降低到经理级别，迫使开发人员从这样的代码审查中进行更改：

```
if( someBool() ) doSomething();
else doNothing(); 
```

像这样的事情仅仅是因为他们“感觉”它是“更好”的风格：

```
if( someBool() )
{
    doSomething();
}
else
{
    doNothing();
} 
```

只是请有比个人偏好更好的理由来满足风格要求，我们都可以更快乐。

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2008-09-24T15:39:38.063

如果您在缩进代码上花费的时间比实际编写代码的时间多，那可能是个问题。但是整个解决方案的源代码样式、约定和一致性很重要。

这就是为什么我依靠工具来做到这一点。Resharper 允许我通过按 Ctrl+F、E 组合键来重新格式化所有代码。

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2008-09-24T15:42:30.677

如果想在编写完源代码后丢弃它，可以忽略样式。这适用于您为任务制作的快速脚本，实际上只运行一次。另一方面，本应仅运行一次的任务将在以后重用的频率。

重用可能没问题，但以后很难理解会发生什么。如果你以后想修改代码，你会失去一些风格。

适当的样式有多重要，取决于您将使用和修改代码多长时间以及将使用多少代码。

如果您在团队中工作，请谈谈应该应用哪些样式。

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2008-09-24T15:43:46.370

您的朋友需要正确处理他的优先事项，在我看来，我相信微软会比您认为的更关心。

* * *

## 回答 #22

> 赞同：1
> 
> 时间：2009-02-09T17:23:52.607

据说一个项目80%的生命周期都花在了维护上。如果您的代码不可读，那么您肯定会为维护您的代码的人浪费大量时间，并且不可避免地会让他们对您产生邪恶的想法。

不过，据我所见，大多数程序员团队（有时甚至是整个公司）都有一个文档或其他东西来解释他们所遵循的代码约定和样式。因此，在您在那里工作的第一天，很容易将他们的规则输入到您的 IDE 中，并让它自动格式化您的代码，这样您就不必担心它了。更好的是，您可能会找到愿意“导出”他们的 prefs 文件的人，因此只需单击几下，直到您在该公司编写的所有代码都被完美格式化。

话虽如此，您并不总是可以访问这些特定于团队的约定（例如，在采访中）。遵循一些有意义的基本约定总是一个好主意。根据您的语言，一个好主意是谷歌“您的语言*代码*约定”并阅读基础知识。在面试的情况下，重要的是你遵循一些基本的指导方针，并有一个你坚持的格式风格。如果你在同一行的“else”语句后面加上括号，然后在下一行写下一次，你可能是在告诉面试官你不够关心和/或你没有足够的关心体验一种方式已成为您的习惯。

* * *

## 回答 #23

> 赞同：1
> 
> 时间：2008-09-26T17:55:52.517

这就是需要编码标准的原因。团队应该遵守标准，即使这不是他们通常的编码方式。他可以学到很多东西来维护别人的烂摊子，就像我一样。7000 行 C++ 以 C 风格编写，分为 7 个方法（大多数方法是 600 多行），许多包含转到方法内标签的一行宏。还有很多一行 if 语句，以及添加到这些和其他方法调用末尾的宏，因为您必须滚动才能看到它们。再加上可怕的变量名和不一致的括号样式，你会得到一个无法维护的混乱。积极的一面是它运作良好，我们多年来一直依赖它。

* * *

## 回答 #24

> 赞同：1
> 
> 时间：2008-09-24T17:42:56.473

在我看来，说风格不重要就像说拼写不重要一样。如果您的风格（或缺乏风格）导致可读性问题，那么团队将很难处理此人正在编写/编辑的文件。

同样，如果程序员没有花时间在注释块、函数名称等中正确拼写单词……这将导致其他开发人员试图破译代码时出现问题。我总是问自己，“自己，如果你在1周内看这个，你会明白吗？如果你明年再看，你还会明白吗？” （或者至少能够阅读文档/评论来记忆）。

对我来说，当您谈论将花括号放在 if 块的下一行而不是将其放在条件语句的末尾时，样式并不重要......只要它符合您的编码标准，在内部是一致的，并且团队的其他成员使用相同的方法；话虽如此，我觉得如果它影响代码的可读性，风格就非常重要。

由于 MS 是一家如此大的公司，他们可能正在寻找既能成为问题解决者又能成为团队成员的人。对我来说，那些说他们“没有时间做造型”的人会被认为不是团队合作者。

好问题！

* * *

## 回答 #25

> 赞同：1
> 
> 时间：2008-09-24T15:53:15.830

我一直觉得你可以指望的一件事是，在你离开后查看你的代码的人会认为你是个白痴。关键是最大化从第一次查看代码到他们做出决定之间的时间。

良好的格式是增加 N 的一种方法，有用的评论是另一种方法。

* * *

## 回答 #26

> 赞同：1
> 
> 时间：2008-09-24T15:54:01.167

这完全取决于谁是源代码的目标受众。正确答案是“其他程序员”（维护者等）。你的同事认为这并不重要，我完全理解为什么 MS 没有雇用他。如果有大公司愿意雇用他，我会感到惊讶！

我记得在“ACM 通信”上出现了一篇题为“[排版风格不仅仅是装饰](http://portal.acm.org/citation.cfm?id=78611&coll=portal&dl=ACM)”的旧文章，该文章对良好格式化代码对生产力的影响进行了实验。

他们带了一群程序员，给他们一个测试来给他们排名。然后他们将小组分成两组，两组相同的任务：修改一个软件以添加一些功能。

只是第一组有一个格式很好的源代码可以处理，而其他组有一个相当混乱的相同代码版本。

他们再次测量了他们的生产力，最终结果是第一组中最差的程序员比第二组中更好的程序员得分更高。

从那时起，我总是付出额外的努力，使我的代码清晰易读。

对于那些对该主题感兴趣的人，我建议阅读有关文学编程、有意编程和其他相关概念的内容。

* * *

## 回答 #27

> 赞同：1
> 
> 时间：2008-09-24T16:03:07.680

关于“风格”（我宁愿称之为“格式”）：这在很大程度上是个人品味的问题，但是在团队中工作非常重要，定义一些每个人都必须遵循的指导方针，如果需要，可以改变他/她的个人喜好（在在 Eclipse 中，我们导出格式化程序配置，并通过按键将文件格式化）。很快每个人都会习惯标准，阅读代码也不会那么疲劳。

关于评论：我更喜欢为我的方法命名，但对最晦涩的部分的两个评论是强制性的。

* * *

## 回答 #28

> 赞同：1
> 
> 时间：2008-09-24T16:07:59.900

您可以争辩说，编写良好的代码不需要注释，或者至少不需要很少的注释。但是没有缩进是不可接受的。编译器确实关心（在大多数情况下），但维护代码的人关心。

* * *

## 回答 #29

> 赞同：1
> 
> 时间：2008-09-24T16:30:26.303

我不介意他没有立即发表评论。但是缩进很重要。当您编写代码时，它很少会在一次打字狂潮中线性出现。

不，即使在测试和可能调试代码之前，通常也需要进行大量编辑，并且能够清楚地看到代码结构很重要。

这让我想起了我职业生涯早期发生的一件事。我是一名初级程序员，另一位初级程序员向我寻求一些关于他的代码的帮助。我们当时正在使用 Pascal。他的代码一团糟。我以前见过没有缩进的代码，但从未见过随机缩进的代码。没有办法跟随它。

所以，我做的第一件事就是修复缩进。他得意地说。“我认为*这*不会解决它！”。我回头看了看代码。这个错误现在很容易发现，所以我只是指着它走开了。

* * *

## 回答 #30

> 赞同：1
> 
> 时间：2008-11-04T17:41:21.703

嗯，有生活，然后有采访。

问问你的朋友——他会穿着破烂的牛仔裤和肮脏的 T 恤参加面试吗？

他在采访中的任务（无论采用何种形式）是为了给进行采访的人留下深刻印象。给他们留下深刻印象，让他们得到一份工作。

所以如果申请程序员的工作，为什么这个人会提交“破烂牛仔裤和肮脏的T恤”代码？

我真的希望这个人对编码风格、注释和空白有一些线索。在那种情况下，他判断面试官更关心“正确”而不是“善良”（我的解释）。

但是 - 考虑到任务（链表？这对程序员来说应该很容易），看起来任务不仅仅是代码的“正确性”。

我怀疑面试官正在寻找很多东西，包括良好的编码实践（“忘掉”糟糕的编程实践比一开始就做好1000倍难）。面试官可能也在寻找一些东西来表明主动性、良好的假设能力，甚至可能是创造力或创造性。

例如，有很多方法可以编写“正确”的链表，但有些方法（如使用递归）被认为比其他方法更“优雅”。

我怀疑你的朋友在这次采访中的几个层面都没有达到标准。

-R

* * *

## 回答 #31

> 赞同：1
> 
> 时间：2009-07-20T11:41:14.747

我倾向于认为编码风格实际上更多地反映了我们是那种软件程序员。

如果我们编写草率的代码而不关心这个世界，是的，那么我会认为我们表现出一种我们不尊重其他团队成员的态度，*但是*如果我们花时间以一种可以理解的风格编写并且有意识地尝试确保我们的代码清晰易读且结构正确，那么我们确定我们对团队有尊重的态度吗？

风格更多的是关于我们是谁，而不是关于我们所知道的。

* * *

## 回答 #32

> 赞同：0
> 
> 时间：2008-09-24T20:39:32.117

IDE、编程编辑器和代码重新格式化程序就在那里。商店应采用适合其目的的风格，并根据需要使用重新格式化程序。

简而言之，分隔符的缩进和放置不再是什么大问题了。

* * *

## 回答 #33

> 赞同：0
> 
> 时间：2008-09-24T15:43:52.577

强调可读性很重要的风格。极其重要。

许多程序员争论注释的频率和使用，但大多数人认为它们是必要的。

* * *

## 回答 #34

> 赞同：0
> 
> 时间：2008-09-24T15:45:22.467

我不希望被采访者评论他们的代码（假设他们是在采访中当场编写的）。如果我采访的是有经验的人，但他们没有缩进代码，那么这肯定会对他们不利。我不希望缩进是完美的，或者是我喜欢的风格，或者其他任何东西。但最好是缩进的。这是编写代码的一部分。

如果我正在招聘一个没有经验的人（我通常是），那没关系。但我也不会要求他们写一个双向链表。

* * *

## 回答 #35

> 赞同：0
> 
> 时间：2008-09-26T17:26:09.263

我认为缩进是自然而然的。我只是这样做，每次我自动写一些东西。不这样做会让我感到困惑。

* * *

## 回答 #36

> 赞同：0
> 
> 时间：2008-09-24T18:01:35.743

如果没有缩进，我什至不会阅读他的代码，更不用说标记它。没有时间是一个可怕的借口，在你输入的时候缩进一段代码需要几秒钟的时间……更不用说大多数编辑器自动缩进的事实。评论也许他可能已经没时间了，但即便如此，这仍然是一个非常糟糕的借口。对您刚刚编写的一段代码进行注释并不需要很长时间。

* * *

## 回答 #37

> 赞同：0
> 
> 时间：2008-09-25T00:27:20.743

在面试的编码测试中不显示评论就像参加考试并且没有显示任何工作！

当然，评论应该是对程序员策略和思维的洞察之一？

* * *

## 回答 #38

> 赞同：0
> 
> 时间：2008-09-25T00:35:08.883

我开始注意到代码就像一个蓝图。一个精心策划、美丽、精湛的豪宅设计蓝图将是结构良好且有用的。代码应该是一样的。

* * *

## 回答 #39

> 赞同：0
> 
> 时间：2008-09-24T15:49:57.523

我认为我们被评判的大部分是外观或风格，很难看到没有缩进或注释的一段代码并看到其中的天才。大多数人会认为它太复杂了，让我们重写它。

在提交之前，我可能会阅读 Microsoft 代码样式指南。就像你不会带着脏衣服去面试一样，我不会提交未缩进的不可读代码

俗话说....编写新代码就像性，快速而令人兴奋...维护代码就是照顾因性而产生的孩子，漫长，困难，有时非常令人沮丧...。哦，有益而有趣也...

* * *

## 回答 #40

> 赞同：0
> 
> 时间：2008-09-24T15:58:55.880

我认为评论是一把双刃剑，因为过多的评论肯定会导致可读性降低。杰夫为此写了一篇出色的[文章](http://www.codinghorror.com/blog/archives/001150.html)

相反，缩进永远不会伤害并大大增加可读性。这就是为什么这么多人喜欢 Python 的重要原因之一。

* * *

## 回答 #41

> 赞同：0
> 
> 时间：2008-09-24T16:01:55.217

编程风格不仅限于代码识别和注释。
代码标识确实对代码的易懂性非常重要。我从未见过易于阅读的未缩进代码:)。
同样非常重要的是代码是不言自明的，只有当实现由于各种原因变得神秘或代码没有清楚地反映作者为什么这样写时，才应该使用注释。我看到很多过度注释的代码，我可以告诉你，几乎每一行都看到注释就像阅读侮辱性的页面一样。
无论如何，我怀疑微软拒绝你的同事只是因为他没有评论双链表的实现。

* * *

## 回答 #42

> 赞同：0
> 
> 时间：2008-09-24T16:17:54.400

我尝试使用 IDE 格式化样式。因此，我们避免了关于如何编写代码的新的和无聊的定义，因此，由于缩进和格式的差异而导致不必要的合并。

即使是最愚蠢的代码，文档也是强制性的。最好有一个模板来在代码中生成文档行。团队内部的标准化和组织协议是最好的风格。

* * *

## 回答 #43

> 赞同：0
> 
> 时间：2008-09-30T18:54:35.070

上面已经提到了这方面的几种观点。基本上，样式和注释有助于可维护性。

代码是为程序员（包括你自己！）而不是为编译器编写的。如果我们从不需要阅读代码，只需用六角键盘将其打入（就像真正的程序员一样！）并完成它！:-)

但几乎从来都不是这样。在代码的整个生命周期中，编译器可能会花费几秒钟的时间来处理它。但是程序员可能会花几天时间。如果难以阅读或理解，这些天数可能会增加到数周。**应该**努力使代码自我记录，但不要依赖它。曾经。

缩进显示控制流。一堆没有缩进的行可能有控制流，但这意味着你必须阅读每一行来检测它：

```
if(someSituation) somethingElse++; 
```

对比

```
if(someSituation)
    somethingElse++; 
```

第二个版本在视觉上跳出来。您无需阅读和理解代码即可看到做出的决定。在扫描某些代码以快速找到某些内容时非常重要。

大多数 IDE 和编程编辑器都允许您立即缩进一段代码。这非常容易，您应该这样做只是为了确保您没有悬空的“else”或其他一些操作员顶空问题。缺乏缩进是**很难**证明的。

评论也很重要。如果注释与代码不匹配，那么它们都是错误的（我不记得是谁先说的，但他/她已经死了！）。

我在第一次布局代码时放了一个注释块，然后编码和调试，然后再次检查注释。我可能会发现我误解了问题（更改注释）或者我可能实施了错误的事情（更改代码）。或者我可能会发现我重新实现了一个库函数（暂时将其全部注释掉，以防我需要做一些奇怪的事情）并调用该函数。

有时您必须使用名称错误的库函数。您可以说 RTFM 并继续前进，或者您可以输入摘要评论并为下一个程序员（可能在 6 个月内）节省一些精力。

```
// This allocates space for the message queue and initializes
// some OS overhead. All that remains after this is adjusting
// priority and content and then send the message.
prepareMessage(&myMessage); 
```

此外，如果您花了 2 天时间解决一个错误并在代码中进行了一些小的更改，那么很有可能在设计时更改并不明显。否则它本来就在那里！因此，需要发表评论以防止将来有人将其更改回“显而易见的”实现。

```
memset(&myStatus, 0, sizeof(myStatus));

// The size member must be set before getting current values.
// This is used by library function GetCurrentStatus() to infer
// a version of the status structure.
myStatus.length = sizeof(myStatus);

GetCurrentStatus(&myStatus); 
```

* * *

## 回答 #44

> 赞同：-1
> 
> 时间：2008-09-24T15:41:52.817

当谈到申请工作时的编码时，我认为解雇一个没有评论/缩进他编写的代码的候选人有点苛刻，除非他被明确要求这样做。

* * *

## 回答 #45

> 赞同：-3
> 
> 时间：2008-09-24T15:50:13.530

**不**

编程风格绝对不重要。重要的是**可维护性**和可读性。

为确保您保持在正轨上，您必须使用**同质且可读的代码格式**来强制您的团队。哪一个无关紧要：你不能取悦任何人，并且有软件可以更改代码格式。

如果一种语言接受**多种范式**，不要试图只选择一种。只要代码得到很好的注释并且可以完成工作，谁在乎这个人使用的是函数式还是命令式的风格？

# .net - ASP .Net 服务器控制事件顺序

> ID：127918
> 
> 赞同：3
> 
> 时间：2008-09-24T15:35:22.410
> 
> 标签：.net, asp.net, events

哪些是 ASP .Net 服务器控件的事件，它们的顺序与包含页面的事件有何关系？

具体问题是我正在寻找在包含页面的*Page_Load事件之前触发的服务器控件内的事件。*

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-24T15:45:19.003

关于它们与 Page 事件的关系，至少对于 Init 和 Load：

“虽然 Init 和 Load 在每个控件上都递归发生，但它们以相反的顺序发生。每个子控件的 Init 事件（以及 Unload 事件）发生在为其容器引发相应事件之前（自下而上）。但是容器的加载事件发生在其子控件的加载事件之前（自上而下）。”

来自[http://msdn.microsoft.com/en-us/library/ms178472.aspx](http://msdn.microsoft.com/en-us/library/ms178472.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-24T15:42:13.347

这应该会有所帮助：http: [//msdn.microsoft.com/en-us/library/ms178472.aspx](http://msdn.microsoft.com/en-us/library/ms178472.aspx)

我想你正在寻找 PreLoad。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-24T15:42:19.743

看看这个[页面](http://msdn.microsoft.com/en-us/library/ms178472.aspx)。它会让你知道什么时候触发什么事件。看起来您可以使用[PreLoad](http://msdn.microsoft.com/en-us/library/system.web.ui.page.preload.aspx)事件。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-24T15:42:17.653

这是一个小问题，因为可以在“Page_Load”事件之后将控件放置在页面内。

在我的一个历史项目中，我从我的类“PageEx：System.Web.UI.Page”中派生了所有页面。其中有一个类型为“enum PageStates { PreInit, Init, PostInit, PreLoad, /* etc... */ }”的属性“CurrentState”。比我所有的控件都能够识别页面周期的状态。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-12-11T16:32:38.610

[ASP.NET 2.0 事件顺序](http://blogs.windwardreports.com/davidt/2010/12/aspnet-20-event-order.html)中有一个更长的列表（注意这是针对 2.0 的）。

# c# - 为什么我的所有 WinForm 控件和表单都没有本地化？

> ID：127929
> 
> 赞同：1
> 
> 时间：2008-09-24T15:37:14.857
> 
> 标签：c#, .net, localization

大家好，

我正在尝试本地化 .NET/C# 项目。我正在使用字符串资源文件并将所有表单上的“Localizable”属性设置为“True”。装配文化是空的。resx/resource 文件已成功通过 Lingobit、resgen 和 al。

在运行本地化的可执行文件时，我的*一些*表单没有本地化（我知道设置了 Localizable 标志的表单），而其他表单是。甚至有一些表单是本地化的，但一两个按钮不是。我无法分辨非本地化表单/控件与本地化表单/控件之间的任何区别。

有人知道我可能会错过什么吗？谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-24T17:07:29.477

在 Visual Studio 中打开窗体时，如果将窗体的 Language 属性更改为您本地化的语言，是否存在同样的问题？即使在本地化资源中，非本地化表单/按钮是否仍有可能设置英文文本？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-24T17:11:50.587

是的，我会和安迪一起去，并对资源文件的内容持怀疑态度。我们曾一度涉足本地化，遇到了许多问题，但这肯定不是其中之一。

如果不是这样，那么您如何测试您的应用程序？如果您还没有尝试过，我建议您启动一组安装了外语版本的 Windows 的虚拟机（而不是仅仅更改您机器上的语言设置），看看这是否有什么不同。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-24T20:41:00.227

好吧，我想通了。你们是对的。我们没有从 Lingobit 正确生成翻译的 resx 文件。一些文件会被翻译，而另一些文件的英文文本仍在 resx 中。

谢谢你的帮助！

编辑：只是为了扩展这一点，我们专门弄乱了 al.exe 命令，该命令采用二进制 .resources 文件并创建一个附属程序集，将其添加到可执行文件的清单中。在 /embed 命令中，您必须将资源文件绑定到命名空间。我们的顶级名称空间已正确映射，但我们并未绑定到所有资源文件上的子级名称空间。

# svn - SVN 中的工作副本 XXX 被锁定并且清理失败

> ID：127932
> 
> 赞同：591
> 
> 时间：2008-09-24T15:37:37.943
> 
> 标签：svn, tortoisesvn

当我执行以下操作时出现此错误`svn update`：

> 工作副本 XXXXXXXX 已锁定 请执行“清理”命令

当我运行清理时，我得到

> 清理未能处理以下路径：XXXXXXXX

我如何摆脱这个循环？

* * *

## 回答 #1

> 赞同：522
> 
> 时间：2008-09-24T15:47:13.240

一种方法是：

1.  将编辑的项目复制到另一个位置。
2.  删除包含问题路径的文件夹。
3.  通过 Subversion 更新包含文件夹。
4.  根据需要复制您的文件或合并更改。
5.  犯罪

另一种选择是删除顶级文件夹并再次签出。但希望它不会变成那样。

* * *

## 回答 #2

> 赞同：482
> 
> 时间：2009-08-28T03:10:04.380

对我来说，诀窍是`svn cleanup`在我的工作副本的顶部运行，而不是在问题发生之前我一直在工作的文件夹中。

* * *

## 回答 #3

> 赞同：210
> 
> 时间：2009-07-14T13:41:02.577

查看您的`.svn`文件夹，其中将有一个名为`lock`. 删除该文件，您将能够更新。`.svn`每个子目录的目录下可能会有更多的锁文件。他们也需要删除。这可以很简单地从命令行批量完成，例如

```
find . -name 'lock' -exec rm -v {} \; 
```

请注意，您正在手动编辑文件`.svn`夹中的文件。他们被放在那里是有原因的。这个原因可能是一个错误，但如果不是，您可能会损坏您的本地副本。

来源：[http ://www.svnforum.org/2017/viewtopic.php?p=6068](http://www.svnforum.org/2017/viewtopic.php?p=6068)

* * *

## 回答 #4

> 赞同：109
> 
> 时间：2012-09-07T22:09:48.873

在我的情况下，我通过手动删除 WC_LOCK 表中 SQLite ".svn\wc" 文件锁定记录中的记录来解决它。

我用 SQLite 编辑器打开了“WC”文件并执行了

```
delete from WC_LOCK 
```

![显示从 WC_LOCK 清除的所有条目的屏幕截图](https://i.stack.imgur.com/4kHDR.png)

按照[eakkas](https://stackoverflow.com/questions/127932/working-copy-xxx-locked-and-cleanup-failed-in-svn#comment27331761_12326057)的评论，您可能还需要从`WORK_QUEUE`表中删除所有条目。

* * *

## 回答 #5

> 赞同：103
> 
> 时间：2016-02-04T04:41:39.907

最简单的方法：

1.  转到**Project**的**父目录（文件夹）**。
***   按**右键单击***   按**T​​ortoiseSVN**然后按**清理...***   清理对话框将自动出现*   选择`Clean up working copy status`, `Break locks`, `Fix time stamps`, `Vacuum pristine copies`, `Refresh shell overlays`,`Include externals`*   按**确定****

 **你成功地完成了你的工作。

检查屏幕截图以供参考。

**第一步：**

[![在此处输入图像描述](https://i.stack.imgur.com/qpCIB.png)](https://i.stack.imgur.com/qpCIB.png)

**第二步：** 启用 Break lock 选项（清理弹出窗口中的第二个复选框） [![在此处输入图像描述](https://i.stack.imgur.com/j27IJ.png)](https://i.stack.imgur.com/j27IJ.png)

希望这会对您有很大帮助。

* * *

## 回答 #6

> 赞同：48
> 
> 时间：2008-09-24T15:49:21.347

一个同事在工作中经常看到这个消息，对他来说是因为他删除了一个SVN版本控制下的目录*而没有*从SVN中删除它，然后在它不受版本控制的地方创建了一个新目录，同名。

如果这是您的问题...：

有不同的方法来修复它，这取决于目录被替换的方式/原因。

无论哪种方式，您都可能需要：

A) 将现有目录重命名为临时名称

B) 执行 SVN 还原以恢复从文件系统中删除的目录，而不是从 SVN 中删除的目录

从那里，你要么

A) 将相关文件复制到被删除的目录中

B）如果目录中的内容发生重大变化，请对原始目录执行 SVN 删除，提交并将新目录重命名为所需的名称，然后添加 SVN 以使*该*目录处于版本控制之下。

* * *

## 回答 #7

> 赞同：38
> 
> 时间：2017-05-15T18:10:50.377

对我来说，上述解决方案都没有奏效。我通过打破锁找到了解决方案。当我执行 svn cleanup 时，我选择了“Break Locks”和“Clean up working copy status”。

[![在此处输入图像描述](https://i.stack.imgur.com/FE7cX.png)](https://i.stack.imgur.com/FE7cX.png)

* * *

## 回答 #8

> 赞同：23
> 
> 时间：2013-05-10T03:05:02.467

这个对我有用。

1.  转到根文件夹，
2.  右键单击并清理
3.  检查所有可用选项
4.  按确定

清理后，它将允许您更新到最新版本。

* * *

## 回答 #9

> 赞同：11
> 
> 时间：2013-08-19T18:16:33.383

对我来说，这实际上是乌龟的错，有点。乌龟只是抱怨“无法清理，运行清理”，但是当我运行命令行（svn cleanup）时，它清楚地告诉我它无法删除一些正在使用的文件，解决方案很明显。一旦我关闭了 Visual Studio（它使文件保持打开状态），那么清理工作就很好了。

其他程序也可以在 repo 中保持文件打开，从而导致此问题。Excel 保持打开 xls 在另一个实例中是罪魁祸首，因此关闭所有可能使用 repo 中任何内容的程序甚至重新启动以强制程序关闭然后再次尝试清理可能是明智的。

* * *

## 回答 #10

> 赞同：7
> 
> 时间：2010-05-18T15:05:07.343

我遇到了这个问题，因为外部文件夹不想链接到现有文件夹。如果在目标是现有（版本化或非版本化）文件夹的位置添加 svn:externals 属性行，您将收到 SVN Woring Copy locked 错误。在这里清理也会告诉你一切都很好，但仍然无法更新。

解决方案：从存储库中删除麻烦的文件夹，并在设置了 svn:externals 属性的根文件夹中进行更新。这将创建文件夹，一切都会再次好起来的。

这个问题对我来说是因为 svn:externals 文件需要目标文件夹进行版本控制。在我注意到这在不同的存储库中不起作用之后，我从外部文件交换到外部文件夹并陷入了这个混乱。

* * *

## 回答 #11

> 赞同：6
> 
> 时间：2010-03-15T21:09:00.040

最简单的方法是显示隐藏文件夹，然后打开 .SVN 文件夹。您应该会看到一个名为“lock”的零 KB 文件，删除这将解决问题

* * *

## 回答 #12

> 赞同：5
> 
> 时间：2012-11-12T08:25:34.037

我使用 SVN 1.7 遇到了完全相同的问题，上面提到的修复都没有奏效。

首先，请确保备份所有已编辑的内容。

花了几个小时后（没有重新下载所有内容，因为我的分支大小超过 6gb），我发现分支的 .svn 文件夹中有一个名为“wc”的 db 文件。

使用任何 db 管理器（我使用 firefox 的 sqlite manager 插件）打开 db 文件并导航到 WC_LOCK 表。该表将包含已获取锁的条目。从表中删除记录，你就完成了:)

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2009-07-16T19:01:01.543

当我遇到这个问题时，我发现直接在问题路径上运行清理命令通常似乎有效。然后我将再次从工作根目录运行清理，它会抱怨其他一些目录。我只是重复，直到它停止抱怨。

* * *

## 回答 #14

> 赞同：3
> 
> 时间：2010-05-04T07:55:38.327

如果您在 Windows 机器上，通过浏览器查看存储库，您很可能会看到两个文件名相同但大小写不同的文件。Subversion 区分大小写，而 Windows 不区分大小写，因此当 Windows 认为它​​正在拉下同一个文件而 Subversion 没有时，您可以获得锁定。删除存储库中重复的文件名，然后重试。

* * *

## 回答 #15

> 赞同：3
> 
> 时间：2011-06-03T19:12:37.350

我通过创建一个新文件夹、签出项目、将更新的文件复制到新文件夹来做到这一点。

它是通过新的结帐修复的。

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2008-09-24T15:43:28.570

您是否使用 TortoiseSVN 并且刚刚升级？我之前从 1.4 移动到 1.5 并且没有重新启动时遇到过这个问题。（尝试重新启动）。

您需要重新启动的原因是因为缓存文件变得很时髦。

否则，继续前进，将该工作副本导出到新文件夹（不要复制 .svn 隐藏文件夹），重新签出项目，然后将所有代码移回，然后继续提交。

* * *

## 回答 #17

> 赞同：2
> 
> 时间：2009-06-11T14:57:14.797

只需删除 .svn 文件夹，然后在父目录上运行清理。完美运行！！

* * *

## 回答 #18

> 赞同：2
> 
> 时间：2012-07-31T14:16:09.693

在 Mac OS 下的版本中：操作 -> 清理工作副本锁定在...

* * *

## 回答 #19

> 赞同：2
> 
> 时间：2017-04-10T10:52:43.153

我经常遇到这样的问题。我的模式导致清理问题。

1.  我在查看器中打开图像文件。
2.  我删除图像文件/文件夹。
3.  我正在尝试提交/更新

关闭打开已删除文件的图像查看器可以解决问题。也许其他软件可以以同样的方式阻止清理。

一般来说。我相信在这种情况下重新启动计算机可能会有所帮助。

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2009-03-02T22:18:15.543

SVN 通常会在从存储库中获取实际文件之前更新其文件夹中文件的内部结构（.svn/prop-base）。一旦文件被提取，这将被清除。由于“更新”失败或在更新过程中过早取消，因此经常引发错误。

1.  检查 .svn/prop-base 目录下列出的所有文件
2.  删除不在文件夹下的所有文件
3.  清理
4.  更新

现在更新应该可以工作了。

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2009-03-12T14:41:00.583

有同样的问题，因为我在版本控制的文件夹下导出了一个文件夹。必须从 TortoiseSVN 中删除该文件夹，然后从文件系统中删除该文件夹（TortoiseSVN 不喜欢未版本控制的子文件夹......为什么不呢？？？）

* * *

## 回答 #22

> 赞同：1
> 
> 时间：2010-04-26T10:22:39.037

我在 TortoiseSVN 下有这个，错误与我在新项目下创建的新目录有关。我刚刚创建了这个项目，所以这个目录以前不可能存在。我查看了存储库浏览器，新文件夹确实已经在存储库中，但是 TortoiseSVN 并没有将其显示为已提交。

为了解决这个问题，因为我刚刚创建了文件夹，所以我在存储库中删除了它，然后进行了提交。它工作得很好。

由于我是在 Visual Studio 之外执行此操作的，因此我必须重新启动 Visual Studio 才能再次解决所有问题。

* * *

## 回答 #23

> 赞同：1
> 
> 时间：2010-05-20T20:01:42.917

开始搜索......锁定......选择列出的所有文件并删除......已修复

* * *

## 回答 #24

> 赞同：1
> 
> 时间：2010-06-23T22:33:45.750

以下应该做：

svn 状态 | grep ".l" | sed 's/.* (.*)$/\1/' | awk '{打印长度($1),$1}' | 排序-nr | awk '{print "pushd" $2"; svn cleanup ; popd"}' | 嘘

* * *

## 回答 #25

> 赞同：1
> 
> 时间：2010-07-06T10:25:26.157

不要删除您的解决方案！

在 .svn 文件夹中，您有一个名为 lock 的文件，它的长度为 0 字节

您可以从解决方案中的所有 .svn 文件夹中删除所有这些文件，它会起作用

它适用于我的情况

* * *

## 回答 #26

> 赞同：1
> 
> 时间：2010-10-19T02:06:17.350

如果你在 Linux 上，试试这个：

```
find "/the/path/to/your/directory" -name .svn -type d | xargs chmod 0777 -R 
```

然后在该目录上运行`cleanup`命令，然后尝试更新。

* * *

## 回答 #27

> 赞同：1
> 
> 时间：2011-01-11T18:10:58.550

文件的就地取消版本化，以及重新签出到同一位置，为我解决了这个问题。

在 TortoiseSVN 中，要进行就地取消版本化，请将工作副本的根文件夹从文件列表中右键拖动到目录树中的自身上，然后从弹出菜单中选择“SVN Export versioned items here”。TortoiseSVN 注意到目标与源相同，并建议取消对工作副本的版本控制。

取消版本化后，重新检出同一个文件夹（其中现在包含您拥有的所有文件的未版本化副本）。TortoiseSVN 会警告您正在签出到现有文件夹，但您可以继续。

在此之后，清理、更新和其他操作顺利进行。由于上述两个步骤都保留了本地修改，因此不应丢失任何信息（但在此之前备份工作副本可能是个好主意）。

一个警告：如果工作副本包含混合版本或未提交的属性更改，则该信息将丢失。对我来说，这并不常见，考虑到选择损坏的工作副本或丢失未提交的属性更改，我倾向于选择后者。

* * *

## 回答 #28

> 赞同：1
> 
> 时间：2011-10-21T16:56:08.903

我在“清理”工作的地方遇到了这个问题，但“更新”会继续失败。有效的解决方案是通过 Windows 资源管理器删除有问题的文件夹，而不是 TortoiseSVN 的删除（这将删除标记为提交到存储库的内容，然后我进行了“签出”以从存储库中“更新”文件夹。

有关 O/S 删除和 SVN 删除之间区别的更多信息：http: [//tortoisesvn.net/docs/release/TortoiseSVN_en/tsvn-dug-rename.html](http://tortoisesvn.net/docs/release/TortoiseSVN_en/tsvn-dug-rename.html)

尤其：

> 当您 TortoiseSVN → 删除一个文件时，它会立即从您的工作副本中删除，并在下次提交时在存储库中标记为删除。

和：

> 如果通过资源管理器而不是使用 TortoiseSVN 上下文菜单删除文件，则提交对话框会显示这些文件，并允许您在提交之前将它们从版本控制中删除。但是，如果您更新您的工作副本，Subversion 将发现丢失的文件并将其替换为存储库中的最新版本。

* * *

## 回答 #29

> 赞同：1
> 
> 时间：2012-06-13T21:07:32.693

我做了以下事情来解决我的问题：

1.  通过在文件夹名称前放置“_”来重命名有问题的文件夹。
2.  对父文件夹进行了“清理”。
3.  将有问题的文件夹重命名为原始名称。
4.  做了一个承诺。

* * *

## 回答 #30

> 赞同：1
> 
> 时间：2013-09-26T10:46:56.637

在解决方案资源管理器中，右键单击项目，在打开的子菜单中单击颠覆并选择清理。它将解决问题，就像对我一样。希望它会奏效。

* * *

## 回答 #31

> 赞同：1
> 
> 时间：2015-07-29T12:14:35.863

进行清理

1.  删除 .svn 文件夹。

2.  在根文件夹中执行 svncheckout。

3.  尝试执行清理操作。

这解决了我的问题。

* * *

## 回答 #32

> 赞同：1
> 
> 时间：2015-07-31T13:24:20.987

对我来说，问题出在完全满的磁盘驱动器上（在我的情况下是 linux inodes），当我删除一些文件夹时，它又开始工作了。

错误如下（在任何 svn 操作上）：

```
$ svn cleanup
svn: E155004: Run 'svn cleanup' to remove locks (type 'svn help cleanup' for details)
svn: E155004: Working copy locked; try running 'svn cleanup' on the root of the working copy ('/my/directory') instead.
svn: E155004: Working copy '/my/directory' locked
svn: E200030: sqlite[S14]: unable to open database file
svn: E200030: Additional errors:
svn: E200030: sqlite[S14]: unable to open database file 
```

* * *

## 回答 #33

> 赞同：0
> 
> 时间：2010-10-22T01:12:22.930

@Chuck 的解决方案对我来说并不实用。在我第一次遇到这个问题时，它起作用了，但也给了我很多额外的工作。在第二种情况下，我在网络外使用笔记本时更改了文件负载。更改文件后，我看不到自己一个文件夹一个文件夹。对乌龟抱有希望并努力了。怎么看：

环境是：

1.  视觉工作室 2008
2.  安赫斯文

程序：

1.  首先我无法提交，它说我需要清理
2.  其次，我无法清理，svn中有一个文件夹-“bin”
3.  我下载了 Tortoise 最新版本，尝试过但由于文件夹损坏而无法正常工作。
4.  重命名该文件夹，现在我可以使用最新版本更新本地存储库。
5.  几个文件进来了。
6.  提交并工作。

* * *

## 回答 #34

> 赞同：0
> 
> 时间：2011-02-11T03:45:16.560

我的根目录中有一个文件搞砸了。（没有锁定文件，svn 清理失败等）我的整个结帐大于 2GB，网络速度很慢，所以再次检查所有内容对我来说不是一个*好*选择。

什么对我有用：

1.  在混乱的工作副本中还原和还原更改（#1）。
2.  使用 --depth empty 签出另一个 repo (#2) 副本
3.  在新的工作副本（#2）中添加并提交了文件。
4.  在原始工作副本 (#1) 中更新。

对我来说似乎恢复了正常。

* * *

## 回答 #35

> 赞同：0
> 
> 时间：2012-05-10T15:25:12.093

更新目录权限（授予写入权限）也可以解决问题。

```
chmod +w <dir_name> 
```

* * *

## 回答 #36

> 赞同：0
> 
> 时间：2013-04-03T08:36:25.313

我有同样的问题。似乎它已在最新版本中修复。我已将我的更新`Tortoise SVN`到最新版本（1.7.11）并且`clean up`运行良好。

你可以在这里下载最新版本：[downoad tortoise svn](http://tortoisesvn.net/downloads.html)。

* * *

## 回答 #37

> 赞同：0
> 
> 时间：2013-04-10T16:18:01.373

我知道这是一个非常古老的线程，但我坚持认为：

解决此问题的最简单和最安全的方法是删除隐藏的“.svn”文件夹并再次检查所有内容。

当您再次检查头部修订时，当 svn 螺丝应该保留本地更改（标记为“冲突”）时，它修复了大多数问题。

* * *

## 回答 #38

> 赞同：0
> 
> 时间：2013-05-17T19:38:14.723

有时清理肯定不足以解决这个问题。

如果您使用 TortoiseSVN v1.7.2 或更高版本，请右键单击锁定文件的父目录，然后从菜单中选择 TortoiseSVN -> Repo Browser。在 Repro 浏览器 GUI 中，右键单击被锁定的文件，将有一个选项来取消锁定。

* * *

## 回答 #39

> 赞同：0
> 
> 时间：2014-01-07T05:45:37.480

**脚步 ：**

1.  关闭 svn 文件夹中的所有编辑文件

2.  关闭 eclipse 或任何使用 svn 目录中的文件夹或文件的编辑器。

3.  右键单击 svn check out 文件夹，然后单击释放锁定。

4.  右键单击 svn 签出文件夹，然后单击清理。

5.  您的 SVN 已准备好进行 SVN 提交和更新操作。

**干杯:)**

* * *

## 回答 #40

> 赞同：0
> 
> 时间：2015-07-31T13:15:06.517

今天我遇到了上面的问题说

> svn：运行 'svn cleanup' 来移除锁（输入 'svn help cleanup' 了解详情）

这**是我的解决方案，**开始工作

1.  关闭 Xcode IDE，我试图从那里提交更改。
2.  在 Mac 上 --> 转到终端 --> 键入以下命令

> `svn cleanup <Dir path of my SVN project code>`

示例：

*svn cleanup /Users/Ramdhan/SVN_Repo/ProjectName*

3.  点击进入并等待清理完成。
4.  转到 XCode IDE 并清理并构建项目
5.  现在我可以提交所有更改并进行更新。

希望这会有所帮助。

* * *

## 回答 #41

> 赞同：0
> 
> 时间：2016-04-04T15:20:00.510

我在答案中没有看到这个问题的一个原因是，`update`或者`checkout`可能已经使用其他用户/权限完成了，例如使用`$sudo`.

* * *

## 回答 #42

> 赞同：0
> 
> 时间：2016-04-22T12:26:29.573

首先尝试了很多解决方案，然后我只是删除了我遇到问题的文件夹。

然后执行 SVN 更新。

这对我有用。

我不会推荐它，但除此之外没有任何效果。:(

* * *

## 回答 #43

> 赞同：0
> 
> 时间：2020-10-15T13:50:38.960

在使用 tortoise svn 进行 svn 更新时，该过程被中断并停止抱怨文件正在使用中。接下来它要求我对文件夹使用 CleanUp 命令。我试图运行 CleanUp 命令，但它没有这样做。然后我找到了一个使用文件夹文件的命令外壳。因此，我关闭了命令外壳并检查是否有任何编辑器正在使用与其相关的文件。我们也需要关闭它们。再次，我尝试使用选项 Break locks,revert changes,clear working copy status 对文件夹进行清理。清理成功。然后终于能够更新我的 svn 文件夹。

* * *

## 回答 #44

> 赞同：0
> 
> 时间：2020-11-16T16:53:46.533

无论我尝试了多少种方法，清理都对我不起作用。相反，我从 Visual Studio 单独提交了每个文件夹。然后我提交了顶层文件夹并成功了。

* * *

## 回答 #45

> 赞同：0
> 
> 时间：2021-09-22T08:04:39.427

因为这里没有列出这个答案：我的解决方案是关闭我的 IDE（在本例中为 Netbeans）。似乎IDE已锁定文件。

* * *

## 回答 #46

> 赞同：-1
> 
> 时间：2012-02-23T15:51:13.590

Spotlight 在递归查找锁定文件时通常是垃圾。

Mac App Store 上的 EasyFind 工作

```
http://itunes.apple.com/gb/app/easyfind/id411673888?mt=12 
```

搜索“锁”

全选/删除

* * *

## 回答 #47

> 赞同：-1
> 
> 时间：2014-01-13T07:22:54.297

在对项目结构进行更改时，首先可以通过使用*svn copy*和*svn move等命令来避免这些类型的问题。*请记住 svn 仅检查已添加到 subversion 的文件内部的更改，而不检查物理目录结构的更改。请参阅[http://svnbook.red-bean.com/en/1.7/svn.tour.cycle.html](http://svnbook.red-bean.com/en/1.7/svn.tour.cycle.html)

此外，在提交更改时，svn 首先将更改的“摘要”存储在待办事项列表中。在执行此待办事项列表中的 svn 操作时，它会锁定文件以防止在执行这些 svn 操作时进行其他更改。如果 svn 操作中途中断，比如崩溃，文件将保持锁定状态，直到 svn 可以完成待办事项列表中的操作。这可以通过使用*svn cleanup*命令“重新激活”。请参阅[http://svnbook.red-bean.com/en/1.7/svn.tour.cleanup.html](http://svnbook.red-bean.com/en/1.7/svn.tour.cleanup.html)

* * *

## 回答 #48

> 赞同：-1
> 
> 时间：2014-01-13T15:15:26.740

就我而言，运行 TortoiseSVN 的 Windows 7 机器无法完全重命名文件夹。清理、更新或重命名操作的组合无法解决问题。该文件夹最初是用不同的大小写创建的，Tortoise 或 Subversion 不会将其更改为存储库中的内容。

我的解决方案是：

1.  通过项目外部的 Windows 资源管理器（没有 Subversion 控制文件）复制该文件夹。
2.  通过 TortoiseSVN 删除并提交该文件夹。
3.  通过 Windows 资源管理器使用正确的（当前）名称将文件夹复制回来。
4.  通过 TortoiseSVN 将文件夹添加回存储库。

我在每一步之后都进行了清理。可怕的解决方案，但它对我有用。

* * *

## 回答 #49

> 赞同：-4
> 
> 时间：2014-07-23T04:32:56.533

我相信它对你很好

转到顶级 SVN 文件夹。

右键单击文件夹（包含您的 svn 文件）-> TortoiseSVN -> CleanUp

这肯定会解决你的问题。

# c# - 不使用代码删除自定义事件日志源

> ID：127936
> 
> 赞同：45
> 
> 时间：2008-09-24T15:38:26.477
> 
> 标签：c#, windows, event-log

我有一个应用程序，它创建了许多自定义事件日志源来帮助过滤其输出。如何在不编写任何代码的情况下从机器中删除自定义源，因为无法使用 System.Diagnostics.EventLog.Delete 运行快速程序。

我尝试使用 RegEdit 从 [HKEY_LOCAL_MACHINE\SYSTEM\ControlSetXXX\Services\Eventlog] 中删除自定义源，但是应用程序的行为就像日志仍然存在于幕后一样。

我还缺少什么？

* * *

## 回答 #1

> 赞同：50
> 
> 时间：2008-09-24T17:55:19.003

我还认为您来对地方了……它以事件日志的名称存储在注册表中。我有一个自定义事件日志，其中有多个事件源。

> HKLM\System\CurrentControlSet\Services\Eventlog\LOGNAME\LOGSOURCE1 HKLM\System\CurrentControlSet\Services\Eventlog\LOGNAME\LOGSOURCE2

这些源有一个*EventMessageFile*键，它是*REG_EXPAND_SZ*并指向：

> C:\Windows\Microsoft.NET\Framework\v2.0.50727\EventLogMessages.dll

我认为如果您删除作为日志源的密钥（在我的示例中为 LOGSOURCE1），那么这应该就是所需要的。

对于它的价值，我通过 .NET 进行了尝试，这就是它所做的。但是，看起来每个自定义事件日志也有同名的来源。如果您有自定义日志，则可能会影响您清除它的能力。也许您必须彻底删除日志。此外，如果您的应用程序有安装程序，我可以看到应用程序名称也可能在应用程序事件日志中注册为源。还有一处要清理的地方。

* * *

## 回答 #2

> 赞同：36
> 
> 时间：2015-03-06T16:12:20.440

使用[Powershell](https://msdn.microsoft.com/en-us/powershell/reference/5.1/microsoft.powershell.management/remove-eventlog)怎么样？

```
Remove-EventLog -LogName "Custom log name"

Remove-EventLog -Source "Custom source name" 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2016-05-24T14:40:56.223

我只能使用以下方法删除它：

```
[System.Diagnostics.EventLog]::Delete("WrongNamedEventLog"); 
```

在PowerShell中

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-24T15:46:44.070

也许您的应用程序是容错的，这意味着它会检查事件日志源是否已经注册，如果不是，则注册源？

如果是这种情况，您的应用程序将在每次运行时重新创建源，无论您做了什么。

# keyboard - 是否值得为不使用 Emacs 的 Windows 用户交换 Ctrl 和 Caps Lock

> ID：127973
> 
> 赞同：7
> 
> 时间：2008-09-24T15:45:02.170
> 
> 标签：keyboard, keyboard-shortcuts, touch-typing

尽管我不使用 Emacs，但我已经知道 Steve Yegge 建议[交换 Ctrl 和 Caps Lock有一段时间了。](http://steve.yegge.googlepages.com/effective-emacs#item1)我刚刚尝试将它们作为实验交换，但我发现很难调整。现在有几个快捷键对我来说是第二天性，我还没有意识到它们在我使用键盘的方式中是多么根深蒂固。

特别是，我继续使用旧的 Ctrl 键来执行`Ctrl`+ `Z`（撤消），以及剪切、复制和粘贴操作（+`Ctrl`和`X`）。尝试从起始位置转到 +我不知道该放在哪个手指上，因为我的无名指、中指或食指都感觉很尴尬。这是我会习惯的东西，就像我习惯了原来的位置一样，我应该给它时间，还是**这种安排不适合 Windows 键盘快捷键**。`C``V``Ctrl``Z``Z`

 **我很想听听那些成功过渡的人以及那些尝试过并搬回来的人的意见，尤其是那些在**windows**上做的人。

它会导致我的打字速度或打字时的舒适度有所提高吗？

您对手指位置或打字训练有任何提示以加快过渡吗？

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2008-09-24T15:50:06.540

我实际上不交换控制和大写，只是将大写作为另一个控制键。我想不出在我的生活中曾经有过一次**故意**按下大写锁定，所以我没有错过它。

这样，您就习惯了使用它，但是如果您滑倒并使用旧控件，事情仍然有效。这对我来说效果很好。

这里有一个 .reg 文件可以执行此[操作](http://johnhaller.com/jh/useful_stuff/disable_caps_lock/caps_lock_to_control.reg)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-24T15:48:08.480

我已经做了很长一段时间了，这对我来说很自然，即使我也不是 Emacs 用户（我在那场特定战争的 Vim 阵营中:)）。事实上，转移到其他机器（同事、家庭成员等）让我感到悲伤是很自然的，因为 Ctrl 不在它“应该”的位置。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-24T15:56:30.957

对于 emacs ctrl 应该在大写锁定 - 对于 vim 转义键应该在大写锁定上。我真的觉得大写锁定按钮应该重命名为“免费停车”，并且操作系统应该制作一个系统托盘实用程序来快速将免费停车按钮从逃生，控制，到你需要一遍又一遍地输入的任何东西。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2016-02-03T12:59:20.020

我最终接受了 Zach 的回答中的建议，但如果它在这个要点中使用 AutoHotKey 脚本自行持有和释放，我也会`Caps Lock`表现得像一把钥匙： [CapsLockCtrlEscape.ahk](https://gist.github.com/sedm0784/4443120)`ESC`

在极少数情况下，我还使用此 AutoHotKey 脚本将`Ctrl`++绑定到`Shift`：`Caps Lock``Caps Lock`

```
#IfWinActive
   ^+Capslock::Capslock ; make CTRL+SHIFT+Caps-Lock the Caps Lock toggle
return 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-26T07:14:59.367

几个月前我切换了 Caps Lock 和 Ctrl 键，在最初的学习期之后，大约 1 周，我最大的问题是当我使用没有切换键的计算机时。

我首先做了一些注册表黑客，但我不记得我在哪里找到了如何做的信息。现在我正在使用一个名为 Remapkey 的小实用程序，它包含在 Windows Server 2003 Resource Kit Tools 中，尽管我认为我使用的是旧版本。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-24T15:55:39.057

我在过渡时没有问题。我使用两种配置的键盘都没有问题。也许将其作为硬件解决方案（并正确打印标签）比通过软件更容易，并且必须记住每台机器/键盘的设置方式。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-25T23:55:20.800

我认为最好戴上帽子取决于您的物理键盘。

在家里，我在 Kinesis Ergo Elan 上打字，我的 ctrl 键在我的拇指下，还有 2*alt、space、enter、backspace、delete、pgup、pgdn、home 和 end；键盘的其余部分布置得相当正常，除了板是分开的。

准备好 ctrl 键后，将 escape 放在 caps lock 上确实是最有意义的（并且在 esc 上设置 caps lock，因为我需要它的几次）。即使你是一个 emacser，嘿......它兼作备用的“前缀 alt 键”，你可能会要求你的浏览器每天停止几次它正在做的事情。

另一方面，如果我在我的笔记本电脑上打字，左下角的键是 Fn 而不是 ctrl (ffs ...) 并且我不能用一根手指按住 shift+ctrl，那么放ctrl 盖帽（这样我可以用一根手指握住它们）。至少如果你不是 vi'er，或者你不介意转义键离得更远（或者有一些疯狂的系统）。

真正有趣的是将一些时髦的键放在 shift+shift 上（是的，两个 shift 键）。这可以用 xmodmap 相当简单地完成；我把我的撰写键放在那里。如果你不需要 compose，你可能想放一些别的东西（比如，esc）。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2016-09-20T21:02:18.033

将以下代码复制到名为 caps-ctrl-swap.reg 的文件中，执行该文件，同意允许更改注册表，注销并重新登录，您的 caps-lock 和 left-ctrl 键将被交换。我已经将此脚本用于 2005 年当前的任何 Windows 版本以及介于两者之间的每个版本。我今天需要它，因为 Windows 10 一夜之间更新了，它仍然很好用。

```
REGEDIT4

[HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Keyboard Layout]
"Scancode Map"=hex:00,00,00,00,00,00,00,00,03,00,00,00,1d,00,3a,00,3a,00,1d,00,00,00,00,00 
```

# sql - 嵌套 SELECT 语句

> ID：127974
> 
> 赞同：3
> 
> 时间：2008-09-24T15:45:14.277
> 
> 标签：sql, sql-server, tsql

SQL 不是我的强项，但我正在研究它——谢谢你的回复。

我正在编写一份报告，该报告将返回我们合同中个人服务的完成百分比。有一个主表“合同”，每个单独的合同可以有来自“服务”表的多个服务，每个服务都有多个“标准”表的标准，记录每个标准的完成百分比。

我已经计算了特定 Contract_ServiceID 的每个单独服务的总完成百分比，但是如何返回所有合同的所有服务百分比？像这样的东西：

合同服务完成百分比

* * *

abc 公司服务 1 98%
abc 公司服务 2 100%
xyz 公司服务 1 50%

这是我目前所拥有的：

```
SELECT  
    Contract_ServiceId, 
    (SUM(CompletionPercentage)/COUNT(CompletionPercentage)) * 100 as "Percent Complete"     
FROM    dbo.Standard sta WITH (NOLOCK) 
        INNER JOIN dbo.Contract_Service conSer ON sta.ServiceId = conSer.ServiceId
        LEFT OUTER JOIN dbo.StandardResponse standResp ON sta.StandardId = standResp.StandardId 
            AND conSer.StandardReportId = standResp.StandardReportId

WHERE Contract_ServiceId = '[an id]'
GROUP BY Contract_ServiceID 
```

这也让我明白：

Contract_serviceid 完成百分比

* * *

[身份证] 100%

编辑：表格没有出现在帖子中。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-24T15:55:26.637

您应该能够添加您选择的公司名称和组，以及服务ID并放弃where子句......

或许是这样的：

```
SELECT  
    Contract,
    Contract_ServiceId, 
    (SUM(CompletionPercentage)/COUNT(CompletionPercentage)) * 100 as "Percent Complete"         
FROM    dbo.Standard sta WITH (NOLOCK) 
        INNER JOIN dbo.Contract_Service conSer ON sta.ServiceId = conSer.ServiceId
        LEFT OUTER JOIN dbo.StandardResponse standResp ON sta.StandardId = standResp.StandardId 
                AND conSer.StandardReportId = standResp.StandardReportId
GROUP BY Contract, Contract_ServiceID 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-24T15:55:46.467

我不确定我是否理解这个问题，如果 service_contract 的结果可以，你可以Contract Service

```
SELECT con.ContractId, 
       con.Contract,
       conSer.Contract_ServiceID,
       conSer.Service, 
       (SUM(CompletionPercentage)/COUNT(CompletionPercentage)) * 100 as "Percent Complete"         
FROM    dbo.Standard sta WITH (NOLOCK) 
        INNER JOIN dbo.Contract_Service conSer ON sta.ServiceId = conSer.ServiceId
        INNER JOIN dbo.Contract con ON con.ContractId = conSer.ContractId
        LEFT OUTER JOIN dbo.StandardResponse standResp ON sta.StandardId = standResp.StandardId 
                AND conSer.StandardReportId = standResp.StandardReportId
GROUP BY con.ContractId, con.Contract, conSer.Contract_ServiceID, conSer.Service 
```

确保您拥有从 group by 子句中的 Contract 表中选择的所有列

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-24T15:57:54.353

假设您的查询仅适用于一项服务，看起来您已经完成了大部分工作，请忽略**WHERE**子句以获取所有结果，您的**GROUP BY**将为每个结果处理一项服务。

只需加入**合同**表以显示与每个服务相关的合同，您就完成了。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-24T16:25:13.337

除了删除 where 子句和添加更多组条件之外，您还需要注意每个表中的空记录。这需要将 INNER JOIN 更改为 LEFT JOIN（除非您不想看到这些行）和一些 ISNULL 来清理数据。我不确定 StandardReportId 概念在哪里，但它看起来像是一种过滤机制，我不会玩弄。

```
SELECT  
    ContractID
    ISNULL(Contract_ServiceId, '-1') -- or some other stand in value
    ISNULL((SUM(CompletionPercentage)/COUNT(CompletionPercentage)) * 100, 0) as "Percent Complete"         
FROM    
    Contract AS con
    LEFT OUTER JOIN dbo.Contract_Service conSer ON con.ContractID = conSer.ContractID
    LEFT OUTER JOIN dbo.Standard sta WITH (NOLOCK) ON conSer.ServiceId = sta.StandardID
    LEFT OUTER JOIN dbo.StandardResponse standResp ON sta.StandardId = standResp.StandardId 
        AND conSer.StandardReportId = standResp.StandardReportId
GROUP BY 
    ContractID, Contract_ServiceID 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-24T15:58:07.020

因为您是按合同 serviceid 分组的，所以我认为您可以删除 where 子句，它应该计算所有联系 serviceid 的百分比。

如果 dbo.Standard 中没有该合同 serviceid 的记录，您可能需要从合同服务表到 dbo.Standard 表进行左外连接，以便显示没有完成记录的合同。

我希望这是有道理的...在迁移到数据框架后，我的 SQL 变得生疏了。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-24T17:50:50.667

```
(SUM(CompletionPercentage)/COUNT(CompletionPercentage)) * 100 
```

如果 CompletionPercentage 是一个 int 字段，则整数数学运算会遇到问题。任何时候除以一个整数时，都需要将其乘以 1.0 以确保它将数字视为小数。否则 49/100 将 = 0。************