# StackOverflow 问答 000594000-000594999

# php - Windows 身份验证可以与 IIS 上的 PHP 一起用于 ODBC 连接吗？

> ID：594004
> 
> 赞同：4
> 
> 时间：2009-02-27T08:46:11.950
> 
> 标签：php, sql-server-2005, iis, authentication, odbc

是否可以在 PHP 中使用用户 Windows 身份验证（在 iis 中设置）进行数据库连接？

这在 .NET 世界中可以通过一种称为“模拟”的技术来实现。这是否也存在于 PHP/IIS 世界中？

**编辑**：我使用的数据库是 MS SQL Server 2005。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-03T05:53:22.847

如果您可以使用 Keberos 对 PHP 应用程序进行身份验证，则可以使用 kerberos 委派将凭据传递给辅助服务器。

[Ken Schaefer](http://www.adopenstatic.com/cs/blogs/ken/)有一系列关于 Kerberos 的博客，包括[这篇](http://www.adopenstatic.com/cs/blogs/ken/archive/2007/01/27/1282.aspx)关于委托的文章。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-08T14:28:09.447

通过 Kerberos 进行模拟是最安全的答案，也是最易于管理的方法。在访问数据库等资源时拥有单独的“综合”用户意味着您基本上绕过了数据库授权的所有可能性，获得了重复的访问管理点，并且您在数据库级别获得了零可追溯性（您只看到 MySyntheticUser 试图访问某些东西，而不是谁是幕后黑手）。

说到这里，我应该警告您，Microsoft 的 Kerberos 并不总是像您期望的那样简单。我们很难让它在纯 .NET 解决方案、IIS、SQL Server 2005、AD 域和 Internet Explorer 之间工作。其中大部分归结为正确配置信任。此外，虽然我自己不是 PHP 开发人员，但我发现[一些迹象](http://mailman.mit.edu/pipermail/kerberos/2006-December/010915.html)表明您可能无法访问 Kerberos 库功能。了解您可以获得哪些[SSPI](http://en.wikipedia.org/wiki/Security_Support_Provider_Interface)支持。此外，您的 PHP 进程必须具有模拟用户的必要权限，我相信这可以通过 IIS 进行管理。

我不一定期望所有这些都简单明了，特别是因为微软几乎没有支持非微软语言和平台的动机。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-27T09:48:06.230

必须分别验证每个用户吗？如果没有，您可以将 IIS 设置为模拟一个人。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-05T19:35:34.680

我知道，如果您通过 System DSN 创建它，您可以提供您希望与 ODBC 连接关联的登录名和密码。我假设登录 un/pw 可以是 windows 用户帐户。

这样做似乎会将您限制在预定的帐户中。可以创建一个组，添加所需的用户，密码保护目录并只允许组访问目录。

你没有说你使用的是哪个数据库。如果您使用的是 MS Access，我知道您可以隐藏您的数据库密码。请参阅我[对另一篇文章的评论](https://stackoverflow.com/questions/114996/php-and-ms-access/590768#590768)。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-06T08:18:33.423

您在 PHP 上以哪种方式运行 IIS？作为独立的 CGI 或 ISAPI？

我首选的解决方案是在 SQL Server 上有一个单独的用户进行访问，而不是试图强制 IIS 作为模拟用户运行，这对于开发机器来说很好，但对于生产甚至暂存来说就不太好。

但是，如果您使用的是 FastCGI，则可以使用我记得的配置文件来模拟运行该进程的用户，该配置文件传递用户登录的凭据。

# c - 批评我的函数从输入流中跳过 k 个字符

> ID：594006
> 
> 赞同：1
> 
> 时间：2009-02-27T08:46:37.317
> 
> 标签：c

处理（应该是）一个简单的项目，从标准输入获取输入并重新格式化以匹配输出规范。我只是想看看这里的专家对以下函数的看法，该函数应该跳过 k 个字符直到行尾，除非 k < 0，它会一直跳过字符直到到达换行符。

```
 1 #include <stdio.h>
 25 int skip(int count){
 26   int i;
 27   int ch;
 28
 29   for(i = 0; count < 0 || i < count; i++){
 30     ch = fgetc(stdin);
 31     if(ch == EOF){
 32       return -1;
 33     }
 34     if(ch == '\n'){
 35       return 0;
 36     }
 37   }
 38   return 1;
 39 } 
```

（包括行号以供参考）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-27T08:58:09.080

这段代码没有什么严重的问题。但为了使这更强大，我会：

1.  将 的值保存`fgetc(stdin)`到`int`变量中，然后使用 对其进行测试以确保它为空白`isspace()`，如果不是则报告错误。使用`int`not a`char`因为在文件末尾`fgetc()`返回`EOF`，它不能放在 a`char`中。

2.  另一个小问题是，在现代文件系统上，文件大小可能大于`INT_MAX`. 我不会“伪造” when < 0 的`count`值，而是更改循环测试以显式测试它。`INT_MAX``k`

综上所述，主循环变为：

```
int ch;
for (i = 0; k < 0 || i < k; ++i) {
    ch = fgetc(stdin);
    if (ch == '\n') {
        return 1;
    } else if (ch == EOF) {
        return -1;        /* Or some error code of your choice */
    } else if (!isspace(ch)) {
        return -2;        /* Or some error code of your choice */
    }
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-27T08:57:15.853

不错。如果你和我一起工作并且你写了那个代码，我不会要求你改变它。

你可以递减`count`直到它达到零，而不是递增`i`直到它达到`count`，但这是否会是一种改进是有争议的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-27T09:00:58.000

我会选择

```
if (k < 0) count = 0
else       count = k;

do {
  if(fgetc(stdin) == '\n') return 1;
  count--;
} while (count != 0);

return 0; 
```

以避免使用 INT_MAX。请注意，前两行也可以简单地更改为“count = k;” 并且您可以将 count 变量更改为 64 位类型以处理 > 2 GB 的输入。

如果您有大量输入，您还可以尝试将整行甚至整个文件读入缓冲区并将指针传递给跳过函数以提高性能。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-27T09:03:35.323

就个人而言，我不会使用与`INT_MAX`单独的计数变量进行比较，并且我会减少提供的值而不是使用`for`循环。

我什至可以这样做：

```
while (k < 0 || k--) {
    ...
} 
```

请注意，如果`(k < 0)`由于`||`操作员的短路行为而不会发生递减，那么您将获得一个无限循环，除非您按照您的示例跳出循环`\n`

如果`(k == 0)`循环将立即终止（nb：后减量而不是前减量）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-27T09:10:35.650

评论家：你格式化：

") {" 之间有空格更具可读性

有时你使用“if(expression) statement;” 有时是“if(expression){statement;}”。我总是使用“{”。

"while (", "if (" 关键字后面也有空格。

# iphone - libSystem 库的参考资料

> ID：594008
> 
> 赞同：2
> 
> 时间：2009-02-27T08:47:07.953
> 
> 标签：iphone, c99

根据文档，iPhone 的核心操作系统包括 libSystem 库，我假设它包含标准 C 库函数，可能还有更多。如何了解 libSystem 中可用的所有功能？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-27T11:35:42.917

大多数功能是相同的。有一个[Apple Technote](http://developer.apple.com/technotes/tn2002/tn2071.html)列出了差异。在该页面中搜索“头文件”。请注意，本文档指的是 Darwin，并且更适合桌面 OS X 而不是 iPhone OS，但它应该可以满足您的需求。

您是否对 OS X 上的 stdlib 的一部分有特定问题？

# asp.net-mvc - How do I access query string parameters in asp.net mvc?

> ID：594019
> 
> 赞同：39
> 
> 时间：2009-02-27T08:53:09.093
> 
> 标签：asp.net-mvc, query-string

I want to have different sorting and filtering applied on my view I figured that I'll be passing sorting and filtering *params* through query string:

```
@Html.ActionLink("Name", "Index", new { SortBy= "Name"}) 
```

This simple construction allows me to sort. View comes back with this in query string:

```
?SortBy=Name 
```

Now I want to add filtering and i want my query string to end up with

```
?SortBy=Name&Filter=Something 
```

How can I add another parameter to list of already existing ones in `ActionLink`? for Example:

```
user requests /Index/ 
```

view has

```
 @Html.ActionLink("Name", "Index", new { SortBy= "Name"}) 
```

and

```
 @Html.ActionLink("Name", "Index", new { FilterBy= "Name"}) 
```

**Links**: The first one looks like `/Index/?SortBy=Name` and The second is `/Index/?FilterBy=Name`

I want when user pressed sorting link after he applied some filtering - filtering is not lost, so i need a way to combine my params. My guess is there should be a way to not parse query string, but get collection of parameters from some MVC object.

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2009-02-27T12:11:13.097

so far the best way I figured out is to create a copy of `ViewContext.RouteData.Values` and inject QueryString values into it. and then modify it before every `ActionLink` usage. still trying to figure out how to use `.Union()` instead of modifying a dictionary all the time.

```
<% RouteValueDictionary   tRVD = new RouteValueDictionary(ViewContext.RouteData.Values); %>

<% foreach (string key in Request.QueryString.Keys )
    {
         tRVD[key]=Request.QueryString[key].ToString();
    } %>

<%tRVD["SortBy"] = "Name"; %>
                <%= Html.ActionLink("Name", "Index", tRVD)%> 
```

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2010-01-22T06:06:55.143

My solution is similar to qwerty1000's. I created an extension method, `ActionQueryLink`, that takes in the same basic parameters as the standard `ActionLink`. It loops through Request.QueryString and adds any parameters found to the `RouteValues` dictionary that are not already present (so we can overwrite the original query string if needed).

To preserve the existing string but not add any keys the usage would be:

```
<%= Html.ActionQueryLink("Click Me!","SomeAction") %> 
```

To preserve the existing string and add new keys the user would be:

```
<%= Html.ActionQueryLink("Click Me!","SomeAction", new{Param1="value1", Param2="value2"} %> 
```

The code below is for the two usages, but it should be pretty easy to add other overloads to match the other `ActionLink` extensions as needed.

```
 public static string ActionQueryLink(this HtmlHelper htmlHelper,
        string linkText, string action)
    {
        return ActionQueryLink(htmlHelper, linkText, action, null);
    }

    public static string ActionQueryLink(this HtmlHelper htmlHelper, 
        string linkText, string action, object routeValues)
    {
        var queryString =
            htmlHelper.ViewContext.HttpContext.Request.QueryString;

        var newRoute = routeValues == null 
            ? htmlHelper.ViewContext.RouteData.Values 
            : new RouteValueDictionary(routeValues);

        foreach (string key in queryString.Keys)
        {
            if (!newRoute.ContainsKey(key)) 
                newRoute.Add(key, queryString[key]);
        }
        return HtmlHelper.GenerateLink(htmlHelper.ViewContext.RequestContext,
            htmlHelper.RouteCollection, linkText, null /* routeName */, 
            action, null, newRoute, null);
    } 
```

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-02-27T08:58:09.567

```
<%= Html.ActionLink("Name", "Index", new { SortBy= "Name", Filter="Something"}) %> 
```

To preserve the querystring you can:

```
<%= Html.ActionLink("Name", "Index", 
     String.IsNullOrEmpty(Request.QueryString["SortBy"]) ? 
        new { Filter = "Something" } : 
        new { SortBy=Request.QueryString["SortBy"], Filter="Something"}) %> 
```

Or if you have more parameters, you could build the link manually by using taking `Request.QueryString` into account.

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-09-09T13:49:15.370

Use `ActionLinkCombined` instead of `ActionLink`

```
 public static string ActionLinkCombined(this HtmlHelper htmlHelper, string linkText, string actionName,
                                            object routeValues)
    {
        var dictionary = new RouteValueDictionary();
        foreach (var pair in htmlHelper.ViewContext.Controller.ValueProvider)
            dictionary[pair.Key] = pair.Value.AttemptedValue;
        if (routeValues != null)
        {
            foreach (PropertyDescriptor descriptor in TypeDescriptor.GetProperties(routeValues))
            {
                object o = descriptor.GetValue(routeValues);
                dictionary[descriptor.Name] = o;
            }
        }
        return htmlHelper.ActionLink(linkText, actionName, dictionary);
    } 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2014-02-04T05:14:29.853

**MVC4**

```
@Html.ActionLink("link text","action",new { @id = 5, @name = "textName", @abc = "abc" }) 
```

***OR***

```
 @Html.ActionLink("link text", "action", "controller", new { @id = 5, @name = "textName", @abc = "abc" }, new { @class = "cssClass" }) 
```

querystring would be like:

```
yourDomainRout/action/5?name=textName&abc=abc 
```

it would have `class="cssClass"`

# hibernate - 如何删除数据库列中的尾随空格？

> ID：594029
> 
> 赞同：0
> 
> 时间：2009-02-27T08:58:45.693
> 
> 标签：hibernate, validation, data-binding, jpa

我有一个 EJB 3 Entity bean，它有一个带有注释的 String 属性：@Column(unique=true)。该值是从 JSF 页面设置的。

只要用户不添加空格添加输入字段的末尾，一切都会正常工作。在这种情况下，“someName”和“someName____”被视为不唯一并存储在数据库中。是否有一种方便的方法可以删除应用程序区域中的尾随（和前导）空格，或者是否必须在数据库区域中完成？

该行的末尾有一个 SQL Server 2008，我使用 Hibernate for ORM。

**将您的代码重新发布到开发服务器会产生奇迹**抱歉^^

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-27T09:45:26.720

因为，正如您在对 Mehrdad 的回答的评论中所说，您可以控制源代码，所以我强烈建议您找出您的调用有什么问题，`trim()`而不是仅仅破解您的方法。

你可能在做

```
public void setMyString(String myString) {
    myString.trim();
    this.myString = myString;
} 
```

你应该在哪里使用`trim()`' 的返回值？（记住 Java 字符串是不可变的。）

```
public void setMyString(String myString) {
    this.myString = myString.trim();
} 
```

（请根据需要添加空检查。）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-27T09:10:38.693

如果您不想在将字符串提交到服务器之前修改应用程序以修剪字符串。您可以：

*   如果您使用存储过程插入数据，请修改存储过程并使其修剪字符串
*   使用触发器修剪字符串

# mysql - 关于Mysql主从配置

> ID：594038
> 
> 赞同：0
> 
> 时间：2009-02-27T09:02:29.430
> 
> 标签：mysql

> **可能重复：**
> [关于Mysql主从配置](https://stackoverflow.com/questions/593613/regarding-mysql-master-slave-configuration)

大家好，

我对 Mysql 主从有一些疑问

例如，如果我为 Master 设置了 2 个从站。在生产之间，我想向该主站添加另一个从站。那时，我需要做什么？

提前致谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-27T09:31:52.370

为实时服务器设置从属的过程很简单：

*   使用 mysqldump 在特定时间点从 master 获取快照
*   根据您的需要配置您的新从站，复制下来
*   集成主快照
*   关闭从服务器
*   配置复制
*   启动奴隶

您可以在正在运行的生产服务器上完美地完成所有这些工作，因为现有服务器上唯一需要的干预就是从主服务器获取快照，这是一个相当轻松的过程。

# php - 用于验证来自其他站点的用户的最佳加密算法 (PHP)

> ID：594049
> 
> 赞同：1
> 
> 时间：2009-02-27T09:07:23.303
> 
> 标签：php, authentication

我有两个网站。

第一个站点要求用户登录。然后，当用户从第一个站点导航到第二个站点时，一个身份验证令牌将传递给第二个站点。所以用户不能只获取第二个站点的 url 并登录它。

我可以用于此身份验证目的的最佳加密/身份验证算法是什么？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-27T09:12:44.773

典型的PK方案。在 site1 上，使用 site1 的私钥和 site2 的公钥加密身份验证信息。在 site2 上使用 site2 的私钥和 site1 的公钥解密。

感兴趣的函数：

*   [`openssl_private_encrypt()`](http://www.php.net/manual/en/function.openssl-private-encrypt.php)
*   [`openssl_private_decrypt()`](http://www.php.net/manual/en/function.openssl-private-decrypt.php)
*   [`openssl_public_encrypt()`](http://www.php.net/manual/en/function.openssl-public-encrypt.php)
*   [`openssl_public_decrypt()`](http://www.php.net/manual/en/function.openssl-public-decrypt.php)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-27T09:32:57.330

请务必查看[OpenID](http://openid.net/)协议，它可以满足您的需求。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-27T09:31:59.563

我会使用[AES](http://en.wikipedia.org/wiki/Advanced_Encryption_Standard)加密。

为什么要对称加密？它速度更快，资源消耗更少。（CPU、带宽）您可以只分发密钥，然后它就和非对称加密一样安全。

非对称加密的优势只有在两个客户端互不认识的情况下才存在。

# wpf - PowerPoint 和 WPF

> ID：594052
> 
> 赞同：2
> 
> 时间：2009-02-27T09:08:43.830
> 
> 标签：wpf, powerpoint

我真的需要一种在我的 wpf 应用程序中加载 .ppt 文档的方法。谁能给我一个提示，代码示例？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2010-04-20T18:41:34.200

根据这篇文章，不再支持 DSO 成帧器。必须寻找其他东西。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-30T14:31:54.340

查看[以下](http://social.expression.microsoft.com/Forums/en-US/wpf/thread/9db90c63-c302-4a1a-b813-c99df9824777/#)讨论线程。此外 Dr.WPF 有一篇有趣的文章也可能对您有所帮助：[在 WPF 应用程序中托管 Office](http://www.drwpf.com/blog/Home/tabid/36/EntryID/3/Default.aspx) 但是考虑到您的方案的许可证成本将相当高......

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2014-02-08T16:01:25.590

您可能需要详细说明您的特定需求以获得实际答案。我不认为托管 PowerPoint (ppt) 是一个好的选择，因为它需要在目标机器上安装 ppt....如果目标机器有 ppt，那么您可以使用它的**API 将文档保存为 HTML**并打开它在**WebBrowser**控件中。

如果目标机器没有 powerpoint，您可以查看一些在线文件转换服务并尝试连接到那里以转换为 HTML 并仍然使用**WebBrowser**控件。

我绝对不建议在 DSOFramer 上浪费你的时间——它充其量是非常不稳定的，它只会让你感觉离让它工作一段时间但它不起作用。

另一种选择当然是为ppt文件编写自己的解析器，文件的OfficeOpenXML版本绝对是“可解析的”。我已经为 Word docx 做到了这一点，并且从文档中获取课程数据相对容易 - 比如形状，文本...... - 但细节中存在魔鬼。有无数的小功能需要实现。

# ado.net - 连接和 DataAdaptor 对象范围的 ADO.NET 最佳实践

> ID：594053
> 
> 赞同：7
> 
> 时间：2009-02-27T09:08:46.140
> 
> 标签：ado.net

这是我在 StackOverflow 上的第一篇文章，所以请温柔...

我对 ADO.NET 的对象范围有一些疑问。

当我连接到数据库时，我通常使用如下代码：

```
OleDbConnection conn = new OleDbConnection("my_connection_string");
conn.Open();
OleDbDataAdapter adapter = new OleDbDataAdapter("SELECT * from Employees", conn);
OleDbCommandBuilder cb = new OleDbCommandBuilder(adapter);
DataTable dt = new DataTable();
adapter.Fill(dt);
conn.Close();
conn.Dispose(); 
```

假设我将生成的 DataTable 绑定到一个网格控件并允许我的用户编辑网格内容。现在，当我的用户按下保存按钮时，我需要调用此代码：

```
adapter.Update(dt); 
```

以下是我的问题：

1）我是否需要保留我最初加载数据表时创建的适配器对象，或者我可以在保存按钮单击事件中创建另一个适配器对象来执行更新？

2）如果我确实需要保留原始适配器对象，我是否还需要保持连接对象可用并打开？

我了解 ADO.NET 的断开连接模型 - 当需要更新数据库时，我只是对对象范围感到困惑。如果有人能给我一些关于这种情况的最佳实践的建议，我将不胜感激！

提前致谢...

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-27T09:16:50.393

1) 您不需要相同的 DataAdapter，但如果您创建一个新的，它必须使用相同的查询作为其基础。

2) 如果连接关闭，DataAdapter 将打开其连接。在这种情况下，它会在完成后再次关闭连接。如果连接已经打开，即使完成后连接也会保持打开状态。

通常你会像你的例子一样工作。创建一个 Conneciton 和一个 DataAdapter，填充一个 DataTable，然后处理掉 Connection 和 DataAdapter。

对您的代码的两条评论：

*   您在这里不需要 CommandBuilder，因为您只进行选择。只有当您想自动生成插入、更新或删除语句时，才需要命令生成器。在这种情况下，您还需要从 CommandBuilder 手动设置 DataAdapter 上的 InsertCommand、UpdateCommand 或 DeleteCommand。
*   第二。您应该使用 Using 子句，而不是手动调用 Dispose。即使抛出异常，它也确保您的对象将被处理掉。

尝试将您的代码更改为：

```
DataTable dt = new DataTable();
using (OleDbConnection conn = new OleDbConnection("my_connection_string"))
using (OleDbDataAdapter adapter = new OleDbDataAdapter("SELECT * from Employees", conn))
{
  adapter.Fill(dt);    
} 
```

请注意，我在 using 子句之外定义了 DataTable。当您离开 usings 时，需要这样做以确保该表在范围内。另请注意，您不需要 DataAdapter 上的 Dispose 调用或 Connection 上的 Close 调用。当您离开 usings 时，两者都是隐式完成的。

哦。欢迎来到 SO :-)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-27T09:58:05.023

要回答您的问题：

1.  理想情况下，您应该保留相同的 DataAdapter，因为它已经执行了初始化。DataAdapter 提供诸如 SelectCommand、UpdateCommand、InsertCommand 和 DeleteCommand 等属性，它们允许您设置不同的 Command 对象以在数据源上执行这些不同的功能。因此，您会看到，DataAdapter 被*设计*为可重用于多个命令（用于同一数据库连接）。您使用 CommandBuilder（虽然不推荐）通过分析 SelectCommand 创建其他命令，从而允许您使用相同的 CommandBuilder 执行更新、删除和插入。

2.  最好允许 DataAdapter 隐式处理数据库连接。*@Rune Grimstad*已经详细说明了这种隐含行为，理解这一点很有用。理想情况下，应尽快关闭连接。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-10-04T17:59:08.267

在 Rune Grimstad 的出色回答中，还有两个额外的细节值得添加。

首先，CommandBuilder（如果需要）实现了 IDisposable，因此应该包含在它自己的“使用”语句中。令人惊讶的是（至少对我而言），处置 DataAdapter 似乎并*没有*处置关联的 CommandBuilder。当我未能执行此操作时观察到的问题是，即使我在 DataAdapter 上调用了 Dispose，并且连接状态为“已关闭”，但在使用 CommandBuilder 更新该数据库后，我无法删除临时数据库。

其次，语句“ *......在这种情况下，您还需要手动设置 DataAdapter 上的 InsertCommand、UpdateCommand 或 DeleteCommand......* ”并不总是正确的。对于许多琐碎的情况，CommandBuilder 将根据提供给 DataAdapter 的 SELECT 语句和数据库中的元数据自动创建正确的 INSERT、UPDATE 和 DELETE 语句。在这种情况下，“琐碎”意味着只访问一个表，并且该表具有作为 SELECT 语句的一部分返回的主键。

# c# - OleDbDataAdapter 更新问题

> ID：594063
> 
> 赞同：0
> 
> 时间：2009-02-27T09:12:36.363
> 
> 标签：c#, oledb

我有一个包含很多行（超过一亿）的 DataTable，并且正在编写一个需要插入该表的应用程序。

我将使用 OleDbDataAdapter 来完成这项工作，我很困惑最好的方法是什么。我只需要插入到这个巨大的表中，但是我不想将插入语句硬编码到应用程序中。

我想我可以用

```
OleDbDataAdapter adapter = new OleDbDataAdapter();
adapter.SelectCommand = new OleDbCommand("select * from table_name");
OleDbCommandBuilder cb = new OleDbCommandBuilder(adapter);
...
adapter.Fill(data_set_name, "Table_name"); 
```

但这真的很**糟糕**，因为我不需要/想要数据并且内存使用会很糟糕。所以如果我可以用 TOP 更改 SelectCommand，我会很有趣吗？它看起来像这样：

```
adapter.SelectCommand = new OleDbCommand("select TOP 1 * from table_name"); 
```

现在 Fill 命令会非常快，并且我将拥有所有未来插入语句所需的数据。我可以将行添加到数据表，然后调用

```
adapter.Update(data_set_name, "Table_name"); 
```

这行得通吗？这是一种有效/推荐的方法吗？应用程序快速且仅使用必要的资源非常重要。有没有更好的方法来做到这一点？

谢谢您的意见！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-27T09:21:53.940

如果您不需要数据，您可以将选择命令更改为

```
SELECT * FROM Table_Name WHERE 1=2 
```

然后你不会得到任何行回来

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-27T09:33:14.847

IMO，最好的方法是：

1.  使用该`OleDbDataAdapter.FillSchema(data_set_name, SchemaType.Source)`方法创建具有从数据源映射的结构的 DataTable。您基本上是在尝试通过在 Select 语句中拉出一行来做同样的事情。在这种情况下，您的 Select 语句可能仍为“ `select * from table_name`”。我相信您现在不需要调用该`OleDbDataAdapter.Fill`方法。

2.  不要使用 a `CommandBuilder`，而是自己创建`InsertCommand`语句。

# wpf - MVVM 与修改 View 的组件树的可能性之间是否存在不匹配？

> ID：594072
> 
> 赞同：8
> 
> 时间：2009-02-27T09:16:42.313
> 
> 标签：wpf, silverlight, mvvm

阅读了有关**Model-View-ViewModel 架构的所有 StackOverflow 条目以及网络上大多数现成的资源后，我得出的结论是，它是构建****SOLID** Silverlight 应用程序的事实标准。
我开始使用这种架构来计划我的下一个应用程序。应用程序的要求之一是构建或更改可视组件结构。例如，响应用户交互，我想以编程方式将编译时未知数量的矩形和椭圆附加到特定的画布或画布上。
我开始扭曲我的想法来应用 MVVM 模式，并思考负责附加新组件的代码应该去哪里。我得出的结论是，它不属于任何 MVVM 层，因此不可能在必须在运行时操作组件树的场景中应用此架构。
有没有办法在这些场景中仍然使用**Model-View-ViewModel**或者它仅限于使用固定的 View 组件结构？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-27T09:21:24.393

不要操纵组件树。相反，操作代表组件树的模型。然后让您的视图绑定到该模型中的各种集合和属性以生成其视觉效果。

下面是一个非常简化的示例。**它只是显示概念 - 请不要将其视为您应该如何分解代码的指示。**

首先，我的模型：

```
public abstract class Shape
{
    public double Left { get; set; }
    public double Top { get; set; }
}

public class Rectangle : Shape
{
    public double Width { get; set; }
    public double Height { get; set; }
} 
```

接下来，我公开了一个上述形状的集合（您将使用另一个模型来包含该集合）。然后我在我看来绑定到它：

```
<Window x:Name="_root" x:Class="WpfApplication1.Window1"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="clr-namespace:WpfApplication1"
    Title="Window1" Height="300" Width="300">
    <Window.Resources>
        <DataTemplate DataType="{x:Type local:Rectangle}">
            <Rectangle Width="{Binding Width}" Height="{Binding Height}" Stroke="Black"/>
        </DataTemplate>
    </Window.Resources>
    <ItemsControl DataContext="{Binding ElementName=_root}" ItemsSource="{Binding Shapes}">
        <ItemsControl.ItemsPanel>
            <ItemsPanelTemplate>
                <Canvas/>
            </ItemsPanelTemplate>
        </ItemsControl.ItemsPanel>
        <ItemsControl.ItemContainerStyle>
            <Style>
                <Setter Property="Canvas.Left" Value="{Binding Left}"/>
                <Setter Property="Canvas.Top" Value="{Binding Top}"/>
            </Style>
        </ItemsControl.ItemContainerStyle>
    </ItemsControl>
</Window> 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-27T09:53:48.247

您问题中的基本问题是混淆了用户的需求（操作由矩形和椭圆表示的对象（我只是在猜测））与实现细节（将`Rectangle`s 和`Ellipse`s 附加到`Canvas`es）。

同样，MVVM 模式中的不同职责：

### 看法

将 ViewModel 转换为像素，并将输入事件转换为 ViewModel 上的方法调用。

这将是与它们绑定的实际 Silverlight 组件 ( `Rectangle`, `Ellipse`, )并具有一些非常小的事件处理程序或s 或其他。`Canvas``DataContext``Command`

### 模型

以特定领域的方式保存数据和业务逻辑。

这表示您的用户正在绘制的“数学”矩形和椭圆。

### 视图模型

以面向 UI 且通常特定于用例的方式优化模型。

在这里，您存储与特定视图相关但不是基础模型概念的属性的瞬态信息，例如“当前选定的对象”。

阅读我的博客，[了解我对 MVVM 的更多看法](http://dasz.at/index.php/2008/11/doing-gui-architecture-the-right-way/)。

# ios - 如何在iOS上将字符串拆分为子字符串？

> ID：594076
> 
> 赞同：83
> 
> 时间：2009-02-27T09:17:23.340
> 
> 标签：ios, objective-c, iphone, string, substring

`NSString`我从服务器收到了一个。现在我想把它拆分成我需要的子字符串。如何拆分字符串？

例如：

substring1：从第二个字符读取到第五个字符

substring2：从第 6 个字符开始读取 10 个字符。

* * *

## 回答 #1

> 赞同：227
> 
> 时间：2009-02-27T09:43:56.350

您还可以使用 NString 的[componentsSeparatedByString](http://developer.apple.com/DOCUMENTATION/Cocoa/Reference/Foundation/Classes/NSString_Class/Reference/NSString.html#//apple_ref/occ/instm/NSString/componentsSeparatedByString:)方法将字符串拆分为子字符串。

文档中的示例：

```
NSString *list = @"Norman, Stanley, Fletcher";
NSArray *listItems = [list componentsSeparatedByString:@", "]; 
```

* * *

## 回答 #2

> 赞同：40
> 
> 时间：2009-02-27T09:20:45.110

NSString 对此有一些方法：

```
[myString substringToIndex:index];
[myString substringFromIndex:index];
[myString substringWithRange:range]; 
```

查看 NSString 的文档以获取更多信息。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2016-12-13T10:24:22.910

我写了一个小方法来将字符串拆分为指定数量的部分。请注意，它仅支持单个分隔符。但我认为这是拆分 NSString 的有效方法。

```
//split string into given number of parts
-(NSArray*)splitString:(NSString*)string withDelimiter:(NSString*)delimiter inParts:(int)parts{
    NSMutableArray* array = [NSMutableArray array];

    NSUInteger len = [string length];
    unichar buffer[len+1];

    //put separator in buffer
    unichar separator[1];
    [delimiter getCharacters:separator range:NSMakeRange(0, 1)];

    [string getCharacters:buffer range:NSMakeRange(0, len)];

    int startPosition = 0;
    int length = 0;
    for(int i = 0; i < len; i++) {

        //if array is parts-1 and the character was found add it to array
        if (buffer[i]==separator[0] && array.count < parts-1) {
            if (length>0) {
                [array addObject:[string substringWithRange:NSMakeRange(startPosition, length)]];

            }

            startPosition += length+1;
            length = 0;

            if (array.count >= parts-1) {
                break;
            }

        }else{
            length++;
        }

    }

    //add the last part of the string to the array
    [array addObject:[string substringFromIndex:startPosition]];

    return array;
} 
```

# hibernate - 是否可以使用 hibernate 作为 Glassfish 的持久性提供程序？

> ID：594079
> 
> 赞同：1
> 
> 时间：2009-02-27T09:20:26.580
> 
> 标签：hibernate, jpa, persistence, glassfish, ejb-3.0

是否可以使用休眠作为 Glassfish 的持久性提供程序，如果可以，如何？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2010-04-02T18:29:27.780

[Guss 提供的指向 hibernate.org](http://www.hibernate.org/374.html "格斯提供的链接")的链接已过期。这是 2010 年 2 月 20 日的谷歌缓存。正如之前版本的链接 wiki 页面中所述，最好将休眠库保存在您的 .ear / .war 而不是 Glassfish 安装目录中，以便不同的应用程序可以使用它们的自己的休眠版本。

> **现代方法**
> 
> 要将 hibernate 与 glassfish 一起使用，您所要做的就是将 hibernate 及其依赖项放入您的 EAR 文件中。这也可能与 WAR 文件一起使用。
> 
> 在您的 persistence.xml 中，使用此标记指定休眠：
> 
> ```
> <provider>org.hibernate.ejb.HibernatePersistence</provider> 
> ```
> 
> 你也可以像往常一样指定休眠属性，例如：
> 
> ```
> <properties>
>   <property name="hibernate.hbm2ddl.auto" value="none"/>
> </properties> 
> ```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-27T09:28:21.850

虽然我不是 Glassfish 或 Hibernate 方面的专家，但我认为您可能会觉得这很有趣：[Instructions on using Hibernate in Glassfish](http://www.hibernate.org/374.html)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-27T09:41:20.583

是的，这是一个常见的场景。只需将 Hibernate（及其所有依赖项）全局部署到 Glassfish 中或作为应用程序的一部分。然后使用 Hibernate 作为库来实现您的应用程序。

您必须考虑的下一个问题是您是否要使用 JPA，并将 Hibernate 作为 JPA 提供者，或者您是否要使用 Hibernate plain。

如果您想使用 EJB 和实体 Bean，那么还有一个问题。如果是，我会推荐使用 JPA。

如果您不使用 EJB 实体 Bean，则可以使用 JPA 或普通 Hibernate 来持久化您的 POJO。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2011-01-15T19:55:15.303

您可以构建一个 EAR 并将它们包含在 EAR 的 lib 目录中，而不是将 Hibernate 库放在 Glassfish 服务器的 lib 目录中。我刚刚发布了一篇关于我们使用这种方法的经验的博客文章。IMO 最好将 Hibernate 与应用程序本身捆绑在一起，而不是更改服务器的全局配置。通过这样做，它不会影响也可能在同一服务器上运行的其他应用程序（例如，遗留应用程序）。有关更多信息，请参阅[此](http://javafromthetrenches.wordpress.com/2011/01/15/issue-how-to-use-hibernate-jpa-with-glassfish-instead-of-toplink/)内容。

# asp.net - 在 ASP.NET 中优雅地处理 URI 黑客攻击

> ID：594085
> 
> 赞同：3
> 
> 时间：2009-02-27T09:23:07.320
> 
> 标签：asp.net, exception-handling, error-handling, uri

我编写了一个可以优雅地处理大多数异常的应用程序，页面的设计完好无损，并带有漂亮的错误消息。我的应用程序在事件中捕获了它们，`Page_Error`并将异常添加到页面`HttpContext.Curent.Context.Items`，然后执行`Server.Transfer`到`Error.aspx`页面。我发现这是 ASP.NET 中唯一可行的解​​决方案，因为似乎没有其他方法可以以集中和通用的方式进行。

我也处理了`Application_Error`，在那里我对发生的异常进行了一些检查，以确定我是否可以优雅地处理它。我发现我可以优雅地处理的异常是在有人破解 URI 以包含 .NET 框架认为危险的字符或在文件系统级别基本上只是非法的字符之后引发的。

此类 URI 可能如下所示：

*   `http://exmample.com/"illegal"`
*   `http://example.com/illegal"/`
*   `http://example.com/illegal /`

（注意最后一个 URI 末尾斜杠前的空格）。

我希望这些 URI 以“404 Not Found”和友好消息进行响应，并且不会导致发送任何错误报告以避免 DDOS 攻击向量等。但是，我还没有找到一种优雅的方法来捕获这些类型的错误。我现在要做的是检查该`exception.TargetSite.Name`属性，如果它等于或`CheckInvalidPathChars`，我认为它是“路径验证异常”并以 404 响应。`ValidatePath``CheckSuspiciousPhysicalPath`

不过，这似乎是一个 hack。首先，方法名称列表可能不完整，其次，这些方法名称有可能被替换或重命名，这将导致我的代码中断。

有谁知道我如何处理这种更少硬编码和更面向未来的方式？

PS：我`System.Web.Routing`在我的应用程序中使用干净和合理的 URI，如果这对任何给定的解决方案都很重要的话。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-27T09:35:55.607

System.Web.Routing 可能支持某种 url 过滤，但您自己的实现很容易。

查看[System.Web.IHttpModule](http://msdn.microsoft.com/en-us/library/system.web.ihttpmodule.aspx)接口并阅读有关[实现自定义 HTTP 模块](http://msdn.microsoft.com/en-us/library/ms227673.aspx)的信息。Http 模块进入该 Asp.Net 管道并在您的页面运行之前运行。您可以使用它来执行请求记录、修改请求以及在您的情况下过滤请求。Asp.Net 路由模块也被实现为自定义 HTTP 模块。

您可以做的是实现一个 Http Module 来查看请求的 url 并检查它是否有效。如果 url 无效，您可以做任何您需要的事情，例如将其重定向到您的 404 - not found 页面，或者您可以停止请求。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-02-28T05:14:35.223

我不认为使用 System.Web.IHttpModule 是 IIS7+ 的正确答案。我正在尝试实现 IHttpModule 来验证路径，但在执行 HttpModule 之前已引发异常。

这是我的异常堆栈：

```
 [ArgumentException: Illegal characters in path.]
   System.IO.Path.CheckInvalidPathChars(String path) +7493413
   System.IO.Path.Combine(String path1, String path2) +40
   System.Web.Configuration.UserMapPath.GetPhysicalPathForPath(String path, VirtualDirectoryMapping mapping) +114
   System.Web.Configuration.UserMapPath.GetPathConfigFilename(String siteID, VirtualPath path, String& directory, String& baseName) +72
   System.Web.Configuration.UserMapPath.MapPath(String siteID, VirtualPath path) +30
   System.Web.Configuration.UserMapPath.MapPath(String siteID, String path) +31
   System.Web.Hosting.HostingEnvironment.MapPathActual(VirtualPath virtualPath, Boolean permitNull) +297
   System.Web.Hosting.HostingEnvironment.MapPathInternal(VirtualPath virtualPath, Boolean permitNull) +51
   System.Web.CachedPathData.GetConfigPathData(String configPath) +341
   System.Web.CachedPathData.GetVirtualPathData(VirtualPath virtualPath, Boolean permitPathsOutsideApp) +110
   System.Web.HttpContext.GetFilePathData() +36
   System.Web.HttpContext.GetConfigurationPathData() +26
   System.Web.Configuration.RuntimeConfig.GetConfig(HttpContext context) +43
   System.Web.Configuration.CustomErrorsSection.GetSettings(HttpContext context, Boolean canThrow) +41
   System.Web.HttpResponse.ReportRuntimeError(Exception e, Boolean canThrow, Boolean localExecute) +101
   System.Web.HttpRuntime.FinishRequest(HttpWorkerRequest wr, HttpContext context, Exception e) +383 
```

这是 IIS 7.0 应用程序生命周期的链接（[http://msdn.microsoft.com/en-us/library/bb470252.aspx](http://msdn.microsoft.com/en-us/library/bb470252.aspx)）

我猜是由“解决缓存”步骤引起的异常

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-03-30T13:50:18.077

编写自定义 HttpModule 对我不起作用 - 我仍然收到“路径中的非法字符”错误，但对[这个问题](https://stackoverflow.com/questions/2087246/howto-allow-illegal-characters-in-path/2092234#2092234)的回答解决了这个问题：

事实证明，您可以通过在 web.Config 中为 requestFiltering 设置 allowDoubleEscaping="false" 来避免这种情况。IE：

```
<configuration>
  <system.webServer>
    <security>
      <requestFiltering allowDoubleEscaping="false" />
    </security>
  </system.webServer>
</configuration> 
```

也许不是完美的解决方案（非常感谢任何更好的解决方案），但它解决了问题。

# c# - 如何在网格视图中插入行

> ID：594088
> 
> 赞同：0
> 
> 时间：2009-02-27T09:23:50.113
> 
> 标签：c#, asp.net

我想在不使用 sqldatasource 的情况下单击**新按钮时向网格视图插入新行。**以及如何从网格视图中编辑、更新和删除行。请帮助我

[Visual Studio 2008 带有 c# 的 asp.net]

谢谢蒂鲁

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-27T09:45:26.893

“不使用 SqlDataSource”是什么意思？那么，您打算如何将插入的数据传播到数据存储区？您尚未指定您正在使用的其他方法。

无论如何，GridView 本身并不支持记录的插入，但您可以通过创建一个 FooterTemplate 来完成它，您可以在其中创建用于输入新数据的字段。此外，提供一列以允许在 FooterTemplate 中插入/取消按钮。

这是一个很好的示例：[如何使用 SqlDataSource 在 GridView 中轻松插入行](http://www.aspdotnetfaq.com/Faq/How-to-insert-row-in-GridView-with-SqlDataSource.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-12-18T22:17:10.947

如果您想在没有 SQL 数据源的情况下执行此操作，请将 DataTable 设置为 GridView 的数据源。

[关于如何向数据表填充和添加行的好例子。](http://www.java2s.com/Tutorial/CSharp/0560__ADO.Net/AddRowtoDataTable.htm)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-27T09:31:38.207

好的 gridview 教程：[ASP.NET 快速入门教程](http://quickstarts.asp.net/quickstartv20/aspnet/doc/ctrlref/data/gridview.aspx)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-27T09:45:27.767

要添加新行，您可以尝试将控件放在 GridView 的页脚行中。

编辑、更新和删除需要你做两件事：

1.  在 SqlDataSource 中实现这些操作
2.  在 GridView 中启用这些操作

# c++ - std::vector.clear() 是否在每个元素上删除（可用内存）？

> ID：594089
> 
> 赞同：63
> 
> 时间：2009-02-27T09:26:37.063
> 
> 标签：c++, std

考虑这段代码：

```
#include <vector>

void Example()
{
    std::vector<TCHAR*> list;
    TCHAR* pLine = new TCHAR[20];
    list.push_back(pLine);
    list.clear();    // is delete called here?
    // is delete pLine; necessary?
} 
```

是否`list.clear()`调用`delete`每个元素？即我必须在之前/之后释放内存`list.clear()`吗？

* * *

## 回答 #1

> 赞同：53
> 
> 时间：2009-02-27T09:35:39.927

`std::vector`调用时确实调用了它包含的每个元素的析构函数`clear()`。在您的特定情况下，它会破坏指针但对象仍然存在。

智能指针是正确的方法，但要小心。`auto_ptr`不能在 std 容器中使用。`boost::scoped_ptr`也不能。`boost::shared_ptr`可以，但它不适用于您的情况，因为您没有指向对象的指针，您实际上正在使用数组。因此，您的问题的解决方案是使用[`boost::shared_array`](http://www.boost.org/doc/libs/1_38_0/libs/smart_ptr/shared_array.htm).

但我建议您`std::basic_string<TCHAR>`改用，这样您就不必处理内存管理，同时仍然可以获得使用字符串的好处。

* * *

## 回答 #2

> 赞同：40
> 
> 时间：2009-02-27T09:28:29.897

否（您需要按照您在示例中的建议在最后自己进行删除，因为秃头指针的破坏不会做任何事情）。但是您可以使用 boost [或其他基于 RAII 的惯用语] 智能指针使其做正确的事情（`auto_ptr`在容器中无法正常工作，因为它在复制等下具有不兼容的行为），但请确保您了解陷阱这样的智能指针在使用前。（正如 Benoit 所提到的，在这种情况下，这`basic_string`就是您真正要在这里寻找的东西。）

话虽如此，需要了解智能指针的缺陷，让它们隐式地处理内存管理，这样您就不必显式地进行操作，这样不容易出错。

编辑：由于 Earwicker 和 James Matta 的大力推动，对 Benoit 进行了大幅修改，以包含 Benoit 带来的更为彻底的答案 - 感谢您推动我对此进行尽职调查！

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-02-27T13:32:18.720

这是您可以判断它没有的一种方法 - 在未完全定义的类上尝试它：

```
#include <vector>
class NotDefined;

void clearVector( std::vector<NotDefined*>& clearme )
{
    clearme.clear();    // is delete called here?
} 
```

如果此代码段编译，则它不能调用析构函数，因为未定义析构函数。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2009-11-16T04:47:33.760

您可以编写一个简单的模板函数来为您执行此操作：

```
template <class T>
void deleteInVector(vector<T*>* deleteme) {
    while(!deleteme->empty()) {
        delete deleteme->back();
        deleteme->pop_back();
    }

    delete deleteme;
} 
```

也许这里的某些东西是不好的做法，但我不这么认为。尽管评论总是很好，但对我来说看起来还不错。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2009-02-27T09:29:13.953

没有。它不会这样做，因为不能保证您不会在其他任何地方使用指针。如果它不是指针变量，它将释放它们（通过调用析构函数）

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-27T18:56:52.607

您也许还可以使用[Boost Pointer Container Library](http://www.boost.org/doc/libs/1_38_0/libs/ptr_container/doc/ptr_container.html)。这里没有特别推荐（再次因为您使用数组而不是单个对象，尽管`std::string`会处理这一点），但它是一个有用且鲜为人知的库，可以解决标题中所述的问题。

# windows - 在 Windows 或 Cygwin 中加速 Ruby 脚本启动

> ID：594099
> 
> 赞同：4
> 
> 时间：2009-02-27T09:31:56.363
> 
> 标签：windows, ruby, cygwin, performance

我有一个 ruby​​ 脚本，启动大约需要 30 秒。它需要这么多，因为它试图加载所有库和东西。

当我这样做时`ruby.exe -v`，它是即时的。

我不想碰原始的 ruby​​ 脚本，它不是我写的。

加快这个过程的技巧是什么？

*   我可以预编译它吗？
*   我可以预缓存所有这些文件吗？

我需要在 Windows 或 Cygwin 下执行此操作。

**更新 ：**

*   脚本在 Linux/Mac 中也很慢，这种情况并非特定于 Windows。
*   这是普通的 ruby​​ 1.8.7（其他 ruby​​ 版本的速度相似）
*   主要瓶颈是加载这么多库（我删除了不需要的文件和库，并大大减少了时间，但仍然很慢）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-09T11:57:53.543

我认为脚本使用 ruby​​gems？（如果是这样，它会说需要“rubygems”）

您可以尝试安装 minigems (gem install minigems)，然后使用 minigems 而不是 ruby​​gems - 应该会加快速度。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-05T00:09:17.320

抱歉，没有办法编译 ruby​​ 脚本。这个脚本正在加载/做什么样的事情？

你是对的，30 秒是相当长的。这个脚本是否调用了非常昂贵的网络或数据库？很难相信库需要这么长时间才能加载

...我刚刚注意到评论，看到您将其缩短到 1-4 秒...这非常好，尤其是从 30 秒下降时。其他评论是对的，请在脚本顶部发布要求

# asp.net - 如何在 ASP.NET 请求生命周期中处理异常

> ID：594107
> 
> 赞同：0
> 
> 时间：2009-02-27T09:34:30.617
> 
> 标签：asp.net, exception-handling, error-handling, lifecycle

这个问题有点与[在 ASP.NET 中优雅地处理 URI hacking](/questions/594085/handle-uri-hacking-gracefully-in-asp-net)有关，因为它也是关于如何最好地处理在 ASP.NET 请求生命周期中发生的异常。我找到了一种优雅地处理大多数异常的方法，但是后来我发现一些异常在请求中发生得太晚了，以至于无法执行诸如`Server.Transfer`将整个错误表示逻辑划分到其自己的页面中之类的事情。

因此，我必须改为处理`Application_Error`事件内部的异常，然后执行`Response.Write`s 和诸如此类的操作。它很丑。我知道在某些情况下响应流可能已经被刷新，因此传输请求并不是一个真正的选择。我想问的是，是否有人找到了解决这个问题的优雅方法？

此外，我发现很难知道何时可以通过将请求转移到另一个页面而不是优雅地处理异常。当异常发生时，找出我们在请求生命周期中的哪个位置的最佳方法是什么？如果它发生在页面的加载和呈现期间，`Page_Error`将能够处理它，而且我还没有遇到问题`Server.Transfer`。但是如果异常发生得太早或太晚而`Page_Error`无法捕获它并且它冒泡到`Application_Error`，我该怎么做才能知道它是早还是晚？

如果它在生命周期的后期，我可能不得不`Response.Write`直接从做`Application_Error`，但如果它是早期的，我可以做`Server.Transfer`。问题是，如果它太在请求中，那么尝试做`Server.Transfer`本身就会导致异常。

那么，是否有一个全局枚举或类似的东西可以表明是否为时已晚对响应做创造性的事情？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-02T07:07:00.587

我已经使用这种方法来捕获在 Web 控件或页面中生成的所有错误。它需要您做的就是从一个基类（一个用于页面，一个用于用户控件）继承，每个页面或用户控件都可以实现自己的 HandleException 方法并执行它需要执行的任何操作。完整代码在这里：

[asp.net / MOSS2007 的透明通用异常处理（带代码）](https://stackoverflow.com/questions/280412/transparent-generic-exception-handling-for-asp-net-moss2007-with-code)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-27T09:59:03.287

我认为我对此的建议是使用带有 WMI 事件提供程序的 ASP.NET 健康监控来解决错误：

这是一个方法。

[http://msdn.microsoft.com/en-us/library/ms178713.aspx](http://msdn.microsoft.com/en-us/library/ms178713.aspx)

希望这可以帮助：

安德鲁

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-02T07:35:41.377

我建议您使用 asp.net 配置为未处理的异常提供一个常规错误页面。从示例 web.config

```
 <!--
        The <customErrors> section enables configuration 
        of what to do if/when an unhandled error occurs 
        during the execution of a request. Specifically, 
        it enables developers to configure html error pages 
        to be displayed in place of a error stack trace.

    <customErrors mode="RemoteOnly" defaultRedirect="GenericErrorPage.htm">
        <error statusCode="403" redirect="NoAccess.htm" />
        <error statusCode="404" redirect="FileNotFound.htm" />
    </customErrors>
    --> 
```

在整个处理程序上，只需记录异常，然后让 asp.net 进行重定向。

如果您仍想继续使用您的客户方法，我建议您查看可用的 asp.net 源并检查它是如何做到的。

# php - 将 IP 与 PHP 5 中的 CIDR 掩码匹配？

> ID：594112
> 
> 赞同：59
> 
> 时间：2009-02-27T09:36:56.883
> 
> 标签：php, cidr

我正在寻找快速/简单的方法来将给定的 IP4 点四 IP 与 CIDR 符号掩码匹配。

我有一堆 IP，我需要查看它们是否与一系列 IP 匹配。

例子：

```
$ips = array('10.2.1.100', '10.2.1.101', '10.5.1.100', '1.2.3.4');

foreach ($ips as $IP) {
    if (cidr_match($IP, '10.2.0.0/16') == true) {
        print "you're in the 10.2 subnet\n"; 
    }
} 
```

会是什么样`cidr_match()`子？

它并不一定很简单，但快速会很好。任何仅使用内置/常用功能的东西都是一种奖励（因为我可能会让一个人在 pear 中向我展示这样做的东西，但我不能依赖 pear 或安装在我的代码所在的位置的那个包部署）。

* * *

## 回答 #1

> 赞同：89
> 
> 时间：2009-02-27T09:48:20.287

如果只使用 IPv4：

*   用于`ip2long()`将 IP 和子网范围转换为长整数
*   将 /xx 转换为子网掩码
*   执行按位“和”（即 ip 和掩码）”并检查“结果 = 子网”

像这样的东西应该工作：

```
function cidr_match($ip, $range)
{
    list ($subnet, $bits) = explode('/', $range);
    if ($bits === null) {
        $bits = 32;
    }
    $ip = ip2long($ip);
    $subnet = ip2long($subnet);
    $mask = -1 << (32 - $bits);
    $subnet &= $mask; # nb: in case the supplied subnet wasn't correctly aligned
    return ($ip & $mask) == $subnet;
} 
```

* * *

## 回答 #2

> 赞同：58
> 
> 时间：2015-01-14T13:13:00.680

在类似的情况下，我最终使用了 symfony/http-foundation。

使用此包时，您的代码将如下所示：

```
$ips = array('10.2.1.100', '10.2.1.101', '10.5.1.100', '1.2.3.4');

foreach($ips as $IP) {
    if (\Symfony\Component\HttpFoundation\IpUtils::checkIp($IP, '10.2.0.0/16')) {
        print "you're in the 10.2 subnet\n";
    }
} 
```

它还处理 IPv6。

链接：[https ://packagist.org/packages/symfony/http-foundation](https://packagist.org/packages/symfony/http-foundation)

* * *

## 回答 #3

> 赞同：45
> 
> 时间：2013-02-12T21:06:21.790

我发现许多这些方法在 PHP 5.2 之后就失效了。但是，以下解决方案适用于 5.2 及更高版本：

```
function cidr_match($ip, $cidr)
{
    list($subnet, $mask) = explode('/', $cidr);

    if ((ip2long($ip) & ~((1 << (32 - $mask)) - 1) ) == ip2long($subnet))
    { 
        return true;
    }

    return false;
} 
```

**示例结果**

```
cidr_match("1.2.3.4", "0.0.0.0/0"): 真
cidr_match("127.0.0.1", "127.0.0.1/32"): 真
cidr_match("127.0.0.1", "127.0.0.2/32"): 假

```

来源[http://www.php.net/manual/en/function.ip2long.php#82397](http://www.php.net/manual/en/function.ip2long.php#82397)。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2012-12-17T08:32:40.673

一些功能改变：

*   分裂与爆炸

* * *

```
function cidr_match($ip, $range)
{
    list ($subnet, $bits) = explode('/', $range);
    $ip = ip2long($ip);
    $subnet = ip2long($subnet);
    $mask = -1 << (32 - $bits);
    $subnet &= $mask; 
    return ($ip & $mask) == $subnet;
} 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2017-02-16T13:58:37.077

这是一个快速的 64 位函数，请注释您不需要的返回行。接受任何有效的 IPv4，无论是否带有有效的 CIDR 路由前缀，例如 63.161.156.0/24或**63.161.156.0**

```
<?php
function cidr2range($ipv4){
if ($ip=strpos($ipv4,'/'))
{$n_ip=(1<<(32-substr($ipv4,1+$ip)))-1;   $ip_dec=ip2long(substr($ipv4,0,$ip)); }
else
{$n_ip=0;                                   $ip_dec=ip2long($ipv4);             }
$ip_min=$ip_dec&~$n_ip;
$ip_max=$ip_min+$n_ip;
#Array(2) of Decimal Values Range
return [$ip_min,$ip_max];
#Array(2) of Ipv4 Human Readable Range
return [long2ip($ip_min),long2ip($ip_max)];
#Array(2) of Ipv4 and Subnet Range
return [long2ip($ip_min),long2ip(~$n_ip)];
#Array(2) of Ipv4 and Wildcard Bits
return [long2ip($ip_min),long2ip($n_ip)];
#Integer Number of Ipv4 in Range
return ++$n_ip;
} 
```

要快速检查给定的**ipv4 是否与给定的 CIDR 匹配，**您可以像本例中那样内联

```
<?php
$given_cidr='55.55.55.0/24';
$given_ipv4='55.55.55.55';
if(($range=cidr2range($given_cidr)) &&
($check=ip2long($given_ipv4))!==false &&
$check>=$range[0] && $check<=$range[1])
{
echo 'Yes, '.$given_ipv4.' is included in '.$given_cidr;
}
else
{
echo 'No, '.$given_ipv4.' is not included in '.$given_cidr;
} 
```

要将**完整范围**作为给定 IP 的数组（带或不带 CIDR 路由前缀），您可以使用以下代码，但要小心，因为例如 25.25.25.25/16 返回一个包含 65536 个元素的数组，您可以轻松用完使用较小路由前缀的内存

```
<?php
$result=cidr2range($ipv4);
for($ip_dec=$result[0];$ip_dec<=$result[1];$ip_dec++)
$full_range[$ip_dec]=long2ip($ip_dec);
print_r($full_range); 
```

快速检查给定的**ipv4 是否与给定的 IP 数组匹配**（带或不带 CIDR 路由前缀）

```
<?php
#This code is checking if a given ip belongs to googlebot
$given_ipv4='74.125.61.208';
$given_cidr_array=['108.59.93.43/32','108.59.93.40/31','108.59.93.44/30','108.59.93.32/29','108.59.93.48/28','108.59.93.0/27','108.59.93.64/26','108.59.93.192/26','108.59.92.192/27','108.59.92.128/26','108.59.92.96/27','108.59.92.0/27','108.59.94.208/29','108.59.94.192/28','108.59.94.240/28','108.59.94.128/26','108.59.94.16/29','108.59.94.0/28','108.59.94.32/27','108.59.94.64/26','108.59.95.0/24','108.59.88.0/22','108.59.81.0/27','108.59.80.0/24','108.59.82.0/23','108.59.84.0/22','108.170.217.128/28','108.170.217.160/27','108.170.217.192/26','108.170.217.0/25','108.170.216.0/24','108.170.218.0/23','108.170.220.0/22','108.170.208.0/21','108.170.192.0/20','108.170.224.0/19','108.177.0.0/17','104.132.0.0/14','104.154.0.0/15','104.196.0.0/14','107.167.160.0/19','107.178.192.0/18','125.17.82.112/30','125.16.7.72/30','74.125.0.0/16','72.14.192.0/18','77.109.131.208/28','77.67.50.32/27','66.102.0.0/20','66.227.77.144/29','66.249.64.0/19','67.148.177.136/29','64.124.98.104/29','64.71.148.240/29','64.68.64.64/26','64.68.80.0/20','64.41.221.192/28','64.41.146.208/28','64.9.224.0/19','64.233.160.0/19','65.171.1.144/28','65.170.13.0/28','65.167.144.64/28','65.220.13.0/24','65.216.183.0/24','70.32.132.0/23','70.32.128.0/22','70.32.136.0/21','70.32.144.0/20','85.182.250.128/26','85.182.250.0/25','80.239.168.192/26','80.149.20.0/25','61.246.224.136/30','61.246.190.124/30','63.237.119.112/29','63.226.245.56/29','63.158.137.224/29','63.166.17.128/25','63.161.156.0/24','63.88.22.0/23','41.206.188.128/26','12.234.149.240/29','12.216.80.0/24','8.34.217.24/29','8.34.217.0/28','8.34.217.32/27','8.34.217.64/26','8.34.217.128/25','8.34.216.0/24','8.34.218.0/23','8.34.220.0/22','8.34.208.128/29','8.34.208.144/28','8.34.208.160/27','8.34.208.192/26','8.34.208.0/25','8.34.209.0/24','8.34.210.0/23','8.34.212.0/22','8.35.195.128/28','8.35.195.160/27','8.35.195.192/26','8.35.195.0/25','8.35.194.0/24','8.35.192.0/23','8.35.196.0/22','8.35.200.0/21','8.8.8.0/24','8.8.4.0/24','8.6.48.0/21','4.3.2.0/24','23.236.48.0/20','23.251.128.0/19','216.239.32.0/19','216.252.220.0/22','216.136.145.128/27','216.33.229.160/29','216.33.229.144/29','216.34.7.176/28','216.58.192.0/19','216.109.75.80/28','216.74.130.48/28','216.74.153.0/27','217.118.234.96/28','208.46.199.160/29','208.44.48.240/29','208.21.209.0/28','208.184.125.240/28','209.185.108.128/25','209.85.128.0/17','213.200.103.128/26','213.200.99.192/26','213.155.151.128/26','199.192.112.224/29','199.192.112.192/27','199.192.112.128/26','199.192.112.0/25','199.192.113.176/28','199.192.113.128/27','199.192.113.192/26','199.192.113.0/25','199.192.115.80/28','199.192.115.96/27','199.192.115.0/28','199.192.115.128/25','199.192.114.192/26','199.192.114.0/25','199.223.232.0/21','198.108.100.192/28','195.16.45.144/29','192.104.160.0/23','192.158.28.0/22','192.178.0.0/15','206.160.135.240/28','207.223.160.0/20','203.222.167.144/28','173.255.125.72/29','173.255.125.80/28','173.255.125.96/27','173.255.125.0/27','173.255.125.128/25','173.255.124.240/29','173.255.124.232/29','173.255.124.192/27','173.255.124.128/29','173.255.124.144/28','173.255.124.160/27','173.255.124.48/29','173.255.124.32/28','173.255.124.0/27','173.255.124.64/26','173.255.126.0/23','173.255.122.128/26','173.255.122.64/26','173.255.123.0/24','173.255.121.128/26','173.255.121.0/25','173.255.120.0/24','173.255.117.32/27','173.255.117.64/26','173.255.117.128/25','173.255.116.192/27','173.255.116.128/26','173.255.116.0/25','173.255.118.0/23','173.255.112.0/22','173.194.0.0/16','172.102.8.0/21','172.253.0.0/16','172.217.0.0/16','162.216.148.0/22','162.222.176.0/21','180.87.33.64/26','128.177.109.0/26','128.177.119.128/25','128.177.163.0/25','130.211.0.0/16','142.250.0.0/15','146.148.0.0/17'];
echo '<pre>';
$in_range=false;
if (($given_ipv4_dec=ip2long($given_ipv4))!==false)
{
foreach($given_cidr_array as $given_cidr){
if(($range=cidr2range($given_cidr)) &&
$given_ipv4_dec>=$range[0] && $given_ipv4_dec<=$range[1])
{
$in_range=true;
echo $given_ipv4.' matched '.$given_cidr.' ('.join(array_map('long2ip',$range),' - ').")\n";
}
}
}
echo $given_ipv4.' is probably'.($in_range?'':' not').' a Googlebot IP'; 
```

为了快速运行，该函数不检查输入，但正式它应该是与以下正则表达式匹配的字符串

```
#^(?:((?:0)|(?:2(?:(?:[0-4][0-9])|(?:5[0-5])))|(?:1?[0-9]{1,2}))\.((?:0)|(?:2(?:(?:[0-4][0-9])|(?:5[0-5])))|(?:1?[0-9]{1,2}))\.((?:0)|(?:2(?:(?:[0-4][0-9])|(?:5[0-5])))|(?:1?[0-9]{1,2}))\.((?:0)|(?:2(?:(?:[0-4][0-9])|(?:5[0-5])))|(?:1?[0-9]{1,2}))(?:/((?:(?:0)|(?:3[0-2])|(?:[1-2]?[0-9]))))?)$# 
```

如果要在使用函数之前**验证输入**

```
<?php
if (is_string($ipv4) && preg_match('#^(?:((?:0)|(?:2(?:(?:[0-4][0-9])|(?:5[0-5])))|(?:1?[0-9]{1,2}))\.((?:0)|(?:2(?:(?:[0-4][0-9])|(?:5[0-5])))|(?:1?[0-9]{1,2}))\.((?:0)|(?:2(?:(?:[0-4][0-9])|(?:5[0-5])))|(?:1?[0-9]{1,2}))\.((?:0)|(?:2(?:(?:[0-4][0-9])|(?:5[0-5])))|(?:1?[0-9]{1,2}))(?:/((?:(?:0)|(?:3[0-2])|(?:[1-2]?[0-9]))))?)$#',$ipv4))
{
#This is a valid ipv4 with or without CIDR Routing Prefix
$result=cidr2range($ipv4);
print_r($result);
} 
```

那么**您问题的正式答案**如下

```
<?php
#Requiring cidr2range shown above function
function cidr_match($mixed_ip,$mixed_cidr){
if (!is_array($mixed_ip)){
$string_mode=true;
$mixed_ip=[$mixed_ip=>0];
}
else $mixed_ip=array_fill_keys($mixed_ip,0);
if (!is_array($mixed_cidr)) $mixed_cidr=[$mixed_cidr];
foreach($mixed_ip   as $ip => &$result)
foreach($mixed_cidr as $cidr)
{
if(($range=cidr2range($cidr)) &&
($check=ip2long($ip))!==false &&
$check>=$range[0] && $check<=$range[1]){
$result=$cidr;
break;
}
}
$mixed_ip=array_filter($mixed_ip);
return $string_mode?($mixed_ip?true:false):$mixed_ip;
}

print '<pre>';

#Your example
$ips = array('10.2.1.100', '10.2.1.101', '10.5.1.100', '1.2.3.4');

foreach ($ips as $IP) {
    if (cidr_match($IP, '10.2.0.0/16') == true) {
        print "you're in the 10.2 subnet\n"; 
    }
}

#Also working with IP array and/or CIDR array
#If IP array is given then return an array containing IP (keys) matching CIDR (values)
$result=cidr_match($ips,['20.2.0.0/16','10.2.0.0/15']);
foreach($result as $ip => $cidr){
print "$ip is in the $cidr subnet\n"; 
} 
```

> 您可以使用这些示例编译您自己的函数，希望这几行代码对您有所帮助……</p>

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2013-01-26T10:00:25.960

我的技术使用子网和掩码进行位对位匹配。

```
function cidr_match($ip, $range){
    list ($subnet, $bits) = explode('/', $range);
    $ip = substr(IP2bin($ip),0,$bits) ;
    $subnet = substr(IP2Bin($subnet),0,$bits) ;
    return ($ip == $subnet) ;
}

function IP2Bin($ip){
    $ipbin = '';
    $ips = explode(".",$ip) ;
    foreach ($ips as $iptmp){
        $ipbin .= sprintf("%08b",$iptmp) ;
    }
    return $ipbin ;
} 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2014-01-30T16:52:49.373

我还需要针对 CIDR 掩码测试 IP。我找到了一个很好的解释和源代码的网站，效果很好。

该网站[http://pgregg.com/blog/2009/04/php-algorithms-determining-if-an-ip-is-within-a-specific-range/](http://pgregg.com/blog/2009/04/php-algorithms-determining-if-an-ip-is-within-a-specific-range/)

因为网站有一天可能不复存在，这里是代码

```
<?php

/*
 * ip_in_range.php - Function to determine if an IP is located in a
 *                   specific range as specified via several alternative
 *                   formats.
 *
 * Network ranges can be specified as:
 * 1\. Wildcard format:     1.2.3.*
 * 2\. CIDR format:         1.2.3/24  OR  1.2.3.4/255.255.255.0
 * 3\. Start-End IP format: 1.2.3.0-1.2.3.255
 *
 * Return value BOOLEAN : ip_in_range($ip, $range);
 *
 * Copyright 2008: Paul Gregg <pgregg@pgregg.com>
 * 10 January 2008
 * Version: 1.2
 *
 * Source website: http://www.pgregg.com/projects/php/ip_in_range/
 * Version 1.2
 *
 * This software is Donationware - if you feel you have benefited from
 * the use of this tool then please consider a donation. The value of
 * which is entirely left up to your discretion.
 * http://www.pgregg.com/donate/
 *
 * Please do not remove this header, or source attibution from this file.
 */

// decbin32
// In order to simplify working with IP addresses (in binary) and their
// netmasks, it is easier to ensure that the binary strings are padded
// with zeros out to 32 characters - IP addresses are 32 bit numbers
Function decbin32 ($dec) {
  return str_pad(decbin($dec), 32, '0', STR_PAD_LEFT);
}

// ip_in_range
// This function takes 2 arguments, an IP address and a "range" in several
// different formats.
// Network ranges can be specified as:
// 1\. Wildcard format:     1.2.3.*
// 2\. CIDR format:         1.2.3/24  OR  1.2.3.4/255.255.255.0
// 3\. Start-End IP format: 1.2.3.0-1.2.3.255
// The function will return true if the supplied IP is within the range.
// Note little validation is done on the range inputs - it expects you to
// use one of the above 3 formats.
Function ip_in_range($ip, $range) {
  if (strpos($range, '/') !== false) {
    // $range is in IP/NETMASK format
    list($range, $netmask) = explode('/', $range, 2);
    if (strpos($netmask, '.') !== false) {
      // $netmask is a 255.255.0.0 format
      $netmask = str_replace('*', '0', $netmask);
      $netmask_dec = ip2long($netmask);
      return ( (ip2long($ip) & $netmask_dec) == (ip2long($range) & $netmask_dec) );
    } else {
      // $netmask is a CIDR size block
      // fix the range argument
      $x = explode('.', $range);
      while(count($x)<4) $x[] = '0';
      list($a,$b,$c,$d) = $x;
      $range = sprintf("%u.%u.%u.%u", empty($a)?'0':$a, empty($b)?'0':$b,empty($c)?'0':$c,empty($d)?'0':$d);
      $range_dec = ip2long($range);
      $ip_dec = ip2long($ip);

      # Strategy 1 - Create the netmask with 'netmask' 1s and then fill it to 32 with 0s
      #$netmask_dec = bindec(str_pad('', $netmask, '1') . str_pad('', 32-$netmask, '0'));

      # Strategy 2 - Use math to create it
      $wildcard_dec = pow(2, (32-$netmask)) - 1;
      $netmask_dec = ~ $wildcard_dec;

      return (($ip_dec & $netmask_dec) == ($range_dec & $netmask_dec));
    }
  } else {
    // range might be 255.255.*.* or 1.2.3.0-1.2.3.255
    if (strpos($range, '*') !==false) { // a.b.*.* format
      // Just convert to A-B format by setting * to 0 for A and 255 for B
      $lower = str_replace('*', '0', $range);
      $upper = str_replace('*', '255', $range);
      $range = "$lower-$upper";
    }

    if (strpos($range, '-')!==false) { // A-B format
      list($lower, $upper) = explode('-', $range, 2);
      $lower_dec = (float)sprintf("%u",ip2long($lower));
      $upper_dec = (float)sprintf("%u",ip2long($upper));
      $ip_dec = (float)sprintf("%u",ip2long($ip));
      return ( ($ip_dec>=$lower_dec) && ($ip_dec<=$upper_dec) );
    }

    echo 'Range argument is not in 1.2.3.4/24 or 1.2.3.4/255.255.255.0 format';
    return false;
  }

}
?> 
```

（我没有开发这个；这是由 Paul Gregg 开发的（[http://pgregg.com/](http://pgregg.com/)）

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2018-11-16T15:53:34.933

我最近需要将 IP 地址与 CIDR 掩码相匹配，并偶然发现了这篇文章。下面是基于上述想法的稍微不同的方法，包括对 CIDR 输入的检查。如果提交的 CIDR 格式不正确，该函数将返回 false。

我为任何需要经过测试的交钥匙功能的人发布了这个解决方案。

```
/**
 * Validates subnet specified by CIDR notation.of the form IP address followed by 
 * a '/' character and a decimal number specifying the length, in bits, of the subnet
 * mask or routing prefix (number from 0 to 32).
 *
 * @param $ip - IP address to check
 * @param $cidr - IP address range in CIDR notation for check
 * @return bool - true match found otherwise false
 */
function cidr_match($ip, $cidr) {
    $outcome = false;
    $pattern = '/^(([01]?\d?\d|2[0-4]\d|25[0-5])\.){3}([01]?\d?\d|2[0-4]\d|25[0-5])\/(\d{1}|[0-2]{1}\d{1}|3[0-2])$/';
    if (preg_match($pattern, $cidr)){
        list($subnet, $mask) = explode('/', $cidr);
        if (ip2long($ip) >> (32 - $mask) == ip2long($subnet) >> (32 - $mask)) {
            $outcome = true;
        }
    }
    return $outcome;
} 
```

测试数据如下图所示：

[![测试结果 IP 检查](https://i.stack.imgur.com/tyC5w.jpg)](https://i.stack.imgur.com/tyC5w.jpg)

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-02-27T09:54:59.070

```
function cidr_match($ipStr, $cidrStr) {
  $ip = ip2long($ipStr);
  $cidrArr = split('/',$cidrStr);
  $maskIP = ip2long($cidrArr[0]);
  $maskBits = 32 - $cidrArr[1];
  return (($ip>>$maskBits) == ($maskIP>>$maskBits));
} 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2013-03-27T11:39:52.720

请注意，Alnitak 的答案适用于 32/64 位。

这是它的一个熟版，用于基于您可以随处获得的国家 IP 列表的快速垃圾邮件保护。google 国家/地区 ip 列表或国家/地区 ip 块（必须在这里给出一个，真的很难在该网站页面导航中找到它：[国家/地区 ip 块生成器](https://www.countryipblocks.net/country_selection.php)）

将您的 cidr ip 列表复制粘贴到字符串 $cidrs。并将此代码放在页面 html 之前，可能在 header.php 文件中。

也可用于根据国家/地区过滤页面模板中的 Adsense 使用。

这只是一个半夜紧急的解决方案。有时需要在昨天快速为客户想出类似的东西，所以就在这里。

```
//++++++++++++++++++++++
//COUNTRY SPAM PROTECTOR
//speed: ~5ms @ 2000 cidrs
//comments start with #
//++++++++++++++++++++++
$cidrs=
'
#yourcountry
1.3.4.5/21
#mycountry
6.7.8.9/20
';
//$cidrs.="\n".'123.12.12.12/32';//test, your ip
$cidrs_ar=preg_split('/\s+/',$cidrs,-1,PREG_SPLIT_NO_EMPTY);
$ip=@$_SERVER['REMOTE_ADDR'];
$iplong=ip2long($ip);
//var_export($cidrs_ar);var_export($ip);var_export($iplong);
if($iplong)
  foreach($cidrs_ar as $cidr)
    {
    $ar=explode ('/', $cidr);
    $netiplong=ip2long($ar[0]);
    if($netiplong===false) continue;
    $mask=intval(@$ar[1]);
    if(!$mask) continue;
    $bitmask=-1 <<(32-$mask);
    if(($iplong & $bitmask) == ($netiplong & $bitmask))
        {
        header('Location: http://www.someotherwebsite.com/',true,303);
        exit;
        }
    } 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2013-08-16T07:42:01.643

您还可以使用[Net_IPv4 PEAR 库](http://pear.php.net/manual/en/package.networking.net-ipv4.php)。

```
function cidr_match($ip, $net){
  include_once("Net/IPv4.php");
  $objIP = new Net_IPv4();
  return $objIP->ipInNetwork($ip, $net);
} 
```

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2016-12-14T16:26:21.787

也许它对某人有用。

将位掩码转换为 IP 掩码：

```
// convert 12 => 255.240.0.0
// ip2long('255.255.255.255') == -1
$ip = long2ip((-1 << (32 - $bit)) & -1); 
```

将 IP 掩码转换为位掩码：

```
// convert 255.240.0.0 => 12

// is valid IP
if (filter_var($ip, FILTER_VALIDATE_IP, FILTER_FLAG_IPV4) === false) {
    throw new \InvalidArgumentException(sprintf('Invalid IP "%s".', $ip));
}

// convert decimal to binary
$mask = '';
foreach (explode('.', $ip) as $octet) {
    $mask .= str_pad(decbin($octet), 8, '0', STR_PAD_LEFT);
}

// check mask
if (strpos('01', $mask) !== false) {
    // valid   11111111111111111111111100000000 -> 255.255.255.0
    // invalid 11111111111111111111111100000001 -> 255.255.255.1
    throw new \InvalidArgumentException(sprintf('IP mask "%s" is not valid.', $ip));
}

$bit = substr_count($mask, '1'); // bit mask 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-06-03T23:15:10.667

我想让你看看我的几行。人们在我之前提出的例子似乎不起作用。据我了解，一个原因是 CIDR 掩码位是二进制数，因此必须对二进制数进行位移。我尝试将长 IP 转换为二进制文件，但遇到了最大二进制数限制。好的，这是我的几行...我等待您的评论。

```
function cidr_match($ipStr, $cidrStr) {

$ipStr = explode('.', $ipStr);
foreach ($ipStr as $key => $val) {
    $ipStr[$key] = str_pad(decbin($val), 8, '0', STR_PAD_LEFT);
    }
$ip = '';
foreach ($ipStr as $binval) {
    $ip = $ip . $binval;
    }

$cidrArr = explode('/',$cidrStr);

$maskIP = explode('.', $cidrArr[0]);
foreach ($maskIP as $key => $val) {
    $maskIP[$key] = str_pad(decbin($val), 8, '0', STR_PAD_LEFT);
    }
$maskIP = '';
foreach ($ipStr as $binval) {
    $maskIP = $maskIP . $binval;
    }
$maskBits = 32 - $cidrArr[1];
return (($ip>>$maskBits) == ($maskIP>>$maskBits));  
} 
```

# visual-studio-2008 - 给我 Visual Studio 2008 IDE 的捷径

> ID：594113
> 
> 赞同：3
> 
> 时间：2009-02-27T09:37:30.000
> 
> 标签：visual-studio-2008, shortcuts

在eclipse中，F3或Ctrl+mouseClick特别是在一个（函数、类、接口、变量）名称上打开对应的（函数、类、接口、变量）。但在 Visual Studio 中，仅使用 F12 打开相同的类方法定义。

Eclipse的F3/ctrl+click对应的快捷键是什么

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-27T09:43:50.157

F12 是*转到定义*。无论光标是在方法、类型还是字段上，它都应该工作。

# eclipse - 你能在 Eclipse 中禁用自动水平滚动吗？

> ID：594129
> 
> 赞同：4
> 
> 时间：2009-02-27T09:45:36.783
> 
> 标签：eclipse, editor, settings, eclipse-cdt, horizontal-scrolling

有时，当我跳入源代码时，例如从搜索或查找某些东西的声明时，Eclipse 文本编辑器会尝试通过水平滚动来显示附近的长行。即使我跳转到的项目完全在显示范围内而没有滚动也会发生这种情况。我觉得这很烦人，所以：

有没有办法禁用它？我徒劳地搜索了所有编辑器设置。

具体来说，这是关于 Eclipse CDT，但我想 JDT 中的行为是相同的。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-27T11:58:25.467

这似乎也发生在其他 Eclipse 编辑器中（例如[PDT for PHP](http://dev.eclipse.org/newslists/news.eclipse.tools.pdt/msg00777.html)）

[`ScrolledFormText`](http://dev.eclipse.org/newslists/news.eclipse.platform.swt/msg41228.html)它[本](http://www.eclipse.org/pde/incubator/spy/)可以与. _ `WorkbenchWindow`_[`AbstractDecoratedTextEditor`](http://help.eclipse.org/ganymede/index.jsp?topic=/org.eclipse.platform.doc.isv/reference/api/org/eclipse/ui/texteditor/AbstractDecoratedTextEditor.html)[`org.eclipse.ui.texteditor.AbstractTextEditor`](http://help.eclipse.org/ganymede/index.jsp?topic=/org.eclipse.platform.doc.isv/reference/api/org/eclipse/ui/texteditor/AbstractTextEditor.html)

其[来源`AbstractTextEditor`](http://kickjava.com/src/org/eclipse/ui/texteditor/AbstractTextEditor.java.htm)表明具有：

*   用于垂直滚动的**ScrollLinesAction**
*   用于设置光标并可能触发水平滚动的**TextNavigationAction**

我不知道如何改变这种行为，除非以某种方式为活动编辑器标识符（例如，对于 java，“ `org.eclipse.jdt.ui.ClassFileEditor`”）做出贡献，并修改它`Action`。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-08-12T00:40:46.547

我遇到了同样的问题，并在 Eclipse Bugs 上找到了这些未解决的错误：

[https://bugs.eclipse.org/bugs/show_bug.cgi?id=314208](https://bugs.eclipse.org/bugs/show_bug.cgi?id=314208)

[https://bugs.eclipse.org/bugs/show_bug.cgi?id=321189](https://bugs.eclipse.org/bugs/show_bug.cgi?id=321189)

当您关闭代码折叠并重新加载文件时，您可以防止它发生。

格兹，

吨

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-11-26T01:08:55.187

右键单击您的 Eclipse 快捷方式并选择属性。在兼容性选项卡中选择“windows xp（servicepack 3）[。http://www.vistax64.com/vista-general/133849-disable-dynamic-horizo ​​ntal-scrolling-vista.html](http://www.vistax64.com/vista-general/133849-disable-dynamic-horizontal-scrolling-vista.html)

# c# - 验证签名 Facebook Connect

> ID：594130
> 
> 赞同：1
> 
> 时间：2009-02-27T09:45:48.657
> 
> 标签：c#, facebook, signature

我已经按照这个很棒的[Stackoverflow 问题](https://stackoverflow.com/questions/323019/facebook-connect-and-asp-net)中的说明进行操作，但我不确定这个验证签名的事情。这是在 Facebook 工具包中以某种方式提供的，还是我必须自己做一些事情？关于如何做到这一点的[文档](http://wiki.developers.facebook.com/index.php/Verifying_The_Signature)不是很清楚，如果它已经在 facebook 工具包中烘焙，我不想花太多时间在上面。

有人做过吗？应该提到我在 C# 中使用标准的 ASP.NET Web 应用程序。任何帮助，将不胜感激！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-03T02:40:03.460

目前，您必须自己做。我提供了一个简单的方法，您可以调用它来查看签名是否有效。

```
private bool IsValidFacebookSignature()
    {
        //keys must remain in alphabetical order
        string[] keyArray = { "expires", "session_key", "ss", "user" };
        string signature = "";

        foreach (string key in keyArray)
            signature += string.Format("{0}={1}", key, GetFacebookCookie(key));

        signature += SecretKey; //your secret key issued by FB

        MD5 md5 = MD5.Create();
        byte[] hash = md5.ComputeHash(Encoding.UTF8.GetBytes(signature.Trim()));

        StringBuilder sb = new StringBuilder();
        foreach (byte hashByte in hash)
            sb.Append(hashByte.ToString("x2", CultureInfo.InvariantCulture));

        return (GetFacebookCookie("") == sb.ToString());
    }

    private string GetFacebookCookie(string cookieName)
    {
        //APIKey issued by FB
        string fullCookie = string.IsNullOrEmpty(cookieName) ? ApiKey : ApiKey + "_" + cookieName;

        return Request.Cookies[fullCookie].Value;
    } 
```

注意：SecretKey 和 ApiKey 是 Facebook 提供的值，您需要设置。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-08-26T23:02:33.637

You can do this using [FBConnectAuth](http://fbconnectauth.codeplex.com), it does the same as above, and a little more.

# html - VS 文本编辑器中是否有任何插件可以对文本进行 HTML 编码？

> ID：594132
> 
> 赞同：1
> 
> 时间：2009-02-27T09:47:27.403
> 
> 标签：html, visual-studio-2008, visual-studio-2005, plugins

这可能是一个简单的问题，因为对于任何 Web 开发人员来说，它似乎都是一个显而易见的工具。

当我需要对字符串进行编码时，我目前使用免费的基于 Web 的东西，但我很想知道是否有人知道 VS 的插件，它可以让您在文本编辑器中对文本进行 HTML 编码？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-08-19T18:04:11.347

是的，有一个简单的“插件”。

转到“工具”-> 宏资源管理器-> 创建新宏。

Sub EncodeHtml() DTE.ActiveDocument.Selection.Text = System.Web.HttpUtility.HtmlEncode(DTE.ActiveDocument.Selection.Text) End Sub

分配一个热键。你去吧。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-27T09:52:33.943

插件，不，但代码？你为什么不直接引用 System.Web 和...

```
System.Web.HttpUtility.HtmlEncode("input string"); 
```

您可以轻松构建一个控制台应用程序来做到这一点。

```
"".Replace("<","&lt;") // this is usually enough to escape HTML 
```

...但也许您想对所有内容进行编码，以便您的输出是 ASCII？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-09-22T18:21:52.397

我只知道这一点，因为我刚刚找到了答案，并且早些时候在谷歌上搜索我在这篇文章中遇到的答案。

如果您在 Visual Studio 2008 中开发控制台应用程序，则 System.Web 名称空间不可用。但是，如果您“添加引用”，您可以选择 System.Web 名称空间，这将允许您使用 httputility 并使用内置的 htmlencode 和 htmldecode。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2015-09-03T06:47:54.780

我将 alex 答案移至带有[VCMD 扩展的 Visual Studio 2013](https://vlasovstudio.com/visual-commander/)

VCMD -> 命令 -> 添加和插入代码：

```
Imports EnvDTE
Imports EnvDTE80
Imports Microsoft.VisualBasic

Public Class C
    Implements VisualCommanderExt.ICommand

    Sub Run(DTE As EnvDTE80.DTE2, package As Microsoft.VisualStudio.Shell.Package) Implements VisualCommanderExt.ICommand.Run
        DTE.ActiveDocument.Selection.Text = System.Web.HttpUtility.HtmlEncode(DTE.ActiveDocument.Selection.Text)
    End Sub
End Class 
```

不要忘记添加引用... -> System.Web

# c++ - 带有多个参数的 static_cast 是怎么回事？

> ID：594135
> 
> 赞同：13
> 
> 时间：2009-02-27T09:48:50.643
> 
> 标签：c++, casting, operators, static-cast, comma-operator

谁能告诉我这个演员有什么效果（除了将happyNumber设置为1337），如果有的话，如果没有其他效果，我怎么能写这样的代码？？？这是编译器错误，还是 C++ 的某些“隐藏功能”？

```
int happyNumber = static_cast<int>(123.456, TRUE, "WTF" , false , "IS" , NULL , "GOING" , 0xff , "ON???" , 1337); 
```

我很惊讶这会编译。我是通过一个错误发现的，在该错误中，我不小心将第二个参数设置为要在被强制转换的表达式的函数调用中使用的东西。这导致了一个令人讨厌的错误，其中对象是从第二个参数强制转换的，只使用一个参数调用函数。它编译了......并且最初并没有繁荣......

我正在使用 Microsoft Visual C++ 2008。

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2009-02-27T09:54:28.510

静态转换接受一个参数，但它的参数是一个表达式，并且表达式可以包含[逗号运算符](http://en.wikipedia.org/wiki/Comma_operator)。逗号用于您想要一次评估两个或多个表达式的副作用的情况，例如：

```
int i, j;
for (i=0, j=0; i < 10; i++,j++) {
    // do stuff
} 
```

它有点有用，因为没有它，您只能为 for 循环的初始化程序、条件和继续部分（或任何其他需要表达式的地方）计算一个表达式。但是，它通常不会产生最清晰的代码，而且语义也很奇怪。正如您所观察到的，逗号分隔的序列计算为其最后一个表达式的值。

# sql - 更新列

> ID：594141
> 
> 赞同：1
> 
> 时间：2009-02-27T09:51:45.927
> 
> 标签：sql

我有一个带有状态列的表（最初带有`progress`）。我需要将此列的值更新为`success`.

这个查询是我想要的吗？

```
Update "tablename" set status='success' where status='progress' 
```

我问的原因是更新和 where 条件都在检查同一列。

它是否正确？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-27T09:54:57.777

这将起作用，但它会修改该列中**所有有进度的行。**

我认为您可能希望根据记录的其他部分来限制更新。

例如，如果是安装特定软件的进度（比如 7 号机器上的 Ubuntu）：

```
update tbl set status='success'
where status='progress'
and machine_id = 7
and software = 'Ubuntu' 
```

从概念的角度来看，它首先收集要更改的记录列表（使用`where`子句），然后将`update ... set`应用于所有这些记录。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-27T09:55:36.900

是的，这是正确的，确定要更改的行并将信息提交到指定的列：

```
Update MyTable set Allowed = 1 WHERE Allowed = 0 AND UserID = 123 
```

干杯，

安德鲁

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-27T09:55:12.300

该语句会将状态为“progress”的每一行的值更改为“success”。这真的是你想要的吗？

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-27T09:55:34.200

是的，没错，所有 status = 'progress' 的行都将被更新

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-27T09:55:34.670

是的，没关系。这会将表中“进度”的每一行更新为“成功”，而不仅仅是一个。我不确定这是否是你想要的。

# wpf - 在 PathGeometry 中切割孔

> ID：594144
> 
> 赞同：6
> 
> 时间：2009-02-27T09:52:11.683
> 
> 标签：wpf, geometry, pathgeometry

我有一个 PathGeometry 定义一些像这样的路径：

[原始路径 http://devblog.ailon.org/devblog/_stuff/wpfpathgeoquestion/original.gif](http://devblog.ailon.org/devblog/_stuff/wpfpathgeoquestion/original.gif)

这是一个简化的例子。实际上，它可以有任何类型的线段（直线、弧线、贝塞尔曲线）。

现在，我需要在分段关节点上切出某种大小（正方形、圆形等）的孔，因此最终结果如下所示：

[有孔 http://devblog.ailon.org/devblog/_stuff/wpfpathgeoquestion/with_holes.gif](http://devblog.ailon.org/devblog/_stuff/wpfpathgeoquestion/with_holes.gif)

我最初的想法是使用 GeometryCombineMode.Exclude 将原始 PathGeometry 与在关节点中包含正方形（或其他）的其他几何图形结合起来。不幸的是，如果路径没有被填充，这会产生空几何。如果它被填充，它会产生不正确的结果。

所以我被困住了。在带有线段的简单示例中，我可以预先计算边界点并让我的线段在那里结束，但是对于弧线和贝塞尔曲线，这有点矫枉过正。

有谁知道如何做到这一点？

注意：我需要擦除这些孔（透明），因此在其上方放置一个白色方块是不行的。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-27T10:15:31.797

哦。做到了。这个想法是使用 DrawingBrush 从孔中创建一个 OpacityMask，然后在绘制 PathGeometry 之前将其推送到绘图上下文中。像这样的东西。

```
RectangleGeometry r = new RectangleGeometry(graphVisual.Bounds);
GeometryDrawing dr = new GeometryDrawing(Brushes.Black, null, Geometry.Combine(r, bulletHoles, GeometryCombineMode.Exclude, null));
DrawingBrush br = new DrawingBrush(dr);
drawingContext.PushOpacityMask(br);

drawingContext.DrawGeometry(null, new Pen(Brushes.Green, 2), graphVisual);

drawingContext.Pop(); 
```

# emacs - 使用 Emacs 缩进（移位 4）代码

> ID：594156
> 
> 赞同：13
> 
> 时间：2009-02-27T09:55:16.590
> 
> 标签：emacs, elisp

[我使用ViewSourceWith](http://dafizilla.sourceforge.net/viewsourcewith/) 和 Emacs编辑我的 StackOverflow 答案和问题。通常，我包含代码并且[StackOverflow 格式规则](https://stackoverflow.com/editing-help) 说它必须缩进四个空格才能被识别为这样。手动甚至使用宏都是痛苦的。

我搜索了 SO 以前的帖子，但一无所获。

从 Python 模式开始，我写道：

```
(defun text-shift-region (start end count)
  "Indent lines from START to END by COUNT spaces."
  (save-excursion
(goto-char end)
(beginning-of-line)
(setq end (point))
(goto-char start)
(beginning-of-line)
(setq start (point))
(indent-rigidly start end count)))

(defun text-shift-region-right (start end &optional count)
  "Shift region of code to the right
   Stolen from python-mode.
   The lines from the line containing the start of the current region up
   to (but not including) the line containing the end of the region are
   shifted to the right, by `text-indent-offset' columns.

   If a prefix argument is given, the region is instead shifted by that
   many columns.  With no active region, indent only the current line."
  (interactive
   (let ((p (point))
     (m (mark))
     (arg current-prefix-arg))
 (if m
     (list (min p m) (max p m) arg)
   (list p (save-excursion (forward-line 1) (point)) arg))))
  (text-shift-region start end (prefix-numeric-value
              (or count text-indent-offset)))
  )

;; Code in StackOverflow must be marked by four spaces at the
;; beginning of the line
(setq text-indent-offset 4)
(global-set-key "\C-c>" 'text-shift-region-right) 
```

它似乎有效，但我欢迎建议、替代方案、错误报告等。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-02-27T10:07:40.490

Cx TAB 运行`indent-rigidly`。给定一个四的数字参数，它会做你想要的。[或者使用 <pre><code> 来介绍你的代码（参见Markdown 编辑帮助](https://stackoverflow.com/editing-help)的第一段）。

编辑：您的交互式声明最好写成：

```
(interactive "r
p") 
```

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-02-27T15:10:02.260

另一个简单的方法是使用 emacs 强大的矩形编辑能力：设置你的区域从第一行的开头到你想要缩进的最后一行的开头（注意：它*必须*在开头该行，因为您不想替换现有文本！），然后执行

```
C-x r t (string-rectangle) 
```

然后按照提示输入4个空格即可。瞧！不需要额外的 lisp 黑客攻击。这还使您可以灵活地将空格旁边的其他内容插入到一堆行的开头或中间的任何位置。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-02-27T16:58:20.720

使用 Cx TAB 严格缩进（如另一个答案中所述）是最简单的方法。只需标记要缩进的区域，然后按 Cu Cx TAB。由于 Cu 的默认前缀是 4，这应该完全符合您的要求。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-27T12:54:51.523

你的代码对我来说看起来不错。我认为重新设置`end`in`text-shift-region`没有必要，但除此之外，它看起来还不错。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-12-08T08:48:51.373

在[python-mode](http://www.emacswiki.org/emacs/ProgrammingWithPythonModeDotEl)中，您可以标记一个区域（`C-space`，移动光标）并点击`C-c >`缩进 4 个空格。

# asp.net - 层次网格

> ID：594160
> 
> 赞同：2
> 
> 时间：2009-02-27T09:55:41.253
> 
> 标签：asp.net

谁能帮助我如何使用 C# 在 ASP.net 中创建分层 Ultrawebgrid...我对此很陌生...所以我需要一些基础知识和示例代码..你能帮帮我吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-01T15:39:59.770

使 UltraWebGrid “分层”的一种方法是在数据集中建立数据关系并将数据集绑定到 UltraWebGrid。

例如，假设我们有一个博客，并且我们希望将博客文章显示为父级，然后对每篇文章的任何评论显示为分层 UltraWebGrid 中的子级。父表名为“BlogArticle”并由“BlogArticleID”作为键，子表名为“BlogComment”并包含一个“BlogArticleID”列作为“BlogArticle”的外键。

首先，我们将建立 2 个数据集，并使用您喜欢的任何机制填充我们想要的数据。在这种情况下，我只是检索所有博客文章和所有评论。然后我们会将作为子数据集的数据集“合并”到作为父数据集的数据集中。最后，我们将在数据集中设置数据关系并将数据集绑定到 UltraWebGrid。

代码示例如下...

```
DataSet dsBlogArticle = new DataSet();
DataSet dsBlogComment = new DataSet();
//
// Fill each dataset appropriately.   
//
// Set Table Names.  This is needed for the merge operation.
dsBlogArticle.Tables[0].TableName = "BlogArticle";
dsBlogComment.Tables[0].TableName = "BlogComment";
//
// Merge the Blog Comment dataset into the Blog Article dataset
// to create a single dataset object with two tables.
dsBlogArticle.Merge(dsBlogComment);  
//
// Define Hierarchical relationships in the Dataset.
DataRelation dr = new DataRelation(
   "BlogArticleToComments",
   dsBlogArticle.Tables["BlogArticle"].Columns["BlogArticleID"],
   dsBlogArticle.Tables["BlogComment"].Columns["BlogArticleID"],
   false);
dsBlogArticle.Relations.Add(dr);    
//
// Bind the dataset to the grid.
this.grdBlogArticle.DataSource = dsBlogArticle;
this.grdBlogArticle.DataBind(); 
```

UltraWebGrid 将根据数据集中建立的数据关系自动处理创建层次网格。要查看此代码填充 UltraWebGrid，您可以[转到此处](http://www.innovaapps.net/samples/)查看我放在一起的示例。

我希望这会有所帮助，谢谢

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-27T10:09:15.510

这是[你](http://dotnetslackers.com/articles/aspnet/QuickGuideToImplementingTheNetAdvantageUltraWebGrid.aspx)要找的吗？

# c++ - 拦截/重新路由 TCP SYN 数据包到 Linux 中的 C++ 程序

> ID：594162
> 
> 赞同：1
> 
> 时间：2009-02-27T09:57:01.297
> 
> 标签：c++, linux, tcp

我试图找到最简单的方法来拦截我的计算机在 C++ 程序中发送的 TCP SYN 数据包。我知道有几种选择。一种是监控所有流量，只选择性地处理 SYN 数据包，其余的不做任何事情。我遇到的另一个选择是使用数据包过滤实用程序，它将 SYN 数据包转发到我的程序。有人建议我使用[netfilter 来做](http://www.netfilter.org/)同样的事情。

我想知道是否还有其他选择，或者我应该深入研究 netfilter。此外，有关如何使用 netfilter 执行此操作的任何指示都会有所帮助。

编辑：我想拦截 SYN 数据包，可能需要修改它（重新路由到不同的目的地，更改目标端口等），然后再将其重新注入网络

编辑：我能够使用 iptables 和 libnetfilter_queue 的组合来做到这一点。我使用 ipfilter 将所有 TCP SYN 数据包重定向到特定队列（这是使用简单命令）
然后在 C 程序中我能够使用 libnetfilter_queue API 访问队列中的数据包分析它们并将它们重新注入网络。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-27T10:02:57.757

如果您只想*查看*数据包，请使用`libpcap`数据包过滤 - 这适用于大多数 UNIX 变体。

如果您想以某种方式拦截和重写数据包，请提供有关您尝试做什么以及之后数据包应该发生什么的更多信息。

正如您所建议的，这可能是 netfilter 及其[队列](http://www.netfilter.org/projects/libnetfilter_queue/index.html)模块的应用程序，尽管这需要 2.6.14 或更高版本的内核：

> 主要特点
> 
> *   从内核 nfnetlink_queue 子系统接收排队的数据包
> *   向内核 nfnetlink_queue 子系统发布判决和/或重新注入更改的数据包

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-27T10:02:59.067

您可以使用原始套接字或例如 pcap 库。使用 pcap 设置过滤器并捕获有趣的流量：

```
#include <pcap.h>
...
pcap_t* reader_handle;
char errbuf[PCAP_ERRBUF_SIZE];
if ( (reader_handle = pcap_open_live(device_string, capture_size, 0, timeout, errbuf) ) == NULL)
{
    //ooops
}
struct bpf_program fp;
if (pcap_compile(reader_handle, &fp, filter_string, 1, 0) == -1)
{
    //ooops, cleanup
}
if (pcap_setfilter(reader_handle, &fp) == -1)
{
    //ooops, cleanup
}
pcap_freecode(&fp); 
```

之后你只是捕获，有几种不同的方法，例如：

```
pcap_pkthdr* header; 
u_char* pkt_data;
const int status = pcap_next_ex(reader_handle, &header, &pkt_data);
// Check the status 
```

结束捕获后：

```
pcap_close(reader_handle); 
```

您需要特权才能使用原始套接字。上面的例子可以很好地包装在 C++ 中。

# iphone - 如何在 iPhone 上返回字符串中字符的索引？

> ID：594166
> 
> 赞同：1
> 
> 时间：2009-02-27T09:58:59.857
> 
> 标签：iphone, string, indexing

我想拆分几个单独标记不同的字符串。

例如分隔一个字符串：“AB^C~D”

所以我想得到每个单独标记的索引。iPhone上有没有类似 indexOf(' ') 的方法？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-27T10:16:48.520

NSString 有很多查找字符和子字符串的方法。它们基本上是这两者的变体：

```
- (NSRange)rangeOfCharacterFromSet:(NSCharacterSet *)aSet

- (NSRange)rangeOfString:(NSString *)aString 
```

返回的 NSRange 有一个`location`and`length`字段。如果找不到部分`location`将设置为`NSNotFound`

但看起来你应该使用该方法

```
- (NSArray *)componentsSeparatedByCharactersInSet:(NSCharacterSet *)separator 
```

这将返回一个包含分隔部分的数组。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-09-26T12:33:38.527

此代码将返回字符串中字符的位置。

```
NSString *myString = @"A-B^C~D";
int dash = [myString rangeOfString:@"-"].location;
int power = [myString rangeOfString:@"^"].location;
int squiggle = [myString rangeOfString:@"~"].location; 
```

# c# - 哪种 C# 设计模式适合在 asp.net 中编写自定义工作流

> ID：594170
> 
> 赞同：2
> 
> 时间：2009-02-27T10:02:13.420
> 
> 标签：c#, asp.net, design-patterns, workflow

试图在 intertubes 上找到一些例子。我正在考虑状态或战略模式，但如果有人有任何战争故事、例子或资源可以向我指出，我将不胜感激。

我不/不能使用 Windows 工作流程。

我的例子是我有一个复杂的向导，它根据用户正在做什么以及用户是谁来更改进程的状态。

例如：

*   取消
*   用户请求
*   经理要求
*   确认的
*   裁判
*   管理员收到
*   管理员确认
*   管理员取消

干杯约翰

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-27T10:45:58.090

[状态](http://www.sloppycode.net/articles/csharp-design-patterns.aspx#state)模式（[维基百科链接](http://en.wikipedia.org/wiki/State_pattern)）怎么样？

```
public abstract class State
{
    /// <summary>
    /// Holds the current state we're in.
    /// </summary>
    public State CurrentState
    { 
        get; 
        set; 
    }

    public virtual string Cancelled(State context)
    {
        return "";
    }

    public virtual string RequestedByUser(State context)
    {
        return "";
    }

    public virtual string RequestedByManager(State context)
    {
        return "";
    }
}

public class CancelledState : State
{
    public override string Cancelled(State context)
    {
        context.CurrentState = new SittingState();
        return "Cancelled.";
    }

    public override string RequestedByUser(State context)
    {
        context.CurrentState = new RequestedByUserState();
        return "Requested by User.";
    }

    public override string RequestedByManager(State context)
    {
        return "You can't do this before it's been requested by the User";
    }
}

// (RequestedByUserState and RequestedByManagerState classes have been cut out) 
```

*如您所见，该模式确实非常适合。*

[如果存在安全问题，责任链](http://en.wikipedia.org/wiki/Chain-of-responsibility_pattern)也可能是相关的。如果维基百科的文章没有意义，那么[这本书](http://www.amazon.co.uk/3-0-Design-Patterns-Judith-Bishop/dp/059652773X/ref=sr_1_4?ie=UTF8&s=books&qid=1216066920&sr=8-4)有一个很好的例子。另一个是向导的命令模式。它们都不是完美的，但它们会给你一些好的想法。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-27T10:27:28.710

设计模式并不特定于任何语言（C# 设计模式？）。

我建议你应该专注于为你的工作流实现构建一个框架，通过使用不同的模式，而不是仅仅考虑一个可以满足你所有需求的理想模式。

最近在 Javaworld 中阅读了一篇关于使用 Dispatcher 模式实现工作流的文章。

见[http://www.javaworld.com/javaworld/jw-10-2001/jw-1019-dispatcher.html](http://www.javaworld.com/javaworld/jw-10-2001/jw-1019-dispatcher.html)

您还可以考虑在 C# 中评估替代的现有开源工作流框架，例如 NetBPM [http://www.netbpm.org/](http://www.netbpm.org/)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-01-26T16:27:03.617

“责任链”或多或少类似于工作流程风格。这是一个很棒的模式，可以使用巨大的灵活性选项。我强烈建议您尝试一下。

# c# - ListView 光标变化和闪烁

> ID：594174
> 
> 赞同：4
> 
> 时间：2009-02-27T10:04:04.413
> 
> 标签：c#, .net, winforms, listview

当光标出现在项目上时，我正在尝试更改出现在标准 ListView 上的光标。但是，当鼠标变为手指光标时，我得到了闪烁的效果，然后又回到了我要求的状态。

我正在尝试隔离此闪烁/更改为手形光标，但无法弄清楚它发生在哪里或如何停止它。要复制这个...

1) 创建一个带有 ListView 的表单。2）添加图像列表和一些图像。将视图设置为大图标模式。3) 将一些项目添加到 ListView。

将`MouseMove`事件添加到`ListView`：

```
private void listView1_MouseMove(object sender, MouseEventArgs e)
{
    ListViewItem selected = this.listView1.GetItemAt(e.X, e.Y);
    if (selected == null)
    {
        base.Cursor = Cursors.Default;
    }
    else
    {
        base.Cursor = Cursors.No;
    }
} 
```

执行应用程序，将鼠标移到项目上。当您在某个项目上时，您应该会看到光标在 No（无输入光标）和手指指针之间闪烁。问题是如何确保它只显示无光标并且不闪烁。（C# .NET）。

我已经尝试覆盖 OnMouseMove 和 OnMouseHover 以返回以确保它们不会设置任何内容。我也尝试过覆盖 Cursor 属性并说“仅设置为默认值或没有光标”，但这也不起作用。

任何帮助表示赞赏。

伊恩

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-28T09:43:53.817

问题是 C# ListView Control 基本上是 Windows List View Control 的包装器。因此，当我们将光标设置为箭头时，底层列表视图控件始终默认为手形光标，而我们在 C# ListView 类中的设置希望它是箭头。这就是为什么我们会出现这种闪烁，因为底层控制权正在恢复到 Hand 手中。

这是您需要添加的代码：

```
public const uint LVM_SETHOTCURSOR = 4158;

[DllImport("user32.dll")]
public static extern IntPtr SendMessage(IntPtr hWnd, uint Msg, IntPtr wParam, IntPtr lParam);

SendMessage(listView1.Handle, LVM_SETHOTCURSOR, IntPtr.Zero, Cursors.Arrow.Handle); 
```

从 Form 的 onLoad 事件中调用 SendMessage 非常重要，因为届时底层的 ListView 控件已完全初始化！

其实很简单，祝你有个美好的一天！:)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-28T18:53:39.780

在没有尝试过的情况下，游标通常会响应 WM_SETCURSOR 而更改，因此您可能与 ListView 的默认 WM_SETCURSOR 处理发生冲突。我会尝试创建一个从 ListView 派生的新 UserControl，然后在 WndProc 中捕获 WM_ SETCURSOR 并查看是否有帮助。

# c# - 将字符串或 NULL 插入 SQL Server 数据库时出现问题

> ID：594176
> 
> 赞同：0
> 
> 时间：2009-02-27T10:04:36.753
> 
> 标签：c#, operators, dbnull

我刚刚阅读了这篇文章的最佳答案：
[Problem inserting string or NULL into SQL Server database](https://stackoverflow.com/questions/374522/problem-inserting-string-or-null-into-sql-server-database)

如果我错了，请纠正我，但是 ?? 运算符不仅可以用于相同类型的两个变量，如果不是，我将不胜感激，如果有人能解决我的小问题。

我试图在我的项目中插入一些类似于下面的代码。

```
Dictionary<string, string> strings = new Dictionary<string, string>()
{
    {"@param0", strParam0},
    {"@param1", strParam1},
    {"@param2", strParam2}
};
foreach (string param in strings.Keys)
{
    cmd.Parameters.AddWithValue(param, strings[param] ?? DBNull.Value);
} 
```

但 Visual Studio 抱怨以下消息：
“操作员 '??' 不能应用于‘string’和‘System.DBNull’类型的操作数”

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-27T10:09:43.153

尝试：

```
cmd.Parameters.AddWithValue(param, (object)strings[param] ?? DBNull.Value); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-27T10:08:45.357

DBNull 和 Null 不是同一个类型，可空类型或引用类型和 DBNull 也不相同。你只能用？？具有相同类型的值。

能想到的？？运算符作为语法糖：

```
(left != null) ? left : right 
```

并且三元运算要求左右都是同一类型，因此 ?? 运算符也必须属于同一类型。

所以，不幸的是，不......你不能这样做，至少不能没有一些丑陋的演员。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-27T10:18:51.523

```
 cmd.Parameters.AddWithValue(param, strings[param] == null ? DBNull.Value : strings[param]); 
```

唯一的缺点是它会查字典两次！

# reporting-services - 报表生成器，提示过滤器，如何忽略过滤器？

> ID：594177
> 
> 赞同：0
> 
> 时间：2009-02-27T10:04:50.793
> 
> 标签：reporting-services, reportingservices-2005, reportbuilder

我正在查看 2005 年的报告生成器。我知道我可以提示过滤器，以便用户可以自己过滤数据。但是，如果他们不想这样呢？如何设置过滤器可选。所以他们要么看到一切，要么使用过滤器。

现在我只能有一个过滤的报告。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-11T10:52:04.107

首先，您必须为所有参数设置默认值。对于数字参数，它可能是 0，对于 varchar - NULL 或空字符串。对于多值参数，我想说只包括所有可用值。所以假设您有报告参数：
UserIDParam, int, default value 0
UserNameParam, varchar, default value NULL
UserRelatedIDList, multivalue int, default value (0, 1, 2, 3, 4)
然后在查询中您只需在过滤器中使用 thouse 参数：

```
SELECT U.ID, U.Name, U.Phone, U.Adress, RU.ID, RU.Name, RU.Phone, RU.Adress
FROM Users U
LEFT JOIN RelatedUsers RU ON U.ID = R.UserID
LEFT JOIN Users ON R R.RelatedUserID = ON RU.ID
WHERE ((ISNULL(@UserIDParam, 0) = 0) OR (U.ID = @UserIDParam)) AND
  ((ISNULL(@UserNameParam, '') = '') OR (U.Name = @UserNameParam)) AND
  ((0 IN (@UserRelatedIDList) AND R.UserID IS NULL) OR 
      (R.UserID IN (@UserRelatedIDList))) 
```

请参阅[Chris Hays 的报告服务 Sleazy Hacks 博客 - “全部”参数值](http://blogs.msdn.com/chrishays/archive/2004/07/27/AllParameterValue.aspx)
[Chris Hays 的报告服务 Sleazy Hacks 博客 - “全部”参数值 Redux](http://blogs.msdn.com/chrishays/archive/2006/04/18/AllParameterValueRedux.aspx)
[SQLCenral 论坛 - 报告服务中的默认参数值](http://www.sqlservercentral.com/Forums/Topic393820-149-1.aspx#bm393828)

现在默认情况下过滤器不会过滤掉任何数据。
您还可以做的是在报表查看器中隐藏报表参数区域。如果您使用 ReportViewer 或使用 URL 提供对报告的访问权限，则可以配置**Toolbar**、**Parameters**和其他报告设置：

```
http://servername/reportserver?/YourReportName&rs:Command=Render&rs:Format=HTML4.0&rc:Parameters=false 
```

将**参数**设置为：
true - 将显示参数面板，
false - 将隐藏参数面板，
Collapsed - 将隐藏参数面板，但最终用户可以切换。
请参阅[使用 URL 访问参数](http://msdn.microsoft.com/en-us/library/ms152835(SQL.90).aspx)

# ios - 选择文本字段时使 UITableView 滚动

> ID：594181
> 
> 赞同：256
> 
> 时间：2009-02-27T10:05:50.213
> 
> 标签：ios, iphone, uitableview, keyboard, scroll

经过大量的试验和错误，我放弃并提出这个问题。我见过很多人有类似的问题，但无法得到所有正确的答案。

我有一个`UITableView`由自定义单元组成的。单元格由 5 个彼此相邻的文本字段组成（有点像网格）。

当我尝试滚动和编辑底部的单元格时`UITableView`，我无法将我的单元格正确定位在键盘上方。

我已经看到很多关于更改视图大小等的答案......但到目前为止，它们都没有很好地工作。

任何人都可以通过具体的代码示例来阐明执行此操作的“正确”方法吗？

* * *

## 回答 #1

> 赞同：128
> 
> 时间：2010-09-21T03:42:12.937

如果你使用 UITableViewController 而不是 UIViewController，它会自动这样做。

* * *

## 回答 #2

> 赞同：94
> 
> 时间：2009-04-15T12:21:53.927

进行滚动的函数可能要简单得多：

```
- (void) textFieldDidBeginEditing:(UITextField *)textField {
    UITableViewCell *cell;

    if (floor(NSFoundationVersionNumber) <= NSFoundationVersionNumber_iOS_6_1) {
    // Load resources for iOS 6.1 or earlier
        cell = (UITableViewCell *) textField.superview.superview;

    } else {
        // Load resources for iOS 7 or later
        cell = (UITableViewCell *) textField.superview.superview.superview; 
       // TextField -> UITableVieCellContentView -> (in iOS 7!)ScrollView -> Cell!
    }
    [tView scrollToRowAtIndexPath:[tView indexPathForCell:cell] atScrollPosition:UITableViewScrollPositionTop animated:YES];
} 
```

而已。根本没有计算。

* * *

## 回答 #3

> 赞同：71
> 
> 时间：2010-04-13T14:46:50.160

我正在做一些非常相似的事情，它是通用的，不需要为你的代码计算特定的东西。只需检查代码上的注释：

在 MyUIViewController.h

```
@interface MyUIViewController: UIViewController <UITableViewDelegate, UITableViewDataSource>
{
     UITableView *myTableView;
     UITextField *actifText;
}

@property (nonatomic, retain) IBOutlet UITableView *myTableView;
@property (nonatomic, retain) IBOutlet UITextField *actifText;

- (IBAction)textFieldDidBeginEditing:(UITextField *)textField;
- (IBAction)textFieldDidEndEditing:(UITextField *)textField;

-(void) keyboardWillHide:(NSNotification *)note;
-(void) keyboardWillShow:(NSNotification *)note;

@end 
```

在 MyUIViewController.m

```
@implementation MyUIViewController

@synthesize myTableView;
@synthesize actifText;

- (void)viewDidLoad 
{
    // Register notification when the keyboard will be show
    [[NSNotificationCenter defaultCenter] addObserver:self
                                          selector:@selector(keyboardWillShow:)
                                          name:UIKeyboardWillShowNotification
                                          object:nil];

    // Register notification when the keyboard will be hide
    [[NSNotificationCenter defaultCenter] addObserver:self
                                          selector:@selector(keyboardWillHide:)
                                          name:UIKeyboardWillHideNotification
                                          object:nil];
}

// To be link with your TextField event "Editing Did Begin"
//  memoryze the current TextField
- (IBAction)textFieldDidBeginEditing:(UITextField *)textField
{
    self.actifText = textField;
}

// To be link with your TextField event "Editing Did End"
//  release current TextField
- (IBAction)textFieldDidEndEditing:(UITextField *)textField
{
    self.actifText = nil;
}

-(void) keyboardWillShow:(NSNotification *)note
{
    // Get the keyboard size
    CGRect keyboardBounds;
    [[note.userInfo valueForKey:UIKeyboardFrameBeginUserInfoKey] getValue: &keyboardBounds];

    // Detect orientation
    UIInterfaceOrientation orientation = [[UIApplication sharedApplication] statusBarOrientation];
    CGRect frame = self.myTableView.frame;

    // Start animation
    [UIView beginAnimations:nil context:NULL];
    [UIView setAnimationBeginsFromCurrentState:YES];
    [UIView setAnimationDuration:0.3f];

    // Reduce size of the Table view 
    if (orientation == UIInterfaceOrientationPortrait || orientation == UIInterfaceOrientationPortraitUpsideDown)
        frame.size.height -= keyboardBounds.size.height;
    else 
        frame.size.height -= keyboardBounds.size.width;

    // Apply new size of table view
    self.myTableView.frame = frame;

    // Scroll the table view to see the TextField just above the keyboard
    if (self.actifText)
      {
        CGRect textFieldRect = [self.myTableView convertRect:self.actifText.bounds fromView:self.actifText];
        [self.myTableView scrollRectToVisible:textFieldRect animated:NO];
      }

    [UIView commitAnimations];
}

-(void) keyboardWillHide:(NSNotification *)note
{
    // Get the keyboard size
    CGRect keyboardBounds;
    [[note.userInfo valueForKey:UIKeyboardFrameBeginUserInfoKey] getValue: &keyboardBounds];

    // Detect orientation
    UIInterfaceOrientation orientation = [[UIApplication sharedApplication] statusBarOrientation];
    CGRect frame = self.myTableView.frame;

    [UIView beginAnimations:nil context:NULL];
    [UIView setAnimationBeginsFromCurrentState:YES];
    [UIView setAnimationDuration:0.3f];

    // Increase size of the Table view 
    if (orientation == UIInterfaceOrientationPortrait || orientation == UIInterfaceOrientationPortraitUpsideDown)
        frame.size.height += keyboardBounds.size.height;
    else 
        frame.size.height += keyboardBounds.size.width;

    // Apply new size of table view
    self.myTableView.frame = frame;

    [UIView commitAnimations];
}

@end 
```

* * *

## 斯威夫特 1.2+ 版本：

```
class ViewController: UIViewController, UITextFieldDelegate {
    @IBOutlet weak var activeText: UITextField!
    @IBOutlet weak var tableView: UITableView!

    override func viewDidLoad() {
        NSNotificationCenter.defaultCenter().addObserver(self,
            selector: Selector("keyboardWillShow:"),
            name: UIKeyboardWillShowNotification,
            object: nil)
        NSNotificationCenter.defaultCenter().addObserver(self,
            selector: Selector("keyboardWillHide:"),
            name: UIKeyboardWillHideNotification,
            object: nil)
    }

    func textFieldDidBeginEditing(textField: UITextField) {
        activeText = textField
    }

    func textFieldDidEndEditing(textField: UITextField) {
        activeText = nil
    }

    func keyboardWillShow(note: NSNotification) {
        if let keyboardSize = (note.userInfo?[UIKeyboardFrameBeginUserInfoKey] as? NSValue)?.CGRectValue() {
            var frame = tableView.frame
            UIView.beginAnimations(nil, context: nil)
            UIView.setAnimationBeginsFromCurrentState(true)
            UIView.setAnimationDuration(0.3)
            frame.size.height -= keyboardSize.height
            tableView.frame = frame
            if activeText != nil {
                let rect = tableView.convertRect(activeText.bounds, fromView: activeText)
                tableView.scrollRectToVisible(rect, animated: false)
            }
            UIView.commitAnimations()
        }
    }

    func keyboardWillHide(note: NSNotification) {
        if let keyboardSize = (note.userInfo?[UIKeyboardFrameBeginUserInfoKey] as? NSValue)?.CGRectValue() {
            var frame = tableView.frame
            UIView.beginAnimations(nil, context: nil)
            UIView.setAnimationBeginsFromCurrentState(true)
            UIView.setAnimationDuration(0.3)
            frame.size.height += keyboardSize.height
            tableView.frame = frame
            UIView.commitAnimations()
        }
    }
} 
```

* * *

## 回答 #4

> 赞同：49
> 
> 时间：2016-12-08T13:26:15.337

**Swift 3**最简单​​的解决方案，基于[Bartłomiej Semańczyk 解决方案](https://stackoverflow.com/a/32197147/1064438)：

```
override func viewDidLoad() {
    super.viewDidLoad()

    NotificationCenter.default.addObserver(self, selector: #selector(CreateEditRitualViewController.keyboardWillShow(notification:)), name: NSNotification.Name.UIKeyboardDidShow, object: nil)
    NotificationCenter.default.addObserver(self, selector: #selector(CreateEditRitualViewController.keyboardWillHide(notification:)), name: NSNotification.Name.UIKeyboardDidHide, object: nil)
}

deinit {
    NotificationCenter.default.removeObserver(self)
}

// MARK: Keyboard Notifications

@objc func keyboardWillShow(notification: NSNotification) {
    if let keyboardHeight = (notification.userInfo?[UIKeyboardFrameEndUserInfoKey] as? NSValue)?.cgRectValue.height {
        tableView.contentInset = UIEdgeInsetsMake(0, 0, keyboardHeight, 0)
    }
}

@objc func keyboardWillHide(notification: NSNotification) {
    UIView.animate(withDuration: 0.2, animations: {
        // For some reason adding inset in keyboardWillShow is animated by itself but removing is not, that's why we have to use animateWithDuration here
        self.tableView.contentInset = UIEdgeInsetsMake(0, 0, 0, 0)
    })
} 
```

* * *

## 回答 #5

> 赞同：45
> 
> 时间：2011-05-29T00:42:21.937

我有同样的问题，但注意到它只出现在一个视图中。所以我开始寻找控制器的差异。

我发现滚动行为是在`- (void)viewWillAppear:(BOOL)animated`超级实例中设置的。

所以一定要像这样实现：

```
- (void)viewWillAppear:(BOOL)animated {
    [super viewWillAppear:animated];
    // your code
} 
```

`UIViewController`使用or也没关系`UITableViewController`；通过将 a`UITableView`作为 self.view 的子视图放在`UIViewController`. 这是同样的行为。`[super viewWillAppear:animated];`如果呼叫丢失，视图不允许滚动。

* * *

## 回答 #6

> 赞同：41
> 
> 时间：2012-08-18T00:12:58.713

我可能错过了这一点，因为我没有在这里阅读整篇文章，但我想出的似乎看似简单。我还没有把它通过绞拧机，在所有情况下进行测试，但它似乎应该工作得很好。

只需通过键盘的高度调整tableview的contentInset，然后将单元格滚动到底部：

```
- (void)keyboardWasShown:(NSNotification *)aNotification
{
    NSDictionary* info = [aNotification userInfo];
    CGSize kbSize = [[info objectForKey:UIKeyboardFrameBeginUserInfoKey] CGRectValue].size;

    UIEdgeInsets contentInsets = UIEdgeInsetsMake(0.0, 0.0, kbSize.height, 0.0);
    self.myTableView.contentInset = contentInsets;
    self.myTableView.scrollIndicatorInsets = contentInsets;

    [self.myTableView scrollToRowAtIndexPath:self.currentField.indexPath atScrollPosition:UITableViewScrollPositionBottom animated:YES];
} 
```

而且当然

```
- (void)keyboardWasHidden:(NSNotification *)aNotification
{
    [UIView animateWithDuration:.3 animations:^(void) 
    {
        self.myTableView.contentInset = UIEdgeInsetsZero;
        self.myTableView.scrollIndicatorInsets = UIEdgeInsetsZero;
    }];
} 
```

这太简单了吗？我错过了什么吗？到目前为止，它对我来说很好，但正如我所说，我还没有把它通过榨汁机......

* * *

## 回答 #7

> 赞同：35
> 
> 时间：2009-03-23T01:49:32.950

我想我已经想出了与 Apple 应用程序的行为相匹配的解决方案。

首先，在你的 viewWillAppear: 中订阅键盘通知，这样你就知道键盘什么时候会显示和隐藏，系统会告诉你键盘的大小，但不要忘记在你的 viewWillDisappear: 中取消注册。

```
[[NSNotificationCenter defaultCenter]
    addObserver:self
       selector:@selector(keyboardWillShow:)
           name:UIKeyboardWillShowNotification
         object:nil];
[[NSNotificationCenter defaultCenter]
    addObserver:self
       selector:@selector(keyboardWillHide:)
           name:UIKeyboardWillHideNotification
         object:nil]; 
```

实现类似于下面的方法，以便在键盘显示后调整 tableView 的大小以匹配可见区域。在这里，我单独跟踪键盘的状态，因此我可以自己选择何时将 tableView 设置回全高，因为您在每次字段更改时都会收到这些通知。不要忘记实现 keyboardWillHide: 并选择合适的地方来修复你的 tableView 大小。

```
-(void) keyboardWillShow:(NSNotification *)note
{
    CGRect keyboardBounds;
    [[note.userInfo valueForKey:UIKeyboardBoundsUserInfoKey] getValue: &keyboardBounds];
    keyboardHeight = keyboardBounds.size.height;
    if (keyboardIsShowing == NO)
    {
        keyboardIsShowing = YES;
        CGRect frame = self.view.frame;
        frame.size.height -= keyboardHeight;

        [UIView beginAnimations:nil context:NULL];
        [UIView setAnimationBeginsFromCurrentState:YES];
        [UIView setAnimationDuration:0.3f];
        self.view.frame = frame;
        [UIView commitAnimations];
    }
} 
```

现在是滚动位，我们首先计算出几个尺寸，然后我们看到我们在可见区域中的位置，并将我们想要滚动的矩形设置为基于文本字段中间上方或下方的半视图在视图中的位置。在这种情况下，我们有一个 UITextField 数组和一个跟踪它们的枚举，因此将 rowHeight 乘以行号就可以得到框架在这个外部视图中的实际偏移量。

```
- (void) textFieldDidBeginEditing:(UITextField *)textField
{
    CGRect frame = textField.frame;
    CGFloat rowHeight = self.tableView.rowHeight;
    if (textField == textFields[CELL_FIELD_ONE])
    {
        frame.origin.y += rowHeight * CELL_FIELD_ONE;
    }
    else if (textField == textFields[CELL_FIELD_TWO])
    {
        frame.origin.y += rowHeight * CELL_FIELD_TWO;
    }
    else if (textField == textFields[CELL_FIELD_THREE])
    {
        frame.origin.y += rowHeight * CELL_FIELD_THREE;
    }
    else if (textField == textFields[CELL_FIELD_FOUR])
    {
        frame.origin.y += rowHeight * CELL_FIELD_FOUR;
    }
    CGFloat viewHeight = self.tableView.frame.size.height;
    CGFloat halfHeight = viewHeight / 2;
    CGFloat midpoint = frame.origin.y + (textField.frame.size.height / 2);
    if (midpoint < halfHeight)
    {
        frame.origin.y = 0;
        frame.size.height = midpoint;
    }
    else
    {
        frame.origin.y = midpoint;
        frame.size.height = midpoint;
    }
    [self.tableView scrollRectToVisible:frame animated:YES];
} 
```

这似乎工作得很好。

* * *

## 回答 #8

> 赞同：35
> 
> 时间：2010-12-13T16:01:09.117

如果您可以使用`UITableViewController`，您将免费获得该功能。但是，有时这不是一种选择，特别是如果您需要多个视图而不仅仅是`UITableView`.

这里介绍的一些解决方案不适用于 iOS ≥4，一些不适用于 iPad 或横向模式，一些不适用于蓝牙键盘（我们不希望任何滚动），一些不适用在多个文本字段之间切换时工作。因此，如果您选择任何解决方案，请务必测试这些案例。这是我们**在**[InAppSettingsKit中](http://www.inappsettingskit.com/)~~使用~~ 的解决方案：

 **```
- (void)_keyboardWillShow:(NSNotification*)notification {
    if (self.navigationController.topViewController == self) {
        NSDictionary* userInfo = [notification userInfo];

        // we don't use SDK constants here to be universally compatible with all SDKs ≥ 3.0
        NSValue* keyboardFrameValue = [userInfo objectForKey:@"UIKeyboardBoundsUserInfoKey"];
        if (!keyboardFrameValue) {
            keyboardFrameValue = [userInfo objectForKey:@"UIKeyboardFrameEndUserInfoKey"];
        }

        // Reduce the tableView height by the part of the keyboard that actually covers the tableView
        CGRect windowRect = [[UIApplication sharedApplication] keyWindow].bounds;
        if (UIInterfaceOrientationLandscapeLeft == self.interfaceOrientation ||UIInterfaceOrientationLandscapeRight == self.interfaceOrientation ) {
            windowRect = IASKCGRectSwap(windowRect);
        }
        CGRect viewRectAbsolute = [_tableView convertRect:_tableView.bounds toView:[[UIApplication sharedApplication] keyWindow]];
        if (UIInterfaceOrientationLandscapeLeft == self.interfaceOrientation ||UIInterfaceOrientationLandscapeRight == self.interfaceOrientation ) {
            viewRectAbsolute = IASKCGRectSwap(viewRectAbsolute);
        }
        CGRect frame = _tableView.frame;
        frame.size.height -= [keyboardFrameValue CGRectValue].size.height - CGRectGetMaxY(windowRect) + CGRectGetMaxY(viewRectAbsolute);

        [UIView beginAnimations:nil context:NULL];
        [UIView setAnimationDuration:[[userInfo objectForKey:UIKeyboardAnimationDurationUserInfoKey] doubleValue]];
        [UIView setAnimationCurve:[[userInfo objectForKey:UIKeyboardAnimationCurveUserInfoKey] intValue]];
        _tableView.frame = frame;
        [UIView commitAnimations];

        UITableViewCell *textFieldCell = (id)((UITextField *)self.currentFirstResponder).superview.superview;
        NSIndexPath *textFieldIndexPath = [_tableView indexPathForCell:textFieldCell];

        // iOS 3 sends hide and show notifications right after each other
        // when switching between textFields, so cancel -scrollToOldPosition requests
        [NSObject cancelPreviousPerformRequestsWithTarget:self];

        [_tableView scrollToRowAtIndexPath:textFieldIndexPath atScrollPosition:UITableViewScrollPositionMiddle animated:YES];
    }
}

- (void) scrollToOldPosition {
  [_tableView scrollToRowAtIndexPath:_topmostRowBeforeKeyboardWasShown atScrollPosition:UITableViewScrollPositionTop animated:YES];
}

- (void)_keyboardWillHide:(NSNotification*)notification {
    if (self.navigationController.topViewController == self) {
        NSDictionary* userInfo = [notification userInfo];

        [UIView beginAnimations:nil context:NULL];
        [UIView setAnimationDuration:[[userInfo objectForKey:UIKeyboardAnimationDurationUserInfoKey] doubleValue]];
        [UIView setAnimationCurve:[[userInfo objectForKey:UIKeyboardAnimationCurveUserInfoKey] intValue]];
        _tableView.frame = self.view.bounds;
        [UIView commitAnimations];

        [self performSelector:@selector(scrollToOldPosition) withObject:nil afterDelay:0.1];
    }
} 
```

这是InAppSettingsKit[中类的完整代码。](https://github.com/futuretap/InAppSettingsKit/blob/9f32e0c6fc6aa66c10595aaf2ad99d040270ce14/InAppSettingsKit/Controllers/IASKAppSettingsViewController.m)要对其进行测试，请使用“完整列表”子窗格，您可以在其中测试上述场景。

* * *

## 回答 #9

> 赞同：26
> 
> 时间：2015-08-25T06:42:42.040

**Swift**最简单的解决方案：

```
override func viewDidLoad() {
    super.viewDidLoad()

    searchBar?.becomeFirstResponder()
    NSNotificationCenter.defaultCenter().addObserver(self, selector: #selector(MyViewController.keyboardWillShow(_:)), name: UIKeyboardDidShowNotification, object: nil)
    NSNotificationCenter.defaultCenter().addObserver(self, selector: #selector(MyViewController.keyboardWillHide(_:)), name: UIKeyboardDidHideNotification, object: nil)
}

deinit {
    NSNotificationCenter.defaultCenter().removeObserver(self)
}

func keyboardWillShow(notification: NSNotification) {
    if let userInfo = notification.userInfo {
        if let keyboardHeight = userInfo[UIKeyboardFrameEndUserInfoKey]?.CGRectValue.size.height {
            tableView.contentInset = UIEdgeInsetsMake(0, 0, keyboardHeight, 0)
        }
    }
}

func keyboardWillHide(notification: NSNotification) {
    UIView.animateWithDuration(0.2, animations: { self.table_create_issue.contentInset = UIEdgeInsetsMake(0, 0, 0, 0) })
    // For some reason adding inset in keyboardWillShow is animated by itself but removing is not, that's why we have to use animateWithDuration here
    } 
```

**对于 Swift 4.2 或更高版本**

```
override func viewDidLoad() {
    super.viewDidLoad()
    searchBar?.becomeFirstResponder()
    NotificationCenter.default.addObserver(self, selector: #selector(self.keyboardWillShow), name: UIResponder.keyboardDidShowNotification, object: nil)
    NotificationCenter.default.addObserver(self, selector: #selector(self.keyboardWillHide), name: UIResponder.keyboardDidHideNotification, object: nil)
}

deinit {
    NotificationCenter.default.removeObserver(self)
}

 @objc func keyboardWillShow(notification: NSNotification) {
    if let userInfo = notification.userInfo {
            let keyboardHeight = (userInfo[UIResponder.keyboardFrameEndUserInfoKey] as AnyObject).cgRectValue.size.height
            accountSettingsTableView.contentInset = UIEdgeInsets(top: 0, left: 0, bottom: keyboardHeight, right: 0)

    }
}
@objc func keyboardWillHide(notification: NSNotification) {
    UIView.animate(withDuration: 0.2, animations: { self.accountSettingsTableView.contentInset = UIEdgeInsets(top: 0, left: 0, bottom: 0, right: 0) })}
} 
```

* * *

## 回答 #10

> 赞同：8
> 
> 时间：2015-01-03T21:36:19.157

我希望你们已经有了阅读所有这些的解决方案。但我发现我的解决方案如下。我期待您已经拥有一个带有`UITextField`. 因此，在准备时，只需将行索引保留到文本字段的标签中。

```
cell.textField.tag = IndexPath.row; 
```

创建一个具有全局范围的`activeTextField`, 实例，如下所示：`UITextField`

```
@interface EditViewController (){

    UITextField *activeTextField;

} 
```

所以，现在你只需在最后复制粘贴我的代码。并且不要忘记添加`UITextFieldDelegate`

```
#pragma mark - TextField Delegation

- (BOOL)textFieldShouldBeginEditing:(UITextField *)textField{

    activeTextField = textField;

    return YES;
}

- (void)textFieldDidEndEditing:(UITextField *)textField{

    activeTextField = nil;

} 
```

注册键盘`notifications`

```
#pragma mark - Keyboard Activity

- (void)registerForKeyboardNotifications

{

    [[NSNotificationCenter defaultCenter] addObserver:self

                                         selector:@selector(keyboardWasShown:)

                                             name:UIKeyboardDidShowNotification object:nil];

    [[NSNotificationCenter defaultCenter] addObserver:self

                                         selector:@selector(keyboardWillBeHidden:)

                                             name:UIKeyboardWillHideNotification object:nil];

} 
```

处理键盘`Notifications`：

发送时调用`UIKeyboardDidShowNotification`。

```
- (void)keyboardWasShown:(NSNotification*)aNotification

{

    NSDictionary* info = [aNotification userInfo];

    CGSize kbSize = [[info objectForKey:UIKeyboardFrameBeginUserInfoKey] CGRectValue].size;

    UIEdgeInsets contentInsets = UIEdgeInsetsMake(0.0, 0.0, kbSize.height, 0.0);

    [self.tableView setContentInset:contentInsets];

    [self.tableView setScrollIndicatorInsets:contentInsets];

    NSIndexPath *currentRowIndex = [NSIndexPath indexPathForRow:activeTextField.tag inSection:0];

    [self.tableView scrollToRowAtIndexPath:currentRowIndex atScrollPosition:UITableViewScrollPositionTop animated:YES];

} 
```

`UIKeyboardWillHideNotification`发送时调用

```
- (void)keyboardWillBeHidden:(NSNotification*)aNotification

{

    UIEdgeInsets contentInsets = UIEdgeInsetsZero;

    [self.tableView setContentInset:contentInsets];

    [self.tableView setScrollIndicatorInsets:contentInsets];

} 
```

现在还剩下一件事，在`registerForKeyboardNotifications`方法中调用`ViewDidLoad`方法如下：

```
- (void)viewDidLoad {

    [super viewDidLoad];

    // Registering keyboard notification

    [self registerForKeyboardNotifications];

    // Your codes here...

} 
```

你完成了，希望你`textFields`不再被键盘隐藏。

* * *

## 回答 #11

> 赞同：6
> 
> 时间：2011-08-03T02:35:10.497

结合并填写几个答案（特别是 Ortwin Gentz，用户 98013）和另一篇文章中的空白，这将在 iPad 上的纵向或横向模式下为 SDK 4.3 开箱即用：

```
@implementation UIView (FindFirstResponder)
- (UIResponder *)findFirstResponder
{
  if (self.isFirstResponder) {        
    return self;     
  }

  for (UIView *subView in self.subviews) {
    UIResponder *firstResponder = [subView findFirstResponder];
    if (firstResponder != nil) {
      return firstResponder;
    }
  }

  return nil;
}
@end

@implementation MyViewController

- (UIResponder *)currentFirstResponder {
  return [self.view findFirstResponder];
}

- (IBAction)editingEnded:sender {
  [sender resignFirstResponder];
}

- (BOOL)textFieldShouldReturn:(UITextField *)textField {
  [textField resignFirstResponder];
  return NO;
}

- (void)textFieldDidBeginEditing:(UITextField *)textField {
  UITableViewCell *cell = (UITableViewCell*) [[textField superview] superview];
  [_tableView scrollToRowAtIndexPath:[_tableView indexPathForCell:cell] atScrollPosition:UITableViewScrollPositionTop animated:YES];
}

- (void)keyboardWillShow:(NSNotification*)notification {
  if ([self currentFirstResponder] != nil) {
    NSDictionary* userInfo = [notification userInfo];

    // we don't use SDK constants here to be universally compatible with all SDKs ≥ 3.0
    NSValue* keyboardFrameValue = [userInfo objectForKey:@"UIKeyboardBoundsUserInfoKey"];
    if (!keyboardFrameValue) {
      keyboardFrameValue = [userInfo objectForKey:@"UIKeyboardFrameEndUserInfoKey"];
    }

    // Reduce the tableView height by the part of the keyboard that actually covers the tableView
    CGRect windowRect = [[UIApplication sharedApplication] keyWindow].bounds;
    CGRect viewRectAbsolute = [_tableView convertRect:_tableView.bounds toView:[[UIApplication sharedApplication] keyWindow]];
    CGRect frame = _tableView.frame;
    if (UIInterfaceOrientationLandscapeLeft == self.interfaceOrientation ||UIInterfaceOrientationLandscapeRight == self.interfaceOrientation ) {
      windowRect = CGRectMake(windowRect.origin.y, windowRect.origin.x, windowRect.size.height, windowRect.size.width);
      viewRectAbsolute = CGRectMake(viewRectAbsolute.origin.y, viewRectAbsolute.origin.x, viewRectAbsolute.size.height, viewRectAbsolute.size.width);
    }
    frame.size.height -= [keyboardFrameValue CGRectValue].size.height - CGRectGetMaxY(windowRect) + CGRectGetMaxY(viewRectAbsolute);

    [UIView beginAnimations:nil context:NULL];
    [UIView setAnimationDuration:[[userInfo objectForKey:UIKeyboardAnimationDurationUserInfoKey] doubleValue]];
    [UIView setAnimationCurve:[[userInfo objectForKey:UIKeyboardAnimationCurveUserInfoKey] intValue]];
    _tableView.frame = frame;
    [UIView commitAnimations];

    UITableViewCell *textFieldCell = (id)((UITextField *)self.currentFirstResponder).superview.superview;
    NSIndexPath *textFieldIndexPath = [_tableView indexPathForCell:textFieldCell];

    // iOS 3 sends hide and show notifications right after each other
    // when switching between textFields, so cancel -scrollToOldPosition requests
    [NSObject cancelPreviousPerformRequestsWithTarget:self];
    _topmostRowBeforeKeyboardWasShown = [[_tableView indexPathsForVisibleRows] objectAtIndex:0];
    [_tableView scrollToRowAtIndexPath:textFieldIndexPath atScrollPosition:UITableViewScrollPositionMiddle animated:YES];
  }
}

- (void) scrollToOldPosition {
  [_tableView scrollToRowAtIndexPath:_topmostRowBeforeKeyboardWasShown atScrollPosition:UITableViewScrollPositionTop animated:YES];
}

- (void)keyboardWillHide:(NSNotification*)notification {
  if ([self currentFirstResponder] != nil) {

    NSDictionary* userInfo = [notification userInfo];

    [UIView beginAnimations:nil context:NULL];
    [UIView setAnimationDuration:[[userInfo objectForKey:UIKeyboardAnimationDurationUserInfoKey] doubleValue]];
    [UIView setAnimationCurve:[[userInfo objectForKey:UIKeyboardAnimationCurveUserInfoKey] intValue]];
    _tableView.frame = self.view.bounds;
    [UIView commitAnimations];

    [self performSelector:@selector(scrollToOldPosition) withObject:nil afterDelay:0.1];
  }
}   

@end 
```

* * *

## 回答 #12

> 赞同：5
> 
> 时间：2010-09-21T13:19:02.407

如果您使用`Three20`，则使用该`autoresizesForKeyboard`属性。只需在您的视图控制器的`-initWithNibName:bundle`方法中设置

```
self.autoresizesForKeyboard = YES 
```

这需要注意：

1.  监听键盘通知并调整表格视图的框架
2.  滚动到第一响应者

做完了。

* * *

## 回答 #13

> 赞同：5
> 
> 时间：2009-07-11T22:01:52.093

键盘通知有效，但 Apple 的示例代码假定滚动视图是窗口的根视图。通常情况并非如此。您必须补偿标签栏等，以获得正确的偏移量。

这比听起来容易。这是我在 UITableViewController 中使用的代码。它有两个实例变量，hiddenRect 和keyboardShown。

```
// Called when the UIKeyboardDidShowNotification is sent.
- (void)keyboardWasShown:(NSNotification*)aNotification {
    if (keyboardShown)
        return;

    NSDictionary* info = [aNotification userInfo];

    // Get the frame of the keyboard.
    NSValue *centerValue = [info objectForKey:UIKeyboardCenterEndUserInfoKey];
    NSValue *boundsValue = [info objectForKey:UIKeyboardBoundsUserInfoKey];
    CGPoint keyboardCenter = [centerValue CGPointValue];
    CGRect keyboardBounds = [boundsValue CGRectValue];
    CGPoint keyboardOrigin = CGPointMake(keyboardCenter.x - keyboardBounds.size.width / 2.0,
                                         keyboardCenter.y - keyboardBounds.size.height / 2.0);
    CGRect keyboardScreenFrame = { keyboardOrigin, keyboardBounds.size };

    // Resize the scroll view.
    UIScrollView *scrollView = (UIScrollView *) self.tableView;
    CGRect viewFrame = scrollView.frame;
    CGRect keyboardFrame = [scrollView.superview convertRect:keyboardScreenFrame fromView:nil];
    hiddenRect = CGRectIntersection(viewFrame, keyboardFrame);

    CGRect remainder, slice;
    CGRectDivide(viewFrame, &slice, &remainder, CGRectGetHeight(hiddenRect), CGRectMaxYEdge);
    scrollView.frame = remainder;

    // Scroll the active text field into view.
    CGRect textFieldRect = [/* selected cell */ frame];
    [scrollView scrollRectToVisible:textFieldRect animated:YES];

    keyboardShown = YES;
}

// Called when the UIKeyboardDidHideNotification is sent
- (void)keyboardWasHidden:(NSNotification*)aNotification
{
    // Reset the height of the scroll view to its original value
    UIScrollView *scrollView = (UIScrollView *) self.tableView;
    CGRect viewFrame = [scrollView frame];
    scrollView.frame = CGRectUnion(viewFrame, hiddenRect);

    keyboardShown = NO;
} 
```

* * *

## 回答 #14

> 赞同：5
> 
> 时间：2009-05-01T06:09:39.630

如果您使用 uitableview 来放置您的文本字段（[来自 Jeff Lamarche](http://iphonedevelopment.blogspot.com/2009/02/all-generic-controllers-to-date-zip.html)），您可以像这样使用委托方法滚动表格视图。

（注意：我的文本字段存储在一个数组中，其索引与 tableview 中的行相同）

```
- (void) textFieldDidBeginEditing:(UITextField *)textField
    {

        int index;
        for(UITextField *aField in textFields){

            if (textField == aField){
                index = [textFields indexOfObject:aField]-1;
            }
        }

         if(index >= 0) 
            [self.tableView scrollToRowAtIndexPath:[NSIndexPath indexPathForRow:index inSection:0] atScrollPosition:UITableViewScrollPositionTop animated:YES];

        [super textFieldDidBeginEditing:textField];
    } 
```

* * *

## 回答 #15

> 赞同：5
> 
> 时间：2012-09-29T12:03:22.073

我的做法：

我首先继承 UITextField 并添加一个 indexPath 属性。在 cellFor... 方法中，我交出了 indexPath 属性。

然后我添加以下代码：

```
UITableViewCell *cell = [self.tableView cellForRowAtIndexPath:textField.indexPath];

CGPoint cellPoint = [cell convertPoint:textField.center toView:self.tableView];
[UIView animateWithDuration:0.3 animations:^(void){self.tableView.contentOffset = CGPointMake(0, cellPoint.y-50);}]; 
```

到 textFieldShould/WillBegin... 等。

当键盘消失时，您必须将其反转：

```
[UIView animateWithDuration:0.3 animations:^(void){self.tableView.contentOffset = CGPointMake(0, 0);}]; 
```

* * *

## 回答 #16

> 赞同：5
> 
> 时间：2018-01-12T00:10:46.393

# Swift 4.2 完整解决方案

我[使用一组协议创建了 GIST，这些协议](https://gist.github.com/Sorix/2c08b36f020658d153c57bbed6f028a8)可以在显示、隐藏或更改键盘时简化添加额外空间的工作。

**特点**：

*   正确使用键盘框架更改（例如键盘高度更改，如 emojii → 普通键盘）。
*   对 UITableView 示例的 TabBar 和 ToolBar 支持（在其他示例中，您收到不正确的插图）。
*   动态动画持续时间（非硬编码）。
*   可以根据您的目的轻松修改的面向协议的方法。

### 用法

包含一些滚动视图的视图控制器中的基本用法示例（当然也支持表格视图）。

```
class SomeViewController: UIViewController {
  @IBOutlet weak var scrollView: UIScrollView!

  override func viewWillAppear(_ animated: Bool) {
    super.viewWillAppear(animated)
    addKeyboardFrameChangesObserver()
  }

  override func viewWillDisappear(_ animated: Bool) {
    super.viewWillDisappear(animated)
    removeKeyboardFrameChangesObserver()
  }
}

extension SomeViewController: ModifableInsetsOnKeyboardFrameChanges {
  var scrollViewToModify: UIScrollView { return scrollView }
} 
```

### 核心：帧变化观察者

`KeyboardChangeFrameObserver`每次更改键盘框架（包括显示、隐藏、框架更改）时，协议都会触发事件。

1.  致电或类似方法`addKeyboardFrameChangesObserver()`。`viewWillAppear()`
2.  致电或类似方法`removeKeyboardFrameChangesObserver()`。`viewWillDisappear()`

### 实现：滚动视图

`ModifableInsetsOnKeyboardFrameChanges`协议增加了`UIScrollView`对核心协议的支持。当键盘框架改变时，它会改变滚动视图的插图。

您的班级需要设置滚动视图，一个人的插图将在键盘框架更改时增加/减少。

```
var scrollViewToModify: UIScrollView { get } 
```

* * *

## 回答 #17

> 赞同：4
> 
> 时间：2009-08-04T07:18:34.460

更精简的解决方案。它滑入 UITextField 委托方法，因此不需要使用 UIKeyboard 通知进行混乱。

实施说明：

kSettingsRowHeight -- UITableViewCell 的高度。

offsetTarget 和 offsetThreshold 与 kSettingsRowHeight 无关。如果您使用不同的行高，请将这些值设置为点的 y 属性。[alt：以不同的方式计算行偏移量。]

```
- (BOOL)textFieldShouldBeginEditing:(UITextField *)textField {
CGFloat offsetTarget    = 113.0f; // 3rd row
CGFloat offsetThreshold = 248.0f; // 6th row (i.e. 2nd-to-last row)

CGPoint point = [self.tableView convertPoint:CGPointZero fromView:textField];

[UIView beginAnimations:nil context:nil];
[UIView setAnimationDuration:0.2];
[UIView setAnimationCurve:UIViewAnimationCurveEaseOut];

CGRect frame = self.tableView.frame;
if (point.y > offsetThreshold) {
    self.tableView.frame = CGRectMake(0.0f,
                      offsetTarget - point.y + kSettingsRowHeight,
                      frame.size.width,
                      frame.size.height);
} else if (point.y > offsetTarget) {
    self.tableView.frame = CGRectMake(0.0f,
                      offsetTarget - point.y,
                      frame.size.width,
                      frame.size.height);
} else {
    self.tableView.frame = CGRectMake(0.0f,
                      0.0f,
                      frame.size.width,
                      frame.size.height);
}

[UIView commitAnimations];

return YES; 
```

}

```
- (BOOL)textFieldShouldReturn:(UITextField *)textField {
[textField resignFirstResponder];

[UIView beginAnimations:nil context:nil];
[UIView setAnimationBeginsFromCurrentState:YES];
[UIView setAnimationDuration:0.2];
[UIView setAnimationCurve:UIViewAnimationCurveEaseOut];

CGRect frame = self.tableView.frame;
self.tableView.frame = CGRectMake(0.0f,
                  0.0f,
                  frame.size.width,
                  frame.size.height);

[UIView commitAnimations];

return YES; 
```

}

* * *

## 回答 #18

> 赞同：4
> 
> 时间：2015-03-20T07:00:24.183

使用`UITextField's` `delegate`方法：

## 迅速

```
func textFieldShouldBeginEditing(textField: UITextField) -> bool {
  let txtFieldPosition = textField.convertPoint(textField.bounds.origin, toView: yourTableViewHere)
  let indexPath = yourTablViewHere.indexPathForRowAtPoint(txtFieldPosition)
  if indexPath != nil {
     yourTablViewHere.scrollToRowAtIndexPath(indexPath!, atScrollPosition: .Top, animated: true)
  }
  return true
} 
```

## Objective-C

```
- (BOOL)textFieldShouldBeginEditing:(UITextField *)textField
{
  CGPoint txtFieldPosition = [textField convertPoint:CGPointZero toView: yourTablViewHere];
  NSLog(@"Begin txtFieldPosition : %@",NSStringFromCGPoint(txtFieldPosition));
  NSIndexPath *indexPath = [yourTablViewHere indexPathForRowAtPoint:txtFieldPosition];

  if (indexPath != nil) {
     [yourTablViewHere scrollToRowAtIndexPath:indexPath atScrollPosition:UITableViewScrollPositionMiddle animated:YES];
  }
  return YES;
} 
```

* * *

## 回答 #19

> 赞同：3
> 
> 时间：2009-02-28T18:37:06.343

由于您在表格中有文本字段，因此最好的方法实际上是调整表格的大小 - 您需要将 tableView.frame 的高度设置为按键盘的大小（我认为大约 165 像素）变小，然后在键盘被关闭。

如果您不希望用户滚动，您也可以选择在那时禁用 tableView 的用户交互。

* * *

## 回答 #20

> 赞同：2
> 
> 时间：2010-10-23T07:11:24.583

这完美无缺，在 iPad 上也是如此。

```
- (BOOL)textFieldShouldReturn:(UITextField *)textField 
{

    if(textField == textfield1){
            [accountName1TextField becomeFirstResponder];
        }else if(textField == textfield2){
            [self.tableView scrollToRowAtIndexPath:[NSIndexPath indexPathForRow:0 inSection:1] atScrollPosition:UITableViewScrollPositionTop animated:YES];
            [textfield3 becomeFirstResponder];

        }else if(textField == textfield3){
            [self.tableView scrollToRowAtIndexPath:[NSIndexPath indexPathForRow:1 inSection:1] atScrollPosition:UITableViewScrollPositionTop animated:YES];
            [textfield4 becomeFirstResponder];

        }else if(textField == textfield4){
            [self.tableView scrollToRowAtIndexPath:[NSIndexPath indexPathForRow:2 inSection:1] atScrollPosition:UITableViewScrollPositionTop animated:YES];
            [textfield5 becomeFirstResponder];

        }else if(textField == textfield5){
            [self.tableView scrollToRowAtIndexPath:[NSIndexPath indexPathForRow:3 inSection:1] atScrollPosition:UITableViewScrollPositionTop animated:YES];
            [textfield6 becomeFirstResponder];

        }else if(textField == textfield6){
            [self.tableView scrollToRowAtIndexPath:[NSIndexPath indexPathForRow:4 inSection:1] atScrollPosition:UITableViewScrollPositionTop animated:YES];
            [textfield7 becomeFirstResponder];

        }else if(textField == textfield7){
            [self.tableView scrollToRowAtIndexPath:[NSIndexPath indexPathForRow:5 inSection:1] atScrollPosition:UITableViewScrollPositionTop animated:YES];
            [textfield8 becomeFirstResponder];

        }else if(textField == textfield8){
            [self.tableView scrollToRowAtIndexPath:[NSIndexPath indexPathForRow:6 inSection:1] atScrollPosition:UITableViewScrollPositionTop animated:YES];
            [textfield9 becomeFirstResponder];

        }else if(textField == textfield9){
            [self.tableView scrollToRowAtIndexPath:[NSIndexPath indexPathForRow:7 inSection:1] atScrollPosition:UITableViewScrollPositionTop animated:YES];
            [textField resignFirstResponder];
        } 
```

* * *

## 回答 #21

> 赞同：2
> 
> 时间：2011-07-18T08:45:17.227

因此，经过数小时的艰苦工作，试图使用这些当前的解决方案（并且完全失败），我终于让事情运转良好，并更新了它们以使用新的动画块。我的回答完全基于[Ortwin 上面的回答](https://stackoverflow.com/questions/594181/uitableview-and-keyboard-scrolling-problem/4430737#4430737)。

因此，无论出于何种原因，上面的代码都不适合我。我的设置似乎与其他人非常相似，但可能是因为我使用的是 iPad 或 4.3……不知道。它正在做一些古怪的数学运算并将我的桌面视图从屏幕上拍摄下来。

查看我的解决方案的最终结果：[http://screencast.com/t/hjBCuRrPC](http://screencast.com/t/hjBCuRrPC) （请忽略照片。:-P）

因此，我遵循 Ortwin 所做的要点，但改变了它做一些数学运算的方式，以将我的表格视图的 origin.y 和 size.height 与键盘的高度相加。当我从该结果中减去窗口的高度时，它会告诉我有多少交叉点。如果它大于 0（也就是有一些重叠），我会执行帧高度的动画。

此外，还有一些重绘问题通过 1) 等待滚动到单元格直到动画完成和 2) 在隐藏键盘时使用 UIViewAnimationOptionBeginFromCurrentState 选项来解决。

有几点需要注意。

*   _topmostRowBeforeKeyboardWasShown & _originalFrame 是在标头中声明的实例变量。
*   self.guestEntryTableView 是我的 tableView （我在一个外部文件中）
*   IASKCGRectSwap 是 Ortwin 的翻转帧坐标的方法
*   如果至少要显示 50px，我只会更新 tableView 的高度
*   由于我不在 UIViewController 中，我没有 self.view，所以我只是将 tableView 返回到其原始框架

同样，如果我 Ortwin 没有提供它的症结，我就不会接近这个答案。这是代码：

```
- (IBAction)textFieldDidBeginEditing:(UITextField *)textField
{
    self.activeTextField = textField;

    if ([self.guestEntryTableView indexPathsForVisibleRows].count) {
        _topmostRowBeforeKeyboardWasShown = (NSIndexPath*)[[self.guestEntryTableView indexPathsForVisibleRows] objectAtIndex:0];
    } else {
        // this should never happen
        _topmostRowBeforeKeyboardWasShown = [NSIndexPath indexPathForRow:0 inSection:0];
        [textField resignFirstResponder];
    }
}

- (IBAction)textFieldDidEndEditing:(UITextField *)textField
{
    self.activeTextField = nil;
}

- (void)keyboardWillShow:(NSNotification*)notification {
    NSDictionary* userInfo = [notification userInfo];

    NSValue* keyboardFrameValue = [userInfo objectForKey:UIKeyboardFrameEndUserInfoKey];

    // Reduce the tableView height by the part of the keyboard that actually covers the tableView
    UIInterfaceOrientation orientation = [[UIApplication sharedApplication] statusBarOrientation];
    CGRect windowRect = [[UIApplication sharedApplication] keyWindow].bounds;
    CGRect viewRectAbsolute = [self.guestEntryTableView convertRect:self.guestEntryTableView.bounds toView:[[UIApplication sharedApplication] keyWindow]];
    CGRect keyboardFrame = [keyboardFrameValue CGRectValue];
    if (UIInterfaceOrientationLandscapeLeft == orientation ||UIInterfaceOrientationLandscapeRight == orientation ) {
        windowRect = IASKCGRectSwap(windowRect);
        viewRectAbsolute = IASKCGRectSwap(viewRectAbsolute);
        keyboardFrame = IASKCGRectSwap(keyboardFrame);
    }

    // fix the coordinates of our rect to have a top left origin 0,0
    viewRectAbsolute = FixOriginRotation(viewRectAbsolute, orientation, windowRect.size.width, windowRect.size.height);

    CGRect frame = self.guestEntryTableView.frame;
    _originalFrame = self.guestEntryTableView.frame;

    int remainder = (viewRectAbsolute.origin.y + viewRectAbsolute.size.height + keyboardFrame.size.height) - windowRect.size.height;

    if (remainder > 0 && !(remainder > frame.size.height + 50)) {
        frame.size.height = frame.size.height - remainder;
        float duration = [[userInfo objectForKey:UIKeyboardAnimationDurationUserInfoKey] doubleValue];
        [UIView animateWithDuration: duration
                        animations:^{
                            self.guestEntryTableView.frame = frame;
                        }
                        completion:^(BOOL finished){
                            UITableViewCell *textFieldCell = (UITableViewCell*) [[self.activeTextField superview] superview];
                            NSIndexPath *textFieldIndexPath = [self.guestEntryTableView indexPathForCell:textFieldCell];
                            [self.guestEntryTableView scrollToRowAtIndexPath:textFieldIndexPath atScrollPosition:UITableViewScrollPositionMiddle animated:YES];
                        }];
    }

}

- (void)keyboardWillHide:(NSNotification*)notification {
    NSDictionary* userInfo = [notification userInfo];
    float duration = [[userInfo objectForKey:UIKeyboardAnimationDurationUserInfoKey] doubleValue];
    [UIView animateWithDuration: duration
                          delay: 0.0
                        options: (UIViewAnimationOptionBeginFromCurrentState)
                     animations:^{
                         self.guestEntryTableView.frame = _originalFrame;
                     }
                     completion:^(BOOL finished){
                         [self.guestEntryTableView scrollToRowAtIndexPath:_topmostRowBeforeKeyboardWasShown atScrollPosition:UITableViewScrollPositionTop animated:YES];
                     }];

}   

#pragma mark CGRect Utility function
CGRect IASKCGRectSwap(CGRect rect) {
    CGRect newRect;
    newRect.origin.x = rect.origin.y;
    newRect.origin.y = rect.origin.x;
    newRect.size.width = rect.size.height;
    newRect.size.height = rect.size.width;
    return newRect;
}

CGRect FixOriginRotation(CGRect rect, UIInterfaceOrientation orientation, int parentWidth, int parentHeight) {
    CGRect newRect;
    switch(orientation)
    {
        case UIInterfaceOrientationLandscapeLeft:
            newRect = CGRectMake(parentWidth - (rect.size.width + rect.origin.x), rect.origin.y, rect.size.width, rect.size.height);
            break;
        case UIInterfaceOrientationLandscapeRight:
            newRect = CGRectMake(rect.origin.x, parentHeight - (rect.size.height + rect.origin.y), rect.size.width, rect.size.height);
            break;
        case UIInterfaceOrientationPortrait:
            newRect = rect;
            break;
        case UIInterfaceOrientationPortraitUpsideDown:
            newRect = CGRectMake(parentWidth - (rect.size.width + rect.origin.x), parentHeight - (rect.size.height + rect.origin.y), rect.size.width, rect.size.height);
            break;
    }
    return newRect;
} 
```

* * *

## 回答 #22

> 赞同：2
> 
> 时间：2012-08-18T10:10:47.940

在我参考了通过 Google 和 Stack Overflow 找到的大量解决方案后，我自己解决了这样的问题。

首先，请确保您已经设置了 UIScrollView 的 IBOutlet，然后请仔细查看[Apple Doc: Keyboard Management](http://developer.apple.com/library/ios/#documentation/StringsTextFonts/Conceptual/TextAndWebiPhoneOS/KeyboardManagement/KeyboardManagement.html)。最后，如果你可以滚动背景，但键盘仍然覆盖文本字段，请看一下这段代码：

```
// If active text field is hidden by keyboard, scroll it so it's visible
// Your application might not need or want this behavior.
CGRect aRect = self.view.frame;
aRect.size.height -= kbSize.height;

if (aRect.size.height < activeField.frame.origin.y+activeField.frame.size.height) {

    CGPoint scrollPoint = CGPointMake(0.0, activeField.frame.origin.y+activeField.frame.size.height-aRect.size.height);

    [scrollView setContentOffset:scrollPoint animated:YES]; 
```

这篇文章和苹果的主要区别在于 if 条件。我认为苹果计算的滚动距离和键盘是否覆盖文本字段的条件不准确，所以我按照上面的方式进行了修改。

让我知道它是否有效

* * *

## 回答 #23

> 赞同：2
> 
> 时间：2012-07-17T17:11:11.283

非常有趣的讨论线程，我也遇到了同样的问题，可能会更糟，因为

1.  我使用的是自定义单元格，文本字段在其中。
2.  我不得不使用 UIViewController 来满足我的要求，所以不能利用 UITableViewController。
3.  我的表格单元格中有过滤/排序标准，即你的单元格不断变化并跟踪索引路径，所有这些都无济于事。

因此，请阅读此处的线程并实现我的版本，这有助于我在 iPad 中以**横向**模式推送我的内容。这是代码（这不是万无一失的，但它解决了我的问题）首先你需要在你的自定义单元格类中有一个委托，在编辑开始时，将文本字段发送到你的视图控制器并在那里设置 activefield = theTextField

// 仅用于处理横向模式

```
- (void)keyboardWasShown:(NSNotification*)aNotification
{
    NSDictionary* info = [aNotification userInfo];
    CGSize kbValue = [[info objectForKey:UIKeyboardFrameBeginUserInfoKey] CGRectValue].size;
    CGRect aRect = myTable.frame;

    CGSize kbSize = CGSizeMake(kbValue.height, kbValue.width);

    aRect.size.height -= kbSize.height+50;
// This will the exact rect in which your textfield is present
        CGRect rect =  [myTable convertRect:activeField.bounds fromView:activeField];
// Scroll up only if required
    if (!CGRectContainsPoint(aRect, rect.origin) ) {

            [myTable setContentOffset:CGPointMake(0.0, rect.origin.y) animated:YES];

    }

} 
```

// 在发送 UIKeyboardWillHideNotification 时调用

```
- (void)keyboardWillHide:(NSNotification*)aNotification
{
    UIEdgeInsets contentInsets = UIEdgeInsetsZero;
    myTable.contentInset = contentInsets;
    myTable.scrollIndicatorInsets = contentInsets;
    NSDictionary* info = [aNotification userInfo];
    CGSize kbValue = [[info objectForKey:UIKeyboardFrameBeginUserInfoKey] CGRectValue].size;
    CGSize kbSize = CGSizeMake(kbValue.height, kbValue.width);
    CGRect bkgndRect = activeField.superview.frame;
    bkgndRect.size.height += kbSize.height;
    [activeField.superview setFrame:bkgndRect];
    [myTable setContentOffset:CGPointMake(0.0, 10.0) animated:YES];
} 
```

-anoop4real

* * *

## 回答 #24

> 赞同：2
> 
> 时间：2011-12-02T18:28:05.387

这个解决方案对我有用，请注意这条线

```
[tableView setContentOffset:CGPointMake(0.0, activeField.frame.origin.y-kbSize.height+160) animated:YES]; 
```

您可以更改 160 值以使其适合您

```
- (void)keyboardWasShown:(NSNotification*)aNotification
{
    NSDictionary* info = [aNotification userInfo];
    CGSize kbSize = [[info objectForKey:UIKeyboardFrameBeginUserInfoKey] CGRectValue].size;
    CGRect bkgndRect = activeField.superview.frame;
                        bkgndRect.size.height += kbSize.height;
     [activeField.superview setFrame:bkgndRect];
     [tableView setContentOffset:CGPointMake(0.0, activeField.frame.origin.y-kbSize.height+160) animated:YES];
}

- (void)textFieldDidBeginEditing:(UITextField *)textField
{
   activeField = textField;
}
-(void)textFieldDidEndEditing:(UITextField *)textField
 {
     activeField = nil;
 }
// Called when the UIKeyboardWillHideNotification is sent
- (void)keyboardWillBeHidden:(NSNotification*)aNotification
{
    UIEdgeInsets contentInsets = UIEdgeInsetsZero;
    tableView.contentInset = contentInsets;
    tableView.scrollIndicatorInsets = contentInsets;
    NSDictionary* info = [aNotification userInfo];
    CGSize kbSize = [[info objectForKey:UIKeyboardFrameBeginUserInfoKey] CGRectValue].size;
    CGRect bkgndRect = activeField.superview.frame;
    //bkgndRect.size.height += kbSize.height;
    [activeField.superview setFrame:bkgndRect];
    [tableView setContentOffset:CGPointMake(0.0, activeField.frame.origin.y-kbSize.height) animated:YES];
} 
```

* * *

## 回答 #25

> 赞同：2
> 
> 时间：2011-05-13T05:00:24.820

我尝试了几乎相同的方法，并为此想出了一个更简单、更小的代码。我创建了一个 IBOutlet iTextView 并与 IB 中的 UITextView 关联。

```
 -(void)keyboardWillShow:(NSNotification *)notification
    {
        NSLog(@"Keyboard");
        CGRect keyFrame = [[[notification userInfo]objectForKey:UIKeyboardFrameEndUserInfoKey]CGRectValue];

        [UIView beginAnimations:@"resize view" context:nil];
        [UIView setAnimationCurve:1];
        [UIView setAnimationDuration:1.0];
        CGRect frame = iTableView.frame;
        frame.size.height = frame.size.height -  keyFrame.size.height;
        iTableView.frame = frame;
        [iTableView scrollRectToVisible:frame animated:YES];
        [UIView commitAnimations];

    } 
```

* * *

## 回答 #26

> 赞同：2
> 
> 时间：2015-05-21T06:34:55.153

Swift 中的一个示例，使用 [Get indexPath of UITextField in UITableViewCell with Swift](https://stackoverflow.com/questions/24073002/get-indexpath-of-uitextfield-in-uitableviewcell-with-swift)中的文本字段的确切点：

```
func textFieldDidBeginEditing(textField: UITextField) {
    let pointInTable = textField.convertPoint(textField.bounds.origin, toView: self.accountsTableView)
    let textFieldIndexPath = self.accountsTableView.indexPathForRowAtPoint(pointInTable)
    accountsTableView.scrollToRowAtIndexPath(textFieldIndexPath!, atScrollPosition: .Top, animated: true)
} 
```

* * *

## 回答 #27

> 赞同：2
> 
> 时间：2018-10-08T10:45:04.267

**Swift 4.2**的小变化......

在我的 UITableView 上，我有很多部分，但我不得不**避免浮动标题效果**，所以我使用了“ *dummyViewHeight* ”方法，正如在 Stack Overflow 上的其他地方看到的那样......所以这是我解决这个问题的方法（它也适用于键盘 +工具栏+建议）：

将其声明为类常量：

```
let dummyViewHeight: CGFloat = 40.0 
```

然后

```
override func viewDidLoad() {
    super.viewDidLoad()
    //... some stuff here, not needed for this example

    // Create non floating header
    tableView.tableHeaderView = UIView(frame: CGRect(x: 0, y: 0, width: tableView.bounds.size.width, height: dummyViewHeight))
    tableView.contentInset = UIEdgeInsets(top: -dummyViewHeight, left: 0, bottom: 0, right: 0)

    addObservers()
}

override func viewWillDisappear(_ animated: Bool) {
    super.viewWillDisappear(animated)
    removeObservers()
} 
```

而这里所有的魔法......

```
@objc func keyboardWillShow(notification: NSNotification) {
    if let userInfo = notification.userInfo {
        let keyboardHeight = (userInfo[UIResponder.keyboardFrameEndUserInfoKey] as AnyObject).cgRectValue.size.height
        tableView.tableHeaderView = UIView(frame: CGRect(x: 0, y: 0, width: self.tableView.bounds.size.width, height: dummyViewHeight))
        tableView.contentInset = UIEdgeInsets(top: -dummyViewHeight, left: 0, bottom: keyboardHeight, right: 0)
    }
}

@objc func keyboardWillHide(notification: NSNotification) {
    UIView.animate(withDuration: 0.25) {
        self.tableView.tableHeaderView = UIView(frame: CGRect(x: 0, y: 0, width: self.tableView.bounds.size.width, height: self.dummyViewHeight))
        self.tableView.contentInset = UIEdgeInsets(top: -self.dummyViewHeight, left: 0, bottom: 0, right: 0)
    }
} 
```

* * *

## 回答 #28

> 赞同：1
> 
> 时间：2012-03-05T06:09:43.257

如果您的 UITableView 由 UITableViewController 的子类而不是 UITableView 管理，并且文本字段委托是 UITableViewController，它应该自动管理所有滚动——所有这些其他注释在实践中都很难实现。

有关一个很好的示例，请参阅 Apple 示例代码项目：TaggedLocations。

您可以看到它自动滚动，但似乎没有任何代码可以做到这一点。这个项目也有自定义的表格视图单元格，所以如果你用它作为指导来构建你的应用程序，你应该会得到想要的结果。

* * *

## 回答 #29

> 赞同：1
> 
> 时间：2014-02-13T08:30:43.407

我正在使用这些，它们就像一个魅力：

BSKeyboardControls - [BSKeyboardControls github](https://github.com/simonbs/BSKeyboardControls)

TPKeyboardAvoiding - [TPKeyboardAvoiding github](https://github.com/michaeltyson/TPKeyboardAvoiding)

* * *

## 回答 #30

> 赞同：1
> 
> 时间：2012-07-26T17:18:59.440

以下是我完成这项工作的方法，其中混合了 Sam Ho 和 Marcel W 的答案，以及我自己对我糟糕的代码进行的一些错误修复。我正在使用 UITableViewController。现在，当显示键盘时，表格可以正确调整大小。

1）在`viewDidLoad`我添加：

`self.tableView.autoresizingMask = UIViewAutoresizingFlexibleHeight;`

2）我忘记在and中调用`super`等价物。我把这些加回去了。`viewWillAppear``awakeFromNib`

* * *

## 回答 #31

> 赞同：1
> 
> 时间：2013-12-31T12:37:25.300

简单快速的解决方案。

每当滚动发生时，我都会滚动到正确的单元格

```
 - (void)scrollViewDidScroll:(UIScrollView *)scrollView 
```

假设我知道表格现在处于这种模式“_keepMyCellOnTop”并且我知道选定的单元格“_selectedCellIndex”或滚动到选定的单元格

```
- (void)scrollViewDidScroll:(UIScrollView *)scrollView 
{

    if (_keepMyCellOnTop)
    {
        [self.tableView scrollToRowAtIndexPath:_selectedCellIndex atScrollPosition:UITableViewScrollPositionTop animated:NO];
    }
} 
```

这将防止滚动。

将代码放入`-(void) scrollViewDidEndScrollingAnimation:(UIScrollView *)scrollView` 将导致上下滚动

* * *

## 回答 #32

> 赞同：1
> 
> 时间：2011-11-23T16:25:17.613

另一种简单的方法（仅适用于一个部分）

```
//cellForRowAtIndexPath
UItextField *tf;
[cell addSubview:tf];
tf.tag = indexPath.row;
tf.delegate = self;

//textFieldDidBeginEditing:(UITextField *)text
[[self.tableView scrollToRowsAtIndexPath:[NSIndexPath indexPathForRow:text.tag in section:SECTIONINTEGER] animated:YES]; 
```

* * *

## 回答 #33

> 赞同：1
> 
> 时间：2014-01-28T18:05:48.703

我会把我的解决方案（或 QuickDialog 的）扔进帽子里。基本上等待动画到滚动。获得键盘动画 JIT 而不是幻数会很好。

```
-(void)textFieldDidBeginEditing:(UITextField *)textField
{
    if (textField == self.emailTextField) {
        NSIndexPath *indexPath = [NSIndexPath indexPathForRow:0 inSection:0];
        dispatch_time_t popTime = dispatch_time(DISPATCH_TIME_NOW, 50 * USEC_PER_SEC);
        dispatch_after(popTime, dispatch_get_main_queue(), ^(void){
            [self.tableView scrollToRowAtIndexPath:indexPath atScrollPosition:UITableViewScrollPositionTop animated:YES];
        });
    }
} 
```

* * *

## 回答 #34

> 赞同：1
> 
> 时间：2014-02-12T20:27:14.897

我经常在我的项目中使用它。此解决方案适用于滚动视图、表格视图或集合视图，并且易于设置。它还自动连接键盘上的“下一步”按钮来切换文本字段。

[在这里](http://icodetricks.wordpress.com/2014/02/12/uitextfields-and-keyboard-issues/)检查

* * *

## 回答 #35

> 赞同：1
> 
> 时间：2011-03-20T19:59:48.097

`UITableViewController`确实会自动滚动。与使用 a 相比的不同之处在于，在使用 a时，您必须使用,`UIViewController`以编程方式创建导航栏按钮项。`NavigationController``TableViewController`

* * *

## 回答 #36

> 赞同：1
> 
> 时间：2016-02-12T09:14:38.850

在视图didload

```
-(void)viewdidload{

[super viewdidload];

    [[NSNotificationCenter defaultCenter] addObserver:self selector:@selector(keyboardWillChange:) name:UIKeyboardWillChangeFrameNotification object:nil];
}

    -(void)keyboardWillChange:(NSNotification*)sender{

        NSLog(@"keyboardwillchange sender %@",sender);

float margin=0  // set your own topmargin

        CGFloat originY = [[sender.userInfo objectForKey:UIKeyboardFrameEndUserInfoKey] CGRectValue].origin.y;

        if (originY >= self.view.frame.size.height){

            NSLog(@"keyboardclose");

            [tb_ setFrame:CGRectMake(0, margin, self.view.frame.size.width, self.view.frame.size.height-margin)];

        }else{

            NSLog(@"keyobard on");

            float adjustedHeight = self.view.frame.size.height - margin - (self.view.frame.size.height-originY);

            [tb_ setFrame:CGRectMake(0, margin, self.view.frame.size.width, adjustedHeight)];
        }

    } 
```

* * *

## 回答 #37

> 赞同：1
> 
> 时间：2018-02-22T07:47:44.410

不需要任何计算，使用下面的代码就可以了：我在我的自定义 UITableviewcell 中使用的这段代码，它正在工作：

```
override func viewDidLoad() {
super.viewDidLoad()

NotificationCenter.default.addObserver(self, selector: #selector(ViewController.keyboardWillShow), name: NSNotification.Name.UIKeyboardWillShow, object: nil)

NotificationCenter.default.addObserver(self, selector: #selector(ViewController.keyboardWillHide), name: NSNotification.Name.UIKeyboardWillHide, object: nil)}

func keyboardWillShow(_ notification:Notification) {

if let keyboardSize = (notification.userInfo?[UIKeyboardFrameBeginUserInfoKey] as? NSValue)?.cgRectValue {
    tableView.contentInset = UIEdgeInsetsMake(0, 0, keyboardSize.height, 0)
}}

func keyboardWillHide(_ notification:Notification) {

if let keyboardSize = (notification.userInfo?[UIKeyboardFrameBeginUserInfoKey] as? NSValue)?.cgRectValue {
    tableView.contentInset = UIEdgeInsetsMake(0, 0, 0, 0)
}} 
```

* * *

## 回答 #38

> 赞同：0
> 
> 时间：2014-08-21T14:43:31.110

这是我的解决方案，灵感来自 iOS7 日历应用程序的“事件编辑”屏幕。

该解决方案的关键点之一是当用户滚动表格时键盘被关闭。

执行：

1）添加将存储选定文本字段的属性：

```
@property (strong) UITextField *currentTextField; 
```

和 BOOL 变量，我们将使用它来检查用户滚动表格时是否需要隐藏键盘。

```
BOOL hideKeyboardOnScroll; 
```

2）处理 UITextField 委托回调：

```
#pragma mark - UITextFieldDelegate

- (void) textFieldDidBeginEditing: (UITextField *) textField {
    self.currentTextField = textField;
}

- (void) textFieldDidEndEditing: (UITextField *) textField {
    self.currentTextField = nil;
}

- (BOOL) textFieldShouldReturn: (UITextField *) textField {
   [textField resignFirstResponder];

    CGPoint newContentOffset = CGPointZero;
    if (tableView.contentSize.height > tableView.frame.size.height) {
        newContentOffset.y = MIN(tableView.contentOffset.y, tableView.contentSize.height - tableView.frame.size.height);
    }
    [tableView setContentOffset: newContentOffset animated: YES];

    return YES;
} 
```

3) 处理 UIScrollViewDelegate 方法来检查用户滚动视图。

```
#pragma mark - UIScrollViewDelegate

- (void) scrollViewDidScroll: (UIScrollView *) scrollView {
    if (hideKeyboardOnScroll == YES) {
        [self.currentTextField resignFirstResponder];
    }
} 
```

4）在viewcontroller的[viewWillAppear]方法中订阅键盘通知，在[viewWillDisappear]方法中取消订阅。

```
- (void) viewWillAppear: (BOOL) animated {
    [super viewWillAppear: animated];

    [ [NSNotificationCenter defaultCenter] addObserver: self selector: @selector(keyboardWillShow:)
                                                  name: UIKeyboardWillShowNotification object: nil];
    [ [NSNotificationCenter defaultCenter] addObserver: self selector: @selector(keyboardWillHide:)
                                                  name: UIKeyboardWillHideNotification object: nil];
}

- (void) viewWillDisappear: (BOOL) animated {
    [super viewWillDisappear: animated];

    [ [NSNotificationCenter defaultCenter] removeObserver: self name: UIKeyboardDidShowNotification object: nil];
    [ [NSNotificationCenter defaultCenter] removeObserver: self name: UIKeyboardWillHideNotification object: nil];    
} 
```

5）处理键盘通知：

```
- (void) keyboardWillShow: (NSNotification *) notification {
    CGRect keyboardFrame = [ [ [notification userInfo] objectForKey: UIKeyboardFrameBeginUserInfoKey] CGRectValue];

    // Find cell with textfield.
    CGRect textFieldFrame = [tableView convertRect: self.currentTextField.frame fromView: self.currentTextField];
    NSIndexPath *indexPath = [tableView indexPathForRowAtPoint: textFieldFrame.origin];
    UITableViewCell *cell = [tableView cellForRowAtIndexPath: indexPath];
    //

    // Shrink tableView size.
    CGRect tableViewFrame = tableView.frame;
    tableView.frame = CGRectMake(tableView.frame.origin.x, tableView.frame.origin.y, tableView.frame.size.width,
                             self.view.frame.size.height - tableView.frame.origin.y - keyboardFrame.size.height);
    //

    // Check if cell is visible in shrinked table size.
    BOOL cellIsFullyVisible = YES;
    if ( cell.frame.origin.y < tableView.contentOffset.y ||
        (cell.frame.origin.y + cell.frame.size.height) > (tableView.contentOffset.y + tableView.frame.size.height) ) {
        cellIsFullyVisible = NO;
    }
    //

    // If cell is not fully visible when scroll table to show cell;
    if (cellIsFullyVisible == NO) {
        CGPoint contentOffset = CGPointMake(tableView.contentOffset.x, CGRectGetMaxY(cell.frame) - tableView.frame.size.height);
        if (cell.frame.origin.y < tableView.contentOffset.y) {
            contentOffset.y = cell.frame.origin.y;
        }
        contentOffset.y = MAX(0, contentOffset.y);

        // For some reason [setContentOffset] is called without delay then
        // this code may not work for some cells. That why we call it with brief delay.
        dispatch_time_t popTime = dispatch_time(DISPATCH_TIME_NOW, (int64_t)(0.1 * NSEC_PER_SEC));
        dispatch_after(popTime, dispatch_get_main_queue(), ^(void){
            [UIView animateWithDuration: 0.5 animations:^{
                [tableView setContentOffset: contentOffset animated: NO];
            } completion: ^(BOOL finished) {
                hideKeyboardOnScroll = YES;
            }];
        });
    } else {
        hideKeyboardOnScroll = YES;
    }
    //

    // Finally restore original table frame.
    tableView.frame = tableViewFrame;
    //
}

- (void) keyboardWillHide: (NSNotification *) notification {
    [super keyboardWillHide: notification];

    hideKeyboardOnScroll = NO;
} 
```

* * *

## 回答 #39

> 赞同：0
> 
> 时间：2014-06-06T15:29:10.190

我认为最好的方法是通过 UITableViewController。

**如果你想要 UIViewController 中的 UITableView**，只需使用嵌入式 UITableViewController 制作一个 ContentView 并将以下几行放入 UIViewController 的 viedDidLoad 中：

```
self.tableView = ((UITableViewController*)self.childViewControllers[0]).tableView;
self.tableView.delegate = self;
self.tableView.dataSource = self; 
```

简单的 ;）

* * *

## 回答 #40

> 赞同：0
> 
> 时间：2011-10-26T11:07:03.600

我刚刚再次查看了 iOS 5.0 lib 参考，发现这部分标题为“移动位于键盘下的内容”：[TextAndWebiPhoneOS 键盘管理](http://developer.apple.com/library/ios/#documentation/StringsTextFonts/Conceptual/TextAndWebiPhoneOS/KeyboardManagement/KeyboardManagement.html)

这是自 iOS 5 以来的新功能吗？我还没有读到它，因为我在做别的事情，但也许其他人知道的更多，可以启发我和这里的其他人。

Apple 文档是否取代了这里讨论的内容，或者这里的信息对 iOS 5 SDK 用户仍然有用？

* * *

## 回答 #41

> 赞同：0
> 
> 时间：2012-09-15T07:51:53.663

我认为没有“正确”的方法可以做到这一点。您必须为您的用例选择最合适的解决方案。在我的 iPad 应用程序中，我有`UIViewController`一个`UIModalPresentationFormSheet`以`UITableView`. 此表`UITextFields`每个单元格包含两个。仅调用`scrollToRowAtIndexPath:atScrollPosition:animated:`该`textFieldDidBeginEditing:`方法对我不起作用。因此我创建了一个`tableFooterView`：

```
- (void)viewDidLoad
{
    [super viewDidLoad];

    m_footerView = [[UIView alloc] initWithFrame:CGRectMake(0.0f, 0.0f, m_tableView.frame.size.width, 300.0f)];
    [m_footerView setBackgroundColor:[UIColor clearColor]];
    [m_tableView setTableFooterView:m_footerView];
    [m_footerView release];
} 
```

这个想法是键盘隐藏`tableFooterView`而不是`UITextFields`。所以`tableFooterView`一定要够高。之后，您可以`scrollToRowAtIndexPath:atScrollPosition:animated:`在`textFieldDidBeginEditing:`方法中使用。

我认为也可以`tableFooterView`通过添加键盘通知的观察者来动态显示和隐藏，但我还没有尝试过：

```
- (void)viewWillAppear:(BOOL)animated
{
    [super viewWillAppear:animated];

    [[NSNotificationCenter defaultCenter] addObserver:self 
                                             selector:@selector(keyboardWillShow:) 
                                                 name:UIKeyboardWillShowNotification 
                                               object:nil];
    [[NSNotificationCenter defaultCenter] addObserver:self 
                                             selector:@selector(keyboardWillHide:) 
                                                 name:UIKeyboardWillHideNotification 
                                               object:nil];
}

- (void)keyboardWillShow:(NSNotification *)notification 
{
     [m_tableView setTableFooterView:m_footerView];
}

- (void)keyboardWillHide:(NSNotification *)notification 
{
     [m_tableView setTableFooterView:nil];
}

- (void)viewWillDisappear:(BOOL)animated
{
    [super viewWillDisappear:animated];

    [[NSNotificationCenter defaultCenter] removeObserver:self name:UIKeyboardWillShowNotification object:nil];
    [[NSNotificationCenter defaultCenter] removeObserver:self name:UIKeyboardWillHideNotification object:nil];
} 
```

* * *

## 回答 #42

> 赞同：0
> 
> 时间：2019-07-03T18:30:36.553

我刚刚在使用 UITableViewController 时发现了另一个错误。键盘出现时它没有自动滚动。我注意到这是因为 UITableView 上的 contentInsetAdjustmentBehavior = .never。

* * *

## 回答 #43

> 赞同：0
> 
> 时间：2018-06-10T15:48:38.613

**Swift 3-4 的动画和键盘帧改变的解决方案：**

首先，创建一个 Bool：

```
// MARK: - Private Properties
private var isKeyboardShowing = false 
```

其次，将观察者添加到系统键盘通知中：

```
// MARK: - Overriding ViewController Life Cycle Methods
override func viewWillAppear(_ animated: Bool) {
    super.viewWillAppear(animated)

    NotificationCenter.default.addObserver(self, selector: #selector(keyboardWillShow), name: .UIKeyboardWillShow, object: nil)

    NotificationCenter.default.addObserver(self, selector: #selector(keyboardWillHide), name: .UIKeyboardWillHide, object: nil)

    NotificationCenter.default.addObserver(self, selector: #selector(keyboardWillChangeFrame), name: .UIKeyboardWillChangeFrame, object: nil)
} 
```

三、准备动画函数：

```
func adjustTableViewInsets(keyboardHeight: CGFloat, duration: NSNumber, curve: NSNumber){
    var extraHeight: CGFloat = 0
    if keyboardHeight > 0 {
        extraHeight = 20
        isKeyboardShowing = true
    } else {
        isKeyboardShowing = false
    }

    let contentInset = UIEdgeInsets(top: 0, left: 0, bottom: keyboardHeight + extraHeight, right: 0)
    func animateFunc() {
        //refresh constraints
        //self.view.layoutSubviews()
        tableView.contentInset = contentInset
    }

    UIView.animate(withDuration: TimeInterval(duration), delay: 0, options: [UIViewAnimationOptions(rawValue: UInt(curve))], animations: animateFunc, completion: nil)
} 
```

然后添加目标/动作方法（由观察者调用）：

```
// MARK: - Target/Selector Actions
func keyboardWillShow(notification: NSNotification) {
    if !isKeyboardShowing {
        if let keyboardSize = (notification.userInfo?[UIKeyboardFrameBeginUserInfoKey] as? NSValue)?.cgRectValue {
            let keyboardHeight = keyboardSize.height

            let duration = notification.userInfo?[UIKeyboardAnimationDurationUserInfoKey] as! NSNumber
            let curve = notification.userInfo?[UIKeyboardAnimationCurveUserInfoKey] as! NSNumber

            adjustTableViewInsets(keyboardHeight: keyboardHeight, duration: duration, curve: curve)
        }
    }
}

func keyboardWillHide(notification: NSNotification) {
    let duration = notification.userInfo?[UIKeyboardAnimationDurationUserInfoKey] as! NSNumber
    let curve = notification.userInfo?[UIKeyboardAnimationCurveUserInfoKey] as! NSNumber
    adjustTableViewInsets(keyboardHeight: 0, duration: duration, curve: curve)
}

func keyboardWillChangeFrame(notification: NSNotification) {
    if isKeyboardShowing {
        let duration = notification.userInfo?[UIKeyboardAnimationDurationUserInfoKey] as! NSNumber
        let curve = notification.userInfo?[UIKeyboardAnimationCurveUserInfoKey] as! NSNumber

        if let newKeyboardSize = (notification.userInfo?[UIKeyboardFrameEndUserInfoKey] as? NSValue)?.cgRectValue {
            let keyboardHeight = newKeyboardSize.height
            adjustTableViewInsets(keyboardHeight: keyboardHeight, duration: duration, curve: curve)
        }
    }
} 
```

最后，不要忘记在 deinit 或 viewWillDisappear 中移除观察者：

```
deinit {
    NotificationCenter.default.removeObserver(self)
} 
```

* * *

## 回答 #44

> 赞同：0
> 
> 时间：2016-07-02T20:32:54.787

看看我的版本:)

```
 - (void)keyboardWasShown:(NSNotification *)aNotification
{
    NSDictionary* info = [aNotification userInfo];
    CGSize kbSize = [[info objectForKey:UIKeyboardFrameBeginUserInfoKey] CGRectValue].size;
    CGRect bkgndRect = cellSelected.superview.frame;
    bkgndRect.size.height += kbSize.height;
    [cellSelected.superview setFrame:bkgndRect];
    [tableView setContentOffset:CGPointMake(0.0, cellSelected.frame.origin.y-kbSize.height) animated:YES];
}

- (void)keyboardWasHidden:(NSNotification *)aNotification
{
    [tableView setContentOffset:CGPointMake(0.0, 0.0) animated:YES];
} 
```

* * *

## 回答 #45

> 赞同：0
> 
> 时间：2017-06-27T21:12:09.477

```
// scroll tableview so content ends at the middle of the tableview (out of the way of the keyboard)
CGPoint newContentOffset = CGPointMake(0, [self.tableView contentSize].height - (self.tableView.bounds.size.height / 2));
[self.tableView setContentOffset:newContentOffset animated:YES]; 
```

# nhibernate - 保存孩子时的nHibernate继承问题

> ID：594187
> 
> 赞同：1
> 
> 时间：2009-02-27T10:09:19.677
> 
> 标签：nhibernate

我有一个问题：我有用户：

```
[Class(Table = "Users", Name = "User")]
public class User
{
    [Id(0, Column = "UserId", Type = "Guid", Name = "Id")]
    [Generator(1, Class = "assigned")]
    public Guid Id { get; set; }

    [Property(Name = "Password", Column = "Password", Type = "String")]
    public string Password { get; set; }

    [Property(Name = "Email", Column = "Email", Type = "String")]
    public string Email { get; set; }
} 
```

和分销商：

```
 [JoinedSubclass(ExtendsType = typeof(User), Table = "Distributors")]
public class Distributor : User
{

    [Id(0, Column = "DistributorId", Type = "Guid", Name = "Identifier")]
    [Generator(1, Class = "assigned")]
    protected Guid Identifier { get; set; }

    [Property(Name = "Company", Column = "Company", Type = "String")]
    public String Company { get; set; }
} 
```

现在我需要将用户提升为经销商。但我需要保存他的 id（系统的其他部分正在使用它）。我正在获取用户并创建新的分销商。但是当我试图保存经销商时，我收到了这个错误：

具有相同标识符值的不同对象已与会话关联：ec6f6a9f-a236-4385-835c-7f408a5f594d，实体：MLMCore.Entities.Distributor

我已经尝试了所有方法（保存、SaveOrUpdade、SaveOrUpdateCopy、Update）。但它不起作用。任何想法如何解决它？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-27T11:19:30.427

错误就是它所说的 - 您的会话包含`User`具有该 Id 的实例，因此当您尝试使用该 Id 保存另一个`User`(a `Distributor`) 时，NHibernate 会抱怨。您*可以*在保存 之前尝试清除会话 ( `session.Clear()`) `Distributor`，但我不知道 NHibernate 是否会突然成功保存到`User` *and*表中。`Distributor`

如果你有能力改变你的设计，我建议你这样做——一般来说，当你的专业化类型可能改变时，你不应该使用继承。`Role`在您的域中引入某种类型会更好、更方便。

也许我可以给你一些启发，即使我不知道你的域的细节：让用户只是那个 - `User`. 然后，`User`是否可以 container an`IList<Role>`并且您可以专注`Role`于 eg `Distributor`（以及其他相关的角色）？

或者让你的公司包含一个`IList<Distributor>`，每个都指向一个`User`如何？

# c# - 来自 .NET 的 Windows Mobile API 调用 - 什么是 dll，什么是枚举值

> ID：594189
> 
> 赞同：1
> 
> 时间：2009-02-27T10:10:12.590
> 
> 标签：c#, .net, winapi, windows-mobile

我是 .NET 中 API 调用的新手。

我正在查看要在[此处调用的方法的文档](http://msdn.microsoft.com/en-us/library/aa932387.aspx)

编辑该方法是一个 Windows Mobile API 调用。

要调用它，我需要知道它在什么 dll 中以及任何参数标志的值是什么（以及其他东西，但这只是一个示例）。

那么我在哪里可以找到这个呢？它不在页面上。它告诉我头文件和标志值的名称，但这对我没有帮助。搜索 MSDN 会返回对 Windows API 方法的引用，而不是 Windows Mobile API 方法。

当然，我可以猜到它在 coredll.dll 中。我可以用谷歌搜索别人写的代码，看看他们是怎么做的。我实际上已经这样做了，它确实在 coredll.dll 中。

我无法猜测标志值。所以我被困在那里，除非我能找到其他人的代码可能正确也可能不正确。

所以我的问题是：包含的 dll 和标志值肯定是关键信息吗？所以我应该能够在 MSDN 的某个地方找到这个信息？

如果我正在查看有关 FCL 类的页面，它会告诉我该类在哪个 dll 中定义、命名空间以及我需要能够使用它的大量其他信息和链接。

该信息必须存在，因为我在网上看不到任何其他类似的问题？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-27T10:13:47.230

您应该查看[PInvoke](http://www.pinvoke.net)，它将详细介绍大多数 WinAPI 调用。

可以在[此处](http://pinvoke.net/default.aspx/Enums/SHOWWINDOW_FLAGS.html)找到您要查找的特定标志。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-27T10:29:32.077

好吧，正式地这是“**非托管 dll 的校准**”或编组**使用的****PInvoke**（平台调用），如前所述，最完整的库 PInvoke 是[http://www.pinvoke.net/ 。](http://www.pinvoke.net/) 我推荐使用[**Winspector**](http://www.windows-spy.com/) 工具来了解 Windows 中使用的低级消息。 **[](http://www.windows-spy.com/)**

 ****# synchronization - 经典企业应用程序中的“同步”关键字是否可疑？

> ID：594190
> 
> 赞同：4
> 
> 时间：2009-02-27T10:10:14.680
> 
> 标签：synchronization, legacy, anti-patterns, legacy-code

我说的是经典的企业应用程序。通常托管在某种应用程序服务器或容器中。没什么花哨的，只是实体、服务、演示/UI 和关系存储。

每当我`synchronized`在这样的应用程序中看到关键字（在方法或块上）时，我都会非常怀疑。在我看来，这要么是不了解基本架构概念的标志（例如，域模型未在多个客户端之间共享），要么是更糟糕的标志，表明架构实际上非常拙劣。

你在这里分享我的想法吗？还是我完全偏离了轨道？您是否有在经典企业应用程序中实际需要同步的用例？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-27T10:27:54.950

我同意你的业务逻辑代码，但在企业应用程序中你也有技术代码，有时你需要一些同步来共享“技术”状态。可以为此使用 synchronized 关键字。（您也可以中继原子变量，或使用应用程序之外的东西，如数据库序列来共享技术状态......）

如果您想创建连续的账单编号 - 序列中没有漏洞 - 您需要一种共享某些状态的方法，以及一种同步的方法......

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-09-27T12:33:29.047

我同意你的看法。

我认为同步在设计线程安全组件时很重要，但在“业务逻辑”代码中通常不需要。

通过引入共享状态，您可以提高性能，但会降低应用程序未来的可伸缩性。

如果需要并发设计，则可以对应用程序开发人员透明地处理它，例如使用应用程序服务器。

# xelement - 删除 XElement 中的 xmlns

> ID：594197
> 
> 赞同：2
> 
> 时间：2009-02-27T10:15:32.030
> 
> 标签：xelement

我正在解析 XElement.Parse("somestring") 中的 XML 字符串，并使用 add 方法将其插入到另一个 XElement 中。所以，我想从“somestring”文本中删除默认的 utf 编码和 xmlns 属性。

怎么做...

我感谢您的帮助。

谢谢KJ

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-27T10:37:21.323

听起来您有一个包含`<?xml`声明的 XML 文档。使用`XDocument`代替来解析： -

```
XDocument doc = XDocument.Parse(someString);
existingElem.Add(doc.Root); 
```

至于 xmlns 试试上面的，看看你得到什么，我认为你不需要担心。如果您现有的文档使用与您包含的 XML 不同的默认命名空间，这可能只是一个问题。

# .net - 是否可以知道 .NET Framework 是否是从 .NET 应用程序安装的？

> ID：594205
> 
> 赞同：2
> 
> 时间：2009-02-27T10:22:02.670
> 
> 标签：.net, installation

事情就是这样。当我尝试在未安装 .NET 框架的机器上运行时，我的 .NET 应用程序崩溃并出现一个非常难看的一般异常错误。

这是正常的吗？如果是......有没有办法检查.NET框架是否能够优雅地退出？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-27T10:25:42.320

您无法使用**托管**代码检查 .NET 框架的版本号，因为它在加载 .NET 运行时之前无法执行。您可以使用 CLR 非托管 API 来执行此操作，但解决此问题的最佳方法是提供一种安装机制，如果计算机上未安装 .NET Framework，则检查、下载和安装它。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-27T10:25:33.567

您可以在非托管代码中编写存根来执行此操作，但前提条件通常是您创建安装应用程序的原因。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-27T10:26:05.907

查看 .NET Framework 客户端配置文件 ( [http://msdn.microsoft.com/en-us/library/cc656912.aspx](http://msdn.microsoft.com/en-us/library/cc656912.aspx) )：

> .NET Framework 客户端配置文件提供了可用于客户端应用程序的通用引导程序设置。这确保安装了运行应用程序的所有要求，无论存在哪个版本的 .NET Framework（如果有）。安装体验提供一致的用户界面 (UI) 和无缝安装，无论目标操作系统是 Windows XP 还是 Windows Vista。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-27T10:25:01.213

我想你必须在安装程序脚本中进行检查。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-27T10:29:01.017

如果它打包在安装程序中，您可以设置安装条件以检查 .NET 和框架版本。

检查框架的另一种方法是：

```
System.Runtime.InteropServices.RuntimeEnvironment.GetRuntimeDirectory;
System.Runtime.InteropServices.RuntimeEnvironment.GetSystemVersion; 
```

来自 O'Reilly 食谱。

但是这两者都被这样一个事实打败了，即必须在代码开始检查之前安装 .NET。

# winapi - 监控windows进程

> ID：594207
> 
> 赞同：0
> 
> 时间：2009-02-27T10:23:17.177
> 
> 标签：winapi, visual-c++, process, hook, monitor

如果特定进程开始，我想收到通知。例如，如果 xyz.exe 在后台启动，我需要一个消息框来说明相同的内容。

我对 VC++ 中的 Windows Hooks 有点熟悉。有人可以指出一些类似的链接或方法来实现我的目标吗？谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-27T10:44:09.857

检查这个问题的答案：[How to monitor process/program execution in windows?](https://stackoverflow.com/questions/510372/how-to-monitor-process-program-execution-in-windows)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-27T11:11:40.290

这是一个 Win32 常见问题解答（请参阅[Win32 api 组](http://news://nntp.aioe.org/comp.os.ms-windows.programmer.win32)的官方方法（Microsoft））

# .net - 如何使用循环从 100 个文本框中检索值

> ID：594208
> 
> 赞同：2
> 
> 时间：2009-02-27T10:23:29.703
> 
> 标签：.net, asp.net

朋友们，

我有一个包含 100 个或更多文本框（HTML 或 ASP.NET）的网格，每个文本框都将包含一个固定长度的文本值，需要将所有这些都传递回后端表单以大规模更新数据库。

我可以通过简单地浏览后面代码中的每个控件 .text 属性来做到这一点。

然而，这使得代码变得又大又丑。

我想知道是否有任何理由使用一些受控循环结构来遍历每个控件并检索数据

IE

```
Private List<string> getdata()
{
  Private List<String> MyList = new List<string>();
    foreach (Textbox)control txbControl in ....// don't know what this will be
     {
       MyList.Add(txbControl.text);
     }
} 
```

请注意，所有这些文本框在页面上都有唯一的 ID 标签，即

```
<tablr>
<tbody>
<tr>
<td>
<asp:TextBox ID="TxB_Customize1" runat="server"></asp:TextBox>
<td/>
<td>
<asp:TextBox ID="TxB_Customize2" runat="server"></asp:TextBox>
<td/>
<td>
<asp:TextBox ID="TxB_Customize3" runat="server"></asp:TextBox> 
```

…………

抱歉忘了提及这一点，文本框按列分组，给定列中的每个文本框共享相似的名称，即给定实例中的“Txb_Customize”。

因此，在检索值时，我还需要知道它的来源（可能是文本框 ID）。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-27T10:28:56.790

看[`Control.Controls`](http://msdn.microsoft.com/en-us/library/system.web.ui.control.controls.aspx)楼盘。

你会想要这样的东西：

```
foreach (Control control in Controls)
{
    TextBox textBox = control as TextBox;
    // Ignore non-textboxes
    if (textBox != null)
    {
        list.Add(textBox.Text);
    }
} 
```

如果您使用的是 .NET 3.5，则可以使用 LINQ 以更简单的方式执行此操作：

```
return Controls.OfType<TextBox>()
               .Select(textBox => textBox.Text)
               .ToList(); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-27T10:35:14.183

您可以在 javascript 中执行此操作 - 给它们一个类名并将它们全部放入一个集合中并循环通过该集合，然后使用 ajax 简单地发布值。JQuery 在这里可以非常方便 -

$(".yourclassname").each(function(index){ $(this).val() //这将是你的文本框的值 })

您可以创建一个大字符串并在服务器端解析，或者您可以构建一个名称值数组，然后使用它来代替

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-27T14:10:53.527

或者您可以执行以下操作：

```
int index = 1;
while ( ( TextBox tb
  = FindControl (
      string.Concat ( "TxB_Customize", index.ToString ( ) ) as TextBox != null )
{
  MyList.Add ( tb.Text );
  index++;
} 
```

如果您实际上还有其他一些文本框，这可能会很好，这些文本框不属于该数据数组的一部分。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-27T10:28:29.880

您可以遍历容器的控件（使用 MyContainer.Controls），如果您拥有的所有内容都是文本框，那将很容易，否则您可能需要这样做：

```
foreach (Control myBox in MyContainer.Controls)
{
    TextBox myBox = Control As TextBox
    if (myBox != null)
        // Do Stuff
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-27T14:03:34.153

当代码的逻辑与文本框的名称有关时，我看到的唯一解决方案是从头开始重写这段代码，然后给写了这个废话的程序员买一些好的设计书籍。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-27T17:56:29.287

如果您不想依赖服务器控件，可以使用 Request.Form 集合。

但是，您需要使用控件 id 来判断它是否是文本框，使用问题的 id：

```
Request.Form.AllKeys.Where(n => n.StartsWith("TxB_Customize"))
                    .Select(n => new[] { n, Request.Form[n] }); 
```

它返回 {Id,Value} 对的集合。

# regex - 在 Eclipse 查找/替换字段中，我可以更改正则表达式匹配的结果 $1 吗？

> ID：594215
> 
> 赞同：3
> 
> 时间：2009-02-27T10:27:12.020
> 
> 标签：regex, eclipse, eclipse-3.4

我想搜索和替换*0-9*范围内的许多数字并给它们加一个，所以它们变成了*1-10*范围内。

例如： *0 3 5*

将变为： *1 4 6*

在 Eclipse 查找/替换窗口中，我可以用 ^([0-9]+)$ 匹配一个数字

在替换字段中，我可以以某种方式添加到匹配的数字 $1 吗？

/G

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-27T10:28:52.327

不，没有办法指定回调函数/宏，这是您以这种方式更改第一组 ($1) 或任何结果所需要的。

也许有一个插件可以实现这一点，但我目前不知道有一个。

作为一种变通方法，您也许可以为此使用[jEdit](http://www.jedit.org/)，它确实允许您将脚本应用于您的结果（尽管我自己还没有尝试过，所以不确定它的效果如何）。

# image - 水晶报表添加到图片字段的图片数据如何去除？

> ID：594229
> 
> 赞同：1
> 
> 时间：2009-02-27T10:30:11.247
> 
> 标签：image, crystal-reports

我们有许多带有图片字段的 Crystal Reports (8,11) 文件。图像数据来自临时数据库中的 BLOB 字段。

问题：Crystal Reports 设计器正在显示图像，该图像在插入字段时位于数据库中，并且图片数据似乎保存在 .rpt 文件中。这会导致巨大的 .rpt 文件（大约 1-5 MB，与没有图片字段的 20-80 KB 相比），因此加载时间很长。

有什么方法可以在不删除和重新插入图片字段的情况下剥离图像数据？（这次当然是空数据库）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-13T18:50:52.443

我不肯定，但我认为它保留了初始图片，因此它可以记住尺寸。您是否注意到所有图片都重新调整大小以匹配初始图像？这很烦人。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-19T17:53:53.843

如果图像来自数据库，如果您在文件菜单中选中了“使用报告保存数据”，它可能会保存到 .rpt。

# c# - 等待两个线程完成

> ID：594230
> 
> 赞同：3
> 
> 时间：2009-02-27T10:30:27.067
> 
> 标签：c#, multithreading

如果您有一个主线程启动另外两个线程。让主线程等待其他两个线程的最干净的方法是什么？

我可以使用 bgndworker 和 sleep spinner 来检查 bgnd worker 的 IsBusy，但我认为有更好的方法。

**编辑** 更多要求：

*   主线程还有一些其他工作要做（例如 GUI）。
*   两个衍生的线程应该能够报告异常并返回结果值

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-02-27T10:34:35.027

使用 Thread.Join() 的快速示例；

```
 Thread t1 = new Thread(new ThreadStart(delegate()
        {
            System.Threading.Thread.Sleep(2000);
        }));

        Thread t2 = new Thread(new ThreadStart(delegate()
        {
            System.Threading.Thread.Sleep(4000);
        }));

        t1.Start();
        t2.Start();

        t1.Join();
        t2.Join(); 
```

**编辑另一个使用等待句柄的 3example：**

```
 ManualResetEvent[] waitHandles = new ManualResetEvent[]{
            new ManualResetEvent(false),
            new ManualResetEvent(false)
        };

        Thread t1 = new Thread(new ParameterizedThreadStart(delegate(object state)
        {
            ManualResetEvent handle = (ManualResetEvent)state;
            System.Threading.Thread.Sleep(2000);
            handle.Set();
        }));

        Thread t2 = new Thread(new ParameterizedThreadStart(delegate(object state)
        {
            ManualResetEvent handle = (ManualResetEvent)state;
            System.Threading.Thread.Sleep(4000);
            handle.Set();
        }));

        t1.Start(waitHandles[0]);
        t2.Start(waitHandles[1]);

        WaitHandle.WaitAll(waitHandles);

        Console.WriteLine("Finished"); 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-27T12:56:53.673

请参阅[此线程](https://stackoverflow.com/questions/540078/wait-for-pooled-threads-to-complete)上的答案。我喜欢[这个选项](https://stackoverflow.com/questions/540078/wait-for-pooled-threads-to-complete/540380#540380)；-p

```
Forker p = new Forker();
p.Fork(delegate { DoSomeWork(); });
p.Fork(delegate { DoSomeOtherWork(); });
p.Join(); 
```

重新返回值/报告异常 - 只需让每个分支在逻辑结束时将其作为回调......（您可以使用捕获的变量将状态传递给两个分支，包括共享记录器等）。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-27T10:34:14.093

```
thread1.Join();
thread2.Join(); 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-27T10:37:52.633

除了其他答案...“启动两个线程并等待两个线程完成”的另一种选择是“启动*一个*线程并自己完成一项工作，然后等待另一个线程完成”。

当然，如果你想开始两个工作，在主线程上多做一些工作，*然后*等待另外两个线程完成，那就不太好用了。

编辑：如果主线程是一个 UI 线程，你不应该阻塞其他线程完成 - 你应该（IMO）让他们在完成后回调主线程。这样，在它们执行时，您仍将拥有响应式 UI。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-27T13:01:15.097

您不能等待完成并让 GUI 可用。最好的方法是产生线程并使用事件与 GUI 通信。请记住，在事件处理程序中您不能修改控制。与其直接做，不如使用 Invoke 方法。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-27T10:33:22.003

WaitHandle.WaitAny 是你的朋友。它使您可以等待多个线程或其他类型的对象发出信号。

[http://msdn.microsoft.com/en-us/library/tdykks7z.aspx](http://msdn.microsoft.com/en-us/library/tdykks7z.aspx)

编辑：

实际上，WaitHandle.WaitAll 是您想要的，而不是 WaitAny。

[http://msdn.microsoft.com/en-us/library/system.threading.waithandle.waitall.aspx](http://msdn.microsoft.com/en-us/library/system.threading.waithandle.waitall.aspx)

编辑：

一些提及的 Join 方法是可以的，但一个缺点是它不是一个完全原子操作。不过，这对您可能很重要，也可能不重要。

# c# - 如何使用 LINQ-to-XML 选择特定节点

> ID：594231
> 
> 赞同：50
> 
> 时间：2009-02-27T10:31:24.117
> 
> 标签：c#, linq-to-xml

我可以选择第一个客户节点并使用下面的代码更改其公司名称。

但是如何选择 ID=2 的客户节点呢？

```
 XDocument xmldoc = new XDocument(
        new XDeclaration("1.0", "utf-8", "yes"),
        new XComment("These are all the customers transfered from the database."),
        new XElement("Customers",
            new XElement("Customer",
                new XAttribute("ID", 1),
                new XElement("FullName", "Jim Tester"),
                new XElement("Title", "Developer"),
                new XElement("Company", "Apple Inc.")
                ),
            new XElement("Customer",
                new XAttribute("ID", 2),
                new XElement("FullName", "John Testly"),
                new XElement("Title", "Tester"),
                new XElement("Company", "Google")
                )
            )
        );

    XElement elementToChange = xmldoc.Element("Customers").Element("Customer").Element("Company");
    elementToChange.ReplaceWith(new XElement("Company", "new company value...")); 
```

## 回答：

谢谢大家，记录一下，这是在 customer-with-id-2 元素中搜索 company 元素的确切语法，然后仅更改 company 元素的值：

```
XElement elementToChange = xmldoc.Element("Customers")
    .Elements("Customer")
    .Single(x => (int)x.Attribute("ID") == 2)
    .Element("Company");
elementToChange.ReplaceWith(
    new XElement("Company", "new company value...")
    ); 
```

## 用方法语法回答：

刚刚在方法语法中也弄清楚了：

```
XElement elementToChange = (from c in xmldoc.Element("Customers")
                                .Elements("Customer")
                            where (int)c.Attribute("ID") == 3
                            select c).Single().Element("Company"); 
```

* * *

## 回答 #1

> 赞同：48
> 
> 时间：2009-02-27T10:34:24.670

假设 ID 是唯一的：

```
var result = xmldoc.Element("Customers")
                   .Elements("Customer")
                   .Single(x => (int?)x.Attribute("ID") == 2); 
```

对于不同的情况，您也可以使用`First`,或, 代替。`FirstOrDefault``SingleOrDefault``Where``Single`

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-27T10:37:26.253

我会使用类似的东西：

```
dim customer = (from c in xmldoc...<Customer> 
                where c.<ID>.Value=22 
                select c).SingleOrDefault 
```

编辑：

错过了 c# 标签，对不起......示例在 VB.NET 中

# apache-flex - Flex 引用 SWC 文件中的图像

> ID：594237
> 
> 赞同：0
> 
> 时间：2009-02-27T10:33:02.130
> 
> 标签：apache-flex, flex3

如何在 Flex 中引用已包含在 SWC 文件中的图像？

* * *

## 回答 #1

> 赞同：-1
> 
> 时间：2009-02-27T11:17:25.283

Use the `Embed` metadata tag. Something like:

```
source="@Embed(source='relativeOrAbsolutePath')" 
```

The syntax for embedding resources is given [here](http://livedocs.adobe.com/flex/3/html/help.html?content=embed_3.html):

> The syntax that you use for embedding assets depends on where in your application you >embed the asset. Flex supports the following syntaxes:

```
* [Embed(parameter1, paramater2, ...)] metadata tag

  You use this syntax to embed an asset in an ActionScript file, or in an <mx:Script> block in an MXML file. For more information, see Using the [Embed] metadata tag.
* @Embed(parameter1, paramater2, ...) directive

  You use this syntax in an MXML tag definition to embed an asset. For more information, see Using the @Embed() directive in MXML.
* Embed(parameter1, paramater2, ...) directive

  You use this syntax in an <mx:Style> block in an MXML file to embed an asset. For more information, see Embedding assets in style sheets. 
```

All three varieties of the embed syntax let you access the same assets; the only difference is where you use them in your application.

Read the [section](http://livedocs.adobe.com/flex/3/html/help.html?content=projects_5.html) on loading resources from the documentation. Also, [Embedded Asset Classes](http://livedocs.adobe.com/flex/3/html/help.html?content=04_OO_Programming_09.html).

# vb.net - 如何以编程方式添加/删除引用？

> ID：594239
> 
> 赞同：8
> 
> 时间：2009-02-27T10:33:29.570
> 
> 标签：vb.net, ms-access

我的应用程序是为 VB.NET 中的扫描 MS Access 数据库而构建的。

当 Access 应用程序分发给最终用户时，他们可能有不同版本的 COM 组件。是否可以以编程方式添加/删除引用以解决由于版本不同而导致的损坏引用？

请分享我的代码或链接以供参考。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-02-27T12:05:15.637

这是一些示例代码：

**从文件创建参考**

```
 Sub AddWS()
  'Create a reference to Windows Script Host, '
  'where you will find FileSystemObject ' 
  'Reference name: "IWshRuntimeLibrary" '
  'Reference Name in references list: "Windows Script Host Object Model" '
  ReferenceFromFile "C:\WINDOWS\System32\wshom.ocx"
  End Sub

  Function ReferenceFromFile(strFileName As String) As Boolean
  Dim ref As Reference

         On Error GoTo Error_ReferenceFromFile
         References.AddFromFile (strFileName)
         ReferenceFromFile = True

  Exit_ReferenceFromFile:
         Exit Function

   Error_ReferenceFromFile:
         ReferenceFromFile = False
         Resume Exit_ReferenceFromFile
   End Function 
```

**删除参考**

```
 Sub DeleteRef(RefName)
  Dim ref As Reference

      'You need a reference to remove '
      Set ref = References(RefName)
      References.Remove ref

  End Sub 

You can use the references collection to find if a reference exists. 
```

**参考存在**

```
 Function RefExists(RefName)
  Dim ref As Object

     RefExists = False

     For Each ref In References
         If ref.Name = RefName Then
             RefExists = True
         End If
     Next

  End Function 
```

来自：[http ://wiki.lessthandot.com/index.php/Add,_Remove,_Check_References](http://wiki.lessthandot.com/index.php/Add,_Remove,_Check_References)

**您可能还希望阅读** [http://www.mvps.org/access/modules/mdl0022.htm](http://www.mvps.org/access/modules/mdl0022.htm)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-27T22:29:32.673

最好的解决方案是将 Access MDB 中的引用限制为内部 Access 组件。这将是 Access 引用、VBA 引用和 DAO 引用。所有其他外部库都应通过后期绑定使用。例如，如果您使用的是文件系统对象，而不是这个（参考 Windows 脚本宿主对象模型）：

```
 Dim objFSO As New FileSystemObject

  If objFSO.FolderExists("\\d9m09521\WB\") Then
    ...
  End If 
```

您将删除引用并将其转换为：

```
 Dim objFSO As Object

  Set objFSO = CreateObject("Scripting.FileSystemObject")
  If objFSO.FolderExists("\\d9m09521\WB\") Then
    ...
  End If 
```

如果您担心每次使用 FSO 都会对性能造成影响，您可以缓存对它的引用。我通常在函数中使用静态变量来返回这样的对象：

```
Public Function FSO() As Object
  Static objFSO As Object

  If objFSO Is Nothing Then
     Set objFSO = CreateObject("Scripting.FileSystemObject")
  End If
  FSO = objFSO
End Function 
```

现在，您可能想要花哨并且还能够拆除实例化的对象，在这种情况下，您将执行以下操作：

```
Public Function FSO(Optional bolCloseObject As Boolean = False) As Object
  Static objFSO As Object

  If bolCloseObject Then
     Set objFSO = Nothing
     Exit Function
  End If
  If objFSO Is Nothing Then
     Set objFSO = CreateObject("Scripting.FileSystemObject")
  End If
  FSO = objFSO
End Function 
```

无论如何，关键在于后期绑定会在运行时解析外部库的位置，因此不会中断，除非外部库未安装或未正确注册。使用后期绑定，您可以捕获这两种情况，但使用早期绑定，您的整个 Access 应用程序就会中断。

# objective-c - Objective-C 类中的关系

> ID：594241
> 
> 赞同：0
> 
> 时间：2009-02-27T10:33:55.980
> 
> 标签：objective-c

我真的很犹豫要不要问这个问题，因为它肯定有一个非常简单的答案，但我就是想不通。开始：

我在一个名为的文件中有这个 Objective-C 代码`Copier.h`：

```
#import <Cocoa/Cocoa.h>
#import "CopyQueue.h";

@interface Copier : NSObject {
    IBOutlet NSTextField *statusField;
    IBOutlet NSTextField *toField;
    CopyQueue *queue;
}
- (IBAction)startCopy:(id)sender;
- (void)dropFile:(NSString *)theFileName;
@end 
```

每当我尝试在 Xcode 中编译我的项目时，我都会在它说`CopyQueue *queue;`我在做什么错的那一行中得到一个语法错误。

当我将行更改为时文件编译`id *queue;`，但这不是解决方案，可以吗？用通用引用替换所有类型引用？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-27T10:41:17.383

尝试...

```
@class CopyQueue  

@interface {
     ...
}

...

@end 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-27T14:02:52.563

不需要预先声明 CopyQueue（David McGraw 发布的“@class CopyQueue”），因为张贴者已经写了“#import "CopyQueue.h";”这一行。也许是不必要的“；” "#import "CopyQueue" 之后会导致问题吗？

无论如何，请确保在 CopyQueue.h 文件中正确声明了 CopyQueue（具有相同的拼写和大小写）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-27T17:56:57.227

这根本不是一个愚蠢的问题。它反映了使用静态类型的编译语言（如 C）（以及作为 C 超集的 Objective-C）的更复杂的方面之一。对于来自动态类型语言（如 Python、Ruby、PHP 等）的人来说，这可能是一个稍微颠簸的过渡。

在使用类型（在 C、Objective-C 或 C++ 中）之前，您必须声明该类型。CopyQueue 是一种类型，因此必须声明（使用`@interface CopyQueue : SomeClass {} @end`或隐式声明 using `@class CopyQueue`。在您发布的示例中，Cocoa 程序员会假设 CopyQueue.h 包含类似这样的内容

```
@interface CopyQueue : SuperClass { //where SuperClass is the name of the class that CopyQueue inherits from

  ...
  }
...
@end 
```

如果不是这种情况（您对 Lyndsey Ferguson 的评论表明它不是），您必须包含定义 CopyQueue 类类型的头文件（如上），或者告诉编译器 CopyQueue 是一个类（使用`@class CopyQueue`）。

该`@class CopyQueue`声明是一种告诉编译器它可以将`CopyQueue*`其视为指向 Objective-C 类（类型 id）的指针并且您将通过`@interface`稍后（例如就像在一个单独的模块中一样）。

# tfs - 为自动化测试设置 TFS 2008

> ID：594250
> 
> 赞同：1
> 
> 时间：2009-02-27T10:36:19.797
> 
> 标签：tfs, msbuild, installation, automated-tests, mstest

我很困惑。

我在我的开发服务器上安装了 TFS，它也兼作构建机器。当我签入代码时，构建工作正常，但是当构建尝试运行测试时，我得到一个错误：

MSBUILD：警告 MSB6004：指定的任务可执行位置“C:\Program Files\Microsoft Visual Studio 9.0\Common7\IDE\MSTest.exe”无效。先前的错误已转换为警告，因为该任务是使用 ContinueOnError=true 调用的。继续构建，因为任务“TestToolsTask”上的“ContinueOnError”设置为“true”。完成执行任务“TestToolsTask”——失败。

我搜索了各种论坛，有几个人建议必须在构建服务器上安装 Visual Studio 2008 测试版。谁能确认这是真的，更重要的是它是否会解决我的问题？还是只能安装专业版？

谢谢，迷茫。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-27T19:15:19.363

是的 - 您需要 VSTS 2008 的开发版或测试版（或安装的团队套件版）。这是为了将能够将单元测试结果发布回 TFS 的 MSTest.exe 版本安装在构建服务器上。

只要签入东西的人对他们签入的工件具有适当版本的 Visual Studio Team System 的许可，那么您就可以在构建服务器 AFAIK 上构建它的许可条款。（虽然我只有物理学学位，所以我在弄清楚微软许可条款方面的资格严重不足:-)）

希望有帮助，

马丁。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-27T14:30:22.823

你在那台机器上安装了 Team Build 吗？

此外，您将需要安装需要构建的所有内容。例如，为了运行 Web 测试，开发人员必须在他的工作站上安装 Team Test。这意味着您需要将它安装在构建服务器上。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-02T21:06:51.057

Microsoft 不建议将 Team Build 安装在与主 TFS 服务器相同的计算机上。

相信我，我同意他们的观点。

TFS 由 6-7 个数据库和一个 OLAP 多维数据集（TFS Warehouse）组成，它们实际上就像是一群老鼠。

源、工作项、用户和项目是否增加，该服务器上的负载也会增加！

我经历了一个必须等​​待计划的数据仓库处理完成才能进行签入的时刻！

你为什么不为你的构建创建一个虚拟服务器，你会被设置为 TFS2010 中的“虚拟化”！

# c++ - 如何在 Delphi 中调试 DLL 文件

> ID：594253
> 
> 赞同：7
> 
> 时间：2009-02-27T10:37:21.887
> 
> 标签：c++, delphi

我是一名开发 Visual C++ 的开发人员，但在我的项目中有一些[Delphi](http://en.wikipedia.org/wiki/Embarcadero_Delphi)组件。我需要调试 Delphi 组件来解决一些问题。

在 debug 中生成 DLL 文件然后在 Delphi 中开始 debug 必须做哪些事情？

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-02-27T10:51:20.200

在 Delphi 7 中，您可以这样做：

项目 | 选项 | 编译器 | 调试 | 调试信息（检查）

然后去运行| 参数 | 主机应用程序并输入您的 exe 的名称。

在 DLL 代码中添加一些断点，然后单击运行。您的 exe 将被加载，您可以在 Delphi IDE 中调试 DLL 部分。

如果您的 exe 已在运行，请单击运行 | 附加到进程

--我已经对此进行了测试，发现我还需要检查Delphi 7中项目选项的链接器页面上的“包含远程调试符号”。

我能够使用 Run | 获得一个要命中的断点。参数以及运行 | 附加到处理方法。我创建的测试 DLL 有一个 stdcall 函数，并由 Visual C++ 控制台应用程序动态加载。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-27T15:12:56.043

我们经常使用它（使用 Delphi）。

务必：

1.  在所有项目（DLL 文件）上启用所有调试选项。并禁用优化。
2.  请务必将宿主应用程序设置为正确的 EXE 文件。
3.  构建 DLL 文件。

您现在可以在 dll 和 exe 中放置断点。并从 IDE 运行 DLL 文件。它启动 EXE 文件并在请求的断点处停止。

它甚至可以在动态链接 DLL 文件时工作（如果它们被卸载，蓝点就会消失）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-27T16:13:09.113

The method Gamecat suggested is something I've used before.

Another way is: I have the DLL project, but I also make a "test bench" project. The "test bench" project has one form that can directly exercise the code that would normally be used in a DLL.

# sql-server-2000 - MS Sql Server 2000：多数据库查询

> ID：594256
> 
> 赞同：0
> 
> 时间：2009-02-27T10:38:23.177
> 
> 标签：sql-server-2000

我为每个部门都有单独的数据库。我在主数据库表中有所有部门列表。所有数据库都命名为 a1，a2 等现在我想从查询返回的所有部门数据库中获取员工详细信息。请帮助我

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-27T10:44:41.277

就像是：

```
select <columnlist>, '[databasename1]' AS dbname 
  from [databasename1].[owner].[table or view name]
UNION
select <columnlist>, '[databasename2]' AS dbname  
  from [databasename2].[owner].[table or view name]
UNION 
select <columnlist>, '[databasename3]' AS dbname  
  from [databasename3].[owner].[table or view name] 
```

执行：

```
DECLARE @DBTable TABLE (ID INT, DBName VARCHAR(20), DBOwner VARCHAR(10))
INSERT INTO @DBTable
SELECT 1, 'a1', 'dbo' UNION
SELECT 2, 'a2', 'dbo' UNION
SELECT 3, 'a3', 'dbo' UNION
SELECT 4, 'a5', 'dbo' 

DECLARE @Table VARCHAR(100), @Columns VARCHAR(500), @SQL VARCHAR(8000)
SELECT @Table = 'Emloyee', @Columns = 'ID, Name, Phone', @SQL = ''
SELECT @SQL = @SQL + '
SELECT '+@Columns+', '''+DBName+''' AS Database FROM ['+DBName+'].['+DBOwner+'].['+@Table+'] UNION'
FROM @DBTable
SET @SQL = SUBSTRING(@SQL, 0, LEN(@SQL) - 5)
EXEC(@SQL) 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-27T10:45:03.317

您可以像这样跨数据库获取表：-

```
SELECT * FROM a1..Employee
UNION ALL
SELECT * FROM a2..Employee 
```

# perl - 施瓦茨变换什么时候有用？

> ID：594257
> 
> 赞同：9
> 
> 时间：2009-02-27T10:38:29.620
> 
> 标签：perl, transform, benchmarking

在阅读“ [Intermediate Perl](https://rads.stackoverflow.com/amzn/click/com/0596102062) ”一书时，我注意到了关于 Schwartzian 变换的部分并尝试了练习中的示例（9.9.2），但注意到多次运行导致变换比正常排序花费更多时间。此处的代码根据文件大小对 windows\system32 目录中的文件进行简单排序 -

```
#!/usr/bin/perl
use strict;
use warnings;

use Benchmark;

my $time = timethese( 10, {
            testA => sub { map $_->[0],     
                        sort {$a->[1] <=> $b->[1]}
                        map [$_, -s $_],
                        glob "C:\\Windows\\System32\\*";
                    },
            testB => sub { sort { -s $a <=> -s $b } glob "C:\\Windows\\System32\\*";
                    },
            }
        ); 
```

输出是 -

```
Benchmark: timing 10 iterations of testA, testB...
     testA: 11 wallclock secs ( 1.89 usr +  8.38 sys = 10.27 CPU) @  0.97/s (n=10)
     testB:  5 wallclock secs ( 0.89 usr +  4.11 sys =  5.00 CPU) @  2.00/s (n=10) 
```

我的理解是，由于文件操作（-s）需要在 testB 案例中一遍又一遍地重复，它的运行速度应该比 testA 慢很多。输出虽然偏离了该观察。我在这里想念什么？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-02-27T11:15:45.180

对我来说，输出看起来有点不同：

```
 testA:  1 wallclock secs ( 0.16 usr +  0.11 sys =  0.27 CPU) @ 37.04/s (n=10)
        (warning: too few iterations for a reliable count)
 testB:  0 wallclock secs ( 0.09 usr +  0.02 sys =  0.11 CPU) @ 90.91/s (n=10)
        (warning: too few iterations for a reliable count) 
```

以相当大的迭代值（我选择 100,000）作为基准，我得到了：

```
 testA: 23 wallclock secs (12.15 usr + 10.05 sys = 22.20 CPU) @ 4504.50/s (n=100000)
 testB: 11 wallclock secs ( 6.02 usr +  5.57 sys = 11.59 CPU) @ 8628.13/s (n=100000) 
```

查看代码告诉我，这两个潜艇可能大部分时间都花在查找文件上，所以我这样做了：

```
my @files = glob "C:\\Windows\\System32\\*";
my $time = timethese( 1_000_000, {
                testA => sub {
                                map $_->[0],
                                    sort {$a->[1] <=> $b->[1]}
                                        map [$_, -s $_],
                                             @files;
                         },
                testB => sub {
                            sort { -s $a <=> -s $b } @files;
                         },
                }
        ); 
```

并得到：

```
 testA: 103 wallclock secs (56.93 usr + 45.61 sys = 102.54 CPU) @ 9752.29/s (n=1000000)
 testB: -1 wallclock secs ( 0.12 usr +  0.00 sys =  0.12 CPU) @ 8333333.33/s (n=1000000)
        (warning: too few iterations for a reliable count) 
```

这里有什么腥味，不是吗？

所以，让我们看一下文档：

perldoc -f 排序

> 在标量上下文中，“sort()”的行为是未定义的。

啊哈！所以让我们再试一次：

```
my @files = glob "C:\\Windows\\System32\\*";
my $time = timethese( 100_000, {
                testA => sub {
                              my @arr=  map $_->[0],
                                    sort {$a->[1] <=> $b->[1]}
                                        map [$_, -s $_],
                                             @files;
                         },
                testB => sub {
                            my @arr = sort { -s $a <=> -s $b } @files;
                         },
                }
        ); 
```

这给了我：

```
 testA: 12 wallclock secs ( 7.44 usr +  4.55 sys = 11.99 CPU) @ 8340.28/s (n=100000)
 testB: 34 wallclock secs ( 6.44 usr + 28.30 sys = 34.74 CPU) @ 2878.53/s (n=100000) 
```

所以。回答您的问题：只要您以有意义的方式使用 Schwartzian 变换，它就会对您有所帮助。当您以有意义的方式进行基准测试时，基准测试将显示这一点。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-27T12:38:24.793

除了 Manni 的出色回答之外，另一个要考虑的因素是您的示例中可能正在进行一些缓存，例如在文件系统级别。

如果多次访问同一个文件，FS 可能会进行一些缓存，从而导致 Schwartzian 变换节省的时间比预期的要少。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-27T19:57:39.230

有关此案例的全面检查，请参阅我的[Perlmonks](http://www.perlmonks.org)帖子[“浪费时间思考浪费的时间”](http://www.perlmonks.org/index.pl?node_id=393128)。我还在[Mastering Perl](http://oreilly.com/catalog/9780596527242/)的“基准测试”一章中对此进行了扩展。正如其他人已经指出的那样，问题在于基准测试代码，而不是转换。这是[Intermediate Perl](http://oreilly.com/catalog/9780596102067/)的错误。

但是，要回答您的问题，当排序键计算成本很高并且您必须多次计算时，缓存键转换很有用。在缓存排序键的额外工作和节省的周期之间需要权衡。通常，您必须排序的元素越多，缓存键转换的性能就越好。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-27T15:59:37.633

我知道这在技术上已经得到了相当完整的回答，但我有一些相关的旁注。

首先，我通常更喜欢 cmpthese() 而不是 timethese()，因为它以人类可读和信息丰富的方式告诉你哪个更好，而不仅仅是呈现时间。

其次，对于像这样的理论问题，我通常会尽可能地完全避免系统调用，因为如果内核愿意的话，它会让你永远等待——这不是一个真正的公平测试。

第三，有趣的是，如果列表已经排序，则变换总是更昂贵：如果设置 $point_of_interest=2，则变换获胜；但如果您设置 $point_of_interest=1，则常规排序将获胜。我觉得这个结果很有趣，值得一提。

```
use strict;
use Benchmark qw(cmpthese);

my $point_of_interest = 2;
my @f = (1 .. 10_000) x $point_of_interest;
my @b;

cmpthese( 500, {
    transform => sub {
        @b = 
        map  {$_->[0]}
        sort {$a->[1] <=> $b->[1]}
        map  {[$_, expensive($_)]}
        @f
    },  
    vanilla => sub { @b = sort { expensive($a) <=> expensive($b) } @f },
}); 

sub expensive {
    my $arg = shift;

    $arg .= "_3272";
    $arg += length "$arg";
    $arg = $arg ** 17;
    $arg = sqrt($arg);

    $arg;
} 
```

# django - Teleport - django 自定义标签

> ID：594259
> 
> 赞同：-5
> 
> 时间：2009-02-27T10:39:06.547
> 
> 标签：django, django-templates, django-custom-tags

请帮助使用 django 自定义标签。请分析一下！

主意：

1.  在任何模板（父或子）中，我们安装一个标签 {{ telepoint "head" }}，带有名称，这样的推杆可能不止一个。

2.  在另一边，我们有块

    ```
    {{ teleputter "head" "unique-name" }} some html {{ teleputterend }} 
    ```

    此块的内容以适当的远程点名称转到远程点。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-27T15:57:57.590

这听起来像您正在尝试实现模板继承： [http ://docs.djangoproject.com/en/dev/topics/templates/#id1](http://docs.djangoproject.com/en/dev/topics/templates/#id1)

阅读完整文档以获得最佳解释。读者文摘版本如下。

本质上，您有一个基本模板，其中包含具有默认值的内容块：

```
base.html
{% block  head %} "Default html goes here"  {% endblock %} 
```

接下来，您创建另一个扩展基本模板的模板并构建您想要替换的块：

```
anotherTemplate.html
{% extends "base.html %}
{% block  head %} "This replaces the html in the base head block"  {% endblock %} 
```

在我看来，您的“telepoint”是基本模板中的一个块，而您的“teleputter”是一个扩展基本模板的块

这听起来像你想要做的吗？你试图实现的有什么不同吗？

# svn - TortoiseSVN 错误

> ID：594261
> 
> 赞同：1
> 
> 时间：2009-02-27T10:40:07.480
> 
> 标签：svn, tortoisesvn, visualsvn

我对 SVN 有一些问题。有谁能够帮助我？

当我将分支合并到主干时，出现流动错误：

> 服务器响应 OPTIONS 发送了意外的返回值（403 Forbidden）

托盘创建新标签或分支时出现相同的错误。我有读/写权限。

我使用 VisualSVN 和 TortoiseSVN。

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-27T10:55:20.657

403 Forbidden 是[HTTP 状态码](http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html)之一。根据定义：

> 服务器理解请求，但拒绝执行。授权将无济于事，并且不应重复请求。如果请求方法不是 HEAD 并且服务器希望公开请求未完成的原因，它应该在实体中描述拒绝的原因。如果服务器不希望向客户端提供此信息，则可以使用状态代码 404（未找到）来代替。

我想您的存储库类似于[http://server/repo/project/](http://server/repo/project/)因此尝试使用常规浏览器浏览该 URL。也许与 Subversion 身份验证无关，而是与 HTTP 身份验证有关。

我知道这不是一个好的答案，但它可能会给你一个扩展问题的提示:)

# apache-flex - 第 3 方 Flash 添加的焦点从 Interactive Flash 对象中被盗

> ID：594262
> 
> 赞同：1
> 
> 时间：2009-02-27T10:40:46.450
> 
> 标签：apache-flex, flash, actionscript-3

我开发了一个简单的交互式 Flash 游戏，但现在似乎有时 Flash 添加（由 facebook 显示的第 3 方）以某种方式从我的 Flash 应用程序中窃取焦点（错误？）。我的应用程序有 textfield() 焦点应该一直保持到游戏结束。

我的 flash 对象使用 urlrequest/javascript 在启动时请求焦点（它适用于 IE 和 Firefox），但似乎很容易窃取焦点。当焦点丢失和/或如何确保其他 Flash 应用程序没有窃取它时，我应该怎么做才能始终恢复焦点？

此外，我的 javascript 焦点请求目前不适用于 Safari/Crome 浏览器，那么请求焦点并保持它的最兼容方式是什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-27T10:54:16.277

当我绝对需要焦点时，我通常只需要让玩家点击 Flash 中的某些东西来获得焦点，它甚至不需要“单击此处进行焦点”，而是需要一个开始按钮或类似的东西。

actionscript3 还有一个事件会在你的应用失去焦点时触发，你可以使用它来暂停游戏并弹出一个框，要求玩家将焦点归还。

我认为“强迫”焦点充其量是不可靠的，无论如何你都需要适当的后备。

作为旁注；我从来没有遇到过“窃取焦点”的问题，我什至不确定我是否理解为什么广告可以/会这样做？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-27T12:35:16.407

我从来不需要处理你的具体情况（我也从来没有听说过它发生过，但我也不必与网页上的其他 Flash 对象打架），但是如果你要监听 MouseEvent 会怎样。 FOCUS_OUT 在您的文本字段上，然后设置一个单次计时器，例如 250 毫秒，在触发时会收回焦点（使用您可能需要的任何 JavaScript 来说服浏览器再次给您焦点）。

不幸的是，我对与 Safari 或 Chrome 的集成知之甚少，无法帮助您解决第二个问题。

# vba - Excel VBA - 重新初始化范围

> ID：594263
> 
> 赞同：0
> 
> 时间：2009-02-27T10:41:07.413
> 
> 标签：vba, excel

在宏中，我在文件的每个工作表中应用相同的处理。

我想确定哪一列包含特定文本，这在每个工作表中可能不同。

代码如下：

```
For Each Cell_version In Ws.Range("1:1")
    If Ws.Range(convertir(Cell_version.Column) & "1") = "ICI" Then
        Column_version = convertir(Cell_version.Column)
        Trouve_col = True
        MsgBox (Column_version)
    End If
If Trouve_col = True Then Exit For
Next Cell_version 
```

在第一个工作表上，所有功能都正常运行，并在相应的列中找到文本`column D`。在第二个工作表中，如果该列位于 D 列之后，它也可以正常工作。但是，如果是`column A, B, or C`，它不会返回包含所需文本的列。我该如何解决这个问题？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-27T10:57:10.387

我的 VBA 有点生疏，但我一直更喜欢这个`Find`命令，因为它是搜索工作表的最快方法，可能像这样：

```
Sheets("YourSheet").Select

Cells(1, 1).Select

Set found = Cells.Find(What:="ICI", After:=ActiveCell, LookIn:=xlValues, _
    LookAt:=xlColumn, SearchOrder:=xlByRows, SearchDirection:=xlNext, _
    MatchCase:=False, SearchFormat:=False)

If Not found Is Nothing Then
    found.Activate      
    MsgBox(Selection.Row)
End If 
```

# python - Python中的方程解析

> ID：594266
> 
> 赞同：41
> 
> 时间：2009-02-27T10:42:07.740
> 
> 标签：python, parsing, equation

我如何（轻松）获取一个字符串，例如`"sin(x)*x^2"`用户在运行时可能输入的字符串，并生成一个 Python 函数，该函数可以针对 的任何值进行评估`x`？

* * *

## 回答 #1

> 赞同：49
> 
> 时间：2009-02-27T11:12:34.280

如果您使用 Python 表示法，Python 自己的内部编译器可以解析它。

如果你稍微改变一下符号，你会更开心。

```
import compiler
eq= "sin(x)*x**2"
ast= compiler.parse( eq ) 
```

您将获得一个可以使用的抽象语法树。

* * *

## 回答 #2

> 赞同：35
> 
> 时间：2011-05-09T12:23:11.413

您可以使用 Python `parser`：

```
import parser
from math import sin

formula = "sin(x)*x**2"
code = parser.expr(formula).compile()
x = 10
print(eval(code)) 
```

它比纯的性能更好`eval`，当然，避免了代码注入！

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2009-02-27T10:51:37.967

```
 f = parser.parse('sin(x)*x^2').to_pyfunc() 
```

`parser`可以使用 PLY、pyparsing、内置标记器、解析器、ast 定义哪里。

不要`eval`在用户输入上使用。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2010-03-29T12:11:39.333

pyparsing 可能会做你想做的事（[http://pyparsing.wikispaces.com/](http://pyparsing.wikispaces.com/)），特别是如果字符串来自不受信任的来源。

另请参阅[http://pyparsing.wikispaces.com/file/view/fourFn.py](http://pyparsing.wikispaces.com/file/view/fourFn.py)以获得使用它构建的功能相当全的计算器。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-02-27T11:57:10.227

为了强调 JF Sebastian 的建议，“eval”甚至“编译器”解决方案都可能存在细微的安全漏洞。输入的可信度如何？使用“编译器”，您至少可以从 AST 中过滤掉诸如 getattr 查找之类的东西，但我发现使用 PLY 或 pyparsing 处理这类事情比确保让 Python 提供帮助的结果更容易。

此外，“编译器”笨拙且难以使用。它已在 3.0 中弃用并删除。您应该使用“ast”模块（在 2.6 中添加，在 2.5 中作为“_ast”提供）。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-27T10:50:39.670

[Sage](http://www.sagemath.org/index.html)旨在作为 matlab 替代品，在[介绍视频](http://www.sagemath.org/help-video.html)中，它展示了如何处理与您的案例相似的情况。他们似乎支持广泛的方法。由于代码是开源的，您可以浏览并亲自查看作者如何处理此类情况。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-03-29T11:44:17.513

与vartec达成一致。我会使用 SymPy - 特别是 lambdify 函数应该完全符合您的要求。

见：[http ://showmedo.com/videotutorials/video?name=7200080&fromSeriesID=720](http://showmedo.com/videotutorials/video?name=7200080&fromSeriesID=720)

对此有一个很好的解释。

最良好的祝愿，

# ios - 是否可以将其他控制器页面用作导航基本模板的首页？

> ID：594267
> 
> 赞同：0
> 
> 时间：2009-02-27T10:42:28.240
> 
> 标签：ios, objective-c, iphone, xcode, cocoa-touch

我是 Objective-C 领域的新手。我正在尝试使用**基于导航的模板**来构建 iPhone 应用程序。

一开始通常在基于导航的模板显示`UITableView`页面上，但我想在该页面的开头显示**其他**`UIView`控制器页面。

可能吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-27T13:38:28.707

UITableViewController 是在 xib 文件中创建的，用您想要的任何控制器替换它，并确保将 .h 中的它更改为正确的类型。

# c# - .net 中的 Invoke() 有什么用？

> ID：594268
> 
> 赞同：5
> 
> 时间：2009-02-27T10:42:41.733
> 
> 标签：c#, .net, invoke

我找到了这段代码：

```
this.Invoke(new EventHandler(EventGetSum)); 
```

这和写作不一样吗：

```
EventGetSum(); 
```

这有什么用？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-02-27T10:46:40.490

如果你这样写`EventGetSum()`，立即*调用*EventGetSum 方法。

如果您编写`new EventHandler(EventGetSum)`它会创建一个委托，该委托将（反过来）在调用 EventGetSum 时调用。

调用[`Control.Invoke`](http://msdn.microsoft.com/en-us/library/system.windows.forms.control.invoke.aspx)从负责控件的 UI 线程调用给定委托。这是必要的，因为您不能从任意线程访问 UI 元素。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-27T10:48:00.783

它执行`EventGetSum`窗口`this`所属线程中的方法。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-27T10:48:19.253

这通常在处理跨线程 UI 调用时使用。

查看 ISynchronizeInvoke 的 MSDN 文档。

# python - 如何从列表中选择一个随机的英文单词

> ID：594273
> 
> 赞同：12
> 
> 时间：2009-02-27T10:45:47.247
> 
> 标签：python, random, word-list

获得一个返回随机英文单词（最好是名词）的函数的最佳方法是什么，而不事先在文件中保留所有可能单词的列表？

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2009-02-27T14:25:32.790

单词列表不需要占用那么多空间。

这是一个[包含 2,465 个单词的 JSON 单词表，都是名词](https://www.randomlists.com/data/words.json)。它的时钟频率低于 50K，即中型 jpeg 图像的大小。

我将选择一个随机的作为练习给读者。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-02-27T10:49:11.793

你不能。没有生成有意义的词的算法。您只能生成听起来像英语的单词，但它们没有任何意义。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-27T10:50:14.023

您可以让该函数尝试解析在线资源，例如：

[http://www.zokutou.co.uk/randomword/](http://www.zokutou.co.uk/randomword/)

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-27T10:58:46.483

另一种理论方法：您可以抓取[随机的维基百科文章](http://en.wikipedia.org/wiki/Special:Random)页面并返回文章的第 N 个单词。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2011-06-14T06:33:31.847

只需使用 setgetgo 的随机词 api。它是免费的，它很容易，而且它很摇滚。

[http://randomword.setgetgo.com/](http://randomword.setgetgo.com/)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-01-13T23:10:26.733

[这里](http://randword.lukesampson.com/)有一个随机词生成器——它不是英语，而是英语，即这些词与语言足够相似，用户可以阅读这些词并将它们存储在短期记忆中。

源代码在 C# 中，有点杂乱无章，但您可以在 Python 中使用类似的方法来生成大量单词，而无需存储大量列表。

或者，您可以直接在演示页面上调用 Web 服务 - 不过它托管在 GoDaddy 上，因此不能保证它可以在生产环境中运行！

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2010-01-13T23:25:29.147

[您可以从http://www.math.toronto.edu/jjchew/scrabble/lists/](http://www.math.toronto.edu/jjchew/scrabble/lists/)下载“SOWPODS 和 TWL 常用词”列表。我将这些文件中的所有单词放在一起，列表的重量约为 642k。以任何标准衡量都不算大。不过，这些列表确实包含很多晦涩难懂的词，因为它们是供比赛拼字游戏使用的。好消息是这些列表构成了英语的一个重要子集。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-27T10:48:44.917

好吧，你有三个选择：

*   硬编码单词列表并用它初始化一个数组。
*   从 Internet 位置而不是文件中获取列表。
*   将可能的单词列表保存在文件中。

避免上述情况的唯一方法是，如果您不关心单词是否真实：您可以生成随机长度的字符串。（如果没有字典列表，就无法以编程方式生成单词。）

# c# - NHibernate 是否适合 SPC 应用程序？

> ID：594277
> 
> 赞同：0
> 
> 时间：2009-02-27T10:47:57.507
> 
> 标签：c#, database, nhibernate

我最近听到了很多关于 NHibernate 的消息（主要是好消息），并且想了解它。在我的公司，我们计划用 C# 创建一个基于数据库的应用程序，我想知道 NHibernate 是否适合这个项目。但由于我没有使用 ORM 的经验，我无法评估所涉及的风险。

**背景：**

它将是[统计过程控制 (SPC)](http://en.wikipedia.org/wiki/Statistical_process_control)的应用程序。它的核心将是一个对一组不同部分进行大量测量的数据库。一些 SPC 计算需要评估给定零件的最后 3 或 5 次测量值，而其他计算可能需要评估 100 或 1000 次测量值。必须在每个新的测量条目上更新计算。零件的计算类型、可接受值的边界以及结果违反这些边界时所采取的措施都是可配置的。

数据库后端将是 Oracle 或 SQL Server（这是高层做出的政治决定，我们部门对此没有影响）。

所以我的问题是： *你会推荐在这个项目中使用 NHibernate 吗？而且（更重要的是）为什么？*

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-27T12:15:03.117

在这样的项目中，您肯定可以使用 NH。它甚至可以让您稍后决定使用哪个数据库。有时您可能希望使用直接 sql 查询来提高性能，并且为此在 NH 中有标签，因此 DB 之间会有差异，但大部分工作将独立于最终决定。在一个统计应用程序中，我发现在这种数据上会有很多只读缓存数据和 NH 星......

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-27T11:16:52.680

如果您最终选择了 Oracle，您可以认真考虑使用[Oracle Application Express](http://www.oracle.com/technology/products/database/application_express/index.html)来构建您的应用程序 - 无需 C#，无需 NHibernate。没有更快（或者在我看来更好）的方式来构建基于 Oracle 的 Web 应用程序。不过需要一些 PL/SQL 和 Javascript 知识。

# qt4 - QListView 单击鼠标按钮

> ID：594278
> 
> 赞同：2
> 
> 时间：2009-02-27T10:47:59.520
> 
> 标签：qt4, qlistview

我需要知道发出 QListView::clicked 信号时单击的鼠标按钮是什么。

我怎么知道按钮。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-27T11:07:56.197

尝试实现一个新的类继承形式`QListView`并重新实现：

```
void QAbstractItemView::mousePressEvent ( QMouseEvent * event )  [virtual protected]. 
```

我希望它有用。萨鲁2

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-27T11:13:03.843

Salu2 是正确的，如果您只是在上下文菜单之后（右键单击），您可以重新实现 QWidget::contextMenuEvent

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-03T17:58:48.377

如果您对子类化不感兴趣，您还可以创建一个事件过滤器类并将该过滤器安装到您要收听的对象（在本例中为`QListView`）。

有关更多信息，请查看[`QObject::installEventFilter()`](http://doc.trolltech.com/4.5/qobject.html#installEventFilter)。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-06-16T15:53:53.780

QApplication::mousebuttons() 怎么样？这就是文档建议找到按钮的方法。

# wpf - WPF 中的 XML 命名空间 - xmlns

> ID：594282
> 
> 赞同：1
> 
> 时间：2009-02-27T10:48:33.717
> 
> 标签：wpf, namespaces, xml-namespaces

以下 XML 命名空间引用包含在每个新 Xaml 文件的顶部。

```
//http://schemas.microsoft.com/winfx/xaml/presentation
//http://schemas.microsoft.com/winfx/xaml 
```

winfx **/xaml/presentation**包含对一系列 Windows 命名空间的引用，例如 Windows.Navigation、Windows.Controls 等。winfx/xaml 命名空间始终（通常默认情况下）具有**x**别名或前缀。winfx/xaml 引用了什么它似乎有很多可以从 winfx/xaml/presentation 引用的相同元素。我已阅读 MSDN 文档，可以找到与 winfx/xaml/presentation 关联的程序集列表，但我不确定 winfx/xaml 命名空间的意义何在。

谁能解释一下？

编辑：就像我最初所说的那样，我已经阅读了 MSDN 文档，并且正在寻找更详细的答案。示例为什么某些元素可以互换使用。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-27T13:40:31.617

XAML 不仅被 WPF 使用，因此命名空间的分离！[http://schemas.microsoft.com/winfx/xaml](http://schemas.microsoft.com/winfx/xaml)是与 XAML 相关的东西，可以在其他框架（如 WF、Silverlight 和 WCF）上重用，其中[http://schemas.microsoft.com/winfx /xaml/presentation](http://schemas.microsoft.com/winfx/xaml/presentation)包含纯粹为 WPF 设计的东西！！！

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-27T10:55:09.893

它是一个包含 XAML 构造的命名空间，可以在 WPF 上下文之外使用。[可在此处](http://msdn.microsoft.com/en-us/library/ms753327.aspx)获取详细信息。

# c# - 使用 Castle Windsor 和 MicroKernel 的 dll “插入式”架构

> ID：594297
> 
> 赞同：1
> 
> 时间：2009-02-27T10:53:07.697
> 
> 标签：c#, plugins, inversion-of-control, castle-windsor, microkernel

我想创建一个无需任何配置即可使用 IoC 的框架：

因此，而不是（从[http://www.castleproject.org/container/gettingstarted/part1/code.html](http://www.castleproject.org/container/gettingstarted/part1/code.html)调整）：

```
IWindsorContainer container = new WindsorContainer();
container.AddComponent("someinterface", typeof(ISomeInterface));
ISomeInterface component = (ISomeInterface) container[typeof(ISomeInterface)];
component.DoIt();
container.Release(component); 
```

不需要调用该`container.AddComponent`方法，因为会有一些初始步骤通过在已知目录中查找包含实现 ISomeComponent 的类并将它们注册到 WindsorContainer 的任何 dll 来执行一些“自动连接”。

我可以看到这可以从头开始，但理想情况下，如果有一个已经完成的开源项目，我不想重写此代码！

# c# - C# DLL 配置文件

> ID：594298
> 
> 赞同：197
> 
> 时间：2009-02-27T10:53:24.483
> 
> 标签：c#, app-config

我试图将 app.config 文件添加到我的 DLL，但所有尝试都失败了。

根据“[将配置信息放入 DLL](https://stackoverflow.com/questions/161763/putting-configuration-information-in-a-dll) ”中的 MusicGenesis，这应该不是问题。所以很明显我做错了什么......

以下代码应从我的 DLL 中返回我的 ConnectionString：

```
return ConfigurationManager.AppSettings["ConnectionString"]; 
```

但是，当我将 app.config 文件复制到我的控制台应用程序时，它工作正常。

有任何想法吗？

* * *

## 回答 #1

> 赞同：283
> 
> 时间：2009-06-17T19:58:57.203

为 .DLL 创建 .NET 配置文件并非易事，而且有充分的理由。.NET 配置机制内置了许多功能，便于轻松升级/更新应用程序，并防止已安装的应用程序相互践踏其他配置文件。

DLL 的使用方式和应用程序的使用方式之间存在很大差异。您不太可能为同一用户在同一台​​计算机上安装应用程序的多个副本。但是您很可能拥有 100 个不同的应用程序或库，它们都使用了一些 .NET DLL。

尽管很少需要在一个用户配置文件中单独跟踪应用程序的不同副本的设置，但您**不太**可能希望 DLL 的所有不同用法相互共享配置。出于这个原因，当您使用“正常”方法检索配置对象时，您返回的对象与您正在执行的应用程序域的配置相关联，而不是特定的程序集。

应用程序域绑定到加载代码实际所在程序集的根程序集。在大多数情况下，这将是主 .EXE 的程序集，也就是加载 .DLL 的程序集。可以在应用程序中启动其他应用程序域，但您必须明确提供有关该应用程序域的根程序集的信息。

因此，创建特定于库的配置文件的过程并不那么方便。这与创建任意可移植配置文件的过程相同，该文件不绑定到任何特定程序集，但您希望使用 .NET 的 XML 模式、配置部分和配置元素机制等。这需要创建一个`ExeConfigurationFileMap`对象，加载数据以确定配置文件的存储位置，然后调用`ConfigurationManager`. `OpenMappedExeConfiguration`将其打开到一个新`Configuration`实例中。这**将使**您远离自动路径生成机制提供的版本保护。

从统计上讲，您可能在内部环境中使用此库，并且您不太可能在任何一台机器/用户中拥有多个应用程序使用它。 **但**如果没有，你应该记住一些事情。如果您为 DLL 使用单个全局配置文件，无论应用程序引用它，您都需要担心访问冲突。如果引用您的库的两个应用程序碰巧同时运行，每个应用程序都`Configuration`打开了自己的对象，那么当一个保存更改时，下次您尝试在另一个应用程序中检索或保存数据时会导致异常。

解决这个问题的最安全和最简单的方法是要求加载 DLL 的程序集也提供一些关于它自己的信息，或者通过检查引用程序集的应用程序域来检测它。使用它来创建某种文件夹结构，以便为引用您的 DLL 的每个应用程序保留单独的用户配置文件。

如果您**确定**要对 DLL 进行全局设置，无论它在何处被引用，您都需要确定它的位置，而不是 .NET 自动找出合适的位置。您还需要积极管理对文件的访问。您需要尽可能多地缓存，`Configuration`仅在加载或保存时保留实例，在之前立即打开并在之后立即处理。最后，您需要一种锁定机制来保护文件，同时它正在被使用该库的应用程序之一编辑。

* * *

## 回答 #2

> 赞同：105
> 
> 时间：2010-02-16T11:53:24.177

如果您想从 DLL 的配置文件中读取设置，而不是从根应用程序 web.config 或 app.config 中读取设置，请使用以下代码读取 dll 中的配置。

```
var appConfig = ConfigurationManager.OpenExeConfiguration(Assembly.GetExecutingAssembly().Location);
string dllConfigData = appConfig.AppSettings.Settings["dllConfigData"].Value; 
```

* * *

## 回答 #3

> 赞同：22
> 
> 时间：2011-04-05T12:15:06.113

我遇到了同样的问题，在网上搜索了几个小时，但我找不到任何解决方案，所以我自己做了。我想知道为什么.net 配置系统如此不灵活。

背景：我想让我的 DAL.dll 拥有自己的数据库和 DAL 设置配置文件。我还需要企业库的 app.config 及其自己的配置。所以我需要 app.config 和 dll.config。

我不想做的是将应用程序中的每个属性/设置传递到我的 DAL 层！

弯曲“AppDomain.CurrentDomain.SetupInformation.ConfigurationFile”是不可能的，因为我需要它来实现正常的 app.config 行为。

我的要求/观点是：

*   没有从 ClassLibrary1.dll.config 到 WindowsFormsApplication1.exe.config 的任何手动副本，因为这对于其他开发人员来说是不可复制的。
*   保留强类型“Properties.Settings.Default.NameOfValue”（设置行为）的用法，因为我认为这是一个主要功能，我不想失去它
*   我发现缺少 ApplicationSettingsBase 来注入您自己的/自定义配置文件或管理（所有必要的字段在这些类中都是私有的）
*   无法使用“configSource”文件重定向，因为我们必须复制/重写 ClassLibrary1.dll.config 并为多个部分提供多个 XML 文件（我也不喜欢这样）
*   我不喜欢像 MSDN 建议的那样为这个简单的任务编写自己的 SettingsProvider，因为我认为这太过分了
*   我只需要配置文件中的部分 applicationSettings 和 connectionStrings

我想出了修改 Settings.cs 文件并实现了一个打开 ClassLibrary1.dll.config 并读取私有字段中的部分信息的方法。之后，我重写了“this[string propertyName]”，因此生成的 Settings.Desginer.cs 调用我的新属性而不是基类。从列表中读出设置。

最后有如下代码：

```
internal sealed partial class Settings
{
    private List<ConfigurationElement> list;

    /// <summary>
    /// Initializes a new instance of the <see cref="Settings"/> class.
    /// </summary>
    public Settings()
    {
        this.OpenAndStoreConfiguration();
    }

    /// <summary>
    /// Opens the dll.config file and reads its sections into a private List of ConfigurationElement.
    /// </summary>
    private void OpenAndStoreConfiguration()
    {
        string codebase = System.Reflection.Assembly.GetExecutingAssembly().CodeBase;
        Uri p = new Uri(codebase);
        string localPath = p.LocalPath;
        string executingFilename = System.IO.Path.GetFileNameWithoutExtension(localPath);
        string sectionGroupName = "applicationSettings";
        string sectionName = executingFilename + ".Properties.Settings";
        string configName = localPath + ".config";
        ExeConfigurationFileMap fileMap = new ExeConfigurationFileMap();
        fileMap.ExeConfigFilename = configName;
        Configuration config = ConfigurationManager.OpenMappedExeConfiguration(fileMap, ConfigurationUserLevel.None);

        // read section of properties
        var sectionGroup = config.GetSectionGroup(sectionGroupName);
        var settingsSection = (ClientSettingsSection)sectionGroup.Sections[sectionName];
        list = settingsSection.Settings.OfType<ConfigurationElement>().ToList();

        // read section of Connectionstrings
        var sections = config.Sections.OfType<ConfigurationSection>();
        var connSection = (from section in sections
                           where section.GetType() == typeof(ConnectionStringsSection)
                           select section).FirstOrDefault() as ConnectionStringsSection;
        if (connSection != null)
        {
            list.AddRange(connSection.ConnectionStrings.Cast<ConfigurationElement>());
        }
    }

    /// <summary>
    /// Gets or sets the <see cref="System.Object"/> with the specified property name.
    /// </summary>
    /// <value></value>
    public override object this[string propertyName]
    {
        get
        {
            var result = (from item in list
                         where Convert.ToString(item.ElementInformation.Properties["name"].Value) == propertyName
                         select item).FirstOrDefault();
            if (result != null)
            {
                if (result.ElementInformation.Type == typeof(ConnectionStringSettings))
                {
                    return result.ElementInformation.Properties["connectionString"].Value;
                }
                else if (result.ElementInformation.Type == typeof(SettingElement))
                {
                    return result.ElementInformation.Properties["value"].Value;
                }
            }
            return null;
        }
        // ignore
        set
        {
            base[propertyName] = value;
        }
    } 
```

您只需将 ClassLibrary1.dll.config 从 ClassLibrary1 输出目录复制到应用程序的输出目录。也许有人会发现它很有用。

* * *

## 回答 #4

> 赞同：14
> 
> 时间：2009-02-27T10:56:17.380

使用 ConfigurationManager 时，我很确定它正在加载进程/`AppDomain`配置文件（app.config / web.config）。如果要加载特定的配置文件，则必须按名称专门询问该文件...

你可以试试：

```
var config = ConfigurationManager.OpenExeConfiguration("foo.dll");
config.ConnectionStrings. [etc] 
```

* * *

## 回答 #5

> 赞同：13
> 
> 时间：2009-02-27T10:58:02.117

ConfigurationManager.AppSettings 返回为应用程序定义的设置，而不是为特定的 DLL，您可以访问它们，但将返回的是应用程序设置。

如果您使用来自另一个应用程序的 dll，则 ConnectionString 应位于应用程序的 app.settings 中。

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2010-02-22T16:17:11.730

我知道这晚了，但是我想我会分享我用于 DLL 的解决方案。

我更像是 KISS 学派，所以当我有一个 .NET DLL 想要存储控制其工作方式或去向等的外部数据点时。我只需创建一个只有公共属性的“配置”类存储它需要的所有数据点，并且我希望能够在 DLL 外部进行控制，以防止重新编译它以进行更改。然后我使用 .Net 的 XML 序列化将类的对象表示保存并加载到文件中。

然后有很多方法可以处理读取和访问它，从单例、静态实用程序类到扩展方法等。这取决于您的 DLL 的结构以及最适合您的 DLL 的方法。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2013-04-04T18:49:33.317

你是对的，你可以读取一个dll的配置文件。我为此苦苦挣扎了一天，直到我发现我的配置文件是问题所在。请参阅下面的代码。它能够运行。

```
 ExeConfigurationFileMap map = new ExeConfigurationFileMap();
        map.ExeConfigFilename = Assembly.GetExecutingAssembly().Location + ".config";
        Configuration libConfig = ConfigurationManager.OpenMappedExeConfiguration(map, ConfigurationUserLevel.None);
        AppSettingsSection section = (libConfig.GetSection("appSettings") as AppSettingsSection);
        Console.WriteLine(section.Settings["dnd_shortcodes"].Value); 
```

我`Plugin1.dll.config`看起来如下；

```
<?xml version="1.0" encoding="utf-8" ?>
<configuration>
 <appSettings>
  <add key="cmd_location" value="http://..."/>
  <add key="dnd_shortcodes" value="142,145,146,157,165,167,168,171,173,176,178,404,40"/>
 </appSettings>
</configuration> 
```

我发现我的配置文件缺少`<appSettings>`标签，所以环顾四周，您的问题可能有所不同，但与我的相差不远。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2017-11-10T00:53:29.747

完整的解决方案通常不会在一个地方找到......

1）创建一个应用程序配置文件并将其命名为“yourDllName.dll.config”
2）在VS解决方案资源管理器中右键单击上面创建的配置文件，单击属性
---设置“构建操作”= 内容
--- 设置“复制到输出目录”= 始终
3) 使用 yourKeyName 和 yourKeyValue 将 appSettings 部分添加到配置文件 (yourDllName.dll.config)

```
<?xml version="1.0" encoding="utf-8" ?>
<configuration>
  <appSettings>
    <add key="yourKeyName" value="yourKeyValue"/>
  </appSettings>
</configuration> 
```

4) 将 System.Configuration 添加到您的 dll/类/项目引用
5) 将 using 语句添加到您打算访问配置设置的代码中

```
using System.Configuration;
using System.Reflection; 
```

6) 访问值

```
string keyValue = ConfigurationManager.OpenExeConfiguration(Assembly.GetExecutingAssembly().Location).AppSettings.Settings["yourKeyName"].Value; 
```

7) 高兴，它有效

恕我直言，这只应在开发新的 dll/库时使用。

```
#if (DEBUG && !FINALTESTING)
   string keyValue = ConfigurationManager.OpenExeConfiguration...(see 6 above)
#else
   string keyValue = ConfigurationManager.AppSettings["yourKeyName"];
#endif 
```

配置文件最终成为一个很好的参考，当您将 dll 的 appSettings 添加到您的实际应用程序时。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2009-09-25T15:47:24.803

似乎这个配置文件真的很混乱，因为它们的行为从开发环境到部署的变化。显然，一个 DLL 可以有自己的配置文件，但是一旦你将 dll（连同它们的配置文件）复制并粘贴到其他地方，整个事情就停止了工作。唯一的解决方案是手动将 app.config 文件合并到一个文件中，该文件仅由 exec 使用。例如，myapp.exe 将有一个 myapp.exe.config 文件，其中包含 myapp.exe 使用的所有 dll 的所有设置。我正在使用 VS 2008。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2011-06-19T22:01:04.423

如果您使用的是在后台查找大量配置的库，例如 WCF，您可以考虑这样做：

```
AppDomain.CurrentDomain.SetData("APP_CONFIG_FILE", "MyWcfClientWrapper.dll.config"); 
```

或在 PowerShell 中：

```
[AppDomain]::CurrentDomain.SetData("APP_CONFIG_FILE", "MyWcfClientWrapper.dll.config") 
```

IMO 这种技术是一种代码味道，实际上只适用于临时脚本。如果您发现自己想在生产代码中执行此操作，也许是时候进行架构审查了。

**不推荐以下内容：**
作为技术好奇心，这里是主题的变体。您可以在 DLL 中的一个类中创建一个静态构造函数，然后从那里进行此调用。我不建议这样做，除非作为最后的手段。

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2010-05-26T03:01:07.393

由于程序集驻留在临时缓存中，您应该结合路径来获取 dll 的配置：

```
var appConfig = ConfigurationManager.OpenExeConfiguration(
    Path.Combine(Environment.CurrentDirectory, Assembly.GetExecutingAssembly().ManifestModule.Name)); 
```

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2011-02-09T00:19:17.613

我发现似乎是解决此问题的好方法。我正在使用 VS 2008 C#。我的解决方案涉及在多个配置文件之间使用不同的命名空间。我已经在我的博客上发布了解决方案：http: [//tommiecarter.blogspot.com/2011/02/how-to-access-multiple-config-files-in.html](http://tommiecarter.blogspot.com/2011/02/how-to-access-multiple-config-files-in.html)。

例如：

此命名空间读/写 dll 设置：

```
var x = company.dlllibrary.Properties.Settings.Default.SettingName;
company.dlllibrary.Properties.Settings.Default.SettingName = value; 
```

此命名空间读取/写入 exe 设置：

```
company.exeservice.Properties.Settings.Default.SettingName = value;
var x = company.exeservice.Properties.Settings.Default.SettingName; 
```

文章中提到了一些注意事项。高温高压

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2009-02-27T10:59:18.230

As Marc says, this is not possible (although Visual Studio allows you to add an application configuration file in a class library project).

You might want to check out the [AssemblySettings](http://www.koders.com/csharp/fidAD657BD6BAD7B5996A0577D1961430638310A76F.aspx) class which seems to make assembly config files possible.

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2020-07-31T11:04:03.477

模拟一个“真实的”应用程序配置文件令人困惑。我建议你自己动手，因为使用 LINQ 解析 XML 文件非常容易。

例如，创建一个如下所示的 XML 文件 MyDll.config 并将其与 DLL 一起复制。要使其保持最新，请将其在 Visual Studio 中的属性设置为“复制到输出目录”

```
<?xml version="1.0" encoding="utf-8" ?>
 <configuration>
  <setting key="KeyboardEmulation" value="Off"></setting>
 </configuration> 
```

在你的代码中这样读：

```
 XDocument config = XDocument.Load("MyDll.config");
    var settings = config.Descendants("setting").Select(s => new { Key = s.Attribute("key").Value, Value = s.Attribute("value").Value });
    bool keyboardEmulation = settings.First(s => s.Key == "KeyboardEmulation").Value == "On"; 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2013-05-31T23:29:25.803

对于 dll，它不应该依赖于配置，因为配置属于应用程序而不是 dll。

这在[这里解释](https://stackoverflow.com/a/16867319/1661861)

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2011-11-20T10:59:17.793

在这篇文章中，讨论了一个类似的问题并解决了我的问题[如何动态加载单独的应用程序设置文件并与当前设置合并？](https://stackoverflow.com/questions/2389290/how-to-load-a-separate-application-settings-file-dynamically-and-merge-with-curr)可能会有帮助

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2017-07-19T16:44:28.047

您可以使用以下代码：

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Runtime.InteropServices;
using System.Text;
using System.Threading.Tasks;

namespace GClass1
{
[Guid("D6F88E95-8A27-4ae6-B6DE-0542A0FC7039")]
[InterfaceType(ComInterfaceType.InterfaceIsIDispatch)]
public interface _GesGasConnect
{
    [DispId(1)]
    int SetClass1Ver(string version);

}

[Guid("13FE32AD-4BF8-495f-AB4D-6C61BD463EA4")]
[ClassInterface(ClassInterfaceType.None)]
[ProgId("InterfacesSMS.Setting")]
public class Class1 : _Class1
{
    public Class1() { }

    public int SetClass1(string version)
    {
        return (DateTime.Today.Day);
    }
}
} 
```

# modalpopupextender - Ajax 模式弹出窗口

> ID：594299
> 
> 赞同：-1
> 
> 时间：2009-02-27T10:53:39.803
> 
> 标签：modalpopupextender

我在网格视图中显示数据。其中绑定了一个链接。在该链接按钮事件上，将显示一个 ajax 模式弹出窗口。该模式弹出窗口包含一个 windows 媒体播放器控件和一个转发器控件。Repeater contains the audio files, and when select 1 of them, that file will played in that player control. 问题是，当音频文件处于播放模式并且模式弹出窗口关闭时，该音频文件将保持播放模式，直到没有发生任何其他服务器端事件。- 关闭弹出窗口时如何停止该文件？请帮忙。提前致谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-27T11:00:43.577

Ajax is for server requests not pop-up windows so i'm a little confused about what you are asking.

If you want to stop playback of the audio file once the pop-up window is closed you could try to use a `onclose` event handler to stop the playback. This would only work if javascipt can interact with the media player.

# sharepoint - 是否值得学习 SharePoint 2007？

> ID：594300
> 
> 赞同：3
> 
> 时间：2009-02-27T10:53:47.727
> 
> 标签：sharepoint, wss

MOSS（Microsoft Office SharePoint Server）2007值得学习吗？它的未来可能是什么？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-27T21:42:17.670

SharePoint 是Microsoft 历史**上**增长最快的产品。

即使是 MS 也无法获得足够有经验的 MOSS 开发人员的支持。

学习 MOSS，你应该很确定要在商业、危机和所有方面保持下去。

也很**有趣**。我知道它在开发方面享有盛誉，缺乏好的工具可能会让许多开发人员感到沮丧，但事实是它是一个真正的 ASP.NET 应用程序。尤其是部署可能看起来很麻烦，但如果你这样做并且做得很好，你可以毫不费力地将你的代码从一个环境移动到另一个环境。我还没有使用任何其他可以做到这一点的 CMS 产品，并且我研究了一些！

所以拿一本 SharePoint 书并开始编码 :-)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-27T14:57:34.130

SharePoint 和 MOSS 是一个很好的利基市场。它在简历上看起来很棒，并且在就业市场上的需求量很大。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-27T11:14:41.763

Yes, it is if you're working on Microsoft products.

MOSS 2007 is an important part of the office suite of products, and will continue to be, given its gigantic uptake and excellent revenue stream for Microsoft.

The next release of MOSS is due in 2010, and I imagine the integration with Microsoft Office and other products will increase, and also become more transparent.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-27T11:19:50.130

它很热，并没有多少人完全理解它，但每个大公司都想要它……加入我们的行列！

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-03-22T23:05:25.807

Sharepoint 是组织中的一种布告栏。如果它在组织中，它有助于存储各种文档和发布新闻等。但它是您无法轻松控制的产品之一。它唯一的内容管理系统，但不能非常灵活地用于实时应用程序开发。Sharepoint 设计器是最糟糕的东西之一，它会生成丑陋的 html 标签。它浪费时间学习 SharePoint。让我告诉你一个简单的例子：参考下面的帖子。

要执行一个简单的事情，你需要做一些 hacky 和便宜的技巧：

[点击这里查看小例子](https://sharepoint.stackexchange.com/questions/32045/display-list-item-when-a-field-is-not-empty)

如果我是你，我永远不会去！因为微软已经参与其中，所以他们大力营销，但效果并不好。

MVC 干净整洁，你可以用它开发健壮的应用程序。

# .net - 如果未安装 .NET，如何优雅地失败？

> ID：594302
> 
> 赞同：9
> 
> 时间：2009-02-27T10:54:01.330
> 
> 标签：.net

我最近问过[您是否可以从应用程序中检测是否安装了 .NET](https://stackoverflow.com/questions/594205/is-it-possible-to-know-if-net-framework-is-installed-from-a-net-application)（这样应用程序就不会因一般异常错误而崩溃）。

答案似乎是一个简单的“不”。如果没有安装.NET，我仍然希望能够正常退出，有什么办法吗？

请记住，我不想更改可执行文件的名称，这意味着可以让非托管可执行文件进行检查，让 dll 拥有真正的 .NET 程序但不必执行可执行文件。

**编辑：**我不是说安装程序失败，根本没有安装程序，只有可执行文件。当然，这种情况发生的可能性很小，但我仍然希望能够检查它。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-27T11:01:09.270

您有两种不同的选择：

*   编写一个小型本机代码加载器，用于检查运行时并在安装了运行时时执行您的软件。否则，它可能只会给用户一条错误消息，将他指向运行时的下载位置等。

或者

*   确保您的安装程序安装了运行时。[Joe Coehorn 在这篇文章](https://stackoverflow.com/questions/512452/-net-bootstrap-without-setup/512477#512477)中提到使用 MSI 很容易，您也应该能够使用其他安装程序，例如 InnoSetup。当然，如果有人先安装您的软件，然后重新安装 windows，然后尝试运行您的应用程序而不重新安装它，它就会崩溃。

当然，您可以将两者结合起来，以实现两全其美。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-27T11:01:16.493

您可以编写一个本机应用程序来检查 .Net 是否存在。然后，您需要使用 LoadLibrary 加载托管 dll 并在其中调用一个函数（GetProcAddress），该函数将启动您的 .Net 应用程序。

我想您还需要弄乱 .Net dll 以使您的主函数可见并可从非托管代码中调用。它被称为逆 PInvoke。

[http://www.autohotkey.com/forum/topic20273.html](http://www.autohotkey.com/forum/topic20273.html)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-27T11:02:02.467

您可以做的是在本机 Win32 C/C++ 中编写您的 .NET 检测代码，它会进行检测，显示一些用户友好的错误消息或任何您所指的优雅下降或调用 .NET dll（如果有适当的框架可用）。如果您不想拥有两个可执行文件，只需将 dll 的字节存储在您的本机可执行文件中并动态加载它。

请注意，这种方法完全不可能使用 Mono 运行您的应用程序。

* * *

## 回答 #4

> 赞同：-2
> 
> 时间：2009-02-27T10:57:01.200

只需提供一个未安装的漂亮消息框并提供下载即可。无论如何，大多数安装程序都会允许您这样做。

# ruby-on-rails - Rails 中的 SMTP 电子邮件错误

> ID：594309
> 
> 赞同：2
> 
> 时间：2009-02-27T10:57:15.707
> 
> 标签：ruby-on-rails, email, smtp

当 ActionMailer 尝试发送电子邮件时，我们的 Rails 应用程序出现了错误：

`Net::SMTPServerBusy - 451 Error while writing spool file`

我们使用我们自己的 SMTP 邮件服务器来发送。任何人都知道这方面的细节以及我们如何避免它在未来再次发生，或者如果发生错误，是否有可能让 ActionMailer 尝试发送电子邮件几次？

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-27T11:06:38.523

错误代码和错误描述表明这是邮件服务器上的错误。

我建议您检查邮件服务器以查明错误（可能是磁盘空间不足或类似情况）。

对于 ActionMailer，如果设置了配置参数，它应该引发异常`raise_delivery_errors`（我相信在生产中默认但在开发中没有），因此您可以检查该异常并尝试在它触发时重新发送。

# iphone - 在 cocos2d 中可以使用 UIPickerView 吗？

> ID：594311
> 
> 赞同：2
> 
> 时间：2009-02-27T10:58:33.847
> 
> 标签：iphone, objective-c, cocos2d-iphone

我正在使用 cocos2d 开发 iPhone 2d 游戏。我需要一个选择器。是否可以在 cocos2d 中使用 Picker ！如果可能的话，请告诉我，如何在 cocos2d 中使用 Picker？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-21T06:28:12.967

是的，您可以将基于标准 UIView 的类与 Cocos2D 类混合和匹配。

在您的应用程序委托中，当您启动 Director 时，您创建了一个 UIWindow 并将 Director 附加到它。您还可以在 appdelegate 中保存对窗口的引用。现在您可以创建 UIViews 并将其添加到 Window，以及像往常一样通过 director 操作 cocos2d 节点。

从这里开始，只需创建一个 UIPickerView 并将其添加到窗口中。配置 UIPickerView 本身就是一项完整的任务...... Nitrex88 有一个[关于这个主题的好视频](http://www.iphonedevcentral.org/tutorials.php?page=ViewTutorial&id=36&uid=48763428) 。此外，查看[UICatalog](http://www.iphonedevcentral.org/tutorials.php?page=ViewTutorial&id=36&uid=48763428)以获得一个可靠的示例，不仅是 UIPickerView，还有更多 UIView 子类。

这是一个向 cocos2d 应用程序添加一个简单的 UIPicker 的示例：

```
#import <Foundation/Foundation.h>
#import <UIKit/UIKit.h>
#import "cocos2d.h"

@interface AppDelegate {
    UIWindow *window;
    NSArray *pickerValues;
}
@property (nonatomic, retain) UIWindow window;
@property (nonatomic, retain) NSArray *pickerValues;
@end

@implementation AppDelegate
@synthesize window, pickerValues;

-(void)applicationDidFinishLaunching:(UIApplication *)application {

    // Create Window
    window = [[UIWindow alloc] initWithFrame:[[UIScreen mainScreen] bounds]];
    [window setUserInteractionEnabled:YES];
    [window setMultipleTouchEnabled:YES];

    // Set up Director and attach to window
    [[Director sharedDirector] attachInWindow:window];
    [[Director sharedDirector] setLandscape:YES];
    [[Director sharedDirector] runWithScene:[MyScene node]];

    // Create one large view and rotate the coordinates to landscape
    UIView *parentView = [[UIView alloc] initWithFrame:CGRectMake(0.0f,0.0f,480.0f, 320.0f)];
    parentView.transform = CGAffineTransformIdentity;
    parentView.transform = CGAffineTransformMakeRotation(degreesToRadian(90));
    parentView.bounds = CGRectMake(0.0f, 0.0f, 480.0f, 320.0f);

    // Initialize picker and its data source
    pickerValues = [[NSArray alloc] initWithObjects:@"0",@"1",@"2",@"3",@"4",@"5",@"6",@"7",@"8",@"9",nil];
    UIPickerView *pickerView = [[UIPickerView alloc] initWithFrame:CGRectMake(0.0f, 195.0f, 320.0f, 125.0f)];
    [pickerView setDelegate:self];

    // Attach picker to parent view and parent view to window
    [parentView addSubview:pickerView];
    [window addSubview:parentView]; 
    [window makeKeyAndVisible];
}

- (void) dealloc {
    [window release];
    [pickerValues release];
    [super dealloc];
}

// ====================
// UIPicker Callbacks
// ====================

// Fire when new picker values are selected
- (void)pickerView:(UIPickerView *)thePickerView didSelectRow:(NSInteger)row inComponent:(NSInteger)component {
    NSString *numberSequence = [NSString stringWithFormat:@"Sequence: %@%@%@",
                                [pickerValues objectAtIndex:[thePickerView selectedRowInComponent:0]],
                                [pickerValues objectAtIndex:[thePickerView selectedRowInComponent:1]],
                                [pickerValues objectAtIndex:[thePickerView selectedRowInComponent:2]]];

    NSLog(numberSequence);
}

// Number of picker wheels in the picker
- (NSInteger)numberOfComponentsInPickerView:(UIPickerView *)pickerView                          {
    return 3;
}

// Number of items in each picker wheel
- (NSInteger)pickerView:(UIPickerView *)pickerView numberOfRowsInComponent:(NSInteger)component {
    return [pickerValues count];
}

// Title for Row #
- (NSString *)pickerView:(UIPickerView *)pickerView titleForRow:(NSInteger)row forComponent:(NSInteger)component {
    return [pickerValues objectAtIndex:row]; 
}

// Row height in pixels
- (CGFloat)pickerView:(UIPickerView *)pickerView rowHeightForComponent:(NSInteger)component {
    return 40.0;
}

// Column width in pixels
- (CGFloat)pickerView:(UIPickerView *)pickerView widthForComponent:(NSInteger)component {
    return 90.0f;
}
// ====================

@end 
```

# php - PHP Embedded in Javascript

> ID：594317
> 
> 赞同：0
> 
> 时间：2009-02-27T10:59:56.683
> 
> 标签：php, javascript

in my project I have the situation like this.

```
<script language="JavaScript">
function fonsubmit()
{
    alert('Out side PHP');
    //Here the php code starts 
    include("customerpage.php");
    $cc="us";
    $clang="en";
    $cpath="us"; 
    some coding goes here......
    Php ends here
}
</script> 
```

But it shows Object expected error. What is wrong in this? But I give only PHP tag it won't generate any error. Please help me to find out this issue, thanks in advance...

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-02-27T11:09:01.437

You're trying to embed a server based language in a client-side based language. This will not work.

If you could explain a bit more what it is you're trying to achieve there might be a better solution, like AJAXie type thing.

Let me explain a bit more as others have given answers that could be put here.

You can have `php` embedded inside your *.php files which will be interpretted on the server and parsed there. Using this you can set variables which javascript could pick up on later and use on the client-side. Like I said though the client side doesn't have a route for intpretting and parsing `php` and so sending `php` across to the user is not going to work.

If you are however trying to get things working so that your php sets some javascript values then I would, like Gary Willough and Tudor Olariu both say, add the php tags

```
<?php
... PHP CODE...
?> 
```

However, you have to realise this will be interpretted on the server and not on the client. Therefore the following code would alert with "outside php" and then "inside php".

```
<script language="JavaScript">
function fonsubmit()
{
   alert('outside php');
   <?php
     $message = "inside php";
     echo "alert('$message');";
   ?>
}
</script> 
```

The html sent to the user would then be

```
<script language="JavaScript">
function fonsubmit()
{
   alert('outside php');
   alert('inside php');
}
</script> 
```

Hope this helps.

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-27T11:10:01.980

I don't know JavaScript, but JS is a *client-side* language, meaning it is evaluated in the web-browser as the user of your webpage views it. PHP is a *server-side* language, meaning that it is evaluated at the computer that hosts your webpage. Your browser can't evaluate PHP code. *All* PHP must be done at the server. You have to evaluate the PHP unconditionally, otherwise the PHP can't be evaluated at all. Then use JavaScript to pick what part of the PHP output you want to display - this will achieve the effect I think you want.

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-27T11:11:57.373

You are missing the php start and tags:

```
function fonsubmit() 
{ 
    alert('Out side PHP'); 
    //Here the php code starts 

    <?php
    include("customerpage.php"); 
    $cc="us"; 
    $clang="en"; 
    $cpath="us"; 
    //Php ends here 
    ?>
} 
```

Please be aware that your php code will be executed on the server, before your javascript kicks in

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-28T07:59:38.230

另一种方法是在 PHP 中显示 Javascript。不是将 PHP 放在 Javascript 中，而是将 Javascript 放在 PHP 中。例如，您可以这样做：

```
<?php
echo '<script language="JavaScript">
function fonsubmit()
{
   alert("outside php");
';

   // here is where you insert your PHP code
   include("customerpage.php");
   $cc="us";
   $clang="en";
   $cpath="us"; 

echo '
}
</script>';
?> 
```

诚然，回显 Javascript 逻辑并不好读。您还可以做的是通过回显它来指定 Javascript 的开头，

```
<?php
echo '<script language="JavaScript">';
?> 
```

然后正常插入您想要的Javascript。每当您想插入 PHP 代码时，请用 <?php ?> 标记将其包围。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-27T11:10:30.027

PHP should be enclosed in the proper php tags:

```
<?php include("customerpage.php"); $cc="us"; $clang="en"; $cpath="us"; ?> 
```

Make sure your page has the *.php extension and run on a server which has PHP installed.

# c - 分配给 const int *

> ID：594321
> 
> 赞同：2
> 
> 时间：2009-02-27T11:00:51.580
> 
> 标签：c, pointers, constants

```
void main()
{
const int * a;
*a = 5;
} 
```

gcc 错误：分配只读位置。

那么，如何在不使用其他变量的情况下分配给 *a？像上面这样的声明有什么用？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-02-27T11:08:35.307

```
const int * a; 
```

从右到左阅读声明。[见注释] 你得到什么？`a`是一个`*`即指向`int`整数`const`即常数的指针。简而言之，变量`a`指向一个您无法更改其值的整数。至少，不是通过`a`. 指针是否真的不可变是另一个问题。但事实仍然存在，您不能使用`a`修改`*a`;

`const`是你对自己的一个承诺：我永远不会尝试使用指向 const 的指针来修改指针。编译器只为您提供支持。

如果您**真的**想写入指针，则需要一个非常量指针，例如：

```
int *a;
*a = 42; /* this is fine */ 
```

[还有来自bortzmeyer](https://stackoverflow.com/users/15625/bortzmeyer)的一个非常好的评论：（我想我会跳过这个以保持简单:)

> 您也可以将 the 放在`const`后面`*`（如您所说，声明应从右到左阅读）。

他的意思是这样的：

```
const int *a; 
```

与

```
int const *a; 
```

（还记得，从右到左的阅读规则吗？）但是与以下有很大不同：

```
int * const p; 
```

阅读它，我们得到：`p`是一个`const`（-ant）`*`（指针）到`int`（-eger）。翻译：一旦你设置`p`为指向一个整数，你就不能重新安装它（即写入它以使其指向另一个整数 - 使`p`常量的点），但你可以写很多指针（指针不是持续的）。

**注意：**对于迂腐的人来说，这里是[Darron](https://stackoverflow.com/users/22704/darron)的“规则” ：

“声明应该从右到左阅读”是一种简化——如果有括号，它们应该从内到外阅读。除非括号表示函数调用。真正的规则是“把它当作一个表达式对待；如果我应用这些运算符，我最终会得到这个简单的类型”。

**如果不是bortzmeyer**和**Darron** ，这个答案真的会少很多肉——谢谢！

**PPS：（**我保证这将是最后一次编辑。好吧，希望如此！）

`void main()`不是 C 或 C++ 中 main 的标准签名。在您认识您之前不要使用它，或者（更重要的是）您的代码将永远不必前往另一个宇宙。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-27T11:13:34.047

一个说明 Ruben Bartelink 出色解释的例子：

```
#include <stdlib.h>

int main()
{
  int * const a = malloc(sizeof(int));
  if (a == NULL) 
    return 1;
  *a = 3;
  free(a);
  return 0;
} 
```

在这里， a 是常数（因此必须初始化），但不是 *a （可能是 OP 想要的）。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-27T11:38:48.867

让我把你的问题换成简单的英语。

*   如果我向编译器保证我不会写入变量a所指向的值，我该如何写入变量a所指向的值呢？

答案是：至少在本地更改承诺。

```
int main()
{
    const int * a;
    *((int *) a) = 5;
} 
```

希望上面的措辞清楚地表明这通常是一个坏主意。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-27T11:09:32.057

你的意思是`int * const`，不是`const int *`。在一种情况下，指针是 const，另一种情况下它指向的东西是 const。你也可以这样做`const int * const`。阅读一些关于 const_cast 的文章并没有什么坏处，它们应该很好地涵盖了这一点。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-27T11:04:41.633

这不是`const`你不能分配给它的重点吗？虽然，我不记得在 const 指针的情况下，它指向的值是否不能更改，或者指针的地址。或两者。我的猜测是两者都无法改变。

它也可能是您尝试写入未初始化内存的一般警告（或错误，取决于编译器设置）。

正确的是（我假设）：

```
void main()
{
   const int* a = new int(5);
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-27T11:25:44.173

不回答“如何在不使用另一个变量的情况下分配给 *a？” 但只有“像上面这样的声明有什么用途？”。

承诺不修改指向的值。正如评论中所讨论的，*如果*您对允许自己使用该结构的方式进行限制，您可能会得出它没有用的结论。但是，如果您允许自己使用整个 C 语言，那么您可以找到用途。想想原型之`strcmp`类的。

* * *

## 回答 #7

> 赞同：-2
> 
> 时间：2009-02-27T11:07:13.857

问题是您创建了一个指针，但它实际上并没有指向任何东西，所以当您取消引用它（或尝试写入其引用的位置）时，您会收到错误消息。

# c# - Implement Digest authentication via HttpWebRequest in C#

> ID：594323
> 
> 赞同：8
> 
> 时间：2009-02-27T11:01:15.853
> 
> 标签：c#, authentication, httpwebrequest, digest

Does anyone know how to screen scrape web-sites that use digest http authentication? I use code like this:

```
var request = (HttpWebRequest)WebRequest.Create(SiteUrl);
request.Credentials=new NetworkCredential(Login, Password) 
```

I'm able to access the site's mainpage, but when I try to surf to any other pages (using another request with the same credentials) I get "HTTP/1.1 400 Bad Request" error.

I used Fiddler to compare requests of my C# application with Mozilla Firefox requests.

2 URLs that I try to access are: [https://mysiteurl/forum/index.php](https://mysiteurl/forum/index.php) [https://mysiteurl/forum/viewforum.php?f=4&sid=d104363e563968b4e4c07e04f4a15203](https://mysiteurl/forum/viewforum.php?f=4&sid=d104363e563968b4e4c07e04f4a15203)

Here are 2 requests () of my C# app:

```
Authorization: Digest username="xxx",realm="abc",nonce="NXa26+NjBAA=747dfd1776c9d585bd388377ef3160f1ff265429",uri="/forum/index.php",algorithm="MD5",cnonce="89179bf17dd27785aa1c88ad976817c9",nc=00000001,qop="auth",response="3088821620d9cbbf71e775fddbacfb6d"

Authorization: Digest username="xxx",realm="abc",nonce="1h7T6+NjBAA=4fed4d804d0edcb54bf4c2f912246330d96afa76",uri="/forum/viewforum.php",algorithm="MD5",cnonce="bb990b0516a371549401c0289fbacc7c",nc=00000001,qop="auth",response="1ddb95a45fd7ea8dbefd37a2db705e3a" 
```

And that's what Firefox sending to the server:

```
Authorization: Digest username="xxx", realm="abc", nonce="T9ICNeRjBAA=4fbb28d42db044e182116ac27176e81d067a313c", uri="/forum/", algorithm=MD5, response="33f29dcc5d70b61be18eaddfca9bd601", qop=auth, nc=00000001, cnonce="ab96bbe39d8d776d"
Authorization: Digest username="xxx", realm="abc", nonce="T9ICNeRjBAA=4fbb28d42db044e182116ac27176e81d067a313c", uri="/forum/viewforum.php?f=4&sid=d104363e563968b4e4c07e04f4a15203", algorithm=MD5, response="a996dae9368a79d49f2f29ea7a327cd5", qop=auth, nc=00000002, cnonce="e233ae90908860e1" 
```

So in my app I have different values in "nonce" field while in Firefox this field is the same. On the other hand I have same values in "nc" field while Firefox increments this field.

Also when my app tries to access site pages in Fiddler i can see that it always gets response "HTTP/1.1 401 Authorization Required", while Firefox authorizes only once. I've tried to set request.PreAuthenticate = true; but it seems to have no effect...

My question is: how to properly implement digest authentication using C#? Are there any standard methods or do I have to do it from scratch? Thanks in advance.

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2012-11-21T19:39:11.797

创建一个类 Digest.cs

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Security.Cryptography;
using System.Text.RegularExpressions;
using System.Net;
using System.IO;

namespace NUI
{
    public class DigestAuthFixer
    {
        private static string _host;
        private static string _user;
        private static string _password;
        private static string _realm;
        private static string _nonce;
        private static string _qop;
        private static string _cnonce;
        private static DateTime _cnonceDate;
        private static int _nc;

        public DigestAuthFixer(string host, string user, string password)
        {
            // TODO: Complete member initialization
            _host = host;
            _user = user;
            _password = password;
        }

        private string CalculateMd5Hash(
            string input)
        {
            var inputBytes = Encoding.ASCII.GetBytes(input);
            var hash = MD5.Create().ComputeHash(inputBytes);
            var sb = new StringBuilder();
            foreach (var b in hash)
                sb.Append(b.ToString("x2"));
            return sb.ToString();
        }

        private string GrabHeaderVar(
            string varName,
            string header)
        {
            var regHeader = new Regex(string.Format(@"{0}=""([^""]*)""", varName));
            var matchHeader = regHeader.Match(header);
            if (matchHeader.Success)
                return matchHeader.Groups[1].Value;
            throw new ApplicationException(string.Format("Header {0} not found", varName));
        }

        private string GetDigestHeader(
            string dir)
        {
            _nc = _nc + 1;

            var ha1 = CalculateMd5Hash(string.Format("{0}:{1}:{2}", _user, _realm, _password));
            var ha2 = CalculateMd5Hash(string.Format("{0}:{1}", "GET", dir));
            var digestResponse =
                CalculateMd5Hash(string.Format("{0}:{1}:{2:00000000}:{3}:{4}:{5}", ha1, _nonce, _nc, _cnonce, _qop, ha2));

            return string.Format("Digest username=\"{0}\", realm=\"{1}\", nonce=\"{2}\", uri=\"{3}\", " +
                "algorithm=MD5, response=\"{4}\", qop={5}, nc={6:00000000}, cnonce=\"{7}\"",
                _user, _realm, _nonce, dir, digestResponse, _qop, _nc, _cnonce);
        }

        public string GrabResponse(
            string dir)
        {
            var url = _host + dir;
            var uri = new Uri(url);

            var request = (HttpWebRequest)WebRequest.Create(uri);

            // If we've got a recent Auth header, re-use it!
            if (!string.IsNullOrEmpty(_cnonce) &&
                DateTime.Now.Subtract(_cnonceDate).TotalHours < 1.0)
            {
                request.Headers.Add("Authorization", GetDigestHeader(dir));
            }

            HttpWebResponse response;
            try
            {
                response = (HttpWebResponse)request.GetResponse();
            }
            catch (WebException ex)
            {
                // Try to fix a 401 exception by adding a Authorization header
                if (ex.Response == null || ((HttpWebResponse)ex.Response).StatusCode != HttpStatusCode.Unauthorized)
                    throw;

                var wwwAuthenticateHeader = ex.Response.Headers["WWW-Authenticate"];
                _realm = GrabHeaderVar("realm", wwwAuthenticateHeader);
                _nonce = GrabHeaderVar("nonce", wwwAuthenticateHeader);
                _qop = GrabHeaderVar("qop", wwwAuthenticateHeader);

                _nc = 0;
                _cnonce = new Random().Next(123400, 9999999).ToString();
                _cnonceDate = DateTime.Now;

                var request2 = (HttpWebRequest)WebRequest.Create(uri);
                request2.Headers.Add("Authorization", GetDigestHeader(dir));
                response = (HttpWebResponse)request2.GetResponse();
            }
            var reader = new StreamReader(response.GetResponseStream());
            return reader.ReadToEnd();
        }
    }
} 
```

现在在您的应用程序中，您可以使用以下代码：

```
DigestAuthFixer digest = new DigestAuthFixer(url, username, password);
string strReturn = digest.GrabResponse(url); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-07-03T18:26:04.163

我目前正在观察同样的问题，尽管我正在测试的 Web 服务器是我自己的。服务器日志显示：

```
Digest: uri mismatch - </var/path/some.jpg> does not match request-uri
        </var/path/some.jpg?parameter=123456789> 
```

我尝试从 URL 中删除参数（因为这似乎有所不同），但错误仍然像以前一样发生。

我的结论是 URL 参数也必须包含在摘要哈希中，并且`HttpWebRequest`出于某种原因将其删除。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2021-04-28T04:18:19.850

在 @kitwalker 的出色工作的基础上，这是我为 DotNetCore 3 编写的委托处理程序。

```
 /// <summary>
    /// Respond to a Digest auth challenge and retry the request.
    /// See <c>https://en.wikipedia.org/wiki/Digest_access_authentication</c>.
    /// </summary>
    /// <example>
    /// Example response header with challenge details:
    /// header: www-authenticate
    /// value: <c>Digest realm="Signaling Controller", charset="UTF-8", algorithm=MD5, nonce="6088c71a:a699df7b2e03c53cfe06f8d070f4345c", qop="auth"</c>
    /// </example>
    public class DigestAuthenticationHandler : DelegatingHandler
    {
        private readonly ILogger _logger;
        private readonly CredentialSettings _settings;

        public DigestAuthenticationHandler(ILogger<DigestAuthenticationHandler> logger, CredentialSettings settings)
        {
            _logger = logger;
            _settings = settings;
        }

        protected override async Task<HttpResponseMessage> SendAsync(HttpRequestMessage request,
            CancellationToken cancellationToken)
        {
            var username = _settings?.Username;
            var password = _settings?.Password;

            if (string.IsNullOrEmpty(username))
            {
                throw new ArgumentNullException(nameof(username), "Missing credentials.");
            }

            if (string.IsNullOrEmpty(password))
            {
                throw new ArgumentNullException(nameof(password), "Missing credentials.");
            }

            var response = await base.SendAsync(request, cancellationToken);

            if (response.StatusCode == HttpStatusCode.Unauthorized)
            {
                var header = response.Headers.WwwAuthenticate;
                var value = header.FirstOrDefault();

                _logger.LogDebug("Challenged with scheme: '{Scheme}'", value?.Scheme ?? "(unknown)");

                if (string.Compare(value?.Scheme, "Digest", StringComparison.OrdinalIgnoreCase) != 0)
                {
                    _logger.LogDebug("Authentication challenge is not of type 'Digest' - give up");
                    return response;
                }

                var details = new DigestAuthenticationDetails(value?.Parameter);

                _logger.LogDebug("Authentication challenge details: {Details}", details);

                var qop = details["qop"];
                var realm = details["realm"];
                var nonce = details["nonce"];
                var algorithm = details["algorithm"];

                if (algorithm != "MD5")
                {
                    _logger.LogError("Algorithm '{Algorithm}' unsupported; cannot respond to Digest auth challenge - give up", algorithm);
                    return response;
                }

                var cnonce = new Random().Next(123400, 9999999).ToString();
                var nc = 1;

                var uri = request.RequestUri.PathAndQuery;

                var digest = BuildDigestHeader(username, password, request.Method, uri, realm, algorithm, nonce, cnonce, qop, nc);

                request.Headers.Add("Authorization", digest);

                var retry = await base.SendAsync(request, cancellationToken);

                return retry;
            }

            return response;
        }

        private static string BuildDigestHeader(
            string username,
            string password,
            HttpMethod method,
            string uri,
            string realm,
            string algorithm,
            string nonce,
            string cnonce,
            string qop,
            int nc)
        {
            static string CalculateMd5Hash(string input)
            {
                var bytes = Encoding.ASCII.GetBytes(input);
                var hash = MD5.Create().ComputeHash(bytes);
                var builder = new StringBuilder();

                foreach (var b in hash)
                {
                    builder.Append(b.ToString("x2"));
                }

                return builder.ToString();
            }

            var ha1 = CalculateMd5Hash($"{username}:{realm}:{password}");
            var ha2 = CalculateMd5Hash($"{method}:{uri}");
            var digestResponse = CalculateMd5Hash($"{ha1}:{nonce}:{nc:00000000}:{cnonce}:{qop}:{ha2}");

            return "Digest "
                   + $"username=\"{username}\", "
                   + $"realm=\"{realm}\", "
                   + $"nonce=\"{nonce}\", "
                   + $"uri=\"{uri}\", "
                   + $"algorithm=\"{algorithm}\", "
                   + $"response=\"{digestResponse}\", "
                   + $"qop={qop}, "
                   + $"nc={nc:00000000}, "
                   + $"cnonce=\"{cnonce}\"";
        }

        private class DigestAuthenticationDetails
        {
            private readonly Dictionary<string, string?> _values;

            public DigestAuthenticationDetails(string? authentication)
            {
                _values = new Dictionary<string, string?>();

                if (authentication != null)
                {
                    foreach (var pair in authentication.Split(","))
                    {
                        var item = pair.Split("=");

                        string? key = null;
                        string? value = null;

                        if (item.Length == 1)
                        {
                            key = item.ElementAt(0);

                        }
                        else
                        {
                            key = item.ElementAt(0);
                            value = item.ElementAt(1);
                        }

                        key = key
                            .Trim()
                            .Replace("\"", "")
                            .Replace("'", "")
                            .ToLower();

                        value = value
                            ?.Trim()
                            .Replace("\"", "")
                            .Replace("'", "");

                        _values.Add(key, value);
                    }
                }
            }

            public string this[string key] => GetValueOrThrow(key);

            public override string ToString()
            {
                var builder = new StringBuilder();

                foreach (var (key, value) in _values)
                {
                    builder.Append($"'{key}'='{value}' ");
                }

                return builder.ToString();
            }

            private string GetValueOrThrow(string key)
            {
                if (_values.TryGetValue(key, out var value))
                {
                    if (value != null)
                    {
                        return value;
                    }

                    throw new ArgumentNullException(nameof(value), $"No value for key '{key}'.");
                }

                throw new ArgumentOutOfRangeException(nameof(key), $"Key '{key}' was not found in Digest auth challenge.");
            }
        }
    } 
```

然后，无论您在哪里注册服务，都将委托处理程序添加到`HttpClient`需要摘要身份验证功能的地方：

```
services.AddTransient<DigestAuthenticationHandler>();
services.AddHttpClient<ServiceThatNeedsHttpClient>()
    .AddHttpMessageHandler<DigestAuthenticationHandler>(); 
```

注意：不支持缓存之前使用的摘要标头。

# javascript - Input field value - remove leading zeros

> ID：594325
> 
> 赞同：47
> 
> 时间：2009-02-27T11:01:38.490
> 
> 标签：javascript, leading-zero

I have a textbox in Javascript. When I enter `'0000.00'` in the textbox, I want to know how to convert that to only having one leading zero, such as `'0.00'`.

* * *

## 回答 #1

> 赞同：54
> 
> 时间：2009-08-12T09:45:21.993

更简化的解决方案如下。看一下这个！

```
var resultString = document.getElementById("theTextBoxInQuestion")
                           .value
                           .replace(/^[0]+/g,""); 
```

* * *

## 回答 #2

> 赞同：35
> 
> 时间：2012-12-24T20:17:38.657

```
str.replace(/^0+(?!\.|$)/, '')

  '0000.00' --> '0.00'   
     '0.00' --> '0.00'   
  '00123.0' --> '123.0'   
        '0' --> '0' 
```

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2009-02-27T11:15:49.423

```
var value= document.getElementById("theTextBoxInQuestion").value;
var number= parseFloat(value).toFixed(2); 
```

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2009-02-27T11:17:50.760

It sounds like you just want to remove leading zeros unless there's only one left ("0" for an integer or "0.xxx" for a float, where x can be anything).

This should be good for a first cut:

```
while (s.charAt(0) == '0') {            # Assume we remove all leading zeros
    if (s.length == 1) { break };       # But not final one.
    if (s.charAt(1) == '.') { break };  # Nor one followed by '.'
    s = s.substr(1, s.length-1)
} 
```

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2013-06-05T16:08:45.967

Ok a simple solution. The only problem is when the string is "0000.00" result in plain 0\. But beside that I think is a cool solution.

```
var i = "0000.12";
var integer = i*1; //here's is the trick...
console.log(i); //0000.12
console.log(integer);//0.12 
```

For some cases I think this can work...

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2011-11-26T05:23:00.673

您可以使用以下代码：

```
<script language="JavaScript" type="text/javascript">
<!--
function trimNumber(s) {
  while (s.substr(0,1) == '0' && s.length>1) { s = s.substr(1,9999); }
  return s;
}

var s1 = '00123';
var s2 = '000assa';
var s3 = 'assa34300';
var s4 = 'ssa';
var s5 = '121212000';

alert(s1 + '=' + trimNumber(s1));
alert(s2 + '=' + trimNumber(s2));
alert(s3 + '=' + trimNumber(s3));
alert(s4 + '=' + trimNumber(s4));
alert(s5 + '=' + trimNumber(s5));
// end hiding contents -->
</script> 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-02-27T11:15:30.937

Try this:

```
<input type="text" onblur="this.value=this.value.replace(/^0+(?=\d\.)/, '')"> 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2018-10-17T13:11:45.283

您可以使用正则表达式将前导零替换为一个：

```
valueString.replace(/^(-)?0+(0\.|\d)/, '$1$2')

>'-000.0050'.replace(/^(-)?0+(0\.|\d)/, '$1$2')
< "-0.0050"
>'-0010050'.replace(/^(-)?0+(0\.|\d)/, '$1$2')
< "-10050" 
```

火柴：`<beginning of text><optional minus sign><any sequence of zeroes><either a zero before the dot or another digit>`

替换为：`<same sign if available><the part of the string after the sequence of zeroes>`

*   ^ 是文本的开头

*   ? 表示可选（指前一个字符）

*   (a|b) 表示 a 或 b

*   . 是点（转义为 . 有特殊含义）

*   \d 是任何数字

*   $1 表示你在第一组 () 中找到的

*   $2 表示你在第二组 () 中找到的

# c# - Define backgroundworker's RunWorkerCompleted with an anonymous method?

> ID：594329
> 
> 赞同：2
> 
> 时间：2009-02-27T11:03:06.707
> 
> 标签：c#, multithreading, lambda

I Hope I used the right term

What I'm aiming for is something like this (I realise it doesn't work that way):

```
private bool someBool = false;

BackgroundWorker bg = new BackgroundWorker();
bg.DoWork += new DoWorkEventHandler(DoLengthyTask);
bg.RunWorkerCompleted += new RunWorkerCompletedEventHandler(
    ()=>
        {
            someBool = true;
            Logger.Info("Finished");
        }
) 
```

The important part being the RunWorkerCompletedEventHandler being defined within the scope of the original caller and by that having access to the caller's variables.

Is this possible? Would it generate possible race conditions on the someBool?

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-27T11:10:53.023

It doesn't work in your example, since the complete delegate should receive 2 parameters:

```
private bool someBool = false;

BackgroundWorker bg = new BackgroundWorker();
bg.DoWork += new DoWorkEventHandler(DoLengthyTask);
bg.RunWorkerCompleted += new RunWorkerCompletedEventHandler(
        (sender, e)=>
                {
                        someBool = true;
                        Logger.Info("Finished");
                }
) 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-27T11:17:30.260

It all depends on what else uses the bool.

In particular, it the bool truly a field (as suggested by the "private"), or is it a variable? There is a difference, as you can mark a field as `volatile` (but not a variable).

However, my gut feel is that you should be using synchronization such as `Monitor`, perhaps with pulsing etc - or a gate such as `ManualResetEvent`.

Without either synchronization or `volatile`, [it is possible](https://stackoverflow.com/questions/458173/can-a-c-thread-really-cache-a-value-and-ignore-changes-to-that-value-on-other-th/458193#458193) for another thread to not see changes to the variable - but we really can't say more without the other half of the code...

# smtp - 对 SMTP 消息 ID 的限制？

> ID：594330
> 
> 赞同：9
> 
> 时间：2009-02-27T11:03:15.117
> 
> 标签：smtp

SMTP 消息 ID 的长度和/或格式是否有限制？即：它们可能有多长，并且只允许使用某些字符？（我打算只使用 ASCII，但我担心甚至可能存在不允许的 ASCII 字符。）

RFC822 定义了这一点，但是是否应该考虑更新的 RFC 或常见的现实世界方面（例如邮件软件中的常见错误）？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-27T11:24:29.307

更新后的 RFC 为 RFC2822。

至于允许的字符，它基本上

```
::alpha::|::digit::|[!#$%&'*+-/=?^_`{}|~.] 
```

（也可以引用文字）。

它必须包含@分隔“本地部分”和“域部分”。它**必须**是**全球**唯一的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-02-03T02:22:17.223

如果您正在寻找示例，您可以查看[email.utils.make_msgid](http://docs.python.org/library/email.util.html) Python 库函数的代码。

# iphone - UIWebView 和 PDF 文件的滚动和缩放滞后

> ID：594331
> 
> 赞同：0
> 
> 时间：2009-02-27T11:03:22.870
> 
> 标签：iphone, objective-c, uiwebview

我正在使用 UIWebView 加载一个相对较小的 PDF 文件（140kb），即使这工作正常，我发现它在滚动和缩放时滞后很多。PDF是一张地图，所以上面有很多文字和线条，所以我想知道是否有任何方法可以以某种方式加速它，让一切变得更顺畅？转换为PNG会更好吗？它更流畅，但转换后 140kb PDF 变为 1.2mb，所以我不知道这是否是一个好的解决方案。

任何意见，将不胜感激。

谢谢

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-27T15:22:36.380

如果您将有问题的PDF通过电子邮件发送给自己，然后在Mail中将其作为附件查看，性能是否相似？

如果是这样，那可能只是 CPU 渲染速度的限制。一旦你在它身上投入了大量的图形复杂性，iPhone 的速度就会急剧下降。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-27T17:37:56.633

您可以通过使用 CATiledLayer 渲染 PDF 地图来提高设备的性能。Bill Dudney 有一些[示例代码](http://bill.dudney.net/roller/objc/entry/catiledlayer_example)可以做到这一点，尽管是在 Mac 上。他的[iPhone 版本](http://bill.dudney.net/roller/objc/entry/tiledlayer_on_the_iphone)的相同代码不适用于地图，但移植其中的例程来做到这一点将是微不足道的。

# sockets - 我在 Windows Server 2003 中可以拥有的打开套接字数量的上限是多少

> ID：594336
> 
> 赞同：2
> 
> 时间：2009-02-27T11:05:55.297
> 
> 标签：sockets, networking, .net-3.5, windows-server-2003

我正在用.NET 构建一个聊天服务器。我尝试打开大约 2000 个客户端连接，但我的 Linksys WRT54GL 路由器（带有番茄固件）每次都掉线。当我在 Azureus bit-torrent 客户端上打开多个连接时，也会发生同样的事情。

我有三个问题：

1.  我在 Windows Server 2003 中可以拥有的打开套接字的数量是否有限制？
2.  Linksys路由器有问题吗？如果是这样，有更好的硬件推荐吗？
3.  有没有办法共享套接字，以便我可以用更少的资源处理更多开放的客户端连接？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-27T11:14:09.003

正如我之前提到的，[Raymond Chen](http://blogs.msdn.com/oldnewthing/)对这类问题有很好的建议：如果您必须询问操作系统限制，您可能做错了什么。IP 协议只允许最多 65535 个端口，其中许多是保留的，不能用于一般用途。我建议您需要更详细地考虑您的消息传递协议，以免操作系统限制成为问题。我敢肯定有很多很好的资源来描述这样的系统，而且这里肯定有人会有很好的想法。

编辑：我将提出一些关于实现可扩展聊天服务器的想法。

首先，在服务器上指定一个端口供客户端进行通信。每当客户端需要更新聊天状态（例如新的用户消息）时，请执行以下操作：

```
create message packet
open port to server
send packet
close port 
```

然后服务器执行以下操作：

```
connection request received
get packet
close connection
process packet
for each client that requires updating
  open connection to clients
  send update packet
  close connection 
```

当开始新的聊天会话时，开始会话的客户端会向服务器发送一条“新会话”消息，其中包含客户端用户详细信息和 IP 地址以进行响应。服务器创建一个新的聊天会话并使用会话 ID 进行响应。然后客户端发送包含用户键入的消息的数据包，服务器处理它们并将消息转发给同一会话中的其他客户端。当客户端离开聊天时，它会向服务器发送“结束会话”消息。服务器从会话中删除客户端并在会话中没有更多客户端时销毁会话。

希望这能让你思考。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-11T13:37:39.043

我找到了一些我觉得我应该分享的答案：

Windows 2003 服务器对可以使用的端口数有限制。但这可以通过注册表调整来配置，将 MaxUSerPort 设置从 5000 更改为 64k（最大值）。

进一步探索，我意识到 64k 端口限制实际上是每个 IP 地址，因此单个服务器可以轻松获得更多端口，因此通过安装多个网卡或将多个 IP 地址绑定到网卡来实现 TCP 连接。这样，您可以扩展您的系统以处理 nx 64k 端口。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2013-05-20T13:36:38.653

几天来，我的 Window 7 机器上的可用套接字出现问题。在阅读了一些关于 Win 7 中套接字泄漏的文章后，我应用了一个[Windows 补丁](http://support.microsoft.com/kb/2577795)- 没有任何改变。

下面有一篇文章非常详细地描述了windows连接问题： [http ://technet.microsoft.com/en-us/magazine/2007.12.network.aspx](http://technet.microsoft.com/en-us/magazine/2007.12.network.aspx)

对我来说，它的工作原理如下：

1.  打开注册表
2.  *   HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\services\Tcpip\Parameters：创建TcpNumConnections，REG_DWORD，十进制值500（这个可以根据自己的需要设置）；EnableConnectionRateLimiting，REG_DWORD，值 0；
    *   HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\services\Tcpip：创建MaxUserPort，REG_DWORD，十进制值65534
3.  重新启动 Windows

# jquery - 当用户将鼠标悬停在另一个表格的单元格上时，如何显示数据表格？

> ID：594357
> 
> 赞同：0
> 
> 时间：2009-02-27T11:11:37.247
> 
> 标签：jquery, html

我需要从对象列表中生成一个表。每行将仅包含每个对象的基本信息。但是，当用户将鼠标悬停在特定单元格上时，我希望出现一个包含该特定对象的所有信息的弹出窗口。也许弹出窗口应该是包含某种所有细节的表格的形式？我该如何做到这一点？我也可以使用带有一些效果的 JQuery 吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-27T11:37:45.500

我对这种事情使用[jQuery 工具提示。](http://bassistance.de/jquery-plugins/jquery-plugin-tooltip/)您可以使用 bodyHandler 选项执行 Javascript 来填充工具提示窗格，您可以任意设置样式。请参阅示例。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-27T11:49:06.143

是的，jQuery 非常适合这类事情。

有（至少）两种方法可以做到：

1.  预填充和隐藏 (CSS)：在 HTML 页面上构建可见单元格内的所有弹出详细信息表，使用 CSS 将它们定位在主层“上方”（和单元格外），并使用`display:none`, 并添加 a`.maincell:hover .detailtable { display:block;}`来制作它们当光标在主单元格中时可见。

2.  AJAX：将函数绑定到每个主单元格的`"mouseenter"`/`"mouseleave"`事件，在那里您使用 AJAX 从服务器获取详细信息表并显示在定位的位置`<div>`，最好是在固定位置，或者可能是光标右侧的几个像素（如果这是一张小桌子）。jQuery 的`$("#inspector").load(dataURL)`函数使它变得非常容易（其中“inspector”是`<div>`您插入详细信息表的位置的 ID）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-27T11:13:19.333

是的你可以。您可以使用[http://dev.iceburg.net/jquery/jqModal/](http://dev.iceburg.net/jquery/jqModal/)来完成此操作。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-27T11:27:24.963

绑定鼠标悬停事件侦听器 - 这样当它们悬停在预期元素上时，您的回调将被调用。在回调中，您可以访问触发事件的元素 - 在您的情况下为 td 或 tr - 使用适当的 jquery 选择器获取整行的内容。然后你可以显示一个对话框，现在你有了可以在对话框中显示的内容。

# c# - C# How do I do I replace EventLogEntryType with a value from a comboBox?

> ID：594370
> 
> 赞同：0
> 
> 时间：2009-02-27T11:16:31.637
> 
> 标签：c#

In the code below I want to replace EventLogEntryType.Warning with a value selected from a combo box, the combobox values are EventLogEntryType.Warning, EventLogEntryType.Information, EventLogEntryType.Error. The combo box would just show "Warning", "Information" and "Error". How can I do this?

Thanks

```
EventLog myLog = new EventLog(); myLog.Source = "Test";             
int intEventID = int.Parse(txtEventID.Text);            
myLog.WriteEntry(txtDescription.Text, EventLogEntryType.Warning, intEventID); 
```

Newbie

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-27T11:27:23.997

假设 EventLogEntryType 是一个枚举并且您不需要本地化，您可以很容易地做到这一点。

在 Form_Load

```
 combobox1.Items.Add(EventLogEntryType.Warning);
   combobox1.Items.Add(EventLogEntryType.Information);
   ... 
```

然后

```
 myLog.WriteEntry(txtDescription.Text, (EventLogEntryType)combobox1.Selecteditem, intEventID); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-03-16T16:09:29.133

您可以使用`Enum.Parse`将组合框中的值转换为您的枚举：

```
var sv = yourComboBox.SelectedValue;
var entryType = (EventLogEntryType) Enum.Parse(typeof(EventLogEntryType), sv); 
```

# mfc - 如何使 MDI 子窗口保持在其兄弟窗口之上？

> ID：594375
> 
> 赞同：1
> 
> 时间：2009-02-27T11:17:16.627
> 
> 标签：mfc, visual-c++-6, mdi, always-on-top

这个问题与[我之前的问题有关。](https://stackoverflow.com/questions/591508/user-interface-best-way-to-toggle-mdi-frames-on-top-status)

我有一个 MFC (VC6) MDI 应用程序，它有几个 MDI 子窗口充当一个文档的不同视图。

是否可以将其中一个框架设置在其他框架之上？
我试过打电话

```
SetWindowPos(
   &GetParentFrame()->wndTopMost,
   0, 0, 0, 0,
   SWP_NOMOVE | SWP_NOSIZE); 
```

和

```
ModifyStyleEx(0, WS_EX_TOPMOST); 
```

来自 CMDIChildWnd 但似乎都不起作用。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-27T15:27:01.160

在您的 CMDIChildWnd 类（通常是 CChildFrame）中，添加一个静态`HWND m_hTopWnd`. 将其设置为您希望始终位于顶部的孩子的 HWND。

办理。`WM_WINDOWPOSCHANGED`_ `CChildFrame`在处理程序中，检查当前的`m_hWnd == m_hTopWnd`. 如果没有，请致电

```
::SetWindowPos(m_hTopWnd, HWND_TOP, 0, 0, 0, 0, 
    SWP_NOACTIVATE | SWP_NOMOVE | SWP_NOSIZE); 
```

这样，每当设置任何 MDI 子窗口的位置时，“始终位于顶部”的窗口都会被推回顶部。

还要处理`WM_CLOSE`和关闭顶部窗口时，设置 m_hTopWnd = NULL。

另请参阅：[CodeProject 文章](http://www.codeproject.com/KB/docview/mfc_mdi_top_most.aspx)和[MSDN 知识库](http://support.microsoft.com/kb/108315)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-28T13:09:41.107

您确定将子窗口置于其他窗口之上是一种好的 UI 设计吗？这不应该成为一个单独的最顶层框架吗？还是控制栏？

# c# - Lance Hunt 的 C# 编码标准 - 枚举混淆

> ID：594378
> 
> 赞同：15
> 
> 时间：2009-02-27T11:17:43.613
> 
> 标签：c#, .net, coding-style

我的团队最近开始使用[Lance Hunt 的 C# 编码标准](http://weblogs.asp.net/lhunt/pages/CSharp-Coding-Standards-document.aspx)文档作为整合我们编码标准的起点。

有一个项目我们只是不明白重点，这里有人可以解释一下吗？

项目编号为 77：

> *始终在使用枚举变量或参数值之前对其进行验证。它们可能包含基础 Enum 类型（默认 int）支持的任何值。*
> 
> *例子：*
> 
> ```
> public void Test(BookCategory cat)
> {
> if (Enum.IsDefined(typeof(BookCategory), cat))
> {…}
> } 
> ```

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-02-27T11:22:19.017

关键是您可能希望通过拥有 BookCategory 类型的参数，您将始终拥有一个*有意义的*图书类别。事实并非如此。我可以打电话：

```
BookCategory weirdCategory = (BookCategory) 123456;
Test(weirdCategory); 
```

如果枚举旨在表示一组众所周知的值，则不应期望代码明智地处理该众所周知的集合之外的值。测试首先检查参数是否合适。

不过，我个人会颠倒逻辑：

```
public void Test(BookCategory cat)
{
    if (!Enum.IsDefined(typeof(BookCategory), cat))
    {
        throw new ArgumentOutOfRangeException("cat");
    }
} 
```

在 C# 3 中，这可以通过扩展方法轻松完成：

```
// Can't constrain T to be an enum, unfortunately. This will have to do :)
public static void ThrowIfNotDefined<T>(this T value, string name) where T : struct
{
    if (!Enum.IsDefined(typeof(T), value))
    {
        throw new ArgumentOutOfRangeException(name);
    }
} 
```

用法：

```
public void Test(BookCategory cat)
{
    cat.ThrowIfNotDefined("cat");
} 
```

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2009-02-27T11:21:12.437

不检查枚举：

```
enum Foo { A= 1, B = 2, C = 3}
Foo x = (Foo) 27; // works fine 
```

现在你有一个`Foo`未定义的。他只是说“检查你的输入”。请注意，`Enum.IsDefined`相对较慢（基于反射）。就个人而言，我倾向于使用带有 a 的开关`default`来引发异常：

```
switch(x) {
    case Foo.A: /* do something */ break;
    case Foo.B: /* do something */ break;
    case Foo.C: /* do something */ break;
    default: throw new ArgumentOutOfRangeException("x");
} 
```

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2009-02-27T17:35:18.840

我认为上面的评论几乎回答了这个问题。本质上，当我编写这条规则时，我试图传达一种验证所有输入的防御性编码实践。枚举是一种特殊情况，因为许多开发人员错误地认为它们已经过验证，而实际上并没有。因此，您经常会看到语句或 switch 语句是否因未定义的枚举值而失败。

请记住，默认情况下，枚举只不过是一个 INT 的包装器，并且就像它是一个 int 一样验证它。

有关正确使用枚举的更详细讨论，您可以查看 Brad Abrams 和 Krzysztof Cwalina 的博客文章或他们的优秀书籍“框架设计指南：可重用 .NET 库的约定、成语和模式”

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-27T11:21:46.303

这是因为像这样调用“测试”方法是完全合法的：

```
Test((BookCategory)-999); 
```

这会将 -999 转换为 BookCategory，但结果（作为“cat”参数传递给 Test）当然不是 BookCategory 枚举的有效值。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-27T11:59:29.537

如果您想在库的未来版本中使用新值扩展您的枚举，则不应使用该构造

if (Enum.IsDefined(typeof(BookCategory), cat))

因为这仅根据枚举定义测试类型是否有效。另一方面，您的代码仅针对当前允许的值进行了测试，并且可能会因新值而失败。

有关更多背景信息，请参阅[此博客文章](http://blogs.msdn.com/brada/archive/2003/11/29/50903.aspx)。

# jquery - 用于 JSP、Java 后端的 jquery/GWT？

> ID：594385
> 
> 赞同：2
> 
> 时间：2009-02-27T11:20:14.903
> 
> 标签：jquery, gwt

如果您有 JSP、Java 后端，哪种前端工具/框架适合/实用？

jQuery 还是 GWT？

只是感到困惑。我的一些 jquery ajax 调用不会在前端输出响应。

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-27T11:36:25.300

GWT 可以帮助您建立前端网站，也可以建立后端服务。例如，您使用 GWT 构建了一个 Web 小部件，该小部件对 GWT 服务进行 AJAX 调用。GWT 的输出是前端的 javascript、HTML 和 CSS，当然你可以利用 GWT 中的一些 JQuery 功能，它可以在 Java 中实现为本地方法。对于 AJAX，GWT 已经拥有一组特性，可以让您对后端进行高效调用。如果您使用 GWT 服务构建后端，这将提供最佳性能。另一方面，您也可以使用 GWT 调用 JSP 构建的服务，没有任何问题。

对于 JSP，我会坚持使用 JQuery，因为这两者是真正独立的，就像 JQuery 到 PHP。相比之下，GWT 在两端做了更多的集成，它封装了一些你可能想自己学习的东西。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-27T11:28:54.633

对我来说，GWT 更适合“应用程序”，这意味着它们是一页的。真的很喜欢GMail。它不适用于页面转换（恕我直言）。

[我写了一些关于为什么 Google Web Toolkit 没有更受欢迎的](https://stackoverflow.com/questions/523728/why-isnt-google-web-toolkit-more-popular/523759#523759)想法？

我是 jQuery 的忠实粉丝。我真的很喜欢使用 jQuery 可以获得的快速周转（相对于**慢速**GWT 编译）。

尽管不了解您的要求和正在开发的具体内容，但很难给您任何特别的建议。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-01T13:10:09.303

这实际上取决于前端的复杂程度——以及后端数据传输到前端的好坏程度。

对我来说，如果你有一个基于 jsp 的应用程序，看起来会有很多页面转换，因此 gwt 不像 jquery 那样适合。

话虽如此，也许可以不使用页面转换，而是使用 gwt 使应用程序成为单个整体页面。这样，您可能会使用户体验更好。这真的取决于应用程序。如果您提供了有关应用程序性质的更多信息，则可以给出更好的答案。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-01-24T21:47:05.507

我最近一直在思考这个问题，所以我提出我的想法：

GWT 最适合具有复杂 UI 逻辑的 Web 应用程序。如果您想以最少的交互显示一个简单的几页网站，则不需要它。因为 GWT 太过分了，所以使用一些基本的 jQuery。

但是，**如果您需要非常高的 UI 复杂性**，那么编写所有 JS、对其进行单元测试并针对浏览器进行优化是一个主要的 PITA。GWT 的严格类型和编译将使您免于调试噩梦，其中一些您从未想过可能会咬住您的 JS 类型强制。当然，您可以使用 GWT C++->Java->JS 转换在浏览器中运行 Quake 之类的事情，如果没有 GWT，这将是不可能的。

如前所述，**GWT 的编译时间随站点的大小而变化**。如果你想要 100 个屏幕和 20 个浏览器排列，构建整个东西需要一段时间，所以把它分成几个项目。使用这种方法和**Super DevMode**，您可以在几秒钟内重建。

最后一点：复杂的 JSP 站点也可能是一大痛苦。我参与过那些 500 多个 xml/jsp 文件也是一场噩梦的项目，所以无论你做什么，都要为复杂性做好计划，因为它确实限制了 Web 应用程序。

# c++ - ActiveX 属性（要从 Visual Basic 访问）可以在运行时按程序生成吗？

> ID：594391
> 
> 赞同：2
> 
> 时间：2009-02-27T11:22:19.110
> 
> 标签：c++, vba, vb6, activex

有谁知道是否可以在运行时生成 ActiveX 属性？

我只需要能够从 Visual Basic 获取和设置这些属性。

我的 ActiveX 控件是用 C++ 编码的，我已经知道如何通过实现硬编码的 C++ get 和 put 函数来创建属性。但是，我可能有大量用于此 ActiveX 控件的属性，理想情况下，公开的属性集将根据 ActiveX 控件的内部状态而改变。

我希望有一种方法可以从数据中生成属性，例如以下 XML：

```
<Properties>
    <Property>
        <Name>SomeProperty</Name>
        <Type>Int</Type>
        <DefaultValue>10</DefaultValue>
    </Property>

    ...

<Properties> 
```

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-27T14:21:27.917

根据您需要的语法，这可能非常容易或有些困难。

一种方法是在 ActiveX 控件中创建您自己的**名称/值集合。**您可以只添加两种方法：

```
HRESULT GetPropery([in] BSTR name, [out,retval] VARIANT value);
HRESULT SetPropery([in] BSTR name, [in] VARIANT value); 
```

基本上，您将在控件上拥有一个属性，该属性将包含所有其他属性的集合。这是最直接的方式。

**您可以改为创建变体的[com 集合](http://msdn.microsoft.com/en-us/library/3stwxh95(VS.80).aspx)**（链接假定为 ATL，但有关于 com 集合的通用信息）属性。使集合的 Item() 调用接受字符串。访问它就像（集合被命名为“属性”）：

```
myValue = myControl.Properties("Name") 
```

我不确定您如何设置这样的值？

```
myControl.Properties("Name") = newValue 
```

这可能要求集合返回的不是变体，而是具有“默认”属性的 COM 对象。我什至不记得默认属性的很多细节——但我认为 VB6 客户端很好地支持它们，你所要做的就是在你的 IDL/ODL 文件中设置一些属性。

这两种想法都要求调用者有一点点间接方法（Get/SetProperty）或使用集合属性（myobject.Properties.XXXX）。如果你必须有这样的语法：

```
x = myControl.MyDynamticProperty 
```

您需要编写自己**的[IDispatch](http://msdn.microsoft.com/en-us/library/ms221608.aspx)**的 GetIDsOfName 和 Invoke 实现。前段时间我也做过这个，太丑了。值得庆幸的是，这一切都被删除了，因为我们对应用程序的那一部分采取了不同的方向。您必须强制调用者使用非 vtable IDispatch 接口（并且是后期绑定的） - 我想这可能很容易或很难，具体取决于调用语言。我的调用者总是 VB*脚本*，所以这不是问题。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-27T13:35:42.533

首先，它在技术上是可行的，但涉及使用内存和 vtables。不适合胆小的人，绝对不适合您想要长期维持的任何东西。COM 的设计使得一旦定义了接口，它对于该版本是不变的。这就是为什么在添加到界面时更新修订号至关重要的原因。

在为我们的金属切削软件创建成本计算模块时，我们必须处理同样的问题。Microsoft Scripting 的字典太不灵活，所以我们创建了一组类似的对象，称为属性。它允许向我们的类动态添加属性。

```
Option Explicit

Private priName As String
Private priValue As Variant

Private priProperties As PropertyList

Public Property Get Properties() As PropertyLis
    Set Properties = priProperties
End Property

Public Function Assign(ByVal RHS As Property)
    priName = RHS.Name
    priValue = RHS.Value
    priProperties.Assign RHS.Properties
End Function

Public Function Clone() As Property
    Dim nObject As Property

    Set nObject = New Property

    nObject.Name = priName
    nObject.Value = priValue

    If Not priProperties Is Nothing Then
        nObject.Properties.Assign priProperties
    End If

    Set Clone = nObject

    Set nObject = Nothing
End Function

Public Property Get Name() As String
    Name = priName
End Property

Public Property Let Name(ByVal RHS As String)
    priName = RHS
End Property

Public Property Get Value() As Variant
    Value = priValue
End Property

Public Property Let Value(ByVal RHS As Variant)
    priValue = RHS
End Property

Private Sub Class_Initialize()
    mPropertyType = PropertyTypeEnum.ptVariant
    mPropertyList = New PropertyList
End Sub 
```

属性列表。将 Item 定义为您的默认属性，并将 NewEnum 定义为您的枚举器属性。

```
Option Explicit

Private mCol As Collection

Public Sub Assign(nObject As PropertyList)
    Dim I As Long

    Me.Clear
    For I = 1 To nObject.Count
        Me.AddMember nObject(I).Clone
    Next

End Sub

Public Function Clone() As PropertyList
    Dim nObject As PropertyList
    Dim I As Long

    Set nObject = New PropertyList

    For I = 1 To Count
        nObject.AddMember Me(I).Clone
    Next I

    Set Clone = nObject

    Set nObject = Nothing
End Function

Public Sub AddMember(Item As Property)
    mCol.Add Item, Item.Name
End Sub

Public Sub Add(Name As String, Optional Value As Variant)
    Dim Item As Property
    If Not Defined(Name) Then
        Set Item = New Property

        Item.Name = Name

        If Not IsMissing(Value) Then N.Value = Value
        AddMember N
    Else
        If Not IsMissing(Value) Then Me(Name).Value = Value
    End If
End Sub

Private Sub Class_Initialize()
    Set mCol = New Collection
End Sub

Private Sub Class_Terminate()
    Set mCol = Nothing
End Sub

Public Sub Clear()
    Set mCol = New Collection
End Sub

Public Property Get Count()
    Count = mCol.Count
End Property

Public Property Get Defined(Index As Variant) As Boolean
    Dim Item As Property

    On Error Resume Next

    If IsNumeric(Index) Then
        Set Item = mCol(Index)
    Else
        Set Item = mCol(UCase(Index))
    End If

    If Err.Number <> 0 Then
        Defined = False
    Else
        Defined = True
    End If

End Property

Public Property Get Item(Index As Variant) As Property
    If IsNumeric(Index) Then
        Set Item = mCol(Index)
    Else
        Set Item = mCol(UCase(Index))
    End If
End Property

Public Property Get NewEnum() As IUnknown
    Set NewEnum = mCol.[_NewEnum]
End Property 
```

我们的版本比这更复杂，具有排序和格式化功能，这就是我们不使用 Microsoft Scripting Dictonary 的原因。这允许我们动态地创建一组分层的属性。事实证明，这对于在我们的软件中实施成本计算模块很有用。当我们不断添加或更改字段以响应客户输入时。

这在处理 XML 字段的灵活性方面应该证明是有用的。您可以使用 Vartype 函数获取变体的确切类型。您可以选择将字符串存储为 VB6，就像大多数 BASIC 变体一样，可以在数字和字符串之间自由转换。

# java - 使用 Ant 创建存根文件的最佳实践

> ID：594392
> 
> 赞同：2
> 
> 时间：2009-02-27T11:24:12.867
> 
> 标签：java, ant

我正在尝试为自己创建一个小的构建脚本来为我构建一个项目 - 创建所需的目录，通过 Ivy/Maven 下载任何需要的 jar 并创建一些存根文件。

存根文件部分是我不太确定该怎么做的部分。举个例子，我希望构建脚本在 WEB-INF 文件夹中创建一个 web.xml。不过，最好的方法是什么？我知道的唯一方法是对文件进行回显，然后生成包含我的存根代码的构建脚本。

有没有比这更好的方法我不知道？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-27T12:10:29.930

据我了解，您建议使用*echo*来编写*web.xml*之类的文件。

让您的 Ant 脚本调用模板引擎（例如[Apache Velocity](http://velocity.apache.org/) ）可能会更好。Texen 可用于[生成任意文本](http://velocity.apache.org/texen/devel/)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-27T12:44:28.337

如果您在 Ant 中生成或修改 XML 内容，我建议您使用[XMLTask](http://www.oopsconsultancy.com/software/xmltask/)。它可用于创建或修改 XML 文件，同时确保格式正确、实体和编码问题等。基于纯文本的工具的问题在于，尽管它们在许多情况下都可以使用，但它们并没有意识到限制XML 标准要求并强制执行。

有关如何使用 XMLTask 的文章，请参见[此处。](http://today.java.net/pub/a/today/2006/11/01/xml-manipulation-using-xmltask.html)

免责声明：我是作者，所以我承认有一定的偏见:-)

# testing - 自动化测试方法——哪个最好？

> ID：594403
> 
> 赞同：2
> 
> 时间：2009-02-27T11:29:54.460
> 
> 标签：testing, automation

哪种自动化方法最适合？是数据驱动测试还是关键字驱动测试？现在即使我们有业务流程测试，您认为最好的方法是什么？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-07-13T18:53:49.970

这一切都取决于您的需求。作为一项长期投资，我推荐关键字驱动或混合关键字/数据驱动框架。

请参阅下面的简短概述（取自我的博客页面[http://automation-beyond.com/category/automation/automation-methodology/practices/](http://automation-beyond.com/category/automation/automation-methodology/practices/)）。

**前端测试自动化实践——记录/回放**

1.  描述 • 硬编码数据 • 硬编码流程 • 无错误处理 • 无或有限报告 • 无结构 • 无验证 • 无验证

2.  优点 • 易于创建 • 快速创建 • 无需编程

3.  缺点 • 可用性非常低 • 维护成本极高 • 测试结果无法证明 • 任何失败都中断 • 测试流程覆盖率低 • 仍然需要大量手动工作

4.  适用性 • 演示和销售演示 • 当天测试（从头开始重新录制，测试流程短） • 探索性测试（调查测试工具如何处理应用程序） • 自动数据输入（有限制）

**前端测试自动化实践——记录/回放增强**

1.  描述 • 参数化数据 • 数据集是脚本的一部分，但不在代码中 • 通过 GUI 检查点进行验证（硬编码） • 硬编码流程 • 没有错误处理 • 没有报告或报告有限 • 没有结构

2.  优点 • 易于创建 • 快速创建 • 无需编程，但必须具备测试工具方面的专业知识

3.  缺点 • 易受攻击的脚本 • 不支持多环境 • 检查点的维护成本非常高 • 不可重现的测试结果 • 任何失败都中断 • 有限的测试流程覆盖 • 所有分析和验证都是手动完成的

4.  适用性 • 单一/稳定的环境 • 短流程测试用例 • 有限的检查点集，因为任何数据库/数据输入更改都会破坏验证并需要重新捕获 • 短期简化自动化目标

**前端测试自动化实践——数据驱动框架**

1.  描述 • 编程创建 • 参数化，能够导入电子表格 • GUI/数据库检查点，硬编码和/或参数化 • 基于库的结构 • 可能的错误处理 • 硬编码但数据驱动的流程（输入和逻辑） • 标准报告• 验证仅限于测试工具的功能 • 没有验证

2.  优点 • 良好的可用性和可重用性 • 良好的测试流程覆盖率 • 多环境支持 • 数据和代码是分开的 • 可重现的测试结果

3.  缺点 • 质量和覆盖范围很大程度上取决于实施人员的自动化技能 • 由于大量代码导致的持续维护问题 • 失败退出 • 需要手动验证

4.  适用性 • 非常适合单个应用程序测试，具有多环境、大数据集和很少更改的测试用例 • 能够通过额外的开发工作进行批量运行 • 检查点集有限，因为任何数据库/数据输入更改都会破坏验证并需要重新捕获• 需要跨团队工作空间（环境、数据等）共享（离岸支持可能存在的问题） • 中期自动化目标

**前端测试自动化实践——关键字驱动的框架**

1.  描述 • 纯程序化 • 参数化，能够导入电子表格 • GUI/数据库检查点，硬编码和/或参数化 • 基于框架的结构 • 有限的错误处理 • 基于关键字的流程（电子表格中的逻辑和数据） • 可能扩展报告• 验证仅限于测试工具的功能 • 没有验证

2.  优点 • 良好的可用性和可重用性 • 紧凑的代码 • 测试开发不需要编程技能 • 良好的测试流程覆盖率 • 多环境支持 • 数据和代码是分开的 • 可重现的测试结果

3.  缺点 • 需要对框架的设计和实施进行初始投资 • 由于关键字限制，无法涵盖非常复杂的测试用例 • 需要对员工进行元语言特定培训 • 版本控制问题 • 失败时退出 • 需要手动验证

4.  适用性 • 非常适合多应用程序测试（同一平台），具有多环境、大数据集和大量短而直的测试用例 • 测试计划/测试场景执行（批量运行） • 有限的检查点集，任何数据库/数据输入更改都会破坏验证并需要重新捕获 • 更好地支持分布式团队，尤其是实施扩展报告 • 对元语言的多工具支持 • 中长期自动化目标

**前端测试自动化实践——混合关键字/数据驱动框架**

1.  描述 • 纯程序化 • 内部数据模型，能够从各种来源导入/导出数据 • GUI/数据库检查点，参数化/转换 • 业务验证规则 • 基于框架的结构；能够集成外部对象（即 MSXML DOM） • 异常处理和恢复功能 • 面向测试用例的执行（代码之外的业务逻辑） • 数据驱动的输入和验证 • 扩展的业务报告 • 基于人工智能的验证方法

2.  优点 • 高可用性和可重用性 • 紧凑和可扩展的架构 • 测试计划/测试场景创建不需要对测试工具进行编程或培训 • 广泛的测试流程覆盖 • 多应用支持 • 数据和代码是分开的 • 可重复性和经过验证的测试结果、方便且可转移的测试报告 • 内置一致性和严重性验证

3.  缺点 • 需要对框架的设计和实施进行初始投资

4.  适用性 • 多应用、多平台产品的综合功能测试，具有大量复杂的测试用例 • 具有广泛覆盖和验证的烟雾-回归-健全性测试周期 • 测试计划/测试场景执行（批量运行） • 大而多变数据集和数据转换案例 • 分布式团队的出色支持 • 与其他测试工具的集成 • 中长期自动化目标

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-04T22:15:22.057

听起来您的问题是针对 HP 的 QTP/BPT 的。以下是不同之处。QTP 实际上是 BPT 和 QTP 使用的“引擎”。QTP 为使用脚本提供了两个主要视图。

QTP：第一个是“关键字”视图，它呈现动作和功能树。此模式适合初学者，允许他们从应用程序或对象存储库中选择对象，以及选择要对对象执行的方法。然后自动生成脚本。

第二个是“专家”视图，它允许显示和编辑脚本源代码。专家 veiw 提供了一个用于开发脚本的 IDE。此视图适合高级用户。

BPT 基于从可重用业务组件创建测试用例的概念，而这些业务组件又从关键字创建。这种关键字驱动的方法通过提供允许用户“拖放”组件来构建测试的 gui 来简化测试用例的创建过程。脚本是自动生成的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-02T15:45:55.877

这取决于您在特定情况下要完成的工作。然而，普遍的一件事是测试自动化是软件开发，需要这样对待。使用合理的设计和编码实践。听起来你是自动化的新手。通常一个好的开始是构建一个烟雾测试，它将为每个新构建快速运行。

# project - 向您介绍一个项目的最佳方式是什么？

> ID：594405
> 
> 赞同：3
> 
> 时间：2009-02-27T11:30:28.560
> 
> 标签：project

我的处境是，我要担任当前项目的新开发人员的导师。

什么是您快速进入项目的最佳方式——无论是技术上、特定领域的项目还是社交上。

我读过很多赞成 TDD 的人谈论结对编程，从经验丰富的团队成员编写测试开始，然后是新人实现实际代码 - 然后再切换。

什么最适合你？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-27T11:43:03.087

啤酒！

从社交的角度来看，当有新人出现时，我总是喜欢整个团队出去喝杯啤酒。或者，如果您不是啤酒爱好者，那么保龄球或摇滚乐队之类的。

在你们都放松一点之后，他们会更自在地提出问题并融入其中。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-27T11:48:05.537

有多种技术组合：

首先，他们需要了解应用程序的功能。我知道这听起来很陈词滥调，但我曾在交易应用程序中工作过，人们可能需要很长时间才能了解做市商所做的事情，因为这是建立在关于金融市场如何运作以及什么方面的大量知识之上他们是这样。像“传播”这样的术语已经内置了各种假设的知识。

这应该以交互方式完成，而不是交给某人教程或用户手册。此外，这非常重要，**用户用户应该驾驶**. 使用鼠标和键盘而不是观看是建立肌肉记忆和根深蒂固的反应的方法。这样，您将获得更好的保留率。此外，与其说“现在点击这里”，不如让他们当场问他们“你会在这里做什么”。

您通常可以通过这种方式获得对应用程序可用性的有用洞察，因为新人不会受到您和您现有团队拥有的所有历史的影响。

你不能教给别人所有东西，但要向他们展示足够多的东西，让他们可以在应用程序中导航并完成简单的任务。

其次，给他们一个架构概述。如果这需要超过一两个小时，那么您将进入太多细节。他们只会忘记它。我发现实际上将其作为面对面的谈话而不是交给他们一份建筑设计文件（这通常只会让人目瞪口呆）更好。

最后，给他们一些小的、相对容易的、时间不紧迫的错误来修复。这将使他们熟悉检查代码、构建代码、部署代码、运行代码等的基础知识。重要的是它很简单，因为新代码总是出错。您可能需要设置正确的环境变量才能正确构建代码或其他内容。给他们一个复杂的问题，如果出现问题，他们会迷失在弄清楚环境是否是因为他们做错了什么等等。

不言而喻，你不能把它们放在角落里来解决这个问题。有人需要密切关注他们，以确保他们不会陷入困境。这也将使您对他们的性格有一个很好的了解：当他们被卡住时会发生什么？他们会结冰吗？他们寻求帮助吗？他们会尝试解决问题吗？他们是不是太容易放弃了？

与此同时，他们正在学习代码。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-27T11:36:39.387

让新手修复代码中的错误。

这是双赢的。你可以让他们在角落里按照自己的节奏工作。他们有一个目标。您可以在 5 分钟内完成一项任务。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-02-27T11:52:18.897

自然的倾向是开始广泛并深入研究，这导致了很多冗长的介绍性谈话。新来的人几乎不会记得任何事情。不要把时间浪费在项目的历史、高级架构等上。

将他们与有经验的人配对，共同解决一个问题。及时解释正在开展的工作的背景。当你这样做时，通过向他们展示在哪里可以找到历史/背景信息来教他们钓鱼。当人们从内核中建立理解时，他们学得最好。人们不会保留太多前期的“脚手架”信息。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-27T11:42:02.743

我喜欢做以下事情：

*   给个系统demo
*   提供高级概述，并附有流程图/设计
*   给开发者一个特定领域的更详细的解释。
*   在那个领域给他们一些工作（轻松的工作）。
    修复一些错误是一个很好的方法。

一旦他们熟悉了那个领域，你就可以扩展它，并开始给他们一些小功能等。

所有这一切的重点是让他们熟悉产品和环境。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-02-27T15:04:44.503

我刚刚在 12 月开始了一份新工作，所以这个过程在我的脑海中仍然很新鲜 :)。

以下是我遇到的问题：

**这东西** ***有什么*作用？**

*   我正在处理的应用程序的目的是什么？
*   谁是它的目标用户，它为他们解决了什么问题？
*   我该如何使用它？

**我该如何做我的工作？**

*   我们用什么来进行源代码控制？
*   我们用什么来跟踪错误？
*   我将每天与谁互动？（其他开发人员、QA、文档等）
*   我还需要了解其他工具或流程吗？

**我该如何构建它？**

*   在源代码管理中哪里可以找到我需要的源代码？
*   我需要采取哪些步骤来构建这个东西？（理想情况下，它应该是一步，但几乎从来都不是！）

**这都是什么东西？**

*   系统架构的高级概述是什么？（没什么太详细的，只是对主要玩家的一个非常基本的描述）
*   源代码的目录结构是如何设置的？什么去哪里？

回答完所有这些问题后，我就可以开始工作了！

快速掌握新代码库的最佳方法是处理定义明确、隔离的任务，这些任务的结构方式使我逐渐接触到越来越多的组件。此外，如果我遇到困难或需要更多信息，让人们随时回答我的问题也很重要。

到目前为止，我在这里的经历非常棒，这是我所做的事情的顺序：

1.  修复几个小错误
2.  重新设计两个设计糟糕的不同对话框
3.  编写示例代码以与产品的 COM API 交互
4.  从头开始编写一个全新的模块，然后将其集成到产品中

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-27T11:35:28.377

是否有使用与主项目相同的平台创建的内部工具？如果是这样的话，对平台的一个很好的介绍就是让新人对你想要一段时间的工具进行一些改进。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-27T11:35:33.883

当我开始一个现有的项目时，我发现在以下情况下更容易进入它：

*   有人向我展示了应用程序的工作，解释了它应该做什么，做了什么，并回答了我最初的问题。

*   我得到了很好的文档，所以我可以自己找出项目的基础知识。

*   我有人可以回答我的任何问题。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-27T11:46:53.530

*   给他们一两天所需的 KT。
*   获取反向演示
*   要求他们修复错误
    几天。

或者

将新加入者作为模块的备份资源。逐渐根据他表现出的信心，让他开始主要的核心工作。

# sql-server - 什么触发 SqlServer 2000 中的缓存删除

> ID：594407
> 
> 赞同：0
> 
> 时间：2009-02-27T11:30:59.883
> 
> 标签：sql-server, stored-procedures, caching

我正在重写一个存储过程，主要是为了阻止它进行脏读并且没有进行任何重大的结构更改。但是，针对当前版本运行新版本时，我发现新版本在没有大量活动的开发数据库上运行的时间几乎是原来的两倍！

遵循该站点的建议： [http](http://www.sql-server-performance.com/articles/per/optimizing_sp_recompiles_p1.aspx) ://www.sql-server-performance.com/articles/per/optimizing_sp_recompiles_p1.aspx 我使用分析器查看发生了什么，令我惊讶的是有很多“缓存删除”新版本，但当前版本没有！

谁能告诉我是什么触发了缓存被丢弃？

我已经预先建立了所有临时表定义和索引（尽管教科书说在 INSERT 之后建立索引通常更好，但我已经尝试过这种方法，发现存储过程实际上运行得更慢）；而且我没有对任何引用的对象进行任何架构更改。

谢谢，

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-27T13:29:46.823

简单清单：

1.  统计变化
2.  DBCC FREEPROCCACHE
3.  使用/内存压力等

必读文章：

1.  [SQL Server 2005 中的批处理编译、重新编译和计划缓存问题](http://technet.microsoft.com/en-gb/library/cc966425.aspx)
2.  [SQL 可编程性和 API 开发团队博客](http://blogs.msdn.com/sqlprogrammability/archive/tags/Procedure+Cache/default.aspx)

可能需要更多信息，但正如上面的评论......

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-27T13:02:14.393

我只是对此进行了一些实验，发现在代码块中使用 BEGIN 和 COMMIT TRANSACTION 实际上会抑制缓存删除，尽管如果它要长时间保持在高利用率表上，这可能是不可取的：- \ 有没有办法在不将代码块包含在事务中的情况下解决这个问题？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-27T13:30:36.197

事务是否只包含需要原子的内容？交易是否必要？例如，如果更新是：

插入 tbl (v1, v2, v3) 从 otherTable 中选择 someValues

默认情况下是原子的。

# asp.net-mvc - asp.net mvc中嵌套属性的模型绑定

> ID：594412
> 
> 赞同：12
> 
> 时间：2009-02-27T11:34:48.143
> 
> 标签：asp.net-mvc

我想让一些绑定在我的 mvc 应用程序中工作。我发现嵌套属性不会被 asp.net mvc 的 RC1 版本中的默认模型绑定器自动绑定。我有以下类结构：

```
public class Contact{  
    public int Id { get; set; }  
    public Name Name { get; set; }  
    public string Email { get; set; }  
} 
```

其中`Name`定义为：

```
public class Name{  
    public string Forename { get; set; }  
    public string Surname { get; set; }  
} 
```

我的观点是这样定义的：

```
using(Html.BeginForm()){  
    Html.Textbox("Name.Forename", Model.Name.Forename);  
    Html.Textbox("Name.Surname", Model.Name.Surname);  
    Html.Textbox("Email", Model.Email);  
    Html.SubmitButton("save", "Save");  
} 
```

我的控制器动作定义为：

```
public ActionResult Save(int id, FormCollection submittedValues){  
    Contact contact = get contact from database;  
    UpdateModel(contact, submittedValues.ToValueProvider());  

    //at this point the Name property has not been successfully populated using the default model binder!!!
} 
```

属性已成功绑定，`Email`但`Name.Forename`or`Name.Surname`属性未成功绑定。谁能告诉这是否应该使用默认模型绑定器工作，我做错了什么，或者它是否不起作用，我需要滚动自己的代码来绑定模型对象上的嵌套属性？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-27T11:57:19.603

我认为问题是由于属性上的名称前缀。我认为您需要将其更新为两个模型并指定第二个模型的前缀。请注意，我已从参数中删除 并使用依赖于内置值提供程序`FormCollection`的签名并指定要考虑的属性白名单。`UpdateModel`

```
 public ActionResult Save( int id )
 {
     Contact contact = db.Contacts.SingleOrDefault(c => c.Id == id);

     UpdateModel(contact, new string[] { "Email" } );
     string[] whitelist = new string[] { "Forename", "Surname" };
     UpdateModel( contact.Name, "Name", whitelist );
 } 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2012-04-04T09:30:46.137

在 POST 上绑定名称而不是整个视图模型是指示模型绑定器将使用前缀。这是使用 BindAttribute 完成的。

```
public ActionResult AddComment([Bind(Prefix = "Name")] Name name)
{
  //do something
} 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-27T13:37:23.933

那很有趣，因为如果你这样做了

```
public ActionResult Save( int id, Contact contact )
{
    //contact here would contain the nested values.
} 
```

我使用它取得了巨大的成功。我想你可以以某种方式将两个 Contact 对象同步在一起。

我会认为 UpdateModel 和对参数的绑定在幕后使用相同的调用。注意：尚未尝试重现您的问题。

# javascript - 如何在 IE6 中为对象添加属性？

> ID：594428
> 
> 赞同：0
> 
> 时间：2009-02-27T11:40:46.273
> 
> 标签：javascript, ajax, internet-explorer, prototype

我在使用 AJAX 时遇到了一个特别棘手的问题，它在 IE7 和 Firefox 中运行良好，但在 IE6 中却不行。

我有一个非常简单的本土 AJAX 框架，它要求我通过添加几个属性来扩展 XMLHttpRequest 对象（或者在 IE 的情况下，XMLHttpRequest ActiveXObject）。相关部分代码如下：

```
//the following is the constructor for our ajax request object - which extends the standard object. It is used in the method below it   
function FD_XMLHttpRequest() {     
  var xmlHttpReq = false;
  if (window.XMLHttpRequest) { // Mozilla/Safari
    xmlHttpReq = new XMLHttpRequest();
  } else if (window.ActiveXObject) { // IE
    xmlHttpReq = new ActiveXObject("Microsoft.XMLHTTP");
  }
  //we now have the request object - extend it with things we might need to store with it
  xmlHttpReq.onReturnFunc = null; //******ERROR IN IE6******
  xmlHttpReq.targetDivId = null;  //******ERROR IN IE6******
  return xmlHttpReq;  
} 
//To use:
myXHReq = new FD_XMLHttpRequest();
myXHReq.onReturnFunc = someFunction; 
myXHReq.targetDivId = "myDiv"; 
```

问题似乎是 FF 和 IE7 允许以这种方式扩展对象，但 IE6 不允许（它抱怨“对象不支持此属性或方法”）。我尝试过使用“原型”属性和“真实”继承的各种方法，但我无法完全理解 IE6 的情况

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-27T11:59:14.200

在 IE7 上，您将获得一个“本机 JavaScript”XMLHttpRequest 对象。与所有 JavaScript 对象一样，您可以毫无问题地向它们添加任意属性——尽管这并不总是一个好主意，因为如果未来的浏览器添加了它自己的真正的“onReturnFunc”成员，那么您就会混淆它。

在 IE6 或 IE7 上，当禁用“本机 XMLHttpRequest”选项时，您将回退到使用原始 ActiveX XMLHttpRequest。但是，ActiveX 对象的行为与 JavaScript 对象完全不同，其中一个区别是您不能添加任意属性。

通常，您应该拥有自己的包装类，该类包含您需要的任何额外数据，并且包含对“真实”XMLHttpRequest 对象的引用。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-27T12:02:20.247

问题是它的浏览器提供了支持expandos的XMLHttpRequest。但是 IE6 没有 XMLHttpRequest，因此您的代码会使用 ActiveXObject。MSXML 提供的对象不支持扩展。

更好的方法是无论如何都使用闭包，例如：-

```
function getContentForElem(url, elem, completed)
{
    var xhr = getXhr()
    xhr.open("GET", url, true)
    xhr.onreadystatechange = fnstatechange
    xhr.send()
    return xhr;

    function fnstatechange()
    {
       if (xhr.readyState == 4)
       {
           if (xhr.status == 200)
           {
                elem.innerHTML = xhr.responseText;
           }
           if (completed) completed(xhr)
       }
    }
}

function getXhr()
{
    var xhr;
    if (window.XMLHttpRequest)
        xhr = new XMLHttpRequest();
    else
        xhr = new ActiveXObject("MSXML2.XMLHTTP.3.0");
    return xhr;
} 
```

# .net - CruiseControl.Net 抱怨 xml

> ID：594429
> 
> 赞同：1
> 
> 时间：2009-02-27T11:40:52.980
> 
> 标签：.net, continuous-integration, cruisecontrol.net, build-server

我继承了一个构建失败的现有项目。我可以在 ccnet.log 文件中看到异常：

```
Exception: System.Xml.XmlException: Name cannot begin with the '%' character, hexadecimal value 0x25\. Line 17, position 100.
   at System.Xml.XmlTextReaderImpl.Throw(Exception e)
   at System.Xml.XmlTextReaderImpl.Throw(String res, String[] args)
   at System.Xml.XmlTextReaderImpl.Throw(Int32 pos, String res, String[] args)
   at System.Xml.XmlTextReaderImpl.ParseQName(Boolean isQName, Int32 startOffset, Int32& colonPos)
   at System.Xml.XmlTextReaderImpl.ParseElement()
   at System.Xml.XmlTextReaderImpl.ParseDocumentContent()
   at System.Xml.XmlTextReaderImpl.Read()
   at System.Xml.XmlWriter.WriteNode(XmlReader reader, Boolean defattr)
   at ThoughtWorks.CruiseControl.Core.Util.XmlFragmentWriter.WriteNode(XmlReader reader, Boolean defattr)
   at ThoughtWorks.CruiseControl.Core.Util.XmlFragmentWriter.WriteNode(String xml) 
```

知道这是哪个 xml 文件，我该如何修复它？恼人的事情是构建变成红色，但它没有被添加到最近的构建网页中。

**编辑**让我澄清一下：这发生在构建结束时，可能是在它尝试生成构建报告 xml 或其他东西时（我禁用了所有合并发布者）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-27T11:46:27.383

`ccnet.config`由于堆栈框架，我不确定这是您的文件：

```
System.Xml.XmlWriter.WriteNode 
```

...我不相信 CC.NET 会写回自己的`ccnet.config`文件。这可能发生在构建过程中，不是吗？

很难从堆栈跟踪中准确地说出它使用的是什么文件。是否有更多来自更高层的堆栈帧？

无论 XML 文件是什么，问题都在第 17 行第 100 行。

如果您正在使用统计信息，您可能会发现此问题是由统计信息文件引起的。就像我说的，没有更完整的堆栈跟踪很难说。

有时，如果磁盘已满，统计文件可能会损坏。您可能必须进入并手动更正 XML 文件的尾部，确保正确关闭所有元素。

**编辑**

我突然想到这个问题可能与发布者步骤合并文件有关。在您的`ccnet.config`文件中，有一个步骤发生在构建结束时，CC 将几个文件（通常是 XML 文件）合并在一起，并创建一个更大的 XML 文档，从中生成 Web 仪表板。我的猜测是您正在合并的文件之一包含这个虚假字符，并且合并步骤失败了。

在我的配置文件中，有问题的步骤如下所示：

```
<publishers>
  <merge>
    <files>
      <file>E:\Blah\Cruise Reports\*.xml</file>
    </files>
  </merge>
  .... 
```

查看该文件夹并检查`%`不应该出现的字符。也许您正在吸入某种根本不是 XML 的文件。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-04T10:38:53.667

终于设法找到了问题：构建使用 Nant 完成了大部分任务，并且 Nant 配置不正确：

*   它被配置为记录所有调试信息
*   log4net 被配置为在 nant.exe.config 的 <> 括号中记录一些内容

因此，当 ccnet 尝试将 nant 输出与构建输出合并时，构建失败了。

非常感谢大家的帮助！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-27T11:43:08.530

很可能是 CC.NET 安装目录中的*ccnet.config*。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-02T21:47:30.283

需要注意的一件事 - 如果您在巡航控制项目中指定构建任务，则不必专门告诉它合并输出 - 它会自动处理。一种调试方法是首先注释掉除第一个任务之外的所有任务。如果该构建成功，请取消注释下一个任务并重试。您最终会发现失败的任务并可以从那里继续调试。

# .htaccess - .htaccess 文件意见（howto）

> ID：594439
> 
> 赞同：0
> 
> 时间：2009-02-27T11:46:36.290
> 
> 标签：.htaccess, error-handling

我喜欢制作一个 .htaccess 文件来重定向我从网站获得的任何错误。

我已经删除了旧网站的所有页面。但我不知道人们已经预订了哪些页面。

新的网页和网站结构完全不同......所以没有一个页面与旧的相同，更不用说索引文档从index.html更改为index.php。

所以这是我上传到服务器的.htaccess文件......

随时发表评论并告诉我你的观点，你会怎么做？

也许这是一个矫枉过正......但它的工作原理！这是文件：

```
#404 - Not Found The requested URL was not found on this server
ErrorDocument 404 http://acecrodeo.com/new/01-acec.php?lang=fra

#400 - Bad Request Your browser sent a request that this server could not understand
ErrorDocument 400 http://acecrodeo.com/new/01-acec.php?lang=fra

#401 - Authorization Required This server could not verify that you are authorized to access the document requested. Either you supplied the wrong credentials (e.g., bad password), or your browser doesn't understand how to supply the credentials required.
ErrorDocument 401 http://acecrodeo.com/new/01-acec.php?lang=fra

#403 - Forbidden You don't have permission to access on this server
ErrorDocument 403 http://acecrodeo.com/new/01-acec.php?lang=fra

#405 - Method Not Allowed The requested method GET is not allowed for the URL
ErrorDocument 405 http://acecrodeo.com/new/01-acec.php?lang=fra

#406 Not Acceptable
ErrorDocument 406 http://acecrodeo.com/new/01-acec.php?lang=fra

#409 Conflict
ErrorDocument 409 http://acecrodeo.com/new/01-acec.php?lang=fra

##413 - Request Entity Too Large The requested resource does not allow request data with GET requests, or the amount of data provided in the request exceeds the capacity limit
ErrorDocument 413 http://acecrodeo.com/new/01-acec.php?lang=fra

#414 - Request-URI Too Large The requested URL's length exceeds the capacity limit for this server
ErrorDocument 414 http://acecrodeo.com/new/01-acec.php?lang=fra

##500 - Internal Server Error The server encountered an internal error or misconfiguration and was unable to complete your request
ErrorDocument 500 http://acecrodeo.com/new/01-acec.php?lang=fra

#501 - Method Not Implemented GET to URL not supported
ErrorDocument 501 http://acecrodeo.com/new/01-acec.php?lang=fra

# ------------ i am not sure the usefullness of these.. put it anyway !

#301 - Moved Permanently The document has moved URL here
ErrorDocument 301 http://acecrodeo.com/new/01-acec.php?lang=fra

#302 - Found The document has moved URL here
ErrorDocument 302 http://acecrodeo.com/new/01-acec.php?lang=fra

#303 - See Other The answer to your request is located URL here
ErrorDocument 302 http://acecrodeo.com/new/01-acec.php?lang=fra

#304 - Not Modified A cached copy will be used
ErrorDocument 304 http://acecrodeo.com/new/01-acec.php?lang=fra

#408 - Request Time-out Server timeout waiting for the HTTP request from the client
ErrorDocument 408 http://acecrodeo.com/new/01-acec.php?lang=fra

#410 - Gone The requested resource is no longer available on this server and there is no forwarding address. Please remove all references to this resource
ErrorDocument 410 http://acecrodeo.com/new/01-acec.php?lang=fra

#411 - Length Required A request of the requested method GET requires a valid Content-length
ErrorDocument 411 http://acecrodeo.com/new/01-acec.php?lang=fra 
```

* * *

php请求呢

如果我请求 aaa.php（旧文件）而新文件请求 aaa.php?lang=eng

它出现错误...我该怎么办，重定向？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-27T12:22:11.540

你只需要404。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-27T12:31:21.330

您应该知道绝对 URL 将原始错误状态代码更改为重定向状态代码：

> 请注意，当您指定一个`ErrorDocument`指向远程 URL（即前面带有 http 等方法的任何内容）时，Apache 将向客户端发送重定向以告诉它在哪里可以找到文档，即使文档结束在同一台服务器上。这有几个含义，最重要的是客户端不会收到原始错误状态代码，而是会收到重定向状态代码。这反过来又会混淆网络机器人和其他尝试使用状态代码来确定 URL 是否有效的客户端。—[`ErrorDocument`指令](http://httpd.apache.org/docs/2.2/en/mod/core.html#errordocument)

因此`404 Not Found`，Apache 可能不会发送一个未找到资源的答案，而是发送一个`302 Temporary Redirect`.

* * *

我要做的是使用一个页面在本地处理错误，该页面说明您想对寻找文档的人说什么。也许是这样的：

> 该网站已移至 example.com。但是由于管理系统的愚蠢更改，旧的 URI 无法映射到新的 URI。对此我们深表歉意，并希望您能找到您正在寻找的页面。

结合搜索字段应该为用户提供一些答案和帮助他们所面临的情况。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-27T13:27:13.083

如果您想知道由于人们链接到它们而重定向哪些页面很重要，那么一件事可能会有所帮助，那就是[Google web master tools](http://www.google.com/webmasters/tools/)。它将为您提供 Google 必须指向您网站的页面的外部链接的完整列表。如果您想进行一些手动重定向，可能会很有用。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-27T13:38:41.420

您可以使用[Google 网站管理员工具](https://www.google.com/webmasters/tools/ "谷歌网站管理员工具")来了解人们可能已经预订了哪些页面。它是免费的，并且不需要您向页面添加任何脚本或任何内容（与 Google Analytics 不同）。

另外，我知道这对你一点帮助都没有，但是[很酷的 URI 不会改变](http://www.w3.org/Provider/Style/URI "酷 URI 不会改变")。您刚刚从轨道上删除了您的 PageRank。

# python - 在 Python 中选择不同的 switch-case 替换 - 字典还是 if-elif-else？

> ID：594442
> 
> 赞同：18
> 
> 时间：2009-02-27T11:47:51.437
> 
> 标签：python, switch-statement

我最近阅读了建议不要在支持它的语言中使用 switch-case 语句的问题。就 Python 而言，我已经看到了许多 switch case 替换，例如：

1.  使用字典（许多变体）
2.  使用元组
3.  使用函数装饰器（[http://code.activestate.com/recipes/440499/](http://code.activestate.com/recipes/440499/)）
4.  使用多态（推荐方法而不是类型检查对象）
5.  使用 if-elif-else 阶梯
6.  甚至有人推荐了访客模式（可能是外部的）

鉴于有多种选择，我在决定对特定代码段执行什么操作时有些困难。我想了解在一般情况下选择其中一种方法而不是另一种方法的标准。此外，如果我无法做出决定（附上选择的解释），我将不胜感激有关在特定情况下该怎么做的建议。

这是具体问题：
（1）

```
def _setCurrentCurve(self, curve):
        if curve == "sine":
            self.currentCurve =  SineCurve(startAngle = 0, endAngle = 14,
            lineColor = (0.0, 0.0, 0.0), expansionFactor = 1,
            centerPos = (0.0, 0.0))
        elif curve == "quadratic":
            self.currentCurve = QuadraticCurve(lineColor = (0.0, 0.0, 0.0)) 
```

此方法由**qt-slot**调用，以响应选择从菜单中绘制曲线。一旦申请完成，上述方法将包含总共 4-7 条曲线。在这种情况下使用一次性字典是否合理？由于最明显的方法是 if-elif-else，我应该坚持吗？我还考虑在这里使用 **kargs（在朋友的帮助下），因为所有曲线类都使用 **kargs...

(2)
第二段代码是一个**qt-slot**，当用户更改曲线的属性时会调用它。基本上，插槽从 gui (spinBox) 中获取数据并将其放入适当曲线类的实例变量中。在这种情况下，我又遇到了同样的问题——我应该使用字典吗？

这是前面提到的插槽-

```
def propertyChanged(self, name, value):
    """A Qt slot, to react to changes of SineCurve's properties."""
    if name == "amplitude":
        self.amplitude = value
    elif name == "expansionFactor":
        self.expansionFactor = value
    elif name == "startAngle":
        self.startAngle = value
    elif name == "endAngle":
        self.endAngle = value 
```

作为参考，这里是连接到上述插槽的代码 -

```
def _connectToPage(self, page):
    for connectionData in page.getConnectibles():
        self.connect(connectionData["object"],
                    SIGNAL(connectionData["signal"]),
                    lambda value, name = connectionData["property"]:\
                        self.currentCurve.propertyChanged(name, value))
        self.connect(connectionData["object"],
                    SIGNAL(connectionData["signal"]),
                    self.hackedDisplayArea.update) 
```

**注意**- self.endAngle 等在构造函数中初始化。

据我所知，选择 dict 的原因是为了快速查找。什么时候有保证？当我有 100 个或更多案例时？每次调用函数时继续构建和丢弃字典是个好主意吗？如果我在函数之外为此目的构建一个字典，我应该检查是否在其他地方需要它？如果其他地方不需要它会发生什么？

我的问题是如果有最好的做法是什么？做事最好/最优雅的方式是什么？换句话说，何时使用**if-elif-else**，何时使用其他选项？

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2009-02-27T12:51:21.440

叹。对问题的错误部分过多地绞尽脑汁。switch 语句不是问题。有很多表达“另类”的方式不增加**意义**。

问题是**意义**——而不是技术声明的选择。

共有三种常见模式。

*   **将键映射到对象**。如果字典几乎是完全静态的，并且您在一个简单的键和另一个更复杂的东西之间有一个映射，请使用它。每次需要时都在运行中构建字典是愚蠢的。如果您的**意思是**这样，您可以使用它：您的“条件”是映射到对象的简单静态键值。

*   **子类之间的变体行为**。使用多态而不是类型检查对象。正确的。如果您在多个具有不同行为的类中有类似的对象，它们应该是多态的。尽可能多地使用它。

*   **其他变体行为**。使用 if-elif-else 阶梯。当您没有大量静态的键值映射时使用它。当条件复杂时使用它，或者你的**意思是**过程，而不是对象。

其他一切都只是可以实现类似结果的棘手代码。

使用元组。这只是没有映射的字典。这需要搜索，并且应尽可能避免搜索。不要这样做，效率低下。使用字典。

使用函数装饰器（[http://code.activestate.com/recipes/440499/](http://code.activestate.com/recipes/440499/)）。恶心。这隐藏了您正在解决的问题的 if-elif-elif 本质。不要这样做，选择是*排他性*的并不明显。使用其他任何东西。

甚至有人推荐了**访客**模式。当您有一个遵循**复合**设计模式的对象时使用它。这取决于多态性的工作，所以它并不是一个真正不同的解决方案。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-02-27T12:21:10.560

在第一个示例中，我当然会坚持使用 if-else 语句。事实上，我没有理由不使用 if-else，除非

1.  您发现（例如使用 profile 模块）if 语句是一个瓶颈（IMO 不太可能，除非您有大量的情况很少做）

2.  使用字典的代码更清晰/重复更少。

你的第二个例子我实际上会重写

```
setattr(self, name, value) 
```

（可能添加一个断言语句来捕获无效名称）。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-27T12:27:13.353

考虑到这是为了响应用户操作（从菜单中选择某些东西）而完成的，并且您预期的选择数量非常少，我肯定会选择一个简单的 if-elif-else 阶梯。

选择速度是没有意义的，因为它只会在用户可以做出选择的情况下发生，这不是“光线追踪器的内部循环” - 领土。当然，给用户快速反馈很重要，但由于案例数量很少，也不存在这种危险。

优化简洁是没有意义的，因为（imo 更清晰，零可读性开销）if-ladder 无论如何都会非常短。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-27T12:35:44.800

关于您的字典问题：

> 据我所知，选择 dict 的原因是为了快速查找。什么时候有保证？当我有 100 个或更多案例时？每次调用函数时继续构建和丢弃字典是个好主意吗？如果我在函数之外为此目的构建一个字典，我应该检查是否在其他地方需要它？如果其他地方不需要它会发生什么？

1.  另一个问题是可维护性。拥有 string->curveFunction 字典允许您对菜单进行数据驱动。然后添加另一个选项只需将另一个字符串->函数条目放入字典中（它位于专用于配置的代码的一部分中。

2.  即使您只有几个条目，它也会“分离关注点”；`_setCurrentCurve`负责在运行时进行接线，而不是定义组件盒。

3.  建立字典并坚持下去。

4.  即使它没有在其他地方使用，您也可以获得上述好处（可定位性、可维护性）。

我的经验法则是问“这里发生了什么？” 对于我的代码的每个组件。如果答案是形式

> ……**和**……**和**……

（如“定义函数库并将每个函数**与**菜单中的值相关联”）然后有一些问题需要分开。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-27T12:23:10.493

每个公开的选项都非常适合某些场景：

1.  if-elif-else：简单、清晰
2.  字典：当你动态配置它时很有用（想象你需要在一个分支上执行一个特定的功能）
3.  元组：每个分支的多个选择的 if-else 案例的简单性。
4.  多态性：自动面向对象分支
5.  等等

Python 是关于可读性和一致性的，即使您的决定始终是主观的并且取决于您的风格，您也应该始终考虑 Python 口头禅。

./亚历克斯

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-27T12:27:03.713

关于第二个例子，我同意 df 的观点。第一个示例我可能会尝试使用字典重写，特别是如果所有曲线构造函数都具有相同的类型签名（可能使用 *args 和/或 **kwargs）。就像是

```
def _setCurrentCurve(self, new_curve):
    self.currentCurve = self.preset_curves[new_curve](options_here) 
```

或者甚至

```
def _setCurrentCurve(self, new_curve):
    self.currentCurve = self.preset_curves[new_curve](**preset_curve_defaults[new_curve]) 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-27T13:23:21.550

在 Python 中，不要考虑如何替换 switch 语句。

请改用类和多态性。尝试将有关每个可用选择以及如何实现它的信息保存在一个地方（即实现它的类）。

否则，您最终将拥有很多地方，每个地方都包含每个选择的一小部分，并且更新/扩展将是维护的噩梦。

这正是OOD试图通过抽象、信息隐藏、多态性和大量来解决的问题。

考虑一下您拥有哪些对象类及其属性，然后围绕它们创建一个 OO 架构。这样你就再也不用担心缺少“switch”语句了。

# javascript - 不涉及服务器的 XSS - 这很危险吗？

> ID：594443
> 
> 赞同：1
> 
> 时间：2009-02-27T11:47:53.417
> 
> 标签：javascript, security, xss

我们一直在讨论 javascript 中的仅客户端解决方案，该解决方案为站点访问者提供了注释打印页面的方法，以及它在 XSS 或类似攻击向量方面的可利用性。

基本原理：选择要显示的数据可能需要很长时间。为了记录所采取的步骤，提供了一个*textarea*（不包含*form*），用户可以编写不应该传输到服务器的任意文本。初始文本是静态的，例如一组简短的说明如何使用该字段，因此攻击者没有（明显的）可能为该文本区域构造一个包含恶意 javascript 的 url。

一旦用户更改了此文本，他们就会打印页面（和他们的注释）。一旦用户离开页面，笔记就会丢失。

如果出现“过多的散文错误”，这里有一些示例代码：

```
<span id="descriptionHeader">Description of the result</span>
<div id="description">
  <textarea id="descriptionEditor" rows="15" cols="80" type="text"
            ondblclick="replaceDescription()">
Edit this text to add a detailed description to this page.
Double click to this editing area to finish editing.
If you want to edit the text again, do a double click to the
description header.
You may use html (e.g. <br>) for formatting.
   </textarea>
 </div>
 <script type="text/javascript">
    var header = getElem("descriptionHeader");
    var editor = getElem("descriptionEditor");
    var description = getElem("description");

    function empty() {
    }

    function editDescription() {
        header.ondblclick = empty;
        editor.value = description.innerHTML;
        description.innerHTML = "";
        description.appendChild(editor);
    }

    function replaceDescription() {
        header.ondblclick = editDescription;
        description.removeChild(editor);
        description.innerHTML = editor.value;
    }
</script> 
```

再次：

*   文本永远不会在服务器端处理，只有静态描述（“如何使用”）从服务器发送到客户端，从不从客户端发送到服务器。
*   用户可以根据自己的喜好添加 javascript 元素并利用自己的地狱。
*   我想不出这会带来安全风险的情况，但一种不安的感觉仍然存在……

注意：问题不在于此解决方案的优雅性或任何内联编辑更舒适的库，而纯粹是关于可想象的安全风险 - 如果有的话。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-27T12:00:12.497

社会工程攻击是可能的：要求用户（通过聊天或其他方式）复制粘贴一些本应是漂亮模板的内容以添加到页面。

与询问密码相比，它对用户来说可能看起来不那么可疑；但除非作为有针对性的攻击，否则它不会起作用，因为如果将其发布在像论坛这样的公共场所，它可能会很快被标记。

* * *

我没有看到任何自动攻击，因为客户端和服务器之间没有数据来回传输。所有攻击都是客户端的，除了社交之外，任何可以修改您的 DOM 或在您的页面上调用 javascript 的客户端攻击都不需要这样做来执行 XSS。

* * *

请注意，如果需要社交工程[点击劫持](http://www.sectheory.com/clickjacking.htm)可以使用，通过在您的网站上使用多个 iframe，您的网站在下面的 iframe 中，攻击者可以隐藏表单是您网站上的表单的事实，但他们仍然需要欺骗用户将 javascript 代码复制粘贴到输入文本框中。

* * *

为了在不丢失 HTML 功能的情况下保护输入，您可以通过将诸如[stackoverflow](https://blog.stackoverflow.com/2008/06/safe-html-and-xss/)之类的代码移植到 javascript 来过滤 HTML（或者很好地要求获得实时预览中使用的 javascript 版本的许可证）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-27T12:13:01.267

> description.innerHTML = editor.value;

虽然确实不太可能说服用户通过键入合适的 <script> 标签来妥协自己，但真的有必要让他们键入 HTML 吗？如何简单地转义值：

```
function escapeMultiline(s) {
    return s.split('&').join('&amp;').split('<').join('&lt;').split('\n').join('<br />');
};

description.innerHTML= escapeMultiline(editor.value); 
```

然后用户可以愉快地键入 < 字符和换行符，而不会被误解为 HTML。

（当然，在回来的路上也有类似的脱逃。）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-07-18T17:14:11.860

不知道整个应用程序。我认为有可能攻击您的系统。如果他们可以从其他页面看到一些有效的 js/other 调用，他们可以在此页面中注入该代码以尝试更改您的后端数据。如前所述，可能取决于您构建系统的方式。

/阿尔贝托

# derby - 在生产模式下使用 Derby 或 HSQL 的经验

> ID：594445
> 
> 赞同：26
> 
> 时间：2009-02-27T11:48:41.997
> 
> 标签：derby, hsqldb

有人尝试过在生产环境中使用 Derby 或 HSQLDB 吗？有什么好的、坏的或丑陋的经历？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-07-28T11:21:16.887

[H2网站](http://www.h2database.com/)上有一个嵌入式数据库的比较（H2是另一个非常快的嵌入式Java DB，顺便说一句）：

*   [功能比较](http://www.h2database.com/html/features.html#comparison)
*   [性能比较](http://www.h2database.com/html/performance.html)

这应该给你一些事实。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2013-01-05T10:52:34.780

我在生产中使用 HSQLDB 进行协调应用程序。它可以很好地扩展到 50 万条记录，数据库大小接近 2 GB。

好
1）您可以调整内存。最初我们使用 2GB 堆运行，后来增加到 4GB 内存。您可以很好地为 CPU 调整内存。我们有不同的配置。512MB 执行 15 分钟，4GB RAM 执行 2 分钟。

2) 回退到基于磁盘。后来我们切换到基于文件的表，我们将堆从 4GB 减少到 512MB。但是程序除了与内存相关的配置外不需要任何更改。

很高兴有。1) 当分配的内存不足时，Windows 上的关机需要额外的时间。2）索引有点黑魔法。一旦我们在超过 6 列上添加了 50 万条记录的索引。过程很慢，我们删除了额外的索引。它没有伤害我们。

总的来说，当记录数少于几百万且数据库大小小于 10GB 时，我强烈推荐 HSQLDB。它甚至可能适用于更高的需求，但我不认为它们可能是直截了当的。可能是额外的文件可能会有所帮助。

顺便说一句，Fredt 对我在邮件列表中的问题非常迅速。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2011-05-13T10:38:53.060

看到这篇 [关于生产中超音速的 HSQLDB Hibernate 的帖子？](https://stackoverflow.com/questions/1642638/hibernate-on-hypersonic-in-production)

# regex - 如何在 Vim 的每一行末尾添加一个字符串？

> ID：594448
> 
> 赞同：294
> 
> 时间：2009-02-27T11:52:00.957
> 
> 标签：regex, vim, replace, match

我想添加`*`到 Vim 中每一行的末尾。

我尝试了代码不成功

```
:%s/\n/*\n/g 
```

* * *

## 回答 #1

> 赞同：410
> 
> 时间：2009-03-01T07:09:14.427

甚至比 :search 命令更短：

```
:%norm A* 
```

这就是它的意思：

```
 %       = for every line
 norm    = type the following commands
 A*      = append '*' to the end of current line 
```

* * *

## 回答 #2

> 赞同：399
> 
> 时间：2009-02-27T11:53:48.630

```
:%s/$/\*/g 
```

应该工作，所以应该`:%s/$/*/g`。

* * *

## 回答 #3

> 赞同：59
> 
> 时间：2013-08-08T18:44:25.813

我认为使用视觉块模式是处理这类事情的更好、更通用的方法。这是一个例子：

```
This is the First line.  
This is the second.  
The third. 
```

插入“Hello world”。（空格+剪贴板）在每一行的末尾：

*   在第一行的一个字符上，按 Ctrl-V（如果 Ctrl-V 是粘贴，则按 Ctrl-Q）。
*   按 jj 将可视块扩展到三行。
*   按 $ 将可视块扩展到每行的末尾。按 A，然后按空格，然后键入 Hello world。+ 然后 Esc。

结果是：

```
This is the First line. Hello world.  
This is the second. Hello world.  
The third. Hello world. 
```

（来自[Vim.Wikia.com](http://vim.wikia.com/wiki/Inserting_text_in_multiple_lines)的示例）

* * *

## 回答 #4

> 赞同：44
> 
> 时间：2009-02-27T19:37:45.207

还：

```
:g/$/norm A* 
```

还：

```
gg<Ctrl-v>G$A*<Esc> 
```

* * *

## 回答 #5

> 赞同：18
> 
> 时间：2014-07-16T09:59:25.463

如果你想在每一行的末尾添加 Hello world：

```
:%s/$/HelloWorld/ 
```

如果您想针对特定的行数执行此操作，例如从 20 到 30，请使用：

```
:20,30s/$/HelloWorld/ 
```

如果您想在每行的开头执行此操作，请使用：

```
:20,30s/^/HelloWorld/ 
```

* * *

## 回答 #6

> 赞同：9
> 
> 时间：2009-02-27T12:41:36.393

一种选择是：

> `:g/$/s//*`

这将找到每个行结束锚并将其替换为`*`. 我说的是“替代”，但实际上，它更像是一个附加，因为锚是一个特殊的东西，而不是一个常规字符。有关详细信息，请参阅[g 的幂 - 示例](http://vim.wikia.com/wiki/Power_of_g#Examples)。

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2013-06-15T12:36:41.390

最后你真的不需要`g`。所以它变成：

```
:%s/$/* 
```

或者，如果您只想`*`在结尾处使用，例如第 14-18 行：

```
:14,18s/$/* 
```

或者

```
:14,18norm A* 
```

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2012-01-18T17:28:44.660

...并在每一行前面加上 *，

```
%s/^/*/g 
```

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2009-02-27T12:05:37.227

```
:%s/\n/*\r/g
```

您的第一个在其他任何地方都是正确的，但由于某种原因，Vim 必须有不同的换行符处理。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2009-02-27T11:59:23.763

```
%s/\s*$/\*/g 
```

这将起到作用，并确保忽略前导空格。

# language-agnostic - 跨操作系统虚拟驱动器功能

> ID：594450
> 
> 赞同：11
> 
> 时间：2009-02-27T11:52:23.437
> 
> 标签：language-agnostic, cross-platform, virtual-drive

寻找在线资源以实现类似于所列产品中实现的虚拟驱动器功能![这里](https://stackoverflow.com/questions/593971/what-online-file-storage-system-do-use-use/593999#593999)

解决方案应该是跨操作系统（win、pc、linux），最好使用行为良好的框架。目前，这个问题的答案很分散，没有明确的选择：

我发现的当前建议：

1.  [保险丝](http://apps.sourceforge.net/mediawiki/fuse/index.php?title=OperatingSystems)（不太确定各种 windows 端口的状态）
2.  [多坎](http://dokan-dev.net/en/)图书馆
3.  自定义命名空间扩展（仅限 Windows，[各种](http://www.codeproject.com/KB/shell/shlext.aspx) [CodeProject](http://www.codeproject.com/KB/shell/namespcextguide1.aspx) [文章](http://www.codeproject.com/KB/shell/TipsInNSE_SubFld.aspx)中的来源）
4.  商业框架 (windows) - [LogicNP](http://www.ssware.com/eznamespaceextensions/eznamespaceextensions.htm) , [Eldos](http://www.eldos.com/)
5.  [WebDav](http://www.webdav.org/)

请为每个答案列出一个建议，我会相应地更新问题。该问题的目的是为此类问题创建最佳参考点...

似乎 WebDav 最容易实现跨操作系统，因此将不胜感激有关这方面的更多信息。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-27T16:19:44.527

一个简单的解决方案是为每个目标平台使用本机 SMB 客户端，然后使用它来挂载使用 Samba 的 VFS API 实现的自定义 Samba 文件系统。自定义 NFS 服务器已用于实现跨平台 Unix 虚拟文件系统，但 SMB 是支持 Windows 和 Linux 的更好选择。

如果您需要 VFS 来访问客户端资源，您必须在客户端上使用您的 VFS 运行 Samba 服务器，然后使用环回或本地主机网络来安装驱动器。Samba 被广泛移植，包括使用 Cygwin 作为适配器的 Win32 端口。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-03T17:08:42.427

WebDAV。在心跳中。它本质上是跨平台的，并且有大量的客户端支持，以及体面的开源服务器代码。Apache mod_dav 是你的朋友。

查看[Mac、Windows 和 Linux 上的 WebDAV 客户端支持](http://en.wikipedia.org/wiki/WebDAV#Implementations)：

*   [OS X 内置支持](http://www.webdavsystem.com/server/access/macosx)
*   Windows XP/Vista 内置支持（[驱动器映射](http://www.webdavsystem.com/server/access/map_drive)，[每个文件夹](http://www.webdavsystem.com/server/access/windows)）

开源 WebDAV 服务器：

*   [Apache mod_dav](http://httpd.apache.org/docs/2.0/mod/mod_dav.html)
*   [米尔顿（爪哇）](http://milton.ettrema.com/)

并且不要忘记查看[WebDAV 资源](http://www.webdav.org/)。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-04T05:42:20.680

我在所有提到的平台上都使用 Jungledisk 来备份和共享文件。如果您查看他们的[下载页面](http://jungledisk.com/desktop/download.aspx)，您会看到它兼容的所有平台。我在一个许可证下备份了我的网络服务器（CentOS x64）、Mac OSX 10.5 和双引导电脑（Vista/Fedora）！

*   所有版本都使用WebDav
*   Linux版本也有FUSE能力
*   使用 Amazon 经济实惠的 S3 存储平台
*   很快就会以 15 美分/gb 的价格添加云文件支持 (Mosso)，无需为 I/O 付费。

[丛林磁盘](http://jungledisk.com/)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-27T12:16:40.197

VirtualBox 的 VDI。它是开源的。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-06T14:55:28.057

SSHFS（主机端需要 SFTP）。它有一些错误，但我们总体上运气不错。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-08T09:43:20.007

您可以使用露天 JLAN。JLAN 是 CIFS、NFS 和 FTP 协议的 Java-Client 和 Java-Server 实现。使用 JLAN 可以通过网络共享文件，这些文件可以通过网络驱动器获得。

下载地址为[http://sourceforge.net/project/showfiles.php?group_id=143373&package_id=248550](http://sourceforge.net/project/showfiles.php?group_id=143373&package_id=248550)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-27T12:10:22.660

保险丝在 Windows 上不起作用。

我的选择是：

*   适用于 Unix/Mac 的 FUSE
*   [用于 Windows ( http://www.eldos.com/](http://www.eldos.com/) )的 EldoS 回调文件系统或过滤器（我们目前正在使用过滤器）

问候

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-27T12:11:34.983

[丛林盘](http://www.jungledisk.com/)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-27T13:31:27.350

那么简单的FTP呢？还是NAS？坚持使用标准协议，与它集成应该不会有任何问题。我曾经写过一个 Linux SFTP 文件系统扩展，但是现在大多数操作系统都支持用户模式文件系统，与你可能选择的任何东西集成应该不会太难。

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2009-03-03T17:25:35.177

[Microsoft Live Mesh](https://www.mesh.com/)将为您提供跨 Windows、Mac、您的在线 Mesh 存储和 Windows Mobile 手机的同步文件夹。

# wpf - WPF数据绑定，替换源对象

> ID：594451
> 
> 赞同：0
> 
> 时间：2009-02-27T11:52:27.570
> 
> 标签：wpf, data-binding, observablecollection

我有一些 UI 绑定到 T 类型的 ObservableCollection，其中“T”实现了 INotifyProperty 已正确更改。

问题是我需要在运行时完全换掉 ObservableCollection，因为它是从 SQL 调用中填充的。这显然会弄乱整个绑定，并且不会触发任何更改通知。

如何在运行时替换源对象而不丢失绑定？

代码大致是这样的

```
ObservableCollection<Issue> iss = Application.Current.FindResource("Issues") as ObservableCollection<Issue>;
iss = new ObservableCollection<Issue>();
PopulateCollection(iss); 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-27T11:56:58.637

只要公开集合的属性支持更改通知（因为它是依赖属性，或者因为它实现`INotifyPropertyChanged`），您就可以更改该属性。任何绑定到它的东西都会自动刷新到新的集合。

# c# - 在 Compact Framework (C#) 中调整大小（放大和缩小）

> ID：594454
> 
> 赞同：0
> 
> 时间：2009-02-27T11:55:47.687
> 
> 标签：c#, compact-framework, resize, bitmap

如何在 Compact Framework 上放大位图？我阅读了这篇文章和[http://geeks.netindonesia.net/blogs/clawford/archive/2008/04/20/resizing-bitmap-tutorial-in-net-cf.aspx](http://geeks.netindonesia.net/blogs/clawford/archive/2008/04/20/resizing-bitmap-tutorial-in-net-cf.aspx)，它只是为了使位图更小。

谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-27T15:07:05.060

[Imaging API](http://msdn.microsoft.com/en-us/library/aa452250.aspx)可用于调整大小。通常它们用于获取缩略图（使图像更小），但没有任何说明必须这样做。它只是提供了一个“ [CreateBitmapFromImage](http://msdn.microsoft.com/en-us/library/aa452205.aspx) ”方法，因此您可以随时将图像放大。

[有关API](http://opennetcf.com/library/sdf/html/5c29d99f-92fd-730a-ae57-c5b00e655a32.htm)的合理托管包装，请参阅[智能设备框架](http://www.smartdeviceframework.com)。

# php - ASP.NET 是否需要 2 种语言，而 PHP/Ruby 只需要一种？

> ID：594463
> 
> 赞同：0
> 
> 时间：2009-02-27T11:59:46.603
> 
> 标签：php, asp.net, programming-languages

我对婚礼开发和 web 2.0 很感兴趣，但我是一个真正的初学者，所以我阅读了很多有关所涉及技术的内容。由于大量的免费学习资源，我开始转向 ASP.NET。

然而，当我开始从事“Visual Web Developer Express”工作时，我注意到我需要了解 ASP 和 C# 或 VB。两种技术。

这对于 Ruby 或 PHP 是否相同。您是否需要学习两种语言/技术来制作 Web 应用程序（不包括 XHTML/CSS/XML），还是只学习 PHP/Ruby？

因此，对于初学者来说，从 PHP/RUBY 而不是 ASP.NET 和 C#/VB 开始是否更快（不是说更好！），因为您可以花时间学习一种语言而不是两种语言？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-27T12:02:48.140

ASP.NET**不是**一种编程语言。它是一种支持任何 .NET 语言编程的服务器端技术。因此，您不会被迫学习 2 种不同的*语言*。

这就像 PHP 和 Ruby。它们都可用于构建非基于 Web 的应用程序。当您使用 PHP 构建 Web 应用程序时，您实际上同时使用了 PHP 脚本语言和某种框架提供的功能，这些框架可以帮助您专门构建 Web 应用程序。这两件事还是一样的。

不同之处在于它们没有单独的名称。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-27T12:03:38.823

我不会将 ASP.NET 称为两种语言。您可以使用 C#、VB.Net 或其他东西来编写 ASP.NET 页面。

PHP 是一种以网页为中心的脚本语言。有些人会称它为模板语言，因为您可以将 PHP 嵌入到 HTML 文档中。有很多方法可以做 PHP，但如果你只想使用 PHP，你也可以。其他人则加入了特定框架（例如 Zend）、Smarty 等模板引擎等内容，但这些都是可选的。

另一方面，Ruby on Rails 是一个重量级的开发堆栈。它不封装持久性模式（活动记录），而是将 Javascript 库（原型）合并到堆栈中。这确实是一个端到端的解决方案，不具备一些重量较轻的堆栈的可互换性。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-27T12:08:58.170

为了方便您，您不必同时学习 VB 和 C#。只有一个会做。它们都适用于 ASP.Net。事实上，.Net 旗下的所有语言都可以与 ASP.net 一起使用。所以，完全不用担心。

如果你的背景是 VB 或 BASIC，那就选择 VB。如果您的背景是 C、C++、Java，或者您没有任何编程背景，那么请选择 C#。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-27T12:30:38.697

c# 和 VB 是语言，.NET 是框架。

所以我猜想最简单的方法是，c# 是 .NET 就像 ruby​​ 是 rails 一样。

# asp.net - ASP.NET 单元测试

> ID：594465
> 
> 赞同：0
> 
> 时间：2009-02-27T12:01:11.497
> 
> 标签：asp.net, visual-studio-2008, unit-testing

我正在寻找一个好的 ASP.NET 单元测试工具。谷歌搜索给了我一些工具，但我想从一个好的工具开始。

有使用这些工具的经验吗？

有没有办法使用 Visual Studio 2008 中的内置单元测试进行 ASP.NET 单元测试？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-27T12:02:14.427

我使用[了 WATIN](http://watin.sourceforge.net/)，我认为它非常强大。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-31T19:30:24.707

或者，您可以使用 Selenium RC。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-31T19:38:45.937

[nUnit](http://www.nunit.org/index.php)是我对 Visual Studio 内置单元测试的建议。

# optimization - 数值优化

> ID：594466
> 
> 赞同：4
> 
> 时间：2009-02-27T12:01:58.797
> 
> 标签：optimization, integer, double, computer-science

我想知道哪种 Integer 或 Float 类型最快。
我在想字节比整数快，因为它的范围更小。
有人告诉我..在某些情况下整数比一个字节快。

第二个问题：
GPU 正在走向世界统治..
所以我问自己：Double 能否比 Integer“更快”.. 因为 FPU
那么专家在哪里？:)

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-27T12:27:59.920

您必须考虑的不仅仅是时钟周期来执行算术。您可以说添加两个整数需要这么多周期，添加两个双精度数需要这么多周期，等等，但这可能不相关。如果您的所有数据同时适合缓存，那么对单个操作进行计时是有意义的。但如果不是，由于缓存未命中所需的额外时间将决定各个操作的差异。有时使用较小的数据类型会更快，因为它决定了是否必须从缓存中提取某些内容，或者是否必须转到磁盘。

如今，计算机将大部分时间都花在移动数据上，而不是进行算术运算，即使是在数字运算应用程序中也是如此。并且前者与后者的比例正在增加。例如，您不能简单地比较将 short 与 double 相乘所需的时间。您可能会发现，给定程序的两个版本，一个版本在小问题上运行得更快，而另一个版本在更大的程序上运行得更快，这都是因为各种内存的相对效率。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-27T12:13:49.627

> 我在想字节比整数快，因为它的范围更小。

我经历过的事情：使用 a`short`给了我性能上的打击，而使用 an`int`就好了。这是因为，架构上通常不存在短裤。它们是便利类型。处理器实际上使用它的字长。在我的例子中，字长是一个整数。因此，当访问一个 short 时，它必须首先将值打包到 int 中，使用它，然后解包并让我得到一个 short 的结果。所有这些都导致性能下降。所以，更短不一定更好。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-27T12:27:35.740

这取决于架构中没有数据位。浮点处理器在进行计算时将相同地对待 float 和 double。它们都以 80 位精度进行评估，因此将花费相同的时间。将值加载并保存到 FPU 寄存器中可能会有所不同。Double 在 RAM 中占用两倍的空间，因此可能会由于缓存未命中而变慢。如果您有倾向于随机索引的大型数组，则值得注意。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-27T12:55:11.040

在 CPU 级别，没有字节，只有字，现在是 32 位或 64 位。算术单元通常是硬连线来处理字大小的数字（或更大，在浮点的情况下）。

因此，在算术运算方面，使用小于一个单词的类型没有速度优势，并且可能会降低速度，因为您必须做额外的工作才能模拟 CPU 本身没有的类型，例如编写单个byte to memory 要求您首先读取它所在的单词，对其进行修改，然后将其写回。为了避免这种情况，大多数编译器实际上会为所有较小的变量使用一个完整的内存字，因此即使是布尔变量也会占用 32 位或 64 位。

但是，如果您有大量数据，例如大型数组，则使用较小的类型通常会产生更好的性能，因为您将有更少的缓存未命中。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-27T12:08:53.070

数字类型的字节长度取决于语言，有时还取决于您使用的平台。例如在 java 中，int 和 float 都使用 4 个字节，所以处理时间应该相等。尽管更长的类型处理得更快，但我会感到惊讶。如果有证据，我想读一读。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-27T12:10:42.020

关于哪个更快，整数或字节，只要它们都适合它们工作相同的寄存器，或者至少没有可测量的差异。

关于整数与双精度：可能是 GPU 使用双精度数比常规 cpu 执行更快的算术，但我怀疑它比整数更快地执行双精度算术，因为整数算术只是寄存器算术。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-27T12:12:34.387

最大的优化是从使用循环标量计算过渡到使用向量计算。然后利用 GPU 或 CPU 的 SSE。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-27T12:13:14.137

好吧，只要您不进行任何向量优化，您就可以使用与寄存器（32/64 位）一样大的整数，而不会影响任何实际性能。

浮点数有点不同：虽然 CPU 针对双精度进行了优化，但 GPU 通常使用浮点数。

# c# - 我的 ListView 选择事件处理是否遗漏了什么

> ID：594470
> 
> 赞同：1
> 
> 时间：2009-02-27T12:03:26.420
> 
> 标签：c#, winforms, listview

...或者 c# listviews 真的是管理起来的噩梦吗？

好的，我正在处理的问题非常简单。或者至少看起来是这样：

我有一个文本文件，其中包含有关客户订单信息的单独行。数据项用分号隔开。

我的表单遍历这些订单，将项目信息放入哈希表，并将每个哈希表放入主哈希表。关于每个订单（产品/订单#/客户名称/客户#）的一些摘要信息显示在我的列表视图中，由可排序的列分隔。列表视图下方是一个选项卡控件，其中包含分布在三个选项卡中的订单详细信息的可编辑部分的文本框。

这是我想要发生的事情：

*   用户单击单个条目：选项卡控件文本框填充订单详细信息。
*   用户在选项卡控件中编辑详细信息。
*   用户单击另一个订单：确认消息检查是否应提交更改，如果“是”，则应将详细信息保存回相关的哈希表并更新列表视图中的显示。
*   用户选择多个列表视图项目：顶部项目应该在选项卡控件中是可编辑的。
*   用户按下表单顶部工具条上的“删除项目”按钮：项目从哈希表中删除，列表视图控件更新以反映删除。整个选项卡控件的文本框都设置回空白。

在我看来，这是非常普通和合理的行为。我猜想使用 SelectedIndexChanged 事件将提供进行数据工作的机会。但是该事件在每次选择/取消选择时触发两次，并且并不总是清楚哪些项目应该在列表视图中更新。

用于测试刚刚发生什么样的“选择/取消选择”并决定应该采取什么行动的代码开始变得很长，我只是想知道我是否让事情变得太复杂了。

所以：

*   是否有其他事件可以用来实现我的功能目标？或者
*   是否有关于 SelectedIndexChanged 事件的一些我不知道的东西，这将有助于程序决定它在任何给定点应该做什么？或者
*   我只是以错误的方式解决这个问题吗？

任何建议，甚至是关于重新设计我的表格的建议都将受到欢迎。

编辑：在尝试从不同的角度解决这个问题时，我正在将我的主哈希表更改为排序列表。问题的其余部分保持不变。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-27T13:36:04.827

在不知道“开始变得很长”的代码的情况下，我会建议以下内容：

确保 Listview1.MultiSelect 为假。使用表单上的字段（或属性）来跟踪 SelectedItem。在这种情况下，检查新的 ListView1.Selecteditems[0] != this.SelectedItem

第 2 部分：查看作为替代解决方案的 DataGridView 和 DataTables。您的数据听起来很“相关”，并且数据内容具有很多过滤/排序/链接功能。您可以将 List 作为 DataSource 附加到 Grid 或进一步将数据读入 DataTables。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-02T20:36:08.160

`SelectedIndexChanged`不是在触发时更新 UI，而是`ListView`从`Timer`一个短的`Duration`（比如默认的 100 毫秒）开始，然后在`Timer.Tick`处理程序中进行 UI 更新。

例如：

1.  将`ListView`和`Timer`拖到您的 WinForm 上
2.  `ListView`使用设计器将项目选择添加到
3.  `ListView`为的`SelectedIndexChanged`事件和`Timer` `Tick`事件添加处理程序
4.  将现有代码替换为：

* * *

```
private void listView1_SelectedIndexChanged(object sender, EventArgs e)
{
    timer1.Start();
}

private string GetIndices()
{
    string indices = "";
    foreach (int i in listView1.SelectedIndices)
    {
        indices += i.ToString() + ", ";
    }

    if (indices.Length > 0)
    {
        indices = indices.Substring(0, indices.Length - 2);
    }

    return indices;
}

private void timer1_Tick(object sender, EventArgs e)
{
    timer1.Stop();
    Debug.WriteLine(DateTime.Now.ToString("HH:mm:ss.fff") +
        ". Selected indices = " + GetIndices());
} 
```

* * *

这是有效的，因为取消选择和重新选择事件彼此非常接近地连续发生 - 比`Timer`'s快`Duration`。以`Timer`这种方式使用 意味着该对将被视为单个复合事件。

我希望这有帮助。

# version-control - Visual SourceSafe 中的源代码更改通知可能吗？

> ID：594474
> 
> 赞同：2
> 
> 时间：2009-02-27T12:04:06.543
> 
> 标签：version-control, visual-sourcesafe

我们能否将 Visual SourceSafe 服务器配置为将源代码更改的电子邮件通知发送到预定义的邮件列表？

最好的问候马纳夫夏尔马

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-27T12:06:15.697

不是直接通过 VSS 本身基于实际通知（即，没有人在幕后轮询）TTBOMK，但如果你找到了一个可以监控 VSS Shadow 目录的工具[你需要配置]，它会起作用，即使不漂亮...

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-10-28T17:24:11.007

至少还有两种方法：

1.  通过利用[VSS 自动化](http://msdn.microsoft.com/en-us/library/Bb509341)，但绝对不适合胆小的人，
2.  通过使用商业插件，例如[SourceVizor 的 FileWatch](http://www.sourcevizor.com/default.php)。

# flash - 调用在 MovieClip - ActionScript 2 中定义的函数

> ID：594488
> 
> 赞同：0
> 
> 时间：2009-02-27T12:09:16.767
> 
> 标签：flash, actionscript

我有一个附加了 attachMovieClip 的影片剪辑，其中有一个名为 test() 的函数

///

```
function test()
{
   trace('!');
} 
```

附加影片剪辑后，我试图调用该函数，但我根本做不到。有一个简单的解决方案吗？我读过一些关于你的东西，在剪辑完全加载之前你不能调用这个函数......有没有一个简单的解决方案？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-01T14:52:31.880

您可以在主时间轴中定义影片剪辑之外的函数。然后，附加它（通过 attachMovie），您可以通过 initObject（第 4 个参数）传递它：

```
function test(p) {
    trace("called with "+p);
}
this.attachMovie("lib_clip","clip_mc",3,{func:test, mp:"my parameter"});
clip_mc._x = 100;
clip_mc._y = 100;
clip_mc.onRelease = function() {
    this.func(this.mp);
}; 
```

维格

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-27T20:04:45.813

确保在 MovieClip 时间线的第一帧上定义了函数“测试”。然后使用 MovieClip.onLoad 处理程序来捕获 MovieClip 何时准备好接收函数调用。之后，您应该可以在剪辑上调用“测试”。

祝你好运！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-02T22:33:28.347

自从我使用 AS2 以来已经有一段时间了，因为 AS3 摇滚，但我相信您需要为附加的影片剪辑提供实例 ID。而且您还需要等到电影准备好。

```
//MovieClip with function hello() in it.
hello():Void
{
    trace('Hello world!');
}

//Root timeline of main movie.
container.attachMovieClip("nameInLibraryToAttach", "instanceID", depth);

//The following will not trace because it happens to soon.
container.instanceID.hello();

//The following works
var runOnceNumber:Number = 0;
var interval:Number = setInterval(someFunction, 1000);

someFunction():Void
{
    container.instanceID.hello();
    runOnceNumber++;

    clearInterval(interval);
} 
```

您需要做的是设置带有嵌入式功能的 MovieClip 以在准备好时广播事件并从主服务器收听它，或者像 setInterval 这样可能只需要一个滴答声的东西。我用 setInterval 对其进行了测试，它首先工作。同样，您需要等到它“INITIALIZED”，这意味着它在第 1 帧上的所有代码都已加载并可用。考虑一下 ActionScript 3，因为通过它的事件驱动流，这样的事情非常容易。

# .net - Which list/collection type is best to use in a WCF data contract?

> ID：594499
> 
> 赞同：16
> 
> 时间：2009-02-27T12:10:37.840
> 
> 标签：.net, wcf, datacontract

When defining a WCF data contract, which type should one use for collections/lists?

*   Should it be ICollection<T>, IList<T>, T[] or...?
*   Should I use interface types or the concrete types?
*   What trade offs are there to consider?

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-02-27T12:46:17.397

note: I'm answering this from the **client's** perspective - i.e. the `/collectionType:<type>` switch on `svcutil.exe` (also available in the IDE).

Personally, I tend to keep it simple and use `List<T>`. If you are going to do lots of data binding, `BindingList<T>` might be an option, but for object properties it is usually overkill. Arrays make life very hard... avoid them ;-p

Note that with .NET 3.5 the features available to each collection type blur, thanks to the extension methods on `Enumerable`.

Normally, `Collection<T>` is useful when you think you might want to subclass the collection to use the `virtual` extension points. This isn't really an option with WCF.

As already stated, using `IList<T>` etc isn't an option unless you are using assembly sharing, since the generated class won't be able to create the collection.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-27T12:14:00.670

You can not use interface type in datacontract because the serializer won't work with interface type properties.

You can use concrete type e.g. MyClass[] or List

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-27T12:39:14.590

Aside from the fact that you can't use interface types, it doesn't really matter which of the collection types you use. The client of your service will never see them.

Remember that web services provide a descriptionj of the service to the client in terms of WSDL or mex. In the case of WSDL, the client will receive an XML Schema describing the messages to be sent and received. In the case of a collection, the client will simply see an element with a maxOccurs="unbounded" instead of one with maxOccurs="1". The client may interpret this as an array, or list, or whatever. No matter which collection you return from your service, the client will see maxOccurs="unbounded" and interpret it as it likes.

The exception would be returning a dictionary of some kind, and I don't know how that works.

# c# - 发布模式下的应用程序失败

> ID：594505
> 
> 赞同：1
> 
> 时间：2009-02-27T12:11:45.030
> 
> 标签：c#, asp.net, crash, release

我的 ASP.NET 应用程序有问题。在没有禁用调试模式的情况下，它已经开发了大约一年左右。我想测试它是否在没有调试的情况下工作，但不是，但是当我设置 debug="true" 时，它工作正常。

当我第一次尝试打开应用程序时，它给了我“服务器不可用”错误。在事件日志中，我有两个错误：

1.  .NET 运行时 2.0 错误 - 错误应用程序 aspnet_wp.exe，版本 2.0.50727.3082，标记 492b8702，错误模块 kernel32.dll，版本 5.1.2600.3119，标记 46239c44，调试？0，故障地址0x00012a5b。
2.  ASP.NET 2.0.50727.0 - 进程 aspnet_wp.exe (PID: 4932) 意外结束（可能写的有点不同，已翻译）。

我的 IIS 版本是 5.1，在 Windows XP 上运行。

我会很感激任何建议。

更新：在 web.config 中更改了调试模式

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-03T13:22:39.287

您所描述的崩溃发生在 kernel32.dll 中 - 这可能表明这不是托管代码内部的崩溃，而是 .NET 引擎本身（呃） - 在这种情况下，验证预编译器路径等会不会产生任何积极的结果（恕我直言）。

我建议您尝试通过“二进制搜索”（对于罪魁祸首）解决此问题:-)。作为第一次“迭代”，我将创建一个简单的 aspx 页面 (/Test.aspx)，禁用调试模式并尝试点击该页面（没有代码隐藏，只是带有标题和 Hello，world 正文的基本 HTML）。这将验证 ASP.NET 是否已安装并在您的 IIS 服务器上正常工作。

如果这个最简单的页面再次失败，我建议@JSC 在评论中提到的内容：在 IIS 上重新注册 ASP.NET：

```
rem (reregister ASP.NET in IIS)
rem (run as administrator!)
%SystemRoot%\Microsoft.NET\Framework\v2.0.50727\aspnet_regiis.exe -i 
```

一旦最简单的页面运行，我会添加简单的代码隐藏，试试看。一旦代码隐藏运行，我会尝试通过剥离所有代码隐藏来更新应用程序的真实起始页面，只留下标记并尝试点击页面 - 是的，它看起来很糟糕，但至少它可能会显示:-) . 之后，我会尝试只添加初始化逻辑，看看情况如何......

本质上，您需要找到应用程序中导致崩溃的任何“事物”。我认为这两个极端是：标记+没有代码后面=工作，标记+所有代码后面=崩溃；二进制搜索“方法”将启用一半的代码，看看它是否仍然显示（我们现在不担心功能 - 当然它不会按预期运行）。如果它不显示，请禁用前半部分的后半部分（即只有四分之一的代码将处于活动状态），试试看。继续前进，直到您将搜索限制在有问题的区域...

我建议的另一种方法是在虚拟机上安装 Server 2003 (IIS6) / Server 2008 (IIS7) - VirtualPC、VMWare、VirtualBox（如果您无法访问 MSDN 下载的服务器映像，您可以随时下载试用版 - Server 2008 试用版有效期为 60 天，外加两次“重置”）。在虚拟机中安装干净的操作系统后，尝试部署您的应用程序并查看它在该环境中的行为。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-27T17:11:00.317

我建议您根据包含非调试代码的断言检查您的代码。我在编写代码时犯了几次常见错误，如下所示：

断言（doSomeCrucialOperation（））；

在发布模式下编译时，不会编译带有操作调用的整个 Assert。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-27T17:53:34.160

确保您没有任何检查调试环境的条件代码。我曾经花了几天时间试图追踪一个随机的崩溃错误......最终遇到了这样的事情：

```
#ifdef DEBUG
  threadPoolCount = 1;
#else
  threadPoolCount = 16; 
```

你猜怎么着......这是一个线程错误！在 C# 中，它看起来更像这样：

```
[Conditional("Debug")] 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-06T10:27:34.003

发布调试总是很棘手，因为调试问题所依赖的一件事就是首先阻止它失败。因此，您必须即兴发挥并返回您可以使用的工具列表。

稍微减少问题：在代码块之后删除/禁用块，直到它停止崩溃，然后重新启用位以使其再次崩溃，从而缩小问题范围。将问题从“它在某处崩溃”分解为“它*在此处*某处崩溃”。

记录东西。比平时记录更多。乐观地记录（“程序到达这一点，X={0}”）。使用良好的日志记录子系统，您始终可以保留它们并禁用输出。然后，您可以分析程序到故障点的路径并确定问题可能出在哪里。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-27T18:31:51.013

关于类似问题有一个较旧的问题：

[程序仅在发布版本时崩溃——如何调试？](https://stackoverflow.com/questions/186237/program-only-crashes-as-release-build-how-to-debug)

这也可能有帮助：

[http://blogs.msdn.com/rahulso/archive/2006/03/02/what-is-a-crash-technically-in-asp-net-and-what-to-do-if-it-happens。 aspx](http://blogs.msdn.com/rahulso/archive/2006/03/02/what-is-a-crash-technically-in-asp-net-and-what-to-do-if-it-happens.aspx)

您是否尝试使用（远程）调试器附加到进程，即使它不是在调试模式下构建的？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-06T13:13:20.657

[使用DebugDiag](http://www.microsoft.com/downloadS/details.aspx?FamilyID=28bd5941-c458-46f1-b24d-f60151d875a3&displaylang=en)工具监视您的站点并捕获所有泄漏。记得安装 PDB。

更多信息请阅读“[生产环境中的应用程序调试](http://www.microsoft.com/downloadS/details.aspx?FamilyID=28bd5941-c458-46f1-b24d-f60151d875a3&displaylang=en)”

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-07T05:57:27.030

尝试清除临时 DLL

```
iisreset /stop
del "%windir%\Microsoft.NET\Framework\v2.0.50727\Temporary ASP.NET Files\*.*" /s/f
iisreset /start 
```

确保正确释放非托管资源。使用 USING 和 .Dispose。

# wpf - wpf类outlook界面

> ID：594506
> 
> 赞同：-1
> 
> 时间：2009-02-27T12:12:13.170
> 
> 标签：wpf, user-interface, interface, outlook

任何人都可以向我指出如何在 WPF 中创建类似 Outlook 的界面的教程吗？谢谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-27T12:31:36.917

你可以在[这里](http://blogs.msdn.com/tims/archive/2007/06/13/wpf-hands-on-lab-build-an-outlook-2007-ui-clone.aspx)找到它。请注意，您可以在 Google 的帮助下自己轻松找到它。

# c# - C# app.config 格式问题

> ID：594513
> 
> 赞同：0
> 
> 时间：2009-02-27T12:13:56.193
> 
> 标签：c#, xml, events, app-config, handler

如果 app.config 格式错误，例如不是格式正确的 XML 文件，应用程序将无法加载。是否有任何方法可以让我知道此类问题 - 例如，如果 app.config 由于格式错误的 XML 文件而加载错误，则接收一些事件（以便我可以编写文件日志和事件日志来记录此问题）？

提前谢谢，乔治

我的代码和 app.config 看起来像这样，但没有抛出异常。

```
 class Program
    {
        public static void MyEventHandler(object sender, EventArgs e)
        {
            return;
        }

        static void Main(string[] args)
        {
            AppDomain currentDomain = AppDomain.CurrentDomain;
            currentDomain.UnhandledException += MyEventHandler;

            return;
        }
    }

<?xml version="1.0" encoding="utf-8" ?>
<configuration>
<configuration> 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-27T12:20:55.630

在您的应用程序启动中，例如在主类的静态构造函数中。您可以将其定义为

```
 AppDomain currentDomain = AppDomain.CurrentDomain;
  currentDomain.UnhandledException += MyHandler; // define MyHanlder somewhere. 
```

捕获由于配置引起的 ConfigurationErrorsException。

# c# - SortedList 上是否有下界函数 ?

> ID：594518
> 
> 赞同：28
> 
> 时间：2009-02-27T12:15:13.243
> 
> 标签：c#, .net, sortedlist

上是否有下界函数`SortedList<K ,V>`？该函数应返回等于或大于指定键的第一个元素。有没有其他类支持这个？

伙计们 - 请再读一遍这个问题。**我不需要返回密钥（如果存在）的函数。我对没有精确键匹配的场景感兴趣。**

**我对 O(log n) time 感兴趣**。这意味着我对 foreach 循环没有问题，而是希望有一种有效的方法来做到这一点。

我对此做了一些测试。

编译器和运行时机器都没有优化 Linq 语句，因此它们遍历所有集合元素并且速度慢 O(n)。基于 Mehrdad Afshari 的回答，这里是在 Keys 集合上以 O(log n) 工作的二进制搜索：

```
public static int FindFirstIndexGreaterThanOrEqualTo<T>(
            this IList<T> sortedCollection, T key
        ) where T : IComparable<T> {
    int begin = 0;
    int end = sortedCollection.Count;
    while (end > begin) {
        int index = (begin + end) / 2;
        T el = sortedCollection[index];
        if (el.CompareTo(key) >= 0)
            end = index;
        else
            begin = index + 1;
    }
    return end;
} 
```

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2009-02-27T12:20:01.390

`SortedList.Keys`对集合进行二进制搜索。

开始了。这是 O(log *n* )：

```
private static int BinarySearch<T>(IList<T> list, T value)
{
    if (list == null)
        throw new ArgumentNullException("list");
    var comp = Comparer<T>.Default;
    int lo = 0, hi = list.Count - 1;
    while (lo < hi) {
            int m = (hi + lo) / 2;  // this might overflow; be careful.
            if (comp.Compare(list[m], value) < 0) lo = m + 1;
            else hi = m - 1;
    }
    if (comp.Compare(list[lo], value) < 0) lo++;
    return lo;
}

public static int FindFirstIndexGreaterThanOrEqualTo<T,U>
                          (this SortedList<T,U> sortedList, T key)
{
    return BinarySearch(sortedList.Keys, key);
} 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-27T12:36:23.237

我会使用 LINQ（假设您使用的是 C#3），但是使用带有谓词的 FirstOrDefault 的重载：

```
first = sortedList.FirstOrDefault(x => x >= theObjectForComparison); 
```

（许多其他 Enumerable 方法也可以采用谓词，这是一个不错的捷径）

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-27T12:20:06.273

不知道，但这是一个简单的 LINQ 语句：

```
first = sortedList.Where(x => x >= theObjectForComparison).FirstOrDefault(); 
```

`first`要么是第一个通过比较的对象，要么是`default(T)`（通常是`null`）。

**编辑**

DaveW 的版本：

```
first = sortedList.FirstOrDefault(x => x >= theObjectForComparison); 
```

做同样的工作，但可能会更快，但你必须测试它。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-27T12:39:09.533

或者您可以编写自己的扩展方法来执行此操作。请注意，不保证所有这些功能都按顺序执行。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2021-03-16T07:55:21.767

> SortedList<K ,V> 上是否有下界函数？该函数应返回等于或大于指定键的第一个元素。

此示例作为对 SortedList 的扩展实现，它返回大于或等于提供的键的最小元素的值。如果所有键都小于提供的键或提供了空列表，则返回 default(TValue)

```
public static TValue LowerBound<TKey, TValue>(this SortedList<TKey, TValue> list, TKey key) {
  if (list.Count == 0)
    return default;

  var comparer = list.Comparer;
  if (comparer.Compare(list.Keys[list.Keys.Count - 1], key) < 0)
    return default; // if all elements are smaller, then no lower bound

  int first = 0, last = list.Count - 1;
  while (first < last) {
    var middle = first + (last - first) / 2;
    if (comparer.Compare(list.Keys[middle], key) >= 0)
      last = middle;
    else
      first = middle + 1;
  }
  return list[list.Keys[last]];
} 
```

使用示例：

```
SortedList<string, Object> myList = new SortedList<string, Object>();
...
var value = myList.LowerBound<string, Object>("theKey"); 
```

* * *

## 回答 #6

> 赞同：-2
> 
> 时间：2013-05-16T21:51:28.800

希望这应该更快，具体取决于 SortedList 的实现。

```
public static int FindFirstIndexGreaterThanOrEqualTo<K, V>(
        this SortedList<K, V> sortedCollection, K key
    ) where V : new()
{
    if (sortedCollection.ContainsKey(key))
    {
        return sortedCollection.IndexOfKey(key);
    }
    sortedCollection[key] = new V();
    int retval = sortedCollection.IndexOfKey(key);
    sortedCollection.Remove(key);
    return retval;
} 
```

# c++ - 带有自定义模板的 STL 迭代器

> ID：594521
> 
> 赞同：4
> 
> 时间：2009-02-27T12:17:07.263
> 
> 标签：c++, xcode, gcc, stl

我有以下模板方法，

```
template <class T>
void Class::setData( vector<T> data )
{    
    vector<T>::iterator it;
} 
```

我收到以下编译错误（ XCode/gcc ）

> 错误：预期的 `;' 在“它”之前

我在这里发现了其他有类似问题的人[（仔细阅读以查看它是相同的，即使它以不同的问题开始）](http://www.codeguru.com/forum/archive/index.php/t-221670.html)但他们似乎已经通过更新 Visual Studio 解决了。这让我猜测这是一个编译器问题，它应该编译，对吗？通过从 0 到 size 的索引进行迭代是可行的，但这不是我希望实现此功能的方式。还有其他方法吗？谢谢

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-02-27T12:53:12.917

何时使用`typename`关键字的经典案例。希望你已经`#include`-ed`vector`并且`iterator`有一个`using namespace std;`范围内的某个地方。采用：

```
typename vector<T>::iterator it; 
```

查找从属名称。[从这里](http://pages.cs.wisc.edu/~driscoll/typename.html)开始。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-27T12:53:43.757

我认为您缺少一个`typename`：

```
#include <vector>
using namespace std;

class Class{
public:
    template <class T>
    void setData( vector<T> data ) {
        typename vector<T>::iterator it;
    }
}; 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-27T12:30:44.343

尝试：

```
template <class T>
void Class::setData( std::vector<T> data )
{    
    std::vector<T>::iterator it;
} 
```

只是它是一个缺失的`using`陈述吗？

# c++ - 你什么时候会使用数组而不是向量/字符串？

> ID：594522
> 
> 赞同：12
> 
> 时间：2009-02-27T12:17:23.877
> 
> 标签：c++, arrays, string, vector

我是一名初学者 C++ 程序员，所以我学会了使用数组而不是向量（这似乎是做事的一般方式，然后再转向向量）。

我注意到关于 SO 的很多答案都建议在数组上使用向量，在 char 数组上使用字符串。这似乎是用 C++ 编写代码的“正确”方式。

话虽如此，什么时候仍然值得使用经典的数组/字符*（如果有的话）？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-02-27T12:23:27.933

在编写应该在其他项目中使用的代码时，特别是如果您针对可能不存在 STL 的特殊平台（嵌入式、游戏控制台等）。

旧项目或有特殊要求的项目可能不想引入对 STL 库的依赖。一个依赖于数组、char* 或任何与任何东西兼容的接口，因为它是语言的一部分。但是，不能保证 STL 存在于所有构建环境中。

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2009-02-27T14:54:51.657

***绝不。***

如果原始数组似乎比向量更好的解决方案（出于此处所述的其他原因），那么我在 C++11 编译器（或[**boost::array**](http://www.boost.org/doc/libs/1_38_0/doc/html/array.html) **）中使用std::tr1::array**或 std::array 。它只是简单地检查我无论如何都会做的检查，并且大小值的使用使 DRY 自动实现（例如，我在循环中使用大小，以便将来对数组声明的更改将自动起作用）。[](http://www.boost.org/doc/libs/1_38_0/doc/html/array.html)

 **无论如何，数组实现“是”一个带有检查并提供大小常量的原始数组，因此也很容易在嵌入式代码中获取数组代码，因为该代码对于任何编译器[来说都不是真的“太聪明” 。](http://www.boost.org/doc/libs/1_38_0/doc/html/boost/array.html)至于编译器支持模板，我会在我的代码中复制 boost 标头，以允许我使用这个而不是原始数组。因为使用原始数组显然太容易出错了。[原始数组是*邪恶*的。](http://www.parashift.com/c++-faq-lite/containers.html)它们容易出错。

它与 STL 算法（如果可用）配合得很好。

现在，有两种情况**需要**使用原始数组（义务）：当您使用纯 C 代码时（不与 C 代码通信，而是编写纯 C 代码部分，如 C 库）。但那是*另一种语言*。

另一个原因是编译器根本不支持模板......

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-02-27T14:58:52.380

这个问题实际上可以分为两部分：

1.  我应该如何管理平面数组数据的内存？
2.  我应该如何访问平面数组的元素？

我个人更喜欢使用 std::vector 来管理内存，除非我需要保持与不使用 STL 的代码的兼容性（即**与直接 C 代码交互时**）。**使用通过 new 或 malloc 分配的原始数组编写异常安全**代码要困难得多（部分原因是很容易忘记您需要担心它）。有关原因，请参阅任何有关[RAII的文章。](http://en.wikipedia.org/wiki/Resource_acquisition_is_initialization)

在实践中，**std::vector 被实现为一个平面数组**。因此，始终可以提取原始数组并使用 C 风格的访问模式。我通常从向量下标运算符语法开始。对于某些编译器，在生成调试版本时，向量会提供自动**边界检查**。这很慢（对于紧密循环，通常会减慢 10 倍），但有助于发现某些类型的错误。

如果在特定平台上的分析表明 operator[] 是一个瓶颈，那么我切换到直接访问原始数组。有趣的是，根据编译器和操作系统，***有时使用 STL 向量比使用原始数组更快***。

以下是一个简单测试应用程序的一些结果。它是使用 Visual Studio 2008 在 32 位发布模式下使用 /O2 优化编译的，并在 Vista x64 上运行。使用 64 位测试应用程序可以获得类似的结果。

```
Binary search...
           fill vector (for reference) :  0.27 s
                   array with ptr math :  0.38 s <-- C-style pointers lose
                  array with int index :  0.23 s <-- [] on raw array wins
            array with ptrdiff_t index :  0.24 s
                 vector with int index :  0.30 s  <-- small penalty for vector abstraction
           vector with ptrdiff_t index :  0.30 s

Counting memory (de)allocation...
                memset (for reference) :  2.85 s
      fill malloc-ed raw array with [] :  2.66 s
     fill malloc-ed raw array with ptr :  2.81 s
         fill new-ed raw array with [] :  2.64 s
        fill new-ed raw array with ptr :  2.65 s
                  fill vector as array :  3.06 s  \ something's slower 
                           fill vector :  3.05 s  / with vector!

NOT counting memory (de)allocation...
                memset (for reference) :  2.57 s
      fill malloc-ed raw array with [] :  2.86 s
     fill malloc-ed raw array with ptr :  2.60 s
         fill new-ed raw array with [] :  2.63 s
        fill new-ed raw array with ptr :  2.78 s
                  fill vector as array :  2.49 s \ after discounting the  
                           fill vector :  2.54 s / (de)allocation vector is faster! 
```

代码：

```
#define WINDOWS_LEAN_AND_MEAN
#include <windows.h>
#include <string>
#include <vector>
#include <stdio.h>

using namespace std;

__int64 freq; // initialized in main
int const N = 1024*1024*1024/sizeof(int)/2; // 1/2 GB of data
int const nIter = 10;

class Timer {
public:
  Timer(char *name) : name(name) {
    QueryPerformanceCounter((LARGE_INTEGER*)&start);
  }
  ~Timer() {
    __int64 stop;
    QueryPerformanceCounter((LARGE_INTEGER*)&stop);
    printf("  %36s : % 4.2f s\n", name.c_str(), (stop - start)/double(freq));
  }
private:
  string const name;
  __int64 start;
};

template <typename Container, typename Index>
int binarySearch_indexed(Container sortedArray, Index first, Index last, int key) {
  while (first <= last) {
    Index mid = (first + last) / 2; // NOT safe if (first+last) is too big!
    if (key > sortedArray[mid])      first = mid + 1;
    else if (key < sortedArray[mid])  last = mid - 1; 
    else return mid;  
  }
  return 0; // Use "(Index)-1" in real code
}

int Dummy = -1;
int const *binarySearch_ptr(int const *first, int const *last, int key) {
  while (first <= last) {
    int const *mid = (int const *)(((unsigned __int64)first + (unsigned __int64)last) / 2);  
    if (key > *mid)      first = mid + 1;
    else if (key < *mid)  last = mid - 1; 
    else return mid;  
  }
  return &Dummy; // no NULL checks: don't do this for real
}

void timeFillWithAlloc() {
  printf("Counting memory (de)allocation...\n");
  { 
    Timer tt("memset (for reference)");
    int *data = (int*)malloc(N*sizeof(int));
    for (int it=0; it<nIter; it++) memset(data, 0, N*sizeof(int));
    free(data);
  }
  { 
    Timer tt("fill malloc-ed raw array with []");
    int *data = (int*)malloc(N*sizeof(int));
    for (int it=0; it<nIter; it++) for (size_t i=0; i<N; i++) data[i] = (int)i;
    free(data);
  }
  { 
    Timer tt("fill malloc-ed raw array with ptr");
    int *data = (int*)malloc(N*sizeof(int));
    for (int it=0; it<nIter; it++) {
    int *d = data;
    for (size_t i=0; i<N; i++) *d++ = (int)i;
    }
    free(data);
  }
  { 
    Timer tt("fill new-ed raw array with []");
    int *data = new int[N];
    for (int it=0; it<nIter; it++) for (size_t i=0; i<N; i++) data[i] = (int)i;
    delete [] data;
  }
  { 
    Timer tt("fill new-ed raw array with ptr");
    int *data = new int[N];
    for (int it=0; it<nIter; it++) {
    int *d = data;
    for (size_t i=0; i<N; i++) *d++ = (int)i;
    }
    delete [] data;
  }
  { 
    Timer tt("fill vector as array");
    vector<int> data(N); 
    for (int it=0; it<nIter; it++) {
      int *d = &data[0]; 
    for (size_t i=0; i<N; i++) *d++ = (int)i;
    }
  }
  { 
    Timer tt("fill vector");
    vector<int> data(N); 
    for (int it=0; it<nIter; it++) for (size_t i=0; i<N; i++) data[i] = (int)i;
  }
  printf("\n");
}

void timeFillNoAlloc() {
  printf("NOT counting memory (de)allocation...\n");

  { 
    int *data = (int*)malloc(N*sizeof(int));
    {
      Timer tt("memset (for reference)");
      for (int it=0; it<nIter; it++) memset(data, 0, N*sizeof(int));
    }
    free(data);
  }
  { 
    int *data = (int*)malloc(N*sizeof(int));
    {
      Timer tt("fill malloc-ed raw array with []");
      for (int it=0; it<nIter; it++) for (size_t i=0; i<N; i++) data[i] = (int)i;
    }
    free(data);
  }
  { 
    int *data = (int*)malloc(N*sizeof(int));
    {
      Timer tt("fill malloc-ed raw array with ptr");
      for (int it=0; it<nIter; it++) {
        int *d = data;
        for (size_t i=0; i<N; i++) *d++ = (int)i;
      }
    }
    free(data);
  }
  { 
    int *data = new int[N];
    {
      Timer tt("fill new-ed raw array with []");
      for (int it=0; it<nIter; it++) for (size_t i=0; i<N; i++) data[i] = (int)i;
    }
    delete [] data;
  }
  { 
    int *data = new int[N];
    {
      Timer tt("fill new-ed raw array with ptr");
      for (int it=0; it<nIter; it++) {
        int *d = data;
        for (size_t i=0; i<N; i++) *d++ = (int)i;
      }
    }
    delete [] data;
  }
  { 
    vector<int> data(N); 
    {
      Timer tt("fill vector as array");
      for (int it=0; it<nIter; it++) {
        int *d = &data[0]; 
        for (size_t i=0; i<N; i++) *d++ = (int)i;
      }
    }
  }
  { 
    vector<int> data(N); 
    {
      Timer tt("fill vector");
      for (int it=0; it<nIter; it++) for (size_t i=0; i<N; i++) data[i] = (int)i;
    }
  }
  printf("\n");
}

void timeBinarySearch() {
  printf("Binary search...\n");
  vector<int> data(N); 
  {
    Timer tt("fill vector (for reference)");
    for (size_t i=0; i<N; i++) data[i] = (int)i;
  }

  {
    Timer tt("array with ptr math");
    int sum = 0;
    for (int i=-1000000; i<1000000; i++) {
      sum += *binarySearch_ptr(&data[0], &data[0]+data.size(), i);
    }
  }
  {
    Timer tt("array with int index");
    int sum = 0;
    for (int i=-1000000; i<1000000; i++) {
      sum += data[binarySearch_indexed<int const *, int>(
        &data[0], 0, (int)data.size(), -1)];
    }
  }
  {
    Timer tt("array with ptrdiff_t index");
    int sum = 0;
    for (int i=-1000000; i<1000000; i++) {
      sum += data[binarySearch_indexed<int const *, ptrdiff_t>(
        &data[0], 0, (ptrdiff_t)data.size(), -1)];
    }
  }
  {
    Timer tt("vector with int index");
    int sum = 0;
    for (int i=-1000000; i<1000000; i++) {
      sum += data[binarySearch_indexed<vector<int> const &, int>(
        data, 0, (int)data.size(), -1)];
    }
  }
  {
    Timer tt("vector with ptrdiff_t index");
    int sum = 0;
    for (int i=-1000000; i<1000000; i++) {
      sum += data[binarySearch_indexed<vector<int> const &, ptrdiff_t>(
        data, 0, (ptrdiff_t)data.size(), -1)];
    }
  }

  printf("\n");
}

int main(int argc, char **argv)
{
  QueryPerformanceFrequency((LARGE_INTEGER*)&freq);

  timeBinarySearch();
  timeFillWithAlloc();
  timeFillNoAlloc();

  return 0;
} 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-02-27T12:31:19.053

**当兼容性或**性能非常重要时，Array/char* 很有用。向量和字符串是更高级别的对象，在代码可维护性、可读性和整体易用性方面表现更好。几乎总是如此。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-02-27T12:27:05.990

只要您知道编译时本身的大小，我建议您使用数组。尽管可以使用向量，但我们必须记住，向量的开销与在堆上完成的内存分配有关。如果大小未知，那么当然使用向量。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-27T12:32:48.067

我能想到的唯一原因就是速度。与相应的对象相比，您可以对数组/指针类型进行更好的优化。但如果我绝对知道我的数据结构需要保存的数据量，我什至会使用 STL。在优化步骤中从 STL 更改为原始类型比使用难以阅读的代码开始项目要好。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-27T12:38:33.543

我看到两个原因：

1.  兼容性（没有 STL 的旧代码）。
2.  速度。（我比较了使用vector/binary_search & array/handwritten binary search的速度。对于最后一个获得了丑陋的代码（重新分配内存），但它比第一个快1.2-1.5倍，我使用MS VC++ 8 )

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-02-27T16:58:31.890

我在一个需要访问结构化数据的共享库上工作。此数据在编译时是已知的，因此它使用**POD（普通旧数据）结构的文件范围常量数组**来保存数据。

这会导致编译器和链接器将大部分数据放在只读部分中，有两个好处：

*   它可以从磁盘映射到内存目录，而无需运行任何特殊的初始化代码。
*   它可以在进程之间共享。

唯一的例外是编译器仍然会生成初始化代码来加载浮点常量，因此任何包含浮点数的结构最终都会进入可写部分。我怀疑这与浮点异常或浮点舍入模式有关，但我不确定如何验证这两个假设。

如果我为此使用向量和字符串对象，那么编译器将生成更多初始化代码，这些初始化代码将在我的共享库加载时执行。常量数据将在堆上分配，因此进程之间不可共享。

如果我从磁盘上的文件中读取数据，我将不得不检查数据的格式，而不是让 C++ 编译器为我做这件事。我还必须管理代码库中数据的生命周期，该代码库从一开始就将全局数据“烘焙”到其中。

# sharepoint - 使用 xslt 显示从共享点提取的图像

> ID：594524
> 
> 赞同：0
> 
> 时间：2009-02-27T12:18:08.400
> 
> 标签：sharepoint, xslt

如何使用 xslt 显示从 sharepoint 中提取的图像？

xml 生成一个标签，其值为：

```
<img alt="" border="0" src="/SiteCollectionImages/Blue%20hills.jpg ....etc 
```

但输出是上面的文本而不是图像本身。

xslt 只是：

汇总图像：`<xsl:value-of select="Rollup-Image" />`

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-27T12:22:47.297

我认为这应该可以解决问题

```
<xsl:value-of select="Rollup-Image" disable-output-escaping="yes" /> 
```

# java - 如何使用 JAXB 实例化一个空元素

> ID：594537
> 
> 赞同：12
> 
> 时间：2009-02-27T12:22:28.543
> 
> 标签：java, xml, jaxb

我使用 JAXB 创建 XML 消息。我需要创建的 XML 是（为了简单起见）：

```
<request>
  <header/>
</request> 
```

我的代码如下所示：

```
import javax.xml.bind.annotation.*;

@XmlRootElement(name = "request")
public class Request {

    private String header;

    @XmlElement(required=true)
    public String getHeader() {
      return header;
    }

    public void setHeader(String header) {
      this.header=header;
    }
} 
```

问题：该`header`元素未显示（标题为`null`）。当 header 设置为空字符串时，将显示以下内容：

```
<request>
  <header></header>
</request> 
```

当我使用 as type`Object`而不是 时`String`，结果更糟：

```
<request>
  <header xsi:type="xs:string" 
   xmlns:xs="http://www.w3.org/2001/XMLSchema" 
   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"></header>
</request> 
```

顺便说一句：我正在使用[此代码](https://stackoverflow.com/questions/590405/generic-method-in-java-without-generic-argument/590418#590418)来创建 XML 字符串。

是否有可能获得一个空标签？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-02-27T13:20:43.960

在 XML 中，`<header/>`和`<header></header>`都是一回事。如果您真的想要前者，请使用美化剂。`javax.xml.transform.TransformerFactory.newTransformer()`可能会为你做到这一点。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-27T15:25:53.360

String 对象的空标记本质上是空字符串。

如果您拨打以下电话，您将得到您正在寻找的东西：

```
request.setHeader("") 
```

我还应该注意，在 XML 中，以下两个标头声明是相同的。这两个都没有子文本节点。这些本质上是相同的，并且所有 XML 解析器都会以相同的方式对待它们：

```
<header></header>

<header/> 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2012-06-27T16:38:34.027

正如@Tom Hawtin - tackline 所说

`<header/>`并且`<header></header>`是一样的。解析器会给你“”。

您必须添加`nillable`标题注释

```
@XmlElement(nillable=true, required=true)
public String getHeader() {
  return header;
} 
```

我希望这段代码将生成以下 XML 以获取`null`价值。

```
import javax.xml.bind.*;
import javax.xml.bind.annotation.*;

@XmlRootElement
public class Request {

    public static void main(String[] args) throws JAXBException {
        final Request request = new Request();
        final JAXBContext context = JAXBContext.newInstance(Request.class);
        final Marshaller marshaller = context.createMarshaller();
        marshaller.setProperty(Marshaller.JAXB_FORMATTED_OUTPUT,
                               Boolean.TRUE);
        marshaller.marshal(request, System.out);
        System.out.flush();
    }

    @XmlElement(nillable=true, required=true)
    private String header;
} 
```

印刷

```
<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<request>
    <header xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/>
</request> 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2015-07-09T00:28:16.883

我想要同样的东西，`<header/>`而不是`<header></header>` 在 xml 序列化过程中。

由于 null 值 - 而不是空字符串 - 会产生正确的结果，所以我修改了我的 setter 方法以将值显式设置为 null：

```
public void setHeader(String header) {
    this.header = "".equals(header) ? null : header;
} 
```

# c# - 如何在不使用某些决策结构的情况下使用 C# 完成作业？

> ID：594541
> 
> 赞同：0
> 
> 时间：2009-02-27T12:23:25.827
> 
> 标签：c#, string, char

我是编程新手，我想在 Visual Studio 中使用 C# 语言编写一个程序，该语言仅使用一个文本框和一个按钮。当用户在文本框中输入字符串“A”并按下按钮时，程序会在消息框中显示整数“5”。如果用户在文本框中输入字符串“B”，程序会在消息框中显示整数“4”，而对于字符串“C”，它会显示“3”，就像这样......棘手的（对我来说）部分这个程序的原因是我无法使用任何决策结构，如 if、switch 等。以某种我不知道的方式是可能的。请帮助我学习如何做到这一点。感谢您抽出时间。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-27T12:28:23.337

你不应该使用决策结构。这个想法是找到输入字符与“A”的区别。

祝你好运！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-27T12:30:57.510

这适用于 Java，我认为这也适用于 C#。

如果您从用户输入的字符中减去“A”，您将得到一个 Int，A 为 0，B 为 1，等等。基本数学可以完成其余的工作：) 不要忘记转换为 Char 而不是减去字符串.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-27T12:38:56.553

听起来`s like somebody doesn`他想自己做作业。

开始了：

您将插入的字符（A、B 或 C）转换为 int，减去 70，乘以 -1 并在消息框中显示该值。

* * *

## 回答 #4

> 赞同：-2
> 
> 时间：2009-02-27T12:28:48.873

您可以通过使用通用字典来做到这一点。您需要注意一些小问题，但一些简单的测试会告诉您这些是什么（如果您稍微考虑一下这个问题，它们就很明显了）。

# python - 电子邮件正文有时是一个字符串，有时是一个列表。为什么？

> ID：594545
> 
> 赞同：8
> 
> 时间：2009-02-27T12:24:39.647
> 
> 标签：python, email, message, payload

我的应用程序是用 python 编写的。我正在做的是我在 postfix 收到的每封电子邮件上运行一个脚本，并对电子邮件内容做一些事情。Procmail 负责运行以电子邮件为输入的脚本。当我将输入消息（可能是文本）转换为 email_message 对象（因为后者派上用场）时，问题就开始了。我正在使用 email.message_from_string （其中 email 是默认的电子邮件模块，带有 python）。

`import email message = email.message_from_string(original_mail_content) message_body = message.get_payload()`

此 message_body 有时会返回一个列表[email.message.Message instance,email.message.Message instance]，有时会返回一个字符串（传入电子邮件的实际正文内容）。为什么。甚至我还发现了另一个观察结果。当我浏览 email.message.Message.get_payload() 文档字符串时，我发现了这个..
""" 有效负载将是一个列表对象或字符串。如果你改变列表对象，你修改消息的有效负载地方.....”””

那么我如何有通用的方法来通过 python 获取电子邮件的正文呢？请帮帮我。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-02-27T12:53:42.213

好吧，答案是正确的，您应该阅读文档，但是对于通用方式的示例：

```
def get_first_text_part(msg):
    maintype = msg.get_content_maintype()
    if maintype == 'multipart':
        for part in msg.get_payload():
            if part.get_content_maintype() == 'text':
                return part.get_payload()
    elif maintype == 'text':
        return msg.get_payload() 
```

这很容易发生一些灾难，因为可以想象这些部分本身可能有多个部分，并且它实际上只返回第一个文本部分，所以这也可能是错误的，但你可以使用它。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-02-27T12:31:24.373

尽管看起来很疯狂，但有时出现字符串，有时出现列表语义的原因[在文档中给出](http://docs.python.org/library/email.parser.html#email.message_from_string)。基本上，多部分消息作为列表返回。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2010-08-22T23:04:49.570

不是简单地寻找一个子部分，而是使用 walk() 来遍历消息内容

```
def walkMsg(msg):
  for part in msg.walk():
    if part.get_content_type() == "multipart/alternative":
      continue
    yield part.get_payload(decode=1) 
```

walk() 方法返回一个可以循环使用的迭代器（即它是一个生成器）。如果消息不是部分的容器（即没有附件或替代项），则 walk() 方法将返回一个带有单个元素的迭代器 - 消息本身。

您想跳过任何“多部分”部分，因为它们只是胶水。

上述方法返回所有可读部分。如果文本部分包含您正在寻找的信息，您可能希望将其扩展为仅返回文本部分。

请注意，从 Python 2.5 开始，方法 get_type()、get_main_type() 和 get_subtype() 已被删除 -> [http://docs.python.org/library/email.message.html#email.message.Message.walk](http://docs.python.org/library/email.message.html#email.message.Message.walk)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-27T12:30:42.550

它可能是[MIME 多部分](http://en.wikipedia.org/wiki/MIME#Multipart_messages)

请参阅[http://docs.python.org/library/email.parser.html#additional-notes](http://docs.python.org/library/email.parser.html#additional-notes)

# jquery - 在 Jquery 中访问数组元素

> ID：594546
> 
> 赞同：0
> 
> 时间：2009-02-27T12:25:25.980
> 
> 标签：jquery

我有很多这样的行：

```
<tr>        
    <TD class="Lo">90%</TD>                        
    <TD class="Poor">80%</TD>                   
    <TD class="Lo">89%</TD>                     
    <TD class="Mid">85%</TD>                        
    <TD class="Poor">85%</TD>                       
    <TD class="Mid">85%</TD>                        
    <TD class="Hi">85%</TD>
</tr> 
```

现在我想访问该行中的任何元素并根据值设置该行的颜色：

*   如果 80% < 值 <= 85% 颜色为黄色，
*   如果 90% < 值 <= 95% 颜色为红色，
*   如果 95% < 值 <= 100% 颜色为绿色。

如何使用 jQuery 做到这一点？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-27T12:43:07.310

[为此制作一些自定义选择器](http://debuggable.com/posts/getting-serious-with-jquery-adding-custom-css-selectors:480f4dd6-e834-4cf6-a5cc-478ccbdd56cb)，您可能会得到一些好处。

例如，这里有一个叫做“high”的：

```
jQuery.expr[':'].high = '(put your boolean logic here, inside quotes)'; 
```

然后，在您拥有自定义选择器后，为每个选择器执行此操作：

```
$('td:high').css('color', 'green'); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-27T13:51:31.700

这是一个可行的解决方案和在客户端完成的突出显示逻辑。

给定 id="stats" 的 html 表，这意味着突出显示将应用于该表的 td。

```
<table id="stats">
    <tr>
        <td>83%</td>                                           
        <td>96%</td>
        <td>92%</td>
    </tr>
    <tr>
        <td>100%</td>                                           
        <td>94%</td>                                  
        <td>85%</td>                                            
    </tr>
</table> 
```

带有 JQuery 的 Javascript 来执行高亮显示。

```
<script type="text/javascript">
    $(window).ready(function() {
        // for each td element within elements whose id="stats" 
        $("#stats td").each(function() {
            // current td element
            var td = $(this);
            // do it once only
            var val = td.text().replace('%', '');

            td.css('background',  val > 80 && val <= 85    ? 'yellow' 
                                  : val > 90 && val <= 95  ? 'red'
                                  : val > 95 && val <= 100 ? 'green'
                                  : 'black'); // black is default
        });

    }); 
</script> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-27T12:31:28.570

尝试这样的事情

```
$("td").each(function() {
  if ($(this).text().replace('%') <= 90) {
    $(this).css('background','red');
  } else if ($(this).text().replace('%') <= 100) {
    $(this).css('background','green');
  }
  // repeat ...
}); 
```

# openid - 向 OpenID 提供商请求电子邮件地址

> ID：594548
> 
> 赞同：6
> 
> 时间：2009-02-27T12:27:04.697
> 
> 标签：openid, dotnetopenauth

我正在实现 OpenID，我想检索用户的电子邮件地址和有关用户的其他信息，我正在这样做：

```
var fetch = new FetchRequest();
fetch.AddAttribute(new AttributeRequest(WellKnownAttributes.Contact.Email));
request.AddExtension(fetch); 
```

但是提供者不返回任何东西。我正在使用 DotNetOpenID

我究竟做错了什么？

谢谢！

编辑：

当我尝试使用 MyOpenID 或 Google 在[http://www.plaxo.com/](http://www.plaxo.com/)上注册时，他们都说 plaxo 正在请求更多信息，但是当我测试我的网站时，他们什么也没说……

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-04T20:43:46.270

正如马丁所说，这取决于提供者。

我认为，MyOpenID 不执行 AttributeExchange。不过，他们会进行 sreg（简单注册），因此`ClaimsRequest`请在您的请求中添加扩展名，您会`ClaimsResponse`从一些提供商那里得到回复。

Google 只做 AttributeExchange，并且只提供一个电子邮件地址。您的代码中唯一缺少的是，除非您在请求中将其标记为“必需”，否则 Google 甚至不会自愿提供电子邮件地址。向 AttributeRequest 构造函数添加一个 ", true" 第二个参数，然后 Google 应该会亮起并为您提供用户的电子邮件地址。

以下是一些[获取属性的文档和示例](http://dotnetopenauth.net:8000/wiki/CodeSnippets/OpenIDRP#Gettinguserattributes)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-27T12:36:14.253

也许您没有做错任何事情——提供商可能只是不支持该请求，或者选择不发送请求的信息。

[http://blog.nerdbank.net/2008/07/how-to-use-dotnetopenid-attribute.html](http://blog.nerdbank.net/2008/07/how-to-use-dotnetopenid-attribute.html) “与所有 OpenID 扩展一样，仅发送带有扩展名的请求并不能保证提供者将发送响应该扩展。提供者可能不支持该扩展，或者可能选择不发送任何响应。“

# c# - 用于遗传编程的 C# 动态树

> ID：594562
> 
> 赞同：4
> 
> 时间：2009-02-27T12:31:07.680
> 
> 标签：c#, expression-trees, genetic-programming

我有一些公共的用户定义类，它们的成员之间有关系，还有一些具有特定和通用签名的方法。

我希望能够使用 if/then/else、foreach、do/while、变量赋值等基本控制语句来存储和操作这些类（加上 CLR 类）的自定义控制流。

自定义控制流应在运行时创建，然后存储以供以后使用和操作。这个想法是拥有控制流的数据表示，可能以抽象语法树的形式，具有**强类型语法**，以便能够应用遗传操作。生成的自定义代码必须作为另一个程序的一部分执行。

1）操作遗传操作的首选代码表示形式是什么，然后执行包括我的类在内的代码，

2) 对于上述问题，我应该使用哪些 c# 技术？我知道有相关技术，如反射、新的 c# 3.0 特性（lambda、表达式树）、CodeDom、DLR 库等，但哪种方法或组合最有效。

3）是否有这样的范例或实现可用？

编辑：该平台提供了定义的 c# 自定义类型的数据，包括常量和时间变量。

每时每刻都将规则应用于数据（基本条件或更复杂的功能），并决定采取一些行动。

我希望能够：

在树或图上表示规则并执行流程。

用户通过 UI 工具包创建自定义规则集

对树或图进行重新排列并应用 GP 操作

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-27T13:12:57.597

反射是检查已经生成的类型、方法、字段等的技术，因此它现在可能对你没有多大帮助。

表达式树相当有趣，但是根据 AFAIK，它们不允许您创建复杂的程序流，因为 lambda 表达式不能有主体，这使得创建任何适度复杂的东西变得相当困难。

DLR 正在酝酿之中。您将获得一些零碎的信息，但只有下一个 .NET 版本将内置对 DLR 的支持。通过动态创建程序并执行它们，这可能是一个有趣的选择。

您现在可以做的可能是在动态方法或动态生成的程序集中发出 IL。您应该可以使用所有可能的构造，但随后的操作可能相当困难。

即便如此，有一个项目可以发挥相当多的 IL 魔法，甚至可能对您有用：[LinFu](http://www.codeproject.com/KB/cs/LinFuPart1.aspx)。根据列表，您有一个 Dynamic Object 的实现，并且可以执行 dynamicObject.CreateDuck<InterfaceType>() 之类的操作

另一个可能有点繁重但也很有趣的路线是 WF（工作流基础）框架。这样的工作流应该可以由程序构建，并且由于它们的延续风格工作它们可能很有趣：您可以随时保持正在运行的工作流并在您离开的地方将其拾取。

在 WF 中，您应该可以使用所有传统的程序结构。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-27T13:11:18.270

用 C# 等语言表示的育种程序非常棘手——它们根本就没有被设计成可延展的——你会发现你所做的绝大多数更改只会导致程序失败。

我会推荐两种替代方法之一：

1.  伪机器语言，在两种 NOP 上使用模式匹配来允许分支或循环；
2.  一种 LISP 链接语言，在命名函数上使用递归以允许迭代。

(1) 可以使用线性指令序列和某种形式的虚拟寄存器或堆栈机来表示。(2) 可以使用树表示，并使用某种形式的“减少”算法进行评估。

无论您使用哪种方法，您都需要在沙箱中执行程序 - 无限循环很常见，因此您需要能够在一定数量的循环后停止它们。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-27T13:13:27.143

[Dynamic Expression [example] API](http://weblogs.asp.net/scottgu/archive/2008/01/07/dynamic-linq-part-1-using-the-linq-dynamic-query-library.aspx)涵盖了这个领域的基础......

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-27T14:02:56.570

只需输出 c#（支持此功能的任何其他 .net 语言，f# 也可以很好地工作）并使用 CodeDomProvider 即时编译它。强制提供的代码为一个源文件，包括一种实现 IDynamicEntryPoint 的类型（使用静态方法或空构造函数作为入口点并将在构造后调用）

这应该是您开始的第一个呼叫端口，因为它可以快速尝试，同时长期具有最高性能的最佳机会（禁止动态 IL 输出，但即使那样您也可能无法击败编译器）

这显然有两个可能的缺陷，可能会破坏交易：

*   生成的代码是一场安全噩梦，只应允许来自完全受信任的用户的代码输入。
*   动态编译的代码在代码/接口更改方面很脆弱（代码必须包含的 dll 集可能会更改/可能不匹配）或 IDynamicEntryPoint 的签名可能会更改。

除非您对编写自己的语言/解析器/编译器感兴趣，否则请使用已经存在的。

# programming-languages - 什么情况下适合动态语言？

> ID：594578
> 
> 赞同：2
> 
> 时间：2009-02-27T12:38:23.840
> 
> 标签：programming-languages, dynamic-languages

我使用过 C#、Java、C 等静态语言，还有一些使用动态语言 Javascript 完成了一些工作。

与流行的看法相反，我发现自己用 C# 编写代码比用 Javascript 更快（这可能是因为与 javascript 相比，我在 C# 方面的经验更多）

所以，我想了解的是，动态语言在哪些地方是合适的，并且可以比静态语言更受青睐。

是否可以将动态语言用于需要维护多年的企业系统，或者它主要用于使用和抛出代码？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-27T12:49:50.383

我不认为你可以这样概括。动态/非动态语言都可以在同一领域中使用，该领域几乎包含所有内容。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-27T14:52:45.453

只要简单性和灵活性比性能和明确性更重要，我就会使用动态语言。静态类型为编译器提供了大量信息，可用于编写真正快速的汇编代码。它还使合约变得明确，可能使代码部分更容易单独推理。然而，因为这些合约是如此明确，并且通过如此多的代码产生连锁反应，所以它们有点难以改变。在需要高度灵活性的系统中，这可能会导致创建大量复杂性来绕过静态类型的刚性。

就个人而言，我不认为缺少静态类型检查有什么大不了的。当然，在编译时失败是理想的快速失败。然而，动态语言范式并不是很糟糕。当动态语言在运行时发生类型错误时，事情会立即失败并带有明确的错误消息。您不仅会在某个完全不同的地方得到奇怪的未定义行为和失败。

另一方面，我发现一个好的模板系统（不是 C++）和静态类型推断绝对是天赐之物。这使您可以两全其美，因为它基本上是编译时动态类型。在编译时仍然会静态检查所有内容。及早发现错误并生成高效的汇编代码。尽管如此，您仍保留了不必在设计时明确合同的灵活性。我的理解是 Haskell、OCaml 等在这方面做得很好。如果您对具有更主流外观和感觉的语言感兴趣，请尝试 D。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-27T12:46:54.477

一种情况表明 C# 4.0 动态的有用性。假设您有一个可以包含一对两个控件的控件。它们都具有 DataSource 属性，但这个常见的超类没有。为了明确这一点，您可以使用动态检查该属性是否存在于运行时级别。

其他场景涉及基于条件的运行时类修改。假设您希望函数 A() 属于 B 类，如果只有函数 C() 会返回 true。它可以在 JavaScript 中完成，但 C# 无法做到这一点。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-27T12:54:16.423

JavaScript 不是最好的例子。你应该看看 Python、Ruby 或 Groovy。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-20T18:09:44.413

我要指出，动态语言的类型可以由程序员隐式定义，就像静态语言一样。

动态语言的一个好处是您可以编写方法存根来调用实际不存在的对象和方法。这对于首先设计代码并稍后填写细节非常有用。当你在团队中工作时很好。不过不用担心，如果你这样做，编译器通常会警告你方法调用可能不起作用。编译器将允许您编写代码并运行该代码。

动态语言很强大，尽管有时这种能力会使它们更难调试。

# c++ - 人们实际上还在使用 cin 和 cout 吗？

> ID：594582
> 
> 赞同：4
> 
> 时间：2009-02-27T12:38:45.900
> 
> 标签：c++

这完全是一个意见问题。更多用于喋喋不休。我正在接受一些 C++ 测试，它们到处都是 cin 和 cout。
人们是否真的还在使用这些。我的意思是我从来没有在实际的公共应用程序中看到过。

我在测试中回答的最后一个问题是

```
int c1;
cout << "Enter numbers: " << flush;
for(int n = 0; cin >> c1; ++n){
   cout << c1 << endl;
}
When does this end.. 
```

正确答案是“当用户按下 ctrl+Z 时”。我到底要在哪里按 control+Z？我假设在终端，我想。但老实说。我已经很久没有见过终端了。而且我敢肯定，他不会尝试为它编写任何程序。

在我们的任何生活中，这样的问题仍然相关吗？

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-02-27T12:44:30.567

终端被广泛使用，并将被使用。原因是，当巧妙地使用时，它们比任何 GUI 都强大得多。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-02-27T12:46:08.190

不，这样的问题不是很相关，但是是的，人们一直在使用 std::cin 和 std::cout 。即使是设计图形界面的人也可能使用 cout 进行调试！

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-02-27T12:41:55.517

是的，只要控制台应用程序存在，cout 和 cin 就会存在。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-02-27T12:43:15.093

所以你想说你是一个程序员并且从未使用或编写过控制台应用程序？

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2009-02-27T12:47:49.513

当然是相关的。

例如，各种服务器上的许多自动化和管理脚本都依赖于文本输出/输入。在 *nix 系统上尤其如此，现在在 Windows 上就没有那么多了，因为 Powershell 已经有了它的花哨的对象支持。

然后是我们中的一些人（我承认，这是一个垂死的品种）在航站楼里几乎是活生生的。我使用终端完成了大约 70-80% 的工作。我只是发现它比大多数相关的 GUI 应用程序更自然、更快、更强大。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-02-27T12:41:02.540

是的，您可能想要处理或转换输入文本文件。事实证明它很方便。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2012-02-09T11:17:52.587

在我看来，要编写一个复杂的软件，**将 GUI**与其余部分分开是一个很好的方法，即通常，即使没有 GUI，其余部分也必须***能够工作***。

在这种情况下，使用 cin/cout 管理 I/O 会很方便。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-02-27T16:00:10.457

我从事过许多专业应用程序，我们没有在其中任何一个上使用过 cin 或 cout，即使是用于日志记录/调试。为什么？因为无状态的 *printf 方法运行良好。多年来我学到的一件事是，在可维护性方面，无状态胜过有状态。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-02-27T12:59:52.090

我宁愿使用 wcin 和 wcout，至少你会得到 Unicode 的东西。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2009-02-27T12:42:52.363

> 人们是否真的还在使用这些。我的意思是我从来没有在实际的公共应用程序中看到过。

定义公共应用程序。您认为任何 *nix 上的命令行工具都使用什么？是的，我们也将它们用于我们的 SDK（至少 cout 和 cerr）。`cin`当您有足够复杂的输入时，通常不是最好的——您需要编写一个词法分析器和各种解析器。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2009-02-27T12:49:30.040

如果您在职业生涯中只编写 GUI 或 Web 应用程序，那么您可能不会对 cin 和 cout 有太多用处。如果你写过任何嵌入的东西，你就会改变你的立场。您只需为控制台应用程序、基于文本的应用程序、GUI 应用程序和 Web 应用程序使用一组不同的库。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-02-27T12:42:52.380

从语言的角度来看，如果“该程序何时结束”的答案是“收到 EOF 时”，那将更容易接受。仅仅因为“Control-Z”在 DOS 中是 EOF，并不意味着 Ctrl-Z 是正确的答案。

**编辑** 用评论信息编辑。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2012-03-04T03:27:47.380

我每天都使用 std::cin、std::cout 和 std::cerr。系统编程缺乏 GUI。

# java - Hibernate Annotations - 哪个更好，字段访问还是属性访问？

> ID：594597
> 
> 赞同：148
> 
> 时间：2009-02-27T12:44:48.757
> 
> 标签：java, hibernate, orm, jpa, annotations

[这个问题与Hibernate Annotation Placement Question](https://stackoverflow.com/questions/305880/hibernate-annotation-placement-question)有点相关。

但我想知道哪个**更好**？通过属性访问还是通过字段访问？各自的优点和缺点是什么？

* * *

## 回答 #1

> 赞同：261
> 
> 时间：2011-05-21T21:56:24.553

两者都有争论，但大多数都源于某些用户需求“如果需要添加逻辑怎么办”或“xxxx 破坏封装”。然而，没有人真正评论过这个理论，并给出了一个合理的论据。

当 Hibernate/JPA 持久化一个对象时，它实际上在做什么 - 好吧，它是在持久化对象的状态。这意味着以易于复制的方式存储它。

什么是封装？封装意味着使用应用程序/客户端可以用来安全访问数据的接口封装数据（或状态） - 使其保持一致和有效。

把它想象成 MS Word。MS Word 在内存中维护文档的模型 - 文档状态。它提供了一个用户可以用来修改文档的界面 - 一组按钮、工具、键盘命令等。但是，当您选择持久保存（保存）该文档时，它会保存内部状态，而不是一组按键和用于生成它的鼠标点击。

保存对象的内部状态不会破坏封装 - 否则您并不真正了解封装的含义以及它存在的原因。它就像对象序列化一样。

出于这个原因，在大多数情况下，保留 FIELDS 而不是 ACCESSORS 是合适的。这意味着对象可以完全按照其存储方式从数据库中准确地重新创建。它不需要任何验证，因为这是在创建原始文件时完成的，并且在它存储到数据库之前（除非，上帝保佑，你在数据库中存储无效数据！！！！！！）。同样，应该不需要计算值，因为它们在存储对象之前就已经计算过了。对象应该看起来就像它在保存之前的样子。事实上，通过在 getter/setter 中添加额外的东西，你实际上*增加*了重新创建不是原始副本的东西的风险。

当然，添加此功能是有原因的。可能有一些用于持久化访问器的有效用例，但是它们通常很少见。一个例子可能是你想避免持久化一个计算值，尽管你可能想问为什么你不在值的 getter 中按需计算它，或者在 getter 中懒惰地初始化它。就我个人而言，我想不出任何好的用例，而且这里的答案都没有真正给出“软件工程”的答案。

* * *

## 回答 #2

> 赞同：86
> 
> 时间：2009-02-27T12:53:44.100

我更喜欢字段访问，因为这样我就不必为每个属性提供 getter/setter。

通过 Google 进行的一项快速调查表明，字段访问占大多数（例如， http: [//java.dzone.com/tips/12-feb-jpa-20-why-accesstype](http://java.dzone.com/tips/12-feb-jpa-20-why-accesstype)）。

我相信字段访问是 Spring 推荐的成语，但我找不到支持它的参考。

有一个[相关的 SO question](https://stackoverflow.com/questions/332591/performance-difference-between-annotating-fields-or-getter-methods-in-hibernate)试图衡量性能并得出“没有区别”的结论。

* * *

## 回答 #3

> 赞同：39
> 
> 时间：2010-07-06T06:34:33.310

这是您必须使用属性访问器的情况。想象一下，你有一个 GENERIC 抽象类，它具有很多实现优点，可以继承到 8 个具体的子类中：

```
public abstract class Foo<T extends Bar> {

    T oneThing;
    T anotherThing;

    // getters and setters ommited for brevity

    // Lots and lots of implementation regarding oneThing and anotherThing here
 } 
```

现在究竟应该如何注释这个类？答案是您根本无法使用字段或属性访问对其进行注释，因为此时您无法指定目标实体。您必须注释具体的实现。但是由于在这个超类中声明了持久属性，因此您必须在子类中使用属​​性访问。

在具有抽象通用超类的应用程序中，字段访问不是一个选项。

* * *

## 回答 #4

> 赞同：33
> 
> 时间：2010-05-19T21:11:46.300

我倾向于更喜欢并使用属性访问器：

*   如果需要，我可以添加逻辑（如接受的答案中所述）。
*   它允许我在`foo.getId()` **不初始化代理的情况下**调用（在使用 Hibernate 时很重要，直到[HHH-3718](https://hibernate.atlassian.net/browse/HHH-3718)得到解决）。

退税：

*   它使代码的可读性降低，例如，您必须浏览整个班级以查看`@Transient`周围是否有。

* * *

## 回答 #5

> 赞同：32
> 
> 时间：2009-04-16T18:02:23.487

我更喜欢访问器，因为我可以在需要时向访问器添加一些业务逻辑。这是一个例子：

```
@Entity
public class Person {

  @Column("nickName")
  public String getNickName(){
     if(this.name != null) return generateFunnyNick(this.name);
     else return "John Doe";
  }
} 
```

此外，如果您将其他库放入混合中（例如一些 JSON 转换库或 BeanMapper 或 Dozer 或其他基于 getter/setter 属性的 bean 映射/克隆库），您将保证该库与持久性同步经理（都使用 getter/setter）。

* * *

## 回答 #6

> 赞同：17
> 
> 时间：2015-03-12T08:10:58.137

我更喜欢使用字段访问，原因如下：

1.  [在实现 equals/hashCode 和直接引用字段](http://blog.xebia.com/2008/03/08/advanced-hibernate-proxy-pitfalls/)（而不是通过它们的 getter）时，*属性访问*可能会导致非常讨厌的错误。这是因为只有在访问 getter 时才初始化代理，而直接字段访问只会返回 null。

2.  *属性访问*要求您将所有实用程序方法（例如 addChild/removeChild）注释为`@Transient`.

3.  通过字段访问，我们可以通过完全不暴露 getter 来隐藏`@Version`字段。getter 也可能导致添加 setter，并且`version`永远不应该手动设置该字段（这可能会导致非常讨厌的问题）。所有版本增量都应该通过[`OPTIMISTIC_FORCE_INCREMENT`](http://vladmihalcea.com/hibernate-locking-patterns-how-does-optimistic_force_increment-lock-mode-work/)或[`PESSIMISTIC_FORCE_INCREMENT`](http://vladmihalcea.com/hibernate-locking-patterns-how-does-pessimistic_force_increment-lock-mode-work/)显式锁定来触发。

* * *

## 回答 #7

> 赞同：17
> 
> 时间：2018-12-17T14:42:09.167

让我试着总结一下选择基于字段的访问的最重要原因。如果您想深入了解，请阅读我博客上的这篇文章：[JPA 和 Hibernate 中的访问策略——字段访问还是属性访问哪个更好？](https://thoughts-on-java.org/access-strategies-in-jpa-and-hibernate/)

到目前为止，基于字段的访问是更好的选择。这里有5个原因：

**原因 1：更好的代码可读性**

如果您使用基于字段的访问，您可以使用映射注释来注释实体属性。通过将所有实体属性的定义放在类的顶部，您可以获得所有属性及其映射的相对紧凑的视图。

**原因 2：省略应用程序不应调用的 getter 或 setter 方法**

基于字段的访问的另一个优点是您的持久性提供程序，例如 Hibernate 或 EclipseLink，不使用实体属性的 getter 和 setter 方法。这意味着您不需要提供任何不应被您的业务代码使用的方法。[对于生成的主键属性](https://thoughts-on-java.org/jpa-generate-primary-keys/)或版本列的 setter 方法，这种情况最常见。您的持久性提供程序管理这些属性的值，您不应以编程方式设置它们。

**理由三：灵活实现getter和setter方法**

因为您的持久性提供程序不调用 getter 和 setter 方法，所以它们不会被迫满足任何外部要求。您可以以任何您想要的方式实现这些方法。这使您能够实现特定于业务的验证规则、触发其他业务逻辑或将实体属性转换为不同的数据类型。

例如，您可以使用它将[可选关联或属性包装到 Java`Optional`中。](https://thoughts-on-java.org/hibernate-tips-map-association-optional/)

**原因 4：无需将实用程序方法标记为`@Transient`**

基于字段的访问策略的另一个好处是您不需要使用`@Transient`. 这个注解告诉你的持久化提供者一个方法或属性不是实体持久状态的一部分。而且由于使用字段类型访问，持久状态由实体的属性定义，因此您的 JPA 实现会忽略实体的所有方法。

**原因 5：使用代理时避免错误**

Hibernate 使用代理来[延迟获取一对一的关联](https://thoughts-on-java.org/entity-mappings-introduction-jpa-fetchtypes/)，以便它可以控制这些关联的初始化。这种方法几乎适用于所有情况。但是，如果您使用基于属性的访问，它会引入一个危险的陷阱。

如果使用基于属性的访问，Hibernate 在调用 getter 方法时会初始化代理对象的属性。如果您在业务代码中使用代理对象，情况总是如此。但是相当多的[equals 和 hashCode 实现](https://thoughts-on-java.org/ultimate-guide-to-implementing-equals-and-hashcode-with-hibernate/)直接访问属性。如果这是您第一次访问任何代理属性，这些属性仍未初始化。

* * *

## 回答 #8

> 赞同：13
> 
> 时间：2009-02-27T18:43:11.797

这实际上取决于具体情况——这两种选择都是有原因的。IMO 归结为三种情况：

1.  setter 有一些在从数据库加载实例时不应该执行的逻辑；例如，在 setter 中发生了一些值验证，但是来自 db 的数据应该是有效的（否则它不会到达那里（：）；在这种情况下，字段访问是最合适的；
2.  setter 有一些应该始终被调用的逻辑，即使在从 db 加载实例期间也是如此；例如，正在初始化的属性用于计算某些计算字段（例如，属性——货币金额，计算属性——同一实例的几个货币属性的总和）；在这种情况下，需要访问属性。
3.  上述情况都不是——那么这两个选项都适用，只是保持一致（如果在这种情况下选择字段访问，那么在类似情况下一直使用它）。

* * *

## 回答 #9

> 赞同：12
> 
> 时间：2012-07-26T11:14:35.673

如果您想在设置器中做更多的事情而不仅仅是设置值（例如加密或计算），我强烈建议您在获取器（属性访问）上进行字段访问而不是注释。

属性访问的问题是在加载对象时也会调用 setter。在我们想要引入加密之前，这对我来说已经好几个月了。在我们的用例中，我们想在 setter 中加密一个字段并在 getter 中解密它。现在属性访问的问题是，当 Hibernate 加载对象时，它还调用 setter 来填充字段，从而再次加密加密的值。这篇文章还提到了这一点： [Java Hibernate：不同的属性集函数行为取决于谁调用它](https://stackoverflow.com/questions/8134947/java-hibernate-different-property-set-function-behavior-depending-on-who-is-cal)

这让我很头疼，直到我记得字段访问和属性访问之间的区别。现在，我已将所有注释从属性访问移至字段访问，并且现在可以正常工作。

* * *

## 回答 #10

> 赞同：6
> 
> 时间：2009-02-27T14:44:33.133

我相信属性访问与字段访问在延迟初始化方面略有不同。

考虑以下 2 个基本 bean 的映射：

```
<hibernate-mapping package="org.nkl.model" default-access="field">
  <class name="FieldBean" table="FIELD_BEAN">
    <id name="id">
      <generator class="sequence" />
    </id>
    <property name="message" />
  </class>
</hibernate-mapping>

<hibernate-mapping package="org.nkl.model" default-access="property">
  <class name="PropBean" table="PROP_BEAN">
    <id name="id">
      <generator class="sequence" />
    </id>
    <property name="message" />
  </class>
</hibernate-mapping> 
```

以及以下单元测试：

```
@Test
public void testFieldBean() {
    Session session = sessionFactory.openSession();
    Transaction tx = session.beginTransaction();
    FieldBean fb = new FieldBean("field");
    Long id = (Long) session.save(fb);
    tx.commit();
    session.close();

    session = sessionFactory.openSession();
    tx = session.beginTransaction();
    fb = (FieldBean) session.load(FieldBean.class, id);
    System.out.println(fb.getId());
    tx.commit();
    session.close();
}

@Test
public void testPropBean() {
    Session session = sessionFactory.openSession();
    Transaction tx = session.beginTransaction();
    PropBean pb = new PropBean("prop");
    Long id = (Long) session.save(pb);
    tx.commit();
    session.close();

    session = sessionFactory.openSession();
    tx = session.beginTransaction();
    pb = (PropBean) session.load(PropBean.class, id);
    System.out.println(pb.getId());
    tx.commit();
    session.close();
} 
```

您将看到所需选择的细微差别：

```
Hibernate: 
    call next value for hibernate_sequence
Hibernate: 
    insert 
    into
        FIELD_BEAN
        (message, id) 
    values
        (?, ?)
Hibernate: 
    select
        fieldbean0_.id as id1_0_,
        fieldbean0_.message as message1_0_ 
    from
        FIELD_BEAN fieldbean0_ 
    where
        fieldbean0_.id=?
0
Hibernate: 
    call next value for hibernate_sequence
Hibernate: 
    insert 
    into
        PROP_BEAN
        (message, id) 
    values
        (?, ?)
1 
```

也就是说，调用`fb.getId()`需要一个选择，`pb.getId()`而不需要。

* * *

## 回答 #11

> 赞同：6
> 
> 时间：2009-04-23T12:16:29.610

我认为注释属性更好，因为更新字段直接破坏封装，即使您的 ORM 这样做。

这是一个很好的例子，说明它会在哪里烧毁你：你可能希望你的注释用于休眠验证器和持久性在同一个地方（字段或属性）。如果要测试在字段上注释的休眠验证器驱动的验证，则不能使用实体的模拟将单元测试隔离到验证器。哎哟。

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2017-04-06T13:33:35.260

默认情况下，JPA 提供者访问实体字段的值，并使用实体的 JavaBean 属性访问器（getter）和修改器（setter）方法将这些字段映射到数据库列。因此，实体中私有字段的名称和类型与 JPA 无关。相反，JPA 只查看 JavaBean 属性访问器的名称和返回类型。您可以使用注释来更改它`@javax.persistence.Access`，这使您能够显式指定 JPA 提供程序应采用的访问方法。

```
@Entity
@Access(AccessType.FIELD)
public class SomeEntity implements Serializable
{
...
} 
```

AccessType 枚举的可用选项是 PROPERTY（默认）和 FIELD。使用 PROPERTY，提供者使用 JavaBean 属性方法获取和设置字段值。FIELD 使提供者使用实例字段获取和设置字段值。作为最佳实践，您应该只使用默认值并使用 JavaBean 属性，除非您有令人信服的理由不这样做。

您可以将这些属性注释放在私有字段或公共访问器方法上。如果您使用`AccessType.PROPERTY`（默认）并注释私有字段而不是 JavaBean 访问器，则字段名称必须与 JavaBean 属性名称匹配。但是，如果您注释 JavaBean 访问器，则名称不必匹配。同样，如果您使用`AccessType.FIELD`和注释 JavaBean 访问器而不是字段，则字段名称也必须与 JavaBean 属性名称匹配。在这种情况下，如果您对字段进行注释，它们不必匹配。最好保持一致并注释 JavaBean 访问器`AccessType.PROPERTY`和 `AccessType.FIELD`.

切勿在同一实体中混用 JPA 属性注释和 JPA 字段注释，这一点很重要。这样做会导致未指定的行为，并且很可能会导致错误。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2010-12-09T10:25:13.717

[我们到了吗](http://www.infoq.com/presentations/rod-johnson-are-we-there-yet)

这是一个旧的演示文稿，但 Rod 建议对属性访问进行注释会鼓励贫乏的域模型，并且不应该是注释的“默认”方式。

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2012-03-14T15:50:24.503

我喜欢字段访问器。代码更干净。所有的注释都可以放在一个类的一个部分中，代码更容易阅读。

我发现了属性访问器的另一个问题：如果你的类上有 getXYZ 方法，这些方法没有被注释为与持久属性相关联，hibernate 会生成 sql 来尝试获取这些属性，从而导致一些非常混乱的错误消息。浪费了两个小时。这段代码不是我写的；我过去一直使用字段访问器，从未遇到过这个问题。

此应用程序中使用的休眠版本：

```
<!-- hibernate -->
<hibernate-core.version>3.3.2.GA</hibernate-core.version>
<hibernate-annotations.version>3.4.0.GA</hibernate-annotations.version>
<hibernate-commons-annotations.version>3.1.0.GA</hibernate-commons-annotations.version>
<hibernate-entitymanager.version>3.4.0.GA</hibernate-entitymanager.version> 
```

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2013-06-11T06:08:19.657

支持字段访问的另一点是，否则您将被迫公开集合的设置器，对我来说，这是一个坏主意，因为将持久集合实例更改为不受 Hibernate 管理的对象肯定会破坏您的数据一致性。

因此，我更喜欢将集合作为受保护字段初始化为默认构造函数中的空实现，并且只公开它们的 getter。`clear()`然后，只有像,`remove()`等这样的托管操作`removeAll()`是可能的，它们永远不会让 Hibernate 不知道更改。

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2014-06-01T10:58:22.933

我更喜欢字段，但我遇到了一种情况，似乎迫使我将注释放在 getter 上。

使用 Hibernate JPA 实现，`@Embedded`似乎不适用于字段。所以这必须在吸气剂上进行。一旦你把它放在 getter 上，那么各种`@Column`注释也必须放在 getter 上。（我认为 Hibernate 不希望在这里混合字段和吸气剂。）一旦你`@Column`在一个类中使用吸气剂，那么在整个过程中这样做可能是有意义的。

* * *

## 回答 #17

> 赞同：2
> 
> 时间：2018-12-17T14:48:26.447

您应该选择通过字段访问而不是通过属性访问。使用字段，您可以限制发送和接收的数据。使用 via 属性，您可以作为主机发送更多数据，并设置 G 面额（工厂设置了大部分属性）。

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2009-02-27T18:48:03.407

通常 bean 是 POJO，所以无论如何它们都有访问器。

所以问题不是“哪个更好？”，而只是“何时使用字段访问？”。答案是“当您不需要该领域的 setter/getter 时！”。

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2010-04-27T17:33:48.430

我对休眠中的 accesstype 有同样的问题，并在[这里找到了一些答案](http://javaprogrammingtips4u.blogspot.com/2010/04/field-versus-property-access-in.html)。

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2010-11-22T12:45:41.177

我在这里解决了延迟初始化和字段访问[Hibernate one-to-one: getId() without fetching entire object](https://stackoverflow.com/questions/2593722/hibernate-one-to-one-getid-without-fetching-entire-object/3238182#3238182)

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2012-07-16T15:09:30.290

我们创建了实体 bean 并使用了 getter 注释。我们遇到的问题是：某些实体对某些属性的更新时间有复杂的规则。解决方案是在每个 setter 中设置一些业务逻辑，以确定实际值是否更改，如果更改，是否应允许更改。当然，Hibernate 总是可以设置属性，所以我们最终得到了两组 setter。真是丑。

阅读以前的帖子，我还看到从实体内部引用属性可能会导致无法加载集合的问题。

最重要的是，我会倾向于在未来对这些领域进行注释。

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2010-01-29T23:43:17.523

我正在考虑这个，我选择了方法访问器

为什么？

因为字段和方法访问器是相同的，但如果以后我需要在加载字段中添加一些逻辑，我保存移动放置在字段中的所有注释

问候

格鲁哈特

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2011-07-20T06:48:47.527

为了使您的类更干净，请将注释放在字段中，然后使用 @Access(AccessType.PROPERTY)

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2018-08-18T04:09:05.153

两个都 ：

> EJB3 规范要求您在将被访问的元素类型上声明注释，即，如果您使用属性访问，则为 getter 方法，如果您使用字段访问，则为字段。

[https://docs.jboss.org/hibernate/annotations/3.5/reference/en/html_single/#entity-mapping](https://docs.jboss.org/hibernate/annotations/3.5/reference/en/html_single/#entity-mapping)

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2018-08-20T12:43:52.493

AccessType.PROPERTY：EJB 持久性实现将通过 JavaBean“setter”方法将状态加载到您的类中，并使用 JavaBean“getter”方法从您的类中检索状态。这是默认设置。

AccessType.FIELD：直接从类的字段中加载和检索状态。您不必编写 JavaBean “getters”和“setters”。

# asp.net-mvc - ASP.NET MVC 中可能存在的错误，其中表单值被替换

> ID：594600
> 
> 赞同：42
> 
> 时间：2009-02-27T12:45:45.087
> 
> 标签：asp.net-mvc, forms, asp.net-mvc-3

我似乎遇到了 ASP.NET MVC 的问题，如果我在一个页面上有多个表单，每个表单都使用相同的名称，但类型不同（无线电/隐藏/等），那么，当第一个表单帖子（例如，我选择“日期”单选按钮），如果重新呈现表单（例如作为结果页面的一部分），我似乎遇到了其他表单上 SearchType 的隐藏值的问题更改为最后一个单选按钮值（在本例中为 SearchType.Name）。

下面是一个用于减少目的的示例表格。

```
<% Html.BeginForm("Search", "Search", FormMethod.Post); %>
  <%= Html.RadioButton("SearchType", SearchType.Date, true) %>
  <%= Html.RadioButton("SearchType", SearchType.Name) %>
  <input type="submit" name="submitForm" value="Submit" />
<% Html.EndForm(); %>

<% Html.BeginForm("Search", "Search", FormMethod.Post); %>
  <%= Html.Hidden("SearchType", SearchType.Colour) %>
  <input type="submit" name="submitForm" value="Submit" />
<% Html.EndForm(); %>

<% Html.BeginForm("Search", "Search", FormMethod.Post); %>
  <%= Html.Hidden("SearchType", SearchType.Reference) %>
  <input type="submit" name="submitForm" value="Submit" />
<% Html.EndForm(); %> 
```

结果页面源（这将是结果页面的一部分）

```
<form action="/Search/Search" method="post">
  <input type="radio" name="SearchType" value="Date" />
  <input type="radio" name="SearchType" value="Name" />
  <input type="submit" name="submitForm" value="Submit" />
</form>

<form action="/Search/Search" method="post">
  <input type="hidden" name="SearchType" value="Name" /> <!-- Should be Colour -->
  <input type="submit" name="submitForm" value="Submit" />
</form>

<form action="/Search/Search" method="post">
  <input type="hidden" name="SearchType" value="Name" /> <!-- Should be Reference -->
  <input type="submit" name="submitForm" value="Submit" />
</form> 
```

请问有RC1的其他人可以确认吗？

也许是因为我使用的是枚举。我不知道。我应该补充一点，我可以通过对隐藏字段使用“手动”输入（）标签来规避这个问题，但是如果我使用 MVC 标签（<%= Html.Hidden(...) %>），.NET MVC 会替换它们每次。

非常感谢。

**更新：**

今天又看到了这个bug。当您返回已发布的页面并使用 MVC 设置隐藏表单标签和 Html 帮助程序时，这似乎会引起人们的注意。我已经就此事联系了[Phil Haack](http://haacked.com)，因为我不知道还能去哪里，而且我不认为这应该是 David 指定的预期行为。

* * *

## 回答 #1

> 赞同：36
> 
> 时间：2009-03-06T17:47:09.033

是的，这种行为目前是设计使然。即使您明确设置值，如果您回发到相同的 URL，我们也会查看模型状态并使用那里的值。一般来说，这允许我们显示您在回发时提交的值，而不是原始值。

有两种可能的解决方案：

### 解决方案 1

为每个字段使用唯一名称。请注意，默认情况下，我们使用您指定的名称作为 HTML 元素的 id。多个元素具有相同的 id 是无效的 HTML。因此，使用唯一名称是一种很好的做法。

### 解决方案 2

不要使用隐藏的助手。看来你真的不需要它。相反，您可以这样做：

```
<input type="hidden" name="the-name" 
  value="<%= Html.AttributeEncode(Model.Value) %>" /> 
```

当然，当我更多地考虑这一点时，基于回发更改值对文本框有意义，但对隐藏输入意义不大。我们无法为 v1.0 更改此设置，但我会考虑为 v2 更改此设置。但我们需要仔细考虑这种变化的含义。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2015-06-07T21:49:27.007

与其他人一样，我希望 ModelState 用于填充模型，并且由于我们在视图的表达式中明确使用模型，它应该使用模型而不是模型状态。

这是一个设计选择，我明白为什么：如果验证失败，输入值可能无法解析为模型中的数据类型，并且您仍然希望呈现用户键入的任何错误值，因此很容易纠正它。

我唯一不明白的是：**为什么不按设计使用模型，由开发人员明确设置，如果发生验证错误，则使用模型状态。**

我见过很多人使用诸如

*   `ModelState.Clear()`：清除所有 ModelState 值，但基本上禁用 MVC 中默认验证的使用
*   `ModelState.Remove("SomeKey")`: 和 MVC 的自动绑定功能一样，`ModelState.Clear()`但需要对 ModelState 键进行微管理，这工作量很大，而且感觉不对。感觉就像 20 年前我们还在管理 Form 和 QueryString 键。
*   渲染 HTMLthemself：太多的工作、细节和丢弃带有附加功能的 HTML Helper 方法。一个例子：替换`@Html.HiddenFor`为`<input type="hidden" name="@NameFor(m => m.Name)" id="@Html.IdFor(m=>m.Name)" value="@Html.AttributeEncode(Model.Name)">`. 或者换成`@Html.DropDownListFor`...
*   创建自定义 HTML 帮助程序以替换默认的 MVC HTML 帮助程序以避免设计问题。这是一种比渲染 HTML 更通用的方法，但仍然需要更多的 HTML+MVC 知识或反编译 System.Web.MVC 才能保留所有其他功能，但禁用 ModelState 优先于 Model。
*   应用 POST-REDIRECT-GET 模式：这在某些环境中很容易，但在具有更多交互/复杂性的环境中更难。这种模式有其优点和缺点，您不应该因为设计选择 ModelState 而不是 Model 而被迫应用这种模式。

**问题**

所以问题是模型是从模型状态填充的，在视图中，我们明确设置为使用模型。除非出现验证错误，否则每个人都希望使用 Model 值（以防它发生变化）；然后可以使用 ModelState。

目前，在 MVC Helper 扩展中，ModelState 值优先于 Model 值。

**解决方案**

所以这个问题的实际修复应该是：对于每个提取模型值的表达式，如果该值没有验证错误，则应该删除 ModelState 值。如果该输入控件存在验证错误，则不应删除 ModelState 值，它将像往常一样使用。我认为这完全解决了这个问题，这比大多数解决方法都要好。

代码在这里：

```
 /// <summary>
    /// Removes the ModelState entry corresponding to the specified property on the model if no validation errors exist. 
    /// Call this when changing Model values on the server after a postback, 
    /// to prevent ModelState entries from taking precedence.
    /// </summary>
    public static void RemoveStateFor<TModel, TProperty>(this HtmlHelper helper,  
        Expression<Func<TModel, TProperty>> expression)
    {
        //First get the expected name value. This is equivalent to helper.NameFor(expression)
        string name = ExpressionHelper.GetExpressionText(expression);
        string fullHtmlFieldName = helper.ViewContext.ViewData.TemplateInfo.GetFullHtmlFieldName(name);

        //Now check whether modelstate errors exist for this input control
        ModelState modelState;
        if (!helper.ViewData.ModelState.TryGetValue(fullHtmlFieldName, out modelState) ||
            modelState.Errors.Count == 0)
        {
            //Only remove ModelState value if no modelstate error exists,
            //so the ModelState will not be used over the Model
            helper.ViewData.ModelState.Remove(name);
        }
    } 
```

然后我们在调用 MVC 扩展之前创建我们自己的 HTML Helper 扩展：

```
 public static MvcHtmlString TextBoxForModel<TModel, TProperty>(this HtmlHelper<TModel> htmlHelper,
        Expression<Func<TModel, TProperty>> expression,
        string format = "",
        Dictionary<string, object> htmlAttributes = null)
    {
        RemoveStateFor(htmlHelper, expression);
        return htmlHelper.TextBoxFor(expression, format, htmlAttributes);
    }

    public static IHtmlString HiddenForModel<TModel, TProperty>(this HtmlHelper<TModel> htmlHelper,
        Expression<Func<TModel, TProperty>> expression)
    {
        RemoveStateFor(htmlHelper, expression);
        return htmlHelper.HiddenFor(expression);
    } 
```

此解决方案消除了该问题，但不需要您反编译、分析和重建 MVC 通常为您提供的任何内容（不要忘记管理随时间的变化、浏览器差异等）。

我认为**“模型值，除非验证错误然后是 ModelState”**的逻辑应该是设计使然。如果是这样，它就不会咬那么多人，但仍然涵盖了 MVC 的意图。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-10-03T03:05:30.227

我刚遇到同样的问题。像 TextBox() 传递值的优先级这样的 Html 助手的行为似乎与我从[文档](http://msdn.microsoft.com/en-us/library/dd492984(VS.100).aspx)中推断出的完全相反：

> 文本输入元素的值。如果此值为空引用（在 Visual Basic 中为 Nothing），则从 ViewDataDictionary 对象中检索元素的值。如果那里不存在值，则从 ModelStateDictionary 对象中检索该值。

对我来说，我读到这个值，如果通过的话。但阅读 TextBox() 源代码：

```
string attemptedValue = (string)htmlHelper.GetModelStateValue(name, typeof(string));
tagBuilder.MergeAttribute("value", attemptedValue ?? ((useViewData) ? htmlHelper.EvalString(name) : valueParameter), isExplicitValue); 
```

似乎表明实际顺序与记录的完全相反。实际顺序似乎是：

1.  模型状态
2.  查看数据
3.  值（由调用者传递给 TextBox()）

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2011-10-13T13:56:22.683

注意——这个错误仍然存​​在于 MVC 3 中。我使用的是 Razor 标记语法（这很重要），但我遇到了与 foreach 循环相同的错误，它每次都为对象属性生成相同的值。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-02-27T13:25:45.133

这将是预期的行为 - MVC 不使用视图状态或其他背后的技巧在表单中传递额外信息，因此它不知道您提交了哪个表单（表单名称不是提交的数据的一部分，仅名称/值对列表）。

当 MVC 将表单返回时，它只是检查是否存在具有相同名称的提交值 - 再次，它无法知道命名值来自哪个表单，甚至它是什么类型的控件（无论您使用单选、文本或隐藏，通过 HTTP 提交时都只是名称=值）。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2011-02-15T01:00:18.413

```
foreach (var s in ModelState.Keys.ToList())
                if (s.StartsWith("detalleProductos"))
                    ModelState.Remove(s);

ModelState.Remove("TimeStamp");
ModelState.Remove("OtherOfendingHiddenFieldNamePostedToSamePage1");
ModelState.Remove("OtherOfendingHiddenFieldNamePostedToSamePage2");

return View(model); 
```

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2014-02-18T15:39:40.153

这个问题在 MVC 5 中仍然存在，显然它不被认为是一个很好的错误。

我们发现，尽管按照设计，这不是我们的预期行为。相反，我们总是希望隐藏字段的值与其他类型的字段类似地操作，而不是被特殊对待，或者从一些不起眼的集合中提取它的值（这让我们想起了 ViewState！）。

一些发现（对我们来说正确的值是模型值，不正确的是 ModelState 值）：

*   `Html.DisplayFor()`显示正确的值（它从模型中提取）
*   `Html.ValueFor`没有（它从 ModelState 中提取）
*   `ModelMetadata.FromLambdaExpression(expression, htmlHelper.ViewData).Model`提取正确的值

我们的解决方案是简单地实现我们自己的扩展：

```
 /// <summary>
        /// Custom HiddenFor that addresses the issues noted here:
        /// http://stackoverflow.com/questions/594600/possible-bug-in-asp-net-mvc-with-form-values-being-replaced
        /// We will only ever want values pulled from the model passed to the page instead of 
        /// pulling from modelstate.  
        /// Note, do not use 'ValueFor' in this method for these reasons.
        /// </summary>
        public static IHtmlString HiddenTheWayWeWantItFor<TModel, TProperty>(this HtmlHelper<TModel> htmlHelper,
                                                    Expression<Func<TModel, TProperty>> expression,
                                                    object value = null,
                                                    bool withValidation = false)
        {
            if (value == null)
            {
                value = ModelMetadata.FromLambdaExpression(expression, htmlHelper.ViewData).Model;
            }

            return new HtmlString(String.Format("<input type='hidden' id='{0}' name='{1}' value='{2}' />",
                                    htmlHelper.IdFor(expression),
                                    htmlHelper.NameFor(expression),
                                    value));
        } 
```

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2010-03-23T07:08:27.873

重现“设计问题”的示例，以及可能的解决方法。但是，在试图找到“错误”的过程中浪费了 3 个小时，但没有解决方法……请注意，这种“设计”仍在 ASP.NET MVC 2.0 RTM 中。

```
 [HttpPost]
    public ActionResult ProductEditSave(ProductModel product)
    {
        //Change product name from what was submitted by the form
        product.Name += " (user set)";

        //MVC Helpers are using, to find the value to render, these dictionnaries in this order: 
        //1) ModelState 2) ViewData 3) Value
        //This means MVC won't render values modified by this code, but the original values posted to this controller.
        //Here we simply don't want to render ModelState values.
        ModelState.Clear(); //Possible workaround which works. You loose binding errors information though...  => Instead you could replace HtmlHelpers by HTML input for the specific inputs you are modifying in this method.
        return View("ProductEditForm", product);
    } 
```

如果您的表单最初包含以下内容：`<%= Html.HiddenFor( m => m.ProductId ) %>`

如果“Name”的原始值（在呈现表单时）是“dummy”，那么在提交表单后，您希望看到呈现的“dummy (user set)”。没有`ModelState.Clear()`你仍然会看到“假人”！！！！！！！

正确的解决方法：

```
<input type="hidden" name="Name" value="<%= Html.AttributeEncode(Model.Name) %>" /> 
```

我觉得这根本不是一个好的设计，因为每个 mvc 表单开发人员都需要牢记这一点。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-09-02T14:52:51.987

这可能是“设计使然”，但这不是记录的内容：

> ```
> Public Shared Function Hidden(  
> 
>   ByVal htmlHelper As System.Web.Mvc.HtmlHelper,  
>   ByVal name As String, ByVal value As Object)  
> As String 
> ```
> 
> System.Web.Mvc.Html.InputExtensions 的成员
> 
> 摘要：返回隐藏的输入标签。
> 
> 参数：
> htmlHelper：HTML 帮助器。
> name：用于查找值的表单字段名称和 System.Web.Mvc.ViewDataDictionary 键。
> value：隐藏输入的值。如果为 null，则查看 System.Web.Mvc.ViewDataDictionary，然后查看 System.Web.Mvc.ModelStateDictionary 的值。

这似乎表明只有当 value 参数为空（或未指定）时，HtmlHelper 才会在别处寻找值。

在我的应用程序中，我有一个表单： html.Hidden("remote", True) 呈现为 `<input id="remote" name="remote" type="hidden" value="False" />`

请注意，该值被 ViewData.ModelState 字典中的内容覆盖。

还是我错过了什么？

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2013-12-11T21:50:57.627

所以在 MVC 4 中，“设计问题”仍然存在。这是我必须使用的代码，以便在集合中设置正确的隐藏值，因为无论我在控制器中做什么，视图总是显示不正确的值。

**旧代码**

```
for (int i = 0; i < Model.MyCollection.Count; i++)
{
    @Html.HiddenFor(m => Model.MyCollection[i].Name) //It doesn't work. Ignores what I changed in the controller
} 
```

**更新代码**

```
for (int i = 0; i < Model.MyCollection.Count; i++)
{
    <input type="hidden" name="MyCollection[@(i)].Name" value="@Html.AttributeEncode(Model.MyCollection[i].Name)" /> // Takes the recent value changed in the controller!
} 
```

他们在 MVC 5 中解决了这个问题吗？

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2015-12-21T13:49:06.963

有解决方法：

```
 public static class HtmlExtensions
    {
        private static readonly String hiddenFomat = @"<input id=""{0}"" type=""hidden"" value=""{1}"" name=""{2}"">";
        public static MvcHtmlString HiddenEx<T>(this HtmlHelper htmlHelper, string name, T[] values)
        {
            var builder = new StringBuilder(values.Length * 100);
            for (Int32 i = 0; i < values.Length; 
                builder.AppendFormat(hiddenFomat,
                                        htmlHelper.Id(name), 
                                        values[i++].ToString(), 
                                        htmlHelper.Name(name)));
            return MvcHtmlString.Create(builder.ToString());
        }
    } 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2015-06-03T13:39:20.617

正如其他人所建议的那样，我使用直接 html 代码而不是使用 HtmlHelpers（TextBoxFor、CheckBoxFor、HiddenFor 等）。

但是这种方法的问题是您需要将 name 和 id 属性作为字符串。我想保持我的模型属性是强类型的，所以我使用了 NameFor 和 IdFor HtmlHelpers。

```
<input type="hidden" name="@Html.NameFor(m => m.Name)" id="@Html.IdFor(m=>m.Name)" value="@Html.AttributeEncode(Model.Name)"> 
```

**更新：** 这是一个方便的 HtmlHelper 扩展

```
 public static MvcHtmlString MyHiddenFor<TModel, TValue>(this HtmlHelper<TModel> helper, Expression<Func<TModel, TValue>> expression, object htmlAttributes = null)
    {
        return new MvcHtmlString(
            string.Format(
                @"<input id=""{0}"" type=""hidden"" value=""{1}"" name=""{2}"">",
                helper.IdFor(expression),
                helper.NameFor(expression),
                GetValueFor(helper, expression)
            ));
    }

    /// <summary>
    /// Retrieves value from expression
    /// </summary>
    private static string GetValueFor<TModel, TValue>(HtmlHelper<TModel> helper, Expression<Func<TModel, TValue>> expression)
    {
        object obj = expression.Compile().Invoke(helper.ViewData.Model);
        string val = string.Empty;
        if (obj != null)
            val = obj.ToString();
        return val;
    } 
```

然后你可以像这样使用它

```
@Html.MyHiddenFor(m => m.Name) 
```

# java - 字符串相等与位置相等

> ID：594604
> 
> 赞同：7
> 
> 时间：2009-02-27T12:46:38.860
> 
> 标签：java, string, equality

```
String s1 = "BloodParrot is the man";  
String s2 = "BloodParrot is the man";  
String s3 = new String("BloodParrot is the man");  

System.out.println(s1.equals(s2));
System.out.println(s1 == s2);
System.out.println(s1 == s3);
System.out.println(s1.equals(s3)); 
```

// 输出
true
true
false
true

如果所有三个字符串都具有相同的内容，为什么不是所有字符串在内存中都具有相同的位置？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-02-27T12:54:36.877

Java 只会自动实习字符串*文字*。默认情况下，新的 String 对象（使用`new`关键字创建）不被实习。您可以使用[String.intern()](http://java.sun.com/j2se/1.3/docs/api/java/lang/String.html#intern())方法来实习现有的 String 对象。调用`intern`将检查现有字符串池中是否存在匹配对象，如果存在则返回它，如果不匹配则添加它。

如果您添加该行

```
s3 = s3.intern(); 
```

在您创建后立即添加到您的代码`s3`，您将看到输出的差异。

[查看更多示例和更详细的说明](http://javatechniques.com/blog/string-equality-and-interning/)。

这当然引出了一个非常重要的话题，即何时使用 == 以及何时使用`equals`Java 中的方法。`equals`在处理对象引用时，您几乎总是想使用。== 运算符比较参考值，这*几乎*不是您要比较的意思。了解差异有助于您决定何时使用 == 或`equals`.

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-27T12:48:26.097

您为 s3 显式调用 new ，这将为您留下一个新的字符串实例。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-27T12:55:31.303

创建一个`String`实际上是一个快速的过程。尝试查找以前创建的任何`String`内容都会慢得多。

考虑一下你需要做什么才能让所有人都`String`被实习。您需要搜索一组所有先前构造`String`的 s。请注意，这必须以线程安全的方式完成，这会增加开销。因为您不希望它泄漏，所以您需要使用某种形式的（线程安全的）非强引用。

当然，您不能像这样实现 Java，因为不幸的是该库公开了`String`s 和大多数其他不可变值对象的构造函数。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-27T12:50:06.013

new 关键字总是生成一个新字符串。

[更多细节在这里](http://www.xyzws.com/javafaq/what-is-string-literal-pool/3)。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-27T12:50:48.070

> 如果所有三个字符串都具有相同的内容，为什么不是所有字符串在内存中都具有相同的位置？

因为它们是具有相同内容的**不同**字符串！

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-27T15:14:21.313

有一种称为 String.intern 的方法，本质上，它获取所有相同的字符串并将它们放入哈希表中（我有点撒谎，但对此重要的是概念，而不是现实）。

```
String s1 = "BloodParrot is the man";  
String s2 = "BloodParrot is the man";  
String s3 = new String("BloodParrot is the man").intern();  

System.out.println(s1.equals(s2));
System.out.println(s1 == s2);
System.out.println(s1 == s3);
System.out.println(s1.equals(s3)); 
```

应该让它们都是“真实的”。这是因为（我又在这里撒了一点谎，但它仍然只对概念而不是现实很重要） String s1 = "BloodParrot is the man"; 做了类似 String s1 = "BloodParrot is the man".intern();

# c# - 插件模式 - IoC/DI 与否？

> ID：594608
> 
> 赞同：4
> 
> 时间：2009-02-27T12:47:17.190
> 
> 标签：c#, .net, design-patterns

只是一个非常普遍的问题，不仅适用于这个例子。

假设您有一个在线商店，并且您想要实施优惠券/礼券，但具有约束条件。假设您有一张 20% 的优惠券，但这仅适用于过去 3 周内添加的产品，不适用于特殊促销中的产品。

我看到了两种解决方法：第一种方法是将您的商店编码为“本机”支持所有疯狂类型的代金券。这似乎是经典的方式，但它意味着大量的工作和很少的灵活性（毕竟，你不能事先知道你需要什么，也许销售人员可能会想出一些非常棒的新促销活动，需要新的优惠券- 下周一）。

第二种方式是插件方式：凭证就像插件，每个凭证都有自己的代码。您将购物篮传递到凭证中，然后凭证本身会检查每个项目是否适用，进行必要的更改并返回更改后的购物车。

我只是想知道，案例 2 的设计模式是什么？它看起来有点像 IoC/DI，但又不是真的，因为凭证并没有取代任何现有的功能。它更像是一组具有特殊接口的对象（即 IVoucher），然后是一个迭代的 IVoucher 对象队列。这些类型的“操纵器”是否有标准模式（和最佳实践）？

编辑：感谢您的回答。为了澄清这一点，凭证（或操纵器 - 如上所述，这不仅是关于在线商店的问题，而且是关于类似情况的问题）是“重”对象，即它们中有业务逻辑。所以我可以说，优惠券仅适用于客户在 2008 年 1 月 1 日之前注册的情况，仅当客户在过去 6 个月内订购了至少 100 美元时，仅适用于 X 类商品，与其他优惠券“堆叠”，除了对于标记为减少等的项目等等等等。所以我更关心的是如何保持一个干净的结构，以确保优惠券得到他们需要的所有东西，以检查它们是否适用并能够操纵购物车，所以我想知道关于这种情况的标准是什么，这正是访问者模式似乎所做的。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-27T12:51:58.800

在这种情况下，您可以使用[策略模式](http://en.wikipedia.org/wiki/Strategy_pattern)和[访问者模式](http://en.wikipedia.org/wiki/Visitor_pattern)来计算篮子的价值。

访问者可以使用不同的策略（在本例中为折扣券）访问篮子中的每个项目，并使用这些策略来计算篮子的全部成本。

使用的凭证可以通过某种方式从数据库中检索出来，并很容易地注入到访问者中。

凭证策略可能如下所示：

```
public interface IVoucher
{
    decimal CostOf(CartItem cartItem);
} 
```

默认是这样的：

```
public class FullPriceVoucher : IVoucher
{
    public decimal CostOf(CartItem cartItem)
    {
        return cartItem.Cost;   
    }
} 
```

10% 的折扣类似于：

```
public class TenPercentOffVoucher : IVoucher
{
    public decimal CostOf(CartItem cartItem)
    {
        return cartItem.Cost * 0.9m;   
    }
} 
```

然后你可以有一个访问者来计算购物车价值，如下所示：

```
public class CartValueVisitor
{
    private IVoucher voucher;

    public CartValueVisitor(IVoucher voucher)
    {
        this.voucher = voucher;
    }

    public decimal CostOf(Cart cart)
    {
        return cart.Items.Sum(item => voucher.CostOf(item));
    }
} 
```

您会使用如下：

```
var cart = GetACart();

var fullPriceCartValueVisitor = 
        new CartValueVisitor(new FullPriceVoucher());
var tenPercentOffCartValueVisitor = 
        new CartValueVisitor(new TenPercentOffVoucher());

var fullPrice = fullPriceCartValueVisitor.CostOf(cart);
var tenPercentOffPrice = tenPercentOffCartValueVisitor.CostOf(cart); 
```

这显然一次只能使用一张凭证，但应该让您了解总体结构。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-27T13:32:27.177

之前建议访问者和策略模式的答案对我来说听起来不错，尽管在每个购买项目都是同一个具体类的对象的典型情况下，访问者是矫枉过正的。访问者的目的是允许对两个（或更多）对象类型进行动态调度——访问的对象是一个层次结构的一部分，而访问者是另一个层次结构的一部分。但是，如果只有一种对象类型（实现类的具体类型`IVoucher`）不同，那么您只需要常规的旧单类型虚拟调度。

事实上，我个人根本不会为任何“模式”而烦恼——您自己的描述正是我们所需要的：创建一个接口，`IVoucher`以及一堆实现该接口的类。您还需要一个工厂方法，该方法采用凭证代码并返回`IVoucher`具有适当具体类型的对象。

## 当心非交换凭证！

您提到的 IVoucher 实施对象队列将针对购买项目运行这一事实意味着可能会使用多个凭证。 **在这种情况下，您需要小心**——应用凭证 A，然后使用凭证 B 是否总是与应用 B 然后 A 具有相同的效果？不幸的是，许多典型的“特别优惠”似乎没有这个属性（例如，如果优惠券 A 为您提供 10 美元的折扣，而优惠券 B 为您提供 5% 的折扣，那么订单肯定很重要）。

一个快速而肮脏的方法是为每个凭证分配一个不同的数字“优先级”值，并始终按优先级值顺序应用凭证。为了减少“奇怪”的代金券组合导致您破产的可能性，将代金券组合限制为代码中指定的某些允许组合可能也是一个好主意。（这可以像优惠券代码列表一样简单。）

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-27T12:51:46.367

也许是[访客模式](http://www.dofactory.com/Patterns/PatternVisitor.aspx)？不同类型的代金券是访问者，他们访问购物篮并对其进行操作。

我不认为国际奥委会是这里的解决方案。

# wpf - INotifyPropertyChanged 不适用于 ObservableCollection 属性

> ID：594610
> 
> 赞同：0
> 
> 时间：2009-02-27T12:47:27.393
> 
> 标签：wpf, data-binding, observablecollection

我有一个名为`IssuesView`which implements的类`INotifyPropertyChanged`。此类拥有一个`ObservableCollection<Issue>`并将其公开为一个`DependencyProperty`名为的问题以供`Bindings`. 它定义如下 -

```
 public class IssuesView : DependencyObject, INotifyPropertyChanged
{
    public Issues Issues
    {
        get { return (Issues)GetValue(IssuesProperty); }
        set
        {
            SetValue(IssuesProperty, value);
            if (PropertyChanged != null)
            {
                PropertyChanged(this, new PropertyChangedEventArgs("Issues"));
            }
        }
    }

    // Using a DependencyProperty as the backing store for Issues.  This enables animation, styling, binding, etc...
    public static readonly DependencyProperty IssuesProperty =
        DependencyProperty.Register("Issues", typeof(Issues), typeof(IssuesView), new UIPropertyMetadata(null));

    public IssuesView()
    {
        Refresh();
    }

    public void Refresh()
    {
        this.Issues = new Issues();
    }

    #region INotifyPropertyChanged Members

    public event PropertyChangedEventHandler PropertyChanged;

    #endregion
} 
```

我有一个这样声明的测试页-

```
<Page x:Class="Tracker.Pages.DEMO"
xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
  xmlns:cont="clr-namespace:Tracker.Controls"
Title="DEMO">
<StackPanel>
    <Button Click="Button_Click">Change</Button>
    <cont:IssueTimeline IssuesForTimeline="{Binding Source={StaticResource issuesView},Path = Issues}"/>
</StackPanel> 
```

类`IssuesView`定义在`Application.Resources`.
现在在按钮的事件 hadnler 我有这个代码 -

```
private void Button_Click(object sender, RoutedEventArgs e)
    {
        IssuesView iv = Application.Current.FindResource("issuesView") as IssuesView;
        if (!once)
        {
            foreach (Issue i in iv.Issues)
            {
                i.DormantFor = new TimeSpan(30, 0, 0, 0);
                i.AssignedUserID = 12;
                i.Name = "MyName";
                i.Priority = Issue.Priorities.Critical;
                i.Status = Issue.Statuses.New;
                i.Summary = "NewSummary";
            }
            once = true;
        }
        else
        {
            iv.Refresh();
        } 
```

once 是一个简单的布尔值，用于测试集合的突变与重新填充。

第一次单击按钮会更改集合的项，并且 UI 会正确更新，因为这些项实现了 INotifyPropertyChanged，但第二次单击会重新填充集合，但不会更新 UI，即使事件不为 null 并且正确触发也是如此。

为什么第二次点击时 UI 不更新？我怎样才能使它重新填充集合将导致 UI 更新？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-27T12:59:47.533

首先：没有理由`INotifyProperty`为 DependencyProperties 实施更改。DependencyProperties 知道它们何时更改。

`ObservableCollection`第二：我在你的代码中没有看到。

第三：我并不完全清楚（从您发布的代码中）您在第一次点击中修改的问题来自哪里。我从另一个动作中假设，未在此处发布。

如果我假设您想通过第二次单击清除问题列表，我是否正确（因为我不知道`Issues`构造函数的作用）？

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-27T13:00:56.347

你真的需要简化你的复制。我可以看到它有几个问题，但是如果没有看到*所有*问题，就无法帮助解决您的问题。这是我的简单复制品，效果很好。

Window1.xaml：

```
<Window x:Name="_root" x:Class="CollectionRepro.Window1"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    Title="Window1" Height="300" Width="300">
    <StackPanel DataContext="{Binding ElementName=_root}">
        <ItemsControl ItemsSource="{Binding Issues}"/>
        <Button x:Name="_addButton">Add</Button>
        <Button x:Name="_resetButton">Reset</Button>
    </StackPanel>
</Window> 
```

Window1.xaml.cs：

```
using System.Collections.Generic;
using System.Collections.ObjectModel;
using System.Windows;

namespace CollectionRepro
{
    public partial class Window1 : Window
    {
        public static readonly DependencyProperty IssuesProperty = DependencyProperty.Register("Issues",
            typeof(ICollection<string>),
            typeof(Window1));

        public ICollection<string> Issues
        {
            get { return (ICollection<string>)GetValue(IssuesProperty); }
            set { SetValue(IssuesProperty, value); }
        }

        public Window1()
        {
            InitializeComponent();
            Reset();

            _addButton.Click +=new RoutedEventHandler(_addButton_Click);
            _resetButton.Click += new RoutedEventHandler(_resetButton_Click);
        }

        void  _resetButton_Click(object sender, RoutedEventArgs e)
        {
            Reset();
        }

        void  _addButton_Click(object sender, RoutedEventArgs e)
        {
            Issues.Add("Another issue");
        }

        private void Reset()
        {
            Issues = new ObservableCollection<string>();
        }
    }
} 
```

# java - java中的ADO.net原理

> ID：594613
> 
> 赞同：0
> 
> 时间：2009-02-27T12:48:10.730
> 
> 标签：java, ado.net, persistence

我在询问有关在 java 中实现模拟 ado.net 的框架（数据表、数据集等）的意见。想法是避免编写域对象，因为到目前为止，它们仅用于将数据从服务器传输到客户端并返回，其中没有特定的业务方法。主要目标是加快开发时间。我可以从编写这种框架中受益吗？如果它在提供链接之前完成，请。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-27T14:22:30.067

无论是 ADO.NET 还是其他任何东西，我都知道我的第一步应该是不编写任何库或框架。相反，我继续工作。

我第二次想写一个库或框架时，我通常会考虑一段时间，决定不写，然后继续工作。

第三次被诱惑时，我通常会屈服于诱惑。到那时，我将编写一堆无需库或框架即可工作的代码。我将重构该代码（真实的、使用过的、经过测试的代码）。我将迭代地执行此操作，不断地运行我的自动化单元测试，并根据需要编写新的测试。当我在这个任务中被打断时（这将发生，因为编写框架可能不是我工作的一部分），我可以确定我正在留下正在运行的代码，即使它只完成了一半。

当我回到它时，我会继续重构到一个点，记住我应该在使用我重构的东西之前获得一些经验，然后再朝着我*认为*应该走的方向走得更远。使用它的真实代码，我不必猜测进行重构的方向。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-27T14:24:59.263

我将使用诸如[Hibernate之类的](http://www.hibernate.org/)[ORM](http://en.wikipedia.org/wiki/Object-relational_mapping)工具，而不是模拟 ADO.NET 。这样，您就可以拥有一个库来处理您自己的所有 SQL 和持久性需求，并且您不必担心处理类似伪表的结构。

我发现使用强类型域对象比使用 SQL、结果集等更容易开发（和测试）。

# javascript - IE7 中非常奇怪的 JavaScript 错误

> ID：594619
> 
> 赞同：0
> 
> 时间：2009-02-27T12:50:22.940
> 
> 标签：javascript, jquery, internet-explorer

我正在开发 JavaScript 聊天。我已经完成了原型，它似乎工作得很好。但是我们的客户说它不起作用。我们都在 PC 上使用 IE7，并尝试运行相同的 JavaScript 代码。我不知道原因。在我客户的机器上出现“预期对象”错误。我已经考虑过安全限制，并试图在我的 IE 中提高安全级别，但在这种情况下，脚本不会运行并且没有错误消息。我正在远程服务器上运行脚本。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-27T12:53:16.957

客户端机器可能在组策略中运行，出于安​​全原因可以限制脚本的执行。因此，客户可能需要将您的原型作为其受信任站点的一部分，并放宽对受信任站点的限制

您能否提供有关特定错误的更多详细信息？您是向客户发送解决方案的压缩版本还是托管在某个地方？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-27T13:18:29.097

来自[IEB 博客](http://blogs.msdn.com/ie/archive/2004/10/26/247912.aspx)；您可以尝试使用 Microsoft Script Debugger（见帖子）

您可能会发现一件事，尤其是对于 IE，报告的错误实际上是由代码中的先前错误引起的。

[尝试通过jslint](http://www.jslint.com/)运行您的 javascript以确保其格式正确。

在带有 [firebug] 的 Firefox 中，在控制台中启用严格警告。

相关的 SO 帖子。

[调试-javascript-in-ie7](https://stackoverflow.com/questions/361635/debugging-javascript-in-ie7)。
[调试-javascript-for-ie6](https://stackoverflow.com/questions/464644/debugging-javascript-for-ie6)。

编辑::
要寻找的一件事是数组中最后一个元素之后的逗号，IE 似乎忽略了右括号`}`并继续向数组中添加以下代码。Firefox 优雅地假设您忘记了它。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-27T13:09:31.193

如果您从 localhost 运行代码，而他从远程服务器运行代码，则可能是时间问题 - 某些脚本可能在页面完成加载之前运行，这会导致连接速度较慢而快速隐藏的问题联系。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-27T13:10:29.413

如果您尝试使用客户端浏览器无法访问的外部脚本文件，您可能会收到此错误。例子 ：

```
<script src="http://localhost/scripts/freelib.js" language=Javascript> </script> 
```

您可以在您的机器上访问 freelib.js，但在任何其他机器上运行它都行不通。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-27T13:16:31.863

您确定正在加载所有脚本吗？在某些或全部未加载（可能它们未部署）之前，我已经看到该错误消息。尝试手动从源中复制所有 js 文件的地址并粘贴到地址栏中，以确保浏览器确实可以访问它们。

您可以在 Firefox 中在您的客户端机器上运行该页面吗？Firefox 控制台应该给你一个比 IE 更详细的错误信息。

# javascript - parseInt 替代

> ID：594625
> 
> 赞同：14
> 
> 时间：2009-02-27T12:51:53.233
> 
> 标签：javascript, mysql, ajax

首先 - 我的描述;）

我从服务器收到了 XmlHttpRequests JSON 响应。MySQL 驱动程序将所有数据输出为字符串，PHP 按原样返回，因此任何整数都作为字符串返回，因此：

JS 中的 parseInt() 函数是否有任何快速替代（hack）可以解析纯数字字符串，例如

```
var foo = {"bar": "123"};
...
foo.bar = parseInt(foo.bar); // (int) 123 
```

* * *

## 回答 #1

> 赞同：44
> 
> 时间：2009-02-27T13:59:57.123

要转换为整数，只需使用一元 + 运算符，它应该是最快的方法：

```
var int = +string; 
```

可以用类似的方式转换到其他类型：

```
var string = otherType + "";
var bool = !!anything; 
```

[更多信息](http://www.jibbering.com/faq/faq_notes/type_convert.html "更多信息")。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2009-02-27T13:26:39.763

**JavaScript 中的类型转换是通过不带`new`**的内置类型的构造函数完成的，即

```
foo.bar = Number(foo.bar); 
```

这`parseInt()`在几个方面有所不同：

*   前导零不会触发八进制模式
*   浮点值也将被解析
*   整个字符串被解析，即如果它包含额外的非数字字符，返回值将是`NaN`

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-02-27T12:59:06.070

首先，您是否真的记录了它很慢并且正在引起问题？否则，我不会费心寻找解决方案，因为真的没有问题。

其次，我猜想由于 parseInt 是一个原生 JS 方法，它会以非常快的方式实现，并且可能使用 VM 的原生语言（可能是 C，取决于浏览器/VM）。我认为用纯 JS 制作更快的方法可能会遇到一些麻烦。=)

当然，我不是 JS 专家，所以我不确定，但这是我的直觉告诉我的，并且往往是“我如何为 libraryFunction() 提供更快的替代方案？ " 问题。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-02-27T13:06:08.597

在你之前将它转换为 PHP 中的 int `json_encode()`：

```
$foo->bar = (int)$foo->bar;
print('var foo = ' . json_encode($foo)); 
```

顺便说一句，当使用 parseInt 时，最好始终指定第二个参数，除非您真的希望以 0 开头的字符串被解释为八进制等等：

```
parseInt('010', 10); // 10 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2014-11-12T23:13:34.597

parseInt 的快速快捷方式是

```
("78.5" | 0) //bitwise or forces the string to parse as int 
```

这就是[ASM](http://asmjs.org)在 js 中用来表示整数的方法。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-02-27T13:02:52.957

Number 构造函数也存在，但在速度方面它应该与 parseInt 相同（正如已经说过的，无论如何你应该更正 PHP 部分而不是 javascript 部分）：

```
var i = "123";
i = new Number(i); // Number numeric wrapper
var j = "123";
j = Number(j); // Number primitive 
```

顺便说一句，如果有人感兴趣，我会好奇地搜索 parseInt 的 V8（谷歌浏览器）实现，它[在谷歌代码上](http://www.google.com/codesearch/p?hl=en#Qv8GC2UAjhg/src/runtime.cc&q=StringParseInt&l=1858)。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-02-27T13:07:22.197

你不会比 parseInt 更好，但真正的错误是 PHP 提供的应该是数字作为字符串。

和丹尼尔所说的一样——在你对代码进行基准测试并发现它值得做之前，不要去寻找这样的微优化。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-02-27T13:22:10.587

能慢到什么程度？这个过程每秒被调用多少次？有多少种不同的数值返回值？我编写了一个脚本并测试了 100,000 个数字。从字符串中解析它们花费了 687 毫秒。在数组中搜索它们需要 541 毫秒。这是一个非常小的改进。我同意其他海报。您可能不会比本机 parseInt() 方法更好。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-02-27T13:33:54.770

转换比解析快一点，但比搜索慢。

此外，在 Firefox 中，最快的方法是 parseInt() 然后搜索。Firefox 的平均速度也比 IE 快 6 倍。有趣的。

使用一元运算符的好主意。在 Firefox 中，结果与 parseInt() 相当。在 IE 中，它被证明是最快的方法。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-02-27T13:09:08.853

如果对象较大，您可以尝试[JSON](http://en.wikipedia.org/wiki/JSON)，它是一种类型化格式，因此您不需要转换值。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2019-02-17T02:36:39.843

如果您解析长度为 20 或更短的十进制整数字符串，则此解决方案比 parseInt() 更快。对于某些浏览器，您可能仍然比 parseInt() 快 33 位的长度。此外，您仍然比自动施法更快。

这是因为，浏览器的 parseInt() 确实需要一些时间来预热，所以如果你只使用一个简单的方法来解析，你会打败它一段时间，直到它赶上来。不过，不要将它用于 nodeJS。当从 nodeJS 运行 parseInt() 时，它的启动时间比从浏览器运行时少很多。

45 是 ASCII 中的“-”符号，43 是 ASCII 中的“+”符号。48 是“0”。只有 48 到 57 xor 48 变成 0 - 9（按它们的顺序）。没有其他数字 xor 48 产生 0-9。

如果字符串不是有效的十进制整数字符串或字符串为空，这将返回 undefined。如果输入不是字符串类型，它会抛出一个值为“非字符串”的字符串。

```
var toNumber = function (input) {
    if ( typeof input !== "string" ) throw "Not a string";

    var length = input.length;
    if ( length === 0 ) return;
    var c1 = input.charCodeAt(0); 

    if ( c1 === 45 || c1 === 43 ){
        if ( length === 1 ) return;
        var start = 1;
    } else {
        var start = 0;
    }

    var out = 0, c;    
    while( start < length && input.charCodeAt(start) === 48 ) start++;

    for ( ; start < length; start++){
        c = input.charCodeAt(start) ^ 48;
        if ( c > 9 ) return;
        out = (out * 10) + c;
    }

    if ( c1 === 45 ) return out * -1;
    return out;
} 
```

# asp.net - MS SQL 2000 还是 MySQL 5.0？

> ID：594646
> 
> 赞同：2
> 
> 时间：2009-02-27T12:59:25.150
> 
> 标签：asp.net, mysql, sql-server

对于流量很少的小型 ASP.NET 2.0 网站，您会选择哪一个？我对其中任何一个都没有经验，但我的提供者希望我选择一个。事实上，我也没有 ASP.NET 的经验，我刚刚开始学习，使用的是 VS2008 Professional。

谢谢你，彼得

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-27T13:03:32.020

使用MS SQL，在Visual Studio中有更好的支持，学习起来会更轻松。套路，检查你是否可以获得 MS SQL 2005 或 2008。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-27T13:05:36.053

从性能的角度来看，在流量很少的网站上可能并不重要。在您的情况下，我会选择 SQL 2000 仅仅是因为它可能会比 MySQL 更好地与 ASP.NET 集成。

如果您说您使用 PHP 创建站点，我会告诉您使用 MySQL，但出于同样的原因 - PHP 与 MySQL 的集成非常好。

它们都是很棒的数据库，只是在您的特定情况下哪个效果更好。在您的情况下，这将是 SQL 2000。

# visual-studio - Eclipse的选项卡双击Visual Studio？

> ID：594659
> 
> 赞同：8
> 
> 时间：2009-02-27T13:05:28.817
> 
> 标签：visual-studio, eclipse

在 Eclipse 上，每当我双击一个选项卡时，它都会填充工作区（通过隐藏所有其他视图，如项目树、控制台等）。

有没有办法在 Visual Studio 上做到这一点？

注意：我不是在寻找全屏，只是想要一种整理工作区但仍然可以访问菜单的方法。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-27T13:26:34.583

你在追求[这个](http://blogs.msdn.com/saraford/archive/2008/01/16/did-you-know-you-can-auto-hide-all-of-your-tool-windows-with-one-command.aspx)吗？

`Window.AutoHideAll`为函数和函数设置快捷方式`Window.ResetWindowLayout`。为了使 ResetWindowLayout 起作用，您必须导出设置（确保选择“所有设置”）并展开所有窗口，然后再次导入它们。

ResetWindowLayout 会将所有窗口恢复到您上次导入设置时的状态。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2016-08-26T13:10:29.337

不是双击选项卡，但您可以使用 Shift+Alt+Enter 组合键执行相同操作。

此键盘快捷键从 1.9.1 vscode 版本更改为 F11。

所有键盘快捷键：[https ://code.visualstudio.com/shortcuts/keyboard-shortcuts-windows.pdf](https://code.visualstudio.com/shortcuts/keyboard-shortcuts-windows.pdf)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-27T13:45:43.103

我也在寻找那个，我现在刚刚习惯使用全屏（Shift+Alt+Enter），它隐藏了太多，你似乎也这么认为，但实际上仍然显示菜单。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-10-15T17:52:40.730

看起来 drby 在这个上得到了它。仅供参考。我联系了 VS 团队询问这个问题，这是回复：

“没有办法自动反转命令。为了让它作为切换工作，我们需要保存哪些工具窗口是自动隐藏的，哪些是在命令运行时没有自动隐藏的，我们不这样做（这会导致很多有趣的持久性问题，跨配置文件和 VS 会话）。”

“Unhide All”命令的想法是我建议的。因此，如果您隐藏所有内容，那么您也可以取消隐藏所有内容。可能有一些窗口您不想取消隐藏，但 1 或 2 个额外的窗口总比没有取消隐藏恕我直言要好。

# web-applications - 现成的基于 Web 的服务管理软件

> ID：594663
> 
> 赞同：0
> 
> 时间：2009-02-27T13:06:24.507
> 
> 标签：web-applications, saas

有谁知道任何旨在轻松创建云应用程序管理器的软件？

我想我想要一些指向数据库的东西，定义字段名称、验证和 ACL，然后将这些字段放在小部件上，将小部件放在选项卡上，将选项卡放在页面上，这一切都会正常工作。

那里肯定有东西吗？不幸的是，我一开始就被困住了：我什至不知道要在 Google 中添加什么 .. 甚至 Stack Overflow 都在告诉我我的头衔很烂:-(

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-27T13:35:33.843

你知道什么是[网络服务](http://en.wikipedia.org/wiki/Web_service)吗？我想你可能只是指一个[网络应用程序](http://en.wikipedia.org/wiki/Web_application)。你并不是说管理（几乎是一个完全没用的术语；它无处不在）你的意思是你想要一个拖放式 Web 界面创建/维护工具。

如果我对您想要的东西的猜测是正确的，那可能有助于使您的术语正确。如果您对这些术语感到困惑，那么这意味着一定程度的理解。在取得进展之前，您可能需要更多地了解计算和现代 Web 技术。

但快乐的谷歌搜索:)

# xml - VBScript 中的 XPath 计数

> ID：594667
> 
> 赞同：6
> 
> 时间：2009-02-27T13:07:53.257
> 
> 标签：xml, xpath, vbscript

我正在尝试使用 XPath 计数函数获取 XML 文件中特定节点的数量，但是，这一直返回错误“'msxml3.dll 类型的异常：表达式不返回 DOM 节点。”

如何使用 VBScript 和 MSXML DOM 从 XPath 计数中获取返回值

```
Dim oXML    
Dim homeId
Dim awayId
Dim homeGoals
Dim awayGoals
Set oXML = Server.CreateObject("Microsoft.XMLDOM")

oXML.async = false
oXML.SetProperty "SelectionLanguage", "XPath"
oXML.SetProperty "ServerHTTPRequest", True
oXML.validateOnParse = False
oXML.resolveExternals = False

fileName = "http://server:8090/data/results/m12345.xml")
oXML.load (fileName)

homeId = oXML.SelectSingleNode("/SoccerMatch/Team[@homeOrAway='Home']/@id").text
awayId = oXML.SelectSingleNode("/SoccerMatch/Team[@homeOrAway='Away']/@id").text
Set homeGoals = oXML.SelectSingleNode("count(/SoccerMatch/Goals/Goal[@teamId="&homeId&"])")
Set awayGoals = oXML.SelectSingleNode("count(/SoccerMatch/Goals/Goal[@teamId="&awayId&"])") 
```

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-02-27T13:14:31.120

您只能使用在 MSXML 中返回节点的 XPath，其他 XPath 函数只能在最终导致选择节点的谓词中使用。

采用：-

```
homeGoals = oXML.SelectNodes("/SoccerMatch/Goals/Goal[@teamId="&homeId&"]").length 
```

# sql - 从当前id获取上一行和下一行

> ID：594668
> 
> 赞同：1
> 
> 时间：2009-02-27T13:08:32.693
> 
> 标签：sql, mysql

如何获取表格中的下一行？

```
`image_id` int(11) NOT NULL auto_increment
`image_title` varchar(255) NOT NULL
`image_text` mediumtext NOT NULL
`image_date` datetime NOT NULL
`image_filename` varchar(255) NOT NULL 
```

例如，如果当前图像是 3，而下一个图像是 7 等等，这将不起作用：

```
$query = mysql_query("SELECT * FROM images WHERE image_id = ".intval($_GET['id']));
echo $_GET['id']+1; 
```

我应该怎么做？

谢谢

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-02-27T13:12:37.987

```
SELECT * FROM images WHERE image_id < 3 ORDER BY image_id DESC LIMIT 1 -- Previous
SELECT * FROM images WHERE image_id > 3 ORDER BY image_id LIMIT 1 -- Next 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-02-27T13:16:24.577

如果你想圈出记录，你可以使用这个：

```
-- previous or last, if there is no previous
SELECT *
FROM images
WHERE image_id < 12345 OR image_id = MAX(image_id)
ORDER BY image_id DESC
LIMIT 1

-- next or first, if there is no next
SELECT *
FROM images
WHERE image_id > 12345 OR image_id = MIN(image_id)
ORDER BY image_id ASC
LIMIT 1 
```

* * *

与 UNION 相同，可能更有效：

```
-- previous or last, if there is no previous
(SELECT * FROM images WHERE image_id < 12345 ORDER BY image_id DESC LIMIT 1)
UNION (SELECT * FROM images WHERE image_id = (SELECT MAX(image_id) FROM images))
LIMIT 1

-- next or first, if there is no next
(SELECT * FROM images WHERE image_id > 12345 ORDER BY image_id ASC LIMIT 1)
UNION (SELECT * FROM images WHERE image_id = (SELECT MIN(image_id) FROM images))
LIMIT 1 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-27T13:12:04.447

你很亲密。尝试这个：

```
$query = mysql_query("SELECT * FROM images
                     WHERE image_id > ".intval($_GET['id'])." ORDER BY image_id LIMIT 1");

    <?php echo $_GET['id'] ?> 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-10-15T02:47:31.937

请出于对互联网的热爱，不要自己构建 SQL 查询。使用[PDO](http://php.net/pdo)。

# winforms - 隔离控制依赖关系的“正确”方法是什么

> ID：594670
> 
> 赞同：1
> 
> 时间：2009-02-27T13:08:48.760
> 
> 标签：winforms, user-controls, controls, webforms

我已经制定了在使用之前继承每个 UI 控件的个人规则。在前世，我一直认为这是你可以做的不太有用的事情，因为理由似乎总是“我可能想一次更改所有按钮上的字体”......这种动机从未得到回报……曾经……永远。

不过，最近的两个项目改变了我对这种做法的看法。首先，我们需要一个一致的“ValueChanged”事件，这样我们就可以轻松地在我们的表单上实现一个“脏”标志，而无需大量的 switch 语句来在 Textbox 的“TextChanged”事件或 ListBox 的“SelectedIndexChanged”等之间进行选择。我们只是想在所有控件上监听一个一致的东西，并且对内置控件进行子类化很容易为我们买单。

在第二个项目中，我们尽一切努力使用基本控件，因为 UI 本来应该很简单，但几个月后，很明显他们不再打算削减它了，我们购买了Telerik 控制套件。如果我们从一开始就继承了所有控件，那么将派生控件更改为从 Telerik 控件继承将在全局范围内为我们应用更改。相反，我们必须在所有表单设计器中进行一些搜索和替换。

所以这是我的问题：

1.  只需添加一个类，并使其从控件继承。
2.  添加新的“自定义控件”并继承。
3.  添加一个新的“组件”并继承。

最后，这三个都具有相同的效果，您将获得一种新类型的 Button 来放置在您的表单上。我见过不同的人使用这三个，每个人似乎都认为他们的方式是最好的。我想我应该把这个讨论放在 StackOverflow 上，也许我们可以作为一个社区就哪一个是“正确”的方式达成共识。

注意：我已经有了我的个人意见，哪个是“正确的”，但我想看看世界是怎么想的。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-27T13:14:45.253

如果 1 和 2 都继承，那么它们在功能上是相同的，不是吗？他们中的一个应该*封装*一个控件吗？在这种情况下，您需要添加很多直通成员。我不会推荐它。

Peronally，如果没有很好的理由，我根本不会添加额外的继承......例如，“更改的事件”可能已经通过一些重载等处理。使用 C# 3.0，由于扩展方法，这变得更加清晰 - 即你可以有类似的东西：

```
public static AddChangeHandler(
        this TextBox textbox, EventHandler handler) {
    testbox.TextChanged += handler;
}
public static AddChangeHandler(
        this SomethingElse control, EventHandler handler) {
    control.Whatever += handler;
} 
```

并且只需使用`myControl.AddChangeHandler(handler);`（依靠静态类型`myControl`来解析适当的扩展方法）。

当然，您可以退后一步，在您自己的**模型**而不是 UI 上监听事件——让 UI 以基本方式更新模型，并在您自己的对象模型中拥有逻辑（与控件无关） .

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-01T23:27:06.840

我使用组合。我只需创建一个新的 UserControl 并添加我需要的控件。这很好用，因为：

*   无论如何，我从不使用那么多属性，因此传递方法保持在最低限度。
*   我可以从一种天真的方法开始，然后再对其进行改进。
*   应该在整个站点中一致地设置外观和感觉的属性。现在我可以一劳永逸地设置它们。

# c# - 固定和不安全有什么区别

> ID：594676
> 
> 赞同：5
> 
> 时间：2009-02-27T13:12:08.270
> 
> 标签：c#, memory, unsafe, fixed

为什么在 .NET 中有两种不同的方式锁定内存？它们之间有什么区别？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-02-27T13:13:19.797

fixed 语句在[unsafe 修饰符](http://msdn.microsoft.com/en-us/library/ms228628.aspx)的上下文中使用。Unsafe 声明您将使用指针算术（例如：低级 API 调用），这超出了正常的 C# 操作。[固定](http://msdn.microsoft.com/en-us/library/f58wzh21(VS.80).aspx)语句用于将内存锁定到位，以便垃圾收集器在它仍在使用时不会重新分配它。您不能在不安全的上下文之外使用固定语句。

例子

```
public static void PointyMethod(char[] array)
{
    unsafe
    {
        fixed (char *p = array)
        {
            for (int i=0; i<array.Length; i++)
            {
                System.Console.Write(*(p+i));
            }
        }
    }
} 
```

# version-control - TortoiseSVN 合并

> ID：594679
> 
> 赞同：4
> 
> 时间：2009-02-27T13:12:35.960
> 
> 标签：version-control, merge, tortoisesvn, visualsvn

我对 SVN 和 TortoiseSVN 没有任何经验。

在开发的某个阶段，我们收到了为新客户本地化应用程序的请求。这是一项艰巨的任务，我们决定为本地化创建分支并继续开发没有本地化的应用程序。

目前，本地化已完成，我们需要将此更改合并到主干。分支上的应用程序版本是 1.3。主干上的应用程序版本是 1.6。

这是合并从分支到主干的更改并在主干上保留新功能的最佳方案。

我将 TortoiseSVN 与 VisualSVN 一起使用。

感谢您的帮助。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-27T13:21:28.903

除了根据 BtBhs 文档链接通过 tortoiseSVN 手动合并本地化之外，我看不到任何其他方法，运行所有测试以检查一切是否仍然有效，包括 1.6 上的新功能。这将是很多工作，但这是很长一段时间分支然后不得不合并到一个主干的危险提前几个版本。

编辑：据我所知，将主干更改合并到本地化分支，然后将本地化分支与主干完全合并只是一个额外的步骤。不过，如果从时间和规模的角度来看，这可能是一个好主意，几个人/对完成此合并需要几天的工作，以便他们能够检查他们对本地化分支的更改日常。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-27T13:38:59.110

正如 BtBh 所说，处理此问题的最佳方法在[此处](http://tortoisesvn.net/docs/release/TortoiseSVN_en/tsvn-dug-merge.html)进行了深入解释。

总而言之，您需要做的是：

1.  将您在主干中所做的更改合并到您的功能分支中。
2.  在您的功能分支中完成您的本地化活动 - 不要忘记本地化您在刚刚移动到您的分支的主干中添加的任何新功能。在此过程结束时，您的主干和分支应该是相同的，除了您添加到分支的本地化功能。
3.  一旦你在你的特性分支中完成了你的更改并提交了你的所有更改，然后将你的分支更改合并回你的主干。
4.  从存储库中删除功能分支。（请记住，您始终可以在 SVN 中恢复它。）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-27T13:23:46.760

我们在这里遇到了同样的问题，在我看来，最好的选择是定期将主干更改合并到本地化分支中，并在完成后使分支成为新的主干。但是现在对你来说太晚了:(

我会说将主干合并到分支中，并将所有合并的文件本地化，这可能需要一些时间，具体取决于您的项目。这样您就可以确保在紧急情况下您仍然有一个 workink 后备箱。而且您现在还知道带有红色复选标记的文件是需要本地化的文件（使用乌龟）。在本地化之前不要提交合并文件！

最后使分支成为新的主干。

# nant - nant：扩展字符串中的属性

> ID：594683
> 
> 赞同：3
> 
> 时间：2009-02-27T13:13:04.490
> 
> 标签：nant

概括：

如果属性 buildmode 包含调试，如何将值为“download\${bulidmode}\project\setup.msi”的属性扩展为“download\Debug\project\setup.msi”，以便我可以将其用作文件 = " <复制>的一部分

细节：

我有一点要求能够在 nant 中扩展字符串中的属性。

例如，我有一个将文件 A 复制到 B 的目标。A 和 B 都来自一个简单的两字段 CSV 文件，我正在使用该文件进行迭代

```
<foreach item="Line" in="filelist.csv" delim="," property="source.file,target.file">

    <property name="sourcefile" value="${path::combine(source.dir,source)}" /> 
    <property name="targetfile" value="${path::combine(download.dir,destination)}" />
    <echo message="Copy ${sourcefile} to ${targetfile}" />

    <copy file="${sourcefile" tofile="${destination}" />

</foreach> 
```

并且 filelist.csv 将是

```
build\manifest.xml 
solutiondirectory\setup-proj-directory\Release\setupproj.msi,ProductA\ProductA.msi
solutiondirectory\another-proj-dir\Release\setupproj.msi,ProductB\ProductB.msi 
```

（我们将它们分开的原因是我们编写多层应用程序并由 MSI 部署到每一层 - 所以一个产品有多个 MSI 都使用相同的版本号构建）

无论如何-我想将其更改为在 filelist.csv 文件中不再具有“Release”，而是类似于 ${build.mode}。我会用一个

```
<foreach item="String" in="Release,Debug" delim="," property="build.mode">
....as above
</foreach> 
```

并且嵌入在文件中的字符串中的属性得到扩展。

我一直在用头撞砖墙几个小时，但就是想不通。

谢谢

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-27T13:46:49.230

可以使用自定义功能：

```
<?xml version="1.0"?>
<project>
    <script language="C#" prefix="vbfox" >
        <code>
            <![CDATA[
            [Function("expand")]
            public string ExpandString(string str)
            {
                return Project.Properties.ExpandProperties(str, Location.UnknownLocation);
            }
            ]]>
        </code>
    </script>
    <property name="hello" value="{path::combine('_hello_', '_world_')}" />
    <property name="hello" value="${'$' + hello}" />
    <echo message="${hello}" />
    <echo message="${vbfox::expand(hello)}" />
</project> 
```

# ruby - 使用yaml加载文件时如何指定默认值？

> ID：594692
> 
> 赞同：0
> 
> 时间：2009-02-27T13:18:11.750
> 
> 标签：ruby, yaml

我使用 foo.to_yaml 保存了 Foo 类的对象。现在我向 Foo 类添加了一个实例变量，在初始化方法中将默认值设置为 0。现在，当我尝试从 yaml 文件加载对象时，实例变量设置为 nil。

如果 yaml 文件不包含该实例变量的任何值，是否可以通过某种方式将其设置为 0？

从磁盘加载对象后，是否有一些回调方法被调用？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-27T16:19:44.200

您可以为该变量创建阅读器方法，例如

```
def your_instance_variable
    return "default" unless @your_instance_variable
    @your_instance_variable
end 
```

PS我前段时间正在做一些对象序列化任务，AFAIK Marshal.dump/load 快得多

# oop - 我如何向新程序员解释松散耦合和信息隐藏？

> ID：594698
> 
> 赞同：22
> 
> 时间：2009-02-27T13:19:46.097
> 
> 标签：oop

我如何向新程序员解释松散耦合和信息隐藏？我有一个程序员，我为他编写设计，但他似乎无法掌握松散耦合和信息隐藏的概念。

我编写的设计将所有内容都按功能很好地分解为类（数据访问是分开的，一个用于请求的类，一个控制器，总共大约 5 个类）。他们返回了一个修改后的设计，其中一半的类继承自另一半（并且没有“is-a”关系）和许多公共变量。

我如何才能理解将事物分开可以更容易维护的想法？

* * *

## 回答 #1

> 赞同：57
> 
> 时间：2009-02-27T13:27:33.303

问问他，让你借 10 美元，把他的钱包给你一会儿，然后自己拿钱，这是否是个好主意。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2009-02-27T13:36:56.073

问题在于您的期望，而不是开发人员缺乏技能。您谈论松散耦合和信息隐藏，就好像它们是简单的事实或机械技术一样——它们不是。软件开发是一门手艺，要想在手艺上做得更好，唯一的方法就是实践它，然后慢慢地、逐步地​​改进。

您正在寻找捷径。您希望开发人员体验“啊哈！” 瞬间，突然看到您设计中的智慧。我说，不要屏住呼吸。

采用导师的心态。如果你想让他提高设计水平，就不要“递”给他设计，让他来设计吧！然后和他一起审查设计。这将给他经验、更深的主人翁意识和更愿意在他深入实施之前听取你的建议。

顺便说一句——我注意到人们总是用抽象技能而不是更多的“物理”技能来寻找这些捷径。以网球为例。如果你是一名网球教练，而一名新球员的正手击球时间一直很长，那么你不会只向他展示罗杰·费德勒正手击球的 YouTube 视频并期望他“明白”。出色的正手击球需要多年的经验，因为您可以学习这种感觉并在不同的场景中使用它——这不是你的肌肉学习，而是你的大脑。软件设计也不例外。通过一遍又一遍地做，你会擅长它。您会慢慢从错误中吸取教训，并更好地了解每个单独设计决策的后果。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2009-02-27T13:27:23.567

解释这些概念的最好方法是使用类比。选择一些与编程无关的东西并用它来解释抽象设计概念。

下图很好地解释了松散耦合的必要性：

![依赖倒置原则：你会把灯直接焊接到墙上的电线上吗？](https://i.stack.imgur.com/OJFhI.jpg)

试着想出这样的东西，这些东西会让你的新程序员很开心。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-02-27T13:26:06.130

理论只会让你到目前为止。

让他尝试为他不久前编写的代码添加新功能。然后与他一起重新编写旧代码，使其松散耦合，并要求他添加相同的功能。

他一定会理解编写好代码的好处。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2009-02-27T14:24:19.530

没有什么能比得上物理类比。走到你的车前，指出一切复杂、炎热和危险的事物是如何与脆弱的人类隔离开来的。坐在驾驶座上，指出一些重要的仪表；例如，冷却液温度、转速表和速度表。注意仪表是如何非常相似的：它们都取一个标量值（从某个地方）并通过将指针移动到最小值和最大值之间的位置来表示它。

但是，如果您考虑要测量的内容，那么保持这种隔离（也称为松散耦合或信息隐藏）的强烈动机就会变得更加明显。

*   “您想如何测量冷却液温度？通过查看仪表或将手指伸入接近沸腾的液体中？”

*   “您想如何测量发动机转速？通过查看仪表或让数千 RPM 曲轴从您的骨头上撕下肉，同时您尝试手动估算它？”

*   “你想如何测量汽车的速度？通过查看仪表或在你在高速公路上咆哮时将脚拖到地面上？”

从那里，您可以建立“您的冷却液温度计**是一个**仪表。它**不是一个**沸腾的液体”的概念，等等更复杂的概念。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-03-05T21:09:42.953

![替代文字](https://blogs.warwick.ac.uk/images/jmiles/2007/05/03/pocket_watch.jpg)

*   **松散耦合：**手表的零件可以被其他零件替换而不会损坏整个手表。例如，您可以移开一只手，它仍然可以工作。

*   **信息隐藏：**时钟指针不知道它们背后有一个机械装置。

附加概念

*   **高内聚：**手表“模块”中的所有元素都是强关联的。在这种特定情况下，电池将属于另一个模块或命名空间。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-27T13:28:19.993

给他看[这个演示文稿](http://www.procata.com/talks/phptek-may2007-dependency.pdf)。虽然它主要是关于 DI 的，但它非常出色且直截了当。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-02-27T13:28:23.910

我会试着和他坐下来一起研究几段代码，他看着你的持有者，你解释为什么你在做你正在做的事情。我发现这通常是解释事情的最佳方式。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-02-27T13:35:31.443

让他做出改变，你知道这会因为他的设计而变得困难，并向他展示如何使用你的设计来实现。

如果他抱怨，请告诉他真相：业务会要求更多奇怪的变化，他会看到这一点只是时间问题。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-02-27T13:46:52.617

我认为OO概念确实需要实际学习。真正需要做这些事情才能理解。我上学（工程），我的大多数同龄人并没有真正理解这个概念。他们一般都知道松散耦合是“好”的，但不知道为什么。他们也不知道如何实现松耦合。我现在正在做我最后一年的项目，我通过让他们成为设计过程的一部分来了解他们。（这有助于他们**真正**了解**如何**以及**为什么**并对其重要性有所了解）

鉴于您的情况，我的建议如下：
1\. 让它们完全按照您的设计（至少几个星期）。如果他们想偏离，让他们与你讨论什么和为什么。[时间限制可能不允许这样做]。
2\. 与他们坐下来讨论您接下来要进行的设计的任何部分，并通过示例向他们解释您的一些设计选择。对您来说显而易见的事情可能需要向他们指出。
3\. 留意好设计和坏设计的例子，并向他们展示如何更好地工作。

这里最重要的任务是授权。你必须向他们展示好的代码是什么样的，也许训练他们几个小时。然后，您就何时审查以及如何帮助他们（在有限的空闲时间（？）内）达成一致意见。最重要的是让他们认同并理解好的设计。做这些事情将帮助他们“接受”设计。一旦他们觉得这是他们的设计，我相信他们会做得更好。

总的来说，我认为你需要放下你的脚，让他们正确地编写代码，而不会扼杀他们的创造力。

我在这方面真的没有太多经验。我只是根据对我有用的方法对这个主题发表意见。我希望这有帮助。

**注意**
我想补充一点，OO概念可以从书本中学习，而它们的应用只能通过实践来学习。我已添加此注释以回应 Christopher W. Allen-Poole 的评论。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-02-27T15:00:12.253

只是不要和他说话。那应该教他有关信息隐藏的知识。;-)

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-02-27T15:22:05.117

我喜欢以信用卡为例。

你有一张信用卡。信用卡代表您的信用记录。它有一个余额和一个 APR。它拥有权限和完整的财务状况。它有一个 ID、一个到期日期和一个安全代码。磁条总结了这一切。

当你去当地的信用卡接受机构时，他们不需要知道这一点。他们不想知道这一点，如果他们知道这一点，通常是非常危险的。他们需要“知道”的是有一个磁条可以处理所有这些，并且（有时）持有卡的人的身份证与卡上印的姓名相匹配。

向他们提供更多信息要么（在最好的情况下）无用，要么（在最坏的情况下）危险。要求他们知道与哪家银行核对，确保他们知道如何计算您的特定 APR，或者让他们检查您的余额在这一点上简直是愚蠢的。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2009-02-27T16:29:26.533

如果他误解了你的设计，也许几个结对编程课程就足以让他们走上正轨。我必须同意@ThomasD 并将对此进行扩展——这里正在进行的封装可能是你。这可能是一个简单的误解案例，而不是他们不理解这些概念。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-02-27T13:31:35.523

好吧，如果您必须向他们解释，那么我不得不问：他们真的是程序员吗？

告诉他们他们需要“大学复读”？

这很难，因为这是一个基本概念。就我个人而言，我不想处理它，因为这就像有人获得报酬来学习他们应该已经知道的东西，但生活并不总是理想的。

我会通过找到一个简单到可以相对简单地解决的问题来解决它。当您看不到变量发生了什么变化时，通常通过尝试找到问题的根源来最好地处理公共变量。你可以为此设计一个场景。

过度继承可能不是他们的错。他们可能在 90 年代设计的课程中学到了“一切都必须继承”的想法。我记得经理扩展员工的老例子。这很糟糕。事情是人们被教导这种胡说八道。仍然。

对于 C++，Scott Meyer Effective C++ 系列可能值得他们参考（假设他们可能会费心阅读一些东西）。对于 Java，Josh Bloch 的 Effective Java（“favor composition”）也是如此。不确定C#。

这类书籍为继承与组合提供了更好的方法，还提供了一些很好的例子来说明为什么继承（正如 Josh Bloch 所说）是“实现细节”。我还听说它被描述为“继承破坏封装”。

我曾经看到一个很好的例子，继承与组合在 Java 中扩展了 List 的功能，以及继承如何要求您知道父级的实现细节才能正确执行，而组合却没有。我看看能不能找到。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2009-02-27T13:44:26.913

如果您进行单元测试，请根据测试编写进行解释。或者，抽象类和接口都使用松散耦合和信息隐藏来取得很好的效果。如果你用他可能已经掌握的其他概念向他解释，他将更有可能快速理解这个概念。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2009-02-27T15:32:31.973

[行动中的缺失：信息隐藏](http://www.stevemcconnell.com/ieeesoftware/bp02.htm)，史蒂夫·麦康奈尔（ [Steve McConnell ）](http://en.wikipedia.org/wiki/Steve_McConnell)

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2009-03-01T23:31:19.417

程序是交互部分的系统。

为了使交互部分的系统协同工作，这些部分之间需要连接。

连接越多，程序的成本就越高。

对于固定数量的部件，部件不必要地连接的系统比部件必须连接的系统成本更高。

不必要的连接只能在其部件不必要地暴露于来自其他部件的连接的系统中形成。

最大限度地减少零件与其他零件连接的不必要的暴露是具有成本效益的程序开发的基础。

松散耦合和信息隐藏是连接暴露最小化的基础。

这不是程序员的可选知识。

这是根本。

没有这些知识，你就不可能成为一个注重成本的程序员。

问如何向新程序员解释松散耦合和信息隐藏就像问如何向新外科医生解释手术？或者向新建筑师解释建筑？或者如何向飞行员解释飞行。

如果您的“新程序员”不知道松散耦合和信息隐藏，那么他们就不是“新程序员”；他们是潜在的程序员。

奇怪的是，告诉他们阅读最初的两篇论文可能无济于事： i)松散耦合：WP Stevens、GJ Myers 和 LL Constantine 的“结构化设计”。ii) 信息隐藏：[http ://www.cs.umd.edu/class/spring2003/cmsc838p/Design/criteria.pdf](http://www.cs.umd.edu/class/spring2003/cmsc838p/Design/criteria.pdf)

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2009-03-05T20:46:53.570

就像从 16 位到 32 位的 Windows 应用程序一样，其中进程被赋予了自己的地址空间。这阻止了任何其他进程在“意外”遍历您的数据时能够杀死您的应用程序。

将进程移动到不同的地址空间就像将每个进程视为一个类，并在内部**隐藏**内存并通过强制进程间通信仅通过预期的接口（例如 Windows 消息）发生来**解耦进程。**

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2012-01-11T03:55:49.243

松耦合意味着外部代码应该通过抽象基类使用派生的非抽象类的对象。如果在它所依赖的类集合中发生任何更改，则无需更改外部代码，即外部代码确实表现出松散耦合。

# c++ - 将类从可执行文件导出到 dll

> ID：594703
> 
> 赞同：3
> 
> 时间：2009-02-27T13:21:38.760
> 
> 标签：c++, dllimport

我需要在 DLL 中使用在可执行文件中定义的类（DLL 和可执行文件由同一个编译器编译）。但我不希望这个类定义的源代码对 DLL 可用，只有声明。

一种可能的方法是使所有必要的类方法成为`virtual`（以便 DLL 链接器不需要这些方法的定义）。这种方法的缺点：

1.  我无法使用`new`（必须在可执行代码中创建附加函数）在 DLL 代码中创建导出类的对象。
2.  我必须制作所有这些方法`virtual`，即使它们不需要这样做`virtual`。

`__declspec(dllexport)`有一种方法可以使用 Microsoft 的存储类扩展属性将类从 DLL 导出到可执行文件。有没有办法使用相同的技术将类从可执行文件导出到 DLL？

我的旧 Borland C 6 编译器不允许我在构建可执行项目期间创建导入库。（所以，在编译 DLL 时，链接器会为所有导入的非虚拟类方法提供未解决的外部错误消息。）这是这个编译器的限制，还是我遗漏了一些重要的东西？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-28T01:18:28.337

据我所知，使用 MS VS 的 dllexport 从 exe 导出类或函数并在 DLL 中使用它是可以的。如果您的 DLL 和 Exe**在一个进程中**执行，它运行起来很酷。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-27T13:31:40.593

如果你真的不希望它在第一个 DLL 中，你可以把它放在第二个 DLL 中。

我很难理解您不只是将类放在 DLL 中的原因。

**ETA：**做了更多的挖掘，发现[这个链接](http://www.mail-archive.com/cmake@cmake.org/msg18672.html)解释了如何在 Visual Studio 2008 中从 EXE 项目生成导入库。至于如何导出它们，看起来你只是使用常规的 __declspec(dllexport)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-28T01:55:51.927

好的，根据此处的新信息提供新答案。如果你不能用你的编译器为你的 EXE 生成一个导出库，而且你真的必须这样做，这里有一个创造性的、hacky 且通常不推荐的解决方案：

第 1 步：为你的类创建一个 C 包装 API，有点像这样（可能不会编译，但你明白了）：

```
// Yes, need some 32 bit/64 bit checks here
#define MYHANDLE unsigned int

__declspec(dllexport) MYHANDLE MyClassNewInstance() {
   MyClass* ptr = new MyClass();
   return (MYHANDLE)ptr;
}

__delspec(dllexport) MyClassDoSomething( MYHANDLE handle, int parm ) {
  MyClass* ptr = (MyClass*)handle;
  ptr->DoSomething(parm);
}

etc.. 
```

第 2 步：要真正从 EXE 中获取 C 函数以在 DLL 中使用，请使用 Win32 API 函数 GetModuleHandle() 和 GetProcAddress()。

第 3 步：在您的 DLL 中创建一个代理类。代理类中的方法除了从 EXE 调用它们对应的 C 函数外什么都不做。

这将使您的类的“真实”实现远离 DLL。这是一个黑客，但它可能会工作。

# ruby-on-rails - Rails 和 Acts-as-versioned：您将如何从容地恢复记录？

> ID：594705
> 
> 赞同：1
> 
> 时间：2009-02-27T13:22:42.487
> 
> 标签：ruby-on-rails, rest, routing, acts-as-versioned

如何以尊重 REST 约定和路由的方式恢复记录？

我正在寻找如何设置我的 routes.rb 并构建链接和控制器操作以进行还原的示例。我发现的所有示例都是 pre-REST rails。

我的理解是我的资源控制器中需要有 revert_to_version 函数。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-27T14:13:17.343

我从来没有特别使用acts-as-versioned，但是当我遇到类似的场景时，我通常解决它的方法是通过属性的具体化。换句话说，我只会为资源的实际版本号创建一个新资源。

例如。

```
/resources/:id/actual_version 
```

将指向具有 id :id 的资源的实际版本号。然后要更改实际版本，我们只需将所需的数字输入即可。

```
PUT /resources/:id/actual_version
:version = 123 
```

会将我们的资源恢复到版本 123。

作为惯例，我会使用“last-but-one”之类的东西作为 :version 的值来引用实际版本之前的版本。

然后，要回滚实际版本，我们可以这样做：

```
PUT /resources/:id/actual_version
:version=last-but-one 
```

--

扩展我自己的答案：

在 routes.rb 我们可以这样做：

```
 map.connect   '/resources/:id/actual_version', :controller => 'resources', :action => 'set_version', :conditions => { :method => :put } 
```

在 resources_controller.rb 中：

```
def set_version
  @resource = Resource.find_by_id(params[:id])
  if params[:version] && @resource
    version = params[:version] == "last-but-one" ? @resource.versions.last : params[:version]
    if @resource.revert_to(version)
      # Success, everything went fine!
    else
      # Error, the resource couldn't be reverted - unexisting version?
    end
  else
    # Error, version number or resource id is missing.
  end
end 
```

希望这能澄清我以前的想法。;)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-14T16:50:15.370

我假设您正在滚动自己的系统。我的回答与任何特定的版本控制插件无关。

因为您的 URL 是资源的路径，所以我认为修订参数是可选的。您可以忽略它，并获取最新的修订版，或者明确指定修订版。

```
获取 /pages/1
获取 /pages/1?revision=4

```

编辑也是如此。

```
获取 /pages/1/编辑
获取 /pages/1/edit?revision=4

```

PUT to /pages/1 将创建一个新修订版，将版本号加一。新版本号的创建与当前修订号无关。这只是编辑时的一个起点。

显然，应该不可能为 /pages（创建）的 POST 指定修订版。

如果您特别想跟踪还原，并且上面提到的编辑起点还不够，那么有一些明智的选择。我不是 REST 极客，所以我不确定你应该选择哪一个。也许这是一个品味问题。

```
PUT /pages/1/revisions/4
PUT /pages/1/revert_to?revision=4
PUT /pages/1?revision=4

```

第一种选择的代码示例：

```
# config/routes.rb
map.resources :pages do |page|
  page.resources :revisions
end

# app/controllers/revisions_controller.rb
class RevisionsController < ApplicationController
  def update
    @page = Page.find(params[:page_id]) # page_id is via /pages/[page_id]/revisions/4
    @revision = @page.revisions.find_by_version_number(params[:id])
    @revision.revert
  end
end

# app/models/revision.rb
class Revision < ActiveRecord::Base
  belongs_to :page

  def revert
    page.revert_to(self) # or something like that..
  end
end 
```

如果您顺其自然，那么使用 GET /pages/1/revisions/4 来显示修订版 4 的页面而不是 GET /pages/1?revision=4 可能是有意义的。

# asp.net - 部署 Web 应用程序的问题

> ID：594706
> 
> 赞同：0
> 
> 时间：2009-02-27T13:23:10.693
> 
> 标签：asp.net, deployment, web-applications

我正在尝试将 Web 应用程序部署到我无法控制的远程服务器。

如果我使用 Visual Studio 中的 FTP 部署，我设法将文件放到服务器上，但是当我将浏览器指向服务器时，它给了我标准错误页面：

> “/”应用程序中的服务器错误。运行时错误描述：服务器上发生应用程序错误。此应用程序的当前自定义错误 > 设置阻止远程查看应用程序错误的详细信息（出于安全原因）。但是，它可以通过在本地服务器机器上运行的浏览器来查看。
> 
> 详细信息：要使此特定错误消息的详细信息可以在远程 > 机器上查看，请在“web.config”配置文件中创建一个标签 > 位于当前 Web 应用程序的根目录中。该标签 > 应将其“模式”属性设置为“关闭”。
> 
> 注意：您看到的当前错误页面可以通过修改应用程序的 >configuration 标记的“defaultRedirect”属性以指向自定义错误页面 URL 来替换为自定义错误页面。

正如上面的文字所暗示的那样，我已经确定自定义错误具有 mode="Off" 。除了上面的错误页面之外，没有任何刷新或 Cntl-F5-ing 给我任何东西。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-27T13:30:58.287

很可能是您放置它的位置没有设置为 IIS 应用程序，这是 .net 框架应用程序正常工作所必需的。

由于您无法控制服务器，您将无法更改 IIS 设置，因此将 .net 放到服务器上并不是 Microsoft 大力推动的 xcopy 部署方法。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-27T13:28:05.267

请验证虚拟目录是否正确映射到发布位置。因为您的问题表明更改 web.config 没有影响。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-27T13:30:26.867

可能您在远程服务器上的应用程序未定义为 IIS 中的应用程序。这意味着它找不到它的“代码”资源（bin 或 App_Code 目录），并且 customErrors 设置取自父 web.config。

# classification - 用于商业用途的免费主题分类法（分类系统）

> ID：594708
> 
> 赞同：2
> 
> 时间：2009-02-27T13:23:40.550
> 
> 标签：classification, taxonomy

我正在寻找一个完全免费的免费分类法。在我的研究中，杜威有法律问题。除美国外，国会图书馆分类受版权保护。DMOZ 需要用户更新。如果我错了，请纠正我。

那么，有没有完全免费的商业用途分类法？

我正在寻找的是类似谷歌目录或雅虎目录的东西。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-27T13:53:43.270

也许有一个早期版本的 DDC 现在已经没有版权了，它是在 1800 年代后期开发的。

# testing - CIBC（银行）的测试实习需要什么？

> ID：594712
> 
> 赞同：-1
> 
> 时间：2009-02-27T13:25:17.677
> 
> 标签：testing

职位名称为“测试分析​​师-批量测试”。我知道我将进行黑盒和灰盒测试。我对灰盒测试有点不确定。此外，似乎会涉及繁重的脚本。我对软件测试行业的人的问题。作为 CIBC（银行）的实习生，我将测试什么样的软件？我会学到什么？它对我的职业发展有何帮助？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-27T13:47:28.433

从外观上看（没有提供描述的链接），您将进行测试，这可能很整洁。

如果您按照您的描述进行操作并检查/确保分析师运行的批量测试的质量，哇。您不仅会挑选经济和市场专家的大脑，还将帮助确保疯狂科学家场景的结果尽可能准确。如果我是正确的，你可以假设：

1.  你在那里的时候会受到很好的对待，也许是不可或缺的。
2.  即使您已经宣誓不再将投资和股票市场视为万恶之源，对市场巫术的了解从来都不是坏事。
3.  我不知道你获得了什么样的学位，但人工智能的一点背景永远不会伤害任何人。这是一个超越包含你的盒子的墙壁思考的好机会。

至于你的职业？我们上班有两个原因。一个是个人尊重，另一个是金钱补偿。我认为这个职位将大大提升#1 ..同时帮助提升#2。

但是，我想，这完全取决于你如何看待事物。早期不要那么挑剔是值得的。

# asp.net - 自动刷新 Web 用户控件

> ID：594713
> 
> 赞同：0
> 
> 时间：2009-02-27T13:25:19.500
> 
> 标签：asp.net, user-controls, .net-2.0

我们如何在 asp.net 2.0 中自动刷新 Web 用户控件而无需页面回发？我在控件头标签中尝试了元标签，但它也刷新了整个页面。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-27T13:31:20.923

您可以尝试在您的应用程序中实现一点 ASP.NET AJAX 框架并将该控件包装在 UpdatePanel 中。它适用于 .NET 2.0

编辑：这里是使用 ASP.NET AJAX UpdatePanel 教程的快速链接：http: [//ajax.net-tutorials.com/controls/updatepanel-control/](http://ajax.net-tutorials.com/controls/updatepanel-control/)

这里是来自 ASP.NET 网站的官方介绍页面：[http ://www.asp.net/Ajax/Documentation/Live/tutorials/IntroductionUpdatePanel.aspx](http://www.asp.net/Ajax/Documentation/Live/tutorials/IntroductionUpdatePanel.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-27T13:28:10.167

用户控件是基于服务器的控件。您唯一的选择可能是某种类型的 javascript，但取决于您尝试完成的任务，不太可能。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-27T16:13:20.610

有几种方法可以做到这一点，这取决于您的控件是由什么组成的。

最简单的方法之一是将控件包装在 UpdatePanel 中，然后使用 Timer 控件来更新该 UpdatePanel。但这在视图状态方面可能很昂贵。

另一种选择是使用 Jquery 之类的东西和 Javascript 计时器倒计时，然后使用静态页面方法刷新（[http://encosia.com](http://encosia.com/)有示例）。

# windows - Python - 查询网络接口设置

> ID：594714
> 
> 赞同：0
> 
> 时间：2009-02-27T13:25:20.733
> 
> 标签：windows, networking

我的梦想是使用python查询WIN上的网卡设置。我需要查询网卡是否设置为全双工以及是否设置为 1000Mb。名为 Win32_NetworkAdapterConfiguration 的 WMI 类不提供这些信息。或者，也可以使用 cmd 命令行解决方案（通过从 python 调用）。

谢谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-27T14:49:03.700

正如@ironfroggy 所说，这不是特定于 Python，而是一个一般的 Windows 问题。

当我们想以编程方式查找网卡上的速度和双工设置时，这是非常困难的。最后，我们求助于在注册表中徘徊，根据您的 NIC 供应商，注册表具有不同的结构。

它是这样的；对任何错误表示歉意：

1.  查找`HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Network`并查找具有“网络适配器”数据的 GUID。打电话给这个`<GUID1>`。
2.  键下方`<GUID1>`是每个 NIC 的另一个 GUID。呼叫其中之一`<GUID2>`。
3.  去`HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Class\<GUID1>`。
4.  遍历它的键（它们看起来像 0000、0001、0002 等），直到找到一个值`NetCfgInstanceId`等于`<GUID2>`.
5.  在此处下方，查找依赖于 NIC 供应商的子项。我们定义的一些是：
    *   Ndi\参数
    *   Ndi\savedParams
    *   BRCMndi\参数
6.  在那里，遍历这些键，直到找到一个名为`ParamDesc`其数据的值包含“速度”和“双工”字样的值。记住键名并调用它`<SpeedDuplexParamName>`。
7.  下面`<SpeedDuplexParamName>`有一个`enum`键，它将数字与“自动检测”和“100 Mb Full”等描述相匹配。
8.  回到你找到的几个级别`NetCfgInstanceId`。在附近，您可以将当前值视为枚举。例如，这里的值名称是`RequestedMediaType`，值是 6。
9.  查找枚举值以查找速度和双工设置。

我看到@DrFalk3n 已链接到可能会说相同的 Microsoft 文章，但我将把它留在这里以防万一。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-27T14:04:14.477

这真的不是一个python问题。你可以用 win32api 做的任何事情，你都可以通过 Python 来做，所以这里的问题只是关于 windows API，你碰巧从 Python 调用它们没有任何区别。实际上，不带 Python 标签的询问可能会得到更好的响应，因为人们会看谁知道如何用另一种语言来做，这将使用相同的 API。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-27T14:45:25.113

是的！这真的不是一个python问题。无论如何看看： [列出网络适配器配置属性](http://www.microsoft.com/technet/scriptcenter/scripts/python/default.mspx?mfr=true)

并浏览 python@microsoft 脚本[存储库](http://www.microsoft.com/technet/scriptcenter/scripts/python/default.mspx?mfr=true)可能对您的问题有帮助。

您还可以在 python 中找到有用的：

```
>>> import os
>>> f= os.popen('<type your dos command>')
>>> s = f.read()
>>> print s 
```

# c# - C# 二进制字面量

> ID：594720
> 
> 赞同：209
> 
> 时间：2009-02-27T13:26:47.627
> 
> 标签：c#, syntax, binary

有没有办法在 C# 中编写二进制文字，比如在十六进制前面加上 0x？0b 不起作用。

如果没有，有什么简单的方法可以做到这一点？某种字符串转换？

* * *

## 回答 #1

> 赞同：198
> 
> 时间：2011-08-16T21:48:17.303

### 更新

C# 7.0 现在有了二进制文字，这太棒了。

```
[Flags]
enum Days
{
    None = 0,
    Sunday    = 0b0000001,
    Monday    = 0b0000010,   // 2
    Tuesday   = 0b0000100,   // 4
    Wednesday = 0b0001000,   // 8
    Thursday  = 0b0010000,   // 16
    Friday    = 0b0100000,   // etc.
    Saturday  = 0b1000000,
    Weekend = Saturday | Sunday,
    Weekdays = Monday | Tuesday | Wednesday | Thursday | Friday
} 
```

### 原帖

由于该主题似乎已转向在枚举中声明基于位的标志值，因此我认为有必要为这类事情指出一个方便的技巧。左移运算符 ( `<<`) 将允许您将位推到特定的二进制位置。将其与根据同一类中的其他值声明枚举值的能力相结合，您就有了一个非常易于阅读的位标志枚举的声明性语法。

```
[Flags]
enum Days
{
    None        = 0,
    Sunday      = 1,
    Monday      = 1 << 1,   // 2
    Tuesday     = 1 << 2,   // 4
    Wednesday   = 1 << 3,   // 8
    Thursday    = 1 << 4,   // 16
    Friday      = 1 << 5,   // etc.
    Saturday    = 1 << 6,
    Weekend     = Saturday | Sunday,
    Weekdays    = Monday | Tuesday | Wednesday | Thursday | Friday
} 
```

* * *

## 回答 #2

> 赞同：172
> 
> 时间：2014-05-08T15:37:59.730

C# [7.0](https://github.com/dotnet/roslyn/issues/2136)支持[二进制文字](https://github.com/dotnet/roslyn/issues/215)（以及通过下划线字符的可选数字分隔符）。

一个例子：

```
int myValue = 0b0010_0110_0000_0011; 
```

您还可以在[Roslyn GitHub 页面](https://github.com/dotnet/roslyn)上找到更多信息。

* * *

## 回答 #3

> 赞同：117
> 
> 时间：2009-02-27T13:27:33.567

恐怕只有整数和十六进制（ECMA 334v4）：

> **9.4.4.2 整数文字**整数文字用于写入 int、uint、long 和 ulong 类型的值。整数文字有两种可能的形式：十进制和十六进制。

要解析，您可以使用：

```
int i = Convert.ToInt32("01101101", 2); 
```

* * *

## 回答 #4

> 赞同：26
> 
> 时间：2013-11-18T22:03:47.373

添加到@StriplingWarrior 关于枚举中位标志的答案中，您可以使用一个简单的约定以十六进制形式通过位移位向上计数。使用序列 1-2-4-8，向左移动一列，然后重复。

```
[Flags]
enum Scenery
{
  Trees   = 0x001, // 000000000001
  Grass   = 0x002, // 000000000010
  Flowers = 0x004, // 000000000100
  Cactus  = 0x008, // 000000001000
  Birds   = 0x010, // 000000010000
  Bushes  = 0x020, // 000000100000
  Shrubs  = 0x040, // 000001000000
  Trails  = 0x080, // 000010000000
  Ferns   = 0x100, // 000100000000
  Rocks   = 0x200, // 001000000000
  Animals = 0x400, // 010000000000
  Moss    = 0x800, // 100000000000
} 
```

从右列开始向下扫描，注意模式 1-2-4-8 (shift) 1-2-4-8 (shift) ...

* * *

为了回答最初的问题，我赞同@Sahuagin 使用十六进制文字的建议。如果您经常使用二进制数来解决这个问题，那么值得您花时间掌握十六进制的窍门。

如果您需要在源代码中查看二进制数字，我建议您使用上面的二进制文字添加注释。

* * *

## 回答 #5

> 赞同：24
> 
> 时间：2010-07-29T11:42:49.917

您始终可以创建包含您所追求的值的准字面量常量：

```
const int b001 = 1;
const int b010 = 2;
const int b011 = 3;
// etc ...
Debug.Assert((b001 | b010) == b011); 
```

如果您经常使用它们，那么您可以将它们包装在一个静态类中以供重复使用。

但是，稍微偏离主题，如果您有任何与位相关的语义（在编译时已知），我建议您使用 Enum 代替：

```
enum Flags
{ 
    First = 0,
    Second = 1,
    Third = 2,
    SecondAndThird = 3
}
// later ...
Debug.Assert((Flags.Second | Flags.Third) == Flags.SecondAndThird); 
```

* * *

## 回答 #6

> 赞同：18
> 
> 时间：2014-04-10T21:24:47.810

如果您查看 .NET 编译器平台（“Roslyn”）的[语言功能实现状态](https://roslyn.codeplex.com/wikipage?title=Language%20Feature%20Status)，您可以清楚地看到在 C# 6.0 中这是一个计划中的功能，因此在下一个版本中我们可以按照通常的方式进行。

![二进制文字状态](https://i.stack.imgur.com/73z8t.png)

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2011-11-10T20:19:10.780

```
string sTable="static class BinaryTable\r\n{";
string stemp = "";
for (int i = 0; i < 256; i++)
{
stemp = System.Convert.ToString(i, 2);
while(stemp.Length<8) stemp = "0" + stemp;
sTable += "\tconst char nb" + stemp + "=" + i.ToString() + ";\r\n";
}
sTable += "}";
Clipboard.Clear();
Clipboard.SetText ( sTable);
MessageBox.Show(sTable); 
```

使用它，对于 8 位二进制文​​件，我使用它来创建一个静态类并将其放入剪贴板。然后它被粘贴到项目中并添加到使用部分，因此任何带有 nb001010 的东西都从表中取出，在最少静态，但仍然...我使用 C# 进行大量 PIC 图形编码，并在 Hi-Tech C 中大量使用 0b101010

--来自代码输出的示例--

```
static class BinaryTable
{   const char nb00000000=0;
    const char nb00000001=1;
    const char nb00000010=2;
    const char nb00000011=3;
    const char nb00000100=4;
//etc, etc, etc, etc, etc, etc, etc, 
} 
```

:-) 尼尔

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2016-04-03T06:43:13.550

二进制文字功能未在 C# 6.0 和 Visual Studio 2015 中实现。但**在 2016 年 3 月 30 日，微软宣布了新版本的 Visual Studio '15' 预览版，我们可以使用二进制文字。**

我们可以使用一个或多个下划线（_）字符作为数字分隔符。所以代码片段看起来像：

```
int x           = 0b10___10_0__________________00; //binary value of 80
int SeventyFive = 0B100_________1011; //binary value of 75

WriteLine($" {x} \n {SeventyFive}"); 
```

**我们可以使用 0b 和 0B 中的任何一个，如上面的代码片段所示。**

如果您不想使用数字分隔符，则可以在没有数字分隔符的情况下使用它，如下面的代码片段

```
int x           = 0b1010000; //binary value of 80
int SeventyFive = 0B1001011; //binary value of 75

WriteLine($" {x} \n {SeventyFive}"); 
```

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-02-27T13:31:56.350

虽然不可能使用 Literal，但也许[BitConverter](http://msdn.microsoft.com/en-us/library/system.bitconverter.aspx)也可以是一个解决方案？

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2010-09-23T08:28:34.817

尽管字符串解析解决方案是最流行的，但我不喜欢它，因为在某些情况下解析字符串可能会对性能产生很大影响。

当需要一种位域或二进制掩码时，我宁愿这样写

> 长位掩码 = 1011001;

然后

> int bit5 = BitField.GetBit(bitMask, 5);

或者

> bool flag5 = BitField.GetFlag(bitMask, 5);`

BitField 类在哪里

```
public static class BitField
{
    public static int GetBit(int bitField, int index)
    {
        return (bitField / (int)Math.Pow(10, index)) % 10;
    }

    public static bool GetFlag(int bitField, int index)
    {
        return GetBit(bitField, index) == 1;
    }
} 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2017-08-02T06:22:05.057

您可以`0b000001`从 Visual Studio 2017 (C# 7.0) 开始使用

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2014-04-08T22:24:10.990

基本上，我认为答案是否定的，没有简单的方法。使用十进制或十六进制常量——它们简单明了。@RoyTinkers 的回答也很好 - 使用评论。

```
int someHexFlag = 0x010; // 000000010000
int someDecFlag = 8;     // 000000001000 
```

这里的其他答案提出了几个有用的工作——一轮，但我认为它们并不比简单的答案更好。C# 语言设计者可能认为不需要“0b”前缀。HEX 很容易转换为二进制，大多数程序员无论如何都必须知道 0-8 的 DEC 等价物。

此外，在调试器中检查值时，它们将显示为 HEX 或 DEC。

# java - 我可以对我的 Java 应用程序进行哪些标准优化重构？

> ID：594722
> 
> 赞同：4
> 
> 时间：2009-02-27T13:27:13.537
> 
> 标签：java, optimization, refactoring, findbugs

我有一个半大型 Java 应用程序。它写得很糟糕，我怀疑我可以做很多简单的事情来清理一些东西并提高性能。

例如我最近发现

```
String.matches(regex) 
```

函数在具有相同正则表达式的循环中使用了很多。所以我用[预编译的 Patterns](http://java.sun.com/j2se/1.4.2/docs/api/java/util/regex/Pattern.html#matches(java.lang.String,%20java.lang.CharSequence))替换了它。我使用 FindBugs（顺便说一句很棒），但没有发现这个问题，而且我在工作中可以使用的工具有限。

还有什么像这样简单的东西我应该看看吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-27T13:33:27.157

看看这些不同的工具：

*   [FindBugs](http://findbugs.sourceforge.net/)（你已经做到了）。
*   [格纹风格](http://checkstyle.sourceforge.net/)
*   [PMD](http://pmd.sourceforge.net/)
*   ...

我建议也看看[Sonar](http://sonar.codehaus.org/)，它是所有这些工具的一个很好的包装器。

所有这些工具都是免费的！

在全球范围内，它们不会帮助您提高性能，而是提高代码的质量。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-27T13:34:30.727

首先使它成为一个编写良好的应用程序。以我的经验，大多数性能优势不会来自做愚蠢的事情，而不是做聪明的优化。

当您有一个编写良好的应用程序时，就该运行分析器并仅优化重要的部分。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-27T13:34:42.257

性能有问题吗？如果是这样，我不会重做任何事情，直到我在各种条件下分析代码并且手头有一些硬数据告诉我时间花在了哪里。你可能正在改变一些根本没有好处的事情。

我会担心线程安全。对此给予了多少关注？

如果要重构，请先编写 JUnit 测试。它将帮助您熟悉代码并为您提供安全网。测试必须在更改前后通过。

最重要的是，不要仅仅因为你认为它一团糟而进行大的重构。在开始之前，您的团队和客户应该参与您正在做的事情。您是否将您的（公认的好）想法传达给他人？软件是一项团队运动；沟通是关键。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-27T13:38:10.767

重构以改进应用程序时要做的一件非常重要的事情是首先重构代码，以使源代码看起来至少不错。完成之后，永远不要猜测优化的地方，总是衡量瓶颈在哪里，并专注于解决这些问题。通常，程序员喜欢做一些事情，例如为循环交换递归方法，选择完全正确的排序算法等，这些事情通常几乎没有什么区别。因此，请确保关注正确的区域（使用过多的 CPU？内存？过多的线程？长线程锁？）

编辑：就像其他海报中写道的那样，当然要确保您团队中的其他人/您的老板认为这项工作也值得做，如果这对他们来说不是问题，他们可能会不在乎。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-27T15:53:04.670

如果您喜欢书籍，我强烈建议您阅读Josh Bloch 的《 [Effective Java](https://rads.stackoverflow.com/amzn/click/com/0321356683)》。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-27T15:20:50.817

通过分析器运行代码（检查速度和内存）。一旦你发现它慢的地方（通常不是你认为的地方），找出你可以做些什么来加速它。

另一个有用的东西（如果你有点勇敢的话）是使用 NetBeans 7.0 M2（不要太恐慌，它们的非发布版本通常非常稳定）有一个名为“Jackpot”的插件可以搜索你的代码以进行重构。其中一些与性能有关……但我认为它们中的任何一个都不会在速度方面做出根本性的改变。

一般来说，保持代码干净易读，它会很快。当它不快时，你会比如果它是一团糟更容易加速它。

有一次我在写一些我知道必须快速的东西（它是解析类文件的代码）时，我所做的就是在每次我进行更改时运行分析器。所以一步我想我会通过调用 String.,intern 来减少内存，以确保所有的字符串都汇集在一起​​。当我添加 intern() 调用时，内存确实下降了一点，但时间增加了很多（String.intern 不必要地慢，或者是几年前）。所以在那一点上，我知道我刚刚做的事情慢得令人无法接受，我取消了那个改变。

我不建议在一般开发中这样做，但是每天或每周通过分析器运行一次代码只是为了看看情况如何并不是生产力杀手。

# c++ - 子类化时覆盖静态变量

> ID：594730
> 
> 赞同：19
> 
> 时间：2009-02-27T13:28:32.067
> 
> 标签：c++, inheritance, static, overriding

我有一个类，我们称它为 A，在该类定义中我有以下内容：

```
static QPainterPath *path; 
```

也就是说，我声明了一个指向路径对象的静态（类范围）指针；此类的所有实例现在都将具有相同的共享数据成员。我希望能够以此类为基础，将其子类化为更专业的形式，分层行为，并且每个类都有自己独特的路径对象（但不必重复计算边界框或调用绘画例程等无聊的部分）。

如果我将它子类化以创建一个类 F（例如），我希望 F 使用从 A 继承的绘图例程，但要使用在 F 中声明的静态（类范围）路径对象。我尝试在上面的声明私有部分（并在派生类 F 中重复它），并尝试将它放在受保护部分中，所有这些都没有任何乐趣。

我可以看到为什么会这样：

```
void A::paint() {
    this->path... 
```

指的是 A::path 而不是 F::path，即使对象属于 F 类。

有没有一种优雅的方法来解决这个问题，并允许每个类维护一个静态路径对象，同时仍然使用基类中定义的绘图代码，并使所有类（可能除了基类）都是真实的和可实例化的？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-02-27T13:36:14.343

使用虚拟方法获取对静态变量的引用。

```
class Base {
private:
    static A *a;
public:
    A* GetA() {
        return a;
    }
};

class Derived: public Base {
private:
    static B *b;
public:
    A* GetA() {
        return b;
    }
}; 
```

请注意，此处 B 派生自 A。然后：

```
void Derived::paint() {
    this->GetA() ...
} 
```

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-02-27T13:55:39.770

您也许可以在混合或[奇怪重复的模板模式上做一个变体](http://en.wikipedia.org/wiki/Curiously_Recurring_Template_Pattern)

```
#include <stdio.h>

typedef const char QPainterPath;

class Base
{
public:
    virtual void paint() { printf( "test: %s\n", getPath() ); }
    virtual QPainterPath* getPath() = 0;
};

template <class TYPE>
class Holder : public Base
{
protected:
    static QPainterPath* path;
    virtual QPainterPath* getPath() { return path; }
};

class Data1 : public Holder<Data1>
{
};

class Data2 : public Holder<Data2>
{
};

template <> QPainterPath* Holder<Data1>::path = "Data1";
template <> QPainterPath* Holder<Data2>::path = "Data2";

int main( int argc, char* argv[] )
{
Base* data = new Data1;
data->paint();
delete data;

data = new Data2;
data->paint();
delete data;
} 
```

我刚刚在 CodeBlocks 中运行此代码并得到以下信息：

```
test: Data1
test: Data2

Process returned 0 (0x0)   execution time : 0.029 s
Press any key to continue. 
```

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-02-27T13:38:24.073

我没有测试过这个，但是引入了一个虚函数：

```
struct Base {

    void paint() {
         APath * p = getPath();
         // do something with p
    }

    virtual APath * getPath() {
         return myPath;
    }

    static APath * myPath;
};

struct Derived : public Base  {

    APath * getPath() {
         return myPath;
    }
    static APath * myPath;
}; 
```

可能是你想要的。请注意，您仍然必须在某处定义两个静态：

```
APath * Base::myPath = 0;
APath * Derived::myPath = 0; 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-27T13:36:58.710

您可以使用虚函数来实现您的结果。这可能是您最干净的解决方案。

```
class A
{
    protected:
        virtual QPainterPath *path() = 0;

    private:
        static QPainterPath *static_path;  /* Lazy initalization? */
};

QPainterPath *A::path()
{
    return A::static_path;
}

class F : public A
{
    protected:
        virtual QPainterPath *path() = 0;

    private:
        static QPainterPath *F_static_path;  /* Lazy initalization? */
};

QPainterPath *A::path()
{
    return F::F_static_path;
} 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2016-07-12T12:47:09.773

我知道这个问题已经得到解答，但是还有另一种方法可以通过帮助类和一些模板专业化为多个类设置类似静态变量的值。

它并没有完全回答这个问题，因为它与子类化没有任何联系，但我遇到了同样的问题，我找到了一个我想分享的不同解决方案。

例子 ：

```
template <typename T>
struct Helper {
  static QPainterPath* path;
  static void routine();
}

// Define default values
template <typename T> QPainterPath* Helper<T>::path = some_default_value;
template <typename T> void Helper<T>::routine { do_somehing(); }

class Derived {};

// Define specialized values for Derived
QPainterPath* Helper<Dervied>::path = some_other_value;
void Helper<Dervied>::routine { do_somehing_else(); }

int main(int argc, char** argv) {
  QPainterPath* path = Helper<Derived>::path;
  Helper<Derived>::routine();
  return 0;
} 
```

### 优点：

*   干净，编译时初始化
*   静态访问（无实例化）
*   你也可以声明专门的静态函数

### 缺点：

*   没有虚拟化，您需要确切的类型来检索信息

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-27T13:33:17.517

您不能“覆盖”静态函数，更不用说静态成员变量了。

你需要的可能是一个虚函数。这些只能是实例函数，因此如果没有类实例，它们将无法访问。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-27T13:35:16.217

您可能不希望覆盖静态变量。也许你可以在你的类中存储一个指针？

```
class A
{
    public:
        A() :
            path(static_path)
        {
        }

    protected:
        A(QPainterPath *path)
            : path(path)
        {
        }

    private:
        QPainterPath *path;

        static QPainterPath *static_path;  /* Lazy initalization? */
};

class F : public A
{
    public:
        F() :
            A(F_static_path)
        {
        }

    private:
        static QPainterPath *F_static_path;  /* Lazy initalization? */
}; 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-27T13:38:58.937

如果您不关心外观，只需在使用路径之前使用 A:: 或 F:: 来选择正确的路径，或者如果您不喜欢 :: 以不同的方式命名它们。

另一种选择是使用一个函数来整理它，例如 virtual QPainterPath* GetPath() { return A::path; } 在 A 和 QPainterPath* GetPath() { return F::path; } 在 F 中。

真的，虽然这个问题只是关于代码的外观而不是它的作用，而且由于它并没有真正改变可读性，我不会为此担心......

# html - 在这种情况下，checkbox value = '1' 不起作用是什么？

> ID：594731
> 
> 赞同：2
> 
> 时间：2009-02-27T13:29:41.970
> 
> 标签：html, data-binding, checkbox

我一直在阅读有关复选框的 stackoverflow 并将它们的值设置为 1 以使它们被选中，但在我的情况下它似乎不起作用。我有一个 databinder eval 表达式，当我的复选框应该被选中时计算为 1，并且我已经验证生成的页面至少有一个 value=1 的输入复选框未显示为选中状态。

我错过了什么？我尝试只设置选中的属性，但即使选中=''也算作选中，所以无论如何我都看不到使选中和未选中的复选框都可以工作。

这是似乎不起作用的html。

```
<input type='checkbox' class="datacell" id='603' 
style='text-align: center' value='1' /> 
```

这是我在中继器中为主要输入元素设置的数据绑定器

```
<input type='<%# Eval("InputType") %>' class="datacell" 
id='<%# Eval("CellID") %>' style='<%# Eval("InputAlign") %>' 
value='<%# Eval("TestResult") %>' /> 
```

其他评估只是确保正确的单元格是复选框，并且单元格的对齐方式以某种方式工作（复选框对齐中心，数字内容右对齐和其他内容左对齐。）

编辑：那么如何使用数据绑定表达式来做到这一点，这是我的困境。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-02-27T13:31:55.290

将复选框设置为选中的正确方法是：

```
<input type="checkbox" class="datacell" id="603"
style="text-align: center" checked="checked" /> 
```

并且呈现未选中复选框的正确方法是（请注意，缺少整个`checked`属性）：

```
<input type="checkbox" class="datacell" id="603"
style="text-align: center"/> 
```

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-02-27T13:38:28.270

根据[W3C 规范](http://www.w3.org/TR/html401/interact/forms.html)：

> 复选框（和单选按钮）是可以由用户切换的开/关开关。当设置了控制元素的选中属性时，开关处于“打开”状态。

因此，为复选框属性设置**任何**值都会选中复选框。

*   检查=“检查”
*   选中=“假”
*   选中=“真”
*   检查

都会将**复选框**标记为选中。您需要完全删除该属性才能清除该复选框。

因此，对您来说可能的解决方案是：

```
<input type='<%# Eval("InputType") %>' class="datacell" 
id='<%# Eval("CellID") %>' style='<%# Eval("InputAlign") %>' 
<%# isChecked((int)Eval("TestResult")) %> /> 
```

代码隐藏

```
protected string isChecked(int testResult) {
  if (testResult == 1) {
    return "checked='checked'";
  } else {
    return "";
  }
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-27T13:32:45.660

这很简单：

```
<input type="checkbox" value="whatever" checked> Create a checked box
<input type="checkbox" value="whatever"> Creates an unchecked box 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-27T13:33:49.700

您应该使用复选框的 checked="checked" 属性将其呈现为选中状态。value 属性是将提交给服务器的值，以防在提交表单时选中复选框。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-27T13:46:35.317

你还没有给复选框一个名称属性！

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-02-27T13:47:34.113

这是我所做的：

* * *

## 回答 #7

> 赞同：-2
> 
> 时间：2009-02-27T13:32:48.283

`checked="checked"`使用属性检查复选框

例子：

```
<p>Please select every sport that you play.</p>
Soccer: <input type="checkbox" checked="checked"
 name="sports" value="soccer" />
<br />
Football: <input type="checkbox" 
name="sports" value="football" />
<br />
Baseball: <input type="checkbox" 
name="sports" value="baseball" />
<br />
Basketball: <input type="checkbox" checked="checked" 
name="sports" value="basketball" />
</p> 
```

[http://www.tizag.com/htmlT/htmlcheckboxes.php](http://www.tizag.com/htmlT/htmlcheckboxes.php)

# git - 如何在不使用 .gitignore 的情况下执行“git status”以不显示未跟踪的文件？

> ID：594757
> 
> 赞同：345
> 
> 时间：2009-02-27T13:34:34.160
> 
> 标签：git, version-control

我该怎么做才能在`git status`不使用的情况下显示未跟踪的文件`.gitignore`？我只想获取有关跟踪文件的修改状态信息。

* * *

## 回答 #1

> 赞同：547
> 
> 时间：2009-02-27T13:40:22.210

用这个：

```
git status -uno 
```

这相当于：

```
git status --untracked-files=no 
```

它在手册中有点隐藏，但是状态的手册页说“支持与 git-commit 相同的选项”，所以这就是你必须看的地方。

* * *

## 回答 #2

> 赞同：137
> 
> 时间：2009-03-01T23:29:36.083

还：

```
git config status.showuntrackedfiles no 
```

* * *

## 回答 #3

> 赞同：18
> 
> 时间：2013-04-23T08:03:43.277

请注意，从[git 1.8.3 (April, 22d 2013) 开始](https://github.com/git/git/blob/master/Documentation/RelNotes/1.8.3.txt#L127-L128)`--untracked-files=no`，即使您一开始没有添加该选项，您也会知道！

> " `git status`" 建议用户`--untracked-files=no`在时间过长时考虑使用选项。

请参阅[提交 https://github.com/git/git/commit/5823eb2b28696bf0eb25f6ca35b303447869f85](https://github.com/git/git/commit/5823eb2b28696bf0eb25f6ca35b303447869f85)：

> 在某些存储库中，用户体验到“ `git status`”命令需要很长时间。
> 该命令会花费一些时间在文件系统中搜索未跟踪的文件。
> 
> `normal`在讨论配置变量之前，先解释默认选择 的权衡，以帮助用户更好地做出适当的选择。

该[`git status`文档](http://git-scm.com/docs/git-status)现在指出：

> 不使用`-u`选项时，将显示未跟踪的文件和目录（即与指定相同`normal`），以帮助您避免忘记添加新创建的文件。
> **因为在文件系统中查找未跟踪的文件需要额外的工作，所以这种模式在大型工作树中可能需要一些时间。
> 您可以使用`no`来`git status`更快地返回而不显示未跟踪的文件**。
> 
> 可以使用**`status.showUntrackedFiles`**文档中记录的配置变量更改默认值[`git config`](http://git-scm.com/docs/git-config)。

# asp.net - Visual Web Developer 中缺少 System.Web.Routing

> ID：594758
> 
> 赞同：3
> 
> 时间：2009-02-27T13:34:40.133
> 
> 标签：asp.net, routing, vwdexpress

我已经安装了 Visual Web Developer 2008，.net framework 3.5 但是当我尝试包含 System.Web.Routing intellisense 时找不到它，如果我手动输入它说它不存在.. 有什么建议吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-27T14:13:33.880

该`System.Web.Routing.dll`程序集是 .NET 3.5 Service Pack 1 的一部分，因此如果您还没有安装它，则必须安装它（如果您安装了 ASP.NET MVC 测试版，您也可能拥有它）。之后，您应该能够像添加任何其他 .NET 引用一样添加它。

它在“添加引用”对话框的“.NET”选项卡上的 System.Web.RegularExpressions 和 System.Web.Services 之间为我显示。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-27T13:39:53.023

您必须在项目中包含对 System.Web.Routing 程序集的引用。

# wpf - 有哪些好的 WPF Datagrid 使用示例？

> ID：594761
> 
> 赞同：5
> 
> 时间：2009-02-27T13:34:48.853
> 
> 标签：wpf, datagrid

我在哪里可以找到一些使用 LINQ 使用数据填充 WPF 数据网格的好示例？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-08-12T07:04:40.197

[杰米罗德里格斯](http://blogs.msdn.com/jaimer/archive/2008/08/13/dabbling-around-the-new-wpf-datagrid-part-1.aspx)

[文森特·西巴尔](http://blogs.msdn.com/vinsibal/archive/tags/DataGrid+Concepts/default.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-27T16:06:05.027

[CodeProject](http://www.codeproject.com/KB/WPF/WPFDataGrid.aspx)包括一篇关于该主题的文章。还有一个[示例应用程序](http://blogs.msdn.com/vinsibal/archive/2008/10/22/wpf-datagrid-and-the-wpftoolkit-have-released.aspx)可以为您提供一些线索。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-09-07T06:02:09.443

尝试遵循这个例子。

[http://www.codeproject.com/KB/WPF/WPFDataGridExamples.aspx](http://www.codeproject.com/KB/WPF/WPFDataGridExamples.aspx)

还有那些文章

[http://www.wpftutorial.net/DataGrid.html](http://www.wpftutorial.net/DataGrid.html)

[http://blogs.msdn.com/b/jaimer/archive/2009/01/20/styling-microsoft-s-wpf-datagrid.aspx](http://blogs.msdn.com/b/jaimer/archive/2009/01/20/styling-microsoft-s-wpf-datagrid.aspx)

添加尝试遵循此线程。

[WPF DataGrid 好教程？](https://stackoverflow.com/questions/5572921/wpf-datagrid-good-tutorials)

问候。

# ruby - 为什么单击本机控件后不调用按键？

> ID：594767
> 
> 赞同：1
> 
> 时间：2009-02-27T13:35:44.733
> 
> 标签：ruby, shoes

```
Shoes.app do
 keypress do |k|
    if k==:f1
      alert("Foo bar")
    end
  end
  button "foo"
end 
```

按 F1 会弹出警告框，但是。一旦我单击按钮“foo”，即如果焦点更改为应用程序中的本机控件。不再捕获按键事件。有什么办法绕过它？

我用的是windows xp。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2010-01-18T11:35:21.383

在撰写本文时，这仍然是 Windows 上的 Shoes 中的一个错误。如果您可以摆脱对所有内容的清晰和重绘，您可以再次获取按键事件，例如：

```
Shoes.app do
    def drawbutton
        @holder.clear do
            button "foo" do
                drawbutton
            end
        end
    end

    @holder = stack 

    drawbutton

    keypress do |k|
        if k==:f1
            alert("Foo bar")
        end
    end
end 
```

尽管此技巧适用于您问题中的示例，但我不确定它能否很好地转化为真正的应用程序。

# c# - LINQ to SQL：存储过程结果

> ID：594775
> 
> 赞同：6
> 
> 时间：2009-02-27T13:37:39.800
> 
> 标签：c#, sql, linq, linq-to-sql, tsql

如何更改 LINQ to SQL 设计器生成的存储过程结果的类名（除了弄乱designer.cs）？

另外，如何对存储过程的结果集执行 linq 查询？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-27T13:48:17.230

你可以在 dbml 中编辑它吗？就个人而言，我倾向于将自动生成的类型（来自函数和存储过程）视为 DAL 本地的 DTO，因此我立即将它们重新映射到我自己的 POCO 表示 - 即

```
var qry = from row in ctx.SomeProc(12345)
          select new Foo {ID = row.ID, Name = row.Name }; 
```

等关于第二个问题“另外，如何对存储过程的结果集执行 linq 查询？” - 如果你想组合它，我建议使用 UDF 而不是存储过程：这允许你在数据库中进行组合，例如分页和过滤：

```
var qry = (from row in ctx.SomeFunction(12345)
          where row.IsActive
          select row).Skip(10).Take(10); 
```

它应该（至少在 LINQ-to-SQL 中）在服务器上的 TSQL 中执行所有操作。否则，您可以`AsEnumerable()`在调用 .NET 层调用和使用 LINQ-to-Objects：

```
var qry = (from row in ctx.SomeProc(12345).AsEnumerable()
          where row.IsActive
          select row).Skip(10).Take(10); 
```

* * *

要编辑 dbml（只是 xml），请在`ElementType/@Name`此处更改：

```
<Function Name="dbo.CustOrderHist" Method="CustOrderHist">
  <Parameter Name="CustomerID" Parameter="customerID" Type="System.String" DbType="NChar(5)" />
  <ElementType Name="FooBar"> <!-- ********** HERE ************ -->
      <Column Name="ProductName" Type="System.String" DbType="NVarChar(40) NOT NULL" CanBeNull="false" />
      <Column Name="Total" Type="System.Int32" DbType="Int" CanBeNull="true" />
  </ElementType>
</Function> 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-27T13:46:39.980

> 另外，如何对存储过程的结果集执行 linq 查询？

```
var query = from results in datacontext.storedprocedurename()
            where results.whatever == 1
            select results; 
```

# c++ - GCC 调试器堆栈跟踪显示错误的文件名和行号

> ID：594782
> 
> 赞同：3
> 
> 时间：2009-02-27T13:38:44.260
> 
> 标签：c++, gcc, gdb

我正在尝试将一个相当大的 C++ 项目移植到在 Mac OS X 上使用 g++ 4.0。我的项目编译没有错误，但我无法让 GDB 正常工作。当我通过在 GDB 命令行上键入“bt”查看堆栈时，显示的所有文件名和行号都是错误的。

例如，根据 GDB 堆栈跟踪，我的`main()`函数应该在 Mac OS X SDK 的 stdexcept 中，这没有任何意义。

是什么导致 GDB 出现如此严重的故障？我已经检查了代码中的 #line 和 #file 语句，并确保代码只有 unix 行结尾。我还清理并重建了该项目。我也尝试过调试一个 Hello World 项目，但没有遇到同样的问题。

问题是否与我正在链接的第三方库之一以及它们的编译方式有关？还是完全不同的东西？

[以下是对Xcode](http://en.wikipedia.org/wiki/Xcode)执行的两个示例`gcc`性调用。AFAIK 我项目中的所有 cpp 文件都使用相同的参数进行编译和链接。`ld`

> /Developer/usr/bin/gcc-4.0 -x c++ -arch i386 -fmessage-length=0 -pipe -Wno-trigraphs -fpascal-strings -fasm-blocks -O0 -fpermissive -Wreturn-type -Wunused-variable -DNO_BASS_SOUND -D_DEBUG -DXCODE -D__WXMAC__ -isysroot /Developer/SDKs/MacOSX10.5.sdk -mfix-and-continue -fvisibility-inlines-hidden -mmacosx-version-min=10.4 -gdwarf-2 -D_FILE_OFFSET_BITS=64 -D_LARGE_FILES -D__WXDEBUG__ -D__WXMAC__ -c "/Users/adriangrigore/Documents/Gemsweeper Mac/TSDLGameBase.cpp" -o "/Users/adriangrigore/Documents/Gemsweeper Mac/build/Gemsweeper Mac.build/Debug/Gemsweeper Mac.build/Objects-normal/ i386/TSDLGameBase.o"
> 
> /Developer/usr/bin/g++-4.0 -arch i386 -isysroot /Developer/SDKs/MacOSX10.5.sdk "-L/Users/adrianrigore/Documents/Gemsweeper Mac/build/Debug" -L/Developer/SDKs/MacOSX10 .5.sdk/usr/local/lib -L/opt/local/lib "-F/Users/adrianrigigore/Documents/Gemsweeper Mac/build/Debug" -F/Users/adrianrigore/Library/Frameworks -F/Developer/ SDKs/MacOSX10.5.sdk/Library/Frameworks -filelist "/Users/adrianrigore/Documents/Gemsweeper Mac/build/Gemsweeper Mac.build/Debug/Gemsweeper Mac.build/Objects-normal/i386/Gemsweeper Mac.LinkFileList" - mmacosx-version-min=10.4 /opt/local/lib/libboost_program_options-mt.a /opt/local/lib/libboost_filesystem-mt.a /opt/local/lib/libboost_serialization-mt.a /opt/local/lib/ libboost_system-mt.a /opt/local/lib/libboost_thread-mt.a "/Users/adriangrigore/Documents/Gemsweeper Mac/3rd party/FreeImage/Dist/libfreeimage.a" "/Users/adriangrigore/Documents/Gemsweeper Mac/3rd party/cpuinfo-1.0/libcpuinfo.a" -L/usr/local/ lib -framework IOKit -framework Carbon -framework Cocoa -framework System -framework QuickTime -framework OpenGL -framework AGL -lwx_macd_richtext-2.8 -lwx_macd_aui-2.8 -lwx_macd_xrc-2.8 -lwx_macd_qa-2.8 -lwx_macd_html-2.8 -lwx_macd_adv-2.8 -lwx_macd -lwx_base_carbond_xml-2.8 -lwx_base_carbond_net-2.8 -lwx_base_carbond-2.8 -framework SDL -framework Cocoa -o "/Users/adriangrigore/Documents/Gemsweeper Mac/build/Debug/Gemsweeper Mac.app/Contents/MacOS/Gemsweeper Mac"-L/usr/local/lib -framework IOKit -framework Carbon -framework Cocoa -framework System -framework QuickTime -framework OpenGL -framework AGL -lwx_macd_richtext-2.8 -lwx_macd_aui-2.8 -lwx_macd_xrc-2.8 -lwx_macd_qa-2.8 -lwx_macd_html-2.8 - lwx_macd_adv-2.8 -lwx_macd_core-2.8 -lwx_base_carbond_xml-2.8 -lwx_base_carbond_net-2.8 -lwx_base_carbond-2.8 -framework SDL -framework Cocoa -o "/Users/adriangrigore/Documents/Gemsweeper Mac/build/Debug/Gemsweeper Mac.app/Contents/MacOS /Gemsweeper Mac"-L/usr/local/lib -framework IOKit -framework Carbon -framework Cocoa -framework System -framework QuickTime -framework OpenGL -framework AGL -lwx_macd_richtext-2.8 -lwx_macd_aui-2.8 -lwx_macd_xrc-2.8 -lwx_macd_qa-2.8 -lwx_macd_html-2.8 - lwx_macd_adv-2.8 -lwx_macd_core-2.8 -lwx_base_carbond_xml-2.8 -lwx_base_carbond_net-2.8 -lwx_base_carbond-2.8 -framework SDL -framework Cocoa -o "/Users/adriangrigore/Documents/Gemsweeper Mac/build/Debug/Gemsweeper Mac.app/Contents/MacOS /Gemsweeper Mac"8 -framework SDL -framework Cocoa -o "/Users/adriangrigore/Documents/Gemsweeper Mac/build/Debug/Gemsweeper Mac.app/Contents/MacOS/Gemsweeper Mac"8 -framework SDL -framework Cocoa -o "/Users/adriangrigore/Documents/Gemsweeper Mac/build/Debug/Gemsweeper Mac.app/Contents/MacOS/Gemsweeper Mac"

请注意，我已经在[这里](https://stackoverflow.com/questions/582412/xcode-debugger-code-window-does-not-match-stack-window)问过关于 Xcode 调试器的类似问题，但我正在重新发布，因为我刚刚了解到这实际上不是 Xcode 的错，而是 GCC / ld / GDB 的问题。

**编辑：**我的项目使用以下第三方库：[SDL](http://en.wikipedia.org/wiki/Simple_DirectMedia_Layer)、[Boost](http://en.wikipedia.org/wiki/Boost_C%2B%2B_Libraries)、[wxWidgets](http://en.wikipedia.org/wiki/WxWidgets)。我不确定这对这个问题是否重要，但我只是想提一下以防万一。

我已经尝试编译一个 Xcode SDL 项目模板并且没有遇到同样的问题，所以这一定是由于我的项目中有一些特殊的东西。

**第二次编辑**：正如我刚刚发现的那样，我在使用字符串“这是自动生成的”搜索文件时犯了一个错误。我刚刚发现了几十个具有相同字符串的文件，它们都属于我正在使用的第三方库之一[FreeImage 。](http://freeimage.sourceforge.net/)所以，这个问题似乎与 FreeImage 有关，但我仍然不确定如何继续。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-12-10T09:56:34.167

当我的 gdb 版本与我的 g++ 版本不匹配时，我得到了这些症状。

尝试获取最新的 gdb。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-03T09:34:52.627

对于测试，您可以检查 addr2line 是否为您提供预期值。如果是这样，这将表明您的编译/链接参数生成的[ELF](http://en.wikipedia.org/wiki/Executable_and_Linkable_Format)没有任何问题，并将所有怀疑都放在 GDB 上。如果不是，那么仍然怀疑工具和 ELF 文件。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-03T09:36:47.643

可能是您正在使用 SDL 吗？SDL 重新定义`main`，因此您的 main 将被命名`SDL_main`，并且 SDL 部分可能会进行大量优化，因此您将无法获得良好的 gdb 输出。

...只是一个想法

[读这个](http://www.libsdl.org/faq.php?action=listentries&category=7#55)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-27T16:24:18.917

您的 cpp 文件中肯定有调试符号（`-gdwarf-2`选项）。

您是否对调试符号使用单独的 dSYM 文件？或者它们在目标文件中。我会首先尝试在 dSYM 文件中使用 DWARF，看看是否有帮助（反之亦然）

第三方库似乎是发布版本（当然，除非您自己重命名它们）例如，我确信 boost 使用`-d`库名称中的名字来表示调试库（例如`libboost_filesystem-mt-d.a`）。

现在，这不应该真的构成问题，它应该只是意味着你不能介入对第三方库的调用。（至少当你这样做时没有任何意义;）但是由于你有问题，可能值得尝试链接这些库的调试版本......

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-27T16:33:46.320

你在编译优化吗？我发现 O2 或更高级别的符号与符号混淆很多，使 gdb 和核心文件几乎毫无用处。

此外，请确保您使用 -g 选项进行编译。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-04T05:10:38.103

> 我试过编译一个 XCode SDL 项目模板并没有遇到同样的问题，所以它一定是由于我的项目中有一些特殊的东西。

正确的。您的项目设置有所不同。

您需要在调试构建的 Xcode 项目设置中禁用调试优化。不幸的是，当您希望 GDB 按顺序移动时，Xcode 会使 GDB 跳转到奇怪的行（乱序）。

转到您的项目设置。设置以下

```
1) Instruction Scheduling   = None
2) Optimization Level       = None [-O0]
3) ZERO_LINK                = None 
```

你的问题应该在这样做之后解决。这是您需要更改设置的项目设置屏幕：

[![替代文字](https://i.stack.imgur.com/ATS54.png)](https://i.stack.imgur.com/ATS54.png)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-05T16:10:15.843

I encountered this several years ago when transitioning from the Codewarrior compilers to Xcode. I believe the way to get around this is to put the flag "`-fno-inline-functions`" in Other C Flags (for Dev only).

This problem was more pronounced on the PowerPC architecture for us.

**What about if you remove the "-fvisibility-inlines-hidden" and "-mfix-and-continue" flags?**

I've never had the "fix and continue" feature work properly for me.

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-05T22:13:25.563

`main`如果你使用它们的`IMPLEMENT_APP()`宏， WxWidgets 也会定义它们自己的

从[这里](http://www.wxwidgets.org/docs/tutorials/hello.htm)

> 与所有程序一样，必须有一个“主要”功能。在 wxWidgets 下 main 是使用这个宏实现的，它创建一个应用程序实例并启动程序。
> 
> `IMPLEMENT_APP(MyApp)`

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-03-08T10:16:29.037

我有一个新东西你可以试试。

就在你自己之前，`main`你可以写

```
#ifdef main
#  error main is defined
#endif

int main(int argc, char *argv[]) { 
```

如果您有一些重新定义`main`.

如果您定义了自己的，您可能会在先前定义的地方收到警告

```
#define main foo

int main(int argc, char *argv[]) { 
```

您也可以尝试`undef`在您之前`main`

```
#undef main

int main(int argc, char *argv[]) { 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-03-04T20:21:03.267

根据您的标志，调试信息应该在目标文件中。

您的项目设置是否在一个位置构建可执行文件，然后在完成后将最终的可执行文件移动到另一个位置？如果是这种情况，则 gdb 可能找不到 objectects 文件，因此无法从 object 文件中正确检索调试信息。

只是一个猜测。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-03-06T11:15:51.157

[在这里](https://stackoverflow.com/questions/614492/how-do-i-find-my-programs-main-function/618455#618455)查看我的答案

我现在已经下载并编译了 FreeImage 源代码，是的，文件`b44ExpLogTable.cpp`被编译成`libfreeimage.a`. 问题看起来像脚本`gensrclist.sh`只是收集所有`.cpp`文件而没有跳过带有 main in 的文件。该脚本生成一个名为`Makefile.srcs`但已经提供了一个文件。（在我的 Leopard 上运行它失败了，有些问题`sh`- 如果我改成它就`sh`可以了`bash`）

在您更改任何内容之前，这会给出一个`a.out`

```
c++ libfreeimage.a 
```

该文件`Makefile.srcs`已创建，因此您应该能够从中删除该文件`b44ExpLogTable.cpp`。然后做

```
make -f Makefile.osx clean
make -f Makefile.osx 
```

完成后，上面`c++ libfreeimage.a`应该给出以下错误

```
Undefined symbols:
  "_main", referenced from:
      start in crt1.10.5.o
ld: symbol(s) not found
collect2: ld returned 1 exit status 
```

# php - 如何将所有重写 x.php 转换为特定目录中的 x.css？

> ID：594786
> 
> 赞同：2
> 
> 时间：2009-02-27T13:39:32.960
> 
> 标签：php, .htaccess, mod-rewrite

我需要重写一个目录中的所有文件，并且基本上使它们的扩展是 css 而不是 php。我想处理该特定目录中的 .htaccess 文件。

这样做的正确方法是什么，是否有任何特殊的 PHP 头文件我需要设置以确保文件被正确读取为 .css 文件？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-27T13:41:34.720

我认为您宁愿希望将请求`*.css`内部重写为`*.php`. 所以试试这个：

```
RewriteEngine on
RewriteRule ^(foo/.*)\.css$ $1.php [L] 
```

虽然`foo`这里是特定目录。

您现在应该`text/css`在 PHP 脚本的开头使用以下内容显式声明输出：

```
<?php
header('Content-Type: text/css;charset=<your charset>'); 
```

替换`<your charset>`为您正在使用的任何字符集/编码（可能是`ISO-8859-1`或`UTF-8`）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-27T13:46:12.523

好吧，如果您只是在您的站点中使用它们，它们就不需要 css 扩展。他们只需要在渲染（我假设）生成的 css 之前输出标题 Content-Type: text/css 。类似的事情适用于其他文件类型，如果你有一个生成图像的 php 脚本，你会这样做，除了你将内容类型更改为 image/png 或 jpeg 或其他。

但是，如果您希望外部将这些生成的 css 文件视为具有 css 扩展名的文件，那么将我所说的与 Gumbo 所说的混合起来。

# c++ - 如何创建派生自抽象 C++ 类的类的 python 对象实例？

> ID：594787
> 
> 赞同：2
> 
> 时间：2009-02-27T13:39:40.683
> 
> 标签：c++, extract, boost-python

这是我的代码：

```
// c++ (main.cpp)
#include <vector>
#include <iostream>
#include <boost/python.hpp>
#include <boost/python/enum.hpp>
#include <boost/python/def.hpp>
#include <boost/python/module.hpp>

using namespace std;
using namespace boost;
using namespace boost::python;

class Base
{
public:
    Base(void) {}
virtual void f1(void) = 0;
virtual void f2(void) = 0;
};

class Stack
{
public:
Stack(void) {}
void push(Base *e)
{
    stack.push_back(e);
}
void pushPython(boost::python::object &o)
{
    Base &e = extract<Base &>(o) BOOST_EXTRACT_WORKAROUND;
    push(&e);
}
void test(void)
{
    for(std::vector<Base *>::iterator i = stack.begin(); i != stack.end(); i++)
    {
        (*i)->f1();
        (*i)->f2();
    }
}
private:
std::vector<Base *> stack;
};

class DerivedCPP : public Base
{
public:
DerivedCPP(void) {}
virtual void f1(void)
{
    std::cout << "DerivedCPP f1()" << std::endl;
}
virtual void f2(void)
{
    std::cout << "DerivedCPP f2()" << std::endl;
}
};

BOOST_PYTHON_MODULE(mytest)
{
boost::python::class_<Base,boost::noncopyable>("Base",boost::python::no_init)
    .def( "f1", &Base::f1)
    .def( "f2", &Base::f2)
    ;

boost::python::class_<DerivedCPP,bases<Base>>("DerivedCPP")
    .def( "f1", &DerivedCPP::f1)
    .def( "f2", &DerivedCPP::f2)
    ;

boost::python::class_<Stack>("Stack", boost::python::no_init)
    .def( "push", &Stack::pushPython)
    .def( "test", &Stack::test)
    ;
}

int main(int argc, char** argv)
{
PyImport_AppendInittab("mytest", &initmytest);
Py_Initialize();
boost::python::object main_module(( handle<>( borrowed( PyImport_AddModule( "__main__" )))));
boost::python::object main_namespace = main_module.attr("__dict__");
boost::python::object mytest( (handle<>(PyImport_ImportModule("mytest"))) );
main_namespace["mytest"] = mytest;
Stack *STACK = new Stack();
main_namespace["Stack"] = ptr(STACK);
Base *e = new DerivedCPP();
STACK->push(e);
STACK->test();
boost::python::object main = import("__main__");
boost::python::object global(main.attr("__dict__"));
boost::python::object result = exec_file("test.py", global, global);
Py_Finalize();
return 0;
}

# python (test.py)
print 'test.py'
print

class DerivedPython(mytest.Base):
def __init__(self):
    print "DerivedPython __init__()"
def f1(self):
    print "DerivedPython f1()"
def f2(self):
    print "DerivedPython f2()"

print 'DerivedPython()'
p = DerivedPython()
p.f1()
p.f2()

print 'mytest.DerivedCPP()'
c = mytest.DerivedCPP()
c.f1()
c.f2()

print 'Stack.push(c)'
Stack.push(c)
print 'OK'

print "Stack.test()"
Stack.test()

print 'Stack.push(p)'
Stack.push(p) # crash!
print 'OK'

print "Stack.test()"
Stack.test() 
```

我想从 c++ 抽象类派生 python 类，然后将此对象传递回 c++。我应该如何做到这一点而不会崩溃？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-27T15:53:23.967

这有点复杂，但并不难。阅读[此页面](http://www.boost.org/doc/libs/1_38_0/libs/python/doc/tutorial/doc/html/python/exposing.html)，它应该为您提供所需的一切。

您需要像这样包装抽象类：

```
struct BaseWrap : Base, wrapper<Base>
{
    void f1()
    {
        this->get_override("f1")();
    }

    void f2()
    {
        this->get_override("f2")();
    }

}; 
```

然后你必须公开 Base 如下：

```
class_<BaseWrap, boost::noncopyable>("Base")
    .def("f1", pure_virtual(&Base::f1))
    .def("f2", pure_virtual(&Base::f2))
    ; 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-07-18T18:38:36.067

您可能还想查看[Py++](http://www.language-binding.net/pyplusplus/pyplusplus.html)包。它是一个用于解析 C++ 代码并为该代码生成 boost::python 包装器的实用程序。我只尝试了一点，但它似乎可以自动创建基类包装器和类似的东西（根据文档，作者能够导出几个 boost 库并通过生成绑定在 Python 中运行他们的测试套件通过派++）。

# java - 在 Java 的接口中定义类的能力的实际方面？

> ID：594789
> 
> 赞同：12
> 
> 时间：2009-02-27T13:39:58.937
> 
> 标签：java, interface, inner-classes

在 Java 的接口中定义类的实际方面是什么：

```
interface IFoo
{
    class Bar
    {
        void foobar ()
        {
            System.out.println("foobaring...");
        }
    }
} 
```

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-02-27T13:53:03.867

除了 Eric P 链接的那些用法之外，我还可以想到另一种用法：定义接口的默认/无操作实现。

./亚历克斯

```
interface IEmployee
{

    void workHard ();  
    void procrastinate ();

    class DefaultEmployee implements IEmployee 
    {
        void workHard () { procrastinate(); };
        void procrastinate () {};
    }

} 
```

另一个示例——[空对象模式](http://en.wikipedia.org/wiki/Null_Object_pattern)的实现：

```
interface IFoo
{
    void doFoo();
    IFoo NULL_FOO = new NullFoo();

    final class NullFoo implements IFoo
    {
        public void doFoo () {};
        private NullFoo ()  {};
    }
}

...
IFoo foo = IFoo.NULL_FOO;
...
bar.addFooListener (foo);
... 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-02-27T13:45:30.793

我认为[这一页](http://www.sap-img.com/java/why-we-define-a-class-inside-an-interface.htm)很好地解释了一个例子。您将使用它将某种类型紧密绑定到接口。

无耻地从上面的链接中扯掉：

```
interface employee{
    class Role{
          public String rolename;
          public int roleId;
     }
    Role getRole();
    // other methods
} 
```

在上面的接口中，您将角色类型强绑定到员工接口（employee.Role）。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-02-27T18:24:03.357

一种用途（无论好坏）是作为 Java 不支持接口中的静态方法这一事实的一种解决方法。

```
interface Foo {
    int[] getData();

    class _ {
        static int sum(Foo foo) {
            int sum = 0;
            for(int i: foo.getData()) {
                sum += i;
            }
            return sum;
        }
    }
} 
```

然后你会调用它：

```
int sum = Foo._.sum(myFoo); 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-02-27T13:43:50.953

我可以毫不犹豫地说，我从来没有这样做过。我想不出你为什么会这样做的理由。类嵌套在类中？当然，有很多理由这样做。在这些情况下，我倾向于将那些内部类视为实现细节。显然，接口没有实现细节。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-03-01T08:02:53.660

这个习惯用法被大量使用的地方之一是在[XMLBeans](http://xmlbeans.apache.org/)中。该项目的目的是采用 XML 模式并生成一组 Java 类，您可以双向使用这些类来处理与该模式相对应的 XML 文档。因此，它允许您将 XML 解析为 xml bean 或创建 xml bean 并输出到 xml。

通常，大多数 xml 模式类型都映射到 Java 接口。该接口内部有一个工厂，用于在默认实现中生成该接口的实例：

```
public interface Foo extends XmlObject {
  public boolean getBar();
  public boolean isSetBar();
  public void setBar(boolean bar);

  public static final SchemaType type = ...

  public static final class Factory {
    public static Foo newInstance() {
      return (Foo)XmlBeans.getContextTypeLoader().newInstance(Foo.type, null);
    }

    // other factory and parsing methods
  }
} 
```

当我第一次遇到这种情况时，将所有这些实现 gunk 绑定到接口定义中似乎是错误的。然而，我实际上越来越喜欢它，因为它让一切都根据接口定义，但有一个统一的方式来获取接口的实例（而不是有另一个外部工厂/构建器类）。

我将它用于有意义的类（尤其是那些我对接口/实现有很大控制权的类），并发现它相当干净。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-02-27T13:46:14.990

我想您可以定义一个类，用作接口内方法的返回类型或参数类型。似乎不是特别有用。您不妨单独定义该类。唯一可能的优点是它在某种意义上将类声明为“属于”接口。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-02-27T14:20:04.220

Google Web Toolkit 使用这些类将“普通”接口绑定到异步调用接口：

```
public interface LoginService extends RemoteService {

    /**
     * Utility/Convenience class.
     * Use LoginService.App.getInstance() to access static instance of LoginServiceAsync
     */
    class App {

        public static synchronized LoginServiceAsync getInstance() {
            ...
        }
    }
} 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-03-01T23:14:33.123

使用接口内的静态类，您可以缩短通用编程片段：检查对象是否是接口的实例，如果是则调用该接口的方法。看这个例子：

```
public interface Printable {
    void print();

    public static class Caller {
        public static void print(Object mightBePrintable) {
            if (mightBePrintable instanceof Printable) {
                ((Printable) mightBePrintable).print();
            }
        }
    }
} 
```

现在而不是这样做：

```
void genericPrintMethod(Object obj) {
    if (obj instanceof Printable) {
        ((Printable) obj).print();
    }
} 
```

你可以写：

```
void genericPrintMethod(Object obj) {
   Printable.Caller.print(obj);
} 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-02-27T13:48:28.947

这样做似乎到处都写着“糟糕的设计决策”。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-02-27T14:16:23.387

每当创建非私有嵌套类似乎是个好主意时，我都会敦促谨慎。几乎可以肯定，您最好直接参加外部课程。但是如果你要创建一个公共的嵌套类，把它放在一个接口中似乎并不比放在一个类中更奇怪。外部类的抽象性不一定与嵌套类的抽象性相关。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-03-01T08:29:25.560

这种方法可用于在同一个文件中定义许多类。在过去，我有许多简单的接口实现，这对我来说效果很好。但是，如果我要再次这样做，我会使用一个实现接口的枚举，这将是一个更优雅的解决方案。

# objective-c - 如何使用 NSScanner？

> ID：594797
> 
> 赞同：18
> 
> 时间：2009-02-27T13:42:04.720
> 
> 标签：objective-c, string, cocoa, parsing, nsscanner

我刚刚阅读了Apple[文档](http://developer.apple.com/documentation/Cocoa/Conceptual/Strings/introStrings.html#//apple_ref/doc/uid/10000035)。`NSScanner`我正在尝试获取此字符串的整数：

```
@"user logged (3 attempts)" 
```

我找不到任何示例，如何在括号内扫描。有任何想法吗？

这是代码：

```
NSString *logString = @"user logged (3 attempts)";
NSScanner *aScanner = [NSScanner scannerWithString:logString];

[aScanner scanInteger:anInteger];

NSLog(@"Attempts: %i", anInteger); 
```

* * *

## 回答 #1

> 赞同：52
> 
> 时间：2009-08-20T08:24:33.737

Ziltoid 的解决方案有效，但它的代码比您需要的多。

对于给定的情况，我不会打扰实例化 NSScanner。NSCharacterSet 和 NSString 为您提供所需的一切：

```
 NSString *logString = @"user logged (3 attempts)";
    NSString *digits = [logString stringByTrimmingCharactersInSet:
         [[NSCharacterSet decimalDigitCharacterSet] invertedSet]];
    NSLog(@"Attempts: %i", [digits intValue]); 
```

或在斯威夫特：

```
 let logString = "user logged (3 attempts)"
    let nonDigits = NSCharacterSet.decimalDigitCharacterSet().invertedSet
    let digits : NSString = logString.stringByTrimmingCharactersInSet(nonDigits)
    NSLog("Attempts: %i", digits.intValue) 
```

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2009-02-27T14:00:46.577

`这是我从字符串中获取某些值的方法

首先我定义了这个方法

```
- (NSString *)getDataBetweenFromString:(NSString *)data leftString:(NSString *)leftData rightString:(NSString *)rightData leftOffset:(NSInteger)leftPos; 
{         
    NSInteger left, right;         
    NSString *foundData;
    NSScanner *scanner=[NSScanner scannerWithString:data];                  
    [scanner scanUpToString:leftData intoString: nil];         
    left = [scanner scanLocation];         
    [scanner setScanLocation:left + leftPos];         
    [scanner scanUpToString:rightData intoString: nil];         
    right = [scanner scanLocation] + 1;         
    left += leftPos;         
    foundData = [data substringWithRange: NSMakeRange(left, (right - left) - 1)];         return foundData; 
} 
```

然后调用它。

```
foundData = [self getDataBetweenFromString:data leftString:@"user logged (" rightString:@"attempts)" leftOffset:13]; 
```

leftOffset 是左字符串的字符数

可能是一种更简单的清洁方式，但这是我的解决方案。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2011-12-03T14:09:07.867

这是一个使用 NSScanner 的简单解决方案（是的，@NSResponder 有一个非常简洁的解决方案！）：

```
NSString *logString = @"user logged (3 attempts)";
NSString *numberString;
NSScanner *scanner = [NSScanner scannerWithString:logString];
[scanner scanUpToCharactersFromSet:[NSCharacterSet decimalDigitCharacterSet] intoString:nil];
[scanner scanCharactersFromSet:[NSCharacterSet decimalDigitCharacterSet] intoString:&numberString];
NSLog(@"Attempts: %i", [numberString intValue]); 
```

NSLog 输出：

```
Attempts: 3 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-08-13T17:07:27.330

`NSScanner`是线性扫描仪。你必须扫描你不想得到的东西才能找到你想要的东西。

您可以`[aScanner scanUpToCharactersInSet:[NSCharacterSet decimalDigitCharacterSet] intoString:NULL]`跳过所有内容直到数字字符。然后你`[aScanner scanInteger:&anInteger]`将字符扫描成一个整数。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2016-03-02T14:35:02.907

这是正则表达式的用法

```
NSString *logString = @"user logged (3 attempts)";
NSString * digits = [logString stringByMatching:@"([+\\-]?[0-9]+)" capture:1]; 
```

# c - 如何在我的程序中使用 _stprintf，有无 UNICODE 支持？

> ID：594799
> 
> 赞同：4
> 
> 时间：2009-02-27T13:42:23.470
> 
> 标签：c, windows, unicode

Microsoft 的 <tchar.h> 定义`_stprintf`为`swprintf`if`_UNICODE`已定义，如果未定义`sprintf`。但是这些函数采用不同的参数！在`swprintf`中，第二个参数是缓冲区大小，但`sprintf`没有这个。

有人搞砸了吗？如果是这样，这是一个很大的。我如何`_stprintf`在我的程序中使用，并让它们在有和没有的情况下工作`_UNICODE`？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-27T15:56:29.387

你在这里看到了平行进化。`swprintf`是标准 C 的后来者，在发现 (A) 8 位对于文本来说是不够的并且 (B) 您应该将缓冲区大小与缓冲区一起传递之后。`TCHAR`是微软统一 ASCII 和 Unicode API 的想法。他们丢了球，错过了点（B）。正确的`TCHAR`解决方案应该是定义`_stprintf`为`swprintf`or 或`snprintf`。

然后解决方案是简单地包装`<tchar.h>`并自己执行此操作。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-27T15:31:20.493

> 这些函数采用不同的参数！

MS 编译器有两个不同的版本。看看[这里](http://msdn.microsoft.com/en-us/library/ybk95axf(VS.71).aspx)。这符合 ANSI 标准。但我认为这并不能回答你的问题。我会暂时跳过它，而是告诉你如何保持一致性。

> 让他们在有无 _UNICODE 的情况下工作？

根据 MS 的建议，您最好使用“安全字符串函数”。看到[这个](http://msdn.microsoft.com/en-us/library/ce3zzk1k(VS.80).aspx)。使用`_stprintf_s'，我想你会解决你的问题。

> 有人搞砸了吗？

**编辑：**我不这么认为。我没有方便的理由来给你*答案*。当我得到更具体的东西时，我会发布更新。同时看看 MSalters 的解释。

一个奇怪的事情是 MS 的 C 运行时**[并没有](http://msdn.microsoft.com/en-us/library/sk54f3f5(VS.71).aspx)**声称与 ISO 标准兼容。

***免责声明：我不是在为雷德蒙德的巨人辩护，只是指出让我觉得奇怪的东西！***

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2016-02-15T23:10:05.220

这可能不是直接回答问题，但一种替代方法是使用 `_stprintf_s`. 您必须添加额外的参数，但它仍然会以两种方式编译，并且更具前瞻性。

# sql-server-2005 - SQL 按问题分组 SQL Server 2005 CE

> ID：594804
> 
> 赞同：0
> 
> 时间：2009-02-27T13:43:52.607
> 
> 标签：sql-server-2005, compact-framework, group-by

我在使用 sql server 2005 ce 的移动应用程序中使用的 sql 查询有问题。我不太擅长 t-sql，所以这个查询有问题

```
SELECT TP.ID_TASK_MASTER, TP.ID_PROBLEM, TP.ID_TASK_PROBLE, P.DS_PROBLEM, 
       TP.SW_HASOK, TP.SW_HASNOK, TP.SW_HASTOK, TP.SW_HASVALUE,  
       TP.NO_VALUE1, TP.NO_VALUE2 
FROM TASK_PROBLEMS TP 
  INNER JOIN PROBLEMS P 
    ON TP.ID_PROBLEM = P.ID_PROBLEM  
GROUP BY P.DS_PROBLEM,TP.ID_TASK_MASTER, TP.ID_PROBLEM, TP.ID_TASK_PROBLE 
HAVING TP.ID_TASK_MASTER = @P_IDTASKMASTER 
```

我尝试做的是在 ds_problem 字段上进行分组，得到这样的错误：

{"在聚合和分组表达式中，SELECT 子句只能包含聚合和分组表达式。[Select 子句 = TP,SW_HASOK]"}

那么我做错了什么？谢谢..

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-27T13:50:24.667

我想你的意思是

```
SELECT TP.ID_TASK_MASTER, TP.ID_PROBLEM, TP.ID_TASK_PROBLE, P.DS_PROBLEM, 
       TP.SW_HASOK, TP.SW_HASNOK, TP.SW_HASTOK, TP.SW_HASVALUE,  
       TP.NO_VALUE1, TP.NO_VALUE2 
FROM TASK_PROBLEMS TP 
  INNER JOIN PROBLEMS P 
    ON TP.ID_PROBLEM = P.ID_PROBLEM  
WHERE TP.ID_TASK_MASTER = @P_IDTASKMASTER
ORDER BY P.DS_PROBLEM,TP.ID_TASK_MASTER, TP.ID_PROBLEM,TP.ID_TASK_PROBLE 
```

# sql-server - sql中的动态表

> ID：594806
> 
> 赞同：1
> 
> 时间：2009-02-27T13:44:14.387
> 
> 标签：sql-server, sql-server-2000

有什么方法可以在 sql server 2000 中创建动态表吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-27T13:46:02.587

您可以通过在临时表前面加上 octothorp ( `#`) 来创建临时表，或者您可以使用以`@`符号为前缀的表变量。

`create table #tempTable (col1 char(1)) -- Temporary table`

`declare @tempTableVariable table (col1 char(1)) -- Table variable`

来自[http://www.sqlteam.com/article/temporary-tables](http://www.sqlteam.com/article/temporary-tables)

*   如果您的行数少于 100，则通常使用表变量。否则使用临时表。这是因为 SQL Server 不会创建表变量的统计信息。
*   如果您需要在其上创建索引，则必须使用临时表。
*   使用临时表时，请始终创建它们并创建任何索引，然后使用它们。这将有助于减少重新编译。从 SQL Server 2005 开始，这种影响有所减少，但它仍然是一个好主意。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-27T13:48:54.827

以下是返回表变量的用户定义函数的示例：

```
CREATE FUNCTION getDynamicTable () 
RETURNS     
    @output table (
        id int identity,
        value nvarchar(50)
    )
AS
BEGIN

    insert into @output (value) 
    values ('test 1')

    insert into @output (value) 
    values ('test 2')

    return
END 
```

希望这可以帮助

# .net - 在自定义/用户控件 (Winforms) 中添加对嵌套容器的设计时支持

> ID：594808
> 
> 赞同：5
> 
> 时间：2009-02-27T13:44:32.810
> 
> 标签：.net, winforms, design-time

我有一个类似于向导控件的东西，中间是一个面板，我想用它来放置任何子控件。

我发现使用 ScrollableControlDesigner 将允许将删除的控件添加到自定义/用户控件中，但这不是我需要的。它需要添加到容器中，因此可以在不影响“外部”控件（标题、导航按钮）的情况下应用布局。

我尝试了各种方法，但都不起作用，而且看起来很笨拙。

有任何想法吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-27T15:03:08.127

[我在这里](http://www.tech-archive.net/Archive/DotNet/microsoft.public.dotnet.framework.windowsforms.designtime/2005-11/msg00060.html)找到了答案！

关键是`ControlDesigner.EnableDesignMode()`。

# php - 如何动态设置 CodeIgniter 的表单验证规则？

> ID：594820
> 
> 赞同：0
> 
> 时间：2009-02-27T13:46:49.480
> 
> 标签：php, codeigniter

使用新版本的 CodeIgniter；您只能在静态`form_validation.php`文件中设置规则。我需要分析发布的信息（即仅当他们选择复选框时）。只有这样，我才希望验证某些字段。最好的方法是什么，或者我必须使用现在已弃用的旧表单验证类？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-28T14:17:01.053

您不能只在 config/form_validation.php 文件中设置规则。您还可以使用以下方式设置它们：

```
 $this->form_validation->set_rules(); 
```

更多信息：[http ://codeigniter.com/user_guide/libraries/form_validation.html#validationrules](http://codeigniter.com/user_guide/libraries/form_validation.html#validationrules)

但是，CI 的优先顺序是首先检查是否有使用 set_rules() 设置的规则，如果没有，则查看配置文件中是否定义了规则。

因此，如果您在配置文件中添加了规则，但您在操作中调用了 set_rules()，则永远不会达到配置规则。

知道，对于条件验证，我将在模型中有一个特定方法，该方法根据输入（针对该特定操作）初始化 form_validation 对象。我需要这样做的典型情况是验证送货地址和账单地址（它们是相同还是不同）。

希望有帮助。:)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-27T14:01:56.560

您可以编写自己的函数来检查是否选择了所述复选框，并手动应用验证。

```
function checkbox_selected($content) {
    if (isset($_REQUEST['checkbox'])) {
        return valid_email($content);
    }
}

$this->form_validation->set_rules('email', 'Email', 'callback_checkbox_selected'); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-07-18T00:28:18.763

如果您想避免编写自己的验证函数，我遇到了[这个网站](http://www.farinspace.com/codeigniter-conditional-required-field/)，该网站建议，如果您使用[表单验证](http://codeigniter.com/user_guide/libraries/form_validation.html)类动态设置规则，您可以简单地将规则字符串参数构建到 set_rules() 动态。

您首先测试 POST 数据以确定您的条件是否满足（例如选中复选框），然后根据需要在传递给 set_rules() 的规则字符串中添加“|required”。

# javascript - Safari 和 Chrome 浏览器的对象焦点问题

> ID：594821
> 
> 赞同：8
> 
> 时间：2009-02-27T13:46:50.493
> 
> 标签：javascript, flash, actionscript-3, safari

加载页面时，我调用了以下 javascript 来请求焦点。

这段代码在 Firefox 和 IE7 上运行 100% OK，但 Chrome 和 Safari 似乎根本没有转移焦点。如何使其适用于所有浏览器？

```
 document.getElementById("MyFlashFile").focus(); 
```

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2010-09-15T14:24:42.567

我花了几个小时在 Internet 上搜索，但最终我找到了适用于最新版本 IE、Firefox、Chrome 和 Safari 的解决方案。下面的代码很好地解决了这个问题：

```
<head>
  <script type="text/javascript" src="swfobject.js"></script>
  <script>
    function setFocusOnFlash() {
      var f=swfobject.getObjectById('myFlashObjectId');
      if (f) { f.tabIndex = 0; f.focus(); }
    }
  </script>
</head>
<body onload="setFocusOnFlash()"> 
```

此示例假定使用 SWFObject 库嵌入闪存。如果没有，您应该将 f 变量设置为保存 Flash 电影的 Object 或 Embed 标记。

**2012 年 5 月 5 日编辑**：好吧，不幸的是，该解决方法似乎`tabIndex`不再适用于浏览器（Chrome/Safari）和操作系统的所有组合。例如，当前 Windows 上的 Chrome 18 失败。

*请参阅下面由Christian Junk*提供的链接，以获取问题解决的状态。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-28T01:04:10.803

不幸的是，没有办法确保您可以将焦点设置到适用于所有浏览器的 flash 文件。IE 和 Firefox 已经解决了这个问题（大部分），但 Chrome 和 Safari 都基于 Webkit，没有解决方案。

如果您在 YouTube 或其他视频/flash 网站上注意到您看到的第一件事是诱使您点击播放器，那是由于这个问题。

一位开发人员想出了一个巧妙的解决方法，但它确实涉及将一些 ActionScript 添加到您的 flash 文件中，如果您正在构建一个通用播放器，这可能会让人头疼。

Gary Bishop：[修复 Firefox Flash 的愚蠢性](http://wwwx.cs.unc.edu/~gb/wp/blog/2007/06/08/fixing-firefox-flash-foolishness/)

另一种解决方案是将您的 wmode 设置为不透明。我听说这在某些情况下有效，但会搞砸文本区域中的光标。我也没有太多运气，但你可以试一试。

[您可以在bugzilla](https://bugzilla.mozilla.org/show_bug.cgi?id=93149)上找到有关无焦点错误的更多信息。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2010-02-09T18:32:47.233

Chrome中似乎有一个错误：

“window.document.getElementById('swfID').focus() 不适用于 Flash 对象”

[http://code.google.com/p/chromium/issues/detail?id=27868](http://code.google.com/p/chromium/issues/detail?id=27868)

我试图找到一种解决方法，但我找不到；（

问候， 克里斯蒂安

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-05-15T23:31:28.273

除了 Cláudio Silva answer 之外，您还需要设置`wmode="opaque"`

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-27T14:53:01.787

确保在呈现**整个**页面后调用此代码。它可能在它所引用的 HTML 之上被调用，因此该元素尚不存在。

各种 JavaScript 框架都有实用程序来告诉您[DOM 何时准备就绪](http://docs.jquery.com/Tutorials:Introducing_%24(document).ready())。

# excel - 如何破解查找值的 Excel 工作簿？

> ID：594828
> 
> 赞同：2
> 
> 时间：2009-02-27T13:49:36.777
> 
> 标签：excel

好吧，我知道这不是 100% 与编程相关的（有问题的 Excel 书根本不使用 VBA），但我希望有人能帮助我解决这个问题或为我指明正确的方向。

我的老板从供应商那里得到了一个电子表格，其中有一个包含各种零件编号的组合框/下拉列表；当您选择一个时，它会使用包含其他项目的查找填充表单的其余部分。我的任务是“破解”这个并找到他们用来填充的列表，以便我们可以使用它。

问题是......没有 VBA 代码，没有宏，没有数据连接，只有一个工作表显示在 Excel 中，而查找代码引用了`Sheet1`. 我试图显示隐藏的工作表，它说没有......那么这个列表到底可以保存在哪里？我的老板越来越不耐烦了，问我是不是把它弄坏了。做不成也没什么大不了的，就是不知道去哪里找，老板问我做完了不知道该怎么说。

任何人都可以帮忙吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-27T13:56:32.843

可以使用 VBA 隐藏工作表，使其无法从 UI 中取消隐藏。

尝试取消隐藏此处概述的所有隐藏工作表的方法：

[http://www.automateexcel.com/2004/12/14/excel_vba_unhide_all_worksheets/](http://www.automateexcel.com/2004/12/14/excel_vba_unhide_all_worksheets/)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-27T14:27:04.533

我的猜测是它是一个数据验证列表，它引用了“非常隐藏”表上的常量列表或范围。在 Excel 2007 中，使用下拉菜单选择其中一个单元格，单击功能区中的“数据”选项卡，单击功能区中的“数据验证”，然后查看您拥有的内容。在 Excel 2003 中，它是 Data -> Validation... 命令。

如果您知道工作表的名称是“Sheet1”，另一种可能性是添加一个新工作表，在新工作表的单元格 A1 中输入“=Sheet1!A1”，然后将该单元格向下和向右复制区域，您需要查看您感兴趣的数据。

如果您可以发布 URL 以下载工作簿（假设它不是商业机密），您将更有可能获得准确的答案。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-27T13:58:34.367

可能是一些数据存储在同一张纸上。
可能在隐藏的列中，或者远离实际页面的列中？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-27T13:59:28.857

这不仅仅是来自工作表的数据吗？

列标题下拉列表充当过滤器，它们显示列的不同值。这是 Excel 的一个功能。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-27T14:02:12.907

这些项目可以从当前不可用的资源中缓存。尝试将其保存到 xml 并搜索已知字符串。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-02T05:43:32.767

1.  选中时单击显示下拉列表的单元格
2.  从菜单栏中选择数据>验证
3.  在对话框中复制源文本框的内容
4.  现在将内容粘贴到工作表上的任何空单元格上
5.  选择一个向下拖动以查看填充列表的值

克里斯
------
将您的 Excel 电子表格转换为在线计算器。
[http://www.spreadsheetconverter.com](http://www.spreadsheetconverter.com)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-05T18:22:39.050

我假设你现在已经打破了这个，但以防万一你还没有。这当然是使用命名范围进行数据验证的情况，该命名范围位于另一张从 vba 控制台指定为“非常隐藏”的工作表上。您将需要打开此工作表的 VBA 项目并将“非常隐藏”工作表指定为“隐藏”，然后您将能够取消隐藏它，或者可以查看其他设置。

# c# - C# 以非登录用户身份运行 winform 程序

> ID：594830
> 
> 赞同：0
> 
> 时间：2009-02-27T13:51:18.957
> 
> 标签：c#, windows, scheduled-tasks

我需要我的 winform 程序作为另一个用户运行（它将在任务调度程序下运行）而不是登录用户。我怀疑问题在于我的应用程序是基于 gui 而不是基于命令行（这有什么不同），所以 gui 需要加载做它的事情然后关闭。这可能是在 XP 或 Vista 下吗？

谢谢

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-27T13:53:07.873

计划任务可以以指定用户的身份“运行”，该用户可能与登录用户不同。

您可以在创建任务时或通过编辑现有任务的属性来指定此用户。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-27T13:55:46.277

如果您的应用程序需要作为调度任务运行，那么它就不能真正拥有 UI。作为最低要求，它应该真正能够通过命令行运行。

最好的方法是将 UI 与实际处理分开，以便您仍然可以在需要时以交互方式运行它。这也将使测试您的应用程序变得更加容易。

编辑：编辑打字和感觉

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-27T14:03:02.530

我会投票给第一个选项，或者提供额外的可能性：在您的代码中使用模拟。尽管这里可能有点矫枉过正/不适合您的需求。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-27T14:06:33.193

执行程序的另一种方法是基于配置文件甚至数据库连接以编程方式更改用户。一个示例项目位于代码项目上：

[http://www.codeproject.com/KB/cs/runas.aspx](http://www.codeproject.com/KB/cs/runas.aspx)

希望这可以帮助。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-27T14:49:03.870

您正在寻找 Process.Start 方法。其中一个重载接受用户名/密码对。该过程将使用这些用户凭据创建。

```
var app = Process.Start(@"c:\path\to\some\app.exe", userName, password, domainOrEmptyString); 
```

# internet-explorer - 使用 Windows PowerShell 实现 IE 自动化

> ID：594831
> 
> 赞同：2
> 
> 时间：2009-02-27T13:51:23.323
> 
> 标签：internet-explorer, powershell, automation, scripting

我想问一下如何通过 Powershell 操作 IE。我的目标是编写将在浏览器中自动执行某些操作的脚本（在客户端——导航到页面、执行操作、测量响应之间的时间等）

我有这个小东西：

```
$ie = new-object -com "InternetExplorer.Application"
$ie.visible = $true
$ie.navigate("http://google.com") 
```

现在我想检查浏览器是否停止了页面渲染（假设谷歌需要 30 秒才能加载）。正如我所检查的那样，`$ie | get-member`有 DocumentCompleted 属性（事件），但我不知道如何访问/比较它。我该怎么做？

或者也许我应该使用 .NET 而不是 COM 对象并`$ie`使用`[system.Windows.Forms.WebBrowser]`?

干杯

编辑：
嗯...`$ie.busy`有效，但是（也许我之前没有说清楚）我想知道页面渲染比赛的确切时刻。`$ie.busy`每秒检查一次无限循环可能会起作用，但我认为这不是最好的方法。

假设页面正在加载一段时间（由于客户端的巨大脚本，渲染时间很长）。我想需要多长时间才能：

1.  加载页面
2.  更改某些数据并单击“保存”后重新加载/重新渲染需要多长时间。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-27T13:53:42.367

您可以检查 .busy 属性。

编辑：

Status 属性也可以在这里使用。但是，您可以使用 Firebug 之类的工具来查看页面加载时间。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-27T13:59:15.707

如果您决定使用 .NET 而不是 PowerShell，[WatiN](http://watin.sourceforge.net/)非常适合。它将为您提供比 WebBrowser 控件更大的灵活性，并且更易于使用。您现在也可以在版本 2 中驱动 Firefox。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-02T02:32:05.317

由于它有一个事件，你可以试试[PowerShell Eventing Library](http://www.codeplex.com/PSEventing)。它说它支持 COM 事件，虽然我没有尝试过。

# java - 如何在 java 程序本身中实现我的安全策略

> ID：594832
> 
> 赞同：3
> 
> 时间：2009-02-27T13:51:26.223
> 
> 标签：java, rmi

我真的是java-RMI的新手，并在上面开发了一个小应用程序。但是要运行我的服务器和客户端，我需要执行-Java -Djava.security.policy=client.policy

那么我应该怎么做才能省略'-Djava.security.policy=client.policy'这个命令呢？或者有什么办法可以在java程序中实现安全策略？提前致谢。

* * *

## 回答 #1

> 赞同：-1
> 
> 时间：2009-07-31T07:13:34.197

在 RMI 应用程序中需要策略文件，以便客户端可以连接到远程服务器。您还需要在客户端和服务器中实现 securityManager。这个安全管理器将允许您连接到客户端打算连接的任何 rmi 远程主机。我认为策略文件不能在 RMI 中省略。这是必需的。

# session - 是否可以让 gVim 记住窗口大小？

> ID：594838
> 
> 赞同：37
> 
> 时间：2009-02-27T13:53:05.503
> 
> 标签：session, vim, window, persistence

我知道如何在 gVim 中[设置初始窗口大小](http://vim.wikia.com/wiki/Maximize_or_set_initial_window_size)，但是如何让它自动恢复上次会话的窗口大小？这甚至可能吗？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-02-27T14:22:29.770

编辑：更正了我的答案。提到的 winsize sessionoption 仅指 vim 内部窗口布局，而不是外部尺寸。

* * *

如果你使用

```
:mksession 
```

并在 vim 启动时加载会话

```
gvim -S Session.vim 
```

您可以通过在 sessionoptions 中包含 winpos 和 resize 来将窗口位置和大小包含在会话中，请参阅

```
:help  'sessionoptions 
```

使用自动命令，您甚至可以在 Vim 进入和退出时自动保存和恢复会话。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2010-12-22T21:31:41.660

这些行只保存和恢复位置和大小：

```
set sessionoptions+=resize,winpos
autocmd VIMEnter * :source C:/session.vim
autocmd VIMLeave * :mksession! C:/session.vim 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2010-05-18T20:31:12.193

此外：

在你的`.vimrc`：

```
set ssop+=resize,winpos,winsize,blank,buffers,curdir,folds,help,options,tabpages 
```

然后，使用[本文](http://vim.wikia.com/wiki/Restore_screen_size_and_position)中的脚本。它工作得很好！

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-10-07T23:53:53.920

我有同样的问题，要扩展上述答案，您只需将以下内容添加到您的`.vimrc`以获得您想要的行为：

```
set sessionoptions+=resize,winpos 
```

看`:h ssop`

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-08-19T21:20:48.783

```
gvim -geom 85x55 
```

就像，把它放在你的 .bashrc 中：

```
alias G='gvim -geom 85x55' 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2015-12-03T16:53:06.390

如果你只是想让 vim 每次都打开相同的大小，你可以编辑你用户的 vimrc `C:/Users/<yourUserName>/_vimrc`（这比在你的 vim 安装文件夹中编辑系统 _vimrc 更可取）以包含该行`set lines=<yourHeight> columns=<yourWidth>`

# php - 语言中性入口页面

> ID：594846
> 
> 赞同：0
> 
> 时间：2009-02-27T13:55:31.690
> 
> 标签：php, url, localization

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-27T14:00:27.373

*   domain.com/en/index.php
*   domain.com/fr/index.php

Use url rewriting with regular expressions (mod_rewrite, ISAPI, whatever) to handle requests to relevant pages so

*   domain.com/en/index.php REWRITE TO domain.com/index.php?lang=en
*   domain.com/fr/index.php REWRITE TO domain.com/index.php?lang=fr

This way your pages are two seperate pages to search engines but handled via one gateway in code. I'm not a regex expert but it would be a very simple regex I would imagine

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-27T14:09:19.410

I'm not sure I understand the question. It seems to have two parts:

How to provide a default language of English:

`$lang = empty($_GET['lang']) ? "eng" : $_GET['lang'];`

Do you also have a problem of where to put the English/Francais links so search engines don't ding you? I wasn't aware of this problem.

It might also help to let us know if you're using a CMS, and if so which one.

(Repondez a moi en Francais si vous voulais. Je lis en francais bein meilleur que j'en ecris).

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-27T14:00:10.493

Unless I'm misunderstanding the question, in index.php, when you check the language, put something like this:

```
$lang = @$_GET['lang'];
if ( empty($lang) ) $lang = 'eng'; 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-27T13:59:36.517

Just put an argument in the php code that says :

```
 if (lang == "")  // haven't done php in a while so the syntax is probably wrong
{
  lang = "eng";
} 
```

In other words, if there isn't an argument on the lang variable, you can just set it to be eng automatically, and so the first page will default to English every time, unless told otherwise.

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-27T13:59:55.690

Just make the default english and offer an option on the index page to change to french? This, of course, depends on what language most of the visitors speak, which isn't all that hard to figure out with visitor logs.

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-27T14:17:59.717

I would use a neutral URL for entry, such as:

```
http://example.com/foo/bar 
```

On this page I would do some [language negotiation](http://www.w3.org/International/questions/qa-when-lang-neg) or simply ask the user for the prefered language. Then I can redirect to the language specific URL:

```
http://example.com/en/foo/bar 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-27T14:31:32.977

what do you think about that solution

```
<?php
    $lang = $_GET['lang'];
    if ( empty($lang) ) $lang = 'fra';
    header( 'Location: http://acecrodeo.com/new/01-acec.php?lang='.$lang) ;
?> 
```

# c - glibc 的 fprintf() 实现是线程安全的吗？

> ID：594851
> 
> 赞同：8
> 
> 时间：2009-02-27T13:56:54.090
> 
> 标签：c, multithreading, posix, lighttpd, printf

fprintf 线程安全吗？ [glibc 手册](http://www.gnu.org/software/libc/manual/html_node/Streams-and-Threads.html)似乎是这样说的，但是我的应用程序使用对 fprintf() 的单次调用写入文件似乎混合了来自不同进程的部分写入。

编辑：为了澄清，有问题的程序是一个[lighttpd](http://www.lighttpd.net/)插件，并且服务器正在运行多个工作线程。

查看文件，一些写入是混合在一起的。

编辑2：看来我看到的问题可能是由于lighttpd的“工作线程”实际上是单独的进程：[http://redmine.lighttpd.net/wiki/lighttpd/Docs:MultiProcessor](http://redmine.lighttpd.net/wiki/lighttpd/Docs:MultiProcessor)

> **问题**
> 
> 通过在同一个套接字上运行 2 个或更多进程，您将获得更好的并发性，但您必须注意一些缺点：
> 
> *   mod_accesslog 可能会创建损坏的访问日志，因为同一个文件被打开两次并且不同步。
> *   mod_status 将有*n 个*单独的计数器，每个进程一组。
> *   mod_rrdtool 将失败，因为它两次接收到相同的时间戳。
> *   mod_uploadprogress 不会显示正确的状态。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-02-27T14:01:31.693

您混淆了两个概念 - 从多个线程写入和从多个进程写入。

在进程内部，可以确保在允许访问输出缓冲区之前完成对 fprintf 的一次调用，但是一旦您的应用程序将该输出泵入文件，您就会受到操作系统的支配。如果没有某种基于操作系统的锁定机制，您将无法确保完全不同的应用程序不会写入您的日志文件。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-02-27T14:09:34.403

在我看来，您需要阅读有关[文件锁定](http://www.gnu.org/software/libtool/manual/libc/File-Locks.html)的内容。您遇到的问题是多个进程（即不是线程）同时写入同一个文件，并且没有可靠的方法来确保写入是原子的。这可能导致文件覆盖彼此的写入、混合输出以及完全不确定的行为。

这与线程安全无关，因为这仅在单进程多线程程序中相关。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-27T15:16:11.730

当前的 C++ 标准对并发没有任何用处，1990 年的 C 标准也没有。（我没有读过 1999 年的 C 标准，所以不能评论它；即将到来的 C++0x 标准确实说明了一些事情，但我不知道究竟是什么。）

这意味着 fprintf() 本身可能既不是线程安全的，也不是其他的，它取决于实现。我会准确阅读 glibc 文档中关于它的内容，并将其与您正在做的事情进行比较。

# ios - UITableViewCell 的默认高度是多少？

> ID：594852
> 
> 赞同：167
> 
> 时间：2009-02-27T13:57:07.897
> 
> 标签：ios, iphone, uitableview

我认为这些信息会更容易找到:-)

UITableViewCell 的默认高度是多少？它看起来像 44 像素，但我更愿意确定。

* * *

## 回答 #1

> 赞同：363
> 
> 时间：2009-02-27T15:19:55.093

它是 44 像素。确实。我永远不会忘记那个号码。

44px 也是 UIToolbar 和 UINavigationBar 的默认高度。（当自动旋转到横向时，两者都会切换到 32 像素。）

* * *

## 回答 #2

> 赞同：27
> 
> 时间：2015-08-21T16:16:10.647

如果你想在任何设备上使用默认尺寸，你可以使用： UITableViewAutomaticDimension

```
- (CGFloat)tableView:(UITableView *)tableView heightForRowAtIndexPath:(NSIndexPath *)indexPath {

    return UITableViewAutomaticDimension;
} 
```

虽然 44 像素目前是默认值，但如果您的应用依赖于设置默认值，这将是一种有用的方法。

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2011-12-20T21:49:31.163

当 时`style = UITableViewStyleGrouped`，顶部和底部单元格的默认高度实际上是`45.0f`（不是`44.0f`）。而且，如果分组表只有一行，则单元格高度将为`46.0f`.

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2012-07-10T17:19:10.570

如果您想即时计算，只需分配一个虚拟表格单元格并读取其高度

```
UITableViewCell *cell = [[UITableViewCell alloc] initWithStyle:UITableViewCellStyleDefault reuseIdentifier:@"Cell"];
int height = cell.frame.size.height ; 
```

这样你就可以抵御未来 iOS 版本的变化，尽管我认为这不太可能。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2019-05-21T09:55:45.767

在**Swift 4**和**Swift 5**中，只需使用：

```
UITableView.automaticDimension 
```

使用 44px 是不够的，因为它会随着不同的屏幕像素密度而变化。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2012-12-10T11:52:47.017

“当 style = UITableViewStyleGrouped 时，顶部和底部单元格的默认高度实际上是 45.0f（不是 44.0f）。而且，如果分组表只有一行，则单元格高度将为 46.0f。” 这是错的！！事实上44.0f！我只是测试一下！

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-02-27T14:12:16.440

这听起来很对。但要确保您可以加载界面生成器，将 UITableViewCell 放入项目中，然后在检查器窗口中检查大小属性。我现在没有 MacBook，所以无法查看。但是，如果您没有从某人那里得到更好的答案，那么您可以自己检查。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2019-01-29T16:05:03.793

在 iOS 12 上，iPhone X 等设备（X、XS、XS Max、XR）的默认高度为**49pt**。

iOS 12 上的其他设备仍然默认为**44pt**。这是一个微妙的差异，但在直接比较中感觉像是一个很好的改进。

如果您不相信我，请在此屏幕截图中自己测量（不要忘记除以 3）...；）

[![](https://i.stack.imgur.com/bZaO8.png)](https://i.stack.imgur.com/bZaO8.png)

# c# - C#中的动态数组

> ID：594853
> 
> 赞同：123
> 
> 时间：2009-02-27T13:58:25.833
> 
> 标签：c#

有没有在 C# 中创建动态数组的方法？

* * *

## 回答 #1

> 赞同：155
> 
> 时间：2009-02-27T13:59:27.267

看看[通用列表](http://msdn.microsoft.com/en-us/library/6sh2ey19.aspx)。

* * *

## 回答 #2

> 赞同：98
> 
> 时间：2009-02-27T14:45:38.280

使用代码示例扩展 Chris 和 Migol 的答案。

使用数组

```
Student[] array = new Student[2];
array[0] = new Student("bob");
array[1] = new Student("joe"); 
```

使用通用列表。List<T> 类在底层使用数组进行存储，但这样做的方式是允许它有效地增长。

```
List<Student> list = new List<Student>();
list.Add(new Student("bob"));
list.Add(new Student("joe"));
Student joe = list[1]; 
```

* * *

## 回答 #3

> 赞同：65
> 
> 时间：2010-11-02T14:28:21.617

有时普通数组比通用列表更受欢迎，因为它们更方便（对于昂贵的计算更好的性能 - 例如数值代数应用程序，或者与 R 或 Matlab 等统计软件交换数据）

在这种情况下，您可以在动态启动 List 后使用 ToArray() 方法

```
List<string> list = new List<string>();
list.Add("one");
list.Add("two");
list.Add("three");

string[] array = list.ToArray(); 
```

当然，这只有在数组的大小永远不知道也不预先固定的情况下才有*意义*。如果您*在程序的某个点*已经知道数组的大小，最好将其作为固定长度数组启动。（例如，如果您从 ResultSet 检索数据，则可以计算其大小并动态启动该大小的数组）

* * *

## 回答 #4

> 赞同：36
> 
> 时间：2009-02-27T14:00:08.200

`List<T>`对于强类型，或者`ArrayList`如果您有 .NET 1.1 或喜欢强制转换变量。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2018-11-19T05:09:29.947

您可以使用动态对象执行此操作：

```
var dynamicKeyValueArray = new[] { new {Key = "K1", Value = 10}, new {Key = "K2", Value = 5} };

foreach(var keyvalue in dynamicKeyValueArray)
{
    Console.Log(keyvalue.Key);
    Console.Log(keyvalue.Value);
} 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2015-06-24T07:18:47.737

使用实际上是实现数组的**数组列表。**它最初需要大小为 4 的数组，当它变满时，会创建一个具有双倍大小的新数组，并将第一个数组的数据复制到第二个数组中，现在将新项插入到新数组中。此外，第二个数组的名称创建了 first 的别名，以便可以通过与先前相同的名称访问它，并且第一个数组被释放

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2017-07-31T08:34:53.660

动态数组示例：

```
Console.WriteLine("Define Array Size? ");
int number = Convert.ToInt32(Console.ReadLine());

Console.WriteLine("Enter numbers:\n");
int[] arr = new int[number];

for (int i = 0; i < number; i++)
{
    arr[i] = Convert.ToInt32(Console.ReadLine());
}
for (int i = 0; i < arr.Length; i++ )
{
    Console.WriteLine("Array Index: "+i + " AND Array Item: " + arr[i].ToString());
}
Console.ReadKey(); 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2020-07-21T22:11:03.097

您可以使用集合类中的 arraylist 对象

```
using System.Collections;

static void Main()
{
  ArrayList arr = new ArrayList();
} 
```

当你想添加元素时，你可以使用

```
arr.Add(); 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2016-07-14T12:42:52.067

这个答案似乎是您正在寻找的答案[为什么我不能这样做：dynamic x = new ExpandoObject { Foo = 12, Bar = "twelve" }](https://stackoverflow.com/questions/7478048/why-cant-i-do-this-dynamic-x-new-expandoobject-foo-12-bar-twelve)

阅读`ExpandoObject`这里[https://msdn.microsoft.com/en-us/library/system.dynamic.expandoobject(v=vs.110).aspx](https://msdn.microsoft.com/en-us/library/system.dynamic.expandoobject(v=vs.110).aspx)

和`dynamic`这里的类型[https://msdn.microsoft.com/en-GB/library/dd264736.aspx](https://msdn.microsoft.com/en-GB/library/dd264736.aspx)

# python - 创建一个与类成员名称同名的python属性

> ID：594856
> 
> 赞同：11
> 
> 时间：2009-02-27T13:58:53.460
> 
> 标签：python

是否可以在python中创建一个与类的成员变量名称同名的属性。例如

```
Class X:
    ...
    self.i = 10 # marker
    ...
    property(fget = get_i, fset = set_i) 
```

请告诉我我该怎么做。因为如果我这样做，对于标记处的语句，我会得到 assingm 的堆栈溢出

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2009-02-27T14:09:00.643

> 是否可以在python中创建与成员变量名称同名的属性

不，属性、成员和方法都共享同一个命名空间。

> 标记处的语句我得到堆栈溢出

清楚地。您尝试设置 i，它调用属性 i 的设置器，它尝试设置 i，它调用属性 i 的设置器...广告 stackoverflowum。

通常的模式是使后端值成员按照惯例是非公开的，方法是在其前面加上 '_'：

```
class X(object):
    def get_i(self):
        return self._i
    def set_i(self, value):
        self._i= value
    i= property(get_i, set_i) 
```

请注意，您必须使用新型对象（子类“对象”）才能使“属性”正常工作。

# javascript - 修复 IE 中的背景位置

> ID：594870
> 
> 赞同：13
> 
> 时间：2009-02-27T14:01:53.657
> 
> 标签：javascript, jquery, internet-explorer, background-position

当运行一段使用 jquery 和 2 个 jquery 插件的代码时，我在 IE7 中遇到了这个问题。该代码适用于 FF3 和 Chrome。

完整的错误是：

```
Line: 33 
Char: 6 
Error: bg is null or not an object 
Code: 0 
URL: http://localhost/index2.html 
```

但是第 33 行是一个空行。

我正在使用 2 个插件：可拖动和缩放。无论我对代码做什么，总是第 33 行有问题。我通过查看源检查源是否有更新，但我觉得这可能是在骗我。

```
<body>
<div id="zoom" class="zoom"></div>
<div id="draggable" class="main_internal"><img src="tiles/mapSpain-smaller.jpg" alt=""></div>

<script type="text/javascript">
$(document).ready(function() {
    $('#draggable').drag();
    $('#zoom').zoom({target_div:"draggable", zoom_images:new Array('tiles/mapSpain-smaller.jpg', 'tiles/mapSpain.jpg') });
});
</script>

</body> 
```

基本上我想要做的是用 jQuery 重新创建 Pragmatic Ajax 地图演示。

* * *

看来这个片段的第二行是造成问题的原因：

```
bg = $(this).css('background-position');                    
if(bg.indexOf('%')>1){ 
```

似乎是在尝试选择 background-position 属性`#draggable`但没有找到它？手动添加`background-position: 0 0;`没有解决它。关于如何解决这个问题的任何想法？

我尝试使用 MS Script Debugger，但这几乎没用。无法检查变量或其他任何内容。

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2009-02-27T16:51:52.873

在 Interweb 上进行更多挖掘已经揭示了答案：IE 不理解 selector `background-position`。它理解非标准`background-position-x`和`background-position-y`.

目前正在一起破解某些东西以解决它。

不错，雷德蒙德。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2011-02-17T07:12:11.453

为了解决 Internet Explorer 不支持“background-position”CSS 属性这一事实，从 jQuery 1.4.3+ 开始，您可以使用[.cssHooks](http://api.jquery.com/jQuery.cssHooks/)对象在浏览器之间规范化该属性。

为了节省一些时间，有一个可用的[背景位置 jQuery 插件](https://github.com/brandonaaron/jquery-cssHooks/blob/master/bgpos.js)，它允许“background-position”和“background-position-x/y”在默认情况下不支持其中一个或另一个的浏览器中按预期工作。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2011-10-23T01:44:23.333

挺有趣的。IE8不理解getter backgroundPosition，但它理解setter。

```
$('.promo3').mousewheel(function(e,d){
  var promo3 = $(this);
  var p = promo3.css('backgroundPosition');
  if (p === undefined) {
    p = promo3.css('backgroundPositionX') + ' ' + promo3.css('backgroundPositionY');
  }
  var a = p.split(' ');
  var y = parseInt(a[1]);
  if (d > 0) {
    if (y < -1107) y += 1107; 
    y -= 40;
  }
  else {
    if (y > 1107) y -= 1107;
    y += 40;
  }
  promo3.css('backgroundPosition', a[0] + ' ' + y + 'px');
  return false;
}); 
```

它在 IE8 和 IE8 兼容视图中运行良好。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2010-02-25T01:05:05.600

这对我有用：

```
 if (navigator.appName=='Microsoft Internet Explorer')
   {
    bg = $(drag_div).css('backgroundPositionX') + " " + $(drag_div).css('backgroundPositionY');
   }
   else
   {
    bg = $(drag_div).css('background-position');
   } 
```

希望它对你有用。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-27T14:05:40.420

您可能需要检查以确保以正确的顺序加载 js 文件，以便考虑任何依赖关系。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-02-27T23:45:55.390

后来我想了一点（和一杯茶）：

```
if(bg == 'undefined' || bg == null){
    bg = $(this).css('background-position-x') + " " + $(this).css('background-position-y');
} 
```

不幸的是，尽管我可以找到在线资源，但它返回中心中心，如果值未定义，它应该返回 0 0。

开始怀疑是否有实际的修复/解决方法。很多人都尝试过，但到目前为止都未能捕捉到所有边缘情况。

camelCase 版本`backgroundPosition`似乎可行，但我对 jQuery 的了解还不够，无法准确评估如何去做——从我读过的内容来看，如果之前已设置该属性，您只能使用 camelCase 作为 getter。如果我弄错了，请告诉我。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-27T14:48:23.937

> 但是第 33 行是一个空行。

它将是您的 .js 文件之一的第 33 行，而不是 HTML 本身的第 33 行。IE 无法报告错误所在的实际文件。请查看每个 .js 的第 33 行，了解有关“bg”的信息；如果最坏的情况变得最坏，您可以开始在每个 .js 的开头插入换行符并查看行号是否更改。

> 我通过查看源检查源是否有更新，但我觉得这可能是在骗我。

查看源代码将始终向您显示 IE 从服务器获得的内容。它不会显示对 DOM 的任何更新。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-27T22:06:05.910

试试 backgroundPosition 代替

此外，请确保“this”存在并且您对属性的请求会返回一个值。当您尝试在不存在的属性上调用方法时，IE 会抛出此类错误，因此 bg 为 null 或 null 一个对象。如果你不关心 IE，你可以做 bg = $(this)... || '' 所以总有一些东西被引用。

此外，与您遇到的错误无关，但您的索引值 1 是否正确？你是说 -1 吗？

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2011-02-06T22:44:36.063

您不能在 jquery css 函数中使用破折号。你必须在 camelCase: `.css('backgroundPosition')`或**IE**`.css('backgroundPositionX')`中这样`.css('backgroundPositionY')`做

 *** * *

## 回答 #10

> 赞同：0
> 
> 时间：2013-04-24T09:54:03.850

是的，
请尝试使用背景位置，或者在调用之前使用 jquery 设置背景位置。我猜人们在调用它之前经常通过 CSS 知道位置。它不漂亮，但不知何故它对我有用。）

例如：

```
//set it in with javascript.
$("someid").css("background-position", "10px 0");
...
//do some funky stuff
//call it
$("someid").css("background-position");
//and it would return "10px 0" even in IE7 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2013-07-06T10:40:55.757

如果没有任何帮助，也可以使用以下技巧。

我们可以将元素的背景替换为内部绝对定位的元素（具有相同的背景）。坐标将替换为`left`和`top`属性。这将适用于所有浏览器。

为了更好地理解，请检查代码：

**前**

```
<div></div>

div {
  background: url(mySprite.png);
  background-position: -100px 0;
} 
```

**后**

```
<div>
  <span></span>
</div>

div {
  position: relative;
  overflow: hidden;
  width: 100px;       /* required width to show a part of your sprite */
  height: 100px;      /* required height ... */
}

div span {
  position: absolute;
  left: -100px;       /* bg left position */
  top: 0;             /* bg top position */
  display: block;
  width: 500px;       /* full sprite width */
  height: 500px;      /* full sprite height */
  background: url(mySprite.png);
} 
```

这个解决方案不是很灵活，但它帮助我正确显示图标悬停状态。

# svn - Subversion 的实用 RSA SecurID 身份验证？

> ID：594872
> 
> 赞同：0
> 
> 时间：2009-02-27T14:02:00.927
> 
> 标签：svn, authentication, rsa

有人用 RSA SecurID 身份验证设置 Subversion 吗？有没有办法解决不断重新提示身份验证的问题？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-22T23:37:23.843

我还没有将 SecurID 与 SVN 一起使用。但是，如果您可以进行一次身份验证并在之后“正常”，它将破坏像 SecurID 这样的一次性密码系统的意图。

# ruby - 多态 has_many 自引用

> ID：594874
> 
> 赞同：1
> 
> 时间：2009-02-27T14:02:35.527
> 
> 标签：ruby, has-many, polymorphism

我有许多模型（文章、视频、照片）

现在我正在尝试创建一个related_to 关联，这样

一篇文章可以有许多与之相关的其他文章、视频和照片。视频和照片也可以。

这是我尝试过的：

模块 ActsAsRelatable

```
def self.included(base)
  base.extend(ClassMethods)
end

module ClassMethods
    def acts_as_relatable
        has_many :related_items, :as => :related
        has_many :source_items, :as => :source, :class_name => 'RelatedItem'
    end
end 
```

结尾

类 RelatedItem < ActiveRecord::Base belongs_to :source, :polymorphic => true belongs_to :related, :polymorphic => true end

然后我在我的三个模型（文章、视频、照片）中添加了acts_as_relatable，并将该模块包含在 ActiveRecord::Base 中

在 ./script/console 中尝试时，我让它添加相关项目并且 id 可以正常工作，但是 source_type 和 related_type 始终相同（从中调用related_items 的对象）我希望related_item 是另一个模型名称。

有什么想法吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-01T07:53:22.637

我会使用[has many polymorphs](http://github.com/fauna/has_many_polymorphs/tree/master)插件，因为它支持双面多态，你可以这样做：

```
class Relating < ActiveRecord::Base
    belongs_to :owner, :polymorphic => true
    belongs_to :relative, :polymorphic => true

    acts_as_double_polymorphic_join(
      :owners => [:articles, :videos, :photos],
      :relatives => [:articles, :videos, :photos]
    )
end 
```

并且不要忘记数据库迁移：

```
class CreateRelatings < ActiveRecord::Migration
  def self.up
    create_table :relating do |t|
      t.references :owner, :polymorphic => true
      t.references :relative, :polymorphic => true
    end
  end

  def self.down
    drop_table :relatings
  end
end 
```

我不知道“关系”是否是个好名字，但你明白了。现在一篇文章、视频和照片可以与另一篇文章、视频或照片相关联。

# asp.net - 有哪些方法可以优化您对 ASP.NET 缓存的使用？

> ID：594876
> 
> 赞同：3
> 
> 时间：2009-02-27T14:02:55.620
> 
> 标签：asp.net, optimization, caching

我一直在阅读这个主题，但我很想知道优化 ASP.NET 缓存使用的最佳方法是什么，以及关于如何确定什么应该和不应该有哪些技巧进入缓存。此外，是否有任何经验法则可以确定缓存中的内容应该说多长时间？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-27T18:10:02.593

## 一些经验法则

*   每次考虑使用缓存时，请考虑缓存**未命中与请求的比率。**如果该项目的缓存请求大部分时间都会丢失，那么收益可能不会超过维护该缓存项目的成本
*   考虑**查询费用与缓存检索费用**（例如，对于简单读取，由于序列化成本，SQL Server 通常比分布式缓存更快）

## 一些技巧

*   gzip 字符串，然后将它们粘贴到缓存中。有效扩展缓存，减少分布式缓存情况下的网络流量
*   如果您担心缓存聚合（例如计数）需要多长时间，请考虑使用未过期（或长期存在）的缓存聚合，并在更改基础数据时主动更新这些聚合。这是一种有争议的技术，您应该在继续之前真正考虑您的请求/无效比率，但在某些情况下，这样做的好处是值得的（例如，根据实施细节，每个用户的 SO 代表可能是一个很好的候选人，未回答的 SO 问题的数量会可能是一个糟糕的候选人）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-27T18:24:05.600

暂时不要实现缓存。

推迟它，直到您用尽所有索引、查询调整、页面简化和其他更普通的提高性能的方法。如果您在不得已的情况下启用缓存，您将很难找出性能瓶颈真正存在的地方。

而且，当然，如果您在最终打开缓存时正确调整了后端，那么它的工作时间会比现在做的要好得多。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-27T14:15:03.377

我听过的关于性能调整和缓存的最好引用是它是一门艺术而不是一门科学，抱歉不记得是谁说的了，但这里的重点是有很多因素会影响你的性能应用程序，您需要逐个评估每种情况，并对这种情况进行深思熟虑的调整，直到达到预期的结果。

我意识到我没有在这里给出任何细节，但我真的不认为你可以

不过，我将举一个前面的例子。我开发了一个应用程序，该应用程序对 Web 服务进行了很多调用以建立客户端配置文件，例如

*   获取客户端
*   获取客户报价
*   获取客户报价

Web 服务返回的每个对象都有助于更高级别的对象，然后用于构建结果页面。起初，我们将所有对象收集到主对象中并将其缓存。然而我们意识到，当事情没有我们希望的那么快时，单独缓存每个被调用的对象会更有意义，这样它就可以在客户端看到的下一页上重新使用，例如

*   [缓存] 客户端
*   [缓存] 客户报价
*   [缓存] 客户报价
*   获取客户报价升级

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-27T16:16:18.513

不幸的是，没有预先制定的规则......但为了给你一个常识，我想说你可以轻松缓存：

*   应用程序参数（国家列表、电话代码等...）
*   任何其他应用程序非易失性数据（角色列表，即使可配置）
*   经常读取且变化不大的业务数据（如果不是 100% 准确，也没什么大不了的）

您不应该缓存的内容：

*   频繁变化的易失性数据（通常是业务数据）

至于缓存持续时间，我倾向于根据数据类型及其大小使用不同的持续时间。应用程序参数可以缓存几个小时甚至几天。

对于某些业务数据，您可能希望缓存持续时间更短（分钟到 1 小时）

最后一件事总是挑战您操作的数据量。请记住，最终用户不会同时读取数千条记录。

希望这能给你一些指导。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-27T17:47:44.457

很难概括这种事情。唯一要遵循的硬性规则是不要浪费时间优化某些东西，除非你**知道**它需要完成。那么正确的操作过程将在很大程度上取决于您的应用程序的细节。

也就是说......我几乎总是将全局应用程序参数缓存在一些易于使用的对象中。这当然更多的是编程方便而不是优化。

有一次我为一个与非常慢的会计数据库接口的应用程序编写了特定的数据缓存代码，然后它对于不经常更改的数据是只读的。所有写入都进入数据库。使用 SQL Server，我从来没有遇到过内置 ASP.NET 到 SQL Server 接口是等式中速度较慢的部分。

# c# - 正则表达式模式是简单的文本还是规则？

> ID：594885
> 
> 赞同：0
> 
> 时间：2009-02-27T14:05:54.007
> 
> 标签：c#, .net, regex

是否有任何相对简单的方法可以将正则表达式模式识别为简单文本或规则？

一个例子。`@"[A-Z0-9]"`- 是一个规则，`@"\\[A-Z0-9\\]"`是一个纯文本（C# 字符串语法）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-27T14:11:09.237

没有检测到 '[' 即转义的正则表达式字符，我想不出任何事情。

由于使用 @ 逐字复制字符串文字尝试 -

1.查找每个'['/'*'/'+'/'所有其他正则表达式字符'并确保前一个字符是'\'。

2.另一种方法可能是编写语法/正则表达式来检查这一点。我想你需要一个语法。无论如何，上面的（1）更简单。

一些字符串方法可能有助于检查上述内容（如 IndexOf ...）。

***在任何情况下，正则表达式只是一个字符串，除非它被编译和使用。我仍然不明白你为什么要这样做。如果您想确保某些东西是格式良好的正则表达式，那就更容易了。（我不知道 C# 的特定方法——请参阅 Svish 的回答。）。***

**注意**
1\. 正则表达式始终是规则，因为正则表达式“XYZ”是始终单独匹配“XYZ”而不匹配其他任何内容的规则。

我希望这有帮助。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-27T14:38:37.423

你什么意思？正则表达式总是写成字符串。不管你如何写字符串，它总是一个字符串。

另一方面，如果你想检查一个字符串是否是一个有效的正则表达式（如果这是你所要求的），你总是可以这样做：

```
try
{
   new Regex(someRegexString);
}
catch(ArgumentException)
{
  // Regular expression parsing error. I.e: Not a valid regular expression.
} 
```

现在，如果要*使用*正则表达式字符串，可以将其用作字符串或正则表达式。将其用作字符串就像...将其用作字符串...将其用作正则表达式意味着创建一个`Regex`对象（或使用 的某些静态方法`Regex`）。如果您然后将其用作规则，或替换文本，或提取内容或其他任何内容，那并不会真正改变任何东西。正则表达式仍然是正则表达式。

# php - 用于重现的简单实用的 PHP 逻辑

> ID：594893
> 
> 赞同：2
> 
> 时间：2009-02-27T14:09:03.577
> 
> 标签：php, mysql, event-handling, calendar

我之前已经[提交过](https://stackoverflow.com/questions/579892/php-calendar-recurrence-logic)，但是因为有人投了反对票并说已经回答了，所以没有人会回答。

我知道这里有类似的帖子：

*   [设计问题：你将如何设计一个循环事件系统？](https://stackoverflow.com/questions/123793/design-question-how-would-you-design-a-recurring-event-system)
*   [在日历应用程序中模拟重复事件的最佳方法是什么？](https://stackoverflow.com/questions/85699/whats-the-best-way-to-model-recurring-events-in-a-calendar-application)

但他们没有回答我的请求，这是一个实用、简单和真实的循环日历设置逻辑示例，而不使用直接 PHP 和 MySQL 以外的其他框架或工具/脚本。

我同意这篇文章[http://martinfowler.com/apsupp/recurring.pdf](http://martinfowler.com/apsupp/recurring.pdf)很好，但它太抽象了，我无法理解。

我知道还有其他“系统已经做到了这一点”，但这是我自己的白鲸，我会在某个时候弄清楚 - 我只是想在此过程中得到一些帮助。

所以，问题是：如何使用 PHP 和 MySQL 构建一个循环日历？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-27T14:18:38.610

您应该努力理解 Fowler 的文章。它确实涵盖了它。

事实是，这是一个难题。“即时”编辑逻辑并不是用户真正想做的事情。相反，他们希望作为程序员的你已经预料到他们想要做什么并为此提供了一个规则——例如，他们不想弄清楚如何计算每月的第二个星期三。

听起来您真正的问题在于对 MySQL 中的重复进行建模。您可以使用[Google 的 spec](http://code.google.com/p/google-rfc-2445/)，它可以存储在数据库中并在 Stack Overflow 之前进行介绍。Fowler 的文章还就可以在 RDBMS 中表示的明确定义的类提供了一些很好的起点。

这是一个难题。虽然 SO 希望您成功，但我们只能引导您进入流程。我们不能强迫你喝酒。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-01T23:57:44.427

有关循环日历逻辑的实用、真实示例，请查看您的 PDA 或同等设备。

几年前，我在一个 Intranet 应用程序中构建了一个日历，并且基本上复制了我的 Palm 用于重复选项的内容。这对人们来说是有意义的，所以我认为它是成功的。但它并没有在数据库中存储真正的干净。我的代码最终进行了大量仔细检查，以确保数据与各种规则保持一致，以便在出现问题时进行纠正。这有助于我们在开发它时积极使用它。:-)

就存储而言，日历条目包含一个标志，指示它是否是循环系列的一部分。如果不是，则为非经常性条目。如果是，那么编辑它有几个选项，其中一个是在此条目处打破系列。经常性条目作为离散项目放入数据库；这是出于性能原因而进行的一种非规范化。除此之外，这意味着想要检查日历的其他代码不必担心重复项目。我们通过始终要求该系列的结束日期来解决“永无止境”的问题。

实际上，设置重复项目涉及 UI 中的一些 JavaScript 来控制不同的设置。数据库中的条目有一个值组合来指示重复范围（例如每天、每周……）、重复步骤（例如 1 周、2 周……）和任何变化（每周让你说“每周一、三、四”）。

最后，我们有一些我从未完全实现处理时区和夏令时的逻辑。这很困难，因为您必须允许有选择地应用班次。也就是说，一些日历项目将在最终用户本地保持时间，其他项目固定在一个位置，并且可能会或可能不会随着夏令时移动。我在解决这个问题之前离开了那家公司。

最后，我回复这个是因为我没有看到所有其他问题。:-) 但是去阅读并理解那个PDF。

# javascript - jQuery 工具提示 + ajax 内容

> ID：594897
> 
> 赞同：7
> 
> 时间：2009-02-27T14:09:54.573
> 
> 标签：javascript, jquery, ajax

我正在尝试为页面上的图像实现一个简单的翻转工具提示，当您翻转图像时，您会得到一个小工具提示窗口并通过 AJAX 从数据库加载内容。

我可以快速将其破解，但我想要一种不使用任何内联 JS 的优雅方式。

所以我的问题是：如果我在外部 .js 文件中捕获翻转事件，如何将数据库 ID 传递给它？

我正在使用 jQuery，所以我会做这样的事情：

```
$('.item_roll').mouseover(function() {
  //show tooltip and load ajax content
} 
```

我的 HTML 会是这样的：

```
<img src="thumb.png" class="item_roll" /> 
```

如果不从 img 标签调用函数，如何在数据库 id 上方发送 JS 调用？我希望这是有道理的。

谢谢。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-27T14:19:13.583

我建议在图像标签中同时包含一个类和一个 id：

```
<img src="thumb.png" id="id_28436379" class="item_roll" /> 
```

然后在您的 jQuery 事件中，您可以像这样访问它：

```
$(".item_roll").mouseover(function(event){
    alert( event.target.id.split("_")[1] );  // displays 28436379
}); 
```

这应该让您通过将其设置为图像标签的 id 来访问数据库 id。

编辑：在阅读了一些有用的评论后，我更改了答案，以便 id 不以整数开头，因为这是非标准的，并且可能不适用于所有浏览器。如您所见， split/[] 代码从 id 字符串中提取 id 号。

# asp.net-mvc - ASP.NET MVC 控制器动作设计

> ID：594898
> 
> 赞同：9
> 
> 时间：2009-02-27T14:10:40.093
> 
> 标签：asp.net-mvc, model-view-controller, rest

我真的很喜欢 ASP.NET MVC 的工作方式。我很想在所有新的 Web 项目中实现它，但是前几天我在原型中遇到了一个问题，我真的没有找到一个好的解决方案，所以我问你，你将如何设计一个 MVC 应用程序这不符合典型的 REST 模式？例如，我正在设计的原型会有多个页面，但这些页面本身并不一定绑定到域模型。例如，以一个简单的注册站点为例，它可能有以下页面：

*   /默认.aspx
*   /注册.aspx
*   /谢谢你.aspx

有时，此类程序可能需要管理部分来处理诸如审核注册或查看数据之类的详细信息。在标准的 ASP.NET Web 应用程序中，我可能会添加以下内容

*   /Admin/Default.aspx
*   /Admin/ListRegistrations.aspx
*   /Admin/ViewReports.aspx ...

在这种情况下，如果有两个控制器，例如：

*   首页->首页
*   首页->注册
*   首页->谢谢
*   管理->索引
*   Admin->ListRegistrations
*   管理员->报告

子控制器和区域还没有真正可靠的实现，这使我对此感到沮丧。我知道 Phil Haack 制作的“Areas”原型，但它不是很成熟，坦率地说，我不确定我是否喜欢它的设置方式，但我真的不知道我喜欢什么也可以看到这项工作。

我想当我想到 MVC 时，我也倾向于想到 REST，并且让控制器动作代表页面而不是实际的实体或动作并不适合我。你怎么看？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-27T14:20:51.677

MVC 新手犯的一个错误是出于显示原因将操作分组到控制器中。在您的情况下，不要将 Register 和ThankYou 操作与主页分组，而是尝试将它们分离到 AccountController 中，就像 MVC 团队在示例项目中所做的那样。您可以使用路由来设置最终用户想要的 URL。

至于您的其他操作，ReportController 怎么样？然后，您可以另外拥有一个 AdministrationController，其索引操作/视图包含指向各种管理操作的链接，包括 ReportController 上的那些。

**简短版：**按功能将操作分组到控制器中，而不是站点导航。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-27T14:37:30.420

我通常放弃“Home”控制器作为项目中的第一件事，并用“Page”控制器替换它。我将那个用于“只是”一页的任何内容。诸如“常见问题解答”、“联系我们”等之类的内容。我这样做至少部分是因为 Home 控制器的默认方法需要在每次您需要一个基本的静态页面时添加一个新方法。

在那个控制器中，我只有一个动作：显示。该操作为所有这些页面提供了相同的上下文对象。实际上，我使用查找“slug”将这些页面的内容存储在数据库中，并将其绑定到 NVelocity 模板中，但即使只是静态 HTML 或文件中的 NVelocity 模板也可以。

其他任何东西，就像其他人所说的那样，被管理的“事物”分成控制器。因此，一个 ReportController、User 或 AccountController、CartController 等。然后这些操作就更有意义了。

当您谈论列出注册用户时，它实际上是用户列表，所以我有一个 UserController 并执行 /User/Display/Registered/MostRecent 或类似的操作。对于注册本身， /User/Register 将发布到 /User/SaveRegistration ，而 /User/SaveRegistration 又可以从那里重定向到 /User/DisplayProfile/NewUserID 或 /Page/Display/Home 。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-28T13:26:50.160

您始终可以将 ASP.NET Web 窗体与 MVC 混合使用。

只需添加

```
routes.IgnoreRoute("Pages/{*path}"); 
```

到您的路由表并将传统的 Web 表单页面添加到`Pages`应用程序的文件夹中。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-27T14:16:04.810

您可以拥有尽可能多的控制器；这种布局看起来很合理。*请注意，*路由不必直接映射到 {controller}/{action}，但它使事情变得简单。对我来说看起来不错 - 除了我可能会有ThankYou 作为视图 - 即注册 [GET] 可能使用不同的视图来注册 [POST]

# wpf - 为什么这个 WPF 按钮会延伸到整个窗口？

> ID：594900
> 
> 赞同：6
> 
> 时间：2009-02-27T14:11:04.087
> 
> 标签：wpf, xaml

下面的按钮始终扩展为与 TextBlock 一样宽。我试过 StackPanel、DockPanel、Width="Auto" 等。

如何使按钮扩展到**其自身文本的大小**（如在 HTML 中）而不是其环境中的文本大小？

```
 <DockPanel HorizontalAlignment="Left">
        <Button x:Name="ButtonFavorite"
                DockPanel.Dock="Top"  
                Content="Customers" 
                Margin="10" 
                Width="Auto"
                Click="ButtonFavorite_Click">
        </Button>

        <TextBlock DockPanel.Dock="Top" Text="this is a long text which makes the button stretch across the window, if this text is just a couple words, the button will be smaller, and this drives me up the wall"  Margin="10" TextWrapping="Wrap" />

    </DockPanel> 
```

# 回答：

谢谢格雷格，做到了。这是现在可以使用的完整 XAML，您可以右键单击该按钮以更改其内容，以便查看该按钮是否适当地展开和收缩。

```
<Window x:Class="Test3784234.Window1"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    Title="Window1" Height="300" Width="300">
    <DockPanel HorizontalAlignment="Left">
        <StackPanel DockPanel.Dock="Top" Orientation="Horizontal" >
            <Button x:Name="ButtonFavorite"
                    Padding="5"
                    Cursor="Hand" 
                    DockPanel.Dock="Top"  
                    Content="Customers" 
                    Margin="10" 
                    Click="ButtonFavorite_Click">
                <Button.ContextMenu>
                    <ContextMenu>
                        <MenuItem x:Name="menuItemReports" Header="Reports" Click="MenuItem_Click" />
                        <MenuItem x:Name="menuItemContracts" Header="Contracts" Click="MenuItem_Click"/>
                        <MenuItem x:Name="menuItemCustomers" Header="Customers" Click="MenuItem_Click" />
                        <MenuItem x:Name="menuItemDocumentation" Header="Documentation Creation Instructions" Click="MenuItem_Click" />
                        <MenuItem x:Name="menuItemEmail" Header="E-Mail" Click="MenuItem_Click" />
                    </ContextMenu>
                </Button.ContextMenu>
            </Button>

        </StackPanel>

        <TextBlock x:Name="TheMessage" DockPanel.Dock="Top" Text="Right-click the 'favorites' button to change its function." Margin="10" TextWrapping="Wrap"/>

    </DockPanel>
</Window> 
```

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-02-27T14:41:20.800

您需要做的就是在按钮上设置 Horizo​​ntalAlignment 属性。它默认拉伸，因此会填充可用空间。

```
<Button x:Name="ButtonFavorite"
        HorizontalAlignment="Left"
        Content="Customers" 
        Margin="10" 
        Width="Auto"
        Click="ButtonFavorite_Click"> 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-02-27T14:28:12.580

关于您对按钮大小的烦恼，这似乎是针对设计人员/开发人员工作流程中的设计人员的，而您显然正在处理开发人员部分。为了开发，我总是在我的 App.xaml 中应用一些样式来确保更好的按钮大小。例如，在 app.xaml 文件的应用程序标记中：

```
<Application.Resources>
  <Style TargetType="Button">
    <Setter Property="MinWidth" Value="60" />
    <Setter Property="MinHeight" Value="23" />
    <Setter Property="Margin" Value="3" />
  </Style>
</Application.Resources> 
```

关于您的实际问题：

问题是您的 DockPanel 正在拉伸到文本的宽度，并且按钮自然会扩展以填充可用区域。如果您想要快速而肮脏的解决方案，您可以执行以下操作：

```
<DockPanel HorizontalAlignment="Left">
    <Button x:Name="ButtonFavorite"
            DockPanel.Dock="Top"  
            Content="Customers" 
            Margin="10" 
            Width="Auto"
            MaxWidth="100"
            Click="ButtonFavorite_Click">
    </Button>
</DockPanel> 
```

注意最大宽度。如果您想要更可组合的结果，请将您的按钮隔离在另一个面板中。（我正在使用堆栈面板，因为我相信其他人已经在他们的示例中使用了网格）：

```
<DockPanel HorizontalAlignment="Left">
    <StackPanel DockPanel.Dock="Top" Orientation="Horizontal">
        <Button x:Name="ButtonFavorite"
            Content="Customers" 
            Margin="10" 
            Width="Auto"
            Click="ButtonFavorite_Click" />
    </StackPanel>
    <TextBlock DockPanel.Dock="Top" Text="this is a long text which makes the button stretch across the window, if this text is just a couple words, the button will be smaller, and this drives me up the wall"  Margin="10" TextWrapping="Wrap" />
</DockPanel> 
```

在这种情况下，我喜欢 StackPanel，因为我发现自己使用它来沿着 Form-err-Window 右上角的底部创建水平“栏”按钮。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-27T14:30:24.150

您可以尝试通过将按钮放在另一个面板中来将其与主面板隔离。

```
<DockPanel HorizontalAlignment="Left">
    <Grid DockPanel.Dock="Top">
        <Button x:Name="ButtonFavorite"
                Content="Customers" 
                Margin="10" 
                Width="Auto"
                Click="ButtonFavorite_Click">
        </Button>
    </Grid>

    <TextBlock DockPanel.Dock="Top" Text="this is a long text which makes the button stretch across the window, if this text is just a couple words, the button will be smaller, and this drives me up the wall"  Margin="10" TextWrapping="Wrap" />

</DockPanel> 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-27T14:20:31.023

你能把它们放在一个两列网格中，按钮只跨越一列，文本跨越两列吗？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-27T14:42:01.890

这是一个使用 Grid 布局与 DockPanel 的示例。这个想法是有 2 列和 2 行。将 Button 放在一个单元格中，并使该行/列对自动调整大小。然后将 TextBox 放入第二行并让它跨越两列。这基本上会使右上角的单元格只是填充空间，并将实现您正在寻找的行为。

```
<Grid>
    <Grid.ColumnDefinitions>
        <ColumnDefinition Width="Auto" />
        <ColumnDefinition Width="*" />
    </Grid.ColumnDefinitions>
    <Grid.RowDefinitions>
        <RowDefinition />
        <RowDefinition />
    </Grid.RowDefinitions>

    <Button 
        x:Name="ButtonFavorite"
        Grid.Column="0"
        Grid.Row="0"
        Content="Customers" 
        Margin="10" 
        Width="Auto"
        Click="ButtonFavorite_Click">
    </Button>

    <TextBlock 
        Grid.Column="0"
        Grid.ColumnSpan="2"
        Grid.Row="1"
        Margin="10" 
        TextWrapping="Wrap"
        Text="this is a long text which makes the button stretch across the window, if this text is just a couple words, the button will be smaller, and this drives me up the wall" />
</Grid> 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-04-13T11:04:31.397

作为执行此操作的另一种方法：您可以更改按钮的模板，使其基本上包裹在居中的 StackPanel 中。像这样的东西：

```
<Button Content="Back">
    <Button.Template>
        <ControlTemplate>
            <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                <Button Content="{TemplateBinding Content}"></Button>
            </StackPanel>
        </ControlTemplate>
    </Button.Template>
</Button> 
```

或者，您可以向 app.xaml（或您存储全局样式的任何其他位置）添加样式，如下所示：

```
<Style TargetType="{x:Type Button}">
    <Setter Property="Template">
        <Setter.Value>
            <ControlTemplate>
                <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                    <Button Style="{x:Null}" Content="{Binding Path=Content, RelativeSource={RelativeSource AncestorType={x:Type Button}} }" FontWeight="Bold" Padding="5"></Button>
                </StackPanel>
            </ControlTemplate>
        </Setter.Value>
    </Setter>
</Style> 
```

请注意，`Style="{x:Null}"`如果添加到全局样式，则在模板中包含按钮上的属性很重要，否则在渲染按钮时会出现无限循环。

# c++ - 切换到 Linux 进行 Windows 开发，这是个坏主意吗？

> ID：594903
> 
> 赞同：6
> 
> 时间：2009-02-27T14:11:37.317
> 
> 标签：c++, windows, linux, cross-platform, development-environment

我正在考虑从 Windows 环境切换到 Linux 进行 C++ 开发。这是一个坏主意吗？我的工作场所为我们的项目使用 Windows 和 Visual Studio（一些 C# 和 java，但现在我只使用 C++ 进行开发）。如果他们决定让我参与 C# 项目，开发是否仍然可行（单声道？）？这种转型有哪些困难？

我在他们的项目上工作会有问题吗？反之亦然？我在某处读到预编译的标头等（我们确实使用它们）和编码（制表符/空格，行尾等）会有问题。

如果进行此切换不是太难，我该如何开始？IDE？vim+制作？

谢谢。

顺便说一句，我们主要制作 Windows 软件..

* * *

编辑：谢谢大家，我想这是有道理的..

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2009-02-27T14:15:35.137

这是个坏主意。我至少可以看到两个原因：

*   在您为其编写软件的同一操作系统上进行开发
*   Visual Studio 摇滚

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-02-27T14:17:27.630

如果您正在为 C++ 和 C# 进行开发，请坚持使用 Windows。Visual Studio 调试器绝对出色，而且似乎大多数 Linux IDE 都没有可比性（Java 的 Eclipse 除外）。此外，如果您在 Linux 上，您可能会使用不同的编译器，这可能会导致*非常*奇怪的错误。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-27T14:28:34.390

我是 Mac 用户（前 FreeBSD 人），所以我理解你的直觉。简而言之：您将要使用 Visual Studio。它是您的 C# 项目的最佳工具。它也是您以 Windows 为中心的 C++ 编程的最佳工具。即使不是，如果您不运行要运行的操作系统，您的测试也会受到影响。

从好的方面来说，始终在虚拟机中进行开发。尤其是在 Windows 上。使用源代码控制并经常为您的虚拟机拍摄快照。执行此操作时，无论您在主机上运行 Linux 还是 OS X 都没有关系。

干杯

尼克

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-27T14:19:28.780

这不是一个好主意，因为对单声道 Windows 窗体的支持尚未完成。Linux c# 开发人员通常将 GtkSharp 用于 GUI，这将为您的应用程序添加另一个依赖项，并且与 Windows 窗体有很大不同。但 GtkSharp 也不错。我特别喜欢 GTK 的包装盒功能，因为它使我的控件（错误、小部件）更容易正确调整大小并自动消除所有屏幕 DPI 问题。

但也有可能您的现有代码可能具有其他 Linux 上不存在的依赖项，尤其是使用 P/Invoke 调用的非托管代码。如果是这样的话，在 Linux 上进行开发可能是不可能的。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-27T14:43:18.957

我目前在 windows 和 linux 上开发。我发现在这两个（或更多）平台下编译相同的代码非常有用，因为由于 vc++ 和 gcc，您可以发现一些编码错误。当然，最重要的平台是您正在开发的平台。如果您的应用程序将在 Windows 上运行，请在同一平台上开发它，并且只有在您可以分配更多资源的情况下，尝试将其移植到 linux 或其他平台上。无论如何，在开发过程中考虑可移植性是一个好习惯，这意味着尽可能使用标准解决方案

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-27T14:21:41.567

我已经转向在 linux 上进行 Web 开发，这是我个人发现的

为了做正确的事情最终不会导致问题（使用特定的软件），我必须有一个虚拟机。对于我需要的软件来说，Wine 还不够稳定

同样出于我的特殊需要，只是整个“系统字体”不同导致了许多脚本问题 b/w windows 和 unix/linux

我要换回胜利。我喜欢 LINUX，但在我的大多数客户使用 Windows 和 IE 的专业领域......我需要用他们所拥有的东西来运行......我认为这是最聪明的生产力

（个人意见，非天意）

蒂姆

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-27T14:23:13.980

我建议坚持windows。Windows 非常适合 Windows 开发。Linux 是您可以编写跨平台内容/Linux 特定内容的地方（如果您愿意）。我尝试使用 Mono 来学习 C#，它适用于玩具示例，但不适用于 .NET 的某些部分。我切换回窗户。我无法想象切换到 Linux 是个好主意。我无意冒犯，这只是我的看法。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-02-27T14:46:18.120

如果你缺少很多 Linux ——并且你需要留在一个 Windows 机器上与你的团队和你的工作应用程序交互——安装[Cygwin](http://www.cygwin.com/)和[GNU Win32 工具](http://gnuwin32.sourceforge.net/)。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2011-03-23T23:03:27.530

如果你绝对在 Linux 上销售，VMWare 非常适合运行虚拟机，如果你使用 mingw 工具链编译你的 Linux/跨平台程序，添加单个依赖项，可以是静态的，你不应该得到任何窗口错误。

# ide - Linux 开发的 IDE 建议

> ID：594910
> 
> 赞同：5
> 
> 时间：2009-02-27T14:13:57.747
> 
> 标签：ide, linux-development

在你回答**vi**之前...我希望为主要具有 Windows/Visual Studio 背景的程序员设置一个开发环境。当然 Emacs 和 Eclipse 作为 IDE 会浮现在脑海中，还有其他有用的技巧吗？谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-27T14:22:36.167

好吧，如果你在做 Linux 内核工作，也许你会对 Torvalds 先生[对 emacs 的看法](http://marc.info/?l=git&m=122955159617722&w=2)感兴趣......

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-27T14:31:09.373

我认为编辑是偶然的。只需阅读制表符、缩进、函数与关键字、大括号的使用等方面的内核编码标准......你使用什么编辑器并不重要。

如果您认为您选择的编辑器会以某种方式改进您的代码或帮助您进入“区域”......您可能还没有准备好发送补丁。git-send-patch 的存在是因为很多人使用过多的不同编辑器。

如果你绑架了我，让我坐在任何版本的 emacs 前，然后用枪指着我的头，让我写代码，我会要求你开枪打死我。我没有反对 emacs，事实上，我仍然拥有为数不多的磁带上幸存的副本之一，这是我很久以前花了 50 美元得到的。

使用一个可以让您集中注意力的编辑器，简单而令人愉快的语法突出显示，良好的编辑功能，合理的键盘快捷键..一个方便的片段库，其余的取决于您。

或者，雪佛兰会比丰田提高你的驾驶性能吗（不得不在某个地方放一个稻草人的论据，毕竟这是在争论 Linux 开发）

本着这种精神，我现在要重新标记你的问题。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-27T14:20:39.400

根据[Linus FAQ](http://www.catb.org/~esr/faqs/linus/)，他使用 MicroEmacs。:-)

# asp.net - 关于 Linq To Sql 的一个问题

> ID：594919
> 
> 赞同：0
> 
> 时间：2009-02-27T14:16:26.320
> 
> 标签：asp.net, linq-to-sql

当我编写如下代码时，我收到以下错误消息：“不支持查询运算符'ElementAtOrDefault'。”

我该如何解决？

```
Dim tmpQuestion As New UIData
    Dim strViews = From t In tmpQuestion.LU_QUESTIONs _
                      Where t.ID_QUESTION = Request.QueryString("IdQuestion") _
                      Select t
    Dim mtViews = strViews(0).MT_VIEWS 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-27T14:26:43.410

您是否尝试过使用 FirstOrDefault() 然后检查以确保它不为空。我的 VB 语法可能是可疑的，但你明白了。

```
Dim strView = (From t In tmpQuestion.LU_QUESTIONS _
                    Where t.ID_QUESTION = Request.QueryString("IdQuestion") _
                    Select t).FirstOrDefault()

Dim mtViews as ...
If Not strView Is Nothing
   mtViews = strView.MT_VIEWS
EndIf 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-27T14:28:02.253

你还没有真正询问过。strViews 不是结果集，而是***查询***。您需要实际检索一些数据。

```
var chosen = strViews.FirstOrDefault(); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-27T14:23:16.337

我不是 VB 或 LINQ2SQL 方面的专家，但这与您说 strViews(0).MT_VIEWS 而 strViews 有可能为空的事实没有任何关系吗？

# sharepoint - xslt超链接，将url和descption分开

> ID：594920
> 
> 赞同：2
> 
> 时间：2009-02-27T14:16:34.167
> 
> 标签：sharepoint, xslt

我在共享点中有一个带有超链接列的列表。

我将此列表放入 xml 并将 xslt 应用于它。

xml 以以下形式生成输出：

```
<link>http://www.foo.com, http://www.foo.com</link> 
```

如何使用 xslt 显示此链接？

谢谢

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-27T14:23:50.763

怎么样：

```
<xsl:template match="link">
  <a href="{substring-before(.,',')}">
    <xsl:value-of select="substring-after(.,',')"/>
  </a>
</xsl:template> 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-27T14:28:12.673

对于 XSLT 2.0

```
<xsl:template match="link">
    <xsl:element name="a">
      <xsl:attribute name="href">
         <xsl:value-of select="substring-before(.,',')"/>
      </xsl:attribute>
         <xsl:value-of select="substring-after(.,',')"/>
     </xsl:element>
 </xsl:template> 
```

尽管它的可读性稍差，但当样式表变大时，扩展语法被认为是一种很好的做法。通过 XPath 操作文字结果元素不像 xsl:element/xsl:attribute 那样容易

# wpf - 为什么我在运行时创建 WPF 按钮时未启用它？

> ID：594921
> 
> 赞同：1
> 
> 时间：2009-02-27T14:16:45.837
> 
> 标签：wpf, button

XAML：

```
<Window x:Class="WorkOut.ToggleButton"
xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
xmlns:s="clr-namespace:WorkOut.Code"        
Title="ToggleButton" Height="300" Width="300">
<Grid>
    <StackPanel Orientation="Vertical">
        <ToolBar Height="40" VerticalAlignment="Top">
            <Button Margin="0,3,0,3" Padding="2" HorizontalContentAlignment="Left"
                    Command="{x:Static s:MyCanvas.AddNewTab}"
                    CommandTarget="{Binding ElementName=MyCanvas}">
                <Button.Content>
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition />
                            <ColumnDefinition />
                        </Grid.ColumnDefinitions>
                        <TextBlock Margin="3" Text="Append New Tab" VerticalAlignment="Center" Grid.Column="1"/>
                    </Grid>
                </Button.Content>
            </Button>
        </ToolBar>
        <Grid x:Name="MyGrid">
        </Grid>               
    </StackPanel>
</Grid> 
```

代码：

```
public ToggleButton()
    {
        InitializeComponent();

        MyCanvas MyCanvas1 = new MyCanvas();
        MyCanvas1.Name = "MyCanvas";
        MyCanvas1.Background = System.Windows.Media.Brushes.LightBlue;
        MyCanvas1.Height = 100;
        MyCanvas1.Width = 100;
        MyCanvas1.HorizontalAlignment = HorizontalAlignment.Left;
        MyGrid.Children.Add(MyCanvas1);

        MyCanvas MyCanvas2 = new MyCanvas();
        MyCanvas2.Name = "MyCanvas";
        MyCanvas2.Background = System.Windows.Media.Brushes.Beige;
        MyCanvas2.Height = 100;
        MyCanvas2.Width = 100;
        MyCanvas2.HorizontalAlignment = HorizontalAlignment.Right;
        MyGrid.Children.Add(MyCanvas2);
    }
class MyCanvas : Canvas
{
    public static RoutedCommand AddNewTab = new RoutedCommand();
    public MyCanvas()
    {
        this.CommandBindings.Add(new CommandBinding(MyCanvas.AddNewTab, AddNewTab_Executed, AddNewTab_Enabled));
    }
    private void AddNewTab_Executed(object sender, ExecutedRoutedEventArgs e)
    {
         MessageBox.Show (this.Background.ToString());
    }
    private void AddNewTab_Enabled(object sender, CanExecuteRoutedEventArgs e)
    {
        e.CanExecute = true;
    }
} 
```

上面的代码在网格控件上创建了两个画布，并且禁用了工具栏中的 addnew 按钮，尽管它已绑定到 MyCanvas 元素。

可能是我采用了错误的方法...

任何帮助，非常感谢。

谢谢KJ

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-28T18:53:54.757

可能是因为您的命令返回 CanExecute() 错误，因为它没有命令目标。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-20T16:59:59.307

您是否尝试过设置事件已处理的 CanExecute 处理程序？

```
private void AddNewTab_Enabled(object sender, CanExecuteRoutedEventArgs e)    
{        
    e.CanExecute = true;    
    e.Handled = true
} 
```

# algorithm - 如何设计一种有效的最小上限搜索算法

> ID：594923
> 
> 赞同：2
> 
> 时间：2009-02-27T14:17:06.897
> 
> 标签：algorithm, search

假设您有一组具有已知下限和未知上限的数字，即 0, 1, 2, 3, ... 78，其中 78 是未知数。暂时假设数字之间没有差距。有一个耗时的函数`test()`可以测试一个数字是否在集合中。

**`test()`什么是找到集合中最高号码的有效方法（需要少量呼叫）？**

如果您知道上限是 75 +/- 25，该怎么办？

如果集合中的数字之间存在随机间隙，即 0、1、3、4、7、... 78，该怎么办？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-27T14:27:53.017

对于“无间隙情况”：

*   我假设这是一个固定大小的数字，例如 32 位 int
*   我们希望找到这样的 x `test(x) == true`，`test(x+1) == false`，对吗？

您基本上通过每次测试范围内的*中间**值*和相应地调整边界。这将给出一个解决方案（根据对*的调用次数*），其中是*潜在*集合的大小，而不是*实际*集合。这将比仅尝试 1、2、3... 用于小型集合要慢，但对于大型集合则要快得多。*`O(log N)`*`test()`*`X`*

 ***如果可能存在差距，所有这些都会下降，此时我认为除了“从绝对最高可能的数字开始，一直到`test(x) == true`最高数字”之外，没有任何可行的解决方案。据我所知，任何其他策略都会失败或更昂贵。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-27T14:24:05.973

你最好的选择是简单地通过`O(n)`复杂的集合，这还不错。

考虑到该集合没有排序（毕竟它是一个集合，这是给定的），每个`isInSet(n)`操作也需要，如果您选择任何算法在某个特定位置*刺激*该集合，则将您`O(n)`带到`O(n^2)`整个操作地方...

 *如果集合在您的控制范围内，一个更好的解决方案是简单地保持集合的最大值并在每次插入集合时更新它。这将`O(1)`适用于所有情况。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-27T14:33:35.733

1.  设置`Step`为 1
2.  设置`Upper`为`Lower + Step`
3.  如果`test(Upper)`为真，则设置`Lower`为`Upper`，乘以`Step`2 并转到第 2 点
4.  在这一点上，您知道那`Lower`在您的集合`Upper`中，而不在。您现在可以在 和 之间进行二进制搜索`Lower`以`Upper`找到限制。

这看起来像 O(log n * O(test)) 复杂度。

如果您知道`Upper`介于 50 和 100 之间，请在这两个值之间进行二进制搜索。

如果您有随机间隙并且您知道上限是最大 100，我怀疑您不能做得比从那里开始并逐个测试每个数字直到`test()`在您的集合中找到一个值更好。

如果您有随机间隙并且您*不*知道上限，那么您*永远*无法确定您找到了上限。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-27T14:20:32.753

也许您应该遍历它？这将是 O(n) 复杂的。我认为没有其他方法可以做到这一点。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-27T14:23:51.780

您事先知道设定尺寸吗？

实际上，我想您可能不会 - 否则第一个问题将是微不足道的。

如果您知道该系列有多大，那将会有所帮助。

1.  猜测最高值
2.  测试 - 如果在则将值增加一些
3.  如果不在，则将值减少一些
4.  一旦你有了最大值的上限和下限，二分搜索直到你找到它（达到所需的精度）。

对于差距，你没有这样的能力——你甚至不知道什么时候找到了最大的元素。（除非您知道最大间隙大小）

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-27T14:33:33.627

如果没有间隙，那么您最好使用二分搜索。

如果我们使用第二个假设，即顶部是 75 +/- 25，那么低端是 50，高端是 100，我们的第一个测试用例是 75。如果存在，那么低端是 75，而高端是 100，我们的测试用例是 87。这应该会产生 O(ln N) 的结果（这里的 N 是 50）。

如果我们不能假设一个可能的上限，我们只需要对它可能是什么做出有根据的猜测。如果没有找到一个值，它就变成了高端。如果找到了，那就是低端，我们将其翻倍以找到高端。

如果有差距，我能看到的唯一方法是线性搜索——但即便如此，你也需要一种知道何时到达终点的方法，而不是一个很大的差距。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-27T14:41:05.857

如果你的集合恰好是素数的集合，当你找到最大的那个时告诉我。我相信我们可以解决一些问题。;)

但说真的，我猜你知道这个集合确实有一个最大值。或者，您将其切成 32 位整数。

几个建议：

1) 想一想所有可以加快 test(x) == false 结果的情况。然后你可以继续下一个。如果你花在所有弹射案例上的时间远远少于通过完整测试的时间，那么你就会领先。2) 你能从每次测试中获得任何信息吗？例如， test(x) == false 是否也意味着 test(x+5679) == false ？

# postgresql - 将 enable_nestloop 设置为 OFF 有什么陷阱

> ID：594930
> 
> 赞同：18
> 
> 时间：2009-02-27T14:18:02.637
> 
> 标签：postgresql

当我的表中有大量行时，我的应用程序中有一个查询运行得非常快。但是，当行数适中时（既不大也不小） - 相同的查询运行速度要慢 15 倍。

解释计划表明，对中等规模数据集的查询使用*嵌套循环*作为其连接算法。大型数据集使用*散列连接*。

我可以阻止查询规划器在数据库级别（postgresql.conf）或每个会话（`SET enable_nestloop TO off`）使用嵌套循环。

有哪些潜在的陷阱`set enable_nestloop to off`？

其他信息：PostgreSQL 8.2.6，在 Windows 上运行。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-02-27T14:24:25.850

> `enable_nestloop`设置为的潜在陷阱是`off`什么？

这意味着您将永远无法有效地使用索引。

而且您现在似乎不使用它们。

像这样的查询：

```
SELECT u.name, p.name
FROM users u
JOIN profiles p ON p.id = u.profile_id
WHERE u.id = :id 
```

很可能会`NESTED LOOPS`与`INDEX SCAN`on`user.id`和`INDEX SCAN`on一起使用`profile.id`，前提是您已经在这些字段上构建了索引。

具有低选择性过滤器的查询（即，需要的数据超过`10%`其使用的表中的数据的查询）将从`MERGE JOINS`和中受益`HASH JOINS`。

但是上面给出的查询需要`NESTED LOOPS`高效运行。

如果您在此处发布查询和表定义，则可能会对索引和查询性能做很多事情。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-27T15:24:57.793

在采取如此严厉的措施之前需要考虑的几件事：

*   将您的安装升级到最新的 8.2.x（现在是 8.2.12）。更好 - 考虑升级到下一个稳定版本，即 8.3 (8.3.6)。

*   考虑将您的生产平台更改为 Windows 以外的平台。PostgreSQL 的 Windows 端口虽然对开发目的非常有用，但仍无法与 Un*x 相提并论。

*   [阅读“规划器方法配置](http://www.postgresql.org/docs/current/static/runtime-config-query.html)”的第一段。这个[wiki 页面](http://wiki.postgresql.org/wiki/Performance_Optimization)可能也会有所帮助。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2010-12-30T21:35:47.563

我有完全相同的经历。大型数据库上的一些查询是使用嵌套循环执行的，耗时 12 小时！！！当它在关闭嵌套循环或删除索引时运行 30 秒时。

在这里有提示会很好，但我试过了

```
...
SET ENABLE_NESTLOOP TO FALSE;
... critical query
SET ENABLE_NESTLOOP TO TRUE;
... 
```

来处理这件事。所以你绝对可以禁用和重新启用嵌套循环使用，而且你不能与 9000 倍的速度增加争论:)

我遇到的一个问题是在 PgSQL/PL 过程中更改 ENABLE_NESTLOOP。我可以在 Aqua Data Studio 中运行 SQL 脚本，一切正常，但是当我将它放入 PgSQL/PL 过程中时，仍然需要 12 个小时。显然它忽略了变化。

# c# - 在 WCF 中为回调设置 receiveTimeout？

> ID：594931
> 
> 赞同：2
> 
> 时间：2009-02-27T14:18:15.973
> 
> 标签：c#, wcf

我使用 WCF 编写了大部分工作代码，其中客户端订阅服务器，服务器将数据推送到客户端。

我离开运行了一段时间，并试图将一些数据发送给客户端并得到一个异常，告诉我我必须设置 receiveTimeout 属性。

我在哪里可以设置这个属性？在我看到这个问题得到解决的所有地方，看起来 WCF 代码都是使用 svcutil.exe 生成的，我没有这样做，我真的不想从头开始。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-27T14:41:27.807

我已经发现了如何做到这一点，在创建管道客户端时，您必须明确设置绑定的超时时间。

```
NetNamedPipeBinding binding = new NetNamedPipeBinding();
binding.ReceiveTimeout = new TimeSpan(1,0,0);
binding.SendTimeout = new TimeSpan(1,0,0);
DuplexChannelFactory<IVdnServer> pipeFactory = new 
    DuplexChannelFactory<IVdnServer>(_subscriber, binding, 
        new EndpointAddress("net.pipe://localhost/PipeService")); 
```

当您创建服务端点服务器端时，您还必须明确设置超时。

```
NetNamedPipeBinding binding = new NetNamedPipeBinding();
binding.ReceiveTimeout = new TimeSpan(1,0,0);
binding.SendTimeout = new TimeSpan(1,0,0);

_host.AddServiceEndpoint(typeof(IVdnServer),binding , "PipeReverse"); 
```

# jquery - jquery 文档在外部脚本中准备就绪

> ID：594935
> 
> 赞同：11
> 
> 时间：2009-02-27T14:19:18.373
> 
> 标签：jquery, scripting, external, onload

我的页面有一个包含一些 jQuery 的外部脚本。除了这一点之外，它大部分都运行良好：

```
$(document).ready(function(){
    alert('x');                        
}); 
```

当我在 HTML 页面中而不是在 .js 文件中运行时，那段代码可以正常工作。我在 HTML 中没有其他库，我在 HTML 中有一个 window.onload 但如果我删除它，jQuery 位仍然不起作用。它不会产生任何错误信息。

有什么建议么？

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2009-02-27T14:28:10.287

由于这是[本次讨论](http://www.nabble.com/using-doc.ready-in-an-external-.js-file-td18349722s27240.html)中的问题，您确定在包含外部脚本**之前包含 jQuery 吗？**

```
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="externalScript.js"></script> 
```

# inheritance - ORM 继承

> ID：594961
> 
> 赞同：11
> 
> 时间：2009-02-27T14:25:19.497
> 
> 标签：inheritance, orm

有没有人*真正*想要并使用过 ORM 工具的继承支持，如果是的话，您认为哪一个提供了最好的支持？

还是 ORM 继承是一个“天上掉馅饼”的概念？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-27T14:48:38.757

我已经在 Hibernate 中使用了继承（还有一些在 Django 中），并且非常后悔。

“组合优于继承”原则对于域类尤其适用。虽然我同意在模型级别继承在少数情况下是有意义的，但在大多数情况下，继承会给您一个非常静态的域模型，其中一个对象将无法更改为另一个类。

我还发现大多数开发人员对数据库级别的继承概念并不满意，因此维护变得更加复杂。

最后，还有一些技术问题，比如 Hibernate 设置的代理会隐藏对象的实际类。它使“实例”的行为异常。当然，您可能会说“instance of”是一种代码异味，也许这是另一个暗示组合可能是更好的解决方案......

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-27T14:34:59.460

我非常喜欢这个问题。我使用 ORM 工具（Toplink，现在是 eclipselink，Hibernate）已经有一段时间了，我总是看到 JPA 文档中提到了这一点，但我从来没有真正需要它。基本上我的理念是 ORM 只是为了防止您编写冗长的代码来提取数据库的记录。这确实是一个巨大的节省时间，它可以防止你犯愚蠢的错误。当然你可以用它做一些花哨的东西，但为什么不把它保存到控制器（如果你遵循 MVC）而不是把它粘在模型中呢？

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-27T14:32:46.483

如果您指的是域类中的继承，我一直将它与 NHibernate 和/或 Castle ActiveRecord 一起使用，它们支持三种映射策略：

*   [http://nhibernate.info/doc/nh/en/#inheritance](http://nhibernate.info/doc/nh/en/#inheritance)
*   [http://old.castleproject.org/activerecord/documentation/trunk/usersguide/typehierarchy.html](http://old.castleproject.org/activerecord/documentation/trunk/usersguide/typehierarchy.html)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2016-02-03T05:10:31.260

如果您正在编写复杂的商业软件，那么您需要它。

假设您希望能够向个人或组织出售东西。在销售订单上，买方可能是其中之一。如果没有继承，你如何做到这一点？

使用继承，你会做这样的事情：

```
@Entity
@Inheritance
public abstract class Party {

  @Id
  private Long id;

  ...
}

@Entity
public class Individual extends Party {
  ...
}

@Entity
public class Organization extends Party {
  ...
}

@Entity
public class SalesOrder {

  private Party buyer;

  ...
} 
```

然后你可以这样做：

`salesOrder.setBuyer(someOrganization)`或者`salesOrder.setBuyer(someIndividual)`

# wcf - 在 WCF 服务上调用 Close() 之前，我是否应该检查是否已经关闭？

> ID：594965
> 
> 赞同：3
> 
> 时间：2009-02-27T14:25:57.967
> 
> 标签：wcf

在调用`Close()`我的 WCF 服务之前，我是否应该检查它是否尚未关闭？

IE

```
myWCFService.State != System.ServiceModel.CommunicationState.Closed 
```

我的代码如下所示：

```
MyServiceClient myWCFClient = null;

try
{
  myWCFClient = new .....();
}
catch
{
}
finally
{
   myWCFClient.Close();
} 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-27T14:29:02.437

WCF 客户端是一次性的，因此*除了一些注意事项外，*您可以使用`using`：

```
using(MyClient client = new MyClient()) {
    client.DoStuff();
    // etc
} 
```

但这有一个大问题；如果`Dispose`WCF 客户端出现故障（丢失原始异常），它实际上会抛出。[这里](http://www.iserviceoriented.com/blog/post/Indisposable+-+WCF+Gotcha+1.aspx)有一个很好的解决方法，或者我已经在此发表了[博客](http://marcgravell.blogspot.com/2008/11/dontdontuse-using.html)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-27T14:29:04.077

看看这个问题： WCF 客户端[阻止问题](https://stackoverflow.com/questions/573872/what-is-the-best-workaround-for-the-wcf-client-using-block-issue)[的最佳解决方法是什么？`using`](https://stackoverflow.com/questions/573872/what-is-the-best-workaround-for-the-wcf-client-using-block-issue)尽管您要寻找的不是逐字逐句的，但我认为他的示例会对您有所帮助。

# wcf - wsHttpBinding 和 ws2007HttpBinding 有什么区别？

> ID：594983
> 
> 赞同：16
> 
> 时间：2009-02-27T14:29:40.033
> 
> 标签：wcf, wshttpbinding

在 MSDN 上，我们可以阅读：

> WS2007HttpBinding 类添加了一个类似于 WSHttpBinding 的系统提供的绑定，但使用了结构化信息标准推进组织 (OASIS) 标准版本的 ReliableSession、Security 和 TransactionFlow 协议。使用此绑定时无需更改对象模型或默认设置。

但是我没有找到任何可以解释我为什么要将 wsHttpBinding 移动到 ws2007HttpBinding 的文档，在我看来标准是相同的。

有人可以给我一个很好的解释吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-27T14:38:11.353

绑定支持不同的协议。[MSDN 上的这个页面](http://msdn.microsoft.com/en-us/library/ms730294.aspx)实际上有一个很好的矩阵，它解释了 WCF 中的哪个绑定支持哪些协议。因此，如果您需要与实现 OASIS 协议的服务/客户端互操作，请使用 ws2007httpbinding 绑定，否则，没有理由不使用 wshttpbinding。

如果您想了解不同协议的详细信息，请查看他们的网站：[WC3](http://www.w3.org/)和[OASIS](http://www.oasis-open.org/home/index.php)。我确信有大量资源可以突出这些协议的差异。

不同的大型企业和[政府](http://74.125.47.132/search?q=cache:kQiGHFRxLAoJ:www.oasis-open.org/committees/download.php/1741/Interoperable%2520Services%2520SC%2520Charter,%2520Final.pdf+wc3+vs+oasis+protocols&hl=en&ct=clnk&cd=1&gl=us)需要使用 Web 服务，并且有不同的要求。因此，不同的标准是有意义的。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2011-06-05T17:41:35.087

从 OReilly 的书“Programming WCF services”（第 28-29 页）中，他们说 Ws2007HttpBinding 派生自 WsHttpBinding。它增加了对新兴标准的支持以及对交易、安全和可靠性标准的更新。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-27T14:50:50.170

使用最新标准听起来不错，但请记住，WS2007HttpBinding 仅受运行至少 .NET 运行时版本 3.5 SP1 或 3.0 SP1 的客户端支持。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-27T14:52:43.877

OASIS 定义的ws2007HttpBinding 是比wsHttpBinding 更新的版本。

它在 wsHttpBinding 的事务、可靠消息传递和 WS-Addressing 协议之上添加了 ReliableSession、Security 和 TransactionFlow 协议。

从简单绑定开始可能会更容易，如果将来需要，您始终可以在与旧版本共存的较新绑定中公开现有服务。

# asp.net-membership - 你能推荐一个asp.net Membership Manager Control吗

> ID：594992
> 
> 赞同：1
> 
> 时间：2009-02-27T14:31:47.877
> 
> 标签：asp.net-membership

我正在使用 Microsoft 的成员资格和角色提供程序构建一个 asp.net 2.0 网站。我需要一个良好的控制来管理我的用户。如果有可用的好东西，我不想自己构建控件。

昨晚我做了一些研究，发现了来自质量数据的会员管理器控制。我在我的项目中尝试过，效果很好。（[http://www.qualitydata.com](http://www.qualitydata.com)）。有没有人有其他的建议。

谢谢。

凯文

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-27T17:04:12.830

我必须先声明我没有使用过这个产品，但是，我总是喜欢把这个放在一起的人。我认为值得一看。[英雄会员](http://www.herocoder.com/Products/HeroMembership/)

# java - 如何使用 BorderLayout (Java) 使 JTextField 扩展

> ID：594994
> 
> 赞同：2
> 
> 时间：2009-02-27T14:32:44.627
> 
> 标签：java, swing

我有一个 Java 程序，其中我使用的是 JTextField，但如果我没有指定默认大小，它的宽度将为 0。我将它插入到 BorderLayout 中，那么我该如何制作它扩大以填满整个容器？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-27T15:49:39.263

在上面的示例中，文本字段可以正常工作。但是，如果您插入 EAST 或 WEST，它将不起作用。

```
import java.awt.BorderLayout;

import javax.swing.JFrame;
import javax.swing.JTextField;

public class TextFieldTest {
    public static void main(String[] args) {
        JFrame f = new JFrame();
        f.setLayout(new BorderLayout());
        JTextField tf = new JTextField();
        f.getContentPane().add(BorderLayout.EAST, tf);
        f.pack();
        f.setVisible(true);
    }
} 
```

我的问题是：这需要是 BorderLayout 还是您可以使用其他布局管理器？如果可以，您应该查看 GridBagLayout，您可以让元素自动扩展（使用权重）以适应整个容器。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-27T20:51:08.057

装满整个容器？使用边框布局？

```
container.add( jTextField, BorderLayout.CENTER ); 
```

就那么简单。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-27T19:08:15.543

使用 Swing 编程时，关键是使用好的布局管理器。对我来说，完美的布局管理器是[MigLayout](http://www.miglayout.com/)。这简直是​​满足所有布局需求的最佳一站式解决方案。他们的网站提供了出色的文档和示例。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-27T14:36:28.427

它会自动填充到容器的宽度，示例如下：

```
 import java.awt.BorderLayout;

import javax.swing.JFrame;
import javax.swing.JTextField;

public class TextFieldTest {
    public static void main(String[] args) {
        JFrame f = new JFrame();
        f.setLayout(new BorderLayout());
        JTextField tf = new JTextField();
        f.add(tf, BorderLayout.SOUTH);
        f.pack();
        f.setVisible(true);
    }
} 
```**************