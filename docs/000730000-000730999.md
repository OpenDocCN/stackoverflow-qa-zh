# StackOverflow 问答 000730000-000730999

# ruby-on-rails - Netbeans 和 Rails：有没有办法让 netbeans 中的 Run 选项也开始 thinking_sphinx？

> ID：730003
> 
> 赞同：0
> 
> 时间：2009-04-08T13:27:10.577
> 
> 标签：ruby-on-rails, netbeans

我不想让 sphinx 一直在我的开发机器上运行。`rake thinking_sphinx:start`当我通过 netbeans 运行我的应用程序时，我想要一种自动执行的方法。有没有办法做到这一点

[另外 - 我正在使用 Windows]

Thinking sphinx 需要作为一个单独的进程运行。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-16T15:26:32.927

您将需要一个名为 PsExec 的第三方程序来执行此操作。否则，您将无法在 Windows 上使用 Ruby 启动后台进程。

首先在[这里](http://technet.microsoft.com/de-de/sysinternals/bb897553.aspx)下载 PsExec 。解包（至少）`psexec.exe`并手动运行一次 - 您必须同意许可：-/。

之后将以下行添加到`script/server`您的 Rails 应用程序中：

```
system 'PATH_TO_PSEXEC/psexec -d rake.bat' 
```

现在，您使用命令创建`rake.bat`与服务器并行运行的命令。将包含以下内容的文件放入 Rails 应用程序的根目录。

```
rake thinking_sphinx:start 
```

这一行应该可以解决问题，但它可能会失败，例如当 NetBeans 的 JRuby 版本与主机上安装的 Ruby 不同时。或者，如果根本没有安装 Ruby。在这种情况下，您应该使用 JRuby 的完整路径调用 rake：

```
"PATH_TO_NETBEANS/ruby2/jruby-1.2.0/bin/jruby" "PATH_TO_NETBEANS/ruby2/jruby-1.2.0/bin/rake" thinking_sphinx:start 
```

现在启动服务器时，会弹出一个附加的 Windows 命令行，其中包含正在运行的 rake 任务。

不用说，您不应该将代码添加到`script/server`您的生产服务器上。

# c# - 对于每个循环迭代

> ID：730008
> 
> 赞同：7
> 
> 时间：2009-04-08T13:28:55.863
> 
> 标签：c#, enumeration

让我们假设我用来遍历节点列表的代码

```
foreach(XmlNode nodeP in node.SelectNodes("Property"))
{
  propsList.Add(nodeP.Attributes["name"].Value, true);
} 
```

在这种情况下，表达式 node.SelectNodes("Property") 是否在 for each 或一次的每次迭代期间得到评估？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-04-08T13:31:12.207

只有一次。foreach 语句是（在您的情况下）的语法糖......

```
{
    IEnumerator<XmlNode> enumerator = node.SelectNodes("Property").GetEnumerator();

    XmlNode nodeP;

    while(enumerator.MoveNext())
    {
        nodeP = enumerator.Current;

        propsList.Add(nodeP.Attributes["name"].Value, true);
    }

    IDisposable disposable = enumerator as IDisposable;

    if(disposable != null) disposable.Dispose();
} 
```

所以实际调用`SelectNodes()`只发生一次。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-08T13:33:01.857

看起来您在询问 C# / .NET。SelectNodes() 调用将进行一次，然后将从返回值（实现 IEnumerable）中检索枚举器。该枚举器是在循环期间使用的，不需要对 SelectNodes() 的后续调用。

# jquery - Javascript MVC框架（关注点分离）与asp.net MVC兼容吗？

> ID：730010
> 
> 赞同：5
> 
> 时间：2009-04-08T13:29:08.950
> 
> 标签：jquery, asp.net-mvc, javascriptmvc

任何人都有机会将 javascript MVC 框架与 ASP.NET MVC 一起使用？

基本上，如果可能的话，我正在寻找有关将它们一起使用的方法的建议，我无法摆脱我的 asp.net MVC 应用程序，但我很想对 javascript / Jquery 使用某种关注点分离...

有人用过这样的东西吗？我正在尝试将 2 组合在一起，因为 asp.net mvc 提供 VIEWS 可能 2 将不兼容....？？

还是只使用 javascript 的 OOP 扩展框架会更好，如果是这样……有人知道一个可以与 asp.net mvc 一起工作的好框架吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-15T20:10:14.520

我是 JMVC 的成员之一。是的，你可以同时使用这两个。我们建议使用 REST 服务来分离您的客户端/服务器层，因为它为您的数据提供了最清晰的分离。使用 REST，您可以通过对所有待办事项发出请求来使用客户端的数据，这些请求将以 JSON 形式返回。JavaScriptMVC 然后会调用一个回调到你的控制器，你会使用客户端模板（视图）来呈现数据。

两者绝对兼容，但这取决于您希望逻辑存在的位置。胖客户端有很多优点，包括可扩展性和可维护性。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-08-22T20:00:51.583

马克，我是 JMVC 的另一位贡献者。JMVC 旨在使用原始数据服务工作，但它可以戴很多帽子。

它基于瘦服务器架构。例如，不要在服务器和客户端上拆分创建视图，而是使用 asp.net 创建原始 JSON 数据，然后将其传递给 JavaScript，后者将使用其模板生成最终的 HTML 结构。

优点是您已经创建了一个可重用的服务，并且您的 UI 逻辑都在一个地方（客户端）。

但是，您不必以这种方式做事。您可以决定在哪里创建视图数据的最佳位置。

如果您的视图都是服务器端的（从客户端请求返回 HTML），您甚至可能不需要很多 JMVC 视图。你只会使用控制器。然而，控制器是 JMVC 中最好的部分。他们使用事件委托，因此您不必担心附加事件！

这是一篇文章，我在其中讨论了我们使用 Rails 的架构：

[http://javascriptmvc.com/blog/?p=68](http://javascriptmvc.com/blog/?p=68)

# vb.net - 32 位十六进制的前 16 位

> ID：730016
> 
> 赞同：0
> 
> 时间：2009-04-08T13:31:23.517
> 
> 标签：vb.net

请原谅我在这里缺乏知识，但有人可以让我知道如何获得 32 位十六进制数的前 16 位。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-08T13:34:05.880

这取决于您所说的“第一”是什么意思。给定一个数字，例如`0xdeadbeef`，您会考虑`0xdead`还是`0xbeef`“第一”？

如果是前者，则将数字除以 65536（作为整数）。如果是后者，则将模数计算为 65536。

这当然也适用于二元运算符，例如 shift/and，我只是不确定如何用您想要的语言表达它。我相信会有其他答案更精确的细节。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-08T13:35:53.723

假设首先，您的意思是最低价值？

如果 My32BitNumber 是 int

```
dim f16 as integer = &hFFFF and My32BitNumber 
```

如果您实际上正在查看一个 32 位数字，例如 Gee，那么 DEADBEEF 的前 16 位将是最后四个十六进制数字 BEEF

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-08T13:37:20.523

＆它与0xffff。

```
int input = 0xabcd;
int first2Bytes = input & 0xffff; 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-08T14:06:29.813

这将为您提供 32 位数字作为四字节数组：

```
Dim bytes As Byte() = BitConverter.GetBytes(number) 
```

要将前两个字节作为带符号的 16 位数字：

```
Dim first As Int16 = BitConverter.ToInt16(bytes, 0) 
```

要将前两个字节作为无符号 16 位数字：

```
Dim first As UInt16 = BitConverter.ToUInt16(bytes, 0) 
```

这当然比使用位移或除法要慢一些，但它可以正确处理符号位（最高有效位），使用位移或除法可能会遇到问题。

您还可以将前两个字节作为 16 位无符号数并将其分配给整数：

```
Dim first As Integer = BitConverter.ToUInt16(bytes, 0) 
```

（获取一个有符号的 16 位数字并分配给一个整数意味着符号位也将被复制到整数的前 16 位，这可能是不希望的。）

如果您想要最后两个字节（最低有效）而不是前两个（最高有效），只需将`ToUInt16`/`ToInt16`调用中的索引从 0 更改为 2。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-08T20:41:45.213

```
 Dim i As Integer = &HDEADBEEF
    Dim s16 As UShort
    s16 = i And &HFFFF 'BEEF

    'or
    s16 = (i >> 16) And &HFFFF 'DEAD 
```

# django - 找不到设置 Django 安装位置的文件

> ID：730017
> 
> 赞同：-1
> 
> 时间：2009-04-08T13:31:31.270
> 
> 标签：django

我在 /home/masi/mySite 安装了 Django。

**如何设置文件夹*/home/masi/public_html/mySite*中的文件使用 Django 安装？**

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-08T13:41:14.630

```
<location "/">

    SetHandler python-program

    PythonHandler django.core.handlers.modpython

    SetEnv DJANGO_SETTINGS_MODULE myproject.settings

    PythonPath "['/home/masi/public_html'] + sys.path"

</location> 
```

在 http.conf 中，python 路径将指定 django 项目的位置。

[http://www.djangoproject.com/](http://www.djangoproject.com/)也提供了很好的文档。

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2012-05-07T17:15:00.363

您也可以使用 .htaccess 文件

```
SetHandler python-program 
PythonHandler django.core.handlers.modpython 
SetEnv DJANGO_SETTINGS_MODULE yourproject.settings 
PythonDebug On 

PythonPath "['/your/project/path'] + sys.path" 
```

# c# - Winapp (c#) 调用 java app -> 设置进度条

> ID：730019
> 
> 赞同：0
> 
> 时间：2009-04-08T13:31:58.880
> 
> 标签：c#, java, winforms

我有一个与 java 应用程序通信以通过 tcp 检索数据的 C# winapp。现在我想为等待添加一个进度条，并显示数据的下载正忙。因为此时winapp会冻结，直到它拥有来自java的所有数据。

现在我想知道如何编程。因为我假设java应该不时返回一些东西来设置c#中的进度条。

我想我需要用线程来做，但我不确定如何去做。

如果有人有其他想法或例子，那就太好了。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-08T13:35:56.687

[`BackgroundWorker`](http://msdn.microsoft.com/en-us/library/system.componentmodel.backgroundworker.aspx)几乎可以肯定是您在 WinApp 方面想要的。[`ReportProgress`](http://msdn.microsoft.com/en-us/library/system.componentmodel.backgroundworker.reportprogress.aspx)方法和[`ProgressChanged`](http://msdn.microsoft.com/en-us/library/system.componentmodel.backgroundworker.progresschanged.aspx)事件用于处理更新进度条。

但是，您需要弄清楚如何确定实际完成了多少进度。如果您让我们更多地了解 Java 应用程序在做什么，我们可以提供更多帮助。

# jquery - ExtJs 可排序元素列表

> ID：730026
> 
> 赞同：2
> 
> 时间：2009-04-08T13:33:45.507
> 
> 标签：jquery, user-interface, drag-and-drop, extjs, jquery-ui-sortable

与 JQuery UI .sortable 一样，ExtJs 中是否有任何可排序列表的实现？或者我如何使用 jQuery UI sortbale 从 ExtJs 布局的东部面板将元素拖放到布局的中央面板中的可放置可排序元素？现在拖动元素隐藏在布局下:(

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2014-12-02T10:16:33.703

接近可排序列表的最简单的 ExtJS 示例是这个 [可重新排序的工具栏]( [http://dev.sencha.com/ext/5.0.1/examples/toolbar/reorderable.html](http://dev.sencha.com/ext/5.0.1/examples/toolbar/reorderable.html)示例。

接下来，有一个[在树之间拖放](http://dev.sencha.com/ext/5.0.1/examples/tree/custom-drop-logic.html)的例子，可以很容易地修改它来模拟一个列表。

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2009-05-05T17:42:51.070

您可能希望查看 Ext 的 Sortable 用户扩展，而不是组合两个单独的库

[http://extjs.com/learn/Extension:Sortable](http://extjs.com/learn/Extension:Sortable)

# jquery - Show/Hide table elements that were randomly generated using click event

> ID：730028
> 
> 赞同：1
> 
> 时间：2009-04-08T13:34:31.557
> 
> 标签：jquery, html

I have multiple tables that are randomly generated. I only want the first row of each table displayed with the rest of the rows hidden. When I click on the visible row for a table I want the rest of its rows/contents to show/hide. How would I accomplish this using Jquery?

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-08T14:30:31.160

To hide all the rows but the first:

```
$("table tbody tr:not(:first-child)").hide(); 
```

To make them visible when you click on the first row:

```
$("table tbody tr:first-child").click(function() {
  $(this).siblings().show();
}); 
```

Alternatively you may want to organise your tables slightly differently (if possible):

```
<style type="text/css">
table tbody tr { display: none; }
</style>
<script type="text/javascript">
$(function() {
  $("table thead tr").click(function() {
    $("tbody tr", $(this).parents("table")[0]).show();
  });
});
</script>
<table>
<thead>
  <tr> ... first row is in thead not tbody ... </tr>
</thead>
<tbody>
  <tr> ... row1 .. </tr>
  <tr> ... row2 .. </tr>
  <tr> ... row3 .. </tr>
</tbody>
</table> 
```

There are lots of ways to skin this particular cat.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-08T13:44:36.137

You should write some functions like this:

```
function AttachEvent(tableId)
{
    $("#" + tableId + " tbody tr:first-child").click(ToggleRows);
}

function ToggleRows(e)
{
    // get src table of e
    // you can find code for this on SO or quirksmode.org (or basically anywhere)

    $(src).find("tr").hide();
    $(src).find("tr:first-child").show();
} 
```

If you call AttachEvent with the id of the table when it is generated, it will bind the event to the first row.

These functions assume that the table is generated with all the rows except row[0] set to display:none.

I haven't tested this, but the theory should work. You may need to change some things like which event to bind, and whether to use the tr or the tds for showing/hiding.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-04-23T08:56:45.967

I ran into a similar need, but show/hide tbody (jQuery seemed to crash when trying to toggle lots of rows). My tables are identified by class 'datatable' and I use .toggle() (available since jQuery version 1.0) based on Cletus' solution:

```
$(document).ready(function() {
        //SK toggles datatables (show/hide tbody when clicking thead)
       $('table.datatable thead tr').on('click', function( event ) { 
           $('tbody', $(this).parents('table')[0]).toggle(); });

}) 
```

this assumes you have your tables organised according to html5 spec with thead and tbody. see also [http://api.jquery.com/toggle/](http://api.jquery.com/toggle/)

# parsing - 同一个应用程序中是否可以有两个或多个 Lex/Yacc 解析器

> ID：730029
> 
> 赞同：8
> 
> 时间：2009-04-08T13:34:32.760
> 
> 标签：parsing, bison, yacc, lex, flex-lexer

我有一个应用程序，其中我已经有一个用于一种语法的解析器，我需要为另一个目的添加第二种不同的语法。

是否可以拥有多个？

如果是这样，你如何获得另一个入口点？

谢谢

*大卫艾伦芬奇*

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-04-08T13:36:54.767

我认为您可以通过使用`--name-prefix`Bison`--prefix`选项和 Flex 选项来实现这一点。

在这两种情况下，它们都允许您将`yy`生成的函数上使用的默认“”前缀替换为您自己选择的前缀。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-08T13:39:20.487

是的，这是可能的。

yacc 应该有一个 -p 标志，您可以在其中指定不同的前缀而不是默认的“yy”。

lex 生成的文件只包含一个外部使用的符号：yylex。例如，您可以使用 -Dyylex=mySecondLex 进行编译。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-08T13:47:47.797

不是直接的答案，但您可能需要考虑使用更通用的方法，例如[GoldParser](http://www.devincook.com/goldparser/ "GOLD解析系统")，它允许您使用通用引擎来处理从语法生成的 LALR 和 DFA 表。

这样一来，您可以在同一个应用程序中使用任意数量的不同语法，并且更改语法不会创建新的源代码，而只会创建新的表格文件（可以作为嵌入式资源或类似资源包含在内）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-08T14:08:54.673

标准 lex 和 yacc 无法做到这一点。Flex 和 Bison 和其他一些实现一样。既然您（在评论中）说您没有使用 flex 和 bison，那么您使用的*是*哪个版本的 lex 和 yacc ？

# asp.net - ASP.NET 验证

> ID：730032
> 
> 赞同：0
> 
> 时间：2009-04-08T13:35:37.373
> 
> 标签：asp.net, jquery

我想验证一个带有 min char=3、max=10 且没有特殊字符的 asp.net texbox。我不想使用 jQuery 的插件，而是使用普通的 jQuery

```
<asp:TextBox ID="TextBox1" runat="server"></asp:TextBox> 
```

我该怎么办。

PS - 我之前问过这个问题然后编辑了它，但现在找不到问题。好像没有发帖。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-08T13:39:06.820

在 asp.net 中，您可以使用验证控件。自定义验证器或 reg ex 验证器。

像这样的东西

```
<asp:RegularExpressionValidator ID="RegularExpressionValidatorEmail" runat="server"
        ControlToValidate="TextBox1" ErrorMessage="Error error..."
        ValidationExpression="\w+([-+.']\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*" Display="Static" ></asp:RegularExpressionValidator> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-08T13:40:37.783

为什么不使用 Regex 模式 " `[\w]{3, 10}`" 的 RegularExpressionValidator 呢？

# c - C 数组显示垃圾数据（内存问题？）

> ID：730033
> 
> 赞同：0
> 
> 时间：2009-04-08T13:35:38.450
> 
> 标签：c, arrays, memory, multidimensional-array

我正在为我从计算机的并行端口驱动的 8x8 LED 矩阵制作驱动器。它应该是一个时钟，灵感来自我在 Tokyoflash 上看到的一个设计。

驱动程序的一部分是绘制到矩阵的 3*5 数字“精灵”数组。矩阵的坐标被分配给精灵的坐标等等，直到整个精灵都被绘制在上面。对具有偏移的另一个数字重复此过程。我已经验证我已经正确绘制了精灵，并且矩阵在写入时是空白的。但是，当我在矩阵上绘制一个数字时，我在 Numpad6 处得到错误的 1，左侧数字为 Numpad1，右侧为 Numpad1（[未绘制左侧数字的示例。](http://img7.imageshack.us/img7/8490/hahawhattehf.png)）

我有一周的 C 经验，这让我很困惑。

如果您想自己编译，这里是完整的驱动程序。它远未完成。

```
//8x8 LED MATRIX DRIVER VER 0.1 APR062009
//CLOCK 
// 
//  01234567
// 0    BXXXXXXH  B: Binary Mode Indicator 
// 1    DXXXXXXM  D: Decimal Mode Indicator
// 2    NNNNNNNN  H: Hour Centric Display
// 3    LLLNNRRR  M: Minute Centric Display
// 4    LNLNNRNR  X: Secondary Information 
// 5    LLLNNRRR  L: Left Digit
// 6    LNLNNRNR  R: Right digit
// 7    LLLNNRRR  N: Not Used

#include <stdio.h>
#include <unistd.h>
//#include <math.h>
#include <time.h>
#include </usr/include/sys/io.h>

#define BASEPORT 0x378

int main()
{
//Increasing array parameters to seems to reduce glitching [best 10 5 3]
int Dig[10][5][3] = {0};    //ALPHANUMERIC ARRAY [NUMBER (0..9)][Y(0..4)][X(0..2)]
int Mat[7][7] = {0};        //[ROW][COL], Top L corner = [0][0]
int Aux1[7] = {0};      //Topmost Row
int Aux2[7] = {0};          //Second to Topmost Row
int Clk;    //Clock
int Wait;   //Delay; meant to eventually replace clock in its current state
int C1;     //Counters
int C2;
int C3;
int L;      //Left Digit
int R;      //Right Digit
//break string left undefined atm

//ioperm (BASEPORT, 3, 1);
//outb(0, BASEPORT);
printf("Now running.\n");

//Set Variables

//3D DIGIT ARRAY [Num][Row][Col] (INITIALIZED BY INSTRUCTIONS)
    //Dig array is meant to be read only once initialized
    //3D arrays are unintuitive to declare so the numbers are 
    //"drawn" instead. 

//Horizontals
    //Some entries in the loop may have the variable in the middle
    //coordinate instead of the 3rd and/or with a +2\. This is to 
    //incorporate the incomplete columns some numbers have (eg "2") and 
    //saves coding additional loops. 

for(C1=0; C1<=2; C1++){
Dig[0][0][C1]=1; Dig[0][4][C1]=1;
Dig[2][0][C1]=1; Dig[2][2][C1]=1; Dig[2][4][C1]=1; Dig[2][C1][2]=1; Dig[2][C1+2][0]=1;
Dig[3][0][C1]=1; Dig[3][2][C1]=1; Dig[3][4][C1]=1;
Dig[4][2][C1]=1; Dig[4][C1][0]=1; 
Dig[5][0][C1]=1; Dig[5][2][C1]=1; Dig[5][4][C1]=1; Dig[5][C1][0]=1; Dig[5][C1+2][2]=1;
Dig[6][0][C1]=1; Dig[6][2][C1]=1; Dig[6][4][C1]=1; Dig[6][C1+2][2]=1;
Dig[7][0][C1]=1;
Dig[8][0][C1]=1; Dig[8][2][C1]=1; Dig[8][4][C1]=1;
Dig[9][0][C1]=1; Dig[9][2][C1]=1; Dig[9][4][C1]=1; Dig[9][C1][0]=1;
}

//Verticals 

for(C1=0; C1<=4; C1++){
Dig[0][C1][0]=1; Dig[0][C1][2]=1;
Dig[1][C1][2]=1;
Dig[3][C1][2]=1;
Dig[4][C1][2]=1;
Dig[6][C1][0]=1;
Dig[7][C1][2]=1;
Dig[8][C1][0]=1; Dig[8][C1][2]=1;
Dig[9][C1][2]=1;
    }

Clk=10000;

L=2; //Think about incorporating overflow protection for L,R
R=4;

//Print Left Digit to Matrix @ (3, 0)

for(C1=0; C1<=4; C1++){             //For some reason produces column of 1s at numpad 6
    for(C2=0; C2<=2; C2++){     
    Mat[C1+3][C2]=Dig[L][C1][C2]; 
    printf("%d", Dig[L][C1][C2]);       //Debug
    }
printf(" %d %d %d\n", L, C1, C2); //Debug
}

//Print Right Digit to Matrix @ (3, 5)

for(C1=0; C1<=4; C1++){             //For some reason produces column of 1s at numpad 1
    for(C2=0; C2<=2; C2++){
    Mat[C1+3][C2+5]=Dig[R][C1][C2];
    }
}

//X Test Pattern

//for(C1=0; C1<=7; C1++){
//  Mat[C1][C1]=5;      
//  Mat[7-C1][C1]=5;
//}

usleep(Clk);

    //while(1){

//Breakfree [NOT FUNCTIONAL]

//Break_String=getch(); (Getch is not ANSI, need ncurses)

//if(Break_String != -1){
//  if(Break_String = 27){
//  break;
//  }
//}     

//Terminal Display 

//for(C3=0; C3<=9; C3++){           //Debug Digit array [Successful, numbers draw correctly]
//  for(C2=0; C2<=4; C2++){
//      for(C1=0; C1<=2; C1++){
//          printf("%d", Dig[C3][C2][C1]);
//      }
//  printf("\n");
//  }
//printf("\n");
//usleep(1000000); //Debug
//}

usleep(3000000); //Debug

for(C1=0; C1<=7; C1++){             //Prints to terminal every second, when looping 
    for(C2=0; C2<=7; C2++){
    printf("%d", Mat[C1][C2]);
    }
printf("\n");
}

printf("\n"); 

//Hardware Display

for(C1=0; C1<=29; C1++){                //30 Hz
    for(C3=0; C3<=7; C3++){             //COLUMN
        //printf("%d %d \n", C3, C1);       //Loop Debug
        usleep(1000);
        //CLOCK GROUND TO GO HERE, OUT STATUS
        //for(C2=0; C2<=7; C2++){       //PX
            //outb(Mat[C3][C2], BASEPORT);
        //}
    }
usleep(4*Clk);
}

//} 

//ioperm(BASEPORT, 3, 0);
exit(0);
} 
```

此外，我必须使我的 Sprite 数组边界每个都比它们应该工作的要大。我认为这只是一些记忆混乱，但我离 C 语言的熟练程度还差得很远，不知道该怎么做。

我将不胜感激任何帮助。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-08T13:52:15.493

我需要更多地查看它，但一个问题是你正在驱动一个 8x8 LED 矩阵，但使用一个 7x7 矩阵来保存数据。将您的矩阵声明为：

```
int Mat[8][8]; 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-08T15:09:35.650

Bryan，我认为您只是缺少对 C 中数组索引如何工作的基本理解。

当你声明

```
int array[N] 
```

您可以访问一系列元素

```
array[0] ... array[N-1] 
```

这给了你总共 N 个元素。

例如：

```
int array[4] 
```

给你

```
array[0]
array[1]
array[2]
array[3] 
```

总共4个元素。

在循环这个数组时，这是几乎总是使用的约定：

```
for(i = 0; i < 4; i++) 
```

我认为这个问题会导致您的代码出现多个问题，如果您在了解这一点后返回数组，您将能够解决这些问题。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-08T13:52:42.200

布莱恩，我没有立即看到问题，但是您所描述的听起来像是您遇到了数组索引问题。（经验法则，任何时候你认为计算机有问题导致你的错误，你就错了。）

新的 C 程序员遇到问题的两个地方是被基于 0 的索引弄糊涂了——一个大小为 7 的数组的索引从 0..6 开始——并且没有意识到数组只是布置在一个内存块的顶部，因此 [10][5][2] 的数组实际上只是一个 100 单元的内存。如果你犯了索引错误，你可以把东西放在看似随机的地方。

我会仔细检查代码并以较小的步骤检查其中的内容；初始化之后会发生什么，诸如此类的事情。

# c# - 将简洁引入 C#/Java

> ID：730038
> 
> 赞同：8
> 
> 时间：2009-04-08T13:36:18.263
> 
> 标签：c#, java, oop

### 背景

目前，如果我想`new`在 C# 或 Java 中创建一个对象，我会键入类似于以下内容的内容：

> `List<int> listOfInts = new List<int>(); //C#`
> `ArrayList<String> data = new ArrayList<String>(); //Java`

C# 3.0 试图通过实现以下编译器技巧来提高简洁性：

> `var listofInts = new List<int>();`

### 问题

既然编译器已经知道我想创建一个特定类型的新对象（事实上我在实例化它时没有为它分配`null`引用或分配一个特定的方法来实例化它），那么为什么我不能这样做下列的？

```
 //default constructors with no parameters:
    List<int> listOfInts = new(); //c#
    ArrayList<String> data = new(); //Java 
```

### 跟进问题：

1.  这种方法可能存在哪些缺陷。我可能会遗漏哪些边缘情况？
2.  是否有其他方法可以缩短实例化（不使用 VB6-esque `var`）并且仍然保留意义？

注意：我在这样的功能中看到的主要好处之一是清晰度。假设 var 不受限制。对我来说这是没用的，它会从右边得到分配，所以为什么要麻烦呢？New() 对我来说实际上缩短了它的意义。无论您声明什么，它都是一个 new()，对我来说这将是清晰和简洁的。

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2009-04-08T13:37:51.143

C# 保存在另一端：

```
var listOfInts = new List<int>(); 
```

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2009-04-08T16:00:40.910

> 我可能会遗漏哪些边缘情况？

我在一月份的[博客上简要讨论了这种可能的 C# 语法。](http://blogs.msdn.com/ericlippert/archive/2009/01/26/why-no-var-on-fields.aspx)有关语法优缺点的一些读者反馈，请参阅该帖子的评论。

> 是否有其他方法可以缩短实例化（不使用 VB6-esque var）并且仍然保留意义？

可能，是的。

然而，C# 中的“var”与 VB6 中的“variant”完全不同。“var”与“object”的含义不同，也没有引入动态类型或鸭子类型。它只是一种语法糖，用于[消除右侧类型的冗余说明](http://blogs.msdn.com/ericlippert/archive/2005/09/27/c-3-0-is-still-statically-typed-honest.aspx)。

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2009-04-08T13:38:01.753

在 C# 3 中已经有局部变量的镜像，隐式键入：

```
var listOfInts = new List<int>(); 
```

但是，这[不适用于非局部变量](http://blogs.msdn.com/ericlippert/archive/2009/01/26/why-no-var-on-fields.aspx)。

在 Java 中，类型推断会考虑分配目标，因此使用静态导入和巧妙的库（例如[Google Java 集合](http://code.google.com/p/google-collections/)） ，您可以编写如下代码：

```
List<Integer> integers = newArrayList(); 
```

请注意，在构造端指定实现的同时保持变量基于接口，这很好。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-04-08T13:44:55.387

在新的 Java 7 提案中，有一个类型推断提案，这将使生活更轻松。泛型声明。

例如

```
Map<String, List<String>> anagrams = new HashMap<String, List<String>>(); 
```

对比

```
Map<String, List<String>> anagrams = new HashMap<>(); 
```

请参阅[此处](http://mail.openjdk.java.net/pipermail/coin-dev/2009-February/000009.html)了解更多信息。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-04-08T13:43:09.620

通常，在使用面向对象的方法时，您通常会创建比变量更具体类型的更多实例。此外，使用不太具体的类型或接口通常是个好主意。在那些情况下，这是没有意义的。

想想接口：

```
IList<int> = new(); // What instance should the compiler infer? 
```

此外，从技术角度来看，操作的签名不包括其返回类型，因此这种赋值将与正常情况完全不同。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-04-08T13:37:57.727

您的版本可读性较差，抱歉。

代码是供人类阅读的，只是偶尔被机器阅读。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-04-08T13:42:52.287

我同意这将是一个不错的功能。一个更好的例子是需要更多的输入：

```
Dictionary<string, int> myDictionary = new Dictionary<string, int>(); 
```

如果可以将其实例化为：

```
Dictionary<string, int> myDictionary = new(); 
```

和：

```
Dictionary<string, int> myDictionary = { {"a",1}, {"b",2} }; 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-04-08T13:38:13.127

C# 有：

```
var listOfInts = new List<int>(); 
```

这实现了同样的事情。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-04-08T13:38:31.860

在 C# 中，有

```
var listOfInts = new List<int>(); 
```

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2009-04-08T13:40:58.593

C# 3.0 有一种机制来减少键入中的重复，但它是通过对您要声明的类型含糊不清来完成的，但在您正在构造的类型中是明确的：

例如

```
var listOfInts = new List<int>(); 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-04-08T13:40:54.507

在 C# 中，已经有这样的东西：

```
var listOfInts = new List<int>(); 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-04-08T13:47:59.780

在 Java 中这没有多大意义，因为您通常会使用接口类型声明变量：

```
List<String> myList = new ArrayList<String>(); 
```

然而，在大多数情况下，能够在没有编译器警告的情况下省略泛型类型的声明是有意义的，例如：

```
List<String> myList = new ArrayList(); 
```

但由于 Java 总是对所有事情都非常明确和冗长，所以最好保持不变。

（为什么还有人会在没有 IDE 的情况下编写 C# 或 Java 代码？）

编辑：

哦，有一个建议！甜的。谢谢，布赖恩。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-04-09T07:07:45.583

Java有

```
 List<String> data = newList(); //Java, where newList() is a helper method to create an ArrayList();
 List<String> data = newList("Hello", "World"); // a helper method which takes a T....
 Map<String, List<String>> anagrams = newMap(); // Java, where newMap creates a new  HashMap(); 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2011-08-22T13:34:47.977

代码从左到右阅读（如果您的语言不是从右到左）。

这意味着

```
var someTypeWithALongName = new TypeWithALongName<TypeParamOne,TypeParamTwo>(); 
```

将重要数据放在正确的部分（用于初始化变量的实际方法/类型构造函数，代码读者可以从中推断出有关*实际 var 类型*的知识），与位于左边。

然而，作者的建议对于从左到右阅读的人来说要好得多 - 我们声明一个已知类型的变量（不是一些未知的 var 类型）

```
TypeWithALongName<TypeParamOne,TypeParamTwo> someTypeWithALongName = new(); 
```

现在重要数据（变量将具有的实际类型）在左侧，我们可以扫描左侧的代码并注意实际类型，而不是 var 声明的栅栏

```
var x = ....;
var y = ....;
var z = ....;
var xy = ....; 
```

`Code Complete`书中指出可读性是最重要的，我很难不同意这一点。节省 5 秒（或更少）秒并使用`var`而不是真正的类型很容易使将来的代码审查变得更加困难，可能使代码因正确的部分而变得不可读，并且可能会产生难以注意到的意外错误。所有的值都是..节省 5 秒而不是为变量编写声明类型？

现在众所周知，实际的**代码编写**并不会花费太多时间用于程序创建，特别是如果它是一个*产品*程序）（通常包括调试、系统测试、组件集成、设计、会议等）花费比实际代码编写更多的时间**）**

另一方面，当我们键入

```
TypeWithALongName<TypeParamOne,TypeParamTwo> someTypeWithALongName = new(); 
```

我发现很难不将该行解释为任何内容，而是调用类型的默认构造函数并创建该类型的实例。

同样在初始化墙的情况下，我们在行的开头得到实际的类型名称，所以它很容易从上到下扫描代码，我们不必将眼睛移到字符串的末尾来知道这个具体的 var 到底是什么初始化确实。（如果您认为扫描行结束是一个免费任务，首先它不是，并且使用 var 它不仅仅是扫描，它还检查初始化的正确部分是否存在错误（例如方法调用具有不同返回类型或 var 允许的某些其他类型的错误））

```
TypeWithALongName<TypeParamOne,TypeParamTwo> someTypeWithALongName = new();
AnotherTypeWithLongNname someAnotherTypeWithLongNname = new();
List<int> idList = new();
Dictionary<int,string> lookupDict = new (); 
```

我反对`var`使用它，除非它是为（匿名类型，通常来自 LINQ）创建的，如果我们要在代码中节省一些空间，我希望任何代码减少策略都发生在右侧。

我还认为，使用`var`声明变量并将其分配给某些方法的返回值会使代码分析高度复杂化，并且通常会引入难以捕获的错误，如果在这种情况下不可能使用 var，那将完全避免，所以如果只有构造函数代码可以缩短为 a `new()`or`new(ParamType param)`而不是其他方法，例如

```
var x = someTypeLocalIstance.ComputeResults() 
```

可读性只会再次获胜。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2011-08-22T13:56:21.473

我认为微软是这样做的：a） `var xy = new MyClass();`

而不是这种方式：b）`MyClass xy = new();`

因为 a) 能够保存匿名类，而 b) 这是不可能的。

# asp.net - web.config 被 w3wp.exe 锁定

> ID：730039
> 
> 赞同：4
> 
> 时间：2009-04-08T13:36:38.307
> 
> 标签：asp.net, iis, iis-6, web-config, locking

我有一个奇怪的问题。看起来如果我的 IIS6 锁定了应用程序的 web.config。如果我尝试编辑它，Windows 会抱怨 web.config 被另一个进程使用。

使用 Process Explorer 我可以看到该文件归 w3wp.exe 所有。删除虚拟目录并停止网站根本没有用。

任何想法（我无法停止整个服务器，因为其中托管了很多网站）？

提前致谢

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-04-08T13:50:37.823

我会尝试[停止](http://technet.microsoft.com/en-us/library/cc736923.aspx)正在访问 web.config 的网站的应用程序池。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-09T04:35:07.557

最好的办法是重命名网络配置（维护该文件的锁定）并重新创建文件。我不确定什么会锁定文件，但应用程序池回收应该已经释放了锁定。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2015-05-15T08:25:58.423

我遇到了这个问题，停止应用程序池没有帮助。然后我尝试启动以管理员身份编辑的文本，然后我可以保存文件。不幸的是，我不知道最终是否需要停止应用程序池......

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2021-12-28T06:41:03.583

在 cmd 中输入**iisreset**也可以解决这个问题

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-04-08T14:11:40.330

如果您使用的是基于 x32 的系统，您可以尝试使用[Unlocker](http://www.emptyloop.com/unlocker/)来“解锁”文件，或者可能删除 web.config 然后重新创建它。否则，您可以终止 w3wp.exe 工作进程，该进程应该会自动重新启动。

# email - 电子邮件混淆问题

> ID：730043
> 
> 赞同：5
> 
> 时间：2009-04-08T13:37:33.923
> 
> 标签：email, obfuscation, spam-prevention, platform-independent

是的，我知道有人问过这个问题并回答了这个问题，但是我对此有一些具体的问题，我觉得在那个线程上不清楚，我也不想在另一个线程的洗牌中迷失方向。

以前的帖子说，像 Facebook 那样将电子邮件地址呈现为图像对于商业/专业网站来说是矫枉过正和不专业的用户体验。似乎普遍的共识是使用 JavaScript document.write 解决方案，使用 html 实体或其他方法来分解和/或使简单的机器人无法读取字符串。我正在构建的应用程序甚至不需要“mailto：”功能，我只需要显示电子邮件地址。此外，这是一个商业 Web 应用程序，因此它需要看起来/行为尽可能专业。以下是我的问题：

1.  如果我走 document.write 路线并传递每个字符的 html 实体版本，是否没有足够复杂的网络爬虫来执行 javascript 并拉出呈现的文本？或者这被认为是最佳实践并且完全（或几乎完全）垃圾邮件发送者证明？

2.  图像解决方案有什么不专业的？如果 Facebook 是世界上流量最高的应用程序之一，而且根本不是由业余爱好者运行的，为什么他们的方法在关于这个主题的另一个线程中完全被驳回？

3.  如果您的回答（如在另一个线程中）是不为这个问题烦恼并让用户的垃圾邮件过滤器完成所有工作，请解释您为什么会有这种感觉。我们正在展示用户提供给我们的电子邮件地址，我觉得有责任尽我所能保护他们。如果您认为这是不必要的，请解释原因。

谢谢。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-08T13:46:24.977

Javascript 目前是一个很好的解决方案的原因有很多（这可能会随着环境的发展而改变）。

*   Javascript 混淆是目前更好的鼠标陷阱
*   你只需要超越其他人。只要有低垂的果实，垃圾邮件发送者就会去追求那些。因此，除非每个人都开始转向 javascript，否则至少现在你还可以
*   大多数垃圾邮件发送者使用基于 http 的脚本，这些脚本使用正则表达式进行 GET 和解析。使用 javascript 引擎进行解析当然是可能的，但会减慢速度

关于 facebook 解决方案，我不认为它不专业，但我可以清楚地看到为什么纯粹主义者可能不同意。

*   它打破了可访问性标准（不能被浏览器、语音阅读器解析或被点击。
*   它破坏了语义结构（它是图像，不再是 mailto 链接）
*   它打破了表现层。如果您增加浏览器默认字体大小或使用高对比度自定义 CSS，它将不适用于电子邮件。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-08T13:52:08.957

1.  它不是垃圾邮件发送者证明。如果有人查看您网站的代码并确定您用于电子邮件地址的模式，则可以编写特定代码来尝试破译它。

2.  我不知道我会说它不专业，但它阻止了复制和粘贴功能，这很重要。使用图像，您根本无法获得该功能。如果您想将相对复杂的电子邮件地址复制到 Outlook 中的通讯录中怎么办？您必须求助于打字，这很容易出错。

3.  将责任转移给用户垃圾邮件过滤器确实是一个糟糕的反应。虽然我认为用户应该努力防范垃圾邮件，但这并不能免除发布地址的人的责任。

为此，试图以绝对安全的方式做到这一点几乎是不可能的。做到这一点的唯一方法是拥有一个共享密码，代码使用该密码来破译编码的电子邮件地址。这样做的问题是，因为 javascript 是在客户端解释的，所以没有什么可以对爬虫保密。

现在电子邮件地址的编码器通常可以工作，因为大多数电子邮件机器人收割者不会关注专门为每个站点进行编码。他们将尝试使用最小的算法来获得最大的结果（否则回报不值得）。因此，简单的编码器将击败大多数机器人。但是，如果有人真的想查看您网站上的电子邮件，那么他们也可以而且可能也很容易，因为编写地址的代码是公开的。

考虑到所有这些，Facebook 走图像路线是有道理的。因为他们可以更改图像以使 OCR 几乎不可能，所以他们几乎可以保证电子邮件地址不会被收集。鉴于它们可能是世界上最大的电子邮件地址存储库之一，可以说它们比我们任何人都承担着更重的负担，虽然不方便，但为了确保其庞大用户群的安全和隐私，它们被迫走这条路.

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-08T19:08:31.287

这是一篇不错的博客文章，比较了一些方法和基准。

[http://techblog.tilllate.com/2008/07/20/ten-methods-to-obfuscate-e-mail-addresses-compared/](http://techblog.tilllate.com/2008/07/20/ten-methods-to-obfuscate-e-mail-addresses-compared/)

# javascript - 如何在运行时更改/删除 CSS 类定义？

> ID：730048
> 
> 赞同：38
> 
> 时间：2009-04-08T13:38:00.007
> 
> 标签：javascript, css

我知道可以通过 JavaScript 在运行时添加新的 CSS 类定义。但...

**如何在运行时更改/删除 CSS 类定义？**

例如，假设我有以下课程：

```
<style>
.menu { font-size: 12px; }
</style> 
```

我想要的是，在运行时，改变类的`font-size`规则`.menu`，这样页面中使用这个类的每个元素都会受到影响。

而且，我还想知道如何删除`.menu`类定义。

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2009-04-08T13:45:40.860

在运行时改变 CSS 规则并不难，但显然很难找到你想要的规则。[PPK 在quirksmode.org](http://www.quirksmode.org/dom/changess.html)上对此进行了快速浏览。

您将要使用`document.styleSheets[i].cssRules`which 是您需要解析的数组以找到所需的数组，然后`rule.style.setProperty('font-size','10px',null);`

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2011-05-05T01:15:49.217

[我在http://twelvestone.com/forum_thread/view/31411](http://twelvestone.com/forum_thread/view/31411)找到了答案，我在这里逐字复制部分线程，因为我担心线程和非常有用的答案会消失。

翻转 2006.06.26, 02:45PM — [Crunchy Frog] 帖子：2470 加入日期：2003.01.26

经过大约 10 到 12 个小时的搜索、阅读和修补，我已经完成了！今天我是 CSS/JS 代码忍者！

使用的JS代码如下：

```
<script language="JavaScript">
function changeRule(theNumber) {
    var theRules = new Array();
    if (document.styleSheets[0].cssRules) {
        theRules = document.styleSheets[0].cssRules;
    } else if (document.styleSheets[0].rules) {
        theRules = document.styleSheets[0].rules;
    }
    theRules[theNumber].style.backgroundColor = '#FF0000';
}
</script> 
```

我已经在 FF(Mac)、Safari(Mac)、O9(Mac)、IE5(Mac)、IE6(PC)、FF(PC) 上对此进行了测试，它们都可以正常工作。'if' 语句的原因是一些浏览器使用 cssRules ......有些只使用规则......而唯一的另一个问题是你不能使用“背景颜色”来指代样式，你有去掉连字符并将连字符后的第一个字母大写。

要引用第一个 CSS 规则，您将使用“changeRule(0)”、第二个“changeRule(1)”和第三个“changeRule(2)”等等......

我还没有找到不能在其上运行的浏览器......但是......你说的任何东西都可以而且会被用来对付你。一遍一遍又一遍。

* * *

BillyBones 2011.01.20，上午 11:57 — [在桶中] 帖子：1 加入日期：2011.01.20

您好，我在这些论坛上注册只是为了添加一点，因为我在其他地方找不到它：

```
function changeStyle(selectorText)
{
    var theRules = new Array();
    if (document.styleSheets[0].cssRules) {
        theRules = document.styleSheets[0].cssRules;
    } 
    else if (document.styleSheets[0].rules) {
        theRules = document.styleSheets[0].rules;
    }
    for (n in theRules)
    {
        if (theRules[n].selectorText == selectorText)   {
            theRules[n].style.color = 'blue';
        }
    }
} 
```

这只是使 CSS 规则可以通过其选择器名称而不是其在 cssRules 数组中的索引号来识别。

换句话说，您可以使用字符串参数“selectorText”而不是一个难以记住且在添加新样式时容易频繁更改的数字来执行 Javascript 函数。

谢谢你 10 到 12 小时的研究，Flip，我希望我做了一个有价值的补充。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2009-04-08T13:44:15.543

我想你正在寻找这个：

[http://www.hunlock.com/blogs/Totally_Pwn_CSS_with_Javascript](http://www.hunlock.com/blogs/Totally_Pwn_CSS_with_Javascript)

这使您可以使用 javascript 更改实际规则。我用过一次，几年前它似乎奏效了。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2015-09-30T03:17:48.920

我为任何想要这样做的人制作了一个简单的辅助函数：

```
function getCSSRule(search) {
  return [].map.call(document.styleSheets, function(item) {
    return [].slice.call(item.cssRules);
  }).reduce(function(a, b) {
    return b.concat(a);
  }).filter(function(rule) {
    return rule.selectorText.lastIndexOf(search) === rule.selectorText.length - search.length;
  })[0];
} 
```

然后，您可以像这样使用它：

```
getCSSRule('.mydiv').style.fontSize = '20px'; 
```

看看下面的例子：

```
function getCSSRule(search) {
  return [].map.call(document.styleSheets, function(item) {
    return [].slice.call(item.cssRules);
  }).reduce(function(a, b) {
    return b.concat(a);
  }).filter(function(rule) {
    return rule.selectorText.lastIndexOf(search) === rule.selectorText.length - search.length;
  })[0];
}

document.querySelector('button').addEventListener('click', function(e) {
  getCSSRule('.iframe').style.backgroundColor = 'orange';
});
```

```
.iframe {
  height: 200px;
  width: 200px;
  display: inline-block;
  border: 1px solid #000;
}
```

```
<p>
  <button>Change .iframe background-color</button>
</p>
<div class="iframe"></div>
<div class="iframe"></div>
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2016-11-09T22:18:31.517

我在这里收集了最好的答案，并将它们组合起来，以便于使用和跨浏览器兼容性。此外，如果页面上没有样式表，或者尚不存在 css 规则，我将介绍何时抛出错误。

[https://github.com/Frazer/dynamicallyAccessCSS.js](https://github.com/Frazer/dynamicallyAccessCSS.js)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2018-11-05T00:22:50.780

这是我一直用于动态操作 CSS 类规则的一个令人尴尬的简单技巧，它避免了复杂性（如解析规则以找到您需要的规则，如预期答案所述），甚至免费提供一些额外的灵活性.

[*（旁注：添加此答案的上一个尝试在几秒钟内立即被此页面的少数自动通知目标之一**否决**，没有反馈。我不确定短暂的下意识反应时间是足以了解为什么这是一个很好地涵盖了 OP 用例的可靠解决方案，但我已经改写了它，猜测叙述可能以某种方式成为触发器。或者缺少分号（我现在已经为他添加了）。或者缺少不必要的花括号（也添加了）。或者缺少关于非效果的注释（添加）。或者没有使用足够复杂的方法（不会修复，甚至简化了代码）。我是肯定他会再次匿名击中，但仍会重试，因为这是一种值得使用的干净且强大的技术。）*]

**注意：**此方法假定您对页面的样式有足够的控制权，以确保不会由不同的方法*创建相同的类规则。*（并且它期望`HEAD`元素存在。）

*（这种方法的一个潜在成本可能是在 上重新渲染`innerHtml`，但由于我们无论如何都在更改 CSS，因此重新绘制迫在眉睫。此外，`innerHtml`对未显示的元素进行了处理，因此浏览器可以优化它，即使它在其他方面很重要。）*

好的。由于您[可以拥有](https://stackoverflow.com/a/42102516/1479945)任意数量的`STYLE`元素，因此将您的动态类包装在它自己的独立类中是非常好的。嗯，就是这样。:) 然后，向 wrapper添加一个`id`或者甚至更好的^*属性，这样您就可以实际访问和操作您的类规则，就好像它是一个 DOM 元素一样。在添加/替换时，只需确保它被包裹在.`class``STYLE``<style class="..."> ... </style>`

奖励：如果您愿意，您还可以将多个相关规则分组并以这种方式一次性替换它们（只需进行一些简单的修改）：

```
function replace_class(classname, block) {
    // Remove old:
    var s = document.head.querySelector("style." + classname);
    if (s) { document.head.removeChild(s); }

    // Just delete?
    if (!block) { return; }

    // Add new:
    s = document.createElement("style");
    s.className = classname;
    s.innerHTML = ("." + classname + block); // <style class="classname">.classname{...}</style>
    document.head.appendChild(s);
} 
```

然后，更新：`replace_class("menu", "{font-size: 8px;}")`.

或删除：`replace_class("menu", null)`.

* * *

* 由于 CSS 适用于*每个*元素，您可能想知道为什么`STYLE`如果您的新类的 a`display: ...`与`none`. 好吧，*[它会](https://css-tricks.com/show-and-edit-style-element/)*，如果它被放入`BODY`！但是，由于我们将它添加到`HEAD`，因此跳过了渲染（当然，除非您也选择了 display `HEAD`）。或者，您也可以使用`id`，但是您必须发明/使用正确的范围/前缀，如果可以避免，您为什么要这样做？`class`（而且我也喜欢当它是一个类包装器时设置的微妙的厚颜无耻......）

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2014-11-14T12:50:03.353

很难找到您想要的规则，因为您必须遍历 document.styleSheets[i].cssRules 数组。（并将您的类名与 selectorText 属性进行比较）所以我对这个问题的解决方案是添加一个新的 CSS 类，从 HTML 元素中删除旧的 CSS 类并添加这个类而不是它。

```
var length = getCssRuleLength();
var newClassName = "css-class-name" + length;

//remove preview css class from html element.
$("#your-html-element").removeClass("css-class-name");
$("#your-html-element").removeClass("css-class-name" + (length-1));

$("#your-html-element").addClass(newClassName);

//insert a css class
insertCssRule("." + newClassName + ' { max-width: 100px; }', length);

function getCssRuleLength() {
	var length = 0;
	if (document.styleSheets[1].cssRules) {
		length = document.styleSheets[1].cssRules.length;
	} else if (document.styleSheets[1].rules) { //ie
		length = document.styleSheets[1].rules.length;
	}
	return length;
}
function insertCssRule(rule, index) {
	if (document.styleSheets[1].cssRules) {
		document.styleSheets[1].insertRule(rule, index);
	} else if (document.styleSheets[1].rules) { //ie
		document.styleSheets[1].addRule(rule, index);
	}
}
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2018-06-11T21:37:46.250

以下是适用于任何给定规则选择器和规则更改功能的方法：

```
// general function for selecting rules and applying changes
function change_css_rules(changeRuleFunc, selectorFunc) {
    [].concat.apply([], // flattens arrays
        Array.from(document.styleSheets).map(function(sheet) { // each ss
            return Array.from(sheet.cssRules).filter(function(rule) { // each rule
                return selectorFunc(rule); // only select desired rules
            });
        })
    ).map(changeRuleFunc); // change the selected rules
} 
```

示例使用：

```
var my_changeRuleFunc = function(rule) {
    rule.style.fontSize = '20px';
}

var my_selectorFunc = function(rule) {
    return rule.selectorText == '.myClass'; // return true to select this rule
}

change_css_rules(my_changeRuleFunc, my_selectorFunc); // apply change to selected rules 
```

# vba - 使用 Word 宏实现自动增量

> ID：730052
> 
> 赞同：3
> 
> 时间：2009-04-08T13:38:14.873
> 
> 标签：vba, ms-word

我正在为文档模板编写 Word/VBA 宏。每次用户从模板保存/创建新文档时，文档都需要在文本中嵌入一个 ID。我如何（尽可能简单）为此 ID 实现自动增量？ID 是数字。

系统必须有某种机制来避免不同的文档获得相同的 ID，但负载非常低。大约 20 人将使用这个模板（在我们的 Intranet 上），每周总共创建大约 20 个新文档。

我曾想过拥有一个可以从宏中锁定和解锁的文本文件，或者使用 SQLite 数据库调用 PHP 页面，但是还有其他更智能的解决方案吗？

请注意，我不能使用 UUID 或 GUID，因为这些 ID 需要可供人类和机器使用。我们的客户必须能够通过电话说：“......那么关于这个，ID 436......？”

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-10T06:52:56.227

对此进行了进一步的思考，这是您可能要考虑的另一种方法。如果您对以前 ID 的目录不感兴趣，那么您可以简单地使用自定义文档属性来存储最后使用的 ID。

在 Word 97-2003 中，您可以通过转到“文件/属性”，选择自定义选项卡并在那里分配名称和值来添加自定义属性。在 Word 2007 中添加自定义文档属性有点难以理解，我认为它是“Office 按钮/准备/文档属性”，选择高级属性的小下拉框，你会得到相同的ol' 2007 年之前的对话。

在下面的示例中，我简单地将我的称为“DocumentID”并为其分配了一个初始值零。

更新自定义文档属性的相关代码是：

```
ThisDocument.CustomDocumentProperties("DocumentID").Value = NewValue 
```

作为概念证明，我创建了一个 .dot 文件并在 Document_New() 事件中使用了以下代码：

```
Sub UpdateTemplate()

    Dim Template    As Word.Document
    Dim NewDoc      As Word.Document
    Dim DocumentID  As DocumentProperty
    Dim LastID      As Integer
    Dim NewID       As Integer

    'Get a reference to the newly created document
    Set NewDoc = ActiveDocument

    'Open the template file
    Set Template = Application.Documents.Open("C:\Doc1.dot")

    'Get the custom document property
    Set DocumentID = Template.CustomDocumentProperties("DocumentID")

    'Get the current ID
    LastID = DocumentID.Value

    'Use any method you need for determining a new value
    NewID = LastID + 1

    'Update and close the template
    Application.DisplayAlerts = wdAlertsNone
    DocumentID.Value = NewID
    Template.Saved = False
    Template.Save
    Template.Close

    'Remove references to the template
    NewDoc.AttachedTemplate = NormalTemplate

    'Add your ID to the document somewhere
    NewDoc.Range.InsertAfter ("The documentID for this document is " & NewID)
    NewDoc.CustomDocumentProperties("DocumentID").Value = NewID

End Sub 
```

祝你好运！

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-05T05:09:10.990

您可以使用 Word 和 Excel（或者我想是 Access，但我对使用 Access 有一种不自然的反感）完全通过 VBA 来处理这个问题。

首先，创建一个新的 Excel 工作簿并将其存储在您可以通过 Word 文档访问的位置（我的是 C:\Desktop\Book1.xls）。您甚至可能希望通过在单元格 A1 中输入数值来播种这些值。

在您的 word 文档中，您可以将其输入到 Document_Open() 子例程中：

```
Private Sub Document_Open()

Dim xlApp       As Excel.Application
Dim xlWorkbook  As Excel.Workbook
Dim xlRange     As Excel.Range
Dim sFile       As String
Dim LastID      As Integer
Dim NewID       As Integer

'Set to the location of the Excel "database"
sFile = "C:\Desktop\Book1.xls"

'Set all the variables for the necessary XL objects
Set xlApp = New Excel.Application
Set xlWorkbook = xlApp.Workbooks.Open(sFile)

'The used range assumes just one column in the first worksheet
Set xlRange = xlWorkbook.Worksheets(1).UsedRange

'Use a built-in Excel function to get the max ID from the used range
LastID = xlApp.WorksheetFunction.Max(xlRange)

'You may want to come up with some crazy algorithm for
'this, but I opted for the intense + 1
NewID = LastID + 1

'This will prevent the save dialog from prompting the user
xlApp.DisplayAlerts = False

'Add your ID somewhere in the document
ThisDocument.Range.InsertAfter (NewID)

'Add the new value to the Excel "database"
xlRange.Cells(xlRange.Count + 1, 1).Value = NewID

'Save and close
Call xlWorkbook.Save
Call xlWorkbook.Close

'Clean Up
xlApp.DisplayAlerts = True
Call xlApp.Quit
Set xlWorkbook = Nothing
Set xlApp = Nothing
Set xlRange = Nothing

End Sub 
```

我意识到这是一个艰巨的过程，所以无论如何都要重新考虑它的内容。这只是我发起的一个快速测试。此外，您需要通过 VBA 中的引用添加对 Excel 对象库的引用。如果您对它的工作原理有任何疑问，请告诉我。

希望有帮助！

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-08T18:47:04.723

好吧，您必须在某处存储下一个 ID 号。文本文件的想法和任何东西一样好。您只需要处理由于某种原因它被锁定或无法访问的可能性。

为一个号码使用数据库是多余的。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-30T10:50:57.920

在我的头顶上：

*   通过自动化将 Excel 用作您的外部数据库。
*   探索几个[SQLite COM 包装器](http://www.sqlite.org/cvstrac/wiki?p=SqliteWrappers)（想到 Litex）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-06T07:55:39.897

“我从宏中锁定和解锁的文本文件”将是最安全的方法。DOCID 文件只有一个数字：最后一个实际使用的 ID。

A）您读取文件（不是在写入/追加模式下）并存储在文档 DOC_ID =FILE_ID+1 上的变量中并保存文档。暂时你杀死 DOCID 文件，打开/创建以读写你的 DOC_ID。关闭文件。如果一切顺利，包括关闭，你是安全的，否则，回到 A)。

您可能需要考虑：如果未找到文件，请使用此文档 ID +100 创建它，作为在 A) 中从无 UPS 灾难中恢复的措施

我太累了，无法检查它是否会在并发情况下造成死锁……它可能会。

如果你觉得值得，我可以把代码放在这里。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-19T13:08:08.893

看来我找到了一种方法来打开和更新具有独占权限的文本文件，这意味着不会有并发问题：

```
Private Function GetNextID(sFile As String) As Integer
    Dim nFile As Integer

    nFile = FreeFile

    On Error Resume Next
    Open sFile For Binary Access Read Write Lock Read Write As #nFile
    If Err.Number <> 0 Then
        ' Return -1 if the file couldn't be opened exclusively
        GetNextID = -1
        Err.Clear
        Exit Function
    End If
    On Error GoTo 0

    GetNextID = 1 + Val(Input(LOF(nFile), #nFile))
    Put #nFile, 1, CStr(GetNextID)
    Close #nFile
End Function 
```

只需调用此函数，直到它不再返回 -1。整洁的。

# objective-c - 在 NSDictionary 中使用类作为键

> ID：730076
> 
> 赞同：37
> 
> 时间：2009-04-08T13:42:09.667
> 
> 标签：objective-c, dictionary

我正在编写一个上下文“工厂”，它将维护从某个 Converter 类继承的转换器/代理对象的字典。这个类有一个方法：

```
- (Class)classResponsibility 
```

或类似的东西，例如 StringConverter 类将方法实现为：

```
- (Class)classResponsibility {
    return [NSString class];
} 
```

然后将该转换器存储在字典中，我曾希望执行以下操作：

```
[converters setValue:stringConverter forKey:[stringConverter classResponsibility]]; 
```

但是编译器抱怨“类”类型是 setValue:forKey: 方法的参数 2 的无效参数类型。我曾想避免将密钥设置为类的名称（“NSString”），但如果这是最好的解决方案，我会选择它。

* * *

## 回答 #1

> 赞同：100
> 
> 时间：2009-04-20T18:54:12.597

您正在使用`setValue:forKey:`which 仅将`NSString`s 作为键。你应该`setObject:forKey:`改用。类对象（指向类对象的指针可以作为 type 传递`Class`）是成熟的 Objective-C 对象（类对象是其元类的实例，您可以使用`NSObject`类对象上的所有方法；阅读更多关于元类[在这里](http://cocoawithlove.com/2010/01/what-is-meta-class-in-objective-c.html)），所以它们可以在任何使用对象的地方使用。

对字典键的另一个要求是它们支持复制（即有`copyWithZone:`方法。类对象是否支持这种方法？事实上，它支持。NSObject 类定义了一个*类方法* `+copyWithZone:`，其[文档](http://developer.apple.com/library/mac/#documentation/Cocoa/Reference/Foundation/Classes/NSObject_Class/Reference/Reference.html#//apple_ref/doc/uid/20000050-copyWithZone_)明确指出它“让你使用类对象作为 NSDictionary 对象的键”。我认为这就是您问题的答案。

* * *

## 回答 #2

> 赞同：30
> 
> 时间：2009-11-06T20:27:49.230

您的另一个选择是使用`[NSValue valueWithNonretainedObject:yourObjectHere]`字符串以外的东西构造密钥。我遇到了类似的问题，我想使用 CoreData 对象作为键，使用其他东西作为值。这种`NSValue`方法效果很好，我相信这是它的初衷。要恢复到原始值，只需调用`nonretainedObjectValue`

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-04-08T13:51:10.397

`-setValue:forKey:`被记录为将 a`NSString`作为第二个参数。您必须使用`NSStringFromClass()`和`NSClassFromString()`作为适配器。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2011-08-22T21:14:08.343

虽然 Class 对象在 NSDictionary 中是一个非常好的键，但值得一提的是 NSMapTable，它是在 NSDictionary 之后建模的，但在哪些类型的对象适合用作键和/或值方面提供了更大的灵活性，[记录](http://developer.apple.com/library/mac/#documentation/Cocoa/Reference/NSMapTable_class/Reference/NSMapTable.html)以支持弱引用和任意指针。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-04-08T14:08:12.787

我正在寻找**setObject:forKey** : 方法而不是 setValue:forKey:。setObject:forKey 的方法签名：接受 (id) 作为两种参数类型，并且更适合。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-23T17:18:51.993

我刚刚遇到了类似的情况，出现了完全相同的错误消息：

```
[tempDictionary setObject:someDictionary forKey:someClass]; 
```

我所做的只是在以下位置实现`NSCopying`协议`someClass`：

```
- (id)copyWithZone:(NSZone *)zone
{
    id copy = [[[self class] allocWithZone:zone] init];
    [copy setId:[self id]];
    [copy setTitle:[self title]];
    return copy;
} 
```

我认为正在发生的事情是`someClass`为了用作键而制作了一个副本，但是由于我的对象不知道如何复制自己（从`NSObject`它派生出来的超类中没有 a `copyWithZone`）它犹豫了。

我用我的方法发现的一件事是它使用对象作为键。除非我已经实例化了对象，否则我会不断地调用`allKeys`或只是以其他方式枚举字典。

[写完后，我看到您想将类存储为密钥。我把这个留在那里，因为如果我在搜索 SO 时找到了答案，我会节省很多时间。那时我没有找到这样的东西。]

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2017-03-21T10:19:39.953

您可以使用 classes 作为`NSDictionary`的键，如下所示：

```
@{
    (id)[MyClass1 class] : @1,
    (id)[MyClass2 class] : @2,
    (id)[MyClass3 class] : @3,
    (id)[MyClass4 class] : @4,
}; 
```

甚至像这样：

```
@{
    MyClass1.self : @1,
    MyClass2.self : @2,
    MyClass3.self : @3,
    MyClass4.self : @4,
}; 
```

# jquery - 通过 JQuery 使用 XSL 解析字符串中包含的 XML

> ID：730082
> 
> 赞同：0
> 
> 时间：2009-04-08T13:43:17.573
> 
> 标签：jquery, xml, xslt, entity-framework-ctp5

这是我的 XML：

```
var x="<page><item>1</item></page>"; 
```

我的 XML 存储在 JavaScript 字符串中。

我正在尝试使用 XSL 对此 XML 进行一些更改。我想通过 JavaScript 将此 XSL 应用于此 XML。所以我使用了 JQuery：

```
$('#output').xslt({xmlURL: '??',xslUrl: 'Test.xsl'}); 
```

这里的 xmlURL 是一个 XML 文件，但输入是一个包含 XML 的字符串。那么如何将此 XSL 应用于 XML 字符串？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-08T13:52:53.137

假设您使用的是[XSLT 插件](http://www.jongma.org/webtools/jquery/xslt/)，请使用 XML 选项。

```
$('#output').xslt({
   xml: x,
   xslUrl: 'Test.xsl'
}); 
```

# design-patterns - 哪种类结构更可取？

> ID：730083
> 
> 赞同：3
> 
> 时间：2009-04-08T13:43:34.250
> 
> 标签：design-patterns, architecture, oop

我不确定这两种“模式”中哪一种是最好的。目前我使用选项 A（与提供者一起实现持久性），但我现在偏向 B，特别是考虑到单元测试能够使用“依赖注入”模型。

**选项 A：**

```
class ClassA
{
   ClassA() { }
   Save();
   static List<ClassA> GetClassAs();   
} 
```

**选项 B：**

```
class ClassA
{
   ClassA() { }
   Save();
}

class ClassARepository
{
    ClassARepository() { }
    List<ClassA> GetClassAs();    
} 
```

我想我要问的是，一个类公开返回自身实例集合的静态方法是一种好习惯吗？

# **编辑**

似乎普遍认为选项 B 是更好的选择。看起来我有很多重构：S

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-08T13:47:53.850

选项 B 看起来有点像[ActiveRecord](http://en.wikipedia.org/wiki/Active_record_pattern)模式（我假设 ClassA 中的 Save 方法将使用 ClassARepository ？），这在某些情况下很好，但是，如果你有相当复杂的域模型，我不会使用 'ActiveREcord ' 图案。

相反，我会使用这样的模型：

```
public class ClassA
{
   public int Id {get; private set;}
   public string Name {get; set;}
}

public class ClassARepository
{
    public ClassA Get( int id );

    public void Save( ClassA item );
} 
```

这意味着所有与持久性相关的逻辑都放在 ClassARepository 类中，而 ClassA 也无法直接访问存储库。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-08T13:46:48.487

您要么将对象的持久性与数据和逻辑完全分开，要么将所有内容保存在一个类中。将“保存”移动到“ClassARepository”或将“GetClassAs”保留在“ClassA”中。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-08T13:50:43.547

选项 B 看起来更好，因为 A 混合了两种想法，两种功能。有 A 类的实际功能和管理 A 集合的单独功能。

随着应用程序的增长，您可能还需要在存储库中添加其他功能 - findById、检索子集等。把它硬塞进 A 类会变得一团糟。

而且，正如您所指出的，选项 B 更容易测试。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-08T13:47:34.210

不，我不会认为这种不好的做法是一个硬性规定，尽管我假设这是为了某种实例跟踪或资源监控？如果是这样，请记住，幕后必须有逻辑，以确保超出范围的对象不会仅停留在您的静态集合中。我不确定您使用的是哪种语言，但如果是 C#，您可以考虑在内部将其存储为`List<WeakReference>`.

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-08T13:56:41.147

选项 B 更灵活。

*   它允许拥有多个存储库。
*   它允许对存储库类进行子类化。
*   它允许您将存储库作为参数传递给另一个类或函数，而不是让该类或函数显式耦合到全局静态变量。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-08T13:57:06.263

> 我想我要问的是，一个类公开返回自身实例集合的静态方法是一种好习惯吗？

通常没有 - 这样的集合通常是单例，如果它们是（如您的示例中），那么单例被认为是[反模式](http://c2.com/cgi/wiki?SingletonPattern)的通常原因，以及[static 被认为是有害](http://gbracha.blogspot.com/2008/02/cutting-out-static.html)的原因。

# .net - 问题在通过 windows 应用程序更新数据库

> ID：730088
> 
> 赞同：0
> 
> 时间：2009-04-08T13:44:42.627
> 
> 标签：.net, database, winforms

我有个问题。

我在使用 Windows 窗体（Visual Studio 项目）更新 SQL 数据库中的数据时遇到问题。

这是我所做的：

*   我在文本框中获取用户信息。
*   我编辑了其中一些。
*   我做 1 回来 n 再次得到这个表格。信息已更新。
*   当我退出并再次登录时，它会显示旧数据！

似乎它暂时更改了数据库。我需要设置任何属性或其他东西吗？

我正在使用 win 应用程序.. 我保留了一个反向链接，它需要我 2 以前的表格。走着瞧吧

1.  我有两个按钮 showUserInfo 和 SaveUserInfo..ok？

2.  单击 showUserInfo 从 db 检索数据并将其显示在表单上。

3.  然后说我编辑用户的年龄或地址，然后单击 saveUserInfo 按钮。它返回成功。

4.  我现在再次单击 ShowUserInfo，它会检索我刚刚更新的信息。即使我转到 previos 表单，然后再次访问此表单，我也可以获取更新的信息。只要我在应用程序的同一运行中，我就可以更新更新的信息。

5.  现在，当我通过 .close() 方法退出应用程序时。并再次运行应用程序，它显示了旧信息，这意味着数据库没有更新。

6.  当我打开 userInfo 表时，它没有更新。

我的保存和显示按钮调用数据访问层函数，这些函数又调用存储过程。我没有使用任何数据阅读器

这就是我所做的：

```
//This the code for my form's save button as u can c....

private void btnSave_Click(object sender, EventArgs e)
{ 
  string fName = txtFirstName.Text;
  string lName = txtLastName.Text;
  string gender;
  if (rdbtnMale.Checked == true)
  {
    gender = "Male";
  }
  else
  {
    gender = "Female";
  }
  string email = txtEmail.Text;
  int age = Convert.ToInt16(txtAge.Text);
  string address = txtAddress.Text;
  int flag;
  // here i call the DAL function.....
  flag = SHSProvider.UpdateUserInfo(userName, fName, lName, gender, email, age, address);
  if (flag == 1)
  {
    MessageBox.Show("Your Account Has been changed successfully");
  }
  else
  {
    MessageBox.Show("Sorry");
  }
}

//........................
// this is the update function in my provider...

public static int UpdateUserInfo(string userName, string fName, string lName, string gender, string email, int age, string address)
{
  string strconn = ConfigurationManager.ConnectionStrings["SHSDatabaseConnectionString"].ToString();
  SqlParameter[] sqlparams = new SqlParameter[7];
  sqlparams[0] = new SqlParameter("@userName", userName);
  sqlparams[1] = new SqlParameter("@firstName", fName);
  sqlparams[2] = new SqlParameter("@lastName", lName);
  sqlparams[3] = new SqlParameter("@gender", gender);
  sqlparams[4] = new SqlParameter("@email", email);
  sqlparams[5] = new SqlParameter("@age", age);
  sqlparams[6] = new SqlParameter("@address", address);
  int flag = SqlHelper.ExecuteNonQuery(strconn, "sp_UpdateUserInfo", sqlparams);
  return flag;
} 
```

// 最后这是我的存储过程...

```
ALTER PROCEDURE dbo.sp_UpdateUserInfo 
@userName nvarchar(30), 
@fName nvarchar(30),
@lName nvarchar(30),
@gender nvarchar(10),
@email nvarchar(30),
@age int,
@address nvarchar(30)
AS
update [T_UserInfo] set [FirstName] = @fName, [LastName] = @lName, [Gender] = @gender, [email] = @email, [Age] = @age, [Address] = @address where [UserName] = @userName
RETURN 
```

请帮忙！

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-09T05:46:21.190

看起来您正在使用数据集。保存后，它会保存到 DataSet 中，但 DataSet 尚未更新到 DB 中。这就是为什么在下一个应用程序实例上显示旧数据。

您需要在 DataSet 上执行 ds.Update()。

要记住的一件事**计算机永远不会错，它的人会制造错误**:)

如果您可以粘贴您的代码，它会有所帮助。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-08T14:48:12.987

我认为 Zim 正在使用自动生成的数据集以及 Winforms 控件。要将数据发送回数据库，在自动生成的表格中，您是否单击“保存”按钮，Zim？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-09T05:50:24.160

我认为您可能只修改局部变量中的数据（可能是 nils_gate 指出的数据集），而根本不将数据保存到数据库中。保存功能中的代码是什么？

如果您使用事务处理来更新数据而不提交事务，也可能会发生这种情况。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-08T14:00:15.910

您如何检索数据？听起来您可能实际上并未将数据提交到数据库，而是将其保存在本地。

如果您使用 DataReaders，请确保您不只是更新检索到的数据，而是更新数据然后将更改提交到数据库。

编辑：你说你“做 1 回”听起来好像你正在使用 ASP.Net 应用程序（即使你说它是一个 Windows 窗体应用程序）。您是否可能没有清除文本框中的日期，因此看起来好像数据库已更新，即使您实际上并未将更改提交到数据库？

# testing - 测试 ClickOnce 应用程序

> ID：730090
> 
> 赞同：3
> 
> 时间：2009-04-08T13:45:09.833
> 
> 标签：testing, clickonce

您将使用什么方法在多个用户中测试 ClickOnce 应用程序的新版本（与当前版本并排）？是否有任何最佳实践（特别是因为应用程序依赖于不同的服务器以获取 SQL / Web 服务的实时/测试版本等）。

我们使用内部 DNS 设置[http://application.ourdomain.test](http://application.ourdomain.test)站点来测试基于 Web 的应用程序。从地址栏中可以明显看出您已登录到测试站点，这只是对连接字符串的更改以强制该部署连接到我们的测试 SQL 服务器。有什么办法可以近似这个吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-09T00:04:08.283

对于 ClickOnce 部署测试，我们设置了一些虚拟机并让测试人员使用远程桌面进行连接。VM 桌面背景是一种难看的颜色，并用粗体红色大字写着“TESTING”。

此外，如果用户要连接到生产数据库以外的任何东西，我们所有的应用程序都会显示一条警告消息。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-30T15:51:39.163

今天下午我遇到了这个[链接文本](http://www.kavinda.net/2007/01/26/clickonce-on-multiple-environments.html "博文")，它似乎提供了一种方法——你必须使用不同的证书来签署清单。我在“发布选项”对话框中更改*套件名称*以创建不同的菜单。

# sql - 使用 SQL Server CE；是否可以仅在不存在时插入并在存在时删除？

> ID：730095
> 
> 赞同：0
> 
> 时间：2009-04-08T13:46:55.803
> 
> 标签：sql, sql-server

我在 SQL CE 中有一个字段表，我需要一个 SQL 语句。目标是如果记录已存在则删除记录，如果记录不存在则插入记录。SQL CE有可能吗？

```
INSERT INTO Source_Table
SELECT     'myvalue' AS Expr1
WHERE     (NOT EXISTS
                 (SELECT     Source_Data
                 FROM        Source_Table AS Source_Table_1
                 WHERE     (Source_Data = 'myvalue'))) 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-08T13:52:49.127

为什么不只是...

```
DELETE Source_Table WHERE Source_Data = 'myvalue'
GO
INSERT INTO Source_Table (Source_Data) values('myvalue') 
```

我不确定删除记录然后插入相同的数据有什么意义，但这应该可以完成。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-08T14:07:27.110

如果目标是从字面上删除，如果它存在并且*只**在它不存在*时插入它，那么你需要做你所写的。

如果目标是在不存在时插入并在存在时*替换*，Adam 是正确的，您最好总是在插入后运行删除。我会在同一个语句批处理中运行两者，以节省开销。

如果有多个字段，您当然会进行更新，而不是删除后插入。（但删除后插入是 Sybase在*内部*执行更新的方式。）

# iphone - 如何在 HTML 属性值的 URL 中编码“&”？

> ID：730101
> 
> 赞同：15
> 
> 时间：2009-04-08T13:48:15.300
> 
> 标签：iphone, objective-c, cocoa, cocoa-touch

我想在电子邮件应用程序中点击 URL。问题是参数化的 URL 由于 URL 中的“&”而破坏了这一点。下面的 body 变量是问题行。“body”的两个版本都不正确。电子邮件应用程序打开后，文本将停在“...链接：”处。对＆符号进行编码需要什么？

```
NSString *subject = @"This is a test";
NSString *encodedSubject = 
[subject stringByAddingPercentEscapesUsingEncoding:NSUTF8StringEncoding]; 

//NSString *body = @"This is a link: <a href='http://somewhere.com/two.woa/wa?id=000&param=0'>click me</a>"; //original
NSString *body = @"This is a link: <a href='http://somewhere.com/two.woa/wa?id=000&#38;param=0'>click me</a>"; //have also tried &amp;
NSString *encodedBody = 
[body stringByAddingPercentEscapesUsingEncoding:NSUTF8StringEncoding]; 
NSString *formattedURL = [NSString stringWithFormat: @"mailto:myname@somedomain.com?subject=%@&body=%@", encodedSubject, encodedBody];
NSURL *url = [[NSURL alloc] initWithString:formattedURL];
[[UIApplication sharedApplication] openURL:url]; 
```

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-04-08T13:51:07.290

[URL 编码](http://www.blooberry.com/indexdot/html/topics/urlencoding.htm)标准中 HEX 的 & 符号为 %26

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-04-08T14:59:43.397

我一直在使用[Google Toolbox for Mac](http://code.google.com/p/google-toolbox-for-mac/)`-[NSString gtm_stringByEscapingForURLArgument]`中提供的，特别是[GTMNSString+URLArguments.h](http://code.google.com/p/google-toolbox-for-mac/source/browse/trunk/Foundation/GTMNSString%2BURLArguments.h)和[GTMNSString+URLArguments.m](http://code.google.com/p/google-toolbox-for-mac/source/browse/trunk/Foundation/GTMNSString%2BURLArguments.m)。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-08T13:50:47.400

您可以使用字符的十六进制表示形式，在本例中为 %26。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2013-04-10T14:37:48.540

您可以简单地使用`CFURLCreateStringByAddingPercentEscapes`with`CFBridgingRelease`来支持**ARC**

```
NSString *subject = @"This is a test";
// Encode all the reserved characters, per RFC 3986
// (<http://www.ietf.org/rfc/rfc3986.txt>)
NSString *encodedSubject =
(NSString *) CFBridgingRelease(CFURLCreateStringByAddingPercentEscapes(kCFAllocatorDefault,
                                            (CFStringRef)subject,
                                            NULL,
                                            (CFStringRef)@"!*'();:@&=+$,/?%#[]",
                                            kCFStringEncodingUTF8)); 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-08T16:26:28.290

您使用`stringByAddingPercentEscapesUsingEncoding`，就像您正在做的那样。

问题是你使用的不够多。您插入编码正文的格式*也*有一个与号，您没有编码。将未编码的字符串粘贴到它上面，然后将它们（使用`stringByAddingPercentEscapesUsingEncoding`）一起编码。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-08T15:30:21.217

```
<a href='http://somewhere.com/two.woa/wa?id=000&#38;param=0'>click me</a> 
```

是正确的，虽然 '&amp;' 比 '&#38;' 更常用 或“&#x2C;”。

如果 'stringByAddingPercentEscapesUsingEncoding' 方法按照它在锡上所说的那样做，它应该可以工作（*），但是 NSString 文档看起来有点不清楚究竟哪些字符被转义了。检查你的结果，URL应该是这样的：

```
mailto:bob@example.com?subject=test&body=Link%3A%3Ca%20href%3D%22http%3A//example.com/script%3Fp1%3Da%26amp%3Bp2%3Db%22%3Elink%3C/a%3E 
```

（*：以通常的免责声明为模，即 mailto: 链接参数，如 'subject' 和 'body' 是非标准的，在许多情况下会失败，通常应避免使用。）

> 电子邮件应用程序打开后，文本将停在“...链接：”处。

如果 'stringByAddingPercentEscapesUsingEncoding' 没有转义 '<' 到“%3C”，这可能是问题所在。否则，它可能与转义无关，而是故意的邮件级别限制以禁止“<”。如前所述， ?body=... 不是一个可靠的功能。

在任何情况下，您都不应该期望邮件程序能够识别 HTML 并尝试发送 HTML 邮件。很少有人会这样做。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2015-11-20T17:09:50.943

使用 %26 而不是 & 的示例没有此属性以数组形式到达 PHP！

```
 var urlb='/tools/lister.php?type=101%26ID='+ID; // %26 instead of &
    window.location.href=urlb; 
```

# asp.net - 我以编程方式向控件添加验证要执行哪个事件？

> ID：730102
> 
> 赞同：2
> 
> 时间：2009-04-08T13:49:28.263
> 
> 标签：asp.net, requiredfieldvalidator

我需要在页面上以编程方式在文本框上添加 requiredvalidator，我是在 page_load 还是在此之前的某个事件中执行此操作？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-08T13:59:32.357

Page_Load 适用于更改控件的设置。

**编辑：** 此代码经过测试并且有效：

```
// in page_load event : 
validator.ControlToValidate = textboxToValidate.ID; 
```

但是，如果您在事件之后动态生成验证器，问题可能会有所不同。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-08T14:13:19.373

这取决于您为什么需要添加它。如果它总是在那里，那么 OnInit 是一个好地方。

如果您只需要在操作发生后添加它，那么您希望在调用 LoadViewState 之后执行它，这样您可以在第一次添加它后继续添加它。第一次添加，很可能你会因为一些回发事件而想要这样做，所以你可以将它添加到你的事件处理程序中。

我建议在您想要此控件的位置向控件添加一个占位符。然后在需要时添加控件。然后，您应该在 ViewState 中存储一些信息，以了解您添加了控件。然后，您可以覆盖 LoadViewState，并在需要时添加控件。

如果只有在控件加载了一些数据时才需要验证器，那么在加载数据后立即添加它，无论是 OnLoad 还是某些属性访问器。

# javascript - 55KB 的 JQUERY 对我的应用程序来说太大了

> ID：730103
> 
> 赞同：10
> 
> 时间：2009-04-08T13:49:36.920
> 
> 标签：javascript, jquery

有没有办法截断jQuery？

我只需要在 jQuery 代码中使用与 AJAX 相关的方法。

您可能知道缩小版只有 55KB，未压缩版约为 110KB。

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2009-04-08T13:54:56.813

我认为您的问题的答案是“可能不是”。

但请考虑以下几点：

*   您不必在每个页面请求上都提供它，合理的 HTTP 响应标头应该意味着每个客户端浏览器只需要下载一次。
*   如果您使用 jQuery 的 Google CDN，您的客户端可能根本不需要下载它，因为他们很有可能已经缓存了它。

IE

```
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.1/jquery.min.js"></script> 
```

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-04-08T13:56:51.317

使用 gzip 压缩可以将其压缩到 19kb。它将从那里被缓存，所以我不确定为什么这是一个问题。这远远小于大多数体面大小的图像。

如果您不介意其他人托管您的代码并且您的问题只是整体带宽，那么使用 CDN 也是一种选择。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-04-08T13:55:20.573

是否有理由需要将其缩小？如今，以 55kb 的大小进入是相当微不足道的。

如果您需要更快，请尝试将其链接到 Google，它始终缓存在他们的服务器上。[在这里](http://code.google.com/apis/ajaxlibs/documentation/#jquery)查看他们的文档。

您也可以尝试异步下载 Javascript 文件。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-08T13:55:30.040

如果适合您的需要，您可以转到较旧的代码库。

1.2.6 打包为 30KB 1.1.4 压缩为 22KB

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-08T14:12:13.823

您可以尝试从源代码构建自己的 jQuery。jQuery 实际上被切割成小模块，您可以在构建自己的 jQuery 时尝试禁用其中的一些模块。

如果您只需要 AJAX，则可能不需要 DOM 操作、CSS 实用程序或动画。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-08T13:56:22.223

嗯，为什么 jQuery 太大了？你的页面有多大？

你应该做的是强制客户端缓存它，所以它只下载一次。您可以通过设置 Expires 标头来执行此操作，该标头通常伴随文件版本控制，因此您可以在必要时强制重新加载。

您可以手动修剪代码，但这可能会令人头疼。

# python - 在 IIS 5.1 上设置 Python

> ID：730105
> 
> 赞同：1
> 
> 时间：2009-04-08T13:50:10.320
> 
> 标签：python, iis, cgi, iis-5

我有这个测试 python 文件

```
import os

print 'Content-type: text/html' 
print 

print '<HTML><HEAD><TITLE>Python Sample CGI</TITLE></HEAD>'
print '<BODY>'
print "<H1>This is A Sample Python CGI Script</H1>"
print '<br>'
if os.environ.has_key('REMOTE_HOST'):
   print "<p>You have accessed this site from IP: "+os.environ["REMOTE_HOST"]+"</p>"
else:
   print os.environ['COMPUTERNAME']

print '</BODY></html>' 
```

我在 IIS 5.1 上创建了一个具有执行脚本权限的应用程序，并创建了一个到 .py 的映射，如下所示：

```
C:\Python30\python.exe -u "%" "%" 
```

但是当我尝试执行脚本时，出现以下错误：

```
CGI Error
The specified CGI application misbehaved by not returning a complete set of HTTP headers. The headers it did return are:

C:\Python30\python.exe: can't find '__main__.py' in '' 
```

任何的想法？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-08T15:01:21.130

```
C:\Python30\python.exe -u "%" "%" 
```

关闭，但它应该是“%s”。我用：

```
"C:\Python30\python.exe" -u "%s" 
```

（第二个 %s 用于命令行 <isindex> 查询，这在本世纪永远不会发生。）

# vim - vim 中的版权字符

> ID：730117
> 
> 赞同：13
> 
> 时间：2009-04-08T13:51:51.487
> 
> 标签：vim, unicode, digraphs

我以前通过一些键的组合在 vim 中获得了这个版权符号。现在有人可以帮我吗？我只是不记得了。

另外，如果可能的话，分享更多这样的角色……有人可能会在某个时候需要它。

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2009-04-08T13:57:29.163

```
:digraphs 
```

显示您可以使用的有向图列表。我看到版权符号为数字 169，它有一个组合键“Co”。要在编辑模式下重新创建它，请按 Ctrl+k，然后键入“Co”，您应该有一个版权符号。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-04-08T13:55:24.753

Ctrl-K 公司

应该这样做

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2015-09-18T09:22:03.320

在插入模式下`Ctrl`+`K` `C``o`将插入版权 © 符号。

`:digraphs`将为其他特殊字符提供组合键。

# java - 你可以用 JRockit 运行 glassfish 吗？

> ID：730123
> 
> 赞同：2
> 
> 时间：2009-04-08T13:53:23.993
> 
> 标签：java, glassfish, sun, jrockit

有人试过用 JRockit 运行 glassfish 吗？我看到一些参考资料说这是不可能的，但它们已经过时了。有人试过这个吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-09T22:17:00.177

在 Windows 中是可能的。我们为多个生产、面向公众的 Web 应用程序执行此操作。

我们不得不删除一些默认的 Glassfish JVM 标志，因为它们不适用于 JRockit（这是可选的，只是启动警告真的让我很恼火），并稍微调整 JVM，但除此之外我们还没有遇到任何问题。

（虽然我们使用 SJSAS，但我认为这不会有什么不同）

以下是我们使用的软件版本：

*   视窗服务器 2003
*   Sun Java System 应用服务器 9.1_01
*   JRockit R27.5.0 (Java 6)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-09T18:19:23.180

AFAIK 在 Windows 上出现问题：[https](https://glassfish.dev.java.net/servlets/ReadMsg?list=dev&msgNo=878) ://glassfish.dev.java.net/servlets/ReadMsg?list=dev&msgNo=878 。Linux 和 Solaris 似乎还可以。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-06-21T07:18:14.093

最近发布的 GlassFish 3.0.1 状态位于[http://www.oracle.com/technology/products/glassfish/index.html](http://www.oracle.com/technology/products/glassfish/index.html)

> 更新 JDK 支持：
> 
> HotSpot JDK 测试/合规更新到 HotSpot JDK 1.6.0_20
> 
> 添加了 Oracle JRockit 6 Update 17 R28.0.0+ 支持

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-01-13T18:44:44.813

启动服务器时只有一个问题...但这可以通过以下方式解决：

变通；在 domain.xml 中注释掉以下 2 行。

```
 <!--
    <jvm-options>-XX:+LogVMOutput</jvm-options>
    <jvm-options>-XX:LogFile=${com.sun.aas.instanceRoot}/logs/jvm.log</jvm-options>
 --> 
```

来自：http: [//java.net/jira/browse/GLASSFISH-11986](http://java.net/jira/browse/GLASSFISH-11986)

# c++ - 在结构中使用 pthread 条件等待

> ID：730125
> 
> 赞同：2
> 
> 时间：2009-04-08T13:54:06.830
> 
> 标签：c++, pthreads

我之前询问过如何在不使用 pthread_join 的情况下同步两个线程，我能够使用 pthread_cond_wait 和 pthread_cond_signal 解决它。我编写了一个小结构来将此功能捆绑到一个地方：

```
struct ConditionWait
{
    int                 i_ConditionPredicate;
    pthread_mutex_t     lock_Var;
    pthread_cond_t      cond_Var;
    int                 i_ValidResult;

    ConditionWait()
    {
        pthread_mutex_init(&lock_Var, NULL);
        pthread_cond_init(&cond_Var, NULL);
        i_ValidResult = 1;
        i_ConditionPredicate = 0;
    }

    void Signal()
    {
        pthread_mutex_lock(&lock_Var);
        i_ConditionPredicate = i_ValidResult;
        pthread_cond_signal(&cond_Var);
        pthread_mutex_unlock(&lock_Var);
    }

    void Wait()
    {
        pthread_mutex_lock(&lock_Var);

        while(i_ConditionPredicate != i_ValidResult)
        {
            pthread_cond_wait(&cond_Var, &lock_Var);
        }
        pthread_mutex_unlock(&lock_Var);
    }
}; 
```

假设我从两个不同的线程调用 Wait() 和 Signal()，这是否是线程安全的。在同一个对象的两个函数中使用相同的锁会导致死锁或竞争条件吗？

编辑：我现在在我的程序中使用它，它工作正常。我不太确定这是否只是运气

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-08T14:12:02.297

这只会工作一次，在您唤醒等待的线程后，下一次等待的尝试将全部成功并且永远不会阻塞，因为您从未“重置”条件谓词。如果这是您想要的（或者在您的情况下无关紧要），那么是的，这是安全的，并且是通常使用条件变量的方式。

PS：你也应该在这个东西的析构函数中使用`pthread_mutex_destroy()`and 。`pthread_cond_destroy()`

# javascript - 表格行排序和字符串性能

> ID：730126
> 
> 赞同：4
> 
> 时间：2009-04-08T13:54:07.580
> 
> 标签：javascript, jquery, performance, string

我有一个不适合分页的包含大量行的表。此表中的行可以通过单击列标题进行排序，该列标题会触发基于[http://www.exforsys.com/tutorials/jquery/jquery-basic-alphabetical-sorting.html](http://www.exforsys.com/tutorials/jquery/jquery-basic-alphabetical-sorting.html)的客户端排序算法该函数动态添加一个"expando" 属性到每一行，从而缓存键预排序：

```
row.sortKey = $(row).children('td').eq(column).text().toUpperCase(); 
```

如您所见，属性值只是设置为单击的列的内容，一旦排序完成，它们就会被丢弃（无效）。性能实际上出奇的好 - 但包含更多文本的列似乎排序较慢。

由于排序只是为了让用户更容易找到他们正在寻找的行，我认为可以通过使用 substr(0,7) 或其他东西（八个字符应该提供足够的精度）。但是，我发现执行 substr() 会产生比节省更多的性能成本，而且如果有的话，它会使排序变慢。

有谁知道可以应用于此方法的任何（其他）优化？

这是一个更完整的示例：

```
var rows = $table.find('tbody > tr').get();
$.each(rows, function(index, row) {
    row.sortKey = $(row).children('td').eq(column).text().toUpperCase()
})
rows.sort(function(a, b) {
    if (a.sortKey < b.sortKey) return -1
    if (a.sortKey > b.sortKey) return 1
    return 0
})
$.each(rows, function(index, row) {
    $table.children('tbody').append(row)
    row.sortKey = null
}) 
```

编辑：这是我的代码的最终版本，包含以下答案中提供的许多优化：

```
$('table.sortable').each(function() {
    var $table = $(this);
    var storage = new Array();
    var rows = $table.find('tbody > tr').get();
    $('th', $table).each(function(column) {
        $(this).click(function() {
            var colIndex = this.cellIndex;
            for(i=0;i<rows.length;i++) {
                rows[i].sortKey = $(rows[i].childNodes[colIndex]).text().toUpperCase();
            }
            rows.sort(function(a, b) {
                if (a.sortKey < b.sortKey) return -1;
                if (a.sortKey > b.sortKey) return 1;
                return 0;
            });
            for(i=0;i<rows.length;i++) {
                storage.push(rows[i]);
                rows[i].sortKey = null;
            }
            $table.children('tbody').append(storage);
        });
    });
}); 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-08T15:40:34.033

您给出的示例存在几个问题。第一个问题是您在循环内使用 jquery 选择列。这是一个主要的性能损失。如果您对 html 代码有任何控制权，我建议您使用普通的 DOM 方法来获取您想要排序的所需列。请注意，有时当您可能期望一个表格单元节点时，您可能会得到一个文本节点。我稍后再谈。for 循环更快，因此您可以考虑使用它而不是 $.each，但我建议您对其进行基准测试。

我以您的示例为例，创建了一个包含 1000 行的表。我的机器上花了大约 750 毫秒对其进行排序。我做了一些优化（见下面的代码）并设法把它降低到 200 毫秒。排序本身花费了大约 20 毫秒（还不错）。

```
var sb = [];
sb.push("<table border='1'>");
var x;
for (var i = 0; i < 1000; i++) {
    x = Math.floor(Math.random() * 1000);
    sb.push("<tr><td>data");
    sb.push(x);
    sb.push("</td></tr>");
}
sb.push("</table>");

document.write(sb.join(""));

$table = $("table");
var rows = $table.find('tbody > tr').get();
var columnIndex = 0;

var t = new Date();

$.each(rows, function(index, row) {
    row.sortKey = $(row.childNodes[columnIndex]).text();
});
alert("Sort key: " + (new Date() - t) + "ms");
t = new Date();

rows.sort(function(a, b) {
        return a.sortKey.localeCompare(b.sortKey);
});
alert("Sort: " + (new Date() - t) + "ms");
t = new Date();
var tbody = $table.children('tbody').get(0);

$.each(rows, function(index, row) {
    tbody.appendChild(row);
    delete row.sortKey;
})

alert("Table: " + (new Date() - t) + "ms"); 
```

当你为速度而写作时，你希望每次迭代都尽可能快，所以不要在循环中做你可以在它们之外做的事情。例如，移动 $table.children('tbody').get(0); 在最后一个循环之外大大加快了速度。

至于使用 DOM 方法访问列，您需要的是列索引，因此您可以遍历 th 列，直到找到正确的列（前提是 th 标签和 td 标签的 html 格式相同）。然后，您可以使用该索引来获取正确的行子节点。

此外，如果表是静态的并且用户可能对其进行更多排序，则应缓存行而不删除 sortKey 属性。然后您可以节省大约 30% 的排序时间。还有表格内容的问题。如果内容是文本，这种排序方式就可以了。如果它包含数字等，那么您需要考虑这一点，因为我正在使用 localeCompare ，它是一种 String 类型的方法。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-08T14:35:04.830

我能想到的一种优化是修改这段代码：

```
$.each(rows, function(index, row) {
        $table.children('tbody').append(row)
        row.sortKey = null
}) 
```

不是一次追加一行，而是追加更大的块，或者如果可能的话全部追加。为此，您需要首先创建一个包含所有行的字符串，然后一次将其全部追加。

使用 array.push 和 array.join 连接字符串

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-08T15:20:48.200

另一个性能改进：不要使用 $.each 而是使用常规的 for 循环来代替你可以帮助它的地方。常规循环稍微快一些。

这篇博文也可能有用，如果不是现在，那么在将来：

[http://notetodogself.blogspot.com/2009/02/building-fast-jquery-plugins.html](http://notetodogself.blogspot.com/2009/02/building-fast-jquery-plugins.html)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-08T15:16:03.763

按照 mkoryak 的建议，我现在修改了代码以将行组合成一个数组，然后一次性将它们全部附加：

```
$.each(rows, function(index, row) {
    storage.push(row);
    row.sortKey = null;
});
$table.children('tbody').append(storage); 
```

这似乎提高了大约 25% 的性能——现在对 1500 行进行排序需要大约 3 秒，而不是之前的大约 4 秒。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-08T20:25:00.307

我使用[DataTables jQuery 插件](http://www.datatables.net/)来完成这种工作，并且我以前使用过[YUI DataTable](http://developer.yahoo.com/yui/datatable/)组件。jQuery DataTables 组件的 1.5 beta 版本包括从 html 代码实例化或使用 AJAX 数据源。它的设置非常简单，并且对于筛选和排序数据来说非常快。

我发现一旦我写了大约 1600 行相当冗长的代码，唯一的办法就是加载服务器端数据。

* * *

## 回答 #6

> 赞同：-4
> 
> 时间：2009-04-08T14:04:21.393

杰娜奥拉！

这甚至可能与您的问题无关，但我们在谈论多少行？对于非常多的行 - 数万 - 表非常慢。一个更轻量级的解决方案是使用 div 和 css 来模拟表格。它可能在语义上不正确（哈！同一个短语中的表格和语义，谁会想到？），但它要快得多。

# vb.net - VB.NET 和 BITS - 后台智能传输服务

> ID：730129
> 
> 赞同：2
> 
> 时间：2009-04-08T13:54:57.327
> 
> 标签：vb.net, bits, microsoft-bits, bits-service

有没有人在 VB.NET 中使用过 BIT？如果是这样，你有代码示例和建议吗？

我正在查看 SharpBits，但我有一个我想使用 BITS 的 VB 项目。是否可以将它与我的 VB.NET 程序一起使用？(.NET 2.0) 我很想尝试将 SharpBits.Base 文件夹中的每个类都转换为 VB.NET，但我想我会问，以防以前有人走这条路。

编辑：好吧，如果你遇到这个问题。您可以做的是在 Sharpbits.Base 文件夹（您从 codeplex 下载）中有一个可以在 Bin 目录中引用的 DLL。您可以将其添加到您的引用中以访问它。将 Konrad 标记为答案，因为他很乐意发帖。

进一步编辑：
我设法让Sharpbits使用一些我在下面粘贴的快速代码，供任何可能偶然发现这个问题的人使用。就像我上面提到的那样，将 DLL 添加到您的项目中。

```
 Dim b As New SharpBits.Base.BitsManager
Dim mynewjob As SharpBits.Base.BitsJob = _ 
b.CreateJob("jobname", SharpBits.Base.JobType.Download)
mynewjob.AddFile("\\server\share\bigfile.zip", "c:\bigfile.zip")
mynewjob.Resume() 

```

您需要编写一些逻辑来检查作业的状态。一旦它达到“已转移”状态，您就可以将其标记为完成。这会将文件从 .bin 写入您列出的文件名。对我有帮助的是安装 Windows 支持工具（您可以从 sup 工具文件夹中的 Windows 2003 Cd/DVD 获取它）并在调试时使用 Bitsadmin.exe 查看作业状态。希望对下一个菜鸟有所帮助。=)

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-08T13:57:19.303

为什么不能简单地在 VB 中使用 SharpBits？.NET 的优势*恰恰*在于，用不同 .NET 语言编写的库可以无缝互操作，因此您可以在 VB 中简单地使用 SharpBits，无论它是用哪种 .NET 兼容语言编写的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-08T15:25:30.403

你可以看看这里：

[将 Windows XP 后台智能传输服务 (BITS) 与 Visual Studio .NET 结合使用](http://msdn.microsoft.com/en-us/library/ms997639.aspx)

我从这里开始编写自己的库来管理 BITS 以跨私有 LAN 传输大视频文件。示例适用于 NET 1.1，但应该不难将其移植到 NET 2.0。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2019-01-09T00:14:55.403

这是一个新的选择。Microsoft 的 BITS 团队现在有一个关于[使用参考 DLL 从 .NET 和 C#](https://docs.microsoft.com/en-us/windows/desktop/Bits/bits-dot-net)调用 BITS以及 GitHub 上的完整示例调用[BITS Manager的页面。](https://github.com/Microsoft/BITS-Manager)

我刚刚尝试将它们与 Visual Basic 一起使用；我的代码最终看起来像这样：

```
 Imports BITS = BITSReference1_5
    Module Module1
        Sub Main()
            Dim mgr = New BITS.BackgroundCopyManager1_5
            Dim jobGuid As BITS.GUID
            Dim job As BITS.IBackgroundCopyJob
            mgr.CreateJob("My simple job", BITS.BG_JOB_TYPE.BG_JOB_TYPE_DOWNLOAD, jobGuid, job)
            job.AddFile("http://www.microsoft.com", "c:\temp\2019\BITS-VB\Downloadfile.html")
            job.Resume()
        End Sub
    End Module 
```

（请注意，我还添加了对我从 BITS 管理器源从 Reference DLL 目录下载的 DLL 的引用）

# xml - 什么是 XML 中的无效字符

> ID：730133
> 
> 赞同：267
> 
> 时间：2009-04-08T13:55:40.867
> 
> 标签：xml

我正在使用一些包含以下字符串的 XML：

```
<node>This is a string</node> 
```

我传递给节点的一些字符串将包含`&`, `#`,`$`等字符：

```
<node>This is a string & so is this</node> 
```

这是无效的，因为`&`.

我无法将这些字符串包装在 CDATA 中，因为它们需要保持原样。我试图寻找一个字符列表，这些字符如果不在 CDATA 中就不能放在 XML 节点中。

有人可以指出我的方向或向我提供非法字符列表吗？

* * *

## 回答 #1

> 赞同：267
> 
> 时间：2015-01-26T14:59:29.650

好的，让我们将以下字符的问题分开：

1.  在任何 XML 文档中都完全无效。
2.  需要逃脱。

@dolmen 在“https://stackoverflow.com/questions/730133/invalid-characters-in-xml/5110103#5110103”中提供的答案仍然有效，但需要使用 XML 1.1 规范进行更新。

# 1\. 无效字符

这里描述的字符是所有允许插入到 XML 文档中的字符。

## 1.1。在 XML 1.0 中

*   参考：见[XML 推荐 1.0, §2.2 字符](http://www.w3.org/TR/xml/#charsets "2.2 字符")

允许的字符的全局列表是：

> `[2] Char ::= #x9 | #xA | #xD | [#x20-#xD7FF] | [#xE000-#xFFFD] | [#x10000-#x10FFFF] /* any Unicode character, excluding the surrogate blocks, FFFE, and FFFF. */`

基本上，控制字符和超出 Unicode 范围的字符是不允许的。这也意味着`&#x3;`禁止调用例如字符实体。

## 1.2\. 在 XML 1.1 中

*   参考：请参阅[XML 建议 1.1、§2.2 Characters](http://www.w3.org/TR/xml11/#charsets "2.2 字符")和[1.3 Rationale 和 XML 1.1 更改列表](http://www.w3.org/TR/xml11/#sec-xml11 "§1.3 XML 1.1 的基本原理和变更列表")

允许的字符的全局列表是：

> `[2] Char ::= [#x1-#xD7FF] | [#xE000-#xFFFD] | [#x10000-#x10FFFF] /* any Unicode character, excluding the surrogate blocks, FFFE, and FFFF. */`

> `[2a] RestrictedChar ::= [#x1-#x8] | [#xB-#xC] | [#xE-#x1F] | [#x7F-#x84] | [#x86-#x9F]`

XML 建议的此修订版扩展了允许的字符，因此允许使用控制字符，并考虑了 Unicode 标准的新修订版，但仍然不允许使用这些字符：**NUL (x00)**、**xFFFE**、**xFFFF** ...

但是，不鼓励使用控制字符和未定义的 Unicode 字符。

还可以注意到，并非所有解析器都考虑到这一点，带有控制字符的 XML 文档可能会被拒绝。

# 2\. 需要转义的字符（以获得格式良好的文档）：

`<`必须用实体转义，`&#60;`因为它被假定为标签的开头。

`&`必须用实体转义，`&#38;`因为它被假定为实体引用的开始

`>`应该用实体`&#62;`转义。这不是强制性的——它取决于上下文——但强烈建议避开它。

`'`应该使用实体进行转义——`&#39;`在单引号内定义的属性中是必需的，但强烈建议始终对其进行转义。

`"`应该使用实体进行转义——`&#34;`在双引号内定义的属性中是必需的，但强烈建议始终对其进行转义。

* * *

## 回答 #2

> 赞同：176
> 
> 时间：2011-02-24T20:34:52.497

有效字符列表在[XML 规范](http://www.w3.org/TR/xml/#charsets)中：

```
Char       ::=      #x9 | #xA | #xD | [#x20-#xD7FF] | [#xE000-#xFFFD] | [#x10000-#x10FFFF]  /* any Unicode character, excluding the surrogate blocks, FFFE, and FFFF. */ 
```

* * *

## 回答 #3

> 赞同：165
> 
> 时间：2009-04-08T13:59:48.847

唯一的非法字符是`&`,`<`和`>`（以及属性中的`"`或`'`，具体取决于用于分隔属性值的字符：`attr="must use &quot; here, ' is allowed"`和`attr='must use &apos; here, " is allowed'`）。

它们使用[XML 实体](http://en.wikipedia.org/wiki/List_of_XML_and_HTML_character_entity_references)进行转义，在这种情况下，您`&amp;`需要`&`.

但是，实际上，您应该使用为您编写 XML 并为您抽象出这种东西的工具或库，这样您就不必担心它了。

* * *

## 回答 #4

> 赞同：63
> 
> 时间：2013-01-14T17:31:18.160

这是一个 C# 代码，用于从字符串中删除 XML 无效字符并返回一个新的有效字符串。

```
public static string CleanInvalidXmlChars(string text) 
{ 
    // From xml spec valid chars: 
    // #x9 | #xA | #xD | [#x20-#xD7FF] | [#xE000-#xFFFD] | [#x10000-#x10FFFF]     
    // any Unicode character, excluding the surrogate blocks, FFFE, and FFFF. 
    string re = @"[^\x09\x0A\x0D\x20-\uD7FF\uE000-\uFFFD\u10000-\u10FFFF]"; 
    return Regex.Replace(text, re, ""); 
} 
```

* * *

## 回答 #5

> 赞同：17
> 
> 时间：2009-04-08T13:59:20.017

预先声明的字符是：

```
& < > " ' 
```

有关详细信息，请参阅“ [XML 中的特殊字符是什么？](http://xml.silmaril.ie/specials.html) ”。

* * *

## 回答 #6

> 赞同：11
> 
> 时间：2017-01-30T14:07:36.257

除了 potame 的答案，如果您确实想使用 CDATA 块进行转义。

如果将文本**放在 CDATA 块中，则无需使用 escaping**。在这种情况下，您可以使用**以下范围内的所有字符**：

[![可能字符的图形表示](https://i.stack.imgur.com/YWjlI.png)](https://i.stack.imgur.com/YWjlI.png)

*注意：除此之外，您不能使用`]]>`字符序列。因为它会匹配 CDATA 块的结尾。*

如果仍然有无效字符（例如控制字符），那么最好使用某种编码（例如base64）。

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2018-02-20T19:33:50.863

在 C# 中删除不正确 XML 字符的另一种方法是使用[`XmlConvert.IsXmlChar`](https://msdn.microsoft.com/en-us/library/system.xml.xmlconvert.isxmlchar%28v=vs.110%29.aspx?f=255&MSPPError=-2147217396)（自 .NET Framework 4.0 起可用）

```
public static string RemoveInvalidXmlChars(string content)
{
   return new string(content.Where(ch => System.Xml.XmlConvert.IsXmlChar(ch)).ToArray());
} 
```

或者您可以检查所有字符是否都是 XML 有效的：

```
public static bool CheckValidXmlChars(string content)
{
   return content.All(ch => System.Xml.XmlConvert.IsXmlChar(ch));
} 
```

[.Net 小提琴](https://dotnetfiddle.net/v1TNus)

例如，垂直制表符 ( `\v`) 对 XML 无效，它是有效的 UTF-8，但不是有效的 XML 1.0，甚至许多库（包括 libxml2）都错过了它并默默地输出无效的 XML。

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2014-02-19T10:01:02.423

在 C# 中转义可能不需要的 XML / XHTML 字符的另一种简单方法是：

```
WebUtility.HtmlEncode(stringWithStrangeChars) 
```

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2014-09-18T12:43:54.313

对于 Java 人员，Apache 有一个实用程序类 ( `StringEscapeUtils`)，它有一个帮助方法`escapeXml`，可用于使用 XML 实体对字符串中的字符进行转义。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2018-07-04T04:43:59.647

“ [XmlWriter 和较低的 ASCII 字符](https://weblog.west-wind.com/posts/2012/Jan/02/XmlWriter-and-lower-ASCII-characters)” 为我工作

```
string code = Regex.Replace(item.Code, @"[\u0000-\u0008,\u000B,\u000C,\u000E-\u001F]", ""); 
```

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2018-10-24T14:41:42.233

总之，文本中的有效字符是：

*   制表符、换行和回车。
*   **除** `&`和外，所有非控制字符均有效`<`。
*   `>`如果遵循 则无效`]]`。

XML 规范的第 2.2 和 2.4 节详细提供了答案：

**人物**

> 合法字符包括制表符、回车、换行以及 Unicode 和 ISO/IEC 10646 的合法字符

**字符数据**

> & 符号 (&) 和左尖括号 (<) 不得以其文字形式出现，除非用作标记分隔符，或者在注释、处理指令或 CDATA 部分中。如果在其他地方需要它们，则必须分别使用数字字符引用或字符串“&”和“<”对其进行转义。右尖括号 (>) 可以使用字符串“>”表示，并且为了兼容性，当它出现在内容中的字符串“]]>”中时，必须使用“>”或字符引用进行转义，当字符串未标记 CDATA 部分的结尾。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2014-12-03T10:27:05.707

在 Woodstox XML 处理器中，无效字符按以下代码分类：

```
if (c == 0) {
    throw new IOException("Invalid null character in text to output");
}
if (c < ' ' || (c >= 0x7F && c <= 0x9F)) {
    String msg = "Invalid white space character (0x" + Integer.toHexString(c) + ") in text to output";
    if (mXml11) {
        msg += " (can only be output using character entity)";
    }
    throw new IOException(msg);
}
if (c > 0x10FFFF) {
    throw new IOException("Illegal unicode character point (0x" + Integer.toHexString(c) + ") to output; max is 0x10FFFF as per RFC");
}
/*
 * Surrogate pair in non-quotable (not text or attribute value) content, and non-unicode encoding (ISO-8859-x,
 * Ascii)?
 */
if (c >= SURR1_FIRST && c <= SURR2_LAST) {
    throw new IOException("Illegal surrogate pair -- can only be output via character entities, which are not allowed in this content");
}
throw new IOException("Invalid XML character (0x"+Integer.toHexString(c)+") in text to output"); 
```

来自[这里的来源](http://www.docjar.com/html/api/com/ctc/wstx/sw/XmlWriter.java.html)

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2016-11-17T17:55:43.853

```
ampersand (&) is escaped to &amp;

double quotes (") are escaped to &quot;

single quotes (') are escaped to &apos; 

less than (<) is escaped to &lt; 

greater than (>) is escaped to &gt; 
```

在 C# 中，使用`System.Security.SecurityElement.Escape`或`System.Net.WebUtility.HtmlEncode`转义这些非法字符。

```
string xml = "<node>it's my \"node\" & i like it 0x12 x09 x0A  0x09 0x0A <node>";
string encodedXml1 = System.Security.SecurityElement.Escape(xml);
string encodedXml2= System.Net.WebUtility.HtmlEncode(xml);

encodedXml1
"&lt;node&gt;it&apos;s my &quot;node&quot; &amp; i like it 0x12 x09 x0A  0x09 0x0A &lt;node&gt;"

encodedXml2
"&lt;node&gt;it&#39;s my &quot;node&quot; &amp; i like it 0x12 x09 x0A  0x09 0x0A &lt;node&gt;" 
```

* * *

## 回答 #14

> 赞同：-2
> 
> 时间：2018-03-23T10:40:08.067

有人试过这个`System.Security.SecurityElement.Escape(yourstring)`吗？这将用有效的等效字符替换字符串中的无效 XML 字符。

* * *

## 回答 #15

> 赞同：-5
> 
> 时间：2013-06-17T15:36:03.327

对于 XSL（在非常懒惰的日子），我使用：

```
capture="&amp;(?!amp;)" capturereplace="&amp;amp;" 
```

翻译所有未遵循的 & 符号 på amp; 到适当的人。

我们有输入在 CDATA 中但使用 XML 的系统没有考虑到它的情况。这是一个草率的修复，小心...

# c++ - 如何强制 C++ 编译器使用特定的 CRT 版本？

> ID：730134
> 
> 赞同：11
> 
> 时间：2009-04-08T13:56:05.220
> 
> 标签：c++, visual-studio-2008, visual-c++, msvcrt

我正在使用 VS2008 开发 COM dll，默认情况下使用 CRT 版本 9，但我使用的是与新 CRT 不兼容的 TSF（文本服务框架）。我认为解决方案是使用兼容的，那么如何指定 CRT 版本？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-04-12T09:53:03.887

我衷心建议**不要**手动更改您链接的 CRT 版本。但是，如果由于某种原因（我无法想象）这对您来说是正确的做法，那么这样做的方法就是更改您的项目的[清单](http://msdn.microsoft.com/en-us/library/ms235342.aspx)。

首先确保不是在每次构建时都生成清单*（*在 VS2005 上：配置属性/链接器/清单文件/生成清单），因为它会覆盖您的手动更改。还要确保启用了隔离。接下来，找到清单文件——应该在 $(IntDir) 处（例如，Debug）。您应该会看到类似于 -

```
 <dependency>
    <dependentAssembly>
      <assemblyIdentity type='win32' name='Microsoft.VC80.DebugCRT' version='8.0.50727.762' processorArchitecture='x86' publicKeyToken='1fc8b3b9a1e18e3b' />
    </dependentAssembly>
  </dependency> 
```

（当然，对于调试版本）。您需要编辑 CRT 元素的 version 和 publicKeyToken 属性。您可以检查本地 WINDOWS\WinSxS 文件夹中的文件以查看可用的版本。找到所需版本后，请[在此处](http://msdn.microsoft.com/en-us/library/aa374228(VS.85).aspx)查看如何提取 publicKeyToken。（虽然我会首先尝试直接查看其他项目的清单，链接到您想要的 CRT 版本）。

如果你去那里，期待一些汹涌的水。如果您的应用程序是不与其他并排组件（MFC、OpenMP 等）链接的控制台应用程序，您可能会走运一些。如果您的应用程序不平凡，如果 SxS 组件中没有一些复杂的版本依赖关系，我会感到惊讶。

（编辑）您还需要与您的应用程序一起分发您正在使用的特定 CRT。这是这样做的[人](http://blog.kalmbachnet.de/?postid=80)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-08T15:03:20.487

最简单的方法是使用与 TFS 兼容的 CRT 的 VC++ 版本构建您的 DLL。

我认为将 DLL 与不同版本的 CRT 链接不是一个好主意，除非您还使用相同版本的头文件。最简单的方法是使用正确的 VC++ 版本......

如果您仍想尝试，您可以：

*   进入“Configuration settings->Linker->Input->Ignore specific library”，输入你正在使用的crt（libc.lib、libcmt.lib等，详见此[代码项目文章](http://www.codeproject.com/KB/cpp/Short_Story_VCPP_CRT.aspx)）。
*   在“配置设置->链接器->输入->附加依赖项”中输入要使用的crt版本名称，在“配置设置->链接器->常规->附加库目录”中输入其路径。

您也可以尝试在“工具->选项->项目和解决方案->VC++目录->库文件”中更改默认目录。也许将 $(VCInstallDir)lib 更改为其他版本的 CRT 所在的路径就可以了

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-08T16:10:18.767

不要尝试使用 VS9 并链接到另一个版本的 CRT。

如果您需要您的应用程序链接到另一个 CRT，比如 VS8 的 CRT，那么您必须在该版本的 VS 中编译和链接您的应用程序。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2014-10-10T11:04:32.780

该解决方案适用于我使用 Visual Studio Express 2013 x64 + OpenCV 2.4.9 x64 编译、调试（我在 LV2013 x64 中集成），但它应该适用于任何其他 VS 版本：

1）右键单击您的解决方案>属性>调试源文件...

2）可能有两个整体（取决于您的 VS 安装目录）... C:\Program Files (x86)\Microsoft Visual Studio 12.0\Common7\IDE\vc7\atlmfc C:\Program Files (x86)\ Microsoft Visual Studio 12.0\Common7\IDE\vc7\crt

有了这些，它适用于 Visual Studio 2013 Express，但也适用于其他 2013。如果您有 Visual Studio 10 或 11，只需在每个中键入“Microsoft Visual Studio 11.0”或 10.0。您也可以只添加它们。

您可以从解决方案 > 属性 > 调试源文件下的 OpenCV.sln 获得这些条目（如上所述）。正如已经描述的那样：CRT 需要匹配……而这发生在那个地方。

# deployment - 什么是最好的 Drupal 部署策略？

> ID：730138
> 
> 赞同：53
> 
> 时间：2009-04-08T13:56:40.100
> 
> 标签：deployment, drupal, vps

我正在 MacBook 上的 XAMPP 上进行我的第一个 Drupal 项目。这是一个原型，并从我的客户那里得到了积极的反馈。

两周后，我将在 Linux VPS 上部署该项目。有没有比从头开始“重做”服务器上的所有内容更好的方法？

*   安装 Drupal
*   下载模块（CCK、视图、日期、日历）
*   创建内容
*   ...

谢谢

* * *

## 回答 #1

> 赞同：54
> 
> 时间：2009-04-08T16:03:18.020

几个提示：

*   对文件使用源代码控制，而不是 FTP/等。你用什么都没关系；我们倾向于为每个客户创建一个 Unfuddle.com 颠覆帐户，以便他们也有记录错误的地方，但关键的第一步是将您网站的完整源代码树纳入版本控制。在测试服务器或登台服务器上进行更改时，您会查看它们是否有效，然后提交，然后在实时服务器上进行更新。回滚和部署变得非常简单。对于多个 webhead 的集群，您可以重复该过程，或从单个“规范”服务器 rsync。

*   但是，如果您使用 SVN，您还可以使用 Drupal 和其他模块/主题的 CVS 签出，并且 SVN/CVS 元数据将能够愉快地彼此相处。

*   对于像文件目录这样的大文件夹，在“正确”位置使用符号链接指向 webroot 之外的服务器端目录。这让您的源代码控制存储库包含所有代码和符号链接，而不是用户上传的所有代码和所有文件。

*   数据库比较棘手；清理开发/暂存数据库并将其推送到初始部署中是最容易的，但如果实时站点上的用户也在生成内容，则在进行增量数据库更新时会出现一些问题。

去年我做了一个关于[Drupal 部署最佳实践](http://www.slideshare.net/eaton/drupal-deployment-presentation)的演讲。随意检查幻灯片。

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2011-01-29T21:43:45.740

[特性](https://www.drupal.org/project/features).module 是一个非常强大的工具，用于管理 Drupal 配置更改。

内容类型、CCK 设置、视图、Drupal 变量、上下文、图像缓存预设、​​菜单、分类法和权限都可以整合到一个功能中，这些功能可以检查到版本控制中。从那里开始，部署新站点或将更改推送到现有站点，可以通过功能 UI 或 Drush 轻松管理。

确保安装 Strongarm.module 以导出存储在变量表中的 drupal 配置。您还可以通过安装 uuid_features.module 将静态内容/节点（即：关于我们、常见问题解答等）放入功能中。

毫无疑问，这是与同一站点上的其他开发人员合作以及将您的站点从开发转移到测试再到登台和生产的最佳方式。

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2009-05-20T15:57:33.567

我们在我的工作场所对此进行了广泛的讨论，我们最终确定的方式是将代码更新（包括模块和主题）从开发推到登台再到生产。我们为此使用了 Subversion，到目前为止它运行良好。

特别重要的是，您可以自动化将数据库从生产中推*回*的过程，以便您的开发人员可以使他们的数据库副本尽可能接近生产。在任务关键型环境中，您希望绝对确定模块更新不会占用您的数据库。我们使用的流程如下：

1.  在开发服务器上安装一个模块。
2.  记下任何必要的更改和更新。如果有任何问题，请恢复并再次执行，直到您有一个可靠、无错误的过程。
3.  测试您的更改！以普通登录用户和匿名用户身份重复您的测试过程。
4.  如果更新过程涉及运行 update.php 以外的任何内容，则编写一个脚本来执行此操作。
5.  将生产数据库复制到您的登台服务器，并立即执行相同的步骤。如果失败，则诊断失败并返回步骤 1。否则，继续。
6.  测试您的更改！
7.  备份您的生产数据库并记下您从 SVN 签出的版本。
8.  将您的生产 Drupal 置于维护模式，在生产树上运行“svn update”，然后完成更新过程。
9.  将 Drupal 退出维护模式并测试所有内容（以管理员、普通用户和匿名用户身份）

就是这样。对于像 Drupal 这样的社区框架，您永远无法真正期望的一件事是能够在您上线后将您的数据库从测试转移到生产。从那时起，所有的数据库移动都是从生产到测试，这使部署过程有些复杂。当心！:)

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2010-01-15T07:31:01.923

我很惊讶没有人提到[部署](https://www.drupal.org/project/deploy)模块。以下是其项目页面的摘录：

> ... 旨在让用户轻松地将内容从一个 Drupal 站点转移到另一个站点。Deploy 自动管理实体之间的依赖关系（如节点引用）。它旨在具有丰富的 API，可以轻松扩展以用于各种内容登台情况。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2010-01-15T09:34:39.383

我们广泛使用功能模块来捕获功能，然后在生产站点轻松安装它们。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-04-08T14:07:54.130

我不使用 Drupal，但我经常使用 Joomla。我通过归档 Web 根目录中的所有文件（在我的情况下为 tar 和 gzip，但您可以使用 zip）然后在生产服务器上上传和扩展该归档文件来进行部署。然后我进行 SQL 转储（mysqldump -u user -h host -p databasename > dump.sql），上传它，然后使用反向命令插入数据（mysql -u produser -h prodDBserver -p prodDatabase < dump.sql ）。如果您没有 shell 访问权限，您可以一次上传一个文件并编写一个 PHP 脚本来导入 dump.sql。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2013-01-21T07:53:02.620

任何版本控制系统（GIT、SVN）+部署 Drupal 代码的[功能模块 + 自定义设置（内容类型、自定义字段、模块依赖项、视图等）。](http://drupal.org/project/features)

由于[Deploy](http://drupal.org/project/deploy)模块仍处于开发模式，因此您可能希望使用Drupal 7 中的[Node 导出](http://drupal.org/project/node_export)模块来部署您的内容/节点。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-23T07:04:49.157

如果您不熟悉部署（和/或 Drupal），请确保一次性完成所有操作。一旦有用户在您处理另一个副本时影响内容，您必须非常小心。

可以留下与实际内容、分类、用户等相关的表格，而不是它们的结构。然后推送与配置相关的。然而，这增加了一个数量级的复杂性。

抱歉，如果部署对您来说是旧帽子，因此这含糊其辞。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2010-03-11T18:26:46.723

我发现并正在实施的一个好策略是使用 deploy 模块的组合来迁移我的内容，然后与 dbscripts 一起使用 drush 来合并和更新核心和模块。即使您有实时内容、安全性和模块更新，它也会处理数据库合并，而且我目前已将我的设置为与 svn 一起使用。

# delphi - Delphi 2009：在 unicode utf-8 中搜索跳过变音符号

> ID：730143
> 
> 赞同：4
> 
> 时间：2009-04-08T13:57:20.740
> 
> 标签：delphi, search, unicode, utf-8, arabic

我有包含阿拉伯文本的 utf-8 编码文件，我必须搜索它。

我的问题是变音符号，如何搜索跳过它们？

就像您在 Internet Explorer 中加载该文本（当然，在 HTML 中转换文本），IE 正在跳过那些变音符号？

有什么帮助吗？

**Edit1**：搜索只需通过以下代码执行：

```
 var m1 : TMemo; //contains utf-8 data)
     m2 : TMemo; // contains results

 ...

      m2.lines.BeginUpdate;
      for s in m1.Lines do
      begin
        if pos(eSearch.Text,s)>0 then
           begin
           m2.Lines.Add(s);
           end;
      end;
      m2.Lines.EndUpdate; 
```

**Edit2**：unicode 数据示例：

قُلْ هُوَ اللَّهُ أَحَدٌ 如果您只搜索没有变音符号قل的字母，则不会找到قُلْ这个词。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-09T06:08:55.427

在 Vista+ 上，您可能（我对阿拉伯语没有经验）将[CompareString](http://msdn.microsoft.com/en-us/library/ms647476.aspx)与选项 LINGUISTIC_IGNOREDIACRITIC 一起使用。

NORM_IGNORENONSPACE 也可能有所帮助。再说一次，[它可能不会](http://www.siao2.com/2005/02/05/367666.aspx "整理一切")。

或者（但我只是猜测）您可以使用[GetStringTypeEx](http://msdn.microsoft.com/en-us/library/ms647480(VS.85).aspx)解析您的字符串并手动删除变音符号。可能您必须首先使用标志 MAP_COMPOSITE调用[FoldString](http://msdn.microsoft.com/en-us/library/ms647478.aspx)或[MultiByteToWideChar 。](http://msdn.microsoft.com/en-us/library/ms886760.aspx)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-23T22:59:46.580

我发现变音符号不是唯一的问题。

我会做字符替换，用空字符串替换它们，我也会规范化文本 'أ' 'إ' 'آ' 都转换为 'ا'，对于 ى ئ ي ؤ و ة ه .. .

对于搜索，我还会使用像“khoja stemmer”这样的轻型词干分析器（[此处](http://zeus.cs.pacificu.edu/shereen/ArabicStemmerCode.zip)为 Java 源代码）

更高级的方法是像[TREC](http://trec.nist.gov/pubs/trec10/papers/UMass_TREC10_Final.pdf)那样做：

*   删除标点符号
*   删除变音符号（主要是弱元音） 大部分语料库不包含弱元音。
*   一些字典条目包含弱元音。这使得一切都保持一致。
*   去掉非字母
*   将首字母 إ 或 أ 替换为 alif .ا
*   将 آ 替换为 ا
*   将 ىء 替换为 ئ
*   将最后的ى替换为ي
*   将最后的 ة 替换为 ه
*   去掉 6 个前缀：定冠词 (فال آال، بال، وال، ال، ) 和 و (and) 从规范化词的开头
*   去掉 ات ان، ها،ي ة، ه، ية، يه، ين، ون 词尾的 10 个后缀

我会通过这个修改过的文本来索引文本（对于备忘录，我会将单词的索引存储在原始文本中），并对搜索查询做同样的事情。

我也会在 Memo1.Text 中搜索，而不是逐行搜索，搜索可能是多个单词，这些单词可能位于一行的末尾并换行到下一行。

# winapi - 如何获取/设置浏览器的滚动条位置（IE/Firefox/...）？

> ID：730145
> 
> 赞同：2
> 
> 时间：2009-04-08T13:58:31.797
> 
> 标签：winapi

有没有办法在 Internet Explorer/Firefox 中获取/设置滚动条的位置？我**不**希望从 HTML/ASP/Javascript 代码内部执行此操作，而是从浏览器外部的应用程序（例如使用 WinAPI）而不使用 BHO。

从我现在所做的搜索来看，这似乎是不可能的，所以我在这里提出一个问题作为最后一次尝试。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-05T02:19:28.653

对于 Internet Explorer，您可以使用 COM 自动化枚举所有活动的 Internet Explorer 窗口/选项卡，然后访问窗口/选项卡中显示的文档的 DOM 树以访问和读取滚动位置。

以下示例代码使用 Delphi 作为编程语言。该机制在 C++、VB 或 C# 中是相似的

```
var
   ShWindows:  ShellWindows;
   InetExplorer: InternetExplorer;
   Count: Integer;
   I: Integer;
   HTMLDocument: IHTMLDocument2;
   Elem: IHTMLElement2;
   ScrollPosY: Integer;
begin
   // Create ShellWindows Object
   SHWindows:= CoShellWindows.Create;

   // Number of explorer windows/tabs (win explorer and ie)
   Count:= ShWindows.Count;
   ShowMessage(Format('There are %d explorer windows open.', [Count]));

   // For all windows/tabs
   for I:= 0 to (Count - 1) do
   begin
     // Get as InetExplorer interface
     InetExplorer:= SHWindows.item(I) as InternetExplorer;

     // Check to see if this explorer window contains a web document
     if Supports(InetExplorer.Document, IHTMLDocument2, HTMLDocument) then
     begin
       // Get body Element
       Elem:= HTMLDocument.body as IHTMLElement2;
       // Read vertical scroll position
       ScrollPosY:= Elem.scrollTop;

       // If this is 0 so far, maybe there is a scroll position in root element
       if ScrollPosY = 0 then
       begin
         Elem:= HTMLDocument.body.parentElement as IHTMLElement2;
         ScrollPosY:= Elem.scrollTop;
       end;

       // Display
       ShowMessage(IntToStr(Elem.scrollTop));
     end;
   end;
end; 
```

有关文档，请从此处开始：http: [//msdn.microsoft.com/en-us/library/bb773974 (VS.85).aspx](http://msdn.microsoft.com/en-us/library/bb773974(VS.85).aspx)

# ruby - Ruby 连接到 SQL Server 2005

> ID：730151
> 
> 赞同：3
> 
> 时间：2009-04-08T14:00:06.443
> 
> 标签：ruby, odbc, connection, dbi

我想通过 ruby​​ 使用 Windows 身份验证通过 ODBC 连接到 sql server 2005/db。我安装了 gem dbi-0.4.1 和 dbd-odbc-0.2.4。我需要为连接字符串做什么？到目前为止，我还无法让它工作。

DBI.connect("DBI:ODBC:Data Source=#{server};Integrated Security=SSPI;Initial Catalog=#{db}")

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-08T16:25:53.003

它在您指定 DBI:DriverName: 后出现：您可以放置​​所需的任何连接信息

DBI.connect("DBI:ODBC:Driver={SQL Server};Server=#{server};Database=#{db};Trusted_Connection=yes")

[http://www.devlist.com/ConnectionStringsPage.aspx](http://www.devlist.com/ConnectionStringsPage.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-08T15:34:05.750

我已经成功连接到一个测试数据库，只是：

DBI.connect('DBI:ODBC:test')

# .net - .NET 中的自定义配置

> ID：730153
> 
> 赞同：3
> 
> 时间：2009-04-08T14:00:37.767
> 
> 标签：.net, configuration, configuration-files

我看到了有关 .NET 中自定义配置的简单示例。我的情况有点复杂，有嵌套节点。

我希望能够从配置文件中读取它：

```
 <environments>

<environment name="live" url="http://www.live.com">
  <server name="a" IP="192.168.1.10"></server>
  <server name="b" IP="192.168.1.20"></server>
  <server name="c" IP="192.168.1.30"></server>      
</environment>

<environment name="dev" url="http://www.dev.com">
  <server name="a" IP="192.168.1.10"></server>
  <server name="c" IP="192.168.1.30"></server>
</environment>

<environment name="test" url="http://www.test.com">
  <server name="b" IP="192.168.1.20"></server>
  <server name="d" IP="192.168.1.40"></server>
</environment></environments> 
```

如果有人可以为此提供一些代码，我将不胜感激。

谢谢！

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-08T14:04:03.187

您可以通过实现从 ConfigurationElement 类继承的自定义配置类来阅读此内容。

这是“服务器”元素的示例：

```
public class ServerElement: ConfigurationElement
{
    [ConfigurationProperty("name", IsRequired = true, IsKey = true)]
    public string Name
    {
        get { return ((string)base["name"]); }
        set { base["name"] = value; }
    }

    ...
} 
```

environment 元素实际上是一个集合，可以这样实现：

```
public class EnvironmentElement: ConfigurationElementCollection
{
    protected override ConfigurationElement CreateNewElement(string elementName)
    {
        return new ServerElement(...);
    }
} 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-04-08T14:16:19.943

我最近遇到的一个漂亮工具是CodePlex 上的[配置部分设计器。](http://www.codeplex.com/csd)很好地集成到 VS 中。

生成类、XML 模式等。推荐。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-04-08T14:06:47.050

您需要创建一些类来处理配置文件的自定义配置部分。

Phil Haack 有一篇非常好的博客文章：[3 个简单步骤中的自定义配置部分。](http://haacked.com/archive/2007/03/12/custom-configuration-sections-in-3-easy-steps.aspx)

编辑：

我试图找到我过去用来学习如何实现这一点的代码项目文章，我在 Phil 的博客条目中找到了它：

在这里[揭开 .NET 2.0 配置的奥秘](http://www.codeproject.com/KB/dotnet/mysteriesofconfiguration.aspx)

它包含处理嵌套元素和集合所需的信息。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-08T14:05:09.737

此示例可能会有所帮助：[创建自定义配置部分处理程序 (MSDN)](http://msdn.microsoft.com/en-us/library/2tw134k3.aspx)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-08T14:12:50.703

查看示例的内容（针对不同的登台环境），而不是动态读取配置文件，您可能希望查看[web 部署项目](http://www.microsoft.com/downloads/details.aspx?FamilyId=0AA30AE8-C73B-4BDD-BB1B-FE697256C459&displaylang=en)，如[对先前问题的回答中](https://stackoverflow.com/questions/305447/using-different-web-config-in-development-and-production-environment)所示。

他们在部署时处理配置合并：一个好主意，特别是如果您有敏感信息，例如带有服务帐户密码的连接字符串......

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-08T15:30:46.990

我会使用 App.Config 文件

System.Configuration.ConfigurationSettings.AppSettings["DatabasePath"];

[http://www.eggheadcafe.com/community/aspnet/2/10004734/appconfig-file-c.aspx](http://www.eggheadcafe.com/community/aspnet/2/10004734/appconfig-file-c.aspx)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-08T16:45:40.163

这是我在阅读本文后最近实现的：

使用反射将类绑定到 .ini 文件

[http://dvuyka.spaces.live.com/blog/cns!305B02907E9BE19A!174.entry](http://dvuyka.spaces.live.com/blog/cns!305B02907E9BE19A!174.entry)

# css - 如何测试正在开发的网页的视觉可访问性？

> ID：730154
> 
> 赞同：3
> 
> 时间：2009-04-08T14:01:14.210
> 
> 标签：css, browser, accessibility, colors

在开发网站时，我希望能够快速切换到“对于某些类型的色盲的人来说，这是什么样的？”

我找到[了 Visicheck](http://www.vischeck.com/)，它将向您展示图像或公共网页的近似外观。

在网站上线之前，我可以在本地开发中使用什么东西吗？也许是 Firefox 插件？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-08T14:04:20.520

你可以截图发给我：）

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-08T14:17:14.013

这曾经在 ffx2 [https://addons.mozilla.org/en-US/firefox/addon/7313](https://addons.mozilla.org/en-US/firefox/addon/7313)上工作。不会向您展示它的样子，但它会为您提供网站元素的表格，突出显示可能存在问题的元素。

为什么不下载[ffx 便携版 2](https://sourceforge.net/project/showfiles.php?group_id=151265&package_id=283201)并将其安装在上面。

*编辑结果是它的测试版可用于 ffx3

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-08T14:32:12.230

我自己还没有尝试过，但[这里有一个 Firefox 扩展](https://addons.mozilla.org/en-US/firefox/addon/5614)程序应该可以做到这一点。

有各种类型的色盲。因此，最大限度地提高网站可访问性的最佳方法是简单地测试设计的对比度（背景与文本）。[这是一篇](http://www.456bereastreet.com/archive/200709/10_colour_contrast_checking_tools_to_improve_the_accessibility_of_your_design/)包含这样做的资源/工具列表的文章。这将帮助您的访问者在光线不好的情况下阅读您的内容，使用较差的显示器，以及色盲或视力不佳的人。

检查对比度级别的一个优点是它适用于所有类型的颜色感知，它不会强迫您使用与常规颜色感知不匹配的颜色和色调。

# c# - 定义属性的“新”方式是否还有更多好处或缺点？

> ID：730160
> 
> 赞同：0
> 
> 时间：2009-04-08T14:03:14.907
> 
> 标签：c#, coding-style

除了更短的代码（如性能优势、更少的内存使用等）之外，“新”、更短的属性处理方式是否还有其他好处？

写作

```
public string StrVariable { get; set;} 
```

而不是

```
private string strVariable;

public string StrVariable
{
    set
    {
        strVariable = value;
    }
    get
    {
        return strVariable;
    }
} 
```

是否有任何缺点 - 也许有些人会认为代码可读性较差，不太明确*？*

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-08T14:06:25.960

[这是您可能会发现有用的链接。](https://stackoverflow.com/questions/9304/c-3-0-auto-properties-useful-or-not)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-08T14:07:04.820

**在特定场景中的**一个大缺点- 您失去了对字段名称的控制。这听起来可能无关紧要，但如果您使用二进制序列化（通过 BinaryFormatter） ，这将[是一个大问题。](http://marcgravell.blogspot.com/2009/03/obfuscation-serialization-and.html)

其他事情：

*   他们不能`readonly`在现场级别
*   对于`struct`s 你需要调用`: this()`自定义构造函数

然而，在 99% 的情况下，它们确实做得非常出色——它们简洁地表达了代码，同时允许稍后添加额外的实现细节（通过切换到显式字段）而不会破坏调用代码（上述几点除外）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-08T14:06:56.113

我可以看到的一个缺点是，如果您想在 get/set 例程中执行其他操作。增加一个计数器或类似的东西。如果您还没有，也许可以验证输入。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-08T14:11:09.380

集合属性也是一个问题。它们没有使用 Autoproperties 进行初始化。

例子：

```
public class foo
{
    public List<String> S1 { get; set; }

    private List<string> s = new List<string>();
    public List<String> S2
    {
        get { return s;}
        set { s = value; }
    }
}

foo f = new foo();
f.S1.Add("thing");
f.S2.Add("thing"); 
```

f.S1.Add 将使用 nullref 异常进行轰炸。

# php - 关于iis6配置问题的php

> ID：730164
> 
> 赞同：0
> 
> 时间：2009-04-08T14:03:40.677
> 
> 标签：php, iis-6

我从未使用过 php，但有人要求我为我们继承的一些代码建立一个站点。我已将 php 配置为在 iis6 上成功运行，但是有一个问题。

此页面将正常工作...

```
<?php phpinfo(); ?> 
```

但这不会...

```
<? phpinfo(); ?> 
```

我如何让后者工作？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-08T14:07:41.073

您需要在`php.ini`文件中启用短标签。它包含`--disable-short-tags`在其中的部分。

# visual-studio - ToolStripSplitButton 与 ToolStripDropDownButton

> ID：730171
> 
> 赞同：10
> 
> 时间：2009-04-08T14:06:10.267
> 
> 标签：visual-studio, winforms, .net-2.0

[ToolStripSplitButton](http://msdn.microsoft.com/en-us/library/system.windows.forms.toolstripdropdown.aspx)和[ToolStripDropDownButton](http://msdn.microsoft.com/en-us/library/system.windows.forms.toolstripdropdownbutton.aspx)有什么区别？[（Visual Studio 2008）（也在此处](http://www.experts-exchange.com/Programming/Languages/C_Sharp/Q_21842423.html)询问，而不是在 SO 上）。乍一看，它们似乎大体相同。尤其是设计师。

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-04-08T14:11:06.807

拆分按钮是带有下拉菜单的常规按钮。如果您单击按钮部分上的拆分按钮，它的作用就像一个常规按钮。如果您在菜单部分单击它，则会下拉菜单。例如，大多数浏览器上的“后退”按钮就是这种类型的按钮。

下拉按钮，单击时会下拉菜单。除了显示下拉菜单之外，它们没有（也不应该有）直接关联的功能。它们就像菜单中最顶层的项目：单击时除了显示更多项目外，它们不做任何事情。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-08T14:11:04.903

[从这里](http://social.msdn.microsoft.com/Forums/en-US/winforms/thread/9124f43d-cfb8-422d-ba5e-e07e5c4faeb4/)引用

> 将 a`ToolStripSplitButton`视为连接到 a 的常规按钮 `ToolStripDropDownButton`。
> 
> 当您单击某个 事件时`ToolStripDropDownButton`，`Click` 总是会触发并显示下拉列表。
> 
> 当您单击事件触发的按钮侧`ToolStripSplitButton`但`Click` 不显示下拉列表时，如果您单击拆分按钮的下拉侧，则会显示下拉列表但 `Click`不会触发事件。
> 
> 在 Internet Explorer 6 中，Mail 按钮的作用类似于一个`ToolStripDropDown`按钮，而 Edit 按钮的作用类似于一个 `ToolStripSplitButton`- 即，如果您单击图像，它只会启动编辑器，而如果您单击箭头，它会提供一个编辑器下拉列表。
> 
> 从视觉上看，当您将光标悬停在按钮上时，提示 a `ToolStripSplitButton`将显示一条实心垂直线，将图像与下拉箭头（“拆分”的两侧）分开，而 `ToolStripDropDown`按钮不会显示垂直线。

# scala - 如何在 scala 的解释器中将外部库添加到类路径中？

> ID：730183
> 
> 赞同：7
> 
> 时间：2009-04-08T14:08:04.893
> 
> 标签：scala, classpath, interpreter

我试图在 Scala 解释器中引用一些使用 Eclipse 编写和编译的类。Eclipse 将编译后的 Java 字节码存储在文件夹 {workspace}/myProject/bin 中。是否有一些命令可以将此文件夹添加到 Scala 解释器使用的类路径中？

也许 scala.bat 应该用一些参数来编辑或参数化？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-04-09T02:48:45.563

启动解释器时使用 -classpath 或 -cp 标志：

```
scala -cp /path/to/classfiles 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-09T01:18:47.527

您可以编辑 scala.bat，或者制作一个副本以保持原件不变。

您可能希望使用**call :add_cpath "..."**来添加它，就像在该批处理文件中的某处使用的那样。

# java - Java 中 fileSystemWatcher 的建议/示例代码

> ID：730186
> 
> 赞同：8
> 
> 时间：2009-04-08T14:08:35.313
> 
> 标签：java

我正在尝试在 java 中构建一个 fileSystemWatcher（类似于 C# 中的 FileSystemWatcher）。请建议 java 是否有任何内置框架功能或建议/直接到任何示例/开源项目。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-09T00:48:19.643

查看[Apache Commons JCI FAM](https://commons.apache.org/proper/commons-jci/apidocs/org/apache/commons/jci/monitor/FilesystemAlterationMonitor.html) (FileAlterationMonitor)。[单元测试](https://github.com/apache/commons-jci/blob/master/fam/src/test/java/org/apache/commons/jci2/monitor/FilesystemAlterationMonitorTestCase.java)应该让您了解如何使用它。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-08T14:50:54.120

JDK7 中的“更多 NIO 功能”应该具有这种工具的跨平台版本（在任何合理的 JRE 实现中利用特定平台功能）。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-11-23T11:41:27.663

这是更好的选择 [http://jnotify.sourceforge.net/](http://jnotify.sourceforge.net/)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-08T14:17:05.777

我不相信有任何内置的能力。您始终可以在线程中轮询目录，并注意目录修改时间等。这很简单，但我不确定操作系统在如何反映目录元数据中的目录更改方面有何不同。如果您必须跟踪包含大量文件的目录，那么任何基于轮询的解决方案都可能非常重量级。

我注意到[这一点](http://www2.hawaii.edu/~qzhang/FileSystemWatcher.html)，这是一个更适合 Windows 的版本（不是说我知道你在什么平台上！）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-11-23T11:38:21.383

[http://www2.hawaii.edu/~qzhang/FileSystemWatcher.html](http://www2.hawaii.edu/~qzhang/FileSystemWatcher.html)

# jsf - JSF 与其他 Web 框架的使用

> ID：730188
> 
> 赞同：2
> 
> 时间：2009-04-08T14:09:13.660
> 
> 标签：jsf

我们正在重新评估我们对 JSF 的使用（在我进入项目之前引入）与其他 Web 框架（如 Spring MVC）的可能使用。

从我的角度来看，与使用 Spring MVC（我熟悉）相比，使用 JSF（从未开发过）构建页面的开发时间似乎需要很长时间。

我知道 JSF 是一个基于“组件”的框架，其理想的是构建或使用可重用组件。但到目前为止，情况并非如此。大多数（如果不是全部）页面都需要新组件。我正在估计数周的页面开发时间，我认为可以使用基于“Action”的框架在几天内完成。

想知道我是否在这里偏离了基地，或者所在的团队可能不是正确的团队，或者是否具有与 JSF 合作的正确技能。

我们的分析工具也遇到了问题，用户为页面添加书签和炸毁应用程序服务器堆 - 大量出现内存不足异常。

我们正在构建一个在 WebSphere 6.1 上运行的电子商务/拍卖网站。我们使用 Spring 和 Hibernate。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-08T17:36:42.460

我们发现 JSF 的缺点：

*   “标准”五相路径非常简单且不灵活。
*   与常规方法不同是复杂且不直观的
*   如果没有 Facelets 和 Rich/ICEFaces，您根本无法使用 JSF。至少，其他修改/插件很有帮助（SEAM 等）
*   可以封装功能以使事情“更简单”......当情况需要时，让它几乎不可能在那里乱七八糟是不好的。
*   在尝试设计客户端响应式页面时，组件树的服务器端存储非常不方便。

我们已经转移到 Groovy/Grails 这里。“默认”约定很容易理解，必要时也很容易绕过。约定也适用于修改框架（不更改多 xml/代码文件）。我根本不需要手动修改 XML 文件。它更容易使用，并且足够灵活，可以满足我们的需要。

Grails 结合了 Spring WebFlow 和 Hibernate，只是你不必修改 XML；Grails 编码约定在编译/运行时进行转换。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-08T14:23:12.707

我也是 Spring MVC 的忠实粉丝——尤其是与 Spring Webflow 结合使用时，这真是太棒了。现在 Webflow 可以与其他 Web 框架一起使用，但它最自然地适合 Spring MVC。

就我而言，我从 Struts (1) 转到 Spring MVC。我们为使用 Struts 建立了很多基础设施。在 Spring MVC 中编写新页面时，我低估了一件事情，那就是我们将花费多少时间来彻底改造该基础设施。我说的是验证、通用逻辑等等。

现在我对 JSF 不太了解。听起来您遇到了这个问题（就像使用任何 Web 框架一样）。该过程仍在继续的事实可能是一个真正的问题。你不能忽视这样一个事实，你也会有其他东西。

一旦你有一些围绕验证和表单逻辑的基础设施，我发现 Spring MVC 和 Webflow 是最好的。例如，我们的系统上有很多这样的过程：

1.  用户下单；
2.  服务器验证参数并拒绝订单（返回（1））或接受它；
3.  已验证的订单返回显示给确认他们想要下订单或取消订单的用户；
4.  如果他们取消它，显示一个页面说它已被取消；
5.  如果他们批准，请再次验证订单；
6.  如果验证失败返回（1）；
7.  否则下订单并向用户显示结果。

这听起来可能令人费解，但它出现了很多。Spring MVC 真正闪耀的地方是对于这种场景，您可以创建一个自定义控制器，然后实际实现就变成了插入正确视图和支持 bean 的问题。

**不要低估开发和测试所需基础设施的成本。**

要考虑的另一件事是团队经验：如果没有其他人有 Spring MVC 经验，那么这将带来一些问题。

所以要非常小心，不要仅仅因为它会让你个人更舒服而改变。

# java - Hibernate 查询 API 和 Java 1.5/泛型

> ID：730192
> 
> 赞同：4
> 
> 时间：2009-04-08T14:09:46.107
> 
> 标签：java, hibernate, generics

Hibernate 中的所有 API 都来自 1.4，因此不使用 java 泛型。

所以我想知道以下内容有多“安全”：（前提条件：名称列的数据类型为字符串，或者至少与字符串兼容）

```
@SuppressWarnings("unchecked")
public List<String> getAll() {
    Query q = session.createQuery(
        "select name from Customers");
    return q.list();    
} 
```

来自 Queryi API (org.hibernate.Query.list()) javadoc。

[“将查询结果作为列表返回。如果查询包含多个结果前行，则在 Object[] 的实例中返回结果。”](http://www.hibernate.org/hib_docs/v3/api/)

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-08T14:15:56.217

`List`Java 泛型使用类型擦除，因此在运行时 a 、 a`List<String>`和 a之间没有区别`List<Integer>`。一切都只是`List`s。在编译时，编译器将强制执行模板参数类型，但在运行时，你有一个`List`.

事实上，如果你尝试使用反射来查找模板参数类型，是不行的。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-08T17:33:35.010

只要您确定查询不“每行包含多个结果”，它就会是安全的。（我不熟悉查询，所以我不确定在这种情况下是否会发生这种情况。）如果一行确实包含多个结果，那么当您尝试访问它时，它将在运行时抛出 ClassCastException，因为该元素将是Object[] 对象而不是 String 对象。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-08T14:13:28.423

在 Java 中，泛型实际上是擦除，这不过是编译器的魔法。用作泛型类型参数的类型在运行时是未知的。因此，如果返回的列表实现了 List 接口，则转换应该是成功的，但编译器可能会向您抛出警告。

# c# - 在 C# 和 Ffmpeg 之间创建管道

> ID：730193
> 
> 赞同：2
> 
> 时间：2009-04-08T14:10:05.920
> 
> 标签：c#, pointers, stream, ffmpeg, pipe

我有一个 C# 程序，可以创建视频并将其实时保存到磁盘。我不想这样做，而是希望它直接在与 ffmpeg 连接的管道中编写它......

将视频保存在磁盘中的功能，我无法控制，接收到一个 IntPtr 并引用该文件。

所以，我需要用ffmpeg创建一个管道或类似的东西，获取一个指向它的指针，并在函数中使用该指针，以便它将文件流式传输到ffmpeg而不是磁盘......

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-08T14:19:39.093

3.5 添加了对命名和匿名管道的支持，但我不确定如果您无法控制保存到磁盘的文件，您将如何同步访问...

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-09T16:21:01.700

查看构建 ffmpeg 的库的 API 可能是值得的。

你能指定写入哪个文件吗？可能会潜入内存中的文件，然后您可以窃取并使用它做自己喜欢的事情。

# java - 构造函数参数 - 经验法则

> ID：730201
> 
> 赞同：23
> 
> 时间：2009-04-08T14:11:53.467
> 
> 标签：java, design-patterns, refactoring

一般来说，类构造函数应该接受的最大参数数是多少？我正在开发一个需要大量初始化数据（目前有 10 个参数）的类。但是，带有 10 个参数的构造函数感觉不对。这让我相信我应该为每条数据创建一个 getter/setter。不幸的是，getter/setter 模式不会强制用户输入数据，没有它，对象的特征是不完整的，因此是无用的。想法？

* * *

## 回答 #1

> 赞同：38
> 
> 时间：2009-04-08T14:14:28.513

有了这么多参数，是时候考虑[Builder 模式](http://en.wikipedia.org/wiki/Builder_pattern)了。创建一个包含所有这些 getter 和 setter 的构建器类，并使用 build() 方法返回您真正尝试构建的类的对象。

### 例子：

```
public class ReallyComplicatedClass {
    private int int1;
    private int int2;
    private String str1;
    private String str2;
    // ... and so on
    // Note that the constructor is private
    private ReallyComplicatedClass(Builder builder) {
        // set all those variables from the builder
    }
    public static class Builder {
        private int int1;
        private int int2;
        private String str1;
        private String str2;
        // and so on 
        public Builder(/* required parameters here */) {
            // set required parameters
        }
        public Builder int1(int newInt) {
            int1 = newInt;
            return this;
        }
        // ... setters for all optional parameters, all returning 'this'
        public ReallyComplicatedClass build() {
            return new ReallyComplicatedClass(this);
        }
    }
} 
```

在您的客户端代码中：

```
ReallyComplicatedClass c = new ReallyComplicatedClass.Builder()
        .int1(myInt1)
        .str2(myStr2)
        .build(); 
```

[请参阅Effective Java Reloaded](http://developers.sun.com/learning/javaoneonline/2007/pdf/TS-2689.pdf) [pdf]的第 7-9 页，Josh Bloch 在 JavaOne 2007 上的演讲。（这也是[Effective Java 2nd Edition](http://java.sun.com/docs/books/effective/)中的第 2 项，但我手边没有它，所以我不能引用它。）

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-04-08T14:17:10.597

您可以决定何时足够，并为您的构造函数使用[Introduce Parameter Object （或任何其他方法）。](http://www.refactoring.com/catalog/introduceParameterObject.html)

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-04-08T14:18:52.497

[Code Complete 2](http://www.cc2e.com/)建议对任何方法的七个参数进行相当合理的限制。

尝试为某些成员建立合理的默认值。这将使您可以使用 getter/setter 而不必担心表征不完整。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-04-08T18:52:38.783

我认为你不能说一个合适的数字是“七，不多”或“五”。

构造函数的一个好的经验法则是传递对象的**身份**，而不是**状态**。你传入的那些参数对于对象的存在来说是必不可少的，没有这些参数，对象的大多数操作都可能是不可能的。

如果您真的有一个具有非常复杂的自然身份的类，因此需要许多参数，那么请考虑您的类的设计。

一个糟糕的构造函数的例子是：

```
public NightWatchman(int currentFloor, int salary, int hapiness) {...} 
```

在这里，NightWatchman 正在使用一些默认值构建，这些默认值几乎肯定会在短时间内发生变化。有趣的是，对象以一种方式被告知它们的值，然后以不同的方式（通过它们的设置器）在未来拥有它们。

一个更好的构造函数的例子是：

```
public GateWatchman(Gate watchedGate, boolean shootOnSight) {...} 
```

守望者正在监视的大门是一个人存在所必需的信息。在课堂上，我会将其标记为**private final**。我选择将**shootOnSight**变量传递给构造函数，因为在这里重要的是对象始终知道是否射击窃贼。在这里，身份被用作类型。

我可以有一个名为**ShootingGateWatchman**和**PoliceCallingGateWatchman**的类——即参数被解释为对象身份的一部分。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-04-08T14:16:53.890

我建议找到参数之间的依赖关系，然后创建结构或其他类来保留它们并将它们传递给你的构造函数，而不是一堆乍一看似乎不相关的东西。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-04-08T14:20:55.473

[根据短期记忆](http://en.wikipedia.org/wiki/Hrair_limit)的 7+/-2 规则，我通常会说不超过 5 个，并且对程序员的注意力跨度有些悲观。注意：我[会将可变参数](https://stackoverflow.com/questions/519752/java-params-in-method-signature)列表视为一个实体。

如果你真的受限于一次性构造对象，你通常可以在简单的值对象中收集相关参数并将它们传递给构造函数。尝试确保值对象具有一定的概念意义，而不仅仅是信息的随机集合......

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-04-08T14:43:20.037

我需要更多地了解该类的功能以及参数是什么，但是该类有可能承担了太多责任。是否可以将班级分成较小的独立班级？

使用 setter 并不能解决类具有许多依赖项/参数的问题。它只是将问题移到不同的地方，而不是强制输入参数。

对于方法，我尝试遵循 Clean Code book 中的建议，每个方法 (IIRC) 的参数不超过 3 个。对于构造函数，我可能有更多参数，因为通常构造函数将由我的依赖注入框架而不是我调用。

mmyers 提到的builder模式在构建复杂对象时也是一个很好的解决方案，没有办法让它们变得不那么复杂。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-08T15:28:11.317

这取决于。

如果某些参数属于同一类型并且可以混淆，我会容忍一个相当小的数字（比如 5）。

如果参数是不同类型的，所以不能混淆，那么我会容忍更多。不过，十个将接近极限。

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2009-04-08T14:34:27.797

将 Param => Value Map 对象传递给构造函数怎么样？如果调用者省略了任何关键参数，让构造函数抛出异常。

这意味着对构造函数的错误调用只会在运行时而不是编译时被捕获，这是一个缺点。但是 getter/setter 方法也有同样的问题，这应该更容易使用。

# c# - 线程可以作为另一个用户执行吗？(.NET 2.0/3.5)

> ID：730206
> 
> 赞同：3
> 
> 时间：2009-04-08T14:12:39.487
> 
> 标签：c#, .net, security, reflection, sandbox

我有一个 C# 应用程序，它将包含计算的源文件执行一些运行时编译到动态程序集中。显然，这提出了一个严重的安全问题。

根据以下“公式”，将生成以下代码，并创建一个动态程序集：

公式：

```
Int32 _index = value.LastIndexOf('.');
String _retVal = value.Substring(_index + 1);
return _retVal; 
```

生成的代码：

```
using System;
namespace Dynamics
{
  public class Evaluator
  {
    public Object Evaluate(String value)
    {
      // Begin external code
      Int32 _index = value.LastIndexOf('.');
      String _retVal = value.Substring(_index + 1);
      return _retVal;
      // End external code
    }
  }
} 
```

然后加载动态程序集并通过反射执行 Evaluate 方法。这很好用。

问题是恶意代码注入的可能性很大，所以我想在“沙盒”线程中运行 Evaluate 方法（没有任何非托管 API 调用）。出于测试目的，我使用了内置的匿名 Windows 用户，并提供了以下代码：

```
Thread tSandbox = new Thread(
    new ParameterizedThreadStart(this.DoSandboxedEvaluation));
WindowsIdentity tIdentity = WindowsIdentity.GetAnonymous();
WindowsPrincipal tPrincipal = new WindowsPrincipal(i); 
```

这给了我匿名用户的身份和主体。如何将其应用于线程 tSandbox，以便该线程上的代码在指定的安全上下文中运行，而不使用非托管 API 调用？

谢谢！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-08T14:14:57.653

AFAIK 模拟另一个用户的唯一方法是通过非托管的 win32 api（例如，LogonUser()）...您可以通过互操作调用它们。

[这里](http://msdn.microsoft.com/en-us/library/system.security.principal.windowsimpersonationcontext.aspx)有一个代码示例

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-08T16:40:46.180

如果您只需要匿名帐户，您可能非常接近 - 您只需将原则分配给线程（您可以通过设置 System.Threading.CurrentPrinciple 来更改要更改的线程中运行的代码）

但是，如果您需要对 Windows 用户进行身份验证并将该身份分配给线程，我认为您将不得不对 LogonUser() 进行非托管调用。我看不出有什么办法。

这是一些适用于匿名用户的代码（它假设一个 ASP.Net Web ApplicationProject，您在表单上有一个名为“identityLabel”的标记，并且您已分配 onInit="IdentityLabelInit"）（请注意，代码运行方式不同，具体取决于不管你是在IIS还是Cassini下运行——在IIS下，初始身份是匿名用户，在Cassini下，初始身份是我。

```
 protected void IdentityLabelInit(object sender, EventArgs e)
        {
            System.Threading.Thread testThread = new Thread(ReportIdentity);
            testThread.Start();
            testThread.Join();
        }

        private void ReportIdentity()
        {
            identityLabel.InnerText = "Initialized: " + System.Threading.Thread.CurrentPrincipal.Identity.Name;
            System.Security.Principal.IPrincipal currentPrincipal = System.Threading.Thread.CurrentPrincipal;
            SetAnonymousIdentity();
            System.Security.Principal.IPrincipal newPrincipal = System.Threading.Thread.CurrentPrincipal;
            if (newPrincipal.Equals(currentPrincipal))
                identityLabel.InnerText += ("no change");
            else
                identityLabel.InnerText += " | new name: " + System.Threading.Thread.CurrentPrincipal.Identity.Name;
        }

        private void SetAnonymousIdentity()
        {
            WindowsIdentity tIdentity = WindowsIdentity.GetAnonymous();
            WindowsPrincipal tPrincipal = new WindowsPrincipal(tIdentity);
            System.Threading.Thread.CurrentPrincipal = tPrincipal;
        } 

```

# python - Django 模型将外键设置为另一个模型的字段

> ID：730207
> 
> 赞同：33
> 
> 时间：2009-04-08T14:12:43.370
> 
> 标签：python, django, django-models

有没有办法在 django 中将外键设置为另一个模型的*字段？*

例如，假设我有一个 ValidationRule 对象。而且我希望规则定义要验证另一个模型中的哪些字段（以及其他一些信息，例如它是否可以为空、数据类型、范围等）

有没有办法在 django 中存储这个字段级映射？

* * *

## 回答 #1

> 赞同：98
> 
> 时间：2010-01-04T14:56:09.410

我还没有尝试过，但似乎从 Django 1.0 开始，您可以执行以下操作：

```
class Foo(models.Model):
    foo = models.ForeignKey(Bar, to_field='bar') 
```

这方面的文档在[这里](http://docs.djangoproject.com/en/dev/ref/models/fields/#django.db.models.ForeignKey.to_field)。

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2009-04-08T14:18:41.267

是和不是。FK 关系是在类级别描述的，并且镜像了数据库中的 FK 关联，所以不能直接在 FK 参数中添加额外的信息。

相反，我建议使用一个字符串来保存另一个表上的字段名称：

```
class ValidationRule(models.Model):
    other = models.ForeignKey(OtherModel)
    other_field = models.CharField(max_length=256) 
```

这样，您可以通过以下方式获取该字段：

```
v = ValidationRule.objects.get(id=1)
field = getattr(v, v.other_field) 
```

请注意，如果您使用多对多字段（而不是一对多），则内置支持创建自定义中间表以使用[through](http://docs.djangoproject.com/en/dev/ref/models/fields/#django.db.models.ManyToManyField.through)选项保存元数据。

# winforms - Windows 窗体 TreeView - PNG图像背景

> ID：730210
> 
> 赞同：0
> 
> 时间：2009-04-08T14:12:47.520
> 
> 标签：winforms, treeview, icons

我们正在使用 famfamfam png 图标。当 TreeNodes 被分配这些图像之一时，图标内有一个奇怪的蓝色背景。我们如何解决这个问题？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-08T14:32:16.787

这可能与PNG的位深度有关吗？

尝试以不同的深度导出它们，例如 32 位，并确保关联的 ImageList 设置为合理的深度（应该与图像匹配！-我建议一切都是 32 位的）。

如果做不到这一点，您始终可以使用 Owner Draw 功能，或者创建一个继承自 TreeView 的新组件。

# nhibernate - nhibernate：如何映射引用实体的组件？

> ID：730220
> 
> 赞同：3
> 
> 时间：2009-04-08T14:15:50.867
> 
> 标签：nhibernate, fluent-nhibernate, nhibernate-mapping

我的数据库看起来像这样：

```
MyEntity     State
-----        -----
id           id
street       name
stateId      ...
zip
status
... 
```

我的模型如下所示：

```
class MyEntity
{
     int id { get; set; }
     Address location { get; set; }
     string status { get; set; }
     // ...
}

class Address
{
    string street { get; set; }
    string zip { get; set; }
    State state { get; set; }
    // ...
}

class State
{
    int id { get; set; }
    string name { get; set; }
    // ...
} 
```

我对引用实体的地址组件有点不舒服。闻起来像个可怜的模型。是吗？如果没有，我将如何映射它（最好使用流利的 nhibernate）？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-08T15:09:41.597

我也不确定如何从组件中引用实体。我自己已经这样做了（与国家实体一样）。

至于映射，它非常简单：

```
public class MyEntityMap : ClassMap<MyEntity>
{
    public MyEntityMap()
    {
        Id(x => x.id);
        Component<Address>(x => x.location, c =>
        {
            c.Map(x => x.street);
            c.Map(x => x.zip);
            c.References<State>(x => x.state);
        });
        Map(x => x.status);
    }
} 
```

有时我所做的是为组件添加一个静态类以使 ClassMap 更好一点：

```
public static class NameMap
{
    public static Action<ComponentPart<Name>> AsComponent(string prefix)
    {
        return c =>
        {
            c.Map(x => x.Title, ColumnName(prefix, "Title"));
            // and so on
        };
    }
} 
```

在这种情况下，ColumnName 是一个简单的函数，它将前缀附加到列名（这在我使用的出色的遗留数据库中非常方便）。

然后在 ClassMap 中，您只需执行以下操作：

```
Component<Name>(x => x.Name, c => NameMap.AsComponent("prefix")); 
```

# visual-studio - 使用 VS2008 逐步调试经典 asp

> ID：730229
> 
> 赞同：1
> 
> 时间：2009-04-08T14:17:17.133
> 
> 标签：visual-studio, visual-studio-2008, debugging, asp-classic

我来自 django 世界来维护一个相当复杂的经典 asp 站点。不幸的是，该站点充斥着未注释、复制/粘贴的意大利面条代码，这些代码分布在数百个文件中，隐藏在几十个目录中。

简而言之，这有点像噩梦；）

无论如何，我最熟悉 eclipse，我想知道 Visual Studio 2008 是否可以提供您期望从如此多产的 IDE 中获得的那种调试功能。我可以逐行遍历这个 asp 应用程序，设置断点，并即时查看变量的内容吗？如果是这样怎么办？

如果我需要将所有内容添加到项目中，将其全部引入的最佳方式是什么？我有一段时间没用过 vs，但最后我检查了它喜欢向你的 Web 服务器添加很多文件。这仍然是一个问题吗？

非常感谢，我的理智可能取决于它哈哈

**编辑**：我应该注意我并没有使用vs2008，如果你知道其他你认为更好的调试工具，请告诉我！只要有文档，我就会使用任何东西:)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-08T14:20:53.333

尝试在[这里](http://blogs.msdn.com/mikhailarkhipov/archive/2005/06/24/432308.aspx)找到一些输入，似乎很有希望

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-09T02:41:47.017

1.  在 IIS7 中打开服务器端调试
2.  进入调试器的最快方法是写单词

    停止

在你的asp文件的某个地方。一旦你加载页面并被点击，调试器就会弹出。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-30T19:04:09.897

我可以让它工作...

[有人能用visual studio 2005或更高版本调试asp经典代码吗？](https://stackoverflow.com/questions/958968/has-anybody-been-able-to-debug-asp-classic-code-with-visual-studio-2005-or-later)

按照这些说明...

[http://www.codeproject.com/KB/debug/DebugVBScriptVS2008.aspx](http://www.codeproject.com/KB/debug/DebugVBScriptVS2008.aspx)

[http://codepagoda.com/2009/04/30/debugging-classic-asp-with-visual-studio-2008-sp1-and-35-framework/](http://codepagoda.com/2009/04/30/debugging-classic-asp-with-visual-studio-2008-sp1-and-35-framework/)

但是几天后它就崩溃了...

[我不能再用 Visual Studio 2008 调试经典的 asp 代码](https://stackoverflow.com/questions/1060780/i-can-no-longer-debug-classic-asp-code-with-visual-studio-2008)

我希望你比我有更多的运气

# java - 在 Java 中从“简单类名”转换为“完整类名”到对象的最佳方法

> ID：730232
> 
> 赞同：1
> 
> 时间：2009-04-08T14:18:13.420
> 
> 标签：java, string, reflection, class, jpa

所以假设我有一个对象，它存储在数据库中：

```
com.test.dummy.Cat 
```

猫有一个整数 id。

在我的“世界”之外，对对象的引用是以下形式的字符串：

猫 433

其中 433 是 Cats 分配的数据库 ID。

当我得到传递给我的字符串时，我需要能够在数据库中找到它。

所以我这样做：

```
String[] splitString = str.split("-");
String objectType = splitString[0];
Integer id = Integer.valueOf(splitString[1]); 
```

我的问题是：从**Cat**到**com.test.dummy.Cat**的最佳方法是什么，以便我可以对字符串执行 Class.forName() 并在数据库中找到该对象？

我在考虑某种 XML 映射，或硬编码的纯 Java 映射。我有哪些选择？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-08T14:21:37.203

地图，如 HashMap。它可以在代码中设置，或者可以为此目的使用多个类中的任何一个从文件中读取该对（例如，在 Spring 中）。

但从更大的角度来看，你的计划是脆弱的。你必须解析一个字符串，你必须假设你永远不会在另一个同名的 paxckage 中使用一个类，等等。

您可能需要重新考虑您在做什么，或者可能发布您的*目标*，而不是您的实施，作为一个问题。

来自OP的评论：

> 但既然我会控制从 SimpleName 到 ClassName 的映射，那真的会有问题吗？– cloutierm（2 分钟前）

在一个非常简单的玩具应用程序中，这*可能会*起作用。在一个真实的应用程序中，您会发现您正在使用具有相同简单名称的库类。

或者换一种说法，这样做你是在说，“我永远不会使用 Spring 类、Apache Commons 类甚至 java.lang 类，而不必通过 grep 查找名称冲突的代码。” 设计包是为了避免这种不可避免的类。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-08T14:48:08.463

如果您已经知道要从数据库中读取 Cat，为什么不将 Cat 表的 DAO 编码为在使用您读取的值填充之前创建一个新的 Cat()？

您将有一个工厂，它将为方法 getDatabaseObject(String reference) 返回一个“DatabaseObject”，该方法将拆分“Cat-433”名称，使用第一部分来决定调用哪个 DAO，第二部分用于在 DAO 的`DatabaseObject get(int uid);`方法中作为 UID 传入。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-16T20:41:09.067

假设您的类型在运行时被读入，您可以自动填充映射表，即

```
public class Cat {
...
  static {
    mapping.put("Cat", "xyz.Cat");
  }
...
} 
```

# f# - 可区分联合上的模式匹配

> ID：730234
> 
> 赞同：7
> 
> 时间：2009-04-08T14:18:34.573
> 
> 标签：f#

有没有办法对有区别的联合函数进行模式匹配，例如：-

```
type Test =
  | A of string
  | B of int
  | C of char

let DefaultTest t =
  match t with
  | A(_) -> A(null)
  | B(_) -> B(0)
  | C(_) -> C('\u0000')

let a = A |> DefaultTest 
```

显然，这段代码不是有效的 F#，因为 DefaultTest 接受一个 Test 类型的参数，而不是 'a -> Test。有没有办法在*不*为受歧视的工会指定值的情况下实现这一目标？

最终，我所追求的是一个输入'a -> Test类型的函数并输出Test（'a的默认值）的函数。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-08T14:55:30.037

我不清楚你在追求什么，但这有帮助吗？

```
type Foo =
    | A of int
    | B of string

let CallWithDefault f =
    let x = Unchecked.defaultof<_>
    f x

let defaultA = CallWithDefault A    
let defaultB = CallWithDefault B    
printfn "(%A) (%A)" defaultA defaultB 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-08T14:39:18.923

不知道你在追求什么，但类似：

```
let DefaultTest (t :obj) =
  match t with
  | :? (string->Test) as a -> Some (a null)
  | :? (int -> Test) as b -> Some (b 0)
  | :? (char -> Test) as c -> Some (c '\u0000')
  | _ -> Option.None 
```

可能对你有用...

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-08T14:32:49.280

当所有构造函数都具有相同的参数类型（例如 int）时，这可能会起作用。那么可以

> 匹配 t 0 的
> | 一个 0 -> ...
> | B 0 -> ...

# java - 您是否使用（或定义）非标准注释，以及出于什么原因。递归注释怎么样？

> ID：730240
> 
> 赞同：6
> 
> 时间：2009-04-08T14:19:59.110
> 
> 标签：java, annotations, javac

这个问题说明了一切。

对于专家来说，SUN java 5 编译器接受递归注释（与 langspec 相反）是否有原因，而后来的编译器不接受？*我的意思是，反对*递归注释的论据可能是什么。

编辑：*递归注释*类似于：

```
@Panel(layout=BorderLayout.class,
    nested={
        @Panel(region=NORTH, layout=FlowLayout.class, ...)
        @Panel(region=SOUTH, layout=FlowLayout.class, ...)
    }
) 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-08T14:52:33.897

首先——我不确定你所说的递归注释是什么意思。您是指可以包含对同一类型的其他注释的引用的注释吗？就像是

```
@Panel(layout=BorderLayout.class,
    nested={
        @Panel(region=NORTH, layout=FlowLayout.class, ...)
        @Panel(region=SOUTH, layout=FlowLayout.class, ...)
    }
) 
```

（如果可能的话，这将是我想使用它的一个例子......）

至于我对自定义注释（和处理器）的使用：代码生成。

请参阅[http://code.google.com/p/javadude/wiki/Annotations](http://code.google.com/p/javadude/wiki/Annotations)

例如，JavaBean 属性：

```
@Bean(
    properties={    
      @Property(name="name"),
      @Property(name="phone", bound=true),
      @Property(name="friend", type=Person.class, kind=PropertyKind.LIST)
    }
)
public class Person extends PersonGen {
    // generated superclass PersonGen will contain getters/setters
    //    field definitions, property change support...
} 
```

或混合示例

```
package sample;

import java.util.List;

public interface IFlightAgent {
    List<IFlight> getFlight();
    void reserve(IFlight flight);
}

public interface ICarAgent {
    List<ICar> getCars();
    void reserve(ICar car);
}

public interface IHotelAgent {
    List<IHotel> getHotels();
    void reserve(IHotel hotel);
}

package sample;

import com.javadude.annotation.Bean;
import com.javadude.annotation.Delegate;

@Bean(delegates = {
    @Delegate(type = IHotelAgent.class,
              property = "hotelAgent",
              instantiateAs = HotelAgentImpl.class),
    @Delegate(type = ICarAgent.class,
              property = "carAgent",
              instantiateAs = CarAgentImpl.class),
    @Delegate(type = IFlightAgent.class,
              property = "flightAgent",
              instantiateAs = FlightAgentImpl.class)
    }
)
public class TravelAgent extends TravelAgentGen
    implements IHotelAgent, ICarAgent, IFlightAgent
{
    // generated superclass TravelAgentGen will create instances
    //   of the "instantiateAs" classes and delegate the interface
    //   methods to them
} 
```

请参阅[Java 中注释处理的缺点？](https://stackoverflow.com/questions/687553/the-drawbacks-of-annotation-processing-in-java)以及我对它们使用的一些潜在问题的回答。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-08T14:58:59.030

我最近一直在使用注解，因为[Oracle Weblogic Server](http://en.wikipedia.org/wiki/Weblogic)大量使用它来修改 Java Web 服务的行为。[他们在这里](http://edocs.bea.com/wls/docs103/webserv_ref/annotations.html#wp1096221)定义的注释的完整列表。特别是，我最终最常使用他们的[Policy 注释](http://edocs.bea.com/wls/docs103/webserv_ref/annotations.html#wp1050414)，因为这是他们的安全模型所基于的；[您可以在他们的文档页面](http://edocs.bea.com/wls/docs103/webserv_sec/message.html#wp290608)上查看他们的详细示例。

我从未听说过递归注释。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-08T16:38:08.997

我确实使用非标准注释，最常见的是将类字段标记为自反过程的目标，例如 RPC 调用中的缓存或特定的初始化过程。然而，我从来不需要递归注释......而且我认为这有一个潜在的问题，因为注释需要在标准初始化程序准备好之前在类定义时处理......我认为这是主要的将注释内容限制为基本类型的原因......

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-01-23T19:08:37.670

我不知道有什么好的论据反对一般允许递归注释，除了你可能偶然编写的某些病理情况如果不被禁止可能会导致无限循环（在编译或运行时）。

javac 禁止递归注释定义仅仅是因为这是规范所要求的。规范在 JLS 的未来更新（例如，对于 JDK 7）中*应该说什么是另一回事。*

所以请阅读并投票：

[http://bugs.sun.com/view_bug.do?bug_id=6264216](http://bugs.sun.com/view_bug.do?bug_id=6264216)

# asp.net-mvc - 如何构建这个 ASP.NET n 层解决方案？

> ID：730246
> 
> 赞同：5
> 
> 时间：2009-04-08T14:21:01.197
> 
> 标签：asp.net-mvc, visual-studio-2008, architecture, workflow-foundation, n-tier-architecture

我在尝试布局我的 VS 解决方案时遇到问题，我想要一些建议。

目前，我的解决方案布局类似于以下项目：-

```
Foo.Models
Foo.Repositories
Foo.Services
Foo.Web (an ASP.NET MVC application) 
```

我的网站 ( `Foo.Web`) 调用`Foo.Services`命名空间上的各种方法。这里的想法是`Services`处理所有*业务逻辑*。`Model`命名空间只是`POCO`对象。`Repositories`命名空间是不言自明的。

*带有接口的构造函数依赖注入*处理了什么层需要什么组件的黑魔法。

> 问题：我希望在解决方案中添加一些 Windows Workflow Foundation (WWF) 代码，但将此 WWF 代码放在同一个 Foo.Services.dll 中。

为此，我需要制作另一个类型的项目`Workflow`。此工作流具有调用 Foo.Services 方法的活动。因此，我的网站现在必须调用服务方法或工作流方法来做事。

我希望网站只调用`Services`命名空间来做事。

毕竟，服务是 UI 和业务逻辑 IMO 之间的主要接口。我在技术上使用 WWF 的事实对于在 IUI 前端编码的人来说不应该是一个问题。

*由于工作流dll调用Services dll中的方法，因此Services dll由于循环依赖*不能调用Workflow中的方法。

我也无法将所有工作流代码移动到服务 dll 中，因为服务 dll 需要是一些特殊的项目类型（Windows 工作流类型）。

所以..我不知道该怎么办？

我怎样才能使消费者只引用商业内容的服务命名空间，而我在 WWF 中暗示这些商业内容的事实对消费者是隐藏的？

我是否需要制作一个 WWF 项目并将我的所有服务代码移入其中，扔掉旧的服务项目？这样做听起来不太可重用。如果我决定不使用 WWF 来处理某些管道操作并使用其他东西会发生什么？

这里有一些代码可以帮助解释。

```
HomeController.cs
public ActionResult Index()
{
   // StockService was created using constructor dependency injection.
   var viewData = _stockService.GetStocks(StockType.MostPopular);
   return (viewData)
}

StockService.cs
public class StockService : IStockService
{
    public IEnumerable<Stock> GetStocks(StockType stockType)
    {
        // Dependency Injection defines if the Pipeline is WWF
        // or something else (eg. plain ole functions).
        var stocks = _stockPipeline.GetStocks(stockType);

        // Cache result.

        // Update repostiory. (example of calling the repository)
        _sqlRepostiory.SaveSomeRandomData("Jon Skeet Was Here.");

        return stocks. // Returns a POCO.
    }
} 
```

谢谢窥视。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-08T14:39:45.863

你看过 Rob Connery 的 MVC Storefront/ [Kona](http://blog.wekeroad.com/kona/)项目吗？他正在[与 WF 做非常相似的事情](http://blog.wekeroad.com/mvc-storefront/mvcstore-part-19/)，他的项目也[以某种类似的方式布局](http://blog.wekeroad.com/mvc-storefront/mvcstore-part-19a/)。这可能是您正在做什么的[很好的指导。](http://blog.wekeroad.com/mvc-storefront/mvcstore-part-21/)我知道他在设计集成时确实与一些 Workflow Foundation 专家合作。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-08T14:42:03.970

一个可能的解决方案是添加一个“应用程序”层

```
Application ---> Services
                    ^
                    |
            \--> Workflow 
```

并从 UI 调用应用层。当然，在大多数情况下，应用层只会将调用转发到服务或工作流。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-08T14:55:23.313

仅供参考 - 可以修改非工作流项目以允许添加工作流类。详情[在这里](http://www.sadev.co.za/node/349)。

# asp.net - 我可以使用描述属性来分配标签文本吗？

> ID：730247
> 
> 赞同：0
> 
> 时间：2009-04-08T14:21:19.263
> 
> 标签：asp.net, asp.net-mvc, reflection, attributes

在 DTO 对象中，我想对呈现的 html 文本框的标签描述进行硬编码，以便我可以拥有一个像 TextBoxWithLabel 这样的 html 辅助函数，在其中我只传递对象，它会自动创建从描述属性中获取的标签。

```
 public class MessageDTO
{
    public int id { get; set; }
    [Description("Insert the title")]
    public string Title { get; set; }
    [Description("Description")]
    public string Body { get; set; }
} 
```

然后在我的视图页面中，我想调用：

```
<%=Html.TextBoxWithLabel<string>(dto.Title)%> 
```

并在渲染视图中获取

```
<label for="Title">Insert the title :</label>
<input id="Title" type="text" value="" name="Title"/> 
```

我认为要实现这一点，我应该使用反射。它是正确的还是会减慢视图渲染速度？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-08T14:32:28.907

您最好的选择是在 HtmlHelper 上编写一个扩展方法，该方法将使用反射从属性中获取属性。唯一的问题是传递 dto.Title 将传递字符串的值，并且您需要该属性。我认为您可能需要将对象和属性名称作为字符串传递。

```
public static string TextBoxWithLabel<T>(this HtmlHelper base, object obj, string prop)
{
    string label = "";
    string input = "<input type=\"text\" value\"\" name=\"" + prop + "\"";

    Type t = sender.GetType();
    PropertyInfo pi = t.GetProperty(prop);
    object[] array = pi.GetCustomAttributes(typeof(DescriptionAttribute), false);
    if (array.Length != 0)
        label = "<label>" + ((DescriptionAttribute)array[0]).Value + "</label>";
    return label + input;
} 
```

帮助器的确切语法可能是错误的，因为我是凭记忆做的，但你明白了。然后只需将扩展方法的命名空间导入页面即可使用此功能。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-08T14:31:06.070

是的，您需要通过反思阅读描述。是的，这会减慢渲染速度……一点点。只有分析才能告诉您减速是否足以值得担心。渲染页面其余部分的成本可能更高，所以如果渲染速度是一个问题，缓存整个页面可能比尝试优化读取描述属性更有意义。

执行此操作时，请记住 DescriptionAttribute 可以采用资源标识符以及文字标题。

# c# - “扔”和“扔前”有区别吗？

> ID：730250
> 
> 赞同：507
> 
> 时间：2009-04-08T14:22:12.800
> 
> 标签：c#, .net, exception, exception-handling

有一些帖子询问这两者之间的区别是什么。
（为什么我还要提这个……）

但是我的问题在某种程度上是不同的，我在另一种类似错误*的上帝般的*处理方法中称其为“throw ex”。

```
public class Program {
    public static void Main(string[] args) {
        try {
            // something
        } catch (Exception ex) {
            HandleException(ex);
        }
    }

    private static void HandleException(Exception ex) {
        if (ex is ThreadAbortException) {
            // ignore then,
            return;
        }
        if (ex is ArgumentOutOfRangeException) { 
            // Log then,
            throw ex;
        }
        if (ex is InvalidOperationException) {
            // Show message then,
            throw ex;
        }
        // and so on.
    }
} 
```

如果`try & catch`在中使用`Main`，那么我将使用`throw;`重新抛出错误。但是在上面的简化代码中，所有异常都会通过`HandleException`

内部调用时是否`throw ex;`与调用具有相同的效果？`throw``HandleException`

* * *

## 回答 #1

> 赞同：769
> 
> 时间：2009-04-08T14:24:56.460

是，有一点不同;

*   `throw ex`重置堆栈跟踪（因此您的错误似乎源自`HandleException`）
*   `throw`不会 - 原始罪犯将被保留。

    ```
    static void Main(string[] args)
    {
        try
        {
            Method2();
        }
        catch (Exception ex)
        {
            Console.Write(ex.StackTrace.ToString());
            Console.ReadKey();
        }
    }

    private static void Method2()
    {
        try
        {
            Method1();
        }
        catch (Exception ex)
        {
            //throw ex resets the stack trace Coming from Method 1 and propogates it to the caller(Main)
            throw ex;
        }
    }

    private static void Method1()
    {
        try
        {
            throw new Exception("Inside Method1");
        }
        catch (Exception)
        {
            throw;
        }
    } 
    ```

* * *

## 回答 #2

> 赞同：110
> 
> 时间：2009-04-22T11:29:47.483

（我之前发布过，@Marc Gravell 纠正了我）

这是差异的演示：

```
static void Main(string[] args) {
    try {
        ThrowException1(); // line 19
    } catch (Exception x) {
        Console.WriteLine("Exception 1:");
        Console.WriteLine(x.StackTrace);
    }
    try {
        ThrowException2(); // line 25
    } catch (Exception x) {
        Console.WriteLine("Exception 2:");
        Console.WriteLine(x.StackTrace);
    }
}

private static void ThrowException1() {
    try {
        DivByZero(); // line 34
    } catch {
        throw; // line 36
    }
}
private static void ThrowException2() {
    try {
        DivByZero(); // line 41
    } catch (Exception ex) {
        throw ex; // line 43
    }
}

private static void DivByZero() {
    int x = 0;
    int y = 1 / x; // line 49
} 
```

这是输出：

```
Exception 1:
   at UnitTester.Program.DivByZero() in <snip>\Dev\UnitTester\Program.cs:line 49
   at UnitTester.Program.ThrowException1() in <snip>\Dev\UnitTester\Program.cs:line 36
   at UnitTester.Program.TestExceptions() in <snip>\Dev\UnitTester\Program.cs:line 19

Exception 2:
   at UnitTester.Program.ThrowException2() in <snip>\Dev\UnitTester\Program.cs:line 43
   at UnitTester.Program.TestExceptions() in <snip>\Dev\UnitTester\Program.cs:line 25 
```

您可以看到，在异常 1 中，堆栈跟踪会返回到`DivByZero()`方法，而在异常 2 中则不会。

但是请注意，`ThrowException1()`和`ThrowException2()`中显示的行号是`throw`语句的行号，**而不是**调用的行号`DivByZero()`，这可能是有道理的，因为我考虑了一下......

### 释放模式下的输出

例外一：

```
at ConsoleAppBasics.Program.ThrowException1()
at ConsoleAppBasics.Program.Main(String[] args) 
```

例外 2：

```
at ConsoleAppBasics.Program.ThrowException2()
at ConsoleAppBasics.Program.Main(String[] args) 
```

它是否仅在调试模式下维护原始 stackTrace？

* * *

## 回答 #3

> 赞同：47
> 
> 时间：2012-06-27T15:26:48.403

其他答案是完全正确的，但我认为这个答案提供了一些额外的细节。

考虑这个例子：

```
using System;

static class Program {
  static void Main() {
    try {
      ThrowTest();
    } catch (Exception e) {
      Console.WriteLine("Your stack trace:");
      Console.WriteLine(e.StackTrace);
      Console.WriteLine();
      if (e.InnerException == null) {
        Console.WriteLine("No inner exception.");
      } else {
        Console.WriteLine("Stack trace of your inner exception:");
        Console.WriteLine(e.InnerException.StackTrace);
      }
    }
  }

  static void ThrowTest() {
    decimal a = 1m;
    decimal b = 0m;
    try {
      Mult(a, b);  // line 34
      Div(a, b);   // line 35
      Mult(b, a);  // line 36
      Div(b, a);   // line 37
    } catch (ArithmeticException arithExc) {
      Console.WriteLine("Handling a {0}.", arithExc.GetType().Name);

      //   uncomment EITHER
      //throw arithExc;
      //   OR
      //throw;
      //   OR
      //throw new Exception("We handled and wrapped your exception", arithExc);
    }
  }

  static void Mult(decimal x, decimal y) {
    decimal.Multiply(x, y);
  }
  static void Div(decimal x, decimal y) {
    decimal.Divide(x, y);
  }
} 
```

如果取消注释该`throw arithExc;`行，则输出为：

```
Handling a DivideByZeroException.
Your stack trace:
   at Program.ThrowTest() in c:\somepath\Program.cs:line 44
   at Program.Main() in c:\somepath\Program.cs:line 9

No inner exception. 
```

当然，您丢失了有关异常发生位置的信息。相反，如果您使用该`throw;`行，这就是您得到的：

```
Handling a DivideByZeroException.
Your stack trace:
   at System.Decimal.FCallDivide(Decimal& d1, Decimal& d2)
   at System.Decimal.Divide(Decimal d1, Decimal d2)
   at Program.Div(Decimal x, Decimal y) in c:\somepath\Program.cs:line 58
   at Program.ThrowTest() in c:\somepath\Program.cs:line 46
   at Program.Main() in c:\somepath\Program.cs:line 9

No inner exception. 
```

这要好得多，因为现在您看到它是`Program.Div`导致您出现问题的方法。但是仍然很难看出这个问题是出自`try`区块中的第 35 行还是第 37 行。

如果您使用第三种选择，包装在一个外部异常中，您不会丢失任何信息：

```
Handling a DivideByZeroException.
Your stack trace:
   at Program.ThrowTest() in c:\somepath\Program.cs:line 48
   at Program.Main() in c:\somepath\Program.cs:line 9

Stack trace of your inner exception:
   at System.Decimal.FCallDivide(Decimal& d1, Decimal& d2)
   at System.Decimal.Divide(Decimal d1, Decimal d2)
   at Program.Div(Decimal x, Decimal y) in c:\somepath\Program.cs:line 58
   at Program.ThrowTest() in c:\somepath\Program.cs:line 35 
```

特别是，您可以看到导致问题的是**第 35 行。**但是，这需要人们去搜索`InnerException`，在简单的情况下使用内部异常感觉有些间接。

在[这篇博](http://weblogs.asp.net/fmarguerie/archive/2008/01/02/rethrowing-exceptions-and-preserving-the-full-call-stack-trace.aspx)`internal`文中，他们通过调用（通过反射）对象的实例方法`InternalPreserveStackTrace()`来保留行号（try 块的行）`Exception`。但是这样使用反射并不好（.NET Framework 可能`internal`有一天会在没有警告的情况下更改其成员）。

* * *

## 回答 #4

> 赞同：37
> 
> 时间：2020-12-19T03:09:37.830

**Throw**保留堆栈跟踪。所以假设 Source1 throws Error1 ，它被 Source2 捕获，Source2 说 throw then Source1 Error + Source2 Error 将在堆栈跟踪中可用。

**Throw ex**不会保留堆栈跟踪。所以 Source1 的所有错误都会被清除，只有 Source2 错误会发送给客户端。

有时只是阅读内容不清楚，建议观看此视频演示以获得更清晰的内容，[Throw vs Throw ex in C#](https://www.youtube.com/watch?v=WGwOd6yMja4)。

[![投掷与投掷前任](https://i.stack.imgur.com/6DMcn.png)](https://i.stack.imgur.com/6DMcn.png)

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2009-04-08T14:27:11.633

当您这样做`throw ex`时，抛出的异常将成为“原始”异常。所以所有以前的堆栈跟踪都不会存在。

如果你这样做`throw`了，异常就会继续*下去*，你会得到完整的堆栈跟踪。

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2017-12-05T11:50:24.370

让我们了解 throw 和 throw ex 之间的区别。我听说在许多.net 采访中，这个常见的问题都被问到了。

只是为了概述这两个术语， throw 和 throw ex 都用于了解异常发生的位置。Throw ex 重写异常的堆栈跟踪，而与实际抛出的位置无关。

让我们通过一个例子来理解。

让我们先了解一下 Throw。

```
static void Main(string[] args) {
    try {
        M1();
    } catch (Exception ex) {
        Console.WriteLine(" -----------------Stack Trace Hierarchy -----------------");
        Console.WriteLine(ex.StackTrace.ToString());
        Console.WriteLine(" ---------------- Method Name / Target Site -------------- ");
        Console.WriteLine(ex.TargetSite.ToString());
    }
    Console.ReadKey();
}

static void M1() {
    try {
        M2();
    } catch (Exception ex) {
        throw;
    };
}

static void M2() {
    throw new DivideByZeroException();
} 
```

上面的输出如下。

显示实际抛出异常的完整层次结构和方法名称。它是 M2 -> M2。连同行号

![在此处输入图像描述](https://i.stack.imgur.com/wUu6g.png)

其次..让我们通过 throw ex 来理解。只需在 M2 方法 catch 块中将 throw 替换为 throw ex。如下。

![在此处输入图像描述](https://i.stack.imgur.com/GlLqc.png)

throw ex 代码的输出如下..

![在此处输入图像描述](https://i.stack.imgur.com/V575m.png)

您可以看到输出中的差异.. throw ex 只是忽略所有先前的层次结构并使用写入 throw ex 的行/方法重置堆栈跟踪。

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2009-04-08T14:26:59.543

不，这将导致异常具有不同的堆栈跟踪。只有在处理程序中使用`throw`没有任何异常的对象`catch`才会使堆栈跟踪保持不变。

您可能希望从 HandleException 返回一个布尔值，是否应重新抛出异常。

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2018-04-06T13:30:18.970

**Microsoft Docs 代表**：

> 一旦抛出异常，它携带的部分信息就是堆栈跟踪。堆栈跟踪是方法调用层次结构的列表，它以引发异常的方法开始，以捕获异常的方法结束。如果通过在语句中指定异常重新引发异常`throw`，则堆栈跟踪将在当前方法处重新启动，并且引发异常的原始方法与当前方法之间的方法调用列表将丢失。要保留带有异常的原始堆栈跟踪信息，请使用`throw`不指定异常的语句。

资料来源：[https ://docs.microsoft.com/en-us/dotnet/fundamentals/code-analysis/quality-rules/ca2200](https://docs.microsoft.com/en-us/dotnet/fundamentals/code-analysis/quality-rules/ca2200)

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2014-07-18T20:33:08.563

看这里：[http ://blog-mstechnology.blogspot.de/2010/06/throw-vs-throw-ex.html](http://blog-mstechnology.blogspot.de/2010/06/throw-vs-throw-ex.html)

**投掷**：

```
try 
{
    // do some operation that can fail
}
catch (Exception ex)
{
    // do some local cleanup
    throw;
} 
```

它使用异常保留堆栈信息

这被称为“重新抛出”

如果想抛出新的异常，

```
throw new ApplicationException("operation failed!"); 
```

**投掷前**：

```
try
{
    // do some operation that can fail
}
catch (Exception ex)
{
    // do some local cleanup
    throw ex;
} 
```

它不会发送异常堆栈信息

这被称为“打破堆栈”

如果想抛出新的异常，

```
throw new ApplicationException("operation failed!",ex); 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2020-12-03T02:37:41.200

最好使用`throw`而不是`throw ex`.

throw ex 重置原始堆栈跟踪，并且找不到之前的堆栈跟踪。

如果我们使用 throw，我们将获得完整的堆栈跟踪。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2017-02-01T07:04:12.953

为了让您对此有不同的看法，如果您向客户端提供 API 并且想要为内部库提供详细的堆栈跟踪信息，则使用 throw 特别有用。通过在此处使用 throw，我将在 File.Delete 的 System.IO.File 库的这种情况下获得堆栈跟踪。如果我使用 throw ex，那么该信息将不会传递给我的处理程序。

```
static void Main(string[] args) {            
   Method1();            
}

static void Method1() {
    try {
        Method2();
    } catch (Exception ex) {
        Console.WriteLine("Exception in Method1");             
    }
}

static void Method2() {
    try {
        Method3();
    } catch (Exception ex) {
        Console.WriteLine("Exception in Method2");
        Console.WriteLine(ex.TargetSite);
        Console.WriteLine(ex.StackTrace);
        Console.WriteLine(ex.GetType().ToString());
    }
}

static void Method3() {
    Method4();
}

static void Method4() {
    try {
        System.IO.File.Delete("");
    } catch (Exception ex) {
        // Displays entire stack trace into the .NET 
        // or custom library to Method2() where exception handled
        // If you want to be able to get the most verbose stack trace
        // into the internals of the library you're calling
        throw;                
        // throw ex;
        // Display the stack trace from Method4() to Method2() where exception handled
    }
} 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2021-08-12T19:49:52.197

为了扩展 Lucero 的答案，您可以在不丢失原始堆栈跟踪的情况下完成原始代码的意图。

```
public class Program {
    public static void Main(string[] args) {
        try {
            // something
        } catch (Exception ex) {
            if (!HandleException(ex)) throw;
        }
    }

    /// <returns>
    ///   true if the exception has been handled;
    ///   false if exception should be passed along
    /// </returns>
    private static bool HandleException(Exception ex) {
        if (ex is ThreadAbortException) {
            // ignore then,
            return true;
        }
        if (ex is ArgumentOutOfRangeException) { 
            // Log then,
            return false;
        }
        if (ex is InvalidOperationException) {
            // Show message then,
            return false;
        }
        // and so on.
    }
} 
```

* * *

## 回答 #13

> 赞同：-1
> 
> 时间：2016-12-01T08:49:44.200

```
int a = 0;
try {
    int x = 4;
    int y ;
    try {
        y = x / a;
    } catch (Exception e) {
        Console.WriteLine("inner ex");
        //throw;   // Line 1
        //throw e;   // Line 2
        //throw new Exception("devide by 0");  // Line 3
    }
} catch (Exception ex) {
    Console.WriteLine(ex);
    throw ex;
} 
```

1.  如果所有第 1 ,2 和 3 行都被注释 - 输出 - 内部 ex

2.  如果所有第 2 行和第 3 行都被注释 - 输出 - 内部 ex System.DevideByZeroException: {"Attempted to 除以零。"}---------

3.  如果注释了所有第 1 行和第 2 行 - 输出 - 内部 ex System.Exception：除以 0 ----

4.  如果所有第 1 行和第 3 行都被注释 - 输出 - 内部 ex System.DevideByZeroException: {"Attempted to 除以零。"}---------

并且 StackTrace 将在 throw ex 的情况下被重置；

# c++ - C++ Intellisense 和错误检查的问题

> ID：730253
> 
> 赞同：0
> 
> 时间：2009-04-08T14:24:41.827
> 
> 标签：c++, visual-c++, intellisense

使用 Visual C++ 2008。第一次，我正在尝试从 C# 交叉并想尝试一下。除了一些像智能块和一些颜色这样的东西之外，我没有改变太多基本设置。因为我在 C++ 知识上的水平为零，所以我所做的所有谷歌搜索都超出了我的想象。

**问题的第 1 部分** 我的问题是我刚刚创建了我的第一个 Windows 窗体项目。现在我双击并进入这样的内容，智能感知没有列出任何成员？

```
private: System::Void executeDocumentationCmd_Click(System::Object^  sender, System::EventArgs^  e) 
{
this. NOTHING POPS UP?
} 
```

如果我输入`MessageBox::`，那么它将弹出智能感知 for `Show`。这是正常的吗？我发现它很有帮助，因为我正在学习基础知识，让它列出可用的 txt 框和成员，但它不会像在 C# intellisense 中那样做。

我已经`stdafx.h`包括在内。我根据在线帮助删除了 ncb 文件并重新启动，什么也没有。额外的标题？

**问题的第 2 部分**：在 C# 编辑中实时编码中没有下划线错误。这是 C++ express 的一个特性（编译前的错误检查）吗？当我输入错误信息时，我没有看到列出的任何警告或错误。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-08T14:29:25.560

`this``->`在 C++ 中是一个被not取消引用的指针`.`

此外，VS2008 中 C++ 的智能感知不如 C# 有用，这包括没有错误检查。VS2010 将为 C++ 引入内联错误检查。

您需要注意 C# 和 C++ 之间的一些非常大的差异。这是一个很大的话题，所以我不认为这里的帖子可以总结它们，但两个重要的点是缺乏垃圾收集（查找`delete`关键字）和指针。指针存在于 C# 中，但它们仅在`unsafe`代码块中可用，而在 C++ 中，指针几乎是王道。您可能想投资一本书来帮助您学习。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-08T16:14:07.913

仅供参考，根据您的代码片段，您实际上并没有使用 C++，而是 C++/CLI，这是一种不同的语言。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-08T14:44:33.433

从历史上看，C++ 专门设计为与 C 兼容，而 C# 和 Java 则不兼容。一个后果是 C++ 难以解析，因此 C++ 的智能感知工作比 C# 更难。我觉得它很不稳定，希望它在 VS 2010 中会更好。

此外，与大多数语言相比，C 和 C++ 在变量和指针之间的区别要大得多。我不熟悉 C#，但在 Java 和 Common Lisp 等语言中，几乎所有内容都是指针，因此没有特殊符号。当我使用 Pascal 时，很少有事情是用指针完成的。C 和 C++ 是我使用过的最容易混淆的语言。它们还允许指针算术，这是很多错误的原因。

我不认为任何一种语言都是一种非常好的语言，只是为了尝试从中滑入 C++。我建议，只要您对 C++ 感兴趣，您就可以像学习一门新语言一样学习它。得到一个很好的现代介绍。

# html - 蜗牛邮件地址的 HTML

> ID：730254
> 
> 赞同：5
> 
> 时间：2009-04-08T14:24:50.253
> 
> 标签：html, markup, street-address, microdata, microformats

您认为标记蜗牛邮件地址的最佳方法是什么？我发现了一些不同的选项，例如：

```
<div class="address">
<span class="name">Mr. Bob</span><br/>
<span class="street">45654 Bob Ln</span><br/>
<span class="city">Imaginery</span>,<span class="state">OH</span><br/>
<span class="postalCode">44321</span>
</div> 
```

我还看到了使用地址标签而不是 div 的上一个示例。我发现的另一个选择是：

```
<div class="address">
  <p>Mr. Bob</p>
  <p>45654 Bob Ln</p>
  <p>Imaginery, OH</p>
  <p>44321</p>
</div> 
```

所以我的问题是你认为表达蜗牛邮件地址的最佳标记是什么？不要局限于我的例子。

我觉得第一个是最好的选择，因为它提供了关于每个元素的额外上下文。在这种情况下，我也觉得 br 是内容的一部分。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-04-08T14:28:45.780

使用 adr 微格式：

[http://microformats.org/wiki/adr](http://microformats.org/wiki/adr)

如果您还想标记人名，请使用 hCard：

[http://microformats.org/wiki/hcard](http://microformats.org/wiki/hcard)

其中包括 adr。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-04-08T14:26:50.903

[`<address>`](http://www.w3schools.com/TAGS/tag_address.asp)标签呢？

**编辑：**

看来评论者是正确的，此标签通常用于表示页面或表单作者的联系信息。

从[HTML 4.1 规范](http://www.w3.org/TR/html401/struct/global.html#edef-ADDRESS)...

> 作者可以使用 ADDRESS 元素来提供文档或文档的主要部分（例如表格）的联系信息。此元素通常出现在文档的开头或结尾。

因此，如果您显示的是*您的*地址，请使用此地址。否则，请使用**singpolyma**建议的内容。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-09T09:01:01.583

使用`<br>`s 肯定比`<p>`s 更正确；对于类名，我遵循 singpolyma。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-08T14:30:03.703

第一个是使用[http://microformats.org/wiki/adr](http://microformats.org/wiki/adr)的示例，这将是理想的，因为它是一个相当广泛接受的索引标准。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2013-05-01T21:30:31.623

看起来[微数据](http://html5doctor.com/nav-element/)是今天的推荐标准。

以下是 Google 关于在搜索结果中为组织创建“丰富片段”的方式的提示：[丰富片段 - 组织](http://support.google.com/webmasters/bin/answer.py?hl=en&answer=146861)。建议的微数据标记示例：

```
<div itemscope itemtype="http://data-vocabulary.org/Organization"> 
    <span itemprop="name">L’Amourita Pizza</span>
    Located at 
    <span itemprop="address" itemscope 
      itemtype="http://data-vocabulary.org/Address">
      <span itemprop="street-address">123 Main St</span>, 
      <span itemprop="locality">Albuquerque</span>, 
      <span itemprop="region">NM</span>.
    </span>
    Phone: <span itemprop="tel">206-555-1234</span>.
    <a href="http://www.example.com" itemprop="url">http://pizza.example.com</a>.
</div> 
```

此外，我会将[`<address>`](http://html5doctor.com/the-address-element/)HTML 元素用作地址详细信息的容器，而不仅仅是通用的`<span>`（即`<address itemprop="address" ...>`vs `<span itemprop="address" ...>`）

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-08T14:27:58.653

听起来您正在寻找能够获取数据的自动化系统的东西。我同意第一个解决方案要好得多。它确保为数据分配了意义。它还确保您可以添加以后没有想到的字段，例如地址行 2。

* * *

## 回答 #7

> 赞同：-2
> 
> 时间：2009-04-09T09:23:46.940

我个人会使用无序列表：

```
<ul id="sender_address" class="address">
    <li class="address_as">Mr. Bob Smith</li>
    <li class="street">67 Some Street</li>
    <li class="post_town">Foo City"</li>
    <li class="postcode">X11 1XX</li>
</ul> 
```

这将限制从您在示例中使用的更常用的标签继承任何未使用的样式。至于必须为地址的每一行指定一个类，这取决于标记的使用是可选的。您可以简单地使用“地址”类或使用无序列表的 id 设置整个地址的样式。

# java - 在 Web 服务中包装存储过程的最简单方法是什么？

> ID：730258
> 
> 赞同：3
> 
> 时间：2009-04-08T14:25:50.280
> 
> 标签：java, eclipse, web-services, stored-procedures, jboss

我们有一个 Legacy 系统，其中包含许多我们希望将其作为 Web 服务公开给其他应用程序的存储过程。我们正在使用 JBoss 构建 Web 服务。存储过程可以从 Oracle、DB2 或 MS SQL Server 数据库运行。

JDeveloper 有一个向导来生成存根并将其部署到将在 Oracle App Server (OC4J) 上运行的 ear 文件。我们正在迁移到 JBoss 并使用 Eclipse 作为我们选择的 IDE。

我宁愿使用框架，然后自己重​​建和维护基础设施。理想情况下，我想使用开源库或 JBoss 工具/IDE 根据连接池定义和存储过程名称生成 Web 服务。

我有哪些选择？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-08T18:23:38.680

如果存储过程不是为了直接公开为 Web 服务操作而编写的，那么公开它们可能是一个非常糟糕的主意。如果直接调用它们，它们可能会做出不正确的假设。

另一种方法是根据需求设计一个外部 API。如果事实证明实现一个特定操作的最佳方式是调用存储过程，那么就这样做。如果事实证明实现所有操作的最佳方法是调用现有的存储过程，那么您是对的，我只是在浪费您的时间。

但是我认为很可能会有一些操作不是通过直接调用现有的存储过程来实现最好的。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-13T23:25:50.257

您可能想要调查 EJB 在此上下文中的使用。所有 J2EE 1.4 容器都应该支持[JSR 109](http://jcp.org/en/jsr/detail?id=109)，它允许将 EJB 公开为 Web 服务。

特别是，您可以将存储过程调用包装在无状态会话 EJB 中，然后将 EJB 公开为 Web 服务。

[OC4J 10.1.3](http://download-east.oracle.com/docs/cd/B25221_04/web.1013/b14434/devejbs.htm#BABHJDFF)和[JBoss 4](http://docs.jboss.org/jbossas/jboss4guide/r2/html/ch12.html#d0e28846)支持这种部署模型。任何其他符合 J2EE 1.4 的容器也是如此。您只需查找有关*如何*在该容器上重新配置（而不是重新编码）应用程序的支持文档。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-08T20:45:47.467

[我从 WS02中找到了一个名为](http://wso2.org/projects/solutions/data-services/java)[*Data Services*](http://wso2.org/projects/solutions/data-services/java)的开源（Apache 许可）框架。有没有人试过这个？有任何建议/提示/警告吗？

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-11T10:32:23.427

不确定你会找到你正在寻找的东西，所以，如果你自己写东西是不可能的，这里有两种选择：

1.  使用将接收 SP 名称、参数并调用该过程的通用 Web 服务。这对调用者不是很友好，也不是类型安全的，但它会完成工作。

2.  使用两步法。第一步 - 将存储过程包装在 Java 类（POJO 或 EJB）中。第二步 - 使用非常流行、经过尝试和测试的 Apache Axis2 将类公开为 Web 服务。

通过快速搜索，我们得到了[这个用于将 SP 包装在 EJB 中的框架](http://www.ohloh.net/p/ejb3spwrapper)，但我自己还没有测试过。此外，我认为一些供应商为此目的拥有专有工具。当然，这是一个简单得多的问题。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-16T20:28:02.217

在 JBoss 下，公开这些服务的最简单方法是使用 EJB3 无状态会话 bean。使用此模型，您可以获得许多可以提供帮助的附加功能（资源池、事务支持等）。

```
@WebService
@SOAPBinding(style = Style.RPC)
public interface StoredProcedureWrapper extends Remote {
        String invokeStoredProc();
}

@Stateless
@WebService(endpointInterface = "path.to.StoredProcedureWrapper")
@Remote(StoredProcedureWrapper.class)
public class StoredProcedureWrapperBean {
        public String StoredProcedureWrapper() {
                // do business logic
                return "success";
        }
} 
```

# windows - 如何找到 Apache 的 httpd.exe 的安装位置？

> ID：730259
> 
> 赞同：5
> 
> 时间：2009-04-08T14:26:15.100
> 
> 标签：windows, apache

如何最好地确定 Windows 机器上是否安装了 Apache 以及安装在何处？

我正在编写一个使用已安装 apache 的脚本，但设置它自己的配置和服务器根目录，我不想硬编码它也不想让用户明确设置它（除非必要）。

我试图搜索注册表，但找不到任何有用的东西。

**更新那些发布默认路径的人**

在我的机器上，它位于 C:/Program Files/Apache Software Foundation/Apache2.2 中。如果我有 Vista 64 位，它可能在“程序文件 (x86)”下。如果计算机没有英文操作系统，那就更糟了。

**解决方法**

猜猜我必须检查 %PROGRAMFILES% 以获取 Apache 2.0 或 2.2 的默认路径，然后返回到提示符。阅读注册表并找出它的确切位置真是太好了。

**最后说明**

没有为“每个人”安装 Apache，而只是为当前用户安装了 Apache。这使得查找变得更加困难，因为没有服务或注册表项/文件夹指向那里。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2018-12-24T02:26:17.890

您也可以在 services.msc 中获取服务 exe 的路径。

（我的 apache 出于某种原因安装在 AppData 中。不知道为什么是因为我使用巧克力安装）

[![在此处输入图像描述](https://i.stack.imgur.com/v1tns.png)](https://i.stack.imgur.com/v1tns.png)

然后

[![在此处输入图像描述](https://i.stack.imgur.com/Hwthb.png)](https://i.stack.imgur.com/Hwthb.png)

然后

[![在此处输入图像描述](https://i.stack.imgur.com/K4p37.png)](https://i.stack.imgur.com/K4p37.png)

PS：对不起，关于用户界面中的葡萄牙语。但我想这仍然可以理解。

--

***编辑***

以编程方式，您可以在 cmd 中运行此行并检查它是否有帮助：`wmic service get PathName | findstr apache`

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-08T14:39:27.160

不是一个真正的答案，但如果我是你，我只会使用默认路径（%PROGRAMFILES%\Apache Group\Apache2\bin\Apache.exe）或几个相对安全的默认路径，并提示可执行文件是否为未找到。

否则，它可能会进行完全意外的安装。我讨厌“太聪明”的程序。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-14T18:27:38.487

我显然只为我（当前用户）安装了 Apache，而不是为我机器上的所有用户安装 Apache，因此没有注册表项。

如果为所有用户安装，则注册表项在此处：

```
HKEY_LOCAL_MACHINE\SOFTWARE\Apache Software Foundation\Apache\2.2.xx\ServerRoot 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-10-18T06:03:06.717

在 HKLM\Services\CurrentControlSet 下的注册表中搜索 httpd.exe。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-08T14:33:21.683

在 Windows 上，它安装在 c:/Program Files/Apache Group/Apache2/bin/Apache.exe

其余目录（conf、log、doc-root 等）位于 c:/Program Files/Apache Group/Apache2 下

# c# - 唯一的随机字符串生成

> ID：730268
> 
> 赞同：104
> 
> 时间：2009-04-08T14:27:33.663
> 
> 标签：c#, random

我想生成随机的唯一字符串，例如由 MSDN 库生成的字符串。（[错误对象](http://msdn.microsoft.com/en-us/library/t9zk6eay.aspx)）。应该生成一个像 't9zk6eay' 这样的字符串。

* * *

## 回答 #1

> 赞同：180
> 
> 时间：2012-01-25T01:24:37.810

**更新 2016/1/23**

如果您觉得这个答案有用，您可能会对[我发布的一个简单（~500 SLOC）密码生成库](https://github.com/mkropat/MlkPwgen)感兴趣：

```
Install-Package MlkPwgen 
```

然后你可以像下面的答案一样生成随机字符串：

```
var str = PasswordGenerator.Generate(length: 10, allowed: Sets.Alphanumerics); 
```

该库的一个优点是代码被更好地分解，因此您可以使用安全随机性[来生成字符串之外的更多内容](http://www.codetinkerer.com/MlkPwgen/.net/html/e684d93b-fe9b-ca4a-f0a7-c23af59ab5e9.htm)。查看[项目网站](https://github.com/mkropat/MlkPwgen)了解更多详情。

### 原始答案

由于还没有人提供安全代码，因此我发布以下内容以防有人发现它有用。

```
string RandomString(int length, string allowedChars = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789") {
    if (length < 0) throw new ArgumentOutOfRangeException("length", "length cannot be less than zero.");
    if (string.IsNullOrEmpty(allowedChars)) throw new ArgumentException("allowedChars may not be empty.");

    const int byteSize = 0x100;
    var allowedCharSet = new HashSet<char>(allowedChars).ToArray();
    if (byteSize < allowedCharSet.Length) throw new ArgumentException(String.Format("allowedChars may contain no more than {0} characters.", byteSize));

    // Guid.NewGuid and System.Random are not particularly random. By using a
    // cryptographically-secure random number generator, the caller is always
    // protected, regardless of use.
    using (var rng = System.Security.Cryptography.RandomNumberGenerator.Create()) {
        var result = new StringBuilder();
        var buf = new byte[128];
        while (result.Length < length) {
            rng.GetBytes(buf);
            for (var i = 0; i < buf.Length && result.Length < length; ++i) {
                // Divide the byte into allowedCharSet-sized groups. If the
                // random value falls into the last group and the last group is
                // too small to choose from the entire allowedCharSet, ignore
                // the value in order to avoid biasing the result.
                var outOfRangeStart = byteSize - (byteSize % allowedCharSet.Length);
                if (outOfRangeStart <= buf[i]) continue;
                result.Append(allowedCharSet[buf[i] % allowedCharSet.Length]);
            }
        }
        return result.ToString();
    }
} 
```

感谢 Ahmad 指出如何让代码在 .NET Core 上运行。

* * *

## 回答 #2

> 赞同：94
> 
> 时间：2009-04-08T14:58:02.467

使用 Guid 将是一个很好的方法，但要获得类似于您的示例的内容，您可能希望将其转换为 Base64 字符串：

```
 Guid g = Guid.NewGuid();
    string GuidString = Convert.ToBase64String(g.ToByteArray());
    GuidString = GuidString.Replace("=","");
    GuidString = GuidString.Replace("+",""); 
```

我去掉了“=”和“+”来更接近你的例子，否则你会在字符串的末尾得到“==”，在中间得到一个“+”。这是一个示例输出字符串：

“OZVV5TpP4U6wJthaCORZEQ”

* * *

## 回答 #3

> 赞同：39
> 
> 时间：2009-04-08T14:42:35.670

我会提醒 GUID**不是随机数**。它们不应被用作生成任何您期望完全随机的东西的基础（请参阅[http://en.wikipedia.org/wiki/Globally_Unique_Identifier](http://en.wikipedia.org/wiki/Globally_Unique_Identifier)）：

> WinAPI GUID 生成器的密码分析表明，由于 V4 GUID 的序列是伪随机的，给定初始状态，可以预测函数 UuidCreate 返回的多达下 250 000 个 GUID。这就是为什么不应在密码学中使用 GUID，例如，作为随机密钥。

相反，只需使用 C# Random 方法。像这样的东西（[代码在这里找到](http://www.c-sharpcorner.com/UploadFile/mahesh/RandomNumber11232005010428AM/RandomNumber.aspx)）：

```
private string RandomString(int size)
{
  StringBuilder builder = new StringBuilder();
  Random random = new Random();
  char ch ;
  for(int i=0; i<size; i++)
  {
    ch = Convert.ToChar(Convert.ToInt32(Math.Floor(26 * random.NextDouble() + 65))) ;
    builder.Append(ch);
  }
  return builder.ToString();
} 
```

如果您想要一些**独特**的东西（如数据库中的唯一文件名或密钥），GUID 很好，但它们不适合您想要**随机**的东西（如密码或加密密钥）。所以这取决于你的应用程序。

**编辑**. 微软说 Random 也不是很好（[http://msdn.microsoft.com/en-us/library/system.random(VS.71).aspx](http://msdn.microsoft.com/en-us/library/system.random(VS.71).aspx)）：

> 例如，要生成适合创建随机密码的加密安全随机数，请使用派生自 System.Security.Cryptography.RandomNumberGenerator 的类，例如 System.Security.Cryptography.RNGCryptoServiceProvider。

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2009-04-08T14:33:34.660

我不认为它们真的是随机的，但我的猜测是那些是一些哈希值。

每当我需要一些随机标识符时，我通常使用一个 GUID 并将其转换为它的“裸”表示：

```
Guid.NewGuid().ToString("n"); 
```

* * *

## 回答 #5

> 赞同：13
> 
> 时间：2014-10-09T16:16:42.593

我简化了@Michael Kropats 解决方案并制作了一个LINQ 风格的版本。

```
string RandomString(int length, string alphabet = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789")
{       
    var outOfRange = byte.MaxValue + 1 - (byte.MaxValue + 1) % alphabet.Length;

    return string.Concat(
        Enumerable
            .Repeat(0, int.MaxValue)
            .Select(e => RandomByte())
            .Where(randomByte => randomByte < outOfRange)
            .Take(length)
            .Select(randomByte => alphabet[randomByte % alphabet.Length])
    );
}

byte RandomByte()
{
    using (var randomizationProvider = new RNGCryptoServiceProvider())
    {
        var randomBytes = new byte[1];
        randomizationProvider.GetBytes(randomBytes);
        return randomBytes.Single();
    }   
} 
```

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2016-08-24T07:23:22.190

**尝试 Guid 和 Time.Ticks 之间的组合**

```
 var randomNumber = Convert.ToBase64String(Guid.NewGuid().ToByteArray()) + DateTime.Now.Ticks;
     randomNumber = System.Text.RegularExpressions.Regex.Replace(randomNumber, "[^0-9a-zA-Z]+", ""); 
```

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2018-09-11T15:34:27.400

我很惊讶为什么没有 CrytpoGraphic 解决方案。***GUID 是唯一的，但不是密码安全***的。[请参阅此 Dotnet Fiddle。](https://dotnetfiddle.net/0daqVS)

```
var bytes = new byte[40]; // byte size
using (var crypto = new RNGCryptoServiceProvider())
  crypto.GetBytes(bytes);

var base64 = Convert.ToBase64String(bytes);
Console.WriteLine(base64); 
```

如果您想在前面添加一个 Guid：

```
var result = Guid.NewGuid().ToString("N") + base64;
Console.WriteLine(result); 
```

更简洁的字母数字字符串：

```
result = Regex.Replace(result,"[^A-Za-z0-9]","");
Console.WriteLine(result); 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2018-03-19T12:56:00.547

这对我来说很完美

```
 private string GeneratePasswordResetToken()
    {
        string token = Guid.NewGuid().ToString();
        var plainTextBytes = System.Text.Encoding.UTF8.GetBytes(token);
        return Convert.ToBase64String(plainTextBytes);
    } 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2015-03-05T21:11:15.130

VB.net 中的 Michael Kropats 解决方案

```
Private Function RandomString(ByVal length As Integer, Optional ByVal allowedChars As String = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789") As String
    If length < 0 Then Throw New ArgumentOutOfRangeException("length", "length cannot be less than zero.")
    If String.IsNullOrEmpty(allowedChars) Then Throw New ArgumentException("allowedChars may not be empty.")

    Dim byteSize As Integer = 256
    Dim hash As HashSet(Of Char) = New HashSet(Of Char)(allowedChars)
    'Dim hash As HashSet(Of String) = New HashSet(Of String)(allowedChars)
    Dim allowedCharSet() = hash.ToArray

    If byteSize < allowedCharSet.Length Then Throw New ArgumentException(String.Format("allowedChars may contain no more than {0} characters.", byteSize))

    ' Guid.NewGuid and System.Random are not particularly random. By using a
    ' cryptographically-secure random number generator, the caller is always
    ' protected, regardless of use.
    Dim rng = New System.Security.Cryptography.RNGCryptoServiceProvider()
    Dim result = New System.Text.StringBuilder()
    Dim buf = New Byte(128) {}
    While result.Length < length
        rng.GetBytes(buf)
        Dim i
        For i = 0 To buf.Length - 1 Step +1
            If result.Length >= length Then Exit For
            ' Divide the byte into allowedCharSet-sized groups. If the
            ' random value falls into the last group and the last group is
            ' too small to choose from the entire allowedCharSet, ignore
            ' the value in order to avoid biasing the result.
            Dim outOfRangeStart = byteSize - (byteSize Mod allowedCharSet.Length)
            If outOfRangeStart <= buf(i) Then
                Continue For
            End If
            result.Append(allowedCharSet(buf(i) Mod allowedCharSet.Length))
        Next
    End While
    Return result.ToString()
End Function 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-04-08T14:35:49.180

这已被要求用于各种语言。这是[关于密码的一个问题](https://stackoverflow.com/questions/54991/generating-random-passwords)，这里也应该适用。

如果您想使用字符串来缩短 URL，您还需要 Dictionary<> 或数据库检查以查看生成的 ID 是否已被使用。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2015-06-19T11:31:49.793

如果您想要一个带有小写*和*大写字符的字母数字字符串 ([a-zA-Z0-9])，您可以使用 Convert.ToBase64String() 来获得快速而简单的解决方案。

至于唯一性，请查看[生日问题](https://en.wikipedia.org/wiki/Birthday_problem)来计算发生冲突的可能性（A）生成的字符串的长度和（B）生成的字符串的数量。

```
Random random = new Random();

int outputLength = 10;
int byteLength = (int)Math.Ceiling(3f / 4f * outputLength); // Base64 uses 4 characters for every 3 bytes of data; so in random bytes we need only 3/4 of the desired length
byte[] randomBytes = new byte[byteLength];
string output;
do
{
    random.NextBytes(randomBytes); // Fill bytes with random data
    output = Convert.ToBase64String(randomBytes); // Convert to base64
    output = output.Substring(0, outputLength); // Truncate any superfluous characters and/or padding
} while (output.Contains('/') || output.Contains('+')); // Repeat if we contain non-alphanumeric characters (~25% chance if length=10; ~50% chance if length=20; ~35% chance if length=32) 
```

* * *

## 回答 #12

> 赞同：-1
> 
> 时间：2009-04-08T14:32:29.593

*   不确定微软的链接是随机生成的
*   看看 new Guid().ToString()

* * *

## 回答 #13

> 赞同：-1
> 
> 时间：2009-04-08T14:33:52.897

[使用 GUID 哈希码获取唯一键](http://simpcode.blogspot.com/2008/07/c-get-unique-key-using-guid-hash-code.html)

```
public static string GetUniqueKey(int length)
{
    string guidResult = string.Empty;

    while (guidResult.Length < length)
    {
        // Get the GUID.
        guidResult += Guid.NewGuid().ToString().GetHashCode().ToString("x");
    }

    // Make sure length is valid.
    if (length <= 0 || length > guidResult.Length)
        throw new ArgumentException("Length must be between 1 and " + guidResult.Length);

    // Return the first length bytes.
    return guidResult.Substring(0, length);
} 
```

* * *

## 回答 #14

> 赞同：-3
> 
> 时间：2020-11-04T19:18:40.150

我在 Windows 上使用 Linux 命令的一站式解决方案是 scoop。从[scoop.sh安装 scoop](https://scoop.sh/)

```
scoop install openssl
openssl rand -base64 32
Dca3c3pptVkcb8fx243wN/3f/rQxx/rWYL8y7rZrGrA= 
```

# xml - 从熟 XML/PDF 输入更新后端数据库：哪个是最好的工具/方法？

> ID：730270
> 
> 赞同：0
> 
> 时间：2009-04-08T14:27:37.983
> 
> 标签：xml, database, pdf, scripting

我们必须每月自动更新几次数据库。

我目前的用例如下。

目前我们手动将输入数据与上个月的输入进行比较。如果是 XML，我们使用 MS xmldiff。如果是 Pdf ，则完全通过手动验证完成 :-( 。

找到更改后，我们通过表单界面（再次手动）更新数据库。更改可能是创建新条目、更新现有条目或删除旧条目。由于整个过程既费时又费力，更不用说对个人来说非常无聊和令人沮丧，我们正在寻找尽可能多地自动化这个过程的方法。

我们目前正在考虑使用脚本语言（特别是 Python）来实现整个事情。但是我们目前真的没有任何人在脚本语言方面有经验，所以我们基本上必须边走边学。

在我们开始之前，我们希望回答的问题是

1) 使用脚本语言是正确的方法吗？我们认为脚本语言更好，因为要涵盖多个领域（XML 差异、数据库连接、创建 XML 等）。有没有其他替代方案或工具？

2) 使用 Python 和其他任何语言一样好吗？根据我们搜索的结果，python 似乎很成熟，并且确实通过库支持各种数据库连接。还有其他我们应该研究的替代方案吗？（同样没有人编写过一个 Python 代码）

3) 是否有适用于 pdf 文件的好的免费 Diff 工具？我们正在寻找可以检查特定表格或标题内容是否在 pdf 中更改并转储输出的东西。

仅供参考，数据库是 MS 访问。

谢谢你的时间。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-08T14:52:52.260

我认为 Python 是一种易于学习的语言，我认为如果你有 VBScript 经验，你应该能够快速上手。

我使用 BeautifulSoup 进行 XML/HTML 解析，我发现它非常易于使用。 [http://www.crummy.com/software/BeautifulSoup/documentation.html](http://www.crummy.com/software/BeautifulSoup/documentation.html)

对于 PDF 的东西，你可以看看 rportlab 工具包（我没有用过） [http://www.reportlab.org/](http://www.reportlab.org/)

# visual-studio-2008 - 如何添加对程序集引用的源代码的引用？

> ID：730271
> 
> 赞同：0
> 
> 时间：2009-04-08T14:27:52.490
> 
> 标签：visual-studio-2008

我有一个引用程序集 (.dll) 的项目。我有该程序集的源代码，所以我想在导航代码时查看代码，而不是获取对象资源管理器窗口。我怎样才能做到这一点？（我正在考虑类似包含路径的东西，但我找不到它）

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-08T14:32:13.230

您真正需要的是包含调试符号的 pdb 文件 - 与 dll 同时生成。把它贴在 dll 旁边，它应该开始工作（或者如果没有，你可以手动加载它）。

除非您正在编译，否则源文件并不是那么有用。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-08T14:31:14.917

如果您有 PDB 文件和源代码，您将在调试器输入代码时获得源代码。但是，我不知道在任何其他情况下让 VS2008 显示链接 DLL 的源的方法。

# php - 将 UTC 转换为 Unix 时间戳

> ID：730273
> 
> 赞同：2
> 
> 时间：2009-04-08T14:28:42.927
> 
> 标签：php, datetime, date, time, icalendar

我正在解析时间和日期为 UTC 的 RSS 提要，我需要将其转换为 unix 时间戳。有没有一种简单的方法可以做到这一点？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-08T14:31:23.620

[http://us2.php.net/manual/en/function.strtotime.php](http://us2.php.net/manual/en/function.strtotime.php)

# windows-mobile - 在 Windows Mobile 上包装 HTML 控件

> ID：730275
> 
> 赞同：0
> 
> 时间：2009-04-08T14:28:52.893
> 
> 标签：windows-mobile

我正在编写一个应用程序（用于 Windows Mobile 的带有 VS20050 的 C++，它包装了 HTML 控件（即，我正在创建一个 DISPLAYCLASS 窗口）。

我希望能够创建一个 HTML 页面，并通过在页面上使用 JavaScript 来执行我的应用程序中的一个函数。几乎就像 Java 中的 JNI。

我一直在做的是，在页面上，执行该行

document.location.href="myapp:myfunc";

当我的应用从控件接收到 NM_BEFORENAVIGATE 时，我的应用会查找“myapp:”。这似乎有效（强调“似乎”这个词。）因此而中断的是页面上的 javascript 代码在我尝试在页面上提交表单时中断。

我会很感激任何建议。

问候，布赖恩

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2010-01-20T11:15:41.870

您是否尝试调用 JS->Java ？如果是这样，您可以从可以使用 JNI 调用 Java 的 ActiveXControl 开始。

# java - Java 是否有完整的 HTTP 响应代码枚举？

> ID：730283
> 
> 赞同：301
> 
> 时间：2009-04-08T14:30:52.047
> 
> 标签：java, http

我想知道某些标准 Java 类库中是否有一个枚举类型，它为所有有效的 HTTP 响应代码定义了符号常量。它应该支持与相应整数值的转换。

我正在调试一些使用`javax.ws.rs.core.Response.Status`. 它可以工作，但它只定义了大约一半的有效 HTTP 响应代码。

* * *

## 回答 #1

> 赞同：313
> 
> 时间：2009-04-08T14:39:25.317

我认为标准 Java 类中没有一个是完整的。**[`HttpURLConnection`](http://docs.oracle.com/javase/7/docs/api/java/net/HttpURLConnection.html)**缺少很多代码，例如`HTTP 100/Continue`.

不过，Apache HttpComponents 中有一个完整的列表：（从 Apache Http Client
[**`org.apache.http.HttpStatus`**](http://hc.apache.org/httpcomponents-core-ga/httpcore/apidocs/org/apache/http/HttpStatus.html)替换，它已经[到了生命的尽头](http://hc.apache.org/httpclient-3.x/)）[**`org.apache.commons.HttpClient.HttpStatus`**](http://hc.apache.org/httpclient-3.x/apidocs/org/apache/commons/httpclient/HttpStatus.html)

* * *

## 回答 #2

> 赞同：78
> 
> 时间：2009-04-08T14:43:33.263

servlet API的接口具有常量名称`javax.servlet.http.HttpServletResponse`形式的所有响应代码。请参阅[http://docs.oracle.com/javaee/6/api/javax/servlet/http/HttpServletResponse.html](http://docs.oracle.com/javaee/6/api/javax/servlet/http/HttpServletResponse.html)`int``SC_<description>`

* * *

## 回答 #3

> 赞同：73
> 
> 时间：2009-04-08T14:33:47.220

[嗯，在HttpURLConnection](http://java.sun.com/javase/6/docs/api/java/net/HttpURLConnection.html)类中有精确整数值的静态常量

* * *

## 回答 #4

> 赞同：22
> 
> 时间：2010-01-26T00:27:22.623

如果您使用的是 Spring，那么 3.x 版本可以满足您的需求： [http ://static.springsource.org/spring/docs/3.0.x/api/org/springframework/http/HttpStatus.html](http://static.springsource.org/spring/docs/3.0.x/api/org/springframework/http/HttpStatus.html)

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2015-11-05T16:25:01.397

每个人似乎都忽略了您问题的“枚举类型”部分。

虽然没有 HTTP 状态代码的规范来源，但有一种简单的方法可以*将*任何缺少的状态常量添加到提供的那些常量中，`javax.ws.rs.core.Response.Status`而无需向项目添加任何额外的依赖项。

`javax.ws.rs.core.Response.Status`只是`javax.ws.rs.core.Response.StatusType`接口的一种实现。您只需要使用所需的状态代码定义创建自己的实现枚举。

Javax、Jersey 等核心库被写入*接口* `StatusType`而不是*实现* `Status`（或者它们当然**应该**如此）。由于您的新 Status 枚举实现`StatusType`了它，因此您可以在任何使用`javax.ws.rs.core.Response.Status`常量的地方使用它。

请记住，您自己的代码也应该写入`StatusType`接口。这将使您能够与“标准”状态代码一起使用您自己的状态代码。

这是一个简单实现的要点，其中为“信息 1xx”状态代码定义了常量：[https ://gist.github.com/avendasora/a5ed9acf6b1ee709a14a](https://gist.github.com/avendasora/a5ed9acf6b1ee709a14a)

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2014-12-27T18:24:48.410

如果您使用的是**Netty**，您可以使用：

*   io.netty.handler.codec.http。[**HttpResponse状态**](http://netty.io/4.0/api/io/netty/handler/codec/http/HttpResponseStatus.html)

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2012-09-05T14:50:56.930

使用 javax.servlet.http.HttpServletResponse 类

例子：

```
javax.servlet.http.HttpServletResponse.SC_UNAUTHORIZED //401
javax.servlet.http.HttpServletResponse.SC_INTERNAL_SERVER_ERROR //500 
```

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2021-02-16T05:14:30.517

这是一个带有状态代码的枚举及其描述（在撰写本文时）对应于[HTTP 状态代码注册表](https://www.iana.org/assignments/http-status-codes/http-status-codes.xhtml)。

请注意，注册表可能会更新，并且有时会使用非官方状态代码。

```
public enum HttpStatusCode {

    //1xx: Informational
    CONTINUE(100, "Continue"),
    SWITCHING_PROTOCOLS(101, "Switching Protocols"),
    PROCESSING(102, "Processing"),
    EARLY_HINTS(103, "Early Hints"),

    //2xx: Success
    OK(200, "OK"),
    CREATED(201, "Created"),
    ACCEPTED(202, "Accepted"),
    NON_AUTHORITATIVE_INFORMATION(203, "Non-Authoritative Information"),
    NO_CONTENT(204, "No Content"),
    RESET_CONTENT(205, "Reset Content"),
    PARTIAL_CONTENT(206, "Partial Content"),
    MULTI_STATUS(207, "Multi-Status"),
    ALREADY_REPORTED(208, "Already Reported"),
    IM_USED(226, "IM Used"),

    //3xx: Redirection
    MULTIPLE_CHOICES(300, "Multiple Choice"),
    MOVED_PERMANENTLY(301, "Moved Permanently"),
    FOUND(302, "Found"),
    SEE_OTHER(303, "See Other"),
    NOT_MODIFIED(304, "Not Modified"),
    USE_PROXY(305, "Use Proxy"),
    TEMPORARY_REDIRECT(307, "Temporary Redirect"),
    PERMANENT_REDIRECT(308, "Permanent Redirect"),

    //4xx: Client Error
    BAD_REQUEST(400, "Bad Request"),
    UNAUTHORIZED(401, "Unauthorized"),
    PAYMENT_REQUIRED(402, "Payment Required"),
    FORBIDDEN(403, "Forbidden"),
    NOT_FOUND(404, "Not Found"),
    METHOD_NOT_ALLOWED(405, "Method Not Allowed"),
    NOT_ACCEPTABLE(406, "Not Acceptable"),
    PROXY_AUTHENTICATION_REQUIRED(407, "Proxy Authentication Required"),
    REQUEST_TIMEOUT(408, "Request Timeout"),
    CONFLICT(409, "Conflict"),
    GONE(410, "Gone"),
    LENGTH_REQUIRED(411, "Length Required"),
    PRECONDITION_FAILED(412, "Precondition Failed"),
    REQUEST_TOO_LONG(413, "Payload Too Large"),
    REQUEST_URI_TOO_LONG(414, "URI Too Long"),
    UNSUPPORTED_MEDIA_TYPE(415, "Unsupported Media Type"),
    REQUESTED_RANGE_NOT_SATISFIABLE(416, "Range Not Satisfiable"),
    EXPECTATION_FAILED(417, "Expectation Failed"),
    MISDIRECTED_REQUEST(421, "Misdirected Request"),
    UNPROCESSABLE_ENTITY(422, "Unprocessable Entity"),
    LOCKED(423, "Locked"),
    FAILED_DEPENDENCY(424, "Failed Dependency"),
    TOO_EARLY(425, "Too Early"),
    UPGRADE_REQUIRED(426, "Upgrade Required"),
    PRECONDITION_REQUIRED(428, "Precondition Required"),
    TOO_MANY_REQUESTS(429, "Too Many Requests"),
    REQUEST_HEADER_FIELDS_TOO_LARGE(431, "Request Header Fields Too Large"),
    UNAVAILABLE_FOR_LEGAL_REASONS(451, "Unavailable For Legal Reasons"),

    //5xx: Server Error
    INTERNAL_SERVER_ERROR(500, "Internal Server Error"),
    NOT_IMPLEMENTED(501, "Not Implemented"),
    BAD_GATEWAY(502, "Bad Gateway"),
    SERVICE_UNAVAILABLE(503, "Service Unavailable"),
    GATEWAY_TIMEOUT(504, "Gateway Timeout"),
    HTTP_VERSION_NOT_SUPPORTED(505, "HTTP Version Not Supported"),
    VARIANT_ALSO_NEGOTIATES(506, "Variant Also Negotiates"),
    INSUFFICIENT_STORAGE(507, "Insufficient Storage"),
    LOOP_DETECTED(508, "Loop Detected"),
    NOT_EXTENDED(510, "Not Extended"),
    NETWORK_AUTHENTICATION_REQUIRED(511, "Network Authentication Required");

    private final int value;
    private final String description;

    HttpStatusCode(int value, String description) {
        this.value = value;
        this.description = description;
    }

    public int getValue() {
        return value;
    }

    public String getDescription() {
        return description;
    }

    @Override
    public String toString() {
        return value + " " + description;
    }

    public static HttpStatusCode getByValue(int value) {
        for(HttpStatusCode status : values()) {
            if(status.value == value) return status;
        }
        throw new IllegalArgumentException("Invalid status code: " + value);
    }
} 
```

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2016-06-24T20:25:31.573

1）如果您只有代码，要获取原因**文本，您可以使用：**

```
org.apache.http.impl.EnglishReasonPhraseCatalog.INSTANCE.getReason(httpCode,null) 
```

`httpCode`您从 HTTP 响应中获得的原因代码在哪里。

有关详细信息，请参阅[https://hc.apache.org/httpcomponents-core-ga/httpcore/apidocs/org/apache/http/impl/EnglishReasonPhraseCatalog.html](https://hc.apache.org/httpcomponents-core-ga/httpcore/apidocs/org/apache/http/impl/EnglishReasonPhraseCatalog.html)

2）如果您只有文本，要获取原因**码**`BasicHttpResponse`，您可以使用.

有关详细信息，请参见此处：[https ://hc.apache.org/httpcomponents-core-ga/httpcore/apidocs/org/apache/http/message/BasicHttpResponse.html](https://hc.apache.org/httpcomponents-core-ga/httpcore/apidocs/org/apache/http/message/BasicHttpResponse.html)

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2009-04-08T17:54:14.133

另请查看 Restlet Status 类：

[http://www.restlet.org/documentation/1.1/api/org/restlet/data/Status.html](http://www.restlet.org/documentation/1.1/api/org/restlet/data/Status.html)

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2013-03-19T22:11:54.387

http 状态码常量的最佳提供者可能是 Jetty 的 org.eclipse.jetty.http.HttpStatus 类，因为：

*   maven 中有一个 javadoc 包，如果您搜索常量并且只知道数字，这很重要 -> 只需打开 api 文档页面并搜索数字
*   常量包含状态代码编号本身。

我唯一要改进的一点是：将状态代码编号放在文本描述之前，以便在您开始使用代码时更方便地进行自动完成查找。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2021-09-23T07:13:55.897

请参阅 Spring 框架中的以下枚举，它提供了所有 HTTP 响应状态代码

HttpStatus.values()

* * *

## 回答 #13

> 赞同：-1
> 
> 时间：2013-07-11T15:08:32.437

另一种选择是使用`HttpStatus`Apache commons-httpclient 中的类，它为您提供各种 Http 状态作为常量。

# sql-server-2005 - 如何从 SQL Server 2005 中保存的架构脚本创建新数据库？

> ID：730286
> 
> 赞同：0
> 
> 时间：2009-04-08T14:31:11.093
> 
> 标签：sql-server-2005

我使用数据库发布向导为数据库生成架构脚本，如何根据这个 .sql 文件创建新数据库？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-08T14:43:40.083

打开 SQL 文件，并将 CREATE DB 语法添加到顶部。

[http://msdn.microsoft.com/en-us/library/aa258257.aspx](http://msdn.microsoft.com/en-us/library/aa258257.aspx)

保存并使用 sqlcmd 或查询分析器运行它。

或者使用 Management Studio 创建空数据库，然后运行 ​​sql 查询。

从我所看到的 sql server 发布向导来看，它不会为您创建数据库，只会为您创建表和数据。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-08T14:34:51.727

从命令行客户端或其他一些客户端对数据库运行 sql 文件：

```
sqlcmd -d databasename < dumpscript.sql 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-08T14:35:44.843

通常，您会打开一个查询分析器窗口（右键单击服务器；Management Studio 中的新查询）并运行脚本。但是，这取决于脚本包含的内容——即它是否创建了数据库——或者只是表。您*可能*需要先自己创建空数据库。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-08T14:48:06.903

我已经在我工作的地方看到过这个 - MS SQL的[osql 命令行实用程序。](http://msdn.microsoft.com/en-us/library/aa214012(SQL.80).aspx)您也可以通过字符串或文件输入创建数据库并运行 DML 查询

# python - 在 Python 2.6 中用对应的 utf-8 字符替换 html 实体

> ID：730299
> 
> 赞同：14
> 
> 时间：2009-04-08T14:32:42.200
> 
> 标签：python, html-entities, python-2.6

我有一个这样的html文本：

```
&lt;xml ... &gt; 
```

我想把它转换成可读的东西：

```
<xml ...> 
```

在 Python 中有什么简单（快速）的方法吗？

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2009-04-08T14:36:29.350

## 蟒蛇> = 3.4

官方文档`HTMLParser`：[Python 3](https://docs.python.org/3/library/html.html#html.unescape)

```
>>> from html import unescape
>>> unescape('&copy; &euro;')
© € 
```

## 蟒蛇 < 3.5

官方文档`HTMLParser`：[Python 3](https://docs.python.org/3/library/html.parser.html)

```
>>> from html.parser import HTMLParser
>>> pars = HTMLParser()
>>> pars.unescape('&copy; &euro;')
© € 
```

注意：这已被弃用，有利于`html.unescape()`.

## 蟒蛇 2.7

官方文档`HTMLParser`：[Python 2.7](https://docs.python.org/2.7/library/htmlparser.html)

```
>>> import HTMLParser
>>> pars = HTMLParser.HTMLParser()
>>> pars.unescape('&copy; &euro;')
u'\xa9 \u20ac'
>>> print _
© € 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2019-11-06T16:44:44.170

现代 Python 3 方法：

```
>>> import html
>>> html.unescape('&copy; &euro;')
© € 
```

[https://docs.python.org/3/library/html.html](https://docs.python.org/3/library/html.html)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-08T18:09:06.250

正如 Fred 指出的帖子所链接的那样，[这里](http://effbot.org/zone/re-sub.htm#unescape-html)有一个功能可以做到这一点。复制到这里是为了让事情变得更容易。

感谢 Fred Larson 链接到关于 SO 的另一个问题。感谢 dF 发布链接。

# c# - 如何在不重置堆栈跟踪的情况下抛出异常？

> ID：730300
> 
> 赞同：28
> 
> 时间：2009-04-08T14:32:45.117
> 
> 标签：c#, .net, exception-handling, error-handling, stack-trace

[这是“throw”和“throw ex”之间有区别</a>](https://stackoverflow.com/questions/730250/is-there-a-difference-between-throw-and-throw-ex)的后续问题吗？

 [有没有办法在不重置堆栈跟踪的情况下提取新的错误处理方法？](https://stackoverflow.com/questions/730250/is-there-a-difference-between-throw-and-throw-ex) 

[**[编辑]** 我将同时尝试“内部方法”和 Earwicker 提供的另一个](https://stackoverflow.com/questions/730250/is-there-a-difference-between-throw-and-throw-ex)[答案](https://stackoverflow.com/questions/730300/how-to-throw-exception-without-resetting-stack-trace/730385#730385)，看看哪个可以更好地标记答案。

* * *

## 回答 #1

> 赞同：54
> 
> 时间：2012-09-27T10:16:09.493

在 .NET Framework 4.5 中，现在有一个[ExceptionDispatchInfo](http://msdn.microsoft.com/en-us/library/system.runtime.exceptionservices.exceptiondispatchinfo.aspx)支持这种确切的场景。它允许捕获一个完整的异常并从其他地方重新抛出它，而不会覆盖包含的堆栈跟踪。

**由于评论中的请求，代码示例**

```
using System.Runtime.ExceptionServices;

class Test
{
    private ExceptionDispatchInfo _exInfo;

    public void DeleteNoThrow(string path)
    {
        try { File.Delete(path); }
        catch(IOException ex)
        {
            // Capture exception (including stack trace) for later rethrow.
            _exInfo = ExceptionDispatchInfo.Capture(ex);
        }
    }

    public Exception GetFailure()
    {
        // You can access the captured exception without rethrowing.
        return _exInfo != null ? _exInfo.SourceException : null;
    }

    public void ThrowIfFailed()
    {
        // This will rethrow the exception including the stack trace of the
        // original DeleteNoThrow call.
        _exInfo.Throw();

        // Contrast with 'throw GetFailure()' which rethrows the exception but
        // overwrites the stack trace to the current caller of ThrowIfFailed.
    }
} 
```

* * *

## 回答 #2

> 赞同：49
> 
> 时间：2009-04-08T14:34:32.943

是的; 这就是 InnerException 属性的用途。

```
catch(Exception ex)
{
    throw new YourExceptionClass("message", ex);
} 
```

这将允许您添加自己的逻辑，然后抛出您自己的异常类。YourExceptionClass 实例的 StackTrace 将来自此代码块，但 InnerException 将是您捕获的异常，它之前有 StackTrace。

* * *

## 回答 #3

> 赞同：31
> 
> 时间：2009-04-08T14:36:09.943

不知道你是不是这个意思，但我在你的另一个问题中的建议是解决这个问题。

如果您的处理程序返回一个布尔值是否处理了异常，您可以在您的 catch 子句中使用它：

```
catch (Exception ex) {
  if (!HandleException(ex)) {
    throw;
  }
} 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-04-08T14:35:42.753

您不想使用原始堆栈跟踪创建新异常。这是误导，因为该堆栈跟踪没有创建新的异常。

但是，您可以将原始异常作为“InnerException”放入新异常中。那会做你正在寻找的吗？

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-04-08T14:50:49.830

您是否捕获了想要更仔细过滤的异常，以便您可以改变主意，决定不处理它们并重新抛出它们？

如果您想对此非常小心，那并不是一个好主意。最好一开始就不要捕获异常。原因是给定的`try/catch`处理程序不应该决定为`finally`它不期望看到的异常运行嵌套块。例如，如果有一个`NullReferenceException`，继续执行任何代码可能是一个非常糟糕的主意，因为它可能会导致另一个这样的异常被抛出。`finally`块只是代码，就像任何其他代码一样。一旦第一次捕获到异常，`finally`堆栈上的任何块`try/catch`都将被执行，到那时为时已晚 - 可能会生成另一个异常，这意味着原始异常丢失了。

这意味着（在 C# 中）您必须仔细`catch`为要捕获的所有异常类型编写一个单独的处理程序。这也意味着您只能按异常类型进行过滤。这有时是很难遵循的建议。

应该可以通过其他方式过滤异常，但在 C# 中则不然。但是，这在 VB.NET 中是可能的，并且 BCL 本身通过在 VB.NET 中编写少量代码来利用这一点，因此它可以以更方便的方式过滤异常。

[这是来自 CLR 团队博客的详细解释，带有 VB.NET 代码示例。](https://web.archive.org/web/20091218171254/http://blogs.msdn.com/clrteam/archive/2009/02/05/catch-rethrow-and-filters-why-you-should-care.aspx)

[这是我的两分钱。](http://incrediblejourneysintotheknown.blogspot.com/2009/02/fatal-exceptions-and-why-vbnet-has.html)

# python - mercurial + OSX == 失败？hg log abort：是一个目录

> ID：730319
> 
> 赞同：2
> 
> 时间：2009-04-08T14:35:13.550
> 
> 标签：python, macos, mercurial

```
$ mkdir foo
$ cd foo
$ hg init .
$ hg log
abort: Is a directory
$ hg history
abort: Is a directory 
```

Darwin Host.local 9.6.1 达尔文内核版本 9.6.1：2008 年 12 月 10 日星期三 10:38:33 PST；根：xnu-1228.9.75~3/RELEASE_I386 i386

```
$ hg --version
Mercurial Distributed SCM (version 1.2.1)
$ python --version
Python 2.5.4 
```

（全部通过 macports 安装）

想法？谷歌什么也没给我们。

更新：

（作为根）：

```
$ hg init /tmp/foo
$ cd /tmp/foo; hg log
(works) 
```

（作为用户）：

```
$ hg init /tmp/bar
$ cd /tmp/bar; hg log
abort: Is a directory 
```

所以特拉维斯是对的（见评论）它在某处看起来确实是一个权限问题，但在哪里呢？这是仅一周前的 Leopard 库存安装和 python 和 mercurial 的 macport 版本的库存安装。我希望当它有权限问题时，这不是善变的错误消息的想法。

第二次更新（来自下面的 dkbits 建议）：

```
$ sudo dtruss hg log
[snip]
...
stat("/opt/local/Library/Frameworks/Python.framework/Versions/2.5/lib/python2.5/site-   packages/mercurial/templates/gitweb\0", 0xBFFFC7DC, 0x1000)      = 0 0
open_nocancel("/opt/local/Library/Frameworks/Python.framework/Versions/2.5/lib/python2.5/site-packages/mercurial/templates/gitweb\0", 0x0, 0x1B6)        = 3 0
fstat(0x3, 0xBFFFC900, 0x1B6)        = 0 0
close_nocancel(0x3)      = 0 0
write_nocancel(0x2, "abort: Is a directory\n\0", 0x16)       = 22 0 
```

此外，临时目录是您期望的位置。权限看起来不错。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-08T19:05:04.353

[不是对您的问题的直接回答，但我已经成功地从这里](http://mercurial.berkwood.com/)使用 Mercurial 预打包的二进制文件，并在 OSX 10.5 上安装了标准 Python 2.5.1，没有问题。

```
$ mkdir foo
$ cd foo
$ hg init .
$ hg log
$ hg history

$ hg --version
Mercurial Distributed SCM (version 1.2.1)

$ python --version
Python 2.5.1 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-09T22:11:37.567

从[https://www.mercurial-scm.org/bts/issue233](https://www.mercurial-scm.org/bts/issue233)，有一个有趣的回溯：

```
hg --traceback qpop
Traceback (most recent call last):
  [...]
  File "/export/home/bos/lib/python/mercurial/util.py", line 747, in o
    rename(mktempcopy(f), f)
  File "/export/home/bos/lib/python/mercurial/util.py", line 690, in mktempcopy
    fp.write(posixfile(name, "rb").read())
IOError: [Errno 21] Is a directory
abort: Is a directory 
```

也许权限错误与您的临时文件夹有关？要找到临时目录，请执行..

```
$ python
>>> import tempfile
>>> print tempfile.gettempdir() 
```

应该在`/var/folders/[...]/[...]/-Tmp-/`

也受到上述链接的启发，您可以尝试运行..

```
$ hg init /tmp/bar
$ cd /tmp/bar
$ hg --traceback log 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-22T06:12:37.647

我发现了问题：

如果您在某处符号链接您的 .hgrc，则会导致此问题。绝对是一个 mercurial 中的错误（以及一个愚蠢的错误消息）。

```
$ rm -f ~/.hgrc
$ hg init foo
$ cd foo
$ hg log 
```

（作品）

```
$ ls -l ~/Dropbox/.hgrc
-rw-r--r--@ 1 schubert  staff  83 Jan  9 02:15 /Users/schubert/Dropbox/.hgrc
$ ln -s ~/Dropbox/.hgrc ~/.hgrc
$ hg log
abort: Is a directory
$ rm -f ~/.hgrc
$ hg log 
```

（作品）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-22T06:26:16.323

我又看了看，它实际上是由 .hgrc 行引起的：

风格 = gitweb

为什么我不确定，但错误消息确实很糟糕。

# java - Java 方法的内存开销是多少？

> ID：730321
> 
> 赞同：14
> 
> 时间：2009-04-08T14:35:24.627
> 
> 标签：java, memory

类中函数的内存开销是多少？

例如，

```
Class A
{
 int a
}

Class B
{
 int a
 int foo(int);
} 
```

所以 A 类的 100 个实例应该是 80 个字节。B 类的 100 个实例呢？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-04-08T16:33:17.197

The overhead is... none.

The method definition and code address are stored in the Class object, which has a unique instance toward which every instance of your object points. Since that would be the case, whether or not you added that method, the overhead for each individual object is nothing.

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-08T14:38:35.367

80 字节，因为对象中不包含方法。除非你也在谈论“vtable”类型的东西，在这种情况下可能是 160 个字节。

澄清 160 字节。如果每个对象都分配了自己的 vtable（这是一种可能的实现），则 160 将是。或者（正如评论中指出的那样）更好的方法是每个类一个 vtable，这意味着 80 + 指向 vtable 的指针的大小（可能是 4 或 8 个字节，具体取决于 VM）。所以 84 或 88 字节。

这整个事情完全取决于虚拟机分配内存和处理非最终方法的方式。在不知道特定 VM 是如何实现的情况下，这两个问题都无法正确回答。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-09T07:04:06.590

对于 32/64 位 JVM，这两个类的对象将使用大约 20-24 字节。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-08T14:52:25.117

正如其他一些人至少说过的那样，该方法没有存储在序列化中。

您可以使用以下代码轻松地进行测试以在此示例中显示这一点。

```
import java.io.File;
import java.io.FileOutputStream;
import java.io.IOException;
import java.io.ObjectOutputStream;
import java.io.Serializable;

public class SerializationTest {

    public static void main(String[] args) {
        serialize(true);
        serialize(false);
    }

    public static void serialize(boolean aOrB) {
        FileOutputStream fos = null;
        ObjectOutputStream out = null;
        try {
            fos = new FileOutputStream("output.txt");
            out = new ObjectOutputStream(fos);
            out.writeObject(aOrB ? new A() : new B());
            out.close();
            fos.close();
        } catch (IOException ex) {
            ex.printStackTrace();
        }
        File file = new File("output.txt");
        System.out.println(file.length());
    }

    public static class A implements Serializable {
        int a = 0;
    }

    public static class B implements Serializable {
        int a = 0;

        public int foo(int a) {
            return a;
        }
    }
} 
```

对我来说，这打印出来

```
48
48 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-08T14:40:13.677

相等，80！（ 简而言之）

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-08T14:37:48.753

该方法不以序列化形式存储。就这么简单。

**编辑：**对于执行期间VM中的对象，大小应该是恒定的，无论对象的类有多少方法。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2009-04-08T14:36:50.520

可能 v-table 指针的大小四舍五入到 16 的倍数。

# eclipse - Eclipse 中 TeamCity 插件的问题

> ID：730329
> 
> 赞同：1
> 
> 时间：2009-04-08T14:36:14.670
> 
> 标签：eclipse, teamcity

问题是这样的：“远程运行”选项总是灰显的。有人知道如何解决这个问题吗？我对两个文件进行了更改，并想运行它们，但插件不允许我这样做。同样的事情在 IntelliJ 中运行良好，但我真的更喜欢 Eclipse，我想让它工作。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-09T13:43:24.587

我发现这高度依赖于我的 Teamcity、Eclipse 和 Subclipse 版本。目前，我使用 TC 4.0.1，而我的远程运行在 Eclipse 3.4 中不起作用。但是，相同的插件在 Eclipse 3.3 和早期版本的 Subclipse 中对我来说工作得很好。

[如果您尚未在Jetbrains Tracker](http://jetbrains.net/tracker)上发布此信息，最好的办法是看看开发人员是否可以查看它。

# c# - PLINQ：Parallel Extensions 会自动处理单核和多核环境吗？

> ID：730335
> 
> 赞同：0
> 
> 时间：2009-04-08T14:38:14.870
> 
> 标签：c#, .net, vb.net, .net-3.5

LINQ 的并行扩展会自动检测内核数量并全部使用它们吗？相反，如果代码在单核机器上运行，它仍然可以工作还是我必须检测内核数量并告诉 PLINQ 运行多少？

可悲的是，我无法访问任何单核机器来测试我的代码，所以我什至无法自己测试它，而且我无法在其他地方找到任何有用的信息......

此外，虽然乍一看似乎很明显何时使用并行性，但是否有任何关于应该在哪里使用以及*不*应该使用它的经验法则？

旁注：我不一定在特定环境中编程。我倾向于根据手头的任务在 Web、客户端/服务器应用程序、Windows 应用程序、Windows 服务和控制台实用程序之间平均分配我的时间（取决于项目）。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-08T14:39:11.607

是的，它自己处理核心数量，并且在单核、伪多核 (HT) 以及愚蠢的核心数量上都很好——但你确实需要`Parallel`自己编写代码；它不仅仅是控制您现有的代码。

*何时*使用并行性......这是一个*巨大*的话题。实际上，如果您正在做 Web 编程 - 我会忘记它，只是让 IIS 为不同的请求使用不同的并行线程（而不是让一个请求占用机器）。

它主要用于大量处理/数据收集 - 无论是在专用的应用程序服务器上，还是在客户端。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-08T16:22:43.527

Marc 的回答是正确的，建议您让 Web 请求的并行性质为您处理大部分并行性，如果这是您所处的环境。

我使用并行扩展取得巨大成功的一个地方是从远程源加载数据。我有一个应用程序，我需要获取一个数据，使用其中的一些信息来获取其他 30 个数据，然后返回结果。我正常运行第一次提取，然后为我需要的每个其他请求定义一个 Future（来自并行扩展），在匿名方法中包含我需要的一点处理，并对期货数组执行 WaitAll()。实现起来非常简单，所有请求（或一次至少有几个）并行运行以获取它们的数据。特别是因为我的调用延迟非常高（5 秒等待大约 1kb 的数据），这种技术非常有效。

后来，我什至修改它以返回一个 IEnumerable，并使用 WaitOne() 等待其中一个期货完成，然后从我的枚举器中产生它，允许调用者在它们全部之前开始处理一些请求的结果是完整的。

# jquery - jQuery 库位置希望在服务器上以不同方式引用

> ID：730336
> 
> 赞同：4
> 
> 时间：2009-04-08T14:38:24.633
> 
> 标签：jquery, asp.net-mvc, model-view-controller, jquery-ui

我有一个使用 jQuery 的 ASP.NET MVC 应用程序。要加载 js 库，我像这样引用它们：

```
<script type="text/javascript" src="../../Scripts/jquery-1.3.2.min.js"></script> 
```

这在本地工作正常，但是当我将它发布到服务器时，它找不到库。为了让它工作，我必须把它改成这样：

```
<script type="text/javascript" src="../Scripts/jquery-1.3.2.min.js"></script> 
```

进行此更改使其可以在本地和服务器上工作，但它会警告我找不到该文件。所以我有几个问题：

1.  如果我没有引用正确的库位置，代码如何在本地工作？
2.  我可以为在任何地方都可以使用且不会发出警告的脚本路径添加什么？

我知道#2 的答案是将库存储在某个已知的绝对路径中，但我还没有准备好承诺。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-08T14:57:44.633

试试这个：

```
<script type="text/javascript" src='<%= Url.Content("~/Scripts/jquery-1.3.2.min.js") %>'></script> 
```

这将使应用程序根目录的路径相对化，无论它是在顶层还是在虚拟目录中。我实际上开发了一个 HtmlHelper 扩展，可以将其清理为：

```
<%= Html.Javascript( Url.Content( "~/Scripts/jquery-1.3.2.min.js" )) %> 
```

添加以下内容以获得智能感知。这需要相对路径才能工作，但在运行时被排除在外，因为条件（总是）失败。

```
<% if (false) { %>
     <script type="text/javascript" src="../../Scripts/jquery-1.3.2.vsdoc.js"></script>
<% } %> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-08T14:39:47.173

您的代码在本地工作的原因是您的本地目录结构与您的生产目录结构不同。

话虽如此，我相信任何外部资源（javascript、图像和样式表）的绝对路径是最好的。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-08T14:42:11.083

正如安德鲁所说，您的目录结构完全不同。您是否考虑过使用 [google 的加载](http://code.google.com/apis/ajax/documentation/#GoogleLoad)库为您从壁橱位置加载 Jquery 给用户？

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-08T14:42:44.780

您是否尝试过从根 url 引用文件？即，使用“/Content/Scripts/jquery-1.3.2.min.js”代替“../../”，它必须爬上一个目录。这将不知道您的目录结构。

您还应该考虑使用 google 加载 jquery：

[http://code.google.com/apis/ajaxlibs/](http://code.google.com/apis/ajaxlibs/)

您将获得更好的加载时间。

麦克风

# jquery - 正则表达式 jquery

> ID：730337
> 
> 赞同：1
> 
> 时间：2009-04-08T14:38:27.660
> 
> 标签：jquery, regex

我想用 min char=5, max=20 验证一个 texbox，允许字母和数字，只有 3 个特殊字符！@# 使用纯 jQuery（无插件）

```
function chkText() {
            $(".cssText").each(function() {
// add regex condition here in an IF statement
});
} 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-08T14:42:11.397

这应该这样做：

```
function chkText() {
    $(".cssText").each(function() {
        if (/^[A-Za-z0-9!@#]{5,20}$/.test(this.value)) {
            // valid input value
        } else {
            // invalid input value
        }
    });
} 
```

# c# - 用于创建断开连接的数据库应用程序的最佳基于 .NET3.5 的策略

> ID：730347
> 
> 赞同：7
> 
> 时间：2009-04-08T14:40:31.523
> 
> 标签：c#, database, .net-3.5, ado.net

我的要求是：

*   相对较小的数据库：25-30 个表，每个表有 4-5k 行。*   4-5 个用户，在他们的笔记本电脑上拥有自己的本地数据库副本。在需要时或在一天结束时同步。*   免费解决方案，就像我为 NFP 组织做这个设置一样。

    最近几天我一直在研究各种选择。最后，我正在考虑缩小到数据集，同时将它们序列化为 XML，但似乎这毕竟不是一个好主意（我之前的问题的答案强烈暗示了这一点。）

    所以我现在的问题是我应该采取什么方法（数据库和访问技术）？我想使用 c# 和一种易于使用的技术来访问我的数据库并在一天结束时同步它。

    根据此链接：http://msdn.microsoft.com/en-us/library/8fxztkff.aspx，MS 提出了两种不同的方法。我很惊讶他们在这里没有提到 LINQ。

    所以组，你推荐什么路径？

    非常感谢您的阅读。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-08T14:44:44.930

添加 -> 新建 -> “本地数据库缓存”。这应该提供您需要的所有同步（通过 ADO.NET 同步框架），默认情况下由 SQL CE 运行（IIRC），这是（我相信）免费的。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-08T14:44:38.440

查看[Microsoft 同步框架](http://msdn.microsoft.com/en-us/sync/default.aspx)。

> 介绍 Microsoft Sync Framework – 一个全面的同步平台，支持任何数据类型、任何数据存储、任何传输协议和网络拓扑的应用程序、服务和设备的协作和离线。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-08T14:44:38.520

如果已经有 SQL Server（标准版或更高版本），您可以使用 SQL Server 复制服务将数据库的本地副本同步到用户计算机上的 SQL Express 或 SQL Server Compact 实例（两者都是免费的） .

欲了解更多信息，请[尝试此处](http://msdn.microsoft.com/en-us/library/ms151198.aspx)。

听起来您正在查看合并复制方案。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-13T05:04:33.160

对 OP：

我将在 Sync 框架前端给您的一个警告是在整个版本中升级数据库模式。我正在一个正在开发的[项目](http://www.dealprocessor.com/)中使用它，并且正在启动“2.0”规范，由于各种原因我决定将其删除。

我强烈建议您花时间考虑一下您希望如何处理模式更改，并决定这是否是您想要的方式。对我来说，这是为了让系统启动并运行，但现在我正在处理噩梦，我正在成为 NIH 情景的受害者。

我对 2.0 的展望是继续将 SqlCE 用于客户端，将 SQL Server 2008 用于 COR……但是基于大量使用反射和一组“DTO”对象来推出我自己的 Sync Fx。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-08T14:48:49.460

Microsoft 有一个他们称之为[Occasionally Connected Client](http://msdn.microsoft.com/en-us/library/bb384436.aspx)的模式。

# java - 使用 JDBC 连接器 5.1 从 Java 读取/写入 MySQL 中的 UTF-8 数据时出现问题

> ID：730359
> 
> 赞同：15
> 
> 时间：2009-04-08T14:44:23.060
> 
> 标签：java, mysql, jdbc, utf-8

我有一个包含两个 MySQL 数据库（UTF-8）的场景，一个同步两个数据库的 Java 代码（一个计时器服务）（首先读取它们并写入/更新到第二个）和一个允许修改加载的数据的 Web 应用程序第二个数据库。

所有数据库访问都是使用 IBATIS 进行的（但我发现使用 JDBC、`PreparedStatement`s 和`ResultSet`s 时我遇到了同样的问题）

当我的 java 代码从第一个数据库中读取数据时，我得到的字符就像`'Ã³'`真的必须是`'ó'`. 该数据无需修改即可写入第二个数据库。

后来，当我在我的 Web 应用程序中看到加载的数据时，尽管`<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />`.

如果我使用...解码数据

```
new String(data.getBytes("UTF-8")); 
```

...我正确地想象了这个角色（ó）。但我不能将此解决方案作为一般规则使用，因为当我使用 Web 应用程序表单修改数据时，我的第二个数据库中的数据不会以 UTF-8 更新（尽管数据库是 UTF-8 并且我的连接字符串使用字符编码， characterSetResults 和 useUnicode 参数）。

从我的 Java 代码中，我获得了以下数据库设置：

```
character_set_client-->utf8 
character_set_connection-->utf8 
character_set_database-->utf8 
character_set_filesystem-->binary 
character_set_results-->utf8 
character_set_server-->latin1 
character_set_system-->utf8 
character_sets_dir-->/usr/local/mysql51/share/mysql/charsets/ 
```

character_set_server 设置无法更改，我不知道我做错了什么！

如何使用 JDBC 连接器 ( `mysql-connector-java-5.1.5-bin.jar`) 从 MySQL 读取 UTF-8 数据？

是从第一个数据库读取数据还是写入第二个数据库有问题？

* * *

## 回答 #1

> 赞同：37
> 
> 时间：2012-06-16T15:46:56.737

有点晚了，但这会帮助你：

```
DriverManager.getConnection(
           "jdbc:mysql://" + host + "/" + dbName 
           + "?useUnicode=true&characterEncoding=UTF-8", user, pass); 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-08T15:12:00.437

您可以将`file.encoding`JVM 的属性设置为 UTF-8，以便所有区域设置/编码敏感的 API 将解码的字符串视为 UTF8。

例如，您可以在启动 Java 应用程序的命令行中设置它：

```
java -Dfile.encoding=UTF-8 .... 
```

您还可以参考[这个 SO question](https://stackoverflow.com/questions/138948/how-to-get-utf-8-working-in-java-webapps)以获得有关 Tomcat 设置的完整说明。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-04-08T15:12:15.363

在链中的某个点，UTF-8 编码的字节被用 Latin1 解码。从您的设置列表中，这似乎发生在“character_set_server”。在不知道这些值是如何获得的情况下，很难解释它们。

检查[系统属性](http://java.sun.com/j2se/1.5.0/docs/api/java/lang/System.html#getProperty(java.lang.String))“file.encoding”的值。如果那不是“UTF-8”，那么每当您将字节解码为字符时，都需要明确指定“UTF-8”作为字符编码。例如，当您使用 调用`String`构造函数`byte[]`或使用`InputStreamReader`.

最好明确指定字符编码，而不是依赖默认的平台编码。

# architecture - 有人能解释一下消息代理的用途吗？

> ID：730364
> 
> 赞同：18
> 
> 时间：2009-04-08T14:45:36.443
> 
> 标签：architecture, message-queue, messaging

在我的工作中，很难在五分钟内没有人赞美 MQ 系列或 MSMQ 之类的优点，而且我总是想知道，在流行语的火花过去之后，这些出色设备的实际*示例*是什么？真实世界。

我正在寻找的东西可能会激发我找到其中一个的用途，或者给我一些我可以用来评估消息总线/消息代理/消息队列的指标——地狱，甚至可以解释的东西上述消息*事物之间有什么区别。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-04-08T15:09:10.007

MQ 系列或 MSMQ 等消息队列解决方案广泛用于集成分布式企业应用程序，尤其是在不同平台上运行的应用程序。做得对（使用持久队列、异步设计而不是“RPC over MQ”并关注操作需求），与同步请求/回复集成（例如 RPC 或样板 Web 服务（其可用性**是**各自的可用性：同步集成 10 个具有 99% 可用性的系统，使您的组合可用性不超过 90%——如果只有一个薄弱环节，则更糟）。请注意，这要求消息队列本身具有高可用性：我们为此目的使用我们的大型机（猜猜我们正在使用哪种产品！）。

消息（或集成）代理和“总线”是更复杂的鱼。他们可以添加

*   **不同内容表示（文本编码和代码页）之间的**转换****
***   **监督**，检测目标系统何时没有收到排队的消息并发出警报或自动重新启动*   **转换**，当系统不“说相同的语言”并以不同的方式表示客户或产品记录时：原则上这可以帮助您以不同的速率部署新版本*   **路由**（直到并包括发布/订阅）以将发送系统与接收者详细信息的知识分离，从而减少目标系统更改的影响*   **编排**，您可以在其中协调多个系统之间的消息以跟踪更长的实际业务流程（例如，从客户订单到交付到开票）。**

 **我已经按照难度（和潜在奖励）大致递增的顺序列出了这些功能。您获得的越高，您的组织（包括业务方面）需要越成熟才能获得优势。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-08T14:56:30.347

在不深入了解特定产品的细节的情况下，我可以为您提供使用典型消息队列系统的一些好处。

它们通常是模拟发布者/订阅者模式的良好基础设施。考虑一个大型事件系统，您不仅限于一个可执行文件，甚至一台机器。您将信息放入这些队列中，以便任何正在侦听它的应用程序都可以获取数据。

大多数消息队列系统允许持久队列。考虑一个典型的事件系统。如果侦听器在事件发生时断开连接或以其他方式无响应，则错过该事件。使用持久消息队列，消息将保留在队列中，直到重新连接侦听器。这种方式不会丢失任何数据/事件。

我不知道您列出的产品，但我知道使用 JMS，您可以在从队列中弹出消息时对线程进行细粒度控制。理论上，每个队列可以有一个线程，在该线程中执行操作，在消息被拉出时对消息执行操作。或者，您可以从多个队列中提取消息并对它们执行操作，所有这些都在一个共享线程中。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-04-08T15:03:21.563

虽然我对 MQ 系列有过非常痛苦的体验，部分原因是它是由合作公司推给我们（微软商店）的，但使用 MQ 系列（或任何消息传递系统）是应用程序不可或缺的一部分.

本质上，我们正在构建一个流程来处理延期交货项目的供应链完成。如果我们的合作伙伴经销商没有客户想要的商品，他们会向 B2B 网站发送一条消息，该消息将针对可以完成订单的潜在公司。

我们构建了两种不同风格的集成。第一种是 ftp 方法，其中固定宽度的文件定期来回发送，我们添加了各种规则来帮助确保我们不会丢失任何数据。

第二个是使用 MQ 系列，其中消息被放入使用保证传递的队列中。然后我们会弹出队列并处理消息。排队系统在这里有很大的好处，因为它使我们能够以可靠的方式传输关键信息，从而使真钱得以转移。

另一方面，对于相同的 MQ 系列，我们必须实现同步查询来获取信息。我们希望它是同步的，因为我们的用户通过网络访问它会等待获取信息。在 MQ 系列上执行此操作是一个非常有趣且痛苦的挑战。在这里使用 MQ 的唯一原因是因为它是现有的通信线路并且查询功能已经存在。

第二个例子，这次是使用 MSMQ，它是一个从注入到客户端应用程序的 dialhome 代码中收集信息的站点。dialhome 代码将收集功能使用统计信息，例如 Microsoft 的 SQM 程序。当消息进入 Web 服务时，我们会将它们放在队列中，然后我们可以让任意数量的应用程序服务器弹出消息并将它们推送到数据库以滚动到仓库中。

这里的 MSMQ 确保我们可以通过快速将消息放入队列来处理突发消息。这有助于系统的可扩展性和可靠性。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-04-08T15:25:33.710

消息队列对于实现负载平衡很有用。例如，服务器接收“工作”消息（订单、状态消息......）并将它们分发给所有正在侦听的客户端。

消息队列保证一条消息将被准确地传递给一个客户端。

如果客户端在不同的计算机上运行，​​则总负载将被分配，并且在必要时很容易将另一个客户端投入到消息负载中，客户端只需连接到队列并接收（部分）消息。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-12-02T11:52:39.153

一个好的队列系统可以更容易地在多个线程、处理器、机器（甚至组织）上进行分布式计算。

不久前（10 年前），我使用了一个消息发送隐喻来为一个跨交易商经纪人实施一个前台期权定价系统。我们有用 C++、VB6 和 Excel/VBA 实现的服务（甚至使用 Excel 求解器！！），作为平面文件和 sql 的数据存储，用 Excel 和 VB6 编写的最终用户应用程序，具有复杂的数据模型（市场数据、产量曲线和体积曲面）。异步消息传递（具有持久/可靠消息和发布/订阅）使整个工作非常有效和可扩展 - 我们能够将东京和纽约办事处添加到伦敦基础设施，甚至无需访问远程站点 - 只是一个沼泽标准安装。

我是一个忠实的粉丝，尽管我很惊讶他们在过去 10 年左右的时间里没有走多远。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-12-02T12:01:47.853

一个来自真实项目的非常“接近要求​​”的例子。从谁跑了好几年。在 ActiveMQ 上

1）航运市场的贸易中心。

*   运输公司有系统知道他们可以实时运输多少包。

*   每个系统都是不同的（例如：语言、设计等）

*   我们为每个公司写了一个适配器“非常特殊的IT系统到ActiveMQ”

*   每个适配器都有一个简单的工作要做：在公司有可用空间时发布，以及以什么价格发布。（“运输提议”）

*   我们写了一个收集所有“运输建议”的客户，并很好地展示它们。

=> 达达。您有一个跨平台/语言/流程系统，适用于不想互相交谈的公司

=> Ta-da 2 : 如果一个新公司想进入你的贸易系统，他们只需要编写适配器。

# c# - 代理主机C#问题

> ID：730365
> 
> 赞同：0
> 
> 时间：2009-04-08T14:46:29.077
> 
> 标签：c#, proxy

我的代理使用情况：“Proxy.ashx?url="

代码：

```
<%@ WebHandler Language="C#" Class="Proxy" %>

public class Proxy : IHttpHandler {

public void ProcessRequest (HttpContext context) {

    HttpWebRequest request = (HttpWebRequest)WebRequest.Create(context.Request["url"]);
    request.UserAgent = context.Request.UserAgent;
    request.ContentType = context.Request.ContentType;
    request.Method = context.Request.HttpMethod;

    byte[] trans = new byte[1024];
    int offset = 0;
    int offcnt = 0;

    if (request.Method.ToUpper() == "POST")
    {
        Stream nstream = request.GetRequestStream();
        while (offset < context.Request.ContentLength)
        {
            offcnt = context.Request.InputStream.Read(trans, offset, 1024);
            if (offcnt > 0)
            {
                nstream.Write(trans, 0, offcnt);
                offset += offcnt;
            }
        }
        nstream.Close();
    }

    using (HttpWebResponse response = (HttpWebResponse)request.GetResponse())
    {
        context.Response.ContentType = response.ContentType;

        using (Stream receiveStream = response.GetResponseStream())
        {
            offset = 0;
            offcnt = receiveStream.Read(trans, offset, 1024);
            while (offcnt>0)
            {
                context.Response.OutputStream.Write(trans, 0, offcnt);
                offset += offcnt;
                if (offcnt >= 0)
                {
                    try
                    {
                        offcnt = receiveStream.Read(trans, offset, 1024);
                    }
                    catch (Exception)
                    {
                        break;
                    }
                }
                else
                    break;       
            }
        }
        context.Response.OutputStream.Close();
        context.Response.Flush();
        response.Close();
    }
}

public bool IsReusable {
    get {
        return false;
    }
} 
```

}

结果我总是得到一个空白页面（Proxy.ashx?url= [http://www.google.com](http://www.google.com)）......知道我犯了什么错误吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-08T14:56:05.857

对于 POST 处理，ContentLength 可能为 0，不要依赖它。只需打开流并尽可能多地读取，直到流不再返回数据。

其余的，读入数组时的偏移量必须保持为 0，因为它是数组的偏移量而不是流的偏移量。

```
using (Stream receiveStream = response.GetResponseStream()) {
   for (int offcnt = receiveStream.Read(trans, 0, trans.Length); offcnt > 0; offcnt = receiveStream.Read(trans, 0, trans.Length)) {
      context.Response.OutputStream.Write(trans, 0, offcnt);
   }
} 
```

# sql-server - 从构建执行计划的角度来看，'select *' 有什么影响？

> ID：730366
> 
> 赞同：3
> 
> 时间：2009-04-08T14:46:52.413
> 
> 标签：sql-server, tsql

我听说使用“select *”会增加 SQL Server 构建查询执行计划的时间，因为它必须找出引用表中存在哪些列。这同样适用于基于视图而不是表的查询吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-08T14:51:00.813

微不足道的时间。是的，如果它适用于表，它适用于视图。

但是在做 SQL 的 12 年里，我还没有看到通过显式命名列而不是使用`*`.

在生产代码中，我不使用`*`，但这是为了使代码意味着它所说的内容，而不是效率，并且因为在绑定到结果集时顺序很重要

在生产视图中，`*`如果视图的意图（如果“我的意思”）是“引入所有列”，我将使用它；这样，重新编译视图将获取表更改。顺序在视图中并不重要；*仅在可能使用*视图的客户端查询中。

编辑时：请注意，视图定义在*创建*视图时被解析一次（直到重新编译），而不是在使用时。`*`因此，从发送到数据库服务器的时间很少`column1, c2, d3, foobar`发生一次。`create view`

现在，将所有列带回*客户端*将比只带回一个要慢（尽管通常不会慢很多）。但这是一个不同的问题。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-08T15:04:59.093

在查询计划方面没有区别，但出于多种原因，显式定义列被认为是一种好的做法，包括：

*   向表中添加列不会破坏依赖于旧列设置的遗留代码。
*   从不需要的列中选择数据意味着更多的数据传输，这通常是从数据库中获取数据最慢的部分。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-08T15:07:53.080

想象一下，你有一张这样的表：

```
CREATE TABLE t_test (id INT NOT NULL PRIMARY KEY, value1 INT, value2 INT, aux_value VARCHAR(200))
CREATE INDEX ix_test_values ON (value1, value2) 
```

然后你想选择一定范围内的所有值：

```
SELECT  value1, value2
FROM    t_test
WHERE   value1 BETWEEN 10 AND 20 
```

在这种情况下，`SQL Server`只会扫描索引`ix_test_values`。你想知道的一切都包含在这个索引中，这就是为什么除了 之外什么都不`INDEX SCAN`需要。

现在你发出：

```
SELECT  *
FROM    t_test
WHERE   value1 BETWEEN 10 AND 20 
```

`SQL Server`现在需要选择`id`and`aux_value`以及`value1`and `value2`。这些值不包含在索引中，这就是为什么每个索引叶子`SQL Server`都应该查看表本身并从表页面中检索值。

这可能比简单的索引扫描花费更长`4`的`10`时间，具体取决于您的表结构有多复杂以及有多少页适合内存。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-08T15:16:48.130

> 我听说使用“select *”会增加 SQL Server 构建查询执行计划的时间，因为它必须找出引用表中存在哪些列。

想想看。发送时 SQL Server 会做什么：

```
SELECT ID, col1, col2, col3
  FROM table 
```

上面的语句意味着它不会检查表中是否存在 ID、col1、col2 等——它只会相信你的话？天哪！:D

它将查看系统目录以查看这些列是否存在。在内部，这实际上等同于说：

```
SELECT * FROM table 
```

有很多**不**使用 SELECT * 的理由（到目前为止，它们已在此列表中列出），但声称它为查询解析时间增加了可衡量的、有意义的开销，这简直是愚蠢的。所以如果有人试图告诉你，请纠正他们:)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-08T14:49:10.333

是的; 色谱柱发现过程仍需进行。" `select *`" 绝不应在生产应用程序或过程中使用。您应该始终明确定义要检索的特定数据。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-08T14:50:41.220

我敢打赌，无论哪种情况，时间都可以忽略不计。但是，出于其他原因，您应该避免选择 *。

使用 select * 可以返回比您实际需要的数据更多的数据，这取决于数据可能很重要。然后会出现问题，如果您删除一列，您的查询可能仍然有效；但是，消费代码可能会失败。您真的失去了确定某人是否正在使用该列的能力。

# java - Java 代理有哪些有趣的用途？

> ID：730372
> 
> 赞同：5
> 
> 时间：2009-04-08T14:48:28.167
> 
> 标签：java, classloader, javaagents

从 Java 5 开始，可以选择将 Java 代理添加到类加载器。

你写过代理吗？你用过代理吗？代理有什么有趣的用途？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-08T15:47:17.167

我使用了各种使用此功能的 Java 分析器。[Profiler4j ( http://profiler4j.sourceforge.net](http://profiler4j.sourceforge.net) )是一个很好的使用它的开源 java 分析器。

这是在您的 java 代码中查找性能瓶颈的好工具。

# winforms - 如何在 Windows 窗体应用程序中向具有许多控件的 Panel 控件添加滚动条？

> ID：730376
> 
> 赞同：82
> 
> 时间：2009-04-08T14:49:04.093
> 
> 标签：winforms, controls, scrollbar, panel

如何在 Windows 窗体应用程序中向具有许多控件的 Panel 控件添加滚动条？

* * *

## 回答 #1

> 赞同：120
> 
> 时间：2009-04-08T15:09:03.967

只需将`AutoScroll`您的属性设置`Panel`为 true，它将为您处理添加滚动条。

```
this.panel1.AutoScroll = true; 
```

# pdf - Confluence 的 PDF 上传速度慢

> ID：730382
> 
> 赞同：0
> 
> 时间：2009-04-08T14:50:39.677
> 
> 标签：pdf, upload, jpeg, gif, confluence

我们运行一个使用 Atlassian Confluence 托管的网站。该网站运行良好，现在正在使用。但有一件事。

上传 pdf 和 gif 时，上传速度似乎会变慢。但是较小的文件会很好地上传。还有其他人在将 pdf 上传到 Confluence 时遇到问题吗？

我正在尝试使用提琴手来跟踪速度，但没有运气。任何信息将不胜感激。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2010-04-11T17:11:58.340

如果您使用的是最新版本的 Confluence，例如 3.1 及更高版本，您可以将多个文件拖放到 Confluence 页面上。

为此，您必须使用支持“Google Gears”的浏览器。

使用拖放功能为您提供了不错的进度条，因此您可以实时查看上传进度。这样做也使用 WebDAV 协议来上传文件，这比通过标准 HTTP 上传发送的速度要快得多。

上传速度应该是相同的，但是如果您在 Confluence 页面中渲染大型 PDF，它可能会减慢速度，尤其是在初始渲染时。我们遇到了渲染非常大的 PDF 的问题，有时会*感觉*上传速度受到影响，但实际上是页面内渲染在该 PDF 的第一页加载时很慢。

有关拖放的更多信息：http: [//confluence.atlassian.com/display/DOC/Drag-and-Drop](http://confluence.atlassian.com/display/DOC/Drag-and-Drop)

# javascript - 如何更改文本框的类别？

> ID：730384
> 
> 赞同：0
> 
> 时间：2009-04-08T14:50:43.433
> 
> 标签：javascript, jquery

我的文本框有一个`class='cssText'`. 我想`'blck'`在运行时将此类更改为。

如何访问文本框的类属性并使用 jQuery 更改其值？

谢谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-08T14:55:00.523

```
$("input#id").removeClass("cssText").addClass("blck"); 
```

或者

```
$("input#id").attr("class", "blck"); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-08T14:55:50.223

您应该选择文本框，然后设置新类：

```
$(selector_for_textbox).removeClass('cssText').addClass('blck'); 
```

您的文本框的可能选择器当然可以是类，或者是 id 或其他东西：

```
$('#textbox'). //etc
$('input.cssText:text'). //etc 
```

**从评论编辑**
您应该使用：

```
$('#txt').removeClass('cssText').addClass('blck'); 
```

# debugging - 如何将本地函数描述为（跟踪）？

> ID：730388
> 
> 赞同：5
> 
> 时间：2009-04-08T14:51:21.810
> 
> 标签：debugging, common-lisp, trace

在 common lisp 中，函数（跟踪名称）可用于查看有关函数调用的输出。

如果我的函数是在本地范围内声明的，我该如何描述它以进行跟踪？

例如，我如何跟踪栏，如下：

```
(defun foo (x)  
  (labels ((bar (y) (format t "bar: ~a~&" y)))  
    (bar x))) 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-08T16:19:19.760

由于没有跟踪本地函数的标准方法，我解决这个问题的方法是编写一个`tracing-labels`实现跟踪的宏，转换以下内容：

```
(defun foo (x)  
  (tracing-labels ((bar (y) (format t "bar: ~a~&" y)))  
    (bar x))) 
```

变成这样的东西：

```
(defun foo (x)
  (labels ((bar (y)
             (format *trace-output* "~&ENTER: ~S" 'bar)  ;'
             (multiple-value-prog1
                 (progn (format t "bar: ~a~&" y))
               (format *trace-output* "~&LEAVE: ~S" 'bar))))  ;'
    (bar x))) 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-08T16:07:09.507

`(TRACE ...)`ANSI Common Lisp 没有定义跟踪本地函数。

一些实现有扩展来做到这一点。参见例如[CMU CL](http://common-lisp.net/project/cmucl/doc/cmu-user/debugger.html)。

除此之外，您需要在 FOO 的定义中添加一些代码。例如，拥有一个宏可能很有用，这样您就可以将对 bar 的调用编写为 (trace-it (bar x))，并且该宏将扩展为打印入口和出口的代码。

# python - wxPython：制作固定高度的面板

> ID：730394
> 
> 赞同：2
> 
> 时间：2009-04-08T14:53:31.337
> 
> 标签：python, layout, wxpython, widget

我有一个 wx.Frame，其中有一个带有两个项目的垂直 BoxSizer，一个 TextCtrl 和一个自定义小部件。我希望自定义小部件具有固定的像素高度，而 TextCtrl 将正常展开以填充窗口。我该怎么办？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-08T15:06:48.403

知道了。

创建小部件时，使用 的大小`(-1,100)`，其中“ `100`”是您想要的高度。显然，“ `-1`”在这种情况下是一种“无”。

将小部件添加到 sizer 时，使用比例为 0，如下所示： `self.sizer.Add(self.timeline,0,wx.EXPAND)`

# c# - 自动刷新 ASP.NET 中的网页并捕获下一次刷新前的时间

> ID：730395
> 
> 赞同：1
> 
> 时间：2009-04-08T14:53:36.080
> 
> 标签：c#, .net, asp.net, javascript

我知道应该有一个简单的方法来做到这一点，但我想我的大脑今天不工作了。我需要在 x 秒内刷新一个页面。我可以使用以下方法在 .NET 中执行此操作：

```
Response.AddHeader("Refresh", "300"); 
```

这很好，除了我还需要显示下一次刷新之前的分钟数和秒数。

所以我在 javascript 中使用以下代码从客户端执行此操作：

```
<script type="text/javascript"">

    //enter refresh time in "minutes:seconds" Minutes should range from 0 to inifinity. Seconds should range from 0 to 59
    var limit="0:30"

    if (document.images){
        var parselimit=limit.split(":")
        parselimit=parselimit[0]*60+parselimit[1]*1
    }

    function beginrefresh(){
        if (!document.images)
            return

        if (parselimit==1)
            window.location.reload()
        else{ 
            parselimit-=1
            curmin=Math.floor(parselimit/60)
            cursec=parselimit%60
            if (curmin!=0)
                curtime=curmin+" minutes and "+cursec+" seconds left until page refresh!"
            else
                curtime=cursec+" seconds left until page refresh!"

            window.status=curtime
            setTimeout("beginrefresh()",1000)
        }
    }

    window.onload=beginrefresh;

</script> 
```

除了一件事之外，这有效 - 每次刷新页面时，浏览器 (IE) 都会发出关于重新下载内容或其他内容的唠叨消息。这是不行的。这是一个用户将整天打开的页面，它需要在没有用户干预的情况下刷新。我想我可以取消显示直到下次刷新的时间的消息，而只使用 ASP.NET 行，但如果有人有更好的主意，我将不胜感激。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-08T14:56:37.290

`window.location.reload()`尝试重定向到当前 URL，而不是使用：

```
window.location = window.location; 
```

这样，浏览器将不会进行回发，而是向服务器发出新请求。您需要在各种浏览器中对此进行测试。我刚刚快速测试了FF 3 & IE8；看起来都不错。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-08T14:59:06.707

您可以编写一些用于刷新目的的 JavaScript 以及用于刷新计时器的代码。要刷新页面，您必须这样写 -

> **window.location.href = window.location.href**

这行JS会刷新页面，没有你说的NAG画面（nag画面其实是浏览器问的一个问题，是否要重新发布POST数据到服务器）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-08T14:59:45.877

“唠叨”来自浏览器刷新已发布到服务器一次的内容，是因为您的“重新加载”行。

还有另一种刷新整个页面的选项，它只是刷新您使用 AJAX 功能实际更改的页面部分。

# testing - VoIP测试环境

> ID：730396
> 
> 赞同：1
> 
> 时间：2009-04-08T14:53:49.807
> 
> 标签：testing, sip, voip, environment

我想为一个学生项目构建一个 VoIP 测试环境。它应该使用 SIP。

我的第一个想法是使用[Asterisk](http://www.asterisk.org/)、[OpenSIPS](http://www.opensips.org/)或[FreeSWITCH](http://www.freeswitch.org/)作为服务器，使用[SIP Communicator](http://www.sip-communicator.org/)、[Minisip](http://www.minisip.org/)或[Linphone](http://www.linphone.org/index.php/eng)作为软电话客户端。

*   有没有人有建立这样一个环境的经验？
*   我应该使用哪种组合？
*   是否有设置此基础架构的教程？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-08T15:17:36.520

`Asterisk`我对和有一些经验`SJPhone`。

如果您的网络不需要复杂的拨号计划（如热线等），并且您`PC`的网络可以相互访问，那么您根本不需要服务器。

`SJphone`只需使用`IP`地址或主机名即可建立对等连接。

如果您的 PC 无法相互访问，则应`Asterisk`在其上设置并启用客户端注册。

在我的`Fedora 10`，`Asterisk`开箱即用。

客户端注册就像在线`ICQ`or `MSN`：服务器知道您在线并保持您的`TCP`流处于活动状态，以防有人想给您打电话。

它还可以用来显示人们的状态：谁在线、离线、忙碌等。

包含一个示例`sip.conf`文件，非常简单。对于每个客户端，您创建一个如下条目：

```
[john]
type=friend
secret=secretpassword
host=dynamic 
```

有插件可以将这些数据保存在数据库中，但我还没有查看它们。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-14T07:12:18.717

请记住，OpenSIPS 与 Asterisk 或 FreeSWITCH 的目的是非常不同的。

OpenSIPS 是一个 SIP 代理，而不是任何类型的用户代理。它不能用作呼叫端点，它专门用于呼叫路由和低级 SIP 处理，以及其他一些其他 UAS 类型的功能（即注册器）。

Asterisk 和 FreeSWITCH 同时可以用作 PBX、IVR 服务器、媒体服务器等。

因此，这实际上取决于项目的目标是什么。如果只是从一部手机拨打另一部手机，则根本不需要中间任何东西。如果要修补某些高级电话应用程序，请使用 Asterisk 或 FreeSWITCH。如果是简单的路由和信令中介（不涉及媒体），请使用 OpenSIPS 之类的。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-06-05T14:51:56.923

请查看[Mobicents](http://www.mobicents.org)。它是完整的 Java，它由 Mobicents Sip Servlets 和 JAIN SLEE 组成，用于构建强大的 SIP、VoIP 或融合应用程序以及用于所有相关媒体内容（如会议 IVR 等）的媒体服务器，...

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-06-21T12:53:17.870

这取决于你想测试什么。我建议：

*   sipp 如果你想模拟协议测试并弄乱 SIP 流
*   Mobicents 如果你想编写服务器软件来测试客户端。如果您使用它，您还可以将您的测试套件集成到 JUnit 等中。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-10-19T14:42:09.697

我用 miniSipServer 和 Xlite 构建了一个 SIP 系统。这两个软件都是基于 Windows 的。这是非常容易使用。

并且有一个简单的分步文档来描述如何部署 VOIP 网络，请参考：

[http://www.myvoipapp.com/docs/faq/setup_ippbx_for_small_business_step_by_step/index.html](http://www.myvoipapp.com/docs/faq/setup_ippbx_for_small_business_step_by_step/index.html)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-08T19:03:59.770

我会说要使用的项目取决于您的主要关注点。如果它是 SIP 并且您想了解协议，我会使用 SIP Express Router 或派生的项目之一。如果它一般使用 voip，Asterisk 是正确的选择。Asterisk 现在是一个不错的选择

对于客户，这也取决于您要做什么...我以前有时会使用Xlite，SJPhone，Linphone和KPhone...

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2012-10-28T22:50:32.873

我正在为自己构建这样一个测试服务器，您可以在这里找到一些想法：http: [//txlab.wordpress.com/tag/xlab1/](http://txlab.wordpress.com/tag/xlab1/)

# php - 权限被拒绝错误调用 fopen

> ID：730399
> 
> 赞同：0
> 
> 时间：2009-04-08T14:54:55.717
> 
> 标签：php

我在 Leopard 上使用 XAMPP。我正在尝试使用 fopen 创建缓存文件，但我得到了

```
警告：fopen（/Applications/xampp/xamppfiles/htdocs/mysite/cache/index.php.cache）[function.fopen]：无法打开流：/Applications/xampp/xamppfiles/htdocs/mysite/functions 中的权限被拒绝。第 26 行的 php
```

我尝试在 finder 中使用 CMD+I 更改文件夹权限并为每个人设置读/写访问权限，但没有成功。

有什么想法吗？

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-08T14:58:35.397

您需要更改该文件的权限，而不是文件夹。

无论如何，如果您尝试更改权限但做不到，那可能意味着您根本没有 chmod 的权限！

如果您具有管理权限，请在终端中尝试*sudo chmod 。*

# c++ - gprof 和可执行文件的参数

> ID：730400
> 
> 赞同：31
> 
> 时间：2009-04-08T14:54:57.467
> 
> 标签：c++, debugging, gprof

使用 gprof 时：

```
$ gprof options [executable-file [profile-data-files...]] [> outfile] 
```

如果您可以选择传递给可执行文件，例如：

```
gprof a.out --varfred=32 
```

然后 gprof 假定我将一个无效选项传递给它，而不是传递给正在分析的程序 ( `a.out`)。

有什么办法可以解决这个问题？

* * *

## 回答 #1

> 赞同：36
> 
> 时间：2009-04-08T14:56:37.680

您不使用 gprof 运行可执行文件，因此您只需指定它以便 gprof 可以加载符号。您首先像往常一样单独运行可执行文件，然后它会发出分析数据。

该数据与可执行文件一起由 gprof 稍后加载。

当然，这一切都在[gprof 手册](https://sourceware.org/binutils/docs/gprof/)中进行了解释。

# c# - 向上转换和通用列表

> ID：730401
> 
> 赞同：6
> 
> 时间：2009-04-08T14:54:59.260
> 
> 标签：c#, .net

我有以下类层次结构：

```
public abstract class BaseData
{
  //some properties
}

public class CoData : BaseData
{
  //some properties
} 
```

我正在使用一种要求返回类型为`List<BaseData>`. 在该方法中，我可以访问`List<CoData>`

```
public List<BaseData> Save()
{
  List<CoData> listCoData = GetData();
  return listCoData;
} 
```

如果我理解正确，我可以从 a 向上`CoData`转换为 a `BaseData`。但是，当我有一个列表时，即使我明确尝试进行类型转换，它也会出错。

错误：

```
Error   118 Cannot implicitly convert type 'System.Collections.Generic.List<CoData>' to System.Collections.Generic.List<BaseData>' 
```

**编辑：**

mquander 的转换方法似乎在 3.0 中对我有用

向下转换是否也以同样的方式进行？从

即，我可以这样做 -`List<CoData> listCoData = listBaseData.Cast<BaseData>().ToList();`

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-04-08T14:57:37.037

是的; 欢迎变异。最终，它**不是**一个列表`BaseData`——例如，如果你有另一个子类，a`List<BaseData>`会（在编译时）让你`.Add`......但运行时类型不会让你。编译器正在阻止你犯错。

[在某些情况下，泛型可以在这里提供帮助......我在这篇博](http://marcgravell.blogspot.com/2009/02/what-c-40-covariance-doesn-do.html)文的末尾讨论了这个问题。请注意，.NET 4.0 差异不适用于列表。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-04-08T14:57:53.013

这称为集合参数的“协方差”，C# 目前不支持这种协方差。在 C# 4.0 中，用户定义的类型和一些类似的内置类型`IEnumerable<T>`将支持这一点。

同时，您可以通过使用显式强制转换成员创建一个新枚举来解决它（您可能需要考虑将您的东西的返回类型更改为，`IEnumerable<T>`这样您就不必一直实际制作新集合： )

```
public List<BaseData> Save()
{
    List<CoData> listCoData = GetData();
    return listCoData.Cast<BaseData>().ToList();
} 
```

根据 GetData 的工作方式，您还可以考虑这样的结构：

```
public List<T> Save<T>() where T : BaseData
{
    return listCoData = GetData<T>();
} 
```

**编辑**：实际上，正如 Marc 和其他人无疑会指出的那样，`List<T>`不能像这样协变，因为您可以以会破坏类型安全的方式添加成员。但是，如果您`IEnumerable<T>`改为返回 s，则可以在此处使用协方差。

**编辑 2**：针对您的附加问题：

> 我可以这样做吗？ `List<CoData> listCoData = listBaseData.Cast<BaseData>().ToList();`

No. `listBaseData.Cast<BaseData>().ToList();`返回一个`List<BaseData>`不能直接转换为`List<CoData>`. 这就是为什么我们必须首先进行这项工作。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-08T15:33:41.460

mquander 解决方案的另一个变体是这样实现 Save：

```
public List<BaseData> Save()
{
    List<CoData> listCoData = GetData();
    return listCoData.ConvertAll<BaseData>(
        delegate(CoData c) { return c as BaseData; });
} 
```

这将允许您在匿名委托中进行一些额外的处理，而不仅仅是强制转换它。

这里要记住的重要一点是，虽然 CoData 继承自 BaseData，但 List 不继承自 List。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-08T14:58:44.150

您必须等到 C# 4.0 才能使用[泛型 covariance](http://www.codethinked.com/post/2008/10/31/C-40-New-Features-Part-3-Generic-Covariance.aspx)。

# c# - 保留列表框项目选择

> ID：730406
> 
> 赞同：1
> 
> 时间：2009-04-08T14:55:31.363
> 
> 标签：c#, collections, listbox, filtering, selection

首先是代码（对不起，如果不是 100%）我不是专家，然后是问题。

```
 public partial class Window1 : Window
    {
    CollectionView cv;

    public Window1()
    {
        InitializeComponent();

        List<Person> ppl = new List<Person>();
        BitmapImage b = new BitmapImage(new Uri(@"http://i.stackoverflow.com/Content/Img/stackoverflow-logo-250.png",UriKind.Absolute));
        ppl.Add(new Person(b, "world1"));
        ppl.Add(new Person(b, "world2"));
        ppl.Add(new Person(b, "world3"));
        ppl.Add(new Person(b, "world4"));
        ppl.Add(new Person(b, "world5"));
        ppl.Add(new Person(b, "world6"));

        lb.ItemsSource = ppl;
        lb.SelectedIndex = 1;

        cv = (CollectionView)CollectionViewSource.GetDefaultView(lb.ItemsSource);

        new TextSearchFilter(cv, textBox1);
    }
}

public class TextSearchFilter
{
    public TextSearchFilter(CollectionView cv, TextBox tb)
    {
        string filterText = "";

        cv.Filter = delegate(object obj)
        {
            Person p = obj as Person;
            int index = p.Info.IndexOf(filterText,0,StringComparison.InvariantCultureIgnoreCase);
            return index > -1;
        };

        tb.TextChanged += delegate
        {
            filterText = tb.Text;
            cv.Refresh();
        };
    }
}

    class Person
    {
        private BitmapImage myImage;
        private string myInfo = "";

        public BitmapImage Image
        {
            get { return myImage; }
            set { myImage = value; }
        }

        public string Info
        {
            get { return myInfo; }
            set { myInfo = value; }
        }

        public Person(BitmapImage Image, string Info)
        {
            this.Image = Image;
            this.Info = Info;
        }
    } 
```

感谢您到目前为止的阅读，正如您现在所理解的那样，代码根据文本框中的输入过滤列表框，这就像一个魅力顺便说一句。

我的问题是如何在过滤期间保留选择。当窗口加载时，列表框包含所有项目，我选择第一个项目，然后我在文本框中输入一些内容，列表框过滤器仅显示相关项目，在选择另一个项目后，我从文本中删除所有文本将其恢复到原始状态的框，但这次选择已更改为仅我在过滤视图中选择的项目（因此，不是两个项目显示为选中，而是一个显示为选中）。当我对集合进行过滤时，这种行为很明显，因此当集合更改时，选择就会丢失。

有没有办法保留选择？任何指针？

非常感谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-08T15:46:24.080

可能在您的 TextChanged 事件处理程序中，您应该存储 ListBox 的选定项，如下所示：

```
Person[] selectedPeople = new Person[lb.SelectedItems.Count];
lb.SelectedItems.CopyTo(selectedPeople, 0); 
```

然后在刷新过滤器后，使用以下命令将它们添加回来：

```
foreach (Person p in selectedPeople)
{
    if(lb.Items.Contains(p))
    {
        lb.SelectedItems.Add(p);
    }
} 
```

我使用 CopyTo 并保存在数组中而不是仅使用它的原因：

```
IList selectedPeople = lb.SelectedItems; 
```

就是后者只会保留对lb.SelectedItems的引用，而foreach会修改枚举，导致抛出异常。可能有更简单的方法，但这应该会让你朝着正确的方向前进。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2014-08-01T16:42:52.693

我的猜测是过滤器将插入、删除和重新排列可观察集合中的项目。当它临时删除一个以将其插入其他地方时，WPF 会过早地将 SelectedItem 设置为 null。然后当你重新添加它时，它不会被选中。

这是您可以附加到列表框的行为形式的解决方法。

[http://www.codeproject.com/Tips/802806/Preserve-the-Selected-Item-of-a-WPF-List-Box](http://www.codeproject.com/Tips/802806/Preserve-the-Selected-Item-of-a-WPF-List-Box)

# jquery - jquery ui，手动调用开始拖动

> ID：730409
> 
> 赞同：11
> 
> 时间：2009-04-08T14:56:12.127
> 
> 标签：jquery, user-interface, drag

在 Jquery UI 中，我可以通过调用将元素配置为可拖动

```
$("#drag").draggable(); 
```

但是有没有办法从另一个功能手动启动和停止拖动功能？IE

```
someOtherFunction = function() {
  $("#drag").startdrag();
}
yetAnotherFunction = function() {
  $("#drag").stopdrag();
} 
```

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2011-05-23T00:07:49.717

上面的答案似乎过于复杂。

```
$('.nonDraggableObjectWhichTriggersDrag').mousedown(function(e) {
    $('.draggableObject').trigger(e); 
}); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-08T15:09:53.390

拖动开始是通过查看鼠标事件的脚本启动的。鼠标按下，然后鼠标移动。如果您可以通过 Javascript 模拟这些鼠标移动（我不知道在哪里、如何，或者即使这是可能的），那么它应该会触发拖动的开始。

注意：刚刚发现YUI有一种模拟鼠标移动和鼠标点击的方法。查看[http://developer.yahoo.com/yui/yuitest/#useractions](http://developer.yahoo.com/yui/yuitest/#useractions)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-10-24T20:36:48.667

要停止拖动，您只需在拖动回调中返回 false，如下所示：

```
$("#unlock-handle").draggable({axis:'x', containment:'parent', drag:onDrag});

...

var onDrag = function(e) {      
    if ($(this).position().left > 200) return false;
}; 
```

希望能帮助到你 ：-）

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-11-17T01:36:31.270

我没有找到手动触发拖动的方法，但我找到了针对类似情况的解决方法。

我有两个重叠的图像（见下图），都是部分透明的。在可拖动的开始（事件）中，我想检查它是否击中透明像素。如果是这样，我在它下面寻找另一个元素，看看那个元素是否被击中。如果是，我想启动它的拖动。

![在此处输入图像描述](https://i.stack.imgur.com/XoWnU.png)

解决方案？我在 mousemove 上重新排序图像，然后为最上面的图像触发可拖动。

对于像素精确的元素选择，请参阅我的另一个答案：[注册点击另一个元素下的元素](https://stackoverflow.com/questions/1148424/registering-clicks-on-an-element-that-is-under-another-element/13426070#13426070)

# vba - 使用 ms-access 确定 ODBC 失败（错误 3146）的真正原因？

> ID：730414
> 
> 赞同：9
> 
> 时间：2009-04-08T14:57:11.453
> 
> 标签：vba, ms-access, vbscript, odbc

我的客户端使用 Access 作为 SQL Server 数据库的前端。他们最近开始在运行某些报告时不时收到 ODBC - 3146 错误。据我所知，这只是一个通用的 ODBC 调用失败错误。

我尝试在启动报告的 VB 脚本中添加一些错误处理，但我没有任何运气获得额外的错误信息。

代码看起来有点像这样。

```
Public Function RunReports()
  On Error GoTo MyErrorTrap

  DoCmd.OpenReport "blah", acViewPreview
  DoCmd.Close

  DoCmd.OpenReport "foo", acViewPreview
  DoCmd.Close

Exit_function:
  Exit Function

MyErrorTrap:
  Dim errX As DAO.Error
  Dim MyError As Error
  If Errors.Count > 1   'This always seems to be 0, so no help
    For Each errX In DAO.Errors  'These are empty even if dont check for Errors.Count
      Debug.Print "ODBC Error"
      Debug.Print errX.Number
      Debug.Print errX.Description
    Next errX
  Else
    Debug.Print "VBA Error"
    Debug.Print Err.Number
    Debug.Print Err.Description
  End If

  'Also have tried checking DBEngine.Errors, but this is empty too

End Function 
```

我还在 ODBC 端启用了跟踪，但这使事情陷入了太多困境，而且我到目前为止无法重新创建 ODBC 错误。

我完全愿意接受有关如何诊断此问题的建议。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2014-06-16T20:22:21.910

使用`DbEngine.Errors`集合。

```
Sub Update_Temp()
On Error GoTo ErrorTrap
    ' Execute connect code at this point
Exit_errortrap:
    Exit Sub
ErrorTrap:
    Dim myerror As DAO.Error
    For Each myerror In DBEngine.Errors
        With myerror
            If .Number <> 3146 Then
                MsgBox .Description
            End If
        End With
    Next
    Resume Exit_errortrap

End Sub 
```

要启用此代码，请确保在 VBA 设置中打开错误处理。

# c# - 获取表的 SQL Server 架构

> ID：730421
> 
> 赞同：1
> 
> 时间：2009-04-08T14:58:16.100
> 
> 标签：c#, .net, sql, ado.net, schema

我有以下 C# 代码，我试图返回存储过程结果以及这些结果的架构。以下是我的代码（简化）当前的外观...

```
Database db = DatabaseFactory.CreateDatabase();
DbCommand dbCommand = db.GetStoredProcCommand("MyStoredProcedure");
IDataReader drData = db.ExecuteReader(dbCommand);

DataTable tblSchema;
tblSchema  = drData.GetSchemaTable(); 
```

GetSchemaTable 返回空。我已经读到我需要将 CommandBehavior.KeyInfo 传递给 ExecuteReader 方法，但我不清楚这在我将 dbCommand 传递给 ExecuteReader 之后如何看待我的代码结构化方式。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-08T15:06:36.890

获取 SQL Server 存储过程架构的最佳方法是使用 sql：

```
EXEC sp_help MyStoredProcedure 
```

请参阅[http://msdn.microsoft.com/en-us/library/aa933429(SQL.80).aspx](http://msdn.microsoft.com/en-us/library/aa933429(SQL.80).aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2013-07-22T14:59:03.057

更好的答案如下： [2013 Microsoft Support](http://support.microsoft.com/kb/310107) 该文章展示了多种检索表信息的方法，这里是一种方法。

```
SqlConnection cn = new SqlConnection();
SqlCommand cmd = new SqlCommand();
DataTable schemaTable; 
SqlDataReader myReader; 

//Open a connection to the SQL Server Northwind database.
cn.ConnectionString = "Data Source=server;User ID=login;
                       Password=password;Initial Catalog=Northwind";
cn.Open();

//Retrieve records from the Employees table into a DataReader.
cmd.Connection = cn;
cmd.CommandText = "SELECT * FROM Employees";
myReader = cmd.ExecuteReader(CommandBehavior.KeyInfo);

//Retrieve column schema into a DataTable.
schemaTable = myReader.GetSchemaTable();

//For each field in the table...
foreach (DataRow myField in schemaTable.Rows){
    //For each property of the field...
    foreach (DataColumn myProperty in schemaTable.Columns) {
    //Display the field name and value.
    Console.WriteLine(myProperty.ColumnName + " = " + myField[myProperty].ToString());
    }
    Console.WriteLine();

    //Pause.
    Console.ReadLine();
}

//Always close the DataReader and connection.
myReader.Close();
cn.Close(); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-08T15:05:27.643

如果您使用的是 System.Data.Common.DbCommand，那么，我认为您可以致电

```
IDataReader drData = dbCommand.ExecuteReader(CommandBehavior.KeyInfo); 
```

**[编辑]**

你也可以使用

```
DataSet ds = new DataSet();
db.LoadDataSet(dbCommand, ds, "tableName"); 
```

或者

```
db.ExecuteDataSet 
```

这是一个发现有用的[链接](http://www.davidhayden.com/blog/dave/archive/2006/01/08/2686.aspx)

希望它能回答你的问题

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-09T12:31:55.430

令人尴尬的旧代码时间。这是我第一次学习 .NET 1.1 时使用的，而教我的人坚持使用 DataSets/Tables 而不是业务对象。它大约有 5 年的历史，从一个旧库中提取出来，但是给定一个表名，它会给你一个包含表模式的数据集。

```
public static DataSet GetTableSchema(string tableName)
{
    string query = string.Format("SELECT TOP 0 * FROM {0}", tableName);

    using (SqlConnection localSqlConn = new SqlConnection(GetConnectionString()))
    {
        DataSet ds = new DataSet();

        SqlCommand sqlCmd = new SqlCommand(query, localSqlConn);
        SqlDataAdapter sda = new SqlDataAdapter(sqlCmd);

        sda.FillSchema(ds, SchemaType.Source, tableName);
        sda.Fill(ds, tableName);

        sda.Dispose();

        return ds;
    }
} 
```

# javascript - 从 Google Street View 获取 lat/lng/zoom/yaw/pitch

> ID：730428
> 
> 赞同：1
> 
> 时间：2009-04-08T14:59:45.410
> 
> 标签：javascript, google-maps, google-street-view

我有一个基于提供的纬度/经度坐标、缩放、偏航和俯仰的谷歌地图和街景。每当任何详细信息从默认值更改或单击按钮时，我都需要调用 javascript 来更新每个这些值的隐藏字段。

因此，每当地图/街景被放大、平移、倾斜等时，它都会输出新的细节。

每当街景发生变化时，如何调用函数 getPOV()、yawchanged(yaw:Number)、pitchchanged(pitch:Number) 和 zoomchanged(zoom:Number)（类似于 Maps 的 moveend）

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-06T14:52:08.180

不确定压缩它的最佳方法，但这可以获取更改的详细信息：

```
GEvent.addListener(myPano, 'initialized', function(pano) {
  alert("newlng: " + pano.latlng.lng() + ", newlat: " + pano.latlng.lat());
});

GEvent.addListener(myPano, 'yawchanged', function(newyaw){
  alert("yawchanged: " + newyaw);
});

GEvent.addListener(myPano, 'pitchchanged', function(newpitch) {
  alert("pitchchanged: " + newpitch);
});

GEvent.addListener(myPano, 'zoomchanged', function(newzoom) {
  alert("zoomchanged: " + newzoom);
}); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-08T16:28:18.770

我通常发现“moveend”是在用户更改地图时用作获取地图状态的最佳事件。当我今天下午有更多时间时，我需要查找如何从地图上获取纬度/经度、缩放、偏航和俯仰角

```
// map is the instance of your GMap2
GEvent.addListener(map, 'moveend', function() {
  var center = map.getCenter();
  var zoom = map.getZoom();

  alert([center.lat(), center.lng(), zoom].join(','));
}); 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2011-10-02T00:10:25.413

对于谷歌地图 api v3...假设您已经加载了名为“全景”的街景地图

```
google.maps.event.addListener(panorama, "pov_changed", function() { 
   var panoInfo   = panorama.getPov();
   var thePitch   = panoInfo['pitch'];
   var isHeading  = panoInfo['heading'];
   var theZoom    = panoInfo['zoom'];
}); 
```

# video - 视频帧的不可靠缓存和预读

> ID：730434
> 
> 赞同：2
> 
> 时间：2009-04-08T15:02:26.403
> 
> 标签：video, caching

我正在开发一个同时显示多个视频的应用程序。视频以充满图像文件的目录的形式存储。对于每个帧编号，最多有 9 个必须从磁盘加载的图像。我想为图像实现缓存和预读。这将非常简单，但复杂之处在于文件系统（有时是网络 FS）远不足以显示每个图像。所以预读应该选择它将尝试加载哪些帧，并且只对这些图像发出 read() 请求。此外，在决定要加载哪些帧时，最好考虑哪些图像已经缓存。

我想出了一个可以做的贪婪算法，但我想知道这是否是一个已经研究过的问题，并且那里有更好/最优的算法。

我假设时间是相对于帧速率而不是秒来测量的，以使伪代码更容易。

```
load_time_per_image = how long it takes to load an image
images_per_frame = the number of images to display simultaneously
worst_time = images_per_frame * load_time_per_image

def decide_next_frame_to_load:
    for each frame from now to now + worst_time:
        loadable = (frame - now) / load_time_per_image
        if number_of_images_cached(frame) > images_per_frame - loadable:
            # this frame is the first one it's possible to load in time.
            return frame 
```

有人有建议吗？谢谢你的帮助！-托马斯

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-08T21:03:07.127

这是为了实时操作吗？

我见过的一些性能最差的视频编辑器会通过将每一帧存储到自己的图像文件中来“索引”每一帧。您是否坚持使用这种存储机制？如果源视频已经以视频格式存储（每个文件一个）并且每个视频都有一个索引（基本上是每个帧的文件偏移量），那么效率会大大提高。然后您可以使用操作系统的缓存机制来帮助提高您的性能。

您可能需要考虑的另一件事是，以 YUV 格式存储图像，尽管它可能对网络文件系统没有多大帮助。显示视频的应用程序可能运行得更快（部分原因是不需要 RGB 到 YUV 的转换，通常是因为您可以将绘制 YUV 图像的工作卸载到视频卡上），从而为文件系统留出更多时间工作。我在 X 显示器上绘图时这样做只是为了避免抖动。

至于缓存图像，我可能会使用一个单独的线程尽可能快地从磁盘读取图像，同时主线程组装并呈现图像。主线程可以每帧显示间隔执行一次循环，并且当缓冲/准备的图像数量达到某个阈值时，单独的线程可以阻塞。像 mplayer 这样的视频播放器使用这种策略。

# java - RMI接口设计原则

> ID：730440
> 
> 赞同：1
> 
> 时间：2009-04-08T15:03:56.633
> 
> 标签：java, interface, rmi

我目前正在开发一个 RMI 客户端，该客户端将与 RMI 服务器（由我工作的公司的不同部门开发）进行通信。另一个团队拥有该接口，但 IMO 它过于复杂，有许多不同的类型来回传递，以及不必要的 (IMO) 复杂的异常层次结构。

我已经多次表示担心，这种不必要的复杂性是我们以后进行集成时肯定会引发问题的根源，但我并没有得到太大的关注。IMO 它将导致不必要的大量代码共享，而且我们共享的每一个不同的类都是一组需要注意的额外版本控制要求。

有谁知道我可以用来支持我的论点的任何资源/论点。

或者，任何人都可以说服我我在叫错树吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-09T22:54:34.767

首先，我想说您所描述的问题不仅与 RMI 有关，而且与组件的任何类型的接口有关，包括纯 Java 接口，尽管在 RMI 的情况下，糟糕的设计可能会有额外的警告，例如性能。

不知道具体情况，只能看我的经历来猜测。这种不必要的接口复杂性通常与为组件定义的业务需求无效或不足有关。如果是这样的话，将来其他部门的人可能不得不经常修改界面，试图赶上新的功能，这通常是组件用户痛苦的原因。虽然随着时间的推移，界面的变化当然是自然的，但在这种情况下，它们可能会导致深度重新设计。

此外，过于复杂的接口通常意味着作者暴露了实现细节。不用说，这可能导致由于实现的演变、切换到不同的技术，甚至只是优化而导致不必要的接口更改。

最后但并非最不重要的一点是，为用户提供超出他们需要的更多内容是让他们使用甚至不打算使用甚至不存在的功能的直接方法。将来，用户可能会以意想不到的方式调用接口。它使组件的维护成为地狱。

总而言之，简单接口的关键参数是：组件的清晰业务定义、改进的实现灵活性、可维护性。请记住，所有这些利润对组件开发人员和用户都有好处。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-08T15:09:26.790

你没有找错树，而是在不同的部门，你可能很难得到你想要的改变。你不可能赢得每一场战斗:-(

但是为你“打好仗”的道具。如果你有时间的话，我建议你向他们展示一个干净的界面版本。但除此之外，你可能只需要放手。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-09T16:24:36.200

你将数据来完成你正在做的事情。我同意 unforgiven3 的观点——这是一场很好的战斗，而且你没有找错树——如果你现在提出更简洁的代码的建议，没有弹药，它可能会被置若罔闻，甚至更糟；可以开始一场“我的马比你的马大”的比赛——没有成效。

只是我的建议；

1.  开始记录错误或任何其他与低效界面相关或指向低效界面的问题

2.  开始记录代码审查，放入一个 wiki（公司认可的 wiki——现在不要惹麻烦），暂时记录一下——现在还不是通过判断的时候，你只是在收集数据。

当您从这 2 个中获得足够的数据时，请说明由于低效的设计决策而丢失或滥用的程序员生产力——当涉及成本时，很难争论。

希望能帮助到你。

# asp.net - MONO/ASP.NET Linux 主机？

> ID：730441
> 
> 赞同：14
> 
> 时间：2009-04-08T15:04:25.010
> 
> 标签：asp.net, mono, mod-mono

我想知道是否有人知道任何允许您部署 asp.net 应用程序以在单声道下运行的虚拟主机。

*编辑*：理想情况下，主机几乎不需要我的配置来部署 ASP.NET 应用程序。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-08T15:28:20.193

一个快速的谷歌搜索出现了这些：

1.  [无处不在的托管](http://www.ubiquityhosting.com//index.php?pid=shared-web-hosting-plans&cat=web-hosting)
2.  [格罗克蒂斯](http://www.grokthis.net/Hosting/advanced/)

我从未亲自使用过其中任何一个，因此请谨慎操作。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-08T19:36:44.153

我认为您最好的选择是使用 VPS。这样您就可以在闲暇时安装单声道。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-30T14:55:09.017

我使用 Linode，它们又好又便宜。我每月支付 19.99 美元，但它是一个 VPS，所以你必须设置一个操作系统并安装单声道。

我知道这违背了你很少或知道配置要做的观点，但我认为它会给你带来的自由是值得的。

德里克

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-08T15:17:14.807

在我的（短期）经验中，考虑到 Windows Server 许可证的批量购买能力，ASP.NET 托管和基于 Linux 的托管之间没有任何价格差异。因此，为您拥有的任何 ASP.net 应用程序购买 Windows 主机可能会更容易。

当然，除非您主要想玩 Mono，在这种情况下，您可以轻松获得专用的虚拟盒子并在其上安装 Mono。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-29T22:46:20.377

Mosso ( The [Rackspace Cloud)](http://www.mosso.com/index.jsp)提供的[云站点](http://www.mosso.com/cloud.jsp)包括对 ASP.NET 的支持。

配置极其简单，托管系统同时支持 Linux 和 Windows 应用程序。

Mosso[起价为 100 美元/月](http://www.mosso.com/pricing.jsp)。

我已经使用 Mosso 几个月了，我对这项服务相当满意。

虽然其他解决方案肯定会更好地服务于某些应用程序，但我认为 Mosso 值得评估。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2016-10-25T15:16:41.053

这个问题本来是很久以前问的，这几天用[https://www.asp.net/core选项很丰富](https://www.asp.net/core)

您可以轻松地将 asp.net 核心应用程序部署到[Azure](https://www.visualstudio.com/en-us/docs/release/examples/azure/aspnet-core10-azure-web-apps)或任何支持[Docker 容器](https://hub.docker.com/r/microsoft/aspnet/)的主机。

# sql - 返回全文搜索中找到的短语的周围文本，SQL 2005

> ID：730449
> 
> 赞同：3
> 
> 时间：2009-04-08T15:06:33.910
> 
> 标签：sql, search, contains, partial, full-text-search

我正在使用包含谓词在 SQL Server 索引文本字段中查找短语。有没有办法返回包含搜索短语的文本字段部分，或者它周围的某个区域？

例如，如果我在葛底斯堡演说中搜索“人人生而平等”（摘录如下），我想返回“致力于人人生而平等的命题”，例如围绕它的一些文本。

```
Four score and seven years ago our fathers brought forth on this continent, a new nation, conceived in Liberty, and dedicated to the proposition that *all men are created equal.*

Now we are engaged in a great civil war, testing whether that nation, or any nation so conceived and so dedicated, can long endure. We are met on a great battle-field of that war. We have come to dedicate a portion of that field, as a final resting place for those who here gave their lives that that nation might live. It is altogether fitting and proper that we should do this. 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-08T15:12:32.977

好吧，我不熟悉 SQL Server sintax，但您可以在字段中找到该事件并为其返回一个子字符串。**伪代码**：

```
SELECT
  SUBSTRING(field, MAX(0, STRPOS(field, 'all men are equal' - 20), STRLEN('all men are equal') + 40)
FROM
  yourtable
WHERE
  field CONTAINS 'all men are equal' 
```

有了这个，你只能找到那些包含短语的记录的子字符串的位置，并返回一个长 40 个字符的字符串，所以这样的东西应该可以工作。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2014-10-08T23:43:00.827

在尝试完成类似的事情时偶然发现了这一点。根据 Seb 的回应，我实施了以下措施来解决我们的问题：

```
SELECT '...' + SUBSTRING(@TextToParse, CHARINDEX(@TheKeyword, @TextToParse)-150, 350) + '...' 
```

这将返回前面有 150 个字符的关键字或短语。总共将返回 350 个字符。根据需要修改这些数字。省略号也包含在开头和结尾，因为此代码不适应避免单词中间的破损。

# cruisecontrol.net - Ndepend 报告未显示在 CruiseControl 仪表板中

> ID：730453
> 
> 赞同：1
> 
> 时间：2009-04-08T15:07:00.837
> 
> 标签：cruisecontrol.net, ndepend

我目前正在使用 CruiseControl.Net 将 ndepend 报告生成设置为持续集成构建过程的一部分，我已按照[ThoughtWorks 网站](http://confluence.public.thoughtworks.org/display/CCNET/Using+CruiseControl.NET+with+NDepend)中概述的说明进行操作。

ndepend 任务运行良好并且报告生成正确，但是当我进入仪表板并尝试调出 ndepend 报告时，什么也没有出现（它显示为空白）。Cruisecontrol 仪表板应用程序是否需要工作文件夹或工件文件夹下的特定文件中的 ndepend 报告？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-08T15:13:00.807

您的 xml 结果文件是否正确合并到构建中？

# asp.net - WebResource.axd 空白或未找到

> ID：730466
> 
> 赞同：10
> 
> 时间：2009-04-08T15:12:22.400
> 
> 标签：asp.net, dll, webresource.axd, .net-assembly

我正在尝试以 .dll 格式导出控件库，以供办公室中的其他开发人员使用。

我最初创建的解决方案如下所示：

**解决方案 1：**
- Mri.Controls（类库）
- Mri.FmTool（Web 应用程序）

Mri.FmTool 引用 Mri.Controls。

在 Mri.Controls 中，我有一些 javascript WebResources。Mri.FmTool 似乎可以很好地阅读 WebResources，当 Mri.FmTool 网络应用程序运行时，我所有的 javascript 网络资源都会出现。

所以，现在我试图创建一个简单的解决方案来使用 Mri.FmTool

**解决方案 2：**
- Mri.ConsumerTest（Web 应用程序）

我采用了最新的 Mri.Controls.dll 并将其添加为对 Mri.ConsumerTest 应用程序的引用。Mri.Controls 中的所有控件似乎都在 Mri.ConsumerTest 中工作。Intellisense 正在工作，它可以编译，没有问题。

但是，运行它时，大部分 WebResource.axd 文件都是空的，只是空白。一个 WebResource.axd 文件不是空白的，它只是说“找不到此资源”。

以下是“属性”窗口中 javascript 文件的属性：
构建操作：“嵌入式资源”
复制到输出目录：“始终复制”

我错过了什么步骤？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-08T19:06:46.940

您可能缺少 [assembly:WebResource("YourNameSpace.YourFile.js", "text/javascript")] 属性。WebResource.axd 需要该属性。您可以查看[此](http://support.microsoft.com/kb/910442)知识库文章以获取有关此问题的更多信息。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-08T16:22:16.460

资源是否设置为 DLL 的一部分？

打开解决方案 Mri.Controls 并查看您的 javascript 资源文件的属性。
我认为这就是问题所在。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-13T15:43:46.860

我注意到我的 WebResource CSS 文件正在正确加载，但在新解决方案中的 WebResource 中没有加载 Javascript。

所以，而不是使用*System.Web.UI。**ClientScriptManager***用于注册 WebResources，我切换到使用*System.Web.UI。**脚本管理器***。现在文件来自*ScriptManager.axd*（而不是*WebResource.axd*）。这似乎解决了问题。

**修复前的旧代码：**

```
public class ScriptManagerExtension : System.Web.UI.ScriptManager
{
    protected override void OnInit(EventArgs e)
    {
        base.OnInit(e);
        Page.ClientScript.RegisterClientScriptResource(this, typeof(ScriptManagerExtension), "Mri.Controls.Resources.Scripts.Libraries.jQuery.js");
    }
} 
```

上面的代码片段使用 System.Web.UI.ClientScriptManager

**修复后的新代码：**

```
public class ScriptManagerExtension : System.Web.UI.ScriptManager
{
    protected override void OnInit(EventArgs e)
    {
        base.OnInit(e);
        RegisterClientScriptResource(this, typeof(ScriptManagerExtension), "Mri.Controls.Resources.Scripts.Libraries.jQuery.js");
    }
} 
```

上面的代码片段使用 System.Web.UI.ScriptManager

据我了解，ClientScriptManager 是在 2.0 中引入的。我相信 ScriptManager 是管理脚本的新改进的 3.5 方式，具有更多功能。

/耸耸肩

# c# - 字典和 Lambda 很有趣

> ID：730472
> 
> 赞同：6
> 
> 时间：2009-04-08T15:15:05.297
> 
> 标签：c#, dictionary, lambda

为什么会编译：

```
public Dictionary<ValueLineType, 
                  Func<HtmlHelper, 
                       string, 
                       object, 
                       Type, 
                       string>> constructor = 
       new Dictionary<ValueLineType, 
                      Func<HtmlHelper, 
                           string, 
                           object, 
                           Type, 
                           string>>(); 
```

但不是在 Func（布尔值）中有一个额外参数的另一个：

```
public Dictionary<ValueLineType, 
                  Func<HtmlHelper, 
                       string, 
                       object, 
                       Type, 
                       bool,  
                       string>> constructor = 
       new Dictionary<ValueLineType, 
                      Func<HtmlHelper, 
                           string, 
                           object, 
                           Type, 
                           bool, 
                           string>>(); 
```

要么我失明了，要么我今天要学习其他东西：D

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-04-08T15:18:10.560

没有这样的事情`Func<T1,T2,T3,T4,T5,TResult>`。它只有 4 个参数（即 5 个*类型*参数，其中一个用于返回值）：

```
Func<T>
Func<T1, TResult>
Func<T1, T2, TResult>
Func<T1, T2, T3, TResult>
Func<T1, T2, T3, T4, TResult>
SpinalTap<T1, T2, T3, T4, T5, T6, T7, T8, T9, T10, T11, TResult> 
```

当然，您可以声明自己的：

```
public delegate TResult Func<T1, T2, T3, T4, T5, TResult>
    (T1 arg1, T2 arg2, T3 arg3, T4 arg4, T5 arg5); 
```

但是，那时我会非常仔细地考虑您是否可以将其中一些参数封装在一起。它们完全不相关吗？

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-04-08T15:30:17.100

仅供参考，.NET 库的下一个版本将包括四个以上参数的 Func 和 Action 泛型类型。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-08T15:17:48.707

名为 Func 的框架定义了不同的类，它们接受 1 到 5 个参数。您需要定义自己的需要 6 的类。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-08T15:21:19.837

[Func 只](http://msdn.microsoft.com/en-us/library/bb534303.aspx)需要 4 个参数和一个 TResult

# sql-server-2005 - 从表中的各个列中选择具有最大日期的列名

> ID：730475
> 
> 赞同：0
> 
> 时间：2009-04-08T15:15:34.420
> 
> 标签：sql-server-2005, oracle10g

我有一张有四列不同日期的表格。

我想检索具有最大日期的列名；任何人都可以帮助解决这个问题吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-08T15:43:00.890

如果在每行的基础上，我想要两个日期列中的最新日期，我会使用 case 语句：

```
select case when dt1 > d2 then dt1 else dt2 end as latest from table; 
```

如果我想要列名（我不知道为什么我想要那个）：

```
 select case when dt1 > d2 then 'dt1' else 'dt2' end as latest from table; 
```

如果我想处理更多列，我会嵌套更多 case 语句：

```
select case when dt1 > d2 then 
     (case when dt1 > dt3 then dt1 else dt3 end ) 
   else 
     (case when dt2 > dt3 then dt2 else dt3 end ) 
   end as latest 
from table; 
```

或者，更好的是，我可以这样做：

```
 select case 
     when dt1 > d2 and dt1 > dt3 then dt1
     when dt2 > d1 and dt2 > dt3 then dt2
     else dt3 end as latest
 from table ; 
```

或者（也许更好）我可能会写一个函数。因为 max 是一个内置函数，所以我会写一个叫做 maxOf 的东西。这是 MySQL 的函数语法，您的数据库可能使用不同的语法，并且可能使用 OUT 变量而不是返回值：

```
create function maxOf( date lhs, date rhs )
   RETURNS date
   LANGUAGE SQL
   DETERMINISTIC
   CONTAINS SQL
   COMMENT 'return the later of two dates'
   return case when lhs > rhs then lhs else rhs end;

select maxOf( dt1, maxOf( dt2, dt3) as latest from table; 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-08T15:39:12.990

我对 oracle 不是很熟悉，所以我避免使用 SQL Server 特定的方法（除了用于示例目的的表变量），但解决问题的一种方法是创建一个子查询，该子查询联合四列并映射列名，另一个检索 4 个值的最大值的子查询，以及一个返回连接结果的外部查询。下面的示例将返回表的最大值，但这可以通过修改聚合子查询以按行标识符分组，然后也加入该列来调整为行的最大值

```
Declare @x table(id int
, date1 datetime
, date2 datetime
, date3 datetime
, date4  datetime)

insert into @x  
values (1, '01/01/2000'
, '01/01/2001'
, '01/01/2002', '01/01/2004')

insert into @x  
values (2, '01/01/2010'
, '01/01/2020'
, '01/01/2030', '01/01/2040')

Select SomeDate, ColumnName
from
(
Select date1 as somedate
, 'Date 1' as ColumnName from @x
union  
Select date2 as somedate
, 'Date 2' as ColumnName from @x
union
Select date3 as somedate
, 'Date 3' as ColumnName  from @x
union 
Select date4 as somedate
, 'Date 4' as ColumnName from @x 
) t1
inner join
(
    Select max(tx.somedate) MaxDate from 
    (
        Select date1 as somedate from @x
        union  
        Select date2 as somedate from @x
        union
        Select date3 as somedate  from @x
        union 
        Select date4 as somedate from @x
    ) as tx 
) t2
on t1.SomeDate = t2.MaxDate 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-10-15T15:07:05.890

Oracle 有 GREATEST 和 LEAST

```
SELECT GREATEST (TO_DATE ('01-01-2000', 'DD-MM-YYYY'), TO_DATE ('01-01-2010', 'DD-MM-YYYY')) FROM DUAL;

SELECT LEAST (TO_DATE ('01-01-2000', 'DD-MM-YYYY'), TO_DATE ('01-01-2010', 'DD-MM-YYYY')) FROM DUAL; 
```

# ios - iPhone 应用程序的条形符号

> ID：730478
> 
> 赞同：9
> 
> 时间：2009-04-08T15:16:34.590
> 
> 标签：ios, objective-c, xcode, symbols, strip

Xcode 中为 iphone 应用程序去除符号的设置是什么？

我在 Xcode 中使用这些设置，但仍然使用二进制文件编辑器在可执行文件中看到类名及其方法。

部署：

1）部署后处理（选中）

2）在复制期间剥离调试符号（选中）

3) Strip Linked Product(勾选)

4）使用单独的条带（选中）

链接：

5）死代码剥离（选中）

GCC 4.0 - 代码生成

6）生成调试符号（未选中）

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-08T18:31:57.990

Objective-C 类和方法信息不能被剥离——它是执行所必需的。如果你愿意，你能做的最好的就是想出某种混淆。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2013-08-14T08:29:17.260

我做的。

我只检查了以下三个设置，其他设置无关紧要。

1）部署后处理（选中）

3）剥离链接产品（选中）

4）使用单独的条带（选中）

![在此处输入图像描述](https://i.stack.imgur.com/55rJs.png)

当然，您需要在模式编辑器中检查“分发”版本。 ![在此处输入图像描述](https://i.stack.imgur.com/1tKu1.png)

然后清洁！！！并建造。

我还确认 Xcode 调用了“strip”命令：Show log navigator, select Build .... release，在底部，我找到了进度描述：

```
/Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/strip /Users/xxx/Library/Developer/Xcode/DerivedData/aaaaa-dytaamkvztdwfreoqteyeijwqdcu/Build/Products/Distribution-iphoneos/aaaaa.app/aaaaa 
```

![在此处输入图像描述](https://i.stack.imgur.com/ZxbxN.png)

最后，我通过“nm”命令检查了最终产品文件的结果，

`nm -a /Users/xxx/Library/Developer/Xcode/DerivedData/aaaaa-dytaamkvztdwfreoqteyeijwqdcu/Build/Products/Distribution-iphoneos/aaaaa.app/aaaaa`

当前应用程序的所有功能名称都被真正剥离。比如下面的函数名：

 ~~000b0a00 t _pj_ioqueue_create

00092ae4 t __destroy_helper_block_200

00092af8 t ___68-[MyClass myMethod:param2]_block_invoke_21782

 ~~注意：objective-C 方法和属性名称字符串仍然生成到应用程序文件中，但这不是 OS 加载器的符号名称，它们只是 Objective-C 类的元数据。

# flash - Control-F5 浏览器刷新（Flash 对象不刷新）

> ID：730487
> 
> 赞同：1
> 
> 时间：2009-04-08T15:18:28.970
> 
> 标签：flash, internet-explorer, browser, caching, refresh

在幕后，我想知道浏览器的 Control-F5 有什么作用。

对我来说，它清除缓存并刷新图像/文本/控件/等。我明白了。

**问题：**

Flash 对象呢？我一直在尝试使用 Flash 控件刷新页面，但它似乎没有刷新到最新。只有在我手动清除缓存后才会刷新。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-08T16:55:49.360

好吧，经过一番调查，似乎在 IE7 中使用 Control-F5 清除缓存不会删除/清除 flash 对象从中读取的 xml 文件。

它似乎检查文件是否存在，如果存在，它将使用该文件，而不考虑是否有较新的版本。

解决这个问题的一种方法是让浏览器将每个请求视为请求一个新文件，因此我必须生成一个随机数并将其附加为：

在动作脚本中：

```
var xmlPath = "/settings.xml?rand=" + getTimer(); 
```

此外，如果 Flash 组件发生更改，您也可以通过将随机数附加到正在加载的 Flash SWF 文件来执行相同操作。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-07-28T15:19:42.687

```
<body onkeydown=" 
document.onkeydown = function(e)

{

    if(e) document.onkeypress = function(){return true;}

    var evt = e?e:event;
    if(evt.keyCode==116) 
    {
         //your code

    }
} "> 
```

你必须把代码放在body事件中，当你按下任意键时，这个函数处理每个键，在F5的情况下代码是116

* * *

## 回答 #3

> 赞同：-2
> 
> 时间：2009-04-08T15:24:53.133

好像您正在使用 Firefox 尝试 control-shift-R ;)

# sql - 对您的 SQL 进行单元测试是否让 TDD 走得太远了？

> ID：730488
> 
> 赞同：25
> 
> 时间：2009-04-08T15:18:30.187
> 
> 标签：sql, unit-testing, tdd

[www.sqlservercentral.com](http://www.sqlservercentral.com/articles/System+Development+Life+Cycle/66133/)上有一篇关于对 SQL 进行单元测试的文章。

我的 TDD 专家说很好，我们可以测试数据库的东西。

我的系统架构师说，我们在测试什么逻辑？数据库中不应该有任何逻辑，您应该在数据库中做的唯一事情就是选择、更新或插入。

因此，如果您觉得需要对您的 SQL 进行单元测试，您是真的彻底、过于务实，还是设计有异味？

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2009-04-08T16:54:17.257

在大多数实际项目中，数据库在项目里程碑之间存在一定程度的变化。创建、删除或更改表和列。查找表已更新。您可以针对数据库的多个实例进行测试，因此最好对数据库中的元数据和数据的状态进行一些验证，作为回归测试的一部分。

在几种情况下，我建议测试数据库：

*   表和视图：验证您希望存在的表和视图。验证这些表和视图是否包含您期望的列。您还可以验证您在此里程碑中删除的表、视图或列实际上不存在。

*   约束：尝试执行应该被拒绝的数据更改。约束应防止这些更改。如果您发现约束不起作用的情况，您可以避免以后的错误。

*   触发器：与约束相同，触发器也可用于级联效果，或转换值等。测试这些逻辑路径。

*   存储过程：当逻辑更容易在应用层开发、调试和维护时，我支持不要将过多的逻辑放入数据库中。但是在某些情况下，有令人信服的理由使用存储过程。您经常看到通过将复杂的逻辑放入数据库来解决性能瓶颈。所以存储过程不会完全消失，测试它们是个好主意。

*   引导数据：查找表是即使在“空”数据库中也需要存在的数据示例。可以有其他例子。测试数据库是否包含所需的数据。

*   查询：您的应用程序代码带有 SQL 查询。测试它们的正确功能和性能。尤其是性能——因为同样的查询可以在一天内表现良好，但在第二天成为瓶颈，随着数据量的变化，索引变得不平衡等等。

*   ORM 类：与触发器一样，应用程序中的 ORM 类可以包含验证、转换或监视数据库操作的逻辑。这些应该被测试。

这些测试可能不准确地称为“单元测试”。单元测试是一种特定类型的测试，其中每个测试都独立于其他测试，并且您尝试单独测试小代码单元。我想说以上述方式测试数据库是*功能测试*的一个例子。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-04-08T15:23:23.263

您的 SQL 包含逻辑。例如，布尔条件检查“WHERE”子句。你能想到 SQL 可能出错的任何方式吗？如果是这样，测试 SQL 以确保不存在这些错误是否有意义？

（例如，像我这样的一些愚蠢的程序员可能会在我上面的评论中不小心输入“WHILE”而不是“WHERE”！......就像我一样。但我后来更正了它。那么我的stackoverflow测试在哪里？！？； -)

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2009-04-08T15:22:15.573

我同意系统架构师的观点，如今太多的业务逻辑正在进入数据库。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-04-08T16:18:17.453

区分**单元测试**/规范和**集成测试**/规范。

如果您的课程两者都有，那么您就违反了一个合理的原则：[关注点分离](http://www.google.co.uk/search?hl=en&lr=&ei=083cScyQL9jLjAeB6JihDg&sa=X&oi=spell&resnum=0&ct=result&cd=1&q=separation+of+concerns+site%3Ahttp%3A//stackoverflow.com/&spell=1)。

您的测试应该在单元测试之间明确定义，以测试持久无知的 POCO / POJO 单元，例如实体、服务和集成测试。用于测试您的应用程序撞击金属的位置。

集成测试应该测试持久性，例如持久性机制 (RBDMS)、Active Directory、Exchange、文件系统和电子邮件等的存储库和工作单元实现。

如果您的用例需要对使用触发器的集成点进行彻底测试，那么请显式测试行为而不是触发器。将来您可能会选择不使用触发器，而是使用 ORM 或 AoP 拦截器。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-04-08T15:25:54.770

这个问题引起了激烈的争论。如果您问 DBA，他们会认为让您的所有应用程序都使用预定义的存储过程是世界上最好的事情。尽管那些日子即将结束，随着 Hibernate 和 LINQ 越来越受欢迎，您确实可以将数据库用作信息存储库，并让您的数据访问层处理所有请求。我认为 LINQ 可以在 MS SQL 中为您做所有事情，除了全文搜索。至于 SPROC 和 LINQ 之间的性能差异，可以忽略不计。我的投票是数据库中没有代码，所有代码都在 yoru 数据访问层，并对其进行测试。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-04-08T15:29:40.143

这取决于您的数据库架构。如果你只有表和视图，我认为单元测试不是必需的，因为每个（或大多数）错误都会在应用程序的单元测试中被捕获。

但是如果你有复杂的函数、存储过程、触发器等......那么你有很多地方可能是错误的，并且应用程序单元测试没有涵盖它们。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-07-08T15:32:22.683

系统架构师是正确的。不应该将业务逻辑插入到您的数据库中，因此您实际上并没有对任何东西进行单元测试。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-04-08T15:23:08.363

我认为这有点矫枉过正。我想你可以这样做并将测试放在一个特殊的类别中，这样它们就不会在每个构建上运行，也许只是在签入并在服务器上运行时。通常对于所有单元测试，您都不需要外部依赖项。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-04-08T15:30:30.530

我不直接在我的数据库上进行 TDD，但是有很多机会可以将“逻辑”放入数据库中。约束、默认值（是的，我也知道这是一个约束）、触发器等。这些通常是实现某些业务逻辑并确保数据库一致性的最佳方式。大多数时候，我可以通过一些手动测试来说服自己相信正确性并将其保留，但我可以看到有人可能想在哪里进行 TDD。

**编辑**：

例如，我将在插入时使用默认值，在更新时使用触发器来设置插入/更新时的“上次更新时间”字段。在 LINQ 中，我会将列设置为自动生成的值并使其成为只读。对我来说，这比添加 PropertyChanged 事件处理程序更简单，以确保每当实体上的字段发生更改时，最后更新时间也会更改。我测试它吗？当然，但是手动和事后即使我在大多数事情上都非常喜欢 TDD。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-04-08T16:04:13.430

我不知道为什么当我们点击 db 层时，所有好的做法都应该出现在窗口中。如果这一层有逻辑，则它具有双重重要性。在[Fitnesse](http://en.wikipedia.org/wiki/FitNesse)之上构建了一个很棒的工具，称为[dbfit](http://benilovj.github.com/dbfit)，它似乎消除了对 dblayer 进行单元测试的所有痛苦。如果你有兴趣，你应该看看。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-04-08T15:52:20.103

只要 WHERE 子句不为空，就应该对其进行测试。

这里我们使用 NHibernate Criteria API 来查询数据库。尽管如此，我们还是进行了简单的单元测试来保护数据访问层。考虑一下：

```
public IList<Book> GetBorrowedBooks(User user); 
```

一开始它可能看起来很傻。但是对于这样一个简单的情况，我们至少要处理 3 个模型对象：Book、User、Borrow，也许还有 Return。任何修改 3 个（或更多）类中的任何一个的尝试都可能破坏代码。

费用是多少？我猜，在这个例子中编写测试只需要不到 20 分钟。借助 NUnit 中的 Category，可以将数据访问单元测试配置为在夜间运行，而其他测试在每次提交时运行。缓慢的数据访问单元测试不会造成伤害，它们是救命稻草。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2014-04-11T15:55:10.340

[DbFit](http://dbfit.github.io/dbfit/index.html)是一个很好的数据库单元测试工具。我认为将 TDD 与 SQL 结合使用是明智的，因为毕竟它是一种具有条件分支、聚合函数等的声明性语言。如果没有适当的测试，你怎么能确定你得到了预期的结果？

# apache-flex - 如何在正在运行的 flex 应用程序中获取服务器端点？

> ID：730490
> 
> 赞同：5
> 
> 时间：2009-04-08T15:20:05.003
> 
> 标签：apache-flex, endpoints

我需要一种在运行时从我的 flex 应用程序中获取活动服务器地址、端口和上下文的方法。由于我们在构建过程中使用了 ant，服务器连接信息在我们的构建属性文件中动态指定，并且在 services-config 中使用了 {server.name}、{server.port} 和 {context.root} 占位符.xml 文件而不是实际值。

我们有一些其他 Java servlet 与我们的 blazeDS 服务器在同一台机器上运行，我想要某种方式以编程方式确定服务器端点信息，因此我不需要将 servlet URL 硬编码到 XML 文件中（这就是我们目前正在做）。

我发现至少可以通过将以下内容添加到我们的主应用程序 MXML 文件中来获取上下文根：

```
<mx:Application ... >
  <mx:HTTPService id="contextRoot" rootURL="@ContextRoot()"/>
</mx:Application> 
```

但是，我仍然需要某种方式来获取服务器地址和端口，如果我通过给出 -context-root= [http://myserver.com:8080/mycontext](http://myserver.com:8080/mycontext)来指定整个地址，那么 flex 应用程序会尝试连接到[http ://localhost/http://myserver.com:8080/mycontext/messagebroker/amf](http://localhost/http://myserver.com:8080/mycontext/messagebroker/amf)，这当然是完全错误的。指定上下文根和服务器 URL 的正确方法是什么，如何从我们的应用程序中检索它们？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-15T12:58:10.687

We use an Application subclass that offers the following methods :

```
 /**
  * The URI of the AMF channel endpoint. <br/>
  * Default to #rootURI + #channelEndPointContext + #this.channelEndPointPathInfo
  */
 public function get channelEndPointURI() : String
 {
    return this.rootServerURI + ( this.channelEndPointContext ? this.channelEndPointContext : "" ) + this.channelEndPointPathInfo
 }

 /**
  * The root URI (that is scheme + hierarchical part) of the server the application
  * will connect to. <br/>
  * If the application is executing locally, this is the #localServerRootURI. <br/>
  * Else it is determined from the application #url. <br/>
  */ 
 public function get rootServerURI() : String
 {
      var result : String = ""
      if ( this.url && ( this.url.indexOf("file:/") == -1 ) )
      {
           var uri : URI = new URI( this.url )
           result = uri.scheme + "://" + uri.authority + ":" + uri.port
      }
      else
      {
           result = this.localServerRootURI
      }

      return result 
 } 
```

This generic application supports the `channelEndPointContext`, `channelEndPointPathInfo` and `localServerRootURI` properties (typically "mycontext" and "/messagebroker/amf/" in your example, the local server root being used when the application is executed via Flex Builder, in such cases it has a `file://` URL).
The determination of the complete endpoint URI is then performed using either the `localServerRootURI` property or using the application `url` as our services are exposed by the very same server that serves the application's SWF (which is, as far as I understand your case too).

So, in your example, one would write :

```
 <SuperApplication ...> <!-- SuperApplication is the enhanced Application subclass -->
    <mx:HTTPService id="myHTTPService" url="{this.channelEndPointURI}"/>
 </SuperApplication> 
```

Starting from here, one can also automatically determine the `channelEndPointContext` from the application URL instead of hardcoding it as shown in this example.

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-17T04:27:04.000

I've used FlashVars to pass urls in before with success. In your template html:

```
var rootURL = location.href.substring(0,location.href.indexOf("flexBin"));    
...

AC_FL_RunContent(
    "src", "${swf}",
    "FlashVars", "rootURL="+rootURL,
    "width", "${width}",
... 
```

And then in flex:

```
service.rootURL = Application.application.parameters.rootURL; 
```

The nice thing is you can really pass in whatever you like from the server this way.

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2011-09-20T23:24:11.353

```
var url:String = (FlexGlobals.topLevelApplication as Application).url 
            //var fullURL:String = mx.utils.URLUtil.getFullURL(url, url);

            var serverName:String = mx.utils.URLUtil.getServerNameWithPort(url);
            listContents.url = mx.utils.URLUtil.getProtocol(url)+"://"+serverName+"/custom_message.html";
            //isSecure = mx.utils.URLUtil.isHttpsURL(url);   

            //pageURL = pageURL.substring(0, pageURL.indexOf("/"));
            listContents.send(); 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-08T15:37:09.533

为什么不通过 ExternalInterface 调用包装器中的 javascript 函数来返回 location.hostname 的值？

```
<mx:Script>
    <![CDATA[
        private var hostname:String;

        private function getHostName():void
        {
            hostname = ExternalInterface.call(getHostName);
        }
    ]]>
</mx:Script> 
```

包装器中的javascript：

```
<script type="text/javascript">
    function getHostName()
    {
        return location.hostname;
    }
</script> 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-13T01:43:58.407

您可以使用 BrowserManager 获取有关 url 的信息。

```
var bm:IBrowserManager = BrowserManager.getInstance();
bm.init(Application.application.url);
var url:String = bm.base; 
```

see also [http://livedocs.adobe.com/flex/3/html/deep_linking_7.html#251252](http://livedocs.adobe.com/flex/3/html/deep_linking_7.html#251252)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-11-01T11:14:37.867

No need to do all these hard work. Just use URLUtil provided by Flex framework itself ;)

# actionscript-3 - 在动作脚本 3.0 中调用 Web 服务内部的方法

> ID：730496
> 
> 赞同：0
> 
> 时间：2009-04-08T15:21:21.537
> 
> 标签：actionscript-3, web-services, cs3

我需要在 Web 服务中调用一个方法并将其参数从动作脚本 3.0 传递给它，谁能帮我？我在整个互联网上搜索并找到了使用 flex 的解决方案，但我没有使用 flex 我正在使用 action script 3.0

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-08T15:29:05.433

我使用这样的东西：

```
var request:URLRequest = new URLRequest();
request.url = 'http://example.org';

// If you're POSTing data:
request.method = URLRequestMethod.POST;
request.data = new URLVariables({ /* Your object */ });

var loader:URLLoader = new URLLoader();
loader.dataFormat = URLLoaderDataFormat.VARIABLES; // If you're using POST
try {
    loader.load(request);
} catch(error:Error) {
    // Handle error
}

trace(loader.data); // Result 
```

文档：

*   [http://livedocs.adobe.com/flex/2/langref/flash/net/URLRequest.html](http://livedocs.adobe.com/flex/2/langref/flash/net/URLRequest.html)
*   [http://livedocs.adobe.com/flex/2/langref/flash/net/URLLoader.html](http://livedocs.adobe.com/flex/2/langref/flash/net/URLLoader.html)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-08T15:44:22.387

这是我在我的一个 Flex 项目中使用的代码...

```
import mx.rpc.soap.WebService;

public var service:WebService = new WebService();

override protected function initializationComplete():void
{
    service.wsdl = "http://localhost:1133/YourService.asmx?wsdl"

    // GetPayload is the method name you're calling on your web service
    service.GetPayload.resultFormat = "e4x";
    service.GetPayload.addEventListener("result", yourResultHandler);
    service.GetPayload.addEventListener("fault", yourFaultHandler);

    // Method to call once the WSDL is loaded
    service.addventListener(LoadEvent.LOAD, loadHandler);

    service.loadWSDL();
} 
```

然后这是加载 WSDL 后发生的情况

```
protected function loadHandler(event:LoadEvent):void
{
    // send() takes the service parameters
    service.GetPayload.send("Product");
} 
```

您只需要编写两个方法来处理您的服务返回的 XML（数据以 e4x 格式返回：

```
protected function yourResultHandler(event:ResultEvent):void
{
    _messageXml = XML(event.result);
}

proteted function yourFaultHandler(event:FaultEvent):void
{
    Alert.show(event.toString());
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-01-04T11:04:57.077

您可以通过一种棘手的方法使用 Web 服务，首先您通过在 flex 环境中编译来制作 swf，其中包括 webservice 的导入语句，如 import mx.rpc.webservices。现在编译它你会得到一个swf。现在您转到 as3.0 并在舞台上制作一个空的影片剪辑，并在链接属性中将其导入以进行运行时共享并将 a.swf(ex)on 文本框放在共享中。现在您可以在动作脚本文件中导入语句导入mx.rpc.webservices.and 使用与 flex 相同的方法。你肯定可以访问网络服务....

# c++ - STL 映射与向量的迭代器访问性能？

> ID：730498
> 
> 赞同：15
> 
> 时间：2009-04-08T15:22:25.900
> 
> 标签：c++, performance, stl, map, iterator

使用迭代器循环 STL 映射与向量之间的性能差异是什么？我想使用 map 键进行插入、删除和一些访问，但我还需要定期访问map 中的*每个*元素。

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2009-04-08T15:30:00.487

使用 map 和 vector，遍历整个集合是 O(N)。但是（如列表与向量）向量连续存储元素，因此访问下一个元素要便宜得多，因为它将最佳地使用缓存，而地图不会。

但是由于您*需要*基于键进行查找，因此没有其他选择。您可以使用按第一个元素排序的对向量，但如果集合需要是可变的，这将非常慢。只需使用地图。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-04-08T15:28:09.007

遍历地图的每个元素需要 O(n) 时间。[维基百科](http://en.wikipedia.org/wiki/Map_(C%2B%2B_container))

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-04-08T15:32:02.650

[这个链接](http://devmentor.org/references/stl/stl.php)有一个很好的关于所有 STL 容器上的各种操作的性能表。

一般来说，如果您需要根据键进行大量插入、删除或搜索，那么映射是可行的方法。

如果您只需要设置一次容器，然后像数组一样访问它，那么请使用向量。

编辑：STL 容器操作的性能表：

![在此处输入图像描述](https://i.stack.imgur.com/zntFK.png)

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2015-06-25T19:09:43.197

遍历映射可能是线性的，但实际上，从 C++ 中的实现来看，它的效率并不高。所以我的建议是使用一个向量并使用另一个地图在线性时间内定位向量中的项目。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-04-08T15:27:58.213

如果您需要通过钥匙快速访问，请使用地图。否则一直使用向量，除非探查器会发现一些性能问题。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-04-08T15:29:19.770

浏览树并不昂贵（像遵循链表一样的大模式），您不会从缓存中受益于向量，但通常这是您在迭代时所做的事情，而不是迭代本身。

你能告诉我们更多关于当你遍历整个地图时你期望做的事情吗？

# c# - 需要在 SortedCollection 中允许重复（C#，2.0）

> ID：730505
> 
> 赞同：7
> 
> 时间：2009-04-08T15:24:36.863
> 
> 标签：c#, collections, duplicates, icollection

我有一个正在处理的项目，需要更改“BaseSortedCollection”类以允许重复。该类当前实现 IEnumerable、IDisposable、ICollection 和 ISerializable。'BaseSortedCollection' 存储具有 ItemID (Int64) 的项目，该项目在访问集合时用作键。我需要同时在集合中存在两个相同的项目（相同的 ItemID）并且能够被检索。

我们使用的是 2.0 框架。

有什么建议么？

提前致谢！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-08T15:55:38.707

BaseSortedCollection 中的每个项目都可以是一个 List(T)，因此如果您有两个项目具有相同的键，那么您将拥有一个 List(T)，其中包含与该键对应的条目的两个项目。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-12-09T12:31:16.553

我假设您正在扩展一种不允许重复键的字典。

这个实现怎么样。我假设您的项目实现了 IComparable。

```
class BaseSortedCollection<T> : Collection<T>, ICollection<T>, IEnumerable<T>,
    System.Collections.ICollection, System.Collections.IEnumerable
    where T : IComparable<T>
{
    /// <summary>
    ///     Adds an item to the Collection<T> at the correct position.
    /// </summary>
    /// <param name="item">The object to add to </param>
    public new void Add(T item)
    {
        int pos = GetInsertPositio(item);
        base.InsertItem(pos, item);
    }

    /// <summary>
    /// Convinience function to add variable number of items in one Functioncall
    /// </summary>
    /// <param name="itemsToBeAdded">The items to be added.</param>
    /// <returns>this to allow fluent interface</returns>
    public AutoSortCollection<T> AddItems(params T[] itemsToBeAdded)
    {
        foreach (var item in itemsToBeAdded)
            Add(item);
        return this;
    }

    /// <summary>
    /// Get position where item should be inserted.
    /// </summary>
    /// <param name="item"></param>
    /// <returns>Get position where item should be inserted.</returns>
    private int GetInsertPositio(T item)
    {
        if (item == null)
            throw new ArgumentNullException();

        for (int pos = this.Count - 1; pos >= 0; pos--)
        {
            if (item.CompareTo(this.Items[pos]) > 0)
                return pos + 1;
        }

        return 0;
    }
} 
```

这应该工作（使用MsTest）

```
 /// <summary>
    ///A test sorting for SCCPackageEx Constructor
    ///</summary>
    [TestMethod()]
    public void SortingTest()
    {
        BaseSortedCollection<int> collection = new BaseSortedCollection<int>().AddItems(1,5,3,2,4,0);
        Assert.AreEqual(6, collection.Count, "collection.Count");

        for(int i=0; i <=5; i++)
           Assert.AreEqual(i, collection[i], "collection[" + i + "]");
    } 
```

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-04-08T15:34:11.770

我猜你将不得不扩展一个常规的 ArrayList，如果你需要自动排序，则覆盖 Add-method 来调用 Sort。但是，我似乎无法理解两个项目具有相同（应该是唯一的）标识号的想法？！

编辑，或者 NameValueCollection（在 System.Collections.Specialized 中）更合适？扩展它并添加您自己的排序方法...

# asp.net - Nant 和 ASP/.NET 1.1：他们相处得好吗？

> ID：730509
> 
> 赞同：0
> 
> 时间：2009-04-08T15:25:08.563
> 
> 标签：asp.net, asp-classic, nant

我正在开发一个混合应用程序（ASP、ASP.NET），并且我使用 Nant 进行部署。与我交谈的人说他听说 Nant 不会为我们工作，因为我们有这样一个混合包（.NET 1.1 和 .NET 2.0 应用程序、ASP、ASP.NET）。我无法想象会是这样，只是似乎不太可能。

你的意见？您是否使用 Nant 构建过这样的应用程序？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-08T16:32:48.697

NAnt 的复制任务允许您将文件从一个位置复制到另一个位置（这应该可以完成 ASP 部署所需的大部分工作？）。

我已经使用它来推出 ASP 站点（例如，从源代码中获取最新信息，复制到放置位置）作为构建 ASP.NET 1.1 的更大构建周期的一部分。当然，那是几年前的 v0.85，但这是同时部署混合包的生产示例。

如果您*确实需要做一些不属于内置任务的事情，或者您在*[社区](http://nantcontrib.sourceforge.net/)中找不到，那么没有什么能阻止您编写自己的任务。如果您可以在 .NET 框架中执行此操作，您可能可以将其作为 NAnt 构建的一部分来执行。

所以，简短的回答：是的，你可以，但如果你有比基本构建更复杂的东西，你可能需要编写一个自定义任务。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-08T15:35:52.467

任何时候，只要您在一个单一的技术中使用多种技术，部署就会变得“有趣”。在自己研究过一个之后，我们遇到了问题，但已经解决了。不幸的是，我自己从未有过与 nAnt 合作的乐趣，但我的一位前同事对此赞不绝口。

他说他们有一些问题，但他们已经解决了。我会将他发送给这个问题，以便他可以发布答案，但这绝对是可能的。

# php - 常见的电子邮件客户端用户代理字符串

> ID：730517
> 
> 赞同：4
> 
> 时间：2009-04-08T15:26:23.693
> 
> 标签：php, email, agent

是否有电子邮件客户端在打开 HTML 电子邮件时使用的常见用户代理字符串列表？

我想在电子邮件活动中使用 PHP 进行像素网络错误检测。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-08T15:45:33.147

我想你会发现没有简单的方法来区分打开 html 电子邮件的电子邮件应用程序。所有桌面代理都使用已经内置在 Web 浏览器中的特定渲染引擎（Thunderbird 使用 Gecko，早期版本的 Outlook 使用 Internet Explorer，Mail.App 使用 WebKit 等），这使得它们与浏览器本身几乎没有区别。

无论如何，从编程的角度来看，能够分辨出差异甚至没有用，因为即使您可以分辨出正在使用哪个客户端，也无法通过 PHP 脚本利用这一点。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-08T20:06:45.827

根据**UserAgentString.com**，Thunderbird 使用[这些字符串。](http://www.useragentstring.com/pages/Thunderbird/) 可悲的是，我无法找到很多关于其他电子邮件客户端的信息。我最好的建议是按照你的计划去做，但把它发给特定的朋友，这样你就可以收集一些基线知识。

但是，正如**斯昆利夫**所说，大多数界面在您选择之前不会显示图像。因此，最好的强制方法是将您的电子邮件作为一个大图像！;)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-08T19:32:21.370

您只需要将图像添加到 HTML 电子邮件中。

```
<img src="www.yourserver.com/track?id=someHASH..."/> 
```

然后在您的服务器上，当您收到该点击时，将其与您发送给谁、何时等联系起来。

请记住，大多数电子邮件客户端现在阻止外部图像以阻止垃圾邮件发送者使用这种技术来钓鱼活动电子邮件帐户（因为大多数服务器/客户端也阻止回执）。

因此，请尊重许多用户永远不会加载图像......但如果您的网站“足够引人注目/值得信赖”，那么用户可能会加载图像。

还要意识到，如果用户将电子邮件转发给其他人，或者稍后重新打开电子邮件，这*可能会*导致网络错误“call home”再次触发（取决于缓存等）

# java - 在 Java 中真正强制文件同步/刷新

> ID：730521
> 
> 赞同：39
> 
> 时间：2009-04-08T15:27:57.510
> 
> 标签：java, storage

**Java如何真正**将写入文件的数据与块设备刷新/同步。

我用 NIO 尝试了这段代码：

```
FileOutputStream s = new FileOutputStream(filename)
Channel c = s.getChannel()
while(xyz)
    c.write(buffer)
c.force(true)
s.getFD().sync()
c.close() 
```

我认为 c.force(true) 与 s.getFD().sync() 应该就足够了，因为[力](http://java.sun.com/j2se/1.5.0/docs/api/java/nio/channels/FileChannel.html#force(boolean))状态的文档

> 强制将此通道文件的任何更新写入包含它的存储设备。如果此通道的文件驻留在本地存储设备上，则当此方法返回时，可以保证自创建此通道或自上次调用此方法以来对文件所做的所有更改都已写入该设备。这对于确保在系统崩溃时不会丢失关键信息很有用。

[要同步](http://java.sun.com/j2se/1.4.2/docs/api/java/io/FileDescriptor.html#sync())的文档指出：

> 强制所有系统缓冲区与底层设备同步。此方法在此 FileDescriptor 的所有修改数据和属性都已写入相关设备后返回。特别是，如果此 FileDescriptor 指的是物理存储介质，例如文件系统中的文件，则在与此 FileDesecriptor 关联的所有内存中修改的缓冲区副本都已写入物理介质之前，同步将不会返回。同步旨在供需要物理存储（例如文件）处于已知状态的代码使用。

这两个调用应该足够了。是吗？我猜他们不是。

背景：我使用 C/Java 做了一个小的性能比较（2 GB，顺序写入），Java 版本的速度是 C 版本的两倍，并且可能比硬件（单个 HD 上 120 MB/s）快。我还尝试使用 Runtime.getRuntime().exec("sync") 执行命令行工具同步，但这并没有改变行为。

导致 70 MB/s 的 C 代码是（使用低级 API（打开、写入、关闭）并没有太大变化）：

```
FILE* fp = fopen(filename, "w");
while(xyz) {
    fwrite(buffer, 1, BLOCK_SIZE, fp);
}
fflush(fp);
fclose(fp);
sync(); 
```

没有最后的同步调用；我得到了不切实际的值（超过 1 GB 又名主内存性能）。

为什么C和Java之间有这么大的区别？有两种可能性：我没有在 Java 中正确同步数据，或者 C 代码由于某种原因不是最理想的。

更新：我已经使用“strace -cfT cmd”完成了 strace 运行。结果如下：

C（低级 API）：MB/s 67.389782

```
% time seconds usecs/call 调用错误 syscall
------ ----------- ------------ --------- --------- ---- ------------
 87.21 0.200012 200012 1 fdatasync
 11.05 0.025345 1 32772 写
  1.74 0.004000 4000 1 同步

```

C（高级 API）：MB/s 61.796458

```
% time seconds usecs/call 调用错误 syscall
------ ----------- ------------ --------- --------- ---- ------------
 73.19 0.144009 144009 1 同步
 26.81 0.052739 1 65539 ​​写

```

Java（1.6 SUN JRE、java.io API）：MB/s 128.6755466197537

```
% time seconds usecs/call 调用错误 syscall
------ ----------- ------------ --------- --------- ---- ------------
 80.07 105.387609 3215 32776 写
  2.58 3.390060 3201 1059 读
  0.62 0.815251 815251 1 同步

```

Java（1.6 SUN JRE、java.nio API）：MB/s 127.45830221558376

```
  5.52 0.980061 490031 2 同步
  1.60 0.284752 9 32774 写入
  0.00 0.000000 0 80 关闭

```

时间值似乎只是系统时间，因此毫无意义。

更新 2：我切换到另一台服务器，重新启动，并使用全新格式化的 ext3。现在，Java 和 C 之间只有 4% 的差异。我根本不知道出了什么问题。有时事情很奇怪。在写这个问题之前，我应该用另一个系统尝试测量。对不起。

更新 3：总结答案：

*   使用 c.force(true) 后跟 s.getFD().sync() 用于 Java NIO 和 s.flush() 和 s.getFD().sync() 用于 Java 的流 API。对于 C 中的高级 API，不要忘记同步。fflush 将数据提交给操作系统，但不会将您的数据带到块设备。
*   使用 strace 分析命令完成的系统调用
*   在发布问题之前交叉检查您的结果。

更新 4：请注意以下后续[问题](https://stackoverflow.com/questions/5650327/are-filechannel-force-and-filedescriptor-sync-both-needed)。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-04-08T18:48:34.703

实际上，在 C 语言中，您只想调用`fsync()`一个文件描述符，而不是`sync()`（或“同步”命令），它将内核`flush`向磁盘系统范围内的所有缓冲区发出信号。

如果您`strace`（在此处获取特定于 Linux 的）JVM，您应该能够观察到对输出文件进行的`fsync()`或`fdatasync()`系统调用。这将是我所期望的`getFD()`。`sync()`打电话去做。我假设只是在每次写入后都应该调用`c.force(true)`NIO 的标志。`fsync()`可能只是您使用的 JVM 实际上没有实现`sync()`调用？

我不确定为什么在将“sync”作为命令调用时没有看到任何区别：但显然，在第一次同步调用之后，后续调用通常要快得多。再一次，我倾向于将`strace`（在 Solaris 上的桁架）作为“这里实际发生的事情？”来爆发。工具。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2014-05-23T20:22:23.360

使用同步 I/O 数据完整性完成是一个好主意。但是，您的 C 示例使用了错误的方法。您使用`sync()`，用于同步整个操作系统。

如果要将单个文件的块写入磁盘，则需要在 C中使用`fsync(2)`or `fdatasync(2)`.

`fdatasync()`如果文件在您同步后没有更改名称或大小，则该变体会更有效。但它也可能不会保留所有元数据。如果你想编写自己的事务安全数据库系统，你需要观察更多的东西（比如 fsyncing 父目录）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-08T15:47:28.057

您需要告诉我们更多关于硬件和操作系统的信息，以及具体的 Java 版本。你如何衡量这个吞吐量？

您是正确的，强制/同步应该将数据强制输出到物理媒体。

* * *

这是副本的原始版本。在 Intel Mac 上使用 gcc 4.0 编译，应该是干净的。

```
/* rawcopy -- pure C, system calls only, copy argv[1] to argv[2] */

/* This is a test program which simply copies from file to file using
 * only system calls (section 2 of the manual.)
 *
 * Compile:
 *
 *      gcc -Wall -DBUFSIZ=1024 -o rawcopy rawcopy.c
 *
 * If DIRTY is defined, then errors are interpreted with perror(3).
 * This is ifdef'd so that the CLEAN version is free of stdio.  For
 * convenience I'm using BUFSIZ from stdio.h; to compile CLEAN just
 * use the value from your stdio.h in place of 1024 above.
 *
 * Compile DIRTY:
 *
 *      gcc -DDIRTY -Wall -o rawcopy rawcopy.c
 *
 */
#include <fcntl.h>
#include <sys/types.h>
#include <sys/uio.h>
#include <stdlib.h>
#include <unistd.h>
#if defined(DIRTY)
#   if defined(BUFSIZ)
#       error "Don't define your own BUFSIZ when DIRTY"
#   endif
#   include <stdio.h>
#   define PERROR perror(argv[0])
#else
#   define CLEAN
#   define PERROR
#   if ! defined(BUFSIZ)
#       error "You must define your own BUFSIZ with -DBUFSIZ=<number>"
#   endif
#endif

char * buffer[BUFSIZ];          /* by definition stdio BUFSIZ should
                                   be optimal size for read/write */

extern int errno ;              /* I/O errors */

int main(int argc, char * argv[]) {
    int fdi, fdo ;              /* Input/output file descriptors */
    ssize_t len ;               /* length to read/write */
    if(argc != 3){
        PERROR;
        exit(errno);
    }

    /* Open the files, returning perror errno as the exit value if fails. */
    if((fdi = open(argv[1],O_RDONLY)) == -1){
        PERROR;
        exit(errno);
    }
    if((fdo = open(argv[2], O_WRONLY|O_CREAT)) == -1){
        PERROR;
        exit(errno);
    }

    /* copy BUFSIZ bytes (or total read on last block) fast as you
       can. */
    while((len = read(fdi, (void *) buffer, BUFSIZ)) > -1){
        if(len == -1){
            PERROR;
            exit(errno);
        }
        if(write(fdo, (void*)buffer, len) == -1){
            PERROR;
            exit(errno);
        }
    }
    /* close and fsync the files */
    if(fsync(fdo) ==-1){
        PERROR;
        exit(errno);
    }
    if(close(fdo) == -1){
        PERROR;
        exit(errno);
    }
    if(close(fdi) == -1){
        PERROR;
        exit(errno);
    }

    /* if it survived to here, all worked. */
    exit(0);
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2014-04-01T23:51:01.583

（我知道这是一个很晚的回复，但我在谷歌搜索时遇到了这个线程，这可能也是你最终来到这里的原因。）

您在 Java 中对单个文件描述符调用 sync()，因此只有与该文件相关的缓冲区才会刷新到磁盘。

在 C 和命令行中，您在整个操作系统上调用 sync() - 因此每个文件缓冲区都会被刷新到磁盘，因为您的操作系统正在执行所有操作。

为了比较，C 调用应该是 syncfs(fp);

从 Linux 手册页：

```
 sync() causes all buffered modifications to file metadata and data to
   be written to the underlying file systems.

   syncfs() is like sync(), but synchronizes just the file system contain‐
   ing file referred to by the open file descriptor fd. 
```

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-04-08T15:36:36.477

C 代码可能不是最理想的，因为它使用 stdio 而不是原始 OS write()。但是，java 可能会更优化，因为它分配了更大的缓冲区？

无论如何，您只能信任 APIDOC。其余的超出你的职责。

# synchronization - 跨多个服务器同步文件

> ID：730528
> 
> 赞同：0
> 
> 时间：2009-04-08T15:28:57.180
> 
> 标签：synchronization

在场环境中，是否有一种首选技术可以使在一台服务器上创建/更新/删除的文件与场中的所有其他服务器保持同步？例如，如果一个文件是由服务器 A 上的用户创建的，并且该文件是由服务器 B 上的用户请求的，那么确保在两个服务器上同时访问该文件的最佳方法是什么？相同的答案是否适用于场中的许多（1,000 多台）服务器？

尽管我的特定问题主要适用于 Windows 服务器，但最好该平台几乎没有区别。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-08T18:11:11.190

您可以使用内置在服务器操作系统中的分布式文件系统 (DFS)。我这样做是为了实现类似的目标。

本质上，您将 DFS 配置为创建一个根，它实际上只是一个 URI。您可以创建看起来像共享的*\\DOMAIN\SHARE*，尽管它是虚拟的。DFS 利用域的 DNS 将其呈现为有效位置。在根目录中，您可以创建链接，这些链接只是指向任意数量服务器上的物理文件共享的路径。这些将相当于您的根目录下的子目录。最后，对于每个链接，您可以创建多个目标。在您的示例中，它将是每台机器上的共享。然后，DFS 将使用文件复制服务在作为目标列出的所有路径中复制这些共享中的文件。

它适用于我拥有的两台服务器。我不知道复制到 1000 多台服务器时它的扩展性如何。这是一个企业级解决方案，但我不确定机器数量在管理上是否可行。因为您是跨机器，所以您可能不需要以这种规模进行复制，而是将其用作服务，就像它的抽象一样。路径是一个常数。

其他注意事项：您必须安装文件复制服务。我认为您还需要一个域环境才能真正完成这项工作。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-08T18:22:27.670

在 Linux 方面，您可能对[DRDB](http://www.linux-ha.org/DRBD)感兴趣。

# windows - 如何根据目标机器（32 位或 64 位）有条件地使用 WiX 安装文件？

> ID：730534
> 
> 赞同：6
> 
> 时间：2009-04-08T15:29:51.063
> 
> 标签：windows, wix, 32bit-64bit

我有一个有 32 位版本和 64 位版本的文件。如果我在 32 位机器上安装我的应用程序，我希望安装 32 位版本的文件。同样，如果安装在 64 位机器上运行，则应安装 64 位版本。如何使用 WiX 检查安装程序在哪种类型的机器上运行？

拜托，没有单行答案。我正在寻找特定的 WiX 标签以及将它们放在我的 WiX 脚本中的位置。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-08T22:48:11.757

您可以*使用*条件只做两个单独的组件

```
 VersionNT64 
```

和

```
 Not VersionNT64 
```

但正确的方法是为 32 位和 64 位操作系统编译单独的安装程序，并且 64 位组件也应该这样标记（用`Win64="yes"`） - 我不知道是否甚至可以将 Windows 安装程序包标记为面向英特尔和 x64。只有一次我使用 NSIS 完成了混合架构安装，我所有的 WiX 安装程序都有针对每个架构的单独安装程序。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-08T19:48:44.997

这样做的正确方法是编译两个设置，一个用于 32 (x86)，一个用于 64 (amd64)。然后将这两个 msi 打包到一个 msi 中，并在运行时运行相应的 msi。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-04-22T17:39:35.420

您可以使用环境或预处理器变量创建一个基本 wxs 文件，并在编译之前填写所需的属性。另一种选择是在构建之前运行一个脚本，该脚本在文件中包含用于特定安装的不同 GUID。简而言之，我认为没有一种简单的方法可以为不同的架构构建安装程序，因此您必须使用其他实用程序。

# entity-framework - 更改实体状态

> ID：730549
> 
> 赞同：4
> 
> 时间：2009-04-08T15:33:50.180
> 
> 标签：entity-framework

我目前有一个带有一堆已删除项目的实体模型，状态已删除。有没有办法“取消删除”它们？我知道要取消删除哪些项目，但我不知道如何取消删除这些项目。理想情况下，我想让它恢复到未更改的状态。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2010-01-10T16:37:17.203

在你打电话后

**objectContext.DeleteObject(x)** ,

您可以使用模拟取消删除对象**x**

**objectContext.Detach(x); objectContext.Attach(x)**

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-06T18:03:42.010

您是否可以选择不提交连接上下文？- 在不调用 objectContext.SaveChanges() 的情况下处理 ObjectContext；当然，如果您有某些不想保存的更改，它们也不会保留。

如果你打电话`objectContext.DeleteObject(x)`，你不能取消删除它并仍然保存更改。

```
ObjectStateEntry objectStateEntry = objectContext.ObjectStateManager.GetObjectStateEntry(x);

// objectStateEntry.State is not setable 
```

ObjectStateEntry 确实具有 OriginalValues 属性，因此理论上您可以煞费苦心地重新创建一个表示原始更改的集合，减去不需要的更改，退出 objectContext，打开一个新的并重建这些更改减去那里不需要的更改。可能不值得麻烦，但目前没有记录的方法可以取消标记要删除的内容。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2014-04-04T08:52:06.903

您可以为您的 Context、ObjectSet 或 EntityObject 实现 RejectChanges 方法。现在我编写这些方法的 VB 代码： RejectChanges in Context 的扩展方法：

```
<Extension()>
Sub RejectChanges(ByVal Context As ObjectContext)
    Dim Collectin As IEnumerable(Of Object) = From e In Context.ObjectStateManager.GetObjectStateEntries(System.Data.EntityState.Modified Or System.Data.EntityState.Deleted) Select e.Entity
    Context.Refresh(RefreshMode.StoreWins, Collectin)

    Dim AddedCollection As IEnumerable(Of Object) = From e In Context.ObjectStateManager.GetObjectStateEntries(System.Data.EntityState.Added) Select e.Entity
    For Each addedEntity As Object In AddedCollection
        Context.Detach(addedEntity)
    Next
End Sub 
```

在 ObjectSet 中实现 RejectChanges 的扩展方法：

```
<Extension()>
Sub RejectChanges(Of T As MyEntity)(ByVal Lst As ObjectSet(Of T))
    Dim collection As IEnumerable(Of T) = From o In Lst.AsEnumerable() Where o.EntityState = EntityState.Modified Or o.EntityState = EntityState.Deleted Select o
    Lst.Context.Refresh(RefreshMode.StoreWins, collection)

    Dim AddedCollection As IEnumerable(Of T) = (From e In Lst.Context.ObjectStateManager.GetObjectStateEntries(System.Data.EntityState.Added) Select e.Entity).ToList().OfType(Of T)()
    For Each entity As T In AddedCollection
        Lst.Context.Detach(entity)
    Next
End Sub 
```

最后为 EntityObject 实现 RejectChanges：

```
<Extension()>
Sub RejectChanges(ByVal entity As EntityObject, ByVal Context As ObjectContext)
    If entity.EntityState = EntityState.Modified OrElse entity.EntityState = EntityState.Deleted Then
        Context.Refresh(RefreshMode.StoreWins, entity)
    ElseIf entity.EntityState = EntityState.Added Then
        Context.Detach(entity)
    End If
End Sub 
```

再见。[伊曼沙班扎德]

# java - 跳转到本地pdf页面的方式？

> ID：730554
> 
> 赞同：1
> 
> 时间：2009-04-08T15:34:27.433
> 
> 标签：java, pdf, acrobat

我的问题类似于[“如何在某个时间点以编程方式打开 pdf？”](https://stackoverflow.com/questions/446614/how-can-i-programmaticly-open-a-pdf-at-a-certain-point) ，但 PDF 是本地的，而不是在 Web 服务器上。

我需要一种方法来跳转到用户计算机上的 PDF 中的给定页面，该页面适用于 Acrobat 版本（或使用替代 PDF 查看器，如 Foxit Reader）。PDF 将从 Java 应用程序中调用（它仅在 Windows 上使用，因此跨平台不是必须的），现在它适用于：

```
int pageNum = 24;
String manualPath = "C:\\Program Files\\Foo\\Bar\\Docs\\RefMan.pdf";
String acrordPath = "C:\\Program Files\\Adobe\\Reader 8.0\\Reader\\AcroRd32.exe";
String cmdString = "\"" + acrordPath + \" /A \"page=" + pageNum + 
    "=OpenActions\" \"" + manualPath + \"";
Process p = Runtime.getRuntime().exec(cmdString); 
```

显然，这仅在最终用户使用 32 位的 Acrobat 8​​ 并将其安装在默认位置时才有效。我接下来尝试使用：

```
rundll32 url.dll,FileProtocolHandler file:///C:/Program%20Files/Foo/Bar/Docs/RefMan.pdf#page=24 
```

认为这会打开用户浏览器并跳转到该页面，但它只是在第 1 页打开了 Acrobat。

所以我很困惑，并寻求帮助。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-08T21:45:01.630

我最终通过使用[此代码](http://www.rgagnon.com/javadetails/java-0480.html)调用 reg.exe 并解析 HKLM\SOFTWARE\Classes.pdf 的输出以查看其是否为 AcroExch 类，然后从 HKLM\SOFTWARE\Classes\AcroExch.Document\ 获取命令行来实现这一点外壳\打开\命令。

它的hacky，但它的工作原理。

# c# - DropDownList AppendDataBoundItems（第一项为空白且无重复项）

> ID：730555
> 
> 赞同：37
> 
> 时间：2009-04-08T15:34:27.497
> 
> 标签：c#, asp.net, drop-down-menu, webforms, append

我有一个`DropDownList`内部的 an `UpdatePanel`，它是在从 a 回发时填充的`SqlDataSource`。它有一个参数是另一个控件。我有时需要多次回发，但每次更新面板刷新时，都会将项目添加到`DropDownList`. 所以`DropDownList`最终会得到不正确的数据或重复的数据。

我将`AppendDataBoundItems`属性设置为，`true`因为我需要第一项为空白。

我该如何克服这个问题？还有另一种方法可以让第一项空白吗？

（这`DropDownList`是在 ASP.NET 2.0 Web 应用程序中，代码隐藏在 C# 中）

* * *

## 回答 #1

> 赞同：65
> 
> 时间：2009-04-08T15:38:37.827

不要使用`AppendDataboundItems='true'`（这将导致您正在谈论的问题），而是响应`DataBound`事件，`DropDownList`然后将您的“空白”项目添加到列表的顶部。

```
<asp:DropDownList runat="server" ID="MyList"
  ondatabound="MyListDataBound"></asp:DropDownList> 
```

然后在你的代码后面：

```
protected void MyListDataBound(object sender, EventArgs e)
{
    MyList.Items.Insert(0, new ListItem("- Select -", ""));
} 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2015-07-21T21:18:54.263

这里有很好的答案，但我觉得有必要提供更多信息，因为有多种选择可行，我们需要决定使用哪一种。

首先，我们应该了解`AppendDataBoundItems`。如果`AppendDataBoundItems = "true"`,`ListItems`被添加到`DropDownList`不清除旧的。否则，`DropDownList`将在下一个 之前清除`DataBind`。[MSDN AppendDataBoundItems 文档](https://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.listcontrol.appenddatabounditems(v=vs.110).aspx)

大多数答案基本上涵盖了2个选项：

**1.在html中定义一个空白选项，将数据库中的ListItems添加到DropDownList中一次。**

请注意这里的 3 件事：

*   空白`ListItem`在html中定义
*   `AppendDataBoundItems="true"`
*   `DataBind`不会在回发或`DropDownList`项目计数 > 1时调用

来源：

```
<asp:DropDownList ID="MyList" runat="server" AppendDataBoundItems="true" DataValueField="Id" DataTextField="Name" >
    <asp:ListItem Text="- Select One -" Value="" />
</asp:DropDownList> 
```

后面的代码：

```
protected void Page_Load(object sender, System.EventArgs e)
{
    if (MyList.Items.Count <= 1 ) {
        MyList.DataSource = MyDataSource;
        MyList.DataBind();
    }
} 
```

注意：我喜欢检查 count 与检查的逻辑`IsPostBack`。虽然 PostBacks 通常是重复数据绑定的原因，但也有可能以其他方式导致它。检查项目计数基本上只是检查它是否已经加载。

或（`IsPostBack`替代使用的选项）

```
protected void Page_Load(object sender, System.EventArgs e)
{
    if (!IsPostBack) {
        MyList.DataSource = MyDataSource;
        MyList.DataBind();
    }
} 
```

**2\. 每次页面刷新时清除并重新加载 DropDownList。**

注意与第一个选项的 3 个不同之处：

*   `AppendDataBoundItems="false"`（如果未定义，`false`则为默认值）
*   `ListItem`后面的代码中添加了空白。我们不能在 html 中定义它，因为使用`AppendDataBoundItems="false"`，它会被清除。
*   `DataBind`被要求在每个`Page_Load`

来源：

```
<asp:DropDownList ID="MyList" runat="server" DataValueField="Id"  DataTextField="Name" 
    OnDataBound="MyList_DataBound" >
</asp:DropDownList> 
```

后面的代码：

```
protected void Page_Load(object sender, System.EventArgs e)
{
    MyList.DataSource = MyDataSource;
    MyList.DataBind();
}

protected void MyList_DataBound(object sender, EventArgs e)
{
    MyList.Items.Insert(0, new ListItem("- Select One -", ""));
} 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-12-21T19:37:51.783

您可能在后面的代码中绑定了那个 DropDownList。所以你不应该在再次回发后这样做：

```
// probably in Page_Load method
if (!Page.IsPostBack)
{
    // do data binding here
}; 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2010-12-27T16:21:42.010

这是一个想法，我们可以使用 2 个事件：*DataBound*和*DataBinding*：

```
protected void MyListDataBound(object sender, EventArgs e)
{
  MyList.Items.Insert(0, new ListItem("- Select -", ""));
}

protected void MyListDataBinding(object sender, EventArgs e)
{
  MyList.Items.Items.Clear();
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-04-05T17:49:29.043

```
<asp:DropDownList ID="DropDownList1" AppendDataBoundItems="true" runat="server"
  DataSourceID="SqlDataSource1" DataTextField="state" DataValueField="state">
    <asp:ListItem Text="(Select a State)" Value="" />
</asp:DropDownList>
<asp:SqlDataSource ID="SqlDataSource1" runat="server"
  ConnectionString="<%$ ConnectionStrings:pubsConnectionString %>"
  SelectCommand="SELECT DISTINCT [state] FROM [authors]">
</asp:SqlDataSource> 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-07-22T22:23:40.793

这是一个想法。

下拉列表中有一个属性，称为`AutoPostBack`将其设置为 true，然后在后面的代码中将所有绑定方法放在`if(!Page.IsPostBack)`. 这对我有用。

问候。

# sql-server - 关于执行 ssis 包的问题

> ID：730558
> 
> 赞同：1
> 
> 时间：2009-04-08T15:35:27.617
> 
> 标签：sql-server, ssis

我在本地机器上开发了 ssis 项目，将数据从 mysql db 提取到 sql server 2008。一切正常。现在我将包（.dtsx 文件）移动到服务器，这是一个 64 位窗口 2008 框，它停止工作。问题是该软件包默认为 sqlserver 驱动程序而不是 mysql 驱动程序。我必须将整个项目从本地机器移动到服务器并打开项目以使其获取 mysql 驱动程序，然后它将工作。有没有一种方法可以在我的本地机器上开发但在服务器上运行而无需打开项目来获取正确的驱动程序？谢谢

# dependency-injection - 依赖注入生命周期

> ID：730559
> 
> 赞同：0
> 
> 时间：2009-04-08T15:35:30.287
> 
> 标签：dependency-injection

我有一个单例服务，它依赖于具有请求范围生命周期的服务。

如果我允许容器在我第一次获得单例时注入请求范围的服务，那么它对于当前请求来说是可以的，但会在任何后续请求中被处理掉。

这是否意味着我必须使用依赖容器在单例中创建请求范围的服务？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-08T22:38:41.767

我不建议在您的单例服务中注入容器本身。反而：

*   在工厂后面抽象您的请求范围服务的创建，并注入工厂，或者
*   更改单例的范围并使其具有请求范围。除非服务的实例化很昂贵，否则这应该不是问题。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-08T16:22:46.973

我会问您的对象是否绝对必须是单例。如果它不必*是单例*，则不要将其设为单例并依靠您的容器来构造它。您遇到的问题是因为依赖注入依赖于控制反转，而单例通常会自行构建。

许多容器将对它们构建的对象的生命周期负责。如果你这样做，你也许可以指示它只使用你的对象的一个​​实例。但是，如果我正确阅读了您的问题，那么您确实需要每个请求的对象的新实例，因为每个请求的状态（服务）都不同。

简而言之，使用单例作为最后的手段，因为它会导致您现在遇到的问题类型。如果您被锁定在该模式中，请考虑不注入服务，而是将其作为参数传递。如果您将其引入状态，您将遇到需要不同服务实例的多个同时请求的并发问题。

# c# - 使用泛型将其声明为 Button 但被视为类内部的 Control。为什么？

> ID：730561
> 
> 赞同：4
> 
> 时间：2009-04-08T15:35:51.907
> 
> 标签：c#, generics, .net-2.0, overriding

这是一个多么棒的网站，多年来我一直潜伏在这里阅读其他问题，但现在我有一个自己的问题。

我的同事写了一门很像下面的课。我一看到它就知道它行不通，但我无法向他解释为什么它行不通。

他在将其声明为 a 时所期望的`ControlItem<Button>`是，在使用基调用 Draw() 时会调用 Draw(Button) 方法。相反，我们总是最终抛出异常。

这是协方差问题吗？

```
public abstract class ControlItem
{
    public ControlItem()
    {
    }

    abstract public void Draw();
}

public class ControlItem<T> : ControlItem where T : Control, new()
{
    public T MyControl { get; set; }

    private ControlItem()
    {       }

    public ControlItem(T control)
        : base()
    {
        MyControl = control;
    }

    public override void Draw()
    {
        Draw(this.MyControl);
    }

    public void Draw(Control cntrl)
    {
        throw new NotImplementedException();
    }

    public void Draw(Button button)
    {
        //Do some work
    }
} 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-08T15:52:02.007

> 这是协方差问题吗？

不，这是静态与动态调度问题。静态调度意味着重载的方法调用在编译时根据传入的*变量类型绑定到适当的类型：*

```
class Base { }
class Derived : Base { }

class Foo
{
    void Test()
    {
        Base a = new Base();
        Overload(a);    // prints "base"

        Derived b = new Derived();
        Overload(b);    // prints "derived"

        // dispatched based on c's declared type!
        Base c = new Derived();
        Overload(c);    // prints "base"
    }

    void Overload(Base obj)    { Console.WriteLine("base"); }
    void Overload(Derived obj) { Console.WriteLine("derived"); }
} 
```

动态分派意味着函数在运行时根据存储在变量中的对象的实际类型进行绑定：

```
class Base
{
    public virtual void Override() { Console.WriteLine("base"); }
}

class Derived : Base
{
    public override void Override() { Console.WriteLine("derived"); }
}

class Foo
{
    void Test()
    {
        Base a = new Base();
        a.Override();   // prints "base"

        Derived b = new Derived();
        b.Override();    // prints "derived"

        // dynamically dispatched based type of object stored in c!
        Base c = new Derived();
        c.Override();    // prints "derived"
    }

    void Overload(Base obj) { Console.WriteLine("base"); }
    void Overload(Derived obj) { Console.WriteLine("derived"); }
} 
```

最后的打印显示了两者之间的差异。C# 和大多数基于类的 OOP 语言一样，只支持对`this`隐式参数进行动态分派（称为“单次分派”）。换句话说，*重写*的方法是动态分派的，而*重载*的方法则不是。

在单一调度语言中伪造多个调度的典型解决方案是使用[访问者模式](http://en.wikipedia.org/wiki/Visitor_pattern)，这对你有用。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-08T15:40:27.370

这是因为编译器只知道该类型将是一个控件，所以它总是会绑定到带有 Control 参数的方法。如果您需要以不同方式处理它们，则需要在 Draw() 方法中添加显式检查：

```
public override void Draw() {
   Button btn = MyControl as Button;
   if (btn != null) {
      Draw(btn);
   } else {
      Draw(this.MyControl);
   }
} 
```

请注意，这不是很“通用”......但它可能会在您的特殊情况下起到作用。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-08T16:25:13.987

建立在慷慨的回答：与 C++ 模板不同，[C# 泛型不在编译时实例化](http://blogs.msdn.com/ericlippert/archive/2007/06/18/calling-static-methods-on-type-variables-is-illegal-part-two.aspx)。C# 编译器为泛型类型生成的代码与您在代码中使用的特化完全无关。编译器会输出一段代码，该代码适用于满足约束的类型参数的任何替换。直到运行时，当一个完全指定的泛型类型的实例被实例化时，JIT 编译器才会创建特定于您的类型参数的代码。

由于生成的代码适用于满足约束条件的任何内容，因此 C# 编译器将您的`MyControl`成员视为类型`Control`(not `T`) 的变量，因为它可以从约束中推断出尽可能多的变量。由于编译器必须为类发出通用代码，它必须根据它所知道的来选择调用哪个方法，并且由于它不能确定在运行时是否`MyControl`会是 a `Button`，它必须选择`Draw(Control)`.

# xml - 考虑到 WSDL 合规性和性能，在 gsoap 中做数组的最佳方法

> ID：730568
> 
> 赞同：2
> 
> 时间：2009-04-08T15:37:29.767
> 
> 标签：xml, wsdl, standards-compliance, gsoap

我正在使用 gsoap 生成 XML SOAP 解析器和 WSDL 语法，并且想知道什么是推荐的方法来表达一个静态数组，它既可以快速解析又可以生成通过所有验证测试的相应 WSDL（如 Eclipse WSDL Validator或 NetBeans 验证 XML）。

如果我将此输入用于 gsoap：

```
struct ns__ArrayOfSomeInts { xsd__int ints[10]; }; 
```

我得到了这个生成的 WSDL（在定义/类型/模式标签内）：

```
 <complexType name="ArrayOfSomeInts">
   <sequence>
     <element name="ints" type="ns:Array10Ofxsd__int" minOccurs="1" maxOccurs="1" nillable="true"/>
   </sequence>
  </complexType>
  <complexType name="Array10Ofxsd__int">
   <complexContent>
    <restriction base="SOAP-ENC:Array">
     <attribute ref="SOAP-ENC:arrayType" WSDL:arrayType="xsd:int[]"/>
    </restriction>
   </complexContent>
  </complexType> 
```

通过 NetBeans "Validate XML" 运行它会出现以下错误：

*   错误：src-resolve：无法将名称“SOAP-ENC:Array”解析为（n）“类型定义”组件。

Eclipse WSDL Validator 给出了这两个错误：

*   WS-I：(BP2108) Array 声明使用 - 限制或扩展 - soapenc:Array 类型，或在类型声明中使用 wsdl:arrayType 属性。
*   WS-I：(BP2122) wsdl:types 元素包含不是 XML 模式定义的数据类型定义。

我可以通过更改 gsoap 代码来定义动态数组来清除这些错误：

```
struct ns__ArrayOfSomeInts { int __size; xsd__int *ints; }; 
```

（带有相应的 WSDL :)

```
 <complexType name="ArrayOfSomeInts">
   <sequence>
     <element name="ints" type="xsd:int" minOccurs="0" maxOccurs="unbounded"/>
   </sequence>
  </complexType> 
```

但是现在我失去了使用静态数组的性能提升。是否有其他方法可以在保持合规性的同时保持性能？

# php - 如何使用 Zend_Tool 生成模块化目录结构？

> ID：730570
> 
> 赞同：1
> 
> 时间：2009-04-08T15:37:52.527
> 
> 标签：php, zend-framework, module

我见过的使用 Zend_Tool 生成 Zend Framework 项目的唯一示例创建了这个目录结构：

/应用程序/控制器
/应用程序/模型
/应用程序/视图

Zend_Tool 是否能够生成**模块化**目录结构（每个模块都有自己的模型、视图和控制器）？

例子：

/application/modules/default/controllers
/application/modules/default/models
/application/modules/default/views

/application/modules/admin/controllers
/application/modules/admin/models
/application/modules/admin/views

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-10T20:00:08.890

您可能应该在 Zend Framework 开发邮件列表上提出这个问题。 `Zend_Tool`目前仅在 ZF 1.8 Preview Release 中可用，并且仍在积极开发中。大部分文档`Zend_Tool`仍未成文。

您也可以在 Yahoo 群组上询问 Zend Tool： [http ://tech.groups.yahoo.com/group/zf-tool/](http://tech.groups.yahoo.com/group/zf-tool/)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-16T14:29:28.480

Zend_Tool 获得了关于创建模块的更新。Zend Framework 1.8.1 带有模块创建支持，但仍需要一些改进。

# python - django 发送和接收电子邮件？

> ID：730573
> 
> 赞同：23
> 
> 时间：2009-04-08T15:38:53.710
> 
> 标签：python, django, email, pop3, django-email

我已经非常熟悉 django 的电子邮件发送功能，但我还没有看到任何关于它接收和处理来自用户的电子邮件的信息。这个功能可用吗？

一些谷歌搜索并没有出现非常有希望的结果。虽然我确实找到了这个：[Receive and send emails in python](https://stackoverflow.com/questions/348392/receive-and-send-emails-in-python)

我必须自己动手吗？如果是这样，我会以比你说的更快的速度发布该应用程序......无论你说什么。

谢谢，吉姆

**更新**：我不是想创建一个电子邮件服务器，我只需要添加一些功能，您可以通过电子邮件将图像发送到站点并让它在您的帐户中弹出。

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-04-08T19:43:37.613

有一个名为[jutda-helpdesk](http://code.google.com/p/jutda-helpdesk/)的应用程序使用 Python`poplib`并`imaplib`处理传入的电子邮件。您只需要在某个地方拥有一个具有 POP3 或 IMAP 访问权限的帐户即可。

这是改编自他们的[get_email.py](http://code.google.com/p/jutda-helpdesk/source/browse/trunk/management/commands/get_email.py)：

```
def process_mail(mb):
    print "Processing: %s" % q
    if mb.email_box_type == 'pop3':
        if mb.email_box_ssl:
            if not mb.email_box_port: mb.email_box_port = 995
            server = poplib.POP3_SSL(mb.email_box_host, int(mb.email_box_port))
        else:
            if not mb.email_box_port: mb.email_box_port = 110
            server = poplib.POP3(mb.email_box_host, int(mb.email_box_port))
        server.getwelcome()
        server.user(mb.email_box_user)
        server.pass_(mb.email_box_pass)

        messagesInfo = server.list()[1]

        for msg in messagesInfo:
            msgNum = msg.split(" ")[0]
            msgSize = msg.split(" ")[1]
            full_message = "\n".join(server.retr(msgNum)[1])

            # Do something with the message

            server.dele(msgNum)
        server.quit()

    elif mb.email_box_type == 'imap':
        if mb.email_box_ssl:
            if not mb.email_box_port: mb.email_box_port = 993
            server = imaplib.IMAP4_SSL(mb.email_box_host, int(mb.email_box_port))
        else:
            if not mb.email_box_port: mb.email_box_port = 143
            server = imaplib.IMAP4(mb.email_box_host, int(mb.email_box_port))
        server.login(mb.email_box_user, mb.email_box_pass)
        server.select(mb.email_box_imap_folder)
        status, data = server.search(None, 'ALL')
        for num in data[0].split():
            status, data = server.fetch(num, '(RFC822)')
            full_message = data[0][1]

            # Do something with the message

            server.store(num, '+FLAGS', '\\Deleted')
        server.expunge()
        server.close()
        server.logout() 
```

`mb`只是存储所有邮件服务器信息的一些对象，其余的应该很清楚。

您可能需要检查文档`poplib`并`imaplib`获取消息的特定部分，但希望这足以让您继续前进。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2011-03-16T16:07:24.777

我知道这个问题现在已经很老了，但只是想我会添加以供将来参考，您可能想尝试一下[http://cloudmailin.com](http://cloudmailin.com)。我们有很多 django 用户使用该系统，它应该比建议的解决方案简单一点。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-08T16:23:38.813

Django 的真正目的是作为一个 Web 服务器（嗯，作为一个适合 Web 服务器的框架），而不是作为电子邮件服务器。我想您可以将一些代码放入启动电子邮件服务器的 Django Web 应用程序中，使用您链接到的那个问题中显示的那种代码，但我真的不推荐它；这是对动态 Web 编程功能的滥用。

通常的做法是拥有单独的电子邮件和 Web 服务器，为此您可能需要研究 Sendmail 或（更好的）Postfix 之类的东西。我认为，对于 POP3，您还需要像 Dovecot 或 Courier 这样的东西。（当然可以让电子邮件服务器在收到电子邮件时通知您的 Web 应用程序，以便它可以对它们进行操作，如果您想要这样做的话。）

*编辑*：回应您的评论：是的，您正在尝试制作（或至少使用）电子邮件服务器。电子邮件服务器只是一个接收电子邮件的程序（并且可能也能够发送它们，但您不需要它）。

您绝对可以用 Python 编写一个小型电子邮件服务器，它只接收这些电子邮件并将图像保存到文件系统或数据库或其他任何地方。（可能值得提出一个新问题，关于）但不要让它成为 Django Web 应用程序的一部分；将其保留为自己的单独程序。

# c# - 如何从 C# 中的 List 中删除元素？

> ID：730575
> 
> 赞同：2
> 
> 时间：2009-04-08T15:39:43.520
> 
> 标签：c#, generics, list

我有一个小问题。

有

```
List<List<UInt32>> temp = new List<List<UInt32>>(); 
```

例如，

List temp 中有两条`List<UInt32>`记录但是，当我尝试执行类似`temp.removeAt(0);`它不会删除第一行的操作时`(List<UInt32>`）.. 为什么会这样？我做错了什么吗？

**更新**

这是不起作用的代码。我知道主列表中有 2 个`List<UInt32>`，我知道第一个`List<UInt32>.Count`是 1，但是当我在这段代码之后检查相同的位置时，第一个代码的 Count 仍然是一个。

```
 int i = 0;
                        bool boolA = true;

                        while (boolA)
                        {
                            if (temp[i].Count == 1) 
                            {
                                temp.RemoveAt(i);
                                temps++; 
                            }

                            if (i == temp.Count - 1) boolA = false;
                            i++; 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-08T15:56:48.330

您正在删除项目，然后推进 i，因此会跳过移动到 i 表示的先前位置的项目。

例如

items = 5 i = 0 -> 删除 i => items = 4, i = 0

-> i++ => 项目 = 4，我 = 1

-> 删除 i => items= 3, i = 1

-> i++ => 项目 = 3, i = 2

-> 删除 i => 项目 = 3, i = 2

-> i++ => 项目 = 3, i = 3

-> 删除 i => 索引超出范围

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-08T15:44:52.073

您的问题不清楚，但听起来您的用户界面已绑定到列表。如果是这样，您将看不到更改，因为该列表不支持更改通知。您应该使用`BindingList<T>`(for windows forms) 或`ObservableCollection<T>`(for WPF) 来获取更改通知。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-08T15:45:13.630

这确实有效。

如果“临时”列表中有两个 List 实例，doing`temp.RemoveAt(0);`将删除两个列表中的第一个。它将从 temp 中删除整个 List，而不仅仅是内部列表中的第一个 int 值。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-08T15:43:41.780

我相信它确实会删除它。

我认为您在检查计数时正在查看错误的列表，因为您正在处理整数列表的列表......

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-08T15:49:22.403

我认为我们需要更多的代码来解决问题。你的描述应该有效。

我有以下代码正常工作。

```
 List<UInt32> a = new List<UInt32>();
        a.Add(1);
        a.Add(11);

        List<UInt32> b = new List<UInt32>();
        b.Add(2);
        b.Add(22);

        List<UInt32> c = new List<UInt32>();
        c.Add(3);
        c.Add(33);

        List<List<UInt32>> temp = new List<List<UInt32>>();
        temp.Add(a);
        temp.Add(b);
        temp.Add(c);

        temp.RemoveAt(0); 
```

在最后一行，删除了包含“1”和“11”的列表。

重要的是要注意整个第一个列表被删除，而不仅仅是包含数字“1”的项目。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-08T15:58:11.073

我们可能需要查看更多您的代码。突出的一件事是您的示例中的行：

```
if (temp[i].Count == 1) 
```

`List<UInt32>`仅当内部仅包含 1 个项目时，才会满足此条件。你可能没有`.RemoveAt(0)`像你认为的那样执行。如果没有看到更多代码，我不能肯定地说。

# java - 在 GWT 中序列化对象

> ID：730576
> 
> 赞同：6
> 
> 时间：2009-04-08T15:39:45.393
> 
> 标签：java, serialization, gwt, javabeans

使用 GWT 将 bean 序列化为字符串的最简单方法是什么？我不喜欢使用*GWT.create()*调用。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-19T16:11:31.933

**免责声明：** 在 URL 上序列化 bean 对 GWT 来说并不是一个好主意。我了解到，如果需要在 URL 上放置数据，应该尽可能少，并且只需要恢复页面状态所需的数据。看看 Gmail 如何使用它的历史令牌，你会发现它非常少。

**有了这个免责声明：**

对于我从事的 GWT 项目，我只是简单地写出由分隔符分隔的 bean 的值。在读回这些值时，我使用 String.split() 方法来获取一个数组。使用该数组，我将值分配回正确的 bean 属性。在代码中：

```
public class Sample {

    private int a;
    private boolean b;
    private String c;
    //getters and setters for fields not shown

    public String toHistoryToken(){
        return a+"/"+b+"/"+c;
    }
    public void fromHistoryToken(String token){
        String[] values=token.split("/");
        a=Integer.parseInt(values[0]);
        b=Boolean.parseBoolean(values[1]);
        c=values[2];
    }
} 
```

对于更复杂的场景，您可能需要做更复杂的事情。例如，对于嵌套对象，您必须编写代码将值传递给子对象。

另外，请注意，您必须确保您使用的任何值都不包含分隔符。因此，如果您知道您的字符串可能包含“/”，那么您可能必须对它们执行 replace() 操作以转义任何嵌套分隔符。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-13T14:55:34.277

我不确定我是否了解您最终要完成的工作。

如果你真的只是想来回发送字符串，你真的不需要做*任何事情*——你可以使用普通的 GWT RPC 机制免费获得。只需创建一个返回 a 的方法`java.lang.String`，创建随附的实现和 Async 接口，就完成了。

另一方面，如果你真的想发送一个 bean，只需确保它有一个零参数的构造函数并实现`Serializable`or `IsSerializable`。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-20T05:24:42.590

我能找到的最接近的是：

[使用嵌入在 HTML 主机页面中的对象加快 GWT 启动](http://www.dobesland.com/2009/02/17/faster-gwt-startup-with-pre-loaded-objects/)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-13T14:44:30.603

也许这就是你要找的东西？

[与 GWT 一起使用的 Json <-> Java 序列化](https://stackoverflow.com/questions/683123/json-java-serialization-that-works-with-gwt)

扩大的视野：

使用 Json-lib 库：

[http://json-lib.sourceforge.net/](http://json-lib.sourceforge.net/)

你可以这样做（从 bean 到 json 字符串）：

[http://json-lib.sourceforge.net/snippets.html#Creating_a_JSONObject_from_a_JavaBean](http://json-lib.sourceforge.net/snippets.html#Creating_a_JSONObject_from_a_JavaBean)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-15T20:49:24.237

GWT 可能存在一些使事情复杂化的细微差别，但通常情况如下：

*   XML 数据绑定/映射库（如[JAXB](http://jaxb.dev.java.net)和[XStream）](http://xstream.codehaus.org)可以做到这一点
*   使用 JSON，像[Jackson](http://jackson.codehaus.org/Tutorial)这样的库可以进行灵活的全 bean 绑定，类似于 JAXB，但配置更少（如果这很重要，速度更快）。

应该管用。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-17T20:10:08.663

最终，GWT 是在 JavaScript 中运行的（即使它是用 Java 编写的）。从这个意义上说，“java bean”不是您在客户端中容易找到的东西，但它们在服务器中（在 Java 中）运行良好。

如果您接受 bean 实际上只是一个无方法的对象，那么您使用它们的潜在意图是移动数据。在 JavaScript 中，JSON 也可以作为一个极其灵活的数据容器。在服务器端，可以使用 BeanUtils（以及一些遍历）将 Bean 数组转换为 JSON。JSON 可以在 GWT 中序列化为字符串，并且 GWT 有一个解析器将 JSON 转换回客户端的 JavaScript 对象。

这可能不是最简单的方法，但一旦你开始工作，它就会非常灵活。

# visual-studio - 调试模式下当前行的 VS.NET 编辑器中的自定义颜色设置

> ID：730578
> 
> 赞同：1
> 
> 时间：2009-04-08T15:40:15.470
> 
> 标签：visual-studio, visual-studio-2008

我在我非常喜欢的 Visual Studio.NET 中使用了黑色语法高亮主题。当处于调试模式并逐步执行代码时，当前行背景为黄色，这很好。

然而，调用我当前单步执行的函数的堆栈上方的代码行也被突出显示，在丑陋的灰色背景中，这使得白色代码不可读。

我浏览了字体和颜色设置中的项目列表两次，但找不到任何看起来像我正在寻找的项目的东西！

帮助哦，你强大的堆栈溢出者！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-08T16:17:27.250

找到了！它被称为“只读区域” - 非常不直观！

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-08T16:01:54.653

您是否尝试过“非活动选定文本”？我相信那是您正在寻找的那个。

# mysql - 1114 (HY000): 表已满

> ID：730579
> 
> 赞同：133
> 
> 时间：2009-04-08T15:40:26.170
> 
> 标签：mysql, innodb

我正在尝试`InnoDB`使用简单的查询向表中添加一行：

```
INSERT INTO zip_codes (zip_code, city) VALUES ('90210', 'Beverly Hills'); 
```

但是当我尝试这个查询时，我得到以下信息：

> ERROR 1114 (HY000): 表`zip_codes`已满

做一个

```
SELECT COUNT(*) FROM zip_codes 
```

给了我 188,959 行，考虑到我在同一个数据库中有另一个包含 810,635 行的表，这似乎不算太多。

我对这个问题相当缺乏经验，`InnoDB engine`也从未遇到过这个问题`MyISAM`。这里有哪些潜在问题？

编辑：这只发生在向`zip_codes`表中添加一行时。

* * *

## 回答 #1

> 赞同：107
> 
> 时间：2009-04-08T15:45:35.893

**编辑：**首先检查，如果您没有用完磁盘空间，然后再解决与配置相关的解决方案。

`innodb_data_file_path`您的 中的最大尺寸似乎太低`my.cnf`，在此示例中

```
innodb_data_file_path = ibdata1:10M:autoextend:max:512M 
```

你不能在所有 innodb 表中托管超过 512MB 的数据。

也许您应该使用`innodb_file_per_table`.

* * *

## 回答 #2

> 赞同：91
> 
> 时间：2011-05-28T15:24:25.347

另一个可能的原因是分区已满 - 这就是我现在发生的事情。

* * *

## 回答 #3

> 赞同：27
> 
> 时间：2010-05-19T17:42:24.037

您还将收到相同的错误 ERROR 1114 (HY000): The table '#sql-310a_8867d7f' is full

如果您尝试向使用存储引擎 MEMORY 的表添加索引。

* * *

## 回答 #4

> 赞同：27
> 
> 时间：2019-06-09T23:17:13.957

DOCKER 用户：当您达到*Docker 映像大小*限制的 90% 左右时也会发生这种情况（似乎缓存需要 10% 左右）。措辞令人困惑，因为这仅仅意味着 Docker 可以用于基本上所有事情的磁盘空间量。

要修复，请转到您的 Docker 桌面设置 > 磁盘 > 将滑块向右移动一点 > 应用。

[![在此处输入图像描述](https://i.stack.imgur.com/Hf6Nj.png)](https://i.stack.imgur.com/Hf6Nj.png)

* * *

## 回答 #5

> 赞同：25
> 
> 时间：2010-03-10T16:01:59.087

您需要修改在 my.cnf 中为 INNO_DB 表设置的限制上限。此内存限制不是为单个表设置的，而是为所有组合的表设置的。

如果您希望内存自动扩展至 512MB

```
innodb_data_file_path = ibdata1:10M:autoextend:max:512M 
```

如果您不知道限制或不想设置限制上限，您可以像这样修改它

```
innodb_data_file_path = ibdata1:10M:autoextend 
```

* * *

## 回答 #6

> 赞同：13
> 
> 时间：2011-11-01T17:15:16.227

如果`tmpdir`驻留的分区已满（由于更改表或其他

* * *

## 回答 #7

> 赞同：11
> 
> 时间：2010-04-28T16:57:17.310

就我而言，这是因为托管 ibdata1 文件的分区已满。

* * *

## 回答 #8

> 赞同：10
> 
> 时间：2012-06-21T16:58:31.153

您可能在存储 mysql 表的分区（通常是 /var/lib/mysql）或存储临时表的分区（通常是 /tmp）中空间不足。

您可能想要： - 在索引创建期间监控您的可用空间。- 将 tmpdir MySQL 变量指向不同的位置。这需要重新启动服务器。

* * *

## 回答 #9

> 赞同：8
> 
> 时间：2016-08-24T05:27:40.647

我在导入 8GB sql 数据库文件时也遇到了这个错误。检查了我的mysql安装驱动器。**驱动器中没有剩余空间。**所以通过删除不需要的项目并重新运行我的数据库导入命令来获得一些空间。**这一次成功了。**

* * *

## 回答 #10

> 赞同：7
> 
> 时间：2009-04-08T15:48:03.593

除非您启用`innodb_file_per_table`选项，否则`InnoDB`将所有数据保存在一个文件中，通常称为`ibdata1`.

检查该文件的大小并检查它所在的驱动器中是否有足够的磁盘空间。

* * *

## 回答 #11

> 赞同：7
> 
> 时间：2011-12-21T14:13:15.390

如果你使用 NDBCLUSTER 作为存储引擎，你应该增加`DataMemory`和`IndexMemory`.

[Mysql 常见问题解答](http://dev.mysql.com/doc/refman/5.0/en/faqs-mysql-cluster.html#qandaitem-B-10-1-13)

* * *

## 回答 #12

> 赞同：7
> 
> 时间：2015-01-07T23:00:40.263

我们有：SQLSTATE [HY000]：一般错误：1114 表 'catalog_product_index_price_bundle_sel_tmp' 已满

通过以下方式解决：

编辑数据库的配置：

纳米 /etc/my.cnf

tmp_table_size=256M max_heap_table_size=256M

*   重启数据库

* * *

## 回答 #13

> 赞同：6
> 
> 时间：2019-01-11T09:44:47.417

在我的情况下，只是因为 mysql 服务器与一个应用程序一起运行，该应用程序写入了太多日志，磁盘已满。

您可以检查磁盘是否有足够的空间使用

```
df -h 
```

如果磁盘使用百分比为100%，可以使用该命令查找哪个目录过大

```
du -h -d 1 / 
```

* * *

## 回答 #14

> 赞同：4
> 
> 时间：2009-04-08T15:45:10.120

引用 MySQL 文档。

> InnoDB 存储引擎在可以从多个文件创建的表空间中维护 InnoDB 表。这允许表超过单个文件的最大大小。表空间可以包括原始磁盘分区，这允许非常大的表。最大表空间大小为 64TB。
> 
> 如果您正在使用 InnoDB 表并且 InnoDB 表空间中的空间不足。在这种情况下，解决方案是扩展 InnoDB 表空间。请参阅第 13.2.5 节，[“添加、删除或调整 InnoDB 数据和日志文件”。]

* * *

## 回答 #15

> 赞同：3
> 
> 时间：2021-06-17T12:33:38.007

对于那些在尝试增加任何各种内存限制时问题仍然存在的人：通过设置`internal_tmp_mem_storage_engine=MEMORY`为我解决了问题。

我在 Ubuntu 20.04.2 上，使用 MySQL 8.0.25-0ubuntu0.20.04.1。

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2016-01-26T13:11:58.890

在 CentOS 7 上，只需停止和启动 MySQL 服务即可为我解决此问题。

`sudo service mysql stop`

`sudo service mysql start`

* * *

## 回答 #17

> 赞同：2
> 
> 时间：2016-12-07T20:00:09.070

由于磁盘空间不足，我遇到了同样的问题。并且托管 ibdata1 文件的分区是 InnoDB 基础设施的系统表空间已满。

* * *

## 回答 #18

> 赞同：2
> 
> 时间：2017-07-25T13:32:05.373

我遇到了这个问题......在我的情况下，我的专用服务器上的存储空间不足。检查是否其他一切都失败了，并考虑增加磁盘空间或删除不需要的数据或文件。

* * *

## 回答 #19

> 赞同：2
> 
> 时间：2018-12-30T04:32:10.223

就我而言，我试图运行一个 alter table 命令，但可用磁盘空间小于表的大小。有一次，我增加了磁盘空间，问题就消失了。

* * *

## 回答 #20

> 赞同：2
> 
> 时间：2019-11-27T06:48:54.673

此磁盘在 /var/www/mysql 已满

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2016-01-05T18:59:23.127

在我的情况下，服务器内存已满，因此数据库无法写入临时数据。要解决它，你只需要在你的驱动器上做一些地方。

* * *

## 回答 #22

> 赞同：1
> 
> 时间：2018-11-28T15:12:09.327

我通过增加数据库所在的 vagrant VM 的可用内存量来解决这个问题。

* * *

## 回答 #23

> 赞同：-1
> 
> 时间：2010-01-29T13:42:59.163

这也可能是 InnoDB 对打开事务数的限制：

[http://bugs.mysql.com/bug.php?id=26590](http://bugs.mysql.com/bug.php?id=26590)

> 在 1024 个事务中，具有撤消记录（如编辑任何数据），InnoDB 将无法工作

# javascript - JQuery 添加 HTML 和事件

> ID：730586
> 
> 赞同：0
> 
> 时间：2009-04-08T15:42:05.557
> 
> 标签：javascript, jquery, jquery-1.3.2

我目前在 JQuery 1.3.2 中有以下内容

```
for (i = 0; i < totalPages; i++) {
   var newDiv = $("<a href=\"#\">").append(i+1).click(function() 
   { 
      alert(i+1);
   });
   $('#pageLinks').append(newDiv).append(" ");
} 
```

这会根据需要输出一个数字列表，但是单击生成的元素时的警报会返回 totalPages 值，而不是循环期间 i 的值。如何让点击事件来提醒 i 的值？

谢谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-08T15:59:39.430

试试这个

```
for (i = 0; i < totalPages; i++) {
   var newDiv = $("<a href=\"#\">").append(i+1).click(function() 
   { 
      alert(this.text);
   });
   $('#pageLinks').append(newDiv).append(" ");
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-08T16:03:24.507

此代码应该解决您的问题：

```
for (i = 0; i < totalPages; i++) {
    var newDiv = $("<a href=\"#\">")
        .append(i+1)
        .click(
            function() { 
                alert($(this).html());
            }
         );
    $('#pageLinks').append(newDiv).append(" ");
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-08T20:54:57.193

例如，如果您没有将数字的文本作为链接的一部分，我喜欢将这样的值编码到 id 中，这将为您提供：

```
<body>
<div id="pageLinks"><!-- --></div>

<script>
var totalPages = 10, newDiv;
for (i = 0; i < totalPages; i++) {
  var link = "<a href=\"#\" id=\"link-"+(i+1)+"\">"+(i+1)+"</a>";
  newDiv = $(link).click(function() {
    alert($(this).attr('id').split('-')[1]);
  });
  $('#pageLinks').append(newDiv).append(' ');
}
</script>
</body> 
```

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-04-08T16:03:56.270

这是一个范围相关的问题。您需要使用我称之为范围保护的 for 循环中的语句形成一个闭包。像这样的东西：

```
var totalPages = 10;
for (i = 0; i < totalPages; i++) {
    (function() {
        var no = i + 1;
        var newDiv = $("<a href=\"#\">").append(i+1).click(function() {
        alert(no);
    });
    $('#pageLinks').append(newDiv).append(" ");
})(); 
```

# gcc - gnu 汇编器指令的文档

> ID：730587
> 
> 赞同：8
> 
> 时间：2009-04-08T15:42:29.333
> 
> 标签：gcc, assembly, mips, directive, gnu-assembler

我现在正在尝试学习 mips 组装。为此，我写了一个非常简单的c程序......

```
int main(){} 
```

...并在 mips 机器上使用 gcc 的 -S 选项编译它以生成汇编代码。下面是 main 函数的开头部分：

```
    .ent 主要
主要的：
    .frame $fp,8,$31
    .mask 0x40000000,-8
    .fmask 0x00000000,0

```

[然后，我试图通过查看gas](http://sourceware.org/binutils/docs-2.19/as/index.html)的文档来弄清楚这一切意味着什么，但我在那里找不到任何这些指令。那么它们是什么意思呢？我在哪里可以找到更多信息？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2018-03-13T12:12:06.987

我知道我的回答有点晚了。迟到总比不到好。

当你编译一个汇编文件时，代码中可能会出现两种指令。

1.  一种是您的汇编程序支持的指令，在您的情况下，它是`GNU as`指令。

2.  另一种取决于您的汇编语言，并且因为您显然在这里使用 mips 汇编，所以`.ent`实际上是一个`mips assembly`指令。

这是您可以找到指令的[指南](http://www.cs.unibo.it/~solmi/teaching/arch_2002-2003/AssemblyLanguageProgDoc.pdf)`.ent .frame .fmask .mask`：它们都是 mips 汇编指令。或者你可以只是`Google MIPS Assembly Language Programmer’s Guide`。导航到`chapter 8, Pseudo Op-Codes`，您将获得所需的一切。

你可能想知道怎么`GNU as`能支持`mips directives`？键入`Info as`，导航到章节`Machine Dependent Features`，然后导航到子章节`MIPS-Dependent`。但是，您仍然无法在`.ent`此处找到指令，也找不到`.frame .fmask .mask`. 那是因为`info as`它不是 mips 组装指南，不能那么全面。

顺便说一句，`nasm`许多程序员都熟悉的汇编程序，有自己的指令和语法（英特尔风格），不同于`GNU as`（源自古老的 AT&T 风格）。类似地，不同的汇编语言可能有自己独特的指令（但不是语法），汇编器也可以对其进行汇编。这就是为什么两个指令源可能会出现在一个汇编文件中的原因。现在，`GNU as`汇编器甚至可以支持 Intel 语法。此外，还有一些工具可以在 AT&T 和 Intel 语法之间进行转换。但是，您应该记住指令与语法不同。坦率地说，我也对此感到困惑。

# linux - 在 Linux 文件系统中创建循环

> ID：730589
> 
> 赞同：7
> 
> 时间：2009-04-08T15:43:38.393
> 
> 标签：linux, filesystems, mount

如何在 Linux 文件系统中创建循环？我想打破 Linux 文件系统的有向无环图 (DAG) 属性。这可能吗？当我在我的 Ubuntu 上安装 Scratchbox 交叉编译器时，我曾经见过这种情况。

我现在不知道如何重现它。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-08T15:58:22.883

其他一些响应者已经回答了如何使用环回设备设置挂载，但您特别询问了`bind`挂载，这有点不同。如果要使用绑定挂载，只需`--bind`在挂载命令中指定即可。例如：

```
mount --bind /original/path /new/path 
```

这将使文件系统位置`/original/path` *可以*通过`/new/path`. 请注意，这*不会*跟随挂载点！例如，假设我有以下挂载点：

```
/something
/something/underneath/that 
```

现在假设我`bind`为`/something`：

```
mount --bind /something /new_something 
```

我将能够`/something/myfile`通过路径访问文件`/new_something/myfile`。但我将*无法*`/something/underneath/that/otherfile`通过路径访问文件`/new_something/underneath/that/otherfile`。您必须为每个文件系统设置单独`bind`的挂载；或者如果你有一个相对较新的内核，你可以使用*挂载*`rbind`，它遵循挂载点：

 *```
mount --rbind /something /new_something 
```

关于挂载的一个警告`rbind`：它们不处理在`rbind`设置后挂载文件系统的情况。也就是说，假设我有这样的坐骑：

```
/something 
```

`rbind`然后我如上所述设置我的，*然后*我安装`/something/underneath/that`：`rbind`不会神奇地使新安装通过该`rbind`位置可见。另请注意，显然由于内核中的错误，您无法卸载`rbind`挂载。

另外，以防万一您的意思是“如何使用 mount(2) 系统调用设置绑定挂载？”：当您调用常规挂载时，您必须指定`MS_BIND`标志（在 中定义）。对于挂载，您必须指定和 undocument标志（在 中定义）。`mount.h``mount(2)``bind``rbind``MS_BIND``MS_REC``linux/fs.h`

希望有帮助，

埃里克·梅尔斯基

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-08T16:10:42.243

到目前为止，看起来所有答案都是关于安装在环回设备上，而不是使用[bind mounts](http://aplawrence.com/Linux/mount_bind.html)创建循环。

你可能已经发现，

```
$ mkdir -p test/test
$ mount --bind test test/test 
```

只允许你访问`test/test/test`，没有进一步的。甚至不

```
$ mount --rbind test test/test 
```

有效，因为递归绑定挂载有效地通过查找源上现有的挂载并将它们绑定到目标中。

您所要求的是不可能的，因为绑定安装不会跨越安装点。[如果您真的想模拟文件系统循环，请尝试使用类似localfs](http://freesoft.portonvictor.org/virtual-filesystems.xml)的伪绑定挂载。我自己没有尝试过，尝试读取自己提供的文件系统时可能会锁定。刚才，我尝试导出一个 NFS 树`crossmnt`并将其安装在它自己的下面，但由于类似的原因失败了。

* * *

## 回答 #3

> 赞同：-2
> 
> 时间：2009-04-08T15:48:32.203

```
mount /path/to/device /path/to/mount/location -o loop 
```

其中 /path/to/device 是要挂载的分区的路径或磁盘映像的路径，/path/to/mount/location 是要挂载设备/映像的文件夹的路径在下面

您可能还需要像这样包含文件系统的类型（使用 fat16/fat32）：

```
mount /path/to/device /path/to/mount/location -o loop -t vfat 
```

* * *

## 回答 #4

> 赞同：-2
> 
> 时间：2009-04-08T17:48:07.517

您可能还想从头开始创建一个：

首先创建镜像文件并初始化

```
dd if=/dev/zero of=/tmp/loop.img bs=1024k count=$IMG_SIZE 
```

接下来，使用您选择的 FS 类型使其成为有效分区

```
mkfs.ext3 -F /tmp/loop.img 
```

挂载你的新镜像

```
mkdir -p /mnt/image
mount /tmp/loop.img /mnt/image -o loop 
```

您现在可以在新映像中创建/复制文件和目录。

# wcf - 如何使用 wcf 数据源创建 ssrs 报告？

> ID：730592
> 
> 赞同：1
> 
> 时间：2009-04-08T15:44:10.310
> 
> 标签：wcf, reporting-services

我正在尝试使用 wcf 服务作为数据源来创建报告。唯一确定的信息来源是一个[博客条目](http://weblogs.asp.net/jezell/archive/2008/02/21/using-wcf-endpoints-with-sql-reporting-services.aspx)，我发现它似乎不像宣传的那样工作，可能是因为我使用的是 MSSQL 2008 而不是 2005。

有可能吗？如果有，人们是怎么做的？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-08T21:09:50.777

我也遇到了问题，你必须确保你的端点使用的是 basicHttpBinding：

```
 <endpoint address="basic"
              binding="basicHttpBinding"
              bindingConfiguration="Secure"
              contract="IServiceContract"> 
```

数据源中的 url：

```
http://machinename/Service.svc/basic 
```

和查询：

```
<Query><Method Namespace="schemas.xyz.com Name="MethodName" /><SoapAction>schemas.xyz.com/IServiceContract/MethodName</SoapAction></Query> 
```

# .net - FOSS 智能字符识别 (ICR)

> ID：730594
> 
> 赞同：6
> 
> 时间：2009-04-08T15:44:47.690
> 
> 标签：.net, open-source, ocr, handwriting, icr

有人知道开源智能字符识别（ICR）库吗？OCR 似乎有很多，但我专注于识别笔迹，如果有开源解决方案，我会喜欢它。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2010-08-03T22:34:43.490

OCRopus 目前似乎还没有准备好 ICR。来自 2009 年 12 月 18 日的 OCRopus 开发者论坛消息。

> 几乎所有用于手写识别的旧代码都在那里，现在可以从 Python 访问；编写手写识别器脚本应该相当容易。然而，让它表现良好需要大量的训练和调整，以及仔细的语言建模。根据手写材料的性质，可能还需要集成额外的识别器（HMM、卷积网络）。

我一直在寻找和你完全一样的东西。然而，这（以及其他类似的评论）足以让我相信，要让 OCRopus 为黄金时段的 ICR 做好准备，还需要做大量的工作。我现在完全不能把它推荐给我的客户。

另外，我发现 OCRopus 已经一年多没有发布新版本了。很难让人放心。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-08T15:56:16.787

[OCRopus](http://code.google.com/p/ocropus/)声称可以进行手写识别。它在 Apache 许可证 2.0 下可用。

# c++ - 帮助使用 OSSpinLock* 替换 while(true) {sleep(1);}

> ID：730603
> 
> 赞同：0
> 
> 时间：2009-04-08T15:45:42.773
> 
> 标签：c++, macos, macos-carbon

我在 OS X 上维护一个碳 C++ 应用程序。代码中的一个对象中有一个“自旋锁”，如下所示，

```
while ( mState != RELEASED )
{
    sleep( 1 );
} 
```

有一个提供给 AudioUnitAddRenderNotify() 的渲染后维护回调，它将设置这些不同对象的 mState。

我正在考虑使用内置的 OSSpinLock 系列函数来替换它（如果没有别的，因为它们是线程安全的，而且上面的代码似乎不是）。

这是一个合理的等价物吗？我是否还应该在操作这些对象的 mState 的维护线程中添加一些锁定保护？

```
OSSpinLock spin_lock = OS_SPINLOCK_INIT;

if (!OSSpinLockTry(&spin_lock))
    OSSpinLockLock(&spin_lock);

while (mState != RELEASED)
    OSSpinLockTry(&spin_lock);

OSSpinLockUnlock(&spin_lock); 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-08T15:58:06.080

不要使用自旋锁——自旋锁会浪费 CPU 周期，无休止地循环直到获得锁。只有当持有锁的时间非常短时，才应该使用自旋锁。

更好的选择是使用[条件变量](http://en.wikipedia.org/wiki/Condition_variable)，例如[pthreads](https://computing.llnl.gov/tutorials/pthreads/#ConditionVariables)库中可用的条件变量。这样，在满足条件之前，您的线程将休眠并且不会浪费任何 CPU 周期。有关如何使用 pthreads 条件变量的信息，请参阅该链接中列出的示例。

# javascript - 无法通过 Javascript 获得没有过时的 Java API

> ID：730605
> 
> 赞同：-1
> 
> 时间：2009-04-08T15:46:40.353
> 
> 标签：javascript, java

我经常观察 Java API 中过时的类和方法。

我没有找到没有过时的 Java API。它建议我您需要通过浏览器过滤 Java API 以使其更具可读性。Javascript 显然是过滤 Java API 的一个很好的解决方案。

**如何通过 Javascript 或其他方法获得没有 Obseletes 的 Java API？**

[在第一个答案后编辑]

我将 javadocs 下载到文件夹 docs。我跑

```
javadoc -nodeprecatedlist docs/ 
```

我得到错误

```
javadoc: error - Illegal package name: "docs/"
1 error 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-08T16:10:27.377

您可以使用 -nodeprecated 选项从源代码重新生成 javadoc

# asp.net - 下载的 CSS 中出现意外的前导字符

> ID：730612
> 
> 赞同：0
> 
> 时间：2009-04-08T15:47:56.027
> 
> 标签：asp.net, css

我正在开发一个 ASP.Net Web 应用程序。

我的一些用户的浏览器正在呈现未设置样式的页面（即，样式表似乎没有被使用）。

当我从这些用户的浏览器之一浏览到 css 文件时，我看到了意想不到的前导字符。

以下示例来自使用 IE7 的用户（我也在使用 IE7，但我没有遇到此问题）...

```
Ã¯Â»Â¿@import url("aa.reset.css"); @import url("aa.core.css"); @import url("aa.header.css"); @import url("aa.middle.css"); @import url("aa.footer.css"); @import url("aa.misc.css"); @import url("Pager.css"); 
```

我怀疑字符“Ã¯Â»Â¿”可能是我问题的根源。

当我从我的机器浏览时，我看到

```
@import url("aa.reset.css");
@import url("aa.core.css");
@import url("aa.header.css");
@import url("aa.middle.css");
@import url("aa.footer.css");
@import url("aa.misc.css");
@import url("Pager.css"); 
```

有什么想法吗？

谢谢

沙

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-08T16:03:35.100

您是否将此文件保存为 UTF8？检查您的编辑器，看看它是否有一个选项可以在没有[BOM的情况下另存为 UTF8](http://en.wikipedia.org/wiki/Byte-order_mark)

# pdf - PDF文档操作

> ID：730613
> 
> 赞同：1
> 
> 时间：2009-04-08T15:47:58.570
> 
> 标签：pdf, pdf-manipulation

我有几个具有以下属性的 PDF：

每个 PDF 包含可变数量的“文档”，其页数不同。

“文档”中的每一页都有文本，例如“第 3 页，共 26 页”。

我希望能够自动识别 PDF 中每个“文档”的第一页和最后一页（注意：这与 PDF 的第一页和最后一页不同，因为每个 PDF 可能包含多个“文档”）并提取将它们转换成一个新的 PDF 文件供以后打印和存档。

我不确定我可以使用哪些工具来解决这个问题，以及有哪些库可以解决这个问题。

有什么建议吗？最好是免费的，可用于创建将在 Windows 上运行的工具。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-08T16:47:23.763

Java 有一个不错的免费 pdf 库。查看[iText](http://www.lowagie.com/iText/)。

从 iText 的网站：

您可以使用 iText 来：

*   将 PDF 提供给浏览器
*   从 XML 文件或数据库生成动态文档
*   使用 PDF 的许多交互功能
*   添加书签、页码、水印等。
*   **拆分、连接和操作 PDF 页面**
*   自动填写 PDF 表单
*   将数字签名添加到 PDF 文件
*   以及更多...

由于它是 Java，因此在 Windows 或其他任何地方运行应该没有问题。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-08T15:53:02.800

您可以尝试使用[pdftk](http://www.pdfhacks.com/pdftk/)对 PDF 进行解压缩，解析数据，拆分，然后重新压缩。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-08T16:40:02.923

我设法想出了一个可行的可怕的 unix hack：

*   使用pdftk解压并分解成单独的页面
*   使用 pdftotext 将每一页转换为文本
*   编写脚本识别txt中的相应字符串并将对应的pdf复制到子目录中[进行中]
*   找一些工具重新组合【待查，pdftk可能可以做】

应该可以在我的 unix 平台上工作，但不确定将所有这些工具带入 windows 环境是否可以接受。

一种可能性是使用电子邮件网关来接收 pdf 并返回处理后的 pdf，这使得它更加丑陋。

有本机win32解决方案的人吗？

# asp.net - 动态更改文本框上验证器的类型

> ID：730615
> 
> 赞同：0
> 
> 时间：2009-04-08T15:48:08.710
> 
> 标签：asp.net, validation, textbox

```
<asp:DropDownList ID="ddl1" runat="server">
    <asp:ListItem Text="First" Value="1"></asp:ListItem>
    <asp:ListItem Text="Second" Value="2"></asp:ListItem>
</asp:DropDownList>

<asp:TextBox ID="tb1" runat="server"/>

<asp:Button ID="btn1" text="Go!" OnClick="btn1_Click" runat="server" />

public void btn1_Click(object sender, EventArgs e)
{

} 
```

如果用户选择带有文本“First”的下拉菜单，则文本框中的数据必须是数字。如果他们选择“第二”，则只能是字母。

如何动态创建验证控件并更改其行为？

我尝试创建验证对象，将控件设置为对文本框进行验证，并在 btn1_click 事件中调用其 Validate 方法，但它不起作用。

**更新**

这是我尝试过的代码：

```
public void btn1_Click(object sender, EventArgs e)
    {
        RequiredFieldValidator rfv1 = new RequiredFieldValidator();

        rfv1.ID = "rfv1";
        rfv1.ControlToValidate = tb1.ID;
        rfv1.Text = "please enter a value for tb1";

        rfv1.Validate();

        Response.Write("<br>Page.IsValid: " + Page.IsValid);

    } 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-08T15:57:26.270

*   **选项 1：**
    将两个验证器添加到文本框中，并根据用户选择将它们设置为启用/禁用。

*   **选项 2：**
    使用将下拉列表考虑在内的自定义验证器（并可能将其全部包装到自定义控件中）。

其中，我认为我更喜欢选项 1，但我必须尝试一下，看看它在浏览器中的实际效果如何（在 javascript 中交换启用的验证器有多容易或是否可能）。

您不想动态添加/删除验证器，因为这必须在服务器端完成，这意味着当用户更改下拉列表选择以设置正确的验证器时*，*您可以验证文本框。我建议的两个解决方案都避免了这种情况。

# iphone - iPhone：通过 Windows 在 iphone 上测试应用程序

> ID：730617
> 
> 赞同：1
> 
> 时间：2009-04-08T15:48:19.990
> 
> 标签：iphone, cocoa-touch

我参加了 iPhone 开发者计划。我可以在 iPhone 上通过 Mac 调试我的应用程序。由于某些原因，我需要能够在另一部使用 Windows 的 iPhone 上测试相同的应用程序。有没有办法做到这一点？如何从 Windows 部署应用程序？任何指针将不胜感激。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-08T16:44:10.120

您可以将配置文件和应用程序包拖到 iTunes 中并同步。这就是您可以分发测试版的方式。

请注意，手机必须在开发者计划门户中注册（UDID）。

# data-structures - 哈希表是如何工作的？

> ID：730620
> 
> 赞同：520
> 
> 时间：2009-04-08T15:48:59.690
> 
> 标签：data-structures, hash, hashtable, modulo

我正在寻找关于哈希表如何工作的解释 - 对于像我这样的傻瓜来说，用简单的英语！

例如，我知道它需要密钥，计算哈希（我正在寻找解释如何），然后执行某种模来计算它在存储值的数组中的位置，但这就是我的知识停止的地方.

有人可以澄清这个过程吗？

**编辑：**我不是专门询问如何计算哈希码，而是对哈希表如何工作的一般概述。

* * *

## 回答 #1

> 赞同：946
> 
> 时间：2009-04-08T16:33:02.970

Here's an explanation in layman's terms.

Let's assume you want to fill up a library with books and not just stuff them in there, but you want to be able to easily find them again when you need them.

So, you decide that if the person that wants to read a book knows the title of the book and the exact title to boot, then that's all it should take. With the title, the person, with the aid of the librarian, should be able to find the book easily and quickly.

So, how can you do that? Well, obviously you can keep some kind of list of where you put each book, but then you have the same problem as searching the library, you need to search the list. Granted, the list would be smaller and easier to search, but still you don't want to search sequentially from one end of the library (or list) to the other.

You want something that, with the title of the book, can give you the right spot at once, so all you have to do is just stroll over to the right shelf, and pick up the book.

But how can that be done? Well, with a bit of forethought when you fill up the library and a lot of work when you fill up the library.

Instead of just starting to fill up the library from one end to the other, you devise a clever little method. You take the title of the book, run it through a small computer program, which spits out a shelf number and a slot number on that shelf. This is where you place the book.

The beauty of this program is that later on, when a person comes back in to read the book, you feed the title through the program once more, and get back the same shelf number and slot number that you were originally given, and this is where the book is located.

The program, as others have already mentioned, is called a hash algorithm or hash computation and usually works by taking the data fed into it (the title of the book in this case) and calculates a number from it.

For simplicity, let's say that it just converts each letter and symbol into a number and sums them all up. In reality, it's a lot more complicated than that, but let's leave it at that for now.

The beauty of such an algorithm is that if you feed the same input into it again and again, it will keep spitting out the same number each time.

Ok, so that's basically how a hash table works.

Technical stuff follows.

First, there's the size of the number. Usually, the output of such a hash algorithm is inside a range of some large number, typically much larger than the space you have in your table. For instance, let's say that we have room for exactly one million books in the library. The output of the hash calculation could be in the range of 0 to one billion which is a lot higher.

So, what do we do? We use something called modulus calculation, which basically says that if you counted to the number you wanted (i.e. the one billion number) but wanted to stay inside a much smaller range, each time you hit the limit of that smaller range you started back at 0, but you have to keep track of how far in the big sequence you've come.

Say that the output of the hash algorithm is in the range of 0 to 20 and you get the value 17 from a particular title. If the size of the library is only 7 books, you count 1, 2, 3, 4, 5, 6, and when you get to 7, you start back at 0\. Since we need to count 17 times, we have 1, 2, 3, 4, 5, 6, 0, 1, 2, 3, 4, 5, 6, 0, 1, 2, 3, and the final number is 3.

Of course modulus calculation isn't done like that, it's done with division and a remainder. The remainder of dividing 17 by 7 is 3 (7 goes 2 times into 17 at 14 and the difference between 17 and 14 is 3).

Thus, you put the book in slot number 3.

This leads to the next problem. Collisions. Since the algorithm has no way to space out the books so that they fill the library exactly (or the hash table if you will), it will invariably end up calculating a number that has been used before. In the library sense, when you get to the shelf and the slot number you wish to put a book in, there's already a book there.

Various collision handling methods exist, including running the data into yet another calculation to get another spot in the table ([double hashing](https://en.wikipedia.org/wiki/Double_hashing)), or simply to find a space close to the one you were given (i.e. right next to the previous book assuming the slot was available also known as [linear probing](https://en.wikipedia.org/wiki/Linear_probing)). This would mean that you have some digging to do when you try to find the book later, but it's still better than simply starting at one end of the library.

Finally, at some point, you might want to put more books into the library than the library allows. In other words, you need to build a bigger library. Since the exact spot in the library was calculated using the exact and current size of the library, it goes to follow that if you resize the library you might end up having to find new spots for all the books since the calculation done to find their spots has changed.

I hope this explanation was a bit more down to earth than buckets and functions :)

* * *

## 回答 #2

> 赞同：106
> 
> 时间：2009-04-08T17:20:00.597

用法和行话：

1.  **哈希表**用于快速存储和检索数据（或记录）。
2.  记录使用**哈希键存储在****存储桶中**
***   **哈希键**是通过将哈希算法应用于记录中包含的选定值（**键值**）来计算的。这个选择的值必须是所有记录的公共值。*   每个**存储桶**可以有多个按特定顺序组织的记录。**

 **现实世界的例子：

**Hash & Co.**成立于 1803 年，缺乏任何计算机技术，共有 300 个文件柜来保存大约 30,000 名客户的详细信息（记录）。每个文件夹都清楚地标有其客户编号，从 0 到 29,999 的唯一编号。

当时的备案文员不得不为工作人员快速获取和存储客户记录。工作人员决定使用散列方法来存储和检索他们的记录会更有效。

为了归档客户记录，归档文员将使用写在文件夹上的唯一客户编号。使用这个客户编号，他们将**散列键**调制300 以识别它所在的文件柜。当他们打开文件柜时，他们会发现它包含许多按客户编号排序的文件夹。在确定了正确的位置后，他们就会简单地把它塞进去。

为了检索客户记录，归档文员将在纸条上获得客户编号。使用这个唯一的客户编号（**哈希键**），他们会将其调整 300 以确定哪个文件柜有客户文件夹。当他们打开文件柜时，他们会发现里面有许多按客户编号排序的文件夹。通过搜索记录，他们会很快找到客户文件夹并检索它。

在我们的真实示例中，我们的**存储桶**是**文件柜**，我们的**记录**是**文件夹**。

* * *

要记住的重要一点是，计算机（及其算法）处理数字比处理字符串更好。因此，使用索引访问大型数组比顺序访问要快得多。

**正如西蒙所提到**的，我认为**非常重要**的是散列部分是转换一个大空间（任意长度，通常是字符串等）并将其映射到一个小空间（已知大小，通常是数字）以进行索引。记住这一点很重要！

所以在上面的例子中，大约 30,000 个可能的客户端被映射到一个更小的空间。

* * *

这样做的主要思想是将整个数据集划分为多个部分，以加快通常耗时的实际搜索。在我们上面的示例中，300 个文件柜中的每一个都将（从统计上）包含大约 100 条记录。搜索 100 条记录（无论顺序如何）比处理 30,000 条记录要快得多。

您可能已经注意到有些人实际上已经这样做了。但是，在大多数情况下，他们不会设计散列方法来生成散列密钥，而是简单地使用姓氏的第一个字母。因此，如果您有 26 个文件柜，每个文件柜都包含一个从 A 到 Z 的字母，那么理论上您只是对数据进行了分段并增强了归档和检索过程。

希望这可以帮助，

杰奇！

* * *

## 回答 #3

> 赞同：66
> 
> 时间：2009-04-08T16:11:34.037

事实证明这是一个相当深的理论领域，但基本轮廓很简单。

从本质上讲，散列函数只是一个从一个空间（比如任意长度的字符串）获取事物并将它们映射到对索引有用的空间（比如无符号整数）的函数。

如果您只有一小部分要散列的东西，您可能只需将这些东西解释为整数就可以了，您就完成了（例如 4 字节字符串）

但是，通常情况下，您的空间要大得多。如果您允许作为键的事物空间大于您用于索引的事物空间（您的 uint32 或其他），那么您不可能为每个事物设置唯一值。当两个或更多事物哈希到相同的结果时，您必须以适当的方式处理冗余（这通常称为冲突，您如何处理它或不处理它取决于您是什么使用哈希）。

这意味着您希望它不太可能具有相同的结果，并且您可能还真的希望散列函数更快。

平衡这两个属性（以及其他一些属性）让许多人忙得不可开交！

在实践中，您通常应该能够找到一个已知适用于您的应用程序的函数并使用它。

现在让它作为一个哈希表工作：想象一下你不关心内存使用情况。然后，您可以创建一个数组，只要您的索引集（例如，所有 uint32）。当你向表中添加一些东西时，你对它的键进行散列并查看该索引处的数组。如果那里什么都没有，你就把你的价值放在那里。如果那里已经有东西了，你把这个新条目添加到那个地址的东西列表中，连同足够的信息（你的原始密钥，或者一些聪明的东西）来找到哪个条目实际上属于哪个密钥。

所以当你走很长的路时，你的哈希表（数组）中的每个条目要么是空的，要么包含一个条目，或者一个条目列表。检索很简单，例如对数组进行索引，然后返回值，或者遍历值列表并返回正确的值。

当然在实践中你通常不能这样做，它浪费了太多的内存。因此，您基于稀疏数组执行所有操作（其中唯一的条目是您实际使用的条目，其他所有内容都隐含为空）。

有很多计划和技巧可以使这项工作更好，但这是基础。

* * *

## 回答 #4

> 赞同：59
> 
> 时间：2015-06-01T06:59:40.700

很多答案，但没有一个是非常*直观*的，并且哈希表在可视化时可以轻松“点击”。

哈希表通常实现为链表数组。如果我们想象一个存储人名的表，在几次插入之后，它可能会在内存中排列如下，其中`()`- 封闭的数字是文本/名称的哈希值。

```
bucket#  bucket content / linked list

[0]      --> "sue"(780) --> null
[1]      null
[2]      --> "fred"(42) --> "bill"(9282) --> "jane"(42) --> null
[3]      --> "mary"(73) --> null
[4]      null
[5]      --> "masayuki"(75) --> "sarwar"(105) --> null
[6]      --> "margaret"(2626) --> null
[7]      null
[8]      --> "bob"(308) --> null
[9]      null 
```

几点：

*   每个数组条目（索引`[0]`，`[1]`...）都称为***存储桶***，并开始一个 - 可能为空 - 链表的*值*（又名*元素*，在本例中 -*人名*）
*   每个值（例如`"fred"`带有 hash `42`）都从桶链接，`[hash % number_of_buckets]`例如`42 % 10 == [2]`；`%`是[*模运算符*](https://en.wikipedia.org/wiki/Modulo_operation)- 除以桶数时的余数
*   多个数据值可能会在同一个存储桶上***发生冲突***并相互链接，这通常是因为它们的哈希值在模运算之后发生冲突（例如`42 % 10 == [2]`，和`9282 % 10 == [2]`），但偶尔因为哈希值相同（例如`"fred"`，`"jane"`两者都显示为`42`上面的哈希）
    *   大多数哈希表通过将正在查找或插入的值的完整值（此处为文本）与哈希存储桶的链接列表中的每个值进行比较来处理冲突 - 性能略有降低但没有功能混淆

### 链表长度与负载因子有关，而不是值的数量

如果表大小增加，如上实现的哈希表倾向于调整自身大小（即创建更大的存储桶数组，从中创建新/更新的链表，删除旧数组）以保持值与存储桶的比率（也称为***负载因子***）在 0.5 到 1.0 范围内的某个位置。

Hans 在下面的评论中给出了其他负载因子的实际公式，但对于指示性值：使用负载因子 1 和加密强度哈希函数，1/e (~36.8%) 的桶往往是空的，另外 1/e (~36.8%) 有一种元素，1/(2e) 或~18.4% 两种元素，1/(3!e) 约 6.1% 三种元素，1/(4!e) 或~1.5% 四种元素，1/ (5!e) ~.3% 有五个等.. - 无论表中有多少元素（即是否有 100 个元素和 100 个桶，或 1 亿个），非空桶的平均链长度为 ~1.58元素和 1 亿个桶），这就是为什么我们说查找/插入/擦除是[*O* (1) 个](https://en.wikipedia.org/wiki/Time_complexity)恒定时间操作。

### 哈希表如何将键与值关联起来

给定如上所述的哈希表实现，我们可以想象创建一个值类型，例如 `struct Value { string name; 年龄; };`，以及仅查看 `name` 字段（忽略年龄）的相等比较和哈希函数，然后发生了一些奇妙的事情：我们可以在表中存储 `Value` 记录，例如 `{"sue", 63}` ，然后在不知道她年龄的情况下搜索“sue”，找到存储的值并恢复甚至更新她的年龄 - 生日快乐 Sue - 有趣的是，它不会更改哈希值，因此不需要我们将 Sue 的记录移动到另一个桶。

当我们这样做时，我们使用哈希表作为[*关联容器*又名*map*](https://en.wikipedia.org/wiki/Associative_array)，它存储的值可以被认为由一个*键*（名称）和一个或多个其他字段组成 - 令人困惑的是 -*值*（在我的例子中，只是年龄）。用作映射的哈希表实现称为*哈希映射*。

这与此答案前面的示例形成对比，在该示例中，我们存储了诸如“sue”之类的离散值，您可以将其视为它自己的键：这种用法称为*哈希集*。

### 还有其他实现哈希表的方法

并非所有哈希表都使用链表（称为[*单独链接*](https://en.wikipedia.org/wiki/Hash_table#Separate_chaining_with_linked_lists)），但大多数通用哈希表都使用链表，因为主要替代[*封闭哈希*（也称为*开放寻址*）](https://en.wikipedia.org/wiki/Open_addressing) - 特别是支持擦除操作 - 具有更不稳定的性能属性与易发生冲突的键/哈希函数。

* * *

# 关于散列函数的几句话

### 强哈希...

一个通用的、最坏情况冲突最小化散列函数的工作是随机有效地将键喷洒在散列表桶周围，同时始终为相同的键生成相同的散列值。理想情况下，即使密钥中任何位置的一位更改 - 随机 - 翻转结果哈希值中大约一半的位。

这通常与数学太复杂，我无法理解。我将提到一种易于理解的方式 - 不是最可扩展的或缓存友好的，但本质上是优雅的（例如使用一次性填充的加密！） - 因为我认为它有助于将上述理想品质带回家。假设您正在散列 64 位`double`s - 您可以创建 8 个表，每个表有 256 个随机数（代码如下），然后使用 的内存表示的每个 8 位/1 字节切片`double`来索引到不同的表，异或您查找的随机数。使用这种方法，很容易看到（在二进制数字意义上）在`double`结果中的任何位置发生变化会导致在其中一个表中查找不同的随机数，以及完全不相关的最终值。

```
// note caveats above: cache unfriendly (SLOW) but strong hashing...
std::size_t random[8][256] = { ...random data... };
auto p = (const std::byte*)&my_double;
size_t hash = random[0][p[0]] ^
              random[1][p[1]] ^
              ... ^
              random[7][p[7]]; 
```

### 弱但经常快速的哈希...

许多库的散列函数通过不变传递整数（称为*平凡*或***恒***等散列函数）；这是上述强散列的另一个极端。身份哈希*非常*在最坏的情况下容易发生冲突，但希望是在相当常见的整数键趋于递增（可能有一些间隙）的情况下，它们将映射到连续的桶中，留下比随机散列叶更少的空（我们的 ~36.8 % 在前面提到的负载因子 1），因此与随机映射相比，具有更少的冲突和更少的更长的冲突元素链接列表。节省生成强哈希所需的时间也很棒，如果按顺序查找键，它们将在内存附近的存储桶中找到，从而提高缓存命中率。当密钥*不能*很好地增加时，希望它们足够随机，它们不需要强大的哈希函数来完全随机地将它们放置到桶中。

* * *

## 回答 #5

> 赞同：24
> 
> 时间：2010-05-15T01:41:55.740

你们非常接近完全解释这一点，但缺少一些东西。哈希表只是一个数组。数组本身将在每个插槽中包含一些东西。至少，您将在此插槽中存储散列值或值本身。除此之外，您还可以存储在此插槽上发生冲突的值的链接/链式列表，或者您可以使用开放寻址方法。您还可以存储一个或多个指向要从此插槽中检索的其他数据的指针。

需要注意的是，哈希值本身通常不指示放置值的槽。例如，哈希值可能是负整数值。显然负数不能指向数组位置。此外，哈希值往往比可用槽数大很多倍。因此哈希表本身需要执行另一个计算来确定值应该进入哪个槽。这是通过模数数学运算完成的，例如：

```
uint slotIndex = hashValue % hashTableSize; 
```

该值是该值将进入的槽。在开放寻址中，如果槽已经被另一个哈希值和/或其他数据填充，则将再次运行模运算以找到下一个槽：

```
slotIndex = (remainder + 1) % hashTableSize; 
```

我想可能还有其他更高级的方法来确定槽索引，但这是我见过的常见方法……会对其他性能更好的方法感兴趣。

使用模数方法，如果您有一个大小为 1000 的表，则任何介于 1 和 1000 之间的哈希值都将进入相应的插槽。任何负值和任何大于 1000 的值都可能是冲突槽值。发生这种情况的机会取决于您的散列方法，以及您添加到散列表中的总项目数。通常，最佳做法是使散列表的大小使得添加到其中的值的总数仅等于其大小的大约 70%。如果您的哈希函数在均匀分布方面做得很好，您通常会遇到很少甚至没有桶/槽冲突，并且它会非常快速地执行查找和写入操作。如果事先不知道要添加的值的总数，请使用任何方法进行良好的猜测，

我希望这有帮助。

PS - 在 C# 中，该`GetHashCode()`方法非常慢，并且在我测试过的许多条件下会导致实际值冲突。为了获得真正的乐趣，构建自己的哈希函数并尝试让它永远不会与您正在哈希的特定数据发生冲突，运行速度比 GetHashCode 快，并且分布相当均匀。我已经使用 long 而不是 int 大小的哈希码值完成了这项工作，并且它在哈希表中多达 3200 万个整数哈希值上运行良好，并且冲突为 0。不幸的是，我无法共享代码，因为它属于我的雇主……但我可以透露某些数据域是可能的。当你能做到这一点时，哈希表会非常快。:)

* * *

## 回答 #6

> 赞同：19
> 
> 时间：2009-04-08T16:02:32.933

在我的理解中，它是这样工作的：

这是一个示例：将整个表想象为一系列桶。假设您有一个带有字母数字哈希码的实现，并且每个字母都有一个存储桶。此实现将哈希码以特定字母开头的每个项目放入相应的存储桶中。

假设您有 200 个对象，但其中只有 15 个具有以字母“B”开头的哈希码。哈希表只需要查找和搜索“B”桶中的 15 个对象，而不是所有 200 个对象。

就计算哈希码而言，它没有什么神奇之处。目标只是让不同的对象返回不同的代码，并让相同的对象返回相同的代码。您可以编写一个始终返回与所有实例的哈希码相同的整数的类，但您实际上会破坏哈希表的有用性，因为它只会变成一个巨大的桶。

* * *

## 回答 #7

> 赞同：13
> 
> 时间：2009-04-08T17:24:48.323

简短而甜蜜：

哈希表包装了一个数组，我们称之为`internalArray`。项目以这种方式插入到数组中：

```
let insert key value =
    internalArray[hash(key) % internalArray.Length] <- (key, value)
    //oversimplified for educational purposes 
```

有时两个键会散列到数组中的相同索引，并且您希望保留这两个值。我喜欢将这两个值存储在同一个索引中，通过创建`internalArray`一个链表数组来编写代码很简单：

```
let insert key value =
    internalArray[hash(key) % internalArray.Length].AddLast(key, value) 
```

所以，如果我想从我的哈希表中检索一个项目，我可以这样写：

```
let get key =
    let linkedList = internalArray[hash(key) % internalArray.Length]
    for (testKey, value) in linkedList
        if (testKey = key) then return value
    return null 
```

删除操作与编写一样简单。如您所知，从我们的链表数组中插入、查找和删除*几乎*是O(1)。

当我们的 internalArray 太满时，可能在 85% 左右的容量，我们可以调整内部数组的大小并将所有项目从旧数组移动到新数组中。

* * *

## 回答 #8

> 赞同：12
> 
> 时间：2009-04-08T16:04:43.383

它甚至比这更简单。

哈希表只不过是包含键/值对的向量数组（通常是[稀疏数组）。](http://en.wikipedia.org/wiki/Sparse_array)此数组的最大大小通常小于存储在哈希表中的数据类型的可能值集中的项目数。

哈希算法用于根据将存储在数组中的项目的值生成该数组的索引。

这是在数组中存储键/值对向量的地方。由于可以作为数组中索引的值集通常小于该类型可以具有的所有可能值的数量，因此您的哈希值可能算法将为两个单独的键生成相同的值。一个*好的*散列算法会尽可能地防止这种情况（这就是为什么它通常被归为类型，因为它具有一般散列算法不可能知道的特定信息），但这是不可能防止的。

因此，您可以拥有多个生成相同哈希码的密钥。发生这种情况时，将遍历向量中的项目，并在向量中的键和正在查找的键之间进行直接比较。如果找到，则返回与该键关联的值，否则不返回任何内容。

* * *

## 回答 #9

> 赞同：11
> 
> 时间：2009-04-08T16:22:54.803

You take a bunch of things, and an array.

For each thing, you make up an index for it, called a hash. The important thing about the hash is that it 'scatter' a lot; you don't want two similar things to have similar hashes.

You put your things into the array at position indicated by the hash. More than one thing can wind up at a given hash, so you store the things in arrays or something else appropriate, which we generally call a bucket.

When you're looking things up in the hash, you go through the same steps, figuring out the hash value, then seeing what's in the bucket at that location and checking whether it's what you're looking for.

When your hashing is working well and your array is big enough, there will only be a few things at most at any particular index in the array, so you won't have to look at very much.

For bonus points, make it so that when your hash table is accessed, it moves the thing found (if any) to the beginning of the bucket, so next time it's the first thing checked.

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2009-04-08T16:41:10.423

到目前为止，所有答案都很好，并且涉及哈希表如何工作的不同方面。这是一个可能有帮助的简单示例。假设我们想要存储一些带有小写字母字符串的项目作为键。

正如 simon 所解释的，散列函数用于从大空间映射到小空间。对于我们的示例，哈希函数的一个简单、朴素的实现可以获取字符串的第一个字母，并将其映射到一个整数，因此“alligator”的哈希码为 0，“bee”的哈希码为 1，“斑马”将是 25 等。

接下来我们有一个由 26 个桶组成的数组（在 Java 中可能是 ArrayLists），我们将项目放入与我们的键的哈希码匹配的桶中。如果我们有多个项目的键以相同的字母开头，它们将具有相同的哈希码，因此所有项目都将进入该哈希码的桶中，因此必须在桶中进行线性搜索以找到一个特定的项目。

在我们的示例中，如果我们只有几十个项目的键跨越字母表，它会很好地工作。但是，如果我们有一百万个项目或所有键都以“a”或“b”开头，那么我们的哈希表将不理想。为了获得更好的性能，我们需要一个不同的哈希函数和/或更多的桶。

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2009-04-08T17:44:33.953

这是另一种看待它的方式。

我假设您了解数组 A 的概念。它支持索引操作，无论 A 有多大，您都可以一步到达第 I 个元素 A[I]。

因此，例如，如果你想存储一组碰巧有不同年龄的人的信息，一个简单的方法是有一个足够大的数组，并使用每个人的年龄作为数组的索引。通过这种方式，您可以一步访问任何人的信息。

但是当然可能有不止一个人具有相同的年龄，因此您在每个条目中放入的数组是所有具有该年龄的人的列表。因此，您可以通过一个步骤以及在该列表（称为“存储桶”）中的一点点搜索来获取个人信息。只有当人太多以至于水桶变大时，它才会放慢速度。然后你需要一个更大的数组，以及其他一些方法来获取更多关于这个人的识别信息，比如他们姓氏的前几个字母，而不是使用年龄。

这是基本的想法。可以使用产生良好传播价值的人的任何功能，而不是使用年龄。这就是哈希函数。就像您可以将人名的 ASCII 表示的每三分之一位按某种顺序打乱一样。重要的是你不希望太多人散列到同一个桶，因为速度取决于桶保持小。

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2015-06-12T05:19:45.807

哈希表完全适用于实际计算遵循随机访问机器模型的事实，即内存中任何地址的值都可以在 O(1) 时间或恒定时间内访问。

所以，如果我有一个键域（我可以在应用程序中使用的所有可能键的集合，例如学生的卷号，如果它是 4 位数字，那么这个域是一组从 1 到 9999 的数字），以及将它们映射到一组有限大小的方法我可以在我的系统中分配内存，理论上我的哈希表已经准备好了。

通常，在应用程序中，键的大小比我想添加到哈希表中的元素数量要大（我不想浪费 1 GB 内存来散列，比如 10000 或 100000 个整数值，因为它们是 32二进制表示中的位长）。所以，我们使用这种散列。这是一种混合的“数学”运算，它将我的大宇宙映射到我可以在内存中容纳的一小组值。在实际情况下，哈希表的空间通常与（元素数*每个元素的大小）具有相同的“顺序”（big-O），因此，我们不会浪费太多内存。

现在，一个大集合映射到一个小集合，映射必须是多对一的。因此，不同的键将被分配相同的空间（？？不公平）。有几种方法可以解决这个问题，我只知道其中流行的两种：

*   使用要分配给该值的空间作为对链表的引用。这个链表将存储一个或多个值，这些值在多对一映射中驻留在同一个槽中。链接列表还包含帮助来搜索的人的键。就像很多人在同一个公寓里，当一个送货员来的时候，他会去房间里专门找那个人。
*   在数组中使用双哈希函数，每次都给出相同的值序列，而不是单个值。当我去存储一个值时，我会查看所需的内存位置是空闲的还是被占用的。如果它是免费的，我可以在那里存储我的值，如果它被占用，我从序列中获取下一个值，依此类推，直到我找到一个空闲位置并将我的值存储在那里。在搜索或检索该值时，我返回与序列给出的相同路径，并在每个位置询问是否存在该值，直到我找到它或搜索数组中的所有可能位置。

CLRS 的算法简介提供了关于该主题的非常好的见解。

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2020-09-11T20:48:06.067

# 基本理念

为什么人们使用梳妆台来存放他们的衣服？除了看起来时尚和时尚，他们的优势在于每件衣服都有它应该在的地方。如果您正在寻找一双袜子，您只需检查袜子抽屉。如果你正在寻找一件衬衫，你可以检查一下里面有你的衬衫的抽屉。当你在寻找袜子时，你有多少件衬衫或你拥有多少条裤子都没关系，因为你不需要看它们。您只需查看袜子抽屉并期望在那里找到袜子。

在高层次上，哈希表是一种存储东西的方式（有点像），就像衣服的梳妆台一样。基本思想如下：

*   你会得到一些可以存放物品的位置（抽屉）。
*   你想出了一些规则，告诉你每个项目属于哪个位置（抽屉）。
*   当您需要查找某些东西时，您可以使用该规则来确定要查看的抽屉。

像这样的系统的优点是，假设您的规则不太复杂并且您有适当数量的抽屉，您只需在正确的位置查找即可很快找到您要查找的内容。

当你把衣服收起来时，你使用的“规则”可能是“袜子放在左上方的抽屉里，衬衫放在中间的大抽屉里，等等”。但是，当您存储更多抽象数据时，我们会使用一种称为***哈希函数***的方法来为我们执行此操作。

考虑散列函数的一种合理方式是作为一个黑盒。你把数据放在一边，一个叫做*哈希码*的数字从另一边出来。从示意图上看，它看起来像这样：

```
 +---------+
            |\|   hash  |/| --> hash code
   data --> |/| function|\|
              +---------+ 
```

所有散列函数都是***确定性***的：如果你多次将相同的数据放入函数中，你总是会从另一端得到相同的值。一个好的散列函数应该看起来或多或少是随机的：输入数据的微小变化应该给出截然不同的散列码。例如，字符串[“pudu”](https://en.wikipedia.org/wiki/Pud%C3%BA)和字符串[“kudu”](https://en.wikipedia.org/wiki/Kudu)的哈希码可能会彼此完全不同。（再说一遍，它们可能是相同的。毕竟，如果哈希函数的输出看起来或多或少是随机的，那么我们有可能两次获得相同的哈希码。）

您究竟是如何构建散列函数的？现在，让我们继续“体面的人不应该想太多”。数学家已经想出了更好和更差的方法来设计散列函数，但为了我们的目的，我们真的不需要太担心内部结构。把散列函数想象成一个函数就好了

*   确定性（相等的输入给出相等的输出），但是
*   看起来是随机的（很难预测给定另一个哈希码）。

一旦我们有了哈希函数，我们就可以构建一个非常简单的哈希表。我们将制作一系列“桶”，您可以将其视为类似于我们梳妆台中的抽屉。要将项目存储在哈希表中，我们将计算对象的哈希码并将其用作表中的索引，这类似于“选择该项目进入哪个抽屉”。然后，我们将该数据项放入该索引处的存储桶中。如果那个桶是空的，那就太好了！我们可以把物品放在那里。如果那个桶是满的，我们可以做一些选择。一种简单的方法（称为[***链式哈希***](https://en.wikipedia.org/wiki/Hash_table#Separate_chaining)）是将每个存储桶视为项目列表，就像您的袜子抽屉可能存储多个袜子一样，然后只需将项目添加到该索引处的列表中。

要在哈希表中查找某些内容，我们使用基本相同的过程。我们首先计算要查找的项目的哈希码，它告诉我们要查找哪个桶（抽屉）。如果项目在表中，它必须在那个桶中。然后，我们只需查看存储桶中的所有项目，看看我们的项目是否在其中。

这样做有什么好处？好吧，假设我们有大量的桶，我们希望大多数桶中不会有太多的东西。毕竟，我们的散列函数看起来有点像随机输出，所以项目在所有桶中均匀分布。事实上，如果我们将“我们的哈希函数看起来有点随机”的概念形式化，我们可以证明每个桶中的预期项目数是项目总数与桶总数的比率。因此，我们无需做太多工作就可以找到我们正在寻找的项目。

# 细节

解释“哈希表”的工作原理有点棘手，因为哈希表有很多种。下一节将讨论所有哈希表共有的一些通用实现细节，以及不同风格的哈希表如何工作的一些细节。

出现的第一个问题是如何将哈希码转换为表槽索引。在上面的讨论中，我只是说“使用哈希码作为索引”，但这实际上不是一个好主意。在大多数编程语言中，散列码都适用于 32 位或 64 位整数，您不能直接将它们用作存储桶索引。相反，一种常见的策略是创建一个大小为 m 的存储桶数组，为您的项目计算（完整的 32 位或 64 位）哈希码，然后根据表的大小对它们进行修改以获得介于 0 和m-1，包括在内。模数的使用在这里效果很好，因为它速度很快，并且可以很好地将全范围的哈希码传播到更小的范围内。

（您有时会看到这里使用的按位运算符。如果您的表的大小是 2 的幂，例如 2 ^k，那么计算哈希码的按位与，然后计算数字 2 ^k - 1 相当于计算模数，并且它明显更快。）

下一个问题是如何选择正确数量的桶。如果你选择了太多的桶，那么大多数桶将是空的或只有很少的元素（有利于速度 - 你只需要检查每个桶的几个项目），但你会使用一堆空间来简单地存储桶（不是这样太好了，虽然也许你买得起）。反之亦然——如果桶太少，那么平均每个桶会有更多的元素，使得查找需要更长的时间，但你会使用更少的内存。

一个好的折衷方案是在哈希表的生命周期内动态更改存储桶的数量。哈希表的***负载因子***，通常表示为 α，是元素数与桶数的比率。大多数哈希表选择一些最大负载因子。一旦负载因子超过此限制，哈希表就会增加其槽数（例如，通过加倍），然后将旧表中的元素重新分配到新表中。这称为*重新散列*。假设表中的最大负载因子是一个常数，这确保了，假设你有一个好的散列函数，进行查找的预期成本仍然是 O(1)。插入现在具有*摊销*O(1) 的预期成本，因为定期重建表的成本，就像删除的情况一样。（如果负载因子太小，删除同样可以压缩表。）

# 哈希策略

到目前为止，我们一直在讨论链式哈希，这是构建哈希表的许多不同策略之一。提醒一下，链式散列有点像衣服梳妆台 - 每个桶（抽屉）可以容纳多个物品，当您进行查找时，您会检查所有这些物品。

但是，这不是构建哈希表的唯一方法。还有另一个哈希表系列使用一种称为[***开放寻址***](https://en.wikipedia.org/wiki/Hash_table#Open_addressing)的策略。开放寻址背后的基本思想是存储一个***槽***数组，其中每个槽可以是空的，也可以只容纳一个项目。

在开放寻址中，当您执行插入时，像以前一样，您会跳转到某个插槽，其索引取决于计算的哈希码。如果该插槽是免费的，那就太好了！你把物品放在那里，你就完成了。但是如果插槽已经满了怎么办？在这种情况下，您可以使用一些辅助策略来找到一个不同的空闲槽来存储该项目。执行此操作的最常见策略使用称为[***线性探测***](https://en.wikipedia.org/wiki/Linear_probing)的方法。在线性探测中，如果您想要的插槽已满，您只需转移到表中的下一个插槽。如果那个插槽是空的，太好了！你可以把物品放在那里。但是，如果该槽已满，则您将移至表中的下一个槽，依此类推（如果您到达表的末尾，则返回到开头）。

线性探测是构建哈希表的一种非常快速的方法。CPU 缓存针对[***引用的局部性***](https://en.wikipedia.org/wiki/Locality_of_reference)进行了优化，因此在相邻内存位置的内存查找往往比在分散位置的内存查找要快得多。由于线性探测插入或删除通过击中某个数组槽然后线性向前移动来工作，因此它会导致很少的缓存未命中并且最终比理论通常预测的要快得多。（而且理论预测它会非常快！）

最近流行的另一种策略是[***cuckoo hashing***](https://en.wikipedia.org/wiki/Cuckoo_hashing)。我喜欢将杜鹃散列视为散列表的“冻结”。我们有两个哈希表和两个哈希函数，而不是一个哈希表和一个哈希函数。每个项目都可以恰好位于两个位置中的一个 - 它要么位于第一个哈希函数给出的第一个表中的位置，要么位于第二个哈希函数给出的第二个表中的位置。这意味着查找是*最坏情况下的*高效，因为您只需检查两个点即可查看表中是否有内容。

杜鹃散列中的插入使用与以前不同的策略。我们首先查看可以容纳该项目的两个插槽中的任何一个是否空闲。如果是这样，太好了！我们只是把物品放在那里。但如果这不起作用，那么我们选择一个插槽，将项目放在那里，然后踢出曾经在那里的项目。该物品必须放在某个地方，因此我们尝试将其放在另一张桌子的适当位置。如果这行得通，那就太好了！如果没有，我们将一个项目踢出*该*表并尝试将其插入另一个表。这个过程一直持续到一切都平静下来，或者我们发现自己陷入了一个循环。（后一种情况很少见，如果发生这种情况，我们有很多选择，例如“将其放入辅助哈希表”或“选择新的哈希函数并重建表。”）

杜鹃散列有许多改进可能，例如使用多个表，让每个插槽容纳多个项目，以及制作一个“存储”以容纳其他任何地方都无法容纳的项目，这是一个活跃的研究领域！

然后是混合方法。[***跳房子散列***](https://en.wikipedia.org/wiki/Hopscotch_hashing)是开放寻址和链式散列之间的混合，可以被认为是采用链式散列表并将每个存储桶中的每个项目存储在项目想要去的位置附近的插槽中。这种策略与多线程配合得很好。瑞士[***表***](https://abseil.io/blog/20180927-swisstables)利用了一些处理器可以用一条指令并行执行多个操作的事实来加速线性探测表。[***可扩展散列***](https://en.wikipedia.org/wiki/Extendible_hashing)是为数据库和文件系统设计的，它使用 trie 和链式散列表的混合来在加载单个存储桶时动态增加存储桶大小。[***罗宾汉哈希***](https://www.sebastiansylvan.com/post/robin-hood-hashing-should-be-your-default-hash-table-implementation/)是线性探测的一种变体，其中项目可以在插入后移动，以减少每个元素可以居住的距离的差异。

# 延伸阅读

有关哈希表基础知识的更多信息，请查看[***这些关于链式哈希的讲座幻灯片***](https://web.stanford.edu/class/archive/cs/cs106b/cs106b.1204/lectures/17/Slides17.pdf)以及[***这些关于线性探测和罗宾汉哈希的后续幻灯片***](https://web.stanford.edu/class/archive/cs/cs106b/cs106b.1204/lectures/18/Slides18.pdf)。您可以在此处了解有关[***杜鹃散列***](http://web.stanford.edu/class/archive/cs/cs166/cs166.1206/lectures/12/Slides12.pdf)的更多信息，并在此处了解[***散列函数的理论属性***](http://web.stanford.edu/class/archive/cs/cs166/cs166.1206/lectures/10/Slides10.pdf)。

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2009-04-08T15:52:27.250

哈希的计算方式通常不取决于哈希表，而是取决于添加到其中的项目。在 .net 和 Java 等框架/基类库中，每个对象都有一个 GetHashCode()（或类似）方法，该方法返回该对象的哈希码。理想的哈希码算法和准确的实现取决于对象中所代表的数据。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2021-04-10T07:41:30.683

## 直接地址表

要理解哈希表，**直接地址表**是我们应该理解的第一个概念。 [![直接地址表](https://i.stack.imgur.com/DrxLD.png)](https://i.stack.imgur.com/DrxLD.png)

直接地址表直接使用键作为数组中槽的索引。Universe 键的大小等于数组的大小。在 O(1) 时间内访问此密钥非常快，因为数组支持随机访问操作。

但是，在实现直接地址表之前有四个注意事项：

1.  要成为有效的数组索引，键应该是整数
2.  键的范围相当小，否则，我们将需要一个巨大的数组。
3.  不是两个不同的键映射到数组中的同一个槽
4.  Universe 键的长度等于数组的长度

事实上，现实生活中并没有很多情况符合上述要求，所以**哈希表**来拯救

## 哈希表

哈希表不是直接使用密钥，而是首先应用数学哈希函数将任意密钥数据一致地转换为数字，然后使用该哈希结果作为密钥。

Universe 键的长度可以大于数组的长度，这意味着两个不同的键可以散列到同一个索引（称为散列冲突）？

实际上，有几种不同的策略来处理它。这是一个常见的解决方案：我们不是将实际值存储在数组中，而是存储一个指向链表的指针，该链表包含散列到该索引的所有键的值。

如果您仍然有兴趣了解如何从头开始实现 hashmap，请阅读[以下帖子](https://medium.com/analytics-vidhya/how-does-a-hash-table-work-adafc1882b2)

[![在此处输入图像描述](https://i.stack.imgur.com/KzcEM.png)](https://i.stack.imgur.com/KzcEM.png)

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2015-10-07T11:11:20.867

对于所有寻找编程术语的人来说，这是它的工作原理。高级哈希表的内部实现对于存储分配/解除分配和搜索有许多复杂性和优化，但顶级想法将非常相似。

```
(void) addValue : (object) value
{
   int bucket = calculate_bucket_from_val(value);
   if (bucket) 
   {
       //do nothing, just overwrite
   }
   else   //create bucket
   {
      create_extra_space_for_bucket();
   }
   put_value_into_bucket(bucket,value);
}

(bool) exists : (object) value
{
   int bucket = calculate_bucket_from_val(value);
   return bucket;
} 
```

所有唯一性魔术必须发生`calculate_bucket_from_val()`的散列函数在哪里。

经验法则是： **对于要插入的给定值，存储桶必须是唯一的并且可以从它应该存储的值中派生。**

Bucket 是存储值的任何空间 - 因为在这里我将它保存为 int 作为数组索引，但它也可能是一个内存位置。

* * *

## 回答 #17

> 赞同：-1
> 
> 时间：2021-11-30T15:01:54.110

里面的哈希表包含存储密钥集的罐子。哈希表使用哈希码来决定密钥对应该计划到哪个。从 Key 的 hashcode 中获取容器区域的能力称为 hash work。原则上，散列工作是一种容量，当给定一个键时，它会在表中创建一个地址。哈希工作始终返回项目的数字。两个等效的项目将始终具有相似的数字，而两个不一致的对象通常可能不会具有不同的数字。当我们将对象放入哈希表时，可以想象各种对象可能具有相同/相同的哈希码。这被称为碰撞。为了确定冲突，哈希表使用了各种列表。映射到单个数组索引的集合存储在列表中，然后列表引用存储在索引中。

# sql - DDL 语句总是给你一个隐式提交，还是你能得到一个隐式回滚？

> ID：730621
> 
> 赞同：18
> 
> 时间：2009-04-08T15:49:22.327
> 
> 标签：sql, oracle, transactions, ddl

如果您正在执行事务的中途并执行 DDL 语句，例如截断表，则事务将提交。

我想知道这是否总是如此并且根据定义，或者是否有隐藏在某处的设置会*回滚*事务而不是提交。

谢谢。

**编辑以澄清...**

我不希望在截断后回滚。我只是想确认已经执行的语句*绝对总是*要在 DDL 之前提交。只是想确保没有人可以设置破坏我的代码的系统属性。

我理解在 DDL 之前和之后提交的必要性，但从概念上讲，我认为*可以*通过在 DDL 之前回滚和之后提交来实现相同的一致性要求。

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-04-08T18:25:23.170

不，它会一直提交。

如果要回滚，则必须在 DDL 之前进行。

如果要将 DDL 与现有事务隔离，则必须在其自己的单独事务中执行它。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2009-04-08T20:32:50.383

从技术上讲， [DDL](http://asktom.oracle.com/pls/asktom/f?p=100:11:0::::P11_QUESTION_ID:7072180788422)在执行之前和之后执行提交。

是的，来自 Cookie 的相同链接，但这是同一问题的不同方面。重要的是要理解这不仅仅是一次提交，还有两次，它们发生在之前和之后。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-04-08T22:34:51.493

实际上，如果可以的话，它会提交。如果不能成功提交，DDL 将失败。阻止它提交的一种方法是违反延迟约束。

```
create table fred (id number);
alter table fred add constraint id_ck check (id >0) initially deferred;
insert into fred values (-1);
SQL> create table junk(val number);
create table junk(val number)
*
ERROR at line 1:
ORA-02091: transaction rolled back
ORA-02290: check constraint (GC_REF.ID_CK) violated
SQL> desc junk
ERROR:
ORA-04043: object junk does not exist 
```

因此，如果您想防止隐式提交，请使用带有延迟约束的虚拟表。在其中插入违规行，您可以确保在解决违规行为之前无法提交事务（例如删除行）。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-04-08T15:54:53.873

**截断表**或**更改表**或**创建表**总是会导致提交。

为什么要在截断表时回滚？

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-04-08T18:22:11.850

[这](http://asktom.oracle.com/pls/asktom/f?p=100:11:0::::P11_QUESTION_ID:7072180788422)是一篇 AskTom 文章，可能会有所帮助。来自文章：

“我想知道为什么 DDL 语句不在自治事务中执行（就像序列一样），所以它们不会影响任何待处理的用户事务......

你能澄清一下吗？

跟进 2003 年 6 月 24 日 - 美国/东部时间上午 7 点：

那将与不这样做一样“令人困惑”。无论如何，你有atrans，所以如果你愿意，你可以。"

所以，如果你真的需要，你可以把你的 DDL 放在一个自治事务中，然后做你想做的事。

编辑：底线是，除非您明确地“颠覆”Oracle，否则 DDL 将执行提交。也就是说，如果您绝对要求在某个时间点执行提交，为什么不直接执行呢？

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2012-03-21T14:20:28.287

DDL 语句总是在执行后执行自动提交。

如果您希望它在发生故障时回滚（在服务器端），那么您可以设置某些标志来指示故障并采取适当的措施。

例如：如果您创建了一个表 table1。同时您正在其他表中插入一条记录。

但是由于某种原因插入失败（设置标志=真）。那么在这种情况下，您不能回滚，因为创建语句是 ddl 语句，因此您可以通过删除表（表 1）来撤消数据库中的更改，具体取决于flag 的值，通过 Drop 语句。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2017-03-28T20:16:44.347

我同意 DCookie 和 Tom 关于自主交易的观点。我也打算说明这一点。

示例伪代码：

```
Do some DML
Call autonomous function, that performs DDL
Do some more DML
rollback or commit all the DML - your choice 
```

我不认为这是非常有用的。如果最初的 DML 和 DDL 接触同一个表/对象，它就不会工作。当您尝试执行 DDL 时会发生争用。就像任何两个相互阻塞的事务一样。如果它们是独立的对象，我想我不明白为什么执行顺序很重要。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2018-03-13T15:53:11.863

“总是/从不”太强了。例如`CREATE PRIVATE TEMPORARY TABLE`，来自 Oracle 18c 的 DDL 不会影响`COMMIT`您的事务。

正常情况：

```
CREATE TABLE t(i INT);
INSERT INTO t(i) VALUES(21);

CREATE TABLE x(i INT);   -- same for CREATE GLOBAL TEMPORARY TABLE y(i INT); 
ROLLBACK;

SELECT * FROM t;
-- Output:
-- 21 
```

但是如果你创建私有表：

```
CREATE TABLE t(i INT);
INSERT INTO t(i) VALUES(21);

CREATE PRIVATE TEMPORARY TABLE ORA$PTT_temp(i INT);  
-- or
CREATE PRIVATE TEMPORARY TABLE ORA$PTT_tab
AS
SELECT 1 AS c FROM dual;

ROLLBACK;
SELECT * FROM t;
-- Output:
-- no data found 
```

**[db<>小提琴演示](https://dbfiddle.uk/?rdbms=oracle_18&fiddle=a87ef98643bc12e9767e3806fb750b87)**

# jquery - 在jQuery中选择正确的控件

> ID：730623
> 
> 赞同：0
> 
> 时间：2009-04-08T15:49:37.083
> 
> 标签：jquery

我有 3 个表 - 表 1 表 2 和表 3

我想将其更改`$("tr").filter`为仅影响 Table2

它是否正确？

`$("#Table2 tr").filter`还是有其他方法可以做到这一点？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-08T16:05:07.610

*最好*的方法是使用：

```
$('tr', '#Table2') 
```

如[文档](http://docs.jquery.com/Core/jQuery#expressioncontext)所述，该`$()`函数的第二个参数是一个上下文选择器，它告诉它在哪里查找。默认情况下是整个文档，但您可以指定其他内容，例如表格：

> 默认情况下，如果没有指定上下文，$() 会在当前 HTML 文档的上下文中查找 DOM 元素。如果您确实指定了上下文，例如 DOM 元素或 jQuery 对象，则表达式将与该上下文的内容相匹配。

尽管您所拥有的将起作用，但以上是最佳的方法。但是，您的平均用例的速度差异将是微不足道的。我只是更喜欢尽可能指定上下文。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-08T15:56:12.997

如果 Table2 是表的 ID，那么是。Jquery 使用 CSS 选择器，因此更明确地说，您可以尝试：

```
$("table#Table2 tr").filter 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-08T15:54:38.837

对我来说听起来不错，或者粘贴一些 html 以便我们可以看到您正在处理的内容。

# .net - 在 winforms 中使用数据绑定时获取和设置选择的最佳方法是什么？

> ID：730624
> 
> 赞同：0
> 
> 时间：2009-04-08T15:50:35.380
> 
> 标签：.net, winforms, data-binding

我在 win-forms 应用程序 (.Net 2.0) 中使用绑定，并尝试找到在我的数据绑定控件中维护所选项目的最佳方法。我读到访问选择的最佳方式是使用`CurrencyManager`'s (或 bindingSource's) " `Current`" 和 " `Position`" 属性。问题是我找不到不选择任何内容的方法（`Position`' 的值将始终设置为列表中一个项目的索引），并且也无法知道是否选择了很多项目。`CurrencyManager`有没有办法使用或者我应该开始使用控件提供的属性（例如 DataGridView 的 SelectedRows 属性）来解决这些问题？

谢谢！

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-08T16:05:47.903

我不完全确定你在这里问什么。如果您询问如何将细节控件绑定到列表控件或网格中的选定项目，我认为最好的方法是使用两个 BindingSource 对象。网格绑定到的一个和细节控件绑定到的一个。然后，当用户在网格中选择一行时，使用详细信息 BindingSource 的 Filter 属性将其缩小到选定的行。然后，您将确保所选行的详细信息出现在控件中。

例如：

```
 DetailBindingSource.Filter = "ID = " & SelectedRow.IDColumn.Value 
```

如果这不是您要查找的内容，请进一步解释。

编辑：

好的，我很抱歉不理解原来的问题。我会说使用控件的属性是最好的方法。将 SelectedRow / SelectedItem 属性设置为所需的项目。

更改绑定源的当前位置可能会影响其他控件的值，例如我最初提到的细节控件。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-09-15T08:06:16.757

令人难以置信的是，BindingSource 仍然无法拥有 No Selection。

# c# - 如何创建代表颜色的随机十六进制字符串？

> ID：730625
> 
> 赞同：45
> 
> 时间：2009-04-08T15:50:38.843
> 
> 标签：c#, asp.net, colors, hex

我正在生成一些需要颜色十六进制字符串的图表。

例子：

```
<dataseries name="ford" color="FF00FF" /> 
```

我正在动态创建这些，所以我想为每个数据序列随机生成十六进制代码。

做这个的最好方式是什么？

* * *

## 回答 #1

> 赞同：145
> 
> 时间：2009-04-08T15:58:04.117

最简单的方法是使用`String.Format`和使用十六进制格式的参数。

```
var random = new Random();
var color = String.Format("#{0:X6}", random.Next(0x1000000)); // = "#A197B9" 
```

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2009-04-08T16:42:41.637

塞缪尔的回答是做到这一点的最佳方法，只要确保如果您在循环内生成颜色，您不会`Random`每次都实例化新对象，因为`new Random()`使用系统时钟为生成器播种。您的循环运行速度将超过时钟的滴答速度，因此您最终会一遍又一遍地生成几种相同的颜色，因为`random`正在播种相同的值。

它应该看起来像这样：

```
int numColors = 10;
var colors = new List<string>();
var random = new Random(); // Make sure this is out of the loop!
for (int i = 0; i < numColors; i++) 
{
    colors.Add(String.Format("#{0:X6}", random.Next(0x1000000)));
} 
```

代替：

```
int numColors = 10;
var colors = new List<string>();
for (int i = 0; i < numColors; i++) 
{
    var random = new Random(); // Don't put this here!
    colors.Add(String.Format("#{0:X6}", random.Next(0x1000000)));
} 
```

* * *

## 回答 #3

> 赞同：18
> 
> 时间：2009-04-08T16:00:44.170

IMO，纯粹的随机颜色可能并不可取，因为您需要在人眼中可区分的颜色。

预设多种颜色并随机选择它们怎么样？

也许您可以在一些开源图表库中找到更好的答案。

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2009-04-08T16:57:00.683

生成一组漂亮颜色的一个好方法是使用固定的饱和度和亮度来定义它们并改变色调。

1.  将饱和度和亮度设置为您喜欢的值，例如 50% 饱和度和 90% 亮度。
2.  现在将 360 度的色调除以您想要的不同颜色的数量。
3.  使用色调间隔和固定的 S 和 V 从 HSV 中挑选颜色。

这为您提供了一组漂亮的颜色，它们看起来都来自同一个“集合”——全是柔和的，或全是强烈的，或全是灰白色的，等等。如果你有 Color.FromHSV()，那么它很容易编码。

但是，一旦您获得太多颜色，它可能会停止工作，它们将无法区分。但无论如何，你可能会遇到这个问题。

在伪代码中：

```
Sat = 0.5 * 255 //assuming we want range 0-255...
Brightness = 0.9 * 255
NumberOfColours = 7
HueSeparation = 360 / 7
Colors = []
for (i = 0 ; i< NumberOfColours; i++)
     Colors.Add(Color.FromHSV(HueSeparation * i, Sat, Brightness) 
```

或者

```
n = 7
Colors = [Color.FromHSV(x*360/n, 128, 230) for x in range(n)] 
```

（我确实喜欢列表推导......）

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-04-08T15:58:19.327

```
Random rand = new Random(); // specify a seed
int r = rand.Next(0x1000000); 
Console.WriteLine("#{0:X6}", r); 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-04-08T17:26:13.593

我注意到您（Rahkim）对 Greg 的帖子发表评论说您希望您可以将他的想法（保持饱和度和值不变，并且只是改变色调......一个好主意）放入代码中。你可以！或者，更确切地说，有人已经为你准备好了！

[我发现这篇关于使用 C# 将 HSV 转换为 RGB 颜色](http://splinter.com.au/converting-hsv-to-rgb-colour-using-c)的博客文章，我相信还有更多内容。与完全随机选择它们相比，您可能会以这种方式获得更好的颜色套件。

此外，当然，这种方法可以很容易地获得一组漂亮的颜色......因为色调从 0 到 359，你可以做一些像这样设置你的色调的事情：

```
Hue = (PreviousHue + 50) % 360; 
```

（我选择了 50，因为它不会均匀地进入 360，所以如果你超过 360，你不会立即开始重复色调。你必须根据不同颜色的数量来调整这个值以获得理想的分离你期待。）

这样您就不必担心当仍有大量未使用的“色调”空间时代码会随机选择两种非常接近的颜色。

# .net - 在 IIS 6 上设置 ASP.NET 页面

> ID：730627
> 
> 赞同：1
> 
> 时间：2009-04-08T15:51:26.627
> 
> 标签：.net, asp.net, configuration, iis-6

我有虚拟主机，我在其中设置了 IIS 6 服务器。在扩展中，我添加了 ASP.NET v1.1.4322 和 ASP.NET v2.0.50727 并将它们设置为允许，但是在使用 aspx 文件时我仍然收到文件未找到错误。

我需要为 aspx 或其他任何东西设置 mimetypes 吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-08T15:54:14.093

我不确定这是否会有所帮助，但您可以转到命令行并输入：

"C:\WINDOWS\Microsoft.NET\Framework\v2.0.50727>aspnet_regiis.exe -i"

这可能会解决您的问题。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-08T15:53:01.897

您是否在根网站或虚拟目录中设置了正确的 ASP.Net 版本？

# c# - 字符串模板列表字典迭代

> ID：730630
> 
> 赞同：2
> 
> 时间：2009-04-08T15:52:03.193
> 
> 标签：c#, stringtemplate

我正在尝试遍历模板中的 ListDictionary (C# StringTemplate) 并让每个列表项调用另一个模板：

```
DataDefAssign(cols) ::=
<<
<cols.keys: { k | <PropDef(name=<k>, type=<cols.(k)>) }>
>> 
```

上面的模板不会生成任何东西。如果我内联匿名模板而不是尝试调用 PropDef 模板，它会按预期工作。迭代是否只允许匿名模板？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-28T20:32:49.427

我有一个语法问题。迭代应该是：

```
<cols.keys: { k | <PropDef(name=k, type=cols.(k))> }> 
```

感谢 micha-1@fantasymail.de 在 StringTemplate 列表中指出这一点。

# python - Python/wxPython: Doing work continuously in the background

> ID：730645
> 
> 赞同：16
> 
> 时间：2009-04-08T15:55:06.557
> 
> 标签：python, multithreading, wxpython, background

I'm making a program for running simulations in Python, with a wxPython interface. In the program, you can create a simulation, and the program renders (=calculates) it for you. Rendering can be very time-consuming sometimes.

When the user starts a simulation, and defines an initial state, I want the program to render the simulation continuously in the background, while the user may be doing different things in the program. Sort of like a YouTube-style bar that fills up: You can play the simulation only up to the point that was rendered.

How should I run the rendering function?

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-04-14T02:36:37.927

我会使用 a`threading.Thread`在后台运行代码并将`wx.CallAfter`更新发布到我的窗口线程以将它们呈现给用户。

```
thread = threading.Thread(target=self.do_work)
thread.setDaemon(True)
thread.start()

...

def do_work(self):
    # processing code here
    while processing:
        # do stuff
        wx.CallAfter(self.update_view, args, kwargs)

def update_view(self, args):
    # do stuff with args
    # since wx.CallAfter was used, it's safe to do GUI stuff here 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-04-16T12:10:02.987

[wxPython wiki 上有很多关于](http://wiki.wxpython.org/LongRunningTasks)可能有用的长时间运行任务的信息。它们基本上使用线程并`wx.PostEvent`处理线程和主 wx 事件循环之间的通信。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-04-08T15:58:29.810

Launch a new process to render in background and periodically check to see if it has returned.

You can find the documentation for the subprocess module [here](http://docs.python.org/library/subprocess.html#module-subprocess) and the multiprocess module [here](http://docs.python.org/library/multiprocessing.html?highlight=multiprocess#module-multiprocessing). As Jay said, multiprocess is probably better if you're using Python 2.6\. That said, I don't think there would be any performance difference between the two. Multiprocess just seems to be a wrapper around subprocess making certain things easier to do.

While subprocess/multiprocess is the standard way to do this, you may also want to take a look at [Parallel Python](http://www.parallelpython.com/content/view/15/30/#API).

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-14T02:42:19.413

如果您不介意使用稍微不同的方法，您可以查看[stackless](http://www.stackless.com/) python 并为您的渲染过程创建一个 tasklet。我个人觉得它很容易使用。

# java - Swing UIManager.getColor() keys

> ID：730649
> 
> 赞同：21
> 
> 时间：2009-04-08T15:56:04.510
> 
> 标签：java, swing, colors, uimanager

Is there a list somewhere of the `UIManager.getColor()` keys for Swing? I can't seem to find it online, just occasional references to strings like `"Panel.background"` and `"Table.selectionBackground"`.

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-08T16:06:48.150

我认为没有定义的标准键集。但是您可以尝试这段代码以按字母顺序列出当前可用的代码：

```
List<String> colors = new ArrayList<String>();
for (Map.Entry<Object, Object> entry : UIManager.getDefaults().entrySet()) {
    if (entry.getValue() instanceof Color) {
        colors.add((String) entry.getKey()); // all the keys are strings
    }
}
Collections.sort(colors);
for (String name : colors)
    System.out.println(name); 
```

这会产生一个太长的列表，无法在此处重现。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-09T14:17:09.140

@mmyers 给了我灵感。这是一个在可排序表中列出 UIManager 默认值的简短程序。

```
package com.example.test.gui;

import java.awt.Color;
import java.awt.Component;
import java.util.Map;

import javax.swing.JFrame;
import javax.swing.JLabel;
import javax.swing.JScrollPane;
import javax.swing.JTable;
import javax.swing.UIManager;
import javax.swing.table.DefaultTableCellRenderer;

import ca.odell.glazedlists.BasicEventList;
import ca.odell.glazedlists.EventList;
import ca.odell.glazedlists.GlazedLists;
import ca.odell.glazedlists.SortedList;
import ca.odell.glazedlists.gui.AbstractTableComparatorChooser;
import ca.odell.glazedlists.gui.TableFormat;
import ca.odell.glazedlists.swing.EventTableModel;
import ca.odell.glazedlists.swing.TableComparatorChooser;

public class UIManagerDefaultsViewer {

    public static class UIEntry
    {
        final private String key;
        final private Object value;

        UIEntry(Map.Entry<Object,Object> e)
        {
            this.key = e.getKey().toString();
            this.value = e.getValue(); 
        }

        public String getKey() {
            return key;
        }
        public Object getValue() {
            return value;
        }
        public Class getValueClass() {
            if (value == null)
                return null; // ?!?!?!
            return value.getClass();
        }
        public String getClassName() {
            // doesn't handle arrays properly
            if (value == null)
                return "";

            return value.getClass().getName();
        }
    }   

    public static class UIEntryRenderer extends DefaultTableCellRenderer
    {
        Color[] defaults = new Color[4];
        public UIEntryRenderer()
        {
            super();
            defaults[0] = UIManager.getColor("Table.background");
            defaults[1] = UIManager.getColor("Table.selectionBackground");
            defaults[2] = UIManager.getColor("Table.foreground");
            defaults[3] = UIManager.getColor("Table.selectionForeground");
        }

        public void setDefaultColors(Component cell, boolean isSelected)
        {
            cell.setBackground(defaults[isSelected ? 1 : 0]);
            cell.setForeground(defaults[isSelected ? 3 : 2]);
        }

        @Override
        public Component getTableCellRendererComponent(JTable table, Object value,
                boolean isSelected, boolean hasFocus, int row, int column)
        {
            Component cell = super.getTableCellRendererComponent(table, value,
                    isSelected, hasFocus, row, column);
            if (table.convertColumnIndexToModel(column) == 1) // the value column
            {
                final EventTableModel<UIEntry> tableModel = 
                    (EventTableModel<UIEntry>) table.getModel();
                UIEntry e = tableModel.getElementAt(row);
                JLabel l = (JLabel)cell;

                if (value instanceof Color)
                {
                    Color c = (Color)value;
                    cell.setBackground(c);
                    cell.setForeground(
                            c.getRed()+c.getGreen()+c.getBlue() >= 128*3
                            ? Color.black : Color.white);
                    // choose either black or white depending on brightness

                    l.setText(String.format("Color 0x%08x (%d,%d,%d alpha=%d)",
                        c.getRGB(), c.getRed(), c.getGreen(), c.getBlue(), c.getAlpha()));
                    return cell;
                }
                else if (e.getKey().endsWith("ont"))
                    // possible font, not always ".font"
                {
                    // fonts are weird, for some reason the value returned
                    // in the entry set of UIManager.getDefaults()
                    // is not the same type as the value "v" below                  
                    Object v = UIManager.get(e.getKey());
                    if (v instanceof javax.swing.plaf.FontUIResource)
                    {
                        javax.swing.plaf.FontUIResource font = 
                            (javax.swing.plaf.FontUIResource)v;
                        l.setText("Font "+font.getFontName()+" "+font.getSize());
                    }
                }
            }

            setDefaultColors(cell, isSelected);

            return cell;
        }
    }   

    public static void main(String[] args) {
        final EventList<UIEntry> uiEntryList = 
            GlazedLists.threadSafeList(new BasicEventList<UIEntry>());

        for (Map.Entry<Object,Object> key : UIManager.getDefaults().entrySet())
        {
            uiEntryList.add(new UIEntry(key));
        }

        final SortedList<UIEntry> sortedUIEntryList = new SortedList<UIEntry>(uiEntryList, null);

        // build a JTable
        String[] propertyNames = new String[] {"key","value","className"};
        String[] columnLabels = new String[] {"Key", "Value", "Class"};
        TableFormat<UIEntry> tf = GlazedLists.tableFormat(UIEntry.class, propertyNames, columnLabels);
        EventTableModel<UIEntry> etm = new EventTableModel<UIEntry>(sortedUIEntryList, tf);

        JTable t = new JTable(etm);
        TableComparatorChooser<UIEntry> tcc = TableComparatorChooser.install(t, 
                sortedUIEntryList, AbstractTableComparatorChooser.SINGLE_COLUMN,
                tf);
        sortedUIEntryList.setComparator(tcc.getComparatorsForColumn(0).get(0));
        // default to sort by the key

        t.setDefaultRenderer(Object.class, new UIEntryRenderer());        

        JFrame f = new JFrame("UI Manager Defaults Viewer");
        // show the frame
        f.add(new JScrollPane(t));
        f.pack();
        f.setLocationRelativeTo(null);
        f.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
        f.setVisible(true);     
    }

} 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2012-12-06T19:47:38.373

这个程序是我见过的最好的可视化 UIManager 值（例如字体、颜色、边框）的程序：http: [//tips4java.wordpress.com/2008/10/09/uimanager-defaults/](http://tips4java.wordpress.com/2008/10/09/uimanager-defaults/)

它没有搜索功能，但可以按组件或值类型进行过滤，这非常棒。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-08T16:05:39.730

它们有点依赖于外观实现。寻找`BasicLookAndFeel.java`基本的钥匙。不要期望所有 PL&F 的行为都相同，甚至在版本之间保持相同。

# .net - ASP MVC HTML Helpers - 好还是坏？

> ID：730652
> 
> 赞同：29
> 
> 时间：2009-04-08T15:56:16.897
> 
> 标签：.net, asp.net-mvc, html-helper

我理解在 ASP.NET MVC 中使用 HTML 帮助程序并将其扩展为提供您自己的帮助程序的原因，但我想知道使用 HTML 帮助程序是否是一个好主意。

我认为 ASP.NET MVC 的好处之一是对 HTML 的控制。如果您开始将其隐藏在生成 HTML 的辅助函数中，您是否会开始失去可见性？我想当您生成简单的控件（例如按钮）时，这不是问题，但是我已经看到使用 html 助手来创建网格和更复杂的 HTML 输出。

现在我也明白这样做的原因是为了保持干燥，避免重复。但是这里有类似于代码隐藏的东西的危险吗？此外，如果您与设计师合作怎么办？通常，设计师会创建标记并应用样式。如果您开始使用生成标记的助手注入您的视图，这不会使这种协作变得困难吗？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-04-08T16:08:06.087

“对 HTML 的控制”是微软的营销语言，也是他们选择平台品牌的方式。ASP.net MVC 的重点在于它比整个有状态事件驱动的 web 表单模型更简单，更适合 webapps，而且微软领域之外的几乎所有人都在几年前转向了这种模型。不过，微软不能这么说，因为他们在网络表单上进行了巨额投资，这是他们企业故事的关键部分。

话虽如此，如果您的助手中有业务逻辑，那么您使用它们是错误的。它基本上是仅在多个页面中重复的表示逻辑的代码隐藏，目标是使标记中的 scriptlet 标记尽可能简单。

只要您以应有的方式使用助手，设计人员学习如何使用应该是相当简单的。请记住，我们的目标是让事情变得简单，如果它们最终使事情变得更复杂，则意味着它们没有被正确使用。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-10-28T13:03:21.920

很好的评论，马特。仍然存在一个问题，即在“纯”MVC 实现中，HTML 助手是否是一个好主意。我认为这是一个神奇的词，“纯”。每当我放慢脚步思考“正确”的做事方式时，我真的在尝试看看某个特定的方法是否符合纯粹主义者的愿景。那么，纯粹主义者会使用 HTML 助手吗？

我大约是 8/10 的纯粹主义者，我不会使用它们。我已经看到这个论点超越了技术，并提出了 PHP 和 Zend 框架中的 MVC 问题。只是感觉不对，对我来说，这是人们能想到的最好的衡量标准。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2011-06-02T03:45:57.930

帮手肯定没有错。它们用于使您的视图保持简洁和声明性。有一种说法类似于“如果您认为有“如果”陈述，那么您做错了”。它们被用于许多著名的 MVC 框架，如 Ruby On Rails 和 Cake PHP。看看[这篇文章](http://www.arrangeactassert.com/asp-net-mvc-view-best-practices-keep-logic-out-of-your-views/)。“纯粹”与否，助手是一件好事，不要与糟糕的实践或泄漏的抽象相混淆。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2017-06-08T11:50:32.690

我认为其他人没有提到的重要一点是您的观点的可移植性。

您可以立即将您的 HTML、javascript 和 CSS 移动到另一个平台上的应用程序中。您不必将所有丑陋的 HTMLHiders.. 抱歉，HTMLHelpers.. 转换为实际的 HTML。

虽然我非常重视 .NET 框架，它减少了我的开发时间并使我的工作变得轻松，但我强烈认为视图应该是非专有的。

无论如何，您都可以从模型和控制器中的框架中获得几乎所有的好处。IMO，在表示层中注入对框架的依赖项根本不值得权衡。

# asp.net - 如何可靠地检测 Flash 是否是服务请求的发起者？

> ID：730654
> 
> 赞同：3
> 
> 时间：2009-04-08T15:56:55.880
> 
> 标签：asp.net, apache-flex, flash, http-headers, http-status-codes

我需要能够检测 flash 是否是对 ASP.NET 服务的请求的发起者。原因是当响应状态码不是 200 时，Flash 无法处理 SOAP 消息。但是，我允许异常通过我们的 SOAP Web 服务冒泡，因此 SOAP 服务器故障的状态码是 500。在 Flash 10 之前，我能够检查 referrer 属性，如果它以 .SWF 结尾，我将状态代码更改为 200，以便我们的 Flex 应用程序可以适当地处理 SOAP 消息。但自从引入 Flash 10 后，不再发送引荐来源网址。我想使用 x-flash-version 标头，但它似乎只在使用 IE 时发送，而不是 FF。

这让我想到了我的问题：如何可靠地检测 Flash 是否是对服务的请求的发起者？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-08T15:59:35.407

你不能**可靠地**做到这一点——毕竟，它可能是一个代理，或者有人可能已经窥探了你的 Flash 组件的流量，以找出如何在没有 Flash 版本没有任何限制的情况下重用你的 API。

要进行基本的健全性检查以区分输出，那么您可以简单地添加一个标志来表示“请使用 Flash API 版本”；但是对于所有 HTTP 通信，伪造所需的任何内容都相对简单。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-08T16:01:41.547

怎么样`http://domain.com/path/to/target?flash=true`？如果您所做的只是更改 api 或返回不同的错误，则不需要安全检测方法。

编辑：请注意，这绝对不是“可靠的”，但您真的需要一种可靠的检测方法还是仅仅有效的检测方法？这行得通，只是不安全，如果你需要它来保证安全，你就做错了，因为不可能知道实际使用的是什么客户端。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-15T18:11:44.740

您可以检查用户代理（但它可能是伪造的），Flash 使用类似“Adobe Flash”的东西

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-04-25T17:50:11.197

最安全的方法（提供的简单选项）是正则表达式匹配其中将包含 .swf 的引荐来源网址。

这比 &flash=true 的查询字符串/表单参数更难欺骗。使用可以发送虚假 HTTP 标头（引荐来源网址）的黑客工具当然是可以破解的，但在所提供的选项中，它需要付出最大的努力。

# .net - Why do my ASP.NET pages render slowly when placed on the server?

> ID：730657
> 
> 赞同：0
> 
> 时间：2009-04-08T15:58:00.543
> 
> 标签：.net, asp.net, optimization, performance

I have a simple aspx page with a GridView control. I'm loading the GridView with search results after the click of a button. Everything works, but the HTML rendering on the browser is very slow in IE with a result set > 2000 (works fine in other browsers.) I realize it's slow due to the record count, but is there a way I can make it faster? (I don't want to use paging.)

Oddly, it's slow only when it's hosted on Windows 2003 server. It works fine on my localhost, but on either the test site or production, the problem occurs. If I remote desktop to my test server and run it locally there, the page loads fine. The problem only occurs when I run the server hosted application from my local machine.

How can I resolve this issue?

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-08T16:04:22.477

从本地主机传输时它工作正常，因为不存在网络瓶颈——一些浏览器在尝试渲染之前等待整个表被传输——尤其是在不使用固定列宽时（这可以提高性能）；你看过整个生成页面的大小吗？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-08T16:03:18.127

一些简单的建议，关闭该控件的视图状态。您是否也在使用 MS AJAX，这也可能导致问题。如果您愿意，请将其从更新面板中取出。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-08T16:04:25.800

如果您需要控件上的 ViewState，您可以通过在 PreRender 事件中禁用每一行的 ViewState 来减少 GridView 对页面的 ViewState 影响：

```
 Private Sub grid_PreRender(ByVal sender As Object, ByVal e As System.EventArgs) Handles grid.PreRender

    For Each item As DataGridItem In grid.Items
      item.EnableViewState = False
    Next

  End Sub 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-08T16:15:41.607

如果您还没有压缩 HTTP 响应，您应该[考虑这样做](http://terrapinstation.wordpress.com/2008/06/12/aspnet-http-comression-and-reducing-response-size/)。

*   看看[Yslow](http://developer.yahoo.com/yslow/) for FireFox（从这里开始）
*   使用标准 gzip/deflate 压缩来压缩您的响应
*   尽你所能减少 GridView 中的数据量。消除不必要的列等。
*   关闭视图状态
*   使用[jsmin](http://www.crockford.com/javascript/jsmin.html)减小 JavaScript 文件的大小（如果有）
*   减小 CSS 的大小（如果有）

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-14T15:00:48.670

由于在这种情况下网络是瓶颈，因此请尝试缩小生成的 HTML。显然，每个网格行的权重平均约为 640 字节（2500 条记录生成 1.6M 有效负载）。看看是否可以通过删除不必要的空格和缩短任何 HTML 元素 ID 来减少它。如前所述，将样式（如果有）从网格移动到 CSS。如果网格呈现任何 URL（例如，锚点中的“href”或图像中的“src”）尝试缩短它们。此外，如果 GridView 呈现的 HTML 不是最佳的，请查看您是否可以自己呈现。为了估计生产中的预期页面响应时间，请考虑您的平均用户网络速度（可能与您机器的网络速度不同）。

如果以上都没有产生令人满意的结果，您可以查看我们提供的解决方案——名为[Web Stimulus](http://stimulustechnology.com/)的 ASP.NET 加速器。它在客户端上部分执行 ASP.NET 页面代码，以在客户端计算机上呈现 HTML。典型的流量减少是 10-20 倍，代码更改最少。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-10T21:32:52.303

简而言之，做自定义分页，这样它就不会在页面加载时加载所有项目。Linq 数据源为您做这件事。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-10T21:35:46.443

为什么不想使用分页？1.6 MB 对于页面的 html 来说已经很多了。

考虑到您已经禁用了视图状态，请考虑通过以下方式减少 html 的数量：

*   删除不必要的列
*   仅使用 css 来设置 gridview 的样式。这个想法是不要在整个 HTML 中重复相同的视觉规则。
*   避免列中不必要的标记。查看您可能拥有的任何模板列，并简化其中的 HTML（也使用 css 对其进行样式设置）。

# ruby - 在 Webby/Compass 集成中使用 blueprint.sass

> ID：730667
> 
> 赞同：0
> 
> 时间：2009-04-08T16:00:24.093
> 
> 标签：ruby, sass, blueprint-css, compass-sass, webby

我在这里关注一篇文章：

[http://gom-jabbar.org/articles/2009/02/04/don-t-use-css-or-table-layout-use-sass-ad-compass](http://gom-jabbar.org/articles/2009/02/04/don-t-use-css-or-table-layout-use-sass-ad-compass)

更具体地说，标题为**“使用 Compass 和 Sass 创建人们通常使用表格的布局的具体示例”的部分**

示例参考`@import blueprint.sass`

这个文件在哪里，因为我的 webby 项目似乎无法找到它。

（另请注意，我使用的是 Ubuntu）

我的**layout.sass**文件看起来像这样（没什么花哨的）：

```
---
filter: sass
extension: css
layout: nil
---
@import blueprint.sass
body
  +blueprint-typography 
```

**运行webby**时出现以下错误：

```
create  output/stylesheets/layout.css
[22:56:30] ERROR: while rendering page 'content/stylesheets/layout.sass'
[22:56:30] ERROR: sass filter error: "File to import not found or unreadable: blueprint.sass." 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-08T19:11:30.063

绝对需要升级到最新的 edge haml。这是在上个月左右修复的评论解析方式中的一个错误。

```
git checkout git://github.com/nex3/haml.git
cd haml
rake install 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-13T15:09:25.303

好吧想通了...

您必须下载/安装最新安装的 haml 尚未在[指南针入门指南中指定](http://acts-as-architect.blogspot.com/2008/11/compass-primer.html)

**这实际上应该是安装它的第一步！**

这就是这一步的进行方式：

1.  使用以下命令下载最新版本的 HAML：*git clone git://github.com/nex3/haml.git* （这将创建一个新目录*./haml/*）

2.  切换到*./haml/*目录。

3.  在*./haml/*目录中键入以下命令：*rake install*

# sql - SQL：3个自连接，然后将它们连接在一起

> ID：730670
> 
> 赞同：0
> 
> 时间：2009-04-08T16:00:57.993
> 
> 标签：sql, sql-server, sql-server-2005, join

我有 2 个表以特定方式加入。我认为我的查询是正确的，但不确定。

```
select t1.userID, t3.Answer Unit, t5.Answer Demo  
FROM    
    table1 t1  
    inner join (select * from table2) t3 ON t1.userID = t3.userID   
    inner join (select * from table2) t5 ON t1.userID = t5.userID  
where  
    NOT EXISTS (SELECT * FROM table1 t2 WHERE t2.userID = t1.userID AND t2.date > t1.date)  
    and NOT EXISTS (SELECT * FROM table2 t4 WHERE t4.userID = t3.userID and t4.counter > t3.counter)  
    and NOT EXISTS (SELECT * FROM table2 t6 WHERE t6.userID = t5.userID and t6.counter > t5.counter)  
    and t1.date_submitted >'1/1/2009'  
    and t3.question = Unit  
    and t5.question = Demo  
order by  
    t1.userID 
```

从表 1 我想要不同的用户 ID，其中日期 > 2009 年 1 月 1 日

```
table1      
userID    Date
1         1/2/2009  
1         1/2/2009  
2         1/2/2009  
3         1/2/2009  
4         1/1/2008 
```

所以我想从 table1 得到的结果应该是这样的：

```
userID  
1  
2  
3 
```

然后我想在 userID 上加入这个 table2，它看起来像这样：

```
table2 
userID    question   answer   counter
1         Unit       A        1
1         Demo       x        1
1         Prod       100      1
2         Unit       B        1
2         Demo       Y        1
3         Prod       100      1
4         Unit       A        1
1         Unit       B        2
1         Demo       x        2
1         Prod       100      2
2         Unit       B        2
2         Demo       Z        2
3         Prod       100      2
4         Unit       A        2 
```

我想用这个结果加入 table1 和 table2：

```
userID    Unit    Demo
1         B       X
2         B       Z 
```

换句话说，
从 table2 中选择 distinct userID where question = Unit 作为最高计数器
，然后
从 table2 where question = Demo 中选择 distinct userID 作为最高计数器。

我认为我所做的是 3 个自我加入，然后将这 3 个加入在一起。

你觉得对吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-08T16:10:59.200

```
SELECT  du.userID, unit.answer, demo.answer
FROM    (
        SELECT  DISTINCT userID
        FROM    table1
        WHERE   date > '1/1/2009'
        ) du
LEFT JOIN
        table2 unit
ON      (userID, question, counter) IN
        (
        SELECT  du.userID, 'Unit', MAX(counter)
        FROM    table2 td
        WHERE   userID = du.userID
                AND question = 'Unit'
        )
LEFT JOIN
        table2 demo
ON      (userID, question, counter) IN
        (
        SELECT  du.userID, 'Demo', MAX(counter)
        FROM    table2 td
        WHERE   userID = du.userID
                AND question = 'Demo'
        ) 
```

启用索引`table2 (userID, question, counter)`将大大改善此查询。

既然你提到`SQL Server 2005`了，以下将更容易和更有效：

```
SELECT  du.userID,
        (
        SELECT  TOP 1 answer
        FROM    table2 ti
        WHERE   ti.user = du.userID
                AND ti.question = 'Unit'
        ORDER BY
                counter DESC
        ) AS unit_answer,
        (
        SELECT  TOP 1 answer
        FROM    table2 ti
        WHERE   ti.user = du.userID
                AND ti.question = 'Demo'
        ORDER BY
                counter DESC
        ) AS demo_answer
FROM    (
        SELECT  DISTINCT userID
        WHERE   date > '1/1/2009'
        FROM    table1
        ) du 
```

聚合：

```
SELECT  answer, COUNT(*)
FROM    (
        SELECT  DISTINCT userID
        FROM    table1
        WHERE   date > '1/1/2009'
        ) du
JOIN    table2 t2
ON      t2.userID = du.userID
        AND t2.question = 'Unit'
GROUP BY
        answer 
```

# c# - 使用 C# 对 AD 进行身份验证

> ID：730672
> 
> 赞同：0
> 
> 时间：2009-04-08T16:01:21.503
> 
> 标签：c#, authentication, active-directory

我有这段代码并且正在使用 VS 2005 - 效果很好 - 但是，如果我使用 VS 2008 尝试它，它就不起作用。有任何想法吗？

网络配置：

```
<connectionStrings>
    <add 
        name="ADService" 
        connectionString="LDAP://kingletvm.creighton.edu/DC=blue,DC=jays,DC=creighton,DC=edu" />
</connectionStrings>
<system.web>
    <membership defaultProvider="AspNetActiveDirectoryMembershipProvider">
        <providers>
            <add 
            name="AspNetActiveDirectoryMembershipProvider"
            type="System.Web.Security.ActiveDirectoryMembershipProvider, 
                    System.Web, Version=2.0.0.0, Culture=neutral, 
                    PublicKeyToken=b03f5f7f11d50a3a"
            connectionStringName="ADService" 
            attributeMapUsername="sAMAccountName" 
            description="Default AD connection"/>
        </providers>     
    </membership>
</system.web> 
```

* * *

C#代码：

```
Membership.ValidateUser(netid.Text, passwd.Text); 
```

来自哪里`netid`和`passwd`来自文本输入框。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-08T16:08:08.380

您是否在 VS 2008 中运行 3.5（或 3.0）？如果将 .NET Framework 版本更改为 2.0，会发生什么情况？您是否收到任何错误，或者只是身份验证失败？

# c# - 自定义 GridView 分页

> ID：730676
> 
> 赞同：0
> 
> 时间：2009-04-08T16:02:38.770
> 
> 标签：c#, .net, gridview, custom-server-controls

我开始研究自定义 Gridview 扩展。我添加了一些基本的 css 东西，看起来不错，现在我想继续。我从未使用过自定义控件事件。

我目前有一个错误“未处理的事件 PageIndexChanging”。

我在something.aspx 中有MyGridview 类。我想在 MyGridview 类中处理分页（而不是在 something.aspx 中）

我想我会这样做，因为它在所有屏幕上看起来都差不多。

谁能告诉我如何创建/覆盖分页内容？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-08T16:07:59.957

与其创建派生控件，不如考虑为其蒙皮。然后，您可以根据需要从标准控件处理事件。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-08T16:14:00.363

您需要添加此事件：

```
protected void gvName_PageIndexChanging(object sender, GridViewPageEventArgs e)
{
    GridView gvToPage = (sender as GridView);
    gvToPage.PageIndex = e.NewPageIndex;
} 
```

# .net - 将此 app.config xml 转换为代码？(WCF)

> ID：730693
> 
> 赞同：2
> 
> 时间：2009-04-08T16:05:30.587
> 
> 标签：.net, wcf, app-config

我需要将以下 app.config 部分转换为代码。我已经看过几个例子，但仍然不能让它发挥作用。有人可以帮忙吗？

```
<system.serviceModel>
    <bindings>
      <basicHttpBinding>
        <binding name="MyService" 
                 closeTimeout="00:01:00"
                 openTimeout="00:01:00" 
                 receiveTimeout="00:10:00" 
                 sendTimeout="00:01:00"
                 allowCookies="false" 
                 bypassProxyOnLocal="false" 
                 hostNameComparisonMode="StrongWildcard"
                 maxBufferSize="65536" 
                 maxBufferPoolSize="524288" 
                 maxReceivedMessageSize="65536"
                 messageEncoding="Text" 
                 textEncoding="utf-8" 
                 transferMode="Buffered"
                 useDefaultWebProxy="true">
            <readerQuotas maxDepth="32" 
                          maxStringContentLength="8192" 
                          maxArrayLength="16384"
                          maxBytesPerRead="4096" 
                          maxNameTableCharCount="16384" />
            <security mode="TransportWithMessageCredential">
                <transport clientCredentialType="None" 
                           proxyCredentialType="None" 
                           realm="" />
                <message clientCredentialType="UserName" 
                         algorithmSuite="Default" />
            </security>
        </binding>
      </basicHttpBinding>
    </bindings>
    <client>
      <endpoint address="https://server.com/service/MyService.asmx"
      binding="basicHttpBinding" bindingConfiguration="MyService"
      contract="MyService.MyServiceInterface"
      name="MyService" />
    </client>
</system.serviceModel> 
```

我的用例是我正在编写一个将由其他非.net 应用程序使用的 dll，因此我没有放置 app.config 的好地方。

谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-08T16:17:10.387

你可以使用这样的东西（它看起来很标准 basicHttpBinding）：

```
BasicHttpBinding binding = new BasicHttpBinding();
Uri endpointAddress = new Uri("https://server.com/service/MyService.asmx");

ChannelFactory<MyService.MyServiceInterface> factory = new ChannelFactory<MyService.MyServiceInterface>(binding, endpointAddress);

MyService.MyServiceInterface proxy = factory.CreateChannel(); 
```

只要您有一个包含可用合同（“MyService.MyServiceInterface”）的 DLL 并且您可以在您的客户端中引用它，这就会起作用。

如果您在服务端需要这个，您将不得不使用一些不同的类等 - 但基础是相同的（创建绑定，创建一个或多个端点地址，绑定它们）。

马克

PS：抱歉，我刚刚注意到您使用了 https:// 地址 - 这可能需要在代码中进行一些额外的安全配置。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-08T16:42:40.640

谢谢你marc_s，你把我引向了正确的方向！

对于任何感兴趣的人，这里是使它也可以与 SSL 一起使用的代码：

```
 BasicHttpBinding binding = new BasicHttpBinding();
        binding.Security.Mode = BasicHttpSecurityMode.TransportWithMessageCredential;
        Uri endpointAddress = new Uri("https://server.com/Service.asmx");

        ChannelFactory<MyService.MyServiceInterface> factory = new ChannelFactory<MyService.MyServiceInterface>(binding, endpointAddress.ToString());
        factory.Credentials.UserName.UserName = "username";
        factory.Credentials.UserName.Password = "password";

        MyService.MyServiceInterface client = factory.CreateChannel();

        // make use of client to call web service here... 
```

# asp.net-mvc - 如何呈现文件以从 MVC 控制器下载？

> ID：730699
> 
> 赞同：110
> 
> 时间：2009-04-08T16:07:17.307
> 
> 标签：asp.net-mvc, download

在 WebForms 中，我通常会有这样的代码，让浏览器显示一个“下载文件”弹出窗口，其中包含任意文件类型（如 PDF）和文件名：

```
Response.Clear()
Response.ClearHeaders()
''# Send the file to the output stream
Response.Buffer = True

Response.AddHeader("Content-Length", pdfData.Length.ToString())
Response.AddHeader("Content-Disposition", "attachment; filename= " & Server.HtmlEncode(filename))

''# Set the output stream to the correct content type (PDF).
Response.ContentType = "application/pdf"

''# Output the file
Response.BinaryWrite(pdfData)

''# Flushing the Response to display the serialized data
''# to the client browser.
Response.Flush()
Response.End() 
```

如何在 ASP.NET MVC 中完成相同的任务？

* * *

## 回答 #1

> 赞同：183
> 
> 时间：2009-04-08T16:24:46.827

根据文件是否存在或您即时创建它，从您的操作返回 a[`FileResult`](https://msdn.microsoft.com/en-us/library/system.web.mvc.fileresult.aspx "MSDN")或。[`FileStreamResult`](https://msdn.microsoft.com/en-us/library/system.web.mvc.filestreamresult.aspx "MSDN")

```
public ActionResult GetPdf(string filename)
{
    return File(filename, "application/pdf", Server.UrlEncode(filename));
} 
```

* * *

## 回答 #2

> 赞同：64
> 
> 时间：2010-01-26T06:38:25.173

要强制下载 PDF 文件，而不是由浏览器的 PDF 插件处理：

```
public ActionResult DownloadPDF()
{
    return File("~/Content/MyFile.pdf", "application/pdf", "MyRenamedFile.pdf");
} 
```

如果您想让浏览器按其默认行为（插件或下载）处理，只需发送两个参数。

```
public ActionResult DownloadPDF()
{
    return File("~/Content/MyFile.pdf", "application/pdf");
} 
```

您需要使用第三个参数在浏览器对话框中指定文件的名称。

更新：Charlino 是对的，当传递第三个参数（下载文件名）`Content-Disposition: attachment;`时，它被添加到 Http 响应标头中。我的解决方案是`application\force-download`作为 mime 类型发送，但这会产生下载文件名的问题，因此需要第三个参数来发送一个好的文件名，因此无需*强制下载*。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2013-05-24T01:21:25.893

您可以在 Razor 或 Controller 中执行相同的操作，就像这样..

```
@{
    //do this on the top most of your View, immediately after `using` statement
    Response.ContentType = "application/pdf";
    Response.AddHeader("Content-Disposition", "attachment; filename=receipt.pdf");
} 
```

或在控制器中..

```
public ActionResult Receipt() {
    Response.ContentType = "application/pdf";
    Response.AddHeader("Content-Disposition", "attachment; filename=receipt.pdf");

    return View();
} 
```

我在 Chrome 和 IE9 中试过这个，都在下载 pdf 文件。

我可能应该添加我正在使用[RazorPDF](https://github.com/RazorAnt/RazorPDFSample)来生成我的 PDF。这是一个关于它的博客：http: [//nyveldt.com/blog/post/Introducing-RazorPDF](http://nyveldt.com/blog/post/Introducing-RazorPDF)

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-04-08T16:22:59.140

您应该查看 Controller 的 File 方法。这正是它的用途。它返回 FilePathResult 而不是 ActionResult。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-07-02T07:11:18.203

姆努南，

您可以这样做以返回 FileStream：

```
/// <summary>
/// Creates a new Excel spreadsheet based on a template using the NPOI library.
/// The template is changed in memory and a copy of it is sent to
/// the user computer through a file stream.
/// </summary>
/// <returns>Excel report</returns>
[AcceptVerbs(HttpVerbs.Post)]
public ActionResult NPOICreate()
{
    try
    {
        // Opening the Excel template...
        FileStream fs =
            new FileStream(Server.MapPath(@"\Content\NPOITemplate.xls"), FileMode.Open, FileAccess.Read);

        // Getting the complete workbook...
        HSSFWorkbook templateWorkbook = new HSSFWorkbook(fs, true);

        // Getting the worksheet by its name...
        HSSFSheet sheet = templateWorkbook.GetSheet("Sheet1");

        // Getting the row... 0 is the first row.
        HSSFRow dataRow = sheet.GetRow(4);

        // Setting the value 77 at row 5 column 1
        dataRow.GetCell(0).SetCellValue(77);

        // Forcing formula recalculation...
        sheet.ForceFormulaRecalculation = true;

        MemoryStream ms = new MemoryStream();

        // Writing the workbook content to the FileStream...
        templateWorkbook.Write(ms);

        TempData["Message"] = "Excel report created successfully!";

        // Sending the server processed data back to the user computer...
        return File(ms.ToArray(), "application/vnd.ms-excel", "NPOINewFile.xls");
    }
    catch(Exception ex)
    {
        TempData["Message"] = "Oops! Something went wrong.";

        return RedirectToAction("NPOI");
    }
} 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2019-03-21T06:52:15.370

尽管标准操作结果 FileContentResult 或 FileStreamResult 可用于下载文件，但为了可重用性，创建自定义操作结果可能是最佳解决方案。

作为示例，让我们创建一个自定义操作结果，用于将数据动态导出到 Excel 文件以供下载。

ExcelResult 类继承了抽象的 ActionResult 类并重写了 ExecuteResult 方法。

我们使用 FastMember 包从 IEnumerable 对象创建 DataTable，使用 ClosedXML 包从 DataTable 创建 Excel 文件。

```
public class ExcelResult<T> : ActionResult
{
    private DataTable dataTable;
    private string fileName;

    public ExcelResult(IEnumerable<T> data, string filename, string[] columns)
    {
        this.dataTable = new DataTable();
        using (var reader = ObjectReader.Create(data, columns))
        {
            dataTable.Load(reader);
        }
        this.fileName = filename;
    }

    public override void ExecuteResult(ControllerContext context)
    {
        if (context != null)
        {
            var response = context.HttpContext.Response;
            response.Clear();
            response.ContentType = "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet";
            response.AddHeader("content-disposition", string.Format(@"attachment;filename=""{0}""", fileName));
            using (XLWorkbook wb = new XLWorkbook())
            {
                wb.Worksheets.Add(dataTable, "Sheet1");
                using (MemoryStream stream = new MemoryStream())
                {
                    wb.SaveAs(stream);
                    response.BinaryWrite(stream.ToArray());
                }
            }
        }
    }
} 
```

在控制器中使用自定义 ExcelResult 操作结果如下

```
[HttpGet]
public async Task<ExcelResult<MyViewModel>> ExportToExcel()
{
    var model = new Models.MyDataModel();
    var items = await model.GetItems();
    string[] columns = new string[] { "Column1", "Column2", "Column3" };
    string filename = "mydata.xlsx";
    return new ExcelResult<MyViewModel>(items, filename, columns);
} 
```

由于我们使用 HttpGet 下载文件，因此创建一个没有模型和空布局的空视图。

关于下载动态创建的文件的自定义操作结果的博客文章：

[https://acanozturk.blogspot.com/2019/03/custom-actionresult-for-files-in-aspnet.html](https://acanozturk.blogspot.com/2019/03/custom-actionresult-for-files-in-aspnet.html)

* * *

## 回答 #7

> 赞同：-4
> 
> 时间：2009-04-08T17:03:43.210

使用 .ashx 文件类型并使用相同的代码

# c++ - 你如何“解码”Visual Studio 链接错误？

> ID：730700
> 
> 赞同：6
> 
> 时间：2009-04-08T16:07:43.890
> 
> 标签：c++, linker

我在 C++ 方面不是很有经验，当我必须使用另一个库并且遇到链接错误时，我完全不知道编译器试图告诉我什么（除了找不到参考某处）。

是否有任何好的链接可以详细描述链接错误消息中符号和字符的含义？或者如何解决此类错误？

例如，这是我最近收到的一个链接错误：

> testproj 错误 LNK2019：未解析的外部符号“公共：__thiscall google::protobuf::internal::GeneratedMessageReflection::GeneratedMessageReflection(class google::protobuf::Descriptor const *,class google::protobuf::Message const *,int const * const,int,int,int,class google::protobuf::DescriptorPool const *,int)" (??0GeneratedMessageReflection@internal@protobuf@google@@QAE@PBVDescriptor@23@PBVMessage@23@QBHHHHPBVDescriptorPool@23@H@ Z) 在函数“void __cdecl testproj::protobuf_BuildDesc_def_2eproto_AssignGlobalDescriptors(class google::protobuf::FileDescriptor const *)”中引用 (?protobuf_BuildDesc_def_2eproto_AssignGlobalDescriptors@testproj@@YAXPBVFileDescriptor@protobuf@google@@@Z)

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-08T16:15:30.313

符号是函数名称的“错位”版本。基本上是因为 c++ 重载（具有不同签名的 2 个函数可以具有相同的名称）。签名信息被编码到名称中。

您粘贴的消息具有**编码**和纯文本版本。

```
public: __thiscall google::protobuf::internal::GeneratedMessageReflection::GeneratedMessageReflection(class google::protobuf::Descriptor const *,class google::protobuf::Message const *,int const * const,int,int,int,class google::protobuf::DescriptorPool const *,int)

?0GeneratedMessageReflection@internal@protobuf@google@@QAE@PBVDescriptor@23@PBVMessage@23@QBHHHHPBVDescriptorPool@23@H@Z) 
```

都是一样的，只是后者被破坏了。

请注意，修改后的版本以：

```
?0GeneratedMessageReflection@internal@protobuf@google 
```

这很好地对应于：

```
google::protobuf::internal::GeneratedMessageReflection 
```

因为前几行为您提供了相关信息，所以您几乎可以忽略损坏的版本。签名的纯文本版本足以修复链接器错误。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-08T16:13:49.227

未解析的外部意味着您正在尝试调用另一个 DLL 中的函数，但您尚未链接到该 DLL 的 LIB 文件。

弄清楚如何解决这些链接器错误通常非常简单。错误消息准确地告诉您您需要知道的内容：

> google::protobuf::internal:: **GeneratedMessageReflection::GeneratedMessageReflection** (class google::protobuf::Descriptor const *,class google::protobuf::Message const *,int const * const,int,int,int,class google: :protobuf::DescriptorPool const *,int)"

这看起来像您正在尝试在谷歌库中使用名为“GeneratedMessageReflection”的类。找出提供此类的库，然后进入编译器链接器设置并在该库的 LIB 文件中添加“附加参考”。

# assembly - 有哪些好的 x86 汇编语言资源？

> ID：730707
> 
> 赞同：4
> 
> 时间：2009-04-08T16:09:07.443
> 
> 标签：assembly, x86, nasm

有哪些好的在线资源（参考资料、书籍、教程、文档等）可用于学习和编程汇编语言（更具体地说是 nasm）？似乎某些汇编语言相当晦涩难懂，有时我很难找到任何好的信息。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-08T16:22:31.733

The Art of Assembly Language online books are pretty useful. (Don't let the terrible website turn you off.)

[http://webster.cs.ucr.edu/AoA/index.html](http://webster.cs.ucr.edu/AoA/index.html)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-08T16:16:04.790

See [http://www.emu8086.com/](http://www.emu8086.com/) for a Windows-hosted 8086 emulator with assembler & tutorials.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-08T16:09:17.600

这里有一对：

*   [PC 汇编语言](http://www.drpaulcarter.com/pcasm/)
*   [NASM手册](http://www.nasm.us/doc/)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-08T16:17:06.923

Getting information from the horses mouth is always helpful with these kind of things. Check out the [Intel reference manual](http://www.intel.com/design/intarch/manuals/243191.htm).

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-08T16:20:54.543

For x86 and GNU/Linux: [http://programminggroundup.blogspot.com/](http://programminggroundup.blogspot.com/)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2019-08-28T19:58:00.690

在 NASM 的 2.05 版之前，该手册带有一个带有说明参考的附录。不过，这已因过时而被删除。最值得注意的是，它没有描述任何 AMD64 指令，除了开头的 REX 前缀的简短列表。我将 NASM 分叉到[https://hg.ulukai.org/ecm/insref并在](https://hg.ulukai.org/ecm/insref)[https://ulukai.org/ecm/insref.htm](https://ulukai.org/ecm/insref.htm)设置生成的文档，并添加了一些内容（在 repo 的历史中列出） .

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-29T21:07:22.880

汇编语言循序渐进真的很好。它直接针对nasm。

如果你能等到 10 月，新版本即将推出，涵盖更新的功能，例如 64 位，但旧版本仍然非常重要，尤其是对于初学者。

# c - 在 C 中使用 fwrite 时文件大小限制为 2GB？

> ID：730709
> 
> 赞同：22
> 
> 时间：2009-04-08T16:09:38.097
> 
> 标签：c, filesystems, fwrite, fat32

我有一个简短的 C 程序写入文件，直到磁盘上没有更多空间：

```
#include <stdio.h>

int main(void) {
  char c[] = "abcdefghij";
  size_t rez;
  FILE *f = fopen("filldisk.dat", "wb");
  while (1) {
    rez = fwrite(c, 1, sizeof(c), f);
    if (!rez) break;
  }
  fclose(f);
  return 0;
} 
```

当我运行程序（在 Linux 中）时，它会在文件达到 2GB 时停止。

由于 FILE 结构或其他原因，是否存在内部限制？

谢谢。

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2009-04-08T16:16:41.950

在 32 位系统上（即操作系统为 32 位），默认情况下，fopen 和 co 被限制为 32 位大小/偏移量/等...您需要启用大文件支持，或使用 *64 位选项：

[http://www.gnu.org/software/libc/manual/html_node/Opening-Streams.html#index-fopen64-931](http://www.gnu.org/software/libc/manual/html_node/Opening-Streams.html#index-fopen64-931)

那么你的 fs 需要支持这个，但是除了 fat 和其他原始 fs 之外，它们都支持创建大于 2 gb 的文件。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-04-08T23:26:08.407

> 当文件达到 2GB 时它会停止。
> 
> 由于 FILE 结构或其他原因，是否存在内部限制？

这是由于 libc（标准 C 库），默认情况下在 x86 (IA-32) Linux 系统上是 glibc（GNU 的 C 库）提供的 32 位函数。因此，默认情况下，[文件流大小](http://www.gnu.org/software/libc/manual/html_node/Opening-Streams.html#Opening-Streams)基于 32 位 - 2^(32-1)。

要使用[大文件支持](http://www.suse.de/~aj/linux_lfs.html)，请参阅网页。

```
#define _FILE_OFFSET_BITS  64
/* or more commonly add -D_FILE_OFFSET_BITS=64 to CFLAGS */

#include <stdio.h>

int main(void) {
  char c[] = "abcdefghij";
  size_t rez;
  FILE *f = fopen("filldisk.dat", "wb");
  while (1) {
    rez = fwrite(c, 1, sizeof(c), f);
    if ( rez < sizeof(c) ) { break; }
  }
  fclose(f);
  return 0;
} 
```

注意：大多数系统期望 fopen（和 off_t）基于 2^31 文件大小限制。将它们替换为`off64_t`并`fopen64`使其明确，~~并根据使用情况可能是最好的方法。~~但一般不推荐，因为它们是非标准的。

# ant - 使用 RSL 和 ANT 构建 Flex 项目

> ID：730715
> 
> 赞同：0
> 
> 时间：2009-04-08T16:11:25.737
> 
> 标签：ant, rsls

有人可以给我一个代码示例，说明如何使用框架 RSL 使用 ANT 构建 flex 项目吗？

这是我目前使用的，但生成的 SWF 文件太大了；

```
 <target name="main">
        <mxmlc 
            file="${SRC_DIR}/myApp.mxml" 
            output="${DEPLOY_DIR}/myApp.swf"
            actionscript-file-encoding="UTF-8"
            keep-generated-actionscript="true"
            incremental="true">
            <!-- Get default compiler options. -->
            <load-config filename="${FLEX_HOME}/frameworks/flex-config.xml"/>

            <!-- List of path elements that form the roots of ActionScript
            class hierarchies. -->
            <source-path path-element="${FLEX_HOME}/frameworks"/>

            <!-- List of SWC files or directories that contain SWC files. -->
            <compiler.library-path dir="${FLEX_HOME}/frameworks" append="true">
                <include name="libs" />
                <include name="../bundles/{locale}" />
            </compiler.library-path>
        </mxmlc>
</target> 
```

谢谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-26T11:01:49.847

这是一个很好的描述：[http ://soenkerohde.com/2008/04/using-the-flash-player-cache-for-the-flex-framework/](http://soenkerohde.com/2008/04/using-the-flash-player-cache-for-the-flex-framework/)

# java - 从 Java 访问本机代码的最快方法是什么？

> ID：730720
> 
> 赞同：9
> 
> 时间：2009-04-08T16:13:58.943
> 
> 标签：java, java-native-interface, native

从 Java 调用本机库的最快方法是什么？

我所知道的是

*   [NativeCall](http://johannburkard.de/software/nativecall/) - 我们目前使用的
*   [JNA](http://jna.java.net/) - 没用过，但看起来很合理
*   [JNI](http://java.sun.com/j2se/1.4.2/docs/guide/jni/) - 看起来写起来很可怕，但如果我们得到速度，我们会这样做

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-04-08T16:20:20.583

[Swig](http://www.swig.org/)也使 JNI 更容易。

在速度方面，我怀疑会有细微的变化——我强烈建议你选择一个你知道你会做很多事情的电话，并对提供的所有解决方案进行基准测试。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-04-08T16:20:39.037

JNI 是最快的。JNA 与 JNI 相比非常慢（调用开销可能是一个数量级），但它是一个很棒的库，因为它使本地访问变得如此简单。如果您需要偶尔调用一些本机 API，JNA 非常棒。如果您关心性能，我不会在任何“紧密循环”中使用它。

我不确定 NativeCall 在频谱中的位置。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-08T19:54:52.627

相当多的参数会影响编程语言之间接口的性能：JVM 运行在什么设备上，谁开发了它（如果它不是通常的 Sun JVM），是否需要从本机代码回调 Java 代码，线程模型您的操作系统上的 JVM 以及本机代码的异步程度...

恐怕您可能找不到可靠的基准来准确衡量您的需求。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-08T16:22:21.123

[这篇博客文章](http://aspsp.blogspot.com/2008/10/java-native-access.html)声称由于 JNA 使用的自省机制，它会比 JNI 慢得多。我怀疑 NativeCall 将使用类似的机制，从而以类似的方式执行。

但是，您可能应该根据您在 Java 和 C 之间引用和/或编组的特定对象进行基准测试。

我会[赞同 SWIG](http://www.swig.org)的建议。这使得 Java/C 接口的工作变得特别容易（更容易）。

# database - 如何确定一个日期范围是否出现在另一个日期范围内的任何时间？

> ID：730722
> 
> 赞同：6
> 
> 时间：2009-04-08T16:14:03.657
> 
> 标签：database, datetime, logic

`start_date`我有一个事件表，它用和`end_date`字段指定日期范围。我有另一个日期范围，在代码中指定，将当前周定义为“week_start”和“week_end”。

我想查询本周的所有事件。这些案例似乎是：

*   活动在一周内开始和结束
*   活动在一周前开始，但在一周内结束
*   活动在一周内开始，但在一周后结束
*   活动在一周前开始，也在一周后结束
*   *既不在一周内也不与一周重叠的事件将被忽略*

我正在尝试提出一个可以处理所有这些情况的查询。到目前为止，我只能获得处理周重叠或完全内部事件的案例；本质上，记录太多，或者根本没有。

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-04-08T16:17:31.637

```
(event.start BETWEEN week.start AND week.end)
OR
(week.start BETWEEN event.start AND event.end) 
```

简而言之，要么在活动期间开始一周，要么在一周内开始活动。

让我们检查一下：

> 活动在一周内开始和结束

**活动在一周内开始。**

> 活动在一周前开始，但在一周内结束

**一周在活动期间开始。**

> 活动在一周内开始，但在一周后结束

**活动在一周内开始。**

> 活动在一周前开始，也在一周后结束

**一周在活动期间开始。**

请注意，`BETWEEN`上面的表达式只是为了简洁起见。

严格的表达式如下所示：

```
(event.start >= week.start AND event.start < week.end)
OR
(week.start >= event.start AND week.start < event.end) 
```

, 前提`week.end`是`week.start + INTERVAL 7 DAY`.

IE。如果您的一周开始于`Sun, 0:00:00`，那么它应该结束于`next Sun, 0:00:00`（而不是`Sat, 0:00:00`）

这个表达式看起来比常用的更复杂：

```
event.start < week.end AND event.end > week.start 
```

，但前者更高效且索引友好。

有关性能比较，请参阅我的博客中的这些文章：

*   [**重叠范围：SQL Server**](http://explainextended.com/2009/06/30/overlapping-ranges-sql-server/)
*   [**重叠范围：MySQL**](http://explainextended.com/2009/07/01/overlapping-ranges-mysql/)
*   [**重叠范围：Oracle**](http://explainextended.com/2009/07/02/overlapping-ranges-oracle/)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-08T16:18:14.207

你可以这样写你的条件：

```
start_date <= week_end AND end_date >= week_start 
```

编辑：这假设 start_date <= end_date 和 week_start <= week_end （正确排序）并且由于不使用 OR （这在某些数据库上可能会产生性能问题）为您提供大多数数据库实现的最佳性能

Edit2：此解决方案还解决了在间隔之前开始并在间隔之后结束的事件的问题。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-06-18T16:21:52.823

为流行的 Catalin +1，但可惜我没有投票权。

您想要的限制条件只是表达 Allen 的“OVERLAPS”运算符的标准方式。

附加 SQL 警告：如果 end_date 可以为空，请务必将这些列中的空值视为“时间结束”。

额外的功能警告：确保使用 '<=' 与 '<' 来适应记录的时间段是否包括结束日期。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-08T16:18:33.317

为了...

```
where start_date >= week_start and end_date <= week_end
where start_date <= week_start and end_date >= week_start and end_date <= week_end
where start_date >= week_start and start_date <= week_end and end_date > week_end
where start_date < week_start and end_date > week_end 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-08T16:18:39.370

(end2 >= start1) && (start2 <= end1) 我认为对于任何相交的日期范围都会返回 true。

[我在这里](http://ryanfarley.com/blog/archive/2004/08/19/966.aspx)找到了一个关于这个的讨论，我觉得很有用。

# nhibernate - NHibernate SchemaExport 无法删除表....有时

> ID：730725
> 
> 赞同：4
> 
> 时间：2009-04-08T16:14:44.480
> 
> 标签：nhibernate, nhibernate-mapping

我将 NHibernate 用于我的应用程序的 DAL，特别是 NHibernate 的 SchemaExport 函数在执行单元测试之前删除/重新创建我的数据库模式。我遇到的问题是，当我运行单元测试并执行 SchemaExport 时，我的一个表每秒钟都无法删除。这将向我表明存在某种外键问题阻止 SchemaExport 删除我的表 - 但我无法弄清楚。我的架构很简单——一个人表、一个地址表和一个人地址表来支持两者之间的多对多关系。

```
public class Person
{
    public virtual int Id { get; set; }
    public virtual string Name { get; set; }
    public virtual IList<Address> Addresses {get;set;}

    public Person()
    {
        this.Addresses = new List<Address>();
    }

}

public class Address
{
    public virtual int Id { get; set; }
    public virtual string Street1 { get; set; }
    public virtual string Street2 { get; set; }
    public virtual string Postcode { get; set; }

} 
```

和我的 NHibernate 映射文件...

```
<hibernate-mapping xmlns="urn:nhibernate-mapping-2.2"
               assembly="MyHibernate"
               namespace="MyHibernate"
               >
<class name="Person" table="Person.Person">
    <id name="Id" column="Id">
        <generator class="native" ></generator>
    </id>
    <property name="Name" column="Name" length="50"></property>
    <bag name="Addresses" table="[Person].[PersonAddress]" lazy="false" cascade="all">
        <key column="PersonId" foreign-key="FK_Person_Person_Id"></key>
        <many-to-many class="Address" column="AddressId"></many-to-many>
    </bag>
</class> 
```

```
<hibernate-mapping xmlns="urn:nhibernate-mapping-2.2"
               assembly="MyHibernate"
               namespace="MyHibernate"
               >
<class name="Address" table="Person.Address">
    <id name="Id" column="Id">
        <generator class="native" ></generator>
    </id>
    <property name="Street1" column="Street1" length="50"></property>
    <property name="Street2" column="Street2" length="50"></property>
    <property name="Postcode" column="Postcode" length="50"></property>
</class> 
```

当我运行 `var cfg = new Configuration(); cfg.Configure(); cfg.AddAssembly(typeof(Person).Assembly);

```
 new SchemaExport(cfg).Execute(false, true, false, false) 
```

我得到一个 SQL 异常说：

MyHibernate.Tests.GenerateSchemaFixture.Can_Generate_Schema：NHibernate.HibernateException：数据库中已经有一个名为“Person”的对象。----> System.Data.SqlClient.SqlException：数据库中已经有一个名为“Person”的对象。

有任何想法吗？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2011-06-30T14:28:17.997

长期以来，这一直是我反复出现的问题。先执行drop或使用execute方法都没有解决问题（drop方法是执行Execute方法的快捷方法）。

在查看 NHibernate 源代码后，我找到了问题的根源。NHibernate 使用哈希码在数据库中存储外键名称。然而，哈希码的问题在于它们会随着时间、clr-version 和 appdomain 发生变化。您不能依赖哈希码来实现平等。（参考： http: [//blogs.msdn.com/b/ericlippert/archive/2011/02/28/guidelines-and-rules-for-gethashcode.aspx](http://blogs.msdn.com/b/ericlippert/archive/2011/02/28/guidelines-and-rules-for-gethashcode.aspx)）这就是为什么 NHibernate 不能总是删除外键，因此不能删除表。

这是 NHibernate 源代码的快照，用于创建唯一的外键名称：

```
public string UniqueColumnString(IEnumerable iterator, string referencedEntityName)
{
    // NH Different implementation (NH-1339)
    int result = 37;
    if (referencedEntityName != null)
    {
        result ^= referencedEntityName.GetHashCode();
    }
    foreach (object o in iterator)
    {
        result ^= o.GetHashCode();
    }
    return (name.GetHashCode().ToString("X") + result.GetHashCode().ToString("X"));
} 
```

所以这个问题不会被 NHibernate 解决，你必须自己解决。我通过在创建模式之前执行以下方法解决了这个问题。该方法仅从使用 NHibernate 映射的表中删除所有外键：

```
private static void DropAllForeignKeysFromDatabase()
{
  var tableNamesFromMappings = Configuration.ClassMappings.Select(x => x.Table.Name);

  var dropAllForeignKeysSql =
    @"
      DECLARE @cmd nvarchar(1000)
      DECLARE @fk_table_name nvarchar(1000)
      DECLARE @fk_name nvarchar(1000)

      DECLARE cursor_fkeys CURSOR FOR
      SELECT  OBJECT_NAME(fk.parent_object_id) AS fk_table_name,
              fk.name as fk_name
      FROM    sys.foreign_keys fk  JOIN
              sys.tables tbl ON tbl.OBJECT_ID = fk.referenced_object_id
      WHERE OBJECT_NAME(fk.parent_object_id) in ('" + String.Join("','", tableNamesFromMappings) + @"')

      OPEN cursor_fkeys
      FETCH NEXT FROM cursor_fkeys
      INTO @fk_table_name, @fk_name

      WHILE @@FETCH_STATUS=0
      BEGIN
        SET @cmd = 'ALTER TABLE [' + @fk_table_name + '] DROP CONSTRAINT [' + @fk_name + ']'
        exec dbo.sp_executesql @cmd

        FETCH NEXT FROM cursor_fkeys
        INTO @fk_table_name, @fk_name
      END
      CLOSE cursor_fkeys
      DEALLOCATE cursor_fkeys
    ;";

    using (var connection = SessionFactory.OpenSession().Connection)
    {
      var command = connection.CreateCommand();
      command.CommandText = dropAllForeignKeysSql;
      command.ExecuteNonQuery();
    }
  } 
```

非常适合我。我希望其他人也可以使用它。这是我抓取 sql 脚本以删除所有外键的地方：http: [//mafudge.mysite.syr.edu/2010/05/07/dropping-all-the-foreign-keys-in-your-sql-server-数据库/](http://mafudge.mysite.syr.edu/2010/05/07/dropping-all-the-foreign-keys-in-your-sql-server-database/)

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-04-16T14:32:16.763

找到了解决这个问题的方法。我刚刚将 SchemaExport 的使用分为两个调用。第一个删除现有模式，第二个重新创建它。

```
 var cfg = new Configuration();
 cfg.Configure();
 cfg.AddAssembly(typeof(Person).Assembly);

 SchemaExport se = new SchemaExport(cfg);
 //drop database 
 se.Drop(true, true);
 //re-create database
 se.Create(true, true); 
```

在我的测试类的 [TestFixtureSetUp] 中使用上述代码效果很好。我现在有一个干净的数据库模式可用于集成测试。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-10-18T05:37:38.650

我也收到了这个错误信息；但是，这是因为我删除了一个与另一个类具有多对一关系的类。因此，没有什么可以告诉 NHibernate 在下一次测试运行时删除 [now orphaned, but still referenced] 表。

我只是用手放下它，一切都很好。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-08-14T23:58:25.347

我遇到了同样的问题，我发现 Execute 方法似乎只能正常工作以执行完整的删除并重新创建，如果你这样调用它：

```
new SchemaExport(cfg).Execute(true, true, false, false) 
```

我不确定为什么 script 参数需要为 true，但将其设置为 true 也可以解决问题。

# wpf - 如何确定 WPF 中标签的顶部/左侧位置？

> ID：730726
> 
> 赞同：1
> 
> 时间：2009-04-08T16:14:47.633
> 
> 标签：wpf, label, flowlayoutpanel

我有一个包含在 FlowLayoutPanel 中的 WPF 标签，我想在用鼠标单击时确定标签的位置。我正在尝试将弹出控件放置在靠近标签的位置，并且只需要它的位置。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-08T16:23:57.143

该`Popup`控件内置了此功能。您可以使用`Placement`、`PlacementTarget`和属性来控制它`HorizontalOffset`。`VerticalOffset`

也就是说，如果您真的想找到相对于另一个控件的点，请使用该[`UIElement.TranslatePoint`](http://msdn.microsoft.com/en-us/library/system.windows.uielement.translatepoint.aspx)方法。

# vb6 - VB6 中的 IsDouble()？

> ID：730747
> 
> 赞同：3
> 
> 时间：2009-04-08T16:19:28.883
> 
> 标签：vb6

VB6 中有 IsDouble() 函数吗？如果我没记错的话，VB6 中的 Double 数据类型相当于 SQL Server 2000 中的浮点数。您的建议将不胜感激。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-04-17T07:20:33.100

实际上，您最好使用 Vartype 函数。

```
Private Function IsDouble(ByVal value As Variant) As Boolean
    IsDouble = (VarType(value) = vbDouble)
End Function 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-04-08T16:30:07.597

```
Function IsDouble(ByVal varValue As Variant) As Boolean
   Dim dblTest As Double
   On Error Resume Next
   dblTest = CDbl(varValue)
   IsDouble = Err.Number = 0 
End Function 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-08T17:23:06.377

IsNumeric() 很好，它只接受适合双精度的值。它具有区域意识，即对于法语区域设置，小数分隔符是逗号。

我只是在立即窗口中尝试过。

```
Debug.Print IsNumeric("4e308") 
False 
```

手册中对 VB6 Double 的定义是“VB6 Double 变量存储为 IEEE 64 位（8 字节）浮点数，范围从 -1.79769313486232E308 到 -4.94065645841247E-324（负值）和 4.94065645841247E -324 到 1.79769313486232E308 为正值”。

我认为这与在线[文档](http://msdn.microsoft.com/en-us/library/aa258271.aspx)中的 SQL Server 浮点数相同。“具有以下有效值的浮点精度数字数据：-1.79E + 308 到 -2.23E - 308、0 和 2.23E + 308 到 1.79E + 308。”

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2016-06-24T11:58:13.083

VB6中没有内置**的 IsDouble**函数，您可以使用内置的**IsNumeric**函数。否则，您可以使用以下用户定义函数来实现相同的目的：

```
Function IsDouble(ByVal value As Variant) As Boolean

   Dim convertedValue As Double

On Error Goto EH
   convertedValue = CDbl(value)
   IsDouble = True

Exit Function
   EH:
        IsDouble = False
End Function 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-08T16:20:56.493

有一个`IsNumeric()`功能应该足够好。如果这不足以满足您的需求，您还可以通过哪些方式进行解释？

# firefox - 如何更改 OS X 应用程序包中的可执行文件

> ID：730748
> 
> 赞同：6
> 
> 时间：2009-04-08T16:19:44.953
> 
> 标签：firefox, macos

我想在 Firefox 启动之前和退出之后运行一个脚本。在 Ubuntu 中，我通过创建一个新的快捷方式来做到这一点，它首先调用我的函数，然后调用 firefox 命令，然后调用我的最后一个函数。由于 firefox 命令会阻塞直到应用程序退出，所以我的最后一个函数会在进程结束后立即调用。

但是，在 OS XI 中不能很好地做到这一点，因为我最终在 Dock 上有两个图标。一个用于我的脚本变成了一个应用程序，另一个用于 Firefox 应用程序。我宁愿只有一个停靠图标并且不破坏 Firefox 更新。

我目前的解决方案是将 MacOS/firefox{,-bin} 重命名为前缀为“real-”，然后将我的 shell 脚本命名为“firefox-bin”。这可行，但我很确定下次 firefox 尝试自我更新我敬酒。

我尝试将捆绑包的 Info.plist 文件中的“CFBundleExecutable”属性更改为我的脚本，但这不起作用。

任何人都可以提供任何其他建议吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-08T18:24:47.290

创建一个常规应用程序包，但`LSUIElement`对其进行设置，因此脚本应用程序的图标从停靠栏中隐藏，并在包中包含*Firefox*。

一个简单的方法是使用[鸭嘴兽](http://www.sveinbjorn.org/platypus)。配置鸭嘴兽如下：

*   单击“参数”。选中“将 $1 设置为应用程序的路径”复选框，以便您的脚本可以引用包内的文件。

*   检查“在后台运行”——这 `LSUIElement`为你设置。

*   在“与应用程序捆绑到资源文件夹中的文件和文件夹”列表中，删除 Firefox。

*   将输出更改为“无”，以便您的日志消息转到系统控制台。

*   将 Firefox 的图标文件 (firefox.icns) 放到“自定义图标”上。

*   将“应用程序名称”更改为 Firefox。

对于看起来像这样的脚本：

```
#!/bin/sh
echo before >&2
$1/Contents/Resources/Firefox.app/Contents/MacOS/firefox-bin
echo after >&2 
```

你会得到如下输出：

```
4/8/09 1:16:33 PM [0x0-0x801801].net.sabi.PlatypusScript[76610] before 
4/8/09 1:16:35 PM firefox-bin[76613] Database load time: 0.373 (717 objects) 
4/8/09 1:16:35 PM [0x0-0x801801].net.sabi.PlatypusScript[76610]
2009-04-08 13:16:35.699 firefox-bin[76613:10b] Database load time: 0.373 (717 objects) 
4/8/09 1:16:57 PM [0x0-0x801801].net.sabi.PlatypusScript[76610] after 
```

如果您的用户以其他方式启动 Firefox，例如使用 URL 处理程序和打开 HTML 文件，您将需要使用本机应用程序，该应用程序可以将适当的 Apple 事件传递给 Firefox，并添加适当的 URL 和文件处理程序信息到 Info.plist。（[aemreceive](http://appscript.sourceforge.net/py-appscript/install.html)是一个方便的用于 Apple 事件接收的 Python 包装器。）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-08T16:33:26.980

如果在您的 Mac OS 版本上可用，请使用[Automator工作流程。](http://en.wikipedia.org/wiki/Automator_(software))

# c# - 是否可以在未安装 excel 的计算机上将 excel 文件中的信息提取到 c# 中？

> ID：730750
> 
> 赞同：3
> 
> 时间：2009-04-08T16:20:23.140
> 
> 标签：c#, excel

**是否可以在未安装 excel**的计算机上将 excel 文件 (.xls) 中的信息提取到 c# 中 ？

我有以下代码：

```
 OleDbConnection objConn = new 
          OleDbConnection(CONNECTION_STRING.Replace("<FILENAME>", fileName));

            try
            {
                objConnection.Open(); 
            }
            catch (Exception)
            {} 
```

当我在未安装 excel 的计算机上运行时尝试打开 OleDbConnection 时，它会引发 IndexOutOfRangeException（“找不到表 0”）。在具有 excel 的计算机上运行相同的代码就可以了。因此，我非常怀疑缺乏 excel 是罪魁祸首。

这是问题吗？如果是这样，我如何从文件中提取数据？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-08T19:42:04.780

查看开源[NExcel](http://nexcel.sourceforge.net/)。上次更新大约是 2 年前，因此它不支持较新的 Excel 2007 .xlsx 格式，但会读取 Excel 07-Excel 2003。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-08T17:39:55.120

没有安装 Excel 主要有两种方法

使用 Jet 数据库驱动程序打开该文件。这将使您可以访问行中的单元格值，将每个工作表视为一个表格。您将无权访问任何元信息（格式、评论等）。

使用[SpreadsheetGear.NET](http://www.spreadsheetgear.com/products/spreadsheetgear.net.aspx)，它允许您在没有 Excel 或任何其他依赖项的情况下打开、创建、操作和保存 Excel 二进制文件。可以下载 SpreadSheetGear 进行评估，但需要付费才能获得许可。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-08T16:51:00.917

这是可能的。如果格式是 .XLS，请使用 Microsoft Jet OLEDB 4.0（只要它在 32 位系统上运行就应该没有问题 - 64 位系统存在一些问题） - 我怀疑你已经搞砸了一点点。您可能走在正确的道路上。

查看此链接，它应该至少解释了您需要了解的一些内容：

[使用 ADO.NET C# DbProviderFactory 读取和写入 Excel 电子表格](http://davidhayden.com/blog/dave/archive/2006/05/26/2973.aspx)

# emacs - Hiding ^M in emacs

> ID：730751
> 
> 赞同：60
> 
> 时间：2009-04-08T16:20:37.337
> 
> 标签：emacs

Sometimes I need to read log files that have ^M (control-M) in the line endings. I can do a global replace to get rid of them, but then something more is logged to the log file and, of course, they all come back.

Setting unix-style or dos-style end-of-line encoding doesn't seem to make much difference (but unix-style is my default). I'm using the undecided-(unix|dos) coding system.

I'm on windows, reading log files created by log4net (although log4net obviously isn't the only source of this annoyance).

Any hints?

* * *

## 回答 #1

> 赞同：81
> 
> 时间：2009-04-15T09:33:34.470

```
(defun remove-dos-eol ()
  "Do not show ^M in files containing mixed UNIX and DOS line endings."
  (interactive)
  (setq buffer-display-table (make-display-table))
  (aset buffer-display-table ?\^M [])) 
```

Johan Bockgård 的解决方案。我在[这里](https://web.archive.org/web/20150713053259/http://www.archivum.info/comp.emacs/2007-06/00348/Re-Ignore-%5EM-in-mixed-(LF-and-CR+LF)-line-ended-textfiles.html)找到了。

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2009-04-09T07:00:25.523

现代版本的 emacs 知道如何处理 UNIX 和 DOS 行尾，所以当文件中出现 ^M 时，这意味着文件中混合了两者。当存在这种混合时，emacs 默认为 UNIX 模式，因此 ^M 是可见的。真正的解决方法是修复创建文件的程序，使其使用一致的行尾。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-04-08T17:43:37.310

关于什么？

```
C-x RET c dos RET C-x C-f FILENAME RET 
```

我制作了一个有两行的文件，第二行有回车。Emacs 会以 Unix 编码打开文件，而切换编码系统无济于事。但是，`universal-coding-system-argument`上述工作。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-04-08T16:32:33.377

I believe you can change the line coding system the file is using to the Unix format with

```
C-x RET f UNIX RET 
```

If you do that, the mode line should change to add the word "(Unix)", and all those ^M's should go away.

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-04-08T16:49:39.310

如果您想查看日志文件并简单地隐藏 ^M 而不是实际替换它们，您可以使用 Drew Adam 的[突出显示扩展](http://www.emacswiki.org/emacs/HighLight)来执行此操作。

您可以编写 elisp 代码或制作键盘宏来执行以下操作

```
select the whole buffer
hlt-highlight-regexp-region
C-q C-M
hlt-hide-default-face 
```

这将首先突出显示 ^M，然后隐藏它们。如果你想让他们回来使用 `hlt-show-default-face'

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2012-07-27T03:29:40.683

埃德里克的回答应该得到更多的关注。Johan Bockgård 的解决方案确实解决了发帖人的抱怨，因为它使 ^M 不可见，但这只是掩盖了潜在的问题，并鼓励进一步混合 Unix 和 DOS 行尾。

正确的解决方案是进行全局`M-x replace-regexp`以将*所有*行尾转换为 DOS 行尾（或 Unix，视情况而定）。然后关闭并重新打开文件（不确定是否`M-x revert-buffer`足够），^M 要么全部不可见，要么全部消失。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2013-11-07T07:51:02.937

把它放在你的 .emacs 中：

```
(defun dos2unix ()
  "Replace DOS eolns CR LF with Unix eolns CR"
  (interactive)
    (goto-char (point-min))
      (while (search-forward "\r" nil t) (replace-match ""))) 
```

现在您可以简单地调用`dos2unix`并删除所有`^M`字符。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2012-01-01T08:49:00.950

您可以更改 Control-M ( `^M`) 字符的显示表条目，以使其可显示为空白，甚至完全消失（空白）。请参阅库中的代码[`pp-c-l.el`](http://www.emacswiki.org/emacs/download/pp-c-l.el)( [Pretty Control-L](http://www.emacswiki.org/emacs/PrettyControlL) ) 以获得灵感。`^L`它以任意方式显示字符。

编辑：糟糕，我刚刚注意到@binOr 已经提到了这个方法。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2014-09-21T06:41:36.483

如果遇到`^M`在 Gnus 中收到的邮件中遇到 s，可以使用`W c`(wash CRs)，或者

```
(setq gnus-treat-strip-cr t) 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2010-12-16T16:00:47.353

使用 dos2unix、unix2dos（现在[的 tofrodos](http://packages.debian.org/sid/tofrodos)）怎么样？

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2015-03-04T15:50:38.080

sudeepdino008 的回答对我不起作用（我无法评论他的回答，所以我不得不添加自己的回答。）。

我能够使用以下代码修复它：

```
(defun dos2unix ()
  "Replace DOS eolns CR LF with Unix eolns CR"
  (interactive)
    (goto-char (point-min))
      (while (search-forward (string ?\C-m) nil t) (replace-match ""))) 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2019-04-24T15:37:27.197

就像 binOr 说的那样，将它添加到 Windows 上的 %APPDATA%.emacs.d\init.el 或您的配置中。

```
;; Windows EOL
(defun hide-dos-eol ()
  "Hide ^M in files containing mixed UNIX and DOS line endings."
  (interactive)
  (setq buffer-display-table (make-display-table))
  (aset buffer-display-table ?\^M []))

(defun show-dos-eol ()
  "Show ^M in files containing mixed UNIX and DOS line endings."
  (interactive)
  (setq buffer-display-table (make-display-table))
  (aset buffer-display-table ?\^M ?\^M))

(add-hook 'text-mode-hook 'hide-dos-eol) 
```

# winforms - Winforms DataBind 到控件的可见属性

> ID：730755
> 
> 赞同：6
> 
> 时间：2009-04-08T16:21:21.360
> 
> 标签：winforms, data-binding, .net-3.5, bindingsource

数据绑定到控件的可见属性时是否存在任何已知问题？

无论我的属性是什么，该控件始终不可见。

```
Public ReadOnly Property IsRibbonCategory() As Boolean
    Get
        Return True
    End Get
End Property 
```

我尝试了控件的文本属性和其他属性，它们似乎工作正常。

我正在尝试设置面板的可见属性。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2010-05-06T21:56:01.460

我发现如果你假设绑定到控件的 Visible 属性被破坏，尽管它有时会起作用，但生活会更好。请参阅[http://support.microsoft.com/kb/327305](http://support.microsoft.com/kb/327305)，其中说了很多（虽然知识库文章适用于 .NET 1.0 和 1.1，但至少在 2.0 中似乎仍然是一个问题）。

我创建了一个用于创建绑定的实用程序类，除其他外，它为我提供了一个集中的位置来添加解决方法。它没有在 Visible 上实际创建绑定，而是做了两件事：

1.  它订阅数据源的 INotifyPropertyChanged.PropertyChanged 事件，并在引发事件时根据需要设置 Visible 值。
2.  它根据当前数据源值设置 Visible 的初始值。

这需要一点反射代码，但还不错。关键是不要绑定 Visible 属性**并**执行解决方法，否则它将不起作用。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-07-30T01:46:34.090

解决方法：设置 BindingComplete 事件的 Visible 属性。

我在设置标签的 Visible 属性时遇到了同样的问题 - 始终保持为 false，即使设置 Enabled 属性工作正常。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2019-01-07T23:56:53.183

我刚刚在 .NET 4.7.1 和 Visual Studio 2017 中遇到了这个问题。为了解决这个问题，我将`Visible`控件上的属性更改为最初设置为`True`，就像我`False`以前一样。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-09T13:48:20.363

检查事项：

*   确保您已实例化具有 IsRibbonCategory 属性的类
*   您是否将绑定源的属性的数据源设置为类的实例
*   数据源更新模式应为“验证时”
*   确保您没有在控件上手动将可见属性设置为 false

希望有帮助。您可以发布更多代码吗？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-06-01T15:28:20.417

一种解决方法是使用组件将数据绑定到控件的可见性属性，而不是直接绑定到控件的可见性属性。见下面的代码：

```
using System;
using System.ComponentModel;
using System.Drawing;
using System.Windows.Forms;

namespace WindowsFormsApplication2
{
  public class ControlVisibilityBinding : Component
  {
    private static readonly object EventControlChanged = new object();
    private static readonly object EventVisibleChanged = new object();

    private System.Windows.Forms.Control _control;
    private bool _visible = true;

    public event EventHandler VisibleChanged
    {
        add { Events.AddHandler(EventVisibleChanged, value); }
        remove { Events.RemoveHandler(EventVisibleChanged, value); }
    }

    public event EventHandler ControlChanged
    {
        add { Events.AddHandler(EventControlChanged, value); }
        remove { Events.RemoveHandler(EventControlChanged, value); }
    }

    public ControlVisibilityBinding()
    {
    }

    public ControlVisibilityBinding(IContainer container)
    {
        container.Add(this);
    }

    [DefaultValue(null)]
    public System.Windows.Forms.Control Control
    {
        get { return _control; }
        set
        {
            if(_control == value)
            {
                return;
            }
            WireControl(_control, false);
            _control = value;
            if(_control != null)
            {
                _control.Visible = _visible;
            }
            WireControl(_control, true);
            OnControlChanged(EventArgs.Empty);
            OnVisibleChanged(EventArgs.Empty);
        }
    }

    [DefaultValue(true)]
    public bool Visible
    {
        get { return _visible; }
        set
        {
            if(_visible != value)
            {
                _visible = value;
            }
            if(Control != null)
            {
                Control.Visible = _visible;
            }
            OnVisibleChanged(EventArgs.Empty);
        }
    }

    private void WireControl(Control control, bool subscribe)
    {
        if(control == null)
        {
            return;
        }
        if(subscribe)
        {
            control.VisibleChanged += Control_VisibleChanged;
        }
        else
        {
            control.VisibleChanged -= Control_VisibleChanged;
        }
    }

    private void Control_VisibleChanged(object sender, EventArgs e)
    {
        OnVisibleChanged(EventArgs.Empty);
    }

    protected virtual void OnVisibleChanged(EventArgs e)
    {
        EventHandler subscribers = (EventHandler)Events[EventVisibleChanged];
        if(subscribers != null)
        {
            subscribers(this, e);
        }
    }

    protected virtual void OnControlChanged(EventArgs e)
    {
        EventHandler subscribers = (EventHandler)Events[EventControlChanged];
        if(subscribers != null)
        {
            subscribers(this, e);
        }
    }
}

static class Program
{
    [STAThread]
    static void Main()
    {
        using(Form form = new Form())
        using(FlowLayoutPanel groupBoxLayoutPanel = new FlowLayoutPanel())
        using(RadioButton visibleButton = new RadioButton())
        using(RadioButton hiddenButton = new RadioButton())
        using(GroupBox groupBox = new GroupBox())
        using(Label text = new Label())
        using(ControlVisibilityBinding visibilityBinding = new ControlVisibilityBinding())
        using(TextBox inputTextBox = new TextBox())
        {
            groupBoxLayoutPanel.Dock = DockStyle.Fill;
            groupBoxLayoutPanel.FlowDirection = FlowDirection.LeftToRight;
            groupBoxLayoutPanel.AutoSize = true;
            groupBoxLayoutPanel.AutoSizeMode = AutoSizeMode.GrowAndShrink;

            visibleButton.Text = "Show Label";
            visibleButton.AutoSize = true;
            hiddenButton.Text = "Hide Label";
            hiddenButton.AutoSize = true;
            groupBoxLayoutPanel.Controls.Add(visibleButton);
            groupBoxLayoutPanel.Controls.Add(hiddenButton);

            inputTextBox.Text = "Enter Label Text Here";
            inputTextBox.Dock = DockStyle.Top;

            groupBox.AutoSize = true;
            groupBox.AutoSizeMode = AutoSizeMode.GrowAndShrink;
            groupBox.Controls.Add(groupBoxLayoutPanel);
            groupBox.Dock = DockStyle.Fill;

            text.AutoSize = true;
            text.ForeColor = Color.Red;
            text.Dock = DockStyle.Bottom;
            text.BorderStyle = BorderStyle.FixedSingle;
            text.Font = new Font(text.Font.FontFamily, text.Font.Size * 1.25f, FontStyle.Bold | FontStyle.Italic);
            text.DataBindings.Add("Text", inputTextBox, "Text", true, DataSourceUpdateMode.Never);

            visibilityBinding.Control = text;
            visibleButton.DataBindings.Add("Checked", visibilityBinding, "Visible", true, DataSourceUpdateMode.OnPropertyChanged);
            Binding binding = hiddenButton.DataBindings.Add("Checked", visibilityBinding, "Visible", true, DataSourceUpdateMode.OnPropertyChanged);
            ConvertEventHandler invertConverter = (sender, e) => e.Value = !((bool)e.Value);
            binding.Format += invertConverter;
            binding.Parse += invertConverter;

            form.Controls.Add(inputTextBox);
            form.Controls.Add(text);
            form.Controls.Add(groupBox);
            Application.Run(form);
        }
    }
} 
```

}

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2019-06-16T13:50:20.723

这是我的转身，它可能很愚蠢，但它工作了很多次。

我在我的表单中放了一个**面板**控件，我让它**填写**我的表单，然后我把所有东西都放在那个面板中。我绑定**Visible**属性的所有控件都会根据我的 DataGridView 中的对象看到它们的可见性变化。

[![表格结构](https://i.stack.imgur.com/Pl7XU.png)](https://i.stack.imgur.com/Pl7XU.png)

# vbscript - Force messagebox to foreground

> ID：730759
> 
> 赞同：0
> 
> 时间：2009-04-08T16:22:35.570
> 
> 标签：vbscript, foxpro, visual-foxpro

I've got a VBScript that calls a Visual FoxPro Instance and runs a VFP program. Part of this program produces a messagebox. However, if my script is run from the Windows GUI (rather than a Command Prompt), then the message box produced doesn't necessarily come to the foreground.

In VBScript I have the following code:

```
Set oVFP = CreateObject("VisualFoxPro.Application")
oVFP.DoCmd("Messagebox('Hello World')")
Set oVFP = Nothing 
```

When I run this script from a DOS prompt, the message box pops to the foreground. When I double-click on the script in Explorer, the Explorer window may be covering the produced messagebox. There is no indication (no extra buttons on Start bar, for example) that the messagebox is hiding back behind the Explorer window waiting for user action.

Is there a way to force the produced messagebox to the foreground?

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-09T10:10:09.357

将未记录的“系统模式”标志添加到 MessageBox 选项：

```
Set oVFP = CreateObject("VisualFoxPro.Application")
oVFP.DoCmd("Messagebox('Hello World', 4096)")
Set oVFP = Nothing 
```

# python - 如何正确忽略异常

> ID：730764
> 
> 赞同：873
> 
> 时间：2009-04-08T16:23:00.640
> 
> 标签：python, exception, try-except

当你只想做一个 try-except 而不处理异常时，你如何在 Python 中做到这一点？

以下是正确的方法吗？

```
try:
    shutil.rmtree(path)
except:
    pass 
```

* * *

## 回答 #1

> 赞同：1151
> 
> 时间：2009-04-08T16:25:10.150

```
try:
    doSomething()
except: 
    pass 
```

或者

```
try:
    doSomething()
except Exception: 
    pass 
```

不同之处在于第一个也将捕获`KeyboardInterrupt`，`SystemExit`以及类似的东西，它们直接来自`exceptions.BaseException`，而不是`exceptions.Exception`。

有关详细信息，请参阅文档：

*   [`try`陈述](http://docs.python.org/reference/compound_stmts.html#try)
*   [例外](http://docs.python.org/library/exceptions)

* * *

## 回答 #2

> 赞同：158
> 
> 时间：2009-04-09T21:48:05.330

仅捕获您感兴趣的错误通常被认为是最佳实践。在这种情况下，`shutil.rmtree`可能是`OSError`：

```
>>> shutil.rmtree("/fake/dir")
Traceback (most recent call last):
    [...]
OSError: [Errno 2] No such file or directory: '/fake/dir' 
```

如果您想默默地忽略该错误，您可以：

```
try:
    shutil.rmtree(path)
except OSError:
    pass 
```

为什么？假设您（不知何故）不小心将整数而不是字符串传递给函数，例如：

```
shutil.rmtree(2) 
```

它会给出错误*“TypeError: coercing to Unicode: need string or buffer, int found”* ——你可能不想忽略它，这可能很难调试。

如果您*绝对*想忽略所有错误，请捕获`Exception`而不是简单的`except:`语句。再说一遍，为什么？

不指定异常会捕获*每个*异常，包括`SystemExit`例如`sys.exit()`使用的异常：

```
>>> try:
...     sys.exit(1)
... except:
...     pass
... 
>>> 
```

将此与正确退出的以下内容进行比较：

```
>>> try:
...     sys.exit(1)
... except Exception:
...     pass
... 
shell:~$ 
```

如果你想编写更好的行为代码，[`OSError`](http://docs.python.org/library/exceptions.html#exceptions.OSError)异常可以代表各种错误，但在上面的示例中我们只想忽略`Errno 2`，所以我们可以更具体：

```
import errno

try:
    shutil.rmtree(path)
except OSError as e:
    if e.errno != errno.ENOENT:
        # ignore "No such file or directory", but re-raise other errors
        raise 
```

* * *

## 回答 #3

> 赞同：118
> 
> 时间：2009-04-08T16:32:32.630

> 当你只想做一个 try catch 而不处理异常时，你如何在 Python 中做到这一点？

这取决于您所说的“处理”是什么意思。

如果您打算在不采取任何行动的情况下捕获它，那么您发布的代码将起作用。

如果你的意思是你想对异常采取行动而不阻止异常进入堆栈，那么你需要这样的东西：

```
try:
    do_something()
except:
    handle_exception()
    raise  #re-raise the exact same exception that was thrown 
```

* * *

## 回答 #4

> 赞同：107
> 
> 时间：2013-09-07T20:55:51.540

[首先，我从这个线程](https://stackoverflow.com/questions/574730/python-how-to-ignore-an-exception-and-proceed)中引用 Jack o'Connor 的答案。引用的线程已关闭，所以我在这里写：

“在 Python 3.4 中有一种新的方法可以做到这一点：

```
from contextlib import suppress

with suppress(Exception):
    # your code 
```

这是添加它的提交：http: [//hg.python.org/cpython/rev/406b47c64480](http://hg.python.org/cpython/rev/406b47c64480)

这是作者 Raymond Hettinger 谈论这个以及其他各种 Python 热点：[https ://youtu.be/OSGv2VnC0go?t=43m23s](https://youtu.be/OSGv2VnC0go?t=43m23s)

我对此的补充是 Python 2.7 等价物：

```
from contextlib import contextmanager

@contextmanager
def ignored(*exceptions):
    try:
        yield
    except exceptions:
        pass 
```

然后你像在 Python 3.4 中一样使用它：

```
with ignored(Exception):
    # your code 
```

* * *

## 回答 #5

> 赞同：59
> 
> 时间：2010-03-05T23:02:39.080

为了完整性：

```
>>> def divide(x, y):
...     try:
...         result = x / y
...     except ZeroDivisionError:
...         print("division by zero!")
...     else:
...         print("result is", result)
...     finally:
...         print("executing finally clause") 
```

另请注意，您可以像这样捕获异常：

```
>>> try:
...     this_fails()
... except ZeroDivisionError as err:
...     print("Handling run-time error:", err) 
```

...并像这样重新引发异常：

```
>>> try:
...     raise NameError('HiThere')
... except NameError:
...     print('An exception flew by!')
...     raise 
```

此外，可以将多种异常类型作为带括号的元组处理：

```
try:
    i_might_fail()
except (ValueError, TypeError) as ex:
    print('I failed with: ', ex) 
```

...或作为单独的 except 子句：

```
try:
    i_might_fail()
except ValueError:
    print('handling a ValueError...')
except TypeError:
    print('handling a TypeError...') 
```

...请参阅[python 教程](http://docs.python.org/tutorial/errors.html)。

* * *

## 回答 #6

> 赞同：46
> 
> 时间：2015-01-22T04:42:53.773

> # 如何正确忽略异常？

有几种方法可以做到这一点。

但是，示例的选择有一个简单的解决方案，不涵盖一般情况。

## 具体到例子：

代替

```
try:
    shutil.rmtree(path)
except:
    pass 
```

做这个：

```
shutil.rmtree(path, ignore_errors=True) 
```

这是一个特定于 的论点`shutil.rmtree`。您可以通过执行以下操作来查看有关它的帮助，并且您会看到它还可以允许处理错误的功能。

```
>>> import shutil
>>> help(shutil.rmtree) 
```

由于这仅涵盖示例的狭窄情况，我将进一步演示如果这些关键字参数不存在如何处理此问题。

# 一般的做法

由于以上仅涵盖示例的狭窄情况，我将进一步演示如果这些关键字参数不存在如何处理此问题。

## Python 3.4 中的新功能：

您可以导入`suppress`上下文管理器：

```
from contextlib import suppress 
```

但只抑制最具体的异常：

```
with suppress(FileNotFoundError):
    shutil.rmtree(path) 
```

您将默默地忽略 a `FileNotFoundError`：

```
>>> with suppress(FileNotFoundError):
...     shutil.rmtree('bajkjbkdlsjfljsf')
... 
>>> 
```

从[文档](https://docs.python.org/3/library/contextlib.html#contextlib.suppress)：

> 与任何其他完全抑制异常的机制一样，此上下文管理器应仅用于覆盖非常具体的错误，其中已知静默继续执行程序是正确的做法。

请注意，`suppress`and`FileNotFoundError`仅在 Python 3 中可用。

如果您希望您的代码也可以在 Python 2 中工作，请参阅下一节：

## 蟒蛇 2 和 3：

> 当你只想做一个 try/except 而不处理异常时，你如何在 Python 中做到这一点？
> 
> 以下是正确的方法吗？
> 
> ```
> try :
>     shutil.rmtree ( path )
> except :
>     pass 
> ```

对于 Python 2 兼容代码，`pass`正确的方法是拥有一个无操作的语句。但是当你做一个 bare`except:`时，这与做`except BaseException:`which includes `GeneratorExit`, `KeyboardInterrupt`, and是一样的`SystemExit`，而且一般来说，你不想抓住那些东西。

事实上，您应该尽可能具体地命名异常。

这是 Python (2)[异常层次结构](https://docs.python.org/2/library/exceptions.html#exception-hierarchy)的一部分，如您所见，如果您捕获了更一般的异常，您可以隐藏您没有预料到的问题：

```
BaseException
 +-- SystemExit
 +-- KeyboardInterrupt
 +-- GeneratorExit
 +-- Exception
      +-- StopIteration
      +-- StandardError
      |    +-- BufferError
      |    +-- ArithmeticError
      |    |    +-- FloatingPointError
      |    |    +-- OverflowError
      |    |    +-- ZeroDivisionError
      |    +-- AssertionError
      |    +-- AttributeError
      |    +-- EnvironmentError
      |    |    +-- IOError
      |    |    +-- OSError
      |    |         +-- WindowsError (Windows)
      |    |         +-- VMSError (VMS)
      |    +-- EOFError
... and so on 
```

您可能想在此处捕获 OSError，并且您不关心的异常可能是没有目录。

我们可以从库中获取*特定*的错误号`errno`，如果没有，请重新提出：

```
import errno

try:
    shutil.rmtree(path)
except OSError as error:
    if error.errno == errno.ENOENT: # no such file or directory
        pass
    else: # we had an OSError we didn't expect, so reraise it
        raise 
```

请注意，一个简单的 raise 会引发原始异常，这可能是您在这种情况下想要的。写得更简洁，因为我们真的不需要`pass`在异常处理中显式地使用代码：

```
try:
    shutil.rmtree(path)
except OSError as error:
    if error.errno != errno.ENOENT: # no such file or directory
        raise 
```

* * *

## 回答 #7

> 赞同：11
> 
> 时间：2009-11-19T22:35:58.803

```
try:
      doSomething()
except Exception: 
    pass
else:
      stuffDoneIf()
      TryClauseSucceeds() 
```

仅供参考，else 子句可以跟踪所有异常，并且只有在 try 中的代码不会导致异常时才会运行。

* * *

## 回答 #8

> 赞同：11
> 
> 时间：2011-10-12T05:36:30.833

> 当你只想做一个 try catch 而不处理异常时，你如何在 Python 中做到这一点？

这将帮助您打印异常是什么：（即在不处理异常的情况下尝试捕获并打印异常。）

```
import sys
try:
    doSomething()
except:
    print "Unexpected error:", sys.exc_info()[0] 
```

* * *

## 回答 #9

> 赞同：9
> 
> 时间：2018-12-01T21:23:26.763

我需要忽略多个命令中的错误，而[他妈的](https://github.com/ajalt/fuckitpy)成功了

```
import fuckit

@fuckit
def helper():
    print('before')
    1/0
    print('after1')
    1/0
    print('after2')

helper() 
```

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2010-11-18T10:27:56.803

在 Python 中，我们对异常的处理与其他语言类似，但不同之处在于语法上的一些差异，例如，

```
try:
    #Your code in which exception can occur
except <here we can put in a particular exception name>:
    # We can call that exception here also, like ZeroDivisionError()
    # now your code
# We can put in a finally block also
finally:
    # Your code... 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2021-10-28T06:44:19.903

好吧，这不是 try-except 而是另一种处理异常的方法，如果你喜欢面向对象编程的话：

```
class MyExceptionHandler:

    def __enter__(self):
        ... # Do whatever when "with" block is started
        return self

    def __exit__(self, exc_type, exc_value, tb):
        return True 
```

然后到实际代码：

```
with MyExceptionHandler():
     ... # Code that may or may not raise an exception
     shutil.rmtree(path) 
```

这是如何工作的？

*   `__enter__`进入`with`块时运行。
*   `__exit__`退出`with`块 时运行
    *   这应该返回`True`以使可能的异常保持沉默。
    *   这应该返回`None`（或被认为是 False 的东西）以不使潜在的异常静音。
    *   异常类型、实际异常及其回溯作为（位置）参数传递。您可以使用这些来确定要做什么。

最后一点，更喜欢 try-except。如果您需要比平时更多的抽象，这可能很有用。

* * *

## 回答 #12

> 赞同：-5
> 
> 时间：2020-01-26T15:25:32.140

我通常只是这样做：

```
try:
    doSomething()
except:
    _ = "" 
```

# class - JNI signatures for nested classes?

> ID：730765
> 
> 赞同：3
> 
> 时间：2009-04-08T16:23:04.617
> 
> 标签：class, nested, java-native-interface, signature

I'm trying to use JNI on WindowsXP, java version:

java version "1.6.0_13" Java(TM) SE Runtime Environment (build 1.6.0_13-b03) Java HotSpot(TM) Client VM (build 11.3-b02, mixed mode, sharing)

When trying to get jclass for a nested class

jclass c = env->FindClass ("A$B"); assert (c);

the second line asserts, The same thing works ok on Linux with slightly different version of Java (1.5... IIRC).

I've tried several permutations like

LA$B; A.B LA.B;

but to no avail.

Any advice will be highly appreciated.

Martin

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-13T16:26:32.340

似乎问题已在[此线程](http://forums.sun.com/thread.jspa?threadID=5379144)中解决。

**更新：** Oracle 移动了论坛，新位置是[嵌套类的签名？](http://forums.oracle.com/forums/thread.jspa?messageID=6465881)

以下是问题的解决方法：

> 好的，我终于找到了问题所在。嵌套类被编译成一个单独的 java 类对象 (A$B.class) - 对于 C/C++ 程序员来说有点出乎意料。我没有打包文件，因此该类被报告为“未找到”。有趣的是它可以在 Linux 上运行。谢谢你的帮助！

我的另一个提示：如果`FindClass`返回 null 不要只是`assert`猜测。至少调用`env->ExceptionDescribe()`以获取堆栈跟踪`stderr`。更好的是，使用它`env->ExceptionOccurred()`来检查抛出的 Java 异常，就像您调用任何其他 Java 方法一样。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2021-12-23T07:57:44.297

好的，我在 Native Android 上也有类似的经历，`env->FindClass()`找不到带有`A$B`语法的嵌套类。我移动了东西，它甚至找不到非嵌套类。

原来的问题是 Java->C++ JNI 调用**可以**找到类，但是如果你有纯 C++ 线程，那么`jvm->GetEnv / jvm->AttachCurrentThread`这个线程可以做 JNI 的东西，但`FindClass`由于某种原因不能。

所以我的建议是，如果您`FindClass`在 Android 上遇到奇怪的行为，请尝试将其移至 Java 堆栈（即 Java 调用本机方法），它可能会有所帮助。请注意，如果稍后从另一个线程中使用它，您可能需要 esp `NewGlobalRef`。`jclass`

PS`A$B`是引用嵌套类的正确方法。

# cruisecontrol.net - triggers inside cruisecontrol.net

> ID：730766
> 
> 赞同：1
> 
> 时间：2009-04-08T16:23:09.140
> 
> 标签：cruisecontrol.net

Basically I have a project A inside my cruisecontrol that has 2 different triggers. One is an intervalTrigger which checks to see if modification exists in the repository and the builds the project A. And the other one is a projectTrigger which makes the project A gets build if project B is built. Now I have a executable file and I only want this to deppen on my intervalTrigger and not on the projectTrigger. Is that possible???? How????

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-10T17:58:48.807

我不确定我是否理解您的要求，但您始终可以创建一个新项目 C 并仅设置间隔触发器来执行您的文件。

# c# - impersonation and BackgroundWorker

> ID：730767
> 
> 赞同：2
> 
> 时间：2009-04-08T16:23:11.653
> 
> 标签：c#, .net, backgroundworker, impersonation

I have a little bit of a problem when trying to use the `BackgroundWorker` class with impersonation. Following the answers from Google, I got this code to impersonate

```
public class MyImpersonation {

    WindowsImpersonationContext impersonationContext;

    [DllImport("advapi32.dll")]
    public static extern int LogonUserA(String lpszUserName,
        String lpszDomain,
        String lpszPassword,
        int dwLogonType,
        int dwLogonProvider,
        ref IntPtr phToken);
    [DllImport("advapi32.dll", CharSet = CharSet.Auto, SetLastError = true)]
    public static extern int DuplicateToken(IntPtr hToken,
        int impersonationLevel,
        ref IntPtr hNewToken);

    [DllImport("advapi32.dll", CharSet = CharSet.Auto, SetLastError = true)]
    public static extern bool RevertToSelf();

    [DllImport("kernel32.dll", CharSet = CharSet.Auto)]
    public static extern bool CloseHandle(IntPtr handle);

    public bool impersonateValidUser(String userName, String domain, String password) {
        WindowsIdentity tempWindowsIdentity;
        IntPtr token = IntPtr.Zero;
        IntPtr tokenDuplicate = IntPtr.Zero;

        if (RevertToSelf()) {
            if (LogonUserA(userName, domain, password, LOGON32_LOGON_INTERACTIVE,
                LOGON32_PROVIDER_DEFAULT, ref token) != 0) {
                if (DuplicateToken(token, 2, ref tokenDuplicate) != 0) {
                    tempWindowsIdentity = new WindowsIdentity(tokenDuplicate);
                    impersonationContext = tempWindowsIdentity.Impersonate();
                    if (impersonationContext != null) {
                        CloseHandle(token);
                        CloseHandle(tokenDuplicate);
                        return true;
                    }
                }
            }
        }
        if (token != IntPtr.Zero)
            CloseHandle(token);
        if (tokenDuplicate != IntPtr.Zero)
            CloseHandle(tokenDuplicate);
        return false;
    }
} 
```

It worked really well until I used it with the `BackgroundWorker` class. In this case, I've added a impersonation in the the code that runs asynchronously. I have no errors, but the issue I'm having is that the impersonation does not work when it is used in the async method.

In code this looks something like this:

*   instantiate a BGWorker, and add an event handler to the DoWork event:

    ```
    _bgWorker = new BackgroundWorker();
    _bgWorker.DoWork += new DoWorkEventHandler(_bgWorker_DoWork); 
    ```

*   in the above handler, a impersonation is made before running some code.

    ```
    private void _bgWorker_DoWork(object sender, DoWorkEventArgs e) {        
            MyImpersonation myImpersonation = new MyImpersonation();
            myImpersonation.impersonateValidUser(user, domain, pass)        
           //run some code...        
           myImpersonation.undoImpersonation();        
    } 
    ```

*   the code is launched with

    ```
    BGWorker.RunWorkerAsync(); 
    ```

As I said before, no error is thrown, only that the code acts as if I didn't run any impersonation, that is with its default credentials.

Moreover, the impersonation method returns true, so the impersonation took place at a certain level, but probably not on the current thread.

This must happen because the async code runs on another thread, so there must be something that needs to be added to the `MyImpersonation` class. But what? :)

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-06-22T13:46:11.380

我也有同样的问题。我有一个后台工作人员在 DoWork 事件中模拟一个静态类。我试图冒充另一个 Active Domain 用户以读取主用户无权访问的目录。如果我在 IDE 中运行应用程序，模拟用户可以毫无问题地读取文件。如果我从文件系统运行应用程序，模拟仍然会发生，但会引发异常，说明被模拟的用户无权访问。

根据我的阅读，这是由于设置了 Assembly:SecurityPermissionAttribute 和 Assembly:PermissionSetAttribute。

在类声明之前，我有以下内容：

```
 <Assembly: SecurityPermissionAttribute(SecurityAction.RequestMinimum, UnmanagedCode:=True), _
Assembly: PermissionSetAttribute(SecurityAction.RequestMinimum, Name:="FullTrust")> 
```

在我的 StartImpersonating() 函数之前，我有：

```
<PermissionSetAttribute(SecurityAction.Demand, Name:="FullTrust")> _ 
```

但是，我正在使用 VB.NET 而不是 C#。

-D

# c++ - c++ 分析/优化：如何在优化的函数中获得更好的分析粒度

> ID：730773
> 
> 赞同：6
> 
> 时间：2009-04-08T16:24:36.063
> 
> 标签：c++, optimization, profiler

我正在使用 google 的 perftools ( [http://google-perftools.googlecode.com/svn/trunk/doc/cpuprofile.html](http://google-perftools.googlecode.com/svn/trunk/doc/cpuprofile.html) ) 进行 CPU 分析——这是一个很棒的工具，它帮助我执行了大量的 CPU 时间我的应用程序的改进。

不幸的是，我已经明白代码仍然有点慢，并且当使用 g++ 的 -O3 优化级别编译时，我只知道特定函数很慢，但不知道它的哪些方面很慢。

如果我删除 -O3 标志，则程序的未优化部分会超过此函数，并且我不会很清楚地了解函数中缓慢的实际部分。如果我保留 -O3 标志，那么函数的慢部分会被内联，我无法确定函数的哪些部分是慢的。

有什么建议么？谢谢你的帮助！

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-08T17:16:21.900

对于这样的事情，我一直使用“老派”的方式来做这件事：

将测量当前时间（或 cputime）的语句插入到您要在各个点测量的例程中。然后只需打印或记录它们之间的差异，您就会知道每段代码花费了多长时间。从那里您可以找出大部分时间在吃什么，然后进入该部分并获得细粒度的时间，直到您知道问题是什么以及如何解决它。

如果函数调用的开销不是问题，您还可以强制内联关闭`-fno-inline-small-functions -fno-inline-functions -fno-inline-functions-called-once -fno-inline`（我不确定这些开关如何相互交互，但我认为它们是独立的）。然后您可以使用您的普通分析器查看调用图配置文件并查看哪些函数调用花费了多少时间。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-08T21:19:27.557

如果您使用的是 linux，请使用[oprofile](http://oprofile.sourceforge.net/about/)。如果您使用的是 Windows，请使用 AMD 的[CodeAnalyst](http://developer.amd.com/cpu/CodeAnalyst/Pages/default.aspx)。

两者都将基于样本的配置文件提供到单个源代码行或汇编指令的级别，并且您应该可以毫无问题地识别函数中的“热点”。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-10T18:35:01.043

我花了几十年的时间进行性能调优。

人们喜欢他们的工具，但我发誓[这种方法](https://stackoverflow.com/questions/890222/analyzing-code-for-efficiency/893272#893272)。

# java - 用于 UUID 作为 JPA ID 的最佳（最有效）数据类型

> ID：730788
> 
> 赞同：3
> 
> 时间：2009-04-08T16:27:18.537
> 
> 标签：java, jpa, jakarta-ee, guid, uuid

我想使用 UUID 作为我的 JPA 对象的 ID。

我目前只是使用一个字符串来存储 UUID。什么会更有效率？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-08T16:32:53.923

你如何衡量效率？

例如，将 UUID（它是 a 的文本编码`byte[]`）存储为几个`long`值将允许您在 64 位架构上非常快速地比较它们（比`String`逐个字符的比较快得多）。但是，您的编码效率会受到影响，因为您必须编写自定义类型。

在你的情况下什么是重要的？

* * *

如果您对数据库中的性能感兴趣，性能将在一定程度上取决于您选择的数据库，但基本上都是逐字节比较 UUID。因此，重要的是使键之间的差异更有可能出现在键的开头。

UUID 在这方面设计得很好。最好的 UUID 是“随机”样式。它们在任何地方都没有很多公共子字符串，包括开头，并且它们不会泄露有关生成它们的机器的信息。但是，UUID 的“时间戳”样式也是一个很好的键，因为低位（变化很快）在字符串中是第一个，而高位（对于连续的 UUID 不会改变）来之后。

# project-management - 你如何为你从未做过的事情给出一个有效的时间估计？

> ID：730789
> 
> 赞同：30
> 
> 时间：2009-04-08T16:27:27.837
> 
> 标签：project-management, time, project-planning

作为一名新开发人员，我是员工中唯一的软件人员，我面临着一些挑战，但最困难的可能是时间估算。每次我不得不给出一个项目估算时，我都在挣扎。

那么我的问题是；如果我没有任何经验并且在我的环境中没有开发伙伴，我如何提供可靠的估计？我已经阅读了 Joel Spolsky 关于**[基于证据的调度](http://www.joelonsoftware.com/items/2007/10/26.html)**的文章，但是如果我没有任何*证据*，这怎么可能适用？

我很感激关于这个主题的任何建议。

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2009-04-08T16:29:37.487

您没有提供可靠的估计。你尽可能给出一个好的答案，并解释这*只是*一个非常粗略的估计，以及*为什么*它如此粗略。

如果你说得很清楚：

*   你无法给出准确的估计
*   您无法给出准确的估计是完全合理的，因为这与您以前所做的工作不同
*   随着时间的推移，您将更新估计值，您会更好地了解该主题

我想你应该没事。但是，您需要以书面形式*非常*清楚地说明这些事情，以免以后受到粗略估计的束缚。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-04-08T16:28:59.110

你可以说“我不知道，我没有足够的证据”

然后做一些原型设计以获得一些证据。

然后回答问题。

因此，您实际上可能能够估计何时能够给出估计。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-04-08T16:58:52.473

IMO Joel 在他的文章中离得很远，他的结论和建议并非基于任何现实。（对不起，乔尔）从根本上说，您应该能够在开始之前将您的工作安排到小时或更短的时间单位。但现实情况是，在开始编写代码之前，您并不知道这些工作单元（在非平凡系统中）将是什么。因此，在您打开引擎盖并让该细分准确地反映实际发生的情况之前，您无法按小时细分您将要做什么。

如果您希望该估算具有任何价值，那么给出一个项目估算是非常困难的。对程序员来说，做出准确的估计是很困难的，因为很多时候你直到深入了解项目才发现项目的所有复杂性。

因此，解决这个问题的方法是在进行估算时深入了解。对于较小的项目和错误修复，这相当简单：

*   复制您机器上的错误。
*   找到导致错误的代码。
*   弄清楚如何编写修复错误的代码。
*   估计编写该代码需要多长时间。

在查找您必须编写的代码时，您必须发现大部分或所有可能会超出您的估计的复杂性。

这种方法的有趣之处在于，生成估计所需的时间通常是实际完成工作的总时间的 90%。你实际上必须做这项工作才能得出一个估计值。尤其是错误修复，解决方案通常是一行代码，因此您的估计最终将是 5 分钟。这很好，因为可以围绕这样的估计设置截止日期。

随着您对此进行练习，您将越来越擅长“知道”事情需要多长时间。起初，您只能“知道”最小的项目需要多长时间。但随着时间的推移，您将能够估计更大和更大的项目。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-04-08T16:32:32.737

我首先根据我对问题的复杂性进行估计。问题有多大。它可能接触或需要多少件。这给了我一个一般的指导方针。然后我总是确保我添加了 15-25% 的软糖因素，因为你会错过一些东西。

最后，您非常清楚，这是基于您对问题的理解以及如何解决问题的粗略估计。

也不要以非常精确的增量给出任何粗略的估计。4.5小时不是一个粗略的估计。半天是一个粗略的估计。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-04-08T17:11:18.497

虽然它很粗糙，但我估计在代码行数上。这个参数，其对生产力的意义接近于零，仍然可以让您了解项目的复杂性。

衡量一个事实，平均而言，开发人员每天可以编写大约 200 行代码，最多 300 行代码。请记住，仅针对单人军队的编码：

*   一个 1000 行（逻辑）代码的小项目可以在一两周内完成
*   10.000 行（逻辑）代码的平均复杂性项目可以在两三个月内完成。
*   100.000 行（逻辑）代码的大型项目至少需要几年时间

对于逻辑代码，您必须添加测试，这已经包含在之前的估计中。为了了解复杂性，Gimp 是 600.000 行代码，内核范围在百万或更多。

除此之外，添加一个事实，如果您正在使用瀑布，您需要开发代码的时间实际上只是开发规范和设计所需时间的一小部分。我估计 2/3 时间用于规格 + 设计，剩下的 1/3 用于编码，甚至更多用于规格 + 设计部分。这真的很耗时。

因此，从复杂性到代码行数跟踪您的估算，考虑您拥有的人力以及他们可以并行工作的数量，并加上规范+设计的开销，您将得到一个非常粗略的估算。

我建议你[神话人月](https://rads.stackoverflow.com/amzn/click/com/0201835959)。在这方面，这是一本很棒的书。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-08T17:02:39.937

就个人而言，我将估计想象为统计分布 - 并尝试用它传达标准偏差的概念：

10 是 '它有 50% 的机会在 8 到 12 之间'

很难比整体项目估算更精确。完全有可能变得更精确（分成独立的独立故事，集体估计每个故事，以及其他敏捷实践）——但这是有代价的。

（此外，估计不应该是对可交付成果的参与 - 否则它会被填死并变得无用）

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-09T00:08:08.820

如果你拒绝对你从未做过的事情给出估计，你可能会一辈子都这样做。首先尽可能地拆分任务，这将帮助您弄清楚您将如何做。您将有更多机会将任务的一部分与您以前做过的事情进行比较。不要犹豫，将您的确定程度传达给您的经理。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-04-09T00:19:38.997

对于一个经验丰富的程序员来说，至少了解系统并在他们面前有一套合理的要求，“我不知道”不是一个有效的答案。如果你说你不知道你的 PHB 会去应用他们的 1337 h4x0r sk1lz 并按照“这听起来像小菜一碟，大约 1 小时”的顺序进行估算。

您应该能够将问题分解为您之前解决过的一系列较小的问题，并为每个部分提出一个合理的数字。指出它非常粗糙，一旦你对问题进行了全面分析，它可能会非常糟糕。

它们被称为“估计”，因为它们很粗糙。通过做更多的工作并学习尽可能多地利用过去的经验，您可以更好地进行估算。记住要考虑意外情况（中断、任务切换、生病的可能性、可能的返工等）。通常增加 50% 会使估计值更接近标记。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-04-09T00:30:33.323

提供一个粗略的估计，并对此非常清楚。

确定您将如何处理该项目的策略。特别要确定可以作为工作中间版本交付的系统部分。请特别注意其中最接近的部分，您将能够发布完整的功能，如果可能的话，将其余部分排除在范围之外（保留这些和出现的任何内容的列表，以安排为后续项目）。

使用短迭代。考虑/分析中间版本如何适应 2-6 周的迭代。考虑到这给你的学习，并调整总体估计。

继续第一次迭代，并应用您对所做假设的了解。您在早期迭代中的偏离程度通常表明估计存在问题。抵制考虑初始开销中估计部分的偏差的诱惑，因为您可能会延迟您意识到估计偏离的时间点。请注意，我确实理解/同意项目的速度随着时间的推移而增加，但考虑到这一点往往会隐藏/延迟问题。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-04-09T00:44:47.593

我一直这样做。几乎我所做的一切都是第一次。我如何估计？我**猜**！然后我又猜了。而且我会在每个 delta-time 间隔重新制定时间表时一直这样做，因为项目计划是迭代的，而您只有在执行时知道的内容。我的猜测非常好，因为多年后我已经弄清楚什么“看起来”容易，什么“看起来很难”

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-04-09T01:19:21.083

尝试[功能点分析](http://en.wikipedia.org/wiki/Function_point_analysis)。对于 CRUD 的东西，它给出了很好的数据。它的主要优点是它不是基于您要实现的内容，而是基于用户的要求。不过，您需要找出您的 FP 生产力。您可以使用相同语言的过去项目来做到这一点。

如果您无法构建历史数据集，则可以使用目标语言的平均生产力*。*它会给你一些东西，不一定接近现实，但至少会让你比较不同项目的努力。

现在，请注意，FPA 不适合算法繁重的软件，并且它依赖于 AVERAGES，这意味着您可能会高估或低估每个项目。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-04-21T19:48:43.720

我的同事总是说，首先估计项目长度，然后将其乘以 2 加 1，然后添加下一个最高单位。所以如果你的答案是 3 天，那么你会说 7 周。这是一个半开玩笑的想法，一个想法是首先估计项目，然后在完成后看看你离你有多远，也许你总是偏离 2 或 3 的倍数，或者其他什么。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-04-21T20:04:43.917

Any unknown task or job always has something which is known to a certain degree and easy to estimate. I split and I give estimates right away for the things I know and for the things I feel I know. The rest is honestly being declared as a thin spot and then we start "bargain". If work giver trusts my competence he will except my rough estimations and risks - we work together. It was never a failure, simply because I would never take a task which I can't lift or run into the ground (gut feeling?). If work giver doesn't trust me, I always recommend who to ask and where to look for a better option. Then we either work together or not. Most of the time we do, but everyone is on the safe side. I do my job, "thin spot specialist" gets his/her cut, managers are happy and customer's satisfied. Perhaps it's a bit naive, but it works for me :)

# c# - 如何从通用字典中获取值列表

> ID：730791
> 
> 赞同：0
> 
> 时间：2009-04-08T16:28:37.210
> 
> 标签：c#, generics, dictionary

我使用这个[ObjectPool](http://www.c-sharpcorner.com/uploadfile/rmcochran/genericidenetiymapobjectpool01262008090822am/genericidenetiymapobjectpool.aspx?login=true&user=kfinke)类作为我的身份映射的基础。但是，我需要带回一个类型的所有对象的列表。马修有：

```
 public IEnumerable<T> GetItems<T>()
    {
        Type myType = typeof(T);

        if (!m_pool.ContainsKey(myType))
            return new T[0];

        return m_pool[myType].Values as IEnumerable<T>;
    } 
```

但是，当我像这样对客户端进行更改时：

```
 pool.AddItem<Animal>(dog.ID, dog);
        pool.AddItem<Vegetable>(carrot.Identifier, carrot);
        pool.AddItem<Vegetable>(greenbean.Identifier, greenbean);
        pool.AddItem<Mineral>(carbon.UniqueID, carbon);

        Console.WriteLine("Dog is in the pool -- this statement is " + pool.ContainsKey<Animal>(dog.ID));

        IEnumerable<Vegetable> veggies = pool.GetItems<Vegetable>();
        foreach(Vegetable veg in veggies)
            Console.WriteLine(string.Format("{0} - {1}", veg.Color, veg.IsTasty)); 
```

蔬菜是空的。看起来 m_pool[myType].Values 不支持转换为 IEnumerable。

我尝试了一些事情，例如：

```
 IDictionary<int, T> dic = (IDictionary<int, T>) m_pool[myType];
        ICollection<T> values = (ICollection<T>)dic.Values; 
```

但是，我总是以一个铸造错误告终。

我错过了什么？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-08T16:37:30.153

好吧，该`GetItems`方法*永远不会*起作用，因为 as`Dictionary<int, object>.Values`不会实现`IEnumerable<T>`unless `T`is `object`。遗憾的是该方法从根本上被破坏了 - 哦对于某些单元测试。

我建议您检查许可证，如果可以修复`GetItems`，请执行以下操作：

```
public IEnumerable<T> GetItems<T>()
{
    Type myType = typeof(T);

    IDictionary<int, object> dictionary;

    if (!m_pool.TryGetValue(myType, out dictionary))
    {
        return new T[0];
    }

    return dictionary.Values.Cast<T>();
} 
```

如果您使用的是 .NET 3.5（您还需要`using System.Linq`获取`Cast`扩展方法）。如果您需要 .NET 2.0 的内容，请告诉我。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-28T11:42:00.310

我使用以下 ObjectPool （代码不是我的，我只是添加了几个方法）（如果您不使用 log4net，请将 logger.Info 替换为 Console.WriteLine；）

```
using System;
using System.Collections.Generic;
using System.Text;
using System.Collections.Specialized;
using System.Reflection;
using log4net;
using log4net.Config; 

namespace DH
{

    //DH - DataHolders
    /// <summary>
    /// This class models a storage structure for objects queriable by id 
    /// </summary>
    public class ObjectPool
    {

        #region Props
        private int totalCount;
        public int TotalCount
        {
            get
            {
                return totalCount;
            }
        }

        public int ID { get; set; }

        #endregion Props

        public ObjectPool ()
        {
            m_pool = new Dictionary<Type, Dictionary<Int32, Object>> ();
        }

        private Dictionary<Type, Dictionary<Int32, Object>> m_pool;

        public void AddItem<T> ( Int32 pID, T value )
        {
            Type myType = typeof ( T );

            if (!m_pool.ContainsKey ( myType ))
            {
                m_pool.Add ( myType, new Dictionary<int, object> () );
                m_pool[myType].Add ( pID, value );

                totalCount++;
                return;
            }

            if (!m_pool[myType].ContainsKey ( pID ))
            {
                m_pool[myType].Add ( pID, value );
                totalCount++;
                return;
            }

            m_pool[myType][pID] = value;
            totalCount++;
            //Utils.Debugger.WriteIf("Adding 1 to pool count , pool count is " + this.totalCount);
        }

        public void AddItem<T> ( T value )
        {
            Int32 pID = totalCount ;
            Type myType = typeof ( T );

            if (!m_pool.ContainsKey ( myType ))
            {
                m_pool.Add ( myType, new Dictionary<int, object> () );
                m_pool[myType].Add ( pID, value );

                totalCount++;
                return;
            }

            if (!m_pool[myType].ContainsKey ( pID ))
            {
                m_pool[myType].Add ( pID, value );
                totalCount++;
                return;
            }

            m_pool[myType][pID] = value;
            totalCount++;
            //Utils.Debugger.WriteIf("Adding 1 to pool count , pool count is " + this.totalCount);
        }

        public bool RemoveItem<T> ( Int32 pID )
        {
            Type myType = typeof ( T );

            if (!m_pool.ContainsKey ( myType ))
                return false;

            if (!m_pool[myType].ContainsKey ( pID ))
                return false;

            totalCount--;
            return m_pool[myType].Remove ( pID );
        }

        public bool ContainsKey<T> ( Int32 pID )
        {
            Type myType = typeof ( T );

            if (!m_pool.ContainsKey ( myType ))
                return false;

            if (!m_pool[myType].ContainsKey ( pID ))
                return false;

            return m_pool[myType].ContainsKey ( pID );
        }

        public IEnumerable<T> GetItems<T> ()
        {
            Type myType = typeof ( T );

            if (!m_pool.ContainsKey ( myType ))
                return new T[0];

            return m_pool[myType].Values as IEnumerable<T>;
        }

        /// <summary>
        /// Gets the item.
        /// </summary>
        /// <typeparam name="T"></typeparam>
        /// <param name="pID">The p ID.</param>
        /// <returns></returns>
        /// <exception cref="KeyNotFoundException"></exception>
        public T GetItem<T> ( Int32 pID )
        {
            // will throw KeyNotFoundException if either of the dictionaries 
            // does not hold the required key
            return (T)m_pool[typeof ( T )][pID];
        }

        /// <summary>
        /// 
        /// </summary>
        /// <typeparam name="T"></typeparam>
        /// <param name="strPropMetaName"> the string representation of the </param>
        /// <param name="strPropValue"></param>
        /// <returns></returns>
        public T GetItemByPropertyValue<T> ( String strPropMetaName , String strPropValue)
        {
            Type myType = typeof ( T );

            for (int i = 0; i < this.TotalCount; i++)
            {
                if (!m_pool.ContainsKey ( myType ))
                {
                    return default ( T );
                }
                else
                {
                    if (this.ContainsKey<T> ( i ))
                    {
                        //get an item object having the same type
                        T item = this.GetItem<T> ( i );

                        //if the object has the same property -- check its value
                        MemberInfo[] members = myType.GetMembers ();
                        for (int j = 0; j < members.Length; j++)
                        {
                            logger.Info ( "members[j].Name is " + members[j].Name );
                            //logger.Info ( ".MemberType.ToString() " + members[j].MemberType.ToString () );
                            //logger.Info ( "members[j].GetType().ToString() " + members[j].GetType ().ToString () );
                            //logger.Info ( " members[j].ToString () is " + members[j].ToString () );
                            //logger.Info ( " members[j].ToString () is " + members[j] );

                            if (members[j].Name.ToString ().Equals ( strPropMetaName ))
                            {

                                FieldInfo[] fi;
                                fi = myType.GetFields ( BindingFlags.Public | BindingFlags.NonPublic | BindingFlags.Instance );

                                foreach (FieldInfo f in fi)
                                {
                                    //logger.Info ( "f.GetValue( obj ) is " + f.GetValue ( item ) );
                                    if ( f.GetValue ( item ).ToString().Equals(strPropValue))
                                        return (T)m_pool[typeof ( T )][i];
                                    else 
                                        continue ;

                                } //eof foreach                             
                            }
                            else
                                continue;
                        } //eof for j

                    } //eof if 
                    else
                        continue;
                } //eof else if m_pool.ContainsKey
            }
            return default ( T );
        }

        private static readonly ILog logger =
LogManager.GetLogger ( typeof ( DH.ObjectPool ) );

    } //eof class pool  

} //eof namespace

namespace PoolSample
{
    class Program
    {
        private static readonly ILog logger =
LogManager.GetLogger ( typeof ( Program ) );

        public static DH.ObjectPool pool = new DH.ObjectPool ();

        static void Main ( string[] args )
        {
            DOMConfigurator.Configure (); //tis configures the logger 

            Animal dog = new Animal () { Name = "Fido", ID = 1 };
            Vegetable carrot = new Vegetable { Color = "Orange", Identifier = 2, IsTasty = true };
            Mineral carbon = new Mineral () { UniqueID = 3, IsPoisonousToAnimal = false , Name="some"};
            HolderForStrings hfs = new HolderForStrings () { ID = 4, Value = "user_name", MetaName = "meta_nam" };
            HolderForStrings hfs1 = new HolderForStrings () { ID = 5, Value = "user_name", MetaName = "hfs1" };
            Mineral carbon1 = new Mineral () { UniqueID = 3, IsPoisonousToAnimal = false, Name = "some1" };

            pool.AddItem ( dog );
            pool.AddItem ( carrot );
            pool.AddItem ( hfs );
            pool.AddItem ( hfs1 );

            //pool.AddItem<Animal>(dog.ID, dog);
            //pool.AddItem<Vegetable>(carrot.Identifier, carrot);
            //pool.AddItem<Mineral> ( carbon );
            //pool.AddItem<HolderForStrings> ( 1, hfs );

            //logger.Info("Dog is in the pool -- this statement is " + pool.ContainsKey<Animal>(dog.ID));
            //logger.Info("hfs is in the pool -- this statement is " + pool.ContainsKey<HolderForStrings>(hfs.ID));
            //logger.Info("The hfs value is from the poos is " + pool.GetItem<HolderForStrings>(4).Value);

            //logger.Info("poo.GetItems is " + pool.GetItems<HolderForStrings>());
            #region while
            //for (int i = 0; i < pool.Count -1 ; i++)
            int i = 1;
            do
            {
                try
                {
                    logger.Info ( "counting" );
                    logger.Info ( " i is " + i.ToString () );
                    if (pool.ContainsKey<Animal> ( i ))
                    {
                        logger.Info ( " I see animal which is " + pool.GetItem<Animal> ( i ).Name );
                    }

                    if (pool.ContainsKey<Vegetable> ( i ))
                    {
                        logger.Info ( " I see Vegetable which is " + pool.GetItem<Vegetable> ( i ).Color );
                    }

                    if (pool.ContainsKey<Mineral> ( i ))
                    {
                        logger.Info ( " I see Mineral which is " + pool.GetItem<Mineral> ( i ).IsPoisonousToAnimal );
                    }

                    if (pool.ContainsKey<HolderForStrings> ( i ))
                    {
                        logger.Info ( " I see string which is " + pool.GetItem<HolderForStrings> ( i ).Value );
                    }

                    //logger.Info("pool.GetItem<HolderForStrings>(4).Value); is " + pool.GetItem<Object>(i).ToString());

                    i = i + 1;
                }
                catch (KeyNotFoundException e)
                {
                    continue;
                }

            } //eof for 
            while (i < pool.TotalCount);
#endregion while
            #region AddHolders
            ////this is the success identifier
            //HoldInt16 holdVerifier = new HoldInt16()
            //{
            //  ID=0 ,
            //  MetaName = "ret",
            //  Value = 0
            //};
            //pool.AddItem<HoldInt16>(holdVerifier.ID, holdVerifier);

            //ListDictionary lidMetaName = pool.LidMetaName;
            ////this is the message
            //HoldString holdMsg = new HoldString( ref lidMetaName)
            //{
            //  ID=1,
            //  MetaName = "msg",
            //  Value = msg,
            //  Title = "title" 
            //};
            //pool.AddItem<HoldString>(holdMsg.ID, holdMsg);

            //HoldString holdmmsg = new HoldString(ref lidMetaName)
            //{
            //  ID=2,
            //  MetaName = "mmsg",
            //  Value = "mmsg" , 
            //  Title = "title" 
            //};
            #endregion AddHolders

            //Utils.Debugger.DebugListDictionary(ref msg, "domainName", ref lidMetaName);

            //get the value be metaName

            logger.Info ( "I queried the pool by property with meta Value and value user_name " );

            HolderForStrings HolderForStrings = pool.GetItemByPropertyValue<HolderForStrings> ( "MetaName", "hfs1" );
            //logger.Info ( "object dump" + Utils.Log.ObjDumper.DumpObject ( HolderForStrings ) );
            logger.Info ( "I found the following value for property with the name \"Name\" " );
            logger.Info ( HolderForStrings.MetaName);

            Console.ReadLine ();

        } //eof Main

    } //eof class 

    public class Animal
    {
        public Int32 ID { get; set; }
        public String Name { get; set; }
    }

    public class HolderForStrings
    {
        public Int32 ID { get; set; }
        public String Value { get; set; }
        public String MetaName { get; set; }
        Type ObjType = typeof ( string );
        public Int32 Size { get; set; }
        public bool IsOptional { get; set; }
        public bool IsPrimaryKey { get; set; }

    } //eof class

    public class Vegetable
    {
        public Int32 Identifier { get; set; }
        public String Color { get; set; }
        public Boolean IsTasty { get; set; }
    }

    public class Mineral
    {
        public Int32 UniqueID { get; set; }
        public Boolean IsPoisonousToAnimal { get; set; }
        public String Name { get; set; } 
    }

    #region classObjectPool
    //public class ObjectPool
    //{
    //  public int Count
    //  {
    //    get { return m_pool.Count; }
    //  }

    //  public ObjectPool ()
    //  {
    //    m_pool = new Dictionary<Type, Dictionary<Int32, Object>> ();
    //  }

    //  private Dictionary<Type, Dictionary<Int32, Object>> m_pool;

    //  public void AddItem<T> ( Int32 pID, T value )
    //  {
    //    Type myType = typeof ( T );

    //    if (!m_pool.ContainsKey ( myType ))
    //    {
    //      m_pool.Add ( myType, new Dictionary<int, object> () );
    //      m_pool[myType].Add ( pID, value );
    //      return;
    //    }

    //    if (!m_pool[myType].ContainsKey ( pID ))
    //    {
    //      m_pool[myType].Add ( pID, value );
    //      return;
    //    }

    //    m_pool[myType][pID] = value;
    //  }

    //  public bool RemoveItem<T> ( Int32 pID )
    //  {
    //    Type myType = typeof ( T );

    //    if (!m_pool.ContainsKey ( myType ))
    //      return false;

    //    if (!m_pool[myType].ContainsKey ( pID ))
    //      return false;

    //    return m_pool[myType].Remove ( pID );
    //  }

    //  public bool ContainsKey<T> ( Int32 pID )
    //  {
    //    Type myType = typeof ( T );

    //    if (!m_pool.ContainsKey ( myType ))
    //      return false;

    //    if (!m_pool[myType].ContainsKey ( pID ))
    //      return false;

    //    return m_pool[myType].ContainsKey ( pID );
    //  }

    //  public IEnumerable<T> GetItems<T> ()
    //  {
    //    Type myType = typeof ( T );

    //    if (!m_pool.ContainsKey ( myType ))
    //      return new T[0];

    //    return m_pool[myType].Values as IEnumerable<T>;
    //  }

    //  /// <summary>
    //  /// Gets the item.
    //  /// </summary>
    //  /// <typeparam name="T"></typeparam>
    //  /// <param name="pID">The p ID.</param>
    //  /// <returns></returns>
    //  /// <exception cref="KeyNotFoundException"></exception>
    //  public T GetItem<T> ( Int32 pID )
    //  {
    //    // will throw KeyNotFoundException if either of the dictionaries 
    //    // does not hold the required key
    //    return (T)m_pool[typeof ( T )][pID];
    //  }

    //} //eof pool  
    #endregion

    public enum EnumType : byte
    {
        String,
        Int32,
        Boolean
    }
} //eof program 
```

# mysql - MySQL中的递增

> ID：730792
> 
> 赞同：0
> 
> 时间：2009-04-08T16:28:39.673
> 
> 标签：mysql

我尝试在 mysql 中增加一个字段，但由于某些原因它似乎并没有真正工作......

那是我在 mysql 查询中运行的查询：

```
UPDATE profil_perso
SET profile_views = profile_views +1
WHERE id = 30537 
```

在状态栏中显示：1 行受最后一个命令影响。没有返回结果集。但它似乎没有奏效。起初我认为这仅仅是因为根本没有行。然后我运行了这个查询：

```
SELECT *
FROM profil_perso
WHERE id = 30537 
```

并找到 1 行，profile_views 字段仍为 0...

关于为什么会这样的任何想法？

[编辑] profile_views = 1（手动设置）此时它仍然不起作用。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-08T16:35:23.510

你在处理表时没有忘记提交事务`InnoDB`吗？

**更新：**

既然是`MyISAM`，我还要问几个愚蠢的问题：

1.  您确定要发布`UPDATE`并`SELECT`针对一个数据库吗？

    我曾经有一大群具有相同模式的数据库，当有人从错误的数据库中删除某些内容时，这曾经是一个问题。

    *   您不是在客户端上使用某种客户端缓存吗？你用的是什么客户端？

并尝试到`REPAIR`您的餐桌，这也可能是问题所在。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-08T16:31:52.507

只是为了验证 - profile_views 是零还是空？如果您将 1 添加到 null，您仍然会得到 null，所以这可能是您的问题。

预计到达时间：

所以它不是空的。下一个问题是，您是否启用了自动提交，或者，如果没有，您是否发出了“提交”？可能是它已更新，但您的更新从未提交。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-08T16:43:55.720

如果为空，则不会增加。

```
UPDATE profil_perso
SET profile_views = IF(profile_views,profile_views+1,1)
WHERE id = 30537 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-08T16:35:46.130

添加一些括号和合并以查看是否可以修复它：

```
UPDATE profil_perso
SET profile_views = ( COALESCE(profile_views,0) + 1 )
WHERE id = 30537 
```

# asp.net - 应用架构反馈

> ID：730796
> 
> 赞同：1
> 
> 时间：2009-04-08T16:30:04.133
> 
> 标签：asp.net, architecture, feedback

我正在寻找有关当前设计的一些反馈。

这是它目前的样子

1.  Web App (UI) 参考 BLL 层和 BusinessEntities 层
2.  BusinessEntites 层 - 包含接口和类（对属性进行内部验证）
3.  BLL（引用 BusinessEntities 和 DAL 层）- 主要为每个业务对象提供管理器，使用 Create() Save() Delete() 等方法。
4.  DAL（参考业务实体层）- 具有创建/添加/更新业务实体对象的数据库命令。

我不太确定我用于图层的命名约定，所以如果有人有更好的建议，我会很乐意采用它们。

我也不喜欢 DAL 引用 BusinessEntities 层的想法，但我还能如何返回对象而不是 Datasets/DataTables？

感谢您的任何反馈。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-08T17:21:30.843

关于您需要从 DAL 引用业务层，我同意这可能不是最优的——较低的层不应该知道它们上面的那些，它降低了可重用性并增加了额外的/潜在的循环依赖。

您是否考虑过让您的业务实体“充实自己”并使用 DAL 类执行自己的持久性操作，而不是让 DAL 充当它们的工厂（如在您当前的设计中）？这样，您的 DAL 将是数据库的更直接表示，并且业务实体将包含适当填充和持久化自身所需的（业务）逻辑。

此外，您指定的“BLL”层在我看来并没有真正包含业务逻辑。在我看来，它更像是实体的持久服务层。

因此，您建议的变体可能是：

1.  Web/UI，引用业务实体
2.  BusinessEntities，包含具有业务逻辑的接口和类。参考数据服务层
3.  DataServices，包含加载、查找和持久化数据的类。可以提供包含可由业务实体生成、使用和处理的数据（数据传输对象）的“通用”结构。参考 DAL。
4.  DAL，它只是提供映射到表的类。

根据您的要求，我会考虑将您的 BusinessEntities 和 DataServices（原始设计中的 BLL）合并到一个层中；我能想到将它们分开的唯一原因是，如果您正在做类似 Silverlight 的事情，您需要在客户端业务实体上进行异步数据操作。

当然，所有这些都与您对特定系统要求的不完全了解有关——您需要设计最适合您的特定应用程序的东西。祝你好运！

# iphone - 旋转 iPhone，并实例化一个新的 UIViewController？

> ID：730799
> 
> 赞同：7
> 
> 时间：2009-04-08T16:30:14.147
> 
> 标签：iphone

我想实现以下内容。当用户旋转 iPhone 时，我想实例化一个新的 UIViewController（在旋转时自动进行，而不是单击按钮或执行类似的操作）并向用户显示由这个新的 UIViewController 处理的横向视图。如何正确地做到这一点？

我试图在方法 willRotateToInterfaceOrientation 和 didRotateFromInterfaceOrientation 中实例化新控制器，但是这些方法都没有被调用！我怀疑这是因为当前控制器是由导航控制器推入的，而导航控制器本身由 tabBarController 处理。有什么线索吗？一个简单的代码片段将不胜感激。

先感谢您。

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2009-05-21T16:24:18.703

更简洁的方法是不使用 UIInterfaceOrientation 进行旋转。

为什么，因为那时您的界面或视图 1 实际上会旋转。这意味着您必须在视图 2 被移除后将其旋转回来以重新显示它。

为了弥补这一点，我简单地订阅了**UIDeviceOrientation**通知。微妙的不同。视图 1 不必支持自动旋转以使此方法起作用。在 viewDidLoad 中输入以下代码：

```
[[UIDevice currentDevice] beginGeneratingDeviceOrientationNotifications];
[[NSNotificationCenter defaultCenter] addObserver:self selector:@selector(detectOrientation) name:@"UIDeviceOrientationDidChangeNotification" object:nil]; 
```

然后只需定义方法detectOrientation：

```
-(void) detectOrientation {

     if (([[UIDevice currentDevice] orientation] == UIDeviceOrientationLandscapeLeft) || 
            ([[UIDevice currentDevice] orientation] == UIDeviceOrientationLandscapeRight)) {

        //load view 2

    } else if ([[UIDevice currentDevice] orientation] == UIDeviceOrientationPortrait) {

        // load view 1

    }   
} 
```

现在您的观点都不需要支持自动审核！但是，您需要在加载之前对视图 2 执行转换：

```
-(void) transformView2ToLandscape {

  NSInteger rotationDirection;
  UIDeviceOrientation currentOrientation = [[UIDevice currentDevice] orientation];

  if(currentOrientation == UIDeviceOrientationLandscapeLeft){
    rotationDirection = 1;
  }else {
    rotationDirection = -1;
  }

  CGRect myFrame = CGRectMake(0, 0, 480, 300);
  CGAffineTransform transform = [[self view2] transform];
  transform = CGAffineTransformRotate(transform, degreesToRadians(rotationDirection * 90));
  [[self view2] setFrame: myFrame];
  CGPoint center = CGPointMake(myFrame.size.height/2.0, myFrame.size.width/2.0);
  [[self view2] setTransform: transform];
  [[self view2] setCenter: center];

} 
```

这就是我在视图中不支持自动旋转的情况下交换视图或旋转的方式。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-04-08T17:20:20.143

我已经在应用程序上实现了这种确切类型的行为，关键是确保任何父控制器都实现了 shouldAutorotateToInterfaceOrientation 并且您当前的视图控制器也实现了它。在我的情况下，我使用的是一个选项卡控制器，它拦截了对 shouldAutorotateToInterfaceOrientation 的调用，我必须重写选项卡控制器才能使调用失败。视图控制器的默认行为是仅以纵向模式显示。

因此，您需要通过以下方式强制他们允许所有方向更改： -(BOOL)shouldAutorotateToInterfaceOrientation:(UIInterfaceOrientation)interfaceOrientation { return YES; }

然后为了加载一个新的视图控制器，你应该响应：

```
- (void)didRotateFromInterfaceOrientation:(UIInterfaceOrientation)fromInterfaceOrientation
{
  if((fromInterfaceOrientation == UIInterfaceOrientationPortrait) ||
     (fromInterfaceOrientation == UIInterfaceOrientationPortraitUpsideDown))
  {    
    // Load the view controller you want to display in landscape mode...
  }
} 
```

并且还可以使用：

```
-(void)willAnimateFirstHalfOfRotationToInterfaceOrientation:(UIInterfaceOrientation)toInterfaceOrientation duration:(NSTimeInterval)duration 
```

检测方向变化即将到来。

在我的情况下，我使用 didRotateFromInterfaceOrientation 检查最后一个方向是否为纵向，如果是，则加载我希望以横向模式显示的视图。

然后我在我正在加载的视图控制器中实现了相同的方法，它负责检测方向何时变回纵向并从视图堆栈中解散。

希望能有所帮助。

保罗

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-07-03T16:19:56.097

实际上只通知顶级控制器。您负责通知嵌套控制器。

将此添加到您的标签栏控制器：

```
- (void)didRotateFromInterfaceOrientation:(UIInterfaceOrientation)fromInterfaceOrientation {
    [self.selectedViewController didRotateFromInterfaceOrientation:fromInterfaceOrientation];
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-08T16:42:02.560

你实现了 shouldAutorotateToInterfaceOrientation 吗？如果没有，那么这可能就是您没有收到消息的原因。

# c# - C#使用asp.net mvc时如何设置autopostback属性？

> ID：730800
> 
> 赞同：21
> 
> 时间：2009-04-08T16:30:52.163
> 
> 标签：c#, asp.net-mvc, combobox, autopostback

我正在使用 asp.net MVC 框架。在我的页面上，我有一个 dropdwonbox，当单击一个选项时，我想转到另一个页面。但我找不到如何/在哪里将 autopostback 属性设置为 true。这是我正在使用的代码：

ASP:

```
<%= Html.DropDownList("qchap", new SelectList( (IEnumerable)ViewData["qchap"], "Id", "Title" )) %> 
```

控制器：

```
public ActionResult Index(int id)
{
    Chapter c =  new Chapter();
    ViewData["qchap"] = c.GetAllChaptersByManual(id);

    return View();
} 
```

我必须做什么才能使用自动回发功能？

* * *

## 回答 #1

> 赞同：37
> 
> 时间：2009-04-08T16:40:17.477

您可以使用 onchange 客户端事件：

```
<%= Html.DropDownList("qchap", 
       new SelectList( (IEnumerable)ViewData["qchap"], "Id", "Title" ),
       new { onchange = "this.form.submit();" }) %> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-08T16:41:40.377

似乎 DropDownList 辅助方法不支持这一点。也许在表单中使用它并使用自定义自定义 html 属性来提交表单。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-09T12:15:09.040

我也相信您可能希望将回发调整为 formsCollection

回发公共 ActionResult 索引（FormsCollection myform）

（我不在安装 MVC 的家用电脑上，因此无法验证此处的语法）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-01-09T13:44:45.700

我使用此代码解决。

```
Function Index(ByVal collectionField As FormCollection) As ActionResult

        Dim industryCategoryID As Long = collectionField.Item("ddlIndustry")
        If industryCategoryID = 0 Then
            Me.ViewData("IndustryList") = GlobalController.GetIndustryList
            Return View(_service.ListCompanies())
        Else
            Me.ViewData("IndustryList") = GlobalController.GetIndustryList
            Return View(_service.ListCompanies(industryCategoryID))
        End If

End Function 
```

这是针对 ActionResult 功能的

然后对于视图

```
 <p>
     <% Using Html.BeginForm()%>
        <%=Html.DropDownList("ddlIndustry", New SelectList(CType(ViewData("IndustryList"), IEnumerable), "ID", "Name"), "--Choose industry--", New With {.onchange = "this.form.submit()"})%>
     <% End Using %>  

    </p> 
```

我希望它有所帮助。如果您想要更完整的代码，请发送电子邮件至[boylevantz@gmail.com。](http://mailto:boylevantz@gmail.com)

# excel - VB - 插入空白行

> ID：730801
> 
> 赞同：2
> 
> 时间：2009-04-08T16:31:04.787
> 
> 标签：excel, vba

这对你们所有人来说都是小菜一碟，但我根本不懂 Visual Basic。如何编写语句以在 Excel 电子表格的两行之间重复插入一行？下面的一个例子：

```
F-3757 - GROF FILTER REWORKLIJN
F-3758 - POEDERAFSCHEIDER
F-3759 - FIJNFILTER
F-3760 - STOFILTER
F-3762 - AANZUIGFILTER
B-3771 - VENTILATOR STORTKOKER 
```

到：

```
F-3758 - POEDERAFSCHEIDER

F-3759 - FIJNFILTER

F-3760 - STOFILTER

F-3762 - AANZUIGFILTER

B-3771 - VENTILATOR STORTKOKER 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-08T16:36:57.470

```
Sub Insert_Blank_Rows()  
   ''//Select last row in worksheet.
   Selection.End(xlDown).Select 

   Do Until ActiveCell.Row = 1 
       ''//Insert blank row.
       ActiveCell.EntireRow.Insert shift:=xlDown 
        ''//Move up one row.
       ActiveCell.Offset(-1, 0).Select 
    Loop 
 End Sub 
```

[VBA Express](http://www.vbaexpress.com/kb/getarticle.php?kb_id=312#instr)展示了如何完成它的示例

# asp.net - IQueryable 针对带有连接的 SQL 2000 分页

> ID：730809
> 
> 赞同：0
> 
> 时间：2009-04-08T16:32:42.287
> 
> 标签：asp.net, linq

我有一个包含大约 10 个连接的查询。使用列表视图和 Linq 数据源，它对 SQL2008 进行了很好的分页，但在对 SQL2000 运行时无法产生正确的结果。没有抛出异常，但结果显然是乱序的，有时会返回相同的页面。通读 LINQ Docs，SQL2000 不支持对带有连接的查询进行分页。说得够多了，尽管我本以为会有例外。

我现在无法将数据移出 SQL2000。解决方案是执行完整查询，然后执行基于内存的分页。

```
protected void LinqDataSourceMain_Selecting(object sender,
    LinqDataSourceSelectEventArgs e)
{
    // var query = myquery with join...
    e.Result = query.ToList();
} 
```

现在的问题是：调用 ToList() 或 ToArray() 更有效吗？

AsEnumerable() 不能解决问题。查看使用反射器的扩展方法，它只是返回“源”，所以这对我来说很有意义。

```
e.Result = query.AsEnumerable();
public static IEnumerable<TSource> AsEnumerable<TSource>(
    this IEnumerable<TSource> source)
{
    return source;
} 
```

但是，以下是否比 ToList() 或 ToArray() 更有效？它确实有效，并且确实推迟了执行。

```
e.Result = query.ToEnumerable();

public static IEnumerable<TSource> ToEnumerable<TSource>(
    this IEnumerable<TSource> source)
{
    foreach (var item in source)
        yield return item;
} 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-08T16:40:00.270

`ToList()`将比`ToArray()`因为它不需要从超大缓冲区到固定大小的数组进行最终复制更有效。

如果要进行内存分页，则不需要*延迟*执行 (IMO)，因为您需要获取项目数和随机访问。您不希望每次都重新执行查询。

# visual-studio-2008 - VS2008 web site references

> ID：730814
> 
> 赞同：1
> 
> 时间：2009-04-08T16:33:05.950
> 
> 标签：visual-studio-2008, reference

I have a web site project in vs2008\. When you add a reference to a dll, it simply copies the dll into the bin directory. I do not like to check in the bin directory into version control. Any ideas on how to make the reference work without converting to a web application (I'm just doing maintenance on an existing site).

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-08T16:43:34.460

如果我理解正确，一种解决方案是：

在解决方案文件夹中为您希望在项目中引用的 DLL 创建一个支持文件夹（我们在此处使用 _support 以便转到树的顶部）。

> 解决方案
> 
> ..._support
> ...Web项目

将 DLL 复制到此处，然后从此目录中引用 DLL，这是一个更好的解决方案，然后签入 bin。

# visual-studio - Visual Studio 测试项目 - 不会在部署时复制文件夹

> ID：730822
> 
> 赞同：14
> 
> 时间：2009-04-08T16:35:48.127
> 
> 标签：visual-studio, visual-studio-2008, unit-testing, mstest

这是问题所在：
1\. 在您的 Visual Studio 解决方案中创建一个 TestProject。
2\. 打开 .testrunco​​nfig 文件并在“部署”菜单项下，选中“启用部署”复选框。
3\. 现在单击“添加目录...”按钮并添加一个包含一些文件的文件夹。
4\. 运行测试项目（使用虚拟测试）。

好的，现在去检查 TestResults 文件夹：您将看到所有文件都被直接复制（到顶层）- 文件夹本身没有被复制（它们下面的文件）。这在测试过程中弄乱了我的路径。谁能告诉如何复制文件夹而不仅仅是下面的文件？

谢谢。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-04-15T11:45:20.377

在使用它的测试类上使用该`[DeploymentItem]`属性。您可以指定一个目录：

```
[TestClass]
[DeploymentItem("blahblah\\myDirectory", "myDirectory")]
public class MyTest
{

} 
```

笔记：

*   开始测试时，DeploymentItem 非常慢。似乎每秒复制 2 个文件。
*   您可以在测试基类上指定属性。但是，如果您有多个测试项目，它并不总是有效。
*   您可能可以在具有标记为方法的 TestClass 上指定它`[AssemblyInitialize]`。那么您只需提供一次。不确定，你必须尝试。
*   源目录是相对于解决方案位置的。这几乎没有记录。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2010-08-27T23:52:33.410

在记事本中打开 .testsettings 文件。现在，您应该看到每个要复制的文件夹

```
<DeploymentItem filename="FolderName\" /> 
```

将此更改为

```
<DeploymentItem filename="FolderName\" outputDirectory="FolderName\" /> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-09-16T19:09:14.110

您拥有的另一个选项是在原始文件夹下创建另一个文件夹，然后该文件夹将部署到 out 目录。例如，您可以具有以下结构：

测试文件夹/

测试文件夹/测试部署/

然后在 testrunco​​nfig 中仍然选择 TestFolder 文件夹，TestDeployment 文件夹将部署到 out 目录。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-03-29T18:22:54.407

我今天也刚遇到这个问题。我通过在包含所需文件夹的项目中添加一个名为“deployment_files”的文件夹来解决它。然后我将所需的文件夹放入“deployment_files”文件夹中。然后，我在解决方案资源管理器的“解决方案项目”文件夹下打开了 LocalTestRun.testrunco​​nfig 文件。转到 testrunco​​nfig 属性窗口中的“部署”面板。将“deployment_files”目录添加到部署中，瞧。其中的文件夹被复制到测试结果输出文件夹中。

# mysql - Hibernate、C3P0、Mysql——断管

> ID：730827
> 
> 赞同：15
> 
> 时间：2009-04-08T16:39:49.460
> 
> 标签：mysql, hibernate, tomcat, c3p0

MySQL 的连接似乎有 8 小时的超时时间。我正在使用 Hibernate for ORM 在 Tomcat 中运行多个 WAR。8 小时后（即一夜之间），当它获得空闲连接时，我的管道损坏了。

我已经跟踪了代码，并加倍确定我提交或回滚了所有事务。

这是我的 hibernate.cfg.xml

```
<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE hibernate-configuration PUBLIC "-//Hibernate/Hibernate Configuration DTD 3.0//EN" "http://hibernate.sourceforge.net/hibernate-configuration-3.0.dtd">
<hibernate-configuration>
<session-factory>
    <property name="hibernate.bytecode.use_reflection_optimizer">false</property>
    <property name="hibernate.connection.driver_class">org.gjt.mm.mysql.Driver</property>
    <property name="hibernate.connection.password"></property>
    <property name="hibernate.connection.url">jdbc:mysql://localhost/test</property>
    <property name="hibernate.connection.username">root</property>
    <property name="hibernate.dialect">org.hibernate.dialect.MySQL5InnoDBDialect</property>
    <property name="hibernate.transaction.factory_class">org.hibernate.transaction.JDBCTransactionFactory</property>
    <property name="hibernate.current_session_context_class">thread</property>
    <!--property name="hibernate.show_sql">true</property>
    <property name="hibernate.format_sql">true</property-->

    <property name="c3p0.min_size">3</property>
    <property name="c3p0.max_size">5</property>
    <property name="c3p0.timeout">1800</property>
    <property name="c3p0.preferredTestQuery">SELECT 1</property>
    <property name="c3p0.testConnectionOnCheckout">true</property>
    <property name="c3p0.idle_test_period">100</property> <!-- seconds -->

    <property name="cache.provider_class">org.hibernate.cache.NoCacheProvider</property>
    <property name="cache.use_query_cache">false</property>
    <property name="cache.use_minimal_puts">false</property>
    <property name="max_fetch_depth">10</property>

    <property name="hibernate.hbm2ddl.auto">update</property>

    <!-- classes removed -->

</session-factory> 
```

我认为可以修复它的参数是`c3p0.idle_test_period`-- 它默认为 0。但是，在运行 8 小时后，我们仍然遇到 Broken Pipe 问题。虽然谷歌有多个帖子索引，但没有一个得到令人满意的答案。

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2009-04-10T16:09:09.227

所以事实证明我错过了启用 c3p0 的关键行（我正在调整的 c3p0 参数没有效果，因为 Hibernate 正在使用它内置的连接池——它适当地警告它不适合生产）。在 hibernate 2.x 中，设置`hibernate.c3p0.max_size`属性启用 c3p0 连接池。但是，在 3.x 中，您必须指定以下属性——

```
<property name="hibernate.connection.provider_class">org.hibernate.connection.C3P0ConnectionProvider</property> 
```

此外，这是我的最终配置参数——

```
<property name="hibernate.c3p0.min_size">3</property>
<property name="hibernate.c3p0.max_size">5</property>
<property name="hibernate.c3p0.timeout">1800</property>
<property name="hibernate.c3p0.idle_test_period">100</property> <!-- seconds --> 
```

不幸的是，Hibernate 和 c3p0 在这方面都有糟糕的文档。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-08T21:39:24.497

这里有两件事。您应该阅读[这篇文章](http://www.codefin.net/2007/05/hibernate-and-mysql-connection-timeouts.html)以了解更多详细信息，但要点是：

1.  如果需要，您可以将 MySQL [wait_timeout](http://dev.mysql.com/doc/refman/5.0/en/server-system-variables.html#sysvar_wait_timeout)设置调整为大于 8 小时。
2.  休眠设置应包括“休眠”。在“c3p0”之前，例如，`hibernate.c3p0.idle_test_period`而不仅仅是`c3p0.idle_test_period`

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2012-09-18T15:05:27.507

这是由于 c3p0 中的 tomcat 的 wait_timeout=28800 sec(8h) 和 maxIdleTime=0 的组合而导致管道损坏时的解决方案：

我已通过 my.ini 文件将本地 tomcat wait_timeout 更改为 120 秒（2 分钟）。我放置了以下内容：
maxIdleTime=100
idleConnectionTestPeriod=0（与默认值相同/好像它不存在）
其他：
acquireIncrement=2
minPoolSize=2
maxPoolSize=5
maxIdleTimeExcessConnections=10

我对这个设置没有任何问题。

我不需要使用 idleConnectionTestPeriod！

如果tomcat的wait_timeout是28800秒，maxIdleTime是25200，说明c3p0会提前3600sec（1h）关闭空闲连接，在tomcat抛出“断管”异常之前。对不对？！

如您所见，我只提供 maxIdleTime 没有问题。

不幸的是，这些：
[maxIdleTime](http://www.mchange.com/projects/c3p0/#maxIdleTime "最大空闲时间")
[idleConnectionTestPeriod](http://www.mchange.com/projects/c3p0/#idleConnectionTestPeriod "idleConnectionTestPeriod")
[configure_connection_testing](http://www.mchange.com/projects/c3p0/#configuring_connection_testing "配置连接测试")
[testConnectionOnCheckin](http://www.mchange.com/projects/c3p0/#testConnectionOnCheckin "testConnectionOnCheckin")
并没有解释太多极端情况。

而且，顺便说一句，这里是如何使用 Notepad++ 打开 tomcat 的 my.ini 文件：http: [//drupal.org/node/32715#comment-4907440](http://drupal.org/node/32715#comment-4907440)

干杯，
暴君

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-04-20T16:58:48.093

我有几个问题 - - 没有找到 C3P0ConnectionProvider - 我通过使用休眠 c3p0 版本解决了它

```
 <groupId>org.hibernate</groupId>
        <artifactId>hibernate-entitymanager</artifactId>
        <version>3.5.6-Final</version>
    </dependency>
          <!-- c3p0 -->
    <dependency>
        <groupId>org.hibernate</groupId>
        <artifactId>hibernate-c3p0</artifactId>
        <version>3.3.1.GA</version>
    </dependency> 
```

- 我在mysql上有那个wait_timeout问题。首先我设置 /etc/my.cnf wait_timeout=10 然后我将空闲超时值更改为低于 <10 的 wait_timeout 值，这解决了我的问题。

```
 <property name="hibernate.connection.provider_class" value="org.hibernate.connection.C3P0ConnectionProvider" /> <property name="hibernate.c3p0.acquire_increment" value="1" />
        <property name="hibernate.c3p0.idle_test_period"  value="28690"/>
        <property name="hibernate.c3p0.timeout" value="1800" />
        <property name="hibernate.c3p0.max_size" value="5" />
        <property name="hibernate.c3p0.min_size" value="3" />
        <property name="hibernate.c3p0.max_statement" value="50" />
        <property name="hibernate.c3p0.preferredTestQuery" value="select 1;"/> 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2013-06-12T10:24:48.047

我遇到了同样的问题，需要时间来找出解决方案。

我使用 Hibernate 4.0.1 和 mysql 5.1（没有 spring 框架），我遇到了这个问题。首先确保您正确配置了 c3p0 jar，这是必不可少的。

我在 hibernate.cfg.xml 中使用了这些属性

```
<property name="hibernate.c3p0.validate">true</property>
<property name="hibernate.connection.provider_class">org.hibernate.service.jdbc.connections.internal.C3P0ConnectionProvider</property>
<property name="hibernate.c3p0.min_size">5</property>
<property name="hibernate.c3p0.max_size">20</property>
<property name="hibernate.c3p0.max_statements">50</property>
<property name="hibernate.c3p0.preferredTestQuery">SELECT 1;</property>
<property name="hibernate.c3p0.testConnectionOnCheckout">true</property>
<property name="hibernate.c3p0.idle_test_period">10</property>
<property name="hibernate.c3p0.acquireRetryAttempts">5</property>
<property name="hibernate.c3p0.acquireRetryDelay">200</property>
<property name="hibernate.c3p0.timeout">40</property> 
```

但这没有用，因为 C3p0 仍然采用默认属性，而不是我在 hibernate.cfg.xml 中设置的属性，您可以在日志中检查它。所以，我在很多网站上搜索了正确的解决方案，最后我想出了这个。删除 cfg.xml 中的 C3p0 属性并在根路径（以及 cfg.xml）中创建 c3p0-config.xml 并按如下方式设置属性。

```
<c3p0-config>
<default-config> 
<property name="automaticTestTable">con_test</property>
<property name="checkoutTimeout">40</property> 
<property name="idleConnectionTestPeriod">10</property> 
<property name="initialPoolSize">10</property>
<property name="maxPoolSize">20</property> 
<property name="minPoolSize">5</property> 
<property name="maxStatements">50</property>
<property name="preferredTestQuery">SELECT 1;</property>
<property name="acquireRetryAttempts">5</property>
<property name="acquireRetryDelay">200</property>
<property name="maxIdleTime">30</property>
</default-config>
</c3p0-config> 
```

但是如果你运行，ORM 使用 jdbc 连接而不是 C3p0 连接池，因为我们应该在 hibernate.cfg.xml 中添加这些属性

```
<property name="hibernate.c3p0.validate">true</property>

<property name="hibernate.connection.provider_class">org.hibernate.service.jdbc.connections.internal.C3P0ConnectionProvider</property> 
```

现在一切正常（至少对我来说很好）并且问题已解决。

检查以下内容以获取参考。

[http://www.mchange.com/projects/c3p0/index.html#configuring_connection_testing](http://www.mchange.com/projects/c3p0/index.html#configuring_connection_testing)

[https://community.jboss.org/wiki/HowToConfigureTheC3P0ConnectionPool](https://community.jboss.org/wiki/HowToConfigureTheC3P0ConnectionPool)

我希望这能解决你的问题。

# c++ - 如何在 PC 的特定位置用 C++ 创建文件

> ID：730835
> 
> 赞同：0
> 
> 时间：2009-04-08T16:41:36.850
> 
> 标签：c++, file

大家好，我有一个问题，我不知道如何在 PC 的特定位置用 C++ 创建文件。例如 C:\file.txt 中的文件 (.txt)。有谁能够帮我？谢谢 ：）

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-08T16:44:45.470

```
#include <iostream>
#include <fstream>
using namespace std;
int main() {
  ofstream ofs("c:\\file.txt");
  if (ofs) {
     ofs << "hello, world!\n";
  }
  return 0;
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-08T16:43:39.920

它可能在愚弄你，因为它比你想象的要容易。您只需打开一个文件进行创建并为其指定路径名。瞧。

[参见](http://www.cplusplus.com/reference/iostream/fstream/open/)，例如，

```
// fstream::open
#include <fstream>
using namespace std;

int main () {

  fstream filestr;

  // You need a doubled backslash in a C string
  filestr.open ("C:\\file.txt", fstream::out);

  // >> i/o operations here <<

  filestr.close();

  return 0;
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-08T16:43:58.047

```
#include <stdio.h>

....
FILE *file;
file = fopen("c:/file.txt", "w"); 
```

# search - 如何防止 Google 重复内容问题 | 多站点

> ID：730837
> 
> 赞同：2
> 
> 时间：2009-04-08T16:41:47.177
> 
> 标签：search, seo, search-engine

我即将推出一个多域附属网站，它们有一个共同点，那就是内容。阅读有关重复内容和 Google 的问题，我有点担心父域或子站点可能会因重复内容而被搜索引擎禁止。

如果我有 100 个具有相似外观和基本相同内容但有一些小的元素更改的站点，我将如何继续防止禁止，正确索引这些站点？

我应该只防止子站点被机器人完全索引吗？

如果是这样，人们将如何找到他们的网站...我实际上认为父母应该只被索引以避免，但会喜欢她的其他专家想法。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-08T16:57:39.027

> 如果我有 100 个具有相似外观和基本相同内容但有一些小的元素更改的站点，我将如何继续防止禁止，正确索引这些站点？

对你来说不幸的是，这正是谷歌在其搜索列表中降级的内容，以使搜索结果更相关，减少操纵/游戏。

对我们（即 Google 的用户）来说幸运的是，他们的技术通常是有效的。

如果您想要 100 多个网站进行正确排名，您需要确保它们每个都有独特的内容。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-08T17:03:28.373

谷歌最近发布了一个更新，允许您在使用指向原始版本的重复内容的页面头部包含一个链接标签，它们被称为规范链接，它们存在的确切原因正是您提到的，能够使用重复的内容而不会受到惩罚

更多信息请看这里..

[http://googlewebmastercentral.blogspot.com/2009/02/specify-your-canonical.html](http://googlewebmastercentral.blogspot.com/2009/02/specify-your-canonical.html)

This doesn't mean that your sites with duplicated content will be ranked well for the duplicated content but it does mean the original is "protected". For decent ranking in the duplicated sites you will need to provide unique content

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-08T16:54:25.180

您不会立即被禁止。您必须由一个人报告。

我建议使用重复的内容启动，然后及时对其进行迭代，创建分散在您的网络中的独特内容。这将确保并非所有网站都是彼此的垃圾邮件副本，并且会导致 Google 将内容视为新鲜内容。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-08T16:59:32.313

我会说继续它，但尝试尽可能多地处理独特的内容，尤其是在最重要的地方（页面标题、标题等）。

即使这些网站确实被禁止了（更有可能他们只是省略了结果，但在你的情况下它们肯定会被禁止）你现在基本上处于相同的位置，如果你决定“noindex” “所有网站。

# code-generation - MyGeneration 模板创建教程

> ID：730849
> 
> 赞同：1
> 
> 时间：2009-04-08T16:45:18.277
> 
> 标签：code-generation, mygeneration

只是想知道是否有人有一些好的资源来学习如何使用 MyGeneration 创建新模板？

到目前为止，我只找到了一些非常基本的介绍，其余文档的大部分似乎都是关于使用现有模板生成代码。

我正在寻找自己的一些模板，以更好地适应我的工作方式，所以理想情况下，我希望能够了解应该如何最好地解决这个问题，而不必尝试挖掘现有模板并弄清楚他们是如何工作的。

谢谢！

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-11-03T20:50:20.907

检查以下资源：

*   [代码项目概述](http://www.codeproject.com/KB/dotnet/GriffinMyGen.aspx)
*   [MyGenerationSoftware 团队介绍](http://www.mygenerationsoftware.com/TemplateLibrary/Article/?guid=485028ae-85bc-4c5f-acb4-27bd4db16363)
*   [MyGenerationSoftware 模板库文章](http://www.mygenerationsoftware.com/TemplateLibrary/Articles/)

# c++ - Xcode 断点仅在调试期间设置时命中

> ID：730851
> 
> 赞同：4
> 
> 时间：2009-04-08T16:46:01.193
> 
> 标签：c++, xcode, breakpoints

我正在将 C++ sdk 从 Windows 移植到 Mac OSX 10.5。我在 Xcode 中有一个问题，我在某些文件中的断点只有在调试时设置它们才会被命中。如果我停止调试然后重新启动，断点将不再受到影响。如果我在不调试时添加它们，它们就不会受到影响。这仅在某些文件中，我的断点总是深蓝色。即我无法区分会被命中的断点和不会被命中的断点。

具体来说，我的sdk由各种动态库组成。这些是使用 Perforce jam 构建的，它根据我的操作系统和编译器版本（例如 Visual Studio 的 cl.exe 和 link.exe）调用各种编译和链接可执行文件。我有一个简单的（单元测试）命令行应用程序，它链接到这些动态库并调用其中的代码。Windows 上的这个应用程序是一个 Visual Studio 项目，我在其中对库代码设置断点并期望它们被命中。

我在 Xcode 3.1.2 中创建了相同的 C++ 命令行实用程序应用程序，它链接到 sdk dylib 并调用其中的代码。一些断点工作正常。我可以在从麻烦的代码中调用的代码中设置断点，然后跳到麻烦的代码，然后我可以很好地单步执行。麻烦的代码被编译到与正常工作的代码相同的dylib中。它也足够长和复杂，不能成为内联的候选者。

我尝试了以下方法：

*   懒惰地关闭加载符号。
*   使用 gcc 4.0 和 gcc 4.2 编译。
*   进行全面清洁并关机。
*   删除 xcodeproj 包的用户特定文件。
*   重命名文件，使它们不会与系统文件冲突。
*   清除断点窗口中的所有内容。
*   创建一个新的 Xcode 项目。

我的应用程序使用 DWARF 格式在调试中编译，并且我的库是使用 -g 标志构建的（以及 -v、-arch i386 和 -fvisibility-inlines-hidden）。

帮助将不胜感激。谢谢。

**更新**：很抱歉没有更新这个，我的 Mac 端口项目被推迟了。我从来没有解决这个问题，但发现它实际上只发生在构造函数体中。当我再次遇到问题时，我会重新审视这一点。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-08T17:12:27.477

你试过这些吗？ [为什么我的断点不起作用？](https://stackoverflow.com/questions/64790/why-arent-my-breakpoints-working-in-xcode)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-11-13T20:28:30.077

不是一个真正的答案：您应该在官方的 Apple bugtracker 中提交错误报告。您迟早会在那里得到答案的可能性很高 - 或者它可能真的是一个错误。

# javascript - jquery检测dom outsite jquery中的变化

> ID：730855
> 
> 赞同：0
> 
> 时间：2009-04-08T16:47:38.770
> 
> 标签：javascript, jquery, dom

是否可以使用 jQuery（或任何其他 JavaScript 函数）来检测何时触发 onmouseover 事件？

我有一个页面，现有的 javaScript 调用 onmouseover/out 事件来重写 div 的内容。我实际上只对鼠标悬停在 div 上时获取的内容感兴趣。onmouseover 事件是由我无法更改的程序在服务器端生成的:(。

关于如何做到这一点的任何建议？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-08T16:50:03.070

```
$("#idOfYourControl").hover(function() { /*mouseover event*/ }, function() { /*mouseout event*/ }); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-08T16:59:13.000

您可以在 jQuery 中使用 mouseover 事件处理程序。

[http://docs.jquery.com/Events/mouseover#fn](http://docs.jquery.com/Events/mouseover#fn)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-08T17:18:37.103

这是一个更具体的例子：

```
$("#idOfYourControl").hover(
   function() { $('#divToShowText').text($(this).text()) }, 
   function() { $('#divToShowText').text("") }
); 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-08T17:47:15.133

根据服务器写入原始鼠标悬停处理程序的方式，您可以使用简单的覆盖来添加您自己的钩子，然后您可以使用该钩子来检测被触发的旧钩子：

```
var oldHandler = yourElement.onmouseover;
yourElement.onmouseover = function() {
    //Do whatever new code you want here...
    $j.trigger('oldHandlerCalled');

    oldhandler();
} 
```

这是一个快速而肮脏的例子，但你明白了。不能保证这不会在 IE6 中泄漏内存；）

如果服务器通过 jQuery 附加事件，您可以查看 yourElement.data.events 并以比这更整洁的方式执行此操作。

# c# - 如何循环遍历 Treeview 节点的所有层？

> ID：730860
> 
> 赞同：4
> 
> 时间：2009-04-08T16:50:06.970
> 
> 标签：c#, winforms, .net-3.5, loops

***首先阅读 EDIT 2***

我正在尝试设置某种方式来在视觉上区分 winform 应用程序中的节点。例如，交替颜色。

有人可以让我走这条路吗？另外，以前有没有其他人必须这样做，你是怎么做到的？

谢谢

## 编辑

我也看到了背景色设置（谢谢），但我无法让它工作。我没有看到树视图的 Paint() 事件。我尝试将下面的代码放在我的 Form Load() 中，但它不起作用。可能是因为树视图已加载？

```
 private void frmCaseNotes_Load(object sender, System.EventArgs e)
    {
        foreach (TreeNode treeNode in treeView1.Nodes[0].Nodes)
        {
            treeNode.BackColor = Color.DeepSkyBlue;
        }
    } 
```

## 编辑 2

好的，我在 Form_Load() 上使用以下内容解决了最初的问题

```
 foreach (TreeNode treeNode in treeView1.Nodes)
        {
            if (treeNode.Index % 2 == 0)
            {
                 treeNode.ForeColor = Color.DodgerBlue;
            }
            else
            {
                treeNode.ForeColor = Color.Goldenrod;
            } 
```

现在我需要在某人的帮助下弄清楚如何循环遍历**所有**节点层并应用我的交替着色。如果我按照以下方式做一些事情，我可以*做到*这一点。

```
 foreach (TreeNode treeNode in treeView1.Nodes[1].Nodes[0].Nodes)
        {
            if (treeNode.Index % 2 == 0)
            {
                 treeNode.ForeColor = Color.DodgerBlue;
            }
            else
            {
                treeNode.ForeColor = Color.Goldenrod;
            } 
```

如何以编程方式遍历所有层？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-08T20:40:29.553

递归？

**编辑：添加了消除颜色重复的代码**

```
protected void ColorNodes(TreeNode root, Color firstColor, Color secondColor)
{
   Color nextColor;
   foreach (TreeNode childNode in root.Nodes)
   {     
      nextColor = childNode.ForeColor = childNode.Index % 2 == 0 ? firstColor : secondColor;

      if (childNode.Nodes.Count > 0)
      {
         // alternate colors for the next node
         if (nextColor == firstColor)
              ColorNodes(childNode, secondColor, firstColor);
         else
              ColorNodes(childNode, firstColor, secondColor);
      }
   }
}

  private void frmCaseNotes_Load(object sender, System.EventArgs e)
    {
       foreach (TreeNode rootNode in treeView1.Nodes)
       {
          ColorNodes(rootNode, Color.Goldenrod, Color.DodgerBlue);
       }
    } 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-13T20:38:11.957

伙计，这个问题很严重。广泛搜索很容易，但你是对的。深度搜索很痛苦。我希望它对你有帮助。遗憾的是，由于该站点上的问题数量众多，如此好的技巧可能会被遗忘。深度算法有点粗略，假设头节点没有兄弟姐妹。

```
//depth search on TreeView

TreeNode node = trv.Nodes[0];
Stack<TreeNode> list = new Stack<TreeNode>();
list.Push(node);

while (list.Count > 0)
{
    while (node.Nodes.Count > 0)
    {
        list.Push(node.Nodes[0]);
        node = node.Nodes[0];
    }

    //Will always have a leaf here as the current node. The leaf is not pushed.
    //If it has a sibling, I will try to go deeper on it.
    if (node.NextNode != null)
    {
        node = node.NextNode;
        continue;
    }

    //If it does NOT have a sibling, I will pop as many parents I need until someone
    //has a sibling, and go on from there.
    while (list.Count > 0 && node.NextNode == null)
    {
        node = list.Pop();
    }
    if (node.NextNode != null) node = node.NextNode;
}

//broadth search on TreeView

Queue<TreeNode> list = new Queue<TreeNode>();
foreach(TreeNode node in trv.Nodes)
{
    list.Enqueue(node);
}
foreach(TreeNode node in list)
{
    foreach(TreeNode childNode in node.Nodes)
    {
        list.Enqueue(childNode);
    }
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-08T16:52:45.793

最好的方法是重写 OnPaint 事件，并提供您自己的代码以在控件中绘图。

您可以在网上找到许多关于覆盖 onPaint 方法的示例。

编辑：我实际上对此进行了更多研究，您已经可以单独设置树视图节点的背景色。

```
Me.TreeView1.Nodes(0).BackColor = Color.AliceBlue 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-08T20:24:05.317

好的，这就是我得到的。不幸的是，它非常难看，我仍在手动编码我进入它的*深度。*它也不会阻止类似的颜色彼此相邻。建议？

```
foreach (TreeNode treeNode in treeView1.Nodes)
        {
            treeNode.ForeColor = treeNode.Index % 2 == 0 ? Color.DodgerBlue : Color.Goldenrod;

            foreach (TreeNode childNode in treeNode.Nodes)
            {
                childNode.ForeColor = childNode.Index % 2 == 0 ? Color.Goldenrod : Color.DodgerBlue;

                foreach (TreeNode childChildNode in childNode.Nodes)
                {
                    childChildNode.ForeColor = childChildNode.Index % 2 == 0 ? Color.DodgerBlue : Color.Goldenrod;

                    foreach (TreeNode childChildChildNode in childChildNode.Nodes)
                    {
                        childChildChildNode.ForeColor = childChildChildNode.Index % 2 == 0 ? Color.Goldenrod : Color.DodgerBlue;
                    }
                }
            }
        } 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-08T20:28:03.217

使用 TreeView 根中的子控件在 Control 类型上递归执行此操作，并检查 Control 类型是否是您要查找的节点的类型，强制转换，更改背景颜色，然后就完成了。

# c# - “Application.Restart”在 ClickOnce 部署的应用程序中不起作用

> ID：730880
> 
> 赞同：10
> 
> 时间：2009-04-08T16:54:05.400
> 
> 标签：c#, clickonce, restart, updating

> **可能重复：**
> [为什么 Application.Restart() 不可靠？](https://stackoverflow.com/questions/95098/why-is-application-restart-not-reliable)

我[直接从 MSDN 中提取了代码](http://msdn.microsoft.com/en-us/library/ms404263.aspx)。这会更新我的应用程序，但`Restart()`不起作用。应用程序关闭，但不会重新启动。

我添加了一个`MenuItem`来`Form`验证它是否`Restart()`有效：

```
private void restartToolStripMenuItem_Click(object sender, EventArgs e)
{
    Application.Restart();
} 
```

这将重新启动应用程序（当然，它不执行更新并且是用户启动的，所以它是相当无用的）。

这个应用程序我没有其他事情要做。关闭时表单没有事件处理程序，什么都没有。这是我可以构建的最基本的[Windows 窗体](http://en.wikipedia.org/wiki/Windows_Forms)应用程序（它只是在 JPEG中显示资源[JPEG](http://en.wikipedia.org/wiki/JPEG)`ImagePanel`）。

为什么`Restart()`在这里不起作用？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-06-12T20:10:23.633

您的应用程序是[Windows 窗体](http://en.wikipedia.org/wiki/Windows_Forms)还是[WPF](http://en.wikipedia.org/wiki/Windows_Presentation_Foundation)？因为`Application.Restart`只存在于 Windows 窗体`Application`对象 ( [System.Windows.Forms.Application](http://msdn.microsoft.com/en-us/library/system.windows.forms.application.aspx) ) 中，并且不受 WPF `Application`( [System.Windows.Applications](http://msdn.microsoft.com/en-us/library/system.windows.application.aspx) ) 下运行的应用程序支持。您仍然可以调用它，但由于应用程序上下文不同，它不起作用。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-01T19:30:15.150

If you are using a Mutex, or something of the like to ensure only one instance of the application is running at a time, that be causing this issue.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-20T17:33:18.180

尝试用[BeginInvoke](http://msdn.microsoft.com/en-us/library/system.windows.forms.control.begininvoke.aspx)包装它，以防它不在主[STA](https://stackoverflow.com/questions/127188/could-you-explain-sta-and-mta/127340#127340)线程上。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-23T01:45:37.053

您确定要从主窗体调用 Application.Restart 吗？如果您使用 .ShowDialog 调用表单，然后从该表单调用 Application.Restart，它将不起作用，因为 .ShowDialog 会导致对话框表单在单独的线程上运行。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-04-08T18:09:56.903

尝试提出一个新流程，也许可以解决它：

```
Process.Start(Application.ExecutablePath); 
```

# sql - Oracle 创建视图时抛出 SQL 错误

> ID：730884
> 
> 赞同：1
> 
> 时间：2009-04-08T16:55:45.710
> 
> 标签：sql, oracle, ora-00907

我正在尝试在 Oracle 数据库中创建视图，但不断收到 ORA-00907 错误（缺少右括号）。我的SQL如下：

```
CREATE VIEW my_view AS 
(
SELECT metadata.ID,metadata.Field1,metadata.Field2,metadata.Field3,metadata.Field4,attribute1.StrValue AS Attr1, attribute2.StrValue AS Attr2 
FROM metadata,data AS attribute1,data AS attribute2 
WHERE 
    (
    metadata.Type = 'TYPE1'
    ) 
AND 
    (
    metadata.ID = attribute1.ID AND attribute1.name = 'attr1'
    ) 
    AND 
    (
    metadata.ID = attribute2.ID AND attribute2.name = 'attr2'
    )
) 
```

表元数据定义实体，数据定义这些实体的属性。

这在 MS SQL 和 MySQL 中运行良好，但我不断从 Oracle 收到上述错误。

没有与 Oracle 合作太久，所以我不太了解它的怪癖。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-08T16:58:48.087

```
CREATE VIEW my_view AS 
(
SELECT  metadata.ID,metadata.Field1,metadata.Field2,
        metadata.Field3,metadata.Field4,
        attribute1.StrValue AS Attr1, attribute2.StrValue AS Attr2 
FROM    metadata, data /* No AS here */ attribute1,
        data /* No AS here */ attribute2 
WHERE 
        (
        metadata.Type = 'TYPE1'
        ) 
AND 
        (
        metadata.ID = attribute1.ID AND attribute1.name = 'attr1'
        ) 
        AND 
        (
        metadata.ID = attribute2.ID AND attribute2.name = 'attr2'
        )
) 
```

我删除`AS`了`data`和`attribute1`

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-08T17:00:57.413

既然你的括号都不是必需的，而且它们使阅读代码变得更加困难，为什么不去掉它们呢？

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-08T17:03:52.990

您需要删除 FROM 子句中的 AS。Oracle 允许使用可选的 AS 为列名加上别名，但不允许提供别名

```
SQL> ed
Wrote file afiedt.buf

  1  CREATE VIEW my_view AS
  2  (
  3  SELECT metadata.ID,metadata.Field1,metadata.Field2,metadata.Field3,metadata
.Field4,attribute1.StrValue AS Attr1, attribute2.StrValue AS Attr2
  4  FROM metadata,data attribute1,data attribute2
  5  WHERE
  6          (
  7          metadata.Type = 'TYPE1'
  8          )
  9  AND
 10          (
 11          metadata.ID = attribute1.ID AND attribute1.name = 'attr1'
 12          )
 13          AND
 14          (
 15          metadata.ID = attribute2.ID AND attribute2.name = 'attr2'
 16          )
 17* )
SQL> /

View created. 
```

根据您使用的工具，知道 SQL*Plus 将准确地显示语法错误发生的位置可能很有用——下面的片段显示它反对 AS 关键字。

```
SQL> ed
Wrote file afiedt.buf

  1  CREATE VIEW my_view AS
  2  (
  3  SELECT metadata.ID,metadata.Field1,metadata.Field2,metadata.Field3,metadata
.Field4,attribute1.StrValue AS Attr1, attribute2.StrValue AS Attr2
  4  FROM metadata,data AS attribute1,data AS attribute2
  5  WHERE
  6          (
  7          metadata.Type = 'TYPE1'
  8          )
  9  AND
 10          (
 11          metadata.ID = attribute1.ID AND attribute1.name = 'attr1'
 12          )
 13          AND
 14          (
 15          metadata.ID = attribute2.ID AND attribute2.name = 'attr2'
 16          )
 17* )
SQL> /
FROM metadata,data AS attribute1,data AS attribute2
                   *
ERROR at line 4:
ORA-00907: missing right parenthesis 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-08T17:14:00.017

其他人指出您的 FROM 子句中的 AS 关键字是问题所在。我建议以下内容作为同一语句的更清晰、更易于阅读的版本：

```
create view my_view as 
select
  meta.id
 ,meta.field1
 ,meta.field2
 ,meta.field3
 ,meta.field4
 ,att1.strvalue as attr1
 ,att2.strvalue as attr2 
from
  metadata meta
 ,data att1
 ,data att2 
where meta.id = att1.id 
  and meta.id = att2.id 
  and meta.type = 'TYPE1'
  and att1.name = 'attr1'
  and att2.name = 'attr2' 
```

# visual-c++ - 如何检测我是否需要安装 VCRedist？

> ID：730889
> 
> 赞同：21
> 
> 时间：2009-04-08T16:58:21.757
> 
> 标签：visual-c++, installation, redistributable

[我有一个与此](https://stackoverflow.com/questions/203195/how-to-detect-vc-2008-redistributable)非常相似的问题，但答案对我不起作用。

我维护设置的软件依赖于 VC++ 2008（确切地说是 SP1），因此如果尚未安装，我需要找到安装 VCRedist 的解决方案。我知道正确的方法是使用合并模块构建 msi，但它不在我手中。

我所指的重复问题的答案（已接受的问题）对我不起作用，因为每个小版本（例如 9.0.30729.01 与 9.0.30729.17）都有适当的 GUID，我无法猜测或预测未来的版本. 此外，我认为这不会检测到 Visual Studio，因此当 VCRedist 包已经在开发人员机器上时，它会不必要地安装它。我不想惹恼任何人，当然不是已经安装了 DevStudio 的人。

现在另一个答案说我应该像查看 WinSxs 文件夹一样`$WINDIR\WinSxS\x86_Microsoft.VC80.CRT_`，但这并不能（还）帮助我暗示 SP1，或者我现在缺少什么？是否有一个带有内部和“外部”版本号的表格，所以我可以暗示某个次要版本号？

我不敢相信微软没有为这种情况提供任何东西，但是搜索互联网已经太久了现在让我回到好的 ol' SO :)

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2011-12-18T15:34:44.980

对于 Visual Studio C++ 2010，[事情变得更容易了](http://blogs.msdn.com/b/astebner/archive/2010/05/05/10008146.aspx)。

> 与 Visual C++ 2005 和 2008 可再发行包不同，有一些注册表项可用于检测 Visual C++ 2010 可再发行包的存在。
> 
> Visual C++ 2010 可再发行包检测注册表值
> 
> Visual C++ 2010 可再发行包 (x86)
> 
> [HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\VisualStudio\10.0\VC\VCRedist\x86] 已安装 = 1 (REG_DWORD)
> 
> Visual C++ 2010 可再发行包 (x64)
> 
> [HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\VisualStudio\10.0\VC\VCRedist\x64] 已安装 = 1 (REG_DWORD)
> 
> Visual C++ 2010 可再发行包 (ia64)
> 
> [HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\VisualStudio\10.0\VC\VCRedist\ia64] 已安装 = 1 (REG_DWORD)

**注意**：您需要在 64 位操作系统上检查 Wow6432Node。(HKLM\Software\Wow6432Node\Microsoft....)

如果您喜欢旧版本，这里是 GUID

Visual C++ 2010 可再发行包产品代码

*   Visual C++ 2010 可再发行包 (x86) - {196BB40D-1578-3D01-B289-BEFC77A11A1E}
*   Visual C++ 2010 可再发行包 (x64) - {DA5E371C-6333-3D8A-93A4-6FD5B20BCC6E}
*   Visual C++ 2010 可再发行包 (ia64) - {C1A35166-4301-38E9-BA67-02823AD72A1B}

Visual C++ 2010 SP1 可再发行包产品代码

*   Visual C++ 2010 SP1 可再发行包 (x86) - {F0C3E5D1-1ADE-321E-8167-68EF0DE699A5}
*   Visual C++ 2010 SP1 可再发行包 (x64) - {1D8E6291-B0D5-35EC-8441-6616F567A0F7}
*   Visual C++ 2010 SP1 可再发行包 (ia64) - {88C73C1C-2DE5-3B01-AFB8-B46EF4AB41CD}

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-04-08T17:29:54.287

您可以采用推荐的方法安装 directx：始终运行可再发行组件。由于它是必需的，并且您已经在发布它，因此即使它已经安装，运行它也没有什么坏处。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-04-09T15:26:32.190

看起来微软开发人员提出了[另一种解决方案，使用](http://blogs.msdn.com/astebner/archive/2009/01/29/9384143.aspx)[MsiQueryProductState API](http://msdn.microsoft.com/en-gb/library/aa370363.aspx)，唉，也依赖于 GUID。

*更新*：代码昨天上线，似乎工作正常。以下是正在做的事情：检查我最新知道的 GUID 和路径² to-where-it-is-supposed-to-be-installed。如果两者都失败，则安装它。这似乎工作正常。

此外，它与命令行参数“/qb”一起安装，这意味着“无人看管但不是不可见”。请参阅有关这些参数[的其他博客文章。](http://blogs.msdn.com/astebner/archive/2009/03/26/9513328.aspx)

FWIW，用于 Microsoft Visual C++ 2008 / VC90 SP1 可再发行组件的 GUID - x86 9.0.30729

*   64 位 30729.17：8220EEFE-38CD-377E-8595-13398D740ACE
*   32 位 30729.17：9A25302D-30C0-39D9-BD6F-21E6EC160475
*   32位30729.01：6AFCA4E1-9B78-3640-8F72-A7BF33448200

² 路径： `$WINDIR\WinSxS\x86_Microsoft.VC90.CRT_1fc8b3b9a1e18e3b_9.0.30729*`

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2013-11-14T05:27:03.443

我在 Github 上开源[了一个 Visual C++ 项目，该项目专门检查 VC++ 可再发行 DLL](https://github.com/markedup-mobi/crt-detector)，并使其在 Apache 2.0 许可下可用。

它具有三种不同的方法来检查 VC++9 和 VC++10 运行时的可用性：

1.  检查 MsiQueryProductState API；
2.  检查 WinSxS 文件夹的内容以查找匹配的产品目录；和
3.  检查当前工作目录是否有 VC++9 和 VC++10 运行时的任何本地版本（并检查它们的内容。）

这是使用它的实际样子的示例：

```
 wcout << _T("Checking for the availability of VC++ runtimes..") << endl;
 wcout << _T("----------- Visual C++ 2008 (VC++9) -----------") << endl;
 wcout << _T("Visual C++ 2008 (x86) ? ") << (IsVC2008Installed_x86() ? _T("true") : _T("false")) << endl;
 wcout << _T("Visual C++ 2008 (x64) ? ") << (IsVC2008Installed_x64() ? _T("true") : _T("false")) << endl;
 wcout << _T("Visual C++ 2008 SP1 (x86) ? ") << (IsVC2008SP1Installed_x86() ? _T("true") : _T("false")) << endl;
 wcout << _T("Visual C++ 2008 SP1 (x64) ? ") << (IsVC2008SP1Installed_x64() ? _T("true") : _T("false")) << endl; 
```

我在 Apache 2.0 下授权了[**crt-detector**](https://github.com/markedup-mobi/crt-detector)项目，因此请随意在您自己的应用程序中使用它。

# ruby-on-rails - Rails：link_to_remote 更新不呈现视图

> ID：730898
> 
> 赞同：1
> 
> 时间：2009-04-08T17:01:21.997
> 
> 标签：ruby-on-rails, ajax, rjs

我有一个 link_to_remote 来呈现对象的编辑操作。但它所做的只是用这个响应更新 Dom 元素

```
try { } catch (e) { alert('RJS error:\n\n' + e.toString()); alert(''); throw e } 
```

我的链接如下所示：

```
= link_to_remote t("txt.edit"), :update => dom_id(comment), :url => edit_comment_path(comment.id) 
```

我在评论控制器中的编辑操作：

```
 # GET /comments/1/edit
  def edit
    @comment = Comment.find(params[:id])
    respond_to do |format|
      format.html
      format.js { render :action => "edit" }
    end
  end 
```

根据日志，请求似乎没问题：

```
Processing CommentsController#edit (for 127.0.0.1 at 2009-04-08 18:55:36) [GET]
  Session ID: 1d4b9b3d3319d5cd556d00d2e053b651
  Parameters: {"authenticity_token"=>"5d70f9e5beded361ee7e87ee591512411e8f3eec", "id"=>"18"}
  User Columns (2.0ms)   SHOW FIELDS FROM `users`
  User Load (0.5ms)   SELECT * FROM `users` WHERE (`users`.`id` = 1) LIMIT 1
  Account Columns (1.6ms)   SHOW FIELDS FROM `accounts`
  Account Load (0.2ms)   SELECT * FROM `accounts` WHERE (`accounts`.`subdomain` = 'xxx') LIMIT 1
  Comment Columns (1.7ms)   SHOW FIELDS FROM `comments`
  Comment Load (0.6ms)   SELECT * FROM `comments` WHERE (`comments`.`id` = 18) 
Rendering comments/edit
Completed in 30818ms (View: 2, DB: 7) | 200 OK [http://xx.xxx.rails/comments/18/edit?authenticity_token=5d70f9e5beded361ee7e87ee591512411e8f3eec] 
```

我究竟做错了什么？谢谢您的帮助！

更新：顺便说一句，它与 RJS 模板一起工作——这就是我现在解决它的方法。但我仍然更喜欢呈现视图的解决方案。否则我必须为此目的创建一个部分（我无法使用 rjs 页面更新呈现视图 - 至少我不知道如何）。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-09T08:00:17.797

或者根本不要抓住“respond_to”，因为在这两种情况下你都在做同样的事情！只需注释掉：

```
respond_to do |format|
  format.html
  format.js { render :action => "edit" }
end 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-26T11:45:19.990

```
:script => true 
```

将此添加到`link_to_remote`调用中，它应该使 rails 评估返回的任何脚本，而不是以纯文本形式输出它们。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-08-01T23:08:18.603

从您的 RJS 标记中删除 :update 选项。我在那里有一个，当我尝试 insert_html 时，它显示的是从该方法返回的 JS，而不是在 DOM 上执行它。所以它正在显示 => 尝试 {...}

在我的视图中，我从我的 link_to_remote 语句中取出了 :update 属性，使用了一个 `render: update do |page| page.insert_html(...) end`块，它执行了返回的 JS 而不是显示它。

希望有帮助。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-08T22:17:46.217

您忽略提及的一件事是模板是什么......我猜这就是问题所在。如果是 ERB，请尝试以下操作：

> format.js { 渲染 :action => "edit.html.erb" }

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-09T02:10:19.137

看起来您可能忘记在视图中包含对 Javascript 库的引用，并且视图正在呈现文字 JavaScript 而不是解释它。

```
<%= javascript_include_tag :defaults %> 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-11-18T15:47:50.130

当您响应 js 请求时，`render :action => "edit"`将尝试渲染 edit.rjs，一个 rjs '模板'，而不是 edit.haml，一个 html 模板。

# asp.net-mvc - 带有 ASP.NET MVC 的 StructureMap - configure() 方法已过时？

> ID：730903
> 
> 赞同：1
> 
> 时间：2009-04-08T17:03:06.487
> 
> 标签：asp.net-mvc, structuremap

我已经使用 CustomControllerFactory 覆盖了 DefaultControllerFactory，它实际上是使用 StructureMAp ObjectFactory 来使用 IOC 构造控制器实例。但是有些如何找不到控制器实例并对其进行故障转移。笔记。我也已经在 Global.asax 中设置了 DEfaultControllerFactory。那么除了将我的注册表注册到 SM 之外，我还有什么要做的吗？

我了解注册控制器可以解决问题，但我想知道为什么它不能像 defaultFactory 那样自动检测控制器？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-09T12:32:58.577

这是控制器工厂的外观：

```
public class ControllerFactory : DefaultControllerFactory
{
    protected override IController GetControllerInstance(Type controllerType)
    {
        if (controllerType != null)
        {
            return (IController)ObjectFactory.GetInstance(controllerType);
        }
        return null;
    }
} 
```

StructureMap 配置文件：

```
public class DependencyRegistry : Registry
{
    protected override void configure()
    {
        Scan(x =>
                 {
                     x.Assembly("MyApp.Web");
                     x.Assembly("MyApp.Model");
                     x.Assembly("MyApp.DataAccess");
                     x.With<DefaultConventionScanner>();
                 });
        base.configure();
    }

} 
```

使用默认约定配置 StructureMap 的函数：

```
public void RegisterDependencies()
    {
        ObjectFactory.Initialize(InitializeStructureMap);
    }

    private void InitializeStructureMap(IInitializationExpression x)
    {
        x.AddRegistry<DependencyRegistry>();
    } 
```

控制器示例：

```
public class MyController : Controller
{
    private IMyRepository _repository;

    public MyController (IRepository repository)
    {
        _repository = repository;
    }
} 
```

不要忘记调用 RegisterDependencies() 函数...

我希望这有帮助。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-08T17:20:20.080

您是否在结构图中注册了控制器？（注意，区分大小写）

# c++ - ifstream object.eof() 不工作

> ID：730910
> 
> 赞同：1
> 
> 时间：2009-04-08T17:04:53.033
> 
> 标签：c++

我想我可能需要为我的 while 条件使用 boolean bValue = false ：

```
char cArray[ 100 ] = "";
ifstream object;
cout << "Enter full path name: ";
cin.getline( cArray, 100 );
if ( !object ) return -1   // Path is not valid? This statement executes why?

ifstream object.open( cArray, 100 );

// read the contents of a text file until we hit eof.
while ( !object.eof() )
{
// parse the file here

} 
```

为什么我不能输入文本文件的完整路径名？

可能是因为eof。他们的语法是可以模拟 eof 的布尔语句吗？

我能有......吗：

```
while ( !object == true )
{
// parase contents of file
} 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-08T17:15:03.447

请您和其他所有人注意，读取文本文件的正确方法不需要使用 eof()、good()、bad() 或 indifferent() 函数（好吧，我做了最后一个）。在 C 中也是如此（使用 fgets()、feof() 等）。基本上，这些标志只会在您尝试读取某些内容后设置，使用 getline() 之类的函数。测试读取函数（例如 getline() ）实际上直接读取了某些内容要简单得多，而且更可能是正确的。

未经测试 - 我正在升级我的编译器：

```
#include <iostream>
#include <fstream>
#include <string>
using namespacr std;

imt main() {

   string filename;
   getline( cin, filename );

   ifstream ifs( filename.c_str() );
   if ( ! ifs.is_open() ) {
       // error
   }

   string line;
   while( getline( ifs, line ) ) {
       // do something with line
   }
} 
```

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2009-04-08T17:11:21.693

该`ifstream::open`函数采用文件名和可选模式。既然要读取整个文件，为什么不从头开始：

```
ifstream obj(cArray);
if (obj) { // file successfully opened for reading
    while (obj.good()) {
        // read in a line at a time
        string line;
        getline(line, obj);
        if (!line.empty()) { // we have something to work with
           // parse
        }
    }
} 
```

当然，更时尚的版本是`getline`在`while`循环中测试 Neil Butterworth。

# c++ - 内存分配的专用函数导致内存泄漏？

> ID：730913
> 
> 赞同：1
> 
> 时间：2009-04-08T17:07:10.173
> 
> 标签：c++, memory-leaks

大家好，

我相信以下代码会产生内存泄漏？

```
 /* External function to dynamically allocate a vector */
    template <class T>
            T *dvector(int n){
            T *v;

            v = (T *)malloc(n*sizeof(T));

            return v;
    }

    /* Function that calls DVECTOR and, after computation, frees it */
    void DiscontinuousGalerkin_Domain::computeFaceInviscidFluxes(){
            int e,f,n,p;
            double *Left_Conserved;

            Left_Conserved = dvector<double>(NumberOfProperties);

            //do stuff with Left_Conserved
            //

            free(Left_Conserved);

            return;
    } 
```

我认为，通过将指针传递给 DVECTOR，它会分配它并返回正确的地址，以便*free(Left_Conserved)*成功解除分配。然而，情况似乎并非如此。

**注意：**我也用*new/delete*替换*malloc/free*进行了测试，但也没有成功。

我有一段类似的代码用于分配二维数组。我决定像这样管理向量/数组，因为我经常使用它们，而且我还想了解更深入的 C++ 内存管理。

所以，我很想保留一个外部函数来为我分配向量和数组。为了避免内存泄漏，这里有什么问题？

**编辑**

我也一直在使用 DVECTOR 函数来分配用户定义的类型，所以我猜这可能是一个问题，因为我没有调用构造函数。

即使在我释放 Left_Conserved 向量之前的代码段中，我也想以其他方式分配一个向量并将其“打开”以供其他函数通过其指针进行评估。如果使用 BOOST，它会在函数结束时自动清理分配，所以，我不会用 BOOST 获得“公共”数组，对吧？我想这很容易用 NEW 解决，但是对于矩阵来说，更好的方法是什么？

我刚刚想到我将指针作为参数传递给其他函数。现在，BOOST 似乎不太喜欢它，编译退出并出现错误。

所以，我仍然需要一个指向向量或矩阵的指针，它接受用户定义的类型，将作为参数传递给其他函数。向量（或矩阵）很可能在外部函数中分配，并在另一个合适的函数中释放。（我只是不想复制循环和新的东西来在代码中的任何地方分配矩阵！）

这是我想做的：

```
 template <class T>
    T **dmatrix(int m, int n){
            T **A;

            A = (T **)malloc(m*sizeof(T *));
            A[0] = (T *)malloc(m*n*sizeof(T));

            for(int i=1;i<m;i++){
                    A[i] = A[i-1]+n;
            }

            return A;
    }

    void Element::setElement(int Ptot, int Qtot){

            double **MassMatrix;

            MassMatrix = dmatrix<myT>(Ptot,Qtot);

            FillInTheMatrix(MassMatrix);

            return;
    } 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-08T17:22:36.143

那里没有内存泄漏，但您应该使用 new/delete[] 而不是 malloc/free。特别是因为您的函数是模板化的。

如果您想使用具有非平凡构造函数的类型，则基于 malloc 的函数将被破坏，因为它不调用任何构造函数。

我只需这样做即可替换“dvector”：

```
void DiscontinuousGalerkin_Domain::computeFaceInviscidFluxes(){
        double *Left_Conserved = new double[NumberOfProperties];

        //do stuff with Left_Conserved
        //

        delete[] Left_Conserved;
} 
```

它在功能上是等效的（除了它可以调用其他类型的构造函数）。它更简单，需要更少的代码。此外，每个 c++ 程序员都会立即知道发生了什么，因为它不涉及额外的功能。

更好的是，使用智能指针来完全避免内存泄漏：

```
void DiscontinuousGalerkin_Domain::computeFaceInviscidFluxes(){
        boost::scoped_array<double> Left_Conserved(new double[NumberOfProperties]);

        //do stuff with Left_Conserved
        //
} 
```

正如许多聪明的程序员喜欢说的“最好的代码是你**不必**编写的代码”

**编辑：**您为什么认为您发布的代码会泄漏内存？

**编辑：**我看到你对另一篇文章的评论说

> 在代码执行命令顶部显示分配的内存无限增长！

这可能是完全正常的（也可能不是），具体取决于您的分配模式。通常堆的工作方式是它们经常增长，但不经常收缩（这是为了有利于后续分配）。完全对称的分配和释放应该允许应用程序稳定在一定的使用量。

例如：

```
while(1) {
    free(malloc(100));
} 
```

不应导致持续增长，因为堆很可能为每个 malloc 提供相同的块。

所以我的问题是。它是“无限期地”增长还是根本不收缩？

**编辑：**

您已经问过如何处理 2D 数组。就个人而言，我会使用一个类来包装细节。我要么使用一个库（我相信 boost 有一个 n 维数组类），要么滚动你自己的库应该不会太难。这样的事情可能就足够了：

[http://www.codef00.com/code/matrix.h](http://www.codef00.com/code/matrix.h)

用法是这样的：

```
Matrix<int> m(2, 3);
m[1][2] = 10; 
```

从技术上讲，使用 operator() 之类的东西来索引矩阵包装类在技术上更有效，但在这种情况下，我选择模拟原生数组语法。如果效率*真的很*重要，它可以像原生数组一样高效。

**编辑：**另一个问题。你在什么平台上开发？如果它是 *nix，那么我会推荐 valgrind 来帮助查明您的内存泄漏。由于您提供的代码显然不是问题。

我不知道，但我确信 Windows 也有内存分析工具。

**编辑：**对于矩阵，如果您坚持使用普通的旧数组，为什么不将其分配为单个连续块并像这样对索引进行简单的数学运算：

```
T *const p = new T[width * height]; 
```

然后要访问一个元素，只需这样做：

```
p[y * width + x] = whatever; 
```

这样`delete[]`，无论它是一维数组还是二维数组，您都可以对指针执行 a 。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-08T17:24:56.717

没有可见的内存泄漏，但是使用这样的代码存在内存泄漏的高风险。尝试始终将资源包装在一个对象 (RAII) 中。std::vector 完全符合您的要求：

```
void DiscontinuousGalerkin_Domain::computeFaceInviscidFluxes(){
        int e,f,n,p;
        std::vector<double> Left_Conserved(NumOfProperties);//create vector with "NumOfProperties" initial entries

        //do stuff with Left_Conserved
        //exactly same usage !
        for (int i = 0; i < NumOfProperties; i++){//loop should be "for (int i = 0; i < Left_Conserved.size();i++)" .size() == NumOfProperties ! (if you didn't add or remove any elements since construction
             Left_Conserved[i] = e*f + n*p*i;//made up operation
        }
        Left_Conserved.push_back(1.0);//vector automatically grows..no need to manually realloc
        assert(Left_Conserved.size() == NumOfProperties + 1);//yay - vector knows it's size
        //you don't have to care about the memory, the Left_Conserved OBJECT will clean it up (in the destructor which is automatically called when scope is left)
        return;
} 
```

编辑：添加了一些示例操作。您真的应该阅读有关 STL 容器的信息，它们是值得的！
编辑 2：对于 2d，您可以使用：

```
std::vector<std::vector<double> > 
```

就像评论中有人建议的那样。但是 2d 的使用有点棘手。您应该首先查看 1d-case 以了解发生了什么（扩大向量等）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-08T17:16:13.973

我在这段代码中没有看到内存泄漏。

如果您在 c++ 上编写程序 - 使用 new/delete 而不是 malloc/free。

为了避免可能的内存泄漏，请使用智能指针或 stl 容器。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-08T17:16:24.987

不，只要您在调用`dvector`模板和之间没有做任何激烈的事情`free`，就不会泄漏任何内存。什么告诉你有内存泄漏？

请问，你为什么选择创建自己的数组而不是使用像`vector`or这样的 STL 容器`list`？那肯定会为你省去很多麻烦。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-08T23:57:15.540

如果你为`n`to传递一个负值会发生什么`dvector`？

也许您应该考虑更改函数签名以将无符号类型作为参数：

```
template< typename T >
T * dvector( std::size_t n ); 
```

另外，作为风格问题，我建议您在提供内存分配功能时始终提供自己的内存释放功能。就像现在一样，调用者依赖于`dvector`使用实现的知识`malloc`（这`free`是适当的发布调用）。像这样的东西：

```
template< typename T >
void dvector_free( T * p ) { free( p ); } 
```

正如其他人所建议的那样，将其作为 RAII 类执行会更加健壮。最后，正如其他人所建议的那样，有很多现有的、经过时间考验的库可以做到这一点，因此您可能根本不需要自己动手。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-11T19:01:32.033

因此，这里讨论的一些重要概念帮助我解决了代码中的内存泄漏问题。有两个主要错误：

*   我的用户定义类型的*malloc*分配是错误的。但是，当我将其更改为*new*时，泄漏变得更糟，这是因为我的一个用户定义类型有一个构造函数调用一个没有参数且没有正确内存管理的外部函数。由于我在构造函数之后调用了该函数，因此处理本身没有错误，而只是内存分配。所以*新的* **和**正确的构造函数解决了主要的内存泄漏之一。

*   另一个泄漏与错误的内存释放命令有关，我能够使用 Valgrind 将其隔离（并且有点耐心以正确获取其输出）。所以，这是错误（请不要称我为白痴！）：

    ```
    if (something){
            //do stuff
            return;    //and here it is!!!  =P
    }
    free();
    return; 
    ```

据我了解，这就是 RAII 可以避免这样的错误编程的地方。我实际上还没有将它更改为 std::vector 或 boost::scoped_array 编码，因为我仍然不清楚 a 是否可以将它们作为参数传递给其他函数。所以，我仍然必须小心*delete[]*。

无论如何，内存泄漏已经消失（现在......）=D

# c# - 是否可以在我 removeAt 某些时间后让 List 崩溃？

> ID：730914
> 
> 赞同：0
> 
> 时间：2009-04-08T17:07:13.420
> 
> 标签：c#, list

假设有一个列表`List<UInt32>`

因此， ：

```
12|12
23|33
33|22
11|22 
```

我需要删除第 0 个和第 2 个元素 ( `List<UInt32>`)。但是，当我尝试`foreach`此列表并首先删除第 0 个时，列表会折叠其元素，第 1 个现在变为第 0 个。所以我不想删除错误的元素，因为我的另一个`List<int>`包含我要删除的元素的位置。

无论如何，我想为此做一些算法，但我想知道这个问题是否已经有解决方案。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-08T17:10:05.347

按降序对位置列表进行排序，并按该顺序删除元素。

```
foreach (var position in positions.OrderByDescending(x=>x))
   list.RemoveAt(position); 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-08T17:51:29.163

您是否能够根据元素本身而不是索引来判断需要删除哪些元素？如果是这样，并且您想更改现有列表而不是创建新过滤的列表，请使用：

```
 list.RemoveAll(x => (whatever - a predicate)); 
```

这比一次删除一个元素更有效——每个元素只移动一次。如果谓词很明显，它也更清楚:)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-08T17:22:39.187

您可以创建一个新集合并添加您不想删除的项目，然后将新集合分配给原始集合。如果要删除的索引在哈希集/字典而不是列表中，那甚至可能比 RemoveAt 更快。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-08T17:23:10.260

如果您使用 C#3.0（或更高版本），您可以使用 LINQ 扩展方法`Where`来过滤您的列表。

```
var source = new List<int> { 1, 2, 3, 4, 5 };
var filter = new List<int> { 0, 2 };

var result = source.Where((n, i) => !filter.Contains(i)) // 2, 4, 5 
```

如果你想让它回到 a`List<int>`而不是`IEnumerable<int>`，只需使用`ToList()`

```
var list = result.ToList(); 
```

# php - Zend Server 只是 APC 和 Apache 一起安装吗？

> ID：730915
> 
> 赞同：7
> 
> 时间：2009-04-08T17:07:14.417
> 
> 标签：php, open-source, caching

我正在查看 Zend 服务器（PE 和 CE），如果它只是 php.ini 的前端并且自动拥有基本上是 APC（对吗？）的 Zend Optimizer，或者它对我们的开发机器是否真的很有趣. 基本上 Zend Server 是否有任何我无法从开源缓存软件中获得的特殊酱汁，以及您将使用哪些模块来自己构建类似的东西。只需获取 Apache、PHP 和 APC 或将 lighttpd 与 xcache 一起使用？

编辑：是否有开源替代方案？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2010-12-03T10:13:51.520

Zend Server 比 APC+Apache 有更多的特性。它是一个 PHP 应用服务器，这意味着：
- 监控生产环境中的 PHP 执行；
- PHP事件的代码跟踪（在生产环境中调试，存储PHP代码的执行堆栈）；
- 调试和配置文件系统；
- 作业队列（管理 PHP 脚本队列，安排 PHP 脚本的执行）；
- Java Bridge（从 PHP 调用 Java 类）；
- 页面缓存（根据条件 $_GET、$_SESSION、$_SERVER 等缓存 URL）；
- 数据缓存（用于缓存 PHP 变量的 API（在磁盘或 RAM 中）；
- PHP 加速器（PHP 字节码加速器，Zend Optimizer+）；
- PHP 堆栈的管理（PHP 的配置、扩展等）。

Zend Server Community Edition (CE) 是 Zend Server 的免费版本。在这个版本中，您只有：
- 调试和配置文件系统；
- 数据缓存（如 APC）；
- PHP 字节码加速器，Zend Optimizer+（如 APC）；
- 爪哇桥；
- PHP 堆栈的管理。

欲了解更多信息：[http ://www.zend.com/en/products/server/](http://www.zend.com/en/products/server/)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-08T17:13:36.710

与该类型的产品一样，区别在于支持（**使用 SLA**）和包装。Zend 似乎也放了一些不错的前端。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-08T17:13:44.917

Zend Server 有一些有趣的特性。如果我没记错的话，Zend Optimizer 比 APC 快一些。但是，最独特的功能可能是与 Zend Studio 和 Zend Studio for Eclipse 集成的在线远程 PHP 调试器。类似的解决方案是免费提供的（xdebug 很棒），但没有一个是精心策划的 GUI。

这是一个稳定且支持良好的软件包。除非您需要支持和保修，或者已经在使用 Zend Studio，否则不推荐。

# jquery - jQuery 的 replaceWith() 和 html() 有什么区别？

> ID：730916
> 
> 赞同：153
> 
> 时间：2009-04-08T17:07:19.987
> 
> 标签：jquery

当 HTML 作为参数传入时，jQuery 的 replaceWith() 和 html() 函数有什么区别？

* * *

## 回答 #1

> 赞同：306
> 
> 时间：2009-04-08T17:12:40.193

获取此 HTML 代码：

```
<div id="mydiv">Hello World</div> 
```

正在做：

```
$('#mydiv').html('Aloha World'); 
```

将导致：

```
<div id="mydiv">Aloha World</div> 
```

正在做：

```
$('#mydiv').replaceWith('Aloha World'); 
```

将导致：

```
Aloha World 
```

所以[html()](http://docs.jquery.com/Attributes/html#val)替换元素的内容，而[replaceWith()](http://docs.jquery.com/Manipulation/replaceWith)替换实际元素。

* * *

## 回答 #2

> 赞同：36
> 
> 时间：2009-04-08T17:11:14.610

replaceWith() 将替换当前元素，而 html() 只是替换内容。

请注意，replaceWith() 不会真正删除元素，而只是将其从 DOM 中删除并在集合中返回给您。

彼得的一个例子：http: [//jsbin.com/ofirip/2](http://jsbin.com/ofirip/2)

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2013-12-02T05:16:48.883

有两种使用 html() 和 replaceWith() Jquery 函数的方法。

```
<div id="test_id">
   <p>My Content</p>
</div> 
```

1.) html() 与 replaceWith()

`var html = $('#test_id p').html();`将返回“我的内容”

但是 `var replaceWith = $('#test_id p').replaceWith();`会返回整个 DOM 对象 `<p>My Content</p>`。

* * *

2.) html('value') 与 replaceWith('value')

`$('#test_id p').html('<h1>H1 content</h1>');`会给你以下输出。

```
<div id="test_id">
  <p><h1>H1 content</h1></p>
</div> 
```

但是 `$('#test_id p').replaceWith('<h1>H1 content</h1>');`会给你以下输出。

```
<div id="test_id">
      <h1>H1 content</h1>
</div> 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2012-02-15T21:52:26.663

老问题，但这可能对某人有所帮助。

如果您的 HTML 无效，这些函数在 Internet Explorer 和 Chrome / Firefox 中的运行方式会有所不同。

清理您的 HTML，它们将按文档说明工作。

（不关闭我`</center>`的夜晚让我付出了代价！）

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2017-08-02T16:19:33.127

知道`.empty().append()`也可以用来代替`.html()`. 在下面显示的基准测试中，这更快，但前提是您需要多次调用此函数。

请参阅：[https ://jsperf.com/jquery-html-vs-empty-append-test](https://jsperf.com/jquery-html-vs-empty-append-test)

# sql-server - 主文件组已满

> ID：730920
> 
> 赞同：1
> 
> 时间：2009-04-08T17:10:15.067
> 
> 标签：sql-server

在对 SQL 2000 服务器上的另一个问题进行故障排除时，我在日志文件中发现了一个错误。我看到主文件组已满。MDF 和 LDF 文件位于系统分区的默认位置，即 NTFS 驱动器上。MDF 文件大小为 1962MB。一些帖子表明大小不能超过2GB。我针对它运行了一个 db shrinkdatabase，但它似乎没有改变大小。在运行收缩之前，我需要先运行一个命令来删除旧信息吗？

当我进入企业管理器时，我有 2 个 SQL 组。一个是本地的，另一个由服务器名称列出。数据库问题发生在第二组。当我尝试手动增加数据文件的大小时，由于许可限制，我被限制为 2048 MB。另一组中的 SQL 实例允许我将该数字更改为 2048 MB 以上。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-08T17:26:45.650

2GB 数据库大小限制仅适用于 MSDE（SQL 2000 的免费“桌面”版本）。其他 SQL 2000 版本没有这个限制。

没有“神奇”的方法可以清除或归档旧的历史数据。您必须了解您的数据库及其结构、客户需求和数据保留需求。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-08T17:30:39.370

你可以试试这个：

```
 ALTER DATABASE foo ADD FILE (
  NAME = 'file2',
  FILENAME = 'C:\PATH\TO\FILE.ndf',
  SIZE = 100MB,
  MAXSIZE = UNLIMITED,
  FILEGROWTH = 10MB; 
```

确保您先备份。

另外，您是否正在运行 SQL Server Express？那里有一个明确的2GB限制......

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-08T17:24:24.003

MDF 文件是存储数据的地方，因此它可能包含这么多数据。

我有一个 13GB 的 MDF 文件，所以我不相信这个限制是正确的。

关于收缩这个，通过删除数据，您可以删除一些数据，然后收缩它，或者您可以通过添加另一个数据文件来扩展该文件组。

或者，创建一个数据库维护计划以减少每页的可用空间量，并可能删除未使用的空间。

我建议您扩展它，然后检查您的维护计划以确保它们是正确的。

# c# - 线程：锁定通用字典

> ID：730926
> 
> 赞同：1
> 
> 时间：2009-04-08T17:12:34.653
> 
> 标签：c#, multithreading

我在多线程应用程序中有一个通用字典；为了实现锁，我创建了一个属性。

```
static object myLock=new object();
Dictionary<key,SomeRef> dict=new Dictionary<key,SomeRef>();

public Dictionary<key,SomeRef> MyDict{
      get{
        lock(myLock){
        return dict;
        }
     }
 } 
```

现在如果我写 CODE#1

```
 MyDict.TryGetValue 
```

或代码#2

```
var result=MyDict.Values;
foreach(var item in result){
//read value into some other variable
} 
```

因此，当我运行代码 1 或 2 时，同时如果其他线程尝试对字典进行一些写操作，如 ..clear dict 或添加新项目。那么，这个解决方案是否是线程安全的（使用属性）。如果不是..那么还有其他方法可以做到这一点。

当我说写操作时，如果不创建键并赋值，则可以通过属性 chek key exoist 引用字典。（因此我没有在属性中使用设置器）

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-08T17:17:36.280

不，这不是线程安全的。

锁只会锁定对字典的内部（dict）实例的引用。当用户尝试添加到字典或从字典中读取时，它不会锁定。

如果您需要提供线程安全访问，我建议您将字典保密，并制作自己的方法来获取/设置/向字典添加值/从字典中添加值。这样，您可以将锁到位，以您需要的粒度进行保护。

* * *

这看起来像这样：

```
public bool TryGetValue(key thekey, out SomeRef result)
{
    lock(myLock) { return this.dict.TryGetValue(thekey, out result); }
}
public void Add(key thekey, SomeRef value)
{
    lock(myLock) { this.dict.Add(thekey, value) }
}
// etc for each method you need to implement... 
```

这里的想法是您的客户直接使用您的类，而您的类处理同步。如果您希望它们遍历这些值（例如您的 foreach 语句），您可以决定是将这些值复制到 List 中并返回它，还是直接提供一个枚举器（`IEnumerator<SomeRef> GetValues()`）等。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-08T17:18:41.473

不，这不安全，因为唯一的代码`locked`是检索代码。你需要做的是

```
lock(MyDict)
{
   if(MyDict.TryGetValue()...
} 
```

和

```
lock(MyDict)
{
    foreach(var item in MyDict.Values) ...
} 
```

基本思想是将您的工作代码包含在 lock() 块中。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-08T17:42:17.453

不保证实现是线程安全的。为了线程安全，并发读/写都必须受到锁的保护。通过分发对您的内部字典的引用，您很难控制谁访问该资源，因此您无法保证调用者将使用相同的锁。

一个好的方法是确保您尝试同步访问的任何资源都完全封装在您的类型中。这将使理解和推理类型的线程安全性变得更加容易。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-09T17:36:28.260

[Thread Safe Dictionary in .NET with ReaderWriterLockSlim](http://devplanet.com/blogs/brianr/archive/2008/09/26/thread-safe-dictionary-in-net.aspx) This is a method that uses ReaderWriterLockSlim and deterministic finalization to hold and release locks.

# asp.net - ASP.NET - 消失的会话变量

> ID：730928
> 
> 赞同：8
> 
> 时间：2009-04-08T17:13:13.450
> 
> 标签：asp.net, session-variables

我正在为一个客户端工作一个当前的 Web 应用程序，我遇到了会话变量消失在我身上的一些问题。我将尽我所能尝试对场景进行良好的描述。除了我创建的允许用户修改存储在资源文件中的字符串的页面之外，它不会发生在任何页面上。

它显示时间：用户导航到页面，从列表中选择一个资源文件，然后第一次单击编辑。该页面将文件加载到网格视图中并允许他们对其进行编辑。此时会话变量正在保存，并在所有回发时正确重新加载。现在，他们单击底部的保存按钮将资源文件写入文件系统（App_LocalResources）。他们从列表中选择一个新文件，尝试加载它，这次会话变量被清除，并将它们重定向到登录页面，因为它不知道那里的用户信息。

附加细节：

只有当他们单击保存按钮时才会发生这种情况，该按钮又会调用我的程序写入资源文件。

除了写入位于 App_LocalResources 中的资源文件之外，我在 save 函数中并没有做太多事情，出于某种原因，这会清除我的会话变量。

有问题的会话变量是用户信息，我尝试将其作为 page_load 方法中的第一件事。

此会话信息也会在每次回发时通过 page_load 方法执行。

谢谢大家，我希望我描述得足够好。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-04-08T17:16:32.087

当您更改与应用程序关联的目录中的文件时，IIS 将重置应用程序。重置应用程序将使您失去记忆会话。

您可以将资源文件放在目录之外。或者使用状态服务器进行会话。

# iphone - 在 iPhone 应用程序中提供小图像选择的最佳方式是什么？

> ID：730933
> 
> 赞同：0
> 
> 时间：2009-04-08T17:14:10.047
> 
> 标签：iphone

我有一堆大小约为 45 x 45 像素的小 png 图像。不是很大的。现在大约有40个。

我希望用户可以选择其中一个作为他的头像。为此，我创建了一个带有控制器类的全新视图。现在的问题是：如何向用户显示所有这些图像？没有“大视野”。当用户触摸其中一个时，它将被选中，并且视图切换回主视图，在那里他将看到他选择的图像。当他触摸它时，图像选择视图将再次出现。

于是想了个table view，但是感觉不太对。图像没有要显示的标题，因此会极大地浪费屏幕空间。

有任何想法吗？我应该以编程方式生成 UIImageView 对象的网格吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-08T17:27:30.267

网格是正确的。想想 iPhone 照片应用程序。不过，无需制作全新的小部件，将多个图像视图添加到表格行，将它们分割。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-08T17:18:43.627

网格似乎是一个很好的解决方案，因为它反映了设置中的壁纸 ui，因此用户知道会发生什么。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-09T13:30:31.857

在这种情况下，另一个选择是使用 UIPickerView。它占用的屏幕空间较小，并且可以显示在主屏幕上（只需从底部弹出，让他们选择一个，然后消失）。

# c# - 针对我的场景的 Web 控制建议

> ID：730934
> 
> 赞同：1
> 
> 时间：2009-04-08T17:14:15.227
> 
> 标签：c#, asp.net, treeview, web-controls

这是我的场景，我想请教您对哪种控件最适合使用的意见。我正在使用 C#、ASP.net 2.0。

我需要创建一个类似于树的结构。用户将从某事开始，然后向其中添加节点。每个节点本身就是一个结构，因此应向用户提供创建新节点类型或使用现有节点类型的选项。

这里明显的选择似乎是 TreeView。但是，我几乎没有担心：1) 我被要求尽量减少返回 Web 服务器的次数，但我不确定这将如何与 TreeView 一起使用。

2）如果我最终使用 TreeView，创建一个新的节点类型（目前它是一个 .ascx（用户控件））可能很难处理，因为我需要打开一个新窗口并将节点 ID 和名称返回给创建节点类型时的父页面（包含 TreeView ）并无缝更新它。

有什么建议吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-08T17:20:32.733

您可能想查看 JQuery 的 Treeview

[http://docs.jquery.com/Plugins/Treeview/treeview#options](http://docs.jquery.com/Plugins/Treeview/treeview#options)

这样，您可以在客户端更新树视图，当用户根据需要完成所有工作时，然后提交树状态。

JQuery for .Net [http://jquerydotnet.codeplex.com/](http://jquerydotnet.codeplex.com/)

# web-services - AJAX AutocompleteExtender 不工作。网络服务工作

> ID：730937
> 
> 赞同：1
> 
> 时间：2009-04-08T17:16:08.607
> 
> 标签：web-services, asp.net-ajax, ajaxcontroltoolkit, autocompleteextender

这是 c# .net 2.0。我正在使用母版页。

*   WebService 可以自己正常工作。
*   我完全被难住了。当我在 TextBox 中输入时，什么也没有发生。

文件：

EditTicket.aspx AutoComplete.asmx App_Code/AutoComplete.cs

EditTicket.aspx:

```
 <%@ Register Assembly="AjaxControlToolkit" Namespace="AjaxControlToolkit" TagPrefix="cc2" %>

        <asp:ScriptManager id="ScriptManager1" runat="server" EnablepageMethods="true">
        <Services>
            <asp:ServiceReference Path="AutoComplete.asmx" />
        </Services>
        </asp:ScriptManager>

    <cc2:AutoCompleteExtender
         runat="server" 
         ID="AutoCompleteExtender1" 
         ServicePath="AutoComplete.asmx" 
         ServiceMethod="AutoComplete2" 
         MinimumPrefixLength="1" 
         CompletionSetCount="12" 
         TargetControlID="TextBox3" 
         EnableCaching="True" >
     </cc2:AutoCompleteExtender>

<asp:TextBox ID="TextBox3" runat="server"></asp:TextBox> 
```

自动完成.asmx：

```
<%@ WebService Language="C#" CodeBehind="~/App_Code/AutoComplete.cs" Class="AutoComplete" %> 
```

自动完成.cs：

```
using System;
using System.Web;
using System.Collections;
using System.Web.Services;
using System.Web.Script.Services;
using System.Web.Services.Protocols;
using System.Collections.Generic;
using System.Data.SqlClient;
using System.Configuration;
using System.Data;

/// <summary>
/// Summary description for AutoComplete
/// </summary>
[WebService(Namespace = "http://tempuri.org/")]
[WebServiceBinding(ConformsTo = WsiProfiles.BasicProfile1_1)]
[ScriptService]
public class AutoComplete : System.Web.Services.WebService {

    public AutoComplete () {

        //Uncomment the following line if using designed components 
        //InitializeComponent(); 
    }

    [WebMethod]
    [ScriptMethod]
    public string[] AutoComplete2(string prefixText,int count)
    {
        string conString = ConfigurationManager.ConnectionStrings["DB"].ConnectionString;
        SqlConnection connection = new SqlConnection(conString);
        connection.Open();
        SqlParameter prm;
        string sql = "Select program_name FROM CM_Programs WHERE program_name LIKE @prefixText";
        SqlDataAdapter cmd = new SqlDataAdapter(sql, connection);
        prm = new SqlParameter("@prefixText", SqlDbType.VarChar, 50);
        prm.Value = prefixText+ "%";
        cmd.SelectCommand.Parameters.Add(prm);
        DataTable dt = new DataTable();
        cmd.Fill(dt);
        string[] items = new string[dt.Rows.Count];
        int i = 0;
        foreach (DataRow dr in dt.Rows)
        {
            items.SetValue(dr["program_name"].ToString(),i);
            i++;
        }
        connection.Close();
        return items;
    } 
} 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-08T17:55:19.637

“什么都没有发生”不是一个简单的描述。当你说什么都没发生时，你检查过吗

*   正在为 Web 服务命中服务器代码？
*   您的查询正在执行并返回结果？
*   您的 items 数组是否已正确填充？

如果“什么都没有”是以上都没有发生，我会开始检查页面上没有 javascript 错误以及您的 AutoComplete 扩展程序是否正确呈现（检查跟踪中的页面控件）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-08T18:48:49.010

Try fiddling with the CompletionInterval property. I have used this control in the past and wasn't seeing the behavior I expected until I set the CompletionInterval to a much lower value. It defaults to 1000 (ms), I would give it a shot with a value of 1, just to see if everything is working as it should (and womp's steps should help to narrow down where the communication issues are happening) and if it does work, keep increasing the value until you hit a value that makes sense (1 ms sends a lot of requests to the server). Report back on what works and what doesn't.

# html - 如何设置表格中单元格的高度，该表格会展开以填充 IE 中的窗口？

> ID：730950
> 
> 赞同：0
> 
> 时间：2009-04-08T17:18:58.587
> 
> 标签：html, css, internet-explorer, html-table

我正在尝试构建一个简单的单列布局。我希望前两行具有较小的固定高度。第三行应展开以填满页面的其余部分。这是我目前的来源：

```
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
    "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
    <style type="text/css">
        html, body
        {
            height:100%;
            width:100%;
            border:0px;
            margin:0px;
        }
    </style>
</head>
<body>
    <table style="width:100%;height:100%;" cellpadding="0" cellspacing="0">
    <tr>
        <td style="height:50px;background:red;">Header 1</td>
    </tr>
    <tr>
        <td style="height:10px;background:blue;">Header 2</td>
    </tr>
    <tr>
        <td style="background:green;">Content</td>
    </tr>
    </table>
</body>
</html> 
```

这在 Safari、Firefox 和 Opera 中运行良好。但是，它在 IE6 和 IE7 中都失败了。在这两个浏览器中，前两行渲染得比它们指定的高度大得多。不仅如此，它们实际上还会随着浏览器窗口的高度动态调整大小。这就像 IE 正在将恒定像素高度转换为百分比高度。

对我来说重要的是浏览器窗口不显示滚动条，除非第三行的内容足够大，需要它。将第三个 <td> 的高度设置为 100% 将导致这些滚动条始终出现，因为该行的高度实际上将设置为等于整个表格的高度（它将是其包含元素的 100%）。

删除 doctype 声明并恢复到 quirks 模式似乎使问题在 IE 中消失了，但我需要使用 HTML 4.01 过渡，因为这是该应用程序中所有其他现有页面所期望的。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-08T18:26:58.390

如果您使用它来布局页面，为什么不使用`div`'s 来代替？

这类作品：

```
<style>
    .outer {
        position:relative;
        height: 100%;
        width: 500px;
        background-color: blue;
    }
    .top {
        height: 30px;
        background-color: red;
        width: 100%
    }
    .middle {
        height:30px;
        background-color: green;
        width: 100%
    }
</style>
<div class="outer">
    <div class="top">
        content1
    </div>
    <div class="middle">
        content2
    </div>
    content3
</div> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-08T17:25:02.627

[这是一篇文章](http://apptools.com/examples/tableheight.php)，告诉你如何做到这一点。我刚刚测试了他们在 IE 6 中提供的示例，它可以工作。

看来您必须使用表格的高度属性，而不是通过样式属性来做到这一点。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-08T17:25:57.603

将 position:fixed 添加到表中怎么样？我在 IE8 中对其进行了测试，似乎可以正常工作。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-12-25T23:51:32.393

这行得通吗：？

```
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
    <style type="text/css">
        html, body
        {
            height:100%;
            width:100%;
            border:0px;
            margin:0px;
        }
    </style>
</head>
<body>
    <table width="100%" height="100%" cellpadding="0" cellspacing="0">
    <tr>
        <td height="50" style="background:red;">Header 1</td>
    </tr>
    <tr>
        <td height="10" style="background:blue;">Header 2</td>
    </tr>
    <tr>
        <td style="background:green;">Content</td>
    </tr>
    </table>
</body>
</html> 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-22T01:43:42.667

将你最后一个的高度设置`td`为`100%`：

```
 <tr>
        <td style="background:green;height:100%;">Content</td>
    </tr> 
```

# python - 在 Python 中使用 GLUT / OpenGL 绘制文本

> ID：730952
> 
> 赞同：1
> 
> 时间：2009-04-08T17:19:23.420
> 
> 标签：python, opengl, text, draw

我在 Python 中使用 OpenGL 绘制文本。一切正常，但是字体真的很糟糕。如果我把它加厚，字母开始看起来很出现（尤其是那些像'o'或'g'一样的圆形。为了我的程序的目的，它必须很厚。有没有我可以使用的字体看起来不加厚时很糟糕，还是有其他方法可以绘制它？我真的被卡住了，会很感激任何答案，

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-09T07:50:30.910

尝试更复杂的文本渲染解决方案。也许像[pyftgl](http://code.google.com/p/pyftgl/)这样的东西可以通过渲染全质量的 TrueType 字体来获得更好的结果。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-01-06T02:24:17.483

[http://nehe.gamedev.net/data/lessons/lesson.asp?lesson=43](http://nehe.gamedev.net/data/lessons/lesson.asp?lesson=43)

底部是本课的 Python 版本，它向您展示如何使用 Python 图像库 (PIL) [http://www.pythonware.com/products/pil/加载 freetype 字体](http://www.pythonware.com/products/pil/)

# mysql - 如何修复：mysql_connect()：连接太多

> ID：730953
> 
> 赞同：17
> 
> 时间：2009-04-08T17:19:32.827
> 
> 标签：mysql

我收到以下错误：

```
mysql_connect(): Too many connections 
```

它完全关闭了我的网站，该网站已经无缝运行了几年。

注意：我已与 GoDaddy 共享主机。

我该如何解决？

还：有没有办法在共享主机计划中关闭所有连接并重新启动？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2013-10-30T15:26:20.157

## 这是技术回复

当 MySQL 服务器达到其软件可配置的最大并发客户端连接的人为限制时，您将在连接到 MySQL 时收到此“太多连接”错误。

### 因此，解决此问题的正确方法是：

1.  直接连接 MySQL 服务器，并执行查询：`SET GLOBAL max_connections = 1024;`在运行时更改连接限制（不停机）。
2.  使您的更改永久化，并编辑 /etc/my.cnf （或类似文件）并`max_connections = 1024`在该`[mysqld]`部分中添加 line 行；如果您无法进行实时更改，请重新启动。

选择的 1024 限制纯粹是主观的；使用你想要的任何限制。您还可以通过查询检查您的当前限制`SHOW VARIABLES LIKE "max_connections";`。请记住，这些限制可以很好地使用，以防止后端数据库不必要的过载。所以总是选择明智的限制。

但是，对于这些步骤，您需要直接访问数据库 MySQL 服务器。

正如您所说，您正在使用 GoDaddy（我不太了解他们），您无法选择联系您的服务提供商（即 GoDaddy）。但是，无论如何，他们*也会*在日志中看到这一点。

### 可能的根本原因

这当然意味着，太多的客户端试图同时连接到 MySQL 服务器——根据每个配置指定的人工软件限制。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-04-08T17:22:44.210

很可能，您已经成为`DDoS`攻击的对象。

[**这个论坛上**](http://www.vbulletin.com/forum/archive/index.php/t-200423.html)的人抱怨完全相同的事情与完全相同的供应商。

答案是这样的：

> VB 告诉我这是一次 DOS 攻击 - 这是他们的信息：
> 
> > 这不是“利用”。这是一种 DoS 攻击（拒绝服务）。不幸的是，我们对此无能为力。DoS 攻击只能在服务器或路由器级别进行，这是您的主机的责任。他们没有这样做，而是决定采取简单的方法并暂停您的帐户。
> 
> 如果你不能让他们认真对待这件事，那么你应该寻找另一个主人。关于这些坏消息我很遗憾。

一种可能的解决方法是：如果您的连接失败并显示`mysql_connect(): Too many connections`，您不会退出，而是`sleep()`等待半秒钟并尝试再次连接，并且仅在`10`尝试失败时退出。

这不是解决方案，而是解决方法。

这当然会延迟您的页面加载，但总比丑陋的`too many connections`信息要好。

您还可以使用某种方法来区分机器人和浏览器。

例如，设置一个加盐`SHA1`cookie，重定向到同一页面，然后检查该 cookie 并`MySQL`仅在用户代理通过测试时连接到。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2016-11-29T15:30:51.597

可能导致此错误的另一件事是数据库空间不足。我最近发生了这种情况，问题不是连接，而是磁盘空间。希望这对其他人有帮助！

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-04-08T17:20:50.500

当你完成它们时，你会关闭你的连接吗？您是否使用某种类型的连接池？听起来您正在打开连接而不是关闭它们。

编辑：Quassnoi 已经回答了。如果它是 DDoS，并且您正在使用共享主机，您可能只需要联系您的主机并与他们一起解决问题。不幸的是，当您无法控制整个系统时，这是一种风险。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-08T17:22:11.917

考虑使用 mysql_pconnect()。您的主机可能为连接添加了某种限制。比如每 20 分钟最多 100 个或一些奇怪的东西。

# fxcop - 为什么 FxCop 认为将字段初始化为默认值是不好的？

> ID：730967
> 
> 赞同：24
> 
> 时间：2009-04-08T17:21:31.560
> 
> 标签：fxcop

为字段分配默认默认值时（此处为布尔值 false），FxCop 说：

```
Resolution   : "'Bar.Bar()' initializes field 'Bar.foo' 
               of type 'bool' to false. Remove this initialization 
               because it will be done automatically by the runtime." 
```

现在，我知道代码`int a = 0`或`bool ok = false`正在引入一些冗余，但对我来说，这似乎是一种非常非常好的代码实践，我的老师在我看来是正确坚持的。

不仅性能损失很小，更重要的是：依赖默认值是依赖于每个程序员曾经使用过一段代码的知识，依赖于每个带有默认值的数据类型。（约会时间？）

说真的，我觉得这很奇怪：应该保护你不犯太明显错误的程序，是建议在这里做一个，只是为了提高性能？（我们在这里谈论的是*初始化代码*，只执行一次！那么关心的程序员当然可以省略初始化（并且可能应该使用 C 或汇编程序:-)）。

FxCop 在这里犯了一个明显的错误，还是有更多的错误？

> 两个更新：
> 
> 1.  这不仅仅是我的观点，而是我在大学（比利时）所教的。并不是说我喜欢使用 [*argumentum ad verecundiam*](http://philosophy.lander.edu/logic/authority.html)，只是为了表明这不仅仅是我的观点。关于这一点：
>     
>     
> 2.  抱歉，我刚找到这个：
>     
>     
>     
>     [我应该总是/永远/从不将对象字段初始化为默认值吗？](https://stackoverflow.com/questions/636102/should-i-always-ever-never-initialize-object-fields-to-default-values)

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-04-08T17:26:41.860

在某些情况下，这可能会带来显着的性能优势。有关详细信息，[请参阅此 CodeProject 文章。](http://www.codeproject.com/KB/dotnet/DontInitializeVariables.aspx?fid=182387&df=90&mpp=25&noise=3&sort=Position&view=Quick&select=1112738)

主要问题是它在 C# 中是不必要的。在 C++ 中，情况有所不同，因此许多教授都教导您应该始终初始化。初始化对象的方式在 .NET 中发生了变化。

在 .NET 中，对象总是在构造时被初始化。如果添加初始化程序，则可能（典型地）导致变量的双重初始化。无论您是在构造函数中还是内联中初始化它们，都会发生这种情况。

此外，由于在 .NET 中初始化是不必要的（它总是会发生，即使您没有明确表示要初始化为默认值），从可读性的角度来看，添加初始化程序表明您正在尝试添加具有功能。每一段代码都应该有一个目的，或者在不必要的时候被删除。“额外”代码，即使它是无害的，也表明它的存在是有原因的，这会降低可维护性。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2013-04-02T14:55:43.657

[Reed Copsey 说](https://stackoverflow.com/a/730990/146622)为字段指定默认值会影响性能，他指[的是 2005 年的一项测试](http://www.codeproject.com/Articles/10439/Gain-performance-by-not-initializing-variables)。

```
public class A
{
    // Use CLR's default value
    private int varA;
    private string varB;
    private DataSet varC;
}

public class B
{
    // Specify default value explicitly
    private int varA = 0;
    private string varB = null;
    private DataSet varC = null;
} 
```

现在八年了，四个版本的 C# 和 .NET 之后我决定在 .NET Framework 4.5 和 C# 5 下重复该测试，使用 Visual Studio 2012 编译为具有默认优化的 Release。我惊讶地发现仍然存在性能差异在使用默认值显式初始化字段和不指定默认值之间。我本来希望后来的 C# 编译器现在可以优化那些常量赋值。

```
无初始化：512,75 默认初始化：536,96 常量初始化：720,50
方法无初始化：140,11 Def 方法初始化：166,86

```

^(（[其余](http://pastebin.com/kjadwU7C)）)

所以我在类的构造函数`A`和`B`这个测试中偷看了一下，*两者*都是空的：

```
.method public hidebysig specialname rtspecialname 
    instance void .ctor () cil managed 
{
    // Code size 7 (0x7)
    .maxstack 8

    IL_0000: ldarg.0
    IL_0001: call instance void [mscorlib]System.Object::.ctor()
    IL_0006: ret
} // end of method .ctor 
```

我在 IL 中*找不到*为什么显式为字段分配默认常量值会消耗更多时间的原因。显然 C# 编译器*确实*优化了常量，我怀疑它总是这样做的。

所以，那么测试一定是错误的......我交换了 classes`A`和的内容`B`，交换了结果字符串中的数字，然后重新运行了测试。你*瞧，*现在突然*指定默认值更快*了。

```
无初始化：474,75 默认初始化：464,42 常量初始化：715,49
方法无初始化：141,60 方法初始化在 Def：171,78

```

^(（[其余](http://pastebin.com/g7Lsn1zr)）)

因此，我得出结论，C# 编译器正确优化了您为字段分配默认值的情况。**它没有性能差异！**

* * *

现在我们知道性能真的*不是*问题。我不同意[Reed Copsey 的说法](https://stackoverflow.com/a/730990/146622)“ *‘额外’代码，即使它是无害的，表明它的存在是有原因的，这会降低可维护性。* ”并同意[Anders Hansson](https://stackoverflow.com/a/636238/146622)的观点：

> 考虑长期维护。
> 
> *   保持代码尽可能明确。
> *   如果不需要，不要依赖语言特定的初始化方式。也许新版本的语言会以不同的方式工作？
> *   未来的程序员会感谢你。
> *   管理层会感谢你的。
> *   为什么要混淆事物，哪怕是最轻微的？
> 
> 未来的维护者可能来自不同的背景。这真的不是关于什么是“正确的”，而是从长远来看最容易的事情。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-04-08T18:09:30.087

FxCop 必须为每个人提供规则，因此如果此规则对您没有吸引力，请排除它。

现在，我建议如果您想显式声明默认值，请使用常量（或静态只读变量）来执行此操作。它会比使用值初始化更清晰，而且 FXCop 不会抱怨。

```
private const int DEFAULT_AGE = 0;

private int age = 0; // FXCop complains
private int age = DEFAULT_AGE; // FXCop is happy

private static readonly DateTime DEFAULT_BIRTH_DATE = default(DateTime);

private DateTime birthDate = default(DateTime); // FXCop doesn't complain, but it isn't as readable as below
private DateTime birthDate = DEFAULT_BIRTH_DATE; // Everyone's happy 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-04-08T17:32:15.513

FX Cop 认为这是添加不必要的代码，而不必要的代码是不好的。我同意你的观点，我喜欢看看它的设置，我认为它更容易阅读。

我们遇到的一个类似问题是，出于文档原因，我们可能会创建一个像这样的空构造函数

```
/// <summary>
/// a test class
/// </summary>
/// <remarks>Documented on 4/8/2009  by richard</remarks>
public class TestClass
{
    /// <summary>
    /// Initializes a new instance of the <see cref="TestClass"/> class.
    /// </summary>
    /// <remarks>Documented on 4/8/2009  by Bob</remarks>
    public TestClass()
    {
        //empty constructor
    }        
} 
```

编译器会自动创建此构造函数，因此 FX cop 会抱怨，但我们的沙堡文档规则要求记录所有公共方法，所以我们只是告诉 fx cop 不要抱怨它。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-08T17:28:00.530

它不依赖于每个程序员都知道一些本地定义的“公司标准”，这些标准可能随时变化，而是依赖于标准中正式定义的东西。您不妨说“不要使用`x++`，因为这依赖于每个程序员的知识。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-04-08T17:31:56.637

您必须记住，FxCop 规则只是指导方针，它们并非牢不可破。它甚至在您提到的规则描述的页面上这么说（[http://msdn.microsoft.com/en-us/library/ms182274(VS.80).aspx](http://msdn.microsoft.com/en-us/library/ms182274(VS.80).aspx)，强调我的）：

**何时排除警告**：

如果构造函数调用相同或基类中的另一个构造函数，该构造函数将字段初始化为非默认值，则从该规则中排除警告。**如果性能和代码维护不是优先事项，则从该规则中排除警告或完全禁用该规则也是安全的**。

现在，该规则并非完全不正确，但正如它所说，这不是您的优先事项，所以只需禁用该规则。

# c# - 为什么我的接口没有继承？

> ID：730986
> 
> 赞同：0
> 
> 时间：2009-04-08T17:26:00.627
> 
> 标签：c#, .net, oop

我一定做错了什么

```
public interface IActor
{
    //actor stuff
}

public class BaseShip : IActor
{
    //base ship stuff
}

public class PlayerShip: BaseShip
{
    //Only the stuff for this particular ship
} 
```

为什么这不起作用：

```
IActor player = new PlayerShip(); 
```

或者

```
List<IActor> actors = new List<IActor>(){new PlayerShip()}; 
```

我得到无法从 [PlayerShip] 转换为 [IActor]

*注意：为简洁起见截取代码*

* * *

### 更新

我不小心在两个不同的命名空间中定义了接口。仅此而已。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-08T17:32:00.410

你确定这是你的结构吗？我复制并粘贴了您的代码，并且为我编译并运行良好的操作。

编辑：

你们需要退后一步......接口肯定会沿着继承链传播。你告诉我继承的控件没有实现 IDisposable？

# sql - 全文索引返回不正确的结果

> ID：730998
> 
> 赞同：0
> 
> 时间：2009-04-08T17:28:30.793
> 
> 标签：sql, sql-server, full-text-search

我在文本列上创建了全文索引，随后的包含查询返回不包含搜索词的结果。一个示例查询是：

```
SELECT TOP 10 serial_no,writer_id,myField,assignment_type,subdate,title
FROM writing WHERE contains(myField,'"take it once"'); 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-08T19:38:34.477

更新/重建全文索引后是否会发生这种情况？ [http://technet.microsoft.com/en-us/library/bb326034.aspx](http://technet.microsoft.com/en-us/library/bb326034.aspx)

# mysql - 帮我找出一个 MySQL 查询

> ID：730999
> 
> 赞同：0
> 
> 时间：2009-04-08T17:29:17.283
> 
> 标签：mysql

这些是我有的表：

```
班级
- ID
- 姓名

命令
- ID
- 姓名
- class_id (FK)

家庭
- ID
- order_id (FK)
- 姓名

属
- ID
-family_id (FK)
- 姓名

物种
- ID
- genus_id (FK)
- 姓名

```

我正在尝试进行查询以获取在其下没有任何物种的类、顺序和姓氏的列表。您可以看到该表具有某种形式的层次结构，从 Order 一直到 Species。每个表都有外键 (FK)，它与层次结构上自身上方的直接表相关。

试图在工作中做到这一点，但我做得不太好。任何帮助，将不胜感激！

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-08T17:50:54.890

元答案（对前两个答案的评论）：

使用 IN 往往会降级为类似于 IN 中所有术语的 OR（析取）。表现不佳。

进行左连接并寻找 null 是一种改进，但它是蒙昧主义的。如果我们能说出我们的意思，让我们用最接近自然语言表达方式的 wau 来表达：

```
select f.name
from   family f left join genus g on f.id = g.family_id
       WHERE NOT EXISTS (select * from species c where c.id = g.id); 
```

我们想要某物不存在的地方，所以如果我们能说“不存在的地方”就更好了。而且，`select *`子查询中的 并不意味着它真的带回了一整行，因此它不是替换为的“优化” `select *`，`select 1`至少在任何现代 RDBMS 上都不是。

此外，如果一个家庭有许多属（在生物学中，大多数家庭都有），当我们只关心家庭时，我们将每个（家庭，属）获得一行。因此，让我们为每个家庭设置一行：

```
select DISTINCT f.name
from   family f left join genus g on f.id = g.family_id
       WHERE NOT EXISTS (select * from species c where c.id = g.id); 
```

这仍然不是最优的。为什么？好吧，它满足了 OP 的要求，因为它找到了“空”属，但它没有找到没有属的科，“空”科。我们也能做到吗？

```
select f.name
from   family f 
       WHERE NOT EXISTS (
       select * from genus g 
       join species c on c.id = g.id 
       where g.id = f.id); 
```

我们甚至可以摆脱独特的，因为我们没有加入任何家庭。这*是*一种优化。

来自OP的评论：

> 这是一个非常清晰的解释。但是，我很好奇为什么使用 IN 或析取对性能不利。您能否详细说明一下或指向我可以了解更多关于不同数据库操作的相对性能成本的资源？

这样想吧。假设 SQL 中没有 IN 运算符。你会如何伪造一个IN？

通过一系列 OR：

```
where foo in (1, 2, 3) 
```

相当于

```
where ( foo = 1 ) or ( foo = 2 ) or (foo = 3 ) 
```

好吧，你说，但这仍然不能告诉我为什么它不好。这很糟糕，因为通常没有合适的方法来使用键或索引来查找它。因此，您得到的是 a) 表扫描，其中对于每个析取（或谓词或 IN 列表的元素），对该行进行测试，直到测试为真或列表用尽。或者 b) 您对这些析取中的每一个进行表扫描。第二种情况 (b) 实际上可能更好，这就是为什么您有时会看到一个带有 OR 的选择变成了一个选择，用于 OR 联合的每条腿：

```
 select * from table where x = 1 or x = 3 ;

 select * from table where x = 1 
 union select * from table where x = 3 ; 
```

现在这并不是说您永远不能使用 OR 或 IN 列表。在某些情况下，查询优化器足够聪明，可以将 IN 列表转换为连接——而您给出的其他答案正是最有可能的情况。

但是如果我们可以显式地将我们的查询变成一个连接，那么我们就不必怀疑查询优化器是否聪明。通常，连接是数据库最擅长的工作。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-08T17:33:25.930

好吧，只是给这个快速而肮脏的镜头，我会写这样的东西。我大部分时间都在使用 Firebird，所以 MySQL 的语法可能*有点*不同，但思路应该很清楚

```
select f.name
from   family f left join genus g on f.id = g.family_id
       left join species s on g.id = species.genus_id
where  ( s.id is null ) 
```

如果你想强制存在一个属，那么你只需删除从家庭到属的连接的“左”部分。

我希望我没有误解这个问题，从而导致你走错了路。祝你好运！

编辑：实际上，重新阅读这个我认为这只会抓住一个属内没有物种的家庭。我认为你也可以添加一个“and (g.id is null)”。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-08T17:34:57.173

子选择救援...

```
 select f.name from family as f, genus as g
where
  f.id == g.family_id and
  g.id not in (select genus_id from species); 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-08T17:40:38.177

```
SELECT f.name
FROM   family f
WHERE  NOT EXISTS (
       SELECT  1
       FROM    genus g 
       JOIN    species s
       ON      g.id = s.genus_id
       WHERE   g.family_id = f.id
       ) 
```

请注意，与纯`LEFT JOIN`解决方案相比，这更有效。

它不会选择所有行来过滤掉具有`NOT NULL`值的行，而是最多从`genus`和中选择一行`species`。***~~~~**