# StackOverflow 问答 000318000-000318999

# ruby-on-rails - RoR：构建“仪表板”类型页面的最佳方式？

> ID：318018
> 
> 赞同：3
> 
> 时间：2008-11-25T16:36:46.373
> 
> 标签：ruby-on-rails, ruby

在我正在构建的网站的管理部分，我想组合一个仪表板页面或“快速查看”类型的页面，可以查看几个不同区域的最新更改/添加/等。

我在想最好的方法是使用部分，并让每个部分包含我需要显示的数据的标记。

我的问题是，这是最好的方法吗？如果是这样，我如何分离这些部分的逻辑和表示？例如，我如何将逻辑放在仪表板控制器中，但将演示文稿保留在部分 rhtml 中？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-25T16:53:29.133

部分绝对是要走的路，尤其是当您可以将任意数据传递给它们以使它们执行某些操作时。要专门回答您的逻辑分离问题，您将使用：

```
<%= render :partial => "name_of_partial", :locals => { :some_var => @data_from_model } %> 
```

然后，在您的部分内部，您可以通过 some_var 变量访问@data_from_model。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-25T17:01:56.887

控制器应该负责检索您需要呈现的数据（并且通常隐式地将其传递给视图）。此处不构建 HTML。

当然，部分是您确定演示文稿的地方 - 您可以将其设为列表、图形、Google 可视化小部件、40 号字体的单个数字，等等。

```
<%= render :partial => 'new_users_last7days', ;locals => { :new_user_count => @new_users.size } %> 
```

# .net - 为什么 Visual Studio/CLR 会产生“坏”的可执行文件？

> ID：318019
> 
> 赞同：3
> 
> 时间：2008-11-25T16:37:12.677
> 
> 标签：.net, vb.net, visual-studio, clr

这是我最近开始遇到的一个奇怪问题。我的团队正在开发一个 COTS 应用程序，我们有几个人在编写代码。几周前，我在尝试调试（并运行已编译的 EXE）时收到一条错误消息：

> “Windows 无法访问指定的设备、路径或文件。您可能没有访问该项目的适当权限。”

最后我不得不重构这段代码：

```
mcolSchedulesNeedingOverride(New Guid(lstrErrorParts(0))) &= vbNewLine & lstrErrorParts(2) 
```

对此：

```
Dim lguidKey As New Guid(lstrErrorParts(0))
Dim lstrErrorMsg As String = mcolSchedulesNeedingOverride(lguidKey)
lstrErrorMsg &= vbNewLine & lstrErrorParts(2)
mcolSchedulesNeedingOverride(lguidKey) = lstrErrorMsg 
```

然后允许 VS 生成一个实际工作的 EXE。我真的不明白为什么，但它奏效了。我确实使用了 peverify 实用程序来确定哪个程序集有问题。

现在，在昨天更新了大约 25 个文件后，我在不同的代码分支中遇到了同样的问题。这不会很有趣 - 所以我希望有人能提供一些关于为什么会发生这种情况的见解 - 这可能会帮助我缩小查找范围。

peverify 显示*我们*所有的程序集都是正确的，但会吐出 System.Windows.Forms.dll 的 90 多个错误！

有人有任何提示吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-25T16:45:09.383

你说你有几个开发人员在做这个项目，所以我想知道他们是否也遇到了这个问题。

如果它只发生在你的机器上，那么我不会去寻找代码中的问题（你所做的重构似乎与错误完全无关，所以我猜它后来工作的原因是另一个）但是去寻找一个你的环境中的问题。

您的 .NET Framework 安装可能有问题或配置不正确。你能看到哪个文件抛出了错误信息吗？为您机器上的任何程序集定义的任何策略？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-26T00:27:01.323

当我从网络/某些不受信任的位置拉出二进制文件时，我最常遇到该错误消息。Windows 将“有帮助”并阻止对它的访问。

右键单击文件并选择属性，然后“取消阻止”

奇怪的是，错误在其他地方的表现不同，所以这可能完全不相关；但是在您的机器上构建会使Windows对文件的处理方式与下载的副本不同……但不确定这与重新启动有何关系。

编辑：有关我所指的“功能”的更详尽描述，请参阅[此kb 文章](http://support.microsoft.com/kb/883260)

# c# - 如何安全地将用户凭据从服务器传递到客户端？

> ID：318039
> 
> 赞同：1
> 
> 时间：2008-11-25T16:41:40.313
> 
> 标签：c#, asp.net, web-services

我的目标是使用管理员凭据（具有安装权限的用户）启动安装，为此我需要从 Web 服务传递这些用户凭据。所以问题是我可以传递这些数据的最安全的方式是什么。请记住，最终客户端的用户未以管理员身份登录，但我假设在传输期间可以访问数据（即我不能仅依靠通道安全性。）

Myclient 代码将是一个 vb 或 C# 应用程序与一个 asp.net webservice 对话。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-27T14:10:00.103

正如 gedevan 所指出的，加密将在从 WebService 传输到应用程序内存期间保护管理员凭据。

您的意思是您还想保护它们免受启动应用程序的用户的影响吗？请记住，他是您的流程的所有者，因此通过正确的工具和大量的决心，他应该能够从流程内存中提取凭据。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-26T06:33:42.393

在大多数情况下，将消息体加密（WS-Encryption）与 HTTPS 结合使用是非常安全的。

# .net - String.Format (format,date) 忽略格式

> ID：318056
> 
> 赞同：17
> 
> 时间：2008-11-25T16:46:22.643
> 
> 标签：.net, datetime

不知道这里发生了什么。

我有一个 DateTime 对象，当我尝试时：

```
String.Format( "{0:dd/MM/yyyy}", _date) 
```

返回的值为：

```
"24-05-1967" 
```

我想要的是

```
"24/05/1967" 
```

谁能解释为什么我的格式字符串被忽略了？

更多背景知识：这是一个 Web 应用程序，最初是 .net 1.1，我正在将其升级到 2.0/3.5。

更新：

如果我将格式更改为 {0:dd:MM:yyyy}，它将返回 24:05:1967 - 只有格式字符串中的 / 更改为 - 字符。

* * *

解析度：

当更新应用程序以在 2.0 下运行时，asp.net 全球化设置被搞砸了。

从网站属性、ASP.NET 选项卡、编辑配置、应用程序选项卡 - 文化和 UI 文化都被设置为列表中的第一项（af-ZA），原因很奇怪。

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2008-11-25T17:07:31.227

/ 实际上是您的特定文化的日期分隔符，可以是 - ，换句话说，格式字符串不会被忽略，但实际上是正确使用的。查看 CultureInfo 与正在运行的线程关联的内容：

```
System.Threading.Thread.CurrentThread.CurrentCulture 
```

如果你试试这个：

```
String.Format(new CultureInfo("en-US"), "{0:dd/MM/yyyy}", DateTime.Now); 
```

您将获得使用 / 格式化的日期，因为这是 en-US 的正确分隔符。您可能应该做的是使用短日期格式字符串并确保线程具有相关的适当文化，然后这将为您提供所需的内容，并且它也可以在全球化的应用程序中工作：

```
DateTime.Now.ToString("d", Thread.CurrentThread.CurrentCulture); 
```

希望这可以帮助！

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-11-25T16:57:33.807

您可能希望使用 DateTime 对象的*ToString()*方法来获取您所追求的字符串表示形式。**“dd'/'MM'/'yyyy”**的格式字符串将为您提供您描述的格式。请注意，您需要使用单引号对格式字符串中的文字字符进行转义。

例子：`DateTime.Now.ToString("dd'/'MM'/'yyyy");`

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-25T17:07:34.597

除非您指定 IFormatProvider（通常是 CultureInfo 对象），否则它将默认使用 Thread.CurrentThread.CurrentCulture 的日期/时间格式，这将为您提供更改的结果。

是的，它会改变/但不会:.

这种情况下的解决方案是指定格式提供程序，如下所示：

```
String.Format(CultureInfo.InvariantCulture, "{0:dd/MM/yyyy}", _date) 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-25T17:12:24.073

“/”字符是区域设置中定义的日期时间分隔符的文化中性占位符。时间的“：”字符也是如此。

要在字面上嵌入“/”而不是作为占位符，您需要在格式字符串中将其括在单引号 '/' 中。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-25T17:03:00.440

这很奇怪。这种格式对我来说是正确的。您可能想尝试 _date.ToString("dd/MM/yyyy") 代替（尽管这只是在黑暗中拍摄）。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-25T17:06:18.920

区域设置（在 Web 服务器上？）将日期分隔符设置为“-”。在我的语言环境（EE）中，输出将是“24.05.1967”:)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-11-20T09:52:23.093

这将为您提供所需的**输出**

```
String.Format( "{0:dd/MM/yyyy}", Convert.ToDateTime(_date)); 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2012-01-31T12:24:47.863

有趣的线程！

我有一个读取 Excel 文件的应用程序，并让用户以*用户定义的格式*将其数据导出到 .csv 文件。

我特别想让用户能够将日期导出为（完全）像 yyyy/mm/dd 这样的格式，而不管他们笔记本电脑的文化信息如何。

我尝试了其中一些建议，但唯一有效的是 Pop Catalin 的建议，用撇号包装任何 / 字符：

```
outputFormat = outputFormat.Replace("/", "'/'");
valueToExport = ImportedDate.ToString(outputFormat); 
```

这似乎是强制 ToString() 使用确切格式字符串的*唯一*方法，而无需尝试执行任何特定于文化的事情。

**更新**

当我回答 StackOverflow 问题时，我总是觉得很有趣，几年后又遇到了同样的错误，然后偶然发现了我自己的答案！

正如许多这些答案中提到的，解决方案是将正斜杠字符包装在撇号中，以强制`ToString()`忽略文化设置。

因此，如果您的文化设置有一个句号作为日期分隔符（例如“ `20.07.2015`”），那么当您尝试很好地格式化圣诞节的日期时，您会看到以下内容，以及如何轻松地强制它*始终*使用正斜杠：

```
DateTime dtChristmas = new DateTime(2015, 12, 31);

//  This might return "31/12/2015", "31.12.2015", etc, depending on Culture settings
string str1 = dtChristmas.ToString("dd/MM/yyyy");

//  ...but these two statements will both *always* return "31/12/2015"
string str2 = dtChristmas.ToString("dd'/'MM'/'yyyy");
string str3 = dtChristmas.ToString("dd/MM/yyyy", System.Globalization.CultureInfo.InvariantCulture); 
```

# c++ - 如何在 C++ 中声明接口？

> ID：318064
> 
> 赞同：856
> 
> 时间：2008-11-25T16:48:47.303
> 
> 标签：c++, inheritance, interface, abstract-class, pure-virtual

如何设置代表接口的类？这只是一个抽象基类吗？

* * *

## 回答 #1

> 赞同：723
> 
> 时间：2008-11-25T17:11:33.763

要扩展[bradtgmurray](https://stackoverflow.com/questions/318064/how-do-you-declare-an-interface-in-c#318084)的答案，您可能希望通过添加虚拟析构函数来对接口的纯虚拟方法列表进行一个例外处理。这允许您在不暴露具体派生类的情况下将指针所有权传递给另一方。析构函数不需要做任何事情，因为接口没有任何具体的成员。将函数定义为虚拟函数和内联函数似乎是矛盾的，但请相信我——事实并非如此。

```
class IDemo
{
    public:
        virtual ~IDemo() {}
        virtual void OverrideMe() = 0;
};

class Parent
{
    public:
        virtual ~Parent();
};

class Child : public Parent, public IDemo
{
    public:
        virtual void OverrideMe()
        {
            //do stuff
        }
}; 
```

您不必包含虚拟析构函数的主体 - 事实证明，某些编译器在优化空析构函数时遇到了麻烦，您最好使用默认值。

* * *

## 回答 #2

> 赞同：256
> 
> 时间：2008-11-25T16:53:31.350

使用纯虚方法创建一个类。通过创建另一个覆盖这些虚拟方法的类来使用该接口。

纯虚方法是定义为虚并赋值为 0 的类方法。

```
class IDemo
{
    public:
        virtual ~IDemo() {}
        virtual void OverrideMe() = 0;
};

class Child : public IDemo
{
    public:
        virtual void OverrideMe()
        {
            // do stuff
        }
}; 
```

* * *

## 回答 #3

> 赞同：162
> 
> 时间：2008-11-25T17:01:06.327

[除了 C#/ Java](https://stackoverflow.com/questions/1321122/what-is-an-interface-in-java)中的抽象基类之外，您还有一个特殊的接口类型类别的全部原因是因为 C#/Java 不支持多重继承。

C++ 支持多重继承，因此不需要特殊类型。没有非抽象（纯虚拟）方法的抽象基类在功能上等同于 C#/Java 接口。

* * *

## 回答 #4

> 赞同：56
> 
> 时间：2008-11-25T17:27:01.813

C++ 中没有“接口”的概念。AFAIK，接口最初是在 Java 中引入的，以解决缺乏多重继承的问题。事实证明，这个概念非常有用，在 C++ 中使用抽象基类也可以达到相同的效果。

抽象基类是一个类，其中至少一个成员函数（Java 术语中的方法）是使用以下语法声明的纯虚函数：

```
class A
{
  virtual void foo() = 0;
}; 
```

抽象基类不能被实例化，即不能声明类 A 的对象。只能从 A 派生类，但任何不提供实现的派生类`foo()`也将是抽象类。为了停止抽象，派生类必须为其继承的所有纯虚函数提供实现。

请注意，抽象基类可以不仅仅是一个接口，因为它可以包含非纯虚拟的数据成员和成员函数。接口的等价物将是一个抽象基类，没有任何数据，只有纯虚函数。

而且，正如 Mark Ransom 所指出的，抽象基类应该提供一个虚拟析构函数，就像任何基类一样。

* * *

## 回答 #5

> 赞同：46
> 
> 时间：2012-03-05T17:53:12.867

据我测试，添加虚拟析构函数非常重要。我正在使用使用创建`new`和销毁的对象`delete`。

如果没有在接口中添加虚析构函数，那么继承类的析构函数就不会被调用。

```
class IBase {
public:
    virtual ~IBase() {}; // destructor, use it to call destructor of the inherit classes
    virtual void Describe() = 0; // pure virtual method
};

class Tester : public IBase {
public:
    Tester(std::string name);
    virtual ~Tester();
    virtual void Describe();
private:
    std::string privatename;
};

Tester::Tester(std::string name) {
    std::cout << "Tester constructor" << std::endl;
    this->privatename = name;
}

Tester::~Tester() {
    std::cout << "Tester destructor" << std::endl;
}

void Tester::Describe() {
    std::cout << "I'm Tester [" << this->privatename << "]" << std::endl;
}

void descriptor(IBase * obj) {
    obj->Describe();
}

int main(int argc, char** argv) {

    std::cout << std::endl << "Tester Testing..." << std::endl;
    Tester * obj1 = new Tester("Declared with Tester");
    descriptor(obj1);
    delete obj1;

    std::cout << std::endl << "IBase Testing..." << std::endl;
    IBase * obj2 = new Tester("Declared with IBase");
    descriptor(obj2);
    delete obj2;

    // this is a bad usage of the object since it is created with "new" but there are no "delete"
    std::cout << std::endl << "Tester not defined..." << std::endl;
    descriptor(new Tester("Not defined"));

    return 0;
} 
```

如果你在没有 的情况下运行前面的代码`virtual ~IBase() {};`，你会看到析构函数`Tester::~Tester()`永远不会被调用。

* * *

## 回答 #6

> 赞同：32
> 
> 时间：2008-11-25T18:48:00.307

我的回答与其他人基本相同，但我认为还有两件重要的事情要做：

1.  在您的接口中声明一个虚拟析构函数或创建一个受保护的非虚拟析构函数以避免在有人试图删除类型对象时出现未定义的行为`IDemo`。

2.  使用虚拟继承来避免多重继承的问题。（当我们使用接口时，更常见的是多重继承。）

和其他答案一样：

*   使用纯虚方法创建一个类。
*   通过创建另一个覆盖这些虚拟方法的类来使用该接口。

    ```
    class IDemo
    {
        public:
            virtual void OverrideMe() = 0;
            virtual ~IDemo() {}
    } 
    ```

    或者

    ```
    class IDemo
    {
        public:
            virtual void OverrideMe() = 0;
        protected:
            ~IDemo() {}
    } 
    ```

    和

    ```
    class Child : virtual public IDemo
    {
        public:
            virtual void OverrideMe()
            {
                //do stuff
            }
    } 
    ```

* * *

## 回答 #7

> 赞同：11
> 
> 时间：2013-06-25T13:51:08.947

在 C++11 中，您可以轻松地完全避免继承：

```
struct Interface {
  explicit Interface(SomeType& other)
  : foo([=](){ return other.my_foo(); }), 
    bar([=](){ return other.my_bar(); }), /*...*/ {}
  explicit Interface(SomeOtherType& other)
  : foo([=](){ return other.some_foo(); }), 
    bar([=](){ return other.some_bar(); }), /*...*/ {}
  // you can add more types here...

  // or use a generic constructor:
  template<class T>
  explicit Interface(T& other)
  : foo([=](){ return other.foo(); }), 
    bar([=](){ return other.bar(); }), /*...*/ {}

  const std::function<void(std::string)> foo;
  const std::function<void(std::string)> bar;
  // ...
}; 
```

在这种情况下，接口具有引用语义，即您必须确保对象的寿命比接口长（也可以使用值语义制作接口）。

这些类型的接口各有利弊：

*   它们比基于继承的多态性[需要更多的内存。](http://probablydance.com/2013/01/13/a-faster-implementation-of-stdfunction/)
*   它们[通常](http://probablydance.com/2013/01/13/a-faster-implementation-of-stdfunction/)比基于继承的多态性更快。
*   在您知道最终类型的情况下，[它们要快得多！](https://stackoverflow.com/questions/14922890/whats-the-cost-of-calling-a-virtual-function-in-a-non-polymorphic-way)（一些编译器如 gcc 和 clang 对不具有/继承自具有虚函数的类型的类型执行更多优化）。

最后，继承是复杂软件设计中万恶之源。在[Sean Parent 的 Value Semantics and Concepts-based Polymorphism](http://www.youtube.com/watch?v=_BpMYeUFXv8)（强烈推荐，该技术的更好版本在那里解释）中研究了以下案例：

`MyShape`假设我有一个应用程序，我在其中使用界面以多态方式处理我的形状：

```
struct MyShape { virtual void my_draw() = 0; };
struct Circle : MyShape { void my_draw() { /* ... */ } };
// more shapes: e.g. triangle 
```

在您的应用程序中，您可以使用`YourShape`界面对不同的形状执行相同操作：

```
struct YourShape { virtual void your_draw() = 0; };
struct Square : YourShape { void your_draw() { /* ... */ } };
/// some more shapes here... 
```

现在假设您想使用我在您的应用程序中开发的一些形状。从概念上讲，我们的形状具有相同的界面，但要使我的形状在您的应用程序中工作，您需要按如下方式扩展我的形状：

```
struct Circle : MyShape, YourShape { 
  void my_draw() { /*stays the same*/ };
  void your_draw() { my_draw(); }
}; 
```

首先，修改我的形状可能根本不可能。此外，多重继承导致了意大利面条代码（想象第三个项目使用`TheirShape`接口......如果他们也调用他们的绘图函数会发生什么`my_draw`？）。

更新：有一些关于基于非继承的多态性的新参考：

*   Sean Parent's [Inheritance 是恶语的基类](http://channel9.msdn.com/Events/GoingNative/2013/Inheritance-Is-The-Base-Class-of-Evil)。
*   Sean Parent 的[价值语义和基于概念的多态性](https://www.youtube.com/watch?v=_BpMYeUFXv8)演讲。
*   Pyry Jahkola 的[无继承多态性](https://www.youtube.com/watch?v=y54sKDKrDX8)演讲和[poly 库文档](https://github.com/pyrtsa/poly)。
*   Zach Laine 的[实用类型擦除：用优雅的设计模式](https://www.youtube.com/watch?v=0I0FD3N5cgM)演讲解决 OOP 问题。
*   Andrzej 的 C++ 博客 - 类型擦除部分[i](http://akrzemi1.wordpress.com/2013/11/18/type-erasure-part-i/)、[ii](http://akrzemi1.wordpress.com/2013/12/06/type-erasure-part-ii/)、[iii](http://akrzemi1.wordpress.com/2013/12/11/type-erasure-part-iii/)和[iv](http://akrzemi1.wordpress.com/2014/01/13/type-erasure-part-iv/)。
*   [运行时多态泛型编程——在 ConceptC++ 中混合对象和概念](http://akrzemi1.files.wordpress.com/2013/10/mpool2007-marcus.pdf)
*   [Boost.TypeErasure 文档](http://www.boost.org/doc/libs/1_56_0/doc/html/boost_typeerasure.html)
*   [Adobe Poly 文档](http://stlab.adobe.com/group__poly__related.html)
*   [Boost.Any](http://www.boost.org/doc/libs/1_56_0/doc/html/any.html)，[std::any 提案（修订版 3）](http://www.open-std.org/JTC1/sc22/WG21/docs/papers/2013/n3804.html)，[Boost.Spirit::hold_any](http://www.boost.org/doc/libs/1_51_0/boost/spirit/home/support/detail/hold_any.hpp)。

* * *

## 回答 #8

> 赞同：10
> 
> 时间：2008-11-25T22:02:19.167

上面所有的好答案。您应该记住的另一件事 - 您还可以拥有一个纯虚拟析构函数。唯一的区别是您仍然需要实现它。

使困惑？

```
 --- header file ----
    class foo {
    public:
      foo() {;}
      virtual ~foo() = 0;

      virtual bool overrideMe() {return false;}
    };

    ---- source ----
    foo::~foo()
    {
    } 
```

你想要这样做的主要原因是如果你想提供接口方法，就像我一样，但要覆盖它们是可选的。

要使类成为接口类，需要纯虚方法，但所有虚方法都有默认实现，因此唯一可以制作纯虚的方法是析构函数。

在派生类中重新实现析构函数没什么大不了的——我总是在派生类中重新实现析构函数，无论是否虚拟。

* * *

## 回答 #9

> 赞同：7
> 
> 时间：2008-11-25T17:49:00.830

您还可以考虑使用 NVI（非虚拟接口模式）实现的合同类。例如：

```
struct Contract1 : boost::noncopyable
{
    virtual ~Contract1() = default;
    void f(Parameters p) {
        assert(checkFPreconditions(p)&&"Contract1::f, pre-condition failure");
        // + class invariants.
        do_f(p);
        // Check post-conditions + class invariants.
    }
private:
    virtual void do_f(Parameters p) = 0;
};
...
class Concrete : public Contract1, public Contract2
{
private:
    void do_f(Parameters p) override; // From contract 1.
    void do_g(Parameters p) override; // From contract 2.
}; 
```

* * *

## 回答 #10

> 赞同：7
> 
> 时间：2009-10-13T19:53:38.793

如果您使用的是 Microsoft 的 C++ 编译器，则可以执行以下操作：

```
struct __declspec(novtable) IFoo
{
    virtual void Bar() = 0;
};

class Child : public IFoo
{
public:
    virtual void Bar() override { /* Do Something */ }
} 
```

我喜欢这种方法，因为它会产生更小的接口代码，并且生成的代码大小可以显着更小。novtable 的使用删除了对该类中 vtable 指针的所有引用，因此您永远不能直接实例化它。请参阅此处的文档 - [novtable](http://msdn.microsoft.com/en-us/library/k13k85ky.aspx)。

* * *

## 回答 #11

> 赞同：5
> 
> 时间：2008-11-25T17:35:34.227

对上面写的内容做一点补充：

首先，确保你的析构函数也是纯虚拟的

其次，您可能希望在实施时虚拟（而不是通常）继承，只是为了采取良好的措施。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2021-05-17T16:44:00.577

在 C++20 中，您可以使用 a`concept`代替类。它比继承更有效。

```
template <class T>
concept MyInterface = requires (T t) {
    { t.interfaceMethod() };
};

class Implementation {
public:
    void interfaceMethod();
};
static_assert(MyInterface<Implementation>); 
```

然后你可以在一个函数中使用它：

```
void myFunction(MyInterface auto& arg); 
```

限制是您不能在容器中使用它。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2015-09-27T18:27:29.060

我还是 C++ 开发的新手。我从 Visual Studio (VS) 开始。

然而，似乎没有人提到`__interface`VS **(.NET)**。我**不太**确定这是否是声明接口的好方法。但它似乎提供了*额外的强制执行（在*[文件](https://msdn.microsoft.com/en-us/library/50h7kwtb.aspx)中提到）。这样您就不必明确指定`virtual TYPE Method() = 0;`，因为它将自动转换。

```
__interface IMyInterface {
   HRESULT CommitX();
   HRESULT get_X(BSTR* pbstrName);
}; 
```

> 但是，我不使用它，因为我担心跨平台编译兼容性，因为它仅在 .NET 下可用。

如果有人对此有任何有趣的事情，请分享。:-)

谢谢。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2016-07-26T15:29:25.433

虽然这`virtual`是定义接口的事实标准，但我们不要忘记经典的类 C 模式，它带有 C++ 中的构造函数：

```
struct IButton
{
    void (*click)(); // might be std::function(void()) if you prefer

    IButton( void (*click_)() )
    : click(click_)
    {
    }
};

// call as:
// (button.*click)(); 
```

这样做的好处是您可以重新绑定事件运行时而不必再次构造您的类（因为 C++ 没有用于更改多态类型的语法，这是变色龙类的解决方法）。

尖端：

*   您可以从 this 作为基类继承（允许虚拟和非虚拟）并填写`click`后代的构造函数。
*   您可能将函数指针作为`protected`成员并具有`public`引用和/或 getter。
*   如上所述，这允许您在运行时切换实现。因此，它也是一种管理状态的方法。根据`if`代码中 s 与状态更改的数量，这*可能*比`switch()`es 或`if`s 更快（预计周转时间约为 3-4`if`秒，但始终先测量。
*   如果您选择`std::function<>`函数指针，您*可能*能够在`IBase`. 从这一点开始，您可以获得价值示意图`IBase`（例如，`std::vector<IBase>`将起作用）。请注意，这*可能*会更慢，具体取决于您的编译器和 STL 代码；`std::function<>`此外，与函数指针甚至虚函数相比，当前的实现往往会产生开销（这可能会在未来发生变化）。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2017-11-07T01:22:20.887

这是`abstract class`c ++标准中的定义

n4687

**13.4.2**

> 抽象类是只能用作其他类的基类的类；抽象类的任何对象都不能被创建，除非是从它派生的类的子对象。如果一个类至少有一个纯虚函数，那么它就是抽象的。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2021-07-15T09:14:16.310

如果您只想要接口的静态绑定（没有虚拟，没有接口类型本身的实例，接口仅作为指导）：

```
#include <iostream>
#include <string>

// Static binding interface
// Notice: instantiation of this interface should be usefuless and forbidden.
class IBase {
 protected:
  IBase() = default;
  ~IBase() = default;

 public:
  // Methods that must be implemented by the derived class
  void behaviorA();
  void behaviorB();

  void behaviorC() {
    std::cout << "This is an interface default implementation of bC().\n";
  };
};

class CCom : public IBase {
  std::string name_;

 public:
  void behaviorA() { std::cout << "CCom bA called.\n"; };
};

class CDept : public IBase {
  int ele_;

 public:
  void behaviorB() { std::cout << "CDept bB called.\n"; };
  void behaviorC() {
    // Overwrite the interface default implementation
    std::cout << "CDept bC called.\n";
    IBase::behaviorC();
  };
};

int main(void) {
  // Forbid the instantiation of the interface type itself.
  // GCC error: ‘constexpr IBase::IBase()’ is protected within this context
  // IBase o;

  CCom acom;
  // If you want to use these interface methods, you need to implement them in
  // your derived class. This is controled by the interface definition.
  acom.behaviorA();
  // ld: undefined reference to `IBase::behaviorB()'
  // acom.behaviorB();
  acom.behaviorC();

  CDept adept;
  // adept.behaviorA();
  adept.behaviorB();
  adept.behaviorC();
  // adept.IBase::behaviorC();
} 
```

* * *

## 回答 #17

> 赞同：-2
> 
> 时间：2013-12-19T15:45:41.140

```
class Shape 
{
public:
   // pure virtual function providing interface framework.
   virtual int getArea() = 0;
   void setWidth(int w)
   {
      width = w;
   }
   void setHeight(int h)
   {
      height = h;
   }
protected:
    int width;
    int height;
};

class Rectangle: public Shape
{
public:
    int getArea()
    { 
        return (width * height); 
    }
};
class Triangle: public Shape
{
public:
    int getArea()
    { 
        return (width * height)/2; 
    }
};

int main(void)
{
     Rectangle Rect;
     Triangle  Tri;

     Rect.setWidth(5);
     Rect.setHeight(7);

     cout << "Rectangle area: " << Rect.getArea() << endl;

     Tri.setWidth(5);
     Tri.setHeight(7);

     cout << "Triangle area: " << Tri.getArea() << endl; 

     return 0;
} 
```

结果：矩形面积：35 三角形面积：17

我们已经看到一个抽象类如何根据 getArea() 定义一个接口，而另外两个类实现了相同的功能，但使用不同的算法来计算特定于形状的区域。

# sql - 不明确的列名错误

> ID：318066
> 
> 赞同：9
> 
> 时间：2008-11-25T16:49:13.340
> 
> 标签：sql, sql-server, sqlexception

在 Microsoft SQL Server 2000 上执行以下（完整）SQL 查询时：

```
SELECT B.ARTIFACTTNS, B.ARTIFACTNAME, B.ARTIFACTTYPE, B.INITIALBYTES, B.TIMESTAMP1, B.FILENAME, B.BACKINGCLASS, 
       B.CHARENCODING, B.APPNAME, B.COMPONENTTNS, B.COMPONENTNAME, B.SCAMODULENAME, B.SCACOMPONENTNAME 
FROM (SELECT DISTINCT A.ARTIFACTTYPE, A.ARTIFACTTNS, A.ARTIFACTNAME 
      FROM (SELECT DISTINCT ARTIFACTTYPE, ARTIFACTTNS, ARTIFACTNAME 
            FROM CUSTPROPERTIES WHERE PNAME = 'AcmeSystemName' AND PVALUE = 'MyRuleGroup' 
                  UNION SELECT DISTINCT ARTIFACTTYPE, ARTIFACTTNS, ARTIFACTNAME 
                          FROM CUSTPROPERTIES WHERE PNAME = 'AcmeSystemDisplayName' AND PVALUE = 'MyRuleGroup') A, 
           (SELECT DISTINCT ARTIFACTTYPE, ARTIFACTTNS, ARTIFACTNAME 
            FROM CUSTPROPERTIES WHERE PNAME = 'AcmeSystemTargetNameSpace' AND PVALUE = 'http://MyModule') B 
WHERE A.ARTIFACTTYPE = B.ARTIFACTTYPE AND A.ARTIFACTTNS = B.ARTIFACTTNS AND A.ARTIFACTNAME = B.ARTIFACTNAME) A, BYTESTORE B 
    WHERE (A.ARTIFACTTYPE = 'BRG') AND A.ARTIFACTTYPE = B.ARTIFACTTYPE AND A.ARTIFACTTNS = B.ARTIFACTTNS AND A.ARTIFACTNAME = B.ARTIFACTNAME 
    ORDER BY ARTIFACTTYPE, ARTIFACTTNS, ARTIFACTNAME 
```

我得到以下异常：

```
java.sql.SQLException: [Acme][SQLServer JDBC Driver][SQLServer]
    Ambiguous column name 'ARTIFACTTYPE'. 
```

我在这里做错了什么，我该如何纠正？

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2008-11-25T16:54:10.070

因为`ARTIFACTTYPE`可以引用`A.ARTIFACTTYPE`or`B.ARTIFACTTYPE`并且服务器需要知道您想要哪个，只需将其更改为`A.ARTIFACTTYPE`，在这种情况下您应该没问题。

为了澄清，您需要在列名不明确时指定别名前缀。始终使用别名前缀并不是一个坏习惯，因为它可以在您阅读查询时清楚地说明哪些列来自哪些表，并消除了类似这样的问题。

有人可能想知道，当它们都引用同一个表中的同一列时，为什么需要区分您想要的两列中的哪一列。答案是，当您将表连接到自身时，A.column 和 B.column 中的值可能会有所不同，具体取决于连接条件（例如外部连接的情况，其中一列中的值可能是空值）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-25T17:54:46.170

如果那是您正在运行的确切查询，我不知道为什么它会发现任何模棱两可的东西。

我编写了我认为是等效查询的内容，并在我的数据库（Oracle）中毫无问题地运行它。

**编辑**在 Oracle 中添加新实验的精确输出。本实验中执行的查询是 OP 给出的确切查询，并填写了表名。 **NO OTHER CHANGES**。这个查询没有任何歧义。因此，要么这不是正在执行的确切查询，要么 SQL Server 存在解析器错误。

```
SQL> create table props (pname varchar2(100),
  2                       pvalue varchar2(100),
  3                       artifacttype number,
  4                       artifacttns number,
  5                       artifactname number);

Table created.

SQL> SELECT      
  2    DISTINCT A.ARTIFACTTYPE, A.ARTIFACTTNS, A.ARTIFACTNAME
  3  FROM
  4   (SELECT DISTINCT 
  5      ARTIFACTTYPE, 
  6      ARTIFACTTNS, 
  7      ARTIFACTNAME 
  8    FROM props 
  9    WHERE PNAME = 'AcmeSystemName' 
 10        AND PVALUE = 'MyRuleGroup' 
 11    UNION 
 12    SELECT DISTINCT 
 13      ARTIFACTTYPE, 
 14      ARTIFACTTNS, 
 15      ARTIFACTNAME 
 16    FROM props
 17    WHERE PNAME = 'AcmeSystemDisplayName' 
 18        AND PVALUE = 'MyRuleGroup') A, 
 19  (SELECT DISTINCT 
 20      ARTIFACTTYPE, 
 21      ARTIFACTTNS, 
 22      ARTIFACTNAME 
 23   FROM props 
 24   WHERE PNAME = 'AcmeSystemTargetNameSpace' 
 25      AND PVALUE = 'http://mymodule') B
 26  WHERE A.ARTIFACTTYPE = B.ARTIFACTTYPE 
 27      AND A.ARTIFACTTNS = B.ARTIFACTTNS 
 28      AND A.ARTIFACTNAME = B.ARTIFACTNAME
 29  /

no rows selected 
```

**结束编辑**

我对解决该错误的建议是为每个 select 子句中的表提供一个唯一别名并限定所有列引用。像这样：

```
SELECT
  DISTINCT A.ARTIFACTTYPE, A.ARTIFACTTNS, A.ARTIFACTNAME
FROM
 (SELECT DISTINCT 
    P1.ARTIFACTTYPE, 
    P1.ARTIFACTTNS, 
    P1.ARTIFACTNAME 
  FROM {PROPERTIES_TABLE_NAME} P1
  WHERE PNAME = 'AcmeSystemName' 
      AND PVALUE = 'MyRuleGroup' 
  UNION 
  SELECT DISTINCT 
    P2.ARTIFACTTYPE, 
    P2.ARTIFACTTNS, 
    P2.ARTIFACTNAME 
  FROM {PROPERTIES_TABLE_NAME} P2
  WHERE PNAME = 'AcmeSystemDisplayName' 
      AND PVALUE = 'MyRuleGroup') A, 
(SELECT DISTINCT 
    P3.ARTIFACTTYPE, 
    P3.ARTIFACTTNS, 
    P3.ARTIFACTNAME 
 FROM {PROPERTIES_TABLE_NAME} P3
 WHERE PNAME = 'AcmeSystemTargetNameSpace' 
    AND PVALUE = 'http://mymodule') B
WHERE A.ARTIFACTTYPE = B.ARTIFACTTYPE 
    AND A.ARTIFACTTNS = B.ARTIFACTTNS 
    AND A.ARTIFACTNAME = B.ARTIFACTNAME 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-25T18:14:52.153

您是否列出了完整的查询？也许您还有 ORDER BY 子句 - 这可能会导致该问题

我会支持[戴夫](https://stackoverflow.com/questions/318066/ambiguous-column-name-error#318285)发布的查询应该没有问题

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-25T17:42:38.177

需要明确的是，第 13、14 和 15 行的列不明确。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-09T18:36:29.337

您需要在`ORDER BY`子句中指定表，如下所示：

```
ORDER BY A.ARTIFACTTYPE, A.ARTIFACTTNS, A.ARTIFACTNAME 
```

# python - Python：转换字符串以用于 ctypes.c_void_p()

> ID：318067
> 
> 赞同：8
> 
> 时间：2008-11-25T16:49:18.393
> 
> 标签：python, dll, types, ctypes

给定一个字符串：

```
msg="hello world" 
```

**如何将其定义为`ctypes.c_void_p()`数据类型？**

以下代码产生“无法转换为指针”异常：

```
data=ctypes.c_void_p(msg) 
```

`data`必须是`void*`C 中的类型，因为它被传递给 DLL。

我假设有一种方法可以使用包来打包/解包字符串`struct`，但不幸的是我对这个过程非常不熟悉。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-11-25T17:12:04.963

像这样的东西？使用`ctypes.cast`?

```
>>> import ctypes
>>> p1= ctypes.c_char_p("hi mom")
>>> ctypes.cast( p1, ctypes.c_void_p )
c_void_p(11133300) 
```

# c# - 为什么这是一个“如此接近但如此遥远”的 if 语句？

> ID：318068
> 
> 赞同：0
> 
> 时间：2008-11-25T16:49:27.893
> 
> 标签：c#, .net, logic

我正在处理一个 If 语句，我想满足两个条件来忽略循环。起初这似乎很容易，但现在……我不知道。这是我的困境...

```
if((radButton1.checked == false)&&(radButton2.checked == false))
{
    txtTitle.Text = "go to work";
} 
```

如果 radButton1 为 false 且 radButton2 为 true，则不会执行“去工作”的困境。难道不应该要求两个条件都为假才能跳过该语句吗？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-11-25T16:52:40.570

不，它要求它们都为假才能*执行*该语句。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-11-25T16:53:05.327

不，它需要两个条件都为假才能*执行*该语句。再读一遍：

```
if ((radButton1.checked == false) && (radButton2.checked == false)) {
    txtTitle.Text = "Go to work";
} 
```

英文：“如果 radButton1.checked 为假且 radButton2.checked 为假，则将 txtTitle.Text 设置为 'Go to work'”。

如果您想在两个条件都为假时跳过该语句，则否定您的逻辑，如下所示：

```
if ((radButton1.checked == true) || (radButton2.checked == true)) {
    txtTitle.Text = "Go to work";
} 
```

翻译成英文会这样写：“如果 radButton1.checked 为 true 或 radButton2.checked 为 true，则将文本设置为 'Go to work'”。这意味着如果任何条件为真，它将执行该语句，或者，如果两者都为假，则跳过它。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2008-11-25T17:04:41.140

假设我有两个变量`A`名为`B`

如果 A 和 B 有这些值

```
A     true    true    false   false
B     true    false   true    false 
```

然后这些操作返回

```
AND   true    false   false   false
OR    true    true    true    false
XOR   false   true    true    false
NAND  false   true    true    true
NOR   false   false   false   true
XNOR  true    false   false   true 
```

请注意，第二个表中的底部 3 是同一张表中顶部 3 的逻辑对立面（即它们尚未应用）。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-25T16:53:49.197

`txtTitle.Text ="go to work"`在您的示例中，只有两个按钮都为假时，它才会执行代码。因此，一个为真，一个为假，它将跳过该语句。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-11-25T17:36:15.723

与真（或假）比较是完全没有必要的：

```
if(!((radButton1.checked == true)&&(radButton2.checked == true))) { ... } 
```

变成

```
if( !(radButton1.checked && radButton2.checked) ) { ... } 
```

或同样

```
if( !radButton1.checked || !radButton2.checked ) { ... } 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-25T16:54:30.660

不，它要求其中一个陈述是错误的才能跳过。看看你的如果：

```
if (condition1 && condition2) {
    doSomething();
} 
```

因此，如果条件 1 或条件 2 不为真，则它不会执行。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-25T17:21:54.270

我让它工作。我看到它们都需要为假才能执行该语句，对于该语句，满足这两个条件的方法是使用

```
if(!((radButton1.checked == true)&&(radButton2.checked == true)))
{
    ...
} 
```

# web-services - Request.ServerVariables("REMOTE_ADDR") 与 Request.ServerVariables("HTTP_X_FORWARDED_FOR") 的安全隐患

> ID：318069
> 
> 赞同：3
> 
> 时间：2008-11-25T16:49:28.393
> 
> 标签：web-services, security, asp-classic, vbscript

假设我们正在跟踪 Web 服务的最终用户 IP：

```
ip = Request.ServerVariables("HTTP_X_FORWARDED_FOR")
If ip = "" Then
    ip = Request.ServerVariables("REMOTE_ADDR")
End If 
```

我读过这是检索最终用户 IP 的最佳方法，因为它甚至适用于透明代理上的用户。

如果我们使用最终用户 IP 地址来过滤恶意用户，那么上述方法是否存在任何安全隐患，而不是仅使用 Request.ServerVariables("REMOTE_ADDR")？

例如，如果我们通过最终用户 IP 禁止恶意用户，他们是否可以通过代理轻松更改其 IP 并继续使用我们的 Web 服务？

在此先感谢您的帮助。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-11-25T16:54:40.333

`REMOTE_ADDR`由 Web 服务器根据来自客户端的连接生成。 `HTTP_X_FORWARDED_FOR`基于客户端发送的 HTTP 标头。

您不能信任来自客户端的输入，尤其是容易伪造的输入，例如 HTTP 标头。客户可以将**任何内容**粘贴到该`HTTP_X_FORWARDED_FOR`标头中。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-25T16:57:04.417

如果用户使用的是透明代理，那么上面的代码将获得真实的 IP 地址。但是，如果他们使用匿名代理（如 Anonymizer），那么就真的无法获取用户的实际 IP 地址。

# unit-testing - 如何从 MS Test 中读取“.NET Data Provider for SqlServer”性能计数器？

> ID：318071
> 
> 赞同：2
> 
> 时间：2008-11-25T16:49:53.960
> 
> 标签：unit-testing, mstest, performancecounter

如何从 MS Test 中的单元测试中读取“.NET Data Provider for SqlServer”类别的性能计数器“NumberOfActiveConnections”？

我正在尝试以下操作，但似乎我弄错了实例名称。[MSDN 文档](http://msdn.microsoft.com/en-us/library/ms254503.aspx)声称这是获取 WinForms 应用程序实例名称的正确方法，但这不适用于 MS Test：

```
string instanceName = System.Reflection.Assembly.GetEntryAssembly().GetName().Name; 
```

从 MS Test 运行上面的代码时，我`null`从调用中返回`GetEntryAssembly()`

我也尝试过使用 MS 测试过程的名称和其他变体，但没有任何运气。

这是当我使用上面的任何实例名称时将引发异常的示例代码：

```
PerformanceCounter counter = new PerformanceCounter(
    ".NET Data Provider for SqlServer", 
    "NumberOfActiveConnections", 
    instanceName, 
    true);            

Assert.AreEqual<long>(0, counter.RawValue); 
```

根据[MSDN 文档](http://msdn.microsoft.com/en-us/library/ms254503.aspx)，我通过将其添加到 app.config 来启用“NumberOfActiveConnections”计数器：

```
<system.diagnostics>
  <switches>
    <add name="ConnectionPoolPerformanceCounterDetail" value="4"/>
  </switches>
</system.diagnostics> 
```

也许问题是性能计数器是为 MS 测试主机域启用的，但不是为实际运行测试的域启用的？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-08T16:27:14.327

对我来说，VSTestHost 的实例名称往往是一个长字符串，看起来有点类似于 GUID 后跟 PID，所以弄清楚实例名称有点麻烦，但如果你知道 PID（我会得到在一秒钟内），然后可以通过以下方式来完成：

```
PerformanceCounterCategory category = new PerformanceCounterCategory(
    ".NET Data Provider for SqlServer");
string testInstanceName = null;
foreach(string instanceName in category.GetInstanceNames())
{
    if (instanceName.EndsWith(string.Format("[{0}]", pid)))
    {
        testInstanceName = instanceName;
        break;
    }
}

if(testInstanceName != null)
{
    PerformanceCounter counter = new PerformanceCounter(
        category.CategoryName,
        "Number of Active Connections",
        testInstanceName,
        true);
} 
```

由于在单元测试期间调用 GetEntryAssembly() 返回 null，因此获取 VSTestHost.exe 的 PID 也是一种痛苦。但是，您应该能够按照以下方式做一些事情：

```
Process[] testProcesses = Process.GetProcessesByName("VSTestHost");
if (testProcesses.Length == 1)
{
    pid = testProcesses[0].Id;
} 
```

# c# - Fluent NHibernate, joined-subclass mapping

> ID：318087
> 
> 赞同：8
> 
> 时间：2008-11-25T16:54:07.557
> 
> 标签：c#, .net, nhibernate, fluent-nhibernate, orm

I'm trying to map a joined-subclass scenario using Fluent NHibernate. I have a class Entity defined in the namespace Core, and a class SubClass : Entity in the namespace SomeModule

Now I obviously don't want class Entity to know about its derived types, the SomeModules namespace references Core - not the other way around.

All the examples I've been able to find use something like:

```
public class EntityMap : ClassMap<Entity> {
    public EntityMap() {
        Id(x => x.Id)

        var subClassMap = JoinedSubClass<SubClass>("SubClassId", sub => sub.Map(x => x.Id));

        subClassMap.Map(x => x.SomeProperty)
        ...
    }
} 
```

This simply won't work in my situation - I need something akin to the NHibernate xml mapping:

```
<joined-subclass name="SubClass" extends="Entity, Core" >
<key column="SubClassId" foreign-key="FK_KollegiumEntity"/>
<property name="Name" length="255" not-null="true" />
...
</joined-subclass> 
```

Has anyone achieved this with Fluent NHibernate?

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2010-05-06T15:52:45.117

我认为自从提出这个问题以来API已经改变，但这对我有用：

```
public class SomeSubclassMap : SubclassMap<SomeSubclass> {
    public SomeSubclassMap()
    {
        KeyColumn("SomeKeyColumnID");
        Map(x => x.SomeSubClassProperty);
        ...
    }
} 
```

我相信只有 KeyColumn 与“Baseclassname_id”不同时才需要它

`ClassMap<SomeBaseClass>`注意： SomeSubClass 扩展的基类也应该有一个。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-17T09:18:55.223

抱歉错过了你的评论，找到了这个

```
public class SubClassMap : JoinedSubClassPart< SubClass >
{
    public SubClassMap()
        : base("SubClassId")
    {
         Map(x => x.Name); 
         Map(x => x.SomeProperty); 
    }
} 
```

如果您还没有解决它，希望它会有所帮助。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-06T18:19:27.570

马格努斯（或普瑞斯），

您是否知道如何在父映射类中使用最后一个示例？这对我有用，但我不喜欢自己实例化 SubClassMap：

```
public class EntityMap : ClassMap<Entity> {
 public EntityMap() {
    Id(x => x.Id)
    AddPart(new SubClassMap()); // Adds the subclass mapping!
 }
}

public class SubClassMap : JoinedSubClassPart<SubClass>
{
    public SubClassMap()
        : base("SubClassId")
    {
         Map(x => x.Name); 
         Map(x => x.SomeProperty); 
    }
} 
```

这产生了一个类似于以下内容的查询：

```
SELECT
  this_.Id as Id2_2
  this_.Name as Name3_2
  this_.SomeProperty as SomeProperty3_2
FROM
  SubClass this_ inner join
    Entity this_1 on this_.Id=this_1.Id 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-05T15:12:52.517

Magnus，我遇到了完全相同类型的问题，您的建议对其进行了排序。

JoinedSubClass 的第二个参数对您的 SubT 类型的对象执行 SubClassPart 操作。因此，您只需要在子类对象上映射其他字段。

前面的例子是映射一个Id，所以我猜这是一个与基类和子类连接的值不同的id，否则你会开始看到SqlParameterCollection 错误正在发生。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-27T15:29:56.837

你好几天前做了类似的事情。

```
public class EntityMap : ClassMap<Entity> {
 public EntityMap() {
    Id(x => x.Id)

    JoinedSubClass<SubClass>("SubClassId", sub => { 
          sub.Map(x => x.Name); 
          sub.Map(x => x.SomeProperty); 
    });
 }
} 
```

希望能帮助到你

# perl - 如何在 Perl 的哈希引用中引用标量？

> ID：318090
> 
> 赞同：0
> 
> 时间：2008-11-25T16:54:24.827
> 
> 标签：perl, syntax, dbi, template-toolkit

简单的问题：

我如何在一行上做到这一点：

```
my $foo = $bar->{baz};
fizz(\$foo); 
```

我已经尝试过 \$bar->{baz}、\${$bar->{baz}} 和许多其他的。这甚至可能吗？

-fREW

**更新**：好的，hashref 来自 DBI，我将标量 ref 传递到模板工具包中。我想现在我更仔细地观察这个问题与 TT 如何完成所有这些有关。实际上我想说：

```
$template->process(\$row->{body}, $data); 
```

但是 TT 不是这样工作的，TT 需要一个标量 ref 并将数据放在那里，所以我必须这样做：

```
$template->process(\$row->{body}, $shopdata, \$row->{data}); 
```

无论如何，感谢您的帮助。我至少只有一个参考而不是两个。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-25T17:15:34.767

```
\$bar->{baz} 
```

应该管用。

例如：

```
my $foo;
$foo->{bar} = 123;

my $bar = \$foo->{bar};

$$bar = 456;

print "$foo->{bar}\n";   # prints "456" 
```

为了回答 OP 中的更新，您可以执行以下操作：

```
\@$row{qw(body data)}; 
```

这与 \@array 不同，后者会创建一个对数组的引用。以上将分发参考并列出两个参考。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-25T17:16:07.543

\$bar->{baz} 似乎对我有用：

```
my $bar = { baz => 1 };
print $bar->{baz}, "\n";  # prints 1
my $ref =  \$bar->{baz};
print $$ref, "\n";        # prints 1
$$ref = 2;
print $bar->{baz}, "\n";  # prints 2 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-25T17:14:58.840

你没有显示 %bar 和 fizz() 是如何设置的，所以我这样设置它们：

```
my %hash;
my $bar = \%hash;
$hash{baz} = "found it\n";
sub fizz {
  my $ref = shift;
  print $$ref;
} 
```

然后，这两个工作，你的原件：

```
my $foo = $bar->{baz};
fizz(\$foo); 
```

以及您说您尝试过的一种变体：

```
fizz(\$bar->{baz}); 
```

你能显示给你的错误吗？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-25T17:10:47.413

我什至不确定你在做什么。您还应该在 baz 周围加上引号。

现在让我们考虑您为第一行中的标量分配了一个标量，那么第二行应该可以工作。但是我真的不知道这是否是您在这里尝试的，并且在 Perl 中并没有真正意义。使用引用通常在其他语言中用于

1.  加快函数调用
2.  允许返回多个值。

现在，标量通常不需要第一个，而且无论如何 Perl 是一种脚本语言，所以如果您真的关心速度，请编写 C。

Perl 中不需要第二个，因为您可以很容易地返回列表和对匿名哈希的引用。

你看过“man perlref”吗？

# .net - .net 应用程序中的奇怪错误。- RijndaelManaged

> ID：318095
> 
> 赞同：0
> 
> 时间：2008-11-25T16:55:06.120
> 
> 标签：.net, asp.net, viewstate, rijndaelmanaged, rijndael

在最近的负载测试中，我遇到了一些奇怪的“索引超出范围异常”

堆栈跟踪：

```
 at System.Security.Cryptography.RijndaelManagedTransform.DecryptData(Byte[] inputBuffer, Int32 inputOffset, Int32 inputCount, Byte[]& outputBuffer, Int32 outputOffset, PaddingMode paddingMode, Boolean fLast)
   at System.Security.Cryptography.RijndaelManagedTransform.TransformFinalBlock(Byte[] inputBuffer, Int32 inputOffset, Int32 inputCount)
   at System.Security.Cryptography.CryptoStream.FlushFinalBlock()
   at System.Web.Configuration.MachineKeySection.EncryptOrDecryptData(Boolean fEncrypt, Byte[] buf, Byte[] modifier, Int32 start, Int32 length, Boolean useValidationSymAlgo)
   at System.Web.UI.Page.DecryptString(String s)
   at System.Web.UI.Page.ProcessRequestMain(Boolean includeStagesBeforeAsyncPoint, Boolean includeStagesAfterAsyncPoint) 
```

我们没有使用农场或集群，我也没有在应用程序中使用任何密码学。

这似乎发生在幕后的 .Net 类中。

我认为这与视图状态有关，但我不知道为什么会抛出这个。

有任何想法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-04T02:32:59.853

如果有人发起一个帖子，应用程序开始发送带有所有 500KB 视图状态的帖子。在回发的中途，用户感到无聊并点击了其他内容。浏览器仅使用部分视图状态切断回发。服务器抛出一个错误，说视图状态是 borked。我猜这是一个启用了视图状态加密功能的 2.0 应用程序。解决方案是更积极地管理视图状态大小。

当恶意用户制作自定义回发响应时，更有可能发生事件验证异常，因此我认为这里不涉及事件验证。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-25T17:14:25.410

只是猜测：您是否在网站上禁用了 EventValidation？听起来有些东西正在尝试创建手动回发或以其他方式将数据直接插入到 http 请求的发布数据中，并且没有计算出 viewstate 字段的正确值。这反过来又导致解密失败。

启用 EventValidation 后，即使他们正确计算了所有内容，您也会收到异常，但至少这是一个有意义的异常。

# c# - 如何在 C# 中对通用列表进行排序并允许 NULL 项出现在列表中的第一位？

> ID：318096
> 
> 赞同：3
> 
> 时间：2008-11-25T16:55:43.560
> 
> 标签：c#, generics, comparison

我在 C# 中有一个通用的对象列表，例如，这就是对象可能是什么。

```
public class Thing {
    public string Name { get; set; }
    public DateTime EditDate { get; set; }
}

var things = new List<Thing>(); 
```

现在我想打电话：

```
thing.Sort((t1, t2) => t1.EditDate.CompareTo(t2.EditDate)); 
```

但是，我的一些 EditDate 属性为空。我希望这些具有 null EditDate 属性的对象显示在我的列表顶部（即更接近零索引）。我怎样才能做到这一点？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-11-25T17:05:51.603

您可以创建一个更复杂的 lambda，例如：

```
things.Sort((t1, t2) => 
{
 if (t1 == null)
 {
   return (t2 == null) ? 0 : -1;
 }
 if (t2 == null)
 {
   return 1;
 }
 return t1.EditDate.CompareTo(t2.EditDate);
}); 
```

`EndDate`不能`null`，因为它是一种值类型。`EndDate`但是，如果你有一个你认为的特定值`null`，你可以修改上面的代码，以类似于我如何处理`t1`或`t2`存在的方式将其考虑在内`null`。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-25T17:07:53.223

让 Thing 实现 IComparable 以使具有 null editDates 的事物的顺序高于具有编辑日期的事物。然后修改排序表达式以对对象而不是编辑日期进行排序。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-25T17:02:12.877

List 有一个接受委托的[排序函数](http://msdn.microsoft.com/en-us/library/w56d4y5z.aspx)。

现在我已经阅读了这个问题

```
TheList.Sort(int delegate(Type a, Type b)
{
    if (a.memeber == null) return -1;
    if (b.memeber == null) return 1;
    if (a.memeber<b.memeber) return -1;
    if (b.memeber<a.memeber) return 1;
    return 0;
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-25T17:14:03.663

ffpf 的答案应该有效。

但是，如果您有时间阅读这篇关于 BCL 团队的空值排序的精彩文章

[http://blogs.msdn.com/bclteam/archive/2008/10/06/the-compare-contract-kim-hamilton.aspx](http://blogs.msdn.com/bclteam/archive/2008/10/06/the-compare-contract-kim-hamilton.aspx)

# editor - 在哪里可以找到 Nassi-Shneiderman 图表编辑器？

> ID：318097
> 
> 赞同：3
> 
> 时间：2008-11-25T16:56:53.730
> 
> 标签：editor, diagram

我必须为大学做一些工作，我的教授喜欢用 Nassi-Shneiderman 图来折磨我们。

有没有人有一个好的编辑器/图形工具来绘制这些？要求：

*   跨平台（或能够在 wine 中运行）
*   开源（或至少免费供私人使用）

--

在考虑了一些编辑器之后，我最终使用了[http://structorizer.fisch.lu/中的 Strutorizer](http://structorizer.fisch.lu/)

它没有最好的可用性，但它已经足够好了。它是用 Java 编写的。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-02T15:46:07.817

在考虑了一些编辑器之后，我最终使用了[http://structorizer.fisch.lu/中的 Strutorizer](http://structorizer.fisch.lu/)

它没有最好的可用性，但它已经足够好了。它是用 Java 编写的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-25T17:01:26.137

[您可以下载SmartDraw](http://www.smartdraw.com/downloads/index.htm)的免费试用版，它可以编辑 Nassi-Schneiderman 图，或者有免费的[Nassi-Shneiderman Diagram-Editor](http://diuf.unifr.ch/softeng/student-projects/completed/kalt/NSD.html)。

编辑：[如何使用 SmartDraw 绘制 Nassi-Shneiderman 图](http://www.smartdraw.com/tutorials/software/nassi/tutorial_01.htm)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-25T17:02:06.840

那这个呢？[NSD-Editor](http://diuf.unifr.ch/drupal/softeng/teaching/studentprojects/kalt)看起来是免费且独立于平台的！

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2010-02-15T08:55:34.407

你试过'Nessi'吗？

[http://eii.ucv.cl/nessi/](http://eii.ucv.cl/nessi/)

# asp.net-mvc - MVC route localization

> ID：318103
> 
> 赞同：4
> 
> 时间：2008-11-25T17:00:06.703
> 
> 标签：asp.net-mvc, asp.net-mvc-routing

While playing around with localization using [Matt Hawley's](http://blog.eworldui.net/post/2008/10/ASPNET-MVC-Simplified-Localization-via-ViewEngines.aspx) approach. I wonder if someone has figured to localize routes. I can do this using global resources per site. But when I would try to make it a users choice (so users can switch between languages) the architecture does not allow it because the routes are mapped at application startup and not at session level. Do I have to provision a site per language? What am I missing?

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-15T23:32:08.090

不确定这是否是您要问的，但在这个[问题](https://stackoverflow.com/questions/82380/best-way-to-handle-urls-in-a-multilingual-site-in-asp-net)中，我提出了一个使用 asp.net 路由（与 MVC 中使用的相同）来处理路由和语言的解决方案。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-30T06:48:35.670

您无需为每种语言创建一个站点。

我会尝试做的是使用默认控制器来捕获所有请求。然后将控制器名称 + 操作翻译成基本语言，然后适当地重定向路由。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-27T19:58:44.400

也许这也是对这个话题的帮助

[http://haacked.com/archive/0001/01/01/internationalized-urls.aspx](http://haacked.com/archive/0001/01/01/internationalized-urls.aspx)

# internationalization - Application internationalization/translation experience using crowd-sourcing? Mechanical Turk?

> ID：318109
> 
> 赞同：3
> 
> 时间：2008-11-25T17:01:59.257
> 
> 标签：internationalization, translation, mechanicalturk, crowdsourcing

I have developed a web application using internationalization best practices such as putting all my displayable strings in property files, etc, etc.

I would like to have the strings in the property files translated into 5 different languages.

Does anyone have any experience using Mechanical Turk or another crowd sourcing service for language translation?

The reason I don't want to just hire a translation company or service is because I want to eventually have ongoing content fed into the translation service via an API.

My Google results for more information on this topic were surprisingly dismal. Any links or pointers are appreciated.

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-07T19:54:40.283

如果您的软件是开源的，您可以使用[Launchpad](http://launchpad.net)进行翻译。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-13T13:10:25.120

我没有任何众包翻译的经验，但我的建议是找到一些可靠的目标语言自由译者（查看 Proz.com），并在每次有新内容时继续找他们。众所周知，由于资源文件中缺乏上下文，应用程序 UI 难以本地化，因此您需要了解应用程序并能够/愿意测试本地化版本的人。每个本地化无疑也会揭示 i18n 错误，因此第一次可能会有一些来回。我想我的意思是你不希望与你的翻译人员保持一定距离。他们应该感觉像是您团队的延伸。

无论如何，为您的应用程序国际化而喝彩。祝你好运！

# apache-flex - 如何从 Flex 的列表控件中删除/清除项目？

> ID：318113
> 
> 赞同：3
> 
> 时间：2008-11-25T17:02:34.437
> 
> 标签：apache-flex, actionscript-3

我在 Flex 中有一个列表控件，该控件已将数据绑定到来自 HTTPService 的 e4x xml 对象。

我现在想要一个清除列表的按钮，我该怎么做？

我试过了：

```
 list.dataProvider = null; 

```

这似乎不起作用，我也尝试过：

```
 list.dataProvider = {}; 

```

这会清除项目，但将 [object,object] 作为列表中的第一项......

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-25T17:19:28.223

也许...

```
list.dataProvider = new Array(); 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2011-11-01T19:25:03.860

将 设置`dataProvider`为新`Array`对象将引发错误：

> 将 Array 类型的值隐式强制转换为不相关的类型 fl.data:DataProvider。

相反，您应该使用`removeAll()`DataProvider 提供的方法：

```
list.dataProvider.removeAll(); 
```

这会触发 DataProvider 中的 REMOVE_ALL 事件，进而更新您的列表。

# algorithm - 功能替代品？

> ID：318128
> 
> 赞同：2
> 
> 时间：2008-11-25T17:07:58.247
> 
> 标签：algorithm, language-agnostic, functional-programming, loops

当我继续学习函数式编程时，我开始怀疑是否有替代我默认的“过程”思维方式的替代方案。更具体地说，我正在查看我编写的函数。这是它的作用：

```
Swap two elements of an unordered list of numbers, such that one of the elements  
 is now in the right place
Add the sum of the swapped values to an accumulated total   
Repeat until list is sorted 
```

所以，现在我正在使用带有 accum 变量的标准循环*来执行上述操作。它工作得很好，而且在现实生活中迭代肯定没有错，但是由于这个练习的目的是扩展我的思维方式，我很好奇上述算法是否有更实用的方法。

谢谢！

*（实际上是递归，但无论如何）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-25T18:17:17.077

递归基本上是一种函数式编程机制。我想你可以用一个接收列表并返回一个列表的函数替换你的交换函数或类似的愚蠢的东西，但这将是一个坏主意，除非用一种实际功能强大的语言编写。

尝试在 Oz、SML、Prolog 或 Lisp 中实现归并排序。例如像这样的用于合并的伪代码：

```
Merge(A,[])=A
Merge(H|T,H2|T2)=iif(H<H2,H|Merge(T,H2|T2),H2|Merge(H|T,T2) 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-25T18:21:47.053

> 从[EigenClass](http://eigenclass.org/hiki/fp-ocaml-koans)：
> 
> > 可敬的大师勒罗瓦和他的学生一起散步。徒弟想和师父谈一谈，说：“师父，我听说所有的循环都必须用尾递归函数代替，是真的吗？” Leroy 同情地看着他的学生，回答说：“愚蠢的学生，许多尾递归函数只是效率低下的循环。”
> > 
> > 在接下来的几周里，这位学生用显式循环替换了尾递归函数。他终于向 Leroy 大师展示了他的代码，寻求他的认可。勒罗伊用棍子打他。“你什么时候学会？显式循环是穷人的尾递归函数。” 那一刻，学生顿悟了。

*编辑：参考 OCaml 的主要开发人员 Xavier Leroy*

由于我*看不到*您的功能以了解它的功能*，因此我不知道。但看起来你正在做的事情是正确的。我的主要建议是研究适合函数式编程的数据结构——但您使用的是列表，所以在这种情况下，列表并不是最好的数据结构。以及算法。如果您对使用插入排序一无所知，那么您可能无法使用归并排序或其他更有效的方法。

# javascript - 滚动到结束的Javascript

> ID：318129
> 
> 赞同：3
> 
> 时间：2008-11-25T17:08:09.870
> 
> 标签：javascript

有时，软件安装程序会强制您在启用“我同意”框之前滚动到 EULA 的末尾。如何在网页上产生相同的效果？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-25T17:08:27.263

```
<html>
    <head>
        <script type="text/javascript">
            function setupPage() {
                var agreement = document.getElementById("agreetext");
                var visibleHeight = agreement.clientHeight;
                var scrollableHeight = agreement.scrollHeight;
                if (scrollableHeight > visibleHeight) {
                    var checkbox = document.getElementById("agreebox");
                    checkbox.checked=false;
                    checkbox.disabled=true;
                    agreement.onscroll = handleScroll;
                }
            }

            function handleScroll() {
                var agreement = document.getElementById("agreetext");
                var visibleHeight = agreement.clientHeight;
                var scrollableHeight = agreement.scrollHeight;
                var position = agreement.scrollTop;
                if (position + visibleHeight == scrollableHeight) {
                    document.getElementById("agreebox").disabled=false;
                }
            }
        </script>
    </head>
    <body>
        <form>
            <textarea id="agreetext" rows="8" cols="40">Long agreement</textarea>
            <br/><br/>
            <input type="checkbox" id="agreebox" value="true"/> <label id="agreelabel" for="agreebox">I agree</label>
            <br/><br/>
            <input type="submit" value="Continue"/>
        </form>
        <script type="text/javascript">
            // We put this at the end of the page rather than in an document.onload
            // because the document.onload event doesn't fire until all images have loaded.
            setupPage();
        </script>
    </body>
</html> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-03-08T15:29:38.600

非常棒的一段代码，如果你也想改变复选框旁边标签的颜色，只需修改代码如下：

```
function setupPage() {
    var agreement = document.getElementById("agreetext");
    var visibleHeight = agreement.clientHeight;
    var scrollableHeight = agreement.scrollHeight;
    if (scrollableHeight > visibleHeight) {
        var checkbox = document.getElementById("agreebox");
        checkbox.checked=false;
        checkbox.disabled=true;
        document.getElementById("agreelabel").style.color = "#777";
        agreement.onscroll = handleScroll;
    }
}

function handleScroll() {
    var agreement = document.getElementById("agreetext");
    var visibleHeight = agreement.clientHeight;
    var scrollableHeight = agreement.scrollHeight;
    var position = agreement.scrollTop;
    if (position + visibleHeight == scrollableHeight) {
        document.getElementById("agreebox").disabled=false;
        document.getElementById("agreelabel").style.color = "black";
    }
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2015-04-09T04:34:41.930

我使用只读文本区域来显示我的许可协议。请注意，如果许可协议文本的长度不足以使 textarea 显示滚动条，则此代码将不起作用。

```
$(function () {
    var serviceAgreementScrolled = false;
    $('#service-agreement-textarea').scroll(
        function () {
            if (this.scrollTop + $(this).height() + 30 >= this.scrollHeight) {
                serviceAgreementScrolled = true;
            }
        }
    );

    $('#accept-service-agreement-checkbox').change(
        function () {
            if ($(this).is(':checked') && !serviceAgreementScrolled) {
                alert('Please scroll to read the rest of the service agreement.');
                $(this).prop('checked', false);
            }
        }
    );
}); 
```

```
<textarea id="service-agreement-textarea" readonly="readonly">Long long text here</textarea>
<label>
  <input type="checkbox" id="accept-service-agreement-checkbox" />
   I accept the terms of the service agreement
</label> 
```

# ruby - Ruby 中的 include 和 require 有什么区别？

> ID：318144
> 
> 赞同：499
> 
> 时间：2008-11-25T17:12:31.187
> 
> 标签：ruby, include, require

我的问题类似于“ [Ruby 中包含和扩展有什么区别？](https://stackoverflow.com/questions/156362/what-is-the-difference-between-include-and-extend-in-ruby) ”。

Ruby`require`和 和有什么区别？`include`如果我只想在我的课程中使用模块中的方法，我应该使用`require`它还是`include`它？

* * *

## 回答 #1

> 赞同：571
> 
> 时间：2008-11-25T17:19:28.863

> *Ruby 中的“include”和“require”有什么区别？*
> 
> **回答：**
> 
> include 和 require 方法做了非常不同的事情。
> 
> require 方法做了大多数其他编程语言中 include 所做的事情：运行另一个文件。它还会跟踪您过去需要的内容，并且不会两次需要相同的文件。要在没有此附加功能的情况下运行另一个文件，您可以使用 load 方法。
> 
> include 方法从另一个模块中获取所有方法，并将它们包含到当前模块中。这是一个语言级别的东西，而不是文件级别的东西，就像 require 一样。include 方法是使用其他模块“扩展”类的主要方法（通常称为 mix-ins）。例如，如果你的类定义了方法“each”，你可以包含 mixin 模块 Enumerable 并且它可以作为一个集合。这可能会令人困惑，因为包含动词在其他语言中的使用方式非常不同。

[来源](https://web.archive.org/web/20150405161656/http://ruby.about.com/b/2008/10/23/a-quick-peek-at-ruby-include-vs-require.htm)

因此，如果您只想使用一个模块，而不是扩展它或进行混合，那么您将需要使用`require`.

奇怪的是，Ruby's`require`类似于 C's `include`，而 Ruby's`include`几乎与 C's 完全不同`include`。

* * *

## 回答 #2

> 赞同：119
> 
> 时间：2013-01-08T09:38:22.707

如果您使用的是模块，这意味着您将所有方法都带入您的类。如果您`extend`是带有模块的类，则意味着您将模块的方法作为**类**方法“引入”。如果你`include`是一个带有模块的类，这意味着你正在“引入”模块的方法作为**实例**方法。

前任：

```
 module A
   def say
     puts "this is module A"
   end
 end

 class B
   include A
 end

 class C
   extend A
 end 
```

`B.say` => B:Class 的未定义方法“说”

`B.new.say` => 这是模块 A

`C.say` => 这是模块 A

`C.new.say` => C:Class 的未定义方法“说”

* * *

## 回答 #3

> 赞同：100
> 
> 时间：2011-05-21T15:44:07.630

来自元编程 Ruby 书，

> 该`require()`方法与 非常相似`load()`，但用于不同的目的。你`load()`用来执行代码，你 `require()`用来导入库。

* * *

## 回答 #4

> 赞同：62
> 
> 时间：2008-11-25T17:21:27.843

*   Ruby`require`更像是其他语言（例如 C）中的“包含”。它告诉 Ruby 你想***引入另一个文件的内容***。其他语言中的类似机制是：

    *   [`using <namespace>`C# 中的指令](http://msdn.microsoft.com/en-us/library/sf0df423.aspx)。
    *   [`import <package>`在 Java 中](https://stackoverflow.com/questions/12620369/how-java-import-works)。
*   Ruby`include`是一种***用于 mixins 的面向对象的继承机制***。

[这里](http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/16071 "Ruby 需要与包含")有一个很好的解释：

> [The] 简单的答案是 require 和 include 本质上是不相关的。
> 
> **"require"**类似于 C 的 include，可能会导致新手混淆。（一个显着的区别是，当要求完成时，要求文件中的本地人“蒸发”。）
> 
> Ruby**包含**与 C 包含完全不同。include 语句将一个模块“混合”到一个类中。这是***多重继承的一种有限形式***。包含的模块字面上赋予包含它的事物“is-a”关系。

重点补充。

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2014-08-25T01:48:46.360

从*编程 Ruby 1.9*

> 在继续之前，我们将对 include 语句提出几点意见。首先，它与文件无关。C 程序员使用称为#include 的预处理器指令在编译期间将一个文件的内容插入到另一个文件中。Ruby 的 include 语句只是对模块进行引用。如果该模块位于单独的文件中，则必须在使用 include 之前使用 require（或其不太常用的表亲 load）将该文件拖入。其次，Ruby 包含不会简单地将模块的实例方法复制到类中。相反，它从类中引用包含的模块。如果多个类包含该模块，它们都将指向同一事物。如果您更改模块中方法的定义，即使您的程序正在运行，

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2013-06-12T03:29:38.457

你有没有尝试过`require`一个模块？结果如何？你试一试：

```
MyModule = Module.new
require MyModule # see what happens 
```

模块不是必需的，只有包括在内！

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2020-01-12T22:20:52.187

'Load' - 插入文件的内容。（每次调用文件时解析文件）

'Require' - 插入文件解析的内容。（文件解析一次并存储在内存中）

'Include' - 将模块包含到类中，并且可以使用模块内的方法作为类的实例方法

'Extend' - 将模块包含到类中，并且可以将模块内的方法用作类方法

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2014-11-27T10:16:21.447

包含 当您将一个模块包含到您的类中时，如下所示，就好像您将模块中定义的代码插入到您“包含”它的类中一样。它允许“混合”行为。它用于干燥您的代码以避免重复，例如，如果模块中有多个类需要相同的代码。

Load load 方法与 require 方法几乎一样，只是它不跟踪该库是否已加载。因此可以多次加载一个库，并且在使用加载方法时，您必须指定库文件名的“.rb”扩展名。

Require require 方法允许您加载一个库并防止它被多次加载。如果您在第一次之后尝试加载同一个库，require 方法将返回“false”。仅当您正在加载的库在单独的文件中定义时才需要使用 require 方法，通常是这种情况。

您可以更喜欢这个 [http://ionrails.com/2009/09/19/ruby_require-vs-load-vs-include-vs-extend/](http://ionrails.com/2009/09/19/ruby_require-vs-load-vs-include-vs-extend/)

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2017-11-17T19:15:56.920

**包括**

> 当您`include`将模块添加到您的类中时，就好像您将模块中定义的代码插入到类中，并在其中“包含”它。它允许“混合”行为。它用于干燥您的代码以避免重复，例如，如果模块中有多个类需要相同的代码。

```
module Log 
  def class_type
    "This class is of type: #{self.class}"
  end
end

class TestClass 
  include Log 
  # ... 
end

tc = TestClass.new.class_type # -> success
tc = TestClass.class_type # -> error 
```

**要求**

> require 方法允许您加载一个库并防止它被多次加载。如果您在第一次之后尝试加载同一个库，require 方法将返回“false”。仅当您正在加载的库在单独的文件中定义时才需要使用 require 方法，通常是这种情况。

因此它会跟踪该库是否已经加载。您也不需要指定库文件名的“.rb”扩展名。下面是一个如何使用 require 的示例。将 require 方法放在“.rb”文件的最顶部：

**加载**

> load 方法几乎类似于 require 方法，只是它不跟踪该库是否已加载。因此可以多次加载一个库，并且在使用加载方法时，您必须指定库文件名的“.rb”扩展名。

**延长**

> 当使用扩展方法而不是包含时，您将模块的方法添加为类方法而不是实例方法。

```
module Log 
  def class_type
    "This class is of type: #{self.class}"
  end
end

class TestClass 
  extend Log 
  # ... 
end

tc = TestClass.class_type 
```

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2018-02-28T20:54:45.060

以下是require和include之间的一些基本区别：

要求：

1.  Require 从文件系统读取文件，解析它，保存到内存并在给定位置运行它，这意味着如果您在脚本运行时更改任何内容，那么该更改将不会反映。
2.  我们需要文件名，而不是模块名。
3.  它通常用于库和扩展。

包括：

1.  当您将模块包含到您的类中时，它的行为就像您将模块中定义的代码插入到您的类中一样。
2.  我们包括模块名称，而不是文件名。
3.  它通常用于干涸代码并删除代码中的重复项。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2016-01-04T13:36:13.363

```
require(name) 
```

它将返回布尔真/假

作为参数传递给 require 的名称，ruby 将尝试在您的加载路径中找到具有该名称的源文件。如果您在第一次之后尝试加载同一个库，require 方法将返回“false”。仅当您正在加载的库在单独的文件中定义时才需要使用 require 方法。因此它会跟踪该库是否已经加载。

```
include module_name 
```

假设您有一些方法需要在两个不同的类中使用。然后，您不必在两个类中都编写它们。相反，您可以做的是在模块中定义它。然后将此模块包含在其他类中。Ruby 提供它只是为了保证 DRY 原则。它用于干燥您的代码以避免重复

# ant - Looking for example xml to generate a Findbugs report using ANT to analyse multiple jars?

> ID：318145
> 
> 赞同：0
> 
> 时间：2008-11-25T17:12:59.767
> 
> 标签：ant, static-analysis, findbugs

How do I setup an Ant task to generate a Findbugs report when the source folder has many jars in it?

I'm looking for a worked example of the ant task required to output the fancy HTML from a folder containing multiple jars

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-26T11:01:17.580

[FindBugs Ant 目标以生成 XML 格式的报告，然后通过标准](http://findbugs.sourceforge.net/manual/anttask.html)[Ant XSLT 目标](http://ant.apache.org/manual/Tasks/style.html)应用您的 FindBugs 安装附带的一种 XSLT 转换。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-07-21T08:07:12.120

该线程已有 2 年历史，但也许有人会发现它很有用：

你可以轻松做到：

```
<class location="${src.dir}/test.jar" /> 
<class location="${src.dir2}/test2.jar" /> 
```

假设您有 2 个源路径，您应该在之前定义它们：

```
<sourcePath path="first source path" />
<sourcePath path="second source path" /> 
```

# c# - 跟踪和降低 GD 句柄的最佳方法是什么？

> ID：318154
> 
> 赞同：3
> 
> 时间：2008-11-25T17:15:05.813
> 
> 标签：c#, windows, memory, gdi

跟踪和降低 GDI 窗口句柄的最佳方法是什么。.

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-01T02:46:16.927

值得一读的两个链接...

[资源泄漏：检测、定位和修复泄漏的 GDI 代码](http://msdn.microsoft.com/en-us/magazine/cc301756.aspx)

[GDI 资源泄漏](http://www.relisoft.com/win32/GdiLeaks.html)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-25T17:19:04.450

我个人使用[IARSN TaskInfo](http://www.iarsn.com/taskinfo.html)来查看我的程序使用的句柄数，包括 GDI。至于降低活动句柄的数量，那么我会看看你的应用程序中使用的是什么句柄。

像（但不限于）这样的事情：

*   笔
*   位图
*   控件（我不认为它们都使用句柄​​）

您是否有手柄过多或手柄泄漏的特定问题？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-26T01:18:07.493

你不需要任何工具。只需使用 win32 api 阅读 GDI 句柄表

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-17T22:00:59.427

不久前我写了一个工具来追踪资源泄漏。它托管在[谷歌代码](http://code.google.com/p/leaktrap/)上。虽然它是一个本地库，但我相信它也可以用来追踪 .NET 代码中的漏洞。

希望能帮助到你。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-12-08T10:07:30.430

要跟踪 GDI 句柄，我建议[来自 Nirsoft 的 GDIView](http://www.nirsoft.net/utils/gdi_handles.html)。它是一个免费软件，可以显示每种类型（钢笔、画笔、位图、字体、DC ...）有多少个 GDI 句柄有一个进程。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-25T17:19:36.290

查看最终用户机器上当前使用情况的最简单方法是使用任务管理器并查看“GDI 句柄”列

当我怀疑我有 GDI 处理泄漏时，我倾向于运行一次泄漏场景，强制进行垃圾收集，查看任务管理器，使用 gc 再次运行该操作并检查差异。如果我找到了一个，我使用了 .Net Profiler（来自 SciTech），它可以详细显示导致泄漏的对象以及为什么不归还它

# svn - Subversion 合并问题：还不能重新集成

> ID：318155
> 
> 赞同：2
> 
> 时间：2008-11-25T17:15:18.980
> 
> 标签：svn, tortoisesvn, visualsvn

我正在评估 subversion 的分支/合并功能，我决定做一个简单的测试 - 我分支了一个现有项目，更改了一个文件中的注释，然后通过 Tortoise 进行了合并重新集成。

它失败了：

> 命令：将[https://oscar/svn/Baxtech/ViM/Branches/Test3](https://oscar/svn/Baxtech/ViM/Branches/Test3)重新集成到 C:\Inntec\VS2008\Baxtech\ViM
> 错误：无法从“ [https://oscar/svn/Baxtech/ViM/Branches/ 重新集成” Test3](https://oscar/svn/Baxtech/ViM/Branches/Test3) ' yet:
> Error: 一些没有被合并的修订已经被合并到它下面
> Error: into the reintegration target; 先合并它们，然后重试。

我用谷歌搜索了这个，我发现一些帖子说这与旧版本的 Tortoise 中的重命名和目录更改创建的合并信息有关。

我最近确实从以前的 Tortoise 版本升级到了 1.5.5，但是这个问题似乎是 1.5 之前的问题。*...**而且我只更改了一个文件中的一些注释。我没有进行任何重命名或目录结构更改。**

再说一次，我们一直在使用主干一段时间（没有任何分支），所以问题可能存在于那里？

因此，如果有解决此问题的方法，我将非常感谢您的帮助。另外，虽然 - 这是典型的吗？这真的是一个*非常*简单的测试，遗憾的是现在我有点害怕使用 Subversion 进行分支。

颠覆：1.5.4（通过 VisualSVN 服务器）
乌龟：1.5.5

我们还使用 Visual Studio 2008。

谢谢！

布赖恩

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-25T22:13:27.630

这也发生在我前一段时间。

我不记得我究竟做了什么来触发这个问题，但我可以说我也在使用 1.5 之前的版本，然后切换到 1.5.0。

Subversion 使用每个目录的 svn:mergeinfo 属性跟踪合并。这个属性应该只出现在工作副本的根路径上（如果我错了，请纠正我）。当我看到这个错误时，我注意到 1.5 之前的版本在工作副本内的文件上创建了明确的合并信息，这阻止了稳定版本的正常工作。正如您在[上次回复](https://stackoverflow.com/questions/318155/subversion-merge-problem-cannot-reintegrate-yet#318860)中所说，删除那些额外的合并信息条目也为我解决了这个问题。

我的建议是尝试使用没有来自 beta 版本的提交的新存储库，看看是否会再次发生这种情况。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-12-11T08:24:14.117

问题（通常情况下）是当合并源有一些子树合并信息时，svn 1.5 会发出特定的错误消息。正如您正确指出的那样，对此的补救措施是删除任何子树合并信息。详细的权威答案见：http: [//blogs.collab.net/subversion/2008/07/subversion-merg/](http://blogs.collab.net/subversion/2008/07/subversion-merg/)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-25T21:04:59.237

这个问题与 MergeInfo 有关。我不太确定问题出在哪里，但我想我清除了 MergeInfo，现在一切都很好。

我需要更多地了解为什么我的 MergeInfo 有问题以及它实际上做了什么。非常令人沮丧！

**编辑：**自从我们现在升级以来已经过去了一段时间，我再也没有遇到这个问题。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-25T17:19:12.203

我发现从命令行合并要容易得多。

```
svn merge -r N:M SOURCE [PATH] 
```

N 是您创建分支的修订版，M 是您想要包含更改的修订版（或 HEAD 为当前）。源是分支路径。如果您在目标工作目录中执行此操作，则不需要最后一个参数。

一个例子：

```
//sitting in main trunk
svn merge -r 55:HEAD svn://my.repo.url/branches/my_branch 
```

这会将分支中从 55 开始的所有更改合并到主干。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-25T18:57:08.027

想不出任何原因，我从未见过这个错误，我大量使用分支/合并。我会检查几件事：

*   您从主干工作副本开始合并（右键单击-> SVN-> 合并）？
*   如果你说测试合并会发生什么？
*   检查忽略祖先怎么样？
*   确保您的合并深度是“工作副本”

顺便说一句，您的存储库是什么版本的 SVN？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-25T20:34:47.893

我用svn很久了，从来没有见过这个；授予我没有使用乌龟那么多。需要考虑的几点：

1.  日志显示您尝试合并`../ViM/branches/..`到`../ViM/`. 你没有`../ViM/trunk/`或者日志只是打印出有趣的东西？我想尝试将分支合并到代码库以外的东西会搞砸。

2.  在创建分支之后但在重新集成它之前，您是否对主干进行了任何更改？如果是这样，请确保在尝试将其合并回主干之前将这些更改合并到分支中。

3.  在您的分支和主干上运行`svn cleanup`，以确保清理所有未完成的业务。

4.  我不确定这会导致任何问题，但您的主干工作副本可能需要更新，然后才能重新集成更改。

# nhibernate - 使用 Criteria API 从 NHibernate 获取不同的结果集？

> ID：318157
> 
> 赞同：30
> 
> 时间：2008-11-25T17:15:45.143
> 
> 标签：nhibernate

我正在尝试使用 NHibernate 中的 Criteria API 获得不同的结果。我知道使用 HQL 可以做到这一点，但我更喜欢使用 Criteria API 来执行此操作，因为我的应用程序的其余部分仅使用此方法编写。我[找到了这个论坛帖子](http://forum.hibernate.org/viewtopic.php?t=941669,)，但无法让它工作。标准 API 有没有办法获得不同的结果集？

编辑：在这样做时，我还想排除主键列，这也是一个身份，并获得剩余的不同记录。有没有办法做到这一点？事实上，不同的记录返回重复项，因为每行的主键都是唯一的，但所有其他字段都是相同的。

* * *

## 回答 #1

> 赞同：91
> 
> 时间：2008-12-21T22:33:17.873

要执行不同的查询，您可以将条件上的投影设置为 Projections.Distinct。然后，您包括您希望返回的列。然后通过将结果转换器设置为 AliasToBeanResultTransformer 将结果转换回强类型对象 - 传入结果应转换为的类型。在此示例中，我使用与实体本身相同的类型，但您可以专门为此查询创建另一个类。

```
ICriteria criteria = session.CreateCriteria(typeof(Person));
criteria.SetProjection(
    Projections.Distinct(Projections.ProjectionList()
        .Add(Projections.Alias(Projections.Property("FirstName"), "FirstName"))
        .Add(Projections.Alias(Projections.Property("LastName"), "LastName"))));

criteria.SetResultTransformer(
    new NHibernate.Transform.AliasToBeanResultTransformer(typeof(Person)));

IList<Person> people = criteria.List<Person>(); 
```

这将创建类似于（至少在 SQL Server 中）的 SQL：

```
SELECT DISTINCT FirstName, LastName from Person 
```

请注意，只有您在投影中指定的属性才会填充到结果中。

这种方法的优点是过滤是在数据库中执行的，而不是将所有结果返回到您的应用程序然后进行过滤——这是 DistinctRootEntityTransformer 的行为。

* * *

## 回答 #2

> 赞同：25
> 
> 时间：2008-11-25T17:25:36.683

目前看不到论坛帖子（链接断开？），所以也许这不是答案，但您可以添加 DistinctRootEntityResultTransformer：

```
session.CreateCriteria(typeof(Product)
    .Add(...)
    .SetResultTransformer(new DistinctEntityRootTransformer()) 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-04-27T02:03:26.963

对于它的价值，[NHibernate: Optimizing Queries with Projections](http://colinramsay.co.uk/nhibernate/2008/01/15/nhibernate-optimising-queries-with-projections.html)基本上帮助我解决了同样的问题。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2020-04-15T12:52:06.133

更简单更好。如果您想使用 DISTINCT 获得整个实体，您可以使用 Projections.Entity

```
Criteria.SetProjection(
Projections.Distinct(Projections.Entity(typeof(YourEntityHere), "this"))); 
```

“this”表示根实体。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2014-11-11T23:19:35.753

我们正在使用最现代、最强大、最微小的方式来处理这个问题……只有当你准备好迎接令人敬畏的事情时，请继续阅读……而且它与标准无关……

```
CurrentSession()
    .QueryOver<GoodBadAndUgly>
    .Where(...)
    .TransformUsing(Transformers.DistinctRootEntity) 
```

因此，如果您来到这里希望找到一种方法来避免与 Criteria 混淆，即使您完全必须朝着那个方向前进，只是为了在您的 SQL 中添加“DISTINCT”......不要再搜索了

* * *

## 回答 #6

> 赞同：-4
> 
> 时间：2009-07-06T20:08:45.120

我还遇到了项目数量不明确的问题（我在映射文件中使用了 fetch="join" ）。我使用Linq To Nhibernate解决了这个问题，使用方式如下：

```
 var suppliers = (from supplier in session.Linq<Supplier>()
                        from product in supplier.Products
                        where product.Category.Name == produtCategoryName
                        select supplier).ToList().Distinct(); 
```

# javascript - 如何在 IE 中设置对象的边距？

> ID：318158
> 
> 赞同：26
> 
> 时间：2008-11-25T17:15:55.687
> 
> 标签：javascript, css, internet-explorer

我正在尝试从 JavaScript 设置对象的边距。我可以在 Opera 和 Firefox 中执行此操作，但代码在 Internet Explorer 中不起作用。

这是我拥有的 JavaScript：

```
function SetTopMargin (ObjectID, Value)
{
    document.getElementById(ObjectID).style.marginTop =  Value.toString() + "px";
} 
```

它是这样调用的：

```
SetTopMargin("test_div_id", 100); 
```

那么有人知道一些可以在 Internet Explorer 中运行的代码吗？

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2008-11-25T17:20:13.417

[2016 年更新] 在所有当前浏览器（包括 IE8+）上，您的代码

```
document.getElementById(ObjectId).style.marginTop = Value.ToString() + 'px'; 
```

工作正常。

在*非常旧的*IE (< 8) 版本上，您必须改用这个非标准装置：

```
document.getElementById(ObjectId).style.setAttribute(
   'marginTop', Value.ToString() + 'px'); 
```

**编辑**- 来自 OP 删除的评论：

> 请注意，虽然您可以在当前 IE 中使用 style.setAttribute('margin-top', ..)，但 8 和更早版本需要 style.setAttribute('marginTop', ..)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-25T17:27:14.573

您的代码适用于我的 IE8。

```
<html>
  <head>
    <script type="text/javascript"> 
    function SetTopMargin (ObjectID, Value)
    {   
      document.getElementById(ObjectID).style.marginTop =  Value.toString() + "px";
    }
    </script>
 </head>
 <body>
   <button id="btnTest" onclick="SetTopMargin('btnTest', 100);">Test</button>
 </body>
</html> 
```

在 IE6 中，它似乎在很短的暂停后也能正常工作。

* * *

## 回答 #3

> 赞同：-3
> 
> 时间：2008-11-25T17:20:36.787

首先，您应该真正使用 jQuery 或 Dojo 之类的 javascript 库。我还推荐 www.debugbar.com 来检查 IE 的 DOM。

关于你的问题，`elem.style = "margin: 10px"`应该在 IE 中工作。

希望这可以帮助！

# .net - .NET WinForms 键事件参数对象上的 KeyCode 和 KeyData 属性有什么区别？

> ID：318160
> 
> 赞同：48
> 
> 时间：2008-11-25T17:17:28.803
> 
> 标签：.net, winforms, events, event-handling

两个键事件参数类`KeyEventArgs`和`PreviewKeyDownEventArgs`都有两个属性，`KeyCode`和`KeyData`，它们都是枚举类型 Keys。

这两个属性有什么区别？它们中的值是否彼此不同？如果是这样，何时以及为什么？

* * *

## 回答 #1

> 赞同：56
> 
> 时间：2008-11-25T17:20:38.503

`KeyCode`是一个枚举，代表键盘上所有可能的键。 `KeyData`是`KeyCode`与修饰符（Ctrl、Alt 和/或 Shift）的组合。

`KeyCode`当你不关心修饰符时使用，当你关心`KeyData`时。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-11-25T17:22:56.827

我观察到的不同之处在于，in 中的值`KeyCode`仅包含`Keys`触发当前事件触发的键的枚举值。 `KeyData`另一方面，将包含值`KeyCode`与当时保留的任何修改键（CTRL、SHIFT、ALT 等）的逻辑 OR。

# javascript - 在 JavaScript 中管理昂贵的滚动的最佳方法是什么？

> ID：318161
> 
> 赞同：3
> 
> 时间：2008-11-25T17:17:54.373
> 
> 标签：javascript, scroll

我们的主 UI 上有一个 UI 小部件，它使用 JavaScript 来响应来自浏览器的滚动事件。每个滚动事件的响应都是相对昂贵的。用户可以轻松地将大量滚动事件“排队”，而前几个正在处理并在小部件中呈现。

这样做的问题是，小部件最终进入“滚动处理炼狱”，每个增量中间滚动事件都被处理和呈现。

例如：用户从 ab 滚动，然后是 bc，然后是 de，然后是 ef，依此类推。到用户触发 yz 事件时，滚动事件处理可能仍在渲染 bc 滚动。

相反，我们想做的是对这些事件进行更智能的管理。如果我们可以渲染滚动事件的结果，然后“赶上”用户所在的位置，并跳过任何现在已经过时的中间滚动，那就太好了。

最好的方法是什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-25T17:48:58.100

您可能已经在做类似的事情，但我会使用一个计时器来判断用户是否仍在积极滚动。

类似于这样的东西：

```
// need to have this variable outside the scope of the handler defined below
var timeoutId = null;

// think of "connect" as pseudocode for whatever you use to connect handlers
connect(widget, "onscroll", function() {
    // ...scrolling...
    if(timeoutId != null) clearTimeout(timeoutId);
    timeoutId = setTimeout(function() {
        // *probably* done scrolling, it has been  
        // 1 second since the last scroll...  
        // run your code to render current position here  
    }, 1000);
}); 
```

# visual-studio - UAC/VS/W2K8：当我在管理员组中时，为什么 VS 不能以管理员权限启动？

> ID：318163
> 
> 赞同：-1
> 
> 时间：2008-11-25T17:18:37.320
> 
> 标签：visual-studio, visual-studio-2008, uac

带有 SP1 的 Server 2008 机器，带有 SP1 的 Visual Studio 2008。我的用户；开发人员，在本地管理员组中。也就是说，我在 Visual Studio 中执行的一些操作（使用 Web 应用程序的属性窗口来调用在本地 IIS 中创建虚拟目录）告诉我需要管理员权限。这比什么都烦，我可以通过右键单击（以管理员身份运行）启动 VS 来执行操作 - 但我很好奇是否有人知道为什么会发生这种情况？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-25T21:27:59.343

这不是它在带有 UAC 的 Vista 上的工作方式。您的用户在 admin 组中意味着该用户可以执行管理任务。假设您有一个普通用户，并且该用户已登录并尝试执行管理任务。该用户将无法执行此类任务，因为它不在管理员组中。他需要提供管理员的用户名/密码才能执行此类任务。但是，如果您的用户是管理员，您将被授予执行任务的访问权限。

您所说的基本上是 Windows XP 的工作原理，我们都知道所有安全问题的结果。在 XP 上，您是具有管理员权限的管理员，您可以在系统中做任何您想做的事情。这不是很安全。在 Vista 中，您在管理员组中，但这并不意味着每个任务都应该/将以管理员权限运行。您是管理员，您可以在系统中更改您想要的任何内容，但默认情况下，事情将以尽可能少的管理员权限运行，以防止任何安全问题。您需要管理员权限，以管理员权限运行应用程序。

这就是它的工作方式以及它应该如何工作。

反正我就是这么看的：）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-25T17:31:01.227

因为这就是它的工作原理，我猜......你的用户所在的组并不重要，重要的是应用程序是否以管理员权限运行。如果是，那么您将能够执行管理操作，否则您将无法执行。

所有使用 UAC 执行管理员操作的应用程序（当您看到安全徽章时）它们将 a) 以管理员权限重新启动应用程序或 b) 启动具有管理员权限的进程以执行相应的操作。如果不与他们一起启动进程，他们将永远无法授予您管理员权限。

这就是它真正的工作方式。据我所知，这就是它的工作原理......

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-25T17:56:43.093

Nazgulled：您的第一个陈述将表明进程在安全上下文中启动，而不是它们从当前用户继承的安全上下文。我的好奇心源于这种基本的理解，即一个进程使用我的令牌运行。如果我的用户在管理员组中，那么它不会以管理员权限运行吗？也许我对此的基本理解是错误的——用户权限/安全和进程安全上下文可能不像我理解的那样紧密相关......

# windows - Windows 上 Vb.net VS2005 应用程序的 Mono 最小运行时间？

> ID：318175
> 
> 赞同：2
> 
> 时间：2008-11-25T17:20:20.250
> 
> 标签：windows, deployment, mono, runtime

有谁知道，或者有文章或分步教程的链接，可以告诉我如何以最低安装量分发 .net MONO 应用程序？Mono 的完整包大约是 75 MB，但我知道其中很多是我不需要的编译器和库。

我只想要最少的运行时文件。

我需要为一个简单的“Hello World”winforms 应用程序分发哪些文件？

我尝试只删除文件，直到我想出一些可行的方法，但它只在安装了 Mono 的机器上有效。这是我尝试过的文件

我为我的应用程序创建了一个目录。在那个目录中，我创建了另外两个目录

\bin \lib\mono\2.0

在 \mono\lib\mono\2.0 我把 mscorlib.dll 文件放在 \bin 目录中我把以下

Accessibility.dll,MyApp.exe (这是我在 VS2005 中做的基本 Hello World),iconv.dll, intl.dll, libglib-2.0-0.dll, libgthread-2.0-0.dll, Microsoft.VisualBasic.dll, mono.dll、mono.exe、Mono.Posix.dll、System.dll、System.Drawing.dll、System.Windows.Forms.dll

然后，我从 \bin 目录运行“mono MyApp.exe”，它在我安装了 Mono 的机器上运行，但在其他机器上没有。

我更喜欢的是“xcopy”解决方案，不需要实际安装，只需要包含运行时文件（比如从拇指驱动器运行时）

请注意，这是在 Windows 计算机上运行，​​而不是在 linux 机器上运行。

* * *

我尝试运行 mkbundle2（它是一个 .net 2.0 应用程序）并收到此错误

> C:\Program Files\Mono-2.0.1\bin>mkbundle2 C:\Projects\SingleExeTest\bin\Release\SingleExeTest.exe --deps 操作系统为：Windows 源：1 自动依赖：真正嵌入：C:\Projects \SingleExeTest\bin\Release\SingleExeTest.exe 嵌入：C:\PROGRA~1\MONO-2~1.1\lib\mono\2.0\mscorlib.dll 嵌入：C:\PROGRA~1\MONO-2~1.1\lib \mono\2.0\Microsoft.VisualBasic.dll
> 嵌入：C:\PROGRA~1\MONO-2~1.1\lib\mono\2.0\System.dll
> 嵌入：C:\PROGRA~1\MONO-2~1.1\lib \mono\2.0\System.Configuration.dll
> 嵌入：C:\PROGRA~1\MONO-2~1.1\lib\mono\2.0\System.Xml.dll
> 嵌入：C:\PROGRA~1\MONO-2~1.1 \lib\mono\2.0\System.Security.dll
> 嵌入：C:\PROGRA~1\MONO-2~1.1\lib\mono\2.0\Mono.Security.dll
> 嵌入：C:\PROGRA~1\MONO-2~1.1\lib\mono\2.0\System.Windows.Forms.dll
> 嵌入：C:\PROGRA~1\MONO-2~1.1\lib\mono\2.0\System .Drawing.dll
> 嵌入：C:\PROGRA~1\MONO-2~1.1\lib\mono\2.0\System.Data.dll
> 嵌入：C:\PROGRA~1\MONO-2~1.1\lib\mono\2.0 \Mono.Data.Tds.dll
> 嵌入：C:\PROGRA~1\MONO-2~1.1\lib\mono\2.0\System.Transactions.dll 嵌入：C:\PROGRA~1\MONO-2~1.1\lib \mono\2.0\System.EnterpriseServices.dll
> 嵌入：C:\PROGRA~1\MONO-2~1.1\lib\mono\2.0\Mono.WebBrowser.dll
> 嵌入：C:\PROGRA~1\MONO-2~1.1 \lib\mono\2.0\Mono.Posix.dll
> 嵌入：C:\PROGRA~1\MONO-2~1.1\lib\mono\2.0\Accessibility.dll 编译：as -o temp.o temp.s
> 
> 未处理的异常: System.ComponentModel.Win32Exception: ApplicationName='sh', CommandLine='-c "as -o temp.o temp.s "', CurrentDirectory='' at System.Diagnostics.Process.Start_noshell (System.Diagnostics. ProcessStartInfo startInfo, System.Diagnostics.Process 进程) [0x00000] 在 System.Diagnostics.Process.Start_common (System.Diagnostics.ProcessStartInf o startInfo, System.Diagnostics.Process 进程) [0x00000] 在 System.Diagnostics.Process.Start ( System.Diagnostics.ProcessStartInfo start Info) [0x00000] at MakeBundle.Execute (System.String cmdLine) [0x00000] at MakeBundle.GenerateBundles (System.Collections.ArrayList files) [0x00000] at MakeBundle.Main (System.String[] args ) [0x00000]
> 
> C:\Program Files\Mono-2.0.1\bin>

有什么建议么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-25T18:02:43.550

您需要使用“mkbundle”创建一个可以在 Windows 环境中使用的自包含可执行文件。最终结果是一个可执行文件，其中包含您需要的所有 Mono 库，而没有您不需要的库。

[在此网页](http://www.mono-project.com/Guide:Running_Mono_Applications)上查找“捆绑包”标题。它应该让你前进。请注意，这适用于纯 Mono 应用程序；它不处理像 GTK 这样的外部依赖项。

**编辑从这里开始**

注意：从 mkbundle 手册页...

> **视窗**
> 
> 在 Windows 系统上，必须安装类 Unix 工具链才能使 mkbundle 工作。您可以使用 cygwin 并安装 gcc、gcc-mingw 和软件包。

*请注意，binutils 包中包含 as。*

cygwin 可以在[这里](http://cygwin.org/)找到。（我将它安装在我所有的 Windows 机器上并强烈推荐它。）另请注意，cygwin 仅在开发机器上是必需的。它不需要部署到目标。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-25T22:07:45.927

嘿，看来我已经成功了！

我必须在 c:\mono 而不是 c:\program files\mono 中安装 Mono

我猜它不喜欢空格

感谢您的所有帮助！

# java - Is JCE needed if you have LDAP?

> ID：318185
> 
> 赞同：-2
> 
> 时间：2008-11-25T17:22:05.847
> 
> 标签：java, ldap, jce

Do you need to have JCE embedded in your Java application when you already have LDAP authentication in place?

* * *

## 回答 #1

> 赞同：-2
> 
> 时间：2009-01-11T14:54:19.423

我相信这取决于您对 LDAP 服务器进行的身份验证。

# javascript - 在网络应用程序中上传大文件最安全的方法是什么？

> ID：318186
> 
> 赞同：4
> 
> 时间：2008-11-25T17:22:17.687
> 
> 标签：javascript, html, flash, upload

我们必须接受大文件上传（视频内容），并希望以一种适用于所有符合标准的浏览器和插件的方式来做到这一点。我们当前的设置如下所示：

*   [SWF上传](http://swfupload.org)
*   输入 type="file" 进行优雅降级

在服务器端，我们有[nginx](http://nginx.net/)和[上传模块](http://www.grid.net.ru/nginx/upload.en.html)将上传的文件流式传输到服务器，然后将请求传递给 merb 应用程序。

不幸的是，最近发布的 Adob​​e Flash Player 10 似乎破坏了所有免费/开放的上传 Flash 组件（然后，一些其他网站也有自己的专有版本），但其他一些网站，如[Flickr](http://flickr.com)和[Vimeo](http://vimeo.com)，似乎工作得很好。

我一直在四处寻找其他方法，但由于必须同时兼容 Flash 9 和 10，因此我找不到合适的解决方案。有任何想法吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-26T03:52:20.257

文件上传总是很痛苦。

不久前我尝试了一些 Flash 上传器，似乎它们都存在不能在 Mac 上显示进度条的限制。更不用说升级到 flash 10 破坏了大多数 flash 上传器，因此我们公司应用程序的用户从多选包含 50 个文件的整个文件夹一次上传到一次上传 50 个文件。

Java 上传器工作正常（即使通过 Java 更新），但如果您没有小的用户群，您可以解释为什么他们需要下载 Java 并允许小程序在他们的浏览器中运行，大多数人不会使用它。

我认为中间立场是只使用ftp。它很旧但很有效，适用于非常大的文件和多个文件。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-13T22:16:24.780

Java 上传器是处理大文件的最佳工具，试试[Rad Upload](http://www.radinks.com/upload/)，它对大文件非常有用。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-13T22:31:02.303

试试[花式上传](http://digitarald.de/project/fancyupload/)。它是一个 MooTools 上传器，适用于 Flash 9 和 10。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-13T22:45:35.423

我一直在使用[JumpLoader](http://www.jumploader.com/)，效果很好。支持很好，提供免费版本，甚至包括一些基本的图像处理功能（裁剪、调整大小等）。

根据我的谷歌分析数据（非技术网站），99% 的访问者都安装了 Java，所以这不是问题。

当然，总是提供一个简单的`input type="file"`替代方案，以防万一。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-25T17:31:58.307

SWFUpload 的新版本 (v2.2.0+) 处理 Flash 10 问题。

# java - ActiveMQ Web 控制台不适用于嵌入式代理

> ID：318193
> 
> 赞同：7
> 
> 时间：2008-11-25T17:23:41.397
> 
> 标签：java, activemq

我有一个通过 java 代码完全配置的嵌入式代理（没有可部署的 xml 文件）。当我将浏览器指向 Web 控制台时，我只得到 404，并且 lsof 显示 8161 上没有任何内容正在监听。是否可以仅使用 Java 代码使用 Web 控制台？我可以使用 ActiveMQ 附带的网络服务器，我可以使用 8161 端口。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-26T09:43:29.593

如果您使用 Java 代码而不使用 Spring，那么只需自己创建自己的 servlet 容器并在其中注册管理 WAR。

这个[例子展示了如何用](http://svn.apache.org/viewvc/activemq/trunk/activemq-web-console/src/test/java/org/apache/activemq/web/tool/Main.java?view=markup)取自 Web 控制台源代码的 Java 代码来实现。

你可能需要多次试验和错误才能在你的类路径上获得所有必需的 jars - 你需要所有的 Jetty、JSP、Serlvets、JSTL 等等 - 加上 ActiveMQ 的东西

# opengl - 在opengl中显示任意大小的二维图像

> ID：318194
> 
> 赞同：3
> 
> 时间：2008-11-25T17:23:53.270
> 
> 标签：opengl, image, textures

我需要使用纹理在 opengl 中显示 2d 图像。
图像尺寸不一定是 2 的幂。
我想创建一个更大的纹理并将显示限制在我正在使用的部分，但是图像数据将与 openCV 共享，所以我不想一次复制一个像素的数据变成更大的纹理。

编辑 - 事实证明，即使是 Windows 下最简单的英特尔板载显卡也支持非 2 次幂纹理。

EDIT2 - 即使您没有任意纹理大小，然后使您的图像更小并重新缩放到窗口大小，即使在低端硬件上也非常快

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-25T18:05:02.030

我想到了几个 GL 扩展。看看[GL_ARB_texture_rectangle](http://www.opengl.org/registry/specs/ARB/texture_rectangle.txt)（如果你不需要 mipmapping），或[GL_ARB_texture_non_power_of_two](http://www.opengl.org/registry/specs/ARB/texture_non_power_of_two.txt)（如果你这样做）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-05T16:22:34.153

要避免的一个陷阱是，出于某种原因，某些视频卡需要将 GL_UNPACK_ALIGNMENT 设置为 1 ( glPixelStorei(GL_UNPACK_ALIGNMENT, 1); ) 才能正确加载非二次幂纹理。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-04-02T06:41:23.263

如果我可以为将来遇到此问题的任何人添加 - 您在网上找到的大多数关于 OpenGL 的文档和教程/示例都已经过时了很多年，包括 nehe.gamedev 的东西，并且会让您相信诸如非二次幂纹理大小之类的东西实际上不是问题，或者鼓励您使用早已弃用的 opengl 函数或十年未更新的库。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-25T18:03:05.500

首先，大多数现代显卡实际上都支持非正方形和非二次方大小的纹理尺寸。但是为了获得最大的兼容性，可能建议只使用两种纹理的幂。

首先确定每个图像尺寸（宽度和高度）较大的最接近的 2 次幂，然后创建该尺寸的纹理。那么你有两个选择。第一个是对像素数据进行软件调整大小以适合图像，然后在需要显示时根据原始纵横比调整四边形的大小。或者，您可以只用图像数据填充纹理的一部分，然后在其余部分放置透明像素。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-29T16:51:17.013

如果您想使用 2 次方纹理，请创建可以占用图像的最小纹理，并计算正确的纹理坐标以仅显示包含图像的纹理部分。例如，如果您的图像是 400x300，您将使用 512x512 纹理，将图像逐行复制到那里，您的正确纹理坐标将为 400.0/512.0，较低的一个 300.0/512.0。这看起来比软件缩放更好。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-29T16:58:39.807

我完全按照您的描述进行操作，复制到 2 次幂纹理并相应地调整我的 uv。扩展会很好，但你不能保证它们在任意计算机上都受支持。

# arrays - 如何在 MS Access 中过滤掉数组的空元素

> ID：318198
> 
> 赞同：2
> 
> 时间：2008-11-25T17:26:27.210
> 
> 标签：arrays, ms-access, null

我正在从其他几个领域生成标题，并且想要“正确”的方式来做：

```
Me.Title.Value = Join(Array([Conference], [Speaker], partstr), " - ") 
```

除了 [conference]、[speaker] 或 partstr 中的任何一个可能为空，我不想要额外的“-”。是否有任何功能可以使这项工作变得简单？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-25T17:45:29.137

不 - 你必须检查每一个，然后在最后清理

```
Dim Temp As String

If Not IsNull([Conference]) Then
  Temp = Temp & [Conference] & " - "
End If

If Not IsNull([Speaker]) Then
  Temp = Temp & [Speaker] & " - "
End If

If Not IsNull(partstr) Then
  Temp = Temp & partstr & " - "
End If

If Temp > "" then
  Me.Title.Value = Left(Temp, Len(Temp) - 3)
Else
  Me.Title.Value = Null
End If 
```

修改了通用功能：

```
Public Function JoinEx(ByVal pArray As Variant, ByVal pDelimiter As String) As String

  Dim sTemp As String
  Dim iCtr As Integer

  For iCtr = 0 To UBound(pArray)
    If Not IsNull(pArray(iCtr)) Then
      sTemp = sTemp & pArray(iCtr) & pDelimiter
    End If
  Next

  If sTemp > "" Then
   JoinEx = Left(sTemp, Len(sTemp) - Len(pDelimiter))
  End If

End Function 
```

调用示例：

```
 JoinEx(Array("one","two","three"), " - ")  'Returns "One - Two - Three"
 JoinEx(Array(null,"two","three"), " - ")  'Returns "Two - Three" 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-25T17:59:17.177

完全重写，这次经过适当测试：

```
 IIf(IsNull(Partstr), IIf(IsNull(Conference), Speaker, Conference & " - " + Speaker), Conference + " - " & Speaker + " - " & Partstr) 
```

# javascript - File structure for javascript-based web application

> ID：318199
> 
> 赞同：0
> 
> 时间：2008-11-25T17:26:28.833
> 
> 标签：javascript, jquery, file

I'm planning to write a javascript-based web application. I'm wondering what the best way to implement it in terms of file stucture is.

There is one main page (main.html) containing a menu and a main div section. The way it works is simple: When the user clicks on one of the links in the menu (for example 'Page 1'), the content of the div section is refreshed with the content of the page1.html file. This is done using javascript (jquery). If the user clicks on 'Page 2', the content of the page2.html file is loaded into the div section, etc.

Each page has its own javascript code and as I prefer to keep it separate I've implemented a sort of 'code behind' like in asp.net:

**page1.html**:
< script type="text/javascript" src="**page1.js"** >< /script>
<... html code ...>

**page2.html**:
< script type="text/javascript" src="**page2.js"** >< /script >
<... html code ...>

When the user clicks on 'Page 1', the content of the page1.html file is loaded into the main div section of main.html. As page1.html is referencing page1.js, the javascript code in page1.js is also loaded.

This seems to work fine but I'm wondering if it is the best way to implement this. At some point I was thinking of referencing all the javascript files in main.html This would also work fine but it would mean all the javascript files would have to be loaded in memory even if they are not going to be used. With the 1st approach, a javascript file is only loaded in memory before being actually used.

Any ideas? What are the 'best practises' for this? Keep in mind that this is a web application (as opposed to a website). It will be available over the internet but only to some users (and it will be password protected) so I don't care about SEO etc.

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-26T07:17:02.010

这对您来说可能无关紧要，但您知道从 SEO 的角度来看这是一个糟糕的主意。您的网站将是 Flash 网站的 Javascript 版本。就搜索引擎而言，只有一页。

这就是为什么多年来非常流行的基于框架的网站几乎消失了。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-26T13:09:11.503

@porneL

有一些方法和方法可以让 JS 异步加载（专门创建脚本标签），但这些可能被认为是不安全的

@OP

我同意其他人的观点，从 SEO 和可访问性的角度来看，这听起来是个坏主意，从实际的角度来看是一个性能问题（有一些方法可以在代码中进行引导，但我认为这是为了获得最小的收益而付出了很多努力），并且效果值得怀疑从应用程序开发的角度来看。作为一个假设的练习，我认为porneL 的gzip 解决方案是最好的。

基本上，我认为你很难找到很少有人会实践的最佳实践。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-26T13:01:31.240

JavaScript 文件的加载是同步的，这会对页面加载时间/感知响应能力产生负面影响。

出于这个原因，我认为最好将所有脚本合并到一个文件中，使用 YUI 压缩器对其进行压缩并发送 gzipped。通过这种方式，您将获得最好的压缩和最少的 HTTP 开销，并且缓存的 JS 不会暂停其他页面的加载。

对于特定于页面的动态脚本，使用 in-line `<script>…&lt;/script>`。

# visual-studio - 将命名空间定义与文件结构重新对齐

> ID：318201
> 
> 赞同：2
> 
> 时间：2008-11-25T17:26:49.567
> 
> 标签：visual-studio, visual-studio-2008, refactoring

像所有患有强迫症的开发人员一样，我尝试在我们的项目中组织我的命名空间，以便它们与它们包含在磁盘中的文件的位置相匹配。

然而，在 VS.NET 中进行了相当大规模的重构会话之后，我在项目中移动了文件并创建了很多新的子文件夹，将命名空间的重构留给后来相信必须有一个重构工具可以为我完成这件事。安顿下来。但是我现在找不到这样的工具！

有谁知道自动完成此操作（即，无需我煞费苦心地浏览 100 多个文件甚至编写我自己的工具？）。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-25T17:32:22.223

有几个选项：

1.  使用 Class View 窗口重命名命名空间。
2.  来自 jetbrains 的用户“ReSharper”进行重构。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-25T17:54:05.563

您可以在命名空间上使用 Refactor->Rename 函数，就像在任何其他标识符上一样。

# java - 如何在 Vista 中搜索文件（例如 Java 文件）？

> ID：318206
> 
> 赞同：0
> 
> 时间：2008-11-25T17:29:10.123
> 
> 标签：java, search, windows-vista

有没有一种用于 Vista 的方法或工具可以用来搜索 Java 文件中的内容？（我没有为它设置 Eclipse 项目）

当我有 Windows 2000 时，我曾经能够在 Windows 搜索工具中轻松地做到这一点。

编辑：我已经启用了“搜索文件内容”并添加了 xsl 和格兰特瓦格纳推荐的其他文件类型，搜索仍然没有返回结果......

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-25T17:52:13.540

就个人而言，我只使用[BareGrep](http://www.baremetalsoft.com/baregrep/ "BareGrep")（之前是[Agent Ransack](http://www.mythicsoft.com/agentransack/ "特工搜查")），它速度很快，支持正则表达式并显示匹配的行。
[grepWin](http://tools.tortoisesvn.net/grepWin "grepWin")也很好（可以替换字符串）但不显示行。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-25T17:33:49.927

有大量的搜索工具。最简单和最小的是 GNU grep。

我个人使用 Far （对于很多事情，不仅仅是搜索）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-25T17:35:17.443

如何向 Vista 的索引添加其他文件类型在[Watching The Net](http://www.watchingthenet.com/add-remove-file-types-to-windows-vista-search-index.html)和[How-To Geek 中进行了](http://www.howtogeek.com/howto/windows-vista/add-a-new-file-type-to-indexing-in-windows-vista/)说明。

# java - 我应该如何转换具有多个边界的 Java 泛型？

> ID：318208
> 
> 赞同：20
> 
> 时间：2008-11-25T17:29:28.500
> 
> 标签：java, generics, casting, polymorphism

是否可以将 Java 中的对象转换为组合的泛型类型？

我有这样的方法：

```
public static <T extends Foo & Bar> void doSomething(T object) {
    //do stuff
} 
```

如果我有一个实现两个接口（Foo & Bar）的类，调用这个方法是没有问题的。

问题是当我需要调用此方法时，我需要传递给它的对象被接收为`java.lang.Object`，我需要对其进行强制转换以使编译器满意。但我不知道如何制作这个演员表。

编辑：

问题在于这样的函数：

```
public void problemFunction (Object o) {
  if ( o instanceof Foo && o instanceof Bar) {
      doSomething((Problematic cast) o);
  }
} 
```

}

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2015-10-09T23:59:32.327

[Java 8 引入了使用附加边界](http://docs.oracle.com/javase/specs/jls/se8/html/jls-15.html#jls-15.16)进行强制转换的可能性。您可以将 a `Object`as a `class`with multiple `interfaces`（或仅 as multiple `interfaces`）。

所以这：

```
doSomething((Problematic cast) o); 
```

简单地变成这样：

```
doSomething((Foo & Bar) o); 
```

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-11-25T18:06:54.837

不幸的是，没有可以满足这种情况的合法演员。必须有一个已知的类型来实现您需要作为边界的所有接口，以便您可以强制转换为它。可能是您为此目的创建的类型，也可能是某些现有类型。

```
interface Baz extends Foo, Bar { }

public void caller(Object w) {
  doSomething((Baz) w);
} 
```

如果已知其他类型（例如`Baz`，以满足界限），则可以测试这些类型，并在调用者中使用一个分支来调用`doSomething`这些类型的强制转换。这不漂亮。

您还可以使用委托，创建您自己的`Baz`符合`doSomething`. 然后将传递的对象包装在`Baz`类的实例中，并将该包装器传递给`doSomething`.

```
private static class FooBarAdapter implements Foo, Bar {
  private final Object adaptee;
  FooBarAdapter(Object o) {
    adaptee = (Foo) (Bar) o;
  }
  public int flip() { return ((Foo) adaptee).flip(); }
  public void flop(int x) { ((Foo) adaptee).flop(x); }
  public void blort() { ((Bar) adaptee).blort(); }
}

public void problemFunction (Object o) {
  doSomething(new FooBarAdapter(o));
} 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-11-25T20:27:40.403

```
public static <T extends Foo & Bar> void doSomething(T object) 
```

这似乎表明您将对相关对象执行多个操作。

我会争辩说，如果您对对象执行的所需操作足够不同，可以跨接口分离，那么它们就足够不同，值得拥有自己的方法。

您很可能可以重组此代码以调用单独的方法来执行所需的操作。从客户的角度来看，这最终可能会使整个操作更加清晰。

代替：

```
public void problemFunction (Object o) {
  if (o instanceof Foo && o instanceof Bar) {
      doSomething((Problematic cast) o);
  }
} 
```

它成为了：

```
public void problemFunction(Object o) {
  if (o instanceof Foo && o instanceof Bar) {
      fooifySomething((Foo) o);
      baratizeSomething((Bar) o);
  }
} 
```

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2014-12-02T16:25:14.063

通过将联合类型编码为方法的类型参数的可怕方式，可以“向上转换”为联合类型；对于您的示例，您可以编写

```
private <Q extends Foo & Bar> Q upcast(final Object in) {
    return (Q) in;
}

// ... elsewhere...

if (myObject instanceof Foo && myObject instanceof Bar) {
    doSomething(upcast(myObject));
} 
```

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2008-11-25T18:18:39.727

作为一种解决方法，您可以定义另一个接口 FooBar 扩展 Foo 和 Bar 并让您的类实现它。它甚至不必是顶级接口 - 如果您不想弄乱或改进其余代码，则可以将其声明为私有：

```
private interface FooBar extends Foo, Bar {}
public void problemFunction (Object o) {
  if ( o instanceof Foo && o instanceof Bar) {
      doSomething((FooBar) o);
  }
} 
```

# c# - 比较 NUnit 中两个对象之间的相等性

> ID：318210
> 
> 赞同：144
> 
> 时间：2008-11-25T17:30:19.027
> 
> 标签：c#, unit-testing, automated-tests, nunit

我试图断言一个对象与另一个对象“相等”。

对象只是具有一堆公共属性的类的实例。有没有一种简单的方法可以让 NUnit 根据属性断言相等？

这是我目前的解决方案，但我认为可能会有更好的解决方案：

```
Assert.AreEqual(LeftObject.Property1, RightObject.Property1)
Assert.AreEqual(LeftObject.Property2, RightObject.Property2)
Assert.AreEqual(LeftObject.Property3, RightObject.Property3)
...
Assert.AreEqual(LeftObject.PropertyN, RightObject.PropertyN) 
```

我所追求的将与 CollectionEquivalentConstraint 具有相同的精神，其中 NUnit 验证两个集合的内容是否相同。

* * *

## 回答 #1

> 赞同：133
> 
> 时间：2012-04-27T14:00:00.273

不要仅仅为了测试目的而覆盖 Equals。这很乏味并且影响域逻辑。反而，

### 使用 JSON 比较对象的数据

您的对象没有额外的逻辑。没有额外的测试任务。

只需使用这个简单的方法：

```
public static void AreEqualByJson(object expected, object actual)
{
    var serializer = new System.Web.Script.Serialization.JavaScriptSerializer();
    var expectedJson = serializer.Serialize(expected);
    var actualJson = serializer.Serialize(actual);
    Assert.AreEqual(expectedJson, actualJson);
} 
```

看起来效果很好。测试运行结果信息将显示包含的 JSON 字符串比较（对象图），以便您直接看到问题所在。

**另请注意！**如果您有更大的复杂对象并且只想比较它们的一部分，您可以（*将 LINQ 用于序列数据*）创建匿名对象以与上述方法一起使用。

```
public void SomeTest()
{
    var expect = new { PropA = 12, PropB = 14 };
    var sut = loc.Resolve<SomeSvc>();
    var bigObjectResult = sut.Execute(); // This will return a big object with loads of properties 
    AssExt.AreEqualByJson(expect, new { bigObjectResult.PropA, bigObjectResult.PropB });
} 
```

* * *

## 回答 #2

> 赞同：121
> 
> 时间：2008-11-25T17:38:00.883

如果由于任何原因无法覆盖 Equals，则可以构建一个辅助方法，该方法通过反射遍历公共属性并断言每个属性。像这样的东西：

```
public static class AssertEx
{
    public static void PropertyValuesAreEquals(object actual, object expected)
    {
        PropertyInfo[] properties = expected.GetType().GetProperties();
        foreach (PropertyInfo property in properties)
        {
            object expectedValue = property.GetValue(expected, null);
            object actualValue = property.GetValue(actual, null);

            if (actualValue is IList)
                AssertListsAreEquals(property, (IList)actualValue, (IList)expectedValue);
            else if (!Equals(expectedValue, actualValue))
                Assert.Fail("Property {0}.{1} does not match. Expected: {2} but was: {3}", property.DeclaringType.Name, property.Name, expectedValue, actualValue);
        }
    }

    private static void AssertListsAreEquals(PropertyInfo property, IList actualList, IList expectedList)
    {
        if (actualList.Count != expectedList.Count)
            Assert.Fail("Property {0}.{1} does not match. Expected IList containing {2} elements but was IList containing {3} elements", property.PropertyType.Name, property.Name, expectedList.Count, actualList.Count);

        for (int i = 0; i < actualList.Count; i++)
            if (!Equals(actualList[i], expectedList[i]))
                Assert.Fail("Property {0}.{1} does not match. Expected IList with element {1} equals to {2} but was IList with element {1} equals to {3}", property.PropertyType.Name, property.Name, expectedList[i], actualList[i]);
    }
} 
```

* * *

## 回答 #3

> 赞同：104
> 
> 时间：2011-09-16T05:27:03.513

试试[FluentAssertions](http://www.fluentassertions.com/)库：

```
dto.Should().BeEquivalentTo(customer) 
```

它也可以使用 NuGet 安装。

* * *

## 回答 #4

> 赞同：55
> 
> 时间：2008-11-25T17:33:35.510

为您的对象覆盖 .Equals ，然后在单元测试中您可以简单地执行以下操作：

```
Assert.AreEqual(LeftObject, RightObject); 
```

当然，这可能意味着您只需将所有单独的比较移至 .Equals 方法，但它允许您在多个测试中重用该实现，并且如果对象应该能够与兄弟姐妹进行比较可能是有意义的。

* * *

## 回答 #5

> 赞同：37
> 
> 时间：2009-01-11T02:24:26.817

我不想仅仅为了启用测试而覆盖 Equals。不要忘记，如果你确实覆盖了 Equals，你真的应该覆盖 GetHashCode 或者如果你在字典中使用你的对象，你可能会得到意想不到的结果。

我确实喜欢上面的反射方法，因为它可以满足将来添加的属性。

然而，对于一个快速简单的解决方案，通常最简单的方法是创建一个测试对象是否相等的辅助方法，或者在您对测试保持私有的类上实现 IEqualityComparer。使用 IEqualityComparer 解决方案时，您无需费心执行 GetHashCode。例如：

```
// Sample class.  This would be in your main assembly.
class Person
{
    public string Name { get; set; }
    public int Age { get; set; }
}

// Unit tests
[TestFixture]
public class PersonTests
{
    private class PersonComparer : IEqualityComparer<Person>
    {
        public bool Equals(Person x, Person y)
        {
            if (x == null && y == null)
            {
                return true;
            }

            if (x == null || y == null)
            {
                return false;
            }

            return (x.Name == y.Name) && (x.Age == y.Age);
        }

        public int GetHashCode(Person obj)
        {
            throw new NotImplementedException();
        }
    }

    [Test]
    public void Test_PersonComparer()
    {
        Person p1 = new Person { Name = "Tom", Age = 20 }; // Control data

        Person p2 = new Person { Name = "Tom", Age = 20 }; // Same as control
        Person p3 = new Person { Name = "Tom", Age = 30 }; // Different age
        Person p4 = new Person { Name = "Bob", Age = 20 }; // Different name.

        Assert.IsTrue(new PersonComparer().Equals(p1, p2), "People have same values");
        Assert.IsFalse(new PersonComparer().Equals(p1, p3), "People have different ages.");
        Assert.IsFalse(new PersonComparer().Equals(p1, p4), "People have different names.");
    }
} 
```

* * *

## 回答 #6

> 赞同：24
> 
> 时间：2015-02-16T15:54:56.180

我尝试了这里提到的几种方法。大多数涉及序列化您的对象并进行字符串比较。虽然超级简单且通常非常有效，但我发现当您遇到故障并报告类似这样的事情时它会有点短：

```
Expected string length 2326 but was 2342\. Strings differ at index 1729. 
```

至少可以说，找出差异在哪里是一件痛苦的事。

使用 FluentAssertions 的[对象图比较](https://github.com/dennisdoomen/fluentassertions/wiki#object-graph-comparison)（即`a.ShouldBeEquivalentTo(b)`），您可以得到以下结果：

```
Expected property Name to be "Foo" but found "Bar" 
```

那好多了。[立即获取 FluentAssertions](https://www.nuget.org/packages/FluentAssertions)，稍后您会很高兴（如果您对此表示赞同，也请在第一次建议 FluentAssertions 的地方支持 dkl[的回答](https://stackoverflow.com/a/7440471/62600)）。

* * *

## 回答 #7

> 赞同：10
> 
> 时间：2009-05-01T06:23:30.597

我同意 ChrisYoxall 的观点——纯粹出于测试目的在您的主代码中实现 Equals 并不好。

如果您因为某些应用程序逻辑需要而实现 Equals，那很好，但请保持纯测试代码以免造成混乱（同样检查相同以进行测试的语义可能与您的应用程序所需的不同）。

简而言之，将仅用于测试的代码排除在您的课程之外。

对于大多数类来说，使用反射对属性进行简单的浅层比较就足够了，尽管如果您的对象具有复杂的属性，您可能需要递归。如果遵循引用，请注意循环引用或类似内容。

狡猾

* * *

## 回答 #8

> 赞同：7
> 
> 时间：2015-11-15T07:10:59.147

[在 NUnit 2.4.2 中添加的Property constraints](http://www.nunit.org/index.php?p=propertyConstraint&r=2.6.4)允许一个比 OP 的原始解决方案更具可读性的解决方案，并且它会产生更好的失败消息。它绝不是通用的，但如果你不需要为太多的类做它，它是一个非常合适的解决方案。

```
Assert.That(ActualObject, Has.Property("Prop1").EqualTo(ExpectedObject.Prop1)
                          & Has.Property("Prop2").EqualTo(ExpectedObject.Prop2)
                          & Has.Property("Prop3").EqualTo(ExpectedObject.Prop3)
                          // ... 
```

不像实现那样通用，`Equals`但它确实提供了比

```
Assert.AreEqual(ExpectedObject, ActualObject); 
```

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2013-05-29T16:40:09.473

Max Wikstrom 的 JSON 解决方案（上图）对我来说最有意义，它简短、干净，最重要的是它有效。就个人而言，虽然我更喜欢将 JSON 转换作为一个单独的方法来实现，并将断言放回单元测试中，就像这样......

帮手方法：

```
public string GetObjectAsJson(object obj)
    {
        System.Web.Script.Serialization.JavaScriptSerializer oSerializer = new System.Web.Script.Serialization.JavaScriptSerializer();
        return oSerializer.Serialize(obj);
    } 
```

单元测试 ：

```
public void GetDimensionsFromImageTest()
        {
            Image Image = new Bitmap(10, 10);
            ImageHelpers_Accessor.ImageDimensions expected = new ImageHelpers_Accessor.ImageDimensions(10,10);

            ImageHelpers_Accessor.ImageDimensions actual;
            actual = ImageHelpers_Accessor.GetDimensionsFromImage(Image);

            /*USING IT HERE >>>*/
            Assert.AreEqual(GetObjectAsJson(expected), GetObjectAsJson(actual));
        } 
```

仅供参考 - 您可能需要在解决方案中添加对 System.Web.Extensions 的引用。

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2016-05-12T22:15:46.053

这是一个非常古老的线程，但我想知道是否有理由为什么没有提出答案`NUnit.Framework.Is.EqualTo`和`NUnit.Framework.Is.NotEqualTo`？

如：

```
Assert.That(LeftObject, Is.EqualTo(RightObject)); 
```

和

```
Assert.That(LeftObject, Is.Not.EqualTo(RightObject)); 
```

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2013-03-15T14:17:23.030

另一种选择是通过实现 NUnit 抽象`Constraint`类来编写自定义约束。使用帮助类提供一点语法糖，生成的测试代码非常简洁易读，例如

```
Assert.That( LeftObject, PortfolioState.Matches( RightObject ) ); 
```

举一个极端的例子，考虑具有“只读”成员的类 is not `IEquatable`，即使您想更改测试中的类也不能：

```
public class Portfolio // Somewhat daft class for pedagogic purposes...
{
    // Cannot be instanitated externally, instead has two 'factory' methods
    private Portfolio(){ }

    // Immutable properties
    public string Property1 { get; private set; }
    public string Property2 { get; private set; }  // Cannot be accessed externally
    public string Property3 { get; private set; }  // Cannot be accessed externally

    // 'Factory' method 1
    public static Portfolio GetPortfolio(string p1, string p2, string p3)
    {
        return new Portfolio() 
        { 
            Property1 = p1, 
            Property2 = p2, 
            Property3 = p3 
        };
    }

    // 'Factory' method 2
    public static Portfolio GetDefault()
    {
        return new Portfolio() 
        { 
            Property1 = "{{NONE}}", 
            Property2 = "{{NONE}}", 
            Property3 = "{{NONE}}" 
        };
    }
} 
```

类的契约`Constraint`需要一个覆盖`Matches`并且`WriteDescriptionTo`（在不匹配的情况下，对期望值的叙述）而且覆盖`WriteActualValueTo`（对实际值的叙述）是有意义的：

```
public class PortfolioEqualityConstraint : Constraint
{
    Portfolio expected;
    string expectedMessage = "";
    string actualMessage = "";

    public PortfolioEqualityConstraint(Portfolio expected)
    {
        this.expected = expected;
    }

    public override bool Matches(object actual)
    {
        if ( actual == null && expected == null ) return true;
        if ( !(actual is Portfolio) )
        { 
            expectedMessage = "<Portfolio>";
            actualMessage = "null";
            return false;
        }
        return Matches((Portfolio)actual);
    }

    private bool Matches(Portfolio actual)
    {
        if ( expected == null && actual != null )
        {
            expectedMessage = "null";
            expectedMessage = "non-null";
            return false;
        }
        if ( ReferenceEquals(expected, actual) ) return true;

        if ( !( expected.Property1.Equals(actual.Property1)
                 && expected.Property2.Equals(actual.Property2) 
                 && expected.Property3.Equals(actual.Property3) ) )
        {
            expectedMessage = expected.ToStringForTest();
            actualMessage = actual.ToStringForTest();
            return false;
        }
        return true;
    }

    public override void WriteDescriptionTo(MessageWriter writer)
    {
        writer.WriteExpectedValue(expectedMessage);
    }
    public override void WriteActualValueTo(MessageWriter writer)
    {
        writer.WriteExpectedValue(actualMessage);
    }
} 
```

加上助手类：

```
public static class PortfolioState
{
    public static PortfolioEqualityConstraint Matches(Portfolio expected)
    {
        return new PortfolioEqualityConstraint(expected);
    }

    public static string ToStringForTest(this Portfolio source)
    {
        return String.Format("Property1 = {0}, Property2 = {1}, Property3 = {2}.", 
            source.Property1, source.Property2, source.Property3 );
    }
} 
```

示例用法：

```
[TestFixture]
class PortfolioTests
{
    [Test]
    public void TestPortfolioEquality()
    {
        Portfolio LeftObject 
            = Portfolio.GetDefault();
        Portfolio RightObject 
            = Portfolio.GetPortfolio("{{GNOME}}", "{{NONE}}", "{{NONE}}");

        Assert.That( LeftObject, PortfolioState.Matches( RightObject ) );
    }
} 
```

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2015-05-24T04:37:21.327

只需从 Nuget 安装 ExpectedObjects，您就可以轻松地比较两个对象的属性值、集合的每个对象值、两个组合对象的值以及匿名类型的部分比较属性值。

我在 github 上有一些例子：[https ://github.com/hatelove/CompareObjectEquals](https://github.com/hatelove/CompareObjectEquals)

以下是一些包含比较对象场景的示例：

```
 [TestMethod]
    public void Test_Person_Equals_with_ExpectedObjects()
    {
        //use extension method ToExpectedObject() from using ExpectedObjects namespace to project Person to ExpectedObject
        var expected = new Person
        {
            Id = 1,
            Name = "A",
            Age = 10,
        }.ToExpectedObject();

        var actual = new Person
        {
            Id = 1,
            Name = "A",
            Age = 10,
        };

        //use ShouldEqual to compare expected and actual instance, if they are not equal, it will throw a System.Exception and its message includes what properties were not match our expectation.
        expected.ShouldEqual(actual);
    }

    [TestMethod]
    public void Test_PersonCollection_Equals_with_ExpectedObjects()
    {
        //collection just invoke extension method: ToExpectedObject() to project Collection<Person> to ExpectedObject too
        var expected = new List<Person>
        {
            new Person { Id=1, Name="A",Age=10},
            new Person { Id=2, Name="B",Age=20},
            new Person { Id=3, Name="C",Age=30},
        }.ToExpectedObject();

        var actual = new List<Person>
        {
            new Person { Id=1, Name="A",Age=10},
            new Person { Id=2, Name="B",Age=20},
            new Person { Id=3, Name="C",Age=30},
        };

        expected.ShouldEqual(actual);
    }

    [TestMethod]
    public void Test_ComposedPerson_Equals_with_ExpectedObjects()
    {
        //ExpectedObject will compare each value of property recursively, so composed type also simply compare equals.
        var expected = new Person
        {
            Id = 1,
            Name = "A",
            Age = 10,
            Order = new Order { Id = 91, Price = 910 },
        }.ToExpectedObject();

        var actual = new Person
        {
            Id = 1,
            Name = "A",
            Age = 10,
            Order = new Order { Id = 91, Price = 910 },
        };

        expected.ShouldEqual(actual);
    }

    [TestMethod]
    public void Test_PartialCompare_Person_Equals_with_ExpectedObjects()
    {
        //when partial comparing, you need to use anonymous type too. Because only anonymous type can dynamic define only a few properties should be assign.
        var expected = new
        {
            Id = 1,
            Age = 10,
            Order = new { Id = 91 }, // composed type should be used anonymous type too, only compare properties. If you trace ExpectedObjects's source code, you will find it invoke config.IgnoreType() first.
        }.ToExpectedObject();

        var actual = new Person
        {
            Id = 1,
            Name = "B",
            Age = 10,
            Order = new Order { Id = 91, Price = 910 },
        };

        // partial comparing use ShouldMatch(), rather than ShouldEqual()
        expected.ShouldMatch(actual);
    } 
```

参考：

1.  [预期对象 github](https://github.com/derekgreer/expectedObjects)
2.  [ExpectedObjects 介绍](https://lostechies.com/derekgreer/2011/06/28/introducing-the-expected-objects-library/)

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2013-06-11T09:33:42.150

我会以@Juanma 的答案为基础。但是，我认为这不应该通过单元测试断言来实现。这是一个在某些情况下可以由非测试代码很好地使用的实用程序。

我写了一篇关于此事的文章[http://timoch.com/blog/2013/06/unit-test-equality-is-not-domain-equality/](http://timoch.com/blog/2013/06/unit-test-equality-is-not-domain-equality/)

我的建议如下：

```
/// <summary>
/// Returns the names of the properties that are not equal on a and b.
/// </summary>
/// <param name="a"></param>
/// <param name="b"></param>
/// <returns>An array of names of properties with distinct 
///          values or null if a and b are null or not of the same type
/// </returns>
public static string[] GetDistinctProperties(object a, object b) {
    if (object.ReferenceEquals(a, b))
        return null;
    if (a == null)
        return null;
    if (b == null)
        return null;

    var aType = a.GetType();
    var bType = b.GetType();

    if (aType != bType)
        return null;

    var props = aType.GetProperties();

    if (props.Any(prop => prop.GetIndexParameters().Length != 0))
        throw new ArgumentException("Types with index properties not supported");

    return props
        .Where(prop => !Equals(prop.GetValue(a, null), prop.GetValue(b, null)))
        .Select(prop => prop.Name).ToArray();
} 
```

与 NUnit 一起使用

```
Expect(ReflectionUtils.GetDistinctProperties(tile, got), Empty); 
```

在不匹配时产生以下消息。

```
Expected: <empty>
But was:  < "MagmaLevel" >
at NUnit.Framework.Assert.That(Object actual, IResolveConstraint expression, String message, Object[] args)
at Undermine.Engine.Tests.TileMaps.BasicTileMapTests.BasicOperations() in BasicTileMapTests.cs: line 29 
```

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2015-02-02T17:58:37.153

[https://github.com/kbilsted/StatePrinter](https://github.com/kbilsted/StatePrinter)专门用于将对象图转储为字符串表示，目的是编写简单的单元测试。

*   它带有 witg Assert 方法，可以将正确转义的字符串轻松复制粘贴到测试中以进行更正。
*   它允许自动重写单元测试
*   它与所有单元测试框架集成
*   与 JSON 序列化不同，支持循环引用
*   您可以轻松过滤，因此只有部分类型被转储

给定

```
class A
{
  public DateTime X;
  public DateTime Y { get; set; }
  public string Name;
} 
```

您可以以类型安全的方式，并使用 Visual Studio 的自动完成包含或排除字段。

```
 var printer = new Stateprinter();
  printer.Configuration.Projectionharvester().Exclude<A>(x => x.X, x => x.Y);

  var sut = new A { X = DateTime.Now, Name = "Charly" };

  var expected = @"new A(){ Name = ""Charly""}";
  printer.Assert.PrintIsSame(expected, sut); 
```

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2017-10-23T16:36:35.773

我已经写了一个简单的表达式工厂：

```
public static class AllFieldsEqualityComprision<T>
{
    public static Comparison<T> Instance { get; } = GetInstance();

    private static Comparison<T> GetInstance()
    {
        var type = typeof(T);
        ParameterExpression[] parameters =
        {
            Expression.Parameter(type, "x"),
            Expression.Parameter(type, "y")
        };
        var result = type.GetProperties().Aggregate<PropertyInfo, Expression>(
            Expression.Constant(true),
            (acc, prop) =>
                Expression.And(acc,
                    Expression.Equal(
                        Expression.Property(parameters[0], prop.Name),
                        Expression.Property(parameters[1], prop.Name))));
        var areEqualExpression = Expression.Condition(result, Expression.Constant(0), Expression.Constant(1));
        return Expression.Lambda<Comparison<T>>(areEqualExpression, parameters).Compile();
    }
} 
```

并使用它：

```
Assert.That(
    expectedCollection, 
    Is.EqualTo(actualCollection)
      .Using(AllFieldsEqualityComprision<BusinessCategoryResponse>.Instance)); 
```

这非常有用，因为我必须比较这些对象的集合。你可以在其他地方使用这个比较:)

以下是示例要点：[https ://gist.github.com/Pzixel/b63fea074864892f9aba8ffde312094f](https://gist.github.com/Pzixel/b63fea074864892f9aba8ffde312094f)

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2010-11-10T04:30:48.160

反序列化两个类，并进行字符串比较。

**编辑：** 完美运行，这是我从 NUnit 得到的输出；

```
Test 'Telecom.SDP.SBO.App.Customer.Translator.UnitTests.TranslateEaiCustomerToDomain_Tests.TranslateNew_GivenEaiCustomer_ShouldTranslateToDomainCustomer_Test("ApprovedRatingInDb")' failed:
  Expected string length 2841 but was 5034\. Strings differ at index 443.
  Expected: "...taClasses" />\r\n  <ContactMedia />\r\n  <Party i:nil="true" /..."
  But was:  "...taClasses" />\r\n  <ContactMedia>\r\n    <ContactMedium z:Id="..."
  ----------------------------------------------^
 TranslateEaiCustomerToDomain_Tests.cs(201,0): at Telecom.SDP.SBO.App.Customer.Translator.UnitTests.TranslateEaiCustomerToDomain_Tests.Assert_CustomersAreEqual(Customer expectedCustomer, Customer actualCustomer)
 TranslateEaiCustomerToDomain_Tests.cs(114,0): at Telecom.SDP.SBO.App.Customer.Translator.UnitTests.TranslateEaiCustomerToDomain_Tests.TranslateNew_GivenEaiCustomer_ShouldTranslateToDomainCustomer_Test(String custRatingScenario) 
```

**编辑二：** 这两个对象可以相同，但属性序列化的顺序不同。因此 XML 是不同的。哦！

**编辑三：** 这确实有效。我在我的测试中使用它。但是您必须按照被测代码添加项目的顺序将项目添加到集合属性中。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2018-09-20T13:31:42.983

我知道这是一个非常古老的问题，但 NUnit 仍然没有对此的原生支持。然而，如果你喜欢 BDD 风格的测试（ala Jasmine），你会对 NExpect 感到惊喜（[https://github.com/fluffynuts/NExpect](https://github.com/fluffynuts/NExpect)，从 NuGet 获得），其中包含深度相等测试.

（免责声明：我是 NExpect 的作者）

* * *

## 回答 #18

> 赞同：-1
> 
> 时间：2017-08-09T04:11:12.070

字符串化和比较两个字符串

Assert.AreEqual(JSON.stringify(LeftObject), JSON.stringify(RightObject))

# php - “在这台计算机上记住我”的 php/pear 包

> ID：318214
> 
> 赞同：1
> 
> 时间：2008-11-25T17:31:31.693
> 
> 标签：php, cookies, pear

我知道这通常是用 cookie 完成的，但是我在不同的浏览器上得到了不可预测的结果，并决定寻找一个专注于此的 pear 包。只是想知道是否有任何人在这种特殊情况下成功使用过的包（例如 HTTP_Client？）。或者实际上，人们在手动设置 cookie 并检查它们的过程中是否*从来没有或很少遇到问题？*使用包来处理 cookie 是否常见？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-25T17:49:07.447

[PEAR::LiveUser](http://pear.php.net/package/LiveUser)中有这样的功能，尽管我坚信它会是矫枉过正。以下是您从[最终用户文档](http://pear.php.net/package/LiveUser/docs/latest/LiveUser/LiveUser.html#methodsetRememberCookie)中请求的功能的描述：

> setRememberCookie [第 1326 行] bool setRememberCookie（字符串 $handle，字符串 $passwd）
> 
> 如果允许使用 cookie，此方法会检查用户是否想要设置 cookie，这样他下次登录时就不必输入句柄和密码。如果为真，它将设置 cookie。
> 
> ```
> * Return: true if the cookie can be set, false otherwise
> * Access: public 
> ```
> 
> 参数： string $handle —<br>试图认证的用户的句柄 string $passwd —<br>试图认证的用户的密码

cookie 检查给您带来什么麻烦？您可能会遇到 www 与非 www、子域与域或任何数量的逻辑问题。我记得在一个 PHP 身份验证系统上工作过，而这正是你正在做的事情，但我也记得它是一个熊市。当然，您的里程可能会有所不同。:)

# c# - ASP.NET MVC 身份验证

> ID：318215
> 
> 赞同：1
> 
> 时间：2008-11-25T17:31:35.517
> 
> 标签：c#, asp.net-mvc, .net-3.5, c#-3.0

是否可以在ASP.NET MVC beta 1中创建类似[这样的东西](http://geekswithblogs.net/AzamSharp/archive/2008/02/24/119946.aspx)

我试过了，但是

```
override bool OnPreAction(string actionName, 
                          System.Reflection.MethodInfo methodInfo) 
```

不再存在并且

```
override void OnActionExecuting(ActionExecutingContext filterContext) 
```

不要让我访问操作名称

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-25T17:54:21.897

在您所指的博客文章中，作者指出

> 解决此问题的一种方法是使用本文所示的基于属性的安全性。但是随后您将不得不使用安全属性来装饰您的操作，这不是一个好主意。

我认为这是一种非常好的方法，它得到了框架的支持。它会给你一个很好的声明式实现。查看 System.Web.Mvc 中的 AuthorizeAttribute。它将允许您执行以下操作：

```
[Authorize(Roles="Admin, Editor")]
public ActionResult Delete(int id){
    (...)
} 
```

由于 Delete 操作会改变系统的状态，因此我还将添加一个 AcceptVerbs 属性，如下所示：

```
[AcceptVerbs(HttpVerbs.Post)]
[Authorize(Roles="Admin, Editor")]
public ActionResult Delete(int id){
    (...)
} 
```

这将确保该操作不会接受 GET 请求。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-25T17:54:59.150

[创建自定义属性](http://blog.wekeroad.com/blog/aspnet-mvc-securing-your-controller-actions/)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-25T19:02:41.027

不想用授权属性装饰您的操作的原因是什么？抱歉，但如果我要尝试提供比已经给出的答案更好的答案，我认为我必须更好地了解您的情况。

# sql-server - SQL Server 哈希索引

> ID：318219
> 
> 赞同：10
> 
> 时间：2008-11-25T17:32:26.433
> 
> 标签：sql-server, hash, indexing

当使用 CHECKSUM 列类型人为创建哈希索引时，查找实际上是 O(1) 还是仍然像聚集索引一样 O(lg n)？我有一个表，我将根据它的 ID 列从中选择，我需要尽可能快的查找，那么聚集索引是最快的选项吗？我正在寻找能够提供 O(1) 性能的东西。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-11-26T22:52:53.103

好的，2分。
SQL CHECKSUM 函数不产生哈希值。它实际上计算了一个 CRC 值。基于哈希检查不是一个很好的候选，因为会有相对大量的冲突。如果你想要一个散列函数，你应该检查 hash_bytes 函数。
其次，您实际上并没有创建哈希索引。您正在对哈希值创建一个普通的 b-tree，因此查找时间将与在类似大小的数据类型上的任何其他 b-tree 索引完全相同。
通过使用长 varchar 值的 CRC 或散列来允许比较较少的字节数，您有可能获得一点性能，但字符串比较只检查它需要的字节数，即第一个不匹配的字符，如果你在哈希值上匹配，那么无论如何你都需要仔细检查实际值。因此，除非您有很多非常相似的字符串，否则您最终可能会使用散列（或 CRC）比较更多字节。

简而言之，我认为这不是一个明智的计划，但与所有优化一样，您应该在特定情况下对其进行测试，然后再决定。如果您愿意发布结果，我很想看看您的结果。而且我不相信有比使用聚集索引更快地在 SQL Server 中定位行的方法。

如果您关心，Ingres（由 CA）可以创建哈希索引，然后将达到 O(1)。可能还有其他 RDBM 也支持真正的哈希索引。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-11-27T10:58:00.130

我不认为 SQL 服务器本身具有基于哈希表的索引。[BOL 文档](http://msdn.microsoft.com/en-us/library/ms189788(SQL.90).aspx)正在讨论在计算值上构建标准（树）索引。这与线性哈希表不同，[线性哈希表](http://en.wikipedia.org/wiki/Linear_hash)是某些 DBMS 平台上可用的索引结构，但不是 SQL Server (AFAIK)。

[使用此博客文章](http://clay.lenharts.net/blog/2008/02/03/sql-server-hash-indexes/)中描述的技术对较大的字符串值（例如 URL）进行哈希处理以加快查找速度，您可能会获得一些好处。但是，底层索引仍然是一个树结构，并且是 O(Log N)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-27T10:35:47.880

您可以尝试设置使用哈希联接，您可以查看执行计划以验证是否实际使用了哈希联接。使用散列连接时，SQL Server 仍将首先构建散列表作为执行单个查询的一部分。我相信索引永远不会存储为哈希，而只会存储为树。

一般来说，除非您对潜在的大字符串或二进制 blob 进行精确匹配（如 pipTheGeek 所述），否则我不会创建人工哈希列。我只是想补充一点，有时这是必要的，因为字符串可能太大而无法放入索引键中。我认为 SQL Server 的索引键大小是 2k 的。

当然，在您的联接中，您需要包含散列列和源列，以解决散列导致的任何歧义。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-25T18:44:32.000

如果 ID 字段是 int，则在 ID 字段上的聚集索引上搜索索引 CHECKSUM 没有任何优势，因为两者都会进行聚集索引查找。此外，int 列的 CHECKSUM 始终返回与该列相同的值（即 CHECKSUM(535) = 535）。但是，如果 ID 是长字符列，则 CHECKSUM 查找通常会执行得更好。

# windows - 如何以编程方式创建 Windows VPN 连接？

> ID：318233
> 
> 赞同：17
> 
> 时间：2008-11-25T17:36:37.220
> 
> 标签：windows, vpn

我有一个支持环境，我们使用 VPN 和远程桌面连接到许多客户的系统。目前，支持人员必须在其工作站上手动设置 VPN 连接。有没有办法以编程方式创建 VPN 连接？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-05-08T18:28:05.000

查看 CodePlex 上的 DotRas 项目，RasPhoneBook 组件完全支持管理 Windows 使用的电话簿。

[http://www.codeplex.com/DotRas](http://www.codeplex.com/DotRas)

这将比直接使用 API 容易得多，我可以保证这一点。:)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-25T18:48:46.297

查找 RAS API（远程访问服务），它是一个 win32 dll，但您可以从 C# 调用它。以下是一些可以帮助您入门的链接：

*   [http://msdn.microsoft.com/en-us/library/aa446741(VS.85).aspx](http://msdn.microsoft.com/en-us/library/aa446741(VS.85).aspx)

*   [http://social.msdn.microsoft.com/forums/en-US/netfxnetcom/thread/28125f40-9c3b-4e77-9bfb-8a975e9b3457/](http://social.msdn.microsoft.com/forums/en-US/netfxnetcom/thread/28125f40-9c3b-4e77-9bfb-8a975e9b3457/)

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2013-09-18T08:35:15.990

我知道这个问题很老，但我有同样的问题并用这个 C# 代码解决它。也许它对某人有帮助。

首先，在您的个人计算机中创建 vpn 连接。它将存储在**%userprofile%\AppData\Roaming\Microsoft\Network\Connections\PBK**

然后使用文本编辑器（例如 Notepad++）打开 rasphone.pbk 文件并复制您的连接信息。但不要忘记。在此步骤之前，您必须完成连接设置。然后，从 rasphone.pbk 文件复制您的连接信息并粘贴到脚本中（到 rasphone 字符串）。提示：rasphone.pbk 文件只包含设置。没有用户名和密码...

在我的代码中，我创建了与这些设置的连接；
连接名称：RAS -> At first Line [RAS]
连接 Ip：ras.ugurturhal.com
VPN 类型：PPTP，支持 CHAP 和 MS-CHAP v2 协议

该代码是检查您的 VPN 连接。如果您有一个名称为 RAS 或 IP 地址为 ras.ugurturhal.com 的连接，则代码不会更改任何内容并向您发出警告。如果您有很多 VPN 连接并且它们都没有相同的设置（如上），它也会“添加”这个 VPN。最后一件事，如果您没有 VPN 连接，它将创建一个新连接。

注意：您无法在网络上看到由 C# 创建的 VPN 连接。但这将是工作。重新启动计算机后，将在您的网络上看到它:)

我希望它对某人有所帮助..

您可以从我的[Web Host](http://www.ugurturhal.com/VPN_Creator.rar)下载我的项目文件..

问候。

PS：我尝试将所有代码添加到此处，但在 stackoverflow 中非常新。请原谅我。您可以下载示例；）

PS2：或者你可以从[GitHub 上](https://github.com/ugurturhal/VPN_Creator_CSharp/blob/master/Codes)查看。谢谢@axrwkr

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-11-25T18:56:22.380

在 Windows 上，ras 电话簿存储在一个简单的 ini 文件中，可以在以下位置找到

**C:\Documents and Settings\All Users\Application Data\Microsoft\Network\Connections\Pbk\rasphone.pbk**

您可以在您的计算机上准备这样一个文件，然后通过简单地将其复制到指定路径（或将其内容附加到现有路径）来将该文件部署给客户。要在“网络连接”面板中显示新连接，只需刷新资源管理器的视图（通过*F5*键），甚至不需要重新启动资源管理器。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2015-05-26T06:13:26.550

我知道这不是“批准”的方法。但我多年来一直这样做没有问题。

在您自己的计算机上设置 vpn，确保其中只有一个 VPN 设置，否则您会将它们全部部署给您的员工。在您的 PC 上找到 rasphone.pbk 文件，将其重命名为 myVPN.pbk（或任何您想要的）并使用 Altiris 或其他任何东西将其部署到每个人的桌面。

当他们单击它时，它会打开并正常工作。作为一个额外的好处，将它放到网上并告诉您的员工右键单击该链接并将其保存到他们的桌面，然后单击它。自从我第一次发现它在 10 年前大部分时间都有效以来，我们的大学一直在这样做。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-25T22:00:37.580

您需要一个批处理脚本来连接到在基本计算机上设置的 VPN。不久前我有一个类似的问题要处理，我发现[这个](http://www.msfn.org/board/Connect-VPN-cmdexe-vi-t113128.html)和[这个](http://technet.microsoft.com/en-us/library/cc779544.aspx)链接很有帮助。我过去曾使用过此解决方案（第一个链接），因此它可以工作，但我不再拥有批处理脚本。

1.) 在脚本中包含 rasphone.pbk（在 XP 中的 C:\Documents and Settings\All Users\Application Data\Microsoft\Network\Connections\Pbk\ 下。在 C:\Users\USERNAME\AppData\Roaming\Microsoft\ 下Vista 中的网络\连接\Pbk）

2.）将工作目录设置为变量名，以便您可以返回它

3.) 使用基于用户配置文件的变量名移动到存储电话簿的目录

4.) 测试电话簿是否存在，如果存在，将其重命名为 rasphone.pbk.bk，然后从脚本位置（保存在变量中）将新电话簿复制到新位置。

5.) 连接。

6.) 准备好后，断开电话簿并将您的设置覆盖在原始文件中（如果存在），否则只需删除电话簿。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2012-07-06T03:13:25.207

我成为[CMAK](http://www.isaserver.org/img/upl/vpnkitbeta2/cmak.htm)会有所帮助（连接管理器管理员套件）

# c++ - 如何验证字符串是否是 C++ 中的有效 IPv4 地址？

> ID：318236
> 
> 赞同：52
> 
> 时间：2008-11-25T17:37:29.950
> 
> 标签：c++, string

我不需要验证 IP 地址是否可访问或类似的东西。我只想验证该字符串是否为点分四线 (xxx.xxx.xxx.xxx) IPv4 格式，其中 xxx 介于 0 和 255 之间。

* * *

## 回答 #1

> 赞同：57
> 
> 时间：2008-11-25T17:54:30.743

您可能需要[inet_pton](http://man7.org/linux/man-pages/man3/inet_pton.3.html)，它为无效的 AF 参数返回 -1，为无效地址返回 0，为有效 IP 地址返回 +1。它支持 IPv4 和未来的 IPv6 地址。如果您仍需要编写自己的 IP 地址处理程序，请记住标准的 32 位十六进制数字是有效的 IP 地址。并非所有 IPv4 地址都采用点分十进制表示法。

此函数既验证地址，也允许您在相关的套接字调用中使用相同的地址。

* * *

## 回答 #2

> 赞同：51
> 
> 时间：2009-10-27T11:23:00.597

[Boost.Asio](http://www.boost.org/doc/libs/release/doc/html/boost_asio.html)提供类[ip::address](http://www.boost.org/doc/libs/release/doc/html/boost_asio/reference/ip__address.html)。如果您只想验证字符串，可以像这样使用它：

```
std::string ipAddress = "127.0.0.1";
boost::system::error_code ec;
boost::asio::ip::address::from_string( ipAddress, ec );
if ( ec )
    std::cerr << ec.message( ) << std::endl; 
```

这也适用于十六进制和八进制四边形。这也是一个更便携的解决方案。

* * *

## 回答 #3

> 赞同：45
> 
> 时间：2008-12-02T20:12:44.317

我确定的解决方案是：

```
#include <arpa/inet.h>
// ...
bool Config::validateIpAddress(const string &ipAddress)
{
    struct sockaddr_in sa;
    int result = inet_pton(AF_INET, ipAddress.c_str(), &(sa.sin_addr));
    return result != 0;
} 
```

这适用于其他答案中提到的大多数情况。它无法识别八进制或十六进制格式的 IP 地址，但这对我的应用程序来说是可以接受的。

* * *

## 回答 #4

> 赞同：17
> 
> 时间：2008-11-25T18:12:10.193

这看起来看似简单，但有一些陷阱。例如，在前面的答案中发布的许多解决方案都假设四边形以 10 为底 - 但是以零开头的四边形**必须**被视为以 8 为底（八进制）的数字，因此例如任何以零开头的四边形部分和包含数字 8 或 9 无效。即，IP 号`192.168.1.010`不是*但* `192.168.1.10`实际上是`192.168.1.8`，并且 IP 号`192.168.019.14`无效，因为第三个四边形包含无效的 8 位数字 9。

我强烈鼓励您使用包含在您的操作系统或编译器环境中的套接字库提供的功能。

编辑：（认为它是隐含的，但是）当然，您也可以使用十六进制四边形，la`192.168.1.0x0A`表示 192.168.1.10，当然您可以愉快地使用大小写混合和匹配您的虐待狂内容，la`0xC0.0xa8.1.010`表示 192.168 .1.8\. 如果您想玩得开心，请尝试使用 ping 的一些示例。这在跨平台上工作得很好（不久前在 Linux、NetBSD 和 Win32 下测试过。）

响应 KaluSingh Gabbar 的请求进一步编辑：例如，您可以指定`192.168.1.10`as`0xc0a8010a`并且它仍然代表一个有效的 IP 号，a la：

```
[mihailim@home ~]$ ping 0xc0a8010a
PING 0xc0a8010a (192.168.1.10) 56(84) bytes of data.
^C
--- 0xc0a8010a ping statistics ---
3 packets transmitted, 0 received, 100% packet loss, time 2479ms 
```

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2008-11-25T18:07:48.203

这是一种简单的方法。

```
bool IsIPAddress(std::string & ipaddr)
    {    

    StringTokenizer quads(ipaddr,".");

    if (quads.countTokens() != 4) return false;

    for (int i=0; i < 4; i++)
      {
      std::string quad = quads.nextToken();
      for (int j=0; j < quad.length(); j++
         if (!isdigit(quad[j])) return false;

      int quad = atoi(quads.GetTokenAt(i));
      if (quad < 0) || (quad > 255)) return false;
      }

    return true;
    } 
```

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2012-10-22T10:11:42.050

如果您在 Windows 上，您可以使用`WSAStringToAddress`并基于我们知道的返回值，如果传递的参数是有效的 IP 与否。这支持从 Windows 2000 开始的 IPv4 和 IPv6。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2018-05-26T04:35:42.003

您可以像这样编写自己的函数：

```
bool isValidIPv4(const char *IPAddress)
{
   unsigned char a,b,c,d;
   return sscanf(IPAddress,"%d.%d.%d.%d", &a, &b, &c, &d) == 4;
} 
```

`sscanf()`在某些情况下`sprintf()`非常有用。:))

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-11-25T17:48:00.053

[Boost.Regex](http://www.boost.org/doc/libs/1_37_0/libs/regex/doc/html/index.html)是合适的。

```
bool validate_ip_address(const std::string& s)
{
   static const boost::regex e("\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}");
   return regex_match(s, e);
} 
```

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-11-25T17:50:16.930

如果您想自己编写而不是使用库，那么

atoi() 将字符转换为整数将让您测试每个数字的范围，以及“。”之间的一些 strcmp。您还可以做一些快速检查，例如字符串的长度（应小于 16 个字符（不包括空终止符）、点数等。

但是，使用现有代码可能要容易得多。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2009-11-08T00:09:45.933

我只使用 C stdlib 函数做了同样的事情，尽管它不支持上面提到的八进制四边形，但这不应该是问题，我可以轻松添加该部分并将其提供给您。作为一个初学者（学生），直到现在我才知道可以在你的 ip 中获得一个八进制数。我想它一定是小数。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2012-04-17T22:48:07.087

这是验证给定 IPV4 地址的 C 程序。我假设 IP 地址是十进制格式。请告诉我你对此的看法。

```
 // strTokenFunction.cpp : Check if the specified address is a valid numeric IP address.
  // This function is equavalent to the IPAddress.TryParse() method in C#

#include "stdafx.h"
#include <stdio.h>
#include <conio.h>
#include <string.h>

bool isValidIpAddress(char *st)
{
    int num, i, len;
    char *ch;

    //counting number of quads present in a given IP address
    int quadsCnt=0;

    printf("Split IP: \"%s\"\n", st);

    len = strlen(st);

    //  Check if the string is valid
    if(len<7 || len>15)
        return false;

    ch = strtok(st, ".");

    while (ch != NULL) 
    {
        quadsCnt++;
        printf("Quald %d is %s\n", quadsCnt, ch);

        num = 0;
        i = 0;

        //  Get the current token and convert to an integer value
        while(ch[i]!='\0')
        {
            num = num*10;
            num = num+(ch[i]-'0');
            i++;
        }

        if(num<0 || num>255)
        {
            printf("Not a valid ip\n");
            return false;
        }

        if( (quadsCnt == 1 && num == 0) || (quadsCnt == 4 && num == 0))
        {
            printf("Not a valid ip, quad: %d AND/OR quad:%d is zero\n", quadsCnt, quadsCnt);
            return false;
        }

        ch = strtok(NULL, ".");
    }

    //  Check the address string, should be n.n.n.n format
    if(quadsCnt!=4)
    {
        return false;
    }

    //  Looks like a valid IP address
    return true;
}

int main() 
{
    char st[] = "192.255.20.30";
    //char st[] = "255.255.255.255";
    //char st[] = "0.255.255.0";

    if(isValidIpAddress(st))
    {
        printf("The given IP is a valid IP address\n"); 
    }
    else
    {
        printf("The given IP is not a valid IP address\n");
    }
} 
```

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-11-25T17:48:56.823

您可以使用 boost tokenizer 和 boost char_separator 轻松完成此操作。

[http://www.boost.org/doc/libs/1_37_0/libs/tokenizer/char_separator.htm](http://www.boost.org/doc/libs/1_37_0/libs/tokenizer/char_separator.htm)

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2008-11-25T17:50:37.163

如果您不想要 Boost 或 TR1 的开销，您可以搜索点并检查它们之间的字符是否是从 0 到 255 的数字。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2011-07-11T20:11:43.370

```
vector<string> &split(const string &s, char delim, vector<string> &elems) {
    stringstream ss(s);
    string item;
    while(getline(ss, item, delim)) {
       elems.push_back(item);
    }
    return elems;
}

vector<string> split(const string &s, char delim) {
   vector<string> elems;
   return split(s, delim, elems);
}

bool isIPAddress(string  ipaddr){

    if (ipaddr.length()){
            vector<string> _ip=split(ipaddr,'.');
            if (_ip.size()==4){
                    for (int i=0; i < 4; i++){
                            for (int j=0; j < _ip[i].length(); j++)
                                    if (!isdigit(_ip[i][j])) return false;
                            if ((atoi(_ip[i].c_str()) < 0) || (atoi(_ip[i].c_str()) > 255)) return false;
                    }
            return true;
            }
    }
    return false;
 } 
```

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2013-12-24T11:48:04.710

一些小的修复以将某些情况修复为 127..0.1、127.0.0.. 并删除空格（如果有）：

```
 #include <iostream>
    #include <vector>
    #include <string>
    #include <sstream>
    #include <algorithm>
    #include <iterator>
    #include <stdio.h>

    using namespace std;

    vector split(char* str, char delimiter)
    {
        const string data(str);
        vector elements;
        string element;
        for(int i = 0; i  0) {//resolve problem: 127.0..1
                    elements.push_back(element);
                    element.clear();
                }
            }
            else if (data[i] != ' ')
            {
                element += data[i];
            }

        }
        if (element.length() > 0)//resolve problem: 127.0..1
            elements.push_back(element);
        return elements;
    }

    bool toInt(const string& str, int* result)
    {
        if (str.find_first_not_of("0123456789") != string::npos)
            return false;

        stringstream stream(str);
        stream >> *result; // Should probably check the return value here
        return true;
    }

    /** ipResult: the good ip address, e.g. spaces are removed */
    bool validate(char* ip, string *ipResult)
    {
        const static char delimiter = '.';
        const vector parts = split(ip, delimiter);
        *ipResult = "";
        if (parts.size() != 4)
            return NULL;

        for(int i = 0; i  255)
                return NULL;

            if (i == 3) {
                *ipResult += parts[i];
            } else {
                *ipResult += (parts[i] +".");
            }

        }
        return true;
    }

    int main()
    {
        string ip;
        printf("right %d\n", validate("127.0.0.1", &ip));
        printf("good ip: %s\n", ip.c_str());
        printf("wrong %d\n", validate("127.0.0.-1", &ip));
        printf("good ip: %s\n", ip.c_str());
        printf("wrong %d\n", validate("127..0.1", &ip));
        printf("good ip: %s\n", ip.c_str());
        printf("wrong %d\n", validate("...0.1", &ip));
        printf("good ip: %s\n", ip.c_str());
        printf("wrong %d\n", validate("127.0.0.", &ip));
        printf("good ip: %s\n", ip.c_str());
        printf("right %d\n", validate("192.168.170.99", &ip));
        printf("good ip: %s\n", ip.c_str());
        printf("right %d\n", validate("127.0 .0  .1", &ip));
        printf("good ip: %s\n", ip.c_str());
        printf("\n");

        system("pause");

        return 0;
    } 
```

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2019-01-12T08:25:02.927

如果您希望以通常的形式（ , 等...）接收 IP 地址，`8.8.8.8`那么`192.168.1.1`我编写了以下代码来扩展 Bjorn 的答案：

```
void validateIP(const std::string &IPv4_address)
{
    boost::system::error_code error_code;
    auto raw_ipv4_address = boost::asio::ip::address::from_string(IPv4_address, error_code);
    if (error_code)
    {
        throw std::invalid_argument(error_code.message());
    }

    std::string raw_to_string_form = raw_ipv4_address.to_string();
    if (raw_to_string_form.compare(IPv4_address))
    {
        throw std::invalid_argument("Input IPv4 address is invalid");
    }
} 
```

原因是，如果您传递一个 IP，例如 8.88.8 或 12345 *(decimal form)*，Bjorn 的回答不会引发错误。*（至少对于 boost 1.68）* 我的代码将任何形式转换为 Boost 中的内部结构，然后将其转换回点分十进制格式，然后我们将其与我们收到的第一个 IP 进行比较，看看它们是否相等，如果不相等，我们确定输入不是我们想要的方式。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2019-05-24T17:10:45.677

```
void validate_ip_address(const std::string& s) {
    const std::string number_0_255 = "((([0-9])|([1-9][0-9])|(1[0-9][0-9]|2[0-4][0-9]|25[0-5])){1})";
    const std::string dot = "(\\.){1}";
    static const boost::regex e(number_0_255 + dot + number_0_255 + dot + number_0_255 + dot + number_0_255);
    if (!regex_match(s, e)) {
        throw std::runtime_error(std::string("Uncorrect address IP: ") + s);
    }
} 
```

# java - 如何从 Java 设置环境变量？

> ID：318239
> 
> 赞同：354
> 
> 时间：2008-11-25T17:38:19.263
> 
> 标签：java, environment-variables

如何从 Java 设置环境变量？我看到我可以使用[`ProcessBuilder`](http://docs.oracle.com/javase/7/docs/api/java/lang/ProcessBuilder.html). 不过，我有几个子进程要启动，所以我宁愿修改当前进程的环境并让子进程继承它。

有一个`System.getenv(String)`用于获取单个环境变量的方法。我还可以`Map`使用`System.getenv()`. 但是，调用`put()`它`Map`会引发`UnsupportedOperationException`- 显然它们意味着环境是只读的。而且，没有`System.setenv()`.

那么，有没有办法在当前运行的进程中设置环境变量呢？如果是这样，怎么做？如果不是，原因是什么？（是不是因为这是 Java，因此我不应该做邪恶的不可移植的过时的事情，比如触摸我的环境？）如果不是，任何关于管理环境变量更改的好建议，我需要提供给几个子进程？

* * *

## 回答 #1

> 赞同：257
> 
> 时间：2011-08-26T08:17:03.520

对于需要为单元测试设置特定环境值的场景，您可能会发现以下 hack 很有用。它将更改整个 JVM 的环境变量（因此请确保在测试后重置任何更改），但不会改变您的系统环境。

我发现 Edward Campbell 和anonymous 的两个肮脏黑客的组合效果最好，因为其中一个在linux下不起作用，一个在windows 7下不起作用。所以为了获得一个多平台的邪恶黑客，我将它们结合起来：

```
protected static void setEnv(Map<String, String> newenv) throws Exception {
  try {
    Class<?> processEnvironmentClass = Class.forName("java.lang.ProcessEnvironment");
    Field theEnvironmentField = processEnvironmentClass.getDeclaredField("theEnvironment");
    theEnvironmentField.setAccessible(true);
    Map<String, String> env = (Map<String, String>) theEnvironmentField.get(null);
    env.putAll(newenv);
    Field theCaseInsensitiveEnvironmentField = processEnvironmentClass.getDeclaredField("theCaseInsensitiveEnvironment");
    theCaseInsensitiveEnvironmentField.setAccessible(true);
    Map<String, String> cienv = (Map<String, String>)     theCaseInsensitiveEnvironmentField.get(null);
    cienv.putAll(newenv);
  } catch (NoSuchFieldException e) {
    Class[] classes = Collections.class.getDeclaredClasses();
    Map<String, String> env = System.getenv();
    for(Class cl : classes) {
      if("java.util.Collections$UnmodifiableMap".equals(cl.getName())) {
        Field field = cl.getDeclaredField("m");
        field.setAccessible(true);
        Object obj = field.get(env);
        Map<String, String> map = (Map<String, String>) obj;
        map.clear();
        map.putAll(newenv);
      }
    }
  }
} 
```

这就像一个魅力。完全归功于这些黑客的两位作者。

* * *

## 回答 #2

> 赞同：101
> 
> 时间：2008-11-25T17:45:04.037

> （是不是因为这是 Java，所以我不应该做邪恶的不可移植的过时的事情，比如触摸我的环境？）

我想你已经一针见血了。

减轻负担的一种可能方法是分解出一种方法

```
void setUpEnvironment(ProcessBuilder builder) {
    Map<String, String> env = builder.environment();
    // blah blah
} 
```

并`ProcessBuilder`在启动它们之前通过它。

此外，您可能已经知道这一点，但您可以使用相同的`ProcessBuilder`. 因此，如果您的子流程相同，则无需一遍又一遍地进行此设置。

* * *

## 回答 #3

> 赞同：81
> 
> 时间：2009-01-30T19:24:51.463

```
public static void set(Map<String, String> newenv) throws Exception {
    Class[] classes = Collections.class.getDeclaredClasses();
    Map<String, String> env = System.getenv();
    for(Class cl : classes) {
        if("java.util.Collections$UnmodifiableMap".equals(cl.getName())) {
            Field field = cl.getDeclaredField("m");
            field.setAccessible(true);
            Object obj = field.get(env);
            Map<String, String> map = (Map<String, String>) obj;
            map.clear();
            map.putAll(newenv);
        }
    }
} 
```

或者根据 thejoshwolfe 的建议添加/更新单个 var 并删除循环。

```
@SuppressWarnings({ "unchecked" })
  public static void updateEnv(String name, String val) throws ReflectiveOperationException {
    Map<String, String> env = System.getenv();
    Field field = env.getClass().getDeclaredField("m");
    field.setAccessible(true);
    ((Map<String, String>) field.get(env)).put(name, val);
  } 
```

* * *

## 回答 #4

> 赞同：29
> 
> 时间：2016-11-18T16:38:29.227

# 仅限 Linux/MacOS

设置单个环境变量（基于 Edward Campbell 的回答）：

```
public static void setEnv(String key, String value) {
    try {
        Map<String, String> env = System.getenv();
        Class<?> cl = env.getClass();
        Field field = cl.getDeclaredField("m");
        field.setAccessible(true);
        Map<String, String> writableEnv = (Map<String, String>) field.get(env);
        writableEnv.put(key, value);
    } catch (Exception e) {
        throw new IllegalStateException("Failed to set environment variable", e);
    }
} 
```

**用法：**

首先，将该方法放在您想要的任何类中，例如 SystemUtil。然后静态调用它：

```
SystemUtil.setEnv("SHELL", "/bin/bash"); 
```

如果你`System.getenv("SHELL")`在这之后打电话，你会`"/bin/bash"`回来的。

* * *

## 回答 #5

> 赞同：22
> 
> 时间：2010-12-20T07:45:41.723

```
// this is a dirty hack - but should be ok for a unittest.
private void setNewEnvironmentHack(Map<String, String> newenv) throws Exception
{
  Class<?> processEnvironmentClass = Class.forName("java.lang.ProcessEnvironment");
  Field theEnvironmentField = processEnvironmentClass.getDeclaredField("theEnvironment");
  theEnvironmentField.setAccessible(true);
  Map<String, String> env = (Map<String, String>) theEnvironmentField.get(null);
  env.clear();
  env.putAll(newenv);
  Field theCaseInsensitiveEnvironmentField = processEnvironmentClass.getDeclaredField("theCaseInsensitiveEnvironment");
  theCaseInsensitiveEnvironmentField.setAccessible(true);
  Map<String, String> cienv = (Map<String, String>) theCaseInsensitiveEnvironmentField.get(null);
  cienv.clear();
  cienv.putAll(newenv);
} 
```

* * *

## 回答 #6

> 赞同：18
> 
> 时间：2014-03-11T02:45:51.313

在 Android 上，接口通过 Libcore.os 作为一种隐藏的 API 公开。

```
Libcore.os.setenv("VAR", "value", bOverwrite);
Libcore.os.getenv("VAR")); 
```

Libcore 类以及接口 OS 是公共的。只是缺少类声明，需要向链接器显示。无需将类添加到应用程序中，但如果包含它也没有什么坏处。

```
package libcore.io;

public final class Libcore {
    private Libcore() { }

    public static Os os;
}

package libcore.io;

public interface Os {
    public String getenv(String name);
    public void setenv(String name, String value, boolean overwrite) throws ErrnoException;
} 
```

* * *

## 回答 #7

> 赞同：11
> 
> 时间：2016-06-28T10:35:05.743

这是@paul-blair 的答案转换为Java 的组合，其中包括paul blair 指出的一些清理以及@pushy 的代码中似乎存在的一些错误，该代码由@Edward Campbell 和匿名组成。

我无法强调这段代码应该只在测试中使用多少，而且非常hacky。但是对于需要在测试中设置环境的情况，这正是我所需要的。

这还包括我的一些小改动，允许代码在两个 Windows 上运行

```
java version "1.8.0_92"
Java(TM) SE Runtime Environment (build 1.8.0_92-b14)
Java HotSpot(TM) 64-Bit Server VM (build 25.92-b14, mixed mode) 
```

以及运行的 Centos

```
openjdk version "1.8.0_91"
OpenJDK Runtime Environment (build 1.8.0_91-b14)
OpenJDK 64-Bit Server VM (build 25.91-b14, mixed mode) 
```

实施：

```
/**
 * Sets an environment variable FOR THE CURRENT RUN OF THE JVM
 * Does not actually modify the system's environment variables,
 *  but rather only the copy of the variables that java has taken,
 *  and hence should only be used for testing purposes!
 * @param key The Name of the variable to set
 * @param value The value of the variable to set
 */
@SuppressWarnings("unchecked")
public static <K,V> void setenv(final String key, final String value) {
    try {
        /// we obtain the actual environment
        final Class<?> processEnvironmentClass = Class.forName("java.lang.ProcessEnvironment");
        final Field theEnvironmentField = processEnvironmentClass.getDeclaredField("theEnvironment");
        final boolean environmentAccessibility = theEnvironmentField.isAccessible();
        theEnvironmentField.setAccessible(true);

        final Map<K,V> env = (Map<K, V>) theEnvironmentField.get(null);

        if (SystemUtils.IS_OS_WINDOWS) {
            // This is all that is needed on windows running java jdk 1.8.0_92
            if (value == null) {
                env.remove(key);
            } else {
                env.put((K) key, (V) value);
            }
        } else {
            // This is triggered to work on openjdk 1.8.0_91
            // The ProcessEnvironment$Variable is the key of the map
            final Class<K> variableClass = (Class<K>) Class.forName("java.lang.ProcessEnvironment$Variable");
            final Method convertToVariable = variableClass.getMethod("valueOf", String.class);
            final boolean conversionVariableAccessibility = convertToVariable.isAccessible();
            convertToVariable.setAccessible(true);

            // The ProcessEnvironment$Value is the value fo the map
            final Class<V> valueClass = (Class<V>) Class.forName("java.lang.ProcessEnvironment$Value");
            final Method convertToValue = valueClass.getMethod("valueOf", String.class);
            final boolean conversionValueAccessibility = convertToValue.isAccessible();
            convertToValue.setAccessible(true);

            if (value == null) {
                env.remove(convertToVariable.invoke(null, key));
            } else {
                // we place the new value inside the map after conversion so as to
                // avoid class cast exceptions when rerunning this code
                env.put((K) convertToVariable.invoke(null, key), (V) convertToValue.invoke(null, value));

                // reset accessibility to what they were
                convertToValue.setAccessible(conversionValueAccessibility);
                convertToVariable.setAccessible(conversionVariableAccessibility);
            }
        }
        // reset environment accessibility
        theEnvironmentField.setAccessible(environmentAccessibility);

        // we apply the same to the case insensitive environment
        final Field theCaseInsensitiveEnvironmentField = processEnvironmentClass.getDeclaredField("theCaseInsensitiveEnvironment");
        final boolean insensitiveAccessibility = theCaseInsensitiveEnvironmentField.isAccessible();
        theCaseInsensitiveEnvironmentField.setAccessible(true);
        // Not entirely sure if this needs to be casted to ProcessEnvironment$Variable and $Value as well
        final Map<String, String> cienv = (Map<String, String>) theCaseInsensitiveEnvironmentField.get(null);
        if (value == null) {
            // remove if null
            cienv.remove(key);
        } else {
            cienv.put(key, value);
        }
        theCaseInsensitiveEnvironmentField.setAccessible(insensitiveAccessibility);
    } catch (final ClassNotFoundException | NoSuchMethodException | IllegalAccessException | InvocationTargetException e) {
        throw new IllegalStateException("Failed setting environment variable <"+key+"> to <"+value+">", e);
    } catch (final NoSuchFieldException e) {
        // we could not find theEnvironment
        final Map<String, String> env = System.getenv();
        Stream.of(Collections.class.getDeclaredClasses())
                // obtain the declared classes of type $UnmodifiableMap
                .filter(c1 -> "java.util.Collections$UnmodifiableMap".equals(c1.getName()))
                .map(c1 -> {
                    try {
                        return c1.getDeclaredField("m");
                    } catch (final NoSuchFieldException e1) {
                        throw new IllegalStateException("Failed setting environment variable <"+key+"> to <"+value+"> when locating in-class memory map of environment", e1);
                    }
                })
                .forEach(field -> {
                    try {
                        final boolean fieldAccessibility = field.isAccessible();
                        field.setAccessible(true);
                        // we obtain the environment
                        final Map<String, String> map = (Map<String, String>) field.get(env);
                        if (value == null) {
                            // remove if null
                            map.remove(key);
                        } else {
                            map.put(key, value);
                        }
                        // reset accessibility
                        field.setAccessible(fieldAccessibility);
                    } catch (final ConcurrentModificationException e1) {
                        // This may happen if we keep backups of the environment before calling this method
                        // as the map that we kept as a backup may be picked up inside this block.
                        // So we simply skip this attempt and continue adjusting the other maps
                        // To avoid this one should always keep individual keys/value backups not the entire map
                        LOGGER.info("Attempted to modify source map: "+field.getDeclaringClass()+"#"+field.getName(), e1);
                    } catch (final IllegalAccessException e1) {
                        throw new IllegalStateException("Failed setting environment variable <"+key+"> to <"+value+">. Unable to access field!", e1);
                    }
                });
    }
    LOGGER.info("Set environment variable <"+key+"> to <"+value+">. Sanity Check: "+System.getenv(key));
} 
```

* * *

## 回答 #8

> 赞同：9
> 
> 时间：2013-12-07T03:22:15.220

事实证明，@pushy/@anonymous/@Edward Campbell 的解决方案不适用于 Android，因为 Android 并不是真正的 Java。具体来说，Android 根本没有`java.lang.ProcessEnvironment`。但事实证明它在 Android 中更容易，您只需要对 POSIX 进行 JNI 调用`setenv()`：

在 C/JNI 中：

```
JNIEXPORT jint JNICALL Java_com_example_posixtest_Posix_setenv
  (JNIEnv* env, jclass clazz, jstring key, jstring value, jboolean overwrite)
{
    char* k = (char *) (*env)->GetStringUTFChars(env, key, NULL);
    char* v = (char *) (*env)->GetStringUTFChars(env, value, NULL);
    int err = setenv(k, v, overwrite);
    (*env)->ReleaseStringUTFChars(env, key, k);
    (*env)->ReleaseStringUTFChars(env, value, v);
    return err;
} 
```

在 Java 中：

```
public class Posix {

    public static native int setenv(String key, String value, boolean overwrite);

    private void runTest() {
        Posix.setenv("LD_LIBRARY_PATH", "foo", true);
    }
} 
```

* * *

## 回答 #9

> 赞同：8
> 
> 时间：2017-03-22T23:06:12.657

像大多数找到这个线程的人一样，我正在编写一些单元测试并且需要修改环境变量以设置正确的条件以运行测试。但是，我发现投票最多的答案存在一些问题和/或非常神秘或过于复杂。希望这将帮助其他人更快地解决问题。

首先，我终于发现@Hubert Grzeskowiak 的解决方案是最简单的，它对我有用。我希望我能先来那个。它基于@Edward Campbell 的回答，但没有复杂的 for 循环搜索。

但是，我从@pushy 的解决方案开始，它得到了最多的支持。它是@anonymous 和@Edward Campbell 的组合。@pushy 声称这两种方法都需要涵盖 Linux 和 Windows 环境。我在 OS X 下运行，发现两者都可以工作（一旦解决了@anonymous 方法的问题）。正如其他人所指出的，此解决方案在大多数情况下都有效，但并非全部。

我认为大多数混乱的根源来自@anonymous 在“环境”字段上运行的解决方案。查看[ProcessEnvironment](http://grepcode.com/file/repository.grepcode.com/java/root/jdk/openjdk/6-b14/java/lang/ProcessEnvironment.java)结构的定义，'theEnvironment' 不是 Map<String,String>，而是 Map<Variable,Value>。清除地图工作正常，但 putAll 操作将地图重建为 Map<String, String>，这可能会在后续操作使用需要 Map<Variable,Value> 的普通 API 对数据结构进行操作时导致问题。此外，访问/删除单个元素也是一个问题。解决方案是通过“theUnmodifiableEnvironment”间接访问“theEnvironment”。但由于这是一个类型[UnmodifiableMap](http://grepcode.com/file/repository.grepcode.com/java/root/jdk/openjdk/8u40-b25/java/util/Collections.java?av=f#1439)访问必须通过 UnmodifiableMap 类型的私有变量“m”来完成。请参阅下面代码中的 getModifiableEnvironmentMap2。

在我的情况下，我需要为我的测试删除一些环境变量（其他的应该保持不变）。然后我想在测试后将环境变量恢复到之前的状态。下面的例程可以直接进行。我在 OS X 上测试了 getModifiableEnvironmentMap 的两个版本，并且两者都可以等效地工作。尽管基于此线程中的评论，但根据环境，一个可能比另一个更好。

注意：我没有包括对“theCaseInsensitiveEnvironmentField”的访问，因为这似乎是特定于 Windows 的，我无法对其进行测试，但添加它应该是直截了当的。

```
private Map<String, String> getModifiableEnvironmentMap() {
    try {
        Map<String,String> unmodifiableEnv = System.getenv();
        Class<?> cl = unmodifiableEnv.getClass();
        Field field = cl.getDeclaredField("m");
        field.setAccessible(true);
        Map<String,String> modifiableEnv = (Map<String,String>) field.get(unmodifiableEnv);
        return modifiableEnv;
    } catch(Exception e) {
        throw new RuntimeException("Unable to access writable environment variable map.");
    }
}

private Map<String, String> getModifiableEnvironmentMap2() {
    try {
        Class<?> processEnvironmentClass = Class.forName("java.lang.ProcessEnvironment");
        Field theUnmodifiableEnvironmentField = processEnvironmentClass.getDeclaredField("theUnmodifiableEnvironment");
        theUnmodifiableEnvironmentField.setAccessible(true);
        Map<String,String> theUnmodifiableEnvironment = (Map<String,String>)theUnmodifiableEnvironmentField.get(null);

        Class<?> theUnmodifiableEnvironmentClass = theUnmodifiableEnvironment.getClass();
        Field theModifiableEnvField = theUnmodifiableEnvironmentClass.getDeclaredField("m");
        theModifiableEnvField.setAccessible(true);
        Map<String,String> modifiableEnv = (Map<String,String>) theModifiableEnvField.get(theUnmodifiableEnvironment);
        return modifiableEnv;
    } catch(Exception e) {
        throw new RuntimeException("Unable to access writable environment variable map.");
    }
}

private Map<String, String> clearEnvironmentVars(String[] keys) {

    Map<String,String> modifiableEnv = getModifiableEnvironmentMap();

    HashMap<String, String> savedVals = new HashMap<String, String>();

    for(String k : keys) {
        String val = modifiableEnv.remove(k);
        if (val != null) { savedVals.put(k, val); }
    }
    return savedVals;
}

private void setEnvironmentVars(Map<String, String> varMap) {
    getModifiableEnvironmentMap().putAll(varMap);   
}

@Test
public void myTest() {
    String[] keys = { "key1", "key2", "key3" };
    Map<String, String> savedVars = clearEnvironmentVars(keys);

    // do test

    setEnvironmentVars(savedVars);
} 
```

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2008-11-25T20:59:02.210

在网上四处寻找，似乎可以使用 JNI 来做到这一点。然后，您必须从 C 中调用 putenv()，并且（可能）必须以在 Windows 和 UNIX 上都有效的方式来执行此操作。

如果所有这些都可以完成，那么 Java 本身支持它肯定不会太难，而不是让我穿上一件直截了当的夹克。

一位在其他地方讲 Perl 的朋友建议这是因为环境变量是进程全局的，而 Java 正在努力实现良好的隔离以实现良好的设计。

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2013-09-27T00:01:53.480

在上面尝试了 pushy 的答案，它在大多数情况下都有效。但是，在某些情况下，我会看到这个例外：

```
java.lang.String cannot be cast to java.lang.ProcessEnvironment$Variable 
```

当方法被多次调用时会发生这种情况，由于某些内部类的实现`ProcessEnvironment.`如果`setEnv(..)`多次调用该方法，当从`theEnvironment`映射中检索键时，它们现在是字符串（已放入第一次调用 ) 时作为字符串，`setEnv(...)`不能转换为映射的泛型类型，`Variable,`它是的私有内部类`ProcessEnvironment.`

下面是一个固定版本（在 Scala 中）。希望延续到 Java 中并不太难。

```
def setEnv(newenv: java.util.Map[String, String]): Unit = {
  try {
    val processEnvironmentClass = JavaClass.forName("java.lang.ProcessEnvironment")
    val theEnvironmentField = processEnvironmentClass.getDeclaredField("theEnvironment")
    theEnvironmentField.setAccessible(true)

    val variableClass = JavaClass.forName("java.lang.ProcessEnvironment$Variable")
    val convertToVariable = variableClass.getMethod("valueOf", classOf[java.lang.String])
    convertToVariable.setAccessible(true)

    val valueClass = JavaClass.forName("java.lang.ProcessEnvironment$Value")
    val convertToValue = valueClass.getMethod("valueOf", classOf[java.lang.String])
    convertToValue.setAccessible(true)

    val sampleVariable = convertToVariable.invoke(null, "")
    val sampleValue = convertToValue.invoke(null, "")
    val env = theEnvironmentField.get(null).asInstanceOf[java.util.Map[sampleVariable.type, sampleValue.type]]
    newenv.foreach { case (k, v) => {
        val variable = convertToVariable.invoke(null, k).asInstanceOf[sampleVariable.type]
        val value = convertToValue.invoke(null, v).asInstanceOf[sampleValue.type]
        env.put(variable, value)
      }
    }

    val theCaseInsensitiveEnvironmentField = processEnvironmentClass.getDeclaredField("theCaseInsensitiveEnvironment")
    theCaseInsensitiveEnvironmentField.setAccessible(true)
    val cienv = theCaseInsensitiveEnvironmentField.get(null).asInstanceOf[java.util.Map[String, String]]
    cienv.putAll(newenv);
  }
  catch {
    case e : NoSuchFieldException => {
      try {
        val classes = classOf[java.util.Collections].getDeclaredClasses
        val env = System.getenv()
        classes foreach (cl => {
          if("java.util.Collections$UnmodifiableMap" == cl.getName) {
            val field = cl.getDeclaredField("m")
            field.setAccessible(true)
            val map = field.get(env).asInstanceOf[java.util.Map[String, String]]
            // map.clear() // Not sure why this was in the code. It means we need to set all required environment variables.
            map.putAll(newenv)
          }
        })
      } catch {
        case e2: Exception => e2.printStackTrace()
      }
    }
    case e1: Exception => e1.printStackTrace()
  }
} 
```

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2021-05-21T10:25:27.363

有三个库可以在单元测试期间执行此操作。

有 Stefan Birkner 的系统规则和系统 Lambda - [https://www.baeldung.com/java-system-rules-junit](https://www.baeldung.com/java-system-rules-junit)允许您执行以下操作：

```
public class JUnitTest {

    @Rule
    public EnvironmentVariables environmentVariables = new EnvironmentVariables();

    @Test
    public void someTest() {
        environmentVariables.set("SOME_VARIABLE", "myValue");

        // now System.getenv does what you want
    }
} 
```

或对于 System-Lambda：

```
@Test
void execute_code_with_environment_variables(
) throws Exception {
  List<String> values = withEnvironmentVariable("first", "first value")
    .and("second", "second value")
    .execute(() -> asList(
      System.getenv("first"),
      System.getenv("second")
    ));
  assertEquals(
    asList("first value", "second value"),
    values
  );
} 
```

上述功能也可通过系统存根作为 JUnit 5 扩展使用：

```
@ExtendWith(SystemStubsExtension.class)
class SomeTest {

    @SystemStub
    private EnvironmentVariables;

    @Test
    void theTest() {
        environmentVariables.set("SOME_VARIABLE", "myValue");

        // now System.getenv does what you want

    }

} 
```

System Stubs 向后兼容 System Lambda 和 System Rules，但支持 JUnit 5。

或者，还有 JUnit Pioneer - [https://github.com/junit-pioneer/junit-pioneer](https://github.com/junit-pioneer/junit-pioneer)，它允许在测试时通过注释设置环境变量。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2019-04-27T15:06:43.003

这是@pushy 的邪恶[答案](https://stackoverflow.com/a/7201825/727184)的 Kotlin 邪恶版本=)

```
@Suppress("UNCHECKED_CAST")
@Throws(Exception::class)
fun setEnv(newenv: Map<String, String>) {
    try {
        val processEnvironmentClass = Class.forName("java.lang.ProcessEnvironment")
        val theEnvironmentField = processEnvironmentClass.getDeclaredField("theEnvironment")
        theEnvironmentField.isAccessible = true
        val env = theEnvironmentField.get(null) as MutableMap<String, String>
        env.putAll(newenv)
        val theCaseInsensitiveEnvironmentField = processEnvironmentClass.getDeclaredField("theCaseInsensitiveEnvironment")
        theCaseInsensitiveEnvironmentField.isAccessible = true
        val cienv = theCaseInsensitiveEnvironmentField.get(null) as MutableMap<String, String>
        cienv.putAll(newenv)
    } catch (e: NoSuchFieldException) {
        val classes = Collections::class.java.getDeclaredClasses()
        val env = System.getenv()
        for (cl in classes) {
            if ("java.util.Collections\$UnmodifiableMap" == cl.getName()) {
                val field = cl.getDeclaredField("m")
                field.setAccessible(true)
                val obj = field.get(env)
                val map = obj as MutableMap<String, String>
                map.clear()
                map.putAll(newenv)
            }
        }
    } 
```

它至少在 macOS Mojave 中运行。

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2019-12-29T19:47:11.470

Tim Ryan 的回答对我有用......但我想要它用于 Groovy（例如 Spock 上下文）和 simplissimo：

```
import java.lang.reflect.Field

def getModifiableEnvironmentMap() {
    def unmodifiableEnv = System.getenv()
    Class cl = unmodifiableEnv.getClass()
    Field field = cl.getDeclaredField("m")
    field.accessible = true
    field.get(unmodifiableEnv)
}

def clearEnvironmentVars( def keys ) {
    def savedVals = [:]
    keys.each{ key ->
        String val = modifiableEnvironmentMap.remove(key)
        // thinking about it, I'm not sure why we need this test for null
        // but haven't yet done any experiments
        if( val != null ) {
            savedVals.put( key, val )
        }
    }
    savedVals
}

def setEnvironmentVars(Map varMap) {
    modifiableEnvironmentMap.putAll(varMap)
}

// pretend existing Env Var doesn't exist
def PATHVal1 = System.env.PATH
println "PATH val1 |$PATHVal1|"
String[] keys = ["PATH", "key2", "key3"]
def savedVars = clearEnvironmentVars(keys)
def PATHVal2 = System.env.PATH
println "PATH val2 |$PATHVal2|"

// return to reality
setEnvironmentVars(savedVars)
def PATHVal3 = System.env.PATH
println "PATH val3 |$PATHVal3|"
println "System.env |$System.env|"

// pretend a non-existent Env Var exists
setEnvironmentVars( [ 'key4' : 'key4Val' ])
println "key4 val |$System.env.key4|" 
```

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2021-10-19T12:30:36.620

在使用依赖于相关环境变量的本机代码（dll）的当前 Java 进程中设置环境变量，仅当您本机设置此环境变量时才有效。

此处的大多数示例都在更改 JVM 中的映射，但不会在本机工作。

我看到的一种方法是通过 JNI，它可能也有效。另一种方法是通过使用**Kernel32接口（仅限 Windows）来使用****JNA 平台**，例如：

 **```
private static void setEnv(String key, String value) {
    if(isWindows()) {
        if (!Kernel32.INSTANCE.SetEnvironmentVariable(key, value)) {
            System.err.println("Unable to set the environemnt variable: " + key);
        }
    }
} 
```

对于像操作系统这样的unix，可以使用**LibCAPI**接口，但没有尝试过。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2020-09-04T06:47:45.497

我偶然发现了这个线程，因为我有一个类似的要求，我需要（永久）设置（或更新）环境变量。

所以我查看了 - 如何从命令提示符永久设置环境变量，这非常简单！

```
setx JAVA_LOC C:/Java/JDK 
```

然后我只是在我的代码中实现了相同的这是我使用的（假设 - JAVA_LOC 是环境变量名）

```
 String cmdCommand = "setx JAVA_LOC " + "C:/Java/JDK";
            ProcessBuilder processBuilder = new ProcessBuilder();
            processBuilder.command("cmd.exe", "/c", cmdCommand);
            processBuilder.start(); 
```

ProcessBuilder 启动一个 cmd.exe 并传递您想要的命令。即使您终止 JVM/重新启动系统，环境变量也会保留，因为它与 JVM/程序的生命周期无关。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2021-10-15T01:35:06.513

只需使用反射，例如`setEnv("k1","v1")`

```
 private void setEnv(String key, String val) throws Exception {
        getModifiableEnv().put(key, val);
    }

    private Map<String, String> getModifiableEnv() throws Exception {
        Map<String, String> unmodifiableEnv = System.getenv();
        Field field = unmodifiableEnv.getClass().getDeclaredField("m");
        field.setAccessible(true);
        return (Map<String, String>) field.get(unmodifiableEnv);
    } 
```

需要

```
import java.lang.reflect.Field;
import java.util.Map; 
```

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2021-11-24T12:14:57.377

如果你像我一样在测试中遇到这个问题，并且你正在使用 Junit5，[Junit-pioneer](https://junit-pioneer.org/)带有非常有用的注释。[行家发布](https://mvnrepository.com/artifact/org.junit-pioneer/junit-pioneer)

例子：

```
@Test
@SetEnvironmentVariable(key = "some variable",value = "new value")
void test() {
    assertThat(System.getenv("some variable")).
        isEqualTo("new value");
} 
```

不能推荐它。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2019-10-15T16:43:52.537

基于[@pushy 的](https://stackoverflow.com/a/7201825/2249575)答案的[jython变体适用于Windows。](/questions/tagged/jython "show questions tagged 'jython'")

```
def set_env(newenv):
    from java.lang import Class
    process_environment = Class.forName("java.lang.ProcessEnvironment")
    environment_field =  process_environment.getDeclaredField("theEnvironment")
    environment_field.setAccessible(True)
    env = environment_field.get(None)
    env.putAll(newenv)
    invariant_environment_field = process_environment.getDeclaredField("theCaseInsensitiveEnvironment");
    invariant_environment_field.setAccessible(True)
    invevn = invariant_environment_field.get(None)
    invevn.putAll(newenv) 
```

用法：

```
old_environ = dict(os.environ)
old_environ['EPM_ORACLE_HOME'] = r"E:\Oracle\Middleware\EPMSystem11R1"
set_env(old_environ) 
```

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2020-01-04T21:04:32.073

Kotlin 中的一个版本，在这个算法中，我创建了一个装饰器，允许您从环境中设置和获取变量。

```
import java.util.Collections
import kotlin.reflect.KProperty
​
class EnvironmentDelegate {
    operator fun getValue(thisRef: Any?, property: KProperty<*>): String {
        return System.getenv(property.name) ?: "-"
    }
​
    operator fun setValue(thisRef: Any?, property: KProperty<*>, value: String) {
        val key = property.name
​
        val classes: Array<Class<*>> = Collections::class.java.declaredClasses
        val env = System.getenv()
​
        val cl = classes.first { "java.util.Collections\$UnmodifiableMap" == it.name }
​
        val field = cl.getDeclaredField("m")
        field.isAccessible = true
        val obj = field[env]
        val map = obj as MutableMap<String, String>
        map.putAll(mapOf(key to value))
    }
}
​
class KnownProperties {
    var JAVA_HOME: String by EnvironmentDelegate()
    var sample: String by EnvironmentDelegate()
}
​
fun main() {
    val knowProps = KnownProperties()
    knowProps.sample = "2"
​
    println("Java Home: ${knowProps.JAVA_HOME}")
    println("Sample: ${knowProps.sample}")
} 
```

* * *

## 回答 #21

> 赞同：-1
> 
> 时间：2018-07-04T07:20:46.863

我最近根据 Edward 的回答制作的 Kotlin 实现：

```
fun setEnv(newEnv: Map<String, String>) {
    val unmodifiableMapClass = Collections.unmodifiableMap<Any, Any>(mapOf()).javaClass
    with(unmodifiableMapClass.getDeclaredField("m")) {
        isAccessible = true
        @Suppress("UNCHECKED_CAST")
        get(System.getenv()) as MutableMap<String, String>
    }.apply {
        clear()
        putAll(newEnv)
    }
} 
```

* * *

## 回答 #22

> 赞同：-2
> 
> 时间：2019-07-30T14:30:58.690

如果您使用 SpringBoot，您可以在以下属性中添加指定环境变量：

```
was.app.config.properties.toSystemProperties 
```

* * *

## 回答 #23

> 赞同：-13
> 
> 时间：2008-11-25T17:42:09.253

您可以使用 -D 将参数传递到初始 java 进程中：

```
java -cp <classpath> -Dkey1=value -Dkey2=value ... 
```

# java - Tomcat context.xml 文件，是否有层次结构？

> ID：318241
> 
> 赞同：5
> 
> 时间：2008-11-25T17:38:28.700
> 
> 标签：java, tomcat, configuration, symlink, context.xml

我正在尝试在我在 Tomcat5 上运行的应用程序之一中使用符号链接。感谢[另一个 StackOverflow 问题](https://stackoverflow.com/questions/315093/configure-symlinks-for-single-directory-in-tomcat)的帮助，我能够通过在其中创建一个 context.xml 文件来做到这一点

/...myapplication/META-INF/context.xml

我现在正试图在生产服务器上实现这一点。但是，还有其他应用程序在其上运行。还有另一个上下文文件

/...tomcat/conf/context.xml

在我看来，这些正在为所有应用程序设置服务器范围的配置。如果我在 conf/context.xml 文件中允许链接，我的符号链接就可以工作。如果我不允许 conf/context.xml 中的链接，我的应用程序的符号链接不起作用，即使我在 META-INF/context.xml 中允许它们

我的问题是，conf/context.xml 是否控制所有应用程序？如果我希望符号链接仅在一个应用程序中工作，我是否需要删除 conf/context.xml 并为每个应用程序创建新的上下文文件？或者有没有办法只允许在 myapplication 中使用符号链接？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-27T01:08:10.197

请参阅[我](https://stackoverflow.com/questions/322260/which-tomcat-5-context-file-takes-precedence#322535)对“[哪个 Tomcat 5 上下文文件优先](https://stackoverflow.com/questions/322260/which-tomcat-5-context-file-takes-precedence)”问题的回答。

关于您的具体`allowLinks`问题，`conf/context.xml`默认情况下，值优先。如果您在 your 中什么都不说`conf/context.xml`，则默认值[`allowLinks="false"`](http://tomcat.apache.org/tomcat-5.5-doc/config/context.html#Standard%20Implementation)在您的`conf/context.xml`.

如果您只想为您的 更改它`myapplication`，尝试`<Context allowLinks="true" ...>`在您的中说`META-INF/context.xml`将无效，因为*通常*`conf/context.xml`设置将优先。

**但是**，如果您在. _ _ `<Context allowLinks="true" **override="true"** ...>` `META-INF/context.xml``<Context>``META-INF/context.xml`**`conf/context.xml`**

 **最后，`myapplication/WEB-INF/context.xml`我建议使用文件而不是`conf/Catalina/localhost/myapplication.xml`文件。这种技术意味着您可以保持 WEB-INF 的内容干净，这是您的 webapp 的核心——我不想冒险在我的 webapp 的核心中胡闹。:-)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-04T08:43:20.103

只是为了补充一点。

通常将 meta-inf/context.xml 复制到 conf/Catalina/localhost/myapplication.xml

当重新部署一个war文件时，conf/Catalina/localhost/myapplication.xml被删除，并如上所述复制一个新文件。

这可能是一个真正的痛苦。我喜欢应用程序特定上下文的想法，但我看不出在 meta-inf 目录中有什么帮助。

对于 Prod、UAT 等来说，这真的很痛苦。

因此，对于任何服务器静态但特定于应用程序的内容，最好将其放在 conf/context.xml 中。不利的是，它为多个应用程序提供了上下文，触摸一个您无意中触摸它们的应用程序。

# java - Problems in ClassLoaders for Long running Tomcat process

> ID：318243
> 
> 赞同：2
> 
> 时间：2008-11-25T17:38:55.453
> 
> 标签：java, tomcat, classloader

We have hosted our web applications on Tomcat 6.0.18 and experienced the following problem:

There are two web apps WebApp1 and WebApp2, both are same system but of different versions.

Now the problem is when the tomcat has been running for a week or longer time then sometimes system gives NoClassDefFoundError ! also we got some strange issue where the Class Loader of WebApp1 has loaded the class present in the jar of WebApp2 ! The same jar is also present in WebApp1 but the versions are different.

When we restarted the Tomcat everything started working fine ! Our JRE is 1.5.10

Please let me know if you have encountered such issues.

Regards, Jatan Porecha

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-25T17:54:45.330

我在 Tomcat 中遇到过很多非常多的类加载器怪异——即使您自己不执行任何类加载器代码，Tomcat 本身也很容易产生问题。最常见的问题似乎是反复卸载和重新加载 web 应用程序会泄漏类加载器并最终导致 Tomcat 内存不足。

我看到的版本不匹配的最常见原因是 Tomcat 确保某些类和 jars（Tomcat 本身的一部分）在您的 webapp 类路径中领先于任何其他类——commons-logging 似乎是最常见的例子——而且有可能用于在您不期望的时候加载、卸载或保留类加载器。

您能否提供更多详细信息 - 如果 jar 来自第三方，则很有可能有人以前见过这个问题。如果它是您自己的 jar，那么您在应用程序中是否有任何您自己的类加载器代码？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-25T19:17:46.613

我仍然没有足够的代表来添加评论，所以我将不得不发布另一个答案。:)

这听起来像是 MailSender.class 以某种方式加载到 Tomcat 中，而不是加载到每个单独的 web 应用程序中。WebApp2 首先加载它并且它可以工作，即使它被加载到所有不是 WebApp2 私有的 Tomcat 中。当 WebApp1 需要该类时，它已经看到它已加载到 Tomcat 父级中，并且不会尝试将一个私有加载到 WebApp1。

我首先建议您检查您的 Tomcat、JRE 等目录，以查看这些路径中是否存在 jar 或类的副本。之后，我将手动从两个 jar 文件中删除该类并重新启动 Tomcat 或 Web 应用程序以查看会发生什么 - 您会期望它失败并产生堆栈跟踪，这将告诉您您的类首次加载的位置谁在尝试加载它。（例如，从类名来看，您可能有一个邮件 API，已加载到 Tomcat JVM 中，该 API 将类加载到 Tomcat 中，而不是您的 web 应用程序中）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-25T19:23:24.073

您在同一台服务器上托管 2 个完全相同的代码版本是否有特殊原因？

拥有 2 个具有完全相同名称的不同 jar，在相同的命名空间中包含类，并且具有相同的类名似乎会导致各种问题（其中最重要的是人为错误）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-25T18:42:56.777

感谢克里斯的回复。

jar 已成为系统的一部分，并具有一些由其他进程共享的公共类。

让我们调用那个 jar comutils.jar 所以场景是这样的，

```
WebApp1（版本 1）
  |
  |- comutils.jar (ver 1)
        |
        |- MailSender.class (ver 1)

WebApp2（版本 2）
  |
  |- comutils.jar (ver 2)
        |
        |- MailSender.class (ver 2)

```

这个 MailSender 类是单例的。

现在有时发生的情况是，每当 WebApp1 的代码在使用 getInstance 方法检索其实例后调用 MailSender 的任何方法时，实际调用都会转到 MailSender（版本 2）而不是版本 1！

希望这会给你一些线索。

# ruby-on-rails - RoR：named_scope，过去 7 天内创建的所有记录？

> ID：318246
> 
> 赞同：4
> 
> 时间：2008-11-25T17:40:35.560
> 
> 标签：ruby-on-rails, ruby

如何定义一个 named_scope 以返回过去 7 天内创建的所有记录，然后如何在控制器中使用该命名范围？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-25T18:22:02.293

我建议[在 named_scope 上观看 Railscast 剧集](http://railscasts.com/episodes/108)。

理想情况下，您要查找的代码是：

```
 named_scope :recent, 
   lambda { |*args| {:conditions => ["created_at > ?", (args.first || 7.days.ago)]} } 
```

这将允许您将参数传递给命名范围，否则它将默认为前 7 天。

您可以使用以下方式调用它：

```
MyModel.recent 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-25T18:12:58.817

您需要将 named_scope 传递给一个 proc，以便每次运行对 named_scope 的调用时都会对其进行评估。否则，如果您指定 Time.now，它将运行一次（在第一次调用时）并被“缓存”，直到应用程序重新启动。

```
 named_scope \
    :this_week,
    :conditions =>  [
      %created_at > :time!,
      proc {{:time => Time.now}}
    ] 
```

您可以像 @ar_object.this_week 一样调用 named_scope

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2019-07-02T18:02:19.147

我正在寻找可以返回的记录，`last 7 days`即不包括今天。但这对我有用，它可以为`last n days`.

```
scope :last_n_days, lambda {|n| where('created_at BETWEEN ? AND ?', Date.today - n, Date.today - 1)} 
```

# version-control - Preparing a development tools machine

> ID：318250
> 
> 赞同：2
> 
> 时间：2008-11-25T17:43:44.773
> 
> 标签：version-control, hosting, build-automation

I am working on a small project with a few friends and need to set up a server to run our tools. I looked around at hosted solutions like [Unfuddle](http://unfuddle.com/) but they don't provide a CI server.

I am now considering buying a [Linode](http://www.linode.com/) and running the following on it:

*   Mail : [Apache JAMES](http://james.apache.org/)
*   CI : [Hudson](http://hudson-ci.org/)
*   Wiki/Tracker : [Trac](http://trac.edgewall.org/)
*   Project Management: [Mingle](http://studios.thoughtworks.com/mingle-agile-project-management)
*   VCS : [SVN](http://subversion.tigris.org/)

I am a Linux server newbie, so does anyone have any writeups, advice etc about this? I am aware of [Buildix](http://buildix.thoughtworks.com/), but they don't provide the combination I need.

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-25T19:47:24.710

我强烈建议您不要使用您的构建服务器（假设您打算依赖它而不是将其作为“玩具”或“实验”）作为您对新操作系统平台的介绍。您很可能需要能够亲自支持该机器的构建和操作的各个方面，或者您需要能够将其交给您可以信任的人为您完成。

因此，如果您只对 Windows 感到满意，请在 Windows 上构建它。如果可以的话，自己建造并放在离家近的地方。不要使用托管解决方案，除非您确实需要它在 Internet 上可用。

一旦您的构建服务器运行良好，并且对您的操作和支持能力感到满意，然后考虑使用您不熟悉的操作系统或工具构建另一个这样的服务器。然后，您将能够比较和对比两个构建服务器，并且当您的“实验性”服务器出现问题时，您将始终拥有一个工作构建服务器。

另一方面，如果您将其作为实验而不是“生产”使用，那么我仍然建议不要托管它（再次警告您可能需要通过 Internet 共享它）--保持它关闭并亲密地了解它（哦，beeeehave！）。

换句话说，如果它是一个“实验”，那么不要让任何障碍阻碍你的实验自由：不要距离、不要金钱、不要分享等等。

享受！！！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-25T18:37:45.587

我不确定您需要多少电量，但我过去所做的就是抓起一台旧台式电脑。擦除硬盘驱动器并安装适当的操作系统，然后在其上加载我的工具。

我在路由器上设置了端口转发，以向它发送传入请求。我得到了一个动态 IP 地址 URL（有免费的和付费的）和设置工具，以始终更新 URL 上的当前 IP 地址。

它工作得很好，很便宜，而且我学到了很多关于服务器管理的知识。

是的，设置更难并且需要更长的时间，但是如果你运行这个项目 12 个月并且你支付（比如每月 30 美元），那么你可以为自己节省 360 美元，而且你对管理 Linux（或您选择的操作系统）。

最好的问候，
弗兰克

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-25T18:23:18.640

如果你安装了 Ruby，你可以拉下[deprec gem](http://www.deprec.org/ "弃用2")（“deprec”是用于“deploy recipe”，而不是“deprecated”）。它面向 Rails，但会设置 Trac 和源代码控制并让您执行其他管理任务。它可能适合也可能不适合您的需求，但我建议您检查一下。

当然，选择具有强大包管理系统的发行版将有助于安装商品。

至于邮件，我不知道你为什么会选择自己运行，什么时候[谷歌会免费为你做](http://www.google.com/apps/intl/en/business/index.html "Google Apps for Domains")。（例外：如果您的应用程序需要对邮件进行私密访问，则运行您自己的应用程序可能更简单。）

# c - C中的字符串分离和格式化

> ID：318255
> 
> 赞同：2
> 
> 时间：2008-11-25T17:47:52.643
> 
> 标签：c, string

我有一个像“1234567890”这样的字符串。现在我需要使用以下格式存储/打印它，123-456-7890

在 C 中实现这一点的最佳方法是什么？

感谢您的评论/回答。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-25T20:38:02.457

```
printf("%c%c%c-%c%c%c-%c%c%c%c"
  , s[0], s[1], s[2], s[3], s[4], s[5], s[6], s[7], s[8], s[9]); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-25T17:53:38.950

就什么是“最好的”而言，将有两种思想流派。

一所学校说，只要它功能强大且安全，任何使用最少资源（内存和处理器周期）的方法都是“最好的”。

一所学校说，只要它功能强大且安全，任何最容易阅读和维护的方法（尽管它可能效率低下）都是“最好的”。

***编辑：编辑****我的答案，因为我不喜欢给家庭作业问题提供代码答案*

正如其他答案和评论所建议的那样，如果您阅读 string.h 和 printf / sprintf 的文档，您会做得最好。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-25T17:55:05.000

C 是一种相当“古老”的语言（它属于七十年代），在其标准库中具有字符串操作函数，如 strcat、strcpy 等。

只看[string.h](http://en.wikipedia.org/wiki/String.h)头文件参考，应该就够了。

**编辑**：如果可以的话，我建议你使用更高级的语言，比如 C++，它有更强大的结构，比如 std::string 类。现在几乎每个操作系统和平台都应该有一个 C++ 编译器，包括嵌入式系统。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-25T18:06:54.400

您可以使用**realloc**重新分配字符串缓冲区（它不在堆栈上，是吗？）然后**memmove**来移动必要的字符。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-25T18:22:05.273

不用多说，以防这是家庭作业……您可能想要使用的是 strncpy 和 strcat（以及 string.h）的组合。

由于在 C 中处理字符串的方式，您需要引用字符串中的起点才能开始复制。例如，

```
strncpy (dest, src + startPos, copyLength) 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-25T18:59:47.990

您可以一个一个地复制字符，同时保留一个复制字符数的计数器。在复制一个字符之前，检查计数器是 3 还是 6；如果是这样，在输出中写一个破折号（'-'）。这将确保根据需要对数字进行分组：

```
const char* input = "1234567890";
char output[20];  // allocate a buffer big enough to fit the result

const char* src = input;  // the current source byte
char* dst = output;       // the current destination
int charsCopied = 0;      // counter

// loop until we reach the terminating NUL of the source string
while (*src) {

    // insert the dash in the output when needed
    if (charsCopied == 3 || charsCopied == 6) {
        *dst++ = '-';
    }

    // copy the current character and move to the next
    *dst++ = *src++;
    charsCopied += 1;
}

// terminate the output string and print it
*dst = '\0';
puts(output); 
```

# mobile - .mobi 值得吗？

> ID：318258
> 
> 赞同：2
> 
> 时间：2008-11-25T17:48:43.470
> 
> 标签：mobile, wireless, wap

.mobi 将走向何方？移动设备会使用简化 .com 网站的专有浏览器，还是将使用基于 .mobi 的浏览器？我有一种感觉，这将是一个失败...虽然不确定。

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-25T17:56:01.457

我的感觉是智能手机浏览器越来越像桌面浏览器，所以 .mobi 的整个概念从一开始就存在缺陷。此外，许多网站现在可以检测到您使用的是劣质浏览器，并自动将您重定向到其网站功能较少的版本 - 无需特殊域。

如果您正在编写一个网站，那么为手机浏览器提供内部重定向不是比维护一个完全不同的域更简单吗？特别是如果您可以通过编程方式从非移动版本导出移动版本，无论是在运行中还是在您交付内容时？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2013-03-14T14:41:16.963

如果您没有或买不起理想的 .com 域名，.Mobi 是值得的。使用 mobi 域，您可以获得更大的收益。假设您需要一个网站来推广您的应用程序，您通常可以将确切的名称注册为移动域以获得注册价格或低价（如果已被占用）。同时，通常 .com 几乎肯定会被占用，而当前所有者可能会认为这个域名值一大笔钱。然后，如果您绝对想要 .com，您最终会选择另一个不太理想的 .com 域。

我的观点是，精确且令人难忘的廉价 mobi 域比昂贵或不精确的 .com 域更好。

如果您已经拥有自己的域名，那么您就不需要 .mobi。

# svn - 我一般应该使用自签名证书吗？特别是对于SVN？

> ID：318263
> 
> 赞同：4
> 
> 时间：2008-11-25T17:49:34.107
> 
> 标签：svn, ssl, self-signed

使用自签名证书有多安全？据我了解，如果我没有来自权威机构的证书，攻击者可能会伪装成我的服务器。这风险大吗？

我应该为 Subversion 购买证书吗？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-25T17:53:40.213

只要每个人都知道，将自签名证书用于内部项目并没有真正的危害。从安全的角度来看，您可能希望将证书分发给您的用户，以便他们在进行初始连接时可以确保它是有效的。在这种情况下，没有理由为证书付费。自签名证书提供与付费证书相同级别的加密保护，只是客户端程序不会自动信任它。

# c++ - 从服务启动进程

> ID：318265
> 
> 赞同：2
> 
> 时间：2008-11-25T17:49:49.410
> 
> 标签：c++, service, createprocess

我正在尝试从服务启动另一个进程（它是一个控制台应用程序，它收集一些数据并将其写入注册表）但由于某种原因我无法让它正确启动。

我正在尝试做的基本情况如下：

1.  启动进程
2.  等待过程完成
3.  从进程中检索返回码

我目前正在使用以下代码：

```
STARTUPINFO info={sizeof(info)};
PROCESS_INFORMATION processInfo;
if (CreateProcess(PATH, ARGS, NULL, NULL, TRUE, 0, NULL, NULL, &info, &processInfo))
{
    ::WaitForSingleObject(processInfo.hProcess, INFINITE);

    DWORD exit = 100;
    GetExitCodeProcess(processInfo.hProcess, &exit);

    CloseHandle(processInfo.hProcess);
    CloseHandle(processInfo.hThread);

    return exit;
} 
```

在调用 CreateProcess() 时，它成功并进入 if 语句的主体。对 WaitForSingleObject 的调用会立即返回，这是不应该的，因为该过程大约需要 20-30 秒才能完成。最后，调用 GetExitCodeProcess() 失败并且没有设置值“exit”。

仅供参考，这是我在其他地方成功使用过的代码，只是不在服务中。

难道是它是从服务启动的并且存在权限问题？

**编辑：** 我现在意识到它实际上会启动应用程序（我可以在 TaskMan 中看到它），但它似乎被卡住了。它在那里，但没有做任何事情。
根据 Rob Kennedy 的[建议](https://stackoverflow.com/questions/318265/launching-a-process-from-a-service#318314)，我修复了进程句柄问题，它实际上确实在等待进程完成。但除非我手动杀死它，否则它永远不会完成。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-25T18:04:14.437

`WaitForSingleObject`并`GetExitCodeProcess`期望进程句柄本身，而不是指向进程句柄的指针。删除与号。

另外，检查返回值并`GetLastError`在它们失败时调用。这将帮助您诊断未来的问题。永远不要假设 API 函数总是会成功。

一旦你正确调用了函数，并且新进程开始但没有进展，你就可以合理地确定*这段*代码不是罪魁祸首。问题出在新进程上，所以将调试任务集中在新进程上，而不是服务进程上。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-25T18:29:47.490

在更新和编辑之后，这听起来像是从服务启动进程时的许多可能陷阱之一。是否有任何可能性 - 您的外部进程正在等待用户交互？我能想到三个主要示例，例如一个命令行应用程序，在某些情况下可能需要键盘输入（例如，“cmd /c del *.*”之类的内容需要用户确认）。如果应用程序需要一个窗口并且正在显示它但您看不到它，则其他示例将适用。如果是这种情况，您可能希望在调试时将服务设置为“与桌面交互”，然后能够看到应用程序窗口（或意外的 Windows 错误消息，例如无法找到 DLL 或类似信息）。

如果这有助于您进行调试，通常是“啊哈！” 时刻来自于意识到环境变量、路径、当前目录等可能不是您对服务的期望。权限不是此类问题的最常见原因。您能否提供有关您尝试启动的外部应用程序的一些详细信息，也许这将有助于思考这一点。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-25T18:30:08.597

由于您正在启动控制台应用程序，因此可能存在试图初始化控制台的隐藏启动代码。服务未附加到桌面，并且我确定该服务启动的进程也不会，因此它将无法创建控制台。那可能是它挂起的地方。

如果可以，请尝试将您的进程更改为完整的 Windows 可执行文件，但跳过您尝试创建窗口的部分。

# tdd - 如何将您的范式转变为测试驱动开发

> ID：318269
> 
> 赞同：12
> 
> 时间：2008-11-25T17:51:23.947
> 
> 标签：tdd

几年来我一直在听说测试驱动开发，直到最近我开始对 .NET MVC 产生更多兴趣时，我才真正从实践层面对它给予过多关注。我一直在使用[MVC Storefront Sample](http://www.codeplex.com/mvcsamples/SourceControl/ListDownloadableCommits.aspx)，我意识到测试驱动方法是多么的酷和有用。但是，很长时间以来，我一直在使用“最后测试”的方法进行编程，当涉及到业务时，我总是可以用我最熟悉的方法来最好地估计我的工作量。

我猜想学习如何使用测试驱动方法不像是学习另一种编程语言，而更像是在为构建应用程序奠定框架和规划需求方面的改变。我不认为我可以拿起一本书并使用 TDD 为我的一个客户开始一个项目，我猜我对它的介绍需要更有条理。

对我来说，改变构建应用程序的思维定势以便我可以在最短的时间内有效地进行测试驱动开发的最佳方法是什么？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-11-25T17:58:08.177

你仍然可以最后测试。没关系。我们会原谅你的。

了解单元测试工具如何以您当前的语言工作。

开始为您现在正在处理的任何事情编写单元测试。

最终，您可以开始进行代码小测试。然后测试一点点代码。

纯测试*驱动*开发是一种理想。务实地说，大多数人只测试一点代码。更像是测试指导或测试指导，而不是测试驱动。

现在开始。测试你手头的任何东西。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-25T18:14:58.783

你需要**练习**。

您可以从**测试优先编程**开始。像往常一样设计代码，也许不是很详细，首先开始实现它的测试：从一个没有依赖关系的类开始，看看如何测试它，写下你能想到的测试列表。开始编写最简单的测试。然后编写足够的代码使其通过。在你的清单上划过测试并写下它，写下代码。

当您对新测试有想法或问自己有关代码在特定条件下的行为方式的问题时，请将新测试添加到您的列表中。

我建议您阅读[测试驱动开发](https://rads.stackoverflow.com/amzn/click/com/0321146530)；这是一个很好的 TDD 介绍，还包含很多参考资料（称为模式）。

关于估计，要记住的一件事是，虽然同时编写代码和测试比编写代码略长一些，但你最终得到的**代码是有效**的。

一些更多的建议，一旦你开始：

*   在修复代码中的任何问题之前添加一个新的失败测试。

*   努力在没有失败测试的情况下编写任何代码行——这是最终目标。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-25T18:15:00.840

学习 TDD 的最好方法是继续做下去。到目前为止，这是我设法让同事“检测感染”的唯一方法——至少现在你对预先的好处有了很好的认识。

不过，从更实际的角度来看，我认为您已经强调了其中一个关键思想——它是在规划构建应用程序的需求方面的变化。无论你现在使用什么方法，如果你看到“需求”这样的词，你就可以在脑海中想到“测试用例”，并且至少有先写测试用例的*意图。*但就像其他答案所暗示的那样，TDD 不是一个全有或全无的决定。您编写的任何测试，无论何时编写，之前或之后，都是有帮助的。同样，不要认为你可以达到预先编写所有测试的状态——这是一个循环。

[我最喜欢的是JUnit FAQ 中本条目](http://junit.sourceforge.net/doc/faq/faq.htm#best_3)末尾的伪代码。测试用例的思维框架是一个无限循环。跳到任何地方，您编写的任何测试都会有所帮助，而且您不会后悔。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-25T23:49:42.773

我不明白为什么你不能直接开始使用 TDD。您不需要使用该练习来创建所有代码 - 对于初学者来说，只需每天一堂课或每天一小时使用它。当您变得更舒服时，将实践的应用扩展到您的更多代码。

还要记住，TDD 与其说是测试策略，不如说是一种设计策略。对测试告诉您有关生产代码的内容持开放态度。总是毫不留情地重构——尤其是在开始的时候，如果有疑问，就会犯下过多重构的错误。

如果你能找到一些志同道合的人，可以考虑进行编码道场；这是学习新的编程技能的一种非常有趣的方式：http: [//codingdojo.org/](http://codingdojo.org/)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-25T18:01:35.800

除了 S.Lott 所说的，看看 MVC Storefront 的结构。

他们如何处理来自数据库的数据的测试？他们如何处理控制器正确运行的测试？当一个类有其他依赖时，它们如何处理？

一旦你掌握了 (???)Unit 的基础知识，看看 TDD 如何要求你构建一个程序真的很有帮助

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-25T18:01:59.963

即使你是先写代码，在写代码的时候问问自己，“这是可测试的吗？” 如果不是，那么您可能需要针对您正在编写的特定代码重新考虑您的设计。如果是，那么继续完成它并在之后编写一些测试。我自己现在正处于稍微编写代码、稍微测试一下的心态。

# wpf - WPF MouseLeftButtonUp 未触发

> ID：318288
> 
> 赞同：15
> 
> 时间：2008-11-25T17:55:48.743
> 
> 标签：wpf, events, button, mouseleftbuttonup

当我使用该`MouseUp`事件时，我可以通过鼠标右键单击来触发它。但`MouseLeftButtonUp`不会触发任何一次点击！

```
<Button MouseLeftButtonUp="btnNewConfig_MouseUp"  Name="btnNewConfig">
    <StackPanel Orientation="Horizontal">
        <Image Source="Icons\new.ico" Height="24" Width="24" Margin="5"/>
        <TextBlock VerticalAlignment="Center">New</TextBlock>
    </StackPanel>
</Button> 
```

我知道这很可能很简单。谢谢您的帮助！

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2008-11-25T18:01:21.960

看起来`Button`控制正在吞噬该事件，因为`Button.Click`实际上是`LeftButtonDown`事件和`LeftButtonUp`事件的组合。

**`PreviewMouseLeftButtonUp`**但是您可以在`Button`而不是订阅隧道事件`LeftButtonUp`。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2018-05-09T22:56:40.467

订阅隧道事件而不是气泡事件有一些非常混乱的副作用，我将在后面解释。

这是一个更好的解决方案，因为它可以保持您的气泡完好无损。:)

```
btnNewConfig.AddHandler(MouseLeftButtonUpEvent, 
                        new RoutedEventHandler(btnNewConfig_MouseUp), 
                        true); 
```

您将不得不使用`RoutedEventArgs`而不是声明您的事件处理程序，`MouseButtonEventArgs`但您可以将其转换回`MouseButtonEventArgs`内部。

```
void btnNewConfig_MouseUp(object sender, RoutedEventArgs e)
{
    MouseButtonEventArgs args = e as MouseButtonEventArgs;
    // ...
} 
```

请注意最后一个参数`AddHandler`- 使其为 true 会导致您的事件触发，即使先前的处理程序已设置`e.Handled = true;`

**现在关于`PreviewMouseLeftButtonUp`：**

在孩子之前为父母举办隧道活动。冒泡 - 相反。如果您涉及许多事件处理程序，您应该真正坚持所有冒泡或所有隧道，否则您添加的事件处理程序越多，它就越混乱 - 添加一个新的事件处理程序可能会导致您重新访问应用程序中的所有其他事件处理程序。

大多数人发现冒泡模型更自然。这就是为什么接受的答案是有问题的。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2011-08-03T21:11:31.043

`Button``Handled`正在为其事件使用 Mouse[Left/Right]Button[Up/Down] 事件（并将它们标记为） `Button.Click`。

正如[Jobi 所说](https://stackoverflow.com/a/318304/10927863)，您可以使用`PreviewMouseLeftButtonUp`事件，但我想建议您创建自己的按钮模板并修改其行为。（即不标记`MouseLeftButtonUp`as `Handled = true`）或仅使用 a 以外的其他东西`Button`作为您的父容器（取决于您真正需要它的用途）。

# iphone - 将图像下载到 iPhone 的优雅方式

> ID：318297
> 
> 赞同：-2
> 
> 时间：2008-11-25T17:58:24.947
> 
> 标签：iphone, http, mobile

PHP5.2.x 后端。文本数据传输使用 JSON 对象。

我正在研究如何最好地将大约 10、30kB 的 PNG 图像从服务器传输到 iPhone 客户端。

看过 Base64 编码服务器上的图像并使用 JSON 传输。然而，这确实会增加 30% 的文件大小开销。

也许来自客户端的每个图像的简单 http GET 会是最好的？

问候。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-25T18:24:03.460

由于 PNG 已经被压缩，您可能不会通过将它们进一步压缩来获得任何东西。正如您所提议的，HTTP GET 可能是最好的方法。您可以为此使用 NSURLConnection 及其朋友。

# xslt - 将变量设置为其他两个变量中较小的一个

> ID：318303
> 
> 赞同：1
> 
> 时间：2008-11-25T18:00:24.710
> 
> 标签：xslt

当我尝试使用下面的代码时，我得到一个重复变量错误，因为变量是不可变的。如何将两个变量 (`$nextSubPartPos`和`$nextQuestionStemPos`) 中较小的一个设置为我的新变量 ( `$nextQuestionPos`)？

```
 <xsl:variable name="nextQuestionPos"/>
        <xsl:choose>
            <xsl:when test="$nextSubPartPos &lt; $nextQuestionStemPos">
                <xsl:variable name="nextQuestionPos" select="$nextSubPartPos"/>
            </xsl:when>
            <xsl:otherwise>
                <xsl:variable name="nextQuestionPos" select="$nextSubPartPos"/>
            </xsl:otherwise>
        </xsl:choose> 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-26T00:20:48.747

计算结果为较小值的紧凑 XPath 1.0 表达式是：

**    $v1*($v2 >= $v1) + $v2*($v1 > $v2)**

其中 $v1 和 $v2 变量包含要比较的值。

因此，一个优雅的单行 XSLT 1.0 解决方案将如下所示：

**    <xsl:variable name="v3" select="$v1*($v2 >= $v1) +$v2*($v1 > $v2)"/>**

在 XSLT 2.0 中根据需要定义变量更容易：

可以使用以下（更易读的）单行：

**    if($v2 gt $v1)
                然后 $v1
                否则 $v2**

或者更紧凑：

    **分钟（（$v1，$v2））**

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-25T18:05:01.487

不要关闭第一行中的 xsl:variable 节点。也就是说，把 / 拿出来，然后放一个`</xsl:variable>`after `</xsl:choose>`。接下来，`<xsl:variable>`将选择中的节点更改为`<xsl:value-of>`节点。

也就是说，你想用选择来设置变量的值。有两种方法可以设置变量的值。一个是select属性，另一个是节点的内部文本。

```
<xsl:variable name="nextQuestionPos">
    <xsl:choose>
         <xsl:when test="$nextSubPartPos &lt; $nextQuestionStemPos">
               <xsl:value-of select="$nextSubPartPos"/>
         </xsl:when>
         <xsl:otherwise>
               <xsl:value-of select="$nextSubPartPos"/>
         </xsl:otherwise>
    </xsl:choose>
</xsl:variable> 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-25T18:20:21.487

只需使用以下`min`功能：

```
<xsl:variable name="a" select="42" />
<xsl:variable name="b" select="23" />
<xsl:variable name="x" select="min(($a,$b))" /> 
```

在您的示例中，将整个代码替换为：

```
<xsl:variable name="nextQuestionPos" select="min(($nextSubPartPos,$nextQuestionStemPos))" /> 
```

Saxon 在全局命名空间中实现 min 。其他处理器可能需要命名空间，正确的命名空间（通常表示为`fn`）是`http://www.w3.org/2005/02/xpath-functions`.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-25T18:02:35.920

XSLT 中的变量是不可变的。这让我绊倒了很多次。

# mysql - mysql存储过程问题

> ID：318311
> 
> 赞同：1
> 
> 时间：2008-11-25T18:02:51.553
> 
> 标签：mysql

我有一张带有贷方和借方列的表格。

我需要从中获得最高的平衡，我认为存储过程是做到这一点的方法，但我不知道怎么做。

我需要从第一行开始，添加借方，减去贷方并存储值 A。

第二行是A+借-贷=B；A = max(A,B) 重复最后一步直到结束。

请记住，我正在寻找最高的 EVER，而不是当前的，它只是 sum(debit-credit)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-25T18:38:21.840

在我看来，您希望运行总数是，`A+credit-debit`但如果需要，请切换它们。

```
SET @balance := 0;
SET @high := 0;
SELECT @high := GREATEST(@balance := @balance+credit-debit, @high) FROM mytable;
SELECT @high; 
```

**编辑：**`SELECT`为了回应您关于由此形成存储函数的评论......与存储过程不同，存储函数必须返回一个值，因此除非查询将其结果存储在变量中，否则 它们不能包含查询。这意味着必须保证查询具有单值结果。下面是我要工作的函数，因为在这种情况下，您只需要 MAX 值`@high`：

```
CREATE FUNCTION high_bal() RETURNS DECIMAL
BEGIN
  SET @balance := 0;
  SET @high := 0;

  SELECT MAX(@high := GREATEST(@balance := @balance+debit_acc-credit_acc, @high))
  INTO @high
  FROM credit_acc where credit_used_acc=63395;

  RETURN @high;
END$$ 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-25T21:37:52.197

实际上，我以为我会很聪明，把它变成一个函数，因为我只想要一个值作为结果......

分隔符 $$

如果存在则删除函数`cc`。`high_bal`$$

创建函数`cc`。`high_bal`() 返回小数

```
BEGIN
SET @balance := 0;
SET @high := 0;
SELECT @high := GREATEST(@balance := @balance+debit_acc-credit_acc, @high) FROM credit_acc where credit_used_acc=63395;

RETURN @high;
END$$

print("code sample");

DELIMITER ; 
```

但这给了我错误“不允许从函数返回结果集”我不明白，因为我只想要单个值。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-25T21:51:41.543

用户定义函数只是嵌入在 SQL 语句中的东西。它们在每一行的上下文中运行（例如 40 行，函数执行 40 次）。如果你想从一个集合（多行）中聚合，你可以使用一个带有聚合函数的 SQL 语句（例如 MAX(columname)）。这会返回一个“结果集”，它恰好是一个具有一个值的行。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2008-11-25T18:09:12.833

可能

```
select max(debit-credit) from yourtable 
```

工作？

尝试测试它。

# .net - 透明窗口（或绘制到屏幕）无鼠标捕获

> ID：318327
> 
> 赞同：9
> 
> 时间：2008-11-25T18:07:51.293
> 
> 标签：.net, winforms

在我正在编码的应用程序中，我想显示一条警报消息，显示一条大的半透明警告消息，而不会影响用户的工作。基本上我会淡入消息，但从不将其不透明度设置为 1，并且我希望用户能够单击“通过”消息，就好像它不存在一样。

我已经开始使用始终在顶部的窗口并将窗口样式设置为无并将背景和透明度键设置为白色。在这个窗口上有一个带有大字体的标签，其中包含警告消息（稍后我可能会覆盖绘制事件并使用 GDI 绘制消息）。我使用计时器通过调高它的不透明度来淡入消息，然后再调低它。它可以正常工作，因为焦点不会从任何应用程序中窃取，但透明表单捕获鼠标事件，而不是它下面的表单（实际上大多数透明的表单不会捕获鼠标事件，只有标签文本会）。

另外我不确定这是最佳方法，也许我应该以某种方式直接在屏幕上绘画。

我应该如何改进。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-11-25T18:36:11.673

覆盖 Form 类的 CreateParams 属性并确保设置了 WS_EX_NOACTIVATE 扩展样式。我的看起来像这样：

```
protected override CreateParams CreateParams
{
  get
  {
    CreateParams baseParams = base.CreateParams;

    baseParams.ExStyle |= ( int )(
      Win32.ExtendedWindowStyles.WS_EX_LAYERED |
      Win32.ExtendedWindowStyles.WS_EX_TRANSPARENT |
      Win32.ExtendedWindowStyles.WS_EX_NOACTIVATE |
      Win32.ExtendedWindowStyles.WS_EX_TOOLWINDOW );

    return baseParams;
  }
} 
```

上面使用的 ExtendedWindowStyles 的值是：

```
WS_EX_LAYERED = 0x00080000,
WS_EX_NOACTIVATE = 0x08000000,
WS_EX_TOOLWINDOW = 0x00000080,
WS_EX_TRANSPARENT = 0x00000020, 
```

# ruby-on-rails - 如何让用户在没有任何用户输入属性的情况下创建 has_many :through 表？

> ID：318333
> 
> 赞同：0
> 
> 时间：2008-11-25T18:09:57.420
> 
> 标签：ruby-on-rails, has-many-through, has-many

我有两个模型（用户和课程）和一个允许注册课程的 JOIN 表：

```
class User < ActiveRecord::Base
 has_many :enrollments, :dependent => :destroy
 has_many :courses,     :through => :enrollments
end

class Course < ActiveRecord::Base
 has_many :enrollments, :dependent => :destroy
 has_many :users,       :through => :enrollments
end

class Enrollment < ActiveRecord::Base
  belongs_to :user
  belongs_to :course
end 
```

注册 JOIN 表具有其他属性，例如成绩、完成百分比等。但是，除了注册之外，没有任何属性需要用户输入。理想情况下，我希望有一个`new_course_enrollment(@course, {:user_id => current_user} )`链接在后台创建注册（用户无需输入任何内容）并重定向回课程页面，其中“注册”链接替换为“已注册”状态。有没有办法在模型中执行此操作，而无需更改默认的 RESTful Enrollments#new 控制器操作？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-25T20:45:58.040

有几种方法可以做到这一点。

在视图中，您可以使用“立即注册”锚文本创建一个内联表单，指向您的“new_course_enrollment”方法。

表单应该有一个带有 course_id 的隐藏字段。

然后在您的控制器中，您需要此代码。

```
def new_course_enrollment
  e = Enrollement.new
  e.user_id = current_user
  e.course_id = params[:course_id]
  e.save

  redirect_to :action => 'index' # list of courses here
end 
```

您当然可以重构此代码以使其更短，将其移至控制器中的私有方法，或者更合乎逻辑地移至 Enrollment 模型本身。

# vb6 - 监控进程以查看它们是否在 vb6 中崩溃

> ID：318334
> 
> 赞同：1
> 
> 时间：2008-11-25T18:10:20.507
> 
> 标签：vb6, process-management

我有一个程序在我睡觉时经常崩溃，我需要让它继续运行。所以我想我可能会编写一个监控进程列表的 vb6 应用程序，如果某些东西消失了，它将重新启动它。有谁知道一个简单的方法？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-05T02:17:49.430

您可以使用[EnumProcesses](http://msdn.microsoft.com/en-us/library/ms682629(VS.85).aspx)列出运行时系统中的每个进程，您可以使用此声明来使用它

```
Public Declare Function EnumProcesses Lib "psapi.dll" ( _
                                      ByRef idProcess As Long, ByVal cb As Long, _
                                      ByRef cbNeeded As Long) As Long 
```

在使用它之前，您应该定义一个 Long 数组作为参数传递给 EnumProcesses，并具有足够的空间来读取所有进程 ID。您可以调用 EnumProcesses 两次以发现该数组应该有多大。在第二次调用之后，您可以开始循环遍历该数组并打开进程，以这种方式获取适当使用的句柄可以告诉您进程可执行文件的名称并将该数据与您正在搜索的可执行文件的名称进行比较就完成了。否则，如果您正在寻找的是一个 DLL，例如，您可以 EnumProcessModules 为该进程句柄搜索您正在寻找的 dll 的每个正在运行的进程。EnumProcessModules 的声明是这样的

```
 Public Declare Function EnumProcessModules Lib "psapi.dll" ( _
                                               ByVal hProcess As Long, ByRef lphModule As Long, _
                                               ByVal cb As Long, ByRef cbNeeded As Long) As Long 
```

你可能需要的代码是这样的

```
Option Explicit

Private Declare Function OpenProcess Lib "Kernel32.dll" ( _
                                    ByVal dwDesiredAccessas As Long, ByVal bInheritHandle As Long, _
                                    ByVal dwProcId As Long) As Long
Private Declare Function EnumProcesses Lib "psapi.dll" ( _
                                      ByRef lpidProcess As Long, ByVal cb As Long, _
                                      ByRef cbNeeded As Long) As Long
Private Declare Function GetModuleFileNameExA Lib "psapi.dll" ( _
                                             ByVal hProcess As Long, ByVal hmodule As Long, _
                                             ByVal moduleName As String, ByVal nSize As Long) As Long
Private Declare Function EnumProcessModules Lib "psapi.dll" ( _
                                           ByVal hProcess As Long, ByRef lphModule As Long, _
                                           ByVal cb As Long, ByRef cbNeeded As Long) As Long
Private Declare Function TerminateProcess Lib "kernel32" (ByVal hProcess As Long, ByVal uExitCode As Long) As Long
Private Declare Function CloseHandle Lib "kernel32" (ByVal hObject As Long) As Long

Private Const PROCESS_ALL_ACCESS         As Long = &H1F0FFF

Public Function IsModuleRunning(ByVal theModuleName As String) As Boolean
    Dim aProcessess(1 To 1024)  As Long ' up to 1024 processess?'
    Dim bytesNeeded             As Long
    Dim i                       As Long
    Dim nProcesses              As Long
    Dim hProcess                As Long
    Dim found                   As Boolean

    EnumProcesses aProcessess(1), UBound(aProcessess), bytesNeeded
    nProcesses = bytesNeeded / 4
    For i = 1 To nProcesses

        hProcess = OpenProcess(PROCESS_ALL_ACCESS, False, aProcessess(i))
        If (hProcess) Then
            Dim hmodule(1 To 1024)  As Long ' no more than 1024 modules per process?'
            bytesNeeded = 0
            If EnumProcessModules(hProcess, hmodule(1), 1024 * 4, bytesNeeded) Then
                Dim nModules    As Long
                Dim j           As Long
                Dim moduleName  As String

                moduleName = Space(1024)   ' module name should have less than 1024 bytes'

                nModules = bytesNeeded / 4
                For j = 1 To nModules
                    Dim fileNameLen As Long
                    fileNameLen = GetModuleFileNameExA(hProcess, hmodule(j), moduleName, 1024)
                    moduleName = Left(moduleName, fileNameLen)
                    If Right(LCase(moduleName), Len(theModuleName)) = LCase(theModuleName) Then
                        found = True
                        Exit For
                    End If
                Next
            End If
        End If
        CloseHandle hProcess
        If found Then Exit For
    Next
    IsModuleRunning = found
End Function

Private Sub Form_Load()
    MsgBox IsModuleRunning("explorer.exe")
End Sub 
```

函数代码有点长，但调用它是一个小函数，如果你想测试一下，你可以使用它:)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-25T18:17:26.763

使用[WMI](http://en.wikipedia.org/wiki/Windows_Management_Instrumentation)。

如果您不喜欢 VB6，请在 Web 上搜索 WMI+VB6。
否则，连接 c# 和 WMI 会容易得多。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-26T21:38:58.947

我使用一个运行其他程序的程序。这样，您可以轮询进程句柄以查看应用程序是否仍在运行。如果没有，您可以再次启动它。它确实需要 API 编程。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-25T18:34:40.880

我使用了计划任务（每 10 分钟运行一次），使用下一个内容启动 cmd 文件：

```
tasklist |find "myapp.exe" >nul || c:\mypath\myapp.exe 
```

您可以从 VB6 Shell 执行此类命令文件或仅使用任务计划程序 :)

# javascript - 移动包含动态创建的脚本标签的 DOM 元素

> ID：318336
> 
> 赞同：5
> 
> 时间：2008-11-25T18:10:39.400
> 
> 标签：javascript, jquery

我在基于 wiki 的 CMS 中使用 Fish Gadget ( [http://abowman.com/google-modules/fish/](http://abowman.com/google-modules/fish/) )，并且需要将小工具从一个 HTML 元素重新定位到另一个。（注意：fish 小工具是一个示例——其他小工具也会出现问题。）

如果我使用小工具基类“ig_reset”直接重新定位小工具，那么一切正常。如果我尝试使用周围的包装器重新定位，那么小工具使用的 iframe 似乎会接管。不幸的是，我需要使用周围的包装重新定位的灵活性。

这似乎与在 DOM 中移动 SCRIPT 标签有关。小工具动态创建脚本和样式标记。如果我从 DOM*中删除*动态创建的脚本标记，然后将包装器重新定位到 DOM 中的另一个位置，那么一切正常。如果我尝试*将*脚本标记移动到另一个 DOM 元素，则会出现原始问题。因此，在 DOM 周围*移动*脚本标签似乎是原因——无论移动何时发生（甚至是加载后）。

我想了解这里发生了什么导致框架接管页面，并找到比删除动态创建的脚本标签更好的解决方案。

我在这里做了一个测试：[http](http://solidgone.com/jquery/google-gadget.html) ://solidgone.com/jquery/google-gadget.html——演示使用jQuery，但我认为这与jQuery无关......

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-11-25T18:22:36.397

每当您使用 jQuery 将脚本元素附加到页面中时，它都会尝试执行它。因此，当您移动 ig_reset （这只是一个表 - 没有脚本）时，它可以正常工作。当您尝试移动包含脚本的包装器时，脚本将被移动并重新执行。

我们正在努力解决 jQuery 核心中的这个重新执行问题，但目前这就是这里发生的事情。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-25T18:27:44.670

正如 John Resig 所指出的，这*是*一个 jQuery 问题。您可以通过更换处理程序来验证这一点

```
$("#with-wrapper").click(function () 
{
   $('.sidebar-content-wrapper').contents().appendTo($("#sidebar"));
}); 
```

一个避免使用 jQuery 方法来实际移动每个元素的方法：

```
$("#with-wrapper").click(function() 
{
   var sidebar = $("#sidebar")[0];
   $('.sidebar-content-wrapper').contents().each(function()
   { 
      // raw DOM method rather than jQuery's 
      //  appendTo() -> domManip() -> execute script blocks behavior
      sidebar.appendChild(this);
   });
}); 
```

# scripting - 创建 DSL 与嵌入现有语言

> ID：318340
> 
> 赞同：4
> 
> 时间：2008-11-25T18:11:19.053
> 
> 标签：scripting, interpreter

这经常出现：您的应用程序已经变得足够广泛，是时候在其中添加一些可编程性以使其灵活了。一个示例可能是财务应用程序 - 您想添加一个公式编辑器，以便您可以创建自己的自定义公式，而无需重新编译代码。

您必须做出选择：您是否创建自己的标记器、解析器和解释器/编译器链，这可能需要很长时间并且可能会不正确？还是您只是嵌入了另一种脚本语言，它的问题是它可能会使您的代码膨胀并使您的应用程序暴露于安全漏洞。

您将如何权衡取舍并做出此决定？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-25T18:16:33.287

没有折衷——嵌入一个经过全面测试、有据可查的解释器。否则，你最终会得到像 MAXScript 这样的可憎之物。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-25T18:43:50.580

插件系统怎么样？有几个优点：

*   允许客户开发人员在开发源应用程序的环境中进行开发。
*   在现代开发中。平台，您可以通过软件合同获得大量控制权和安全性。
*   如果设计正确，您可以正确地将膨胀和故障归咎于导致它的插件 - 就像 Chrome 在 Flash 或其他第三方插件崩溃时所做的那样。
*   通过许可/证书轻松添加额外的安全性。
*   如果插件很棒并且您希望所有客户都拥有它，则可以轻松地将插件与应用程序合并。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-25T18:48:08.480

除非 DSL 足够简单以至于解析器/解释器适合单个页面，否则我建议嵌入现有的脚本语言。

我最近花了几个月的时间在我继承的一个项目上工作，该项目包含一种完全本土的脚本语言。我花了很多时间来理解解析器和解释器，这样我就可以修复错误，使其线程安全，扩展它，优化它。此外，还有时间学习和理解这种新脚本语言的怪癖，它与我已经知道的其他语言几乎一样但又不完全一样。我宁愿利用这段时间嵌入现有的语言，如 Ruby 或 Lua，并对其进行调整以适应我们的需求。

用户将受益于一种更易于编程、怪癖和陷阱更少的语言。我会从对精心设计和流行语言的内部结构的更深入了解中受益，而不是在“myScript”中获得相对毫无价值的专业知识。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-25T18:18:13.767

我会使用现有的解析器生成器（如 ANTLR 或 Haskell/Scala 的解析器组合器）创建自己的解释器。这真的没有那么难，而且对于简单的语言来说，这真的很容易。我在一个下午创建了一个极其简单的 DSL 的实现，它第一次运行完美（没有错误）。

话虽如此，您不必设计自己的图灵完备语言。如果您的需求如此复杂，您可能应该嵌入脚本语言。如果你在 JVM 上，JRuby 和 Clojure 是这类事情的优秀候选者，特别是考虑到它们在内部 DSL 领域的优势。

# iphone - 如何在 iPhone 上使用 fopen()？

> ID：318341
> 
> 赞同：16
> 
> 时间：2008-11-25T18:11:30.380
> 
> 标签：iphone, c, file-io, filesystems

iPhone SDK 文档声称 fopen() 是一种受支持的文件访问方法，但我无法让它返回 FILE 句柄。我正在访问一个包含在我的项目中的目录。我试过 fopen "filename","dir/filename","./filename","./dir/filename","/dir/filename" 都返回一个空指针。有些人报告使用它没有问题，所以我相信它很简单！

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2008-11-26T13:42:42.187

只是为了清楚打开文件“some.txt”......

```
NSString * path = [[NSBundle mainBundle] pathForResource:  @"some" ofType: @"txt"];
FILE *f = fopen([path cStringUsingEncoding:1],"r");
if (f == NULL) NSLog([path stringByAppendingString:@" not found"]); 
```

* * *

## 回答 #2

> 赞同：22
> 
> 时间：2008-11-25T18:22:37.830

如果您尝试访问应用程序包中的文件，则需要获取它的完整路径：`[[NSBundle mainBundle] pathForResource: FILENAME ofType: FILEEXTENSION]`

这将返回一个 NSString，您可以从中提取一个 UTF8String 并传递给 fopen。

# c# - 使用 StackTrace 推断方法的调用者

> ID：318347
> 
> 赞同：1
> 
> 时间：2008-11-25T18:13:06.493
> 
> 标签：c#, stack-trace

编辑：警告-我现在意识到以下技术通常被认为是一个坏主意，因为它为了看起来整洁而创建了隐藏的依赖项。

* * *

我最近发现您可以使用 StackTrace 来推断有关方法调用者的信息。

这使您能够创建一个看似“酷”的 API，您只需调用一个方法而无需向它传递任何显式参数，并且该方法会根据 StackTrace 确定要做什么。

这是一件坏事吗？如果是，为什么？

例子：

```
public class Cache {
  public Object CheckCache()
  {
    Object valueToReturn = null;
    string key = GenerateCacheKeyFromMethodPrototype(new StackTrace().GetFrame(1).GetMethod()); //frame 1 contains caller
    if(key is in cache) valueToReturn = itemFromCache;

    return valueToReturn;   
  }
}

public class Foo { 
  private static Cache cache = new Cache();

  public Blah MethodFoo(param1, param2...)
  {
    Blah valueToReturn = cache.CheckCache(); //seems cool!
    if(valueToReturn == null)
    {
      valueToReturn = result of some calculation;
      //populate cache
    }

    return valueToReturn;
  }
} 
```

我确定上面的伪代码中有错误，但你明白我的意思。

* * *

编辑：感谢大家的回复。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-25T18:16:24.380

不这样做的原因有两个：

*   很慢
*   它创建了一个脆弱的解决方案。

如果你想这样做，你最好使用支持面向方面编程的工具，比如 Castle 的 Dynamic Proxy。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-25T18:19:59.553

另一个问题是编译器可能会在优化过程中“内联”您的方法，例如

```
void MethodA() {
    MethodB();
}

void MethodB() {
   foo();
} 
```

变成：

```
void MethodA() {
   foo();
} 
```

这显然是一个问题，因为 foo 的直接调用者不再是 MethodB，而是 MethodA。您可以在方法上放置一个属性以防止它被内联：

```
[MethodImpl( ... NoInline )] 
```

（具体参数记不清了）

-Oisin

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-25T18:46:11.310

这很糟糕，因为当我调用它时我不知道该函数做了什么。我无法测试该函数，因为我的测试将从不同的函数调用它，这可能会调用不同的行为。

这很糟糕，因为现在在调用函数时我必须遵守一个“不可见的”合同。我不仅必须确保传递了正确的参数，还必须确保当前函数具有正确的名称。如果我将函数调用包装在匿名 lambda 函数中怎么办？突然间我改变了程序的行为，而且我事先*没有*猜到，所以现在我可以用第二天的时间来调试程序为什么突然神奇地崩溃了。

重载函数会发生什么？你区分它们吗？具有相同名称但在不同类中的函数？具有“特殊”名称的函数，例如构造函数、终结器、运算符或 lambda？

那么当编译器内联函数时呢？

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-25T19:10:42.587

这对我来说似乎一点也不酷。为什么要在方法本身中使用所有可能的方法来获得所需的状态？这就像依赖注入的反模式。不要去那里。

# visual-studio - 使用 Crystal Reports 组编辑器时 Visual Studio 崩溃

> ID：318348
> 
> 赞同：3
> 
> 时间：2008-11-25T18:13:58.987
> 
> 标签：visual-studio, visual-studio-2008, crystal-reports

我的 Visual Studio 2008 ASP.NET 项目中有一个水晶报表，当我从 Crystal Reports -> Report 菜单中选择“Group Expert”时，Visual Studio 崩溃/挂起，我必须使用任务管理器关闭程序。无论我尝试多少次都会发生这种情况，而且奇怪的是，它似乎在另一台具有相同项目的计算机上运行良好。

任何在正确方向上的帮助都将不胜感激，因为我正在努力解决这个问题。

我正在使用 Visual Studio 2008 SP1、SQL Server 2005 Developer SP2、Windows Vista Enterprise SP1 以及 Visual Studio 安装附带的 Crystal Reports 版本。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-11-25T18:22:16.333

转到[http://connect.microsoft.com/VisualStudio](http://connect.microsoft.com/VisualStudio)并搜索错误以查找修补程序。如果尚未报告，请使用重现步骤报告错误。

[ StackOverflow 不是报告 Visual Studio 错误的地方 :) ]

# video - 制作视频教程的工具？

> ID：318349
> 
> 赞同：4
> 
> 时间：2008-11-25T18:14:05.507
> 
> 标签：video, demo

我想为我的 SDK 制作一个视频教程——其中一个视频显示屏幕，而一些家伙谈论他在做什么。有人可以指导我使用简单且最好是免费的工具吗？

所需功能： - 剪辑（录制几个视频片段，然后将它们放在一起） - 字幕（不仅是为了用户方便，而且因为我不想在工作时通过麦克风说话来打扰其他隔间 :)）

（[谁不喜欢视频教程？](https://stackoverflow.com/questions/139621/can-we-get-rid-of-video-tutorials-please)）

更新：我正在使用 Windows。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-25T18:25:14.737

[静](http://www.jingproject.com/)。免费，非常好用，Windows版需要.NET 3.0框架。此外，还有可用的 Mac 版本。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-25T21:27:27.147

Camtasia非常好。我也用过 wink，它是 flash 而不是视频，但您可以添加导航控件和文本框。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-25T18:27:12.970

一个很酷的截屏工具是 Camtasia Studio [http://www.techsmith.com/camtasia.asp](http://www.techsmith.com/camtasia.asp)，提供 30 天免费试用

示例：[http ://static.interspire.com/isc-demo/index.html](http://static.interspire.com/isc-demo/index.html)

# sql - SQL 条件排序依据

> ID：318356
> 
> 赞同：3
> 
> 时间：2008-11-25T18:16:03.383
> 
> 标签：sql, sql-server, tsql

我在两张桌子上做一个连接。一个是用户表，另一个是高级用户列表。我需要让高级会员首先出现在我的查询中。但是，仅仅因为他们在高级用户表中并不意味着他们仍然是高级会员 - 还有一个 IsActive 字段也需要检查。

所以基本上我需要按以下顺序返回结果：

*   活跃的高级用户
*   普通和非活跃高级用户

现在我有它如下：

```
SELECT Users.MemberId, PremiumUsers.IsActive FROM Users
LEFT JOIN PremiumUsers ON PremiumUsers.UserId = Users.Id
ORDER BY PremiumUsers.IsActive DESC 
```

这样做的问题在于，它将非活跃的高级会员置于非高级会员之上。

（我为此使用 MS SQL Server 2005）

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-11-25T18:20:38.070

尝试按案例订购

```
ORDER BY CASE
    WHEN PremiumUsers.IsActive = 1 THEN 1
    WHEN PremiumUsers.UserId IS NULL THEN 2
    ELSE 3
END 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-11-25T18:19:25.730

```
ORDER BY COALESCE(PremiumUsers.IsActive, 0) DESC 
```

这会将 NULL 与非活动分组。

# php - PHP 中的定时任务（类似 cron）

> ID：318361
> 
> 赞同：13
> 
> 时间：2008-11-25T18:16:34.083
> 
> 标签：php, automation, cron, scheduling

是否有适用于 PHP 的功能齐全的作业调度包？我正在寻找与 Java 的[Quartz](https://quartz.dev.java.net/)等效的 PHP 。我很好地让事情从 cron 外部触发以驱动系统。我正在寻找的功能：

*   能够注册以给定间隔调用的任务（类/方法）。
*   能够指定给定任务是否可以多次运行（在某些情况下，可能长时间运行的方法不应多次运行）。
*   所有注册的条目/方法都可以并行运行（作业是后台运行的，因此它们不会阻塞其他定时任务）。
*   能够为给定任务设置超时。
*   能够动态更新作业控制，例如，您可以禁用某些任务或更改它们的频率而无需更改代码。

我知道有很多问题要问，但它似乎是一组有用的功能，我认为有人可能已经将其中的一部分放在一起。

如果这个或其中的某些部分尚不存在，是否有任何指向将它们组合在一起或开源项目的指针，该项目具有其中某些子集的合理功能实现？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-25T18:24:00.043

一个快速的谷歌出现了一些不错的结果：

*   [http://www.bitfolge.de/pseudocron-en.htm](http://www.bitfolge.de/pseudocron-en.htm)
*   [http://www.phpclasses.org/browse/package/4140.html](http://www.phpclasses.org/browse/package/4140.html)
*   [http://www.hotscripts.com/Detailed/61437.html](http://www.hotscripts.com/Detailed/61437.html)

但是，实际上，如果您使用任何体面的共享主机包，您应该可以访问某种任务调度程序，无论是 Windows 的任务调度程序还是 *nix 下的 cron。我知道 DreamHost 至少允许用户级别的 crontab。

# c# - 从网上取图片并顺序显示

> ID：318368
> 
> 赞同：0
> 
> 时间：2008-11-25T18:19:20.177
> 
> 标签：c#, .net, winforms, user-interface, c#-2.0

1.  我想创建一个从互联网上获取的可滚动图片列表，并让用户能够点击它。我该如何在 WinForms/C# 中进行操作？是否可以将图片框控件/控件添加到列表框？

2.  我尝试在 AutoScroll 设置为 true 的情况下将图片框列表添加到 UserControl 中，这会给我一种使用 listBox 的感觉，这是正确的方法吗？

3.  我还尝试将图片框的 ImageLocation 设置为图像的 URI，然后调用 Load() 来加载图像，它确实有效，但是我的表单冻结了！如何在不冻结表单的情况下按顺序更新每个图片框？

谢谢你，阿兹拉姆

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-25T20:36:00.387

我会先回答你的第三个问题，因为这是我唯一真正知道答案的问题。图片框上有一个 LoadAsync() 方法，它将在单独的线程中加载图像并且不会挂起您的应用程序。

至于其他问题，我也很可能从用户控件开始并将图像放在那里。我唯一能建议的是首先创建一个用户控件，该控件有一个图片框，旁边可能还有一个多行文本框或richtextbox。关闭文本框上的边框，并在整个控件周围有一个轻微的边框。这将允许您显示图像，旁边有一些文本。然后，您的实际最终控件将只是这些控件的集合，并且能够根据需要添加它们。

--我的2美分...

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-27T15:09:51.103

你介意垂直滚动吗？

我将从 DataGridView 控件作为基础开始并创建以下实现：

1) 创建从 DataGridViewImageColumn 派生的自定义列和单元类型。您可以称它们为“CronosNetImageColumn”、“CronosNetImageCell”。

2）创建一个类“CronosImageDetails”来保存单元格数据（包括显示文本和图像url的属性）。这将作为每个单元格的值传入。前任：

ImageGrid.Rows.Add(new CronosImageDetails { DisplayText="Day at the Beach", ImageURL="http://...beach.jpg" });

3) 覆盖单元格 Paint() 以使用 WebClient 获取图像并使用 e.Graphics.DrawImage(ImageObtainedFromWebClient) 将图像绘制到单元格。您可以使用 e.Graphics.DrawString((CronosImageDetails)value.DisplayText,...) 覆盖单元格中的文本。

这种快速解决方案将为您提供一个滚动图像列表，该列表仅在用户滚动列表时加载图像，并为改进提供坚实的基础。

推荐的进一步优化：

A) 创建用于绘制单元数据的后缓冲位图和图形。

B) 设置 Paint() 来简单地绘制后缓冲区而不是做工作来获取图像

C) 创建一个新的单元格方法 LoadImage()，它会生成一个新线程，该线程下载图像并将其绘制到后台缓冲区。

D) 让 Paint()（或单独的辅助线程）跟踪滚动的方向和加速度，并估计哪些单元格需要预加载。在这些单元格上触发 LoadImage()。

E) 使用加载图像初始化每个单元格的后台缓冲区。

F) 跟踪并使用来自图像加载时间的经验数据来帮助确定需要预加载哪些单元格。

# exception - GCC的异常处理模型

> ID：318383
> 
> 赞同：15
> 
> 时间：2008-11-25T18:22:15.163
> 
> 标签：exception, gcc, mingw

GCC 支持 Setjump-longjump (sjlj) 和 Dwarf2 基于表的展开 (dw2) 异常处理模型。两种型号有什么区别，如何选择合适的型号？为什么 Dwarf2 基于表的展开 (dw2) 是更有效的模型？我知道这两种型号不能混用。

参考：[技术预览：gcc-4.2.1-sjlj -2](http://sourceforge.net/project/shownotes.php?release_id=532062&group_id=2435)

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-11-25T18:46:20.717

好吧，dwarf2 为每个函数建立了表，其中包含被调用者保存的寄存器是什么，它们在堆栈中保存的位置，调用堆栈中的帧指针/返回地址在哪里，以及其他一些东西。如果使用 dwarf2，编译器可以使用这些信息并有效地恢复寄存器，并在发生异常时跳转回调用者。后端需要在其实现的序言生成代码中提供信息，告诉 GCC 哪些寄存器是被调用者保存的，以及何时保存帧指针等等。

使用 setjmp/longjmp 只是一个技巧。由于 setjmp/longjmp 不知道抛出函数的结构，因此它将恢复 setjmp 保存在跳转缓冲区中的所有寄存器，即使它们没有被抛出函数覆盖。我不是这方面的专家，但我认为这显然不会有效。此外，每次启动 try 块时，都必须调用 setjmp 来设置包含已保存寄存器的缓冲区，而使用 dwarf2 时，编译器已经在编译时提供了所有必要的信息。

如果后端没有提供必要的信息，GCC 将自动回退到基于 setjmp/longjmp 的异常处理。

请注意，我不是 GCC 专家。我刚刚将工具链​​移植到我教授的一些简单处理器上，包括 GCC。我希望我能帮助你一点。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-11-25T19:59:21.287

避免sjlj。每个“try”块都会调用 setjmp 来保存寄存器，即使没有引发异常也会影响性能。使用表，正常的控制流程不会产生执行成本。只有在引发异常时，异常处理机制才必须通过表格来确定要做什么。

# c# - SharpZipLib 的基础知识。我错过了什么？

> ID：318387
> 
> 赞同：4
> 
> 时间：2008-11-25T18:23:07.940
> 
> 标签：c#, .net, .net-2.0, compression, sharpziplib

我的代码中有以下方法：

```
private bool GenerateZipFile(List<FileInfo> filesToArchive, DateTime archiveDate)
{
    try
    {
        using (ZipOutputStream zipStream = new ZipOutputStream(File.Create(GetZipFileName(archiveDate))))
        {
            zipStream.SetLevel(9); // maximum compression.
            byte[] buffer = new byte[4096];

            foreach (FileInfo fi in filesToArchive)
            {
                string fileName = ZipEntry.CleanName(fi.Name);
                ZipEntry entry = new ZipEntry(fileName);
                entry.DateTime = fi.LastWriteTime;
                zipStream.PutNextEntry(entry);

                using (FileStream fs = File.OpenRead(fi.FullName))
                {
                    StreamUtils.Copy(fs, zipStream, buffer);
                }

                zipStream.CloseEntry();
            }

            zipStream.Finish();
            zipStream.Close();
        }
        return true; 
    }
    catch (Exception ex)
    {
        OutputMessage(ex.ToString());
        return false;
    }
} 
```

此代码生成一个包含所有正确条目的 ZIP 文件，但每个文件都列为 4 TB（未打包和打包），并在我尝试打开它时创建以下错误：

```
Extracting to "C:\winnt\profiles\jbladt\LOCALS~1\Temp\"
Use Path: no   Overlay Files: yes
skipping: QPS_Inbound-20081113.txt: this file is not in the standard Zip 2.0 format
   Please see www.winzip.com/zip20.htm for more information
error:  no files were found - nothing to do 
```

代码实际上取自样本，但我似乎遗漏了一些东西。有没有人有任何指示？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-25T19:41:06.033

[在切换到DotNetZip](http://www.codeplex.com/DotNetZip)之前，我曾经使用 SharpZipLib。您可能希望将其作为替代方案进行检查。

例子：

```
try
   {
     using (ZipFile zip = new ZipFile("MyZipFile.zip")
     {
       zip.AddFile("c:\\photos\\personal\\7440-N49th.png");
       zip.AddFile("c:\\Desktop\\2005_Annual_Report.pdf");
       zip.AddFile("ReadMe.txt");
       zip.Save();
     }
   }
   catch (System.Exception ex1)
   {
     System.Console.Error.WriteLine("exception: " + ex1);
   } 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-13T04:43:55.547

见[泰勒福尔摩斯的帖子](http://blog.tylerholmes.com/2008/12/windows-xp-unzip-errors-with.html)

Winzip 8.0 和其他版本的问题在于 Zip64。添加 ZipEntry 时设置原始文件大小，错误消失。

例如

```
string fileName = ZipEntry.CleanName(fi.Name);
ZipEntry entry = new ZipEntry(fileName);
entry.DateTime = fi.LastWriteTime;
entry.Size = fi.Length;
zipStream.PutNextEntry(entry); 
```

当前版本的 zip 实用程序没有问题。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-25T18:37:14.103

我有一个类似的问题，我通过在对象上指定`CompressionMethod`和`CompressedSize`属性解决了这个问题。`ZipEntry`然而，在我的使用中，创建 zip 是为了在一次下载中组合几个非常小的文件，而不是实际压缩文件，所以我没有使用不压缩（级别 0）并使用文件的实际大小作为`CompressedSize`属性。如果需要压缩，不确定它会如何工作。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-03T22:38:48.063

为了将来遇到同样问题的任何人的利益：我的问题原来是我使用的是真正古老的 WinZip 版本（我认为是 8.0）来查看文件。使用现代查看器（12.0）解决了这个问题。

# iphone - 使用 GDB 从崩溃中检查 Objective C 类（HandleDelegateSource 错误访问）

> ID：318388
> 
> 赞同：3
> 
> 时间：2008-11-25T18:23:12.230
> 
> 标签：iphone, objective-c, gdb, arm

我正在尝试调试 iPhone 上的间歇性错误，崩溃的痕迹如下所示：

```
objc_message_send
__invoking__
[NSInvocation invoke]
HandleDelegateSource
MainRunLoop
.... 
```

当 GDB 停止时，我希望能够确定有关系统尝试调用哪个选择器的详细信息 - 我现在在 [NSInvocation Invoke] 周围设置了一个断点，但从那时起无法弄清楚如何检查详细信息我停止的 NSInvocation 对象。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2010-03-24T16:41:41.060

一个简单的最终答案 - 在 GDB 中，您可以简单地查看带有被调用选择器名称的寄存器（lothar 答案中的 Selector 参数）。它是一个 C 字符串，因此您可以使用以下命令之一观察它（取决于您是在模拟器还是设备中运行）：

```
Simulator: display /s $ecx
Device: display /s $r1 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-10T00:38:00.430

如果您查看[objc_msgSend](http://developer.apple.com/documentation/Cocoa/Reference/ObjCRuntimeRef/Reference/reference.html#//apple_ref/c/func/objc_msgSend)的参考信息，您将看到选择器是第二个参数。现在应该更容易破译调试器的输出了。

> objc_msgSend
> 将带有简单返回值的消息发送到类的实例。
> id objc_msgSend(id theReceiver, SEL theSelector, ...)
> 
> 参数
> theReceiver
> 指向要接收消息的类的实例的指针。
> theSelector
> 处理消息的方法的选择器。
> ...
> 包含方法参数的变量参数列表。

# python - 从 cygwin 运行 numpy

> ID：318390
> 
> 赞同：2
> 
> 时间：2008-11-25T18:23:15.973
> 
> 标签：python, numpy

我正在运行一台已安装 Python 2.5 的 windows 机器。我还使用 Windows 安装程序来安装 NumPy。

当我运行 Python 附带的 Python（命令行）工具时，这一切都很好。

但是，如果我运行 cygwin 然后从内部运行 Python，它找不到 numpy 包。

我需要设置什么环境变量？应该设置什么值？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-25T18:32:43.910

Cygwin 带有自己的 Python 版本，因此您的系统上可能安装了两个 Python；一个安装在 Windows 下，一个安装在 Cygwin 下。

要对此进行测试，请尝试在 Cygwin 中打开 bash 提示符并键入`which python`以查看 Python 可执行文件的位置。如果它显示`/cygdrive/c/Python25/python.exe`或类似的内容，那么您将知道您正在运行 Windows 可执行文件。如果你看到`/usr/local/bin/python`或类似的东西，那么你就会知道你正在运行 Cygwin 版本。

当您需要交互式使用时，我建议您打开 DOS 提示符并从那里运行 Python。这将使您的两个 Python 安装很好地分开（同时拥有这两个非常有用；我在自己的机器上执行此操作）。此外，在 Cygwin shell 中运行专为 Windows 交互式控制台使用而设计的程序时，您可能会遇到一些问题。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-25T18:33:31.913

您正在运行 cygwin 提供的单独的 python 副本。

您可以运行 /cygdrive/c/python25/python （或安装它的任何位置）来获取您的 win32，或者只是安装另一个 numpy 副本。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-25T18:33:33.457

确保 PYTHONPATH 具有 NumPy。请参阅[模块搜索路径（第 6.1.2 节）](http://www.python.org/doc/2.5.2/tut/node8.html)和[修改 Python 的搜索路径（第 4.1 节）](http://www.python.org/doc/2.5.2/inst/search-path.html)。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-28T14:08:41.970

为 windows 构建的 numpy 与 cygwin python 不兼容。你必须自己在cygwin上构建它。

# c++ - 为什么 C++ 编译需要这么长时间？

> ID：318398
> 
> 赞同：590
> 
> 时间：2008-11-25T18:25:14.347
> 
> 标签：c++, performance, compilation

与 C# 和 Java 相比，编译 C++ 文件需要很长时间。编译 C++ 文件比运行正常大小的 Python 脚本花费的时间要长得多。我目前正在使用 VC++，但任何编译器都一样。为什么是这样？

我能想到的两个原因是加载头文件和运行预处理器，但这似乎不能解释为什么需要这么长时间。

* * *

## 回答 #1

> 赞同：860
> 
> 时间：2008-11-25T18:38:22.417

几个原因

# 头文件

每个单独的编译单元都需要（1）加载和（2）编译成百上千个头文件。它们中的每一个通常都必须为每个编译单元重新编译，因为预处理器确保编译头文件的结果*可能*在每个编译单元之间有所不同。（一个宏可以定义在一个编译单元中，它改变了头文件的内容）。

这可能*是*主要原因，因为它需要为每个编译单元编译大量代码，此外，每个头文件都必须编译多次（每个包含它的编译单元一次）。

# 链接

编译后，所有目标文件都必须链接在一起。这基本上是一个不能很好并行化的单一过程，并且必须处理您的整个项目。

# 解析

语法分析起来非常复杂，严重依赖于上下文，并且很难消除歧义。这需要很多时间。

# 模板

在 C# 中，`List<T>`无论您的程序中有多少个 List 实例，它都是唯一被编译的类型。在 C++ 中，`vector<int>`是与 完全分开的类型`vector<float>`，每个都必须单独编译。

除此之外，模板构成了编译器必须解释的完整的图灵完备“子语言”，这可能会变得非常复杂。即使是相对简单的模板元编程代码也可以定义创建数十个模板实例的递归模板。模板也可能导致极其复杂的类型，名称长得离谱，给链接器增加了很多额外的工作。（它必须比较很多符号名称，如果这些名称可以增长到数千个字符，那可能会变得相当昂贵）。

当然，它们加剧了头文件的问题，因为模板通常必须在头文件中定义，这意味着必须为每个编译单元解析和编译更多的代码。在纯 C 代码中，标头通常只包含前向声明，但很少包含实际代码。在 C++ 中，几乎所有代码都驻留在头文件中并不少见。

# 优化

C++ 允许一些非常显着的优化。C# 或 Java 不允许类被完全消除（它们必须在那里用于反射目的），但即使是简单的 C++ 模板元程序也可以轻松生成数十或数百个类，所有这些都被内联并在优化中再次消除阶段。

此外，C++ 程序必须由编译器完全优化。AC# 程序可以依靠 JIT 编译器在加载时执行额外的优化，C++ 没有任何这样的“第二次机会”。编译器生成的内容已尽可能优化。

# 机器

C++ 被编译成机器码，这可能比 Java 或 .NET 使用的字节码复杂一些（尤其是在 x86 的情况下）。（这是出于完整性而提到的，只是因为在评论等中提到了它。在实践中，这一步不太可能占用总编译时间的一小部分）。

# 结论

大多数这些因素都由 C 代码共享，实际上编译效率很高。解析步骤在 C++ 中要复杂得多，并且会占用更多时间，但主要的问题可能是模板。它们很有用，使 C++ 成为一种更强大的语言，但它们也在编译速度方面付出了代价。

* * *

## 回答 #2

> 赞同：50
> 
> 时间：2008-11-25T19:01:22.387

解析和代码生成实际上相当快。真正的问题是打开和关闭文件。请记住，即使使用包含保护，编译器仍然会打开 .H 文件，并读取每一行（然后忽略它）。

有一次朋友（在工作无聊的时候）拿着他公司的应用程序，把所有的东西——所有的源文件和头文件——放到一个大文件中。编译时间从 3 小时减少到 7 分钟。

* * *

## 回答 #3

> 赞同：45
> 
> 时间：2008-11-25T18:55:04.630

任何编译器的减速不一定相同。

我没有使用过 Delphi 或 Kylix，但在 MS-DOS 时代，Turbo Pascal 程序几乎可以立即编译，而等效的 Turbo C++ 程序只会爬行。

两个主要区别是非常强大的模块系统和允许单遍编译的语法。

当然，编译速度可能并不是 C++ 编译器开发人员的优先考虑因素，但 C/C++ 语法中也存在一些固有的复杂性，使其更难处理。（我不是 C 方面的专家，但 Walter Bright 是，在构建了各种商业 C/C++ 编译器之后，他创建了 D 语言。[他的一项更改](http://www.digitalmars.com/d/2.0/overview.html)是强制执行上下文无关语法以使该语言更易于解析.)

此外，您会注意到通常会设置 Makefile，以便每个文件都在 C 中单独编译，因此如果 10 个源文件都使用相同的包含文件，则该包含文件将被处理 10 次。

* * *

## 回答 #4

> 赞同：18
> 
> 时间：2008-11-25T18:28:21.157

C++被编译成机器码。所以你有预处理器、编译器、优化器，最后是汇编器，所有这些都必须运行。

Java 和 C# 被编译成字节码/IL，Java 虚拟机/.NET Framework 在执行之前执行（或 JIT 编译成机器码）。

Python 是一种解释型语言，它也被编译成字节码。

我敢肯定还有其他原因，但总的来说，不必编译为本地机器语言可以节省时间。

* * *

## 回答 #5

> 赞同：18
> 
> 时间：2008-11-25T18:32:37.937

另一个原因是使用 C 预处理器来定位声明。即使有标题保护，.h 仍然必须一遍又一遍地解析，每次包含它们时。一些编译器支持可以帮助解决此问题的预编译头文件，但它们并不总是被使用。

另请参阅：[C++ 常见问题解答](http://yosefk.com/c++fqa/fqa.html#defect-3)

* * *

## 回答 #6

> 赞同：16
> 
> 时间：2015-04-23T15:30:26.420

***构建 C/C++：真正发生了什么以及为什么需要这么长时间***

软件开发的很大一部分时间不是花在编写、运行、调试甚至设计代码上，而是等待它完成编译。为了让事情变得更快，我们首先必须了解编译 C/C++ 软件时发生了什么。步骤大致如下：

*   配置
*   构建工具启动
*   依赖检查
*   汇编
*   链接

现在，我们将更详细地研究每个步骤，重点关注如何使它们变得更快。

**配置**

这是开始构建的第一步。通常意味着运行配置脚本或 CMake、Gyp、SCons 或其他一些工具。对于非常大的基于 Autotools 的配置脚本，这可能需要一秒钟到几分钟的时间。

此步骤相对很少发生。它只需要在更改配置或更改构建配置时运行。除了更改构建系统之外，没有太多工作可以让这一步更快。

**构建工具启动**

当您运行 make 或单击 IDE（通常是 make 的别名）上的构建图标时会发生这种情况。构建工具二进制启动并读取其配置文件以及构建配置，这通常是同一件事。

根据构建的复杂性和大小，这可能需要几分之一秒到几秒的时间。就其本身而言，这不会那么糟糕。不幸的是，大多数基于 make 的构建系统会导致每次构建都会调用数十到数百次。通常这是由递归使用 make 引起的（这很糟糕）。

需要注意的是，Make 这么慢的原因不是实现错误。Makefiles 的语法有一些怪癖，使得真正快速的实现几乎是不可能的。当与下一步结合时，这个问题会更加明显。

**依赖检查**

构建工具读取其配置后，必须确定哪些文件已更改以及哪些文件需要重新编译。配置文件包含描述构建依赖关系的有向无环图。此图通常在配置步骤中构建。构建工具启动时间和依赖扫描器在每个构建上运行。它们的组合运行时间决定了编辑-编译-调试周期的下限。对于小型项目，这个时间通常是几秒钟左右。这是可以忍受的。Make有替代品。其中最快的是 Ninja，它是由 Google 工程师为 Chromium 构建的。如果您使用 CMake 或 Gyp 构建，只需切换到他们的 Ninja 后端。您不必自己更改构建文件中的任何内容，只需享受速度提升。不过，大多数发行版都没有打包 Ninja，

**汇编**

此时我们终于调用了编译器。偷工减料，这里是采取的大致步骤。

*   合并包括
*   解析代码
*   代码生成/优化

与流行的看法相反，编译 C++ 实际上并没有那么慢。STL 很慢，大多数用于编译 C++ 的构建工具都很慢。然而，有更快的工具和方法来缓解语言的慢速部分。

使用它们需要一点麻烦，但好处是不可否认的。更快的构建时间会带来更快乐的开发人员、更高的敏捷性，并最终带来更好的代码。

* * *

## 回答 #7

> 赞同：15
> 
> 时间：2009-05-02T11:30:47.243

最大的问题是：

1）无限头重新解析。已经提到了。缓解措施（如 #pragma once）通常仅适用于每个编译单元，而不适用于每个构建。

2) 事实上，工具链通常被分成多个二进制文件（在极端情况下，make、预处理器、编译器、汇编程序、归档程序、impdef、链接器和 dlltool）都必须在每次调用时始终重新初始化和重新加载所有状态（编译器、汇编器）或每两个文件（归档器、链接器和 dlltool）。

另请参阅有关 comp.compilers 的讨论：[http](http://compilers.iecc.com/comparch/article/03-11-078) ://compilers.iecc.com/comparch/article/03-11-078特别是这个：

[http://compilers.iecc.com/comparch/article/02-07-128](http://compilers.iecc.com/comparch/article/02-07-128)

请注意，comp.compilers 的主持人 John 似乎同意这一点，这意味着如果完全集成工具链并实现预编译头文件，那么 C 也应该可以实现类似的速度。许多商业 C 编译器在某种程度上做到了这一点。

请注意，将所有内容分解为单独的二进制文件的 Unix 模型是 Windows 的一种最坏情况模型（进程创建速度很慢）。在比较 Windows 和 *nix 之间的 GCC 构建时间时，这是非常值得注意的，特别是如果 make/configure 系统也调用一些程序只是为了获取信息。

* * *

## 回答 #8

> 赞同：12
> 
> 时间：2008-11-25T18:27:36.730

一些原因是：

1) C++ 语法比 C# 或 Java 更复杂，需要更多时间来解析。

2）（更重要）C++ 编译器生成机器代码并在编译期间进行所有优化。C# 和 Java 只完成了一半，将这些步骤留给 JIT。

* * *

## 回答 #9

> 赞同：11
> 
> 时间：2008-11-25T18:33:53.283

编译语言总是需要比解释语言更大的初始开销。此外，也许您没有很好地构建您的 C++ 代码。例如：

```
#include "BigClass.h"

class SmallClass
{
   BigClass m_bigClass;
} 
```

编译速度比：

```
class BigClass;

class SmallClass
{
   BigClass* m_bigClass;
} 
```

* * *

## 回答 #10

> 赞同：9
> 
> 时间：2013-03-03T22:35:22.540

在大型 C++ 项目中减少编译时间的一种简单方法是创建一个 *.cpp 包含文件，其中包含项目中的所有 cpp 文件并对其进行编译。这将报头爆炸问题减少到一次。这样做的好处是编译错误仍然会引用正确的文件。

例如，假设您有 a.cpp、b.cpp 和 c.cpp.. 创建一个文件：everything.cpp：

```
#include "a.cpp"
#include "b.cpp"
#include "c.cpp" 
```

然后通过只制作everything.cpp 来编译项目

* * *

## 回答 #11

> 赞同：6
> 
> 时间：2008-12-31T15:08:32.133

你得到的权衡是程序运行得快了一点。在开发过程中，这对您来说可能是一种冷漠的安慰，但是一旦开发完成，并且程序只是由用户运行，这可能会非常重要。

* * *

## 回答 #12

> 赞同：5
> 
> 时间：2009-06-20T05:10:56.983

大多数答案都不太清楚，因为在 C++ 中仅在编译时执行一次的执行操作的成本导致 C# 总是会运行得更慢，这种性能成本也会受到运行时依赖性的影响（要加载更多的东西才能运行），更不用说 C# 程序总是有更高的内存占用，所有这些都导致性能与可用硬件的能力更密切相关。对于其他解释或依赖于 VM 的语言也是如此。

* * *

## 回答 #13

> 赞同：5
> 
> 时间：2016-08-18T02:11:17.270

我能想到的有两个问题可能会影响 C++ 程序的编译速度。

**可能的问题#1 - 编译头文件：（**这可能已经或可能没有被另一个答案或评论解决。）Microsoft Visual C++（AKA VC++）支持预编译的头文件，我强烈推荐。当您创建一个新项目并选择您正在制作的程序类型时，屏幕上应该会出现一个设置向导窗口。如果您点击底部的“下一步>”按钮，该窗口将带您进入一个包含多个功能列表的页面；确保选中“预编译头”选项旁边的框。（注意：这是我在 C++ 中使用 Win32 控制台应用程序的经验，但对于 C++ 中的所有类型的程序可能并非如此。）

**可能的问题 #2 - 编译到的位置：**今年夏天，我参加了一个编程课程，我们必须将所有项目存储在 8GB 闪存驱动器上，因为我们使用的实验室中的计算机每晚午夜都会被擦除，这会抹去我们所有的工作。如果您为了便携性/安全性等原因而编译到外部存储设备，则可能需要*很长时间*编译程序的时间（即使是我上面提到的预编译头文件），特别是如果它是一个相当大的程序。在这种情况下，我对您的建议是在您正在使用的计算机的硬盘驱动器上创建和编译程序，并且无论出于何种原因，当您想要/需要停止处理您的项目时，将它们传输到您的外部存储设备，然后单击“安全删除硬件并弹出媒体”图标，该图标应显示为一个小闪存驱动器，位于带有白色复选标记的绿色小圆圈后面，以断开连接。

我希望这可以帮助你; 让我知道是否有！:)

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2020-09-10T14:08:10.090

简单地回答这个问题，C++ 是一种比市场上可用的其他语言复杂得多的语言。它有一个传统的包含模型，可以多次解析代码，并且它的模板库没有针对编译速度进行优化。

**语法和 ADL**

让我们通过一个非常简单的例子来看看 C++ 的语法复杂性：

```
x*y; 
```

虽然您可能会说上面是乘法表达式，但在 C++ 中不一定是这种情况。如果 x 是一个类型，那么该语句实际上就是一个指针声明。这意味着 C++ 语法是上下文相关的。

这是另一个例子：

```
foo<x> a; 
```

同样，您可能认为这是 foo 类型的变量“a”的声明，但它也可以解释为：

```
(foo < x) > a; 
```

这将使它成为一个比较表达式。

C++ 有一个称为参数相关查找 (ADL) 的功能。ADL 建立了管理编译器如何查找名称的规则。考虑以下示例：

```
namespace A{
  struct Aa{}; 
  void foo(Aa arg);
}
namespace B{
  struct Bb{};
  void foo(A::Aa arg, Bb arg2);
}
namespace C{ 
  struct Cc{}; 
  void foo(A::Aa arg, B::Bb arg2, C::Cc arg3);
}

foo(A::Aa{}, B::Bb{}, C::Cc{}); 
```

ADL 规则规定，考虑到函数调用的所有参数，我们将寻找名称“foo”。在这种情况下，所有名为“foo”的函数都将被视为重载决议。这个过程可能需要一些时间，尤其是在有很多函数重载的情况下。在模板化的上下文中，ADL 规则变得更加复杂。

**＃包括**

该命令可能会显着影响编译时间。根据您包含的文件类型，预处理器可能只复制几行代码，也可能复制数千行。

此外，编译器无法优化此命令。如果头文件依赖于宏，您可以复制可以在包含之前修改的不同代码段。

这些问题有一些解决方案。您可以使用预编译的标头，它是编译器对标头中所解析内容的内部表示。然而，如果没有用户的努力，这是无法完成的，因为预编译的头文件假定头文件不依赖于宏。

模块功能为这个问题提供了语言级别的解决方案。它从 C++20 版本开始提供。

**模板**

模板的编译速度具有挑战性。每个使用模板的翻译单元都需要包含它们，并且这些模板的定义需要可用。模板的一些实例化最终会成为其他模板的实例化。在某些极端情况下，模板实例化会消耗大量资源。使用模板并且不是为编译速度而设计的库可能会变得很麻烦，正如您在此链接提供的元编程库的比较中看到的那样：http: [//metaben.ch/](http://metaben.ch/)。它们在编译速度上的差异很大。

如果您想了解为什么某些元编程库的编译时间比其他库更好，请查看[有关 Chiel 规则的视频](https://www.youtube.com/watch?v=EtU4RDCCsiU&feature=youtu.be&t=491)。

**结论**

C++ 是一种缓慢编译的语言，因为在最初开发该语言时，编译性能并不是最高优先级。结果，C++ 最终获得了在运行时可能有效但在编译时不一定有效的特性。

PS——我在Incredibuild工作，这是一家专门从事加速C++编译的软件开发加速公司，欢迎大家[免费试用](https://www.incredibuild.com/ibonlinestore/register#/regWindows?utm_source=stackoverflow&utm_medium=question&utm_campaign=answer&utm_content=download)。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2020-09-05T15:31:50.107

在大型面向对象项目中，重要的原因是 C++ 难以限制依赖关系。

私有函数需要在其各自类的公共标头中列出，这使得依赖项比它们需要的更具传递性（传染性）：

```
// Ugly private dependencies
#include <map>
#include <list>
#include <chrono>
#include <stdio.h>
#include <Internal/SecretArea.h>
#include <ThirdParty/GodObjectFactory.h>

class ICantHelpButShowMyPrivatePartsSorry
{
public:
    int facade(int);

private:
    std::map<int, int> implementation_detail_1(std::list<int>);
    std::chrono::years implementation_detail_2(FILE*);
    Intern::SecretArea implementation_detail_3(const GodObjectFactory&);
}; 
```

如果这种模式被幸福地重复到头文件的依赖树中，这往往会创建一些“上帝头文件”，这些头文件间接包含项目中所有头文件的大部分。[它们就像上帝对象](https://en.wikipedia.org/wiki/God_object)一样无所不知，只是在绘制它们的包含树之前这并不明显。

这以两种方式增加了编译时间：

1.  他们添加到包含它们的每个编译单元（.cpp 文件）的代码量很容易比 cpp 文件本身多很多倍。从这个角度来看，[catch2.hpp](https://github.com/catchorg/catch2)是 18000 行，而大多数人（甚至 IDE）开始难以编辑大于 1000-10000 行的文件。
2.  编辑标题时必须重新编译的文件数量不包含在依赖它的真正文件集中。

是的，有一些缓解措施，比如前向声明，[它已经感知到](https://google.github.io/styleguide/cppguide.html#Forward_Declarations)了缺点，或者[pimpl idiom](https://en.wikipedia.org/wiki/Opaque_pointer)，这是一个非零成本抽象。尽管 C++ 在你能做的事情上是无限的，但如果你离它的本意太远，你的同行会想知道你一直在抽烟。

最糟糕的部分：如果您考虑一下，甚至不需要在其公共头文件中声明私有函数：成员函数的道德等价物可以并且通常在 C 中被模仿，这不会重现此问题。

# linux - 这个构建系统可以加速吗？

> ID：318405
> 
> 赞同：3
> 
> 时间：2008-11-25T18:27:44.077
> 
> 标签：linux, optimization, makefile, symlink

我们的构建速度很慢。它在 linux 上使用嵌套的 gnu makefile。它为来自同一源树的三个不同目标创建三个构建。它使用符号链接依次指向三个并行目录树中的每一个。我们可以通过在子目录中使用 make 来进行部分构建，这样可以节省时间，但如果我们的工作跨越多个目录，我们必须为三个目标中的至少一个进行构建，这至少需要 45 分钟。仅构建子目录可能需要“仅”5-10 分钟。

你知道有什么快速检查可能会阻碍这个构建系统的事情吗？例如，是否有更快的符号链接替代方案？

另外：我看过有关递归生成文件的论文。有没有人知道将当前有许多 makefile（大约 800 个）和超过 450 万行源代码的 Makefile 系统扁平化会产生什么影响？人们目前喜欢通过在该目录中使用 make 来构建他们当前的子目录或进程（嵌入式 linux 目标）。

我刚刚了解到，直到最近，构建时间是原来的两倍（*wince*），此时发布工程师部署了 ccache。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-25T18:34:37.883

我不确定为什么在您的情况下需要符号链接。如果您从同一个源构建多个目标，您可以尝试将中间文件和目标文件放在不同的目录中。

此外，您可以尝试使用[jam](http://www.perforce.com/jam/jam.html)之类的东西，而不是嵌套的[makefile](http://aegis.sourceforge.net/auug97.pdf)。如果您有多个 CPU，您可以尝试*n*，其中*n*是 CPU 的数量 + 1。`make -j`

 *** * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-25T19:32:23.057

加快构建的注意事项：

构建往往受 I/O 限制，因此将 I/O 分布在多个驱动器/控制器或机器上。例如，将源放在一个物理驱动器上，将目标（构建输出）放在另一个物理驱动器上，并将这两个驱动器与包含构建工具（.NET、Java、Ant 等）的物理驱动器分开。 ) 和包含您的操作系统的物理驱动器。

构建通常可以异步完成，因此建立和使用单独的构建机器（持续集成服务器）。将此特别用于计算指标、生成文档、生成候选版本以及开发人员工作站上花费太长时间或不需要的任何其他事情。

构建工具通常涉及大量进程启动/关闭开销，因此请选择将这些开销降至最低的工具、脚本和过程。对于像 make 和 Ant 这样倾向于将其他工具作为子流程调用的工具尤其如此。例如，我正在转向基于 Python 的构建系统，这样我就可以从单个进程中完成大部分构建处理，但仍然能够在必要时轻松生成其他进程。

构建工具通常支持基于检测到它们将不执行任何操作而跳过构建步骤（不要编译，因为自上次编译以来源未更改）。但是，默认情况下，对跳过构建步骤的支持通常是不活动的——您可能需要专门调用它。例如，编译器通常会自动执行此操作，但代码生成不会。当然，对此的推论是尽可能使用增量构建（在您的工作站上开发时，只要它“行为”）。

构建脚本可以快速轻松地变得非常复杂，因此请花时间让它们变得简单。首先，将构建分成单独的项目，每个项目只构建一个“工件”，例如 JAR、DLL 或 EXE。这允许您通过仅不调用您目前不需要的长构建来节省大量时间。其次，通过从不进入另一个项目来简化每个项目的构建——始终通过构建工件而不是源来建立您的项目依赖关系。这将使每个项目独立，您可以使用“超级”脚本随意构建项目的各种子集。

最后，将您的构建基础设施视为一个真正的项目——记录错误和针对它的功能请求、版本化、执行官方发布，并无限期地继续完善它。将其视为必不可少的产品，而不是事后的想法：您的构建是任何健康项目的命脉，如果您关心它，它可以节省您的面包。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-25T18:40:56.593

如果您有不止一台计算机可用于编译，您也可以使用[distcc](http://code.google.com/p/distcc/)。这将构建过程分散到多台计算机上，结合 make -j 2 可以进一步加快速度。

根据项目的大小，瓶颈实际上可能与编译器有关（即您启用 -O2 或 -O3），除了缩小源代码或删除未使用的 #include 之外，可能没有什么可以做的文件。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-25T19:42:29.247

提到嵌套的 makefile 表明[“Recursive Make Considered Harmful”](http://miller.emu.id.au/pmiller/books/rmch/?ref=DDiyet.Com)中建议的方法可能会有所帮助。从摘要：

> 分析表明，问题源于人为地将构建划分为单独的子集。这反过来又会导致所描述的症状。为了避免症状，只需要避免分离；为整个项目使用单个 Makefile。

（单个逻辑 makefile 仍然可以由多个物理文件组成。）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-25T18:41:19.417

我们用冰淇淋。不是在构建时消磨时间，而是加快构建过程。它是一个分布式编译环境，使用办公室所有PC的空闲CPU时间。我们的设置非常复杂，因为我们有一个交叉编译环境，但如果您不进行交叉编译，它可能会简单得多。 [http://en.opensuse.org/Icecream](http://en.opensuse.org/Icecream)

# c++ - ApplicationVerifier 未检测到句柄泄漏，我该怎么办？

> ID：318420
> 
> 赞同：0
> 
> 时间：2008-11-25T18:32:49.853
> 
> 标签：c++, visual-c++, application-verifier

我确实正确选择了可执行文件，因为我可以让它响应我所做的某些事情。但我无法让 ApplicationVerifier 正确检测句柄泄漏。

这是一个例子：

```
int APIENTRY _tWinMain(HINSTANCE hInstance,
                     HINSTANCE hPrevInstance,
                     LPTSTR    lpCmdLine,
                     int       nCmdShow)
{
    HANDLE hFile = CreateFile(_T("C:\\test.txt"), GENERIC_WRITE, 0, NULL, CREATE_ALWAYS, 0, NULL);
    return 0;
} 
```

ApplicationVerifier 没有检测到这一点。

我该怎么做才能检测到上述问题？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-25T19:03:56.127

您的代码是否仅通过 CreateFile 创建句柄？如果是这样，您可以将这些方法宏扩展到执行自定义实现泄漏检测的版本。这是很多工作，但它会完成工作。

```
#if DEBUG
#define CreateFile DebugCreateFile
#define CloseHandle DebugCloseHandle
#endif
// in another cpp file
#undef CreateFile
#undef CloseHandle
HANDLE DebugCreateFile(...) {
  HANDLE real = ::CreateFile(...);
  TrackHandle(real);
  return real;
}
void DebugCloseHandle(HANDLE target) {
  if (IsTracked(target)) { Untrack(target); }
  ::CloseHandle(target);
}
void CheckForLeaks() {
  // Look for still registered handles
} 
```

在程序结束时，您需要调用 CheckForLeaks。就像我说的那样，虽然有很多工作，但它可能对您的场景有所帮助。

# unicode - GB、Big5、Unicode 的任何好的转换器

> ID：318434
> 
> 赞同：1
> 
> 时间：2008-11-25T18:37:04.947
> 
> 标签：unicode, cjk

GB、Big5、Unicode 有什么好的转换器吗？

将GB转换为Unicode，将Unicode转换为GB，将Big5转换为Unicode，将Unicode转换为Big5，将GB转换为Big5。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-25T19:09:56.440

iconv 应该能够完成这项工作。它是 GNU C 库的一部分。

```
http://en.wikipedia.org/wiki/Iconv
http://www.gnu.org/software/libiconv/ 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-01-06T14:36:06.843

我建议使用[http://unicode.codeplex.com](http://unicode.codeplex.com)上codeplex 提供的**Unicode 转换器**，它是具有 GNU 2.0 许可证的免费和开源软件。

此应用程序将 char 或 sring 转换为 Hxcde 或 Decimal 并为您提供有关每个 char 的完整信息，您可以通过提供的编辑器创建 unicode 文本并随时更改您的句子，

真的是一个好用又好用的应用

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-09T10:40:42.593

如果它是您需要的转换工具，您可以尝试：

```
http://alf-li.pcdiscuss.com/c_convertz.html 
```

对我来说真的很有用，它可以执行 GB/BIG5/UNICODE。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-10T00:09:22.060

查看[ICU](http://site.icu-project.org/)，Unicode 的国际组件。你很可能会在那里找到你需要的东西。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-07-07T11:16:12.920

iconv 可以处理这些。

*   将 GB 转换为 Unicode
*   Unicode 转 GB
*   Big5 到 Unicode
*   Unicode 到 Big5

但不是

*   GB 到 Big5。

预计会有很多缺失的字符。

# keystore - 信任库和密钥库定义

> ID：318441
> 
> 赞同：311
> 
> 时间：2008-11-25T18:38:22.590
> 
> 标签：keystore, encryption-asymmetric, truststore

密钥库和信任库有什么区别？

* * *

## 回答 #1

> 赞同：295
> 
> 时间：2008-11-25T18:42:07.543

密钥库包含私钥，以及带有相应公钥的证书。

信任库包含来自您希望与之通信的其他方的证书，或者来自您信任以识别其他方的证书颁发机构的证书。

* * *

## 回答 #2

> 赞同：90
> 
> 时间：2009-09-18T16:35:57.040

1.  密钥库包含私钥。仅当您是服务器或服务器需要客户端身份验证时才需要此功能。

2.  信任库包含要信任的 CA 证书。如果您的服务器证书由公认的 CA 签名，则 JRE 附带的默认信任库将已经信任它（因为它已经信任可信赖的 CA），因此您无需构建自己的证书，或向其中添加任何内容来自 JRE。

[来源](http://mynotes.wordpress.com/2009/08/04/difference-between-keystore-truststore)

* * *

## 回答 #3

> 赞同：80
> 
> 时间：2013-09-20T08:44:48.910

在 SSL 握手中**trustStore 的目的是验证凭据**，而 keyStore的目的**是提供凭据**。

**密钥库**

Java 中的 keyStore 存储与其公钥对应的私钥和证书，如果您是 SSL 服务器或 SSL 需要客户端身份验证，则需要。

**信任库**

TrustStore 存储来自第三方的证书、您的 Java 应用程序通信或由 CA（Verisign、Thawte、Geotrust 或 GoDaddy 等证书颁发机构）签署的证书，可用于识别第三方。

**信任管理器**

TrustManager 确定远程连接是否应该被信任，即远程方是否是它声称的对象，而 KeyManager 决定在 SSL 握手期间应该将哪些身份验证凭据发送到远程主机进行身份验证。

如果您是 SSL 服务器，您将在密钥交换算法期间使用私钥并将与您的公钥对应的证书发送给客户端，该证书是从 keyStore 获取的。在 SSL 客户端，如果它是用 Java 编写的，它将使用存储在 trustStore 中的证书来验证服务器的身份。SSL 证书通常以**.cer文件的形式出现，该文件通过使用任何密钥管理实用程序（例如****keytool**）添加到 keyStore 或 trustStore 中。

来源：http: [//javarevisited.blogspot.ch](http://javarevisited.blogspot.ch/2012/09/difference-between-truststore-vs-keyStore-Java-SSL.html)

* * *

## 回答 #4

> 赞同：31
> 
> 时间：2010-01-03T00:01:21.130

作为标准 JSSE 文档的一部分，您可能还对 Sun 的文章感兴趣：

[http://docs.oracle.com/javase/8/docs/technotes/guides/security/jsse/JSSERefGuide.html#Stores](http://docs.oracle.com/javase/8/docs/technotes/guides/security/jsse/JSSERefGuide.html#Stores)

通常，信任库仅用于存储公钥，用于验证目的，例如 X.509 身份验证。出于可管理性的目的，管理员或开发人员将两者简单地合并到一个商店中是很常见的。

* * *

## 回答 #5

> 赞同：12
> 
> 时间：2014-03-24T21:23:22.167

> 在 Java 中，密钥库和信任库有什么区别？

[这是Java Secure Socket Extension (JSSE) Reference Guide](http://download.java.net/jdk8/docs/technotes/guides/security/jsse/JSSERefGuide.html)中 Java 文档的描述。我不认为它告诉你任何与其他人所说的不同的东西。但它确实提供了官方参考。

> **密钥库/信任库**
> 
> 密钥库是密钥材料的数据库。密钥材料用于多种目的，包括身份验证和数据完整性。有多种类型的密钥库可用，包括 PKCS12 和 Oracle 的 JKS。
> 
> 一般来说，密钥库信息可以分为两类：密钥条目和可信证书条目。密钥条目由实体的身份及其私钥组成，可用于各种加密目的。相反，受信任的证书条目除了实体的身份之外仅包含一个公钥。因此，不能在需要私钥的地方使用受信任的证书条目，例如在 javax.net.ssl.KeyManager 中。在 JKS 的 JDK 实现中，密钥库可能同时包含密钥条目和可信证书条目。
> 
> 信任库是在决定信任什么时使用的密钥库。如果您从您已经信任的实体接收数据，并且如果您可以验证该实体是它声称的实体，那么您可以假设数据确实来自该实体。
> 
> 仅当用户信任该实体时，才应将条目添加到信任库。通过生成密钥对或导入证书，用户信任该条目。信任库中的任何条目都被视为可信条目。
> 
> 拥有两个不同的密钥库文件可能很有用：一个仅包含您的密钥条目，另一个包含您的受信任证书条目，包括 CA 证书。前者包含私人信息，而后者不包含。使用两个文件而不是单个密钥库文件可以更清晰地区分您自己的证书（和相应的私钥）与其他人的证书之间的逻辑区别。要为您的私钥提供更多保护，请将它们存储在访问受限的密钥库中，并在需要时在更公开访问的密钥库中提供受信任的证书。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2016-01-13T15:27:31.710

1.  trustStore 和 keyStore 之间的第一个也是主要的区别是 TrustManager 使用 trustStore 来确定是否应该信任远程连接，而 KeyManager 使用 keyStore 来决定在 SSL 握手期间应该将哪些身份验证凭据发送到远程主机进行身份验证。

2.  另一个区别是，keyStore 理论上包含仅当您在 SSL 连接中运行服务器或在服务器端启用客户端身份验证时才需要的私钥，另一方面，trustStore 存储来自 CA（证书颁发机构）的公钥或证书，用于信任远程方或 SSL 连接。

    实际上，您可以将私钥和公钥存储在同一个文件中，因为管理这些文件的工具是相同的（keytool），因此*您可以*将单个文件用于这两个目的，但您可能*不应该*使用.

3.  至少在我的 Mac OSX 上，默认 keyStore 是`${user.home}/.keystore`，默认 trustStore 是`/System/Library/Java/Support/CoreDeploy.bundle/Contents/Home/lib/security/cacerts`.

    如果要覆盖它们，则应添加 JVM 参数 `-Djavax.net.ssl.keyStore /path/to/keyStore`或 `-Djavax.net.ssl.trustStore /path/to/trustStore`. 在 的情况下，您可能还需要设置 keyStore 密码 `java.security.UnrecoverableKeyException: Password must not be null`，使用参数 `-Djavax.net.ssl.trustStorePassword=password`或`-Djavax.net.ssl.trustStorePassword=password`

*主要来源：*

> [http://javarevisited.blogspot.co.uk/2012/09/difference-between-truststore-vs-keyStore-Java-SSL.html](http://javarevisited.blogspot.co.uk/2012/09/difference-between-truststore-vs-keyStore-Java-SSL.html)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2020-10-05T14:52:41.403

Keystore 用于存储特定程序应提供给双方（服务器或客户端）以进行验证的私钥和身份证书。

Truststore 用于存储来自认证机构 (CA) 的证书，这些证书验证服务器在 SSL 连接中提供的证书。

本文供参考[https://www.education.io/edpresso/keystore-vs-truststore](https://www.educative.io/edpresso/keystore-vs-truststore)

# html - UI 在 Web 表单中指示“部分必填”字段？

> ID：318449
> 
> 赞同：0
> 
> 时间：2008-11-25T18:41:58.477
> 
> 标签：html, validation, webforms, usability

我有一组需要选择的单选按钮。此外，其中一个选项旁边会显示一个可选文本框。

明确什么是必需的和什么是可选的最好的方法是什么？

```
<strong>User Availability:</strong><br>
<input value="Available" type="radio"> Available<br />
<input value="Unvailable" type="radio"> Unvailable
until <input type="text"> <small>MM/DD/YYYY</small> 
```

提前感谢您的任何想法。我也对完全不同的方法持开放态度。

**澄清：** “可选”部分是日期。您必须选择可用或不可用。但日期是可选的。

这是一个 UI 问题，而不是技术问题。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-25T18:47:14.927

您可以在该字段旁边添加一条消息。例如（这里的消息可能不是最好的）。

[ ] 可用

[ ] 不可用（对于“不可用”）直到 _______________

您也可以只在选择“不可用”时才显示文本框。

[X] 可用

[ ] 不可用

[ ] 可用的

[X] 在 [_______________] 之前不可用

您还可以在他们选择“不可用”时必须填写日期的说明中明确说明。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-25T18:48:23.083

您是从 UI 角度还是技术角度提问？

您可以隐藏所需的文本框，并且仅在用户选择“可用”选项时才显示。

您可以在 javascript 中执行此操作，也可以在代码后面的更新面板中执行此操作。

你在使用.NET吗？在您的 page_init 中，您可以为您的可用单选按钮添加一个属性。

Attribute.Add("onClick", "RevealTextbox();")

那么您的javascript将只是：

功能显示文本框（）{

textbox.style.display = '块'

}

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-25T18:46:14.303

假设“mm/dd/yyy”是文本框，我会将此文本放在文本框中，当用户单击或以其他方式将焦点放在文本框上时，它会被清除：

（日期）（可选）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-25T22:27:49.147

为什么要费心展示一些没人关心的东西呢？如果您或您的用户关心日期，那么这将是强制性的。

# winforms - 调整大小时带有巨大黑色闪烁的蒙皮 C# 表单！

> ID：318452
> 
> 赞同：2
> 
> 时间：2008-11-25T18:42:28.743
> 
> 标签：winforms, visual-studio-2008, resize, flicker, skin

我正在尝试使用与您通常看到的不同的方法创建一些蒙皮表单（只是边框和标题），但是在调整表单大小时我遇到了表单闪烁的一些问题。

我不知道如何解释这个问题，所以这是我创建的一个视频来演示这个问题： [http ://www.screencast.com/t/AIqK9Szmz](http://www.screencast.com/t/AIqK9Szmz)

此外，这是一个 VS2008 测试解决方案，其中包含重新绘制表单边框的整个代码：http: [//stuff.nazgulled.net/misc/TestForm.zip](http://stuff.nazgulled.net/misc/TestForm.zip)

希望有人能帮助我摆脱闪烁...

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-25T18:56:16.547

这就是我在基本表单的构造函数中使用的：

```
this.SetStyle( ControlStyles.AllPaintingInWmPaint, true );
this.SetStyle( ControlStyles.UserPaint, true );
this.SetStyle( ControlStyles.OptimizedDoubleBuffer, true );
this.SetStyle( ControlStyles.ResizeRedraw, true ); 
```

我认为关键是使用“AllPaintingInWmPaint”。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-26T13:34:04.417

如果您想让您的表单具有不规则的形状，您将不得不转向区域（如果您可以使用圆形和矩形等几何形状轻松定义表单的区域）。创建一个 System.Drawing.Graphics.Region 对象并向其添加形状。我认为表单上的属性称为区域 - 将您创建的区域分配给它。

您的另一个选择是使用分层窗口。有人[为你做了所有的工作](http://blogs.msdn.com/mswanson/archive/2005/07/07/436618.aspx "文章")。分层窗口不适用于早于 2000 的 Windows 版本，但它们具有半透明的额外好处。

您的最终选择是使用 WPF 并设置 AllowsTransparency="True" WindowStyle="None"。这将删除铬（谷歌“无铬窗口 WPF”，例如一百万个示例）。

最后，如果您勇敢且有耐心，您总是可以在窗口后面捕捉桌面并在其他任何事情之前对其进行绘制。如果您的窗口移动，您将需要求助于一些花哨的黑客：我并不真正推荐这种方法 - 但您需要知道所有选项。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-15T16:36:15.380

（这是一个特定于 Vista 的解决方案；它仅在启用桌面合成时才有效。）

看起来 Windows 通过将表单原始边框上的像素复制到新区域来初始化调整大小的表单的内容。在您的情况下，新区域可能被初始化为黑色，因为表单最初在其边界处具有黑色像素。

要消除闪烁，只需将表单中最右边和最底部的像素线始终设置为 TransparencyKey - 这将使新区域保持透明，直到您有机会重新绘制它们。即，使表格比必要的宽和高 1 个像素，并将多余的像素涂成透明的。

示例：[TransparentForm.zip](http://fnord.hu/TransparentForm.zip)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-26T12:32:26.850

如果您想避免丑陋的未初始化黑色视频覆盖闪烁，您将不得不放弃使用 Form.TransparencyKey 属性。它在您的示例程序中没有任何用处。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-26T13:00:33.393

尝试启用双缓冲？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-26T13:38:07.967

哦，顺便说一句，除非你把所有的绘制逻辑都放在 override OnPaint() 中，否则使用 SLIMcode 的代码是行不通的。如果这听起来不熟悉，您可能不知道您可以通过在表单上调用 Invalidate() 来强制要求重绘。将您的代码重构为一个单一的 Paint 方法是一项任务——但它最终会产生更清晰的代码。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2011-10-13T20:23:26.497

要在调整 win 表单大小时消除闪烁，请在调整大小时暂停布局。覆盖表单 resizebegin/resizeend 方法，如下所示。

```
protected override void OnResizeBegin(EventArgs e) {
    SuspendLayout();
    base.OnResizeBegin(e);
}
protected override void OnResizeEnd(EventArgs e) {
    ResumeLayout();
    base.OnResizeEnd(e);
} 
```

这将使控件保持不变（与调整大小之前一样）并在调整大小操作完成时强制重绘。

# .net - 如何识别 GC Finalizer 线程？

> ID：318462
> 
> 赞同：7
> 
> 时间：2008-11-25T18:46:40.090
> 
> 标签：.net, multithreading, finalizer

我有一个 .NET (C#) 多线程应用程序，我想知道某个方法是否在 Finalizer 线程中运行。

我试过使用 Thread.CurrentThread.Name 但它不起作用（返回 null）。

任何人都知道如何查询当前线程以发现它是否是终结器线程？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-11-25T19:06:48.600

识别线程的最佳方法是通过其托管 id：

```
Thread.CurrentThread.ManagedThreadId; 
```

由于终结器始终在 GC 的线程中运行，您可以创建一个终结器，将线程 ID（或线程对象）保存在静态变量中。

样本：

```
public class ThreadTest {
    public static Thread GCThread;

    ~ThreadTest() {
        ThreadTest.GCThread = Thread.CurrentThread;
    }
} 
```

在您的代码中，只需创建此类的一个实例并进行垃圾收集：

```
public static void Main() {
    ThreadTest test = new ThreadTest();
    test = null;
    GC.Collect();
    GC.WaitForPendingFinalizers();

    Console.WriteLine(ThreadTest.GCThread.ManagedThreadID);
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-11T21:30:50.700

如果调试是一个选项，您可以使用 WinDbg + SoS.dll 轻松找到它。该`!threads`命令显示应用程序中的所有托管线程，并且终结器线程特别突出显示并带有注释。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-25T19:55:30.390

Y Low 的代码可以稍微改进...

```
public static void Main()
{
  ThreadTest test = new ThreadTest();
  test = null;

  GC.Collect();
  GC.WaitForPendingFinalizers();

  Console.WriteLine(ThreadTest.GCThread.ManagedThreadID);
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-25T19:06:30.690

我认为即使使用调试 API 也是不可能的，请参阅[此](http://blogs.msdn.com/jmstall/archive/2006/03/02/expose-finalizer-thread.aspx)博客文章了解更多信息。

# sql - SQL Server - 使用另一个表中的第一行和最后一行更新一个表

> ID：318473
> 
> 赞同：0
> 
> 时间：2008-11-25T18:50:56.633
> 
> 标签：sql, sql-server, sql-server-2005

我有几个表用于记录应用程序的用户活动。这些表看起来像这样（内存中的伪代码，可能在语法上不正确）：

```
create table activity (
  sessionid uniqueidentifier not null,
  created smalldatetime not null default getutcdate()
);

create table activity_details (
  sessionid uniqueidentifier not null,
  activity_description varchar(100) not null,
  created smalldatetime not null default getutcdate()
); 
```

我的目标是为报告目的填充一个汇总表，如下所示：

```
create table activity_summary (
  sessionid uniqueidentifier not null,
  first_activity_desc varchar(100) not null,
  last_activity_desc varchar(100) not null
); 
```

第一个和最后一个活动描述将按时间顺序确定。我最初的想法是像这样更新汇总表：

```
truncate table activity_summary;

insert into activity_summary (sessionid)
select sessionid from activity;

update table activity_summary set
  first_activity_desc = (select top 1 activity_desc from activity_detail where sessionid = as.sessionid order by created asc),
  last_activity_summary = (select top 1 activity_desc from activity_detail where sessionid = as.sessionid order by created desc)
from activity_summary as; 
```

但是，这对我来说似乎非常冗长且不必要。我只是不确定如何缩小它。我的直觉是我可以在插入语句中以某种方式完成所有操作，但我很难过。有什么建议么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-25T19:00:39.097

可能还有更有效的方法可以做到这一点，但这最接近您的原始方法：

```
truncate table activity_summary;

insert into activity_summary (sessionid, first_activity_desc, last_activity_summary)
select a.sessionid
,(select top 1 ad.activity_desc from activity_detail AS ad where ad.sessionid = a.sessionid order by ad.created asc) AS first_activity_desc
,(select top 1 ad.activity_desc from activity_detail AS ad where ad.sessionid = a.sessionid order by ad.created desc) AS last_activity_summary
from activity AS a; 
```

像这样的东西可能更有效：

```
truncate table activity_summary;

WITH firsts AS (
    SELECT ad.sessionid
        ,ad.activity_desc
        ,ROW_NUMBER() OVER (ORDER BY ad.created ASC) as RowNumber
    FROM activity_detail AS ad
)
,lasts AS (
    SELECT ad.sessionid
        ,ad.activity_desc
        ,ROW_NUMBER() OVER (ORDER BY ad.created DESC) as RowNumber
    FROM activity_detail AS ad
)
insert into activity_summary (sessionid, first_activity_desc, last_activity_summary)
select a.sessionid
    ,firsts.activity_desc
    ,lasts.activity_desc
from activity AS a
INNER JOIN firsts ON firsts.sessionid = a.sessionid AND firsts.RowNumber = 1
INNER JOIN lasts ON lasts.sessionid = a.sessionid AND lasts.RowNumber = 1 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-25T19:07:15.650

```
insert into activity_summary
    (sessionid, first_activity_desc, last_activity_desc)
select
    agg.sessionid,
    adf.activity_description,
    adl.activity_description
from
    (SELECT
         sessionid, MIN(created) as firstcreated, MAX(created) as lastcreated
    from
         activity_detail group by sessionid
    ) agg
    JOIN
    activity_details adf ON agg.sessionid = adf.sessionid AND agg.firstcreated = adf.created
    JOIN
    activity_details adl ON agg.sessionid = adl.sessionid AND agg.lastcreated = adl.created 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-25T19:18:00.730

大致，

插入等

```
SELECT a.sessionid, d1.activity_description, d2.activity_description

FROM activity a

JOIN detail d1 ON a.sessionid = d1.sessionid
JOIN detail d2 ON a.sessionid = d2.sessionid

WHERE NOT EXISTS  
  (SELECT 1 FROM detail WHERE sessionid = a.sessionid AND created < d1.created)

AND NOT EXISTS  
  (SELECT 1 FROM detail WHERE sessionid = a.sessionid AND created > d2.created) 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-25T19:24:13.633

或者，

插入等

（从详细信息 d1 中选择描述，其中 d1.sessionid = a.sessionid
并且不存在（从详细信息中选择 1，其中创建 < d1.created））作为 desc1，

（从详细信息 d2 中选择描述，其中 d2.sessionid = a.sessionid
并且不存在（从详细信息 d2 中选择 1，其中创建 > d1.created））AS desc2

FROM 活动

（我自己更喜欢这个。）

# asp.net - 数据库文件和 ASP.NET 登录控件

> ID：318475
> 
> 赞同：4
> 
> 时间：2008-11-25T18:52:05.963
> 
> 标签：asp.net, sql-server, security, login

我正在尝试 ASP.NET 登录控制教程，一切正常。但是，我不知道如何让登录控件使用我自己的数据库（SQL Server 2005）而不是使用它的 mdf 文件。我也不知道这个文件是从哪里创建的，因为它根本没有出现在我的解决方案中。任何我能找到的关于登录控件工作的文献都将不胜感激。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-25T19:09:58.530

当您使用 ASP.NET 的 Membership 功能时，您需要指定一个提供者。在 machine.config 文件（位于 C:\WINDOWS\Microsoft.NET\Framework\[version]\CONFIG）中，指定了一个默认提供程序，该提供程序使用 app_data 文件夹中的本地 .mdf 文件。由于您不希望这样，您可以在应用程序的 web.config 文件中覆盖它，如下所示：

```
<system.web>
  <membership defaultProvider="myMembershipProvider">
    <providers>
      <clear /> <!-- remove the default provider since we're not using it anymore -->
      <add type="System.Web.Security.SqlMembershipProvider"
           name="myMembershipProvider"
           connectionStringName="myConnectionString"
           applicationName="MyApplicationName" />
    </providers>
  </membership>
</system.web> 
```

如果您使用角色、个性化或配置文件等其他功能，您还需要以类似方式为它们定义提供程序。

现在您需要在服务器上实际创建数据库/表。为此，请使用 C:\WINDOWS\Microsoft.NET\Framework\[version]\aspnet_regsql.exe。您的提供者的连接字符串应该指向该实用程序将为您创建的数据库。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-25T19:06:24.683

一些优秀的 asp.net 登录控件参考：

[站点点](http://www.sitepoint.com/article/asp-net-2-security/)

[MSDN](http://msdn.microsoft.com/en-us/library/ms178329.aspx)

和[asp.net](http://www.asp.net/learn/security/)

# webapplicationstresstool - Microsoft 的 Web 应用程序压力工具出现 404 和 501 错误

> ID：318487
> 
> 赞同：2
> 
> 时间：2008-11-25T18:58:34.687
> 
> 标签：webapplicationstresstool

我已经用这个工具记录了一些脚本，但是当我运行它时，我 100% 的结果代码要么是 404（未找到）要么是 501（未实现）。

怎么会这样？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-25T19:02:00.967

如果我没记错的话，在运行测试之前，您必须在屏幕顶部附近指定要测试的主机。我记得发现这种奇怪的东西，并认为主机应该与脚本一起记录，但它只记录了路径作为脚本的一部分。

我可能正在考虑一个完全不同的程序，如果是这样的话，请原谅我。

# php - 从平面数据在 PHP 中构建分层 html 标签

> ID：318488
> 
> 赞同：2
> 
> 时间：2008-11-25T18:58:47.633
> 
> 标签：php, html, hierarchy

如何在 PHP 中使用数据构建一组分层标签？

例如，一个嵌套列表：

```
<div>
    <ul>
        <li>foo
        </li>
        <li>bar
            <ul>
                <li>sub-bar
                </li>
            </ul>
        </li>
    </ul>
</div> 
```

这将是从这样的平面数据构建的：

```
nested_array = array();
nested_array[0] = array('name' => 'foo', 'depth' => 0)
nested_array[1] = array('name' => 'bar', 'depth' => 0)
nested_array[2] = array('name' => 'sub-bar', 'depth' => 1) 
```

如果它的格式也像示例一样很好，那就太好了。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-25T19:38:44.293

*编辑：添加格式*

正如评论中已经说过的，您的数据结构有些奇怪。而不是使用文本操作（如 OIS），我更喜欢 DOM：

```
<?php

$nested_array = array();
$nested_array[] = array('name' => 'foo', 'depth' => 0);
$nested_array[] = array('name' => 'bar', 'depth' => 0);
$nested_array[] = array('name' => 'sub-bar', 'depth' => 1);
$nested_array[] = array('name' => 'sub-sub-bar', 'depth' => 2);
$nested_array[] = array('name' => 'sub-bar2', 'depth' => 1);
$nested_array[] = array('name' => 'sub-sub-bar3', 'depth' => 3);
$nested_array[] = array('name' => 'sub-sub3', 'depth' => 2);
$nested_array[] = array('name' => 'baz', 'depth' => 0);

$doc = new DOMDocument('1.0', 'iso-8859-1');
$doc->formatOutput = true;
$rootNode = $doc->createElement('div');
$doc->appendChild($rootNode);

$rootList = $doc->createElement('ul');
$rootNode->appendChild($rootList);

$listStack = array($rootList); // Stack of created XML list elements
$depth = 0; // Current depth

foreach ($nested_array as $nael) {
    while ($depth < $nael['depth']) {
        // New list element
        if ($listStack[$depth]->lastChild == null) {
            // More than one level at once
            $li = $doc->createElement('li');
            $listStack[$depth]->appendChild($li);
        }
        $listEl = $doc->createElement('ul');
        $listStack[$depth]->lastChild->appendChild($listEl);
        array_push($listStack, $listEl);

        $depth++;
    }

    while ($depth > $nael['depth']) {
        array_pop($listStack);
        $depth--;
    }

    // Add the element itself
    $li = $doc->createElement('li');
    $li->appendChild($doc->createTextNode($nael['name']));
    $listStack[$depth]->appendChild($li);
}

echo $doc->saveXML(); 
```

您的格式约定有点奇怪。用以下内容替换最后一行以实现它：

```
printEl($rootNode);

function printEl(DOMElement $el, $depth = 0) {
    $leftFiller = str_repeat("\t", $depth);
    $name = preg_replace('/[^a-zA-Z]/', '', $el->tagName);

    if ($el->childNodes->length == 0) {
        // Empty node
        echo $leftFiller . '<' . $name . "/>\n";
    } else {
        echo $leftFiller . '<' . $name . ">";
        $printedNL = false;

        for ($i = 0;$i < $el->childNodes->length;$i++) {
            $c = $el->childNodes->item($i);

            if ($c instanceof DOMText) {
                echo htmlspecialchars($c->wholeText);
            } elseif ($c instanceof DOMElement) {
                if (!$printedNL) {
                    $printedNL = true;
                    echo "\n";
                }
                printEl($c, $depth+1);
            }
        }

        if (!$printedNL) {
            $printedNL = true;
            echo "\n";
        }

        echo $leftFiller . '</' . $name . ">\n";
    }

} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-25T19:37:02.253

你的意思是

```
function array_to_list(array $array, $width = 3, $type = 'ul', $separator = ' ', $depth = 0)
{
    $ulSpace = str_repeat($separator, $width * $depth++);
    $liSpace = str_repeat($separator, $width * $depth++);
    $subSpace = str_repeat($separator, $width * $depth);
    foreach ($array as $key=>$value) {
        if (is_array($value)) {
        $output[(isset($prev) ? $prev : $key)] .= "\n" . array_to_list($value, $width, $type, $separator, $depth);
        } else {
            $output[$key] = $value;
            $prev = $key;
        }
    }
    return "$ulSpace<$type>\n$liSpace<li>\n$subSpace" . implode("\n$liSpace</li>\n$liSpace<li>\n$subSpace", $output) . "\n$liSpace</li>\n$ulSpace</$type>";
}

echo array_to_list(array('gg', 'dsf', array(array('uhu'), 'df', array('sdf')), 'sdfsd', 'sdfd')) . "\n"; 
```

生产

```
<ul>
   <li>
      gg
   </li>
   <li>
      dsf
      <ul>
         <li>

            <ul>
               <li>
                  uhu
               </li>
            </ul>
         </li>
         <li>
            df
            <ul>
               <li>
                  sdf
               </li>
            </ul>
         </li>
      </ul>
   </li>
   <li>
      sdfsd
   </li>
   <li>
      sdfd
   </li>
</ul> 
```

如果子列表没有以解释开头，我知道那里有一点差距。

就个人而言，我通常并不真正关心 HTML 的外观，只要它易于在 PHP 中使用即可。

编辑：好的，如果你先运行它，它就可以工作......：P

```
function flat_array_to_hierarchical_array(array &$array, $depth = 0, $name = null, $toDepth = 0)
{
    if ($depth == 0) {
        $temp = $array;
        $array = array_values($array);
    }
    if (($name !== null) && ($depth == $toDepth)) {
        $output[] = $name;
    } else if ($depth < $toDepth) {
        $output[] = flat_array_to_hierarchical_array(&$array, $depth + 1, $name, $toDepth);
    }
    while ($item = array_shift($array)) {
        $newDepth = $item['depth'];
        $name = $item['name'];
        if ($depth == $newDepth) {
            $output[] = $name;
        } else if ($depth < $newDepth) {
            $output[] = flat_array_to_hierarchical_array(&$array, $depth + 1, $name, $newDepth);
        } else {
            array_unshift($array, $item);
            return $output;
        }
    }
    $array = $temp;
    return $output;
}

$arr = flat_array_to_hierarchical_array($nested_array);
echo array_to_list($arr); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-25T19:38:56.740

我有一个问题，关于您的问题对于评论字段来说过于详尽。

你想如何在其中拟合属性数据？你需要一个 Whory Table™ 像

```
array('html', null, array (
  array( 'div' , null , array( 
    array('ul', array('id'=>'foo'), array( 
      array('li', null, 'foo' ),
        array('li', null, array( 
          array(null,null, 'bar'), 
          array('ul', null, array( 
            array('li', null, 'sub-bar' )
          ))
        ))
      ))
    ))
  ))
)); 
```

因为这是以编程方式准确表示 HTML 数据集所需的最小结构。

通过假设如果

数组（名称，属性，孩子）

有一个字符串而不是'children'的数组，然后它是一个隐式文本节点，并且名称== null的节点没有标签，因此也是文本节点。

我认为你想要的是一个适当的程序化 DOM 生成工具，它将一些现有的 html 解析成一棵树，让你的生活更轻松

FWIW，上述结构可以很容易地序列化为html。

```
function tohtml( $domtree ){ 
   if( is_null($domtree[0]) ){ 
     if( !is_array($domtree[2])){ 
         return htmlentities($domtree[2]);
     }
     die("text node cant have children!"); 
   }
   $html = "<" . $domtree[0]; 
   if( !is_null( $domtree[1] ) )
   {
     foreach( $domtree[1] as $name=>$value ){ 
       $html .= " " . $name . '="' . htmlentities($value) . '"'; 
     }
   }
   $html .= ">" ; 
   if( !is_null($domtree[2]) ){
     if( is_array($dometree[2]) ){ 
        foreach( $domtree[2] as $id => $item ){ 
          $html .= tohtml( $item ); # RECURSION
        } 
     }
     else {
       $html .= htmlentities($domtree[2]);
     }
  }
  $html .= "</" . $domtree[1] . ">"; 
  return $html; 
} 
```

# .net - .NET 中的分块编码实现（或至少是伪代码）

> ID：318489
> 
> 赞同：3
> 
> 时间：2008-11-25T18:59:17.833
> 
> 标签：.net, http, encoding, tcp, chunked-encoding

我为 HTTP/HTTPS 请求编写了一个原始 TCP 客户端，但是我遇到了分块编码响应的问题。HTTP/1.1 是必需的，因此我应该支持它。

*原始 TCP 是我需要保留的业务要求，因此我无法切换到 .NET HTTPWebRequest/HTTPWebResponse*但是，如果有办法将原始 HTTP 请求/响应转换为有效的 HTTPWebRequest/HTTPWebResponse。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-25T19:35:06.110

最好的起点是[http 1.1 规范](ftp://ftp.isi.edu/in-notes/rfc2616.txt)，它阐述了分块的工作原理。特别是第 3.6.1 节。

> 3.6.1 分块传输编码
> 
> 分块编码修改消息的主体，以便
> 将其作为一系列块传输，每个块都有自己的大小指示符，
> 后跟一个包含实体头字段的可选尾部。
> 这允许动态生成的内容与接收者验证其已
> 收到完整消息所需的信息一起传输。
> 
> ```
>  Chunked-Body   = *chunk
>                     last-chunk
>                     trailer
>                     CRLF
> 
>    chunk          = chunk-size [ chunk-extension ] CRLF
>                     chunk-data CRLF
>    chunk-size     = 1*HEX
>    last-chunk     = 1*("0") [ chunk-extension ] CRLF
> 
>    chunk-extension= *( ";" chunk-ext-name [ "=" chunk-ext-val ] )
>    chunk-ext-name = token
>    chunk-ext-val  = token | quoted-string
>    chunk-data     = chunk-size(OCTET)
>    trailer        = *(entity-header CRLF) 
> ```
> 
> chunk-size 字段是一串十六进制数字，表示
> 块的大小。分块编码以任何大小
> 为零的块结束，然后是尾部，以空行终止。
> 
> 尾部允许发送者
> 在消息末尾包含额外的 HTTP 头字段。Trailer 头字段可用于指示尾中包含哪些头字段（参见第 14.40 节）。

假设您已经从响应中读取了标头并指向流中的下一个字节，您的伪代码将如下所示：

```
done = false;
uint8 bytes[];
while (!done)
{
  chunksizeString = readuntilCRLF(); // read in the chunksize as a string
  chunksizeString.strip(); // strip off the CRLF
  chunksize = chunksizeString.convertHexString2Int(); // convert the hex string to an integer.
  bytes.append(readXBytes(chunksize)); // read in the x bytes and append them to your buffer.
  readCRLF(); // read the trailing CRLF and throw it away.
  if (chunksize == 0)
     done = true; //

}
// now read the trailer if any
// trailer is optional, so it may be just the empty string
trailer = readuntilCRLF()
trailer = trailer.strip()
if (trailer != "")
   readCRLF(); // read out the last CRLF and we are done. 
```

这是忽略块扩展部分，但因为它是用“;”分隔的 应该很容易将其拆分出来。这应该足以让你开始。请记住，块大小字符串**没有**前导“0x”。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-28T22:24:53.053

为了将来的参考，我还发现了这个：

```
 length := 0
   read chunk-size, chunk-extension (if any) and CRLF
   while (chunk-size > 0) {
      read chunk-data and CRLF
      append chunk-data to entity-body
      length := length + chunk-size
      read chunk-size and CRLF
   }
   read entity-header
   while (entity-header not empty) {
      append entity-header to existing header fields
      read entity-header
   }
   Content-Length := length
   Remove "chunked" from Transfer-Encoding 
```

# .net - 在 .NET 中使用绝对路径的原因

> ID：318496
> 
> 赞同：1
> 
> 时间：2008-11-25T19:01:56.427
> 
> 标签：.net, iis, testing

我们正在尝试在让特定团队中的所有开发人员为其代码库使用绝对路径或是否可以使用相对路径之间做出决定。

我认为绝对路径的一个原因，即每个人都有相同的路径，是因为 IIS 和功能测试。我们的 asp.net 功能测试使用 Nunit 和 WatiN 来启动 IE 并通过各种场景。为了让这些从 Nunit GUI 独立运行，我必须检查 Cassini 是否正在运行，如果没有，则启动它。它需要通过物理路径。因此，只有使用该特定路径的人才能以这种方式运行功能测试。

是否有任何交易破坏者主张绝对（共同）路径？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-25T19:10:03.757

使用相对路径名。真的。考虑分支您的存储库。考虑设置单元测试。考虑有单独的调试和发布版本。双关语……这都是相对的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-25T19:26:49.620

如果可能的话，我会避免使用绝对路径。作为一般的开发原则，我应该能够在我喜欢的任何地方在我的机器上检查你的代码。

如果您出于某种原因必须使用绝对路径，请将它们放在您的 .config 文件应用程序设置中 - 至少您的开发和部署机器可以有不同的路径。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-25T19:07:09.427

我也面临着开发服务器需要绝对路径才能启动的情况。它也用于单元测试。在花了几天时间思考这个问题之后，我决定尽可能地重构以使测试工作而不需要提供实际的 ASP.NET 页面。这意味着放弃对一些打包的服务器控件的自动化 UI 测试，但最终，我从未找到一个好的解决方案。

绝对路径是我在几乎任何环境中遇到过的最糟糕的事情之一。他们是一颗等待发生的定时炸弹。

也就是说，我经常有一个应用程序需要绝对 UNC 路径作为上传文件的“放置”位置（当托管在网络场中时）。最后，由于缺乏更好的解决方案，我发现它是可以接受的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-25T22:12:26.510

避免像瘟疫一样的绝对路径。他们会以一种或另一种方式咬你。

绝对路径分散的项目总是会破坏任何自动化构建或采用任何合理分支策略的尝试。

创建绝对路径（即驱动器号）时必须做出的第一个决定应该提示您这是一个非常非常糟糕的主意。当然，每个人都有一个 C: 驱动器。出色地...

*   我见过没有安装 C: 驱动器的机器
*   我见过 IT 人员谎称每台机器都有 D：驱动器，或者可以访问 P：网络驱动器
*   我已经看到存储库切换覆盖了工作，因为这是构建工作的唯一方法
*   当需要进行简单更改时，我已经看到无数小时试图找到存储绝对路径的所有位置

不要这样做。无论如何，不​​要。

# ms-access - 是否可以使用字符串作为索引？

> ID：318500
> 
> 赞同：1
> 
> 时间：2008-11-25T19:02:59.793
> 
> 标签：ms-access, vba

在其他语言中，您可以使用字符串作为键 -

PHP：

```
$array['string'] = 50; 
$array['anotherstring'] = 150; 
```

这在VBA中可能吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-25T19:13:21.147

在 VBA 中，您可以创建一个 Collection 对象。集合中的项目可以通过索引（长整数）或字符串键访问。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-25T19:09:03.400

您是否考虑过 Dictionary 对象？

[http://msdn.microsoft.com/en-us/library/aa164502(office.10).aspx](http://msdn.microsoft.com/en-us/library/aa164502(office.10).aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-25T19:10:33.913

我很长时间没有使用 VBA，但它们不是数组，它们是[哈希](http://www.perl.com/pub/a/2006/11/02/all-about-hashes.html)（在 perl 中）和[关联数组](http://www.onlamp.com/pub/a/php/2001/06/21/php_foundations.html)（在 PHP 中）。如果您正在寻找答案，则搜索这些术语之一和 VBA 而不仅仅是“数组”可能会获得更好的结果。

据我所知，VBA 中没有原生的哈希表类型，但就像我说的，我已经有一段时间没有使用它了，所以我可能错了。

# .net - 将原始 HTTP 请求转换为 HTTPWebRequest 对象

> ID：318506
> 
> 赞同：26
> 
> 时间：2008-11-25T19:05:31.240
> 
> 标签：.net, http, tcp, httpwebrequest

在 .NET 中是否可以将原始 HTTP 请求转换为 HTTPWebRequest 对象？

我确定.NET 在内部这样做。知道 .NET 的哪个部分实际上正在处理这个问题吗？我可以调用它还是有任何外部库允许原始 HTTP 连接？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-02-10T05:10:05.343

我不相信有一种公开的方法可以做到这一点。您可能必须找到或编写一个解析器来分解请求，然后编写您自己的扩展 HttpWebRequest 的类。

下面是来自 CodeProject 的解析器：

[http://www.codeproject.com/KB/IP/CSHTTPServer.aspx](http://www.codeproject.com/KB/IP/CSHTTPServer.aspx)

我查看了 HttpWebRequest 的转子代码（简要地），我没有看到任何作为灵丹妙药的东西。这是文件的链接：

[http://www.123aspx.com/Rotor/RotorSrc.aspx?rot=40844](http://www.123aspx.com/Rotor/RotorSrc.aspx?rot=40844)

所有转子代码都在这里供在线浏览：

[http://www.123aspx.com/Rotor/default.aspx](http://www.123aspx.com/Rotor/default.aspx)

在这里你可以下载它：

[http://www.microsoft.com/downloads/details.aspx?FamilyId=8C09FD61-3F26-4555-AE17-3121B4F51D4D&displaylang=en](http://www.microsoft.com/downloads/details.aspx?FamilyId=8C09FD61-3F26-4555-AE17-3121B4F51D4D&displaylang=en)

我知道一堆链接并不能真正回答您的问题，但我认为您正在寻找的功能并未在框架中公开。我很想被证明是错误的，所以如果你找到了一个好的方法，请更新帖子。我知道那里的工具必须这样做，任何用 .Net 编写的记录原始请求然后让您重新提交它们的东西都在做类似的事情。我相信**提琴手**( [http://www.fiddler2.com](http://www.fiddler2.com/fiddler2/) ) 是用 .Net 编写的，您可能想向这些人发送电子邮件，看看他们是否可以提供帮助。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2019-01-07T13:49:44.750

现在可以了，但仅限于 .Net Core 2.0+。使用[Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpParser](https://docs.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.server.kestrel.core.internal.http.httpparser-1?view=aspnetcore-2.1)类：

```
using Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http;
using System;
using System.Buffers;
using System.Collections.Generic;
using System.Text;

public class Program : IHttpRequestLineHandler, IHttpHeadersHandler
{
    public static void Main(string[] args)
    {
        string requestString =
@"POST /resource/?query_id=0 HTTP/1.1
Host: example.com
User-Agent: custom
Accept: */*
Connection: close
Content-Length: 20
Content-Type: application/json

{""key1"":1, ""key2"":2}";
        byte[] requestRaw = Encoding.UTF8.GetBytes(requestString);
        ReadOnlySequence<byte> buffer = new ReadOnlySequence<byte>(requestRaw);
        HttpParser<Program> parser = new HttpParser<Program>();
        Program app = new Program();
        Console.WriteLine("Start line:");
        parser.ParseRequestLine(app, buffer, out var consumed, out var examined);
        buffer = buffer.Slice(consumed);
        Console.WriteLine("Headers:");
        parser.ParseHeaders(app, buffer, out consumed, out examined, out var b);
        buffer = buffer.Slice(consumed);
        string body = Encoding.UTF8.GetString(buffer.ToArray());
        Dictionary<string, int> bodyObject = Newtonsoft.Json.JsonConvert.DeserializeObject<Dictionary<string, int>>(body);
        Console.WriteLine("Body:");
        foreach (var item in bodyObject)
            Console.WriteLine($"key: {item.Key}, value: {item.Value}");
        Console.ReadKey();
    }

    public void OnHeader(Span<byte> name, Span<byte> value)
    {
        Console.WriteLine($"{Encoding.UTF8.GetString(name)}: {Encoding.UTF8.GetString(value)}");
    }

    public void OnStartLine(HttpMethod method, HttpVersion version, Span<byte> target, Span<byte> path, Span<byte> query, Span<byte> customMethod, bool pathEncoded)
    {
        Console.WriteLine($"method: {method}");
        Console.WriteLine($"version: {version}");
        Console.WriteLine($"target: {Encoding.UTF8.GetString(target)}");
        Console.WriteLine($"path: {Encoding.UTF8.GetString(path)}");
        Console.WriteLine($"query: {Encoding.UTF8.GetString(query)}");
        Console.WriteLine($"customMethod: {Encoding.UTF8.GetString(customMethod)}");
        Console.WriteLine($"pathEncoded: {pathEncoded}");
    }
} 
```

输出：

```
Start line:
method: Post
version: Http11
target: /resource/?query_id=0
path: /resource/
query: ?query_id=0
customMethod:
pathEncoded: False
Headers:
Host: example.com
User-Agent: custom
Accept: */*
Connection: close
Content-Length: 20
Content-Type: application/json
Body:
key: key1, value: 1
key: key2, value: 2 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-06T21:55:47.110

Google for Cassinni，它是一个 HTTP 服务器，其源代码最初由 Microsoft 提供，可以托管 ASP.NET 调用。您必须自己解析请求并加载它，但 Cassinni 将是一个很好的起点。此 URL 可能会有所帮助：

[http://blogs.msdn.com/dmitryr/archive/2005/09/27/474534.aspx](http://blogs.msdn.com/dmitryr/archive/2005/09/27/474534.aspx)

# c++ - 带有 std::wstring 的初始化结构

> ID：318511
> 
> 赞同：2
> 
> 时间：2008-11-25T19:07:07.383
> 
> 标签：c++, string, structure

我的结构如下：

```
typedef struct
{
    std::wstring DevAgentVersion;
    std::wstring SerialNumber;

} DeviceInfo; 
```

但是当我尝试使用它时，我会遇到各种内存分配错误。

如果我尝试将它传递给这样的函数：

```
GetDeviceInfo(DeviceInfo *info); 
```

我会得到一个运行时检查错误，抱怨我在使用它之前没有初始化它，我似乎已经修复了：

```
DeviceInfo *info = (DeviceInfo*)malloc(sizeof(DeviceInfo)); 
```

但是，在函数中，当我尝试设置任何一个结构时，它会抱怨我在尝试为字符串设置值时尝试访问错误的指针。

初始化这个结构的最好方法是什么（以及它所有的内部字符串？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-11-25T19:09:04.257

您应该使用`new`而不是`malloc`, 以确保为 the`DeviceInfo`及其包含`wstring`的 s 调用构造函数。

```
DeviceInfo *info = new DeviceInfo; 
```

一般来说，最好避免`malloc`在 C++ 中使用。

另外，请确保在`delete`使用完指针后指向指针。

编辑：当然，如果你只需要`info`在本地范围内，你不应该在堆上分配它。只需这样做：

```
DeviceInfo info; // constructed on the stack
GetDeviceInfo( &info ); // pass the address of the info 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-25T19:14:41.347

std::wstring 创建一个对象，需要构造对象。通过使用 malloc，您绕过了结构的构造函数，其中包括所有成员的构造函数。

您得到的错误来自 std::wstring 试图使用它自己的仍然未初始化的成员之一。

您可以使用 new 而不是 malloc，但最好的解决方案可能是使用局部临时变量并将其地址传递给函数。

```
DeviceInfo info;
GetDeviceInfo(&info); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-25T19:18:38.780

将函数添加到结构中：

```
struct DeviceInfo
{
    std::wstring DevAgentVersion;
    std::wstring SerialNumber;
    WhatEverReturnType GetDeviceInfo() {
        // here, to your calculation. DevAgentVersion and SerialNumber are visible.
    }
};

DeviceInfo d; WhatEverReturnType e = d.GetDeviceInfo(); 
```

注意 typedef struct { ... } 名称；C++ 中不需要模式。如果您出于某种原因必须为此使用免费功能，请使用参考：

```
WhatEverReturnType GetDeviceInfo(DeviceInfo &info) {
    // do your calculation. info.DevAgentVersion and info.SerialNumber are visible.
}

DeviceInfo d; WhatEverReturnType e = GetDeviceInfo(d); 
```

# user-interface - GUI 框架模式？

> ID：318527
> 
> 赞同：7
> 
> 时间：2008-11-25T19:11:34.237
> 
> 标签：user-interface, frameworks

我们在嵌入式环境中进行开发，发现自己需要创建自己的 UI 框架。

我以前做过这个，但我有兴趣围绕框架的常见设计模式做一些研究。

我认为是模式的事物类型（有些深远）：

*   小部件焦点/散焦
*   小部件动画
*   元素之间的数据共享
*   将命令附加到小部件
*   保存状态（MVC？）

您对 GUI 框架模式有哪些推荐读物？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-25T19:40:29.170

我有两个给你，回调或通知，也许这就是你所说的“将命令附加到小部件”，你想以某种方式对 UI 元素中的状态变化做出反应。需要通知控制器已发生更改。

Cocoa/UIKit 有一种称为“委托”的模式和通知来完成此操作，其他使用回调函数或对象（Java Swing）或“信号和插槽”（QT）。

我非常有用的模式是*防止*状态改变的能力，最简单的用例是输入验证，当小部件中的文本发生时，您希望防止小部件失去焦点不同意你的期望。Windows 窗体过去在某些元素（不是全部）上具有此功能，但 Cocoa 可以做到这一点。这可以通过在回调中使用返回值或引用参数（或指针）来完成，在这些回调中，被调用者可以与原始小部件进行通信

这些天将样式应用于 ui 元素，即在不改变功能的情况下改变外观也变得非常流行 QT 可以做到这一点，我相信很多其他库

四人组装饰器模式有时也用于增强小部件的功能，可以通过装饰器完成可滚动的操作。这完全取决于您需要在 UI 元素上走多远。祝你好运，这不是一件容易的事

EDT：尽可能应用 MVC。第一个候选人是任何类型的列表显示，不要让他们负责保留他们正在显示的项目。这绝对适用于组合框、列表框、表格和树，您可以为文本输入实现此功能，但这可能不值得开销。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-25T19:41:10.240

只是一些关于经典设计模式的提示；我认为这些与GUI构建有关：

*   [MVC 模式](http://en.wikipedia.org/wiki/Model-view-controller)很明显。
*   [观察者模式](http://en.wikipedia.org/wiki/Observer_pattern)；例如，View 需要观察 Model（以了解其状态何时发生变化），而 Controller 需要观察 View（以了解何时单击按钮）。
*   [策略模式](http://en.wikipedia.org/wiki/Strategy_pattern)；在某种程度上，使用控制器作为 View 和 Model 之间的粘合剂就是选择一种策略。理论上，您应该能够透明地切换 Controller。
*   [复合图案](http://en.wikipedia.org/wiki/Composite_pattern)；您的视图就像一棵由窗格、小部件等组成的树。当您需要调用诸如“view.paint()”之类的东西时，拥有一个通用接口和一种迭代此集合的方法非常有用。

我知道您询问**了框架的模式**，但您仍然应该依赖这些模式，因为开发人员可能会在考虑这些概念的情况下使用您的框架。

您对您的框架有要求/特定需求吗？如果您的目标平台在内存/CPU 方面受到限制，您可能需要放弃一些“好的原则”。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-25T19:41:39.810

我通过帮助开发 SingStar PS3 学到了一些东西

*   它有助于将组件逻辑（按钮如何工作）和视觉逻辑（如何渲染图像）分开。当您想出一种全新的渲染方式并且它可以透明地与您的旧按钮控件一起使用时，这尤其好。
*   设置一种灵活的方式将应用程序中的数据源绑定到充满组件的页面，以便相同的组件可以在一个页面上显示所有歌曲或在另一个页面上显示所有照片。这就是 MVC 为 SingStar 派上用场的地方
*   事件分派/事件接收模型（即您订阅按钮的点击）是将页面布局绑定到您的代码的一种非常好的方式。如果你不小心，它可能会变成意大利面条。
*   不要发明另一种编程语言来描述您的逻辑，您当前的编程语言可能很好。
*   考虑从一页更改到另一页时的步骤。这在很大程度上取决于您的内存使用情况，但有时可能会加载两个页面或不加载任何页面。在这里考虑页面间通信。
*   数据驱动页面布局。允许热交换布局（按一个键从您的电脑重新加载它），因为您将对其进行大量迭代。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2010-01-10T20:34:06.397

[**命令链**](http://en.wikipedia.org/wiki/Chain-of-responsibility_pattern)模式。

GUI 上下文中的示例：

```
interface IWidget
{
    bool HandleEvent(Event event); // returns true if event was handled
                                   // or false if event was ignored
}

class Button : IWidget
{
    public override bool HandleEvent(Event event)
    {
        switch(event.Type)
        {
            case EventType.MousePressed: DoStuff(); return true;
            case EventType.MouseScrolled: return false;
        }
    }
} 
```

在这里，按钮不关心滚动事件，所以它们让它们的父级（*命令链*）处理它们。因此，如果您在例如 HTML 页面中有一个 Button，并且用户在该按钮上滚动，这将由父小部件（HTML 视图）处理并且整个页面滚动。

有关 Qt 框架中实际使用的示例，请参阅[bool QWidget::event(QEvent*)](http://qt.nokia.com/doc/4.6/qwidget.html#event)和[有关事件过滤器的文档](http://doc.trolltech.com/4.2/eventsandfilters.html#event-handlers)。

另请参阅：[**KDE 中的设计模式**](http://events.kde.org/info/kastle/presentations/dp-talk-nh2k3.pdf)。KDE 是一个跨平台、开源的面向对象的 C++ 库和软件的集合，作为 Linux 桌面环境非常流行。这些是 2003 年 KDE 会议的幻灯片。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2010-01-20T10:17:06.187

[依赖注入](http://www.theserverside.com/tt/articles/article.tss?l=IOCBeginners)有时会很有用。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-12T06:25:13.630

学习[XAML](http://msdn.microsoft.com/en-us/library/ms752059.aspx)，尤其是绑定。

微软在用干净的 XML 语言描述 GUI 布局方面做得非常好，如果您使用 XAML 的简化版本进行 UI 描述，您将能够使用他们的工具让设计人员模拟 UI。

# sql - 如何识别与 sybase 数据库中的表关联的触发器？

> ID：318528
> 
> 赞同：8
> 
> 时间：2008-11-25T19:11:47.733
> 
> 标签：sql, triggers, sybase

我正在使用 SQL Advantage 并且需要知道 SQL 是什么来识别与表关联的触发器。我没有使用其他工具的选项，所以老式的 SQL 解决方案是理想的答案。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-11-26T06:40:15.767

```
选择 *
来自系统对象
其中类型 = 'TR'
```

取自[这里](https://web.archive.org/web/1/http://articles.techrepublic%2ecom%2ecom/5100-10878_11-1061431.html)。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-11-26T18:10:55.047

我也发现

```
sp_depends <object_name> 
```

将向您显示有关表的大量信息，包括与其关联的所有触发器。使用它以及 Ray 的查询可以更容易地找到触发器。结合 Ray 的链接文章中的这个查询：

```
sp_helptext <trigger_name> 
```

可以看到触发器的定义：

```
sp_depends <trigger_name> 
```

还将向您显示与触发器相关的所有表

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2011-01-11T13:28:25.473

显示触发器并为表创建 sql：

```
select so.name, text
from sysobjects so, syscomments sc
where type = 'TR'
and so.id = sc.id
and text like '%TABLENAME%' 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2011-12-30T12:13:41.847

```
SELECT 
    T.name AS TableName
    ,O.name  TriggerName  
    FROM sysobjects O 
    INNER JOIN sys.tables T ON T.object_id = O.parent_obj
    WHERE O.type = 'TR' AND T.name IN ('tableNames')
ORDER BY TableName 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-29T07:14:26.887

我相信存在（或至少“曾经”）依赖信息并不总是准确的一些问题。因此，我会尝试这样处理它：

```
select name
from sysobjects
where xtype='TR'
and id in (select id from syscomments where text like '%MY-TABLE-NAME%') 
```

祝你好运。

PS-这是未经测试的代码，如果不起作用，请发表评论，我会修复它。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2015-06-19T18:06:43.103

1.  打开 Sybase Central 并导航到触发器视图。
2.  单击“对象名称”列进行排序。

“对象名称”列显然显示了与触发器关联的表。向下滚动到您感兴趣的表格。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2016-09-30T12:15:30.833

我将使用以下代码，以确保您获得正确的对象。从 Sybase 16 开始，这将不再完整，因为一张表上可能有更多相同类型的触发器。

```
 select tr.id, tr.name, tr.type, tr.crdate, tr.loginame
from sysobjects u
  join sysobjects tr on tr.id in (u.instrig, u.deltrig, u.updtrig, u.seltrig)
where u.name = 'TABLENAME' 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2018-09-11T12:21:21.473

我使用的是 SQL Anywhere 16，很容易找到特定表的触发器。打开表格时，有一个名为“触发器”的选项卡。但是查找所有触发器的查询与上面的答案有点不同：

```
select * from SYS.SYSTRIGGERS --where trigdefn like '%exec%' 
```

# vb.net - 是否可以使用字符串键/值对初始化 New System.Collections.Generic.Dictionary？

> ID：318530
> 
> 赞同：22
> 
> 时间：2008-11-25T19:11:54.720
> 
> 标签：vb.net, dictionary, .net-2.0, initialization

[`System.Collections.Generic.Dictionary`](http://msdn.microsoft.com/en-us/library/6918612z(VS.80).aspx)是否可以在一个语句中使用字符串键/值对创建和初始化对象？

我正在考虑字符串数组的构造函数..

例如

```
Private mStringArray As String() = {"String1", "String2", "etc"} 
```

如果这被证明是一种[语法糖](http://en.wikipedia.org/wiki/Syntactic_sugar)，我更喜欢我可以在 .Net 2.0 (Visual Studio 2005) 和 Visual Basic 中使用的答案——尽管我很好奇它是否可能如此不要让它让你失望;o）

* * *

## 回答 #1

> 赞同：78
> 
> 时间：2010-07-07T14:16:40.367

像这样：

```
Dim myDic As New Dictionary(Of String, String) From {{"1", "One"}, {"2", "Two"}} 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-11-26T20:43:19.637

我认为在 VB.NET 2 中没有开箱即用的方法，但是您可以扩展通用字典以使其按您希望的方式工作。

下面的控制台应用程序说明了这一点：

```
Imports System.Collections.Generic

Module Module1

    Sub Main()

        Dim items As New FancyDictionary(Of Integer, String)(New Object(,) {{1, "First Item"}, {2, "Second Item"}, {3, "Last Item"}})
        Dim enumerator As FancyDictionary(Of Integer, String).Enumerator = items.GetEnumerator

        While enumerator.MoveNext
            Console.WriteLine(String.Format("{0} : {1}", enumerator.Current.Key, enumerator.Current.Value))
        End While

        Console.Read()

    End Sub

    Public Class FancyDictionary(Of TKey, TValue)
        Inherits Dictionary(Of TKey, TValue)

        Public Sub New(ByVal InitialValues(,) As Object)

            For i As Integer = 0 To InitialValues.GetLength(0) - 1

                Me.Add(InitialValues(i, 0), InitialValues(i, 1))

            Next

        End Sub

    End Class

End Module 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-11-25T19:25:52.913

试试这个语法：

```
Dictionary<string, double> dict = new Dictionary<string, double>()
{
  { "pi", 3.14},
  { "e", 2.71 }
 }; 
```

但这可能需要 C# 3 (.NET 3.5)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-02-17T14:23:10.550

我知道这是一个旧帖子，但这个问题经常出现。如果

这是一种在一个语句中声明和初始化字典的方法：

```
Private __sampleDictionary As New Dictionary(Of Integer, String) From
{{1, "This is a string value"}, {2, "Another value"}} 
```

# c#-3.0 - 如何实现一个接口来处理类型转换类？

> ID：318531
> 
> 赞同：1
> 
> 时间：2008-11-25T19:12:01.350
> 
> 标签：c#-3.0, casting

我想将类的 tType 传递给函数，并将类对象传递给泛型函数。

我需要能够转换为该类型（类），以便我可以访问该类的方法。

就像是：

```
void GenericFunction(Object obj, Type type)
{
    (type)obj.someContainer.Add(1);
} 
```

为这些类实现一个接口然后转换为该接口是否可行？如果是这样，有人可以举个例子吗？

过去几个小时我一直在谷歌搜索，我以前从来没有这样做过。

有人可以阐明一下吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-25T19:41:58.920

这里有三种方法可以解决您的问题：

```
public interface ICanReport
{ void Report(); }

public class SomeThing : ICanReport
{
    public void Report()
    { Console.WriteLine("I'm SomeThing"); }
}

public class SomeOtherThing : ICanReport
{
    public void Report()
    { Console.WriteLine("I'm SomeOtherThing"); }
}

public class TestThings
{
    //#1 use safe downcasting
    public void TheMethod(object x)
    {
        ICanReport y = x as ICanReport;
        if (y != null)
          y.Report();
    }

    //#2 use generics
    //  100% safe, but a little complex
    public void AnotherMethod<T>(T x) where T : ICanReport
    {
        x.Report();
    }

    //#3 use an interface as the parameter type.
    //  simple and safe
    public void LastMethod(ICanReport x)
    {
        x.Report();
    }

    //sample calls
    public void Test1()
    {
        SomeThing a = new SomeThing();
        SomeOtherThing b = new SomeOtherThing();
        TheMethod(a);
        TheMethod(b);
        AnotherMethod(a);
        AnotherMethod(b);
        LastMethod(a);
        LastMethod(b);
    }
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-25T19:18:05.487

您可以在方法调用中使用泛型吗？就像是：

```
void GenericFunction<T>(Object obj)
  where T : class {
  obj.someContainer.Add(1) as T;
} 
```

希望有帮助！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-25T19:25:44.613

查看[System.ComponentModel.TypeConverter](http://msdn.microsoft.com/en-us/library/system.componentmodel.typeconverter.aspx)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-25T19:28:55.543

您尝试做的是动态演员表。这在 C# 中不存在。

您可以尝试以下方法之一：

*   声明要在基类或接口中使用的成员并强制转换为该成员。
*   在 Zachary Yates 的代码示例中使用泛型：

    ```
    void GenericFunction<T>(Object obj) where T : class 
    {
      obj.someContainer.Add(1) as T;
    } 
    ```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-25T19:30:46.257

好的

```
class A {
    public BindingList<int> addContainers;
}

class B {
     public BindingList<int> addContainers;
}

class C {
     Type type;
     Object senderObj;

     C(Object s, Type t)
     {
            senderObj = s;
            type = t;
     }

     private void AddBtn_Click(click sender, EventArgs e)
     {
            // Depending on the Type passed to the constructor, i need to cast to that type
            // so that i have access to the classes public addContainer member variable
      } 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-25T19:45:45.260

试试这个代码。在 main 中更改`Class2`to`Class1`以查看结果。

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Reflection;

namespace ReflectionTest
{
    class Class1
    {
        public void helloWorld()
        {
            Console.WriteLine("Hello World 1");
        }
    }

    class Class2
    {
        public void helloWorld()
        {
            Console.WriteLine("Hello World Class 2");
        }
    }

    class Program
    {
        static void callCorrectClass(Object obj, Type type)
        {
            ConstructorInfo constructors = type.GetConstructor(System.Type.EmptyTypes);
            obj = constructors.Invoke(null);
            MethodInfo helloWorld = type.GetMethod("helloWorld");
            helloWorld.Invoke(obj, null);
        }
        static void Main(string[] args)
        {
            Type type = typeof(Class2);
            callCorrectClass(new Object(), type);
        }
    }
} 
```

# blackberry - 如何关闭黑莓上的系统对话框？

> ID：318540
> 
> 赞同：2
> 
> 时间：2008-11-25T19:16:39.593
> 
> 标签：blackberry, dialog, integration

我有一个在后台运行的 BlackBerry 应用程序，它需要知道系统何时启动“未接来电”系统对话框，并在没有用户干预的情况下以编程方式关闭它。我怎样才能做到这一点？

实际上，我几乎可以知道对话框何时出现，即稍后我以编程方式结束通话......但是我怎样才能获得对对话框的引用并关闭它？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-09-14T07:11:14.297

设备*关闭*按钮的按键注入如下所示：

```
KeyEvent inject = new KeyEvent(KeyEvent.KEY_DOWN, Characters.ESCAPE, 0);
inject.post(); 
```

不要忘记为设备发布设置权限：选项 => 高级选项 => 应用程序 => [您的应用程序] => 编辑默认权限 => 交互 => 击键注入

可能有用：
[BlackBerry - 模拟 KeyPress 事件](https://stackoverflow.com/questions/1292896/blackberry-simulate-a-keypress-event/1298900#1298900)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-27T17:19:25.087

（我自己没有尝试过）您的应用程序可以定期轮询系统以获取前台应用程序。一旦它是电话应用程序，你可以检查这个应用程序的最上面的屏幕是什么。如果它是未接来电屏幕，正如屏幕的类、某些特殊字段、字段文本等神奇地识别的那样，则将该屏幕从显示堆栈中弹出。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-30T16:30:19.273

`PhoneLogListener`当来电添加到电话日志时，使用来罚款。

从以下位置获取活动屏幕：[这里](https://stackoverflow.com/questions/308972/dismiss-a-system-dialog-on-blackberry/807813#807813)

# testing - 如何设置 Active Directory 环境测试？

> ID：318541
> 
> 赞同：13
> 
> 时间：2008-11-25T19:16:49.343
> 
> 标签：testing, active-directory, vmware

我正在从事的项目需要针对 AD 对其用户进行身份验证，并作为对其自身用户群的后备检查。现在我需要在生产环境之外对其进行测试。

设置 Active Directory 测试环境的最佳方法是什么？目前我正在下载一个 Windows 2003 Virtual PC[映像](http://www.microsoft.com/downloads/details.aspx?FamilyID=77f24c9d-b4b8-4f73-99e3-c66f80e415b6&DisplayLang=en)，并计划一个 VMWare 虚拟 LAN。

这种方法有什么问题吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-25T19:32:51.090

这个环境是假设模拟尽可能多的 ActiveDirectory 安装，还是只是测试身份验证是否适用于 DC？

至少，您需要设置两个域控制器，一个主域控制器和一个辅助域控制器。您还需要设置具有各种帐户状态（密码过期、帐户过期、帐户锁定等）的帐户。

其他一些需要考虑的问题：

您的域是否作为 Win2000 功能域运行？还是 Windows 2003 功能域？如果您有多个域，您会支持 Universal Group 成员资格吗？如果您有多个 forrest，您会支持跨森林信任关系吗？

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-25T19:21:00.350

您应该考虑多域和多林环境，以及仅在您进行身份验证的域中拥有多个域控制器。你需要不止一个虚拟机来做到这一点。

# apache-flex - Flex - 使用字符串值绑定 ViewStack selectedChild 属性

> ID：318542
> 
> 赞同：1
> 
> 时间：2008-11-25T19:17:09.250
> 
> 标签：apache-flex, data-binding, actionscript, binding

附加的代码示例（伪代码）编译，但抛出此运行时错误：

```
TypeError: Error #2007: Parameter child must be non-null.
    at flash.display::DisplayObjectContainer/getChildIndex()
    at mx.core::Container/getChildIndex()[E:\dev\3.0.x\frameworks\projects\framework\src\mx\core\Container.as:2409]
    at mx.containers::ViewStack/set selectedChild()[E:\dev\3.0.x\frameworks\projects\framework\src\mx\containers\ViewStack.as:557]

<?xml version="1.0" encoding="utf-8"?>
<mx:Application xmlns:mx="http://www.adobe.com/2006/mxml" layout="absolute">
    <mx:Script>
        <![CDATA[
            [Bindable]
            private var targetViewName:String = "content";
        ]]>
    </mx:Script>

    <mx:ViewStack id="viewStack" width="100%" height="100%" 
        selectedChild="{Container(viewStack.getChildByName(targetViewName))}">
        <mx:Panel id="welcome" width="100%" height="100%" />

        <mx:Panel id="content" width="100%" height="100%" />
    </mx:ViewStack>
</mx:Application> 
```

有什么方法可以让它工作而不必调用函数来设置 selectedChild？

谢谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-01T00:13:32.723

当 selectedChild 被触发时，viewStack 没有添加任何子元素，因此它会抛出 NullPointerException：

以下将起作用：

```
<?xml version="1.0" encoding="utf-8"?>
<mx:Application xmlns:mx="http://www.adobe.com/2006/mxml" layout="absolute">
    <mx:Script>
        <![CDATA[
            import mx.core.Container;
            [Bindable]
            private var targetViewName:String = "content";

            private function onClick() : void
            {
                viewStack.selectedChild = Container(viewStack.getChildByName(targetViewName)) ;
            }
        ]]>
    </mx:Script>

    <mx:ViewStack id="viewStack" width="100%" height="100%" >
        <mx:Panel id="welcome" width="100%" height="100%"  title="welcome"/>

        <mx:Panel id="content" width="100%" height="100%" title="content" />
    </mx:ViewStack>

    <mx:Button click="onClick()" label="click" />

</mx:Application> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-26T07:22:35.527

试过这个：

```
selectedChild="{this[targetViewName]}"> 
```

/尼尔斯

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-26T14:44:50.640

抱歉，/尼尔斯，这行不通。尝试编译这段代码，你会看到 selectedChild 没有改变（你也会收到编译警告）：

```
<?xml version="1.0" encoding="utf-8"?>
<mx:Application xmlns:mx="http://www.adobe.com/2006/mxml" layout="absolute">
    <mx:Script>
        <![CDATA[
            [Bindable]
            private var targetViewName:String = "content";
        ]]>
    </mx:Script>

    <mx:TabNavigator id="viewStack" width="100%" height="100%" creationPolicy="all" 
        selectedChild="{this[targetViewName]}">
        <mx:Panel id="welcome" width="100%" height="100%" label="welcome" />

        <mx:Panel id="content" width="100%" height="100%" label="content" />
    </mx:TabNavigator>
</mx:Application> 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-26T19:28:52.720

我的猜测是，这将不起作用，因为绑定将在初始化时评估，此时视图堆栈的子级尚未创建。即使将 creationPolicy 设置为“全部”，问题仍然存在。

在创建视图堆栈（可能还有它的子级）时，您必须设置与 targetViewName 的绑定。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-26T20:38:57.243

一旦目标出现在显示列表中，您就想设置 selectedChild 属性。试试这个：

```
<mx:TabNavigator id="viewStack" width="100%" height="100%" creationPolicy="all" >
    <mx:Panel id="welcome" width="100%" height="100%" label="welcome" />

    <mx:Panel id="content" width="100%" height="100%" label="content" addedToStage="viewStack.selectedChild = this" />
</mx:TabNavigator> 
```

如果您真的想绑定 selectedChild，则创建一个可绑定函数，该函数返回您要选择的面板，但前提是它是 viewStack 的子项。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-19T16:25:59.123

```
<mx:Script>
    <![CDATA[
        import models.ModelLocator;

        [Bindable]
        private var model:ModelLocator = ModelLocator.getInstance();
    ]]>
</mx:Script>

<mx:ViewStack id="videoViewStack" width="100%" height="100%" selectedChild="{this[model._videoViewStack]}" >
    <viewsVideos:AllVideos id="AllVideos" label="Videos"/>
    <viewsVideos:MainVideo id="MainVideo" label="Video"/>
</mx:ViewStack> 
```

这绑定了一个字符串 var 我确实收到了警告，但它可以工作

# c++ - 在 C++ 中全局定义结构

> ID：318551
> 
> 赞同：1
> 
> 时间：2008-11-25T19:19:13.800
> 
> 标签：c++, file, structure, global, extern

关于如何全局（使用 extern struct）声明一个可以在超过 1 个 c++ 文件中看到的结构，有一个有点详细的线程（228684），但我不知道该怎么做（有很多讨论关于做这个，做那个，也许做这个，试试这个，等等......）。

有人可以发布一个非常简单的示例，说明如何声明可以在 2 个单独的 c++ 文件中看到的结构吗？如果我将所有函数与主函数放在同一个文件中，它可以正常工作，但是当我尝试将函数拆分为不同的文件时，我无法编译它。

我不清楚的事情......我应该输入结构吗？我是否在头文件中定义结构并将该头包含在每个 C++ 源文件中？我需要头文件中的#ifndef 宏吗？我是否在标题中声明结构外部？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-25T19:21:31.097

It's called a header file.

in your header file (call it foo.h)

```
#ifndef FOO_H
#define FOO_H
class X {
};
#endif 
```

Then, in any C files you have

```
#include "foo.h"
X x; 
```

For C++ it's more common/preferred to use class, but you can use struct as well. The extern keyword generally refers to variables, not class/struct declarations. You would make a global variable extern in a header file (then declare it not-extern) in one of your .cpp files.

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-25T19:24:37.190

结构不能是外部的或静态的。如果您想在两个以上的翻译单元中使用结构，请将结构定义放入标题中：

*foo.hpp*

```
struct foo {
    int a;
    int b;
}; 
```

然后使用该结构将该头文件包含到所有源文件中。在多个源文件中定义结构/类/联合是完全有效的，只要每个源文件定义相同。您可以在 的定义周围放置一个[Include Guard](http://en.wikipedia.org/wiki/Include_guard)`foo` ，以防止 foo 被两次包含到正在编译的同一源文件中。（因此，`foo`在同一个程序中有多个是有效的，但`foo`在同一个源中有多个（注意：意思是翻译单元）是无效的。）请参阅C++ 标准或[草案中的](http://www.kuzbass.ru:8086/docs/isocpp/basic#basic.def.odr)*3.2 一个定义规则*。

当你看到这个：

```
extern struct foo { int a; int b; } b; 
```

不是`foo`外部的，而是`b`（对象）是外部的！就是说`b`没有定义，只是声明，所以你可以参考它。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-25T23:35:29.977

如果你想要一个全局变量；可从多个编译单元（C++ 文件）访问的单个结构：

```
/* foo.h */
#ifndef EXAMPLE_FOO_H
#define EXAMPLE_FOO_H

struct foo {
    int a;
    int b;
};

extern struct foo globalFoo;

#endif /* EXAMPLE_FOO_H */ 
```

--

```
/* foo.cpp */
#include "foo.h"

struct foo globalFoo = { 1, 2 }; 
```

--

```
/* bar1.cpp */
#include "foo.h"

int test1()
{
    int c = globalFoo.b; //c is 2
} 
```

--

```
/* bar2.cpp */
#include "foo.h"

int test2()
{
    int x = globalFoo.a; //x is 1
} 
```

foo.h 中的“struct {}”行告诉编译器 struct foo 的样子。“extern struct”行声明了一个名为“globalFoo”的特定struct foo，带有外部链接。（可以将这两个声明结合起来，请参阅@litb 的回答。）这意味着 globalFoo（bar1/test1 和 bar2/test2）的用户将在其他地方寻找结构，他们不会有自己的单独副本。

foo.cpp 是定义 globalFoo 的特例。任何变量只能有一个定义，在这种情况下 foo.cpp 有 globalFoo 的定义。当 bar1 和 bar2 “外部”查找 globalFoo 时，它们会找到 foo.cpp 的 globalFoo。该名称将在所有三个文件中引用相同的实际结构。

如果`extern`不存在，那么所有三个 .cpp 文件都会有一行显示“struct foo globalFoo;” （请记住，#include 只是复制/粘贴）这将 [尝试] 创建三个具有相同名称的不同结构，从而导致混乱。

注意： " `extern struct foo globalFoo;`" 行在 foo.cpp 的情况下是多余的，但这并不重要。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-25T19:22:51.500

这是一个小例子：

```
#ifndef __my_header__
#define __my_header__

class my_class
{

};

#endif 
```

该类`my_class`将在包含此标头的任何文件中可见。不过，我认为您的问题还有其他问题，但我不太明白是什么。

# c# - 在 LINQ 中获取多个集合的平均值

> ID：318552
> 
> 赞同：2
> 
> 时间：2008-11-25T19:19:36.733
> 
> 标签：c#, vb.net, linq

我有一个集合集合，所有子集合都具有相同数量的元素。父集合除了保存子集合之外什么都不做。

```
[0] [Child_0] [ID: 1]
[0] [Child_0] [Amount: 4]
[0] [Child_1] [ID: 2]
[0] [Child_1] [Amount: 7]
[1] [Child_0] [ID: 1]
[1] [Child_0] [Amount: 2]
[1] [Child_1] [ID: 2]
[1] [Child_1] [Amount: 4]
[2] [Child_0] [ID: 1]
[2] [Child_0] [Amount: 5]
[2] [Child_1] [ID: 2]
[2] [Child_1] [Amount: 3] 
```

对于我的输出，我不关心父集合。我只想要一个匿名类型的 ID 和平均金额，所以对于上述内容，它将是

```
ID     Avg
1      3.66
2      4.66 
```

响应的语言无关紧要。

谢谢。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-25T20:00:31.113

这听起来像一个简单的选择，组和平均应该做的工作；在这里，我使用匿名类型和数组纯粹是为了方便输入......

```
 // the data
        var outer = new[] {
            new[] {
                new {ID=1,Amount=4}, // [0] [Child_0] [ID: 1, Amount: 4]
                new {ID=2,Amount=7}  // [0] [Child_1] [ID: 2, Amount: 7]
            },
            new[] {
                new {ID=1, Amount=2}, // [1] [Child_0] [ID: 1, Amount: 2]
                new {ID=2, Amount=4}  // [1] [Child_1] [ID: 2, Amount: 4]
            },
            new[] {
                new {ID=1, Amount=5}, // [2] [Child_0] [ID: 1, Amount: 5]
                new {ID=2, Amount=3}  // [2] [Child_1] [ID: 2, Amount: 3]
            }
        };
        var qry = from x in outer
                  from y in x
                  group y by y.ID into grp
                  select new { Id = grp.Key, Avg = grp.Average(z => z.Amount) };

        foreach (var item in qry)
        {
            Console.WriteLine("{0}: {1}", item.Id, item.Avg);
        } 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-25T19:58:58.603

您也许可以将其作为指南

```
 var items = new[] 
        { 
            new { ID = 1, Amount = 4 }, 
            new { ID = 1, Amount = 5 },
            new { ID = 2, Amount = 5 },
            new { ID = 2, Amount = 3 },
        };

        var results = from item in items group item by item.ID into g select new { ID = g.Key, Avg = g.Average(item => item.Amount) };

        foreach (var result in results)
        {
            Console.WriteLine("{0} - {1}", result.ID, result.Avg);
        } 
```

# emacs - 在保存某些文件类型（并且仅这些文件类型）时让 Emacs 取消制表符

> ID：318553
> 
> 赞同：12
> 
> 时间：2008-11-25T19:19:51.303
> 
> 标签：emacs, tabs

我的 .emacs 文件中有以下内容：

```
 (defun c++-mode-untabify ()
   (save-excursion
     (goto-char (point-min))
     (while (re-search-forward "[ \t]+$" nil t)
       (delete-region (match-beginning 0) (match-end 0)))
     (goto-char (point-min))
     (if (search-forward "\t" nil t)
         (untabify (1- (point)) (point-max))))
   nil)

 (add-hook 'c++-mode-hook
           '(lambda ()
              (make-local-hook 'write-contents-hooks)
              (add-hook 'write-contents-hooks 'c++-mode-untabify))) 
```

大部分是从[http://www.jwz.org/doc/tabs-vs-spaces.html](http://www.jwz.org/doc/tabs-vs-spaces.html)中抄袭的。这会导致 emacs`untabify`在保存 C++ 文件之前在缓冲区上运行。

问题是，在我加载了一个 C++ 文件后，该`untabify`钩子将应用于**所有**后续文件写入，即使对于其他文件类型的缓冲区也是如此。这意味着，如果我打开一个 C++ 文件，然后编辑一个制表符分隔的文本文件，则在保存文件时制表符会被破坏。

我不是 elisp 大师，但我认为该`(make-local-hook 'write-contents-hooks)`行试图使添加`write-contents-hooks`仅适用于本地缓冲区。但是，它不起作用，并且`c++-mode-untabify`适用于`write-contents-hooks`所有缓冲区。

我在 Windows XP 机器上使用 EmacsW32 22.0。有谁知道如何对`write-contents-hooks`特定缓冲区进行本地更改，或者`nil`在切换到其他非 C++ 缓冲区时如何将其重置？

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2008-11-27T01:17:36.963

write-contents-hooks 也已过时。这就是你所追求的：

```
(add-hook 'c++-mode-hook
      '(lambda ()
         (add-hook 'before-save-hook
                   (lambda ()
                     (untabify (point-min) (point-max)))))) 
```

这是从我使用的东西中提炼出来的，它做了一些其他的事情，并被抽象出来以使用特定于编程的模式：

```
(defun untabify-buffer ()
  "Untabify current buffer"
  (interactive)
  (untabify (point-min) (point-max)))

(defun progmodes-hooks ()
  "Hooks for programming modes"
  (yas/minor-mode-on)
  (add-hook 'before-save-hook 'progmodes-write-hooks))

(defun progmodes-write-hooks ()
  "Hooks which run on file write for programming modes"
  (prog1 nil
    (set-buffer-file-coding-system 'utf-8-unix)
    (untabify-buffer)
    (copyright-update)
    (maybe-delete-trailing-whitespace)))

(defun delete-trailing-whitespacep ()
  "Should we delete trailing whitespace when saving this file?"
  (save-excursion
    (goto-char (point-min))
    (ignore-errors (next-line 25))
    (let ((pos (point)))
      (goto-char (point-min))
      (and (re-search-forward (concat "@author +" user-full-name) pos t) t))))

(defun maybe-delete-trailing-whitespace ()
  "Delete trailing whitespace if I am the author of this file."
  (interactive)
  (and (delete-trailing-whitespacep) (delete-trailing-whitespace)))

(add-hook 'php-mode-hook 'progmodes-hooks)
(add-hook 'python-mode-hook 'progmodes-hooks)
(add-hook 'js2-mode-hook 'progmodes-hooks) 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-25T20:21:14.457

我的 Emacs 中的文档说 make-local-hook 从 21.1 开始已经过时了，因为 add-hook 现在需要一个可选参数来使钩子成为缓冲区本地。所以你可以尝试：

```
(add-hook 'c++-mode-hook
           '(lambda ()
              (add-hook 'write-contents-hooks 'c++-mode-untabify nil t))) 
```

另一种选择是让 c++-mode-untabify 函数检查当前模式。我可能只是把它写成这样：

```
(defun c++-mode-untabify ()
  (if (string= (substring mode-name 0 3) "C++")
      (save-excursion
       (delete-trailing-whitespace)
       (untabify (point-min) (point-max))))) 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-25T20:23:13.343

尝试像这样添加你的钩子：

```
 (add-hook 'c++-mode-hook
           '(lambda ()
              (add-hook 'write-contents-hooks 'c++-mode-untabify nil t))) 
```

注意 add-hook 的两个额外参数。如果我没看错的话，根据文档，后面的 t 应该做 make-local-hook 所做的事情（反之亦然），但我也看到了对 make-local-hook 的引用已被弃用。至少在我的盒子（linux，gnu emacs 21.3.1）上，我看到了你想要的效果——钩子只附加到 c++ 缓冲区，而不是所有其他缓冲区。

作为最后的手段，你总是可以检查你的 c++-mode-untabify 函数，只有当当前的主要模式是 c++-mode 时才会这样做。

然而，这是一个奇怪的解决方案。如果您删除所有选项卡，您将如何将选项卡放回原处？如果你停止任何事情，你就不需要这个黑客。

> ID：318556
> 
> 赞同：
> 
> 时间：
> 
> 标签：

None

# sitemap - 生成现有站点的可视站点地图

> ID：318563
> 
> 赞同：11
> 
> 时间：2008-11-25T19:23:37.117
> 
> 标签：sitemap, information-architecture

我以为我可以通过搜索网络轻松回答这个问题，但我的 Google-fu 让我失望了。所以我转向你，哦，强大的stackoverflowers，并恳求你开悟：

**生成现有网站的可视化站点地图（例如流程图、思维导图、IA 图）的最快和最佳方法是什么？**

附加背景：我的客户已被*他们的*客户要求重新设计他们的网站。可以理解的是，艺术总监要求提供有关当前网站架构的信息，而客户对此一无所知（！）。所以他们要求我通过以某种方式爬取客户的站点来自动生成可视站点地图。

我找到了各种可以执行此操作的免费/共享软件应用程序，但无法找到评论或最佳实践。我更愿意提出强有力的建议，而不是抓住第一个似乎可以解决问题的共享软件应用程序。那么，您如何建议生成可视化站点地图？

非常感激！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-25T20:26:32.853

它不是免费的，但是 Visio 有一个网站地图图表类型，它会爬取一个站点并生成一个漂亮漂亮的结果图表。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2011-09-09T10:12:27.757

我发现的唯一好工具是powermapper。它允许您从可视站点地图中隐藏不相关的部分，并提供相当多的模板。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-11T20:48:23.923

更新时间。带有站点地图的 Visio 和 OmniGraffle 都是很好的解决方案。最后，客户发现这些应用程序本身产生了太多的细粒度信息而无用。例如，如果一个站点有 30 个产品页面，每个页面都有自己的概述、规格和文档部分，那么树确实会变得非常大。我通过获取站点地图并首先在 Excel 中对其进行清理以消除冗余，然后生成站点地图来解决此问题。有点费时，但最终还是值得的。

谢谢！

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-12-31T09:28:41.600

这是[一个](https://web.archive.org/web/20120603105539/http://htmleditors.shadowboxcreative.ca/2007/12/13/sitemap-diagrams-using-omnigraffle-applescript-and-a-google-sitemap)建议使用[XML Sitemaps](https://www.xml-sitemaps.com)或[Google Sitemap Generator](https://code.google.com/archive/p/googlesitemapgenerator)以及 AppleScript 和 OmniGraffle 的解决方案。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2014-01-07T08:51:13.667

为了将站点地图可视化为流程图，您可以使用 Site Visualizer 软件。它具有 30 天的全功能试用期，因此您可以完全免费地创建任何现有网站的可视化地图。

安装完成后，新建项目，输入需要抓取的网址，点击开始工具按钮。抓取完成后，单击[Visual Sitemap](http://site-visualizer.com/visual-sitemap "现场流程图")选项卡上的 Draw 按钮。绘制可视化时，您可以通过单击其矩形突出显示任何页面的链接。带有 rel="nofollow" 属性的出站链接用虚线绘制：

![视觉站点地图](https://i.stack.imgur.com/w7ddt.png) 单击保存按钮以将可视站点地图保存到图像文件：PNG、JPG、BMP 等。您可以在[快速入门指南](http://site-visualizer.com/help/quick-start-guide "快速入门指南")中找到更多信息。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2018-08-09T22:54:21.563

这是一个[开源项目](https://github.com/aklump/visual_sitemap)，我致力于与我的客户处理这种确切的情况。

# java - 从网站中提取信息

> ID：318564
> 
> 赞同：0
> 
> 时间：2008-11-25T19:23:41.733
> 
> 标签：java, html, html-content-extraction

并非每个网站都能通过 XML 提要、API 等很好地公开他们的数据

我怎样才能从网站中提取信息？例如：

```
...
<div>
  <div>
    <span id="important-data">information here</span>
  </div>
</div>
... 
```

我来自使用 Apache XMLBeans 进行 Java 编程和编码的背景。当我知道结构和数据位于已知标记之间时，是否有任何类似于解析 HTML 的内容？

谢谢

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-25T19:26:17.127

[这是一篇文章](http://www.manageability.org/blog/stuff/screen-scraping-tools-written-in-java)，其中包含几个用 java 编写的屏幕抓取工具。

一般来说，听起来你想看看[正则表达式](http://www.regular-expressions.info/)，它会做你正在寻找的模式匹配。

希望有帮助！

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-25T19:26:49.387

有几个用于 Java 的开源 HTML 解析器。

我过去使用过[JTidy](http://jtidy.sourceforge.net/)，并且很幸运。它将为您提供 html 页面的 DOM，您应该能够从那里获取所需的标签。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-25T19:45:13.263

对于这样的任务，Java 似乎是一个相当困难的约束。这是一个硬性要求吗？脚本语言非常适合构建真正大量的最后一英里代码。

如果你愿意接受，ruby + [hpricot](http://code.whytheluckystiff.net/hpricot/)让这一切变得微不足道。您可以使用 css 或 xpath 选择器（或两者）来查找（和操作）HTML 中的内容。在您的示例中抓取文档、解析并提取文本实际上是一行代码。

# junit - 从 Hudson 获取有用的电子邮件，而不是 ant log 的尾巴

> ID：318566
> 
> 赞同：2
> 
> 时间：2008-11-25T19:24:07.393
> 
> 标签：junit, continuous-integration, hudson

我的一个团队成员最近为我们的一些开发代码库设置了一些 Hudson 持续集成构建。它使用以简单方式配置的内置 ant 集成。

虽然它非常有用并且我强烈推荐它，但我想知道如何获得更简洁/信息丰富/有用的电子邮件，而不仅仅是 ant 构建日志的尾部。

例如，不要这样：

```
> [...truncated 36530 lines...]
>     [junit] Tests run: 32, Failures: 0, Errors: 0, Time elapsed: 0.002 sec
... (hundred of lines omitted) ...
>     [junit] Tests run: 10, Failures: 0, Errors: 0, Time elapsed: 0.001 sec
>     [junit] Tests FAILED
>
> BUILD FAILED 
```

我假设我可以跳过内置的 ant 支持并通过 grep 脚本发送构建日志，但我希望有一个更集成或更优雅的选项。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-26T09:21:19.640

我不知道你是否已经这样做了，但我认为下面的 ant 测试任务片段可以帮助你

```
<target name="test" depends="test.compile" description="runs junit tests">

        <taskdef name="junit"
            classname="org.apache.tools.ant.taskdefs.optional.junit.JUnitTask"
            classpath="${script.dir}/tools/ant-junit.jar"/>

        <junit haltonfailure="no" printsummary="on" fork="yes">
            <classpath>
                 <path refid="web.classpath.compile"/>
                 <pathelement location="${test.build.dir.classes}"/>
                 <pathelement location="${web.build.dir.classes}"/>
            </classpath>
            <formatter type="brief" usefile="false"/>
            <formatter type="xml"/>
            <batchtest todir="${script.dir}/test-results">
                <fileset dir="${test.build.dir.src}"
                        includes="**/*Test.java"/>
            </batchtest>
        </junit>
    </target> 
```

使用此配置，您将创建一个由“org.apache.tools.ant.taskdefs.optional.junit.JUnitTask”实现的“junit”任务，该任务可以位于 ant-junit.jar 包中。

之后，直接调用目标并设置一个 xml 格式化程序。

我们也在使用 Hudson，它只是发送最近构建失败的 URL，并且从那里，我们可以使用 AssertionFailedError 的跟踪访问由先前描述的任务生成的测试结果。

希望能帮助到你。

卡洛斯

# c# - 处理 SQL 数据库中的 null int/char 的最佳做法是什么？

> ID：318567
> 
> 赞同：2
> 
> 时间：2008-11-25T19:24:12.323
> 
> 标签：c#, sql-server, dbnull

我有一个保存用户可选配置文件的数据库。在配置文件中，我有字符串、char（用于 M 或 F）和 int。

我遇到了一个问题，我尝试将用户的性别放入我的 Profile 对象的属性中，并且应用程序崩溃了，因为它不知道如何处理返回的空值。

我已经尝试将数据转换为适当的类型

```
char sex = (char)dt.Rows[0]["Sex"]; 
```

这并没有解决我的问题。然后我尝试将类型更改为 Nullable 和 Nullable 并得到相同的转换问题。我目前能够找到的解决方案如下：

```
object.sex = null;  
if(dt.Rows[0]["Sex"] != DBNull.Value)
      object.sex = (char)dt.Rows[0]["Sex"];
object.WorkExt = null;
if(dt.Rows[0]["WorkExt"] != DBNull.Value)
      object.WorkExt = (int)dt.Rows[0]["WorkExt"]; 
```

有没有更简单或更好的方法来做到这一点？还是我几乎走在正确的轨道上？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-25T20:09:58.957

可空类型就是为此目的而设计的！使用“作为字符？” 而不是“（字符？）”

```
class Foo {
    char? sex;
}
Foo object;

object.sex = dt.Rows[0]["Sex"] as char?; 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-25T22:21:02.483

rotard 的答案（使用`Is<ColumnName>Null()`）仅适用于类型化的数据集。

对于无类型数据集，您必须使用以下代码中的模式之一。如果此代码不是确定的，请告诉我，我将对其进行编辑，直到确定为止。这是一个极其常见的问题，实际上应该只有一个正确答案。

```
using System.
using System.Data;

class Program
{
    static void Main(string[] args)
    {
        DataTable dt = new DataTable();
        dt.Columns.Add("test", typeof (char));
        dt.Columns["test"].AllowDBNull = true;

        DataRow dr = dt.Rows.Add();
        char? test;

        try
        {
            test = (char?)dr["test"];
        }
        catch (InvalidCastException)
        {
            Console.WriteLine("Simply casting to a nullable type doesn't work.");
        }

        test  = dr.Field<char?>("test");
        if (test == null)
        {
            Console.WriteLine("The Field extension method in .NET 3.5 converts System.DBNull to null.");                
        }

        test = (dr["test"] is DBNull) ? null : (char?) dr["test"];
        if (test == null)
        {
            Console.WriteLine("Before .NET 3.5, you have to check the type of the column's value.");
        }

        test = (dr["test"] == DBNull.Value) ? null : (char?) dr["test"];
        if (test == null)
        {
            Console.WriteLine("Comparing the field's value to DBNull.Value is very marginally faster, but takes a bit more code.");
        }

        // now let's put the data back

        try
        {
            dr["test"] = test;
        }
        catch (ArgumentException)
        {
            Console.WriteLine("You can't set nullable columns to null.");
        }

        dr.SetField("test", test);
        if (dr["test"] is DBNull)
        {
            Console.WriteLine("Again, in .NET 3.5 extension methods make this relatively easy.");
        }

        dr["test"] = (object)test ?? DBNull.Value;
        if (dr["test"] is DBNull)
        {
            Console.WriteLine("Before .NET 3.5, you can use the null coalescing operator, but note the awful cast required.");
        }

        Console.ReadLine();
    }
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-25T19:44:26.590

一个体面的讨论是在[检查 DBNull 然后分配给变量的最有效方法？](https://stackoverflow.com/questions/221582/most-efficient-way-to-check-for-dbnull-and-then-assign-to-a-variable).

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-26T14:41:16.013

怎么样：

```
 internal static T CastTo<T>(object value)
    {
        return value != DBNull.Value ? (T)value : default(T);
    } 
```

然后像这样使用它：

```
 return new EquipmentDetails(
            CastTo<int>(reader["ID"]),
            CastTo<int>(reader["CategoryID"]),
            CastTo<string>(reader["Description"])); 
```

ETC...

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-25T19:58:41.473

dt 是 ADO.Net 2 数据表吗？你能不能做这样的事情：

```
if(dt.Rows[0].IsSexNull()) {} else {} 
```

? 此外，假设您可以控制您的数据库，使用 bit 而不是 string 是否更有意义？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-25T19:27:48.697

我会像你一样做。我会为它写一个函数：

做的事情：

```
object.sex = handle(dt.Rows[0]["Sex"]); 
```

在句柄中，您执行 ==DBNull.Value 检查。

# sql - 在 SQL 中如何比较日期值？

> ID：318571
> 
> 赞同：17
> 
> 时间：2008-11-25T19:25:41.370
> 
> 标签：sql, mysql, compare, where

使用 MySQL 语法并有一个包含如下行的表：

```
mydate DATETIME NULL, 
```

有没有办法做类似的事情：

```
... WHERE mydate<='2008-11-25'; 
```

我正在尝试，但并没有真正让它发挥作用。

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2008-11-25T22:33:27.670

嗯，`WHERE mydate<='2008-11-25'` *就是*这样做的方法。那应该行得通。

您收到错误消息吗？您使用的是旧版本的 MySQL 吗？

编辑：以下在 MySQL 5.x 上对我来说很好

```
create temporary table foo(d datetime);
insert into foo(d) VALUES ('2000-01-01');
insert into foo(d) VALUES ('2001-01-01');
select * from foo where d <= '2000-06-01'; 
```

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-11-25T19:33:48.903

没关系找到答案。任何愿意回复的人都一样。

```
WHERE DATEDIFF(mydata,'2008-11-20') >=0; 
```

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2008-11-25T22:55:33.460

在标准 SQL 语法中，您将使用：

```
WHERE mydate <= DATE '2008-11-20' 
```

也就是说，关键字 DATE 应该在字符串之前。但是，在某些 DBMS 中，您不需要那么明确。系统会自动将 DATE 列转换为字符串，或将字符串转换为 DATE 值。如果将 DATE 转换为字符串，名义上会有一些有趣的含义 - 如果您碰巧有第一个千年的日期 (0001-01-01 .. 0999-12-31) 并且前导零被省略格式化系统。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-26T06:17:20.663

您可以添加时间组件

```
WHERE mydate<='2008-11-25 23:59:59' 
```

但是如果 mydate 是“2008-11-25 24:59:59”，那么在 DST 切换日期可能会失败，因此在下一个日期之前获取所有内容可能是最安全的：

```
WHERE mydate < '2008-11-26 00:00:00' 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-26T06:50:22.550

您的问题可能是您正在处理 DATETIME 数据，而不仅仅是日期。如果一行的 mydate 是 '2008-11-25 09:30 AM'，那么你的*WHERE mydate<='2008-11-25';* 不会返回该行。'2008-11-25' 的隐含时间为 00:00（午夜），因此即使日期部分相同，它们也不相等，并且 mydate 更大。

如果您使用 < '2008-11-26' 而不是 <= '2008-11-25'，那将有效。Datediff 方法之所以有效，是因为它只比较日期部分，而忽略时间。

# c++ - 面向对象还是顺序？

> ID：318590
> 
> 赞同：6
> 
> 时间：2008-11-25T19:31:27.567
> 
> 标签：c++, oop

我正在重构 main() 中的 500 行 C++ 代码以求解微分方程。我想将求解器的重要思想封装成更小的函数（即“SolvePotential(...)”而不是 50 行数字代码）。

我是否应该使用一堆带有**很长**参数列表的函数来顺序编码，例如：

```
int main(int *argc, void **argv){
   interpolate(x,y,z, x_interp, y_interp, z_interp, potential, &newPotential);
   compute_flux(x,y,z, &flux)
   compute_energy(x,y,z, &eng)
   ...
   // 10 other high-level function calls with long parameter lists
   ...
   return 0;
} 
```

或者我应该创建一个像这样调用的“SolvePotential”类：

```
int main(int *argc, void **argv){
   potential = SolvePotential(nx, ny, nz, nOrder);
   potential.solve();
   return 0;
} 
```

我将在 SolvePotential 中定义使用成员变量而不是长参数列表的函数，例如：

```
SolverPotential::solve(){
  SolvePotential::interpolate()
  SolverPotential::compute_flux()
  SolverPotential::compute_energy()
  // ... 
  //  10 other high-level function calls with NO parameter lists (just use private member variables)
} 
```

在任何一种情况下，我都怀疑我是否会非常重用代码......真的，我只是在重构以帮助提高代码的清晰度。

也许这就像在争论“是'12'还是'一打'？”，但你怎么看？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-25T19:33:49.717

按顺序编写，然后重构，如果您认为可以重用或使其更清晰。

此外，SolvePotential 类没有多大意义，因为类应该是具有 SolvePotential 方法的对象。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-25T19:40:37.487

“SolvePotential”是一个动词，类往往是附有动词的名词。我不太了解您的问题的细节，但这可能表明程序方法比这里的 OO 更清晰。无论如何，如果你确实创建了这个类，它肯定看起来只不过是对函数的打包而已。

除非我有第二个地方可以使用该类，否则我只需使用显式参数声明函数 - 这将比在需要隐藏的类上使用方法更清楚（尤其是对于第一次查看此代码的新人）状态。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-25T21:59:48.423

两者都不。“将我的所有代码从一个函数移动到一个类”不是 OOP。OOP 的基本规则之一是一个类应该有*一个单一的责任区域*。这不是一个单一的责任，它大约是 15：

```
SolverPotential::solve(){
SolvePotential::interpolate()
SolverPotential::compute_flux()
SolverPotential::compute_energy()
// ... 
//  10 other high-level function calls with NO parameter lists (just use private member variables)
} 
```

这也使得几乎不可能维护类不变量，不是吗？何时调用 compute_flux 有效？解决？插？是什么阻止我以错误的顺序做这件事？如果我这样做，班级会处于有效状态吗？我会从中获得有效数据吗？

但是，为什么是非此即彼？为什么不能创建*多个*类*和*函数？

```
// This struct could be replaced with something like typedef boost::tuple<double,double,double> coord3d
struct coord3d {
double x, y, z;
};

coord3d interpolate(const coord3d& coord, const coord3d& interpolated, double potential); // Just return the potential, rather than using messy output parameters
double compute_flux(const coord3d coord&flux); // Return the flux instead of output params
double compute_energy(const coord3d& coord); // And return the energy directly as well 
```

当然，这些函数不一定是函数。如果必要/方便，每个都可以成为一个类，或者更好的是，一个函子，以保持必要的状态，也许允许您将它们作为参数有效地传递给其他函数。

如果最佳性能很重要，您可能必须小心直接返回较大的结构，而不是使用输出参数，但我肯定会先分析一下，看看它是否有问题，即使是，您也可以避免带有表达式模板的输出参数。

如果您有一个可以执行许多独立操作的概念对象，则可能暗示您需要一些 OOP，它应该被建模为具有许多成员函数的类，每个成员函数当然都维护该类不变，无论如何、何时以及为何调用它们。

如果您需要组合多个函数，将它们粘合在一起以形成新的、更大的功能块，函数式编程和仿函数很可能是您所需要的。需要可组合函数的一个常见原因（但绝对不是唯一的原因）是，如果您需要对许多不同的数据集（甚至可能是几种不同的类型，都实现相同的概念）执行相同的操作。让仿函数完成繁重的工作允许它与 std::transform 或 std::for_each 一起使用。您可能还想使用 currying 逐步组装您的函数（也许某些函数可以使用一组固定参数进行参数化，这些参数在调用之间不会变化）。同样，创建一个使用这些固定参数初始化的仿函数，然后在 operator() 中提供变化的数据。

最后，如果您只需要对一些可变数据执行*一系列*操作，那么简单的老式过程编程可能最适合您的需求。

最后，撒上泛型编程，模板化必要的类和函数，使它们可以一起工作，而不必跳过诸如指针间接或继承之类的循环。

不要太沉迷于 OOP。使用您可以使用的工具。

我对你的问题的上下文了解不够肯定，但在我看来，你真正需要的不是一个类，它只是一个函数层次结构。您的用户代码调用solve()。solve() 在内部调用，比如说（为了举例而编造的）interpolate() 和 compute_energy()。compute_energy() 内部调用compute_flux()，等等。每个函数只进行几次调用来执行构成该函数职责的逻辑步骤。因此，你没有一个拥有十几个不同职责的庞大类，或者一个按顺序完成所有事情的大型单体函数。

无论如何，“非常长的参数列表”没有任何问题（您通常可以通过将其中一些组合在一起来缩短它们，但即使您不能，也没有关于传递大量参数的“un-OOP” . 相反，这意味着函数很好地封装了其他所有内容。它所需要的只是在参数中传递，因此它与应用程序的其余部分没有真正的联系。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-25T20:34:46.083

实际上，C++ 不仅仅是一种 OO 语言，它还混合了其他范式，包括过程范式。能够使用类并不会使它们更适合任何问题。

在我看来，函数在这里更有意义，因为您正在实现不基于状态且不需要重用数据的数学**过程。**在这里使用 OO 意味着构造对象只是为了调用一个方法然后销毁它们。对我来说，这听起来比程序 API 更容易出错，也更不直观。此外，正如 bradheintz 所说，显式的参数列表也消除了在实际使用类之前必须记住初始化类的问题（重构时的典型错误）。

顺便说一句，就函数而言，使用返回值而不是 i/o 参数通常会使 API 看起来更清晰。

我什至敢说你可能想混合使用面向对象和过程，使用类来表示向量等**概念**（我看到一些 x,y,z 周围）。如果这是您非常关心的问题，那也会删除一些参数。

```
float SolvePotential(const Vector3& vn, float nOrder)
{
    // ...
    const float newPotential = interpolate(vn, v_interp, potential);
    const float flux         = compute_flux(vn);
    const float energy       = compute_energy(vn);
    // ...
    return result;
} 
```

最后，你没有提到性能，所以我想你不介意。但是如果你这样做了，在这种情况下，使用过程方法似乎比使用 OO更容易更快*、更干净。*

希望能帮助到你！

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-25T19:36:46.870

我投票赞成这个类，因为它把数据包装在一个更整洁的包中，并使你的 main() 函数非常清晰。

从某种意义上说，您已经清理了 main() 函数，现在有一个杂乱无章的类，您可以自行决定进一步清理它。一种分而治之的方法。或者也许是“把我所有的垃圾都塞进阁楼”的方法，至少房子里最常用的部分是干净的。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-25T19:38:32.013

由于此时您不希望在其他地方重用代码，因此我将专注于使代码可读和干净。这样一来，当您需要再次求解微分方程或发现您确实想要重用代码时，您就可以弄清楚一年后它会做什么。恕我直言，带有参数列表的函数现在似乎是一个好方法。如果你发现它变得太笨重或者你确实需要重用它，那么在那个时候走对象路线会很有意义。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-25T20:39:48.070

如果您要进行严格的 MartinFowler 式重构，那么您就在正确的轨道上。为您的代码寻找隐喻，定义职责并创建符合这些划分的类。如果您创建具有清晰易懂名称的类和成员，这应该会使代码更具可读性。

您可能希望创建一些参数对象来传递参数，而不是拥有长长的参数列表。

我在 Java 中工作了很长时间，现在在 C/C++ 中工作，处于类似的位置。您是否检查过这是否是一个 500 行的主要方法是有原因的？实例化对象和检查虚拟表等存在开销。性能是这里的问题吗？似乎它会在这样的数学计算中。如果是这样的话，所有的赌注都与 Martin-Fowler 式的方法有关。

祝你好运。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-25T21:17:07.743

您忽略了一个中间立场，即开始编写一个对象，但将参数传递给它的方法。伪代码：

```
SolverPotential::solve(a, b, c, d){
  SolvePotential::interpolate(a, b);
  SolverPotential::compute_flux(b, c);
  SolverPotential::compute_energy(c, d) 
```

通过这种方式，您可以通过（可能更容易）顺序模式思考“我手头需要什么来解决这一步？”开始重构。此外，也许您会看到建议对象划分的参数和 retval 序列（“在这一步之后，我不再使用 'a'。也许前两个步骤应该封装在不同的类中。”）

此外，当您只有一个“大包”实例变量时，并行化会更加困难。如果您从显式参数开始您的工作，您将更好地了解依赖关系，并且您可能会发现可以轻松并行化的无依赖关系步骤。

如果您有大量参数，那么重构实例变量（和多个对象）是有意义的，但我建议您的*初始*步骤结合这些方法。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-11-25T22:23:21.947

既然您提到您的目标之一是封装，我将向您指出 OO 方法。

在您的示例代码中，我认为您的类名有点偏离。我将首先应用您正在进行的重构（将[方法提取](http://www.refactoring.com/catalog/extractMethod.html)到较小的函数中）。之后，分析哪些数据与哪些逻辑相匹配，并将程序设计转换为对象（Fowler 没有此“大重构”的链接）。

这就是自下而上的方法。我会采用的自上而下的方法是[Command 模式](http://en.wikipedia.org/wiki/Command_pattern)，这基本上是您在原始问题中所拥有的，保存糟糕的类名：创建一个名为 PotentialEquation 的类，通过构造函数、工厂或设置器对其进行初始化，无论您像，然后暴露一个solve()方法，可能是这样的：

```
PotentialSolution solve() 
```

在 PotentialSolution 中，您可以进一步封装方程的解，这可能比原始类型更复杂。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-12-01T23:50:57.653

在您的情况下，我并不真的推荐这种设计作为一种务实的方法，但作为这种领域的一种可能的解决方案，它可能非常有趣。

如果您要将微分求解器实现为不可变类的集合，这些类被创建，然后有一些方便的无 arg 'compute()' 方法来调用，该方法使用实例变量计算与该类关联的值，并存储并返回回答。然后，您将能够在每个类中构建一个缓存机制，这样如果您已经为相同的参数计算了答案，您就不必重新评估答案。

恐怕我不懂 C++ 语法，所以我会改用 Java。

```
public class ValuePlusOne implements Computable {
    private int value;
    private int result;
    private Boolean hasRun;
    private static Map instanceMap = new HashMap();

    // Creates an instance reusing an existing one if possible
    public static getInstance(int value) {
        ValuePlusOne instance = (ValuePlusOne)instanceMap.get(value);

        if (instance = null) {
            instance = new ValuePlusOne(value);
            instanceMap.put(value,instance);
        }
        return instance;
    }

    // Private constructor
    private ValuePlusOne(int value) {
        this.value = value;
        hasRun = false;
    }

    // Computes (if not already computed) and returns the answer
    public int compute() {
        if (!hasRun) {
            hasRun = true;
            result = value + 1;
        }

        return result;
    }
} 
```

这意味着您将能够无形地重用您之前完成的任何计算。如果您经常使用相同的参数重做计算，并且在（近似）连续的微分域中，这可能很少发生，这只会让您加快速度。这种方法也适用于并行化，但需要对其进行修改以确保安全。

除非缓存提供了真正的好处，否则我更愿意使用平面 C 风格的过程方法。任何人都可以使用无状态的数据输入数据输出方法轻松阅读和理解您的代码。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-12-11T23:14:47.110

在我看来，这确实是一个接受输入（尽管可能很大）并返回输出（可能很大）的函数。在我看来，您愿意采用函数式方法，但担心参数列表过长。

在那种情况下，我认为您除了忙于工作之外不会做更多的事情来尝试以某种方式将其转换为一个对象。我会考虑创建一些结构来保存相似的参数，并将这些结构传递给你的函数而不是单个参数。我喜欢将巨大的方法分解为子方法的想法，但在我看来，这听起来并不像是*必须*与一个类相关联，而且尝试这样做可能需要更多的工作，但没有太多明显的好处。

如果在将函数分解为子函数并将参数合并到结构中时，您会在其中看到一个好的对象，那就去吧，但是如果问题不存在，我不会花时间尝试将它硬塞进一个.

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2019-08-19T10:37:09.613

为清楚起见，我将评论解释我正在做什么的代码，并使用适当的空格，您应该有一个可读的单个函数。类对于封装来说不是一个坏主意。我要做的是使这些步骤成为私有方法，这样它们就不能被孤立地或以错误的顺序调用。然后有一个公共的计算方法，并让它以正确的顺序执行所有步骤（调用私有方法）。这是假设您不期望重用中间方法。我也认为拥有一个有据可查的长函数来处理整个事情没有任何问题。无论理论/常规应该是什么，我都会选择对我最有意义的任何方法。

* * *

## 回答 #13

> 赞同：-1
> 
> 时间：2008-11-25T19:37:44.933

由于您使用的是面向对象的语言，因此您应该选择对象，假设您将来可以**重用**它们。

只有一个建议：尝试设计一个好的类图。你程序的实体是什么？我会看到一个带有派生的“微分方程”类的“方程”类，依此类推。

# javascript - 动作脚本 3 REPL

> ID：318596
> 
> 赞同：6
> 
> 时间：2008-11-25T19:33:20.357
> 
> 标签：javascript, flash, actionscript, read-eval-print-loop

Actionscript 3是否有[REPL （读取-评估-打印循环）可用？](http://en.wikipedia.org/wiki/REPL)我在谷歌上找不到任何东西，但它真的会派上用场。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-02T21:43:45.083

[谷歌更难](http://eval.hurlant.com/demo/)。;)

* * *

## 回答 #2

> 赞同：-2
> 
> 时间：2008-12-02T13:11:10.457

actionscript3 是一种编译语言，所以这可能吗？

# asp.net - VS2008自动设置单元测试项目，求帮助

> ID：318603
> 
> 赞同：1
> 
> 时间：2008-11-25T19:36:43.937
> 
> 标签：asp.net, asp.net-mvc, visual-studio, visual-studio-2008, unit-testing

我开始玩弄新的 ASP.NET MVC 框架，并在一些教程中阅读我看到除了创建 MVC 项目之外，还有一个选项来添加一个单元测试项目，使用测试框架（我有) 这基本上已经为 MVC 测试设置好了。
它应该在你创建一个新的 MVC 项目时弹出，看起来像这样 -

[http://quickstarts.asp.net/previews/mvc/images/mvcCreateUnitTestProject.PNG http://quickstarts.asp.net/previews/mvc/images/mvcCreateUnitTestProject.PNG](http://quickstarts.asp.net/previews/mvc/images/mvcCreateUnitTestProject.PNG)

但事实并非如此，我不得不通过将其添加到解决方案中来自己创建单元测试项目，考虑到 MVC 项目结构，这很耗时并且通常很烦人......
我已经查看了测试框架设置，但找不到使该窗口出现的方法，或者找不到任何选项来创建 MVC 测试项目。
有任何想法吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-25T19:44:31.847

没关系，重新安装 MVC 框架解决了问题

# java - displaytag：抑制 HTML 表格中的零

> ID：318612
> 
> 赞同：3
> 
> 时间：2008-11-25T19:39:25.587
> 
> 标签：java, html, jsp, html-table, displaytag

我有一个由 displaytag 标记库在 JSP 中生成的 HTML 表。我想禁止出现在表格中的任何零，即它们应该被一个空白单元格替换。有没有直接的方法来实现这一目标？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-26T03:57:31.133

我发现这可以使用 ColumnDecorator 的自定义实现来实现。

```
public class SuppressZeroDecorator implements DisplaytagColumnDecorator {

    /* (non-Javadoc)
     * @see org.displaytag.decorator.DisplaytagColumnDecorator#decorate(java.lang.Object, javax.servlet.jsp.PageContext, org.displaytag.properties.MediaTypeEnum)
     */
    public Object decorate(Object rowObject, PageContext pageContext, MediaTypeEnum mediaType) {

        if (rowObject != null && rowObject.toString().trim().equals("0")) {
            return null;
        }

        return rowObject;
    }
} 
```

应该为 JSP 中的每一列声明装饰器，如下所示：

```
<display:column property="age" title="Age" decorator="com.example.ZeroColumnDecorator" /> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-25T21:59:45.770

创建一个 org.displaytag.decorator.TableDecorator 实例，并将其放入表中。使用 display:table 标签的 decorator 属性将您的完全限定的装饰器类名放入表中（我相信您可以实例化一个然后将其放入，但是此类实例化很简单……确保您有一个无参数的构造函数使其正常工作）。

方法 initRow(...) 或 startRow() 是您将通过表对象的地方，将您找到的任何零设置为空（或者，如果显示空，则设置一个空格）。我推荐使用 initRow，但请确保首先使用 super.initRow() 来轻松访问当前行对象。我推荐这样做的原因是 startRow 必须返回一个字符串（默认返回一个空字符串），我认为您不需要这样做。

* * *

## 回答 #3

> 赞同：-2
> 
> 时间：2008-11-25T21:00:03.677

据我所知，没有一种“直截了当”的方式来处理这个问题。唯一与数据相关的配置属性是是否显示空值。

你最好在数据到达 displaytag 标签之前处理这个问题。也许在提供数据的 servlet 或视图助手类中。

# hdrimages - 16 位浮点数据类型

> ID：318625
> 
> 赞同：3
> 
> 时间：2008-11-25T19:43:07.450
> 
> 标签：hdrimages, openexr

有没有人有在应用程序中使用 16 位浮点类型的经验。这种相对较新的数据类型用于计算机图形学。它由几个规范定义：OpenEXR、DirectX 和新的 IEEE-754 2008 标准。

在 WinHEC 2008 上，Microsoft 的 Chas Boyd 有一个演示文稿来宣传这种数据类型。（我不在那里，但我看到了幻灯片。）“float-16 是新字节”。

我的问题是：是否有人将此数据类型用于 DirectX 纹理之外的任何内容？

如果是这样，为什么？你的应用程序在做什么？

如果是这样，您是否需要完整的 IEEE 支持，包括 denomals、NaN 和 #Inf？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-26T00:22:27.933

我在 uclinux 的 DSP 库中遇到过这种类型，包括所有主要操作的软件实现。它非常适合 8 位和 16 位处理器，在软件中比 32 位或更大的类型更容易处理。

# error-handling - 内部错误标记

> ID：318626
> 
> 赞同：4
> 
> 时间：2008-11-25T19:43:41.897
> 
> 标签：error-handling, user-experience, error-reporting

从理论上讲，最终用户永远不会看到内部错误。但在实践中，理论和实践是不同的。所以问题是向最终用户展示什么。现在，对于完全非技术的用户，您希望尽可能少地显示（“*单击此处提交错误报告*”之类的东西），但对于更高级的用户，他们会想知道是否有解决方法，如果它已经知道了一段时间，等等。所以你想包括*一些*关于什么是错误的信息。

执行此操作的经典方法是使用文件名：行号的断言或具有相同的堆栈跟踪。现在这对开发人员来说是件好事，因为它把问题指向了他；但是它对用户来说有一些明显的缺点，特别是它非常神秘（例如不友好）并且代码更改会更改错误消息（谷歌搜索错误仅适用于此版本）。

我有一个程序，我正计划在我想解决这些问题的地方编写程序。我想要的是一种将唯一身份附加到每个断言的方法，这样编辑断言周围的代码不会改变它。（例如，如果我将它剪切/粘贴到另一个文件，我希望显示相同的信息）有什么想法吗？

我正在考虑的一种方法是对错误进行枚举，但是如何确保它们永远不会在多个地方使用呢？

（注意：对于这个问题，*我*只关注由编码错误引起的错误。而不是像错误输入这样可能合法发生的事情。OTOH 这些错误可能会引起整个社区的兴趣。）

（注 2：有问题的程序将是在用户系统上运行的命令行应用程序。但同样，这只是我的情况。）

（注 3：目标语言是[D](http://www.digitalmars.com/d/)，[我非常愿意](http://www.dsource.org/projects/scrapple/browser/trunk/dparser/dparse.d)深入研究[元编程](http://www.digitalmars.com/d/2.0/templates-revisited.html)。非常欢迎其他语言的答案！）

（注 4：我明确不想使用实际的代码位置，而是使用某种符号名称来表示错误。这是因为如果代码以任何方式更改，代码位置也会发生变化。）

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-25T19:53:30.067

有趣的问题。我多次使用的解决方案是：如果是致命错误（例如，非致命错误应该让用户有机会更正输入），我们生成一个包含大量相关信息的文件：请求变量，标头、内部配置信息和完整的回溯，以供以后调试。我们将其存储在具有生成的唯一文件名的文件中（并以时间为前缀）。

对于用户，我们会显示一个页面，说明发生了不可恢复的错误，并要求他们在报告错误时包含文件名作为参考。使用来自违规请求的上下文的所有这些信息进行调试要容易得多。

在 PHP 中，debug_backtrace() 函数对此非常有用。我敢肯定你的平台有一个等价物。

还要记得发送相关的 http 标头：可能：HTTP/1.1 500 Internal Server Error

给定错误报告文件的合理格式，还可以分析用户未报告的错误。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-25T19:54:44.213

编写一个脚本来 grep 你的整个源代码树以使用这些错误代码，然后如果有重复则抱怨。将该脚本作为单元测试的一部分运行。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-26T05:32:12.237

我对您的目标语言一无所知，但这是一个有趣的问题，我已经考虑过，我想加两分钱。

我的感觉一直是硬错误和内部错误的消息应该尽可能有用，以便开发人员识别问题并快速修复它。大多数用户甚至不会查看此错误消息，但高度复杂的最终用户（可能是技术支持人员）通常会很好地了解问题所在，甚至通过查看非常详细的错误消息来提出新颖的解决方法。关键是让这些错误消息详细而不神秘，这更像是一门艺术而不是一门科学。

来自使用进程外 COM 服务器的 Windows 程序的示例。如果主程序尝试从 COM 服务器实例化对象并失败并显示错误消息：

> “警告：无法实例化 UtilityObject：‘CoCreateInstance’中的错误‘类未注册’”

99% 的用户会看到这个并认为它是用希腊语写的。技术支持人员可能很快意识到他们需要重新注册 COM 服务器。开发人员将确切地知道出了什么问题。

为了将一些上下文信息与断言相关联，在我的 C++ 代码中，我经常使用带有方法名称的简单字符串，或者其他可以明确错误发生位置的字符串（我很抱歉以您没有使用的语言回答不要问）：

```
int someFunction()
{
  static const std::string loc = "someFunction";
  :  :
  if( somethingWentWrong )
  {
    WarningMessage(loc.c_str(), "Unable to Instantiate UtilityObject:  Error 'Class Not
    Registered' in 'CoCreateInstance);
  }
} 
```

...生成：

> 警告 [someFunction]：无法实例化 UtilityObject：“CoCreateInstance”中的“类未注册”错误

# javascript - 使用 JavaScript 获取图像的真实宽度和高度？（在 Safari/Chrome 中）

> ID：318630
> 
> 赞同：282
> 
> 时间：2008-11-25T19:44:38.617
> 
> 标签：javascript, jquery, safari, google-chrome, webkit

我正在创建一个 jQuery 插件。

如何在 Safari 中使用 Javascript 获取真实的图像宽度和高度？

以下适用于 Firefox 3、IE7 和 Opera 9：

```
var pic = $("img")

// need to remove these in of case img-element has set width and height
pic.removeAttr("width"); 
pic.removeAttr("height");

var pic_real_width = pic.width();
var pic_real_height = pic.height(); 
```

但在 Safari 和 Google Chrome 等 Webkit 浏览器中，值为 0。

* * *

## 回答 #1

> 赞同：357
> 
> 时间：2009-03-22T02:19:35.523

Webkit 浏览器在加载图像后设置 height 和 width 属性。我建议不要使用超时，而是使用图像的 onload 事件。这是一个简单的例子：

```
var img = $("img")[0]; // Get my img elem
var pic_real_width, pic_real_height;
$("<img/>") // Make in memory copy of image to avoid css issues
    .attr("src", $(img).attr("src"))
    .load(function() {
        pic_real_width = this.width;   // Note: $(this).width() will not
        pic_real_height = this.height; // work for in memory images.
    }); 
```

为了避免 CSS 可能对图像尺寸产生任何影响，上面的代码在内存中创建了图像的副本。这是[FDisk](https://stackoverflow.com/questions/318630#3192577)提出的一个非常聪明的解决方案。

您还可以使用`naturalHeight`和`naturalWidth`HTML5 属性。

* * *

## 回答 #2

> 赞同：289
> 
> 时间：2011-06-20T15:27:34.133

使用[HTML5](http://www.w3.org/TR/html5/embedded-content-0.html#the-img-element)`naturalHeight`中的和`naturalWidth`属性。

例如：

```
var h = document.querySelector('img').naturalHeight; 
```

*适用于 IE9+、Chrome、Firefox、Safari 和 Opera ( [stats](http://caniuse.com/#feat=img-naturalwidth-naturalheight) )。*

* * *

## 回答 #3

> 赞同：62
> 
> 时间：2010-07-07T07:00:58.590

```
 function getOriginalWidthOfImg(img_element) {
    var t = new Image();
    t.src = (img_element.getAttribute ? img_element.getAttribute("src") : false) || img_element.src;
    return t.width;
} 
```

您不需要从图像或图像尺寸属性中删除样式。只需使用 javascript 创建一个元素并获取创建的对象宽度。

* * *

## 回答 #4

> 赞同：17
> 
> 时间：2011-02-05T19:42:18.303

在接受的答案中有很多关于`onload`如果从 WebKit 缓存加载图像时事件不会触发的问题的讨论。

就我而言，`onload`会触发缓存图像，但高度和宽度仍为 0。一个简单`setTimeout`的方法为我解决了这个问题：

```
$("img").one("load", function(){
    var img = this;
    setTimeout(function(){
        // do something based on img.width and/or img.height
    }, 0);
}); 
```

我无法解释为什么`onload`即使从缓存中加载图像也会触发事件（jQuery 1.4/1.5 的改进？） - 但如果你仍然遇到这个问题，也许我的答案和`var src = img.src; img.src = ""; img.src = src;`技术的结合会工作。

（请注意，出于我的目的，我不关心图像的属性或 CSS 样式中的预定义尺寸 - 但您可能希望按照 Xavi 的回答删除这些尺寸。或者克隆图像。）

* * *

## 回答 #5

> 赞同：16
> 
> 时间：2008-11-25T20:47:47.897

根本问题是 WebKit 浏览器（Safari 和 Chrome）并行加载 JavaScript 和 CSS 信息。因此，JavaScript 可能在计算 CSS 的样式效果之前执行，返回错误的答案。在 jQuery 中，我发现解决方案是等到 document.readyState == 'complete', .eg,

```
jQuery(document).ready(function(){
  if (jQuery.browser.safari && document.readyState != "complete"){
    //console.info('ready...');
    setTimeout( arguments.callee, 100 );
    return;
  } 
  ... (rest of function) 
```

就宽度和高度而言...取决于您在做什么，您可能需要 offsetWidth 和 offsetHeight，其中包括边框和填充等内容。

* * *

## 回答 #6

> 赞同：11
> 
> 时间：2008-11-25T20:16:29.693

通过从`window.onload`事件内部触发，这对我有用（safari 3.2）：

```
$(window).load(function() {
  var pic = $('img');

  pic.removeAttr("width"); 
  pic.removeAttr("height");

  alert( pic.width() );
  alert( pic.height() );
}); 
```

* * *

## 回答 #7

> 赞同：8
> 
> 时间：2012-05-31T21:15:55.480

您可以使用 Javascript 以编程方式获取图像并检查尺寸，而无需完全弄乱 DOM。

```
var img = new Image();
img.onload = function() {
  console.log(this.width + 'x' + this.height);
}
img.src = 'http://www.google.com/intl/en_ALL/images/logo.gif'; 
```

* * *

## 回答 #8

> 赞同：7
> 
> 时间：2012-01-03T18:54:42.060

`image.naturalHeight`和`image.naturalWidth`属性呢？

似乎在 Chrome、Safari 和 Firefox 中的很多版本都可以正常工作，但在 IE8 甚至 IE9 中根本不行。

* * *

## 回答 #9

> 赞同：6
> 
> 时间：2015-08-02T20:29:03.023

Jquery 有两个属性叫做 naturalWidth 和 naturalHeight，你可以这样使用。

```
$('.my-img')[0].naturalWidth 
$('.my-img')[0].naturalHeight 
```

其中 my-img 是用于选择我的图像的类名。

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2010-12-02T07:07:38.883

我们如何在不闪烁真实图像的情况下获得正确的真实尺寸：

```
(function( $ ){
   $.fn.getDimensions=function(){
         alert("First example:This works only for HTML code without CSS width/height definition.");
         w=$(this, 'img')[0].width;
         h=$(this, 'img')[0].height;

         alert("This is a width/height on your monitor: " + $(this, 'img')[0].width+"/"+$(this, 'img')[0].height);

         //This is bad practice - it shows on your monitor
         $(this, 'img')[0].removeAttribute( "width" );
         $(this, 'img')[0].removeAttribute( "height" );
         alert("This is a bad effect of view after attributes removing, but we get right dimensions: "+  $(this, 'img')[0].width+"/"+$(this, 'img')[0].height);
         //I'am going to repare it
         $(this, 'img')[0].width=w;
         $(this, 'img')[0].height=h;
         //This is a good practice - it doesn't show on your monitor
         ku=$(this, 'img').clone(); //We will work with a clone
         ku.attr( "id","mnbv1lk87jhy0utrd" );//Markup clone for a final removing
         ku[0].removeAttribute( "width" );
         ku[0].removeAttribute( "height" );
         //Now we still get 0
         alert("There are still 0 before a clone appending to document: "+ $(ku)[0].width+"/"+$(ku)[0].height);
         //Hide a clone
         ku.css({"visibility" : "hidden",'position':'absolute','left':'-9999px'}); 
         //A clone appending
         $(document.body).append (ku[0]);
         alert("We get right dimensions: "+ $(ku)[0].width+"/"+$(ku)[0].height);
         //Remove a clone
         $("#mnbv1lk87jhy0utrd").remove();

         //But a next resolution is the best of all. It works in case of CSS definition of dimensions as well.
         alert("But if you want to read real dimensions for image with CSS class definition outside of img element, you can't do it with a clone of image. Clone method is working with CSS dimensions, a clone has dimensions as well as in CSS class. That's why you have to work with a new img element.");
         imgcopy=$('<img src="'+ $(this, 'img').attr('src') +'" />');//new object 
         imgcopy.attr( "id","mnbv1lk87jhy0aaa" );//Markup for a final removing
         imgcopy.css({"visibility" : "hidden",'position':'absolute','left':'-9999px'});//hide copy 
         $(document.body).append (imgcopy);//append to document 
         alert("We get right dimensions: "+ imgcopy.width()+"/"+imgcopy.height());
         $("#mnbv1lk87jhy0aaa").remove();

   }
})( jQuery );

$(document).ready(function(){

   $("img.toreaddimensions").click(function(){$(this).getDimensions();});
}); 
```

它适用于 <img class="toreaddimensions"...

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2011-09-27T17:09:04.450

如前所述，如果图像在缓存中，[Xavi 答案](https://stackoverflow.com/questions/318630/get-real-image-width-and-height-with-javascript-in-safari-chrome/670433#670433)将不起作用。该问题响应 webkit 未触发缓存图像的加载事件，因此如果未在 img 标记中明确设置宽度/高度属性，则获取图像的唯一可靠方法是等待`window.load`触发事件。

该`window.load`事件将**始终**触发，因此无需任何技巧即可安全地访问和 img 的宽度/高度。

```
$(window).load(function(){

   //these all work

   $('img#someId').css('width');
   $('img#someId').width();
   $('img#someId').get(0).style.width;
   $('img#someId').get(0).width; 

}); 
```

如果您需要获取可能被缓存（先前加载）的动态加载图像的大小，您可以使用 Xavi 方法加上一个查询字符串来触发缓存刷新。缺点是它会导致对服务器的另一个请求，对于一个已经缓存并且应该已经可用的 img。愚蠢的Webkit。

```
var pic_real_width   = 0,
    img_src_no_cache = $('img#someId').attr('src') + '?cache=' + Date.now();

$('<img/>').attr('src', img_src_no_cache).load(function(){

   pic_real_width = this.width;

}); 
```

ps：如果你已经有一个QueryString `img.src`，你将不得不[解析它](https://stackoverflow.com/questions/486896/adding-a-parameter-to-the-url-with-javascript)并添加额外的参数来清除缓存。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2009-11-06T15:22:04.160

正如卢克史密斯所说，[图像加载是一团糟](http://twitter.com/ls_n/status/5178745627)。它在所有浏览器上都不可靠。这个事实给了我很大的痛苦。在某些浏览器中，缓存的图像根本不会触发事件，所以那些说“图像加载比 setTimeout 更好”的人是错误的。

卢克史密斯的解决方案在[这里。](http://lucassmith.name/2008/11/is-my-image-loaded.html)

关于如何在 jQuery 1.4 中处理这种混乱，还有[一个有趣的讨论。](http://groups.google.com/group/jquery-dev/browse_frm/thread/eee6ab7b2da50e1f)

我发现将宽度设置为 0 非常可靠，然后等待“完成”属性变为真并且宽度属性大于零。你也应该注意错误。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2010-07-09T21:39:54.820

```
$("#myImg").one("load",function(){
  //do something, like getting image width/height
}).each(function(){
  if(this.complete) $(this).trigger("load");
}); 
```

来自克里斯的评论：[http ://api.jquery.com/load-event/](http://api.jquery.com/load-event/)

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2012-11-01T00:59:26.870

我的情况可能有点不同。我正在通过 javascript 动态更改图像的 src，并且需要确保新图像的大小按比例调整以适合固定容器（在照片库中）。我最初只是在加载图像后（通过图像的加载事件）删除了图像的宽度和高度属性，并在计算出首选尺寸后重置这些属性。但是，这在 Safari 和可能的 IE 中不起作用（我没有在 IE 中彻底测试过它，但图像甚至没有显示，所以......）。

无论如何，Safari 会保留前一张图片的尺寸，因此尺寸总是在一张图片后面。我认为这与缓存有关。因此，最简单的解决方案是克隆图像并将其添加到 DOM（重要的是，将其添加到 DOM 以获取 with 和 height）。将图像的可见性值设置为 hidden（不要使用 display none，因为它不起作用）。获得尺寸后，删除克隆。

这是我使用 jQuery 的代码：

```
// Hack for Safari and others
// clone the image and add it to the DOM
// to get the actual width and height
// of the newly loaded image

var cloned, 
    o_width, 
    o_height, 
    src = 'my_image.jpg', 
    img = [some existing image object];

$(img)
.load(function()
{
    $(this).removeAttr('height').removeAttr('width');
    cloned = $(this).clone().css({visibility:'hidden'});
    $('body').append(cloned);
    o_width = cloned.get(0).width; // I prefer to use native javascript for this
    o_height = cloned.get(0).height; // I prefer to use native javascript for this
    cloned.remove();
    $(this).attr({width:o_width, height:o_height});
})
.attr(src:src); 
```

该解决方案在任何情况下都有效。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2010-09-24T22:47:53.470

现在有一个 jQuery 插件，`event.special.load`用于处理缓存图像上的加载事件不触发的情况：http: [//github.com/peol/jquery.imgloaded/raw/master/ahpi.imgload.js](http://github.com/peol/jquery.imgloaded/raw/master/ahpi.imgload.js)

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2011-01-26T17:30:59.093

最近我需要找到宽度和高度来设置 .dialog 表示图形的默认大小。我使用的解决方案是：

```
 graph= $('<img/>', {"src":'mySRC', id:'graph-img'});
    graph.bind('load', function (){
        wid = graph.attr('width');
        hei = graph.attr('height');

        graph.dialog({ autoOpen: false, title: 'MyGraphTitle', height:hei, width:wid })
    }) 
```

对我来说，这适用于 FF3、Opera 10、IE 8、7、6

PS 您可能会在 LightBox 或 ColorBox 等插件中找到更多解决方案

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2011-08-16T20:00:02.290

为了补充 Xavi 的答案，~~[Paul Irish 的 github](https://gist.github.com/268257)~~ [David Desandro 的 gitgub 提供了一个名为 imagesLoaded() 的函数](https://github.com/desandro/imagesloaded)，它的工作原理相同，并解决了某些浏览器的缓存图像不触发 .load() 事件的问题（巧妙的 original_src -> data_uri -> original_src 切换）。

它被广泛使用并定期更新，这有助于它成为解决问题的最强大的解决方案，IMO。

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2012-02-20T12:45:48.133

这适用于缓存和动态加载的图像。

```
function LoadImage(imgSrc, callback){
  var image = new Image();
  image.src = imgSrc;
  if (image.complete) {
    callback(image);
    image.onload=function(){};
  } else {
    image.onload = function() {
      callback(image);
      // clear onLoad, IE behaves erratically with animated gifs otherwise
      image.onload=function(){};
    }
    image.onerror = function() {
        alert("Could not load image.");
    }
  }
} 
```

要使用此脚本：

```
function AlertImageSize(image) {
  alert("Image size: " + image.width + "x" + image.height);
}
LoadImage("http://example.org/image.png", AlertImageSize); 
```

演示：http: [//jsfiddle.net/9543z/2/](http://jsfiddle.net/9543z/2/)

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2012-04-19T08:04:58.400

我已经使用 imagesLoaded jquery 插件完成了一些解决方法实用功能： [https ://github.com/desandro/imagesloaded](https://github.com/desandro/imagesloaded)

```
 function waitForImageSize(src, func, ctx){
                if(!ctx)ctx = window;
                var img = new Image();
                img.src = src;
                $(img).imagesLoaded($.proxy(function(){
                    var w = this.img.innerWidth||this.img.naturalWidth;
                    var h = this.img.innerHeight||this.img.naturalHeight;
                    this.func.call(this.ctx, w, h, this.img);
                },{img: img, func: func, ctx: ctx}));
            }, 
```

您可以通过传递 url、函数及其上下文来使用它。加载图像后执行函数并返回创建的图像，其宽度和高度。

```
waitForImageSize("image.png", function(w,h){alert(w+","+h)},this) 
```

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2014-02-26T05:40:26.377

如果图像已被使用，您应该：

1.  将图像尺寸设置为初始值

    image.css('宽度', '初始'); image.css('高度', '初始');

2.  获取尺寸

    var originalWidth = $(this).width(); var originalHeight = $(this).height();

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2017-12-14T22:43:43.087

您可以使用 HTML 图像元素的 naturalWidth 和 naturalHeight 属性。（这里有更多[信息](https://developer.mozilla.org/en-US/docs/Web/API/HTMLImageElement)）。

你会像这样使用它：

```
//you need a reference to the DOM element, not a jQuery object. It would be better if you can use document.getElementByTagsName or ID or any other native method
var pic = $("img")[0];
var pic_real_width = pic.naturalWidth;
var pic_real_height = pic.naturalHeight; 
```

似乎这适用于所有浏览器，但 IE 版本 8 及以下版本除外。

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2010-12-14T09:49:39.810

我查看了 Dio 的答案，它对我很有用。

`$('#image').fadeIn(10,function () {var tmpW = $(this).width(); var tmpH = $(this).height(); });`

确保你调用了所有的函数。在fadeIn() 的recaller 函数中处理图像大小。

谢谢你。

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2010-12-17T10:07:57.523

我使用不同的方法，只需在使用图像对象时对服务器进行 Ajax 调用以获取图像大小。

```
//make json call to server to get image size
$.getJSON("http://server/getimagesize.php",
{"src":url},
SetImageWidth
);

//callback function
function SetImageWidth(data) {

    var wrap = $("div#image_gallery #image_wrap");

    //remove height
     wrap.find("img").removeAttr('height');
    //remove height
     wrap.find("img").removeAttr('width');

    //set image width
    if (data.width > 635) {
        wrap.find("img").width(635);
    }
    else {
         wrap.find("img").width(data.width);
    }
} 
```

当然还有服务器端代码：

```
<?php

$image_width = 0;
$image_height = 0;

if (isset ($_REQUEST['src']) && is_file($_SERVER['DOCUMENT_ROOT'] . $_REQUEST['src'])) {

    $imageinfo = getimagesize($_SERVER['DOCUMENT_ROOT'].$_REQUEST['src']);
    if ($imageinfo) {
       $image_width=  $imageinfo[0];
       $image_height= $imageinfo[1];
    }
}

$arr = array ('width'=>$image_width,'height'=>$image_height);

echo json_encode($arr);

?> 
```

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2011-12-10T11:04:05.693

另一个建议是使用[imagesLoaded 插件](https://github.com/desandro/imagesloaded)。

```
$("img").imagesLoaded(function(){
alert( $(this).width() );
alert( $(this).height() );
}); 
```

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2012-01-03T05:19:36.563

这适用于跨浏览器

```
var img = new Image();
$(img).bind('load error', function(e)
{
    $.data(img, 'dimensions', { 'width': img.width, 'height': img.height });                    
});
img.src = imgs[i]; 
```

通过使用获取尺寸

```
$(this).data('dimensions').width;
$(this).data('dimensions').height; 
```

干杯!

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2012-08-03T05:11:25.770

```
$(document).ready(function(){
                            var image = $("#fix_img");
                            var w = image.width();
                            var h = image.height();
                            var mr = 274/200;
                            var ir = w/h
                            if(ir > mr){
                                image.height(200);
                                image.width(200*ir);
                            } else{
                                image.width(274);
                                image.height(274/ir);
                            }
                        }); 
```

// 此代码有助于显示 200*274 尺寸的图像

* * *

## 回答 #27

> 赞同：0
> 
> 时间：2013-05-01T20:22:12.567

这是一个跨浏览器解决方案，当您选择的图像被加载时触发一个事件：http: [//desandro.github.io/imagesloaded/](http://desandro.github.io/imagesloaded/)您可以在 imagesLoaded() 函数中查找高度和宽度。

* * *

## 回答 #28

> 赞同：0
> 
> 时间：2013-09-11T20:34:10.237

偶然发现这个线程试图为我自己的问题找到答案。我试图在加载程序之后的函数中获取图像的宽度/高度，并不断提出 0。不过，我觉得这可能是您正在寻找的东西，因为它对我有用：

```
tempObject.image = $('<img />').attr({ 'src':"images/prod-" + tempObject.id + ".png", load:preloader });
xmlProjectInfo.push(tempObject);

function preloader() {
    imagesLoaded++;
    if (imagesLoaded >= itemsToLoad) { //itemsToLoad gets set elsewhere in code
        DetachEvent(this, 'load', preloader); //function that removes event listener
        drawItems();
    }   
}

function drawItems() {
    for(var i = 1; i <= xmlProjectInfo.length; i++)
        alert(xmlProjectInfo[i - 1].image[0].width);
} 
```

* * *

## 回答 #29

> 赞同：0
> 
> 时间：2015-11-30T07:37:02.820

在 github 中查看这个存储库！

使用Javascript检查宽度和高度的好例子

[https://github.com/AzizAK/ImageRealSize](https://github.com/AzizAK/ImageRealSize)

---从一些评论中要求编辑..

Javascript代码：

```
 function CheckImageSize(){
var image = document.getElementById("Image").files[0];
           createReader(image, function (w, h) {

                alert("Width is: " + w + " And Height is: "+h);
});            
}

  function  createReader(file, whenReady) {
        var reader = new FileReader;
        reader.onload = function (evt) {
            var image = new Image();
            image.onload = function (evt) {
                var width = this.width;
                var height = this.height;
                if (whenReady) whenReady(width, height);
            };
            image.src = evt.target.result;
        };
        reader.readAsDataURL(file);
    } 
```

和 HTML 代码：

```
<html>
<head>
<title>Image Real Size</title>
<script src="ImageSize.js"></script>
</head>
<body>
<input type="file" id="Image"/>
<input type="button" value="Find the dimensions" onclick="CheckImageSize()"/>
</body>
<html> 
```

* * *

## 回答 #30

> 赞同：-1
> 
> 时间：2009-08-27T15:04:39.550

对于您不想更改原始位置或图像的功能。

```
$(this).clone().removeAttr("width").attr("width");
$(this).clone().removeAttr("height").attr("height); 
```

# visual-studio-2005 - 锚定到所有 4 个侧面的表单的文本框未正确显示

> ID：318632
> 
> 赞同：3
> 
> 时间：2008-11-25T19:45:25.793
> 
> 标签：visual-studio-2005, user-controls, .net-2.0, textbox, anchor

我在尝试将文本框锚定到所有 4 个侧面的表单时遇到问题。我在窗体中添加了一个文本框，并将 Multiline 属性设置为 True，将 Anchor 属性设置为 Left、Right、Up 和 Down，以便文本框在运行时随窗体展开和缩小。我在文本框上方和下方还有一些其他控件。

锚定在 Visual Studio 2005 中正常工作（即我可以调整窗体大小并使控件按预期扩展和缩小），但是当我运行项目时，文本框的底部延伸到窗体的底部，在另一个之后通常会出现在其下方的控件。在尝试任何调整大小之前加载表单时会出现此问题。文本框的锚定在顶部、左侧和右侧是正确的；只有底部出现故障。

有没有人听说过这个，如果有，你能找到解决办法吗？

谢谢！

更新：

这是根据 Greg D 的要求的一些设计器代码（我只包括与文本框本身有关的东西，而不是其他控件）：

```
Friend WithEvents txtRecommendationText1 As System.Windows.Forms.TextBox

<System.Diagnostics.DebuggerStepThrough()> _
Private Sub InitializeComponent()
    Me.txtRecommendationText1 = New System.Windows.Forms.TextBox

    ' ...snip...

    'txtRecommendationText1

    Me.txtRecommendationText1.Anchor = CType((((System.Windows.Forms.AnchorStyles.Top Or System.Windows.Forms.AnchorStyles.Bottom) _
                Or System.Windows.Forms.AnchorStyles.Left) _
                Or System.Windows.Forms.AnchorStyles.Right), System.Windows.Forms.AnchorStyles)
    Me.txtRecommendationText1.Location = New System.Drawing.Point(4, 127)
    Me.txtRecommendationText1.Multiline = True
    Me.txtRecommendationText1.Name = "txtRecommendationText1"
    Me.txtRecommendationText1.Size = New System.Drawing.Size(223, 149)
    Me.txtRecommendationText1.TabIndex = 10
End Sub 
```

另一个更新：

我最初发布的文本框不是从基类表单继承的（尽管它被添加到自定义用户控件类；我可能应该在前面提到过），但我最近在一组完全不相关的控件上遇到了同样的问题继承自基类形式。将这些问题归咎于 .NET 框架中可能存在的错误很容易，但在我看来，它真的开始如此了。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-25T20:34:31.683

你的`Form`本地化了吗？检查资源文件中的条目`Textbox.Size`，删除是并重置大小。
你是`Form`继承的并且是`Textbox`在baseform上的吗？尝试将`Textbox`' 访问修饰符设置为 Protected 或 Public。
您是否实现了自定义调整大小逻辑？关闭它，看看问题是否仍然存在。
你输入了`Textbox.MinimumSize`/`MaximumSize`吗？删除或更改值。

也可能是这些东西的结合...

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-25T20:16:56.570

当您在奇怪地初始化之后调整它的大小时，表单是否会恢复到预期的布局？另外，您是否为文本框设置了 Height 或 MinimumHeight/MaximumHeight 属性？

如果可能，设计器代码中的一些片段可能会很有用。:)

我过去遇到的一种可能性是 DPI。如果您在 DPI 设置与您正在开发的机器不同的机器上运行/测试您的代码，您可能会观察到一些奇怪的事情。

锚点功能本质上是在控件边缘和控件父控件边缘之间建立固定距离。您的文本框是否嵌入在另一个没有正确设置其锚点的控件（例如面板）中？右键单击设计器中的文本框应该会弹出一个菜单，让您也可以选择它下面存在的任何控件。

您的程序是否包含任何自定义调整大小逻辑，或者它是否在设计器生成的代码之外以编程方式修改文本框的大小？这也可能导致奇怪的行为。我已经在我的组织中承担了许多软件的维护工作，其中原始开发人员花费了大量时间来实现（错误的）调整大小逻辑，我不得不删除这些逻辑，以便我可以让设计人员生成的代码来完成为我工作。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-27T20:07:54.270

我最初发布的文本框不是从基类表单继承的（尽管它被添加到自定义用户控件类；我可能应该在前面提到过），但我最近在一组完全不相关的控件上遇到了同样的问题继承自基类形式。将这些问题归咎于 .NET 框架中可能存在的错误很容易，但在我看来，它真的开始如此了。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-22T23:33:31.533

这很可能是因为 InitializeComponent() 中设置了“AutoScaleMode”属性。尝试将其设置为“无”，看看是否可以解决它。我已经遇到过几次这些问题了。

# benchmarking - BLAS 库基准

> ID：318640
> 
> 赞同：4
> 
> 时间：2008-11-25T19:50:27.980
> 
> 标签：benchmarking, multicore, blas

是否有比较不同 BLAS（基本线性代数子程序）库的基准？我对单核和多核系统的稀疏矩阵乘法特别感兴趣？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-31T16:05:35.030

BLAS performance is very much system dependent, so you'll best do the benchmarks yourself on the very machine you want to use. Since there are only a few BLAS implementations, that is less work than it sounds (normally the [hardware vendors implementation](http://www.netlib.org/blas/faq.html#5), [ATLAS](http://math-atlas.sourceforge.net/) and the [GOTO BLAS](http://www.tacc.utexas.edu/resources/software/software_downloads.php)).

But note that BLAS only covers dense matrices, so for sparse matrix multiplication you'll need Sparse-BLAS or some other code. Here performance will differ not only depending on hardware but also on the sparse format you want to use and even on the type of matrix you are working with (things like sparsity pattern, bandwidth etc. matter). So even more than in the dense case, if you need maximum performance you will need to do your own benchmarks.

# c++ - 多个 QMainWindow 实例？

> ID：318641
> 
> 赞同：30
> 
> 时间：2008-11-25T19:50:37.967
> 
> 标签：c++, qt, qmainwindow

这`QMainWindow`是 Qt 应用程序中的主窗口。所以通常你只有一个，但`QMainWindow`你的应用程序中是否有可能有多个实例？

我正在将基于 Qt 的 GUI 应用程序*B*集成到另一个基于 Qt 的 GUI 应用程序*A*中。这两个应用程序都有一个`QMainWindow`，我正在考虑作为第一步来创建一个新的，在标签`QMainWindow`上都有旧的。`QMainWindows`这样一来，我就可以专注于将 GUI *B*的后端连接到*A*的后端，而无需更改用户界面本身的任何内容。这是一种可行的方法，还是您有其他建议？

* * *

## 回答 #1

> 赞同：40
> 
> 时间：2008-11-26T02:46:37.627

您可以拥有任意数量的`QMainWindow`实例。A`QMainWindow`只是一个`QWidget`提供菜单栏、工具栏、状态栏和停靠框架的工具。但基本上它只是一个`QWidget`，所以你可以拥有尽可能多的。

通常，出于 GUI 设计的原因，您只有一个`QMainWindow`，因为拥有多个主窗口可能会令人困惑。但是，当实现`QtAssistant`可以打开自己的新实例的应用程序时，一个进程具有多个主窗口。

你的建议应该有效。`QMainWindow`除非您还想向该窗口添加工具栏，否则带有选项卡的窗口不需要是 a 。

# c# - 绑定列表和 LINQ？

> ID：318644
> 
> 赞同：14
> 
> 时间：2008-11-25T19:52:52.813
> 
> 标签：c#, .net, linq, .net-3.5, c#-3.0

我是 Linq 的新手，我想对 BindingList 中的一些数据进行排序。完成 Linq 查询后，我需要使用 BindingList 集合来绑定我的数据。

```
 var orderedList = //Here is linq query
 return (BindingList<MyObject>)orderedList; 
```

这编译但执行失败，有什么诀窍？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-11-25T19:54:41.110

```
new BindingList<MyObject>(orderedList.ToList()) 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2014-02-28T20:23:32.037

您不能总是将任何集合类型转换为任何其他集合。关于编译器何时检查转换，请查看这篇关于[编译时与运行时转换的帖子](https://stackoverflow.com/a/4499558/1366033)

但是，您可以`BindingList`通过自己做一些管道轻松地从可枚举中生成 a。只需将以下扩展方法添加到任何 Enumerable 类型即可将集合转换为 BindingList。

**C#**：

```
static class ExtensionMethods
{
    public static BindingList<T> ToBindingList<T>(this IEnumerable<T> range)
    {
        return new BindingList<T>(range.ToList());
    }
}

//use like this:
var newBindingList = (from i in new[]{1,2,3,4} select i).ToBindingList(); 
```

**VB**：

```
Module ExtensionMethods
    <Extension()> _
    Public Function ToBindingList(Of T)(ByVal range As IEnumerable(Of T)) As BindingList(Of T)
        Return New BindingList(Of T)(range.ToList())
    End Function
End Module

'use like this:
Dim newBindingList = (From i In {1, 2, 3, 4}).ToBindingList() 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-11T21:43:59.413

仅当您的 linq 查询的选择投影显式键入为 MyObject 而不是创建匿名对象实例的 select new 时，上述方法才有效。在这种情况下， typeof(orderedList.ToList()) 的结果类似于： System.Collections.Generic.List<<>f__AnonymousType1>

即：这应该工作：

```
var result = (from x in MyObjects
              where (wherePredicate( x ))
              select new MyObject {
                  Prop1 = x.Prop1,
                  Prop2 = x.Prop2
              }).ToList();
return new BindingList<MyObject>( result ); 
```

这不会：

```
var result = from x in db.MyObjects
             where(Predicate(x))
             select new {
                Prop1 = x.Prop1
                Prop2 = x.Prop2
            };
return new BindingList<MyObject>(result.ToList())
//creates the error: CS0030 "Cannot convert type 'AnonymousType#1' to 'MyObject' 
```

在第二种情况下，它们的 typeof(result) 是： System.Collections.Generic.List<<>f__AnonymousType2> （类型参数与您选择投影中设置的属性匹配）

参考： http: [//blogs.msdn.com/swiss_dpe_team/archive/2008/01/25/using-your-own-defined-type-in​​-a-linq-query-expression.aspx](http://blogs.msdn.com/swiss_dpe_team/archive/2008/01/25/using-your-own-defined-type-in-a-linq-query-expression.aspx)

# jquery - 运行功能/效果一次然后停止

> ID：318645
> 
> 赞同：0
> 
> 时间：2008-11-25T19:53:09.537
> 
> 标签：jquery, effect

我试图找到一种使用不带cookies的jquery来显示一个块并单击它`hide()`而不再次显示的方法。

`div`这是我页面上的临时建设中。

有什么方法可以点击它关闭，这很容易使用jQuery，然后不会再次加载？因为它不会在其他页面上？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-25T19:55:39.000

加载`div`一个布尔变量的条件检查。所以在伪代码中：

```
var HasBeenViewed = false;

If (!HasBeenViewed)
{
  show div;
  HasBeenViewed = true; 
} 
```

**编辑：**它不能在其他页面上工作，你需要在客户端或服务器上的某个地方使用 cookie 或某种状态持久性。

# linux - 从进程内部转储 Linux 核心文件的好方法是什么？

> ID：318647
> 
> 赞同：13
> 
> 时间：2008-11-25T19:54:20.487
> 
> 标签：linux, gdb

我们有一个服务器（用 C 和 C++ 编写），它当前捕获一个 SEGV 并将一些内部信息转储到一个文件中。我想在我们捕获 SEGV 时生成一个核心文件并将其写入磁盘，因此我们的支持代表和客户不必对 ulimit 大惊小怪，然后等待崩溃再次发生以获得核心文件。我们过去曾使用过 abort 函数，但它受制于 ulimit 规则并且没有帮助。

我们有一些读取 /proc/pid/map 并手动生成核心文件的遗留代码，但它已经过时，并且看起来不太便携（例如，我猜它在我们的 64 位中不起作用构建）。在 Linux 进程中生成和转储核心文件的最佳方法是什么？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-12-03T18:47:22.850

谷歌有一个库，用于从名为[google-coredumper](http://code.google.com/p/google-coredumper/)的运行进程内部生成核心转储。这应该忽略 ulimit 和其他机制。

生成核心文件的调用文档在[此处](http://code.google.com/p/google-coredumper/wiki/WriteCoreDump)。根据文档，在信号处理程序中生成核心文件似乎是可行的，但不能保证始终有效。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-29T17:37:26.550

我看到[pmbrett 的帖子](https://stackoverflow.com/questions/318647/what-is-a-good-way-to-dump-a-linux-core-file-from-inside-a-process#327019)并认为“嘿，这很酷”，但在我的系统（Gentoo）上的任何地方都找不到该实用程序。

所以我做了一些刺激，发现 GDB 有这个选项。

```
gdb --pid=4049 --batch -ex gcore
```

似乎对我来说工作得很好。

但是它不是很有用，因为它捕获了当时正在使用的最低功能，但除此之外它仍然做得很好（没有内存限制，用它转储了 350M 的 firefox 进程快照）

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-11-29T01:38:46.063

尝试使用 Linux 命令 gcore

用法：gcore [-o 文件名] pid

您需要使用 system（或 exec）和 getpid() 来构建正确的命令行以从您的进程中调用它

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-11-25T21:05:33.353

一些可能的解决方案^W处理这种情况的方法：

1.  修复ulimit！！！
2.  接受你没有得到核心文件并在 gdb 中运行，脚本在 SIGSEGV 上执行“线程全部应用 bt”
3.  接受您没有获得核心文件并从应用程序中获取堆栈跟踪的事实。The [Stack Backtracing Inside Your Program](http://www.linuxjournal.com/article/6391)文章已经很老了，但现在应该也可以了。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-12-30T11:51:23.967

您还可以使用 setrlimit(2) 从程序中更改 ulimit()。与 ulimit shell 命令一样，这可以降低限制，或者在硬限制允许的范围内尽可能提高限制。在启动时 setrlimit() 允许核心转储，你很好。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2011-09-07T19:33:49.167

例如，我假设您有一个信号处理程序可以捕获 SEGV，并执行诸如打印消息和调用 _exit() 之类的操作。（否则，您首先会有一个核心文件！）您可以执行以下操作。

```
void my_handler(int sig)
{
   ...
   if (wantCore_ && !fork()) {
      setrlimit(...);  // ulimit -Sc unlimited
      sigset(sig, SIG_DFL);  // reset default handler
      raise(sig);  // doesn't return, generates a core file
   }
   _exit(1);
} 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2010-11-11T17:10:28.827

使用 backtrace 和 backtrace_symbols glibc 调用来获取跟踪，请记住 backtrace_symbols 在内部使用 malloc，如果堆损坏，它可能会失败。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-27T04:16:43.830

系统（“杀死 -6”）

如果您仍在寻找某些东西，我会尝试一下

# asp.net - 为什么这会导致出现 Windows 身份验证而不是异常？

> ID：318649
> 
> 赞同：1
> 
> 时间：2008-11-25T19:54:32.093
> 
> 标签：asp.net, vb.net

好的，所以在花了一天的大部分时间在一段代码中调试一个愚蠢的打字错误之后，我很好奇为什么会发生特定操作而不是异常。

首先是问题代码。

```
Public Sub InstantiateIn(ByVal container As Control) Implements ITemplate.InstantiateIn
    Dim hl As New HyperLink
    AddHandler hl.DataBinding, AddressOf Me.BindData
    container.Controls.Add(container)
End Sub 
```

明显的问题是我们正在尝试将容器添加到自身，我本以为这会导致异常。但是，它反而导致页面提示用户输入他们的登录凭据（浏览器中的 Windows 身份验证）。

有谁知道为什么会这样，为什么没有发生异常或其他事情？

**编辑**

问题的原因是由于这个错误，页面被渲染为无用，并提示 Windows 登录，并且没有给出堆栈溢出异常或任何其他异常。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-25T20:29:54.393

您希望异常发生在哪里？在此代码中，没有理由生成异常。然而，将控件嵌套在控件中可能是不合逻辑的，但它仍然有效。它不会画得很好，除非绘画/绘图层特别意识到嵌套，否则可能会导致堆栈溢出/无限循环。但这不会在这里发生，而是在布局/绘画期间发生。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-25T20:30:22.863

控件是可以任意嵌套的东西；任何控件都可以包含其他控件的集合（我相信这样做的原因很明显）。话虽这么说，将给定对象的引用添加到自身内部的此类对象集合中并没有什么“错误”。虽然多余，但并不例外。

# java - 空对象设计模式问题

> ID：318657
> 
> 赞同：5
> 
> 时间：2008-11-25T19:56:45.207
> 
> 标签：java, design-patterns, null-object-pattern

我最近看了这个关于 Null Object 设计模式的[youtube 教程。](http://www.youtube.com/watch?v=hp1Y9bhail8)尽管其中有一些错误：例如不做任何事情的 NullCar 创建了一个无限循环，但这个概念得到了很好的解释。我的问题是，当可以为 null 的对象具有 getter 并在您的代码中使用时，您会怎么做？你怎么知道默认返回哪个值？或者我应该在所有对象中实现这个模式？如果我需要返回字符串或原语怎么办？我是从 Java 的角度说的。

**编辑**：我不会为默认值测试交易空对象测试吗？如果没有，为什么不呢？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-25T20:14:53.737

Null 对象的目标是避免在代码中出现 Null 引用。Null Object getter 返回的值取决于您的域。零或空字符串通常是合适的。

如果我们将 Null Object 模式转换到现实生活中，您所问的问题类似于问“*没人有多大年纪？* ”。

也许你的设计可以改进，因为你似乎没有遵循[告诉，不要问](http://www.pragprog.com/articles/tell-dont-ask)的原则。

编辑：当一个对象将行为委托给另一个对象（例如在策略或状态设计模式中）时，通常使用[空对象设计模式；](http://cs.oberlin.edu/~jwalker/nullObjPattern/)正如 Tom Hawtin - tackline 评论的那样，对返回值的对象使用[特殊情况对象](http://martinfowler.com/eaaCatalog/specialCase.html) 。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-25T20:10:25.773

据我了解，这个想法是空对象的值尽可能接近“无”。不幸的是，这意味着您必须自己定义它。举个例子，当我不能传递一个空字符串时，我个人使用“”，我的空对象编号是-1（主要是因为默认情况下大多数数据库序列从 1 开始，我们将这些用于项目 id:sa lot so -1是死赠品，它是一个空对象），列表/地图/集合它是`Collections.EMPTY_SET`，`EMPTY_MAP`或者`EMPTY_LIST`等等等等。如果我有自定义类，我必须从中创建一个空对象，我会从中删除所有实际数据，看看它会把我带到哪里，然后应用我刚才提到的内容，直到它“空”。

所以你真的不“知道”默认返回哪个值，你只需要自己决定。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-25T20:21:18.107

> 当可以为 null 的对象具有 getter 并在您的代码中使用时，您会怎么做？你怎么知道默认返回哪个值？

你怎么知道要实现哪些类？这是一个设计问题，它取决于应用程序。

一般而言，NullObject 模式的目的是在条件是与编程语言的空值进行比较的特殊情况下支持[用多态性替换条件重构。](http://www.refactoring.com/catalog/replaceConditionalWithPolymorphism.html)

视频中示例的正确实现需要将`driveCar`方法委托给`Car`类。`SlowCar`和类将`FastCar`执行循环，大概是通过基类中的共享实现，并且`NullCar`会立即返回。

在 Java 上下文中，该`NullCar.speed`属性可能是未装箱的 int。因此，将其设置`null`为不是一种选择。我可能会将属性隐藏在访问器后面，并`NullCar.getSpeed`引发异常。任何需要测试以避免此异常的客户端代码都将移入汽车类。

委托直接依赖于可用速度值的所有操作是[philippe](https://stackoverflow.com/questions/318657/null-object-design-pattern-question#318691)提到的面向对象设计的[告诉不问原则的应用](http://www.pragprog.com/articles/tell-dont-ask)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2014-11-28T06:10:47.053

Null 设计模式在代码中的集成点应该是什么？我认为 DAO 对象是这种设计模式的第一级客户端，因为它们在数据库中查找实体并简单地返回它。

这些对象的可空性检查会污染实际访问和使用它们的服务层或命令层中的代码。

请给出意见。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2015-12-16T15:18:37.413

它应该为您获得的类返回空对象。例如，如果您有一个`A`带有返回类对象的 getter 的类`B`，则相应`NullA`的 getter 应该返回`NullB`。

# database - 对于电子商务网站，什么是 ORM 的好选择？

> ID：318658
> 
> 赞同：2
> 
> 时间：2008-11-25T19:57:18.513
> 
> 标签：database, .net-3.5, orm, c#-3.0

我正在使用 C# 3.0 / .NET 3.5 并计划建立一个电子商务网站。

我见过 NHibernate、LLBLGEN、Genome、Linq to SQL、Entity Framework、SubSonic 等。

我不想手动编写所有代码。如果有一些特定的瓶颈，我将设法优化数据库/代码。

哪个 ORM 最好？那天有太多可用的东西，我什至不知道从哪里开始。

我应该使用哪些功能？

欢迎提供链接、截屏视频和文档。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-25T20:15:47.790

我一直在使用 nHibernate，这是一个非常好的免费解决方案。一个缺点是缺乏文档，这会导致加速时间稍长。但是，一旦您掌握了基础知识，它就会真正加快开发速度。

我喜欢 Fluent nHibernate，因为它可以在没有 xml 文件的情况下进行配置。我建议的一件事是从您的应用程序中抽象出您的数据访问。这样，如果您选择错误，您不必担心重新编码 App 层。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-25T20:03:04.057

我只能真正为 LINQ-SQL 说话，并且可以说它是：

*   便于使用
*   快速启动并运行
*   适用于简单的模式和对象模型

但如果出现以下情况，它就会开始下降：

*   您正在使用断开连接（分层）架构，因为它的数据上下文需要相同的对象实例来执行跟踪和并发（尽管有一些方法可以解决这个问题）。
*   你有一个复杂的对象模型/数据库
*   另外它还有一些其他的琐事和奇怪的行为

我希望自己接下来尝试 EF，MS 似乎正在悄悄放弃 LINQ-SQL 转而支持 EF，这并不是 LINQ-SQL 的响亮推荐 :)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-25T20:16:38.757

这取决于数据模型的架构。我可以谈论 SubSonic 的有效性，因为我正在启动它支持的网络应用程序。

我在使用 SubSonic 时遇到了 JOIN 和 DISTINCT 问题。这两次，我所要做的就是修补源代码并重建 DLL。现在，我一点也不反对这样的事情，但你可能会。

除了这两个问题，SubSonic 使用起来很有趣。选择非常容易且流畅。它与 SQL 的映射非常接近，与 LINQ 的映射方式非常相似。此外，SubSonic 带有脚手架功能，应该能够为您预先构建某些页面。我不确定它有多有效，因为我喜欢自己做这些事情。

还有一件事，与 * 相对的特定行的选择很慢，但仅在调试模式下。一旦你编译发布，它实际上更快。

那是我的两分钱。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-14T21:45:45.560

我开始使用 Linq to SQL，因为整个 linq 集成非常棒，但是如果你想做 Model First 而不是 Schema First 并且你想拥有一个丰富的域模型，那么 nHibernate\Fluent nHibernate 真的是要走的路。我们切换到这个并且比 l2s 更简单，更好的支持。然而，为了将您的模式直接拖到 dbml 代码生成器中，linq to sql 非常棒。我也听说过关于 Mindscape Lightspeed 的非常好的东西，但没有使用它。

# oracle - 如何将系统包安装到oracle中？

> ID：318665
> 
> 赞同：4
> 
> 时间：2008-11-25T19:59:40.147
> 
> 标签：oracle, sysadmin

我正在创建我们的测试 Oracle DB（两者都是 10g）的副本并遇到问题，因为我们的测试数据库安装了 UTL_SMTP 和 UTL_FILE 系统包，而我的本地 OracleXE 版本没有。我们的系统管理员今天已经回家了，早点给出他的状态，我真的不想打扰他。

如何在我的本地 OracleXE 实例上获取这些包？我需要知道在哪里下载它们以及如何安装它们。希望授予权限我可以弄清楚自己;）

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-25T20:09:39.283

文件是：

$ORACLE_HOME/rdbms/admin/utlsmtp.sql $ORACLE_HOME/rdbms/admin/utlfile.sql

在 SQL*Plus 中以 SYS 身份运行

# objective-c - NSString 中的 stringWithString 和 initWithString 中的对象所有权

> ID：318666
> 
> 赞同：9
> 
> 时间：2008-11-25T20:00:21.440
> 
> 标签：objective-c, cocoa

我知道任何 init... 方法都会初始化一个新对象，并且 NSString stringWithString 会将参数字符串的副本作为新对象。我也明白，作为对象的所有者，我可以控制我分配的任何对象的释放/释放。我不明白什么时候我会使用 stringWithString 方法，因为以这种方式分配的任何局部变量都会让它的内存由 NSString 而不是本地类“拥有”。

Kochan 的“Objective C 编程”一书（第 1 版）使用以下代码（参见第 342-344 页）来解释 initWithString 比 stringWithString 更可取，因为 AddressCard 类将拥有名称变量内容。此外，使用 stringWithString 方法重复调用 setName 版本时，我没有收到任何错误。蒂亚！！

```
//header file has appropriate declarations but not included here:
#import "AddressCard.h"

@implementation AddressCard;

-(NSString *) name
{
   return name;
}

//Recommended code:
-(void) setName: (NSString *) theName
{
   [name release]
   name = [[NSString alloc] initWthString: theName];
}

//Incorrect code according to Kochan:
-(void) setName: (NSString *) theName
{
   [name release]
   name = [NSString stringWthString: theName];
}

//rest of class implementation code snipped
@end 
```

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2008-11-25T20:20:19.200

> 我不明白什么时候我会使用 stringWithString 方法，因为以这种方式分配的任何局部变量都会让它的内存由 NSString 而不是本地类“拥有”。

什么？不。

规则很简单：

*   `alloc`由、`copy`、`copyWithZone`或返回的任何对象`new`的保留计数为 1。
*   `retain`增加接收对象的保留计数。
*   `release`减少接收对象的保留计数。
*   `autorelease``release`告诉当前自动释放池“稍后”向接收对象发送消息。
*   任何名称中没有“new”或“copy”的工厂方法（例如，`stringWithString:`）都会返回一个它已代表您自动释放的对象。

或者，稍微消化一下：

*   任何名称包含`copy`、`alloc`、`retain`或`new`返回您拥有的对象的方法。
*   任何不这样做的方法都会返回一个您不拥有的对象。
*   要拥有一个对象，请保留它。

您显示的不正确实现`setName:`是不正确的，因为当您打算拥有该对象时，它将自动释放的对象存储在实例变量中。您应该保留它，或者在这种情况下复制它。一种方法是简单地使用`alloc`and `initWithString:`，如您展示的正确示例中所示；另一种方式是`copy`。

[Cocoa 的内存管理编程指南解释了一切。](http://developer.apple.com/library/mac/documentation/Cocoa/Conceptual/MemoryMgmt/)每个 Cocoa 或 Cocoa Touch 程序员都应该不时阅读或重新阅读它。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-11-25T20:45:05.407

实际上，两个二传手都错了。由于一般内存管理原因（在其他地方已详细说明），“不正确”的错误是错误的。“推荐”的错误有两个原因：

1.  if (theName == name)，那么您可能会在第一行释放对象，然后尝试在第二行将释放的对象用作 -initWithString: 的参数，从而导致未定义的行为。
2.  -initWithString: 不处理优雅地传递 nil。

“正确”（恕我直言）方法是：

```
-(void) setName: (NSString *) theName
{
   if (theName == name) return; // if they're equal, no need to do anything further
   [name release];
   name = [theName copy];  // sets name to nil if theName is nil
} 
```

对于大多数对象，您实际上希望在第三行使用 -retain 而不是 -copy，但对于字符串，复制几乎总是更好。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-25T20:05:27.530

initWithString 和 stringWithString 的区别在于 stringWithString 返回一个自动释放的指针。这意味着您不需要专门释放它，因为下次自动释放池清理任何自动释放的指针时会处理这个问题。

另一方面，initWithString 返回一个保留计数为 1 的指针——您确实需要对该指针调用 release，否则会导致内存泄漏。

出于某些原因，请参阅[https://stackoverflow.com/questions/193288/what-is-the-cost-of-using-autorelease-in-cocoa](https://stackoverflow.com/questions/193288/what-is-the-cost-of-using-autorelease-in-cocoa#193377)，了解为什么应该使用自动发布与发布。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-25T20:19:07.423

在上面的错误代码中，在调用 setName 后下一次引用 name 时，您将收到异常错误，因为该对象将已被释放。您可以使用“正确”代码，或者将您的 stringWithString 调用包装在显式保留调用中：

```
name = [[NSString stringWithString: theName] retain]; 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-25T22:15:24.227

> 我不明白什么时候我会使用 stringWithString 方法，因为以这种方式分配的任何局部变量都会让它的内存由 NSString 而不是本地类“拥有”。

用创建的字符串`stringWithString:`不属于`NSString`，它属于`NSAutoreleasePool`（尽管多个地方可以`retain`一个对象，使所有权共享）。

使用`stringWithString:`时，在下一次处理自动释放池时（通常在应用程序的下一个事件循环期间），字符串将变为无效，因为 NSAutoreleasePool 将`release`其指针。如果您在那之前没有`retain`编辑字符串，那么您拥有的任何指向它的指针（`name`在您的类的情况下）都将无效（变量`name`仍然存在，但它会指向垃圾）。

Autorelease 很好，如果您不打算保留任何指向 的指针，但由于您确实打算保留指针，因此`NSString`您需要. 自动为您提供保留计数 1。`retain``NSString``initWithString:`

# pop3 - Thunderbird 将通过 POP 下载的最后一条消息的 UID 存储在哪里？

> ID：318673
> 
> 赞同：8
> 
> 时间：2008-11-25T20:04:09.827
> 
> 标签：pop3, thunderbird, uidl

我使用 Thunderbird 通过 POP3 接收电子邮件。我已将 Thunderbird 配置为在服务器上留下电子邮件。假设有一天我使用 POP3 检索 ( `RETR`) 10 封电子邮件，然后我注销了一晚。一夜之间又有10条消息发送到我的邮箱。第二天早上我启动 Thunderbird 时，该`STAT`命令应该显示 20 条消息。然而，Thunderbird 不应该下载前 10 条消息；它应该从消息 11（或消息 11 的唯一标识符或 UID）开始。Thunderbird 将发送一个 POP3`UIDL`命令，然后将 UID 与 Thunderbird 昨天检索到的最后一条消息的 UID 进行比较。它会发现最后一个 UID 匹配消息 10 的 UIDL 列表，然后 Thunderbird 将`RETR 11`, `RETR 12`, 等等。

就我而言，POP3`STAT`命令显示我在 POP 服务器上有 5379 条消息。我已经收到了大约 5000 个。出于某种原因，Thunderbird 想要下载所有 5379 条消息，而不是从 5001 开始。我正在尝试对此进行调试，并正在寻找 Thunderbird 认为是检索到的最后一条消息的 UID。

有谁知道 Thunderbird（在 Windows 上）将最后一个 UID 存储在哪里，它将用来与 UIDL（列表）进行比较？

有没有办法手动设置它，以便我可以强制 Thunderbird 开始检索接近 5001 的位置？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-16T22:32:10.930

Thunderbird 有一个名为[popstate.dat](http://kb.mozillazine.org/Popstate.dat)的文件，其中包含 UID、时间戳（纪元）和标志。该标志指示 Thunderbird 将对相关消息执行的操作。

显然，Thunderbird 实际上并没有像我上面描述的那样工作。我认为 Thunderbird 做了以下事情。它发送一个 POP3`UIDL`命令来获取存储在 POP 服务器上的 UID 列表。然后，它将此列表与存储在 中的 UID 进行比较`popstate.dat`。任何尚未存在的 UID 都是`popstate.dat`要检索的新消息。UIDL 命令先前返回了消息号和关联的 UID。然后，Thunderbird 必须`RETR`使用与尚未检索到的 UID 关联的消息编号执行 POP3 命令。Thunderbird 还必须查看其中的标志`popstate.dat`并对相关消息采取任何措施。例如，该标志`d`告诉 Thunderbird 删除关联的消息。这`f`flag 意味着 Thunderbird 只截断了消息的一部分，应该检索完整的消息。

在某些时候，Thunderbird 会`popstate.dat`使用新消息更新 。我认为这发生在`popstate.dat`所有操作完成后的批量更新中。也就是说，如果有 10 条新消息要检索，`popstate.dat`则在检索完所有 10 条消息后才会更新。

我认为我的问题出在服务器上。显然，我们的基础架构升级到了新版本的 POP 服务器，并在新版本上分配了新的 UID。我`popstate.dat`有所有旧的 UID。新的 POP 服务器的 UIDL 发送了 Thunderbird 未列出的 5000 多个 UID 的列表`popstate.dat`. 因此，Thunderbird 开始下载所有 5000 多条消息。如果新的 POP 服务器保留了旧的 UID，那么 Thunderbird 会看到我已经检索了 5000 多条消息中的大部分，并且会下载我没有的消息。我认为我组织中的大多数人都使用 Outlook 而不是使用 POP3，但是对 POP 服务器进行的版本更新并没有给这些用户带来问题。似乎需要额外注意以确保新服务器具有与旧服务器相同的 UID。活到老，学到老！

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-03T03:56:37.233

有哪个版本的服务器软件？

[http://courier.sourcearchive.com/documentation/0.60.0-2/pop3dserver_8c-source.html](http://courier.sourcearchive.com/documentation/0.60.0-2/pop3dserver_8c-source.html)

> 00718 ** 消息的 UIDL 实际上只是它的文件名，直到第一个 MDIRSEP 字符

可能您只需要将 popstate.dat 中 UIDL 的第一部分替换为新的吗？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-26T06:56:31.717

Thunderbird 有一个扩展来查找重复项并删除它们。例如，基于 message-id（通常由邮件的原始发件人生成，因此不会随着您的基础架构更新而改变）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2021-04-29T12:20:58.223

也许不是 OP 正在寻找的答案，但它可能对他有帮助。我遇到过类似的问题，为了解决这些问题，我创建了一个小的 php 脚本来重建 popstate 文件。你可以在这里找到它：

[https://github.com/Magentron/rebuild_thunderbird_popstate](https://github.com/Magentron/rebuild_thunderbird_popstate)

> 用于重建 Thunderbird 的 popstate.dat 文件的简单 PHP 脚本。当 Thunderbird 崩溃并开始检索保存在邮件服务器上的所有邮件后，主要有用。将生成的默认文件是 popstate.dat.GENERATED。如果你把这个改成对应 Thunderbird 目录下的 popstate.dat 文件，请确保 Thunderbird 已经关闭，否则你可能会遇到更多问题。
> 
> 请注意，没有尝试使它成为我写过的最好的代码......
> 
> 注意：有 Windows 支持，但从未测试过！

## 用法

```
usage: rebuild_popstate.php [-d] [-i n] [-s] [-v] [-f file] server [ port ]
    -c      CRLF flag, use when talking to Windows servers
    -d      debug flag
    -f      output filename (if popstate.dat, Thunderbird needs to be closed!)
    -i      ignore the last n messages (for if you don't have them yet)
    -s      use for secure POP3 (SSL/TLS)
    -v      verbose flag 
```

# apache-flex - 如何创建具有动态高度的 Flex 应用程序？

> ID：318675
> 
> 赞同：2
> 
> 时间：2008-11-25T20:06:19.650
> 
> 标签：apache-flex, actionscript-3

有没有办法让 flex 应用程序在嵌入 HTML 包装器时具有动态高度？

我希望 Flex 应用程序的高度增长不会导致垂直滚动条。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-23T14:58:44.260

最好的方法应该是覆盖应用程序的测量方法，例如：

```
private var _lastMeasuredHeight:int;

override protected function measure():void
{
    super.measure();
    if (measuredHeight != _lastMeasuredHeight)
    {
        _lastMeasuredHeight = measuredHeight;
        if (ExternalInterface.available)
        {
            ExternalInterface.call("setFlashHeight", measuredHeight);
        }
    }
} 
```

此函数假定您有一个名为 setFlashHeight 的 JavaScript 函数，它可以接受一个高度（或任何您命名的）参数。一个例子是：

```
function setFlashHeight(newHeight){
    //assuming flashDiv is the name of the div contains flex app.
    var flashContentHolderDiv = document.getElementById('flashDiv'); 
    flashContentHolderDiv.style.height = newHeight;
} 
```

我使用 swfobject 嵌入我的 flex 应用程序。所以 flash 对象位于一个 div 中。如果你的不是；可以很容易地更改 js 函数来设置 flash 对象的高度。当您实施此解决方案时，您会注意到滚动条无法正常工作，因为 flash 会消耗该事件。但那是另一个话题...

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-26T17:20:09.390

这个有可能。例如，请参阅 fi 的新[Kontain](http://kontain.com)。您可以通过创建新博客文章并在输入字段中添加行来直接查看它的实际效果。随着输入字段的大小增加，页面变得更高。

您必须通过 ExternalInterface 在 Flash 和 Javascript 之间进行协调。当您的 Flex 应用程序需要更改大小时，找到新的大小（可能通过挖掘 Flex 的布局引擎）并通过 ExternalInterface 将其提交给 Javascript 函数。然后，javascript 可以在容器上设置一个新的 height 属性。您可能还想在标签上设置verticalScrollPolicy="off"，这样Flex 在布局引擎运行时就不会显示滚动条。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-26T12:54:04.547

我不确定我是否完全理解这个问题，您是否试图让应用程序的尺寸大于浏览器的视口？如果是这样，那么正如@hasseg 评论和@RickDT 提到的那样，您可以将应用程序的horizo​​ntalScrollPolicy 和/或verticalScrollPolicy 属性设置为“关闭”吗？

如果您只是想确保您的应用程序随着浏览器形状和大小的变化而扩展，那么请确保您在最外层的应用程序标记中设置以下（或适合的值）。

```
percentWidth="100"
percentHeight="100" 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-25T20:11:04.163

不幸的是，不，我认为你能做到这一点的唯一方法是首先摆脱 html 包装器。HTH。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-11-16T20:23:05.420

不需要所有这些，只需将应用程序从 spark 更改为 mx。这将自动显示它，因为我认为 spark 根本不支持它（我认为这是 adobe 的愚蠢错误）

像这样：

```
<mx:Application xmlns:fx="http://ns.adobe.com/mxml/2009" >

</mx:Application> 
```

代替：

```
<s:Application xmlns:fx="http://ns.adobe.com/mxml/2009" >

</s:Application> 
```

留下没有高度规范的应用程序标签“不要使用高度=“100%”

# openid - 在您的网站上使用 OpenID 有什么危险？

> ID：318677
> 
> 赞同：18
> 
> 时间：2008-11-25T20:08:04.390
> 
> 标签：openid

假设我创建了一个类似 StackOverFlow 的网站并决定使用 OpenID。有什么办法可以阻止我或其他任何人对 ID 进行网络钓鱼？也就是说，你怎么能真正知道任何网站都在使用 OpenID 而不是假装呢？你如何保护自己免受这种伤害？

对此进行扩展，假设一个站点确实泄露了您的 openID 凭据，他们不能在使用 openID（全局密码破解）的每个其他站点上使用它吗？那么，您的 openID 的安全性难道不会与最弱的网站/提供商一样强大吗？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-25T20:13:26.483

你输入的只是ID，没有密码。ID 是公开的，因此“网络钓鱼”不是安全漏洞。一些提供商甚至为所有用户使用相同的 ID，例如 google 帐户的 ID 始终为`https://www.google.com/accounts/o8/id`. 有关更详细的说明，请参阅[Wikipedia 文章。](http://en.wikipedia.org/wiki/OpenID#Logging_in)

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-11-25T20:53:00.663

对于对 OpenID 的工作原理知之甚少的用户，您可以创建一些看起来像他们的 OpenID 所针对的网站的恶搞页面（例如，任何处理 OpenID 的免费电子邮件提供商）。如果他们在填写用户名和密码之前忘记检查他们所在的域，那么 evildomain 现在就有了他们的 OpenID 用户名和密码。

在服务器端，您依赖外部站点进行身份验证。因此，如果提供者 XYZ 的 OpenID 身份验证表单中存在漏洞，允许密码“swordfish”在任何帐户上工作，那么任何人都可以在任何接受 OpenID 的地方冒充来自该提供者的用户。

allesklar 在我输入此内容时提出了一个很好的观点，这很好地与我的最后一点相吻合：如果您将本地和远程用户混合在一起，您突然需要两个禁止列表而不是一个；由人们设置的“坏” OpenID 提供者的第二个禁止列表，以创建批量帐户……或自动授权给他们的任何帐户名称的那些。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-11-25T20:21:50.913

当有人在您的站点上输入一个开放 ID 时，您通过询问用户的 OpenID 所在的站点（并且仅是该站点）来验证该用户是否正常。例如，AOL 无法验证 Yahoo OpenID。

如果用户尚未在该站点进行身份验证，则身份验证失败，您需要重定向到该站点的登录页面。仍然需要进行真正的身份验证，但始终使用该用户的 OpenID 提供程序进行。作为用户，您受到保护，因为您应该只看到您熟悉的登录页面。恶意站点很难窃取 OpenID 凭据，因为用户从不直接向这些站点提供密码。

一旦用户通过其提供商的身份验证（或者如果他们从一开始就），提供商将向您的网站报告此情况。OpenID 的变化在于您的站点现在需要信任某些其他站点——它们会准确地报告其用户的状态。

有人可以设置一个“恶意的”开放 id 提供者，并尝试以这种方式掠夺新的 id，但这是在用户和提供者之间。由于这种身份验证完全与声誉有关，因此这样的提供商不会长期经营。如果不出意外，网站可以将这些提供商列入黑名单。恶意提供者将无法冒充在其他提供者处注册的开放 ID。

恶意提供者的另一种可能性是设置一个 OpenID 服务，该服务总是简单地确认传递给它的任何 id 以进行身份​​验证（或允许管理员为其用户设置后门）。但是，这只会影响在该提供商处注册的用户。同样，网站可以将这些提供商列入黑名单，并且由于他们依靠声誉，这种不会长期存在的想法仍然存在。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-25T20:49:53.540

OpenID 系统非常安全，并因此获得了广泛的支持。

我看到的主要缺点是，如果您的许多用户的 OpenID 提供商出现故障，这些用户将被锁定在您的站点之外。因此，您应该有一个用户名/密码备份计划，在验证后存储他们的电子邮件地址，以便在紧急情况/灾难时向他们发送密码。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-25T20:57:43.650

好笑的故事。我在 SO 上发现了一个漏洞，可以让我完全更改某人的个人资料。如果 Jeff 一直使用电子邮件+密码，我本可以拥有他的帐户，但是因为 SO 使用 OpenID，所以除了将他的 Gavitar 更改为有趣的东西之外别无他法。

有问题的错误已报告，已修复，我仍在等待我的黑客徽章。:P

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-25T21:00:04.113

这里让我害怕的关键不是在一个网站上拥有他的帐户，而是每个使用 openID 的网站！

# c# - 不使用sql时asp.net sql超时

> ID：318690
> 
> 赞同：0
> 
> 时间：2008-11-25T20:14:15.233
> 
> 标签：c#, asp.net, sql-server

我正在学习 asp.net 3.5，目前在 webparts 和 co。

我已经为 webparts 启动了一个新项目，没有使用数据库，但是当我去查看网站（开发服务器）时，我得到一个 sql 超时？

> 建立与 SQL Server 的连接时发生与网络相关或特定于实例的错误。

需要明确的是，项目中的任何地方都没有提到 sql。
我应该重新开始吗？

**编辑：**
可能相关

> （提供程序：共享内存提供程序，错误：40 - 无法打开与 SQL Server 的连接）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-25T20:17:12.013

Webparts 基础结构与数据库通信。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-25T20:22:35.967

好的已修复，需要启用/启动 sql server 2008 express

# python - 有谁知道哪里有序列化数据并在输出中保留其顺序的方法？

> ID：318700
> 
> 赞同：1
> 
> 时间：2008-11-25T20:17:52.730
> 
> 标签：python, serialization

我正在处理一组已转换为字典列表的数据

例如，我列表中的一项是

```
{'reportDate': u'R20070501', 'idnum': u'1078099', 'columnLabel': u'2005',
 'actionDate': u'C20070627', 'data': u'76,000', 'rowLabel': u'Sales of Bananas'} 
```

根据请求

我列表中的第二项可能是：

```
 {'reportDate': u'R20070501', 'idnum': u'1078099', 'columnLabel': u'2006',
 'actionDate': u'C20070627', 'data': u'86,000', 'rowLabel': u'Sales of Bananas'} 
```

第三项可以是：

```
 {'reportDate': u'R20070501', 'idnum': u'1078100', 'columnLabel': u'Full Year 2005',
 'actionDate': u'C20070627', 'data': u'116,000', 'rowLabel': u'Sales of Cherries'} 
```

第四个项目可以是：

```
 {'reportDate': u'R20070501', 'idnum': u'1078100', 'columnLabel': u'Full Year 2006',
 'actionDate': u'C20070627', 'data': u'76,000', 'rowLabel': u'Sales of Sales of Cherries'} 
```

我需要腌制这个的原因是因为我需要在合并结果并将它们放入数据库之前找出所有列标记的方式。第一项和第二项将是结果中的一行，第三项和第四项将是结果中的下一行（在有人决定统一的列标题标签应该是什么之后）

我测试了泡菜，并能够保存和检索我的数据。但是，我需要能够保留输出中的顺序。我的一个想法是添加另一个作为计数器的键，这样我就可以检索我的数据，然后按计数器排序。有没有更好的办法？

我不想把它放到数据库中，因为它不是永久性的。

我在下面标记了一个答案。这不是我得到的，所以我需要弄清楚问题是否在我的代码中的其他地方。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-25T21:05:56.037

那么泡菜有什么问题呢？如果您将数据构建为字典列表，那么一切都应该按照您的意愿工作（如果我理解您的问题）。

```
>>> import pickle
>>> d1 = {1:'one', 2:'two', 3:'three'}
>>> d2 = {1:'eleven', 2:'twelve', 3:'thirteen'}
>>> d3 = {1:'twenty-one', 2:'twenty-two', 3:'twenty-three'}
>>> data = [d1, d2, d3]
>>> out = open('data.pickle', 'wb')
>>> pickle.dump(data, out)
>>> out.close()
>>> input = open('data.pickle')    
>>> data2 = pickle.load(input)
>>> data == data2
True 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-25T20:23:43.500

Python 不保留字典中的顺序。
但是，*集合*模块中有[OrderedDict](http://docs.python.org/2/library/collections.html?highlight=collections#ordereddict-objects)类。

 *另一种选择是使用元组列表：

```
[('reportDate', u'R20080501'), ('idnum', u'1078099'), ...etc] 
```

`dict()`如果您以后需要将其转换为字典，则可以使用内置的。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-25T20:24:43.247

Python dict 是一个无序容器。如果您需要保留条目的顺序，则应考虑使用 2 元组列表。

另一种选择是保留一个额外的有序键列表。通过这种方式，您可以从字典提供的快速、键控访问中受益，同时仍然能够以有序的方式遍历其值：

```
data = {'reportDate': u'R20070501', 'idnum': u'1078099', 
        'columnLabel': u'2005', 'actionDate': u'C20070627', 
        'data': u'76,000', 'rowLabel': u'Sales of Bananas'}
dataOrder = ['reportDate', 'idnum', 'columnLabel', 
             'actionDate', 'data', 'rowLabel']

for key in dataOrder:
    print key, data[key] 
```

# testng - 从单个测试用例运行多个 TestNG 测试用例

> ID：318701
> 
> 赞同：1
> 
> 时间：2008-11-25T20:17:53.700
> 
> 标签：testng

我有以下情况：我用一个测试方法创建了一个类，在这个测试方法中，我创建了另一个包含多个测试方法的类。

该报告仅显示我的初始测试方法，它通过了它通过的 IFF，并且其他类中的所有测试都通过了。

我希望报告将包含我的第一个测试，以及其他类中所有其他测试的结果，通过或失败。

你知道这样做的方法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-01T16:30:02.707

这是不可能的。testNG 包装了您的测试类并对其进行检测，因此在您的测试中创建一个“新”测试类并不会用它创建所有额外的 testNG 内容，这就是为什么当测试方法在其中运行时，它们看起来像是在原始测试方法中运行的原因从中实例化类。

长话短说：你不能这样做，除非你在引擎盖下用 testNG 做了一些事情。在测试类中代理测试方法会更容易

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-01-12T07:48:23.940

去配置 testng 选项并选择套件选项并选择包含所有方法的 xml 文件。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2015-01-17T22:36:11.507

可以使用@Factory 实现。看看这个答案：[TestNG 中的 DataProvider 和 Factory 有什么区别？](https://stackoverflow.com/questions/5368516/whats-the-difference-between-dataprovider-and-factory-in-testng)

# java - Java 序列化 1.4 与 1.6

> ID：318707
> 
> 赞同：4
> 
> 时间：2008-11-25T20:21:08.480
> 
> 标签：java, serialization

我有一个必须编译为 1.4 的 java 程序，以及另一个可以是任何程序（所以，1.4 或 1.6）的程序，这两个程序需要来回传递序列化对象。如果我在两个程序都可以看到的地方定义了一个可序列化的类，java的序列化仍然可以工作，还是我只需要1.6-1.6或1.4-1.4？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-25T20:24:05.887

确保要序列化的类定义并分配一个值`static final long serialVersionUID`，你应该没问题。

也就是说，通常我不会这样做。我的偏好是仅在单个进程内或两个进程之间在同一台机器上使用普通序列化，并从同一个 jar 文件中获取序列化类。如果不是这样，序列化为 XML 是更好和更安全的选择。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-25T20:50:27.393

除了`serialVersionUID`包结构必须保持一致以进行序列化，因此如果您`myjar.mypackage.myclass`在 1.4 中拥有，则必须`myjar.mypackage.myclass`在 1.6 中拥有。

在包结构中的某个位置包含 Java 版本或您的发布版本并不少见。即使 serialVersionUID 在编译之间保持不变，包结构也会导致在运行时抛出不兼容的版本异常。

顺便说一句，如果你在你的类中实现，如果丢失`Serializable`，你应该得到一个编译器警告。`serialVersionUID`

在我看来（并且基于多年相当痛苦的经验）Java 原生序列化充满了问题，应该尽可能避免，尤其是在 XML/JSON 支持出色的情况下。如果您确实必须进行本机序列化，那么我建议您将类隐藏在接口后面并在后台实现工厂模式，这将在需要时创建正确类的对象。

您还可以使用此抽象来检测不兼容的版本异常，并在后台执行任何必要的转换以迁移对象中的数据。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-25T20:31:01.877

Java 库类应该在 1.4 和 1.6 之间具有兼容的序列化形式，除非另有说明。Swing 明确声明它在版本之间不兼容，因此如果您尝试序列化 Swing 对象，那么您就不走运了。

您可能会遇到 javac 生成的代码略有不同的问题。这将改变`serialVersionUID`. 您应该确保在所有可序列化类中明确声明 UID。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-25T21:55:05.280

不，不同版本的 JVM 不会破坏序列化本身。

如果您正在序列化的某些对象来自 Java 运行时，并且它们的类发展不兼容，您将看到失败。大多数核心 Java 类对此都很小心，但过去在某些包中存在不连续性。

多年来，我已经成功地将序列化（在 RMI 的上下文中）与来自运行不同版本 Java 运行时的不同机器上的不同编译的类一起使用。

我不想离原始问题太远，但我想指出，无论格式如何，演变一个序列化类总是需要小心。这不是 Java 序列化特有的问题。无论您以 XML、JSON、ASN.1 等方式进行序列化，您都必须处理相同的概念。Java 序列化对允许的内容以及如何进行允许的更改给出了相当清晰的规范。有时这是限制性的，有时有处方会有所帮助。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-25T21:16:03.707

如果双方使用相同的 jar 文件，它会在大多数情况下工作。但是，如果您使用相同包/模块/框架的不同版本（例如不同的 weblogic jar 或某些“罕见”异常的扩展使用），则需要进行大量集成测试才能获得批准。

# html - 当 Target 为 _blank 时，打开重定向到 Quicktime .MOV 文件的页面的 HTML 链接在 IE 中显示垃圾字符

> ID：318708
> 
> 赞同：1
> 
> 时间：2008-11-25T20:21:08.857
> 
> 标签：html, internet-explorer, redirect, quicktime, target

我有一个 .NET 页面，它执行 Response.Redirect 到 Quicktime .mov 文件。当我创建到这个 .NET 页面的链接时，如果链接在同一个窗口中打开（即在锚标记上没有定义目标），一切都很好，IE 显示 Quicktime 电影就好了。但是，如果我将链接的目标设置为打开一个新窗口的“_blank”，IE 会在屏幕上显示垃圾字符（就像打开二进制文件一样）。两种情况下的 URL（有或没有目标）都是正确的（即[http://localhost/movies/myMovie.mov](http://localhost/movies/myMovie.mov)）。这真是令人费解……

使用 Fiddler 我可以看到，在重定向后提供实际电影文件的两种情况下，内容类型都是正确的视频/快速时间。

当然，如果我直接链接到 .MOV 文件，而不是重定向到它的页面，那么一切都很好，但由于业务逻辑，我不能这样做。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-25T21:01:36.653

在我的脑海中，在重定向之前，请确保将 Response.ContentType 设置为“video/quicktime”。

# vba - 将文本变为斜体后，将 Word 的光标类型（或更多文本插入）变为非斜体

> ID：318709
> 
> 赞同：0
> 
> 时间：2008-11-25T20:21:13.443
> 
> 标签：vba, ms-word

当我执行以下代码时：

```
Dim italicSaveRange As Word.Range
Dim savedItalic As Variant
Dim someRange As Word.Range

Set italicSaveRange = someRange.Duplicate
italicSaveRange.Collapse (WdCollapseEnd)
savedItalic = italicSaveRange.Italic
someRange.Italic = True
italicSaveRange.Italic = savedItalic 
```

我希望在光标处输入或插入到`someRange`la 中的任何文本：

```
someRange.InsertAfter "Lorem ipsum..." 
```

不会是斜体（当然，假设之前这个位置的格式不是斜体。）但它是。帮助。

* * *

根据您的建议，我现在有以下内容，这似乎正在工作。这可能是一个脆弱的解决方案，具体取决于同时移动的内容（例如，尝试在 Word 中输入一些斜体文本，按 ctrl-i 准备使用非斜体，然后将光标向左移动到斜体，然后向右移动再次出来；光标正在插入斜体文本...），但出于我的目的，我在其他地方添加文本（但在代码的不同级别，因此我无法访问要在此级别插入的文本）这可能会起作用. 谢谢你。

```
Set italicSaveRange = someRange.Duplicate
italicSaveRange.Collapse (WdCollapseEnd)
savedItalic = italicSaveRange.Italic
someRange.Italic = True
italicSaveRange.InsertAfter SP
italicSaveRange.Characters(1).Italic = savedItalic
italicSaveRange.Characters(1).Delete 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-25T21:48:23.673

当您将文本插入 Word Range 对象时，此文本将始终（afaik）继承先前文本运行的格式。

要解决此问题，您应该在插入文本后应用格式，即

```
Dim italicSaveRange As Word.Range
Dim savedItalic As Variant
Dim someRange As Word.Range

Set italicSaveRange = someRange.Duplicate
italicSaveRange.Collapse (WdCollapseEnd)
savedItalic = italicSaveRange.Italic
someRange.Italic = True
italicSaveRange.Text = "Lorem ipsum..."
italicSaveRange.Italic = savedItalic 
```

如果您必须稍后插入文本，您可能需要插入一些稍后替换的虚拟文本。

# css - 解决两个 IE6 布局错误

> ID：318715
> 
> 赞同：3
> 
> 时间：2008-11-25T20:21:59.510
> 
> 标签：css, internet-explorer, layout, internet-explorer-6

我的网页存在两个 IE6 渲染错误。他们每个人都有解决方法，但不幸的是，这些解决方法彼此不兼容。

[这是一个最小化的测试用例](http://www.control-v.net/stackoverflow/318715.html)。Firefox/Safari 中的行为是期望/正确的行为。IE7 是未知的，因为我现在无法访问它。

第一个错误：#content 有溢出：自动并包含一个相对定位的 div。[IE6 错误地为相对定位的 div 赋予了“固定”外观。](http://rowanw.com/bugs/overflow_relative.htm)解决方法：在#content 上设置位置：相对。

第二个错误：页面有时会显示一个模式弹出窗口。弹出窗口和背景上的 z-index 设置得非常高，以阻止与它们后面的任何东西进行交互。这工作正常，直到我在#content 上设置 position:relative，这使得 IE6[完全错误地对待 z-index 属性](http://www.last-child.com/conflicting-z-index-in-ie6/)。

我怎样才能让这些虫子很好地相互玩耍？（注意：远程格式化仍在运行 IE6 的用户的硬盘驱动器不是一种选择，这让我很沮丧。）

**编辑：** [这是第二个测试用例](http://www.control-v.net/stackoverflow/318715-2.html)，显示了当我应用位置时会发生什么：相对于内容。第一个错误（#content-header 的“固定”外观）已解决，但它会导致 z-index 错误启动并弄乱模态背景。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-09T17:25:44.727

我不认为使用库来减少我处理荒谬的 IE 错误的时间是太糟糕的惩罚。

我们最终使用了 bgiframe jquery 插件 ( [http://plugins.jquery.com/project/bgiframe](http://plugins.jquery.com/project/bgiframe) )。它在库中实现了 iframe“屏蔽”技术。我认为让 IE6 用户必须有更多的库下载惩罚（实际上并没有那么多），这样我就不必为 IE6 流血而疯狂是值得的。

PS 我认为全世界的 Web 开发者应该发起集体诉讼，迫使微软以太提供 IE6 和 IE7 的 firebug 等价物，确保所有 IE6 和 IE7 实例升级到标准，或者删除所有版本的 IE6 和 IE7互联网上的所有计算机，或以每人 100 万美元的代价救助所有 Web 开发人员的痛苦和痛苦！

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-26T13:05:20.733

关于如何避免 ie6（及以下）一致性的大量问题，有无数种实现方法。唯一对我有用（甚至在很大程度上）是 Dean Edward 的解决方案。

尝试在主标题中插入以下行：

```
<!--[if lt IE 8]><script src="http://ie7-js.googlecode.com/svn/version/2.0(beta)/IE7.js" type="text/javascript"></script><![endif]--> 
```

- 看看它是如何从那里开始的（以及你仍然需要处理什么，因为它可能无法解决所有问题）。

脚本大小只有 30kb，并且只能在 ie6 和 ie7 中加载。

谷歌代码网址（显然）是[http://code.google.com/p/ie7-js/](http://code.google.com/p/ie7-js/)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-28T00:13:49.853

实现我们在[Ra-Ajax.org](http://ra-ajax.org)上所做的事情（提示，使用 IE 访问该站点；）

说真的，即使是prototype.js 和 37signals 现在也停止支持 IE6，我认为是时候继续前进了......

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2008-11-25T23:07:46.913

虽然它可能是错误的解决方案，而且可能有点矫枉过正，但 jQuery 可以执行与此类似的模式弹出窗口，并且适用于 IE6。对于这样一个简单的答案，我可能会被否决，但在重新发明轮子之前，仍然值得考虑或至少看看其他解决方案。

# asp.net-mvc - ASP.NET-MVC (IIS6) 高流量错误：指定的转换无效

> ID：318716
> 
> 赞同：9
> 
> 时间：2008-11-25T20:22:02.537
> 
> 标签：asp.net-mvc, sql-server-2005, linq-to-sql, iis-6

我刚刚在我不起眼的专用服务器 (Win2003) 上启动了我的[微型 web 应用](http://www.dudlers.com)程序...运行 ASP.NET MVC、LINQ2SQL、SQL Express 2005 和 IIS6（使用[通配符映射](http://www.microsoft.com/technet/prodtechnol/WindowsServer2003/Library/IIS/5c5ae5e0-f4f9-44b0-a743-f4c3a5ff68ec.mspx?mfr=true)设置）

该网站90％的时间运行顺利。但是，在*相对*较高的流量上，LINQ2SQL 会抛出错误：Specified cast is not valid

此错误仅在高流量时引发。我**不**知道这是如何发生的或究竟为什么会发生。缓存并没有完全消除这个问题。

以前有人见过这个问题吗？有什么我应该做的秘密 SQL Server 调整吗？或者至少，**关于如何诊断这个问题的任何想法？**因为我出去了！

奈米

Stacktrace（来自事件日志）：

```
在 System.Data.SqlClient.SqlBuffer.get_SqlGuid()
   在 System.Data.SqlClient.SqlDataReader.GetGuid(Int32 i)
   在 Read_Friend(ObjectMaterializer`1 )
   在 System.Data.Linq.SqlClient.ObjectReaderCompiler.ObjectReader`2.MoveNext()
   在 C:\Web\Models\DudlersDataContext.cs:line 562 中的 Dudlers.Web.Models.DudlersDataContext.GetFriendRequests(Guid userId)
   在 Dudlers.Web.Controllers.BaseController.View(String viewName, String masterName, Object viewData) 在 C:\Web\Controllers\BaseController.cs:line 39
   在 System.Web.Mvc.Controller.View（字符串视图名称）
   在 C:\Web\Controllers\CatController.cs:line 25 中的 Dudlers.Web.Controllers.CatController.Index()
   在 lambda_method(ExecutionScope, ControllerBase, Object[])
   在 System.Web.Mvc.ActionMethodDispatcher.Execute（ControllerBase 控制器，Object[] 参数）
   在 System.Web.Mvc.ControllerActionInvoker.InvokeActionMethod（MethodInfo 方法信息，IDictionary`2 参数）
   在 System.Web.Mvc.ControllerActionInvoker.c__DisplayClassb.b__8()
   在 System.Web.Mvc.ControllerActionInvoker.InvokeActionMethodFilter（IActionFilter 过滤器，ActionExecutingContext preContext，Func`1 延续）
   在 System.Web.Mvc.ControllerActionInvoker.c__DisplayClassb.c__DisplayClassd.b__a()
   在 System.Web.Mvc.ControllerActionInvoker.InvokeActionMethodWithFilters（MethodInfo 方法信息，IDictionary`2 参数，IList`1 过滤器）
   在 System.Web.Mvc.ControllerActionInvoker.InvokeAction（ControllerContext 控制器上下文，字符串 actionName）
   在 System.Web.Mvc.Controller.ExecuteCore()
   在 System.Web.Mvc.ControllerBase.Execute（RequestContext requestContext）
   在 System.Web.Mvc.ControllerBase.System.Web.Mvc.IController.Execute（RequestContext requestContext）
   在 System.Web.Mvc.MvcHandler.ProcessRequest(HttpContextBase httpContext)
   在 System.Web.Mvc.MvcHandler.ProcessRequest(HttpContext httpContext)
   在 System.Web.Mvc.MvcHandler.System.Web.IHttpHandler.ProcessRequest(HttpContext httpContext)
   在 System.Web.HttpApplication.CallHandlerExecutionStep.System.Web.HttpApplication.IExecutionStep.Execute()
   在 System.Web.HttpApplication.ExecuteStep（IExecutionStep 步骤，Boolean& completedSynchronously）

```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-23T05:38:33.170

我们在使用 LINQ 时遇到了类似的问题，我们得到“无法将 'System.Int32' 类型的对象转换为 'System.String' 类型”和“指定的转换无效”。

堆栈跟踪示例

```
System.InvalidCastException: Unable to cast object of type 'System.Int32' to type 'System.String'.
   at System.Data.SqlClient.SqlBuffer.get_String()
   at System.Data.SqlClient.SqlDataReader.GetString(Int32 i)
   at Read_Person(ObjectMaterializer`1 )
   at System.Data.Linq.SqlClient.ObjectReaderCompiler.ObjectReader`2.MoveNext()
   at System.Collections.Generic.List`1..ctor(IEnumerable`1 collection)
   at System.Linq.Enumerable.ToList[TSource](IEnumerable`1 source)
   at RF.Ias.Services.Person.BusinessLogic.PersonTransactionScripts.GetPersons(IEnumerable`1 personIds, Boolean includeAddress, Boolean includeContact)
   at CompositionAopProxy_5b0727341ad64f29b816c1b73d11dd44.GetPersons(IEnumerable`1 personIds, Boolean includeAddress, Boolean includeContact)
   at RF.Ias.Services.Person.ServiceImplementation.PersonService.GetPersons(GetPersonRequest request)

System.InvalidCastException: Specified cast is not valid.
   at System.Data.SqlClient.SqlBuffer.get_Int32()
   at System.Data.SqlClient.SqlDataReader.GetInt32(Int32 i)
   at Read_GetRolesForOrganisationResult(ObjectMaterializer`1 )
   at System.Data.Linq.SqlClient.ObjectReaderCompiler.ObjectReader`2.MoveNext()
   at System.Collections.Generic.List`1..ctor(IEnumerable`1 collection)
   at System.Linq.Enumerable.ToList[TSource](IEnumerable`1 source)
   at RF.Ias.Services.Role.DataAccess.RoleDataAccess.GetRolesForOrganisation(GetRolesForOrganisationCriteria criteria, Int32 pageIndex, Int32 pageSize, Int32& recordCount)
   at RF.Ias.Services.Role.BusinessLogic.RoleTransactionScripts.GetRolesForOrganisation(GetRolesForOrganisationCriteria criteria, Int32 pageIndex, Int32 pageSize, Int32& recordCount)
   at CompositionAopProxy_4bd29c6074f54d10a2c09bd4ab27ca66.GetRolesForOrganisation(GetRolesForOrganisationCriteria criteria, Int32 pageIndex, Int32 pageSize, Int32& recordCount)
   at RF.Ias.Services.Role.ServiceImplementation.RoleService.GetRolesForOrganisation(GetRolesForOrganisationRequest request) 
```

如果我们首先遇到类似“System.InvalidOperationException：已经有一个打开的 DataReader 与此命令关联，必须先关闭”这样的异常，我们过去常常会遇到这些异常。或“从服务器接收结果时发生传输级错误。（提供者：TCP 提供者，错误：0 - 现有连接被远程主机强制关闭。）”。

第一个异常发生在 DataCONtext 的不同实例上，然后发生在所有随后的实例上。

[经过一些研究并在这个线程](https://stackoverflow.com/questions/780447/is-it-possible-to-gets-sql-connection-leaks-using-linq/780669#780669)中询问，我发现原因是我没有处理 DataContexts。在我开始这样做之后，它就消失了。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-25T20:25:21.170

听起来可能是竞争条件，或者可能是仅与高流量相关的罕见错误，*因为**当*您的大多数请求发生时。

 *# csv - PST 到 CSV 文件转换

> ID：318727
> 
> 赞同：1
> 
> 时间：2008-11-25T20:25:26.960
> 
> 标签：csv, outlook

有谁知道通过命令行将 .pst 转换为 .csv 文件的好工具？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-18T20:21:16.117

你能假设 Outlook 安装在计算机上吗？如果是这样，我相信它可以使用 OLE 或类似的东西在后台编写脚本。我以这种方式使用 Ruby 通过 Excel 完成了文件转换。

这是一个[Perl 示例](http://www.unur.com/comp/ppp/perl-win32-ole-outlook-ex1.html)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-26T15:50:04.283

我需要能够以编程方式完成它！

我在 MailNavigator 或 Wikipedia 中没有看到任何有用的东西......

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-08-18T20:24:52.540

我刚刚偶然发现的一个解决方案是： [libpst](http://www.five-ten-sg.com/libpst/)

它显然不会直接转换为 CSV，但它会转换为更易于管理的格式。

导入 Outlook，然后导出为 CSV 可能仍然是最快的解决方案，但如果您只有 PST 文件而没有 Outlook，libpst 肯定会很有用。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-28T23:38:38.500

您始终可以使用 CDO、MAPI、OOM 或 Redemption 编写一个 .Net 应用程序，满足您的需求。我为我的公司编写了一个完整的 Outlook 导出工具，您可以在[http://www.tzunami.com查看](http://www.tzunami.com)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-25T22:43:43.513

仅一次？还是以编程方式？

如果只有一次，请导入处理 mbox 的邮件程序（例如 Thunderbird），此时您只有文本文件，根据需要进行操作。

否则，不知道，祝你好运。

# java - 类似于使用 JSF 的 O/R 映射的自动实体映射？

> ID：318738
> 
> 赞同：0
> 
> 时间：2008-11-25T20:32:02.750
> 
> 标签：java, jsf, jpa, entity

使用 JPA，我不需要为每个新属性编写 SQL，因为 o/r 映射是自动完成的。

由于我是 JSF 的新手，我想知道 JSF 是否有类似的可能性？

我不想每次在相应实体处更改某些内容时都向 jsf 数据表添加新代码。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-25T20:57:38.983

JSF 提供了一种管理事件和请求及其链接对象的生命周期的方法。它总是可以使用任何 ORM 框架，因为 JSF 不直接使用数据库（它甚至不知道它）。[Hibernate](http://www.hibernate.org/) + JSF 是很常见的组合。

但是，如果您正在询问将 JSF 托管 bean 与 JPA 框架一起使用，请查看 Seam：[http](http://www.seamframework.org/) ://www.seamframework.org/ 。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-26T09:30:58.793

> 我不想每次在相应实体处更改某些内容时都向 jsf 数据表添加新代码。

如果您想要一个动态数据表，您可能必须使用核心 JSF 的附加组件。我使用[IceFaces](http://www.icefaces.org)，效果很好。您可以使用该[`<ice:columns>`](http://www.icefaces.org/docs/v1_7_2/components/columnsDoc.html)组件动态生成列。我们使用它来显示可能返回不同列的查询结果。

# css - 将图像圆角应用于

> ID：318742
> 
> 赞同：0
> 
> 时间：2008-11-25T20:32:36.057
> 
> 标签：css, image, rounded-corners

我正在使用 jQuery 插件为我`<li>`的 .

我想知道使用两个图像（左角和右角）作为左右两侧的最佳方法是 using `<li>`.

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-25T20:42:32.993

我见过的最常用的构造是链接内的跨度。

所以像：

```
<li><a><span>Your text here</span></a></li> 
```

然后，您可以使用链接的悬停状态来定位跨度和链接：

```
a:hover{some rules here}  
a:hover span{some more rules here} 
```

这使它有点语义，并且不会给页面添加太多垃圾。

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2008-11-25T20:37:42.940

您可以像这样将 Divs 放入您的 li 中：

```
<li>
  <div class="lefcorner"></div>
  <div class='liContent'>Foo</div>
  <div class='rightcorner'></div>
</li> 
```

这样一来，您既可以保留语义，也可以跨浏览器支持样式化 DIV。

# c# - 字符串列表到一个字符串

> ID：318756
> 
> 赞同：220
> 
> 时间：2008-11-25T20:38:05.000
> 
> 标签：c#, string, performance, functional-programming

假设你有一个：

```
List<string> los = new List<string>(); 
```

在这个疯狂的功能世界中，我们生活在这些日子里，其中一个最适合通过连接这些来创建一个字符串：

```
String.Join(String.Empty, los.ToArray());

StringBuilder builder = new StringBuilder();
los.ForEach(s => builder.Append(s));

string disp = los.Aggregate<string>((a, b) => a + b); 
```

或普通的旧 StringBuilder foreach

或者，还有更好的方法？

* * *

## 回答 #1

> 赞同：308
> 
> 时间：2008-11-25T20:42:51.153

我会选择选项A：

```
String.Join(String.Empty, los.ToArray()); 
```

我的推理是因为 Join 方法是为此目的而编写的。事实上，如果您查看 Reflector，您会发现使用了不安全的代码来真正优化它。另外两个也可以工作，但我认为 Join 函数是为此目的而编写的，我猜这是最有效的。虽然我可能是错的......

根据@Nuri YILMAZ 没有`.ToArray()`，但这是.NET 4+：

```
String.Join(String.Empty, los); 
```

* * *

## 回答 #2

> 赞同：53
> 
> 时间：2008-11-26T01:54:33.533

```
string.Concat(los.ToArray()); 
```

If you just want to concatenate the strings then use string.Concat() instead of string.Join().

* * *

## 回答 #3

> 赞同：19
> 
> 时间：2011-09-13T14:53:34.713

如果您使用 .net 4.0，您可以使用排序方式：

```
String.Join<string>(String.Empty, los); 
```

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2008-11-25T20:44:31.493

String.Join() 的实现速度非常快，并且由于您已经拥有相关字符串的集合，因此可能是最佳选择。最重要的是，它大喊“我要加入一个字符串列表！” 总是很好。

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2015-05-21T18:13:53.243

```
los.Aggregate((current, next) => current + "," + next); 
```

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2008-11-25T20:42:54.740

我的投票是字符串。加入

无需创建 lambda 评估和临时函数，更少的函数调用，更少的堆栈推送和弹出。

# language-agnostic - 用反射注册派生类，好还是坏？

> ID：318761
> 
> 赞同：3
> 
> 时间：2008-11-25T20:38:52.923
> 
> 标签：language-agnostic, reflection, inheritance

众所周知，当我们派生一个类并使用多态性时，某个地方的某个人需要知道要实例化哪个类。我们可以使用工厂、一个大的 switch 语句、if-else-if 等。我刚刚从 Bill K 那里了解到这叫做依赖注入。

**我的问题：使用反射和属性作为依赖注入机制是一种好习惯吗？**这样，当我们添加新类型时，列表会动态填充。

这是一个**例子**。*请不要评论如何以其他方式加载图像，我们知道*。

假设我们有以下 IImageFileFormat 接口：

```
public interface IImageFileFormat
{
   string[] SupportedFormats { get; };
   Image Load(string fileName);
   void Save(Image image, string fileName);
} 
```

不同的类会实现这个接口：

```
[FileFormat]
public class BmpFileFormat : IImageFileFormat { ... }

[FileFormat]
public class JpegFileFormat : IImageFileFormat { ... } 
```

当需要加载或保存文件时，管理器需要遍历所有已知的加载器，并根据其 SupportedExtensions 从适当的实例调用 Load()/Save()。

```
class ImageLoader
{
   public Image Load(string fileName)
   {
      return FindFormat(fileName).Load(fileName);
   }

   public void Save(Image image, string fileName)
   {
      FindFormat(fileName).Save(image, fileName);
   }

   IImageFileFormat FindFormat(string fileName)
   {
      string extension = Path.GetExtension(fileName);
      return formats.First(f => f.SupportedExtensions.Contains(extension));
   }

   private List<IImageFileFormat> formats;
} 
```

我想这里的重点是可用加载器（格式）列表是应该手动填充还是使用反射填充。

用手：

```
public ImageLoader()
{
   formats = new List<IImageFileFormat>();
   formats.Add(new BmpFileFormat());
   formats.Add(new JpegFileFormat());
} 
```

通过反射：

```
public ImageLoader()
{
   formats = new List<IImageFileFormat>();
   foreach(Type type in Assembly.GetExecutingAssembly().GetTypes())
   {
      if(type.GetCustomAttributes(typeof(FileFormatAttribute), false).Length > 0)
      {
         formats.Add(Activator.CreateInstance(type))
      }
   }
} 
```

我有时会使用后者，但我从未想过这可能是一个非常糟糕的主意。是的，添加新类很容易，但注册这些相同类的机制更难掌握，因此比简单的手工编码列表更难维护。

请讨论。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-25T20:54:12.987

我个人的偏好既不是 - 当类映射到某个任意字符串时，恕我直言，配置文件就是这样做的地方。这样，您**永远**不需要修改代码——特别是如果您使用动态加载机制来添加新的动态库。

一般来说，我总是更喜欢一些允许我尽可能多地编写代码的方法 - 您的两种方法都需要更改已经编写/构建/部署的代码（因为您的反射路线没有规定在新的 DLL 中添加文件格式加载器） .

**由币币编辑：**

反射方法可以有效地结合配置文件来定位要注入的实现。

*   可以使用规范名称在配置文件中显式声明该类型，类似于 MSBuild <UsingTask>
*   配置可以定位程序集，但是我们必须注入所有匹配的类型，比如 Microsoft Visual Studio 包。
*   将值或条件集与所需类型匹配的任何其他机制。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-25T20:45:47.713

我的投票是反射方法更好。使用该方法，添加新文件格式只会修改代码的一部分 - 您定义类以处理文件格式的地方。没有反射，你必须记住修改另一个类，ImageLoader，以及

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-25T23:16:51.887

这不就是依赖注入模式的全部内容吗？

如果您可以隔离依赖关系，那么机制几乎肯定是基于反射的，但它将是配置文件驱动的，因此可以很好地封装和隔离反射的混乱。

我相信对于 DI，您只是说我需要一个`<interface>`带有其他参数的类型对象，并且 DI 系统会返回一个满足您条件的对象。

This goes together with IoC (Inversion of Control) where the object being supplied may need something else, so that other thing is automatically created and installed into your object (being created by DI) before it's returned to the user.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-25T21:06:35.253

我知道这与“没有评论以其他方式加载图像”有关，但为什么不只是翻转你的依赖关系——而不是让 ImageLoader 依赖于 ImageFileFormats，让每个 IImageFileFormat 依赖于一个 ImageLoader？你会从中得到一些好处：

*   每次添加新的 IImageFileFormat 时，都无需在其他任何地方进行任何更改（也不必使用反射）
*   如果您更进一步并抽象 ImageLoader，您可以在单元测试中模拟它，从而更容易测试每个 IImageFileFormat 的具体实现

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-02-10T21:05:35.640

In vb.net, if all the image loaders will be in the same assembly, one could use partial classes and events to achieve the desired effect (have a class whose purpose is to fire an event when the image loaders should register themselves; each file containing image loaders can have use a "partial class" to add another event handler to that class); C# doesn't have a direct equivalent to vb.net's WithEvents syntax, but I suspect partial classes are a limited mechanism for achieving the same thing.

# c# - C# - WebRequest 不返回不同的页面

> ID：318766
> 
> 赞同：0
> 
> 时间：2008-11-25T20:40:05.930
> 
> 标签：c#, html

这是我的控制台程序的目的：发出 Web 请求 > 从 Web 请求中保存结果 > 使用 QueryString 从 Web 请求中获取下一页 > 保存这些结果 > 使用 QueryString 从 Web 请求中获取下一页等。

所以这里有一些关于我如何设置代码的伪代码。

```
 for (int i = 0; i < 3; i++)
        {
            strPageNo = Convert.ToString(i);  

            //creates the url I want, with incrementing pages
            strURL = "http://www.website.com/results.aspx?page=" + strPageNo;   

            //makes the web request
            wrGETURL = WebRequest.Create(strURL);

            //gets the web page for me
            objStream = wrGETURL.GetResponse().GetResponseStream();

            //for reading web page
            objReader = new StreamReader(objStream);

            //--------
            // -snip- code that saves it to file, etc.
            //--------

            objStream.Close();
            objReader.Close();

            //so the server doesn't get hammered
            System.Threading.Thread.Sleep(1000); 
         } 
```

很简单，对吧？**问题是**，即使它增加页码以获得不同的网页，每次循环运行时我都会得到*完全相同的结果页面。*

`i`是正确递增的，我可以将`strURL`创建的 url 剪切/粘贴到网络浏览器中，它工作得很好。

我可以手动输入`&page=1`, `&page=2`, `&page=3`，它会返回正确的页面。不知何故，把增量放在那里搞砸了。

它与会话有什么关系，还是什么？我确保在它再次循环之前关闭流和阅读器......

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-25T21:08:51.100

您是否尝试过在循环期间每次都创建一个新的 WebRequest 对象，这可能是 Create() 方法没有充分清除其所有旧数据。

要检查的另一件事是 ResponseStream 在下一次循环迭代之前被充分刷新。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-25T21:35:27.193

这段代码对我来说很好：

```
var urls = new [] { "http://www.google.com", "http://www.yahoo.com", "http://www.live.com" };

foreach (var url in urls)
{
    WebRequest request = WebRequest.Create(url);
    using (Stream responseStream = request.GetResponse().GetResponseStream())
    using (Stream outputStream = new FileStream("file" + DateTime.Now.Ticks.ToString(), FileMode.Create, FileAccess.Write, FileShare.None))
    {
        const int chunkSize = 1024;
        byte[] buffer = new byte[chunkSize];
        int bytesRead;
        while ((bytesRead = responseStream.Read(buffer, 0, buffer.Length)) > 0)
        {
            byte[] actual = new byte[bytesRead];
            Buffer.BlockCopy(buffer, 0, actual, 0, bytesRead);
            outputStream.Write(actual, 0, actual.Length);
        }
    }
    Thread.Sleep(1000);
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-25T21:09:39.273

只是一个建议，尝试处理 Stream 和 Reader。我见过一些奇怪的情况，不处理这样的对象并在循环中使用它们会产生一些古怪的结果......

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-25T20:56:36.570

除非您使用 MVC 或可以正确解释查询字符串的东西，否则该 URL 对我来说不太有意义。

```
http://www.website.com/results.aspx&page= 
```

应该：

```
http://www.website.com/results.aspx?page= 
```

一些浏览器会接受格式不正确的 URL 并呈现它们。其他人可能不是，这可能是您的控制台应用程序的问题。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2008-11-26T16:46:58.100

这是我可怕的，hack-ish，解决方法：

制作另一个调用 THIS 的控制台应用程序，其中第一个控制台应用程序在 strURL 的末尾传递一个参数。它有效，但我觉得很脏。

# java - Java字符串中的空\u0000？

> ID：318775
> 
> 赞同：4
> 
> 时间：2008-11-25T20:43:02.570
> 
> 标签：java, string, null

是否有充分的理由不使用 \u0000 作为 Java 字符串中的分隔符？我将自己编码和解码字符串。

这是为了将用户输入的（我希望输入输入？）字符串列表保存到 Eclipse 首选项并读回。该列表的大小可能是可变的，因此我认为我无法将每个项目保存为自己的偏好。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-25T20:47:18.210

如果数据保留在 Java 中，为什么不使用数组或列表来代替呢？

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-25T20:47:46.510

曾经有一些库错误地将 Java 字符串处理为空终止。我不知道这是否仍然是真的，但值得记住这些事情。特别是如果您与将字符串处理为空终止的外部库进行互操作。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-25T20:44:23.927

好吧，任何以某种方式转换字符串的东西都可能会剥离它。哦，还有你可能希望在输入中保留任何空值的微弱可能性。

你打算用它做什么？

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-25T20:46:32.253

如果您稍后需要对其进行解析，则字符串解析函数可能不接受 null 作为分隔符的值。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-25T20:48:22.513

听起来您正在尝试使用它来存储列表。为什么不使用`ArrayList<String>`？在`\u0000`字符串中有 a 是不好的。考虑使用字节数组。

正如您所说的在 Eclipse 设置中保存某些内容，我不会使用嵌入式 NUL，因为这些文件似乎是用户可读的（至少在我的 ~/.eclipse 中）。你想保存什么？例如，您可以对项目（“项目 2”“项目 2”）进行字符串化。只是不要太复杂。

# java - JPA/Hibernate 映射以存储月份和日期

> ID：318776
> 
> 赞同：0
> 
> 时间：2008-11-25T20:43:57.203
> 
> 标签：java, hibernate, jpa, persistence

我有以下 POJO：

```
class Month {
    long id;
    String description;
    List<Day> days; // always contains 29, 30 or 31 elements
}

class Day {
    byte nr; // possible values are 1-31
    String info;
} 
```

有没有办法使用 JPA+Hibernate 将这些对象存储到以下数据库结构中：

表月份：

```
ID;描述;
```

表天数：

```
月 id；nr-of-day；信息；
```

这种情况有更好的解决方案吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-02T20:03:26.907

如果你不能改变你的 pojo 或表格结构，那你就有点搞砸了。如果可以的话，一个简单的带注释的 pojo 就可以了。

```
class Month {
   @Id
   private long id;
   private String description;
   @OneToMany(mappedBy="month",fetchType=Lazy)
   private List<Day> days;

} 
```

---- Days 表的代理键所需的数据库更改

```
class Day {
    @Id
    private int id;
    private Month month;
    private byte nr; // possible values are 1-31
    private String info;
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-22T06:44:11.857

您可以将 Month @Entity 类 UNIDIRECTIONAL 关系与 Day @Entity 类映射，而不用使用 CascadeType.PERSIST 的 @Embeddable，其中 @Entity Day 类的标识符由 Month 标识符和列表索引组成，如下所示？

@Entity 公共类月 {

```
@Id
@GeneratedValue
private Integer id;

// one way relationship
@OneToMany(cascade=CascadeType.PERSIST)
@JoinColumn(name="MONTH_ID")
@IndexColumn(name="childIndex")
private List<Day> dayList = new ArrayList<Day>(); 
```

}

@Entity 公共课日{

```
@EmbeddedId // composed by month foreign key and index column
private DayId id; 
```

}

我希望你能解决这个问题

问候 Arthur Ronald FD Garcia（Java 程序员） Natal/Rn - 巴西

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-04T09:28:18.673

这是我找到的一个解决方案：

```
class Month {
    long id;
    String description;

    @CollectionOfElements(fetch = FetchType.EAGER)
    @IndexColumn(name = "nr-of-day")
    List<Day> days; // always contains 29, 30 or 31 elements
}

@Embeddable
class Day {
    byte nr; // possible values are 1-31
    String info;
} 
```

@CollectionOfelements 和 @IndexColumn 是 Hibernate 注释。如果我使用 JPA 中可用的 @OneToMany 注释，hibernate 会创建 3 个表而不是 2 个。

我现在唯一的问题是 Day.nr 被保存了两次：第一次作为 List 的 IndexColumn（基于 0 的计数器），第二次作为 Day 类的字段（基于 1 的计数器）。

# c# - C#如何将虚拟键码转换为字符？

> ID：318777
> 
> 赞同：31
> 
> 时间：2008-11-25T20:44:03.100
> 
> 标签：c#, char, converter, keycode

我正在尝试将虚拟键码映射到字符。

我的代码使用 ProcessCmdKey 来收听 WM_KEYDOWN ，这使我可以访问按下的键。例如，当我按下单引号时，我得到一个 222 的键，我希望将它映射到 keychar 39，它表示......你猜对了......单引号。

我的开发环境是： - .net Framework 2.0 - UserControl 放置在很多地方

你知道问题的答案吗？

* * *

## 回答 #1

> 赞同：45
> 
> 时间：2008-11-26T14:40:30.010

这不是[System.Windows.Form.KeysConverter](http://msdn.microsoft.com/en-us/library/system.windows.forms.keysconverter.aspx)类的用途吗？

```
KeysConverter kc = new KeysConverter();
string keyChar = kc.ConvertToString(keyData); 
```

* * *

## 回答 #2

> 赞同：28
> 
> 时间：2008-11-26T14:29:30.750

是的，我确实使用了这种`MapVirtualKey`方法。但我期待更多关于如何使用它的细节：使用什么`DllImport`指令，`enum`映射到字符的具体内容等。

我不喜欢你用谷歌搜索 5 秒钟然后提出解决方案的这些答案：真正的挑战是将所有部分放在一起，而不必在大量无样本的 MSDN 页面或其他编码论坛上浪费时间为了得到你的答案。没有冒犯，但你的回答（甚至很好）毫无价值，因为我在论坛上发布我的问题之前就有了这个答案！

所以你去吧，我将发布我正在寻找的东西 - 一个开箱即用的 C# 解决方案：

1-将此指令放在您的班级中：

```
[DllImport("user32.dll")]
static extern int MapVirtualKey(uint uCode, uint uMapType); 
```

2- 像这样检索你的字符：

```
 protected override bool ProcessCmdKey(ref Message msg, Keys keyData)      
  {
     const int WM_KEYDOWN = 0x100;

     if (msg.Msg == WM_KEYDOWN)
     {            
        // 2 is used to translate into an unshifted character value 
        int nonVirtualKey = MapVirtualKey((uint)keyData, 2);

        char mappedChar = Convert.ToChar(nonVirtualKey);
     }

     return base.ProcessCmdKey(ref msg, keyData);
  } 
```

感谢您的关心...并享受！

* * *

## 回答 #3

> 赞同：22
> 
> 时间：2016-08-05T10:44:27.270

我正在寻找类似的东西，但我需要映射到当前键盘布局的字符。由于以上答案都没有满足我的要求，这就是我想出的。

```
 public string KeyCodeToUnicode(Keys key)
        {
            byte[] keyboardState = new byte[255];
            bool keyboardStateStatus = GetKeyboardState(keyboardState);

            if (!keyboardStateStatus)
            {
                return "";
            }

            uint virtualKeyCode = (uint)key;
            uint scanCode = MapVirtualKey(virtualKeyCode, 0);
            IntPtr inputLocaleIdentifier = GetKeyboardLayout(0);

            StringBuilder result = new StringBuilder();
            ToUnicodeEx(virtualKeyCode, scanCode, keyboardState, result, (int)5, (uint)0, inputLocaleIdentifier);

            return result.ToString();
        }

        [DllImport("user32.dll")]
        static extern bool GetKeyboardState(byte[] lpKeyState);

        [DllImport("user32.dll")]
        static extern uint MapVirtualKey(uint uCode, uint uMapType);

        [DllImport("user32.dll")]
        static extern IntPtr GetKeyboardLayout(uint idThread);

        [DllImport("user32.dll")]
        static extern int ToUnicodeEx(uint wVirtKey, uint wScanCode, byte[] lpKeyState, [Out, MarshalAs(UnmanagedType.LPWStr)] StringBuilder pwszBuff, int cchBuff, uint wFlags, IntPtr dwhkl); 
```

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2015-02-27T08:56:27.177

在阅读并测试了提供的一些答案之后，我想我会建议一个替代方案。

正如[MM](https://stackoverflow.com/users/195849/mm)所提到的，System.Windows.KeysConverter 不提供键的字符表示，而是提供枚举的名称，例如“Enter”而不是“\n”。

[Horas](https://stackoverflow.com/users/12333/horas)在回答他自己的问题时建议的 MapVirtualKey 方法是一个很好的起点，但仍然不支持大写锁定或使用 shift 键输入的字符，例如“！”、“$”和“>”。

我正在使用的 MapVirtualKey 方法的替代方法是 Keys 类的扩展方法：

```
public static char ToChar(this Keys key)
{
    char c = '\0';
    if((key >= Keys.A) && (key <= Keys.Z))
    {
        c = (char)((int)'a' + (int)(key - Keys.A));
    }

    else if((key >= Keys.D0) && (key <= Keys.D9))
    {
        c = (char)((int)'0' + (int)(key - Keys.D0));
    }

    return c;
} 
```

上面显示的方法将提供对字母数字字符的支持。可以使用 switch 语句或查找表来实现对附加字符的支持。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2017-07-12T10:51:31.667

我刚刚编写了[Ivan Petrov 答案](https://stackoverflow.com/questions/318777/c-sharp-how-to-translate-virtual-keycode-to-char/38787314#38787314)的改进，以在 WPF 中显示按键组合的字符串表示，请参见下面的代码：

```
public static string GetKeyString(Key key, ModifierKeys modifiers)
{
    string result = "";
    if (key != Key.None)
    {
        // Setup modifiers
        if (modifiers.HasFlag(ModifierKeys.Control))
            result += "Ctrl + ";
        if (modifiers.HasFlag(ModifierKeys.Alt))
            result += "Alt + ";
        if (modifiers.HasFlag(ModifierKeys.Shift))
            result += "Shift + ";
        // Get string representation
        string keyStr = key.ToString();
        int keyInt = (int)key;
        // Numeric keys are returned without the 'D'
        if (key >= Key.D0 && key <= Key.D9)
            keyStr = char.ToString((char)(key - Key.D0 + '0'));
        // Char keys are returned directly
        else if (key >= Key.A && key <= Key.Z)
            keyStr = char.ToString((char)(key - Key.A + 'A'));
        // If the key is a keypad operation (Add, Multiply, ...) or an 'Oem' key, P/Invoke
        else if ((keyInt >= 84 && keyInt <= 89) || keyInt >= 140)
            keyStr = KeyCodeToUnicode(key);
        result += keyStr;
    }
    return result;
}

private static string KeyCodeToUnicode(Key key)
{
    byte[] keyboardState = new byte[255];
    bool keyboardStateStatus = GetKeyboardState(keyboardState);

    if (!keyboardStateStatus)
    {
        return "";
    }

    uint virtualKeyCode = (uint)KeyInterop.VirtualKeyFromKey(key);
    uint scanCode = MapVirtualKey(virtualKeyCode, 0);
    IntPtr inputLocaleIdentifier = GetKeyboardLayout(0);

    StringBuilder result = new StringBuilder();
    ToUnicodeEx(virtualKeyCode, scanCode, new byte[255], result, (int)5, (uint)0, inputLocaleIdentifier);

    return result.ToString();
}

[DllImport("user32.dll")]
static extern bool GetKeyboardState(byte[] lpKeyState);

[DllImport("user32.dll")]
static extern uint MapVirtualKey(uint uCode, uint uMapType);

[DllImport("user32.dll")]
static extern IntPtr GetKeyboardLayout(uint idThread);

[DllImport("user32.dll")]
static extern int ToUnicodeEx(uint wVirtKey, uint wScanCode, byte[] lpKeyState, [Out, MarshalAs(UnmanagedType.LPWStr)] StringBuilder pwszBuff, int cchBuff, uint wFlags, IntPtr dwhkl); 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-10-24T12:25:31.930

KeysConverter 获取键名而不是键“文本”例如：“Num2”而不是“2” MapVirtualKey 将适用于英语，但对于使用 MapVirtualKeyEx 的非英语字符文档状态，但这需要一个语言环境标识符，该标识符由 LoadKeyBoardLayout 加载，需要一个文化 id 常量，但是在找到正确的 id 值之后，它在我尝试时不起作用，所以最后我把整个东西都扔掉了

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2020-05-13T10:27:15.773

如果你使用的是 WPF（我没有用 WinForms 尝试过），有一个非常简单的解决方案，直接返回按下的字符，即 Window 的[TextInput 事件](https://docs.microsoft.com/en-us/dotnet/api/system.windows.uielement.textinput?f1url=https%3A%2F%2Fmsdn.microsoft.com%2Fquery%2Fdev16.query%3FappId%3DDev16IDEF1%26l%3DEN-US%26k%3Dk(System.Windows.UIElement.TextInput);k(TargetFrameworkMoniker-.NETFramework,Version%3Dv4.8);k(DevLang-csharp)%26rd%3Dtrue&view=netcore-3.1)。

```
public partial class MainWindow : Window
{
    public MainWindow()
    {
        InitializeComponent();
        TextInput += MainWindow_TextInput;
    }

    private void MainWindow_TextInput(object sender, System.Windows.Input.TextCompositionEventArgs e)
    {
        txtInput.Text += e.Text;
    }
} 
```

# java - 托管签名 jar 时的安全注意事项

> ID：318781
> 
> 赞同：3
> 
> 时间：2008-11-25T20:44:25.627
> 
> 标签：java, security, jar, applet, jar-signing

在 Internet 上托管签名 jar 的安全隐患是什么？

据我了解 jar 签名，一旦用户选择自动接受证书，签名的 jar 来自您的域、从另一个域链接还是托管在另一个域上都没有关系。例如，Sun 使用此方法通过提供链接到驱动程序的（托管）签名 jar 来为 applet 提供 OpenGL 支持。那么，作为我提供的 java 代码的开发人员和证书签名者，我应该采取任何预防措施吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-17T12:07:46.397

根据上下文，您依赖安全管理器和相关的安全策略来做正确的事情。通常，除非您正在做自己的类加载器魔术，否则您不需要做任何特别的事情。如果您可以控制安全策略（例如在 java 应用程序中而不是 applet 中），您可以授予权限以仅对某些其他代码调用您的 jar。如果您依靠代码库来区分代码，那么 https URL 会更好。如果您知道访问应该来自哪里/谁应该来自哪里/谁，那么限制对网络服务器上 jar 的访问也是没有害处的，但可能比它的价值更麻烦。

但是，您应该始终牢记，API 的调用者可能不是您的代码，并且可能是恶意的。因此，在您的威胁建模中，您应该考虑如果恶意用户以某种方式可以访问您的代码公开的 API 提供的功能，他们可能会做什么。安全管理器应该检查调用堆栈以防止这种事情发生。但是，例如，如果您签名的 jar 有一个方法 LaunchMissiles() ...您可能想询问用户他们是否确定。您可能还想对用户进行身份验证。

您也不必依赖用户在任何安全警告上单击右键，尤其是当它涉及证书和 URL 等时 - 大多数用户属于以下两类之一：在任何警告上单击“确定”的人，因为他们不明白它，以及那些因为不理解而在任何警告上单击“取消”的人。

# c++ - BEGIN_MSG_MAP_EX 破坏 Visual Studio 2005 智能感知？

> ID：318783
> 
> 赞同：2
> 
> 时间：2008-11-25T20:44:32.100
> 
> 标签：c++, atl, visual-c++-2005, wtl

我有一个使用 WTL/ATL BEGIN_MSG_MAP_EX 宏进行消息处理的 C++ 应用程序。我使用 atlcrack.h 中的一些宏。

当我们将项目升级到 Visual Studio 2005 时，智能感知表现得很疯狂。我已经将行为追踪到 BEGIN_MSG_MAP_EX 宏在智能感知中的行为不正确。但是，我找不到继续使用 BEGIN_MSG_MAP_EX 和 Visual Studio 2005 的方法。

我是否必须重写所有旧的消息处理程序并停止使用 BEGIN_MSG_MAP_EX 或者是否有其他修复？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-25T20:50:01.730

我多年来一直在使用 WTL，并没有遇到过这个问题，但我也发现 VS2005/2008 中的默认 Intellisense 几乎没用 - 它无缘无故停止工作。如果您希望 Intellisense 以上帝的意图工作，我建议您尝试 Visual Assist X（30 天免费试用）——它*可能*会让你的问题消失——比更改代码来解决 IDE 问题更好吗？

[http://www.wholetomato.com/](http://www.wholetomato.com/)

# emacs - 突出显示 Lisp 表单的 Emacs 模式

> ID：318785
> 
> 赞同：5
> 
> 时间：2008-11-25T20:45:31.413
> 
> 标签：emacs, lisp, mode

什么是突出显示 Lisp 表单的 Emacs 模式或包，它会改变背景的颜色，从而使您所在的表单具有一种颜色，外部形式具有另一种颜色，外部外部形式具有另一种等等？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-11-25T21:21:14.710

您可能想尝试[mwe-color-box](http://www.foldr.org/~michaelw/emacs/)（下面的屏幕截图）或阅读[Lemondor](http://lemonodor.com/)[的 s-expression highlighting](http://lemonodor.com/archives/001207.html)的五种方法。

[![替代文字](https://i.stack.imgur.com/lbkDO.png)](https://i.stack.imgur.com/lbkDO.png)
[（来源：[foldr.org](http://www.foldr.org/~michaelw/emacs/color-box.png)）]

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-26T11:32:40.247

看看这里的截图[http://lemonodor.com/archives/001207.html](http://lemonodor.com/archives/001207.html)，可能就是你想要的。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-09-05T06:47:37.693

我不使用它，但这可能是您正在寻找的： [http ://www.emacswiki.org/emacs/RainbowDelimiters](http://www.emacswiki.org/emacs/RainbowDelimiters)

# eclipse - Eclipse 3.4 的 Webdav 插件？

> ID：318788
> 
> 赞同：3
> 
> 时间：2008-11-25T20:46:26.370
> 
> 标签：eclipse, webdav, ganymede

如何在 eclipse 3.4 中获得 webdav 支持？我在 3.3 中使用的 3.3 插件的开发版本似乎不起作用。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-10T00:07:33.703

如果您提到您使用的 3.3 插件在 3.4 中停止工作，也许会有所帮助。说，你检查了[WTP](http://www.eclipse.org/webtools/)项目。恕我直言，这是最有可能找到 WebDAV 支持的地方。

# perl - 在 Perl 中打开和读取文件的最佳方法是什么？

> ID：318789
> 
> 赞同：46
> 
> 时间：2008-11-25T20:46:26.870
> 
> 标签：perl, file, io, perl-io

请注意 - 我不是在寻找打开/读取文件的“正确”方式，或者我每次都应该打开/读取文件的方式。我只是想知道大多数人使用什么方式，也许同时学习一些新方法:)*

在我的 Perl 程序中，一个非常常见的代码块是打开一个文件并读取或写入它。我见过很多这样做的方法，多年来我执行这项任务的风格已经改变了几次。我只是想知道*最好*的（如果有最好的方法）方法是什么？

我曾经打开过这样的文件：

```
my $input_file = "/path/to/my/file";
open INPUT_FILE, "<$input_file"  || die "Can't open $input_file: $!\n"; 
```

但我认为这有错误捕获的问题。

添加括号似乎可以修复错误捕获：

```
open (INPUT_FILE, "<$input_file")  || die "Can't open $input_file: $!\n"; 
```

我知道您也可以将文件句柄分配给变量，因此我可以使用 $input_filehandle 而不是像上面那样使用“INPUT_FILE”——这样更好吗？

对于读取文件，如果文件很小，像这样的通配有什么问题吗？

```
my @array = <INPUT_FILE>; 
```

或者

```
my $file_contents = join( "\n", <INPUT_FILE> ); 
```

或者你应该总是循环遍历，像这样：

```
my @array;
while (<INPUT_FILE>) {
  push(@array, $_);
} 
```

我知道在 perl 中有很多方法可以完成任务，我只是想知道是否有在文件中打开和读取的首选/标准方法？

* * *

## 回答 #1

> 赞同：59
> 
> 时间：2008-11-25T20:55:46.977

没有通用的标准，但有理由偏爱其中一个。我喜欢的形式是这样的：

```
open( my $input_fh, "<", $input_file ) || die "Can't open $input_file: $!"; 
```

原因是：

*   您立即报告错误。（如果您想要的话，将“die”替换为“warn”。）
*   您的文件句柄现在是引用计数的，因此一旦您不使用它，它将自动关闭。如果使用全局名称 INPUT_FILEHANDLE，则必须手动关闭文件，否则它将保持打开状态，直到程序退出。
*   读取模式指示符“<”与 $input_file 分开，增加了可读性。

如果文件很小并且您知道需要所有行，则以下内容非常有用：

```
my @lines = <$input_fh>; 
```

如果您需要将所有行作为单个字符串处理，您甚至可以这样做：

```
my $text = join('', <$input_fh>); 
```

对于长文件，您需要使用 while 遍历行，或使用 read。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2008-11-25T21:00:24.267

如果您希望将整个文件作为单个字符串，则无需遍历它。

```
use strict;
use warnings;
use Carp;
use English qw( -no_match_vars );
my $data = q{};
{
   local $RS = undef; # This makes it just read the whole thing,
   my $fh;
   croak "Can't open $input_file: $!\n" if not open $fh, '<', $input_file;
   $data = <$fh>;
   croak 'Some Error During Close :/ ' if not close $fh;
} 
```

以上满足`perlcritic --brutal`，这是测试“最佳实践”的好方法:)。`$input_file`在这里仍然是未定义的，但其余的是犹太洁食。

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2008-11-29T12:29:11.757

不得不到处写“或死”让我发疯。我打开文件的首选方式如下所示：

```
use autodie;

open(my $image_fh, '<', $filename); 
```

虽然打字很少，但有很多重要的事情需要注意：

*   我们正在使用[autodie](http://search.cpan.org/perldoc?autodie) pragma，这意味着如果出现问题，所有 Perl 的内置函数都会抛出异常。它消除了编写`or die ...`代码的需要，它产生友好的、人类可读的错误消息，并且具有词法范围。它可从 CPAN 获得。

*   我们正在使用 open 的三参数版本。这意味着即使我们有一个包含`<`,`>`或等字符的有趣文件名`|`，Perl 仍然会做正确的事情。在我在 OSCON 的*Perl 安全*教程中，我展示了许多让 2-argument`open`行为不端的方法。本教程的注释可[从 Perl Training Australia 免费下载](http://perltraining.com.au/notes.html)。

*   我们正在使用标量文件句柄。这意味着我们不会巧合地关闭其他人的同名文件句柄，如果我们使用包文件句柄，就会发生这种情况。这也意味着`strict`可以发现拼写错误，并且如果超出范围，我们的文件句柄将被自动清理。

*   我们正在使用一个*有意义的*文件句柄。在这种情况下，看起来我们要写入图像。

*   文件句柄以`_fh`. 如果我们看到我们像使用常规标量一样使用它，那么我们知道这可能是一个错误。

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2008-11-25T21:42:29.097

如果您的文件足够小，可以将整个内容读入内存，请使用[File::Slurp](http://search.cpan.org/dist/File-Slurp)。它使用非常简单的 API 读取和写入完整文件，而且它会执行所有错误检查，因此您不必这样做。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2008-11-25T22:06:59.157

没有打开和读取文件的最佳方法。这是一个错误的问题。文件里有什么？您在任何时候都需要多少数据？您是否需要一次获取所有数据？你需要对数据做什么？在考虑如何打开和读取文件之前，您需要弄清楚这些。

您现在正在做的任何事情都会给您带来麻烦吗？如果没有，你没有更好的问题要解决吗？:)

您的大部分问题只是语法问题，所有这些都在 Perl 文档中得到了解答（尤其是（[perlpentut](http://perldoc.perl.org/perlopentut.html)）。您可能还想[学习 Learning Perl](http://oreilly.com/catalog/9780596520106/)，它回答了您在问题中遇到的大部分问题。

祝你好运， ：）

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2008-11-26T01:47:16.280

对于 OO，我喜欢：

```
use FileHandle;
...
my $handle = FileHandle->new( "< $file_to_read" );
croak( "Could not open '$file_to_read'" ) unless $handle;
...
my $line1 = <$handle>;
my $line2 = $handle->getline;
my @lines = $handle->getlines;
$handle->close; 
```

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2008-11-26T04:14:20.383

诚然，在 Perl 中打开文件的最佳方法有很多

```
$files_in_the_known_universe * $perl_programmers 
```

...但是看看谁通常以哪种方式做这件事仍然很有趣。我喜欢的 slurping 形式（一次读取整个文件）是：

```
use strict;
use warnings;

use IO::File;

my $file = shift @ARGV or die "what file?";

my $fh = IO::File->new( $file, '<' ) or die "$file: $!";
my $data = do { local $/; <$fh> };
$fh->close();

# If you didn't just run out of memory, you have:
printf "%d characters (possibly bytes)\n", length($data); 
```

当逐行进行时：

```
my $fh = IO::File->new( $file, '<' ) or die "$file: $!";
while ( my $line = <$fh> ) {
    print "Better than cat: $line";
}
$fh->close(); 
```

当然需要注意的是：这些只是我在日常工作中致力于肌肉记忆的方法，它们可能根本不适合你试图解决的问题。

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2008-11-26T12:27:05.207

我曾经使用过

```
open (FILEIN, "<", $inputfile) or die "...";
my @FileContents = <FILEIN>;
close FILEIN; 
```

定期样板。如今，我`File::Slurp`用于我想完全保存在内存中的小文件，以及`Tie::File`我想可伸缩地寻址的大文件和/或我想就地更改的文件。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2008-11-30T00:32:23.017

用一行将整个文件 $file 读入变量 $text

```
$text = do {local(@ARGV, $/) = $file ; <>}; 
```

或作为一个函数

```
$text = load_file($file);
sub load_file {local(@ARGV, $/) = @_; <>} 
```

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-11-25T21:01:29.913

如果这些程序只是为了提高您的工作效率，那么无论如何都行得通！尽可能多地构建您认为需要的错误处理。

如果文件很大，则读取整个文件可能不是长期做事的最佳方式，因此您可能希望在行进入时对其进行处理，而不是将它们加载到数组中。

我从 The Pragmatic Programmer (Hunt & Thomas) 中的一章中得到的一个提示是，您可能希望脚本在开始切片和切块之前为您保存文件的备份。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2008-12-01T10:32:46.407

运算符具有更高的`||`优先级，因此在将结果发送到“open”之前首先对其进行评估......在您提到的代码中，请改用“or”运算符，您就不会遇到这个问题。

```
open INPUT_FILE, "<$input_file"
  or die "Can't open $input_file: $!\n"; 
```

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-12-01T04:02:24.930

Damian Conway 这样做：

```
$data = readline!open(!((*{!$_},$/)=\$_)) for "filename"; 
```

但我不建议你这样做。

# perl - 这些来自 Tk::After 的 Perl/Tk 错误是什么意思？

> ID：318793
> 
> 赞同：3
> 
> 时间：2008-11-25T20:47:20.380
> 
> 标签：perl, debugging, perltk

以下是错误：

```
$ perl ftper.pl
在 /usr/lib/perl5/vendor_perl/5.1 的哈希元素中使用未初始化的值 $id
/i686-cygwin/Tk/After.pm 第 39 行。
在 /usr/lib/perl5/vendor_perl/5.1 的哈希元素中的未初始化值 $id
/i686-cygwin/Tk/After.pm 第 39 行。
在 /usr/lib/perl5/vendor_perl/5.1 的哈希元素中的未初始化值 $id
/i686-cygwin/Tk/After.pm 第 39 行。
在 /usr/lib/perl5/vendor_perl/5.1 的哈希元素中的未初始化值 $id
/i686-cygwin/Tk/After.pm 第 39 行。
在 /usr/lib/perl5/vendor_perl/5.1 的哈希元素中的未初始化值 $id
/i686-cygwin/Tk/After.pm 第 39 行。
在 /usr/lib/perl5/vendor_perl/5.1 的哈希元素中的未初始化值 $id
/i686-cygwin/Tk/After.pm 第 39 行。
在 /usr/lib/perl5/vendor_perl/5.10/i686 处删除的未初始化值 $id 的 se
cygwin/Tk/After.pm 第 87 行。
在 /usr/lib/perl5/vendor_perl/5.10/i686 处删除的未初始化值 $id 的 se
cygwin/Tk/After.pm 第 87 行。
在 /usr/lib/perl5/vendor_perl/5.10/i686 处删除的未初始化值 $id 的 se
cygwin/Tk/After.pm 第 87 行。
在 /usr/lib/perl5/vendor_perl/5.10/i686 处删除的未初始化值 $id 的 se
cygwin/Tk/After.pm 第 87 行。
在 /usr/lib/perl5/vendor_perl/5.10/i686 处删除的未初始化值 $id 的 se
cygwin/Tk/After.pm 第 87 行。
在 /usr/lib/perl5/vendor_perl/5.10/i686 处删除的未初始化值 $id 的 se
cygwin/Tk/After.pm 第 87 行。  

```

这是 Perl/Tk 代码：

```
#! /usr/bin/perl -w

use strict;
use Tk;
use Tk::Scale;
use File::DosGlob 'glob';

#####################################################################
# Define variables                              #
#####################################################################
my $UserID;
my $Password;
my $BnsNode;
my $Status_msg = "BUILD SCRIPT!";

#####################################################################
# Window variables                          #
#####################################################################
my $mw;
my $frmUserID;
my $lblUserID;
my $frmPassword;
my $lblPassword;
my $edtUserID;
my $edtPassword;
my $frmTop;
my $frmBig;
my $frmButtonLine;
my $btnExit;
my $btnSubmit;
my $lblStatus;
my $lblUnixNode;
my $frmUnixNode;
my $edtUnixNode;

#################################################################
# Main Logic                            #
#################################################################
init_mainwindow();
MainLoop;

#################################################################
# init_mainwindow                       #
#################################################################
sub init_mainwindow {
    $mw = MainWindow->new;
    $mw->title("BUILD");
    $mw->resizable(100, 100);
    $mw->geometry("+175+100");

    # Top Level frame for top section of form.
    $frmTop = $mw->Frame(-bd => 2, -relief => 'ridge')
        ->pack(-side => 'top', -fill => 'x', -pady => 3);

    $frmUserID = $frmTop->Frame(-bd => 2)->pack(
        -side => 'top', -fill => 'x');
    $lblUserID = $frmUserID->Label(-text => "Unix User ID:")
        ->pack(-side => 'left');
    $edtUserID = $frmUserID->Entry(-textvariable => \$UserID,
        -background => 'white')->pack(-side => 'left');

    $frmUnixNode = $frmTop->Frame(-bd => 2)->pack(
    -side => 'top', -fill => 'x');
    $lblUnixNode = $frmUserID->Label(-text => "BNS Number")
        ->pack(-side => 'left');
    $edtUnixNode = $frmUserID->Entry(-textvariable => \$BnsNode,
    -background => 'white')->pack(-side => 'left');

$frmPassword = $frmTop->Frame(-bd => 2)->pack(
    -side => 'top', -fill => 'x');
$lblPassword = $frmPassword->Label(
    -text => "Password:    ")->pack(-side => 'left');
$edtPassword = $frmPassword->Entry(-textvariable => \$Password,
    -background => 'white', -show => "*")
    ->pack(-side => 'left');

# Top Level frame for bottom section of form.
$frmButtonLine = $mw->Frame(-bd => 2, -relief => 'ridge')
    ->pack(-side => 'top', -fill => 'x', -pady => 3);
    $btnExit = $frmButtonLine->Button(-text => "Exit", 
        -command => \&close_mw, -width => 6)->pack(
        -side => 'right', -padx => 1);
        $btnSubmit = $frmButtonLine->Button(-text => "Run Script", 
    -command => \&execute_script, -width => 6)->pack(
        -side => 'right', -padx => 1);
    $lblStatus = $mw->Label(-textvariable => \$Status_msg,
        -borderwidth => 2, -relief => 'groove')
        ->pack(-fill => 'x', -side => 'bottom');

    $edtUserID->focus;

}

#####################################################################
# excute_script                             #
#####################################################################
sub execute_script {
    unless (defined($UserID)) {
        update_status("Must enter a user id!");
        $edtUserID->focus;
        return 0;
    }
    unless (defined($Password)) {
        update_status("Must enter a password!");
        $edtPassword->focus;
        return 0;
    }

    update_status("$BnsNode ,$UserID ");
}

#####################################################################
# close_mw                              #
#####################################################################
sub close_mw {
    $mw->destroy;
}

#####################################################################
# update_status                             #
#####################################################################
sub update_status {
    my ($msg) = @_;

    $Status_msg = $msg;
    $lblStatus -> update;
} 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-25T22:15:09.203

当我遇到这些问题时，我想找出是谁造成的。我将所有警告都转换为堆栈回溯，以查看是谁启动了 rukus：

```
使用鲤鱼；
$SIG{__WARN__} = sub { &Carp::cluck }

```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-25T21:25:55.073

错误消息本身很简单：

> 在 ...Tk/After.pm 第 39 行的哈希元素中使用未初始化的值 $id。
> 
> 在 ...Tk/After.pm 第 87 行的删除中使用未初始化的值 $id。

*   “使用未初始化的值”是指您使用了值为`undef`(undefined) 的值。
*   `$id`是未初始化变量的名称。
*   “在散列元素中”表示您使用该值作为散列键，例如`$h{$id}`
*   “in delete”表示您将该值用作要删除的哈希键。例如`delete $h{$id}`
*   “...Tx/After.pm”是发生错误的模块。
*   “第 39 行”和“第 87 行”是发生错误的行号（在模块中）。

Tk::After 为 Perl/Tk 应用程序提供回调调度。诸如“在（或每隔）500 毫秒后运行此功能”之类的内容。`$id`是小部件上特定回调的标识符。

对警告做什么更难。在您提供的代码中，我没有看到对 Tk::After 的任何显式调用。您的 Tk 安装中可能存在触发警告的错误。在带有 Tk 804.028 的 Perl 5.10 下运行它时，我没有收到任何警告。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-25T21:26:32.890

我还没有尝试过你的脚本，但看起来你可以通过`-w`从 shebang 行中删除来解决这个问题，这会打开全局警告，并添加 in `use warnings;`，它只会在其范围内打开警告。请参阅[我应该使用命令行开关或编译指示打开 Perl 警告吗？](https://stackoverflow.com/questions/221919/should-i-turn-on-perl-warnings-with-the-command-line-switch-or-pragma#221931)详情。

更新：我已经尝试过了，我也无法重现它。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-25T21:28:23.027

[其他人](http://www.perlmonks.org/?node_id=717528)似乎在使用 Strawberry Perl 5.10 时遇到了这个问题。我的印象是这是库的问题，而不是您的代码（在同一函数的早期，该哈希条目被删除，但只有在`$id`已定义时才被删除，因此显然`$id`不能保证已定义）。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-26T08:37:20.273

我在 x86 Cygwin 上看到与 v5.10.0 和 804.028-1 相同的问题。有趣的是，如果代码在调试器中执行，则不会出现问题，这表明代码编译/执行的方式有所不同/??? 调试器的内部和外部。

我怀疑底层 PerlTk 代码是正确的，问题在于 Perl 源代码/可执行文件本身——这种事情应该报告给谁？

迈克P

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-13T00:40:37.807

我犯了同样的错误。我相信这是因为没有运行显示服务器。一个更基本的测试是在 Cygwin 提示符下简单地键入“widget”。它应该会调出 Tk 小部件演示。如果我发现任何进一步的信息，我会报告。

# maven-2 - Maven 或 Ivy 用于管理 Ant 的依赖关系？

> ID：318804
> 
> 赞同：36
> 
> 时间：2008-11-25T20:49:57.207
> 
> 标签：maven-2, ant, dependencies, ivy

我想知道从 ant 管理项目依赖项的最佳方法。Maven Ant 任务和 Ivy 的优缺点是什么？

* * *

## 回答 #1

> 赞同：41
> 
> 时间：2008-11-25T21:11:42.373

由于您想要做的是将依赖管理添加到现有的 Ant 项目中，这正是 Ivy 的设计目的。依赖管理是 Maven 的重要组成部分，但远非全部。Maven 更像是一个面向项目的工具，除了依赖关系之外，它还可以做其他几件事。如果您计划迁移到 Maven 并同时使用其他 Maven 功能，那么这将是值得考虑的，但如果您只是将它用于剥离 Ant，那就有点过分了。

您的依赖类型和您对它们行为方式的期望也会产生影响。在 Maven 中拉取第三方依赖几乎是微不足道的，而 Ivy 擅长重建自己的依赖组件。在任何一种情况下，这些工具都不会提供体面的构建、版本控制和存储库*策略*，这些仍然取决于您并且需要正确配置。

* * *

## 回答 #2

> 赞同：40
> 
> 时间：2009-05-07T02:51:50.447

Ant + Ivy == 一个露营地，人们可以根据需要使用这些设施。
Maven == 一个度假村，您可以依靠其他人来提供服务。

对于缺乏构建/集成经验的团队来说，Maven 更容易，但是当团队需要偏离 Maven 标准时，他们会发现自己在使用 groovy、gradle，并且缺乏可靠的文档将变得令人沮丧。

Ant + Ivy 启动项目需要更长的时间，但如果团队有构建/集成经验，他们可以根据他们开发和发布代码的方式定制构建系统。

在工程...技术公司中，我总是推动露营地解决方案而不是度假村。

令人惊奇的是，Ant 和 Maven 都选择 XML 作为他们的语言来表达构建配方。Java 社区被困在那个 XML 上......

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2010-01-18T10:02:15.140

我认为这篇博文完全涵盖了 OP 正在寻找的内容：

[为什么你应该使用 Maven Ant Tasks 而不是 Maven 或 Ivy](http://ptrthomas.wordpress.com/2009/03/08/why-you-should-use-the-maven-ant-tasks-instead-of-maven-or-ivy/)

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2010-05-03T21:46:28.463

Ivy+Ant 更加灵活。Ivy 做依赖管理，周期，它做得非常好，比 Maven 更好。使用 Ant，您几乎可以组合任何您想要的构建系统。

Maven 试图控制一切——“生命周期”（编译、测试、打包等）、文件应该存在的位置等等。如果您不喜欢“Maven 方式”，请享受定制插件等的乐趣。

Maven 是对无人问及的问题的答案。编写 Ant 脚本并不难，而且 Ivy 提供了比 Maven 更好的依赖管理。我对之前的一些评论感到困惑，他们说他们无法让 Ivy 工作。Ivy 比 Maven 启动和运行要简单得多。

Spring 框架在其构建过程中使用 Ivy。我认为这可以看作是对 Ivy 投的信任票。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2009-03-01T01:50:09.670

如果您的长期目标是迁移到使用 Maven 来管理整个构建过程（可能打算为新的未开发项目执行此操作），那么我衷心推荐使用 Maven pom.xml 文件来代表 Ant build.xml 管理依赖项文件。最终结果是，您的新建项目和遗留项目都使用相同的机制来管理依赖项。事实证明，Maven 在管理 Ant build.xml 文件的依赖项方面确实比 Ivy 做得更好。

在采用 Maven 作为我们的旗舰构建工具之前，我有一个开发人员尝试将 Ivy 与现有的 Ant build.xml 文件结合使用。这是最令人沮丧的经历，很快我们就拒绝了常春藤。我们继续采用 Maven。我们的新建项目开始使用库存 Maven 方法等构建。

但是，我回到 Ant 遗留项目并开始使用 Maven Ant 任务来定义类路径定义（偶尔还会从 pom.xml 中提取其他 Ant 属性定义）。事实证明，这是一次最高级的体验。现有的 Ant build.xml 文件只需稍作修改，即可使用 Maven ant 集成来定义 build.xml 文件中使用的任何类路径。项目所需的所有依赖项都在随附的 pom.xml 文件中定义，该文件由 Maven 通过合并到 build.xml 文件中的 Ant 任务进行处理。

Maven 范围可用于微调类路径定义，以便可以建立适合编译、运行单元测试或打包等的类路径定义。此外，几乎任何在 pom.xml 文件中定义的元素都可以在 build.xml 文件中作为 Ant 属性进行引用。

实际上，对于 Maven 的 Ant 任务，Ivy 甚至没有存在的可行理由。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2012-01-26T17:59:25.797

将 Maven 与 ivy/ant 进行比较就像将智能手机与电报进行比较。

如果您想在构建基础架构中利用真正持久的效果，最好使用 Maven，因为它预测并抽象了每个软件项目或其他类似软件的项目面临的所有流程和任务。我参与了很多项目，如果你的项目变得更复杂、更多样化、更异构，你会更加称赞 Maven 项目配置的简单性。确实，与 ivy/ant 驱动的项目相比，它会变得复杂但并不复杂。

Maven 的主要优势是“约定优于配置”(http://en.wikipedia.org/wiki/Convention_over_configuration) 是一个非常重要的范例。简而言之，这意味着您不需要知道/配置明显/琐碎/常见的事情。尽管 Maven 及其所有插件附带许多默认设置，但您始终可以选择配置项目以满足您的特殊需求。使用 Maven，一方面您可以非常轻松快速地设置项目；另一方面，您可以毫不费力地根据您的需要定制一个不断增长的项目。如果您了解 Maven 背后的关键概念，您将利用每个项目以及非典型软件开发项目的项目。

过去，我写了很多 ant 脚本，随着即将推出的 Maven，我开始讨厌 ant。一个缺点是你总是复制脚本并重复自己，开发不重复任务的 ant 任务不重复不重复的任务......主要缺点是不断增长的 ant 脚本往往无法维护，尤其是如果十几个蚂蚁极客想要互相拉皮条的话。

许多蚂蚁爱好者都无法全面控制琐碎的事情，例如复制工件和打印构建消息。但是因为 Maven 的关键概念是隐藏这些琐碎的事情，所以 Maven 限制定制需求的传说将永远存在。不过别担心，那是传说！所以你终于明白了我最初的陈述：不要为已经解决的琐碎事情烦恼。

也许 ivy/ant 是简单项目的选择，但对于复杂的成长项目，您需要简单和约定。否则你会被越来越多的维护问题压得喘不过气来。尤其是如果您在一个全球项目中有许多依赖项目、技术和异构产品部分，那么您就没有时间和金钱来开发和测试 ant 脚本或解决依赖问题。

应该提到另一个建议：Ant 提供了 Maven 的集成。这种集成通常用于在与 ant 一起成长的项目中测试和使用 maven。避免这种愚蠢的方法，因为它会产生更多问题。而是留在蚂蚁和它的痛苦中，或者完全迁移到 Maven。

如果您对迁移成本有疑问，我建议您使用相反的方式通过 Maven-Ant-Plugin 集成不同的世界。使用这个标准插件，您可以毫不费力地运行每个 ant 脚本。当然，它在一段时间内是一个遗留解决方案，但它给了你尽可能多的时间来理解你的前任的巨大扭曲的未注释的 ant 脚本。

现在您将称赞 maven 的下一个优势：您需要的配置文档非常少，因为文档是您要使用的每个 maven-plugin 的一部分。

所以我承认我是一个 Maven 对抗者。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-11-25T21:02:49.193

我知道 Ivy 的一个优点是它可以使用不同类型的存储库。Maven 通常在它将使用的存储库格式方面非常严格。这是我知道的全部。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2010-04-09T21:13:13.990

我刚刚花了 2 天时间阅读 Ivy 文档，我不得不说，如果您有任何选择，请使用 MAVEN。据我所知，常春藤完全是垃圾。我只是浪费了 2 天时间试图将它整合到我的构建中，现在正在减少我的损失。为什么？

*   常春藤是依赖管理的半途而废的尝试
*   常春藤文档完全是个笑话
*   ivy例子和教程没用

一旦我介绍了“配置”（读作 maven 配置文件），Ivy 就开始疯狂下载我不需要的各种垃圾，然后失败了。Ivy 的文档完全是个笑话。相比之下，Maven 文档读起来就像做梦一样。如果你想要一个例子来说明 Ivy 文档是多么难以理解和写得多么糟糕，请查看[配置](http://ant.apache.org/ivy/history/latest-milestone/ivyfile/configurations.html)的参考页面。这些是任何构建的重要组成部分，但在 Ivy 中，它们似乎是经过深思熟虑后设计的。

# tsql - 在 SQL 2008 中使用变量返回多条记录

> ID：318807
> 
> 赞同：1
> 
> 时间：2008-11-25T20:50:34.740
> 
> 标签：tsql, sql-server-2008, geography

我很确定这不是正确的方法，所以我正在寻找一些建议。

我不认为我的问题是我试图解决空间问题。我只是不确定在选择语句中获取纬度和经度并返回地理数据类型的好方法。我已经成功创建了一个地理列并输入了数据。

```
Use thedatabase;
GO
Declare @Lat numeric(11,6)
Declare @Long numeric(11,6)
DECLARE @g geometry;

Select @Lat = Latitude, @Long = Longitude
from dbo.thetable

set @g = geometry::STGeomFromText('POINT (' + Cast(@Lat as varchar(30)) + ' ' + CAST(@Long as varchar(30)) + ')', 0);

select @g 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-28T09:03:42.933

你能澄清你想做什么吗？

如果问题与使用文本有关 - 据我了解，WKT 格式在这里很正常，所以不是问题。

如果要返回多个几何值，例如：

```
SELECT geometry::STGeomFromText('POINT (' + CAST(Latitude as varchar(30))
     + ' ' + CAST(Longitude as varchar(30)) + ')', 0)
FROM dbo.thetable 
```

如果您想使用多个几何图形，请声明一个表变量并插入此类查询的结果：

```
DECLARE @data TABLE (location geometry)
INSERT @data (location)
SELECT geometry::STGeomFromText('POINT (' + CAST(Latitude as varchar(30))
     + ' ' + CAST(Longitude as varchar(30)) + ')', 0)
FROM dbo.thetable 
```

并使用@data 作为一组数据

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-01T13:22:55.093

几何类型应仅用于投影数据。由于您已经有未投影的纬度/经度数据，您应该改用地理类型。此外，还有一种创建点的静态方法：

```
SELECT geography::Point(t.lat, t.lon, 0) FROM yourtable t 
```

# javascript - SAJAX 和表单字段

> ID：318808
> 
> 赞同：0
> 
> 时间：2008-11-25T20:50:41.807
> 
> 标签：javascript, ajax, mediawiki, sajax

有没有办法通过 sajax 函数调用发送整个表单的字段？我认为无论如何都是sajax。

我们正在使用 Mediawiki，函数调用是“sajax_do_call(funcName,[params],callbackFuncName)”

我只是想知道是否有办法将所有字段从表单中删除到参数中？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-11-27T18:54:04.880

不幸的是，我对 Mediawiki 了解不多，但如果您可以将 JQuery 添加到您的页面，那么只需：

var myParams = $("form").serializeArray();

...将获取所有表单值并为您创建参数数组。

要添加 JQuery，您可以下载 JQuery 核心并通过 <script> 标签将其包含在您的页面中，也可以通过 Google 托管副本包含它：

<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.2.6/jquery.min.js"></script>

# asp.net - web.config 中的多个/不同身份验证设置

> ID：318816
> 
> 赞同：14
> 
> 时间：2008-11-25T20:54:02.720
> 
> 标签：asp.net, authentication, web-config, location

我将如何为我的网络应用程序的不同部分设置不同的身份验证标签？说我有：

```
/
/folder1/
/folder2/ 
```

是否可以`<authentication/>`为每个文件夹指定不同的标签？

我希望 folder1 使用 Windows 身份验证，但 folder2 使用 Forms 身份验证。

我尝试在`<location/>`标签中进行操作，但看起来您不能在`<authentication/>`标签中添加`<location/>`标签，至少不能通过内置网络服务器的 VS 2008。

这个错误说 - 错误 3 在应用程序级别之外使用注册为 allowDefinition='MachineToApplication' 的部分是错误的。此错误可能是由未在 IIS 中配置为应用程序的虚拟目录引起的。

```
<location path="/folder1">
    <system.web>
      <authentication mode="Forms" />
      <authorization>
        <deny users="?"/>
      </authorization>
    </system.web>
  </location> 
```

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-11-26T10:36:43.387

你只能`<authentication />`在顶层拥有`web.config`。您可能必须创建多个应用程序。即您可以在一个应用程序中创建一个应用程序，并在每个应用程序中使用不同的身份验证模式。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-25T21:57:13.280

我认为您可以将 folder1 上的表单身份验证授权设置为

```
<allow users="*" /> 
```

然后通过在文件夹上设置 Windows 权限来控制 Windows 访问。

我还没有尝试过，但我想不出为什么那行不通。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-26T10:34:06.467

这些设置仅在 ASP.Net 应用程序的根级别有效。要在子文件夹中使用不同的设置，您需要进入 IIS 并将该子文件夹设置为新应用程序。

完成此操作后，该文件夹将在 IIs 管理器中具有不同的图标。在您的子文件夹中，创建一个新的 web.config 文件并在其中添加新的身份验证设置。

更多信息可在[创建应用程序](http://www.microsoft.com/technet/prodtechnol/WindowsServer2003/Library/IIS/1d1c9a73-b4c5-4cfb-ad69-b77fa2e17e19.mspx?mfr=true)中找到。

# java - Swing LayoutManagers 是否足够？

> ID：318818
> 
> 赞同：4
> 
> 时间：2008-11-25T20:54:30.100
> 
> 标签：java, swing, layout

我只需要在我到达这里之前编写的应用程序中添加一个复选框，这比它必须的要困难得多，因为该应用程序使用了一些第三方 LayoutManager 来尝试进行伪绝对的、类似网格的定位。API 很糟糕，它需要位置指定字符串，这些字符串是逗号分隔的两个、四个或六个参数列表（我仍然不知道为什么会有所不同），我宁愿让 LayoutManager 处理很多这样无论如何，繁重的工作。我一直觉得让 Swing 自己定位事物会导致比我能产生的任何东西更好的组织。我对 CGI 应用程序也有同样的感觉，除了偶尔将复选框或单选框与表格分组之外，我几乎只是让浏览器按照用户想要的方式流动和包装。

Swing 中包含的 LayoutManager 实现是否足够，或者是否真的有必要结合这种绝对控制来强制布局完全符合您的要求（并为您提供一百万个更多的决定）？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-25T21:00:11.523

这种情况正在好转很多。我想说三种最常见的非标准布局管理器是：

*   JGoodies 表单布局
*   表格布局
*   MigLayout

最后两个非常相似，但 MigLayout 出现得稍晚一些，将来会成为 JDK 的一部分。我想说这三个中的任何一个都有足够的“标准”来相当舒适地使用，但是 MigLayout 现在很可能会胜出，因为它是 Swing 本身的一部分。

所以目前，我会说不。一旦 MigLayout 在 JDK 中，是的。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-25T22:34:48.820

个人认为，Java 布局管理概念是自切片面包以来最酷的东西；对于可调整大小的窗口至关重要 - 只需查看 Windows 中所有不可调整大小的窗口，就表明拥有抽象布局管理器是个好主意。

也就是说，Java 中的布局管理器已经*足够*了，但是需要大量的嵌套才能到达您需要的位置。这种嵌套使改变事情变得很麻烦。将 BoxLayout 和 BorderLayout 视为您的主要内容；仅将 GridBagLayout 用作最后的手段。

您最好的选择是合并一个体面的面向表格的布局，以尽量减少嵌套；其他人已经提出了几个，所以我不会重复。我[推出了自己的](http://www.softwaremonkey.org/Code/MatrixLayout)，因为我想要基于字符串的约束和很小的占用空间，但除此之外，我对 TableLayout 很感兴趣；如果分发大小不是问题，您绝对必须查看 jGoodies 提供的小部件和布局（我认为是免费的，但可能仅用于非商业用途？？）

我通常对窗口使用表格布局，并且最终只嵌套有时并且通常只有一层深度用于运行相关组件，例如三个框用于电话号码，由两个标签隔开，用于中间的破折号。我发现我的窗户是高度可维护的，并且很容易添加和更改它们。

PS：避免任何像瘟疫一样的绝对定位

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-25T20:59:50.430

Swing 的布局管理器通常足以完成您想做的任何事情。在“最糟糕”的情况下，您将不得不使用完整的 GridBagLayout 并使用坐标自行定位每个组件。从您的问题来看，听起来您的公司已经通过允许您使用一些奇怪的输入方案添加组件来编写封面。我通常建议不要创建新的布局管理器，除非你能真正解释没有一个内置管理器可以做你需要做的事情，也不能轻松地加入它们来做你需要做的事情。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-11-25T21:01:13.003

根据我的经验，它们足以让您准备好做一些嵌套（在某些情况下很多嵌套！）

无论哪种方式，我总是发现布局管理器比它们的价值更麻烦。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-26T19:12:05.717

根据您的描述，您可能正在使用 TableLayout。如果是这样，我发现它在很多方面都优于标准布局管理器。如果是 TableLayout，请尝试阅读文档，然后您就会明白为什么有时会有不同数量的定位参数。TableLayout 还允许您以不同的方式设置这些参数，而无需使用字符串。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-25T21:00:18.027

我从来都不是 Swing 布局管理器的忠实粉丝，但我是在完成了很多 Motif 之后才来到 Swing 的。我不确定它是什么，但在我看来，Swing 似乎没有能力让嵌套在低处的东西“推出”并迫使高于它的东西大到足以容纳它们。另外，我是 XmForm 的忠实粉丝，在 Swing 中没有什么比这更好的了。

也就是说，在 Swing 中 90% 的时间我都使用一堆嵌套的盒子——通常是垂直盒子中的水平盒子中的垂直盒子。有时我需要更多的控制，我完成了 GridBagLayout 的手册，不寒而栗。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-02T06:42:12.503

除了上面提到的 3 个 3rd 方布局管理器之外，您可能还想尝试一下 DesignGridLayout，它虽然不如 MigLayout 强大，但更容易使用，并且很难设计糟糕的表单。

免责声明：我是 DesignGridLayout 的作者之一，但我真的相信这是一个很好的 LayoutManager 与 Swing 默认布局相比，还有其他 3rd-party 布局有点太复杂而无法开始。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-06T10:32:26.450

我一直认为 GridBagLayout 是一个非常强大的 LayoutManager。不幸的是，掌握它的学习曲线可能有点太陡了。我的第一份工作不允许我们使用任何 GUI 构建器，所以所有的 GUI 代码都是手写的。我一直觉得这是学习 GridBagLayout 最好的方法，让你自己动手。如今，我又老又懒，主要使用 NetBeans，但我仍然从未觉得需要考虑其他 LayoutManager，因为 GridBagLayout 可以做任何事情。

对我来说，网格也是布局事物的好方法。以这种方式组织布局并根据行和列来考虑它是有意义的。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-01-06T10:47:02.507

我已经有几年没有做过任何 Swing 工作了，但是布局管理器是我在尝试编写网页时最想念的东西之一。我们对 GridBagLayout 做了很多工作，特别是对于更复杂的对话框，一旦掌握了就相对容易使用 - 在*编写*屏幕时。必须修改 GUI 时总是会感到痛苦，而表面上看起来很简单的事情却需要花费大量时间才能完成。

我被介绍给[Abeille](https://abeille.dev.java.net/)，这是一个 GUI 表单设计工具，虽然并不完美，但它可以让您在几分钟内构建出具有专业外观效果的屏幕，尤其是在将它与 JGoodies 结合使用时。它包括一个代码生成器或将输出为二进制格式（我认为它稍后包括 XML），这是我的首选。“构建”屏幕的代码如下所示：

```
FormPanel panel = new FormPanel( "myDialog.jfrm" );
add(panel); 
```

您可以连接到表单上的控件以供操作侦听器使用，并且在使用 MVC 模式时会产生一些非常干净的视图代码。最大的好处是进行更改时，因为表单可以加载到编辑器中，快速进行更改并保存，而无需更改代码。

（我与Abeille没有任何关系，只是一个大粉丝）

# javascript - 通过 JavaScript 获取页面/iframe 的编码

> ID：318831
> 
> 赞同：18
> 
> 时间：2008-11-25T20:57:55.740
> 
> 标签：javascript, encoding

我想通过 JavaScript 或浏览器中的其他 API 以编程方式确定页面的编码。我想要这些信息的原因是因为我试图模糊主要浏览器支持的字符编码，显然仅仅因为我发送了适当的“Content-Type”并不意味着浏览器会对编码做正确的事情. 欢迎使用任何其他可能的方法，但我宁愿不要单击“页面信息”以获取 50 多个字符编码。

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2008-11-26T02:24:42.990

Javascript 只能报告一些正在发生的事情。大多数浏览器不会向您公开足够有用的设置，以供您进行任何核心测试。

诸如`document.inputEncoding`、`document.characterSet`（非 IE）`document.charset`、 和`document.defaultCharset`（IE）之类的东西可能会让您有所帮助。但这些可能与实际支持一样不稳定。也就是说，如果浏览器“认为”它支持编码但实际上不支持，这难道不是您想知道的吗？

我认为你最好的选择是设置一个动态测试页面，上面有一些相当困难的字符（或一个非常大的测试集），在浏览器中进行负载测试，让浏览器返回浏览器 ID 字符串、编码设置、原始编码请求，`testElement.innerHTML`然后您可以根据预期结果验证其内容。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2017-02-06T16:18:24.703

原来的答案现在已经很老了，对的支持`document.characterSet`有了很大的提高。

```
>>> document.characterSet 
```

即 11：

```
"utf-8" 
```

Firefox 52、Chrome 55 和 Android 上的 Chrome、Safari 10：

```
"UTF-8" 
```

因此，对于大多数目的，您似乎可以依靠此信息来解决不同的情况。就我而言，收集此信息以进行跟踪很有用。

# c++ - 您是否将信息添加到每个 .hpp/.cpp 文件的顶部？

> ID：318835
> 
> 赞同：6
> 
> 时间：2008-11-25T20:59:33.660
> 
> 标签：c++, coding-style

创建新的 C++ 头文件/源文件时，您在顶部添加了哪些信息？例如，您是否添加了日期、您的姓名、文件描述等？您对这些信息使用结构化格式吗？

例如

```
// Foo.cpp - Implementation of the Foo class
// Date: 2008-25-11
// Created by: John Smith 
```

我认识的一个团队将 CVS 提交消息嵌入到每个文件的底部，但我不确定我是否想走这么远......

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-11-25T21:11:31.920

有关谁创建了文件、何时、谁编辑以及何时编辑文件的信息都在源代码管理中。如果您的团队在签入评论方面有良好的做法，那么您也会知道每次更改的原因。不需要对那些东西发表评论。

我认为这是 100% 合法的 - 明智的，甚至 - 只要有必要，放置一个注释块，解释类/模块的目的。当下一个人去更改它时，他们会更好地了解整体愿景以及此文件是否适合他们进行更改。

一些商店将版权声明和其他法​​律文件夹放在源文件注释中。这让我觉得很傻——如果您的（非 OSS）源代码在您不知情或未经许可的情况下将其放到了其他人的服务器上，那么版权声明可能不会阻止他们对它做任何事情。伊纳尔，YMMV。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-25T21:04:46.473

不。大多数东西都可以在需要时从版本控制系统中检索，因此添加是多余的。这将为您留下文件内容的描述，但大多数时候这是类文档的一部分（或至少是特定类型的文档）。

我不做任何这些，但话又说回来，我不喜欢这种笨拙的东西。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-25T21:04:49.173

我包括文件名、文件用途的简要描述以及用于 CVS 或 Subversion 目的的 $Id$ 标记。可以通过检查存储库找到文件创建者和创建日期，因此不需要。

包含文件名是因为根据您用于编辑文件的内容，在您编辑文件时可能并不完全清楚。该描述可用于确定某段代码是否属于该文件，或者是否应将其移至另一个。当然，$Id$ 会为您提供最后的更改时间和最后的编辑器。

嵌入签入消息仅在消息有用时才有用，并且仅在文件偶尔更新时才有用。包含每条消息只会使文件膨胀到描述更改的注释多于实际代码的程度。最好也将其留给存储库；通常它只是一个简短的命令行来获取文件的签入日志。

如果您的版本控制系统无法保留移动和副本的历史记录，那么您只需参考原始文件及其版本号即可。当然，如果您使用的系统是在本世纪而不是上世纪的某个时间创建的，那应该不是问题。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-25T21:05:20.483

我们需要将版权信息放在每个文件的顶部。我认为日期、作者和文件名是浪费时间。

我们还让我们的源代码控制系统在每个文件的***底部附加签入注释。***我最初讨厌更改日志，但随着时间的推移，我学会了喜欢它。合并更改时确实很有帮助。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-11-25T22:25:37.247

最初在这里回答，但后来被删除：[134249](https://stackoverflow.com/questions/134188/what-to-write-in-the-header-comments-of-a-code-file#134249)

我只会说两件事：

*   许可/版权信息
*   文档生成工具所需的注释（即，注释必须在标题中才能工作 - 否则，它们应该放在定义文件中）

其他任何东西都是不必要的绒毛，不会被维护，最终会变得比没有更糟糕。

当时我在一家大型国防公司工作，我们有严格的编码标准。如果你按照他们的要求（而大多数人没有），你的大部分标题将主要由那些毫无意义的绒毛组成。更糟糕的是，完全相同的绒毛也需要放在源文件中，这意味着绒毛的两个副本会过时并变得具有误导性。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-11-26T03:07:52.200

我曾经喜欢将版本控制关键字放在文件头中。但从那痛苦中恢复过来。:) 有两个原因：

1.  没有人在其中发表任何有用的评论。您总是会查看版本控制系统报告的差异。
2.  它会在尝试区分大型文件集时造成一场噩梦，因为关键字会产生差异，而这些差异是文件中唯一的差异。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-25T21:02:40.457

我没有嵌入日期，因为它是多余的。如果有人想知道文件的创建日期，不要相信作者，相信你的源代码控制系统。它应该是创建日期的明确答案。

不过，我绝对不反对在消息中嵌入检查。这些非常有用。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-11-25T21:06:43.163

如果您使用[CVS](http://www.nongnu.org/cvs/)，请查看它的[关键字替换](http://ximbiot.com/cvs/manual/cvs-1.11.21/cvs_12.html)。它们将帮助自动嵌入该信息。

就我个人而言，我把它放在我所有源文件的顶部：

```
// $Id$ 
```

如果它们与特定的东西（文件、类、类型等）相关，我嵌入的其他信息性注释将用[doxygen解析。](http://www.doxygen.nl/)

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-11-25T21:08:05.797

我们使用我们的 RCS 在文件上自动标记以下内容：

版权，

RCS 文件名，

修改日期，

最后更改的作者，

RCS 修订号

我觉得这很方便。我真的很喜欢在每个文件中自动填充文件名，因为它可以非常快速地搜索文件的解决方案。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-11-26T01:34:25.027

这是我通常放在文件顶部的内容：

```
///////////// Copyright © 2008 DesuraNET. All rights reserved. /////////////
//
//   Project     : [project name]
//   File        : [file name]
//   Description :
//      [TODO: Write the purpose of ... ]
//
//   Created On: 11/12/2008 2:24:07 PM
//   Created By: [name] <mailto:[email]>
//////////////////////////////////////////////////////////////////////////// 
```

我在vis中设置了一个宏来添加它并在我创建一个新文件时填写默认信息

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-11-25T21:38:13.070

我通常只在以下情况下添加任何“评论信息”...它。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-11-25T22:19:04.903

我通常会描述在该文件中找到的代码的用途。其他一切似乎都在其他地方处理：源代码控制中的日期和注释等。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-11-25T22:39:00.327

每个人都说您的源代码控制将包含日期和程序员信息，但并非总是如此。我在一家使用 Source Safe 的商店工作，在有人决定将文件移动到其他位置之前，这一切都很好。到那时，根据SS，它基本上变成了一个新文件，并且不存在以前的历史。

也许正因为如此，程序员的姓名和日期被自动添加到文件顶部的注释部分。当条目超过 10 个时，我们会去掉所有中间的条目，只留下原始日期和作者，以及当前信息。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-11-25T22:41:09.150

我的客户的版权声明；-)

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-11-26T02:23:16.660

我们使用 MSVC 和 VSS 并有一个插件，可以将您在签入时指定的任何注释添加到作为注释签入的文件中。查看 CPP 文件的顶部以找出进行更改的错误跟踪票号非常方便。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2008-11-26T04:09:31.797

我使用颠覆。这是我喜欢放在顶部附近的内容。

```
$Id$
$HeadURL$ 
```

这将替换修订版、最后一个编辑器，然后是存储库中文件的位置。虽然我总是从工作副本开始工作，但这让我可以打印/通过电子邮件发送文件并稍后查看它以确切了解它的来源。 `$HeadURL$`特别好，因为它告诉文件所在的项目和分支以及如何访问它（对于较大的嵌套子包等很好）。

同意大型手动注释块的无用——尽管推荐使用 docstrings/Javadocs——并同意自动附加提交日志。

听起来你们中的一些人正在使用糟糕的 VCS，如果您遇到由关键字本身产生的差异或合并冲突。 [Subversion 处理得很好。](http://wordaligned.org/articles/keyword-substitution-just-say-no#feedback-152)

# ruby - Ruby 中的私有模块方法

> ID：318850
> 
> 赞同：119
> 
> 时间：2008-11-25T21:01:48.743
> 
> 标签：ruby, private-methods, access-specifier

我有一个两部分的问题

**最佳实践**

*   我有一个算法，它使用公共接口对数据结构执行一些操作
*   它目前是一个具有许多静态方法的模块，除了一个公共接口方法外，都是私有的。
*   有一个实例变量需要在所有方法之间共享。

这些是我可以看到的选项，哪个是最好的？：

*   **具有静态（ruby 中的“模块”）方法的**模块****
***   **具有静态方法的**类*******   **用于包含在数据结构中的**Mixin模块*******   **重构**修改该数据结构（非常小）的算法部分，并使其成为调用算法模块的静态方法的混合******

 ******技术部分**

有什么方法可以制作**私有 Module 方法**吗？

```
module Thing
  def self.pub; puts "Public method"; end
  private
  def self.priv; puts "Private method"; end
end 
```

**`private`那里似乎没有任何效果，**我仍然可以`Thing.priv`毫无问题地打电话。

* * *

## 回答 #1

> 赞同：94
> 
> 时间：2009-01-08T15:11:19.257

我认为最好的方法（主要是现有库的编写方式）是通过在模块中创建一个处理所有逻辑的类，并且模块只是提供了一种方便的方法，例如

```
module GTranslate
  class Translator
    def perform(text)
      translate(text)
    end

    private

    def translate(text)
      # do some private stuff here
    end
  end

  def self.translate(text)
    t = Translator.new
    t.perform(text)
  end
end 
```

* * *

## 回答 #2

> 赞同：83
> 
> 时间：2009-01-06T21:48:51.953

还有`Module.private_class_method`，可以说表达了更多的意图。

```
module Foo
  def self.included(base)
    base.instance_eval do
      def method_name
        # ...
      end
      private_class_method :method_name
    end
  end
end 
```

对于问题中的代码：

```
module Thing
  def self.pub; puts "Public method"; end
  def self.priv; puts "Private method"; end
  private_class_method :priv
end 
```

Ruby 2.1 或更新版本：

```
module Thing
  def self.pub; puts "Public method"; end
  private_class_method def self.priv; puts "Private method"; end
end 
```

* * *

## 回答 #3

> 赞同：70
> 
> 时间：2016-01-26T11:15:32.800

```
module Writer
  class << self
    def output(s)
      puts upcase(s)
    end

    private

    def upcase(s)
      s.upcase
    end
  end
end

Writer.output "Hello World"
# -> HELLO WORLD

Writer.upcase "Hello World"
# -> so.rb:16:in `<main>': private method `upcase' called for Writer:Module (NoMethodError) 
```

* * *

## 回答 #4

> 赞同：29
> 
> 时间：2008-11-26T16:58:34.490

当一个模块混入时，你可以使用“包含”方法来做一些花哨的事情。这就是你想要的我认为：

```
module Foo
  def self.included(base)
    class << base 
      def public_method
        puts "public method"
      end
      def call_private
        private_method
      end
      private
      def private_method
        puts "private"
      end
    end
  end
end

class Bar
  include Foo
end

Bar.public_method

begin
  Bar.private_method
rescue
  puts "couldn't call private method"
end

Bar.call_private 
```

* * *

## 回答 #5

> 赞同：11
> 
> 时间：2008-11-25T21:15:25.440

不幸的是，`private`仅适用于实例方法。在类中获取私有“静态”方法的一般方法是执行以下操作：

```
class << self
  private

  def foo()
   ....
  end
end 
```

诚然，我没有在模块中这样做过。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2015-06-15T20:21:16.613

一个不错的方法是这样的

```
module MyModule
  class << self
    def public_method
      # you may call the private method here
      tmp = private_method
      :public
    end

    private def private_method
      :private
    end
  end
end

# calling from outside the module
puts MyModule::public_method 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2020-06-29T06:10:50.810

此方法不允许与私有方法共享数据，除非您通过方法参数显式传递数据。

```
module Thing
  extend self

  def pub
    puts priv(123)
  end

  private

  def priv(value)
    puts "Private method with value #{value}"
  end
end

Thing.pub
# "Private method with value 123"

Thing.priv
# NoMethodError (private method `priv' called for Thing:Module) 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2012-10-17T00:21:35.077

将方法存储为类变量/常量中的 lambda 是什么意思？

```
module MyModule
  @@my_secret_method = lambda {
    # ...
  }
  # ...
end 
```

测试：
**UPD：6 年后此代码的巨大更新**显示了声明私有方法的更简洁方式`d`

```
module A
  @@L = lambda{ "@@L" }
  def self.a ; @@L[] ; end
  def self.b ; a ; end

  class << self
    def c ; @@L[] ; end
    private
    def d ; @@L[] ; end
  end
  def self.e ; c ; end
  def self.f ; self.c ; end
  def self.g ; d ; end
  def self.h ; self.d ; end

  private
  def self.i ; @@L[] ; end
  class << self
    def j ; @@L[] ; end
  end

  public
  def self.k ; i ; end
  def self.l ; self.i ; end
  def self.m ; j ; end
  def self.n ; self.j ; end
end

for expr in %w{ A.a A.b A.c A.d A.e A.f A.g A.h A.i A.j A.k A.l A.m A.n }
  puts "#{expr} => #{begin ; eval expr ; rescue => e ; e ; end}"
end 
```

在这里我们看到：

```
A.a => @@L
A.b => @@L
A.c => @@L
A.d => private method `d' called for A:Module
A.e => @@L
A.f => @@L
A.g => @@L
A.h => private method `d' called for A:Module
A.i => @@L
A.j => @@L
A.k => @@L
A.l => @@L
A.m => @@L
A.n => @@L 
```

1)`@@L`不能从外部访问，但几乎可以从任何地方访问
2)`class << self ; private ; def`成功地使该方法`d`无法从外部和内部访问，`self.`但不能没有它——这很奇怪
3)`private ; self.`并且`private ; class << self`不要将方法设为私有——它们都可以访问有和没有`self.`

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2016-11-10T15:56:24.867

## 创建一个私有模块或类

常量永远不是私有的。但是，可以在不将其分配给常量的情况下创建模块或类。

因此，另一种方法`:private_class_method`是创建一个私有模块或类并在其上定义公共方法。

```
module PublicModule
  def self.do_stuff(input)
    @private_implementation.do_stuff(input)
  end

  @private_implementation = Module.new do
    def self.do_stuff(input)
      input.upcase # or call other methods on module
    end
  end
end 
```

用法：

```
PublicModule.do_stuff("whatever") # => "WHATEVER" 
```

请参阅[Module.new](https://ruby-doc.org/core-2.2.0/Module.html#method-c-new)和[Class.new](https://ruby-doc.org/core-2.2.0/Class.html#method-c-new)的文档。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2021-01-25T23:59:44.023

这是一个解决方案，您可以在单个模块中嵌套多个类，并能够通过使用以下方法调用可从任何嵌套类访问的模块上的私有方法`extend`：

```
module SomeModule

  class ClassThatDoesNotExtendTheModule
    class << self
      def random_class_method
        private_class_on_module
      end
    end
  end

  class ClassThatDoesExtendTheModule
    extend SomeModule

    class << self
      def random_class_method
        private_class_on_module
      end
    end
  end

  class AnotherClassThatDoesExtendTheModule
    extend SomeModule

    class << self
      def random_class_method
        private_class_on_module
      end
    end
  end

  private

  def private_class_on_module
    puts 'some private class was called'
  end

end 
```

一些输出显示解决方案的实际效果：

```
> SomeModule::ClassThatDoesNotExtendTheModule.random_class_method

NameError: undefined local variable or method `private_class_on_module' for SomeModule::ClassThatDoesNotExtendTheModule:Class

> SomeModule::ClassThatDoesExtendTheModule.random_class_method

some private class was called

> SomeModule::ClassThatDoesExtendTheModule.private_class_on_module

NoMethodError: private method `private_class_on_module' called for SomeModule::ClassThatDoesExtendTheModule:Class

> SomeModule::AnotherClassThatDoesExtendTheModule.random_class_method

some private class was called

> SomeModule::AnotherClassThatDoesExtendTheModule.random_class_method

NoMethodError: private method `private_class_on_module' called for SomeModule::AnotherClassThatDoesExtendTheModule:Class 
```

# ruby - #注入和缓慢

> ID：318854
> 
> 赞同：1
> 
> 时间：2008-11-25T21:03:55.947
> 
> 标签：ruby, functional-programming, performance, methods

我经常听到 Ruby 的注入方法被批评为“慢”。因为我更喜欢这个函数，并看到其他语言的等价物，所以我很好奇它是否仅仅是 Ruby 对缓慢的方法的**实现**，或者它本质上是一种缓慢的做事方式（例如，对于非小型集合应该避免)?

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-25T21:13:08.017

`inject`就像`fold`, 并且在其他语言中可能非常有效，`fold_left`特别是因为它是尾递归的。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-26T21:43:29.437

这主要是一个实现问题，但这让您对比较有一个很好的了解：

```
$ ruby -v
ruby 1.8.7 (2008-08-11 patchlevel 72) [i486-linux]
$ ruby exp/each_v_inject.rb 
Rehearsal -----------------------------------------------------
loop                0.000000   0.000000   0.000000 (  0.000178)
fixnums each        0.790000   0.280000   1.070000 (  1.078589)
fixnums each add    1.010000   0.290000   1.300000 (  1.297733)
Enumerable#inject   1.900000   0.430000   2.330000 (  2.330083)
-------------------------------------------- total: 4.700000sec

                        user     system      total        real
loop                0.000000   0.000000   0.000000 (  0.000178)
fixnums each        0.760000   0.300000   1.060000 (  1.079252)
fixnums each add    1.030000   0.280000   1.310000 (  1.305888)
Enumerable#inject   1.850000   0.490000   2.340000 (  2.340341) 
```

exp/each_v_inject.rb

```
require 'benchmark'

total = (ENV['TOTAL'] || 1_000).to_i
fixnums = Array.new(total) {|x| x}

Benchmark.bmbm do |x|
  x.report("loop") do
    total.times { }
  end

  x.report("fixnums each") do
    total.times do |i|
      fixnums.each {|x| x}
    end
  end

  x.report("fixnums each add") do
    total.times do |i|
      v = 0
      fixnums.each {|x| v += x}
    end
  end    

  x.report("Enumerable#inject") do
    total.times do |i|
      fixnums.inject(0) {|a,x| a + x }
    end
  end  
end 
```

所以是的，它很慢，但随着实施的改进，它应该成为一个非问题。它正在做什么并没有什么固有的要求它变慢。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-06-18T13:55:50.180

`each_with_object``inject`如果您正在改变现有对象而不是在每个块中创建新对象，则可能比 更快。

# firefox - Firefox 中的表格行高

> ID：318871
> 
> 赞同：0
> 
> 时间：2008-11-25T21:07:37.903
> 
> 标签：firefox

由于当前限制让 DIV 标签在浏览器平台上针对我想要的特定流动布局正常工作，我选择使用表格和 DIV 的组合进行布局。话虽如此，仍然存在几个问题。

第一个问题是，在 Firefox 中，当使用高度为 100% 的表格时，我的页脚的表格行高的呈现方式与 IE 中的呈现方式不同。发生的情况是，在 Firefox 中，表格的页脚行的高度大于为表格行指定的高度。这反过来又会影响我的页脚布局。

这是页面的代码：

* * *

```
<html>

<head>

<meta NAME="DESCRIPTION" CONTENT="Cold Fusion Applications and Development">

<meta NAME="keywords" CONTENT="cold fusion, coldfusion, sql server, graphic design, houston, texas, tx, web developer, web development, e-commerce, survey, surveys, web applications, php, mysql, access, foxpro, sql, perl, shopping cart, web programming, macromedia, webmaster, html, cfml, xml, 77057, cfware, cfware.com, www.cfware.com, hosting, dhtml, dynamic html, web programmer, graphic designer, website, resume">

<link href="style.css" rel="stylesheet" type="text/css">

</head>
<!-- BODY -->
<body topmargin="0" bottommargin="0" rightmargin="0" leftmargin="0">
<!--TABLE I -->
<table class="fullheight" width="100%" height="100%" min-height="100%" border="1" align="center" cellpadding="0" cellspacing="0">
   <tr><td height="116" align="center" valign="top">
       <!-- HEADER -->
       <div class="header">
       <div class="lfc">Cornerstone</div>
       <div class="rfl"><img src="c4sqlogo.gif" width="295" height="68"></div>
       <div class="lf4">Foursquare</div>   
       </div>
       <div class="spacer"></div>
       <!-- HEADER END -->
       </td>
   </tr>
   <tr><td align="center" valign="center" bgcolor="#FFFFFF">  
             <!-- CONTENT -->
             <div class="content">

<table class="fullheight" width="100%" height="100%">
<tr>
<td></td>
<td></td>
<td></td>
</tr><tr>
<td></td>
<td align="center" valign="middle">
<h1 class="font-black">Cornerstone Foursquare Church</h1>
<br>
<h2>7791 Hillbarn Dr. Houston, TX 77040</h2>
<br>
<h2>(713) 856 - 7773</h2>
<br>
<br>
<h3>Service Times:<br>Sunday Morning Worship 10:30AM<br>Sunday Evening Bible Study 6:00PM
<br>Wednesday Evening Bible Study and Prayer 7:00PM</h3>
</td>
<td></td>
<tr>
<td></td>
<td></td>
<td></td>
</tr><tr>
</table>

             </div>
             <!-- CONTENT END -->
       </td>
   </tr>
   <tfoot height="28"><td height="28" align="center" valign="middle" bgcolor="#FFFFFF">
          <!-- FOOTER --> 
          <div class="clearspacer"><img src="1.gif" height="10" width="1"></div>
          <div class="footer"><div class="footertext"><a href="http://www.c4sq.org"> w w w . c 4 s q . o r g </a></div></div>
          <!-- FOOTER END -->
       </td>
   </tr>
</table>
<!-- TABLE I END -->
</body>
</html> 
```

* * *

这是样式表的代码：

```
html, body {
    font-family: Verdana, Arial, Helvetica, sans-serif;
    font-size: 11px;
        color: :#a02f1d;
        height: 100%;
        width: 100%;
}

a {
color: #ffffff;
text-decoration: none;
font-size: 12;
font-weight: 500;
}

.header {
color: #ff0000; 
margin: 0 auto;
width: 760px;
height: 116px;
background-image: url(stripe.gif);
background-repeat: repeat-x;
}

.fullheight {
height:100%;}

.lf4 {
float: left;
margin-top: 0px;
clear: left;
width: 240px;
margin-left: 190px;
color: #a02f1d;
font-size: 26px;
font-weight: semi-bold;
font-style: italic;
}

.lfc {
float: left;
margin-top: 8px;
margin-left: 20px;
color: #a02f1d;
font-size: 48px;
font-weight: semi-bold;
font-style: italic;
}

.rfl {
float: right;
margin-top: 24px;
margin-right: 20px;
clear: right;
}

.content {
margin: 0 auto;
width: 760px;
overflow: hidden;
color: :#a02f1d;
}

.spacer {
background-color:#a02f1d;
margin: 0 auto;
width: 760px;
height: 4px;
overflow: hidden;
}

.clearspacer {
background-color:#000000;
}

.footer {
color: #ffffff; 
background-color:#a02f1d;
margin: 0 auto;
width: 760px;
height: 30px;
clear: both;
}

.footertext {
color:#ffffff;
margin-top: 6px;
font-size: 12px;
} 
```

* * *

第二个问题与修改现有布局有关，以便有一个宽度为 760 像素的居中垂直区域以不同于周围视口的颜色阴影显示。主要的困难是，为了让我的页脚在两个浏览器中都贴在底部并随着视口调整大小，我不得不重新采用表格布局。然而，当前的策略是使用尽可能少的嵌套，以便从使用 DIV 的速度和清晰度中受益。我会选择使用 DIV 布局来排除 TABLE 布局，如果它不是为了让工作的粘性页脚与 DIV 液体布局一起工作显然目前无法解决的问题。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-25T21:23:20.120

我知道这完全不相关，但我建议您偶尔使用[w3c 验证器](http://validator.w3.org/#validate_by_input)来验证您的 HTML。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-25T21:44:54.927

几个建议：

添加一个 doctype - 如果使用正确的，您可以让 IE 进入标准模式而不是 quirks 模式[http://www.quirksmode.org/css/quirksmode.html](http://www.quirksmode.org/css/quirksmode.html)，因此 IE 和其他浏览器之间的行为将更加一致。

正如 K4emic 所建议的那样 - 验证您的标记。

添加一个 css 重置为零默认边距和填充，这是一个很好的起点[http://meyerweb.com/eric/thoughts/2007/05/01/reset-reloaded/](http://meyerweb.com/eric/thoughts/2007/05/01/reset-reloaded/)。

你会发现这些东西会让追踪布局错误变得容易得多。否则，你根本不知道从哪里开始，是你的css，你的html，浏览器的默认样式，IE的渲染模式……？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-25T21:54:26.607

正如其他响应者指出的那样，您首先必须确保您的文档格式正确。也就是说，它必须符合 DTD。我将指出一个容易发现的问题：

```
<tfoot height="28"><td height="28" align="center" valign="middle" bgcolor="#FFFFFF">
      <!-- FOOTER --> 
      <div class="clearspacer"><img src="1.gif" height="10" width="1"></div>
      <div class="footer"><div class="footertext"><a href="http://www.c4sq.org"> w w w . c 4 s q . o r g </a></div></div>
      <!-- FOOTER END -->
   </td>
</tr>
</table> 
```

在此代码段中，您可以看到您的

```
<tfoot> 
```

元素未闭合。它应该包含

```
<tr> 
```

但那是缺失的。

这些小错误可能会导致您所看到的不一致行为。在它们被纠正之后，如果您仍然遇到这种行为，那么您可以查看浏览器的差异。某些 HTML 编辑器（如 Frontpage 和 Dreamweaver）可以设置为输出符合 DTD 的代码并突出显示不符合的区域。我会推荐使用一个。

# xslt - 您可以在 xslt 测试属性中放置两个条件吗？

> ID：318875
> 
> 赞同：132
> 
> 时间：2008-11-25T21:09:26.247
> 
> 标签：xslt

这适用于 When 4 < 5 和 1 < 2 吗？

```
<xsl:when test="4 &lt; 5 AND 1 &lt; 2" >
<!-- do something -->
</xsl:when> 
```

* * *

## 回答 #1

> 赞同：220
> 
> 时间：2008-11-25T21:18:41.097

不完全是，AND 必须是小写的。

```
<xsl:when test="4 &lt; 5 and 1 &lt; 2">
<!-- do something -->
</xsl:when> 
```

* * *

## 回答 #2

> 赞同：34
> 
> 时间：2008-11-25T21:21:13.663

它确实必须包含在 <xsl:choose> 中，因为它是一个时间。并将“和”小写。

```
<xsl:choose>
   <xsl:when test="4 &lt; 5 and 1 &lt; 2" >
   <!-- do something -->
   </xsl:when>
   <xsl:otherwise>
   <!-- do something else -->
   </xsl:otherwise>
</xsl:choose> 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-11-25T21:18:04.093

来自[XML.com](http://www.xml.com/pub/a/2003/04/02/trxml.html)：

> 与 xsl:if 指令一样，xsl:when 元素可以在它们的开始标签和结束标签之间有更详细的内容——例如，文字结果元素、xsl:element 元素，甚至 xsl:if 和 xsl:choose 元素——添加到结果树。他们的测试表达式还可以使用 xsl:if 元素的测试属性可以使用的所有技巧和运算符，例如 and、or 和函数调用，以构建更复杂的布尔表达式。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2014-03-13T09:31:49.210

也许这对于 xslt 专业人士来说是一件轻而易举的事，但对于初学者/中级水平的我来说，这让我感到困惑。我想做完全相同的事情，但我必须测试来自 xml 而不是纯数字的响应时间值。在这个线程之后，我尝试了这个：

```
<xsl:when test="responsetime/@value &gt;= 5000 and responsetime/@value &lt;= 8999"> 
```

这产生了一个错误。这有效：

```
<xsl:when test="number(responsetime/@value) &gt;= 5000 and number(responsetime/@value) &lt;= 8999"> 
```

不过，我真的不明白为什么没有 number() 就不能工作。难道没有 number() 的值被视为一个字符串，你不能将数字与字符串进行比较？

无论如何，希望这可以节省很多人的搜索......

# version-control - tfs 数据库大小 - 版本控制

> ID：318876
> 
> 赞同：6
> 
> 时间：2008-11-25T21:09:33.827
> 
> 标签：version-control, tfs

我在单个服务器上安装了 TFS，但磁盘空间不足。（我们已经使用该实例大约 2 年了。）

查看 SQL Server 中的表，罪魁祸首似乎是 tbl_content 表，它为 70 GB。如果我对所有项目的整个源代码树进行获取，则只有大约 8 GB 的数据。

这只是文件的所有历史吗？历史似乎是 10:1 的比例……因为我认为增量会非常小。

鉴于 8 GB 的源（和 2 年的活动），有谁知道这是否是一个合理的大小？如果不是什么来“解决”这个问题？

谢谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-26T04:53:33.923

抱歉，我目前无法解决比率问题。对于短期修复，您可以检查数据库文件中是否有任何可以释放的空间。你可能已经有，但如果没有..

```
SELECT name ,size/128.0 - CAST(FILEPROPERTY(name, 'SpaceUsed') AS int)/128.0 AS AvailableSpaceInMB
FROM sys.database_files; 
```

如果上面的语句返回一些您想要恢复的空间，您可以查看一次性 DBCC SHRINKDATABASE 或 DBCC SHRINKFILE 以及调度例行 SQL 维护计划，其中可能包括对数据库进行碎片整理。

DBCC SHRINKDATABASE 和 DBCC SHRINKFILE 不是您应该定期执行的操作，因为 SQL Server 需要一些“交换”空间来移动内容以获得最佳性能。因此，两者都不应该作为您的长期解决方案，并且两者都可能导致 TFS 响应时间的一些明显的性能下降。

JB

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-30T03:56:59.060

即使系统上没有任何活动，您是否每天都看到数据增长？如果答案是肯定的，您是否将任何二进制文件存储在 8GB 源之外的某个地方？

我问的原因是，如果 TFS 无法计算增量或文件超过增量生成的大小，TFS 将复制整个二进制文件。我没有链接，但我的工作机器上有它，它描述了这种情况以及如何解决它，如果这是你的问题的原因。

# c# - 有没有一种简单的方法可以在不知道文件扩展名的情况下确定文件的类型？

> ID：318880
> 
> 赞同：7
> 
> 时间：2008-11-25T21:11:05.400
> 
> 标签：c#, .net, windows, file-extension, file-type

我有一个带有二进制列的表，它存储许多不同可能文件类型（PDF、BMP、JPEG、WAV、MP3、DOC、MPEG、AVI 等）的文件，但没有存储名称或类型的列原始文件。我有什么简单的方法来处理这些行并确定存储在二进制列中的每个文件的类型吗？最好是一个只读取文件头的实用程序，这样我就不必完全提取每个文件来确定它的类型。

**澄清**：我知道这里的方法只涉及读取每个文件的开头。我正在寻找一个很好的资源（又名链接），它可以为我做到这一点而不必大惊小怪。谢谢。

另外，**请仅在 Windows 上使用 C#/.NET**。我没有使用 Linux，也无法使用 Cygwin（在 Windows CE 上不起作用，还有其他原因）。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-25T21:31:13.690

您可以使用这些工具来查找文件格式。

文件分析器 [http://www.softpedia.com/get/Programming/Other-Programming-Files/File-Analyzer.shtml](http://www.softpedia.com/get/Programming/Other-Programming-Files/File-Analyzer.shtml)

什么格式 [http://www.jozy.nl/whatfmt.html](http://www.jozy.nl/whatfmt.html)

PE 文件格式分析器 [http://peid.has.it/](http://peid.has.it/)

本网站可能对您有所帮助。 [http://mark0.net/onlinetrid.aspx](http://mark0.net/onlinetrid.aspx)

注意：我已包含下载链接以确保您获得正确的工具名称和信息。

请在下载之前验证来源。

我过去使用过一个工具，我认为它是文件分析器，它会告诉你最接近的匹配。

快乐的工具。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-11-25T21:14:59.277

这不是一个完整的答案，但可以从“幻数”库开始。这会检查文件的前几个字节以确定“幻数”，并将其与已知的它们的列表进行比较。这（至少部分）是`file`Linux 系统上的命令如何工作的。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-11-25T21:28:56.130

其他人提出了类似的问题并发布了用于执行此操作的代码。您应该能够获取此处发布的内容，并对其稍作修改，以便从您的数据库中提取。

[https://stackoverflow.com/questions/58510](https://stackoverflow.com/questions/58510?sort=oldest)

除此之外，看起来有人编写了一个基于幻数的库来执行此操作，但是，该站点似乎需要注册，并且需要某种形式的备用访问才能下载此库。该文档无需注册即可免费获得，这可能会有所帮助。

[http://software.topcoder.com/catalog/c_component.jsp?comp=13249160&ver=2](http://software.topcoder.com/catalog/c_component.jsp?comp=13249160&ver=2)

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-11-25T21:14:59.310

我知道的最简单的方法是使用[文件](http://en.wikipedia.org/wiki/File_(Unix))命令，它也可以在带有[Cygwin](http://www.cygwin.com/)的 Windows 中使用。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-25T21:15:00.917

许多文件类型都有明确定义的文件头。您可以检查前几个字节以查看文件是如何开始的。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-25T21:15:53.380

最简单的方法是通过访问具有“文件”命令的 *nix（或 cygwin）系统：

```
$ file visitors.*
visitors.html: HTML document text
visitors.png:  PNG image data, 5360 x 2819, 8-bit colormap, non-interlaced 
```

您可以编写一个 C# 应用程序，将每个二进制列的前 X 个字节通过管道传输到文件命令（使用 - 作为文件名）

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-25T23:11:23.833

您需要使用一些 p/invoke 互操作代码从 Win32 API调用[SHGetFileInfo方法。](http://msdn.microsoft.com/en-us/library/bb762179(VS.85).aspx)这篇[文章](http://support.microsoft.com/kb/319350)也可能有所帮助。

# asp.net-mvc - .Net MVC 路由 Catchall 不起作用

> ID：318886
> 
> 赞同：16
> 
> 时间：2008-11-25T21:13:43.367
> 
> 标签：asp.net-mvc, routing

我似乎无法弄清楚这一点。我正在尝试使用 MVC Beta 并尝试实现一个包罗万象的路由，这样如果用户输入 mysite.com/blah 而不是 mysite.com/home/index 它将命中“错误”路由。

不幸的是，“默认”路线似乎总是先抓住“废话”。事实上，我能够到达“错误”路线的唯一路线是 blah/blah/blah/blah。

这是它应该工作的方式吗，因为我已经看到其他示例具有像这样设置的“默认”和“错误”路由，并且似乎如果他们要输入一个不存在的控制器会击中“错误”路线。

有什么我遗漏的（很可能）还是我只需要为每个控制器创建一个特定的路由？

我正在使用的代码：

```
 routes.MapRoute(
            "Default",                                              // Route name
            "{controller}/{action}/{id}",                           // URL with parameters
            new { controller = "Home", action = "Index", id = "" }  // Parameter defaults
        );

        routes.MapRoute(
            "Error",
            "{*catchall}",
            new { controller = "Base", action = "Error", id = "404" }
        ); 
```

谢谢你，杰夫

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-25T22:17:43.817

为了处理错误，我在我的一个项目中使用了 Application_Error 事件：

```
protected void Application_Error(object sender, EventArgs e)
{
    Exception exception = Server.GetLastError();
    HttpException httpException = exception as HttpException;
    if (httpException != null)
    {
        RouteData routeData = new RouteData();
        routeData.Values.Add("controller", "Error");
        routeData.Values.Add("action", "HttpError500");

            if (httpException.GetHttpCode() == 404)
            {
                routeData.Values["action"] = "HttpError404";
            }

        Server.ClearError();
        Response.Clear();
        IController errorController = new ErrorController();
        errorController.Execute(new RequestContext(new HttpContextWrapper(Context), routeData));
    }
} 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-11-25T23:18:33.037

您的第一条路线将捕获最多的 url，因为您有元素的默认值，您可以使用 Phil Haack 的路线调试器将其可视化，请参阅链接：

[路由调试器](http://haacked.com/archive/2008/03/13/url-routing-debugger.aspx "路由调试器")

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-25T22:08:05.707

MVC 路由按照它们输入的顺序进行检查。

Mysite/blah 将通过默认路由找到。控制器是废话，动作是索引。

当您输入 mysite/blah/blah/blah/blah 路由时，您给了它一个无法将默认路由映射到的路由，然后调用了您的包罗万象的路由。

对于其他示例，您是否注意到它们是否设置了一些错误过滤器？我很确定默认的 asp.net mvc 站点已经在页面上有一些错误处理属性。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-06-25T06:56:28.853

这在处理 MVC 包罗万象的问题时也有帮助：

```
routes.MapRoute(
    "Default",                                              // Route name
    "{controller}/{action}/{*id}",                          // URL with parameters
    new { controller = "Home", action = "Index", id = "" }  // Parameter defaults
); 
```

也就是说，在它说的地方`{id}`，将其更改为`{*id}`。这允许最终的 id 参数使用尽可能多的附加路径。默认规则接受这个：

/人/姓名/乔

但不是这个：

/产品/列表/排序/名称

第二个 URL 将抛出 404 而不对路由进行此修改。

# java - 没有 Java 的 J2ME 开发？

> ID：318887
> 
> 赞同：5
> 
> 时间：2008-11-25T21:13:54.910
> 
> 标签：java, java-me, jvm, functional-programming, jvm-languages

我正在第一次涉足 J2ME 世界。我更喜欢使用函数式语言进行开发。

Scala 曾经支持 CLDC，但不再维护。Bigloo似乎已经消失了。

解释器（例如 Jython）是不行的，因为 J2ME 应用程序必须很小（至少我的应用程序必须很小）。

我想知道任何能够使用另一种 JVM 语言来构建 J2ME 应用程序的人。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-08-11T09:46:36.203

如果你在 Symbian 上，你可以试试[Python for S60](http://opensource.nokia.com/projects/pythonfors60/)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-25T22:09:22.820

在 CLDC 之上运行不同的语言可能很酷，但这些设备通常在内存和 CPU 方面受到很大限制，这简直是不可能的。

期待[JavaFX](http://javafx.com/)为移动市场带来新风。对于现有的手机，您必须使用 Java ME。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-08-07T08:06:54.503

Java 是最广泛可用的运行时之一。因此，如果您的应用程序面向各种手机，您确实应该选择 Java ME。如果您针对特定品牌/型号，您可以有其他选择。例如，[Symbian OS](http://www.forum.nokia.com/I_Want_To/Develop_Mobile_Applications/Get_Started.xhtml#professional_developer)可以占用多个运行时，您可以使用开放的 C/C++ 等进行开发。检查链接。可能我回答这个问题迟了，你的项目已经在进行中。

# language-agnostic - 以编程方式解决“谁拥有斑马”？

> ID：318888
> 
> 赞同：129
> 
> 时间：2008-11-25T21:14:26.783
> 
> 标签：language-agnostic, logic, constraint-programming, zebra-puzzle

编辑：这个谜题也被称为“爱因斯坦之谜”

[谁拥有 Zebra](https://en.wikipedia.org/wiki/Zebra_Puzzle)（您可以在[此处尝试在线版本](https://www.brainzilla.com/logic/zebra/einsteins-riddle/ "爱因斯坦之谜")）是一组经典难题的示例，我敢打赌 Stack Overflow 上的大多数人都可以用笔和纸解决它。但是程序化解决方案会是什么样子？

根据下面列出的线索...

*   有五间房子。
*   每个房子都有自己独特的颜色。
*   所有房主都是不同国籍的。
*   他们都有不同的宠物。
*   他们都喝不同的饮料。
*   他们都抽不同的香烟。
*   英国人住在红房子里。
*   瑞典人有一条狗。
*   丹麦人喝茶。
*   绿房子在白房子的左边。
*   他们在温室里喝咖啡。
*   抽 Pall Mall 的人有鸟。
*   在黄色的房子里，他们抽登喜路。
*   在中间房子里，他们喝牛奶。
*   挪威人住在第一间房子里。
*   抽 Blend 的男人和猫一起住在房子旁边的房子里。
*   在他们有一匹马的房子旁边的房子里，他们抽登喜路。
*   抽蓝大师的人喝啤酒。
*   德国人抽王子烟。
*   挪威人住在蓝屋旁边。
*   他们在抽Blend的房子旁边的房子里喝水。

...谁拥有斑马？

* * *

## 回答 #1

> 赞同：164
> 
> 时间：2008-11-26T14:59:07.210

这是基于约束编程的Python解决方案：

```
from constraint import AllDifferentConstraint, InSetConstraint, Problem

# variables
colors        = "blue red green white yellow".split()
nationalities = "Norwegian German Dane Swede English".split()
pets          = "birds dog cats horse zebra".split()
drinks        = "tea coffee milk beer water".split()
cigarettes    = "Blend, Prince, Blue Master, Dunhill, Pall Mall".split(", ")

# There are five houses.
minn, maxn = 1, 5
problem = Problem()
# value of a variable is the number of a house with corresponding property
variables = colors + nationalities + pets + drinks + cigarettes
problem.addVariables(variables, range(minn, maxn+1))

# Each house has its own unique color.
# All house owners are of different nationalities.
# They all have different pets.
# They all drink different drinks.
# They all smoke different cigarettes.
for vars_ in (colors, nationalities, pets, drinks, cigarettes):
    problem.addConstraint(AllDifferentConstraint(), vars_)

# In the middle house they drink milk.
#NOTE: interpret "middle" in a numerical sense (not geometrical)
problem.addConstraint(InSetConstraint([(minn + maxn) // 2]), ["milk"])
# The Norwegian lives in the first house.
#NOTE: interpret "the first" as a house number
problem.addConstraint(InSetConstraint([minn]), ["Norwegian"])
# The green house is on the left side of the white house.
#XXX: what is "the left side"? (linear, circular, two sides, 2D house arrangment)
#NOTE: interpret it as 'green house number' + 1 == 'white house number'
problem.addConstraint(lambda a,b: a+1 == b, ["green", "white"])

def add_constraints(constraint, statements, variables=variables, problem=problem):
    for stmt in (line for line in statements if line.strip()):
        problem.addConstraint(constraint, [v for v in variables if v in stmt])

and_statements = """
They drink coffee in the green house.
The man who smokes Pall Mall has birds.
The English man lives in the red house.
The Dane drinks tea.
In the yellow house they smoke Dunhill.
The man who smokes Blue Master drinks beer.
The German smokes Prince.
The Swede has a dog.
""".split("\n")
add_constraints(lambda a,b: a == b, and_statements)

nextto_statements = """
The man who smokes Blend lives in the house next to the house with cats.
In the house next to the house where they have a horse, they smoke Dunhill.
The Norwegian lives next to the blue house.
They drink water in the house next to the house where they smoke Blend.
""".split("\n")
#XXX: what is "next to"? (linear, circular, two sides, 2D house arrangment)
add_constraints(lambda a,b: abs(a - b) == 1, nextto_statements)

def solve(variables=variables, problem=problem):
    from itertools  import groupby
    from operator   import itemgetter

    # find & print solutions
    for solution in problem.getSolutionIter():
        for key, group in groupby(sorted(solution.iteritems(), key=itemgetter(1)), key=itemgetter(1)):
            print key, 
            for v in sorted(dict(group).keys(), key=variables.index):
                print v.ljust(9),
            print

if __name__ == '__main__':
    solve() 
```

输出：

```
1 yellow    Norwegian cats      water     Dunhill  
2 blue      Dane      horse     tea       Blend    
3 red       English   birds     milk      Pall Mall
4 green     German    zebra     coffee    Prince   
5 white     Swede     dog       beer      Blue Master 
```

找到解决方案需要 0.6 秒（CPU 1.5GHz）。
答案是“德国人拥有斑马”。

* * *

通过以下方式安装[`constraint`模块](http://labix.org/python-constraint)`pip`： pip install python-constraint

手动安装：

*   下载：

    $ wget [https://pypi.python.org/packages/source/p/python-constraint/python-constraint-1.2.tar.bz2#md5=d58de49c85992493db53fcb59b9a0a45](https://pypi.python.org/packages/source/p/python-constraint/python-constraint-1.2.tar.bz2#md5=d58de49c85992493db53fcb59b9a0a45)

*   提取（Linux/Mac/BSD）：

    $ bzip2 -cd python-constraint-1.2.tar.bz2 | 焦油 xvf -

*   提取（Windows，带有[7zip](http://www.7-zip.org/)）：

    > 7z e python-constraint-1.2.tar.bz2
    > 7z e python-constraint-1.2.tar

*   安装：

    $ cd python-constraint-1.2
    $ python setup.py install

* * *

## 回答 #2

> 赞同：49
> 
> 时间：2011-11-25T14:19:20.113

在 Prolog 中，我们可以通过*从中*选择元素来实例化域:) （为了提高效率，做出*互斥的选择*）。使用 SWI-Prolog，

```
select([A|As],S):- select(A,S,S1),select(As,S1).
select([],_). 

left_of(A,B,C):- append(_,[A,B|_],C).  
next_to(A,B,C):- left_of(A,B,C) ; left_of(B,A,C).

zebra(Owns, HS):-     % (* house: color,nation,pet,drink,smokes *)
  HS   = [ h(_,norwegian,_,_,_),    h(blue,_,_,_,_),   h(_,_,_,milk,_), _, _], 
  select([ h(red,brit,_,_,_),       h(_,swede,dog,_,_), 
           h(_,dane,_,tea,_),       h(_,german,_,_,prince)], HS),
  select([ h(_,_,birds,_,pallmall), h(yellow,_,_,_,dunhill),
           h(_,_,_,beer,bluemaster)],                        HS), 
  left_of( h(green,_,_,coffee,_),   h(white,_,_,_,_),        HS),
  next_to( h(_,_,_,_,dunhill),      h(_,_,horse,_,_),        HS),
  next_to( h(_,_,_,_,blend),        h(_,_,cats, _,_),        HS),
  next_to( h(_,_,_,_,blend),        h(_,_,_,water,_),        HS),
  member(  h(_,Owns,zebra,_,_),                              HS). 
```

立即运行：

```
?- time( (zebra(Who,HS), writeln(Who), nl, maplist(writeln,HS), nl, false 
          ; writeln("no more solutions!") )).
german

h( yellow, norwegian, cats,   water,  dunhill   )
h( blue,   dane,      horse,  tea,    blend     )
h( red,    brit,      birds,  milk,   pallmall  )
h( green,  german,    zebra,  coffee, prince    )   % (* formatted by hand *)
h( white,  swede,     dog,    beer,   bluemaster)

no more solutions!
% (* 1,706 inferences, 0.000 CPU in 0.070 seconds (0% CPU, Infinite Lips) *)
true. 
```

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2008-11-25T21:45:57.437

一位发帖人已经提到 Prolog 是一种潜在的解决方案。这是真的，这是我会使用的解决方案。更一般地说，这对于自动推理系统来说是一个完美的问题。Prolog 是一种形成这样一个系统的逻辑编程语言（和相关的解释器）。[它基本上允许从使用一阶逻辑](http://en.wikipedia.org/wiki/First-order_logic)做出的陈述中得出事实结论。FOL 基本上是一种更高级的命题逻辑形式。如果您决定不想使用 Prolog，您可以使用您自己创建的类似系统，使用诸如[modus ponens](http://en.wikipedia.org/wiki/Modus_ponens)之类的技术来执行得出结论。

当然，你需要添加一些关于斑马的规则，因为它没有在任何地方提到......我相信你的意图是你可以找出其他 4 只宠物，从而推断最后一个是斑马？您需要添加规定斑马是宠物之一的规则，并且每个房子只能养一只宠物。将这种“常识”知识引入推理系统是将该技术用作真正的 AI 的主要障碍。有一些研究项目，例如 Cyc，试图通过蛮力提供这些常识。他们取得了相当多的成功。

* * *

## 回答 #4

> 赞同：15
> 
> 时间：2011-11-01T02:32:38.563

SWI-Prolog 兼容：

```
% NOTE - This may or may not be more efficent. A bit verbose, though.
left_side(L, R, [L, R, _, _, _]).
left_side(L, R, [_, L, R, _, _]).
left_side(L, R, [_, _, L, R, _]).
left_side(L, R, [_, _, _, L, R]).

next_to(X, Y, Street) :- left_side(X, Y, Street).
next_to(X, Y, Street) :- left_side(Y, X, Street).

m(X, Y) :- member(X, Y).

get_zebra(Street, Who) :- 
    Street = [[C1, N1, P1, D1, S1],
              [C2, N2, P2, D2, S2],
              [C3, N3, P3, D3, S3],
              [C4, N4, P4, D4, S4],
              [C5, N5, P5, D5, S5]],
    m([red, english, _, _, _], Street),
    m([_, swede, dog, _, _], Street),
    m([_, dane, _, tea, _], Street),
    left_side([green, _, _, _, _], [white, _, _, _, _], Street),
    m([green, _, _, coffee, _], Street),
    m([_, _, birds, _, pallmall], Street),
    m([yellow, _, _, _, dunhill], Street),
    D3 = milk,
    N1 = norwegian,
    next_to([_, _, _, _, blend], [_, _, cats, _, _], Street),
    next_to([_, _, horse, _, _], [_, _, _, _, dunhill], Street),
    m([_, _, _, beer, bluemaster], Street),
    m([_, german, _, _, prince], Street),
    next_to([_, norwegian, _, _, _], [blue, _, _, _, _], Street),
    next_to([_, _, _, water, _], [_, _, _, _, blend], Street),
    m([_, Who, zebra, _, _], Street). 
```

在口译员处：

```
?- get_zebra(Street, Who).
Street = ...
Who = german 
```

* * *

## 回答 #5

> 赞同：13
> 
> 时间：2008-11-25T21:45:50.587

这就是我的做法。首先，我会生成所有有序的 n 元组

```
(housenumber, color, nationality, pet, drink, smoke) 
```

其中 5^6 个，15625 个，易于管理。然后我会过滤掉简单的布尔条件。有十个，每个你希望过滤掉 8/25 的条件（1/25 的条件包含瑞典人和狗，16/25 包含非瑞典人和非狗） . 当然它们不是独立的，但是在过滤掉它们之后应该不会剩下很多了。

在那之后，你就有了一个很好的图形问题。创建一个图，每个节点代表剩余的 n 元组之一。如果两端在某个 n 元组位置包含重复项或违反任何“位置”约束（其中有五个），则向图形添加边。从那里你几乎到家了，在图中搜索一组独立的五个节点（没有一个节点通过边连接）。如果没有太多，您可能只是详尽地生成所有 5 元组的 n 元组，然后再次过滤它们。

这可能是代码高尔夫的不错选择。有人可能可以用haskell之类的东西在一行中解决它:)

**事后思考：**初始过滤器通过也可以消除位置约束中的信息。不多（1/25），但仍然很重要。

* * *

## 回答 #6

> 赞同：9
> 
> 时间：2014-06-09T04:06:13.837

另一个 Python 解决方案，这次使用 Python 的 PyKE（Python 知识引擎）。诚然，它比在@JFSebastian 的解决方案中使用 Python 的“约束”模块更冗长，但它为任何研究此类问题的原始知识引擎的人提供了一个有趣的比较。

**线索.kfb**

```
categories( POSITION, 1, 2, 3, 4, 5 )                                   # There are five houses.
categories( HOUSE_COLOR, blue, red, green, white, yellow )              # Each house has its own unique color.
categories( NATIONALITY, Norwegian, German, Dane, Swede, English )      # All house owners are of different nationalities.
categories( PET, birds, dog, cats, horse, zebra )                       # They all have different pets.
categories( DRINK, tea, coffee, milk, beer, water )                     # They all drink different drinks.
categories( SMOKE, Blend, Prince, 'Blue Master', Dunhill, 'Pall Mall' ) # They all smoke different cigarettes.

related( NATIONALITY, English, HOUSE_COLOR, red )    # The English man lives in the red house.
related( NATIONALITY, Swede, PET, dog )              # The Swede has a dog.
related( NATIONALITY, Dane, DRINK, tea )             # The Dane drinks tea.
left_of( HOUSE_COLOR, green, HOUSE_COLOR, white )    # The green house is on the left side of the white house.
related( DRINK, coffee, HOUSE_COLOR, green )         # They drink coffee in the green house.
related( SMOKE, 'Pall Mall', PET, birds )            # The man who smokes Pall Mall has birds.
related( SMOKE, Dunhill, HOUSE_COLOR, yellow )       # In the yellow house they smoke Dunhill.
related( POSITION, 3, DRINK, milk )                  # In the middle house they drink milk.
related( NATIONALITY, Norwegian, POSITION, 1 )       # The Norwegian lives in the first house.
next_to( SMOKE, Blend, PET, cats )                   # The man who smokes Blend lives in the house next to the house with cats.
next_to( SMOKE, Dunhill, PET, horse )                # In the house next to the house where they have a horse, they smoke Dunhill.
related( SMOKE, 'Blue Master', DRINK, beer )         # The man who smokes Blue Master drinks beer.
related( NATIONALITY, German, SMOKE, Prince )        # The German smokes Prince.
next_to( NATIONALITY, Norwegian, HOUSE_COLOR, blue ) # The Norwegian lives next to the blue house.
next_to( DRINK, water, SMOKE, Blend )                # They drink water in the house next to the house where they smoke Blend. 
```

**关系.krb**

```
#############
# Categories

# Foreach set of categories, assert each type
categories
    foreach
        clues.categories($category, $thing1, $thing2, $thing3, $thing4, $thing5)
    assert
        clues.is_category($category, $thing1)
        clues.is_category($category, $thing2)
        clues.is_category($category, $thing3)
        clues.is_category($category, $thing4)
        clues.is_category($category, $thing5)

#########################
# Inverse Relationships

# Foreach A=1, assert 1=A
inverse_relationship_positive
    foreach
        clues.related($category1, $thing1, $category2, $thing2)
    assert
        clues.related($category2, $thing2, $category1, $thing1)

# Foreach A!1, assert 1!A
inverse_relationship_negative
    foreach
        clues.not_related($category1, $thing1, $category2, $thing2)
    assert
        clues.not_related($category2, $thing2, $category1, $thing1)

# Foreach "A beside B", assert "B beside A"
inverse_relationship_beside
    foreach
        clues.next_to($category1, $thing1, $category2, $thing2)
    assert
        clues.next_to($category2, $thing2, $category1, $thing1)

###########################
# Transitive Relationships

# Foreach A=1 and 1=a, assert A=a
transitive_positive
    foreach
        clues.related($category1, $thing1, $category2, $thing2)
        clues.related($category2, $thing2, $category3, $thing3)

        check unique($thing1, $thing2, $thing3) \
          and unique($category1, $category2, $category3)
    assert
        clues.related($category1, $thing1, $category3, $thing3)

# Foreach A=1 and 1!a, assert A!a
transitive_negative
    foreach
        clues.related($category1, $thing1, $category2, $thing2)
        clues.not_related($category2, $thing2, $category3, $thing3)

        check unique($thing1, $thing2, $thing3) \
          and unique($category1, $category2, $category3)
    assert
        clues.not_related($category1, $thing1, $category3, $thing3)

##########################
# Exclusive Relationships

# Foreach A=1, assert A!2 and A!3 and A!4 and A!5
if_one_related_then_others_unrelated
    foreach
        clues.related($category, $thing, $category_other, $thing_other)
        check unique($category, $category_other)

        clues.is_category($category_other, $thing_not_other)
        check unique($thing, $thing_other, $thing_not_other)
    assert
        clues.not_related($category, $thing, $category_other, $thing_not_other)

# Foreach A!1 and A!2 and A!3 and A!4, assert A=5
if_four_unrelated_then_other_is_related
    foreach
        clues.not_related($category, $thing, $category_other, $thingA)
        clues.not_related($category, $thing, $category_other, $thingB)
        check unique($thingA, $thingB)

        clues.not_related($category, $thing, $category_other, $thingC)
        check unique($thingA, $thingB, $thingC)

        clues.not_related($category, $thing, $category_other, $thingD)
        check unique($thingA, $thingB, $thingC, $thingD)

        # Find the fifth variation of category_other.
        clues.is_category($category_other, $thingE)
        check unique($thingA, $thingB, $thingC, $thingD, $thingE)
    assert
        clues.related($category, $thing, $category_other, $thingE)

###################
# Neighbors: Basic

# Foreach "A left of 1", assert "A beside 1"
expanded_relationship_beside_left
    foreach
        clues.left_of($category1, $thing1, $category2, $thing2)
    assert
        clues.next_to($category1, $thing1, $category2, $thing2)

# Foreach "A beside 1", assert A!1
unrelated_to_beside
    foreach
        clues.next_to($category1, $thing1, $category2, $thing2)
        check unique($category1, $category2)
    assert
        clues.not_related($category1, $thing1, $category2, $thing2)

###################################
# Neighbors: Spatial Relationships

# Foreach "A beside B" and "A=(at-edge)", assert "B=(near-edge)"
check_next_to_either_edge
    foreach
        clues.related(POSITION, $position_known, $category, $thing)
        check is_edge($position_known)

        clues.next_to($category, $thing, $category_other, $thing_other)

        clues.is_category(POSITION, $position_other)
        check is_beside($position_known, $position_other)
    assert
        clues.related(POSITION, $position_other, $category_other, $thing_other)

# Foreach "A beside B" and "A!(near-edge)" and "B!(near-edge)", assert "A!(at-edge)"
check_too_close_to_edge
    foreach
        clues.next_to($category, $thing, $category_other, $thing_other)

        clues.is_category(POSITION, $position_edge)
        clues.is_category(POSITION, $position_near_edge)
        check is_edge($position_edge) and is_beside($position_edge, $position_near_edge)

        clues.not_related(POSITION, $position_near_edge, $category, $thing)
        clues.not_related(POSITION, $position_near_edge, $category_other, $thing_other)
    assert
        clues.not_related(POSITION, $position_edge, $category, $thing)

# Foreach "A beside B" and "A!(one-side)", assert "A=(other-side)"
check_next_to_with_other_side_impossible
    foreach
        clues.next_to($category, $thing, $category_other, $thing_other)

        clues.related(POSITION, $position_known, $category_other, $thing_other)
        check not is_edge($position_known)

        clues.not_related($category, $thing, POSITION, $position_one_side)
        check is_beside($position_known, $position_one_side)

        clues.is_category(POSITION, $position_other_side)
        check is_beside($position_known, $position_other_side) \
          and unique($position_known, $position_one_side, $position_other_side)
    assert
        clues.related($category, $thing, POSITION, $position_other_side)

# Foreach "A left of B"...
#   ... and "C=(position1)" and "D=(position2)" and "E=(position3)"
# ~> assert "A=(other-position)" and "B=(other-position)+1"
left_of_and_only_two_slots_remaining
    foreach
        clues.left_of($category_left, $thing_left, $category_right, $thing_right)

        clues.related($category_left, $thing_left_other1, POSITION, $position1)
        clues.related($category_left, $thing_left_other2, POSITION, $position2)
        clues.related($category_left, $thing_left_other3, POSITION, $position3)
        check unique($thing_left, $thing_left_other1, $thing_left_other2, $thing_left_other3)

        clues.related($category_right, $thing_right_other1, POSITION, $position1)
        clues.related($category_right, $thing_right_other2, POSITION, $position2)
        clues.related($category_right, $thing_right_other3, POSITION, $position3)
        check unique($thing_right, $thing_right_other1, $thing_right_other2, $thing_right_other3)

        clues.is_category(POSITION, $position4)
        clues.is_category(POSITION, $position5)

        check is_left_right($position4, $position5) \
          and unique($position1, $position2, $position3, $position4, $position5)
    assert
        clues.related(POSITION, $position4, $category_left, $thing_left)
        clues.related(POSITION, $position5, $category_right, $thing_right)

#########################

fc_extras

    def unique(*args):
        return len(args) == len(set(args))

    def is_edge(pos):
        return (pos == 1) or (pos == 5)

    def is_beside(pos1, pos2):
        diff = (pos1 - pos2)
        return (diff == 1) or (diff == -1)

    def is_left_right(pos_left, pos_right):
        return (pos_right - pos_left == 1) 
```

**driver.py**（实际上更大，但这是本质）

```
from pyke import knowledge_engine

engine = knowledge_engine.engine(__file__)
engine.activate('relations')

try:
    natl = engine.prove_1_goal('clues.related(PET, zebra, NATIONALITY, $nationality)')[0].get('nationality')
except Exception, e:
    natl = "Unknown"
print "== Who owns the zebra? %s ==" % natl 
```

**样本输出：**

```
$ python driver.py

== Who owns the zebra? German ==

#   Color    Nationality    Pet    Drink       Smoke    
=======================================================
1   yellow   Norwegian     cats    water    Dunhill     
2   blue     Dane          horse   tea      Blend       
3   red      English       birds   milk     Pall Mall   
4   green    German        zebra   coffee   Prince      
5   white    Swede         dog     beer     Blue Master 

Calculated in 1.19 seconds. 
```

来源：[https ://github.com/DreadPirateShawn/pyke-who-owns-zebra](https://github.com/DreadPirateShawn/pyke-who-owns-zebra)

* * *

## 回答 #7

> 赞同：8
> 
> 时间：2008-11-25T21:23:38.027

这是使用[NSolver的](http://www.cs.cityu.edu.hk/%7Ehwchun/nsolver/)[完整解决方案](http://web.archive.org/web/20060602230950/http://www.knowing.net/einstein_cs.txt)的摘录，发布在*[Einstein's Riddle in C# 中](http://www.knowing.net/index.php/2005/08/08/einsteins-riddle-in-c/)*：

```
// The green house's owner drinks coffee
Post(greenHouse.Eq(coffee));
// The person who smokes Pall Mall rears birds 
Post(pallMall.Eq(birds));
// The owner of the yellow house smokes Dunhill 
Post(yellowHouse.Eq(dunhill)); 
```

* * *

## 回答 #8

> 赞同：8
> 
> 时间：2013-11-20T17:16:52.947

这是 CLP(FD) 中的一个简单解决方案（另请参见[clpfd](/questions/tagged/clpfd "显示标记为“clpfd”的问题")）：

```
:- use_module(library(clpfd)).

solve(ZebraOwner) :-
    maplist( init_dom(1..5), 
        [[British,  Swedish,  Danish,  Norwegian, German],     % Nationalities
         [Red,      Green,    Blue,    White,     Yellow],     % Houses
         [Tea,      Coffee,   Milk,    Beer,      Water],      % Beverages
         [PallMall, Blend,    Prince,  Dunhill,   BlueMaster], % Cigarettes
         [Dog,      Birds,    Cats,    Horse,     Zebra]]),    % Pets
    British #= Red,        % Hint 1
    Swedish #= Dog,        % Hint 2
    Danish #= Tea,         % Hint 3
    Green #= White - 1 ,   % Hint 4
    Green #= Coffee,       % Hint 5
    PallMall #= Birds,     % Hint 6
    Yellow #= Dunhill,     % Hint 7
    Milk #= 3,             % Hint 8
    Norwegian #= 1,        % Hint 9
    neighbor(Blend, Cats),     % Hint 10
    neighbor(Horse, Dunhill),  % Hint 11
    BlueMaster #= Beer,        % Hint 12
    German #= Prince,          % Hint 13
    neighbor(Norwegian, Blue), % Hint 14
    neighbor(Blend, Water),    % Hint 15
    memberchk(Zebra-ZebraOwner, [British-british, Swedish-swedish, Danish-danish,
                                 Norwegian-norwegian, German-german]).

init_dom(R, L) :-
    all_distinct(L),
    L ins R.

neighbor(X, Y) :-
    (X #= (Y - 1)) #\/ (X #= (Y + 1)). 
```

运行它，产生：

> 3 ?-时间（求解（Z））。
> % 111,798 次推理，0.016 CPU 在 0.020 秒内（78% CPU，7166493 唇）
> Z = 德语。

* * *

## 回答 #9

> 赞同：7
> 
> 时间：2008-12-18T01:50:33.520

[在 PAIP（第 11 章）中，Norvig 使用嵌入在 Lisp 中的 Prolog 解决了斑马难题](http://books.google.com/books?hl=en&id=CmFlpuoPe1MC&printsec=frontcover&source=web&ots=t7eYBiIqU9&sig=NbM5q1JoBeItdoGjrjdTFsAfe6Y&sa=X&oi=book_result&resnum=3&ct=result#PPA373,M1)。

* * *

## 回答 #10

> 赞同：7
> 
> 时间：2015-09-12T20:14:13.473

## ES6 (Javascript) 解决方案

有很多[ES6 生成器](https://developer.mozilla.org/pl/docs/Web/JavaScript/Reference/Statements/function*)和一点点[lodash](http://lodash.com/docs)。你需要[Babel](https://babeljs.io/)来运行它。

```
var _ = require('lodash');

function canBe(house, criteria) {
    for (const key of Object.keys(criteria))
        if (house[key] && house[key] !== criteria[key])
            return false;
    return true;
}

function* thereShouldBe(criteria, street) {
    for (const i of _.range(street.length))
        yield* thereShouldBeAtIndex(criteria, i, street);
}

function* thereShouldBeAtIndex(criteria, index, street) {
    if (canBe(street[index], criteria)) {
        const newStreet = _.cloneDeep(street);
        newStreet[index] = _.assign({}, street[index], criteria);
        yield newStreet;
    }
}

function* leftOf(critA, critB, street) {
    for (const i of _.range(street.length - 1)) {
        if (canBe(street[i], critA) && canBe(street[i+1], critB)) {
            const newStreet = _.cloneDeep(street);
            newStreet[i  ] = _.assign({}, street[i  ], critA);
            newStreet[i+1] = _.assign({}, street[i+1], critB);
            yield newStreet;
        }
    }
}
function* nextTo(critA, critB, street) {
    yield* leftOf(critA, critB, street);
    yield* leftOf(critB, critA, street);
}

const street = [{}, {}, {}, {}, {}]; // five houses

// Btw: it turns out we don't need uniqueness constraint.

const constraints = [
    s => thereShouldBe({nation: 'English', color: 'red'}, s),
    s => thereShouldBe({nation: 'Swede', animal: 'dog'}, s),
    s => thereShouldBe({nation: 'Dane', drink: 'tea'}, s),
    s => leftOf({color: 'green'}, {color: 'white'}, s),
    s => thereShouldBe({drink: 'coffee', color: 'green'}, s),
    s => thereShouldBe({cigarettes: 'PallMall', animal: 'birds'}, s),
    s => thereShouldBe({color: 'yellow', cigarettes: 'Dunhill'}, s),
    s => thereShouldBeAtIndex({drink: 'milk'}, 2, s),
    s => thereShouldBeAtIndex({nation: 'Norwegian'}, 0, s),
    s => nextTo({cigarettes: 'Blend'}, {animal: 'cats'}, s),
    s => nextTo({animal: 'horse'}, {cigarettes: 'Dunhill'}, s),
    s => thereShouldBe({cigarettes: 'BlueMaster', drink: 'beer'}, s),
    s => thereShouldBe({nation: 'German', cigarettes: 'Prince'}, s),
    s => nextTo({nation: 'Norwegian'}, {color: 'blue'}, s),
    s => nextTo({drink: 'water'}, {cigarettes: 'Blend'}, s),

    s => thereShouldBe({animal: 'zebra'}, s), // should be somewhere
];

function* findSolution(remainingConstraints, street) {
    if (remainingConstraints.length === 0)
        yield street;
    else
        for (const newStreet of _.head(remainingConstraints)(street))
            yield* findSolution(_.tail(remainingConstraints), newStreet);
}

for (const streetSolution of findSolution(constraints, street)) {
    console.log(streetSolution);
} 
```

结果：

```
[ { color: 'yellow',
    cigarettes: 'Dunhill',
    nation: 'Norwegian',
    animal: 'cats',
    drink: 'water' },
  { nation: 'Dane',
    drink: 'tea',
    cigarettes: 'Blend',
    animal: 'horse',
    color: 'blue' },
  { nation: 'English',
    color: 'red',
    cigarettes: 'PallMall',
    animal: 'birds',
    drink: 'milk' },
  { color: 'green',
    drink: 'coffee',
    nation: 'German',
    cigarettes: 'Prince',
    animal: 'zebra' },
  { nation: 'Swede',
    animal: 'dog',
    color: 'white',
    cigarettes: 'BlueMaster',
    drink: 'beer' } ] 
```

运行时间对我来说大约是 2.5 秒，但是通过更改规则的顺序可以大大改善这一点。为了清楚起见，我决定保留原来的顺序。

谢谢，这是一个很酷的挑战！

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2009-01-09T21:07:50.340

这确实是一个约束解决问题。您可以通过类似逻辑编程的语言中的广义约束传播来做到这一点。我们有一个专门针对 ALE（属性逻辑引擎）系统中的斑马问题的演示：

[http://www.cs.toronto.edu/~gpenn/ale.html](http://www.cs.toronto.edu/~gpenn/ale.html)

这是简化斑马拼图的编码链接：

[http://www.cs.toronto.edu/~gpenn/ale/files/grammars/baby.pl](http://www.cs.toronto.edu/~gpenn/ale/files/grammars/baby.pl)

有效地做到这一点是另一回事。

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2017-02-12T05:35:38.130

以编程方式解决此类问题的最简单方法是对所有排列使用嵌套循环，并检查结果是否满足问题中的谓词。许多谓词可以从内部循环提升到外部循环，以显着降低计算复杂度，直到可以在合理的时间内计算出答案。

这是一个简单的 F# 解决方案，源自[F# Journal](http://www.ffconsultancy.com/products/fsharp_journal/)中的一篇文章：

```
let rec distribute y xs =
  match xs with
  | [] -> [[y]]
  | x::xs -> (y::x::xs)::[for xs in distribute y xs -> x::xs]

let rec permute xs =
  match xs with
  | [] | [_] as xs -> [xs]
  | x::xs -> List.collect (distribute x) (permute xs)

let find xs x = List.findIndex ((=) x) xs + 1

let eq xs x ys y = find xs x = find ys y

let nextTo xs x ys y = abs(find xs x - find ys y) = 1

let nations = ["British"; "Swedish"; "Danish"; "Norwegian"; "German"]

let houses = ["Red"; "Green"; "Blue"; "White"; "Yellow"]

let drinks = ["Milk"; "Coffee"; "Water"; "Beer"; "Tea"]

let smokes = ["Blend"; "Prince"; "Blue Master"; "Dunhill"; "Pall Mall"]

let pets = ["Dog"; "Cat"; "Zebra"; "Horse"; "Bird"]

[ for nations in permute nations do
    if find nations "Norwegian" = 1 then
      for houses in permute houses do
        if eq nations "British" houses "Red" &&
           find houses "Green" = find houses "White"-1 &&
           nextTo nations "Norwegian" houses "Blue" then
          for drinks in permute drinks do
            if eq nations "Danish" drinks "Tea" &&
               eq houses "Green" drinks "Coffee" &&
               3 = find drinks "Milk" then
              for smokes in permute smokes do
                if eq houses "Yellow" smokes "Dunhill" &&
                   eq smokes "Blue Master" drinks "Beer" &&
                   eq nations "German" smokes "Prince" &&
                   nextTo smokes "Blend" drinks "Water" then
                  for pets in permute pets do
                    if eq nations "Swedish" pets "Dog" &&
                       eq smokes "Pall Mall" pets "Bird" &&
                       nextTo pets "Cat" smokes "Blend" &&
                       nextTo pets "Horse" smokes "Dunhill" then
                      yield nations, houses, drinks, smokes, pets ] 
```

9ms内得到的输出为：

```
val it :
  (string list * string list * string list * string list * string list) list =
  [(["Norwegian"; "Danish"; "British"; "German"; "Swedish"],
    ["Yellow"; "Blue"; "Red"; "Green"; "White"],
    ["Water"; "Tea"; "Milk"; "Coffee"; "Beer"],
    ["Dunhill"; "Blend"; "Pall Mall"; "Prince"; "Blue Master"],
    ["Cat"; "Horse"; "Bird"; "Zebra"; "Dog"])] 
```

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2016-06-25T10:34:05.167

这是 Wikipedia 中定义的斑马拼图的 MiniZinc 解决方案：

```
include "globals.mzn";

% Zebra puzzle
int: nc = 5;

% Colors
int: red = 1;
int: green = 2;
int: ivory = 3;
int: yellow = 4;
int: blue = 5;
array[1..nc] of var 1..nc:color;
constraint alldifferent([color[i] | i in 1..nc]);

% Nationalities
int: eng = 1;
int: spa = 2;
int: ukr = 3;
int: nor = 4;
int: jap = 5;
array[1..nc] of var 1..nc:nationality;
constraint alldifferent([nationality[i] | i in 1..nc]);

% Pets
int: dog = 1;
int: snail = 2;
int: fox = 3;
int: horse = 4;
int: zebra = 5;
array[1..nc] of var 1..nc:pet;
constraint alldifferent([pet[i] | i in 1..nc]);

% Drinks
int: coffee = 1;
int: tea = 2;
int: milk = 3;
int: orange = 4;
int: water = 5;
array[1..nc] of var 1..nc:drink;
constraint alldifferent([drink[i] | i in 1..nc]);

% Smokes
int: oldgold = 1;
int: kools = 2;
int: chesterfields = 3;
int: luckystrike = 4;
int: parliaments = 5;
array[1..nc] of var 1..nc:smoke;
constraint alldifferent([smoke[i] | i in 1..nc]);

% The Englishman lives in the red house.
constraint forall ([nationality[i] == eng <-> color[i] == red | i in 1..nc]);

% The Spaniard owns the dog.
constraint forall ([nationality[i] == spa <-> pet[i] == dog | i in 1..nc]);

% Coffee is drunk in the green house.
constraint forall ([color[i] == green <-> drink[i] == coffee | i in 1..nc]);

% The Ukrainian drinks tea.
constraint forall ([nationality[i] == ukr <-> drink[i] == tea | i in 1..nc]);

% The green house is immediately to the right of the ivory house.
constraint forall ([color[i] == ivory -> if i<nc then color[i+1] == green else false endif | i in 1..nc]);

% The Old Gold smoker owns snails.
constraint forall ([smoke[i] == oldgold <-> pet[i] == snail | i in 1..nc]);

% Kools are smoked in the yellow house.
constraint forall ([smoke[i] == kools <-> color[i] == yellow | i in 1..nc]);

% Milk is drunk in the middle house.
constraint drink[3] == milk;

% The Norwegian lives in the first house.
constraint nationality[1] == nor;

% The man who smokes Chesterfields lives in the house next to the man with the fox.
constraint forall ([smoke[i] == chesterfields -> (if i>1 then pet[i-1] == fox else false endif \/ if i<nc then pet[i+1] == fox else false endif) | i in 1..nc]);

% Kools are smoked in the house next to the house where the horse is kept.
constraint forall ([smoke[i] == kools -> (if i>1 then pet[i-1] == horse else false endif \/ if i<nc then pet[i+1] == horse else false endif)| i in 1..nc]);

%The Lucky Strike smoker drinks orange juice.
constraint forall ([smoke[i] == luckystrike <-> drink[i] == orange | i in 1..nc]);

% The Japanese smokes Parliaments.
constraint forall ([nationality[i] == jap <-> smoke[i] == parliaments | i in 1..nc]);

% The Norwegian lives next to the blue house.
constraint forall ([color[i] == blue -> (if i > 1 then nationality[i-1] == nor else false endif \/ if i<nc then nationality[i+1] == nor else false endif) | i in 1..nc]);

solve satisfy; 
```

解决方案：

```
Compiling zebra.mzn
Running zebra.mzn
color = array1d(1..5 ,[4, 5, 1, 3, 2]);
nationality = array1d(1..5 ,[4, 3, 1, 2, 5]);
pet = array1d(1..5 ,[3, 4, 2, 1, 5]);
drink = array1d(1..5 ,[5, 2, 3, 4, 1]);
smoke = array1d(1..5 ,[2, 3, 1, 4, 5]);
----------
Finished in 47msec 
```

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2015-12-09T22:22:12.583

Microsoft Solver Foundation 示例来自： [https ://msdn.microsoft.com/en-us/library/ff525831%28v=vs.93%29.aspx?f=255&MSPPError=-2147217396](https://msdn.microsoft.com/en-us/library/ff525831%28v=vs.93%29.aspx?f=255&MSPPError=-2147217396)

```
delegate CspTerm NamedTerm(string name);

public static void Zebra() {
  ConstraintSystem S = ConstraintSystem.CreateSolver();
  var termList = new List<KeyValuePair<CspTerm, string>>();

  NamedTerm House = delegate(string name) {
    CspTerm x = S.CreateVariable(S.CreateIntegerInterval(1, 5), name);
    termList.Add(new KeyValuePair<CspTerm, string>(x, name));
    return x;
  };

  CspTerm English = House("English"), Spanish = House("Spanish"),
    Japanese = House("Japanese"), Italian = House("Italian"),
    Norwegian = House("Norwegian");
  CspTerm red = House("red"), green = House("green"),
    white = House("white"),
    blue = House("blue"), yellow = House("yellow");
  CspTerm dog = House("dog"), snails = House("snails"),
    fox = House("fox"),
    horse = House("horse"), zebra = House("zebra");
  CspTerm painter = House("painter"), sculptor = House("sculptor"),
    diplomat = House("diplomat"), violinist = House("violinist"),
    doctor = House("doctor");
  CspTerm tea = House("tea"), coffee = House("coffee"),
    milk = House("milk"),
    juice = House("juice"), water = House("water");

  S.AddConstraints(
    S.Unequal(English, Spanish, Japanese, Italian, Norwegian),
    S.Unequal(red, green, white, blue, yellow),
    S.Unequal(dog, snails, fox, horse, zebra),
    S.Unequal(painter, sculptor, diplomat, violinist, doctor),
    S.Unequal(tea, coffee, milk, juice, water),
    S.Equal(English, red),
    S.Equal(Spanish, dog),
    S.Equal(Japanese, painter),
    S.Equal(Italian, tea),
    S.Equal(1, Norwegian),
    S.Equal(green, coffee),
    S.Equal(1, green - white),
    S.Equal(sculptor, snails),
    S.Equal(diplomat, yellow),
    S.Equal(3, milk),
    S.Equal(1, S.Abs(Norwegian - blue)),
    S.Equal(violinist, juice),
    S.Equal(1, S.Abs(fox - doctor)),
    S.Equal(1, S.Abs(horse - diplomat))
  );
  bool unsolved = true;
  ConstraintSolverSolution soln = S.Solve();

  while (soln.HasFoundSolution) {
    unsolved = false;
    System.Console.WriteLine("solved.");
    StringBuilder[] houses = new StringBuilder[5];
    for (int i = 0; i < 5; i++)
      houses[i] = new StringBuilder(i.ToString());
    foreach (KeyValuePair<CspTerm, string> kvp in termList) {
      string item = kvp.Value;
      object house;
      if (!soln.TryGetValue(kvp.Key, out house))
        throw new InvalidProgramException(
                    "can't find a Term in the solution: " + item);
      houses[(int)house - 1].Append(", ");
      houses[(int)house - 1].Append(item);
    }
    foreach (StringBuilder house in houses) {
      System.Console.WriteLine(house);
    }
    soln.GetNext();
  }
  if (unsolved)
    System.Console.WriteLine("No solution found.");
  else
    System.Console.WriteLine(
"Expected: the Norwegian drinking water and the Japanese with the zebra.");
} 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2022-01-10T10:59:05.423

可以在此处找到程序解决方案的一个示例（最初是为类似问题编写的）：[https ://puzzle-solvers.readthedocs.io/en/latest/](https://puzzle-solvers.readthedocs.io/en/latest/)

我实现了类之间的关系矩阵，当你输入约束时它会更新。API 以一个[`Solver`](https://puzzle-solvers.readthedocs.io/en/latest/elimination.html#puzzle_solvers.elimination.Solver)类为中心，您使用类别和标签对其进行初始化。然后你调用方法[`adjecent_to`](https://puzzle-solvers.readthedocs.io/en/latest/elimination.html#puzzle_solvers.elimination.Solver.adjacent_to)和[`match`](https://puzzle-solvers.readthedocs.io/en/latest/elimination.html#puzzle_solvers.elimination.Solver.match)on 来建立关系。

[文档对底层逻辑](https://puzzle-solvers.readthedocs.io/en/latest/elimination.html#logic)有相当透彻的解释。您描述的确切难题是[演示](https://github.com/madphysicist/puzzle-solvers/blob/master/src/puzzle_solvers/demos/elimination_zebra.py)之一。为了回答您的字面问题，演示如下所示：

```
positions = [1, 2, 3, 4, 5]
nationalities = [
    'Englishman', 'Spaniard', 'Ukrainian', 'Norwegian', 'Japanese'
]
colors = ['red', 'green', 'ivory', 'yellow', 'blue']
pets = ['dog', 'snails', 'fox', 'horse', 'ZEBRA']
drinks = ['coffee', 'tea', 'milk', 'orange juice', 'WATER']
cigarettes = [
    'Old Gold', 'Kools', 'Chesterfields', 'Lucky Strikes', 'Parliaments'
]

problem = {
    'position': positions,
    'nationality': nationalities,
    'color': colors,
    'pet': pets,
    'drink': drinks,
    'cigarette': cigarettes,
}

solver = Solver(problem)

if __name__ == '__main__':
    solver.match('Englishman', 'red')
    solver.match('Spaniard', 'dog')
    solver.match('coffee', 'green')
    solver.match('Ukrainian', 'tea')
    solver.greater_than('green', 'ivory', 'position', 1)
    solver.match('Old Gold', 'snails')
    solver.match('Kools', 'yellow')
    solver.match('milk', 3)
    solver.match('Norwegian', 1)
    solver.adjacent_to('Chesterfields', 'fox', 'position')
    solver.adjacent_to('Kools', 'horse', 'position')
    solver.match('Lucky Strikes', 'orange juice')
    solver.match('Japanese', 'Parliaments')
    solver.adjacent_to('Norwegian', 'blue', 'position')

    solver.draw(show=False, title=f'After Rules: {solver.edges} Edges')

    print(f'Solved? {solver.solved}')
    print(f'{solver.category_for("ZEBRA", "nationality")} owns the ZEBRA')
    print(f'{solver.category_for("WATER", "nationality")} drinks WATER') 
```

这段代码的好处是它可以在一夜之间编写出来，而不是一个经过深思熟虑的生产包，但它仍然可以完成工作。

# ria - 有人在 Web 应用程序中看到过良好的嵌入式帮助吗？

> ID：318900
> 
> 赞同：3
> 
> 时间：2008-11-25T21:16:33.050
> 
> 标签：ria, wizard

我在网络上有一个非常简单的应用程序（用 Flex 编写），一旦里面有数据，它就非常易于使用。在其中获取数据的步骤本身也非常简单，但当我的观众第一次登录我的应用程序时，他们一点也不明显。

我一直在努力解决如何在不向用户提供单独帮助的情况下与用户交流数据设置过程。我也不想让我的可爱、优雅的 UI （我的当前用户一致称赞它的清晰度并且与他们的流程非常匹配）与向导，或者更糟糕的是一个恼人的动画回形针。

我有一套非常丰富的工具可用于 Web UI，但我正在寻找灵感，并想知道是否有人体验过嵌入在应用程序中的基于 Web 的、直观的、不显眼的、真正有用的过程/使用说明，并且可以指出我链接，所以我可以自己看看。

没有人有任何好主意？每个访问现有应用程序的不同页面以输入/上传数据大约需要 5 个步骤。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-25T21:55:54.857

你有没有看过： [http ://www.askthecssguy.com/2007/03/form_field_hints_with_css_and.html](http://www.askthecssguy.com/2007/03/form_field_hints_with_css_and.html)

我相信有一个 jquery 或原型或 mootools 或任何框架超出上述几步，并引导用户完成操作。我的 google-fu 现在没有通过，所以我似乎找不到它。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-25T21:48:21.877

您可以像这样在主页上的小条中显示指向数据设置页面的链接（请原谅丑陋 - 这只是一个可用性想法）：

[替代文字 http://www.freeimagehosting.net/uploads/052b13acb7.jpg](http://www.freeimagehosting.net/uploads/052b13acb7.jpg)

他们已经完成的步骤是灰色的（我假设他们不必按顺序完成这些步骤）。当他们将鼠标悬停在一个步骤上时，他们会得到一个简短的描述，然后当他们点击进入实际的步骤页面时会得到完整的详细信息。当然，您可以为每个步骤设置描述性图标而不是超链接。

# c# - 在 VS2008 中使用 Arraylist 控制 C# DataGridView

> ID：318906
> 
> 赞同：1
> 
> 时间：2008-11-25T21:18:38.223
> 
> 标签：c#, winforms, visual-studio-2008, datagridview, tabcontrol

我在 VS2008 中使用的 datagridview 元素有一些问题。这个 DataGridView 实际上是 TabControl 元素中的一个选项卡。

我给了它 5 个列，这些列需要用我制作的服装对象中的元素填充。

它基本上是一个小型库应用程序，其中包含一个主类和几个派生自它的类。它们都有一个 ToString() 方法，该方法将数据表示为一串关键字，其中包含我填充 datagridview 所需的值。

我只需要前 5 个，有些对象最多有 12 个关键字。目前，每当我添加一个对象时，datagrid 不会自行填充，而是添加与特定对象具有的关键字数量相等的列数量。

我目前正在做的是：

```
public void libDataGrid_Click(object sender, EventArgs e)
        {
            if(this.manager.Lib.LibList[0] != null)
            {
                libDataGrid.DataSource = this.manager.Lib.LibList;
                libDataGrid.Refresh();
            }
        } 
```

`this.manager.Lib.LibList`返回和 ArrayList，其中存储了所有对象。ArrayList 可以包含所有派生类的元素，但由于它们都是连接的，因此字符串表示将始终包含填充网格所需的元素。

我不知道如何只过滤前五个并且他们将它们放入正确的列中。

还有一件事。目前我只能通过单击来刷新 DataGridView。当我切换到 Tabcontrol 上的特定选项卡时，它应该会打开，我的意思是。

我尝试为 SelectedIndexChanged 添加一个参数，但这实际上并没有做任何事情......或者至少，它似乎没有做任何事情。

我的意思是我注释掉了上面的代码并添加了这个：

```
public void tabControl1_SelectedIndexChanged(object sender, EventArgs e)
        {
                libDataGrid.DataSource = this.manager.Lib.LibList;
                libDataGrid.Refresh();
        } 
```

每次更改选项卡时都会刷新它，无论是哪一个。我不得不删除 if 语句，因为它给了我一个例外。可能是因为初始化时未设置 ArrayList 的长度。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-25T23:51:25.983

我对这个问题有点困惑，但这里有一些想法：

1.  `DataGridView`具有[`AutoGenerateColumn`s](http://msdn.microsoft.com/en-us/library/system.windows.forms.datagridview.autogeneratecolumns.aspx)属性；如果您不希望它创建自己的列，请将其设置为 false
2.  要绑定到现有列，[`DataPropertyName`](http://msdn.microsoft.com/en-us/library/system.windows.forms.datagridviewcolumn.datapropertyname.aspx)必须在每个列上设置
3.  `DataGridView`（在使用任何列表控件的 cmomon 中`TypeDescriptor`）将非常喜欢`List<T>`（对于某些`T`!= `object`）而`ArrayList`不是 ，因为即使对于空列表，它也可以获得元数据。一般来说，在 2.0 中使用`ArrayList`是错误的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-25T21:25:54.730

我只能给出部分答案，但我认为原因是

```
public void tabControl1_SelectedIndexChanged(object sender, EventArgs e)
        {
                libDataGrid.DataSource = this.manager.Lib.LibList;
                libDataGrid.Refresh();
        } 
```

不起作用，是因为您需要在初始化 tabControl1 的位置添加这一行。我遇到了这个问题，VS 自己不会这样做。

```
tabControl1.SelectedIndexChanged += new EventHandler(tabControl1_SelectedIndexChanged); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-25T21:27:27.583

如果我理解你的问题，它似乎类似于我最近在[C#/.NET2.0 中的 DataGridViews上的这个线程中遇到的问题](https://stackoverflow.com/questions/259123/how-do-i-safely-populate-with-data-and-refresh-a-datagridview-in-a-multi-thread)

尝试调用：

```
libDataGrid.Invalidate(); 
```

这应该强制 Windows 重绘您的控件。无需重新附加数据源并刷新。（我认为您可以放心地注释掉这两行。）

**另外：** 你得到的例外是什么？

您是否使用“数据源配置向导”来帮助您使用 dataGridView？

# sql-server-2005 - 创建表，使用户是所有者

> ID：318909
> 
> 赞同：1
> 
> 时间：2008-11-25T21:19:35.727
> 
> 标签：sql-server-2005

据我了解，在 SQL 2005 中创建表时的默认行为是将 dbo 作为表的所有者来创建。有没有办法改变这个默认行为，以便所有表都作为用户而不是 dbo 创建？我正在将应用程序从 SQL 2000 迁移到 SQL 2005，并且应用程序中的大部分逻辑都假设默认行为是创建一个以用户为所有者的表。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-25T21:33:45.590

您可以首先创建架构（您或目标用户拥有），然后在架构下创建表，ala：

```
CREATE TABLE [yourSchema].[sales](...) 
```

sql2005中的schema/owner情况不同。

好的是模式名称不必与所有者名称相同。如果当前架构所有者离开，您可以将架构所有权重新分配给其他人。

# .net - 使用 .net 从子进程重定向 stout

> ID：318915
> 
> 赞同：3
> 
> 时间：2008-11-25T21:21:58.280
> 
> 标签：.net, process, stdout, stdio

我正在使用以下代码

```
System::Diagnostics::Process^ p = gcnew System::Diagnostics::Process();
p->StartInfo->FileName =  "tnccmd.exe";
p->StartInfo->UseShellExecute = false;
p->StartInfo->RedirectStandardInput = true;
p->StartInfo->RedirectStandardOutput = true; 
p->Start();
System::IO::StreamWriter^ tnc_stdin = p->StandardInput;
System::IO::StreamReader^ tnc_stdout = p->StandardOutput;

tnc_stdin->WriteLine("connect i 127.0.0.1");
String^ prg_output = tnc_stdout->ReadToEnd(); 
```

我的问题是我无法`stdout`正确阅读。但是，我可以轻松地写入`stdin`，但现在我正在尝试实现一些错误检查代码，但它不起作用。

我正在使用的程序似乎没有写入，`stdout`即使它是在命令行中运行的。我可以重现默认情况下`bug`附带`ftp.exe`的。`Windows XP`如果`->FileName`用`ftp.exe`命令提示符更改`ftp.exe`通常给出的`ftp>`将不会显示在`prg_output`.

现在我知道提示必须使用某种类型，`windows shell curses`我可能会混淆问题。

`connect i 127.0.0.1`通常在我应该收到的指令之后，`connecting to 127.0.0.1...`但我什么也没收到。

关于我做错了什么的任何提示？还有另一种`stdout`我不知道的吗？

编辑

我不能使用参数，因为我有多行要写，就像`ftp.exe`. 此外，`ftp.exe`当您键入 dir 之类的命令时会输出。至少当您编写未知命令时它会输出，它会抱怨`Invalid command`.

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-11-25T21:31:15.407

我怀疑您正在尝试将实际上应该是命令行参数的内容发送到标准输入。您通常如何调用 tnccmd.exe？像这样的东西？

```
tnccmd.exe connect i 127.0.0.1 
```

如果是这种情况，那么“connect i 127.0.0.1”不应在标准输入上继续，而应通过 p->StartInfo->Arguments 传递。

（ftp.exe 的问题不在于你的程序，而在于 ftp.exe 本身，它会判断它的 stdout 是否是控制台。如果它的输出不在控制台上，那么它不会输出“ftp>”提示。您尝试编写脚本的程序也可能执行相同的操作。）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-25T21:31:16.890

也许这是缓冲的问题。

如果您尝试刷新 tnc_stdin 会发生什么？尝试这样的事情：

```
tnc_stdin->WriteLine("connect i 127.0.0.1");
tnc_stdin->Flush(); 
```

编辑：检查您正在使用的 StreamWriter 的 ctor（反射器规则！）根据它，默认缓冲区大小为 1024 字节......所以您需要刷新 :-) 或者您可以定义一个更小的缓冲区。

```
 public StreamWriter(string path) : 
this(path, false, new UTF8Encoding(false, true), 0x400)
    {
    } 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-10T18:23:09.963

我认为您忘记调用[BeginOutputReadLine](http://msdn.microsoft.com/en-us/library/system.diagnostics.process.beginoutputreadline.aspx)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-09-05T22:39:45.743

请参阅这篇关于从托管应用程序中捕获标准 Out 和 Err 的博客文章。CLR 使得自己很容易做错事并陷入僵局。

[如何正确使用 System.Diagnostics.Process](http://csharptest.net/321/how-to-use-systemdiagnosticsprocess-correctly/)

# tfs - 如何在 TFS 中限制文件大小

> ID：318918
> 
> 赞同：2
> 
> 时间：2008-11-25T21:22:23.863
> 
> 标签：tfs, version-control

有没有办法为可以在 Team Foundation Server 2005 或 2008 下签入源代码管理的文件设置最大大小？

过去，当我们使用 SourceSafe 时，有几个案例是开发人员决定将 500mb 的数据文件签入到源代码控制中。

我不知道这样的事情会对 TFS 造成什么影响——实际上，我也不想知道。

**编辑：**自定义签入策略不是一个可行的解决方案，原因有两个：

1.  它是在客户端完成的 - 我希望服务器能够保护自己免受这种滥用

2.  用户可以覆盖自定义签入策略。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-03T21:18:20.143

据我所知，没有办法按照您的意愿执行此操作。

自定义签入策略是实现此类功能的设计方式。覆盖能力是一种内置的故障保护，可防止需要破坏策略的紧急操作。

使用 BisSubscribe 工具，您可以设置在使用覆盖时发送电子邮件的警报。这将允许您验证所有覆盖并在必要时将它们撤消。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-03T21:29:22.320

当我使用 TFS 2005 时，自定义签入策略的客户端性质确实很麻烦。如果它是服务器端的，那么您所要求的显然效果最好。如果目前 TFS 中尚未提供服务器端策略实施解决方案，请查看是否有一种简单的方法可以排除文件类型。

如果您提到的数据文件是二进制文件，那么它们无论如何都不应该受版本控制（不能真正区分二进制文件的两个版本）。如果它们不是二进制文件且大小为 500 MB，请设置 TFS 的权限以使这些文件对除管理员之外的所有人都是只读的。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-26T21:35:52.730

只要你的 SQL 数据库有足够的空间应该没问题。但是无论如何，您都可以编写一个[自定义签入策略](http://msdn.microsoft.com/en-us/library/bb668980.aspx)来检查文件大小，如果超过您的限制，则不允许签入。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-25T22:11:32.830

我不具体了解 TFS，但是在 Subversion 中是否有一些“预提交挂钩”的概念？如果是这样，那么您可以检查文件大小与那里的最大值并在任何文件太大时拒绝提交。

# windows - 如何在 gVim 中缩进选择（Win32）

> ID：318923
> 
> 赞同：17
> 
> 时间：2008-11-25T21:24:02.520
> 
> 标签：windows, vim, indentation

我想**缩进一段文本**。

我可以在gVim的**Linux版本中做到这一点。**

我在不处于插入或可视模式的 gVim**状态**下执行此操作。底部的栏左侧为空白，右侧显示行号和百分比。

然后我执行以下**过程**：我通过单击和拖动选择一个文本块。然后我点击`Shift`+ `.`。之后，我点击`Esc`，文本块将移动到一个选项卡上。

但是，如果我在**Windows**中执行此操作，它只会将块替换为`>`.

我只是在运行现有的 Windows **rc 文件**和 gVim 的 7.1 版。

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-11-26T10:57:46.137

如果您首先输入 SHIFT-V，然后使用 shift+箭头选择文本，它将缩进。您也可以使用 SHIFT-V，并使用 'hjkl' 选择块。

如果您使用 shift+箭头或鼠标选择文本块，则不起作用，选择将被替换为“>”。这可以在您更改选择模式时更改；

设置选择模式=鼠标，键

*   行为 mswin 后的默认设置

设置选择模式=键

*   现在您可以用鼠标选择并按“>”缩进

设置选择模式=

*   现在您可以使用鼠标和移动箭头键同时选择，然后按“>”缩进

如果你把它添加到你的 vimrc 中，请在表现 mswin 之后执行它

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-26T17:08:59.507

与此相关，我为可视模式使用了一个方便的重映射，它允许在保持文本被选中的同时多次缩进文本。类似于 Visual Studio 如何让您选择并点击 tab（或 shift-tab）来缩进。

将以下内容添加到您的 .vimrc

```
" Pressing < or > will let you indent/unident selected lines
vnoremap < <gv
vnoremap > >gv 
```

您也可以使用 == 让 vim 尝试自动确定正确的缩进。它适用于任何行购买，只需将光标放在那里并按 == 或者您可以做一些花哨的事情，例如选择整个文件并按 == 来修复所有缩进（对所见即所得编辑器生成的 html 产生奇迹）。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-25T21:26:06.057

`Esc`-> `Shift`+ `V`-> 选择行 ->`>` `>`

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-25T21:30:15.127

您需要在 vimrc 文件中更改`behave mswin`为。`behave xterm`

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-26T20:36:27.827

如果您想完全避免可视模式，您可以使用文本对象。例如`>ap`，在普通模式下缩进一个段落，`>aB`缩进一个花括号块，等等。参见`:h text-objects`.

# asp.net - DropDownList 烦恼：相同的值不会触发事件

> ID：318926
> 
> 赞同：4
> 
> 时间：2008-11-25T21:25:01.270
> 
> 标签：asp.net

我用不同的文本属性填充了一个下拉列表控件，但每个文本属性都有相同的值（文本属性是 A，值属性是 blah，文本属性是 B，值属性是 blahblah，等等...）

ASP.net 仅在回发时检查值属性，并且因为所有值都相同（出于测试原因），所以发生了这种令人讨厌的行为。有解决办法吗？这是否意味着你不能永远拥有相同的价值？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-25T21:32:17.370

听起来您正在处理错误的事件。尝试[SelectedIndexChanged](http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.listcontrol.onselectedindexchanged(VS.85).aspx)。

确保您还将`AutoPostBack`属性设置为`True`.

### 解决

好的，所以我很好奇，所以我开始研究这个:)

**使用非唯一值进行数据绑定时存在“问题”。**

所以，首先，我公开道歉，否则的话。

要复制：

### ASPX

```
 <asp:DropDownList ID="myDDL" runat="server" AutoPostBack="True">
    </asp:DropDownList>
    <asp:Label ID="lblSelItem" runat="server"Text="Currently Selected Item: 0"></asp:Label>
    <asp:Label ID="lblSelVal" runat="server" Text="Currently Selected Value: X"></asp:Label> 
```

### 代码隐藏

```
 List<string> MyData()
    {
        List<string> rtn = new List<string>();
        rtn.Add("I am the same value!");
        rtn.Add("I am the same value!");
        rtn.Add("I am the same value!");
        rtn.Add("I am the same value!2");
        return rtn;
    }

    protected void Page_Init()
    {
        if (!Page.IsPostBack)
        {
            // Load the Data for the DDL.
            myDDL.DataSource = MyData();
            myDDL.DataBind();
        }
    }

    protected void Page_Load(object sender, EventArgs e)
    {
        // Display the Currently Selected Item/Value.
        lblSelItem.Text = "Currently Selected Item: " + myDDL.SelectedIndex.ToString();
        lblSelVal.Text = "Currently Selected Value: " + myDDL.SelectedValue;
    } 
```

运行，更改 DropDownList 中的值。请注意，不会发生 PostBack。

查看源代码时，我意识到我们需要为服务器控件生成`value`的元素显式设置“”属性`<option>`，这导致我执行以下操作：

### 新的代码隐藏

```
 Dictionary<string, string> MyTwoColData()
    {
        Dictionary<string, string> rtn = new Dictionary<string, string>();
        rtn.Add("1", "I am the same value!");
        rtn.Add("2", "I am the same value!");
        rtn.Add("3", "I am the same value!");
        return rtn;
    }

    protected void Page_Init()
    {
        if (!Page.IsPostBack)
        {
            // Load the Data for the DDL.
            Dictionary<string, string> data = MyTwoColData();

            foreach (KeyValuePair<string, string> pair in MyTwoColData())
            {
                myDDL.Items.Add(new ListItem(pair.Value, pair.Key));
            }

            myDDL.DataBind();
        }
    } 
```

这明确地将值设置为“1”、“2”、“3”等，使它们独一无二，同时仍然在列表中显示正确的数据。

显然，您可以将其更改为使用单列列表，但只需运行 for 循环并使用值`i`或其他内容。

至于 DataSets 的良好解决方法，不确定。

**实际上，我们是否会向用户提供具有完全相同值的选项列表？**

我个人认为不是，这可能就是为什么这个“问题”没有得到解决:)

享受！

### PS：

哦，我还应该补充一点，如果您想使用“修复”中的文本值，请将其更改为`SelectedItem`而不是`SelectedValue`.

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-11-25T21:52:09.297

ASP.NET 无法区分下拉列表中具有相同值的不同项目，因为当浏览器发送 HTTP POST 时，它只发送选定的值。

ASP.NET 将在下拉列表中找到值匹配的第一项。

您需要确保下拉列表中的每个项目都具有不同的值。您可以通过为每个值添加一个键来做到这一点。换句话说，不是每个值都有“blah”，而是使用“blah-1”、“blah-2”等。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-25T21:37:31.713

问题是如果选定的索引不改变回发不会触发。在用户进行相同选择的情况下，选择的索引不会改变。

抱歉，这不能回答问题，但据我所知，它确实解释了这种行为。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-25T21:42:41.827

SelectedIndexChanged 甚至不会触发，因为下拉列表控件中的所有 listitem 值都是相同的。我做了一些谷歌搜索。这似乎是常见的问题。我还没有找到任何解决方法。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-25T21:50:40.953

您可以使用如下值：

1:2

2:2

3:2

其中第二个数字是“真实”值。然后你的事件应该被触发，你可以在后面的代码中解析出“真实”值。

为什么你有一个所有值都相同的下拉菜单？或者只是其中一些是相同的？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-26T09:51:22.603

如果您回想 ASP.Net 之前的日子，那么唯一使用从 a 提交的表单发送的`<SELECT>`就是. 然后，ASP.Net 通过在数据项列表中查找该值来有效地确定选择了哪个项。`VALUE``<OPTION>`

您还会注意到，如果您有两个具有相同值但标签不同的项目，如果您在下次加载表单时触发回发，则将显示第一个项目，即使您在执行回发之前选择了第二个项目.

* * *

如果您退后一步并考虑您的原始数据源 - 如果您只有值，您将如何确定选择了哪个文本值？您将如何从数据库或列表中选择该值？您将如何更新数据库中的该行？如果您尝试一下，您会发现 .Net 会抛出异常，因为它无法唯一标识该行。

因此，您需要为数据添加唯一键。

# java - 如何测试 Java/J2EE 中是否启用了 cookie

> ID：318938
> 
> 赞同：4
> 
> 时间：2008-11-25T21:28:47.347
> 
> 标签：java, jakarta-ee

测试：

```
return request.getCookies() == null; 
```

不是一个合适的方式测试。还有其他方法吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-25T22:20:37.943

设置一个 cookie 并尝试读回它。

```
import javax.servlet.*;
import javax.servlet.http.*;

public class Test4Cookies extends HttpServlet {

  private static final Cookie cookie = new Cookie( "hello" , "world" );
  private static final String paramName = "foo";
  private static final String successURI = "/success.htm";
  private static final String failureURI = "/failure.htm";

  public void doPost(HttpServletRequest req, HttpServletResponse res) {
    if ( req.getParameter( paramName ) == null ) {
       res.addCookie( cookie );
       res.sendRedirect(req.getRequestURI() +"?"+ paramName +"=bar" );
       } 
    else {
       res.sendRedirect
         (( req.getCookies().length == 0 ) ? failureURI : successURI 
       )
    }

  public void doGet(HttpServletRequest req, HttpServletResponse res) {
    doPost(req, res);
    }
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-25T22:17:51.087

您通常希望使用 JavaScript 来确定客户端的浏览器是否启用了 cookie：

```
<script type="text/javascript">
var cookieEnabled=(navigator.cookieEnabled)? true : false

//if not IE4+ nor NS6+
if (typeof navigator.cookieEnabled=="undefined" && !cookieEnabled){ 
document.cookie="testcookie"
cookieEnabled=(document.cookie.indexOf("testcookie")!=-1)? true : false
}

//if (cookieEnabled) //if cookies are enabled on client's browser
//do whatever

</script> 
```

# eclipse - 关于如何在多个监视器上组织 Eclipse 环境的任何提示？

> ID：318940
> 
> 赞同：176
> 
> 时间：2008-11-25T21:29:29.343
> 
> 标签：eclipse, multiple-monitors, eclipse-3.4

我找不到将 Eclipse 窗口放在两个显示器上的好方法。目前，我只是将几个窗口分离（单击标题并拖动）到辅助监视器（包资源管理器、控制台和大纲），同时使主监视器具有最大化的源编辑窗口。

它工作得很好，除了一些烦人的问题。编辑代码时，分离的窗口不在焦点上。这意味着，例如，最后一个构建快捷方式（`Alt`- `Shift`- `X`, `Q`）不起作用，因为它找不到构建文件（因为包资源管理器不在焦点上）。文件搜索菜单中的“选定资源”选项也没有选择当前的包选择。

所以我想知道分离窗户是正确的方法吗？你有没有更好的解决方案，至少包资源管理器仍然是焦点？

谢谢。

PS。顺便说一句，由于某种原因，“无法找到构建”错误仅在 3.4 版本中开始出现。

* * *

## 回答 #1

> 赞同：270
> 
> 时间：2011-05-11T08:26:06.977

在 Eclipse Helios（当前为 3.6.2）中，我发现使用另一个窗口在不同屏幕中显示多个文档非常有用。在主菜单中，转到：

窗口 > 新窗口，

并将其拖到您喜欢的屏幕上。双击编辑器上的文件名，将最大化编辑器的窗口。

我希望我有所帮助。

基尔。

PS：如果你想在关闭Eclipse的时候同时保持两个窗口，不要一个一个地关闭。而是去：文件>退出。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-11-25T22:06:30.080

我使用 Ultramon 将我的 Eclipse 分布在两个显示器上。

我将左侧用于代码，右侧用于 Project Explorer、Search、Console、Ant 和 Outline 视图。

这样，当我在任务栏或 alt 选项卡中单击 Eclipse 时，我就能将注意力集中在所有的 Eclipse 上。我还可以在右侧监视器上覆盖另一个窗口（通常是我的浏览器或跟踪查看器）。如果我想同时编码和阅读一些参考资料，我会使用 SemTop 固定覆盖的窗口（这是快捷键派上用场的地方）。

所以我可以同时查看代码和 StackOverflow ;)

[超兽](http://www.realtimesoft.com/ultramon/)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-11-25T21:52:11.900

我将 Eclipse 环境拆分为两个监视器（均以 1600*1200 运行）

在左侧，我将主编码窗口最大化，右侧有轮廓。

在第二台显示器上，我有 Junit 窗口、问题、控制台和包资源管理器

对于我使用的所有透视图，我都有相同的布局。

我从未使用过`Alt`--快捷方式`Shift`，`Q`但我发现`Alt`-- `Shift`，当我专注于主编码窗口时，运行 junit 的快捷方式可以正常工作`X`。`T`

可能将包资源管理器与编码窗口放在同一监视器上？

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-08-07T15:45:34.637

我有一个宽屏主显示器和一个非宽屏辅助显示器。我的主监视器上的布局分为三列：第 1 列在上半部分包含包资源管理器，在下半部分包含选项卡中的大纲、层次结构和搜索结果视图。第二列是代码，比其他两列宽大约两倍半。（由于我办公室的每个人都有宽屏显示器，我们已经标准化为 100 行而不是 80 行。）第三列的顶部是调试视图，有点小；其下方选项卡中的变量、表达式和 JUnit 视图，占据了大部分垂直空间；以及下面的小断点视图。我的辅助显示器有两个被撕掉的窗口：控制台占据了大部分屏幕，在它下面我有一个较小的窗口，其中包含选项卡中的问题和历史视图。

我唯一的抱怨是当我在家中从我的单显示器设置远程桌面时：辅助显示器上的两个窗口移动到主显示器。我有一个“单屏”视角，我在这个场景中使用它来纠正这个问题，但是当我回到工作岗位并切换到双显示器视角时，我必须手动将窗口移回另一台显示器。我希望 Eclipse 能把它们留在那里，但我看不出有什么办法让它做到这一点。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2015-01-31T13:33:51.090

我通过将 Eclipse 扩展到两个显示器来做到这一点，在 Windows 中，您可以通过按住 win 键并点击来扩展屏幕`P`，

![在此处输入图像描述](https://i.stack.imgur.com/vIyXF.png)

然后，选择我的左显示器作为主显示器，我拖动 eclipse 窗口的右侧以一直覆盖另一个屏幕。然后将eclipse分成三列。现在我的主监视器专用于代码编辑器，控制台和包资源管理器在另一个上！当您的代码有一个完整的监视器时，它总是有助于使用`cntrl+{`第二个垂直列来查看同一个文件，或者将另一个文件的选项卡拖到屏幕一侧以同时查看两者。 ![在此处输入图像描述](https://i.stack.imgur.com/IEOdX.png)

### 最后，我刚刚从窗口保存了我的工作 > 将透视保存为

每当我不在办公室时，我都可以在我的视角`normal`和视角之间切换`dual monitor`

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2012-03-07T13:10:32.220

我的主显示器上有包资源管理器和代码，辅助显示器上有控制台。我通过右键单击控制台选项卡并选择移动..然后查看来做到这一点。这样我就可以拖放控制台窗口并调整其大小。

希望这可以帮助！

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2013-03-18T12:25:21.613

通过在 Eclipse 中使用 Ctrl+Shift+R，我已经减少（但没有消除）始终显示包资源管理器的需要，这会弹出一个“输入时过滤器”窗口，可以在您记住名称的文件之间进行切换的简单，以及接受通配符，以便轻松找到您部分记住名称的文件。

我在我的主屏幕上保留源代码，并在我的辅助屏幕上概述任务和 LogCat (android)，如果我发现我正在阅读大量网络内容，我会通过协同作用启动我的笔记本电脑作为独立的第三个屏幕，这并不理想，但它作品。

# java - PermGen 实际上代表什么？

> ID：318942
> 
> 赞同：125
> 
> 时间：2008-11-25T21:30:30.510
> 
> 标签：java, permgen

我知道 PermGen 是什么，它的用途，它为什么失败，如何增加它等等。

我不知道 PermGen 实际上代表什么。永久的……根……什么？

有谁知道 PermGen 实际上代表什么？

* * *

## 回答 #1

> 赞同：87
> 
> 时间：2008-11-26T11:57:44.223

永久一代。细节当然是特定于实现的。

简而言之，它包含与类和内部字符串关联的 Java 对象。在 Sun 的启用共享的客户端实现中，`classes.jsa`内存映射以形成初始数据，大约一半是只读的，一半是写时复制的。

只是旧的 Java 对象保存在 Tenured Generation 中。

* * *

## 回答 #2

> 赞同：61
> 
> 时间：2008-11-26T14:36:25.807

JVM 使用 PermGen 来保存已加载的类。您可以使用以下方法增加它：

`-XX:MaxPermSize=384m`

如果您使用的是 Sun JVM 或 OpenJDK。

所以如果你得到一个 OutOfMemoryException: PermGen 你需要要么让 PermGen 更大，否则你可能会遇到类加载器问题。

* * *

## 回答 #3

> 赞同：20
> 
> 时间：2008-11-25T21:32:46.870

永久一代。有关垃圾收集器的更多详细信息，请参阅 java [GC 调整指南](http://www.oracle.com/technetwork/java/javase/gc-tuning-6-140523.html)。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2014-06-17T11:51:41.047

与原始问题没有真正相关的匹配，但可能有人会发现它有用。PermGen 确实是 Java 用来保存其类的内存区域。因此，我们中的许多人都在 PermGen 中遇到过 OOM，例如，如果有很多类的话。

从 Java 8 开始，PermGen 区域已被 MetaSpace 区域取代，后者效率更高且默认不受限制（或更准确地说 - 受本机内存量限制，取决于 32 位或 64 位 jvm 和 OS 虚拟内存可用性）。但是，可以通过某些方式对其进行调整，例如指定区域的最大限制。[您可以在此博客文章](http://java.dzone.com/articles/java-8-permgen-metaspace)中找到更多有用的信息。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2008-11-25T21:34:35.947

PermGen 代表*永久代*。

这是关于 DDJ[的简短介绍](http://www.ddj.com/java/188700760?pgno=5)

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-11-25T21:33:37.570

[永久代](http://mindprod.com/jgloss/permgen.html)

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-11-25T21:34:14.417

如果我没记错的话，gen 代表世代，就像在世代垃圾收集器中一样（它对年轻对象的处理不同于中年和“永久”对象）。局部性原则表明最近创建的对象将首先被清除。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2018-08-12T07:40:17.990

Permgen 代表永久一代。它是 JVM 内存区域之一。通过使用名为 MaxPermSize 的标志，它是具有固定大小的堆的一部分。

***为什么叫“PermGen”？***

这个 permgen 在 Java 的早期就被命名了。Permgen mains 保留已加载类的所有元数据。但问题是，一旦加载了一个类，它就会一直保留在 JVM 中，直到 JVM 关闭。所以名字 permgen 是选择的。但后来，类的动态加载出现了，但名称没有改变。但是在**Java 8**中，他们也解决了这个问题。现在**permagen**被重命名为具有动态内存大小的**MetaSpace 。**

# lisp - 在 Scheme 中将字符串转换为代码

> ID：318952
> 
> 赞同：9
> 
> 时间：2008-11-25T21:33:16.400
> 
> 标签：lisp, scheme

如何将字符串转换为PLT Scheme中的相应代码（不包含该`string->input-port`方法）？例如，我想转换这个字符串：

```
"(1 (0) 1 (0) 0)" 
```

进入这个列表：

```
'(1 (0) 1 (0) 0) 
```

是否可以在不打开文件的情况下执行此操作？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-11-25T21:55:37.527

Scheme 具有`read`从输入端口读取 s 表达式的过程，您可以使用`string->input-port`. 所以，你可以从一个字符串中读取一个 Scheme 对象

```
(read (string->input-port "(1 (0) 1 (0) 0)")) 
```

我没有安装 Scheme，所以我只是[从参考资料](http://groups.csail.mit.edu/mac/projects/scheme/documentation/scheme.html)中阅读它并没有实际测试它。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-26T11:57:36.530

从PLT方案手册：

`(open-input-string string [name-v])`创建一个输入端口，从字符串的 UTF-8 编码（参见第 1.2.3 节）中读取字节。可选`name-v`参数用作返回端口的名称；默认为`'string`.

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-25T21:41:59.147

从[comp.lang.scheme](http://groups.google.com/group/comp.lang.scheme/browse_thread/thread/30494207342e4c71)上的这个类似问题中，您可以将字符串保存到文件中，然后从中读取。

这可能类似于以下示例代码：

```
(let ((my-port (open-output-file "Foo")))
  (display "(1 (0) 1 (0) 0)" my-port)
  (close-output-port my-port))

(let* ((my-port (open-input-file "Foo"))
       (answer (read my-port)))
  (close-input-port my-port)
  answer) 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-26T12:27:37.593

许多方案都在标准输入端口所在的上下文中`with-input-from-string str thunk`执行。例如在开局方案中：`thunk``str`

`(with-input-from-string "(foo bar)" (lambda () (read)))`

评估为：

`(foo bar)`

lambda 是必要的，因为 a`thunk`应该是一个不带参数的过程。

# sql - 使用 NHibernate 生成模式的策略

> ID：318964
> 
> 赞同：3
> 
> 时间：2008-11-25T21:36:28.330
> 
> 标签：sql, nhibernate

我正在构建一个使用 NHibernate 生成数据库模式的新应用程序，但我可以看到将来可能出现的问题。

显然，当您更新架构时，您使用数据库中的所有数据都会被清除，但是人们使用什么策略将任何数据恢复到新数据库。我知道对架构进行大规模更改会使这变得困难，但我想知道其他人是如何处理这个问题的。

干杯科林 G

PS我不会对实时数据库执行此操作，仅使用它来恢复集成测试和持续集成的测试数据

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-27T11:10:57.327

测试时，我们使用 NHibernate 创建数据库，然后使用一系列[构建器](http://en.wikipedia.org/wiki/Builder_pattern)为每个测试夹具创建数据。我们还使用 Sqlite 进行这些测试，因此它们的速度很快。

我们的构建器看起来像这样：

```
public class CustomerBuilder : Builder<Customer>
{
   string firstName;
   string lastName;
   Guid id = Guid.Empty;

   public override Customer Build()
   {
      return new Customer() { Id = id, FirstName = firstName, LastName = }
   }

   public CustomerBuilder WithId(Guid newId)
   {
      id= newId;
      return this;
   }

   public CustomerBuilder WithFirstName(string newFirstName)
   {
      firstName = newFirstName;
      return this;
   }

   public CustomerBuilder WithLastName(string newLastName)
   {
      lastName = newLastName;
      return this;
   }
} 
```

和用法：

```
var customer = new CustomerBuilder().WithFirstName("John").WithLastName("Doe").Build(); 
```

因为每一行代码都是用 TDD 编写的，所以我们从 scatch 中构建了一套全面的数据，并且通常会将其中的一些重构为工厂，这些工厂将包装上述内容并使获取虚拟数据变得轻而易举。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-27T10:23:18.390

我认为在很多情况下让 NHibernate 为您生成模式是一件好事。要重新创建测试数据，您可以使用由测试框架（例如 NUnit）驱动的代码，也可以将测试数据导出为 SQL 脚本，您可以在更新架构后运行该脚本。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-08-06T14:43:01.367

只是一个针对@Chris Canal 的快速问题-

我知道使用流利的界面来构建您的对象使其看起来可读，但是当您可以使用 C# 3.0 语法时，编写这些“构建器”所需的额外努力真的值得吗？

即以你的例子：

var customer = new CustomerBuilder().WithFirstName("John").WithLastName("Doe").Build();

当您可以这样做时，这是否真的值得在构建“构建器”时付出努力（可以说它同样具有可读性，实际上代码更少）？：

var customer = new Customer { FirstName = "John", LastName = "Doe" };

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-25T21:51:24.337

我们不会从 NHibernate 更新架构。我们使用 SQLCompare 跨环境移动数据库模式。SQLCompare 以非破坏性方式执行此操作。

如果您已经在使用 NHibernate，我建议您使用代码创建测试数据。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-06-10T10:16:19.267

我们公司也这样做。我们使用 NHibernate 为我们的开发和测试目的生成数据库。对于测试，我们使用 SQLite 作为后端，只需为每个测试套件单独生成测试数据。

在更新我们的登台/生产服务器时，我们使用 SQLCompare 并在更改更复杂时进行一些手动编辑。

# ruby - Ruby：使用默认值定义类级哈希

> ID：318969
> 
> 赞同：5
> 
> 时间：2008-11-25T21:37:31.870
> 
> 标签：ruby

我有一个基本的红宝石课程：

```
class LogEntry

end 
```

我想做的是能够用一些值定义一个哈希，如下所示：

```
EntryType = { :error => 0, :warning => 1, :info => 2 } 
```

这样我就可以访问这样的值（或类似的值）：

```
LogEntry.EntryType[:error] 
```

这在Ruby中甚至可能吗？我会以正确的方式解决这个问题吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-25T21:43:01.390

你可以这样做：

```
class LogEntry
    EntryType = { :error => 0, :warning => 1, :info => 2 }
end 
```

但是您想将其引用为

```
LogEntry::EntryType[:error] 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-25T21:47:19.167

或者，您可以创建一个类方法：

```
class LogEntry

  def self.types
    { :error => 0, :warning => 1, :info => 2 }
  end

end

# And a simple test
LogEntry.types[:error].should be_an_instance_of(Hash) 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-25T22:08:38.763

为什么需要哈希？

你不能只在 LogEntry 类上声明条目类型吗？

```
class LogEntry
  @@ErrorType = 0
End

LogEntry.ErrorType 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-27T19:06:30.237

我很好奇为什么你不能只在 LogEntry 实例上将 @error_type 设为实例变量？

```
class LogEntry
  attr_reader :type
  ERROR_RANKING = [ :error, :warning, :info, ]
  include Comparable

  def initialize( type )
    @type = type
  end

  def <=>( other )
    ERROR_RANKING.index( @type ) <=> ERROR_RANKING.index( other.type )
  end
end

entry1 = LogEntry.new( :error )
entry2 = LogEntry.new( :warning )

puts entry1.type.inspect
#=> :error
puts entry2.type.inspect
#=> :warning
puts( ( entry1 > entry2 ).inspect )
#=> false
puts( ( entry1 < entry2 ).inspect )
#=> true 
```

但另请参阅 Ruby 的内置日志库[Logger](http://www.ruby-doc.org/core/classes/Logger.html)。

# .net - 显示/隐藏悬停弹出窗口的最佳方法

> ID：318977
> 
> 赞同：2
> 
> 时间：2008-11-25T21:41:31.220
> 
> 标签：.net, winforms

我有一个从 DataGridView 派生的日历控件。自定义项目悬停事件已经到位。处理事件时，我有悬停的项目和鼠标位置。显示包含项目详细信息的弹出窗口的最佳方法是什么？我应该使用精简的表单（没有标题栏、控制框等）并在 MouseLeave 上简单地关闭它吗？有没有更好的办法？

谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-25T21:54:58.340

任何类型的控件、面板、用户控件等。只要它们不必弹出当前表单，它们就可以。如果它需要弹出到外面，您可能需要使用您所说的 Form 并删除它的边框。

在主窗体中预先创建控件或窗体，然后当鼠标悬停所需控件时，使弹出控件可见，当鼠标离开时，使其不可见。

不过，请注意鼠标事件，它们可能会被新弹出的控件捕获。这可能需要一些定位练习，因为您必须偏移位置，以便光标永远不会悬停在弹出的控件上。

以 Microsoft Windows 工具提示为例。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-26T17:33:11.377

最后使用了一个精简的表格。为了自动关闭它，我在加载事件上启动了一个计时器，并在每次滴答时检查光标位置是否仍在表单内。效果很好。

* * *

## 回答 #3

> 赞同：-3
> 
> 时间：2008-11-26T00:11:11.277

我为这样的弹出窗口使用了thickbox（jQuery插件）。它允许您使用各种方法来显示数据（ajax、iFrame），您还可以从弹出窗口设置回调，以防您需要捕获数据。如果你想看看我最近是如何使用它的，你可以点击这个页面上的任何演示链接：

[http://www.prolifiq.net/Corporate/inaction.aspx](http://www.prolifiq.net/Corporate/inaction.aspx)

# sql - 如何获得 Postgres 中两个字段的 MIN()？

> ID：318988
> 
> 赞同：178
> 
> 时间：2008-11-25T21:44:57.330
> 
> 标签：sql, postgresql, min

假设我有一张这样的桌子：

```
name | score_a | score_b
-----+---------+--------
 Joe |   100   |   24
 Sam |    96   |  438
 Bob |    76   |  101
 ... |   ...   |  ... 
```

我想选择 score_a 和 score_b 的最小值。换句话说，类似：

```
SELECT name, MIN(score_a, score_b)
FROM table 
```

结果当然是：

```
name | min
-----+-----
 Joe |  24
 Sam |  96
 Bob |  76
 ... | ... 
```

但是，当我在 Postgres 中尝试此操作时，我得到，“没有函数与给定的名称和参数类型匹配。您可能需要添加显式类型转换。” MAX() 和 MIN() 似乎跨行而不是跨*列工作**。*

有可能做我正在尝试的事情吗？

* * *

## 回答 #1

> 赞同：328
> 
> 时间：2008-11-25T21:46:15.220

[最小](https://www.postgresql.org/docs/current/functions-conditional.html#FUNCTIONS-GREATEST-LEAST)（a，b）：

> `GREATEST`and函数从任意数量的`LEAST`表达式列表中选择最大值或最小值。表达式必须都可以转换为通用数据类型，这将是结果的类型（详见[第 10.5 节](https://www.postgresql.org/docs/current/static/typeconv-union-case.html)）。列表中的 NULL 值被忽略。仅当所有表达式的计算结果为 NULL 时，结果才会为 NULL。
> 
> 请注意，`GREATEST`and`LEAST`不在 SQL 标准中，而是一个常见的扩展。如果任何参数为 NULL，其他一些数据库会使它们返回 NULL，而不是仅当所有参数都为 NULL 时才返回 NULL...

* * *

## 回答 #2

> 赞同：32
> 
> 时间：2008-11-25T22:17:53.190

`LEAST()`这是PostgreSQL中函数的文档链接：

[http://www.postgresql.org/docs/current/static/functions-conditional.html#AEN15582](http://www.postgresql.org/docs/current/static/functions-conditional.html#AEN15582)

* * *

## 回答 #3

> 赞同：-22
> 
> 时间：2017-04-23T05:03:03.713

您可以通过将该数据放入这样的列中来获得答案：

```
SELECT name, MIN(score_a, score_b) as minimum_score
FROM table 
```

在这里，我们将最小值放在 和 之间`score_a`，`score_b`并通过将该值存储在名为 的列中来打印相同的值`minimum_score`。

# objective-c - NSTextView 中的填充——没有自定义绘图可能吗？

> ID：318995
> 
> 赞同：15
> 
> 时间：2008-11-25T21:47:23.737
> 
> 标签：objective-c, cocoa, user-interface

在 Cocoa 中，`NSTextView`文本和边框之间的边距相当浅。`NSTextView`有没有办法在不诉诸所有者绘图的情况下为 a 指定填充（文本和视图边框之间的距离） ？

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2008-11-25T22:01:21.727

NSTextView 方法可以满足`setTextContainerInset:`您的需求。参数的**高度**和**宽度**分量分别`NSSize`指定**垂直**和**水平**填充量。

例如

```
textView.textContainerInset = NSSize(width: 8, height: 8) 
```

# bug-tracking - 一个好的 BugTracking 工具应该具备什么能力？

> ID：318996
> 
> 赞同：3
> 
> 时间：2008-11-25T21:47:24.127
> 
> 标签：bug-tracking

我发现很多问题都在询问最好的工具，但没有人询问**功能，你真的需要**吗？以及您*从未*真正需要的功能？

（我发现自己在比较特征矩阵上的工具。我讨厌的东西，因为最后我将只使用 3-4 个最重要的特征，其余的保持不变。）

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-25T21:58:35.477

它需要：

1.  收集错误
2.  在优先级/严重性/到期日等方面订购错误
3.  将错误分配给开发人员
4.  跟踪错误历史
5.  将相似的错误链接在一起
6.  将错误链接到客户
7.  将已解决的错误链接到版本
8.  提供足够的信息或参考以获取信息以重现错误
9.  可供多个开发人员使用
10.  报告错误的客户端需要能够访问错误状态。

还有更多。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-25T21:56:07.417

简单的最终用户数据输入。没有这个你就不会输入错误，这等于毫无价值的错误工具。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-25T21:57:00.923

我无法为你回答这个问题，因为我无法预测什么对你很重要，或者你的情况是什么：

*   您是在大型或小型开发团队中，还是一个人的商店？
*   有一个系统可以让您的应用程序自动发送在您的错误跟踪软件中创建事件的故障报告，这是否有用？
*   能够预测发布时间表是否重要，或者这只是你在业余时间做的一个副项目？
*   与源代码控制集成重要吗？

实际上，**您是**唯一可以回答您需要哪些功能的人。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-25T21:57:42.950

这些是我认为最重要的 3 个必备功能：

*   网络界面，以便人们可以跟进
*   源代码控制集成，否则很难跟踪谁做了什么和部署补丁
*   带有电子邮件通知的可配置工作流程

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-25T21:57:48.317

我真的很想看到的东西：

1) 投票 - 即这个错误伤害了多少客户/用户？

2）严重性/优先级/其他 - 这些术语之间的区别是微妙的，通常（恕我直言）微不足道，但您必须对错误的重要性有所了解。大多数工具都有这个，但过于复杂了。

3) 依赖关系 - 内部（同一系统中的其他错误）和外部（外部库、软件等）。大多数错误在现实中都有这个，但它通常不能在数据库中表达出来，导致在分类时进行长时间的、毫无意义的辩论。

我认为基本上没有意义的事情：

1) 任何广泛的问卷调查——任何问太多问题的错误跟踪器都会得到错误的数据。这比没有更糟糕。

2) 有争议，但每天/每周/任何电子邮件通知都是强制性的。他们只是被归档为垃圾邮件/忽略/过滤掉。如果开发人员应该修复错误，而没有，那就是管理问题。软件无法解决此问题。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-25T21:59:09.203

需要：

*   电子邮件通知。*   地位*   群组通知*   团体权利*   网页界面*   简单/快速的界面

# .net - 构建 .Net 用户控件

> ID：318998
> 
> 赞同：1
> 
> 时间：2008-11-25T21:47:37.853
> 
> 标签：.net, visual-studio, user-controls

我目前正在使用 C# 构建一个 .Net 用户表单，并使用自定义用户控件填充它。每个控件都有一个访问器，用于获取和设置包含控件将填充的数据的对象。

在运行时，一切正常，但在设计时，我会在表单设计器中遇到错误。错误始终是“无法将 [ObjectA] 类型的对象转换为 [ObjectA] 类型的对象”

此时，我可以进入 resx 文件并删除引用 ObjectA 类型对象的行，然后进入 Designer.cs 文件并删除 InitializeComponent 中将控件的访问器设置为来自 resx 的数据的行文件。

完成此操作后，表单将显示在设计器中，直到它重建 InitializeComponet 并将行/数据重新插入 resx 和 InitializeComponent。

我在结束这个循环的控件和类设计中缺少什么？我尝试过使用 Liscence 使用模式和 Designer 运行时模式，结果不一，如果我能在我的设计中解决这个问题，我会更喜欢它。

感谢您提供的任何帮助。

更新：我添加了属性...

```
[DesignerSerializationVisibility(DesignerSerializationVisibility.Content)] 
```

到属性，我在设计器中遇到错误“ObjectA 为空，这是不允许的！”，所以我将行更改为...

```
[DesignerSerializationVisibility(DesignerSerializationVisibility.Hidden)] 
```

问题就消失了。由于我不需要在设计时设置任何这些属性，因此 hidden 属性可能更合适。

谢谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-25T22:22:45.990

听起来这可能是对象被序列化的方式。

设计器正在将对象二进制序列化到 resx 文件中，您可能需要在 .Designer.cs 文件中生成代码。

尝试将以下属性行放在属性上：[DesignerSerializationVisibility(DesignerSerializationVisibility.Content)]

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-25T21:53:48.607

以下是用户控件中设计时感知代码的示例：

```
protected override void OnPaintBackground(PaintEventArgs e)
{
    if (this.DesignMode)
    {
        base.OnPaintBackground(e);
    }
} 
```

这可能对您不起作用，但如果您将任何有问题的代码包装在“if (**!**this.DesignMode) {}”块中，您应该没问题（除非您需要该代码才能使控件正确呈现设计模式）。

# language-agnostic - 多少个函数参数太多了？

> ID：318999
> 
> 赞同：7
> 
> 时间：2008-11-25T21:47:49.507
> 
> 标签：language-agnostic, parameters

> **可能重复：**
> [有多少参数太多了？](https://stackoverflow.com/questions/174968/how-many-parameters-are-too-many)

我只是在编写一个接受多个值的函数，这让我开始思考。什么时候函数/方法的参数数量太多？何时（如果）表明设计存在缺陷？您是否设计/重构函数以接收结构、数组、指针等以减少参数数量？您是否重构传入的数据只是为了减少参数的数量？不过，这似乎不太适用于 OOP 设计。只是想看看其他人如何看待这个问题。

编辑：作为参考，我刚刚编写的函数接受了 5 个参数。我使用了我的 AP Econ 老师给我的几个定义。2个以上；小于 7。

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-11-25T21:51:23.337

我不知道，但当我看到它时我就知道了。

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2008-11-25T21:51:18.393

根据 Steve McConnell 在*Code Complete*中的说法，你应该

> 将例程的参数数量限制为大约七个

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-11-25T22:21:35.070

如果你不得不问，那可能太多了。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-11-25T21:56:43.920

我一般认为，如果参数与功能相关（例如，坐标或颜色分量），则应将它们封装为一个类以获得良好的度量。

并不是说我自己总是遵循这个；）

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-11-25T22:51:34.857

Robert C. Martin (Uncle Bob) 在[Clean Code: A Handbook of Agile Software Craftsmanship中建议最多 3 个](https://rads.stackoverflow.com/amzn/click/com/0132350882)

我现在没有这本书，但他的推理与一、二，在较小程度上，三个参数函数读得很好，并清楚地显示了函数的目的。

这当然与他对遵循[单一职责原则](http://en.wikipedia.org/wiki/Single_responsibility_principle)的非常简短、命名良好的函数的建议密切相关。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-25T21:51:29.483

快速回答：当你不得不停下来问这个问题时，你的问题太多了。

我个人喜欢将数字保持在六以下。如果需要更多，则解决方案取决于问题。一种方法是使用“setter”函数将值赋予最终将执行您想要的功能的对象。正如您所提到的，另一种选择是使用结构。无论哪种方式，你都不会真的出错。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-25T21:53:22.133

好吧，这肯定取决于您的功能正在做什么，至于有多少会被认为是“太多”。话虽如此，当然可以有一个带有许多不同参数的函数，这些参数是关于如何在函数内部处理某些情况的选项，并且对那些具有这些选项的合理默认值的函数进行重载。

随着 Intellisense（或其他 IDE 中的等价物）和工具提示的普及，显示 Visual Studio 中 XML 文档的注释，我真的不认为这个问题有明确的答案。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-11-25T21:54:36.530

过多的参数是“代码气味”。

您可以划分为多个方法或使用类来重新组合具有共同点的变量。

为“太多”设置一个数字是非常主观的，并且取决于您的组织和您使用的语言，经验法则是，如果您无法阅读方法的签名并知道它是什么做的比你可能有太多的信息。个人而言，我尽量不超过 5 个参数。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-11-25T22:42:10.957

我也听说过 7 这个数字，但不知何故，我觉得它源于一个你可以通过原始值传递的时代。

如今，您可以传递对封装了一些复杂状态（和行为）的对象的引用。使用其中的 7 个肯定太多了。

我个人的目标是避免使用超过 4 个。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-11-25T22:51:03.827

它很大程度上取决于参数的类型。如果它们都是整数，那么 2 可能太多了。（我怎么记得哪个顺序？）如果任何参数接受 null，那么这个数字会急剧下降。

真正的答案来自问自己：

*   当我阅读代码时，理解调用有多容易？
*   编写代码时记住正确的参数和参数顺序有多容易？

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-11-25T22:57:33.843

这取决于编程语言。在 C 中，看到带有 7 个参数的函数并不罕见。但是，在 C# 中，我很少看到超过 5 个参数，我个人通常使用少于 3 个参数。

```
// In C 
 draw_dot(x, y, size, red, green, blue, alpha)

// In C# 
 Point point(x,y);
 Color color(red,green,blue,alpha);

 Tool.DrawDot(point, color); 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-11-25T21:57:54.590

对我来说是5。

除此之外，很难管理（记住名称、顺序等）。另外，如果我走到那一步，我有默认值的版本调用这个版本。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-11-25T21:58:56.053

也取决于功能，如果您的功能需要大量的用户干预或变量，我不会超过 7-8 范围。就平均参数数量而言，我认为 5-6 是最佳选择。如果您使用的不止这些，您可能希望将类对象视为参数或其他较小的函数。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-11-25T22:13:34.683

它因人而异。就个人而言，当我无法通过阅读代码中的调用来立即理解函数调用在做什么时，是时候重构以减轻我的灰色单元格的压力了。

* * *

## 回答 #15

> 赞同：-1
> 
> 时间：2008-11-25T21:50:22.763

我会说最多 4 。上面的任何东西，我认为都应该放在一个类中。************