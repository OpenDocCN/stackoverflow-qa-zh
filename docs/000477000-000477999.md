# StackOverflow 问答 000477000-000477999

# mysql - 在不同的行上选择满足不同条件的值？

> ID：477006
> 
> 赞同：32
> 
> 时间：2009-01-25T01:01:04.593
> 
> 标签：mysql, sql, relational-division, sql-match-all

这是一个非常基本的查询，我无法弄清楚....

假设我有一个像这样的两列表：

```
userid  |  roleid
--------|--------
   1    |    1
   1    |    2
   1    |    3
   2    |    1 
```

我想获取所有具有`roleids`1、2 和 3 的不同用户 ID。使用上面的示例，我想要返回的唯一结果是`userid`1。我该怎么做？

* * *

## 回答 #1

> 赞同：120
> 
> 时间：2009-01-25T01:05:43.493

好的，我对此表示反对，所以我决定对其进行测试：

```
CREATE TABLE userrole (
  userid INT,
  roleid INT,
  PRIMARY KEY (userid, roleid)
);

CREATE INDEX ON userrole (roleid); 
```

运行这个：

```
<?php
ini_set('max_execution_time', 120); // takes over a minute to insert 500k+ records 

$start = microtime(true);

echo "<pre>\n";
mysql_connect('localhost', 'scratch', 'scratch');
if (mysql_error()) {
    echo "Connect error: " . mysql_error() . "\n";
}
mysql_select_db('scratch');
if (mysql_error()) {
    echo "Selct DB error: " . mysql_error() . "\n";
}

$users = 200000;
$count = 0;
for ($i=1; $i<=$users; $i++) {
    $roles = rand(1, 4);
    $available = range(1, 5);
    for ($j=0; $j<$roles; $j++) {
        $extract = array_splice($available, rand(0, sizeof($available)-1), 1);
        $id = $extract[0];
        query("INSERT INTO userrole (userid, roleid) VALUES ($i, $id)");
        $count++;
    }
}

$stop = microtime(true);
$duration = $stop - $start;
$insert = $duration / $count;

echo "$count users added.\n";
echo "Program ran for $duration seconds.\n";
echo "Insert time $insert seconds.\n";
echo "</pre>\n";

function query($str) {
    mysql_query($str);
    if (mysql_error()) {
        echo "$str: " . mysql_error() . "\n";
    }
}
?> 
```

输出：

```
499872 users added.
Program ran for 56.5513510704 seconds.
Insert time 0.000113131663847 seconds. 
```

这增加了 500,000 个随机用户角色组合，并且大约有 25,000 个符合所选标准。

第一个查询：

```
SELECT userid
FROM userrole
WHERE roleid IN (1, 2, 3)
GROUP by userid
HAVING COUNT(1) = 3 
```

查询时间：0.312s

```
SELECT t1.userid
FROM userrole t1
JOIN userrole t2 ON t1.userid = t2.userid AND t2.roleid = 2
JOIN userrole t3 ON t2.userid = t3.userid AND t3.roleid = 3
AND t1.roleid = 1 
```

查询时间：0.016s

这是正确的。我提出的加入版本**比聚合版本快二十倍。**

抱歉，我这样做是为了在现实世界中谋生和工作，在现实世界中，我们测试 SQL，结果不言而喻。

原因应该很清楚。聚合查询的成本会随着表的大小而增加。每一行都通过该`HAVING`子句进行处理、聚合和过滤（或不过滤）。加入版本将（使用索引）基于给定角色选择用户子集，然后将该子集与第二个角色进行检查，最后将该子集与第三个角色进行检查。每个[选择](http://en.wikipedia.org/wiki/Selection_(relational_algebra))（在[关系代数](http://en.wikipedia.org/wiki/Relational_algebra)术语中）都在越来越小的子集上起作用。由此你可以得出结论：

**加入版本的性能变得更好，匹配的发生率更低。**

如果只有 500 个用户（在上面的 500k 样本中）具有上述三个角色，则加入版本将显着加快。聚合版本不会（任何性能改进都是传输 500 个用户而不是 25k 用户的结果，加入版本显然也得到了）。

我也很想知道真正的数据库（即 Oracle）如何处理这个问题。所以我基本上在 Oracle XE 上重复了相同的练习（在与上一个示例中的 MySQL 相同的 Windows XP 桌面计算机上运行），结果几乎相同。

连接似乎不受欢迎，但正如我所展示的，聚合查询可能会慢一个数量级。

**更新：**经过一些[广泛的测试](http://www.cforcoding.com/2009/07/oracle-vs-mysql-vs-sql-server.html)，情况更加复杂，答案将取决于您的数据、您的数据库和其他因素。故事的寓意是测试，测试，测试。

* * *

## 回答 #2

> 赞同：30
> 
> 时间：2009-01-25T01:33:24.950

```
SELECT userid
FROM UserRole
WHERE roleid IN (1, 2, 3)
GROUP BY userid
HAVING COUNT(DISTINCT roleid) = 3; 
```

* * *

对于阅读本文的任何人：我的回答简单明了，并且获得了“已接受”状态，但请务必阅读@cletus 给出的[答案。](https://stackoverflow.com/questions/477006/sql-statement-join-vs-group-by-and-having/477013#477013)它的性能要好得多。

* * *

只是大声思考，编写@cletus 描述的自连接的另一种方法是：

```
SELECT t1.userid
FROM userrole t1
JOIN userrole t2 ON t1.userid = t2.userid
JOIN userrole t3 ON t2.userid = t3.userid
WHERE (t1.roleid, t2.roleid, t3.roleid) = (1, 2, 3); 
```

这对你来说可能更容易阅读，并且 MySQL 支持这样的元组比较。MySQL 也知道如何智能地利用覆盖索引进行此查询。只需运行它`EXPLAIN`并在所有三个表的注释中看到“使用索引”，这意味着它正在读取索引并且甚至不必触摸数据行。

我在我的 Macbook 上使用 MySQL 5.1.48 运行了超过 210 万行的查询（PostTags 的 Stack Overflow 7 月数据转储），它在 1.08 秒内返回了结果。在分配了足够内存的体面服务器上`innodb_buffer_pool_size`，它应该更快。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-08-07T20:08:12.143

执行此操作的经典方法是将其视为关系划分问题。

英语：选择没有缺少任何所需角色标识值的用户。

我假设您有一个 UserRole 表所引用的 Users 表，并且我假设所需的 roleid 值在一个表中：

```
create table RoleGroup(
  roleid int not null,
  primary key(roleid)
)
insert into RoleGroup values (1);
insert into RoleGroup values (2);
insert into RoleGroup values (3); 
```

我还将假设所有相关列都不可为空，因此 IN 或 NOT EXISTS 不会有任何意外。这是一个表达上述英语的 SQL 查询：

```
select userid from Users as U
where not exists (
  select * from RoleGroup as G
  where not exists (
    select R.roleid from UserRole as R
    where R.roleid = G.roleid
    and R.userid = U.userid
  )
); 
```

另一种写法是这样

```
select userid from Users as U
where not exists (
  select * from RoleGroup as G
  where G.roleid not in (
    select R.roleid from UserRole as R
    where R.userid = U.userid
  )
); 
```

这可能会或可能不会最终有效，具体取决于索引、平台、数据等。在网上搜索“关系划分”，你会发现很多。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-01-25T01:34:34.947

假设 userid，roleid 包含在唯一索引中（意味着不能有 2 个记录，其中 userid = x 和 roleid = 1

```
select count(*), userid from t
where roleid in (1,2,3)
group by userid
having count(*) = 3 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2010-11-26T07:08:44.387

```
select userid from userrole where userid = 1
intersect
select userid from userrole where userid = 2
intersect
select userid from userrole where userid = 3 
```

这不能解决问题吗？这在典型的关系数据库上的解决方案有多好？查询优化器会自动优化吗？

* * *

## 回答 #6

> 赞同：-6
> 
> 时间：2009-01-25T01:27:26.117

如果您需要任何类型的通用性（不同的 3 角色组合或不同的 n 角色组合）...我建议您为您的角色使用位掩码系统并使用位运算符来执行您的查询...

# java - Apache CollectionUtils 的良好用途

> ID：477012
> 
> 赞同：2
> 
> 时间：2009-01-25T01:05:38.580
> 
> 标签：java, apache, oop, collections

大约一年前我发现了[CollectionUtils](http://commons.apache.org/collections/apidocs/org/apache/commons/collections/CollectionUtils.html)类，其中一些方法，如收集和转换，看起来真的很酷，但是，我还没有找到一个用途，它不会通过语法更简洁和\或更容易编写带有简单循环的逻辑。

有没有发现这些方法（transform、predicatedCollection、collect 等）的独特\有用的用途，例如将转换器或谓词作为参数的方法？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-25T04:24:53.107

我认为关键问题是设计/编码的灵活性。

如果您有一个用例（例如，选择满足某些特定条件的集合成员），那么手动编写一个相对简单的循环就可以了。另一方面...

假设可能的条件集变得很大，或者甚至可以在运行时即时组合（甚至是动态的，基于用户输入/交互）。或者假设有一些非常复杂的条件可以用运算符（例如A和B，C而不是D等）组合成更多的情况。

假设在做出选择之后，还有一些其他的处理需要对结果集合进行。

现在考虑一下代码的结构，它可能是由一种暴力的、内联的方法来编写上述内容的：一个包含复杂决策过程的外部循环，用于确定要执行哪些测试，与执行一个测试的代码混合在一起或更多与集合中“幸存的”成员有关的东西。这样的代码往往（尤其是随着时间的推移会随着维护而变得）难以理解和难以修改而没有引入缺陷的风险。

所以关键是要追求一个战略，其中每个方面：

*   基本的“选择某物”过程，
*   表示基本标准的谓词，
*   组合构成谓词的运算符，以及
*   对值进行操作的变压器，

可以独立编码和测试，然后根据需要拼接在一起。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-04T11:45:37.690

当您有对象的可能替代表示时，collect() 很有用。

例如，最近我正在处理一段代码，它需要匹配来自两个不同来源的对象列表。这些对象属于不同的类，因为它们在代码中的不同点使用，但出于我的目的，它们具有相同的相关概念（即它们都有一个 ID，都有一个属性路径，都有一个“级联”标志等） .

我发现定义这些属性的简单中间表示（作为内部类）要容易得多，为两个具体对象类定义转换器（同样非常简单，因为它只是使用相关的访问器方法来获取属性），然后用于`collect()`将我传入的对象转换为中间表示。一旦它们在那里，我就可以使用标准的 Collections 方法来比较和操作这两个集合。

因此，作为一个（半）具体示例，假设我需要一种方法来检查表示层中的对象集是否是缓存在数据层中的对象的子集。使用上面概述的方法，可以这样做：

```
public boolean isColumnSubset(PresSpec pres, CachedDataSpec dataSpec)
{
   final List<IntermediateRepresentation> presObjects = CollectionUtils.collect(pres.getObjects(), PRES_TRANSFORMER);
   final List<IntermediateRepresentation> dataObjects = CollectionUtils.collect(dataSpec.getCached(), DATA_TRANSFORMER);

   return dataObjects.containsAll(presObjects);
}
```

对我来说，这更具可读性，最后一行传达了该方法在*做*什么的真实意义，而不是循环的等价物：

```
public boolean isColumnSubset(PresSpec pres, CachedDataSpec dataSpec)
{
   for (PresSpecificObject presObj : pres.getObjects())
   {
      boolean matched = false;
      for (CachedDataObject dataObj : dataSpec.getCached())
      {
         if (areObjectsEquivalent(presObj, dataObj)) // or do the tests inline but a method is cleaner
         {
            matched = true;
            break;
         }
      }

      if (matched == false)
      {
         return false;
      }
   }

   // Every column must have matched
   return true;
}
```

两者的效率可能差不多，但就可读性而言，我想说第一个更容易立即理解。尽管它总体上是更多的代码行（由于定义了一个内部类和两个转换器），但将遍历实现与实际的“真假”逻辑分开使得后者更加清晰。另外，如果您有任何 KLOC 指标，它也不能成为珠子。;-)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-25T01:27:20.563

尽管我原则上同意 Uri，但没有闭包或函数字面量或其他任何东西，Java 在实际使用诸如收集、转换等方法时会产生相当高的语法成本。在很多情况下，实际代码行数相同或更多比您编写简单的循环。addAll、removeAll 以及它们所有不将函数对象作为参数的朋友都是必不可少的。

所有这些也适用于同样出色的[Google Collections API](http://code.google.com/p/google-collections/)。

遗憾的是 Sun 有能力在 Java 7 中解决这些问题，但[似乎他们不会](http://rickyclarkson.blogspot.com/2008/12/java-just-died-no-closures-in-java-7.html)。懦夫。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-25T01:17:41.143

我不确定我是否同意你的说法......

一个简单的循环增加了复杂性，并且比具有合理名称的调用更不“可读和明显”。

重构布道者会声称您的目标通常应该是创建调用其他操作的扁平和简短的函数。虽然 addAll、find 等方法很容易自己实现，但避免它们会要求读者掌握比单个单词更复杂的东西，并且可能导致代码复制。

恕我直言，CollectionUtils 实际上提供了比标准 Java 集合库更简洁的操作。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-25T01:53:13.973

虽然我们不使用 CollctionUtils，但我们已经实现了一些我们自己和我们经常使用的类似实用程序

> 空的（集合 c）

测试集合、字符串等是否为空

> 拥有（...）

只返回 !empty(...)

> mapToProperty（集合 c，字符串属性，类 newType）

这使用反射将 T1 的集合映射到 T2 的集合以调用“属性”

> 内爆（集合 c，字符串 sep）

带有 c 元素的分隔字符串

# c# - 如何使用 LINQ to SQL 获取完整节点路径？

> ID：477017
> 
> 赞同：1
> 
> 时间：2009-01-25T01:08:43.597
> 
> 标签：c#, .net, linq-to-sql

我在 SQL 表中定义了一个基本层次结构：

```
Id    ParentId  Name
----------------------
1     Null      Root
2     1         Node1
3     2         Node2 
```

是否有一种很好的 LINQ 方式来获取节点的完整路径？例如，我想传递 Node2 的 Id 并获取完整路径，如`Root/Node1/Node2`.

先感谢您 ：）

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-25T02:19:37.540

我想不出在单个查询中针对任意长度路径执行此操作的方法。我可能会求助于使用循环，边走边构建路径，直到到达没有父节点的节点。

```
 var node = db.Nodes.Where( n => n.Name == "Node2" ).SingleOrDefault();
 string path = string.Empty;
 while (node != null)
 {
     path = string.Format( "/{0}{1}", node.Name, path );
     node = db.Nodes.Where( n => n.ParentId == node.Id ).SingleOrDefault();
 } 
```

# iphone - iPhone 麦克风音量

> ID：477020
> 
> 赞同：0
> 
> 时间：2009-01-25T01:11:59.550
> 
> 标签：iphone, cocoa-touch, audio, avfoundation

有没有办法用 AVFoundation 轮询麦克风输入音量？我已经看过像 SpeakHere 这样的 CoreAudio 示例，但我真的只需要当前值。CA是我唯一的选择吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-09T06:25:03.750

您应该检查 SCListener。这是获得麦克风平均或峰值电平的简单方法。

[http://github.com/stephencelis/sc_listener](http://github.com/stephencelis/sc_listener)

# inversion-of-control - 测试类型是否已在 Unity 中注册

> ID：477042
> 
> 赞同：8
> 
> 时间：2009-01-25T01:40:54.873
> 
> 标签：inversion-of-control, unity-container

我是否可以在不调用 Resolve 并捕获异常的情况下测试类型是否已在 Unity 容器中注册？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2010-02-27T14:44:48.593

Unity 2.0 将提供一个`IsRegistered`方法，您可以使用该方法来确定某个类型是否已在容器中注册。

Unity 2.0 的 Beta1 于 2 月 10 日在 Codeplex 上可用。查看发行说明并在此处下载；[http://unity.codeplex.com/wikipage?title=Unity2%20Beta1](http://unity.codeplex.com/wikipage?title=Unity2%20Beta1)

更新：

于 2010 年 2 月 27 日下载并测试了 Unity 2.0 beta 1，到目前为止它已经准备好生产了。如果您今天使用 Unity 1.2，您将不得不做一些主要工作才能让 Unity 2.0 正常工作，因为 IUnityContainer 接口不完整（？）。因此，如果您想让 IsRegistered 方法在今天工作，您可以创建一个这样的扩展方法：

```
public static class UnityContainerExtensions
{
    public static bool IsRegistered<T>(this IUnityContainer container)
    {
        try
        {
            container.Resolve<T>();
            return true;
        }
        catch
        {
            return false;
        }
    }
} 
```

请注意，我没有`ResolveAll`在这里使用。这样做的原因是它`ResolveAll`不会返回 Unity 文档中所述的默认（未命名）注册：

> 如果您注册了多个具有相同类型但名称不同的类型，则此方法很有用。
> 
> 请注意，此方法不会返回默认（未命名）注册的实例。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-25T02:04:32.750

您唯一的其他选择（当前）是使用`ResolveAll<T>()`和枚举结果。

# macos - 文件权限标志 @ 和 + 的用途是什么？

> ID：477050
> 
> 赞同：8
> 
> 时间：2009-01-25T02:01:03.083
> 
> 标签：macos, permissions

我的 Mac 有文件夹 Shared 和 Public 文件夹。他们的权限是 drwxr-xr-x+（公共）和 drwxrwxrwt@（共享）。符号 + 和 @ 是什么意思？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-01-25T02:08:07.720

@ 表示有“扩展属性”。类型

```
ls -l@ 
```

看看它们是什么。使用该命令，所有带有@ 的内容都会有一些额外的行来解释为什么它有@。以我的经验，@ 通常意味着文件将使用默认应用程序以外的应用程序打开（即，它可能使用与您习惯不同的文本编辑器打开），或者有时它的编码与$LANG 指定的默认值。

从“ls”的手册页：

> 如果文件或目录具有扩展属性，则 -l 选项打印的权限字段后跟一个“@”字符。否则，如果文件或目录具有扩展的安全信息，则 -l 选项打印的权限字段后跟一个“+”字符。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-25T02:17:57.467

我不熟悉扩展属性，但是扩展的安全信息，也就是 ACL，对文件权限提供了更细粒度的控制。基本上，每当您在文件/目录上设置超出用户/组/其他的通常选择的读/写/执行权限时，就会出现 +。您可以通过执行“ls -le”来查看 ACL。

# php - 为什么我的 PHP 不会返回 MySQL 存储过程？

> ID：477051
> 
> 赞同：1
> 
> 时间：2009-01-25T02:01:49.697
> 
> 标签：php, mysql

好吧，我有我编写的这个 MySQL 存储过程，如果我在 phpMyAdmin 中运行以下内容，则会正确返回：

```
SELECT game_name,urlfriendly(game_name) AS game_name2 FROM games 
```

但是，如果我尝试运行以下代码，则会收到错误“警告：在第 # 行的 /filepath.php 中为 foreach() 提供的参数无效”

```
foreach ($this->database->query("SELECT game_name,urlfriendly(game_name) AS game_name2 FROM games") as $games)
{
    echo $games["game_name"] . " " . $games["game_name2"];
} 
```

但是，如果我运行它，一切都会好起来的：

```
foreach ($this->database->query("SELECT game_name FROM games") as $games)
{
    echo $games["game_name"];
} 
```

这意味着存储的过程不会返回到 PHP。

有任何想法吗？

**编辑**这是存储的过程（但我怀疑这是问题，因为 phpMyAdmin 可以很好地从中提取值）

分隔符 //

```
DROP FUNCTION urlfriendly
//
CREATE FUNCTION urlfriendly (unsafe TEXT) RETURNS TEXT

DETERMINISTIC

BEGIN

DECLARE safe TEXT;

SET safe = REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(LOWER(unsafe),' ','-'),'&','and'),'`',''),'~',''),'!',''),'@',''),'#',''),'$',''),'%',''),'^',''),'*',''),'(',''),')',''),'_',''),'+',''),'=',''),'[',''),'{',''),']',''),'}',''),'|',''),'\\',''),"'",""),'"',''),':',''),';',''),'<',''),',',''),'>',''),'.',''),'/',''),'?','');

RETURN safe;

END
// 
```

**EDIT2**这是从 MySQL 返回的错误

```
execute command denied to user 'username'@'localhost' for routine 'databasename.urlfriendly' ) 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-25T02:09:14.660

你能得到[`errorInfo`](http://us2.php.net/manual/en/pdostatement.errorinfo.php)吗？

你能跑吗：

```
GRANT EXECUTE ON `database`.* TO 'username'@'localhost' 
```

来自 phpMyAdmin？

# javascript - 使用 dojo 访问远程 CSV 时出现问题

> ID：477053
> 
> 赞同：3
> 
> 时间：2009-01-25T02:05:54.433
> 
> 标签：javascript, dojo, xss

我正在尝试创建一个网站，在其中将我的数据托管在 google 电子表格上，并使用 dojo 在其浏览器中向用户显示数据。

但是，我收到了错误

```
Access to restricted URI denied" code: "1012 
```

当浏览器遇到：

```
var stateStore = new dojox.data.CsvStore(
{url: "http://spreadsheets.google.com/pub?key=p0jvMlPF5YqcUllrbwZzQBg&output=csv&gid=0", 
label: "name"}); 
```

而用本地存储的相同 CSV 副本替换它可以正常工作。

从我的谷歌搜索告诉我，这是由于现代浏览器的安全限制试图保护您免受跨站点脚本攻击。当然，为了我的页面，我想要某种方式能够将该域“列入白名单”。

有什么建议么？

完整的 HTML 代码是

```
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <style type="text/css">
        @import "dojo-release-1.2.3/dijit/themes/tundra/tundra.css";
        @import "dojo-release-1.2.3/dojo/resources/dojo.css"
    </style>
    <script type="text/javascript" src="dojo-release-1.2.3/dojo/dojo.js"
         djConfig="parseOnLoad:true, isDebug: true"></script>
    <script>
        dojo.require("dojox.data.CsvStore");
        dojo.require("dijit.Tree");
        dojo.require("dojo.parser");
    </script>
    <script type="text/javascript">
        var stateStore = new dojox.data.CsvStore({url: "http://spreadsheets.google.com/pub?key=p0jvMlPF5YqcUllrbwZzQBg&output=csv&gid=0", label: "name"});
//      var stateStore = new dojox.data.CsvStore({url: "states.csv", label: "name"});
    </script>

</head>
<body class="tundra">
<!--    <div dojoType="dojox.data.CsvStore" url="http://spreadsheets.google.com/pub?key=p0jvMlPF5YqcUllrbwZzQBg&output=csv&gid=0" jsid="stateStore" /> -->
    <div dojoType="dijit.Tree" store="stateStore" labelAttr="name" label="States"></div>
</body>
</html> 
```

提前致谢，

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-25T02:26:06.077

[**同源政策**](http://en.wikipedia.org/wiki/Same_origin_policy)。

用于访问页面的域必须与请求的域匹配。因此，您无法仅使用 JavaScript 从其他地方访问电子表格.google.com。

我听到最多的解决方法是[**跨域代理**](http://ajaxpatterns.org/Cross-Domain_Proxy)——一个服务器端脚本，它获取（或发布）到另一个域并将结果回显到 JavaScript。

# java - AIR 1.5 应用程序有没有办法从标准输入读取并写入标准输出/标准错误？

> ID：477055
> 
> 赞同：0
> 
> 时间：2009-01-25T02:08:24.303
> 
> 标签：java, air, stdout, redirect, stdin

一直在研究 Adob​​e AIR 1.5 的文件系统相关类，但是到目前为止我还没有看到任何提到如何与 stdin/stdout/stderr 交互的东西。有点令人惊讶，因为 AIR 使得与本地文件系统交互成为可能，并且有一个 FileStream 类。

我想从父进程启动 AIR 应用程序，然后通过 stdin/stdout 通过异步 i/o 与 AIR 应用程序交互。将避免需要在本地主机上使用端口并进行套接字 i/o。[（是的，这是关于以Merapi](http://www.merapiproject.net/)风格的跨平台方式桥接 java 和 AIR 。）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-25T12:38:01.223

我认为这是不可能的——你将不得不使用套接字。如果您在 Windows 上，您可以检查[http://www.northcode.com/](http://www.northcode.com/)之类的内容是否能够实现此目的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-02T02:16:03.037

事实上，我研究了 AIR 1.5 文档，看起来他们忽略了对 stdin、stdout、stderr 文件管道的任何访问——尽管它们在 AIR 支持的所有平台上都可用。

我想我的想法是 GUI 应用程序不需要打扰通常与命令行程序相关的东西。但是，对于与子进程进行双向通信的父进程，这样的管道完全可以（我已经编写了很多以这种方式工作的 perl 多处理程序）。

通过 stdin、stdout、stderr 的进程间管道实现的 Merapi 桥库将授予 AIR 一种 Microsoft PowerShell 能力（可以在 std 进程间管道上编组 .NET 对象）。

# python - 如何在 Python 中读取 Unicode 输入并比较 Unicode 字符串？

> ID：477061
> 
> 赞同：31
> 
> 时间：2009-01-25T02:19:21.037
> 
> 标签：python, python-2.7, unicode

我在 Python 中工作，想以 Unicode 格式读取用户输入（从命令行），即 Unicode 等价于`raw_input`?

另外，我想测试 Unicode 字符串的相等性，看起来标准`==`不起作用。

* * *

## 回答 #1

> 赞同：54
> 
> 时间：2009-01-25T10:25:54.470

[`raw_input()`](https://docs.python.org/2/library/functions.html#raw_input "原始输入（）")返回由操作系统或 UI 工具编码的字符串。困难在于知道哪个是解码。您可以尝试以下操作：

```
import sys, locale
text= raw_input().decode(sys.stdin.encoding or locale.getpreferredencoding(True)) 
```

在大多数情况下应该可以正常工作。

为了帮助您，我们需要更多关于无法进行 Unicode 比较的数据。但是，这可能是标准化的问题。考虑以下：

```
>>> a1= u'\xeatre'
>>> a2= u'e\u0302tre' 
```

`a1`并且`a2`等价但不等价：

```
>>> print a1, a2
être être
>>> print a1 == a2
False 
```

所以你可能想使用以下[`unicodedata.normalize()`](https://docs.python.org/2/library/unicodedata.html#unicodedata.normalize "unicodedata.normalize()")方法：

```
>>> import unicodedata as ud
>>> ud.normalize('NFC', a1)
u'\xeatre'
>>> ud.normalize('NFC', a2)
u'\xeatre'
>>> ud.normalize('NFC', a1) == ud.normalize('NFC', a2)
True 
```

不过，如果您向我们提供更多信息，我们或许可以为您提供更多帮助。

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2009-01-25T02:38:34.070

它应该工作。`raw_input`返回一个字节字符串，您必须使用正确的编码对其进行解码才能获取您的`unicode`对象。例如，以下适用于我在 Python 2.5 / Terminal.app / OSX 下：

```
>>> bytes = raw_input()
日本語 Ελληνικά
>>> bytes
'\xe6\x97\xa5\xe6\x9c\xac\xe8\xaa\x9e \xce\x95\xce\xbb\xce\xbb\xce\xb7\xce\xbd\xce\xb9\xce\xba\xce\xac'

>>> uni = bytes.decode('utf-8') # substitute the encoding of your terminal if it's not utf-8
>>> uni
u'\u65e5\u672c\u8a9e \u0395\u03bb\u03bb\u03b7\u03bd\u03b9\u03ba\u03ac'

>>> print uni
日本語 Ελληνικά 
```

至于比较 unicode 字符串：你能发布一个比较不起作用的例子吗？

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-25T02:42:49.723

我不太确定，您所说的“Unicode 格式”是指哪种格式，有几种。UTF-8？UTF-16？在任何情况下，您都应该能够读取普通字符串，`raw_input`然后使用 strings`decode`方法对其进行解码：

```
raw = raw_input("Please input some funny characters: ")
decoded = raw.decode("utf-8") 
```

如果您有不同的输入编码，只需使用“utf-16”或其他任何东西而不是“utf-8”。另请参阅[编解码器模块文档](http://docs.python.org/library/codecs.html#encodings-and-unicode)以了解不同类型的编码。

然后比较应该可以正常工作`==`。如果您有包含特殊字符的字符串文字，您应该在它们前面加上“u”以将它们标记为 unicode：

```
if decoded == u"äöü":
  print "Do you speak German?" 
```

如果您想再次输出这些字符串，您可能希望以所需的编码再次对它们进行编码：

```
print decoded.encode("utf-8") 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-25T03:20:14.640

在一般情况下，可能无法比较 unicode 字符串。问题是有几种方法可以组成相同的字符。一个简单的例子是重音罗马字符。尽管基本上所有常用的重音字符都有代码点，但由非重音基本字母和非间距重音组成它们也是正确的。这个问题在许多非罗马字母表中更为重要。

# sql - 是否可以在不使用游标的情况下在集合上执行存储过程？

> ID：477064
> 
> 赞同：20
> 
> 时间：2009-01-25T02:24:38.013
> 
> 标签：sql, sql-server, tsql, stored-procedures

我想在集合中的每一行上执行一个存储过程，而不使用像这样的游标： 我在 SQL Server 2005 中使用 T-SQL。我认为这可能使用函数，但我想尽可能使用存储过程（公司标准）

`SELECT EXEC dbo.Sproc @Param1 = Table1.id
FROM Table1`

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-01-25T02:30:49.343

是的。如果您有一列可以在表中使用来标记已处理的列，则可以使用 WHILE EXISTS：

```
DECLARE @Id int
WHILE EXISTS(SELECT * FROM Table1 WHERE Processed='N')
BEGIN
 SELECT Top 1 @Id = id from Table1 WHERE Procesed='N'
 EXEC dbo.Sproc @Id
 UPDATE Table1 SET Processed = 'Y' WHERE Id = @Id
END 
```

或者，将 id 转储到临时表或表变量中，并在完成后删除：

```
DECLARE @HoldTable table (Id int PRIMARY KEY)
DECLARE @Id int
INSERT INTO @HoldTable SELECT Id FROM Table1
WHILE EXISTS(SELECT * FROM @HoldTable)
BEGIN
 SELECT @Id = id from @HoldTable
 EXEC dbo.Sproc @Id
 DELETE FROM @HoldTable where Id = @Id
END 
```

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2009-01-25T21:16:47.267

如果您只使用 SQL Server 2005 或更新版本，不关心向后兼容性并且可以将您的代码转换为用户定义函数（而不是存储过程），那么您可以使用新的“CROSS APPLY”运算符，它使用的语法与您想要的非常相似。我在[这里](http://www.sqlteam.com/article/using-cross-apply-in-sql-server-2005)找到了一个简短的介绍（当然，你也可以阅读 BOLs 和 MSDN）

假设您的 SP 返回一个名为*out_int*的值，您的示例可以重写为：

```
SELECT T.id, UDF.out_int
FROM 
    Table1 T
CROSS APPLY
    dbo.fn_My_UDF(T.id) AS UDF 
```

这将从 Table1 中检索每个“id”并使用它来调用 fn_My_UDF，其结果将出现在原始参数之外的最终结果集中。

“CROSS APPLY”的一个变体是“OUTER APPLY”。它们等同于“INNER JOIN”和“LEFT JOIN”，但用于连接表和 UDF（并同时调用第二个）。

如果你**必须**（根据尖头发老板的明确命令）使用 SP，那么 - 运气不好！您必须使用游标，或者尝试作弊：将代码更改为 UDF，并创建包装器 SP：D。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-25T19:55:19.740

坦率地说，如果我需要为一组数据执行存储过程，而不是为其写入一条记录，我会编写基于集合的代码而不是使用存储过程。如果您要针对大型数据集运行，这是唯一有效的方法。您可以从几小时到几秒甚至几毫秒来执行存储过程所做的插入。当您需要处理一组数据时，不要使用基于记录的处理，尤其是出于诸如重用代码之类的愚蠢原因。性能胜过代码的重用。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-25T13:41:23.800

10 次中有 9 次你可以在没有光标或 while 循环的情况下做你想做的事。但是，如果您必须使用其中一个，我发现 while 循环往往更快。

此外，如果您不想删除或更新表，您可以使用以下内容：

```
DECLARE @id [type]
SELECT @id = MIN([id]) FROM [table]
WHILE @id IS NOT NULL
BEGIN
    EXEC [sproc] @id
    SELECT @id = MIN([id]) FROM [table] WHERE [id] > @id
END 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-25T20:03:51.580

如果可能的话，我会编写从临时表读取的存储过程的第二个版本。

如果那不可能，那么您可能就不走运了。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2019-05-11T19:36:14.110

使用动态 SQL看看这个[答案。](https://stackoverflow.com/a/13887191/4271117)这是根据您的查询的样子。

```
DECLARE @TSQL NVARCHAR(MAX) = ''
SELECT @TSQL = @TSQL + N'EXEC dbo.Sproc ' + id + '; 
' -- To insert a line break
FROM Table1
EXEC sp_executesql @TSQL 
```

如果您`PRINT @TSQL`. 请注意，[如何插入换行符](https://stackoverflow.com/a/549244/4271117)。

```
EXEC dbo.Sproc id1; 
EXEC dbo.Sproc id2; 
EXEC dbo.Sproc id3;
... 
```

如果您不需要存储过程，它可以更容易。我曾经需要从视图中根据每一行更新一个表（代码是列名，[值] 是值）。因为视图是动态的并且每次返回不同的行，因此也返回不同的列值对。我在不使用任何存储过程的情况下重新编写了查询。

```
DECLARE @TSQL NVARCHAR(MAX), @Id VARCHAR(10) = 50

SELECT @TSQL = COALESCE(@TSQL + '''
,','') + Code + ' = ''' + [Value] 
FROM view
WHERE Id = @Id

SET @TSQL = N'UPDATE tableName
SET ' + @TSQL + ''' 
WHERE Id = ' + @Id
PRINT @TSQL
--EXEC SP_EXECUTESQL @TSQL 
```

`PRINT @TSQL`：

```
UPDATE tableName
SET Discussed = 'Yes'
,Other = 'Blue'
,IntakeRating = 'H: < $25k'
,IntakeValueEstimate = '25'
,OpportunityDecision = 'Intake'
,Fee = '33 1/3'
,Fee2 = '40'
,IsManager = 'Yes' 
WHERE Id = 50 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2012-04-17T17:39:21.097

这个循环有效，但对我的 SP 来说很慢。我认为正确的答案是 HLGEM，最好的办法是编写更好的批量查询。

```
DECLARE @id INT
SET @id = 0

DECLARE @max INT
SELECT TOP 1 @max = TableID
FROM dbo.Table
ORDER BY TableID desc

-- loop until BREAK
-- this is how you can perform a DO-WHILE loop in TSQL
WHILE (1 = 1) 
BEGIN
    SELECT      
        TOP 1 @id = TableID
        FROM dbo.Table
        WHERE TableID > @id 

    IF @id IS NOT NULL
    BEGIN        
        -- call you SP here
        PRINT @id        
    END

    -- break out of the loop once the max id has been reached
    IF @id = @max BREAK 
END 
```

# php - PHP 类属性可以等于另一个类属性吗？

> ID：477066
> 
> 赞同：4
> 
> 时间：2009-01-25T02:26:30.227
> 
> 标签：php, class, properties

我想做这个：

```
class MyClass {
   var $array1 = array(3,4);
   var $array2 = self::$array1;
} 
```

并且`$array2`不起作用。

您是否有使类属性等于另一个类属性的解决方案/技巧？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-25T02:32:17.373

根据[`PHP Manual`](http://us.php.net/manual/en/language.oop5.basic.php)：

> 默认值必须是常量表达式，而不是（例如）**变量**、类成员或函数调用。

你可以做的是：

```
class MyClass {
    var $array1 = array(3,4);
    var $array2 = array();

    function MyClass() {
        $this->array2 = $this->array1;
    }
} 
```

每次创建新对象时都会调用该函数`MyClass`（或者如果您在 PHP5 中），因此任何实例都将具有与其属性具有相同值的属性。`__construct``MyClass``array2``array1`

```
$myclass = new MyClass();
print_r($myclass->array1); // outputs Array ( [0] => 3 [1] => 4 ) 
print_r($myclass->array2); // outputs Array ( [0] => 3 [1] => 4 ) 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-25T03:06:34.683

我是 PHP 新手，但 Paolo 的回答似乎只是将构造函数中的**值**初始化为相同，但这实际上并没有使两个变量引用相同的内容。这个怎么样：

```
class MyClass {
    var $array1 = array(3,4);
    var $array2 = array();

    function MyClass() {
        $this->array2 = &$this->array1;
    }
}

$myclass = new MyClass();
print_r($myclass->array1); // outputs Array ( [0] => 3 [1] => 4 ) 
print_r($myclass->array2); // outputs Array ( [0] => 3 [1] => 4 )
echo "<br />";
$myclass->array1[0] = 1;
$myclass->array2[1] = 2;
print_r($myclass->array1); // outputs Array ( [0] => 1 [1] => 2 ) 
print_r($myclass->array2); // outputs Array ( [0] => 1 [1] => 2 ) 
```

添加引用后，**两个**类属性值都会在其中任何一个发生更改时发生更改。我错过了什么吗？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-25T05:38:05.907

您的回答，Paolo 和 notruthless，都非常好，非常感谢！

如果我希望这两个属性保持同步：

```
function MyClass() {
    $this->array2 = &$this->array1;
} 
```

如果我希望这两个数组最初具有相同的值，但后来想单独修改它们，我删除'&'：

```
function MyClass() {
    $this->array2 = $this->array1;
} 
```

# c# - 使用 linq 从动态 sql 查询中检索和打印数据

> ID：477075
> 
> 赞同：4
> 
> 时间：2009-01-25T02:32:47.670
> 
> 标签：c#, sql, linq

我有一些现有代码使用 ADO.NET 从数据库中检索数据，我想将其转换为 linq。

代码所做的是通过命令行接收 SQL 查询，执行它，返回行及其列名，然后将它们打印到屏幕上。我想知道如何在 linq 中编写此代码。

整个 sql 查询必须通过命令行给出，因为我想限制从哪里选择行。这是我希望它完成的唯一方法，所以除非你有一种可以这样工作的方法，否则我不能使用它。除了我自己之外，没有人可以访问该程序，因此安全性不是问题。

```
private static SqlConnection sqlConnection = new SqlConnection();

private static void OConnection()
{
    sqlConnection = new SqlConnection();
    sqlConnection.ConnectionString = MyConsoleApp.Properties.Settings.Default.ConnStr;
    sqlConnection.Open();
} 
```

...

```
string query = Console.ReadLine();
OpenConn();
SqlCommand command = new SqlCommand(query, sqlConnection);
SqlDataReader reader = command.ExecuteReader();

if (reader != null)
{
    while (reader.Read())
    {
        for (int i = 0; i < reader.FieldCount; i++)
        {
            Console.Write("| {0}: {1}", reader.GetName(i), reader.GetValue(i));
        }
        Console.WriteLine();
    }
} 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-25T02:50:09.100

我在这里看不到迁移到 LINQ 的价值。LINQ 的美妙之处在于您可以使用域对象的语言而不是 T-SQL 来编写查询。在您的情况下，您只想接受实际的 SQL 命令。似乎解构命令，将其转换为 LINQ（使用反射来识别数据上下文中的适当表），然后只执行查询以打印出结果对象的属性，似乎会做更多的工作。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-25T02:53:30.170

您可以将存储过程添加到数据库中，然后将它们添加到 linq。Linq 提供了很好的代码生成来处理使用延迟执行获取和返回行的存储过程。

如果您希望执行一个不是存储过程的动态查询，那么您将需要坚持使用 ADO.Net 或学习如何在 LINQ 中表达您的查询。也许如果您提供查询，我们可以帮助您使用数据上下文执行此操作。

PS。当我们迁移到 LINQ 时，我发现我们必须编写的样板 ADO.Net 代码的数量急剧下降。我写了我的 SPRoc 将它映射到 sql 并立即使用它:)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-25T02:56:05.783

Scott Gu 的 Dynamic LINQ 可以在[此处](http://weblogs.asp.net/scottgu/archive/2008/01/07/dynamic-linq-part-1-using-the-linq-dynamic-query-library.aspx)找到，但正如 tvanfosson 已经说过的那样，您确实不会通过迁移到 Linq 来解决很多问题，而且很可能需要付出更多的努力而不是结果。

# ios - 用 UIView 像书一样翻页？

> ID：477078
> 
> 赞同：10
> 
> 时间：2009-01-25T02:34:20.677
> 
> 标签：ios, iphone

我试图`UIViews`通过让它看起来像你正在翻书一样在两者之间切换。

如果`UIViewAnimationTransitionCurlUp`我能让它向左或向右卷曲，那就非常接近了。这可能吗？

我曾尝试使用`CATRansition`但没有一种动画类型接近翻页。

关于如何创建将页面向左或向右翻转的页面动画过渡的任何建议？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2011-02-09T14:46:03.817

**编辑（2012 年 6 月）：**现在可以使用本机 Apple 实现，请检查：

*   [Page View Controller](http://developer.apple.com/library/ios/#DOCUMENTATION/WindowsViews/Conceptual/ViewControllerCatalog/Chapters/PageViewControllers.html#//apple_ref/doc/uid/TP40011313-CH4-SW3 "页面视图控制器")：请注意，这从 iOS 5.0 开始可用。

还要检查其他库/方法：

*   [叶子](https://github.com/brow/leaves "树叶")：不太现实，但很容易使用。
*   [PageCurl](https://github.com/jemmons/PageCurl "页面卷曲")：效果非常好，易于使用。
*   [使用锥形变形算法实现 iBooks 页面卷曲](http://wdnuon.blogspot.com/2010/05/implementing-ibooks-page-curling-using.html "卷页")：太棒了，但这只是概念验证，难以扩展。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-25T03:38:33.903

There's nothing in the SDK that will do this for you. If you want this effect, you'll have to roll your own. "Classics" does a nice job with the page-flip animation.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-11-21T22:28:34.613

您可以通过更改动画发生的 UIViewController 的方向来管理此效果。

# c# - LINQ：一起使用 AssociateWith 和 Distinct

> ID：477083
> 
> 赞同：2
> 
> 时间：2009-01-25T02:38:08.860
> 
> 标签：c#, .net, linq

我还没有找到将这两个元素一起使用的方法。

这是我的问题：

一个网页有很多书签。用户拥有一个书签。用户可以多次为同一页面添加书签（出于我的目的）。

我想要的是为页面添加书签的不同用户的列表。我正在尝试使用`LoadWith()`和的`AssociateWith()`方法`DataContext`，因为我不想每次我想要数据的轻微变体时都必须编写一个全新的查询。所以，有时我想要一个页面，有时我想要一个页面和一个书签列表等。

我可以有这样的代码来获取页面和书签：

```
dlo.LoadWith<Page>(p => p.Bookmarks); 
```

并添加这个来获取我的用户：

```
dlo.LoadWith<Bookmark>(b => b.User); 
```

但我不知道如何将用户限制为不同的。我假设它是通过`AssociateWith()`命令，但不支持`Distinct()`运营商：http: [//msdn.microsoft.com/en-us/library/bb548919.aspx](http://msdn.microsoft.com/en-us/library/bb548919.aspx)

我正在做的事情是可能的，还是我必须为它写一个新的查询？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-25T04:24:00.940

Suppose that there are two pages and two users and that both users have bookmarked both pages.

If you issue

```
dlo.LoadWith<Page>(p => p.Bookmarks);
dlo.LoadWith<Bookmark>(b => b.User);
dc.DataLoadOptions = dlo;
List<Page> myPages = dc.Page.ToList(); 
```

Then LinqToSql will load 2 pages, 4 bookmarks and 2 users and construct the object graph you'd expect.

Then, to get distinct users without hitting the database, you have to traverse the graph and do something like this:

```
List<User> myUsers = myPages
  .SelectMany(p => p.Bookmarks)
  .Select(b => b.User)
  .Distinct()
  .ToList() 
```

* * *

> a user can bookmark the same page multiple times in this case, so they're not distinct

Ok, here's an untested shot at it.

```
List<PageWithUsers> myPages = dc.Pages
  .Select(p => new PageWithUsers()
  {
    Page = p
    Users = p.Bookmarks
      .Select(b => b.UserId)
      .Distinct()
      .Take(10)
      .Select(i => dc.Users.Where(u => u.UserId = i))
  })
  .ToList(); 
```

# javascript - dojo.xd.js 无法识别 dojox.data.CsvStore

> ID：477085
> 
> 赞同：3
> 
> 时间：2009-01-25T02:40:06.720
> 
> 标签：javascript, cdn, dojo

当我使用诸如

```
<script type="text/javascript" src="http://o.aolcdn.com/dojo/1.2.3/dojo/dojo.xd.js"
      djConfig="parseOnLoad:true, isDebug: true"></script> 
```

我得到错误

```
dojox.data.CsvStore is not a constructor 
```

对于诸如

```
var stateStore = new dojox.data.CsvStore({url: "dojo-passcsv.php", label: "name"}); 
```

但是如果我使用从本地安装的 dojo 导入，错误就会消失，例如

```
<script type="text/javascript" src="dojo-release-1.2.3/dojo/dojo.js"
     djConfig="parseOnLoad:true, isDebug: true"></script> 
```

我真的希望能够使用 CDN 托管的 dojo 安装。DojoX 库和 dojo.xd.js 之间是否存在已知问题？

提前致谢，

动漫

PS`dojo.require("dojox.data.CsvStore");`声明已经到位。

PPS 完整的“工作代码”如下。用 CDN 中的引用替换 CSS 和 JS 引用会破坏它。

```
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <style type="text/css">
        @import "dojo-release-1.2.3/dijit/themes/tundra/tundra.css";
        @import "dojo-release-1.2.3/dojo/resources/dojo.css"
    </style>
    <script type="text/javascript" src="dojo-release-1.2.3/dojo/dojo.js"
         djConfig="parseOnLoad:true, isDebug: true"></script>
    <script>
        dojo.require("dojox.data.CsvStore");
        dojo.require("dijit.Tree");
        dojo.require("dojo.parser");
    </script>
    <script type="text/javascript">
        var stateStore = new dojox.data.CsvStore({url: "states.csv", label: "name"});
    </script>

</head>
<body class="tundra">
    <div dojoType="dijit.Tree" store="stateStore" labelAttr="name" label="States">
    </div>
</body>
</html> 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-25T05:12:15.103

你在里面运行那个代码`dojo.addOnLoad()`吗？如：

```
dojo.addOnLoad(function(){
   dojo.require("dojox.data.CsvStore");
   var stateStore = new dojox.data.CsvStore({url: "dojo-passcsv.php", label: "name"});
}); 
```

另外，您使用的是 FireFox 3 吗？如果是这样，请尝试将您的`<script></script>`块放在该`<body>`部分的最后，就在结束`</body>`标记之前。（我知道这不是标准做法，但它与 Firefox 的[错误 444322](https://bugzilla.mozilla.org/show_bug.cgi?id=444322)相关，应该在 3.0.6 版中修复。）

除此之外，您的代码似乎还不错，而这种奇怪的差异通常归结为加载 dojo 模块的时间问题。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-25T15:49:11.343

对您的更新做出反应：

我强烈认为你应该尝试使用`dojo.addOnLoad()`. 一起，您的最后两个`<script>`部分`<head>`将变为：

```
<script>
   dojo.addOnLoad(function(){
      dojo.require("dojox.data.CsvStore");
      dojo.require("dijit.Tree");
      dojo.require("dojo.parser");  /* I don't think you really need this line */
      var stateStore = new dojox.data.CsvStore({url: "states.csv", label: "name"});
   });
</script> 
```

原始代码的问题在于，您无法保证在您即将创建它的实例`dojox.data.CsvStore`时已经读取了构造函数。`stateStore`这就是`dojo.addOnLoad()`进来的地方，让您保证在执行作为参数传递的抽象函数之前加载了其余的 javascript `addOnLoad()`。

因为这是一个时间问题，您自己的原始代码有时可能会起作用，而其他代码可能不起作用：这取决于下载速度以及您的浏览器将各种 javascript 位组合在一起的顺序。这就是为什么使用dojo 的远程库有时可能会与使用您自己的dojo 库的本地副本产生不同的结果。

也就是说，如果您使用的是 Firefox 3（早于 3.0.6），请记住我所说的关于已知错误的内容。在这种情况下，您可能希望将该`<script>`块紧挨在结束`</body>`标记之前...（该选项也适用于其他浏览器。）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-28T22:05:48.303

[Pierdeux](https://stackoverflow.com/questions/477085/dojo-xd-js-not-recognizing-dojox-data-csvstore/477848#477848)认为[addOnLoad](https://stackoverflow.com/questions/467166/dojo-addonload-but-is-dojo-loaded)是关键是正确的，但它应该在 dojo.requires 之后，而不是之前。此外，必须从自动 djConfig.parseOnLoad（它在 addOnLoad 之前触发）切换到手动启动解析器。当您仍然更改该商店 URL 以指向某个合理的位置（在您的网站上）时，这有效：

```
<script>
   dojo.require("dojox.data.CsvStore");
   dojo.require("dijit.Tree");
   dojo.require("dojo.parser");
   dojo.addOnLoad(function(){
      stateStore = new dojox.data.CsvStore({url: "states.csv", label: "name"});
      dojo.parser.parse();
   });
</script> 
```

注意：还有另一个非常相似的案例：[Grid、stores、XD](https://stackoverflow.com/questions/559809/does-anyone-have-a-simple-example-of-a-working-dojox-grid-control)。

# ruby-on-rails - 如何干燥我的 Rails 应用程序的 CRUD 部分？

> ID：477092
> 
> 赞同：3
> 
> 时间：2009-01-25T02:56:23.083
> 
> 标签：ruby-on-rails, views, dry, crud

我正在编写一个应用程序 - 与那里的许多应用程序类似 - 有 90% 的常规 CRUD 东西和 10% 的“果汁”，我们需要讨厌的业务逻辑和更多的灵活性和定制。

关于这 90%，我尽可能地坚持 DRY 原则。只要有控制器，我就发现 resource_controller 真的可以工作，我可以摆脱该区域的所有控制器，用通用控制器替换它们。

现在我想知道如何获得相同的观点。在这个应用程序上，我有一个整体的 application.html.erb 布局，然后我必须有另一个布局层，所有 CRUD 视图都通用，最后是“核心”部分：

*   在 index.html.erb 上，我只需要生成一个包含我指示的字段和标签的简单表格。

*   对于新建和编辑，还有通用表单编辑，指示标签和字段（如果需要，可以提供自定义字段）。

*   我不确定我是否需要展示，但如果我这样做，它将与新建和编辑相同。

哪些插件和工具（甚至文章和通用指针）可以帮助我完成这项工作？

谢谢，费利佩。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-25T04:51:25.847

您可以运行`script/generate scaffold test name:string description:text valid:boolean`并查看生成的视图（并运行`script/destroy scaffold test`以删除文件）。这将使您很好地了解编写 4 个默认 Rails 视图的标准方法。

我还建议阅读“Agile Web Development with Rails”和“Rails Way”中的相关章节。

如果您有需要清理的现有视图，Railscasts 的这一集很棒：[清理视图](http://railscasts.com/episodes/55-cleaning-up-the-view)

达里

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-26T09:52:26.370

如果您已经干燥了控制器并且现在希望干燥视图，一种方法是`render :action => *actionname*`存储可能更改为实例变量的 UI 内容（以便它们在视图上可用）这样您就可以重用*编辑*、*新建*、*列表*或*显示*的相同视图。例如，您正在编辑与*Foo*相关的内容，那么您的标题应为`Editing <%= @type %>`，您的表单助手也应如此。*Foo*很可能然后更改为*bar*。因此，您正在为不同的实体（或者我应该说的控制器）重新使用相同的视图。请记住，与 不同`redirect_to`， `render :action`只渲染视图，不调用它试图渲染的动作的控制器动作。

有一件事是肯定的，如果你想干掉任何东西，你需要标准化或遵循约定。例如，在这种情况下，您的视图的结构。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-06-12T15:03:40.447

看起来只有一个非常接近您的要求的新宝石：

[http://github.com/codez/dry_crud](http://github.com/codez/dry_crud)

基于一个通用的超类（CrudController），您可以为您的各种模型控制器继承 CRUD 功能并调整那里的特殊功能。这是你已经做过的，很可能。

dry_crud 的新特性是视图和局部视图也是可继承的。您为每个 CRUD 操作定义一个通用的基本模板，可能分为几个部分。由于提供了帮助程序，表单和表格可以通过查看当前模型的列定义来进行一般性定义。在您的特定模型的视图中，您可以只调整需要自定义的部分或视图。

查看上面网站上的文档并保持干燥！

# asp.net-mvc - ASP.NET MVC Intellisense 找不到 ViewData

> ID：477095
> 
> 赞同：5
> 
> 时间：2009-01-25T03:04:35.250
> 
> 标签：asp.net-mvc

我正在尝试通过 asp.net 上的[以下教程](http://www.asp.net/learn/mvc/tutorial-11-cs.aspx)。当我开始阅读这段代码时：

```
 <%@ Page Language="C#" MasterPageFile="~/Views/Shared/Site.Master" AutoEventWireup="true" CodeBehind="Index.aspx.cs" Inherits="MvcApplication1.Views.Home.Index" %> 
<%@ Import Namespace="MvcApplication1.Models" %> 
<asp:Content ID="indexContent" ContentPlaceHolderID="MainContent" runat="server"> 
<table> 
<tr>      
<th>Id</th>
<th>Title</th>
<th>Release Date</th> 
</tr> 
<% foreach (Movie m in (IEnumerable)ViewData.Model) { %> 
<tr>      
      <td><%= m.Id %></td>
      <td><%= Html.Encode(m.Title) %></td>
      <td><%= m.DateReleased %></td>
 </tr>
 <% } %>
 </table>
 </asp:Content> 
```

当我输入 ViewData 时，它不会在智能感知中显示，就好像我没有包含参考或其他内容一样。进一步向下 Html.Encode Html 不会显示在智能感知中。我究竟做错了什么？

我正在使用最新版本的 MVC。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-25T03:12:30.147

尝试在您的 MVC 项目上进行构建。在第一次编译后面的代码之前，智能感知将无法工作。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-25T17:43:39.180

我发现强制它工作的最佳方法是保存文件，构建关闭文件并重新打开它......对我来说有 95% 的时间有效。这是一个已知问题，已在 ASP.NET MVC 的 RC 中修复。

# python - Python 导入编码风格

> ID：477096
> 
> 赞同：72
> 
> 时间：2009-01-25T03:06:09.833
> 
> 标签：python, coding-style

我发现了一个新模式。这种模式是否众所周知或对此有何看法？

基本上，我很难上下清理源文件以找出可用的模块导入等等，所以现在，而不是

```
import foo
from bar.baz import quux

def myFunction():
    foo.this.that(quux) 
```

我将所有导入移动到实际使用它们的函数中。像这样：

```
def myFunction():
    import foo
    from bar.baz import quux

    foo.this.that(quux) 
```

这做了几件事。首先，我很少不小心用其他模块的内容污染我的模块。我可以`__all__`为模块设置变量，但是随着模块的发展，我必须更新它，这无助于实际存在于模块中的代码的命名空间污染。

其次，我很少会在我的模块顶部出现一连串的导入，其中一半或更多我不再需要，因为我已经对其进行了重构。最后，我发现这个模式更容易阅读，因为每个引用的名称都在函数体中。

* * *

## 回答 #1

> 赞同：127
> 
> 时间：2011-01-25T04:23:27.090

这个问题的（以前）[投票最多的答案](https://stackoverflow.com/questions/477096/python-import-coding-style/477107#477107)格式很好，但在性能方面绝对错误。让我演示一下

# 表现

## 顶级进口

```
import random

def f():
    L = []
    for i in xrange(1000):
        L.append(random.random())

for i in xrange(1000):
    f()

$ time python import.py

real        0m0.721s
user        0m0.412s
sys         0m0.020s 
```

## 函数体中的导入

```
def f():
    import random
    L = []
    for i in xrange(1000):
        L.append(random.random())

for i in xrange(1000):
    f()

$ time python import2.py

real        0m0.661s
user        0m0.404s
sys         0m0.008s 
```

如您所见，在函数中导入模块会**更高效。**这样做的原因是简单的。它将引用从全局引用移动到局部引用。这意味着，至少对于 CPython，编译器将发出`LOAD_FAST`指令而不是`LOAD_GLOBAL`指令。顾名思义，这些速度更快。`sys.modules`另一个回答者通过*在循环的每一次迭代上导入，*人为地夸大了查找的性能损失。

通常，最好在顶部导入，但如果您多次访问模块，性能*并不是原因。*原因是人们可以更容易地跟踪模块所依赖的内容，并且这样做与 Python 世界的其他大部分内容是一致的。

* * *

## 回答 #2

> 赞同：57
> 
> 时间：2009-01-25T03:24:50.047

这确实有一些缺点。

# 测试

如果你想通过运行时修改来测试你的模块，它可能会使它变得更加困难。而不是做

```
import mymodule
mymodule.othermodule = module_stub 
```

你必须做

```
import othermodule
othermodule.foo = foo_stub 
```

这意味着您必须全局修补 othermodule，而不是仅仅更改 mymodule 中的引用指向的内容。

# 依赖跟踪

这使得您的模块依赖于哪些模块变得不明显。如果您使用许多第三方库或正在重新组织代码，这尤其令人恼火。

我不得不维护一些在所有地方都使用内联导入的遗留代码，这使得代码极难重构或重新打包。

# 性能说明

由于 python 缓存模块的方式，没有性能损失。事实上，由于模块位于本地命名空间中，因此在函数中导入模块会带来轻微的性能优势。

## 顶级进口

```
import random

def f():
    L = []
    for i in xrange(1000):
        L.append(random.random())

for i in xrange(10000):
    f()

$ time python test.py 

real   0m1.569s
user   0m1.560s
sys    0m0.010s 
```

## 函数体中的导入

```
def f():
    import random
    L = []
    for i in xrange(1000):
        L.append(random.random())

for i in xrange(10000):
    f()

$ time python test2.py

real    0m1.385s
user    0m1.380s
sys     0m0.000s 
```

* * *

## 回答 #3

> 赞同：23
> 
> 时间：2009-01-25T03:19:08.560

这种方法的一些问题：

*   打开文件时它所依赖的模块并不是很明显。
*   它将混淆必须分析依赖关系的程序，例如`py2exe`，`py2app`等。
*   您在许多功能中使用的模块呢？您最终会得到大量冗余导入，或者您必须在文件顶部有一些和一些内部函数。

所以......首选的方法是将所有导入放在文件的顶部。我发现如果我的导入难以跟踪，这通常意味着我有太多代码，最好将其拆分为两个或多个文件。

在某些情况下，我*发现*函数内部的导入很有用：

*   处理循环依赖（如果你真的无法避免它们）
*   平台特定代码

另外：将导入放在每个函数中实际上*并不*比文件顶部慢。第一次加载每个模块时，它会被放入`sys.modules`，并且每次后续导入只花费查找模块的时间，这相当快（它不会重新加载）。

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2009-01-25T03:32:28.640

Another useful thing to note is that the `from module import *` syntax inside of a function has been removed in Python 3.0.

There is a brief mention of it under "Removed Syntax" here:

[http://docs.python.org/3.0/whatsnew/3.0.html](http://docs.python.org/3.0/whatsnew/3.0.html)

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-01-25T16:10:16.043

我建议您尽量避免`from foo import bar`进口。我只在包中使用它们，其中拆分为模块是一个实现细节，反正不会有很多。

在您导入包的所有其他地方，只需使用`import foo`并通过全名引用它`foo.bar`。通过这种方式，您始终可以知道某个元素的来源，而不必维护导入元素的列表（实际上这将始终过时并导入不再使用的元素）。

如果`foo`是一个非常长的名称，您可以将其简化，`import foo as f`然后编写`f.bar`. 这仍然比维护所有`from`导入更方便和明确。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-01-26T12:32:50.523

People have explained very well why to avoid inline-imports, but not really alternative workflows to address the reasons you want them in the first place.

> I have a hard time scrubbing up and down source files to figure out what module imports are available and so forth

To check for unused imports I use [pylint](http://www.logilab.org/project/pylint). It does static(ish)-analysis of Python code, and one of the (many) things it checks for is unused imports. For example, the following script..

```
import urllib
import urllib2

urllib.urlopen("http://stackoverflow.com") 
```

..would generate the following message:

```
example.py:2 [W0611] Unused import urllib2 
```

As for checking available imports, I generally rely on TextMate's (fairly simplistic) completion - when you press Esc, it completes the current word with others in the document. If I have done `import urllib`, `urll[Esc]` will expand to `urllib`, if not I jump to the start of the file and add the import.

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-01-25T03:48:46.237

I believe this is a recommended approach in some cases/scenarios. For example in Google App Engine lazy-loading big modules is recommended since it will minimize the warm-up cost of instantiating new Python VMs/interpreters. Have a look at a [Google Engineer's](https://sites.google.com/site/io/building-scalable-web-applications-with-google-app-engine) presentation describing this. However keep in mind this **doesn't** mean you should lazy-load all your modules.

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-01-25T03:29:21.207

从性能的角度来看，您可以看到：[Python import 语句是否应该始终位于模块的顶部？](https://stackoverflow.com/questions/128478/should-python-import-statements-always-be-at-the-top-of-a-module)

一般来说，我只使用本地导入来打破依赖循环。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2018-04-30T10:43:24.557

两种变体都有其用途。然而，在大多数情况下，最好在函数之外而不是在函数内部导入。

## 表现

在几个答案中都提到了它，但在我看来，它们都缺乏完整的讨论。

第一次在 python 解释器中导入模块时，它会很慢，无论它是在顶层还是在函数内部。这很慢，因为 Python（我专注于 CPython，对于其他 Python 实现可能会有所不同）执行多个步骤：

*   找到包。
*   检查包是否已经转换为字节码（著名的`__pycache__`目录或`.pyx`文件），如果没有，则将它们转换为字节码。
*   Python 加载字节码。
*   加载的模块被放入[`sys.modules`](https://docs.python.org/library/sys.html#sys.modules).

后续导入不必执行所有这些操作，因为 Python 可以简单地从[`sys.modules`](https://docs.python.org/library/sys.html#sys.modules). 所以后续的导入会快很多。

可能是您模块中的某个函数实际上并不经常使用，但这取决于一个`import`需要很长时间的函数。然后你实际上可以移动`import`函数内部。这将使您的模块导入更快（因为它不必立即导入长时间加载的包）但是当最终使用该函数时，它在第一次调用时会很慢（因为必须导入模块）。这可能会对感知性能产生影响，因为您不会减慢所有用户的速度，而是只会减慢那些使用依赖于慢速加载依赖项的功能的用户。

但是，查找`sys.modules`不是免费的。它非常快，但它不是免费的。`import`因此，如果您实际上经常调用 sa 包的函数，您会注意到性能略有下降：

```
import random
import itertools

def func_1():
    return random.random()

def func_2():
    import random
    return random.random()

def loopy(func, repeats):
    for _ in itertools.repeat(None, repeats):
        func()

%timeit loopy(func_1, 10000)
# 1.14 ms ± 20.6 µs per loop (mean ± std. dev. of 7 runs, 1000 loops each)
%timeit loopy(func_2, 10000)
# 2.21 ms ± 138 µs per loop (mean ± std. dev. of 7 runs, 100 loops each) 
```

这几乎慢了两倍。

意识到[aaronasterling 在答案中“作弊”是](https://stackoverflow.com/a/4789963/5393381)非常重要的。他表示，在函数中进行导入实际上会使函数更快。在某种程度上，这是真的。那是因为 Python 如何查找名称：

*   它首先检查本地范围。
*   接下来检查周围的范围。
*   然后检查下一个周围的范围
*   ...
*   检查全局范围。

因此，无需检查本地范围，然后检查全局范围，只需检查本地范围就足够了，因为模块的名称在本地范围内可用。这实际上使它更快！但这是一种称为[“循环不变代码运动”](https://en.wikipedia.org/wiki/Loop-invariant_code_motion)的技术。它基本上意味着您可以通过在循环（或重复调用）之前将其存储在变量中来减少循环（或重复）中完成的某些事情的开销。因此，`import`您也可以简单地使用一个变量并将其分配给全局名称，而不是在函数中使用它：

```
import random
import itertools

def f1(repeats):
    "Repeated global lookup"
    for _ in itertools.repeat(None, repeats):
        random.random()

def f2(repeats):
    "Import once then repeated local lookup"
    import random
    for _ in itertools.repeat(None, repeats):
        random.random()

def f3(repeats):
    "Assign once then repeated local lookup"
    local_random = random
    for _ in itertools.repeat(None, repeats):
        local_random.random()

%timeit f1(10000)
# 588 µs ± 3.92 µs per loop (mean ± std. dev. of 7 runs, 1000 loops each)
%timeit f2(10000)
# 522 µs ± 1.95 µs per loop (mean ± std. dev. of 7 runs, 1000 loops each)
%timeit f3(10000)
# 527 µs ± 4.51 µs per loop (mean ± std. dev. of 7 runs, 1000 loops each) 
```

虽然您可以清楚地看到对全局进行重复查找`random`很慢，但在函数内部导入模块或在函数内部的变量中分配全局模块之间几乎没有区别。

这也可以通过避免循环内的函数查找来达到极端：

```
def f4(repeats):
    from random import random
    for _ in itertools.repeat(None, repeats):
        random()

def f5(repeats):
    r = random.random
    for _ in itertools.repeat(None, repeats):
        r()

%timeit f4(10000)
# 364 µs ± 9.34 µs per loop (mean ± std. dev. of 7 runs, 1000 loops each)
%timeit f5(10000)
# 357 µs ± 2.73 µs per loop (mean ± std. dev. of 7 runs, 1000 loops each) 
```

再次快得多，但导入和变量之间几乎没有区别。

## 可选依赖项

有时有一个模块级的导入实际上可能是一个问题。例如，如果您不想添加另一个安装时依赖项，但该模块对于一些**附加**功能确实很有帮助。决定依赖项是否应该是可选的不应该轻易完成，因为它会影响用户（如果他们得到意外`ImportError`或以其他方式错过“酷特性”）并且它会使安装具有所有特性的包更加复杂，对于正常情况依赖关系`pip`或`conda`（仅提及两个包管理器）开箱即用，但对于可选依赖项，用户必须稍后手动安装包（有一些选项可以自定义需求，但又是安装它的负担“正确”放在用户身上）。

但这同样可以通过两种方式完成：

```
try:
    import matplotlib.pyplot as plt
except ImportError:
    pass

def function_that_requires_matplotlib():
    plt.plot() 
```

或者：

```
def function_that_requires_matplotlib():
    import matplotlib.pyplot as plt
    plt.plot() 
```

这可以通过提供替代实现或自定义用户看到的异常（或消息）来定制，但这是主要要点。

如果想要为可选依赖项提供替代“解决方案”，顶级方法可能会更好一些，但是通常人们使用函数内导入。主要是因为它导致更干净的堆栈跟踪并且更短。

## 循环进口

In-Function 导入对于避免因循环导入而导致的 ImportErrors 非常有帮助。在很多情况下，循环导入是“坏”包结构的标志，但如果绝对没有办法避免循环导入，则“循环”（以及问题）可以通过将导致循环的导入放在里面来解决实际使用它的功能。

## 不要重复自己

如果您实际上将所有导入都放在函数而不是模块范围中，则会引入冗余，因为函数很可能需要相同的导入。这有几个缺点：

*   您现在有多个地方可以检查是否有任何导入已过时。
*   如果您拼错了某些导入，您只会在运行特定功能而不是在加载时发现。因为你有更多的 import 语句，所以错误的可能性增加了（不多），并且测试所有函数变得更加重要。

## 额外的想法：

> 我很少会在我的模块顶部出现一连串的导入，其中一半或更多我不再需要，因为我已经对其进行了重构。

大多数 IDE 已经有一个未使用的导入检查器，因此可能只需单击几下即可删除它们。即使您不使用 IDE，您也可以偶尔使用静态代码检查器脚本并手动修复它。另一个答案提到了 pylint，但还有其他答案（例如 pyflakes）。

> 我很少不小心用其他模块的内容污染我的模块

这就是为什么您通常使用`__all__`和/或定义您的函数子模块，并且只在主模块中导入相关的类/函数/...，例如`__init__.py`.

此外，如果您认为您过多地污染了模块命名空间，那么您可能应该考虑将模块拆分为子模块，但这仅对几十个导入有意义。

如果您想减少命名空间污染，另外（非常重要的）一点是避免`from module import *`导入。但是您可能还希望避免`from module import a, b, c, d, e, ...`导入**过多**名称的导入，而只需导入模块并使用`module.c`.

作为最后的手段，您始终可以使用别名来避免使用“公共”导入污染命名空间：`import random as _random`。这将使代码更难理解，但它非常清楚什么应该公开可见，什么不应该公开。这不是我推荐的，你应该保持`__all__`列表是最新的（这是推荐的和明智的方法）。

# 概括

*   性能影响是可见的，但几乎总是会进行微优化，因此不要让导入的决定受微基准的指导。除非依赖项在开始时真的很慢`import`并且它只用于一小部分功能。然后它实际上会对大多数用户的模块感知性能产生明显的影响。

*   使用通常理解的工具来定义公共 API，我的意思是`__all__`变量。让它保持最新可能有点烦人，但检查所有函数是否有过时的导入或添加新函数以在该函数中添加所有相关导入时也是如此。从长远来看，您可能需要通过更新来减少工作量`__all__`。

*   你喜欢哪一个并不重要，两者都有效。如果你一个人工作，你可以考虑利弊，然后做你认为最好的一个。但是，如果您在一个团队中工作，您可能应该坚持使用已知模式（这将是顶级导入`__all__`），因为它允许他们做他们（可能）一直在做的事情。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-01-25T11:03:19.683

您可能想查看 python wiki 中的 Import[语句开销](http://wiki.python.org/moin/PythonSpeed/PerformanceTips#ImportStatementOverhead)。简而言之：如果模块已经加载（查看`sys.modules`），您的代码将运行得更慢。如果你的模块还没有加载，并且`foo`只会在需要的时候加载，可以是零次，那么整体性能会更好。

* * *

## 回答 #11

> 赞同：-1
> 
> 时间：2016-05-08T02:35:17.760

# 安全实施

考虑一个环境，您的所有 Python 代码都位于只有特权用户有权访问的文件夹中。为了避免以特权用户身份运行整个程序，您决定在执行期间将特权放弃给非特权用户。一旦您使用导入另一个模块的函数，您的程序将抛出一个错误，`ImportError`因为非特权用户由于文件权限而无法导入该模块。

# c# - 堆与堆栈分配的含义（.NET）

> ID：477101
> 
> 赞同：20
> 
> 时间：2009-01-25T03:13:00.240
> 
> 标签：c#, .net, performance, stack, heap-memory

从关于堆和堆栈的~~[SO 答案](https://stackoverflow.com/questions/423823/whats-your-favorite-programmer-ignorance-pet-peeve#answer-424035)~~¹中，它向我提出了一个问题：为什么知道变量的分配位置很重要？

在[另一个答案](https://stackoverflow.com/questions/79923/what-and-where-are-the-stack-and-heap)中，有人指出堆栈更快。这是唯一的暗示吗？有人可以给出一个简单的分配位置更改可以解决问题（例如性能）的代码示例吗？

**请注意，这个问题是 .NET 特定的**

^(1 问题已从 SO 中删除。)

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-01-25T07:40:06.613

只要您知道语义是什么，堆栈与堆的唯一后果就是确保您不会溢出堆栈，并意识到与垃圾收集堆相关的成本。

例如，JIT*可以*注意到新创建的对象从未在当前方法之外使用（引用永远不会在其他地方转义）并将其分配到堆栈上。目前还没有这样做，但这将是合法的事情。

同样，C# 编译器*可以*决定在堆上分配所有局部变量 - 堆栈将只包含对 MyMethodLocalVariables 实例的引用，并且所有变量访问都将通过它实现。（事实上​​，委托或迭代器块捕获的变量已经具有这种行为。）

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-25T03:42:03.520

（**编辑：** *我的原始答案包含过度简化的“结构在堆栈上分配”并且混淆了堆栈与堆和值与引用的关系，因为它们在 C# 中耦合。*）

对象是否存在于堆栈中是一个不太重要的实现细节。乔恩已经很好地解释了这一点。在使用类和结构之间进行选择时，更重要的是要意识到引用类型与值类型的工作方式不同。以下面的简单类为例：

```
public class Foo
{
   public int X = 0;
} 
```

现在考虑以下代码：

```
Foo foo = new Foo();
Foo foo2 = foo;
foo2.X = 1; 
```

在此示例中， foo 和 foo2 是对同一对象的引用。在 foo2 上设置 X 也会影响 foo1。**如果我们将 Foo 类更改为结构，则不再是这种情况**。这是因为结构不是通过引用访问的。分配 foo2 实际上会创建一个副本。

将东西放入堆栈的原因之一是垃圾收集器不必清理它。您通常不应该担心这些事情；只需使用课程！现代垃圾收集器做得很好。一些现代虚拟机（如 java 1.6）甚至[可以确定在堆栈上分配对象是否安全，](http://en.wikipedia.org/wiki/Escape_analysis)即使它们不是值类型。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-25T13:58:28.760

在 .NET 中几乎没有什么可讨论的，因为决定在哪里分配实例的不是某个类型的用户。

引用类型总是在堆上分配。值类型默认分配在堆栈上。例外情况是，如果值类型是引用类型的一部分，在这种情况下，它会与引用类型一起在堆上分配。即类型的设计者代表用户做出这个决定。

在 C 或 C++ 等语言中，用户可以决定数据的分配位置，对于某些特殊情况，从堆栈分配可能比从堆分配快得多。

这与如何处理 C / C++ 的堆分配有关。事实上，.NET 中的堆分配非常快（除非它触发垃圾收集），所以即使您可以决定在哪里分配，我的猜测是差异不会很大。

但是，由于堆是垃圾收集而堆栈不是，显然在某些情况下您会看到一些差异，但考虑到您在 .NET 中实际上没有选择的事实，这几乎不相关。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-01-25T03:20:23.690

我认为最简单的原因是，如果它在堆中，那么一旦不再需要垃圾收集就需要处理该变量。在堆栈上时，该变量会被任何使用它的东西所解除，例如实例化它的方法。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2011-08-11T13:45:50.823

在我看来，当您真正开始考虑应用程序的性能时，了解堆栈和堆之间的差异以及如何在其上分配内容会非常有帮助。以下问题使理解这些差异变得至关重要： 您认为 .NET 访问什么更快、更有效？- 堆栈或堆。在什么情况下.NET 可以放置堆的值类型？

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2018-06-20T09:43:19.440

与流行的看法相反，.NET 进程中的堆栈和堆之间没有太大区别。堆栈和堆只不过是虚拟内存中的地址范围，与为托管堆保留的地址范围相比，为特定线程的堆栈保留的地址范围没有固有的优势。**访问堆上的内存位置既不比访问堆栈上的内存位置快也不慢。**在某些情况下，有几个考虑因素可能支持对堆栈位置的内存访问总体上比对堆位置的内存访问更快的说法。其中：

1.  在堆栈上，时间分配局部性（在时间上相互靠近的分配）意味着空间局部性（在空间上相互靠近的存储）。反过来，当时间分配局部性意味着时间访问局部性（一起分配的对象被一起访问）时，顺序堆栈存储往往在 CPU 缓存和操作系统分页系统方面表现更好。
2.  由于引用类型开销，堆栈上的内存密度往往高于堆上的内存密度。更高的内存密度通常会带来更好的性能，例如，因为更多的对象适合 CPU 缓存。
3.  线程堆栈往往相当小——Windows 上默认的最大堆栈大小为 1MB，并且大多数线程实际上往往只使用几个堆栈页。在现代系统上，所有应用程序线程的堆栈都可以放入 CPU 缓存中，这使得典型的堆栈对象访问速度非常快。（另一方面，整个堆很少适合 CPU 缓存。）

> 话虽如此，您不应该将所有分配都移到堆栈中！Windows 上的线程堆栈是有限的，并且通过应用不明智的递归和大堆栈分配很容易耗尽堆栈。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2019-03-18T19:57:00.443

我在堆栈和堆上玩了很多不同的基准测试，我总结如下：

**类似的性能**

*   小应用程序（堆上没有太多对象）
*   大小 < 1KB 的对象

**Sligther 更好的堆栈性能**（快 1 倍 - 5 倍）

*   大小为 1Kb 到 100KB 的对象

**更好的性能**（速度提高 100 倍甚至更多）

*   大量对象
*   大内存压力 - 每秒大量分配和完整内存
*   大对象 10KB - 3MB（我想是 x64 系统）
*   Xbox（慢速垃圾收集器）

最好的方法是数组池。它和堆栈一样快，但你没有堆栈那样的限制。

使用堆栈的另一个含义是通过设计它是线程安全的。

x64 Windows 上堆栈的默认内存限制为 4MB。因此，分配不超过 3MB 的空间是安全的。

# asp.net - ASP.NET 中分块传输的最佳响应大小是多少？

> ID：477108
> 
> 赞同：4
> 
> 时间：2009-01-25T03:26:08.060
> 
> 标签：asp.net, http, transfer-encoding

我正在创建一个反向代理，并试图为分块传输编码找到响应大小的最佳缓冲区。目前我将其设置为 4 kb。这个数字可以吗，还是我应该使用更好的尺寸。如果可能的话，我希望通过一些测试来支持这一点。

我还会接受某人在 .NET 框架中知道的具有默认值的属性设置。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-25T04:03:06.363

最佳大小将取决于应用程序和网络。之前有一篇[文章](https://stackoverflow.com/questions/282504/choosing-buffer-size-for-ftp-and-http-transfers)提供了在给定环境的情况下测量最佳块大小的建议。

J2ME 过去默认为 2KB 块（即客户端到服务器）。但我不知道.NET 默认是什么。不幸的是，关于分块的[HTTP 规范](http://www.w3.org/Protocols/rfc2616/rfc2616-sec3.html#sec3.6.1)也没有提供任何指导。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-06-29T18:51:06.897

我有大型文件传输正在杀死 Web 服务器，所以我根据这篇文章实现了分块：http: [//support.microsoft.com/kb/812406](http://support.microsoft.com/kb/812406)

客户立即抱怨文件下载时间是原来的 3 倍，缓冲区设置为 10K。在某些情况下，这些文件的大小为 80-100MB。我将缓冲区增加到 200K 并将发布我的结果。

# seo - 数据库驱动的产品页面和 SEO 的影响

> ID：477112
> 
> 赞同：-3
> 
> 时间：2009-01-25T03:30:49.673
> 
> 标签：seo, e-commerce

电子商务网站显示从数据库驱动的产品/项目信息（相对于每个产品都有自己的 HTML 页面）对 SEO 有什么影响。

SE会找到物品信息吗？如果没有，你如何克服这个问题？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-25T03:35:45.360

Create individual pages for each product and use [friendly URLs](http://www.seomoz.org/blog/11-best-practices-for-urls) for all of them. These pages can be generated from a database, search engines don't mind at all. It is better for the pages to have a name like [http://example.com/products/An-Awesome-Product/](http://example.com/products/An-Awesome-Product/) than [http://example.com/products.aspx?id=1234](http://example.com/products.aspx?id=1234). ASP.NET MVC makes it trivial to do such things. With traditional webforms, you can use an HttpModule with a redirect so that the first example turns into the second one on the server such that search engines and visitors don't even notice.

Use a [sitemap.xml](http://www.sitemaps.org/protocol.php) to let the search engines know about your pages and when they were last updated.

Don't forget that the title of the page is quite important. And it does not do any harm to have decent metadata on the page with keywords and descriptions that are customized for the product.

Definitely do not generate pages with random content or filler content, as decent search engines are quite good at picking out patterns and penalize heavily for illicit behavior. Sadly, I've learned that from personal experience.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-25T21:07:06.773

感谢您的回复和建议。

我是新手，所以只想确保我理解...

假设产品是自制工艺品，详细信息存储在数据库中（描述、材料、尺寸、价格等），而不是在 HTML 页面上“硬编码”。

用户选择一个类别，网站列出该类别的所有产品（使用 SQL select where 语句）。

然后用户选择一个产品并创建一个产品页面（SQL select where product = xyz 并动态创建网页）。

当谷歌“评论”网站时，即使它在数据库中而不是“静态”网页中，它是否会找到所有产品详细信息？

对不起，如果这是一个愚蠢/简单的问题，但似乎很重要。

谢谢，戴夫

# ruby-on-rails - 如何在 Ruby on Rails 中使用应用程序助手

> ID：477114
> 
> 赞同：20
> 
> 时间：2009-01-25T03:32:03.243
> 
> 标签：ruby-on-rails

我正在尝试在网站的每个页面上发布随机推荐。

我开始使用这样的应用程序助手：

```
module ApplicationHelper

  def random_testimonial
    @random_testimonial = Testimonial.find(:first, :offset => rand(Testimonial.count))
  end

end 
```

在我看来，我可以引用该方法，但每个引用都会调用它，这是有道理的。

我希望在每个页面视图上调用一次，公开我可以在视图中使用的 Testimonial 对象。

我应该寻找什么来做到这一点？

* * *

## 回答 #1

> 赞同：50
> 
> 时间：2009-01-25T05:31:20.913

虽然这行得通，而且我当然知道这样做，但它违反了 MVC 关注点分离。视图助手不应该包含控制器/模型类型的逻辑，这是这样做的。

您可能会考虑将其重构回应用程序控制器。助手应该用于视图格式和其他东西，而不是作为一个函数（这是我刚开始时一直想做的事情。）

如果你回到你的 Testimonail 模型，做可以做

```
def self.random
  Testimonial.find(:first, :offset => rand(Testimonial.count))
end 
```

然后在您的应用程序控制器中，您可以执行以下操作：

```
def random_testimonial
  @random_testimonial ||= Testimonial.random
end 
```

并从 before_filter 调用它

这样做的好处是将数据库逻辑移回它所属的模型中。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-01-25T03:47:02.107

如果我对您的理解正确，您需要一种在一个请求/响应周期中每次引用它时都返回相同对象的方法。如果这是真的，您可以通过对您的助手稍作更改来实现它：

```
 def random_testimonial
    @random_testimonial ||= Testimonial.find(:first, :offset => rand(Testimonial.count))
 end 
```

注意“||=”部分。这是一个 Ruby 习惯用法，它说：为@random_testimonial 赋值，除非它已经有一个值。

希望这能回答你的问题。

# sql - 在 SQL 中选择多个 M:N 关系的最佳方法是什么？

> ID：477115
> 
> 赞同：0
> 
> 时间：2009-01-25T03:32:08.097
> 
> 标签：sql, join

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-25T03:48:48.953

I think you probably want to do it as two queries, one for authors and one for subjects, however you could combine these into a single result using a UNION if you wanted.

```
SELECT books.book_id, books.book_title, 
      'author' as record_type, authors.author_name as record_value
LEFT JOIN book_authors ON books.book_id = book_authors.book_id
LEFT JOIN authors ON authors.item_id = book_authors.author_id
UNION
SELECT books.book_id, books.book_title,
       'subject' as record_type, subjects.subject_name as record_value
LEFT JOIN book_subjects ON books.book_id = book_subjects.book_id
LEFT JOIN subjects ON subjects.subject_id = book_subjects.subject_id; 
```

I'm not sure that it really saves anything other than a round-trip to the database. I offer it only for the potential contribution to your knowledge not in hopes that it is helpful to your immediate problem.

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-25T03:39:34.447

What do you think *should* come back? You can't have lists inside a tuple coming back from a query, so your current results seems like the only way to get back all the data in one query.

UPDATE: SQL doesn't support hierarchical structures, so you'll have to build that yourself (assuming you aren't using an ORM tool that can do it for you). One way would be to make a trip to the DB to get all the books to process, then for each book make one trip for the authors of that book and one trip for the subjects of that book. That can be an awful lot of DB trips, though. Another way would be to bring back all the data (as in your question) and then build a hierarchical structure out of that. Which one is better depends on a lot of factors. *I* would probably go for the one DB trip solution, even though the client code is probably more complicated; the general rule is that roundtrips to the database are expensive, so I'd tend toward the solution that doesn't increase the number of such trips linearly with the number of results.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-25T19:17:12.687

创建一些巨大的多连接表并在您的应用程序中对其进行重构会破坏首先拥有数据库的目的。您已经在表格中很好地规范了所有内容，为什么要放弃所有这些努力？

我要做的是建立并维护与您的数据库的连接。当你需要一些数据时，创建一个 select 语句，它只连接你需要的表并只提供你当时需要的数据，将其发送到数据库，然后处理结果。如果在您查询数据库时其他人在数据库中插入和更新行，您的结果将是最新的。

如果您需要 Emily Dickinson 的所有书籍，请加入您的书籍和作者表。如果您需要所有撰写糕点制作书籍的作者，只需加入作者和主题表即可。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-25T03:52:54.467

You're getting exactly what you described, in the fashion any standard mainstream developer would accomplish the same thing. But apparently it doesn't match your mental expectation as to shape and size.

Start by taking 3 books, with varying numbers of authors and subjects, and just list what you would like to see. Then we can discuss how to get there.

I don't think you'll find any square grid that gets you there. Probably you want something more like a tree structure?

```
+ Title 1
+----+ Authors
     + ---- Author 1
     + ---- Author 2
+    + Topics
     + ---- Topic A
etc.

```

Anything along these lines I find is easiest to derive using mapping tools in another abstraction layer; although there are ways to twist relational data that can help, if you have the skills (e.g. analytical cubes and queries, returning dependent secondary queries, etc.) They usually involve proprietary extensions (e.g. LINQ); but you probably don't want to go to the more sophisticated (read: complex) stuff until you've thoroughly mastered stuff like this.

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-25T04:29:09.713

I don't typically find it useful to get data back shaped this way. Multiple resultsets that I can relate to each other tend to be more useful. You won't have extraneous data in your resultset this way either (8 rows returned each with the same columns for the book).

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-01-25T04:36:26.313

您可以使用 MS SQL Server 返回多个结果集。从书籍中选择*；选择 * 从 book_authors; 选择 * 从作者；选择 * 从 book_subjects; 从科目中选择 *；

然后使用该信息加载具有关系的 .NET 数据集，或者创建封装关系的实体对象（如果不使用 .NET 或数据集）。

如果您使用的是 .NET 3.5，请查看 LINQ to SQL 或 LINQ to Entities 以简化创建所需代码的工作。

# asp.net - “asp.net”是什么意思？

> ID：477124
> 
> 赞同：13
> 
> 时间：2009-01-25T03:40:23.227
> 
> 标签：asp.net

我知道 asp 代表 Active Server Pages 但想知道“Active Server”是否真的意味着什么？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-01-25T03:43:46.903

ASP.NET 页面不是*静态*的；它们背后有可执行的服务器端代码，可以动态生成页面内容或与服务系统交互——它们是*活动*的（Web）服务器页面。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-25T04:39:05.793

[根据 Microsoft](http://msdn.microsoft.com/en-us/library/ms972347.aspx)的说法，它指的是 ActiveX 组件。

> Microsoft® Active Server Pages (ASP) 是 Microsoft Internet Information Server (IIS) 3.0 中的服务器端执行环境，使您能够在服务器上运行 ActiveX™ 脚本和 ActiveX 服务器组件。通过结合脚本和组件，开发人员可以轻松地创建动态内容和强大的基于 Web 的应用程序。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-25T04:17:51.593

顺便说一句，ASP.NET 并不是对 ASP 的*真正*升级，它只是以这样的方式命名以使其通过公司部门——即使它很漂亮，你也可以将它作为对 ASP 的“升级”出售给你的上级非常独立的技术。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-25T06:59:11.563

微软过去曾将“Active”用于一些产品，例如；活动目录。许多其他混合表示和逻辑的技术也使用了 XS)erver P)ages - 例如：J)ava S)erver P)ages。

# python - 如何列出静态目录中的文件？

> ID：477135
> 
> 赞同：8
> 
> 时间：2009-01-25T03:59:08.883
> 
> 标签：python, google-app-engine

我正在使用 Google App Engine 和 Python，我无法列出静态目录的文件。下面是我目前使用的代码。

**应用程序.yaml**

```
- url: /data
  static_dir: data 
```

**列出文件的 Python 代码**

```
myFiles = []
for root, dirs, files in os.walk(os.path.join(os.path.dirname(__file__), 'data/') ):
    for name in files:
        full_name = os.path.join(root, name)
        myFiles.append('%s;%s\n' % (name, datetime.fromtimestamp(os.stat(full_name).st_mtime))) 
```

当我在我的机器上本地运行这段代码时，一切都很好。我的 Python 脚本位于目录的根目录，它遍历数据目录下的文件。但是，当我在 GAE 中上传并运行完全相同的代码时，它不起作用。在我看来，我的应用程序的目录结构并没有完全复制到 Google App Engine 中。**静态文件在哪里？**

谢谢！

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-25T16:23:31.993

[https://developers.google.com/appengine/docs/python/config/appconfig#Python_app_yaml_Static_file_handlers](https://developers.google.com/appengine/docs/python/config/appconfig#Python_app_yaml_Static_file_handlers)

它们不在您认为的位置，GAE 将静态内容放入相当于 CDN 的 GoogleFS 中。这个想法是静态内容旨在直接提供给您的用户，而不是充当您可以操作的文件存储。此外，GAE 有 1K 文件限制，如果您可以操纵静态文件存储，则很难监管此规则。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-25T17:33:25.363

这是一个让您浏览静态文件的项目： [http ://code.google.com/p/appfilesbrowser/](http://code.google.com/p/appfilesbrowser/)

这里是 appengine 的必看食谱列表：http: [//appengine-cookbook.appspot.com/](http://appengine-cookbook.appspot.com/) （我前段时间在这里找到了那个项目）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-25T17:42:51.553

您无法以编程方式访问作为静态内容上传的文件 - 它们没有与您的应用程序一起安装在服务器上，而是直接提供。如果您真的需要访问它们，您可以删除静态文件处理程序并自己提供它们。

# php - 你如何让客户在你的网站上使用他们的 openid，就像 stackoverflow 一样？

> ID：477144
> 
> 赞同：31
> 
> 时间：2009-01-25T04:16:52.890
> 
> 标签：php, mysql, openid

我希望客户在我的网站上使用他们的 openId。我用谷歌搜索了这个，但没有找到任何好的教程。我使用 PHP 和 MySQL。

Plaxo 有一个。但它说我们应该从 JanRain.com 下载一些东西。

我看到了 Drupal 的 openId 模块。它不想下载任何东西。

谁能告诉我具体该怎么做？

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2009-08-15T20:35:48.853

Stack Overflow 将此库用于冒烟的 javascript 界面：[http ://code.google.com/p/openid-selector/](http://code.google.com/p/openid-selector/)

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-02-17T04:02:28.953

这里列出了许多不错的库： [http ://wiki.openid.net/Libraries](http://wiki.openid.net/Libraries)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-25T04:46:44.187

Drupal 的 OpenID 模块[开始使用 4.7.x 中的 JanRain 库](http://drupal.org/project/openid)，这是 PHP 中最常用的 OpenID 实现。

您不必在 Drupal 中下载库，因为它已经内置到 Drupal 核心中。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-01-26T03:51:36.627

你也可以像[uservoice那样使用](http://uservoice.com/login)[rpx](http://rpxnow.com)。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-01-25T04:26:09.517

如果您在 linux 机器上托管您的站点，则应该有一个可以安装的 php-openid 软件包，它将为您提供一个开放 id 客户端库，您可以使用它来启用开放 id 登录。该软件包带有很好的示例代码，可以帮助您入门。如果你没有运行 linux 或者你的发行版没有 php-openid，我 99% 确定 php-openid 是基于（或直接）JanRain.com 的 php 库，所以直接下载它应该可以让你一样。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-25T05:06:26.160

Zend Framework 还开发了一个[OpenID 组件](http://framework.zend.com/manual/en/zend.openid.html)，它可以作为一个独立的组件使用（即不依赖于框架的其余部分），或者至少需要最少的交互（我相信它使用响应对象进行重定向）。

无论哪种方式，它都是另一种选择，并且在构建 ZF 支持的站点时特别有用。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-25T04:26:54.257

我只看了一眼，但[http://www.saeven.net/openid.htm](http://www.saeven.net/openid.htm)对你有用吗？

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2015-11-26T10:33:04.850

以下库可用于协助在 PHP 中实现 OpenID 身份服务器和使用者。本节中的库旨在帮助处理特定于 OpenID 的所有细节，并让您提供粘合剂以将其集成到您的站点中。^(（[来源](http://wiki.openid.net/w/page/12995176/Libraries)）)

*   [LightOpenID](https://github.com/iignatov/LightOpenID)
    一个 PHP 5 库，用于轻松进行 openid 身份验证。仅作为消费者工作。
    许可证：[麻省理工学院许可证](http://www.opensource.org/licenses/mit-license.php)
*   [PEAR OpenID 库](http://pear.php.net/package/OpenID/)
    PHP 5 消费者 OpenID 库。
    许可证：[BSD](http://www.linfo.org/bsdlicense.html)
*   [PHP OpenID 库](http://www.openidenabled.com/php-openid/)(Janrain)
    PHP OpenID 库允许您在使用 PHP 构建的站点上启用 OpenID 身份验证。它具有 OpenID 消费者、商店实现和 OpenID 服务器。
    许可证：[Apache v2](http://www.apache.org/licenses/LICENSE-2.0)
*   [简单的 OpenID PHP 类](http://www.phpclasses.org/browse/package/3290.html)
    使用 OpenID 单点登录
    许可证对用户进行身份验证：未知
*   [CakePHP](http://code.42dh.com/openid/)
    的 OpenID 组件 CakeP 的 OpenID 组件
    许可证：[MIT](http://www.opensource.org/licenses/mit-license.php)
*   [sfOpenIDPlugin 用于 Symfony](http://www.symfony-project.org/plugins/sfOpenIDPlugin)
    模块以通过 OpenID
    许可证处理身份验证：未知
*   [EasyOpenID](http://www.codymays.net/content/2007/02/20/the-future-and-openid/)
    OpenID 依赖方的无 PEAR 库。
    许可证：BSD/GPL
*   [NetMesh InfoGrid LID](http://infogrid.org/trac/wiki/LID)（不可下载？！）
    许可证：[Sleepycat](https://opensource.org/licenses/Sleepycat)
*   [Zend Framework OpenID 组件](https://github.com/zendframework/ZendOpenId)
    Zend_OpenId 是一个 Zend Framework 组件，它为构建支持 OpenID 的站点和身份提供者提供了一个简单的 API。
    许可证：[BSD](http://www.linfo.org/bsdlicense.html)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2015-11-26T11:09:57.833

[HybridAuth](http://hybridauth.sourceforge.net/index.html)是 php 库上的一个开源社交标志。

HybridAuth 库的主要目标是充当您的应用程序与各种社交 api 和身份提供商（如 Facebook、Twitter、LinkedIn、Google 和 Yahoo）之间的抽象 api。

HybridAuth 使开发人员能够轻松构建社交应用程序，通过实现社交登录、社交分享、用户资料、朋友列表、活动流、状态更新等，在社交层面吸引网站访问者和客户。

使用 HybridAuth 的世界你好：

```
<?php
 $config = dirname(__FILE__) . '/library/config.php';
 require_once( "library/Hybrid/Auth.php" );

 try{
     $hybridauth = new Hybrid_Auth( $config ); 
     $twitter = $hybridauth->authenticate( "Twitter" );
     $user_profile = $twitter->getUserProfile();
     echo "Hi there! " . $user_profile->displayName;
     $twitter->setUserStatus( "Hello world!" );
     $user_contacts = $twitter->getUserContacts();
 }
 catch( Exception $e ){
     echo "Ooophs, we got an error: " . $e->getMessage();
 } 
```

# sql-server-2005 - NHibernate elt 字段

> ID：477146
> 
> 赞同：7
> 
> 时间：2009-01-25T04:18:45.537
> 
> 标签：sql-server-2005, nhibernate

有谁知道为什么 NHibernate 会为多对多映射生成一个名为“elt”的 int 类型的字段？我想知道为什么我需要它。谢谢

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-01-25T04:53:55.717

“elt”字段是多对多映射中元素的外键。在连接表中，您应该看到两个外键列，id（用于父级）和 elt（用于元素）。如果您愿意，可以使用不同的名称；这些是默认值。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-25T06:32:06.627

谢谢，是的，你是对的，多玩一点我发现如果我没有明确命名该列，它默认为 elt。

```
<bag name="equipment" table="tb_room_equipment" lazy="false">
  <key column="roomID"/>
  <many-to-many class="Equipment" column="equipmentID"/>
</bag> 
```

像这里一样，我现在已经将列命名为 deviceID；如果我不这样做，它将被命名为 elt。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2012-09-13T09:59:02.657

刚刚发现如果您在使用“按代码映射”时使用了诸如**用户**或**角色之类的****关键字，则会创建****elt**字段。这只是一个观察，我没有尝试使用`（反引号）来强制引用

 ******# flash - Is there a way to stream a stored Flash video to multiple people in sync, but let one of them control playback (play/pause/seek/etc.)

> ID：477153
> 
> 赞同：1
> 
> 时间：2009-01-25T04:26:45.973
> 
> 标签：flash, video, streaming, synchronized

I don't know much about deploying Flash video streaming solutions, and I want to know if the following can be accomplished in Flash.

I am creating an application where multiple people can watch a video at the same time , but one of those people controls the playback of the video for everyone. Furthermore, the controller is not always the same person, it can change if someone leaves or depending on other factors.

Please point me in the right direction.

Thanks!

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-25T04:35:20.293

我确信这是可能的。我不做闪光灯；但这里有一个关于如何实现这一点的高级想法：

在每个客户端上播放视频；并确保它们同步。但是当“控制器”暂停、跳过或停止视频时，向每个客户端发送一个信号，在他们自己的客户端上重复该操作。您可以使用数据库来执行此操作（对于 MySQL，后端类型为 MEMORY 的表应该对此有好处）。客户端每秒钟都会询问服务器他们的“控制器”操作是否发生了变化。每次“控制器”执行操作时，它都会在数据库中排队。

我看到的唯一问题是确保每个客户端的流是同步的（例如，当存在滞后时，它不会“减速”，而是“跳过”到“控制器”所​​在的帧）

我希望这能有所帮助 ：）

**编辑**

每一秒，“控制器”都会向客户端发送一条消息，其中包含他当前的视频帧数……它可以工作。

# css - 如何在 IE 中解决这个简单的 CSS 浮动问题？

> ID：477157
> 
> 赞同：3
> 
> 时间：2009-01-25T04:29:09.043
> 
> 标签：css, css-float, internet-explorer-7

我有四个`div`元素浮动到左边。第三个`div`被清除。
在 Firefox 和 Chrome 中，元素按预期定位：第一个和第二个`div`s 彼此相邻，并且位于彼此相邻的第三个和第四个`div`s 之上。
另一方面，IE7 将第四个`div`与第一个和第二个相邻，`div`第三个`div`在下面。

我知道我可以通过`br`在第二个元素之后添加一个元素来修复它，`div`但如果我不需要，我宁愿不编辑标记。有没有更优雅的方法来解决问题？

一段时间以来，我一直在尝试在 Google 上进行修复，但还没有找到一个，考虑到这个问题看起来多么简单，这相当令人惊讶。也许我遗漏了一些明显的东西，是否有一个参考站点列出了像这样的简单 CSS 问题，或者我只是对基本 CSS 一无所知？

**编辑：**在 Nazgulled “解决”问题后，我使示例代码稍微复杂一些（见评论）。现在有四个`div`s 而不是三个，第三个`div`被清除而不是第二个。

这是完整的源代码：

```
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" >
    <head runat="server">
        <title>IE Float Test</title>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
        <style type="text/css">
            div
            {
                width: 100px;
                height: 100px;
                color: white;
                font-size: 3em;
                float: left;
            }

            #divone
            {
                background-color: red;
            }

            #divtwo
            {
                background-color: blue;
            }

            #divthree
            {
                background-color: green;
                clear: both;
            }

            #divfour
            {
                background-color: purple;
            }
        </style>
    </head>
    <body>
        <div id="divone">one</div>
        <div id="divtwo">two</div>
        <div id="divthree">three</div>
        <div id="divfour">four</div>
    </body>
</html> 
```

这是 Chrome 中的样子：
[![铬样品](https://i.stack.imgur.com/W8p9e.png)](https://i.stack.imgur.com/W8p9e.png)

这是 IE7 中的样子：
[![IE 示例](https://i.stack.imgur.com/gsc6Y.png)](https://i.stack.imgur.com/gsc6Y.png)

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-25T05:07:44.143

我不知道这是否能解决你真正的问题，但我这样修复了你的样本：

*   **从div**中删除**float**属性
***   **从#divtwo**中删除**clear**属性***   添加**float: left**到**#divtwo**和**#divthree******

 ****这使它看起来像您在 Firefox 和 IE 7（我测试过的浏览器）中的 chrome 示例。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-10-04T07:06:17.637

几个月后...

我放弃了尝试单独使用 CSS 来解决这个问题。这是一个 IE7 错误，如果不触摸 HTML，您将无法避免。

这种浮动模式的最终应用是在一个表单中，其中两个`div`s 是输入元素，另外两个`div`s 是它们对应的标签。该模式在大型表单中多次使用，我真的很想找到一个优雅的纯 CSS 解决方案。

我最终最终使用了[面向对象的 CSS 框架](http://wiki.github.com/stubbornella/oocss)，并用附加的 s 包装了所有元素，`div`以创建所需的布局，正如 OOCSS 所规定的那样。这是将我的灵魂从 IE7 的 CSS 地狱中拯救出来的唯一方法，一旦你完成了初始布局，OOCSS 并不是那么糟糕。

事实上，一般的答案是，当你真的不知道你在用 CSS 做什么时，你会提出这样的问题。如果您必须千载难逢地创建一个复杂的布局，那么您可能不知道自己在做什么；就像我问这个问题时的情况一样。

尽管 IE7 确实无法正确呈现 CSS，但这也是我的一个错误范围的情况。CSS 不是一个天真的程序员会认为的终极布局语言，CSS 也不是真正独立于 HTML 的结构。当我实际上应该花时间学习 CSS 的基础知识时，我再次选择了使用 OOCSS 框架来采取更简单的方法。

唉，这就是最后期限的后果。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-25T08:06:41.443

我不确定您的最终目标是什么，但我建议将所有四个`<div>`s 包含在一个容器元素中并为其应用宽度，然后`clear`从`#divthree`. 这样做将允许`#divthree`并`#divfour`在下面移动`#divone`而不`#divtwo`清除它们：

```
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" >
    <head runat="server">
        <title>IE Float Test</title>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
        <style type="text/css">
                #divone, #divtwo, #divthree, #divfour
                {
                        width: 100px;
                        height: 100px;
                        color: white;
                        font-size: 3em;
                        float: left;
                }

                #divone
                {
                        background-color: red;
                }

                #divtwo
                {
                        background-color: blue;
                }

                #divthree
                {
                        background-color: green;
                }

                #divfour
                {
                        background-color: purple;
                }

                #container {
                        width: 200px;
                        zoom: 1;
                }
        </style>
    </head>
    <body>
    <div id="container">
        <div id="divone">one</div>
        <div id="divtwo">two</div>
        <div id="divthree">three</div>
        <div id="divfour">four</div>
    </div>
    </body>
</html> 
```

`zoom`属性 on`#container`是避免[IE6/7 Escaping Floats Bug](http://www.positioniseverything.net/explorer/escape-floats.html)所必需的。

如果上述解决方案不可行，您可以在 style之后添加一个`<br>`或`<div>`之后：`#divtwo``clear: left;`

```
<div id="divone">one</div>
<div id="divtwo">two</div>
<br style="clear: left;" />
<div id="divthree">three</div>
<div id="divfour">four</div> 
```

这是[在 westciv.com 上的浮动页面布局示例中](http://www.westciv.com/style_master/house/tutorials/quick/floated_layout/index.html)使用的技术。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-25T04:38:46.403

尝试添加：

```
display:inline-block; 
```

在#divtwo。如果可行，我当然会为 IE7 添加一些条件注释

# python - 使用 Django 在表单中生成和提交动态数量的对象

> ID：477183
> 
> 赞同：2
> 
> 时间：2009-01-25T05:02:30.427
> 
> 标签：python, html, django, forms, web-applications

我希望能够使用 Django 在单个表单中更新动态数量的对象，我想知道最好的方法是什么。类似情况的一个例子可能会有所帮助。

模型：

```
class Customer(Model.models):
    name = models.CharField(max_length=100)
    active = models.BooleanField() 
```

表单（我知道我在这里混合了视图和模板代码，这是行不通的，但这是表单应该做的一般想法）：

```
customers = Customer.objects.all()
for c in customers:
    print <li> {{ c.name }} <input type="checkbox" value="{{ c.active }}" name="?" /> 
```

我将如何提交这些对象的列表？最好的办法是将客户的 id 附加到每个“行”中，然后根据 id 进行处理？是否有提交元组列表的机制？什么是理想的解决方案？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-01-25T05:17:59.257

[表单集](http://docs.djangoproject.com/en/dev/topics/forms/formsets/)！

此外，直接生成的表单模型的等价物是[模型表单集](http://docs.djangoproject.com/en/dev/topics/forms/modelforms/#id1)。

# c# - Windows 上的高质量 Mono/ASP.NET 开发环境？

> ID：477185
> 
> 赞同：2
> 
> 时间：2009-01-25T05:03:20.487
> 
> 标签：c#, asp.net, mono

在 Windows 上使用 Mono 运行时而不是 VS 和 MS 运行时开发 ASP.NET/C# 应用程序的最佳设置是什么？

理想情况下，我想拥有完整的魔力——自动完成、调试器、单元测试和 Apache/mod_mono 或其他一些等效的 Web 服务器......

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-25T09:56:50.877

查看[SharpDevelop](http://www.icsharpcode.net/OpenSource/SD/)。这是您可以达到的最接近您的要求。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-25T06:56:50.350

[单声道网站](http://www.mono-project.com/Main_Page)呢？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-25T10:08:52.880

恐怕没有什么像 Visual Studio for mono for windows，还有 Monodevelop for Linux，但它远不能很快在 windows 上运行，但是，如果你只是想使用 mono 运行时来执行你的应用程序，我认为开发没有任何不便在 Visual Studio 中并以单声道运行时为目标。

[这里](http://www.mono-project.com/Working_with_Mono_and_Visual_Studio)有一个关于如何设置 Visual Studio 环境以正确使用单声道运行时的指南，尽管我不确定该指南是否已更新，因为它提到了从 MSBuild 到 Make 的转换工具，但我听说 Monodevelop 的最后一个版本在 Linux 中能够打开 Visual Studio 项目文件，所以现在可能更容易。

正如 EricSchaefer 所说，您可以使用 SharpDevelop，但它没有像 Visual Studio 那样的 Web 应用程序设计器工具，如果这对您来说是必须的，那么恐怕只有 Visual Studio 会成为您的解决方案。

让我们知道你做了什么:)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-27T00:05:13.870

** 编辑：第一次没有发现“windows”位。MonoDevelop 将在 Windows 中运行，无需安装程序。在 windows 上也是[mod_mono](http://anmar.eu.org/mono/mod_mono/)。

[OpenSuse](http://software.opensuse.org/) (OS)、[mono repos](http://www.go-mono.com/mono-downloads/download.html) (Mono 2.2)、[monodevelop](http://monodevelop.com/) （带有自动完成功能的 ide + 调试器）。没有 ASP.NET 的调试器，它很快就会出现）。同时，Log4Net 也不是一个糟糕的选择。单元测试... NUnit 和（可能类似于）[风车](http://www.getwindmill.com/)

# php - 使用 JavaScript 调用 jQuery 函数

> ID：477191
> 
> 赞同：0
> 
> 时间：2009-01-25T05:12:24.243
> 
> 标签：php, javascript, jquery, ajax

我正在使用 jQuery 和 JavaScript，我需要在我的 JavaScript 代码中调用 jQuery 函数。

我的 jQuery 代码：

```
function display(id){
    $.ajax({
        type:'POST',
        url: 'ajax.php',
        data:'id='+id  ,
        success: function(data){
            $("#response").html(data);
        }//success
    }); //Ajax

    //Here I need to return the ajax.php salary
    //return ?
} 
```

我的 ajax.php 文件有：

```
<?php
   session_start();
    ....

   echo "$salary";
?> 
```

我的 JavaScript 函数有：

```
my.js

function showName(){
    var id = 12;

    var a = display(id); //Here I need to call the jQuery function display().
} 
```

如何在 JavaScript 代码中调用 jQuery 函数以及如何将 PHP 值返回给 jQuery？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-25T08:15:17.573

我真的认为您需要将这两件事分开：

1.  触发[Ajax](http://en.wikipedia.org/wiki/Ajax_%28programming%29)调用的函数。
2.  从 Ajax 调用接收结果并执行您需要的任何操作的函数。

像：

```
function display(id){
  $.ajax({
    type:'POST',
    url: 'ajax.php',
    data:'id='+id  ,
    success: anotherFunction; //Ajax response
  });
} 
```

然后在您的 my.js 代码中：

```
display(2);
function anotherFunction(response){
    // Here you do whatever you need to do with the response
    $("#response").html(data);
} 
```

请记住，display() 将触发您的 Ajax 调用并且代码将继续，然后当您收到响应时（可能是几秒钟或几毫秒后） anotherFunction() 将被调用。这就是为什么 Ajax 是***异步***的。如果您需要***同步***调用，请查看有关 jQuery 和 Ajax 技术的文档。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-25T06:14:42.277

您从分配给 Ajax 请求中的键“成功”的匿名函数调用 showName。您分配给成功的匿名函数是您的回调函数。

查看[有关 Ajax 类的文档](http://docs.jquery.com)。

# silverlight - Silverlight 和多个视图模型

> ID：477192
> 
> 赞同：1
> 
> 时间：2009-01-25T05:12:36.707
> 
> 标签：silverlight, mvvm

我正在使用 MVVM 模式编写 Silverlight 应用程序。我有一个主视图（UserList.xaml）和相应的虚拟机（UserListViewModel.cs）。这用于列出用户的集合。我还有一个 UserControl（User.xaml - 作为模式对话框调用），用于为新用户添加详细信息。这也有它自己的视图模型（UserViewModel.cs）。

我的问题是，一旦子视图被关闭，您如何将信息（用户对象）从子视图模型传回父视图？当我对子视图模型进行保存时，我需要更新父视图模型中的集合。应该足够简单，但父视图模型不知道孩子何时被解雇。即使 UserViewModel.User 属性发生更改并且引发了 PropertyChanged 事件，UserListViewModel 也不会意识到这一点。

非常感谢这里的任何帮助。我已经阅读了 Silverlight 中有关 mvvm 的所有内容，但仍存在一些差距。我希望我已经清楚地概述了我的问题。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-26T16:22:32.587

有很多方法可以做到这一点。您可以在构造函数中将父 VM 的实例传递给子 VM。您可以让父虚拟机订阅子虚拟机在您的代码运行时公开的事件。

希望这可以帮助。:)

# python - 对 Python 调试工具的建议？

> ID：477193
> 
> 赞同：43
> 
> 时间：2009-01-25T05:14:42.350
> 
> 标签：python, debugging, simulation

昨天我用Python做了一个模拟。**我在变量和调试**方面遇到了一些困难。

是否有任何 Python 软件，它提供了一个不错的调试器？

相关问题：[调试 Python 代码的最佳方法是什么？](https://stackoverflow.com/questions/299704/what-is-the-best-way-to-debug-my-python-code)

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2009-01-25T05:53:27.513

[Winpdb](http://winpdb.org/)是一个**独立于平台**的图形化 GPL Python 调试器，支持网络远程调试、多线程、命名空间修改、嵌入式调试、加密通信，比 pdb 快 20 倍。

特征：

*   GPL 许可证。Winpdb 是免费软件。
*   与 CPython 2.3 到 2.6 和 Python 3000 兼容
*   与 wxPython 2.6 到 2.8 兼容
*   独立于平台，并在 Ubuntu Gutsy 和 Windows XP 上测试。
*   用户界面：rpdb2 是基于控制台的，而 winpdb 需要 wxPython 2.6 或更高版本。

[![截屏](https://i.stack.imgur.com/1oveL.jpg)](https://i.stack.imgur.com/1oveL.jpg)
[（来源：[winpdb.org](http://winpdb.org/images/screenshot_winpdb_small.jpg)）]

* * *

## 回答 #2

> 赞同：28
> 
> 时间：2011-06-20T22:39:41.560

[pudb](http://pypi.python.org/pypi/pudb)是 python 的可视化调试器。

![pudb截图](https://i.stack.imgur.com/UbLY3.png)

* * *

## 回答 #3

> 赞同：18
> 
> 时间：2014-08-20T16:00:17.863

不要忘记事后调试！抛出异常后，包含所有局部变量的堆栈帧包含在`sys.last_traceback`. 您可以`pdb.pm()`转到引发异常的堆栈帧，然后 p(retty)p(rint) `locals()`.

这是一个使用此信息从堆栈中提取局部变量的函数。

```
def findlocals(search, startframe=None, trace=False):

    from pprint import pprint
    import inspect, pdb

    startframe = startframe or sys.last_traceback
    frames = inspect.getinnerframes(startframe)

    frame = [tb for (tb, _, lineno, fname, _, _) in frames
             if search in (lineno, fname)][0]

    if trace:
        pprint(frame.f_locals)
        pdb.set_trace(frame)
    return frame.f_locals 
```

用法：

```
>>> def screwyFunc():
    a = 0
    return 2/a

>>> screwyFunc()

Traceback (most recent call last):
  File "<pyshell#62>", line 1, in <module>
    screwyFunc()
  File "<pyshell#55>", line 3, in screwyFunc
    return 2/a
ZeroDivisionError: integer division or modulo by zero
>>> findlocals('screwyFunc')
{'a': 0} 
```

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2009-01-25T05:18:08.943

您可以查看标准库中包含的 python 调试器 pdb：http: [//docs.python.org/library/pdb.html](http://docs.python.org/library/pdb.html)

* * *

## 回答 #5

> 赞同：11
> 
> 时间：2014-03-24T07:22:44.823

正如[帖子](https://zapier.com/engineering/debugging-python-boss/)所建议的，有几个选项：

*   pdb：Python 的内置调试器 [（来源：][[cachefly.net](https://zapier.cachefly.net/storage/photos/e52a752629759a90fda41a1081b79e15.png)][）][![数据库](https://i.stack.imgur.com/1QUQg.png)](https://i.stack.imgur.com/1QUQg.png)

*   pudb：GUI 调试器 [（来源：][[cachefly.net](https://zapier.cachefly.net/storage/photos/d208c2195f1b6a4f0dbf29ac1835867e.png)][）][![数据库](https://i.stack.imgur.com/L2Dc6.png)](https://i.stack.imgur.com/L2Dc6.png)

*   pydbgr：对 pydb 调试器的重写 [（来源：][[cachefly.net](https://zapier.cachefly.net/storage/photos/895b7a2bf7fb58745ad3213034f31aba.png)][）][![pydbgrb](https://i.stack.imgur.com/vUHFo.png)](https://i.stack.imgur.com/vUHFo.png)

*   ipdb：iPython 的 ipdb [（来源：][[cachefly.net](https://zapier.cachefly.net/storage/photos/c2c727c6672601697892ce55d41b2476.png)][）][![ipdb](https://i.stack.imgur.com/KTXYV.png)](https://i.stack.imgur.com/KTXYV.png)

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2009-01-25T05:20:44.460

我建议使用[pydb](http://bashdb.sourceforge.net/pydb/)和[ipython](http://ipython.scipy.org/moin/)进行交互式调试。

两者都在[showmedo.com上提供了截屏视频](http://showmedo.com)

*   [pydb简介](http://showmedo.com/videos/video?name=pythonBernsteinPydbIntro)
*   [IPython 上的 showmedo 系列](http://showmedo.com/videos/series?name=CnluURUTV)

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2009-01-25T07:55:06.350

[Komodo IDE](http://www.activestate.com/store/productdetail.aspx?prdGuid=64816ba8-b5fe-4e8d-8084-a6e66743ca78&)（不是免费的[Komodo Edit](http://www.openkomodo.com/)）带有一个调试器。我已经一年多没有使用它了，但当时它很好（v 3，IIRC）。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2010-09-05T11:38:29.760

除了其他工具外，还有一个支持调试的 Python Eclipse 插件。请参阅[教程](http://www.vogella.de/articles/Python/article.html)开始，和[网站](http://pydev.org/)下载。当然，您还需要获得[Eclipse](http://www.eclipse.org/downloads/)。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2013-06-21T15:54:07.983

我使用 PyCharm 和 WingIDE 进行调试，两者都很棒。

PyCharm 使用了相当多的 RAM（它在 Java 中），但我最终还是使用了它，因为我可以调试我正在从中执行的文档测试。

WindIDE 是用 Python 编写的，我比 PyCharm 更喜欢它，除了缺少运行的 doctest。

你也可以试试 Spyder，我从来没有成功过。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2012-05-21T09:04:31.353

有关建议，请参阅官方[Python wiki](http://wiki.python.org/moin/PythonDebuggingTools)。当有新内容出现时，请随时更新和订阅以接收通知。

# cocoa - Key-Value-Observing a to-many relationship in Cocoa

> ID：477204
> 
> 赞同：8
> 
> 时间：2009-01-25T05:36:03.883
> 
> 标签：cocoa, key-value-observing, key-value-coding

我试图让键值观察为 NSMutableArray 工作。下面是观察类 MyObservee 的 .h 文件：

```
@interface MyObservee : NSObject {
    @private int someValue;
    @private NSMutableArray *someArray;
}

@property (readwrite,assign) int someValue;
- (NSMutableArray *)someArray;
@end 
```

MyObserver 类实现了 observeValueForKeyPath:ofObject:change:context:。这是我添加观察者的方法：

```
MyObservee *moe = [[MyObservee alloc] init];
MyObserver *mobs = [[MyObserver alloc] init];

[moe addObserver:mobs 
      forKeyPath:@"someArray" 
         options:(NSKeyValueObservingOptionNew | NSKeyValueObservingOptionOld) 
         context:NULL];

[moe.someArray addObject:@"hi there"]; 
```

为什么 addObject: 消息没有作为 someArray 键路径的更改触发？我有一种感觉，这里有一些我不完全理解的东西。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-01-25T06:43:55.073

您需要实现[KVC 编程指南](https://developer.apple.com/library/ios/documentation/Cocoa/Conceptual/KeyValueCoding/Articles/Compliant.html)中定义的索引数组访问器。然后您必须使用这些访问器来访问数组，KVO 触发将起作用。您还可以调用[-mutableArrayValueForKey:](http://developer.apple.com/DOCUMENTATION/Cocoa/Reference/Foundation/Protocols/NSKeyValueCoding_Protocol/Reference/Reference.html#//apple_ref/occ/instm/NSObject/mutableArrayValueForKey:)并将该数组用于 addObject: 等，然后它将依次调用访问器方法，并且也会发生 KVO 触发。还有用于 NSSet 的 set 访问器，请参见[此处](http://developer.apple.com/DOCUMENTATION/Cocoa/Conceptual/ModelObjects/cdAccessorMethods.html#//apple_ref/doc/uid/TP40002154-SW1)和[此处](http://developer.apple.com/DOCUMENTATION/Cocoa/Reference/Foundation/Protocols/NSKeyValueCoding_Protocol/Reference/Reference.html#//apple_ref/occ/instm/NSObject/mutableSetValueForKey:)。

例子：

```
@interface MyClass : NSObject
{
    NSMutableArray *_orders;
}

@property(retain) NSMutableArray *orders;

- (NSUInteger)countOfOrders;
- (id)objectInOrdersAtIndex:(NSUInteger)index;
- (void)insertObject:(id)obj inOrdersAtIndex:(NSUInteger)index;
- (void)removeObjectFromOrdersAtIndex:(NSUInteger)index;
- (void)replaceObjectInOrdersAtIndex:(NSUInteger)index withObject:(id)obj;

@end 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-25T06:17:16.920

不幸的是，NSArray 类是注意 KVO 兼容的。它们符合 KVC，但您不能像在这里尝试那样直接观察它们。获得此功能的最简单方法是使用 NSArrayController。NSArray 控制器与 KVO 兼容，并会在添加或删除项目时提醒您。*在您的示例中，如果您实际更改*了数组本身，则会通知您的观察者。例如，如果你做了这样的事情：

```
[moe setSomeArray:[NSMutableArray array]]; 
```

这可能根本不是你想要的 :) 顺便说一句，NSDictionary 实际上是 KVO 兼容的，所以你可以使用它，如果你选择的话。或者你可以编写一个 NSMutableArray 的包装子类，它只是创建一个真正的可变数组作为其后备存储，但只是将所有消息转发给它，除了`addObject`你`removeObject`可以覆盖它以触发通知。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-25T10:22:18.517

为什么要将私有数组传递给另一个对象？当您让其他对象处理它时，它就不是那么私密了。

正如 s-bug 所说，您应该实现访问器并使用`mutableArrayValueForKey:`来改变属性。我补充说，**您根本不应该公开该私有数组**——您的`someArray`方法应该返回该数组的不可变副本。

此外，我请您注意 Jason Coco 对 s-bug 答案的评论。套用他的话，您可能应该使用 an作为和`NSArrayController`之间分离的附加步骤。这是一个非常好的建议，如果你没有具体的理由直接观察房产，你应该接受。（其中一个好处是您可以使用绑定将视图连接到新的数组控制器。）`myObservee``myObserver`

# sql - 普通 SP 如何处理托管 SP 抛出的异常

> ID：477205
> 
> 赞同：0
> 
> 时间：2009-01-25T05:37:27.703
> 
> 标签：sql, sql-server, sql-server-2005

我读到 SQL 异常在托管 SP 中被视为正常异常；我想知道下面的场景是如何处理的。

1.  我有一个调用托管 SP 的普通 t-SQL SP。
2.  托管 SP 由于某些问题引发异常。
3.  普通的 T-SQL 如何处理这个问题。

我还没有尝试过这种情况，因为我当前的机器上没有 SQL 服务器。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-25T19:28:55.300

它像处理任何其他异常一样处理它。在您的 TSQL 代码中，您可以将调用包装在 Try-Catch 块中。

例如：

```
Begin Try
    exec myManagedProc
End Try
Begin Catch
    print 'Error:' + error_message()
End Catch 
```

# xml - Adobe XFL Flash 交换格式的文档在哪里？

> ID：477212
> 
> 赞同：9
> 
> 时间：2009-01-25T05:49:30.767
> 
> 标签：xml, flash, adobe, flash-cs4

我在一家动画工作室工作，该工作室用 Flash 制作了几部作品。新的 Adob​​e CS4 套件最令人兴奋的功能之一可能是 XFL 文件格式。最后，我有一个 ascii 格式，我可以用它来收紧我们的 Flash 到 After Effects 管道，以及在无需打开 Flash 的情况下规划整个剧集的场景。

我唯一的问题是我在 Adob​​e 网站上的任何地方都找不到官方文档。我试过搜索 Adob​​e 网站本身，但只找到了有关如何从各种 CS4 应用程序导出 XFL 的指南。谷歌搜索产生了类似的结果，没有指向官方规范。

我有兴趣构建一个 Python API，以便我可以从我的管道脚本本地生成 XLF，但在我了解格式的所有方面之前不能这样做。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-01-30T01:58:36.240

根据 Adob​​e 的 Flash 创作产品经理 Richard Galvan 的说法，他们还没有公开发布文档。以下引述来自[moockblog](http://www.moock.org/blog/archives/000269.html)在 08 年 3 月对 Richard 的采访：

> “XFL 格式的确切细节尚不可用，但 Richard 向我保证，Adobe 打算公开记录它们，允许第三方工具导入和导出 XFL。”

转向像 XFL 这样的开放格式的问题在于，当人们可以同样轻松地使用更便宜（甚至可能是开源）的第 3 方替代方案时，他们不太可能为 Adob​​e 的专有 IDE 付费。也许他们正在尝试一种狡猾的方法来确保他们把我们锁在里面。

# firefox - Firefox 扩展在 Mac OS 中的位置？

> ID：477214
> 
> 赞同：25
> 
> 时间：2009-01-25T05:50:57.677
> 
> 标签：firefox

在 Mac OS X 中，Firefox 的安装扩展位于何处？

* * *

## 回答 #1

> 赞同：48
> 
> 时间：2009-01-25T05:52:45.487

~/Library/Application Support/Firefox/Profiles/[profile name]/extensions

* * *

## 回答 #2

> 赞同：-3
> 
> 时间：2012-10-31T12:58:38.190

在我的电脑（MacOS X 10.7.5、Firefox 16.0.2）中，它们安装在：

```
/Library/Internet Plug-Ins 
```

这是此目录中的文件列表：

```
AdobePDFViewer.plugin
DivXBrowserPlugin.plugin
Flash Player.plugin
Flip4Mac WMV Plugin.plugin
GarminGpsControl.plugin
JavaAppletPlugin.plugin -> //System/Library/Java/Support/Deploy.bundle/Contents/Resources/JavaPlugin2_NPAPI.plugin
Quartz Composer.webplugin
QuickTime Plugin.plugin
Scorch.plugin
Silverlight.plugin
flashplayer.xpt
googletalkbrowserplugin.plugin
iPhotoPhotocast.plugin
npdivx.xpt
npgtpo3dautoplugin.plugin
nsIQTScriptablePlugin.xpt 
```

# c# - 什么是 Visual Studio 08 C# 程序集信息 GUID 设置？

> ID：477215
> 
> 赞同：5
> 
> 时间：2009-01-25T05:51:50.543
> 
> 标签：c#, .net, visual-studio, publishing

我正在开发 C# 应用程序，并且正在验证发布应用程序的设置。装配信息部分下的 GUID 设置是什么？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-25T05:59:34.257

如果您打算从 COM 调用 .NET 程序集，则使用它。

本文[介绍](http://www.orcca.on.ca/~elena/useful/CallingDotNetCodeFromCom.html)了这些步骤。

# c# - Visual C#2008 中有什么好的插件吗？

> ID：477222
> 
> 赞同：3
> 
> 时间：2009-01-25T05:59:40.497
> 
> 标签：c#, visual-studio-2008, add-in

在我安装了 Visual c# 2008 后，我的视觉辅助 x 无法正常工作。有没有像 VAX 这样的好插件？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-25T07:02:35.800

[Visual Studio 2008 比较图表](http://msdn.microsoft.com/en-us/vstudio/aa700921.aspx)显示Express 版本不支持插件。

您必须至少购买标准版才能使用插件。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-25T06:06:14.790

这实际上取决于您想对加载项做什么。我个人最喜欢的是[ViEmu](http://www.viemu.com/)，它使 Visual Studio 尊重 Vim 键绑定。这需要一些时间来适应，但是一旦你习惯了它，Vim 的做事方式就会非常有效。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-25T06:15:51.993

[他们的主页](http://www.wholetomato.com/)说它适用于 VS 2008。也许它被禁用了？工具菜单...加载项管理器。否则可能会尝试重新安装。VS2005 和 VS2008 插件位于注册表中的不同位置，因此为 VS2005 安装的插件不会自动使其可用于 VS2008。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-25T06:21:16.930

VAX 在 VS 2008 中完美运行。也许您需要重新安装或获取更新版本。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-25T07:53:37.820

我写[了这个](http://www.codeplex.com/lazy)简单的插件，希望你觉得它有用。

# c++ - std::ifstream 是否比 FILE 慢得多？

> ID：477225
> 
> 赞同：13
> 
> 时间：2009-01-25T06:03:15.483
> 
> 标签：c++, optimization, file-io, ifstream

我被告知我的库比它应该的要慢，解析特定文件（文本文件，大小 326 kb）的速度要慢 30 倍以上。用户建议可能是我正在使用`std::ifstream`（大概而不是`FILE`）。

我宁愿不盲目地重写，所以我想我先在这里检查一下，因为我的猜测是瓶颈在其他地方。我正在逐个字符地阅读，所以我使用的唯一功能是`get()`、`peek()`和`tellg()/seekg()`。

**更新：**

我进行了分析，得到了[令人困惑](https://stackoverflow.com/questions/485649/confusing-gprof-output)的输出 - gprof 似乎并不认为它花了这么长时间。我重写了程序，首先将整个文件读入缓冲区，它的速度提高了大约 100 倍。我认为问题可能是`tellg()/seekg()`花费了很长时间，但 gprof 可能由于某种原因无法看到。在任何情况下，`ifstream`似乎都*不会*缓冲整个文件，即使对于这个大小。

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2009-01-25T06:20:26.743

我不认为这会有所作为。尤其是当您逐个字符地读取时，I/O 的开销可能会完全支配*其他任何*东西。为什么一次读取单个字节？你知道它是多么的低效吗？

对于 326kb 的文件，最快的解决方案很可能是一次将其读入内存。

std::ifstream 和 C 等效项之间的区别基本上是一个或两个虚函数调用。如果每秒执行几千万次，可能会有所不同，否则，就不是真的。文件 I/O 通常很慢，以至于用于访问它的 API 并不重要。更重要的是读/写模式。很多寻找是不好的，顺序读/写是好的。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-25T06:11:33.563

它应该稍微慢一些，但就像你说的那样，它可能不是瓶颈。你为什么不分析你的程序，看看是不是这样？

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-25T07:02:56.080

我认为您的问题不太可能通过从 fstream 切换到 FILE* 来解决，通常两者都由 C 库缓冲。操作系统也可以缓存读取（Linux 在这方面非常好）。鉴于您正在访问的文件的大小很可能它将完全在 RAM 中。

就像 PolyThinker 说的那样，您最好的选择是通过分析器运行您的程序以确定问题出在哪里。

此外，如果您的磁盘碎片严重，您正在使用 seekg/tellg 这可能会导致明显的延迟，因为第一次读取文件时磁盘必须将磁头移动到正确的位置。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-25T06:47:27.220

所有基准都是邪恶的。只需针对您期望的数据分析您的代码。

我在 Ruby、Python、Perl、C++ 之间进行了一次 I/O 性能比较。对于我的数据、语言版本等，C++ 的变体慢了好几倍（当时这是一个很大的惊喜）。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-01T23:43:44.810

我同意你应该配置文件。但是，如果您一次读取一个字符，那么创建一个内存映射文件怎么样？这样，您可以将文件视为字符数组，并且操作系统应该为您处理所有低级缓冲。最简单且可能最快的解决方案是我书中的胜利。:)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2015-03-07T18:51:34.760

[这](https://stackoverflow.com/questions/12997131/stdfstream-buffering-vs-manual-buffering-why-10x-gain-with-manual-buffering)是一个出色的基准，它表明在极端条件下，`fstream`s 实际上非常慢......除非：

1.  你使用缓冲（我不能强调足够）
2.  您自己操作缓冲区（也就是说，如果您需要链接问题中的 OP 等性能），这与使用`FILE*`.

不过，您不应该过早地进行优化。`fstreams`通常更好，如果您需要在以后优化它们，您可以随时以很少的成本在以后进行。为了提前做好最坏的准备，我建议`fstream`现在创建一个最小代理，以便您以后可以优化它，而无需触及其他任何东西。

# sql - SQL 连接与单表：性能差异？

> ID：477226
> 
> 赞同：31
> 
> 时间：2009-01-25T06:04:01.067
> 
> 标签：sql, join, normalization

我试图坚持保持数据库规范化的做法，但这会导致需要运行多个连接查询。如果许多查询使用连接而不是调用可能包含冗余数据的单个表，是否会导致性能下降？

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2009-01-25T06:07:24.443

保持数据库规范化，直到您发现瓶颈。然后，只有在仔细分析之后，您才能进行非规范化。

在大多数情况下，拥有一组覆盖良好的索引和最新的统计数据将解决大多数性能和阻塞问题，而无需任何非规范化。

如果对它进行写入和读取，则使用单个表可能会导致性能下降。

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2009-01-25T10:09:42.693

众所周知，迈克尔杰克逊（不是*那个*）[说过](http://en.wikiquote.org/wiki/Michael_A._Jackson)，

*   程序优化的第一条规则：不要这样做。
*   程序优化的第二条规则——仅适用于专家：暂时不要这样做。

那可能是在 RDBMS 出现之前，但我认为他会扩展规则以包含它们。

规范化数据模型几乎总是需要多表 SELECT；就像这类问题经常出现的情况一样，“非规范化”的“正确”答案？问题取决于几个因素。

数据库管理系统平台。

多表查询与单表查询的相对性能受应用程序所在平台的影响：查询优化器的复杂程度可能会有所不同。例如，根据我的经验，MySQL 在单表查询上的速度非常快，但并不能很好地优化具有多个连接的查询。对于较小的表（例如，少于 10K 行），这不是一个真正的问题，但对于大型（10M+）表来说确实很痛苦。

数据量

除非您正在查看 100K+ 行区域中的表，否则几乎不应该有问题。如果您正在查看数百行中的表大小，我什至不会考虑索引。

（去）规范化

规范化的重点是尽量减少重复，尽量确保必须更新的任何字段值只需要在一个地方进行更改。非规范化打破了这一点，如果对重复数据的更新很少（理想情况下它们不应该发生），这不是什么大问题。因此，在复制除最静态数据之外的任何内容之前，请仔细考虑，注意您的数据库可能会显着增长

要求/约束

您要满足哪些性能要求？你有固定的硬件或预算吗？有时，性能提升最容易——甚至最便宜——通过硬件升级来实现。您期望的交易量是多少？小型企业会计系统的配置文件与 Twitter 非常不同。

最后一个想法让我想到：如果你足够反规范化，那么你的数据库与平面文件有什么不同？SQL 非常适合灵活的数据和多维检索，但它可能比直接顺序或相当简单的索引文件慢一个数量级（至少）。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-24T20:47:40.507

> 性能差异？

理智差异。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-01-25T06:37:44.993

我们将查询优化留给数据库，原因与将代码优化留给编译器的原因相同。

如今，大多数现代 RDBMS 在这方面都非常出色。

在您认为在某些情况下非规范化是“好的”之前，请考虑一下：通常您对每个属性都不感兴趣。因此，从磁盘加载不需要的数据是低效的（通常是数据库中效率最低的组件）。如果你有一个非规范化的设计，这可能会更糟，连续有很多冗余数据。如果您必须更新所有冗余数据，那就更糟了。加载一些只包含感兴趣的列的窄表并将它们连接起来会更有效。同样，这取决于数据库，因此如果不进行分析，您将一无所知。

如果您真的担心性能，那么您可能正在谈论可伸缩性问题。在这种情况下，您可能想查看[sharding](http://en.wikipedia.org/wiki/Shard_(database_architecture))，其中正确的（标准化）模式设计很重要。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-01-25T14:00:55.183

为了规范化而分解表是有代价的。该成本有一个性能组成部分。在查询中分解表和连接数据的性能成本可以通过以下方式保持较低： 使用好的 DBMS；正确设计桌子；正确设计指标；让优化器完成它的工作；并调整物理设计的 DBMS 特定功能。

编写实现连接的大型表也是有成本的。在有关规范化的优秀教程中概述了更新异常和编程困难方面的成本。组合表也有性能成本。在许多 DBMS 产品中，将非常大的行加载到内存中的成本高于加载较小的行。当您编写非常宽的表时，您最终会迫使 DBMS 读取非常大的行，而只会丢弃大部分读入内存的数据。这比标准化更能减慢你的速度。

一般来说，不要随意去规范化。必要时，使用经过前人测试的设计规范，即使该规范会导致一些非规范化。我推荐星型模式作为这样的学科。它有很多事情要做。在很多情况下，标准化设计比星型设计更有效。

学习一组以上的设计原则并学习何时使用哪一组是学习成为专家的第二阶段。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-01-25T06:08:15.363

通过设置正确的索引，您的连接可以非常快速地执行。使用 SQL Profiler 确定需要创建或更改哪些索引以优化常见查询的性能。请务必为您的数据库设置一个维护计划，使其每周运行一次（或者对于变化很大的表，每天运行一次）以更新您的统计信息和索引。

规范化通常优于将数据保存在多个位置。在某些情况下，插入/更新不需要快速发生，而选择需要非常快速地发生，在这种情况下，如果不进行规范化可能会更好。即便如此，不建议过早优化，因此首先使用标准化结构。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-25T06:08:40.400

事实上，通过某些云站点提供的最终超优化之一是使用较少数量的更广泛、功能有限的表来提高效率。到目前为止，如果您需要大规模扩展，这是一种方法。但是对于任何关系 dbms（那些不是）来说，这都不是理想的做法。

如果您遇到性能问题，那么在进行任何类型的非规范化之前，首先需要处理很多事情。

# asp.net - 提交后需要帮助刷新页面

> ID：477230
> 
> 赞同：0
> 
> 时间：2009-01-25T06:07:57.237
> 
> 标签：asp.net

我正在开发一个遵循 3 层架构的 Web 应用程序。当我点击提交按钮时，数据存储在数据库中，但没有显示“记录提交成功”之类的响应消息，并且字段没有刷新。这是我的代码：

```
protected void BtnSubmit_Click(object sender, EventArgs e)
    {
        if (!Page.IsValid)
            return;

        NewuserBAL NUB = new NewuserBAL();    

        string UserName = TxtUserName.Text;
        string Password = PWD.Text;
        string EmailId = Email.Text;

        try
        {
            NUB.newinsert(UserName, Password, EmailId);
            Response.Write("<b>New User Created Successfully</b>");
            TxtUserName.Text = "";
            PWD.Text = "";
            CnfrmPwd.Text = "";
            Email.Text = "";
        }
        catch
        {
            throw;

        }

        finally
        {
            NUB = null;

        }

    } 
```

谢谢， 马苏姆

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-25T06:11:32.893

与其使用 Response.Write，不如设置一个诸如 labelResults 之类的标签来显示结果。Response.Write 不会出现在您呈现的 HTML 中的正确位置。

# python - 如何模拟有偏硬币的翻转？

> ID：477237
> 
> 赞同：31
> 
> 时间：2009-01-25T06:13:00.207
> 
> 标签：python, random, probability, coin-flipping

在无偏硬币翻转中，H 或 T 出现 50% 的次数。

但我想模拟硬币，它给出概率为“p”的 H 和概率为“（1-p）”的 T。

像这样的东西：

```
def flip(p):
   '''this function return H with probability p'''
   # do something
   return result

>> [flip(0.8) for i in xrange(10)]
[H,H,T,H,H,H,T,H,H,H] 
```

* * *

## 回答 #1

> 赞同：54
> 
> 时间：2009-01-25T06:17:59.213

`random.random()`返回[0, 1) 范围内*均匀分布*的伪随机浮点数。该数字小于`p`[0,1) 范围内的给定数字，概率为`p`。因此：

```
def flip(p):
    return 'H' if random.random() < p else 'T' 
```

一些实验：

```
>>> N = 100
>>> flips = [flip(0.2) for i in xrange(N)]
>>> float(flips.count('H'))/N
0.17999999999999999  # Approximately 20% of the coins are heads

>>> N = 10000
>>> flips = [flip(0.2) for i in xrange(N)]
>>> float(flips.count('H'))/N
0.20549999999999999  # Better approximation 
```

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-01-25T23:24:57.367

您是否希望“偏差”基于对称分布？或者可能是指数分布？高斯有人吗？

好吧，这是从随机文档本身中提取的所有方法。

首先，三角分布的一个例子：

```
print random.triangular(0, 1, 0.7) 
```

> **`random.triangular(low, high, mode)`**：
> 
> 返回一个随机浮点数`N`，`low <= N < high`并且在这些边界之间具有指定的模式。和*界限*默认*为零*`low`和一。参数默认为边界之间的 中点，给出对称分布。`high`**`mode`**
> 
>  ****`random.betavariate(alpha, beta)`**：
> 
> 贝塔分布。参数的条件是`alpha > 0`和 `beta > 0`。返回值范围介于`0`和之间`1`。
> 
> **`random.expovariate(lambd)`**：
> 
> 指数分布。 除以所需的平均值`lambd`。`1.0`它应该是*非零*的。（该参数将被称为“<em> `lambda`”，但这是 Python 中的保留字。）返回值的范围从正*无穷*`0`到正无穷，从*负无穷*到负无穷 。*`lambd`*`0``lambd`**
> 
>  ****`random.gammavariate(alpha, beta)`**：
> 
> 伽马分布。（不是 gamma 函数！）参数的条件是`alpha > 0`和`beta > 0`。
> 
> **`random.gauss(mu, sigma)`**：
> 
> 高斯分布。`mu`是平均值，`sigma`是标准差。这比`normalvariate()`下面定义的函数略快。
> 
> **`random.lognormvariate(mu, sigma)`**：
> 
> 对数正态分布。如果你取这个分布的自然对数，你会得到一个带有均值`mu`和标准差的正态分布`sigma`。`mu`可以有任何值，并且`sigma`必须大于 *零*。
> 
> **`random.normalvariate(mu, sigma)`**：
> 
> 正态分布。`mu`是平均值，`sigma`是标准差。
> 
> **`random.vonmisesvariate(mu, kappa)`**：
> 
> `mu`是平均角度，以 和 之间的弧度表示`0`，`2*pi`并且`kappa` 是浓度参数，必须大于或*等于零*。如果`kappa`等于*0*`0` ，则此分布在 到 的范围内减少为均匀的随机角度`2*pi`。
> 
> **`random.paretovariate(alpha)`**：
> 
> 帕累托分布。`alpha`是形状参数。
> 
> **`random.weibullvariate(alpha, beta)`**
> 
> 威布尔分布。`alpha`是尺度参数，`beta`是形状参数。****

 *** * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-01-25T06:14:29.970

```
import random
def flip(p):
    return (random.random() < p) 
```

这将返回一个布尔值，然后您可以使用它来选择您想要的 H 或 T（或在任何两个值之间进行选择）。您还可以在方法中包含选择：

```
def flip(p):
    if random.random() < p:
        return 'H'
    else:
        return 'T' 
```

但这种方式通常不太有用。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2014-08-24T09:09:20.390

怎么样：

```
import numpy as np
n, p = 1, .33  # n = coins flipped, p = prob of success
s = np.random.binomial(n, p, 100) 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2019-09-10T20:31:11.450

也可以使用以下方法从`X ~ Bernoulli(p)` 分发`nsamples`时间中采样`sympy`：

```
from sympy.stats import Bernoulli, sample_iter
list(sample_iter(Bernoulli('X', 0.8), numsamples=10)) # p = 0.8 and nsamples=10
# [1, 1, 0, 1, 1, 0, 1, 1, 1, 1] 
```

返回`'H'`或`'T'`改为使用

```
def flip(p, n):
    return list(map(lambda x: 'H' if x==1 else 'T', sample_iter(Bernoulli('X', p), numsamples=n)))

print(flip(0.8, 10)) # p = 0.8 and nsamples=10
# ['H', 'H', 'T', 'H', 'H', 'T', 'H', 'H', 'H', 'H'] 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-25T06:17:46.810

*   导入 0 - 1 之间的随机数（可以使用 randrange 函数）

*   如果数字高于 (1-p)，则返回尾部。

*   否则，返回头

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2019-09-10T21:18:59.490

```
import random
def flip():
    return ["H" if random.randint(0,3) <= 2 else "T" for i in range(10)] 
```

现在正面的概率是 75%，反面的概率是 25%（0,1,2 都是正面，只有 3 是反面）。通过使用 random.randint() 您可以在保持随机性的同时有任何偏差的可能性。

# iphone - 更改 UIView 的 bounds 属性不会影响其内容

> ID：477257
> 
> 赞同：6
> 
> 时间：2009-01-25T06:24:58.230
> 
> 标签：iphone

我是 iPhone 编程的新手，我正在尝试了解 frame 和 bounds 属性是如何工作的。在界面生成器中，我创建了小时候`UIView`放置的位置。`UIImageView`我`UIImageView`比父母的看法更大。并将“剪辑子视图”属性设置为父 UIView 的 true 和子 UIImageView 的 false。
当我以编程方式更改`frame.origin`孩子的属性时。`UIImageView`但是当我改变`bounds.origin`父母的财产时，`UIView`我什么也看不到。可能我错误地理解了`bounds`.

我应该怎么做才能获得 iPhone 应用程序编程指南中描述的行为：

*您可以在不更改其他两个属性的情况下更改边界原点。执行此操作时，视图会显示您已识别的基础图像部分。在图 2-4（第 56 页）中，原始边界原点设置为 (0.0,0.0)。在图 2-5 中，该原点移动到 (8.0,24.0)。结果，视图显示了底层图像的不同部分。然而，因为框架矩形没有改变，所以新内容显示在父视图内的相同位置。*

提前致谢。安德鲁

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-25T06:59:47.380

首先，在尝试更改其边界之前，请确保您对图像视图有正确的引用。检查它不是`nil`。

其次，您可能需要更改矩形，然后在单独的语句中再次设置，如下所示：

```
CGRect rect = imageView.bounds;
rect.origin = CGPointMake(whatever, whatever);
imageView.bounds = rect; 
```

Bounds 甚至可能不是您想要的。我不知道你从哪里得到的那句话，但听起来不对。尝试使用图像视图的框架将其定位在其父视图中。

# flash - 如何在Flash游戏中作弊和避免作弊？

> ID：477258
> 
> 赞同：3
> 
> 时间：2009-01-25T06:26:30.570
> 
> 标签：flash

我正在写一个保持高分玩家的小型在线 Flash 游戏。显然，我想阻止玩家作弊并获得任意高分。

在 Flash 游戏中最常见的作弊方法是什么？我可以做些什么来让它们难以使用？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-25T06:54:30.217

最常见的作弊方式是使用[作弊引擎](http://cheatengine.org/)。

[在 YouTube 上观看它的实际操作](http://www.youtube.com/watch?v=KO7EsFGlnDk)，以及 100 多个关于在最流行的游戏中作弊的教程。

阻止人们作弊几乎是不可能的。但是有[几种](https://stackoverflow.com/questions/73947/what-is-the-best-way-to-stop-people-hacking-the-php-based-highscore-table-of-a-f) [方法](https://stackoverflow.com/questions/25999/secure-online-highscore-lists-for-non-web-games)可以确保高分表，这些方法通常适用于作弊。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-25T10:16:16.550

*   使用 Burp / Fiddler 或 Tamper Data Firefox Extension 等代理进行最简单的作弊。
*   阅读[http://www.playnoevil.com/serendipity/](http://www.playnoevil.com/serendipity/)博客，那家伙还出过一本关于作弊和保护网络游戏（尤其是flash）的书
*   有第 3 方解决方案（主要是混淆 - 但非常复杂）
*   显然，攻击者可以使用反编译器并读取闪存代码，因此不要假设他们不知道您的代码（不要忘记混淆您的代码）

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-25T10:51:09.317

像[http://nonoba.com](http://nonoba.com)和[http://www.mochiads.com](http://www.mochiads.com)这样的网站有高分 API 和一些内置保护，所以如果它只是一个个人项目，这可能是一个选择。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-25T06:33:06.313

为了在发送到您的服务器时保护高分，请使用嵌入在您的应用程序中的密钥对其进行数字签名，或者发送数据的 HMAC（同样，嵌入在应用程序中的密钥）。

此建议假定人们不会对您的 Flash 游戏进行逆向工程。并不是说这很难，但在大多数情况下，攻击 Flash 游戏的方法要简单得多，所以这会提高标准。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-25T11:12:49.990

根据游戏的风格，有可能通过一种“重放”技术来验证服务器端的高分。

也就是说，不是将高分发送到服务器，而是将用户操作的记录发送到服务器。

这并不适合在动作游戏中使用，但对于其他类型（例如 Fantastic Contraption，甚至桌面 TD）来说，它是可行的。尽管您可能只会在特殊活动（锦标赛）或类似活动中启用它，因为对于流行游戏而言，这将是相当费力的。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2011-07-15T22:20:46.277

如果您希望游戏仅在您的服务器上运行，您还可以在接收技巧中检测信号的发送位置，并忽略任何不是来自您的域的内容。如果您必须从您的专用域运行以提交分数，那么篡改您的代码将是一件非常痛苦的事情。

这也阻止了 CheatEngine 的大部分技巧。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-11-25T07:52:08.087

我一直在[http://www.gameknob.com](http://www.gameknob.com)使用 GameInt API，结果非常好，因为 int 是加密的。由于这个 api 使用随机密钥进行异或加密，因此很难破解这些值。

希望这可以帮助！

# c# - 如何在接口 C# 中调用事件？

> ID：477259
> 
> 赞同：2
> 
> 时间：2009-01-25T06:27:42.873
> 
> 标签：c#, events, delegates, state-machine, interface-design

所以我有一个设计问题。我有一个具有代表和事件的鼠标类。即MouseButtonPressed、MouseMoved。并且被状态引擎调用。

我想要发生的是创建一个像 IClickable 或 IDraggable 或 somthing 这样的接口，并在这些接口内有事件，当鼠标事件被调用时会被调用。

```
public interface IClickable

public event MouseDevice.ButtonClickedHandler<MouseButtons, MouseState> Clicked; 
```

然后在 MouseDevice 类中它有

```
public delegate void ButtonClickedHandler<O, S>(object sender, InputDeviceEventArgs<O, S> e); 
```

和

```
public event ButtonClickedHandler<MouseButtons, MouseState> ButtonClicked; 
```

所以基本上我希望在调用 buttonClicked 时调用 Clicked。

有没有办法做到这一点？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-25T07:21:27.323

你的意思是这样的？

```
public class MouseDevice {
    public delegate void ButtonClickedHandler<O, E>(O sender, E e);
}

public interface IClickable<O,E> {
    event MouseDevice.ButtonClickedHandler<O,E> Clicked;
}

public class StateMachine : IClickable<Control,MouseEventArgs>
{

    public event MouseDevice.ButtonClickedHandler<Control, MouseEventArgs> Clicked;

    protected void OnButtonClicked(Control sender,MouseEventArgs e) { 
        if (Clicked != null){
            Clicked(sender, e);
        }
    }
}

public class Test {
    public static void main(string[] args)
    {
        StateMachine m = new StateMachine();
        m.Clicked += new MouseDevice.ButtonClickedHandler<Control, MouseEventArgs>(m_Clicked);
    }

    static void m_Clicked(Control sender, MouseEventArgs e)
    {
        //Handle Click Event...
    }
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-15T11:19:58.510

当您在接口内声明一个事件时，它实际上并没有创建可以调用的事件 - 您必须在任何实现该接口的类中实现该事件。

由于接口不能包含任何代码，因此您必须在所有实现类中分别添加 OnMouseClicked 方法（或其他方法）以调用类中的事件。您也可以在接口本身上使 OnMouseClicked 成为扩展方法，但这稍微颠覆了扩展方法的用途......

# .net - 是否有从 ASP.NET 1.1 到 3.5 的（相对）无痛升级路径？

> ID：477266
> 
> 赞同：4
> 
> 时间：2009-01-25T06:33:33.457
> 
> 标签：.net, asp.net, vb.net, visual-studio-2008, upgrade

我的一个客户有一个用 VB.NET 1.1 编写的电子商务 CMS。（最初的解决方案是使用 Visual Studio 2003 编写的。）它不是一个巨大的站点，但它确实包含大约 40 或 50 个 Web 表单，我想将它升级到 .NET 3.5，并维护和继续开发它它与VS 2008。

我确信我可以通过外科手术来完成，一次重新创建一个文件，在每个步骤中进行测试，等等，但是有没有更简单的方法？我有点乐观地希望 VS 2008 会提供某种升级向导，但对于网站项目来说，似乎没有这样的运气。

有人经历过这个吗？如果是这样，您认为最明智的方法是什么？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-25T06:50:35.667

我已经做了两种方式 - 一次重新创建一个文件，也只是离开它。重新创建项目花费的时间比我想象的要长，我最终在一个大约 200 页的网站上花费了大约 5-10 分钟。如果我知道这需要这么长时间，我就不会这样做了。只有当您要积极维护网站而不是偶尔更新时，我才会建议您提前投入时间。（话又说回来，如果你按小时计酬的话……嗯……）

从那时起，在项目中，我让向导将解决方案升级到 VS2008（稍微更改 web.config、引用和您的项目文件），然后我就让丑陋的代码保持原样。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-25T07:54:57.863

没有魔术按钮可以做到这一点。所有应用程序都需要根据它们的构建方式进行相应的处理。大多数情况下，向导做得很好，但您需要执行演练代码审查，以便重构和利用新的框架版本。

希望我的客户也批准对应用程序的框架升级。但大多数时候他们宁愿不这样做，因为完成它需要时间。

# java - 每次会话会话的好处是什么？

> ID：477267
> 
> 赞同：5
> 
> 时间：2009-01-25T06:34:24.250
> 
> 标签：java, hibernate, web-applications, session

目前，我正在使用按请求会话的方法来管理 Java Web 应用程序中的 Hibernate 会话。我听说过会话每次会话这个术语，我想知道它适合什么情况以及它可以为每次请求会话带来什么好处？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-25T12:29:42.690

我经历过的主要好处之一是，您可以实现并非所有更改都应直接提交到数据库的行为——每个会话的会话将允许您在多个请求上设置对象，并且只提交到数据库最后的“是的，我真的很想这样做”的动作。典型的场景是使用类似向导的一系列页面预订酒店房间。

# .net - 我可以返回 DataTable 来填充 ASP.NET AJAX 客户端模板吗？

> ID：477269
> 
> 赞同：1
> 
> 时间：2009-01-25T06:35:57.930
> 
> 标签：.net, asp.net-ajax, client-templates

以下服务器端代码有效：

```
[OperationContract]
public IEnumerable<object> GetBooks() {
    var people = new List<object>
                     {
                        new Book{ Author="Richard Preston", Title="The Hot Zone"},
                        new Book{ Author="Jim Norton", Title="I Hate Your Guts"}
                     };
    return people.AsEnumerable();
} 
```

这是客户端代码的一部分：

```
<table class="Template">
    <thead>
        <tr>
            <th>Author</th>
            <th>Title</th>
        </tr>
    </thead>
    <tbody id="bookListView">
        <tr>
            <td>{{Author}}</td>
            <td>{{Title}}</td>
        </tr>
    </tbody>
</table>

function pageLoad() {
    $create(Sys.UI.DataView, { serviceUri: "MyService.svc", query: "GetBooks" }, {}, {}, $get("bookListView"));
} 
```

我希望能够向客户端返回一个 DataTable，并通过简单地引用每个列的名称来填充客户端模板。那可能吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-21T23:40:54.343

延迟回答，但是是的-我认为您缺少的是 bookListView tbody 上的 class="sys-template" 。

# javascript - 无浏览器 JavaScript

> ID：477305
> 
> 赞同：5
> 
> 时间：2009-01-25T07:14:18.040
> 
> 标签：javascript

我曾与 Snap-On Tools 的团队负责人交谈过，她告诉他们使用“JavaScript 实现”进行服务器端编码。已经有一段时间了，但我在想，她说的是WTF吗？除了在浏览器中实现的解释器之外，还有 JavaScript 解释器吗？

**如何使用不在浏览器上下文中执行的 JavaScript 创建程序或代码，尤其是服务器端的程序或代码？如果 JavaScript 在浏览器加载后不生成内容，那么服务器端到底是什么鬼？“服务器端”JavaScript 能否在 HTTP 响应交付之前生成内容？如果可以，它是如何工作/设置的？**

我对 JavaScript 有很多问题，但一流的函数是如此性感。而 JavaScript Object Notation 就是这么纯粹；我无法想象一种更简单的方法来定义数据结构。另外，如果您不编写任务关键的东西，您可以使用动态类型快速破解一些代码。

作为一个附带问题，鉴于最后一段，您对学习一门好的语言有什么建议（评论就足够了）？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-01-25T07:19:56.733

如果您使用 ECMAScript 引擎，则不必在浏览器中运行 JavaScript。实际上，[SpiderMonkey](http://www.mozilla.org/js/spidermonkey/)和[Rhino](http://www.mozilla.org/rhino/)都是[ECMAScript 引擎](http://en.wikipedia.org/wiki/List_of_ECMAScript_engines)。

Flash 的 ActionScript 是另一种 ECMAScript 派生语言，不必在浏览器中运行。

编辑-哇，三年来发生了很多变化。对于您的服务器端需求，我现在推荐 node.js。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-25T08:07:09.383

我知道的可以独立运行或嵌入其他代码的 JS 解释器列表：

*   [谷歌的 V8](http://code.google.com/p/v8/) (C++)
*   [金特](http://jint.codeplex.com/)(.NET)
*   [Microsoft 的 JScript](http://msdn.microsoft.com/en-us/library/hbxc2t98.aspx) (.NET)，旧的
*   [Java 6 (Java) 中的 JavaScript ScriptEngine](http://java.sun.com/developer/technicalArticles/J2SE/Desktop/scripting/)，以前是 Mozilla 的 Rhino
*   [Mozilla 的 SpiderMonkey](http://www.mozilla.org/js/spidermonkey/) (C)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2012-03-22T23:00:30.627

供参考，[node.js](http://nodejs.org/)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-25T07:25:52.710

我听说过关于 的好消息[`Jaxer`](http://www.aptana.com/jaxer)。

到目前为止，这些服务器端 javascript 解决方案中最流行/最有吸引力的部分是关于数据验证。您可以使用与在服务器上再次验证表单客户端相同的代码，以确保它们的完整性。这在简单地保持干燥并且在某些事情发生变化时不会使规则不同步时非常有用。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-01-25T07:56:05.380

与 VBScript 一样，经典的 ASP 页面可以使用 JScript 作为底层脚本语言。您可以使用 CSCRIPT.EXE 在 Windows 命令行上运行 JScript 程序。事实上，它是同一个脚本引擎，并且可以扩展以支持任意数量的语言。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-25T07:19:23.347

[SpiderMonkey](http://www.mozilla.org/js/spidermonkey/)和[Rhino](http://www.mozilla.org/rhino/)似乎非常相关。SpiderMonkey 似乎是一个用于执行 JS 的 C 库，而 Rhino 是一个 Java-ditto。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-01-25T07:20:32.643

是的，JavaScript 虚拟机存在于浏览器之外。这是专门定制的[服务器端](http://en.wikipedia.org/wiki/Server-side_JavaScript)适配的列表。

我个人在命令行上使用它 Spidermonkey 来尝试代码。Rhino 是与 Spidermonkey 相同的 ECMAScript 改编版（相同的语言实现），但 Rhino 运行在 Java VM 上，Spidermonkey 是用 C 编写的。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-25T08:18:25.240

如前所述，[Rhino](http://www.mozilla.org/rhino/)是一个用 Java 编写的 JavaScript 引擎。

Java 6 有一个新的脚本引擎工具，在包中适当地称为[Java Scripting API](https://scripting.dev.java.net/)[`javax.script`](http://java.sun.com/javase/6/docs/api/javax/script/package-summary.html)，基于 Rhino 的引擎可以开箱即用。我不确定这在 Java EE 上是否可用，但它是 Java SE 的标准功能。

使用 Scripting API 非常简单，并且允许 Java 应用程序很容易地运行用 Javascript 编写的脚本。如果您需要在应用程序中编写脚本，则无需编写自己的解释器——只需使用 Scripting API。此外，脚本引擎可以访问 Java 类库，因此它也可以很好地集成以在您的应用程序中执行任务。

例如，使用 Scripting API 计算 4 的平方根非常简单：

```
ScriptEngineManager manager = new ScriptEngineManager();
ScriptEngine engine = manager.getEngineByName("JavaScript");
engine.eval("var x = java.lang.Math.sqrt(4);");
engine.eval("println(x);"); 
```

在服务器端使用它的上下文中，我可以设想一个外部 Jaavscript 由 Rhino 执行，然后将结果嵌入到正在提供的动态生成的 HTML 页面中。这样，无需更改 Web 应用程序本身即可添加或修改功能。Javascipt 脚本本身可以或多或少类似于主应用程序的插件。

[Java Scripting Programmer's Guide](http://java.sun.com/javase/6/docs/technotes/guides/scripting/programmer_guide/index.html)有几个示例，这些示例是逐步构建的，以介绍 Java Scripting API 的功能。

Javascript 不一定必须局限于浏览器。与任何脚本语言一样，它实际上取决于托管脚本引擎的位置。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-01T17:53:50.040

还有 HTTPUnit，它更像是一个浏览器模拟器，因此，它允许您与 DOM 交互。

[http://httpunit.sourceforge.net/](http://httpunit.sourceforge.net/)

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-02-03T22:16:57.103

您是否查看过 John Resig 关于使用 Rhino 创建服务器端 Javascript 引擎的帖子？

（[http://ejohn.org/projects/bringing-the-browser-to-the-server/](http://ejohn.org/projects/bringing-the-browser-to-the-server/)）

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-02-13T15:43:24.040

## 选择引擎

其他答案已经提到了几个 JS 引擎。决定使用哪一种语言的一个非常重要的因素是实现它的语言（C、C++ 或 Java 是选择），因为这种“宿主语言”将是您可以轻松访问的语言。

例如，如果您使用 rhino，您可以[轻松地](http://www.mozilla.org/rhino/ScriptingJava.html)从 javascript 代码访问整个 java 标准库（通常您将在 JS 中编写包装器，因此您不会在 JS 代码中散布所有这些 java-lib 调用）。

## 选择框架

已经提到了几个。我最喜欢[海尔玛](http://dev.helma.org/)。旧的和尝试过的。许多大型网站都在上面运行。在 github 上还有一个性感但非常 alpha 版本的 helma：http: [//github.com/hns/helma-ng/](http://github.com/hns/helma-ng/)

## 服务器端 JS

你可能也对这个小组感兴趣，他们试图统一 JS 在服务器端的工作方式（提供标准库等）。刚刚开始这个小组，但是有很多聪明的人在 serversideJS 上工作多年：

[https://wiki.mozilla.org/ServerJS](https://wiki.mozilla.org/ServerJS)

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2011-02-04T10:28:24.557

[jslibs](http://code.google.com/p/jslibs/)是一个很好的无浏览器 JavaScript 运行时（基于 Firefox 的 JS 引擎）

# tfs - 如何在 TFS 中查看其他用户签出的所有项目？

> ID：477314
> 
> 赞同：26
> 
> 时间：2009-01-25T07:22:48.210
> 
> 标签：tfs

我想要 TFS 2005 项目中所有用户的所有签出文件的列表。我现在只能看到*我*签出的文件 - 在挂起的更改窗口中。我记得在 Source Safe 中有这样一个选项 - TFS 2005 中有一个吗？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2012-04-11T18:53:54.977

我用：

```
tf status itemspec /user:* /recursive 
```

在 VS 命令提示符中。itemspec 是要搜索结帐的项目的 TFS 路径。无需额外安装 ;)

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2009-01-25T08:14:40.227

2008年[10 月版的 TFS 电动工具](http://msdn.microsoft.com/en-us/tfs2008/bb980963.aspx)包括“团队成员”功能，允许您执行此操作等。

有关此功能的更多信息，请[参见 Brian Harry 的博客](http://blogs.msdn.com/bharry/archive/2008/10/01/preview-of-the-next-tfs-power-tools-release.aspx)。

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2009-01-25T08:01:57.927

我通常为此使用[TFS SideKicks](http://www.attrice.info/cm/tfs/)。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2014-09-30T14:35:29.527

电源工具选项：*“打开 Visual Studio > 单击文件 > 源代码管理 > 在源代码管理中查找 > 状态选择“显示所有已签出”或“显示文件已签出到”（按用户过滤更改）点击查找“*

[http://geekswithblogs.net/MikeParks/archive/2009/09/16/tfs---view-all-pending-changes-for-all-users.aspx](http://geekswithblogs.net/MikeParks/archive/2009/09/16/tfs---view-all-pending-changes-for-all-users.aspx)

__

使用 .net 的另一种方式（完整[源代码](https://github.com/ImaginaryDevelopment/config/blob/master/My%20Documents/LINQPad%20Queries/Tfs/ViaTfsDlls/QueryAllPendingChanges.linq)）

```
using(var tfsPc=new TfsTeamProjectCollection(tfsUri))

    {
        var vcs=tfsPc.GetService<Microsoft.TeamFoundation.VersionControl.Client.VersionControlServer>();

        var srcRoot=vcs.GetItem(srcpath);

        var pendings=vcs.QueryPendingSets(new[]{srcRoot.ServerItem}, RecursionType.Full,null,null).AsEnumerable();
        if(onlyLocks)
            pendings=pendings.Where(pq=>pq.PendingChanges.Any(pc=>pc.IsLock));
        if(minDate.HasValue)
            pendings=pendings.Where(pq => pq.PendingChanges.Any( pc => pc.CreationDate > minDate.Value));
        var pendingQuery=pendings
            .OrderByDescending(p=>p.PendingChanges.Max(d=>d.CreationDate));
        pendingQuery.Dump("pending");   

    } 
```

[与上面类似，但加入 ActiveDirectory 以获取用户名](https://github.com/ImaginaryDevelopment/config/blob/master/My%20Documents/LINQPad%20Queries/Tfs/ViaTfsDlls/queryTfs10Api.linq)

# macos - 是否有适用于 OS X 的敏捷用户故事应用程序？

> ID：477321
> 
> 赞同：2
> 
> 时间：2009-01-25T07:28:20.507
> 
> 标签：macos, agile, user-stories

有谁知道任何可以用来创建敏捷用户故事而不是使用 3M 便笺手动创建的软件。我正在努力变得更环保，成为一个好的应用程序，我可以用它来收集用户故事，然后创建一个漂亮的文档来交给客户。

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-25T08:23:54.670

[胶粘物](http://en.wikipedia.org/wiki/Stickies)？不过，说真的，我会使用个人 wiki 或大纲应用程序，例如[OmniOutliner](http://www.omnigroup.com/applications/omnioutliner/)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-03-19T21:07:12.803

[这里](http://code.google.com/p/storyboard-agile/)有一个名为 Storyboard 的相当简单的应用程序。它允许添加故事、编辑阶段但不能打印。只是一个简单的数据库。

# iphone - UITableView 背景图片 alpha 问题

> ID：477325
> 
> 赞同：3
> 
> 时间：2009-01-25T07:33:52.430
> 
> 标签：iphone, png, alpha

我有一个 UIView 和一个 UITableView 的子视图。UIView 通过 setBackGroundColor 将图像应用于其背景，我以相同的方式将背景应用于 UITableView。两个图像都是 PNG，并且 UITableView 的背景具有似乎不起作用的透明度级别——PNG 似乎是在不考虑其中的透明度数据的情况下呈现的——我应该看到背景UIView 通过它。我用于应用背景图像的基本代码是：

```
UIImage *patternImage = [UIImage imageNamed:@"background.png"];
[tableContainer setBackgroundColor:[UIColor colorWithPatternImage: patternImage]]; 
```

我难住了。有任何想法吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-25T14:02:49.467

您需要确保您的表格视图不是不透明的。

在 Interface Builder 中，取消选中表格视图的“不透明”设置。或者，在代码中，

```
tableView.opaque = NO; 
```

请记住，任何与表视图相关的透明度都会显着降低性能。如果您只有几行，您可能会没事，但如果您进行任何滚动，请准备好承受一些痛苦。确保在发布之前在真实设备上进行测试。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-25T19:18:03.967

原来我需要设置单元格内容视图的背景颜色，而不是设置单元格本身的背景颜色。

再次感谢您的帮助！

# c++ - 如何在 std::remove_if 之后使用“已删除”的元素

> ID：477331
> 
> 赞同：3
> 
> 时间：2009-01-25T07:37:01.033
> 
> 标签：c++, stl

假设我们有：

```
struct IsEven {
   bool operator() (int i) { return i % 2 == 0; }
}; 
```

然后：

```
vector<int> V; // fill with ints
vector<int>::iterator new_end = remove_if(V.begin(), V.end(), IsEven());
V.erase(new_end, V.end()); 
```

工作正常（它只留下`V`奇数）。但似乎`new_end`to的`V.end()`元素*不是*我们要删除的偶数。例如，如果`v`以 开头`1 4 2 8 5 7`，那么我会得到`8 5 7`这些元素（尽管在`erase`调用之后，向量确实已经`1 5 7`离开了）。

显然，（根据[http://www.sgi.com/tech/stl/remove_if.html](http://www.sgi.com/tech/stl/remove_if.html)）

```
The iterators in the range [new_last, last) are all still dereferenceable,
but the elements that they point to are unspecified. 
```

首先，WTF？其次，我如何在不重新实现的情况下解决这个问题`remove_if`？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-25T07:58:47.730

听起来您想使用`partition()`将向量划分为开始时的奇数组和结束时的偶数组。 `partition()`将迭代器返回到第二个分组的第一个元素。

至于 WTF，我不确定您为什么希望删除操作通过将要删除的元素（这是额外的工作）复制到容器的末尾来保留要删除的元素。大多数人认为`remove()`（和它的表亲）中的 WTF 是向量的大小没有减小的事实，并且您必须`erase()`在删除操作后调用以实际删除不需要的元素。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-25T07:54:43.353

我想重点是调用该函数是`remove_if`有原因的。它删除元素。它不会移动它们或选择它们。在您调用 remove_if 之后，您不再保证您删除的元素存在。您可以保证的是元素之间的元素`first`不`new_last`包含任何已删除的元素。

`std::partition`会是更好的选择，不是吗？或者也许`remove_copy_if`，取决于你想要做什么。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-25T07:59:17.323

如果您真的想使用“已删除”的元素，则需要[std::partition](http://stdcxx.apache.org/doc/stdlibref/partition.html)。

# python - 最适合建模模拟的语言？

> ID：477335
> 
> 赞同：0
> 
> 时间：2009-01-25T07:40:47.737
> 
> 标签：python, sage

我将参加为期三天的模特比赛。我需要一种快速且专为建模而设计的语言，例如 2D/3D 模型。

我考虑过这些语言：

1.  Python
2.  智者

你会使用哪些语言？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-25T08:30:02.317

你应该使用你最熟悉的语言，并且有足够好的工具来完成手头的任务。根据比赛的时间，您可能没有时间学习新的语言/环境。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-25T08:29:10.727

看看[http://www.processing.org/——](http://www.processing.org/)它是一种编程语言（类似于 java）和专门为模拟和数据可视化而开发的 IDE。鉴于它是在教学环境中开发的，它很容易使用，并且很快就会给你带来很好的结果——我已经看到了令人惊叹的应用程序（例如，[网页作为图形](http://www.aharef.info/static/htmlgraph/)，[复杂化](http://www.complexification.net/)）

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-01-25T08:21:49.383

我会使用 C++，因为它会花三天时间编写 C++ 代码，而且它比 python 快得多，如果是一天的比赛，这将是我的选择。所以我可能会在模型中使用 C++ 和 OpenGL 和 SDL。我将首先用 C++ 编写模拟，如果最后有时间，我会尝试在着色器中实现它们（如果可能的话）。

# nhibernate - NHibernate 映射问题——“未知实体类：System.Int64”

> ID：477343
> 
> 赞同：0
> 
> 时间：2009-01-25T07:54:15.803
> 
> 标签：nhibernate

NHibernate 让我“发疯”！！！

我有以下映射。当我尝试将记录添加到数据库时，它会返回此错误。“未知实体类：System.Int64”

```
 <class name="CalConnector" table="tb_calConnectors" lazy="false" >
<id name="id" column="id">
  <generator class="hilo"/>
</id>
<many-to-one name="calendarID" class="Calendar" lazy="false" cascade="save-update">
  <column name="calendarID" sql-type="bigint" not-null="false"/>
</many-to-one> 
```

我像这样设置映射，所以当我使用映射文件生成架构时，设置了这个外键； `CONSTRAINT [FK94A85A28236EBB2B] FOREIGN KEY ([calendarID]) REFERENCES [dbo].[tb_calendars] ([id])`

我生成了架构，一切都很棒。现在，当我尝试添加引用现有 calendarID 的 CalConnector 时，出现错误。如果我取出多对一的关系；IE：

```
<property name="calendarID"/> 
```

我可以创建记录，但是当 NHibernate 生成架构时，未设置外键。

仅仅设置一些简单的 CRUD 东西就需要我几个小时。我希望 NHibernate 会给我一些回报，让我付出所有的时间来做对。

如果有人能发现问题，请给我一个提示，然后我可以完成这件事并喝一杯当之无愧的啤酒。非常感谢 *2 的任何帮助。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-26T09:05:53.217

我不建议你在多对多标签中将calendarId 作为名称，name 属性必须是保存日历的属性的名称，即name="Calendar"。另一部分似乎还可以，但我认为指定 sql 类型根本没有帮助，这可以防止数据库不可知论，因为覆盖了 hbm2ddl 类型变形。因此，您可以尝试以下映射：

```
<class name="CalConnector" table="tb_calConnectors" lazy="false" >
  <id name="id" column="id">
    <generator class="hilo"/>
  </id>
  <many-to-one name="Calendar" class="Calendar" lazy="false" cascade="save-update" column="calendarId" not-null="false" />
</class> 
```

请记住，CalConnector 必须具有一个名为 Calendar 类型的虚拟属性 Calendar 才能使用此映射。

# yui - 为什么 YUI 菜单等待我的页面图像加载？

> ID：477348
> 
> 赞同：0
> 
> 时间：2009-01-25T07:55:49.140
> 
> 标签：yui, yui-menu

**编辑：**这是 jQuery 1.3.1 中已确认的错误。它在 jQuery 1.3.2 中得到修复。

* * *

我有一个与[此示例](http://developer.yahoo.com/yui/examples/menu/topnavfrommarkup_source.html)完全相同的 YUI 菜单控件，顶部有子菜单。

我尝试使用雅虎的代码来初始化菜单：

```
YAHOO.util.Event.onContentReady("mnuTopNav", function() {

    var oMenuBar = new YAHOO.widget.MenuBar("mnuTopNav", {
        autosubmenudisplay: true,
        hidedelay: 750,
        lazyload: true
    });

    oMenuBar.render();
}); 
```

我发现包含需要时间加载的图像的页面存在问题。

我注意到标题会立即出现（通信/购物/娱乐），但是在加载所有图像之前不会出现指示有子项目的小箭头。

我觉得这很奇怪。我什至尝试将代码切换到 JQuery 以查看是否会在图像加载完成之前进行初始化（这就是`$(function()`我认为应该做的）。

```
$(function(){

        var oMenuBar = new YAHOO.widget.MenuBar("mnuTopNav", {
            autosubmenudisplay: true,
            hidedelay: 750,
            lazyload: true
        });

        oMenuBar.render();
}); 
```

令我惊讶的是，我仍然有同样的问题。在整个页面加载之前，菜单不会初始化。

这绝对是正在等待的图像。

注意：此问题仅存在于 Internet Explorer 中。Firefox 似乎在加载图像之前引发了这个 onContentReady 事件。

我可以解决这个问题吗？

* * *

**编辑：**这是 jQuery 1.3.1 中已确认的错误。它在 jQuery 1.3.2 中得到修复。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-29T16:40:23.917

您是否尝试过使用 YUI 的 onAvailable() 而不是 onContentReady()？来自[YUI 的文档](http://developer.yahoo.com/yui/event/#onavailable)：

> onContentReady 方法与 onAvailable 共享相同的语法。这两种方法的主要区别在于，onContentReady 会等待目标元素及其在 DOM 中的 nextSibling 都响应 getElementById。这保证了目标元素的内容将完全加载（您以后可能通过脚本添加的任何动态内容除外）。如果 onContentReady 从未检测到 nextSibling，它会使用 window.load 事件触发。

我的猜测是浏览器需要在 nextSibling 属性起作用之前将图像加载到 DOM 上，所以 onContentReady() 正在等待它。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-25T09:37:45.813

对于 jQuery，你应该这样做：

```
 $(document).ready(function(){

        var oMenuBar = new YAHOO.widget.MenuBar("mnuTopNav", {
            autosubmenudisplay: true,
            hidedelay: 750,
            lazyload: true
        });

        oMenuBar.render();
   }); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-25T12:55:53.403

雅虎的 onContentReady(...) 似乎出于某种原因等待图像加载，所以我已经停止使用它。

此外，如何 $(function() { }); 中似乎存在一个 JQuery 错误。作品

请参阅我的[这篇文章](https://stackoverflow.com/questions/477463)，以获取有关该问题的更多详细信息。

# c# - 在 C# 中，我应该将计时器的引用保存在哪里？

> ID：477351
> 
> 赞同：15
> 
> 时间：2009-01-25T07:57:21.383
> 
> 标签：c#, .net, garbage-collection, reference, timer

的文档`System.Threading.Timer`说我应该为它保留一个实时参考，以避免它被垃圾收集。但是我应该在哪里做呢？我`main`的很简单，我不知道在哪里保留参考：

```
class Program {
    static void Main() {
        new System.Threading.Thread(myThreadStart).Start();
        new System.Threading.Timer(myTimerCallback, new MyStateObject(), 0, 5000);
    }
} 
```

我考虑将引用保存在类中的一个`static`字段中`Program`，假设`static`在应用程序结束之前不会收集这些字段。但我不确定这是最好的方法，所以我很感激你的建议。

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-01-25T08:58:39.200

如果您的 Timer 是应用程序级别的对象，那么将其设置为 Main 类的私有静态成员没有任何问题。无论如何，这就是我会做的。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-01-25T07:59:57.230

编辑：我原来的答案是垃圾。真的很垃圾。我把它放在这里是为了解释*为什么*它是垃圾 - 它在评论中，但他们已经被删除了答案。

GC.KeepAlive 仅确保在调用之后引用被视为根。在此答案底部的代码中，将立即调用 GC.KeepAlive 方法，然后计时器仍然有资格进行垃圾收集。因为新创建的线程是前台线程，所以只要它还活着，应用程序就会运行（而计时器使用后台线程，这不会阻止程序退出）。这意味着 Main 方法退出，但应用程序需要继续运行。

可以说一个*更简单*的解决方案是`myThreadStart`在主线程中运行，而不是创建一个新线程然后让主线程死掉。换句话说，一个简单的解决方案是：

```
using System.Threading;

class Program {
    static void Main() {
        Timer timer = new Timer(myTimerCallback, 
                                new MyStateObject(), 0, 5000);
        myThreadStart();
        GC.KeepAlive(timer);
    }
} 
```

我假设*真正的*代码更复杂 - 在这种情况下，使用其他答案中建议的私有静态变量可能是要走的路。不过，这确实取决于使用情况。我个人不喜欢创建静态字段，只是为了防止在有替代方法（如上）的情况下收集某些东西，但有时它实际上是唯一的方法。

**原始（坏）答案：**

如果你真的想在 Main 中分配它，那么你可以使用[GC.KeepAlive](http://msdn.microsoft.com/en-us/library/system.gc.keepalive.aspx)：

```
using System.Threading;

class Program {
    static void Main() {
        new Thread(myThreadStart).Start();
        Timer timer = new Timer(myTimerCallback, 
                                new MyStateObject(), 0, 5000);
        GC.KeepAlive(timer);
    }
} 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-25T08:01:57.070

我认为可以保留您班级的*私有静态*字段。

我会将此引用保留为静态字段，而不是使用垃圾收集器。

# sony - 通过火线控制摄像机

> ID：477360
> 
> 赞同：0
> 
> 时间：2009-01-25T08:08:21.847
> 
> 标签：sony, firewire, video-camera

某些 SONY 相机具有[FireWire](http://en.wikipedia.org/wiki/Firewire)接口。

[是否可以使用任何FireWire SDK](http://www.unibrain.com/Products/DriverAPI/FireAPI.html)等通过 FireWire控制任何**相机**功能？

*   **磁带：**录音/停止，快进/快退
*   **镜头：**曝光、变焦、快门速度、对焦、白平衡
*   **其他：**效果（棕褐色/反转）

**成立：**

*   [Adobe Premiere](http://www.adobe.com/products/premiere/)可以[控制**磁带**播放](http://www.manifest-tech.com/premiere/dvcapture.htm#DV%20Device%20Control)功能（播放、快进/快退）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-25T08:13:29.307

开源视频编辑器[kinoDV](http://www.kinodv.org/)为包括索尼在内的各种相机执行此操作。也许看看来源？

# firefox - 如何为现有的 cgi 脚本编写 firefox 插件？

> ID：477368
> 
> 赞同：0
> 
> 时间：2009-01-25T08:19:33.680
> 
> 标签：firefox, plugins

我有一个采用表单输入的 cgi 脚本，我想简化用例，如果您从 firefox 右键单击​​输入将传递给 cgi（而不是用户显式输入值）。首先这可以做到吗？如果是的话，任何我可以开始/可以查看的代码片段的指针都会很棒。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-25T12:03:20.217

这是可以做到的。Google for firefox 扩展，你会得到很多提示：

[http://developer.mozilla.org/en/Extensions](http://developer.mozilla.org/en/Extensions)

[http://developer.mozilla.org/en/Building_an_Extension](http://developer.mozilla.org/en/Building_an_Extension)

[http://lifehacker.com/software/programming/how-to-build-a-firefox-extension-264490.php](http://lifehacker.com/software/programming/how-to-build-a-firefox-extension-264490.php)

由于大多数扩展不包含任何已编译的代码（其中大部分将是 xml (xul) 和 javascript），您还可以寻找一个扩展，它可以完成您想要的部分内容并调查它的内容——请务必在之前检查许可证但是，您开始复制（完整）代码。在您的谷歌搜索中添加“右键单击”可能会帮助您找到这些。

# sql-server - SQL Server 列关系

> ID：477370
> 
> 赞同：1
> 
> 时间：2009-01-25T08:21:28.747
> 
> 标签：sql-server

我有两张桌子。

一个是“Corporations”（例如，一个记录是 Taco Bell）。此表的索引和 PK 名为“Id”。

我还有另一张表：“Branches”（例如，一条记录是针对洛杉矶的）。Branch 表有一个名为“Corporation”的列。此列应仅接受与“Corporations”表中的“Id”对应的“Id”值。

我该如何执行？我要添加约束吗？我怎么做？

如果我找错了树，我该如何定义公司和分支机构之间的这种关系？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-25T08:24:44.370

向引用 Corporations 的 Branches 添加 FOREIGN KEY。

即在分支的 CREATE TABLE 中：

```
CREATE TABLE Branches
(
  ...
  CorporationId int NOT NULL
    CONSTRAINT FOREIGN KEY FK_Branches_Corporations REFERENCES Corporations(Id)
  ...
) 
```

# linux - 如何在 Windows 上运行 ShellScript？

> ID：477371
> 
> 赞同：1
> 
> 时间：2009-01-25T08:21:40.960
> 
> 标签：linux, shell

我只是一名学生，我正在大学学习 ShellScript。在大学实验室，我们的女士只是要求在 PUTTY 中输入一个 IP 地址并启动它，打开 Vi 编辑器并进行编程。我在家里怎么做？我在我的电脑上运行 XP。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-25T08:24:42.997

我建议你在家里安装[cygwin 。](http://cygwin.com/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-25T08:25:10.580

您应该查看[cygwin](http://www.cygwin.com/)，使用相关实用程序将其安装在您的主机上并尝试。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-08T18:50:14.217

从 DVD 运行 Linux 版本对您有用吗？

您可以从他们的网站[http://www.knoppix.net/下载 Knoppix Linux 的磁盘映像](http://www.knoppix.net/)

并将其刻录到 DVD。然后，您可以重新启动计算机并从 DVD 运行 Knoppix，而无需更改计算机上的任何内容。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-08T18:58:25.197

我不想对我不参加的课程做出判断，但是根据您的描述，听起来您可能无法了解有关 shell 脚本的整个故事。

正如其他人所建议的那样，Cygwin 是要走的路，非常好。这是 bash 的一个很好[的方法](http://tldp.org/HOWTO/Bash-Prog-Intro-HOWTO.html)。我会避免使用 tcsh 或任何其他版本的 c shell（有怪物）。

如果你最终需要做一些更高级的事情，bash 可能会很麻烦。您应该考虑使用通用语言，例如在 cygwin 中也可用的[python](http://python.org)或作为独立的 Windows 安装程序。但是，对于过程控制，bash 才是王道。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-25T09:20:32.450

您可以将 Xemacs 用于 window 和相应的 windows 包。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-25T09:21:37.983

但是我觉得 Cygwin 是最合适的解决方案。你也可以使用 MKSTool Kit，但这个工具包不是免费的。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-25T10:12:09.553

您是否尝试过在自己的计算机上使用 putty 并使用她给您的 IP 地址？根据网络的设置方式，您可能能够以这种方式使用它。Cygwin 很好，但如果你需要做 Linux 特定的东西，看看[Wubi](http://wubi-installer.org/)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-08T18:38:24.293

您可以在家用计算机上安装 Cygwin。它是许多 Unix 工具到 windows 的端口，因此您可以在 windows 计算机上以 unix 风格工作。

或者，您可以像在学校一样使用 Putty 从家里连接到学校计算机（前提是可以从外部访问计算机）。然后，您将可以在家中访问相同的环境，包括您处理的文件。

# functional-programming - 如何编写一个不改变状态的应用程序（用函数式语言）？

> ID：477374
> 
> 赞同：6
> 
> 时间：2009-01-25T08:23:12.033
> 
> 标签：functional-programming, immutability

我想有一天学习函数式编程，但我不明白除了简单的数学之外，我怎么能用它来做任何事情。

例如：一个简单的网络浏览器添加书签功能需要引起某种突变，以便下次用户单击书签时，新书签会出现在列表中。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-25T11:27:42.223

您的示例不需要可变状态。对于“添加书签”，可以创建与旧列表具有相同内容但具有一个新条目的新书签列表。这是大多数不可变编程的工作方式；您只需创建一个反映世界新状态的新对象图，而不是对现有对象图进行更改。当一切都是不可变的时，很容易在“旧”和“新”版本之间共享对象图的大部分。

在您的示例中更深一层，假设“浏览器”是具有以下信息的数据结构对象：当前网页、用户主页和书签列表。这可以在内存中表示为一棵看起来像这样的树：

```
browser = {
 curPage --> "http://current"
 homePage --> "http://home"
 favorites --> { data --> "http://firstFav"
                 next --> { data --> "http://secondFav"
                            next --> null } }
} 
```

现在“AddFavorite”函数将这样的数据结构作为输入并返回一个像这样的新数据结构

```
browser = *{
 curPage --> "http://current"
 homePage --> "http://home"
 favorites --> *{ data --> *"http://newFav"*
                 next --> { data --> "http://firstFav"
                            next --> { data --> "http://secondFav"
                                       next --> null } } }*
}* 
```

标有“*”的位是新对象——收藏夹前面有一个新的链表节点，包含一个新字符串，并且浏览器结构本身是新的（它必须是因为它有一个新的“收藏夹”指针） .

您可以像这样将所有“有状态”计算建模为将“前一个世界”作为输入并返回“下一个世界”作为输出的函数；这是像 Haskell 这样的语言中状态单子的本质。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-25T09:37:16.673

一个有用的应用程序作为一个整体通常需要改变几件事情的状态，但这并不意味着所有或你的函数都需要改变状态才能有用。

[函数式编程中的Monad](http://en.wikipedia.org/wiki/Monad_(functional_programming))用于表达输入/输出 (I/O) 操作和状态变化，而不使用引入副作用的语言特性。

我认为您只考虑面向对象。仅仅因为一个函数在给定相同输入的情况下总是给出相同的输出，并不意味着它不能接受不同类型的输入（可能是无限可能的输入）并产生不同类型的输出。

使用函数式编程，您正在处理不可变对象而不是可变对象。如果你得到一个对象的输入，你可以创建一个新的修改过的对象并返回它。

查看[Joel 关于软件的 MapReduce 的这篇文章](http://www.joelonsoftware.com/items/2006/08/01.html)。它包含一个很好的例子，说明为什么不改变状态的函数可以完全有用。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-25T08:24:29.020

即使在像 Haskell 这样的纯函数式语言中，您*也*必须操纵状态。这是通过单子完成的。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-27T02:53:58.803

Many other answers will have you rushing off to use monads or some other exotic techniques to program using mutable state. While I have heard with my own ears the editor of the Haskell 98 Report call Haskell "the world's finest imperative language", you don't need nearly as much mutable state as other answers are suggesting. In a functional program, **you keep your state in function parameters**.

For example, I've just finished writing a Haskell program that decides how to back up my music to DVDs such that songs from the same album go on the same DVD, and every DVD (except the last) is at least 99.9% full. The list of DVDs and the list of which album goes on which DVD are continually changing, but no references, monads, or other exotic features are involved. These values are simply parameters to a recursive function.

To see some more examples and explanations, read John Hughes's very nice tutorial paper [Why Functional Programming Matters](http://www.cs.chalmers.se/~rjmh/Papers/whyfp.html).

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-01-25T09:47:11.320

如何处理“可变性”的好例子。假设你用函数式语言实现了一些数据结构，比如 AVL 树。在您实现的函数（插入、删除等）以及内部函数（旋转等）中，您实际上并没有改变数据，而是**返回**改变的数据。

底层运行时系统确保您的程序将有效地使用内存（例如，它执行写时复制和垃圾收集）。

当您**真正**改变世界状态（I/O、GUI）时，在程序的某些部分中，有两种方法。

*   纯函数式语言，如 Haskell，将此类操作封装在 monad 中（警告：阅读它们时你的头脑可能会爆炸，但不要太担心）
*   其他函数式语言，如 OCaml，允许程序中的可变性和副作用。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-27T03:05:18.937

Also, in practice, many apps written in functional programming languages do in fact make use of side-effect functions like (set! ) to actually change state. It isn't theoretically pure but it certainly gets the job done.

(In particular I'm thinking of a popular piece of consumer software that was written in a LISP derivative but had to run in constant memory, so things like garbage collection had to go out the window.)

# .net - ASP.NET MVC：访问日志

> ID：477381
> 
> 赞同：4
> 
> 时间：2009-01-25T08:25:37.707
> 
> 标签：.net, asp.net-mvc, logging

在 ASP.NET MVC 网站上，实现访问日志的最佳方式是什么？我想回答以下问题：

1.  什么是最受欢迎的页面？
2.  在过去 24 小时内访问了哪些页面？
3.  等等

我*可以*使用远程桌面登录服务器并自己浏览 IIS 日志（甚至使用 Microsoft Logfile Parser），但我希望能够从我的站点的管理页面运行报告。

最好的方法是什么？我是不是该：

1.  向我的所有控制器方法添加跟踪？
2.  添加一个 IHttpFilter （或其他）并让它进行日志记录？
3.  配置 IIS（Windows 2008 上的 IIS7）登录到我的数据库中的一个表，然后为这个表定义一个 NHibernate 映射？
4.  还有什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-25T11:08:19.453

这是另一种方法：[http ://code-inside.de/blog-in/2008/04/17/aspnet-mvc-using-a-actionfilter-for-logging/](http://code-inside.de/blog-in/2008/04/17/aspnet-mvc-using-a-actionfilter-for-logging/)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-26T15:09:25.933

塞巴斯蒂安的回答当然不错（赞成），但是，它正在重新实现 IIS 中已有的功能。IIS 的日志记录可能也比自产的东西更好。（例如，它将记录不通过 MVC 堆栈的内容。）因此，我倾向于使用选项 3 中的内容。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-26T16:31:01.370

为什么不直接使用 [Google Analytics]？( [http://www.google.com/analytics/](http://www.google.com/analytics/) ) 在我看来，这是一种获取这些统计数据的简单得多的方法。此外，您还将获得丰富的奖金信息。更不用说您可以在世界任何地方访问它。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-07T12:44:49.517

我反对严格记录服务器端。您需要执行一些客户端代码来计算缓存重新加载等。这就是为什么所有现代网络分析（如谷歌分析等）也有一个客户端......代码。

如果您没有在输出缓存模块之前插入 HttpModule 等，那么在进行日志记录时输出缓存也可能会很痛苦。

# c# - 找不到 Dumpbin.exe

> ID：477387
> 
> 赞同：113
> 
> 时间：2009-01-25T08:32:49.580
> 
> 标签：c#, c++, .net, visual-studio, visual-studio-2005

我没有在我的系统上看到 dumpbin.exe。我的系统上有 Visual Studio 2005。当我在命令行上键入 dumpbin 时，它会显示无法识别的命令。

它是默认带有 Visual Studio 的，还是我必须明确添加这个工具？

* * *

## 回答 #1

> 赞同：73
> 
> 时间：2009-01-25T08:35:17.423

您可能需要在正确设置 PATH 的情况下打开命令提示符。在开始菜单中查找类似“Visual C++ 2005 命令提示符”的图标。您应该能够从那里运行 dumpbin（以及所有其他命令行工具）。

* * *

## 回答 #2

> 赞同：56
> 
> 时间：2016-07-27T14:57:57.697

对 Visual Studio 2015 进行一点更新。

**DUMPBIN**包含在**Common Tools for Visual C++**中，因此请务必在安装 Visual Studio 的过程中选择此功能。该实用程序位于：

> C:\Program Files (x86)\Microsoft Visual Studio 14.0\VC\bin\

它在**VS 2015 的开发人员命令提示符中**可用，可以从开始菜单执行：

> Visual Studio 2015\Visual Studio 工具\VS2015 的开发人员命令提示符

如果要使其在常规命令提示符下可用，[请将实用程序的位置添加到计算机上的 PATH 环境变量](https://superuser.com/questions/284342/what-are-path-and-other-environment-variables-and-how-can-i-set-or-use-them)中。

[![在此处输入图像描述](https://i.stack.imgur.com/DkZLR.png)](https://i.stack.imgur.com/DkZLR.png)

* * *

## 回答 #3

> 赞同：46
> 
> 时间：2018-06-05T23:17:26.060

Visual Studio 社区 2017 -在`dumpbin.exe`我从.`C++ profiling tools``Modify``Visual Studio Installer`

[![在此处输入图像描述](https://i.stack.imgur.com/BnadT.png)](https://i.stack.imgur.com/BnadT.png)

* * *

## 回答 #4

> 赞同：19
> 
> 时间：2009-01-25T08:35:58.047

默认情况下，它不在您的 PATH 中。您需要使用“Visual Studio 2005 命令提示符”。或者，您可以运行 vsvars32 批处理文件，它将正确设置您的环境。

方便的是，此路径存储在 VS80COMNTOOLS 环境变量中。

* * *

## 回答 #5

> 赞同：14
> 
> 时间：2013-12-02T12:00:34.667

`Dumpbin.exe`的`VS2005`一般出现在`C:\Program Files\Microsoft Visual Studio 8\VC\bin`. 如果您将安装`VS2005`在其他驱动器中`C`，请在其中搜索。然后在系统变量中设置该路径`PATH`。

* * *

## 回答 #6

> 赞同：11
> 
> 时间：2018-06-09T16:29:25.763

至于`VS2017`，我在下面找到的`C:\Program Files (x86)\Microsoft Visual Studio\2017\Community\VC\Tools\MSVC\14.14.26428\bin\Hostx64\x64`

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2014-04-01T13:40:28.697

除了使用 dumpin.exe 之外，还可以使用以下几个选项调用**link.exe ：**

例子：`link /dump /all myfile.lib`

有关详细选项，请参阅输出`link /dump`

如果是 Visual Studio C++ Express 安装，link.exe 位于此处：

```
{root}\Program Files (x86)\Microsoft Visual Studio 10.0\VC\bin\ 
```

最好的方法是打开“Visual Studio 命令提示符”，然后输入上面的行。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2019-07-03T16:05:27.123

**在 Visual Studio Professional 2017 版本 15.9.13 中：**

*   首先，要么：

    *   从开始菜单启动“Visual Studio 安装程序”，选择您的 Visual Studio 产品，然后单击“修改”，

    或者

    *   从 Visual Studio 中转到“工具”->“获取工具和功能...”
*   然后，等待它“准备好……”并“快到了……”

*   切换到“单个组件”选项卡

*   向下滚动到“编译器、构建工具和运行时”部分

*   勾选“VC++ 2017 版本 15.9 v14.16 最新v141工具”

像这样：

[![在此处输入图像描述](https://i.stack.imgur.com/TrjuN.jpg)](https://i.stack.imgur.com/TrjuN.jpg)

完成此操作后，您将不仅拥有一个，而且**拥有多达四个**DUMPBIN 实例：

```
C:\Program Files (x86)\Microsoft Visual Studio\2017\Professional\VC\Tools\MSVC\14.16.27023\bin\Hostx64\x64\dumpbin.exe
C:\Program Files (x86)\Microsoft Visual Studio\2017\Professional\VC\Tools\MSVC\14.16.27023\bin\Hostx64\x86\dumpbin.exe
C:\Program Files (x86)\Microsoft Visual Studio\2017\Professional\VC\Tools\MSVC\14.16.27023\bin\Hostx86\x64\dumpbin.exe
C:\Program Files (x86)\Microsoft Visual Studio\2017\Professional\VC\Tools\MSVC\14.16.27023\bin\Hostx86\x86\dumpbin.exe 
```

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2014-03-24T08:15:32.290

您可以使用 Visual Studio 命令提示符。那时可以使用垃圾箱。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2021-06-01T06:19:55.940

使用 VC++ 2019安装[Visual Studio 2019 Community pack](https://visualstudio.microsoft.com/downloads/)后，选择：

[![在此处输入图像描述](https://i.stack.imgur.com/XeV1L.png)](https://i.stack.imgur.com/XeV1L.png)

我在这里找到了 dumpbin.exe：

```
C:\Program Files (x86)\Microsoft Visual Studio\2019\Community\VC\Tools\MSVC\14.20.27508\bin\HostX64\x64\dumpbin.exe 
```

通过创建 Powershell 脚本 dumpbin.ps1，

```
&"C:\Program Files (x86)\Microsoft Visual Studio\2019\Community\VC\Tools\MSVC\14.20.27508\bin\HostX64\x64\dumpbin.exe" $args 
```

我们可以运行：

```
dumpbin.ps1 /exports C:\Windows\System32\kernel32.dll 
```

我们得到这个：

[![在此处输入图像描述](https://i.stack.imgur.com/6VF9Q.png)](https://i.stack.imgur.com/6VF9Q.png)

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2021-03-15T17:20:19.707

一些人推荐了诸如在 Visual Studio 命令提示符下运行并将包含 dumpbin.exe 的目录添加到路径等选项。虽然我想每次你想执行 dumpbin.exe 时都可以调用 C:\Program Files (x86)\Microsoft Visual Studio\2019\Community\Common7\Tools\LaunchDevCmd.bat，但将其位置添加到路径中是一个练习无用，因为它几乎随着 Visual Studio 的每次更新而移动。据推测，这允许人们“并排”运行多个版本的 Visual Studio，这*可能*是一个或两个用例。

与此同时，我们其他人必须适应它的游牧方式。

# php - PHP模板与str_replace？

> ID：477398
> 
> 赞同：11
> 
> 时间：2009-01-25T08:43:16.907
> 
> 标签：php, templates

我认为 PHP 模板系统的基本原理是字符串替换，对吧？那么我可以只使用一个字符串来保存我的 html 模板代码吗？

```
$str_template = "<html><head><title>{the_title}</title><body>{the_content}</body></html>" 
```

在下面的代码中，只需执行 str_replace 即可将数据推送到我的模板变量中，例如

```
str_replace( $str_template, '{the_title}', $some_runtime_generated_title );
str_replace( $str_template, '{the_content}', $some_runtime_generated_content ); 
```

然后最后

```
echo $str_template; 
```

这是否有望使整个变量传递过程更快一些？我知道这可能是一个奇怪的问题，但有人试过吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-25T09:23:24.953

是的，这就是模板系统背后的基本思想。您可以进一步抽象它，例如让其他方法添加括号。

您还可以将数组与 str_replace 一起使用，从而使用这样的一个函数调用进行更多替换

```
str_replace(array('{the_title}', '{the_content}'), array($title, $content), $str_template); 
```

我使用的系统是[Spoon Library](http://docs.spoon-library.be/)，他们的模板系统非常坚固，包括编译的模板，这是一个巨大的性能提升。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-25T09:00:54.033

这通常是模板系统的基本思想。真正的模板系统具有更多功能，但核心是它们所做的。

你问这是否会“使整个变量传递过程更快一点”。比什么快？您现在正在做的事情是否遇到性能问题？

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-25T10:13:46.350

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-25T09:20:42.637

使用模板引擎是个好主意。

但是当 html 较大时，您的想法会变慢，如果您需要更多变量，您的想法会变慢。请记住，每个请求都会执行替换。

您可以将包含 php 标签的 html 文件用于输出（如`<?=$var?>`）和循环。通过“包含”将它们包含到您的 php 代码中。那要快得多。

看看[聪明](http://smarty.net)的。这是我最喜欢的 php 模板引擎。smarty 有很多很好的特性，比如缓存，并且可以通过插件扩展。

如果您懂德语，请看[这里](http://www.quantendrehung.de/cms/artikel/dreamteam/)。smarty 有一个小小的介绍。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-25T09:01:54.983

当然，您需要以正确的顺序排列参数。[`str_replace()`](http://php.net/str_replace)

将模板放在自己的文件中而不是将它们保存在字符串中也可能是一个好主意。然后只需通过[`file_get_contents()`](http://php.net/file_get_contents)或类似方式阅读它们。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-25T14:23:07.570

If you do only variable expansion, you can do:

```
$str_template = "<html><head><title>$the_title</title><body>$the_content</body></html>"; 
```

It will work as well...
Several people wonder why there are template system when PHP is already a template system...

Of course, there are other advantages to these systems, like more secure access to variables, perhaps easier to handle by designers (or to generate by tools), limitation of logic in the view layer... Which is a common criticism of heavy template systems like Smarty, with so much logic that you can almost write another template system with it! ;-)

Some template systems, like [Savant](http://phpsavant.com/ "Savant"), takes a middle road. :-)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2011-02-22T23:28:49.207

You simply can't make a template this way.
A real life template will require not only plain variables to fill but also several control structures, or at least some sort of blocks to control certain areas of the page (to make a loops for example).
So, you can't make a template with str_replace only. Some regexps and sophisticated parsing will be required too.

Thus, it's better to stick with a template engine which already at your disposal - a PHP itself!

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2011-02-22T23:04:05.983

basically the idea is that one, but template are something that offers lot more, for example RainTPL is WYSIWYG, because it replace relative paths into the template with the server paths, in this way you design your template in local and it works on the server without needs to change img/css.

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2012-09-13T00:37:36.230

Actually the answer from "Your Common Sense" is the right one. You could use PHP to use the current context and replace variables. Instead of writing the output, you could do ob_start() to hold it in a buffer and get the replaced content. Easy and elegant!

# java - Java 是否支持 RAII/确定性破坏？

> ID：477399
> 
> 赞同：46
> 
> 时间：2009-01-25T08:44:26.717
> 
> 标签：java, raii

自从我使用 Java 以来已经至少 5 年了，那时，任何时候你想分配一个需要清理的对象（例如套接字、DB 句柄），你必须记住添加一个`finally`块并调用 cleanup 方法那里。

相比之下，在 C++（或其他对象生命周期是确定性的语言，例如 Perl）中，类实现者将定义一个析构函数，该函数在该类的对象超出范围时执行清理。这种方法的优点是对象的用户不会忘记清理它——析构函数会自动调用，即使抛出异常也是如此。这种方法采用了相当糟糕的 RAII 名称——“资源获取即初始化”。

根据我的经验，“以 RAII 方式”做事为我节省了很多精神开销，因为我不必担心是否以及何时发生资源释放。我们正在考虑将 Java 用于一个中型项目，我想知道自从我上次查看 Java 以来添加到该语言的许多新特性中是否存在某种确定性破坏。（我希望我的抱怨“Java 没有 RAII”[在这个线程上](https://stackoverflow.com/questions/457884/what-are-the-things-java-got-wrong#475089)受到指责，但到目前为止，我无法通过谷歌搜索找到任何细节。）

因此，如果有人可以向我指出一些关于如何在 Java 中进行此操作的介绍性材料，那就太好了！

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2009-01-25T08:54:05.933

编辑：下面的答案是在 2009 年初编写的，当时 Java 7 仍在不断变化。

尽管 Java 仍然不提供有关最终确定时间的保证，但它*确实*获得了类似于 C#`using`语句的特性：[try-with-resources 语句](http://download.oracle.com/javase/7/docs/technotes/guides/language/try-with-resources.html)。

* * *

不，Java 在这方面根本没有改变。你仍然需要使用 try/finally。

已经讨论过在 Java 中添加相当于 C# 的“using”语句（这是 try/finally 上的语法糖），但我认为这将不再是 Java 7 的一部分。（大部分语言改进似乎已被放弃。）

值得理解的是，在 Java 和 .NET 中没有以引用计数垃圾收集器的形式实现确定性销毁是有原因的，顺便说一下 - a) 影响性能，b) 循环引用失败。Brian Harry 写了[一封详细的电子邮件](http://blogs.msdn.com/brada/articles/371015.aspx)——它是关于 .NET 的，它相当古老，但值得仔细阅读。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-02-14T13:18:26.703

有一个模式可以帮助这里。它不如基于析构函数的 RAII 好，但它确实意味着可以将资源清理移动到库中（所以你不能忘记调用它）。

它称为[Execute Around，之前已在此处讨论过](https://stackoverflow.com/questions/341971/what-is-the-execute-around-idiom)。

有趣的是，我看到 Jon Skeet 在那个线程上插话，但他没有在这里提到 - 真遗憾，乔恩 - 错过了在那里获得一些代表点的机会！

顺便说一句，虽然我很高兴布赖恩·哈里（再次参见乔恩的评论）竭尽全力地写了他所做的电子邮件——它显然确实反映了这个过程中的很多想法——我很高兴我们做到了在 C# 中“使用”它——我不同意他的所有结论。特别是，我不明白为什么，如果我们可以使用，我们就无法在没有“使用”的情况下将类型标记为行为方式。当然，它限制了使用——但“使用”也是如此——而且大多数时候它正是你想要的。“使用”的麻烦在于客户端代码仍然必须记住使用它。对于 C++ 风格的 RAII，它是类型的属性。“使用”，或者更准确地说是 Dispose 习语，一个可以说是更大的问题是它

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-25T09:17:57.320

没有。没有用于在堆栈上分配对象的工具。每个对象都在堆上分配，并且可以比它初始化的任何块都活得更久。或者它可能在块中间被收集，这取决于所有强大的垃圾收集器的变幻莫测。

如果您在服务器上工作，您可能需要查看[Java EE](http://www.oracle.com/technetwork/java/javaee/overview/index.html)。它与 RAII 无关，但它确实有一个不错的系统来管理数据库连接等昂贵对象的生命周期。对于很多问题空间，Java EE 5 实际上非常适合使用。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-01-25T10:30:09.703

我采用的方法是使用分层产品（有时是一种简单的静态方法）来处理资源分配。您不希望这种资源分配在您的程序中乱扔垃圾。

有很多图书馆可以做到这一点。在大多数情况下，这不是您应该担心的事情。

# c++ - ifstream，行尾并移至下一行？

> ID：477408
> 
> 赞同：9
> 
> 时间：2009-01-25T08:56:57.347
> 
> 标签：c++, std, ifstream

如何使用 std::ifstream 检测并移至下一行？

```
void readData(ifstream& in)
{
    string sz;
    getline(in, sz);
    cout << sz <<endl;
    int v;
    for(int i=0; in.good(); i++)
    {
        in >> v;
        if (in.good())
            cout << v << " ";
    }
    in.seekg(0, ios::beg);
    sz.clear();
    getline(in, sz);
    cout << sz <<endl; //no longer reads
} 
```

我知道如果发生错误，好的会告诉我，但是一旦发生错误，流就不再起作用了。在阅读另一个 int 之前，我如何检查我是否在行尾？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-01-25T15:33:09.863

使用 ignore() 忽略所有内容，直到下一行：

```
 in.ignore(std::numeric_limits<std::streamsize>::max(), '\n') 
```

如果您必须手动执行，只需检查其他字符以查看是否为 '\n'

```
char next;
while(in.get(next))
{
    if (next == '\n')  // If the file has been opened in
    {    break;        // text mode then it will correctly decode the
    }                  // platform specific EOL marker into '\n'
}
// This is reached on a newline or EOF 
```

这可能会失败，因为您在清除坏位之前进行了搜索。

```
in.seekg(0, ios::beg);    // If bad bits. Is this not ignored ?
                          // So this is not moving the file position.
sz.clear();
getline(in, sz);
cout << sz <<endl; //no longer reads 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-25T09:06:48.483

您应该在循环之后清除流的错误状态`in.clear();`，然后流将再次工作，就像没有发生错误一样。

您还可以将循环简化为：

```
while (in >> v) {
  cout << v << " ";
}
in.clear(); 
```

如果操作成功，则流提取返回，因此您可以直接测试它而无需显式检查`in.good();`.

# .net - .NET 中的二进制数据？(C++/CLI)

> ID：477416
> 
> 赞同：4
> 
> 时间：2009-01-25T09:07:25.080
> 
> 标签：.net, managed-c++

在 .NET 中存储二进制数据的首选方式是什么？

我试过这个：

```
byte data __gc [] = __gc new byte [100]; 
```

并得到这个错误：

```
error C2726: '__gc new' may only be used to create an object with managed type 
```

有没有办法管理字节数组？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-25T10:50:00.583

您使用的是托管 C++ 还是 C++/CLI？（我可以看到 Jon Skeet 编辑了问题以将 C++/CLI 添加到标题中，但在我看来，您实际上是在使用托管 C++）。

但不管怎么说：

在托管 C++ 中，你会这样做：

```
Byte data __gc [] = new Byte __gc [100]; 
```

在 C++/CLI 中，它看起来像这样：

```
cli::array<unsigned char>^ data = gcnew cli::array<unsigned char>(100); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-25T09:15:19.730

CodeProject：[C++/CLI 中的数组](http://www.codeproject.com/KB/mcpp/cppcliarrays.aspx)

据我所知，'__gc new' 语法已被弃用，请尝试以下操作：

```
cli::array<byte>^ data = gcnew cli::array<byte>(100); 
```

我注意到您在使用 cli 命名空间时遇到问题。[在 MSDN 上](http://msdn.microsoft.com/en-us/library/d87eee3k(VS.80).aspx)阅读此命名空间以解决您的问题。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-25T10:44:15.087

我不知道这样做的首选方式。但是，如果您只想编译它，以下是我机器上的 C++/CLI CLRConsole 项目中的工作代码。

```
#include "stdafx.h"

using namespace System;

int main(array<System::String ^> ^args)
{
    cli::array<System::Byte^>^ a = 
        gcnew cli::array<System::Byte^>(101);

    a[1] = (unsigned char)124;

    cli::array<unsigned char>^ b = 
        gcnew cli::array<unsigned char>(102);

    b[1] = (unsigned char)211;

    Console::WriteLine(a->Length);
    Console::WriteLine(b->Length);

    Console::WriteLine(a[1] + " : " + b[1]);
    return 0;
} 
```

**输出：**

```
101
102
124 : 211 
```

`a`是托管字节的托管数组。并且`b`是无符号字符的托管数组。C++ 似乎没有`byte`内置数据类型。

# c++ - c ++ ifstream，检测是字母还是EOLine？

> ID：477427
> 
> 赞同：0
> 
> 时间：2009-01-25T09:30:37.357
> 
> 标签：c++, ifstream, eol

我有这个函数可以从文件中读取所有整数。问题是当我阅读字母时，我触发了一个新行，我总是按 1 而不是到行尾搜索。我怎样才能更好地编写这个函数？

```
int v;
    while (!in.eof())
    {
        while (in >> v)
            cout << v << " ";

        cout << endl;
        if (in.eof())
            break;
        in.clear();
        in.seekg(1, ios::cur);
        int a;
        a=0;
    } 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-25T09:44:00.920

如果您的文件仅包含由空格（包括）换行符分隔的整数，那么这应该足够了。

```
while( in >> v )
{
    // do something with v
} 
```

在文件之后，如果 in.fail() 为 false 并且 in.eof() 为 true，那么您到达文件末尾且没有格式错误。否则会发生读取 int 的错误。

如果您收到无效输入并希望从中恢复，那么您需要确定您希望如何恢复。如果你想跳到行尾重新开始解析，你可以使用类似这样的东西。

```
in.clear();
in.ignore( std::numeric_limits<std::streamsize>::max(), '\n' ); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-25T15:49:05.073

第一个问题，上面的代码不会停在行尾。
运算符>>() 忽略包含换行符的“**空白字符”。**

这个怎么写更好？
如果不知道您要对数字做什么以及文件的输入格式是什么，这很难说清楚！

但是如果我写这个，我会在不使用这些行的情况下写它：

```
 if (in.eof())
            break;
    in.clear();
    in.seekg(1, ios::cur); 
```

在处理格式化的文本文件时，很少看到使用 seek()。

假设：
文件只包含数字。
您想将所有数字读入一个容器。

```
std::vector<int>    data;

std::copy(  std::istream_iterator<int>(in),  // An iterator from current point
            std::istream_iterator<int>(),    // To end of file.
            std::inserter(data)              // Destination (insert into data)
         ); 
```

# ruby-on-rails - 在 Rails 中处理发送大量电子邮件的最佳方法是什么？

> ID：477428
> 
> 赞同：3
> 
> 时间：2009-01-25T09:31:36.827
> 
> 标签：ruby-on-rails, performance, email

我知道将电子邮件保存到数据库中，然后让一些定期工作处理实际发送。我知道 ar_mailer gem 可以做到这一点。

还有其他方法吗？有更好的选择吗？简而言之，在 Rails 中处理发送大量电子邮件的最佳方式是什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-25T10:10:11.443

ar_mailer 是我所知道的发送多封电子邮件的最佳方式。设置起来非常直观。我会查看[官方文档](http://seattlerb.rubyforge.org/ar_mailer/)和这篇[非常好的博客文章](http://www.ameravant.com/posts/sending-tons-of-emails-in-ruby-on-rails-with-ar_mailer)。

达里

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-07-17T05:19:56.337

除了我只想添加的其他答案：

ar_mailer 可以用于发送“大量”电子邮件，但如果您要发送大量电子邮件（我在想像 Aweber 或 CampaignMonitor 之类的东西，每小时可能有数十万）我不确定如果 ar_mailer 是理想的。原因是它为每封电子邮件向数据库添加了单独的记录。想象一下，你是 Aweber，有一个客户向他的 10,000 人列表发送一封电子邮件。您只需创建 10,000 个活动记录对象并将所有 10,000 个记录对象保存到数据库中。这对于验证和回调等来说是昂贵的。现在假设您有 100 个客户，其中包含 10,000 人的列表，所有这些人都在那个小时发送电子邮件。我认为您的数据库会很痛苦，除非您可以消除验证/回调等并进入较低级别的数据库调用。

另一种选择是将所有队列传递给 Postfix 或类似的东西。如果 Postfix 不知何故在队列中间死了，你可能无法从你的 rails 应用程序内部确定这一点，所以它在那时有点解耦，但可能更有效。顺便说一句，我没有尝试过任何这些，只是大声思考。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-27T14:52:45.920

我们正在卸载冗长的任务，不仅是电子邮件发送，还有其他一些使用[Workling](http://github.com/purzelrakete/workling/tree/master)和[Starling](http://github.com/starling/starling/tree/master)的事情（请参阅[Railscast](http://railscasts.com/episodes/128-starling-and-workling)了解如何使用）。也有其他选择，Github[正在使用](http://github.com/blog/197-the-new-queue) [delay_job](http://github.com/tobi/delayed_job/tree/master)。

# .net - 将代码注入正在运行的 WPF 应用程序的最佳方法

> ID：477441
> 
> 赞同：12
> 
> 时间：2009-01-25T09:47:19.913
> 
> 标签：.net, wpf, code-injection

### 这是我的任务：

*   将自定义托管代码注入正在运行的托管 WPF 应用程序（即我的代码应该在其他 AppDomain 中运行）
*   注入的代码必须在 UI 线程上执行

### 当我说“最好”时，我的意思是：

*   注入过程必须尽可能稳定（无线程死锁等）
*   代码应该可以毫无问题地在 x86 和 x64 平台上运行（尤其是在 Vista x64 上）

### 最小用例

*   选择正在运行的 WPF 程序
*   注入自定义代码
*   注入代码将目标进程主窗口的标题更改为“注入代码”

### 我正在评估的解决方案：

### 1) 通过 windows hooks 注入（如在[Snoop](http://blois.us/Snoop/)中）

优点：

*   注入的代码在 UI 线程上运行

缺点：

*   需要混合 (c++/cli) 外部 dll
*   难以调试

### [2) 通过EasyHook](http://www.codeplex.com/easyhook)库注入

优点：

*   库看起来很稳固且经过良好测试

缺点：

*   没有找到在 UI 线程上运行代码的方法
*   注入库必须在 GAC 中签名并安装

### 3) 通过 WriteProcessMemory/CreateRemoteThreadEx/LoadLibrary 注入

优点：

*   简单的

缺点：

*   非常不稳定（代码必须在 DllMain 中执行，需要 CLR 托管等）

* * *

我将使用方法#1。你能推荐一个更好的方法吗？

是否有任何基于 CLR 托管在非托管 DLL 中的体面技术？

请注意，我知道这些问题：

*   [使用 C# 进行代码注入](https://stackoverflow.com/questions/24241/code-injection-with-c)
*   [我可以从 C# 在远程应用程序域中注入线程吗](https://stackoverflow.com/questions/185083/can-i-inject-a-thread-in-a-remote-app-domain-from-c)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2018-04-04T06:46:03.237

在我的旧项目中，我使用的是 CECIL（为单声道完成），它允许我在任何代码中注入性能跟踪代码。示例太大，无法在此处粘贴，但请查看[ReflectionStudio](https://github.com/TheCamel/ReflectionStudio)项目，尤其是[这个注入器类](https://github.com/TheCamel/ReflectionStudio/blob/master/ReflectionStudio.Core/Project/Profiling/InjectionProfiler.cs)- 。它在[mono/cecil 网站](http://www.mono-project.com/docs/tools+libraries/libraries/Mono.Cecil/)上始终可用- 唯一的事情是处理您对主 UI 线程的请求。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2018-04-03T17:01:38.097

由于用户在将近 9 年前提出的问题上悬赏，我将提供一个我用于类似项目的更新选项：

WPF 的 Prism 框架有很好的文档记录和可靠的。现在我不确定它是否与 Vista 兼容（9 年前的原始请求），我也不确定这是否重要。它在其统一引导程序类中包含一个非常类似于 MEF 的功能，以便您动态加载它们称为模块类库的内容（实际上只是 XAML 容器）。

因此，您构建了模块类库，并在 WPF shell 运行时扫描容器应用程序中的模块目录以查找任何模块程序集，并通过模块目录（Unity Bootstrapper 的方法）通过预定区域动态加载到主机容器中。（听起来真的像 MEF 对吧？）

现在，Brian Lagunas ( [http://brianlagunas.com](http://brianlagunas.com) ) 发布了一个示例，使这更进一步。他的模块目录实现持续扫描一个目录，以便在添加 dll 时（在 shell 运行时）它会拾取文件并处理它们，这实际上使您能够动态添加托管代码。将上传按钮添加到指向模块目录并利用 Prism 的事件聚合器的 WPF 外壳，您可以在加载新模块时翻转外壳的主标题。

这是 Brian 讨论在运行时加载模块的帖子的链接：http: [//brianlagunas.com/prism-dynamically-discover-and-load-modules-at-runtime/](http://brianlagunas.com/prism-dynamically-discover-and-load-modules-at-runtime/)

链接到 GitHub 示例： [https ://github.com/brianlagunas/DynamicallyDiscover-LoadModules/](https://github.com/brianlagunas/DynamicallyDiscover-LoadModules/)

如果您从未使用过 Prism，那么强烈建议您观看 Brian 的速成课程视频。大约需要 120 分钟，即使版本有点过时，也会让您快速使用 Prism。 [http://brianlagunas.com/infragistics-webinar-mvvm-made-simple-with-prism-sample-code/](http://brianlagunas.com/infragistics-webinar-mvvm-made-simple-with-prism-sample-code/)

# c# - “动态” XSLT 提供网络浏览器控件？

> ID：477446
> 
> 赞同：2
> 
> 时间：2009-01-25T09:54:07.920
> 
> 标签：c#, xml, xslt, webbrowser-control

我经常在应用程序中使用 HTML 输出，到目前为止，我已经使用了一些简单的例程来构建 HTML 字符串。我现在想尝试一些不同的东西：

我想将数据序列化为 XML，并提供一些 XSLT 模板来为 webbrowser 控件生成 HTML。我让它静态工作（通过编写 XSL 慢慢挖掘），但我需要动态更改 XSL 文档的一些属性：过滤器、路径等以遵循当前的 UI 选择。

数据足够小，更改时的 XML 序列化不应该成为问题。我想使用“静态”外部 XSL 文件（以便用户可以在一定程度上自定义输出），但要调整 .

我的问题：

这个想法在技术上合理吗？
我可以使用 XML 和 XSL 文档动态地提供 Web 浏览器控件吗？我可以动态修改 XSL 中选定的路径元素和属性（即不生成新文件）吗？如何在 Web 浏览器控件中执行此操作？（一些让我开始的指针会很好..）

[编辑]谢谢大家，它正在工作：D[/编辑]

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-25T19:16:52.517

通常要走的路是在运行时为转换提供参数并编写转换，以便其行为由参数控制。

通常当我这样做时，我只传入一个参数——一个 XML 文档——并让模板查询它以确定它们应该做什么。所以你会看到类似的东西：

```
<xsl:template match="*">
   <xsl:variable name="cfg" select="$config/*[name() = current()]"/>
   <xsl:choose>
      <xsl:when test="cfg/elementType = 'option'">
         <xsl:apply-templates select="." mode="option">
      <xsl:when test="cfg/elementType = 'optgroup'">
         <xsl:apply-templates select="." mode="optgroup">
      <xsl:when test="cfg/elementType = 'a'">
         <xsl:apply-templates select="." mode="a"> 
```

等等。

使用 XML/XSLT 动态地提供 WebBrowser 控件非常简单：

```
using (XmlWriter xw = XmlWriter.Create(new StringWriter(output)))
{
    StringBuilder output = new StringBuilder();
    XsltArgumentList args = new XsltArgumentList();
    args.AddParam("config", myConfigXml);
    myXslt.Transform(myXml, args, xw);
    xw.Flush();
    myWebBrowser.DocumentText = output.ToString();
} 
```

如果用户正在更新的 UI 在 WebBrowser 本身中（即 HTML 页面包含 HTML UI 控件），则您应该使用动态 HTML 技术，就像页面在普通浏览器中显示时一样。那是一袋完全不同的香蕉。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-25T12:20:12.210

[`XslCompiledTransform`](http://msdn.microsoft.com/en-us/library/system.xml.xsl.xslcompiledtransform.aspx)支持[参数](http://msdn.microsoft.com/en-us/library/system.xml.xsl.xsltargumentlist.addparam.aspx)，也支持[扩展对象](http://msdn.microsoft.com/en-us/library/system.xml.xsl.xsltargumentlist.addextensionobject.aspx)（都通过[`XsltArgumentList`。](http://msdn.microsoft.com/en-us/library/system.xml.xsl.xsltargumentlist.aspx)对于任何简单的事情，尝试使用参数；扩展对象允许更丰富的功能（取决于您的想象），但不能像其他 xslt 供应商那样可移植。第三个选项是外部选项文件，用 . 加载到变量中[`xsl:document`](http://www.w3schools.com/Xsl/func_document.asp)。

当然，如果您有勇气，您可以使用 xslt 动态地编写 xslt - 不过，这并不简单。

在大多数重要的情况下，最简单的方法是`WebBrowser`针对平面文件（在 %tmp% 区域中，或针对本地 Web 服务器（例如`HttpListener`）；直接更改 html 往往会使控件稍微混淆重新有效安全上下文。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-25T10:03:33.297

我不知道您的应用程序是什么样子，所以我不会说这是一个好主意还是坏主意。

关于你的其他问题：

您可以转换内存中的数据并将[其加载](http://donchevp.blogspot.com/2008/10/c-web-browser-control-load-string-in.html)到 Web 浏览器控件中。否则，您需要将数据保存到临时文件中。

您可以[在运行时使用 XSLT 参数进行选择](http://www.ibm.com/developerworks/xml/library/x-tipxsltrun/index.html)

# c++ - 编码实践：矩阵乘法中按值返回还是按引用返回？

> ID：477452
> 
> 赞同：3
> 
> 时间：2009-01-25T10:05:48.957
> 
> 标签：c++, reference, scope, return

我正在参考我昨天写的[这个问题来写这个问题。](https://stackoverflow.com/questions/475888/will-this-lead-to-a-memory-leak-in-c)在一些文档之后，我似乎很清楚，我想做的事情（以及我认为可能的事情）即使不是不可能也几乎是不可能的。有几种方法可以实现它，由于我不是经验丰富的程序员，所以我问你会采取哪种选择。我再次解释了我的问题，但现在我有一些解决方案要探索。

**我需要的**

我有一个 Matrix 类，我想实现矩阵之间的乘法，以便类的使用非常直观：

```
Matrix a(5,2);
a(4,1) = 6 ;
a(3,1) = 9.4 ;           
...                   // And so on ...

Matrix b(2,9);
b(0,2) = 3;
...                   // And so on ...

// After a while
Matrix i = a * b; 
```

**我昨天吃的**

目前我重载了两个运算符`operator*`，`operator=`直到昨天晚上，它们都是这样定义的：

```
Matrix& operator*(Matrix& m);
Matrix& operator=(Matrix& m); 
```

operator* 在堆上实例化一个新的 Matrix 对象 ( `Matrix return = new Matrix(...)`)，设置值，然后：

```
return *result; 
```

**我今天拥有的**

经过[讨论](https://stackoverflow.com/questions/475888/will-this-lead-to-a-memory-leak-in-c)，我决定以“不同的方式”实现它，以避免用户被任何类型的指针打扰并保持用法不变。“不同的方式”是按值传递 operator* 的返回值：

```
Matrix operator*(Matrix& m);
Matrix& operator=(Matrix& m); 
```

operator*`return`在堆栈上实例化，设置值，然后返回对象。

这种方法有一个问题：它不起作用。operator= 需要一个 Matrix& 并且 operator* 返回一个 Matrix。此外，由于另一个原因，这种方法对我来说看起来不太好：我正在处理可能非常大的矩阵，并且该库的目标是 1）对我的项目足够好 2）快速，所以可能通过按价值计算不应该是一种选择。

**我探索了哪些解决方案**

好吧，按照前面[讨论](https://stackoverflow.com/questions/475888/will-this-lead-to-a-memory-leak-in-c)中的建议，我阅读了一些关于智能指针的内容，它们看起来很棒，但我仍然无法弄清楚如何解决我的问题。它们处理内存释放和指针复制，但我基本上使用引用，所以它们看起来对我来说不是正确的选择。但我可能错了。

也许唯一的解决办法就是传值，也许我无法兼顾效率和良好的界面。但同样，你是专家，我想知道你的意见。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-01-25T10:18:49.163

您遇到的问题是表达式`a * b`创建了一个*临时*对象，而在 C++ 中，不允许将临时对象绑定到非常量引用，这就是您所`Matrix& operator=(Matrix& m)`需要的。如果您将其更改为：

```
Matrix& operator=(Matrix const& m); 
```

代码现在应该可以编译了。除了生成可编译代码的明显好处之外：)，添加`const`还可以向您的调用者传达您不会修改参数的`m`信息，这可能是有用的信息。

你也应该为你做同样的事情`operator*()`：

```
Matrix operator*(Matrix const& m) const; 
```

**[编辑：**最后的附加`const`表示该方法承诺不会改变乘法*左侧*`*this`的对象。这对于处理诸如-- 子表达式创建一个临时的表达式是必要的，并且不会在没有结尾的情况下绑定。感谢 Greg Rogers 在评论中指出这一点。**]***`a * b * c``a * b``const`*

 ***PS C++ 不允许将临时对象绑定到非常量引用的原因是因为临时对象（顾名思义）只存在很短的时间，而且在大多数情况下，尝试修改它们是错误的.

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-01-25T10:27:25.387

你真的应该阅读Scott Meyers 的[Effective C++](https://rads.stackoverflow.com/amzn/click/com/0321334876)，它有很好的主题。如前所述，`operator=`和的最佳签名`operator*`是

```
Matrix& operator=(Matrix const& m);
Matrix operator*(Matrix const& m) const; 
```

但我不得不说你应该在

```
Matrix& operator*=(Matrix const& m); 
```

并重用它`operator*`

```
Matrix operator*(Matrix const &m) const {
    return Matrix(*this) *= m;
} 
```

这样，用户可以在需要时进行乘法运算而无需创建新矩阵。当然，要使此代码正常工作，您还应该具有复制构造函数:)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-25T10:58:31.783

*注意：从 Vadims 建议开始。如果我们只讨论非常小的矩阵，例如，如果您将自己限制为 3x3 或 4x4 矩阵，则以下讨论是没有实际意义的。另外，我希望我不是想把太多想法塞给你:)*

由于矩阵可能是一个沉重的对象，你绝对应该避免深拷贝。智能指针是实现这一点的一种*实用程序*，但它们并不能立即解决您的问题。

在您的场景中，有两种常见的方法。在这两种情况下，任何副本（如`a=b`）都只复制一个引用，并增加引用计数器（这就是智能指针可以为您做的事情）。

使用**Copy On Write**，深拷贝会延迟到进行修改为止。例如，调用类似`void Matrix.TransFormMe()`on的成员函数`b`会看到实际数据被两个对象（a 和 b）引用，并在进行转换之前创建深层副本。

最终效果是您的矩阵类就像一个“普通”对象，但实际制作的深度副本数量大大减少了。

另一种方法是**不可变对象**，其中 API 本身从不修改现有对象——任何修改都会创建一个新对象。因此，不是`void TransformMe()' member transforming the contained matrix, Matrix contains only a`Matrix GetTransformed()`成员，而是返回数据的副本。

哪种方法更好取决于实际数据。在 MFC 中，`CString`是写时复制，在 .NET 中，a`String`是不可变的。不可变类通常需要一个`StringBuilder`避免许多顺序修改的副本的构建器类（如 ）。Copy-On-Write 对象需要仔细设计，以便在 API 中清楚哪些成员修改内部成员，哪些返回副本。

对于矩阵，由于有许多算法可以就地修改矩阵（即算法本身不需要复制），因此写时复制可能是更好的解决方案。

我曾经尝试在 boost 智能指针之上构建一个写时复制指针，但我没有触及它来找出线程问题等。伪代码看起来像这样：

```
class CowPtr<T>
{
     refcounting_ptr<T> m_actualData;
   public:
     void MakeUnique()
     {
        if (m_actualData.refcount() > 1)
           m_actualData = m_actualData.DeepCopy();
     }
     // ...remaining smart pointer interface...
}

class MatrixData // not visible to user
{
  std::vector<...> myActualMatrixData;
}

class Matrix
{
  CowPtr<MatrixData> m_ptr; // the simple reference that will be copied on assignment

  double operator()(int row, int col)  const
  {  // a non-modifying member. 
     return m_ptr->GetElement(row, col);
  }

  void Transform()
  {
    m_ptr.MakeUnique(); // we are going to modify the data, so make sure 
                        // we don't modify other references to the same MatrixData
    m_ptr->Transform();
  }
} 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-01-25T11:00:16.210

> ......几乎都是 const 因为它们都调用（如有必要）：
> 
> ```
> void lupp(); 
> ```
> 
> 这会更新缓存的`L`,`U`和`P`. 同样代表`get_inverse()`那个呼叫`lupp()`，也代表`Matrix* Matrix::inverse`. 这会导致以下问题：
> 
> ```
> Matrix& operator=(Matrix const& m);
> Matrix operator*(Matrix const& m); 
> ```
> 
> 技术。

请解释这是如何导致问题的。通常不应该。此外，如果您使用成员变量来缓存临时结果，请将它们设为`mutable`. 然后你甚至可以在`const`对象中修改它们。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-25T10:51:18.303

是的，你的建议都很好，我承认我不知道非常量引用的临时对象问题。但是我的 Matrix 类还包含获得 LU 分解（高斯消除）的工具：

```
const Matrix& get_inverse();
const Matrix& get_l();
const Matrix& get_u();
const Matrix& get_p(); 
```

都是，`const`因为他们都打电话（如有必要）：

```
void lupp(); 
```

这会更新缓存的 L、U 和 P。同样代表`get_inverse()`调用 lupp() 并设置`Matrix* Matrix::inverse`. 这会导致以下问题：

```
Matrix& operator=(Matrix const& m);
Matrix operator*(Matrix const& m); 
```

技术。

# c++ - 构建DLL文件时，生成的LIB文件是否包含DLL名称？

> ID：477461
> 
> 赞同：13
> 
> 时间：2009-01-25T10:10:29.930
> 
> 标签：c++, winapi, linker

在 Visual C++ 中，当我构建 dll 时，输出文件是 .dll 和 .lib。

是 .lib 文件中内置的 dll 的名称。

我问这个问题的原因是：当我通过导入这个 dll 并运行 exe 来构建我的 exe 时，exe 会尝试定位 dll 以将其加载到进程地址空间中。

由于我们只是在项目属性中指定库名称（.lib 文件），exe 是如何知道 dll 的名称的。

注意：我转储了库文件 (.lib)，发现它不包含 dll 的名称。

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-01-25T10:13:26.787

LIB 文件在 EXE 中变成了一个导入表。这*确实*包含 DLL 的名称。

如果你运行，你可以看到这一点`dumpbin /all MyDLL.lib`。请注意，`dumpbin MyDll.lib`它本身并没有显示任何有用的信息：您应该使用`/all`.

这显示了 .LIB 文件中定义的所有部分。您可以忽略任何`.debug`部分，因为它们不会出现在发布版本中。在 .LIB 文件中，有一组 .idata 节。在我刚刚构建的 DLL 项目中，LIB 文件包含一个`.idata$4`定义要放入 EXE 导入表中的符号的部分，包括 DLL 名称：

```
83E 处的存档成员名称：MyDll.dll/      
497C3B9F 时间/日期 Sun Jan 25 10:14:55 2009
         uid
         吉德
       0 模式
      2E尺寸
正确的标题结束

  版本：0
  机器：14C (x86)
  时间日期戳：497C3B9F 2009 年 1 月 25 日星期日 10:14:55
  数据大小：0000001A
  DLL 名称：MyDll.dll
  符号名称：?fnMyDll@@YAHXZ (int __cdecl fnMyDll(void))
  类型：代码
  姓名类型：姓名
  提示：2
  名称 : ?fnMyDll@@YAHXZ
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-25T10:27:28.413

是的，lib 包含 DLL 的名称。

在功能上，导入库实现`LoadLibrary`和`GetProcAdress`调用，并使导出的函数可用，就好像它们是静态链接的一样。

搜索路径与为[LoadLibrary](http://msdn.microsoft.com/en-us/library/ms684175(VS.85).aspx)记录的相同，但名称是固定的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2015-09-29T01:07:41.170

正如 Roger 和 Peter 所指出的，是的 .lib 文件包含 .dll 文件的名称。感谢 Roger 指出 dumpbin 显示了 .dll 文件的名称，这帮助我解决了我的问题。这与 .lib 文件中的名称的来源有关。

*我期待名称取自 dll 项目的项目设置，但我们有一个 export.def，它指定了 dll 的名称。因此，当我更改项目设置而不是 export.def 时，我们在使用我们的 dll 时遇到了问题。*我们项目的解决方案是清除 export.def 文件。

# jquery - JQuery 在执行 document.ready 之前等待图像加载

> ID：477463
> 
> 赞同：48
> 
> 时间：2009-01-25T10:11:26.027
> 
> 标签：jquery, jquery-1.3

**更新：** 此错误已被至少另外两个确认。即使您没有阅读我的完整帖子 - 如果您正在阅读本文并使用 JQuery 1.3.1，那么如果您依赖于要在 DOM 完成时但在页面图像加载之前执行的任何处理程序，请**停止使用它**.

**更新**2 ：感谢[Tom](https://stackoverflow.com/users/20/tom)（用户 id 20！）在 jQuery 错误跟踪器上发布[票证链接。](http://dev.jquery.com/ticket/3988#preview)

**更新 3 - 2009/01/28：**问题已得到妥善解决（对于那些无法恢复到 1.2.6 的用户）。对于当前使用 1.3.1 并需要立即修复的任何人，您可以阅读下面接受的答案以获取指导。谢谢约翰。

* * *

我刚刚升级到 JQuery 1.3.1，我花了几个小时才意识到我心爱的

```
$(function( ) {  ... } 
```

语法现在在执行函数体之前等待整个页面加载（包括图像）。尝试集成雅虎菜单时，我看到了[奇怪的行为。](https://stackoverflow.com/questions/477348/)（幸运的是，我的页面上有一些加载缓慢的图像，这让我意识到了这个问题）！

我制作了一个测试文件，因为我认为发生了更复杂的事情，但即使使用这个简单的文件，我仍然有相同的症状。

```
<head>
   <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.1/jquery.min.js"></script>   
   <script>
    $(function() {    
      alert("Ready"); 
    });
  </script>
</head>

<body>      
  <img src="<PATH_TO_DYNAMIC_IMAGE>_1.jpg" />
  <img src="<PATH_TO_DYNAMIC_IMAGE>_2.jpg" />
  <img src="<PATH_TO_DYNAMIC_IMAGE>_3.jpg" />
  <img src="<PATH_TO_DYNAMIC_IMAGE>_4.jpg" />       
</body> 
```

不同版本的 JQuery 有不同的结果：

*   在 1.2.6 版中发生的情况是警报框立即显示，然后我看到它后面加载的图像（预期和记录的行为）。
*   在 1.3.1 版本中发生的是图像全部加载，然后才会显示警告框。

这是怎么回事！这是一个新功能（我无法想象为什么）还是一个错误？

**重要提示：这似乎只是 IE 中的问题，而不是 Firefox**

*抱歉，我没有可公开访问的动态图像文件，以便其他人更容易看到。如果你想测试一下，我建议使用从谷歌图像中随机挑选的大图像文件并清除缓存。*

* * *

## 回答 #1

> 赞同：57
> 
> 时间：2009-01-28T22:47:38.253

这是由于 jQuery 错误 # [2614](http://dev.jquery.com/ticket/2614)和 # [3880](http://dev.jquery.com/ticket/3880) - 在 1.2.6 和 1.3 中，IE 中的现成代码存在明显问题 - 现在在 1.3.1 中出现了一组不同的问题。

可以在这里找到更大的讨论：
[http://groups.google.com/group/jquery-dev/browse_thread/thread/3abf45d3fd4d50fc](http://groups.google.com/group/jquery-dev/browse_thread/thread/3abf45d3fd4d50fc)

与问题相关的票可以在这里找到（如果您发现修复的其他问题，请重新打开票并发布到上面的 jquery-dev 线程）：
[http://dev.jquery.com/ticket/3988](http://dev.jquery.com/ticket/3988)

我刚刚在 SVN rev [6170](http://dev.jquery.com/changeset/6170)中对此进行了修复。

我刚刚推出了一个新的 nightly，您可以在 1.3.2 最终版发布之前使用它：
[http://code.jquery.com/nightlies/jquery-2009-01-28.js](http://code.jquery.com/nightlies/jquery-2009-01-28.js)

很抱歉延迟修复 - 这周正在旅行。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-25T12:17:04.620

有些东西不能进行单元测试。刚刚在 IE6+7 和 1.3.1 中确认。天哪，多么巨大的倒退。

那么，你有时间报告这个吗？刚刚检查过，这不是 1.3.1 的已知错误。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-27T02:42:53.693

[这是我提交的票的更新](http://dev.jquery.com/ticket/3988#preview)。似乎[@Webdawson](https://stackoverflow.com/questions/477463/jquery-is-waiting-for-images-to-load-before-executing-document-ready#480721)已将示例页面附加到票证上。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-01-27T10:10:41.387

是的，我添加了一个示例，它显然是 IE6 和 7 中的一个错误（我没有在其他 IE 版本中对其进行测试）。好像1.3.1版本有很多bug。:(

这是示例链接：[http ://www.kollermedia.at/jquery_bug.html](http://www.kollermedia.at/jquery_bug.html)

# conditional-statements - 哪个是循环中的首选条件？

> ID：477468
> 
> 赞同：7
> 
> 时间：2009-01-25T10:14:27.240
> 
> 标签：conditional-statements, loops

```
int n = 5;
for(int i = 0;i!=n;i++)//condition !=
{
//executing 5times
}

int n = 5;
for(int i = 0;i<n;i++)//condition <
{
//executing 5times

} 
```

哪个是首选？

> 这是来自“Accelerated C++：通过示例进行实用编程/Andrew Koenig, Barbara E. Moo”中的示例。只是想知道为什么作者更喜欢第一个

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-01-25T10:22:25.333

第二。有两个原因

1.  小于（或有时 <=）是大多数编码人员编写这些的常用方式，如果可能的话，最好遵守约定 - ！= 可能会让大多数编码人员查看两次以检查循环中是否有奇怪的东西，而<将立即被理解。

2.  != 取决于确切的条件。如果在维护期间修改了循环的内部并且我不小心在循环内增加了，那么你最终会得到一个无限循环。一般来说，让你的终止条件尽可能宽总是更好的——它只是更健壮。

2当然是1的原因。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-25T10:18:54.047

我会说`<`因为它捕获了更广泛的条件。假设 n 不是常数，而是从一个在极少数情况下返回 -1 的函数返回的。在那种情况下，你会有一个更长的循环（直到 int 环绕到 -ve 值！）与循环的 != 版本。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-25T10:23:01.450

使用`condition <`要好得多，因为它减少了越过标记值并陷入无限循环的可能性。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-25T10:25:40.117

如问题中所述，两个循环是等效的。然而，在实际代码中，事情通常会更复杂一些，在这种情况下，“i < n”条件往往更安全一些。例如，如果 i 可能增加不止一，它可能会超过 n，然后 "i != n" 版本将导致一个永恒的循环。

这是一个防御性编程的例子。它并没有被普遍接受：有些人更喜欢确保事情尽可能地失败，以便及早发现错误。防守风格可能会隐藏这样的小问题。但是，如果您想捕获所有错误，则不妨一路走下去：

```
int n = 5;
int i = 0;
while (i != n) {
    int old_i = i;
    // the real stuff of the loop here
   ++i;
   assert(i == old_i + 1);
} 
```

（或者，更好的是，使用支持语法的语言来指定前置和后置条件以及原生循环不变量。）

如果您想思考这类问题，您可能会对Andrew Koenig 的“C Traps and Pitfalls”一书（参见[http://en.wikipedia.org/wiki/C_Traps_and_Pitfalls入门）感兴趣。](http://en.wikipedia.org/wiki/C_Traps_and_Pitfalls)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-25T10:16:41.197

`<n`是最常用的（我的看法）

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-25T10:23:15.037

我通常使用 < 来做第二种方式。但是考虑使用 != 因为 c++ 中的 stl 迭代器以这种方式工作。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-01-25T10:24:10.183

第二。它总是会在某个时候完成（假设你没有做任何有趣的事情，比如在循环中玩计数器的值）。

我从来没有见过第一次使用，至少，不是那样的。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-01-25T10:55:40.947

我更喜欢使用 < ，因为只需查看代码，您就可以知道它是一个递增的循环，它支持您使用 i++ 的事实。

如果您使用 i++ 和 < 并且由于某种原因（其他编码器、拼写错误、人为错误），您的代码会将增量更改为 i——您会立即知道循环没有被评估，就像 != 它会工作无论哪种方式都使调试变得不那么简单。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-01-25T10:16:45.457

我看不出这很重要，难道没有更重要的事情要担心吗？

我总是使用后者，这是我见过的最多的。

有人肯定会因为它而将我击落....

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-01-25T10:35:08.053

“i < n”更好。因为如果你使用 "i != n" 并且在某些情况下你的初始 i 大于 n，你将进入一个无限循环。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-01-25T10:38:09.953

如果您正在优化速度，我相信这是一个更好的选择：

```
int n = 5;
for(int i = n;i > 0;i--)
{
//executing 5times
} 
```

原因是与 0 比较更快。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-01-25T17:34:04.660

我说这取决于迭代器变量的类型。如果你知道它是一个整数，我会使用第二个，因为你可以说

> 循环，*只要 i 小于*n

我认为对于大多数程序员来说更容易阅读，包括我自己。如果你不知道迭代器变量的类型，你应该尽可能少地假设它的能力。`operator<`可能不可用：`i`如果它是随机访问迭代器以外的任何迭代器，`operator<`则不保证可用。在这种情况下，我会使用`operator!=`.

我会避免选择选项`<`，因为您可能会不小心“跨过”最终值。我认为这个论点是有缺陷的。因为如果您确实不小心踩到了，那么这是一个错误，应该尽快注意到（[Fail-fast](http://en.wikipedia.org/wiki/Fail_Fast)）。

# python - 如何使用小数范围（）步长值？

> ID：477486
> 
> 赞同：912
> 
> 时间：2009-01-25T10:20:43.140
> 
> 标签：python, floating-point, range

有没有办法在 0 和 1 之间步进 0.1？

我以为我可以这样做，但它失败了：

```
for i in range(0, 1, 0.1):
    print i 
```

相反，它说 step 参数不能为零，这是我没想到的。

* * *

## 回答 #1

> 赞同：1124
> 
> 时间：2009-01-25T12:26:08.160

与其直接使用小数步长，不如用你想要的点数来表达这一点要安全得多。否则，浮点舍入错误很可能会给你一个错误的结果。

您可以使用[NumPy库中的](http://en.wikipedia.org/wiki/NumPy)[linspace](https://docs.scipy.org/doc/numpy/reference/generated/numpy.linspace.html)函数（它不是标准库的一部分，但相对容易获得）。需要返回多个点，还可以让您指定是否包含正确的端点：`linspace`

```
>>> np.linspace(0,1,11)
array([ 0\. ,  0.1,  0.2,  0.3,  0.4,  0.5,  0.6,  0.7,  0.8,  0.9,  1\. ])
>>> np.linspace(0,1,10,endpoint=False)
array([ 0\. ,  0.1,  0.2,  0.3,  0.4,  0.5,  0.6,  0.7,  0.8,  0.9]) 
```

如果您真的想使用浮点步进值，您可以使用`numpy.arange`.

```
>>> import numpy as np
>>> np.arange(0.0, 1.0, 0.1)
array([ 0\. ,  0.1,  0.2,  0.3,  0.4,  0.5,  0.6,  0.7,  0.8,  0.9]) 
```

但是，浮点舍入误差*会*导致问题。这是一个简单的例子，`arange`当它应该只产生 3 个数字时，舍入错误会导致产生一个长度为 4 的数组：

```
>>> numpy.arange(1, 1.3, 0.1)
array([1\. , 1.1, 1.2, 1.3]) 
```

* * *

## 回答 #2

> 赞同：257
> 
> 时间：2009-01-25T10:35:25.590

Python 的 range() 只能做整数，不能做浮点数。在您的特定情况下，您可以改用列表推导：

```
[x * 0.1 for x in range(0, 10)] 
```

（用该表达式替换对 range 的调用。）

对于更一般的情况，您可能需要编写自定义函数或生成器。

* * *

## 回答 #3

> 赞同：157
> 
> 时间：2009-01-25T11:57:17.280

在['xrange([start], stop[, step])' 的](http://docs.python.org/library/functions.html#xrange)基础上，您可以定义一个生成器，该生成器接受并生成您选择的任何类型（坚持支持`+`和的类型`<`）：

```
>>> def drange(start, stop, step):
...     r = start
...     while r < stop:
...         yield r
...         r += step
...         
>>> i0=drange(0.0, 1.0, 0.1)
>>> ["%g" % x for x in i0]
['0', '0.1', '0.2', '0.3', '0.4', '0.5', '0.6', '0.7', '0.8', '0.9', '1']
>>> 
```

* * *

## 回答 #4

> 赞同：37
> 
> 时间：2009-01-25T10:32:01.180

增加`i`for 循环的大小，然后在需要时减小它。

```
for i * 100 in range(0, 100, 10):
    print i / 100.0 
```

**编辑：老实说，我不记得为什么我认为这在语法上会起作用**

```
for i in range(0, 11, 1):
    print i / 10.0 
```

那应该有所需的输出。

* * *

## 回答 #5

> 赞同：30
> 
> 时间：2017-02-28T02:06:20.463

我认为 NumPy 有点矫枉过正。

```
[p/10 for p in range(0, 10)]
[0.0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9] 
```

一般来说，做一个逐步`1/x`到`y`你会做

```
x=100
y=2
[p/x for p in range(0, int(x*y))]
[0.0, 0.01, 0.02, 0.03, ..., 1.97, 1.98, 1.99] 
```

（`1/x`我测试时产生的圆角噪音较小）。

* * *

## 回答 #6

> 赞同：24
> 
> 时间：2014-05-17T20:50:03.013

`scipy`有一个内置函数`arange`，它概括了 Python 的`range()`构造函数以满足您对浮点处理的要求。

`from scipy import arange`

* * *

## 回答 #7

> 赞同：21
> 
> 时间：2012-06-11T19:10:53.020

与[R 的](http://en.wikipedia.org/wiki/R_%28programming_language%29) `seq`函数类似，这个函数在给定正确的步长值的情况下以任意顺序返回一个序列。最后一个值等于停止值。

```
def seq(start, stop, step=1):
    n = int(round((stop - start)/float(step)))
    if n > 1:
        return([start + step*i for i in range(n+1)])
    elif n == 1:
        return([start])
    else:
        return([]) 
```

### 结果

```
seq(1, 5, 0.5) 
```

> [1.0, 1.5, 2.0, 2.5, 3.0, 3.5, 4.0, 4.5, 5.0]

```
seq(10, 0, -1) 
```

> [10、9、8、7、6、5、4、3、2、1、0]

```
seq(10, 0, -2) 
```

> [10、8、6、4、2、0]

```
seq(1, 1) 
```

> [ 1 ]

* * *

## 回答 #8

> 赞同：15
> 
> 时间：2009-01-25T10:32:43.973

range() 内置函数返回一个整数值序列，恐怕，所以你不能用它来做一个小数步。

我想说只使用一个while循环：

```
i = 0.0
while i <= 1.0:
    print i
    i += 0.1 
```

如果您好奇，Python 会将您的 0.1 转换为 0，这就是为什么它告诉您参数不能为零的原因。

* * *

## 回答 #9

> 赞同：14
> 
> 时间：2012-11-08T10:00:02.017

这是使用[itertools](http://docs.python.org/3/library/itertools.html)的解决方案：

```
import itertools

def seq(start, end, step):
    if step == 0:
        raise ValueError("step must not be 0")
    sample_count = int(abs(end - start) / step)
    return itertools.islice(itertools.count(start, step), sample_count) 
```

**使用示例：**

```
for i in seq(0, 1, 0.1):
    print(i) 
```

* * *

## 回答 #10

> 赞同：12
> 
> 时间：2012-05-13T23:20:58.553

```
[x * 0.1 for x in range(0, 10)] 
```

在 Python 2.7x 中为您提供以下结果：

> [0.0, 0.1, 0.2, 0.30000000000000004, 0.4, 0.5, 0.6000000000000001, 0.7000000000000001, 0.8, 0.9]

但如果你使用：

```
[ round(x * 0.1, 1) for x in range(0, 10)] 
```

给你想要的：

> [0.0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9]

* * *

## 回答 #11

> 赞同：10
> 
> 时间：2012-09-07T02:01:56.077

```
import numpy as np
for i in np.arange(0, 1, 0.1): 
    print i 
```

* * *

## 回答 #12

> 赞同：6
> 
> 时间：2009-01-25T10:48:33.130

如果您经常这样做，您可能希望保存生成的列表`r`

```
r=map(lambda x: x/10.0,range(0,10))
for i in r:
    print i 
```

* * *

## 回答 #13

> 赞同：6
> 
> 时间：2018-02-09T00:31:07.483

[`more_itertools`](https://github.com/erikrose/more-itertools)是一个实现工具的第三方库[`numeric_range`](https://more-itertools.readthedocs.io/en/latest/api.html#more_itertools.numeric_range)：

```
import more_itertools as mit

for x in mit.numeric_range(0, 1, 0.1):
    print("{:.1f}".format(x)) 
```

输出

```
0.0
0.1
0.2
0.3
0.4
0.5
0.6
0.7
0.8
0.9 
```

此工具也适用于[`Decimal`](https://docs.python.org/2/library/decimal.html)和[`Fraction`](https://docs.python.org/2/library/fractions.html)。

* * *

## 回答 #14

> 赞同：5
> 
> 时间：2016-12-10T19:03:43.813

最佳解决方案：**无舍入误差**

```
>>> step = .1
>>> N = 10     # number of data points
>>> [ x / pow(step, -1) for x in range(0, N + 1) ]

[0.0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 1.0] 
```

或者，对于设定范围而不是设定数据点（例如连续函数），请使用：

```
>>> step = .1
>>> rnge = 1     # NOTE range = 1, i.e. span of data points
>>> N = int(rnge / step
>>> [ x / pow(step,-1) for x in range(0, N + 1) ]

[0.0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 1.0] 
```

要实现一个功能：替换`x / pow(step, -1)`为`f( x / pow(step, -1) )`，并定义`f`。
例如：

```
>>> import math
>>> def f(x):
        return math.sin(x)

>>> step = .1
>>> rnge = 1     # NOTE range = 1, i.e. span of data points
>>> N = int(rnge / step)
>>> [ f( x / pow(step,-1) ) for x in range(0, N + 1) ]

[0.0, 0.09983341664682815, 0.19866933079506122, 0.29552020666133955, 0.3894183423086505, 
 0.479425538604203, 0.5646424733950354, 0.644217687237691, 0.7173560908995228,
 0.7833269096274834, 0.8414709848078965] 
```

* * *

## 回答 #15

> 赞同：4
> 
> 时间：2012-12-12T22:29:48.793

我的版本使用原始范围函数为移位创建乘法索引。这允许与原始范围函数相同的语法。我做了两个版本，一个使用浮点数，一个使用十进制，因为我发现在某些情况下我想避免浮点运算引入的舍入漂移。

它与 range/xrange 中的空集结果一致。

仅将单个数值传递给任一函数都会将标准范围输出返回到输入参数的整数上限（因此，如果您给它 5.5，它将返回 range(6)。）

**编辑：下面的代码现在可以作为 pypi 的包使用：[Franges](http://pypi.python.org/pypi/Franges)**

```
## frange.py
from math import ceil
# find best range function available to version (2.7.x / 3.x.x)
try:
    _xrange = xrange
except NameError:
    _xrange = range

def frange(start, stop = None, step = 1):
    """frange generates a set of floating point values over the 
    range [start, stop) with step size step

    frange([start,] stop [, step ])"""

    if stop is None:
        for x in _xrange(int(ceil(start))):
            yield x
    else:
        # create a generator expression for the index values
        indices = (i for i in _xrange(0, int((stop-start)/step)))  
        # yield results
        for i in indices:
            yield start + step*i

## drange.py
import decimal
from math import ceil
# find best range function available to version (2.7.x / 3.x.x)
try:
    _xrange = xrange
except NameError:
    _xrange = range

def drange(start, stop = None, step = 1, precision = None):
    """drange generates a set of Decimal values over the
    range [start, stop) with step size step

    drange([start,] stop, [step [,precision]])"""

    if stop is None:
        for x in _xrange(int(ceil(start))):
            yield x
    else:
        # find precision
        if precision is not None:
            decimal.getcontext().prec = precision
        # convert values to decimals
        start = decimal.Decimal(start)
        stop = decimal.Decimal(stop)
        step = decimal.Decimal(step)
        # create a generator expression for the index values
        indices = (
            i for i in _xrange(
                0, 
                ((stop-start)/step).to_integral_value()
            )
        )  
        # yield results
        for i in indices:
            yield float(start + step*i)

## testranges.py
import frange
import drange
list(frange.frange(0, 2, 0.5)) # [0.0, 0.5, 1.0, 1.5]
list(drange.drange(0, 2, 0.5, precision = 6)) # [0.0, 0.5, 1.0, 1.5]
list(frange.frange(3)) # [0, 1, 2]
list(frange.frange(3.5)) # [0, 1, 2, 3]
list(frange.frange(0,10, -1)) # [] 
```

* * *

## 回答 #16

> 赞同：3
> 
> 时间：2013-12-12T17:04:50.703

这是我通过浮动步骤获取范围的解决方案。
使用此功能无需导入 numpy，也无需安装它。
我很确定它可以改进和优化。随意做，并张贴在这里。

```
from __future__ import division
from math import log

def xfrange(start, stop, step):

    old_start = start #backup this value

    digits = int(round(log(10000, 10)))+1 #get number of digits
    magnitude = 10**digits
    stop = int(magnitude * stop) #convert from 
    step = int(magnitude * step) #0.1 to 10 (e.g.)

    if start == 0:
        start = 10**(digits-1)
    else:
        start = 10**(digits)*start

    data = []   #create array

    #calc number of iterations
    end_loop = int((stop-start)//step)
    if old_start == 0:
        end_loop += 1

    acc = start

    for i in xrange(0, end_loop):
        data.append(acc/magnitude)
        acc += step

    return data

print xfrange(1, 2.1, 0.1)
print xfrange(0, 1.1, 0.1)
print xfrange(-1, 0.1, 0.1) 
```

输出是：

```
[1.0, 1.1, 1.2, 1.3, 1.4, 1.5, 1.6, 1.7, 1.8, 1.9, 2.0]
[0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 1.0, 1.1]
[-1.0, -0.9, -0.8, -0.7, -0.6, -0.5, -0.4, -0.3, -0.2, -0.1, 0.0] 
```

* * *

## 回答 #17

> 赞同：3
> 
> 时间：2015-09-12T07:44:22.010

为了精品店的完整性，一个功能性的解决方案：

```
def frange(a,b,s):
  return [] if s > 0 and a > b or s < 0 and a < b or s==0 else [a]+frange(a+s,b,s) 
```

* * *

## 回答 #18

> 赞同：3
> 
> 时间：2018-03-02T15:00:58.613

惊讶地没有人[在 Python 3 文档中](https://docs.python.org/3/library/stdtypes.html#ranges)提到推荐的解决方案：

> 也可以看看：
> 
> *   [linspace 配方](http://code.activestate.com/recipes/579000/)展示了如何实现适用于浮点应用程序的惰性版本范围。

定义后，配方很容易使用，不需要`numpy`任何其他外部库，但功能如`numpy.linspace()`. 请注意，`step`第三个`num`参数不是参数，而是指定所需值的数量，例如：

```
print(linspace(0, 10, 5))
# linspace(0, 10, 5)
print(list(linspace(0, 10, 5)))
# [0.0, 2.5, 5.0, 7.5, 10] 
```

我在下面引用了 Andrew Barnert 的完整 Python 3 配方的修改版本：

```
import collections.abc
import numbers

class linspace(collections.abc.Sequence):
    """linspace(start, stop, num) -> linspace object

    Return a virtual sequence of num numbers from start to stop (inclusive).

    If you need a half-open range, use linspace(start, stop, num+1)[:-1].
    """
    def __init__(self, start, stop, num):
        if not isinstance(num, numbers.Integral) or num <= 1:
            raise ValueError('num must be an integer > 1')
        self.start, self.stop, self.num = start, stop, num
        self.step = (stop-start)/(num-1)
    def __len__(self):
        return self.num
    def __getitem__(self, i):
        if isinstance(i, slice):
            return [self[x] for x in range(*i.indices(len(self)))]
        if i < 0:
            i = self.num + i
        if i >= self.num:
            raise IndexError('linspace object index out of range')
        if i == self.num-1:
            return self.stop
        return self.start + i*self.step
    def __repr__(self):
        return '{}({}, {}, {})'.format(type(self).__name__,
                                       self.start, self.stop, self.num)
    def __eq__(self, other):
        if not isinstance(other, linspace):
            return False
        return ((self.start, self.stop, self.num) ==
                (other.start, other.stop, other.num))
    def __ne__(self, other):
        return not self==other
    def __hash__(self):
        return hash((type(self), self.start, self.stop, self.num)) 
```

* * *

## 回答 #19

> 赞同：3
> 
> 时间：2019-02-05T18:49:33.600

这里的许多解决方案在 Python 3.6 中仍然存在浮点错误，并且没有完全满足我个人的需要。

下面的函数采用整数或浮点数，不需要导入并且不返回浮点错误。

```
def frange(x, y, step):
    if int(x + y + step) == (x + y + step):
        r = list(range(int(x), int(y), int(step)))
    else:
        f = 10 ** (len(str(step)) - str(step).find('.') - 1)
        rf = list(range(int(x * f), int(y * f), int(step * f)))
        r = [i / f for i in rf]

    return r 
```

* * *

## 回答 #20

> 赞同：2
> 
> 时间：2010-06-25T17:57:04.330

您可以使用此功能：

```
def frange(start,end,step):
    return map(lambda x: x*step, range(int(start*1./step),int(end*1./step))) 
```

* * *

## 回答 #21

> 赞同：2
> 
> 时间：2016-02-12T12:18:12.740

可以使用 Numpy 库来完成。arange() 函数允许浮动步长。但是，它返回一个 numpy 数组，为方便起见，可以使用 tolist() 将其转换为列表。

```
for i in np.arange(0, 1, 0.1).tolist():
   print i 
```

* * *

## 回答 #22

> 赞同：2
> 
> 时间：2018-03-01T21:53:28.770

start 和 stop 是包容性的，而不是一个或另一个（通常 stop 被排除在外）并且没有导入，并且使用生成器

```
def rangef(start, stop, step, fround=5):
    """
    Yields sequence of numbers from start (inclusive) to stop (inclusive)
    by step (increment) with rounding set to n digits.

    :param start: start of sequence
    :param stop: end of sequence
    :param step: int or float increment (e.g. 1 or 0.001)
    :param fround: float rounding, n decimal places
    :return:
    """
    try:
        i = 0
        while stop >= start and step > 0:
            if i==0:
                yield start
            elif start >= stop:
                yield stop
            elif start < stop:
                if start == 0:
                    yield 0
                if start != 0:
                    yield start
            i += 1
            start += step
            start = round(start, fround)
        else:
            pass
    except TypeError as e:
        yield "type-error({})".format(e)
    else:
        pass

# passing
print(list(rangef(-100.0,10.0,1)))
print(list(rangef(-100,0,0.5)))
print(list(rangef(-1,1,0.2)))
print(list(rangef(-1,1,0.1)))
print(list(rangef(-1,1,0.05)))
print(list(rangef(-1,1,0.02)))
print(list(rangef(-1,1,0.01)))
print(list(rangef(-1,1,0.005)))
# failing: type-error:
print(list(rangef("1","10","1")))
print(list(rangef(1,10,"1"))) 
```

> Python 3.6.2 (v3.6.2:5fd33b5, Jul 8 2017, 04:57:36) [MSC v.1900 64 位 (AMD64)]

* * *

## 回答 #23

> 赞同：2
> 
> 时间：2018-03-04T13:05:11.807

为了解决浮点精度问题，您可以使用[`Decimal`模块](https://docs.python.org/3/library/decimal.html).

`Decimal`这需要在编写代码时`int`或在编写代码时付出额外的努力，但如果确实需要这种便利`float`，您可以改为传递和修改函数。`str`

```
from decimal import Decimal

def decimal_range(*args):

    zero, one = Decimal('0'), Decimal('1')

    if len(args) == 1:
        start, stop, step = zero, args[0], one
    elif len(args) == 2:
        start, stop, step = args + (one,)
    elif len(args) == 3:
        start, stop, step = args
    else:
        raise ValueError('Expected 1 or 2 arguments, got %s' % len(args))

    if not all([type(arg) == Decimal for arg in (start, stop, step)]):
        raise ValueError('Arguments must be passed as <type: Decimal>')

    # neglect bad cases
    if (start == stop) or (start > stop and step >= zero) or \
                          (start < stop and step <= zero):
        return []

    current = start
    while abs(current) < abs(stop):
        yield current
        current += step 
```

样本输出 -

```
from decimal import Decimal as D

list(decimal_range(D('2')))
# [Decimal('0'), Decimal('1')]
list(decimal_range(D('2'), D('4.5')))
# [Decimal('2'), Decimal('3'), Decimal('4')]
list(decimal_range(D('2'), D('4.5'), D('0.5')))
# [Decimal('2'), Decimal('2.5'), Decimal('3.0'), Decimal('3.5'), Decimal('4.0')]
list(decimal_range(D('2'), D('4.5'), D('-0.5')))
# []
list(decimal_range(D('2'), D('-4.5'), D('-0.5')))
# [Decimal('2'),
#  Decimal('1.5'),
#  Decimal('1.0'),
#  Decimal('0.5'),
#  Decimal('0.0'),
#  Decimal('-0.5'),
#  Decimal('-1.0'),
#  Decimal('-1.5'),
#  Decimal('-2.0'),
#  Decimal('-2.5'),
#  Decimal('-3.0'),
#  Decimal('-3.5'),
#  Decimal('-4.0')] 
```

* * *

## 回答 #24

> 赞同：2
> 
> 时间：2019-01-02T21:07:20.893

我知道我在这里聚会迟到了，但这是一个在 3.6 中工作的简单生成器解决方案：

```
def floatRange(*args):
    start, step = 0, 1
    if len(args) == 1:
        stop = args[0]
    elif len(args) == 2:
        start, stop = args[0], args[1]
    elif len(args) == 3:
        start, stop, step = args[0], args[1], args[2]
    else:
        raise TypeError("floatRange accepts 1, 2, or 3 arguments. ({0} given)".format(len(args)))
    for num in start, step, stop:
        if not isinstance(num, (int, float)):
            raise TypeError("floatRange only accepts float and integer arguments. ({0} : {1} given)".format(type(num), str(num)))
    for x in range(int((stop-start)/step)):
        yield start + (x * step)
    return 
```

那么你可以像原来`range()`的那样调用它......没有错误处理，但如果有可以合理捕获的错误，请告诉我，我会更新。或者你可以更新它。这是 StackOverflow。

* * *

## 回答 #25

> 赞同：1
> 
> 时间：2010-12-01T06:36:16.003

添加自动更正以防止错误登录步骤的可能性：

```
def frange(start,step,stop):
    step *= 2*((stop>start)^(step<0))-1
    return [start+i*step for i in range(int((stop-start)/step))] 
```

* * *

## 回答 #26

> 赞同：1
> 
> 时间：2012-07-25T13:50:47.807

我的解决方案：

```
def seq(start, stop, step=1, digit=0):
    x = float(start)
    v = []
    while x <= stop:
        v.append(round(x,digit))
        x += step
    return v 
```

* * *

## 回答 #27

> 赞同：1
> 
> 时间：2013-01-08T21:21:33.523

这是我的解决方案，它适用于 float_range(-1, 0, 0.01) 并且没有浮点表示错误。它不是很快，但工作正常：

```
from decimal import Decimal

def get_multiplier(_from, _to, step):
    digits = []
    for number in [_from, _to, step]:
        pre = Decimal(str(number)) % 1
        digit = len(str(pre)) - 2
        digits.append(digit)
    max_digits = max(digits)
    return float(10 ** (max_digits))

def float_range(_from, _to, step, include=False):
    """Generates a range list of floating point values over the Range [start, stop]
       with step size step
       include=True - allows to include right value to if possible
       !! Works fine with floating point representation !!
    """
    mult = get_multiplier(_from, _to, step)
    # print mult
    int_from = int(round(_from * mult))
    int_to = int(round(_to * mult))
    int_step = int(round(step * mult))
    # print int_from,int_to,int_step
    if include:
        result = range(int_from, int_to + int_step, int_step)
        result = [r for r in result if r <= int_to]
    else:
        result = range(int_from, int_to, int_step)
    # print result
    float_result = [r / mult for r in result]
    return float_result

print float_range(-1, 0, 0.01,include=False)

assert float_range(1.01, 2.06, 5.05 % 1, True) ==\
[1.01, 1.06, 1.11, 1.16, 1.21, 1.26, 1.31, 1.36, 1.41, 1.46, 1.51, 1.56, 1.61, 1.66, 1.71, 1.76, 1.81, 1.86, 1.91, 1.96, 2.01, 2.06]

assert float_range(1.01, 2.06, 5.05 % 1, False)==\
[1.01, 1.06, 1.11, 1.16, 1.21, 1.26, 1.31, 1.36, 1.41, 1.46, 1.51, 1.56, 1.61, 1.66, 1.71, 1.76, 1.81, 1.86, 1.91, 1.96, 2.01] 
```

* * *

## 回答 #28

> 赞同：1
> 
> 时间：2013-10-10T22:27:18.403

我只是一个初学者，但在模拟一些计算时我遇到了同样的问题。这是我试图解决这个问题的方法，这似乎是在使用小数步长。

我也很懒，所以我发现很难编写自己的范围函数。

基本上我所做的是将我的更改`xrange(0.0, 1.0, 0.01)`为并在循环内`xrange(0, 100, 1)`使用除法。`100.0`我也担心，如果会出现四舍五入的错误。所以我决定测试一下，是否有。现在我听说，例如，如果`0.01`计算中的浮点数不完全是`0.01`比较它们的浮点数，则应该返回 False（如果我错了，请告诉我）。

所以我决定通过运行一个简短的测试来测试我的解决方案是否适用于我的范围：

```
for d100 in xrange(0, 100, 1):
    d = d100 / 100.0
    fl = float("0.00"[:4 - len(str(d100))] + str(d100))
    print d, "=", fl , d == fl 
```

它为每个打印了 True 。

现在，如果我完全错了，请告诉我。

* * *

## 回答 #29

> 赞同：1
> 
> 时间：2015-09-02T07:28:42.970

避免*四舍五入问题*的技巧是使用一个单独的数字来移动范围，即开始，比*开始**提前**一半*。

 **```
# floating point range
def frange(a, b, stp=1.0):
  i = a+stp/2.0
  while i<b:
    yield a
    a += stp
    i += stp 
```

或者，`numpy.arange`可以使用。

* * *

## 回答 #30

> 赞同：1
> 
> 时间：2017-02-16T19:48:03.070

我的答案与使用 map() 的其他人类似，不需要 NumPy，也不需要使用 lambda（尽管你可以）。要以 dt 为步长获取从 0.0 到 t_max 的浮点值列表：

```
def xdt(n):
    return dt*float(n)
tlist  = map(xdt, range(int(t_max/dt)+1)) 
```

* * *

## 回答 #31

> 赞同：0
> 
> 时间：2013-11-20T16:47:50.613

这一个班轮不会使您的代码混乱。**步长**参数的符号很重要。

```
def frange(start, stop, step):
    return [x*step+start for x in range(0,round(abs((stop-start)/step)+0.5001),
        int((stop-start)/step<0)*-2+1)] 
```

* * *

## 回答 #32

> 赞同：0
> 
> 时间：2014-07-10T18:15:39.210

范围（开始，停止，精度）

```
def frange(a,b,i):
    p = 10**i
    sr = a*p
    er = (b*p) + 1
    p = float(p)
    return map(lambda x: x/p, xrange(sr,er))

In >frange(-1,1,1)

Out>[-1.0, -0.9, -0.8, -0.7, -0.6, -0.5, -0.4, -0.3, -0.2, -0.1, 0.0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 1.0] 
```

* * *

## 回答 #33

> 赞同：0
> 
> 时间：2022-01-03T13:36:10.247

```
f = lambda x,y,z: (x+i*z for i in range(int((y-x)/z))) 
```

以上可以在不借助任何库的情况下进行小数步。

* * *

## 回答 #34

> 赞同：-1
> 
> 时间：2018-06-05T07:58:27.443

```
sign = lambda x: (1, -1)[x < 0]
def frange(start, stop, step):
    i = 0
    r=len(str(step).split('.')[-1])
    args=(start,stop,step)
    if not step :return []
    if all(int(i)==float(i) for i in args):
        start,stop,step=map(int,args)
    if sign(step)==1:
        while start + i * step < stop:
            yield round(start + i * step,r)
            i += 1
    else:
        while start + i * step > stop:
            yield round(start + i * step,r)
            i += 1 
```

# documentation - 什么是好的在线文档？

> ID：477502
> 
> 赞同：17
> 
> 时间：2009-01-25T10:28:38.333
> 
> 标签：documentation

在线文档需要什么才能使阅读变得有用且有趣？

**Disclamer：** 虽然这个问题有自私的根源（我正在编写文档，并且自然希望它是*最好的*），但我相信其他人可以利用这些答案。此外，虽然文档不是编程，但我仍然认为在这里提出这个问题是合适的，因为如果您编写内容，则需要记录内容。

**详细说明：** 这个问题是针对在线文档的，因为我认为[1500 多页的大部头](http://www.wrox.com/WileyCDA/WroxTitle/Ivor-Horton-s-Beginning-Java2-JDK-5-Edition.productCd-0764568744.html)与网页/网站的动态之间存在很大差异。

假设有一个令人兴奋的新服务器 WhizBangDaemon，您对此几乎一无所知，并且您决定在业余时间尝试学习它。应该有什么样的部分，以使文档足够有用和有趣，并让您继续阅读？

请随时提供指向良好现有示例的链接，并解释您喜欢它们的原因。

*解决这个问题的另一种方法是：什么样的阻碍因素会让你对阅读一组文档失去兴趣？*

***答案：***

回顾一下答案之间反复出现的一些主题：

*   **快速浏览**
*   **介绍性文字/教程/示例**
*   **不仅仅是 API 文档**
*   **分成很多小部分（可能和第一点有关）**
*   **简明扼要**
*   **搜索设施**
*   **#anchors 链接**
*   **可下载格式**

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-01-25T17:07:22.810

许多**最小的**代码示例。每个任务一个。确定前 5 项任务；从您的文档中复制/粘贴它们的实现并编译它是一件轻而易举的事。是的，我会回来阅读实际的解释。我想先看看肉。

这在评估库时有很大的不同。我仍然不知道 Adob​​e Adam&Eve 的真正含义。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-01-25T10:59:23.857

许多成功的开源项目展示了良好的在线文档的外观。

一些方面是：

*   最新。如果文档不再是最新的，它*可能会*成为阻碍。
*   许多在线文档都是从一些简短的教程开始的。它们展示了软件的一些关键方面，让用户了解并有兴趣深入挖掘。
*   HowTos 或常见问题解答通常非常有用。许多用户选择不阅读文档而只是尝试一下。在某些时候，用户很可能一遍又一遍地问同样的问题。注意用户可能要求什么以及他们已经要求什么。
*   对于感兴趣的用户，请在*核心文档*中提供一些详细信息。
*   还要考虑考虑文档的受众。作为文档的作者，我认为明确说明文档的受众以及他们应该已经具备的知识是非常有用的。这迫使我要具体而简洁。这样我最终可能会将文档分成不同的不同部分，这使得文档非常结构化。

如果你已经有一个“1500 多页的大部头”文档，你可以*围绕*一些教程、HowTos 和常见问题解答来增加文档的趣味性。随着软件的发展，您可以将核心文档*重构*为更具可读性。

最困难的部分是使文档保持最新。编写文档时要考虑到未来的变化。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-01-25T12:22:27.980

我同意这里的许多其他海报，两件事并不真正满足，但对我来说非常重要：

*   它必须是*快速*的- 正常浏览和搜索
*   它是可链接的，我希望能够向某人发送指向文档特定部分的链接

作为一个负面的例子： http: [//livedocs.adobe.com](http://livedocs.adobe.com)总是感觉很慢而且很多时候它是不可链接的:-(

PS：并且提供可下载的版本供离线使用总是很好的。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-01-25T10:46:28.577

好的文档应该解释“为什么”，而不仅仅是“什么”。我为什么要使用这个功能？它适用于哪些场景？

那，它必须有良好的搜索设施。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2009-01-25T14:17:39.580

个人讨厌：在标题上运行 doxygen 并认为文档已完成的项目。您绝对需要介绍性材料...教程、工作（最好是独立的）代码示例、概述，以指出参考文档中最重要的类。 [Qt](https://doc.qt.io/qt-5/)是这方面做得好的最好的例子之一，恕我直言。

此外，一定要提供一个体面的搜索工具（即使只是重定向到特定于站点的谷歌搜索）。这是我有时更喜欢 MS .chm 文件文档而不是网络托管的在线手册的原因之一。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2009-01-25T17:26:20.710

很多公司似乎没有意识到文档的重要性。

编写文档是我工作的重要组成部分。这是没有人想要的工作，但它至少与开发团队中的任何其他人一样重要。当我使用各种语言和工具工作时，我越来越意识到这一点，并经历了糟糕或不存在的文档的痛苦和好文档的乐趣。

最重要的事情：

1.  简洁明了
2.  一个好**例子**值一千字
3.  有用的**例子**（与 #2 不同）
4.  添加典型用户/大多数用户想要/需要对您正在记录的任何内容执行的**示例。**
5.  我提到过**例子**吗？

细节：我讨厌 java API 文档几乎没有示例的事实。几乎可以查找任何课程或方法，以及 nada，甚至不是一个班轮。在大多数情况下，并不是说一个班轮就足够了，但他们甚至都不会为此烦恼。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2009-01-25T10:49:14.797

我认为 PHP 拥有最好的语言在线文档。

*如果有一个我不知道用途的函数*，我会去 php.net/function-name 。

例如，如果我正在寻找函数 debug_backtrace，我会访问[php.net/debug_backtrace](http://php.net/debug_backtrace)。如果我拼错了函数名称或它不存在，该站点会尽力找到正确的函数并将您重定向到那里。如果做不到这一点，它将向您显示与您正在寻找的函数最接近的 PHP 函数的搜索。

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2009-01-25T11:00:10.173

Django 的文档非常棒（[http://docs.djangoproject.com/](http://docs.djangoproject.com/)），它非常全面且易于阅读，并且可以快速找到您需要的内容。

*   简洁的文字（不需要太多阅读，因此阅读文档的时间更少）
*   好例子
*   快速找到你要找的东西（不需要搜索引擎，但就像在一个很棒的索引页面中一样）

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2009-01-25T12:29:09.277

我真正不喜欢的是 MSDN 文档格式。我也更喜欢 JAVA Sun 文档风格、Flex 3 Livedocs ( [http://livedocs.adobe.com/flex/3/langref/](http://livedocs.adobe.com/flex/3/langref/) ) 和 PHP。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2009-01-25T10:36:41.717

*   提交评论的功能很有用，因为它可以捕获从不同角度编写的文档，或者您最初没有想到的想法。
*   如果您有时间允许检查对 wiki 样式文档的更改，那也可以获得类似的好处。
*   良好的搜索设施
*   长页面中有大量#bookmark 锚点，这使得在这样的网站中可以轻松引用部分
*   使用像[DocBook](http://en.wikipedia.org/wiki/DocBook)这样的灵活格式允许以多种方式呈现手册，如 HTML、PDF、CHM 等。

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2009-05-07T16:23:17.077

好的文档应该是可略读的。必须从 90% 的用户不愿意阅读超过 10% 的材料的角度来编写它。专注于写好东西的作者和只想把事情记下来的读者之间总是存在脱节。

使用书中的任何技巧使最关键的信息高度可见。特别是警告或说明。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2009-01-25T10:50:36.353

划分信息，一些可能想尝试您的产品的人可能只想看教程或示例，我的意思是非常简短的示例。

另一方面，已经购买了您产品的人想要充分利用它，因此创建具有索引和搜索功能的完整 API 规范，链接页面之间的信息，为 API 添加一些示例，而不仅仅是添加参数接收的内容以及方法/函数返回的内容等。当然，如果您为程序员卖东西。

举个真实的例子！！不要只添加参考信息，而是添加代码示例或实际工作环境示例，这些示例可能对那些将应用您的软件以提高生产力并完成任务的人有用，而不仅仅是为了学习。

这就是我在文档中寻找的东西，如果有，我会买它；）

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2009-01-25T17:42:55.733

*真实*的代码示例，以及最少的。

Hello-world 风格的例子很棒，但我们需要知道在生产代码中应该考虑的所有注意事项，即安全隐患、线程不安全等。

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2009-01-25T17:49:21.273

在线文档（至少是它的规范标准版本）需要简短明了。但是所有文档的规范版本都需要简短明了，所以对我来说，在线文档只需要复制规范即可。

我对问题中陈述背后的假设特别不满意，即“1500 多页的书本之类的”期望良好的印刷版本。对我来说，这不是一个没有百科全书的文档的好例子。

而且它必须是可下载的，因为这是我喜欢我的文档的地方——在我的笔记本电脑上，无论我在哪里都可以随时使用。

请注意，到目前为止，很少有人提出好的文档共识示例。首先考虑一下答案中列出的功能的复杂性是否不符合这样做的可行性。在某些情况下，所有这些东西都很棒，但是当它被认为是主要来源时，它就太过分了（并且不可能保持当前和内部一致。

是的，我已经足够大，可以更喜欢 unix 手册页了。从这些开始，如果我需要或想要它，我会（或不接受）其余部分。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2009-05-07T16:18:30.520

在我看来，你应该简单地考虑一下。您还可以安装任何 wiki 软件或尝试从一些托管公司租用并创建自己的文档，没有任何限制。

免费例如：[螺丝转](http://www.screwturn.eu/Default.aspx?AspxAutoDetectCookieSupport=1)

# c++ - 在vista中将文件夹挂载为驱动器

> ID：477503
> 
> 赞同：0
> 
> 时间：2009-01-25T10:29:26.693
> 
> 标签：c++, api

嗨，我正在尝试在 vista 中安装为驱动器，我正在使用 msdn 示例中的以下代码，

```
 BOOL bFlag;
   TCHAR Buf[BUFSIZE];     // temporary buffer for volume name

   if( argc != 3 ) 
   {
      _tprintf( TEXT("Usage: %s <mount_point> <volume>\n"), argv[0] );
      _tprintf( TEXT("For example, \"%s c:\\mnt\\fdrive\\ f:\\\"\n"), argv[0]);
      return( -1 );
   }

  // We should do some error checking on the inputs. Make sure
  // there are colons and backslashes in the right places, etc. 

   bFlag = GetVolumeNameForVolumeMountPoint(
              argv[2], // input volume mount point or directory
                  Buf, // output volume name buffer
              BUFSIZE  // size of volume name buffer
           );

   if (bFlag != TRUE) 
   {
      _tprintf( TEXT("Retrieving volume name for %s failed.\n"), argv[2] );
      return (-2);
   }

   _tprintf( TEXT("Volume name of %s is %s\n"), argv[2], Buf );
   bFlag = SetVolumeMountPoint(
              argv[1], // mount point
                  Buf  // volume to be mounted
           );

   if (!bFlag)
     _tprintf (TEXT("Attempt to mount %s at %s failed.\n"), argv[2], argv[1]);

   return (bFlag); 
```

它总是给出参数不正确的错误，我也尝试过定义的设备然后获取名称，它也没有工作。知道如何使它工作吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-25T10:36:13.200

你需要更加详细！您究竟在代码中的哪个位置得到该错误？

您可以尝试通过 system() 执行以下命令，看看它是否以这种方式工作：

```
subst K: “c:\blabla" 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-25T10:37:57.817

`SetVolumeMountPoint`用于在驱动器号或文件夹中安装卷。它不允许您在驱动器号上安装文件夹。这与您想要的相反。

要将文件夹用作驱动器号，您需要执行与该`SUBST`实用程序等效的操作。这使用`DefineDosDevice`，如下所示：

```
if (!DefineDosDevice(0, _T("Q:"), _T("C:\\Temp")))
    _ftprintf(stderr, _T("DefineDosDevice failed: %d\n"), GetLastError()); 
```

如果你想让这个持久化，我认为你需要编写一个在启动时执行它的 Windows 服务。大约 10 年前，我写过一篇。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2015-12-17T09:52:20.497

而不是试图让 DefineDosDevice 持久化，你最终可能会求助于 regedit。

```
REGEDIT4 
[HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Session Manager\DOS Devices] 
"T:"="\\??\\C:\\Temp" 
```

[https://en.wikipedia.org/wiki/SUBST#Persisting_across_reboots](https://en.wikipedia.org/wiki/SUBST#Persisting_across_reboots)

# c# - MVC 和观察者模式

> ID：477508
> 
> 赞同：1
> 
> 时间：2009-01-25T10:33:56.030
> 
> 标签：c#, model-view-controller, design-patterns, domain-driven-design, observer-pattern

我在我的项目中实现观察者模式时遇到问题。该项目必须在 C# 中制作为 MVC，就像 Windows 应用程序一样。
在我的域模型中，我有例如 Country 类和 Country 存储库。我有一个国家控制器和视图，用于查看所有国家（表格上的列表）、添加新国家和编辑现有国家。
我不知道有多少观点必须了解与国家变化相关的变化。问题是我必须使用观察者模式。在网络上，我只能找到主题是国家和观察者是编辑国家的表单并且所有示例都在控制台应用程序中的示例。

我需要所有包含国家/地区列表的表格都知道添加新国家/地区，而不仅仅是编辑现有国家/地区。我应该怎么做，我应该将存储库设为主题吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-25T11:20:05.610

在 C#（或一般的 .NET）中，您可以使用事件和委托，它们是特殊的观察者/监视器/侦听器实现。

我不知道 DDD，但我会添加一个“NewCountryAdded”事件或“CountryListChanged”事件或类似的东西。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-25T11:20:44.483

您可以创建一个“ManageCountry”任务，让您编辑/添加国家/地区。此任务可能有一个事件“CountryChanged”，其他视图可以订阅该事件。

当您修改国家/地区或创建新国家/地区时，您会引发事件，订阅者可以对其做出反应。您只需确保您引发的事件使用一些自定义 EventArgs，以便您可以将已修改的 Country 对象传递给事件处理程序。

你用什么来实现 MVC 应用程序？您是否正在使用某种框架？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-25T11:10:44.723

嗯，在我看来，您应该将存储库设为主题，以便存储库作为表单的发布者。试试这个，让我们知道它是否成功。

# objective-c - 如何使用 NSString drawInRect 使文本居中？

> ID：477509
> 
> 赞同：42
> 
> 时间：2009-01-25T10:34:33.470
> 
> 标签：objective-c, cocoa, macos

如何`NSString`在 a 内绘制居中`NSRect`？

我开始了：（从我的自定义视图的 drawRect 方法中摘录）

```
NSString* theString = ...
[theString drawInRect:theRect withAttributes:0];
[theString release]; 
```

现在我假设我需要设置一些属性。我已经查看了 Apple 的 Cocoa 文档，但它有点让人不知所措，找不到任何关于如何将段落样式添加到属性的内容。

另外，我只能找到*水平*对齐，*垂直*对齐呢？

* * *

## 回答 #1

> 赞同：97
> 
> 时间：2009-01-25T12:56:08.630

您必须自己进行垂直对齐（（视图高度 + 字符串高度）/2）。您可以使用以下方法进行水平对齐：

```
NSMutableParagraphStyle *style = [[NSParagraphStyle defaultParagraphStyle] mutableCopy];
style.alignment = NSTextAlignmentCenter;
NSDictionary *attr = [NSDictionary dictionaryWithObject:style forKey:NSParagraphStyleAttributeName];
[myString drawInRect:someRect withAttributes:attr]; 
```

* * *

## 回答 #2

> 赞同：27
> 
> 时间：2010-06-08T02:09:34.060

这对我来说适用于水平对齐

```
[textX drawInRect:theRect 
         withFont:font 
    lineBreakMode:UILineBreakModeClip 
        alignment:UITextAlignmentCenter]; 
```

* * *

## 回答 #3

> 赞同：19
> 
> 时间：2010-03-07T08:36:42.653

马丁斯的答案非常接近，但有一些小错误。试试这个：

```
NSMutableParagraphStyle* style = [[NSMutableParagraphStyle alloc] init];
[style setAlignment:NSCenterTextAlignment];
NSDictionary *attr = 
  [NSDictionary dictionaryWithObject:style 
                              forKey:NSParagraphStyleAttributeName];
[myString drawInRect:someRect withAttributes:attr];
[style release]; 
```

您必须创建一个新的`NSMutableParagraphStyle`（而不是使用 Martin 建议的默认段落样式），因为`[NSMutableParagraphStyle defaultParagraphStyle]`返回一个`NSParagraphStyle`没有 setAlignment 方法的 。此外，您不需要字符串`@"NSParagraphStyleAttributeName"`— 只需`NSParagraphStyleAttributeName`.

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2011-01-13T11:16:07.700

这对我有用：

```
 CGRect viewRect = CGRectMake(x, y, w, h);
    UIFont* font = [UIFont systemFontOfSize:15];
    CGSize size = [nsText sizeWithFont:font
                     constrainedToSize:viewRect.size
                         lineBreakMode:(UILineBreakModeWordWrap)];  
    float x_pos = (viewRect.size.width - size.width) / 2; 
    float y_pos = (viewRect.size.height - size.height) /2; 
    [someText drawAtPoint:CGPointMake(viewRect.origin.x + x_pos, viewRect.origin.y + y_pos) withFont:font]; 
```

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-04-27T19:16:17.950

`[NSMutableParagraphStyle defaultParagraphStyle]`无法使用：

`[NSMutableParagraphStyle new]`

此外，它似乎水平对齐只适用于`drawInRect`，而不是`drawAtPoint`（问我怎么知道:-)

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2015-11-09T20:55:47.220

对于任何对 iOS7+ 改编感兴趣的人，请将其放在 NSString 类别中：

```
- (void)drawVerticallyInRect:(CGRect)rect withFont:(UIFont *)font color:(UIColor *)color andAlignment:(NSTextAlignment)alignment
{
    rect.origin.y = rect.origin.y + ((rect.size.height - [self sizeWithAttributes:@{NSFontAttributeName:font}].height) / 2);

    NSMutableParagraphStyle *style = [[NSMutableParagraphStyle alloc] init];
    [style setAlignment:alignment];

    [self drawInRect:rect withAttributes:@{
                                       NSFontAttributeName              : font,
                                       NSForegroundColorAttributeName   : color,
                                       NSParagraphStyleAttributeName    : style
                                       }];
} 
```

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2017-11-06T23:14:49.763

对于**iOS** **Swift ，使用方法****draw(in:withAttributes:)**在矩形内居中字符串

 **```
func drawInCenter(_ text: String, into rectangle: CGRect, with textFont: UIFont) {
    let paragraphStyle = NSMutableParagraphStyle()
    paragraphStyle.alignment = .center
    let rectangle = CGRect.zero
    paragraphStyle.minimumLineHeight = rectangle.height / 2 + textFont.lineHeight / 2
    let textAttributes = [NSAttributedString.Key.font: textFont,
                          NSAttributedString.Key.paragraphStyle: paragraphStyle] as [NSAttributedString.Key : Any]
    (text as NSString).draw(in: rectangle, withAttributes: textAttributes)
} 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-01-25T11:52:41.300

好吧，drawInRect 只适用于基本的文本绘制（换句话说，系统决定将文本放置在哪里） - 通常将文本绘制到您想要的位置的唯一方法是简单地计算您想要它的点并使用 NSString 的 drawAtPoint :with属性:。

此外，NSString 的 sizeWithAttributes 在你最终不得不为 drawAtPoint 做的任何定位数学中都非常有用。

祝你好运！

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2012-12-20T10:34:04.727

正确答案是：

`-drawInRect:withFont:lineBreakMode:alignment:`

我还为垂直对齐创建了一个小类别。如果您喜欢使用它，请继续 :)

```
// NSString+NSVerticalAlign.h
typedef enum {
    NSVerticalTextAlignmentTop,
    NSVerticalTextAlignmentMiddle,
    NSVerticalTextAlignmentBottom
} NSVerticalTextAlignment;

@interface NSString (VerticalAlign)
- (CGSize)drawInRect:(CGRect)rect withFont:(UIFont *)font verticalAlignment:(NSVerticalTextAlignment)vAlign;
- (CGSize)drawInRect:(CGRect)rect withFont:(UIFont *)font lineBreakMode:(NSLineBreakMode)lineBreakMode verticalAlignment:(NSVerticalTextAlignment)vAlign;
- (CGSize)drawInRect:(CGRect)rect withFont:(UIFont *)font lineBreakMode:(NSLineBreakMode)lineBreakMode alignment:(NSTextAlignment)alignment verticalAlignment:(NSVerticalTextAlignment)vAlign;
@end

// NSString+NSVerticalAlign.m
#import "NSString+NSVerticalAlign.h"

@implementation NSString (VerticalAlign)
- (CGSize)drawInRect:(CGRect)rect withFont:(UIFont *)font verticalAlignment:(NSVerticalTextAlignment)vAlign {
switch (vAlign) {
    case NSVerticalTextAlignmentTop:
        break;

    case NSVerticalTextAlignmentMiddle:
        rect.origin.y = rect.origin.y + ((rect.size.height - font.pointSize) / 2);
        break;

    case NSVerticalTextAlignmentBottom:
        rect.origin.y = rect.origin.y + rect.size.height - font.pointSize;
        break;
    }
    return [self drawInRect:rect withFont:font];
}
- (CGSize)drawInRect:(CGRect)rect withFont:(UIFont *)font lineBreakMode:(NSLineBreakMode)lineBreakMode verticalAlignment:(NSVerticalTextAlignment)vAlign {
switch (vAlign) {
    case NSVerticalTextAlignmentTop:
        break;

    case NSVerticalTextAlignmentMiddle:
        rect.origin.y = rect.origin.y + ((rect.size.height - font.pointSize) / 2);
        break;

    case NSVerticalTextAlignmentBottom:
        rect.origin.y = rect.origin.y + rect.size.height - font.pointSize;
        break;
    }   
    return [self drawInRect:rect withFont:font lineBreakMode:lineBreakMode];
}
- (CGSize)drawInRect:(CGRect)rect withFont:(UIFont *)font lineBreakMode:(NSLineBreakMode)lineBreakMode alignment:(NSTextAlignment)alignment verticalAlignment:(NSVerticalTextAlignment)vAlign {
switch (vAlign) {
    case NSVerticalTextAlignmentTop:
        break;

    case NSVerticalTextAlignmentMiddle:
        rect.origin.y = rect.origin.y + ((rect.size.height - font.pointSize) / 2);
        break;

    case NSVerticalTextAlignmentBottom:
        rect.origin.y = rect.origin.y + rect.size.height - font.pointSize;
        break;
    }   
    return [self drawInRect:rect withFont:font lineBreakMode:lineBreakMode alignment:alignment];
}
@end 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2012-05-25T22:16:55.527

以下代码片段对于使用 Annotation 自定义图像作为参考来绘制中心文本字符串很有用：

自定义注释.h

```
@interface CustomAnnotation : MKAnnotationView
[...] 
```

自定义注释.m

```
[...]        
       - (void)drawRect:(CGRect)rect
        {
            ClusterAnnotation *associatedAnnotation = (CustomAnnotation *)self.annotation;
            if (associatedAnnotation != nil)
            {
                CGContextRef context = UIGraphicsGetCurrentContext();

                NSString *imageName = @"custom_image.png";                
                CGRect contextRect = CGRectMake(0, 0, 42.0, 42.0);
                CGFloat fontSize = 14.0;        

                [[UIImage imageNamed:imageName] drawInRect:contextRect];

                NSInteger myIntegerValue = [associatedAnnotation.dataObject.myIntegerValue integerValue];
                NSString *myStringText = [NSString stringWithFormat:@"%d", myIntegerValue];

                UIFont *font = [UIFont fontWithName:@"Helvetica-Bold" size:fontSize];

                CGSize fontWidth = [myStringText sizeWithFont:font];

                CGFloat yOffset = (contextRect.size.height - fontWidth.height) / 2.0;
                CGFloat xOffset = (contextRect.size.width - fontWidth.width) / 2.0;        

                CGPoint textPoint = CGPointMake(contextRect.origin.x + xOffset, contextRect.origin.y + yOffset);        

                CGContextSetTextDrawingMode(context, kCGTextStroke);

                CGContextSetLineWidth(context, fontSize/10);
                CGContextSetStrokeColorWithColor(context, [[UIColor whiteColor] CGColor]);
                [myStringText drawAtPoint:textPoint withFont:font];

                CGContextSetTextDrawingMode(context, kCGTextFill);
                CGContextSetFillColorWithColor(context, [[UIColor blackColor] CGColor]);
                [myStringText drawAtPoint:textPoint withFont:font];

            }
        } 
```

# eclipse - 在 Java 中运行代码后，Eclipse 更改为 PHP 透视图

> ID：477519
> 
> 赞同：1
> 
> 时间：2009-01-25T10:38:33.603
> 
> 标签：eclipse

每当我尝试在 Java 中运行某些东西时，Eclipse 都会更改为 PHP 透视图。我怎样才能解决这个问题？谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-25T10:49:08.557

Gogo Window->Preferences，选择 Run/Debug->Perspectives。

确保在“Java 应用程序”下右侧没有 PHP 透视图。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-06-13T19:27:58.570

我有一个类似的问题：每当 java 程序终止时，它会切换到 PHP 透视图，即使它已关闭。

这是由我的 PHP 调试配置引起的。转到 PHP-> 运行/调试-> 工作区选项。我在“调试终止时切换回 PHP 透视图”下选择了“始终”。显然，PDT 不够聪明，无法区分不同类型的启动，并假设所有启动都是 PHP。

# c++ - C++ 中的表达式求值

> ID：477525
> 
> 赞同：0
> 
> 时间：2009-01-25T10:47:39.510
> 
> 标签：c++, regex, pattern-matching, expression-evaluation

我正在为家庭作业编写一些类似 excel 的 C++ 控制台应用程序。我的应用程序应该能够接受其单元格的公式，例如它应该评估如下内容：

```
Sum(tablename\fieldname[recordnumber], fieldname[recordnumber], ...)

tablename\fieldname[recordnumber] points to a cell in another table, 
fieldname[recordnumber] points to a cell in current table 
```

或者

```
Sin(fieldname[recordnumber]) 
```

或者

```
anotherfieldname[recordnumber] 
```

或者

```
"10" // (simply a number) 
```

类似的东西。函数有 Sum、Ave、Sin、Cos、Tan、Cot、Mul、Div、Pow、Log (10)、Ln、Mod

这很可悲，我知道，但这是我的作业:'(

那么有人知道评估这样的事情的技巧吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-25T11:10:43.863

好的，顺便说一句，很好的家庭作业问题。

这真的取决于你想要它有多重。您可以创建一个完整的表达式解析器（这很有趣但也很耗时）。

为此，您需要描述完整的语法并编写前端（看看 lex 和 yacc 或 flexx 和 bison.

但是当我看到您的问题时，您可以将自己限制在三个子案例中：

*   一个简单的值
*   查找（可能到另一个表）
*   输入是查找的函数

我认为一点 OO 设计可以帮助你。

我不确定您是否必须处理实时刷新和循环依赖检查。否则它们也可能很棘手。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-25T12:15:24.403

对于解析，我会看递归下降解析。然后有一个将所有可能的函数名称映射到函数指针的表：

```
struct FunctionTableEntry {
    string name;
    double (*f)(double);
}; 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-25T11:10:49.683

你应该写一个解析器。解析器应采用表达式，即每一行，并应识别命令并构造解析树。这是第一阶段。在第二阶段，您可以通过将数据替换为命令的每个元素来评估树。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-25T15:40:10.940

以前的响应者已经击中了它：**您需要解析单元格内容，并解释它们**。

StackOverflow 已经有一大堆关于构建编译器和解释器的问题，您可以在其中找到指向资源的指针。他们之中有一些是：

*   [学习编写编译器](https://stackoverflow.com/questions/1669/learning-to-write-a-compiler)（#1669 人！）
*   [解析器、解释器和编译器的学习资源](https://stackoverflow.com/questions/41785/learning-resources-on-parsers-interpreters-and-compilers)
*   [什么是编译的好资源？](https://stackoverflow.com/questions/153330/what-are-good-resources-on-compilation)
*   [在 C/C++ 中实现解释器所需的参考资料](https://stackoverflow.com/questions/294852/references-needed-for-implementing-an-interpreter-in-c-c)
*   ...

等等。

*旁白：我从来没有精力把它们联系在一起，甚至没有尝试建立一个全面的清单。*

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-25T11:08:25.100

我猜你不能使用 yacc/lex （或类似的），所以你必须“手动”解析：
迭代字符串并将其分成几个部分。什么部分取决于您的语法（句法）。这样您就可以找到函数名称和参数。其难度取决于语法的复杂性。

也许您应该阅读一些有关[词法分析](http://en.wikipedia.org/wiki/Lexical_analysis)的内容。

# jquery - 在jQuery中提取列表数据

> ID：477537
> 
> 赞同：0
> 
> 时间：2009-01-25T10:55:21.243
> 
> 标签：jquery, list

我正在使用 jQuery。如何有效地提取列表数据？

我的清单有：

```
<li class="add"><a href="#">Data1</a></li>
<li class="add"><a href="#">Data2</a> </li>
 ... 
```

我的 jQuery 有：

```
$(".add").click(function(e){
    e.preventDefault();
    // Here is to get the value of Data1 and Data2...
    // How do I alert Data1, Data2 effectively?
}); 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-25T11:15:20.050

您可以尝试以下方法：

```
$('.add').click(function(e) {
  e.preventDefault();

  // Initialize an array for all texts
  var data = [];

  // For each <li> with class 'add'...
  $('li.add').each(function() {
    // ...append the element's text to the data array
    data.push($(this).text());
  });

  // Just for testing: Alert the array as a string
  alert(data.join(','));
}); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-25T11:25:14.023

我会说：

```
$('.add').click( function(e){
 e.preventDefault();
 data = [];
 //loop over each li:
 $('li.add').each( function() {
  //Get the a and the text contents of that
  data.push($(this).find('a').text());
 }
 alert(data.join(','));
} 
```

这与费迪南德的回答略有不同。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-25T14:53:36.947

如果有什么安慰的话，我最近为一个项目做了这样的事情。我想把它放在你可以搜索信息并突出显示页面中的文本的地方。但我想对数据本身进行处理（意思是不要每次都点击 HTML）。

[http://www.ffin.com/onlinebankingfaq](http://www.ffin.com/onlinebankingfaq)

如果您查看 JavaScript 代码，您会看到我是如何设置数据的，这可能会对您有所帮助。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-01-25T14:49:06.397

要不就

```
 $('li.add a').each(function() {
    data.push($(this).text());
  }); 
```

# javascript - 为什么我的元素值没有改变？我使用了错误的功能吗？

> ID：477543
> 
> 赞同：22
> 
> 时间：2009-01-25T11:00:12.530
> 
> 标签：javascript, textbox

我有一个 asp.net mvc 应用程序，我正在尝试为我的文本框动态分配值，但它似乎不起作用（我现在只在 IE 上进行测试）。这就是我现在所拥有的。。

`document.getElementsByName('Tue').Value = tue;`（顺便说一下 tue 是一个变量）

我也尝试过这种变化，但它也没有奏效。

`document.getElementsById('Tue').Value = tue;`（顺便说一下 tue 是一个变量）

有人可以告诉我我哪里出了问题吗？

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2009-01-25T11:08:10.670

如何处理文本框取决于 HTML 代码：

```
<!-- 1 --><input type="textbox" id="Tue" />
<!-- 2 --><input type="textbox" name="Tue" /> 
```

如果您使用“id”属性：

```
var textbox = document.getElementById('Tue'); 
```

对于“名称”：

```
var textbox = document.getElementsByName('Tue')[0] 
```

（注意 getElementsByName() 以数组的形式返回*所有*具有名称的元素，因此我们使用 [0] 来访问第一个）

然后，使用“值”属性：

```
textbox.value = 'Foobar'; 
```

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2009-01-25T11:05:21.817

它是[document.getElementById](https://developer.mozilla.org/En/DOM/Document.getElementById)，而不是 document.getElementsByID

我假设你`<input id="Tue" ...>`的标记中有某个地方。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2011-11-17T12:03:42.803

您的代码中有两个问题。

1.  使用`getElementByName`代替`getElement**s**ByName`
2.  使用`value`in 小写而不是`Value`.

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2012-09-29T06:33:41.180

如果您使用的是 Chrome，请使用控制台进行调试。按 SHIFT+CTRL+j 使控制台显示在屏幕上。

相信我，它有很大帮助。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-01-25T11:02:44.457

听起来我们需要假设您的文本框名称和 ID 都设置为“星期二”。如果是这种情况，请尝试在 .value 上使用小写 V。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-01-25T11:08:39.407

正如复数`getElementsByName()`所暗示的那样，它是否总是返回具有此名称的元素列表。因此，当您有一个具有该名称的输入元素时：

```
<input type="text" name="Tue"> 
```

它是第一个具有该名称的元素，您必须使用它`document.getElementsByName('Tue')[0]`来获取具有该名称的元素列表的第一个元素。

除此之外，属性区分大小写，并且 value 属性的正确拼写是`.value`.

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2013-03-29T12:55:55.697

您可以使用

```
formname.textboxname.value="delete"; 
```

# java - 有没有办法在 Java 的 for-each 循环中访问迭代计数器？

> ID：477550
> 
> 赞同：314
> 
> 时间：2009-01-25T11:05:37.447
> 
> 标签：java, loops, for-loop, foreach

Java的for-each循环中有没有办法

```
for(String s : stringArray) {
  doSomethingWith(s);
} 
```

找出循环已经被处理的频率？

除了使用旧的和众所周知的`for(int i=0; i < boundary; i++)`- 循环之外，还有构造

```
int i = 0;
for(String s : stringArray) {
  doSomethingWith(s);
  i++;
} 
```

在 for-each 循环中使用这种计数器的唯一方法是什么？

* * *

## 回答 #1

> 赞同：234
> 
> 时间：2009-01-25T11:36:35.700

不可以，但您可以提供自己的柜台。

原因是for-each循环内部没有*计数器*；它基于[Iterable](http://java.sun.com/j2se/1.5.0/docs/api/java/lang/Iterable.html)接口，即它使用 an`Iterator`循环遍历“集合”——它可能根本不是一个集合，实际上可能根本不是基于索引的东西（例如链表）。

* * *

## 回答 #2

> 赞同：73
> 
> 时间：2009-09-29T08:45:30.327

还有另一种方法。

鉴于您编写了自己的`Index`类和一个返回`Iterable`此类的过度实例的静态方法，您可以

```
for (Index<String> each: With.index(stringArray)) {
    each.value;
    each.index;
    ...
} 
```

的实施`With.index`类似于

```
class With {
    public static <T> Iterable<Index<T>> index(final T[] array) {
        return new Iterable<Index<T>>() {
            public Iterator<Index<T>> iterator() {
                return new Iterator<Index<T>>() {
                    index = 0;
                    public boolean hasNext() { return index < array.size }
                    public Index<T> next() { return new Index(array[index], index++); }
                    ...
                }
            }
        }
    }
} 
```

* * *

## 回答 #3

> 赞同：61
> 
> 时间：2009-01-25T11:18:48.967

最简单的解决方案*是*运行您自己的计数器：

```
int i = 0;
for (String s : stringArray) {
    doSomethingWith(s, i);
    i++;
} 
```

这样做的原因是因为实际上并不能保证集合中的项目（`for`迭代的变体）甚至*具有*索引，甚至具有*定义的顺序*（某些集合可能会在您添加或删除元素时更改顺序）。

例如，请参见以下代码：

```
import java.util.*;

public class TestApp {
  public static void AddAndDump(AbstractSet<String> set, String str) {
    System.out.println("Adding [" + str + "]");
    set.add(str);
    int i = 0;
    for(String s : set) {
        System.out.println("   " + i + ": " + s);
        i++;
    }
  }

  public static void main(String[] args) {
    AbstractSet<String> coll = new HashSet<String>();
    AddAndDump(coll, "Hello");
    AddAndDump(coll, "My");
    AddAndDump(coll, "Name");
    AddAndDump(coll, "Is");
    AddAndDump(coll, "Pax");
  }
} 
```

当你运行它时，你可以看到如下内容：

```
Adding [Hello]
   0: Hello
Adding [My]
   0: Hello
   1: My
Adding [Name]
   0: Hello
   1: My
   2: Name
Adding [Is]
   0: Hello
   1: Is
   2: My
   3: Name
Adding [Pax]
   0: Hello
   1: Pax
   2: Is
   3: My
   4: Name 
```

表明，正确地，顺序不被认为是集合的显着特征。

还有其他方法可以在*没有*手动计数器的情况下做到这一点，但这是一项相当可观的工作，但效果却很可疑。

* * *

## 回答 #4

> 赞同：28
> 
> 时间：2014-04-05T13:22:47.380

在**Java 8**中使用**lambda**和**函数式接口**使得创建新的循环抽象成为可能。我可以循环使用索引和集合大小的集合：

 **```
List<String> strings = Arrays.asList("one", "two","three","four");
forEach(strings, (x, i, n) -> System.out.println("" + (i+1) + "/"+n+": " + x)); 
```

哪个输出：

```
1/4: one
2/4: two
3/4: three
4/4: four 
```

我将其实现为：

```
 @FunctionalInterface
   public interface LoopWithIndexAndSizeConsumer<T> {
       void accept(T t, int i, int n);
   }
   public static <T> void forEach(Collection<T> collection,
                                  LoopWithIndexAndSizeConsumer<T> consumer) {
      int index = 0;
      for (T object : collection){
         consumer.accept(object, index++, collection.size());
      }
   } 
```

可能性是无止境。例如，我创建了一个仅对第一个元素使用特殊函数的抽象：

```
forEachHeadTail(strings, 
                (head) -> System.out.print(head), 
                (tail) -> System.out.print(","+tail)); 
```

正确打印逗号分隔列表：

```
one,two,three,four 
```

我将其实现为：

```
public static <T> void forEachHeadTail(Collection<T> collection, 
                                       Consumer<T> headFunc, 
                                       Consumer<T> tailFunc) {
   int index = 0;
   for (T object : collection){
      if (index++ == 0){
         headFunc.accept(object);
      }
      else{
         tailFunc.accept(object);
      }
   }
} 
```

图书馆将开始弹出来做这些事情，或者你可以自己动手。

* * *

## 回答 #5

> 赞同：28
> 
> 时间：2016-10-18T19:03:53.807

Java 8 引入了`Iterable#forEach()`/方法，与“经典” for-each 循环相比，它对许多/实现`Map#forEach()`更有效。然而，在这种情况下，也没有提供索引。这里的技巧是在 lambda 表达式之外使用。注意：在 lambda 表达式中使用的变量必须是有效的 final，这就是为什么我们不能使用普通的.`Collection``Map``AtomicInteger``int`

```
final AtomicInteger indexHolder = new AtomicInteger();
map.forEach((k, v) -> {
    final int index = indexHolder.getAndIncrement();
    // use the index
}); 
```

* * *

## 回答 #6

> 赞同：17
> 
> 时间：2009-01-25T11:54:13.870

恐怕这是不可能的`foreach`。但我可以建议你一个简单的*老式 for-loops*：

```
 List<String> l = new ArrayList<String>();

    l.add("a");
    l.add("b");
    l.add("c");
    l.add("d");

    // the array
    String[] array = new String[l.size()];

    for(ListIterator<String> it =l.listIterator(); it.hasNext() ;)
    {
        array[it.nextIndex()] = it.next();
    } 
```

请注意，[List](http://java.sun.com/j2se/1.5.0/docs/api/java/util/List.html)界面允许您访问`it.nextIndex()`.

**（编辑）**

对于您更改的示例：

```
 for(ListIterator<String> it =l.listIterator(); it.hasNext() ;)
    {
        int i = it.nextIndex();
        doSomethingWith(it.next(), i);
    } 
```

* * *

## 回答 #7

> 赞同：11
> 
> 时间：2009-01-25T12:43:29.153

`Sun`正在考虑的更改之一`Java7`是提供对`Iterator`foreach 循环内部的访问。语法将是这样的（如果这被接受）：

```
for (String str : list : it) {
  if (str.length() > 100) {
    it.remove();
  }
} 
```

这是语法糖，但显然很多人为此功能提出了要求。但在获得批准之前，您必须自己计算迭代次数，或者使用带有`Iterator`.

* * *

## 回答 #8

> 赞同：11
> 
> 时间：2017-10-13T03:25:32.420

### 惯用的解决方案：

```
final Set<Double> doubles; // boilerplate
final Iterator<Double> iterator = doubles.iterator();
for (int ordinal = 0; iterator.hasNext(); ordinal++)
{
    System.out.printf("%d:%f",ordinal,iterator.next());
    System.out.println();
} 
```

> 这实际上是 Google 在[Guava 讨论](https://github.com/google/guava/wiki/IdeaGraveyard#countingindexed-iterator)中建议的解决方案，说明他们为什么不提供`CountingIterator`.

* * *

## 回答 #9

> 赞同：10
> 
> 时间：2019-01-10T05:57:50.543

尽管提到了很多其他方法可以实现相同的目标，但我会为一些不满意的用户分享我的方法。我正在使用 Java 8 IntStream 功能。

**1\. 数组**

```
Object[] obj = {1,2,3,4,5,6,7};
IntStream.range(0, obj.length).forEach(index-> {
    System.out.println("index: " + index);
    System.out.println("value: " + obj[index]);
}); 
```

**2.列表**

```
List<String> strings = new ArrayList<String>();
Collections.addAll(strings,"A","B","C","D");

IntStream.range(0, strings.size()).forEach(index-> {
    System.out.println("index: " + index);
    System.out.println("value: " + strings.get(index));
}); 
```

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2017-06-14T17:23:05.840

对于我偶尔只需要索引的情况，比如在 catch 子句中，我有时会使用 indexOf。

```
for(String s : stringArray) {
  try {
    doSomethingWith(s);
  } catch (Exception e) {
    LOGGER.warn("Had some kind of problem with string " +
      stringArray.indexOf(s) + ": " + s, e);
  }
} 
```

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2009-01-25T11:13:12.377

如果你需要一个 for-each 循环中的计数器，你必须自己计算。据我所知，没有内置计数器。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2010-06-30T13:13:29.833

pax 的答案有一个“变体”...... ;-)

```
int i = -1;
for(String s : stringArray) {
    doSomethingWith(s, ++i);
} 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2022-02-01T11:00:00.537

```
for (Object child : mChildren) {
  int index = mChildren.indexOf(child);
} 
```

这是获取 foreach 中每个对象的索引的最简单方法。

* * *

## 回答 #14

> 赞同：-1
> 
> 时间：2020-01-04T20:55:04.340

最佳和优化的解决方案是执行以下操作：

```
int i=0;

for(Type t: types) {
  ......
  i++;
} 
```

其中 Type 可以是任何数据类型，types 是您申请循环的变量。

* * *

## 回答 #15

> 赞同：-4
> 
> 时间：2011-03-04T23:02:27.683

我有点惊讶没有人提出以下建议（我承认这是一种懒惰的方法......）；如果 stringArray 是某种列表，您可以使用类似 stringArray.indexOf(S) 的东西来返回当前计数的值。

注意：这假定 List 的元素是唯一的，或者它们是否非唯一无关紧要（因为在这种情况下它将返回找到的第一个副本的索引）。

在某些情况下，这就足够了……

* * *

## 回答 #16

> 赞同：-5
> 
> 时间：2019-02-18T23:06:38.890

这是我如何做到这一点的一个例子。这将在 for each 循环中获取索引。希望这可以帮助。

```
public class CheckForEachLoop {

    public static void main(String[] args) {

        String[] months = new String[] { "JANUARY", "FEBRUARY", "MARCH", "APRIL", "MAY", "JUNE", "JULY", "AUGUST",
                "SEPTEMBER", "OCTOBER", "NOVEMBER", "DECEMBER" };
        for (String s : months) {
            if (s == months[2]) { // location where you can change
              doSomethingWith(s); // however many times s and months
                                  // doSomethingWith(s) will be completed and 
                                  // added together instead of counter
            }

        }
        System.out.println(s); 

    }
} 
```

# crystal-reports - 将列表属性绑定到水晶报表

> ID：477557
> 
> 赞同：2
> 
> 时间：2009-01-25T11:10:19.247
> 
> 标签：crystal-reports

我有一个数据对象，其中包含具有许多数据类型的字段，其中一个是字典，当我将此对象添加为水晶报表的数据源时，字典文件不会使用水晶报表编辑器添加到字段资源管理器中。如何将列表或字典类型的属性添加到水晶报表？

* * *

更具体地说，我想绑定到水晶报表的自定义对象类似于以下内容：

```
public class MyClass
{
 Publuc MyClass()
 {
  this.Services = new Dictionary`<string,decimal`> ();
  }
  public string Name{set;get;}
  public string Address{set;get;}
  public Dictionary`<string,decimal`> Services{set;get;}
} 
```

我想要的是能够在水晶报表中显示服务字典，现在我只能绑定名称和地址等简单属性。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-27T13:08:22.883

我实际上为解决这个问题所做的是，我使用了一个数据集，其中包含两个表“MyClass”表，除了字典和具有两个属性的“服务”表之外，它们具有相同的属性，然后我将数据集绑定到水晶报告，现在我可以使用水晶报表设计器访问这两个表。

# windows - 在 Windows 中映射远程文件系统的首选方法？

> ID：477568
> 
> 赞同：0
> 
> 时间：2009-01-25T11:18:06.283
> 
> 标签：windows, filesystems, webdav

对于当前项目，我需要允许用户从 Windows 远程访问他们的文件。我正在寻找具有资源管理器集成的解决方案（使用 Shell 命名空间扩展）。

我首先尝试在 Windows 中使用 WebDAV 和内置客户端，但客户端在所有 Windows 版本中的质量并不相同，并且添加 SSL 和/或身份验证无法正常工作。

我不依赖 WebDAV，它可以是任何协议。我更喜欢开源项目或具有 SDK 许可证的商业项目（必须集成在产品中）。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-25T12:57:29.517

您是否尝试过“共享”文件系统？如果您的服务器运行 Linux，您可以尝试[samba](http://www.samba.org/)。我有一段时间没有尝试过 Windows，但我似乎记得 Explorer 也做过 ftp。

我假设普通的 HTTP 在这里是不行的。

# android - 将图像加载到位图对象时出现奇怪的 OutOfMemory 问题

> ID：477572
> 
> 赞同：1364
> 
> 时间：2009-01-25T11:23:37.957
> 
> 标签：android, image, bitmap, out-of-memory, android-bitmap

我`ListView`在每一行都有几个图像按钮。当用户单击列表行时，它会启动一个新活动。由于相机布局问题，我不得不构建自己的标签。为结果启动的活动是地图。如果我单击按钮启动图像预览（从 SD 卡加载图像），应用程序会从活动返回到`ListView`结果处理程序以重新启动我的新活动，这只不过是一个图像小部件。

`ListView`正在使用光标和 完成图像预览`ListAdapter`。这使它变得非常简单，但我不确定如何放置调整大小的图像（即较小的位大小而不是像素作为动态`src`图像按钮。所以我只是调整了从手机摄像头出来的图像的大小。

问题是`OutOfMemoryError`当它尝试返回并重新启动第二个活动时，我得到了一个。

*   有没有一种方法可以轻松地逐行构建列表适配器，我可以在其中动态调整大小（*按位*）？

这将是可取的，因为我还需要对每行中的小部件/元素的属性进行一些更改，因为由于焦点问题，我无法使用触摸屏选择一行。（*我可以用滚球。*）

*   我知道我可以进行带外调整大小并保存我的图像，但这并不是我真正想要做的，但一些示例代码会很好。

一旦我禁用了图像，`ListView`它就会再次正常工作。

仅供参考：这就是我的做法：

```
String[] from = new String[] { DBHelper.KEY_BUSINESSNAME, DBHelper.KEY_ADDRESS,
    DBHelper.KEY_CITY, DBHelper.KEY_GPSLONG, DBHelper.KEY_GPSLAT,
    DBHelper.KEY_IMAGEFILENAME  + ""};
int[] to = new int[] { R.id.businessname, R.id.address, R.id.city, R.id.gpslong,
    R.id.gpslat, R.id.imagefilename };
notes = new SimpleCursorAdapter(this, R.layout.notes_row, c, from, to);
setListAdapter(notes); 
```

`R.id.imagefilename`一个在哪里`ButtonImage`。

这是我的 LogCat：

```
01-25 05:05:49.877: ERROR/dalvikvm-heap(3896): 6291456-byte external allocation too large for this process.
01-25 05:05:49.877: ERROR/(3896): VM wont let us allocate 6291456 bytes
01-25 05:05:49.877: ERROR/AndroidRuntime(3896): Uncaught handler: thread main exiting due to uncaught exception
01-25 05:05:49.917: ERROR/AndroidRuntime(3896): java.lang.OutOfMemoryError: bitmap size exceeds VM budget
01-25 05:05:49.917: ERROR/AndroidRuntime(3896):     at android.graphics.BitmapFactory.nativeDecodeStream(Native Method)
01-25 05:05:49.917: ERROR/AndroidRuntime(3896):     at android.graphics.BitmapFactory.decodeStream(BitmapFactory.java:304)
01-25 05:05:49.917: ERROR/AndroidRuntime(3896):     at android.graphics.BitmapFactory.decodeFile(BitmapFactory.java:149)
01-25 05:05:49.917: ERROR/AndroidRuntime(3896):     at android.graphics.BitmapFactory.decodeFile(BitmapFactory.java:174)
01-25 05:05:49.917: ERROR/AndroidRuntime(3896):     at android.graphics.drawable.Drawable.createFromPath(Drawable.java:729)
01-25 05:05:49.917: ERROR/AndroidRuntime(3896):     at android.widget.ImageView.resolveUri(ImageView.java:484)
01-25 05:05:49.917: ERROR/AndroidRuntime(3896):     at android.widget.ImageView.setImageURI(ImageView.java:281)
01-25 05:05:49.917: ERROR/AndroidRuntime(3896):     at android.widget.SimpleCursorAdapter.setViewImage(SimpleCursorAdapter.java:183)
01-25 05:05:49.917: ERROR/AndroidRuntime(3896):     at android.widget.SimpleCursorAdapter.bindView(SimpleCursorAdapter.java:129)
01-25 05:05:49.917: ERROR/AndroidRuntime(3896):     at android.widget.CursorAdapter.getView(CursorAdapter.java:150)
01-25 05:05:49.917: ERROR/AndroidRuntime(3896):     at android.widget.AbsListView.obtainView(AbsListView.java:1057)
01-25 05:05:49.917: ERROR/AndroidRuntime(3896):     at android.widget.ListView.makeAndAddView(ListView.java:1616)
01-25 05:05:49.917: ERROR/AndroidRuntime(3896):     at android.widget.ListView.fillSpecific(ListView.java:1177)
01-25 05:05:49.917: ERROR/AndroidRuntime(3896):     at android.widget.ListView.layoutChildren(ListView.java:1454)
01-25 05:05:49.917: ERROR/AndroidRuntime(3896):     at android.widget.AbsListView.onLayout(AbsListView.java:937)
01-25 05:05:49.917: ERROR/AndroidRuntime(3896):     at android.view.View.layout(View.java:5611)
01-25 05:05:49.917: ERROR/AndroidRuntime(3896):     at android.widget.LinearLayout.setChildFrame(LinearLayout.java:1119)
01-25 05:05:49.917: ERROR/AndroidRuntime(3896):     at android.widget.LinearLayout.layoutHorizontal(LinearLayout.java:1108)
01-25 05:05:49.917: ERROR/AndroidRuntime(3896):     at android.widget.LinearLayout.onLayout(LinearLayout.java:922)
01-25 05:05:49.917: ERROR/AndroidRuntime(3896):     at android.view.View.layout(View.java:5611)
01-25 05:05:49.917: ERROR/AndroidRuntime(3896):     at android.widget.FrameLayout.onLayout(FrameLayout.java:294)
01-25 05:05:49.917: ERROR/AndroidRuntime(3896):     at android.view.View.layout(View.java:5611)
01-25 05:05:49.917: ERROR/AndroidRuntime(3896):     at android.widget.LinearLayout.setChildFrame(LinearLayout.java:1119)
01-25 05:05:49.917: ERROR/AndroidRuntime(3896):     at android.widget.LinearLayout.layoutVertical(LinearLayout.java:999)
01-25 05:05:49.917: ERROR/AndroidRuntime(3896):     at android.widget.LinearLayout.onLayout(LinearLayout.java:920)
01-25 05:05:49.917: ERROR/AndroidRuntime(3896):     at android.view.View.layout(View.java:5611)
01-25 05:05:49.917: ERROR/AndroidRuntime(3896):     at android.widget.FrameLayout.onLayout(FrameLayout.java:294)
01-25 05:05:49.917: ERROR/AndroidRuntime(3896):     at android.view.View.layout(View.java:5611)
01-25 05:05:49.917: ERROR/AndroidRuntime(3896):     at android.view.ViewRoot.performTraversals(ViewRoot.java:771)
01-25 05:05:49.917: ERROR/AndroidRuntime(3896):     at android.view.ViewRoot.handleMessage(ViewRoot.java:1103)
01-25 05:05:49.917: ERROR/AndroidRuntime(3896):     at android.os.Handler.dispatchMessage(Handler.java:88)
01-25 05:05:49.917: ERROR/AndroidRuntime(3896):     at android.os.Looper.loop(Looper.java:123)
01-25 05:05:49.917: ERROR/AndroidRuntime(3896):     at android.app.ActivityThread.main(ActivityThread.java:3742)
01-25 05:05:49.917: ERROR/AndroidRuntime(3896):     at java.lang.reflect.Method.invokeNative(Native Method)
01-25 05:05:49.917: ERROR/AndroidRuntime(3896):     at java.lang.reflect.Method.invoke(Method.java:515)
01-25 05:05:49.917: ERROR/AndroidRuntime(3896):     at com.android.internal.os.ZygoteInit$MethodAndArgsCaller.run(ZygoteInit.java:739)
01-25 05:05:49.917: ERROR/AndroidRuntime(3896):     at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:497)
01-25 05:05:49.917: ERROR/AndroidRuntime(3896):     at dalvik.system.NativeStart.main(Native Method)
01-25 05:10:01.127: ERROR/AndroidRuntime(3943): ERROR: thread attach failed 
```

显示图像时我也有一个新错误：

```
22:13:18.594: DEBUG/skia(4204): xxxxxxxxxxx jpeg error 20 Improper call to JPEG library in state %d
22:13:18.604: INFO/System.out(4204): resolveUri failed on bad bitmap uri: 
22:13:18.694: ERROR/dalvikvm-heap(4204): 6291456-byte external allocation too large for this process.
22:13:18.694: ERROR/(4204): VM won't let us allocate 6291456 bytes
22:13:18.694: DEBUG/skia(4204): xxxxxxxxxxxxxxxxxxxx allocPixelRef failed 
```

* * *

## 回答 #1

> 赞同：907
> 
> 时间：2009-05-05T09:00:14.040

要修复 OutOfMemory 错误，您应该执行以下操作：

```
BitmapFactory.Options options = new BitmapFactory.Options();
options.inSampleSize = 8;
Bitmap preview_bitmap = BitmapFactory.decodeStream(is, null, options); 
```

此`inSampleSize`选项可减少内存消耗。

这是一个完整的方法。首先它读取图像大小而不解码内容本身。然后它找到最好的`inSampleSize`值，应该是2的幂，最后对图像进行解码。

```
// Decodes image and scales it to reduce memory consumption
private Bitmap decodeFile(File f) {
    try {
        // Decode image size
        BitmapFactory.Options o = new BitmapFactory.Options();
        o.inJustDecodeBounds = true;
        BitmapFactory.decodeStream(new FileInputStream(f), null, o);

        // The new size we want to scale to
        final int REQUIRED_SIZE=70;

        // Find the correct scale value. It should be the power of 2.
        int scale = 1;
        while(o.outWidth / scale / 2 >= REQUIRED_SIZE && 
              o.outHeight / scale / 2 >= REQUIRED_SIZE) {
            scale *= 2;
        }

        // Decode with inSampleSize
        BitmapFactory.Options o2 = new BitmapFactory.Options();
        o2.inSampleSize = scale;
        return BitmapFactory.decodeStream(new FileInputStream(f), null, o2);
    } catch (FileNotFoundException e) {}
    return null;
} 
```

* * *

## 回答 #2

> 赞同：682
> 
> 时间：2012-04-12T16:31:31.110

[Android 培训](http://developer.android.com/training/index.html)课程“高效[显示位图](http://developer.android.com/training/displaying-bitmaps/index.html)”为理解和处理异常 `java.lang.OutOfMemoryError: 加载位图时位图大小超出 VM 预算提供了一些重要信息。

* * *

## 读取位图尺寸和类型

该类`BitmapFactory`提供了几种解码方法（`decodeByteArray()`、`decodeFile()`、`decodeResource()`等），用于`Bitmap`从各种来源创建一个。根据您的图像数据源选择最合适的解码方法。这些方法试图为构造的位图分配内存，因此很容易导致`OutOfMemory`异常。每种类型的解码方法都有额外的签名，让您可以通过`BitmapFactory.Options`类指定解码选项。将`inJustDecodeBounds`属性设置为`true`while 解码可避免内存分配，返回`null`位图对象但设置`outWidth`,`outHeight`和`outMimeType`. 此技术允许您在构建位图（和内存分配）之前读取图像数据的尺寸和类型。

```
BitmapFactory.Options options = new BitmapFactory.Options();
options.inJustDecodeBounds = true;
BitmapFactory.decodeResource(getResources(), R.id.myimage, options);
int imageHeight = options.outHeight;
int imageWidth = options.outWidth;
String imageType = options.outMimeType; 
```

为避免`java.lang.OutOfMemory`异常，请在解码之前检查位图的尺寸，除非您绝对相信来源能够为您提供大小可预测的图像数据，这些数据可以轻松地放入可用内存中。

* * *

## 将缩小版本加载到内存中

现在图像尺寸已知，它们可用于决定是否应将完整图像加载到内存中，或者是否应加载子采样版本。以下是一些需要考虑的因素：

*   在内存中加载完整图像的估计内存使用量。
*   考虑到应用程序的任何其他内存要求，您愿意承诺加载此图像的内存量。
*   要加载图像的目标 ImageView 或 UI 组件的尺寸。
*   当前设备的屏幕尺寸和密度。

例如，如果一个 1024x768 像素的图像最终会以 128x96 像素的缩略图显示在`ImageView`.

告诉解码器对图像进行二次采样，将较小的版本加载到内存中，在您的对象中设置`inSampleSize`为。例如，分辨率为 2048x1536 的图像使用4 进行解码会生成大约 512x384 的位图。将其加载到内存中使用 0.75MB 而不是 12MB 的完整图像（假设位图配置为）。这是一种根据目标宽度和高度计算样本大小值的方法，该值是 2 的幂：`true``BitmapFactory.Options``inSampleSize``ARGB_8888`

```
public static int calculateInSampleSize(
        BitmapFactory.Options options, int reqWidth, int reqHeight) {
    // Raw height and width of image
    final int height = options.outHeight;
    final int width = options.outWidth;
    int inSampleSize = 1;

    if (height > reqHeight || width > reqWidth) {

        final int halfHeight = height / 2;
        final int halfWidth = width / 2;

        // Calculate the largest inSampleSize value that is a power of 2 and keeps both
        // height and width larger than the requested height and width.
        while ((halfHeight / inSampleSize) > reqHeight
                && (halfWidth / inSampleSize) > reqWidth) {
            inSampleSize *= 2;
        }
    }

    return inSampleSize;
} 
```

> **注意**：根据 `inSampleSize`文档，计算二值的幂是因为解码器通过向下舍入到最接近的二的幂来使用最终值。

要使用此方法，首先解码`inJustDecodeBounds`设置为`true, pass the options through and then decode again using the new` inSampleSize `value and`inJustDecodeBounds `set to`false`：

```
public static Bitmap decodeSampledBitmapFromResource(Resources res, int resId,
    int reqWidth, int reqHeight) {

    // First decode with inJustDecodeBounds=true to check dimensions
    final BitmapFactory.Options options = new BitmapFactory.Options();
    options.inJustDecodeBounds = true;
    BitmapFactory.decodeResource(res, resId, options);

    // Calculate inSampleSize
    options.inSampleSize = calculateInSampleSize(options, reqWidth, reqHeight);

    // Decode bitmap with inSampleSize set
    options.inJustDecodeBounds = false;
    return BitmapFactory.decodeResource(res, resId, options);
} 
```

此方法可以轻松地将任意大尺寸的位图加载到`ImageView`显示 100x100 像素缩略图的图像中，如以下示例代码所示：

```
mImageView.setImageBitmap(
    decodeSampledBitmapFromResource(getResources(), R.id.myimage, 100, 100)); 
```

您可以按照类似的过程来解码来自其他来源的位图，`BitmapFactory.decode*`方法是根据需要替换适当的方法。

* * *

## 回答 #3

> 赞同：379
> 
> 时间：2010-08-23T15:25:32.137

我对 Fedor 的代码做了一个小的改进。它基本上做同样的事情，但没有（在我看来）丑陋的 while 循环，它总是产生 2 的幂。感谢 Fedor 提出最初的解决方案，我一直被困住，直到找到他的解决方案，然后我才能做到这一点 :)

```
 private Bitmap decodeFile(File f){
    Bitmap b = null;

        //Decode image size
    BitmapFactory.Options o = new BitmapFactory.Options();
    o.inJustDecodeBounds = true;

    FileInputStream fis = new FileInputStream(f);
    BitmapFactory.decodeStream(fis, null, o);
    fis.close();

    int scale = 1;
    if (o.outHeight > IMAGE_MAX_SIZE || o.outWidth > IMAGE_MAX_SIZE) {
        scale = (int)Math.pow(2, (int) Math.ceil(Math.log(IMAGE_MAX_SIZE / 
           (double) Math.max(o.outHeight, o.outWidth)) / Math.log(0.5)));
    }

    //Decode with inSampleSize
    BitmapFactory.Options o2 = new BitmapFactory.Options();
    o2.inSampleSize = scale;
    fis = new FileInputStream(f);
    b = BitmapFactory.decodeStream(fis, null, o2);
    fis.close();

    return b;
} 
```

* * *

## 回答 #4

> 赞同：237
> 
> 时间：2011-12-15T22:52:23.267

我来自 iOS 经验，我很沮丧地发现加载和显示图像这样基本的问题。毕竟，遇到此问题的每个人都在尝试显示尺寸合理的图像。无论如何，这是解决我的问题的两个更改（并使我的应用程序非常敏感）。

1）每次执行时`BitmapFactory.decodeXYZ()`，请确保传入一个`BitmapFactory.Options`with `inPurgeable`set to `true`（最好`inInputShareable`也设置为`true`）。

2) 永远不要使用`Bitmap.createBitmap(width, height, Config.ARGB_8888)`. 我的意思是从不！几次通过后，我从来没有遇到过不会引发内存错误的事情。没有任何帮助`recycle()`。`System.gc()`它总是引发异常。实际可行的另一种方法是在您的可绘制对象（或您使用上面的步骤 1 解码的另一个位图）中有一个虚拟图像，将其重新缩放为您想要的任何内容，然后操作生成的位图（例如将其传递给 Canvas为了更多的乐趣）。所以，你应该改用的是：`Bitmap.createScaledBitmap(srcBitmap, width, height, false)`. 如果出于某种原因您必须使用蛮力创建方法，那么至少要通过`Config.ARGB_4444`.

这几乎可以保证为您节省数小时甚至数天。所有关于缩放图像等的讨论并没有真正起作用（除非您认为尺寸错误或图像质量下降是一种解决方案）。

* * *

## 回答 #5

> 赞同：96
> 
> 时间：2011-05-24T20:17:04.343

这是一个[已知的错误](http://code.google.com/p/android/issues/detail?id=8488)，不是因为大文件。由于 Android 会缓存 Drawable，因此在使用少量图像后会出现内存不足。但我找到了另一种方法，跳过android默认缓存系统。

**解决方案**：将图像移动到“assets”文件夹并使用以下函数获取 BitmapDrawable：

```
public static Drawable getAssetImage(Context context, String filename) throws IOException {
    AssetManager assets = context.getResources().getAssets();
    InputStream buffer = new BufferedInputStream((assets.open("drawable/" + filename + ".png")));
    Bitmap bitmap = BitmapFactory.decodeStream(buffer);
    return new BitmapDrawable(context.getResources(), bitmap);
} 
```

* * *

## 回答 #6

> 赞同：82
> 
> 时间：2011-08-19T01:55:38.447

我遇到了同样的问题并通过避免使用 BitmapFactory.decodeStream 或 decodeFile 函数来解决它，而是使用`BitmapFactory.decodeFileDescriptor`

`decodeFileDescriptor`看起来它调用了与 decodeStream/decodeFile 不同的本机方法。

无论如何，这是有效的（请注意，我添加了一些上面的选项，但这并不是造成差异的原因。关键是调用**BitmapFactory.decodeFileDescriptor**而不是**decodeStream**或**decodeFile**）：

```
private void showImage(String path)   {

    Log.i("showImage","loading:"+path);
    BitmapFactory.Options bfOptions=new BitmapFactory.Options();
    bfOptions.inDither=false;                     //Disable Dithering mode
    bfOptions.inPurgeable=true;                   //Tell to gc that whether it needs free memory, the Bitmap can be cleared
    bfOptions.inInputShareable=true;              //Which kind of reference will be used to recover the Bitmap data after being clear, when it will be used in the future
    bfOptions.inTempStorage=new byte[32 * 1024]; 

    File file=new File(path);
    FileInputStream fs=null;
    try {
        fs = new FileInputStream(file);
    } catch (FileNotFoundException e) {
        //TODO do something intelligent
        e.printStackTrace();
    }

    try {
        if(fs!=null) bm=BitmapFactory.decodeFileDescriptor(fs.getFD(), null, bfOptions);
    } catch (IOException e) {
        //TODO do something intelligent
        e.printStackTrace();
    } finally{ 
        if(fs!=null) {
            try {
                fs.close();
            } catch (IOException e) {
                // TODO Auto-generated catch block
                e.printStackTrace();
            }
        }
    }
    //bm=BitmapFactory.decodeFile(path, bfOptions); This one causes error: java.lang.OutOfMemoryError: bitmap size exceeds VM budget

    im.setImageBitmap(bm);
    //bm.recycle();
    bm=null;                        
} 
```

我认为 decodeStream/decodeFile 中使用的本机函数存在问题。我已经确认使用 decodeFileDescriptor 时调用了不同的本机方法。另外我读到的是“图像（位图）不是以标准 Java 方式分配的，而是通过本机调用分配的；分配是在虚拟堆之外完成的，但要 ***计入它！*** ”

* * *

## 回答 #7

> 赞同：74
> 
> 时间：2012-12-01T03:50:37.753

我认为避免这种情况的最好方法`OutOfMemoryError`是面对它并理解它。

我制作了一个[应用程序](https://play.google.com/store/apps/details?id=net.coocood.oomresearch)来故意导致`OutOfMemoryError`并监控内存使用情况。

在我对这个App做了很多实验之后，我得到了以下结论：

我先说一下 Honey Comb 之前的 SDK 版本。

1.  位图存储在本机堆中，但它会自动收集垃圾，无需调用 recycle()。

2.  如果 {VM heap size} + {allocated native heap memory} >= {VM heap size limit for the device}，并且您正在尝试创建位图，则会抛出 OOM。

    注意：计算 VM HEAP SIZE 而不是 VM ALLOCATED MEMORY。

3.  虚拟机堆大小在增长后永远不会缩小，即使分配的虚拟机内存缩小了。

4.  因此，您必须将峰值 VM 内存保持在尽可能低的水平，以防止 VM 堆大小变得太大而无法为位图节省可用内存。

5.  手动调用 System.gc() 是没有意义的，系统会在尝试增加堆大小之前先调用它。

6.  Native Heap Size 也永远不会缩小，但不计入 OOM，因此无需担心。

那么，我们来说说 SDK 从 Honey Comb 开始。

1.  位图存储在 VM 堆中，不计入 OOM 的本机内存。

2.  OOM 的条件要简单得多：{VM heap size} >= {VM heap size limit for the device}。

3.  所以你有更多的可用内存来创建具有相同堆大小限制的位图，OOM 不太可能被抛出。

这是我对垃圾收集和内存泄漏的一些观察。

您可以在应用程序中自己查看。如果 Activity 执行了在 Activity 销毁后仍在运行的 AsyncTask，则在 AsyncTask 完成之前，Activity 不会被垃圾收集。

这是因为 AsyncTask 是一个匿名内部类的实例，它持有 Activity 的引用。

如果任务在后台线程的 IO 操作中被阻塞，则调用 AsyncTask.cancel(true) 不会停止执行。

回调也是匿名的内部类，所以如果你的项目中的一个静态实例持有它们而不释放它们，内存就会泄漏。

如果您安排了重复或延迟的任务，例如 Timer，并且您没有在 onPause() 中调用 cancel() 和 purge()，则内存将会泄漏。

* * *

## 回答 #8

> 赞同：67
> 
> 时间：2012-08-24T10:32:15.710

最近看到很多关于OOM异常和缓存的问题。开发人员指南对此有[一篇非常好的文章](http://developer.android.com/training/displaying-bitmaps/cache-bitmap.html)，但有些人往往无法以合适的方式实现它。

因此，我编写了一个示例应用程序来演示 Android 环境中的缓存。此实现尚未获得 OOM。

查看此答案的末尾以获取指向源代码的链接。

## 要求：

*   Android API 2.1 或更高版本（我根本无法在 API 1.6 中为应用程序获取可用内存 - 这是唯一在 API 1.6 中不起作用的代码）
*   [安卓支持包](http://developer.android.com/tools/extras/support-library.html)

![截屏](https://i.stack.imgur.com/cjk99.png)

## 特征：

*   *如果方向发生变化，则保留缓存*，使用单例
*   将分配的应用程序内存的*八分*之一用于缓存（根据需要进行修改）
*   大位图*被缩放*（您可以定义要允许的最大像素）
*   在下载位图之前控制*是否有可用的 Internet 连接*
*   确保每行只实例化*一个任务*
*   如果*您要*扔掉`ListView`，它根本不会下载之间的位图

## 这不包括：

*   磁盘缓存。无论如何，这应该很容易实现 - 只需指向一个从磁盘中获取位图的不同任务

## 示例代码：

正在下载的图像是来自 Flickr 的图像 (75x75)。但是，放置您想要处理的任何图像 url，如果超过最大值，应用程序将缩小它。在这个应用程序中，url 只是在一个`String`数组中。

有一个很好的[`LruCache`](http://developer.android.com/reference/android/util/LruCache.html)方法来处理位图。然而，在这个应用程序中，我将一个实例`LruCache`放在我创建的另一个缓存类中，以使应用程序更可行。

Cache.java的关键东西（`loadBitmap()`方法最重要）：

```
public Cache(int size, int maxWidth, int maxHeight) {
    // Into the constructor you add the maximum pixels
    // that you want to allow in order to not scale images.
    mMaxWidth = maxWidth;
    mMaxHeight = maxHeight;

    mBitmapCache = new LruCache<String, Bitmap>(size) {
        protected int sizeOf(String key, Bitmap b) {
            // Assuming that one pixel contains four bytes.
            return b.getHeight() * b.getWidth() * 4;
        }
    };

    mCurrentTasks = new ArrayList<String>();    
}

/**
 * Gets a bitmap from cache. 
 * If it is not in cache, this method will:
 * 
 * 1: check if the bitmap url is currently being processed in the
 * BitmapLoaderTask and cancel if it is already in a task (a control to see
 * if it's inside the currentTasks list).
 * 
 * 2: check if an internet connection is available and continue if so.
 * 
 * 3: download the bitmap, scale the bitmap if necessary and put it into
 * the memory cache.
 * 
 * 4: Remove the bitmap url from the currentTasks list.
 * 
 * 5: Notify the ListAdapter.
 * 
 * @param mainActivity - Reference to activity object, in order to
 * call notifyDataSetChanged() on the ListAdapter.
 * @param imageKey - The bitmap url (will be the key).
 * @param imageView - The ImageView that should get an
 * available bitmap or a placeholder image.
 * @param isScrolling - If set to true, we skip executing more tasks since
 * the user probably has flinged away the view.
 */
public void loadBitmap(MainActivity mainActivity, 
        String imageKey, ImageView imageView,
        boolean isScrolling) {
    final Bitmap bitmap = getBitmapFromCache(imageKey); 

    if (bitmap != null) {
        imageView.setImageBitmap(bitmap);
    } else {
        imageView.setImageResource(R.drawable.ic_launcher);
        if (!isScrolling && !mCurrentTasks.contains(imageKey) && 
                mainActivity.internetIsAvailable()) {
            BitmapLoaderTask task = new BitmapLoaderTask(imageKey,
                    mainActivity.getAdapter());
            task.execute();
        }
    } 
} 
```

除非您想实现磁盘缓存，否则您不需要编辑 Cache.java 文件中的任何内容。

MainActivity.java 的关键内容：

```
public void onScrollStateChanged(AbsListView view, int scrollState) {
    if (view.getId() == android.R.id.list) {
        // Set scrolling to true only if the user has flinged the       
        // ListView away, hence we skip downloading a series
        // of unnecessary bitmaps that the user probably
        // just want to skip anyways. If we scroll slowly it
        // will still download bitmaps - that means
        // that the application won't wait for the user
        // to lift its finger off the screen in order to
        // download.
        if (scrollState == SCROLL_STATE_FLING) {
            mIsScrolling = true;
        } else {
            mIsScrolling = false;
            mListAdapter.notifyDataSetChanged();
        }
    } 
}

// Inside ListAdapter...
@Override
public View getView(final int position, View convertView, ViewGroup parent) {           
    View row = convertView;
    final ViewHolder holder;

    if (row == null) {
        LayoutInflater inflater = getLayoutInflater();
        row = inflater.inflate(R.layout.main_listview_row, parent, false);  
        holder = new ViewHolder(row);
        row.setTag(holder);
    } else {
        holder = (ViewHolder) row.getTag();
    }   

    final Row rowObject = getItem(position);

    // Look at the loadBitmap() method description...
    holder.mTextView.setText(rowObject.mText);      
    mCache.loadBitmap(MainActivity.this,
            rowObject.mBitmapUrl, holder.mImageView,
            mIsScrolling);  

    return row;
} 
```

`getView()`经常被调用。如果我们没有实施检查以确保我们不会在每行启动无限数量的线程，那么在此处下载图像通常不是一个好主意。Cache.java 检查是否`rowObject.mBitmapUrl`已经在一个任务中，如果是，它不会启动另一个。因此，我们很可能不会超出`AsyncTask`池中的工作队列限制。

## 下载：

[您可以从https://www.dropbox.com/s/pvr9zyl811tfeem/ListViewImageCache.zip](https://www.dropbox.com/s/pvr9zyl811tfeem/ListViewImageCache.zip)下载源代码。

* * *

## 最后的话：

我已经测试了几个星期了，我还没有得到一个 OOM 异常。我已经在模拟器、Nexus One 和 Nexus S 上对此进行了测试。我已经测试了包含高清质量图像的图像 URL。唯一的瓶颈是下载需要更多时间。

只有一种可能的情况我可以想象会出现OOM，那就是如果我们下载许多非常大的图像，并且在它们被缩放并放入缓存之前，会同时占用更多内存并导致OOM。但这无论如何都不是一个理想的情况，而且很可能无法以更可行的方式解决。

在评论中报告错误！:-)

* * *

## 回答 #9

> 赞同：45
> 
> 时间：2009-02-16T06:23:31.773

我做了以下操作来拍摄图像并动态调整它的大小。希望这可以帮助

```
Bitmap bm;
bm = Bitmap.createScaledBitmap(BitmapFactory.decodeFile(filepath), 100, 100, true);
mPicture = new ImageView(context);
mPicture.setImageBitmap(bm); 
```

* * *

## 回答 #10

> 赞同：39
> 
> 时间：2015-05-19T05:51:36.970

**不幸**的是，如果上述方法均无效，请将其添加到您的**清单**文件中。内部*应用程序*标签

```
 <application
         android:largeHeap="true" 
```

* * *

## 回答 #11

> 赞同：36
> 
> 时间：2011-05-19T16:49:15.803

似乎这是一个长期存在的问题，有很多不同的解释。我在这里接受了两个最常见的答案的建议，但是这些都没有解决我的虚拟机问题，声称它无法负担执行**解码**部分的字节。经过一番挖掘，我了解到这里真正的问题是解码过程从**NATIVE**堆中取出。

见这里：[BitmapFactory OOM 让我抓狂](https://stackoverflow.com/questions/1955410/bitmapfactory-oom-driving-me-nuts/5493182#5493182)

这导致我进入另一个讨论线程，在那里我找到了更多解决这个问题的方法。`System.gc();`一种是在显示图像后手动调用。但这实际上会使您的应用程序使用更多内存，以减少本机堆。自 2.0 (Donut) 版本起，更好的解决方案是使用 BitmapFactory 选项“inPurgeable”。所以我`o2.inPurgeable=true;`只是在`o2.inSampleSize=scale;`.

更多关于该主题的信息：[内存堆的限制是否只有 6M？](http://groups.google.com/group/android-developers/browse_thread/thread/146a3a354ce3e8e3/61e113036089d696)

现在，说了这么多，我对 Java 和 Android 也是个十足的笨蛋。因此，如果您认为这是解决此问题的糟糕方法，那么您可能是对的。;-) 但这对我来说很神奇，我发现现在不可能在堆缓存之外运行虚拟机。我能找到的唯一缺点是您正在破坏缓存的绘制图像。这意味着如果你回到那个图像，你每次都在重绘它。就我的应用程序的工作方式而言，这并不是一个真正的问题。你的旅费可能会改变。

* * *

## 回答 #12

> 赞同：34
> 
> 时间：2010-11-07T11:08:19.227

使用它`bitmap.recycle();`这有助于没有任何图像质量问题。

* * *

## 回答 #13

> 赞同：31
> 
> 时间：2011-06-04T09:44:58.510

我已经通过以下方式解决了同样的问题。

```
Bitmap b = null;
Drawable d;
ImageView i = new ImageView(mContext);
try {
    b = Bitmap.createBitmap(320,424,Bitmap.Config.RGB_565);
    b.eraseColor(0xFFFFFFFF);
    Rect r = new Rect(0, 0,320 , 424);
    Canvas c = new Canvas(b);
    Paint p = new Paint();
    p.setColor(0xFFC0C0C0);
    c.drawRect(r, p);
    d = mContext.getResources().getDrawable(mImageIds[position]);
    d.setBounds(r);
    d.draw(c);

    /*   
        BitmapFactory.Options o2 = new BitmapFactory.Options();
        o2.inTempStorage = new byte[128*1024];
        b = BitmapFactory.decodeStream(mContext.getResources().openRawResource(mImageIds[position]), null, o2);
        o2.inSampleSize=16;
        o2.inPurgeable = true;
    */
} catch (Exception e) {

}
i.setImageBitmap(b); 
```

* * *

## 回答 #14

> 赞同：30
> 
> 时间：2011-03-02T18:17:45.603

我有一个更有效的解决方案，不需要任何形式的缩放。只需将位图解码一次，然后根据其名称将其缓存在地图中。然后只需根据名称检索位图并将其设置在 ImageView 中。没有什么需要做的了。

这将起作用，因为解码位图的实际二进制数据未存储在 dalvik VM 堆中。它存储在外部。因此，每次解码位图时，它都会在 VM 堆之外分配内存，而 GC 永远不会回收这些内存

为了帮助您更好地理解这一点，假设您已将您的图像保存在可绘制文件夹中。您只需通过执行 getResources().getDrwable(R.drawable.) 来获取图像。这不会每次都解码您的图像，而是在您每次调用它时重新使用已解码的实例。所以本质上它是被缓存的。

现在，由于您的图像在某个文件中（或者甚至可能来自外部服务器），因此您有责任缓存解码的位图实例，以便在需要的任何地方重复使用。

希望这可以帮助。

* * *

## 回答 #15

> 赞同：29
> 
> 时间：2011-05-12T04:40:43.797

这里有两个问题......

*   位图内存不在 VM 堆中，而是在本机堆中 - 请参阅[BitmapFactory OOM 让我发疯](https://stackoverflow.com/questions/1955410/bitmapfactory-oom-driving-me-nuts/5493182#5493182)
*   本机堆的垃圾收集比 VM 堆更懒惰 - 因此每次通过 Activity 的 onPause 或 onDestroy 时，您需要非常积极地执行 bitmap.recycle 和 bitmap =null

* * *

## 回答 #16

> 赞同：29
> 
> 时间：2012-06-09T20:33:32.800

这对我有用！

```
public Bitmap readAssetsBitmap(String filename) throws IOException {
    try {
        BitmapFactory.Options options = new BitmapFactory.Options(); 
        options.inPurgeable = true;
        Bitmap bitmap = BitmapFactory.decodeStream(assets.open(filename), null, options);
        if(bitmap == null) {
            throw new IOException("File cannot be opened: It's value is null");
        } else {
            return bitmap;
        }
    } catch (IOException e) {
        throw new IOException("File cannot be opened: " + e.getMessage());
    }
} 
```

* * *

## 回答 #17

> 赞同：22
> 
> 时间：2013-02-03T15:03:02.763

这里的答案很好，但我想要一个**完全可用的类**来解决这个问题。所以我做了一个。

这是我的**BitmapHelper 类**，它是 OutOfMemoryError 证明:-)

```
import java.io.File;
import java.io.FileInputStream;

import android.graphics.Bitmap;
import android.graphics.Bitmap.Config;
import android.graphics.BitmapFactory;
import android.graphics.Canvas;
import android.graphics.Matrix;
import android.graphics.drawable.BitmapDrawable;
import android.graphics.drawable.Drawable;

public class BitmapHelper
{

    //decodes image and scales it to reduce memory consumption
    public static Bitmap decodeFile(File bitmapFile, int requiredWidth, int requiredHeight, boolean quickAndDirty)
    {
        try
        {
            //Decode image size
            BitmapFactory.Options bitmapSizeOptions = new BitmapFactory.Options();
            bitmapSizeOptions.inJustDecodeBounds = true;
            BitmapFactory.decodeStream(new FileInputStream(bitmapFile), null, bitmapSizeOptions);

            // load image using inSampleSize adapted to required image size
            BitmapFactory.Options bitmapDecodeOptions = new BitmapFactory.Options();
            bitmapDecodeOptions.inTempStorage = new byte[16 * 1024];
            bitmapDecodeOptions.inSampleSize = computeInSampleSize(bitmapSizeOptions, requiredWidth, requiredHeight, false);
            bitmapDecodeOptions.inPurgeable = true;
            bitmapDecodeOptions.inDither = !quickAndDirty;
            bitmapDecodeOptions.inPreferredConfig = quickAndDirty ? Bitmap.Config.RGB_565 : Bitmap.Config.ARGB_8888;

            Bitmap decodedBitmap = BitmapFactory.decodeStream(new FileInputStream(bitmapFile), null, bitmapDecodeOptions);

            // scale bitmap to mathc required size (and keep aspect ratio)

            float srcWidth = (float) bitmapDecodeOptions.outWidth;
            float srcHeight = (float) bitmapDecodeOptions.outHeight;

            float dstWidth = (float) requiredWidth;
            float dstHeight = (float) requiredHeight;

            float srcAspectRatio = srcWidth / srcHeight;
            float dstAspectRatio = dstWidth / dstHeight;

            // recycleDecodedBitmap is used to know if we must recycle intermediary 'decodedBitmap'
            // (DO NOT recycle it right away: wait for end of bitmap manipulation process to avoid
            // java.lang.RuntimeException: Canvas: trying to use a recycled bitmap android.graphics.Bitmap@416ee7d8
            // I do not excatly understand why, but this way it's OK

            boolean recycleDecodedBitmap = false;

            Bitmap scaledBitmap = decodedBitmap;
            if (srcAspectRatio < dstAspectRatio)
            {
                scaledBitmap = getScaledBitmap(decodedBitmap, (int) dstWidth, (int) (srcHeight * (dstWidth / srcWidth)));
                // will recycle recycleDecodedBitmap
                recycleDecodedBitmap = true;
            }
            else if (srcAspectRatio > dstAspectRatio)
            {
                scaledBitmap = getScaledBitmap(decodedBitmap, (int) (srcWidth * (dstHeight / srcHeight)), (int) dstHeight);
                recycleDecodedBitmap = true;
            }

            // crop image to match required image size

            int scaledBitmapWidth = scaledBitmap.getWidth();
            int scaledBitmapHeight = scaledBitmap.getHeight();

            Bitmap croppedBitmap = scaledBitmap;

            if (scaledBitmapWidth > requiredWidth)
            {
                int xOffset = (scaledBitmapWidth - requiredWidth) / 2;
                croppedBitmap = Bitmap.createBitmap(scaledBitmap, xOffset, 0, requiredWidth, requiredHeight);
                scaledBitmap.recycle();
            }
            else if (scaledBitmapHeight > requiredHeight)
            {
                int yOffset = (scaledBitmapHeight - requiredHeight) / 2;
                croppedBitmap = Bitmap.createBitmap(scaledBitmap, 0, yOffset, requiredWidth, requiredHeight);
                scaledBitmap.recycle();
            }

            if (recycleDecodedBitmap)
            {
                decodedBitmap.recycle();
            }
            decodedBitmap = null;

            scaledBitmap = null;
            return croppedBitmap;
        }
        catch (Exception ex)
        {
            ex.printStackTrace();
        }
        return null;
    }

    /**
     * compute powerOf2 or exact scale to be used as {@link BitmapFactory.Options#inSampleSize} value (for subSampling)
     * 
     * @param requiredWidth
     * @param requiredHeight
     * @param powerOf2
     *            weither we want a power of 2 sclae or not
     * @return
     */
    public static int computeInSampleSize(BitmapFactory.Options options, int dstWidth, int dstHeight, boolean powerOf2)
    {
        int inSampleSize = 1;

        // Raw height and width of image
        final int srcHeight = options.outHeight;
        final int srcWidth = options.outWidth;

        if (powerOf2)
        {
            //Find the correct scale value. It should be the power of 2.

            int tmpWidth = srcWidth, tmpHeight = srcHeight;
            while (true)
            {
                if (tmpWidth / 2 < dstWidth || tmpHeight / 2 < dstHeight)
                    break;
                tmpWidth /= 2;
                tmpHeight /= 2;
                inSampleSize *= 2;
            }
        }
        else
        {
            // Calculate ratios of height and width to requested height and width
            final int heightRatio = Math.round((float) srcHeight / (float) dstHeight);
            final int widthRatio = Math.round((float) srcWidth / (float) dstWidth);

            // Choose the smallest ratio as inSampleSize value, this will guarantee
            // a final image with both dimensions larger than or equal to the
            // requested height and width.
            inSampleSize = heightRatio < widthRatio ? heightRatio : widthRatio;
        }

        return inSampleSize;
    }

    public static Bitmap drawableToBitmap(Drawable drawable)
    {
        if (drawable instanceof BitmapDrawable)
        {
            return ((BitmapDrawable) drawable).getBitmap();
        }

        Bitmap bitmap = Bitmap.createBitmap(drawable.getIntrinsicWidth(), drawable.getIntrinsicHeight(), Config.ARGB_8888);
        Canvas canvas = new Canvas(bitmap);
        drawable.setBounds(0, 0, canvas.getWidth(), canvas.getHeight());
        drawable.draw(canvas);

        return bitmap;
    }

    public static Bitmap getScaledBitmap(Bitmap bitmap, int newWidth, int newHeight)
    {
        int width = bitmap.getWidth();
        int height = bitmap.getHeight();
        float scaleWidth = ((float) newWidth) / width;
        float scaleHeight = ((float) newHeight) / height;

        // CREATE A MATRIX FOR THE MANIPULATION
        Matrix matrix = new Matrix();
        // RESIZE THE BIT MAP
        matrix.postScale(scaleWidth, scaleHeight);

        // RECREATE THE NEW BITMAP
        Bitmap resizedBitmap = Bitmap.createBitmap(bitmap, 0, 0, width, height, matrix, false);
        return resizedBitmap;
    }

} 
```

* * *

## 回答 #18

> 赞同：21
> 
> 时间：2011-12-07T12:32:34.477

上面的答案都不适合我，但我确实想出了一个非常丑陋的解决方法来解决这个问题。我在我的项目中添加了一个非常小的 1x1 像素图像作为资源，并在调用垃圾收集之前将其加载到我的 ImageView 中。我认为可能是 ImageView 没有释放 Bitmap，所以 GC 从来没有把它捡起来。这很丑陋，但它现在似乎正在工作。

```
if (bitmap != null)
{
  bitmap.recycle();
  bitmap = null;
}
if (imageView != null)
{
  imageView.setImageResource(R.drawable.tiny); // This is my 1x1 png.
}
System.gc();

imageView.setImageBitmap(...); // Do whatever you need to do to load the image you want. 
```

* * *

## 回答 #19

> 赞同：20
> 
> 时间：2012-10-02T10:33:28.687

这对我有用。

```
Bitmap myBitmap;

BitmapFactory.Options options = new BitmapFactory.Options(); 
options.InPurgeable = true;
options.OutHeight = 50;
options.OutWidth = 50;
options.InSampleSize = 4;

File imgFile = new File(filepath);
myBitmap = BitmapFactory.DecodeFile(imgFile.AbsolutePath, options); 
```

这是在 C# monodroid 上。您可以轻松更改图像的路径。这里重要的是要设置的选项。

* * *

## 回答 #20

> 赞同：17
> 
> 时间：2012-11-02T23:41:44.470

这似乎是与社区分享我的用于加载和处理图像的实用程序类的合适地方，欢迎您使用它并自由修改它。

```
package com.emil;

import java.io.IOException;
import java.io.InputStream;

import android.graphics.Bitmap;
import android.graphics.BitmapFactory;

/**
 * A class to load and process images of various sizes from input streams and file paths.
 * 
 * @author Emil http://stackoverflow.com/users/220710/emil
 *
 */
public class ImageProcessing {

    public static Bitmap getBitmap(InputStream stream, int sampleSize, Bitmap.Config bitmapConfig) throws IOException{
        BitmapFactory.Options options=ImageProcessing.getOptionsForSampling(sampleSize, bitmapConfig);
        Bitmap bm = BitmapFactory.decodeStream(stream,null,options);
        if(ImageProcessing.checkDecode(options)){
            return bm;
        }else{
            throw new IOException("Image decoding failed, using stream.");
        }
    }

    public static Bitmap getBitmap(String imgPath, int sampleSize, Bitmap.Config bitmapConfig) throws IOException{
        BitmapFactory.Options options=ImageProcessing.getOptionsForSampling(sampleSize, bitmapConfig);
        Bitmap bm = BitmapFactory.decodeFile(imgPath,options);
        if(ImageProcessing.checkDecode(options)){
            return bm;
        }else{
            throw new IOException("Image decoding failed, using file path.");
        }
    }

    public static Dimensions getDimensions(InputStream stream) throws IOException{
        BitmapFactory.Options options=ImageProcessing.getOptionsForDimensions();
        BitmapFactory.decodeStream(stream,null,options);
        if(ImageProcessing.checkDecode(options)){
            return new ImageProcessing.Dimensions(options.outWidth,options.outHeight);
        }else{
            throw new IOException("Image decoding failed, using stream.");
        }
    }

    public static Dimensions getDimensions(String imgPath) throws IOException{
        BitmapFactory.Options options=ImageProcessing.getOptionsForDimensions();
        BitmapFactory.decodeFile(imgPath,options);
        if(ImageProcessing.checkDecode(options)){
            return new ImageProcessing.Dimensions(options.outWidth,options.outHeight);
        }else{
            throw new IOException("Image decoding failed, using file path.");
        }
    }

    private static boolean checkDecode(BitmapFactory.Options options){
        // Did decode work?
        if( options.outWidth<0 || options.outHeight<0 ){
            return false;
        }else{
            return true;
        }
    }

    /**
     * Creates a Bitmap that is of the minimum dimensions necessary
     * @param bm
     * @param min
     * @return
     */
    public static Bitmap createMinimalBitmap(Bitmap bm, ImageProcessing.Minimize min){
        int newWidth, newHeight;
        switch(min.type){
        case WIDTH:
            if(bm.getWidth()>min.minWidth){
                newWidth=min.minWidth;
                newHeight=ImageProcessing.getScaledHeight(newWidth, bm);
            }else{
                // No resize
                newWidth=bm.getWidth();
                newHeight=bm.getHeight();
            }
            break;
        case HEIGHT:
            if(bm.getHeight()>min.minHeight){
                newHeight=min.minHeight;
                newWidth=ImageProcessing.getScaledWidth(newHeight, bm);
            }else{
                // No resize
                newWidth=bm.getWidth();
                newHeight=bm.getHeight();
            }
            break;
        case BOTH: // minimize to the maximum dimension
        case MAX:
            if(bm.getHeight()>bm.getWidth()){
                // Height needs to minimized
                min.minDim=min.minDim!=null ? min.minDim : min.minHeight;
                if(bm.getHeight()>min.minDim){
                    newHeight=min.minDim;
                    newWidth=ImageProcessing.getScaledWidth(newHeight, bm);
                }else{
                    // No resize
                    newWidth=bm.getWidth();
                    newHeight=bm.getHeight();
                }
            }else{
                // Width needs to be minimized
                min.minDim=min.minDim!=null ? min.minDim : min.minWidth;
                if(bm.getWidth()>min.minDim){
                    newWidth=min.minDim;
                    newHeight=ImageProcessing.getScaledHeight(newWidth, bm);
                }else{
                    // No resize
                    newWidth=bm.getWidth();
                    newHeight=bm.getHeight();
                }
            }
            break;
        default:
            // No resize
            newWidth=bm.getWidth();
            newHeight=bm.getHeight();
        }
        return Bitmap.createScaledBitmap(bm, newWidth, newHeight, true);
    }

    public static int getScaledWidth(int height, Bitmap bm){
        return (int)(((double)bm.getWidth()/bm.getHeight())*height);
    }

    public static int getScaledHeight(int width, Bitmap bm){
        return (int)(((double)bm.getHeight()/bm.getWidth())*width);
    }

    /**
     * Get the proper sample size to meet minimization restraints
     * @param dim
     * @param min
     * @param multipleOf2 for fastest processing it is recommended that the sample size be a multiple of 2
     * @return
     */
    public static int getSampleSize(ImageProcessing.Dimensions dim, ImageProcessing.Minimize min, boolean multipleOf2){
        switch(min.type){
        case WIDTH:
            return ImageProcessing.getMaxSampleSize(dim.width, min.minWidth, multipleOf2);
        case HEIGHT:
            return ImageProcessing.getMaxSampleSize(dim.height, min.minHeight, multipleOf2);
        case BOTH:
            int widthMaxSampleSize=ImageProcessing.getMaxSampleSize(dim.width, min.minWidth, multipleOf2);
            int heightMaxSampleSize=ImageProcessing.getMaxSampleSize(dim.height, min.minHeight, multipleOf2);
            // Return the smaller of the two
            if(widthMaxSampleSize<heightMaxSampleSize){
                return widthMaxSampleSize;
            }else{
                return heightMaxSampleSize;
            }
        case MAX:
            // Find the larger dimension and go bases on that
            if(dim.width>dim.height){
                return ImageProcessing.getMaxSampleSize(dim.width, min.minDim, multipleOf2);
            }else{
                return ImageProcessing.getMaxSampleSize(dim.height, min.minDim, multipleOf2);
            }
        }
        return 1;
    }

    public static int getMaxSampleSize(int dim, int min, boolean multipleOf2){
        int add=multipleOf2 ? 2 : 1;
        int size=0;
        while(min<(dim/(size+add))){
            size+=add;
        }
        size = size==0 ? 1 : size;
        return size;        
    }

    public static class Dimensions {
        int width;
        int height;

        public Dimensions(int width, int height) {
            super();
            this.width = width;
            this.height = height;
        }

        @Override
        public String toString() {
            return width+" x "+height;
        }
    }

    public static class Minimize {
        public enum Type {
            WIDTH,HEIGHT,BOTH,MAX
        }
        Integer minWidth;
        Integer minHeight;
        Integer minDim;
        Type type;

        public Minimize(int min, Type type) {
            super();
            this.type = type;
            switch(type){
            case WIDTH:
                this.minWidth=min;
                break;
            case HEIGHT:
                this.minHeight=min;
                break;
            case BOTH:
                this.minWidth=min;
                this.minHeight=min;
                break;
            case MAX:
                this.minDim=min;
                break;
            }
        }

        public Minimize(int minWidth, int minHeight) {
            super();
            this.type=Type.BOTH;
            this.minWidth = minWidth;
            this.minHeight = minHeight;
        }

    }

    /**
     * Estimates size of Bitmap in bytes depending on dimensions and Bitmap.Config
     * @param width
     * @param height
     * @param config
     * @return
     */
    public static long estimateBitmapBytes(int width, int height, Bitmap.Config config){
        long pixels=width*height;
        switch(config){
        case ALPHA_8: // 1 byte per pixel
            return pixels;
        case ARGB_4444: // 2 bytes per pixel, but depreciated
            return pixels*2;
        case ARGB_8888: // 4 bytes per pixel
            return pixels*4;
        case RGB_565: // 2 bytes per pixel
            return pixels*2;
        default:
            return pixels;
        }
    }

    private static BitmapFactory.Options getOptionsForDimensions(){
        BitmapFactory.Options options = new BitmapFactory.Options();
        options.inJustDecodeBounds=true;
        return options;
    }

    private static BitmapFactory.Options getOptionsForSampling(int sampleSize, Bitmap.Config bitmapConfig){
        BitmapFactory.Options options = new BitmapFactory.Options();
        options.inJustDecodeBounds = false;
        options.inDither = false;
        options.inSampleSize = sampleSize;
        options.inScaled = false;
        options.inPreferredConfig = bitmapConfig;
        return options;
    }
} 
```

* * *

## 回答 #21

> 赞同：17
> 
> 时间：2013-02-06T14:53:59.943

在我的一个应用程序中，我需要从`Camera/Gallery`. 如果用户单击相机中的图像（可能是 2MP、5MP 或 8MP），图像大小从`kB`s 到`MB`s 不等。如果图像大小小于（或高达 1-2MB）以上代码工作正常但如果我的图像大小超过 4MB 或 5MB 则`OOM`进入帧:(

然后我一直在努力解决这个问题，最后我对 Fedor 的代码进行了以下改进（感谢 Fedor 做出了如此好的解决方案）代码 :)

```
private Bitmap decodeFile(String fPath) {
    // Decode image size
    BitmapFactory.Options opts = new BitmapFactory.Options();
    /*
     * If set to true, the decoder will return null (no bitmap), but the
     * out... fields will still be set, allowing the caller to query the
     * bitmap without having to allocate the memory for its pixels.
     */
    opts.inJustDecodeBounds = true;
    opts.inDither = false; // Disable Dithering mode
    opts.inPurgeable = true; // Tell to gc that whether it needs free
                                // memory, the Bitmap can be cleared
    opts.inInputShareable = true; // Which kind of reference will be used to
                                    // recover the Bitmap data after being
                                    // clear, when it will be used in the
                                    // future

    BitmapFactory.decodeFile(fPath, opts);

    // The new size we want to scale to
    final int REQUIRED_SIZE = 70;

    // Find the correct scale value. 
    int scale = 1;

    if (opts.outHeight > REQUIRED_SIZE || opts.outWidth > REQUIRED_SIZE) {

        // Calculate ratios of height and width to requested height and width
        final int heightRatio = Math.round((float) opts.outHeight
                / (float) REQUIRED_SIZE);
        final int widthRatio = Math.round((float) opts.outWidth
                / (float) REQUIRED_SIZE);

        // Choose the smallest ratio as inSampleSize value, this will guarantee
        // a final image with both dimensions larger than or equal to the
        // requested height and width.
        scale = heightRatio < widthRatio ? heightRatio : widthRatio;//
    }

    // Decode bitmap with inSampleSize set
    opts.inJustDecodeBounds = false;

    opts.inSampleSize = scale;

    Bitmap bm = BitmapFactory.decodeFile(fPath, opts).copy(
            Bitmap.Config.RGB_565, false);

    return bm;

} 
```

希望对遇到同样问题的小伙伴有所帮助！

有关更多信息，请参阅[*此*](http://developer.android.com/training/displaying-bitmaps/load-bitmap.html)

* * *

## 回答 #22

> 赞同：15
> 
> 时间：2012-02-24T19:08:16.383

几分钟前我刚刚遇到了这个问题。我通过更好地管理我的 listview 适配器解决了这个问题。我认为这是我使用的数百个 50x50px 图像的问题，结果我试图在每次显示该行时放大我的自定义视图。只需通过测试来查看该行是否被夸大，我就消除了这个错误，并且我使用了数百个位图。这实际上适用于 Spinner，但基本适配器对 ListView 的工作方式完全相同。这个简单的修复也大大提高了适配器的性能。

```
@Override
public View getView(final int position, View convertView, final ViewGroup parent) {

    if(convertView == null){
        LayoutInflater inflater = (LayoutInflater) mContext.getSystemService(Context.LAYOUT_INFLATER_SERVICE);
        convertView = inflater.inflate(R.layout.spinner_row, null);
    }
... 
```

* * *

## 回答 #23

> 赞同：15
> 
> 时间：2012-08-13T11:39:42.730

此问题仅发生在 Android 模拟器中。我在模拟器中也遇到了这个问题，但是当我签入设备时它工作正常。

所以请检查设备。它可以在设备中运行。

* * *

## 回答 #24

> 赞同：14
> 
> 时间：2012-03-27T19:33:09.843

我花了一整天的时间测试这些解决方案，唯一对我有用的是上述获取图像和手动调用 GC 的方法，我知道这不应该是必要的，但它是唯一有效的方法当我将我的应用程序置于活动之间切换的重负载测试中时。我的应用程序在列表视图中有一个缩略图列表（假设活动 A），当您单击其中一个图像时，它会将您带到另一个活动（假设活动 B），该活动显示该项目的主图像。当我在两个活动之间来回切换时，我最终会收到 OOM 错误，并且应用程序会强制关闭。

当我到达列表视图的一半时，它会崩溃。

现在，当我在活动 B 中实现以下内容时，我可以毫无问题地浏览整个列表视图并继续前进……而且速度非常快。

```
@Override
public void onDestroy()
{   
    Cleanup();
    super.onDestroy();
}

private void Cleanup()
{    
    bitmap.recycle();
    System.gc();
    Runtime.getRuntime().gc();  
} 
```

* * *

## 回答 #25

> 赞同：14
> 
> 时间：2012-11-26T05:48:17.370

一般 android 设备堆大小只有 16MB（因​​设备/操作系统而异，请参阅帖子[堆大小](https://stackoverflow.com/a/9940415/1053097)），如果您正在加载图像并且超过 16MB 的大小，它将抛出内存异常，而不是使用 Bitmap 进行加载来自 SD 卡或资源甚至网络的图像尝试使用**getImageUri**，加载位图需要更多内存，或者如果您使用该位图完成工作，您可以将位图设置为空。

* * *

## 回答 #26

> 赞同：14
> 
> 时间：2013-08-31T03:04:47.633

这里的所有解决方案都需要设置 IMAGE_MAX_SIZE。这限制了具有更强大硬件的设备，如果图像尺寸太小，它在高清屏幕上看起来很难看。

我提出了一种适用于我的三星 Galaxy S3 和其他几款设备（包括功能较弱的设备）的解决方案，当使用功能更强大的设备时，图像质量会更好。

它的要点是计算在特定设备上为应用程序分配的最大内存，然后在不超过此内存的情况下将比例设置为尽可能低。这是代码：

```
public static Bitmap decodeFile(File f)
{
    Bitmap b = null;
    try
    {
        // Decode image size
        BitmapFactory.Options o = new BitmapFactory.Options();
        o.inJustDecodeBounds = true;

        FileInputStream fis = new FileInputStream(f);
        try
        {
            BitmapFactory.decodeStream(fis, null, o);
        }
        finally
        {
            fis.close();
        }

        // In Samsung Galaxy S3, typically max memory is 64mb
        // Camera max resolution is 3264 x 2448, times 4 to get Bitmap memory of 30.5mb for one bitmap
        // If we use scale of 2, resolution will be halved, 1632 x 1224 and x 4 to get Bitmap memory of 7.62mb
        // We try use 25% memory which equals to 16mb maximum for one bitmap
        long maxMemory = Runtime.getRuntime().maxMemory();
        int maxMemoryForImage = (int) (maxMemory / 100 * 25);

        // Refer to
        // http://developer.android.com/training/displaying-bitmaps/cache-bitmap.html
        // A full screen GridView filled with images on a device with
        // 800x480 resolution would use around 1.5MB (800*480*4 bytes)
        // When bitmap option's inSampleSize doubled, pixel height and
        // weight both reduce in half
        int scale = 1;
        while ((o.outWidth / scale) * (o.outHeight / scale) * 4 > maxMemoryForImage)
        scale *= 2;

        // Decode with inSampleSize
        BitmapFactory.Options o2 = new BitmapFactory.Options();
        o2.inSampleSize = scale;
        fis = new FileInputStream(f);
        try
        {
            b = BitmapFactory.decodeStream(fis, null, o2);
        }
        finally
        {
            fis.close();
        }
    }
    catch (IOException e)
    {
    }
    return b;
} 
```

我将此位图使用的最大内存设置为最大分配内存的 25%，您可能需要根据自己的需要进行调整，并确保此位图已清理干净，并且在您完成使用后不会留在内存中。通常，我使用此代码执行图像旋转（源位图和目标位图），因此我的应用程序需要同时在内存中加载 2 个位图，并且 25% 为我提供了一个很好的缓冲区，而不会在执行图像旋转时耗尽内存。

希望这可以帮助那里的人..

* * *

## 回答 #27

> 赞同：14
> 
> 时间：2014-01-24T12:57:55.427

对从 SdCard 中选择的每个图像或可绘制的图像使用这些代码来转换位图对象。

```
Resources res = getResources();
WindowManager window = (WindowManager) getSystemService(Context.WINDOW_SERVICE);
Display display = window.getDefaultDisplay();
@SuppressWarnings("deprecation")
int width = display.getWidth();
@SuppressWarnings("deprecation")
int height = display.getHeight();
try {
    if (bitmap != null) {
        bitmap.recycle();
        bitmap = null;
        System.gc();
    }
    bitmap = Bitmap.createScaledBitmap(BitmapFactory
        .decodeFile(ImageData_Path.get(img_pos).getPath()),
        width, height, true);
} catch (OutOfMemoryError e) {
    if (bitmap != null) {
        bitmap.recycle();
        bitmap = null;
        System.gc();
    }
    BitmapFactory.Options options = new BitmapFactory.Options();
    options.inPreferredConfig = Config.RGB_565;
    options.inSampleSize = 1;
    options.inPurgeable = true;
    bitmapBitmap.createScaledBitmap(BitmapFactory.decodeFile(ImageData_Path.get(img_pos)
        .getPath().toString(), options), width, height,true);
}
return bitmap; 
```

使用**ImageData_Path.get(img_pos).getPath()**的图像路径。

* * *

## 回答 #28

> 赞同：13
> 
> 时间：2012-08-08T04:36:25.203

这种`OutofMemoryException`不能通过调用`System.gc()`等来完全解决。

~~通过参考[活动生命周期](http://techpalle.com/blog/wp-content/uploads/2012/03/activity_lifecycle.png)~~

活动状态由操作系统本身决定，取决于每个进程的内存使用情况和每个进程的优先级。

您可以考虑使用的每个位图图片的大小和分辨率。我建议缩小尺寸，重新采样到更低的分辨率，参考画廊的设计（一张小图片PNG，一张原始图片。）

* * *

## 回答 #29

> 赞同：13
> 
> 时间：2012-10-31T12:03:07.970

此代码将有助于从 drawable 加载大位图

```
public class BitmapUtilsTask extends AsyncTask<Object, Void, Bitmap> {

    Context context;

    public BitmapUtilsTask(Context context) {
        this.context = context;
    }

    /**
     * Loads a bitmap from the specified url.
     * 
     * @param url The location of the bitmap asset
     * @return The bitmap, or null if it could not be loaded
     * @throws IOException
     * @throws MalformedURLException
     */
    public Bitmap getBitmap() throws MalformedURLException, IOException {       

        // Get the source image's dimensions
        int desiredWidth = 1000;
        BitmapFactory.Options options = new BitmapFactory.Options();
        options.inJustDecodeBounds = true;

        BitmapFactory.decodeResource(context.getResources(), R.drawable.green_background , options);

        int srcWidth = options.outWidth;
        int srcHeight = options.outHeight;

        // Only scale if the source is big enough. This code is just trying
        // to fit a image into a certain width.
        if (desiredWidth > srcWidth)
            desiredWidth = srcWidth;

        // Calculate the correct inSampleSize/scale value. This helps reduce
        // memory use. It should be a power of 2
        int inSampleSize = 1;
        while (srcWidth / 2 > desiredWidth) {
            srcWidth /= 2;
            srcHeight /= 2;
            inSampleSize *= 2;
        }
        // Decode with inSampleSize
        options.inJustDecodeBounds = false;
        options.inDither = false;
        options.inSampleSize = inSampleSize;
        options.inScaled = false;
        options.inPreferredConfig = Bitmap.Config.ARGB_8888;
        options.inPurgeable = true;
        Bitmap sampledSrcBitmap;

        sampledSrcBitmap =  BitmapFactory.decodeResource(context.getResources(), R.drawable.green_background , options);

        return sampledSrcBitmap;
    }

    /**
     * The system calls this to perform work in a worker thread and delivers
     * it the parameters given to AsyncTask.execute()
     */
    @Override
    protected Bitmap doInBackground(Object... item) {
        try { 
          return getBitmap();
        } catch (MalformedURLException e) {
            e.printStackTrace();
        } catch (IOException e) {
            e.printStackTrace();
        }
        return null;
    }
} 
```

* * *

## 回答 #30

> 赞同：13
> 
> 时间：2013-07-14T09:08:14.007

我的 2 美分：我通过位图解决了 OOM 错误：

a) 将我的图像缩放 2 倍

b）在我的自定义适配器中为 ListView 使用[Picasso](http://square.github.io/picasso/)库，在 getView 中进行一次调用，如下所示：`Picasso.with(context).load(R.id.myImage).into(R.id.myImageView);`

* * *

## 回答 #31

> 赞同：7
> 
> 时间：2013-07-24T12:00:55.817

```
BitmapFactory.Options options = new Options();
options.inSampleSize = 32;
//img = BitmapFactory.decodeFile(imageids[position], options);

Bitmap theImage = BitmapFactory.decodeStream(imageStream,null, options);
Bitmap img=theImage.copy(Bitmap.Config.RGB_565,true);
theImage.recycle();
theImage = null;
System.gc();
//ivlogdp.setImageBitmap(img);
Runtime.getRuntime().gc(); 
```

* * *

## 回答 #32

> 赞同：7
> 
> 时间：2014-12-18T09:40:38.610

您使用的图像似乎非常大。因此，由于堆内存已满，一些旧设备会崩溃。在旧设备（蜂蜜梳或 ICS 或任何低端型号设备）中，尝试`android:largeHeap="true"`在应用程序标签下的清单文件中使用或使用以下代码减小位图的大小。

```
Bitmap bMap;
BitmapFactory.Options options = new BitmapFactory.Options(); 
options.InSampleSize = 8;
bMap= BitmapFactory.DecodeFile(imgFile.AbsolutePath, options); 
```

你也可以给 4 或 12 或 16 来减小位图大小

* * *

## 回答 #33

> 赞同：5
> 
> 时间：2012-12-09T21:45:45.753

我尝试了 Thomas Vervest 的方法，但是当 IMAGE_MAX_SIZE 为 2048 时，它返回的比例为 1，图像大小为 2592x1944。

根据其他人提供的所有其他评论，此版本对我有用：

```
private Bitmap decodeFile (File f) {
    Bitmap b = null;
    try {
        // Decode image size
        BitmapFactory.Options o = new BitmapFactory.Options ();
        o.inJustDecodeBounds = true;

        FileInputStream fis = new FileInputStream (f);
        try {
            BitmapFactory.decodeStream (fis, null, o);
        } finally {
            fis.close ();
        }

        int scale = 1;
        for (int size = Math.max (o.outHeight, o.outWidth); 
            (size>>(scale-1)) > IMAGE_MAX_SIZE; ++scale);

        // Decode with inSampleSize
        BitmapFactory.Options o2 = new BitmapFactory.Options ();
        o2.inSampleSize = scale;
        fis = new FileInputStream (f);
        try {
            b = BitmapFactory.decodeStream (fis, null, o2);
        } finally {
            fis.close ();
        }
    } catch (IOException e) {
    }
    return b;
} 
```

* * *

## 回答 #34

> 赞同：4
> 
> 时间：2013-08-29T06:34:00.200

使用这个概念这将帮助你，然后在图像视图上设置图像位图

```
public static Bitmap convertBitmap(String path)   {

        Bitmap bitmap=null;
        BitmapFactory.Options bfOptions=new BitmapFactory.Options();
        bfOptions.inDither=false;                     //Disable Dithering mode
        bfOptions.inPurgeable=true;                   //Tell to gc that whether it needs free memory, the Bitmap can be cleared
        bfOptions.inInputShareable=true;              //Which kind of reference will be used to recover the Bitmap data after being clear, when it will be used in the future
        bfOptions.inTempStorage=new byte[32 * 1024]; 

        File file=new File(path);
        FileInputStream fs=null;
        try {
            fs = new FileInputStream(file);
        } catch (FileNotFoundException e) {
            e.printStackTrace();
        }

        try {
            if(fs!=null)
            {
                bitmap=BitmapFactory.decodeFileDescriptor(fs.getFD(), null, bfOptions);
            }
            } catch (IOException e) {

            e.printStackTrace();
        } finally{ 
            if(fs!=null) {
                try {
                    fs.close();
                } catch (IOException e) {

                    e.printStackTrace();
                }
            }
        }

        return bitmap;
    } 
```

如果您想从高度和宽度为 60 和 60 的大图像制作小图像并快速滚动列表视图，请使用此概念

```
public static Bitmap decodeSampledBitmapFromPath(String path, int reqWidth,
            int reqHeight) {

        final BitmapFactory.Options options = new BitmapFactory.Options();
        options.inJustDecodeBounds = true;
        BitmapFactory.decodeFile(path, options);

        options.inSampleSize = calculateInSampleSize(options, reqWidth,
                reqHeight);

        // Decode bitmap with inSampleSize set
        options.inJustDecodeBounds = false;
        Bitmap bmp = BitmapFactory.decodeFile(path, options);
        return bmp;
        }

    public static int calculateInSampleSize(BitmapFactory.Options options,
            int reqWidth, int reqHeight) {

        final int height = options.outHeight;
        final int width = options.outWidth;
        int inSampleSize = 1;

        if (height > reqHeight || width > reqWidth) {
            if (width > height) {
                inSampleSize = Math.round((float) height / (float) reqHeight);
            } else {
                inSampleSize = Math.round((float) width / (float) reqWidth);
             }
         }
         return inSampleSize;
        } 
```

我希望它会对你有很大帮助。

你可以从开发者网站[这里获得帮助](http://developer.android.com/training/displaying-bitmaps/load-bitmap.html)

* * *

## 回答 #35

> 赞同：4
> 
> 时间：2013-12-05T10:22:49.240

您好请访问链接[http://developer.android.com/training/displaying-bitmaps/index.html](http://developer.android.com/training/displaying-bitmaps/index.html)

或者只是尝试使用给定函数检索位图

```
private Bitmap decodeBitmapFile (File f) {
    Bitmap bitmap = null;
    try {
        // Decode image size
        BitmapFactory.Options o = new BitmapFactory.Options ();
        o.inJustDecodeBounds = true;

        FileInputStream fis = new FileInputStream (f);
        try {
            BitmapFactory.decodeStream (fis, null, o);
        } finally {
            fis.close ();
        }

        int scale = 1;
        for (int size = Math.max (o.outHeight, o.outWidth); 
            (size>>(scale-1)) > IMAGE_MAX_SIZE; ++scale);

        // Decode with input-stram SampleSize
        BitmapFactory.Options o2 = new BitmapFactory.Options ();
        o2.inSampleSize = scale;
        fis = new FileInputStream (f);
        try {
            bitmap  = BitmapFactory.decodeStream (fis, null, o2);
        } finally {
            fis.close ();
        }
    } catch (IOException e) {
    }
    return bitmap ;
} 
```

* * *

## 回答 #36

> 赞同：4
> 
> 时间：2013-12-21T11:10:09.677

要修复 OutOfMemory，您应该执行类似的操作，请尝试此代码

```
public Bitmap loadBitmap(String URL, BitmapFactory.Options options) {
                Bitmap bitmap = null;
                InputStream in = null;
                options.inSampleSize=4;
                try {
                    in = OpenHttpConnection(URL);
                    Log.e("In====>", in+"");
                    bitmap = BitmapFactory.decodeStream(in, null, options);
                    Log.e("URL====>", bitmap+"");

                    in.close();
                } catch (IOException e1) {
                }
                return bitmap;
            } 
```

和

```
try {
                    BitmapFactory.Options bmOptions;
                    bmOptions = new BitmapFactory.Options();
                    bmOptions.inSampleSize = 1;
                    if(studentImage != null){
                        galleryThumbnail= loadBitmap(IMAGE_URL+studentImage, bmOptions);    
                    }

                    galleryThumbnail=getResizedBitmap(galleryThumbnail, imgEditStudentPhoto.getHeight(), imgEditStudentPhoto.getWidth());
                    Log.e("Image_Url==>",IMAGE_URL+studentImage+"");

                } catch (Exception e) {
                    // TODO Auto-generated catch block
                    e.printStackTrace();
                } 
```

* * *

## 回答 #37

> 赞同：3
> 
> 时间：2017-12-15T18:38:16.660

在浏览了所有的答案后，我惊讶地发现没有人提到处理图像的 Glide API。很棒的库，并抽象出位图管理的所有复杂性。您可以使用此库和一行代码快速加载和调整图像大小。

```
 Glide.with(this).load(yourImageResource).into(imageview); 
```

您可以在此处获取存储库：[https ://github.com/bumptech/glide](https://github.com/bumptech/glide)

* * *

## 回答 #38

> 赞同：2
> 
> 时间：2017-07-12T14:38:43.570

如果你像我一样懒惰，你可以开始使用[Picasso 库](http://square.github.io/picasso)来加载图像。

```
Picasso.with(context).load(R.drawable.landing_screen).into(imageView1);
Picasso.with(context).load("file:///android_asset/DvpvklR.png").into(imageView2);
Picasso.with(context).load(new File(...)).into(imageView3); 
```

* * *

## 回答 #39

> 赞同：2
> 
> 时间：2017-07-20T15:46:18.417

我使用了对我有用的解码文件描述符：

```
 FileInputStream  fileInputStream = null;
        try {
            fileInputStream  = new FileInputStream(file);
             FileDescriptor fd = fileInputStream.getFD();
            Bitmap imageBitmap = decodeSampledBitmapFromDescriptor(fd , 612,
                    816);
            imageView.setImageBitmap(imageBitmap);
        } catch (Exception e) {
            e.printStackTrace();
        }finally {
            if(fileInputStream != null){
                try {
                    fileInputStream.close();
                } catch (IOException e) {
                    e.printStackTrace();
                }
            }
        } 
```

从文件描述符解码采样位图的代码：

```
 /**
     * Decode and sample down a bitmap from a file input stream to the requested width and height.
     *
     * @param fileDescriptor The file descriptor to read from
     * @param reqWidth       The requested width of the resulting bitmap
     * @param reqHeight      The requested height of the resulting bitmap
     * @return A bitmap sampled down from the original with the same aspect ratio and dimensions
     * that are equal to or greater than the requested width and height
     */
    public static Bitmap decodeSampledBitmapFromDescriptor(
            FileDescriptor fileDescriptor, int reqWidth, int reqHeight) {

        // First decode with inJustDecodeBounds=true to check dimensions
        final BitmapFactory.Options options = new BitmapFactory.Options();
        options.inJustDecodeBounds = true;
        BitmapFactory.decodeFileDescriptor(fileDescriptor, null, options);

        // Calculate inSampleSize
        options.inSampleSize = calculateInSampleSize(options, reqWidth, reqHeight);

        // Decode bitmap with inSampleSize set
        options.inJustDecodeBounds = false;
        return BitmapFactory.decodeFileDescriptor(fileDescriptor, null, options);
    }

    /**
     * Calculate an inSampleSize for use in a {@link android.graphics.BitmapFactory.Options} object when decoding
     * bitmaps using the decode* methods from {@link android.graphics.BitmapFactory}. This implementation calculates
     * the closest inSampleSize that will result in the final decoded bitmap having a width and
     * height equal to or larger than the requested width and height. This implementation does not
     * ensure a power of 2 is returned for inSampleSize which can be faster when decoding but
     * results in a larger bitmap which isn't as useful for caching purposes.
     *
     * @param options   An options object with out* params already populated (run through a decode*
     *                  method with inJustDecodeBounds==true
     * @param reqWidth  The requested width of the resulting bitmap
     * @param reqHeight The requested height of the resulting bitmap
     * @return The value to be used for inSampleSize
     */
    public static int calculateInSampleSize(BitmapFactory.Options options,
                                            int reqWidth, int reqHeight) {
        // Raw height and width of image
        final int height = options.outHeight;
        final int width = options.outWidth;
        int inSampleSize = 1;

        if (height > reqHeight || width > reqWidth) {

            // Calculate ratios of height and width to requested height and width
            final int heightRatio = Math.round((float) height / (float) reqHeight);
            final int widthRatio = Math.round((float) width / (float) reqWidth);

            // Choose the smallest ratio as inSampleSize value, this will guarantee a final image
            // with both dimensions larger than or equal to the requested height and width.
            inSampleSize = heightRatio < widthRatio ? heightRatio : widthRatio;

            // This offers some additional logic in case the image has a strange
            // aspect ratio. For example, a panorama may have a much larger
            // width than height. In these cases the total pixels might still
            // end up being too large to fit comfortably in memory, so we should
            // be more aggressive with sample down the image (=larger inSampleSize).

            final float totalPixels = width * height;

            // Anything more than 2x the requested pixels we'll sample down further
            final float totalReqPixelsCap = reqWidth * reqHeight * 2;

            while (totalPixels / (inSampleSize * inSampleSize) > totalReqPixelsCap) {
                inSampleSize++;
            }
        }
        return inSampleSize;
    } 
```

* * *

## 回答 #40

> 赞同：2
> 
> 时间：2019-03-08T13:45:00.983

这将获得适当的位图并减少内存消耗

*JAVA*

```
Bitmap bm = null;

BitmapFactory.Options bmpOption = new BitmapFactory.Options();
bmpOption.inJustDecodeBounds = true;

FileInputStream fis = new FileInputStream(file);
BitmapFactory.decodeStream(fis, null, bmpOption);
fis.close();

int scale = 1;

if (bmpOption.outHeight > IMAGE_MAX_SIZE || bmpOption.outWidth > IMAGE_MAX_SIZE) {
    scale = (int)Math.pow(2, (int) Math.ceil(Math.log(IMAGE_MAX_SIZE / 
       (double) Math.max(bmpOption.outHeight, bmpOption.outWidth)) / Math.log(0.5)));
}

BitmapFactory.Options bmpOption2 = new BitmapFactory.Options();
bmpOption2.inSampleSize = scale;
fis = new FileInputStream(file);
bm = BitmapFactory.decodeStream(fis, null, bmpOption2);
fis.close(); 
```

*科特林*

```
val bm:Bitmap = null
val bmpOption = BitmapFactory.Options()
bmpOption.inJustDecodeBounds = true
val fis = FileInputStream(file)
BitmapFactory.decodeStream(fis, null, bmpOption)
fis.close()
val scale = 1
if (bmpOption.outHeight > IMAGE_MAX_SIZE || bmpOption.outWidth > IMAGE_MAX_SIZE)
{
  scale = Math.pow(2.0, Math.ceil((Math.log((IMAGE_MAX_SIZE / Math.max(bmpOption.outHeight, bmpOption.outWidth) as Double)) / Math.log(0.5))).toInt().toDouble()).toInt()
}
val bmpOption2 = BitmapFactory.Options()
bmpOption2.inSampleSize = scale
fis = FileInputStream(file)
bm = BitmapFactory.decodeStream(fis, null, bmpOption2)
fis.close() 
```

* * *

## 回答 #41

> 赞同：0
> 
> 时间：2019-06-25T05:33:01.850

避免内存泄漏或位图 OOM 的最佳实践

1.  不要为 Context / Activity 长期保存位图引用。
2.  如果您在应用程序中使用大位图作为背景或其他内容，则不要将完整图像拉入主内存。您可以使用位图的 insample size 属性来获得屏幕所需的大小。
3.  清洁位图参考一次不再使用。

* * *

## 回答 #42

> 赞同：0
> 
> 时间：2020-07-28T23:43:59.357

我需要将一个大尺寸的图像加载到位图中，我使用 Glide 来解决这个问题。首先使用 inJustDecodeBounds 设置为 true 并使用 BitmapFactory.Options 检查图像大小，然后使用 Glide 获取 Bitmap 对象。我使用分析器检查内存使用情况，但没有像使用 BitmapFactory.decodeFile() 时那样看到任何内存峰值。我在使用 Xamarin 时使用 c# 编写，因此需要进行一些调整才能在 Java 中使用。 [Glide 库文档](https://bumptech.github.io/glide/doc/getting-started.html)

```
private Bitmap DecodeFile(File file) {
        // Decode image size
        BitmapFactory.Options options = new BitmapFactory.Options();

        // setting inJustDecodeBounds to true won't load the file into memory, 
        // but gives you the actual file size.
        options.InJustDecodeBounds = true;
        BitmapFactory.decodeStream(new FileInputStream(file), null, options);
        int actualWidth = options.OutWidth;
        int actualHeight = options.OutHeight;

        var ratio = (double)actualHeight / actualWidth;

        // Default to 800 x 600\. changed the size whatever you need.
        var desiredWidth = 800;
        var desiredHeight = 600;

        if(actualHeight > actualWidth)
        {
            var ratio = (double)actualWidth / actualHeight;
            var futureTarget = Glide.With(Application.Context)
                .AsBitmap()
                .Load(file)
                .SetDiskCacheStrategy(DiskCacheStrategy.None)
                .SkipMemoryCache(true)
                .Submit((int)(desiredWidth * ratio), desiredWidth);
            bitmap = futureTarget.Get() as Bitmap;
        }
        else
        {
            var ratio = (double)actualHeight / actualWidth;
            var futureTarget = Glide.With(Application.Context)
                .AsBitmap()
                .Load(file)
                .SetDiskCacheStrategy(DiskCacheStrategy.None)
                .SkipMemoryCache(true)
                .Submit(desiredWidth, (int)(desiredWidth * ratio));
            bitmap = futureTarget.Get() as Bitmap;
        }return bitmap;} 
```

* * *

## 回答 #43

> 赞同：-1
> 
> 时间：2018-11-01T06:02:33.417

将以下行添加到您的 manifest.xml 文件中：

```
<application

    android:hardwareAccelerated="false"
    android:largeHeap="true">

    <activity>
    </activity>

</application> 
```

* * *

## 回答 #44

> 赞同：-10
> 
> 时间：2013-03-29T06:56:44.627

将位图设置为 imageview 后，像这样回收它：

```
bitmap.recycle();
bitmap=null; 
```

# python - wxpython 的 Easy_install 有“安装脚本”错误

> ID：477573
> 
> 赞同：11
> 
> 时间：2009-01-25T11:25:02.137
> 
> 标签：python, wxpython, easy-install

我安装了 fink 放在 /sw/bin/ 中的 python 2.5。我使用简单的安装命令

```
sudo /sw/bin/easy_install wxPython 
```

尝试安装 wxpython，但在尝试处理 wxPython-src-2.8.9.1.tab.bz2 时出现错误，表明没有安装脚本。在此之前，Easy-install 已适用于其他几种安装。任何关于为什么它现在破坏的帮助？

编辑：错误发生在转储回 shell 提示符之前。

*阅读[http://wxPython.org/download.php](http://wxPython.org/download.php)
最佳匹配：wxPython src-2.8.9.1
下载[http://downloads.sourceforge.net/wxpython/wxPython-src-2.8.9.1.tar.bz2](http://downloads.sourceforge.net/wxpython/wxPython-src-2.8.9.1.tar.bz2)
处理wxPython- src- 2.8.9.1.tar.bz2
错误：在 /tmp/easy_install-tNg6FG/wxPython-src-2.8.9.1.tar.bz2 中找不到安装脚本*

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-01-25T20:19:45.900

它失败的原因很简单：wxPython 中没有 setup.py；wxPython 不使用 distutils 进行安装。

相反，请阅读源代码分发中的文件 README.1st.txt 以获取有关如何安装 wxPython 的说明。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2010-06-15T04:34:54.960

**wxPython 2.8.9.1 确实使用 distutils**

在 'wxPython-src-2.8.9.1/wxPython/' 下运行：

```
sudo python setup.py install 
```

安装 wxPython。至少那是 INSTALL.txt 针对特定版本所说的。

# algorithm - 找到彼此最远的两点的算法

> ID：477591
> 
> 赞同：31
> 
> 时间：2009-01-25T11:35:16.140
> 
> 标签：algorithm, math, path, distance, path-finding

我正在寻找一种用于我正在制作的赛车游戏的算法。地图/关卡/轨道是随机生成的，所以我需要找到两个位置，起点和目标，以充分利用地图。

*   该算法是在二维空间内工作
*   从每一点出发，只能从四个方向穿越到下一个点；上下左右
*   点只能被阻塞或非阻塞，只能遍历非阻塞点

关于距离的计算，应该不是没有更好的词的“鸟道”。如果 A 和 B 之间有墙（或其他阻挡区域），则 A 和 B 之间的路径应该更长。

我不确定从哪里开始，非常欢迎评论，并且建议的解决方案在伪代码中是首选。

**编辑：**对。在查看了[gs 的代码](https://stackoverflow.com/questions/477591/algorithm-to-find-two-points-furthest-away-from-each-other#478076)后，我又试了一次。这次我用 C++ 编写而不是 python。但是，即使在阅读了[Dijkstras 算法](http://en.wikipedia.org/wiki/Dijkstra's_algorithm)、[洪水填充](http://en.wikipedia.org/wiki/Flood_fill)和[Hosam Alys 解决方案](https://stackoverflow.com/questions/477591/algorithm-to-find-two-points-furthest-away-from-each-other#477627)之后，我仍然没有发现任何关键的区别。我的代码仍然有效，但没有你看起来运行的那么快。完整的源代码在[paste](http://pastie.org/370724)上。唯一有趣的行（我猜）是第 78-118 行的 Dijkstra 变体本身。

但速度不是这里的主要问题。如果有人愿意指出算法中的差异，我将非常感谢您的帮助。

*   在 Hosam Alys 算法中，他从边界而不是每个节点扫描的唯一区别是什么？
*   在 Dijkstras 中，您跟踪并覆盖步行距离，但不是在洪水填充中，但仅此而已？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-01-25T12:17:08.053

假设地图是矩形的，您可以遍历所有边界点，并开始填充以找到距离起点最远的点：

```
bestSolution = { start: (0,0), end: (0,0), distance: 0 };
for each point p on the border
    flood-fill all points in the map to find the most distant point
    if newDistance > bestSolution.distance
        bestSolution = { p, distantP, newDistance }
    end if
end loop 
```

我想这将在`O(n^2)`. 如果我没记错的话，它是`(L+W) * 2 * (L*W) * 4`，其中`L`是地图的长度和`W`宽度，`(L+W) * 2`表示周长上的边界点`(L*W)`的数量，是点的数量，并且`4`是假设洪水填充最多可以访问一个点4 次（从各个方向）。因为`n`等于点数，所以这就等于`(L + W) * 8 * n`，应该比`O(n`²`)`好。（如果地图是正方形，则顺序为`O(16n`^(1.5)`)`。）

**更新：**根据评论，由于地图更像是一个迷宫（而不是像我最初想的那样有简单障碍的迷宫），您可以在上面进行相同的逻辑，但检查地图中的所有点（而不是地图上的点）仅限边框）。这应该是`O(4n`²`)`的顺序，这仍然比 FW 和 Dijkstra 的要好。

*注意：* [洪水填充](http://en.wikipedia.org/wiki/Flood_fill)更适合这个问题，因为所有顶点只通过 4 个边界直接连接。地图的广度优先遍历可以相对较快地产生结果（仅在 中`O(n)`）。我假设每个点都可以从它的 4 个邻居中的每一个中检查洪水填充，因此是上面公式中的系数。

**更新 2：**感谢我收到的有关此算法的所有积极反馈。特别感谢@Georg[的评论](https://stackoverflow.com/questions/477591/algorithm-to-find-two-points-furthest-away-from-each-other#478076)。

PS 欢迎大家提出意见或更正。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-01-25T19:15:34.407

*跟进有关 Floyd-Warshall 或[Hosam Aly](https://stackoverflow.com/questions/477591/algorithm-to-find-two-points-furthest-away-from-each-other#477627)的简单算法的问题：*

我创建了一个可以使用这两种方法的测试程序。这些是文件：

*   [迷宫创造者](http://pastie.org/370386)
*   [找到最长的距离](http://pastie.org/370387)

在所有测试用例中，Floyd-Warshall 的速度都慢了很多，这可能是因为帮助该算法实现这一目标的边缘数量非常有限。

这些是时代，每次场都是四组，10个场中有3个是障碍物。

```
尺寸 Hosam Aly Floyd-Warshall
(10x10) 0m0.002s 0m0.007s     
(20x20) 0m0.009s 0m0.307s
(40x40) 0m0.166s 0m22.052s
(80x80) 0m2.753s -
(160x160) 0m48.028s -

```

Hosam Aly 的时间似乎是二次的，因此我建议使用该算法。Floyd-Warshall 的内存消耗也是 n ²，显然超过了需要。如果您知道为什么 Floyd-Warshall 这么慢，请发表评论或编辑这篇文章。

PS：好久没写C或者C++了，希望没有犯太多错误。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-01-25T21:13:09.257

[听起来您想要的是由图形直径](http://mathworld.wolfram.com/GraphDiameter.html)分隔的端点。一个相当好且易于计算的近似值是选择一个随机点，找到离该点最远的点，然后找到离那里最远的点。最后两点应该接近最大分离。

对于矩形迷宫，这意味着两个洪水填充应该为您提供一对非常好的起点和终点。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-01-25T20:17:57.853

**我删除了推荐 Floyd-Warshall 算法的原始帖子。:(**

[gs 做了一个实际的基准测试](https://stackoverflow.com/questions/477591/algorithm-to-find-two-points-furthest-away-from-each-other#478076)，猜猜看，对于典型的地图尺寸，FW 比 Hosam Aly 的“洪水填充”算法慢得多！因此，即使 FW 是一种很酷的算法，并且比 Dijkstra 的密集图要快得多，但对于涉及非常稀疏图的 OP 问题（每个顶点只有 4 条边），我不能再推荐它了。

作为记录：

*   [Dijkstra 算法](http://en.wikipedia.org/wiki/Dijkstra%27s_algorithm)的有效实现需要 O(Elog V) 时间来处理具有 E 个边和 V 个顶点的图。
*   Hosam Aly 的“洪水填充”是[广度优先搜索](http://en.wikipedia.org/wiki/Breadth-first_search)，即 O(V)。这可以被认为是 Dijkstra 算法的一个特例，其中没有顶点可以修改其距离估计。
*   [Floyd-Warshall 算法](http://en.wikipedia.org/wiki/Floyd%E2%80%93Warshall_algorithm)花费 O(V^3) 时间，非常容易编码，并且对于密集图（顶点通常连接到许多其他顶点的图）仍然是最快的。但这**不是 OP 任务的正确选择**，因为它涉及非常稀疏的图。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-01-25T23:36:14.803

Raimund Seidel 在他的论文[On the All-Pairs-Shortest-Path Problem in Unweighted无向图 [pdf]](http://www.mimuw.edu.pl/~mucha/teaching/alp2006/seidel92.pdf)。

输入是邻接矩阵，输出是所有对最短路径距离矩阵。对于 n 个点，运行时间为 O(M(n)*log(n))，其中 M(n) 是矩阵乘法算法的运行时间。

如果您也需要，本文还提供了计算实际路径（在同一运行时）的方法。

Seidel 的算法很酷，因为运行时间与边数无关，但实际上我们并不关心这里，因为我们的图是稀疏的。但是，如果您想要所有对距离矩阵，这可能仍然是一个不错的选择（尽管运行时间比 n^2 稍差），而且这也可能比迷宫上的洪水填充更容易实现和调试。

这是伪代码：

```
Let A be the nxn (0-1) adjacency matrix of an unweighted, undirected graph, G

All-Pairs-Distances(A)
    Z = A * A
    Let B be the nxn matrix s.t. b_ij = 1 iff i != j and (a_ij = 1 or z_ij > 0)
    if b_ij = 1 for all i != j return 2B - A //base case
    T = All-Pairs-Distances(B)
    X = T * A
    Let D be the nxn matrix s.t. d_ij = 2t_ij if x_ij >= t_ij * degree(j), otherwise d_ij = 2t_ij - 1
    return D 
```

要获得距离最大的点对，我们只需返回 argmax_ij(d_ij)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-25T15:48:17.773

完成了该问题的 dijkstra 解决方案的 python 模型。代码有点长，所以我把它贴在别的地方：[http ://refactormycode.com/codes/717-dijkstra-to-find-two-points-furthest-away-from-each-other](http://refactormycode.com/codes/717-dijkstra-to-find-two-points-furthest-away-from-each-other)

在我设置的大小下，运行一个节点的算法大约需要 1.5 秒。为每个节点运行它需要几分钟。

但似乎不起作用，它总是将左上角和右下角显示为最长的路径；58 块瓷砖。当您没有障碍时，这当然是正确的。但是即使添加了几个随机放置的，程序仍然会找到最长的一个。也许它仍然是真实的，如果没有更高级的形状就很难测试。

但也许它至少可以显示我的野心。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-01-29T00:50:08.100

好的，“Hosam 算法”是在节点上预选的广度优先搜索。Dijkstra 的算法不应该在这里应用，因为你的边缘没有权重。

差异至关重要，因为如果边的权重不同，您需要保持许多选项（备用路线）打开并在每一步中检查它们。这使得算法更加复杂。使用广度优先搜索，您只需探索一次所有边，确保您找到到每个节点的最短路径。即按您找到它们的顺序探索边缘。

所以基本上区别在于 Dijkstra 必须“回溯”并查看它之前探索过的边缘以确保它遵循最短路径，而广度优先搜索总是知道它遵循最短路径。

此外，在迷宫中，外边界上的点不能保证是最长路线的一部分。例如，如果你有一个巨大螺旋形状的迷宫，但外端回到中间，你可以有两个点，一个在螺旋的中心，另一个在螺旋的末端，两者在中间！

因此，一个很好的方法是从每个点使用广度优先搜索，但在搜索后删除起点（您已经知道往返它的所有路线）。广度优先的复杂度是 O(n)，其中 n = |V|+|E|。我们对 V 中的每个节点都这样做一次，所以它变成了 O(n^2)。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-25T12:01:27.570

你的描述对我来说听起来像是一个[迷宫路由](http://foghorn.cadlab.lafayette.edu/cadapplets/MazeRouter.html)问题。查看[李算法](http://en.wikipedia.org/wiki/Lee_algorithm)。有关 VLSI 设计中的布局布线问题的书籍可能会对您有所帮助 - [Sherwani 的“VLSI 物理设计自动化算法”](https://rads.stackoverflow.com/amzn/click/com/0792392949)很好，您可能会发现[Sait 和 Youssef 的 VLSI 物理设计自动化](http://books.google.com/books?id=9XUY_zLiVVAC&dq=sait+youssef+design+automation&printsec=frontcover&source=bn&hl=en&sa=X&oi=book_result&resnum=4&ct=result#PPA233,M1)很有用（而且在 Google 版本中更便宜...... )

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-01-25T14:16:32.420

如果您的对象（点）不经常移动，您可以在比 O(n^3) 更短的时间内执行这样的计算。

您所需要做的就是将空间分成大网格并预先计算网格间距离。然后选择占据最远网格的点对是一个简单的查表问题。在一般情况下，您只需要成对检查一小组对象。

如果距离度量是连续的，则此解决方案有效。因此，例如，如果地图中有许多障碍（如迷宫），则此方法可能会失败。

# asp.net - 在 IHTTPHandler 中以编程方式创建 System.Web.UI.Page

> ID：477603
> 
> 赞同：6
> 
> 时间：2009-01-25T11:50:40.257
> 
> 标签：asp.net, routing

我正在尝试使用 ASP.NET (3.5) “路由模块”功能根据 URL 的内容创建自定义页面。

各种文章解释了如何使用 ASP.NET 路由分支到 Web 服务器上的现有页面。

我想做的是使用代码即时创建页面。

我的第一次尝试如下所示：

```
public class SimpleRouteHandler : IRouteHandler
{

    public IHttpHandler GetHttpHandler(RequestContext requestContext)
    {
        string pageName = requestContext.RouteData.GetRequiredString("PageName");

        Page myPage = new Page();
        myPage.Response.Write("hello " + pageName);
        return myPage;
    }
} 
```

但这会抛出一个 HTTPException 说“在这种情况下响应不可用”。在 Response.Write 语句中。

如何进行？

**更新：**最后，我采用了一种基于 IHttpModule 的方法，结果证明它相当简单。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2010-01-10T03:02:08.867

您无法写入来自 an 的响应`IRouteHandler`- 在请求生命周期中为时过早。您应该只从 内部写入响应`IHttpHandler`，这`Page`就是。

如其他示例所示，您必须从某个地方获取一个包含所有必要内容的页面实例。

以下是加载现有页面的方法：

```
Page p = (Page)BuildManager.CreateInstanceFromVirtualPath("~/MyPage.aspx"); 
```

或者您可以从头开始创建一个：

```
Page p = new Page();
p.Controls.Add(new LiteralControl(
    @"<html>
      <body>
          <div>
              This is HTML!
          </div>
      </body>
      </html>")); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-25T12:29:47.980

您可能希望简单地向页面添加控件，而不是尝试直接写入响应。由于页面是全新的并且没有标记，您可能必须添加所有 HTML 元素以使其成为合法的 HTML 才能正确呈现。从来没有尝试过，我不知道它是否会起作用。

```
 Page myPage = new Page();
 page.Controls.Add( new LiteralControl( "hello " + pageName ) );
 return myPage; 
```

我不清楚这是否具有所需的 HTML、HEAD 和 BODY 标记。最好创建一个具有骨架标记的基本页面，您可以将控件添加到该页面并使用示例中的 BuildManager 来实例化此页面，然后添加控件。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-01-10T02:40:20.477

将 requestContext 放在 Response.Write 之前，所以 requestContext.Response.Write

# asp.net - 使asp.net中的某些页面需要登录的最佳方法是什么？

> ID：477607
> 
> 赞同：6
> 
> 时间：2009-01-25T11:52:54.903
> 
> 标签：asp.net, authentication, membership

我正在使用一些页面需要身份验证的 asp.net 网站项目。我正在使用 asp.net 会员资格。

我读了一些答案。例如，在文件夹中创建所有这些页面并创建描述权限的内部 web.config。这是解决问题的一种方法，但我需要更可修复和更有效的方法。

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-01-25T12:13:02.490

如果您不想在 web.config(s) 中对此进行硬编码，则需要实现“基本页面”类型的控件。

您的基页类应该从 System.Web.UI.Page 继承，并且需要有一个可以调用的方法来表示“用户必须登录”或“用户必须是角色 x”，如果用户不是t 在该角色中，重定向到登录页面（您可以通过调用[FormsAuthentication.LoginUrl](http://msdn.microsoft.com/en-us/library/system.web.security.formsauthentication.loginurl.aspx)来获得）。

您的实际页面应该从此类继承，而不是直接从 System.Web.UI.Page 继承。然后，在类似 Init 的地方，或者在 Page_Load 的顶部，调用

```
base.UserMustBeLoggedIn(); 
```

或者

```
// Replace "AccessRole" with the name of your role
base.UserMustBeInRole("AccessRole"); 
```

并让基本页面处理这个。

如果您希望将访问权限存储在数据库中，那么您可以将所有处理移至基本页面，并在页面生命周期中的合适位置，根据您的数据库表检查当前 URL，检查用户角色/身份验证违反要求并根据需要重定向。

* * *

请注意，您可以像这样在 Web 配置中创建页面级安全性：

```
<configuration>
  <location path="LockedPage.aspx">
    <system.web>
      <authorization>
        <!-- Deny access to anonymous users -->
        <deny users="?"/>
      </authorization>
    </system.web>
  </location>
</configuration> 
```

MSDN 上提供了更多信息：[Location Element](http://msdn.microsoft.com/en-us/library/b6x6shw7.aspx)和[The Authorization Element](http://msdn.microsoft.com/en-us/library/532aee0e.aspx)。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-20T13:26:04.313

你可以试试这段代码，在主页面加载事件中写这段代码，添加一个属性

公共布尔 m_bLoginRequired = true;

```
public bool IsLoginRequired
{
    get { return m_bLoginRequired; }
    set { m_bLoginRequired = value; }
}

try
        {
            // Response.Cache.SetCacheability(HttpCacheability.ServerAndNoCache);
            Response.Cache.SetNoStore();
            if (IsLoginRequired==true)
            {
                    if ( Session.IsNewSession  || HttpContext.Current.Session["Username"] == null)
                    {
                        FormsAuthentication.SignOut();
                        FormsAuthentication.RedirectToLoginPage("Session Expired");
                        Response.End();
                    }
                }
            }
        catch (Exception ex)
        {
            throw (ex);
        } 
```

现在在登录页面中，您需要编写此代码

```
FormsAuthentication.SetAuthCookie(this.txt_UserName.Text.Trim(), false);  FormsAuthenticationTicket ticket = new FormsAuthenticationTicket(1, this.txt_UserName.Text.Trim(), DateTime.Now, DateTime.Now.AddMinutes(10), false, "HR");
            HttpCookie cookie = new HttpCookie(FormsAuthentication.FormsCookieName,  FormsAuthentication.Encrypt(ticket));
            cookie.Name = "jay";
            Session["UserName"] = txt_UserName.Text.Trim();
            Response.Cookies.Add(cookie);
            txt_UserName.Text = "";
            txt_Password.Text = "";
            Response.Redirect("HomePage2.aspx"); 
```

现在您必须在登录页面中添加 pageinit 事件

```
protected void Page_PreInit(object sender, EventArgs e)
    {
        Master.IsLoginRequired = false; 
    } 
```

如果您希望用户可以访问未经授权的页面，则在该页面的 pageinit 事件中

设置`Master.IsLoginRequired=false;`

还要在文件中指定 loginurl `web.config`。

# java - 放入 Callable 多少逻辑是“正确的”？

> ID：477609
> 
> 赞同：3
> 
> 时间：2009-01-25T11:55:54.677
> 
> 标签：java, callable

我经常使用 callables ，我偶然发现了一个让我恼火的问题：

假设要运行函数 foo() ，首先需要进行一些检查。

您是否应该 1\. 将支票作为 Callable 的一部分插入：

```
class A implements Callable<Long> {
...
public Long call() {
    check1();
    check2();
    return (run()); 
} 
```

2.  或者，将所有这些逻辑插入另一个类（ALogic）并使用 Callable 作为执行器的外壳？ `class A implements Callable {
    ...
    public Long call() {
    ALogic aLogic = new ALogic();
    return (aLogic.run());
    }`

你觉得优点和缺点是什么？你通常喜欢什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-25T12:20:11.790

你觉得哪个更简单或更清晰？我建议你这样做。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-25T12:36:27.170

在实现回调 [Java 关键字] 接口时，我的一般建议是专注于使 [非 Java 关键字] 接口适合被调用类型。匿名内部类（或其他）通常不应该有那么多，而不仅仅是转发呼叫。

此外，构造一个对象然后只调用一个方法通常是不好的。使其成为一个静态方法（可能反过来通过私有构造函数创建一个对象并运行它）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-25T15:40:34.060

我通常更喜欢简单地将回调转发到封闭类上的私有方法。这消除了简单地指向匿名内部类的“this”引用，这是非常没用的。

# asp.net - 在唯一键约束方面需要帮助

> ID：477613
> 
> 赞同：2
> 
> 时间：2009-01-25T12:01:10.953
> 
> 标签：asp.net

我已经建立了一个逻辑，如果我输入重复值，我应该得到如下消息：“用户名已经存在，尝试另一个名称”但我收到不同的消息：“违反唯一键约束'用户名'。无法在对象中插入重复键'登录'。该语句已终止。在表中登录用户名设置为唯一键。这是代码：

```
protected void BtnSubmit_Click(object sender, EventArgs e)
{
    if (!Page.IsValid)
        return;

    NewuserBAL NUB = new NewuserBAL();

    int intResult = 0;

    string UserName = TxtUserName.Text;
    string Password = PWD.Text;
    string EmailId = Email.Text;

    try
    {
        intResult=NUB.newinsert(UserName, Password, EmailId);
        if (intResult > 0)

            lbldisplay.Text = "New Account Created Successfully";
        else
            lbldisplay.Text = "UserName[<b>"+TxtUserName.Text+"</b>] already exists,try another name";                

        TxtUserName.Text = "";
        PWD.Text = "";
        CnfrmPwd.Text = "";
        Email.Text = "";
    }

    catch(Exception ee)
    {
        lbldisplay.Text = ee.Message.ToString();

    }

    finally
    {
        NUB = null;

    } 
```

请有人帮我在我犯错误的地方。

谢谢， 马苏姆

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-25T12:07:23.970

您收到异常是因为您尝试插入具有相同登录名的用户。你有两个选择：

一个。在显式插入数据之前检查用户是否存在（附加选择查询）

湾。捕获异常“违反 UNIQUE KEY 约束”，然后显示您的自定义消息

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-25T12:07:16.090

您的数据库正在（正确地）捕获并阻止添加重复用户的尝试，因为用户名被设置为唯一键。这是一件好事。您的程序应该捕获异常，对其进行解释，并相应地通知用户。

**编辑：**或者，[正如 empi 所说](https://stackoverflow.com/questions/477613/need-help-in-unique-key-constraints#477618)，在尝试插入之前检查重复的用户。您仍然需要捕获键约束异常，以防两个用户尝试同时创建相同的用户。

# scheduled-tasks - 在 Windows 中以编程方式创建计划任务 - 0x8004130f 错误

> ID：477616
> 
> 赞同：17
> 
> 时间：2009-01-25T12:05:34.487
> 
> 标签：scheduled-tasks

我在运行计划任务时遇到了重大问题。使用 Microsoft 提供的 ITaskScheduler 接口可以很好地创建任务。该任务设置为仅在用户登录时运行。

问题是任务没有运行，日志文件 SchedLgU.txt 引用的原因是：

```
"The attempt to retrieve account information for the specified task failed; therefore, the task did not run. Either an error occurred, or no account information existed for the task.

The specific error is:

0x8004130f: No account information could be found in the Task Scheduler security database for the task indicated." 
```

我知道可以在没有帐户信息的情况下创建计划任务，因为 Google Updater 计划任务可以执行此操作，并且运行良好。

我可以从网络搜索中收集到的是，Windows 有一个“计划任务数据库”，它需要为每个任务提供凭据信息才能运行。

有谁知道如何修改这个凭证数据库或任何其他方式让我的任务运行？

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2009-03-31T20:18:41.267

GoogleUpdateTaskMachine 任务使用“NT AUTHORITY\SYSTEM”来运行任务。您可以使用 schtasks 命令和带有“System”或“”作为参数的 /ru 开关来执行此操作。像这样：

```
schtasks /create /tn "My App" /tr c:\apps\myapp.exe /sc monthly /d 15 /ru "System" 
```

它不会提示输入密码。

[有关更多](http://technet.microsoft.com/en-us/library/cc725744.aspx#BKMK_sys_perms)信息，请参见技术网。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-02-07T20:11:47.133

你可以使用批处理脚本。

```
schtasks /create /tn UNO /tr YOURAPP.EXE /sc HOURLY /mo 2 
```

你去吧。

阅读：[如何使用 Schtasks.exe 在 Windows Server 2003 中安排任务](http://support.microsoft.com/kb/814596)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-25T13:27:16.530

据我所知，文档支持这一点，计划任务需要一个帐户。如果您将任务设置为仅在用户登录时运行，这意味着不需要密码，您仍然需要一个帐户。可以将此帐户设置为一个组，以便只要该组中的任何人登录，该任务就会在触发时运行。例如，您可以将帐户设置为“用户”，以便在任何人登录时都可以运行任务。

# testing - 是否有记录/监控系统测试的好工具？

> ID：477643
> 
> 赞同：7
> 
> 时间：2009-01-25T12:32:29.113
> 
> 标签：testing, trac, system-testing

我正在寻找一种工具来设计、记录和监控产品的系统测试。

我需要的基础是： 1) 一个可以表示测试之间某种继承的工具（即，一个测试建立另一个或类似的测试）。

2) 一个允许我单独监控每个版本的特定测试运行的工具（即，对于产品的 1.1 版，我们从记录的所有测试中运行这些特定测试）。

3) 一种允许对测试进行某种形式的自由“标记”的工具（即，我可以将相同的测试分为几组：回归测试、功能测试、ui 测试……一个测试可以同时包含所有三个）。

4) 可选 - 该工具将允许我运行“自动测试”脚本（使用内部开发的自动化系统自动化，因此它必须允许很多方法与之相关）。

我发现可能有用的一个工具是：[http ://trac-hacks.org/wiki/TestCaseManagementPlugin](http://trac-hacks.org/wiki/TestCaseManagementPlugin)

它具有使用 Trac 的额外好处，我们开始将其用于错误跟踪/任务跟踪。如果有人可以推荐（或给出不使用它的充分理由），也将不胜感激。

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-26T17:38:20.937

[TestLink](http://testlink.sourceforge.net/docs/testLink.php)是一个很好的系统测试管理开源工具；它被广泛使用，正在积极开发中并具有 Trac 集成。它应该可以完成您需要的大部分工作。

# vector - 系统verilog中的打包与解包向量

> ID：477646
> 
> 赞同：29
> 
> 时间：2009-01-25T12:35:03.303
> 
> 标签：vector, system-verilog

查看我在 System Verilog 中维护的一些代码，我看到一些信号定义如下：

```
node [range_hi:range_lo]x; 
```

以及其他定义如下：

```
node y[range_hi:range_lo]; 
```

我知道这`x`被定义为打包，而`y`被定义为未打包。但是，我不知道这意味着什么。

System Verilog 中的压缩向量和非压缩向量有什么区别？

**编辑：**响应@Empi 的回答，为什么在 SV 中编写的硬件设计师应该关心数组的内部表示？是否有任何时候我*不应该*或*不能*使用打包信号？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-01-25T13:02:38.240

本文提供了有关此问题的更多详细信息： [http](http://electrosofts.com/systemverilog/arrays.html) ://electrosofts.c​​om/systemverilog/arrays.html ，尤其是第 5.2 节。

> 打包数组是一种将向量细分为子字段的机制，这些子字段可以作为数组元素方便地访问。因此，可以保证打包数组表示为一组连续的位。解压缩的数组可能会或可能不会如此表示。打包数组与未打包数组的不同之处在于，当打包数组作为主数组出现时，它被视为单个向量。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2012-04-12T10:58:58.950

在了解确切的打包和解包数组是什么之前，让我们看看如何仅通过它们的声明就知道哪个数组是什么。压缩数组在大小声明之前有一个对象名称。例如：

```
bit [3][7] a; 
```

未打包的数组在大小声明之后有一个对象名称。例如：

```
bit a[3]; 
```

打包的数组会产生内存，而未打包的则不会。您也可以像这样访问/声明未打包的数组

```
reg unpacked_array [7:0] = '{0,0,0,0,0,0,0,1}; 
```

您可以混合打包和解包数组来制作多维内存。例如：

```
bit [3:0][7:0]a[2:0]. 
```

它创建一个深度为 3 的 4（即 4*8）字节数组。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2016-09-07T14:19:24.233

当我们写一个 [3:0][7:0]A[4:0] 时，压缩数组主要用于有效的内存使用，这意味着在 32 位内存位置中，每个 8 位的 4 个切片被打包以形成一个 32 位。右侧的值表示那里有 5 个这样的切片。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2018-09-24T08:01:10.240

`bit[3:0] a`-> 打包数组 打包数组可以用作完整数组 ( `a='d1`) 或只是数组的一部分 ( `a[0]='b1`)

`bit a [3:0]`-> unpacked array 解压后的数组不能用作`a[0]='b1`，它必须用作完整的`a={8{'b1}}`

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2017-12-05T01:42:15.840

未打包的数组将比打包数组提供更多的编译时错误检查。

出于这个原因，我在模块的端口定义上看到了未打包的数组。如果信号的维度与未打包数组的端口不完全相同，编译器将出错。对于打包的数组，它通常会继续尽可能地连接东西，而不是发出错误。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2022-02-01T10:54:34.483

[验证学院](https://verificationacademy.com/forums/ovm/difference-between-packed-and-unpacked-arrays)给出了很好的解释。

一个压缩数组可以想象成一个单行 n 列的数组。**`n`** **`vectors`**

而一个未打包的数组可以想象为n 列和 m 行的 a。**`"n" vectors and "m"`** **`unpacked dimensions`****`matrix/2D array`**

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2020-10-15T17:05:09.077

bit a [3:0] -> unpacked array 解压后的数组不能作为 a[0]='b1 使用，必须作为完整的 a={8{'b1}}

---> 在上面的语句中 a[0] ='b1; 将适用于未打包的数组，它不适用于 unpkd 数组的某些部分[例如逻辑 unpkd [8];]，如 unpkd = 5'h7; 分配同样适用于 pkd 数组 --> unpkd = unpkd +2; 不会为 unpkd 工作 将适用于 pkd

# php - 我们可以破解一个只将用户名存储为会话变量的网站吗？

> ID：477649
> 
> 赞同：8
> 
> 时间：2009-01-25T12:37:22.893
> 
> 标签：php, security, login

我开发了我的网站来检查用户是否已注册并使用用户名创建会话变量。这就是存储为会话变量的所有内容。如果我想保护我的页面（以便只有注册用户可以看到它们），我会检查是否设置了会话变量。这安全吗？或者你能提供一个更安全的方法吗？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-01-25T12:58:07.597

一般来说，会话​​是服务器端的，但如果我以某种方式获得会话 ID，我就可以劫持它。

我建议至少存储 IP 和用户代理，如果不匹配，使会话无效。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-28T14:58:55.593

**基本上，您可以在 Session 中存储您想要的任何内容。**唯一需要注意的是：

*   如果您不使用安全连接（如 SSL），则 sessionId 可能会被嗅探和劫持。这无关紧要，因为用户名和通行证也可能被劫持，并且您会受到“中间人”攻击等。所以基本上，您的系统很好，并且在没有 SSL 的情况下提供低安全性。
*   在有关 PHP 的文章中，他们提到了一些与共享主机和会话劫持有关的问题。我不确定这是否属实，所以我在[这里](https://stackoverflow.com/questions/487889)发布了一个问题。**编辑：**这种担忧似乎是真实的，因此如果您使用 PHP，则必须使用其中一种解决方法来存储会话（例如，数据库）。

不过，总的来说，提到的大多数安全问题（包括 XSS 攻击）都不是在 Session 中存储内容，而是一般的安全问题。在 Session 中存储用户 ID（或某种加密形式）通常是非常安全的。

**最重要的是：如果您要使用自己的算法为每个用户生成随机 cookie 代码，那无疑会比 PHP、ASP.NET、Rails 的会话密钥生成算法有更多的安全漏洞（不是专家） ， 任何...**

我可以找到更合适的 Bruce Schneier 名言，但这句话可以做到，“经过 20 年的密码分析审查，没有人能复制 RSA 提供的信心。”</p>

# silverlight - 有哪些使用命名空间 Silverlight/XAML 的具体示例？

> ID：477661
> 
> 赞同：1
> 
> 时间：2009-01-25T12:59:00.200
> 
> 标签：silverlight, xaml, namespaces

在 Silverlight/XAML 中，您有如下命名空间：

```
xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml" 
```

所以元素具有这样的命名空间属性：

```
<TextBlock x:Name="theMessage" Margin="10">Testing...</TextBlock> 
```

这什么时候对我有好处？我会在某个时候创建​​另一个命名空间，例如：

```
xmlns:edward="http://www.tanguay.info/web" 
```

所以我可以放置我自己的名称属性标签，例如：

```
<TextBlock x:Name="theMessage" edward:Name="secondName" Margin="10">Testing...</TextBlock> 
```

然后以某种方式处理两个名称标签等？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-25T13:59:57.617

XAML 是一种基于 XML 的标记语言，因此您可以利用命名空间。这种方法的主要目标是将您的工作组织在更小的单元中，并保持它们之间的歧义。这与 .NET（或其他编程语言）中的普通命名空间的操作原理相同。通常在您使用的 XAML 中

```
xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml" 
```

命名空间来寻址基本控件（请记住，它只是一个字符串，而不是实际指向网站的地址）。除此之外，通常会找到对用于连接到包含业务逻辑或其他 XAML 对象的其他程序集（第三方或您拥有）的其他命名空间的引用。

```
xmlns:demo="clr-namespace:MyNamespace;assembly=MyNamespace.Lib" 
```

在你的 XAML 中有这样的东西

```
<Grid>
      <demo:MyCustomControl />
</Grid> 
```

其中 MyCustomControl 是在 MyNamespace.Lib 程序集中定义的控件。

编辑：刚刚记住，如果您想在命名空间引用中保留类似 XAML 的语法，您可以以 uri 的形式为它们创建别名。看看[这个](http://www.madprops.org/blog/mapping-clr-namespaces-to-xml-for-xaml/)例子。

# java - 是否可以在 Swing 上设置 TitledBorder 不透明？

> ID：477663
> 
> 赞同：2
> 
> 时间：2009-01-25T13:02:04.060
> 
> 标签：java, swing, opacity, titled-border

是否可以在 Swing 上设置一个透明的 TitledBorder 以便背景图像发光？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-25T13:31:30.717

找到了答案。

使用方法

```
setOpaque(false) 
```

在底层面板上。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-25T13:33:18.920

奇怪 - [TitledBorder.isBorderOpaque()](http://java.sun.com/j2se/1.5.0/docs/api/javax/swing/border/TitledBorder.html#isBorderOpaque())应该返回`false`，所以它应该已经工作了。也许问题只是您放置边框的组件没有在边框插图上绘制背景图像？

# javascript - 如何在jQuery中检查空对象

> ID：477667
> 
> 赞同：175
> 
> 时间：2009-01-25T13:08:40.677
> 
> 标签：javascript, jquery, dom, object, null

我正在使用 jQuery，我想检查页面中是否存在元素。我已经编写了以下代码，但它不起作用：

```
if($("#btext" + i) != null) {
    //alert($("#btext" + i).text());
    $("#btext" + i).text("Branch " + i);
} 
```

如何检查元素的存在？

* * *

## 回答 #1

> 赞同：257
> 
> 时间：2009-01-25T13:16:35.843

检查[jQuery 常见问题](http://learn.jquery.com/using-jquery-core/faq/how-do-i-test-whether-an-element-exists/)...

您可以使用选择器返回的 jQuery 集合的长度属性：

```
if ( $('#myDiv').length ){} 
```

* * *

## 回答 #2

> 赞同：64
> 
> 时间：2011-01-17T11:10:09.717

（因为我似乎没有足够的声誉来否决答案......）

**狼**写道：

> 在 undefined 或 null 对象上调用 length 属性将导致 IE 和 webkit 浏览器失败！
> 
> 而是试试这个：
> 
> ```
>  // NOTE!! THE FOLLOWING IS WRONG; DO NOT USE!  -- EleotleCram
> if($("#something") !== null){
>   // do something
> } 
> ```
> 
> 或者
> 
> ```
>  // NOTE!! THE FOLLOWING IS WRONG; DO NOT USE!  -- EleotleCram
> if($("#something") === null){
>   // don't do something
> } 
> ```

虽然在未定义或 null 对象上调用 length 属性确实会导致浏览器失败，但 jQuery 选择器（$('...')）的结果*永远不会*为 null 或未定义。因此，代码建议毫无意义。使用其他答案之一，它们更有意义。

* * *

（2012 年更新）因为人们查看代码并且这个答案在列表中非常高：在过去的几年里，我一直在使用这个小插件：

```
 jQuery.fn['any'] = function() {
     return (this.length > 0);
  }; 
```

我认为**$('div').any()**比**$('div').length**更好读，而且你不会因为拼写错误而受苦：**$('div').ayn()**会出现运行时错误, **$('div').lenght**很可能总是假的。

__
2012 年 11 月编辑：

1）因为人们倾向于看代码而不是阅读代码周围所说的内容，所以我在 Wolf 引用的代码中添加了两个重要的警告演讲者注释。
2）我添加了用于这种情况的小插件的代码。

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2009-01-25T13:15:49.137

查找函数返回匹配元素的数组。您可以检查长度是否为零。请注意仅查找元素一次并根据需要重用结果的更改。

```
var elem = $("#btext" + i);
if (elem.length != 0) {
   elem.text("Branch " + i);
} 
```

另外，您是否尝试过仅使用 text 函数——如果不存在任何元素，它将什么也不做。

```
$("#btext" + i).text("Branch " + i); 
```

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2009-01-25T13:26:19.353

jquery $() 函数总是返回非空值 - 平均元素匹配你选择器 cretaria。如果未找到该元素，它将返回一个空数组。所以你的代码看起来像这样 -

```
if ($("#btext" + i).length){
        //alert($("#btext" + i).text());
    $("#btext" + i).text("Branch " + i);
} 
```

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2010-10-02T06:53:03.633

无论您选择什么，该函数`$()`总是返回一个 jQuery 对象，因此不能用于测试。最好的方法（如果不是唯一的）是使用`size()`上面解释的函数或本机长度属性。

```
if ( $('selector').size() ) {...} 
```

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2011-06-08T16:42:56.727

在 jQuery 1.4 中，您获得了 $.isEmptyObject 函数，但是如果您像我们这些可怜的 Drupal 开发人员那样被迫使用旧版本的 jQ，只需使用以下代码：

```
// This is a function similar to the jQuery 1.4 $.isEmptyObject.
function isObjectEmpty(obj) {
  for ( var name in obj ) {
    return false;
  }
  return true;
} 
```

像这样使用它：

```
console.log(isObjectEmpty(the_object)); // Returns true or false. 
```

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2016-07-27T16:23:44.270

使用“未定义”怎么样？

```
if (value != undefined){ // do stuff } 
```

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2009-01-25T14:02:40.357

```
if ( $('#whatever')[0] ) {...} 
```

所有原生 jQuery 方法返回的 jQuery 对象不是数组，它是一个具有许多属性的对象；其中之一是“长度”属性。您还可以检查 size() 或 get(0) 或 get() - 'get(0)' 的工作方式与访问第一个元素相同，即 $(elem)[0]

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2011-04-09T20:27:52.993

像这样使用`$("#selector").get(0)`null 检查。get 返回 dom 元素，直到那时您正在处理一个数组，您需要在其中检查长度属性。我个人不喜欢对 null 处理进行长度检查，出于某种原因它让我感到困惑 :)

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2012-05-31T12:26:52.413

使用长度属性可以做到这一点。

```
jQuery.fn.exists = function(){return ($(this).length < 0);}
if ($(selector).exists()) { 
   //do somthing
} 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2016-02-23T07:54:08.237

当对象为空时返回此错误：

```
Uncaught TypeError: Cannot read property '0' of null 
```

我试试这段代码：

```
try{
  if ($("#btext" + i).length) {};               
}catch(err){
  if ($("#btext" + i).length) {
     //working this code if the item, not NULL 
   }
} 
```

* * *

## 回答 #12

> 赞同：-4
> 
> 时间：2009-12-26T13:21:15.390

```
if (typeof($("#btext" + i)) == 'object'){
    $("#btext" + i).text("Branch " + i);
} 
```

* * *

## 回答 #13

> 赞同：-7
> 
> 时间：2010-12-17T02:15:29.600

在 undefined 或 null 对象上调用 length 属性将导致 IE 和 webkit 浏览器失败！

而是试试这个：

```
if($("#something") !== null){
  // do something
} 
```

或者

```
if($("#something") === null){
  // don't do something
} 
```

# silverlight - silverlight工具、silverlight SDK、silverlight工具包、silverlight开发工具的区别

> ID：477672
> 
> 赞同：16
> 
> 时间：2009-01-25T13:16:03.033
> 
> 标签：silverlight

我正在为 Silverlight 安装编程环境并尝试理顺需要安装的内容，感谢您提供反馈：

1.  在[http://silverlight.net/GetStarted](http://silverlight.net/GetStarted)上，第一点允许您安装“ **Silverlight Tools** for Visual Studio 2008 SP1”。我正在阅读的书（Silverlight 2，Wiley）似乎将其称为“ **Silverlight SDK** ”。

2.  同样在[http://silverlight.net/GetStarted](http://silverlight.net/GetStarted)，第 4 点允许您安装“ **Silverlight Toolkit** ”，我的书中将其称为“ **Silverlight 开发工具**”。

所以我理解它的方式，只有两个东西要安装，名字似乎并不一致。还是真的要安装 3 或 4 种不同的东西？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-25T13:51:43.813

你是对的： - 第一个是指实际的 SDK（连同文档、Visual Studio 模板和示例）。您必须安装这个才能开发 Silverlight 2 Web 应用程序。- 第二个是已经编码并准备在任何 Silverlight 2 Web 应用程序中使用的控件和类的集合。这不是必需的，但您会发现它非常有用，因为它是一个社区项目，不断维护和更新新功能。

# .net - 在 OO 中建模的一对一关系

> ID：477676
> 
> 赞同：2
> 
> 时间：2009-01-25T13:22:42.570
> 
> 标签：.net, oop

在软件系统中，必须对两个对象之间的一对一关系进行建模，其中该关系存在活动状态。

换句话说，ObjectA 与 ObjectB 具有一对一的关系（没有反向指针），其中的关系可以是活动的或非活动的。还可能存在与该关系关联的其他属性。

在 .NET 中使用面向对象建模此场景的最佳方法是什么？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-01-25T14:44:19.103

这取决于关系的激活是否是您要建模的系统行为的一部分。

> “可能还有与关系相关的其他属性。”

所以这听起来你想要建模的不仅仅是一个参考。a 包含 b 的实例将在简单的情况下工作，其中关系不是系统行为的一部分，而只是技术实现。

如果您想激活/停用/激活（不知道/记住激活的对象B），“空建模”将不起作用（因为您将丢失参考，并且您将丢失有关关系的信息）。或者例如，在稍后阶段，您希望重新激活关系，而不是同时引用 a 和 b，而是引用关系。因此，将这种关系视为模型的一等公民。

然后你可以做这样的事情（但这可能完全是矫枉过正，只是为了显示关系建模作为你的域的一部分）：

[![替代文字](https://i.stack.imgur.com/Au4hn.jpg)](https://i.stack.imgur.com/Au4hn.jpg)
[（来源：[googlecode.com](http://agilesquadblog.googlecode.com/files/rel.jpg)）]

objectA 使用 ObjectB 代理，它将充当 ObjectB，但它实际上具有对 ObjectB 单向关系的引用。ObjectB 代理可以实现在关系不活动时要做什么的行为。

在代码中：

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;

namespace ActivatableRelationshipExample
{
    public interface IActivatable
    {
        void Activate();
        void Deactivate();
        bool IsActive { get; }
    }
}

using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;

namespace ActivatableRelationshipExample
{
    public interface IRelationShip<TSource,TDestination> : IActivatable
    {
        TDestination Destination { get; }
        TSource Source { get; }
    }
}

using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;

namespace ActivatableRelationshipExample
{
    public class ObjectA
    {
        // you could also have an ObjectB reference here
        // and fill it with an ObjectBProxy instance
        // in the constructor. thought this would
        // explain the example a bit better
        private readonly ObjectBProxy proxy;

        public ObjectA(ObjectB b)
        {
            proxy = new ObjectBProxy(b);
        }
        public void AMethodUsingB()
        {
            proxy.BMethod();
        }
    }
}

using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;

namespace ActivatableRelationshipExample
{
    public class ObjectB
    {
        public virtual void BMethod()
        {

        }
    }
}

using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;

namespace ActivatableRelationshipExample
{
    public class ObjectBProxy : ObjectB, IActivatable
    {
        private readonly UniDirectionalRelationship<ObjectB> relation;

        public ObjectBProxy(ObjectB to)
        {
            this.relation = new UniDirectionalRelationship<ObjectB>(to);
        }

        public override void BMethod()
        {
            if (relation.IsActive)
            {
                relation.Destination.BMethod();
            } else
            {
                // do some specific logic here
            }
        }

        public void Activate()
        {
            relation.Activate();
        }

        public void Deactivate()
        {
            relation.Deactivate();
        }

        public bool IsActive
        {
            get { return relation.IsActive; }
        }
    }
}

using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;

namespace ActivatableRelationshipExample
{
    public class RelationshipNotActiveException : Exception
    {
        public RelationshipNotActiveException(string message) : base(message)
        {
        }

        public RelationshipNotActiveException(string message, Exception innerException) : base(message, innerException)
        {
        }
    }
}

using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;

namespace ActivatableRelationshipExample
{
    public class UniDirectionalRelationship<TDestination> : IRelationShip<object,TDestination> where TDestination :class
    {
        private bool active = true;
        private readonly TDestination destination;

        public UniDirectionalRelationship(TDestination destination)
        {
            if(destination == null)
            {
                throw new ArgumentNullException("destination","destination cannot be null");
            }
            this.destination = destination;
        }
        public void Activate()
        {
            active = true;
        }
        public void Deactivate()
        {
            active = false;
        }

        public virtual bool IsActive
        {
            get { return active; }
        }

        public virtual TDestination Destination
        {
            get
            {
                if (active)
                {
                    return destination;
                } 
                throw new RelationshipNotActiveException("the relationship is not active");
            }
        }

        public virtual object Source
        {
            get { throw new NotSupportedException("Source is not supported"); }
        }
    }
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-25T13:24:51.583

ObjectA 包含 ObjectB 的一个实例。不活动由它为空表示，否则为活动。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-25T16:51:32.093

我认为您想要的称为客观化关系或客观化关联。本质上，您的关系是可以具有属性、状态等的一流对象本身...

查看Kyle Baley 的[这篇博文。](http://kyle.baley.org/ManytomanyRelationshipsWithDataAttachedInNHibernate.aspx)在他的例子中，他谈论的是多对多关联，但我认为这种模式也可能在一对一中起作用。请务必阅读博客评论。

# visual-studio - 如何让 Visual Studio 在签入时自动执行操作？

> ID：477683
> 
> 赞同：0
> 
> 时间：2009-01-25T13:27:55.763
> 
> 标签：visual-studio, version-control

我希望 Visual Studio 2008 在我签入、编译代码、运行我的测试时获取最新的解决方案，如果其中任何一个失败，则中止签入。

有可能做到吗，怎么做？

编辑：我们使用 TFS 进行源代码控制，使用 nunit 进行测试。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-25T14:53:10.380

Visual Studio 提供了一个可自定义的平台，因此您可以制作插件等来处理您在签到时想要做的任何其他事情。

查看[Visual Studio SDK](http://msdn.microsoft.com/en-us/library/bb166441.aspx)和[Team Foundation SDK](http://msdn.microsoft.com/en-us/library/bb130146.aspx)。

# visual-studio - 用于简单文件集合的最佳 Visual Studio 项目类型？

> ID：477684
> 
> 赞同：1
> 
> 时间：2009-01-25T13:28:42.657
> 
> 标签：visual-studio

我有一组 HTML 文档，我想将它们添加到我在 Visual Studio 中的解决方案中。它只是文件的集合——没有构建步骤。

将此添加到我的解决方案中的最佳方法是什么？过去我使用过一个 C# 类库项目并在 Build Configuration 中禁用它，但这感觉不对。

“Makefile 项目”不起作用，因为它不支持嵌套文件夹。

我真的不想使用解决方案文件夹，因为它们不是真正的文件系统文件夹。这使他们更难合作。当您的解决方案中包含大量项目时，解决方案文件夹非常有用，但我认为它们不适用于管理多个松散文件。

其他人如何做到这一点？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-25T13:31:59.360

您可以将它们放在[解决方案文件夹中](http://msdn.microsoft.com/en-us/library/haytww03(VS.80).aspx)

右键单击解决方案并选择添加- **>添加现有项目**-它将自动创建解决方案文件夹。您可以通过**Add->New solution folder 手动添加解决方案文件夹**

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-25T13:32:07.657

我建议直接在解决方案下（或者更确切地说是在解决方案下的文档文件夹下）添加它们。解决方案资源管理器中解决方案标题的上下文菜单提供了创建解决方案文件夹和添加对解决方案文件的引用的选项。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-25T14:23:30.130

鉴于您不想使用解决方案文件夹，我认为绝对没有必要将它们包含在您的解决方案中。你可以使用的任何方法都是相当做作的。在解决方案的根目录中存在一个文档文件夹是很常见的，该文件夹不会被解决方案/项目文件以任何方式引用。（如果您愿意，您可以使用解决方案文件镜像文档的目录结构。）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-25T14:32:26.430

我总是在我为其制作文档的每个项目中放置一个 .Documentation 文件夹。它不像为解决方案提供一个位置那样优雅，但它也使得我在不同的解决方案中使用不同的项目并让文档跟随他们的项目。在编译时，我让构建系统将所有文档放在一个文件夹中。

# html - 需要：灵活而安全的用户 HTML 嵌入技术

> ID：477689
> 
> 赞同：1
> 
> 时间：2009-01-25T13:32:45.207
> 
> 标签：html

我们的软件管理图书馆、博物馆、档案馆等。我们希望让用户（即编目员，而不是访问者）添加一些嵌入式内容，例如谷歌地图、YouTube 视频等。我们希望解决方案同样灵活尽可能，因为每个嵌入式内容提供者都有自己的格式。OTOH，我们宁愿不允许用户输入原始 HTML，因为这会带来 XSS 安全风险，并且如果出现错误的 HTML 可能会破坏我们周围的网页。

我今天开始研究谷歌地图，但找不到处理它的方法。我不想让用户只是将嵌入的 HTML 片段复制到一个项目中；我无法嵌入提供的链接 URL，因为 Google 不允许这样做；而且我不能让用户指定坐标，因为我不想使用 Google Maps JS API（这意味着提供我们必须维护的内置解决方案）。

这个问题不是专门关于谷歌地图的，但谷歌地图很有代表性。我很想听听关于灵活但安全的 HTML 嵌入技术的建议。

谢谢，伊兰

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-25T13:50:23.720

markdown 或其他用于标记的轻量级标记语言；*用于嵌入允许*的片段的自定义宏（参见 wordpress.com 上嵌入 youtube 视频的方法）

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-25T13:58:48.540

[卡哈](http://code.google.com/p/google-caja/)会为你工作吗？

> Caja（发音为“KA-ha”）是“虚拟 iframe”：它允许您将不受信任的第三方 HTML 和 JavaScript 内嵌在您的页面中，并且仍然是安全的。卡哈
> 
> *   更严格地控​​制代码可以做什么：
>     *   不重定向到网络钓鱼页面：不受信任的代码具有的窗口对象是由包含页面创建的虚假对象
>     *   无恶意软件：所有对 URL 的请求都被代理
>     *   无 XSS：动态 HTML 清理
> *   允许不受信任的代码比安全地赋予当前 iframe 中的代码更多的权力。以下是一些可能性：
>     *   浮动框架（“信息窗口”）
>     *   框架不必是矩形的
>     *   框架可以在没有当前尴尬协议的情况下进行通信
>     *   读者可以广播有关当前文章的地理信息；地图小工具跳转到该位置，而新闻小工具获取当地故事，天气小工具拉起天气
>     *   同样适用于财务信息或娱乐信息
>     *   一个可扩展的语法高亮器可以有插件，可以标记文本但不会将内容泄漏到另一个网站
>     *   可以是位通道（只能发送信息）或码通道（可以发送功能）
>     *   托管页面可以控制谁与谁交谈

# html - 通过不带提交按钮按 Enter 提交表单

> ID：477691
> 
> 赞同：355
> 
> 时间：2009-01-25T13:34:16.780
> 
> 标签：html, forms, submit

好吧，我正在尝试通过按 Enter 提交表单，但不显示提交按钮。如果可能的话，我不想进入 JavaScript，因为我希望一切都可以在所有浏览器上运行（我知道的唯一 JS 方式是事件）。

现在表格看起来像这样：

```
<form name="loginBox" target="#here" method="post">
    <input name="username" type="text" /><br />
    <input name="password" type="password" />
    <input type="submit" style="height: 0px; width: 0px; border: none; padding: 0px;" hidefocus="true" />
</form> 
```

效果很好。提交按钮在用户按下回车时起作用，并且该按钮在 Firefox、IE、Safari、Opera 和 Chrome 中不显示。但是，我仍然不喜欢该解决方案，因为很难知道它是否适用于所有浏览器的所有平台。

任何人都可以提出更好的方法吗？或者这和它一样好？

* * *

## 回答 #1

> 赞同：258
> 
> 时间：2009-01-25T13:45:34.183

**2022 年更新：改用这个**

```
<input type="submit" hidden /> 
```

* * *

| 注意 - 过时的答案 |
| --- |
| 请不要`position: absolute`在 2021+ 年使用。建议改用该`hidden`属性。否则，请往下看，然后选择一个更好、更现代的答案。 |

尝试：

```
<input type="submit" style="position: absolute; left: -9999px"/> 
```

这会将按钮向左推到屏幕外。这样做的好处是，当 CSS 被禁用时，你会得到优雅的降级。

**更新 - IE7 的解决方法**

正如 Bryan Downing + with 所建议的那样，`tabindex`以防止标签到达此按钮（由 Ates Goral 提供）：

```
<input type="submit" 
       style="position: absolute; left: -9999px; width: 1px; height: 1px;"
       tabindex="-1" /> 
```

* * *

## 回答 #2

> 赞同：104
> 
> 时间：2009-01-25T20:45:02.200

我认为你*应该*走 Javascript 路线，或者至少我会：

```
<script type="text/javascript">
// Using jQuery.

$(function() {
    $('form').each(function() {
        $(this).find('input').keypress(function(e) {
            // Enter pressed?
            if(e.which == 10 || e.which == 13) {
                this.form.submit();
            }
        });

        $(this).find('input[type=submit]').hide();
    });
});
</script>

<form name="loginBox" target="#here" method="post">
    <input name="username" type="text" /><br />
    <input name="password" type="password" />
    <input type="submit" />
</form> 
```

* * *

## 回答 #3

> 赞同：84
> 
> 时间：2009-01-25T20:34:24.297

你试过这个吗？

```
<input type="submit" style="visibility: hidden;" /> 
```

由于大多数浏览器都理解`visibility:hidden`并且它并不能真正像`display:none`，我猜它应该没问题。我自己还没有真正测试过，所以CMIIW。

* * *

## 回答 #4

> 赞同：37
> 
> 时间：2013-11-02T17:16:56.773

没有提交按钮的另一种解决方案：

HTML

```
<form>
  <input class="submit_on_enter" type="text" name="q" placeholder="Search...">
</form> 
```

jQuery

```
$(document).ready(function() {

  $('.submit_on_enter').keydown(function(event) {
    // enter has keyCode = 13, change it if you want to use another button
    if (event.keyCode == 13) {
      this.form.submit();
      return false;
    }
  });

}); 
```

* * *

## 回答 #5

> 赞同：28
> 
> 时间：2017-04-04T14:34:09.823

对于将来查看此答案的任何人，HTML5 为表单元素实现了一个新属性`hidden`，该属性将自动应用于`display:none`您的元素。

例如

```
<input type="submit" hidden /> 
```

* * *

## 回答 #6

> 赞同：14
> 
> 时间：2011-11-14T09:54:59.870

使用以下代码，这解决了我在所有 3 个浏览器（FF、IE 和 Chrome）中的问题：

```
<input  type="submit" name="update" value=" Apply " 
    style="position: absolute; height: 0px; width: 0px; border: none; padding: 0px;"
    hidefocus="true" tabindex="-1"/> 
```

将上面的行添加为代码中的第一行，并带有适当的名称和值。

* * *

## 回答 #7

> 赞同：10
> 
> 时间：2013-04-03T15:34:50.683

只需将 hidden 属性设置为 true：

```
<form name="loginBox" target="#here" method="post">
    <input name="username" type="text" /><br />
    <input name="password" type="password" />
    <input type="submit" hidden="true" />
</form> 
```

* * *

## 回答 #8

> 赞同：8
> 
> 时间：2009-01-25T13:43:05.530

与您当前用来隐藏按钮的技巧不同，`visibility: collapse;`在 style 属性中进行设置会简单得多。但是，我仍然建议使用一些简单的 Javascript 来提交表单。据我了解，如今对此类事物的支持无处不在。

* * *

## 回答 #9

> 赞同：8
> 
> 时间：2016-06-20T15:01:13.267

最优雅的方法是保留提交按钮，但将其边框、填充和字体大小设置为 0。

这将使按钮尺寸为 0x0。

```
<input type="submit" style="border:0; padding:0; font-size:0"> 
```

您可以自己尝试一下，通过为元素设置轮廓，您将看到一个点，它是“包围” 0x0 px 元素的外部边框。

不需要可见性：隐藏，但如果它让你晚上睡觉，你也可以把它混在一起。

[JS小提琴](https://jsfiddle.net/0nkzme9L/)

* * *

## 回答 #10

> 赞同：7
> 
> 时间：2018-08-14T09:49:18.563

HTML5解决方案

```
<input type="submit" hidden /> 
```

* * *

## 回答 #11

> 赞同：6
> 
> 时间：2014-06-12T23:55:02.973

如果提交按钮不可见，并且表单有多个字段，IE 不允许按 ENTER 键提交表单。通过提供一个 1x1 像素的透明图像作为提交按钮，给它想要的东西。当然它会占用布局的一个像素，但是看看你必须做什么来隐藏它。

```
<input type="image" src="img/1x1trans.gif"/> 
```

* * *

## 回答 #12

> 赞同：6
> 
> 时间：2017-03-30T00:12:57.487

```
<input type="submit" style="display:none;"/> 
```

这很好用，它是您想要实现的最明确的版本。

`display:none`请注意，`visibility:hidden`其他表单元素之间存在差异。

* * *

## 回答 #13

> 赞同：6
> 
> 时间：2019-10-24T18:57:48.763

我使用一堆 UI 框架。他们中的许多人都有一个内置的类，你可以用它来直观地隐藏东西。

# 引导程序

```
<input type="submit" class="sr-only" tabindex="-1"> 
```

# 角材料

```
<input type="submit" class="cdk-visually-hidden" tabindex="-1"> 
```

创建这些框架的聪明人将这些样式定义如下：

```
.sr-only {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border: 0;
}

.cdk-visually-hidden {
    border: 0;
    clip: rect(0 0 0 0);
    height: 1px;
    margin: -1px;
    overflow: hidden;
    padding: 0;
    position: absolute;
    width: 1px;
    outline: 0;
    -webkit-appearance: none;
    -moz-appearance: none;
} 
```

* * *

## 回答 #14

> 赞同：5
> 
> 时间：2011-10-01T22:00:44.547

这是我的解决方案，在 Chrome、Firefox 6 和 IE7+ 中进行了测试：

```
.hidden{
    height: 1px;
    width: 1px;
    position: absolute;
    z-index: -100;
} 
```

* * *

## 回答 #15

> 赞同：5
> 
> 时间：2013-09-22T17:47:30.767

最简单的方法

```
<input type="submit" style="width:0px; height:0px; opacity:0;"/> 
```

* * *

## 回答 #16

> 赞同：3
> 
> 时间：2009-01-25T13:45:10.753

你也可以试试这个

```
<INPUT TYPE="image" SRC="0piximage.gif" HEIGHT="0" WIDTH="0" BORDER="0"> 
```

您可以包含宽度/高度 = 0 px 的图像

* * *

## 回答 #17

> 赞同：3
> 
> 时间：2010-11-10T20:46:09.630

对于那些对 IE 有问题的人和其他人也是如此。

```
{
    float: left;
    width: 1px;
    height: 1px;
    background-color: transparent;
    border: none;
} 
```

* * *

## 回答 #18

> 赞同：3
> 
> 时间：2019-11-26T18:04:02.250

```
input.on('keypress', function(event) {
    if ( event.which === 13 ) {
        form.submit();
        return false;
    }
}); 
```

* * *

## 回答 #19

> 赞同：2
> 
> 时间：2013-03-27T14:58:56.767

我将它添加到文档准备好的功能中。如果表单上没有提交按钮（我所有的 Jquery 对话框表单都没有提交按钮），请附加它。

```
$(document).ready(function (){
    addHiddenSubmitButtonsSoICanHitEnter();
});
function addHiddenSubmitButtonsSoICanHitEnter(){
    var hiddenSubmit = "<input type='submit' style='position: absolute; left: -9999px; width: 1px; height: 1px;' tabindex='-1'/>";
    $("form").each(function(i,el){
        if($(this).find(":submit").length==0)
            $(this).append(hiddenSubmit);
    });
} 
```

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2020-12-21T16:47:28.163

这是对我有用的代码，肯定会对您有所帮助

```
<form name="loginBox" target="#here" method="post">
  <input name="username" type="text" /><br />
  <input name="password" type="password" />
  <input type="submit" />
</form>

<script type="text/javascript">
  $(function () {
    $("form").each(function () {
      $(this)
        .find("input")
        .keypress(function (e) {
          if (e.which == 10 || e.which == 13) {
            this.form.submit();
          }
        });
      $(this).find("input[type=submit]").hide();
    });
  });
</script> 
```

# asp.net - 使用jQuery动态添加和删除元素时如何查找元素数量？

> ID：477692
> 
> 赞同：0
> 
> 时间：2009-01-25T13:37:18.613
> 
> 标签：asp.net, jquery, dynamic

我正在开发一个 Web 应用程序（使用 ASP.NET 2.0 (C#) 和 jQuery）

在我的应用程序中，我们有一个界面，我们的员工可以使用该界面输入公司的记录。我们提供了包含基本字段、公司名称、联系人、电话等的界面。现在您知道有些公司有自己的分支机构，有些公司很少（1 到 10 个），有些则有很多（100-200）个分支机构。我们还使用 jQuery 提供了一个动态界面，它允许我们的员工根据特定公司拥有的分支机构数量添加分支机构。

另外，我们使用了 jQuery 的 append 函数作为 ..

```
$("#branches").append("branch html fields text liek a html input field with id 'Namebranch1' "); 
```

现在，通过添加，我们还提供了一个带有每个分支字段的按钮，分别用于删除该特定分支。为了删除我用过

```
$("#branch1").remove() 
```

比方说，我添加了5个分支，然后在提交之前，我觉得3号分支不需要输入，所以我删除了那个分支数据。所以添加和删除的过程如下，我们添加了

1,2,3,4,5

然后，我们删除了第三个分支，现在我们有了

1,2,4,5

现在我们有 4 个元素，所以每当我的用户添加或删除一个分支时，我分别从 javascript 变量中添加 1 和减去 1。然后在隐藏字段中输入该变量，这样当用户提交数据时，我将获得正确的计数，即用户如何添加任何分支，并根据此计数，我知道我有多少次必须运行循环以分别捕获所有分支数据。

但问题是当用户提交表单时，我正在运行循环 4 次，这意味着，我将获得 1,2 和 4 个分支的数据，但是当循环完成 4 个循环时，循环将停止，第 5 个分支的数据这实际上是 4 将丢失。因为当用户提交表单时将发布的元素为（branchName5、branchTitle5 等）

我希望你们明白我需要什么？请告诉我这个问题的一些合乎逻辑的解决方案。

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-25T15:13:21.573

摆脱隐藏的计数器变量，只需遍历 Request.Form.Keys 寻找分支*。然后，您将只处理以分支开头的任何表单变量。

```
class Branch { public string Name; public string Title; }

void OnLoad(EventArgs e) {
   base.OnLoad(e);

   var branches = new Dictionary<int, Branch>();
   foreach (string key in Request.Form.Keys) {
     if (!key.StartsWith("branch")) continue;

     int id;
     if (key.StartsWith("branchTitle")) {
       id = int.Parse(key.Substring("branchTitle".Length));
       branches.Ensure(i).Title = Request.Form[key];
     } else if (key.StartsWith("branchName")) {
       id = int.Parse(key.Substring("branchName".Length));
       branches.Ensure(i).Name = Request.Form[key];
     }            
   }
}

// Ensure extension method
T Ensure<K, T>(this Dictionary<K, T> d, K key) where T:new {
   if (!d.ContainsKey(key)) {
      d.Add(key, new T());
   }
   return d[key];
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-25T14:33:11.013

也许这是一个线索？在提交做....

```
$('#branches').each( function (i) { this.id = 'branch' + i } ); 
```

# .net - 继续获取 提供程序要求在 IIS 6 上启用 SessionState

> ID：477694
> 
> 赞同：1
> 
> 时间：2009-01-25T13:40:48.950
> 
> 标签：.net, asp.net-mvc, iis-6

在尝试在 IIS 6 服务器上部署一个简单的 asp.net mvc 项目时，我不断收到此错误“**提供程序需要启用 SessionState** ”。

为了排除我做错了什么，我现在尝试仅部署您在 vs2008 中启动新的 asp.net mvc 解决方案时获得的模板。是的，我在 IIS 配置中启用了会话状态，还在`<sessionState mode="InProc" />`web.config 中添加了这一行，但这并没有什么区别。

尝试了 .mvc isapi 映射以及通配符映射，但我仍然收到可怕的错误消息。

我是否忽略了一些明显的东西？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-25T17:42:35.953

检查您的 web.config 并确保您没有任何禁用会话状态的内容。它看起来像这样。

```
<sessionState mode="Off" /> 
```

否则，您可能需要检查并确保您在 IIS 级别启用了会话状态...

1.  单击/选择您的站点
2.  在应用程序设置区域中选择配置，然后选择选项选项卡。
3.  在 Application Configuration 区域中选择 Enable Session State 复选框（或确保已选中）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-26T11:05:50.027

不是一个真正的答案，但我所做的是向 IIS 添加一个新站点，并让它在端口 81 上运行。它用于内部测试/演示目的，所以这不是什么大问题。

然后我设置了一个虚拟目录，您可以从那里的许多指南中阅读，将通配符 isapi 规则设置到 .net 3.5 dll 并且该站点立即启动。

我现在遇到了*The provider requires SessionState to be enabled* - 两次错误。在我在家和工作的测试机器上，在将 mvc 站点部署到 IIS 6 中的默认网站时，一定有问题，但不能告诉你是什么......

并感谢乍得试图帮助我！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-11T07:28:25.920

我有同样的错误，但在我的情况下，它与 sessionstate 无关（至少，它不是问题的根源）。

您是否在 Global.asax 文件中设置了错误处理？如果是这样，请暂时禁用它。

```
protected void Application_Error(object sender, EventArgs e)
{
    Exception exception = Server.GetLastError();
    RouteData routeData = new RouteData();
    routeData.Values.Add("controller", "ErrorController");
    routeData.Values.Add("action", "HandleTheError");
    routeData.Values.Add("error", exception);

    Response.Clear();
    Server.ClearError();

    IController errorController = new ErrorController();
    errorController.Execute(new RequestContext(
        new HttpContextWrapper(Context), routeData));
} 
```

禁用此代码后，我收到一个 http 404 错误，无法找到我的一个页面。不要忘记将 mvc 扩展添加到您的链接。如果解决根目录是您的问题，请将函数 Url.Content 与“~/”结合使用。

# javascript - jQuery中的数组函数

> ID：477700
> 
> 赞同：46
> 
> 时间：2009-01-25T13:45:56.820
> 
> 标签：javascript, jquery, arrays, function

我在我的 Web 应用程序中使用 jQuery。我想使用数组，但我无法在 jQuery 中找到数组的函数（在数组中添加、删除或追加元素）。是否有任何与 jQuery 数组函数相关的链接来解释 jQuery 数组函数？

* * *

## 回答 #1

> 赞同：83
> 
> 时间：2009-01-25T14:00:09.520

查看 [https://developer.mozilla.org/En/Core_JavaScript_1.5_Reference/Global_Objects/Array](https://developer.mozilla.org/En/Core_JavaScript_1.5_Reference/Global_Objects/Array) 以获取有关 JavaScript 数组的文档。
jQuery 是一个库，它为 JavaScript 添加了一些魔力，JavaScript 是一种功能强大且功能齐全的脚本语言。图书馆只是填补了空白 - 了解核心！

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2009-01-25T13:50:48.400

jQuery 的数组函数非常有限，因为 JavaScript 本身就有大部分。但这里是他们拥有的：*[实用程序 - jQuery API](http://docs.jquery.com/Utilities)*。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2010-02-19T05:17:10.193

获取数组中的最大值和最小值的简单方法如下。这已在[获取数组中的最大值和最小值中进行了解释](http://ejohn.org/blog/fast-javascript-maxmin/)

```
var myarray = [5,8,2,4,11,7,3];
// Function to get the Max value in Array
Array.max = function( array ){
return Math.max.apply( Math, array );
};

// Function to get the Min value in Array
Array.min = function( array ){
return Math.min.apply( Math, array );
};
// Usage 
alert(Array.max(myarray));
alert(Array.min(myarray)); 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-25T15:25:04.107

[Visual jQuery](http://visualjquery.com/)站点有一些很好的 jQuery 数组功能示例。（单击左侧选项卡上的“实用程序”，然后单击“数组和对象操作”。）

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-25T15:09:37.133

在*[Rich Array jQuery plugin](http://vladimir-k.blogspot.com/2008/12/rich-array-jquery-plugin.html)*中讨论了一个名为“丰富数组”的 jQuery 插件。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2013-02-19T10:01:46.573

您可以使用[Underscore.js](http://underscorejs.org/#first)。它真的让事情变得简单。

例如，从数组中删除元素，您需要执行以下操作：

```
_.without([1, 2, 3], 2); 
```

结果将是 [1, 3]。

它减少了您在 jQuery 中使用[jQuery.grep](https://api.jquery.com/jQuery.grep/)等编写的代码。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2011-04-24T00:48:50.850

查看 jQuery 函数[`.grep()`](http://api.jquery.com/jQuery.grep/)和[`.map()`](http://api.jquery.com/jQuery.map/)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2012-06-26T13:24:24.330

还有一个 jQuery 插件可以在数组上添加一些方法：

*[在 jQuery 中实现 Prototype 的数组方法](http://www.learningjquery.com/2009/02/implementing-prototypes-array-methods-in-jquery)*

该插件实现了[Prototype 的](https://en.wikipedia.org/wiki/Prototype_JavaScript_Framework)库数组方法，例如：

```
var arr = [1,2,3,4,5,6];
$.protify(arr, true);
arr.all();  // true

var arr = $.protify([1, 2, 3, 4, 5, 6]);
arr.any(); // true 
```

和更多。

# java - Mac OS 7.5下可以运行什么JVM？

> ID：477701
> 
> 赞同：3
> 
> 时间：2009-01-25T13:47:15.240
> 
> 标签：java, windows, user-interface, macos, cross-platform

我有一份签约演出的请求，规范初稿中的一个要求是，该软件（最终用户的 GUI 应用程序）应该在 Win 2000 和 Mac OS 7.5 上运行。我不知道他们为什么要支持如此古老的系统，但我想这让我将 Java 作为原始 C 之外的唯一选择，或者不是吗？

那么如果是 Java，我可以在这些目标上使用的 Java 版本是否有限制？

此外，虽然它不会是严格的主题，但我会很感激关于使软件在两个目标上运行的策略的评论。实际上，支持那些古老的系统以及支持现代系统可能甚至比支持 Mac 和 Win 更难，对吧？

作为另一个副业，我也很欣赏可以用来说服客户摆脱这种情况并让他使用 OS X 和 XP 的事实。就像“嘿，今天使用的所有 Mac 中只有 2% 仍然使用比 X 更早的操作系统”。

* * *

**编辑**：我在这里的主要目的是在技术上做好充分的准备，以协商真正应该是什么规格。

这样的事情往往是一些经理认为“哎呀，我的阿姨还在使用 OS 9，我敢打赌，还有人更老套，所以让我们放心并写下 7.5”的结果。不涉及任何技术判断，这没关系。只是，在这些情况下，你必须仔细解释有哪些权衡，如果你成功了，它通常会让你得到更现实的规格。如果他们必须在 Mac OS 上下注，他们甚至完全放弃 Mac OS 的可能性也很小。

有了这样的规格，如果你不积极帮助客户重塑它们，将会发生的事情是，你在报价中输入可以支付所有疯狂东西的数字，然后一些，经验不足的竞争对手会赢。看不到所有的含义并在他们的报价中放一个较低的数字，得到演出，这一切都以每个人的眼泪而告终。你可以去“嘿嘿，告诉过你”，但也不要拿现金。

* * *

**编辑**：感谢您仍然发布事实和建议，尽管我已经接受了对原始问题的回答。我会继续支持这些东西，它肯定会有所帮助。也感谢你对我的同情，并试图让我免于签订一份糟糕的合同！但别担心，我*实际上并不会为 Mac OS 7.5 编写代码*...... ;-) 真的，真正监督所有的影响无论如何都超出了我的深度。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-25T14:22:58.820

除非这是一份非常有利可图的合同，或者您迫切需要这笔钱，否则我建议您尽快逃离它。客户可能不仅针对严重的旧操作系统，而且还针对旧硬件。这意味着您将在性能方面遇到各种问题（因为您可以用合同的全部价值打赌，他们想要一个具有现代功能和性能的应用程序在这个古老的套件上）。它几乎肯定会以眼泪结束......

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-25T15:12:30.093

MacOS 7.x 的 Java 运行时称为 Mac OS Runtime for Java (MRJ)，至少支持 Java 1.1.8。如果我的记忆对我来说是正确的，那么 Swing 实现就很糟糕——所以你需要使用 AWT。

至少在古老的 MacOS 系统上，您会遇到稳定性和性能问题。不要接受这份合同，这肯定会以惨败告终。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-25T15:40:09.770

除非这是一份非常有利可图的合同，否则我会远离这份合同。

我过去曾处理过这样的合同，但它们几乎总是比它们的价值更麻烦。虽然我很欣赏你只是想做好准备，但你真的需要更多地了解他们为什么要这样做——这很不寻常。

哦。如果合同很大，而他们只谈论几台机器 - 为他们购买和安装机器可能是值得的！

为较旧的 VM（例如 1.1）编码将迫使您以较低的公分母进行编码，并将大大增加开发和测试时间 - 您需要考虑到这一点。几乎可以肯定，这台机器在内存和 CPU 方面的动力不足。

Win2k 将至少支持 Java 1.4，可能还支持 1.5。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-25T14:01:56.600

所有 Mac OS Classic（非 X）最高为 1.1.8

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-25T16:56:46.013

一项有用的统计数据是，大约 85-90% 的 Mac 运行 OS X 10.4 或 10.5。其他 10% 中的大多数都在运行旧版本的 OS X。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-25T13:59:01.630

我对此并不确定，但我相信 Mac OS 7.5 只会运行 Java 的 1 和 1.1 版本。

# visual-studio - Visual Studio：将代码粘贴到 HTML 时保留语法着色

> ID：477712
> 
> 赞同：0
> 
> 时间：2009-01-25T13:58:14.360
> 
> 标签：visual-studio

我正在编写一些文档，其中偶尔会包含 C# 或 C++ 代码片段。

在 Visual Studio 中，编辑/复制命令包括语法着色。如果您将文本粘贴到例如 Word 或 Outlook 中，您可以看到这一点。事实上，如果您使用“Paste Special...”命令，您可以看到它是“Rich Text (RTF)”。

但是，在 Visual Studio 中将此文本粘贴到 HTML 文件中时，不会保留任何颜色（甚至格式）。

有任何想法吗？我正在寻找可以在本地工作的东西（最好是在 Visual Studio 中），而不是基于 JavaScript 的解决方案（例如[SyntaxHighlighter](http://code.google.com/p/syntaxhighlighter/)）。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-25T14:37:33.297

有一个名为[CopySourceAsHtml](http://www.jtleigh.com/people/colin/software/CopySourceAsHtml/)的插件做得非常好。我已经用过几次了，但是这些天我使用 Javascript 在我的博客上突出显示（所以它是“纯文本可读的”）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-25T14:05:05.733

您可以使用现有的 C 到 HTML 语法高亮工具将您的片段转换为 HTML 并从那里复制和粘贴。以下是此类工具的列表（并非详尽无遗，也没有特定的顺序）：

*   GNU 脚本
*   带有 htmlize.el 模块的 GNU Emacs 允许您将突出显示的 Emacs 缓冲区转储为 HTML

可能还存在允许您将 C 代码复制并粘贴到表单中并返回突出显示的 HTML 的 Web 服务。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-25T15:21:01.120

我用它来突出显示网页上的代码。它易于使用且易于扩展。

[http://code.google.com/p/syntaxhighlighter/](http://code.google.com/p/syntaxhighlighter/)

它还支持 C#。

# asp.net - 如何以表格格式显示单列数据？

> ID：477713
> 
> 赞同：1
> 
> 时间：2009-01-25T13:58:15.857
> 
> 标签：asp.net, loops

我想显示如下项目，

```
<td1>     <td2>     <td3>     <td4>
1          7         13        19
2          8         14        20
3          9         15        21
4          10        16        22
5          11        17        23
6          12        18 
```

我正在从数据库的单个列中获取数据（来自 1......23）。现在我想运行一个循环，它将以上述格式显示我的单列数据。请告诉我用于以上述格式显示数据的 for 循环代码。在生产环境中数据可以超过23，所以逻辑应该是它可以处理任何数量的数据。我正在使用 ASP.NET(C#)。

谢谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-25T14:21:52.847

我认为您可以使用 asp:DataList 并将数据绑定到它。
下面是使用具有[RepeatDirection](http://msdn.microsoft.com/en-us/library/79k821wc(VS.85).aspx)和 RepeatColumns 属性的 datalist 的示例。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-25T14:11:01.167

在伪代码中（没有测试）：

```
int recordnum=....; //get the total number of records
int col_length=recordnum/4;

for(int i=0;i<col_length;i++)
{ for(int j=0;j<4;j++)
    print data[i+j*col_length] ;
  print "\n";
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-25T15:10:03.170

好的，这是 Riho 循环的更正版本：

```
int records = ... ;                     /* the number of records */
int cols = 4;                           /* the number of columns */
int rows = (records + cols - 1) / cols; /* nb: assumes integer math */

for (int row = 0; row < rows; ++row) {

    print "<tr>";

    for (int col = 0; col < cols; ++col) {

        print "<td>";

        int offset = col * rows + row;
        if (offset < records) {
            print data[offset];
        } else {
            print "nbsp;" /* nb: should have an & but markdown doesn't work */
        }

        print "</td>";
    }

    print "</tr>";
} 
```

通常需要该`&nbsp;`单元格来确保呈现的 HTML 单元格具有正确的背景。缺失的单元格或其中没有数据的单元格不会与正常单元格一样呈现。

# .net - 您对 MS CAB（复合应用程序块）有何看法？

> ID：477734
> 
> 赞同：6
> 
> 时间：2009-01-25T14:11:08.890
> 
> 标签：.net, winforms, frameworks, infragistics, cab

我正在评估将 CAB 用于新的 .net 3.5 winform 项目的过程

我计划使用 Infragistics 工具集，[它被称为“符合 CAB 标准”](http://www.infragistics.com/learn/cab.aspx)

虽然 CAB 的直接优势是让我专注于我的业务，​​而不是编写基本的对接/登录/等代码，但我觉得我自己能够非常迅速地实现相同级别的功能（增加了灵活性/反应性奖金当你'拥有'代码时你有）。

我正在向使用它的人寻求一些关于微软 CAB 的反馈：

1.  您是否遇到过问题/错误？
2.  您觉得 CAB 节省了您的时间吗？
3.  是否有我不知道的额外功能（除了 Docking/Login/WorkerThreads 最佳实践？）

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-27T09:30:49.483

几年前我有一些使用 CAB 的经验，我的结论是它太复杂并且学习曲线陡峭。因此，它提供的好处不值得为加快速度而付出代价。但是，不要相信我的话，尝试关注他们的一些实验室，看看你的想法。

Jeremy Miller 撰写了一系列关于构建自己的 CAB 的优秀博客文章

[http://codebetter.com/blogs/jeremy.miller/archive/2007/07/25/the-build-your-own-cab-series-table-of-contents.aspx](http://codebetter.com/blogs/jeremy.miller/archive/2007/07/25/the-build-your-own-cab-series-table-of-contents.aspx)

这些值得一看，因为您可以从那里获取您需要的东西。

我的建议是继续你的项目，而不是预先构建一个框架。随着项目的发展，您应该发现将代码重构为基类并有效地从应用程序中获取框架的机会。

这样，您最终将获得一个满足您需求的框架，并且开发团队中的每个人都会理解。无论你做什么，都不要预先构建一个框架——这就是毁灭之路:-)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-08-01T05:04:11.940

我们已经在几个项目中使用了 CAB+SCSF。学习曲线确实很陡峭。您可能会在第一个月后跟上进度。其他缺点：

1.  过于复杂
2.  模式炎
3.  代码生成膨胀
4.  难以调试

优点：

遵循业界最佳实践架构设计模式：

1.  模型-视图-演示者
2.  用户界面组成
3.  依赖注入，控制反转
4.  松耦合事件
5.  模块化
6.  ETC...

从长远来看，使用 CAB-SCSF 将意味着更少的错误和更可维护的代码。如果您的项目能够承受学习曲线的初始冲击，我肯定会推荐它。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-08-01T05:12:53.467

[CAB](http://msdn.microsoft.com/en-us/library/aa480450.aspx)退役，取而代之的是[SCSF](http://msdn.microsoft.com/en-us/library/aa480482.aspx)。CAB 和 SCSF 在标准化跨项目的富客户端开发方面提供了一些价值（如果您以这种方式使用它们），但两者都非常重量级。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-25T14:21:04.750

虽然我从未真正使用过 CAB，但它附带了源代码，因此如果您需要应用程序块未提供的额外灵活性，您仍然可以对其进行调整以满足您的确切需求。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-08-26T01:48:14.967

我们已经在 CAB 框架上构建了我们的企业应用程序，但是已经修改了它的许多部分以满足我们的需要。

从那次经验中，我可以看出 CAB 更适合，当你需要一个非常灵活和模块化的架构，并且在 ui、业务逻辑和数据层的开发之间有明确的划分。

CAB 确实存在生成大量代码的缺点，有时会诱使开发人员使用复杂的机制来实现简单的结果（例如过度使用事件发布/订阅模型，即使是最简单的 ui 的 mvp 模式，...）

如果您想对此进行介绍，请访问 [http://richnewman.wordpress.com/intro-to-cab-toc/上的 Rich Newman 的精彩系列](http://richnewman.wordpress.com/intro-to-cab-toc/)

如果您只想使用依赖注入/控制反转，那么托管可扩展性框架 ( [http://mef.codeplex.com/](http://mef.codeplex.com/) ) 可能是一个非常好的、轻量级的替代方案。

# java - 原始类型 'short' - Java 中的强制转换

> ID：477750
> 
> 赞同：78
> 
> 时间：2009-01-25T14:30:48.290
> 
> 标签：java, casting, primitive, short

`short`我对Java 中的原始类型有疑问。我正在使用 JDK 1.6。

如果我有以下情况：

```
short a = 2;
short b = 3;
short c = a + b; 
```

编译器不想编译 - 它说它“无法从 int 转换为 short”并建议我进行强制转换`short`，所以这是：

```
short c = (short) (a + b); 
```

真的有效。但我的问题是为什么我需要投？a 和 b 的值的范围是`short`- 短值的范围是 {-32,768, 32767}。当我想执行操作时，我还需要强制转换 -、*、/（我没有检查其他人）。

如果我对原始类型做同样的`int`事情，我不需要将 aa+bb 转换为`int`. 以下工作正常：

```
int aa = 2;
int bb = 3;
int cc = aa +bb; 
```

我在设计一个需要添加两个 short 类型变量的类时发现了这一点，编译器希望我进行强制转换。如果我使用两个类型的变量来执行此`int`操作，则不需要强制转换。

一个小评论：原始类型也会发生同样的事情`byte`。所以，这有效：

```
byte a = 2;
byte b = 3;
byte c = (byte) (a + b); 
```

但这不是：

```
byte a = 2;
byte b = 3;
byte c = a + b; 
```

对于`long`, `float`,`double`和`int`, 不需要强制转换。只为`short`和`byte`价值观。

* * *

## 回答 #1

> 赞同：64
> 
> 时间：2009-01-25T14:42:31.167

正如[简短 C#](http://msdn.microsoft.com/en-us/library/ybs77ex4(VS.71).aspx)中所解释的（但也适用于其他语言编译器，如 Java）

有一个从 short 到 int、long、float、double 或 decimal 的预定义隐式转换。

您不能将具有较大存储大小的非文字数字类型隐式转换为 short（有关整数类型的存储大小，请参阅整数类型表）。例如，考虑以下两个短变量 x 和 y：

```
short x = 5, y = 12; 
```

以下赋值语句将产生编译错误，**因为赋值运算符右侧的算术表达式默认计算为 int。**

```
short z = x + y;   // Error: no conversion from int to short 
```

要解决此问题，请使用强制转换：

```
short z = (short)(x + y);   // OK: explicit conversion 
```

但是可以使用以下语句，其中目标变量具有相同的存储大小或更大的存储大小：

```
int m = x + y;
long n = x + y; 
```

* * *

一个很好的后续问题是：

“为什么赋值运算符右侧的算术表达式默认为 int”？

第一个答案可以在以下位置找到：

[整数常数折叠的分类和形式化验证](http://www.jblech.de/Glesner-Blech-COCV-2003.pdf)

> Java 语言规范准确定义了**整数如何表示以及如何计算整数算术表达式**。这是 Java 的一个重要属性，因为这种编程语言被设计用于 Internet 上的分布式应用程序。**Java 程序需要独立于执行它的目标机器来产生相同的结果**。
> 
> 相比之下，C（以及大多数广泛使用的命令式和面向对象的编程语言）更加草率，并且留下了许多重要特征。这种不准确的语言规范背后的意图很明确。通过使用目标处理器中内置的算术运算实例化源程序的整数算术，相同的 C 程序应该在 16 位、32 位甚至 64 位架构上运行。这导致代码效率更高，因为它可以直接使用可用的机器操作。只要整数计算只处理“足够小”的数字，就不会出现不一致。
> 
> 从这个意义上说，C 整数算术是一个占位符，它没有由编程语言规范精确定义，而是通过确定目标机器完全实例化。
> 
> Java 精确地定义了如何表示整数以及如何计算整数算术。

```
 Java Integers
--------------------------
Signed         |  Unsigned
--------------------------
long  (64-bit) |
int   (32-bit) |
short (16-bit) |  char (16-bit)
byte  (8-bit)  | 
```

> Char 是唯一的无符号整数类型。它的值表示 Unicode 字符，从`\u0000`到`\uffff`，即从 0 到 2 ^(16) -1。
> 
> **如果整数运算符具有 long 类型的操作数，则另一个操作数也将转换为 long 类型。否则，对 int 类型的操作数执行操作，如有必要，较短的操作数将转换为 int**。转换规则是精确指定的。

[摘自《理论计算机科学电子笔记》 82 No. 2 (2003)
Blesner-Blech-COCV 2003：[Sabine GLESNER](http://pes.cs.tu-berlin.de/pes/index.php.html) , Jan Olaf BLECH,
Fakultät für Informatik,
Universität Karlsruhe
Karlsruhe, Germany]

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2009-01-25T14:46:09.943

编辑：好的，现在我们知道它是 Java ......

[Java 语言规范的第 4.2.2 节](http://docs.oracle.com/javase/specs/jls/se7/html/jls-4.html#jls-4.2.2)指出：

> Java 编程语言提供了许多作用于整数值的运算符：
> 
> [...]
> 
> *   数值运算符，产生 int 或 long 类型的值：*   [...]*   加法运算符 + 和 - (§15.18)

换句话说，它就像 C# - 加法运算符（当应用于整数类型时）只会导致`int`or `long`，这就是您需要强制转换以分配给`short`变量的原因。

**原始答案（C#）**

在 C# 中（你没有指定语言，所以我猜），原始类型的唯一加法运算符是：

```
int operator +(int x, int y);
uint operator +(uint x, uint y);
long operator +(long x, long y);
ulong operator +(ulong x, ulong y);
float operator +(float x, float y);
double operator +(double x, double y); 
```

这些在 C# 3.0 规范的第 7.7.4 节中。此外，定义了小数加法：

```
decimal operator +(decimal x, decimal y); 
```

（枚举添加、字符串连接和委托组合也在这里定义。）

如您所见，没有`short operator +(short x, short y)`运算符 - 因此两个操作数都隐式转换为 int，并使用 int 形式。这意味着结果是“int”类型的表达式，因此需要强制转换。

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2009-01-25T14:41:27.347

在 C# 和 Java 中，赋值右侧的算术表达式默认为 int。这就是为什么你需要转换回一个 short 的原因，因为显然没有将 int 形式隐式转换为 short 的原因。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2009-01-25T15:55:48.867

鉴于尚未回答“为什么默认为 int”的问题...

首先，“默认”并不是真正正确的术语（尽管足够接近）。正如 VonC 所指出的，由 int 和 long 组成的表达式将产生 long 结果。由整数/日志和双精度数组成的操作将产生双精度结果。编译器将表达式的项提升为在结果中提供更大范围和/或精度的任何类型（浮点类型被假定具有比整数更大的范围和精度，尽管您确实会丢失将大长整数转换为双精度的精度）。

需要注意的是，此促销仅针对需要它的条款进行。因此，在以下示例中，子表达式 5/4 仅使用整数值并使用整数数学执行，即使整个表达式涉及双精度数。结果出乎你的意料...

```
(5/4) * 1000.0 
```

好的，那么为什么 byte 和 short 被提升为 int 呢？没有任何参考支持我，这是由于实用性：字节码数量有限。

顾名思义，“字节码”使用单个字节来指定操作。例如*iadd*，它添加了两个整数。目前，[定义了 205 个操作码](http://java.sun.com/docs/books/jvms/second_edition/html/Mnemonics.doc.html)，整数数学对每种类型需要[18](http://java.sun.com/docs/books/jvms/second_edition/html/Overview.doc.html#37356)个（即整数和长整数之间总共 36 个），不包括转换运算符。

如果很短，并且每个字节都有自己的操作码集，那么您将处于 241，从而限制了 JVM 扩展的能力。正如我所说，没有任何参考资料支持我，但我怀疑 Gosling 等人说“人们实际上多久使用一次短裤？” 另一方面，将 byte 提升为 int 会导致这种不太好的效果（预期答案是 96，实际是 -16）：

```
byte x = (byte)0xC0;
System.out.println(x >> 2); 
```

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-01-25T14:40:20.267

您使用什么语言？

许多基于 C 的语言都有一个规则，即任何数学表达式都以 int 或更大的大小执行。因此，一旦添加了两条短裤，结果就是 int 类型。这导致需要演员表。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2016-05-18T17:11:33.950

Java 总是使用至少 32 位的值进行计算。这是由于 1995 年引入 java 时常见的 32 位架构。CPU中的寄存器大小为32位，算术逻辑单元接受2个cpu寄存器长度的数字。因此，CPU 针对这些值进行了优化。

这就是为什么所有支持算术运算且小于 32 位的数据类型在您使用它们进行计算时都会立即转换为 int（32 位）的原因。

所以总而言之，它主要是由于性能问题，现在为了兼容性而保留。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2010-05-02T02:43:04.360

在java中，每个数字表达式都像：

```
anyPrimitive zas = 1;
anyPrimitive bar = 3;
?? x = zas  + bar 
```

如果其中一个加法元素是 long，x 将始终至少为 int 或 long。

但有一些怪癖很难

```
byte a = 1; // 1 is an int, but it won't compile if you use a variable
a += 2; // the shortcut works even when 2 is an int
a++; // the post and pre increment operator work 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2014-09-26T10:27:24.430

任何低于“int”的数据类型（布尔值除外）都会隐式转换为“int”。

在你的情况下：

```
short a = 2;
short b = 3;
short c = a + b; 
```

(a+b) 的结果被隐式转换为 int。现在你将它分配给“short”。所以你得到了错误。

short,byte,char——对于所有这些我们都会得到同样的错误。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2017-01-19T20:04:57.033

AFAIS，没有人提到它的`final`用法。如果您修改最后一个示例并将变量 a 和 b 定义为`final` 变量，则编译器可以*确保*它们的总和值 5 可以分配给 type 的变量`byte`，而不会损失任何精度。在这种情况下，编译器最好将 a 和 b 的总和分配给 c 。这是修改后的代码：

```
final byte a = 2;
final byte b = 3;
byte c = a + b; 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-01-30T11:29:29.177

我想补充一些没有被指出的东西。Java 没有考虑您在...中给出的变量（2 和 3）的值

短 a = 2; 短 b = 3; 短 c = a + b;

据Java所知，你可以做到这一点......

短a = 32767；短 b = 32767; 短 c = a + b;

这超出了short的范围，它将结果自动装箱为int，因为“可能”结果将不仅仅是一个short但不超过一个int。Int 被选为“默认值”，因为基本上大多数人不会硬编码高于 2,147,483,647 或低于 -2,147,483,648 的值

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2021-05-27T11:48:04.823

如果两个值具有不同的数据类型，那么 java 会自动将其中一个值提升为两种数据类型中较大的一个。在您的情况下，较小的数据类型（例如 byte、short 和 char）将在与二进制算术运算符一起使用时被“提升”为 int。如果两个操作数都不是 int，这仍然是正确的。

```
short x = 10;
short y = 20;
short z = x+y // this will be a compiler error. To solve this then casting would be required
short z = (short)(x+y) // this will return 30
short z = (short) x+y //this will return a compiler error 
```

请记住，强制转换是一元运算符，因此通过将较大的值强制转换为较小的数据类型，您实际上是在告诉编译器忽略默认行为。

# javascript - 如何在 jQuery 中执行此操作

> ID：477754
> 
> 赞同：1
> 
> 时间：2009-01-25T14:32:56.553
> 
> 标签：javascript, jquery

我有以下代码：

```
var tempIdx = document.getElementById('cityBuild').selectedIndex;
var tempBuilding = document.getElementById('cityBuild').options[tempIdx].value;

// Do stuff with tempBuilding 
```

我花了一些时间尝试在 jQuery 中做这件事，假设它会更容易，但事实并非如此。我尝试了[此站点](http://marcgrabanski.com/article/jquery-select-list-values)上给出的内容，但从未返回任何值。我做错了什么还是jQuery根本不做的事情？

该项目是一个选择框（仅限单选），我想从中获取值。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-01-25T14:58:25.470

jQuery 知道如何使用选择元素。您可以将值作为任何其他输入来获取：

```
var value = $('#cityBuild').val(); 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-25T15:01:22.860

Eran 的回答变化不大：

```
var value = $('#cityBuild option:selected').val(); 
```

编辑：现在 Eran 是正确的。:)

# javascript - JavaScript/CSS 与 Silverlight 与 Flex

> ID：477759
> 
> 赞同：6
> 
> 时间：2009-01-25T14:35:29.997
> 
> 标签：javascript, apache-flex, silverlight, web-applications, user-interface

我们目前有一个相当复杂的业务应用程序，其中包含大量 JavaScript 代码，用于使用户界面和交互感觉尽可能接近与传统桌面应用程序一起工作（因为这是我们的用户想要的）。多年来，这段 Javascript 代码不断增长，使其难以管理和维护，并且增加新功能更有可能破坏现有功能。不用说，很多这样的代码也不再是最先进的了。

因此，我们正在进行一些讨论，是否应该用 Flex 或 Silverlight 重新编写应用程序的客户端部分，或者使用一些最先进的 JavaScript 框架（如 jQuery）重新编写，或者我们是否应该简单地继续我们的已经并逐渐尝试替换现有代码中最糟糕的部分。更难决定的是，重新编写 UI 可能会花费我们 6-12 个人月的时间。

我想听听您对这个问题的看法（也许你们中的一些人已经不得不做出类似的决定）。

编辑：回答一些提出答案的问题：后端代码是用 C# 编写的，目标受众（通常）是我们销售软件的公司的非技术用户（不是公众，但也不是严格的内部用户），该软件“仅”必须在桌面浏览器中运行，但不一定在移动设备上运行，并且客户端应用程序是一个成熟的 UI。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-01-25T15:18:52.060

老实说，我会重构旧的 JavaScript 代码而不是重写应用程序。既然你问的是放在哪个平台上，我猜你的团队不是其中任何一个方面的专家（不是抨击团队，这只是一个简单的事实，你在做决定时必须考虑）。这对你不利，因为你将有双重职责重写和学习如何在新平台上做事。

通过将其保留在 JavaScript 中，如果您选择并迭代地执行它，您可以慢慢引入一个框架（替换代码部分，测试它，发布它，并修复任何错误）。这将使您能够以较慢的速度进行操作并在此过程中获得反馈。同样，如果项目在中途被取消，您并没有完成所有工作，因为最终用户正在使用更新的代码。记住瀑布模型，这基本上是完全交换几乎永远不会奏效的。

尽管我不愿承认这一点，但对于开发人员而言，这始终是最有趣的，转移平台和一次更换整个系统很少奏效。这方面的例子不胜枚举，Netscape 就是其中之一。 [这是 Spolsky 的帖子。](http://www.joelonsoftware.com/articles/fog0000000027.html)（我也推荐《[用代码做梦》这本书](https://rads.stackoverflow.com/amzn/click/com/1400082463). 这是软件项目失败以及失败的方式和原因的一个很好的例子）。记住要从头开始重写一个系统，你基本上必须遍历每一行代码并弄清楚它做了什么以及为什么。起初你认为你可以跳过它，但最终它归结为这一点。就像你说的，你的代码很旧，这意味着它很可能有黑客来完成一些事情。其中一些你可以忽略，而另一些则是，“我不知道系统需要它来做到这一点。”

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-25T14:43:12.630

这个决定通常不是关于技术，而是更多关于你的技能和舒适区。

如果你有一些人吃和呼吸 Javascript，但对 .net 或 Flash/Flex 一无所知，那么坚持使用 Javascript 并依赖 jQuery 或 Prototype 之类的库并没有错。

如果您具备其他任何一个方面的技能，那么您可能会使用 Silverlight 或 Flex 获得更快的结果，因为您可以通过它们“免费”获得相当多的功能。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-01-25T15:03:28.097

这些事情浮现在脑海中：

*   由于您有一个 .Net 后端，并且您有能力强迫您的客户使用特定平台，因此 Silverlight 是一种选择；
*   由于您的客户端是一个成熟的 UI，因此您需要小部件和可能的其他功能，例如拖放；
*   我没有看到任何对我来说可以证明在 Flex/Silverlight 中重新开始的要求（这通常不会奏效）（例如流视频、SVG 支持。增加了您的团队对 Javascript 的熟悉度，我认为您无法做到一个令人信服的案例，可以在 Javascript 以外的任何地方进行。

但是当然 Javascript 有很多东西，并且有 [很多 Javascript 框架[1](http://ui.jquery.com/demos)。最重要的区分是您的意图是“装饰”一组网页，还是需要一整套 Widget 来在 Web 上创建类似桌面的应用程序。你的问题表明它是后者。

因此——我可能会因为这样说而被否决——我不认为 jQuery 是答案，我是作为一个喜欢 jQuery 的人说的。jQuery（恕我直言）非常适合增强网页和抽象跨浏览器低级功能，但对于复杂的 UI 开发人员来说，最重要的因素是：

**这都是关于小部件的。**

是的，我知道[jQuery UI](http://ui.jquery.com/demos)，但在小部件方面它比其他的要少得多。我建议你看看一些框架的示例和小部件库：

*   [YUI 示例库](http://developer.yahoo.com/yui/examples/)；
*   [ExtJS 演示](http://extjs.com/deploy/dev/examples/samples.html)；和
*   [SmartClient 功能浏览器](http://www.smartclient.com/index.jsp#_Welcome)。

其他（jQuery、Dojo、Mootools、Prototype）是更“紧凑”的框架，可以说不太适合您的目的。

在做出决定时还要考虑每个框架的许可。

我对以上三点的看法是：

*   ExtJS 在某种程度上激怒了社区，因为它最初是 LGPL，但在 2.1 版中有一个[有争议的许可证更改](http://extjs.com/forum/showthread.php?t=33096)（该线程有 76 页！）到 GPL/commercial。社区不再积极参与框架开发的问题。反正不是主线版本。这意味着它是由一个小团队（可能是一个人）而不是社区来开发和支持的。恕我直言，不值得为此支付商业许可，而 GPL 在您的情况下可能会令人望而却步；
*   YUI 由 Yahoo 支持，并且可以在更宽松且侵入性更小的 BSD 许可证下使用。它成熟，使用良好，值得认真考虑；和
*   SmartClient 给我留下了深刻的印象。它可能拥有最宽松的许可证（LGPL），大约有七年的历史，拥有令人难以置信的令人印象深刻的小部件阵列。查看他们的功能浏览器。

您的决定应基于您如何“免费”获得尽可能多的应用程序。您不想花费宝贵的开发人员时间做以下事情：

*   编写 UI 小部件，如树和手风琴；
*   测试和修复跨浏览器的 Javascript 和 CSS 问题；
*   创建本土框架，极大地复制现有框架所做的和做得好的事情。

我会认真考虑以上三个之一作为您前进的道路。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-01-25T19:02:48.537

我对此的看法非常简单：除非该应用程序需要公开访问，除非它需要经过搜索引擎优化和可查找，和/或有其他令人信服的理由表明它必须严格基于文本，然后是芯片从一开始就支持像 Flash 或 Silverlight 这样的富客户端运行时。

一个重要的原因（如果不是最大的话）是它们消除了为多个浏览器和平台进行开发的复杂性。再次：它们**消除了运行时环境变量**。不再需要调试旧版本的 Netscape 和 IE，不再需要对象检测和后续分支，不再需要古怪的 CSS hack——一个代码库，你就完成了。将运行时环境卸载到 Adob​​e 或 Microsoft 将节省您的时间、金钱和麻烦，其他条件相同。（当然，有 YUI、JQuery 等，但他们并没有消除那个变量——他们只是抽象它。而且他们也没有抽象它的*全部*——只是其中的一部分；最终，它仍然取决于你测试，调试，重新测试，调试，重复。）

当然，由于现有的代码库问题，您的情况要复杂一些，而且很难明确说明您应该走哪条路，因为只有您拥有代码，而我们只是有意见的极客。但是假设，仅仅通过您提出这个问题，重构您现有的代码库将涉及一项足够重要的工作，以保证甚至首先考虑一种替代（并且可能是相对外国的）技术，这听起来像是会的，那么我的回答是，你的好奇心很好，在做决定之前，你应该认真地审视一下他们俩。

就我而言，我是一个长期从事服务器端工作的人，在过去的几年里，我一直使用 ASP.NET/C#，并且在我的时间里，我编写了许多基于文本的业务线应用程序，最后几个具有强大的强调使用 JavaScript 提供丰富的主权 UI。在过去的几年里，我也几乎只用在 Flex 上。我在两个世界都有经验。而且我可以毫不犹豫地告诉你，现在，**击败 Flex 是其他人的工作**：它只是一款用途广泛且高效的产品，对于业务线应用程序而言，它仍然遥遥领先于 Silverlight。我只是不能高度推荐它。仅数据绑定和事件处理功能就可以节省大量时间，更不用说您在布局、动画等方面的完全自由了。

所以，我的建议 **是：仔细看一下 Flex**。最后，您可能会发现从头开始重写是一项过于庞大的任务，无法证明是合理的，这很好——只有您才能做出这个决定。（公平地说，你搞砸 Flex 项目的能力和搞砸 JavaScript 项目的能力一样——我知道。我已经做到了。）但总而言之，Flex 可能是最少的——目前有限制性、最灵活、功能最丰富和生产效率最高的选项，所以它当然值得考虑。祝你好运！

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-01-25T15:06:04.037

您拥有的“多年来”开发的任何 javascript 可能看起来都不像今天的可能。毫无疑问，那里有很多有用的代码。尽管如此。所以我的建议是使用 jQuery 在 javascript 中重写并使用可用的 GUI 插件之一，也许看看 Yahoos 的东西。您还将通过这种方式瞄准最广泛的受众。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-25T14:46:24.247

GUI 技术应该首先由您的目标受众决定。例如，如果你的目标是英国 iPhone 用户，我不会推荐 Flex，因为 iPhone 目前没有 Flash 播放器。

请记住，如果您切换到像 Silverlight 这样成熟的 GUI 工具包，您的用户可能会发现 L&F 不自然，因为通常的请求-回复周期在客户端框架中并不那么明显。

在那之后，你的开发人员应该有话要说。每个工具包都需要维护，如果您要切换到全新的工具包，开发人员将不得不熟悉新工具包，这可能会很昂贵。

我的建议是你坚持使用 javascript，因为你的开发人员熟悉它，并逐渐用新的工具包（如原型、jQuery 或任何其他工具包）替换旧的 javascript。您可能会使用最先进的工具包更快地重做一些旧的东西。请记住，您可以使用任何 takeit 构建精美的应用程序。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-07-31T12:44:45.960

查看Flex 与 Javascript 的[比较表：](http://askmeflash.com/article_m.php?p=article&id=11)

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2010-11-18T22:18:26.623

我们在服务器上使用带有 C# 和一些 C++ 的 EXTJS 开发了一个极其丰富的应用程序。我们的客户不仅对桌面浏览器中的界面感到满意，而且对 Javascript 进行了很少的调整，我们就能够提供 Web 浏览器支持。此外，我们在第三世界国家的客户无法使用 Flash 或 Silverlight 应用程序，因为他们的现场人员在网吧使用信息亭（其中许多没有安装 Flash - 忘记 Silverlight！）。我认为这些问题和其他问题弥补了用 javascript 编写复杂应用程序的困难......

# c# - 关于 C# 的高级安装

> ID：477766
> 
> 赞同：1
> 
> 时间：2009-01-25T14:41:17.113
> 
> 标签：c#

我想为我的 C# 应用程序制作一个高级安装程序。|我希望我的应用程序在安装先决条件后继续安装。

我的情况是：

*   myApplication 需要 .net Framework 2

*   它将用户重定向到 Microsoft 网站。

*   用户安装框架。

*   安装需要重启电脑。

停止安装

在这一步之后（重新启动后）我希望 myApplication 继续安装（进入安装的最后阶段）

关于我如何做到这一点的任何建议？！？！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-25T14:55:25.087

InstallShield 或其他安装程序创建工具之一将能够为您处理先决条件。如果您想自己动手，那么您可以检查框架，执行您提到的安装它的各种步骤，然后将您的安装应用程序添加到[RunOnce](http://support.microsoft.com/kb/137367)注册表项，以便它在启动时再次启动。

不过，查看可以为您处理所有先决条件等的东西将是我的选择:-)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-25T21:15:42.853

我建议看一下 nullsoft 安装系统。使用 Modern UI 主题和 DotNET 宏 ( [http://nsis.sourceforge.net/DotNET](http://nsis.sourceforge.net/DotNET) )。这就是您正在寻找的免费预构建的一切，并且您可以轻松启动并运行。

我有使用这条路线发布应用程序的经验，并且效果很好。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-25T15:17:43.887

按此顺序安装：

1.  安装 .NET 框架
2.  安装您的应用程序。
3.  如果需要，重新启动。

您可以在 VS2005/8 中创建一个安装项目来处理安装您的应用程序和*任何*需要的依赖项。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-25T22:00:42.217

您是否知道您编译的 c# 应用程序本身会执行此操作？编译成 .Net exe 的引导程序将包含一个重定向，以获取带有指向 microsoft 网站的工作链接的框架。

# php - 从 php 文件调用 flex 应用程序

> ID：477768
> 
> 赞同：1
> 
> 时间：2009-01-25T14:41:38.500
> 
> 标签：php, apache-flex

大家好，我需要帮助..有人成功地从 php-html 文件调用 flex 应用程序吗？假设我有基于 html-php 的网络，我使用 html 标签制作了一个 ogin 表单。当用户成功登录时，登录将显示使用 flex 创建的表单...请帮助..非常感谢大家...

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-25T19:18:12.717

我不确定让 HTML 登录表单显示 Flex 登录表单是什么意思，但如果您尝试在 HTML/JavaScript（无论如何渲染，PHP 或其他方式）和 Flex 之间建立通信，那么您'会想要使用的是[flash.external.ExternalInterface](http://livedocs.adobe.com/flash/9.0/ActionScriptLangRefV3/flash/external/ExternalInterface.html)。

我[最近在这里发布了一个完整的示例](https://stackoverflow.com/questions/472026/problem-with-flash-externalinterface-on-google-app-engine#472184)，说明了如何在两端（HTML/JavaScript 和 Flex）上进行设置，以及如何让它们相互通信。您应该能够将两个代码片段复制粘贴到一个新的 Flex 项目中以查看一个工作示例，并根据需要从那里进行调整。祝你好运！

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-25T15:00:39.007

在 Flex 中：

```
...
// provide an interface for javascript
if (ExternalInterface.available) 
    ExternalInterface.addCallback("login", jsLogin);
...

private function jsLogin(name:String, password:String):void 
{
... 
```

在 Javascript 中

```
...
var name = $('#name').text();
var password = $('#password').text();
$('#swfobject').get(0).login(name, password); 
```

# c++ - C++、windows->linux 移植、mapfile 问题

> ID：477787
> 
> 赞同：0
> 
> 时间：2009-01-25T15:00:17.450
> 
> 标签：c++, windows, linux

我正在将一个小型 C++ 控制台应用程序从 Windows 移植到 linux，GCC 4.3.2。编译时出现无法解决的奇怪错误。

```
Labels.cpp: In function ‘void DumpSymbols()’:
Labels.cpp:68: error: invalid conversion from ‘int’ to ‘std::_Ios_Openmode’
Labels.cpp:68: error:   initializing argument 2 of ‘std::basic_ofstream<_CharT, _Traits>::basic_ofstream(const char*, std::_Ios_Openmode) [with _CharT = char, _Traits = std::char_traits<char>]’ 
```

标签.cpp：

```
#include <string>
#include <fstream>
#include <iostream>
#include "stdafx.h"
using namespace std;

#include "Opcodes.h"
#include "Labels.h"

Label LABELS[1024];
int labelcounter = 0;
int OffsetCounter = 0;

void AddLabel(string name, int line)
{
        LABELS[labelcounter].name = name;
        LABELS[labelcounter].line = line;
        LABELS[labelcounter].offset = OffsetCounter;
        printf("Adding label: %s[0x%X]\n", name.c_str(), OffsetCounter);
        labelcounter++;
}

bool IsLabel(string name)
{
        for(int i=0;i<labelcounter;i++)
        {
                if (LABELS[i].name.compare(name) == 0)
                {
                        return true;
                }
        }
        return false;
}

int GetOffset(string lbl)
{
        for(int i=0;i<labelcounter;i++)
        {
                if (LABELS[i].name.compare(lbl) == 0)
                {
                        printf("Refers to label '%s':0x%X\n", lbl.c_str(), LABELS[i].offset);
                        return LABELS[i].offset;
                }
        }
        return -1;
}

void DumpSymbols()
{
        ofstream mapfile("symbols.map", ios::out|ios::beg);  //this line causes error

        //mapfile.write(
        char numbuf1[32];
        itoa(labelcounter, numbuf1, 10);
        mapfile.write((string(numbuf1) + "\n").c_str(), strlen(numbuf1)+1);

        for(int i=0;i<labelcounter;i++)
        {
                string dump;
                char numbuf[32];
                itoa(LABELS[i].offset, numbuf, 10);
                dump = string(LABELS[i].name) + "\t" + string(numbuf) + "\n";
                mapfile.write(dump.c_str(), strlen(dump.c_str()));
        }
} 
```

stdafx.h：

```
#pragma once
#include <stdio.h>
#include <string.h>
#include <stdlib.h>
#include <cstdlib> 
```

谢谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-25T15:40:48.333

只需删除“|ios::beg”：

ofstream mapfile("symbols.map", ios::out);

它的类型是ios_base::seekdir，不是开启模式；是为了谋求职位。无论如何，您将自动处于开始状态。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-25T15:33:22.077

ios::beg 真的是 ofstream 构造函数的 mode 参数的有效值吗？

根据[http://www.cplusplus.com/reference/iostream/ofstream/ofstream.html](http://www.cplusplus.com/reference/iostream/ofstream/ofstream.html)它不是。

我猜发生的事情是您不小心从对 ofstream::seekg 的调用中借用了它（它是一个有效参数），以强制写入将从文件的开头而不是文件的结尾开始。

如果您试图强制将文件完全替换（如果它已经存在），请尝试使用 ios::trunc 而不是 ios::beg。

# php - PHP/MySQL - 构建导航菜单层次结构

> ID：477793
> 
> 赞同：4
> 
> 时间：2009-01-25T15:06:11.273
> 
> 标签：php, mysql, arrays, menu, hierarchy

所以最终的菜单看起来像这样：

```
Item B
    Item B-1
        Item B-1-2
        Item B-1-1
Item A
    SubItem A-1
    SubItem A-2
Item C 
```

基于以下数据库记录：

```
id        menu_title          parent_menu_id    menu_level    weight
1         Item A                0                           1                     1
2         Item B                0                           1                     0
3         Item C                0                           1                     2
4         SubItem A-2       1                           2                     1
5         Item B-1             2                           2                     0
6         Item B-1-1          5                           3                     1
7         SubItem A-1       1                           2                     0
8         Item B-1-2          5                           3                     0 
```

**我将如何进行展示？**我的猜测是它将涉及将所有项目存储到一个多维数组中，然后以某种方式循环它......

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-01-25T15:16:28.557

分层数据在关系数据库中有些烦人（不包括 Oracle，它有操作员`START WITH/CONNECT BY`来处理这个问题）。基本上有[两种模型](http://extjs.com/forum/showthread.php?t=33096)：邻接表和嵌套集。

你选择了邻接集，这也是我通常做的。尽管可以在单个查询中以正确的顺序检索嵌套集模型，但它比嵌套集模型更容易更改。邻接列表不能。您需要构建一个中间数据结构（树），然后将其转换为列表。

我会做的（事实上最近也做过）是：

*   在一个按父 ID 排序的查询中选择整个菜单内容；
*   使用关联数组或类/对象构建菜单结构树；
*   走那棵树以创建嵌套的无序列表；和
*   [使用Superfish](http://users.tpg.com.au/j_birch/plugins/superfish/)之类的 jQuery 插件将该列表转换为菜单。

你构建这样的东西：

```
$menu = array(
  array(
    'name' => 'Home',
    'url' => '/home',
  ),
  array(
    'name' => 'Account',
    'url' => '/account',
    'children' => array(
      'name' => 'Profile',
      'url' => '/account/profile',
    ),
  ),
  // etc
); 
```

并将其转换为：

```
<ul class="menu">;
  <li><a href="/">Home</a></li>
  <li><a href="/account">Account Services</a>
    <ul>
      <li><a href="/account/profile">Profile</a></li>
... 
```

用于生成菜单数组的 PHP 相当简单，但解决起来有点困难。您使用递归树遍历函数来构建 HTML 嵌套列表标记，但会将其实现留作读者练习。:)

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-01-25T15:16:48.990

处理现有的数据结构通常会涉及递归或多个查询来构建树。

您是否考虑过其他存储层次结构的方法？查看修改后的预购遍历 - 这是一篇不错[的基于 PHP 的文章](http://www.sitepoint.com/article/hierarchical-data-database/)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-25T16:02:27.947

您存储分层数据的方式并不像您希望的那样有效。几年前，我阅读了[在 MySQL 中管理层次结构数据](http://mikehillyer.com/articles/managing-hierarchical-data-in-mysql/)的文章，并发现它是在 SQL 中管理基于层次结构的数据*的最佳解决方案。*下一个最大的好处是我相信你可以通过一个查询来获取整个树。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-07-30T04:23:24.550

我刚刚在一个类似的问题中发布了我自己将 MySQL 分层数据（邻接列表）转换为菜单（HTML）的方法

它不**使用**递归。它需要对数据库进行**一次查询**。

阅读更多

[https://stackoverflow.com/questions/2871861#3368622](https://stackoverflow.com/questions/2871861#3368622)

谢谢。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-25T16:51:17.897

如果您不想使用嵌套集，则可以生成层次结构的另一种简单方法是在前面使用简单的文本字符串。

```
Item B
    Item B-1
        Item B-1-2
        Item B-1-1
Item A
    SubItem A-1
    SubItem A-2
Item C 
```

会成为

```
1 Item B
  1.1 Item B1
    1.1.1 Item B11
    1.1.2 Item B12
2 Item A
  2.1 Item A1
  2.2 Item B2
3 Item C 
```

每个项目前面的数字可以存储在一个字段中，并根据长度（表示它所在位置的深度）进行解析，以告诉您您需要了解的所有信息。

我将嵌套集层次结构用于需要计算的更复杂的东西，例如，但我发现这种方法效果很好

# python - 如何在 Python 中将 XML 转换为 JSON

> ID：477794
> 
> 赞同：-1
> 
> 时间：2009-01-25T15:06:33.770
> 
> 标签：python, xml, json

> **可能重复：**
> [使用 Python 将 XML 转换为 JSON？](https://stackoverflow.com/questions/191536/converting-xml-to-json-using-python)

我正在导入 XML 提要并尝试将其转换为 JSON 以进行输出。我收到此错误：

`TypeError: <xml.dom.minidom.Document instance at 0x72787d8> is not JSON serializable`

不幸的是，我对 Python 几乎一无所知。我正在 Google App Engine 上开发这个。我需要一些帮助，因为我的小 2 小时 hack 进展顺利，现在已经是第三天了。

XML 数据：

```
<?xml version="1.0" ?><eveapi version="2">
  <currentTime>2009-01-25 15:03:27</currentTime>
  <result>
    <rowset columns="name,characterID,corporationName,corporationID" key="characterID" name="characters">
      <row characterID="999999" corporationID="999999" corporationName="filler data" name="someName"/>
    </rowset>
  </result>
  <cachedUntil>2009-01-25 15:04:55</cachedUntil>

</eveapi> 
```

我的代码：

```
class doproxy(webapp.RequestHandler):
def get(self):
    apiurl = 'http://api.eve-online.com'

    path = self.request.get('path');
    type = self.request.get('type');
    args = '&'+self.request.get('args');

    #assemble api url
    url = apiurl+path

    #do GET request     
    if type == 'get':
        result = urlfetch.fetch(url,'','get');

    #do POST request
    if type == 'post':
        result = urlfetch.fetch(url,args,'post');   

    if result.status_code == 200:               
        dom = minidom.parseString( result.content ) #.encode( "utf-8" ) )
        dom2json = simplejson.dump(dom,"utf-8") 
```

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-01-25T15:23:04.860

> 我很快就认为 Python 可能是一门伟大的语言，但没有一个用户知道如何以清晰简洁的方式实际记录任何内容。

问题的态度无助于从这些相同的 Python 用户那里获得答案。

[正如这个相关问题](https://stackoverflow.com/questions/191536/converting-xml-to-json-using-python)的答案中提到的，XML 和 JSON 之间没有一对一的对应关系，因此无法自动完成转换。

在[文档中，`simplejson`](http://simplejson.googlecode.com/svn/tags/simplejson-2.0.7/docs/index.html)您可以找到它能够序列化的类型列表，这些类型基本上是原生 Python 类型（dict、list、unicode、int、float、True/False、None）。

因此，您必须创建一个仅包含这些类型的 Python 数据结构，然后将其提供给`simplejson.dump()`.

# json - 什么是正确的 JSON 内容类型？

> ID：477816
> 
> 赞同：11086
> 
> 时间：2009-01-25T15:25:19.067
> 
> 标签：json, rest, http-headers, mime-types, content-type

一段时间以来，我一直在搞乱[JSON](http://en.wikipedia.org/wiki/JSON)，只是将其作为文本推出，并没有伤害任何人（据我所知），但我想开始正确地做事。

我已经看到*了*许多声称的 JSON 内容类型的“标准”：

```
application/json
application/x-javascript
text/javascript
text/x-javascript
text/x-json 
```

但是哪一个是正确的，还是最好的？我收集到它们之间存在不同的安全和浏览器支持问题。

我知道有一个类似的问题，*[如果 JSON 由 REST API 返回，什么 MIME 类型？](https://stackoverflow.com/questions/404470/what-mime-type-if-json-is-being-returned-by-a-rest-api)*，但我想要一个更有针对性的答案。

* * *

## 回答 #1

> 赞同：11159
> 
> 时间：2009-01-25T15:27:29.720

对于 JSON 文本：

```
application/json 
```

> JSON 文本的 MIME 媒体类型是`application/json`. 默认编码为 UTF-8。^(（来源：[RFC 4627](http://www.ietf.org/rfc/rfc4627.txt)）)

对于带有回调的[JSONP （可运行 JavaScript）：](http://en.wikipedia.org/wiki/JSONP)

```
application/javascript 
```

以下是相关评论中提到的一些博客文章：

*   [为什么你不应该使用`text/html`JSON](http://jibbering.com/blog/?p=514)
*   [Internet Explorer 有时会出现以下问题`application/json`](https://web.archive.org/web/20180102070201/www.entwicklungsgedanken.de/2008/06/06/problems-with-internet-explorer-and-applicationjson/)
*   [一个相当完整的 Mimetype 列表以及它们的用途](https://github.com/h5bp/server-configs-nginx/blob/master/mime.types)
*   [IANA 的官方 mime 类型列表](http://www.iana.org/assignments/media-types/application/)来自 @gnrfan 下面的回答

* * *

## 回答 #2

> 赞同：1737
> 
> 时间：2010-04-07T04:32:55.107

[IANA](http://www.iana.org)已将 JSON 的官方 MIME 类型注册为**`application/json`**.

当被问及为什么不这样`text/json`做时，Crockford 似乎说 JSON 不是真正的 JavaScript 也不是文本，而且 IANA 更有可能`application/*`分发`text/*`。

更多资源：

*   [媒体类型](http://www.iana.org/assignments/media-types/application/)
*   [征求意见 4627](http://www.ietf.org/rfc/rfc4627.txt)
*   [bluesmoon：JSON 有一个类型](http://bluesmoon.livejournal.com/227190.html)

* * *

## 回答 #3

> 赞同：974
> 
> 时间：2012-06-20T03:10:53.043

**对于 JSON：**

```
Content-Type: application/json 
```

**对于[JSON-P](http://en.wikipedia.org/wiki/JSONP)：**

```
Content-Type: application/javascript 
```

* * *

## 回答 #4

> 赞同：671
> 
> 时间：2009-10-07T14:35:36.313

当然，JSON 的正确 MIME 媒体类型是`application/json`，但有必要了解您的应用程序中预期的数据类型。

例如，我使用[Ext GWT](http://www.sencha.com/products/extgwt/)，服务器响应必须是**text/html**，但包含 JSON 数据。

*客户端，Ext GWT 表单监听器*

```
uploadForm.getForm().addListener(new FormListenerAdapter()
{
    @Override
    public void onActionFailed(Form form, int httpStatus, String responseText) 
    {
        MessageBox.alert("Error");
    }

    @Override
    public void onActionComplete(Form form, int httpStatus, String responseText) 
    {
        MessageBox.alert("Success");
    }
}); 
```

如果使用**application/json**响应类型，浏览器会建议我保存文件。

*[使用Spring MVC](http://en.wikipedia.org/wiki/Spring_Framework#Model-view-controller_framework)的服务器端源代码片段*

```
return new AbstractUrlBasedView() 
{
    @SuppressWarnings("unchecked")
    @Override
    protected void renderMergedOutputModel(Map model, HttpServletRequest request,
                                           HttpServletResponse response) throws Exception 
    {
        response.setContentType("text/html");
        response.getWriter().write(json);
    }
}; 
```

* * *

## 回答 #5

> 赞同：492
> 
> 时间：2013-03-28T07:54:24.180

## **JSON：**

响应是根据 URL 中传递的查询参数动态生成的数据。

**例子：**

```
{ "Name": "Foo", "Id": 1234, "Rank": 7 } 
```

**内容类型：** `application/json`

* * *

## **JSON-P：**

带填充的 JSON。响应是 JSON 数据，其中包含一个函数调用。

**例子：**

```
functionCall({"Name": "Foo", "Id": 1234, "Rank": 7}); 
```

**内容类型：** `application/javascript`

* * *

## 回答 #6

> 赞同：424
> 
> 时间：2010-11-16T22:58:25.013

如果您使用的是 Ubuntu 或 Debian，并且通过 Apache 提供 .json 文件，您可能希望提供具有正确内容类型的文件。我这样做主要是因为我想使用 Firefox 扩展[JSONView](https://addons.mozilla.org/en-US/firefox/addon/10869/)

Apache 模块[mod_mime](http://httpd.apache.org/docs/current/mod/mod_mime.html)将有助于轻松完成此操作。但是，对于 Ubuntu，您需要编辑文件*/etc/mime.types*并添加该行

```
application/json json 
```

然后重启 Apache：

```
sudo service apache2 restart 
```

* * *

## 回答 #7

> 赞同：406
> 
> 时间：2009-01-25T15:31:38.807

如果您从客户端调用 ASP.NET Web 服务，您必须使用`application/json`它才能工作。我相信[jQuery](http://en.wikipedia.org/wiki/JQuery)和[Ext](http://en.wikipedia.org/wiki/Ext_%28JavaScript_library%29)框架也是如此。

* * *

## 回答 #8

> 赞同：321
> 
> 时间：2012-04-12T04:00:37.183

JSON 的正确内容类型是`application/json`除非您使用[JSONP](http://en.wikipedia.org/wiki/JSONP)，也称为 JSON with Padding，它实际上是 JavaScript，因此正确的内容类型应该是`application/javascript`.

* * *

## 回答 #9

> 赞同：311
> 
> 时间：2012-04-18T08:22:23.807

毫无疑问，这`application/json`是 JSON 响应的最佳[MIME](http://en.wikipedia.org/wiki/MIME)类型。

`application/x-javascript`但是由于一些压缩问题，我有一些必须使用的经验。我的托管环境是与[GoDaddy](http://en.wikipedia.org/wiki/Go_Daddy)共享托管。他们不允许我更改服务器配置。我已将以下代码添加到我的`web.config`文件中以压缩响应。

```
<httpCompression>
    <scheme name="gzip" dll="%Windir%\system32\inetsrv\gzip.dll"/>
    <dynamicTypes>
        <add mimeType="text/*" enabled="true"/>
        <add mimeType="message/*" enabled="true"/>
        <add mimeType="application/javascript" enabled="true"/>
        <add mimeType="*/*" enabled="false"/>
    </dynamicTypes>
    <staticTypes>
        <add mimeType="text/*" enabled="true"/>
        <add mimeType="message/*" enabled="true"/>
        <add mimeType="application/javascript" enabled="true"/>
        <add mimeType="*/*" enabled="false"/>
    </staticTypes>
</httpCompression>
<urlCompression doStaticCompression="true" doDynamicCompression="true"/> 
```

通过使用它，.aspx 页面使用 g-zip 压缩，但 JSON 响应没有。我添加了

```
<add mimeType="application/json" enabled="true"/> 
```

在静态和动态类型部分。**但这根本不会压缩 JSON 响应。**

之后我删除了这个新添加的类型并添加了

```
<add mimeType="application/x-javascript" enabled="true"/> 
```

在静态和动态类型部分中，并更改了响应类型

.ashx（异步处理程序）到

```
application/x-javascript 
```

现在我发现我的 JSON 响应是用 g-zip 压缩的。所以我个人推荐使用

```
application/x-javascript 
```

仅当您想在**共享托管环境**中压缩 JSON 响应时。因为在共享主机中，它们不允许您更改[IIS](http://en.wikipedia.org/wiki/Internet_Information_Services)配置。

* * *

## 回答 #10

> 赞同：275
> 
> 时间：2011-11-30T06:42:21.580

仅当`application/json`用作[MIME](http://en.wikipedia.org/wiki/MIME)类型时，我才具有以下内容（截至 2011 年 11 月，最新版本的 Chrome、Firefox 和[Firebug](http://en.wikipedia.org/wiki/Firebug_%28software%29)）：

*   从服务器加载 JSON 时，Chrome 不再发出警告。
*   Firebug 将在响应中添加一个选项卡，向您显示格式化的 JSON 数据。如果 MIME 类型不同，它只会显示为“响应内容”。

* * *

## 回答 #11

> 赞同：251
> 
> 时间：2011-09-07T02:41:00.140

并非所有内容都适用于内容类型`application/json`。

如果您使用[Ext JS](http://en.wikipedia.org/wiki/Ext_JS)表单提交来上传文件，请注意浏览器会解析服务器响应以创建`<iframe>`.

如果服务器使用 JSON 发送返回对象，则`Content-Type`必须将标头设置为`text/html`，以便告诉浏览器将未更改的文本插入到文档正文中。

请参阅[Ext JS 3.4.0 API 文档](http://dev.sencha.com/deploy/ext-3.4.0/docs/)。

* * *

## 回答 #12

> 赞同：234
> 
> 时间：2012-05-14T22:19:48.547

JSON 是一种[领域特定语言](http://en.wikipedia.org/wiki/Domain-specific_language)(DSL) 和独立于 JavaScript 的数据格式，因此有自己的[MIME](http://en.wikipedia.org/wiki/MIME)类型，`application/json`. 尊重 MIME 类型当然是客户端驱动的，因此`text/plain`对于字节传输可能会这样做，但是您将不必要地将解释推向供应商应用程序域 - `application/json`. 您会通过 传输 XML`text/plain`吗？

但老实说，您选择的 MIME 类型是对客户如何解释数据的建议——`text/plain`或者`text/HTML`（当它不是 HTML 时）就像类型擦除一样——它与将所有对象类型的对象都用类型化语言制作一样没有信息。

据我所知，没有浏览器运行时会采用 JSON 文档并自动将其作为 JavaScript 可访问对象提供给运行时，而无需干预，但如果您使用的是残缺的客户端，那就完全不同了。但这还不是全部——RESTful [JSON](http://en.wikipedia.org/wiki/Representational_state_transfer#RESTful_web_services)服务通常没有 JavaScript 运行时，但这并没有阻止它们使用 JSON 作为一种可行的数据交换格式。如果客户端那么残废......那么我可能会考虑通过[Ajax](http://en.wikipedia.org/wiki/Ajax_%28programming%29)模板服务进行 HTML 注入。

应用程序/JSON！

* * *

## 回答 #13

> 赞同：215
> 
> 时间：2012-04-27T16:27:29.280

如果您在客户端环境中，则必须调查跨浏览器支持对于支持良好的 Web 应用程序。

正确的 HTTP Content-Type 应该是`application/json`，正如其他人已经强调的那样，但是有些客户端不能很好地处理它，这就是 jQuery 推荐默认值的原因`text/html`。

* * *

## 回答 #14

> 赞同：180
> 
> 时间：2012-12-31T06:29:16.963

正确答案是：

```
Content-Type: application/json 
```

* * *

## 回答 #15

> 赞同：175
> 
> 时间：2013-04-02T11:10:56.707

正如许多其他人提到的，`application/json`是正确的答案。

但是尚未解释的是您提出的其他选项的含义。

*   `application/x-javascript`：JavaScript 之前的实验性 MIME 类型`application/javascript`已成为标准。

*   `text/javascript`: 现在已经过时了。您应该`application/javascript`在使用 javascript 时使用。

*   `text/x-javascript`: 针对上述情况的实验性 MIME 类型。

*   `text/x-json``application/json`:正式注册前的 JSON 实验性 MIME 类型。

总而言之，每当您对内容类型有任何疑问时，都应该查看[此链接](http://www.iana.org/assignments/media-types/media-types.xhtml)

* * *

## 回答 #16

> 赞同：157
> 
> 时间：2013-01-19T08:22:22.890

在[JSP](http://en.wikipedia.org/wiki/JavaServer_Pages)中，您可以在页面指令中使用它：

```
<%@ page language="java" contentType="application/json; charset=UTF-8"
    pageEncoding="UTF-8"%> 
```

JSON的正确[MIME](http://en.wikipedia.org/wiki/MIME)媒体类型是`application/json`. JSP 将使用它来向客户端发送响应。

* * *

## 回答 #17

> 赞同：121
> 
> 时间：2013-02-26T11:55:27.980

“<code>application/json”是正确的 JSON 内容类型。

```
def ajaxFindSystems = {
  def result = Systems.list()
  render(contentType:'application/json') {
    results {
      result.each{sys->
        system(id:sys.id, name:sys.name)
      }
    }
    resultset (rows:result.size())
  }
} 
```

* * *

## 回答 #18

> 赞同：120
> 
> 时间：2014-02-12T16:12:34.547

IANA[注册`application/json`](http://www.iana.org/assignments/media-types/application/json)说

> 使用这种媒体类型的应用程序：JSON 已被用于在使用以下所有编程语言编写的应用程序之间交换数据：ActionScript、C、C#、Clojure、ColdFusion、Common Lisp、E、Erlang、Go、Java、JavaScript、Lua、Objective CAML、Perl、PHP、Python、Rebol、Ruby、Scala 和 Scheme。

您会注意到 IANA.org[没有列出任何其他媒体类型](http://www.iana.org/assignments/media-types/media-types.xhtml)，事实上甚至`application/javascript`已经过时了。所以`application/json`真的是唯一可能的*正确*答案。

浏览器支持是另一回事。

最广泛支持的非标准媒体​​类型是`text/json`或`text/javascript`。但一些大牌甚至使用`text/plain`.

更奇怪的是 Flickr 发送的 Content-Type 标头，它返回 JSON 为`text/xml`. 谷歌使用`text/javascript`它的一些 ajax api。

例子：

```
curl -I "https://ajax.googleapis.com/ajax/services/search/video?v=1.0&q=jsonexample" 
```

输出：`Content-Type: text/javascript`

```
curl -I "https://www.flickr.com/services/rest/?method=flickr.test.echo&format=json&api_key=f82254c1491d894f1204d8408f645a93" 
```

输出：`Content-Type: text/xml`

* * *

## 回答 #19

> 赞同：94
> 
> 时间：2013-05-03T16:00:28.960

正确的 MIME 类型是**`application/json`**

**但**

我经历了很多浏览器类型或框架用户需要的情况：

```
text/html

application/javascript 
```

* * *

## 回答 #20

> 赞同：78
> 
> 时间：2013-05-16T12:43:52.970

我使用以下

```
contentType: 'application/json',
data: JSON.stringify(SendData), 
```

* * *

## 回答 #21

> 赞同：69
> 
> 时间：2013-08-09T10:49:18.707

**发布时Content-Type**标头应设置为“ **application/json** ”。侦听请求的服务器应包含“ **Accept=application/json** ”。在 Spring MVC 中，您可以这样做：

```
@RequestMapping(value="location", method = RequestMethod.POST, headers = "Accept=application/json") 
```

在响应中添加标头：

```
HttpHeaders headers = new HttpHeaders();
headers.add("Content-Type", "application/json"); 
```

* * *

## 回答 #22

> 赞同：62
> 
> 时间：2015-04-01T16:13:44.210

> `application/json`在 PHP 中存储数组或对象数据的效果很好。

我使用此代码将数据以 JSON 格式放在设置为[公开可见的](https://stackoverflow.com/a/38866924/4058484)[*Google Cloud Storage (GCS)*](https://stackoverflow.com/a/35738814/4058484)上：

```
$context = stream_context_create([
    'gs' => [
        'acl'=>'public-read', 
        'Content-Type' => 'application/json',
    ]
]);

file_put_contents(
    "gs://BUCKETNAME/FILENAME.json", 
    json_encode((object) $array), 
    false, 
    $context
); 
```

要取回数据很简单：

```
$data = json_decode(file_get_contents("gs://BUCKETNAME/FILENAME.json")); 
```

* * *

## 回答 #23

> 赞同：60
> 
> 时间：2013-06-29T08:34:53.100

在[Spring](http://en.wikipedia.org/wiki/Spring_Framework)中，您有一个定义的类型：`MediaType.APPLICATION_JSON_VALUE`相当于*application/json*。

* * *

## 回答 #24

> 赞同：55
> 
> 时间：2015-02-06T12:01:14.770

对于 JSON，我正在使用：

```
Content-Type: application/json 
```

这在 IETF 的 JSON 数据交换格式 7158 提案[第 1.2 节：JSON 规范中进行了描述](https://www.rfc-editor.org/rfc/rfc7158#section-1.2)。

* * *

## 回答 #25

> 赞同：52
> 
> 时间：2013-06-21T15:22:12.830

如果 JSON 带有填充，那么它将是`application/jsonp`. 如果 JSON 没有填充，那么它将是`application/json`.

要同时处理这两种情况，最好使用：'application/javascript'，而不用担心它是带填充还是不带填充。

* * *

## 回答 #26

> 赞同：51
> 
> 时间：2017-08-08T03:49:59.413

*   `Content-Type: application/json`- JSON
*   `Content-Type: application/javascript`- [JSON-P](https://en.wikipedia.org/wiki/JSONP)
*   `Content-Type: application/x-javascript`- JavaScript
*   `Content-Type: text/javascript`- JavaScript*但*已过时。旧的 Internet Explorer 版本用于将其用于 HTML 属性。
*   `Content-Type: text/x-javascript`- JavaScript 媒体类型，*但*已过时
*   `Content-Type: text/x-json`-*应用程序/json*正式注册之前的 JSON。

* * *

## 回答 #27

> 赞同：47
> 
> 时间：2015-06-09T19:12:56.680

当您在 REST 上下文中使用 JSON 时，扩展接受的响应...

关于使用以及何时表示 REST 资源和集合有一个[强烈的争论。](http://restful-api-design.readthedocs.org/en/latest/resources.html#content-types)`application/x-resource+json``application/x-collection+json`

如果您决定遵循**jsonapi**规范，[您应该](http://jsonapi.org/format/#content-negotiation)使用 of `application/vnd.api+json`，因为它已记录在案。

尽管没有通用标准，但很明显，为正在传输的资源添加的语义证明了*比*仅`application/json`.

按照这个推理，其他上下文可以证明更具体*的 Content-Type*是合理的。

* * *

## 回答 #28

> 赞同：46
> 
> 时间：2014-03-29T05:43:05.133

PHP 开发人员使用这个：

```
<?php
    header("Content-type: application/json");

    // Do something here...
?> 
```

* * *

## 回答 #29

> 赞同：46
> 
> 时间：2016-04-11T09:15:26.297

如果您以 JSON 格式从 REST API 获取数据，则必须使用*[Content-Type](https://en.wikipedia.org/wiki/MIME#Content-Type)*：

*   对于 JSON 数据：*Content-Type:application/json*
*   对于 HTML 数据：*Content-Type:text/html*，
*   对于 XHTML 数据：*Content-Type:application/xhtml+xml*，
*   对于 XML 数据：*Content-Type:text/xml, application/xml*

* * *

## 回答 #30

> 赞同：33
> 
> 时间：2016-02-15T03:20:43.267

[JSON](https://en.wikipedia.org/wiki/JSON)（JavaScript 对象表示法）和[JSONP](https://en.wikipedia.org/wiki/JSONP)（“带有填充的 JSON”）格式似乎非常相似，因此它们应该使用哪种 MIME 类型可能会非常混乱。即使格式相似，它们之间也存在一些细微的差异。

因此，每当有任何疑问时，我都有一个非常简单的方法（在大多数情况下效果很好），即去检查相应的 RFC 文档。

**JSON** [RFC 4627](http://www.ietf.org/rfc/rfc4627.txt) (The application/json Media Type for JavaScript Object Notation (JSON)) 是 JSON 格式的规范。它在第 6 节中说，JSON 文本的 MIME 媒体类型是

```
application/json. 
```

**JSONP** JSONP（“带填充的 JSON”）在浏览器中的处理方式与 JSON 不同。JSONP 被视为常规 JavaScript 脚本，因此它应该使用`application/javascript,`JavaScript 的当前官方 MIME 类型。然而，在许多情况下，`text/javascript`MIME 类型也可以正常工作。

请注意，[RFC 4329](http://www.rfc-editor.org/rfc/rfc4329.txt)`text/javascript` （脚本媒体类型）文档已将其标记为过时，建议使用type 代替。然而，由于遗留的原因，它仍然被广泛使用并且它具有跨浏览器支持（这并不总是MIME 类型的情况，尤其是对于旧浏览器）。`application/javascript``text/javascript``application/javascript`

* * *

## 回答 #31

> 赞同：12
> 
> 时间：2017-01-03T22:15:21.763

[为了补充前面的答案，根据 W3C](https://www.w3.org/TR/json-ld-syntax/#iana-considerations)的 JSON 链接数据 (JSON-LD) 的 MIME 类型是：

> `application/ld+json`
> 
> **类型名称：**应用程序
> 
> **子类型名称：** ld+json

此外，来自同一来源：

> **文件扩展名**：
> 
> `.jsonld`

* * *

## 回答 #32

> 赞同：12
> 
> 时间：2019-04-08T20:37:39.963

由于您可能需要更频繁地使用这些内容，因此即使有[很多内容类型，也请始终尝试记住这三种内容类型](https://github.com/h5bp/server-configs-nginx/blob/master/mime.types)：

*   内容类型：应用程序/json
*   内容类型：应用程序/xml
*   内容类型：文本/html

* * *

## 回答 #33

> 赞同：11
> 
> 时间：2016-09-04T10:21:20.690

要指定有趣的 JSON 结果，请在请求标头中添加“application/json”，如下所示：

“Accept:application/json”是所需的响应格式。

"Content-Type:application/json" 指定您请求的内容格式，但有时您同时指定`application/json`和`application/xml`，但它们的质量可能不同。哪个服务器会发回不同的响应格式，看例子：

```
Accept:application/json;q=0.4,application/xml;q=8 
```

这将返回 XML，因为 XML 具有更高的质量。

* * *

## 回答 #34

> 赞同：11
> 
> 时间：2016-10-17T21:40:46.053

正确的现行标准是`application/json`. 虽然默认编码是 UTF-8，但值得一提的是它也可以是 UTF-16 或 UTF-32。当 JSON 以 UTF-16 或 UTF-32 编写时，必须使用二进制内容传输编码。

RFC 4627中有关于 JSON 的更多信息*[：JavaScript Object Notation (JSON) 的 application/json 媒体类型](https://www.rfc-editor.org/rfc/rfc4627)*

有关二进制传输编码的更多信息，请参见*[5\. Content-Transfer-Encoding Header Field](https://www.w3.org/Protocols/rfc1341/5_Content-Transfer-Encoding.html)* (RFC 1341)。

* * *

## 回答 #35

> 赞同：7
> 
> 时间：2020-12-13T07:50:41.267

作为一些研究，

最常见的 MIME 类型是

**应用程序/json**

让我们看一个区分 JSON 和 JavaScript 的示例。

*   应用程序/json

当不知道如何使用这些数据时使用它。当信息只是以 JSON 格式从服务器中提取时，它可能是通过链接或从任何文件中提取的，在这种情况下，它会被使用。

例如-

```
<?php

    header('Content-type:application/json');

    $directory = [
            ['Id' => 1, 'Name' => 'this'],
            ['Id' => 2, 'Name' => 'is'],
            ['Id' => 3, 'Name' => 'Stack Overflow'],
        ];

    // Showing the JSON data

    echo json_encode($directory);
?> 
```

输出是，

```
[{"Id":1, "Name":"this"}, {"Id":2, "Name":"is"}, {"Id":3, "Name":"Stack Overflow"}] 
```

* * *

*   应用程序/javascript

它在预定义数据的使用时使用。它由客户端 Ajax 应用程序调用的应用程序使用。当数据是 JSON-P 或[JSONP](https://en.wikipedia.org/wiki/JSONP)类型时使用它。

例如

```
<?php

    header('Content-type:application/javascript');

    $dir = [
            ['Id' => 1, 'Name' => 'this' ],
            ['Id' => 2, 'Name' => 'is'],
            ['Id' => 3, 'Name' => 'Stack Overflow'],
    ];

    echo "Function_call(" . json_encode($dir) . ");";
?> 
```

输出是，

```
Function_call([{"Id":1, "Name":"this"}, {"Id":2, "Name":"is"}, {"Id":3, "Name":"Stack Overflow"}]) 
```

对于其他 MIME 类型，请参阅*[MIME 类型（IANA 媒体类型）](https://developer.mozilla.org/en-US/docs/Web/HTTP/Basics_of_HTTP/MIME_types)*中的完整详细信息。

* * *

## 回答 #36

> 赞同：4
> 
> 时间：2019-11-29T05:17:54.373

你的问题的一部分与我有关，因为我刚刚遇到它。

第三方提供商正在提供可供多个客户端使用的 REST 服务。它是一个简单的 REST，使用返回格式良好的 JSON 的查询参数调用。我已经用 PHP 和 Java 对其进行了测试，它按预期工作。

我的客户使用 Oracle Service Bus 作为其应用程序服务器和 Internet 之间的网关。当我创建 OSB 服务时，它因`Invalid message format`错误而崩溃。原来`content-type`被退回的是`text/html`. OSB 按照此标头处理响应；在文本、XML 和 JSON 之间进行转换。在这种情况下，响应是 JSON，但标头没有说明。联系提供商，我得到了答复：“我们不会更改它，因为它不会影响其他任何人”。

标`Content-Type`头指定内容**应该**是什么，而不是它**实际上**是什么。也就是说，在您的消费程序中，是否检查或忽略它并以任何方式处理内容取决于您。另一个例子，您可以返回 GIF 数据，但将内容类型指定为 JSON，然后继续忽略标头并读取图像数据。这不会伤害您的程序，但可能会伤害其他人。

故事的寓意：玩得好。

* * *

## 回答 #37

> 赞同：0
> 
> 时间：2022-03-02T14:18:17.377

这取决于观点。

如果您是发送请求的客户端，那么`application/json`是正确的选择。

但是如果你是接收请求的服务器，你必须做好准备，客户端也可能发送编码。所以`application/json`和`application/json; charset=utf-8`是有效的。

两种情况下的媒体类型相同。但内容类型不同。

# python - 与 Django 的“重组”模板标签等效的惯用 Python 是什么？

> ID：477820
> 
> 赞同：20
> 
> 时间：2009-01-25T15:29:44.457
> 
> 标签：python, django, django-templates

[http://docs.djangoproject.com/en/dev/ref/templates/builtins/#regroup](http://docs.djangoproject.com/en/dev/ref/templates/builtins/#regroup)

我可以想到几种使用循环的方法，但我特别想知道是否有一个整洁的单线。

* * *

## 回答 #1

> 赞同：36
> 
> 时间：2009-01-25T15:43:26.363

结合[`itertools.groupby`](http://docs.python.org/library/itertools.html#itertools.groupby)得到[`operator.itemgetter`](http://docs.python.org/library/operator.html#operator.itemgetter)一个很好的解决方案：

```
from operator import itemgetter
from itertools import groupby

key = itemgetter('gender')
iter = groupby(sorted(people, key=key), key=key)

for gender, people in iter:
    print '===', gender, '==='
    for person in people:
        print person 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2015-02-06T15:04:07.870

如果数据源（`people`在这种情况下）已经按键排序，则可以绕过`sorted`调用：

```
iter = groupby(people, key=lambda x:x['gender'])
for gender, people in iter:
    print '===', gender, '==='
    for person in people:
        print person 
```

注意：如果`sorted`是普通字典，则不保证顺序；因此你必须打电话`sorted`。在这里，我假设这`sorted`是一种`collections.OrderedDict`或其他类型的有序数据结构。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2015-06-08T04:34:08.243

以前的答案帮助我解决了我的问题。以供将来参考，如果您有一些嵌套数据，例如

> {'city_name'：'City1'，'comp_name'：'Company1'，'name'：'Branch1'}

并且您想按城市分组，然后按该城市的公司分组，例如：

```
City1
 Company 1
   Branch 1
   Branch 2
 Company 2
   Branch 1
 Company 3
   Branch 1
City2
 Company 2
   Branch 1
 Company 3
   Branch 1
   Branch 2
City3
 Company 1
   Branch 1
 Company 2
   Branch 1
   Branch 2 
```

我通过这样做解决了它：

```
key = itemgetter('city_name')    
iter = groupby(queryset, key=key) # assuming queryset is already sorted by city_name

for key, group in iter:
    print(key)
    key2 = itemgetter('company_name')
    iter2 = groupby(sorted(group, key=key2), key=key2) # now we must sort by company_name
    for comp, branch in iter2:
        print(comp)
        for b in branch:
            print(b) 
```

# c++ - cannot call base class protected functions?

> ID：477829
> 
> 赞同：7
> 
> 时间：2009-01-25T15:36:43.710
> 
> 标签：c++, inheritance

I cant call protected function in my base class. Why? It looks something like this:

```
class B : B2
{
public:
  virtual f1(B*)=0;
protected:
  virtual f2(B*) { codehere(); }
}
class D : public B
{
public:
  virtual f1(B*b) { return f2(b); }
protected:
  virtual f2(B*b) { return b->f2(this); }
} 
```

In msvc I get the error error C2248: 'name::class::f2' : cannot access protected member declared in class 'name::class'

In gcc I get error: 'virtual int name::class::f2()' is protected.

Why is that? I thought the point of protected members is for derived classes to call.

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-01-25T16:05:35.273

Protected member functions can only be called inside the base class or in its derived class. You cannot call them outside your class. Outside calling means calling a member function of a class-typed variable.

So

```
virtual f1(B*b) { return f2(b); } 
```

is ok, because f2 operates on the class itself. (called inside)

But

```
virtual f2(B*b) { return b->f2(this); } 
```

won't compile, because f2 operates on b not the class D itself. (called outside) It's illegal.

To fix it B::f2 should be public.

# javascript - 带有滚动的 Div 和带有绝对位置的内容

> ID：477834
> 
> 赞同：32
> 
> 时间：2009-01-25T15:40:32.360
> 
> 标签：javascript, html, css, internet-explorer

我有一个带有样式的“div”：`overflow-y: scroll; overflow-x: auto;` 我尝试在这个“div”中动态添加具有绝对或相对位置的图像。一切似乎都很好，直到用户尝试滚动“div”内容：图像相对于浏览器窗口保持在固定位置。这个问题似乎只在 IE(7) 中，在 Firefox 中一切都很好。有什么解决方案吗？

**编辑（回答下面提出的问题）：**我正在定位元素，因为我需要它显示在另一个元素的前面。

* * *

## 回答 #1

> 赞同：95
> 
> 时间：2009-01-25T17:34:02.023

我不知道这是 IE 中的错误还是“功能”，但我之前遇到过同样的事情。幸运的是，有一个简单的解决方法。只需将“ `position:relative`”添加到`<div>`具有可滚动内容的内容即可。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-01-26T05:03:45.220

将所有内容包装在页面上相对定位的包含 div 中：

```
<div style="display:block; position:relative; width:200px; height:200px; margin:0; padding:0;">
    <br />
    <img src="_foo_.gif" style="position:absolute; top:0; left:0; z-index:100;" />
    <br />
    <div style="overflow-x:auto; overflow-y:scroll; width:200px; height:200px; z-index:10; display:block; position:relative;">
        <br />[scrolling content]<br />
    </div>
    <br />
</div> 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-25T15:50:54.790

您需要为图像设置位置是否有特殊原因？它在 IE7 中运行良好，无需设置位置。

```
<div style="overflow-x:auto; overflow-y:scroll; width:200px; height:200px;"><img src=xxx.gif" width="200" height="250" /></div> 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-10-18T12:48:00.197

**尝试`float:left`或`float:right`使用`margin`**

我在 chrome`position:absolute`中遇到了同样的问题`overflow-y: auto;`。div 在滚动时被固定在那里的位置。

一个简单的解决方案是使用浮点数。

我的旧代码是-

```
position:absolute; right:10px; 
```

我用以下内容替换了它，它起作用了-

```
float:right; margin-right:10px; 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-26T04:50:57.443

如果您希望它能够滚动，则需要使用相对定位。诀窍是在第二个元素上使用负定位。

假设您有两个元素 A 和 B，并且您想将 B 放在 A 的前面。它看起来像这样：

```
<div id="A" style="position:relative; width:300px; height=240px;">Element A</div>

<div id="B" style="position:relative; width:300px; height=240px; top:-240px;">Element B</div> 
```

根据内容，您可能需要添加其他样式，例如“display:block;” 等等。 w3schools.com 是一个很好的资源

有关使用 CSS 进行 DIV 定位的优秀教程，请访问：

[http://www.barelyfitz.com/screencast/html-training/css/positioning/](http://www.barelyfitz.com/screencast/html-training/css/positioning/)

干杯

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-26T05:02:20.243

你知道吗，将绝对定位元素包装在相对定位的容器元素中可能更容易，我认为应该能够滚动......

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-26T05:08:52.557

我学到了很多东西：对于 IE6/IE7，它可能需要将图像作为包含 DIV 中的最后一个 DOM 元素，以使其出现在滚动 DIV 上。

* * *

## 回答 #8

> 赞同：-3
> 
> 时间：2009-01-25T19:48:23.560

声明`position: absolute;`意味着元素将相对于视口的左上角显示。使用`relative`而不是意味着您使用的值`left`并将`top`添加到`img`正常情况下的任何位置。

# java - Java：计算持续时间

> ID：477842
> 
> 赞同：1
> 
> 时间：2009-01-25T15:44:31.290
> 
> 标签：java, datetime, duration

我创建了以下代码来计算两个时间戳之间的持续时间，这两个时间戳可以有两种不同的格式：

```
public class dummyTime {
public static void main(String[] args) {
    try {
        convertDuration("2008-01-01 01:00 pm - 01:56 pm");
        convertDuration("2008-01-01 8:30 pm - 2008-01-02 09:30 am");
    } catch (Exception e) {
        e.printStackTrace();
    }
}

private static String convertDuration(String time) throws Exception {
    String ts[] = time.split(" - ");
    SimpleDateFormat formatNew = new SimpleDateFormat("HH:mm");
    Date beg, end;
    String duration = null;

    beg = getDateTime(ts[0]);
    end = getDateTime(ts[1], beg);

    duration = formatNew.format(end.getTime() - beg.getTime());
    System.out.println(duration + " /// " + time + " /// " + beg + " /// "
            + end);

    return duration;
}

private static Date getDateTime(String dateTime) throws ParseException {
    DateFormat formatOldDateTime = new SimpleDateFormat(
            "yyyy-MM-dd hh:mm aa");
    DateFormat formatOldTimeOnly = new SimpleDateFormat("hh:mm aa");
    Date date = null;

    try {
        date = formatOldDateTime.parse(dateTime);
    } catch (ParseException e) {
        date = formatOldTimeOnly.parse(dateTime);
    }

    return date;
}

private static Date getDateTime(String dateTime, Date orig)
        throws ParseException {
    Date end = getDateTime(dateTime);

    if (end.getYear() == 70) {
        end.setYear(orig.getYear());
        end.setMonth(orig.getMonth());
        end.setDate(orig.getDate());
    }

    return end;
}
} 
```

它生成的输出是：

```
01:56 /// 2008-01-01 01:00 pm - 01:56 pm /// Tue Jan 01 13:00:00 CET 2008 /// Tue Jan 01 13:56:00 CET 2008
14:00 /// 2008-01-01 8:30 pm - 2008-01-02 09:30 am /// Tue Jan 01 20:30:00 CET 2008 /// Wed Jan 02 09:30:00 CET 2008 
```

我的问题是：

1.  为什么结果总是错误的（总是+1h）？
2.  有什么更好的方法来识别没有日期的时间戳？== 70 看起来不太好，getDay 和 setDay 函数也被弃用了。

非常感谢，这个问题已经让我发疯了几个小时。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-25T16:02:09.243

您正在格式化一天中的时间，而不是小时数和分钟数。由于您在冬季处于 CET 时区 [中欧时间]，因此与 UTC（“GMT”）相差一小时。

您可能想要使用`Calendar`而不是`Date`. 或[乔达时间](http://joda-time.sourceforge.net/)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-25T16:03:20.690

1.  在我的电脑上，这已经关闭了 2 小时，因为我在 GMT+2，而你可能在 GMT+1。请注意`formatNew.format(end.getTime() - beg.getTime());`接收日期，即将您的 56 分钟视为 1970-01-01-00:56:00 GMT+1。要快速解决此问题，请致电`formatNew.setTimeZone( TimeZone.getTimeZone( "GMT" ) );`

2.  对于第二项，您可以检查 format-yyyy-MM-dd 是否失败（您发现解析错误），这就是您知道没有年份的方式。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-25T16:06:39.703

简单的回答：使用 SimpleDateFormat 来格式化代表一天中没有日期的时间的值是不合适的。

更长的答案：Java 时间值是自“纪元”以来的毫秒数：1970 年 1 月 1 日午夜，UTC。

SimpleDateFormat 假定您为其提供了一个有效的时间戳，并将本地化转换应用于日期和时间。我怀疑您的语言环境比格林威治标准时间（欧洲大陆）晚一小时，这就是为什么您看到的结果比格林威治标准时间晚一小时。

虽然您可以通过设置时区 GMT 来欺骗 SimpleDateFormat，但您最好使用显式数学显示持续时间：

```
int duration = 90;
System.out.printf("%02d:%02d", duration / 60, duration % 60); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2017-01-29T00:24:08.457

# c# - 我在哪里可以看到一些 WPF 功能的好例子？

> ID：477846
> 
> 赞同：4
> 
> 时间：2009-01-25T15:48:35.667
> 
> 标签：c#, .net, wpf

有什么用WPF写的好软件？

我不断听到它可以做什么。我想看到它在行动。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-25T15:55:38.787

一些样品

*   [http://bigpicture.vertigo.com/obama/](http://bigpicture.vertigo.com/obama/)
*   [http://www.photosuru.com/](http://www.photosuru.com/)
*   [http://seattlepi.nwsource.com/newsreader/](http://seattlepi.nwsource.com/newsreader/)

还可以看看[scott hanselman](http://www.hanselman.com/blog/CategoryView.aspx?category=WPF)的博客，通过 WPF 标签过滤，他写的文章非常好，他也有[播客](http://www.hanselminutes.com/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-25T16:04:07.943

[该站点](http://www.actiprosoftware.com/support/ResourceGuides/WPF/ViewCategory.aspx?ResourceGuideCategoryID=26)列出了相当多的 WPF 应用程序（许多来自[codeproject.com](http://www.codeproject.com)，但也来自各种其他来源）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-25T16:37:05.787

比利霍利斯在 DNRTV 上有一个很好的例子

[http://perseus.franklins.net/dnrtvplayer/player.aspx?ShowNum=0115](http://perseus.franklins.net/dnrtvplayer/player.aspx?ShowNum=0115)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-25T18:19:38.060

[MS Visual Studio 2010](http://www.microsoft.com/visualstudio/products/2010/default.mspx)是用 WPF 编写的！

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-25T17:02:22.867

为[Microsoft Surface](http://www.surface.com/)开发的一种方式是通过 WPF。因此，任何 Surface 示例都可能有助于展示可能性。

# objective-c - 在 Objective C 中检查 Internet 连接

> ID：477852
> 
> 赞同：15
> 
> 时间：2009-01-25T15:53:12.990
> 
> 标签：objective-c, ios, twitter

我一直在学习斯坦福 iPhone 编码课程，目前正在使用 Twitter API。我想做的是准确处理两种错误情况：一种是用户名无效，另一种是设备当前未连接到互联网。不幸的是，就目前而言，我能推测的最好的结果是 API 的返回是否为零 - 这两种情况都是如此。

我正在寻找的是一两行代码，可以在尝试获取任何远程数据之前检查连接。我可以筛选 Apple 文档，但我想：为什么不向你们提出这个问题，为了我的利益，也许是为了其他人的利益？

附加信息：在 XCode 中使用 Objective-C 和 iPhone SDK。

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2009-01-25T16:35:34.887

看一下 Apple 的示例代码。Reachability 项目展示了如何检测连接。

[http://developer.apple.com/iphone/library/samplecode/Reachability/index.html](http://developer.apple.com/iphone/library/samplecode/Reachability/index.html)

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-01-25T16:31:53.940

您需要阅读错误代码并尽可能做出响应。我在这方面有一些经验，这可能取决于您正在与之交互的服务，但是对于delicious.com，我收到错误用户/密码错误-1012，如果您查找它是

```
NSURLErrorUserCancelledAuthentication =     -1012, 
```

尽管显然该措辞具有误导性，但我可以始终如一地复制输入错误的用户/密码并获取该错误代码。从技术上讲，iPhone 永远不会没有连接到互联网，除非你在某个奇怪的地区，数据连接有问题。我也看到有错误代码

```
NSURLErrorNotConnectedToInternet =      -1009, 
```

我会通过[NSURLError.h](http://developer.apple.com/library/mac/#documentation/Cocoa/Reference/Foundation/Miscellaneous/Foundation_Constants/Reference/reference.html)（还有更多类似的）

```
NSURLErrorUnsupportedURL =          -1002,
NSURLErrorCannotFindHost =          -1003,
NSURLErrorCannotConnectToHost =         -1004,
NSURLErrorNetworkConnectionLost =       -1005, 
```

ETC...

您需要做的就是获取对您传入的 NSError 对象的引用并检查它的错误代码，如下所示

```
//NSError *returnedError

if([returnedError code] == kERROR_CODE_BAD_USERNAME_OR_PASSWORD) 
```

常量是我在自己的源代码中定义的，本质上是-1012

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-05-10T04:45:50.337

该代码有效，但并不总是产生所需的结果。

iPhone 上 TCP 堆栈的工作方式与预期的完全不同。使用“可达性”代码，有时会出现网络连接，但无法可靠地检测到。但是，启动 MobileSafari 然后重新尝试使用“Reachability”代码检查连接将产生正确的结果。

我发现确定网络连接最有效的方法是在应用程序加载时在单独的线程中运行 NSURLConnection 检查。调用您知道会返回类似“Yes”（即服务器上的 HTML 文件或其他内容）的 URL。然后检查以确保返回的结果等于静态文本。这样一来，您就知道 NSURLConnection 堆栈可以正确地伸出，而不是不能始终如一地工作的“Reachability”代码。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2009-03-26T15:18:22.390

这对我有用，取自苹果地震 xml 项目：

```
- (BOOL)isDataSourceAvailable
{
    static BOOL checkNetwork = YES;
    if (checkNetwork) { // Since checking the reachability of a host can be expensive, cache the result and perform the reachability check once.
        checkNetwork = NO;

        Boolean success;    
        const char *host_name = "twitter.com"; // your data source host name

        SCNetworkReachabilityRef reachability = SCNetworkReachabilityCreateWithName(NULL, host_name);
        SCNetworkReachabilityFlags flags;
        success = SCNetworkReachabilityGetFlags(reachability, &flags);
        _isDataSourceAvailable = success && (flags & kSCNetworkFlagsReachable) && !(flags & kSCNetworkFlagsConnectionRequired);
        CFRelease(reachability);
    }
    return _isDataSourceAvailable;
} 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2013-08-20T05:40:47.710

**可达性是单独的类，您可以访问代码**

```
 Reachability *curReach = [Reachability reachabilityForInternetConnection];
NetworkStatus netStatus = [curReach currentReachabilityStatus];
switch (netStatus)
{
    case NotReachable:
    {
        UIAlertView *connectionAlert = [[UIAlertView alloc] init];
        [connectionAlert setTitle:@"Error"];
        [connectionAlert setMessage:@"Please check your network connection."];
        [connectionAlert setDelegate:self];
        [connectionAlert setTag:1];
        [connectionAlert addButtonWithTitle:@"Back"];
        [connectionAlert show];

        break;
    }
    case ReachableViaWWAN:
    {

    }
    case ReachableViaWiFi:
    {
    }
} 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-01-25T15:59:05.957

您当前的连接代码是什么样的？如果你正在使用`NSURLConnection +sendSynchronousRequest:returningResponse:error:`，那么你只需要传递一个 NSError 变量的地址，然后检查它；，`connectionWithRequest:delegate:`您应该`-connection:didFailWithError:`在委托中实现。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2011-05-18T10:40:56.467

使用 Apple 的 Reachability 时请记住，即使您尝试访问 google.com 或 apple.com 之类的主机（可能是缓存问题）。我最终打电话给我自己的服务器并取回了一个数字——至少在我的情况下是最好的解决方案。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2012-08-14T06:40:38.223

```
-(BOOL)returnInternetConnectionStatus{
    ReachabilityLattest *reach = [ReachabilityLattest reachabilityForInternetConnection];
    NetworkStatus internetStatus = [reach currentReachabilityStatus];
    if ((internetStatus != NotReachable)) {
        return TRUE;
    } else {
        return FALSE;
    }
} 
```

# grails - 使用电子邮件服务的 Grails 错误

> ID：477863
> 
> 赞同：2
> 
> 时间：2009-01-25T16:02:56.573
> 
> 标签：grails, groovy, controller, service, email

这是控制器

> 类 JavaMailerController {
> 
> ```
> JavaMailerService javamailerservice
> def x = {javamailerservice.serviceMethod()} } 
> ```

这是服务

> 导入 javax.mail。*; 导入 javax.mail.internet。*; 导入 java.util.*；
> 
> 类 JavaMailerService {
> 
> ```
> boolean transactional = false
> 
> def serviceMethod() { String  d_email = "thisemail@gmail.com",
>         d_password = "thispassword",
>         d_host = "smtp.gmail.com",
>         d_port  = "587",
>         m_to = "thisto@gmail.com",
>         m_subject = "Testing",
>         m_text = "Hey, this is the testing email.";
> 
>     Properties props = new Properties();
>     props.put("mail.smtp.user", d_email);
>     props.put("mail.smtp.host", d_host);
>     props.put("mail.smtp.port", d_port);
>     props.put("mail.smtp.starttls.enable","true"); 
> ```
> 
> // 以防万一，但目前没有必要，奇怪的是 props.put("mail.smtp.auth", "true"); //props.put("mail.smtp.debug", "true"); props.put("mail.smtp.socketFactory.port", d_port); props.put("mail.smtp.socketFactory.class", "javax.net.ssl.SSLSocketFactory"); props.put("mail.smtp.socketFactory.fallback", "false");
> 
> ```
>  SecurityManager security = System.getSecurityManager();
> 
>     try
>     {
>         Authenticator auth = new SMTPAuthenticator();
>         Session session = Session.getInstance(props, auth);
>         //session.setDebug(true);
> 
>         MimeMessage msg = new MimeMessage(session);
>         msg.setText(m_text);
>         msg.setSubject(m_subject);
>         msg.setFrom(new InternetAddress(d_email));
>         msg.addRecipient(Message.RecipientType.TO, 
> ```
> 
> 新的互联网地址（m_to））；Transport.send(msg); } catch (Exception mex) { mex.printStackTrace(); } }
> 
> }
> 
> 私有类 SMTPAuthenticator 扩展 javax.mail.Authenticator { public PasswordAuthentication getPasswordAuthentication() { return new PasswordAuthentication(d_email, d_password); } }

错误

错误 200：java.lang.NullPointerException：无法在空对象上调用方法 serviceMethod() Servlet：grails URI：/JavaMailer/grails/javaMailer/x.dispatch 异常消息：无法在空对象上调用方法 serviceMethod() 原因：java。 lang.NullPointerException：无法在空对象上调用方法 serviceMethod() 类：未知在行：[-1] 代码片段：

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-26T04:05:11.233

我认为您没有在控制器中将您的服务字段骆驼化。

```
class JavaMailerController {
   JavaMailerService javaMailerService
   def x = {
      javaMailerService.serviceMethod()
   } 
} 
```

# algorithm - 找到顶点边缘（多边形）的最佳算法

> ID：477867
> 
> 赞同：5
> 
> 时间：2009-01-25T16:04:59.503
> 
> 标签：algorithm, polygon, vertices, edges, convex-hull

我有大量顶点，其中一些是边，一些是多余的（在形状内部），我想删除它们。

我能想到的最简单的算法是一一检查它们是否碰到了其他人形成的形状。但它应该是一个非常慢的算法。

我考虑过从边缘选择一个（每个示例离原点最远的一个）并计算从这个开始的最长路径......应该得到边缘路径，对吗？

有什么建议吗？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-01-25T16:44:51.887

多面体算法的诀窍是选择一个适合您的输入和所需输出的算法，因为表示多面体的方法不止一种，并且表示之间的转换可能很昂贵。在这种情况下，您从点开始并希望以顶点结束，因此计算[凸包顶点的](http://en.wikipedia.org/wiki/Convex_hull)[格雷厄姆扫描](http://en.wikipedia.org/wiki/Graham_scan)算法应该可以解决问题，尽管可能需要一些努力才能将其扩展到二维情况。输入顶点的数量为O( *n log n* )。

 ** * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-01-25T16:22:17.987

我不知道找到该多边形的最佳算法是什么，但您正在寻找的多边形称为“凸壳”。

通过搜索，您应该找到匹配算法。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-26T07:10:36.600

[凸壳](http://en.wikipedia.org/wiki/Convex_hull)是计算几何中研究较多的问题之一。格雷厄姆扫描是最简单的[凸包算法](http://en.wikipedia.org/wiki/Convex_hull_algorithms)之一，但肯定不是唯一的。[礼品包装算法](http://en.wikipedia.org/wiki/Gift_wrapping_algorithm)，也称为 Jarvis' March，是我所知道的最简单的算法。[Stony Brook 算法存储库](http://www.cs.sunysb.edu/~algorith/files/convex-hull.shtml)有几种 C 和 C++ 中凸包算法的实现。[Geometry in Action](http://www.ics.uci.edu/~eppstein/gina/hull.html)主要展示了凸包的应用。[这是一个低维](http://www.geom.uiuc.edu/software/cglist/lowdvod.html)和[任意维](http://www.geom.uiuc.edu/software/cglist/ch.html)凸包计算程序的集合。

# java - eclipse ini 配置

> ID：477871
> 
> 赞同：10
> 
> 时间：2009-01-25T16:07:07.500
> 
> 标签：java, eclipse, configuration, heap-memory, ini

实际上我和我的朋友正在尝试学习和使用 eclipse 3.4，我们在工作时遇到了一些堆内存问题，我的朋友建议增加 eclipse ide 的内存分配，因为他有 4GB RAM，他想分配足够的堆，分配体面的烫发大小，并为这个 Eclipse IDE 启用并行垃圾收集。

我们人们无法通过修改 eclipse.ini 文件来实现这一点，他想为 eclipse 分配 1GB 的 RAM。

请帮助我们

谢谢

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-12-17T10:42:04.310

仅供参考：正如 Carsten 所说，该`eclipse.ini`文件对其行的顺序和格式非常挑剔。[这](http://wiki.eclipse.org/Eclipse.ini)是他们的 Wiki 页面，带有一些示例配置。
正如他们所说，请记住：

> 1.  每个选项和选项的每个参数都必须在自己的行中。
> 2.  之后的所有行都`-vmargs`作为参数传递给 JVM，因此必须在之前指定 eclipse 的所有参数和选项`-vmargs`（就像在命令行上使用参数时一样）

因此，例如，您可以`MaxPermSize`使用 Eclipse 启动器特定的选项来设置 （第一行的选项名称，下一行的选项值）：

```
--launcher.XXMaxPermSize
256m 
```

然后，在`-vmargs`选项名称之后，您可以传递与垃圾收集器相关的参数。例如：

```
-vmargs
-XX:-UseParallelGC 
```

希望能帮助到你。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-01-25T16:32:17.577

现代机器上的默认分配是荒谬的；我希望 Eclipse 将默认值调整为实际机器，或者至少更具交互性。

正如 Eric 所建议的，您应该增加最大堆。但是，您可能还需要调整 permgen。

我在某处看到以下数字：

对于 512MB 内存：-Xms256m -Xmx256m -XX:PermSize=64m -XX:MaxPermSize=64m

对于 1024MB 内存：-vmargs -Xms512m -Xmx512m -XX:PermSize=128m -XX:MaxPermSize=128m

对于 4GB 内存，如果需要，建议使用 1024m 内存，如果需要，建议使用 512m permgen。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2013-02-08T13:41:38.267

我对 8GB RAM 的配置：

```
--launcher.XXMaxPermSize
128M
-Xms1024m
-Xmx2048m
-XX:MaxPermSize=1048m 
```

我为 Xms 赋予高值的原因是我不想在开始时等待并观察内存使用量的持续增加。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-01-25T16:13:30.937

将此行放入 eclipse.ini 中：

> -Xmx1024m

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2013-07-05T10:15:34.640

您可以`-XX:MaxPermSize=1024M`在 eclipse.ini中添加，**或者**您可以在命令行中使用参数调用 Eclipse.exe，或者通过更新快捷方式中的“目标路径”，

```
eclipse -vmargs -XX:PermSize=512M -XX:MaxPermSize=1024M 
```

[http://wiki.eclipse.org/Eclipse.ini](http://wiki.eclipse.org/Eclipse.ini) [http://wiki.eclipse.org/FAQ_How_do_I_increase_the_permgen_size_available_to_Eclipse%3F](http://wiki.eclipse.org/FAQ_How_do_I_increase_the_permgen_size_available_to_Eclipse%3F)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2012-09-12T14:50:27.647

通常，适当的优化还取决于您的 vm 版本和底层硬件。

看看这个： [http ://www.oracle.com/technetwork/java/javase/tech/vmoptions-jsp-140102.html#PerformanceTuning](http://www.oracle.com/technetwork/java/javase/tech/vmoptions-jsp-140102.html#PerformanceTuning)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2011-07-19T12:04:28.427

这是我在 4GB Mac 上的配置：

-Xms1256m -Xmx1256m -XX:MaxPermSize=666m -XX:PermSize=666m

这是允许的最大值，当我尝试更多时，它告诉我“无法启动虚拟机”。效果很好 ：）

# visual-studio-2008 - 受信任域中的 Microsoft Studio TFS 代理问题

> ID：477876
> 
> 赞同：2
> 
> 时间：2009-01-25T16:14:27.423
> 
> 标签：visual-studio-2008, tfs, active-directory, trust

我有两个域。TFS 2008 安装在 DEV 域上，代理在 PROD 上。存在双向信任，两个服务器都可以对来自两个域的用户进行身份验证。

*   TFS 工作正常，突然停止。查看日志有很多 AD 噪音（无法加载全局目录等）。域（DEV 和 PROD）之间的信任一直有效

*   我发现 BDC 存在一些错误，因此我将其删除 - 无法正常执行，必须重建服务器。

*   当 BDC 关闭时，TFS 代理正在工作。

*   重新安装 BDC 后，TFS 代理停止工作。

*   为了确保这一点，我从 BDC 中删除了 AD 角色。TFS 代理再次工作

*   加了角色，TFS P死了。

*   现在没有与 AD 相关的错误，站点复制良好，信任仍然很好。

*   尝试在另一台服务器上设置 TFS P，如果我将 DEV\TFSService 作为用户运行，安装会在中间严重崩溃。如果我给它一个 PROD 域中的用户，它可以毫无问题地安装 - 但当然，它不起作用。

*   我在 TFS P 服务器上添加了 DEV\TFSService 作为管理员，没有变化。

*   我在主 TFS 服务器上添加了 PROD\tfspRunningUser 作为管理员，没有变化。

你能想到其他可能导致失败的组件吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-18T08:45:38.660

在 TFS 服务器（而不是代理）上更新 .NET 后，最终解决了这个问题。这很奇怪，因为 TFS 代理在域中的其他服务器上运行良好——不过，更新后问题消失了......

# c++ - 创建全局已知并自动删除的临时目录（C++）？

> ID：477880
> 
> 赞同：1
> 
> 时间：2009-01-25T16:19:27.600
> 
> 标签：c++, file-io, global-variables, signal-handling

在 C++ 中，我有一些函数需要写入临时目录。理想情况下，只创建一个它们都写入的临时目录（以最小化 I/O 开销）。该目录应在程序退出时自动删除。

但是，我不想在主函数中处理临时目录的创建和删除，因为我认为只有实际使用该目录的函数才应该负责它的创建和删除。并且 main 函数并不一定知道使用了一个临时目录。

这是我尝试过的（参见下面的代码）： 可以从任何地方全局调用的 getTempDir() 函数仅在第一次调用时创建一个目录，并在每次调用时返回目录名称。在第一次调用时，它还会为一个小 DirRemover 对象创建一个静态 boost::shared_ptr，该对象的析构函数将删除目录。程序退出时会自动调用该析构函数。

问题是它不会在程序不成功退出或杀死等时调用 FileRemover 析构函数。有更好的解决方案吗？

这是代码：

```
std::string getTempDir(){
  static bool alreadyThere = false;
  static std::string name = "";
  if(!alreadyThere){
    // create dir with
    // popen("mktemp -p /tmp","r")) 
    // and store its name in 'name' 
    removeAtEnd(name);
    alreadyThere = true;
  }
  return name;
}

void removeAtEnd(const std::string& name){
  static boost::shared_ptr<DirRemover> remover(new DirRemover(name));
}

struct DirRemover {
  std::string name;
  DirRemover(const std::string& n) : name(n){}
  ~DirRemover(){
    // remove 'name' dir with popen("rm -r ...")
  }
}; 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-25T17:54:48.563

使用 popen() 执行诸如“rm -r”或“mktemp -p /tmp”之类的东西是灾难的根源。在我看来，这是非常糟糕的风格。

UNIX 特定：如果您希望临时文件消失，即使您的应用程序异常终止，那么最好的方法是在打开临时文件后立即取消链接。您的应用程序仍将拥有它们的文件句柄，以便您可以使用该文件。当您的应用程序终止并关闭文件描述符时，该文件将自动从文件系统中删除。

顺便说一句，我看到你正在使用 Boost。您确定 Boost.Filesystem 没有上述功能吗？

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-25T16:52:50.687

对于 Unix：

```
::signal(SIGINT, sigintHandler);
::signal(SIGKILL, sigkillHandler); //etc 
```

让这些处理程序将退出事件推送到您的事件队列（或等效项）并忽略该信号。然后，您的应用程序将能够正常退出。但是，有一个信号 (SIGKILL) 不容忽视。~~*为了处理这个问题，确定你真正*~~~~想在一次杀戮时释放的最关键的资源（我不相信临时目录有那么重要。只需在下次启动时删除。），然后在你的处理程序中，在你的相关单例上调用一个函数.**`release`**~~

 *详细说明**单例**。`::signal`无法调用绑定函数，因此您的处理程序只能访问单例/全局变量。如果你的设计没有用单例组织事物（它不应该），你仍然可以经常破解它。例如，如果您在堆栈中有多个 MainWindows，那么您还可以拥有一个指向所有它们的全局指针向量，如果需要，您可以从处理程序中访问它。

请注意，对于常见的杀戮（例如 with `kill foo`），您会得到 SIGQUIT 而不是 SIGKILL - 并且 SIGQUIT 可以忽略不计。SIGKILL 仅用于`kill -9 foo`（在这种情况下，用户~~可能~~甚至不*希望*您进行清理）。

是的，信号很复杂。

**编辑-**我被告知 SIGKILL 不仅不可忽视，而且不可*捕获*。的确，在 SIGKILL 上你可以做的事情并不多。删除临时目录？为什么？那个临时目录在那里是有原因的。

只是假装 sigkill 是停电并在下次启动时恢复 - 除非您可以按照其他人关于取消链接的评论进行特定的黑客攻击。

这就是我说出来的结果。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-25T16:31:09.653

如果您的进程被杀死（例如，从任务管理器中），则无法进行任何清理。

如果您的程序停止，其他进程应该进行清理。启动该进程并将您的程序作为其子进程启动。此过程在启动程序之前创建临时目录，并在程序完成后将其删除。

尽管如果您的包装进程被杀死，这仍然不能解决问题。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-25T19:39:40.537

几个想法：

*   **保持最小耦合**：为什么不创建一个服务类，它位于您的其他代码和内容写入位置以及何时删除的详细信息之间？使用通常的*单例模式*方法来确保它只被初始化一次。

*   **确保删除**：已经提到信号是一种允许您在发生 SIGFPE、SIGSEGV、SIGTERM 等事件时优雅地清理的方法……在发生 SIGSTOP 或 SIGKILL 时，这些都没有帮助。但是，对于在磁盘上创建文件的文件，有一个旧的 unix 技巧，然后`unlink`它---此时文件仍在使用中并且实际上并没有被删除，但是当你的程序放弃它的文件时描述符---你会得到自动删除。我不知道这将如何与目录一起使用，但是您当然可以使其与其中包含的所有文件一起使用。作为奖励（或成本，取决于），在调用`unlink`.

* * *

**补充**：另见：

*   [如何保证在运行时解密的文件被清理干净？](https://stackoverflow.com/questions/278273/how-to-guarantee-files-that-are-decrypted-during-run-time-are-cleaned-up)
*   [程序终止时保证文件删除 (C/C++)](https://stackoverflow.com/questions/471344/guaranteed-file-deletion-upon-program-termination-c-c)

# java - Java：分配未初始化的内存块？

> ID：477881
> 
> 赞同：1
> 
> 时间：2009-01-25T16:19:33.233
> 
> 标签：java, memory-management

有没有办法在 Java 中分配未初始化的内存块，例如包含碰巧留下的任何垃圾的数组？我想这样做是为了对 Java 的内存分配器/垃圾收集器分配/释放内存块的速度进行基准测试。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-25T16:22:15.973

不，您不能将分配与初始化分开，至少不能用于数组。

究竟是什么，您要进行基准测试？

我问的原因是，在运行的 JVM 中有很多变量会影响任何对象分配时间，从对象的大小（决定分配的位置）到 JVM 中发生的其他事情同时（一旦你开始分配对象，它们将在不同代之间被打乱），Hotspot 是否决定你的代码没有做任何事情并且可以被无操作替换。

顺便说一句，有一组类似但不重叠的变量妨碍了对 malloc() 进行基准测试...

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-25T16:36:28.673

如果你能做到这一点，你就会对实际程序中不会发生的事情进行基准测试，因此结果将没有任何意义。

我做了类似的事情，发现分配大约需要 250 ns 50% 的时间和 500 ns 或更多 10% 的时间和大约 1,200 ns，1% 的时间。

这取决于您的处理器速度、机器的内存架构以及您正在创建的对象。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-25T17:00:46.677

我想你不能这样做的原因之一是安全模型。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-25T17:45:15.667

也许 java.nio.ByteBuffer 是您正在寻找的。你的理由有点模糊:-)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-25T17:26:07.687

您可以做您所询问的唯一方法是通过 JNI，这将使您获得的任何基准测试都没有实际意义，因为它不会反映真正的 Java 使用情况。由于其他人已经给出的原因。通过 Java（通过“new”）进行的任何分配都将始终初始化内存。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-26T05:02:54.143

无法分配未初始化的内存块*并*通过“正常”分配/GC机制。

您*可以*做的是在任意内存地址（来自本机方法）构造一个直接的 ByteBuffer。但这不会为您提供“正常”对象处理的基准（尽管如果您想要基准的东西是正常的分配/释放，则不清楚为什么要这样做）。

# c++ - Visual C++ express 2008：为什么它会在发布可执行文件的末尾放置兆字节的空字节？

> ID：477885
> 
> 赞同：3
> 
> 时间：2009-01-25T16:22:34.677
> 
> 标签：c++, visual-c++, size, release-mode

最近我发现我的发布可执行文件（使用 msvc++ express 2008 制作）变得非常大。当我使用十六进制查看器检查可执行文件时，我看到只有前 300k 字节包含有用数据，其余字节仅为零 - 6 兆零字节。

调试构建的 exe 大小为 1MB，但发布版本为 6.5MB。

为什么 MSVC++ express 做那件没用的事情？我该如何解决？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-01-25T16:26:36.277

您是否在程序的文件范围内定义了大型数组？这可能是原因之一。您可以使用 dumpbin 程序查看 exe 文件中的每个部分占用了多少空间，这应该可以为您提供“为什么”的线索。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-25T17:23:57.033

也许您在发布时静态链接您的 .exe，但在调试时动态链接？检查这是对话框项目属性。

另一种可能性是在发布模式下很多函数是内联的，或者你使用了很多模板。

您可以在“项目属性”对话框中告诉编译器优化大小。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-25T16:39:41.447

Release 比 Debug 大 6 倍——可能有问题。尝试创建一个新项目并复制您的源代码。编译它，看看你得到了什么 Debug 和 Release 可执行文件。

# java - JSP生成Excel电子表格（XLS）下载

> ID：477886
> 
> 赞同：5
> 
> 时间：2009-01-25T16:22:43.023
> 
> 标签：java, excel, jsp, tomcat, export

我有这个在 JSP 中开发的应用程序，我希望以 XLS（MS Excel 格式）从数据库中导出一些数据。

在tomcat下是否可以像普通Java应用程序一样编写文件，然后生成指向该文件的链接？还是我需要为此使用特定的 API？

这样做时我会遇到权限问题吗？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-01-25T17:26:52.083

[虽然您可以使用像JExcelAPI](http://jexcelapi.sourceforge.net/)这样的完整库，但如果您将响应 MIME 类型设置为“application/vnd.ms-excel”之类的内容，Excel 还将读取 CSV 和纯 HTML 表格。

根据电子表格需要的复杂程度，CSV 或 HTML 可以在没有第三方库的情况下为您完成这项工作。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2010-01-28T11:53:07.187

不要使用带有`application/vnd.ms-excel`内容类型的纯 HTML 表格。然后，您基本上是在用错误的内容类型欺骗 Excel，这将导致最新 Excel 版本中的失败和/或警告。当您在 Excel 中编辑和保存原始 HTML 源代码时，它也会弄乱它。只是不要那样做。

反过来，CSV 是一种标准格式，它可以毫无问题地从 Excel 中获得默认支持，并且实际上生成起来很容易且节省内存。尽管有库，但实际上您也可以轻松地在不到 20 行中编写一个（对于那些无法抗拒的人来说很有趣）。您只需要遵守[RFC 4180](http://www.rfc-editor.org/rfc/rfc4180.txt)规范，它基本上只包含 3 条规则：

1.  字段用逗号分隔。
2.  如果逗号出现在字段中，则该字段必须用双引号括起来。
3.  如果一个字段中出现双引号，则该字段必须用双引号括起来，并且该字段内的双引号必须用另一个双引号转义。

这是一个启动示例：

```
public static <T> void writeCsv (List<List<T>> csv, char separator, OutputStream output) throws IOException {
    BufferedWriter writer = new BufferedWriter(new OutputStreamWriter(output, "UTF-8"));
    for (List<T> row : csv) {
        for (Iterator<T> iter = row.iterator(); iter.hasNext();) {
            String field = String.valueOf(iter.next()).replace("\"", "\"\"");
            if (field.indexOf(separator) > -1 || field.indexOf('"') > -1) {
                field = '"' + field + '"';
            }
            writer.append(field);
            if (iter.hasNext()) {
                writer.append(separator);
            }
        }
        writer.newLine();
    }
    writer.flush();
} 
```

这是一个如何使用它的示例：

```
public static void main(String[] args) throws IOException {
    List<List<String>> csv = new ArrayList<List<String>>();
    csv.add(Arrays.asList("field1", "field2", "field3"));
    csv.add(Arrays.asList("field1,", "field2", "fie\"ld3"));
    csv.add(Arrays.asList("\"field1\"", ",field2,", ",\",\",\""));
    writeCsv(csv, ',', System.out);
} 
```

在 Servlet 内部（是的，Servlet，不要为此使用 JSP！）您基本上可以这样做：

```
protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
    String filename = request.getPathInfo().substring(1);
    List<List<Object>> csv = someDAO().findCsvContentFor(filename);
    response.setHeader("content-type", "text/csv");
    response.setHeader("content-disposition", "attachment;filename=\"" + filename + "\"");
    writeCsv(csv, ';', response.getOutputStream());
} 
```

将此 servlet 映射到类似的东西上`/csv/*`并将其调用为类似`http://example.com/context/csv/filename.csv`. 就这样。

请注意，我添加了单独指定分隔符的可能性，因为它可能取决于使用的语言环境，Excel 是否接受逗号`,`或分号`;`作为 CSV 字段分隔符。请注意，我还将文件名添加到 URL 路径信息中，因为由 Redmond 的团队开发的某个网络浏览器不会使用正确的文件名保存下载。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-25T16:33:12.707

您可能需要一个库来操作 Excel 文件，例如[JExcelAPI](http://jexcelapi.sourceforge.net/) ("jxl") 或[POI](http://poi.apache.org/)。我对jxl比较熟悉，它当然可以写文件。您可以通过向它们提供 URL 来生成和存储它们，但我不会。生成的文件很痛苦。它们在并发、清理过程等方面增加了复杂性。

如果您可以动态生成文件并通过标准 servlet 机制将其流式传输到客户端。

如果它生成了很多次，或者生成很昂贵，那么您可以以某种方式缓存结果，但我更倾向于将其保存在内存中而不是作为文件。如果可以的话，我当然会避免通过 URL 直接链接到生成的文件。如果您通过一个 servlet，它将允许您稍后更改您的实施。这与 OO 设计中的封装概念相同。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-05-18T15:34:02.743

POI 或 JExcel 是很好的 API。我个人喜欢更好的 POI，而且 POI 会不断更新。此外，如果您有任何问题，网上有比 JExcel 更多的关于 POI 的资源。但是，两者中的任何一个都做得很好。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-25T16:43:09.130

也许您应该考虑使用一些报告工具，可以选择将文件导出为 XLS 格式。我的建议是 JasperReports

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2015-07-07T14:15:24.497

```
 try {
            String absoluteDiskPath =  test.xls";
            File f = new File(absoluteDiskPath);
            response.setContentType("application/xlsx");
            response.setHeader("Content-Disposition", "attachment; filename=" + absoluteDiskPath);
            String name = f.getName().substring(f.getName().lastIndexOf("/") + 1, f.getName().length());
            InputStream in = new FileInputStream(f);
            out.clear(); //clear outputStream prevent illegalStateException write binary data to outputStream
            ServletOutputStream outs = response.getOutputStream();
            int bit = 256;
            int i = 0;
            try {
                while ((bit) >= 0) {
                    bit = in.read();
                    outs.write(bit);
                }
                outs.flush();
                outs.close();
                in.close();
            } catch (IOException ioe) {
                ioe.printStackTrace();
            } finally {
                try {
                    if(outs != null)
                        outs.close(); 
                    if(in != null)
                        in.close(); 
                }catch (Exception ioe2) {
                    ioe2.printStackTrace(); 
                }
            }
    } catch (Exception ex) {
        ex.printStackTrace();

    } 
```

# javascript - 在 jQuery 中，将数字格式化为 2 位小数的最佳方法是什么？

> ID：477892
> 
> 赞同：70
> 
> 时间：2009-01-25T16:28:19.923
> 
> 标签：javascript, jquery, rounding, decimal-point, number-formatting

这就是我现在所拥有的：

```
$("#number").val(parseFloat($("#number").val()).toFixed(2)); 
```

在我看来它很乱。我认为我没有正确链接功能。我必须为每个文本框调用它，还是可以创建一个单独的函数？

* * *

## 回答 #1

> 赞同：108
> 
> 时间：2009-01-25T20:55:25.780

如果您要对多个字段执行此操作，或者经常执行此操作，那么也许一个插件就是答案。
这是一个 jQuery 插件的开始，它将字段的值格式化为两位小数。
它由字段的 onchange 事件触发。你可能想要一些不同的东西。

```
<script type="text/javascript">

    // mini jQuery plugin that formats to two decimal places
    (function($) {
        $.fn.currencyFormat = function() {
            this.each( function( i ) {
                $(this).change( function( e ){
                    if( isNaN( parseFloat( this.value ) ) ) return;
                    this.value = parseFloat(this.value).toFixed(2);
                });
            });
            return this; //for chaining
        }
    })( jQuery );

    // apply the currencyFormat behaviour to elements with 'currency' as their class
    $( function() {
        $('.currency').currencyFormat();
    });

</script>   
<input type="text" name="one" class="currency"><br>
<input type="text" name="two" class="currency"> 
```

* * *

## 回答 #2

> 赞同：65
> 
> 时间：2009-01-25T16:59:47.940

也许像这样，如果你愿意，你可以选择多个元素？

```
$("#number").each(function(){
    $(this).val(parseFloat($(this).val()).toFixed(2));
}); 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2012-11-27T16:33:08.253

我们将 Meouw 函数修改为与 keyup 一起使用，因为当您使用输入时，它会更有帮助。

检查这个：

嘿！，@heridev 和我在 jQuery 中创建了一个小函数。

您可以尝试下一个：

HTML

```
<input type="text" name="one" class="two-digits"><br>
<input type="text" name="two" class="two-digits">​ 
```

jQuery

```
// apply the two-digits behaviour to elements with 'two-digits' as their class
$( function() {
    $('.two-digits').keyup(function(){
        if($(this).val().indexOf('.')!=-1){         
            if($(this).val().split(".")[1].length > 2){                
                if( isNaN( parseFloat( this.value ) ) ) return;
                this.value = parseFloat(this.value).toFixed(2);
            }  
         }            
         return this; //for chaining
    });
}); 
```

​ 在线演示：

[http://jsfiddle.net/c4Wqn/](http://jsfiddle.net/c4Wqn/)

（@heridev，@vicmaster）

# algorithm - 构造多边形的轮廓（特别是三角剖分）

> ID：477894
> 
> 赞同：4
> 
> 时间：2009-01-25T16:30:01.217
> 
> 标签：algorithm, contour, triangulation, polygons

我将如何构建仅由三角形形成的二维多边形的轮廓，它可以有孔，外部轮廓可以是凹/凸，孔也可以是凹/凸。

从[我在这里阅读的](https://stackoverflow.com/questions/406301/polygon-triangulation-with-holes)内容来看，这似乎正是三角测量问题的反面。你知道任何处理这类问题的文章吗？

八叉树/四叉树与此相关吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-25T17:45:07.147

我猜你有三点集合形式的数据，它们构成一个“填充”三角形，这些三角形沿着边缘相邻，并且所有将成为完整形状角的顶点也是所有三角形的顶点即触及这一点。然后，您只需要找到所有不加倍的边，即不属于两个相邻的三角形。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-09-19T20:37:32.607

我认为您可以通过创建一个拓扑数据结构来表示您的一组三角形，然后使用该结构在位于边界上的三角形边上按顺序迭代来解决您的问题。

例如：您可以创建一个半边数据结构。假设您甚至在边界上插入半边（正确地），迭代边界轮廓就像在边界上定位一个半边然后迭代它的“下一个”指针，直到你回到你开始的半边。

与半边类似，您可以使用其他拓扑结构，如翼边等，但概念是相同的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2020-05-26T11:10:23.740

这是一个在三角形网格上运行的实现，查找并连接所有非双重边，如[本答案](https://stackoverflow.com/a/477976/2292832)中所述。

```
#include <list>
#include <map>
#include <set>
#include <vector>
#include <iostream>

typedef int Vertex;

class Triangle {
public:
    const Vertex& operator [] (size_t i) const {
        return p[i];
    }
    Vertex p[3];
};

std::list<std::list<Vertex>> find_contours(const std::vector<Triangle>& triangles) {

    std::set<std::pair<Vertex, Vertex>> edges;
    std::map<Vertex, Vertex> neighbors;
    for(const auto& t : triangles) {
        edges.insert(std::make_pair(t[0], t[1]));
        edges.insert(std::make_pair(t[1], t[2]));
        edges.insert(std::make_pair(t[2], t[0]));
    }
    for(const auto& t : triangles) {
        edges.erase(std::make_pair(t[1], t[0]));
        edges.erase(std::make_pair(t[2], t[1]));
        edges.erase(std::make_pair(t[0], t[2]));
    }
    for(const auto& t : triangles) {
        if (edges.find(std::make_pair(t[0], t[1])) != edges.end()) {
            neighbors[t[0]] = t[1];
        }
        if (edges.find(std::make_pair(t[1], t[2])) != edges.end()) {
            neighbors[t[1]] = t[2];
        }
        if (edges.find(std::make_pair(t[2], t[0])) != edges.end()) {
            neighbors[t[2]] = t[0];
        }
    }
    std::list<std::list<Vertex>> result;
    while(!neighbors.empty()) {
        std::list<Vertex> contour;
        auto v0 = neighbors.begin()->first;
        auto v = v0;
        while(neighbors.find(v) != neighbors.end()) {
            contour.push_back(v);
            auto old_v = v;
            v = neighbors.at(v);
            neighbors.erase(old_v);
        }
        if (v != v0) {
            throw std::runtime_error("Contour is not closed");
        }
        neighbors.erase(v);
        result.push_back(contour);
    }
    return result;
}

int main() {
    int v00 = 0;
    int v10 = 1;
    int v01 = 2;
    int v11 = 3;
    std::vector<Triangle> v{
        {v00, v10, v11},
        {v00, v11, v01}};
    for(const auto& c : find_contours(v)) {
        for(const auto& v : c) {
            std::cerr << v << " | ";
        }
        std::cerr << std::endl;
    }
    std::cerr << std::endl;
    return 0;
} 
```

# facebook - facebook 的分享链接功能如何运作？

> ID：477899
> 
> 赞同：2
> 
> 时间：2009-01-25T16:33:46.107
> 
> 标签：facebook

我正在尝试实现一个功能，比如用户输入一个 url 并且在显示该 url 时我想要一个自定义显示（如果是来自 youtube 的视频，则为嵌入对象，如果是图像链接，则为缩略图，标题和摘录如果是正常链接，则为正文）。

如何实现这样的功能？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-25T17:14:11.127

有一个名为 oEmbed 的新想法，一些网站（Flickr、Vimeo 和其他一些网站）支持解决这个问题。[o嵌入站点](http://oembed.com/)

否则，只需根据您选择的列表检查站点，然后提取相关位以构建嵌入链接。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-27T18:56:26.317

我非常喜欢 oEmbed 的想法，但不幸的是它还没有被广泛采用。oohEmbed 试图通过为许多网站构建 oEmbed 来解决这个问题。

为了使该功能正常工作，它需要服务器的交互，我相信以下场景是它的工作方式

假设我们有网站 humanzz.com 并且它提供了这样的功能

1.  用户在 humanzz.com 的网页上输入一个 url，然后按下一个按钮，如 facebooks 的预览按钮
2.  对 humanzz.com 上的专用页面进行 AJAX 调用
3.  humanzz.com 确实会调用远程网站并获取其数据
4.  AJAX 调用现在返回页面的数据（oEmbed JSON 对象）

这涉及太多服务器的开销。

我真的很想用 JavaScript 来做，因为服务器的角色只是绕过“同源策略”的限制。

oohEmbed 允许通过向 oohEmbed 指定回调参数来绕过服务器的步骤，以便将返回的 JSON 对象传递给页面上的回调函数。说明这一点的示例如下

将脚本标签动态添加到您的页面

< script type="text/javascript" src="http://oohembed.com/oohembed/?url=http%3A//www.amazon.com/Myths-Innovation-Scott-Berkun/dp/0596527055/ **&callback= myCallBack** "></script>

这将导致执行很棒的 myCallback(oEmbedJSONObject)。

该解决方案的问题是您仍然必须对没有 oEmbed 表示的网站进行后备。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-05-29T01:03:15.790

对于嵌入式的东西，我一直在使用 auto_html ( [https://github.com/dejan/auto_html](https://github.com/dejan/auto_html) ) 并取得了巨大的成功 (vimeo, youtube, images)，甚至自己添加了 soundcloud。但我仍在寻找具有类似 facebook 的图像和文本的“缩略图”生成。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-25T17:08:40.187

我猜你必须通过手动解析你得到的 URL 来自己构建它。如果它是一个图像 url，那么你只需要重新调整它，以防用户点击它，然后通过以某种方式打开原始的来处理它。

如果它是一些 youtube 视频的链接，那么你必须看看 Youtube 视频的嵌入是如何工作的。您可以只复制 Youtube 本身提供的代码，然后将带有 URL 的部分交换为带有您从用户那里获得的 URL 的视频。

我从来没有实现过这样的东西，但我认为它应该像这样工作。

# flash - Actionscript 错误 #2044：未处理的 SecurityErrorEvent：。text=Error #2047：安全沙箱违规：LocalConnection.send：127.0.0.1 无法访问

> ID：477904
> 
> 赞同：2
> 
> 时间：2009-01-25T16:37:23.103
> 
> 标签：flash, actionscript-3, actionscript, localconnection

在 HTML 容器中运行使用 localConnection 的 flash 组件时，我在弹出框中收到以下错误（flash player 是调试版本）：

错误 #2044：未处理的 SecurityErrorEvent：。text=Error #2047：安全沙箱违规：LocalConnection.send：127.0.0.1 无法访问

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-25T16:38:08.220

将页面的 URL 从[http://127.0.0.1/](http://127.0.0.1/)更改为[http://localhost/](http://localhost/)解决了这个问题。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-06T14:24:27.867

// 在接收文件的实例化之后添加这一行

receiveSwf_lc.allowDomain("localhost");

// 或者你喜欢的任何域名，使用 * 作为通配符来允许任何域名

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-04-27T21:32:20.300

您也可能想要添加一个 crossdomain.xml 文件，但这里有一个不错的解释：[http ://scottrockers.com/blog/resources/flash-information/workaround-solution-to-flash-error-2044-unhandled-securityerror -and-error-2048-security-sandbox-violation](http://scottrockers.com/blog/resources/flash-information/workaround-solution-to-flash-error-2044-unhandled-securityerror-and-error-2048-security-sandbox-violation)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-02-20T20:35:02.020

您也可以添加主机文件条目并将其指向 127.0.0.1。

# silverlight - 如何更改 Silverlight DatePicker 控件中的日期格式？

> ID：477908
> 
> 赞同：18
> 
> 时间：2009-01-25T16:38:55.830
> 
> 标签：silverlight, datepicker

这很好用：

```
<my:DatePicker IsTodayHighlighted="True" Width="200">
</my:DatePicker> 
```

但我想格式化日期，如下所示：

```
<my:DatePicker IsTodayHighlighted="True" Width="200" Format="yyyy-mm-dd">
</my:DatePicker> 
```

有人知道这个的语法吗？

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2009-03-23T22:27:19.073

不幸的是，DatePicker 控件目前不支持免费的 DateTime 格式。

如果您有兴趣在 DatePicker 的未来版本中获得支持，请创建一个建议的 codeplex 功能请求。 [http://silverlight.codeplex.com/WorkItem/Create.aspx](http://silverlight.codeplex.com/WorkItem/Create.aspx)

只是指出，新的 Silverlight Toolkit 2009 年 3 月 TimePicker 和 TimeUpDown 控件确实支持全方位的全球化选项。其中之一包括免费的 DateTime 格式。因此，我们是否将该功能移植回 DatePicker 只是一个公共利益问题。看看 TimePicker @ [http://silverlight.codeplex.com/Wiki/View.aspx?title=Silverlight%20Toolkit%20Overview%20Part%201#TimePicker的格式](http://silverlight.codeplex.com/Wiki/View.aspx?title=Silverlight%20Toolkit%20Overview%20Part%201#TimePicker)

同时，最好的解决办法是要么改变当地文化，要么改变当地文化的格式。

```
 public App()
    {
        Thread.CurrentThread.CurrentCulture = new CultureInfo("nl-NL"); 
```

或者改变当地文化的格式。

```
 public App()
    {
        Thread.CurrentThread.CurrentCulture = (CultureInfo) Thread.CurrentThread.CurrentCulture.Clone();
        Thread.CurrentThread.CurrentCulture.DateTimeFormat.ShortDatePattern = "D/m/yyyy"; 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-10-12T16:37:29.450

您应该定义一个自定义控件模板并编辑 datepicker 控件的文本框以设置文本格式。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-23T18:53:09.840

Silverlight DatePicker 上有一个 SelectedDateFormat 属性，这可能是您正在寻找的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-05-13T14:14:14.213

您可以隐藏控件文本框（宽度较小），公开您自己的（可选地将 IsEnabled 设置为 false）并使用元素绑定和转换器。如果您使用的是 MVVM，则将 DataContext 设置为您的 ViewModel。我想另一种选择是覆盖 DataTemplate 以不包含文本框并执行相同的想法。

```
<StackPanel Orientation="Horizontal" Height="22">
      <TextBox x:Name="textBox2" Width="106" Text="{Binding ElementName=datePicker2, Path=SelectedDate, Mode=TwoWay, Converter={StaticResource internationalDateTimeFormatConverter}}" />
      <controls:DatePicker x:Name="datePicker2" IsTabStop="False" SelectedDate="{Binding TargetDatePicker, Mode=TwoWay, NotifyOnValidationError=true, ValidatesOnExceptions=true}" Width="23" HorizontalAlignment="Left" />
</StackPanel> 
```

更新：从文本框到日期选择器的 TwoWay 绑定运行良好，但它不会更新 ViewModel 属性。所以我要设置 IsEnabled=False 并称之为好。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-02-04T12:05:17.817

我注意到这是一个已回答的问题。

但是我想通知[这个链接](http://mmtoolkitsl.codeplex.com/)到我最近开始创建的 Silverlight 5 控制工具包。它包含（以及其他控件）一个 DateTimeBox 控件，您可以在其中处理同一控件中的日期和时间。在这一点上，它仍在开发中，但它应该适用于大多数场景。

# unit-testing - 您在编写集成测试时遇到了哪些挑战？

> ID：477911
> 
> 赞同：2
> 
> 时间：2009-01-25T16:43:02.610
> 
> 标签：unit-testing, integration-testing, qa

您在编写集成测试时遇到了哪些挑战？编写单元测试是否有助于编写集成测试？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-25T17:32:01.433

我处理分布式软件系统，其中不同类型的基于服务器的应用程序进行通信（通常通过消息传递）。因此，长期存在的问题是保持所有这些在各自服务器上运行的复杂应用程序的配置和正确配置的部署。准备集成测试需要大量的 QA 开销。虚拟机可以而且确实可以提供帮助。但是，有时使用 UDP 通信的集群软件（例如 JGroups）在 VM 上与在物理服务器上相比无法正常工作。

这种测试的另一个祸害是使用适当且一致的数据库上下文进行测试。通常情况下，创建可以在数据库中建立数据上下文的测试设置脚本与设计要测试的软件本身一样复杂（并且容易出错）。

单元测试、带有内置回归测试的持续集成构建等测试方法都没有做任何事情来使这些测试问题更容易解决。它们有用且有价值，但绝不是灵丹妙药。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-25T18:30:17.243

与单元测试一样，集成测试也需要对其有共同的理解和认识。

需求的每一次变化都可能改变被测对象的行为。因此，您的集成测试可能会中断。

代码的每一次更改都可能改变被测对象的行为。因此，您的集成测试可能会中断。

我认为编写集成测试就像坐在系统的利益相关者（编写需求的人）和开发人员之间。如果任何一方不知道集成测试的范围，那么您将成为需要解决问题的人。当出现问题时，您必须弄清楚的典型问题是：

*   有什么要求改变了吗？（*当然，你不检查你的电子邮件吗？协议已经更新到 Spec 1.2。*）
*   代码变了吗？（*当然，我通过引入缓存优化了数据库访问算法，但我不知道它会破坏您的集成测试。*）

然后你将不得不面对许多范围爬行者。集成测试可能成为开发人员的质量测试（*是的，我知道我的单元测试并没有涵盖该类的大部分行为，但集成测试将完成其余部分。*）或利益相关者的验收测试（*请添加测试系统将如何运行如果我们向它扔了无效的订单。*）或管理员的压力测试（*嘿，您的集成测试提供了一种每秒用数百个请求轰炸服务器的好方法！*）。

尽管这只是您将面临的一项挑战，但它是最重要的挑战之一：**建立对集成测试范围的理解和认识。**

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-25T17:43:23.797

UnitTesting 在比集成测试更孤立的空间中工作。因此，尽管工具大致相同，但存在一些不同的挑战：

随着时间的推移，后端系统中的数据会发生变化。有时您对这些更改并没有真正的影响，它们会使详细的集成测试变得无用。这通常会导致“冒烟测试”，如集成测试，实际上不会断言后端系统的太多内容。另一种方法是使用其他服务来动态查找具有符合您的测试需求的特定“形状”的数据。而且这些技术都没有真正与单元测试一样。所以这确实是一门完全不同的学科。

我发现（在大型项目中）总是有一部分人专门从事集成测试，而每个人都编写单元测试是相当普遍的。可以说每个人也都编写集成测试，但通常还有更多需要关注的内容，这意味着随着时间的推移，维护通常会变得更加专业。每个人都不需要 100% 详细了解后端的特性。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-25T17:59:29.833

我遇到了最困难的测试：

1.  单身人士（通常不是我创建的）
2.  创建许多依赖项的对象，导致难以提供“测试”版本——这就是 IOC 如此出色的原因之一
3.  大量消息驱动的异步对象

我有一位同事以单身人士的身份创造了一切。因此，需要协同工作的对象只会说 XXX x = XXX.INSTANCE; 得到一个单身人士。一切都是单例，几乎不可能将其中任何一个放入测试框架中。

# asp.net - 如何从 IIS7 中删除 eTag 标头？

> ID：477913
> 
> 赞同：84
> 
> 时间：2009-01-25T16:44:36.770
> 
> 标签：asp.net, iis-7, etag

根据[雅虎高性能网站的最佳实践](http://developer.yahoo.com/performance/rules.html)，我想从我的标题中删除 Etags（我手动管理所有缓存并且不需要 Etags ......以及何时/如果我需要扩展到农场，我真的很希望他们离开）。我在 Windows Server 2008 上运行 IIS7。有人知道我该怎么做吗？

* * *

## 回答 #1

> 赞同：39
> 
> 时间：2009-01-25T17:25:50.713

在 IIS7 下，Etag 更改编号（Etag 后面的部分 : ）始终设置为 0。

因此，来自服务器的 Etag 不再因同一文件的服务器而异，因此 Yahoo 最佳实践不再真正适用。

由于您实际上无法抑制 IIS7 上的 ETag 标头，因此最好不要摆弄它。到目前为止，我发现最有用的配置规则是“如果默认设置没有破坏某些内容，请不要理会它”。

* * *

## 回答 #2

> 赞同：33
> 
> 时间：2009-08-09T09:06:39.240

您会认为在 web.config 中执行此操作可以禁用 IIS7 中的 ETag。但是嗅探器跟踪确认 ETag 无论如何都被发送了。

```
<httpProtocol>
    <customHeaders>
        <remove name="ETag" />
    </customHeaders>
</httpProtocol> 
```

使用空白也不起作用。ETag 无论如何都会被发送下来。

```
<httpProtocol>
    <customHeaders>
        <add name="ETag" value="" />
    </customHeaders>
</httpProtocol> 
```

正如其他网站所建议的那样，将 ETag 设置为空白引号不起作用。

```
<httpProtocol>
    <customHeaders>
        <add name="ETag" value="&quot;&quot;" />
    </customHeaders>
</httpProtocol> 
```

导致发送*更多的*ETag：

```
ETag：“8ee1ce1acf18ca1:0”，“”

```

总之，我无法尝试或想到在 IIS7 上杀死 ETag 的工作，至少无需编写自定义模块等。

* * *

## 回答 #3

> 赞同：22
> 
> 时间：2011-11-14T20:26:56.473

我编写了一个自定义 http 模块来处理这个问题。它真的没有听起来那么糟糕。这是代码：

```
using System;
using System.Web;

namespace StrongNamespace.HttpModules
{
    public class CustomHeaderModule : IHttpModule
    {
        public void Init(HttpApplication application)
        {
            application.PostReleaseRequestState += new EventHandler(application_PostReleaseRequestState);

        }

        public void Dispose()
        {
        }

        void application_PostReleaseRequestState(object sender, EventArgs e)
        {
            HttpContext.Current.Response.Headers.Remove("Server");
            HttpContext.Current.Response.Headers.Remove("X-AspNet-Version");
            HttpContext.Current.Response.Headers.Remove("ETag");
        }
    }
} 
```

这是您想要的 web.config 更改：

```
<configuration>
    <system.webServer>
        <httpProtocol>
            <customHeaders>
                <remove name="X-Powered-By"/>
            </customHeaders>
        </httpProtocol>
        <modules>
            <add name="CustomHeaderModule" type="StrongNamespace.HttpModules.CustomHeaderModule"/>
        </modules>
    </system.webServer>
</configuration> 
```

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2011-11-11T04:11:18.500

我意识到这是一个老问题，但我在寻找解决方案时遇到了它。我想我找到了我为[这个问题](https://stackoverflow.com/questions/7947420/iis-7-5-remove-etag-headers-from-response)发布的合理答案。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2009-02-05T19:18:38.943

我们遇到了这个问题，甚至在 IIS 7 中设置一个空白的自定义 ETag 标头也不适用于所有文件（例如图像文件）。我们最终创建了一个明确删除 ETag 标头的 HttpModule。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2013-08-02T20:00:09.110

**更新：**感谢用户 @ChrisBarr 添加了 URL 重写模块要求

在 iis 6 中很容易，您可以为 'ETag' = "" 添加自定义标头

在 IIS 7 中，在阅读了这个线程并发现不使用自定义 http 模块是不可能的后，我发现您可以简单地安装[Microsoft 的 URL Rewrite 模块](http://www.iis.net/downloads/microsoft/url-rewrite)并添加一个出站重写规则，如下所示：

```
<outboundRules>
  <rule name="Remove ETag">
    <match serverVariable="RESPONSE_ETag" pattern=".+" />
    <action type="Rewrite" value="" />
  </rule>
</outboundRules> 
```

这实际上有效，您不需要自定义 http 模块 (dll)。解锁 system.webServer 配置部分和设置 customHeaders 等不起作用 - 至少在我尝试的所有情况下。一个简单的出站重写规则就可以了。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2013-08-11T13:03:42.423

顺便说一句，当您使用**iis8**时 ，它很简单

```
<element name="clientCache">
   <attribute name="cacheControlMode" type="enum" defaultValue="NoControl">
          <enum name="NoControl" value="0" />
          <enum name="DisableCache" value="1" />
          <enum name="UseMaxAge" value="2" />
          <enum name="UseExpires" value="3" />
  </attribute>
  <attribute name="cacheControlMaxAge" type="timeSpan" defaultValue="1.00:00:00" />
  <attribute name="httpExpires" type="string" />
  <attribute name="cacheControlCustom" type="string" />
  <attribute name="setEtag" type="bool" defaultValue="true" />
</element> 
```

[IIS 8.0：使用或不使用 ETag](http://blogs.iis.net/wonyoo/archive/2012/03/30/iis-8-0-to-use-or-not-to-use-etag-that-is-the-question.aspx)

 *** * *

## 回答 #8

> 赞同：2
> 
> 时间：2012-11-07T09:02:24.863

我使用了`removeetag.dll`在[http://www.caspianit.co.uk/iis7-etag-problem/](http://www.caspianit.co.uk/iis7-etag-problem/)上找到的 ，它工作得很好。

希望它也对你有用

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-01-25T16:58:37.337

[http://www.jesscoburn.com/archives/2008/10/02/quickly-configure-or-disable-etags-in-iis7-or-iis6/](http://www.jesscoburn.com/archives/2008/10/02/quickly-configure-or-disable-etags-in-iis7-or-iis6/)有一个很好的图片指南。

本质上，您创建了一个名为 ETag 的自定义响应标头并将其值设为空。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2010-05-22T00:52:34.647

查看这篇关于如何在 iis6、iis7 和 iis7.5 中完全删除 Etag http 标头的博客文章

[http://lightspeednow.com/blog/2010/05/21/iis-tutorial-how-to-completely-remove-etags-entity-tags-from-iis6-iis7-and-iis7-5/](http://lightspeednow.com/blog/2010/05/21/iis-tutorial-how-to-completely-remove-etags-entity-tags-from-iis6-iis7-and-iis7-5/)

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2012-09-21T12:13:19.417

我认为这会起作用..我知道删除和空白不起作用。

```
 <configuration>
     <system.webServer>
       <httpProtocol>
          <customHeaders>
            <add name="ETag" value=" " /> 
          </customHeaders>
        </httpProtocol>
       </configuration>
     </system.webServer> 
```

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-02-27T03:33:43.557

In IIS 7 you shouldn't have to worry about etags anymore as the IIS configuration number is always set to 0\.

There is still a problem if you have IIS6 & IIS7 webservers in the same farm. In this case you would have to manually set the IIS6 config number to 0 as described in this [article](http://blogs.iis.net/chrisad/archive/2006/12/18/iis7-deployments-calls-for-etag-usage-review-if-using.aspx).

Etags are actually very useful as you don't need to change the filename like stack overflow does (i.e. default.css?1234). If you change the default.css file it will change the etag and therefore subsequent requests will get the file from the server and not the cache.

# multi-touch - 对网络浏览器/网页的多点触控支持

> ID：477917
> 
> 赞同：-2
> 
> 时间：2009-01-25T16:46:01.200
> 
> 标签：multi-touch

多点触控似乎每天都在全球范围内收集越来越多的参考资料。很快价格很可能会下降，因为已经有大量公司在投资它们。现在我想问stackoverflow的是以下内容：

*   是时候开始为浏览器开发开源多点触控 api 了吗，比如 Firefox 的插件？

*   我们需要对当前的 Web 框架进行哪些修改以支持多点触控？

我知道这与编程没有直接关系，因此是社区 wiki。只是想收集一些关于它的意见。

编辑：我的目标是了解开发人员是否对此感兴趣，您可能会做的一些事情是：

*   缩放
*   增加迭代性，例如允许重新组织网页
*   多人同时使用同一个网页。

为什么这个问题（一个例子）： - 例如，Javascript 还没有准备好同时处理多个动作。（你可以模拟它，但你不能只用 2 个鼠标指针进入你的网络浏览器并同时做多个事情）

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-25T17:15:37.003

Firefox 3.1 已经支持多点触控手势。

# rhino-mocks - Rhino Mocks - Stub .Expect 与 .AssertWasCalled

> ID：477924
> 
> 赞同：34
> 
> 时间：2009-01-25T16:53:11.323
> 
> 标签：rhino-mocks

好的，我知道 Rhino Mocks 中新的 AAA 语法有很多混淆，但我必须说实话，从我目前所看到的来看，我喜欢。它读起来更好，并节省了一些击键。

基本上，我正在测试一个`ListController`基本上将负责一些事情列表的 :) 我创建了一个最终将成为 DAL 的接口，这当然是现在被存根的。

我有以下代码：

（`manager`是被测系统，`data`是存根数据接口）

```
 [Fact]
    public void list_count_queries_data()
    {
        data.Expect(x => x.ListCount(1));
        manager.ListCount();
        data.VerifyAllExpectations();
    } 
```

此测试的主要目的是确保管理器实际上是在查询 DAL。请注意，DAL 实际上并不存在，因此没有“真正的”价值回来。

但是，这是失败的，因为我需要将期望更改为具有返回值，例如：

```
 data.Expect(x => x.ListCount(1)).Return(1); 
```

然后这将运行良好，并且测试将通过，**但是**- 让我感到困惑的是，在这个时间点，返回值**没有任何意义**。我可以将其更改为 100、50、42 等等，并且测试将始终通过？

这让我很紧张，因为测试应该是明确的，如果没有满足预期的条件应该完全失败，对吧？

如果我将测试更改为（“1”是计数链接到的预期 ID）：

```
 [Fact]
    public void list_count_queries_data()
    {
        manager.ListCount();
        data.AssertWasCalled(x => x.ListCount(1));
    } 
```

一切都通过了，如果我将测试切换到`AssertWasNotCalled`，它会按预期失败。

那么，**我在第一个代码示例中遗漏了什么吗？**你对在存根上做断言有什么想法？[（这里](http://ayende.com/Blog/archive/2008/06/29/Rhino-Mocks-3.5-Design-Decisions-The-role-of-Stub-vs.aspx)有一些有趣的讨论，我个人很喜欢[这个回应](http://ayende.com/Blog/archive/2008/06/29/Rhino-Mocks-3.5-Design-Decisions-The-role-of-Stub-vs.aspx#23872)。

* * *

## 回答 #1

> 赞同：53
> 
> 时间：2010-01-15T23:17:48.757

**你的测试试图达到什么目的？**

您正在验证什么行为或状态？具体来说，您是在验证协作者（数据）是否正在`ListCount`调用其方法（基于交互的测试），还是只想`ListCount`返回一个固定值以驱动被测类，同时在其他地方验证结果（基于传统状态的测试） ?

如果要设置期望，请使用模拟和期望：使用`MockRepository.CreateMock<IMyInterface>()`和`myMock.Expect(x => x.ListCount())`

如果要存根方法，请使用`MockRepository.CreateStub<IMyInterface>()`and `myStub.Stub(x => x.ListCount())`。

（除此之外：我知道您可以使用 stub.AssertWasCalled() 来实现与 mock.Expect 大致相同的事情，并且可以使用更好的阅读语法，但我只是在深入研究模拟和存根之间的区别）。

[Roy Osherove 对模拟和存根有很好的解释。](http://osherove.com/blog/2007/9/16/mocks-and-stubs-the-difference-is-in-the-flow-of-information.html)

**请发布更多代码！**

我们需要全面了解您如何创建存根（或模拟）以及如何将结果用于被测类。`ListCount`有输入参数吗？如果有，它代表什么？您是否关心它是否以特定值*调用？*您是否关心是否`ListCount` *返回*某个值？

正如 Simon Laroche 指出的那样，如果 Manager 实际上没有对 ListCount 的模拟/存根返回值做任何事情，那么测试将不会因此而通过或失败。测试所期望的只是调用了模拟/存根方法——仅此而已。

为了更好地理解这个问题，考虑三个信息，你很快就会明白这一点：

1.  正在测试什么
2.  在什么情况下？
3.  预期的结果是什么？

比较： **使用模拟进行基于交互的测试**。模拟呼叫**是**测试。

```
[Test]
public void calling_ListCount_calls_ListCount_on_DAL()
{
   // Arrange
   var dalMock = MockRepository.Mock<IDAL>();
   var dalMock.Expect(x => x.ListCount()).Returns(1);
   var manager = new Manager(dalMock);

   // Act
   manager.ListCount();

   // Assert -- Test is 100% interaction based
   dalMock.VerifyAllExpectations();   
} 
```

**带有存根的基于状态的测试**。存根驱动测试，但不是预期的一部分。

```
[Test]
public void calling_ListCount_returns_same_count_as_DAL()
{
   // Arrange
   var dalStub = MockRepository.Stub<IDAL>();
   var dalStub.Stub(x => x.ListCount()).Returns(1);
   var manager = new Manager(dalMock);

   // Act
   int listCount = manager.ListCount();

   // Assert -- Test is 100% state based
   Assert.That(listCount, Is.EqualTo(1),
       "count should've been identical to the one returned by the dal!");
} 
```

我个人倾向于尽可能地进行基于状态的测试，尽管基于交互的测试通常需要使用[Tell, Don't Ask](http://pragprog.com/articles/tell-dont-ask)设计的 API ，因为您不会有任何暴露的状态需要验证！

**API 混乱。模拟不是存根。还是他们？**

rhino mocks 中的 mock 和 stub 之间的区别是混乱的。传统上，存根并不意味着有期望——所以如果你的测试替身没有调用它的方法，这不会直接导致测试失败。

... 然而，Rhino Mocks API 功能强大，但令人困惑，因为它让您对存根设定期望，对我来说，这与公认的术语背道而驰。我也不在意这些术语。在我看来，如果消除这种区别并且在测试中调用的方法可以起到双重作用，那就更好了。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-29T17:36:29.420

我认为这与你的 manager.ListCount() 对返回值所做的事情有关。

如果它不使用它，那么您的 DAL 可以返回任何无关紧要的东西。

```
public class Manager
{
    public Manager(DAL data)
    { 
        this.data = data
    }
    public void ListCount()
    {
        data.ListCount(1); //Not doing anything with return value
        DoingSomeOtherStuff();
    }    
} 
```

如果您的列表计数正在做一些有价值的事情，那么您应该对它正在做的事情进行断言。举个例子

```
Assert.IsTrue(manager.SomeState == "someValue"); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-01-15T22:23:32.300

您是否尝试过使用

```
data.AssertWasCalled(x => x.ListCount(1) = Arg.Is(EXPECTED_VALUE)); 
```

# cryptography - 用什么？电子签名？

> ID：477930
> 
> 赞同：7
> 
> 时间：2009-01-25T17:01:40.370
> 
> 标签：cryptography, authorization, digital-signature, identification

抱歉，我找不到这个问题的最佳标题。以下是我的要求。

我正在从事一个项目，该项目将大量资金交易到不同的账户。系统会自动将资金转入 A、B、C 等账户，但在此之前，A、B 或 C 中的某个人应批准（电子方式）要转帐的金额。

你认为最好的方法是什么？我希望系统发送一个经过数字签名（？）的文件（某些东西的 PDF），来自 A、B 和 C 的授权人员应检查并确认金额是否正确。

由于金额很高，我必须确保系统发出的文件没有被篡改，同时我还要确保A，B或C发送的文件（回复）也没有被篡改。实现它的最佳方法是什么？有任何想法吗？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-01-25T17:15:39.500

数字签名是您正在寻找的。Adobe PDF（因为您提到了 pdf）允许您在免费的 Adob​​e Reader 版本中签署 pdf，并且一旦您打开 pdf 文档，验证也会自动完成。

Noldorin 发布的 DigSig 和 (H)MAC 之间的区别在于，MAC 使用对称加密，您需要安全通道来交换密钥，而在[PKI](http://en.wikipedia.org/wiki/Public_key_infrastructure)环境中则不需要安全通道。

这取决于您希望如何分配密钥。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-25T17:07:01.967

您需要查看[MAC](http://en.wikipedia.org/wiki/Message_Integrity_Code)（消息身份验证代码）。有许多用于实现通用算法（例如[HMAC](http://en.wikipedia.org/wiki/HMAC) ）的各种语言的库。

编辑：另请参阅 DSA（[http://en.wikipedia.org/wiki/Digital_Signature_Algorithm](http://en.wikipedia.org/wiki/Digital_Signature_Algorithm)），它是一种流行的数字签名算法，在标准 .NET 框架（System.Cryptography 命名空间）中完全实现。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-26T14:58:14.753

我的第一反应是数字签名——但它们有一个致命的缺陷：它们是可能被粗心的用户破坏的数字数据。

如果这是一个问题，您可以使用南非银行使用的过程，即一次性密码。此密码通过不涉及交易的方式传输给他们（在南非，这是通过短信，我强烈推荐）。我们首先输入用户名和密码，然后通过 SMS 获取 OTP，然后我们需要为任何导致资金离开我们账户的交易输入该 OTP。

强大的安全形式（提高有效性）包括（我不是专家，但我知道一些）：

*   知识（密码）
*   拥有（可以接收短信的手机 SIM 卡，或带有证书的 U 盘）
*   位置（具有基于硬件的证书管理系统 CellID 的计算机）
*   时间（OTP 到期，交易必须在特定时间发生）
*   身份（指纹读取器 - 实际上是密码 - 但非常长）
*   唯一性（在光子偏振中编码的光纤电缆）

据我所知，如果您拥有其中任何三个，您可以对自己的安全性感到满意。添加更多会以指数方式提高安全性，但也会增加不便因素。银行在南非使用 Knowledge、Possession 和 Time，而网络钓鱼对南非银行确实不起作用。

希望这对您有所帮助。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-01-27T08:36:23.583

要对文件进行数字签名，您可以使用 Microsoft 的任何合作伙伴。例如，Arx 为您提供了一个名为 CoSign 的工具，您可以免费使用它（或者至少是他们的试用版）。这将允许您将[电子签名](http://www.arx.com)添加到大多数可用格式（word、pdf、xml 等）。

# audio-processing - Bpm 音频检测库

> ID：477944
> 
> 赞同：15
> 
> 时间：2009-01-25T17:18:14.037
> 
> 标签：audio-processing

我正在寻找一个简化速度/bpm 音频检测的库。

[与http://adionsoft.net/bpm/](http://adionsoft.net/bpm/)类似的东西，但在 *NIX 机器上使用。

任何语言，但首选是 php、perl、python。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-09-13T09:51:52.590

Mixxx 使用[SoundTouch](http://www.surina.net/soundtouch/)库中的 BPMDetect 类进行 BPM 检测。还有另一个名为[BPMDj](http://bpmdj.yellowcouch.org/index.html)的开源库，它更难使用但更准确。

我个人不会依赖任何一个。再说一次，我是一名业余 DJ，所以我倾向于更多地依靠我的耳朵。

*编辑*

有一个更好的 OSS 库，叫做[aubio](http://aubio.org)。它还可以进行节拍检测和发作检测。

*另一个编辑*

Mixxx 现在已经转移到 VAMP 插件集，它要好得多，支持 aubio 和许多其他节拍检测库。它还支持按键检测和其他音频分析功能。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-25T17:23:59.670

不是一个库，而是一个类：来自 Mixxx 的 bpmdetect.{cpp,h [}](http://downloads.mixxx.org/mixxx-1.6.1/mixxx-1.6.1-src.tar.gz)。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-26T16:45:54.160

更好：[http ://www.vamp-plugins.org/download.html](http://www.vamp-plugins.org/download.html)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-01-01T03:32:31.957

此外，如果您已经在使用 GStreamer 库，则该`bpmdetect`元素是`soundtouch`插件的一部分，也是 gstreamer-plugins-bad 的一部分。python gstreamer 绑定是非常好的。

# c++ - CDT 上的 POCO C++ 库

> ID：477945
> 
> 赞同：1
> 
> 时间：2009-01-25T17:22:40.657
> 
> 标签：c++, eclipse-cdt, poco-libraries

我正在 Windows 上使用 CDT（C/C++ for eclipse），我需要开始使用[POCO C++ 库](http://pocoproject.org/)

POCO 的当前包分发需要 MS Visual Studio 7/8/9 来编译库。

有谁知道在 Windows 上的 CDT 环境中编译的解决方案？我正在使用 MinGW 编译/构建工具。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-25T18:01:49.313

可以将 POCO 与 MinGW 一起使用——有些人已经成功地做到了这一点。我会首先尝试单独使用 MinGW，当它工作时，将它集成到 Eclipse 中（这应该不会太难。）。

在 SourceForge 上的 POCO 跟踪器中有一些补丁和错误报告。查看它们肯定会有所帮助（[https://sourceforge.net/tracker/?group_id=132964](https://sourceforge.net/tracker/?group_id=132964)）。

# c# - 在 C# 和非托管 C++ 之间传递自定义对象

> ID：477952
> 
> 赞同：0
> 
> 时间：2009-01-25T17:27:48.713
> 
> 标签：c#, c++, .net-2.0, pinvoke, unmanaged

我有一个旧版 DLL，其中包含我需要从 C# 代码调用的几个方法。其中一种方法接收指向另一个 C++ 类的指针，该类位于其他 C++ 程序中，而不是 DLL。

我很确定我需要使用 pinvoke 来回编组对象，但我还没有发现任何关于编组自定义对象的内容。

实现这一目标的最佳方法是什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-27T02:45:42.937

I'd look at C++/CLI although COM interop may be easier depending on the shape of your C++ code.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-25T18:00:38.350

你确定它是一个类而不是一个结构吗？毕竟，不同的编译器可以选择在内存中以不同的方式布置类，这会破坏目标 DLL。

您是否考虑过使用托管 C++ 包装器？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-27T19:25:33.643

如果只是几种方法使用 swig

# c# - C# 中的 Java TreeMap 等价物？

> ID：477954
> 
> 赞同：23
> 
> 时间：2009-01-25T17:28:28.990
> 
> 标签：c#, java, treemap, equivalent

我咨询过的大多数地方都说要使用 SortedList，但问题是我正在移植的程序实际上使用了重复的键（按顺序区分），这是 TreeMap 允许的，但 SortedList 不允许。

有什么建议吗？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2013-11-18T13:35:00.113

[SortedDictionary](http://msdn.microsoft.com/en-us/library/f7fta44c%28v=vs.110%29.aspx)类有帮助吗？

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-27T04:18:06.557

.NET 中红黑树的另一个很好的实现可以在这里找到： [http ://www.itu.dk/research/c5/](http://www.itu.dk/research/c5/)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-25T17:34:22.613

我不认为 C# 本身就有一个。然而，那里有很多红黑实现的例子。这是一个：-

[http://www.codeproject.com/KB/recipes/redblackcs.aspx](http://www.codeproject.com/KB/recipes/redblackcs.aspx)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2020-09-15T11:42:40.923

一般使用排序集

```
public class ItemComparer : IComparer<int[]>
{
    public int Compare(int[] item1, int[] item2)
    {
        if (item1[0] != item2[0]) return item1[0].CompareTo(item2[0]);
        return item1[1].CompareTo(item2[1]);
    }
}
var s = new SortedSet<int[]>(new ItemComparer()); 
```

# c# - 如何在所有子节点中不使用 XNamespace 的情况下为子节点创建具有默认命名空间的 XElement

> ID：477962
> 
> 赞同：9
> 
> 时间：2009-01-25T17:34:56.530
> 
> 标签：c#, .net, xml, namespaces, linq-to-xml

我正在尝试使用`System.Xml.Linq`来创建 XHTML 文档。因此，我的树中的绝大多数节点都应该使用这个命名空间：

```
http://www.w3.org/1999/xhtml 
```

我可以`XElement`很容易地创建范围为这个命名空间的节点，使用一个`XNamespace`，像这样：

```
XNamespace xhtml = "http://www.w3.org/1999/xhtml";
// ...
new XElement(xhtml + "html", // ... 
```

但是，我不想`XNamespace`在创建 HTML 节点的所有代码中都提供一个可用的，并且必须为我创建的每个`XElement`（和`XAttribute`）名称添加前缀。

XML 文本格式本身考虑了这一要求，并允许使用 reserved`xmlns`属性在由后代继承的祖先中设置默认命名空间。我想使用`System.Xml.Linq`.

这可能吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-07T15:11:42.730

我决定使用一个名为 的静态类`XHtml`，如下所示：

```
public static class XHtml
{
    static XHtml()
    {
        Namespace = "http://www.w3.org/1999/xhtml";
    }

    public static XNamespace Namespace { get; private set; }

    public static XElement Element(string name)
    {
        return new XElement(Namespace + name);
    }

    public static XElement Element(string name, params object[] content)
    {
        return new XElement(Namespace + name, content);
    }

    public static XElement Element(string name, object content)
    {
        return new XElement(Namespace + name, content);
    }

    public static XAttribute Attribute(string name, object value)
    {
        return new XAttribute(/* Namespace + */ name, value);
    }

    public static XText Text(string text)
    {
        return new XText(text);
    }

    public static XElement A(string url, params object[] content)
    {
        XElement result = Element("a", content);
        result.Add(Attribute("href", url));
        return result;
    }
} 
```

这似乎是最干净的做事方式，尤其是当我可以添加便利例程时，例如`XHtml.A`方法（此处未显示我的所有课程）。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2010-05-28T14:03:48.073

我采取了递归重写的方式。您实际上不必“重建”树。您可以只换出节点名称 ( `XName`)。

```
 private static void ApplyNamespace(XElement parent, XNamespace nameSpace)
    {
        if(DetermineIfNameSpaceShouldBeApplied(parent, nameSpace))
        {
            parent.Name = nameSpace + parent.Name.LocalName;
        }
        foreach (XElement child in parent.Elements())
        {
            ApplyNamespace(child, nameSpace);
        }
    } 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-25T18:02:19.343

问题是用于创建 XElement 的 XName 需要指定正确的命名空间。我想做的是创建一个像这样的静态类：-

```
public static class XHtml
{
    public static readonly XNamespace Namespace = "http://www.w3.org/1999/xhtml";
    public static XName Html { get { return Namespace + "html"; } }
    public static XName Body { get { return Namespace + "body"; } }
              //.. other element types
} 
```

现在您可以像这样构建一个 xhtml 文档：-

```
XDocument doc = new XDocument(
    new XElement(XHtml.Html,
        new XElement(XHtml.Body)
    )
); 
```

该静态类的另一种方法是：-

```
static class XHtml
{
    public static readonly XNamespace Namespace = "http://www.w3.org/1999/xhtml";
    public static readonly XName Html = Namespace + "html";
    public static readonly XName Body = Namespace + "body";
} 
```

无论您是否使用它们，这都有实例化所有可能的 XName 的缺点，但优点是命名空间 +“标记名”的转换只发生一次。我不确定这种转换是否会被优化。我确信 XNames 只被实例化一次：-

```
XNamepace n = "http://www.w3.org/1999/xhtml";
XNames x = n + "A";
XName y = n + "A";
Object.ReferenceEquals(x, y) //is true. 
```

# java - 测试正确的时区处理

> ID：477965
> 
> 赞同：7
> 
> 时间：2009-01-25T17:36:35.823
> 
> 标签：java, timezone, utc

我们正在处理大量数据，所有数据都以 UTC（Java）标记。在读取这些数据、将其存储在数据库中并再次将其取出之间，发生了一些数据在夏令时关闭了一小时。由于 UTC 没有夏令时的概念，这显然是软件中的一个错误。一旦知道，就很容易修复。

但是，无论当前时差如何，有一些单元/集成测试都可以工作会很好 - 例如，我想更改本地时区并在这些不同时区内一遍又一遍地运行一些方法以确保UTC 处理正确。

由于测试应该自动运行，并且最好在一个测试套件中运行，我想知道如何最好地测试正确的行为。在重新启动 JVM 时更改本地设置（如时区）很容易，但在测试套件中运行它并不容易。

有人知道支持这种场景的测试环境、库或模式吗？我们通常使用 JUnit，但如果它有助于摆脱此类问题，我们也愿意添加其他环境/技术。我想它是一个集成而不是单元测试。

**编辑**：已经有两个非常有用的答案，但我想那里必须有更多的技术。是否有人拥有有关何时/多久调用 TimeZone.getDefault 的权威信息（请参阅 Jon Skeets 答案的评论）？

**注意**：即使这个问题有一个公认的答案，我也不完全确定要接受哪个答案。即使有这种接受，我也希望看到更多的想法和技术。

感谢您的输入！

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-01-25T17:41:33.660

Java 允许您设置默认时区 (java.util.TimeZone.setDefault)。我之前写过测试，将时区设置为各种不同的选项，并检查一切是否仍然有效。不过要小心 - 如果您要并行化大多数单元测试，则需要使这些单元测试按顺序排列。

我建议您在某些适用夏令时的时区进行测试，而有些则不适用。使用澳大利亚时区也很好，因为 DST 在一年中的相反时间适用于北半球。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-01-25T18:32:41.437

我建议您查看[JodaTime](http://joda-time.sourceforge.net/userguide.html)，它提供了一些糖来帮助您在代码中更清晰地管理日期/时间/时区类型问题。

我们在整个测试和生产过程中都使用这些，因为它对于日期/时间问题的原生 Java API 是无与伦比的。在 JUnit 中使用这些在测试中可以正常工作

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2020-06-03T23:13:07.013

# ruby-on-rails - 友好的表单验证（Rails）

> ID：477980
> 
> 赞同：0
> 
> 时间：2009-01-25T17:47:06.020
> 
> 标签：ruby-on-rails, ruby, forms, validation

我检查了这[两个](https://stackoverflow.com/questions/361161/rails-form-validation)[先前](https://stackoverflow.com/questions/423160/rails-form-validation-conditional-bypass)提出的问题，它们对我的案例有帮助，但不是完整的解决方案。

本质上，我需要从表单验证用户提交的 URL。我首先验证它是否以 http://、https:// 或 ftp:// 开头：

```
class Link < ActiveRecord::Base
  validates_format_of [:link1, :link2, :link3, 
        :link4, :link5], :with => /^(http|https|ftp):\/\/.*/
end 
```

这很适合它正在做的事情，但我需要更进一步地执行这两个步骤：

1.  如果需要，应允许用户将表单字段留空，并且
2.  如果用户提供的 URL 不是以 http:// 开头（例如，他们输入 google.com），它应该通过验证，但在处理时添加 http:// 前缀。

我很难确定如何干净有效地完成这项工作。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-25T20:43:59.207

仅供参考，您不必将数组传递给`validates_format_of`. Ruby 会自动处理数组（Rails 解析 的输出`*args`）。

所以，对于你的问题，我会去做这样的事情：

```
class Link < ActiveRecord::Base
  validate :proper_link_format

  private

  def proper_link_format
    [:link1, :link2, :link3, :link4, :link5].each do |attribute|
      case self[attribute]
      when nil, "", /^(http|https|ftp):\/\//
        # Allow nil/blank. If it starts with http/https/ftp, pass it through also.
        break
      else
        # Append http
        self[attribute] = "http://#{self[attribute]}"
      end
    end
  end
end 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-06T03:56:54.700

补充一下，我使用 Ruby URI 模块来解析 URL 的有效性。

[http://www.ruby-doc.org/stdlib/libdoc/uri/rdoc/classes/URI.html](http://www.ruby-doc.org/stdlib/libdoc/uri/rdoc/classes/URI.html)

它工作得非常好，它可以帮助我避免正则表达式。

# asp.net - 在 ASP.Net 中突出显示图像上的区域

> ID：477984
> 
> 赞同：3
> 
> 时间：2009-01-25T17:48:43.647
> 
> 标签：asp.net, image

我有一张建筑物的地图，我想根据用户输入以编程方式突出显示特定房间。

如果可能的话，我想从服务器端进行，最终，我希望能够突出显示多个房间。更详细地说，此功能用于展览。用户将查看有关参展商的数据，单击展位，并显示展厅地图，展位突出显示。

我还想稍后启用参展商的“书签”功能，所以为了让这值得我们花时间我们需要能够轻松突出显示多个展位。

解决这个问题的最佳方法是什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-25T18:05:11.897

如果您需要它作为客户端，jQuery Map Hilight 可能有您正在寻找的东西。

[jQuery 地图高亮](http://drupal.org/project/jq_maphilight "jQuery 地图高亮")

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-02T02:41:50.440

这就是最终效果很好的东西。

首先，丑陋（但必要）的部分 - 映射所有展位的位置并存储值。因此，对于展位 1，我们将存储我们想要突出显示的区域的四个角点。

在图像上，我们使用普通的 asp:image，但将 ImageUrl 设置为 BoothMap.ashx，这是我们设计用于绘制展位位置的处理程序，在查询字符串中发送展位位置。所以，它可能看起来像......

```
<asp:Image ID="imgBoothMap" ImageUrl="BoothMap.ashx?ID=A1" runat="server" /> 
```

我们的处理程序看起来像这样......

```
 <%@ WebHandler Language="C#" Class="BoothMap" %>

using System.Drawing;
using System.Drawing.Imaging;
using System.Web;

public class BoothMap : IHttpHandler {

    public void ProcessRequest (HttpContext context) {

        context.Response.ContentType = "image/jpg";

        //load booth corners
        Point[] points = GetBoothCorners(context.Request.QueryString["ID"]);

        Image curImage = Image.FromFile(@"C:\BoothMap.jpg");
        Graphics g = Graphics.FromImage(curImage);
        Pen transPen = new Pen(Color.FromArgb(128, 132, 112, 255), 10);
        Brush transBrush = new SolidBrush(Color.FromArgb(128, 132, 112, 255));
        g.FillPolygon(transBrush, points);
        curImage.Save(context.Response.OutputStream, ImageFormat.Jpeg);
        g.Dispose();
        curImage.Dispose();
        context.Response.End();
    }

    public bool IsReusable {
        get {
            return true;
        }
    }
} 
```

所有这些都为我们在 ASP.Net 中突出显示地图位置提供了框架。如果我们愿意，我们可以轻松地修改代码以突出显示地图的多个区域、更改颜色等。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-25T18:07:34.810

我在这里假设服务器端编程。我只是通过保存没有突出显示的原始图像来做到这一点，可能称为 building.jpg。然后，我将创建建筑物图像的变体，突出显示每个房间（因此 building-room1.jpg、building-room2.jpg）等（使用您最喜欢的图像编辑软件 - MSPaint 可以很好地解决这个问题）。然后，您只需将 Image 控件指向相应的 ImageUrl。

[将它与 ASP.NET 2.0 中的图像映射](http://www.developer.com/net/asp/article.php/3528986)控件结合起来会很有趣，因此用户可以单击他们感兴趣的房间，然后您可以加载突出显示该房间的图像。

# django - 将 django 作为 fastcgi 运行时的标准输出

> ID：477986
> 
> 赞同：2
> 
> 时间：2009-01-25T17:52:22.577
> 
> 标签：django, apache, fastcgi

我已经将我的 Django 应用程序配置为在 Linux（Ubuntu，如果重要的话）上的 Apache+FastCGI 下运行。我的问题是：将 Django 作为 fastcgi 运行时如何将标准输出重定向到文件。

**编辑** 澄清：我熟悉 django-logging 模块，是的，我已经在使用它了。这不是我的问题。

说当我从控制台运行 Django 时

```
python manage.py runserver 
```

我得到了控制台中显示的所有请求、错误等，这是标准输出。但是，当我在 apache 下将它作为 fastcgi 运行时，stdout 去哪里了？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-25T19:15:03.207

打印语句应显示在您的 apache 日志中。从[文档](http://www.fastcgi.com/mod_fastcgi/docs/mod_fastcgi.html)：

*“在进入 FastCGI 接受循环之前或通过不支持 FastCGI 协议的机制写入 stdout 或 stderr 的数据也将被定向到主服务器日志。”*

您可能需要将 Apache 的[LogLevel](http://httpd.apache.org/docs/mod/core.html#loglevel)设置为**info**以查看您使用 runserver 获得的相同详细信息。

# objective-c - 如何为 Mac OS X 制作可拖动的菜单栏图标

> ID：477994
> 
> 赞同：4
> 
> 时间：2009-01-25T17:59:35.013
> 
> 标签：objective-c, xcode, macos, menubar

我正在为我正在开发的应用程序编写菜单栏图标。但是 NSStatusBar 类没有通过 cmd+鼠标左键拖动使图标可拖动的方法。

如何使用 Objective-C 代码使菜单栏图标可拖动？

谢谢 ：）

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-01-25T18:32:08.783

您目前无法使用 NSStatusBar 来执行此操作。NSMenuExtra 会按照你想要的方式运行，但不幸的是它不是公共 Cocoa API 的一部分，据我所知（我自己没有使用过）需要一些技巧才能让它工作。此外 NSStatusBar 将更容易集成到现有应用程序中，NSMenuExtra 更多的是由系统加载的单独捆绑包。

在我看来，依赖私有 API 来为你的应用添加这样的主要功能并不是一个好主意。我会坚持使用 NSStatusBar，大多数用户将习惯于其他应用程序的行为，如果幸运的话，Mac OS X 的未来版本将允许以与 NSMenuExtra 相同的方式拖动图标。

# iframe - IE7中没有出现iframe滚动条

> ID：477998
> 
> 赞同：0
> 
> 时间：2009-01-25T18:03:37.827
> 
> 标签：iframe, scrollbar

我有以下代码：

```
<td colspan="7"height=200 valign="top">
<iframe id="myframe" name="myframe" src="index.php?page=1" width=810 height="100" marginheight="0" marginwidth="0" frameborder="1" scrolling="auto"></iframe> 
</td> 
```

我没有看到任何 scoll 条，无论是垂直的还是水平的。

有任何想法吗？

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-25T18:16:37.117

如果您在 iFrame 中打开的页面大于 iFrame 的大小，您应该只会在 iFrame 中看到滚动条。因此，如果 'index.php?page=1' 适合 810x100 的窗口，则 iFrame 将没有任何滚动条。如果您希望在 td 中看到包含 iFrame 的滚动条，则需要对其进行不同的样式设置。您需要将 style='overflow:auto' 添加到包含 iFrame 的 td 中。通过这样做，你告诉 td 如果它的内容大于它的最大高度和宽度，它应该有滚动条。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-25T18:10:37.783

这会在 IE7 中为我呈现一个水平和垂直滚动条：

```
<html>
<body>
<table>
<tr><td colspan="7"height=200 valign="top">
<iframe id="myframe" name="myframe" src="http://www.google.se" width=810 height="100" marginheight="0" marginwidth="0" frameborder="1" scolling="auto"></iframe> 
</td></tr>
</table>
</body>
</html> 
```*************************