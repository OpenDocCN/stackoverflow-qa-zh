# StackOverflow 问答 10588000-10588999

# php - 动态 URL 太长（2568 个字符），试图使其更短

> ID：10588000
> 
> 赞同：0
> 
> 时间：2012-05-14T17:12:16.160
> 
> 标签：php, javascript, postgresql, netbeans

![我从 chrome 控制台收到的消息](../Images/7888da9bac93156dd815c7269daeb8ef.png) 我在一个drupal网站上使用javascript，但保存功能似乎只有在我点击“保存”按钮2次时才起作用。触发该函数的代码是：

```
var param ="&usuario="+usuario+"&nivel="+nivel+gano+porc_gano+gasto+porc_gasto+tengo+porc_tengo+debo+     porc_debo+plazo_debo;
var s = document.createElement("script");
s.type = "text/javascript"; s.async = true;
s.src = server_direction +"setMisDatos?callback=respuestaGuardarMisDatos&param="+encodeURIComponent(param);
var h = document.getElementsByTagName("script")[0];
h.parentNode.insertBefore(s, h); //or h.appendChild(s); 
```

chrome 控制台告诉我错误在我复制的最后一行，但我不明白它是什么类型的错误。

使用 chrome 控制台（特别是“网络”控制台），我看到它用红色书写，状态/文本“失败”，输入“未定义”大小/内容“13 B / 0 B”；当它工作时：状态/文本“200/OK”，输入“文本/json”，大小/内容“256 B/38B”。我不是这方面的专家，还有更多有用的信息吗？

该代码触发了一个netbeans函数，该函数将数据存储到postgresql数据库中，所以当我点击“保存按钮”时，我有100个变量需要存储。

变量是这样写的（在js文件中）：

```
var plazo_debo_casa1 = (getValor("plazo_debo_casa1"));
var plazo_debo_casa2 = (getValor("plazo_debo_casa2"));
var plazo_debo_casa3 = (getValor("plazo_debo_casa3"));
var plazo_debo_prestamo1 = (getValor("plazo_debo_prestamo1"));
var plazo_debo_prestamo2 = (getValor("plazo_debo_prestamo2"));
var plazo_debo_prestamo3 = (getValor("plazo_debo_prestamo3"));
var plazo_debo ="&plazo_debo_casa1="+plazo_debo_casa1+"&plazo_debo_casa2="+plazo_debo_casa2+"&plazo_debo_casa3="+plazo_debo_casa3+"&plazo_debo_prestamo1="+plazo_debo_prestamo1+"&plazo_debo_prestamo2="+plazo_debo_prestamo2+"&plazo_debo_prestamo3="+plazo_debo_prestamo3; 
```

然后一起在“param”变量中。现在清楚了吗？

我在firefox中安装了httpfox，然后我检查了发生了什么，最后我想我得到了错误：它说NS_ERROR_NET_RESET。这是实际的错误吗？我能做些什么来解决它？

我一直在互联网上搜索，可能我的问题是 URL 太长，

```
http://www.mirodinero.com:8080/mirodinero-war/setMisDatos?callback=respuestaGuardarMisDatos&param=%26usuario%3DIsa%20Mirodinero%26nivel%3D109%26gano_sal_neto%3D211113.45%26gano_sal_prof%3D2480%26gano_monet%3D0%26gano_renta_fija%3D0%26gano_renta_vble%3D0%26gano_inmuebles%3D2226.75%26gano_otros%3D2223.73%26gano_otros_ing%3D2411.12%26porc_gano_monet%3D0%26porc_gano_rentaf%3D0%26porc_gano_rentav%3D0%26porc_gano_inm%3D2%26porc_gano_otros%3D2%26porc_gano_otros_ing%3D1%26gasto_casa1%3D1306.46%26gasto_casa2%3D2402.38%26gasto_casa3%3D3999.57%26gasto_prestamo1%3D93475.58%26gasto_prestamo2%3D7325.88%26gasto_prestamo3%3D34090.9%26gasto_tarjetas%3D29443.2%26gasto_ibi%3D5670%26gasto_imp_otros%3D6780%26gasto_seg_inm%3D1320%26gasto_seg_pens%3D3451.22%26gasto_seg_vida%3D2330%26gasto_seg_plan%3D34230%26gasto_seg_medico%3D21220%26gasto_seg_coche%3D220%26gasto_luz%3D620%26gasto_agua%3D4550%26gasto_gas%3D320%26gasto_telef_f%3D22320%26gasto_telef_m%3D2350%26gasto_internet%3D20%26gasto_tv%3D3450%26gasto_hogar%3D20%26gasto_comida%3D20%26gasto_cenas_copas%3D20%26gasto_viajes%3D20%26gasto_vacaciones%3D220%26gasto_mobiliario%3D220%26gasto_ropa%3D2320%26gasto_transp%3D230%26gasto_otros%3D3620%26gasto_colegios%3D240%26gasto_univ%3D340%26gasto_master%3D2230%26gasto_otros_gastos%3D7323433%26porc_gasto_tarjetas%3D0%26porc_gasto_ibi%3D0%26porc_gasto_trib%3D0%26porc_gasto_seg_inm%3D0%26porc_gasto_seg_pens%3D0%26porc_gasto_seg_vida%3D2%26porc_gasto_seg_plan%3D2%26porc_gasto_seg_med%3D0%26porc_gasto_seg_coche%3D0%26porc_gasto_sum_luz%3D2%26porc_gasto_sum_agua%3D2%26porc_gasto_sum_gas%3D0%26porc_gasto_sum_teleff%3D0%26porc_gasto_sum_telefm%3D0%26porc_gasto_sum_int%3D0%26porc_gasto_sum_tv%3D0%26porc_gasto_nivel_hogar%3D0%26porc_gasto_nivel_comida%3D0%26porc_gasto_nivel_cenas%3D0%26porc_gasto_nivel_viajes%3D0%26porc_gasto_nivel_vacac%3D0%26porc_gasto_nivel_mob%3D0%26porc_gasto_nivel_ropa%3D20%26porc_gasto_nivel_transp%3D30%26porc_gasto_nivel_otros%3D30%26porc_gasto_colegios%3D2%26porc_gasto_univ%3D0%26porc_gasto_master%3D0%26porc_gasto_otros_gastos%3D23%26tengo_casa1%3D1231.11%26tengo_casa2%3D10000%26tengo_casa3%3D22240%26tengo_otras%3D23560%26tengo_monetario%3D1212.34%26tengo_planpensiones%3D23230%26tengo_otros%3D23330%26porc_tengo_casa1%3D1%26porc_tengo_casa2%3D0%26porc_tengo_casa3%3D2%26porc_tengo_otras%3D0%26porc_tengo_monet%3D0%26porc_tengo_plan%3D0%26porc_tengo_otros%3D0%26debo_casa1%3D4340%26debo_casa2%3D23450%26debo_casa3%3D23430%26debo_prestamo1%3D23330%26debo_prestamo2%3D6871.11%26debo_prestamo3%3D11340%26debo_tarjetas%3D61340%26porc_debo_casa1%3D30%26porc_debo_casa2%3D10%26porc_debo_casa3%3D12%26porc_debo_prestamo1%3D1%26porc_debo_prestamo2%3D12%26porc_debo_prestamo3%3D1%26porc_debo_tarjetas%3D4%26plazo_debo_casa1%3D230%26plazo_debo_casa2%3D450%26plazo_debo_casa3%3D122%26plazo_debo_prestamo1%3D3%26plazo_debo_prestamo2%3D12%26plazo_debo_prestamo3%3D4 
```

我数了一下，是2568个字符。所以我试图把它分成两部分，因为有“我赚的”、“我的债务”等。问题是，如果我的函数只保存一些列，那么它只会删除 postgres 中剩余的列。如何解决这个问题？

由于我的网页有不同的部分放置数据，我认为一个好主意是为部分变量创建更小的函数，例如放置 30 个变量并执行回调。我确实喜欢这样：

```
function guardaLoQueGano(){
var nivel = parseInt(document.getElementById('progreso_nivel_total').style.marginLeft);

/*idUsusario*/
var usuario =  miGetElementsByClassName('title', document.getElementById('block-user-1'))[0].innerHTML;

/*gano*/
var gano_sal_neto = getValor("gano_sal_neto");
var gano_sal_prof = getValor("gano_sal_prof");
var gano_monet = getValor("gano_monet");
var gano_renta_fija = (getValor("gano_renta_fija"));
var gano_renta_vble = (getValor("gano_renta_vble"));
var gano_inmuebles = (getValor("gano_inmuebles"));
var gano_otros = (getValor("gano_otros"));
var gano_otros_ing = (getValor("gano_otros_ing"));

/*gano porcentajes*/
var porc_gano_monet = getValor("porc_gano_monet");
var porc_gano_rentaf = getValor("porc_gano_rentaf");
var porc_gano_rentav = getValor("porc_gano_rentav");
var porc_gano_inm = getValor("porc_gano_inm");
var porc_gano_otros = getValor("porc_gano_otros");
var porc_gano_otros_ing = getValor("porc_gano_otros_ing");

var param = "&usuario=" + usuario + "&nivel=" + nivel + "&gano_sal_neto=" + gano_sal_neto + "&gano_sal_prof=" + gano_sal_prof + "&gano_monet=" + gano_monet + "&gano_renta_fija=" + gano_renta_fija + "&gano_renta_vble=" + gano_renta_vble + "&gano_inmuebles=" + gano_inmuebles + "&gano_otros=" + gano_otros + "&gano_otros_ing=" + gano_otros_ing +     "&porc_gano_monet=" + porc_gano_monet + "&porc_gano_rentaf=" + porc_gano_rentaf + "&porc_gano_rentav=" + porc_gano_rentav + "&porc_gano_inm=" + porc_gano_inm + "&porc_gano_otros=" + porc_gano_otros + "&porc_gano_otros_ing=" + porc_gano_otros_ing;

var s = document.createElement("script");

s.type = "text/javascript"; s.async = true;
s.src = direccion_servidor + "setMisDatos?callback=respuestaGuardarMisDatos&param=" + encodeURIComponent(param);
var h = document.getElementsByTagName("script")[0];
// adesso h.appendChild(s);
h.parentNode.insertBefore(s, h);
alert("Datos de lo que gano actualizados correctamente");
} 
```

这种函数完美运行，但有一个大问题：它改变了这个函数列的值，但删除了剩余的列。如何创建不同的较小功能，以仅保存某些列而不更改其他列？我是否应该编写 netbeans 函数 setMisDatos 以使其更清晰？

**新发现：**

我一直在互联网上搜索，可能发现我的问题是我可能会将 GET 方法更改为 POST 协议，以便它可以采用任何长度。

在我的页面上有一个 php 代码来调用 javascript 函数，即：

```
 <div id="lo_que_gano" class="mis_datos" style="display:none">
<div class="generic todo_izq">

    <div class="ancho_lado_izq generic">
        <div class="texto_form generic">Salario neto</div>
        <div class="generic">
            <input class="numero" id="gano_sal_neto" type="text" value="0" onchange="calculoGano()" onkeypress="tecla('gano_sal_prof', event);"/></br>
        </div>
    </div>
  //all the values that has to be stored
 </div>
 <div class="generic botonGuardar">
    <input type="button" value="Guardar" onclick="return guardaTodo()"/>
 </div>
 </div> 
```

如何将 GET 方法转换为 POST？它应该在javascript或php代码中实现吗？对不起，我真的不是这方面的专家。

我尝试用 &u= 更改 &usuario=，它可以工作，但是当我尝试更改“gano_sal_neto”（我用 &gsn= 更改了 &gano_sal_neto=）时，它将删除 postgres 表中的相应值（NULL 值）。现在哪里出错了？对不起，我真的不是这方面的专家。

我有一个观察结果：为什么我在 30 秒后会出错，但不是在那个间隔内？

根据我得到的答案，我所做的更改从“gano_sal_neto”到“gsn”：

*   页面源代码加载的javascript文件；
*   drupal页面的php代码；
*   netbeans 文件；
*   我在存储数据的同一表中创建了一个名为“gsn”的新列。

为了使新 URL 正常工作，我缺少什么？

**更好地解释现在发生的事情：**

我有两种类型的错误：

在 netbeans 日志文件中，它告诉我：

代码：错误：com.mirodinero.web.calculos.CalcularSegmentos.ejecutar(CalcularSegmentos.java:65) 处 com.mirodinero.web.calculos.Calculos.getTotalGano(Calculos.java:182) 处的 java.lang.NullPointerException。 mirodinero.web.servlets.setMisDatos.actualizarSegmentos(setMisDatos.java:543) 其中这些行的 getTotalGano 是：

```
public float getTotalGano() {
    float res = user.getGanoMonet() + user.getGanoRentaFija() + user.getGanoRentaVble() + user.getGanoInmuebles() + user.getGanoOtros() + user.getGanoSalNeto() + user.getGanoSalProf() + user.getGanoOtrosIng();
    return res;
} 
```

ejecutar() 是：

```
public void ejecutar() {
    boolean existe = true;
    DatosUsuario datosUser = datosUsuarioFacade.findById(atributosUsuario.getIdUsuario());
    if (datosUser != null) {
        List<Cartera> lc = carteraFacade.findByIdUsuario(atributosUsuario.getIdUsuario());
        Calculos c = new Calculos(datosUser, accionesDatosFacade, fondosDatosFacade, bonosDatosFacade, lc);
        ahorroLiquido = c.getTengoDisponible() / c.getTotalGasto();
        ingresoAnual = c.getTotalGano(); /*this is line 65 */
        diferenciaGanoGasto = c.getSupDefTotal();//indica lo que gano menos lo que gasto
        modificarAtributos(c, datosUser);
    } 
```

在 postgres 日志文件中，我得到：

```
2012-05-22 11:10:46 CESTLOG:  could not receive data from client: Unknown winsock error 10061
2012-05-22 11:10:46 CESTLOG:  unexpected EOF on client connection
2012-05-22 11:19:12 CESTLOG:  CreateProcess call failed: Unknown winsock error 10004 (error code 1115)
2012-05-22 11:19:12 CESTLOG:  could not fork autovacuum worker process: Unknown winsock error 10004 
```

但我不知道这是什么意思。也许我应该对 pgadmin 做些什么来“升级”数据库以进行更改：我添加了一个名为 gsn -real 和默认 0 的列，如 gano_sal_neto-，而不删除 gano_sal_neto（它仍然存储了用户的数据）。

仍然没有人能帮助我解决这个问题吗？我不知道在 postgres 中更改列名有什么问题，也许我缺少一个程序？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-05-29T10:36:01.910

答案是更改*glassfish* `HTTP service`侦听中的设置：我将超时更改为更大的间隔，现在它可以工作了！

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-05-19T15:52:51.543

因为你正在做的是构造一个`<script src=...>`元素，`src`动态生成属性，所以不可能使用 POST。所有 HTTP 请求都使用 GET。您*可以*做的是对您的查询字符串进行编码以使其更短。服务器端处理可以对其进行解码以发送正确的脚本文件。

例如，您不需要`&usario=`何时调用它，`&u=`因为您的服务器端进程不应该需要调用它`usario`。通过这样做，您已经节省了五个字节。

您可以对值进行编码以使其更短，并在服务器端对其进行解码。我不知道数据实际上是什么；这可能不切实际。

# ffmpeg - 如何用FFMPEG分块记录UDP流？

> ID：10588001
> 
> 赞同：5
> 
> 时间：2012-05-14T17:12:27.833
> 
> 标签：ffmpeg, udp, video-recording

我正在寻找一种使用 ffmpeg 但以 1000 万块记录视频 UDP 流的方法。我目前使用以下内容获取 1000 万视频（使用 h264 转码）。

“ffmpeg -i udp://239.0.77.15:5000 -map 0:0 -map 0:1 -s 640x360 -vcodec libx264 -g 100 -vb 500000 -r 25 -strict 实验性 -vf yadif -acodec aac -ab 96000 -ac 2 -t 600 -y /media/test.m4 "

我的问题是使用命令行 ffmpeg 需要时间与 udp 流重新同步，每次丢失 2 秒的视频。正常吗？

知道是否有办法在命令行中执行此操作，还是我应该尝试使用 ffmpeg API？

提前致谢

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2012-05-23T10:26:54.180

好的，找到了。

最近ffmpeg添加了一个segmenter，语法如下：

`-f segment`: 告诉 ffmpeg 使用分段器

`-segment_time`: 以秒为单位的块大小

您可以使用带有 %03d (000,001,002,003...) 之类的自动增量文件名。

这是我将 UDP MPEGTS 流转码为 H264+AAC 并将其保存到文件块（60 秒）的行：

> ffmpeg -i udp://239.0.77.15:5000 -map 0:0 -map 0:1 -s 640x360 -vcodec libx264 -g 60 -vb 500000 -strict experimental -vf yadif -acodec aac -ab 96000 -ac 2 - y -f 段 -segment_time 60 "xxx-%03d.ts"

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2017-04-16T09:14:30.493

这是一个更好的方法：

> ffmpeg -re -i udp://10.1.1.238:1234?fifo_size=1000000 -vcodec libx264 -vb 500000 -g 60 -vprofile main -acodec aac -ab 128000 -ar 48000 -ac 2 -vbsf h264_mp4toannexb -b 1000k -minrate 1000k -maxrate 1000k -strict experimental -f stream_segment -segment_format mpegts -segment_time 5 -segment_atclocktime 1 -reset_timestamps 1 -strftime 1 d:/%H%M%S.mp4

通过此代码，ffmpeg 使用当前系统时间制作一系列输出文件。

# blackberry - 在 BlackBerry WebWorks 上列出已连接设备的命令

> ID：10588004
> 
> 赞同：0
> 
> 时间：2012-05-14T17:12:49.153
> 
> 标签：blackberry, blackberry-simulator, blackberry-webworks

我记得在 BlackBerry WebWorks SDK 中使用了一个命令，该命令会列出所有连接的设备（包括 BB 模拟器）以及设备的 IP 地址。

执行此操作的命令行/终端命令是什么？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-05-16T12:56:51.737

经过几天的思考，我意识到我犯了一个错误。在同时学习 Webworks 和 Android SDK 的同时，我似乎对 android 命令感到困惑..

```
adb devices 
```

..与黑莓。搜索了几天后，我 90% 确定 BlackBerry Webworks SDK 上没有等效命令。

***目前没有列出已连接设备的命令。***

# javascript - YUI 选择器的 id 是一个长数字

> ID：10588007
> 
> 赞同：0
> 
> 时间：2012-05-14T17:13:08.087
> 
> 标签：javascript, css-selectors, yui

我有两个div。一个有一个 id，它是一个长数字的字符串表示形式。另一个是较短的字符串。如果我使用 YUI 选择器来查询这些 div，它将无法找到具有长编号的 id。

[这是jsfiddle：](http://jsfiddle.net/septerr/Xkyfq/4/)

为什么它找不到第一个 div？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-05-14T17:16:34.810

Id 不能以数字开头，仅此而已。

更改自：

```
<div id='13367716691470000' style='display:none;'>test</div> 
```

到：

```
<div id='foo13367716691470000' style='display:none;'>test</div> 
```

[**更新小提琴**](http://jsfiddle.net/gdoron/Xkyfq/5/)

> ID 和 NAME 标记必须以字母 ([A-Za-z]) 开头，后跟任意数量的字母、数字 ([0-9])、连字符 ("-")、下划线 ("_") , 冒号 (":") 和句点 (".")。

[**来源**](http://www.w3.org/TR/html4/types.html#type-id)

# string - 在 R 中使用变量字符串引用对象

> ID：10588008
> 
> 赞同：3
> 
> 时间：2012-05-14T17:13:18.327
> 
> 标签：string, r, variables, loops, concatenation

编辑：感谢迄今为止做出回应的人；我是 R 的初学者，刚刚为我的理学硕士论文承担了一个大型项目，所以对初始处理有点不知所措。我使用的数据如下（来自 WMO 公开的降雨数据）：

`120 6272100 KHARTOUM 15.60 32.55 382 1899 1989 0.0
1899 0.03 0.03 0.03 0.03 0.03 1.03 13.03 12.03 9999 6.03 0.03 0.03
1900 0.03 0.03 0.03 0.03 0.03 23.03 80.03 47.03 23.03 8.03 0.03 0.03
1901 0.03 0.03 0.03 0.03 0.03 17.03 23.03 17.03 0.03 8.03 0.03 0.03
(...)
`120 6272101 JEBEL AULIA 15.20 32.50 380 1920 1988 0.0
1920 0.03 0.03 0.03 0.00 0.03 6.90 20.00 108.80 47.30 1.00 0.01 0.03
1921 0.03 0.03 0.03 0.00 0.03 0.00 88.00 57.00 35.00 18.50 0.01 0.03
1922 0.03 0.03 0.03 0.00 0.03 0.00 87.50 102.30 10.40 15.20 0.01 0.03
(...)``

 ``There are ~100 observation stations that I'm interested in, each of which has a varying start and end date for rainfall measurements. They're formatted as above in a single data file, with stations separated by "120 (station number) (station name)".

I need first to separate this file by station, then to extract March, April, May and June for each year, then take a total of these months for each year. So far I'm messing around with loops (as below), but I understand this isn't the right way to go about it and would rather learn some better technique. Thanks again for the help!

(Original question:) I've got a large data set containing rainfall by season for ~100 years over 100+ locations. I'm trying to separate this data into more managable arrays, and in particular I want to retrieve the sum of the rainfall for March, April, May and June for each station for each year. The following is a simplified version of my code so far:

```
a <- array(1,dim=c(10,12))
for (i in 1:5) {

  all data:
  assign(paste("station_",i,sep=""), a)

  #march - june data:
  assign(paste("station_",i,"_mamj",sep=""), a[,4:7])
} 
````` 

``So this gives me `station_(i)__mamj_` which contains the data for the months I'm interested in for each station. Now I want to sum each row of this array and enter it in a new array called `station_(i)_mamj_tot`. Simple enough in theory, but I can't work out how to reference station_(i)_mamj` so that it varies the value of i`每次迭代。非常感谢任何帮助！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2012-05-14T20:54:13.917

这完全是在乞求一个数据框，然后它只是一个带有电动工具的单线，比如`ddply`（非常强大）：

```
tot_mamj <- ddply(rain[rain$month %in% 3:6,-2], 'year', colwise(sum)) 
```

按年份给出 M/A/M/J 的总和：

```
 year station_1 station_2 station_3 station_4 station_5 ...
1  1972  8.618960  5.697739 10.083192  9.264512 11.152378 ...
2  1973 18.571748 18.903280 11.832462 18.262272 10.509621 ...
3  1974 22.415201 22.670821 32.850745 31.634717 20.523778 ...
4  1975 16.773286 17.683704 18.259066 14.996550 19.007762 ...
... 
```

下面是完美的工作代码。我们创建一个*col.names*为 'station_n' 的数据框；年和月的额外列（因子，或者如果你很懒，则为整数，请参阅脚注）。现在您可以按月或按年进行任意分析（使用 plyr 的 split-apply-combine 范例）：

```
require(plyr) # for d*ply, summarise
#require(reshape) # for melt

# Parameterize everything here, it's crucial for testing/debugging
all_years <- c(1970:2011)
nYears <- length(all_years)  
nStations <- 101
# We want station names as vector of chr (as opposed to simple indices)
station_names <- paste ('station_', 1:nStations, sep='')

rain <- data.frame(cbind(
  year=rep(c(1970:2011),12),
  month=1:12
))
# Fill in NAs for all data
rain[,station_names] <- as.numeric(NA)
# Make 'month' a factor, to prevent any numerical funny stuff e.g accidentally 'aggregating' it
rain$month <- factor(rain$month)

# For convenience, store the row indices for all years, M/A/M/J
I.mamj <- which(rain$month %in% 3:6)

# Insert made-up seasonal data for M/A/M/J for testing... leave everything else NA intentionally
rain[I.mamj,station_names] <- c(3,5,9,6) * runif(4*nYears*nStations)

# Get our aggregate of MAMJ totals, by year
# The '-2' column index means: "exclude month, to prevent it also getting 'aggregated'"
excludeMonthCol = -2
tot_mamj <- ddply(rain[rain$month %in% 3:6, excludeMonthCol], 'year', colwise(sum))

# voila!!
#    year station_1 station_2 station_3 station_4 station_5
# 1  1972  8.618960  5.697739 10.083192  9.264512 11.152378
# 2  1973 18.571748 18.903280 11.832462 18.262272 10.509621
# 3  1974 22.415201 22.670821 32.850745 31.634717 20.523778
# 4  1975 16.773286 17.683704 18.259066 14.996550 19.007762 
```

作为脚注，在我将月份从数字转换为因子之前，它正在悄悄地“聚合”（直到我输入“-2”：排除列引用）。然而，更好的是当你把它作为一个因素时，它会拒绝直接聚合，并抛出一个错误（这对于调试来说是可取的）：

```
 ddply(rain[rain$month %in% 3:6, ], 'year', colwise(sum))
Error in Summary.factor(c(3L, 3L, 3L, 3L, 3L, 3L), na.rm = FALSE) : 
  sum not meaningful for factors 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-05-14T17:44:36.317

对于您的原始问题，请使用 get()：

```
i <- 10
var <- paste("test", i, sep="_")
assign(10, var)
get(var) 
```

正如大卫所说，这可能不是最好的方法，但有时它可能很有用（而且 IMO 的分配/获取结构比 eval(parse) 好得多）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-05-14T17:21:40.913

为什么要使用`assign`创建变量，如,`station1`等？将它们存储在一个列表中会更容易和更直观，比如, ,等等。然后可以使用它们的索引访问每个。`station2``station_3_mamj``stations[[1]]``stations[[2]]``stations_mamj[[3]]`

由于您正在处理的每个站数据看起来都是一个大小相同的矩阵，因此您甚至可以将它们作为一个 3 维矩阵来处理。

ETA：顺便说一句，如果你*真的*想用这种方式解决问题，你会这样做：

```
eval(parse(text=paste("station", i, "mamj", sep="_"))) 
```

但是不使用`eval`几乎总是不好的做法，并且会使对数据进行即使是简单的操作也变得困难。

# c - 当遇到 exit(1) 时，malloc 的内存会发生什么？

> ID：10588014
> 
> 赞同：5
> 
> 时间：2012-05-14T17:13:37.067
> 
> 标签：c, memory-leaks, malloc, free, exit

在 C 中，如果我在执行期间使用和分配内存`malloc`，程序遇到异常/错误并`exit(1)`在程序中手动合并语句退出，C 编译器是否会在意外退出之前自动释放内存，还是我必须手动在程序中的行之前执行此操作`exit(1)`。

我在 Ubuntu 32 位平台上使用 gcc-4.5.2 编译器。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2012-05-14T17:15:00.467

一旦你调用`exit`，操作系统就会收回所有分配的内存。所以没必要打电话`free`。

编辑：但是释放您在程序中分配的内存通常是一种好习惯，因为您将来修改它时可能会忽略它对 free 的调用。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2012-05-14T17:25:09.383

在设计良好的操作系统上，当进程退出（使用 exit()、die()、abort() 或 raise() 或被错误、信号或其他任何东西杀死）时，操作系统应该释放占用进程使用的所有资源，包括堆栈空间、堆、分配的内存（通常在堆上）、关闭打开的文件描述符（如果是 *NIX 系统）等。

但是，我不会选择“无需调用 free()”。如果您没有显式地释放您拥有 malloc() 的内存，这是一个糟糕的编程/设计概念，尽管您最终可以依靠操作系统为您执行此操作，但当您稍后修改您的内存时，它可能会导致内存泄漏项目不退出，但您忘记释放（）您使用的内存。

# git - Git历史报告

> ID：10588017
> 
> 赞同：2
> 
> 时间：2012-05-14T17:13:53.540
> 
> 标签：git

我正在尝试基于 git log 构建历史报告。但我想跳过除 master 之外的分支，即使它们已合并。例如，我创建了使用功能 X 的分支。这个分支中有很多小提交，我不喜欢在报告中看到这些小步骤。但是当我将这个分支合并到 master 并带有消息“功能 X 已实现”时，我希望在报告中看到这个里程碑。感谢您帮助 git 新手。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-05-14T17:29:42.513

如果你想合并一个分支而不合并该分支的整个提交历史，你可以使用`--squash`命令 to `merge`. 这会将来自该分支的所有更改应用到您的工作目录，而无需实际创建任何提交；此时，您可以为整个历史生成单个提交。因此，如果您的 `master`分支如下所示：

```
commit 69b2303df9884627ade245fff4a3376f39646cbd
Author: Lars Kellogg-Stedman <lars@seas.harvard.edu>
Date:   Mon May 14 13:24:56 2012 -0400

    commit on master

commit c8496d9ac4048a414faffb91486075ab0952e2d7
Author: Lars Kellogg-Stedman <lars@seas.harvard.edu>
Date:   Mon May 14 13:24:43 2012 -0400

    initial commit 
```

`newbranch`另一个看起来像这样的分支：

```
commit 71587063a73368ea160a78cd6d130f828cb05e0e
Author: Lars Kellogg-Stedman <lars@seas.harvard.edu>
Date:   Mon May 14 13:25:36 2012 -0400

    commit 3 on new branch

commit 37ab4fc91c796ed05ecae0c8f504f263cee9603d
Author: Lars Kellogg-Stedman <lars@seas.harvard.edu>
Date:   Mon May 14 13:25:36 2012 -0400

    commit 2 on new branch

commit 5fd0768e355d1cba0905aaed327fb20ef263d6ef
Author: Lars Kellogg-Stedman <lars@seas.harvard.edu>
Date:   Mon May 14 13:25:36 2012 -0400

    commit 1 on new branch

commit 69b2303df9884627ade245fff4a3376f39646cbd
Author: Lars Kellogg-Stedman <lars@seas.harvard.edu>
Date:   Mon May 14 13:24:56 2012 -0400

    commit on master

commit c8496d9ac4048a414faffb91486075ab0952e2d7
Author: Lars Kellogg-Stedman <lars@seas.harvard.edu>
Date:   Mon May 14 13:24:43 2012 -0400

    initial commit 
```

然后你可以这样做：

```
git checkout master
git merge --squash newbranch
git commit -m "merged changes from newbranch" 
```

然后分支的日志`master`将如下所示：

```
commit 0737d3dac5f769f837d4d0ce90ba1004c79d6a92
Author: Lars Kellogg-Stedman <lars@seas.harvard.edu>
Date:   Mon May 14 13:26:29 2012 -0400

    merged newbranch into master

commit 69b2303df9884627ade245fff4a3376f39646cbd
Author: Lars Kellogg-Stedman <lars@seas.harvard.edu>
Date:   Mon May 14 13:24:56 2012 -0400

    commit on master

commit c8496d9ac4048a414faffb91486075ab0952e2d7
Author: Lars Kellogg-Stedman <lars@seas.harvard.edu>
Date:   Mon May 14 13:24:43 2012 -0400

    initial commit 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-05-14T17:26:07.510

如果我理解正确，您正在寻找的本质上是一个合并到 master 的列表。

如果这是正确的，那么我相信这将起作用：

```
git checkout master
git log --merges 
```

# cakephp - 将值发布到 cakePHP 控制器操作并显示它

> ID：10588019
> 
> 赞同：0
> 
> 时间：2012-05-14T17:14:02.940
> 
> 标签：cakephp, facebook-graph-api, jquery

我在一个基于 PHP 的蛋糕网站中使用 Facebook Javascript API 进行 Facebook 身份验证并实现其他 Facebook 功能。现在我正在使用 API 来获取 Facebook 好友，我需要对好友列表进行一些操作。所以我将 JSON 对象数组发布到相应的控制器操作。稍后使用另一个 AJAX 调用加载此页面。在这之间我丢失了发布的数据。我需要的是，我需要将好友列表与现有 Facebook ID 进行比较。我正在使用下面的代码

```
 FB.api('/me/friends', function(response) {
        $.ajax({
        type: 'post',
        url: baseUrl+'/user_details/userlist',
        data: response,
        dataType: 'json',
        success: function() {

        }});
    }); 
```

我怎样才能做到这一点？还是我需要使用基于 PHP 的 SDK？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-05-14T17:17:34.223

将您的`data`选项更改为此格式：

```
data: { "data" : response }, 
```

然后检查`$this->request->data`你的 Cake 控制器（假设是 Cake 2.x）。

# python - 将大于 maxint 的时间戳转换为日期时间对象

> ID：10588027
> 
> 赞同：5
> 
> 时间：2012-05-14T17:14:56.877
> 
> 标签：python, datetime, year2038

我有一些代码用于将存储为字符串的一些时间戳转换为日期时间对象，并注意到今天在转换具有大于最大 int 的 int 时间戳值的日期时出现异常。

```
datetime.datetime.fromtimestamp(2147570047) 
```

例如给我

```
ValueError: timestamp out of range for platform time_t 
```

我怎样才能解决这个问题？假设我想继续使用 32 位 python（运行 2.7.2）

我注意到我可以将 max int 转换为 datetime 对象，然后使用 timedeltas 添加任何额外的内容，但在实践中我想不出一种特别有效或好的方法。我可以将这些 2038+ 时间戳转换为日期时间对象的好方法是什么？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2012-05-14T17:23:01.023

想我解决了，我有点惊讶这不会引发同样的异常

```
>>> datetime.datetime.fromtimestamp(0) + datetime.timedelta(seconds=2147570047)
datetime.datetime(2038, 1, 20, 4, 14, 7) 
```

编辑：这不是一个完美的解决方案，似乎是时区的一些问题（我目前在 BST 时间（+1）所以可以解释为什么下面的时间相隔一个小时）

```
>>> datetime.datetime.fromtimestamp(2047570047)
datetime.datetime(2034, 11, 19, 17, 27, 27)
>>> datetime.datetime.fromtimestamp(0) + datetime.timedelta(seconds=2047570047)
datetime.datetime(2034, 11, 19, 18, 27, 27) 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2018-05-10T03:16:57.877

试试这个

```
__author__ = 'allenlin'
import math
import datetime
import calendar

def datetime2timestamp(dt):
    ts = calendar.timegm(dt.timetuple())
    return ts

def timestamp2datetime(timestamp):
    day_sec = 60*60*24
    ts_days = int(math.floor(timestamp / day_sec))
    ts_mod_sec = int(timestamp - (ts_days * day_sec))
    hour_sec = 60*60
    ts_mod_hour = int(math.floor(ts_mod_sec / hour_sec))
    ts_mod_sec = int(ts_mod_sec - (ts_mod_hour * hour_sec))
    min_sec = 60
    ts_mod_minute = int(math.floor(ts_mod_sec / min_sec))
    ts_mod_sec = int(ts_mod_sec - (ts_mod_minute * min_sec))

    revert = datetime.datetime(1970, 1, 1) + \
             datetime.timedelta(
                 days=ts_days,
                 hours=ts_mod_hour,
                 minutes=ts_mod_minute,
                 seconds=ts_mod_sec
             )
    return revert

def main():
    pass
    d_max = datetime.datetime.max
    print(d_max)
    ts_max = datetime2timestamp(d_max)
    print(ts_max)
    print (timestamp2datetime(ts_max))

    d_now = datetime.datetime.now()
    print(d_now)
    ts_now = datetime2timestamp(d_now)
    print(ts_now)
    print (timestamp2datetime(ts_now))

if __name__ == '__main__':
    main()
```

# c# - 将值转换为十进制

> ID：10588033
> 
> 赞同：0
> 
> 时间：2012-05-14T17:15:26.247
> 
> 标签：c#, entity-framework, decimal

这是我的代码：

```
var finiGames = myRepos.Games
                       .Where(x => x.StatusGameId == (int)StatusGameEnum.Finish 
                              && x.EndDateTime > DateTime.Today)
                       .DefaultIfEmpty();
//error line
decimal? sum = finiGames.Sum(x => x.WinCost); 
```

我得到的错误：

> 转换值类型“十进制”时出错，因为 materializuemoe 值为空。类型参数或请求使用允许值为 null 的类型的总体结果。

获得 a 的正确方法是`decimal?`什么？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2012-05-14T17:33:27.507

您需要`WinCost`将`nullable` `decimal``Sum`

```
decimal? sum = finiGames.Sum(x => (decimal?)x.WinCost); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-05-14T17:20:48.607

```
decimal sum = ((decimal?)finiGames.Sum(x => x.WinCost)) ?? 0; 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-05-14T17:33:46.673

尝试添加`ToList()`到`finiGames`. 它可能会影响您的性能，但 EF 可能无法处理数据 (SQL) 层中的转换。

# java - 从 csv 文件自动生成 Java 类

> ID：10588034
> 
> 赞同：0
> 
> 时间：2012-05-14T17:15:31.433
> 
> 标签：java, csv, pojo

我正在尝试从第一行包含标题而其他行包含数据的 csv 文件自动生成 Java POJO 类。我在网上找到了许多示例和工具，展示了如何解析 csv 文件并将数据放入 Java 对象中，但在所有这些示例和工具中，Java POJO 类已经手动创建，我正在寻找一种自动生成它们的工具。否则我需要一个类似于 Hibernate 逆向工程工具的工具，但我有 csv 文件而不是数据库。

例如，这是我的输入 csv 文件：

```
username, password,   date,        zip,  town

Klaus,    qwexyKiks,  17/1/2007,1111, New York

Oufu1,     bobilops,    10/10/2007,4555, New York 
```

这是我需要自动生成的：

```
package test;

import java.util.Date;

public class UserBean {
    String username;
    String password;
    Date date;
    int zip;
    String town;

    public Date getDate() {
        return date;
    }
    public String getPassword() {
        return password;
    }
    public String getTown() {
        return town;
    }
    public String getUsername() {
        return username;
    }
    public int getZip() {
        return zip;
    }
    public void setDate(final Date date) {
        this.date = date;
    }
    public void setPassword(final String password) {
        this.password = password;
    }

    public void setTown(final String town) {
        this.town = town;
    }
    public void setUsername(final String username) {
        this.username = username;
    }
    public void setZip(final int zip) {
        this.zip = zip;
    }
} 
```

* * *

## 回答 #1

> 赞同：-1
> 
> 时间：2012-05-14T17:22:44.877

我认为你想做的事情会很慢而且不能容错。

关系数据库管理系统中的表与 csv 文件的主要区别在于**csv 文件没有数据类型信息**。因此，您希望拥有的软件应该**在列上应用类型推断**，这可能非常缓慢且容易出错。如果您要解析可能包含错误的大文件，您将没有验证功能，并且执行时间可能成为整个系统的瓶颈。

# c# - 列表框，c# Visual Studio 2010

> ID：10588035
> 
> 赞同：-1
> 
> 时间：2012-05-14T17:15:31.777
> 
> 标签：c#, visual-studio-2010, listbox

一个小问题。我知道 Visual Studio 中的工具箱包含所有必要的组件，但我想知道我们是否可以引入我们自己的“定制”工具。例如，列表框工具。我创建了一个“SpeechListBox”类，在其中我提到了我希望我的列表框使用的所有方法，但是当我在“SpeechListBoxApplication”类中（我想使用这个列表框）时，列表框和我的方法没有出现，而是出现了没有我的方法的通用列表框工具。

我想要的是写一些像 private speechListBox1 SpeechListBox; 并以某种方式将视觉形式引入设计类，而不会将其与工具箱的列表框混淆。使程序意识到我想要这种类型的列表框具有所有扩展方法，而不是一般的工具箱类型。

有什么方法可以制作我们自己的列表框或向原始列表框工具添加方法？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-05-14T17:23:51.710

好吧，如果你`SpeechListBox`从一个是或派生自的类派生你的`System.Windows.Forms.Control`，当你编译你的项目时，它将显示在 Visual Studio 控件工具箱中。

如果您不确定从哪个类派生，您将不得不做出一些决定。如果您想自己手绘所有内容，请直接从其`Control`自身中获取。如果要构建的控件是其他控件的组合，请考虑从`UserControl`. 您没有明确列出您要对 SpeechListBox 执行的操作，但您可能需要考虑仅使用 a`ListBox`但为其提供自定义绘制的列表项。您可以通过使您的类派生自`ListBox`或仅配置 a`ListBox`以在列表框所在的表单中正确执行您想要的操作来做到这一点。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-05-14T17:26:12.473

您的代码在单独的项目中吗？然后，您必须将该项目添加到解决方案资源管理器中的 SpeechListBoxApplication 项目的引用中。

否则，您的继承控件 ( `public class SpeechListBox : ListBox`) 应显示在 GUI 设计器中工具箱的公共部分或项目后标记的部分中。

# javascript - 通过 jQuery (Javascript) 提交表单失败

> ID：10588037
> 
> 赞同：1
> 
> 时间：2012-05-14T17:15:42.843
> 
> 标签：javascript, jquery, html

我在这里想念什么？如果我尝试通过 javascript 提交表单，它不起作用。

错误（使用常规 JS 引用和 jQuery 引用提交返回相同的错误）

```
 SCRIPT3: Member not found. 
```

代码：

```
<a href="#" onclick="refresh_customer_data();return false;">Refresh customer data</a>
<script type="text/javascript">
function refresh_customer_data()
{
    $("#post-form").attr("action", "../scripts/refresh-customer-data.asp");
    $("#post-form").submit();
}
 </script>
<form method="post" action="" id="post-form">
<input type="hidden" name="fromsubmit" value="true" />
<table class="form" style="height:50px;">
<tfoot>
            <tr>
                <td><span class="required">*</span> Accessible by administrators only</td>
                <td><input type="submit" name="submit" value="" style="display:none;" /></td>
            </tr>  
</tfoot>
</table>
</form> 
```

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-05-14T17:21:38.413

与其内联调用函数，不如使用 jQuery 为您完成：

[http://jsfiddle.net/8XdwS/](http://jsfiddle.net/8XdwS/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-05-14T17:27:07.400

为什么不使用 jQuery post 将您的数据发送到这样的服务器页面

```
<a href="#" id="aRefresh">Refresh customer data</a> 
```

Javascript：

```
$(function(){
  $("#aRefresh").click(function(e){
    e.preventDefault();
    $.post("../scripts/refresh-customer-data.asp", $("#post-form").serialize(),function(data){
        //do whatever with the response from server page
      })     
    });
  }); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2014-07-01T14:55:49.420

我知道这是一个旧线程，但供大家参考：

我也遇到过这个问题，问题是提交按钮名为submit。

重命名提交按钮，即。提交2解决了这个问题。

# meteor - 如何在 Meteor 项目中使用现有的 MongoDB？

> ID：10588038
> 
> 赞同：85
> 
> 时间：2012-05-14T17:15:49.397
> 
> 标签：meteor

假设有一个 GUI 客户端（通过[wxPython](http://en.wikipedia.org/wiki/WxPython)）正在运行一段时间的 MongoDB 服务器。

如何将我的新 Meteor 项目连接到我**已经存在的 MongoDB**？

* * *

## 回答 #1

> 赞同：157
> 
> 时间：2012-10-21T09:35:30.277

使用环境变量 MONGO_URL。就像是：

```
export MONGO_URL=mongodb://localhost:27017/your_db 
```

替换`your_db`为`meteor`或您要使用的任何数据库。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2016-02-07T17:26:23.133

我们使用`npm`：

*   如果您还没有文件，请创建一个`package.json`文件。`npm init`

*   在该文件中输入并修改以下行（替换所有`<...>`的）：

```
"scripts": {"meteor": "MONGO_URL=mongodb://<USER>:<PASSWORD>@<SERVER>:<PORT>/<DB> meteor"} 
```

*   然后你可以开始*流星*`npm run meteor`

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2012-11-13T14:34:39.180

在[对 danny 的回答的评论中，Tom Wijsman 建议](https://stackoverflow.com/questions/10588038/how-to-use-the-existing-mongodb-in-a-meteor-project#comment13738623_10593624)修补 packages/mongo-livedata/mongo_driver.js，第 21 行。更好的地方是 app/meteor/run.js，第 460 行。这样，如果存在环境变量，仍然会被拾取，例如在 Heroku 上运行 Meteor 时。只需将默认硬编码的 mongodb://127.0.0.1 更改为 MongoDB 服务器的位置。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2012-10-19T12:33:44.680

您可以使用 db.copyDatabase 来执行此操作，但需要注意的是存在错误并且您无法更新 Meteor 中的数据。见[https://github.com/meteor/meteor/issues/61](https://github.com/meteor/meteor/issues/61)

如果您使用的是 Meteor 的开发版本，您可以通过启动 Meteor 应用程序从正在运行的 MongoDB 服务器传输数据，然后执行以下操作：

```
mongo --port 3002 
```

这会将您连接到 Meteor 应用程序的 Mongo 服务器。现在像这样使用 db.copyDatabase ：

```
db.copyDatabase('myappDatabase', 'meteor', 'localhost'); 
```

这会将数据库 myappDatabase 从在 localhost 的标准端口上运行的 MongoDB 服务器复制到 Meteor 应用程序 Mongo 服务器。Meteor 应用程序使用的数据库名称是“meteor”。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2012-05-15T03:01:22.857

只需将数据复制到 Meteor MongoDB 数据库 - 没有理由尝试将 Meteor 连接到现有数据库并冒险覆盖内容。

用于`mongoexport`单独转储您的集合，然后`mongoimport`将文件导入到`meteor`Meteor MongoDB 实例中命名的数据库中。Meteor MongoDB 实例在端口 3002 上运行，bind_address 为 127.0.0.1，数据文件位于 Meteor 项目子目录`.meteor/local/db`中。

如果您不熟悉 MongoDB 中的导入/导出，请参阅[文档。](http://www.mongodb.org/display/DOCS/Import+Export+Tools#ImportExportTools-DataImportandExport)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2017-04-15T16:42:32.583

我所做的只是添加了我的数字海洋水滴服务器的 IP，而不是本地主机，它起作用了：

```
env: {
      ROOT_URL: 'http://yourdomain.com',
      MONGO_URL: 'mongodb://104.236.24.66:27017/meteor',
      PORT: 3002,
    }, 
```

* * *

编辑：使用 MUP 部署您的流星项目：[https ://github.com/zodern/meteor-up](https://github.com/zodern/meteor-up)

```
env: {
      ROOT_URL: 'https://www.example.com',
      MONGO_URL: 'mongodb://localhost/meteor',
    }, 
```

Mup 使用 Docker，并将“链接”您的 2 个容器，从而将应用程序和 mongo 托管在同一个 VM（服务器）上。出于安全原因，不应从公共 IP 访问您的 mongoDB。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2020-10-21T13:38:10.563

花了很多时间，发现它需要在 URL 周围加上引号：

```
export MONGO_URL='mongodb://localhost/meteor'
export MONGO_OPLOG_URL='op log url' 
```

* * *

## 回答 #8

> 赞同：-6
> 
> 时间：2015-09-07T11:47:39.330

您必须让您的应用程序在一个终端窗口中运行，然后打开另一个窗口并输入“meteor mongo”，它应该可以工作！

# java - Java：获取类中的所有对象

> ID：10588041
> 
> 赞同：3
> 
> 时间：2012-05-14T17:16:13.893
> 
> 标签：java, class, object

我有一个看起来像这样的类：

```
public class Items {
    String uselessText;
    public static final Item COW = new Item("text", 0);
    public static final Item CAT = new Item("abc", 1);
    public static final Item DOG= new Item("wow", 2);
        ...SO on

    public void search(String search) {
          for(every Item in this Class) {
              if(item.textString == "abc") {
                 //DO SOMETHING
              }
          }

        } 
```

这可能吗？不，谢谢我不想做一个数组（因为我有超过 100 个项目，我希望它们静态访问）

任何的想法？

干杯

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2012-05-14T17:19:09.527

如果您可以在编译时列出该类的所有可能实例，请[使用`enum`](http://docs.oracle.com/javase/tutorial/java/javaOO/enum.html).

```
public enum Items {

    COW("text", 0),
    CAT("abc", 1),
    DOG("wow", 2),
    // ...
    ;

    private final String textString;
    private final int number;

    private Item(String textString, int number) {
        this.textString = textString;
        this.number = number;
    }

    public void search(String search) {
        for(Item : values()) {
            if("abc".equals(item.textString)) {
                //DO SOMETHING
            }
        }
    }
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-05-14T17:17:56.250

为什么不使用`List<Item>`？`static`尽管我不确定您为什么需要它，但您可以拥有该列表`static`。

然后你可以这样做：

```
for(Item item : items) {
    if("abc".equals(item.getTextString())) {
        //Do something
    }
} 
```

请注意，您不能使用`==`;比较字符串（或任何对象）。你必须使用`.equals()`. 对于`String`，您也可以使用`.compareTo()`. 使用时`==`，您只是在比较参考。此外，使用访问器而不是在 , 上创建`textString`属性。`Item``public`

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-05-14T17:20:05.760

使用数组或列表。如果您担心对 100 多个项目进行硬编码，那您就错了。从文本文件或其他文件中读取它们。但是，当您想要的是数组或列表的功能时，尝试使用新对象而不是数组或列表并没有多大意义。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-05-14T17:25:48.117

如果您不愿意使用数组，或者至少不愿意使用可迭代的东西，那么您的工作就会***比***必要的困难得多。

例如，这里有一些代码可以使用`ArrayList<String>`:

```
public class Items {
    ArrayList<Item> itemSet = new ArrayList<Item>();
    // Code to fill in itemSet - involves itemSet.add(new Item("text", 0)), etc.

    public void search(String search) {
        for(Item i: itemSet) { // Enhanced for-loop, iterates over objects
            if ("abc".equals(i.textString)) {
                // do something
            }
        }
    }
} 
```

对这些对象进行静态访问是没有意义的。如果你想从这个对象返回它，你可以使用一个访问器来返回数组或`ArrayList`任何需要它的东西。

# php - PHP上传脚本在本地工作，但不在远程服务器上

> ID：10588053
> 
> 赞同：2
> 
> 时间：2012-05-14T17:17:15.880
> 
> 标签：php, upload, mamp, bluehost

奇怪的是，这个脚本在本地工作（在 MAMP 上），但不能在我的远程服务器（Bluehost）上工作。我尝试添加一些 POST 数据，这很有效，但是文件上传根本不起作用。有任何想法吗？

```
//upload file
if ((($_FILES["file"]["type"] == "image/gif") || ($_FILES["file"]["type"] == "image/jpeg") || ($_FILES["file"]["type"] == "image/jpg") || ($_FILES["file"]["type"] == "image/pjpeg")) && ($_FILES["file"]["size"] < 2000000) && isSet($_FILES["file"])){
if ($_FILES["file"]["error"] > 0){
    echo "<div class='error'>Return Code: " . $_FILES["file"]["error"] . "</div>";
}else{
    if (file_exists("../upload/" . $_FILES["file"]["name"])){
        echo "<div class='error'>" . $_FILES["file"]["name"] . " already exists. </div>";
    }else{
        move_uploaded_file($_FILES["file"]["tmp_name"],
        "../upload/" . $_FILES["file"]["name"]);
    }
}
}else{
if((($_FILES["file"]["type"] == "image/gif") || ($_FILES["file"]["type"] == "image/jpeg") || ($_FILES["file"]["type"] == "image/jpg") || ($_FILES["file"]["type"] == "image/pjpeg"))){
    //echo "<div class='error'>Invalid file</div>";
}else{
    if(isSet($_FILES["file"]["type"]) && !isSet($message)){
        echo "<div class='error'>Invalid file type.</div>";
    }
}
} 
```

这是上传表格。

```
<form action="index.php" method="post" enctype="multipart/form-data">
            <div>
                <input type="file" name="file" id="file" />
                <input type="submit" id="submit" value="Submit" />
            </div>
        </form> 
```

上传文件夹的权限设置为“775”。

我将不胜感激任何帮助/想法。

**更新**

问题解决了。这是一个 php.ini 问题。我不确定问题到底出在哪里。但是，当我恢复默认的 php.ini 文件时，它起作用了。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-05-23T05:39:47.517

我认为问题在于服务器中上传文件夹的读写执行权限。确保目标文件夹具有读写执行 (777) 权限。

# url - 在不重定向的情况下更改 URL

> ID：10588054
> 
> 赞同：0
> 
> 时间：2012-05-14T17:17:19.967
> 
> 标签：url, browser, href

我最近在一些网站上看到了这个链接已经改变了 href 的链接`window.location`，但是当点击链接时页面没有重新加载，并且页面仍然向下滚动了之前的数量。有谁知道这是怎么做到的？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-05-14T17:20:28.433

您正在考虑的站点可能使用新的 HTML5 History API，它允许您更改后退按钮和地址栏的行为。这是一个演示：[http ://html5demos.com/history](http://html5demos.com/history)

请注意，大多数带有超链接的有趣业务都会使搜索引擎感到困惑。确保您的网站可以在古老的浏览器中正常运行（想到[Lynx ）和/或阅读 Google 的](http://lynx.browser.org/)[Ajax Crawling Guidelines](https://developers.google.com/webmasters/ajax-crawling/docs/getting-started)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2013-11-10T23:21:08.567

如果您想更改浏览器地址栏中的 URL 而无需重新加载页面，请执行此操作

```
<a href = "#" onclick="var stateObj = { foo: window.location.href };history.pushState(stateObj, "page 2", "newpage.html");">Change URL</a> 
```

**stateObj** = 将推送页面当前状态的堆栈

**"page2"** : 该参数当前被 FF 忽略。

**"newpage.html"** : 将显示在地址栏中的新 URL

参考：[https ://developer.mozilla.org/en-US/docs/Web/Guide/API/DOM/Manipulating_the_browser_history](https://developer.mozilla.org/en-US/docs/Web/Guide/API/DOM/Manipulating_the_browser_history)

**支持**：FF 4.0+、Chrome 8.0+、Safari 5.0+、Opera 11.5+、iPhone 4.2.5+

# java - 如何从 HashMap 中检索值的集合

> ID：10588055
> 
> 赞同：-1
> 
> 时间：2012-05-14T17:17:26.533
> 
> 标签：java, list, map, hashmap

我正在编写一个函数来测试 HashMap 是否具有空值。方法 .values() 应该只返回一个值的集合，但是我收到一个包含存储在里面的键和值的映射。这不好，因为我的函数的目的是检查值是否为空，但是如果我返回一个带有键和值的映射，那么如果我有一个没有值存储的键，则 .values().isEmpty() 返回 false。

```
 public Map<KEY, List<VALUES>> methodName() {
    if (MAPNAME.values().isEmpty()) {
            throw new CustomErrorException(ExceptionHandler.getErrorWithDescription(ErrorConstants.ERROR_MSG_01));
        } else {
            return MAPNAME;
        }
    } 
```

在上面的例子中， .values() 总是返回一个包含所有键和值的映射。如果 HashMap 有一个键，我的方法永远不会抛出 CustomErrorException，这很糟糕，因为它应该检测是否没有值。帮助！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2012-05-14T17:48:30.730

没有像 Map 实现这样的东西，它存储了一个没有值的键。所有 Map 实现：

*   `put`当值为空时抛出异常
*   添加一个键和值为 null 的条目

映射到 null 的键与没有值的键非常不同。键有一个值，该值为 null（这意味着值集合不会为空，除非地图为空）。没有值的键是映射中不包含的键。

长话短说，你可能想使用`MAPNAME.values().contains(null)`甚至只是`MAPNAME.containsValue(null)`做你想做的事。或者，如果您要检查*每个*键是否映射到 null，请通过迭代 .values() 集合来检查。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-05-14T17:19:43.500

您正在返回地图——MAPNAME，而不是值：

```
return MAPNAME.values(); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-05-14T17:35:14.620

如果您尝试确定地图是否包含任何空值，则应遍历值的集合并检查每个值以查看其是否为空。

包含具有 null 值的条目的映射不为空。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-05-14T18:16:13.900

你不是很清楚你想要什么——你的映射值是列表——考虑到这一点，有三种方法可以将键映射到“无值”：

*   映射到的键`null`（然后测试是`map.values().contains(null)`）
*   映射到空列表的键（然后测试是`map.values().contains(Collections.emptyList())`）
*   映射到充满`null`s 的列表的键。

如果地图确实为空（没有键），您上面的方法现在正在做的是抛出异常，否则返回地图。

目前尚不清楚您想要什么。如果您希望该方法仅在映射没有有意义的值时抛出异常（所有键都映射到 null 或空列表），那么您需要这样的东西：

```
public Map<KEY, List<VALUES>> methodName() {
    for( List<VALUES> values : MAPNAME.values() ) // 1
        if( null != values ) // 2
            for( VALUES value : values ) // 3
                if( null != value ) // 4
                    return MAPNAME;

    throw new CustomErrorException(ExceptionHandler.getErrorWithDescription(ErrorConstants.ERROR_MSG_01));
} 
```

这会在所有合理想象的“空地图”场景中引发异常——如果 (1) 地图真的是空的，或者 (2) 它只包含`null`键，或者 (3) 它只包含`null`值或空列表，或者 ( 4) 它只包含`null`值或空列表或`null`s 列表。

（上面文本中的“空性”测试级别对应于代码中的注释标签）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2020-06-12T21:47:09.543

以这种方式使用 values() 方法：- Collection set=MAPNAME.values();

然后使用 foreach 循环检查每个值是否为空。

# html - 尽管实际上没有填充，为什么我的图像底部有填充？

> ID：10588063
> 
> 赞同：0
> 
> 时间：2012-05-14T17:17:54.310
> 
> 标签：html, css, padding

这是[演示](http://jsbin.com/odotig/3/edit#preview)...

在 css 代码中，我没有写任何填充，但图像有填充底部。这是html代码：

```
<div class="image_block">
   <img width="100" height="100" alt="Facebook" src="http://i.imwx.com/web/tv/
     programs/facebook_logo_100x100.jpg">
</div> 
```

这是CSS代码：

```
body {
    background-color:#131211;
}

.image_block {
    border:1px solid #b5b5b5;
    float:left;

} 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-05-14T17:25:23.637

您的 image_block div 的高度为 104px，那里没有填充

只需将其设置为`height:100px;`

# javascript - Facebook，通知用户我的应用更新

> ID：10588066
> 
> 赞同：-1
> 
> 时间：2012-05-14T17:18:09.573
> 
> 标签：javascript, facebook

当有更新、新项目或一些新内容可用时，有没有办法通知我的应用程序的注册用户？

我需要一些扩展权限才能执行此操作吗？

我正在使用 Javascript SDK 和 PHP SDK。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-05-14T17:20:56.547

在对用户进行身份验证时请求[电子邮件权限。](https://developers.facebook.com/docs/authentication/permissions/)然后你可以给他们发你喜欢的电子邮件...

但请不要发送垃圾邮件......这不是很好。

# ios - Popcorn JS - 在 iPad 或 iOS 设备上通过 Youtube 使用爆米花

> ID：10588070
> 
> 赞同：2
> 
> 时间：2012-05-14T17:18:27.710
> 
> 标签：ios, ipad, safari, youtube, popcornjs

我正在使用 popcornjs 加载与来自 youtube 的视频的交互。当我使用文档中的代码时：

```
<html>
  <head>
<script src="http://popcornjs.org/code/dist/popcorn-complete.min.js"></script>

<script>
  // ensure the web page (DOM) has loaded
  document.addEventListener("DOMContentLoaded", function () {

       // Create a popcorn instance by calling the Youtube player plugin
     var example = Popcorn.youtube(
       '#video',
       'http://www.youtube.com/watch?v=CxvgCLgwdNk' );

     // add a footnote at 2 seconds, and remove it at 6 seconds
     example.footnote({
       start: 2,
       end: 6,
       text: "Pop!",
       target: "footnotediv"
     });

     // play the video right away
     //example.play(); => commented because you can't autoplay on ios

  }, false);
</script>
  </head>
  <body>
    <div id="video" style="width: 360px; height: 300px;" ></div>
    <div id="footnotediv"></div>
  </body>
</html> 
```

它在任何浏览器上看起来都很完美，但在 iPad 上什么都没有。当我用爆米花加载视频但不使用 Youtube 时，它​​似乎工作正常。

我能做些什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-05-15T20:55:12.967

不幸的是，ipad 不支持 Flash。我们确实有一张正在处理 Popcorn 的票以切换到他们的 HTML5 API，您可以在此处查看：

[https://webmademovies.lighthouseapp.com/projects/63272/tickets/329-support-youtube-html5-api-playback-engine](https://webmademovies.lighthouseapp.com/projects/63272/tickets/329-support-youtube-html5-api-playback-engine)

希望有帮助，布雷特

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2017-05-20T09:34:23.320

尝试使用智能媒体包装器：

var example = Popcorn.smart('#video', ' [http://www.youtube.com/watch?v=CxvgCLgwdNk](http://www.youtube.com/watch?v=CxvgCLgwdNk) ');

```
 // add a footnote at 2 seconds, and remove it at 6 seconds
 example.footnote({
   start: 2,
   end: 6,
   text: "Pop!",
   target: "footnotediv"
 });

 // play the video right away
 //example.play(); => commented because you can't autoplay on ios
}, false); 
```

我也面临这个问题，Youtube Popcorn 无法在 iPad 上运行。但有趣的是，我发现了一个使用爆米花 youtube 的网站，它在 iPad 上运行良好

关联：

[http://www.retn.org/show/south-burlington-school-board-meeting-october-2-2013](http://www.retn.org/show/south-burlington-school-board-meeting-october-2-2013)

所以，我想有人应该想出更具体的答案

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2017-12-10T15:51:44.740

在您的代码中编辑此文件：

[https://github.com/mozilla/popcorn-js/blob/master/wrappers/youtube/popcorn.HTMLYouTubeVideoElement.js](https://github.com/mozilla/popcorn-js/blob/master/wrappers/youtube/popcorn.HTMLYouTubeVideoElement.js)

注释第 117 行的正文部分， `onPlayerReady()`并在 iPad 的情况下在此函数中添加以下语句。

```
addYouTubeEvent("play", onFirstPlay);
playerReady = true;
mediaReady = true; 
player.mute(); 
```

原因：iPad 上的 Youtube 需要用户交互，你不能以编程方式启动它，并且由于 iPad 的`player.isMuted()`方法返回`false`，`addYouTubeEvent("play", onFirstPlay)`语句永远不会被调用。

# rabbitmq - “Hello World”不适用于rabbitmq

> ID：10588071
> 
> 赞同：7
> 
> 时间：2012-05-14T17:18:29.053
> 
> 标签：rabbitmq

我是 rabbitmq 的新手，但由于某些（未知）原因，“hello world”程序对我不起作用。send.py 和 receive.py 只是从教程页面复制和粘贴：

[http://www.rabbitmq.com/tutorials/tutorial-one-python.html](http://www.rabbitmq.com/tutorials/tutorial-one-python.html)

rabbitmq 是在 RHEL 6 上使用“yum”安装的。Python 版本是 2.6。我使用启动服务器

```
$ service rabbitmq-server start 
```

它打印“成功”。

运行 send.py 和 receive.py 没有错误或警告消息：

```
$ python send.py
 [x] Sent 'Hello World!'

$ python receive.py
 [*] Waiting for messages. To exit press CTRL+C 
```

然后它永远不会打印“Hello World！”。

它出什么问题了？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2012-05-25T18:41:53.580

首先启用管理控制台

```
sudo rabbitmq-plugins enable rabbitmq_management 
```

然后打开浏览器

```
http://localhost:55672 
```

登录方式：访客/访客

在我的情况下，它是内存（低于 2 Giga）和消息“此节点的磁盘可用空间警报已响起。它将阻止传入的网络流量，直到可用空间量超过限制。”

编辑文件`/etc/rabbitmq/rabbitmq.config`如下：

```
 [
    {rabbit, [{disk_free_limit, {mem_relative, 0.1}}]}
 ] 
```

现在重启rabbit服务：

```
service rabbitmq-server stop
service rabbitmq-server start 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2017-07-20T15:10:01.477

你必须开始`Rabbit MQ Serever`。在 windows 文件名中：`RabbitMQ Service - start`. 您可以使用以下代码：

```
import java.io.IOException;
import java.util.ResourceBundle;
import java.util.concurrent.TimeoutException;
import com.rabbitmq.client.Channel;
import com.rabbitmq.client.Connection;
import com.rabbitmq.client.ConnectionFactory;

public class NewTaskController implements Runnable {
    private final String message;

     private static final String EXCHANGE_NAME = "test";

     private static final String ROUTING_KEY = "test";

     public NewTaskController(final String message) {
         this.message = message;
     }

     @Override
     public void run() {

        //getting data from application.properties
         //for the rabbit_mq configuration

         ResourceBundle mRB = ResourceBundle.getBundle("application");

         System.out.println("*****NewTaskController************"+mRB.getString("rabbitmq.port"));
        String rabbitmq_username = mRB.getString("rabbitmq.username");
        String rabbitmq_password = mRB.getString("rabbitmq.password");
                String rabbitmq_hostname = mRB.getString("rabbitmq.hostname");
                        int rabbitmq_port = Integer.parseInt(mRB.getString("rabbitmq.port"));
     ConnectionFactory factory = new ConnectionFactory();
     factory.setUsername(rabbitmq_username);
     factory.setPassword(rabbitmq_password);
     factory.setHost(rabbitmq_hostname);
     factory.setPort(rabbitmq_port);
     Connection conn;
     try {
     conn = factory.newConnection();
     Channel channel = conn.createChannel();

     channel.exchangeDeclare(EXCHANGE_NAME, "direct", true);
     String queueName = channel.queueDeclare().getQueue();
     System.out.println(queueName);
     channel.queueBind(queueName, EXCHANGE_NAME, ROUTING_KEY);
     System.out.println("Producing message: " + message + " in thread: " + Thread.currentThread().getName());
     channel.basicPublish(EXCHANGE_NAME, ROUTING_KEY, null, message.getBytes());

     try {
        channel.close();
    } catch (TimeoutException e) {
        e.printStackTrace();
    }
     conn.close();
     } catch (IOException | TimeoutException e) {
     e.printStackTrace();
     }
}
}

application.properties file

rabbitmq.username=guest
rabbitmq.password=guest
rabbitmq.hostname=localhost
rabbitmq.port=5672 
```

# jquery - 使用 Jquery 从多个选择框中添加、删除值

> ID：10588073
> 
> 赞同：0
> 
> 时间：2012-05-14T17:18:35.813
> 
> 标签：jquery, html

我有一个多个选择框，其中包含对应国家/地区的城市，使用户可以选择多个城市。在填表过程中，用户必须先选择国家，然后在多选框中相应地更改城市。下面是我的国家选择框和城市多个 SB。

```
<select name="country" id="country" onchange="ajax_change(this.value)">
    <option value="">--Select Country--</option>
    <? echo $countryList;?>
</select> 
```

这是多个选择框

```
<select multiple="multiple" name="cities[]" id="cities[]" style="height:150px; width:300px;">
    <option value="">-- Select City --</option> 
</select> 
```

这是成功返回城市列表的 ajax 代码。

```
<script type="text/javascript">
    function ajax_change(val)
    {

        jQuery.post(
            '<?=WEB_ROOT?>index.php?rt=admin/airport/ajax',
            {
                val:val,
                type:'get_cities'
            },
            function(data){
                $('#cities[]').val(data);
            }
        );
    }
</script> 
```

但`$('#cities[]').val(data)`不工作。你能请任何人帮助我吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-05-14T17:36:21.703

您想使用[$.each](http://api.jquery.com/jQuery.each/)函数循环返回数据（我假设它是 JSON），然后将新创建的项目附加到您的列表中。

试试这个：

**HTML**

```
<select id='select' />​ 
```

**Javascript**

```
var data = {
    'name1':'value1',
    'name2':'value2'
};

$.each(data, function(key, value) {
    $('#select').append($("<option/>").text(key).val(value));
}); 
```

jsfiddle中的上述内容：[jsfiddle](http://jsfiddle.net/Z4v6V/)

您还想从 ID 中删除方括号。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-05-14T17:21:49.710

只需使用一个类并从 id 标签中删除 []

```
<select multiple="multiple" name="cities[]" class="cities" style="height:150px; width:300px;">
    <option value="">-- Select City --</option>
</select> 
```

和

```
<script type="text/javascript">
    function ajax_change(val)
    {
       //alert(val);

       jQuery.post('<?=WEB_ROOT?>index.php?rt=admin/airport/ajax',
           {val:val,type:'get_cities'},
           function(data){
               $('.cities').val(data);
           }
       );
    }
</script> 
```

# dns - 如何查询 .local bonjour DNS 条目？

> ID：10588074
> 
> 赞同：9
> 
> 时间：2012-05-14T17:18:42.803
> 
> 标签：dns, bonjour, mdns

`dig`通过直接询问您的名称服务器来查询 DNS-SD 条目的内容非常简单；但对于多播 DNS，我不知道去哪里找。

编辑：我的动机是能够查看示例 DNS 条目，以便我可以更好地为我的 OS X 机器配置静态 bonjour 条目。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2012-05-14T17:20:47.153

啊哈，秘密是多播地址/端口。

例如，查询可用的 AFP 服务器：

```
dig @224.0.0.251 -p 5353 -t ptr _afpovertcp._tcp.local 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2012-05-14T19:04:07.963

主要实用程序是`dns-sd`，例如：

```
% dns-sd -B _afpovertcp._tcp
Browsing for _afpovertcp._tcp
Timestamp     A/R Flags if Domain           Service Type              Instance Name
20:02:23.350  Add     2  4 local.           _afpovertcp._tcp.         myhost 
```

# java - 警告：类型安全：从对象到 PK 的未经检查的强制转换

> ID：10588075
> 
> 赞同：0
> 
> 时间：2012-05-14T17:18:46.470
> 
> 标签：java, object, warnings

如何从“ `id = (PK) m.invoke(obj, (Object []) null);`”中删除警告

```
 private PK getId(T obj) {
    PK id = null;
    for (Field f : type.getDeclaredFields()) {
        if (f.getAnnotation(Id.class) != null) {
            String name = f.getName();
            String method = "get" + name.substring(0, 1).toUpperCase() + name.substring(1);
            try {
                Method m = type.getDeclaredMethod(method, (Class<?>) null);
                id = (PK) m.invoke(obj, (Object []) null);
            } catch (Exception e) {
                e.printStackTrace();
            }
        }
    }
    return id;
} 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-05-14T17:30:59.797

我假设 PK 是您班级中的通用类型

```
class MyClass<PK> { 
```

由于 Java 类型擦除，PK 类型在运行时不可用。但是如果你在你的构造函数中接受一个`Class<PK>`实例，那么你可以通过调用来解决这个问题`klass.cast(...)`

```
class MyClass<PK> {
    private final Class<PK> keyClass;
    MyClass(Class<PK> keyClass) {
         this.keyClass = keyClass;
    }

    PK getKey() {
        return keyClass.cast(...);
    }
} 
```

如果由于某种原因您无法获得对 PK 的实际运行时类型的引用，那么您几乎没有办法，只能抑制警告。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-05-14T17:30:20.207

`Method#invoke`返回 an`Object`所以你只有两种方法可以摆脱警告：

*   声明`id`为`Object`
*   `@SuppressWarnings("unchecked")`在方法声明之前添加。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2012-05-14T17:29:46.210

添加

```
@SuppressWarnings("unchecked") 
```

方法声明之前

# python - 如何在数组列表中设置十进制值（在 Python 中）？

> ID：10588079
> 
> 赞同：1
> 
> 时间：2012-05-14T17:19:14.623
> 
> 标签：python, arrays, numpy

首先，我有一个这样的输出数组（在 4x1 的矩阵中）：

```
 array([[ -2.22044605e-15],
   [  2.82842712e+01],
   [ -2.22044605e-15],
   [  2.82842712e+01]]) 
```

和那个输出，我从 4x3 和 3x1 的矩阵乘法的返回值接收，如下所示：

```
def inverse_kinematic(self,Degree):
    # [W] = (1/r)[R][V] 
    self.R = array ( [[-1, 1, self.X1+self.Y1], [1, 1, self.X2-self.Y2],
                       [-1, 1, self.X3+self.Y3], [1, 1, self.X4-self.Y4]]) 

    self.V = array ( [[self.Vt*math.cos(math.radians(Degree))],
                       [self.Vt*math.sin(math.radians(Degree))],[ self.Wv]])
    self.W = []
    self.W = (1/self.r)*dot(self.R,self.V)
    return self.W 
```

我真的很想拥有和输出像上面那样的数组，但是是两位十进制值，像这样：

```
 array([[ 0.00],
   [  28.28],
   [ 0.00],
   [  28.28]]) 
```

我已经厌倦了使用类似 "%.2f" % (number) 的方法，但仍然没有成功。我想知道有没有最好的方法在数组列表中设置十进制值？

此致，

格伦

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-05-14T17:53:38.203

您的返回值的顺序非常不同：

2.82842712e+01 约 2.8

-2.22044605e-15 = 0.0000000000000022 大约为 0

您的数值评估很可能在分析上为零，而较小的值只是计算错误。

矩阵运算很容易在 numpy 中完成，你可以使用这样的东西：

```
 >>> import numpy as np
    >>> a = np.array([[11,12,13],[21,22,23],[31,32,33],[41,42,43]])
    >>> b = np.array([[1],[2],[3]])
    >>> x = np.dot(a,b)
    >>> x
    array([[ 74],
   [134],
   [194],
   [254]]) 
```

在这种情况下，您可能会满意

```
 >>> x = np.array([0.923423,0.12341235,0.213453241])
    >>> x.round(2)
    array([ 0.92,  0.12,  0.21]) 
```

numpy 数组很方便，因为您不必遍历它们的条目：

```
 >>> a = np.array([1,2,3,4,5])
    >>> a
    array([1, 2, 3, 4, 5])
    >>> a+2
    array([3, 4, 5, 6, 7])
    >>> a*10
    array([10, 20, 30, 40, 50])
    >>> np.sin(a)
    array([ 0.84147098,  0.90929743,  0.14112001, -0.7568025 , -0.95892427]) 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-05-14T17:36:13.910

这是你要找的吗？印刷：

```
for arr in wheel_lists:
  for element in arr:
    print '%.2f' % element 
```

环境：

```
for arr in wheel_lists:
  for i in xrange(len(arr)):
    arr[i] = float('%.2f' % 3.14) 
```

# android - Android 小部件未更新 - 小部件 ID 不正确

> ID：10588080
> 
> 赞同：11
> 
> 时间：2012-05-14T17:19:30.520
> 
> 标签：android, widget, android-appwidget, appwidgetprovider

我一直在研究一个小部件并取得了一些进展（我希望如此），但仍然无法让它做我想做的事。

我有一个可以正常工作的配置器活动。当它关闭时，我调用 WordWidget 类中的 updateAppWidget 方法，小部件会更新随机数。

由于onClick，我不能做的就是改变随机数。根据日志，我确实输入了 onReceive() 方法，但仅此而已。

在日志中，我正在打印小部件 ID。我注意到，当从配置器活动运行时，它打印 appWidgetId=33，但是当我按下小部件时，它打印 appWidgetId=24。

这是代码：

```
public class WordWidget extends AppWidgetProvider
{

    @Override
    public void onUpdate(Context context, AppWidgetManager appWidgetManager, int[] appWidgetIds)
    {
        //This is run when a new widget is added or when the update period expires.
        Log.v("wotd",  "In onUpdate(), updating " + appWidgetIds.length + " widgets");
        Log.v("wotd",  "   the array is " + appWidgetIds.toString());

        for(int x = 0; x < appWidgetIds.length; x++)
        {
            Integer appWidgetId = appWidgetIds[x];

            //Method that updates the random value
            updateAppWidget(context, appWidgetManager, appWidgetId);
        }
    }

    @Override
    public void onReceive(Context context, Intent intent)
    {
        super.onReceive(context, intent);
        Log.v("wotd", "In onReceive() with intent=" + intent.toString());
        if (intent.getAction().equals("android.appwidget.action.APPWIDGET_UPDATE"))
        {
            Integer mAppWidgetId;
            AppWidgetManager appWidgetManager = AppWidgetManager.getInstance(context);

            Bundle extras = intent.getExtras();
            if(extras != null)
            {
                Log.v("wotd", "In onReceive(), extras is valid");
                mAppWidgetId = extras.getInt(AppWidgetManager.EXTRA_APPWIDGET_ID, AppWidgetManager.INVALID_APPWIDGET_ID);

                //If they gave us an intent without a valid widget Id, just bail.
                if (mAppWidgetId != AppWidgetManager.INVALID_APPWIDGET_ID)
                {
                    Log.v("wotd", "In onReceive(), mAppWidgetId is ok");
                    updateAppWidget(context, appWidgetManager, mAppWidgetId);
                }
            } else
            {
                Log.v("wotd", "In onReceive(), extras is INVALID");
                mAppWidgetId = AppWidgetManager.INVALID_APPWIDGET_ID;
            }
        }

    }

    static void updateAppWidget(Context context, AppWidgetManager appWidgetManager, Integer appWidgetId)
    {
        Log.v("wotd", "In updateAppWidget() with appWidgetId=" + appWidgetId);

        //Setup onClick
        Intent widgetIntent = new Intent(context, WordWidget.class);
        widgetIntent.setAction("android.appwidget.action.APPWIDGET_UPDATE");
        widgetIntent.putExtra(AppWidgetManager.EXTRA_APPWIDGET_ID, appWidgetId);
        PendingIntent widgetPendingIntent = PendingIntent.getBroadcast(context, 0, widgetIntent, 0);

        Integer nextNumb = new Random().nextInt(100);
        Log.v("wotd", "In updateAppWidget(), nextNumb = " + nextNumb.toString());

        RemoteViews remoteView = new RemoteViews(context.getPackageName(), R.layout.widgetlayout);
        remoteView.setTextViewText(R.id.mainText, String.valueOf(nextNumb));
        remoteView.setOnClickPendingIntent(R.id.mainText, widgetPendingIntent);

        // Tell the widget manager
        appWidgetManager.updateAppWidget(appWidgetId, remoteView);
    }
} 
```

这是从我触摸小部件时开始的日志文件（请注意，prefs 活动也有一个日志打印输出，并将小部件 ID 显示为与此不同的数字）：

```
05-14 17:15:47.453: V/wotd(1585): In onReceive() with intent=Intent { act=android.appwidget.action.APPWIDGET_UPDATE flg=0x10000000 cmp=com.rfxlabs.wordofthedaywidget/.WordWidget bnds=[202,177][222,201] (has extras) }
05-14 17:15:47.453: V/wotd(1585): In onReceive(), extras is valid
05-14 17:15:47.463: V/wotd(1585): In onReceive(), mAppWidgetId is ok
05-14 17:15:47.463: V/wotd(1585): In updateAppWidget() with appWidgetId=24 
```

05-14 17:15:47.463: V/wotd(1585): 在 updateAppWidget() 中，nextNumb = 42

如您所见，我实际上是在输入我的 updateAppWidget 方法，但由于某种原因 appWidgetId 不正确。

任何想法为什么会发生这种情况？非常感谢！

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2012-05-22T11:17:57.033

在你的函数`updateAppWidget`中转到这一行：

```
PendingIntent widgetPendingIntent = PendingIntent.getBroadcast(context, 0, widgetIntent, 0); 
```

...并将其更改为：

```
PendingIntent widgetPendingIntent = PendingIntent.getBroadcast(context, appWidgetId, widgetIntent, 0); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-05-23T03:14:12.700

要在触摸时更新主屏幕小部件，您需要在 Manifest 中注册自定义广播接收器并将其添加为带有小部件的操作：

**第 1 步：**将自定义接收器注册为：

```
<intent-filter>
<action android:name="com.imrankhanandroid.HomeWidgetRandomNum.ACTION_WIDGET_RANDOM"/>
</intent-filter> 
```

**第 2 步：**在您的小部件类 AddAction 中布局为：

```
public void onReceive(Context paramContext, Intent paramIntent)
    {
        //Intent
         String str = paramIntent.getAction();
         if (paramIntent.getAction().equals(ACTION_WIDGET_RANDOM)) {
             updateWidgetState(paramContext, str);   
         }
         else
            {
              super.onReceive(paramContext, paramIntent);
            }
    } 
```

**第 3 步：**在您的 updateWidgetState 中向 Intent 添加新操作：

```
rview = new RemoteViews(paramContext.getPackageName(), R.layout.widget_layoutmain);
Intent active = new Intent(paramContext, Randomnuberwidget.class);
active.setAction(ACTION_WIDGET_RANDOM);
PendingIntent actionPendingIntent = PendingIntent.getBroadcast(paramContext, 0, active, 0);
rview.setOnClickPendingIntent(R.id.ImageView_gps, actionPendingIntent); 
```

*最后，您可以从 HERE [HomeWidgetRedomNumber](https://sites.google.com/site/imrankhanandroid/HomeWidgetRendomNumber.rar?attredirects=0&d=1)下载工作 HomeWidget 示例，该示例在每次点击时生成随机数。*

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2014-07-10T09:33:38.843

您需要在 getBroadcast 中设置最后一个标志：PendingIntent.FLAG_UPDATE_CURRENT

# java-me - 在 J2ME 中发送邮件或 SMS

> ID：10588082
> 
> 赞同：3
> 
> 时间：2012-05-14T17:19:51.100
> 
> 标签：java-me

这是我第一次在 J2ME 中发送邮件或 SMS，我进行了搜索，发现我必须制作一个表格来获取电子邮件或 SMS 的信息并使用无线消息传递（WMA JSR 120）等一些 API 来发送它.

我在问是否有另一个选项可以打开一个准备好的手机应用程序，在弹出窗口或类似的东西中发送电子邮件或短信，并保持我的应用程序运行，发送时它会关闭这个应用程序，或者在 J2ME 中找不到?

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-05-15T11:48:58.423

如果您的目标手机是诺基亚，您可以使用[http://www.developer.nokia.com/Resources/Library/Java/developers-guides/invoking-applications/invoking-applications-in-java-me中所述的 MIDlet platformRequest .html](http://www.developer.nokia.com/Resources/Library/Java/developers-guides/invoking-applications/invoking-applications-in-java-me.html)

示例：
打开短信编辑器向指定电话号码发送短信：platformRequest("sms:+19123456789");

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-05-15T00:46:51.837

您正在寻找的是[JSR-211: Content Handler API](http://www.jcp.org/en/jsr/detail?id=211)。不幸的是，我认为即使这样也不能解决你的问题。

JSR211 的基本目的是允许 J2ME 中的应用程序之间进行进程间通信。

然而，在手机上的 MIDlet 之间实现 IPC 系统所需的工作量与重新设计手机上的大多数应用程序以使它们都使用此功能做一些有用的工作所需的工作量之间存在巨大差异IPC 机制，尤其是当手机支持多个开发运行时。

据我所知，没有现有的 J2Me 电话包含支持通过 JSR211 从 MIDLet 发送 SMS 或电子邮件的消息传递应用程序。

公平地说，我想我以前只在 MIDlet 之间使用过 JSR211 或安装 DRM 许可证。

# asp.net-mvc-3 - 如何清除嵌入在 Web 提要项中的客户端缓存图像正在更新

> ID：10588087
> 
> 赞同：0
> 
> 时间：2012-05-14T17:20:07.057
> 
> 标签：asp.net-mvc-3, caching, syndication

我正在发布包含以图片形式嵌入在提要项中的图表的 Web 提要，并使用 MVC 操作返回到客户端轮询网络提要，`/RSS_Img/filename`.

一些图表与提要项目一起更新，我想让客户端在服务器端修改图像后重新加载图像（我可以控制图表何时更新，因为这是由另一个控制器的操作执行的）。

同时，我不想避免在客户端进行缓存，因为这会以显着增加的带宽打击我。

我最好的选择是什么？我考虑了以下几点：

*   显然更改图像名称 - 但这是不可接受的，因为它会破坏可能作为邮件转发的提要项目 - 或者在我保留旧版本的情况下大大增加存储大小
*   映射可能会更新的联合项目是什么，并在检索图像的操作中，`Response.Cache.SetCacheability(HttpCacheability.Server);`仅为这些项目设置*[实际上我认为我应该将可缓存性设置为无，因为我猜缓存`RSS_Img`操作的结果几乎没有优势：它基本上只是加载并返回文件本身。]*。
    这将要求我从 SQL 服务器检索要刷新（或冻结）的图像的 ID（我正在处理大量图表图像），这将给 WebApp 增加相当大的负担。
    此外，我不能总是确定哪些项目可能会被更新，所以这种方法不能满足 100% 的要求。

我正在寻找的解决方案是在更改图像文件时找到一种使缓存无效的简单方法-我可以轻松使用类似的东西`HttpResponse.RemoveOutputCacheItem("/RSS_Img/" + fileName.Value)`：但这似乎只影响服务器缓存。

我没有其他选择，还有其他实用的方法吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-05-14T19:10:49.707

传统的解决方案是使用虚拟参数来引用图像，例如`<img src="chart.gif?cache=448267163"/>`. 每当您更新图表时，使用新值更新指向它的链接。通常最后一次更新的日期被用作参数值。

# google-app-engine - 如何更好地处理来自香港/太平洋时区的 Google App Engine 定期维护？

> ID：10588088
> 
> 赞同：1
> 
> 时间：2012-05-14T17:20:22.020
> 
> 标签：google-app-engine, gwt, timezone, maintenance, high-availability

我来自香港，我现在正计划在 GAE 上构建一个商业应用程序。但是在检查了它的维护计划之后，我担心我需要处理白天的中断，比如香港下午 4 点到 8 点……使用 GAE 就成了一个亮点。

我阅读了以下官方文章，但似乎并没有直接解决让我头痛的问题......我不能简单地在下午几个小时显示“服务关闭”HTML，对吧？

[https://developers.google.com/appengine/docs/java/howto/maintenance](https://developers.google.com/appengine/docs/java/howto/maintenance)

所以，我只是想知道这里是否有人曾经遇到过类似的情况，请与我分享您的经验/想法/指针？任何想法都会有所帮助...

非常感谢，伙计们！

ps 这是邪恶的维护计划... :(

[https://www.google.com/calendar/embed?src=4chlpo92ci2f54c2u21shbjk9o@group.calendar.google.com&ctz=America/Los_Angeles&gsessionid=OK](https://www.google.com/calendar/embed?src=4chlpo92ci2f54c2u21shbjk9o@group.calendar.google.com&ctz=America/Los_Angeles&gsessionid=OK)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-05-14T18:16:54.143

这些维护是针对旧的主/从数据存储，新的高复制数据存储 (HRD) 没有任何下载时间 AFAIR。
如果您构建一个新应用程序，您应该使用 HRD。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-05-14T18:25:18.230

处理计划维护的最简单方法是将应用程序迁移到高复制数据存储 (HRD)。通过执行迁移，您将免除此计划维护。

文档站点提供了[有关](https://developers.google.com/appengine/docs/adminconsole/migration)如何将应用程序迁移到 HRD 的说明。

# ruby-on-rails - 将参数添加到面包屑导轨 gem

> ID：10588095
> 
> 赞同：0
> 
> 时间：2012-05-14T17:20:56.483
> 
> 标签：ruby-on-rails, parameters, breadcrumbs

我正在使用[rails](https://github.com/weppos/breadcrumbs_on_rails) gem 上的面包屑。我想知道如何将参数传递给路径。像这样的东西：

add_breadcrumb "家", :my_path @my_parameter

我怎样才能做到这一点？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-07-13T04:32:34.377

我认为在您的*routes.rb*中设置路径接受参数是最简单的，那么您不必担心传递它

# ios - 如何使 UITextView 在方向更改时调整大小？

> ID：10588097
> 
> 赞同：1
> 
> 时间：2012-05-14T17:21:01.927
> 
> 标签：ios, xcode, ios5, ios-simulator, uitextview

所以我决定做一个iOS应用。我从一个简单的东西开始，它是一个网络浏览器。令人惊讶的是，我发现它很容易掌握，但我现在遇到了一些我无法弄清楚的事情。

我的应用程序在 Landscape 中看起来不错，如下所示：

[景观](http://dl.dropbox.com/u/7923805/apps/StackOverflow/Landscape.png)

但是当我更改设备的方向时，它看起来很乱，因为 UITextField 没有调整大小，如下所示：

[肖像](http://dl.dropbox.com/u/7923805/apps/StackOverflow/Portrait.png)

有谁知道这样做的（菜鸟友好）方式？

谢谢，阿什利。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-05-14T17:24:15.030

看看这里的自动调整大小：

[http://www.techotopia.com/index.php/IOS_4_iPhone_Rotation,_View_Resizing_and_Layout_Handling](http://www.techotopia.com/index.php/IOS_4_iPhone_Rotation,_View_Resizing_and_Layout_Handling)

# asp.net-mvc-3 - Asp.Net MVC3 Webgrid 分页问题

> ID：10588098
> 
> 赞同：1
> 
> 时间：2012-05-14T17:21:02.317
> 
> 标签：asp.net-mvc-3, webgrid

我的网页下方有一个 Asp.Net Mvc3 webgrid 10 段后。当我单击 webgrid 中的页码时，它会将页面拉到顶部，因为它的超链接显示为 #。我不希望页面在单击 webgrid 中的页码时向上移动。

```
@{ 
        var gridUser = new WebGrid(canPage: true, defaultSort: "CreatedOn", rowsPerPage: 5, 
                                ajaxUpdateContainerId: "DivGridUser"); 
        gridUserRoles.Bind(Model.User, rowCount: Model.User.Count(), autoSortAndPage: true); 
        gridUserRoles.Pager(WebGridPagerModes.All); 

        } 
        <div id="DivGridUser" style="display: none"> 
            @gridUserRoles.GetHtml(htmlAttributes: new { id = "DivGridUser" }, 
        columns: gridUser.Columns( 
        gridUserRoles.Column("Name"), 
        gridUserRoles.Column("CreatedOn") 
        ) 
    ) 
```

我正在使用 AjaxUpdateContainerId 使分页 ajaxified。有人可以指导我解决这个问题。.

# java - 一个字符串中有多个方法？

> ID：10588099
> 
> 赞同：0
> 
> 时间：2012-05-14T17:21:12.117
> 
> 标签：java, string, methods, line

我想对一个字符串使用两种方法，有点像这样

`outputLabel.setText(firstname.charAt(0) + toLowerCase());`

如何让它返回某个位置的字符并将字符串转换为小写？

我希望输出是单个字符，转换为小写，并且在一行上。

非常感谢！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2012-05-14T17:22:45.763

使用[`Character.toLowerCase()`](http://docs.oracle.com/javase/6/docs/api/java/lang/Character.html#toLowerCase%28char%29)后跟[`String.valueOf()`](http://docs.oracle.com/javase/6/docs/api/java/lang/String.html#valueOf%28char%29)：

```
outputLabel.setText(String.valueOf(Character.toLowerCase(firstname.charAt(0)))); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-05-14T17:23:18.740

像这样链接它们：

```
outputLabel.setText(firstname.toLowerCase().charAt(0)) 
```

你不能反过来做，因为`.toLowerCase()`它不适用于`charAt()`返回的字符。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-05-14T17:23:17.490

像这样的东西：

`str.toLowerCase().charAt(0)`

这会将整行转换为小写并获取第一个字符。

# javascript - 矩阵行列式计算器的递归函数

> ID：10588100
> 
> 赞同：0
> 
> 时间：2012-05-14T17:21:15.887
> 
> 标签：javascript

我正在玩数组，我尝试创建一个递归函数来计算矩阵 A[i][j] 的行列式，其中 i=j=k。我写的函数如下。似乎我做错了什么，但我不知道是什么。A 数组由用户定义并由另一个函数读取。我尝试在不使用和库或预定义对象的情况下做到这一点。我已经添加了整个代码，以便您做出一个大致的想法：

```
<script>

    var k;

    function readGrad() {       //reads the matrix dimesnions       
        k = parseInt(document.getElementById("grad").value);            
        if (isNaN(k)) {
            alert('Gradul introdus nu este intreg, reintroduceti gradul matricii');
        }
        if (k == 0) {
            alert ('Determinantul trebuie sa fie mai mare ca 1');
        }
        if (k == 1) {
            alert ('Determinantul trebuie sa fie mai mare ca 1');
        }
        return k;
    }       

    function genTable(i,j) {            //generates the table for the user to insert the values
        //var i,j = parseInt(document.getElementById("grad").value);
        var myTable = '<TABLE BORDER="1" BORDERCOLOR="BLACK">\n <TBODY>\n';
        for (i = 0; i < 1; i++) {
            myTable += '  <TR>\n';
            for (j = 0; j < k+1; j++) {
                myTable += '    <TD>'+j+'</TD>\n';
            }
            myTable += '  </TR>\n';
        }
        for (i = 1; i < k+1; i++) {
            myTable += '  <TR>\n';
            for (j = 0; j < 1; j++) {
                myTable += '    <TD>'+i+'</TD>\n';
            }
            for (j = 1; j < k+1; j++) {
            myTable += '    <TD><input class="element" id="A' + i + j + '"value="0"></TD>\n';
            } 
            myTable += '  </TR>\n';
        }
        myTable += ' </TBODY>\n</TABLE>\n';
        document.getElementById('container').innerHTML = myTable;
    }

    function calcDet () { 

        var A = [];     //generates the array
            for (var i = 0; i < k; i++) {
                A[i] = [];
                for (var j = 0; j < k; j++) {                       
                    A[i][j] =  i + ':' + j;             
                }
            }           

        for (var i = 0; i < k; i++) {   //reads the array
            for (var j=0; j<k; j++) {
                var id = "A" + (i + 1) + (j + 1);
                A[i][j] = parseFloat(document.getElementById(id).value);                                        
            }
        }

        var s;
        var det = 0;

        function calcRec (A) { 
            if (A.length == 1) {        //bottom case of the recursive function 
                alert (A)
            }
            if (i == 2) {       
                det =  A[0][0] * A[1][1] - A[1][0] * A [0][1];
                alert (det);
            }

            for (var i=0; i<k; i++) {    //creates smaller matrix- values not in same row, column
                var smaller=new Array(A.length-1);
                for(h=0;h<smaller.length;h++){
                smaller[h]=new Array(smaller.length);
                }
            }

            for(a=1;a<A.length;a++){    
                for(b=0;b<A.length;b++){
                    if(b<i){
                    smaller[a-1][b]=A[a][b];
                    }
                    else if(b>i){
                        smaller[a-1][b-1]=A[a][b];
                    }
                }
            }

            if (i%2==0) {
                s=1;
            }
            else {
                s=-1;
            }  
            det+=s*matrix[0][i]*(calcRec(smaller));     
            return (det);
        }
        }
</script>
<body style="background-color: #777; color: ddd;">
    <div style="margin: 20px;">
        <h1>Program de calculare determinant matrice de orice grad.</h1>
    </div>
    <div>
        Introduceti gradul matricei
        <input id="grad" type="text" value="" style="width: 50px;" onChange="readGrad()">           
        <input style="margin-top: 20px;" type="button" name="Calculate determinant" value="Generati tabel" onClick="genTable()"> 
    </div>
    <form name="Det Matrice">
        <div style="margin-top: 100px; float: left; width: 100%;">
            Introduceti valorile: 
            <table style="text-align: center;">
                <div id="container"></div>
            </table>
            <br>
        </div>
        <div style="float: left; margin-top: 20px;">            
            <input type="button" name="Calculate determinant" value="Calculati determinant" onClick="calcDet()">
        </div>
    </form>

</body> 
```

# java - 在 ubuntu 11.04 中安装 java 5

> ID：10588106
> 
> 赞同：0
> 
> 时间：2012-05-14T17:21:32.803
> 
> 标签：java, eclipse, jakarta-ee, ubuntu-11.04

我试图在 ubuntu 11.04 中安装 java，为此我下载了“jdk-1_5_0_22-linux-i586.bin”我使用了本教程[和](http://flnkr.com/2012/02/18/installing-java-1-5-on-ubuntu-11-10/)本[教程](http://possiblygonewrong.blogspot.in/2010/11/setting-up-tomcat-server-adapter-in.html)

```
# sudo mv jdk-1_5_0_22-linux-i586.bin /usr/lib/jvm
# cd /usr/lib/jvm
# chmod +x jdk-1_5_0_22-linux-i586.bin
# ./jdk-1_5_0_22-linux-i586.bin 
```

当我执行命令时， `# ./jdk-1_5_0_22-linux-i586.bin`我确实收到以下错误消息

```
Do you agree to the above license terms? [yes or no] 
y
Unpacking...
./jdk-1_5_0_22-linux-i586.bin: 394: cannot create install.sfx.3350: Permission denied
Checksumming...
/usr/bin/sum: install.sfx.3350: No such file or directory
expr: syntax error
expr: syntax error
chmod: cannot access `install.sfx.3350': No such file or directory
Extracting...
./jdk-1_5_0_22-linux-i586.bin: 424: ./install.sfx.3350: not found
mkdir: cannot create directory `jdk1.5.0_22/jre': No such file or directory
mkdir: cannot create directory `jdk1.5.0_22/jre/.systemPrefs': No such file or directory
touch: cannot touch `jdk1.5.0_22/jre/.systemPrefs/.system.lock': No such file or directory
chmod: cannot access `jdk1.5.0_22/jre/.systemPrefs/.system.lock': No such file or directory
touch: cannot touch `jdk1.5.0_22/jre/.systemPrefs/.systemRootModFile': No such file or directory
chmod: cannot access `jdk1.5.0_22/jre/.systemPrefs/.systemRootModFile': No such file or directory
cd: 751: can't cd to jdk1.5.0_22 
```

我是 ubuntu 环境的新手，正在尝试使用 Java EE 设置 Eclipse。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-05-14T17:23:44.250

您应该这样做`sudo ./jdk-1_5_0_22-linux-i586.bin`，因为您在该目录中没有写权限。然而，`root`确实如此。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-05-14T17:31:04.750

以超级用户权限执行您的 bin `sudo`。此外，如果你有最新版本的 JDK（我想你有），你可以将源代码的合规级别设置为 1.5

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-05-14T17:41:21.153

你需要它的权限。您有两个选择，或者切换到超级用户模式，使用：

`#su`

虽然不鼓励这种方法。第二种也是最常见和最合适的方法是使用`sudo`命令，如：

`#sudo ./jdk-1_5_0_22-linux-i586.bin`

# objective-c - UiScrollview 滚动分页

> ID：10588107
> 
> 赞同：2
> 
> 时间：2012-05-14T17:21:35.730
> 
> 标签：objective-c, ios5

我已经实现了一个 UIScrollView。它包含 60 宽度大小的小图像。滚动运动总是向前或向后步进 3 张图片，而不是我需要的一张一张。请参阅解释这一点的附图。

![在此处输入图像描述](../Images/7cc5f55408c9230610eafa715a1e9468.png)

ScrollView 已启用分页。这是代码：

```
for (int i = 0; i < numberOfViews; i++) {

        UIImage *myImage = [UIImage imageNamed:[fotosJugadores objectAtIndex:i]];
        CGFloat yOrigin = i * myImage.size.width + 120;
        UIImageView *awesomeView = [[UIImageView alloc] initWithFrame:CGRectMake(yOrigin, 0, myImage.size.width, myImage.size.height)];
        awesomeView.image = myImage;
        awesomeView.tag = i;
        [self.jugadorSlide addSubview:awesomeView];
        awesomeView=nil;
    }

    [jugadorSlide setBackgroundColor:[UIColor blackColor]];
    jugadorSlide.contentSize = CGSizeMake(65 * numberOfViews+240,78);
    jugadorSlide.layer.cornerRadius = 11;
    jugadorSlide.layer.masksToBounds = YES;
    [jugadorSlide setContentOffset:CGPointMake(((65 * numberOfViews)/2), 0)];
    [self scrollViewDidEndDecelerating:jugadorSlide]; 
```

非常感谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-05-14T19:58:00.120

好吧，我想我知道你的意思了。这些链接对您有帮助吗

[UIScrollView - 启用分页后，我可以“更改”页面宽度吗？](https://stackoverflow.com/questions/2256081/uiscrollview-with-paging-enabled-can-i-change-the-page-width)

[不同页面宽度的分页 UIScrollView](https://stackoverflow.com/questions/5089510/paging-uiscrollview-with-different-page-widths)

[UIScrollView + pagingEnabled，滚动半页？](http://forums.macrumors.com/showthread.php?t=634462)

希望这可以帮助

# android - 尝试膨胀自定义视图时出现 stackoverflow 错误

> ID：10588109
> 
> 赞同：3
> 
> 时间：2012-05-14T17:21:40.363
> 
> 标签：android, stack-overflow, android-custom-view, android-inflate

我有 custom_layout.xml：

```
<?xml version="1.0" encoding="utf-8"?>

<com.example.MyCustomLayout 
    xmlns:android="http://schemas.android.com/apk/res/android"
    android:layout_width="match_parent"
    android:layout_height="wrap_content"
    android:orientation="vertical" >

<!-- different views -->

</com.example.MyCustomLayout> 
```

及其类：

```
public class MyCustomLayout extends LinearLayout {

public MyCustomLayout(Context context, AttributeSet attrs) {
    super(context, attrs);

    LayoutInflater.from(context).inflate(R.layout.custom_layout, this, true);
    setUpViews();
    }
//different methods
} 
```

和活动，其中包括此布局：

```
public class MyActivity extends Activity {

@Override
protected void onCreate(Bundle savedInstanceState) {
    super.onCreate(savedInstanceState);
    setContentView(R.layout.my_activity);

    setUpViews();
} 
```

和 my_activity.xml：

```
<?xml version="1.0" encoding="utf-8"?>
<ScrollView xmlns:android="http://schemas.android.com/apk/res/android"
android:layout_width="match_parent"
android:layout_height="match_parent" >

<LinearLayout
    android:layout_width="match_parent"
    android:layout_height="wrap_content"
    android:orientation="vertical" >

    <com.example.MyCustomLayout
        android:id="@+id/section1"
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:orientation="vertical" />
    <com.example.MyCustomLayout
        android:id="@+id/section2"
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:orientation="vertical" />

</LinearLayout> 
```

因此，当我从以下位置删除评论块`LayoutInflater.from(context).inflate(R.layout.custom_layout, this, true);`并以图形模式转到 my_activity.xml 时，我遇到了问题。Eclipse 思考然后崩溃。看起来它试图多次夸大我的自定义视图，但我不明白为什么。当我重新启动 Eclipse 时，我在错误日志中收到此错误：`java.lang.StackOverflowError`

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2012-05-14T17:57:36.023

在您`custom_layout.xml`替换`<com.example.MyCustomLayout`为另一个布局（例如 a `LinearLayout`）：

```
<?xml version="1.0" encoding="utf-8"?>
<LinearLayout
    xmlns:android="http://schemas.android.com/apk/res/android"
    android:layout_width="match_parent"
    android:layout_height="wrap_content"
    android:orientation="vertical" >

<!-- different views -->

</LinearLayout> 
```

甚至更好地使用[`merge`](http://developer.android.com/resources/articles/layout-tricks-merge.html)标签（并`orientation`在`MyCustomLayout`类中设置）。现在`Android`加载时`my_activity.xml`它会找到您的自定义`View`并将其实例化。当您的自定义视图将被实例化时，将在构造函数中`Android`膨胀`custom_layout`xml 文件。`MyCustomLayout`当这种情况发生时，它将再次`<com.example.MyCustomLayout ...`（从刚刚膨胀的`custom_layout.xml`）找到导致`MyCustomLayout`再次实例化。这是一个递归调用，它最终会抛出`StackOverflowError`.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-05-14T17:28:44.743

这条线的存在

```
LayoutInflater.from(context).inflate(R.layout.custom_layout, this, true); 
```

在自定义布局对象的构造函数中导致自依赖调用的无限递归，溢出堆栈。

你没有理由这样做。

也许你最好的选择是挖掘一个其他人工作的自定义布局类的例子。

# html - 如何在样式类中添加 src？

> ID：10588116
> 
> 赞同：-2
> 
> 时间：2012-05-14T17:21:50.020
> 
> 标签：html, css, image

```
<div><img class="imgClose"></div> 
```

我尝试像这样添加，但它没有显示图像：

```
<style type="text/css">
.imgClose
{
   float: right;
   margin-top: -15px;
   background: 16px 16px no-repeat url(_assets/img/close.png);
}
</style> 
```

如果我添加 HTML，那么它可以工作，但我想改为放入`src`样式类。

```
<div><img class="imgClose" src="_assets/img/close.png"></div> 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-05-14T17:23:25.073

您不能`src`从元素样式中添加元素属性（如 ）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-05-14T17:25:30.163

.imgClose 需要一个高度和一个宽度才能正确显示...

当您将 src 放入图像中时，div 会自动获取它们，这就是您的问题:)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-05-14T19:00:31.983

这无论如何都会失败验证。您的图像标签将需要 src 属性。您可以添加一个空的 div 并将您的图像应用为背景图像，或者您需要一个图像标签，您可以添加一个透明的占位符图像并使用 css 定义它的尺寸和背景图像。最好将尺寸添加到图像中，这样即使元素尚未下载，浏览器也可以呈现页面。

但真正的问题是你为什么要这样做？

如果您的图像纯粹是装饰性的，您可以将其添加为背景图像。如果它在 Html 中很重要，请将其保留为具有 src 属性的图像标记。

我假设您想创建一个关闭按钮小部件。添加带有文本内容的链接元素并使用 css 和文本替换设置样式可能会更好。

```
<a href="whatever" class="close-widgety-thingy">close the widget thing</a> 
```

在CSS中

```
.close-widgety-thingy {
   text-indent: -12345em;
   width: 16px;
   height: 16px;
   background: transparent url(path/to/close/image.png) no-repeat center center;
} 
```

是你想要达到的吗？

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2012-05-14T17:28:26.083

您必须指定`width`、`height`和`display:inline-block|block;`才能使背景`img`正常工作，而无需提供`src`属性。但是，我鼓励使用不同的元素，因为该`img`元素专门用于使用该`src`属性。

```
<style type="text/css">
.imgClose {
 display:block;
 width:16px;
 height:16px;
 float: right;
 margin-top: -15px;
 background: 16px 16px no-repeat url(_assets/img/close.png);
}
</style> 
```

# c# - 实例化后访问列表的索引

> ID：10588117
> 
> 赞同：0
> 
> 时间：2012-05-14T17:21:51.253
> 
> 标签：c#, list, exception

我使用以下方法创建了一个列表：

```
List<int> foo = new List<int>(); 
```

创建此索引后，我需要能够将值插入到任何索引中。如果我有

```
foo[325] = 55; 
```

an`ArgumentOutOfRangeException`抛出以下详细信息：

```
Index must be within the bounds of the List.
Parameter name: index 
```

我必须做什么才能纠正这个问题？我可以用虚拟值填充列表，然后在填充列表后访问索引，但这似乎是一个混乱的解决方案。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-05-14T17:24:40.943

也许 List<> 不是用于存储的正确数据类型。

如果您使用 a`Dictionary<int, int>()`您可以只维护您希望的索引：

```
Dictionary<int, int> foo = new Dictionary<int, int>();

foo.Add(idx, val); 
```

并检索：

```
var Value = foo[idx]; 
```

如果您打算实际使用每个索引，最好这样做：

```
List<int> foo = Enumerable.Range(0, MaxNumber).ToList(); 
```

预先填写清单。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-05-14T17:25:18.260

如果您确实需要随机访问，System.Collections.Generic.Dictionary 类可能会更好

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-05-14T17:24:56.900

您可能想要使用数组而不是列表。但是你必须指定一个大小。

```
var foo = new int[500];
foo[325] = 55; 
```

# wpf - wpf RadGridView / RadContextMenu 绑定问题

> ID：10588118
> 
> 赞同：2
> 
> 时间：2012-05-14T17:21:53.067
> 
> 标签：wpf, data-binding, mvvm, telerik, radgridview

我有一个显示不同 RadContextMenu 的 RadGridView，具体取决于单击的单元格。

我有一个 RadMenuItems 列表作为 Observable 集合。当我在 Grid 位于（父容器）中的 StackPanel 上设置以下代码时，它会正确显示所有项目。

当我将它移到项目模板中的堆栈面板中时，它将不起作用。查找 ViewModel 的相同代码适用于前一项中的按钮命令，但不适用于上下文菜单。

我已附加到 View 中的 Opening 事件，并且 ItemsSource 为空......

有什么想法吗？

此按钮命令正常工作：

```
 <telerik:GridViewColumn Header="View" Width="75">
                    <telerik:GridViewColumn.CellTemplate>
                        <DataTemplate>
                            <Button Content="View" FontSize="16" Margin="2" Command="{Binding RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type ViewTrips:ViewTripsView}}, Path=DataContext.ViewTripCommand}" CommandParameter="{Binding Path=TripID}"></Button>
                        </DataTemplate>
                    </telerik:GridViewColumn.CellTemplate>
                </telerik:GridViewColumn> 
```

上下文菜单不会被填充：

```
 <telerik:GridViewColumn Name="TripStatus" Header="Status" Width="75" SortMemberPath="TripStatus.Name">
                    <telerik:GridViewColumn.CellTemplate>
                        <DataTemplate>
                            <StackPanel>                                   
                                <telerik:RadContextMenu.ContextMenu>
                                    <telerik:RadContextMenu ItemsSource="{Binding RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type ViewTrips:ViewTripsView}}, Path=DataContext.StatusItems}">

                                    </telerik:RadContextMenu>

                                </telerik:RadContextMenu.ContextMenu>
                                <TextBlock TextWrapping="Wrap" Text="{Binding Path=TripStatus.Name}"></TextBlock>
                                <TextBlock TextWrapping="Wrap" Text="{Binding Path=SalesOrder.PaymentStatusText}"></TextBlock>
                            </StackPanel>
                        </DataTemplate>
                    </telerik:GridViewColumn.CellTemplate>
                </telerik:GridViewColumn> 
```

StatusItems 的声明

```
 private ObservableCollection<RadMenuItem> _StatusItems;

    public ObservableCollection<RadMenuItem> StatusItems
    {
        get
        {
            return _StatusItems;
        }
        set
        {
            _StatusItems = value;
            RaisePropertyChanged("StatusItems");
        }
    } 
```

以下代码在网格项单元格之外有效：

```
<StackPanel>                                   
  <telerik:RadContextMenu.ContextMenu>
    <telerik:RadContextMenu ItemsSource="{Binding  Path=StatusItems}">                                           
    </telerik:RadContextMenu>                                        
  </telerik:RadContextMenu.ContextMenu>
  ... code for RadGridview....
</StackPanel> 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2012-05-15T13:01:28.300

在没有得到任何回复后，我联系了 Telerik Support，他们解决了这个问题。他们表示在绑定中使用 FindAncestor 时存在一些问题，这也是常规上下文菜单中的问题。他们的解决方案是为 ViewModel 使用静态资源，然后将其分配为静态资源。

我使用来自 MVVM 灯的 ViewModelLocator，所以我的视图绑定如下：`DataContext="{Binding Path=ViewTripsViewModelBinding, Source={StaticResource Locator}}"`

我将 CollectionViewSource 添加到资源中，并将其绑定到我的状态项。然后我将上下文菜单绑定到静态资源。

```
 <Common:WindowBase.Resources>
        <CollectionViewSource x:Key="StatusItems" Source="{Binding Path=StatusItems}"></CollectionViewSource>
    </Common:WindowBase.Resources> 
```

还有我的上下文菜单：

```
<telerik:RadContextMenu ItemsSource="{Binding Source={StaticResource StatusItems}}" /> 
```

# asp.net - VB.Net 检查复选框列表项是否被选中/未选中

> ID：10588121
> 
> 赞同：1
> 
> 时间：2012-05-14T17:22:02.800
> 
> 标签：asp.net, vb.net, checkboxlist

我有一个复选框列表，其中填充了页面加载时数据库中的条目。当一个项目被选中和一个项目未被选中时，我需要更新我的数据库中的一个条目。现在我正在做以下事情：

```
<asp:CheckBoxList id="check1" AutoPostBack="True" TextAlign="Right" OnSelectedIndexChanged="Check" runat="server">

</asp:CheckBoxList> 
```

和功能：

```
Sub Check(ByVal sender As Object, ByVal e As EventArgs)
    Dim sql As String
    If check1.SelectedItem.Selected = True Then
        sql = "UPDATE Customer SET unauthorized = 'True' WHERE ID = @ID"
        db.execUpdateQuery(sql, New SqlClient.SqlParameter("@ID", check1.SelectedItem.Value))
    Else
        sql = "UPDATE Customer SET unauthorized = 'False' WHERE ID = @ID"
        db.execUpdateQuery(sql, New SqlClient.SqlParameter("@ID", check1.SelectedItem.Value))
    End If
End Sub 
```

但是当我取消选中一个按钮时，else case 永远不会运行。此外，如果我选中了 4 个按钮并且我取消选中所有四个按钮，当我取消选中第四个按钮时，我会在该行收到错误：

```
If check1.SelectedItem.Selected = True Then 
```

错误是：“对象引用未设置为对象的实例。”

有没有更好的方法来检查列表项是选中还是未选中？

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2014-10-29T11:49:22.883

你也可以试试这个

```
 For i As Integer = 0 To CheckedListBox1.Items.Count - 1
        If CheckedListBox1.GetItemChecked(i) = True Then
            sql = "UPDATE Customer SET unauthorized = 'True' WHERE ID = @ID"
            db.execUpdateQuery(sql, New SqlClient.SqlParameter("@ID", check1.SelectedItem.Value))
        Else
            sql = "UPDATE Customer SET unauthorized = 'False' WHERE ID = @ID"
            db.execUpdateQuery(sql, New SqlClient.SqlParameter("@ID", check1.SelectedItem.Value))  
        End If
    Next 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-05-14T17:30:29.103

```
for (int i = 0; i < check1.Items.Count; i++)
  if (check1.GetItemChecked(i))
    // Do selected stuff
  else
    // Do unselected stuff 
```

如果检查处于不确定状态，这仍将返回 true。您可能想要更换

```
if (check1.GetItemChecked(i)) 
```

和

```
if (check1.GetItemCheckState(i) == CheckState.Checked) 
```

如果您只想包括实际检查的项目。

# sencha-touch-2 - sencha 应用程序构建生产不起作用

> ID：10588125
> 
> 赞同：2
> 
> 时间：2012-05-14T17:22:24.123
> 
> 标签：sencha-touch-2

我使用 sencha create app 命令创建了我的应用程序。它在我的机器上以及我们的网络服务器上本地工作。我正在尝试为生产构建应用程序，但以下命令对我不起作用：

> sencha app build 生产

我没有收到任何错误消息或输出。目录中没有任何变化。

以下命令：

> sencha build -p appname.jsb3 -v -d 。

生成 jsb3 文件。但是，我的 index.html 永远不会更新以加载新文件。根据我在网上找到的信息，我的 index.html 应该更新为指向新文件。

我想我在某个地方遗漏了一些东西，但我在网上找不到任何适合我的教程。谁能指出我正确的方向？如果这有助于确定我做错了什么，我的 index.html 会粘贴在下面。

```
<!DOCTYPE HTML>
<html manifest="" lang="en-US">
<head>
    <meta charset="UTF-8">
    <title>EGL Mobile</title>
    <style type="text/css">
        /**
         * Example of an initial loading indicator.
         * It is recommended to keep this as minimal as possible to provide instant feedback
         * while other resources are still being loaded for the first time
         */
        html, body {
            height: 100%;
        }

        #appLoadingIndicator {
            position: absolute;
            top: 50%;
            left: 50%;
            margin-top: -10px;
            margin-left: -50px;
            width: 100px;
            height: 20px;
        }

        #appLoadingIndicator > * {
            background-color: #FFFFFF;
            float: left;
            height: 20px;
            margin-left: 11px;
            width: 20px;
            -webkit-animation-name: appLoadingIndicator;
            -webkit-border-radius: 13px;
            -webkit-animation-duration: 0.8s;
            -webkit-animation-iteration-count: infinite;
            -webkit-animation-direction: linear;
            opacity: 0.3
        }

        #appLoadingIndicator > :nth-child(1) {
            -webkit-animation-delay: 0.18s;
        }

        #appLoadingIndicator > :nth-child(2) {
            -webkit-animation-delay: 0.42s;
        }

        #appLoadingIndicator > :nth-child(3) {
            -webkit-animation-delay: 0.54s;
        }

        @-webkit-keyframes appLoadingIndicator{
            0% {
                opacity: 0.3
            }

            50% {
                opacity: 1;
                background-color:#1985D0
            }

            100% {
                opacity:0.3
            }
        }
    </style>
    <script id="microloader" type="text/javascript" src="sdk/microloader/development.js"></script>
</head>
<body>
    <div id="appLoadingIndicator">
        <div></div>
        <div></div>
        <div></div>
    </div>
</body>
</html> 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-08-10T21:21:26.820

尝试这个：

// 首先打开 cmd 并运行：

```
cd path/to/application 
```

// 然后确保 index.html 存在于你的 path/to/application:

```
<!DOCTYPE html>
<html>
<head>
 <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
 <title>title</title>
 <!-- update this to your css file -->
 <link rel="stylesheet" href="resources/css/app.css" type="text/css">
 <!-- you can get this file from sencha original files -->
 <script type="text/javascript" src="sdk/sencha-touch-debug.js"></script>
 <script type="text/javascript" src="app.js"></script> 
</head>
<body></body>
</html> 
```

// 确保文件正在加载您的应用程序，然后运行命令：

```
sencha create jsb -a index.html -p app.jsb3 
```

// 也执行第二个命令。注意最后的点应该添加到命令中：

```
sencha build -p app.jsb3 -d . 
```

// 现在我们的应用程序已经构建好了：

创建新的 html 文件“built.html”并使用以下代码：

```
<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>title</title>
    <link rel="stylesheet" href="resources/css/app.css" type="text/css">
    <script type="text/javascript" src="sdk/sencha-touch.js"></script>
    <script type="text/javascript" src="all-classes.js"></script>
    <script type="text/javascript" src="app.js"></script>
</head>
<body></body>
</html> 
```

// 现在打开built.html

# c# - 如何判断 HTTPWebResponse 何时返回最终页面？

> ID：10588130
> 
> 赞同：0
> 
> 时间：2012-05-14T17:22:50.797
> 
> 标签：c#, .net

我正在使用 HTTPWebResponse 从在最终屏幕之前具有中间屏幕的站点获取网页。

有没有一种方法可以告诉我何时呈现第二个（最终）页面，以便我可以对它进行屏幕抓取？（数据在公共领域）

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-06-05T14:59:59.373

大卫梅在上面给出了正确答案。我将此标记为已回答，给予他充分的信任。谢谢你，大卫。

# javascript - 如何使用 Sinon.js 存根事件发射器

> ID：10588137
> 
> 赞同：15
> 
> 时间：2012-05-14T17:23:26.873
> 
> 标签：javascript, mocking, stub, sinon

我正在尝试存根以下内容：

```
on('complete', function(data){ }); 
```

如果第一个参数是“完成”，我只想调用回调。

我正在测试的功能还包含：

```
on('error', function(data){ }); 
```

所以我不能只做会触发完整和错误回调的 yield 原因。

如果我不使用 sinon，我会通过编写以下内容来伪造它。

```
var on = function(event, callback){
  if (event === 'complete'){
    callback('foobar');
  };
}; 
```

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2015-07-24T14:57:10.913

您可以通过将 a 与 a 组合来缩小 a`yield`发生的情况`withArgs`...

```
on.withArgs('complete').yields(valueToPassToCompleteCallback);
on.withArgs('error').yields(valueToPassToErrorCallback); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-05-15T20:19:47.020

也许您可以使用[spyCall](http://sinonjs.org/docs/#spycall)：

```
var spy = sinon.spy(window, 'on');
on('error', function(data){ });
on('complete', function(data){ });
for(var i=0; i < spy.callCount; i++){
    var call = spy.getCall(i);
    if(call.args[0] === 'complete') call.args[1]('foobar');
} 
```

# ios - 无论如何可以可靠地计算 UITextView 的高度吗？

> ID：10588138
> 
> 赞同：5
> 
> 时间：2012-05-14T17:23:38.067
> 
> 标签：ios, height, uitextview

我试过`sizeWithFont:constrainedToSize:lineBreakMode`and `sizeToFit`，两者都没有返回正确的结果。

该属性`contentSize`应该返回正确的高度，但在文本视图呈现到屏幕之前它不起作用，并且我需要在文本视图可见之前计算高度（它确定`UITableViewCell`.

有没有人找到任何其他方法，自定义文本视图等，可以正确计算 UITextView 的高度？

**编辑** 我应该澄清我想要基于文本视图内容的理想高度。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2014-01-23T12:42:34.547

IOS 7 不再支持该属性`contentSize`。尝试使用这个

```
CGFloat textViewContentHeight = textView.contentSize.height;
textViewContentHeight = ceilf([textView sizeThatFits:textView.frame.size].height + 9); 
```

这解决了我的问题。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2013-10-21T11:45:11.753

当涉及 sizeToFit: 和 layouSubview 的技术不起作用时，我使用这个：

```
- (CGFloat)measureHeightOfUITextView:(UITextView *)textView
{
    if ([textView respondsToSelector:@selector(snapshotViewAfterScreenUpdates:)])
    {
        // This is the code for iOS 7\. contentSize no longer returns the correct value, so
        // we have to calculate it.
        //
        // This is partly borrowed from HPGrowingTextView, but I've replaced the
        // magic fudge factors with the calculated values (having worked out where
        // they came from)

        CGRect frame = textView.bounds;

        // Take account of the padding added around the text.

        UIEdgeInsets textContainerInsets = textView.textContainerInset;
        UIEdgeInsets contentInsets = textView.contentInset;

        CGFloat leftRightPadding = textContainerInsets.left + textContainerInsets.right + textView.textContainer.lineFragmentPadding * 2 + contentInsets.left + contentInsets.right;
        CGFloat topBottomPadding = textContainerInsets.top + textContainerInsets.bottom + contentInsets.top + contentInsets.bottom;

        frame.size.width -= leftRightPadding;
        frame.size.height -= topBottomPadding;

        NSString *textToMeasure = textView.text;
        if ([textToMeasure hasSuffix:@"\n"])
        {
            textToMeasure = [NSString stringWithFormat:@"%@-", textView.text];
        }

        // NSString class method: boundingRectWithSize:options:attributes:context is
        // available only on ios7.0 sdk.

        NSMutableParagraphStyle *paragraphStyle = [[NSMutableParagraphStyle alloc] init];
        [paragraphStyle setLineBreakMode:NSLineBreakByWordWrapping];

        NSDictionary *attributes = @{ NSFontAttributeName: textView.font, NSParagraphStyleAttributeName : paragraphStyle };

        CGRect size = [textToMeasure boundingRectWithSize:CGSizeMake(CGRectGetWidth(frame), MAXFLOAT)
                                                  options:NSStringDrawingUsesLineFragmentOrigin
                                               attributes:attributes
                                                  context:nil];

        CGFloat measuredHeight = ceilf(CGRectGetHeight(size) + topBottomPadding);
        return measuredHeight;
    }
    else
    {
        return textView.contentSize.height;
    }
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-05-14T18:09:55.897

这是对我有用的代码：

```
+ (CGFloat)heightOfComment:(NSString *)comment {
    UILabel *label = PrototypeCell.commentLabel;

    // NOTE: The height of the comment should always be at least the height of
    //       one line of text.
    if (comment.length == 0)
        comment = @" ";

    return [comment sizeWithFont:label.font
               constrainedToSize:label.frame.size
                   lineBreakMode:label.lineBreakMode].height;    
} 
```

让它发挥作用的关键是`if (comment.length == 0) comment = @" ";`.

* * *

## 回答 #4

> 赞同：-2
> 
> 时间：2013-10-21T11:18:26.043

在 UITextview 布局之前，高度不可用。在 iOS 6 上，addSubview（例如，给 UIScrollView）赋予它布局值（即 frame.size.height）。在 iOS 7 上，这并不总是发生 - 对于 sizeToFit，同样如此。

我找到了一些解决方案，我更喜欢执行 sizeToFit 的解决方案，然后是 layoutIfNeeded，然后再阅读（现已更改）高度：

```
...
[scrollView1 addSubview: myTextView];

    [myTextView sizeToFit]; //added
    [myTextView layoutIfNeeded]; //added

CGRect frame = myTextView.frame;
... 
```

[这是来自此处](https://stackoverflow.com/questions/19049532/how-do-i-size-a-uitextview-to-its-content-on-ios-7)接受的答案，请参阅注释。我在这里解释的尝试是在这种情况下，这对于添加到 UITableViewCells 而不是 UIScrollViews 的 UITextviews 应该无效（出于某种原因）。

# php - 检查 URL 是否为 Google

> ID：10588156
> 
> 赞同：0
> 
> 时间：2012-05-14T17:24:32.037
> 
> 标签：php

我想检查一个网址，看看它是否是谷歌网址。

我有这个功能

```
function isValidURL($url)
{
    return preg_match('|^http(s)?://google.com|i', $url);
} 
```

如果我尝试

```
if ( isValidURL('http://google.com/') ){
    echo 'yes its google url';
} 
```

它工作正常。但如果我尝试

```
if ( isValidURL('http://www.google.com/') ){
    echo 'yes its google url';
} 
```

（和`www`）我得到一个错误！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2012-05-14T17:25:56.230

当然，因为你的正则表达式还没有准备好处理`www.`

尝试

```
function isValidURL($url)
{
    return preg_match('|^http(s)?://(www\.)?google\.com|i', $url);
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-05-14T17:36:13.027

如果您要支持 googles 子域，请尝试：

```
preg_match('/^https?:\/\/(.+\.)*google\.com(\/.*)?$/is', $url) 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-07-03T13:01:45.910

我喜欢使用 PHP 的 parse_url 函数来分析 url。它返回一个包含 URL 各部分的数组。这样您就可以确保您检查的是正确的部分，并且它不会被 https 或查询字符串抛出。

```
function isValidUrl($url, $domain_to_check){
       $url = parse_url($url);
       if (strstr($url['host'], $domain_to_search))
            return TRUE;
       return FALSE;
    } 
```

用法：

`isValidUrl("http://www.google.com/q=google.com", "google.com");`

# android - startActivity 隐藏当前布局和对话框

> ID：10588163
> 
> 赞同：0
> 
> 时间：2012-05-14T17:25:11.097
> 
> 标签：android, dialog, while-loop, loading

我有一个 startActivity，它显示一个警报对话框，直到我在异步任务中完成对 xml 的下载和解析。然后我去下一个startActivity。问题是即使我等待 startActivity 的线程，屏幕上也没有显示任何内容。如果我注释掉命令 startActivity 我会看到一切。为什么是这样？有人可以帮忙吗？

```
 public void onCreate(Bundle savedInstanceState) {
    super.onCreate(savedInstanceState);
    setContentView(R.layout.main);        

    AlertDialog ad = new AlertDialog.Builder(this).create();  
    ad.setCancelable(false);   
    ad.setMessage("Loading Events");         
    ad.show();

    if (!isNetworkAvailable()){ 
        ad = new AlertDialog.Builder(this).create();  
        ad.setCancelable(false); // This blocks the 'BACK' button  
        ad.setMessage("Not Connected Exiting");  
        ad.setButton("OK", new DialogInterface.OnClickListener() {  
              public void onClick(DialogInterface dialog, int which) {  
                     dialog.dismiss();    
                     finish();
                 }  
        });  
        ad.show();
       }
       downloadXML();     
       events=parseXML();

       ((CATApplication)this.getApplication()).setEvents(events);
       try{
       Thread.sleep(10000);
       Intent intent = new Intent(this,EventsListActivity.class);
       startActivity(intent);                  
       }catch(Exception e){}
}
//check for network connection
private boolean isNetworkAvailable(){
    ConnectivityManager connectivityManager=(ConnectivityManager) getSystemService(Context.CONNECTIVITY_SERVICE);
    NetworkInfo activeNetworkInfo=connectivityManager.getActiveNetworkInfo();
    return activeNetworkInfo.isConnectedOrConnecting();
}

public void onPause(){
    File xmlFile = new File("deletefileonexit");
    xmlFile.delete();
    finish();
    super.onPause();
}

private void downloadXML() {
    String url = "locationofxmlonweb";
    new DownloadFileAsync().execute(url);
}

public Events parseXML(){
    Events newEvents=new Events();
    try{
        while(!(new File("locationofxml").exists())){}
        InputStream in=new FileInputStream("locationofxml");
        newEvents=new ParseEventsXML().parse(in);
    }
    catch (Exception e){} 
    return newEvents;
} 
```

}

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-05-14T17:36:40.517

为什么要使用活动？如果您只想在下载数据时显示忙碌指示符，您应该使用[ProgressDialog](http://developer.android.com/reference/android/app/ProgressDialog.html)。您可以使用 dialog.show() 轻松显示对话框，并通过调用 dialog.dismiss() 关闭对话框。如果要设置自定义消息，可以调用 dialog.setMessage("My Message")。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-05-14T18:20:57.673

你不能让 UI 线程休眠并且仍然期望显示一些东西。

删除这一行：

```
 Thread.sleep(10000); 
```

你想要的是一个处理程序并发布一个等待 10000 的可运行文件，然后开始你的下一个活动。

```
 public void onCreate(Bundle savedInstanceState){

     .....

     new Handler().postDelayed(t, 10000);
    }

    Thread t = new Thread(){
        public void run() {
            Intent intent = new Intent(FirstActivity.this, SecondActivity.class);
            startActivity(intent);
        };
    }; 
```

这就是答案，但它仍然存在根本缺陷，为什么您要猜测一个随机时间然后开始下一个活动。您应该考虑将 DialogFragment 与 ASyncTask 一起使用，当它返回时，您可以开始您的第二个活动。

# regex - 使用正则表达式删除文本

> ID：10588168
> 
> 赞同：0
> 
> 时间：2012-05-14T17:25:27.387
> 
> 标签：regex

我有一个 xml 文件，我尝试使用 linq to xml 检索一些信息。xml文件中有一个标签是这样的

```
<description>
<img src='http://www.sport.gr//files/Image/2012/May/14/802.jpg'>Τραγική ήταν η παρουσία της Αστον Βίλα στη φετινή Πρέμιερ Λιγκ και.....
</description> 
```

我想要做的是使用正则表达式检索 src 属性内的链接。知道如何实现这一目标吗？我无法编辑 xml 的格式，因为它来自网络请求。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-05-14T21:20:31.690

使用此模式

```
<img.*\s+src=('(?<src>.*?)'|"(?<src>.*?)") 
```

如果匹配，则提取“src”组。

# facebook - 如何保存用户的id？

> ID：10588177
> 
> 赞同：-3
> 
> 时间：2012-05-14T17:25:49.207
> 
> 标签：facebook, facebook-graph-api, facebook-javascript-sdk

我创建了一个简单的博客站点，人们可以在其中使用 Facebook Connect 和 JS SDK 登录。

如果我通过 javascript 获取用户 ID，那么如何安全地将其保存在我的 mysql 数据库中？我必须使用 ajax 吗？谢谢

* * *

## 回答 #1

> 赞同：-1
> 
> 时间：2012-05-14T19:48:38.877

有一个组件包可以为您管理它。有一个例子给你：

[http://www.facebook.com/pages/Helper-Component-Community/222933037808340?sk=app_412923142052609](http://www.facebook.com/pages/Helper-Component-Community/222933037808340?sk=app_412923142052609)

使用此软件包，您可以让用户登录并保存他们的 access_token + user_ids 以访问他们的数据或发布到他们的个人资料。这个包很容易将 JS SDK 的功能包装成一个易于理解和易于扩展的良好工作流。

# c# - 从函数返回任何类型的对象

> ID：10588182
> 
> 赞同：0
> 
> 时间：2012-05-14T17:25:59.303
> 
> 标签：c#, oop, inheritance

有没有办法从函数中返回一个对象。棘手的部分是对象可以是任何类型。我想要一个函数来处理从会话返回的对象。所以我想退回的对象可能是前一分钟的产品，但我可能想在下一分钟退回客户。是否有可能或者我必须做一个函数来返回每种类型。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2012-05-14T17:28:20.313

1.  返回`object`它是最高级别。
2.  使方法通用。
3.  返回`dynamic`（感谢@AustinSalonen）

* * *

```
public T Foo<T>(T obj)
{
    var variable = GetTFromFooElse();
    return variable; 
} 
```

* * *

```
public dynamic Foo()
{
    var variable = GetSomethingFromFooElse();
    return variable;
} 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2012-05-14T17:27:42.957

是的，您可以返回***Type object***。不过，您需要将结果投射到调用者中才能使用任何远程有用的东西。

```
static object CarFactory (){
    return new Car();
}

static void Main(){

    Car car = (Car)CarFactory();

    /* do stuff with car */
    car.Crash();
} 
```

* * *

*注意*使用泛型是一个标准，因为它提供了所需的抽象级别和类型安全......

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-05-14T17:30:17.633

根据您的使用情况，也许您可​​以使用[泛型](http://msdn.microsoft.com/en-us/library/512aeb7t%28v=vs.100%29.aspx)而不是使用对象？

有一个`Session<T>`有方法的类

```
T GetResult() 
```

你可以像这样制作实例：

```
var x = new Session<Product>();
var y = new Session<Customer>(); 
```

通过这种方式，您可以获得一些不错的类型安全性。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-05-14T17:31:42.427

在这种情况下，您最好通过某种服务/Api 来包装您的会话类。

例如：

```
public static class SessionAccess
{
    public static Something SomethingSession
    {
        get
        {
            return Session["Something"] as Something;
        }

        set
        {
            Session["Something"] = value;
        }
    }
} 
```

拥有一致的会话访问机制很重要，以避免意外跨过相同的会话密钥，并确保它始终是相同的底层数据类型。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-05-14T17:27:55.733

如果你的方法返回一个对象，你可以返回任何你想要的对象。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-05-14T17:28:53.987

您的方法可以返回一个**object**，但您必须在调用它时转换为您想要的对象。

# android - 没有网站的 Android 中的 Google AdSense

> ID：10588190
> 
> 赞同：1
> 
> 时间：2012-05-14T17:26:29.007
> 
> 标签：android, adsense

我即将在 Google Play 上上传一个应用程序，我想在其中添加 Google Ads，但要应用程序，您必须输入一个网站，而我没有。是否可以仅仅因为您想要 Adsense 而以其他方式注册而不制作博客或其他东西？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2012-05-14T17:28:55.187

您可以为您的应用创建一个 Facebook 页面并使用该 URL。无论如何，您将来可能想要一个用于营销目的。

没有办法绕过提供某种网站地址 - 您至少需要某种形式的网站（无论是博客、Facebook 页面还是您自己的域）才能注册。

# iphone - 创建 NSManagedObjects 的子类是否正常？

> ID：10588192
> 
> 赞同：-1
> 
> 时间：2012-05-14T17:26:33.750
> 
> 标签：iphone, objective-c, ios

正如标题所述：创建子类是否正常`NSManagedObjects`？当你有 eg 时`Item`，你会使用`NSManagedObject`with key/value 还是有一个`Item`类？

如果您使用子类，您将如何将`Item`实例发送到常见的核心数据“DAO”类？您不能使用初始化方法`init`，并且由于您没有 DAO 之外的上下文，您将如何解决它？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-05-14T17:32:01.887

实际上，继承 NSManagedObject 是很常见的。然后在模型编辑器中将该类设置为实体的类。然后，您可以定义任何使用这些属性而不是 KVC 的属性。请参阅[本教程](http://www.raywenderlich.com/934/core-data-on-ios-5-tutorial-getting-started)，尤其是自动生成模型文件部分。

# ruby - 使用 Ruby 和 Nokogiri 解析大型 XML 文件

> ID：10588194
> 
> 赞同：9
> 
> 时间：2012-05-14T17:26:37.883
> 
> 标签：ruby, xml, nokogiri

我有一个大型 XML 文件（大约 10K 行），我需要定期解析，格式如下：

```
<summarysection>
    <totalcount>10000</totalcount>
</summarysection>
<items>
     <item>
         <cat>Category</cat>
         <name>Name 1</name>
         <value>Val 1</value>
     </item>
     ...... 10,000 more times
</items> 
```

我想做的是使用 nokogiri 解析每个单独的节点来计算一个类别中的项目数量。然后，我想从 total_count 中减去该数字，得到一个显示为“Count of Interest_Category: n, Count of All Else: z”的输出。

这是我现在的代码：

```
#!/usr/bin/ruby

require 'rubygems'
require 'nokogiri'
require 'open-uri'

icount = 0 
xmlfeed = Nokogiri::XML(open("/path/to/file/all.xml"))
all_items = xmlfeed.xpath("//items")

  all_items.each do |adv|
            if (adv.children.filter("cat").first.child.inner_text.include? "partofcatname")
                icount = icount + 1
            end
  end

othercount = xmlfeed.xpath("//totalcount").inner_text.to_i - icount 

puts icount
puts othercount 
```

这似乎有效，但速度很慢！我说 10,000 件物品的时间超过 10 分钟。有一个更好的方法吗？我是否以一种不太理想的方式做某事？

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2012-05-15T02:48:53.727

这是一个将 SAX 解析器计数与基于 DOM 的计数进行比较的示例，`<item>`对 7 个类别之一计数 500,000 秒。首先，输出：

> 创建 XML 文件：1.7s
> 通过 SAX 计数：12.9s
> 创建 DOM：1.6s
> 通过 DOM 计数：2.5s

两种技术都会产生相同的哈希，计算每个类别的数量：

```
{"Cats"=>71423, "Llamas"=>71290, "Pigs"=>71730, "Sheep"=>71491, "Dogs"=>71331, "Cows"=>71536, "Hogs"=>71199} 
```

SAX 版本需要 12.9 秒来计算和分类，而 DOM 版本只需要 1.6 秒来创建 DOM 元素，并且需要 2.5 秒来查找和分类所有`<cat>`值。DOM 版本的速度大约是 3 倍！

……但这还不是全部。我们还必须查看 RAM 使用情况。

*   对于 500,000 个项目，SAX (12.9s) 在 238MB 的 RAM 处达到峰值；DOM (4.1s) 在 1.0GB 时达到峰值。
*   对于 1,000,000 个项目，SAX（25.5 秒）峰值为 243MB 的 RAM；DOM (8.1s) 在 2.0GB 时达到峰值。
*   对于 2,000,000 个项目，SAX (55.1s) 在 250MB RAM 处达到峰值；DOM ( **???** ) 峰值为 3.2GB。

我的机器上有足够的内存来处理 1,000,000 个项目，但在 2,000,000 个项目时，我的 RAM 用完了，不得不开始使用虚拟内存。即使使用 SSD 和快速机器，我也让 DOM 代码运行了将近十分钟，然后才最终杀死它。

您报告的时间很长很可能是因为您的 RAM 用完并且作为虚拟内存的一部分连续访问磁盘。如果您可以将 DOM 放入内存，请使用它，因为它是 FAST。但是，如果你不能，你真的必须使用 SAX 版本。

这是测试代码：

```
require 'nokogiri'

CATEGORIES = %w[ Cats Dogs Hogs Cows Sheep Pigs Llamas ]
ITEM_COUNT = 500_000

def test!
  create_xml
  sleep 2; GC.start # Time to read memory before cleaning the slate
  test_sax
  sleep 2; GC.start # Time to read memory before cleaning the slate
  test_dom
end

def time(label)
  t1 = Time.now
  yield.tap{ puts "%s: %.1fs" % [ label, Time.now-t1 ] }
end

def test_sax
  item_counts = time("Count via SAX") do
    counter = CategoryCounter.new
    # Use parse_file so we can stream data from disk instead of flooding RAM
    Nokogiri::HTML::SAX::Parser.new(counter).parse_file('tmp.xml')
    counter.category_counts
  end
  # p item_counts
end

def test_dom
  doc = time("Create DOM"){ File.open('tmp.xml','r'){ |f| Nokogiri.XML(f) } }
  counts = time("Count via DOM") do
    counts = Hash.new(0)
    doc.xpath('//cat').each do |cat|
      counts[cat.children[0].content] += 1
    end
    counts
  end
  # p counts
end

class CategoryCounter < Nokogiri::XML::SAX::Document
  attr_reader :category_counts
  def initialize
    @category_counts = Hash.new(0)
  end
  def start_element(name,att=nil)
    @count = name=='cat'
  end
  def characters(str)
    if @count
      @category_counts[str] += 1
      @count = false
    end
  end
end

def create_xml
  time("Create XML file") do
    File.open('tmp.xml','w') do |f|
      f << "<root>
      <summarysection><totalcount>10000</totalcount></summarysection>
      <items>
      #{
        ITEM_COUNT.times.map{ |i|
          "<item>
            <cat>#{CATEGORIES.sample}</cat>
            <name>Name #{i}</name>
            <name>Value #{i}</name>
          </item>"
        }.join("\n")
      }
      </items>
      </root>"
    end
  end
end

test! if __FILE__ == $0 
```

* * *

## DOM 计数是如何工作的？

如果我们去掉一些测试结构，基于 DOM 的计数器看起来像这样：

```
# Open the file on disk and pass it to Nokogiri so that it can stream read;
# Better than  doc = Nokogiri.XML(IO.read('tmp.xml'))
# which requires us to load a huge string into memory just to parse it
doc = File.open('tmp.xml','r'){ |f| Nokogiri.XML(f) }

# Create a hash with default '0' values for any 'missing' keys
counts = Hash.new(0) 

# Find every `<cat>` element in the document (assumes one per <item>)
doc.xpath('//cat').each do |cat|
  # Get the child text node's content and use it as the key to the hash
  counts[cat.children[0].content] += 1
end 
```

## SAX 计数如何工作？

首先，让我们关注这段代码：

```
class CategoryCounter < Nokogiri::XML::SAX::Document
  attr_reader :category_counts
  def initialize
    @category_counts = Hash.new(0)
  end
  def start_element(name,att=nil)
    @count = name=='cat'
  end
  def characters(str)
    if @count
      @category_counts[str] += 1
      @count = false
    end
  end
end 
```

当我们创建这个类的一个新实例时，我们会得到一个对象，该对象的 Hash 对于所有值默认为 0，并且有几个可以在其上调用的方法。SAX 解析器将在文档中运行时调用这些方法。

*   每次 SAX 解析器看到一个新元素时，它都会调用`start_element`这个类的方法。发生这种情况时，我们根据该元素是否命名为“猫”设置一个标志（以便我们稍后可以找到它的名称）。

*   每次 SAX 解析器抓取一段文本时，它都会调用`characters`我们对象的方法。当这种情况发生时，我们检查我们看到的最后一个元素是否是一个类别（即如果`@count`被设置为`true`）；如果是这样，我们使用此文本节点的值作为类别名称并将计数器加一。

要将我们的自定义对象与 Nokogiri 的 SAX 解析器一起使用，我们这样做：

```
# Create a new instance, with its empty hash
counter = CategoryCounter.new

# Create a new parser that will call methods on our object, and then
# use `parse_file` so that it streams data from disk instead of flooding RAM
Nokogiri::HTML::SAX::Parser.new(counter).parse_file('tmp.xml')

# Once that's done, we can get the hash of category counts back from our object
counts = counter.category_counts
p counts["Pigs"] 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2012-05-14T19:10:01.470

对于这么大的文件，我建议使用 SAX 解析器而不是 DOM 解析器。Nokogiri 内置了一个不错的 SAX 解析器：http: [//nokogiri.org/Nokogiri/XML/SAX.html](http://nokogiri.org/Nokogiri/XML/SAX.html)

SAX 处理大文件的方式非常适合大文件，因为它不会构建巨大的 DOM 树，在您的情况下这有点过分了；您可以在事件触发时构建自己的结构（例如，用于计算节点）。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2012-05-14T19:20:10.017

您可以通过将代码更改为以下内容来显着减少执行时间。只需将“99”更改为您要检查的任何类别。：

```
require 'rubygems'
require 'nokogiri'
require 'open-uri'

icount = 0 
xmlfeed = Nokogiri::XML(open("test.xml"))
items = xmlfeed.xpath("//item")
items.each do |item|
  text = item.children.children.first.text  
  if ( text =~ /99/ )
    icount += 1
  end
end

othercount = xmlfeed.xpath("//totalcount").inner_text.to_i - icount 

puts icount
puts othercount 
```

这在我的机器上花了大约三秒钟。我认为您犯的一个关键错误是您选择了“项目”迭代而不是创建“项目”节点的集合。这使您的迭代代码变得笨拙且缓慢。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-05-29T02:01:44.397

您可能想尝试一下 - [https://github.com/amolpujari/reading-huge-xml](https://github.com/amolpujari/reading-huge-xml)

```
HugeXML.read xml, elements_lookup do |element|
  # => element{ :name, :value, :attributes}
end 
```

我也尝试过使用[ox](https://gist.github.com/amolpujari/5966431)。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-08-03T13:23:09.950

查看 Greg Weber 的 Paul Dix 萨克斯机 gem 版本：http: [//blog.gregweber.info/posts/2011-06-03-high-performance-rb-part1](http://blog.gregweber.info/posts/2011-06-03-high-performance-rb-part1)

[用 SaxMachine 解析大文件似乎是将整个文件加载到内存中](https://stackoverflow.com/questions/9199859/parsing-large-file-with-saxmachine-seems-to-be-loading-the-whole-file-into-memor)

sax-machine 使代码更简单；Greg 的变体使其成为流媒体。

# arrays - CodeIgniter：控制器中的全局变量

> ID：10588195
> 
> 赞同：25
> 
> 时间：2012-05-14T17:26:40.523
> 
> 标签：arrays, codeigniter, controller, global-variables

我是 CodeIgniter 的新手，当我继续进行时，我遇到了在程序编码中很容易解决的问题

当前的问题是：我有这个控制器

```
class Basic extends Controller {

    function index(){
        $data['title'] = 'Page Title';
        $data['robots'] = 'noindex,nofollow';
        $data['css'] = $this->config->item('css');
        $data['my_data'] = 'Some chunk of text';
        $this->load->view('basic_view', $data);
    }

    function form(){
        $data['title'] = 'Page Title';
        $data['robots'] = 'noindex,nofollow';
        $data['css'] = $this->config->item('css');
        $data['my_other_data'] = 'Another chunk of text';
        $this->load->view('form_view', $data);
    }
} 
```

如您所见，一些数组项一遍又一遍地重复：

```
$data['title'] = 'Page Title';
$data['robots'] = 'noindex,nofollow';
$data['css'] = $this->config->item('css'); 
```

有没有办法让它们在控制器中“全局”，这样我就不必为每个函数键入它们？类似的东西（但这给了我错误）：

```
class Basic extends Controller {

    // "global" items in the $data array
    $data['title'] = 'Page Title';
    $data['robots'] = 'noindex,nofollow';
    $data['css'] = $this->config->item('css');

    function index(){
        $data['my_data'] = 'Some chunk of text';
        $this->load->view('basic_view', $data);
    }

    function form(){
        $data['my_other_data'] = 'Another chunk of text';
        $this->load->view('form_view', $data);
    }

} 
```

提前感谢！

* * *

## 回答 #1

> 赞同：41
> 
> 时间：2012-05-14T17:32:11.910

您可以做的是制作可以从控制器中的任何方法访问的“类变量”。在构造函数中，您设置这些值。

```
class Basic extends Controller {
    // "global" items
    var $data;

    function __construct(){
        parent::__construct(); // needed when adding a constructor to a controller
        $this->data = array(
            'title' => 'Page Title',
            'robots' => 'noindex,nofollow',
            'css' => $this->config->item('css')
        );
        // $this->data can be accessed from anywhere in the controller.
    }    

    function index(){
        $data = $this->data;
        $data['my_data'] = 'Some chunk of text';
        $this->load->view('basic_view', $data);
    }

    function form(){
        $data = $this->data;
        $data['my_other_data'] = 'Another chunk of text';
        $this->load->view('form_view', $data);
    }

} 
```

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2012-05-14T17:31:16.007

您可以设置一个名为 data 的类属性，然后将其默认值设置到构造函数中，这是在`Basic`创建新实例时运行的第一件事。`$this`然后你可以用关键字引用它

```
class Basic extends Controller
{
   var $data = array();

   public function __construct()
   {
       parent::__construct();
       // load config file if not autoloaded
       $this->data['title'] = 'Page Title';
       $this->data['robots'] = 'noindex,nofollow';
       $this->data['css'] = $this->config->item('css');
   }

   function index()
   {
       $this->data['my_data'] = 'Some chunk of text';
       $this->load->view('basic_view', $this->data);
   }

   function form()
   {
       $this->data['my_data'] = 'Another chunk of text';
       $this->load->view('form_view', $this->data);
   }
} 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2013-02-11T13:16:34.273

嘿，谢谢，这是我的片段，它是一个全局变量，包含一个视图

```
/* Location: ./application/core/MY_Controller  */

class MY_Controller extends CI_Controller {

    function __construct()
    {
        parent::__construct();
        $this->data = array(
            'sidebar' => $this->load->view('sidebar', '' , TRUE),
        );
    }

}

/* Location: ./application/controllers/start.php */
class Start extends MY_Controller {

    function __construct()
    {       
        parent::__construct();
    }

    public function index()
    {
        $data = $this->data;

        $this->load->view('header');
        $this->load->view('start', $data);
        $this->load->view('footer');
    }
} 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2016-11-15T10:29:23.243

虽然过了这么久。它可以帮助其他你可以使用 $this->load->vars($data); 在核心 MY_controller 中使 $data 数组在所有视图中可用。

```
/* Location: ./application/core/MY_Controller  */

class MY_Controller extends CI_Controller {

function __construct()
{
    parent::__construct();
    $data['title'] = 'Page Title';
    $data['robots'] = 'noindex,nofollow';
    $data['css'] = $this->config->item('css');
    $this->load->vars($data);
}

}

 /* Location: ./application/controllers/start.php */
class Start extends MY_Controller {

function __construct()
{       
    parent::__construct();
}

public function index()
{
    $data['myvar'] = "mystring";

    $this->load->view('header');
    $this->load->view('start', $data);
    $this->load->view('footer');
}
 } 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2016-05-16T17:42:12.453

为什么不使用助手？

文件：

```
/application/helpers/meta_helper.php 
```

内容：

```
<?php 
function meta_data() {
return array("title" => null, "robots" => "noindex, nofollow" );
} 
```

在您的控制器中：

```
class Basic extends Controller {

    function __construct(){
        parent::__construct();
        $this->load->helper('meta');
    }    

    function index(){
        $data['meta'] = meta_data(); //associate the array on it's own key;

        //if you want to assign specific value
        $data['meta']['title'] = 'My Specific Page Title';

        //all other values will be assigned from the helper automatically

        $this->load->view('basic_view', $data);
    } 
```

在您的视图模板中：

```
 <title><?php $meta['title']; ?></title> 
```

将输出：

```
<title>My Specific Page Title</title> 
```

希望这是有道理的:-)！

# memory-management - vmalloc() 是否仅在 32 位 x86 上从 ZONE_HIGHMEM 获取内存？

> ID：10588203
> 
> 赞同：3
> 
> 时间：2012-05-14T17:27:21.343
> 
> 标签：memory-management, linux-kernel, vmalloc

在 32 位 x86 平台上，如果 vmalloc() 可以从 ZONE_NORMAL 或 ZONE_HIGHMEM 分配内存，是否意味着即使我放大 ZONE_HIGHMEM，vmalloc() 可以使用的实际总范围不变？我做了一个放大ZONE_HIGHMEM的测试，vmalloc()的一次分配可以比以前大很多。那么这是否意味着 vmalloc() 实际上仅从 ZONE_HIGHMEM 分配内存？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2012-05-14T21:06:01.500

`vmalloc`喜欢`ZONE_HIGHMEM`，如果它存在，但可以回退到`ZONE_NORMAL`.

但是，在具有 1GB 或更大容量的机器（即任何现代机器）中，`vmalloc`受限于虚拟内存（`vmalloc`区域），而不是物理内存。
在这种情况下，该`vmalloc`区域为 128MB（除非按 放大`vmalloc_reserve`），而`ZONE_HIGHMEM`1GB 以上的所有内存为 128MB - 通常要大得多。

你扩大的实际上是`vmalloc`虚拟内存区域，扩大它可以让你`vmalloc`更多。这间接放大`ZONE_HIGHMEM`了，但这不是很重要。

# c - 如何使用空格作为此代码的分隔符

> ID：10588205
> 
> 赞同：0
> 
> 时间：2012-05-14T17:27:28.570
> 
> 标签：c

我使用以下内容将我的字符串拆分为可用信息

```
sscanf(last, "%*[^:]:%*[^:]:%*[^:]:%127[^:]:", field_x); 
```

这将获取由冒号分隔的字符串的第四个字段，但现在我需要使用它来拆分由空格分隔的字符串，但我不知道该怎么做，因为用“”代替冒号会不起作用，用 \t 替换它也不起作用，如果有人能为此指出我正确的方向，我将非常感激（我也看到了 strtok 的示例，但感觉这种类型的字符串拆分器更容易在这种情况下控制）谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-05-14T17:39:37.350

与你所相信的相反，

```
sscanf(last, "%*[^ ] %*[^ ] %*[^ ] %127[^ ] ", field_x); 
```

确实[做你想做的](http://ideone.com/34bB0)

# ruby-on-rails - windows7 上的 ruby

> ID：10588206
> 
> 赞同：1
> 
> 时间：2012-05-14T17:27:35.820
> 
> 标签：ruby-on-rails, ruby, eruby

我试图搜索是否可以在我的 windows7 机器上安装 eruby，但找不到任何东西。我可以找到如何在 apache 上安装它。但我想把它安装在我的win7机器上。

我希望我可以通过将它嵌入 HTML 来使用它，就像我们在 HTML 中嵌入 vbscript 并打开 html 页面一样。我在正确的道路上吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-05-14T19:21:24.493

听起来您并不完全了解 eRuby 的工作原理，所以让我澄清一下：

当您使用 Web 浏览器在计算机上打开 HTML 文件时，Web 浏览器会从磁盘读取文件的字节，将其解释为 HTML 文档，并相应地显示它。Web 浏览器可以理解 HTML（以及 JavaScript 和 CSS）。

诸如 ERB/eRuby/Erubis 之类的模板语言使用[Ruby](http://www.ruby-lang.org)编程语言来运行嵌入在网页中的任意代码，并将该代码的结果替换为其生成的文本。最终文本被发送到网络浏览器；浏览器永远不会看到 Ruby 代码，而只会看到 HTML（以及 JavaScript 和 CSS）。

为此，Web 浏览器*无法*从磁盘打开文件：
`file:///C:/Users/Phrogz/Desktop/foo.erb`
...而是必须从 Web 服务器（如 Apache）请求文件：
`http://localhost/test/foo`
该服务器在将修改后的内容发送到浏览器之前运行 eRuby 处理器。

您可以使用 Ruby 制作一个非常简单的 Web 服务器，该服务器使用简单的 Web 框架（例如[Sinatra](http://www.sinatrarb.com/) ）来处理内容。但是，这仍然需要您在发出请求之前在计算机上启动 Web 服务器进程。

所以，简而言之：

**不，您不能“在 Windows 7 上安装 eRuby”，从而使用 Web 浏览器从磁盘打开文件会运行 Ruby 代码。**

如果您需要无服务器解决方案，您可能会转而查看[客户端模板语言](http://engineering.linkedin.com/frontend/client-side-templating-throwdown-mustache-handlebars-dustjs-and-more)，例如[dust.js ，它在](http://akdubya.github.com/dustjs/)*Web 浏览器上*以 JavaScript 运行，因此可以通过简单`file:`协议提供服务。

如果你有服务器，我推荐 Sinatra 和（而不是 ERB）使用[Haml](http://haml.info/)作为你的模板语言。

# ios - 将文件存储到 ios 应用程序中

> ID：10588208
> 
> 赞同：0
> 
> 时间：2012-05-14T17:27:46.683
> 
> 标签：ios, file-management

我有一个应用程序将使用手动添加的许多文件）（主要是图像）；它将在 iPad 上运行，所以我会有大图像。我正在考虑使用捆绑包，因为我可以在应用程序的统一位置找到它们，但我不知道这是否是最佳做法。所以我的问题是：

1.  我必须使用捆绑包吗？
2.  我必须使用目录吗？如果是，我该如何构建我的文件？我知道如何以编程方式创建目录，但是当我尝试在 xcode 4.3.2 中添加目录并转到“myapplication.app”目录时，我看到文件不在任何目录中。
3.  如果我使用 Bundles，我可以向其中添加文件吗？

谢谢！

# regex - 从 bash 脚本/函数中调用 perl 替换？

> ID：10588210
> 
> 赞同：0
> 
> 时间：2012-05-14T17:27:53.353
> 
> 标签：regex, perl, bash

在我的`bash_profile`我有这个：

```
 function ht() { perl -i -pe 's|<!-- Mirrored from (.*?) -->\n||' "$a" ;} 
```

我想运行`ht`对馈送的文件进行内联替换以删除带有 HTTrack 签名的 HTML 注释，但是当我运行它时，

```
ht file.html 
```

我得到：

```
Can't open : No such file or directory. 
```

我怀疑这是因为我的 $a 周围的引号干扰了`perl`正在输入的命令。也许它`"`在文件名的字面上加上前缀，或者这种性质的东西，总的来说它变成了错误的文件名。

我尝试删除我周围的双引号，`$a`但这似乎并没有达到我想要的效果。我该如何解决这个问题？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-05-14T17:31:51.310

你必须告诉 perl 你要运行什么文件。改成这样：

```
function ht() { perl -i -pe 's|<!-- Mirrored from (.*?) -->\n||' "$@";} 
```

注意`$@`末尾的“$a”而不是“$a”。正如@jwd 指出的那样，这甚至比`$*`大多数情况下都要好。

# javascript - 调用作为回调函数提供给 raphael 对象构造函数的函数对象的方法

> ID：10588216
> 
> 赞同：0
> 
> 时间：2012-05-14T17:28:00.783
> 
> 标签：javascript, raphael

我的应用程序具有与以下示例类似的结构。我需要界面来动态创建画布。当我创建这些 raphael 对象时，我给它们 canvasActions 作为参数。

如果我使用 createCanvas-method 创建新的 canvas-object，则设置为 canvases-table 的对象是 Raphael 类型，似乎我无法使用分配给它的 canvasActions。所以问题是我不能在 canvasActions-function 返回的接口中使用方法。

为了调用分配给特定 Raphael 对象的方法，我必须进行哪些更改？

```
var myApp = (function() {
    var canvasActions = function() {

        var actionInterface = function() {
            //returns interface object
        }();

        return actionInterface;
    }

    var myAppInterface = function {
        var canvases = [];
        var appInterface = {
            createCanvas: function(contextElementId, width, height) {
                 canvases[canvases.length] = Raphael(contextElementId, width, height, canvasActions);
            },
            getCanvas: function(index) {
                return canvases[index]; 
            }
        }
        return appInterface;
    }();

    return myAppInterface;

}()); 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-05-18T17:26:45.760

`callback`参数就是这样 - 文档准备好后调用的回调方法。它并不意味着被引用和以其他方式使用。

如果您希望向 中添加功能`paper`，请使用`Raphael.fn`来增强对象的内置功能`Raphael`。

**例子：**

```
Raphael.fn.canvasActions = {
    move: function () {
        // ...
    },
    repaint: function () {
        // ...
    }
    // etc.
};

// ...

appInterface.getCanvas(5).canvasActions.repaint(); 
```

**参考：**

*   [`Raphael()`](http://raphaeljs.com/reference.html#Raphael)
*   [`Raphael.fn()`](http://raphaeljs.com/reference.html#Raphael.fn)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-05-14T17:59:53.853

看起来您在引用错误的实例时没有问题，但是一旦将其放入 Raphael 对象中`canvasActions()`，您根本就遇到了调用问题。`canvasActions`那是对的吗？

我对拉斐尔一点也不熟悉。但我想给你一个更好的答案。但是，当我查看文档时，我没有看到 Raphael 构造函数中的任何地方都使用了第四个参数回调。相反，我总是看到这个：

```
var paper = new Raphael(document.getElementById('canvas_container'), 500, 500); 
```

如果您无法使用 Raphael 定义的回调，那么您可以随时添加自己的回调，就像这样（用您的索引数组替换纸）：

```
var paper = new Raphael(document.getElementById('canvas_container'), 500, 500);
paper.performActions = canvasActions; 
```

然后，您应该能够使用：

```
myApp.getCanvas(0).performActions(); 
```

# iphone - restoreCompletedTransactions 在沙盒环境中返回不完整的信息

> ID：10588217
> 
> 赞同：6
> 
> 时间：2012-05-14T17:28:02.253
> 
> 标签：iphone, ios5, in-app-purchase

在开发 iPhone 应用程序时，我在 restoreCompletedTransactions 方面遇到了一些麻烦。在沙盒环境中工作时会出现下面列出的所有问题。该应用程序尚未销售。它是使用在模拟器 5.0 和 5.1 中运行的 Xcode 4.3.2 开发的。我遇到的问题是：

1.  每次应用程序启动并调用 addTransactionObserver 时，都会调用 updatedTransactions 并购买一笔交易。在每次回调时，我的代码都会调用 finishTransaction: 来完成购买，但每次我启动应用程序时都会出现这个问题。对完全相同的购买进行确认。
2.  调用 [[SKPaymentQueue defaultQueue] restoreCompletedTransactions] 将不会列出使用该帐户购买的所有非消耗品。我购买了 2 次非消耗品，每次只退回 1 次。如果我尝试购买列表中缺少的物品，我将收到一条消息，指出该物品已被购买。列表中缺少的项目不是我遇到问题 1 的项目（如上所列）。

在这一点上，我完全被卡住了。我的应用程序依赖 AppStore 来返回有关非消耗品的信息，因为我们没有将这些数据保存在我们自己的服务器中。但是我们需要确保 AppStoreKit 返回包含所有购买项目的列表。不只是一些。

这是我用来测试 restoreCompletedTransactions 的相关代码：

```
- (void) paymentQueue:(SKPaymentQueue *)queue updatedTransactions:(NSArray *)transactions
{
    NSLog(@"updatedTransactions started. -+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ ");
    NSLog(@"Number of transactions received: %d.", [transactions count]);
    int count = 0;
    for (SKPaymentTransaction *trans in transactions)
{
    NSLog(@"Data for transaction %d: ", ++count);
    NSString *transId = [trans transactionIdentifier];
    switch ([trans transactionState])
    {
        case SKPaymentTransactionStatePurchasing:
            NSLog(@"Purchasing transaction: %@", transId);
            if (transId == nil)
            {
                NSLog(@"    Original transaction Id: %@", [[trans originalTransaction] transactionIdentifier]);
            }

            NSLog(@"     No action taken in update");
            break;
        case SKPaymentTransactionStateFailed:
            NSLog(@"Purchase transaction failed for transaction %@", transId);
            NSLog(@"     Error %d (%@)", [[trans error] code], [[trans error] localizedDescription]);
            NSLog(@"     Action Taken:  finish transaction.");
            [queue finishTransaction: trans];
            break;
        case SKPaymentTransactionStatePurchased:
            NSLog(@"Purchased transaction %@", transId);
            NSLog(@"     Purchased qty %d of  product %@", [[trans payment] quantity], [[trans payment] productIdentifier]);
            NSLog(@"     Action: called [queue finishTransaction:] to complete purchase");
            [queue finishTransaction: trans];
            break;
        case SKPaymentTransactionStateRestored:
        {
            SKPayment *paym = [trans payment];
            SKPaymentTransaction *origTrans = [trans originalTransaction];
            SKPayment *origPayment = [[trans originalTransaction] payment];
            NSLog(@"Transaction restored: %@ with original transaction %@", transId, [[trans originalTransaction] transactionIdentifier]);
            NSLog(@"     TRANSACTION DATA:");
            NSLog(@"           purchased %d of product %@ on %@.", 
                  [paym quantity], 
                  [paym productIdentifier], 
                  [[trans transactionDate] description]);

            NSLog(@"     ORIGINAL TRANSACTION DATA:");
            NSLog(@"           purchased %d of product %@ on %@.", 
                  [origPayment quantity], 
                  [origPayment productIdentifier], 
                  [[origTrans transactionDate] description]);

            NSLog(@"     No action taken.");
            break;
        }

        default:
            NSLog(@"Unexpected transaction state:  %d", [trans transactionState]);
            NSLog(@"     No action taken.");
            break;
    }
}

NSLog(@"");
NSLog(@"updatedTransactions ended. -+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ ");
}

- (void) paymentQueueRestoreCompletedTransactionsFinished:(SKPaymentQueue *)queue
{
NSLog(@"Restore completed transactions finished.");
NSLog(@"     Number of transactions in queue:  %d", [[queue transactions] count]);
for (SKPaymentTransaction *trans in [queue transactions])
{
    NSLog(@"          transaction id %@ for product %@.", [trans transactionIdentifier], [[trans payment] productIdentifier]);
    NSLog(@"          original transaction id: %@ for product %@.", [[trans originalTransaction] transactionIdentifier],
          [[[trans originalTransaction] payment]productIdentifier]);
    }
NSLog(@"");
}

// Method to restore transactions when user clicks button in application
- (void) onRestoreCompletedTransactions:(id)sender
{
    [[SKPaymentQueue defaultQueue] restoreCompletedTransactions];
} 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2014-02-07T19:20:20.423

一个 SKProductsRequest 将使您返回一个 SKProduct 实例列表。SKProduct 类在我的阅读中没有购买信息。我认为您确实确实想使用 restoreCompletedTransactions 并取回 SKPaymentTransaction 实例的列表。也就是说，我在使用沙盒帐户时遇到了同样的问题。我得到了一份不完整的交易清单（48 个中的 23 个）。但是，如果我确实选择购买已购买但未恢复的非消耗品，则商店将其视为已购买的物品并将退回该物品的恢复。

有运气解决这个问题吗？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-07-23T17:30:11.693

您是否尝试在每次应用程序启动时调用 restoreCompletedTransactions ？如果你想要一份所有交易的清单，你会提出一个 SKProductsRequest

```
 SKProductsRequest *productsRequest = [[SKProductsRequest alloc] initWithProductIdentifiers:productsSet];
    productsRequest.delegate = self;
    [productsRequest start]; 
```

如果您想获得已完成的交易并且没有取回所有内容，请显示日志。

# c# - 如何在 Visual Studio 中调用初创公司的第二个项目？

> ID：10588224
> 
> 赞同：0
> 
> 时间：2012-05-14T17:28:36.117
> 
> 标签：c#, visual-studio-2010

我有一个启动项目，我想`process.Start();`在同一个解决方案中进行第二个项目。但是使用`Path.Combine(Application.StartupPath, "SecondAssemblyName.exe");`as`FileName` 不起作用。有什么作用？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-05-14T17:37:49.027

默认情况下，每个项目都构建到自己的目录中，因此您将拥有如下内容：

```
\MySolution
    \ProjectOne
        \bin
            ProjectOne.exe
    \ProjectTwo
        \bin
            ProjectTwo.exe 
```

因此，您执行其他 .exe 的命令不起作用，因为它们是为单独的文件夹构建的。

您可以通过执行以下操作之一来解决此问题。您可以添加构建后步骤以将一个 .exe 复制到其他 \bin 文件夹。或者您可以更改项目的构建输出路径以构建到相同的位置。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-05-14T17:35:20.640

您可以使用 Process.Start，但您需要提供其他项目的正确路径。

这个最简单的解决方案是更改每个项目的构建设置中的输出文件夹。如果您将两个项目都构建到一个共享的输出文件夹，您可以在输入时使用 Process.Start。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-05-14T17:33:10.953

您可以在调试时启动两个项目，执行以下操作：

点击解决方案 -> 设置启动项目

在打开的窗口中单击启动项目。

选择多个启动项目选项并选择项目。

因此，您可以在调试时同时运行并运行到 Visual Studio

# c++ - 使用 boost::program_options 作为类的静态成员

> ID：10588227
> 
> 赞同：0
> 
> 时间：2012-05-14T17:28:40.660
> 
> 标签：c++, boost, static-members, boost-program-options

基本上是下面的代码，不能通过编译器（g++）

```
#include <boost/program_options.hpp>
#include <iostream>
using std::cout;
using std::endl;
namespace po = boost::program_options;

class static_class {
public:
  static po::options_description cmd_opt;    // here is the definition
};

po::options_description static_class::cmd_opt("dummy");
// the line below cannot pass the compiler !!!
static_class::cmd_opt.add_options()
("help", "show usage info.")
;

main() {
  cout << static_class::cmd_opt << endl;
} 
```

错误信息：

```
test.cpp:16:1: error: ‘cmd_opt’ in class ‘static_class’ does not name a type 
```

任何的想法？

PS我正在尝试为我需要在小型命令行环境中处理的每个命令定义一个单独的选项描述。我正在使用 bison 和 flex 来解析命令行环境。命令的所有参数都将发送到这个静态类进行参数解析。

由于参数定义是静态的，我不想让它们成为堆栈中的某种数据结构（只是在我看来这可能是快速和干净的）。我认为如果它们不是静态的，这些代码会没问题，但如果它们是静态的会发生什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-05-14T17:40:33.410

调用`.add_options()`是*函数调用*，而不是声明。您正在尝试在函数之外运行代码。试试这个：

```
// untested
void PopulateOptions() {
  static_class::cmd_opt.add_options()
    ("help", "show usage info.")
    ;
}

int main () {
  PopulateOptions();
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2012-05-14T17:44:45.673

从[options_description](http://www.boost.org/doc/libs/1_49_0/doc/html/boost/program_options/options_description.html)来看，它需要一个两阶段的初始化：调用构造函数，然后调用`add_options()`来填充它。您的代码尝试在函数范围之外执行第二阶段并失败，因为调用`add_options()`必须在函数范围内完成。

解决它的一种方法是创建一个工厂函数来初始化和填充`options_description`对象并返回它。此返回对象可用于初始化静态实例`static_class::cmd_opt`，例如：

```
// in .cc

namespace {

po::options_description make_options_description() {
    po::options_description opt("dummy");
    opt.add_options() // ... populate ...
    return opt;
}

}

po::options_description static_class::cmd_opt = make_options_description(); 
```

另一个选项不是公开`po::options_description`静态成员，而是公开一个填充`po::options_description`通过引用传递的对象的函数，例如：

```
class static_class {
public:
    // requires only a forward declaration of po::options_description
    static void add_options(po::options_description&);
};

// in .cc
void static_class::add_options(po::options_description& opt) {
    opt.add_options() // ... populate ...
} 
```

然后在某处`main()`

```
po::options_description opt;
static_class::add_options(opt);
another_static_class::add_options(opt);
yet_another_static_class::add_options(opt); 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2012-05-14T18:35:17.983

不允许在全局或命名空间范围内使用独立语句。

您可以通过使用扩展`add_options`表达式的返回值来声明和初始化一个虚拟变量来解决此问题，如下所示。

```
po::options_description static_class::cmd_opt("dummy");

auto const dummy = cmd_opt.add_options()
  ("help", "show usage info.")
  ; 
```

如果您的 C++ 版本不支持`auto`这样，那么您可以使用类型的全名`po::options_description_easy_init`, 来代替。

# c# - 获取部分 xml 文件并将它们捆绑在一个新文件中

> ID：10588236
> 
> 赞同：0
> 
> 时间：2012-05-14T17:29:34.763
> 
> 标签：c#, xml, xmldocument

我正在尝试使用其他 xml 文件中的部分创建一个新的 xml 文件。例如，我得到了这 2 个 xml 文件：

文件 1：

```
<root> 
    <persons>
        <person1>
            <name> </name>
            <address> </address>
            <number> </number>
        </person1>
        <person2>
            <name> </name>
            <address> </address>
            <number> </number>
        </person2>
    </persons>
</root> 
```

文件 2：

```
<registration>
    <results>
        <result1>
            <test1> </test1>
            <Test2> </test2>
        </result1>
        <result2>
            <test1> </test1>
            <Test2> </test2>
        </result2>
    </results>
</registration> 
```

新的 xml 文件应如下所示：

```
<combined>
    <persons> 
        <person1>
            <name> </name>
            <address> </address>
            <number> </number>
        </person1>
        <person2>
            <name> </name>
            <address> </address>
            <number> </number>
        </person2>
    </persons>
    <results>
        <result1>
            <test1> </test1>
            <Test2> </test2>
        </result1>
        <result2>
            <test1> </test1>
            <Test2> </test2>
        </result2>
    </results>
</combined> 
```

我如何在 C# 中使用`xmldocument`?

编辑

更多信息，节点“persons”和“results”应该放在新的xml文档中（包括“persons”和“results”）。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-05-14T17:38:57.677

基本上：

```
var doc1 = XElement.Load(file1);
var doc2 = XElement.Load(file2);

var combined = new XElement("combined", doc1.Descendants("person"), doc2);

combined.Save(file3); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-05-14T17:39:12.497

```
XElement root1 = XElement.Load(file1);
XElement root2 = XElement.Load(file2);
XElement combined = new XElement("combined");

foreach(XElement node1 in root1.Elements())
    combined.Add(node1);

foreach(XElement node2 in root2.Elements())
    combined.Add(node2);

combined.Save(file3); 
```

# c# - MVC3 CS0135：“模型”与声明“System.Web.Mvc.WebViewPage”冲突 。模型'

> ID：10588239
> 
> 赞同：0
> 
> 时间：2012-05-14T17:29:49.850
> 
> 标签：c#, jquery, asp.net-mvc-3

```
 <div class="editor-label">
            @Html.LabelFor(Model => Model.Step)

            @Html.EditorFor(Model => Model.Step)
            @Html.ValidationMessageFor(Model => Model.Step)
        </div>

  <div id="tabs" title="Test">
    @if (Model !=null) 
```

我一直看到这个：CS0135: 'Model' 与指向 If 语句的声明 'System.Web.Mvc.WebViewPage.Model' 冲突。

你能告诉我我做错了什么吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-05-14T17:34:00.427

而不是“模型”使用其他东西。Model 是一个它认为你试图引用的类。

```
@Html.ValidationMessageFor(m => m.Step) 
```

# hibernate - Hibernate：在 @Formula 注释中使用 HQL？

> ID：10588241
> 
> 赞同：6
> 
> 时间：2012-05-14T17:30:02.453
> 
> 标签：hibernate, annotations, hql, formula

从我一直在测试的情况来看，您似乎只能在 @Formula 注释中使用标准 SQL。文档对这个特性的描述不是很详细（我最多找到一段关于它的段落），所以我想知道是否可以以某种方式使用 HQL，或者是否有另一个特性可以让我使用 HQL 查询加载对象的属性。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2012-05-14T17:48:48.617

你说的对 。`@Formula`只允许使用实际的列名。

HQL 的重要特点是使用 java 属性名来引用实际的列名。如果您想在派生公式值时引用属性名称，您可以简单地在映射的 POJO 的 getter 中实现公式的逻辑。

# sql - LINQ to SQL 表名

> ID：10588245
> 
> 赞同：1
> 
> 时间：2012-05-14T17:30:27.803
> 
> 标签：sql, linq

我想用 LINQ 获取我的表名

例如，我有 5 个表的数据库，我想在列表框中显示我的表名

然后通过一个查询我添加一个表然后再试一次，现在我们有 6 个项目的列表框。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2012-05-14T17:45:55.437

您可以将`sys.tables`或`INFORMATION_SCHEMA.TABLES`视图添加到您的设计图面，并在其中查询表名。

为此，在您的服务器资源管理器中，右键单击服务器，然后从*更改类型*菜单中选择*对象类型*或*模式（根据**[Linq to SQL - 访问系统数据库/表？](https://stackoverflow.com/q/54222/2688)*）。然后，您可以在 System Views 项下找到这些。

 ** * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-05-14T17:53:41.903

您的 Linq to SQL DataContext 已经有表名：[`context.Mapping.GetTables()`](http://msdn.microsoft.com/en-us/library/system.data.linq.mapping.metamodel.gettables)*

# iphone - 除非我手动将其设置为 nil，否则不会释放属性。或者在 Instruments 中运行

> ID：10588252
> 
> 赞同：0
> 
> 时间：2012-05-14T17:30:39.140
> 
> 标签：iphone, objective-c, ios, cocoa-touch, cocoa

我在 mainView 类中有一个这样声明的属性：

```
@property (nonatomic, retain) FriendsView *friendsView; 
```

出于某种原因，当 mainView 存在时，它并没有被释放。**除非** 我`self.friendsView = nil`在 mainView 的 dealloc 方法中这样做。

**很奇怪。**但是等等，它变得更奇怪了..

当我在仪器中运行它时，它会正确地释放，100% 的时间。
当我正常运行时，在friendsView的dealloc方法中使用断点和NSLog，它们永远不会被击中。

关于可能发生什么的任何想法？

**编辑：**我应该说，我正在使用 ARC。因此我的困惑。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-05-14T17:40:42.667

如果您在任何地方设置该属性，那么您将增加保留计数，并且不应在 mainView 存在时释放它，并且您应该释放它的 mainView 的 dealloc。这是预期的行为，并不奇怪。当你有一个保留或复制对象属性时，你应该在 init 上做：

```
friendsView = nil; 
```

在dealloc上：

```
[friendsView release]; //(or self.friendsView = nil which accomplishes the same) 
```

属性的行为不像您添加到视图中的对象，当父视图存在时它​​们将被释放。如果它们的保留计数 > 0，它们将在父对象被释放后存活。

# sed - 通过 sed 在我的 hd 的“备份”目录中备份每个替换的文件？

> ID：10588253
> 
> 赞同：2
> 
> 时间：2012-05-14T17:30:45.303
> 
> 标签：sed, replace

我知道您可以指定`-i.bak`，但我不想处理必须删除`.bak`文件的问题，即使它很简单：

`find . -name '*.bak' -exec rm {} \;`

有什么方法可以审核`sed`，以便默认情况下，只要我指定`-i`它支持它内联替换的每个文件，例如`/www/backups`？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-05-14T18:02:14.063

如果您只想在没有任何备份文件的情况下进行内联替换，只需关闭扩展名：`sed -i 's/pat/rep/'`.

至于在其他地方备份，[GNU sed](http://www.gnu.org/software/sed/manual/html_node/Invoking-sed.html)说：

> 遵循此规则：如果扩展名不包含 *，则将其作为后缀附加到当前文件名的末尾；如果扩展名确实包含一个或多个 * 字符，则每个星号都将替换为当前文件名。这允许您向备份文件添加前缀，而不是（或除了）后缀，甚至可以将原始文件的备份副本放置到另一个目录中（前提是该目录已经存在）。

备份“后缀”中的星号将替换为文件名（包括路径 - 因此如果您有子文件夹，则需要先在备份目录中创建它们）。

```
% seq 5 > file
% sed -i'backups/*.bak' s/3/c/ file
% cat file
1
2
c
4
5
% cat backups/file.bak
1
2
3
4
5
% 
```

# list - 仅转换 Scala 列表的第一个元素

> ID：10588255
> 
> 赞同：5
> 
> 时间：2012-05-14T17:30:51.210
> 
> 标签：list, scala, map

有没有办法只转换列表的第一个元素而不做一些超级黑客的事情，比如：

```
val head = l1.head
val tail = l1.tail
val l2   = change(head) :: tail 
```

`updated()`看起来它可以工作，但并没有太大的改进：

```
val head = l1.head
val l2   = l.update(0, change(head)) 
```

我喜欢这样的东西：

```
val l2   = l1.updateHead(change(_)) 
```

有这样的吗？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2012-05-14T17:37:46.913

你可以尝试使用模式匹配

```
val l2 = l1 match{
    case Nil   => Nil
    case x::xs => change(x)::xs
} 
```

这样你就不用担心是否`head`真的返回一个元素

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2012-05-14T17:44:35.647

通过在每一个机会中引入变量，你让你的生活变得更加艰难。不要这样做！

如果您不引入临时变量，您列出的两个选项都相当干净：

```
val l2 = change(l.head) :: l.tail
val l2 = l.update(0, change(l.head)) 
```

在空列表上两者都不是完全安全的，但是

```
val l2 = l.take(1).map(change) ::: l.drop(1) 
```

是。

您也可以随时使用自己的方法来丰富列表，但是：

```
class ReheadableList[A](xs: List[A]) {
  def rehead[B >: A](f: A => B) = xs.take(1).map(f) ::: xs.drop(1)
}
implicit def lists_can_be_reheaded[A](xs: List[A]) = new ReheadableList(xs) 
```

（编辑——更改以避免空列表错误）。现在你可以

```
val l2 = l.rehead(change) 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2012-05-14T17:55:14.777

使用部分镜头（[在本文中描述](http://dl.dropbox.com/u/7810909/media/doc/lenses.pdf)），您可以编写如下内容：

```
listHeadLens.set(list, newValue) 
```

其中`listHeadLens`定义为：

```
def listHeadLens[A] = new PartialLens[List[A], A] {
  def apply: List[A] => Option[CoState[A, List[A]]] = {
    case Nil => None
    case x :: xs => Some(CoState(x, _ :: xs))
  }
} 
```

我认为部分镜头将进入 Scalaz 7。不过我不确定。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2012-05-14T17:53:03.663

可能有很多方法可以做到这一点。下面是一个显示一个版本的 Scala REPL 会话

```
scala> val change = (x: Int) => x*2
change: Int => Int = <function1>

scala> val l = List(1,2,3)
l: List[Int] = List(1, 2, 3)

scala> l.headOption.map( x => change(x) :: l.drop(1) ).getOrElse(Nil)
res3: List[Int] = List(2, 2, 3) 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2012-05-14T18:15:37.003

你可以这样做。

```
val list = List("1","2","3")
def change(str : String ) = Some("x")

val nlist = (list.headOption.flatMap(change(_)).toList ::: list.tail) 
```

在控制台中。

```
scala> val list = List("1","2","3")
list: List[java.lang.String] = List(1, 2, 3)

scala> def change(str : String ) = Some("x")
change: (str: String)Some[java.lang.String]

scala> val nlist = (list.headOption.flatMap(change(_)).toList ::: list.tail)          
nlist: List[java.lang.String] = List(x, 2, 3) 
```

# express - Express.js, Jade：使用类型渲染 flash 消息

> ID：10588256
> 
> 赞同：0
> 
> 时间：2012-05-14T17:30:52.150
> 
> 标签：express, pug

从`req.flash()`我得到对象`{ error: ['Invalid username'] }`。我使用动态助手将它传递给用 Jade 编写的模板。但是当我这样做时

```
for type in flashMessages
    p #{type} 
```

在模板中，我收到消息 ('Invalid username') 而不是变量*type*中的类型。

你能给我一个建议如何获得类型吗？我想打印这样的闪存消息：

```
for type in flashMessages
    each message in flashMessages[type]
        p.alert-#{type} #{message} 
```

谢谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-05-14T17:48:18.297

`req.flash()`旨在为您提供所有消息的平面列表，或特定类型的所有消息的平面列表。无论哪种方式，消息对象本身都不会告诉您类型，因为假设您已经知道这一点。但是，鉴于`req.flash()`有 支持`req.session.flash`，您可以推出自己的功能。

首先，您需要准备自己的包含所需信息的消息列表，以便您可以将其传递给您的视图。例如，

```
var messagesByType = req.session.flash || {},
    allMessages = [];
Object.keys(messagesByType).forEach(function(type) {
    var messages = messagesByType[type] || [];
    messages.forEach(function(msg) {
        allMessages.push({ type: type, text: msg });
    });
});
req.session.flash = {}; 
```

其次，确保您`allMessages`在模板中可用。例如，

```
res.render('some-view', { messages: allMessages }); 
```

这应该给你一些你可以在你的视图中迭代的东西，如下所示：

```
for message in messages
    p(class='alert-#{message.type}') #{message.text} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-05-14T17:47:29.783

您尝试打印的“类型”值是指什么？

flash() 值没有任何“类型”属性。

如果“类型”是指“错误”，而“消息”是指“无效的用户名”：

错误是一个对象属性。要列出它们，您必须使用

```
var keys = Object.keys(myObject); 
```

# python - Python csv文件写入列表列表

> ID：10588259
> 
> 赞同：4
> 
> 时间：2012-05-14T17:31:09.430
> 
> 标签：python, csv

我如何在 python 中写入 csv 文件，这样，一个列表（这是一个列表的列表）

```
[['CL07001006', 'IM20010809'], ['IM75630511', 'IM75550511', 'IM75610511', 'IM75640511', 'IM75500511'],['CL0700100r','CL0700100U','PL07001006']] 
```

采用以下格式：

```
CL07001006 IM75630511 CL0700100r
IM20010809 IM75550511 CL0700100U
           IM75610511 PL07001006
           IM75640511
           IM75500511 
```

我尝试过类似下面的方法：

```
def demo():
    lol = [['CL07001006', 'IM20010809'], ['IM75630511', 'IM75550511', 'IM75610511',  'IM75640511', 'IM75500511']]
    file = open("dummy.csv", 'wb')
    fileWritter = csv.writer(file, delimiter='\n',quotechar='|', quoting=csv.QUOTE_MINIMAL)
    for l in lol:
        fileWritter.writerow(l)

if __name__ == '__main__':
    demo() 
```

结果如下：

```
CL07001006
IM20010809
IM75630511
IM75610511
IM75640511
IM75500511 
```

谢谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-05-14T17:40:30.623

```
>>> import itertools
>>> import csv
>>> x = [['CL07001006', 'IM20010809'], ['IM75630511', 'IM75550511', 'IM75610511', 'IM75640511', 'IM75500511'],['CL0700100r','CL0700100U','PL07001006']]
>>> outs = csv.writer(open("out.csv", "wb"))
>>> for row in itertools.izip_longest(*x):
...     outs.writerow(row)
...
>>> ^D

$ cat "out.csv"
CL07001006,IM75630511,CL0700100r
IM20010809,IM75550511,CL0700100U
,IM75610511,PL07001006
,IM75640511,
,IM75500511, 
```

# javascript - CSRF 保护导致“类型不匹配错误”

> ID：10588262
> 
> 赞同：1
> 
> 时间：2012-05-14T17:31:24.140
> 
> 标签：javascript, django, csrf, satchmo

在 Satchmo 代码 (satchmo/satchmo/apps/satchmo_store/contact/templates/contact/_state_js.html) 中，以下 JavaScript 在 Internet Explorer 版本 6 中导致错误：

```
/**
* Required for Django's CSRF protection when using AJAX
* Taken from here - http://docs.djangoproject.com/en/dev/ref/contrib/csrf/
*/

$('html').ajaxSend(function(event, xhr, settings) {
    function getCookie(name) {
        var cookieValue = null;
        if (document.cookie && document.cookie != '') {
            var cookies = document.cookie.split(';');
            for (var i = 0; i < cookies.length; i++) {
                var cookie = jQuery.trim(cookies[i]);
                // Does this cookie string begin with the name we want?
                if (cookie.substring(0, name.length + 1) == (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }
    if (!(/^http:.*/.test(settings.url) || /^https:.*/.test(settings.url))) {
        // Only send the token to relative URLs i.e. locally.
        xhr.setRequestHeader("X-CSRFToken", getCookie('csrftoken'));
    }
}); 
```

具体来说，IE 引用了以下行：

```
xhr.setRequestHeader("X-CSRFToken", getCookie('csrftoken')); 
```

问题出现在包含“国家”和“省”的表单中。显然，如果国家发生变化，那么可用的省份必须发生变化。一旦用户选择了一个国家，Explorer 就会报告这个错误：

```
Line: 239
Char: 9
Error: Type mismatch
Code: 0
URL: http://10.1.1.7:8000/checkout/ 
```

谁能建议这里的问题是什么？我也不明白为什么它应该是“类型不匹配”？

非常感谢，托马斯

# mercurial - Mercurial：如何列出第二个父级来自特定分支的合并变更集？

> ID：10588265
> 
> 赞同：8
> 
> 时间：2012-05-14T17:31:43.937
> 
> 标签：mercurial

我想找到从 branchX 合并到默认值的所有变更集。

因此，此类变更集的第一个父级是默认的，而此类变更集的第二个父级位于 branchX 上。

使用`hg log -r 'branch("default") & merge()`默认情况下，我们拥有所有合并的变更集，无论第二个父级是否为 branchX。

如何修改上述修订集以过滤掉第二个父级仅在 branchX 上的合并变更集？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2012-05-14T21:35:55.187

这在我的测试中做到了：

```
hg log -r "children(p2(branch(default)) & branch(branchX)) & merge()" 
```

解释：

`p2(branch(default)) & branch(branchX)`获取分支`branchX`上变更集的第二个父项的变更集。`default`

`children()`获取这些变更集的孩子

`& merge()`将这些孩子限制为合并变更集。如果没有这种情况，您也会得到正在继续的孩子`branchX`

我认为编辑这样做会更好：

```
hg log -r "children(p2(branch(default)) & branch(branchX)) & branch(default)" 
```

第一个版本将包括在从 to`branchX`合并之后从其他分支合并的`branchX`更改`default`。

# ruby-on-rails - Facebook 应用程序：在 Canvas 中，Facebook 将 GET 视为 POST？

> ID：10588267
> 
> 赞同：0
> 
> 时间：2012-05-14T17:31:51.117
> 
> 标签：ruby-on-rails, facebook

在我的 Rails FB 应用程序中，当在画布中运行时，如果我转到“/users”，而不是`GET`设置索引页面，它`POST`会创建一个新用户。

只有当我尝试直接访问 URL 时才会发生这种情况。当我在应用程序上使用“用户列表”链接时，它按预期工作。

这是为什么？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-08-02T04:24:12.477

这就是FB的做法。他们也会在每个查询中发布数据。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-11-12T14:11:11.483

Facebook 将所有内容作为 POST 发送，这会阻止 RESTful 路由。不过有一种方法可以解决它。如果传入的 POST 请求包含`signed_request`参数，您可以假设它是由 Facebook 将其从 GET 转换为 POST。

[Rack::Facebook::MethodFix](http://www.appelsiini.net/projects/rack-facebook-methodfix)中间件自动修复问题。您可以将其与以下内容一起使用：

```
# Basic usage
use Rack::Facebook::MethodFix

# Also validate signed_request
use Rack::Facebook::MethodFix, :secret_id => "c561df165eacdd6e32672c9eaee10318"

# Do not apply request method fix to admin urls.
use Rack::Facebook::MethodFix, :exclude => proc { |env| env["PATH_INFO"].match(/^\/admin/) } 
```

或者如果您使用的是 Rails，那么

```
config.middleware.use Rack::Facebook::MethodFix 
```

# html - CSS：具有图像和中间高度的三列布局

> ID：10588271
> 
> 赞同：0
> 
> 时间：2012-05-14T17:32:07.720
> 
> 标签：html, css, layout

我想在高度上对齐两个侧边栏和一个居中的图像。此外，侧边栏（包含文本）应与外部容器的高度垂直对齐。

我做了一个描述问题的小提琴：http: [//jsfiddle.net/SW3DT/](http://jsfiddle.net/SW3DT/)

在全屏显示此示例时，您会看到一切正确，但是当您查看小提琴 html 预览（或任何较小的视图）时，它不再起作用了。

所以存在以下问题：

1.  对齐旁边和中心容器水平（位置：绝对，左，右）
2.  将子对象从侧面（在本例中为 p）垂直对齐（打破绝对）
3.  动态执行所有这些操作，以便可以在不同的屏幕尺寸上使用

如何将所有三个点一起查看使得使用 css 编写代码变得很困难。

有没有人有办法解决吗？

此外：我如何为此类任务定义可重用的 css 类？

最好的问候， bsus

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-05-14T18:05:38.507

如果我确实正确理解了您的问题，那么您有点想要一个具有三列的居中包装器，左右列占据 200 像素的宽度。如果是这种情况：

请参阅此[小提琴示例](http://jsfiddle.net/zuul/SW3DT/6/)

**HTML：**

```
<div class="content">
    <aside class="column right">
        <p>
             text...
        </p>
    </aside>
    <aside class="column left">
        <p>
             text...
        </p>
    </aside>
    <div class="column center">
        <img class="home_image" src="path_to_image.png" />
    </div>
</div> 
```

**CSS：**

```
/* the main wrapper */
.content {
  position: absolute; top: 50%; left: 50%;
  width: 800px; height: 500px;
  margin-left: -401px; margin-top: -251px;
  border: 1px solid #D9D9D9;
}

/* columns */
.column {
    position: absolute; top: 0; bottom: 0;
    width: 180px;
    padding: 10px;
}

.column.left{
    left: 0; background-color: #F2F2F2;
}
.column.right {
    right: 0; background-color: #F2F2F2;
}
.column.center {
    left: 200px; right: 200px;
    text-align: center;
    width: auto;
}

.column.center img {
    border: 1px solid #111; border-radius: 22px;
    width: 128px; height: 128px;
    margin: 0 auto;
} 
```

***此外：我如何为此类任务定义可重用的 css 类？***

您可以看到`.column`应用于`.left`,`.right`和`.center`元素的类，因此可以在所有三个上重用。

# django - DJANGO：更改 ModelMultipleChoiceField 的字段大小？

> ID：10588275
> 
> 赞同：2
> 
> 时间：2012-05-14T17:32:28.090
> 
> 标签：django, forms, django-forms, modelform, multiple-choice

我想知道如何改变 ModelMultipleChoiceField 的大小？我只见过将 CharField 更改为 Textarea 的示例……这可能吗？

模型.PY

```
class FilterForm(forms.Form):
    Person = forms.ModelMultipleChoiceField(required=False, queryset=Person.objects.all(), attrs={'cols': 50, 'rows': 10}) 
```

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2012-09-07T08:46:52.797

覆盖表单的`__init__`方法并添加：

```
self.fields['Person'].widget.attrs['size']='10' 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2017-03-03T02:51:53.987

试试这个：

```
from django.forms import widgets
class FilterForm(forms.Form):
    Person = forms.ModelMultipleChoiceField(required=False, queryset=Person.objects.all(), widget=widgets.SelectMultiple(attrs={'size': 20})) 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-05-14T18:05:30.953

`<select>`您可以通过将 CSS 应用于Django 创建的元素来更改小部件的宽度和高度。

# sql-server - 当前 table_schema 为空时如何更改 table_schema？

> ID：10588278
> 
> 赞同：0
> 
> 时间：2012-05-14T17:32:29.490
> 
> 标签：sql-server, sql-server-2000

我以某种方式设法在具有空表架构的数据库中创建了一个表。我无法查询该表，因为它没有所有者，并且出于同样的原因更改该表也不起作用。

我会使用以下方法更改表格：

```
ALTER SCHEMA null TRANSFER dbo.SubscriptionAnswerMR 
```

但这不起作用。

information_schema.tables 如下所示：

```
TABLE_CATALOG   TABLE_SCHEMA    TABLE_NAME              TABLE_TYPE
q_Profiles              NULL    SubscriptionAnswerMR    BASE TABLE 
```

所以我的问题是：如何更改 q_Profiles 的 table_schema？

SQL Server 2000（*编辑*）Microsoft SQL Server Management Studio 2008R2

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-05-14T19:21:26.000

您应该能够通过查看以下查询的结果来验证您的表是否正常：

```
SELECT u.name
  FROM q_Profiles..sysobjects AS o
  INNER JOIN q_Profiles..sysusers AS u
  ON o.uid = u.uid
  WHERE o.name = 'SubscriptionAnswerMR'; 
```

这应该是`dbo`除非有人用不同的所有者明确创建它们或使用[`sp_changeobjectowner`](http://msdn.microsoft.com/en-us/library/aa259618%28SQL.80%29.aspx). 如果您发现 sysobjects 也有错误的答案，您可以使用它：

```
EXEC sp_changeobjectowner 'SubscriptionAnswerMR', 'dbo'; 
```

`ALTER SCHEMA`在这里无效，因为它是在 SQL Server 2005 中引入的。尽管描述“不起作用”的含义对您很有用。

`INFORMATION_SCHEMA`正如@Pondlife 指出的那样，这是一组非常不可靠的观点。另请参阅以下内容，这在 SQL Server 2000 中对您没有多大帮助，但应该有助于向前发展：

*   [针对 INFORMATION_SCHEMA 视图的案例](https://sqlblog.org/2011/11/03/the-case-against-information_schema-views)

另外作为旁注，您似乎对表和数据库感到困惑。`TABLE_CATALOG`是数据库，不是表。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-05-14T17:46:47.703

您是否在[文档](http://msdn.microsoft.com/en-us/library/ms186224%28v=sql.100%29)中注意到此评论？

> 不要使用 INFORMATION_SCHEMA 视图来确定对象的架构。查找对象架构的唯一可靠方法是查询 sys.objects 目录视图或使用 OBJECT_SCHEMA_NAME 函数。

# jquery - Uploadify在~25MB后不上传

> ID：10588282
> 
> 赞同：0
> 
> 时间：2012-05-14T17:33:08.910
> 
> 标签：jquery, file-upload, uploadify

我在本地主机上使用 Uploadify 来开发一个用户可以上传文件的站点。到目前为止一切正常，但 Uploadify 拒绝上传任何超过 ~25MB 的文件。

我正在使用此功能报告上传状态：

```
function updateProgress(file, bytesUploaded, bytesTotal, totalBytesUploaded, totalBytesTotal) {
    var percent = totalBytesUploaded / totalBytesTotal * 100;
    $('.bar').css('width', percent + '%');
    console.log(percent +' ' + bytesUploaded);
} 
```

如果我尝试上传任何小于 25MB 的文件，它工作正常，任何超过该大小的文件和上传都会停止。没有错误或任何东西。

这些是我的相关`php.ini`设置：

```
post_max_size = 1024M
upload_max_filesize = 1000M
memory_limit = 1024M 
```

我已经确认他们使用`phpinfo()`. 这是我的上传脚本：

```
<?php
$targetFolder = '/uploads'; // Relative to the root

if (!empty($_FILES)) {
    $tempFile = $_FILES['Filedata']['tmp_name'];
    $targetPath = $_SERVER['DOCUMENT_ROOT'] . $targetFolder;
    $targetFile = rtrim($targetPath,'/') . '/' . $_FILES['Filedata']['name'];

    $fileParts = pathinfo($_FILES['Filedata']['name']);

    move_uploaded_file($tempFile,$targetFile);
    echo '1';
}
?> 
```

我在这里错过了什么吗？也许是 Apache 配置设置？Uploadify 文档对这个错误帮助不大，我似乎无法通过谷歌找到任何东西。

谢谢。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-05-14T18:34:07.947

发现问题。我将 jQuery 效果`fadeOut`应用于在动画结束时将表单样式设置为`display: none`. 当表单到达此 Uploadify 停止上传。

我只是这样做了：

```
$('#upload-form').animate({opacity: 0}, function() {
    /// whatever
} 
```

# c# - 金字塔/树数据结构 c++/c#

> ID：10588283
> 
> 赞同：0
> 
> 时间：2012-05-14T17:33:09.623
> 
> 标签：c#, c++, algorithm, data-structures, graph-algorithm

我需要一个数据结构，它以这样一种方式存储整数，即每个数字都连接到紧接在其下方的两个（或更多）相邻的数字，例如

```
 1
     / \
    3   2
   / \ / \
  5   6   4
 / \ / \ / \
7   9   8  10 
```

然后需要找到从根到底部基行的任何下降路径的最大和，例如，在上面显示的数据中，1-3-6-9 将是最大和为 19 的路径。

一个节点可能连接到两个以上的子节点。

我试图实现一个 C# 树类，但不能完全弄清楚如何正确添加孩子，所以只是想知道是否真的需要有一个树结构并创建一个算法来有效地找到最大和。这是代码：http: [//ideone.com/GeH36c](http://ideone.com/GeH36c)

在语言方面，C# 和 C++ 都可以。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-05-14T20:45:34.670

(If you want to learn, read the comments from the code ;) )

You could also try using linked lists in C++. You can create a struct like this:

```
struct MyNumber{
    //The number itself
    int me;
    //Each number has 2 derived numbers
    MyNumber *childA,*childB;
    //A default constructor of a number that doesn't have 'sons'
    MyNumber(int me):me(me),childA(NULL),childB(NULL)
    {}
}; 
```

Then you create a "MyNumber" that will be the top of the pyramid, and a list of "MyNumber" that will represent the bottom of the pyramid:

```
#include <iostream>
#include <vector>

using namespace std;

//The top of the pyramid only has 1 number. It's null because it hasn't been initiated.
MyNumber *top=NULL;
//The bottom is composed of a list of numbers
vector<MyNumber*> bottom; 
```

After that you create a function wich adds new levels to the pyramid:

```
void add_level(int count,int * list_of_numbers){
    //if the top of the pyramid doesn't exist (is null) then initiate one
    if(top==NULL)
    {
        //You can only add 1 number to the top. If not, there must be an error.
        if(count!=1){
            cout<<"Error: can't add more than one number at the top of the pyramid"<<endl;
            return;
        }
        //You made it correctly! We will create the top with the first number of the list.
        top=new Number(list_of_numbers[0]);
    }
    //The top is already created. We will connect numbers.
    else{
        //The new level to be added:
        vector<MyNumber*> new_level;
        //The count of the new numbers list must be 1 more than the bottom size,
        //unless that the bottom size is 0: the count will be 2
        if(bottom.size()==0)
             if(count!=2){
                 cout<<"Error: the second level can only have 2 numbers"<<endl;
                 return;
             }
        else if( bottom.size()!=(count-1) ){
            cout<<"Error: the new level can only have "<<bottom.size()+1<<" numbers"<<endl;
            return;
        }
        //adding the numbers to the new level list
        bool bfirst_time=true;
        for(int i=0,e=0;i<count;i++)
        {
            MyNumber * new_number=new MyNumber(list_of_numbers[i]);
            new_level.push_back(new_number);
            if(bfirst_time)
            {
                //Setting the childA from the old bottom as the first number from the list
                //Do this only 1 time
                bottom[0]->childA=new_number;
                bfirst_time=false;
            }
            else{
                //The 'e' bottom number will be new number parent as well as the 'e+1'
                //bottom number (every number has 2 parents except the first and last
                //number from the new list)
                bottom[e]->childB=new_number;
                e++;
                if(e<bottom.size())
                    bottom[e]->childA=new_number;
            }
        }
        //connecting those numbers with their parent/s(the old bottom of the pyramid)
    }
} 
```

Next you add the numbers to the pyramid using the function:

```
int * list_of_numbers=new int[1];
list_of_numbers[0]=1;
//adding the top
add_level(1,list_of_numbers);
list_of_numbers=new int[2];
list_of_numbers[0]=2;
list_of_numbers[0]=3;
//adding the second level
add_level(2,list_of_numbers);
... 
```

Finally you can get the maximum sum by this way:

```
#include <iostream>
#include <algorithm>

using namespace std;

//the int containing the sum
int max_sum=top->me;
//a clone of the top
MyNumber * clone=top;
//same as "while you don't reach the bottom of the pyramid, continue"
while(clone->childA!=NULL && clone->childB!=NULL)
{
    //add the biggest value to the max_sum variable
    max_sum+=max(clone->childA->me,clone->childB->me);
    //setting the clone as the biggest child
    clone=(clone->childA->me > clone->childB->me)? clone->childA:clone->childB;
} 
```

You can improve this code a lot. Probably it is easier to make it in C# but I don't use it :(

There may be some errors in the code, I didn't test it :P

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-05-14T18:44:16.647

我想到的数据结构类（C#）：

```
class Node
{
    int value;
    Node parent;            // You might do without this element
                            // Or use List<Node> parents for multiple parents;
    List<Node> childs;
} 
```

至于算法，我能想到的是从顶部开始，并使用递归函数到达底部（深度优先），比较所有总和，保留`Node`最大总和的值。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-05-14T22:01:11.980

我现在无法访问编译器，所以下面的代码可能有一些错误。我认为它说明了一般原则（使用递归）。我会尽快尝试运行它并修复任何错误。

```
#include <vector>
using namespace std;

class Node {
public:
    Node() {}
    Node(int val) { 
        this->value = val; 
        this->maxSumAtThisNode = 0; 
        this->children.push_back(NULL);
    }
    void addChild(Node* child) { this->children.push_back(child); }
    int numChildren() { return this->children.size(); }
    int getMaxSum() { return this->maxSumAtThisNode; }
    void setMaxSum(int new_sum) { this->maxSumAtThisNode = new_sum; }
    int getValue() { return this->value; }
    Node* getChildAtIndex(int i) {return this->children[i]; }
private:
    int value;
    int maxSumAtThisNode;
    vector<Node*> children;
};

class Tree {
public:
    Tree(Node* rootNode) { this->root = rootNode; };
    int findMaxSum(Node* currentNode) {
        bool isLeafNode = true;
        Node* child = new Node;
        for (int i=0;i<(currentNode->numChildren());i++) {
            child = currentNode->getChildAtIndex(i);
            if (child) {
                isLeafNode = false;
                int theSum = currentNode->getMaxSum() + child->getValue();
                if (child->getMaxSum() < theSum) {
                    child->setMaxSum(theSum);
                }
                this->findMaxSum(child);
            }
        }
        if (isLeafNode) {this->leafNodes.push_back(currentNode); }
        int maxSum = 0;
        for (int j=0;j<leafNodes.size();j++) {
            if (leafNodes[j]->getMaxSum() > maxSum) { maxSum = leafNodes[j]->getMaxSum(); }
        }
        return maxSum;
    }
private:
    vector<Node*> leafNodes;
    Node* root;
}; 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-05-14T17:42:22.090

如果树总是平衡的（例如在您的示例中），则与其实际将其存储在基于树的结构中，不如只使用锯齿状数组：

```
int[][] pyramid = new int[]
{
  new[]{1}
  new[]{2, 3}
  new[]{5, 6, 4}
  new[]{7, 9, 8, 10}
} 
```

项的子项`pyramid[i][j]`是`pyramid[i+1][j]`和`pyramid[i+1][j+1]`

在实际找到最大路径时，您可以使用回溯器。可能有修剪路径的方法，但是如果您使用回溯器，您应该知道它具有指数运行时复杂性（这意味着它不能很好地扩展）。虽然您可以制作一些比其他更好的回溯器，但我不确定在一般情况下您是否能够找到比 O(2^n) 更好的算法。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-05-14T18:19:28.260

如果您在谈论二叉树或 AVL 树，则它是：

> ```
> typedef struct Node{
> 
>     int value;
>     Node *right;
>     Node *left;
>     BOOL hit;
> 
> }TypeNode; 
> ```

顺便说一句，由于您正在寻找最高金额，您可以这样做：

> ```
> typedef struct node{
>     int value;
>     node* right;
>     node* left;
>     BOOL hit;
> }TypeNode;
> 
> BOOL haveBrother(TypeNode *node){
>   if(node->right!=NULL || node->left!=NULL){
>       return true;
>   }
>   return false;
> }
> 
> int getSum(TypeNode *root, char* str){
>   int sum=0;
>   strcpy(str,"");
>   TypeNode *aux=root;
>   while(aux!=NULL){
>       if(aux->left!=NULL){
>           if(!aux->left->hit){
>               if(haveBrother(aux->left)){
>                   aux=aux->left;
>                   sum+=aux->value;
>                   strcat(str,itoa(aux->value));
>                   strcat(str,"-");
>               }else{
>                   sum+=aux->left->value;
>                   aux->left->hit=true;
>                   strcat(str,itoa(aux->value));
>                   strcat(str,"-");
>                   break;
>               }
>           }else{
>               aux->left->hit=false;
>               if(aux->right!=NULL){
>                   if(!aux->right->hit){
>                       if(haveBrother(aux->right)){
>                           aux=aux->right;
>                           sum+=aux->value;
>                           strcat(str,itoa(aux->value));
>                             strcat(str,"-");
>                       }else{
>                           sum+=aux->right->value;
>                           aux->right->hit=true;
>                           strcat(str,itoa(aux->value));
>                             strcat(str,"-");
>                           break;
>                       }
>                   }else{
>                       aux->right->hit=false;
>                       aux->hit=true;
>                       sum+=aux->value;
>                       strcat(str,itoa(aux->value));
>                         strcat(str,"-");
>                       break;
>                   }
>               }else{
>                   aux->hit=true;
>                   sum+=aux->value;
>                   strcat(str,itoa(aux->value));
>                   strcat(str,"-");
>                   break;
>               }
>           }
>       }else{
>           aux->hit=true;
>           sum+=aux->value;
>           strcat(str,itoa(aux->value));
>             strcat(str,"-");
>           break;
>       }
>   }
>   return sum;
> }
> 
> int main{
>     TypeNode *root=new TypeNode;
>     int sum=0;
>     int highestsum=0;
>     char sumpath[100];
>     do{
>         sum=getSum(root,sumpath);
>         if(sum>highestsum){
>             highestsum=sum;
>         }
>     }while(sum!=0);
>     printf("path: %s, with total sum: %d",sumpath,highestsum);
> } 
> ```

刚刚成功，不确定它是否工作，在那里测试，如果它不工作，请报告

# ios - 创建新项目以放入列表（如电话簿）iPhone SDK？

> ID：10588285
> 
> 赞同：-1
> 
> 时间：2012-05-14T17:33:18.200
> 
> 标签：ios, cocoa-touch

假设我想创建一个可以将人员添加到列表（如电话簿）的应用程序。在这个应用程序中，我可以输入这个人有多少辆车以及它是什么颜色。

来自 C++ 背景，合乎逻辑的做法是创建一个包含所有这些信息的链表。如果我想知道我的朋友有多少辆蓝色汽车，我可以使用迭代器来计算有多少辆蓝色汽车。

我会在objective-c中使用相同的概念吗？我希望能够在屏幕的右上角有一个小的“加号”，这样我就可以继续将人员添加到我的列表中。所以我的第一个问题是实现这一点。我创建了一个故事板来实现基础知识。我的后续问题是遍历列表并计算有多少“蓝色”汽车。

我不是在这里要求代码......我要求的是概念。你会怎么做呢？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-05-14T17:42:52.987

使用 NSMutableArray，它有点像 C++ 中的向量。链表不需要。如果你想要它是二维的，只需使用一个 NSMutableDictionary，它就像 c++ 中的地图一样工作。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-05-14T17:42:54.377

是的，如果你可以`NSMutableArray`用它的键处理全局，那么这里是可能的.....现在作为一个例子，如果你有带名字键的人名，还有另一个带汽车的键，那么当你点击加号时，你将记录添加到你的另一个错误，最后你用最终数组提交你的数据......希望，帮助它......
:)

# cqrs - 为什么事件存储应该在写端？

> ID：10588286
> 
> 赞同：16
> 
> 时间：2012-05-14T17:33:19.900
> 
> 标签：cqrs, event-sourcing

事件溯源被认为是许多事情的奖励，例如事件历史/审计跟踪、完整和一致的视图再生等。听起来很棒。我是粉丝。但这些都是读取端的实现细节，您可以通过将事件存储完全移动到读取端作为另一个订阅者来完成相同的操作。为什么不呢？

这里有一些想法：

1.  视图/非规范化器本身并不关心事件存储。他们只是处理来自域的事件。
2.  将事件存储移动到读取端仍然可以为您提供事件历史记录/审计
3.  您仍然可以从事件存储中重新生成视图。除了现在它不必是写入模型泄漏。给他读模范公民！

这似乎是将其保留在写入端的一个技术论据。[这是来自http://codebetter.com/gregyoung/2010/02/20/why-use-event-sourcing/](http://codebetter.com/gregyoung/2010/02/20/why-use-event-sourcing/)的 Greg Young 的：

> 然而，使用存储当前状态快照的东西存在一些问题。最大的问题围绕着您向数据引入了两个模型这一事实。您有一个事件模型和一个表示当前状态的模型。

我觉得有趣的是术语“快照”，它最近也成为事件溯源中的一个显着术语。在写入端引入事件存储会增加加载聚合的一些开销。您可以争论多少开销，但这显然是一个感知或预期的问题，因为现在有从快照加载聚合和自快照以来的所有事件的概念。所以现在我们又有了……两个模型。不仅如此，我看到的快照建议旨在作为基础设施泄漏来实现，后台进程会遍历整个数据存储以保持性能。

在拍摄快照后，快照之前的事件从写入的角度来看 100% 无用，除了……重建读取端！这似乎是错误的。

另一个与性能相关的话题：文件存储。有时我们需要将大型二进制文件附加到实体。从概念上讲，有时这些与实体相关联，但有时它们是实体。将这些放在事件存储中意味着您必须在每次加载实体时物理加载该数据。这已经够糟糕的了，但想象一下其中有几个或数百个这样的大集合。我看到的每个答案基本上都是咬紧牙关并将uri传递给文件。这是一种逃避，会破坏分布式系统。

然后是维护。重建视图需要一个涉及事件存储的过程。因此，现在您编写的每个视图维护任务都进一步将您的写入模型绑定到使用事件存储......永远。

CQRS 的重点不是围绕读模型和写模型的用例根本不兼容吗？那么为什么我们要把读模型的东西放在写端，牺牲灵活性和性能，然后再把它们耦合起来。为什么要花时间？

所以总而言之，我很困惑。在我所坐的所有方面，事件存储作为读取模型细节更有意义。您仍然可以获得保留事件存储的许多好处，但您不会过度抽象写入端持久性，这可能会降低灵活性和性能。而且您不会通过泄漏的抽象和维护任务将您的读/写端耦合起来。

那么有人可以向我解释一个或多个令人信服的理由将其保留在写入方面吗？或者，为什么不应该将其作为维护/报告问题放在读取端？同样，我不是在质疑商店的实用性。就在它应该去的地方:)

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2013-04-19T10:51:04.127

这是一个长期死的问题，有人指出我。有很多原因可以更好地在写入端存储事件。

据我了解，您所谈论的架构是我看到的一种非常常见的架构……失败了。我们将域模型存储在关系数据库中，然后输出事件。您添加它们的扭曲，将读取端的事件保存在事件存储中。这很可能会导致混乱。

您将遇到的第一个问题是发布您的活动。当我保存到数据库并发布到 MSMQ 时会发生什么（我死在中间）。因此在它们之间引入了 DTC。这是一件大事，应该像瘟疫一样避免分布式事务。它也非常低效，因为我可能使数据持久化两次（一次排队到数据库）。这将大大限制系统吞吐量（200-300 条消息/秒的 DTC 基准​​很常见，而事件只有 20-30k/秒是常见的）。

有些人通过在他们的数据库中放置一个包含事件并作为队列操作的表来解决对 DTC 的需求。这将避免对 DTC 的需要，但这仍会遇到下一个问题。

当你有错误时会发生什么？我知道您永远不会编写有错误的代码，但后来有一位 Jrs/维护开发人员使用该项目。例如，当域对象更改和引发的事件不匹配时会发生什么？假设您将域对象上的状态设置为“LA”（硬编码），但您正确地将事件上的状态设置为 cmd.State（“CT”）。

您将如何检测正在发生的此类错误？正在讨论的最大问题是现在有两个“真相”来源，即写入端的数据库和出现的事件流。没有办法证明它们是等价的。这将导致各种奇怪的错误。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2012-05-15T01:34:50.963

我认为这确实是一个很好的问题。将您的聚合视为一系列事件在写入方面本身很有用，使命令重试等更容易。但我同意创建事件似乎令人不安，然后如果您需要这种快照性能改进，则必须为持久性创建另一个对象模型。

我认为聚合仅存储快照但将事件发送到读取模型以投影到读取模型的系统将被称为“CQRS”，而不是“事件溯源”。如果您保留事件以进行重新投影，我想您将拥有一个两者兼而有之的系统。

但是你不会有*三个*定义吗？一种用于持久化聚合，一种用于传达状态更改，还有更多用于回答查询？

在这样的系统中，通过加载聚合并直接向他们提问来开始回答查询是很诱人的。虽然这不是以任何方式禁止的，但它确实倾向于开始导致这些聚合增加他们可能不需要的功能，更不用说复杂的线程和事务了。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2012-05-24T15:44:59.520

将事件存储放在写入端的一个原因可能是在事件成为“事实”并被分发/分派之前解决并发问题，例如通过对提交事件流的乐观锁定。这样，在写入方面，您可以确保解决对同一事件流（聚合）的并发“提交”，其中一个通过，另一个必须通过比较事件或传播以智能方式解决冲突与客户端发生冲突，从而拒绝该命令。

# iphone - CoreData 为所有对象和键注册全局观察者

> ID：10588287
> 
> 赞同：0
> 
> 时间：2012-05-14T17:33:24.730
> 
> 标签：iphone, ios, core-data, key-value-observing

无论类型如何，我如何/应该为*所有实体和键注册 KVO 观察者？*

这样做的目的是监视对象的更改并将它们标记为已修改，以便我可以通过 JSON API 和 Web 服务提供同步功能。

另外，如果我做错了，正确的方法是什么？

编辑：并不是说这将用于生产代码，我宁愿不冒险使用不成熟的库。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-05-15T02:57:55.370

`NSManagedObjectContextObjectsDidChangeNotification`是你的朋友。

此通知在每次运行循环迭代时发布一次，并包含所有已更改/插入/删除/合并的字典。

需要注意两点：

如果您正在使用花哨的线程/操作队列技巧，则在某些情况下，如果此通知似乎没有在您期望的时候发布，您可能必须手动调用 processPendingChanges。通常，CD 在需要时会自动将其安排在当前运行循环中。

当您注册此通知时，请具体说明您想从哪个托管对象上下文（不要只传递 nil）。内部框架私下使用 Core Data，并且此通知可能会由您不期望的上下文发布。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-05-14T17:35:40.357

我会看看 RestKit，特别是 RKObjectMapper 和 RKObjectManager 类，因为它允许 KVC 对象映射。

```
RKObjectManager* manager = [RKObjectManager managerWithBaseURL:myBaseURL];
RKObjectMapping* articleMapping = [RKObjectMapping mappingForClass:[Article class]];
[mapping mapAttributes:@"title", @"body", @"publishedAt", nil];
[manager.mappingProvider setObjectMapping:articleMapping forKeyPath:@"article"];

// Generate an inverse mapping for transforming Article -> NSMutableDictionary. 
[manager.mappingProvider setSerializationMapping:[articleMapping inverseMapping] forClass:[Article class]];` 
```

# python - Django：限制用户一次登录一次

> ID：10588289
> 
> 赞同：2
> 
> 时间：2012-05-14T17:33:24.837
> 
> 标签：python, django

Django 允许用户在不同的会话中从多台计算机登录。有没有办法限制用户同时从多台机器登录。也就是说，如果与在浏览器或计算机上登录的用户进行实时会话，您不得允许他在另一台计算机上登录。

出于安全目的，这将是一个有用的黑客攻击。做建议

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-05-14T18:23:54.440

您将希望在登录视图中使用 Django 会话。根据您设置登录视图的方式，您可能还想查询 Sessions 对象和过滤器，然后比较 datetime.now() 与 NameOfQuerySessionVariable.expire_date

# git - Git 分支：master vs. origin/master vs. remotes/origin/master

> ID：10588291
> 
> 赞同：221
> 
> 时间：2012-05-14T17:33:26.583
> 
> 标签：git, git-branch, git-remote

我认为我在理解 git 的基本概念方面处于正确的轨道上。

我已经设置并克隆了一个远程存储库。我还创建了一个服务器端空存储库，并将我的本地存储库链接到它。

我的问题是我不明白以下之间的区别：

*   origin/master 与 remotes/origin/master

据我了解，**master**是本地分支，而**remotes/origin/master**是远程分支。

**但是origin/master**到底是什么？

* * *

## 回答 #1

> 赞同：230
> 
> 时间：2012-05-14T17:56:41.020

克隆一个远程存储库并运行`git branch -a`（以显示 git 知道的所有分支）。它可能看起来像这样：

```
* master
  remotes/origin/HEAD -> origin/master
  remotes/origin/master 
```

这里，`master`是本地存储库中的一个分支。 是远程命名`remotes/origin/master`的分支。您可以将其称为 any ，如：`master``origin``origin/master`

```
git diff origin/master..master 
```

您也可以将其称为`remotes/origin/master`：

```
git diff remotes/origin/master..master 
```

这些只是引用同一事物的两种不同方式（顺便说一下，这两个命令的意思是“向我显示远程`master`分支和我的`master`分支之间的更改）。

`remotes/origin/HEAD`是`default branch`远程命名的`origin`。这让您可以简单地说`origin`而不是`origin/master`.

* * *

## 回答 #2

> 赞同：115
> 
> 时间：2013-02-17T05:48:08.387

像我这样的傻瓜的简短回答（从 Torek 偷来的）：

*   ***origin/master***是“我上次检查时主人在哪里”
*   ***主人***是“根据我一直在做的事情，主人在哪里”

* * *

## 回答 #3

> 赞同：40
> 
> 时间：2012-05-14T18:09:51.470

从技术上讲，您的 Git 存储库中实际上根本没有任何“远程”事物^(1 ，只有本地名称)*应该*与另一个不同存储库中的名称相对应。命名的`origin/whatever`最初将与您克隆的 repo 中的那些匹配：

```
git clone ssh://some.where.out.there/some/path/to/repo # or git://some.where... 
```

制作另一个 repo 的本地副本。一路上，它记录了那里的所有分支，以及那些引用的提交，并将它们粘贴到您的本地存储库中，名称为`refs/remotes/origin/`.

取决于你在你之前多久`git fetch`或相当于更新“我的什么是 some.where.out.there”的副本，他们可能会改变他们的分支，创建新的分支，并删除一些。当你做你的`git fetch`（或`git pull`真正的 fetch 加合并）时，你的 repo 将复制他们的新工作并`refs/remotes/origin/<name>`根据需要更改所有条目。正是`fetch`ing 的那一刻让一切都匹配起来（嗯，那个，以及最初的克隆，以及一些`push`ing 的情况——基本上每当 Git 有机会检查时——但请参阅下面的警告）。

Git 通常会让您将自己的`refs/heads/<name>`称为 just `<name>`，而将远程的称为`origin/<name>`，这一切都可以正常工作，因为很明显哪个是哪个。有时可以创建自己的分支名称，使其不明显，但在它发生之前不要担心。:-) 只需给 Git 一个使其显而易见的最短名称，它就会从那里开始：`origin/master`是“我上次检查时`master`主人在哪里”，并且是“根据我一直在做的事情，主人在哪里” . 根据需要运行`git fetch`以在“master 在哪里”更新 Git。

* * *

警告：在 1.8.4 之前的 Git 版本中，`git fetch`有一些模式不会更新“master 在那边”（更准确地说，模式不会更新任何远程跟踪分支）。Running `git fetch origin`， or `git fetch --all`，甚至只是`git fetch`，*确实会*更新。跑步`git fetch origin master` *不会*。不幸的是，这种“不更新”模式是由普通的`git pull`. （这主要只是一个小麻烦，在 Git 1.8.4 及更高版本中已修复。）

* * *

¹嗯，有一种东西*叫做*“远程”。但这也是本地的！这个名字`origin`是 Git 称之为“远程”的东西。它基本上只是您在克隆时使用的 URL 的简称。这也是`origin`in 的`origin/master`来源。该名称`origin/master`称为*远程跟踪分支*，有时缩写为“远程分支”，尤其是在较旧或更非正式的文档中。

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2017-09-29T15:07:13.710

我会尝试让@ErichBSchulz 的答案对初学者来说更简单：

*   **origin/master**是远程仓库上 master 分支的状态
*   **master**是本地存储库上 master 分支的状态

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2016-12-13T22:36:45.797

1.  **origin** - 这是指向远程的自定义和最常见的名称。

`$ git remote add origin [https://github.com/git/git.git](https://github.com/git/git.git)`--- 您将运行此命令将您的 github 项目链接到源。这里原点是**用户定义的。** 您可以将其重命名为`$ git remote rename old-name new-name`

* * *

2.  **master** - Git 中的默认分支名称是 master。对于远程和本地计算机。

* * *

3.  **origin/master** - 这只是一个指向远程仓库中的 master 分支的指针。记住我说原点指向远程。

`$ git fetch origin`- 将对象和引用从远程存储库下载到您的本地计算机 [origin/master]。这意味着它不会影响您的本地主分支，除非您使用`$ git merge origin/master`. 请记住在运行此命令之前检查需要合并的正确分支

*注意：获取的内容表示为远程分支。Fetch 让您有机会在将更改集成到项目副本之前查看更改。显示您和远程之间的更改`$git diff master..origin/master`*

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2013-09-06T15:04:09.867

一个澄清（以及让我感到困惑的一点）：

“remotes/origin/HEAD 是默认分支”并不正确。

remotes/origin/master 是远程存储库中的默认分支（上次检查时）。HEAD 不是一个分支，它只是指向一个分支。

将 HEAD 视为您的工作区域。当您以这种方式考虑时，“git checkout branchname”对于将工作区文件更改为特定分支的文件是有意义的。您将分支文件“签出”到您的工作区域。出于所有实际目的，HEAD 是您在工作区域中可见的内容。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2018-11-24T17:12:49.373

**我认为这个 git 斜线表示法可能最好通过查看您的`.git`文件夹来理解。**

* * *

例如，这是我的 .git 的一个略为缩写的树，用于 LibreOffice 源代码库。

在**linux** `sudo apt-get install tree`中查看这个很有用。
在**Windows**中，我认为该`tree`命令可能仍然有效。

向下滚动并查看底部附近的 refs（又名“references”）：

```
$ tree  
.  
├── branches  
├── config  
├── description  
├── FETCH_HEAD  
├── gitk.cache  
├── HEAD  
├── hooks  
│   ├── applypatch-msg.sample  
    ...
├── index  
├── info  
│   └── exclude  
├── logs  
│   ├── HEAD  
│   └── refs  
│       ├── heads  
│       │   ├── master  
│       │   └── remotes  
│       │       └── origin  
│       └── remotes  
│           └── origin  
│               ├── distro  
│               │   ├── cib  
│               │   │   └── libreoffice-6-0  
│               │   ├── collabora  
│               │   │   └── cp-6.0  
│               │   └── lhm  
│               │       └── libreoffice-5-2+backports  
│               ├── HEAD  
│               ├── libreoffice-6-2  
│               ├── master  
│               └── private  
│                   └── mst  
│                       └── sw_redlinehide_4a  
├── objects  
│   ├── info  
│   └── pack  
│       ├── pack-b80087dc57e2b3315f449ca0f1aaa91987bf0c5e.idx  
│       ├── pack-b80087dc57e2b3315f449ca0f1aaa91987bf0c5e.pack  
│       ├── pack-eb4e6808029e712d8d9c2671accbbd98aaeb9a04.idx  
│       └── pack-eb4e6808029e712d8d9c2671accbbd98aaeb9a04.pack  
├── ORIG_HEAD  
├── packed-refs  
└── refs  
    ├── heads  
    │   ├── master  
    │   └── remotes  
    │       └── origin  
    ├── remotes  
    │   └── origin  
    │       ├── distro  
    │       │   ├── cib  
    │       │   │   └── libreoffice-6-0  
    │       │   ├── collabora  
    │       │   │   └── cp-6.0  
    │       │   └── lhm  
    │       │       └── libreoffice-5-2+backports  
    │       ├── HEAD  
    │       ├── libreoffice-6-2  
    │       ├── master  
    │       └── private  
    │           └── mst  
    │               └── sw_redlinehide_4a  
    └── tags  
        └── libreoffice-6-2-branch-point  

32 directories, 45 files 
```

* * *

如果它是这样布置的，它可能会不那么令人困惑，但事实并非如此：

```
repositories (i.e. independent trees)
├──local
│  └──master
│
└──origin1
│  └──master
└──origin2
   └──master 
```

* * *

我们有三种基本类型的引用：**head**、**remotes**和**tags**。

*   .git/refs/ **heads**包含我们本地的**master**。

*   .git/refs/ **remotes**可以容纳许多遥控器，尽管目前我们只有它的**来源**。

*   .git/refs/**标签**（在别处讨论）。

**因此，起源**是我们唯一的遥远。它拥有**origin/master**。

* * *

我们发现我们有 2 个**HEADS**（指向当前分支的指针）、一个本地和一个远程：

```
$ cat .git/HEAD                        #         local:  HEAD -> master
ref: refs/heads/master

$ cat .git/refs/remotes/origin/HEAD    # remote origin:  HEAD -> master
ref: refs/remotes/origin/master 
```

* * *

如果您列出您的**分支机构**：

```
$ git branch -a
* master
  remotes/origin/HEAD -> origin/master
  remotes/origin/aoo/aw080
  remotes/origin/aoo/trunk
  remotes/origin/distro/capgemini/cg-4.1
  remotes/origin/distro/cib/libreoffice-5-0
  remotes/origin/distro/cib/libreoffice-5-1
  remotes/origin/distro/cib/libreoffice-5-2
  ... 
```

*   列出的第一个分支（**master**）是唯一一个不是远程的。所以在这种情况下，我们有一个本地分支。我们将从这里开始我们自己的工作，为我们自己的新分支和后续提交。

接下来，您可能有许多远程跟踪分支，我们在这里做。您知道这些是远程跟踪分支，因为它们以“ *remotes/* ”为前缀。此处显示的用于远程命名的原点。

*   所以第二行是原点的**当前分支**指针。遥控器/来源：HEAD --指向--> master。这表明在远程存储库中，当前分支是他们名为**master**的分支，（不要与我们名为**master**的本地分支混淆）。

*   其余的分支不在您的 .git/refs/ 树中，而是您可以在 .git/refs/ 中找到它们`.git/packed-refs`。

当我们**git fetch**我们从远程存储库下载更改到我们的远程跟踪存储库中。

当我们**git merge**时，我们将这个本地远程跟踪存储库中的更改合并到我们工作的本地分支或分支中，在这种情况下合并到我们的主分支中。

（当我们**git pull**我们在一个操作中完成这两个步骤。）

* * *

有趣的是， **master的这些****本地**和**远程**UUID当前指向同一个节点（又名“提交”）：

 **```
$ cat refs/heads/master                   # local         master
1ca409292272632f443733450313de5a82c54a9c

$ cat refs/remotes/origin/master          # remote origin master
1ca409292272632f443733450313de5a82c54a9c 
```

所以我们的本地 master 指向与远程的 origin master 相同的地方：

```
[local] master = [remote] origin master 
```

* * *

最后，我觉得看看也很有用`.git/packed-refs`

```
$ cat packed-refs 
# pack-refs with: peeled fully-peeled 
3c1d4742e649fe9c8aed8c2817fe3e1f3364f298 refs/remotes/origin/aoo/aw080
e87c8b7922e9a73e0abb7f9a7a47c9ac3374a826 refs/remotes/origin/aoo/trunk
b70fdffb041c12f124dcc0822b61bf3450e53137 refs/remotes/origin/distro/capgemini/cg-4.1
5dbc3f1754809b9489faaf380b1a4bdbcfbb6205 refs/remotes/origin/distro/cib/libreoffice-5-0
cfdbc96ca47d68d6785fd21829a8d61f49d6e591 refs/remotes/origin/distro/cib/libreoffice-5-1
5189c8c47461ef09739086e55512fc6a10245273 refs/remotes/origin/distro/cib/libreoffice-5-2
3bee5917569ca8e6ee3b086458f5b1a917b88ca1 refs/remotes/origin/distro/cib/libreoffice-5-3
92fbe703f9ca480d3a2b8610d87e991c729edf77 refs/remotes/origin/distro/cib/libreoffice-5-4
05c0a5df66cc69d75280f05b804cf82f3387d42b refs/remotes/origin/distro/cib/libreoffice-6-0
7fe193e759b24b90852e6e327115b77114d7b119 refs/remotes/origin/distro/cib/libreoffice-6-1
8187f7aa413e7ef7b377eea2b057d336bf256867 refs/remotes/origin/distro/collabora/cd-5.3
7a6b608591e21ef61dc05cff9fc58da531035755 refs/remotes/origin/distro/collabora/cd-5.3-3.1
.... 
```

* * *

毫无疑问，这留下的问题多于答案，但我认为它可以开始帮助你回答你自己关于什么是什么的问题。**

# java - Swing Indeterminate JProgressBar 移动太快

> ID：10588295
> 
> 赞同：2
> 
> 时间：2012-05-14T17:33:59.497
> 
> 标签：java, swing, jprogressbar

我创建了一个 Swing JProgresBar 并将不确定设置为“true”。进度条可以正常工作，但它的循环速度非常快，而且看时间超过 3 秒很烦人。我想放慢速度，我认为会有一种方法。如果有方法我还没有找到。任何帮助将不胜感激。

```
sftpProgressBar.setIndeterminate(true);
sftpDialog.setVisible(true); 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-05-14T20:18:40.067

您可以控制 JProgressBar 的动画速度。请参阅[文档](http://docs.oracle.com/javase/1.4.2/docs/guide/swing/1.4/pb.html)：

> “ProgressBar.cycleTime” UI 默认让外观实现者（以及其他开发人员）指定每个动画周期需要多少毫秒。例如，循环时间为 500 意味着不确定模式进度条动画每秒重复两次。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-05-15T18:01:52.020

好吧，这就是我解决问题的方法。在“main”中，我注释掉了一些生成的代码。唯一改变的是进度条。它减速到一个更慢，更明显令人愉悦的速度。这是我注释掉的代码。

```
try {
  for (javax.swing.UIManager.LookAndFeelInfo info :  javax.swing.UIManager.getInstalledLookAndFeels()) {
    if ("Nimbus".equals(info.getName())) {
        javax.swing.UIManager.setLookAndFeel(info.getClassName());
        break;
  }
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2013-06-25T13:32:18.567

```
 UIManager.put("ProgressBar.repaintInterval", new Integer(250));
 UIManager.put("ProgressBar.cycleTime", new Integer(6000)); 
```

*ProgressBar.cycleTime*：是参数，可以指定每个动画循环需要多少毫秒。您可以参考[链接中的详细信息](http://docs.oracle.com/javase/7/docs/technotes/guides/swing/1.4/pb.html)

# python - PyScripter 是否有 Mercurial 或 Git 版本控制插件？

> ID：10588298
> 
> 赞同：5
> 
> 时间：2012-05-14T17:34:20.207
> 
> 标签：python, git, version-control, mercurial, pyscripter

我正在使用 Python 3.x 和 PyScripter 来编写我的脚本。我真的很怀念 PyScripter 中的版本控制功能——我被 Qt 和 MpLab X 宠坏了（我相信这是对 Eclipse 的颠覆）。事情比回来容易。现在我在 PyScripter 中没有任何版本控制，但我确实安装了 Mercurial。我完全意识到我可以手动管理 Mercurial，但我很懒惰并且讨厌手工工作。我还有其他光滑流畅的选择吗？我已准备好使用任何其他 vc 系统（例如 git）——我只想知道什么是最轻松的方式（正确的方式）。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2012-05-23T17:51:42.863

我[刚刚阅读了这篇文章](http://code.google.com/p/pyscripter/issues/detail?id=538)，它建议您可以简单地使用 PyScripter 的文件资源管理器菜单，它会自动启用 Windows 资源管理器中的所有功能。我安装了 TortoiseGIT，您可以从 PyScripter 的文件资源管理器窗口中看到，启用了 TortoiseGIT 的版本控制功能（可能是 @Helgi 提到的 TortoiseHg）。

浏览到存储 Python 脚本的文件夹，进行更改，提交--> 主控，所有这些都在 PyScripter 中进行。非常简单！

![从 PyScripter 运行 TortoiseGIT](../Images/6215a325f04f5d2de381311c0c7c09f2.png)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-05-15T12:37:53.330

据我了解，PyScripter 没有 Mercurial 插件，但它具有可配置的自定义工具支持。

对于 Windows Mercurial GUI，我强烈推荐[TortoiseHg](http://tortoisehg.bitbucket.io/)。它有一个不错的 DAG 渲染器、可视化注释、逐个文件合并对话框、捆绑了 KDiff3 并与其他合并工具集成。它还在 Windows 资源管理器中的文件上显示覆盖（干净、修改、添加）。

为了更好地与 PyScripter 集成，您可以将某些调用添加`thg`为自定义工具：

*   `thg ci`— 打开提交窗口
*   `thg blame <file>`— 注释文件（请参阅 PyScripter 以了解如何将当前文件名传递给工具）

**警告：**没有插件，Mercurial 不会自动注意到移动/重命名的文件。您必须使用 THG 对话框查找重命名，或者使用 Mercurial 命令在 IDE 之外移动文件。

也许你会发现这是一个可以接受的替代品。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-05-14T17:50:24.833

我只是出于个人喜好使用 Mercurial，但 Git 可能同样适合。听起来您正在寻找为某些用例提供菜单和按钮的 GUI，但我建议使用命令行界面，因为它更快且跨平台标准。

[Mercurial 的精彩介绍](http://hginit.com/)

# java - Java Socket，小字符串不必要地被分成两个数据包

> ID：10588299
> 
> 赞同：3
> 
> 时间：2012-05-14T17:34:25.757
> 
> 标签：java, sockets

我试图用套接字与设备服务器通信，在我的小 Java 程序挂起后，`readLine`我最终不得不用数据包嗅探器注入我的目标应用程序，发现它`os.writeBytes("notify\n");`被分成两个数据包，第一个包含`n`和next `otify`，其中服务器不喜欢。我通过预先添加另一个来解决这个问题`writeBytes`：

`os.writeBytes(" ");
os.writeBytes("notify\n");
os.flush();`

对我来说，这似乎有点 hacky 并且可能不稳定，有人可以阐明为什么我必须这样做并给我一个更好的解决方案。

干杯

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-05-14T17:38:10.640

使用原始套接字连接时，您永远不能假设您会以离散块的形式获取消息。在生产环境中，您完全有可能一次收到部分消息或多条消息。

如果你不想处理这个问题，你应该考虑使用像[Netty](https://www.jboss.org/netty/)这样的库来为程序员处理这些问题。

话虽如此，我同意 Thomas 的观点，您的问题可能与您选择的`writeBytes`.

# wpf - Prism、Unity 和 Multiple Views ala MDI

> ID：10588304
> 
> 赞同：0
> 
> 时间：2012-05-14T17:34:48.610
> 
> 标签：wpf, prism, tabcontrol, mdi

我正在尝试创建一个类似于 Visual Studio 的应用程序，因为我们有一个主要内容区域（即文档显示在 TabControl 中，而不是真正的 MDI 界面中），侧面有一个菜单。

到目前为止，除了内容之外，我已经完成了*所有*工作。我的目标是，当用户双击侧面导航菜单中的项目时，它会在内容区域中打开文档。这行得通，但每次我双击它都会产生同一个视图的一个*新*实例。我有可能在 TabControl 内容容器中拥有多个相同类型（但不同的“名称”）的视图。

现在，我的代码看起来像这样......

```
 IRegion contentRegion = IRegionManager.Regions[RegionNames.ContentRegion];

            object view = IUnityContainer.Resolve(viewModel.ViewType, viewModel.UniqueName);

            if (!IUnityContainer.IsRegistered(viewModel.ViewType, viewModel.UniqueName))
            {
                IUnityContainer.RegisterInstance(viewModel.UniqueName, view);
                contentRegion.Add(view);
            }

            contentRegion.Activate(view); 
```

但是，即使我注册了该视图，它似乎也*从未*注册过……我想我可能做错了——还有其他方法吗？（回复：正确的方式）

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-05-15T18:18:46.333

所以，问题是试图这样做。聪明的方法（对于其他尝试这样做的人）是以*正确*的方式使用 Prism。

我最终做的是导航：

**1** . 在导航菜单中，使用我要显示的视图的 UniqueID（保证是唯一的）构造一个 UriQuery（包含在 Prism 中）并将其添加到我要导航到的视图中，即：

```
 IRegionManager.RequestNavigate(RegionNames.ContentRegion, new Uri(ViewNames.MyViewName + query.ToString(), UriKind.Relative)); 
```

其中 query 是 UriQuery 对象。

**2** . 通过以下方式在模块中注册 View 和 ViewName：

```
 IUnityContainer container = ServiceLocator.Current.GetInstance<IUnityContainer>();
        container.RegisterType<object, MyView>(Infrastructure.ViewNames.MyViewName); 
```

**3** . 在视图中，确保 ViewModel 是构造函数的参数。让 Prism 为我们手动注入它。在构造函数中，确保将 DataContext 设置为传入的 ViewModel。

**4** . 最后，确保您的 ViewModel 实现 INavigationAware 接口...这是一个非常*简单*的实现（UniqueID 是 ViewModel 上的一个属性）：

```
 public virtual bool IsNavigationTarget(NavigationContext navigationContext)
    {
        if (navigationContext.Parameters != null)
            return (navigationContext.Parameters["UniqueID"] == UniqueID);

        return false;
    }

    public virtual void OnNavigatedFrom(NavigationContext navigationContext)
    {
    }

    public virtual void OnNavigatedTo(NavigationContext navigationContext)
    {
        if (navigationContext.Parameters != null)
            UniqueID = navigationContext.Parameters["UniqueID"];
    } 
```

从这里开始，Prism 将确保您的“UniqueID”仅存在一个视图，同时允许具有相同视图但不同 ViewModel 的其他视图（或该 ViewModel 的数据，即在不同选项卡中查看两个用户，但都使用相同模板视图）。

# interface-builder - 如何在 XCodes 4.3.2 中自动调整大小

> ID：10588305
> 
> 赞同：0
> 
> 时间：2012-05-14T17:35:03.793
> 
> 标签：interface-builder, xcode4.3

在我升级到 XCodes 4.3.2 之后，这让我很头疼。在旧版本中，我们可以通过单击箭头自动调整控件大小，如下图所示

![在此处输入图像描述](../Images/8bae1f05eedd64f1976b827ac5f6b404.png)

但在 XCodes 4.3.2 中，该视图已更改为

![在此处输入图像描述](../Images/5bb9d83801ab43e7ac41a4ed0a350392.png)

那么什么是天平以及它是如何工作的呢？我真的不明白苹果在发布 XCodes 新版本时还会改变用户界面。请解释如何使用它？

如果我的问题对你来说太简单了，请原谅我这样问。

谢谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-05-14T17:47:11.417

我找到了我的问题的答案。

这需要禁用自动调整大小功能。

要禁用取消选择 Interface Builder 设计画布中的“使用自动布局”选项。

之后，一切正常。

# android - Android Web 服务教程

> ID：10588311
> 
> 赞同：17
> 
> 时间：2012-05-14T17:35:17.940
> 
> 标签：android, web-services

寻找一个可以引导我在 Android 中创建 Web 服务应用程序的好教程。我很难找到有益的东西。我见过的大多数 Web 服务都已不存在。

我正在寻找一些相对简单的东西。

我在这个网站上找到了解决方案：

[java.dzone.com/articles/invoke-webservices-android](http://java.dzone.com/articles/invoke-webservices-android)

如果您使用这个：为 KSOAP2 库添加外部 jar 文件，转到 order and export 选项卡并选中 jar 文件旁边的框。最后转到项目选项卡并点击清理。如果这对您不起作用，我会尽力帮助您完成。它对我有用！

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2012-05-14T18:32:59.760

就解释和完整性而言，我见过的最好的网络服务教程在这里：[http ://www.androidhive.info/2012/01/android-login-and-registration-with-php-mysql-and-sqlite /](http://www.androidhive.info/2012/01/android-login-and-registration-with-php-mysql-and-sqlite/)

它概述了如何使用 JSON 作为消息格式来创建和使用基于 PHP 的 Web 服务。它包括所有层的代码（Android、PHP、MySQL）

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2012-05-14T17:41:39.963

一些演示

带有示例代码

[http://seesharpgears.blogspot.in/2010/10/ksoap-android-web-service-tutorial-with.html](http://seesharpgears.blogspot.in/2010/10/ksoap-android-web-service-tutorial-with.html)

首先，您现在应该从 Sourceforge Google 代码下载 KSOAP 库：

[http://code.google.com/p/ksoap2-android/downloads/detail?name=ksoap2-android-assembly-2.4-jar-with-dependencies.jar&can=2&q=](http://code.google.com/p/ksoap2-android/downloads/detail?name=ksoap2-android-assembly-2.4-jar-with-dependencies.jar&can=2&q=)

[http://seesharpgears.blogspot.in/2010/11/basic-ksoap-android-tutorial.html](http://seesharpgears.blogspot.in/2010/11/basic-ksoap-android-tutorial.html)

# java - 为什么即使我的程序在 Eclipse 中运行时没有异常，我的 .jar 文件也会引发异常？

> ID：10588313
> 
> 赞同：2
> 
> 时间：2012-05-14T17:35:25.407
> 
> 标签：java, eclipse, jar, executable-jar, noclassdeffounderror

我是 Java 新手，正在学习如何将应用程序导出到 .jar 文件。我在 Eclipse 中创建了一个简单的 Java 应用程序，其中包含一些基于[Eclipse 和 Java for Total Beginners](http://eclipsetutorial.sourceforge.net/totalbeginner.html)的教程的类。

当我通过 Run -> Run in Eclipse 运行我的应用程序时，我的应用程序无异常运行。但是，当我进入 File -> Export 并将我的应用程序导出到 .jar 文件中，然后执行

```
java myLibrary.jar 
```

在我的 Mac 终端中，我从标准错误中得到这个输出。

```
Exception in thread "main" java.lang.NoClassDefFoundError: myLibrary/jar

Caused by: java.lang.ClassNotFoundException: myLibrary.jar
    at java.net.URLClassLoader$1.run(URLClassLoader.java:202)
    at java.security.AccessController.doPrivileged(Native Method)
    at java.net.URLClassLoader.findClass(URLClassLoader.java:190)
    at java.lang.ClassLoader.loadClass(ClassLoader.java:306)
    at sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:301)
    at java.lang.ClassLoader.loadClass(ClassLoader.java:247) 
```

这是什么意思？我怎么会缺课？我尝试检查和取消选中要导出的项目。例如，我尝试包括我的 JUnit 测试无济于事。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-05-14T17:40:23.210

当您`java`不带参数运行时，它将打印：

```
Usage: java [-options] class [args...]
           (to execute a class)
   or  java [-options] -jar jarfile [args...]
           (to execute a jar file) 
```

使用`-jar`运行您的`jar`文件。

您还需要指明要运行的类。您可以在清单中执行此操作（您将使用`Main-Class`标题）。您可以在此处阅读有关它的更多信息：http: [//docs.oracle.com/javase/tutorial/deployment/jar/run.html](http://docs.oracle.com/javase/tutorial/deployment/jar/run.html)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-05-14T17:48:32.523

在终端中，转到包含所有类文件的目录。

```
jar cmf MANIFEST.MF myLibrary.jar * 
```

然后，如果成功创建了 jar，您可以通过以下方式运行它：

```
java -jar myLibrary.jar 
```

MANIFEST.MF 文件至少应包含：

```
Main-Class: myLibrary 
```

其中 myLibrary 是包含您的主要功能的类。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-05-15T11:46:24.417

在 Eclipse 中，右键单击您的项目 -> 单击导出 -> Java -> Jar 文件 -> 选择源文件夹（默认值在大多数情况下应该可以正常工作）。给出 jar 文件的位置。转到向导的最后一页，在“选择应用程序入口点的类：”中，选择包含 main.java 的 java 类文件。

# python - Python函数全局变量？

> ID：10588317
> 
> 赞同：330
> 
> 时间：2012-05-14T17:35:49.267
> 
> 标签：python, global-variables

我知道由于这样的混淆，我应该首先避免使用全局变量，但是如果我要使用它们，以下是使用它们的有效方法吗？（我试图调用在单独函数中创建的变量的全局副本。）

```
x = "somevalue"

def func_A ():
   global x
   # Do things to x
   return x

def func_B():
   x = func_A()
   # Do things
   return x

func_A()
func_B() 
```

第二个函数使用的与使用和修改的全局副本的值是否`x`相同？在定义后调用函数时，顺序是否重要？`x``func_a`

* * *

## 回答 #1

> 赞同：489
> 
> 时间：2012-05-14T17:38:03.323

如果您想简单地访问一个全局变量，您只需使用它的名称。但是，要**更改**其值，您需要使用[`global`](https://docs.python.org/reference/simple_stmts.html#the-global-statement)关键字。

例如

```
global someVar
someVar = 55 
```

这会将全局变量的值更改为 55。否则它只会将 55 分配给局部变量。

函数定义列表的顺序无关紧要（假设它们不以某种方式相互引用），它们被调用的顺序很重要。

* * *

## 回答 #2

> 赞同：131
> 
> 时间：2012-05-14T18:03:33.437

在 Python 范围内，对尚未在该范围内声明的变量的任何赋值都会创建一个新的局部变量*，除非*该变量在函数的前面声明为使用关键字 引用全局范围的变量`global`。

让我们看一下伪代码的修改版本，看看会发生什么：

```
# Here, we're creating a variable 'x', in the __main__ scope.
x = 'None!'

def func_A():
  # The below declaration lets the function know that we
  #  mean the global 'x' when we refer to that variable, not
  #  any local one

  global x
  x = 'A'
  return x

def func_B():
  # Here, we are somewhat mislead.  We're actually involving two different
  #  variables named 'x'.  One is local to func_B, the other is global.

  # By calling func_A(), we do two things: we're reassigning the value
  #  of the GLOBAL x as part of func_A, and then taking that same value
  #  since it's returned by func_A, and assigning it to a LOCAL variable
  #  named 'x'.     
  x = func_A() # look at this as: x_local = func_A()

  # Here, we're assigning the value of 'B' to the LOCAL x.
  x = 'B' # look at this as: x_local = 'B'

  return x # look at this as: return x_local 
```

实际上，您可以`func_B`使用命名的变量重写所有内容，`x_local`并且它的工作方式相同。

该顺序仅与您的函数执行更改全局 x 值的操作的顺序有关。因此，在我们的示例中，顺序无关紧要，因为`func_B`调用`func_A`. 在此示例中，顺序确实很重要：

```
def a():
  global foo
  foo = 'A'

def b():
  global foo
  foo = 'B'

b()
a()
print foo
# prints 'A' because a() was the last function to modify 'foo'. 
```

请注意，`global`仅需要修改全局对象。您仍然可以从函数内访问它们而无需声明`global`. 因此，我们有：

```
x = 5

def access_only():
  return x
  # This returns whatever the global value of 'x' is

def modify():
  global x
  x = 'modified'
  return x
  # This function makes the global 'x' equal to 'modified', and then returns that value

def create_locally():
  x = 'local!'
  return x
  # This function creates a new local variable named 'x', and sets it as 'local',
  #  and returns that.  The global 'x' is untouched. 
```

`create_locally`请注意和`access_only`--之间的区别，`access_only`尽管没有调用`global`，但它访问全局 x ，即使`create_locally`不使用`global`任何一个，它也会创建一个本地副本，因为它正在*分配*一个值。

这里的困惑是为什么你不应该使用全局变量。

* * *

## 回答 #3

> 赞同：23
> 
> 时间：2012-05-14T17:52:52.023

正如其他人所指出的，`global`当您希望该函数能够修改全局变量时，您需要在函数中声明一个变量。如果您只想访问它，那么您不需要`global`.

更详细地说，“修改”的含义是：如果要*重新绑定*全局名称，使其指向不同的对象，则必须`global`在函数中声明该名称。

许多修改（变异）对象的*操作不会*重新绑定全局名称以指向不同的对象，因此它们都是*有效*的，无需在函数中声明名称`global`。

```
d = {}
l = []
o = type("object", (object,), {})()

def valid():     # these are all valid without declaring any names global!
   d[0] = 1      # changes what's in d, but d still points to the same object
   d[0] += 1     # ditto
   d.clear()     # ditto! d is now empty but it`s still the same object!
   l.append(0)   # l is still the same list but has an additional member
   o.test = 1    # creating new attribute on o, but o is still the same object 
```

* * *

## 回答 #4

> 赞同：20
> 
> 时间：2017-03-21T10:59:39.167

您可以直接访问函数内部的全局变量。如果要更改该全局变量的值，请使用“global variable_name”。请参见以下示例：

```
var = 1
def global_var_change():
      global var
      var = "value changed"
global_var_change() #call the function for changes
print var 
```

一般来说，这不是一个好的编程习惯。通过破坏命名空间逻辑，代码可能变得难以理解和调试。

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2016-06-01T15:16:35.087

这是一个让我印象深刻的案例，它使用全局作为参数的默认值。

```
globVar = None    # initialize value of global variable

def func(param = globVar):   # use globVar as default value for param
    print 'param =', param, 'globVar =', globVar  # display values

def test():
    global globVar
    globVar = 42  # change value of global
    func()

test()
=========
output: param = None, globVar = 42 
```

我曾预计 param 的值为 42。惊喜。Python 2.7 在第一次解析函数 func 时评估了 globVar 的值。更改 globVar 的值不会影响分配给 param 的默认值。如下所示，延迟评估是我需要的。

```
def func(param = eval('globVar')):       # this seems to work
    print 'param =', param, 'globVar =', globVar  # display values 
```

或者，如果你想安全，

```
def func(param = None)):
    if param == None:
        param = globVar
    print 'param =', param, 'globVar =', globVar  # display values 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2012-05-14T17:38:45.160

`global`当您希望更改分配给全局变量的值时，您必须使用该声明。

您不需要它从全局变量中读取。请注意，在对象上调用方法（即使它改变了该对象中的数据）不会改变持有该对象的变量的值（缺少反射魔法）。

# c++ - 展开并将新对象添加到函数内的数组中

> ID：10588319
> 
> 赞同：0
> 
> 时间：2012-05-14T17:35:58.813
> 
> 标签：c++, arrays, pointers

我正在尝试扩展一个新对象并将其添加到函数内部的数组中，并使该数组在函数外部也受到影响（数组指针作为参数发送）。

```
void addMedia(Media* medias[], int &nrOfMedias, string title, int publYear, string author, int nrOfPages)
{
    Media** tempArray = new Media*[nrOfMedias +1];
    for(int i = 0; i < nrOfMedias; i++)
    {
        tempArray[i] = medias[i];
    }
    delete [] medias;
    medias = tempArray;
    delete [] tempArray;
    medias[nrOfMedias] = new Book(title, publYear, author, nrOfPages);
    nrOfMedias++;
} 
```

这段代码在函数内部工作得很好，但是当我离开它时，数组仍然是空的。据我了解，这是因为指针在函数内部发生了更改，但是如何在不更改指针的情况下扩展数组？

（我无法更改返回数据类型或参数、赋值要求。）

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-05-14T18:00:50.537

更改`medias = tempArray;`为`*medias = tempArray;`，使其编译，完善您的内存管理（考虑，真正应该释放什么，不应该释放什么）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-05-14T18:12:05.777

不要将媒体视为指针数组，将其视为指向数组的指针。工作示例（略微简化）：

```
class Media
{   
public:
    Media () { m_strTitle = "unknown";}
    string m_strTitle;
};

class Book : public Media
{
public:
    Book(string strTitle) { m_strTitle = strTitle; }
};

void addMedia(Media* medias[], int &nrOfMedias)
{
    Media * tempArray = new Media[nrOfMedias +1];
    for(int i = 0; i < nrOfMedias; i++)
    {
        tempArray[i] = (*medias)[i];
    }
    delete [] *medias;
    (*medias) = tempArray;

    (*medias)[nrOfMedias] = Book("newTitle");
    nrOfMedias++;
}

int main()
{
    int numMedia = 10;
    Media * myArray = new Media[numMedia];
    addMedia(&myArray, numMedia);
    for (int i = 0; i < numMedia; i++)
    {
        cout << i << ") " << myArray[i].m_strTitle << endl;
    }

    return 0;
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-05-14T18:34:35.093

您不需要`delete [] tempArray;` ，因为实际上指向与之后`tempArray`相同的内存块`medias``medias = tempArray;`

您的功能将在没有该行的情况下运行良好，但我假设您知道您通过什么`Media* medias[]`

# c - 彻底理解 glibc 中代码的最佳方法

> ID：10588322
> 
> 赞同：0
> 
> 时间：2012-05-14T17:36:20.273
> 
> 标签：c, linux, gcc, glibc, code-navigation

我正在为自己的目的修改 glibc。但是，将 glibc 的不同文件中的不同代码段关联起来非常困难，因为它太多了。

例如，我想要一个功能，当我看到一个函数调用时，我可以单击它并被定向到该函数，或者例如，如果我想查看一个函数的定义位置，我可以被带到那里，以及更多设施比如使用函数的地方，点击打开头文件，调用者-被调用者关系等等。有什么工具可以帮助我解决这个问题吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-05-14T17:40:26.520

更好地使用 IDE 我的建议是 Eclipse CDT

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-05-14T17:40:35.223

大多数“程序员”文本编辑器和 IDE 的功能类似于您所描述的某些功能。例如，列出项目中所有函数和变量定义的命令生成的 both`vim`和`emacs`support`tags`文件。`ctags`在任一编辑器中，都有一个适当的键序列，可将您直接带到光标下术语的定义。

您正在寻找的其他一些功能（如调用图）可以由其他外部工具生成，或者可能在功能更丰富的 IDE 中可用。

# linq - LINQ 检索第一个匹配项，或列表中每个项目的空白值

> ID：10588324
> 
> 赞同：1
> 
> 时间：2012-05-14T17:36:34.600
> 
> 标签：linq

我在使用 linq 查询时遇到了一些问题

```
var matches = from po in purchaseOrders
          from poItem in po.Items
          where TestMatch(poItem)
          select new Item(poItem); 
```

purchaseOrders 是一个 List 每个 PurchaseOrder 都包含一个 List

我需要的结果是每个采购订单中匹配的第一个 poItem（基于 的结果`TestMatch(poItem)`），或者是一个空白的 Item 对象。

所以最后matches.Count == purchaseOrders.Count

目前，我只得到与 PO 匹配的项目，我不确定如何确保每个 PO 只得到一个项目。而且我不知道如何确保如果没有匹配项，我会得到那个 PO 的空白项目。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2012-05-14T17:40:49.433

听起来你想要这样的东西：

```
 var matches = from po in purchaseOrders
               let poItem = po.Items.FirstOrDefault(item => TestMatch(item))
               select new { PO = po, 
                            Item = poItem == null ? null : new Item(poItem) }; 
```

使用 C# 4，您可以对 FirstOrDefault 的参数使用方法组转换：

```
 var matches = from po in purchaseOrders
               let poItem = po.Items.FirstOrDefault(TestMatch(item)
               select new { PO = po, 
                            Item = poItem == null ? null : new Item(poItem) }; 
```

# asp.net - 如何根据绑定的其他列设置 gridView 列的文本？

> ID：10588329
> 
> 赞同：0
> 
> 时间：2012-05-14T17:37:23.927
> 
> 标签：asp.net, gridview

我在 ASP 中有一个 GridView，用于在购物车中显示产品。

我将 GridView 的源设置为 ShopDataSet，并自动填充列名称、价格和数量。

我想要实现的是我添加的一个新列，它显示每一行的成本，即`Cost = price * quantity;`

如何在不对数据库执行新查询的情况下以编程方式执行此操作？

我不得不说，在价格和数量上，我设置了价格和数量等`"${0}"`格式`"{0} piece(s)"`。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-05-14T17:44:17.393

### 您应该以编程方式填充数据源。

在 SqlDataReader 中获取结果并使用 SqlDataReader 的结果填充 DataTable。

现在创建一个新的 DataTable，其中的列与您想要的输出相匹配，包括您的案例中的成本。现在遍历第一个 DataTable 的每一行，并使用成本计算将行添加到新 DataTable。

例如，

```
DataTable oldTable = new DataTable();
oldTable .Load(rdr); // where rdr is your SqlDataReader 
```

### 现在创建你的新表

```
DataTable newTable = new DataTable();
DataColumn noteID = new DataColumn("Cost", typeof(string));
newTable.Columns.Add(noteID);
//Add other columns
foreach (DataRow row in oldTable .Rows)
{
   DataRow newRow = newTable.NewRow();
   newRow["Cost"] = //your calculation
   ...
   ...
   newTable.Add(newRow);
} 
```

### 现在将网格的 DataSource 设置为 NewTable

# facebook-graph-api - 来自评论 FQL 表或通过 Graph API 的评论缺失

> ID：10588330
> 
> 赞同：0
> 
> 时间：2012-05-14T17:37:32.380
> 
> 标签：facebook-graph-api, facebook-fql, facebook-comments

我在 Facebook 上发布的专辑有 41 条评论，我用浏览器浏览时看到的最后一条评论的 ID[为 10150778810571046](https://www.facebook.com/browse/likes/?id=10150778810571046)（我喜欢它，这是类似的 URL），但使用 FQL 评论表时不会出现此评论... ！

使用“SELECT comments FROM stream WHERE post_id='689541045_10150777768986046'”的 FQL 调用返回 40 作为评论计数，并且不会返回我在 comment_list 中喜欢的最后一条评论。

获取常规新闻源并返回最后 25 个故事的 FQL 调用返回 41 具有评论计数，并且不会返回 comment_list 中的任何内容。

[两个 FQL 调用结果都在 gist 中在线](https://gist.github.com/f76a062ec713bfb91c12)。

有没有人有类似的问题？

# soap - 对称密钥传输与非对称在移动设备上的加密和签名

> ID：10588331
> 
> 赞同：2
> 
> 时间：2012-05-14T17:37:32.670
> 
> 标签：soap, encryption-asymmetric, encryption-symmetric

**设想**

SOAP Web 服务提供用于检索文档和数据的接口。安全是最重要的。

使用 WS-Security，客户端和服务器都对整个 SOAP 信封进行加密和签名。

**问题**

用于签名的私钥应该编译到应用程序中并存储在设备上，还是应该由服务器使用密钥交换协议提供（可能在用户身份验证之后）？

用于解密的私钥应该存储在设备上还是由服务器提供？

对于要由服务器解密（如果从客户端上传）或由客户端解密（如果从服务器下载）的每个文件都有一个唯一的密钥是否现实？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-05-14T18:07:49.810

只是几个建议：

- 由于逆向工程，您应该将嵌入到服务器外部任何内容的对称密钥视为公开的（即，如果密钥在野外，即使加密也不要打扰）。

- 您应该使用客户端上的安全 RNG 生成的每会话对称密钥，并使用全局非对称公钥加密传输到服务器。私钥有保质期。

- 您可以对在该会话中传输的所有文件/流使用会话密钥，但您应该使用唯一的随机数对每个文件的对称密钥加密进行加盐。根据加密模式，对多个流使用相同的密钥/随机数可能会使您容易对两个流进行异或运算并恢复混合但未加密的结果。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-05-14T18:00:59.080

如果必须将私钥从一个设备传输到另一个设备，那么整个私钥的概念就被打破了。通信通道的每一端都必须生成自己的私钥。请注意，这并不意味着将私钥编译成可执行文件，因为拥有该可执行文件的每个人都共享一个私钥，这显然不是您想要的。每个单独的设备都必须使用[加密安全的随机数源](http://en.wikipedia.org/wiki/Cryptographically_secure_pseudorandom_number_generator)来生成它自己的公钥/私钥对。然后公钥可以明文交换，你可以用它们来交换会话密钥（每个文件可以是唯一的），私钥可以签名，每个人都很开心。

但请记住：永远不要对私钥进行硬编码，永远不要与任何人共享它们。

# unix - Unix后台进程异常停止

> ID：10588334
> 
> 赞同：5
> 
> 时间：2012-05-14T17:37:41.710
> 
> 标签：unix, process, background, nohup

我使用以下命令在后台执行了一个 perl 脚本

```
nohup perl myPerlSCript.pl >debug_log & 
```

几分钟后，我的状态为

> [1]+ 已停止

我没想到它会停止，我也不知道是什么停止了它。我该如何调试它并找出它停止的原因？我实际上有兴趣了解要调试的 unix 命令。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-07-04T00:01:17.477

有几种方法可以停止在后台运行的进程。所有这些都涉及以下信号之一：

*   `SIGSTOP`
*   `SIGTSTP`
*   `SIGTTOU`
*   `SIGTTIN`

`SIGSTOP`很严重。它是不可阻挡、不可忽视、不可处理的。`SIGKILL`它会像杀死它一样肯定会停止该过程。其他的可以由后台进程处理以防止停止。

*   信号由另一个进程使用`kill(2)`，或由该进程使用`raise(3)`或发送给自身`kill(2)`
*   进程尝试写入终端，并且终端选项`tostop`已启用（参见 的输出`stty -a`）。这会生成`SIGTTOU`.
*   该进程尝试使用`tcsetattr(3)`或等效项更改终端模式`ioctl`。（这些与 显示的模式相同`stty`。）无论标志`SIGTTOU`的当前状态如何，都会生成。`tostop`
*   该进程试图从终端读取。这会生成`SIGTTIN`.

这个列表可能非常不完整。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-05-14T17:45:00.297

您是否有机会使用 tcsh ？Tcsh 实际上带有一个内置的 nohup 命令，我之前遇到过很多问题，看到了你所看到的确切行为。

`/usr/bin/nohup`如果是这种情况，请尝试直接使用。

# java - Android NDK / 一般 JNI 问题：Converting object / jobject to c++ user defiend type

> ID：10588339
> 
> 赞同：3
> 
> 时间：2012-05-14T17:37:53.927
> 
> 标签：java, android, c++, android-ndk, java-native-interface

我有一个调用我的 c++ 代码的本机函数调用，并且此代码创建了我的用户定义类的实例。

此函数具有以下签名：

```
public native Object loadEngine(int arg); 
```

进行此调用后，我想调用更多本机函数，这些函数将获取从 loadEngine() 返回的“对象”并对其进行修改，或从中请求数据。

签名示例：

```
public native String loadEngine(Object engine, int queryID); 
```

1.  甚至有可能做到这一点吗？
2.  如果可能的话，我将如何将我的 GameEngine 数据类型转换为 java Object 或 jni jobject。
3.  Java 会自动将其作为参考传递，这样它就永远不会被复制，我可以修改它，对吧？

以下场景会生成一个错误，指出它无法将 GameEngine 转换为 jobject，这是可以理解的，但这是我对 Java 经验非常少的最好的尝试：

```
JNIEXPORT jobject JNICALL Java_package_loadEngine
  (JNIEnv *env, jobject obj, jint arg) {
     GameEngine engine(params);
     return (jobject)engine;
  }

JNIEXPORT jstring JNICALL Java_package_queryAction
  (JNIEnv *env, jobject obj, jobject engine, jint arg) {
     String ret = newString(Integer.toString((GameEngine)engine.unimportant()));
     return ret;
  } 
```

由于我通过 jni 将本机 Java 代码调用到 C++，很遗憾我无法将本机函数定义为：

```
 public native GameEngine loadEngine(int arg); 
```

可以理解，但我似乎无法找到解决方法。

谢谢，斯嘉丽。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2012-05-14T17:55:40.627

您可以创建包含、拥有和管理本机代码的 Java 包装类。例如（在我脑海中，大脑编译）：

```
class GameEngine {
    private long nativeGameEnginePointer;

    private native long loadEngine();
    public GameEngine() {
        super(...);
        nativeGameEnginePointer = loadEngine();
    }

    private native void destroyEngine(long nativePointer);
    protected void finalize() throws Throwable {
        try {
            destroyEngine(nativeGameEnginePointer);
        } finally {
            super.finalize();
        }
    }

    private native double nativePlayGameOrWhatever(long nativePointer);
    public double playGameOrWhatever() {
        return nativePlayGameOrWhatever(nativeGameEnginePointer);
    }
} 
```

在您的 JNI 实现中：

```
class CxxGameEngine;

JNIEXPORT jlong JNICALL GameEngine_loadEngine(JNIEnv *env, jobject obj) {
     return (jlong)(new CxxGameEngine(params));
}

JNIEXPORT jvoid JNICALL GameEngine_destroyEngine(JNIEnv *env, jobject obj, jlong nativePointer) {
     delete (CxxGameEngine *)nativePointer;
}

JNIEXPORT jdouble JNICALL GameEngine_nativePlayGameOrWhatever(JNIEnv *env, jobject obj, jlong nativePointer) {
     return ((CxxGameEngine *)nativePointer)->playGameOrWhatever();
} 
```

请注意使用`long`来表示本机指针。这就是 Java 运行时在需要时（例如在`java.nio`和`java.util.zip`包中）这样做的方式，`long`而不是`int`确保类型足够宽以容纳即使在 64 位系统上的指针。

# mysql - rails 应用程序在网络浏览器中显示访问被拒绝

> ID：10588344
> 
> 赞同：2
> 
> 时间：2012-05-14T17:38:30.313
> 
> 标签：mysql

```
Access denied for user 'root'@'localhost' (using password: YES) 
```

我设置了一个新环境，其中 mysql 没有密码以及我是如何得到这个错误的。我在哪里改变

```
'root'@'localhost' (using password: YES) 
```

我的 database.yml 显示在下面我的数据库是 sample_app

```
# SQLite version 3.x
#   gem install sqlite3
#
#   Ensure the SQLite 3 gem is defined in your Gemfile
#   gem 'sqlite3'
development:
  adapter: mysql2
  database: db/development.mysql2
  pool: 5
  timeout: 5000
  database: sample_app
  username: root
  socket: /tmp/mysql.sock

# Warning: The database defined as "test" will be erased and
# re-generated from your development database when you run "rake".
# Do not set this db to the same as development or production.
test:
  adapter: mysql2
  database: db/test.mysql2
  pool: 5
  timeout: 5000
  database: sample_app
  username: root
  socket: /tmp/mysql.sock

 production:
  adapter: mysql2
  database: db/production.mysql2
  pool: 5
  timeout: 5000
  database: sample_app
  username: root
  socket: /var/run/mysqld/mysqld.sock 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-05-14T18:10:26.813

您不应该使用 root 连接到带有应用程序的数据库。创建一个具有名称的新用户/密码，以识别它正在用于特定的应用程序\任务，然后使用它而不是 root。

为空密码添加这个`password:`

```
production:
  adapter: mysql2
  database: db/production.mysql2
  pool: 5
  timeout: 5000
  database: sample_app
  username: root
  password:
  socket: /var/run/mysqld/mysqld.sock 
```

如果您仍然拒绝访问，则数据库表示用户\密码无效

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-05-14T19:02:25.133

如果这，

```
 $ mysql -u root 
```

带你到 mysql 然后这将工作，

```
production:
  adapter: mysql2
  database: db/production.mysql2
  pool: 5
  timeout: 5000
  database: sample_app
  username: root
  password:
  socket: /var/run/mysqld/mysqld.sock 
```

如果您为 root 用户设置了一些密码，请尝试

```
$ mysql -u root -p
<<It will prompt for a password, key it in>> 
```

如果这将您带到mysql，那么这将起作用，

```
production:
  adapter: mysql2
  database: db/production.mysql2
  pool: 5
  timeout: 5000
  database: sample_app
  username: root
  password: <<password>>
  socket: /var/run/mysqld/mysqld.sock 
```

**故事的道德启示：**

*首先，尝试从命令行使用 mysql 命令登录 mysql 并查看它是否有效。然后，在 database.yml 中使用这些凭据并从 rails 应用程序登录到 mysql。*

# c# - Treeview 如何保存值

> ID：10588345
> 
> 赞同：0
> 
> 时间：2012-05-14T17:38:35.807
> 
> 标签：c#, winforms, treeview

如何保存树节点上的值？我正在使用 C# Windows 窗体框架 4.0。标签是唯一保存价值的地方吗？我需要保存窗口名称，以便在用户单击它时打开窗口。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-05-14T17:41:31.120

如果您需要在树节点中存储多个值，那么最好的方法是`TreeNode`通过继承您的类来扩展它，并使用您自己的树节点。

```
public class YourTreeNode : TreeNode
{
    public string WindowName { get; set; }
} 
```

或者只是标签并将窗口名称存储在名称中。

# c# - 为asp.net项目中的单个c#文件自动生成文档？

> ID：10588354
> 
> 赞同：7
> 
> 时间：2012-05-14T17:39:31.867
> 
> 标签：c#, visual-studio, documentation

我试图弄清楚如何为 ASP.NET 项目中的单个 c# 文件自动生成文档。我正在使用 VS 2010，并且我有 SandCastle，但我开始觉得它只能用于完整的项目。问题是我们的整个项目非常庞大，只有一个文件需要文档（这是唯一一个具有我们客户使用的功能的文件——其他一切都是内部的）

我可以做一个批处理脚本，但如果有更好的方法来解决这个问题，我宁愿不做！

有人有什么想法吗？首先十分感谢！

（作为旁注，我已经看到了这一点，但没有帮助：[为 WebSite Project 中的单个 VB 类生成 XML 文档](https://stackoverflow.com/questions/4806064/generating-xml-documentation-for-single-vb-class-in-website-project)）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-05-23T14:56:12.040

我推荐使用沙堡。

[http://shfb.codeplex.com/](http://shfb.codeplex.com/)

你可以做的一件事是有一个后期构建任务，从文档文件中提取这部分 XML，然后针对你的新 XML 文件运行 Sandcastle 或 doxygen。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-05-14T20:33:20.710

你试过`StyleCop`吗？它更多地旨在确保一致的编码实践，但确实提供了一个方便的工具，允许您在构造函数、方法或属性等上快速“记录”。可能值得一看，看看它是否是您所追求的。

[风格警察](http://archive.msdn.microsoft.com/sourceanalysis)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-05-14T20:41:30.437

多氧可能会有所帮助。 [http://www.doxygen.nl/](http://www.doxygen.nl/)

至少您可以生成一个 word 或 pdf 文档，然后制作一个仅包含您需要提供的页面的子集。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2016-07-18T21:48:49.523

你可以试试[https://www.docify.net/](https://www.docify.net/)。他们的整个事情就是这样。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2017-06-25T19:37:08.443

我最近制作了一个简单易用的库，可以从 C# 代码生成 markdown 文档。所需要的只是一个类库 dll 文件。
如果您想尝试一下，[这里有一个链接](https://github.com/CBinet/AutoDocumentation "关联")，说明如何开始使用它，并附有生成文档的示例。

更多信息：[https ://www.nuget.org/packages/BetaSoftware.AutoDocumentation](https://www.nuget.org/packages/BetaSoftware.AutoDocumentation)

# php - How Do I replace Specific Text in PHP

> ID：10588358
> 
> 赞同：3
> 
> 时间：2012-05-14T17:39:49.080
> 
> 标签：php

I have some data in the following format.

```
Orange - $3.00
Banana - $1.25 
```

I would like to print this as only as follows:

```
Orange
Banana 
```

I tried using following code in a loop but the data may have 0 in other places as well. So if I can find 0 only at the end for a specific line.

```
$pos=strpos($options, "0");
$options = substr($options, 0, $pos)."\n"; 
```

Any ideas?

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-05-14T17:47:06.347

Are you trying to print only the name of the item and not the price?

```
$n=explode(" - ", "Banana - $1.25");
print $n[0]; 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-05-14T17:48:22.240

Is this what you're looking for?

```
<?php
$input = 'Orange - $3.00';
list($fruit, $price) = explode('-', $input);
?> 
```

Or if you want to proces all the input:

```
<?php
$input = 'Orange - $3.00
Banana - $1.25';
$fruitlist = array();
$sepLines = explode("\n", $input);
foreach($seplines as $line)
{
    list($fruit, $price) = explode(' - ', $line);
    $fruitlist[] = $fruit;
}
?> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-05-14T17:47:06.330

```
$string = explode("-", $originalText);
$word = $string[0]; 
```

and thats it :)

# sql - 使用 SQL 数据填充 SWF

> ID：10588363
> 
> 赞同：0
> 
> 时间：2012-05-14T17:40:08.747
> 
> 标签：sql, actionscript-3, flash, flash-builder

我设计了一个从 XML 文件获取数据并填充数据网格和文本字段的 Flash 应用程序。

我需要访问 SQL 数据库而不是 XML。

你能引导我走向正确的方向吗？我见过 Flash Builder 访问 SQL，但我不确定如何在 SWF 中填充数据网格。SWF 包含地图和其他图形元素和动画。

谢谢。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-05-14T17:50:59.773

简单的答案是您创建一个 PHP 文件来访问数据库并将 MYSQL 数据打印/回显为您的 XML。使用 URLLoader 类，您可以加载此 php 文件并将 xml 作为加载的数据。其余的应该与您现有的应用程序相同。

您可以将 get 变量添加到 URLLoader 中使用的 url 字符串，或者您可以使用 URLVariables 来使用 post 变量将值传递给您的 php 脚本。

# ios - 如何在应用程序外部的屏幕底部显示特定于应用程序的状态栏？

> ID：10588364
> 
> 赞同：1
> 
> 时间：2012-05-14T17:40:12.727
> 
> 标签：ios, ipad

我需要在应用程序底部的某些时间显示状态栏。我可以很容易地将它放在我的应用程序主视图的底部，但是每当我将视图控制器推到它上面时（无论是否以模态方式），它都会隐藏这个状态栏。

有什么办法可以添加这样的状态栏，并让它超出我的应用程序本身的范围吗？理想情况下，我希望它像 iPhone 上的呼叫进行中状态栏一样工作 - 当此栏出现时，应用程序被按下，并且调用`[[UIScreen mainScreen] applicationFrame]`返回正确的大小（即它说明了此状态的存在计算应用程序可用高度时的栏）。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-07-08T21:58:50.507

我也想这样做，所以我尝试了[View Controller Containment](http://developer.apple.com/library/ios/documentation/uikit/reference/UIViewController_Class/Reference/Reference.html#//apple_ref/doc/uid/TP40006926-CH3-SW81)。我还在尝试，所以我不愿意给这个响亮的支持，但如果你在 iOS5 中，你可能会想自己尝试一下。但它似乎为您提供了一个状态栏，该状态栏将在屏幕底部出现或消失。

这是一个视图控制器，它将打开另一个视图控制器，但如果有状态文本要显示，它会从屏幕底部弹出并一直停留在那里，直到你摆脱它。到目前为止我只做了一点测试，但它看起来像这个句柄`pushViewController`/ `popViewController`，但可能不是模态视图。

我的标题看起来像：

```
//  StatusBarViewController.h
//
//  Created by Robert Ryan on 7/8/12.

#import <UIKit/UIKit.h>

@interface StatusBarViewController : UIViewController

@property (strong, nonatomic) UIViewController *appController;

- (void)setStatus:(NSString *)text;

@end 
```

我的实现文件（这是 ARC）看起来像：

```
//  StatusBarViewController.m
//
//  Created by Robert Ryan on 7/8/12.

#import "StatusBarViewController.h"

@interface StatusBarViewController ()
{
    BOOL _statusHidden;
    UIView *_appView;
    UILabel *_statusLabel;
}
@end

@implementation StatusBarViewController

@synthesize appController = _appController;

- (void)dealloc
{
    _appView = nil;
    _statusLabel = nil;

    [self setAppController:nil]; // usually I don't like setters in dealloc, but this does some special stuff
}

- (void)createControlsWithStatusHidden
{
    // create default app view that takes up whole screen

    CGRect frame = self.view.frame;
    frame.origin = CGPointMake(0.0, 0.0);
    _appView = [[UIView alloc] initWithFrame:frame];
    _appView.autoresizingMask = UIViewAutoresizingFlexibleWidth | UIViewAutoresizingFlexibleHeight;
    _appView.clipsToBounds = YES;
    [self.view addSubview:_appView];

    // create status label that is just off screen below the app view

    _statusLabel = [[UILabel alloc] init];
    _statusLabel.font = [UIFont fontWithName:@"Helvetica-Bold" size:12.0];
    _statusLabel.backgroundColor = [UIColor darkGrayColor];
    _statusLabel.textColor = [UIColor whiteColor];
    CGSize size = [@"Hey!" sizeWithFont:_statusLabel.font]; // test size of box with random text
    _statusLabel.frame = CGRectMake(0.0, frame.size.height, frame.size.width, size.height);
    _statusLabel.textAlignment = UITextAlignmentCenter;
    _statusLabel.autoresizingMask = UIViewAutoresizingFlexibleTopMargin | UIViewAutoresizingFlexibleWidth;
    [self.view addSubview:_statusLabel];
}

- (void)viewDidLoad
{
    [super viewDidLoad];

    [self createControlsWithStatusHidden];
    _statusHidden = YES;

    // I'm instantiating from storyboard. If you're using NIBs, just create your controller controller using initWithNib and then set our appController accordingly.

    self.appController = [self.storyboard instantiateViewControllerWithIdentifier:@"MainNavigator"];
}

- (void)setAppController:(UIViewController *)controller
{
    if (controller)
    {
        controller.view.frame = CGRectMake(0.0, 0.0, _appView.frame.size.width, _appView.frame.size.height);
        [self addChildViewController:controller];
        [controller didMoveToParentViewController:self];

        if (self.appController)
        {
            // if we have both a new controller and and old one, then let's transition, cleaning up the old one upon completion

            [self transitionFromViewController:self.appController
                              toViewController:controller
                                      duration:0.5 
                                       options:UIViewAnimationOptionTransitionCrossDissolve | UIViewAnimationOptionCurveEaseInOut
                                    animations:nil
                                    completion:^(BOOL finished){
                                        if (self.appController)
                                        {
                                            [self.appController willMoveToParentViewController:nil];
                                            [self.appController removeFromParentViewController];
                                        }
                                    }];
        }
        else 
        {
            // if we have no previous controller (i.e. this is our first rodeo), then just add it to the view

            [_appView addSubview:controller.view];
        }
    }
    else
    {
        // no new controller, so we're just removing any old on if it was there

        if (self.appController)
        {
            // if there was an old controller, remove it's view, and remove it from the view controller hierarchy

            [self.appController.view removeFromSuperview];
            [self.appController willMoveToParentViewController:nil];
            [self.appController removeFromParentViewController];
        }
    }

    _appController = controller;
}

- (void)hideStatusWithCompletion:(void (^)(BOOL finished))completion
{
    [UIView animateWithDuration:0.25 
                     animations:^{
                         CGRect labelFrame = _statusLabel.frame;
                         labelFrame.origin.y += labelFrame.size.height;
                         _statusLabel.frame = labelFrame;

                         CGRect appFrame = _appView.frame;
                         appFrame.size.height += labelFrame.size.height;
                         _appView.frame = appFrame;
                     }
                     completion:completion];
}

- (void)unhideStatusWithCompletion:(void (^)(BOOL finished))completion
{
    [UIView animateWithDuration:0.25 
                     animations:^{
                         CGRect labelFrame = _statusLabel.frame;
                         labelFrame.origin.y -= labelFrame.size.height;
                         _statusLabel.frame = labelFrame;

                         CGRect appFrame = _appView.frame;
                         appFrame.size.height -= labelFrame.size.height;
                         _appView.frame = appFrame;
                     }
                     completion:completion];
}

- (void)setStatus:(NSString *)text
{
    BOOL hasText = (text && [text length] > 0);

    if (hasText)
    {
        if (!_statusHidden)
        {
            // if we have text, but status is already shown, then hide it and unhide it with new value

            [self hideStatusWithCompletion:^(BOOL finished){
                _statusLabel.text = text;
                [self unhideStatusWithCompletion:nil];
            }];
        }
        else
        {
            // if we have text, but no status is currently shown, then just unhide it
            _statusLabel.text = text;
            [self unhideStatusWithCompletion:nil];
        }
        _statusHidden = NO;
    }
    else
    {
        if (!_statusHidden)
        {
            // if we don't have text, but status bar is shown, then just hide it

            [self hideStatusWithCompletion:^(BOOL finished){
                _statusLabel.text = text;
            }];
            _statusHidden = YES;
        }
    }
}

- (BOOL)shouldAutorotateToInterfaceOrientation:(UIInterfaceOrientation)interfaceOrientation
{
    return (interfaceOrientation != UIInterfaceOrientationPortraitUpsideDown);
}

@end 
```

然后，任何想要更新状态消息的视图控制器都将使用类似的方法：

```
- (void)setStatus:(NSString *)text
{
    UIViewController *controller = [UIApplication sharedApplication].delegate.window.rootViewController;

    if ([controller isKindOfClass:[StatusBarViewController class]])
    {
        [(StatusBarViewController *)controller setStatus:text];
    }
} 
```

# python - 我可以使用 sqlalchemy 在 RowProxy 中分配值吗？

> ID：10588375
> 
> 赞同：19
> 
> 时间：2012-05-14T17:41:29.903
> 
> 标签：python, sqlalchemy

当我想在网页中显示一些数据时，数据需要补，不知道如何实现，代码如下：

```
from sqlalchemy import create_engine

engine = create_engine('mysql://root:111@localhost/test?charset=utf8')
conn = engine.connect()

articles = conn.execute('SELECT * FROM article')
articles = articles.fetchall()

for r in articles:
    r['Tags'] = r['Keywords'] 
```

它提示：“RowProxy”对象不支持项目分配。

我该怎么做？

表“文章”包含“关键字”列，但不包含“标签”列。

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2012-05-14T17:47:09.990

您可以从您的 RowProxy 中制作一个 dict，这将支持项目分配。

例如：

```
result_proxy = query.fetchall()
for row in result_proxy:
    d = dict(row.items())
    d['Tags'] = d['Keywords'] 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2015-05-05T14:42:25.370

一个不错的技巧是使用 dict 的子类：

```
class DBRow(dict):
    def __getattr__(self, key):
        """make values available as attributes"""
        try:
            return self[key]
        except KeyError as error:
            raise AttributeError(str(error))

   @property
   def something_calculated(self):
       return self.a + self.b

row = DBRow(result_proxy_row, additional_value=123)
row["b"] = 2 * row.b
print something_calculated 
```

这样做的好处是，您仍然可以将值作为属性访问，而且您可以拥有属性，这是清理和处理来自数据库的数据的好方法。

# c - 导入 CUnit 源

> ID：10588378
> 
> 赞同：1
> 
> 时间：2012-05-14T17:41:41.387
> 
> 标签：c, unit-testing, configure, cunit

我在 C 中使用单元测试时遇到问题，我尝试在我的计算机中安装 CUnit，然后包含 lib。

我已经按照陡峭的方式安装了 CUnit：

```
1 - download the sources
2 - configure it using "./configure --prefix='/lib' "
3 - make (only make)
4 - sudo make install 
```

这是我的测试源文件，它没有进行测试，但我无法编译它，我在“CUnit.h：没有这样的文件或目录”之前收到了这个错误：

```
#include "CUnit.h"
#include <stdlib.h>
#include <stdio.h>

int main(){

    print("Hello");

    return 0;
} 
```

我想知道，如何安装 CUnit 以在我的测试源文件中使用！

提前致谢。

**编辑**

哈哈，我收到了！

我只是运行不带参数的配置，如下所示：

```
"./configure" 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-05-14T17:56:11.687

如[代码示例](http://cunit.sourceforge.net/example.html)所示，您应该使用如下内容：

```
#include <CUnit/CUnit.h> 
```

因为每个 CUnit 包含都位于一个 CUnit 子目录中（通常在`/usr/local/include/CUnit`）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2013-03-08T15:01:46.767

添加`-I/lib/include`标志以包含已安装的头文件`/lib/include/CUnit`并`-lcunit -L/lib/CUnit/lib`与已安装的库链接怎么样？

`gcc test_file_source.c -I/lib/include -lcunit -L/lib/CUnit/lib -o testing`

# winforms - 如何确定 RichTextBox 中最后一行的文本高度？

> ID：10588380
> 
> 赞同：2
> 
> 时间：2012-05-14T17:42:20.920
> 
> 标签：winforms, richtextbox

我正在创建一个扩展的 RichTextBox 控件，在其中我在文本行旁边绘制图标。我是用GetPositionFromCharIndex查找当前行和下一行的Y坐标，这样就可以确定当前行的高度和中间。当遇到最后一行时，此方法显然停止工作，因为没有下一行。有没有办法确定最后一行文本的高度？请注意，字体大小可能因行而异。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-05-14T18:40:57.427

不容易做到。 *也许*有一个 API 调用，但我不是 100% 确定。

实现这一点的一个 hacky 方法是使用屏幕外 RichTextBox 控件并将 RTF 属性传输给它，它*恰好*在末尾为您附加了一个额外的 \par ，所以现在有一个额外的行：

```
using (RichTextBox r = new RichTextBox()) {
  r.SelectAll();
  r.SelectedRtf = richTextBox1.Rtf;
  for (int i = 1; i < r.Lines.Length; i++) {
    Point p1 = r.GetPositionFromCharIndex(r.GetFirstCharIndexFromLine(i - 1));
    Point p2= r.GetPositionFromCharIndex(r.GetFirstCharIndexFromLine(i));
    int height = p2.Y - p1.Y;
    MessageBox.Show(String.Format("Line #{0} height = {1}", i - 1, height));
  }
} 
```

# types - OCaml：签名中的类型约束

> ID：10588382
> 
> 赞同：6
> 
> 时间：2012-05-14T17:42:23.473
> 
> 标签：types, ocaml, signature, type-constraints

在我的代码中，我有一个提供基本读/写操作的**数据库访问上下文**，称为`CouchDB.ctx`. 然后，我的应用程序中的各种模块使用附加功能扩展该类，例如`Async.ctx`.

我正在实现一个`Cache`包裹在模块周围的`Source`模块。`Cache`模块函数采用上下文参数并操作数据库。然后将一些调用`Source`与上下文一起转发到模块。

我需要按照以下方式定义一个仿函数：

```
module CouchDB = struct
  class ctx = object
    method get : string -> string option monad 
    method put : string -> string -> unit monad
  end
end

module AsyncDB = struct
  class ctx = object
    inherit CouchDB.ctx
    method delay : 'a. float -> (ctx -> 'a monad) -> 'a monad 
  end
end

module type SOURCE = sig
  class ctx = #CouchDB.ctx (* <-- incorrect *)
  type source
  val get : source -> ctx -> string monad
end

module Cache = functor(S:SOURCE) -> struct
  class ctx = S.ctx
  type source = S.source
  let get source ctx = 
    bind (ctx # get source) (function 
     | Some cache -> return cache
     | None -> 
       bind (S.get source ctx) 
         (fun data -> bind (ctx # put source data) 
                        (fun () -> return data)) 
end

module SomeSource = struct
  class ctx = AsyncDB.ctx
  type source = string
  let get s ctx = 
    ctx # async 300 (some_long_computation s)
end

module SomeCache = Cache(SomeSource) 
```

问题是我无法表达`Source`模块使用的上下文应该是`CouchDB.ctx`. 上面的代码返回错误：

```
A type variable is unbound in this type declaration.
In type #CouchDB.ctx as 'a the variable 'a is unbound 
```

如何表达这种类型约束？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2012-05-14T18:04:56.540

[过时的...

您可以获得的最接近的是将签名定义为：

```
module type SOURCE = sig
  type 'a ctx = 'a constraint 'a = #CouchDB.ctx
  type source
  val get : source -> 'a ctx -> string 
end 
```

但是，当然，您也可以只写：

```
module type SOURCE = sig
  type source
  val get : source -> #CouchDB.ctx -> string 
end 
```

编辑：请注意，OCaml 对对象使用*结构*类型。这意味着即使您想要，您也无法获得比上述更多的限制。它甚至不将参数限制`get`为实例`CouchDB.ctx`或派生类——任何具有（至少）相同方法的对象都是兼容的。即使你写

```
 val get : source -> CouchDB.ctx -> string 
```

您可以传递*任何*具有相同方法的对象。该类型`CouchDB.ctx`只是特定结构对象类型的缩写，它恰好与同名类生成的对象相匹配。它不限于那些。只是为了确定：这被认为是一个功能。

======]

编辑 2：通过扩展示例，我现在看到了您想要什么以及为什么。不幸的是，这在 OCaml 中是不可能的。您将需要*部分抽象*类型。也就是说，您需要能够编写

```
module type SOURCE = sig
  type ctx < CouchDB.ctx
  ...
end 
```

这在 OCaml 中不可用。但是，如果您愿意在签名中提供明确的向上转换，则可以接近：

```
module type SOURCE = sig
  type ctx
  val up : ctx -> CouchDB.ctx
  type source = string
  val get : source -> ctx -> string monad
end 
```

然后，在 中`Cache`，您必须将出现的 替换为`ctx#get`，`(S.up ctx)#get`同样地替换为`ctx#put`。

```
module Cache = functor (S:SOURCE) -> struct
  type ctx = S.ctx
  type source = S.source
  let get source ctx = 
     bind ((S.up ctx)#get source) ...
end

module SomeSource = struct
  type ctx = AsyncDB.ctx
  let up ctx = (ctx : ctx :> CouchDB.ctx)
  type source = string
  let get s ctx = ...
end

module SomeCache = Cache (SomeSource) 
```

请注意，我还在`type source = string`签名中设置了透明`SOURCE`。没有它，我看不出怎么`ctx#get source`可能在`Cache`函子中进行类型检查。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-05-14T18:45:48.360

除非我误解了你所追求的，否则这应该可以解决问题：

```
module type SOURCE = sig
  class ctx : CouchDB.ctx
  type source
  val get : source -> ctx -> string
end 
```

`class ctx : CouchDB.ctx`是一个[类规范](http://caml.inria.fr/pub/docs/manual-ocaml/manual017.html#class-specification)。OCaml 文档将它们描述为

> 这是类定义签名中的对应物。如果类规范具有相同的类型参数并且它们的类型匹配，则类规范与类定义匹配。

还有这个

```
module type SOURCE = sig
  class type ctx = CouchDB.ctx
  type source
  val get : source -> ctx -> string
end 
```

这是微妙的不同。前者需要模块中的真实类定义，后者接受类定义或类类型定义（即类类型别名）。

# java - 用另一个非空文件覆盖数据库文件

> ID：10588383
> 
> 赞同：0
> 
> 时间：2012-05-14T17:42:25.817
> 
> 标签：java, android, file

我正在尝试这个覆盖文件：

```
File file = new File(importDir, dbFile.getName());
DataOutputStream output = new DataOutputStream(
new FileOutputStream(file, false));                 
output.close(); 
```

但它显然用一个新的空文件覆盖了一个旧文件，我的目标是用提供的内容覆盖它`file`

我该如何正确地做到这一点？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-05-14T17:56:51.827

不幸的是，像文件复制这样简单的操作在 Java 中并不明显。

在 Java 7 中，您可以使用 NIO util 类[文件](http://docs.oracle.com/javase/7/docs/api/java/nio/file/Files.html)，如下所示：

```
Files.copy(from, to); 
```

否则它更难，而不是大量的代码，最好仔细阅读这个[用Java复制文件的标准简洁方法？](https://stackoverflow.com/questions/106770/standard-concise-way-to-copy-a-file-in-java)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-05-14T17:45:52.960

```
 BufferedReader br = new BufferedReader(new InputStreamReader(System.in));
    String str;
    System.out.print("Enter a file name to copy : ");
    str = br.readLine();

    int i;
    FileInputStream f1;
    FileOutputStream f2;

  try
  {
    f1 = new FileInputStream(str);
    System.out.println("Input file opened.");
  }
  catch(FileNotFoundException e)
  {
    System.out.println("File not found.");
    return;
  }

  try
  {
    f2 = new FileOutputStream("out.txt");    //    <---   out.txt  is  newly created file
    System.out.println("Output file created.");
  }
  catch(FileNotFoundException e)
  {
    System.out.println("File not found.");
    return;
  }

  do
  {
    i = f1.read();
    if(i != -1) f2.write(i);
  }while(i != -1);
  f1.close();
  f2.close();
  System.out.println("File successfully copied"); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-05-14T17:50:14.393

您可以使用

> FileOutputStream fos = new FileOutpurStream(file);
> 
> fos.write(string.getBytes());

构造函数将创建新文件，或者如果已经存在则覆盖它......

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-05-14T20:20:33.230

就我的目的而言，似乎最简单的方法是删除文件然后复制它

```
 if (appFile.exists()) {
                appFile.delete();
                appFile.createNewFile();
                this.copyFile(backupFile, appFile); 
```

# regex - 从html中提取城市状态和国家的正则表达式

> ID：10588389
> 
> 赞同：0
> 
> 时间：2012-05-14T17:42:58.170
> 
> 标签：regex, web-scraping

我正在使用 Outwit hub 为城市、州和国家（仅限美国和加拿大）抓取网站。通过该程序，我可以使用正则表达式来定义我希望抓取的文本**之前和之后的标记。**我还可以为所需文本定义格式。

这是一个html示例：

```
<td width="8%" nowrap="nowrap"></td>                        
<td width="22%" nowrap="nowrap"><strong>
BILLINGS, MT
USA</strong></td>
<td width="10%" align="right" nowrap="nowrap"> 
```

我已经设置了我的 reg.ex。如下：

**CITY - 之前** *（未格式化为正则表达式）*

```
<td width="22%" nowrap="nowrap"><strong> 
```

**CITY - 之后** *（说明州、领地和普罗旺斯）*

```
/(,\s|\bA[BLKSZRAEP]\b|\bBC\b\bC[AOT]\b|\bD[EC]\b|\bF[LM]\b|\bG[AU]\b|\bHI\b|\bI[ADLN]\b|\bK[SY]\b|\bLA\b|\bM[ABDEHINOPST]\b|\bN[BLTSUCDEHJMVY]\b|\bO[HKNR]\b|\bP[AERW]\b|\bQC\b|\bRI\b|\bS[CDK]\b|\bT[NX]\b|\bUT\b|\bV[AIT]\b|\bW[AIVY]\b|\bYT\b|\bUSA|\bCanada)/ 
```

**状态 - 之前**

```
\<td width="22%" nowrap="nowrap"\>\<strong\>\s|,\s 
```

**状态 - 之后**

```
/\bUSA\<\/strong\>\<\/td\>|\bCanada\<\/strong\>\<\/td\>/ 
```

**状态 - 格式**

```
/\b[A-Z][A-Z]\b/ 
```

**国家 - 之前** *（说明州、领地和普罗旺斯）*

```
/(\bA[BLKSZRAEP]\b|\bBC\b\bC[AOT]\b|\bD[EC]\b|\bF[LM]\b|\bG[AU]\b|\bHI\b|\bI[ADLN]\b|\bK[SY]\b|\bLA\b|\bM[ABDEHINOPST]\b|\bN[BLTSUCDEHJMVY]\b|\bO[HKNR]\b|\bP[AERW]\b|\bQC\b|\bRI\b|\bS[CDK]\b|\bT[NX]\b|\bUT\b|\bV[AIT]\b|\bW[AIVY]\b|\bYT\b)\s/ 
```

**国家 - 之后** *（未格式化为正则表达式）*

```
</strong></td><td width="10%" align="right" nowrap="nowrap"> 
```

当没有列出城市或州时，就会出现问题。我试图解释这一点，但只是让情况变得更糟。有什么办法可以清理它并仍然考虑丢失信息的可能性？谢谢你。

没有城市的例子：

```
<td width="8%" nowrap="nowrap"></td>                        
<td width="22%" nowrap="nowrap"><strong>
MT
USA</strong></td>
<td width="10%" align="right" nowrap="nowrap"> 
```

没有城市/州的示例：（是的，有一个额外的换行符）

```
<td width="8%" nowrap="nowrap"></td>                        
<td width="22%" nowrap="nowrap"><strong>

USA</strong></td>
<td width="10%" align="right" nowrap="nowrap"> 
```

感谢您提供任何帮助。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-05-16T21:28:58.267

如果您拥有专业版，您可以执行以下操作：

```
Description: Data
Before: <td width="22%" nowrap="nowrap"><strong>
After: </strong>
Format: (([\w \-]+),)? ?([A-Z]{2})?[\r\n](USA|canada)\s*
Replace: \2##\3##\4
Separator: ##
Labels: City,State,Country 
```

如果您使用的是轻量版，则必须分三行进行：

```
Description: City
Before: <td width="22%" nowrap="nowrap"><strong>
After: ,
Format: [^<>]+

Description: State
Before: /<td width="22%" nowrap="nowrap"><strong>[\r\n]([^<>\r\n ]+,)?/
After: /[\r\n]/
Format: [A-Z]{2}

Description: Country
Before:
After: </strong></td>
Format: (USA|canada) 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-05-14T19:11:04.263

TXR 文本抓取，数据处理语言：

```
@(collect)
<td width="8%" nowrap="nowrap"></td>
<td width="22%" nowrap="nowrap"><strong>
@  (cases)
@city, @state
@  (or)

@    (bind (city state) ("n/a" "n/a"))
@  (or)
@state
@    (bind city "n/a")
@  (end)
@country</strong></td>
<td width="10%" align="right" nowrap="nowrap">
@(end)
@(output)
CITY       STATE       COUNTRY
@  (repeat)
@{city 10} @{state 11} @country
@  (end)
@(end) 
```

该文件`city.html`包含串联在一起的树案例。跑：

```
$ txr city.txr  city.html
CITY       STATE       COUNTRY
BILLINGS   MT          USA
n/a        MT          USA
n/a        n/a         USA 
```

TXR HTML 抓取的另一个例子：[Extract text from HTML Table](https://stackoverflow.com/questions/10055385/extract-text-from-html-table)

# mysql - 有没有更简单的方法来实现这种用户消息传递方式？

> ID：10588391
> 
> 赞同：28
> 
> 时间：2012-05-14T17:43:05.270
> 
> 标签：mysql, sql, database, database-design, innodb

我为用户创建了一个消息系统，它允许他们向另一个用户发送消息。如果这是他们第一次说话，则开始新的对话，如果不是，则继续旧的对话。

用户收件箱列出了用户与所有其他用户的所有对话，然后按其中包含最新帖子的对话排序。

一个用户只能与另一个用户进行一次对话。

当用户单击其中一个对话时，他们会被带到一个页面，该页面显示他们进行过的整个对话，最新帖子位于顶部。所以它有点像消息聊天功能。

我有两张桌子：

*   用户对话
*   用户留言

**用户对话**

包含一个自动增量 id，它是对话 id，以及 userId 和friendId。

发起第一个对话的人将始终是 userId 和接收者friendId，那么该对话将永远不会改变。

```
+----+--------+----------+
| id | userId | friendId |
+----+--------+----------+ 
```

**用户留言**

包含特定消息，以及读取标志、时间和会话 ID

```
+----+---------+--------+------+------+----------------+
| id | message | userId | read | time | conversationId |
+----+---------+--------+------+------+----------------+ 
```

**这个怎么运作**

当用户向另一个用户发送消息时，将运行查询以检查两个用户是否在 userconversation 表中具有匹配项，如果使用了匹配项`conversationId`并继续对话，如果没有为他们创建具有唯一性的新行`conversationId`。

**复杂的地方**

到目前为止一切都很好，但是在显示所有对话的消息收件箱时，按最新帖子排序，使用一个查询会变得很棘手。

为了能够列出对话，您必须首先找到每个对话的最新帖子，但是由于您不能在组之前排序，因此不可能对两个表进行一次查询，因此我必须使用以下内容：

```
SELECT  
    c.id,
    c.userId,
    c.friendId,
    m2.message,
    m2.read,
    UNIX_TIMESTAMP(m2.time),      
    user1.username,
    user2.username  
FROM 
    (SELECT MAX(m1.id) AS MessageID 
     FROM usermessages m1 
     GROUP BY m1.conversationId) latest_msg

INNER JOIN usermessages m2 ON latest_msg.MessageID = m2.id 
INNER JOIN userconversation c ON m2.conversationId = c.id
INNER JOIN user user1 ON c.userId = user.id
INNER JOIN user user2 ON c.friendId = user.id

WHERE c.userId = :userId OR c.friendId = :userId
ORDER BY m2.id DESC
LIMIT 10 
```

我只是不认为这是可以做到的最好方法，但想不出其他方法也可以做到吗？

数据库表是 InnoDB 以加快连接并提高数据完整性，因此我不能有两个自动增量行。

有没有另一种方法可以摆脱 userconversation 表并创建一个唯一的 Id 放入 conversationId 列？然后我可以将 userId 和friendId 移到 usermessages ...但这会产生很多冗余数据？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2012-05-14T18:16:20.240

嗯，也许我没有正确理解你的问题......但对我来说，解决方案很简单：

```
SELECT c.*, MAX(m.time) as latest_post 
FROM conversations as c 
INNER JOIN messages as m ON c.id = m.conversation_id
WHERE c.userId = 222 OR c.friendId = 222 
GROUP BY c.id
ORDER BY latest_post DESC 
```

这是我的测试数据：

**对话：**

```
id  userId  friendId
1   222     333
2   222     444 
```

**留言：**

```
id  message     time (Desc)     conversation_id
14  rty     2012-05-14 19:59:55     2
13  cvb     2012-05-14 19:59:51     1
12  dfg     2012-05-14 19:59:46     2
11  ert     2012-05-14 19:59:42     1
1   foo     2012-05-14 19:22:57     2
2   bar     2012-05-14 19:22:57     2
3   foo     2012-05-14 19:14:13     1
8   wer     2012-05-13 19:59:37     2
9   sdf     2012-05-13 19:59:24     1
10  xcv     2012-05-11 19:59:32     2
4   bar     2012-05-10 19:58:06     1
6   zxc     2012-05-08 19:59:17     2
5   asd     2012-05-08 19:58:56     1
7   qwe     2012-05-04 19:59:20     1 
```

**查询结果：**

```
id  userId  friendId    latest_post
2   222     444     2012-05-14 19:59:55
1   222     333     2012-05-14 19:59:51 
```

如果不是这样......请忽略我的回答：P

希望这可以帮助

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2012-05-14T18:03:20.687

如果您正在寻求一种能够保留所有当前功能和工作流程的方法，同时将数据保留在一个表中，我认为您已经非常接近了。

与其让`conversationId`key 指向不同的表，不如让它指向开始对话的消息的 ID。这将在开始对话的消息和随后的所有消息之间创建父子关系。为了能够查看所有对话，您只需选择`conversationId`为空的所有消息。下面是 2 条消息对话的表示：

```
+----+---------+------+------------------+----------------+--------+----------+
| id | message | read | time             | conversationId | toUser | fromUser |
+----+---------+------+------------------+----------------+--------+----------+
| 1  |  test 1 |  0   | (some timestamp) |  null          |  3     |   4      |
| 2  |  test 2 |  0   | (some timestamp) |   1            |  4     |   3      |
+----+---------+------+------------------+----------------+--------+----------+ 
```

对话由用户 3 发起。对话中的所有消息都可以通过 过滤`conversationId`。这种设计的一个限制是只有 2 个用户可以在对话之外。

**更新**

您可以通过以下方式获取给定对话 id 的最后一条消息：

```
SELECT id, message 
FROM userMessages 
WHERE conversationId = {conversationId} 
ORDER BY time DESC 
LIMIT 1 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2012-05-17T20:56:34.157

如果你想简化你的查询，你应该在你的表中添加最后一个消息 id `userconversation`：

```
ALTER TABLE userconversation ADD lastusermessageid 
```

然后每次添加新消息时，都应该更新表 userconversation ：

```
INSERT INTO userconversation(userId, friendId, lastusermessageid)
VALUES (:userId, :friendId, :lastusermessageid)
ON DUPLICATE KEY UPDATE lastusermessageid = VALUES(lastusermessageid) 
```

最后在所有外键上添加索引：

```
SELECT  
    c.id,
    c.userId,
    c.friendId,
    m.message,
    m.read,
    UNIX_TIMESTAMP(m.time),      
    user1.username,
    user2.username  
FROM 
    userconversation c
    INNER JOIN usermessages m ON c.lastusermessageid = m.id 
    INNER JOIN user user1 ON c.userId = user.id
    INNER JOIN user user2 ON c.friendId = user.id
WHERE 
    c.userId = :userId OR c.friendId = :userId
ORDER BY
    m.id DESC
LIMIT 10 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2012-05-23T21:00:34.987

由于给定的一对用户最多可以进行一次对话，因此无需“发明”单独的密钥来识别对话。此外，您问题的措辞似乎表明一条消息总是发送给单个用户，所以我可能会采用这样的方式：

![在此处输入图像描述](../Images/3d787d3743689b9fe4a250a84270a808.png)

现在，关于这个模型有几点需要注意：

*   它假定相同的两个用户之间的消息生成的频率不能高于用于 SEND_TIME 的类型提供的分辨率。¹
*   消息的方向不是由 USER1_ID 和 USER2_ID 的顺序决定的，而是有一个单独的标志（DIRECTION）。这样，给定用户之间的消息将始终具有相同的 USER1_ID 和 USER2_ID 组合（由上面的 CHECK 强制执行），无论谁发送和接收消息。这大大简化了查询。
*   不幸的是，[所有的 InnoDB 表都是集群](http://www.ovaistariq.net/521/understanding-innodb-clustered-indexes/)的，所以二级索引`I1`相对[昂贵](https://stackoverflow.com/questions/10427847/primary-indexes-vs-secondary-indexes-performance-differences/10720128#10720128)。有办法解决这个问题，但由此产生的并发症可能不值得。

使用此数据模型，通过最新消息对“对话”（由用户对标识）进行排序变得相当容易。例如（替换`1`为所需用户的 USER_ID）：

```
SELECT *
FROM (
    SELECT USER1_ID, USER2_ID, MAX(SEND_TIME) NEWEST
    FROM MESSAGE
    WHERE (USER1_ID = 1 OR USER2_ID = 1)
    GROUP BY USER1_ID, USER2_ID
) Q
ORDER BY NEWEST DESC; 
```

*（`OR USER2_ID = 1`是二级索引的原因`I1`。）*

如果您不仅想要最新时间，还想要最新消息，您可以执行以下操作：

```
SELECT * FROM MESSAGE T1
WHERE
    (USER1_ID = 1 OR USER2_ID = 1)
    AND SEND_TIME = (
        SELECT MAX(SEND_TIME)
        FROM MESSAGE T2
        WHERE
            T1.USER1_ID = T2.USER1_ID
            AND T1.USER2_ID = T2.USER2_ID
    )
ORDER BY SEND_TIME DESC; 
```

您可以在[SQL Fiddle](http://sqlfiddle.com/#!2/7d689/6)中使用它。

* * *

¹如果不是这种情况，您可以改用单调递增的 INT，但您必须`SELECT MAX(...)`自己使用，因为自动递增不适用于 PK 子集；或者干脆让它*单独*PK并在 USER1_ID 和 USER2_ID 上都有二级索引（幸运的是，它们会更苗条，因为 PK 更苗条）。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2012-05-14T18:09:41.340

如果您只能在用户之间进行一次对话，我认为没有理由使用专用对话表。要使此查询快速运行，您将需要一个复合索引，`(user, message_id)`如果这些字段位于不同的表中，则无法使用该索引。移动到. `user_id`_ 这将使每条记录的表字节数变重（即使假设为 -byte 标识符），这对于包含文本消息的表来说几乎不是问题。`friend_id``userconversations``8``8`

如果每个用户的对话很少，每个用户有很多消息，请使用：

```
SELECT  um.*
FROM    (
        (
        SELECT  MAX(id) AS messageId
        FROM    usermessages m1
        WHERE   user_id = :me
        GROUP BY
                friend_id
        ORDER BY
                messageId DESC
        LIMIT 10
        )
        UNION ALL
        (
        SELECT  MAX(id) AS messageId
        FROM    usermessages m1
        WHERE   frient_id = :me
        GROUP BY
                user_id
        ORDER BY
                messageId DESC
        LIMIT 10
        )
        ) q
JOIN    usermessages um
ON      um.id = q.messageId
ORDER BY
        id DESC
LIMIT 10 
```

`user_id`在和上创建单独的索引`friend_id`

如果您有很多对话，每个对话中的消息很少，请使用以下查询：

```
(
SELECT  *
FROM    usermessages um
WHERE   user_id = :me
        AND id = 
        (
        SELECT  MAX(id)
        FROM    usermessages umi
        WHERE   umi.user_id = um.user_id
                AND umi.friend_id = um.friend_id
        )
ORDER BY
        id DESC
LIMIT 10
)
UNION ALL
(
SELECT  *
FROM    usermessages um
WHERE   frient_id = :me
        AND id = 
        (
        SELECT  MAX(id)
        FROM    usermessages umi
        WHERE   umi.user_id = um.user_id
                AND umi.friend_id = um.friend_id
        )
ORDER BY
        id DESC
LIMIT 10
)
ORDER BY
        id DESC
LIMIT 10 
```

这个查询背后的想法是，它只是对给定用户的所有消息进行下降，检查每条消息是否是其对话中的最后一条。这可能比为所有对话（如果你有很多）排序所有最后的消息要快得多。

为了快速工作，请在

```
friend_id
user_id, friend_id 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2012-05-22T12:50:30.373

我没有测试过这种方法，因为我现在无法访问 mysqldb。但是，我认为您应该能够通过使用排名功能来完成这项工作。由于 mysql 没有相当于 Oracle 的 row_number 函数，我认为你可以这样做：

```
Select * from (
Select 
    uc.id, 
    uc.user_id, 
    uc.friend_id 
    um.message
    um.read, 
    um.time,
    @rownum := IF(@prev_val = um.conversation_id, @rownum + 1, 1) AS rank,
    @prev_val := um.conversation_id
From
    userconversation uc,
    usermessages um,
    (select @row_num:=1) rows,
    (select @prev_val:='') partitions
Where 
    uc.id=um.conversation_id        
    and c.userId = 222 OR c.friendId = 222 

Order By 
    um.conversation_id,um.id desc
)t where t.rank=1 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2012-05-14T18:22:20.713

你为什么要把数据分解成对话？

如果是我，我会使用一个名为“usermessages”的表格，格式如下：

```
+----+--------+----------+-------------+------------+--------+
| id | userto | userfrom | timecreated | timeviewed | message|
+----+--------+----------+-------------+------------+--------+ 
```

对话由“userto”和“userfrom”列的组合来标识。因此，当您要选择所有对话时：

```
SELECT * FROM usermessages 
WHERE (userto = :userto OR userto = :userfrom) 
AND (userfrom = :userfrom OR userfrom = :userto) 
ORDER BY timecreated DESC 
LIMIT 10 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2012-05-20T10:14:38.230

它在 Fiverr.com 和[www.infinitbin.com](http://www.infinitbin.com)上使用。我自己开发了infinitbin。它也有两个像你一样的数据库。收件箱表：-

```
+----+--------+----------+-------------+------------+--------------------------------+
| id | useridto | useridfrom | conversation | last_content | lastviewed | datecreated|
+----+--------+----------+-------------+------------+--------------------------------+ 
```

此表非常重要，用于列出对话/收件箱。last_content 字段是对话之间最后一条消息的 140 个字符。lastviewed 是一个整数字段，如果会话中的其他用户阅读了该消息，则最后发送消息的用户是最后查看的用户。它被更新为 NULL。因此，要获得通知，您的 lastviewed 不为空，也不是登录用户的 id。

对话字段是'userid-userid'，因此是字符串。要检查用户是否已经开始对话，您可以将 user_ids 与连字符连接起来并检查它。

这种消息传递系统是一个非常复杂的系统。

第二张表很简单。

```
+----+--------+----------+-------------+-------+
| id | inboxid | userid | content | datecreated|
+----+--------+----------+-------------+-------+ 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2012-05-24T17:34:06.020

我认为您不需要创建用户对话表。

如果只有用户只能与某人进行一次对话，则此线程的唯一 id 是 userId 和friendId 之间的连接。所以我在 usersmessage 表中移动了friendId 列。顺序问题（friendId-userId是userId-friendId的同一个线程）可以这样解决：

```
SELECT CONCAT(GREATEST(userId,FriendId),"_",LEAST(userId,FriendId)) AS threadId 
```

现在有一个在 GROUP BY threadId 之后获取最后一条消息的问题。

我认为是一个很好的解决方案，在 DATE 和消息之间以及在该字段上的 MAX 之后进行连接。

为简单起见，我假设列日期是 DATETIME 字段（'YYYY-mm-dd H:i:s'），但它不需要，因为有 FROM_UNIXTIME 函数。

所以最后的查询是

```
SELECT 
        CONCAT(GREATEST(userId,FriendId),"_",LEAST(userId,FriendId)) AS threadId,
        friendId, MAX(date) AS last_date, 
        MAX(CONCAT(date,"|",message)) AS last_date_and_message 

FROM usermessages
WHERE userId = :userId OR friendId = :userId
GROUP BY threadId ORDER BY last_date DESC 
```

字段 last_date_and_message 的结果是这样的：

```
2012-05-18 00:18:54|Hi my friend this is my last message 
```

它可以简单地从您的服务器端代码中解析出来。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2012-05-14T18:05:44.200

如何创建一个快速的类似 Facebook 的消息系统。经 Arutz Sheva 用户测试并广泛使用 - [http://www.inn.co.il](http://www.inn.co.il)（希伯来语）。

1.  创建一个“主题”（对话）表：

    ```
      CREATE TABLE pb_topics(
       t_idint(11) NOT NULL AUTO_INCREMENT,
       t_lastint(11) NOT NULL DEFAULT '0',
       t_userint(11) NOT NULL DEFAULT '0',
      主键 ( t_id),
      键last( t_last)
    ) 引擎=InnoDB AUTO_INCREMENT=137106342 默认字符集=utf8
    ```

2.  在用户和对话之间创建链接：

    ```
        CREATE TABLE pb_links(
       l_idint(11) NOT NULL AUTO_INCREMENT,
       l_userint(11) NOT NULL DEFAULT '0',
       l_newint(11) NOT NULL DEFAULT '0',
       l_topicint(11) NOT NULL DEFAULT '0',
       l_visibleint(11) NOT NULL默认“1”，
       l_bccint(11) 非空默认“0”，l_id使用 BTREE 的
      主键 ( )，
      唯一键topic-user( l_topic, l_user),使用 BTREE 的
      键user-topicnew( l_user, l_new, ),l_topic使用 BTREE的
      键user-topic( l_user, l_visible, )l_topic
    ) 引擎=InnoDB AUTO_INCREMENT=64750078 默认字符集=utf8
    ```

3.  创建消息

    ```
        CREATE TABLE pb_messages(
       m_idint(11) NOT NULL AUTO_INCREMENT,
       m_fromint(11) NOT NULL,
       m_datedatetime NOT NULL DEFAULT '1987-11-13 00:00:00',
       m_titlevarchar(75) NOT NULL,
       m_contentmediumtext NOT NULL,
       m_topicint(11)非空，
      主键 ( m_id),
      键date_topic( m_date, m_topic),
      键topic_date_from( m_topic, m_date, m_from)
    ) 引擎=InnoDB
    ```

可以与 2 个或更多朋友进行对话（像电子邮件一样添加密件抄送，但您可以跳过它）。

插入新消息： 1\. 创建新主题 2\. 为用户创建链接（从/到） 3\. 添加消息（4\. 更新用户缓存表 - 用户有消息）

向主题添加消息：添加消息

选择文件夹：

```
select 
     z.*, group_concat(u_name) as users_name from
         (select max(m_id) as m_id, m_topic as t_id,  m_From, m_title,m_date, l_new 
              from pb_links as l1, pb_messages 
              where l1.l_user=<user>  and m_from < If(inbox, "<>", "=") > and m_topic=l_topic and l1.l_visible=1 
               group by m_topic order by m_id desc limit " & iPage * 35 & ",35) z
           left join  pb_links l2  on (l2.l_topic=t_id)
           left join  users  on (l_user=u_id and l_bcc=0 and l_user<user>)  
            group by l_topic order by m_date desc; 
```

详细说明：

第一个是内部选择 - 这是最快的方式（我检查了大约 7 个其他选项，也在 Percona/MariaDB 版本中检查）获取所有消息，并获取最后一条显示在列表中的消息。还要查看内部 IF - 在收件箱中，最后一条消息是任何人，但不是我，而在发件箱中 - 相反。LIMIT 用于分页。

外部用于添加用户列表（只是名称逗号名称字符串）和更多信息，每个主题**只有一条消息，并且****在分页之后**（我需要将用户列表添加到每页 35 条消息，而不是我的所有历史悠久）。

另外，我在这里用希伯来语写了：http: [//blogs.microsoft.co.il/blogs/moshel/archive/2010/08/12/quot-x-quot.aspx](http://blogs.microsoft.co.il/blogs/moshel/archive/2010/08/12/quot-x-quot.aspx) 创建一个简单的缓存表，并禁止工作量从忙碌消息表中选择计数。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2012-05-24T15:05:50.553

我会这样设置

## 表详细信息

```
conversations (#id, last_message_id)

participation (#uid1, #uid2, conversation_id)

messages (#conversation_id, #id, uid, contents, read, *time) 
```

**对话**

该表将主要用于为每个对话生成一个新的标识符，以及最后一次更新的计算字段（用于优化）。这两个用户已与此表断开连接并移至`participation`。

**参与**

**该表记录了两个用户之间的双向**对话；要解释原因，请查看以下键：

```
ALTER TABLE `table` ADD PRIMARY(uid1, uid2); 
```

虽然这对强制唯一性和简单查找都有好处，但您应该注意以下行为：

*   `SELECT * FROM table WHERE uid1=1 AND uid2=2`
*   `SELECT * FROM table WHERE uid1=1`
*   `SELECT * FROM table WHERE uid1=1 AND uid2>5`
*   `SELECT * FROM table WHERE uid2=2`

前两个查询执行得非常好，MySQL 还优化了密钥第一部分的身份查找。第三个也产生了相当不错的性能，因为您的密钥的第二部分可用于范围查询。最后一个查询表现不佳，因为索引是“左偏”的，因此它执行全表扫描。

**消息**

该表存储实际发送的消息，包括会话标识符、发送者 ID、内容、读取标志和发送时间。

## 手术

**发送消息**

要确定两个用户之间的对话是否已经建立，您可以简单地查询`participation`表：

```
SELECT conversation_id FROM participation WHERE uid1=:sender_id AND uid2=:receiver_id 
```

如果它尚不存在，则创建两条记录：

```
INSERT INTO conversations (last_message_id) VALUES (NULL);
# fetch last insert id here
INSERT INTO participation VALUES (:sender_id, :receiver_id, :conversation_id), (:receiver_id, :sender_id, :conversation_id);
INSERT INTO messages VALUES (:conversation_id, 0, :sender_id, :message_contents, 0, NOW());
UPDATE conversations SET last_message_id=LAST_INSERT_ID() WHERE id = :conversation_id 
```

如果对话已经建立： INSERT INTO messages VALUES (:conversation_id, 0, :sender_id, :message_contents, 0, NOW()); 更新对话 SET last_message_id=LAST_INSERT_ID() WHERE id = :conversation_id

注意：可以将 UPDATE 语句安排为 LOW_PRIORITY，因为您不必总是 100% 正确。

**对话概述**

这已成为一个更简单的查询：

```
SELECT other_user.name, m.contents, m.read, c.id
FROM participation AS p
INNER JOIN user AS other_user ON other_user.id = p.uid2
INNER JOIN conversation AS c ON c.id = p.conversation_id
INNER JOIN messages AS m ON m.id = c.last_message_id
WHERE p.uid1 = :user_id
ORDER BY m.time DESC
LIMIT 50 
```

免责声明：我没有对此进行测试，但这篇文章对你来说应该是有意义的。

## 优化

拥有双向表的另一个好处是它可以为分片做好准备，这是一种将相关数据推送到另一个数据库（在不同的机器上）的方法；根据某些规则，您将确定从何处获取信息。

您可以通过以下方式移动数据：

1.  `participation`根据`uid1`字段划分表格
2.  `messages`根据`conversation_id`字段划分表格

消息概述将变得更加复杂，因为您可能被迫进行两个查询；不过，这可以通过缓存（在极端情况下是文档数据库）来缓解。

希望这能给你一些关于未来规划的想法:)

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2012-06-09T04:59:26.627

我认为最简单的方法是：

**表：**

```
conversation(cid | userId | friendId | last_message_id)
messages(mid | message | userId | read | time | cid) 
```

然后在用户在特定对话中插入每条消息后更新 last_message_id。

然后运行这个简单的查询。它会给你你想要的。

```
SELECT * FROM conversation c, messages m 
WHERE (c.userId='$uid' OR c.friendId='$uid')
AND c.last_msg_id=m.message_id
ORDER BY created_time DESC 
```

$uid 是登录用户的 id。

所以实际上这个过程在做什么：

1.  显示登录用户的所有对话。
2.  引用最后一条消息（因此您不需要分组依据）
3.  最后按 desc 顺序显示消息。

* * *

## 回答 #13

> 赞同：-1
> 
> 时间：2012-05-25T00:30:18.450

扩展观察者建议的答案。

您应该考虑放弃“对话”概念以进一步简化。

```
+----+---------+------+------------------+--------+----------+
| id | message | read | time             | toUser | fromUser |
+----+---------+------+------------------+--------+----------+
| 1  |  test 1 |  0   | (some timestamp) |  3     |   4      |
| 2  |  test 2 |  0   | (some timestamp) |  4     |   3      |
+----+---------+------+------------------+--------+----------+ 
```

用户 123 的所有对话列表：

```
SELECT * FROM (
    SELECT id, message, toUser, fromUser   
    FROM userMessages 
    WHERE toUser = 123 OR fromUser = 123 
    ORDER BY id DESC
) AS internalTable 
GROUP BY toUser, fromUser 
```

列出用户 123 和用户 456 之间的整个对话：

```
SELECT * 
FROM userMessages
WHERE (toUser = 123 OR fromUser = 123) 
AND (toUser = 456 OR fromUser = 456)
ORDER BY time DESC 
```

# javascript - 动态插入 .js 文件时触发 onload 属性

> ID：10588393
> 
> 赞同：-2
> 
> 时间：2012-05-14T17:43:11.103
> 
> 标签：javascript

我使用 onload 属性触发我的 javascript ->`window.onload = function(){ // start code }`

`<head>`最近我开始对设置我的 .js 文件的标签进行 .innerHTML 写入。

`document.head.innerHTML = html_string`

```
// where html_string contains the link to my .js file. 
```

我遇到的问题是，现在永远不会调用 onload 函数，因此我的页面上没有 javascript。

有没有办法手动调用它或模拟它的行为？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-05-14T17:54:08.473

不要通过设置`innerHTML`of来插入脚本`document.head`。添加一个`<script>`DOM节点并监听它的加载事件：[https](https://stackoverflow.com/a/9102718/1048572) ://stackoverflow.com/a/9102718/1048572 ，[动态加载.js文件时捕获onload事件？](https://stackoverflow.com/q/1917953/1048572)，[加载CSS后触发的jQuery事件？](https://stackoverflow.com/q/2571164/1048572)

# background - 从精灵中移除背景

> ID：10588394
> 
> 赞同：1
> 
> 时间：2012-05-14T17:43:19.197
> 
> 标签：background, unity3d

我正在尝试“加载”一些 2d 图像![替代文字](../Images/c7882da070863e65c5b810f87ec8334e.png)作为网格的材料（我知道 spritemanager），但不幸的是我得到了这个白色背景的精灵。我怎样才能“让它去”（背景）？
谢谢。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-05-14T17:47:55.673

如果图像是支持透明度的文件类型，请在图像编辑软件（paint.net、photoshop 等）中将其打开并删除白色或将其替换为空白/透明颜色。

否则，请在 unity 文档中查找将特定颜色值设置为“背景”或“透明”的选项，以便忽略该颜色。

# advantage-database-server - 我可以在旧服务器和新的替换服务器上临时运行 ADS 吗？

> ID：10588395
> 
> 赞同：0
> 
> 时间：2012-05-14T17:43:35.583
> 
> 标签：advantage-database-server

我在 Windows 2000 服务器上运行优势数据库服务器版本 8.10.0.38。我想用新的 windows 2008 R2 服务器替换服务器并将 ADS 和应用程序迁移到新服务器。在从旧服务器上删除许可证之前，我需要在新服务器上测试应用程序一周。我可以在新服务器上安装许可证并使用一个许可证同时运行旧服务器和新服务器一周吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-05-14T20:42:13.613

我不能说这样做的合法性（即使你所做的事情的意图似乎是合理的）。但是，从实际的角度来看，它可能行不通。Advantage Database Server 会尝试检测其他服务器是否以相同的序列号运行，因此 Advantage 的第二个实例很可能不会启动。

还有一个额外的潜在问题。Win 2008 R2 不正式支持 v8.x，因此存在潜在问题（我没有尝试过，所以我不确定它是否会工作）。必须迁移到 v10.x 才能支持 Win 2008 R2。

# asp.net-mvc-3 - 如果我有一个 Service 类和 IRepository，我是否需要一个 Repository 类？

> ID：10588397
> 
> 赞同：0
> 
> 时间：2012-05-14T17:43:39.777
> 
> 标签：asp.net-mvc-3, model-view-controller, repository-pattern

看完后，[这个问题](https://stackoverflow.com/questions/4816692/what-is-a-good-example-of-a-service-layer-in-asp-net-mvc)。我想我需要查看我的结构以避免冗余代码。

我当前的结构是 Controller -> Repository -> IRepository。

存储库如下所示：

```
public class UserRepository : IUserRepository, IDisposable
{
    private StudentSchedulingEntities _context;

    public UserRepository(StudentSchedulingEntities context)
    {
        if (context == null)
            throw new ArgumentNullException("context");

        _context = context;
    }
    public IEnumerable<User> GetUsers()
    {
        return _context.Users.ToList();
    }
    public User GetUserByID(int id)
    {
        return _context.Users.Find(id);

    }
    public void InsertStudent(User user)
    {
        _context.Users.Add(user);
    }
    public void DeleteStudent(int userID)
    {
        User usr = _context.Users.Find(userID);
        _context.Users.Remove(usr);
    }
    public void UpdateStudent(User user)
    {
        _context.Entry(user).State = EntityState.Modified;
    }
    public void Save() {
        _context.SaveChanges();
    }
    public void Dispose()
    {
        Dispose(true); 
        GC.SuppressFinalize(this); 
    }
    protected virtual void Dispose(bool disposing)
    {
        if (disposing)
        {
            if (_context != null)
            {
                _context.Dispose();
                _context = null;
            }
        }
    }
} 
```

我的 IRepository 看起来像这样：

```
public interface IUserRepository : IDisposable
{
    IEnumerable<User> GetUsers();
    User GetUserByID(int userID);
    void InsertStudent(User user);
    void DeleteStudent(int userID);
    void UpdateStudent(User user);
    void Save();
} 
```

我想避免在服务层再次这样做。我需要存储库类还是应该只实现服务层来替换存储库？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-05-14T17:57:30.740

您的服务层不需要任何存储库实现，它只需使用存储库来查找用户、添加/编辑/删除用户等。

现在，如果我能提供一些意见，我建议使用通用存储库。这样，如果您需要创建新的存储库，这真的很简单。我们使用 nopCommerce，他们使用以下代码：

```
public partial interface IRepository<T> where T : BaseEntity
{
    T GetById(object id);
    void Insert(T entity);
    void Update(T entity);
    void Delete(T entity);
    IQueryable<T> Table { get; }
} 
```

由于它使用实体框架，因此这是实现：

```
/// <summary>
/// Entity Framework repository
/// </summary>
public partial class EfRepository<T> : IRepository<T> where T : BaseEntity
{
    private readonly IDbContext _context;
    private IDbSet<T> _entities;

    /// <summary>
    /// Ctor
    /// </summary>
    /// <param name="context">Object context</param>
    public EfRepository(IDbContext context)
    {
        this._context = context;
    }

    public T GetById(object id)
    {
        return this.Entities.Find(id);
    }

    public void Insert(T entity)
    {
        try
        {
            if (entity == null)
                throw new ArgumentNullException("entity");

            this.Entities.Add(entity);

            this._context.SaveChanges();
        }
        catch (DbEntityValidationException dbEx)
        {
            var msg = string.Empty;

            foreach (var validationErrors in dbEx.EntityValidationErrors)
                foreach (var validationError in validationErrors.ValidationErrors)
                    msg += string.Format("Property: {0} Error: {1}", validationError.PropertyName, validationError.ErrorMessage) + Environment.NewLine;

            var fail = new Exception(msg, dbEx);
            //Debug.WriteLine(fail.Message, fail);
            throw fail;
        }
    }

    public void Update(T entity)
    {
        try
        {
            if (entity == null)
                throw new ArgumentNullException("entity");

            this._context.SaveChanges();
        }
        catch (DbEntityValidationException dbEx)
        {
            var msg = string.Empty;

            foreach (var validationErrors in dbEx.EntityValidationErrors)
                foreach (var validationError in validationErrors.ValidationErrors)
                    msg += Environment.NewLine + string.Format("Property: {0} Error: {1}", validationError.PropertyName, validationError.ErrorMessage);

            var fail = new Exception(msg, dbEx);
            //Debug.WriteLine(fail.Message, fail);
            throw fail;
        }
    }

    public void Delete(T entity)
    {
        try
        {
            if (entity == null)
                throw new ArgumentNullException("entity");

            this.Entities.Remove(entity);

            this._context.SaveChanges();
        }
        catch (DbEntityValidationException dbEx)
        {
            var msg = string.Empty;

            foreach (var validationErrors in dbEx.EntityValidationErrors)
                foreach (var validationError in validationErrors.ValidationErrors)
                    msg += Environment.NewLine + string.Format("Property: {0} Error: {1}", validationError.PropertyName, validationError.ErrorMessage);

            var fail = new Exception(msg, dbEx);
            //Debug.WriteLine(fail.Message, fail);
            throw fail;
        }
    }

    public virtual IQueryable<T> Table
    {
        get
        {
            return this.Entities;
        }
    }

    private IDbSet<T> Entities
    {
        get
        {
            if (_entities == null)
                _entities = _context.Set<T>();
            return _entities;
        }
    }
        //TODO implement IDisposable interface
} 
```

现在它就像`IRepository<User>`or一样简单`IRepository<Whatever>`。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-05-14T18:12:31.620

绝对不要冗余代码:-)当你说：

我当前的结构是 Controller -> Repository ->

控制器是从存储库继承的吗？你也不想这样。存储库层通常与存储（XML、数据库、文件系统等）接口并映射到存储库友好类。另一层管理存储库层到您的本机业务/服务类的映射。

# opencv - opencv2 包含文件在哪里？

> ID：10588400
> 
> 赞同：26
> 
> 时间：2012-05-14T17:43:56.780
> 
> 标签：opencv, installation, header-files

我正在努力寻找应该在目录名称“opencv2”中的包含文件！我已经从[这里](http://sourceforge.net/projects/opencvlibrary/files/latest/download?source=files)下载了 OpenCV-2.4.0.tar.bz2并提取了文件并运行了 cmake，这似乎成功地构建了库。

问题是在“opencv2”的“include”目录下似乎有大量的头文件丢失。目前唯一的头文件是“opencv.hpp”，其中包括一整套不存在的其他文件。有谁知道我可以从哪里获取这些文件？

![图片的](../Images/33e3de34e0660e76f198896ca90d1544.png)

谢谢！

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2012-05-14T18:39:39.550

模块的头文件位于它们自己的目录中。例如，您可以`calib3d.hpp`在`/modules/calib3d/include/opencv2/calib3d`. CMake 创建的 Makefile 知道这些地址，因此当您`make install`将头文件全部复制到`/usr/local/include/opencv2`.

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2018-01-26T08:47:28.213

如果您在 Windows 上使用 cmake-gui 和 Visual Studio 来制作 opencv（我有 3.4.0），请不要忘记构建这个项目：

[![在此处输入图像描述](../Images/f78062d70f5deeed7a9c2d572e473e5a.png)](https://i.stack.imgur.com/1TMza.png)

这将在单个文件夹中生成所有必需的文件，因此您可以轻松连接头文件：

[![在此处输入图像描述](../Images/4e758fcd5c366516417f740a67908289.png)](https://i.stack.imgur.com/nhVe9.png)

# android - 三星 Transfix 2.3.4 是否支持 Android USB 配件

> ID：10588401
> 
> 赞同：0
> 
> 时间：2012-05-14T17:43:58.330
> 
> 标签：android, accessory

我正在尝试开发一个使用 Open Accessory（USB 附件主机模式）的 Android 应用程序。我有一个板球三星 Transfix 手机。它有版本 2.3.4 android。当我加载我的应用程序时出现错误

“安装错误：INSTALL_FAILED_MISSING_SHARED_LIBRARY”
E/PackageManager(147)：包 com.st.android.adkping 需要不可用的共享库 com.android.future.usb.accessory；失败！

Samsung Transfix 是否支持 Open Accessory？我可以加载 usb.jar（在 apk 中）吗？

它在模拟器中加载。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-05-14T17:52:59.920

读出来

[http://developer.android.com/sdk/android-2.3.4.html](http://developer.android.com/sdk/android-2.3.4.html)

如果 Samsung Transfix 支持 2.3.4 那么它支持 USB

# c# - 实现 WCF 回调时是否需要在服务器端手动实现线程？

> ID：10588407
> 
> 赞同：2
> 
> 时间：2012-05-14T17:44:17.530
> 
> 标签：c#, multithreading, wcf, callback

我有一个带有属性的 WCF Singleton 服务，`[ServiceBehavior(ConcurrencyMode = ConcurrencyMode.Multiple, InstanceContextMode = InstanceContextMode.Single)]`它使用 wsDualHttpBinding 并允许用户调用数据库请求。这些请求可能会运行很长时间，并且经常会超时。我使用了[此处](http://idunno.org/archive/2008/05/29/wcf-callbacks-a-beginners-guide.aspx)给出的示例，该示例在 SO 的另一个答案中找到。我已经实现了一切并且一切正常，但是我担心当多个客户端同时附加到我的服务时会发生什么。我已将 ConcurrencyMode 设置为 Multiple，但我不确定这是否能满足我的需求。

我的问题是，每次客户端调用时我是否必须在服务器端创建一个新线程，或者 WCF 是否通过将我的 OperationContracts 托管在单独的线程中来为我处理？

谢谢你的帮助！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-05-14T17:46:12.867

`WCF`将为来自客户端的每个调用创建线程。

# intellij-idea - Intellij 导航到文件停止工作

> ID：10588408
> 
> 赞同：26
> 
> 时间：2012-05-14T17:44:27.400
> 
> 标签：intellij-idea

所以我们有一个大项目，我一直使用 intellij 导航到文件 cntrl+shift+n。我不知道发生了什么，但现在当我尝试使用它时 - 它找不到任何东西。我最近没有安装任何插件或任何东西。

我已经重新启动了 intellij 几次，检查了小过滤器图标以确保我没有过滤任何东西......似乎没有任何工作。任何想法我需要做些什么才能让它再次工作？

* * *

## 回答 #1

> 赞同：64
> 
> 时间：2012-05-14T17:52:43.753

尝试[11.1.2 构建](http://confluence.jetbrains.net/display/IDEADEV/IDEA+11.1+EAP)和`File`| `Invalidate Caches`. 如果没有帮助，请联系 JetBrains 支持并提供示例项目以重现它。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2013-09-10T13:58:57.913

还要尝试验证某些插件是否已更新，并禁用它们以尝试其中一些是否有问题。就我而言，它是：Apache config (.htaccess) 支持版本 131.61

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2015-03-06T11:07:36.673

确保您的键盘映射设置为默认值。您可能正在使用不同的键盘映射，因此请转到文件 > 设置并搜索键盘映射。你可以在那里改变它。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2018-07-20T21:15:14.917

当您按下 Ctrl+Shift+N 时，会弹出查找窗口，检查搜索框上的过滤器图标（位于查找窗口的右上角）并确保您要查找的文件类型已被选中。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2020-09-16T04:00:16.393

**对我来说，使用项目文件夹**重新启动 Webstorm再次将其整理出来。

```
File -> New -> Project 
```

只需重新启动它就可以将转到文件源指向 Webstorm 应用程序目录。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2021-09-15T17:20:04.037

我删除了该项目，然后重新导入它`maven(right corner of IDE) -> plus icon`以再次添加项目

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2021-06-08T14:08:09.670

我用 Rust 编程。所以对我来说，安装缺少的 rust 插件解决了它。

# cocoa-touch - 在后台实现一个块，然后在完成后在主线程上运行另一个块？

> ID：10588412
> 
> 赞同：2
> 
> 时间：2012-05-14T17:44:49.653
> 
> 标签：cocoa-touch, grand-central-dispatch, nsthread

如何实现以下块？

我需要在后台运行一些任务。然后后台任务完成后，一些任务会在主线程中运行。

为什么我使用块是因为我需要更新传递给此方法的视图。

```
- (void)doALongTask:(UIView *)someView {

    [self doSomethingInBackground:^{

        // Runs some method in background, while foreground does some animation.
        [self doSomeTasksHere];

    } completion:^{

        // After the task in background is completed, then run more tasks.
        [self doSomeOtherTasksHere];

        [someView blahblah];

    }];
} 
```

或者有没有更简单的方法来实现这个？谢谢。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2012-05-15T14:33:24.400

我不确定您是否在询问块如何工作或如何在主线程上运行完成处理程序。

根据您的代码，您正在调用 doSomethingInBackground 并传入两个块作为参数。必须在 doSomethingInBackground 方法中调用这些块才能运行。doSomethingInBackground 必须看起来像这样：

```
-(void)doSomethingInBackground:(void (^))block1 completion:(void (^))completion
{
    // do whatever you want here

    // when you are ready, invoke the block1 code like this
    block1();

    // when this method is done call the completion handler like this
    completion();
} 
```

现在，如果您想确保完成处理程序在主线程上运行，您可以将代码更改为如下所示：

```
- (void)doALongTask:(UIView *)someView {

    [self doSomethingInBackground:^{

        // Runs some method in background, while foreground does some animation.
        [self doSomeTasksHere];

    } completion:^{
        // After the task in background is completed, then run more tasks.
        dispatch_async(dispatch_get_main_queue(), ^{
            [self doSomeOtherTasksHere];
            [someView blahblah];
        });
    }];
} 
```

这是我根据您编写的代码的答案。

但是，如果这条评论“我需要在后台运行一些任务。然后在后台任务完成后，一些任务将在主线程中运行”更能说明你实际上想要做什么，那么你只需要这样做：

```
dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^{
    // do your background tasks here
    [self doSomethingInBackground];

    // when that method finishes you can run whatever you need to on the main thread
    dispatch_async(dispatch_get_main_queue(), ^{
        [self doSomethingInMainThread];
    });
}); 
```

# java - 按下一个按钮并在java的新窗口中打开一个文件

> ID：10588416
> 
> 赞同：2
> 
> 时间：2012-05-14T17:45:20.230
> 
> 标签：java, swing, user-interface, file-io

我创建了一个 JFrame 并放置了一个文本字段和按钮。在文本字段中我放置了一个从文本文件中读取的名称。知道我想单击按钮并打开一个我想在其中放置名称 + 其他信息的已知窗口来自同一个文件。

这是我的代码：这是我的主框架

```
 package Frontend;

   import Business.ShowDetails;
   import model.*;
   import java.awt.*;
   import java.awt.event.*;
   import java.io.*;
   import java.util.*;
   import javax.swing.*;

 public class Gui {
  //String file=" ";
  private JFrame frame;
  private JPanel panel1 ;
  private JPanel panel2;
  private JPanel panel;
  private JTextField nume1;
  private JTextField nume2;
  private JTextField nume3;
  private JTextField nume4;
  private JTextField nume5;
  private JButton edit1;
  private JButton edit2;
  private JButton edit3;
  private JButton edit4;
  private JButton edit5;
  private final String file = "Persoane.txt";

public Gui(){
   fereastra();
   readFile(file);
}

public void fereastra(){

    frame = new JFrame();
    panel = new JPanel(new FlowLayout());
    panel1 = new JPanel(new GridLayout(5,2,1,7));
    panel2 = new JPanel(new GridLayout(5,2,1,1));

    nume1 = new JTextField(15);
    nume2 = new JTextField(15);
    nume3 = new JTextField(15);
    nume4 = new JTextField(15);
    nume5 = new JTextField(15);

    edit1 = new JButton("Edit");
    edit2 = new JButton("Edit");
    edit3 = new JButton("Edit");
    edit4 = new JButton("Edit");
    edit5 = new JButton("Edit");

    panel1.add(nume1);
    panel2.add(edit1);
    panel1.add(nume2);
    panel2.add(edit2);
    panel1.add(nume3);
    panel2.add(edit3);
    panel1.add(nume4);
    panel2.add(edit4);
    panel1.add(nume5);
    panel2.add(edit5);

    ButtonHandler handler = new ButtonHandler();    
    edit1.addActionListener(handler);                             
    edit2.addActionListener(handler);
    panel.add(panel1);
    panel.add(panel2);
    frame.add(panel);
    frame.setDefaultCloseOperation(frame.EXIT_ON_CLOSE);
    frame.setSize(300, 200);
    frame.setVisible(true);
}
public String readFile(String filename){
    try{
         String line="";
         Persoana p ;
         BufferedWriter bw = null;
         ArrayList<Persoana> listOfPersons;

          //creez o lista de persoane
         listOfPersons = new ArrayList<Persoana>();
         //citesc fisierul Persoane.txt
        FileReader  file1 =new FileReader(filename);
         BufferedReader br1 = new BufferedReader(file1);

        while((line = br1.readLine())!= null){
          //elimin prima linie din fisier

         if(!line.trim().contains("ID")){
         String[] attributes = line.split(";");// separ fiecare linie in tokenuri

            p = new Persoana(); // make a new person
            p.setId(Integer.parseInt(attributes[0]));
            p.setNume(attributes[1]);
            p.setPrenume(attributes[2]);
            p.setDataNasterii(attributes[3]);
            p.setProfesie(attributes[4]);

            listOfPersons.add(p);
         }

      }
         int i = 0;
        while (i < listOfPersons.size()){
            if(i == 0){
                 p = listOfPersons.get(i);
                 nume1.setText(p.getNume() + " " +p.getPrenume());
                 nume1.getText();
            }
            if(i == 1){
                 p = listOfPersons.get(i);
                 nume2.setText(p.getNume() + " " +p.getPrenume());
                 nume2.getText();
            }
             if(i == 2){
                 p = listOfPersons.get(i);
                 nume3.setText(p.getNume() + " " +p.getPrenume());
                 nume3.getText();
            }
             if(i == 3){
                 p = listOfPersons.get(i);
                 nume4.setText(p.getNume() + " " +p.getPrenume());
                 nume4.getText();
            }
             if(i == 4){
                 p = listOfPersons.get(i);
                 nume5.setText(p.getNume() + " " +p.getPrenume());
                 nume5.getText();
            }

             i++;
         }
         br1.close();
    }
    catch(IOException ex){
        System.out.println("Error opening file.");
        System.exit(1);
    }
   return file;
}

  // inner class for button event handling
    private class ButtonHandler implements ActionListener {
            public void actionPerformed(ActionEvent e) {
                    if (e.getSource() == edit1) {
                            new ShowDetails();

                    }
                    if (e.getSource() == edit2) {
                            new ShowDetails();
                    }
        }
}
} 
```

这是我的第二个 cclass：

```
 package Business;

  import Frontend.*;
   import javax.swing.*;
  import java.awt.*;
  import java.awt.event.*;

  public class ShowDetails extends JFrame{

  Gui gui;

  public ShowDetails(){

    this.gui = gui;
    fereastra();
}

public void fereastra(){
    JPanel panel = new JPanel(new GridLayout(2, 2));
    JTextArea text = new JTextArea();
    text.setEditable(true);
    text.setText(gui.readFile("Persoane.txt"));
    text.getText();
    panel.add(text);

    getContentPane().add(panel);
    setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
    //setLocation(50,50);
setSize(300,200);
setResizable(false);
   // setVisible(true);
    show();
}

} 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-05-14T17:59:07.303

1.  `JFrame`如果您希望弹出窗口`JDialog`与框架的父级一起使用，请不要创建新的。
2.  不要使用`show();`，因为这是长期贬值的方法，请删除它并取消注释 `// setVisible(true);`
3.  为什么两个`JButtons`做同样的事情？
4.  为什么使用`FileIO`将值或参数从一个`Object`传递到另一个？
5.  我建议使用`CardLayout`而不是创建一个弹出窗口。
6.  `setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);`from`class ShowDetails`将关闭当前的 JVM 实例。
7.  不要扩展`JFrame`或`JDialog`或`JWindow`

# c# - 游戏开发 - 将对象从一个点移动到另一个点

> ID：10588421
> 
> 赞同：0
> 
> 时间：2012-05-14T17:45:36.233
> 
> 标签：c#, .net, winforms

我正在用 C#/.NET ( [Windows Forms](http://en.wikipedia.org/wiki/Windows_Forms) ) 开发游戏。在玩游戏时，有一个场景是物体从一个点移动到另一个点（从左到右）。右侧点的坐标是固定的。然而，物体的位置（要向右移动）是事先不知道的，因此它的坐标是事先不知道的，所以我们不能有一个硬编码的路径。

我想生成一条路径，它以弯曲的方式将对象从左点移动到右点（就像我们在[Angry Birds](http://en.wikipedia.org/wiki/Angry_Birds)中扔鸟一样），而不是以直线方式。

下面是可以帮助您理解场景的图像。

![在此处输入图像描述](../Images/5afa104cc1413c1e92a07f84c5713acd.png)

是否有执行此类任务的算法或任何[API ？](http://en.wikipedia.org/wiki/Application_programming_interface)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-05-14T17:53:59.230

您可以计算对象的物理[轨迹](http://en.wikipedia.org/wiki/Trajectory)。对于您要查找的内容，简单的公式是某个物体以初始速度运动并受重力影响而没有阻力或风。这条轨迹是一条[抛物线](http://en.wikipedia.org/wiki/Parabola)。

给定初始速度和重力，路径是固定的。您可以求解轨迹方程以获得目标 x,y 或投掷后某个时间对象的位置。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-05-14T17:50:16.370

这并不太难做到。当需要移动对象时，首先获取其坐标（此时您将知道它）。使用[射弹运动](http://en.wikipedia.org/wiki/Projectile_motion)方程得到其路径的方程，然后沿着该路径移动它。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-05-15T16:14:06.300

您需要通过非规范椭圆的弧线。如果您阅读 Wikipedia 文章*[Ellipse](http://en.wikipedia.org/wiki/Ellipse)*，您会发现一些有趣的方法来实现这一点，但这应该可以帮助您入门：

![在此处输入图像描述](../Images/f946eebee84ccb99e5b70df42a90eebe.png)

'a' 和 'b' 是你的半径。

所以现在只需重构公式以隔离 X 并再次重构以隔离 Y ...

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-04-19T15:59:22.950

我找到了一个更简单的解决方案。使用[Bezier 曲线变换](http://en.wikipedia.org/wiki/B%C3%A9zier_curve)，我可以按照我想要的方式生成路径。

# java - JIRA - 获取项目和问题类型的所有字段

> ID：10588423
> 
> 赞同：2
> 
> 时间：2012-05-14T17:45:49.473
> 
> 标签：java, jira

我想获取可用于特定项目和问题类型的所有默认（非自定义）字段。字段集取决于问题类型，也取决于项目。对于自定义字段没有问题，但对于默认字段我找不到解决方案。

任何想法？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-05-15T15:04:45.570

最后我发现了类似的东西：

```
 MutableIssue issuePattern = ComponentAccessor.getComponentOfType(IssueFactory.class).getIssue();
    issuePattern.setProjectId(projectId);
    issuePattern.setIssueTypeId(issueTypeId);

    IssueCreationHelperBean issueCreationHelperBean = ComponentAccessor.getComponentOfType(IssueCreationHelperBean.class);
    List<OrderableField> availableFields = issueCreationHelperBean.getFieldsForCreate(loggedInUser, issuePattern); 
```

它肯定有效。我希望它对其他人有用。我已经在 J​​IRA 5 下对其进行了测试。

# c# - 使用反射动态创建存储库实例

> ID：10588431
> 
> 赞同：0
> 
> 时间：2012-05-14T17:46:26.283
> 
> 标签：c#, reflection, repository-pattern

对于给定的存储库接口`IRepository<T> where T: Base`和一堆继承`Base`（例如，`Text`）的类，您如何创建实现的提供者`IRepository`的实例，例如`JsonRepository<T>`使用`Text`as`T` `(JsonRepository<Text>)`并在其上运行方法？

我想使用反射`for`或`foreach`为所有继承的类创建存储库实例`Base`并在它们上执行一些数据管理功能。

我想避免的 - 如果你有 100 个继承`Base`类的类，你显然不会在代码中手动创建实例然后运行它？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-05-14T17:55:19.683

您可以使用[`Activator.CreateInstance`](http://msdn.microsoft.com/en-us/library/system.activator.createinstance.aspx)

[在此处](https://stackoverflow.com/a/1151470/95573)查看示例：

修改为您的示例：

```
var d1 = typeof(JsonRepository<>);
Type[] typeArgs = { typeof(Text) };
var makeme = d1.MakeGenericType(typeArgs);
object o = Activator.CreateInstance(makeme); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-05-14T21:41:58.837

在@SwDevMan81 的帮助和一些反思下，我设法把它破解了，它实际上工作得很好：

```
var type = typeof(Base);
var types = AppDomain.CurrentDomain.GetAssemblies().ToList()
        .SelectMany(s => s.GetTypes())
        .Where(p => type.IsAssignableFrom(p));

var jsonProviderClass = typeof(JsonContentProvider<>);
var xmlProviderClass = typeof(XmlContentProvider<>);

    foreach (var t in types) {
        Type[] typeArgs = { t };
        // get XML provider
        var xmlGenericProvider = xmlProviderClass.MakeGenericType(typeArgs);
        object xmlProvider = Activator.CreateInstance(xmlGenericProvider);
        // get JSON provider
        var jsonGenericProvider = jsonProviderClass.MakeGenericType(typeArgs);
        object jsonProvider = Activator.CreateInstance(jsonGenericProvider);
        // methods to run
        MethodInfo xmlMethod = xmlGenericProvider.GetMethod("GetContent", new Type[] { typeof(string) });
        MethodInfo jsonMethod = jsonGenericProvider.GetMethod("Update");
        // get content from XML provider
        var result = xmlMethod.Invoke(xmlProvider, new object[] { string.Empty });
        // enumerate XML content items
        foreach (var item in ((IEnumerable)result)) {
            // update them via JSON provider
            object[] parametersArray = new object[] { item };
            var update = jsonMethod.Invoke(jsonProvider, parametersArray);
        }
    } 
```

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2012-05-14T18:07:36.753

您当前使用的是泛型约束，但为什么不使用表示泛型类型具有公共无参数 ctor 的“新”约束，即

```
IRepository<T> where T: Base, new 
```

这意味着您可以致电：

```
abstract class ctor()
{
    IRepository rep = new T();
} 
```

现在你如何应用它可能是通过一个基本的抽象类，或者你可以简单地通过一个propfull返回rep实例......这取决于你。

我不得不承认你的问题有点模糊，所以如果这不是你想要的，请原谅。

# spring - Cloud Foundry 上的 MySQL 有时会被清空

> ID：10588437
> 
> 赞同：0
> 
> 时间：2012-05-14T17:47:03.737
> 
> 标签：spring, cloud-foundry, paas

我想问一下 CloudFoundry 服务上的数据库行为。我使用 Spring 和 vmc 作为我的部署命令行助手。当我部署应用程序并绑定服务（在我的情况下为 MySQL）时，用户可以将数据添加到我的服务中，并且这些信息存储在数据库中，这没关系。但是过了一段时间，当没有人使用我的应用程序时（我说的是几天），数据库被清空了。当我重新部署我的应用程序时也会发生同样的情况。

所以我的问题是：CloudFoundry 上的数据库存储不是“持久的”（=永远），所以我应该搜索一些数据库托管吗？或者这是如何工作的？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-05-15T12:43:32.513

通常不应该发生这种情况。确保在重新部署应用程序时选择第一次上传应用程序时创建的相同服务，否则将为导致空数据库的应用程序创建新服务

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-06-04T22:16:09.277

您需要创建数据库的 mysqldump。一旦你有了 mysqldump 文件，你就可以使用 caldecott 并执行 vmc 隧道到你的 MySQL 服务。在 Cloud Foundry 上与 MySQL 服务建立连接后，您需要使用 mysql 命令手动将 mysqldump 文件导入到您的服务中。

有关如何使用 vmc 隧道，请访问[此处](http://docs.cloudfoundry.com/tools/vmc/caldecott.html)的文档站点。

# java - Socket + readline = Null pointer Exception

> ID：10588442
> 
> 赞同：0
> 
> 时间：2012-05-14T17:47:09.617
> 
> 标签：java, sockets

Here is my class

```
public class MessageFrameListener{
private MessageFrame mf;
private User us;
private Contact cn;

private Socket s;
private PrintStream ps;
private BufferedReader br;

public MessageFrameListener(MessageFrame m_f, User u_s, Contact c_n){
    mf = m_f;
    us = u_s;
    cn = c_n;
    m_f.addButtonListener(new SButtonListener());
}

public void init(){
    try {
        s = new Socket(InetAddress.getLocalHost(), 8072);
        PrintStream ps = new PrintStream(s.getOutputStream());
        BufferedReader br = new BufferedReader( new InputStreamReader(s.getInputStream()));
    } catch (UnknownHostException e) {
        // TODO Auto-generated catch block
        e.printStackTrace();
    } catch (IOException e) {
        // TODO Auto-generated catch block
        e.printStackTrace();
    }

}
public class SButtonListener implements ActionListener{
    public void actionPerformed(ActionEvent e) {
            String insert = mf.getInput();
            String infoString = "m "+us.getName()+" "+cn.getName()+" "+insert;
            ps.println(infoString);
            mf.addLine(insert);
            mf.refreshInput();
    }
} 
```

I get NullPointerException at this line

```
 ps.println(infoString); 
```

The old version, like this , works(where I initalize sockets inside method)

```
 public class ButtonListener implements ActionListener{
    public void actionPerformed(ActionEvent e) {
        try{
            Socket s = new Socket(InetAddress.getLocalHost(), 8072);
            PrintStream ps = new PrintStream(s.getOutputStream());
            BufferedReader br = new BufferedReader( new InputStreamReader(s.getInputStream()));

            String infoString = "add "+us.getName()+" "+af.getName();
            ps.println(infoString);

            String result = br.readLine();

            s.close();
        } catch (UnknownHostException ex) {
            System.out.println("адрес недоступен");
            ex.printStackTrace();
        } catch (IOException ex) {
            System.out.println("ошибка I/О потока");
            ex.printStackTrace();
        }

    } 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2012-05-14T17:48:43.287

The line

```
PrintStream ps = new PrintStream(s.getOutputStream()); 
```

creates a local variable `ps` which hides `this.ps`. Change it to

```
ps = new PrintStream(s.getOutputStream()); 
```

in order to initialize the `ps` member variable.

# asp.net - 什么是标准的 ASP.net 数据绑定语法？

> ID：10588449
> 
> 赞同：5
> 
> 时间：2012-05-14T17:47:42.680
> 
> 标签：asp.net, data-binding, databinder

Microsoft 对[使用控件进行数据绑定`asp:Repeater`](http://msdn.microsoft.com/en-us/magazine/cc163780.aspx)的介绍给出了获取值的语法：

```
<b><%# DataBinder.Eval(Container.DataItem, "orderid") %></b> 
```

[此语法在 ASP.net控件](http://www.codeguru.com/csharp/.net/net_asp/controls/article.php/c19299/The-ASPNET-Repeater-Web-Server-Control.htm)[的其他介绍中`Repeater`](http://www.codeguru.com/csharp/.net/net_asp/controls/article.php/c19299/The-ASPNET-Repeater-Web-Server-Control.htm)重复：

```
<a href="<%# DataBinder.Eval(Container.DataItem, "URL") %>">...</a> 
```

但我记得这种语法是“坏的”和“错误的”。从[`DataBinder.Eval`](http://msdn.microsoft.com/en-us/library/4hx47hfe.aspx)我看到的 MSDN 文档中：

> ![在此处输入图像描述](../Images/db02f2c025aad1fe11d464fc986b0b6d.png) **笔记**
> 
> 由于此方法执行后期绑定评估，在运行时使用反射，因此与**标准 ASP.NET 数据绑定语法**相比，它会导致性能明显变慢。

*（重点补充）*

所以这就解释了*为什么*我有*“`Eval`不好”*的记忆。但是什么***是***“标准 ASP.NET 数据绑定语法”？

## 奖金阅读

*   [数据绑定表达式语法](http://msdn.microsoft.com/en-us/library/bda9bbfx%28v=vs.100%29.aspx)

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-05-14T18:15:53.580

我认为你可以做一个演员来避免“后期绑定”的惩罚：

```
<%# (((System.Data.DataRowView)Container.DataItem)["URL"]) %> 
```

现在假设您将性能提高了 x%。对您的应用程序是否值得？权衡（在我看来）是可读性较差。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-05-14T18:41:44.090

好吧，“标准 ASP.NET 数据绑定”通常是指将数据从数据源绑定到命名控件，例如表单上的文本框，或者可以绑定整个表格的旧 GridView。

如果您只需要数据的只读显示，您可以考虑使用 foreach 循环或 DataReader 将数据解析为 stringBuilder 中的原始 HTML，然后将 StringBuilder 转储为 Literal。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-05-14T18:47:23.133

[此 MSDN 页面](http://msdn.microsoft.com/en-us/library/bda9bbfx(v=vs.71).aspx)描述了标准数据绑定语法，如下所示：

> 例如，在以下代码片段中，整数显示为货币字符串。**使用标准 ASP.NET 数据绑定语法**，您必须首先转换数据行的类型才能检索数据字段 IntegerValue。接下来，这作为参数传递给 String.Format 方法：
> 
> ```
> <%# String.Format("{0:c}", ((DataRowView)Container.DataItem)["IntegerValue"]) %> 
> ```

# visual-studio - 在 VS 2008 中禁用增量链接

> ID：10588454
> 
> 赞同：0
> 
> 时间：2012-05-14T17:48:13.327
> 
> 标签：visual-studio, visual-studio-2008, dll, linker

我正在尝试在 Rational Purify 下运行一个大型解决方案（200 个项目），它阻碍使用`/INCREMENTAL:YES`. 我已经从项目文件中删除了所有在调试模式下启用增量链接器的显式属性；但是默认设置`YES`仍然适用。

我在哪里可以在 VS2008 中禁用它，无论是整个解决方案，还是全局？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2013-01-28T06:29:14.047

不幸的是（或不是）它需要被显式禁用，因为它默认为“是”，请参阅[msdn](http://msdn.microsoft.com/en-us/library/4khtbfyf%28v=vs.90%29.aspx)

> 默认情况下，链接器以增量模式运行

# ios - 自动完成 UITextField 使应用程序崩溃

> ID：10588460
> 
> 赞同：0
> 
> 时间：2012-05-14T17:48:39.450
> 
> 标签：ios, uitextfield

我创建了一个自定义 UITextField，用于将用户输入与数据库记录进行比较。一切都很好，直到用户在我已经提出建议之后在文本字段中放置一个空格。它使应用程序崩溃并显示以下消息：

由于未捕获的异常“NSRangeException”而终止应用程序，原因：“ *** -[__NSCFConstantString substringToIndex:]: Range or index out of bounds”

这是代码：

```
NSRange cursorRange = [[self valueForKey:@"selectionRange"] rangeValue];
NSString *entered = [self.text substringToIndex:cursorRange.location];
if (![self.text isEqualToString:entered]) {
    self.text = entered;
    return;
}

NSString *suggestedSuffix;
for (NSString *name in filterData) {
    if (name.length > cursorRange.location && [[name lowercaseString] hasPrefix:entered]) {
        suggestedSuffix = [name substringFromIndex:cursorRange.location];
        NSMutableString *suggestedString = [[NSMutableString alloc] initWithString:entered];
        [suggestedString appendString:suggestedSuffix];
        self.text = suggestedString;
        [self setValue:[NSValue valueWithRange:cursorRange] forKey:@"selectionRange"];
        return;
    }
} 
```

}

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-05-14T18:03:49.233

我想知道你的钥匙是否正确？

`UITextField`没有`selectionRange`公开定义的 AFAICT 属性。但是，`<UITextInput>`-`UITextField`符合 - 有一个`selectedTextRange`属性。这可能是你的意图吗？（可能有一个未记录的私有财产实际上被称为`selectionRange`您不小心遇到的，并且在您遇到的情况下其行为不符合预期。）

或者，您真的是说`UITextView`- 其中有`selectedRange`- 但仍然没有`selectionRange`？

On a separate note, I don't think subclassing `UITextField` is the right approach here. Autocompletion can be completely (no pun intended) implemented using the `<UITextFieldDelegate>` methods and it is a maxim of Cocoa programming that when you can accomplish a goal through class composition rather than subclassing, you should opt for composition every time.

# c# - 如何通过for循环条件停止多线程启动

> ID：10588467
> 
> 赞同：3
> 
> 时间：2012-05-14T17:49:51.040
> 
> 标签：c#, .net, multithreading, for-loop

此代码将向您展示我如何启动多个线程：

```
for (int i = 0; i < 8; i++)
{
    doImages    = new DoImages(this, TCPPORT + i);
    var thread  = new Thread(doImages.ThreadProc);
    thread.Name = "Imaging";
    var param = (i + 1).ToString();                      
    thread.Start(param);
} 
```

现在我试图在关闭我的应用程序之前停止线程，但我不知道该怎么做？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-05-14T17:54:56.273

一个简单的选择是存储对您生成的所有线程的引用，然后在完成后加入所有线程：

```
Thread[] threads = new Thread[8];
for (int i = 0; i < 8; i++)
{
    doImages    = new DoImages(this, TCPPORT + i);
    var thread  = new Thread(doImages.ThreadProc);
    threads[i] = thread;
    thread.Name = "Imaging";
    var param = (i + 1).ToString();                    
    thread.Start(param);
}
for (int i = 0; i < 8; i++)
{
    threads[i].Join();
} 
```

这将在应用程序终止之前等待所有线程完成。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-05-14T18:20:03.833

最干净和最可靠的方法是让它们成为后台线程：

```
for (int i = 0; i < 8; i++)
{
    doImages    = new DoImages(this, TCPPORT + i);
    var thread  = new Thread(doImages.ThreadProc);
    thread.Name = "Imaging";
    var param = (i + 1).ToString();  
    thread.IsBackground = true;          // **
    thread.Start(param);
} 
```

当进程（主线程）退出时，后台线程会自动终止。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-05-14T17:54:35.410

`thread.Abort();`如果您保留对线程对象的引用并且只想退出您的应用程序，则可以使用。

我的猜测是您想完成执行然后关闭应用程序。为此，您需要使用`Join()`或其他同步方法来同步您的线程。

# debugging - CUDA 调试，或者如何在不禁用优化的情况下在 cuda-gdb 中获取源代码行？

> ID：10588468
> 
> 赞同：4
> 
> 时间：2012-05-14T17:49:51.730
> 
> 标签：debugging, cuda, nvidia, cuda-gdb

我有一个相当大且复杂的 CUDA 代码，对于大量块/线程来说，它非常可靠地挂起。我试图弄清楚代码挂在哪里。

当我在 中运行代码时`cuda-gdb`，我可以看到哪些线程/块挂起，但我看不到“虚拟 PC”之外的位置。

如果我用“-G”编译代码来获取调试信息，无论我运行多长时间，它都会运行得慢很多并且拒绝挂起。

有没有办法将“虚拟PC”映射到源代码中的一行代码，甚至是近似的？或者有没有办法在不关闭所有优化的情况下获取调试信息？

我试过使用“-G3”，但无济于事。这只是给了我“”类型的警告`nvcc warning : Setting optimization level to 0 as optimized debugging is not supported`。我正在使用 CUDA 编译工具 4.1 版。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2012-05-15T17:15:48.380

好吧，我想我已经自己解决了。

如果`cuobjdump`在路径中，则在 中`cuda-gdb`，该命令`x $pc`将为您提供当前线程停止的汇编程序。问题是，如果源代码不是用 编译的`-G`，您将无法将汇编语句与代码中的一行相关联。

要将汇编程序与内核代码匹配，首先确保您使用`nvcc -keep [..] mykernel.cu`. 这应该生成文件`mykernel.sm_20.cubin`（或您选择的任何拱门）和`mykernel.ptx`.

要获取整个内核的汇编程序，请运行`cuobjdump -sass mykernel.cubin > output.ptx`. 在`cuda-gdb`中，`x/20i $pc-80`获取一些上下文，并在文件中查找这些行`output.ptx`。然后，您可以尝试将这些行与 PTX 代码匹配，`mykernel.ptx`其中包含`.loc`引用源代码行的语句。

这种方法在匹配来自 cubin-file 的 PTX 和来自 的 PTX 时需要一点创造力`nvcc`，因为指令可能会重新排序。在我的代码中，我有大量的`FFMA`指令可以查找以了解我的方位。您可以使用“output.ptx”从调试器中找到确切的行，然后在相同的*相对*位置查看“mykernel.ptx”。

这一切都涉及大量工作，但它确实允许您缩小原始源中“虚拟 PC”的位置。

# javascript - 在“上”和“下”方向上操作 DOM 时如何避免重复代码？

> ID：10588470
> 
> 赞同：7
> 
> 时间：2012-05-14T17:50:12.690
> 
> 标签：javascript, jquery, refactoring, code-duplication

我正在编写一个 JS webapp 客户端。用户可以编辑文本项目的列表/树（例如，待办事项列表或注释）。我经常用 jQuery 操作 DOM。

用户可以使用键盘上下导航列表（类似于 GMail 中的 J/K 键），并执行其他一些操作。其中许多操作具有镜像“向上”/“向下”功能，例如

```
$.fn.moveItemUp = function() {
    var prev = this.getPreviousItem();
    prev && this.insertBefore(prev);
    // there's a bit more code in here, but the idea is pretty simple,
    // i.e. move the item up if there's a previous item in the list
}

$.fn.moveItemDown = function() {
    var next = this.getNextItem();
    next && this.insertAfter(next);
    // ....
} 
```

现在，这种具有两个几乎相同功能的模式在我的代码中的多个位置重复出现，因为项目列表/树上有许多非常对称的操作。

**问题：**我如何优雅地重构它以避免代码重复？

到目前为止，我想出的最简单的方法是使用 .apply() ...

```
$.fn.moveItem = function(direction) {
        var up = direction === 'up',
            sibling = up ? this.getPreviousItem() : this.getNextItem(), 
            func = up ? $.fn.insertBefore : $.fn.insertAfter;

        // ...

        if (! sibling) { return false; }

        func.apply(this, [ sibling ]);

        // ...
    }; 
```

当代码的其他元素的结构需要更改 moveUp/moveDown 时，好处是更容易维护。我已经需要多次稍微更改代码，并且我始终需要记住我需要在两个地方进行...

但我对“统一”版本不满意，因为：

*   实现比简单的 moveUp/moveDown 更复杂，因此将来它可能不会那么容易维护。我喜欢简单的代码。所有这些参数，三元运算，每个应该“向上”和“向下”的函数中的 .apply() 技巧......
*   不确定显式引用 jQuery.fn.* 函数是否安全（毕竟它们应该通过将它们应用于 jQuery 对象 $('...').* 来使用）

在使用 DOM 或类似结构时，您如何解决那些“几乎相同的代码”情况？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2012-05-14T18:22:16.453

您可以做的一件事是使用闭包来隐藏从用户传递的配置参数：

```
var mk_mover = function(direction){
     return function(){
         //stuff
     };
};

var move_up = mk_mover("up");
var move_down = mk_mover("down"); 
```

如果您想继续朝这个方向发展，基本上就变成了决定将参数传递给通用实现的最佳方式的问题，并且没有单一的最佳解决方案。

* * *

一个可能的方向是使用 OO 风格的方法，将配置“策略”对象传递给实现函数。

```
var mk_mover = function(args){
    var get_item = args.getItem,
        ins_next = args.insNext;
    return function(){
        var next = get_item.call(this);
        next && ins_next.call(this, next);
    };
 };

 var move_up = mk_mover({
     get_item : function(){ return this.getPrevious(); },
     get_next : function(x){ return this.insertBefore(x); }
 });

 var move_down = mk_mover({/**/}); 
```

我更喜欢在策略接口（不同方向的方法）较小且相对恒定的情况下执行此操作，并且当您希望打开将来添加新类型的方向的可能性时。

当我知道方向集和方法类型都不需要改变太多时，我也倾向于使用它，因为 JS 对 OO 的支持比对 switch 语句的支持更好。

* * *

另一个可能的方向是您使用的枚举方法：

```
var mk_mover = function(direction){
    return function(){
        var next = (
            direction === 'up' ? this.getNextItem() :
            direction === 'down' ? this.getPreviousItem() :
            null );

        if(next){
            if(direction === 'up'){
                this.insertAfter(next);
            }else if(direction === 'down'){
                this.insertBefore(next);
            }
        }

        //...
    };
} 
```

有时您可以使用简洁的对象或数组而不是 switch 语句来使事情更漂亮：

```
var something = ({
    up : 17,
    down: 42
}[direction]); 
```

虽然我不得不承认这有点笨拙，但它的好处是，如果您的方向集尽早确定，您现在可以灵活地在需要时添加新的 if-else 或 switch 语句，在自包含方式（无需在其他地方向策略对象添加一些方法......）

* * *

顺便说一句，我认为您建议的方法位于我建议的两个版本之间的一个不舒服的中间地带。

如果您所做的只是根据传递的值方向标记在函数内部进行切换，那么最好直接在需要的位置进行切换，而不必将事物重构为单独的函数，然后不得不做很多烦人的 .call和 .apply 的东西。

另一方面，如果您遇到了定义和分离函数的麻烦，您可以这样做，以便您直接从调用者（以策略对象的形式）接收它们，而不是自己手动进行调度。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-05-14T18:05:12.137

我之前也遇到过类似的问题，我发现并没有一个很好的模式来处理反向执行看似相似的任务。

虽然作为人类的你认为它们相似是有意义的，但就编译器而言，你实际上只是在调用任意方法。唯一明显的重复是事物的调用顺序：

1.  找到我们想在之前或之后插入的项目
2.  检查项目是否存在
3.  在它之前或之后插入当前项目

您已经以一种基本上进行这些检查的方式解决了问题。但是，您的解决方案有点难以理解。以下是我将如何解决这个问题：

```
$.fn.moveItem = function(dir){
  var index = dir == 'up' ? 0:1,
      item = this['getPreviousItem','getNextItem'][index]();
  if(item.length){
    this['insertBefore','insertAfter'][index].call(this,item);
  }
} 
```

通过使用数组索引，我们可以比您的示例更容易地看到调用的内容。此外，apply 的使用是不必要的，因为您知道要传递多少个参数，因此 call 更适合该用例。

不确定这是否更好，但它更短一些（是否需要 return false ？）并且 IMO 更具可读性。

在我看来，集中动作比可读性更重要——如果你想优化、改变或附加到移动某物的动作，你只需要在一次地方做。您可以随时添加注释来解决可读性问题。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-05-14T18:11:00.103

我认为单功能方法是最好的，但我会将它与上/下的东西分开。创建一个函数将一个项目移动到一个索引或另一个项目之前（我更喜欢后一个）并在那里处理所有“移动”事件，而不是依赖于方向。

```
function moveBefore(node) {
    this.parentNode.insertBefore(this, node); // node may be null, then it equals append()

    // do everything else you need to handle when moving items
}
function moveUp() {
    var prev = this.previousSibling;
    return !!prev && moveBefore.call(this, prev);
}
function moveDown() {
    var next = this.nextSibling;
    return !!next && moveBefore.call(this, next.nextSibling);
} 
```

# php - array_push 给出逗号分隔的数组 - php

> ID：10588479
> 
> 赞同：-1
> 
> 时间：2012-05-14T17:50:52.540
> 
> 标签：php, array-push

我对 PHP 很陌生，并且来自 Java 背景。所以这里是：

我有这个代码：

```
$selected = array();
foreach($this->getSelectedOptions() AS $array) {
   array_push($selected, $array['value']);
}
var_dump($selected); 
```

getSelectedOptions() 检索包含字符串的数组数组。

结果是

```
array
  0 => string 'abc, def' (length=31) 
```

我期待这样的事情：

```
Array
(
    [0] => abc
    [1] => def
) 
```

为什么会这样？如何使我的数组看起来像后者（不使用逗号等进行任何后处理）

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-05-14T17:57:32.830

这是因为 getSelectedOptions() 给你一个逗号分隔的字符串而不是一个数组。我们没有这个功能，所以我们不能用它做任何事情。现在唯一可以做的就是后期处理。这是一些进行后处理的PHP。

```
$selected = array();
foreach($this->getSelectedOptions() AS $array) {
   $values = explode(', ', $array['value']);
   array_push($selected, $values);
}
var_dump($selected); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-05-14T17:54:32.467

您需要拆分逗号分隔的值并再次循环，如下所示：

```
$selected = array();
foreach($this->getSelectedOptions() AS $array) {
    //$array now contains comma seperated values
    //split and loop
    $values = explode(',',$array['value']);
    foreach($values as $value) {
        array_push($selected, $value);
    }
} 
```

# html - 它是一个具有精心设计的框架和框架集的网站吗？

> ID：10588483
> 
> 赞同：0
> 
> 时间：2012-05-14T17:51:05.513
> 
> 标签：html, frame, frameset

我正在处理网页，并且正在使用框架。我想使用表格来制作它，但我不知道如何将框架的每个部分实现到表格中。

所以，我的问题是，它设计得好吗？如果没有，我该如何改进它？

这是我页面的代码：

```
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Frameset//EN"
   "http://www.w3.org/TR/html4/frameset.dtd">
<html>
    <head>
        <title>
            Prueba
        </title>
    </head>
    <frameset rows="56px, *, 50px" border="0" framespacing="0" frameborder="NO">
        <frame class="header" src="header.html">
        <frameset cols="450px, *" border="0" framespacing="0" frameborder="NO">
            <frameset rows="*,150px" border="0" framespacing="0" frameborder="NO">
                <frame class="frame1" scrolling="auto" src="search_results.html">
                <frame class="frame2" scrolling="no" src="info.html">
            </frameset>
            <frame class="frame3" scrolling="no" src="map.html">
        </frameset>
        <frame class="footer" scrolling="no" src="footer.html">
    </frameset>
</html> 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-05-14T17:52:38.450

您可以通过删除框架开始改进它。

*   框架已经过时了很长时间，并在 HTML5 中完全删除。
*   它们是使用 PHP 包含或 SSI 等服务器端技术完成通用布局的更好方法。
*   Plus 框架不利于可访问性或可用性。
*   他们对搜索引擎不友好
*   他们打破了一个 URL fer 页面的规则
*   它们不容易维护。很难准确地确定您正在查看哪个页面。
*   移动设备可能很难正确呈现这些页面。
*   用户无法为页面添加书签，因为每个页面都使用相同的 URL

# java - java中的base64encode altchars

> ID：10588485
> 
> 赞同：2
> 
> 时间：2012-05-14T17:51:07.920
> 
> 标签：java, python, base64

这个python方法的java版本是什么？

[http://docs.python.org/library/base64.html](http://docs.python.org/library/base64.html)

base64.b64encode(s[, altchars]) 使用 Base64 对字符串进行编码。

可选的 altchars 必须是长度至少为 2 的字符串（忽略其他字符），它指定 + 和 / 字符的替代字母。这允许应用程序生成 URL 或文件系统安全的 Base64 字符串。默认值为无，使用标准 Base64 字母表。

..java支持altchars吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-05-14T17:53:25.763

Apache Commons，`Base64`具有用于 URL 安全 Base64 编码的构造函数（和各种静态方法）：

[`Base64(int lineLength, byte[] lineSeparator, boolean urlSafe)`](http://commons.apache.org/codec/apidocs/org/apache/commons/codec/binary/Base64.html#Base64%28int,%20byte%5b%5d,%20boolean%29)

> `urlSafe`-我们分别发出 ' ' 和 ' ' 而不是发出 ' `+`'和 ' '。仅适用于编码操作。解码无缝地处理这两种模式。`/``-``_``urlSafe`

# visual-studio-2012 - MySQL 数据提供程序在 VS 11 Beta 中不可见

> ID：10588486
> 
> 赞同：1
> 
> 时间：2012-05-14T17:51:10.170
> 
> 标签：visual-studio-2012, mysql-connector

我已经下载了 VS 11 Professional Beta，然后，在安装最新版本的 MySQL 连接器 (Connector/Net 6.5.4) 后，我看不出该 VS 版本是否支持它（我想创建 ADO .NET 实体数据模型使用 MySQL 数据库）。MySQL 数据提供者在数据源字段中不可见。在 VS 2010 下它可以工作。

## 编辑

也许我必须等待[VS11 开发者预览版的 MySQL Provider](https://stackoverflow.com/questions/8616564/mysql-provider-for-vs11-developer-preview)

# iphone - OTA - 此时无法安装 myApp - 无法验证可执行文件

> ID：10588488
> 
> 赞同：8
> 
> 时间：2012-05-14T17:51:14.533
> 
> 标签：iphone, ios, xcode, ios-provisioning, provisioning-profile

在 6 个月几乎没有问题之后，我在尝试通过 OTA 分发用于内部测试的应用程序时突然遇到一个重大问题：在安装应用程序时（下载后），我收到以下错误消息 -> 屏幕截图。我所有的测试人员也会看到相同的消息，因此它没有绑定到单个设备。

设备上的控制台显示以下消息：

```
preflight_application_install: Could not verify executable at /var/tmp/install_staging.uNQth4/foo_extracted/Payload/myApp.app 
```

奇怪的是：我可以使用 Xcode 通过 USB 安装应用程序。AppStore上传的验证也很好。

我已经尝试了很多：

*   新的分发配置文件
*   检查 UDID 是否在配置文件内
*   检查钥匙串中的双重配置文件
*   Xcode Voodoo（干净构建，擦除派生数据）
*   试图用权利修复它（'get-task-allow' = false）

任何解决这个问题的想法都会非常有帮助。提前致谢。

![无法下载应用程序](../Images/acc91425f96260c441ee5f25a99c201c.png)

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2012-05-14T23:15:46.110

经过进一步调查，问题再次是由 Developer Provisioning Profile 和 Ad Hoc Distribution Profile 的无效组合引起的。问题是，即使是通常的修复也不起作用（交换证书等）。Xcode 总是显示有效的配置文件。

我已经阅读了很多建议完全重新安装 MacOS 的帖子，目的是彻底安装 KeyChain。我不想杀死我自定义的 MacOS，所以我使用 VMWare 创建了一个 Mac OS 10.7.3 + Xcode 的虚拟机。然后大约需要 20 分钟来设置所有内容，并且 OTA 正常工作！我认为，为这种情况准备一个干净的虚拟操作系统是个好主意。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-09-17T15:25:29.040

就我而言，问题是 IPA 文件有一个捆绑版本号，而 plist 文件有一个不同的捆绑版本号。

将 plist 文件更改为与 IPA 文件具有相同的编号，它对我有用。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2014-07-04T19:46:57.977

在会员中心，我删除了临时分发配置并重新创建。重新编译后，为我工作！

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-05-15T19:45:49.430

如果您有 OTA 构建，则不需要临时构建。折腾那些配置文件。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2014-07-17T02:05:15.010

我遇到了同样的问题，我修复了它，因为我记得我有一部新手机，所以我将它连接到 Xcode（开发人员模式）并将设备添加到配置文件并重新安装配置文件。

# node.js - 节点 JS 调度无法 GET 错误

> ID：10588489
> 
> 赞同：1
> 
> 时间：2012-05-14T17:51:14.960
> 
> 标签：node.js, dispatch

我正在尝试使用调度，但是当我在浏览器（http://127.0.0.1/user）中进行测试时，我收到以下消息

> 无法获取 /user/

我究竟做错了什么？

> 127.0.0.1 - - [格林威治标准时间 2012 年 5 月 14 日星期一 17:40:13] "GET /user/ HTTP/1.0" 404 - "-" "Mozilla/5.0 (Windows NT 6.1; WOW64; rv:12.0) Gecko/20100101火狐/12.0"

[http://www.something.com/api/ping](http://www.something.com/api/ping) -> 工作正常

我的 nginx 配置文件也有这个条目。

```
location /user/ {
      proxy_pass http://www.something.com:8181;
} 
```

任何人对我如何让调度员工作有什么建议吗？

```
var dispatch   = require('connect')

function init() {
   var port = process.env.VCAP_APP_PORT || process.env.PORT || parseInt( process.argv[2], 10 )
   var staticFolder = __dirname + '/../site/public'

   console.log('port='+port+' static='+staticFolder)

   var server = connect.createServer(
   connect.logger(),
   connect.bodyParser(),
   connect.cookieParser(),
   connect.query(),
   connect.session({secret: config.secret}),

   dispatch({
            '/user': {
                     GET: api.get_user,
                     '/socialmsg/:when': {
                           POST: api.social_msg
                     }
             }
    }),

function(req,res,next){
  if( 0 === req.url.indexOf('/api/ping') ) {
    console.log(req.url+': '+JSON.stringify(req.query))
    res.writeHead(200)
    res.end( JSON.stringify({ok:true,time:new Date()}) )
  }
  else next();
},

 connect.static( staticFolder )
 )

 server.listen( port )
 } 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-06-16T19:52:17.400

根据[https://github.com/senchalabs/connect](https://github.com/senchalabs/connect)，我会大幅重构您的代码，使其更具可读性和更明显的问题所在。简而言之，我不相信静态目录似乎是按需要配置的。我没有找到根据 Connect 模块的 createServer() 方法（ExpressJS 和 http/https 模块有它），尤其是您提供的具有 8 个参数的方法。

也就是说，我会坚持文档的约定如下：

```
var connect = require('connect'),
    http = require('http');

var staticFolder = __dirname + '/../sites/public';

var server = http.createServer(
    connect
        .use(connect.static(staticFolder))
        .use(connect.logger)
        .use(connect.bodyParser)
        // etc for each of the 'connect.' middleware you are using above
        .use(function (req, res) {
            // Request handling here
        });
);

server.listen(8181); 
```

在空函数 (req, res) {} 中，您可能希望将您拥有的所有内容用于 api/ping 以及 /user 请求的等价物。

在您的问题中，您提供了“connect.static()”作为 createServer() 的参数（即 connect.createServer(connect.static)），而不是模块中的中间件处理函数 connect.use() 的参数.

# javascript - d3.js 树结构文本链接

> ID：10588490
> 
> 赞同：4
> 
> 时间：2012-05-14T17:51:15.637
> 
> 标签：javascript, json, d3.js

我正在使用 .json 文件中我自己的数据集从 d3 示例之一修改树结构。我有一个包含我自己数据的工作副本。我现在要做的是修改文本，以便它们链接到相应的 url。我发现似乎没有太多关于如何执行此操作的文档。

这是我正在使用的示例树：http: [//bl.ocks.org/1249394](http://bl.ocks.org/1249394)

关于从哪里开始的任何建议？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-05-14T18:55:38.773

最简单的方法是将链接放在 JSON 中的“名称”元素中。然后，您需要为其中的链接和元素创建`svg:a`元素而不是元素。例如线`svg:text``svg:text`

```
nodeEnter.append("svg:text").text(function(d) { return d.name; }); 
```

变成

```
nodeEnter.append("svg:a").attr("xlink:href", function(d) { return d.name; })
.append("svg:text").text(function(d) { return d.name; }); 
```

您当然可以为链接目标和文本设置单独的 JSON 元素。有关链接的更多详细信息，请参阅[SVG 规范](http://www.w3.org/TR/SVG/linking.html#Links)。

或者，您可以使用`svg:foreignObject`为链接嵌入 HTML。请参阅[此处](http://ajaxian.com/archives/foreignobject-hey-youve-got-html-in-my-svg)了解更多信息。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-09-14T14:26:32.517

不知道，如果这仍然有用，但您只能使用 1 个 JSON。

只需返回 d.something_else_than_name 并且此“something_else_than_name”必须在 JSON 中的“name”之后进行描述。

所以，例如

```
{"name": "stackoverflow", "link": "http://stackoverflow.com"}, 
```

然后在您的页面中返回它，如前所述：

```
.attr("xlink:href", function(d) { return d.link; }) 
```

希望这对某人有帮助。

# c# - 实体框架的 GroupBy / Sum 查询问题

> ID：10588498
> 
> 赞同：0
> 
> 时间：2012-05-14T17:52:12.947
> 
> 标签：c#, entity-framework, entity-framework-4, linq-to-entities

您好，我对实体框架中的查询有疑问

我的父项是`workorders`

我的子项目是`workorderitems`

我想从`workorderitems`表中选择`workorder_id`列与我的变量（myid）匹配的所有项目。结果应按项目名称分组，数量应相加。

此外，如果我删除`GroupBy`and`Select`语句，查询确实会返回结果但是使用`GroupBy`and`Select`语句我得到一个错误。

下面是我的语法：

```
var workorderitems= DBContext.WorkOrderItems
.Where(o => o.workorder_id == myid)
.GroupBy(grp => new { grp.ItemName })
.Select(result => new { itemname = result.Key.ItemName, qty = result.Sum(o => o.ItemQuantity) });

   var mycount = workorderitems.Count(); 
```

有人可以告诉我我的语法是否正确吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2015-05-29T15:36:38.743

您实际上不必使用单独的 Select，通过使用 GroupBy 方法的重载之一，您可以使用 'keySelector' 和 'resultSelector' 参数来组合 group 和 sum。

GroupBy 是一种非常强大的方法，一开始可能会让人望而生畏，但一旦你开始了解它，它就会相当直接且用途广泛。

这是一个示例，它创建了一个 WorkOrderItems 列表，每个组一个，结果汇总在其中；而不是返回一个匿名对象列表。您可以使用多个键选择器（按子句分组）对其进行扩展，并对结果对象进行各种求和和操作...

```
class Program
{
    static void Main(string[] args)
    {
        var myItems = new List<WorkOrderItem>
        {
            new WorkOrderItem { OrderId = 1, ItemName = "A", ItemQuantity = 0 },
            new WorkOrderItem { OrderId = 0, ItemName = "A", ItemQuantity = 1 },
            new WorkOrderItem { OrderId = 0, ItemName = "A", ItemQuantity = 2 },
            new WorkOrderItem { OrderId = 0, ItemName = "B", ItemQuantity = 3 },
            new WorkOrderItem { OrderId = 0, ItemName = "B", ItemQuantity = 4 },
            new WorkOrderItem { OrderId = 1, ItemName = "B", ItemQuantity = 5 },
            new WorkOrderItem { OrderId = 0, ItemName = "C", ItemQuantity = 6 },
        };

        int myId = 0;

        List<WorkOrderItem> groupedItems =
            myItems.Where(i => i.OrderId == myId)
                    .GroupBy(
                        //key selector
                        i => i.ItemName,
                        //result selector
                        (name, items) =>
                        {
                            var aggregatedItem = new WorkOrderItem
                            {
                                OrderId = myId,
                                ItemName = name,
                                ItemQuantity = items.Sum(i => i.ItemQuantity)
                            };
                            return aggregatedItem;
                        })
                        .ToList();

    }

    class WorkOrderItem
    {
        public int OrderId { get; set; }
        public string ItemName { get; set; }
        public int ItemQuantity { get; set; }
    }
} 
```

要进一步阅读 Linq 中最被低估的方法之一，我强烈建议您查看 Jon Skeet 的这篇博客文章：http: [//codeblog.jonskeet.uk/2011/01/01/reimplementing-linq-to-对象-part-21-groupby/](http://codeblog.jonskeet.uk/2011/01/01/reimplementing-linq-to-objects-part-21-groupby/)

# objective-c - 从“主”向其他进程重新发送苹果事件

> ID：10588500
> 
> 赞同：0
> 
> 时间：2012-05-14T17:52:22.853
> 
> 标签：objective-c, events

应用程序未运行。插件将文件发送到应用程序以打开其。应用程序执行 'application:openFiles:' 方法。在此应用程序的“main.m”中，通过“[NSTask launchTaskWithLaunchPath:arguments:]”运行另一个进程。谁能告诉我，如何在具有相同参数的第二个进程中执行“应用程序：openFiles：”，因为第二个进程不知道要打开的已发送文件。
也许还有另一种方法可以制作这个东西？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-05-14T18:00:10.017

你在找`-[NSWorkspace openFile:withApplication:]`吗？

# mysql - mysql LIKE 如何对其结果进行排序？

> ID：10588505
> 
> 赞同：1
> 
> 时间：2012-05-14T17:52:44.943
> 
> 标签：mysql, database, sql-like

我理解它的方式，当 MySQL 执行`LIKE`查询时，根据您设置查询`(%)string(%)`的方式，搜索字符串会在您选择的内容中查找精确的文本匹配。

我很好奇如何以及是否根据找到的匹配对结果行进行排序？

例如，如果针对具有以下内容的表查询我的查询`LIKE`字符串：`'frankly'`

```
id  content
-------------
1   frankly, i find cake rather delicious
2   frankly, i find cake repulsive, frankly
3   i currently live on franklyn street 
```

任何特定的行会比其他行更受青睐吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2012-05-14T17:54:29.920

MySql 不保证这样的 LIKE 查询的顺序。一般来说，如果你想要一个特定的订单，你必须使用 ORDER BY 来指定它。

具体顺序取决于许多其他因素，例如连接类型（Hash-join、Merge-join 等）和数据访问方法（索引扫描、顺序扫描等）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-05-14T17:56:26.177

LIKE 是一种过滤器。

Like 与 sort 本身并没有真正的关系。

如果您没有添加任何显式排序，则默认情况下对行进行排序（我猜是按键）。

# f# - 类型推断：函数与类型

> ID：10588506
> 
> 赞同：3
> 
> 时间：2012-05-14T17:52:46.140
> 
> 标签：f#

我正在学习 F#，但我不明白类型推断和泛型在这种语言中是如何工作的。例如，我可以声明一个通用的 min 函数并将其与不同类型的参数一起使用：

```
let min a b = if a < b then a else b

let smallestInt = min 3 5
let smallestFloat = min 3.0 5.0 
```

但是如果我用一个类型尝试同样的事情，它就行不通了：

```
type Point2D(x, y) = 
    member this.X = x
    member this.Y = y

let float32Point = new Point2D(0.0f, 1.0f)
let intPoint = new Point2D(0, 1) // This expression was expected to have type 
                                 // float32 but here has type int 
```

所以，我有几个问题：

*   为什么我可以为不同的类型重用泛型函数定义而不是类型定义？
*   该函数是否像 C# 泛型一样在运行时专门针对每种类型？还是在编译时像 C++ 模板？或者是否执行拳击以将每个参数视为 IComparable？

谢谢。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2012-05-14T18:04:44.000

类需要显式类型参数。这有效：

```
type Point2D<'T>(x:'T, y:'T) = 
    member this.X = x
    member this.Y = y

let float32Point = Point2D(0.0f, 1.0f)
let intPoint = Point2D(0, 1) 
```

要回答你的第二个问题，你的定义`min`有签名`'a -> 'a -> 'a (requires comparison)`。`comparison`约束仅在编译时存在（运行时签名相同，减去约束）。

`<`替换为对 的调用`GenericLessThanIntrinsic`，该调用具有约束。约束仅传播给调用者。

此外，从规范的第 14.6.7 节：

> 泛化是在可能的情况下为定义推断泛型类型的过程，从而使构造可与多种不同类型重用。**默认情况下，泛化应用于所有函数、值和成员定义**，本节后面列出的情况除外。泛化也适用于在对象表达式中实现泛型虚方法的成员定义。

*（重点补充）*

请注意，列表中缺少类。我想它没有给出理由，但它*是*设计使然。

# extjs - 拍照并显示在视图上

> ID：10588509
> 
> 赞同：1
> 
> 时间：2012-05-14T17:52:56.423
> 
> 标签：extjs, cordova, sencha-touch, sencha-touch-2

我有一个按钮，当用户点击它时，相机打开用户应该可以拍照，然后将其显示在视图上。

当用户单击按钮时，将执行以下方法；

```
imageButtonClicked: function () {
// This is where I should be calling the camera, taking the pic and displaying on the view
} 
```

1.  我发现这个教程解释了如何拍照。但我不明白应该粘贴哪些代码才能使相机功能正常工作。有人可以帮我吗？
2.  拍照后，如何将其显示在视图上？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2013-03-05T14:23:23.157

在新的 iOS 6::

iOS 中新推出的 Mobile Safari 现在支持“文件”输入字段。您的输入字段现在将是 ::

对于单个文件

```
<input type=file accept="image/*">
<input type=file accept="video/*"> 
```

对于多个文件

```
<input type=file multiple> 
```

这将打开 iOS 设备的照片库，并让您选择多张照片。这是它的样子

![iOS 6 中新文件对话框的屏幕截图](../Images/8e9ef188e7bfc83355dc4210ff19490d.png)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-05-14T18:01:24.483

您可以使用[Ext.device.Camera 的 capture()](http://docs.sencha.com/touch/2-0/#!/api/Ext.device.Camera-method-capture)或[Phonegap Camera API 来完成](http://docs.phonegap.com/en/1.7.0/cordova_camera_camera.md.html#Camera)

例如，使用 Phonegap 相机 API

您可以在`imageButtonClicked : function() {}`方法中编写以下代码。

```
.....
.....
navigator.camera.getPicture(onSuccess, onFail, { quality: 50,
    destinationType: Camera.DestinationType.DATA_URL
 }); 

function onSuccess(imageData) {
    var image = Ext.getCmp('myImageId');
    image.setSrc("data:image/jpeg;base64," + imageData);
}

function onFail(message) {
    alert('Failed because: ' + message);
}
.....
..... 
```

# ruby-on-rails - Rails form_for，有一个没有标签的 text_field（不使用 CSS）

> ID：10588512
> 
> 赞同：1
> 
> 时间：2012-05-14T17:53:00.143
> 
> 标签：ruby-on-rails, css, label, form-for

我知道这很容易，只需删除 f.label，但它会改变定位（即，必须添加填充）。

有没有办法在没有样式的情况下做到这一点？

我试过

```
f.label :example, "" 
```

但这仍然会产生“示例”

任何输入表示赞赏。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-05-14T18:51:18.197

**做你所要求的当然是一个不好的做法。**

我要做的是，

1.  使用 headers ( `<th></th>`) 作为标签作为 html 中的第一行`(<tr></tr>)`，其余的 text_fields 作为后续行。
2.  我确定某种循环正在生成该表单，从循环中取出 label_tag 并仅将 text_filed_tags 保留在循环内。

# linux - 如何使用 Linux 命令创建没有重复（未排序）的文件？

> ID：10588515
> 
> 赞同：1
> 
> 时间：2012-05-14T17:53:23.077
> 
> 标签：linux, command

（我知道有一个类似的帖子，但是给出的解决方案对我不起作用，因为它只适用于这种情况。）

我有这样的东西（File1.txt）：

```
digraph G {
1 [shape="oval" label= "Open"] 
... 
8->9 [style="dashed" label= "true"]
...
2 [shape="oval" label= "Close"] 
8->9 [style="dashed" label= "true"]
...
} 
```

我想要一个看起来像这样的新文件（File.txt）：

```
digraph G {
...
1 [shape="oval" label= "Open"]  
8->9 [style="dashed" label= "true"]
...
} 
```

我尝试使用`sort -u File1.txt >> File.txt`但我不希望它排序，我需要它按原始顺序。

提前致谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-05-14T18:07:21.640

您可以在不使用 AWK 排序的情况下执行此操作：

```
awk '!x[$0]++' file > newfile 
```

# java - 使用 Spring MVC 的 JSP 获取/发布

> ID：10588517
> 
> 赞同：1
> 
> 时间：2012-05-14T17:53:30.087
> 
> 标签：java, spring, jsp, spring-mvc

我正在尝试创建一个注册表单。在这种形式中，有一些字段（用户名、密码等）和一个下拉列表框。我的问题是这个列表框。我设法从服务器成功检索将添加到列表框中的所有项目，我想知道把它放在这个表单中。

更具体地说，我有一个名为 lista 的列表，其中包含我要在列表框中添加的项目。

JSP：

```
<c:url var="attinto" value="/reg" />
<form:form modelAttribute="attribute" method="POST" action="${attinto}">
<table>
    .
            .

    <tr>
        <td><form:label path="researchareas">Research area:</form:label></td>
        <td>    
          <select multiple="multiple">   
            <c:forEach items="${researchareas}" var="researcharea">     
              <option value="${researcharea}">  ${researcharea} </option>                   
            </c:forEach>
          </select>    
        </td> 
    </tr> 
```

控制器：

```
 @RequestMapping(value = "/reg", method = RequestMethod.GET)
    public String getform(Model model) {

        getAll(model);
        model.addAttribute("attribute", new Reg());

        return "reg";
    } 
```

在这一点上我不得不提到 getAll(model) 是一个类似于以下的 void 方法：

```
 model.addAttribute("researchareas",lista); 
```

然后我创建一个 POST 方法来发送这些数据。

问题：如何将列表中的数据添加到表单中（到列表框中）？如何取回用户将选择的值？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-05-14T18:03:16.963

首先，`form:select`像这样使用：

```
<form:select path="researchareas" items="${researchareas}" multiple="true" /> 
```

然后 Spring 可以自动绑定 Registration 对象中的相应属性：

```
@RequestMapping(value = "/registration", method = RequestMethod.POST)
public String getRegistrationForm( //
    @ModelAttribute("registrationAttribute") Registration registration, //
    BindingResult result, Model model) {
  ...
  return ...
} 
```

假设注册类具有以下内容：

```
public class Registration {
  String username;
  String password;
  List<String> researchareas;

  ... corresponding getters and setters here
} 
```

虽然我将属性命名为与类相同，否则您必须在方法参数注释中指定显式名称。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-05-15T09:43:40.093

请在 jsp 中的表单中指定**post**方法，并在控制器中指定**method=RequestMethod.POST**。

还有一件事。

在您的注册类中，不应该将列表作为研究领域的数据类型。尝试将数据类型指定为**String[]**

希望这对你有用。干杯。

# java - 将方法放在与主类文件不同的类文件中

> ID：10588518
> 
> 赞同：1
> 
> 时间：2012-05-14T17:53:33.360
> 
> 标签：java, class, methods, main

所以我可以将我所有的方法放在我的主要方法所在的同一个文件中，但我个人讨厌填充一个充满方法的文件，我将使用一次并且永远不会回来。他们似乎只是妨碍了阅读我所写的内容。因此，出于组织目的，我一直将它们放在单独的文件中，只调用类和方法。

所以我的问题是：这样做有什么缺点吗？为什么我不应该这样做？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-05-14T17:56:04.780

是的，你应该这样做。不仅如此，您还应该创建封装您的设计需求的*类（和/或接口）；*每个类都将放在自己的文件中，并且每个类都有与该类的操作相关的方法。

这些类及其方法定义了一个*API*，这是开发人员与代码交互的方式。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-05-14T18:00:00.047

你所有的方法都是静态的吗？然后，您可以根据自己的喜好将它们放在课堂上。否则，您必须根据程序的逻辑将实例方法组合到类中。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-05-14T18:06:28.097

/* 假设您了解如何正确地将程序分解为类。*/

Java 中没有部分类支持（与 C# 不同）；一个类的所有方法都应该在同一个文件中。如果你保持你的类简短并且每个文件只保留几个（例如一个）类，这不会妨碍可读性。

要在工作时从视线中删除不必要的细节，请看一下折叠，即在视觉上将代码块减少到一行。每个理智的 IDE 都可以折叠代码块和方法。emacs 和 vim 都有折叠模式。

# java - 文件 I/O：从一个文件读取并写入另一个文件（Java）

> ID：10588525
> 
> 赞同：8
> 
> 时间：2012-05-14T17:53:54.050
> 
> 标签：java, file, io

我目前正在我的 cpe 课程的实验室工作，我们必须创建一个简单的程序，从 .txt 文件中扫描字符串并将它们打印到不同的 .txt 文件中。到目前为止，我已经制定了基本程序，但是尽管我拥有所有必要的文件，但我的异常仍然被抛出。谁能帮我调试？

```
import java.io.*;
import java.util.*;

public class FileIO {

public static void main(String args[]) {        
    try {
        File input = new File("input");
        File output = new File("output");
        Scanner sc = new Scanner(input);
        PrintWriter printer = new PrintWriter(output);
        while(sc.hasNextLine()) {
            String s = sc.nextLine();
            printer.write(s);
        }
    }
    catch(FileNotFoundException e) {
        System.err.println("File not found. Please scan in new file.");
    }
}
} 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2012-05-14T17:58:11.470

您需要弄清楚它在哪里查找`"input"`文件。当您只指定时，它会在**当前工作目录**`"input"`中查找文件。使用 IDE 时，此目录可能不是您认为的那样。

 **尝试以下操作：

```
System.out.println(new File("input").getAbsolutePath()); 
```

查看它在哪里查找文件。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2012-05-14T18:05:48.210

也许你只是忘记了`flush()`

```
 try {
            File input = new File("input");
            File output = new File("output");
            Scanner sc = new Scanner(input);
            PrintWriter printer = new PrintWriter(output);
            while (sc.hasNextLine()) {
                String s = sc.nextLine();
                printer.write(s);
            }
            **printer.flush();**
        }
        catch (FileNotFoundException e) {
            System.err.println("File not found. Please scan in new file.");
        } 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2012-05-14T17:55:38.073

使用 Java I/O 访问文件时，必须包含文件的文件类型扩展名（如果存在）。

```
 File input = new File("input.txt");
    File output = new File("output.txt"); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2016-12-22T05:23:39.770

我们可以通过使用**FileInputStream对象读取文件并使用****FileOutputStream**对象写入另一个文件来做到这一点。

这是示例代码

```
package java_io_examples;
import java.io.FileInputStream;
import java.io.FileOutputStream;
import java.util.Vector;

public class Filetest {

   public static void main(String[] args) {

     try {

           FileInputStream fin = new FileInputStream("D:\\testout.txt");

           int i = 0;
           String s = "";

           while((i=fin.read())!=-1) {

               s = s + String.valueOf((char)i);

           }

           FileOutputStream fout = new 
           FileOutputStream("D:\\newtestout1.txt");
           byte[] b = s.getBytes();

           fout.write(b);
           fout.close();

           System.out.println("Done reading and writing!!");

      } catch(Exception e){
         System.out.println(e);
      }

    }

 } 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2017-10-31T08:22:33.087

```
public void readwrite() throws IOException 
{
    // Reading data from file
    File f1=new File("D:/read.txt");
    FileReader fr=new FileReader(f1);
    BufferedReader br=new BufferedReader(fr);

    String s = br.readLine();

    // Writing data
    File f2=new File("D:/write.txt");
    FileWriter fw=new FileWriter(f2);
    BufferedWriter bw=new BufferedWriter(fw);
    while(s!=null)
    {
        bw.write(s);
        bw.newLine();
        System.out.println(s);
        s=br.readLine();

    }
    bw.flush();
    bw.close();

} 
```**

# ios - 正在调用 viewDidLoad 以响应地图套件半径的设置视图控制器

> ID：10588530
> 
> 赞同：0
> 
> 时间：2012-05-14T17:54:28.157
> 
> 标签：ios, uiviewcontroller, mapkit

我有一个显示 UIMapKit 片段的 ViewController。所有 MapKit 部分都在 viewDidLoad 中处理。我还有一个设置视图控制器，可以更改加载地图的半径。

对于模态视图，我设置了一个在 LocationsMapViewController 上调用的委托。我目前正在这样做：

```
-(void) updateMapUI
{
  NSLog(@"here is my update in updateMapUI");
  //[self initWithCoordinate:self.coordinate locations:self.locations];
  //[self loadView];
  [self viewDidLoad];
} 
```

但这似乎有点不雅。有没有更好、更优雅的方法来做到这一点？或者这样可以吗？我第一次实施这样的事情，只是想要一些反馈。

谢谢

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-05-14T18:01:08.287

是的！你不应该直接调用它。请记住，您应该调用超类`viewDidLoad`，这可能会产生意想不到的后果。换个方式怎么样...

```
- (void) viewDidLoad
{
   [super viewDidLoad];
   [self updateMapUI];
}

-(void) updateMapUI
{
  NSLog(@"here is my update in updateMapUI");
  //[self initWithCoordinate:self.coordinate locations:self.locations];
  //[self loadView];

  // Update your Map here

} 
```

......*请*告诉我你不是`[self initWithCoordinate:self.coordinate locations:self.locations]`从内部打电话`viewDidLoad`！

# mysql - 当我想获得某个列的最大值/最小值时，MySQL 替代使用 LIMIT 解决方案

> ID：10588533
> 
> 赞同：0
> 
> 时间：2012-05-14T17:54:32.697
> 
> 标签：mysql

所以我需要找到人口最多的部落（名为 pleme 的表）。要得到它，我需要通过 pid（玩家 ID）组合以下 3 个表：naselje 和 igralec，因为我需要从 naselje 获取人口，并且通过使用 tid (tribe id) 将 igralec 与 pleme 连接起来获得部落的名称后。我写了以下内容，它运行良好：

```
select p.*, sum(n.population) as populacija   
from naselje n, igralec i, pleme p
where n.pid = i.pid and i.tid = p.tid
group by tid
order by populacija desc
limit 1; 
```

这里唯一的缺点是限制 1 查询，因为可能有多个具有相同值的列......必须有另一种方法来解决这个问题而不使用 LIMIT

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-05-14T18:17:10.450

您的查询将始终需要构建整个内部表并按组求和，以便找出最高人口的答案。所有限制都是从最后一组中获取第一个项目。您真正关心的可能是不必对结果进行排序。我想不出比你更好的方法了。

# python - 使用 paramiko 进行慢速公钥认证

> ID：10588535
> 
> 赞同：3
> 
> 时间：2012-05-14T17:54:36.617
> 
> 标签：python, paramiko, ssh-keys

我正在使用 paramiko 通过 ssh 连接到远程服务器。使用公钥进行身份验证时，性能很慢（约 90 秒）。这是相关的日志记录输出：

```
2012-05-14 17:37:21,378 Ciphers agreed: local=aes128-ctr, remote=aes128-ctr 
2012-05-14 17:37:21,378 using kex diffie-hellman-group1-sha1; server key type ssh-rsa; cipher: local aes128-ctr, remote aes128-ctr; mac: local hmac-sha1, remote hmac-sha1; compression: local none, remote none 
2012-05-14 17:37:21,481 Switch to new keys ... 
2012-05-14 17:37:21,483 Adding ssh-rsa host key for 10.12.34.56: 8a05c68a0707a9fad19290c22542a338 
2012-05-14 17:37:21,485 Trying discovered key 3793c7b9c500f52c12e190e92e21713f in /home/david/.ssh/id_rsa 
2012-05-14 17:37:21,513 userauth is OK 
2012-05-14 17:38:54,370 Authentication (publickey) successful! 
```

注意最后两行日志输出之间的延迟。当使用 ssh 从命令行连接同一用户和远程服务器时，连接是即时的。任何想法是什么导致延迟？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-07-25T10:58:28.350

`pycrypto>=2.5`很慢。降级到 后`pycrypto==2.4.1`，我看到了 25 倍的改进。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-06-12T12:50:27.257

经过大量实验后，延迟似乎与密钥的长度有关。我使用的第一个密钥是 4096 位。当我切换到更短的（2048 位）密钥时，验证所需的时间急剧下降（< 2 秒）。

# asp.net - 我在哪里可以找到一个好的 asp.net 4.0 FAQ 系统？

> ID：10588536
> 
> 赞同：0
> 
> 时间：2012-05-14T17:54:39.457
> 
> 标签：asp.net, visual-studio

我已经用谷歌搜索了很长时间，而不是程序员，我正在寻找一个常见问题解答系统/asp.net 4.0。我找不到任何可以帮助我构建非数据库驱动的常见问题解答系统的东西。例如，[FAQ Lite](http://www.hotscripts.com/listing/faq-lite/) 是完美的，但它不是用 asp.net 编写的。

任何人都可以帮助我**建立**一个非数据库驱动的常见问题解答系统吗？谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-05-14T18:07:40.767

我认为这就是你所需要的，根据你提到的在 Jquery 中很容易做到，如下文所示。

[http://tutorialzine.com/2010/08/dynamic-faq-jquery-yql-google-docs/](http://tutorialzine.com/2010/08/dynamic-faq-jquery-yql-google-docs/)

# c# - 如何以 MM/DD/YYYY 格式保存日期

> ID：10588547
> 
> 赞同：0
> 
> 时间：2012-05-14T17:55:47.317
> 
> 标签：c#, asp.net-mvc-3, c#-4.0, c#-3.0

我有 2012 年的一年，我想将 01/01/2012 保存到数据库中，而不添加时间，只有日期而不是 2012 年 1 月 1 日。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-05-14T17:58:10.797

除非您尝试将字符串保存到数据库中，否则它的格式并不重要，只要您捕获重要部分即可。数据库中的日期字段将始终包含您未使用的日期的那些“字段”。取出后如何格式化完全取决于您。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-05-14T17:58:27.503

您只需要

```
date.ToString("dd/mm/yyyy") 
```

# c++ - 使用系统调用处理退出状态

> ID：10588548
> 
> 赞同：1
> 
> 时间：2012-05-14T17:55:49.947
> 
> 标签：c++, unix, operating-system, system-calls

好的，我想在我的子进程完成执行后打印它的返回状态。

该代码是能够基本上模仿`system()`使用`execl()`.

我的问题是`printf("The exit status of the process is : %d",status);`我的 main 函数中的行甚至没有执行，它等待 5 秒，因为当我运行它时，它`sleep(5)`总是在终端上打印。`"Alarm clock"`相反，我希望它返回从我的系统函数返回的孩子的退出状态。

我在这里做错了吗？

```
#include<iostream>
#include<stdio.h>
#include<stdlib.h>
#include<errno.h>
#include<sys/types.h>
#include<sys/wait.h>
#include<unistd.h>
#include<signal.h>
using namespace std;

void wakeup() {};

int sleep(int timer)
{
    struct sigaction action;
    //action.sa_handler = wakeup;
    action.sa_flags=0;
    sigemptyset(&action.sa_mask);

    if (sigaction(SIGALRM, &action, 0)==-1)
    {
        perror("sigaction");
        return -1;
    }
    (void)alarm(timer);
    (void)pause();
    return 0;
}

int system(const char *cmd)
{
        pid_t pid;
        int status;
        pid = fork();
        if (pid==0) //child
        {
            execl("/bin/sh","sh","-c",cmd,0);
            perror("execl");
            exit(errno);
        }
        /*if(sleep(5)==-1)
        {
            perror("sigaction");
        }*/
        sleep(5);
        if(waitpid(pid,&status,0)==pid && WIFEXITED(status))
            return WEXITSTATUS(status);

        return -1;
}
int main(int argc,char *argv[])
{
        int status;
        if(argc!=2)
        {
          cout<<"Usage Error\nCorrect usage:./a.out <cmd>\n";
          exit(0);
        }
        else
        {
            status=system(argv[1]);
            if(status!=0)
            {
                cout<<"The exit status of the process is : %d"<<status;
            }
        }
        return 0;
} 
```

**解决方案：** 感谢 Dave S 帮助我完成了这项任务。

最初的作业问题是： `Write a program which should accept one command(like date/time/find..or any user created executable file) and run it by its child process, if the child process takes more than five seconds to run the command,parent should terminate the child process, else if the child terminates before 5 seconds-print exit status of the child.`

完成代码：

```
#include<iostream>
#include<stdio.h>
#include<stdlib.h>
#include<errno.h>
#include<sys/types.h>
#include<sys/wait.h>
#include<unistd.h>
#include<signal.h>
using namespace std;
bool timeup=false;
void wakeup(int signum) {
    if(signum==SIGALRM)
    {
        timeup=true;
    }
};

int sleeper(int timer)
{
    struct sigaction action;
    action.sa_handler = wakeup;
    action.sa_flags=0;
    sigemptyset(&action.sa_mask);

    if (sigaction(SIGALRM, &action, 0)==-1)
    {
        perror("sigaction");
        return -1;
    }
    (void)alarm(timer);
    //(void)pause();
    return 0;
}

int system(pid_t *pid,const char *cmd)
{

        int status;
        *pid = fork();
        if (*pid==0)    //child
        {
        sleep(6); // remove or modify value to change how long the process will minimally take to execute
            execl("/bin/sh","sh","-c",cmd,0);
            perror("execl");
            exit(errno);
        }

        return 0;
}
int main(int argc,char *argv[])
{
        int status=-999;
    pid_t pid;
        if(argc!=2)
        {
          cout<<"Usage Error\nCorrect usage:./a.out <cmd>\n";
          exit(0);
        }
        else
        {

        system(&pid,argv[1]);

        sleeper(5);// the timer for 5 seconds

        if(waitpid(pid,&status,0)==pid && WIFEXITED(status))
                status = WEXITSTATUS(status);
        if(!timeup)
                cout<<"The exit status of the process is :"<<status<<"\n";
        else
        {
        cout<<"Took more that 5 seconds..Stopping\n";
        kill(pid, SIGTERM);
        //exit(0);
        }

        }
        return 0;
} 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-05-14T18:09:34.030

首先，除非您的目标也是模仿，否则`sleep()`我只会使用它而不是自己编写。

也就是说，您没有初始化`sa_handler`sigaction 结构的字段。因此，我相当肯定您将采用默认操作。SIGALRM 的默认操作是终止进程。

我将修改`wakeup()`函数以接受整数，然后使用它来初始化 sa_handler 字段，正如您已注释掉的那样。

# makefile - 使产生“命令在第一个目标之前开始”错误

> ID：10588551
> 
> 赞同：5
> 
> 时间：2012-05-14T17:56:04.330
> 
> 标签：makefile

我是 linux 驱动程序开发的新手。

我正在写 helloworld 驱动程序。

这是代码：

```
#define MODULE
#define __KERNEL__
#include <module.h>
int init_module() 
{
 return 0;
}

void cleanup_module()
{
 return;
} 
```

这是makefile：

```
 CC=gcc
    MODFLAGS:= -O3 -Wall -DLINUX
    module.o: module.c
    $(CC) $(MODFLAGS) -c module.c 
```

但是当我运行 make 命令时，我有以下内容： makefile:3: *** “commands started before first target” 错误

怎么了？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2012-05-14T18:27:04.043

从不是*命令*的每一行中删除生成文件中的前导选项卡：

```
CC=gcc
MODFLAGS:= -O3 -Wall -DLINUX
module.o: module.c
    $(CC) $(MODFLAGS) -c module.c 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2013-03-05T04:46:04.377

尽管您的情况并非如此，但我遇到了相同的错误消息，但原因不同。所以我也在这里回答，以便将来遇到错误消息时可以帮助他们，但原因并不像你的情况那么明显。

这是一个引发错误条件的最小示例，它仅通过名称中带有等号的文件匹配 the `$(wildcard)`（显然，出于演示目的，我*仅*将文件名与 a匹配`=`）。`$(FILES)`严格来说，使用什么方法来检索变量的名称并不重要。

```
FILES := $(wildcard ./*=*)

.PHONY: all

define foo
all: something-$(1)
something-$(1): $(1)
    cat $$^ > $$@
endef

$(foreach goal,$(sort $(FILES)),$(eval $(call foo,$(goal)))) 
```

问题似乎在于扩展发生的方式 - 在这种情况下，它只会由于宏而发生。

无论如何，当我最终收到此错误消息时，我感到很困惑，而 make 文件本身 - 也根据版本控制 - 没有改变。直到我意识到这个问题一定有一些间接原因。愿它帮助未来的人寻找答案。

# sql - 按 ID 对前 3 个结果进行分组

> ID：10588556
> 
> 赞同：1
> 
> 时间：2012-05-14T17:56:17.787
> 
> 标签：sql, sql-server, sql-server-2008

我有一张桌子：

```
+---------+--------------------+--------------------------+
| imd_id  | Total TRx per Plan |        plan name         |
+---------+--------------------+--------------------------+
| 1111005 | 397.1556           | Medicaid Illinois (Idpa) |
| 1111005 | 25.7691            | Self Pay                 |
| 1111005 | 24.4355            | Tricare North Region     |
| 1111005 | 15.0312            | 0                        |
| 1111005 | 8.8425             | 0                        |
| 1111005 | 8.3139             | 0                        |
| 1111005 | 7.0534             | 0                        |
| 1111005 | 6.2588             | 0                        |
| 1111005 | 6.0358             | Bravo Health             |
| 1111005 | 5.9872             | 0                        |
| 1111531 | 133.9664           | Medicaid Al              |
| 1111531 | 29.2318            | 0                        |
| 1111531 | 23.2499            | 0                        |
| 1111531 | 21.9774            | 0                        |
| 1111531 | 14.9269            | 0                        |
| 1111531 | 10.1903            | Self Pay                 |
| 1111531 | 5.4962             | 0                        |
| 1111531 | 5.3409             | Bcbs Federal             |
| 1111531 | 4.4801             | 0                        |
| 1111531 | 3.8003             | 0                        |
+---------+--------------------+--------------------------+ 
```

并尝试生成看起来像这样的数据

```
+---------+--------------------------+----------+---------------+-----------+----------------------+----------+
| imd_id  |      TopFirstPlan       | TopFirst | TopSecondPlan | TopSecond |    TopThirdPlan     | TopThird |
+---------+--------------------------+----------+---------------+-----------+----------------------+----------+
| 1111005 | Medicaid Illinois (Idpa) | 0.78     | Self Pay      | 0.05      | Tricare North Region | 0.04     |
| 1111531 | MEDICAID ALABAMA (AL)    | 0.5      | Self Pay      | 0.04      | Bcbs Federal         | 0.02     |
+---------+--------------------------+----------+---------------+-----------+----------------------+----------+ 
```

请注意，创建 TOPFIRST、TOP SECOND、TOP THIRD 的方式是相应的`Total TRx per Plan`除以该特定 IMD_ID 的计划总和。

到目前为止，我有这个：

```
 select distinct a.imd_id,'topone'=
    (select top 1 totalrxperplan 
        from book1 b
      where b.imd_id =  a.imd_id)/
      (select SUM(totalrxperplan) 
        from book1 b
        where b.imd_id = a.imd_id)
      ,'topplan2'=
      (select top 1 xifinplanname 
        from book1 b
      where b.imd_id =  a.imd_id)
from book1 a
order by 1 asc 
```

此查询将返回：

```
+---------+--------------------------+----------+
| imd_id  |      TopFirstPlan1       | TopFirst |
+---------+--------------------------+----------+
| 1111005 | Medicaid Illinois (Idpa) | 79%      |
| 1111531 | MEDICAID ALABAMA (AL)    | 53%      |
+---------+--------------------------+----------+ 
```

但我需要添加其他列。

请注意，我们将`ignore the plan name where it is 0`

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-05-14T18:33:20.623

```
CREATE TABLE #x(imd_id INT, totalrxperplan FLOAT, xifinplanname NVARCHAR(64));

INSERT #x VALUES
(1111005,397.1556 ,'Medicaid Illinois (Idpa)'),
(1111005,25.7691  ,'Self Pay                '),
(1111005,24.4355  ,'Tricare North Region    '),
(1111005,15.0312  ,'0                       '),
(1111005,8.8425   ,'0                       '),
(1111005,8.3139   ,'0                       '),
(1111005,7.0534   ,'0                       '),
(1111005,6.2588   ,'0                       '),
(1111005,6.0358   ,'Bravo Health            '),
(1111005,5.9872   ,'0                       '),
(1111531,133.9664 ,'Medicaid Al             '),
(1111531,29.2318  ,'0                       '),
(1111531,23.2499  ,'0                       '),
(1111531,21.9774  ,'0                       '),
(1111531,14.9269  ,'0                       '),
(1111531,10.1903  ,'Self Pay                '),
(1111531,5.4962   ,'0                       '),
(1111531,5.3409   ,'Bcbs Federal            '),
(1111531,4.4801   ,'0                       '),
(1111531,3.8003   ,'0                       '); 
```

现在查询：

```
WITH cte1(id,pn,s) AS 
(
    SELECT imd_id, xifinplanname, 
      ROUND(totalrxperplan/SUM(totalrxperplan) OVER (PARTITION BY imd_id),2,1)
    FROM #x WHERE xifinplanname <> '0'
),
cte2(id,pn,s,rn) AS 
(
    SELECT id,pn,s,ROW_NUMBER() OVER (PARTITION BY id ORDER BY s DESC)
    FROM cte1
)
SELECT 
  id, 
  TopFirstPlan  = MAX(CASE WHEN rn = 1 THEN pn END),
  TopFirst      = MAX(CASE WHEN rn = 1 THEN s  END),
  TopSecondPlan = MAX(CASE WHEN rn = 2 THEN pn END),
  TopSecond     = MAX(CASE WHEN rn = 2 THEN s  END),
  TopThirdPlan  = MAX(CASE WHEN rn = 3 THEN pn END),
  TopThird      = MAX(CASE WHEN rn = 3 THEN s  END)
FROM cte2 
WHERE rn <= 3
GROUP BY id; 
```

如果我的假设是正确的，即输出数字与您的不匹配，因为您想在总数中甚至包含“0”计划，而不是在结果中，那么您可以移动 where 子句：

```
WITH cte1(id,pn,s) AS 
(
    SELECT imd_id, xifinplanname, 
      ROUND(totalrxperplan/SUM(totalrxperplan) OVER (PARTITION BY imd_id), 2, 1)
    FROM #x -- < -- removed where clause from here
),
cte2(id,pn,s,rn) AS 
(
    SELECT id,pn,CONVERT(DECIMAL(3,2), s),ROW_NUMBER() OVER 
      (PARTITION BY id ORDER BY s DESC)
    FROM cte1 WHERE pn <> '0' -- <-- moved where clause here
)
SELECT 
  id, 
  TopFirstPlan  = MAX(CASE WHEN rn = 1 THEN pn END),
  TopFirst      = MAX(CASE WHEN rn = 1 THEN s  END),
  TopSecondPlan = MAX(CASE WHEN rn = 2 THEN pn END),
  TopSecond     = MAX(CASE WHEN rn = 2 THEN s  END),
  TopThirdPlan  = MAX(CASE WHEN rn = 3 THEN pn END),
  TopThird      = MAX(CASE WHEN rn = 3 THEN s  END)
FROM cte2 
WHERE rn <= 3
GROUP BY id; 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-05-14T18:28:58.937

如果我理解正确，关键是通过每个 imd_id 中的总数来枚举组。您可以使用 windows 函数 row_number() 来执行此操作。

最终查询类似于：

```
select imd_id,
       max(case when therank = 1 then plan_name end) as firstplan,
       max(case when therank = 1 then tot/imd_tot end) as firstplan_ratio,
       ...
from (select t.*, row_number() over (partition by imd_id order by tot desc) as therank,
             sum(tot) over (partition by imd_id) as imd_tot
      from (select imd_id  plan_name, sum(total_trx_per_plan) as tot
            from t
            group by imd_id  plan_name
           ) t
     ) t
group by imd_id 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-05-14T18:38:03.670

我不确定 Aaron 的总数，而不是每个 ID 的总数，是 OP 想要的，所以这是我的建议，基本上是 Aaron 建议的，但分数值不同：

**更新以纠正错误副本，并考虑“0”规则。**

```
with R1 as (
  select
    imd_id,
    [plan name],
    1e0*[Total TRx per Plan]/sum([Total TRx per Plan]) over (partition by imd_id) as pct,
    row_number() over (
      partition by imd_id
      order by case when [plan name] = '0' then -1 else [Total TRx per Plan] end desc
    ) as rn
  from @Test
) 
  select
    imd_id,
    max(case when rn=1 then [plan name] end) as TopFirstPlan,
    max(case when rn=1 then pct end) as TopFirst,
    max(case when rn=2 then [plan name] end) as TopSecondPlan,
    max(case when rn=2 then pct end) as TopSecond,
    max(case when rn=3 then [plan name] end) as TopThirdPlan,
    max(case when rn=3 then pct end) as TopThird
  from R1
  where rn <= 3
  group by imd_id
  order by imd_id 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-05-14T19:14:52.737

我想出了这样的查询：

```
WITH totals AS (
  SELECT imd_id, sum(t_trx_per_plan) AS ttl
    FROM plans
   GROUP BY imd_id),
ranks(imd_id,t_trx_per_plan,plan_name,prc,rank) AS (
  SELECT p.imd_id,p.t_trx_per_plan,p.plan_name,
    CAST(p.t_trx_per_plan / t.ttl * 100 AS NUMERIC(5,2)) AS prc,
    rank() OVER (PARTITION BY p.imd_id
        ORDER BY (p.t_trx_per_plan / t.ttl * 100) DESC) AS rank
    FROM plans p
    JOIN totals t ON t.imd_id = p.imd_id
   WHERE p.plan_name != '0')
SELECT
    ttl.imd_id,
    f.plan_name AS "FirstPlan",f.prc AS "First",
    s.plan_name AS "SecondPlan",s.prc AS "Second",
    t.plan_name AS "ThirdPlan",t.prc AS "Third"
  FROM totals ttl
  LEFT JOIN ranks f ON f.imd_id = ttl.imd_id AND f.rank = 1
  LEFT JOIN ranks s ON s.imd_id = ttl.imd_id AND s.rank = 2
  LEFT JOIN ranks t ON t.imd_id = ttl.imd_id AND t.rank = 3; 
```

第一个 CTE`totals`给出了`imd_id`每个计划的总交易量列表。第二个CTE`ranks`是排名计划。请注意，我使用了`rank()`函数，如果计划每个计划具有相同数量的事务，它将产生相同的排名。如果要正确处理此类情况，则需要使用`row_number()`窗口函数并在子句中添加额外的`ORDER BY`列`OVER`，唯一的可能是使用：

```
row_number() OVER (PARTITION BY p.imd_id
    ORDER BY (p.t_trx_per_plan / t.ttl * 100) DESC, p.plan_name) AS rank 
```

[您可以在此处](http://www.sqlfiddle.com/#!3/51cac/17)检查输出。

# java - Java/JAXB：使用继承解组 XML

> ID：10588560
> 
> 赞同：2
> 
> 时间：2012-05-14T17:56:38.190
> 
> 标签：java, jaxb, hierarchy, unmarshalling

我需要帮助来注释我的类，以便能够正确地将所有属性/元素映射到正确的类。

我有以下xml：

```
 <?xml version="1.0" encoding="UTF-8"?>
<ResourceList xsi:schemaLocation="http://www.example.com CM.xsd" xmlns="http://www.example.com" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    <Resource xsi:type="customField" lastModifiedDate="2001-12-17T09:30:47.0Z" dataType="Alphanumeric" required="false" id="customField/1" expiryDate="2001-12-17T09:30:47.0Z" expiryReminder="2" targetClass="copyrightHolder" effectiveDate="2001-12-17T09:30:47.0Z" order="0" maximumLength="0" name="a" minimumLength="0" defaultValue="String"/>
    <Resource xsi:type="contact" phoneMobile="String" lastModifiedDate="2001-12-17T09:30:47.0Z" type="a" id="contact/1" phoneOffice="String" email="x@x" expiryDate="2001-12-17T09:30:47.0Z" expiryReminder="2" phoneWork="String" effectiveDate="2001-12-17T09:30:47.0Z" name="a" notify="true"/>
    <Resource xsi:type="document" lastModifiedDate="2001-12-17T09:30:47.0Z" id="document/1" filePath="/docs/document1"/>
    <Resource xsi:type="copyrightHolder" lastModifiedDate="2001-12-17T09:30:47.0Z" type="a" id="copyrightHolder/1" expiryDate="2001-12-17T09:30:47.0Z" expiryReminder="2" effectiveDate="2001-12-17T09:30:47.0Z" name="a" affiliation="a">
        <ExternalId>String</ExternalId>
        <ContactId>contact/1</ContactId>
        <DocumentId>document/1</DocumentId>
        <CustomFieldValue value="String" customFieldId="customField/1"/>
        <Address>String</Address>
    </Resource>
</ResourceList> 
```

我希望在流程结束时有一个包含属于自定义字段类、联系人类、版权等对象的列表。

这是模型的设计方式。

```
@XmlSeeAlso({CopyrightHolder.class})
public class AbstractResource {
    private String name;
    private Date creationDate;
    private Date effectiveDate;
    private Date expiryDate;
    private Long dealExpiryReminder;
    private String id;
    private String lastModifiedDate;

    @XmlAttribute
    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }

    @XmlAttribute
    public Date getCreationDate() {
        return creationDate;
    }

    public void setCreationDate(Date creationDate) {
        this.creationDate = creationDate;
    }

    @XmlAttribute
    public Date getEffectiveDate() {
        return effectiveDate;
    }

    public void setEffectiveDate(Date effectiveDate) {
        this.effectiveDate = effectiveDate;
    }

    @XmlAttribute
    public Date getExpiryDate() {
        return expiryDate;
    }

    public void setExpiryDate(Date expiryDate) {
        this.expiryDate = expiryDate;
    }

    @XmlAttribute
    public Long getDealExpiryReminder() {
        return dealExpiryReminder;
    }

    public void setDealExpiryReminder(Long dealExpiryReminder) {
        this.dealExpiryReminder = dealExpiryReminder;
    }

    @XmlAttribute
    public String getId() {
        return id;
    }

    public void setId(String id) {
        this.id = id;
    }

    @XmlAttribute
    public String getLastModifiedDate() {
        return lastModifiedDate;
    }

    public void setLastModifiedDate(String lastModifiedDate) {
        this.lastModifiedDate = lastModifiedDate;
    }

}

public class CoreResource extends AbstractResource{

    private List<String> documentIds;
    private List<String> contactIds;
    private String externalId;
    private List<CustomFieldValue> customFieldValues;

    @XmlElement
    public List<String> getDocumentIds() {
        return documentIds;
    }

    public void setDocumentId(List<String> documentIds) {
        this.documentIds = documentIds;
    }

    @XmlElement
    public List<String> getContactIds() {
        return contactIds;
    }

    public void setContactId(List<String> contactId) {
        this.contactIds = contactId;
    }

    @XmlElement
    public String getExternalId() {
        return externalId;
    }

    public void setExternalId(String externalId) {
        this.externalId = externalId;
    }

    @XmlElement
    public List<CustomFieldValue> getCustomFieldValues() {
        return customFieldValues;
    }

    public void setCustomFieldValue(List<CustomFieldValue> customFieldValues) {
        this.customFieldValues = customFieldValues;
    }

}

@XmlRootElement(name="ResourceList", namespace="http://www.example.com")
public class ResourceList {

    private List<AbstractResource> resourceList;

    public Resource[] getResource() {
        // TODO Auto-generated method stub
        return null;
    }

    @XmlElement(name="Resource", namespace="http://www.example.com")
    public List<AbstractResource> getResourceList() {
        return resourceList;
    }

    public void setResourceList(List<AbstractResource> resourceList) {
        this.resourceList = resourceList;
    }

}

public class CopyrightHolder extends CoreResource {

    private String address;
    private String affiliation;

    @XmlElement
    public String getAddress() {
        return address;
    }

    public void setAddress(String address) {
        this.address = address;
    }

    @XmlAttribute
    public String getAffiliation() {
        return affiliation;
    }

    public void setAffiliation(String affiliation) {
        this.affiliation = affiliation;
    }

} 
```

当我摄取 xml 时，我得到了一个 AbstractResources 列表，正如预期的那样，但是我希望这些对象是他的 xml 类型。在这个 xml 中，AbstractResource 的第三个元素是版权所有者，第二个元素是文档，依此类推。

是否可以仅使用注释来实现？如果没有，我该怎么做？

谢谢

# ruby-on-rails - 从视图传递到模块

> ID：10588562
> 
> 赞同：0
> 
> 时间：2012-05-14T17:56:48.103
> 
> 标签：ruby-on-rails, ruby-on-rails-3, ruby-on-rails-3.1

我设置了一个视图以允许用户输入 url，并且我在我的库中设置了一个模块，它基本上解析用户输入的这些 url。如何将视图中收到的 url 传递给我的 lib 目录中的这个模块？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-05-14T18:35:33.510

我是这样做的，

将以下代码存储在“lib”目录下的“search_module.rb”中。

```
module SearchModule

  def get_size(search_key)

    search_key.gsub(/[^A-Za-z0-9 ]/,"").squeeze.split.size

  end

end 
```

现在我在我的 search_controller.rb 中访问这个方法，如下所示，

```
class SearchController < ApplicationController

  include SearchModule

  @query_size = get_size(params[:query])

end 
```

现在，重点是，

## 模块：

*应包含可在控制器中使用以实现功能的方法。*

## 帮手：

*应包含可在视图中用于格式化 html 的方法。*

# ruby-on-rails - ActionMailer 将我的邮件分成 72 列，破坏 HTML 邮件中的图像链接

> ID：10588563
> 
> 赞同：0
> 
> 时间：2012-05-14T17:56:48.540
> 
> 标签：ruby-on-rails

红宝石 186，Rails 2.3.4。

我们正在尝试从 Web 地址发送顶部带有徽标的 HTML 电子邮件，但邮件系统使用`=\n`. 然后地址显示为`img src"http://something.com/folder/anotherfo=\nlder/image.png`，当在电子邮件应用程序中查看时，该地址是一个损坏的链接。

我在 mail_helper.rb 中找到了对 72 列的引用

```
def block_format(text)
  formatted = text.split(/\n\r\n/).collect { |paragraph| 
    Text::Format.new(
      :columns => 72, :first_indent => 2, :body_indent => 2, :text => paragraph
    ).format
  }.join("\n")

  # Make list points stand on their own line
  formatted.gsub!(/[ ]*([*]+) ([^*]*)/) { |s| "  #{$1} #{$2.strip}\n" }
  formatted.gsub!(/[ ]*([#]+) ([^#]*)/) { |s| "  #{$1} #{$2.strip}\n" }

  formatted
end 
```

但是该功能似乎根本没有受到影响，所以我不确定这里发生了什么。

我将不胜感激任何建议。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-05-15T08:33:00.920

原来答案是在 text/html 部分的传输编码中。设置 :transfer_encoding => "base64" 解决了这个问题。

# c# - 使用 Oracle 和 .NET 的 TimeZone 时间/日期格式

> ID：10588565
> 
> 赞同：0
> 
> 时间：2012-05-14T17:57:05.643
> 
> 标签：c#, .net, oracle, plsql, oracle-sqldeveloper

我是 Oracle 的新手，希望有人可以为我澄清这种情况。

我编写了一个非常大的查询，它返回一组日期（Oracle 10g）。

在 SQL Developer 中，这些日期以 DD-MON-YY 格式显示（例如：'12-MAY-12'）。SQL Developer 中该字段的数据类型显示它是 Date 类型，并且选中了 Simple 单选按钮。当我在 SQL Developer 中运行此查询时，我得到一个如下所示的日期：

2012 年 5 月 11 日

我在作为 C# Web 服务一部分的程序集中使用此查询。托管 QE 服务器的离岸团队中有人注意到该字段的值正在转换为 IST 偏移量（它已使用 GetXml 为 DataSet 转换为 XML）。问题是，在我在调试器中检查输出之前，我什至不知道偏移量在那里，因为我在 SQL Developer 中看不到它。它是这样过来的：

2012-05-11T06:09:15+05:30

没有使用内在的日期转换功能，只是提取日期的字段名称。

如何修改我的查询，以便在运行查询时不考虑过去的偏移量（我们确实需要保留日期的时间部分）？我知道这个问题听起来很复杂，但最终结果是写入海外另一个数据库的数据包含错误的偏移量，因此它被转换为相差 1 天的日期。

基本上我想要时间而不是偏移量。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-05-14T18:07:43.640

Oracle`DATE`有日期和时间组件，但没有时区。A`TIMESTAMP WITH [LOCAL] TIME ZONE`将具有时区，并且还将具有亚秒级精度。

您可以通过几种不同的方式更改`DATE`数据转换为字符串以进行显示的方式。首先，它使用显式`TO_CHAR`

```
SELECT to_char( <<your_date_column>>, 'YYYY-MM-DD HH24:MI:SS' )
  FROM your_table 
```

其次，您可以更改`NLS_DATE_FORMAT`会话的设置，以便会话始终以特定格式显示数据

```
ALTER SESSION SET nls_date_format = 'yyyy-mm-dd hh24:mi:ss';
SELECT <<your_date_column>>
  FROM your_table 
```

第三，在 SQL Developer 中，您可以更改它用于显示`DATE`数据的字符串格式。如果你去`Tools | Preferences | Database | NLS`，会有一个`Date Format`领域。如果您将其从 更改`DD-MON-RR`为`YYYY-MM-DD HH24:MI:SS`，您将获得默认显示的日期和时间。

# ruby-on-rails - 在初始化期间找不到 Rails 配置变量

> ID：10588566
> 
> 赞同：1
> 
> 时间：2012-05-14T17:57:14.573
> 
> 标签：ruby-on-rails, configuration, initialization, environment-variables

我有一个文件**config/initializers/secrets.rb**包含以下内容：

```
Rails.configuration.smtp_domain = "derp.com"
Rails.configuration.smtp_password = "derpderp"
Rails.configuration.smtp_user = "derp@derp.com"
Rails.configuration.smtp_address = "derp.derp.com" 
```

在我的**config/environments/development.rb**我有以下内容：

```
config.action_mailer.smtp_settings = {
    :address              => Rails.configuration.smtp_address,
    :port                 => 587,
    :domain               => Rails.configuration.smtp_domain,
    :user_name            => Rails.configuration.smtp_user,                           
    :password             => Rails.configuration.smtp_password,
    :authentication       => 'login',                                                 
    :enable_starttls_auto => true                                                     
} 
```

现在，当`bundle exec rails c`我收到此错误时：

```
`method_missing': undefined method `smtp_address' for #<Rails::Application::Configuration:0x007f8c4505b238> (NoMethodError) 
```

但是，如果我将 smtp 配置注释掉，那么在控制台中我可以这样做：

```
Loading development environment (Rails 3.2.1)
irb(main):001:0> Rails.configuration.smtp_address
=> "derp.derp.com" 
```

不过，我不能在生产中对此发表评论！任何帮助将不胜感激，谢谢！

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-05-14T19:04:33.887

从未见过这种情况，但如果我添加`require_relative 'initializers/secrets'`到我的顶部，`environment.rb`它会按我的预期工作。

这让我感到莫名其妙，因为这*是*在一个初始化程序中，据我所知应该已经加载了。

如果有人能解释为什么我会很乐意接受你的回答而不是我自己的回答。谢谢。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-05-14T18:10:57.210

1.  在这里扔一些东西，也许该文件在初始化程序目录中正确？
2.  您可以更改您的`Rails.configuration....`内容并将其更改为常量吗？例如，`SMTP_DOMAIN = 'derp.com'`等等。

只是想知道这是否首先有效，然后您会看到 wtf 正在处理`Rails.configuration....`一些事情。如果这是 TDD，我们会说，让我们把它变成绿色。我个人还没有看到 Rails.configuration 被这样使用，但谁知道呢，也许它是一回事。

# c - 如何导致指令缓存未命中？

> ID：10588567
> 
> 赞同：19
> 
> 时间：2012-05-14T17:57:18.903
> 
> 标签：c, linux, performance, microprocessors

我的任务是生成一定数量的数据缓存未命中和指令缓存未命中。我已经能够毫无问题地处理数据缓存部分。

所以我只剩下生成指令缓存未命中的工作了。我不知道是什么导致了这些。有人可以建议一种生成它们的方法吗？

我在 Linux 中使用 GCC。

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2012-03-20T23:58:28.390

正如人们所解释的，指令缓存未命中在概念上与数据缓存未命中相同——指令不在缓存中。这是因为处理器的程序计数器 (PC) 已跳转到尚未加载到缓存中的位置，或者由于缓存已满而已被刷新，并且该缓存行是选择用于驱逐的缓存行（通常是最近用过的）。

手动生成足够的代码来强制指令未命中比强制数据缓存未命中要困难一些。

不费吹灰之力就能获得大量代码的一种方法是编写一个生成源代码的程序。

例如，编写一个程序来生成一个带有巨大 switch 语句的函数（在 C 中）[警告，未经测试]：

```
printf("void bigswitch(int n) {\n    switch (n) {");
for (int i=1; i<100000; ++i) {
    printf("        case %d: n += %d;\n", n, n+i/2);
}
printf("    }\n    return n;}\n"); 
```

然后你可以从另一个函数中调用它，你可以控制它沿着缓存线的跳跃量。

switch 语句的一个属性是代码可以被强制向后执行，或者通过选择参数以模式执行。所以你可以使用预取和预测机制，或者尝试对抗它们。

同样的技术也可以应用于生成许多函数，以确保可以随意“破坏”缓存。所以你可能有 bigswitch001、bigswitch002 等。你可以使用你也生成的开关来调用它。

如果您可以使每个函数（大约）具有一定数量的 i-cache 行大小，并且还可以生成比缓存中容纳的更多的函数，那么生成指令缓存未命中的问题将变得更容易控制。

您可以通过转储汇编程序（使用 gcc -S）或 objdump .o 文件来准确查看函数、整个 switch 语句或 switch 语句的每个分支有多大。因此，您可以通过调整`case:`语句的数量来“调整”函数的大小。您还可以通过明智地选择 bigswitchNNN() 的参数来选择命中多少缓存行。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2012-03-21T00:03:57.473

除了这里提到的所有其他方法之外，另一个非常可靠的强制指令缓存未命中的方法是使用自修改代码。

如果您写入内存中的一页代码（假设您将操作系统配置为允许这样做），那么相应的指令缓存行当然会立即变得无效，并且处理器被迫重新获取它。

顺便说一下，导致 icache 未命中的不是分支*预测*，而是简单的*分支*。每当处理器尝试运行最近未运行的指令时，您就会错过指令缓存。现代 x86 足够智能，可以按顺序预取指令，因此您不太可能通过从一条指令向前移动到下一条指令来错过 icache。但是任何分支（有条件的或其他的）都会乱序跳转到新地址。如果新的指令地址最近没有运行，并且不在你已经运行的代码附近，它很可能超出缓存，处理器必须停止并等待指令从主 RAM 进入。这与数据缓存完全相同。

一些非常现代的处理器（最近的 i7）能够查看代码中即将出现的分支并启动 icache 预取可能的目标，但许多不能（视频游戏控制台）。从主 RAM 获取数据到 icache 与管道的“指令获取”阶段完全不同，这就是分支*预测*的内容。

“指令获取”是 CPU 执行管道的一部分，是指将操作码从 icache 带入 CPU 的执行单元，在那里它可以开始解码和工作。这与“指令高速缓存”获取不同，后者必须提前多个周期发生，并且涉及高速缓存电路向主存储器单元发出请求以通过总线发送一些字节。第一个是 CPU 流水线的两个阶段之间的交互。第二个是流水线与内存缓存和主 RAM 之间的交互，这是一个更复杂的电路。这些名称令人困惑地相似，但它们是完全独立的操作。

因此，导致指令缓存未命中的另一种方法是编写（或生成）许多非常大的函数，这样您的代码段就会很大。然后疯狂地从一个函数调用到另一个函数，这样从 CPU 的角度来看，你正在对内存进行疯狂的 GOTO。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2012-03-21T01:27:39.190

您的项目需要了解目标系统的缓存硬件，包括但不限于其缓存大小（缓存的整体大小）、缓存行大小（最小的可缓存实体）、关联性以及写入和替换策略。任何设计用于测试缓存性能的真正好的算法都必须考虑所有这些，因为没有一个通用算法可以有效地测试所有缓存配置，尽管您可以设计一个有效的参数化测试例程生成器，它可能会生成一个合适的测试例程，给出足够多的关于给定目标缓存架构的细节。尽管如此，我认为我下面的建议是一个很好的一般情况测试，但首先我想提一下：

您提到您有一个有效的数据缓存测试，它使用“大整数数组 a[100].... [访问] 元素，使得两个元素之间的距离大于缓存行大小（在我的情况下是 32 个字节）。” 我很好奇您如何确定您的测试算法有效，以及您如何确定有多少数据缓存未命中是您的算法的结果，而不是其他刺激引起的未命中。实际上，对于 100*sizeof(int) 的测试数组，您的测试数据区域在当今大多数通用平台上只有 400 字节长（如果您在 64 位平台上可能是 800 字节，或者如果您使用的是 200 字节） '正在使用 16 位平台）。对于绝大多数缓存架构，整个测试阵列将多次放入缓存中，

关于指令缓存：其他人建议使用大型 switch()-case 语句或函数调用不同位置的函数，如果不仔细（我的意思是小心地）设计代码的大小，这两种方法都不会有效不同位置的功能的相应案例分支或位置和大小。这样做的原因是整个内存中的字节以一种完全可预测的模式“折叠”（技术上，“相互别名”）缓存。如果您仔细控制 switch()-case 语句的每个分支中的指令数量，您可能会在测试中取得进展，但如果您只是在每个分支中抛出大量不加选择的指令，

我猜你对汇编代码并不太熟悉，但你必须相信我，这个项目正在为它尖叫。相信我，我不是在不需要的地方使用汇编代码的人，而且我非常喜欢在 OO C++ 中编程，尽可能使用 STL 和多态 ADT 层次结构。但是在您的情况下，确实没有其他万无一失的方法可以做到这一点，并且汇编将为您提供对您真正需要的代码块大小的绝对控制，以便能够有效地生成指定的缓存命中率。您不必成为汇编专家，甚至可能不需要学习实现 C 语言序言和结语所需的指令和结构（Google 为“C 可调用汇编函数”）。你为你的汇编函数编写了一些外部“C”函数原型，你走了。如果您确实想学习一些汇编，那么您在汇编函数中放入的测试逻辑越多，您对测试施加的“海森堡效应”就越少，因为您可以仔细控制测试控制指令的位置（因此它们对指令缓存的影响）。但是对于你的大部分测试代码，你可以只使用一堆“nop”指令（指令缓存并不真正关心它包含什么指令），并且可能只是将处理器的“return”指令放在每个指令的底部代码块。

现在假设您的指令缓存为 32K（按照今天的标准，这非常小，但在许多嵌入式系统中可能仍然很常见）。如果您的缓存是 4 路关联的，您可以创建 8 个独立的内容相同的 8K 汇编函数（希望您注意到的是 64K 的代码，缓存大小的两倍），其中大部分只是一堆 NOP 指令. 您使它们在内存中一个接一个地下降（通常通过简单地在源文件中一个接一个地定义）。然后，您使用仔细计算的序列从测试控制函数中调用它们，以生成您想要的任何缓存命中率（具有相当粗略的粒度，因为每个函数都是完整的 8K 长）。如果你一个接一个地调用第 1、2、3 和 4 个函数，你知道你已经用这些测试函数的代码填充了整个缓存。此时再次调用其中任何一个都不会导致指令缓存未命中（测试控制函数自己的指令驱逐的行除外），但调用其他任何一个（第 5、第 6、第 7 或第 8；让我们只是选择第 5 个）将驱逐其他之一（尽管驱逐哪一个取决于您的缓存的替换策略）。在这一点上，你唯一可以打电话并且知道你不会驱逐另一个人的是你刚刚打电话的人（第 5 个），唯一你可以打电话知道你会驱逐另一个人的是你还没有打电话的人称为（第 6、第 7 或第 8）。为了使这更容易，只需维护一个大小与您拥有的测试函数数量相同的静态数组。要触发驱逐，请调用数组末尾的函数并将其指针移动到数组的顶部，将其他指针向下移动。要不触发驱逐，请调用您最近调用的那个（在数组顶部的那个；在这种情况下，请确保不要将其他的下移！）。如果您需要更精细的粒度，请对此进行一些更改（可能制作 16 个单独的 4K 组装功能）。当然，所有这些都取决于测试控制逻辑的大小与缓存的每个关联“路”的大小相比是微不足道的；对于更积极的控制，您可以将测试控制逻辑放在测试函数本身中，但是为了完美控制，您必须完全设计控制逻辑而没有内部分支（仅在每个组装函数结束时分支），但我认为我会在这里停下来，因为这可能会使事情过于复杂。在这种情况下，请务必不要将其他人向下移动！）。如果您需要更精细的粒度，请对此进行一些更改（可能制作 16 个单独的 4K 组装功能）。当然，所有这些都取决于测试控制逻辑的大小与缓存的每个关联“路”的大小相比是微不足道的；对于更积极的控制，您可以将测试控制逻辑放在测试函数本身中，但是为了完美控制，您必须完全设计控制逻辑而没有内部分支（仅在每个组装函数结束时分支），但我认为我会在这里停下来，因为这可能会使事情过于复杂。在这种情况下，请务必不要将其他人向下移动！）。如果您需要更精细的粒度，请对此进行一些更改（可能制作 16 个单独的 4K 组装功能）。当然，所有这些都取决于测试控制逻辑的大小与缓存的每个关联“路”的大小相比是微不足道的；对于更积极的控制，您可以将测试控制逻辑放在测试功能本身中，但为了完美控制，您必须完全设计控制逻辑而无需内部分支（仅在每个组装功能结束时分支），但我认为我会在这里停下来，因为这可能会使事情过于复杂。当然，所有这些都取决于测试控制逻辑的大小与缓存的每个关联“路”的大小相比是微不足道的；对于更积极的控制，您可以将测试控制逻辑放在测试功能本身中，但为了完美控制，您必须完全设计控制逻辑而无需内部分支（仅在每个组装功能结束时分支），但我认为我会在这里停下来，因为这可能会使事情过于复杂。当然，所有这些都取决于测试控制逻辑的大小与缓存的每个关联“路”的大小相比是微不足道的；对于更积极的控制，您可以将测试控制逻辑放在测试功能本身中，但为了完美控制，您必须完全设计控制逻辑而无需内部分支（仅在每个组装功能结束时分支），但我认为我会在这里停下来，因为这可能会使事情过于复杂。

即开即用且未经测试，x86 的一个汇编函数的全部可能如下所示：

```
myAsmFunc1:
   nop
   nop
   nop  # ...exactly enough NOPs to fill one "way" of the cache
   nop  # minus however many bytes a "ret" instruction is (1?)
   .
   .
   .
   nop
   ret  # return to the caller 
```

对于 PowerPC，它可能看起来像这样（也未经测试）：

```
myAsmFunc1:
   nop
   nop
   nop   # ...exactly enough NOPs to fill one "way" of the cache
   .     # minus 4 bytes for the "blr" instruction.  Note that
   .     # on PPC, all instructions (including NOP) are 4 bytes.
   .
   nop
   blr   # return to the caller 
```

在这两种情况下，调用这些函数的 C++ 和 C 原型都是：

```
extern "C" void myAsmFunc1();    // Prototype for calling from C++ code
void myAsmFunc1(void);           /* Prototype for calling from C code */ 
```

根据您的编译器，您可能需要在汇编代码本身的函数名称前加上下划线（但在您的 C++/C 函数原型中不需要）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-03-20T20:01:52.870

对于指令缓存未命中，您需要执行相距较远的代码段。在多个函数调用之间拆分您的逻辑将是一种方法。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2012-03-20T19:59:03.757

在不可预测的条件（例如输入或随机生成的数据）上的 if else 链，在 if 情况和 else 情况下都有大量指令，其大小大于缓存行。

# c# - 从外部 web.config 获取连接字符串

> ID：10588569
> 
> 赞同：1
> 
> 时间：2012-05-14T17:57:26.433
> 
> 标签：c#, web-config

我有一个 C# .net 3.5 控制台应用程序，需要以编程方式打开 50 个网站文件夹（在同一台服务器上）打开它们的根 web.config 并获取 dbname、用户、密码。

我知道如何在打开它自己的本地 web.config 的单个站点上执行此操作 [如何从 Web.config 获取连接字符串](https://stackoverflow.com/questions/9412361/how-to-get-connection-string-from-the-web-config)

但是控制台应用程序如何加载外部应用程序？

会不会是这样：

```
ConfigurationFileMap fileMap = new ConfigurationFileMap(site-root-path + "/Web.Config");
Configuration configuration = ConfigurationManager.OpenMappedMachineConfiguration(fileMap);
configuration.ConnectionStrings["storeConn"].ConnectionString; 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-05-14T18:03:49.160

Web 配置文件只是一个 XML 文件，因此您可以使用任何 XML 解析器，例如[Linq to XML](http://msdn.microsoft.com/en-us/library/bb387098.aspx)，然后导航到 ConnectionStrings 节点。

# rally - 设置仪表板应用程序的垂直大小

> ID：10588575
> 
> 赞同：1
> 
> 时间：2012-05-14T17:57:51.390
> 
> 标签：rally

有没有办法设置自定义仪表板应用程序的垂直大小？默认情况下，cutsom 应用程序可以垂直扩展或收缩。这并不总是需要或期望的。

此外，2.0 自定义网格和调整大小功能有时无法正常工作（大小无法正确粘贴等），尤其是 2.0 自定义网格底部的标准分页信息。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-05-16T19:49:12.467

从评论中移动答案...哎呀...回答：

在 2012.05.05 Rally 发布之前，AppSDK 1.0 应用程序一直在专用的整页 iFrame 中播放，因此它们不太可能有任何大小调整方法会影响其容器“窗口”。AppSDK 2.0 可能会在某个时候实现这一点 - 开发人员会知道更多。帧大小和定位方法由它们所在的 Rally/仪表板“容器”管理，但如果现在存在任何可能使 SDK 可以访问这些方法的钩子，我会感到惊讶

# php - 使用php从xml获取的yql查询数据覆盖其他金融股票符号的值

> ID：10588577
> 
> 赞同：0
> 
> 时间：2012-05-14T17:57:57.177
> 
> 标签：php, xml, json, curl, yql

这是我用来从 yahoo Finance 股票报价中获取数据的脚本。但我在这里面临问题..并且无法从我得到的答案中找到解决方案。PHP 脚本是...

```
<?php
session_start();

$yql_base_url = "http://query.yahooapis.com/v1/public/yql";  
$yql_query = "select * from yahoo.finance.quotes where symbol in ('XAUUSD=X','XAGUSD=X','PLN12.NYM','PAK12.NYM','USDCAD=X')";  
$yql_query_url = $yql_base_url . "?q=" . urlencode($yql_query);
$yql_query_url .= "&env=http://datatables.org/alltables.env";
$yql_query_url .= "&format=json";
$session = curl_init($yql_query_url);  
curl_setopt($session, CURLOPT_RETURNTRANSFER,true);      
$json = curl_exec($session);
$phpObj =  json_decode($json);  
if(!is_null($phpObj->query->results)){  
}  
if(!is_null($phpObj->query->results)){  
    foreach($phpObj->query->results->quote as $quotes){  
        $_SESSION['Ask'] = $quotes->Ask;
        $_SESSION['Bid'] = $quotes->Bid;
        $_SESSION['AskRealtime'] = $quotes->AskRealtime;
        $_SESSION['BidRealtime'] = $quotes->BidRealtime;
        $_SESSION['LastTradeDate'] = $quotes->LastTradeDate;
        $_SESSION['LastTradePriceOnly'] = $quotes->LastTradePriceOnly;
        $_SESSION['LastTradeTime'] = $quotes->LastTradeTime;
  }  
}  
?> 
```

我打印会话的显示部分或正文部分是......

```
 <body>
    <div>
    <ul>
    <li>Gold Price</li>
    <li><?php echo $_SESSION['Ask'];?></li>
    <li><?php echo $_SESSION['Bid'];?></li>
    <li><?php echo $_SESSION['AskRealtime'];?></li>
    <li><?php echo $_SESSION['BidRealtime'];?></li>
    <li><?php echo $_SESSION['LastTradeDate'];?></li>
    <li><?php echo $_SESSION['LastTradePriceOnly'];?></li>
    <li><?php echo $_SESSION['LastTradeTime'];?></li>
    </ul>
    <ul>
    <li>Silver Price</li>
    <li><?php echo $_SESSION['Ask_2'];?></li>
    <li><?php echo $_SESSION['Bid_2'];?></li>
    <li><?php echo $_SESSION['AskRealtime_2'];?></li>
    <li><?php echo $_SESSION['BidRealtime_2'];?></li>
    <li><?php echo $_SESSION['LastTradeDate_2'];?></li>
    <li><?php echo $_SESSION['LastTradePriceOnly_2'];?></li>
    <li><?php echo $_SESSION['LastTradeTime_2'];?></li>
    </ul>
    <ul>
    <li>Platinum Price</li>
    <li><?php echo $_SESSION['Ask_3'];?></li>
    <li><?php echo $_SESSION['Bid_3'];?></li>
    <li><?php echo $_SESSION['AskRealtime_3'];?></li>
    <li><?php echo $_SESSION['BidRealtime_3'];?></li>
    <li><?php echo $_SESSION['LastTradeDate_3'];?></li>
    <li><?php echo $_SESSION['LastTradePriceOnly_3'];?></li>
    <li><?php echo $_SESSION['LastTradeTime_3'];?></li>
    </ul>
    <ul>
    <li>Palladium Price</li>
    <li><?php echo $_SESSION['Ask_3'];?></li>
    <li><?php echo $_SESSION['Bid_3'];?></li>
    <li><?php echo $_SESSION['AskRealtime_3'];?></li>
    <li><?php echo $_SESSION['BidRealtime_3'];?></li>
    <li><?php echo $_SESSION['LastTradeDate_3'];?></li>
    <li><?php echo $_SESSION['LastTradePriceOnly_3'];?></li>
    <li><?php echo $_SESSION['LastTradeTime_3'];?></li>
    </ul>
    <ul>
    <li>USD to CAD</li>
    <li><?php echo $_SESSION['Ask_3'];?></li>
    <li><?php echo $_SESSION['Bid_3'];?></li>
    <li><?php echo $_SESSION['AskRealtime_3'];?></li>
    <li><?php echo $_SESSION['BidRealtime_3'];?></li>
    <li><?php echo $_SESSION['LastTradeDate_3'];?></li>
    <li><?php echo $_SESSION['LastTradePriceOnly_3'];?></li>
    <li><?php echo $_SESSION['LastTradeTime_3'];?></li>
    </ul>
    </div>
    </body> 
```

但我从上面得到的结果是..
1.0015 1.0005
5/11/2012
1.001
5:55pm

这只是$yql_query 的 'USDCAD **=X'**的会话输出= "select * from ...'PLN12.NYM','PAK12.NYM', 'USDCAD **=X'** )";

查询是..

```
$yql_query = "select * from yahoo.finance.quotes where symbol in ('XAUUSD=X','XAGUSD=X','PLN12.NYM','PAK12.NYM','USDCAD=X')"; 
```

来自 yahoo 网站的 yahoo Finance 报价的 XML 输出是。

```
<query yahoo:count="5" yahoo:created="2012-05-12T22:01:43Z" yahoo:lang="en-US">
<diagnostics>
  <publiclyCallable>true</publiclyCallable>
  <redirect from="http://datatables.org/alltables.env" status="301">http://www.datatables.org/alltables.env</redirect>
  <url execution-start-time="417" execution-stop-time="775" execution-time="358" proxy="DEFAULT">http://datatables.org/alltables.env</url>
  <url execution-start-time="826" execution-stop-time="1040" execution-time="214" proxy="DEFAULT">http://www.datatables.org/yahoo/finance/yahoo.finance.quotes.xml</url>
  <url execution-start-time="1247" execution-stop-time="1261" execution-time="14" proxy="DEFAULT">http://download.finance.yahoo.com/d/quotes.csv?f=aa2bb2b3b4cc1c3c6c8dd1d2ee1e7e8e9ghjkg1g3g4g5g6ii5j1j3j4j5j6k1k2k4k5ll1l2l3mm2m3m4m5m6m7m8nn4opp1p2p5p6qrr1r2r5r6r7ss1s7t1t7t8vv1v7ww1w4xy&s=XAUUSD%3DX,XAGUSD%3DX,PLN12.NYM,PAK12.NYM,USDCAD%3DX</url>
  <query execution-start-time="1045" execution-stop-time="1261" execution-time="216" params="{url=[http://download.finance.yahoo.com/d/quotes.csv?f=aa2bb2b3b4cc1c3c6c8dd1d2ee1e7e8e9ghjkg1g3g4g5g6ii5j1j3j4j5j6k1k2k4k5ll1l2l3mm2m3m4m5m6m7m8nn4opp1p2p5p6qrr1r2r5r6r7ss1s7t1t7t8vv1v7ww1w4xy&s=XAUUSD%3DX,XAGUSD%3DX,PLN12.NYM,PAK12.NYM,USDCAD%3DX]}">select * from csv where url=@url and columns='Ask,AverageDailyVolume,Bid,AskRealtime,BidRealtime,BookValue,Change&PercentChange,Change,Commission,ChangeRealtime,AfterHoursChangeRealtime,DividendShare,LastTradeDate,TradeDate,EarningsShare,ErrorIndicationreturnedforsymbolchangedinvalid,EPSEstimateCurrentYear,EPSEstimateNextYear,EPSEstimateNextQuarter,DaysLow,DaysHigh,YearLow,YearHigh,HoldingsGainPercent,AnnualizedGain,HoldingsGain,HoldingsGainPercentRealtime,HoldingsGainRealtime,MoreInfo,OrderBookRealtime,MarketCapitalization,MarketCapRealtime,EBITDA,ChangeFromYearLow,PercentChangeFromYearLow,LastTradeRealtimeWithTime,ChangePercentRealtime,ChangeFromYearHigh,PercebtChangeFromYearHigh,LastTradeWithTime,LastTradePriceOnly,HighLimit,LowLimit,DaysRange,DaysRangeRealtime,FiftydayMovingAverage,TwoHundreddayMovingAverage,ChangeFromTwoHundreddayMovingAverage,PercentChangeFromTwoHundreddayMovingAverage,ChangeFromFiftydayMovingAverage,PercentChangeFromFiftydayMovingAverage,Name,Notes,Open,PreviousClose,PricePaid,ChangeinPercent,PriceSales,PriceBook,ExDividendDate,PERatio,DividendPayDate,PERatioRealtime,PEGRatio,PriceEPSEstimateCurrentYear,PriceEPSEstimateNextYear,Symbol,SharesOwned,ShortRatio,LastTradeTime,TickerTrend,OneyrTargetPrice,Volume,HoldingsValue,HoldingsValueRealtime,YearRange,DaysValueChange,DaysValueChangeRealtime,StockExchange,DividendYield'</query>
  <javascript execution-time="279" instructions-used="302744" table-name="yahoo.finance.quotes"/>
  <warning>Unable to sort response according to field 'Ask,Bid,AskRealtime,BidRealtime,LastTradeDate,LastTradePriceOnly,LastTradeTime'.</warning>
  <user-time>1326</user-time>
  <service-time>586</service-time>
  <build-version>27222</build-version>
</diagnostics>
<results>
<quote symbol="XAUUSD=X">
  <Bid>1585.30</Bid>
  <AskRealtime/>
  <BidRealtime/>
  <LastTradeDate>5/11/2012</LastTradeDate>
  <LastTradePriceOnly>1580.3002</LastTradePriceOnly>
  <LastTradeTime>5:15pm</LastTradeTime>
  <Ask>1575.30</Ask>
</quote>
<quote symbol="XAGUSD=X">
  <Bid/>
  <AskRealtime/>
  <BidRealtime/>
  <LastTradeDate>5/11/2012</LastTradeDate>
  <LastTradePriceOnly>28.858</LastTradePriceOnly>
  <LastTradeTime>5:39pm</LastTradeTime>
  <Ask/>
</quote>
<quote symbol="PLN12.NYM">
  <Bid/>
  <AskRealtime>1478.60</AskRealtime>
  <BidRealtime>1462.90</BidRealtime>
  <LastTradeDate>5/11/2012</LastTradeDate>
  <LastTradePriceOnly>1465.30</LastTradePriceOnly>
  <LastTradeTime>5:02pm</LastTradeTime>
  <Ask/>
</quote>
<quote symbol="PAK12.NYM">
  <Bid/>
  <AskRealtime>0.00</AskRealtime>
  <BidRealtime>0.00</BidRealtime>
  <LastTradeDate>3/23/2012</LastTradeDate>
  <LastTradePriceOnly>658.80</LastTradePriceOnly>
  <LastTradeTime>7:12am</LastTradeTime>
  <Ask/>
</quote>
<quote symbol="USDCAD=X">
  <Bid>1.0005</Bid>
  <AskRealtime/>
  <BidRealtime/>
  <LastTradeDate>5/11/2012</LastTradeDate>
  <LastTradePriceOnly>1.001</LastTradePriceOnly>
  <LastTradeTime>5:55pm</LastTradeTime>
  <Ask>1.0015</Ask>
</quote> 
```

有关 XML 的清晰视图，请[单击此处](http://query.yahooapis.com/v1/public/yql?q=select%20symbol,%20Ask,Bid,AskRealtime,BidRealtime,LastTradeDate,LastTradePriceOnly,LastTradeTime%20from%20yahoo.finance.quotes%20where%20symbol%20in%20%28%22XAUUSD=X%22,%22XAGUSD=X%22,%22PLN12.NYM%22,%22PAK12.NYM%22,%22USDCAD=X%22%29%20%7C%20sort%28field=%22Ask,Bid,AskRealtime,BidRealtime,LastTradeDate,LastTradePriceOnly,LastTradeTime%22,%20descending=%22true%22%29%0A%09%09&diagnostics=true&env=http://datatables.org/alltables.env)

我想提取指定 div 上的所有 Ask 价格、Bid 价格……等等。

请提出建议

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-05-14T18:25:19.023

您没有正确存储数据。您想打印出 $_SESSION['Ask_2'] 但它从未设置！相反，在循环中，您不断覆盖 $_SESSION['Ask'] - 您可能想要做的是获取引号符号，然后将数据存储在 $_SESSION[$symbol]['Ask'] 中。

事实上，我建议使用另一个数组来编译数据，然后在其中设置一个包含该数组的会话变量，而不是不断更新会话变量。

你想要一个这样的循环：

```
foreach($phpObj->query->results->quote as $quote){  
    $mydata[$quote->Symbol]['Ask'] = $quote->Ask; 
```

然后当你显示结果时，显示 from`foreach ($mydata as $quote)`而不是`$_SESSION`. 最后，您可以说`$_SESSION['quotedata'] = $mydata`是否要将所有内容存储在会话中。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-08-11T20:30:43.770

我还建议您将其显示在表格中而不是 .

使用下面的解决方案，您只需从符号列表中添加/减去值，表格将自动更改。

即，如果你改变了

```
$yql_query = "select * from yahoo.finance.quotes where symbol in ('XAUUSD=X','XAGUSD=X','PLN12.NYM','PAK12.NYM','USDCAD=X')"; 
```

到

```
$yql_query = "select * from yahoo.finance.quotes where symbol in ('XAUUSD=X','XAGUSD=X','PLN12.NYM','PAK12.NYM','USDCAD=X','BOOM')"; 
```

那么您的表格将只多出一行股票代码 BOOM。我对此进行了测试，并且可以正常工作。

这是您的数据收集部分，其中包含 Ansari 所做的更正：

```
$yql_base_url = "http://query.yahooapis.com/v1/public/yql";  
$yql_query = "select * from yahoo.finance.quotes where symbol in ('XAUUSD=X','XAGUSD=X','PLN12.NYM','PAK12.NYM','USDCAD=X')";  
$yql_query_url = $yql_base_url . "?q=" . urlencode($yql_query);
$yql_query_url .= "&env=http://datatables.org/alltables.env";
$yql_query_url .= "&format=json";
$session = curl_init($yql_query_url);  
curl_setopt($session, CURLOPT_RETURNTRANSFER,true);      
$json = curl_exec($session);
$phpObj =  json_decode($json);  
if(!is_null($phpObj->query->results)){ // this does nothing. remove it?
}

if(!is_null($phpObj->query->results)){  
    foreach($phpObj->query->results->quote as $quotes){  
        $mydata[$quotes->Symbol]['Ask'] = $quotes->Ask;
        $mydata[$quotes->Symbol]['Bid'] = $quotes->Bid;
        $mydata[$quotes->Symbol]['AskRealtime'] = $quotes->AskRealtime;
        $mydata[$quotes->Symbol]['BidRealtime'] = $quotes->BidRealtime;
        $mydata[$quotes->Symbol]['LastTradeDate'] = $quotes->LastTradeDate;
        $mydata[$quotes->Symbol]['LastTradePriceOnly'] = $quotes->LastTradePriceOnly;
        $mydata[$quotes->Symbol]['LastTradeTime'] = $quotes->LastTradeTime;
  }
} 
```

这是表格形式的输出：

```
<table border="1">
<thead>
<tr>
<?php
$head = array('Symbol','Ask','Bid','Ask Realtime','Bid Realtime','Last Trade Date','Last Trade Price','Last Trade Time');
foreach($head as $value) {
    echo '<th>' . $value . '</th>';
}
?>
</tr>
</thead>
<tbody>
<?php
foreach($mydata as $symbol=>$attrib) {
    echo '<tr>';
    echo '<td>' . $symbol . '</td>';
    foreach($attrib as $val) {
        echo '<td>' . $val . '</td>';
    }
    echo '</tr>';
}
?>
</tbody>
</table> 
```

# jquery - 移动网站上的返回顶部链接在 android 上不起作用

> ID：10588584
> 
> 赞同：1
> 
> 时间：2012-05-14T17:58:19.490
> 
> 标签：jquery, android, html, mobile, jquery-mobile

我有一个有趣的问题。我正在构建一个面向移动设备的网站（请注意，这不是关于移动网络应用程序的问题，它是一个纯 HTML / CSS / javascript 网站）。我们需要在所有页面的页脚中实现“返回顶部”链接，以便在小屏幕设备上更轻松地导航返回顶部。

我现在将展示代码，只是想提一下这在 iphone/ipod 触摸设备，甚至我的 FF、safari 和 chrome 桌面浏览器上都能完美运行。但是在android上它只是不想工作。

在我的 android 设备上重现错误的步骤： - 向下滚动到页面底部。- 点击返回顶部链接。-- 页面很好地向上滚动，但随后闪烁并再次向下滚动到页面底部。

看起来滚动事件并没有在后台停止，一旦 scrollto 功能完成，它就会再次恢复滚动到底部。我的代码应该杀死所有当前正在运行的动画，我希望它可以解决这个问题。但事实并非如此。

这是我的代码：

```
 $(document).ready(function() {
  $('a.linktop').click(function() {
    $('body,html').stop(true, true).animate({
        scrollTop: 0
    },
    250);
    return false;
  });
 }); 
```

任何帮助将不胜感激。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-06-09T15:30:47.950

我尝试了许多不同的解决方案，包括上面建议的一个，它很优雅，除了不适用于姜饼并且需要 jQ mobile。

以下代码适用于 iPhone、Android 2.2+（包括姜饼）以及常规浏览器，并且只需要常规 jQ。我在此链接中找到了代码 [Use jQuery scroll plugin to Avoid # on url](https://stackoverflow.com/questions/8559565/use-jquery-scroll-plugin-to-avoid-on-url) 并针对下面的示例进行了修改，我在 iPhone 4s、Galaxy II 和较旧的 Android 设备上进行了测试。

```
<!DOCTYPE html>
<html>
<head>

  <script type='text/javascript' src='http://code.jquery.com/jquery-1.7.js'></script>

  <script type='text/javascript'>//<![CDATA[ 
    $(window).load(function(){
    $('.2top').click(function() {
            $('html, body').animate({ scrollTop: $('#top').offset().top }, 'slow');
        return false;
            });
    });//]]>  

  </script>

</head>
<body>
  <div id="top">go to the  bottom of this page</div>

  <p style="height:2200px">dddddd...</p>

  <a href="#" class="2top">back to top</a>

</body>
</html> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-05-14T19:49:39.527

我用了

```
$('html, body').animate({scrollTop: 0}, 800); 
```

对于一个 jQuery Mobile back to top 插件，它可以在 Android 上运行而没有你遇到的问题。

在此处查看代码[http://operationmobile.com/jquery-mobile-ux-add-a-back-to-top-button/](http://operationmobile.com/jquery-mobile-ux-add-a-back-to-top-button/)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2015-08-26T18:19:52.840

我在使用“返回顶部”按钮时遇到了同样的问题，在尝试了一些 jquery 替代方案后，我发现了这个用于“旧浏览器”的简单 html 选项，但它也适用于移动设备。似乎我们忘记了工作的旧原因`#top`：

```
<body>
    <a id="top"></a>  
    <!-- content goes here -->
    <a href="#top">Back to top</a>
</body> 
```

另一种方法是使用现有的 id：

```
<body>
    <div id="wrapper">
    <!-- content goes here -->
    <a href="#wrapper">back to top</a>
    </div>
</body> 
```

来源： [http ://www.smashingmagazine.com/2008/11/short-story-about-top-links/](http://www.smashingmagazine.com/2008/11/short-story-about-top-links/)

# asp.net - 重定向规则 iis 7 url 重写的可选参数

> ID：10588585
> 
> 赞同：1
> 
> 时间：2012-05-14T17:58:24.937
> 
> 标签：asp.net, regex, iis-7, url-rewriting

如何执行转换此 URL 的重定向规则：

```
http://localhost/app/Company/HomePage.aspx?COMPANYID=2&FORCESHOWCASE=TRUE&THEMEPREVIEW=3 
```

对此：

```
http://localhost/app/2/showcase/preview/3 
```

但这里的技巧是所有参数都是可选的，除了 COMPANYID，所以 url 可以是：

```
http://localhost/app/2/preview/3 
```

或者：

```
http://localhost/app/2/showcase 
```

我无法找到与此模式匹配的正确重定向规则。我尝试了以下方法：

```
<rule name="RedirectUserFriendlyURLCompany" stopProcessing="true">
                    <match url="^Company/HomePage\.aspx$" />
                    <conditions>
                        <add input="{REQUEST_METHOD}" pattern="^POST$" negate="true" />
                        <add input="{QUERY_STRING}" pattern="^COMPANYID=([^=&amp;]+)(&amp;FORCESHOWCASE=([^=&amp;]+))?(&amp;THEMEPREVIEW=([^=&amp;]+))?$" />
                    </conditions>
                    <action type="Redirect" url="{C:1}" appendQueryString="false" />
                </rule>
                <rule name="RewriteUserFriendlyURLCompany" stopProcessing="true">
                    <match url="^([A-Za-z0-9]+)/?([A-Za-z0-9]*)(/preview/([A-Za-z0-9]*))?/?$" />
                    <conditions>
                        <add input="{REQUEST_FILENAME}" matchType="IsFile" negate="true" />
                        <add input="{REQUEST_FILENAME}" matchType="IsDirectory" negate="true" />
                    </conditions>
                    <action type="Rewrite" url="Company/HomePage.aspx?COMPANYID={R:1}&amp;FORCESHOWCASE={R:2}&amp;THEMEPREVIEW={R:4}" />
                </rule> 
```

重写规则识别我是否放置了一些参数或所有参数并且效果很好，如果我尝试使用上面的任何 url，它会使用正确的参数将其重写为正确的 url，但问题在于重定向规则，它没有如果我放入浏览器，则根本不起作用：

```
http://localhost/app/Company/HomePage.aspx?COMPANYID=2&FORCESHOWCASE=TRUE&THEMEPREVIEW=3 
```

它没有重定向到正确的页面，我不知道该怎么做，请帮忙！对不起我的英语，提前谢谢

* * *

## 回答 #1

> 赞同：-1
> 
> 时间：2012-06-26T16:34:07.157

由于没有人回答我的问题，似乎没有“简单”的答案。

我做这项工作的方式是改变我的规则，使用会话变量而不是查询字符串

# javascript - jqGrid 在 Chrome/Chrome 框架中无法正确呈现

> ID：10588587
> 
> 赞同：52
> 
> 时间：2012-05-14T17:58:28.870
> 
> 标签：javascript, jquery, css, google-chrome, jqgrid

目前使用 Chrome v19.0.1084.46 (Official Build 135956) beta-m jqGrid 4.3.2 (最新版本)

问题是，无论我的网格、列或包含 div 的大小，我最后一列的一小部分被推到网格边缘之外，导致出现水平滚动条，这是不应该发生的。见下文：

![网格](../Images/eebf16e444cc843a9aea2abe5dc8f64f.png)

我一直在摆弄 jqGrid 上的以下属性来尝试解决这个问题：

*   `width`
*   `autowidth`
*   `height`
*   `shrinkToFit`
*   `scrollOffset`- 这一次运气最好，但没有什么可重复的。

我也只精简到基本的网格 css，认为这可能是我制定的规则......没有运气。

有没有其他人经历过这个和/或找到解决这个问题的方法？非常感谢您的帮助。

* * *

## 回答 #1

> 赞同：64
> 
> 时间：2012-05-16T15:40:15.070

我今天将我的 Chrome 更新到版本 19，重现了该问题并进行了相应的快速修复：

我建议更改jqGrid 代码[行](https://github.com/tonytomov/jqGrid/blob/v4.3.2/js/grid.base.js#L937)

```
isSafari = $.browser.webkit || $.browser.safari ? true : false; 
```

到以下

```
isSafari = ($.browser.webkit || $.browser.safari) &&
    parseFloat($.browser.version)<536.5 ? true : false; // Chrome < version 19 
```

[该演示](http://www.ok-soft-gmbh.com/jqGrid/Chrome19Fix.htm)使用该修复程序。我在演示中使用的固定版本`jquery.jqGrid.src.js`你可以在[这里找到](http://www.ok-soft-gmbh.com/jqGrid/jquery.jqGrid-4.3.2_/js/jquery.jqGrid.src-fixed1.js)。

我在 IE9 (v9.0.8112.16421)、IE8 (8.0.6001.18702CO)、Chrome 18.0.125.168、Chrome 19.0.1084.46、Safari 5.1.7 (7534.57.2)、Firefox 12、Opera 11.62 中对其进行了测试。在所有 Web 浏览器中，演示都没有水平滚动条，如下所示：

![在此处输入图像描述](../Images/1d34d8348ce60f2240d4b6aa33c737bb.png)

将来最好将网格宽度的计算更改得更深，使其不直接依赖于任何版本号或 Web 浏览器。我希望在jqGrid的某些地方使用更多的 jQuery 方法[$.width](http://api.jquery.com/width/)和[$.outerWidth是可能的。](http://api.jquery.com/outerWidth/)无论如何，我希望上述修复已经对许多 jqGrid 用户有所帮助。

**更新：我将我的建议作为**[错误报告](http://www.trirand.com/blog/?page_id=393/bugs/fixing-width-calculation-of-the-grid-in-google-chrome-19/#p26607)发布给 trirand 。

**更新2**：确切地说，代码中有三个地方使用了与`$.browser.webkit || $.browser.safari`上述相同的构造：[在 setGridWidth](https://github.com/tonytomov/jqGrid/blob/v4.3.2/js/grid.base.js#L2028)内部、[在 getOffset](https://github.com/tonytomov/jqGrid/blob/v4.3.2/js/grid.base.js#L2088)内部、[在计算列宽度](https://github.com/tonytomov/jqGrid/blob/v4.3.2/js/grid.base.js#L2139)内部`multiselect`、[在 showHideCol 内部](https://github.com/tonytomov/jqGrid/blob/v4.3.2/js/grid.base.js#L3020)和[在 setGridWidth 内部](https://github.com/tonytomov/jqGrid/blob/v4.3.2/js/grid.base.js#L3113)。前三个地方使用`isSafari`变量。最后两个地方`$.browser.webkit || $.browser.safari`直接使用。**应该在所有地方**替换代码

```
$.browser.webkit||$.browser.safari 
```

到

```
($.browser.webkit || $.browser.safari) && parseFloat($.browser.version)<536.5 
```

所以应该在**三个地方**做到这一点：

1.  在`isSafari`（见我原来的帖子）的定义
2.  代替`showHideCol`
3.  代替`setGridWidth`

您可以在[此处](http://www.ok-soft-gmbh.com/jqGrid/jquery.jqGrid-4.3.2_/js/jquery.jqGrid.src-fixed3.js)`jquery.jqGrid.src`下载包含所有修复程序的固定版本。如果您必须使用旧版本的 jqGrid，您可以对自己的代码进行相同的更改。要为生产创建最小化版本，您可以使用您熟知的任何最小化器。例如，我使用 Microsoft Ajax Minifier 4.0。只需安装并执行`jquery.jqGrid.src`

```
AjaxMin.exe jquery.jqGrid.src-fixed3.js -o jquery.jqGrid.min-fixed3.js 
```

结果你会得到[jquery.jqGrid.min-fixed3.js](http://www.ok-soft-gmbh.com/jqGrid/jquery.jqGrid-4.3.2_/js/jquery.jqGrid.min-fixed3.js)，它会比 original 更小`jquery.jqGrid.min.js`。即使您将注释标题添加到文件中（请参阅[修改后的文件](http://www.ok-soft-gmbh.com/jqGrid/jquery.jqGrid-4.3.2_/js/jquery.jqGrid.min-fixed3_.js)），该文件仍将比原始版本的`jquery.jqGrid.min.js`.

[在我的错误报告](http://www.trirand.com/blog/?page_id=393/bugs/fixing-width-calculation-of-the-grid-in-google-chrome-19/#p26607)和[改进](https://github.com/tonytomov/jqGrid/commit/3988795bc8d1ac43e349af4eec42f1032f82bb1f)的一些迭代之后，还有一个`cellWidth`引入该方法的修复版本：

```
cellWidth : function () {
    var $testDiv = $("<div class='ui-jqgrid' style='left:10000px'><table class='ui-jqgrid-btable' style='width:5px;'><tr class='jqgrow'><td style='width:5px;'></td></tr></table></div>"),
        testCell = $testDiv.appendTo("body")
            .find("td")
            .width();
        $testDiv.remove();
        return testCell !== 5;
} 
```

见[这里](https://github.com/tonytomov/jqGrid/blob/master/js/grid.base.js#L184-191)。如果您更喜欢遵循这种方式，您也可以这样做。在所有使用`isSafari`or `$.browser.webkit || $.browser.safari`(in `showHideCol`and `setGridWidth`) 的地方，您都可以使用`$.jgrid.cellWidth()`。

**更新 3**：今天发布了 jqGrid 4.3.3，其中包含我上面描述的修复（`cellWidth`方法）。所以我建议大家使用新版本。

**更新 4：** Google Chrome 20 使用 WebKit 536.11。因此，不能使用宽度固定计算的 jqGrid 最新版本的每个人都应该使用`parseFloat($.browser.version)<536.11`（或接近）而不是`parseFloat($.browser.version)<536.5`在答案开头描述。Google Chrome 23 WebKit 使用 537.11。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2012-05-16T18:15:28.057

奥列格的解决方案对我有用。

我刚刚编辑了最小版本

第 49 行：

替换：

m=b.browser.webkit||b.browser.safari?!0:!1

和：

m=(b.browser.webkit||b.browser.safari)&&parseFloat(b.browser.version)<536.5?!0:!1

谢谢您的帮助！

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2012-05-18T13:42:30.760

奥列格的回答是正确的。但是，如果您使用的是旧版本的 jqGrid 并希望应用这些修复，则直接从 Github 上的差异中获取更改可能更容易。我已经使用 jqGrid 4.0.0 成功地对此进行了测试，所以它可能适用于任何 4.x 系列。

只需从第一个差异开始并按顺序应用它们。这将添加`cellWidth`函数并对 jquery.jqGrid.src.js 文件进行所有必要的更改。然后，如果要创建缩小版本，可以使用 Google 闭包编译器：

*   [8c56dc8](https://github.com/tonytomov/jqGrid/commit/8c56dc81a1c7c94089922f6dc55b52dfdd7d8c9f)
*   [b50b55f](https://github.com/tonytomov/jqGrid/commit/b50b55f389c4749d38cd2028aa341053a01ea5f9)
*   [cf26b2c](https://github.com/tonytomov/jqGrid/commit/cf26b2cf41b9cc8f9da410ab4ad01fb1cec8f0d3)
*   [8d7eff0](https://github.com/tonytomov/jqGrid/commit/8d7eff0aac7a2d93dea3e5b405cc4b50c1b72f58)
*   [46a14ce](https://github.com/tonytomov/jqGrid/commit/46a14ce93fe1b91f199e4fdc560fa26c17ee9bb4)

看起来有很多变化，但是当您查看实际代码时，变化会很快发生。只有少数源代码行受到影响。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2012-05-24T10:16:28.017

Chrome beta 20.0.1132.11 已经发布，报告如下：

```
User-Agent:Mozilla/5.0 (Windows NT 5.1) AppleWebKit/536.11 (KHTML, like Gecko) Chrome/20.0.1132.11 Safari/536.11 
```

我猜 536.11 评估为 < 536.5，因为数字与文本比较导致补丁无法运行？

请帮忙！

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2012-05-14T18:31:32.050

**更新：**我的回答是指几个月前在 Firefox 中发生的类似问题，我建议希望它适用于 Chrome 19，但目前 Oleg 的回答是正确的方法。

几个月前我在 FF 上遇到了类似的问题，我正在使用 ForceFit 选项，它应该完全禁用 HScroll，但就像你提到的那样，我仍然会得到它，所以我只是为我的 forcefit 网格禁用了 HScroll。FF 之后的一些更新，它确实停止了，目前我所有的网格在 Chrome 18 中都很好，所以希望在 19 发布时它不会成​​为问题。

```
//remove HScroll
function jqGridDisableHScroll(gridid) {
    //if columns are force fit all columns will always fit on screen.
    if ($('#' + gridid).jqGrid('getGridParam', 'forceFit')) {
        var gridview = $('#gview_' + gridid);
        $('.ui-jqgrid-bdiv', gridview).css({ 'overflow-x': 'hidden' });
    }
} 
```

**强制配合**

如果设置为 true 并调整列的宽度，则相邻列（右侧）将调整大小以保持整体网格宽度（例如，将第 2 列的宽度减少 30px 将使第 3 列的大小增加30 像素）。在这种情况下，没有水平滚动条。注意：此选项与 shrinkToFit 选项不兼容 - 即，如果将 shrinkToFit 设置为 false，则忽略 forceFit。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2012-05-22T03:25:37.067

只是想指出这可能是由于 webkit[问题 78412](https://bugs.webkit.org/show_bug.cgi?id=78412)最终得到解决。在计算具有固定布局的表格的宽度时，基本上它不会考虑边界，并且我相信填充也是如此。

这意味着 jqGrid 会错误地将表格的宽度计算为仅其内容区域的宽度。因此删除边框和填充也应该可以解决问题，但您可能不想这样做。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2012-08-20T15:45:05.647

我们使用 jgGrid 4.3.3 并`cellWidth`没有解决问题...为了解决它，我在方法`return parseInt(testCell) !== 5;`中添加了该行。也许这不是最好的解决方案，但它对我们有用:)`return testCell !== 5;``cellWidth`

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2017-08-08T13:03:32.400

在带有 Chrome 59.0.3071.115 的 jQGrid 4.5.2 中，我将 grid.base.js 中的 cellWidth 函数更改为：

```
 return Math.round(testCell) !== 5 
```

# java - 包装对象和相等性

> ID：10588588
> 
> 赞同：1
> 
> 时间：2012-05-14T17:58:38.643
> 
> 标签：java

为什么如果我在两个包装器对象上运行 .equals 方法，它将根据下面的 WrapperEqualsEquals 类返回 true**但是**（我强调但是）为什么我们需要在下面的 Blob 类中覆盖 equals 方法命令它返回true。基本上，为什么包装器对象不必重写 .equals 方法？

```
 class WrapperEqualsEquals
    {
       public static void main(String []args)
       {
         Integer one=new Integer(1);
         Integer oneB=new Integer(1);

         System.out.println(one == oneB);
         System.out.println(one.equals(oneB));

       } 
```

# }

```
 class OverrideEquals
    {
      public static void main (String [] args)
      {
        Blob a= new Blob(1,"a");
        Blob b= new Blob(1,"a");

        System.out.println(a==b);
        System.out.println(a.equals(b));

       } 
```

# }

```
 class Blob
    {
      int blobNumber;
      String blobText;

      Blob(int blobNumber,String blobText)
      {
       this.blobNumber=blobNumber;
       this.blobText=blobText;
      }

          //"overriding" the 'equals' method

          public boolean equals (Object o)
      {

            if (o instanceof Blob)
    {
        Blob o2=(Blob)o;
        return ((o2.blobNumber==this.blobNumber) &&(o2.blobText==this.blobText))?
                    true:false;
    }

            else
    {
        return false;
    }
} 
```

}

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-05-14T18:06:22.500

默认情况下，Object#equals(Object) 仅在隐式和显式参数的哈希码相等时才返回 true。因为您创建了两个单独的 Blob 对象，所以它们不会指向同一个引用（根据 hashCode()），因此*除非*重写 .equals 方法，否则它们会不相等。但是，按照 Java 约定，.equals 应该仅在两个对象的哈希码相等时才返回 true，因此您可能希望也覆盖 hashCode。这也将保留内存使用。

# xaml - 在 Metro Style 应用程序上计算 ViewBox ScaleFactor

> ID：10588589
> 
> 赞同：1
> 
> 时间：2012-05-14T17:58:43.687
> 
> 标签：xaml, windows-8, windows-runtime, viewbox, winrt-xaml

有没有办法获得 ViewBox 在 XAML Windows 8 Metro Style App 中缩放其内容的比例因子

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2013-04-17T09:35:12.767

WinRTXAMLToolit[对此](http://winrtxamltoolkit.codeplex.com/)有一个扩展。

```
public static double GetChildScaleX(this Viewbox viewbox)
{
    if (viewbox.Child == null)
        throw new InvalidOperationException("Can't tell effective scale of a Viewbox child for a Viewbox with no child.");

    var fe = viewbox.Child as FrameworkElement;

    if (fe == null)
        throw new InvalidOperationException("Can't tell effective scale of a Viewbox child for a Viewbox with a child that is not a FrameworkElement.");

    if (fe.ActualWidth == 0)
        throw new InvalidOperationException("Can't tell effective scale of a Viewbox child for a Viewbox with a child that is not laid out.");

    return viewbox.ActualWidth / fe.ActualWidth;
} 
```

`GetChildScaleY`是相同的，但与高度。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-06-12T05:12:43.327

您可以尝试在其中添加一个网格视图，并从布局属性到您的内容自定义其列和行。将其宽度和高度设置为自动，并让它拉伸宽度和高度。此外，您应该让您的内容拉伸或再次将 witdh 和高度设置为自动。

另一方面，您可以尝试体验混合工具...

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-05-15T00:12:33.323

您可以将其`ActualWidth/ActualHeight`与其`ActualWidth/ActualHeight`子项进行比较。请注意，如果其 Stretch 设置为 ，这些可能会有所不同`Fill`。

# c# - InternalsVisibleTo 不适用于 MSTest

> ID：10588592
> 
> 赞同：5
> 
> 时间：2012-05-14T17:58:51.803
> 
> 标签：c#, unit-testing, mstest

我查看了[google](https://www.google.com/webhp?sourceid=chrome-instant&ie=UTF-8&ion=1#hl=en&gs_nf=1&tok=pcNu0W9MDCWarow6HXOoOA&cp=18&gs_id=6&xhr=t&q=Internalsvisibleto&pf=p&output=search&sclient=psy-ab&oq=Internalsvisibleto&aq=0&aqi=g4&aql=&gs_l=&pbx=1&bav=on.2,or.r_gc.r_pw.r_qf.,cf.osb&fp=356e729b7a15c7f0&biw=1454&bih=726&ion=1)和[stack over flow](https://stackoverflow.com/questions/106880/internalsvisibleto-attribute-isnt-working)并阅读了所有关于如何让 InternalsVisibleTo 工作的帖子。

但它不适合我。

请不要对这个问题投反对票，因为我已尽力在论坛上查看并实施答案。

我的代码如下：

***内部TestInternal项目***

```
namespace TestInteral
{
    [TestClass]
    public class MyProviderTest
    {
        [TestMethod]
        public void TestBar()
        {
            bool retval = false;

            retval = new MyProviderClass().Bar();

            Assert.AreEqual(true,retval);
        }

    }
} 
```

***内部提供者项目***

```
[assembly: InternalsVisibleTo("TestInternal")]
namespace Provider
{

    public class MyProviderClass
    {
        internal bool Bar()
        {
            return true;

        }

        private void UseBar()
        {
            bool retval = Bar();

        }
    }
} 
```

我的测试课出现以下错误。

**错误 1“Provider.MyProviderClass”不包含“Bar”的定义，并且找不到接受“Provider.MyProviderClass”类型的第一个参数的扩展方法“Bar”（您是否缺少 using 指令或程序集引用？）**

请让我知道如何正确使用 InternalsVisibleTo，以便正确测试 MyProviderClass 中的*Internal*方法。

谢谢

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2012-05-14T18:27:28.323

假设您刚刚将您的 EXACT 代码复制并粘贴到问题中，这是一个简单的错字。我注意到您在测试程序集中的命名空间`TestInteral`没有“N”。你的`InternalsVisibleTo`声明有最后一个'N'：

```
[assembly: InternalsVisibleTo("TestInternal")] 
```

大概就是这样。

# c# - 在 Lambda 表达式中检查 null

> ID：10588601
> 
> 赞同：-6
> 
> 时间：2012-05-14T17:59:42.963
> 
> 标签：c#, linq

在下面的代码中，我试图从 List 中获取 null、空字符串和源组件。我还没有测试过这段代码，但我的直觉告诉我，如果它来自一个空值，它会在过滤源和空字符串的列表时中断。

我尝试先提取空值，但我仍在过滤基本列表。我怎样才能重新编写这段代码来以最好的方式完成我想要做的事情？

```
List<LineItem> nullList=itemsList.Where(s => s[Constants.ProductSource] == null)
                                 .ToList();

NALineItems = itemsList.Where(s => s[Constants.ProductSource] == source 
                                   || s[Constants.ProductSource] == String.Empty)
                       .ToList();

NALineItems = nullList.Union(NALineItems).ToList(); 
```

s[Constants.ProductSource] 是 Microsoft 电子商务 PurchaseOrder 对象的附件属性。它基本上是对象的另一个属性。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-05-14T18:06:11.297

基于“*我正在尝试从列表中获取 null、空字符串和源组件*”，我假设您的意思是您想要一个包含这 3 个特定值的列表。

```
var allItems = itemsList
                 .Where(s => string.IsNullOrEmpty(s[Constants.ProductSource])
                             || s[Constants.ProductSource] == source)
                 .ToList() 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-05-14T18:06:03.087

您是否有理由不能将表达式组合成一个？我还将添加一个检查该键是否存在于字典中：

```
List<LineItem> NALineItems = itemsList.Where(s =>
    s.ContainsKey(Constants.ProductSource) && (
        String.IsNullOrEmpty(s[Constants.ProductSource]) ||
        s[Constants.ProductSource] == source))
    .ToList(); 
```

# reporting-services - 在条形图中添加全部/总计列

> ID：10588603
> 
> 赞同：0
> 
> 时间：2012-05-14T17:59:45.290
> 
> 标签：reporting-services, ssas, mdx

我在 SSRS 中有一个条形图，显示从 SSAS 提取的数据，数据如下所示：

名称：值：目标：计算百分比

产品1：10：100：0.1：

产品2：15：30：0.5：

其中 computed% 是查询中的计算成员 - ((100/target)*value)/100

该图表将计算百分比显示为 Y 上的值，并在 X 轴上显示名称。

我需要添加一个列，它是其他列的总和，所以如果从查询返回，它看起来像：

产品总数：25：130：0.19

这背后的想法是图表将显示每个产品与其各自目标的接近程度 - 以百分比形式 - 同时还显示所有产品与整体目标的接近程度。

知道如何让图表添加此总列或更改查询以返回额外的行吗？使用 SQL 似乎很容易做到，但这使用了 MDX，我对此不是很熟悉。

代码;

```
WITH MEMBER [Measures].[PercentOfTarget] AS ((100/ [Measures].[Value])*[Measures].[Enquiry Count])/100 SELECT NON EMPTY { [Measures].[PercentOfTarget], [Measures].[Strech Target Value], [Measures].[Value], [Measures].[Enquiry Count] } ON COLUMNS, NON EMPTY { ([Industry Sector].[Reporting Sector].[Reporting Sector].ALLMEMBERS ) } DIMENSION PROPERTIES MEMBER_CAPTION, MEMBER_UNIQUE_NAME ON ROWS FROM ( SELECT ( STRTOSET(@StageStartDateFinancialYearName, CONSTRAINED) ) ON COLUMNS FROM ( SELECT ( { [Industry Sector].[Reporting Sector].&[Advanced Engineering], [Industry Sector].[Reporting Sector].&[Business Professional And Financial Services], [Industry Sector].[Reporting Sector].&[DigiMedia], [Industry Sector].[Reporting Sector].&[Food And Drink], [Industry Sector].[Reporting Sector].&[IT], [Industry Sector].[Reporting Sector].&[Life Sciences], [Industry Sector].[Reporting Sector].&[Logistics] } ) ON COLUMNS FROM ( SELECT ( { [Enquiry Type].[Enquiry Type].&[Project] } ) ON COLUMNS FROM [Invest Cube]))) WHERE ( [Enquiry Type].[Enquiry Type].&[Project], IIF( STRTOSET(@StageStartDateFinancialYearName, CONSTRAINED).Count = 1, STRTOSET(@StageStartDateFinancialYearName, CONSTRAINED), [Stage Start Date].[Financial Year Name].currentmember ) ) CELL PROPERTIES VALUE, BACK_COLOR, FORE_COLOR, FORMATTED_VALUE, FORMAT_STRING, FONT_NAME, FONT_SIZE, FONT_FLAGS 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-05-16T09:27:01.913

各个产品行由以下行指定：

```
{ ([Industry Sector].[Reporting Sector].[Reporting Sector].ALLMEMBERS) } 
```

提供的查询比较复杂，从子查询中查询；我从未以这种方式编写过 MDX 查询，但也许您可以尝试以下方法：

```
{ [Industry Sector].[Reporting Sector].[Reporting Sector].ALLMEMBERS, [Industry Sector].[Reporting Sector].[Reporting Sector].All  } 
```

希望将“全部”成员添加到集合中将提供您想要的总行。

# javascript - HTML5 拖放教程 - 可排序列表

> ID：10588607
> 
> 赞同：36
> 
> 时间：2012-05-14T17:59:57.583
> 
> 标签：javascript, html

有谁知道一个非常好的 HTML5 拖放教程？我正在制作一个待办事项列表，我希望能够使用此 API 对其进行重新排序/排序。我一直在像疯子一样在谷歌上搜索它，现在我开始放弃了......欢迎任何提示！谢谢！

ps 我真的很想使用 html5 拖放 API，而不是 jQuery-sortable()

* * *

## 回答 #1

> 赞同：71
> 
> 时间：2015-03-10T11:16:41.910

我试图让这个示例尽可能简单。

如果您创建一个 HTML 列表：

```
<ul>
  <li draggable="true" ondragover="dragOver(event)" ondragstart="dragStart(event)">Apples</li>
  <li draggable="true" ondragover="dragOver(event)" ondragstart="dragStart(event)">Oranges</li>
  <li draggable="true" ondragover="dragOver(event)" ondragstart="dragStart(event)">Bananas</li>
  <li draggable="true" ondragover="dragOver(event)" ondragstart="dragStart(event)">Strawberries</li>
</ul> 
```

...以及以下 javascript：

```
var _el;

function dragOver(e) {
  if (isBefore(_el, e.target))
    e.target.parentNode.insertBefore(_el, e.target);
  else
    e.target.parentNode.insertBefore(_el, e.target.nextSibling);
}

function dragStart(e) {
  e.dataTransfer.effectAllowed = "move";
  e.dataTransfer.setData("text/plain", null); // Thanks to bqlou for their comment.
  _el = e.target;
}

function isBefore(el1, el2) {
  if (el2.parentNode === el1.parentNode)
    for (var cur = el1.previousSibling; cur && cur.nodeType !== 9; cur = cur.previousSibling)
      if (cur === el2)
        return true;
  return false;
} 
```

...你应该得到一个可排序的列表。

[您可以在https://codepen.io/crouchingtigerhiddenadam/pen/qKXgap](https://codepen.io/crouchingtigerhiddenadam/pen/qKXgap)上尝试代码

请注意 FireFox 中的以下错误： [https ://developer.mozilla.org/en-US/docs/Web/Events/dragenter](https://developer.mozilla.org/en-US/docs/Web/Events/dragenter)

希望这可以帮助。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2012-07-05T22:40:50.593

有关从头到尾的教程，请查看：[http](http://taximeeting.tumblr.com/post/26539340142/lightweight-jquery-plugin-for-html5-sortable-lists) ://taximeeting.tumblr.com/post/26539340142/lightweight-jquery-plugin-for-html5-sortable-lists 。

它基于`html5sortable`： http: [//farhadi.ir/projects/html5sortable/](http://farhadi.ir/projects/html5sortable/)。另一个关于 HTML5 拖放的很棒的教程可以在这里找到：http: [//www.html5rocks.com/en/tutorials/dnd/basics/](http://www.html5rocks.com/en/tutorials/dnd/basics/)。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2015-11-19T01:36:29.793

如果您希望对表格行执行此操作，则需要稍作更改：

[https://jsfiddle.net/cmpenney/6rx6u2kf/](https://jsfiddle.net/cmpenney/6rx6u2kf/)

```
<table>
    <tr draggable="true" ondragenter="dragenter(event)" ondragstart="dragstart(event)">
        <td style="border: 1px solid black">Apples</td>
        <td style="border: 1px solid black">A-Column2</td>
    </tr>
    <tr draggable="true" ondragenter="dragenter(event)" ondragstart="dragstart(event)">
        <td style="border: 1px solid black">Oranges</td>
        <td style="border: 1px solid black">O-Column2</td>
    </tr>
    <tr draggable="true" ondragenter="dragenter(event)" ondragstart="dragstart(event)">
        <td style="border: 1px solid black">Bananas</td>
        <td style="border: 1px solid black">B-Column2</td>
    </tr>
    <tr draggable="true" ondragenter="dragenter(event)" ondragstart="dragstart(event)">
        <td style="border: 1px solid black">Strawberries</td>
        <td style="border: 1px solid black">S-Column2</td>
    </tr>
</table>

var source;

function isbefore(a, b) {
    if (a.parentNode == b.parentNode) {
        for (var cur = a; cur; cur = cur.previousSibling) {
            if (cur === b) {
                return true;
            }
        }
    }
    return false;
}

function dragenter(e) {
    var targetelem = e.target;
    if (targetelem.nodeName == "TD") {
       targetelem = targetelem.parentNode;   
    }  

    if (isbefore(source, targetelem)) {
        targetelem.parentNode.insertBefore(source, targetelem);
    } else {
        targetelem.parentNode.insertBefore(source, targetelem.nextSibling);
    }
}

function dragstart(e) {
    source = e.target;
    e.dataTransfer.effectAllowed = 'move';
} 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2016-11-26T15:26:50.097

如果您使用**adamf**的解决方案（2015 年3 月 10 日 11:16），并且想在表格行上使用它，请将*dragenter*函数替换为以下内容：

```
function dragenter(e) {
    var target = e.target;
    while (target.parentNode.tagName != 'TBODY') {
        target = target.parentNode;
    }

    if (isbefore(source, target)) {
        target.parentNode.insertBefore(source, target);
    }
    else {
        target.parentNode.insertBefore(source, target.nextSibling);
    }
} 
```

这样，目标将仅适用于 TR 元素，而不适用于它们的任何子元素。

如果*li*元素有子元素，同样的事情也适用于*ul > li结构。*

 *如果有*img*子元素，则为每个元素添加一个*draggable="false"*属性。*

# wpf - WPF：自定义 window.title

> ID：10588609
> 
> 赞同：1
> 
> 时间：2012-05-14T18:00:02.077
> 
> 标签：wpf, xaml

我需要动态更改 Windows.Title 属性。简而言之，我需要将应用程序名称保持对齐，并将文件名集中在同一行中。

```
 <Window.Title>
    <TextBlock> test </TextBlock>
</Window.Title> 
```

我尝试了类似这样的初学者，这显然是不允许的。有人有想法吗？

# magento - Magento $_product->getName 为空

> ID：10588616
> 
> 赞同：3
> 
> 时间：2012-05-14T18:00:42.077
> 
> 标签：magento, product

我想从 Magento 导出自定义 XML 提要，这是我使用的以下代码：

```
<?php
header('Content-Type: text/xml'); // XML's a handy dandy format

include '../app/Mage.php'; // Include the magento core

include 'ArrayXml.php';

Mage::app(); //And start up the Magento app

$_result = array(); // Make sure we have a result array to store our products
$_products = Mage::getModel('catalog/product')->getCollection();

foreach($_products as $_product) {
$_result['produs'][] = array(
'denumire' => $_product->getName(),
'descriere_scurta' => $_product->getShortDescription(), //product's short description
'descriere_lunga' => $_product->getDescription(), // product's long description
'pret_intreg' => $_product->getPrice(), //product's regular Price
'pret_redus' => $_product->getSpecialPrice(), //product's special Price
'url_produs' => $_product->getProductUrl(), //product url
'fotografie_produs' => $_product->getImageUrl() //product's image url
);
}
$_converter = new ArrayXML();
echo $_converter->toXML($_result); 
```

但是，只有产品 URL 和图像 URL 给了我正确的值。其余都是空的。

是什么赋予了？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2012-05-14T18:19:21.833

'name' 和其他是属性，所以你应该调用`addAttributeToSelect`：

```
$_products = Mage::getModel('catalog/product')->getCollection()
    ->addAttributeToSelect(array(
        'name',
        'short_description',
        'description'
    ))
    ->addPriceData(); 
```

# css - 508 合规性标题属性与隐藏的绝对定位标签

> ID：10588625
> 
> 赞同：1
> 
> 时间：2012-05-14T18:01:21.673
> 
> 标签：css, section508

当涉及到 508 合规性时，标题属性是否可以用于可访问性？

例如：

```
<style>
    #date_box{width:250px; border:2px solid #AAA;}
    input{width:100px;}
</style>

<div id="date_box">
    <input title="to" type="text" id="to" name="to" />
    <label for="from">from</label>
    <input type="text" id="from" name="from" />
</div> 
```

还是最好做一个绝对位置和负边距的隐藏标签？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2012-06-11T18:01:36.367

当控件上的可视标签是多余的时，可以使用标题属性。表单控件的[可访问名称计算](https://dvcs.w3.org/hg/html-api-map/raw-file/tip/Overview.html#calc)包括标题属性内容，因此它现在已成为过去并将继续成为在不需要可见标签的有限情况下为控件提供可访问名称的可靠方法. 有一个[WCAG 2.0 技术](http://www.w3.org/TR/WCAG20-TECHS/H65.html)涵盖了这一点。本文提供了有关此技术的测试结果和讨论：[标题属性作为表单控件标签](http://www.accessibleculture.org/articles/2010/10/title-attributes-as-form-control-labels/)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-05-14T18:40:29.690

关于表格的[第 508 节规则](http://www.section508.gov/index.cfm?fuseAction=stdsdoc#Web)相当抽象：“(n) 当电子表格设计为在线完成时，表格应允许使用辅助技术的人访问完成和提交所需的信息、字段元素和功能。表格，包括所有方向和提示。”</p>

所以这里的问题是：如果您使用没有标签的表单字段，您能否确保任何辅助软件都允许用户访问逻辑上是标签但放置在例如作为默认内容和/或`title`属性的字段中的文本? 如果您使用标签但使用 CSS 将其隐藏，是否可以确定任何辅助软件仍然可以将其提供给用户。

我不认为任何人都可以保证所有当前和未来的程序，因此使用普通标签和普通`label`标记显然是最安全的。

# javascript - 自动调整 Ext.Msg.confirm 的宽度和高度以适应内容

> ID：10588631
> 
> 赞同：-1
> 
> 时间：2012-05-14T18:02:00.240
> 
> 标签：javascript, html, css, sencha-touch

我尝试将内容自动动态调整为 Ext.Msg.confirm，但我不尝试调整它。剩下的 Ext.Msg.confirm 调整为更大尺寸的内容。

我有这个代码：

**标题**

```
div.x-sheet.x-msgbox {
    width:15em;
    height:auto;
    background:#fff;
    -webkit-box-shadow: rgba(0,0,0,0.4)00.1em0.5em;
    -webkit-border-radius:0.3em;
    -moz-box-shadow: rgba(0,0,0,0.4)00.1em0.5em;
    -moz-border-radius:0.3em;
    border-radius:0.3em;
    border:0.15em solid #FFFFFF;
} 
```

**身体**

```
.x-msgbox-body {
    padding:40px0;
    padding:6px0;
    background-color:#ffffff;
    color:#094fa4;
    position:relative;
    margin:0auto;
    text-align: center;
    overflow: hidden;
} 
```

**请帮帮我**。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-05-17T15:21:55.277

Sencha 会根据文本的数量自动调整消息框的大小。你想覆盖它吗？

如果是这样，您可以将 !important 规则放在高度定义上以覆盖消息框的 sencha 的 css 标记（尽管 auto 不会真正做任何事情）：

```
 div.x-sheet.x-msgbox {
    width:15em;
    height:115px !important;
    background:#fff;
    -webkit-box-shadow: rgba(0,0,0,0.4)00.1em0.5em;
    -webkit-border-radius:0.3em;
    -moz-box-shadow: rgba(0,0,0,0.4)00.1em0.5em;
    -moz-border-radius:0.3em;
    border-radius:0.3em;
    border:0.15em solid #FFFFFF;
} 
```

# git - 在“git merge origin/branch”中忘记斜线的后果

> ID：10588633
> 
> 赞同：5
> 
> 时间：2012-05-14T18:02:07.290
> 
> 标签：git

根据[这篇文章](http://longair.net/blog/2009/04/16/git-fetch-and-merge/ "git：获取和合并，不要拉")，我试图让自己养成在更新工作副本时显式获取和合并的习惯。但是，今天我在发出命令时打错了：

```
$ git fetch origin
$ git merge origin asdf 
```

请注意，我在合并命令上使用了空格而不是正斜杠。因为无论如何它似乎已经达到了预期的效果，所以直到我已经推送它才注意到它在日志中添加了一个措辞奇怪的提交：

```
commit 65f0037bed926c338cb95e7437e7f7f407028d9f
Author: Me <my_email@example.com>
Date:   Mon May 14 09:36:44 2012 -0700

    Merge branch 'asdf', remote-tracking branch 'origin' into asdf 
```

现在我想知道这是否真的有任何负面影响。似乎它将参数视为两个单独的分支规范以合并到当前分支中，并且“origin”将隐式扩展为“origin/asdf”——这正是我真正想要的。那时，我不知道为什么它甚至会允许“将分支'asdf' 合并到 asdf”发生。

这只是一个令人尴尬的无操作吗？或者我是否在我的存储库历史记录中引入了一个可能有问题的构造？

编辑：输出`git cat-file commit 65f0037b`

```
tree 74ed9ead4b82e4e56bd5656ee10375f8f0fcb60d
parent 3bc2a37031a4a391aa4da64c22e3f55148cd23e2
author Me <my_email@example.com> 1337013404 -0700
committer Me <my_email@example.com> 1337013404 -0700

    Merge branch 'asdf', remote-tracking branch 'origin' into asdf 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2012-05-14T18:52:14.753

让我们从命令的手册页开始`merge`：

```
 git merge [-n] [--stat] [--no-commit] [--squash]
           [-s <strategy>] [-X <strategy-option>]
           [--[no-]rerere-autoupdate] [-m <msg>] [<commit>...] 
```

因此，如果没有所有选项，则`merge`接受提交列表。如果您已经在分支上`asdf`并输入：

```
git merge asdf 
```

...这是一个无操作：将分支与自身合并意味着无事可做。如果您键入：

```
git merge origin 
```

然后`git`将查找与远程命名关联的默认分支`origin`。在输出中`branch -a`：

```
* master
  remotes/origin/HEAD -> origin/master
  remotes/origin/master 
```

`remotes/origin/HEAD`指向默认分支，所以：

```
git merge origin 
```

相当于：

```
git merge origin/master 
```

因此，假设您的遥控器上的默认分支是`master`，当您键入：

```
git merge origin asdf 
```

你得到了：

```
git merge origin/master 
```

如果默认分支是`asdf`，你得到：

```
git merge origin/asdf 
```

# core-data - 解决RestKit中的CoreData合并冲突，当一个上下文正在保存对象更新而另一个正在删除对象时

> ID：10588634
> 
> 赞同：2
> 
> 时间：2012-05-14T18:02:08.663
> 
> 标签：core-data, concurrency, merge, restkit, nsmanagedobjectcontext

假设我有一个名为 «Picture» 的 NSManagedObject，它是通过 RestKit 创建的。我正在通过 NSOperation 上传实际的图片文件内容。NSOperation 正在跟踪上传进度，并将其保存在 Picture 对象的 «progress» 属性中。

```
if(![self isCancelled]) {
    Picture *pic = [Picture findFirstByAttribute:@"pictureId" withValue:self.pictureId];
    if(![pic isDeleted]) {
        pic.progress = [NSNumber numberWithFloat:progress];
        [[RKObjectManager sharedManager].objectStore save:NULL];
    }
} 
```

在 NSFetchedResultsController 的帮助下，我的视图控制器正在显示图片对象列表。上传效果很好，RestKit 正在执行线程安全并合并回主 NSManagedObjectContext，因此 UI 按预期显示上传进度。

现在想象一下，在上传图片时，用户按下“取消”十字，这也应该删除图片对象。在控制器中，我在 NSOperation 上调用取消，这有效地在几毫秒内停止运行操作，并且该对象从主线程上的 CoreData 中删除。

```
[uploadOperation cancel];
Picture *pic = [Picture findFirstByAttribute:@"pictureId" withValue:self.pictureId];
[pic deleteEntity];
[[RKObjectManager sharedManager].objectStore save:NULL]; 
```

跟踪显示我按预期在 NSFetchedResultsControllerDelegate 上获得了 NSFetchedResultsChangeDelete。然而，紧随其后的是 NSFetchedResultsChangeInsert 和 NSFetchedResultsChangeUpdate，因为 NSOperation 非常频繁地保存进度。NSOperation 使用的 NSManagedObjectContext 似乎不同步。它不知道 Picture 对象被删除，调用 save: 导致插入和更新。

因此，在我的 UI（和 DB）中，我的 Picture 对象在它应该被删除时仍然存在。

查看 RKManagedObjectStore，似乎合并是从后台线程（NSOperation）到主线程（我的视图控制器），但不是相反的方式。

解决此问题的最佳方法是什么？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-11-19T21:11:29.957

听起来像是使用核心数据撤消管理器的完美情况。您可以[在此处](http://www.cimgf.com/2008/04/30/cocoa-tutorial-wiring-undo-management-into-core-data/)或 Apple 提供的 CoreDataBooks 示例中找到一个很好的示例。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2013-06-03T19:56:47.887

我认为您可能应该稍微更改应用程序的控制流程。在 NSOperation 仍在进行时删除主上下文中的对象听起来是个坏主意。*你为什么*不检查操作本身是否被取消`NSOperation`并使用它的 MOC 从那里删除图像对象？这样，您只能在一个子 MOC 上进行写入。另一种选择，*即*在每次修改之前更新操作中的子 MOC，这违背了拥有单独上下文的目的。

考虑一下，可能有一些聪明的方法可以观察`NSManagedObjectContextObjectsDidChangeNotification`并与适当的 合并`NSMergePolicy`，但话又说回来，我认为这对你的情况来说太过分了。我只是在同一个地方处理整个取消和删除。

# php - 在php浏览器中重新启动mysql，权限问题？

> ID：10588636
> 
> 赞同：4
> 
> 时间：2012-05-14T18:02:13.263
> 
> 标签：php, permissions, restart, mysql

我想在我的网站上创建一个重新启动 mysql 的按钮（我意识到这真的是个坏消息）。我正在使用具有非常严格的用户权限的 ec2。

这是我的 php 代码，但它没有重新启动会话。

```
<?php
if(isset($_POST['mysql'])){
    exec("sudo /etc/init.d/mysqld restart");
}
?>

<form method="POST" action="">
<input type="submit" value="mysql" name="mysql">
</form> 
```

这是我的 suders 文件...

```
Cmnd_Alias RESTART_MYSQL  = /etc/init.d/mysqld restart
mysql ALL =NOPASSWD: RESTART_MYSQL 
```

这也行不通...

```
Cmnd_Alias RESTART_MYSQL  = /etc/init.d/mysqld restart
apache ALL =NOPASSWD: RESTART_MYSQL 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2014-01-03T18:52:44.610

运行**sudo**时，您需要输入密码。所以，你不能在脚本中使用**sudo 。**

# java - Java中的日期差异计算

> ID：10588640
> 
> 赞同：2
> 
> 时间：2012-05-14T18:02:34.433
> 
> 标签：java, date, calendar

我想计算两个日期之间的差异。目前，我正在做：

```
Calendar firstDate = Calendar.getInstance();
firstDate.set(Calendar.DATE, 15);
firstDate.set(Calendar.MONTH, 4);
firstDate.get(Calendar.YEAR);

int diff = (new Date().getTime - firstDate.getTime)/(1000 * 60 * 60 * 24) 
```

这给了我输出 0。但是我希望当 new Date() 为 15 时我应该得到输出 0。目前新日期是 14。这使我的进一步计算错误，我很困惑如何解决这个问题。请建议。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-05-14T18:05:44.117

> 找出两个日期之间的差异并不像减去两个日期并将结果除以 (24 * 60 * 60 * 1000) 那样简单。事实上，它是错误的！

```
/* Using Calendar - THE CORRECT (& Faster) WAY**/  
//assert: startDate must be before endDate  
public static long daysBetween(final Calendar startDate, final Calendar endDate) {  
 int MILLIS_IN_DAY = 1000 * 60 * 60 * 24;  
 long endInstant = endDate.getTimeInMillis();  
 int presumedDays = (int) ((endInstant - startDate.getTimeInMillis()) / MILLIS_IN_DAY);  
 Calendar cursor = (Calendar) startDate.clone();  
 cursor.add(Calendar.DAY_OF_YEAR, presumedDays);  
 long instant = cursor.getTimeInMillis();  
 if (instant == endInstant)  
  return presumedDays;  
 final int step = instant < endInstant ? 1 : -1;  
 do {  
  cursor.add(Calendar.DAY_OF_MONTH, step);  
  presumedDays += step;  
 } while (cursor.getTimeInMillis() != endInstant);  
 return presumedDays;  
} 
```

[您可以在此处](http://tripoverit.blogspot.com/2007/07/java-calculate-difference-between-two.html)阅读更多信息。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-05-14T18:24:48.447

我不认为通过创建一个新的 Date() 会给你当前的时间和日期，而是这样做：

```
Calendar cal = Calendar.getInstance();
Date currentDate = cal.getTime();
Date firstDate = new Date();
firstDate.setHour(...);
firstDate.setMinute(...);
firstDate.setSeconds(...);

long dif = currentDate.getTime() - firstDate.getTime(); 
```

如您所见，您可以像从另一个中减去一个一样简单...

# time - 什么是 A* 时间复杂度，它是如何得出的？

> ID：10588642
> 
> 赞同：6
> 
> 时间：2012-05-14T18:02:39.460
> 
> 标签：time, complexity-theory, a-star

我想知道是否有人可以解释 A* 时间复杂度。我正在使用使用欧几里得距离来估计权重的启发式方法。启发式函数中没有循环。所以我认为启发式的时间复杂度是O(1)。

考虑到这一点，A* 复杂度是多少，它是如何得出的？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2013-02-05T23:25:55.880

你可以在这里得到你的答案： [为什么 A* 的复杂性在内存中是指数级的？](https://stackoverflow.com/questions/1715401/why-is-the-complexity-of-a-exponential-in-memory)

时间复杂度就像内存复杂度

# wpf - Xaml 文件的 WPF 绑定根元素不起作用：

> ID：10588643
> 
> 赞同：-1
> 
> 时间：2012-05-14T18:03:06.353
> 
> 标签：wpf, xaml, c#-4.0, data-binding

我试图将 dataContext 绑定到网格（下面的 xaml）

```
<Grid  ....    DataContext="{Binding Path=NewFormViewModel}"  > ...</Grid> 
```

这个绑定不起作用，我意识到 NewFormViewModel 的 getter 从未被调用过。

此时，网格是 xaml 文件的根元素。

然后我在网格内放置了一个画布并在画布上进行了绑定，例如：

```
<Grid  ....> 
  <Canvas DataContext="{Binding Path=NewFormViewModel}">
      ....
  </Canvas>
</Grid> 
```

数据绑定有效。

接下来，我尝试将网格更改为画布并再次进行数据绑定，如下所示：

```
<Canvas....    DataContext="{Binding Path=NewFormViewModel}"  > ...</Canvas> 
```

绑定再次停止工作。

最后，我选择了一个嵌套在画布内的网格：

```
 <Canvas....> 
      <Grid DataContext="{Binding Path=NewFormViewModel}">
          ....
      </Grid>
    </Canvas> 
```

问题是为什么对 xaml 的根元素的绑定不起作用？

或者我是否应该根本不使用 Canvas/Grid 作为根元素并使用 Page/UserControl 之类的东西？

**编辑**

我的逻辑树看起来像这样：

```
 Window   <- Data binding to object o
           |
           *
          Frame     <-Data binding to obect o inherited
           |
           *
         Canvas/Grid <- Data binding to o.NewFormViewModel failed
           |
           *
         Canvas/Grid <- Data binding to o.NewFormViewModel Succeeds 
```

编辑2：

损坏的xml：

```
<Canvas x:Class="WPFEditors.NewForm"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
      mc:Ignorable="d" Height="398" Width="377"
      DataContext="{Binding Path=NewFormViewModel}"
     >
    <Grid  >
    <Label DataContext="Form Type" Height="31" HorizontalAlignment="Left" Margin="12,22,0,0" VerticalAlignment="Top" Width="92" />
    <ComboBox Margin="148,22,6,347" ItemsSource="{Binding Path=FormTypes}" />
    <Label Content="Description" Height="31" HorizontalAlignment="Left" Margin="12,58,0,0"  VerticalAlignment="Top" Width="92" />
    <Label Content="{Binding Path=Heading}" ToolTip="This is pulled from the Enum defined for FormTypes" Margin="148,59,6,309" />   
    <Label Content="Version" Height="31" HorizontalAlignment="Left" Margin="12,95,0,0"  VerticalAlignment="Top" Width="92" />
    <TextBox Text="Bind this later" Margin="148,97,6,270" Height="31" />
    <Label Content="Approval Level" Height="31" HorizontalAlignment="Left" Margin="12,132,0,0" VerticalAlignment="Top" Width="92" />
    <TextBox Height="31" Margin="148,134,6,233" Text="Bind this later" />
    <Label Content="Number of Approvals" Height="31" HorizontalAlignment="Left" Margin="12,171,0,0" VerticalAlignment="Top" Width="130" />
    <TextBox Height="31" Margin="148,173,6,194" Text="Bind this later" />
    <Label Content="Heading" Height="31" HorizontalAlignment="Left" Margin="12,210,0,0" VerticalAlignment="Top" Width="130" />
    <TextBox Height="31" Margin="148,212,6,155" Text="Bind this later" />
    <Label Content="Static Data Id" Height="31" HorizontalAlignment="Left" Margin="12,247,0,0" VerticalAlignment="Top" Width="130" />
    <TextBox Height="31" Margin="148,249,6,118" Text="Bind this later" />
    <Label Content="{Binding  Path=Errors}" Background="{Binding Path=Color}" Margin="12,325,6,6" BorderThickness="1" BorderBrush="#FF000019" />
    <Button Content="Create" Margin="83,294,202,78" />
    <Button Content="Create" Margin="181,294,104,78" />
    <Button Content="Create" Margin="279,294,6,78" />
    </Grid>
</Canvas> 
```

在上面的 xaml 中，以下行绑定：

```
<Label Content="{Binding Path=Heading}" 
```

即使 Heading 位于该文档继承的视图模型的属性中。在这一点上，我会期待这条线：

```
 DataContext="{Binding Path=NewFormViewModel}" 
```

将数据上下文更改为没有标题的 NewFormViewModel。所有剩余的绑定都失败。

如果我将开头更改为：

```
<Canvas x:Class="NewForm"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
      mc:Ignorable="d" Height="398" Width="377"

     >
    <Grid DataContext="{Binding Path=NewFormViewModel}" > 
```

与 Heading 的绑定失败，其余绑定开始工作。这是我最初期望的行为。

此 xaml 嵌套在此文件中：

```
<Window x:Class="WPFEditors.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="{Binding Path=Heading}" Height="743" Width="1177">

    <StackPanel  >
        <Menu IsMainMenu="True" >
            <MenuItem Header="New">
                <MenuItem Header="New Form" Command="{Binding Path=MenuCommand}" />
            </MenuItem>    
            <MenuItem Header="Edit Form"  ItemsSource="{Binding Path=FormsAvailable}" />
            <MenuItem Header="Edit Rules" />            
        </Menu>

        <Frame  NavigationUIVisibility="Hidden" Source="{Binding Path=CurrentPage}"
                LoadCompleted="Frame_LoadCompleted"
                DataContextChanged="Frame_DataContextChanged"
                Name="frame">
        </Frame>
    </StackPanel>

</Window> 
```

将数据上下文复制到子级的事件处理程序是：

```
private void Frame_LoadCompleted(object sender, NavigationEventArgs e)
{
    UpdateFrameDataContext(); 
}

private void Frame_DataContextChanged(object sender, DependencyPropertyChangedEventArgs e)
{
    UpdateFrameDataContext(); 
}

private void UpdateFrameDataContext()
{
    var content = frame.Content as FrameworkElement; 
    if (content == null) 
        return; 
    content.DataContext = frame.DataContext;  
} 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-05-14T18:46:05.460

如果控件层次结构（如 Window 或 UserControl）中存在（在其 DataContext 中）拥有您正在查询的属性的对象（NewFormViewModel），则根元素中的绑定应该起作用。

# python - 如何查看 Python 应用程序发送的整个 HTTP 请求？

> ID：10588644
> 
> 赞同：336
> 
> 时间：2012-05-14T18:03:10.063
> 
> 标签：python, debugging, https, python-requests

就我而言，我使用该`requests`库通过 HTTPS 调用 PayPal 的 API。不幸的是，我收到了来自 PayPal 的错误，而 PayPal 支持人员无法确定错误是什么或导致它的原因。他们希望我“请提供整个请求，包括标题”。

我怎样才能做到这一点？

* * *

## 回答 #1

> 赞同：630
> 
> 时间：2013-05-19T02:17:31.233

一个简单的方法：在最新版本的 Requests（1.x 和更高版本）中启用日志记录。

Requests 使用`http.client`and`logging`模块配置来控制日志记录的详细程度，如此[处](https://requests.readthedocs.io/en/master/api/#api-changes)所述。

## 示范

从链接文档中摘录的代码：

```
import requests
import logging

# These two lines enable debugging at httplib level (requests->urllib3->http.client)
# You will see the REQUEST, including HEADERS and DATA, and RESPONSE with HEADERS but without DATA.
# The only thing missing will be the response.body which is not logged.
try:
    import http.client as http_client
except ImportError:
    # Python 2
    import httplib as http_client
http_client.HTTPConnection.debuglevel = 1

# You must initialize logging, otherwise you'll not see debug output.
logging.basicConfig()
logging.getLogger().setLevel(logging.DEBUG)
requests_log = logging.getLogger("requests.packages.urllib3")
requests_log.setLevel(logging.DEBUG)
requests_log.propagate = True

requests.get('https://httpbin.org/headers') 
```

## 示例输出

```
$ python requests-logging.py 
INFO:requests.packages.urllib3.connectionpool:Starting new HTTPS connection (1): httpbin.org
send: 'GET /headers HTTP/1.1\r\nHost: httpbin.org\r\nAccept-Encoding: gzip, deflate, compress\r\nAccept: */*\r\nUser-Agent: python-requests/1.2.0 CPython/2.7.3 Linux/3.2.0-48-generic\r\n\r\n'
reply: 'HTTP/1.1 200 OK\r\n'
header: Content-Type: application/json
header: Date: Sat, 29 Jun 2013 11:19:34 GMT
header: Server: gunicorn/0.17.4
header: Content-Length: 226
header: Connection: keep-alive
DEBUG:requests.packages.urllib3.connectionpool:"GET /headers HTTP/1.1" 200 226 
```

* * *

## 回答 #2

> 赞同：177
> 
> 时间：2012-05-14T18:10:50.047

```
r = requests.get('https://api.github.com', auth=('user', 'pass')) 
```

`r`是回应。它有一个 request 属性，其中包含您需要的信息。

```
r.request.allow_redirects  r.request.headers          r.request.register_hook
r.request.auth             r.request.hooks            r.request.response
r.request.cert             r.request.method           r.request.send
r.request.config           r.request.params           r.request.sent
r.request.cookies          r.request.path_url         r.request.session
r.request.data             r.request.prefetch         r.request.timeout
r.request.deregister_hook  r.request.proxies          r.request.url
r.request.files            r.request.redirect         r.request.verify 
```

`r.request.headers`给出标题：

```
{'Accept': '*/*',
 'Accept-Encoding': 'identity, deflate, compress, gzip',
 'Authorization': u'Basic dXNlcjpwYXNz',
 'User-Agent': 'python-requests/0.12.1'} 
```

然后`r.request.data`将主体作为映射。`urllib.urlencode`如果他们愿意，您可以将其转换为：

```
import urllib
b = r.request.data
encoded_body = urllib.urlencode(b) 
```

根据响应的类型，`.data`-attribute 可能会丢失，而`.body`会出现 -attribute。

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2019-07-30T14:35:57.187

您可以使用[HTTP Toolkit](https://httptoolkit.tech/view/python)来做到这一点。

如果您需要快速执行此操作而无需更改代码，它特别有用：您可以从 HTTP Toolkit 打开终端，从那里正常运行任何 Python 代码，您将能够看到每个 HTTP/HTTPS 的完整内容立即请求。

有一个免费版本可以满足您的所有需求，而且它是 100% 开源的。

我是 HTTP Toolkit 的创建者；实际上，我自己构建它是为了解决我前一段时间完全相同的问题！我也在尝试调试支付集成，但他们的 SDK 不起作用，我不知道为什么，我需要知道实际发生了什么才能正确修复它。这非常令人沮丧，但能够看到原始流量确实很有帮助。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2012-05-14T20:46:01.113

如果您使用的是 Python 2.x，请尝试安装[urllib2](http://docs.python.org/library/urllib2.html)开启程序。这应该会打印出您的标头，尽管您可能必须将其与您用来访问 HTTPS 的其他开启程序结合使用。

```
import urllib2
urllib2.install_opener(urllib2.build_opener(urllib2.HTTPHandler(debuglevel=1)))
urllib2.urlopen(url) 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2021-10-29T08:05:32.997

调试 HTTP 本地请求的一个更简单的方法是使用 netcat。如果你跑

```
nc -l 1234 
```

您将开始在端口上侦听`1234`HTTP 连接。您可以通过 访问它`http://localhost:1234/foo/foo/...`。

在终端上，您将看到您发送到端点的任何原始数据。例如：

```
POST /foo/foo HTTP/1.1
Accept: application/json
Connection: keep-alive
Host: example.com
Accept-Language: en-en
Authorization: Bearer ay...
Content-Length: 15
Content-Type: application/json

{"test": false} 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2012-05-15T02:51:27.280

`verbose`配置选项可能允许您查看您想要的内容。文档中有[一个示例](http://docs.python-requests.org/en/latest/user/advanced/#verbose-logging)。

**注意：**阅读下面的评论：详细的配置选项似乎不再可用。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2021-11-29T14:08:49.420

没有日志系统完全工作，（无论如何，从请求 2.26 开始，非常旧的版本可能有另一种行为）

好的解决方案是使用“钩子”并在发生时打印详细信息。

这在这里得到了很好的解释：[https ://findwork.dev/blog/advanced-usage-python-requests-timeouts-retries-hooks/](https://findwork.dev/blog/advanced-usage-python-requests-timeouts-retries-hooks/)

在“打印所有内容”下，

但万一链接在这里死了是重要的部分

```
import requests
from requests_toolbelt.utils import dump

def logging_hook(response, *args, **kwargs):
    data = dump.dump_all(response)
    print(data.decode('utf-8'))

http = requests.Session()
http.hooks["response"] = [logging_hook]

http.get("https://api.openaq.org/v1/cities", params={"country": "BA"}) 
```

这次的结果将是发送查询和接收响应的完整跟踪。

我已经用 POST 和很多标题成功地尝试过它：它有效。不要忘记 pip install requests_toolbelt。

```
# Output
< GET /v1/cities?country=BA HTTP/1.1
< Host: api.openaq.org

> HTTP/1.1 200 OK
> Content-Type: application/json; charset=utf-8
> Transfer-Encoding: chunked
> Connection: keep-alive
>
{
   "meta":{
      "name":"openaq-api",
      "license":"CC BY 4.0",
      "website":"https://docs.openaq.org/",
      "page":1,
      "limit":100,
      "found":1
   },
   "results":[
      {
         "country":"BA",
         "name":"Goražde",
         "city":"Goražde",
         "count":70797,
         "locations":1
      }
   ]
} 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2021-12-14T16:02:44.120

先前的答案似乎被否决了，因为它以“没有什么完全有效”开始，然后提供了这个完美的解决方案：

1.  使用. `requests_toolbelt`_`pip install requests-toolbelt`
2.  像这样使用它：

    ```
    import requests
    from requests_toolbelt.utils import dump

    response = requests.get("https://v2.jokeapi.dev/joke/Any?safe-mode")
    print(dump.dump_all(response).decode("utf-8")) 
    ```

# java - OOP、接口、对象和强制转换

> ID：10588645
> 
> 赞同：2
> 
> 时间：2012-05-14T18:03:13.870
> 
> 标签：java, oop

我正在查看一些过去的 OOP 试卷，如果能帮助我理解以下代码，我将不胜感激。问题是，给定第一个代码块并且 Sandwich 实现了 Edible，以下哪些语句是合法的？

```
Sandwich sub = new Sandwich();
Rectangle cerealBox = new Rectangle(20,30,20,10);
Edible e = null;

e = sub;
sub = e;
sub = (Sandwich) e;
sub = (Sandwich) cerealBox;
e = cerealBox;
e = (Edible) cerealBox;
e = (Rectangle) cerealBox;
e = (Rectangle) null;
e = (Edible) sub;
cerealBox = (Rectangle) new Object(); 
```

我目前的理解是，第一个语句是正确的，因为 sub 具有构成可食用对象所需的元素，因此它不适用于第二个语句。并且使用第三个语句强制转换确实允许它工作。但第四个不是因为谷物盒不适用于三明治。然后由于演员阵容，最后两个确实有效。但显然第六个有效？

很抱歉我对我所知道的事情的糟糕解释，任何帮助将不胜感激。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2012-05-14T18:28:22.980

Java 中的继承和接口实现被称为表示“is-a”关系。也就是说，如果`Boy`继承自`Person`，则`Boy`is-a `Person`。因此，它可以被视为*一个*（`Person`因为它是）。这尤其意味着它可以分配给 type 的实例`Person`。

有了这个，我们可以决定

1.  `e = sub`编译并运行良好。**[好的]**
2.  `sub = e`，另一方面，不编译：is-a 关系不能颠倒。**[！]**
3.  `sub = (Sandwich) e` *强制*上述通过显式转换进行编译。此外，由于`e`此时*确实*包含一个三明治（来自分配 1），因此此转换在运行时也会成功。**[好的]**
4.  `sub = (Sandwich) cerealBox` – 由于没有从`Rectangle`to 进行有意义的转换`Sandwich`，因此无法编译。**[！]**
5.  `e = cerealBox`——这里也一样，原因大致相同。**[！]**
6.  `e = (Edible) cerealBox`在这里，Java 编译器投降了：它允许强制转换，即使我们（程序员）知道它不能成功，因为包含在其中的对象`cerealBox`没有实现`Edible`——但编译器不知道这一点：可以想象，对象包含其中可以派生自`Rectangle`（因此可分配给`cerealBox`），*也可以*实现`Edible`.

    所以编译器默认了。但在运行时，你会得到一个`ClassCastException`.

    请注意此语句与 4 的不同之处：在那里，编译器知道`cerealBox`不能包含`Sandwich`. 但它*可能*包含一些东西`Edible`。为什么？因为 Java 是单继承（并且`Rectangle`不继承自`Sandwich`），但允许从多个接口进行扩展。**[C]**

7.  `e = (Rectangle) cerealBox`失败，因为强制转换实际上完全没有意义（`cerealBox`已经是 type `Rectangle`）并且剩余的语句相当于 5。**[！]**
8.  `e = (Rectangle) null`失败，即使`null` *可以*分配给一个`Edible`对象。但是由于与 5 无效相同的原因，演员表使其无效。**[！]**
9.  `e = (Edible) sub`是有效的，并且等价于 1。然而，转换是完全多余的，因为 Java 在继承层次结构中隐式执行向上转换。**[好的]**
10.  `cerealBox = (Rectangle) new Object()`编译，并在运行时崩溃。原因类似于6：`Object`是`Rectangle`;的基类 因此，一个对象*可以*包含一个`Rectangle`实例，这将使该语句成功（有关示例，请参见 3）。

    确实，编译器有点愚蠢——它*可以*看到被转换的对象——<code>new Object()——绝不可能是`Rectangle`. 但是编译器不做这个分析，因为在一般情况下这是不可能的。**[C]**

键：[OK] = 编译，无错误运行。[C] = 编译，崩溃。[!] = 不编译。

正如你所看到的，哪些语句是“合法的”这个问题并没有完全解决这个问题：其中一些语句可以编译，但在运行时会产生异常。他们合法吗？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-05-14T18:10:56.103

6号不行。Rectangle 没有实现 Edible，因此不能转换为它。

编辑：请参阅 Vulcan 的评论，了解 IDE 为何允许它。您将收到运行时错误。

# postgresql - 如何使用 Symfony 2.0 将数据库更改为 postgresql？

> ID：10588646
> 
> 赞同：12
> 
> 时间：2012-05-14T18:03:14.623
> 
> 标签：postgresql, symfony

我在 Debian 下有一个 Symfony2 项目。将我的数据库更改为 postgresql 的步骤是什么？

*注意：这个问题已经在[这里](https://stackoverflow.com/questions/2840061/using-symfony-with-postgresql)问过了，但我相信它是 symfony 1.4 的。*

* * *

## 回答 #1

> 赞同：35
> 
> 时间：2012-05-14T21:37:31.493

debian下安装postgresql：

```
apt-get install postgresql postgresql-client
apt-get install php5-pgsql
adduser mypguser
su - postgres
psql
CREATE USER mypguser WITH PASSWORD 'mypguserpass';
CREATE DATABASE mypgdatabase;
GRANT ALL PRIVILEGES ON DATABASE mypgdatabase to mypguser;
\q 
```

在 /etc/php5/apache2/php.ini 中，添加：（这实际上是可选的）

```
extension=pdo.so
extension=php_pdo_pgsql.so 
```

更改 symfony apps/config/paramters.ini 文件：

```
[parameters]
    database_driver:    pdo_pgsql
    database_host:      localhost
    database_port:      null
    database_name:      mypgdatabase
    database_user:      mypguser
    database_password:  mypguserpass 
```

重新加载您的项目：

```
php bin/vendors update
php app/console assets:install web
php app/console doctrine:schema:create
php app/console doctrine:fixtures:load
chmod 777 -R app/cache app/logs 
```

你完成了！

**参考：**

[用于配置数据库的 Symfony 文档](http://docs.doctrine-project.org/projects/doctrine-dbal/en/2.0.x/reference/configuration.html)

[debian下postgresql安装](http://wiki.debian.org/PostgreSql#Installation)

# matlab - 在matlab中画一条线的一部分

> ID：10588649
> 
> 赞同：1
> 
> 时间：2012-05-14T18:03:23.357
> 
> 标签：matlab, drawing, line

我只想画一条线的一部分。我会尝试更具体。

![在此处输入图像描述](../Images/b3d1e2fce6b73e50c06f1455463a26cb.png)

现在我只想看到红线的一部分..但我不知道如何在 Matlab 中做到这一点。我想在红点周围显示一小部分。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-05-14T18:17:53.303

使用`plot`命令：

```
 x = [0 3];
  y = [1 -4];
  plot(x,y,'r'); 
```

为了一起绘制 2 个形状，请使用`hold on`：

```
 x = -2*pi:0.01:2*pi;
  y = sin(x);
  plot(x,y,'k');
  hold on;
  x = [0 3];
  y = [1 -4];
  plot(x,y,'r'); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-05-14T18:11:17.623

用来`line`画你需要的东西。假设你想画一个从 (0,1) 到 (3,-4) 的点，输入：

```
line ([0 3], [1 -4]) 
```

# iphone - 为什么我的应用程序在使用此代码从 iCloud 备份中排除文件后仍然被拒绝？

> ID：10588652
> 
> 赞同：1
> 
> 时间：2012-05-14T18:03:34.123
> 
> 标签：iphone, ios, icloud

我添加了以下代码以从 iCloud 备份中排除文件，但我的应用程序仍然被拒绝：

```
 - (BOOL)addSkipBackupAttributeToItemAtURL:(NSURL *)URL
{
    if (&NSURLIsExcludedFromBackupKey == nil) { // iOS <= 5.0.1
        const char* filePath = [[URL path] fileSystemRepresentation];

        const char* attrName = "com.apple.MobileBackup";
        u_int8_t attrValue = 1;

        int result = setxattr(filePath, attrName, &attrValue, sizeof(attrValue), 0, 0);
        return result == 0;
    } else { // iOS >= 5.1

        NSLog(@"%d",[URL setResourceValue:[NSNumber numberWithBool:YES] forKey:NSURLIsExcludedFromBackupKey error:nil]);
        return [URL setResourceValue:[NSNumber numberWithBool:YES] forKey:NSURLIsExcludedFromBackupKey error:nil];
    }
} 
```

在模拟器的情况下，我将以下 url 作为 NSURL 传递：

> file:///Users/TEST/Library/Application%20Support/iPhone%20Simulator/5.1/Applications/62854BAB-AB51-4771-895F-28C61983A7AC/Documents/MyFolder”

有人可以建议我的错误在哪里吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-05-14T18:53:31.123

代码对我来说看起来不错。

您确定所有文件/文件夹都正确设置了标志。

您可以通过此终端命令执行此操作 -> ls -al -@

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-05-14T23:17:20.170

问题在于您传入的 URL。

即使您将数据存储在文件夹中，该数据仍然是两件事

1.  在文档文件夹中，因此它将被同步
2.  该文件夹与您的应用程序相关联

要解决此问题，您需要将其存储在 /Library 而不是 /Documents

所以你的网址是

> file : **///Users/TEST/Library/Application%20Support/iPhone%20Simulator/5.1/Applications/62854BAB-AB51-4771-895F-28C61983A7AC/Library/MyFolder**

自实施 iCloud 以来，Apple 的新偏好是在 Library 文件夹中存储不可同步的数据或任何外部数据

# javascript - 在 $.each 中使用 .replace

> ID：10588653
> 
> 赞同：0
> 
> 时间：2012-05-14T18:03:40.097
> 
> 标签：javascript, jquery, replace, each

jquery 新手。我已经在 javascript 中运行了它，但正在切换到 jquery，所以我可以使用`.each`. 是否有一些特殊规则阻止我`.replace`在 jQuerys中使用 JavaScripts `.each`？

```
 var jse_sanitized_title = "";
    var jse_article_title = "";

    var jse_article_titles = $('.jse_article_title');

    $.each(jse_article_titles, function(i) {

    jse_article_title = jse_article_titles[i].innerHTML;

            //error for this says jse_article_titles[i].replace is not a function
    jse_sanitized_title = jse_article_titles[i].replace(/ /g,"_");

}) 
```

编辑：替换的目的是用下划线替换空格。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-05-14T18:05:43.960

```
$.each(jse_article_titles, function() {
    jse_article_title = this.innerHTML;
    jse_sanitized_title = jse_article_title.replace(/ /g,"_");
}); 
```

**更新后，您似乎想要执行以下操作：**

```
$('.jse_article_title').each(function(){
    this.innerHTML = this.innerHTML.replace(/ /g,"_");
}); 
```

jQuery还有另一种方法：

```
$('.jse_article_title').html(function(index, old){
    return old.innerHTML.replace(/ /g,"_");
}); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-05-14T18:05:01.530

大概你的意思是：

```
 $.each(jse_article_titles, function(i) {

    jse_article_title = jse_article_titles[i].innerHTML;

            //error for this says jse_article_titles[i].replace is not a function
    jse_sanitized_title = jse_article_title .replace(/ /g,"_");
    jse_article_titles[i].innerHTML = jse_sanitized_title;

}) 
```

如果您尚未声明`jse_article_title`，请在此处放置一个 var，例如：

```
var jse_article_title = jse_article_titles[i].innerHTML; 
```

请注意，您必须在最后重新分配它。最后，没有像这样的特殊规则。jQuery 只是一个库。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-05-14T18:05:12.527

> > 编辑：替换的目的是用下划线替换空格。

更新为使用 .text() 函数来设置全部替换`spaces`为`_`

[**演示**](http://jsfiddle.net/skram/WhJGG/)

```
$('.jse_article_title').text(function () {
    return this.innerHTML.replace(/ /g, '_');
}); 
```

* * *

可能是你需要

```
jse_sanitized_title = jse_article_title.replace(/ /g,"_"); 
//using the jse_article_title 
```

或者

```
jse_sanitized_title = jse_article_titles[i].innerHTML.replace(/ /g,"_"); 
```

或使用 jQuery，

```
jse_sanitized_title = $(this).text().replace(/ /g, "_"); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-05-14T18:14:39.150

要按照您尝试的方式（使用 innerHTML）执行此操作，您需要使用 get() 引用节点......您需要这样做：

```
jse_article_titles.get(i).innerHTML 
```

但是，您应该能够缩短一点。

```
$('.jse_article_title').each( function() {
    $(this).html( $(this).html().replace(/ /g,"_") );
});

// or

$('.jse_article_title').each( function() {
    this.innerHTML = this.innerHTML.replace(/ /g,"_");
});

// whichever floats your boat 
```

[编辑]：对不起，我错了需要 .get()。jse_articles_titles[i] 只要数字不是负数就完全有效，这不太可能。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-05-14T18:06:40.457

尝试这个：

```
$.each(jse_article_titles, function() {

    jse_article_title = $(this).html();

    jse_sanitized_title = jse_article_title.replace(/ /g,"_");

}) 
```

# visual-studio-2010 - 如何更改图像的颜色并仍然通过代码重新识别？

> ID：10588654
> 
> 赞同：0
> 
> 时间：2012-05-14T18:03:46.633
> 
> 标签：visual-studio-2010, image, vba

这是我第一次在这里提问，所以请善待。

这是我在 Visual Basic 2010 中制作的一个小游戏。我有一个图像，当单击它时，它会变暗。我需要它稍后被代码识别为与原始图像相同。

这是使图像变暗的代码：

```
Sub WaterDarken(ByVal picTarget As PictureBox)
    Dim pic As New Bitmap(picTarget.Image)
    Dim intRed As Integer
    Dim intGreen As Integer
    Dim intBlue As Integer
    For x As Integer = 0 To picTarget.Image.Width - 1
        For y As Integer = 0 To picTarget.Image.Height - 1
            Dim intDarkenedColor As Color = pic.GetPixel(x, y)
            If intDarkenedColor.R - 50 <= 255 And intDarkenedColor.R - 50 >= 0 Then
                intRed = intDarkenedColor.R - 50
            Else
                intRed = 0
            End If
            If intDarkenedColor.G - 50 <= 255 And intDarkenedColor.G - 50 >= 0 Then
                intGreen = intDarkenedColor.G - 50
            Else
                intGreen = 0
            End If
            If intDarkenedColor.B - 50 <= 255 And intDarkenedColor.B - 50 >= 0 Then
                intBlue = intDarkenedColor.B - 50
            Else
                intBlue = 0
            End If
            intDarkenedColor = Color.FromArgb(225, intRed, intGreen, intBlue)
            pic.SetPixel(x, y, intDarkenedColor)
        Next
    Next
    picTarget.Image = pic
End Sub 
```

这是将原始图像与变暗图像进行比较的代码：

```
 Function IsDarkened(ByRef source As Image, ByRef darkenedSource As Image) As Boolean
    Dim pic As New Bitmap(source)
    Dim pic2 As New Bitmap(darkenedSource)
    Dim intRed As Integer
    Dim intGreen As Integer
    Dim intBlue As Integer
    For x As Integer = 0 To pic.Width - 1
        For y As Integer = 0 To pic.Height - 1
            Dim darkened As Color = pic.GetPixel(x, y)
            If darkened.R - 50 <= 255 And darkened.R - 50 >= 0 Then
                intRed = darkened.R - 50
            Else
                intRed = 0
            End If
            If darkened.G - 50 <= 255 And darkened.G - 50 >= 0 Then
                intGreen = darkened.R - 50
            Else
                intGreen = 0
            End If
            If darkened.B - 50 <= 255 And darkened.B - 50 >= 0 Then
                intBlue = darkened.B - 50
            Else
                intBlue = 0
            End If
            darkened = Color.FromArgb(255, intRed, intGreen, intBlue)
            pic.SetPixel(x, y, darkened)
        Next
    Next
    For x = 0 To pic.Width - 1
        For y = 0 To pic.Height - 1
            If pic.GetPixel(x, y) <> pic2.GetPixel(x, y) Then
                Return False
            End If
        Next
    Next
    Return True
End Function 
```

但是，有些东西不起作用，并且图像没有被注意到是相同的。这一直困扰着我一段时间。如果你们中的任何人可以提供帮助，请这样做！谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-05-14T18:46:16.363

当您使用 Color.FromArgb() 时，您将像素设置为两个不同的 alpha 值：

intDarkenedColor = Color.FromArgb（**225**，intRed，intGreen，intBlue）

对比

变暗 = Color.FromArgb（**255**，intRed，intGreen，intBlue）

具有相同的 RGB 但不同的不透明度将始终导致不同的图像。

# php - 依赖注入：在实际需要时拉取所需的组件

> ID：10588659
> 
> 赞同：18
> 
> 时间：2012-05-14T18:03:55.993
> 
> 标签：php, design-patterns, dependency-injection

DI 背后的要点是让一个类从创建和准备它所依赖的对象中解脱出来，然后将它们推入。这听起来很合理，但有时一个类不需要所有被推入其中的对象来执行其功能。这背后的原因是“提前返回”发生在无效的用户输入或所需对象之一较早抛出的异常或在代码块运行之前实例化对象所需的某个值不可用时。

更实际的例子：

*   注入一个永远不会使用的数据库连接对象，因为用户数据没有通过验证（前提是没有使用触发器来验证这个数据）
*   注入收集输入的类似excel的对象（例如PHPExcel）（加载和实例化很重，因为整个库被拉入并且从未使用过，因为验证在写入发生之前抛出异常）
*   在类中确定的变量值，但不是在运行时的注入器；例如，一个路由组件，它确定应该根据用户输入调用的控制器（或命令）类和方法
*   虽然这可能是一个设计问题，但它是一个实质性的服务类，它依赖于很多组件，但每个请求只使用其中的 1/3（原因，为什么我倾向于使用命令类而不是控制器）

因此，在某种程度上，推入所有必要的组件与创建某些组件但从未使用过的“延迟加载”相矛盾，这有点不切实际并且会影响性​​能。就 PHP 而言 - 加载、解析和编译更多文件。如果被推入的对象有自己的依赖关系，这尤其痛苦。

我看到了 3 种方法，其中 2 种听起来不太好：

*   注入工厂
*   注入注射器（一种反模式）
*   注入一些外部函数，一旦达到相关点就会从类内部调用（smtg，如“数据验证完成后检索 PHPExcel 实例”）；由于它的灵活性，这是我倾向于使用的

问题是处理这种情况的最佳方法是什么/你们使用什么？

**更新**：@GordonM 以下是 3 种方法的示例：

```
//inject factory example
interface IFactory{
    function factory();
}
class Bartender{
    protected $_factory;

    public function __construct(IFactory $f){
        $this->_factory = $f;
    }
    public function order($data){
        //validating $data
        //... return or throw exception
        //validation passed, order must be saved
        $db = $this->_factory->factory(); //! factory instance * num necessary components
        $db->insert('orders', $data);
        //...
    }
}

/*
inject provider example
assuming that the provider prepares necessary objects
(i.e. injects their dependencies as well)
*/
interface IProvider{
    function get($uid);
}
class Router{
    protected $_provider;

    public function __construct(IProvider $p){
        $this->_provider = $p;
    }
    public function route($str){
        //... match $str against routes to resolve class and method
        $inst = $this->_provider->get($class);
        //...
    }
}

//inject callback (old fashion way)
class MyProvider{
    protected $_db;
    public function getDb(){
        $this->_db = $this->_db ? $this->_db : new mysqli();
        return $this->_db;
    }
}
class Bartender{
    protected $_db;

    public function __construct(array $callback){
        $this->_db = $callback;
    }
    public function order($data){
        //validating $data
        //... return or throw exception
        //validation passed, order must be saved
        $db = call_user_func_array($this->_db, array());
        $db->insert('orders', $data);
        //...
    }
}
//the way it works under the hood:
$provider = new MyProvider();
$db = array($provider, 'getDb');
new Bartender($db);

//inject callback (the PHP 5.3 way)
class Bartender{
    protected $_db;

    public function __construct(Closure $callback){
        $this->_db = $callback;
    }
    public function order($data){
        //validating $data
        //... return or throw exception
        //validation passed, order must be saved
        $db = call_user_func_array($this->_db, array());
        $db->insert('orders', $data);
        //...
    }
}
//the way it works under the hood:
static $conn = null;
$db = function() use ($conn){
    $conn = $conn ? $conn : new mysqli();
    return $conn;
};
new Bartender($db); 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2012-05-14T19:26:11.070

我最近在计划一个我想尽可能正确地做的主要项目时一直在考虑这个问题（坚持 LoD，没有硬编码的依赖项等）。我的第一个想法也是“注入工厂”方法，但我不确定这是要走的路。来自 Google 的 Clean Code 会谈声称，如果您通过一个对象到达您真正想要的对象，那么您就违反了 LoD。这似乎排除了注入工厂的想法，因为你必须通过工厂才能得到你真正想要的东西。也许我错过了一些让它变得好的点，但直到我确定我正在考虑其他方法。

你如何进行函数注入？我想你正在传递一个回调来实例化你想要的对象，但是一个代码示例会很好。

如果您可以使用代码示例更新您的问题，以说明您提到的三种样式，它可能会很有用。我特别渴望看到“注入注射器”，即使它是一种反模式。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2012-05-17T13:11:24.140

确实出现的一个想法是代理对象的想法。它实现了与您要传入的实际对象相同的接口，但它没有实现任何东西，它只是保存真实类的实例并将方法调用转发给它。

```
interface MyInterface 
{
    public function doFoo ();
    public function isFoo ();
    // etc
}

class RealClass implements MyInterface
{
    public function doFoo ()
    {
         return ('Foo!');
    }

    public function isFoo ()
    {
        return ($this -> doFoo () == 'Foo!'? true: false);
    }

    // etc
}

class RealClassProxy implements MyInterface
{
    private $instance = NULL;

    /**
     * Do lazy instantiation of the real class
     *
     * @return RealClass
     */
    private function getRealClass ()
    {
        if ($this -> instance === NULL)
        {
            $this -> instance = new RealClass ();
        }
        return $this -> instance;
    }

    public function doFoo ()
    {
        return $this -> getRealClass () -> doFoo ();
    }

    public function isFoo ()
    {
        return $this -> getRealClass () -> isFoo ();
    }

    // etc
} 
```

因为代理具有与真实类相同的接口，您可以将其作为参数传递给任何类型提示接口的函数/方法。Liskov 替换原则适用于代理，因为它响应与真实类相同的所有消息并返回相同的结果（接口强制执行此操作，至少对于方法签名）。然而，真正的类不会被实例化，除非一条消息真正被发送到代理，代理在幕后对真正的类进行惰性实例化。

```
function sendMessageToRealClass (MyInterface $instance)
{
    $instance -> doFoo ();
}

sendMessageToRealClass (new RealClass ());
sendMessageToRealClass (new RealClassProxy ()); 
```

代理对象涉及一个额外的间接层，这显然意味着您进行的每个方法调用都会对性能造成很小的影响。但是，它确实允许您进行惰性实例化，因此您可以避免实例化不需要的类。这是否值得取决于实例化真实对象的成本与额外间接层的成本。

编辑：我最初写这个答案的想法是对真实对象进行子类化，因此您可以将该技术用于不实现任何接口（如 PDO）的对象。我最初认为接口是执行此操作的正确方法，但我想要一种不依赖于绑定到接口的类的方法。反思这是一个很大的错误，所以我更新了答案以反映我首先应该做的事情。但是，此版本确实意味着您不能直接将此技术应用于没有关联接口的类。您必须将此类类包装在另一个类中，该类确实为代理方法提供了一个接口，这意味着另一个间接层。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2012-05-17T13:44:36.400

如果你想实现延迟加载，你基本上有两种方法（正如你已经在主题中写的那样）：

1.  不是注入您**可能**需要的对象实例，而是注入 a`Factory`或 a `Builder`。它们之间的区别在于，创建实例`Builder`是为了返回一种类型的对象（可能具有不同的设置），而`Factory`创建不同类型的实例（具有相同的生命周期和/或实现相同的接口）。

2.  利用匿名函数，它将返回一个实例。看起来像这样：

    ```
    $provider = function() {
        return new \PDO('sqlite::memory:');
    }; 
    ```

    只有当您调用此匿名函数时，`PDO`才会创建实例并建立与数据库的连接。

我通常在我的代码中做的是**结合两者**。你可以装备`Factory`这样的`provider`。例如，这使您可以为由所述工厂创建的所有对象建立一个连接，并且仅当您第一次从`Factory`.

结合这两种方法的另一种方法（虽然我没有使用过）是创建完整`Provider`的类，它在构造函数中接受一个匿名函数。然后工厂可以传递同一个实例，`Provider`并且昂贵的对象（PHPExcel、Doctrine、SwiftMailer 或其他实例）仅在`Product`第`Factory`一次变成`Provider` *（无法想出更好的名称来描述所​​有对象时）创建由同一工厂创建）*并请求它。之后，这个昂贵的对象在所有`Products`.`Factory`

*...我的 2 美分*

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-10-07T09:32:51.723

我选择了**惰性注入**（即注入一个代理类）：

```
class Class1 {
    /**
     * @Inject(lazy=true)
     * @var Class2
     */
    private $class2;

    public function doSomething() {
        // The dependency is loaded NOW
        return $this->class2->getSomethingElse();
    } 
```

这里，依赖（class2）不是直接注入的：注入了一个代理类。只有在使用代理类时才会加载依赖项。

这在**[PHP-DI](http://mnapoli.github.com/PHP-DI/)**（依赖注入框架）中是可能的。

*免责声明：我在这个项目中工作*

# delphi - 整个项目的字体一致性？

> ID：10588660
> 
> 赞同：24
> 
> 时间：2012-05-14T18:03:55.990
> 
> 标签：delphi, delphi-xe

**是否有一种快速有效的方法来应用要在项目中使用的全局字体？**

我的意思是我想设置一个特定的字体名称，我的项目中的所有控件都将使用，例如`TButton`，`TEdit`等`TLabel`。

通常，为 Form 而不是特定控件设置 Font 会将该 Form 上的所有控件更改为指定的 Font。

但是，这有一个小问题，如果您手动更改了特定控件上的字体，那么通过表单设置字体将不再更新以前手动更改的那些控件。

**理念一**

我正在考虑使用 For 循环并遍历表单上的每个组件并以这种方式设置字体，例如：

```
procedure TForm1.FormCreate(Sender: TObject);
var
  i: Integer;
begin
  with TForm(Self) do
  begin
    for i := 0 to ComponentCount - 1 do
    begin
      if Components[i] is TButton then
      begin
        TButton(Components[i]).Font.Name  := 'MS Sans Serif';
        TButton(Components[i]).Font.Size  := 8;
        TButton(Components[i]).Font.Style := [fsBold];
      end;

      if Components[i] is TLabel then
      begin
        TLabel(Components[i]).Font.Name  := 'MS Sans Serif';
        TLabel(Components[i]).Font.Size  := 8;
        TLabel(Components[i]).Font.Style := [fsBold];
      end;
    end;
  end;
end; 
```

但是这样做看起来很乱，对于一个简单的任务也会有相当多的代码。

**想法 2**

我知道我可以在设计时为每个控件一个一个地手动更改字体，但是要通过几种表单可能需要一些时间，即使那样我也可能会错过一个控件。

**想法 3**

与想法 2 类似，另一种方法是将表单视为文本 (DFM) 并以这种方式查找和替换字体。

* * *

基本上我会在我的应用程序中保持一致性，并且始终使用一种字体是我想要实现的目标。

我是否在这里遗漏了一些完全明显的东西，我试图为这样的任务做过度的事情吗？

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2012-05-14T19:48:04.157

正如评论中所讨论的，关键是`ParentFont`属性。此属性在 VCL 层次结构中的各个点定义。如果您设置`ParentFont`为`True`链中的所有组件，那么您只需修改即可更改整个应用程序的字体

```
Application.DefaultFont 
```

默认情况下，大多数组件都设置`ParentFont`为`True`，因此您无事可做。奇怪的是`TForm`。一个全新的默认表单已`ParentFont`设置为`False`. 这有点令人失望，但我怀疑这反映了一个事实，即 VCL 的原始设计者没有预料到这一点，并且`ParentFont`在 VCL 的开发中相对较晚才移植到这一点。

无论如何，在理想情况下，应用程序中的所有表单都应该派生自您控制的公共基类。如果是这样，那么您可以简单地在那里进行更改，设置`ParentFont`为 be `True`，确保没有明确的字体设置应用于表单上的任何组件，并且您是金色的。通过单个属性控制整个应用程序的字体。如果您的表单没有通用基类，那么现在是添加它的理想时机。如果您不想这样做，那么您需要`ParentFont`为每个表单进行设置。

其他相关属性是[`Screen.MessageFont`](http://docwiki.embarcadero.com/Libraries/en/Vcl.Forms.TScreen.MessageFont)和[`Screen.MenuFont`](http://docwiki.embarcadero.com/Libraries/en/Vcl.Forms.TScreen.MenuFont)。这些提供了对消息框和菜单中使用的字体的全局控制。然而，最新版本的 Delphi 已将消息框和菜单的绘制控制权交还给 Windows，因此这些属性无效。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-05-17T15:46:01.307

如前所述，真正的关键是确保您的所有表单都源自您自己的应用程序基础表单。

然后，您可以查看每个表单和按钮等，并查看属性，其中任何修改的字体属性都应以粗体显示，并且易于识别。大多数属性都有“恢复到继承”菜单选项。这应该基本上撤消任何先前的选择，而无需转到文本版本进行编辑。（尽管它可能正是这样做的，删除了以前字体设置产生的任何文本条目）。

我肯定想修复每个表单一次，而不是让它定义不正确并在运行时添加更多代码来修复它。如果您后来决定做一些不同的事情，那么这种变化会给您带来更严重的问题。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-05-14T20:02:33.517

如果你想做这个运行时，就像你在想法 1 中描述的那样，你应该考虑把它变成一个递归函数，像这样：

```
procedure SetFontProperties(Control: TControl; Name: TFontName; Size: Integer; Styles: TFontStyles);
// Set font properties
var
  Index: Integer;
  Font: TFont;
  AnObject: TObject;
  ChildControl: TControl;
begin
  // Set font properties
  AnObject := GetObjectProp(Control, 'Font', nil);
  if AnObject is TFont then
  begin
    // Set properties
    Font := TFont(AnObject);
    Font.Name  := Name;
    Font.Size  := Size;
    Font.Style := Styles;
  end;

  // Set child font properties
  if Control is TWinControl then
  begin
    // Set
    for Index := 0 to TWinControl(Control).ControlCount - 1 do
    begin
      // Child control
      ChildControl := TWinControl(Control).Controls[Index];

      // Set font properties
      SetFontProperties(ChildControl, Name, Size, Styles);
    end;
  end;
end; 
```

然后，您可以像这样使用它来为表单中的所有控件切换字体：

```
SetFontProperties(Self, 'Courier', 14, []); 
```

然后该函数将设置窗体的字体属性，以及窗体上所有子控件的字体属性，包括嵌套在 TPanel 或其他容器控件中的控件。

但是，我确实同意您的看法，这是一种有点混乱的做法。

# java - Mule 3：如何从 Java 源代码中获取“全局属性”元素的值

> ID：10588661
> 
> 赞同：1
> 
> 时间：2012-05-14T18:03:59.517
> 
> 标签：java, mule

有没有办法在 Java 代码中检索“全局属性”元素的值？

```
<mule xmlns="http://www.mulesoft.org/schema/mule/core">
  <global-property name="theKey" value="theValue" />
</mule> 
```

我正在使用骡子 3.2.1。谢谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-05-14T18:25:42.923

这：

```
MuleContext muleContext = ...
muleContext.getRegistry().get("theKey"); 
```

# java - 使用 varnish 后面的 restlet 出错（反向代理）

> ID：10588662
> 
> 赞同：1
> 
> 时间：2012-05-14T18:04:12.577
> 
> 标签：java, android, json, restlet, varnish

我正在使用 restlet 服务器，我的移动应用程序有一个 RESTful 提供程序。与清漆有什么关系可以使restlet工作？

事实上，不使用清漆并使我的应用程序直接联系我的休息服务器一切正常。

这里是restlet服务器返回的异常：

```
May 14, 2012 7:48:10 PM org.restlet.resource.UniformResource doCatch
WARNING: Exception or error caught in resource
java.lang.NullPointerException
        at fr.evoxmusic.ebackupserver.rest.IsGoogleRegistered.isGoogleRegistered(IsGoogleRegistered.java:30)
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
        at java.lang.reflect.Method.invoke(Method.java:597)
        at org.restlet.resource.ServerResource.doHandle(ServerResource.java:449)
        at org.restlet.resource.ServerResource.post(ServerResource.java:1114)
        at org.restlet.resource.ServerResource.doHandle(ServerResource.java:533)
        at org.restlet.resource.ServerResource.doNegotiatedHandle(ServerResource.java:590)
        at org.restlet.resource.ServerResource.doConditionalHandle(ServerResource.java:302)
        at org.restlet.resource.ServerResource.handle(ServerResource.java:849) 
```

注意：我正在使用 Reslet 客户端。这是我联系服务器的代码。

```
public class RestletClient extends ClientResource {
    private static final String TAG = "RestletClient";
    private static final String UserAgent = "eBackupSMS";

    public static JSONObject SendHttpPost(String URL, JSONObject entity) {
        JSONObject result = new JSONObject();
        JsonRepresentation jr = new JsonRepresentation(entity);

        Client client = new Client(new Context(), Protocol.HTTP);
        client.getContext().getParameters().add("useForwardedForHeader", "true");
        ClientResource cr = new ClientResource(URL);
        cr.setNext(client);

        List<Preference<Encoding>> preflist = cr.getClientInfo().getAcceptedEncodings();
        preflist.add(new Preference<Encoding>(Encoding.GZIP));
        preflist.add(new Preference<Encoding>(Encoding.DEFLATE));

        cr.getClientInfo().setAgent(UserAgent);

        // Others params.
        cr.setRetryDelay(10000);
        cr.setRetryAttempts(3);
        cr.setRetryOnError(true);

        try {

            cr.post(jr);
            jr = new JsonRepresentation(cr.getResponseEntity());
            cr.release();

            result = jr.getJsonObject();
        } catch (Exception e) {
            Log.e(TAG, e.toString());
        }

        return result;
    }

} 
```

这里是发生错误的 isGoogleRegistered 资源。

```
public class IsGoogleRegistered extends ServerResource {

    /**
     * Method used to verify if the token provided by the client is valid for
     * the google server.
     * 
     * @param entity as json representation
     * @return a jsonobject containing the response
     * @throws Exception
     * 
     * @example : {"google":{"registrationid":"client token id"}}
     */
    @Post("json")
    public JsonRepresentation isGoogleRegistered(JsonRepresentation entity) throws Exception {
        JSONObject wrapper = new JSONObject();
        JSONObject content = new JSONObject();

        wrapper = entity.getJsonObject().getJSONObject("google");

        try {
            if (C2DMMessage.isGoogleRegistered(JBackupServer.c2dmToken, wrapper.getString("registrationid")))
                content.put("isgoogleregistered", true);
            else
                content.put("isgoogleregistered", false);
        } catch (IOException e) {
            content.put("error", "connection to google servers not available");
        }

        wrapper = new JSONObject();
        wrapper.put("result", content);

        JsonRepresentation jr = new JsonRepresentation(wrapper);
        return jr;
    }

} 
```

第 30 行：

```
wrapper = entity.getJsonObject().getJSONObject("google"); 
```

谢谢。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-05-16T13:14:32.703

通过使用 socat 我看到清漆似乎没有正确地将分块的 http 请求转发到后端。

# ios - 用于在设备上进行测试的苹果配置文件冲突

> ID：10588664
> 
> 赞同：0
> 
> 时间：2012-05-14T18:04:14.433
> 
> 标签：ios, xcode, testing

我目前正在为雇用其他人使用他的 Apple Developer 帐户编写应用程序的人开发一个应用程序。我一直在 Xcode 中工作，而我之前的人正在使用 Corona SDK。最后一个人是最初为测试配置配置文件的人，因此在我的计算机上拥有我需要的所有配置信息，以便允许从中进行测试。我知道在 Xcode 中有一种方法可以导出配置文件并将其导入另一台计算机以相对轻松地解决此问题；有没有办法在 Corona 和 Xcode 之间做到这一点，以便我可以在我的计算机上获得必要的信息？

使用 Corona 的人刚刚说要从帐户中删除所有信息并从头开始，但是 a) 我的老板不想这样做，以防他需要在上一个发布的应用程序上推送更多更新， b）我什至不知道这是否可行。如果有办法获得第二个新的供应许可证，我的老板愿意支付更多的钱，但他想保留同一个开发者帐户，以便他的所有应用程序都在该帐户下发布。

这里最好的做法是什么？

# java - 从本机函数（c++，jni）返回一个 int 会使应用程序崩溃

> ID：10588665
> 
> 赞同：7
> 
> 时间：2012-05-14T18:04:25.617
> 
> 标签：java, android, c++, android-ndk, java-native-interface

试图弄清楚为什么返回 int 的 c++ 函数调用会使整个应用程序崩溃而没有任何错误/警告。

这是工作代码：

```
 jint Java_org_ntorrent_DummyTorrentInfoProvider_next(
            JNIEnv * env, jobject obj, jint number)
    {
        jint test = rand();
        __android_log_print(ANDROID_LOG_DEBUG, "HelloNDK!", "rand() = %d", test);

        return number;
    } 
```

这段代码在没有警告的情况下使应用程序崩溃：

```
 jint Java_org_ntorrent_DummyTorrentInfoProvider_next(
            JNIEnv * env, jobject obj, jint number)
    {
        jint test = rand();
        __android_log_print(ANDROID_LOG_DEBUG, "HelloNDK!", "rand() = %d", test);

        return number + test;
    } 
```

在应用程序崩溃之前，我可以在 log cat 中看到我的日志消息（__android_log_print）

编辑：即使我用“1”替换“数字+测试”，应用程序仍然崩溃......它只有在我返回“数字”时才有效......

编辑#2：Java 端代码：

```
 package org.ntorrent;

import java.util.ArrayList;
import java.util.Random;

public class DummyTorrentInfoProvider implements TorrentInfoProvider {

    public native Integer next(Integer number);

    //public Integer next() { return _random.nextInt(); }

    public native void test();

    private Random _random = new Random(100);

    @Override
    public ArrayList getTorrents() {
        test();
        ArrayList torrents = new ArrayList();
        torrents.add(
                new TorrentInfo("test torrent number 1", next(1),  3f, 5f));
        torrents.add(
                new TorrentInfo("test torrent number 2", next(2), 4f, 15f));
        torrents.add(
                new TorrentInfo("test torrent number 555"));
        torrents.add(
                new TorrentInfo("test torrent number 3", next(3), 13f, 5f));
        return torrents;
    }

    static {
        System.loadLibrary("test");
    }
} 
```

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2012-05-14T19:05:24.057

```
jint Java_org_ntorrent_DummyTorrentInfoProvider_next(
    JNIEnv * env, jobject obj, jint number) 
```

和

```
public native Integer next(Integer number); 
```

不符合。*Integer*是Object，而*int*是原始类型。

如果您的本机代码使用*jint*，则您的 java 代码应在本机方法的声明中使用*int*。

（如果你想传递一个整数，你需要在本地把它当作一个作业，并跳过箍来访问它 - 使用 int/jint 并从 Integer 中进行任何必要的转换可能更容易java端)

# python - python从html读取unicode字符

> ID：10588666
> 
> 赞同：1
> 
> 时间：2012-05-14T18:04:27.557
> 
> 标签：python

我有这个脚本，它从网页中读取文本：

```
page = urllib2.urlopen(url).read()
soup = BeautifulSoup(page);
paragraphs = soup.findAll('p');

for p in paragraphs:
    content = content+p.text+" "; 
```

在网页中我有这个字符串：

```
Möddinghofe 
```

我的脚本将其读取为：

```
M&#195;&#182;ddinghofe 
```

我怎样才能按原样阅读它？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-05-14T18:16:22.417

希望这会对你有所帮助

```
from BeautifulSoup import BeautifulStoneSoup
import cgi

def HTMLEntitiesToUnicode(text):
    """Converts HTML entities to unicode.  For example '&amp;' becomes '&'."""
    text = unicode(BeautifulStoneSoup(text, convertEntities=BeautifulStoneSoup.ALL_ENTITIES))
    return text

def unicodeToHTMLEntities(text):
    """Converts unicode to HTML entities.  For example '&' becomes '&amp;'."""
    text = cgi.escape(text).encode('ascii', 'xmlcharrefreplace')
    return text

text = "&amp;, &reg;, &lt;, &gt;, &cent;, &pound;, &yen;, &euro;, &sect;, &copy;"

uni = HTMLEntitiesToUnicode(text)
htmlent = unicodeToHTMLEntities(uni)

print uni
print htmlent
# &, ®, <, >, ¢, £, ¥, €, §, ©
# &amp;, &#174;, &lt;, &gt;, &#162;, &#163;, &#165;, &#8364;, &#167;, &#169; 
```

参考：[将 HTML 实体转换为 Unicode，反之亦然](https://stackoverflow.com/questions/701704/how-do-you-convert-html-entities-to-unicode-and-vice-versa-in-python)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-05-14T18:25:47.247

我建议你看一下 BeautifulSoup 文档的[编码](http://www.crummy.com/software/BeautifulSoup/bs4/doc/#encodings)部分。

# c# - C# 中的 System.FormatException

> ID：10588668
> 
> 赞同：0
> 
> 时间：2012-05-14T18:04:47.320
> 
> 标签：c#, formatexception

在我尝试为销售变量分配值的每一种情况下，我都会收到 FormatException。有人知道我在做什么错吗？我应该把这个控制台程序作为家庭作业来学习循环，但我正在了解更多关于其他事情的信息。它应该根据每笔销售的 10% 佣金保留销售人员佣金的运行标签。无论如何，这里是代码：

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;

namespace TubSales
{
   class Program
   {
      static void Main(string[] args)
      {
         char initial;
         const double COMM_INT = 0.10;
         double sale, aComm = 0, bComm = 0, eComm = 0;
         Console.Write("Enter 'A' for Andrea, 'B' for Brittany,\n'E' for Eric, or 'Z' to quit >> ");
         initial = Convert.ToChar(Console.Read());
         while (initial != 'z' && initial != 'Z')
         {
            switch (initial)
            {
               case 'a':
               case 'A':
                  Console.Write("Enter the sales for Andrea >> ");
                  sale = Convert.ToDouble(Console.ReadLine());
                  aComm = aComm + COMM_INT * sale;
                  break;
               case 'b':
               case 'B':
                  Console.Write("Enter the sales for Brittany >> ");
                  sale = Convert.ToDouble(Console.ReadLine());
                  bComm = bComm + COMM_INT * sale;
                  break;
               case 'e':
               case 'E':
                  Console.Write("Enter the sales for Eric >> ");
                  sale = Convert.ToDouble(Console.ReadLine());
                  eComm = eComm + COMM_INT * sale;
                  break;
               default:
                  Console.WriteLine("You did not enter a valid initial");
                  break;
            }
            Console.Write("Enter 'A' for Andrea, 'B' for Brittany, or 'E' for Eric >> ");
            initial = (char)Console.Read();
         }
         Console.WriteLine("Andrea had {0}, Brittany had {1}, and Eric had {2} in commissions.", aComm.ToString("C"), bComm.ToString("C"), eComm.ToString("C"));
         Console.Write("Press any key to exit... ");
         Console.ReadKey();
      }
   }
} 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2012-05-14T18:10:04.883

> 在我尝试为销售变量分配值的每一种情况下，我都会收到 FormatException。有人知道我在做什么错吗？

如果字符串（从 返回）不是有效数字，则[Convert.ToDouble](http://msdn.microsoft.com/en-us/library/zh1hkw6k.aspx)方法将引发 a 。`FormatException``Console.ReadLine()`

通常，如果您想解析用户输入，最好使用[Double.TryParse](http://msdn.microsoft.com/en-us/library/system.double.tryparse.aspx)，因为这可以让您确定输入是否为有效数字*而不会*捕获异常。

这通常看起来像：

```
Console.Write("Enter the sales for Andrea >> ");
while (!double.TryParse(Console.ReadLine(), out sale))
{
    Console.WriteLine("Value entered was not a valid number.");
    Console.Write("Enter the sales for Andrea >> ");
}
// Once you get here, "sale" will be set appropriately 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-05-14T18:23:05.277

虽然 Reed 的答案很好，但这不是问题所在。

[真正发生的是和这个](https://stackoverflow.com/questions/3800343/c-sharp-why-is-it-skipping-my-console-readline)一样的情况

Console.Read 只读取“回车的第二部分”并返回“”。这就是转换失败的原因。

代替

```
initial = Convert.ToChar(Console.Read()); 
```

和

```
initial = Convert.ToChar(Console.ReadLine()); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-05-14T18:22:13.390

代替

```
initial = Convert.ToChar(Console.Read()); 
```

和

```
initial = Convert.ToChar(Console.ReadLine().FirstOrDefault()); 
```

# python - python类语法混乱

> ID：10588669
> 
> 赞同：0
> 
> 时间：2012-05-14T18:04:47.663
> 
> 标签：python, oop, class, syntax

我从教程中创建了这段代码，但很难理解一个关键概念：“next”如何变得等于字符串“s”？self.start 如何引用该字符串？

```
import sys

class DemoClass(object): 

    def __init__(self, start): # executes once!
        self.start = start
        print "_init_"

    def play(self):            # executes once!
        next = self.start
        print "next"

        while True:
            attr = getattr(self, next)  #get attribute of the class
            next = attr()

    def s(self):              # these methods start calling each other once executed
        print "s"
        return 't'

    def t(self):
        print "t"
        i = raw_input(">")
        if i == 's':          # if user input 'i' is equal to 's', call func "s"
            return "s"
        elif i == 'v':
            return "v"
        else:
            exit(0)

    def v(self):
        print "v"
        return 's'  

a = DemoClass("s")
a.play() 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-05-14T18:16:21.380

第一次初始化类时，将入口点设置为函数 spaghetti。 `play()`然后根据原来的情况启动执行链`start`。 `getattr(self, next)`实际上将获得对具有该名称的类成员的引用，`next=attr()`并将调用返回的成员并将`getattr`该调用返回的值分配给`next`.

至于方法，当next是's'时，`s`会执行，然后`next`是't'，这会导致`t`被检索和执行。 `t`其中有一个`raw_input`呼叫，这意味着用户可以控制下一个呼叫。如果用户输入's'，`t`将返回's'，如果他们输入'v'，`t`将返回'v'，否则程序将退出。 `v`只是导致`play`循环回到`s`.

这是一堆毫无意义的逻辑，没有任何上下文来解释为什么您可能希望以这种方式构建程序，所以我明白为什么它会令人困惑。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-05-14T18:16:11.100

对于您的第一个问题： getattr 在这种情况下返回实例的属性 method `s`，然后执行它`attr()`， getattr 将实例和属性作为字符串并返回属性对象。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-05-14T18:20:29.950

我发现您的代码有些混乱，但基本上这里发生的事情与 Python 类的功能有关。因为 Python 函数是局部作用域的，所以为了对类对象本身进行任何修改，类的每个方法都将类本身作为其第一个参数，按照约定称为“self”。该对象具有所有变量和方法作为属性。

还有一个特殊`__init__`函数，当您声明该类的实例时会调用该函数。这也`self`作为第一个参数，然后是您希望的任何其他自定义参数。

至于您的问题，以下简化代码是如何`'s'`分配给`next`：

```
class DemoClass(object):

  def __init__(self, the_input):
    # The input on the class declaration is assigned to the 
    #  class attribute 'start'
    self.start = the_input

  def play(self):
    self.next = self.start

  joe = DemoClass('s')
  print joe.start # prints 's'

  print joe.next # raises error, since joe.next hasn't been defined  

  joe.play()
  print joe.next # also prints 's', now that self.next has been defined 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-05-14T18:20:41.103

> 'next' 如何变得等于字符串“s”

每当调用任何对象方法时，该方法的第一个参数都会自动设置为对象本身。它通常被称为`self`.

当您这样做时`a = DemoClass("s")`，`DemoClass::__init__`会使用参数`self`和`'s'`. 然后`self.start = start`赋值`'s'`给`self.start`。

当您调用时`a.play()`，该对象作为第一个参数发送到`play`. `next = self.start`assigns`self.start`分配给`'s'`in `__init__`to `next`。

# c# - 在安装时设置 .NET Windows 服务的角色...从 app.config 设置

> ID：10588671
> 
> 赞同：2
> 
> 时间：2012-05-14T18:04:56.600
> 
> 标签：c#, .net, windows, service

我有一个服务，安装后将 Myapp.exe.config 文件（基于 app.config 文件生成）放入安装目录。在安装过程中，我需要此文件中的详细信息来配置安装。特别是我需要调整服务的 ServiceProcessInstaller 实例的帐户/用户名/密码字段，以便在它运行时以特定用户身份运行。

但是，在安装过程中，安装程序尚未设置我的注册表设置，也没有将我的 Myapp.exe.config 复制到安装目录......所以我无法提取这些值，这意味着我的服务无法正确安装用户。我现在能做到的唯一方法是将用户/传递值硬编码到 ProjectInstaller 类中，但我不能让自己这样做。这是错误的。

是否有关于如何以特定用户身份安装服务以及如何在安装过程中访问这些凭据的 Windows 安装最佳实践。

目前我正在尝试类似的东西：

```
namespace MyService
{
   [RunInstaller(true)]
   public partial class ProjectInstaller : System.Configuration.Install.Installer
   {
      public ProjectInstaller()
      {
         InitializeComponent();

         //Set the user credentials.
         //NOTE: Eventually this needs to be updated to pull these values out of a
         //      conf file.  The problem now is that the location of the conf file
         //      is tied to a registry entry for the location of the service which
         //      may or may not exist when this block is executed.
         /* This is the only way I can get it to work, but this is
          * too horrible to ever actually do it this way:
         serviceProcessInstaller1.Account = System.ServiceProcess.ServiceAccount.User;
         serviceProcessInstaller1.Username = "DOMAIN\\user";
         serviceProcessInstaller1.Password = "password";
          */

         // Try to pull the service's registry values to know where it installed:
         RegistryKey keyService = Registry.LocalMachine.OpenSubKey("SYSTEM\\CurrentControlSet\\services\\MyService");
         string path = ((string)keyService.GetValue("ImagePath"));
         path = path.Substring(1, path.LastIndexOf('\\'));

         string user = someValueFromFileIOontheAbovePath1,
                pass = someValueFromFileIOontheAbovePath2;

         serviceProcessInstaller1.Account = System.ServiceProcess.ServiceAccount.User;
         serviceProcessInstaller1.Username = user;
         serviceProcessInstaller1.Password = pass;
         //Doesn't work because install isn't complete and there aren't reg settings
         // yet, and even if I had the path the .config file is not written yet so
         // there's no file to parse.
      }
   }
} 
```

一些包含这些参数的 .config 文件：

```
<?xml version="1.0" encoding="utf-8" ?>
<configuration>
   <appSettings>
      <add key="User" value="DOMAIN\bob"/>
      <add key="Password" value="secret"/>
   </appSettings>
</configuration> 
```

如何*在*安装过程中提取这些用户/密码值而不将它们硬编码到二进制文件中？

谢谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-05-14T18:12:02.497

有许多选项具有不同的安全级别。

1）如果你指定了ServiceAccount.User但没有给出用户名和密码，微软的类会弹出一个窗口供输入凭据。这是非常安全的，因为凭据永远不会存储在任何地方，但弹出窗口并没有真正让运行安装程序的人清楚他们正在输入的内容。另外，弹出窗口与其他安装屏幕并不能很好地配合。

2) 您可以让 MSI 将用户名和密码作为参数传递给您的安装程序类。这些值以纯文本形式保留在 InstallLog 文件中，因此您肯定要删除它。

3) 让 MSI 使用 DPAPI（System.Security.Cryptography.ProtectedData 类）加密注册表中的名称/密码，然后将它们解密并在您的服务安装程序类中使用它们。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-05-14T18:13:36.693

使用 MSI 完成所需的一种方法是在提交上使用自定义操作来运行自定义对象安装程序。提交操作在文件被复制后运行，因此文件将存在于用户选择的安装目录中。

# android - 自定义 ListView 适配器抛出 NullPointerException

> ID：10588686
> 
> 赞同：1
> 
> 时间：2012-05-14T18:06:06.460
> 
> 标签：android, android-listview, nullpointerexception, custom-adapter

我的自定义适配器有一些问题`ListView`。我不确定我的问题出在 xml 文件、数据还是`ListView`. `NullPointerException`当我设置适配器时，我得到了一个。适配器类：

```
public class InboxAdapter extends BaseAdapter {

    private Context context;

    private List<MailInbox> mails;

    public InboxAdapter(Context context, List<MailInbox> mails)
    {
        this.context = context;
        this.mails = mails;
    }

    @Override
    public int getCount() {
        return mails.size();
    }

    @Override
    public Object getItem(int item) {
        return mails.get(item);
    }

    @Override
    public long getItemId(int position) {
        return position;
    }

    @Override
    public View getView(int position, View convertView, ViewGroup viewGroup) {

        MailInbox entry = mails.get(position);

        if(convertView == null)
        {
            LayoutInflater inflater = (LayoutInflater)context.getSystemService(Context.LAYOUT_INFLATER_SERVICE);
            convertView = inflater.inflate(R.layout.mail_list_row, null);
        }

        ImageView mailImg = (ImageView)convertView.findViewById(R.id.mail_thumb);
        boolean read = entry.IsRead;

        if(read)
        {
            //Set "read" image
            mailImg.setImageResource(R.drawable.message);
        } else
        {
            //Set "unread" image
            mailImg.setImageResource(R.drawable.message);
        }

        TextView author = (TextView)convertView.findViewById(R.id.mail_text);
        TextView body = (TextView)convertView.findViewById(R.id.mail_detail);
        TextView date = (TextView)convertView.findViewById(R.id.mail_date);

        author.setText(entry.AuthorName);
        body.setText(entry.MessageBody);
        date.setText(entry.CreatedAt);

        return convertView;
    }
} 
```

`Activity`我使用它的地方：

```
public class InboxActivity extends SherlockActivity 
{
    private ListView list;
    private GetMessagesConnection mMessages;

    public String kidID;

    public InboxActivity() {
        // TODO Auto-generated constructor stub
    }

    public void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);

        setContentView(R.layout.inbox_layout);        

        Bundle extras = getIntent().getExtras();
        if(extras != null)
        {
            kidID = extras.getString("kidID");
        }

        new GetMails().execute();
    }

    private void setUpList()
    {
        list = (ListView)findViewById(R.id.mail_list);      

        ArrayList<MailInbox> mails = new ArrayList<MailInbox>();

        for(int i = 0; i < mMessages.myMail.size(); i++)
        {
            MailInbox inbox = new MailInbox();

            inbox.AuthorName = mMessages.myMail.get(i).AuthorName;
            inbox.CreatedAt = mMessages.myMail.get(i).CreatedAt;
            inbox.MessageBody = mMessages.myMail.get(i).MessageBody;
            inbox.IsRead = mMessages.myMail.get(i).IsRead;

            System.out.println("Author: " + inbox.AuthorName);
            System.out.println("Time: " + inbox.CreatedAt);
            System.out.println("Message: " + inbox.MessageBody);
            System.out.println("Read: " + inbox.IsRead);

            mails.add(inbox);
        }

        int length = mails.size();
        System.out.println("Size: " + length);

        InboxAdapter adapter = new InboxAdapter(this, mails);

        // It crashes here with a Nullpointer Exception
        list.setAdapter(adapter);
    }

    private class GetMails extends AsyncTask<Void, Void, Void> implements DialogInterface.OnCancelListener
    {
        private ProgressDialog dialog;

        protected void onPreExecute()
        {
                dialog = ProgressDialog.show(InboxActivity.this, "", "Henter beskeder...", true);
        }

        protected Void doInBackground(Void... unused)
        {
                mMessages = new GetMessagesConnection();

                mMessages.kidID = kidID;

                mMessages.connection();

                return null;
        }

        protected void onPostExecute(Void unused)
        {           
            dialog.dismiss();
            setUpList();
        }

        public void onCancel(DialogInterface dialog)
        {
            cancel(true);
            dialog.dismiss();
        }
    }
} 
```

*邮件列表*：

```
<?xml version="1.0" encoding="utf-8"?>
<ListView xmlns:android="http://schemas.android.com/apk/res/android"
    android:id="@+id/mail_list"
    android:layout_width="fill_parent"
    android:layout_height="fill_parent"
    android:layout_weight="2" >    
</ListView> 
```

*mail_list_row*:

```
<?xml version="1.0" encoding="utf-8"?>
<RelativeLayout xmlns:android="http://schemas.android.com/apk/res/android"
    android:layout_width="fill_parent"
    android:layout_height="48dip"
    android:background="@drawable/listselector"
    >
    <ImageView
        android:id="@+id/mail_thumb"
        android:layout_width="30dip"
        android:layout_height="30dip"
        android:layout_centerVertical="true"
        android:layout_alignParentLeft="true"
        android:contentDescription="@string/imgdesc"
        />
    <TextView
        android:id="@+id/mail_text"
        android:layout_toRightOf="@+id/mail_thumb"
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:textSize="14dip"
        android:layout_marginLeft="8dip"
        android:layout_centerVertical="false"
        android:singleLine="true"
        android:ellipsize="end"
        android:textStyle="bold"
        android:textColor="@android:color/white"
        />
    <TextView 
        android:id="@+id/mail_detail"
        android:layout_toRightOf="@+id/mail_thumb"
        android:layout_below="@+id/mail_text"
        android:layout_width="100dip"
        android:layout_height="wrap_content"
        android:textSize="12dip"
        android:layout_marginLeft="8dip"
        android:layout_centerVertical="false"
        android:singleLine="true"
        android:ellipsize="end"
        android:textColor="@color/grey"     
        />
    <TextView 
        android:id="@+id/mail_date"
        android:layout_toRightOf="@+id/mail_detail"
        android:layout_below="@+id/mail_text"
        android:layout_width="100dip"
        android:layout_height="wrap_content"
        android:textSize="12dip"
        android:singleLine="true"
        android:ellipsize="end"
        android:textColor="@color/grey"
        android:layout_alignParentRight="true"      
        />
</RelativeLayout> 
```

我不知道可能是什么`null`。我已经尝试解决这个问题几个小时了。错误日志：

```
05-14 19:55:45.525: E/AndroidRuntime(2509): FATAL EXCEPTION: main
05-14 19:55:45.525: E/AndroidRuntime(2509): java.lang.NullPointerException
05-14 19:55:45.525: E/AndroidRuntime(2509):     at com.cim.daycare.InboxActivity.setUpList(InboxActivity.java:75)
05-14 19:55:45.525: E/AndroidRuntime(2509):     at com.cim.daycare.InboxActivity.access$2(InboxActivity.java:36)
05-14 19:55:45.525: E/AndroidRuntime(2509):     at com.cim.daycare.InboxActivity$GetMails.onPostExecute(InboxActivity.java:101)
05-14 19:55:45.525: E/AndroidRuntime(2509):     at com.cim.daycare.InboxActivity$GetMails.onPostExecute(InboxActivity.java:1)
05-14 19:55:45.525: E/AndroidRuntime(2509):     at android.os.AsyncTask.finish(AsyncTask.java:417)
05-14 19:55:45.525: E/AndroidRuntime(2509):     at android.os.AsyncTask.access$300(AsyncTask.java:127)
05-14 19:55:45.525: E/AndroidRuntime(2509):     at android.os.AsyncTask$InternalHandler.handleMessage(AsyncTask.java:429)
05-14 19:55:45.525: E/AndroidRuntime(2509):     at android.os.Handler.dispatchMessage(Handler.java:99)
05-14 19:55:45.525: E/AndroidRuntime(2509):     at android.os.Looper.loop(Looper.java:123)
05-14 19:55:45.525: E/AndroidRuntime(2509):     at android.app.ActivityThread.main(ActivityThread.java:3683)
05-14 19:55:45.525: E/AndroidRuntime(2509):     at java.lang.reflect.Method.invokeNative(Native Method)
05-14 19:55:45.525: E/AndroidRuntime(2509):     at java.lang.reflect.Method.invoke(Method.java:507)
05-14 19:55:45.525: E/AndroidRuntime(2509):     at com.android.internal.os.ZygoteInit$MethodAndArgsCaller.run(ZygoteInit.java:839)
05-14 19:55:45.525: E/AndroidRuntime(2509):     at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:597)
05-14 19:55:45.525: E/AndroidRuntime(2509):     at dalvik.system.NativeStart.main(Native Method) 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-05-14T18:19:57.433

In the activity `InboxActivity` you set the content view to `R.layout.inbox_layout`(I don't see this file in your question) and you search for the `ListView` with the id `R.id.mail_list`. A `ListView` with this `id` exist in the `mail_list.xml` file. Are you sure that the content view for the `InboxActivity` isn't `R.layout.mail_list`:

```
//...
public void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.mail_list);        
        Bundle extras = getIntent().getExtras();
//... 
```

Also:

*   Please don't declare a constructor for the `InboxActivity`, initialize what you want in the `onCreate` method(this is how things work in the android world).

*   Do you handle the cases when `extras` is `null`? (If the `extras` is `null` then `kidID` will also be `null` and this could put you in trouble in the `GetMessagesConnection` class if you don't handle this scenario).

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-05-14T18:21:55.747

You get the instance to your list like this `list = (ListView)findViewById(R.id.mail_list);` which means you are checking your current layout for that ID, but your current layout is set to `setContentView(R.layout.inbox_layout);`

What is inbox_layout? You haven't showed us the XML?Did you mean to set it to `setContentView(R.layout.mail_list);` instead?

Edit: Also, you may want to look into using a ViewHolder in your custom adapter to avoid making repetitive calls to `findViewByID(...)`. Take a look at this tutorial: [http://xjaphx.wordpress.com/2011/06/16/viewholder-pattern-caching-view-efficiently/](http://xjaphx.wordpress.com/2011/06/16/viewholder-pattern-caching-view-efficiently/)

# javascript - 大规模 KnockoutJS 应用架构

> ID：10588693
> 
> 赞同：20
> 
> 时间：2012-05-14T18:06:49.393
> 
> 标签：javascript, asp.net-mvc-3, knockout.js, knockout-2.0

我喜欢 KnockoutJS，但一直在努力寻找用它构建大型 Javascript 应用程序的最佳方法。

现在我处理代码的方式是构建一个根视图模型，该模型通常从母版页级别开始，然后在此基础上进行扩展。我只`ko.applyBindings()`在主视图上。这是我的示例代码：

```
var companyNamespace = {};

// Master page. (a.k.a _Layout.cshtml)
(function(masterModule, $, ko, window, document, undefined) {
    var private = "test";

    masterModule.somePublicMethod = function() {};
    masterModule.viewModel = function() {
        this.stuff = ko.observable();
    };
}(companyNamespace.masterModule = companyNamespace.masterModule || {}, jQuery, ko, window, document));

// Index.cshtml.
(function(subModule, $, ko, window, document, undefined) {
    var private = "test";

    subModule.somePublicMethod = function() {};
    subModule.viewModel = function() {
        this.stuff = ko.observable();
    };

    $(document).ready(function() {
        ko.applyBindings(companyNamespace.masterModule);
    });
}(companyNamespace.masterModule.subModule = companyNamespace.masterModule.subModule || {}, jQuery, ko, window, document)); 
```

我只是担心，因为这是一个树结构，如果我需要插入一个双母版页或类似的东西，这将是非常麻烦的重构。

想法？

**编辑**

我知道您可以将绑定应用于单独的元素以更改绑定的范围但是如果我有嵌套的视图模型怎么办？

* * *

## 回答 #1

> 赞同：44
> 
> 时间：2013-03-12T16:46:23.897

我有一个相当大的 knockout.js 单页应用程序。（目前有 20K+ 行代码）任何人都可以很容易地维护和添加额外的部分。我有数百个 observables，性能仍然很好，即使在像旧 iPod touch 这样的移动设备上也是如此。它基本上是一个承载一套工具的应用程序。以下是对我使用的应用程序的一些见解：

## 1\. 只有一个视图模型。恕我直言，它使事情变得简单。

视图模型处理任何单页应用程序的基础知识，例如每个页面（应用程序）的可见性、导航、错误、加载和吐司对话框等。 视图模型示例片段：（我将其分离出更进一步的 js 文件，但是这是为了让您大致了解它的外观）

```
var vm = {

    error:
    {
        handle: function (error, status)
        {
           //Handle error for user here
        }
    },
    visibility:
    {
        set: function (page)
        {
            //sets visibility for given page
        }
    },
    permissions:
    {
        permission1: ko.observable(false),
        permission2: ko.observable(false)
        //if you had page specific permissions, you may consider this global permissions and have a separate permissions section under each app
    },
    loadDialog:
    {
        message: ko.observable(''),
        show: function (message)
        {
            //shows a loading dialog to user (set when page starts loading)
        },
        hide: function()
        {
            //hides the loading dialog from user (set when page finished loading)
        }
    },

    app1:
    {
        visible: ko.observable(false),
        load: function () 
        {
          //load html content, set visibility, app specific stuff here
        }
    },
    app2: 
    {
        visible: ko.observable(false),
        load: function () 
        {
          //load html content, set visibility, app specific stuff here
        }
    }

} 
```

## 2\. 所有模型进入一个单独的 .js 文件。

我将模型视为类，所以它们真正做的只是存储变量并具有一些基本的格式化函数（我尽量让它们保持简单）。示例模型：

```
 //Message Class
    function Message {
        var self = this;

        self.id = ko.observable(data.id);
        self.subject = ko.observable(data.subject);
        self.body = ko.observable(data.body);
        self.from = ko.observable(data.from);

    } 
```

## **3.**将AJAX数据库调用保存在自己的js文件中。

最好按部分或“应用程序”分隔。例如，您的文件夹树可能是 js/database/，其中 app1.js 和 app2.js 作为 js 文件包含您的基本创建检索、更新和删除功能。数据库调用示例：

```
vm.getMessagesByUserId = function ()
{

    $.ajax({
        type: "POST",
        url: vm.serviceUrl + "GetMessagesByUserId", //Just a default WCF url
        data: {}, //userId is stored on server side, no need to pass in one as that could open up a security vulnerability
        contentType: "application/json; charset=utf-8",
        dataType: "json",
        cache: false,
        success: function (data, success, xhr)
        {
            vm.messaging.sent.messagesLoaded(true);

            for (var i = 0; i < data.messages.length; i++)
            {
                var message = new Message({
                    id: data.messages[i].id,
                    subject: data.messages[i].subject,
                    from: data.messages[i].from,
                    body: data.messages[i].body
                });
                vm.messaging.sent.messages.push(message);
            }
        },
        error: function (jqXHR)
        {
            vm.error.handle(jqXHR.getResponseHeader("error"), jqXHR.status);
        }
    });
    return true;
}; 
```

## 4\. 将所有模型、视图模型和数据库 js 文件合并并缩小为一个。

我使用允许您创建“捆绑”js 文件的 Visual Studio“Web Essentials”扩展。（选择 js 文件，右键单击它们并转到 Web Essentials --> Create Javascript Bundle File）我的 Bundle 文件设置如下：

```
<?xml version="1.0" encoding="utf-8"?>
<bundle minify="true" runOnBuild="true">
  <!--The order of the <file> elements determines the order of them when bundled.-->

  <!-- Begin JS Bundling-->
  <file>js/header.js</file>

  <!-- Models -->

  <!-- App1 -->
  <file>js/models/app1/class1.js</file>
  <file>js/models/app1/class2.js</file>

  <!-- App2 -->
  <file>js/models/app2/class1.js</file>
  <file>js/models/app2/class2.js</file>

  <!-- View Models -->
  <file>js/viewModel.js</file>

  <!-- Database -->
  <file>js/database/app1.js</file>
  <file>js/database/app2.js</file>

  <!-- End JS Bundling -->
  <file>js/footer.js</file>

</bundle> 
```

header.js 和 footer.js 只是文档就绪功能的包装器：

**header.js：**

```
//put all views and view models in this
$(document).ready(function()
{ 
```

**页脚.js：**

```
//ends the jquery on document ready function
}); 
```

## 5\. 分离您的 HTML 内容。

不要保留一个难以浏览的巨大 html 文件。因为knockout的绑定和HTTP协议的无状态，很容易掉入knockout这个陷阱。但是，我使用两个选项进行分离，具体取决于我是否认为该作品被用户大量访问：

**服务器端包括：（**只是指向另一个 html 文件的指针。如果我觉得这部分应用程序被用户大量使用，我会使用它，但我想将它分开）

```
<!-- Begin Messaging -->    
    <!--#include virtual="Content/messaging.html" -->
<!-- End Messaging --> 
```

您不想使用服务器端包含太多，否则用户每次访问页面时必须加载的 HTML 量会变得相当大。话虽如此，这是迄今为止分离您的 html 的最简单的解决方案，同时保持您的淘汰赛绑定到位。

**异步加载 HTML 内容：（**如果应用程序的给定部分用户使用频率较低，我会使用它）

我使用 jQuery 加载函数来完成此操作：

```
 // #messaging is a div that wraps all the html of the messaging section of the app
        $('#messaging').load('Content/messaging.html', function ()
        {
            ko.applyBindings(vm, $(this)[0]); //grabs any ko bindings from that html page and applies it to our current view model
        }); 
```

## 6.保持您的页面/应用程序的可见性易于管理

显示和隐藏您的 knockout.js 应用程序的不同部分很容易因为大量难以管理和记住的代码行而变得疯狂，因为您必须设置如此多不同的打开和关闭开关。首先，我将每个页面或应用程序保存在其自己的“div”中（并在其自己的 html 文件中进行分隔）。示例 HTML：

```
<!-- Begin App 1 -->

<div data-bind="visible: app1.visible()">
<!-- Main app functionality here (perhaps splash screen, load, or whatever -->
</div>

<div data-bind="visible: app1.section1.visible()">
<!-- A branch off of app1 -->
</div>

<div data-bind="visible: app1.section2.visible()">
<!-- Another branch off of app1 -->
</div>

<!-- End App 1 -->

<!-- Begin App 2 -->
<div data-bind="visible: app2.visible()">
<!-- Main app functionality here (perhaps splash screen, load, or whatever -->
</div>
<!-- End App 2 --> 
```

其次，我将有一个与此类似的可见性功能，可以设置您网站上所有内容的可见性：（它还在子功能中处理我的导航）

```
vm.visibility:
{
    set: function (page)
    {
      vm.app1.visible(page === "app1");
      vm.app1.section1.visible(page === "app1section1");
      vm.app1.section2.visible(page === "app1section2");
      vm.app2.visible(page === "app2");     
    }
}; 
```

然后只需调用应用程序或页面的加载函数：

```
<button data-bind="click: app1.load">Load App 1</button> 
```

其中将具有此功能：

```
vm.visibility.set("app1"); 
```

这应该涵盖大型单页应用程序的基础知识。那里可能有比我提出的更好的解决方案，但这并不是一个坏方法。多个开发人员可以轻松地在应用程序的不同部分工作，而不会与版本控制发生冲突等等。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2012-05-19T20:32:46.617

我喜欢使用原型继承来设置我的视图模型。像你一样，我有一个“主”视图模型。该视图模型包含其他视图模型的实例或可观察的视图模型数组，您可以在标记中使用“foreach”和“with”绑定。在“foreach”和“with”绑定中，您可以使用 $data、$parent、$parents 和 $root 绑定上下文来引用您的父视图模型。

以下是 KO 文档中的相关文章。

[foreach 绑定](http://knockoutjs.com/documentation/foreach-binding.html)

[带装订](http://knockoutjs.com/documentation/with-binding.html)

[绑定上下文](http://knockoutjs.com/documentation/binding-context.html)

如果你愿意，我可以拼凑一个小提琴。让我知道。

# vb.net - 带有自定义类的VB datagrid +数组

> ID：10588695
> 
> 赞同：0
> 
> 时间：2012-05-14T18:07:29.330
> 
> 标签：vb.net, arrays, data-binding, datagridview

我创建了一个班级“学生”并制作了一个包含学生的数组。我不仅想在 datagridview 中显示数组，而且如果用户对 datagridview 中的一名学生进行更改，也应该更新数组。

我成功地在 dgv 中显示了数组：一种方法是使用 datasource prop，另一种方法是用图表表示。但是，我不知道如何让用户通过编辑 dgv 来编辑数组。

有人知道怎么做吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-05-14T18:20:30.223

如果网格不是只读的，并且数据是从数据源属性绑定的，那么双击显示的任何值都应该是可编辑的

# ruby-on-rails - 使用acts_as_taggable_on 和ActiveAdmin 操作标签

> ID：10588696
> 
> 赞同：12
> 
> 时间：2012-05-14T18:07:31.407
> 
> 标签：ruby-on-rails, ruby-on-rails-3, ruby-on-rails-3.2, activeadmin, acts-as-taggable-on

我有一个通过 ActiveAdmin 访问的 Post 模型。它也可以使用acts_as_taggable_on gem 进行标记。因此管理员可以在特定帖子中添加、编辑或删除标签。

在管理面板中为资源添加标记功能的常规方法是在 admin/posts.rb 中执行此操作：

```
ActiveAdmin.register Post do
  form do |f|
    f.inputs "Details", :multipart => true do
      f.input :tag_list
      # and the other irrelevant fields goes here
    end

    f.buttons
  end
end 
```

但是，我希望从多选表单字段中选择标签，而不是在文本字段中手动输入（就像上面的代码一样）。所以我试过这样做：

```
 f.input :tag_list, :as => :select,
                         :multiple => :true,
                         :collection => ActsAsTaggableOn::Tag.all 
```

但它没有按预期工作。这实际上创建了带有一些整数值的新标签，并将它们分配给该 Post。有人告诉我，这个工作需要额外的代码。

关于这是如何完成的任何线索？这是我的模型以防万一： http: [//pastie.org/3911123](http://pastie.org/3911123)

提前致谢。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2012-11-24T03:04:32.857

代替

```
:collection => ActsAsTaggableOn::Tag.all 
```

尝试

```
:collection => ActsAsTaggableOn::Tag.pluck(:name) 
```

将集合设置`Tag.all`为将使用标签的 ID 标记您的帖子，因为这是默认识别标签的方式（这是名称的整数值的来源）。`map(&:name)`告诉表单生成器改用标签的名称。

# javascript - 一次更改后调整所有 jQuery UI 微调器的最大值？

> ID：10588702
> 
> 赞同：0
> 
> 时间：2012-05-14T18:07:44.680
> 
> 标签：javascript, jquery, jquery-ui

从 jQuery UI 1.9 里程碑 7 开始，我正在使用 jQuery UI 微调器的 beta 版本。我想要做的是以下内容：我有一系列微调器输入，它们都具有相同的类，我可以用作一个 jQuery 选择器 (.spinner)。这些微调器正在为一组对象设置值，这些对象都来自同一个资源“池”。每次更新微调器的值时，我都想根据该资源池剩余的数量来更新*所有*微调器的最大值。这是到目前为止的基本代码：

```
var unusedPool = 500;

jQuery(document).ready(function($) {
    $('.spinner').spinner({
        min: 0,
        max: (unusedPool + this.value),
        change: function(event, ui) {
            // An AJAX call which pushes the change to the DB,
            // and returns a JSON object containing the change in what remains
            // in the resource pool.
            jQuery.ajax({
               // URL, type, etc. etc.
               data: { newValue: this.value },
               success: function (data) {
                   unusedPool -= data.change;
                   // Here is where I need to go through and update *all* spinners,
                   // so their new "max" is their current value plus the new 
                   // unusedPoolSize.
               }
            }   
        }
}); 
```

有没有办法做我想做的事？我是否需要将事件绑定到所有微调器然后触发该事件，或者是否有更直接的方法（在更改回调中）来访问所有微调器并更改“最大值”值？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-05-14T19:59:57.160

我想你可以在成功函数中添加这样的东西：

```
$('.spinner').each(function() {
  $(this).spinner().change(function() {
    $(this).spinner('option', 'max', $(this).spinner('value') + unusedPool);
  });
}); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-05-15T18:35:57.967

Kvam 的回答结果非常接近，但成功函数内的更新不会进入 spinner.change 回调内部（因为 .ajax 调用本身位于 .change 回调内部）。我最终发现这可以完成这项工作：

```
var unusedPool = 500;

jQuery(document).ready(function($) {
    var spinners = $('.spinner').each(function() {
        $(this).spinner({
            min: 0,
            max: (parseInt(this.value) + unusedPool),
            change: function(event, ui) {
                jQuery.ajax({
                    data: { newValue = this.value },
                    success: function(data) {
                        unusedPool -= data.change;
                        spinners.each(function() {
                            var newMax = parseInt(this.value) + unusedPool;
                            $(this).spinner({ max: newMax });
                        }
                    }
                });
            }
        });
    }); 
```

# php - 如何在下面的示例中删除数据库行？

> ID：10588705
> 
> 赞同：4
> 
> 时间：2012-05-14T18:07:55.677
> 
> 标签：php, javascript, jquery, ajax, dom

我有一个取消按钮，用户可以在其中取消文件上传，它会显示一条取消消息。现在我还想发生的是，当用户单击“取消”按钮时，它将在数据库中查找已取消的文件名并删除数据库行。问题是它根本没有删除数据库行。我怎样才能做到这一点。目前我正在使用 jpuery.ajax 方法，您可以在下面的代码中看到该方法。

下面是表单代码：

```
var $fileImage = $("<form action='imageupload.php' method='post' enctype='multipart/form-data' target='upload_target' onsubmit='return imageClickHandler(this);' class='imageuploadform' >" + 

 "Image File: <input name='fileImage' type='file' class='fileImage' /></label><br/><br/><label class='imagelbl'>" + 

 "<input type='submit' name='submitImageBtn' class='sbtnimage' value='Upload' /></label>" + 

 "</p><p class='imagef1_cancel' align='center'><label>" + 

 "<input type='button' name='imageCancel' class='imageCancel' cancel_image_file_name='" + imagefilename + "' value='Cancel' /></label></form>"); 
```

下面是取消按钮功能：

```
 $('.imagef1_cancel').eq(window.lastUploadImageIndex).find(".imageCancel").on("click", function(event) {

        var cancel_image_file_name = $(this).attr('cancel_image_file_name');

    jQuery.ajax("cancelimage.php?imagefilename=" + cancel_image_file_name)

    return stopImageUpload(2, cancel_image_file_name);

}); 
```

最后下面是 jquery.ajax 导航到的 cancelimage.php 脚本，据说可以删除包含文件名的数据库行：

```
 <?php

...

    //I have connected to database

    $cancel_image_file_name = $_GET["imagefilename"];

            $imagecancelsql = "DELETE FROM Image 
            WHERE ImageFile = 'ImageFiles/". mysql_real_escape_string($cancel_image_file_name)."'";

        mysql_query($imagecancelsql);

        mysql_close();

    ?> 
```

更新：

以下是当我回显删除查询时它当前显示的内容：

注意：未定义的索引：第 19 行 /web/stud/xxx/.../cancelimage.php 中的图像文件名 DELETE FROM Image WHERE ImageFile = 'ImageFiles/'

下面是删除函数的代码，当按下删除按钮时，它将导航到 deleteimage.php 脚本并删除数据库行：

```
function stopImageUpload(success, imagefilename){

         $('.listImage').eq(window.lastUploadImageIndex).append('<div>' + htmlEncode(imagefilename) + '<button type="button" class="deletefileimage" image_file_name="' + imagefilename + '">Remove</button><br/><hr/></div>'); 

$('.listImage').eq(window.lastUploadImageIndex).find(".deletefileimage").on("click", function(event) {
    var image_file_name = $(this).attr('image_file_name');

    jQuery.ajax("deleteimage.php?imagefilename=" + image_file_name)

    $(this).parent().remove();
});

      return true;   
} 
```

下面是 deleteimage.php 脚本：

```
<?php

//connected to DB

  $image_file_name = $_GET["imagefilename"];

        $imagedeletesql = "DELETE FROM Image 
        WHERE ImageFile = 'ImageFiles/". mysql_real_escape_string($image_file_name)."'";

    mysql_query($imagedeletesql);

    mysql_close();

?> 
```

下面是取消按钮功能现在的样子的更新：

```
function startImageUpload(imageuploadform, imagefilename){
            $('.imagef1_cancel').eq(window.lastUploadImageIndex).find(".imageCancel").on("click", function(event) {

var cancel_image_file_name_ = $(this).attr('css');
var cancel_image_file_name = '';
var style_array = cancel_image_file_name_.split(" ");
for(i=0;i<style_array.length;i++){
    if(style_array[i].substr(0,2) == "__"){
     cancel_image_file_name = style_array[i].slice(2,style_array[i].length-2);
}

}

    jQuery.ajax("cancelimage.php?imagefilename=" + cancel_image_file_name)

    return stopImageUpload(2, cancel_image_file_name);

});       
      return true;
} 
```

我将按钮输入标签更改为取消按钮：

```
<input type='button' name='imageCancel' class='imageCancel __"+ imagefilename + "' value='Cancel' /> 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-05-14T21:43:53.217

尝试以下更改：

在表格上：

```
<input type='button' name='imageCancel' class='imageCancel __"+ imagefilename + "' value='Cancel' /></label></form> 
```

关于取消按钮功能：

```
var cancel_image_file_name_ = $(this).attr('class');
var cancel_image_file_name = '';
var style_array = cancel_image_file_name_.split(" ");
for(i=0;i<style_array.length;i++){
    if(style_array[i].substr(0,2) == "__"){
     cancel_image_file_name = style_array[i].slice(2,style_array[i].length);
}

} 
```

# xml - 未知标识符“DataContractSerializer”

> ID：10588706
> 
> 赞同：0
> 
> 时间：2012-05-14T18:08:04.410
> 
> 标签：xml, serialization, datacontractserializer, networkstream, delphi-prism

我完全糊涂了。我正在按照示例学习使用 DataContractSerializer 类，而我的编译器一直说它不存在。System.Runtime.Serialization 命名空间中不是 DataContractSerializer 吗？或者您是否还必须在项目中包含对命名空间的引用及其使用子句？

这是代码：

```
var theSerial := new DataContractSerializer(typeof(sb)); 
```

sb 是一个记录。

提前致谢，

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-05-14T18:29:16.633

我解决了这个问题。是的，您确实需要添加对 System.Runtime.Serialization 的引用，而不仅仅是在 uses 子句下。

# asp.net-mvc - 嵌套循环中的 Razor CheckboxFor 和 RadioButtonFor

> ID：10588709
> 
> 赞同：1
> 
> 时间：2012-05-14T18:08:56.383
> 
> 标签：asp.net-mvc, razor, nested-loops

这是我的模型

```
public class Settings
{
  public string Label { get; set; }
  public bool Display { get; set; } //controls checkbox
  public bool Default { get; set; } //controls radiobutton
  public int GroupId { get; set; }
} 
```

这是我的控制器

```
public ActionResult LaunchSettings(int portletInstanceId)
{
  List<List<Settings>> listOfGroups;
  return PartialView("Settings", listOfGroups);
} 
```

这是我的看法

```
 @foreach (List<Settings> group in Model)
  {
    foreach(Settings settings in group)
    {
      <ol>
        <li>
          *****ADD CHECKBOX FOR EACH ITEM IN THE LIST*****
        </li>
        <li>
          @Html.DisplayFor(m => settings.Label)
        </li>
        <li>
          *****ADD SET OF RADIO BUTTONS HERE PER GROUP*****
        </li>
      </ol>
    }
  } 
```

内部列表包含根据数据的组 ID 分组的设置。内部列表的列表的外部列表。

如何在“ ***** ”标签之间实现上述视图中描述的每个任务？我在谷歌上搜索并找不到合适的答案。如果我错过了什么，请理解这不是由于缺乏搜索。

编辑这是驱动模型的 xml

```
 <state>
  <searchoptions>
    <searchoption name="Option1" label="Option A" display="true" default="true" group="1"/>
    <searchoption name="Option2" label="Option B" display="true" default="false" group="1"/>
    <searchoption name="Option3" label="Option C" display="false" default="false" group="1"/>
    <searchoption name="Option4" label="Option D" display="false" group="2"/>
    <searchoption name="Option5" label="Option E" display="false" group="3"/>
  </searchoptions>
 </state> 
```

# java - JDOM XPATH 何时比使用 getChildren 进行元素搜索更快？

> ID：10588710
> 
> 赞同：1
> 
> 时间：2012-05-14T18:09:07.287
> 
> 标签：java, jdom, jdom-2

*使用：Java 1.5 / JDom 1.1.3 / Jaxen 1.1.1*

我编写的测试是为了确认在 JDOM 中使用预编译的 XPATH 比遍历子元素更快。相反，我发现 XPATH 比遍历子列表、执行字符串比较和寻找我想要的东西慢 4 到 5 倍。

对于上下文，我的 XPath 类似于：

```
/root/quote/vehicle[@id = 'some vehicle']/coverage[@id = 'some coverage']/code"; 
```

并且实际评估正在计时（在 try/catch 块中）：

```
String element = path.valueOf(doc).getText(); 
```

替代搜索是：

```
List<Element> vehicleList = doc.getRootElement()
                                        .getChild("quote")
                                        .getChildren("vehicle");

for(Element vehElement : vehicleList)
    if(vehElement.getAttributeValue("id").equals("some vehicle")){
        List<Element> coverageList = ele.getChildren("coverage");
        for(Element covElement : coverageList){
            if(covElement.getAttributeValue("id").equals("some coverage")){
                element = covElement.getChild("CoverageType").getText();
                break;
            }
        }
    } 
```

奇怪的是，虽然使用 XPATH 的方法的运行时间要慢得多，但它在 1000 次迭代后最为一致。

第一个示例完成大约 0.29 毫秒 +- 0.01 毫秒。

第二个示例在 0.013 毫秒和 0.002 毫秒之间完成。

给定足够长的测试，两者都接近非常短的运行时间。

XPath 对我来说更容易编写，但是 getChild 路线似乎更灵活但有点冗长。尽管如此，我不介意为了速度而进行交易。确实，即使 100 次迭代也非常快，所以这可能是学术性的......

最后我想知道：

**是否存在 JDOM Xpath 比显示的替代样式更快的情况？**

**JDom XPath（在任何版本的 Java/JDOM 中）带来什么好处？**

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-05-14T18:34:12.527

这里有几件事情需要注意……我在 JDOM 2.0.1 上做了很多工作（我是一名 JDOM 维护者），尤其是在 XPath 评估的性能方面。以下是一些数字：

[http://hunterhacker.github.com/jdom/jdom2/performance.html](http://hunterhacker.github.com/jdom/jdom2/performance.html)

从下往上读。

这里有一些其他有趣的数字（比较不同的 JDOM 版本和不同的 Java VM）

[http://hunterhacker.github.com/jdom/jdom2/performanceJDK.html](http://hunterhacker.github.com/jdom/jdom2/performanceJDK.html)

“底线”……

*   JDOM 2.x 引入了更快的迭代器。Jaxen 是*迭代*器密集型的，JDOM 2.x 中的性能改进在这方面意义重大......
*   Java 7在迭代器性能方面也比以前的版本快得多*。*
*   “编译” Jaxen XPaths 没有任何好处......
*   即使在最好的情况下，“本机”搜索方法也会比 XPath 版本更快。

您最大的性能提升将来自运行 Java7，然后升级到 JDOM 2.x

尽管“自定义”搜索如果编写得好，总是比 XPath 快。

编辑：此外，JDOM 2.x 引入了一个用于运行 XPath 查询的新 API，您可能会发现它更易于使用（尽管旧 API 仍然有效）：[https ://github.com/hunterhacker/jdom/wiki/JDOM2-功能-XPath-升级](https://github.com/hunterhacker/jdom/wiki/JDOM2-Feature-XPath-Upgrade)

# lightbox - Lightbox 2 和 Flickr - 下一个和上一个按钮在哪里？

> ID：10588712
> 
> 赞同：0
> 
> 时间：2012-05-14T18:09:11.607
> 
> 标签：lightbox, flickr, lightbox2

我希望将 lightbox2 画廊系统与 Slick Flickr 的能力集成，以提取包含图像信息的 RSS 提要。到目前为止，我已正确设置和显示灯箱，但无法显示下一个或上一个按钮来循环浏览画廊中的其他图像。

这是当前的html。其余的是默认的 lightbox2 文件。

```
<div class="album-wrapper">  
<?php foreach ($feed->get_items() as $item): ?> 
    <div class="photoContainer">  
        <?php
                    if ($enclosure = $item->get_enclosure()) {
                        $img = image_from_description($item->get_description());
                        $full_url = select_image($img, 4);
                        $thumb_url = select_image($img, 0);
                        echo '<a href="' . $full_url . '" rel="lightbox" ><img class="photo' . $i . '" src="' . $thumb_url . '" /></a>'."\n";
                    }
                ?> 
    </div>  
<?php endforeach; ?> 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-05-18T13:04:08.953

放在`<!doctype html>`代码的第一行将解决问题

# xml - 如何为数据库创建普通的旧 Java 对象（RESTful 服务设计）？

> ID：10588715
> 
> 赞同：2
> 
> 时间：2012-05-14T18:09:18.140
> 
> 标签：xml, jaxb, mapping, javabeans, pojo

我想为给定的数据库生成 POJO、XML。

数据库：（**内容**是表名）

![在此处输入图像描述](../Images/3e3f8f8f04f50652b60cfca36a0955a4.png)

有兴趣了解**POJO**的外观以及对应的**XML**。

例如（xml 看起来像这样）

```
<?xml version="1.0" encoding="UTF-8" ?>
<contents>
  <param1>x</param1>
  <param2>y</param2>
  <param3>2</param3>
</contents> 
```

&对应的POJO

```
public class Contents
{
    @XmlElement
    String param1;

    @XmlElement
    String param2;

    @XmlElement
    String param3;

    public String getparam1()
    {
        return param1;
    }

    public void setParam1( String param1 )
    {
        this.param1 = param1;
    }

    public String getparam2()
    {
        return param2;
    }

    public void setParam2( String param2 )
    {
        this.param2= param2;
    }

    public String getparam3()
    {
        return param3;
    }

    public void setParam3( String param3)
    {
        this.param3= param3;
    }

} 
```

因此，如果我想在我的 XML 中添加多个 ROWS（第 2 行和第 3 行），我的**POJO**和**XML**会是什么样子？

假设（xml应该是）

```
<?xml version="1.0" encoding="UTF-8" ?>
<contents>
 <content>
   <param1>x</param1>
   <param2>y</param2>
   <param3>2</param3>
 </content>
 <content>
   <param1>a</param1>
   <param2>b</param2>
   <param3>1</param3>
 </content>
</contents> 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-06-26T14:25:46.343

我希望这对你有用。

```
@XmlRootElement(name="contents")
public class ContentsWrapper {

    public Collection<Contents> getContents() {
        if (contents == null) {
            contents = new ArrayList<Contents>();
        }
        return contents;
    }

    @XmlElement(name="content")
    private Collection<Contents> contents;
} 
```

# javascript - Sencha Touchs javascript 的通用性如何？

> ID：10588722
> 
> 赞同：0
> 
> 时间：2012-05-14T18:09:45.850
> 
> 标签：javascript, extjs

Sencha Touch 似乎是开发移动应用程序的绝佳方式。我看过人们合并[Jquery](https://stackoverflow.com/questions/5351133/combining-sencha-touch-with-jquery)，[D3](http://wpdojo.net/other-web-development-news/jobs/sencha-touch-html5-d3-js-protovis-125-150k-redwood-city/)的帖子。

同时，描述自定义控件的帖子似乎[相当狭窄](http://robertdougan.com/posts/taking-advantage-of-componentview-in-sencha-touch-2)。[与 ios 在自定义控件](http://cocoacontrols.com/)方面可以做的事情相比，至少在可用示例方面，在
滑块旁边添加小猫的图片并标记滑块似乎有点驯服。大多数博客文章都暗示您可以在 Sencha 或 CSS 文件中扩展控件对象。

这些帖子不是我要找的——那是我的问题。我看不到任何人在 Sencha touch 中更改默认控件的示例，但它们听起来好像可以做任何事情。

这是我的问题：

**Sencha Touch 是否能够构建包含*任何*javascript 库或 HTML5 的 iOS 或 Android 应用程序？这里有什么限制吗？**

举个例子，我尝试实现一个自定义滑块，沿着连续线或像[这样的颜色选择器](http://cocoacontrols.com/platforms/ios/controls/ancolorpicker)的圆圈触摸将输入新值。此外，如果您合并像 protovis 或 D3（或 Raphael 图表）这样的库，Sencha 是否可以显示图形画布元素将显示的任何内容？[它会像 HTML5 图形那样](http://mbostock.github.com/protovis/ex/force.html)采用触摸输入并与图形库交互吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-05-14T18:20:08.187

您提到的帖子不是关于自定义控件，而是关于显示来自绑定商店的列表，而不是仅使用`Ext.XTemplate`（带有 的系统`Ext.view.View`）生成 HTML，而是用于`ComponentView`生成`Ext.Component`s 。

很难说出你在问什么，特别是你想做什么？

要解决您添加的一些问题：

*   Sencha 中的图表是使用 Raphael 实现的，它使用 SVG，因此图表中的所有元素都可以使用 HTML 事件进行交互。

*   Sencha 生成的所有内容都是有效的 HTML，您可以监听 HTML 事件，但组件通常将较低级别的事件抽象为更易于使用的东西，（例如，数据视图抽象了点击，以便它传递被点击的记录事件）。

因此，问题的答案是，**是**的，Sencha 可以与常规 HTML 共存。如果您想要框架的全部好处，您应该始终创建一个`Ext.Component`以便您的组件可以在框架的布局容器中轻松使用。

在尝试编写常规 HTML 并仍将其置于布局渲染管道中时，很容易误用 Ext。`Ext.Component`具有从模板创建 HTML 的内置方法，请参阅[http://docs.sencha.com/touch/2-0/#!/api/Ext.Component-cfg-data](http://docs.sencha.com/touch/2-0/#!/api/Ext.Component-cfg-data)和[http://docs.sencha。 com/touch/2-0/#!/api/Ext.Component-cfg-tpl](http://docs.sencha.com/touch/2-0/#!/api/Ext.Component-cfg-tpl)

# ruby-on-rails-3 - Rails 3 最佳原型 + JQuery 解决方案

> ID：10588729
> 
> 赞同：0
> 
> 时间：2012-05-14T18:10:07.583
> 
> 标签：ruby-on-rails-3, prototypejs, jquery

我有一个网站在 90% 的页面上呈现基于原型的日历。我也在考虑使用 Uploadify 模块来处理使用 Paperclip 进行的多次上传。如您所知，Paperclip 和 JQuery 不能很好地发挥作用，而且我尝试过的许多解决方案（例如 NoConflict）都对我不起作用，我仍然在整个地方的 firebug 中遇到“未定义”错误。我想知道添加这个 JQuery 模块的最佳方法是什么，该模块将在很大程度上基于原型的应用程序中非常本地化。我考虑过用 JQuery 切换我的原型代码，但我还没有看到针对我正在使用的这个特定日历插件的更好的 JQuery 解决方案。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-05-14T18:15:01.997

为 noConflict 使用适当的结构。

```
<script src="prototype.js"></script>
<script src="someprototypeplugin.js"></script>
<script src="jQuery.js"></script>
<script src="uploadify.jquery.js"></script>
<script>
$.noConflict();
jQuery(document).ready(function($){
    $("#someelement").uploadify();
});
</script> 
```

如果这不能回答您的问题，请提供更多（一些）代码。

编辑评论：

只需在`$.noConflict()`您的 jQuery 插件之后立即运行，然后在整个 JS 文件中使用`jQuery`而不是变量。`$`

```
<script src="prototype.js"></script>
<script src="someprototypeplugin.js"></script>
<script src="jQuery.js"></script>
<script src="uploadify.jquery.js"></script>
<script>
    $.noConflict();
</script> 
```

示例 js 文件：

```
(function($){
    // since we passed a reference to jQuery to this anonymous
    // function and accepted it as a parameter named "$", we can
    // safely use "$"
    $("#target").uploadify();
})(jQuery); 
```

如果您需要准备好文档，您可以这样做：

```
jQuery(document).ready(function($) {
    $("#target").uploadify();
}); 
```

# python - 为什么同一个文件与 textarea 和文件输入不同？

> ID：10588730
> 
> 赞同：0
> 
> 时间：2012-05-14T18:10:10.013
> 
> 标签：python, bottle

我正在尝试制作一个网络表单，您可以在其中将输入作为文件提供或将其粘贴到 textarea 中。但是，当相同的数据到达瓶中时，情况就不同了。当来自文件输入时，来自文本区域的数据长度更大。为什么会发生这种情况？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-05-14T18:14:38.070

我怀疑在文本区域中插入的格式化字符（例如换行符和回车符）可能是问题所在。你检查过这个吗？

# c++ - 在 Visual C++ 项目中添加文件夹

> ID：10588734
> 
> 赞同：6
> 
> 时间：2012-05-14T18:10:43.873
> 
> 标签：c++, windows, visual-studio, visual-c++

如何在 Visual C++ 项目中添加整个文件夹及其子目录？我正在使用 Visual Studio 2010 Professional。我的意思是您可以使用添加文件，`Add Existing Item`但是如何添加整个目录？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2012-05-15T21:47:56.687

我所知道的最快的方法是

*   **使用Windows**资源管理器将文件夹添加到项目文件目录
*   **在解决方案**资源管理器中找到文件夹（确保选中显示所有文件）
*   右键单击该文件夹并选择包含在项目中

您可能必须分别处理文件夹和文件，但您可以一次选择多个文件。

# ios - 分组 UITableView 自定义绘制单元格，而不更改背景颜色？

> ID：10588735
> 
> 赞同：0
> 
> 时间：2012-05-14T18:10:45.637
> 
> 标签：ios, uitableview

我在分组单元格中自定义绘制表格单元格。如何获得正确的背景颜色？

我实际上在单元格内有一个视图，并且正在自定义如何在其`drawRect:`. 我试过这个：

```
- (void)drawRect:(CGRect)rect
{
    BOOL isHighlighted = self.highlighted;
    CGRect frame = self.bounds;

    CGContextRef c = UIGraphicsGetCurrentContext();

    if ( !isHighlighted ) {
        [[UIColor whiteColor] set];
        CGContextFillRect( c, frame );
    }

    // rest of drawing
} 
```

这适用于普通表视图，但它不匹配分组表视图。它看起来像大约 96% 的灰色。

它看起来像这样：

![白盒](../Images/e6c4cbee1689d262f8ba45689e11cf94.png)

如果您的屏幕没有很好地校准，您可能看不到差异。但它就在那里。

当我尝试这个时：

```
 if ( !isHighlighted ) {
        //[[UIColor whiteColor] set];
        //CGContextFillRect( c, frame );
    } 
```

相反，我得到了黑色背景，如下所示：

![黑盒子](../Images/2d1c719fb48bad6a0abbcd23ae27e07b.png)

我的假设是我需要在我的绘制例程中填充每个像素。

当我尝试这个时：

```
 if ( !isHighlighted ) {
        [[self backgroundColor] set];
        CGContextFillRect( c, frame );
    } 
```

我也得到黑色背景。我认为`backgroundColor`我的观点是`transparentColor`。

我也试过这个：

```
 if ( !isHighlighted ) {
        CGContextFillRect( c, frame );
    } 
```

同一个黑匣子。

如何匹配分组表视图的背景颜色，而不使用吸管并将 a 硬编码`[UIColor colorWithWhite: alpha:]`到我的应用程序中？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-05-14T18:19:40.337

获取其超级视图的背景颜色

```
UIColor * background = [self.superview backgroundColor]; 
```

我认为`[super drawRect:rect];`在您的自定义绘制矩形顶部调用将解决此问题

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-05-14T18:20:25.683

你有没有尝试过？

```
 [[UIColor clearColor] set]; 
```

# actionscript-3 - 获取文本选择 AS3 的长度

> ID：10588738
> 
> 赞同：0
> 
> 时间：2012-05-14T18:10:54.480
> 
> 标签：actionscript-3

如何获得所选输入文本的长度数？

就像，如果文本选择了 2 个字符，那么它会返回长度为 2。

那可能吗？

谢谢。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2012-05-14T18:21:32.883

使用 textfield.selectionBeginIndex 和 textfield.selectionEndIndex 计算当前选择的字符数。

```
var selected:int = field.selectionEndIndex - field.selectionBeginIndex; 
```

[http://help.adobe.com/en_US/FlashPlatform/reference/actionscript/3/flash/text/TextField.html#selectionBeginIndex](http://help.adobe.com/en_US/FlashPlatform/reference/actionscript/3/flash/text/TextField.html#selectionBeginIndex)

# android - Android BroadcastReceiver Lifecycle：动态注册接收器的文档错误？

> ID：10588743
> 
> 赞同：1
> 
> 时间：2012-05-14T18:11:03.420
> 
> 标签：android, memory-leaks, garbage-collection, broadcastreceiver, android-manifest

我定义了一个`BatteryInfo extends BroadcastReceiver`类。我在我的`Activity onCreate()`. 我`Activity.registerReceiver`在我的`onCreate()`.

我试图弄清楚我是否需​​要注销它和/或设置它的引用以`null`允许我的 Activity 死掉而不会泄漏内存或阻塞系统中的意图发送者，或者系统是否优雅地抛出与此相关的所有内容它自己的。为此，我正在思考我读到 的[BroadcastReceiver 生命周期：](http://developer.android.com/reference/android/content/BroadcastReceiver.html#ReceiverLifecycle)

> BroadcastReceiver 对象仅在调用 onReceive(Context, Intent) 期间有效。一旦您的代码从此函数返回，系统就会认为该对象已完成且不再处于活动状态。”

这是什么意思？显然，我创建`new BatteryInfo()`和注册的对象在`registerReceiver()`我的活动持续的整个过程中都会持续存在。我记录了它的结果并一直看到它们。显然它在第一次`onReceive()`被调用后并没有失效。

我想知道这部分文档是否可能仅适用`BroadcastReceivers`于在`AndroidManifest`? `BroadcastReceivers`并且动态创建和注册 是完全不正确或无关的吗？

当然，我想知道什么是我的动态接收器的正确清理和干扰。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-05-14T18:25:46.593

您在代码中需要做的`BroadcastReceivers`就是注册和注销它们。该声明是通知您不能在 之外执行任何工作`onReceive`，例如在另一个线程中，并将值返回给`BroadcastReceiver`. 为此，您将获得`BroadcastReceiver`启动一个`Service`.

# oracle-apex - APEX 3.2：将 HTML 区域嵌入 HTML 区域

> ID：10588744
> 
> 赞同：1
> 
> 时间：2012-05-14T18:11:07.223
> 
> 标签：oracle-apex

我找到了以下 javascript 示例，用于在一个会话中上传多个文件： [Upload multiple files with a single file element](http://the-stickman.com/web-development/javascript/upload-multiple-files-with-a-single-file-element/)

我的问题是，在我的 APEX 3.2 页面中，我目前有一个如下所示的区域： ![在此处输入图像描述](../Images/99cfc38005eff02a20911b815d82880c.png)

我想取出默认的“文件浏览”并将多文件上传部分放在它的位置。

![在此处输入图像描述](../Images/dc01926799beb8c18efe2e36e547aec4.png)

有没有办法把一个区域放在一个区域内？如果没有，如何在区域内添加 HTML 项目？

这是我在第二个屏幕截图（html 区域）中的代码：

```
<form enctype="multipart/form-data" action="your_script_here.script" method = "post">
    <input id="my_file_element" type="file" name="file_1" >
    <input type="submit">
Files:
<div id="files_list"></div>
<script> 
    var multi_selector = new MultiSelector( document.getElementById( 'files_list' ), 3 );
    multi_selector.addElement( document.getElementById( 'my_file_element' ) );
</script>
</form> 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-05-15T09:06:10.473

您可以创建一个“显示为文本”项目并将您的 HTML 代码设置为源代码。确保该项目未设置为转义 HTML，否则您只会看到 HTML 而不是控件。结果是这样的（我有一个文本项“请求标题”，后跟基于您的 HTML 的显示项： ![在此处输入图像描述](../Images/6db26f18400f1a8d807aaf14ae37f370.png)

# c++ - C++ 中的“<<”运算符是什么？

> ID：10588748
> 
> 赞同：-6
> 
> 时间：2012-05-14T18:11:22.903
> 
> 标签：c++, operators

我无法理解以下代码中的运算符“<<”是什么意思。

```
 long hashString(char* key)
 {
   int n = strlen(key);
   long h = 0;
   for(int i=0; i<n; i++)
     {
        h = (h << 2) + key[i];
     }
  return abs(h % tablesize);
 } 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-05-14T18:13:34.000

它是左移运算符。它将值左移 2 位，有效地将其乘以 2 的 2 次方（移位量）。

```
a << b 
```

是相同的：

```
a * (2 to the power of b) 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-05-14T18:12:56.010

它是一个[位移运算符](http://msdn.microsoft.com/en-us/library/336xbhcz.aspx)（在这个上下文中是一个`long`变量）。

它将所有位移动 2 位，结果乘以 4（就像您将在基数为 10 的数字中添加两个数字以乘以 100。概括地说，移动*n*位将使数字乘以`2^n`）。例如：

```
unsigned int x = 0xA;     // x = 1010  (10 base 10)
unsigned int y = x << 1;  // y = 10100 (20 base 10) 
```

您可以通过将位向右移动来执行除以二（即，从末尾切掉一个）

```
unsigned int x = 0xA;     // x = 1010  (10 base 10)
unsigned int y = x >> 1;  // y =  101  (5 base 10) 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-05-14T18:13:32.647

它是 C++ 中的位移运算符。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-05-14T18:16:35.367

这是一个`bitwise shift left`运算符，这意味着您`h`在左移两位时分配值，有效地乘以`h`2 到 2 的幂：

```
h << 2 == h * (2 ^ 2) 
```

[您可以在此处](http://en.wikipedia.org/wiki/Bitwise_operation#Shifts_in_C.2C_C.2B.2B.2C_C.23)找到有关它的更多信息。

提示：下次先搜索[http://www.google.com](http://www.google.com)。

# ruby-on-rails - 未初始化的常量 ActionView::CompiledTemplates::Category

> ID：10588749
> 
> 赞同：10
> 
> 时间：2012-05-14T18:11:38.797
> 
> 标签：ruby-on-rails, ruby-on-rails-3.1

使用本教程

[http://railscasts.com/episodes/57-create-model-through-text-field](http://railscasts.com/episodes/57-create-model-through-text-field)

需要让它在我的应用程序中运行，在 rails 3.0.7 上运行良好，将其更新到 3.1.3，我现在收到此错误

```
uninitialized constant ActionView::CompiledTemplates::Category 
```

我会花更多时间寻找答案，但现在我的时间真的很短。我已经查看了与此问题相关的大部分谷歌结果，但没有任何好处。请需要帮助。

**形式**

```
<%= f.collection_select :category_id, Category.find(:all), :id, :name, :prompt => "Select a Category" %>
or create one:
<%= f.text_field :new_category_name %> 
```

**模型**

```
class Tvstation < ActiveRecord::Base
  belongs_to :category
  attr_accessor :new_category_name
  before_save :create_category_from_name

  def create_category_from_name
    create_category(:name => new_category_name) unless new_category_name.blank?
  end
end 
```

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2012-05-14T18:22:19.027

好的，只是为了其他人，如果他们会像我一样陷入这种愚蠢的事情，别忘了在 app/models 中有 category.rb ..

```
class Category < ActiveRecord::Base
  ...
end 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2015-09-30T13:33:18.133

对我来说，我在视图中遇到了类似的问题。我的类别模型在命名空间示例中可用

```
模块金融
  类别 类别
  结尾
结尾

```

当我简单地调用 Category.get_method 时。它给出了同样的错误。所以我修改为解决我的问题的**Financial::Category**。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2018-02-06T06:17:59.200

我正在使用 PORO，但它没有加载，给了我这个错误。这是因为我更改了类名而没有更改文件名。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2018-07-26T18:50:52.510

其他人如何建议我解决了类似的问题，即修复错误的型号名称。

# wpf - WPF DatagridCell 事件触发器

> ID：10588750
> 
> 赞同：0
> 
> 时间：2012-05-14T18:11:48.267
> 
> 标签：wpf, xaml, datagrid, eventtrigger, datagridcell

我想获取 Datagrid Cell 的事件触发器。我的意思是说我想写这样的东西

```
**<EventTrigger EventName="MouseEnter">** 
```

然后从 XAML 调用函数 this：

**void Cell_MouseEnter（对象发送者，MouseEventArgs e）**

我该怎么做：

我在 XAML 中有这个

```
 <ctrls:RhinoDataGrid x:Name="dataGrid" Grid.Row="1" Margin="5" ItemsSource="{Binding Model.CurrentDataTable}"   
                             Style="{StaticResource RhinoDataGridBaseStyle}" IsReadOnly="{Binding Model.IsLinkFile}"
                             SelectedValue="{Binding Model.CurrentDataRow}" SelectedValuePath="Row"                                 SetAutomappingOnOff="{Binding IsAutoMap, Mode=TwoWay}" >
            </ctrls:RhinoDataGrid>

     <Style TargetType="{x:Type DataGridCell}">
            <Setter Property="BorderBrush" Value="Transparent"></Setter>
            <Setter Property="BorderThickness" Value="2"></Setter>
            <Style.Triggers>
                <Trigger Property="IsSelected" Value="True">
                    <Setter Property="Foreground" Value="White"></Setter>
                    <Setter Property="BorderBrush" Value="{DynamicResource ActiveItemBrush}"></Setter>
                    <Setter Property="BorderThickness" Value="2"></Setter>
                </Trigger>
            </Style.Triggers> 
```

请帮忙

谢谢迪

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-05-15T08:45:27.473

`EventSetter`你很困惑`EventTrigger`......

```
 <Style TargetType="{x:Type DataGridCell}"> 
       <EventSetter Event="MouseEnter" Handler="Cell_MouseEnter"/>
  </Style> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-05-14T18:40:11.873

改为检查“ **IsMouseOver** ”。我假设“ **RhinoDataGrid** ”继承自我们已知的 WPF 的 DataGrid。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-05-14T19:09:26.350

```
<Style TargetType="{x:Type DataGridCell}">
    <Setter Property="Template">
        <Setter.Value>
            <ControlTemplate TargetType="{x:Type DataGridCell}">
              <Grid Mouse.MouseEnter="Cell_MouseEnter" Background="{TemplateBinding Background}">       
                 <ContentPresenter/>
              </Grid>
            </ControlTemplate>
        </Setter.Value>
    </Setter>
</Style> 
```

# iso - ISO 9660 标准和关于卷日期的位

> ID：10588751
> 
> 赞同：1
> 
> 时间：2012-05-14T18:11:51.750
> 
> 标签：iso, dvd, iso9660

一段时间以来，我想知道并通过 Internet 搜索有关写入 DVD 或 CD 光盘上的 iso 文件的答案（据我所知，ISO 9660 标准）。

我发现这篇论文[http://www.cs.cmu.edu/~varun/cs315p/iso9660.pdf](http://www.cs.cmu.edu/~varun/cs315p/iso9660.pdf)关于这个标准。在第 45 页，有一个表格描述了在哪个位上设置了什么。有两行对我来说非常有趣：Volume Creation Date and Time 和 Volume Experiation Date and Time。如果我做对了，有可能我可以制作在到期日期之后无法运行的 CD，或者是其他原因。

你们中的任何人都曾经使用过这些位吗？我在这篇论文中寻找不同的东西，但它很有趣，我想深入研究这个话题，所以也许你也有任何关于它的额外材料。

感谢您提前回答。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-05-22T21:49:11.007

据我所知，这可能与备份媒体和备份解决方案有关，以了解备份数据何时过期。并且存档槽现在可以重新使用，或者从它不能被使用的时候开始，因为备份已经过了它的到期日期。

这对于其他备份媒体（如磁带备份）来说很常见。各种软件解决方案需要指定到期日期，以了解何时重用磁带以及何时根据解决方案自身的实施生成警告和警报。

我相信这是一个兼容性领域，允许大型系统能够用 iso9660 映像（CD 等）替换旧系统。

我认为目前消费者使用的大多数软件实际上并未强制执行此操作。

即使在过去，使用备份媒体的软件也会有一个覆盖参数，以确保过期的卷/档案实际上可以被强制手动覆盖使用。

希望这可以帮助。

# yui - YUI 浏览器历史管理器返回按钮

> ID：10588752
> 
> 赞同：1
> 
> 时间：2012-05-14T18:12:01.597
> 
> 标签：yui, browser-history

我正在使用 YUI 浏览器历史管理器来跟踪 Ajax 导航。我正在注册历史对象，例如：

```
YAHOO.util.History.register("state",init, onStateChange); 
```

当我这样做时，这里会调用 onStateChange

```
YAHOO.util.History.navigate("state",urlhash); 
```

当我按下后退按钮时。

有没有办法知道 onStateChange 是在后退按钮上调用还是通过调用导航？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-05-14T18:27:36.027

如果此事件有时可以由外部系统调用（在本例中为浏览器后退按钮）并且有时由您自己的代码调用，您可以通过在您自己的代码调用该方法时要求执行一些特殊操作来区分调用者。在您自己的辅助方法中包装对 navigate() 的调用可以帮助确保您对此保持一致。

在 YUI 文档中，我看到 register() 可以采用可选的第四个参数（以及其他参数），该参数是一个任意对象，它将被传递到您的 onStateChange 处理程序函数中。此对象的属性之一可能是一个标志，表明它是从您的代码调用而不是由浏览器启动，并且在您的 navigate() 包装器中始终设置该标志。请记住将其设置回您的处理程序中。

注意：我对 YUI 不像 ExtJS 那样熟悉，也许一些更了解 API 的大师可以提供帮助，但这是一个可行的通用策略。这个答案做了一个不优雅的假设，即调用 navigate() 将使该处理程序在任何其他导航有机会发生之前可靠地触发，这在单线程 javascript 世界中可能是一个安全的赌注。

# actionscript - 如何让 Automator 以递归方式选择文件列表？

> ID：10588754
> 
> 赞同：0
> 
> 时间：2012-05-14T18:12:05.070
> 
> 标签：actionscript, automator

我正在开发一个需要在 Photoshop 中打开一系列文件并将它们定义为模式的 Automator（不，Photoshop Actions 不会按照我需要的方式进行操作。）我的 automator 应用程序正在运行，但是它不会递归地遍历文件，而是仅对第一个文件运行操作。

是否有一个简单的 actionScript 可以插入到动作中以递归运行？或者有没有办法使用循环动作并选择第一个文件，然后让 Automator 依次选择下一个文件？

目前，我的操作顺序如下：

*   打开 Finder 项目：在 Photoshop 中
*   Watch Me Do：在 PShop 中选择正确的菜单项并单击 OK
*   关闭文件

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-05-14T22:34:53.053

它不是递归的，但您可以使用[http://automator.us/leopard/downloads/中的](http://automator.us/leopard/downloads/)**Dispense Items Incrementally**操作- 它与**Loop**操作一起使用，一次单步执行一个文件。

# asp.net-mvc-routing - 在 ApiController 上获取单个并获取所有方法

> ID：10588756
> 
> 赞同：0
> 
> 时间：2012-05-14T18:12:10.700
> 
> 标签：asp.net-mvc-routing, asp.net-web-api

我正在使用接近 aspnetwebstack Codeplex 项目的最新位（如果有人感兴趣，2012-05-09 的 4592e2f63c55）开发一个 API。

我有以下路线：

```
context.Routes.MapHttpRoute("SiteSpecific", "Api/{controller}/{customerId}/{siteToken}/{id}",
                new { id = UrlParameter.Optional }); 
```

而我目前正在尝试做的是实现 get single 和 get all in an `ApiController`. 用于测试的 Get all 方法如下：

```
public IEnumerable<EditChatResponse> Get(string customerId, string siteToken)
{
    return new []{new EditChatResponse{Template = "Get All"}, };
} 
```

而get单曲目前如下：

```
public EditChatResponse Get(string customerId, string siteToken, string id)
{
    return new EditChatResponse {Template = "Get Single"};
} 
```

但是，路由总是选择 Get single 方法：

```
$ curl -i -H "Accept: applicaiton/json" http://localhost/api/chatresponse/a/b
HTTP/1.1 200 OK
Cache-Control: no-cache
Pragma: no-cache
Content-Type: application/json; charset=utf-8
Expires: -1
Server: Microsoft-IIS/7.5
X-AspNet-Version: 4.0.30319
X-Powered-By: ASP.NET
Date: Mon, 14 May 2012 18:06:26 GMT
Content-Length: 66

{"Id":0,"Template":"Get Single","Inherited":false,"Enabled":false}

$ curl -i -H "Accept: applicaiton/json" http://localhost/api/chatresponse/a/b/c
HTTP/1.1 200 OK
Cache-Control: no-cache
Pragma: no-cache
Content-Type: application/json; charset=utf-8
Expires: -1
Server: Microsoft-IIS/7.5
X-AspNet-Version: 4.0.30319
X-Powered-By: ASP.NET
Date: Mon, 14 May 2012 18:06:28 GMT
Content-Length: 66

{"Id":0,"Template":"Get Single","Inherited":false,"Enabled":false} 
```

我尝试将 Get all 方法重命名为`GetAll`，正如我在一些示例中看到的那样，用 来装饰它`[HttpGet]`，但它仍然选择单一方法。

我是否完全遗漏了某些东西，或者我需要以不同的方式解决这个问题（我看到的大多数示例看起来都与 beta 位相关，而不是 CodePlex 的最新版本）？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-05-14T18:31:38.123

尝试将其用于默认 id 参数：

> 新 { id = System.Web.Http.RouteParameter.Optional }

# php - PHP 监禁任意代码

> ID：10588757
> 
> 赞同：6
> 
> 时间：2012-05-14T18:12:11.070
> 
> 标签：php, security, jail

我们有一个 Java IRC 应用程序，允许用户执行任意 PHP 并获得结果。以下是其用途的一个示例：

```
btc: <php>$btc = json_decode(file_get_contents('https://btc-e.com/api/2/1/ticker'), true); $ticker = $btc['ticker']; echo "Current BTC Ticker: High: $".$ticker['high']." Low: $".$ticker['low']." Average: $" . $ticker['avg']; 
```

我们也有一个 python 设置，但我们喜欢 PHP，因为 PHP 在任何地方的代码中都不需要换行符。（因为这是 IRC，我们不能给它换行，除非我们执行一个 web 加载的 .py 文件）

问题是如何防止人们试图利用该系统，例如：

```
<php>echo readfile("/etc/passwd"); 
```

很明显，它会读出 passwd 文件供所有人查看。
在我们尝试阻止 readfile() 之后，我们也遇到了这个问题：

```
<php>$rf = readfile; echo $rf("/etc/passwd"); 
```

我们应该如何保护这个系统？（完整代码在 github 上，有兴趣的可以访问：[https](https://github.com/clone1018/Shocky) ://github.com/clone1018/Shocky ）

顺便说一句，没有真正的敏感信息被暴露，因为整个事情都在虚拟机中，所以它不是“定时炸弹”或任何东西。不过，我们仍然想锁定它。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2012-05-14T18:21:37.633

这听起来像是在滤锅上堵了一个洞。文件系统安全应该由操作系统而不是应用程序来处理。就目前`/etc/passwd`而言，操作系统已经在保护它。

这是我的第一行`/etc/passwd`- 是的，我将公开发布：

```
root:x:0:0:root:/root:/bin/bash 
```

通常，密码实际上并不存储在`/etc/passwd`. 用户信息是，但密码被替换为`x`，真正的密码仅对 root 用户可用。

但是，您应该在某种程度上锁定 PHP。您可以在运行时更改许多 PHP 选项`ini_set`，包括`open_basedir`. [http://www.php.net/manual/en/ini.core.php#ini.open-basedir](http://www.php.net/manual/en/ini.core.php#ini.open-basedir)

* * *

## 回答 #2

> 赞同：-4
> 
> 时间：2012-05-14T18:32:27.917

如果您只想限制文件读取，也许这可以帮助 [http://www.php.net/manual/en/ini.core.php#ini.open-basedir](http://www.php.net/manual/en/ini.core.php#ini.open-basedir)

如果您使用的是旧版本的 php < 5.4 可以考虑使用 php 安全模式

[http://php.net/manual/en/ini.sect.safe-mode.php](http://php.net/manual/en/ini.sect.safe-mode.php)

将以下变量设置为安全模式以限制 php

```
safe_mode_exec_dir
disable_functions = readfile,system 
```

和许多其他

此外，用户将无法读取任何 uid 不同的文件，例如 /etc/password。请注意，安全模式已从最新版本的 php 中折旧/删除

# jquery - Http 401 在 AppHarbor 上使用 jquery 查询 RavenDB

> ID：10588761
> 
> 赞同：2
> 
> 时间：2012-05-14T18:12:31.883
> 
> 标签：jquery, ravendb, appharbor

我在 AppHarbor 中使用 RavenDB 来使用 jQuery 查询索引。我得到一个未经授权的 Http 401。如果我使用本地连接字符串，一切正常，我想我需要设置 RavenDB 以接受指向我在 Appharbor 的数据库的请求。我用于查询的 jquery 如下所示（queryUrl 有效）：

```
 function search(queryUrl) {            
        $.ajax({
            url: queryUrl,
            dataType: 'jsonp',
            jsonp: 'jsonp',                              
            success: function (data) {
                $("#companiesHolder").empty();                    

                $.each(data.Results, function() {
                    $("#companiesHolder").append("<li><hgroup class='title'><h2>" + this.Name + "</h2><h5>" + this.Email + "</h5></hgroup></li>");
                });                                           
            },
            error: function (error, stat, message) {
                alert(stat + ":" + message);
            }
        }); 
```

我在浏览器中得到的错误是：

> 解析器错误：jQuery162024808977324209974_1337018748684 未被调用

如何在 AppHarbor 中配置 RavenDB 以允许我的请求？或者我应该用 jQuery 随请求一起发送一些东西吗？（也许我应该发送在 documentStore 中设置的 ApiKey？）如果对于某些查询我需要授权，但对于其他我不需要，我应该如何处理呢？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2012-05-15T03:25:37.717

我不会从 jQuery 直接连接到您的 RavenDB 实例。您需要传递您的 API 密钥，然后将其暴露在您的公共 javascript 文件中以供任何人连接。

在您的应用程序中创建一个 API 端点并点击它，让它运行查询并为您返回结果。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-05-14T20:07:56.913

您肯定需要发送身份验证，特别是[此处描述](http://support.appharbor.com/kb/add-ons/using-ravendb-and-ravenhq)的 API 密钥。我不熟悉 RavenDB 用于身份验证的方案，但您可以查看[源代码](https://github.com/ravendb/ravendb)。

但是，在您的公共 javascript 文件中包含您的 API 密钥是一个坏主意。

# java - Android Json 和空值

> ID：10588763
> 
> 赞同：98
> 
> 时间：2012-05-14T18:12:43.007
> 
> 标签：java, android, json

如何检测 json 值何时为空？例如：**[{"username":null},{"username":"null"}]**

第一种情况表示不存在的用户名，第二种情况表示名为“null”的用户。但是，如果您尝试检索它们，这两个值都会导致字符串“null”

```
JSONObject json = new JSONObject("{\"hello\":null}");
json.put("bye", JSONObject.NULL);
Log.e("LOG", json.toString());
Log.e("LOG", "hello="+json.getString("hello") + " is null? "
                + (json.getString("hello") == null));
Log.e("LOG", "bye="+json.getString("bye") + " is null? "
                + (json.getString("bye") == null)); 
```

日志输出是

```
{"hello":"null","bye":null}
hello=null is null? false
bye=null is null? false 
```

* * *

## 回答 #1

> 赞同：225
> 
> 时间：2012-05-14T18:15:53.820

尝试使用`json.isNull( "field-name" )`.

参考：http: [//developer.android.com/reference/org/json/JSONObject.html#isNull%28java.lang.String%29](http://developer.android.com/reference/org/json/JSONObject.html#isNull%28java.lang.String%29)

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2012-05-14T18:16:38.907

因为如果给定键存在，则 JSONObject#getString 返回一个值，因此根据定义它不为空。这就是 JSONObject.NULL 存在的原因：表示一个空 JSON 值。

```
json.getString("hello").equals(JSONObject.NULL); // should be false
json.getString("bye").equals(JSONObject.NULL); // should be true 
```

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2013-03-11T08:36:02.657

对于 android，如果不存在这样的映射，它将引发 JSONException。所以不能直接调用这个方法。

```
json.getString("bye") 
```

如果您的数据可以为空（可能不存在密钥），请尝试

```
json.optString("bye","callback string"); 
```

或者

```
json.optString("bye"); 
```

反而。

在您的演示代码中，

```
JSONObject json = new JSONObject("{\"hello\":null}");
json.getString("hello"); 
```

你得到的是字符串“null”而不是null。

你应该使用

```
if(json.isNull("hello")) {
    helloStr = null;
} else {
    helloStr = json.getString("hello");
} 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2012-05-14T18:16:09.913

首先检查`isNull()`......如果不能工作，然后尝试以下

而且您还`JSONObject.NULL`必须检查空值...

```
 if ((resultObject.has("username")
    && null != resultObject.getString("username")
    && resultObject.getString("username").trim().length() != 0)
      {
               //not null
        } 
```

在你的情况下还要检查`resultObject.getString("username").trim().eqauls("null")`

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2013-03-07T10:10:53.417

如果您必须先解析 json 并稍后处理对象，请试试这个

解析器

```
Object data = json.get("username"); 
```

处理程序

```
if (data instanceof Integer || data instanceof Double || data instanceof Long) {
     // handle number ;
} else if (data instanceof String) {
     // hanle string;               
} else if (data == JSONObject.NULL) {
     // hanle null;                 
} 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2015-07-30T00:46:54.197

这是我使用的一种辅助方法，因此我只需一行代码即可获取 JSON 字符串：

```
public String getJsonString(JSONObject jso, String field) {
    if(jso.isNull(field))
        return null;
    else
        try {
            return jso.getString(field);
        }
        catch(Exception ex) {
            LogHelper.e("model", "Error parsing value");
            return null;
        }
} 
```

然后是这样的：

```
String mFirstName = getJsonString(jsonObject, "first_name"); 
```

会给你你的字符串值或安全地将你的字符串变量设置为空。我尽可能使用 Gson 来避免这样的陷阱。在我看来，它可以更好地处理空值。

# java - Java + Sockets + Timer = 程序挂起

> ID：10588771
> 
> 赞同：-1
> 
> 时间：2012-05-14T18:14:02.270
> 
> 标签：java, sockets, timer

> **可能重复：**
> [java 计时器和套接字问题](https://stackoverflow.com/questions/2673045/java-timer-and-socket-problem)

所以这里是代码。我想要做的 - 是与服务器的客户端循环，以从服务器获取消息，有时会发送它们。这是尝试使用计时器。

```
private MessageFrame mf;
private User us;
private Contact cn;

private Socket s;
private PrintStream ps;
private BufferedReader br;

private Timer timer ;

public MessageFrameListener(MessageFrame m_f, User u_s, Contact c_n){
    timer = new Timer(500,new timerListener());
    mf = m_f;
    us = u_s;
    cn = c_n;
    m_f.addButtonListener(new SButtonListener());
    m_f.addWinListener(new FrameListener());

}

public void init(){
    try {
        s = new Socket(InetAddress.getLocalHost(), 8072);
        ps = new PrintStream(s.getOutputStream());
        br = new BufferedReader(    new InputStreamReader(s.getInputStream()));
    } catch (UnknownHostException e) {
        // TODO Auto-generated catch block
        e.printStackTrace();
    } catch (IOException e) {
        // TODO Auto-generated catch block
        e.printStackTrace();
    }

    timer.start();      

}

public class timerListener implements ActionListener{
    public void actionPerformed(ActionEvent e) {
            //String insert = mf.getInput();

                String result;
                try {
                    //проверить, что буфер не пуст
                    if((result = br.readLine()) != null){

                    String[] results = result.split(" ");
                    if("m".equals(results[0])){
                        if("-1".equals(results[2]))
                            mf.addLine2("Error");
                        else{
                            mf.addLine2(results[3]);
                        }
                    }
                    }

                } catch (IOException e1) {
                    // TODO Auto-generated catch block
                    e1.printStackTrace();
                }

    }
} 
```

但是当我运行它时 - 程序停止对我的行为做出反应。我不能写文字，也不能按一个按钮。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-05-14T18:37:12.763

对 BufferedReader 的读取调用是阻塞的，最好在一个单独的线程中运行它们，最好是一个 swing worker。您的`readLine()`调用导致主事件线程挂起，这意味着没有其他事件正在传播。

要确认这一点，请中断 TimerActionListener 并调查正在运行的线程堆栈或只是 SIGQUIT 和线程转储。应该很清楚 read 调用导致阻塞的线程。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-05-14T18:43:29.840

我相信您的 br.readline() 调用会阻塞，直到您从 InputStream 获取数据。如果没有任何东西通过套接字读取，则代码将挂在那里。

您可能希望在此处查看线​​程：[Java 中的异步 IO？](https://stackoverflow.com/questions/592303/asynchronous-io-in-java)

# jsf - 我如何在不调用的情况下调用 setter 转换器？

> ID：10588773
> 
> 赞同：1
> 
> 时间：2012-05-14T18:14:17.670
> 
> 标签：jsf, jsf-2, primefaces

我正在使用 jsf 2.1.1 和 primefaces 3.0.M4。我有一个用于发布国家/地区评论的示例 jsf 页面。我使用带有转换器的 f:viewparam 标签来查看国家页面。以下是代码：

国家.xhtml：

```
<f:metadata>
        <f:viewParam name="country" value="#{countryBean2.selectedCountry}" converter="countryConverter" required="true"/>
    </f:metadata>

    <h:head>
        <title>Country</title>
    </h:head>

    <h:body>
        <h:form id="form">
            <h:outputText value="#{countryBean2.selectedCountry.countryName}" />
            <br/><br/>
            <h:outputText value="Comment:" />
            <h:inputText value="#{countryBean2.comment}" />
            <br/>
            <p:commandButton value="Send" action="#{countryBean2.sendComment}" update="@this" />
        </h:form>
    </h:body> 
```

CountryBean2.java：

```
@Named("countryBean2")
@SessionScoped
public class CountryBean2 implements Serializable {
    private EntityCountry selectedCountry;
    private String comment;

    public EntityCountry getSelectedCountry() { return selectedCountry; }
    public void setSelectedCountry(EntityCountry newValue) { selectedCountry = newValue; }

    public String getComment() { return comment; }
    public void setComment(String newValue) { comment = newValue; }

    EntityManagerFactory emf = Persistence.createEntityManagerFactory("testPU");

    public void sendComment() {
        EntityManager em = emf.createEntityManager();
        try {
            FacesMessage msg = null;
            EntityTransaction entr = em.getTransaction();
            boolean committed = false;
            entr.begin();
            try {
                EntityCountryComment c = new EntityCountryComment();
                c.setCountry(selectedCountry);
                c.setComment(comment);
                em.persist(c);
                committed = true;
                msg = new FacesMessage();
                msg.setSeverity(FacesMessage.SEVERITY_INFO);
                msg.setSummary("Comment was sended");
            } finally {
                if (!committed) entr.rollback();
            }
        } finally {
            em.close();
        }
    }
} 
```

CountryConverter.java：

```
public class CountryConverter implements Converter {
    public static EntityCountry country = new EntityCountry();

    EntityManagerFactory emf = Persistence.createEntityManagerFactory("testPU");

    @Override
    public EntityCountry getAsObject(FacesContext context, UIComponent component, String value) {
        EntityManager em = emf.createEntityManager();
        Query query = em.createQuery("SELECT c FROM EntityCountry c WHERE c.countryName = :countryName")
                .setParameter("countryName", value);
        country = (EntityCountry) query.getSingleResult();
        return country;
    }

    @Override
    public String getAsString(FacesContext context, UIComponent component, Object value) {
        EntityCountry c = (EntityCountry) value;
        return c.getCountryName();
    }
} 
```

当我使用命令按钮发表评论时，我想在不调用 CountryConverter 的情况下调用“setComment”设置器。我怎样才能做到这一点 ？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-05-14T18:21:01.307

不幸的是，这是`<f:viewParam>`组件的设计。它将转换请求参数并在*每个*HTTP 请求以及回发上设置属性。为了改变这种行为，您需要`<f:viewParam>`使用一个自定义组件进行扩展，该组件不记得其状态中的初始请求参数。它相对简单，而不是将`setSubmittedValue()`and委托`getSubmittedValue()`给`StateHelper`，您只需将其设为实例变量即可。这在[此博客](http://jdevelopment.nl/stateless-stateful-jsf-view-parameters/)中有详细描述。

```
@FacesComponent("com.my.UIStatelessViewParameter")
public class UIStatelessViewParameter extends UIViewParameter {

    private String submittedValue;

    @Override
    public void setSubmittedValue(Object submittedValue) {  
        this.submittedValue = (String) submittedValue;
    }

    @Override
    public String getSubmittedValue() { 
        return submittedValue;
    }   
} 
```

[OmniFaces](http://omnifaces.org)有一个现成的组件用于此风格的[`<o:viewParam>`](http://omnifaces.org/docs/vdldoc/current/o/viewParam.html). 这是[现场示例](http://showcase.omnifaces.org/components/viewParam)。

# debugging - FB 计数差异（我已经使用了调试器和 fbrefresh 参数！）

> ID：10588775
> 
> 赞同：0
> 
> 时间：2012-05-14T18:14:36.177
> 
> 标签：debugging, facebook-sharer

[http://m.lifetrac.ca/blog/how-choose-church](http://m.lifetrac.ca/blog/how-choose-church) - 有 13 个（您可以在手机中访问或添加 ?device=mobile） - 完整站点（删除 m 子域）说 0 个赞

我已经调试了两个链接，它们都很好。所以我只是不知道为什么它们不同。更奇怪的是，其他博文都还好！参见“影响一”而不是“如何选择教堂”

顺便说一句，我关闭了移动重定向，这就是我能够使用调试器的原因。如果您现在输入移动网址，它将无法正常工作。站点似乎将 FB 调试器检测为桌面访问者，因此将 fb 调试器重定向到整个站点——我认为 fb 无法跟踪 302 重定向。...除非你把 ?device=mobile ——然后调试器工作。

可悲的是，我无法附加刮擦信息图像:(

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-05-15T14:29:24.780

现在都同步了。我自己曾经喜欢过这篇文章，现在一切都一致了！

# mongodb - 可以将上限集合复制到常规集合中吗？

> ID：10588780
> 
> 赞同：0
> 
> 时间：2012-05-14T18:14:50.463
> 
> 标签：mongodb, replication

我正在考虑一个设置，其中几个节点具有上限集合以实现快速且轻松的日志记录。然后将这些集合复制到只读“报告服务器”，用于分析/报告和历史数据存储。

可以将上限集合不对称地复制到常规的非上限集合吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-05-14T19:33:45.633

MongoDB 不支持这种行为。

对行为的正确支持有点难以定义。例如，如果无限大小的副本非常落后，比如由于网络分区，会发生什么？上限集合是否应该在副本赶上之前忽略其上限，还是应该丢失数据？

# python - python将csv标头导入字典

> ID：10588786
> 
> 赞同：1
> 
> 时间：2012-05-14T18:16:01.760
> 
> 标签：python, csv

如何将文件的标题导入字典。

我已经尝试过了，但它导入了整个字典：

```
import csv
d = csv.DictReader('foo.csv', dialect='excel', delimiter=',') 
```

这甚至可能吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-05-14T18:23:58.280

我相信你正在做的事情会很好。

`d.fieldnames`包含字段名称列表

我认为`DictReader`只是包装文件对象。因此，尽管您可以遍历整个 csv，但它不会“导入”到内存中。

# uitableview - 如何删除 UITableView 部分之间的垂直间距？

> ID：10588789
> 
> 赞同：3
> 
> 时间：2012-05-14T18:16:10.967
> 
> 标签：uitableview

我有一个包含几个部分的分组表视图。默认情况下，部分之间存在间隙。我一直在寻找一种简单的方法来完全消除间隙，但没有任何运气。我可以通过 Interface Builder 做的最好的事情是在“Table View Size”属性部分中设置“Section Height”值，但这些字段不接受 0 作为有效输入。谁能告诉我解决这个问题的最佳方法？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2014-06-01T22:56:14.143

上面的答案对我不起作用，我必须实际创建一个高度为 1 且背景颜色为 clear 的 UIView，然后将它的 y 原点坐标设置为 -1。

```
- (UIView *)tableView:(UITableView *)tableView viewForFooterInSection:(NSInteger)section
{
    UIView *view = [[UIView alloc] initWithFrame:CGRectMake(0, -1, tableView.frame.size.width, 1)];
    [view setBackgroundColor:[UIColor clearColor]];
    return view;
}

- (CGFloat)tableView:(UITableView *)tableView heightForFooterInSection:(NSInteger)section
{
    return 1;
} 
```

这给了我一个 Grouped tableView，其中部分单元格不会在 headerView 下方滚动，并且在部分之间没有填充。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2013-10-09T16:31:22.720

在您的表视图的委托中，您可以实现[`tableView:heightForHeaderInSection:`](https://developer.apple.com/library/ios/documentation/uikit/reference/UITableViewDelegate_Protocol/Reference/Reference.html#//apple_ref/occ/intfm/UITableViewDelegate/tableView%3aheightForHeaderInSection%3a)和[`tableView:heightForFooterInSection:`](https://developer.apple.com/library/ios/documentation/uikit/reference/UITableViewDelegate_Protocol/Reference/Reference.html#//apple_ref/occ/intfm/UITableViewDelegate/tableView%3aviewForFooterInSection%3a).

```
- (CGFloat)tableView:(UITableView *)tableView heightForHeaderInSection:(NSInteger)section {
    return 0.0;
}

- (CGFloat)tableView:(UITableView *)tableView heightForFooterInSection:(NSInteger)section {
    return 0.0;
} 
```

# javascript - express/node.js API 中的高效服务器端 JavaScript 内存管理

> ID：10588793
> 
> 赞同：11
> 
> 时间：2012-05-14T18:16:17.840
> 
> 标签：javascript, node.js, memory-management, express

## 概述

我过去读过一些关于 JavaScript 内存管理的文章，并且知道循环 DOM 引用等问题。

但是我仍然有点不舒服，因为这会转化为服务器端 JavaScript 环境，例如[node.js](http://nodejs.org/)，更具体地说是在[express](http://expressjs.com/)上编写的 API 。

* * *

## 获取这个示例文件（我们称之为 server.js）

```
var npm_moduleA = require('npmA')({ someInitArg : 'blah' }),
    app = express.createServer();

app.get('/api/foo', function (req, res) {

    var result = npm_moduleA.doSomething();
    res.send(result);

});

app.get('/api/bar', function (req, res) {

    var npm_moduleB = require('npmB')({ someInitArg : 'blah' }),
        result = npm_moduleB.doSomethingElse();

    res.send(result);

}); 
```

## 问题（假设这是一个高负载站点）

1.  **的生命周期是`npm_moduleA`什么？**它是在服务器启动的那一刻创建的，但是什么时候（如果有 GC 反对它的话）-我猜它永远不会被触及，因为它在全局范围内？

2.  **在'/api/bar/'中，`npm_moduleB`每次请求后都应该删除吗？**或者这应该单独留给GC。

3.  **的全局实例化是否`npm_moduleA`比重复的实例化（和可能的删除）更有效`npm_moduleB`？**

* * *

## 参考

*   [JavaScript 内存管理](http://engineering.socialcast.com/2011/06/javascript-memory-management/)
*   [JavaScript 中的内存泄漏模式](http://www.ibm.com/developerworks/web/library/wa-memleak/)
*   [什么是 JavaScript 垃圾回收？](https://stackoverflow.com/questions/864516/what-is-javascript-garbage-collection)
*   [Backbone.js 和 JavaScript 垃圾收集](http://lostechies.com/derickbailey/2012/03/19/backbone-js-and-javascript-garbage-collection/)

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2012-05-16T08:36:10.067

由于 node.js 不会为每个调用创建和销毁运行上下文，因此两者都`npm_moduleA`将`npm_moduleB`存在（在缓存中），直到您终止服务器。

事实上，无论你在哪里需要模块，它都只是获得一个指向模块入口点的指针。它在运行时不会实例化任何东西。

这是一个例子：

index.js

```
var t = require('./module.js');
t.value = 10;

function test() {
  var t2 = require('./module.js');
  console.log(t2.value);
}

test(); 
```

模块.js

```
module.exports = {}; 
```

控制台输出：

```
10 
```

在这种情况下，只需将您的 require()s 放在全局范围内一次。不要在回调中做 requires，因为 require() 有一些文件名解析工作要做，并且它与全局范围内的 require 没有区别（在任何方面）。

但是如果你要实例化一个类`new SomeClass()`，那么你在哪里做很重要。

# sql-server - SQL Server 2005 中 XML 数据类型的优点

> ID：10588803
> 
> 赞同：1
> 
> 时间：2012-05-14T18:16:47.610
> 
> 标签：sql-server, xml, sql-server-2008, sql-server-2005, xml-serialization

我试图了解`XML`在 SQL Server 2005 中使用 DataType 的基本优势。我在**[这里](http://weblogs.asp.net/eporter/archive/2005/11/27/431649.aspx)**接受了这篇文章，说如果你想删除多条记录。序列化 XMl，将其发送到数据库中，然后使用以下查询将其删除..

![在此处输入图像描述](../Images/b8cd9e380aaa19dad29c1e7da820c435.png)

我很想研究使用此 DataType 的任何其他优势...

**编辑**

**[在 SQL Server 2005 中存储 XML 数据的原因](http://msdn.microsoft.com/en-us/library/ms345115%28v=sql.90%29.aspx)**

以下是在 SQL Server 2005 中使用原生 XML 功能而不是在文件系统中管理 XML 数据的一些原因：

1.  您想使用数据库服务器的管理功能来管理您的 XML 数据（例如，备份、恢复和复制）。

    **我的理解**- 你能分享一些关于它的知识来说明清楚吗？

2.  您希望以一种高效的交易方式共享、查询和修改您的 XML 数据。细粒度的数据访问对您的应用程序很重要。例如，您可能希望插入一个新部分而不替换整个文档。

    **我的理解**- XML 在特定的列行中，为了在该行的单元格中添加新部分，需要更新，因此将更新整个文档。对？

3.  您希望服务器保证格式正确的数据，并可选择根据 XML 模式验证您的数据。

    **我的理解**- 你能分享一些关于它的知识来说明清楚吗？

4.  您希望对 XML 数据进行索引以实现高效的查询处理和良好的可伸缩性，并使用一流的查询优化器。

    **我的理解**——同样可以通过添加单独的列来完成。那么为什么是 XML 列呢？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-05-14T19:07:31.840

优点：允许存储可以由 xml 模式自动控制的 xml 数据 - 从而保证一定水平的数据质量 许多 Web/桌面应用程序以 xml 形式存储数据，然后可以轻松地在数据库中存储和查询这些数据 - 所以它是存储应用程序可能需要使用的 xml 数据的好地方（例如，用于配置设置）

缺点：使用 xml 字段时要小心，它们可能一开始是无害的存储，但如果您想搜索、分析和报告许多记录，它们可能会成为性能噩梦。

此外，如果将添加、更改或删除 xml 字段，这可能会很慢并导致复杂的 t-sql。

在复制中，即使只有一个节点发生更改，整个 xml 也会更新 - 因此您可能会遇到更多无法轻松解决的冲突。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-05-15T08:45:07.847

我想说的是你列出的 4 个优势，这两个很关键：

> 您希望以一种高效的交易方式共享、查询和修改您的 XML 数据

SQL Server 以一种优化的方式存储 XML，而不是存储纯字符串，并允许您以有效的方式查询 XML，而不是要求您将整个 XML 文档带回客户端。想一想，如果您想查询 10,000 个 XML 列，每个列包含 1k 的数据，那是多么的低效。对于小型 XPath 查询，您需要为每个客户端每次通过网络返回 10k 数据。

> 您希望对 XML 数据进行索引以实现高效的查询处理和良好的可扩展性，并使用一流的查询优化器

这与我上面所说的有关，它比纯文本列更有效地存储，后者也会遇到页面碎片问题。

# javascript - jQuery设置选择标签的值

> ID：10588805
> 
> 赞同：0
> 
> 时间：2012-05-14T18:16:57.377
> 
> 标签：javascript, jquery, ajax, json

我有一个页面，当这个页面打开时，我想去数据库，检索一些数据并将这些数据放在两个选择标签中。我创建了它，一切正常，但我无法将返回的数据附加到选择标签。

# HTML 代码

```
 <li>
        <label>Related Concepts</label>
        <p>
            <label>Source</label>
            <select name="source[]">
                <option>select source</option>
            </select>
        </p>
        <p>
            <label>Destination</label>
            <select name="destination[]">
                <option>select destination</option>
            </select>
        </p>
    </li> 
```

# jQuery代码

```
$('#addRelation').ready(function (){
    $.getJSON("http://localhost/Mar7ba/Ontology/getAllConcepts/TRUE",function(data){
        var source = document.getElementsByName('source');
        var des = document.getElementsByName('destination');

        for(var i=0;i<data.length;i++){
            source.innerHTML+="<option>"+data[i]+"</option>";
            des.innerHTML+="<option>"+data[i]+"</option>";
        }
    });
}); 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-05-14T18:23:16.543

如果我是你，我会做出以下改变：

html

```
 <li>
        <label>Related Concepts</label>
        <p>
            <label>Source</label>
            <select name="source[]" id="source">
                <option>select source</option>
            </select>
        </p>
        <p>
            <label>Destination</label>
            <select name="destination[]"  id="destination">
                <option>select destination</option>
            </select>
        </p>
    </li> 
```

javascript

```
$('#addRelation').ready(function (){
    $.getJSON("http://localhost/Mar7ba/Ontology/getAllConcepts/TRUE",function(data){
        var source = $('select#source');
        var des = $('select#destination');
        var options = '';

        for(var i=0;i<data.length;i++){
            options += "<option>"+data[i]+"</option>";
        }

        source.html( options );
        des.html( options );
    });
}); 
```

由于您已经在使用 jquery，您可以利用它进行 dom 操作。此外，您可以使用 ID 而不是名称来加快选择器的速度。

另外，请确保您正在正确访问数据对象。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-05-14T18:22:57.997

如果它不是对象，您可能会在每次迭代时覆盖该值：

```
var elems = $('[name="source"], [name="destination"]');

elems.empty();
$.each(data, function(index, item) {
    elems.prepend("<option>"+item+"</option>");
}); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-05-14T18:23:21.067

像下面这样重写你的迭代，

```
$('#addRelation').ready(function (){
    $.getJSON("http://localhost/Mar7ba/Ontology/getAllConcepts/TRUE",function(data){
        var $source = $('select[name=source]');
        var $des = $('select[name=destination]');

        var options = [];
        for(var i=0;i<data.length;i++){
            options.push("<option>"+data[i]+"</option>");
        }

        var optionStr = options.join('');
        $source.html(optionStr);
        $des.html(optionStr);
    });
}); 
```

# node.js - 从 Mongoose 模型中找到的本机驱动程序不返回光标

> ID：10588808
> 
> 赞同：7
> 
> 时间：2012-05-14T18:17:27.893
> 
> 标签：node.js, mongodb, mongoose

我正在尝试通过Mongoose`find`的属性执行本机 MongoDB 查询。我没有提供回调，所以我希望 find 返回一个对象，但它会返回。根据[Mongoose docs](https://github.com/learnboost/mongoose)，正在使用的驱动程序可以通过访问，如果我切换到纯粹使用本机驱动程序代码确实会返回 a所以我无法弄清楚发生了什么。`collection``Model``Cursor``undefined``YourModel.collection``find``Cursor`

这是重现该问题的代码片段：

```
var db = mongoose.connect('localhost', 'test');
var userSchema = new Schema({
    username: String,
    emailAddress: String
});
var User = mongoose.model('user', userSchema);

var cursor = User.collection.find({});
// cursor will be set to undefined 
```

我尝试使用 node-inspector 进入代码，但它不允许我这样做。知道我做错了什么吗？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2012-05-14T22:18:00.117

本机驱动程序方法都被代理在 nextTick 上运行，因此不会返回来自驱动程序的返回值。

相反，您可以传递一个回调，返回的第二个参数是光标。

```
User.collection.find({}, function (err, cursor) {
  // 
}); 
```

好奇为什么你需要绕过猫鼬？

# memcached - 我应该如何确定是什么发出了 flush_all 命令

> ID：10588810
> 
> 赞同：0
> 
> 时间：2012-05-14T18:17:34.553
> 
> 标签：memcached

我们有一个由大约两打应用程序共享的 memcached 服务器。Web 应用程序之一（或者我们的实用程序应用程序之一）定期发出 flush_all 命令。频率似乎是随机的，或者至少我们还没有看到模式。它每小时发生大约 10 次。

这就是问题所在。我想不出一个好方法来确定哪个应用程序正在执行此操作。memcacehd 日志根本没有帮助。这是我到目前为止所做的： * grep all source code - 除了 memcached 库之外，我在任何地方都看不到我们发出这个命令的地方。* 在 memcached 中启用详细日志记录 (-vv) - 我看到命令已发出，但日志未显示有关从何处发出命令的任何信息。* 研究如何在管理上禁用它；如果没有未经批准的 memcached 源补丁，我想不出一个好方法来做到这一点。

有没有其他人有这个问题？我假设这来自我们的一个网络应用程序，但它也可能来自其他地方。有什么建议么？

我的下一步是设置第二个 memcached 服务器并逐个移动应用程序（这将是缓慢且耗时的）。一定会有更好的办法。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2014-04-12T20:56:37.247

有点晚了，但万一其他人碰到这个......

我建议您设置多个 memcache 代理并将每个应用程序配置为使用不同的代理。我发现的第一个代理是[twemproxy](https://blog.twitter.com/2012/twemproxy)，不知道它有多好。

之后，您可以使用代理的日志来确定哪个应用程序正在发出命令。

# c# - 无法使用属性对对象字段的值进行字符串化

> ID：10588811
> 
> 赞同：0
> 
> 时间：2012-05-14T18:17:46.230
> 
> 标签：c#, asp.net, datetime, foreach

我目前正在处理一些代码。我将缩短细节，但这就是我的经验：

这是课程`BookingObject`：

```
public class BookingObject
{
    public BookingObject(int id, DateTime starttime)
    {
        this.id = id;
        this.starttime = starttime;
    }
   public int id {get; set;}
   public datetime {get; set;}
} 
```

这是`webform.aspx`：

```
 List<BookingObject> bo = new List<BookingObject>();

  foreach (BookingObject book in bo)
  {
      int avcde = book.starttime.Hour;
      //starttime is DateTime
      TextBox1.Text = avcde.toString();
  } 
```

`avcde`当我在某个文本框中显示变量时，它显示`null`. 我尝试调试并标记赋值行，调试器显示变量`avcde`是`0`，但`book.starttime.Hour`显示了一些整数值。从`book.starttime.Hour`到变量的赋值`avcde`不成功。

我可以知道这有什么问题吗？

谢谢你的帮助 ：-）

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-05-14T18:21:33.377

由于您的问题是基本的，我将给出一个基本的答案......在 foreach 循环中创建的变量将在 foreach 循环之后被销毁。如果没有其余的代码，就很难诊断出更多的问题。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-05-14T18:51:02.823

一个不可为空的int可以返回null似乎很奇怪，我认为这是不可能的，因为默认值为零......

但是，您是否尝试在 for each 循环之后直接在 textBox 中分配值？尝试这样的事情：

```
List<BookingObject> bo = new List<BookingObject>();
  DateTime dt;
  foreach (BookingObject book in bo)
  {
      dt = book.starttime;

  }
  //starttime is DateTime
  TextBox1.Text = Convert.ToString(dt.Hour); 
```

尝试使用此代码并查看结果...

您确定在这段代码之后没有再次分配 TextBox.Text 属性吗？

# asp.net-mvc - 在保存到数据库之前比较字节数组

> ID：10588814
> 
> 赞同：1
> 
> 时间：2012-05-14T18:18:01.527
> 
> 标签：asp.net-mvc, entity-framework, file-io, bytearray

比较我保存到数据库的图像没有什么不同的最佳方法是什么，从而节省了 I/O。

**设想：**

我使用实体框架在 MVC3 中编写 ASP.NET 应用程序。我的 UserProfile 控制器有一个*Edit*操作方法。现在我想检查我发回该方法的图像是否不同，如果是，那么我想调用 ObjectContext 。**SaveChanges()**如果它是相同的图像，然后继续。

这是我的代码的精简版本：

```
 [HttpPost, ActionName("Edit")]
    public ActionResult Edit(UserProfile userprofile, HttpPostedFileBase imageLoad2)
    {
        Medium profileImage = new Medium();

        if (ModelState.IsValid)
        {
            try
            {
                if (imageLoad2 != null)
                {
                    if ((db.Media.Count(i => i.Unique_Key == userprofile.Unique_Key)) > 0)
                    {
                        profileImage = db.Media.SingleOrDefault(i => i.Unique_Key == userprofile.Unique_Key);
                        profileImage.Amend_Date = DateTime.Now;
                        profileImage.Source = Images.ImageToBinary(imageLoad2.InputStream);
                        profileImage.File_Size = imageLoad2.ContentLength;
                        profileImage.File_Name = imageLoad2.FileName;
                        profileImage.Content_Type = imageLoad2.ContentType;
                        profileImage.Height = Images.FromStreamHeight(imageLoad2.InputStream);
                        profileImage.Width = Images.FromStreamWidth(imageLoad2.InputStream);

                        db.ObjectStateManager.ChangeObjectState(profileImage, EntityState.Modified);
                        db.SaveChanges();

                    }
                }
            }
        } 
```

所以我将我的图像作为 varbinary(max) 保存到一个 SQL Server Express DB 中，它在我的实体中被引用为一个字节数组。

这只是从帖子中循环字节数组并将其与拉回 ObjectContext 的字节数组进行比较的情况吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-05-14T18:49:44.960

我不会直接比较字节数组，而是比较图像的哈希值。也许可以将以下内容提取到比较方法中：

```
SHA256Managed sha = new SHA256Managed();
byte[] imgHash1 = sha.ComputeHash(imgBytes1);
byte[] imgHash2 = sha.ComputeHash(imgBytes2);

// compare the hashes
for (int i = 0; i < imgHash1.Length && i < imgHash2.Length; i++)
{
    //found a non-match, exit the loop
    if (!(imgHash1[i] == imgHash2[i]))
        return false;
}
return true; 
```

# asp.net - YouTube ASP.NET API：上传请求返回 400，关键字文本“太长”

> ID：10588815
> 
> 赞同：2
> 
> 时间：2012-05-14T18:18:02.847
> 
> 标签：asp.net, upload, youtube-api, keyword, http-status-code-400

尝试上传视频，这是我得到的回复（几分钟后，不少于）：

```
<?xml version='1.0' encoding='UTF-8'?>
  <errors>
    <error>
      <domain>yt:validation</domain>
      <code>too_long</code>
      <location type='xpath'>media:group/media:keywords/text()</location>
    </error>
  </errors> 
```

我作为关键字发送的纯文本：

```
DEMOGXS53, Catchers, 34.00, Fully Closed, Mizuno, $0 - $99.99, Demo Gloves, Female Fastpitch 
```

我传递给 Upload 方法的 YouTube.Video 对象上的关键字值：

```
DEMOGXS53%2c+Catchers%2c+34.00%2c+Fully+Closed%2c+Mizuno%2c+%240+-+%2499.99%2c+Demo+Gloves%2c+Female+Fastpitch 
```

我发送的内容似乎没有违反 YouTube 的规则。（单个关键字最大字符长度为 30，总关键字最大字符长度为 500。请参见此处：[https](https://developers.google.com/youtube/2.0/reference#youtube_data_api_tag_media%3akeywords) ://developers.google.com/youtube/2.0/reference#youtube_data_api_tag_media%3akeywords ）有什么想法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-05-15T13:28:12.167

已解决，感谢 Aristos 指出。我正在对整个关键字字符串进行 URL 编码，因此 YouTube 无法解析逗号并将其全部视为一个大关键字。

如果您需要对某些字符进行 URL 编码（例如撇号 - 这是一个非法字符，如果留下会导致另一个 400 响应），您需要在代码中手动查找并替换它们。

# c# - 带数据库的动态 Linq

> ID：10588816
> 
> 赞同：0
> 
> 时间：2012-05-14T18:18:08.077
> 
> 标签：c#, asp.net-mvc-3, search, dynamic

我正在尝试理解 Scott Guthrie 在此示例[Dynamic Query中使用的动态 linq](http://weblogs.asp.net/scottgu/archive/2008/01/07/dynamic-linq-part-1-using-the-linq-dynamic-query-library.aspx)

Scott 在 CsharpSamples 文件中附加了一个文件作为示例，他在该文件中使用动态查询在多个列中进行搜索。我试图了解动态查询的工作原理，以便我可以调整他的代码以在我的程序中工作。

下面的这段代码给我带来了最大的麻烦

```
var query = db.Customers.Where("City == @0 and Orders.Count >= @1", "London", 10).
            OrderBy("CompanyName").
            Select("New(CompanyName as Name, Phone)"); 
```

我不明白为什么他在第一行硬编码值“伦敦和“10”？

我想将动态查询用于调用表的搜索功能，`iamp_mapping`并且我想搜索的列被称为`PA, Major Program, Investment_Area, Director`and `VP`。

我希望用户能够使用单个搜索框来搜索每一列是否存在值。这也是我想用来搜索值的搜索功能。我能够使其与单列搜索一起工作，但不能与每一列一起工作。

```
if (!String.IsNullOrEmpty(searchString))
{
} 
```

我希望这是有道理的，请随时提出任何有助于诊断我的问题的问题。我会经常回来查看。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-05-14T18:35:45.677

正如我从你的评论中了解到的，你想要这样的东西：

```
var query = db.iamp_mapping.Where("PA == %0 and Major_Program == %0 and Investment_Area == %0 and Director == @0 and VP == @0", "ValueToSearchFor").
            OrderBy("...").
            Select("..."); 
```

注意：我没有完全测试它，但根据我的直觉，我会说这是有效的。当然，您仍然必须正确添加 OrderBy 和 Select。

这`@0`只是您为`Where`方法提供的第一个值参数。

# c# - 如何创建在用户单击按钮时修改数据的 EWF UI 页面？

> ID：10588817
> 
> 赞同：1
> 
> 时间：2012-05-14T18:18:18.573
> 
> 标签：c#, asp.net, enterprise-web-library

我想创建一个页面，从用户那里收集一些信息，然后在用户单击按钮时修改数据库。如果用户在没有单击按钮的情况下离开页面，我不想修改任何内容。

如何在无需手动将自己的按钮放入内容区域的情况下执行此操作？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-05-14T18:35:04.873

从页面的 LoadData 调用 EwfUiStatics.SetContentFootActions。这将导致在页面的右下角显示一个大按钮。如果用户单击它，您传递给该方法的数据修改将被执行。

# codeigniter - 在 codeigniter 中的同一变量上使用 html_escape 和 auto_link

> ID：10588820
> 
> 赞同：1
> 
> 时间：2012-05-14T18:18:27.393
> 
> 标签：codeigniter, variables, codeigniter-2, htmlspecialchars

我想在我的网站上显示用户评论，我正在使用 html_escape（Codeigniter 中的 htmlspecialchars）转义输出。但我也想使用 Codeigniter 的 auto_link 函数激活评论中的 URL。

**如何将这两个函数应用于相同的变量/内容？**

```
<?php echo html_escape($review); ?>

<?php echo auto_link($review); ?> 
```

我必须使用 html_escape，因为我不信任用户内容；但如果可能的话，我想显示输入的 URL。注意：html_escape 和 auto_link 中的字符没有冲突。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2012-05-14T18:29:15.857

`auto_link(html_escape($review))`

但是，如果您不信任您的用户，请不要解析他们的链接。假设您的用户提供有见地的评论，例如

> [在http://example.com/](http://example.com/)上免费提供廉价药物

`auto_link(html_escape($review))`仍将解析链接。

# php - 在不使用整个 URL 的情况下包含 member.php

> ID：10588821
> 
> 赞同：-3
> 
> 时间：2012-05-14T18:18:31.940
> 
> 标签：php

我有一个名为 users 的文件夹。用户包含以下内容：

```
*username*/index.php
member.php 
```

`*username*`是已注册用户的用户名。有几个`*username*`文件夹，它们都包含 index.php。

由于 index.php in`*username*/`是过去`member.php`的，我如何`member.php`在`index.php`不使用整个 URL 的情况下包含在内？我已经尝试过`users/member.php`and `/users/member.php`，但它说目录不存在。我不能使用整个 URL，因为它弄乱了我的 PHP。如何在`member.php`不使用整个 URL 的情况下包含？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-05-14T18:21:29.133

只要 username/index.php 不改变当前工作目录，你可以简单地使用相对路径：

```
include '../members.php'; 
```

如果它确实改变了 cwd，只需包含 cwd 的相对路径。您可以通过以下方式找出脚本的当前工作目录：

```
echo getcwd(); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-05-14T18:21:55.533

在文件系统中，字符串`../`代表上一个目录。

```
include("../members.php"); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-05-14T18:29:18.227

这种结构听起来很奇怪。无论如何，你可以使用

```
include __DIR__.'/../member.php' 
```

你也可以使用简单的

```
include '../member.php' 
```

但仅当 index.php 是您启动脚本时（即您在浏览器中键入的内容以启动应用程序）

# json - 是否有类似 csv 或 json 但更图形化且更易于人类阅读的东西？

> ID：10588822
> 
> 赞同：2
> 
> 时间：2012-05-14T18:18:45.380
> 
> 标签：json, xml, csv, yaml, human-readable

例如 CSV 和 JSON 是人类和机器可读的文本格式。

现在我正在`graphical`为表数据表示寻找更多类似的东西。

代替：

```
1,"machines",14.91
3,"mammals",1.92
50,"fruit",4.239
789,"funghi",29.3 
```

这是 CSV 样式或

```
[
 [1,"machines",14.91],
 [3,"mammals",1.92],
 [50,"fruit",4.239],
 [789,"funghi",29.3]
] 
```

这是 JSON 样式，我不打算给出 XML 示例，类似这样的东西是我的想法：

```
 1 | "machines"| 14.91
   3 | "mammals" |  1.92
  50 | "fruit"   |  4.239
 789 | "funghi"  | 29.3 
```

对于某些语言，应该有它的阅读器和编写器库，并且它应该以某种方式成为标准。当然，我可以自己动手，但如果还有一个标准，我会同意的。

我在 wiki 或标记语言中看到过类似的东西，但它应该作为一种人类易于编辑的数据定义格式，并且可以由软件库读取和编写。

这不完全是标记和 wiki 语言的用途。我正在寻找的更多属于 csv、json 和 xml 家族。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-05-14T18:23:54.687

我会检查纺织品。它的[表格语法](http://redcloth.org/hobix.com/textile/#tables)几乎与您描述的完全一样。

例如，您的示例中的表将按如下方式构造：

```
|   1 | machines | 14.91  |
|   3 | mammals  |  1.92  |
|  50 | fruit    |  4.239 |
| 789 | funghi   | 29.3   | 
```

另一种选择（尽管没有针对表格数据进行优化）是[YAML](http://yaml.org/)，它非常适合 JSON-ish 类型的数据。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-05-14T23:38:57.787

或者，您也可以查看 CSV 编辑器的 ie

*   [CSVEd](http://csved.sjfrancke.nl/)
*   [CSVEasy](http://csveasy.com/)
*   [ReCsvEditor](http://recsveditor.sourceforge.net/)

整个目的是以更易读的格式显示 CSV 和更新数据。ReCsvEditor 将以相似的格式显示 Xml 和 Csv 文件。

Google CsvEditor，你会发现很多

# python - Gnuplot 中连续、大小固定、透明的图形

> ID：10588824
> 
> 赞同：2
> 
> 时间：2012-05-14T18:19:02.257
> 
> 标签：python, gnuplot

从此开始：

```
#!/usr/bin/env python
from numpy import *
import Gnuplot as gp
import Gnuplot.funcutils

x = (1,2,3)
y=(2,4,5)
g = gp.Gnuplot()
d = gp.Data(x,y,with_="lines",title='Graph')
g.plot(d)
g('set size 200,100')
g.output('filename.svg') 
```

我想得到一个图表，其中点连接到一条线，尺寸固定且透明。建议？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-05-14T19:17:06.300

首先，删除`g('set size 200,100')`. 这个命令基本上告诉 gnuplot 制作一个在 x 方向上比正常大 200 倍，在 y 方向上大 100 倍的图——当你制作你的图时，它要么是**巨大**的，要么你只会真正看到角落里的一小部分情节（你可能什么都看不到）。

接下来，这是我将如何在纯 gnuplot 中完成您想要的（我认为 - 测试它以查看我是否确实正确地解释了您的请求）：

```
set terminal svg size 200,100
set output "filename.svg"
plot '-' w linespoints linestyle 1 pointtype 7 #just picked some linestyles and pointtypes... 
   1 2
   2 4
   3 5
   e 
```

为了将它放入 gnuplot-py 中，您可以将其全部包装在 g('...') 中——这是一种非常丑陋的方法，但它应该可以工作。我不知道 gnuplot-py 将什么识别为有效的绘图类型以及它不识别什么……您可能必须为此深入研究源代码。

我也使用了“内联数据”，但您可以轻松地将您的点写入一个临时文件（使用`tempfile`模块并绘制它，如果这更容易的话）。

看起来`d = gp.Data(x,y,with_="linespoints",title="data")`应该可行，但我不保证......

我的猜测也`g.output('filename.svg',terminal='svg',size="200,100")`可能会起作用，但我从不真正喜欢 gnuplot-py，因为它的行为似乎不像我认为的那样。如果这不起作用，您需要在绘图之前求助于 ag('...')。

总之，如果你尝试这个会发生什么？

```
#!/usr/bin/env python
from numpy import *
import Gnuplot as gp
import Gnuplot.funcutils

x = (1,2,3)
y=(2,4,5)
g = gp.Gnuplot()
d = gp.Data(x,y,with_="linespoints",title='Graph')
g("set terminal svg size 200,100")
g("set output 'filename.svg'")
g.plot(d) 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-05-14T18:32:48.513

我从未将 gnuplot 导入 python，但在 gnuplot shell 中，当我想在图中添加其他行时，我会这样做：

```
 set arrow from 1,2 to 2,4 nohead lw 2
    set arrow from 2,4 to 3,5 nohead lw 2 
```

使用未设置的箭头再次删除它们。您的行 g('set size 200,100') 建议您可以将行传递给 gnuplot 来执行此操作。

运行代码时的结果是什么？你没有得到数据绘制并用线连接吗？我不知道您所说的尺寸固定和透明是什么意思。

# c# - 在 C# 中将元素写入 XML 文件

> ID：10588825
> 
> 赞同：0
> 
> 时间：2012-05-14T18:19:14.623
> 
> 标签：c#, xml

所以我正在尝试创建一个大型 XML 文件，格式如下：

```
<xml>
    <element id ="1">1</element>
    <element id ="2">2</element>
    <element id ="3">3</element>
    ...
    <element id ="100000000">100000000</element>
</xml> 
```

使用 C#。我似乎找不到一种方法来格式化元素以在声明中包含 id（我根本不熟悉 XML）。

有谁知道我如何在 C# 中做到这一点？

这是我的尝试：

```
using System;
using System.Xml;
using System.Linq;
using System.Text;

namespace BigXML
{
    class Class1
    {

        static void Main(string[] args)
        {

            // Create a new file in C:\\ dir

            XmlTextWriter textWriter = new XmlTextWriter("C:\\Users\\username\\Desktop\\testBigXmFile.xml", null);
            textWriter.Formatting = Formatting.Indented;
            textWriter.Indentation = 3;
            textWriter.IndentChar = ' ';
            // Opens the document

            textWriter.WriteStartDocument(true);

            textWriter.WriteStartElement("xml");
            // Write comments
            for (int i = 0; i < 100000000; i++)
            {
                textWriter.WriteElementString("element id =" + '"' + i.ToString() + '"', i.ToString());
            }

            textWriter.WriteEndElement();
            textWriter.WriteEndDocument();

            textWriter.Close();

        }

    }
} 
```

谢谢你，祝你有美好的一天。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2012-05-14T18:22:14.623

你需要写属性“id”。有几种方法可以做到这一点，例如[XmlWriter.WriteAttributeString](http://msdn.microsoft.com/en-us/library/y13bc3d8)

```
 for (int i = 0; i < 100000000; i++)
 {
    textWriter.WriteStartElement("book"); 
    writer.WriteAttributeString("id", i.ToString());                
    textWriter.WriteString(i.ToString());
    textWriter.WriteEndElement(); 
 } 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-05-14T18:32:25.640

另请查看[System.Xml.Linq](http://msdn.microsoft.com/en-us/library/system.xml.linq.aspx)。您可以像这样使用 XDocument 执行相同的操作

```
XDocument xdocfoo = new XDocument(new XElement("xml"));

for (int i = 0; i < 100; i++)
{
    XElement ele = new XElement("element");
    ele.SetAttributeValue("id", i.ToString());
    ele.Value = i.ToString();
    xdocfoo.Root.Add(ele);
}

xdocfoo.Save(@"c:\foo.xml"); 
```

# c# - 如何调试此 Web 服务？

> ID：10588836
> 
> 赞同：3
> 
> 时间：2012-05-14T18:20:01.207
> 
> 标签：c#, asp.net, web-services

我有一个简单的 Web 服务，看起来像这样：

```
[WebMethod]
public OrderForecastItem GetOrderForecast(int shipTo, string catalogName, bool showPricing)
{ 
    return OrderForecastManager.GetOrderForecast(shipTo, catalogName, showPricing);
} 
```

我以一种相当简单的方式从另一个地方调用它：

```
using (OrderForecastWS.OrderForecastWS service = new OurSite.Web.Reporting.OrderForecastWS.OrderForecastWS())
{
    OrderForecastItem orderForecastItems = service.GetOrderForecast(2585432, "DENTAL", false);
} 
```

经过一些体操让系统了解我在客户端和服务器端谈论相同类型的对象（我必须打开`Reference.cs`我的文件`Web References`，删除生成`OrderForecastItem`并添加到我们真实的链接`OrderForecastItem`），系统运行并尝试获取该项目。

不幸的是，它现在在服务呼叫期间爆炸，声称：

> 异常 XML 文档中存在错误 (1, 1113)。(InvalidOperationException)

我可以在浏览器中访问 Web 服务，输入相同的值，然后我得到一个看似有效的 XML 响应。（对我来说看起来没问题，我通过 W3Schools 的 XML 解析器运行它，它清除了它。）

我认为错误中的数字应该是行号和字符号...但是浏览器似乎重新格式化了 xml 文档，所以我无法轻易看到原始 (1, 1113) 位置是什么。

我没有看到一种简单的方法来拦截响应并检查它，因为它似乎一得到它就会爆炸。

我该如何调试呢？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-05-14T18:32:12.070

如果你控制了服务，你就可以进入它。如果它是您解决方案的一部分并托管在本地机器上的 VS WebDev 中，只需 Visual Studio 中的 F11，如果服务是远程托管的（例如通过其他计算机上的 IIS），则在服务主机[msdn](http://msdn.microsoft.com/en-us/library/xf8k2h6a.aspx)上运行远程调试工具，然后您将能够远程介入服务。

顺便说一句，您可以告诉 Visual Studio 为服务中的类型重用引用库中的对象：只需从服务上下文菜单中选择配置服务引用并告诉要重用哪些库。

再三考虑，如果返回的 XML 无法反序列化到您的业务对象中，则可能会发生此错误。当任一侧的类发生更改时，或者您尝试使用与服务正在使用的不同版本的业务库时，可能会发生这种情况。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-05-14T18:27:27.357

如果您使用 Firefox，我会推荐 Firebug。您将能够轻松地以原始格式查看来自网站的响应，这可能会让您更接近您正在寻找的线路和位置。

# c# - 检查列表中是否已经存在相同的项目 ?

> ID：10588840
> 
> 赞同：-3
> 
> 时间：2012-05-14T18:20:13.890
> 
> 标签：c#, list

> **可能重复：**
> [检查列表是否已包含项目？](https://stackoverflow.com/questions/3276005/check-if-a-list-already-contains-an-item-or-not)

```
for (int i = 0; i < webSites.Count(); i++)
                {
                    string t = webSites[i];

                    webCrawler(t, levels - 1);
                    // csFiles.add
                }
                MessageBox.Show(webSites.Count().ToString());
                return csFiles; 
```

让我们在网站上说我有：

www.google.com

www.microsoft.com

现在在第二级让我们说 www.google.com 再次存在，所以这次我不想处理它来执行递归，如果它会再次执行相同的操作。我需要以某种方式制作或检查它是否会执行每个链接一次。我怎样才能检查它？

我不需要检查该项目是否已经存在于列表中我需要检查它是否已经存在所以不要再这样做了，因为它会再次挖掘相同的链接并自我重复。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2012-05-14T18:23:12.593

不要为此使用列表 - 使用 a `Hashset<string>`- 这期望 O(1) 查找时间而不是 O(n) 用于列表，并且真的“集合”隐喻非常适合：

```
HashSet<string> visitedPages = new HashSet<string>();
for (int i = 0; i < webSites.Count(); i++)
{
    string page = webSites[i];
    if(visitedPages.Add(page)) //returns true if new page was added
    {
        webCrawler(page, levels - 1);
    }
} 
```

如果你递归地调用这个方法，当然`visitedPages`哈希集的声明必须在方法之外，例如让它成为一个成员变量，这样你就可以维护访问过的页面的历史。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2012-05-14T18:22:32.367

我猜你需要[List.Contains方法，但是](http://msdn.microsoft.com/en-us/library/bhkz42b3.aspx)

List.Contains 是 O(n)，我建议使用具有 O(1) 查找的 Hashset。

如果您的列表包含所有条目，那么您还可以使用 Linq 中的 Distinct() 函数，它将返回一个仅包含 Distinct 元素的枚举。

```
webSites.Distinct() 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-05-14T18:22:58.537

将访问过的项目保存在[`HashSet<string>`](http://msdn.microsoft.com/en-us/library/bb359438.aspx).

`Add`在访问页面以及`Contains`检查您是否已经访问过该页面时使用。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-05-14T18:23:30.493

创建一个临时列表并将其命名为“temp”。for 循环的每次迭代，查看 webSites 中该位置的字符串是否已经在 temp 中。如果是，请忽略它。如果不是，请将其添加到 temp 然后处理它。

编辑：显然这不是最好的方法。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-05-14T18:33:54.707

为什么不首先选择不同的网站列表？

```
foreach (var site in webSites.GroupBy(s => s))
{
  webCrawler(t, levels - 1);
  // csFiles.add
}
MessageBox.Show(webSites.Count().ToString());
return csFiles; 
```

# context-free-grammar - CFG 中的 LL 与 LR

> ID：10588842
> 
> 赞同：0
> 
> 时间：2012-05-14T18:20:18.047
> 
> 标签：context-free-grammar

LL和LR的精确定义和区别是什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-05-14T18:27:24.627

简要地：

*   LR 表示自下而上（移位减少）解析。

*   LL 通常表示自顶向下（递归下降）解析。

# iphone - 如何使用 Xcode 从服务器读取 webService？

> ID：10588852
> 
> 赞同：0
> 
> 时间：2012-05-14T18:20:43.070
> 
> 标签：iphone, objective-c, ios, xml, xcode

![我尝试使用 Xcode 读取 xml 文件，但它以字符串形式给出响应，xml 将显示如下图所示，它给出 < 和 > 代表 < 和 >][1]

我正在尝试从服务器读取 mywebservice。我编写了 Web 服务，它在网站中以 xml 格式创建文件。当我使用互联网在网站上检查该文件时，它显示如下：

```
<NewDataSet>
  <Table>
    <Column1>Audi</Column1>
  </Table>
  <Table>
    <Column1>BMW</Column1>
  </Table>
  <Table>
    <Column1>MINI</Column1>
  </Table>
</NewDataSet> 
```

但是当我通过肥皂调用该文件时，它会给出以下响应：

```
&lt;NewDataSet&gt;
  &lt;Table&gt;
 &lt;Column1&gt;Audi&lt;/Column1&gt;
 &lt;/Table&gt;
  &lt;Table&gt;
 &lt;Column1&gt;BMW&lt;/Column1&gt;
 &lt;/Table&gt;
 &lt;Table&gt;
 &lt;Column1&gt;MINI&lt;/Column1&gt;
 &lt;/Table&gt;
&lt;/NewDataSet&gt; 
```

但我无法读取像“NewDataSet”这样的标签，因为它会以字符串形式返回响应，而且我是 XML 中的新手，所以请帮助我..我为此使用 Xcode 和 nsmutabledata..！！我尝试了 stringbyReplaceofOccurance，但它没有用 < > 替换 < 和 >。提前致谢。

提前感谢您的帮助。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-05-14T18:28:06.013

我想，试试 NSXMLParser

这可能对你有帮助......

[https://developer.apple.com/library/mac/#documentation/Cocoa/Reference/Foundation/Classes/NSXMLParser_Class/Reference/Reference.html](https://developer.apple.com/library/mac/#documentation/Cocoa/Reference/Foundation/Classes/NSXMLParser_Class/Reference/Reference.html)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-05-14T18:41:33.413

这不是解析问题。检查 Web 服务并确保 xml 标头是：`<?xml version="1.0" encoding="utf-8"?>`或类似的东西。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-05-14T18:36:28.887

您使用 TouchXML 读取 xml 文件的最佳方式 ....对于 TouchXML，请使用此波纹管链接

[http://dblog.com.au/general/iphone-sdk-tutorial-building-an-advanced-rss](http://dblog.com.au/general/iphone-sdk-tutorial-building-an-advanced-rss) ...

也在这里，当您得到响应时，您可以使用 TouchXML 像下面这样阅读其他方式.. 即..

```
- (void) fetchDataSuccessforEvent:(NSMutableData *)data
{
    CXMLDocument *doc = [[[CXMLDocument alloc] initWithData:data options:0 error:nil] autorelease];
    NSArray *nodes = [doc nodesForXPath:@"//Table" error:nil];

    for (CXMLElement *node in nodes) 
    {

        for(int counter = 0; counter < [node childCount]; counter++) 
        {
            if ([[[node childAtIndex:counter] name] isEqualToString:@"Column1"]) 
            {
                NSString *string = [[node childAtIndex:counter] stringValue];
                                NSLog(@"\n\n Title %@",string);

            }

        }

    }

} 
```

如此简单......希望，这对你有帮助...... :)

# c# - 有趣的多线程从 c# 简单循环访问公共 int

> ID：10588853
> 
> 赞同：2
> 
> 时间：2012-05-14T16:12:40.663
> 
> 标签：c#, multithreading

这很有趣......我想知道为什么会发生这种情况。

```
public int numCounter;

private void button2_Click(object sender, EventArgs e)
{
 for (numCounter = 0; numCounter < 10; numCounter++)
 {
  Thread myThread = new Thread(myMethod);
  myThread.Start();
 }
}

public void myMethod()
{
 Console.WriteLine(numCounter);
} 
```

结果会因月相而异... 3 3 4 4 5 6 7 8 9 10

甚至：1 4 5 5 5 6 7 8 10 10

问题是……为什么会这样？如果线程在变量增加后启动，为什么它应该取一个未更新的值？？？？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-05-14T16:48:56.363

仔细查看结果。问题不在于线程使用了未更新的值，而在于该值被更新*了太多次*。

例如，在您的第二个示例中，事件可能是这样的：

```
Thread 1   Thread 2     Thread 3
Start T2
i++
           WriteLine(1)
Start T3
i++
Start T4
i++
Start T5
i++
                         WriteLine(4) 
```

尽管由于编译器和 CPU 优化以及 CPU 缓存的原因，线程可能会变得更加复杂。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-05-14T18:42:42.700

其他答案是正确的，但我想详细说明**为什么**会发生这种情况。只是说“它是不确定的”是正确的，但解释不够。

发生这种行为是因为写入处理器（您的“主”线程）在刷新到内存之前先写入其缓存行。其他线程，即读者，无法查看作者的缓存行。只有当内存刷新发生时，数据才会传播出去。

刷新到内存的速度与 CPU 的速度一样快，但如果更新连续快速发生，一些更新将被合并到单个存储中。这就是数字缺失的原因——它们的写入已被合并。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-05-14T18:43:31.623

仅仅因为线程以更新的值开始并不能保证在它到达读取值的代码时该值保持不变。根据系统中发生的情况，在您点击 Console.WriteLine 之前，您可能会在循环中进行多次迭代。

如果您希望每个线程具有不同的值，那么最好的方法是在循环中声明一个整数，并将其初始化为 numCounter。然后在您的线程中使用 ParameterizedThreadStart，并将本地值传递给它。或者，我要做的一件事是声明一个委托（您仍然必须在此选项中使用范围为循环的变量）内联来完成工作，以避免整数的装箱/拆箱。

```
for (int i = 0; i < 10; i++){
    var tmp = i;
    new Thread(() => {
        Console.WriteLine(tmp);
    }).Start();
} 
```

您还希望在非假设设置中跟踪线程的状态，这样您就不会在所有线程完成工作之前退出。如果您不想使用 ThreadPool，则声明一个与循环大小相同的 WaitHandles 数组，然后在线程代码完成执行后调用 WaitArray[tmp].Set()。在循环之后，您将有一个 WaitHandle.WaitAll(WaitArray) 语句阻塞，直到它们全部完成。不过，仅使用 ThreadPool 及其相关的回调机制可能更容易、更安全。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-05-14T16:49:22.090

据我所知，这完全是不确定的。您可以从写入的十个零一直到十个十以及其间的所有递增变化一直获取值。

原因是您没有对`numCounter`变量进行任何同步和/或序列化的访问。线程只会在线程执行时读取它，这可能随时发生，基于任意数量的环境条件。

因此，获得所有数字且不重复的快速方法是：

```
public int numCounter;

private void button2_Click(object sender, EventArgs e)
{
 for (numCounter = 0; numCounter < 10; numCounter++)
 {
  Thread myThread = new Thread(myMethod);
  myThread.Start(numCounter);
 }
}

public void myMethod(object numCounter)
{
 Console.WriteLine(numCounter);
} 
```

这里的主要缺点是 1) 的签名`myMethod`必须更改，2)`numCounter`从 an转换为`int`an时会发生装箱，`object`以及 3) 这仍然不能保证输出的顺序为预期的 0..10。

这是一个稍微不同的版本，它使用 a`delegate`和`BeginInvoke`/ `EndInvoke`（我喜欢做线程的方式）。它从上面消除了 #2 的缺点，但仍保留 #1 和 #3：

```
public int numCounter;

private delegate void MyMethodDelegate(int numCounter);

private void button2_Click(object sender, EventArgs e)
{
 for (numCounter = 0; numCounter < 10; numCounter++)
 {
  MyMethodDelegate myDelegate = new MyMethodDelegate(myMethod);
  myDelegate.BeginInvoke(numCounter, myMethodDone, myDelegate);
 }
}

public void myMethod(int numCounter)
{
 Console.WriteLine(numCounter);
}

public void myMethodDone(IAsyncResult result)
{
 MyMethodDelegate myDelegate = result.AsyncState as MyMethodDelegate;

 if (myDelegate != null)
 {
  myDelegate.EndInvoke(result);
 }
} 
```

# apache-flex - Adobe Air：需要帮助将数据从 sqlite 传输到组件

> ID：10588857
> 
> 赞同：0
> 
> 时间：2012-05-14T18:20:54.453
> 
> 标签：apache-flex, sqlite, data-binding, air, itemrenderer

我已成功接收到来自 sqlite 的数据。我看到数据出现在跟踪函数中，但是我在正确显示这些数据时遇到了问题。我认为这与绑定对象有关。我一定在某个地方遗漏了一些东西，所以请纠正我错的地方。还有，这个问题其实是[Adobe Air的延续：drag & drop grouped components](https://stackoverflow.com/q/10518955/144201)

无论如何，这是我的 ItemRenderer：

```
<?xml version="1.0" encoding="utf-8"?>
<s:ItemRenderer xmlns:fx="http://ns.adobe.com/mxml/2009" 
                xmlns:s="library://ns.adobe.com/flex/spark" 
                xmlns:mx="library://ns.adobe.com/flex/mx" 
                autoDrawBackground="true">

    <fx:Script>

        [Bindable]
        public var tree:TreeClass_Full;

        [Bindable]
        public var dataText:String = "empty";

        public function setTest():void{
            resultTextArea.text = "AAA";
        }
    </fx:Script>
    <s:HGroup x="5" y="5" width="350" height="150" horizontalAlign="center" verticalAlign="middle">
        <mx:Image id = "resultImage" width="100" height="100"/>
        <s:TextArea id="resultTextArea" height="141" editable="false"
                    text = "{tree.Common_Name}"/>
    </s:HGroup> 
</s:ItemRenderer> 
```

这是sqlite查询成功后将调用的函数：

```
[Bindable]
public var dragDropLeft:ArrayCollection = new ArrayCollection();
[Bindable]
public var dragDropRight:ArrayCollection = new ArrayCollection();

protected function ResultFill():void
{
    // TODO Auto-generated method stub
    if (arr != null){
        for (var i:int = 0; i < arr.length; ++i){
            var tc:TreeClass_Full = arr[i];
            var rr:resultRenderer = new resultRenderer();
            rr.tree = tc;
            trace("--Common Name:" + tc.Common_Name);               

            rr.dataText = tc.Common_Name;
            rr.resultImage.source = tc.Picture1;
            rr.resultTextArea.text = tc.Common_Name;

            trace("----Common Name:" + rr.resultTextArea.text);

            dragDropLeft.addItem(rr);

        }
    }
} 
```

sqlite查询成功后，会调用上述函数。这是我将我的对象（我的来自 sqlite 的 ItemClass）的信息放入我的 ItemRenderer 的地方。

我的 ItemRenderer 有两个组件：Image 和 TextArea。sqlite 包含将用于 Image 的相应图像。对于 TextArea，数据库中所有可显示的文本都将被放置在那里——这意味着来自数据库多个字段的字符串都将被放在一起。（但现在，我只想要一个字段，即 Common_Name）

之后，我将这些 ItemRenderers 放入我的列表（在本例中为 dragDropLeft）。但是，数据不会出现在程序中。**然而，跟踪功能正确输出文本。**

我尝试了一些东西，但我保留了一些代码，它们都产生了相同的结果：TextArea 中的文本根本没有改变。我在这里忘记了什么？

**更新**：

这里的代码涵盖了我使用 Bindable ArrayCollection 的地方：

```
 <s:HGroup width="100%" height="85%" verticalAlign="middle">
            <s:List dataProvider="{dragDropLeft}" width = "45%" height = "95%"
                    dragEnabled="true" dragMoveEnabled="true" dropEnabled="true"
                    itemRenderer="resultRenderer"/>
            <s:List dataProvider="{dragDropRight}" width = "45%" height = "95%" 
                    dragEnabled="true" dragMoveEnabled="true" dropEnabled="true" 
                    itemRenderer="resultRenderer"/>
        </s:HGroup> 
```

基本上，我试图通过从 sqlite 给它值来自己操纵我的 ItemRenderer，但是从其中一位评论者看来，这似乎是不正确的。那么我们该怎么做呢？**我们如何将数据发送到将添加到列表中的 ItemRenderer 对象？**

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-05-15T08:28:47.443

正如我在评论中所说：列表不是容器。你不能只给它添加孩子。您应该将数据对象添加到其`dataProvider`. 基本上整个`ResultFill`方法应该简化为：

```
dragDropLeft.dataProvider = new ArrayCollection(arr); 
```

表示此数据的 ItemRenderer 将由 List 组件在内部创建。在您的自定义 ItemRenderer 中，您现在可以通过`data`属性访问此数据，因此它会变成这样：

```
<s:ItemRenderer xmlns:fx="http://ns.adobe.com/mxml/2009" 
                xmlns:s="library://ns.adobe.com/flex/spark" 
                autoDrawBackground="true">

     <s:HGroup x="5" y="5" width="350" height="150" 
              horizontalAlign="center" verticalAlign="middle">
         <s:Image source="{data.Picture1}" width="100" height="100"/>
        <s:TextArea text="{data.Common_Name}" height="141" editable="false" />
     </s:HGroup> 
</s:ItemRenderer> 
```

请注意，我假设该示例的属性`TreeClass_Full`是`bindable`。

# c - 用于函数逼近的训练神经网络

> ID：10588862
> 
> 赞同：2
> 
> 时间：2012-05-14T18:21:20.463
> 
> 标签：c, neural-network, fann

我对神经网络完全没有经验，现在我只是在玩 FANN 库来学习它们。所以目标是训练网络逼近正弦函数。为此，我使用 3 层 NN 1 个输入、3 个隐藏和 1 个输出神经元。代码是

```
const unsigned int num_input = 1;
const unsigned int num_output = 1;
const unsigned int num_layers = 3;
const unsigned int num_neurons_hidden = 3;

struct fann *ann;

ann = fann_create_standard(num_layers, num_input, num_neurons_hidden, num_output);

fann_set_activation_steepness_hidden(ann, 1);
fann_set_activation_steepness_output(ann, 1);

fann_set_activation_function_hidden(ann, FANN_SIGMOID_SYMMETRIC);
fann_set_activation_function_output(ann, FANN_SIGMOID_SYMMETRIC);

fann_set_train_stop_function(ann, FANN_STOPFUNC_BIT);
fann_set_bit_fail_limit(ann, 0.01f);

fann_set_training_algorithm(ann, FANN_TRAIN_RPROP);

fann_randomize_weights(ann, 0, 1);

for(int i=0; i<2; ++i) {
    for(float angle=0; angle<10; angle+=0.1) {
        float sin_anle = sinf(angle);
        fann_train(ann, &angle, &sin_anle);
    }
}

int k = 0;
for(float angle=0; angle<10; angle+=0.1) {
    float sin_anle = sinf(angle);
    float *o = fann_run(ann, &angle);
    printf("%d\t%f\t%f\t\n", k++, *o, sin_anle);
}

fann_destroy(ann); 
```

但是，我得到的结果与真正的正弦函数无关。我想我的网络设计中存在一些基本错误。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2012-05-15T09:58:07.353

您在此行中选择优化算法 Resilient Backpropagation (Rprop)：

```
fann_set_training_algorithm(ann, FANN_TRAIN_RPROP); 
```

[Rprop](http://en.wikipedia.org/wiki/Rprop)是一种**批量更新**算法。这意味着您必须为每次更新提供整个训练集。[fann_train](http://leenissen.dk/fann/html/files/fann_train-h.html#fann_train)的文档说

> 这种训练始终是增量训练（参见 fann_train_enum），因为只呈现一种模式。

所以适当的优化选项是`FANN_TRAIN_INCREMENTAL`. 您必须使用以下方法之一进行批量学习`fann_train_on_data`：`fann_train_on_file`或`fann_train_epoch`。

当我更改您的代码时，我注意到的是：

*   你的坡度太高了。我使用了默认值（0.5）。
*   你的训练时间太少了。我用了大约20,000。
*   您的功能对于只有 3 个隐藏神经元来说太复杂了。这一点都不容易，因为它是一个周期函数。所以我改变了我近似为 [0,3] 的正弦函数的范围，这要简单得多。
*   位失败限制太难了。:) 我将其设置为`0.02f`.
*   Rprop 不是一个很好的训练算法，它们应该实现类似 Levenberg-Marquardt 的东西，它要快得多。

我得到的解决方案并不完美，但至少大致正确：

```
0       0.060097        0.000000
1       0.119042        0.099833
2       0.188885        0.198669
3       0.269719        0.295520
4       0.360318        0.389418
5       0.457665        0.479426
6       0.556852        0.564642
7       0.651718        0.644218
8       0.736260        0.717356
9       0.806266        0.783327
10      0.860266        0.841471
11      0.899340        0.891207
12      0.926082        0.932039
... 
```

我使用了这个修改后的代码：

```
#include <cstdio>
#include <cmath>
#include <fann.h>
#include <floatfann.h>

int main()
{
  const unsigned int num_input = 1;
  const unsigned int num_output = 1;
  const unsigned int num_layers = 3;
  const unsigned int num_neurons_hidden = 2;

  const float angleRange = 3.0f;
  const float angleStep = 0.1;
  int instances = (int)(angleRange/angleStep);

  struct fann *ann;

  ann = fann_create_standard(num_layers, num_input, num_neurons_hidden, num_output);

  fann_set_activation_function_hidden(ann, FANN_SIGMOID_SYMMETRIC);
  fann_set_activation_function_output(ann, FANN_SIGMOID_SYMMETRIC);

  fann_set_train_stop_function(ann, FANN_STOPFUNC_BIT);
  fann_set_bit_fail_limit(ann, 0.02f);

  fann_set_training_algorithm(ann, FANN_TRAIN_INCREMENTAL);

  fann_randomize_weights(ann, 0, 1);

  fann_train_data *trainingSet;
  trainingSet = fann_create_train(instances, 1, 1); // instances, input dimension, output dimension
  float angle=0;
  for(int instance=0; instance < instances; angle+=angleStep, instance++) {
      trainingSet->input[instance][0] = angle;
      trainingSet->output[instance][0] = sinf(angle);
  }

  fann_train_on_data(ann, trainingSet, 20000, 10, 1e-8f); // epochs, epochs between reports, desired error

  int k = 0;
  angle=0;
  for(int instance=0; instance < instances; angle+=angleStep, instance++) {
      float sin_angle = sinf(angle);
      float *o = fann_run(ann, &angle);
      printf("%d\t%f\t%f\t\n", k++, *o, sin_angle);
  }

  fann_destroy(ann);

  return 0;
} 
```

请注意，`fann_create_train`自 FANN 2.2.0 起可用。

# prolog - Allegrograph 地理空间 Prolog 查询

> ID：10588865
> 
> 赞同：3
> 
> 时间：2012-05-14T18:21:28.680
> 
> 标签：prolog, geospatial, semantic-web, allegrograph

我有一些三元组代表几个城市的位置。我希望能够触发 Prolog 查询，例如

```
(select (?x ?y ?dist) 
(q- ?x !exns:geolocation ?locx)
(q- ?y !exns:geolocation ?locy)
(geo-distance ?locx ?locy ?dist)) 
```

但我收到此错误：

`Server returned 400: attempt to call '#:geo-distance/3' which is an undefined function.`

我想了解如何在 Prolog 查询中使用地理空间推理方法，例如`geo-distance`（我认为它是内置的，因为他们在[这里](http://data.semanticweb.org/pdfs/iswc/2009/industry/iswc_industry_02.pdf)使用它。但这不是真的吗？），因为这对我和我来说目前都是一个谜还没有找到任何这样做的好例子。

我正在使用 Python API，顺便说一句，在[Python API 教程](http://www.franz.com/agraph/support/documentation/current/python-tutorial/python-tutorial-40.html#Geospatial%20Search)中，他们使用该`getStatements`方法在某个半径的圆内检索三元组。我希望能够在 Prolog 查询中通过 Python API 而非 AllegroCL 执行此类操作——我想构建 Web 应用程序，但我不知道如何在 AllegroCL 中执行此操作，但我知道如何在 Python 中使用。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-05-24T19:50:57.960

无法从 Python API 进行地理空间 Prolog 查询。您必须使用 Allegro Common Lisp IDE 来执行此操作。

**编辑：** 不是这样！

使用 AllegroGraph 4.6，您可以做到这一点！问题是我使用的是 AllegroGraph 3.3，所以我是个白痴。

这是使用 AllegroGraph 4.6 从 Python API 工作的 Prolog 规则：

```
(<-- (geo-distance ?point1 ?point2 ?dist)
      (lisp ?dist (let (lon1 lat1 lon2 lat2)
           (setf (values lon1 lat1) (upi->longitude-latitude ?point1))
           (setf (values lon2 lat2) (upi->longitude-latitude ?point2))
           (haversine-miles lon1 lat1 lon2 lat2)))) 
```

特别感谢 Franz Allegro 的人们对我的帮助！

# javascript - 如何运行以嵌入形式插入到 .innerHTML 中的 javascript？

> ID：10588869
> 
> 赞同：0
> 
> 时间：2012-05-14T18:21:33.067
> 
> 标签：javascript

这可能吗？

我插入了一个像这样的简单测试片段

```
<script type="text/javascript">//<![CDATA[ 
document.write('foo');
//]]></script> 
```

但它什么也没做。（W3 学校建议在[这里](http://www.w3schools.com/tags/tag_script.asp)使用 CDATA ，但这并没有帮助）。

重申一下，这段代码被写入了 body 标签的 .innerHTML 属性中。

我在谷歌上看到了一些关于 eval() 的提及，但不太确定这是否相关或良好做法？

像他们[在 W3](http://www.w3schools.com/jsref/jsref_eval.ASP)中所做的那样将代码包装在 eval中没有任何效果。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-05-14T18:23:47.180

Javascript 仅在第一次读取时执行，而不是在动态插入时执行。您必须使用类似`eval()`函数的东西来执行实际脚本的内容。您还可以使用 DOM 函数`getObjectsByTagName()`，例如抓取脚本标签，并从那里获取其内容。

# node.js - Node.js 显示来自 Mongo 的 GridFS 的图像

> ID：10588872
> 
> 赞同：2
> 
> 时间：2012-05-14T18:21:36.033
> 
> 标签：node.js, mongodb, gridfs

我有一个使用 Mongo 和 GridFS 来存储图像的 nodejs 应用程序。我正在尝试通过 Node.js（使用 express 框架）将这些图像显示到浏览器。

我目前正在使用：

```
 res.writeHead(200, {'Content-Type': 'image/jpeg' });
            res.end(imageStore.currentChunk.data.buffer, 'binary'); 
```

imageStore 是创建新 GridStore 并调用 gridStore.open(...) 后的 gridStore 对象

```
 var gridStore = new GridStore(self.collection.db, doc._id, doc.filename, 'r', {
            chunk_size: doc.chunkSize
        });
        gridStore.open(callback); 
```

我确定这不是正确的方法，它会显示损坏的图像。有什么建议么？

谢谢！

编辑：

更新到 mongodb 本机 1.0.2 后，我尝试使用以下方法流式传输数据：

```
res.contentType("image/jpeg");
var imageStream = imageStore.stream(true);
imageStream.pipe(res); 
```

imageStore 是使用后的对象`gridStore.open(function(err, imageStore){ })`

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2012-05-15T08:22:32.207

确保您在驱动程序的 1.0.1 上并使用 http 请求的管道来流式传输数据，下面的示例将其写入文件。在 1.1 中它会变得更好，因为 gridstore 对象将是一个读/写流兼容对象:)

```
/**
 * A simple example showing how to pipe a file stream through from gridfs to a file
 *
 * @_class gridstore
 * @_function stream
 * @ignore
 */
exports.shouldCorrectlyPipeAGridFsToAfile = function(test) {
  var db = new Db('integration_tests', new Server("127.0.0.1", 27017, 
   {auto_reconnect: false, poolSize: 1, ssl:useSSL}), {native_parser: native_parser});

  // Establish connection to db  
  db.open(function(err, db) {
    // Open a file for writing
    var gridStoreWrite = new GridStore(db, "test_gs_read_stream_pipe", "w", {chunkSize:1024});
    gridStoreWrite.writeFile("./test/gridstore/test_gs_weird_bug.png", function(err, result) {      
      // Open the gridStore for reading and pipe to a file
      var gridStore = new GridStore(db, "test_gs_read_stream_pipe", "r");
      gridStore.open(function(err, gridStore) {
        // Grab the read stream
        var stream = gridStore.stream(true);
        // When the stream is finished close the database
        stream.on("end", function(err) {          
          // Read the original content
          var originalData = fs.readFileSync("./test/gridstore/test_gs_weird_bug.png");
          // Ensure we are doing writing before attempting to open the file
          fs.readFile("./test_gs_weird_bug_streamed.tmp", function(err, streamedData) {
            // Compare the data
            test.deepEqual(originalData, streamedData);

            // Close the database
            db.close();
            test.done();          
          });
        })

        // Create a file write stream
        var fileStream = fs.createWriteStream("./test_gs_weird_bug_streamed.tmp");
        // Pipe out the data
        stream.pipe(fileStream);
      })
    })
  });
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2013-04-09T19:57:23.430

env: express (3.0), mongodb-native-driver (1.2), mongodb (2.2)

gs - GridStore.writeFile 之后的文件信息

res - 表达响应对象

```
monogodb.GridStore.read(db, gs["_id"], function(err, data) {

  res.setHeader('Content-Type', gs.contentType);
  res.setHeader('Content-Length', gs.length);
  res.setHeader('Content-Disposition', 'inline; filename="' + gs.filename + '"');

  res.end(data);

}); 
```

# ruby-on-rails - 设计在密码重置期间允许空白密码

> ID：10588877
> 
> 赞同：4
> 
> 时间：2012-05-14T18:22:00.580
> 
> 标签：ruby-on-rails, devise

我有一个带有 Devise 的 Rails 3.2 应用程序设置。一切都很好，除了当我重置密码（通过内置的路线和方法）时，Devise 允许使用空白密码。如果至少有一个字符，它将验证长度以及它是否与确认匹配。我确实在用户帐户中设置了它，他们可以在不输入密码的情况下更新他们的个人资料，但我认为这与重置密码没有任何关系。

任何帮助表示赞赏。

devise.rb -> [http://pastie.org/3911178](http://pastie.org/3911178)

user.rb -> [http://pastie.org/3911187](http://pastie.org/3911187)

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2012-05-15T14:05:20.210

感谢您为我指明正确的方向。问题是由您描述的情况引起的。但是，如果我让 devise 处理验证或使用与他们相同的代码，则用户即使在登录后也必须在更新其帐户时提供密码。为了解决此问题，我只是在验证中检查了 rest_password_token：

```
def password_required?
  # If resetting the password
  return true if reset_password_token.present? && reset_password_period_valid?

   # If the person already has a pass, only validate if they are updating pass
  if !encrypted_password.blank?
    password.present? || password_confirmation.present?
  end
end 
```

*更新我刚刚更新了这个以确保密码令牌没有过期。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-05-14T19:28:07.747

您应该让设计处理程序密码验证：[https](https://github.com/plataformatec/devise/blob/master/lib/devise/models/validatable.rb) ://github.com/plataformatec/devise/blob/master/lib/devise/models/validatable.rb或使用设计用于验证的代码。您的代码的问题是，只有当用户没有设置密码（！encrypted_pa​​ssword.blank？）和其他条件时，您才进行验证。恢复密码时，用户已经设置了密码，因此您无需对密码更新进行验证...

# php - 从源代码中提取完整的函数定义

> ID：10588885
> 
> 赞同：2
> 
> 时间：2012-05-14T18:22:42.820
> 
> 标签：php, function, parsing, refactoring

我想提取给定名称和起始行号的整个函数。

输出应该类似于

```
function function_name( $a = null, $b = true ) {
    $i_am_test = 'foo';
    return $i_am_test;
} 
```

或任何功能定义。大多数工具（包括 grep 等）只返回第一行`function function_name( $a = null, $b = true ) {`，但我需要整个函数定义。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-05-14T23:43:54.190

要从计算机程序源文件中准确提取函数（变量/类/....），尤其是对于 PHP，您需要该语言的真正解析器。

否则你会因为各种疯狂的原因而失败，其中一些与混淆提取机制的字符串和注释有关（尝试跳过字符串文字是 PHP 的噩梦），还有一些必须做有趣的语言规则，直到你绊倒它才发现（如果你的 PHP 文件包含包含看起来像 PHP 源代码的东西的 HTML 会发生什么？）。

我们的[DMS Software Reengineering Toolkit](http://www.semanticdesigns.com/Products/DMS/DMSToolkit.html)具有完整的[PHP5 前端](http://www.semanticdesigns.com/Products/DMS/DMSToolkit.html)，可以完全理解 PHP 语法。它可以解析 PHP 源文件，然后配置为分析/提取您想要的任何代码。解析器准确地捕获其内部 AST 上的行号，因此很容易找到文件中特定行号的代码；给定代码/AST，很容易打印代表该行号处的代码的 AST。如果您在特定行上找到函数标识符并打印出相关的 AST，您将得到函数源代码。

# ios - 通过 iTunes / AppStore 更新应用程序时 SQLite 数据库更新

> ID：10588886
> 
> 赞同：0
> 
> 时间：2012-05-14T18:22:56.167
> 
> 标签：ios, sqlite

在通过 App Store 更新应用程序期间，我想用更多内容更新 SQLite 数据库文件。旧的 SQLite 文件位于`Documents`我的应用程序的文件夹中。

我该如何处理？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-05-14T18:27:05.103

```
sqlite> attach 'path_to_table.db3' as toMerge;           
sqlite> insert into MyTableToInsertTo select * from toMerge.MyTableToInsertFrom; 
sqlite> detach database toMerge; 
```

使用开始；犯罪; 对于大数据

[关联](http://old.nabble.com/Attempting-to-merge-large-databases-td18131366.html)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-05-14T18:36:10.153

我假设您没有使用 Core Data，否则您将使用自动迁移功能。对于直接 SQLLite，您需要创建一个新的数据库文件。然后根据架构更改的性质，您可能能够执行查询以将数据复制到 ( `using INSERT INTO destination SELECT * FROM source`) 上。但是，如果更改太多而无法通过一组简单的查询来处理，例如，如果它涉及业务逻辑，那么您可能需要编写一个脚本来将旧数据从一个数据库转换为新数据。

# couchdb - CouchDB：按帐户 ID 列表过滤并按日期排序

> ID：10588889
> 
> 赞同：0
> 
> 时间：2012-05-14T18:23:02.940
> 
> 标签：couchdb

尝试从特定帐户列表中检索事件列表（使用帐户 ID）并按日期对这些事件进行排序。

这是我当前的地图功能：

```
function(doc) {
   if (doc.doc_type == 'event' && doc.account_id) {
      emit([doc.date_start,doc.account_id],doc);
   }
} 
```

当在 Futon 中为所有帐户运行时，这会输出正确的数据，但是，我不清楚如何构建我的请求查询，或者我是否需要修改我的 map 函数来完成这个？重要的是事件在指定的帐户之一中，并且事件日期按顺序（降序）排序。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-05-15T06:26:32.453

你有两个选择：

*   对每个帐户进行查询，并在客户端合并结果：

    ```
    function(doc) {
      if (doc.doc_type === 'event' && doc.account_id) {
        emit([doc.account_id, doc.date_start], 1);
      }
    } 
    ```

    使用（*正确的 url 编码*）`?include_docs=true&startkey=["ACCOUNT_ID"]&endkey=["ACCOUNT_ID", {}]`查询`account_id`. 合并既快速又简单，因为结果已经按日期排序。

*   做一个查询，并在客户端对结果进行排序：

    ```
    function(doc) {
      if (doc.doc_type === 'event' && doc.account_id) {
        emit(doc.account_id, 1);
      }
    } 
    ```

    用 查询`?include_docs=true&keys=["ACCOUNT_ID1", "ACCOUNT_ID2", ...]`。排序会变慢，因为结果是按`account_id`.

只有测试会告诉您什么是您的用例的最佳选择。

# javascript - pinterest 启发的仪表板布局

> ID：10588897
> 
> 赞同：2
> 
> 时间：2012-05-14T18:23:40.663
> 
> 标签：javascript, css, django, api, twitter-bootstrap

周末我们在瑞典举办了一场大型黑客马拉松，几周前我向组织者提出的建议是为 instagram 创建一个受 pinterest 启发的网络应用程序，因为他们没有很大的网络存在。

我正在使用 twitter bootstrap 轻松创建布局，并想知道如何完善该 pinterest 类型的布局？

这是我正在运行的循环的示例。

```
{% for obj in images %}
    <div class='span3'>
        <div class='thumbnail'>
            <img src="{{ obj.images.low_resolution.url }}" href="{% url dashboard_get_media obj.id %}" data-toggle="modal" data-target="#myModal"/><br />
            <div class='social-items'>
                ...
            </div>
            <br />
            <div class='clearfix'></div>
            <div class='comment'>
                ...
            </div>
            <div class='clearfix'></div>
            {% for comment in obj.comments %}
                ...
                <div class='clearfix'></div>
            {% endfor %}
        </div>
        <br />
    </div>
{% endfor %} 
```

非常感谢您的帮助。

地址是[http://instadashapp.com/](http://instadashapp.com/)

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2012-05-14T18:29:03.253

[Masonry javascript 插件](http://vanilla-masonry.desandro.com/)是专门为创建一个尽可能多地填充空白的内容网格而编写的，如果您不反对包含另一个插件来满足您的需求。

# formatting - 使用 NP++ 格式化代码

> ID：10588899
> 
> 赞同：1
> 
> 时间：2012-05-14T18:23:46.263
> 
> 标签：formatting, editor, notepad++

有没有办法根据记事本++中的语言格式化代码？我喜欢这个编辑器的轻量级，语法高亮也很棒。但我希望能够按 CTRL+F 或其他东西，让所有东西都排列整齐，就像在一些更大的编辑器中一样。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-05-14T19:26:09.780

有一些插件可以格式化源代码。检查插件 -> 插件管理器 -> 显示插件管理器。

# javascript - 调用原型的重写方法，然后调用下一个原型的重写方法错误

> ID：10588907
> 
> 赞同：1
> 
> 时间：2012-05-14T18:24:09.667
> 
> 标签：javascript, prototypal-inheritance

我正在尝试覆盖对象的方法，但仍使用`Object.getPrototypeOf()`. 这在第一次时效果很好，但是如果该方法被多次覆盖，则会出现问题。

此代码导致堆栈溢出：

```
A =
{
   blurg: function()
   {
      puts('hey there')
   }
}

B = (function buildB(){
   var obj = Object.create(A)

   obj.blurg = function()
   {
      Object.getPrototypeOf(this).blurg.apply(this, arguments)

      puts('hai!!!!')
   }

   return obj
})()

b = (function buildb(){
   var obj = Object.create(B)

   obj.blurg = function()
   {
      Object.getPrototypeOf(this).blurg.apply(this, arguments)

      puts('bye bye')
   }

   return obj
})()

b.blurg() 
```

[jsFiddle](http://jsfiddle.net/donut2d/QpAFy/)

问题是我想用当前对象调用原型的方法`this`。当该方法执行相同操作时，这会导致问题。

我会以错误的方式解决这个问题吗？有没有办法创建一个辅助函数来确保正确的原型被拉起？我有点不知所措。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-05-14T19:04:59.677

问题是，在 JavaScript 中，本质上`this`总是指代原型链中自下而上的对象实例，因此当您在像上面这样的层次结构中覆盖方法时，`this.prototype.someMethod()`指的是对象实例的确切基类，它不会当您最多有两级层次结构时似乎是一个问题，但是当您定义三级或更多层次结构时，递归是不可避免的！就是这样：

```
A: grand super class
B: super class - inherits from A (B.prototype = A)
C: class - inherits from B (C.prototype = B)

a: instance of A (defines someMethod)
b: instance of B (defines someMethod, calls A.someMethod through Object.getPrototypeOf(this))
c: instance of C (defines someMethod, calls B.someMethod through Object.getPrototypeOf(this)) 
```

被调用时`b.someMethod`，可以成功调用A的someMethod（`Object.getPrototypeOf(this)`被b调用时返回A）

然而，当`c.someMethod`被调用时，它首先调用`b.someMethod`，然后调用，`b.someMethod`因为`Object.getPrototypeOf(this)`当被 c 调用时总是返回 B！这就是发生堆栈溢出的地方。

要解决此问题，请尝试在定义新子类时存储基类引用，避免`this`在调用超类方法时使用：

```
A =
{
    blurg: function () {
        console.log('hey there')
    }
};

B = (function buildB() {
    var obj = Object.create(A);
    var base = Object.getPrototypeOf(obj);

    obj.blurg = function () {
        base.blurg.apply(this, arguments);
        console.log('hai!!!!')
    }

    return obj
})();

C = (function buildb() {
    var obj = Object.create(B);
    var base = Object.getPrototypeOf(obj);

    obj.blurg = function () {
        base.blurg.apply(this, arguments);
        console.log('bye bye');
    }

    return obj
})();

C.blurg(); 
```

# rdf - RDF 验证一直报错？

> ID：10588908
> 
> 赞同：2
> 
> 时间：2012-05-14T18:24:11.510
> 
> 标签：rdf

每当我尝试在以下位置验证 rdf 文件时，我都会收到此错误

[.rdf 文件](http://awmarmo.net46.net/svu.rdf)

它出什么问题了 ？请帮忙 。

![在此处输入图像描述](../Images/a6e6886daffed37416d3c7673136ccf5.png)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-05-14T18:52:41.100

这不是一个有效的 RDF/XML 文件。此文件中的每一行都以行号开头。这可能是因为您从某个地方复制粘贴了它。这些行号在 RDF/XML 中是不允许的，你必须去掉它们。

可能还有另一个问题会导致编码/UTF-8 错误。当文件中有特殊字符并且不使用 UTF-8 编码保存它时，通常会发生这种情况。但是先用行号修复错误，然后这会更清楚。

另一个不相关`xmlns:u="http://awmarmo.net46.net/Schema.rdf"`的问题：URL 末尾缺少一个散列“<code>#”。RDF 中的命名空间 URI 基本上总是以斜杠“<code>/”或散列“<code>#”结尾。如果你忘记了它们，事情就会破裂。

# objective-c - 在 NSHTTPCookieStorage 中设置 cookie

> ID：10588909
> 
> 赞同：0
> 
> 时间：2012-05-14T18:24:16.950
> 
> 标签：objective-c, nshttpcookie

我正在尝试从 NSHTTPCookieStorage 获取 cookie 并将其用于我的应用程序中的另一个 URL。我正在从 NSHTTPCookieStorage 复制一个 cookie，然后使用复制的 cookie 在 NSHTTPCookieStorage 中为不同的 URL 设置 cookie。我正在尝试遵循代码，但是当我打印出另一个 URL 的 cookie 时，没有。

```
 // authCookie is a cookie already in NSHTTPCookieStorage.
    NSURL *searchURL = [NSURL URLWithString:searchURLString];
    NSDictionary *authCookieProperties = [[[authCookie properties] copy] autorelease];
    NSMutableDictionary *cookieProperties = [NSMutableDictionary dictionaryWithDictionary:authCookieProperties];

    [cookieProperties setObject:searchURL forKey:NSHTTPCookieDomain];
    [cookieProperties setObject:searchURL forKey:NSHTTPCookieOriginURL];
    NSHTTPCookie *searchCookie = [NSHTTPCookie cookieWithProperties:cookieProperties];
    [sharedHTTPCookieStorage setCookie:searchCookie];
    [sharedHTTPCookieStorage setCookies:[NSArray arrayWithObject:searchCookie] 
                                 forURL:searchURL 
                        mainDocumentURL:nil];

    NSLog(@"Cookies for search = %@", [sharedHTTPCookieStorage cookiesForURL:searchURL]);
    NSLog(@"All Cookies = ");
    NSHTTPCookieStorage *cookieJar = [NSHTTPCookieStorage sharedHTTPCookieStorage];
    for (NSHTTPCookie *cookie in [cookieJar cookies]) {
        NSLog(@"%@", cookie);
    }
    /*
    Console Output (With URL and cookie values hidden):
    Cookies for search = ()
    All Cookies = 
    <NSHTTPCookie version:0 name:"auth_token" value:"COOKIEVALUE" expiresDate:(null) created:2001-01-01 00:00:01 +0000 (1) sessionOnly:TRUE domain:"<search_url>" path:"/" isSecure:FALSE>
    <NSHTTPCookie version:0 name:"auth_token" value:"COOKIEVALUE" expiresDate:(null) created:2012-05-14 17:59:36 +0000 (3.58711e+08) sessionOnly:TRUE domain:"<URL_of_auth_cookie>" path:"/" isSecure:FALSE>
    */ 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-05-28T13:26:50.837

如果您在新 cookie 中提供的值足够好，则必须保持标签，因为根据 Apple 参考，如果初始化值以任何特定方式无效，它应该返回 nil。您可以在此处的此[链接](https://stackoverflow.com/a/5955135/1351911)中进一步查看。它有一种从头开始创建 cookie 的好方法！

# nlp - 虚假评论数据集

> ID：10588912
> 
> 赞同：5
> 
> 时间：2012-05-14T18:24:43.957
> 
> 标签：nlp, spam, review, corpus

互联网上有通常包含垃圾邮件的数据集，但我需要带有虚假评论的数据集来进行一些研究，但我找不到它们。谁能给我关于在哪里可以获得虚假评论数据集的建议？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2012-05-18T01:06:14.757

我们的数据集可在我的康奈尔主页上找到：[http ://www.cs.cornell.edu/~myleott/](http://www.cs.cornell.edu/~myleott/)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-05-14T22:38:39.653

最近的 ACL 论文，作者在其中编译了这样一个数据集：

```
Finding Deceptive Opinion Spam by Any Stretch of the Imagination
Myle Ott, Yejin Choi, Claire Cardie, Jeffrey T. Hancock 
```

您也许可以在参考资料中找到一些东西。或者，您可以邮寄作者并检查数据是否公开可用。

# c# - Windows Phone - 访问相机需要 ISV 相机功能

> ID：10588920
> 
> 赞同：0
> 
> 时间：2012-05-14T18:24:58.400
> 
> 标签：c#, windows, windows-phone-7

我正在构建一个使用相机的 Windows Phone 应用程序。我有代码：

```
 private void MainPage_Loaded(object sender, RoutedEventArgs e)
 {

 if ((PhotoCamera.IsCameraTypeSupported(CameraType.Primary) == true) ||
     (PhotoCamera.IsCameraTypeSupported(CameraType.FrontFacing) == true))  {
     // Initialize the default camera.
     _photoCamera = new Microsoft.Devices.PhotoCamera();

     //Event is fired when the PhotoCamera object has been initialized
     _photoCamera.Initialized += new EventHandler<Microsoft.Devices.CameraOperationCompletedEventArgs>(OnPhotoCameraInitialized);

      //Set the VideoBrush source to the camera
      viewfinderBrush.SetSource(_photoCamera);
  }
  else {
      // The camera is not supported on the device.
      this.Dispatcher.BeginInvoke(delegate()  {
      // Write message.
          txtDebug.Text = "A Camera is not available on this device.";
      });

  }

}

private void OnPhotoCameraInitialized(object sender, CameraOperationCompletedEventArgs e) {
    int width = Convert.ToInt32(_photoCamera.PreviewResolution.Width);
    int height = Convert.ToInt32(_photoCamera.PreviewResolution.Height);
} 
```

而且我不断收到例外： **“访问相机需要 ISV 相机功能。”**

我有一个`Lumia 900`，并且我知道它运行相机`APIs`（示例表单 MS 工作正常）。但是当我把这段代码放到我的应用程序中时，我得到了这个异常。有谁知道会发生什么？我是个好人`C#`，但 Windows Phone 对我来说还是很新的。

非常感谢！布雷特

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2012-05-14T18:42:30.513

**解决了**：我必须添加以下行：

```
<Capability Name="ID_CAP_ISV_CAMERA"/> 
```

到我的`WMAppManifent.xml`档案。

# javascript - 从页脚加载带有 Javascript 的 JQuery

> ID：10588921
> 
> 赞同：0
> 
> 时间：2012-05-14T18:24:58.540
> 
> 标签：javascript, jquery

**如果您想直截了当，这是我的问题：** 有没有办法调用特定脚本以首先在 javascript 中加载？

**更多详情，请阅读以下内容：**

我有一个从我的 HTML 底部加载的 javascript 文件`<body>`。不幸的是，头部没有JQuery，所以我必须通过这个javascript文件添加它。

我需要做的是添加一个 JQuery 灯箱插件。

我的问题是，当我加载页面时，有时 JQuery 不是加载的第一件事。所以我收到错误“jQuery 未定义”。然后，这将为插件中的未定义方法引发更多错误。

这不会一直发生，只是有时会发生。这让我认为这是一个加载/操作顺序问题。

有什么办法可以保证我的 JQuery 脚本是第一个加载的吗？

这是我的一些 javascript 文件。

```
//Get head element
var head = document.getElementsByTagName("head")[0];

//Create and insert JQuery
var jquery = document.createElement('script');
jquery.type = 'text/javascript';
jquery.src = 'http://image.iloqal.com/lib/fe6b/m/1/jquery.1.7.2.js';

head.insertBefore(jquery,head.childNodes[4]);

function thescripts() { 

    var fancybox = document.createElement('script');
    fancybox.type = 'text/javascript';
    fancybox.src = 'http://image.iloqal.com/ilejquery.fancybox-1.3.4.pack.js';
    head.appendChild(fancybox);

    var thebody = document.getElementsByTagName('body')[0];

    thebody.appendChild(thediv);
    thediv.appendChild(theimg);

    //Run fancybox
    thebody.onload = function() {

    $('#lightbox').ready(function() {
        $("#lightbox").fancybox().trigger('click');
    });
}
};
 if(jquery.attachEvent){
     jquery.attachEvent("onload",thescripts());
} else {
     jquery.onload = thescripts();  
} 
```

任何帮助表示赞赏！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-05-14T18:32:52.270

试试这个。在从页脚调用的 javascript 文件中添加这段代码。

```
<script type="text/javascript">

if(typeof jQuery == 'undefined'){
        document.write('<script type="text/javascript" src="http://ajax.aspnetcdn.com/ajax/jQuery/jquery-1.7.1.min.js"></'+'script>');
  }

</script> 
```

如果未加载，这将包括 jquery。我认为这将解决您的问题。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-05-14T18:54:48.527

使用`$(function() {...do your stuff here...});`是确保在执行脚本之前加载 jQuery 的方法，但你可能会让自己更难并执行以下操作：

```
thebody.onload = function() {
   RunMyjQuery();
}

function RunMyjQuery() {
    if (typeof $ === 'undefined') {
         setTimeout(RunMyjQuery, 500);
    }else{
        $('#lightbox').ready(function() {
            $("#lightbox").fancybox().trigger('click');
        });
    }
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-05-14T18:29:11.553

你`thescripts`马上打电话，虽然你尽量不打电话。用这个：

```
jquery.onload = thescripts; // notice no parentheses 
```

而且，你的`thebody.onload`策略也行不通。改用`$(document).ready`：

```
$(document).ready(function{
    $('#lightbox').ready(function() {
        $("#lightbox").fancybox().trigger('click');
    });
}); 
```

# html - 如何显示 div 内联。html

> ID：10588923
> 
> 赞同：-1
> 
> 时间：2012-05-14T18:25:02.037
> 
> 标签：html, css

我在页面上有很多这样的 div：

![在此处输入图像描述](../Images/db5fc1d54437a0848e5381c7ef1d27ac.png)

我如何可以将这些图像内联以填充

这是我的来源

```
<div id="ranks_content">
    <img src="/Ranks/GetRankImage/1" alt="Recruit" class="rank_picture"/>
    <img src="/Ranks/GetRankImage/2" alt="Apprentice " class="rank_picture"/>
    <img src="/Ranks/GetRankImage/3" alt="Apprentice " class="rank_picture"/>
    <img src="/Ranks/GetRankImage/4" alt="Private " class="rank_picture"/>
    <img src="/Ranks/GetRankImage/5" alt="Private " class="rank_picture"/>
    <img src="/Ranks/GetRankImage/6" alt="Copral " class="rank_picture"/>
    <img src="/Ranks/GetRankImage/7" alt="Copral " class="rank_picture"/>
    <img src="/Ranks/GetRankImage/8" alt="Sergeant " class="rank_picture"/>
    <img src="/Ranks/GetRankImage/9" alt="Sergeant " class="rank_picture"/>
    <img src="/Ranks/GetRankImage/10" alt="Sergeant " class="rank_picture"/>
    <img src="/Ranks/GetRankImage/11" alt="Gunnery Sergeant " class="rank_picture"/>
    <img src="/Ranks/GetRankImage/12" alt="Gunnery Sergeant " class="rank_picture"/>
    <img src="/Ranks/GetRankImage/13" alt="Gunnery Sergeant " class="rank_picture"/>
    <img src="/Ranks/GetRankImage/14" alt="Gunnery Sergeant " class="rank_picture"/>
    <img src="/Ranks/GetRankImage/15" alt="Lieutenant " class="rank_picture"/>
    <img src="/Ranks/GetRankImage/16" alt="Lieutenant " class="rank_picture"/>
    <img src="/Ranks/GetRankImage/17" alt="Lieutenant " class="rank_picture"/>
    <img src="/Ranks/GetRankImage/18" alt="Lieutenant " class="rank_picture"/>
    <img src="/Ranks/GetRankImage/19" alt="Captain " class="rank_picture"/>
    <img src="/Ranks/GetRankImage/20" alt="Captain " class="rank_picture"/>
    <img src="/Ranks/GetRankImage/21" alt="Captain " class="rank_picture"/>
    <img src="/Ranks/GetRankImage/22" alt="Captain " class="rank_picture"/>
    <img src="/Ranks/GetRankImage/23" alt="Major " class="rank_picture"/>
    <img src="/Ranks/GetRankImage/24" alt="Major " class="rank_picture"/>
    <img src="/Ranks/GetRankImage/25" alt="Major " class="rank_picture"/>
    <img src="/Ranks/GetRankImage/26" alt="Major " class="rank_picture"/>
    <img src="/Ranks/GetRankImage/27" alt="Commander " class="rank_picture"/>
    <img src="/Ranks/GetRankImage/28" alt="Commander " class="rank_picture"/>
    <img src="/Ranks/GetRankImage/29" alt="Commander " class="rank_picture"/>
    <img src="/Ranks/GetRankImage/30" alt="Commander " class="rank_picture"/>
    <img src="/Ranks/GetRankImage/31" alt="Colonel " class="rank_picture"/>
    <img src="/Ranks/GetRankImage/32" alt="Colonel " class="rank_picture"/>
    <img src="/Ranks/GetRankImage/33" alt="Colonel " class="rank_picture"/>
    <img src="/Ranks/GetRankImage/34" alt="Colonel " class="rank_picture"/>
    <img src="/Ranks/GetRankImage/35" alt="Brigadier " class="rank_picture"/>
    <img src="/Ranks/GetRankImage/36" alt="Brigadier " class="rank_picture"/>
    <img src="/Ranks/GetRankImage/37" alt="Brigadier " class="rank_picture"/>
    <img src="/Ranks/GetRankImage/38" alt="Brigadier " class="rank_picture"/>
    <img src="/Ranks/GetRankImage/39" alt="General " class="rank_picture"/>
    <img src="/Ranks/GetRankImage/40" alt="General " class="rank_picture"/>
    <img src="/Ranks/GetRankImage/41" alt="General " class="rank_picture"/>
    <img src="/Ranks/GetRankImage/42" alt="General " class="rank_picture"/>
</div> 
```

编辑：我使用 CSS3，这是我想如何显示这些图像的示例

![在此处输入图像描述](../Images/05f8f6df17efd311290c929f20fdfab1.png)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-05-14T18:27:29.073

这会好吗？

只需设置 img 宽度：

[http://jsfiddle.net/7WrUn/2/](http://jsfiddle.net/7WrUn/2/)

```
.rank_picture
{
    width:100px;
}​ 
```

## 编辑

查看增强版：http: [//jsfiddle.net/7WrUn/2/](http://jsfiddle.net/7WrUn/2/)

![在此处输入图像描述](../Images/7768cd5f4c22840083f5c8b1f3c2251f.png)

ps：我一直在添加一些 jQuery，以便您看到最终结果。

我的事情你显示 alt 作为标题。但是在我的小提琴中-您会看到两次-因为我没有任何图像。

如果你有，你会看到他们一次 + 价值。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-05-14T18:54:29.820

查看您的第二张图片，我制作了一个小提琴示例，以更好地说明如何实现您的最终目标：

请参阅[小提琴示例！](http://jsfiddle.net/zuul/wVs8U/)

**HTML 结构**

```
<div id="ranks_content" class="clearfix">
  ...
  <div>
    <span>Commander</span>
    <img alt="" src="path_to_image.png" width="64" height="64">
    <span>5.0</span>
  </div>
  ...
</div> 
```

**CSS 让它发生**

```
/* not needed, used just for the demo */
body {
  background-color: #F2F2F2;
}
#ranks_content {
  margin: 0 auto;background-color: #FFF;
}

/* the necessary HTML starts here */
#ranks_content > div {
    padding: 6px;
    text-align: center;
    float: left;
}
#ranks_content > div > span {
    display: block;
    font-size: 11px;
}
#ranks_content > div > img {
    margin: 0 auto;
}

/* helpers */
.clearfix:before,
.clearfix:after  {
  content: '\0020';
  display: block;
  overflow: hidden;
  visibility: hidden;
  width: 0;
  height: 0;
}
.clearfix:after {
  clear: both;
}
.clearfix {
  zoom: 1;
} 
```

![在此处输入图像描述](../Images/bd0ef5384c47be5760d35c1967ebcd00.png)

**笔记：**

由于您正在请求有关如何定位图像的帮助，但您的第二张图像显示您将使用一些文本，因此最好的方法是将每个图像和相关文本包装在`div`. 将浮动`div`到左侧将允许图像并排保持。

# python - 从html页面中提取特定内容

> ID：10588930
> 
> 赞同：0
> 
> 时间：2012-05-14T18:25:29.337
> 
> 标签：python

假设我有一个 html 页面源，例如：

```
<p><font face="Arial" color="#400040"><small><strong>

<a href="some_link">description</a>: </strong>some text.</small></font></p> 
```

我想只提取“描述部分？我该怎么做。我认为有一种非常pythonic的方式来做到这一点。谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-05-14T18:29:54.767

获取[BeautifulSoup](http://www.crummy.com/software/BeautifulSoup/)。然后：

```
from BeautifulSoup import BeautifulSoup
soup = BeautifulSoup(your_text)
description = soup.find('a').string 
```

您可能需要修改最后一行以唯一标识您的 a 标签。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-05-14T18:31:03.813

[您可以使用 BeautifulSoup，请参阅文档](http://www.crummy.com/software/BeautifulSoup/bs4/doc/#quick-start)中的此示例：

```
from bs4 import BeautifulSoup
html_doc = '''<p><font face="Arial" color="#400040"><small><strong>

<a href="some_link">description</a>: </strong>some text.</small></font></p>
'''
soup = BeautifulSoup(html_doc)
for link in soup.find_all('a'):
    print(link.get('href')) 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-05-14T18:28:59.353

使用[Beautifulsoup](http://www.crummy.com/software/BeautifulSoup/)。

```
>>> from BeautifulSoup import BeautifulSoup
>>> html = '<p><font face="Arial" color="#400040"><small><strong><a href="some_link">description</a>: </strong>some text.</small></font></p>'
>>> soup = BeautifulSoup(html)
>>> soup.find('a', text=True)
u'description' 
```

如果您有多个标签，很可能是这种情况，您可以这样做：

```
>>> for link in soup.findAll('a'):
...     print link.text 
```

# javascript - 如何在使用 eval() 评估 JavaScript 时将回调函数定义作为参数传递？

> ID：10588931
> 
> 赞同：1
> 
> 时间：2012-05-14T18:25:32.880
> 
> 标签：javascript, gwt

我有一个存储 JavaScript 的 json 对象说

```
 var jsonObj = {
      "js": "var x=1;\n   callback(x);"
    } 
```

现在要执行这个 JavaScript，我需要为回调提供一个实现。假设我们的回调只打印值 x。

那么我应该如何使用 jsonObj.js 进行调用，以便给定的 javascript 执行并打印 x 的值（回调打印值）。

我尝试了 eval 函数，但要么我的语法错误，要么这里根本没有使用 eval。

任何帮助表示赞赏。谢谢！！

注意：如果有帮助，我实际上是在使用 gwt 编写一个 firefox 插件。这种平静的代码是作为原生 JavaScript 函数编写的。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-05-14T18:33:00.943

假设您要传入`callback`，您将使用`Function`构造函数而不是`eval`，并定义参数。

```
var jsonObj = {
  "js": "var x=1;\n   callback(x);"
};

var f = Function('callback', jsonObj.js); 
```

然后你可以传递函数参数：

```
f(function(n) { alert(n); }); // 1 
```

[http://jsfiddle.net/HWCVD/](http://jsfiddle.net/HWCVD/)

* * *

构造`Function`函数被设计成传递给它的最后一个参数是函数的主体，而前面的所有参数都是函数的参数。

因此，如果要添加其他参数，只需将它们提供给`Function`构造函数即可。

```
var jsonObj = {
  "js": "var x=y + 1;\n   callback(x);"
};

var f = Function('y', 'callback', jsonObj.js); 
```

然后传递参数：

```
//  v-"y"
//  v
  f(2, function(n) { alert(n); }); // 3
//         ^
//         ^-"callback" 
```

[http://jsfiddle.net/HWCVD/16](http://jsfiddle.net/HWCVD/16)

# ios - 为什么 twitter 列表 API 没有返回正确数量的结果？

> ID：10588932
> 
> 赞同：0
> 
> 时间：2012-05-14T18:25:36.047
> 
> 标签：ios, twitter

我正在使用 twitter List API 从我添加到列表中的一组帐户中获取推文。但是，我注意到由于某种原因，我在 Twitter 的响应中没有收到正确数量的推文。这是我的网址

```
https://api.twitter.com/1/lists/statuses.xml?list_id=68707107&per_page=30 
```

我显然要求那里有 30 个结果，但是如果您只是在网络浏览器中输入它，您会看到它不会返回 30 个结果。有人知道为什么吗？

谢谢！！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-05-14T19:29:35.343

per_page 属性是**“最高”**值。如果您使用 since_id，您可能会得到更好的结果。正如您可以在文档中阅读的那样，不推荐使用 api 中的页面。使用 api 中的 since_id 和 max_id 参数处理您的解决方案。

检查[https://dev.twitter.com/docs/working-with-timelines](https://dev.twitter.com/docs/working-with-timelines)

检查这个答案：[GET lists/statuses per_page 返回意外结果](https://stackoverflow.com/questions/9645323/get-lists-statuses-per-page-returning-unexpected-results)

Twitter 可能会将请求中的推文数量限制为 20 条，因此您可以尝试下载 20 条，然后再加载下 10 条。

# sql - 使用结构变体的有序时间序列数据/股票市场数据

> ID：10588933
> 
> 赞同：1
> 
> 时间：2012-05-14T18:25:38.027
> 
> 标签：sql, database, database-design, nosql, time-series

我正在寻求一些关于将时间序列信息组织到数据库中的建议。我当前的实现是 PostgreSQL，所有符号都有一个表。获取自定义信息很慢，但很容易附加。根据[此处](https://dba.stackexchange.com/questions/7634/timeseries-sql-or-nosql)的信息，我想通过为每个符号创建一个单独的表来复制数据库的结构。在仔细考虑之后，我意识到根据某些标准查询多个符号对我来说有点困难，例如：

```
SELECT * FROM "all_symbols" WHERE closePrice >= 50 
```

因为我需要以某种方式组合这些表进行搜索（这可能比我想象的要容易得多）。由于我在单独的表中记录了每个时间帧每个符号的一些统计分析（如 stddev），因此我还会将表的数量增加一些不切实际的数量。

我的目标是拥有快速高效的数据库，我可以在其中以任何可能的方式读取和组合数据以进行分析和研究。

差点忘了提到我正在研究开源实现。

先感谢您。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-12-11T18:38:09.333

看看 GitHub 上的这个项目，它是一个基于 Microsoft SQL Server 2012 之上的免费开源市场数据数据库：

[http://github.com/kriasoft/market-data](http://github.com/kriasoft/market-data)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-12-11T18:43:10.110

在 上放一个索引`closePrice`，并使用 between 代替`>=`：

```
SELECT * FROM all_symbols
WHERE closePrice between 50 and <some large value> 
```

单边范围通常不使用索引，但在之间应该使用索引。

# iphone - 使用按钮设置 AVAudioPlayer 音量

> ID：10588934
> 
> 赞同：0
> 
> 时间：2012-05-14T18:25:39.900
> 
> 标签：iphone, ios, avfoundation, avaudioplayer

我到处搜索，但找不到问题的答案。

我在我的应用程序上播放多种声音，并让用户使用按钮调节音量。因此，如果用户愿意，他可以玩 0.5 音量。所以我有这个代码：

```
NSString *path = [[NSBundle mainBundle] pathForResource:@"Orchestra" ofType:@"mp3"];
theOrchestras = [[AVAudioPlayer alloc] initWithContentsOfURL: [NSURL fileURLWithPath: path] error: NULL];
[theOrchestras play]; 
```

并减少音量：

```
- (IBAction) volumeReduced  {
    theOrchestras.volume = 0.5;
} 
```

播放声音时音量减小，没问题。但是当声音停止并再次播放时，音量总是回到 1。

为了解决这个问题，我尝试将卷保存为整数，但由于某种原因，该值始终为 0，我无法使其工作：

.m

```
 int64_t * volumeSaved; 
```

。H

```
- (IBAction) volumeReduced  {
    volumeSaved = .5;
}

NSString *path = [[NSBundle mainBundle] pathForResource:@"Orchestra" ofType:@"mp3"];
theOrchestras = [[AVAudioPlayer alloc] initWithContentsOfURL: [NSURL fileURLWithPath: path] error: NULL];
theOrchestras.volume = volumeSaved;
[theOrchestras play]; 
```

但是现在音频总是以 0 音量播放，静音。

有没有办法用按钮做到这一点？

谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-05-14T18:31:37.793

您声明`volumeSaved`为指向整数而不是整数的指针，但随后将其分配给它，就像它是整数一样。这是一个奇怪的地方。

但是您真正的问题是 in 的属性[`volume`是](http://developer.apple.com/library/mac/documentation/AVFoundation/Reference/AVAudioPlayerClassReference/Reference/Reference.html#//apple_ref/occ/instp/AVAudioPlayer/volume)`AVAudioPlayer`a `float`，而不是 a `int64_t`。所以将类型更改为：

```
float volumeSaved; 
```

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2012-05-14T18:29:27.220

尝试使用 NSNumber 存储卷。

# debugging - 意外的运算符 [：git：在 bourne shell 脚本中的“if”条件语句

> ID：10588935
> 
> 赞同：2
> 
> 时间：2012-05-14T18:25:42.503
> 
> 标签：debugging, bash, shell, unix, sh

我通过大量[视频](http://www.youtube.com/watch?v=NhViktT-w1o&feature=plcp)观看了出色的 shell 脚本课程。既然我认为我对 Bourne shell 相当熟悉，我决定编写我的第一个 shell 脚本。

脚本目标：检查 git 工作目录是否干净。如果是这样，请将工作目录覆盖到名为`deployment`. 最后，将部署分支推送到源站。

我最终得到了这段代码：

```
#!/bin/sh

######################################################
# Deploys working directory to git deployment branch.
# Requires that the working directory is clean.
######################################################

#check if the working directory is clean
if [ git diff-index --quiet HEAD ]
then
    if [ git branch -f deployment ]
    then
        if [ git push origin deployment ]
        then
            echo
            echo "OK. Successfully deployed to git deployment branch."
            echo
            exit 0 #success
        else
            echo
            echo "Error: failed to push deployment branch to origin."
            echo
            exit 1 #failure
        fi
    else
        echo
        echo "Error: failed to create or overwrite deployment branch."
        echo
        exit 1 #failure
    fi
else
    echo
    git status #show the status of the working directory
    echo
    echo "Error: working directory is not clean. Commit your changes first..."
    echo
    exit 1 #failure
fi 
```

不幸的是，这似乎给了我一个错误：`./tools/deploygit: 9: [: git: unexpected operator`

为什么会这样？我在使用什么运算符`if [ git diff-index --quiet HEAD ]`是出乎意料的？

作为奖励，您对如何提高此脚本的效率、逻辑或可读性有任何建议或提示吗？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2012-05-14T18:28:28.023

在本声明中：

```
if [ git diff-index --quiet HEAD ] 
```

这`[`是`test`命令的别名，所以你实际运行的是......

```
if test git diff-index --quiet HEAD ] 
```

...这不是你的意思。您不需要使用`test`命令来评估命令的结果；你应该这样做：

```
if git diff-index --quiet HEAD 
```

查看该`if`命令的文档：

```
$ help if
if: if COMMANDS; then COMMANDS; [ elif COMMANDS; then COMMANDS; ]... [ else COMMANDS; ] fi 
```

该`if`语句的条件参数是*command*。通常，该`test`命令用于使其看起来像其他语言，但您可以将*任何*命令放在那里。以返回码 0 退出的事物评估为 true，其他任何事物评估为 false。

# deployment - JBoss AS 7.1 - 创建模块时如何在 module.xml 中包含所有内容

> ID：10588937
> 
> 赞同：3
> 
> 时间：2012-05-14T18:25:43.763
> 
> 标签：deployment, module, jboss7.x

我必须为 Spring 框架创建一个模块 - org.springframework。jar 很多，有没有办法说：包含这个 org/springframework/main/ 文件夹下的所有 jar？像下面的东西。

```
<?xml version="1.0" encoding="UTF-8"?>
    <module xmlns="urn:jboss:module:1.1" name="nuance.classes">
    <resources>
        <resource-root path="./*"/>
    </resources>
</module> 
```

以上似乎不起作用。有任何可用的指南/文件吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-07-31T03:48:25.423

模块系统和类加载器的文档在[这里](https://docs.jboss.org/author/display/AS7/Class+Loading+in+AS7)。

我不知道您是否可以在通配符中指定所有 JAR，但您不​​应该这样做。其中许多 JAR 将用于 JBoss AS 7 已经打包的库和 API。您可以声明对它们的依赖关系，除非您需要不同且不兼容的版本，否则您应该这样做，而不是打包 jar 的另一个副本。

您可能会发现，一旦您删除了已打包的内容或标准 API 的一部分，您将没有太多要打包的内容。以[这个 EclipseLink 模块](https://github.com/ringerc/as7-eclipselink-integration/blob/master/src/main/as7module/org/eclipse/persistence/main/module.xml)为例；它最终只剩下 EclipseLink jar 本身。（这`${ECLIPSELINK_JAR_NAME}`是因为这个项目生成一个 EclipseLink 模块作为其构建过程的一部分；最终`module.xml`包含 jar 的真实名称）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2014-04-03T11:35:59.623

为了将来参考（这个问题已经有好几年了），我正在使用以下代码：

```
<?xml version="1.0"?>
<module xmlns="urn:jboss:module:1.0" name="nuance.classes">
    <resources>
        <resource-root path="." />
    </resources>
</module> 
```

# php - 如果没有支持 memcache 的托管，使用 wordpress 瞬态是否无用？

> ID：10588941
> 
> 赞同：1
> 
> 时间：2012-05-14T18:25:59.580
> 
> 标签：php, wordpress, memcached, transient

我正在使用 wordpress 瞬态 API 来存储整个站点中的一些常用查询。

如果没有在我的主机上支持、启用和安装 memcached，这是否会提供任何性能提升？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-05-14T19:39:46.707

不，您需要一个插件来为瞬态数据的工作提供某种有益效果。但是，与 get_option / set_option 不同，瞬态至少可以被加速。

即使没有加速，你得到的只是一些有限形式的垃圾数据收集。

# sharepoint-2010 - 不使用自定义表单的内容类型

> ID：10588943
> 
> 赞同：0
> 
> 时间：2012-05-14T18:26:14.427
> 
> 标签：sharepoint-2010

我已经使用以下 xml 创建了内容类型，但它没有使用下面 xml 中指定的自定义表单。怎么了 ？

```
<?xml version="1.0" encoding="utf-8"?>
<Elements xmlns="http://schemas.microsoft.com/sharepoint/">
  <Field ID="{854DCDF4-5091-4B1E-AA31-D9DC71A29637}"
      Type="Text"
      Required="TRUE"
      DisplayName="Customer ID"
      Name="Customer-ID"
      Indexed="TRUE"
      EnforceUniqueValues="FALSE" />

  <Field ID="{7E898932-91C0-4285-A8A2-B6440BE2FDC9}"
      Type="Text"
      Required="FALSE"
      DisplayName="Customer Name"
      Name="Customer-Name" />

  <Field ID="{5168AB24-21A8-438A-8112-E82E24E180CE}"
      Type="Text"
      Required="FALSE"
      DisplayName="Country"
      Name="Country" />

  <!-- Parent ContentType: Item (0x01) -->
  <ContentType ID="0x010081e20b9903d945a8beacde43ae09f766"
               Name="Customer"
               Group="Custom Content Types"
               Description="Customer Content Type"
               Inherits="TRUE"
               Version="0">
    <FieldRefs>
      <FieldRef ID="{854DCDF4-5091-4B1E-AA31-D9DC71A29637}" />
      <FieldRef ID="{7E898932-91C0-4285-A8A2-B6440BE2FDC9}" />
      <FieldRef ID="{5168AB24-21A8-438A-8112-E82E24E180CE}" />
    </FieldRefs>
    <XmlDocuments>
      <XmlDocument NamespaceURI="http://schemas.microsoft.com/sharepoint/v3/contenttype/forms/url">
        <FormUrls xmlns="http://schemas.microsoft.com/sharepoint/v3/contenttype/forms/url">
          <New>_layouts/customer/customer.aspx</New>
          <Display>_layouts/customer/customerdisp.aspx</Display>
          <Edit>_layouts/customer/customeredit.aspx</Edit>
        </FormUrls>
      </XmlDocument>
    </XmlDocuments>
  </ContentType>
</Elements> 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-06-28T09:10:31.580

尝试将 Inherts="FALSE" 作为元素的属性

# jsp - NetBeans & JSP：如何纠正/避免 html 解析错误？

> ID：10588944
> 
> 赞同：0
> 
> 时间：2012-05-14T18:26:22.037
> 
> 标签：jsp, jakarta-ee, netbeans

查看一些遗留的源文件，我遇到了一个带有以下代码的jsp：

```
<%@page pageEncoding="UTF-8" 
        language="java"
        contentType="text/html" %>

<%-- omitted... --%>

<c:set var="abtNummer" value="0"/>

<%-- omitted... --%>

<c:set var="abtNummer" value="${abtNummer + 1}"/>
<a href="#abt${abtNummer}"> ${section}</a>

<%-- omitted... --%> 
```

NetBeans 报告该`<a href...>`元素的以下解析错误：

```
Bad value "#abt  " for attribute "href" on element "a": DOUBLE_WHITESPACE in
FRAGMENT.
Syntax of IRI reference:
Any URL. For example: '/hello', '#canvas', or 'http://example.org/'. Characters
should be represented in NFC and spaces should be escaped as '%20'. 
```

我会说 NetBeans`${abtNummer}`在实时解析期间试图解决？

两者`abtNummer`和`section`都具有有效的运行时值，实际上，代码可以工作。在阅读了几个小时的 JSP 和 EL 规范（我不是 Java EE 专家）并搜索了 NetBeans 错误之后，我确信这条线是完全合法的，并且不需要任何改进。

我正要提交一个针对 NetBeans 的错误，但我不确定这是不是一个错误：是否有任何我必须添加到此 JSP 以指示 NetBeans 不验证这些属性的动态内容？还是我只是做错了什么？

**编辑**：

我提交了一个错误：[编辑jsp片段时出现错误的html解析错误](http://netbeans.org/bugzilla/show_bug.cgi?id=212497)

* * *

使用 NetBeans 7.1 和 7.1.2 测试。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-10-04T14:42:08.260

正如我在报告的错误中提到的，您可以在以下位置配置此警告`Tools -> Options -> Editor -> Hints -> HTML Validator -> Attribute`：

![配置错误值解析警告](../Images/7d3efe98fd129172ddc5f2c2fd0341e7.png)

# drupal - drupal feeds模块csv导入错误

> ID：10588946
> 
> 赞同：1
> 
> 时间：2012-05-14T18:26:32.333
> 
> 标签：drupal, drupal-feeds

我正在尝试使用提要模块从 url 导入 CSV，我设置了所有内容，但是当我开始导入时出现以下错误：

发生 AJAX HTTP 错误。HTTP 结果代码：200 调试信息如下。路径：XXXXX StatusText：OK ResponseText：致命错误：第 149 行 XXXXX/sites/all/modules/feeds/includes/FeedsConfigurable.inc 中不支持的操作数类型

我已经将该错误追溯到此代码，特别是最后一行：

```
 public function getConfig() {
    $defaults = $this->configDefaults();
    return $this->config + $defaults;
  } 
```

知道为什么我会收到此错误吗？

我删除了默认映射，因为它们用于 RSS 提要，带有 GUID 标题等......这可能与它有关吗？那些是必需的吗？

如果输入用户设置为匿名，还有一个错误会引发错误，如此处所示[，](https://stackoverflow.com/questions/8730652/drupal-7-node-import-from-csv)这不是我的问题。

另外，这是 configdefaults()：

```
 * Return default configuration.
   *
   * @todo rename to getConfigDefaults().
   *
   * @return
   *   Array where keys are the variable names of the configuration elements and
   *   values are their default values.
   */
  public function configDefaults() {
    return array();
  } 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-05-14T18:57:54.420

看看 drupal.org/node/1213472 是否对您有帮助

# unix - uptime 命令结果是什么意思

> ID：10588948
> 
> 赞同：9
> 
> 时间：2012-05-14T18:26:43.967
> 
> 标签：unix, console, terminal

如果我通过 shell 在我的服务器上调用 uptime，我会得到如下字符串：

```
# uptime
22.23.23 up 5 days, 51 min, 3 users, load average 34.32 16.08 5.07 
```

这部分是什么意思**负载平均 34.32 16.08 5.07**究竟是什么 - 为什么是三位数？它是指三个核心还是什么？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2012-05-14T18:28:29.757

它们是过去 1、5 和 15 分钟的平均负载，它们与您的核心无关。

从手册页：

```
uptime gives a one line display of the following information.  The
current time, how long the system has been running, how many users
are currently logged on, and the system load averages for the past
1, 5, and 15 minutes. 
```

有关详细信息，请参阅[man uptime](http://cf.ccmr.cornell.edu/cgi-bin/w3mman2html.cgi?uptime%281%29)。

# shell - 删除 Shell 脚本中的部分字符串

> ID：10588951
> 
> 赞同：1
> 
> 时间：2012-05-14T18:26:50.650
> 
> 标签：shell, string-parsing

如何从 Shell 脚本中的以下数据中删除价格？我正在打印标签，不想显示价格。

**输入：**

```
Order: 12
Name: Raj K
ABC Inc
123 Main St
Edison NJ

1 Printer - $50.09
Router - $30.00
2 AirPrint - $56.10 
```

**输出**

```
Order: 12
Name: Raj K
ABC Inc
123 Main St
Edison NJ

1 Printer
Router
2 AirPrint 
```

有任何想法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-05-14T18:29:49.940

使用 sed：

```
sed '/ *- *\$[0-9]\+\.[0-9]\{2\}/s///' file 
```

^(已根据以下 Glenn 的评论对此进行了更新。)

# jira - 将自定义数据导入 Jira 问题

> ID：10588954
> 
> 赞同：1
> 
> 时间：2012-05-14T18:26:54.050
> 
> 标签：jira, jira-plugin

我正在寻找一种简单的方法来将问题中的数据显示为纯文本。基本上，我希望能够在创建问题时输入查找 ID，然后在创建问题后，它会调用我们的 Web 服务之一来检索与该 ID 相关的数据。

这不会来自另一个问题跟踪器，而是直接来自我的一个数据库。

完成此任务的最简单方法是什么？我希望工作流程是：输入 id #，点击保存，查看工单中显示的具有该 ID 的数据（不需要可编辑，只显示在工单视图中）。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-05-15T14:28:45.717

最简单的方法是创建一个在创建转换时触发的工作流函数来完成工作。在那里，您的代码可以从数据库中查询信息并将它们复制到问题本身的 JIRA 标准和自定义字段中。

然后，您可以通过针对您的问题调整编辑屏幕来防止复制字段的版本。

您还可以使用您的函数不时更新字段内容，无论是在转换时还是在触发器中。

一种选择是创建一些只读自定义字段，而不是从数据库中查询每条信息。它将阻止数据复制，但可能会很慢，并且不适用于默认字段。

# javascript - 如何为新模型禁用 Backbone.sync，并*在*用户点击保存按钮后重新启用同步

> ID：10588959
> 
> 赞同：10
> 
> 时间：2012-05-14T18:27:04.500
> 
> 标签：javascript, backbone.js

我有一个 Backbone 集合模型（以子模型作为元素）和编辑它的视图。

我希望在最初创建模型时“关闭”同步，因此在用户单击按钮*之前*永远不会调用后端，然后我想“打开”同步并调用保存根模型上的方法，以便将其保存到数据库中。一旦它保存了一个模型，它的行为就应该像一个正常的模型。

目标是避免保存，直到用户确定他对输入的内容感到满意。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2012-05-14T18:32:20.603

Backbone`sync`在转到`Backbone.sync`.

> *[Backbone.js 文档](http://backbonejs.org/#Sync)*：同步函数可以作为 Backbone.sync 全局覆盖，或者在更细粒度的级别上，通过将同步函数添加到 Backbone 集合或单个模型。

因此，您可以这样做：

```
var MyModel = Backbone.Model.extend({
    // New instances of this model will have a 'dud' sync function
    sync: function () { return false; }
});

var MyView = Backbone.View.extend({

   ...

   events : {
       'click #my-button' : 'enableSync',
       'click #my-save-button' : 'saveModel'
   },

   enableSync: function () {
       // If this view's model is still pointing to our fake sync function,
       // update it so that it references Backbone.sync going forward.
       if (this.model.sync !== Backbone.sync) {
          this.model.sync = Backbone.sync;
       }
   },

   saveModel: function () {
       // This won't actually do anything until we click '#my-button'
       this.model.save();
   }

   ...

});

var view = new MyView({ model: new MyModel() }); 
```

# python - Django中具有多个多对多关系的数据库建模

> ID：10588961
> 
> 赞同：6
> 
> 时间：2012-05-14T18:27:08.490
> 
> 标签：python, django, django-models, many-to-many, django-signals

我可能需要一些帮助来设计我的模型及其关系。

# 简短概述

*   **书**：书名*（例如“指环王”）*
*   **Tag**：与书籍相关的标签*（例如“Fantasy”、“Wizard”、“Epic Fight”）*
*   **Aspect**：与标签相关的方面，或者换句话说，当特定标签出现时用户可以评价的事物，例如：
    *   *对于标签“幻想”方面可以是“世界细节”和“时间”*
    *   *对于标签“史诗般的战斗”方面可能是“戈尔水平”和“战斗紧张”*

每个标签都可以在 Book 的多个实例中使用*（例如“指环王”和“Discworld”都有标签“Fantasy”）*。

每个方面都可以在标签的多个实例中使用*（例如“幻想”和“科幻”都具有方面“世界细节”）*。

这是一个描述性图像：

![在此处输入图像描述](../Images/af8b4cff8b44166491632593215fadbc.png)

（哇，这些都是大的）

## “你为什么需要那张额外的桌子 BookAspect？” 你可能会问？

**因为我想存储与特定书籍相关的每个方面的用户评分。**

这是这里的主要问题。我想在 Django 中对此进行建模，这就是我目前所得到的：

```
class Book(models.Model):
    title = models.CharField(max_length=100, unique=True)
    tags = ManyToManyField(Tag)
    # the following line is a workaround...
    aspects = models.ManyToManyField(Aspect, through='BookAspect')

class Tag(models.Model):
    name = models.CharField(max_length=100)
    aspects = models.ManyToManyField(Aspect)

class Aspect(models.Model):
    name = models.CharField(max_length=100)

# this class is a workaround ...
class BookAspect(models.Model):
    book = models.ForeignKey(Book)
    aspect = models.ForeignKey(Aspect)
    # this is from django-ratings
    rating = RatingField(range=5, can_change_vote=True, allow_delete=True, blank=True)

    class Meta:
        unique_together = ('book', 'aspect',) 
```

除了模型之外，我还创建了一个`m2m_changed`信号监听器`action="post_add"`：

```
@receiver(m2m_changed, sender=Book.tags.through)
def m2m_changed_book(sender, instance, action, reverse, pk_set, **kwargs):
    if action is not 'post_add' or reverse:
        return

    # iterate through all newly created tags to manually add
    # the aspects from each tag to the BookAspect table
    for tag_id in pk_set:
        aspects = Tag.objects.get(pk=tag_id).aspects.all()
        # this is annoying, i have to manually set the relations...
        for aspect in aspects:
            bookAspect = BookAspect(book=instance, aspect=aspect)
            bookAspect.save() 
```

虽然这应该可行，但我需要额外的逻辑来处理删除的标签。

但真正令人讨厌的是我必须手动添加每本书的方面关系，以便我可以存储用户评分。当然，我需要对不同书籍的同一方面进行不同的评级。

# 问题

## 1.这是正确的方法吗，我错过了什么还是没有我想的那么复杂？

## 2\. 是否可以“自动化” Book-Aspect 关系，这样我就不必手动更新关系？

## 3\. 如何在 Django 中建模？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-05-14T23:29:15.870

*   我认为它可以更简单地完成。
*   我认为，在某种程度上。
*   我会改变：

    ```
    class Book(models.Model):
      title = models.CharField(max_length=100, unique=True)
      tags = ManyToManyField(Tag) 
    ```

由于该领域与课堂`aspects`无关。`Book`

我不知道你为什么写`BookAspect`。关于用户评分，您可以执行以下操作：

```
class BookRating(models.Model):
  book = models.ForeignKey(Book)
  aspect = models.ForeignKey(Aspect)
  rating = models.RatingField()
  # Method to rate a book and check the aspect belong to one of the book's tags
  def rate(book, aspect):
    # check the aspect is related to a tag which is also related to the book
    # if so, save a new rating entry
  # You can also override the save() method to check the aspect is valid for the book 
```

# c# - 将注释放入我的 C# XML 注释块中存在的 XML 中

> ID：10588974
> 
> 赞同：0
> 
> 时间：2012-05-14T18:28:09.993
> 
> 标签：c#, xml, doxygen, xml-comments, html-help-workshop

我在 XML 注释中使用代码示例块作为一种简单的方法让用户了解 XML 的外观。这是一个非常粗略的解决方案，最终将为用户提供 xml 字符串的 XML Schema。但是，现在我将只在基于 doxygen 的文档中提供这些信息。

例如，我有这样的事情：

```
/// <example>
/// <code>
///   <!-- xml will go below this comment, but I can't display the comment! -->
/// </code>
/// </example> 
```

当我查看我的文档时，任何有注释的行都会显示为空行。

我试过用`&lt;`and转义`&gt;`，也试过用`<CDATA[<!-- comment -->]]>`, 没有成功。转义序列按原样显示，并按`CDATA`原样显示，但未显示字符数据。

我在这里错过了什么？:)

编辑——我需要澄清这不是 Intellisense 呈现信息的问题。我希望 XML 注释在由 Doxygen 呈现到 CHM 时正确显示（通过 HTML Help Workshop）。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-05-14T18:33:37.297

当您尝试使用 and 进行转义时`&lt;`，`&gt;`您是否使用了这种语法？

```
/// <example>
/// <code>
///   &lt;!-- xml will go below this comment, but I can't display the comment! --&gt;
/// </code>
/// </example> 
```

它在 IntelliSense 中工作，我看不出有任何理由为什么它不应该在其他地方工作。

![智能感知屏幕截图](../Images/c1d3bc0e8c840a2beda784a8cb88298f.png)

**编辑**：你能试试下面的版本吗？

```
/// <example>
/// <pre lang='xml'> 
///   &lt;!-- xml will go below this comment, but I can't display the comment! --&gt;
/// </pre> 
/// </example> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-05-15T09:21:25.583

我不确定您的 XML 源出现在哪里，是在函数或类的文档中吗？如果是这样，请尝试将 XML 包装在[`verbatim`](http://www.doxygen.nl/manual/commands.html#cmdverbatim)和`\endverbatim`标记中。对于以下示例

```
/** A test class with some XML in the documentation.

 \verbatim
 <example>
 <code>
   <!-- xml will go below this comment, but I can't display the comment! -->
 </code>
 </example>
 \endverbatim
*/
class Test
    ... 
```

我得到了 doxygen 输出：

![在此处输入图像描述](../Images/8d886f32dfa6be7d6ea6ad0b890b768c.png)

# jquery - 图片加载后css-template-layout中断

> ID：10588977
> 
> 赞同：0
> 
> 时间：2012-05-14T18:28:16.887
> 
> 标签：jquery, css, layout

我对[css-template-layout](http://code.google.com/p/css-template-layout/)有疑问。该插件可以帮助我将内容切入插槽。内容槽具有最大的高度，通常是一些图片。当图片完成加载我的内容 div 变大，但我的内容槽保持相同的大小。此时，内容覆盖页脚。

所以页面是这样开始的：

```
My Cool Site             
──────┬──────────────────
home  │ My favorite pics:
about │                  
pics  │ (loading)        
──────┴──────────────────
    Copyright 2012 me. 
```

但最终看起来像这样：

```
My Cool Site             
──────┬──────────────────
home  │ My favorite pics:
about │                  
pics  │ ┌┐ ┌─┐ ┌─┐       
──────┴─└┘─│@│─│#│───────
    Copyrig└─┘2└─┘ me. 
```

这是我的 CSS 的外观：

```
body { 
    margin: 0;
    padding: 0;

    display:    ".hh."
                ".nc."
                ".ff."
    * 200px minmax(500px,800px) *
    ;
    width: 100%;
    background: #DDF;   
}

#header { position: h; text-align: center; }

#content { 
    position: c;
    margin: .5em;
}

#navbar { 
    position: n;
    background: #AAD;
    margin: 0;
    padding: .5em;
}

#footer { 
    position: f; 
    text-align: center;
    font-weight: bold;
}

body::slot(n) {
    background: #AAD;
}

#header, #footer {
    background: #CCE;
} 
```

我只需通过以下方式加载 css-template：

```
$.templateLayoutShowOnReady();

$(function() {
    $.setTemplateLayout('/static/style1.css');
}); 
```

我试图做的是尝试在函数 $(window).load() 中设置/重做 templateLayout 但它没有用。

有任何想法吗？提前致谢。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-06-07T15:58:11.827

**编辑**：哎呀，刚刚注意到你的结尾句子“我试图做的是尝试在函数 $(window).load() 中设置/重做模板布局，但它没有用。” 所以我在这里解释了一些你已经知道的事情。但是这个答案仍然提供了一种可能有效的不同方法。无论如何，为了以后发现这个问题的其他人，我会留下我对你已经知道的东西的重新解释。

* * *

css-template-layout 是一个 jQuery 插件。您的代码片段使用 jQuery 的[$()](http://api.jquery.com/jquery/#jQuery3)函数`setTemplateLayout`在 DOM 加载时调用。但是 css-template-layout 没有考虑在 DOM 加载后新计算的图像高度。因此，您需要在此之后刷新模板布局。

我看到 css-template-layout[提供了这个`$.redoTemplateLayout()`方法](http://code.google.com/p/css-template-layout/#Additional_features)。尝试在加载内容中的任何图像时触发的事件中调用它。通常您会使用[.on()](http://api.jquery.com/on/)，但显然检查图像何时加载[并不简单](https://stackoverflow.com/questions/910727/jquery-event-for-images-loaded)，因此您可以使用 jQuery 插件[imagesloaded](https://github.com/desandro/imagesloaded)来提供帮助。页面上的每个图像都应该在加载时触发它们自己的事件——您不必等待所有图像加载来修复布局。我不知道是否有一个事件可以找到图像加载到足以影响布局的点，即使图像没有完全加载也是如此。如果有这样的事件，使用它。

# foursquare - API 返回疯狂的 2 字搜索结果

> ID：10588980
> 
> 赞同：1
> 
> 时间：2012-05-14T18:28:22.057
> 
> 标签：foursquare

从最近开始，API 开始返回疯狂的 2 字搜索结果。例如：

```
https://api.foursquare.com/v2/venues/search?oauth_token=XXX&query=local_edition&radius=35000&ll=37.8%2C-122.4&limit=20&intent=browse 
```

似乎只会返回匹配“离子”的东西。如果我搜索“本地”或“版本”，则预期位置是前几个结果之一。

是时候停止用下划线替换空格了吗？有一段时间，这是在搜索多个单词时获得合理结果的唯一方法。（有关更多信息，请参阅此线程：[优化 Foursquare API 搜索查询的最佳方法是什么？](https://stackoverflow.com/questions/8945377/whats-the-best-way-to-tune-my-foursquare-api-search-queries)）

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-05-14T18:44:11.590

我不确定为什么你会得到“ion”的结果，但如果你用加号或替换下划线`%20`，它似乎对我来说很好：

[https://developer.foursquare.com/docs/explore#req=venues/search%3Fquery%3Dlocal+edition%26radius%3D35000%26ll%3D37.8%252C-122.4%26limit%3D20%26intent%3Dbrowse](https://developer.foursquare.com/docs/explore#req=venues/search%3Fquery%3Dlocal+edition%26radius%3D35000%26ll%3D37.8%252C-122.4%26limit%3D20%26intent%3Dbrowse)

[https://developer.foursquare.com/docs/explore#req=venues/search%3Fquery%3Dlocal%2520edition%26radius%3D35000%26ll%3D37.8%252C-122.4%26limit%3D20%26intent%3Dbrowse](https://developer.foursquare.com/docs/explore#req=venues/search%3Fquery%3Dlocal%2520edition%26radius%3D35000%26ll%3D37.8%252C-122.4%26limit%3D20%26intent%3Dbrowse)

# android - 从 Android 检索 gps 修复中使用的卫星数

> ID：10588982
> 
> 赞同：6
> 
> 时间：2012-05-14T18:28:24.577
> 
> 标签：android, gps, locationmanager, satellite

我正在尝试检索 GPS 修复中使用的卫星数量。我已经实现了两种不同的方法，如下所示：

```
package ti.utils;

import android.app.Activity;
import android.content.Context;
import android.location.GpsSatellite;
import android.location.GpsStatus;
import android.location.Location;
import android.location.LocationListener;
import android.location.LocationManager;
import android.os.Bundle;

public class Gps {

    private static final int TWO_MINUTES = 1000 * 60 * 2;
    private static Location Location;
    public static int Satellites = -1;

    public static void StartTracking(Activity activity)
    {
        final LocationManager locationManager = (LocationManager) activity.getSystemService(Context.LOCATION_SERVICE);

        //listen for gps status changes.
        GpsStatus.Listener gpsStatusListener = new GpsStatus.Listener() {
            public void onGpsStatusChanged(int event) {
                Log("In onGpsStatusChanged event: " + event);
                if (event == GpsStatus.GPS_EVENT_SATELLITE_STATUS || event == GpsStatus.GPS_EVENT_FIRST_FIX) {
                    GpsStatus status = locationManager.getGpsStatus(null);
                    Iterable<GpsSatellite> sats = status.getSatellites();
                    // Check number of satellites in list to determine fix state
                    Satellites = 0;
                    for (GpsSatellite sat : sats) {
                        //if(sat.usedInFix())
                        Satellites++;
                    }
                    Log("Setting Satellites from GpsStatusListener: " + Satellites);
                }
            }
        };
        locationManager.addGpsStatusListener(gpsStatusListener);

        //listen for location changes.
        LocationListener locationListener = new LocationListener() {
            public void onLocationChanged(Location location) {
                // Called when a new location is found by the network location provider.
                try
                {
                    Log("Location changed! Speed = " + location.getSpeed() + " & Satellites = " + location.getExtras().getInt("satellites"));
                    boolean isBetter = isBetterLocation(location, Location);
                    if(isBetter)
                    {
                        Log("Set to new location");
                        Location = location;
                        Satellites = location.getExtras().getInt("satellites");
                        Log("Setting Satellites from LocationListener: " + Satellites);
                    }
                }
                catch(Exception exc)
                {
                    Log(exc.getMessage());
                }
            }
            public void onStatusChanged(String provider, int status, Bundle extras) {}
            public void onProviderEnabled(String provider) {}
            public void onProviderDisabled(String provider) {}
        };
        locationManager.requestLocationUpdates(LocationManager.NETWORK_PROVIDER, 0, 0, locationListener);
    }

    /** Determines whether one Location reading is better than the current Location fix
      * @param location  The new Location that you want to evaluate
      * @param currentBestLocation  The current Location fix, to which you want to compare the new one
      */
    protected static boolean isBetterLocation(Location location, Location currentBestLocation) {
        if (currentBestLocation == null) {
            // A new location is always better than no location
            return true;
        }

        // Check whether the new location fix is newer or older
        long timeDelta = location.getTime() - currentBestLocation.getTime();
        boolean isSignificantlyNewer = timeDelta > TWO_MINUTES;
        boolean isSignificantlyOlder = timeDelta < -TWO_MINUTES;
        boolean isNewer = timeDelta > 0;

        // If it's been more than two minutes since the current location, use the new location
        // because the user has likely moved
        if (isSignificantlyNewer) {
            return true;
        // If the new location is more than two minutes older, it must be worse
        } else if (isSignificantlyOlder) {
            return false;
        }

        // Check whether the new location fix is more or less accurate
        int accuracyDelta = (int) (location.getAccuracy() - currentBestLocation.getAccuracy());
        boolean isLessAccurate = accuracyDelta > 0;
        boolean isMoreAccurate = accuracyDelta < 0;
        boolean isSignificantlyLessAccurate = accuracyDelta > 200;

        // Check if the old and new location are from the same provider
        boolean isFromSameProvider = isSameProvider(location.getProvider(),
                currentBestLocation.getProvider());

        // Determine location quality using a combination of timeliness and accuracy
        if (isMoreAccurate) {
            return true;
        } else if (isNewer && !isLessAccurate) {
            return true;
        } else if (isNewer && !isSignificantlyLessAccurate && isFromSameProvider) {
            return true;
        }
        return false;
    }

    /** Checks whether two providers are the same */
    private static boolean isSameProvider(String provider1, String provider2) {
        if (provider1 == null) {
          return provider2 == null;
        }
        return provider1.equals(provider2);
    }

    private static void Log(String message) {
        if(message != null && message.length() > 0) {
            //android.util.Log.i(LCAT, message);
            org.appcelerator.kroll.common.Log.i("SygicModule", message);
        }
    }

} 
```

即使我在手机上启用了独立 GPS，也不会触发任何侦听器事件（onGpsStatusChanged 和 onLocationChanged）。我有 ACCESS_FINE_LOCATION 权限集：

```
<uses-permission android:name="android.permission.ACCESS_FINE_LOCATION"/> 
```

我下载了一个名为 GPS Status 的第 3 方应用程序，它能够正确显示卫星数量，所以我知道这不是我的 Droid X2 的问题。

有任何想法吗？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2012-05-14T19:39:19.863

这是最终工作的代码。

```
package ti.utils;

import android.app.Activity;
import android.content.Context;
import android.location.GpsSatellite;
import android.location.GpsStatus;
import android.location.Location;
import android.location.LocationListener;
import android.location.LocationManager;
import android.os.Bundle;

public class Gps {

    private static final int TWO_MINUTES = 1000 * 60 * 2;
    private static Location Location;
    public static int Satellites = -1;

    public static void StartTracking(Activity activity)
    {
        final LocationManager locationManager = (LocationManager) activity.getSystemService(Context.LOCATION_SERVICE);

        //listen for gps status changes.
        GpsStatus.Listener gpsStatusListener = new GpsStatus.Listener() {
            @Override
            public void onGpsStatusChanged(int event) {
                Log("In onGpsStatusChanged event: " + event);
                if (event == GpsStatus.GPS_EVENT_SATELLITE_STATUS || event == GpsStatus.GPS_EVENT_FIRST_FIX) {
                    GpsStatus status = locationManager.getGpsStatus(null);
                    Iterable<GpsSatellite> sats = status.getSatellites();
                    // Check number of satellites in list to determine fix state
                    Satellites = 0;
                    for (GpsSatellite sat : sats) {
                        //if(sat.usedInFix())
                        Satellites++;
                    }
                    Log("Setting Satellites from GpsStatusListener: " + Satellites);
                }
            }
        };
        locationManager.addGpsStatusListener(gpsStatusListener);

        //listen for location changes.
        LocationListener locationListener = new LocationListener() {
            @Override
            public void onLocationChanged(Location location) {
                // Called when a new location is found by the network location provider.
                /*try
                {
                    Log("Location changed! Speed = " + location.getSpeed() + " & Satellites = " + location.getExtras().getInt("satellites"));
                    boolean isBetter = isBetterLocation(location, Location);
                    if(isBetter)
                    {
                        Log("Set to new location");
                        Location = location;
                        Satellites = location.getExtras().getInt("satellites");
                        Log("Setting Satellites from LocationListener: " + Satellites);
                    }
                }
                catch(Exception exc)
                {
                    Log(exc.getMessage());
                }*/
            }
            public void onStatusChanged(String provider, int status, Bundle extras) {}
            public void onProviderEnabled(String provider) {}
            public void onProviderDisabled(String provider) {}
        };
        locationManager.requestLocationUpdates(LocationManager.GPS_PROVIDER, 0, 0, locationListener);
    }

    /** Determines whether one Location reading is better than the current Location fix
      * @param location  The new Location that you want to evaluate
      * @param currentBestLocation  The current Location fix, to which you want to compare the new one
      */
    protected static boolean isBetterLocation(Location location, Location currentBestLocation) {
        if (currentBestLocation == null) {
            // A new location is always better than no location
            return true;
        }

        // Check whether the new location fix is newer or older
        long timeDelta = location.getTime() - currentBestLocation.getTime();
        boolean isSignificantlyNewer = timeDelta > TWO_MINUTES;
        boolean isSignificantlyOlder = timeDelta < -TWO_MINUTES;
        boolean isNewer = timeDelta > 0;

        // If it's been more than two minutes since the current location, use the new location
        // because the user has likely moved
        if (isSignificantlyNewer) {
            return true;
        // If the new location is more than two minutes older, it must be worse
        } else if (isSignificantlyOlder) {
            return false;
        }

        // Check whether the new location fix is more or less accurate
        int accuracyDelta = (int) (location.getAccuracy() - currentBestLocation.getAccuracy());
        boolean isLessAccurate = accuracyDelta > 0;
        boolean isMoreAccurate = accuracyDelta < 0;
        boolean isSignificantlyLessAccurate = accuracyDelta > 200;

        // Check if the old and new location are from the same provider
        boolean isFromSameProvider = isSameProvider(location.getProvider(),
                currentBestLocation.getProvider());

        // Determine location quality using a combination of timeliness and accuracy
        if (isMoreAccurate) {
            return true;
        } else if (isNewer && !isLessAccurate) {
            return true;
        } else if (isNewer && !isSignificantlyLessAccurate && isFromSameProvider) {
            return true;
        }
        return false;
    }

    /** Checks whether two providers are the same */
    private static boolean isSameProvider(String provider1, String provider2) {
        if (provider1 == null) {
          return provider2 == null;
        }
        return provider1.equals(provider2);
    }

    private static void Log(String message) {
        if(message != null && message.length() > 0) {
            //android.util.Log.i(LCAT, message);
            org.appcelerator.kroll.common.Log.i("UtilsModule", message);
        }
    }

} 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2012-05-14T18:41:01.480

```
locationManager.requestLocationUpdates(LocationManager.NETWORK_PROVIDER, 0, 0, locationListener); 
```

应该

```
locationManager.requestLocationUpdates(LocationManager.GPS_PROVIDER, 0, 0, locationListener); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-05-14T19:02:59.463

如果您无法通过 GPS_EVENT_SATELLITE_STATUS 获取卫星数量，那么您可以让您的活动实施**NmeaListener**。

如果您实现了 NmeaListener，那么您将不得不解析在 **onNmeaReceived**中接收到的消息字符串，以便提取卫星数量。[此处](http://www.gpsinformation.org/dale/nmea.htm)描述了 NMEA 格式 。然后您可能想在 Google 上搜索“Java”+“NMEA 解析器”

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2014-06-12T19:22:10.787

我通过以下代码使其工作。 `locationManager.requestLocationUpdates(LocationManager.GPS_PROVIDER, 0, 0, new LocationUpdateHandler()); int nSatellites = location.getExtras().getInt("satellites", -1);`

`nSatellites`一旦我开始修复（`onLocationChanged`回调），就发现它 > 0。

# php - 在 PHP (1) 中打印特定的 XML 节点值

> ID：10588985
> 
> 赞同：1
> 
> 时间：2012-05-14T18:28:35.077
> 
> 标签：php, xml

我已经找到了如何使用 PHP DOM 用 PHP 字符串替换特定节点值，现在我需要将这些 XML 值打印到表单字段中。为了替换我正在使用这个 PHP 代码，也许我可以修改这个代码来打印特定的值，因为这个 XML 文件非常复杂

```
$file = "../word/document.xml";                                            
    $fp = fopen($file, "rb") or die("error");
    $str = fread($fp, filesize($file));
    $xml = new DOMDocument();                                
    $xml->formatOutput = true;
    $xml->preserveWhiteSpace = false;
    $xml->loadXML($str) or die("Error");

    $root   = $xml->documentElement;
    $fnode  = $root->childNodes->item(0);

    $ori    = $fnode->childNodes->item(1);                      
    $ori1    = $ori->childNodes->item(3);
    $ori2   = $ori1->childNodes->item(1);
    $ori3   = $ori2->childNodes->item(1);
    $ori4   = $ori3->childNodes->item(1);
    $ori5   = $ori4->childNodes->item(1);

        $wt     = $xml->createElement("w:t");
    $wtText = $xml->createTextNode("".$name." ".$surname."");
    $wt->appendChild($wtText);
        $ori4->replaceChild($wt,$ori5);
        $xml->save("../word/document.xml"); 
```

我需要达到相同的值（$ori5）并将其打印到表单字段，但我不知道该怎么做。

XML 文件可以在[这里](http://rude.su.lt/~juskevicius/redagavimui/word/document.xml)找到：

```
<w:document mc:Ignorable="w14 wp14">
    <w:body>
        <w:tbl>
            <w:tr w:rsidR="000171B5" w:rsidTr="00272F6E">
                <w:tc>
                    <w:p w:rsidR="000171B5" w:rsidRPr="00075BEA" w:rsidRDefault="000171B5" w:rsidP="000171B5">
                        <w:r w:rsidRPr="00075BEA">
                            <w:t>Vardas pavarde</w:t>
                        </w:r>
                    </w:p>
                </w:tc>
            </w:tr>
        </w:tbl>
    </w:body>
</w:document> 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-05-15T14:12:56.893

抱歉，我昨晚没能做到这一点，但我能够获得一份您的 XML 副本以供使用。以后，请仅提供您正在使用的 XML 示例。特别是因为您提供的那个是未格式化的。我花了比我回答问题更长的时间来格式化我需要的地方。大多数人会离开它而不是挖掘所有这些。这是采样后与问题相关的格式化 XML。

```
<w:document mc:Ignorable="w14 wp14">
    <w:body>
        <w:tbl>
            <w:tr w:rsidR="000171B5" w:rsidTr="00272F6E">
                <w:tc>
                    <w:p w:rsidR="000171B5" w:rsidRPr="00075BEA" w:rsidRDefault="000171B5" w:rsidP="000171B5">
                        <w:r w:rsidRPr="00075BEA">
                            <w:t>Vardas pavarde</w:t>
                        </w:r>
                    </w:p>
                </w:tc>
            </w:tr>
        </w:tbl>
    </w:body>
</w:document> 
```

使用您提供的路径（item(0)、item(1) 等...）我想出了 value `Vardas pavarde`。在上面的`W:t`元素中。我在 XML 中采取的步骤如下。

```
0   /1  /3 /1 /1/1/1
body/tbl/tr/tc/p/r/t = Vardas pavarde 
```

获取此值的更简单方法是使用 XPATH。如果您对此有任何疑问，可以在[此处](http://www.w3schools.com/xpath/xpath_syntax.asp)阅读。这是一个涉及面很广的主题，所以我只想给你我认为你正在寻找的 XPATH。如果它不完全是您要查找的内容，则必须对其进行调整，只需使用该链接即可。

```
$path = '//body/tbl/tr/tc/p/r/t'; 
```

因此，在加载 DOMDocument 后添加以下内容。

```
$xpath = new DOMXpath($xml);
$path = '//body/tbl/tr/tc/p/r/t';
$elements = $xpath->query($path); 
```

由于 XPATH 返回一个结果数组，因此您必须转储它以找到您要查找的特定索引。但在这种情况下，应该是`$elements[1]`因为在您要查找的路径之前只有一个其他元素与该路径匹配。所以...

```
$ori5 = $elements[1]; 
```

此外，您可能需要考虑使用[SimpleXML](http://us.php.net/manual/en/simplexmlelement.construct.php)来读取 XML。如果您正在编辑它，DOM 是很好的，您在这里似乎正在这样做，但是如果您需要阅读它，SimpleXML 会更直接一些。[这是](http://us.php.net/manual/en/simplexmlelement.xpath.php)将 XPATH 与 SimpleXML 结合使用的链接。希望这可以帮助！

# jquery - 滑块贷款计算器

> ID：10588987
> 
> 赞同：-2
> 
> 时间：2012-05-14T18:28:48.683
> 
> 标签：jquery, slider, calculator, helpers

我一直在努力解决这个问题并且一直在苦苦挣扎。

我正在寻找创建一个基于滑块的贷款计算器。

我希望它有 2 个滑块和 3 个由滑块位置生成的数字。- 滑块 1：贷款金额，在 50 英镑 - 400 英镑之间 - 数字框显示价值 - 滑块 2：贷款长度，在 1 - 30 之间 - 数字框显示价值 - 数字框显示价值（（滑块 1 价值 *120%）/ 365）*滑块值2

如果您能提供帮助，我将非常感谢您的意见。提前致谢

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-05-14T18:34:38.737

您可以使用 jQuery UI 库并尝试其`change`事件：

```
$(".selector").slider({
   change: function(event, ui) { 
      // do calculations here
   }
}); 
```

# ruby - 升级到最新的 Rails 版本后，assert_select 不起作用

> ID：10588988
> 
> 赞同：1
> 
> 时间：2012-05-14T18:28:49.243
> 
> 标签：ruby, ruby-on-rails-3, ruby-on-rails-3.1

我有以下 HTML 片段，我`assert_select`的不再工作（升级到最新版本的 Rails 后）：

```
<div id="content">
  <div class="container">
    <div class="foo">
      <h2><a href="/downloads/latest.zip">Latest</a></h2>
      <p>
        <a href="/downloads/latest.zip" class="button download">
          <span>Download</span>
        </a>
      </p>
    </div>
  </div>  
</div> 
```

这是断言：

`assert_select '.container a.downloadbutton[href^=/downloads]', assigns(:downloads).count`

这是错误：

`Expected exactly 1 element matching ".container a.button[href^='/downloads']", found 0.`

有人知道我在做什么错吗？

谢谢！！！五

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2013-11-01T16:21:13.307

看起来代码片段“按钮”和“下载”中的类与断言“下载按钮”中的类之间的类不匹配。也许摆脱片段中“按钮”和“下载”之间的空间会起作用。

# javascript - 带有超时的 JavaScript onKeyUp 闭包

> ID：10588994
> 
> 赞同：3
> 
> 时间：2012-05-14T18:29:12.053
> 
> 标签：javascript, timeout, closures

我试图使用闭包将 onKeyUp 事件分配给表单中的所有输入。该数组`fields`包含需要分配给它们的事件的所有字段名称。该数组包含需要 ajax 验证`ajaxFields`的字段名称（来自数组）。`fields`

```
function createEvents(fields,ajaxFields) {
    for(var x=0;x<fields.length;x++) {

        $('input[name='+fields[x]+']').keyup(function(field) { 
        //assign an onKeyUp event
            return function() {
                //some code using variable 'field' and array 'ajaxFields'
        }(fields[x]));
    }
} 
```

我希望在用户完成输入该字段后的一秒钟执行 onKeyUp 函数，每次按键启动时都会插入（onKeyUp）。这将节省大量的处理空间，更不用说 ajax 调用了。到目前为止，我正在使用这个：

```
clearTimeout(timer);
timer = setTimeout('validate()' ,1000); 
```

您可能已经注意到该函数`validate()`不存在，那是因为我不知道如何将闭包包装在命名函数中，我什至不确定我是否应该...

那么我该怎么做呢？

**编辑**：这是一个当前的[小提琴](http://jsfiddle.net/Z43Bq/1/)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-05-14T18:45:24.740

您可以（并且*应该*）将函数传递给`setTimeout`而不是字符串。

```
clearTimeout(timer);
timer = setTimeout(function(){
    // your code here
}, 1000); 
```

所以，在你的`keyup`，尝试这样的事情：

```
$('input[name='+fields[x]+']').keyup(function(field) { 
//assign an onKeyUp event
    return function() {
        var that = this,
            $this = $(this);
        clearTimeout($this.data('timeout'));
        $this.data('timeout', setTimeout(function(){
            //some code using variable 'field' and array 'ajaxFields'
            // "this" will not be your element in here, make sure to use "that" (or "$this")
        }, 1000));
    };
}(fields[x])); 
```

我将超时保存在 中`$this.data`，这样每个元素都可以有自己的超时，而不是使用全局变量。

更新演示：http: [//jsfiddle.net/Z43Bq/3/](http://jsfiddle.net/Z43Bq/3/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-05-14T18:47:52.167

这就是你的代码应该是这样的：

```
var timer;

$(document).ready(function() {
    var fields = $('.field');
    var ajaxFields = $('.ajax-field');

    createEvents(fields, ajaxFields);
});

function createEvents(fields,ajaxFields) {
    // Use jQuery's "foreach" method
    $(fields).each(function(inx, field) {
        // Bind the listener here
        $(field).keyup(function(ev) {
            // Clear timeout if necessary
            if (timer != null) clearTimeout(timer);

            // Set the timeout
            timer = setTimeout(function() {
                // Your code should here

                console.log('Fields: ', fields, '\nAjax Fields: ', ajaxFields, '\nTHE field: ', field);
            }, 1000);
        });
    });
} 
```

还要检查工作代码的小提琴：http: [//jsfiddle.net/BLyhE/](http://jsfiddle.net/BLyhE/)