# StackOverflow 问答 000767000-000767999

# java - 有没有办法从类外部修改 Java 中的“private static final”字段的值？

> ID：767008
> 
> 赞同：11
> 
> 时间：2009-04-20T05:27:03.973
> 
> 标签：java, monkeypatching

我知道这通常很愚蠢，但在阅读问题之前不要开枪。我保证我有充分的理由需要这样做:)

可以使用反射修改 Java 中的常规私有字段，但是 Java 在尝试对`final`字段执行相同操作时会引发安全异常。

我假设这是严格执行的，但我想无论如何我都会问，以防万一有人想出了一个黑客来做到这一点。

假设我有一个带有类“ `SomeClass`”的外部库

```
public class SomeClass 
{
  private static final SomeClass INSTANCE = new SomeClass()

  public static SomeClass getInstance(){ 
      return INSTANCE; 
  }

  public Object doSomething(){
    // Do some stuff here 
  }
} 
```

我本质上想对 SomeClass 进行猴子补丁，以便我可以执行我自己的`doSomething()`. 由于（据我所知）没有任何方法可以在 java 中真正做到这一点，因此我唯一的解决方案是更改 的值，`INSTANCE`以便它使用修改后的方法返回我的类版本。

本质上，我只想用安全检查包装调用，然后调用原始方法。

外部库总是用来`getInstance()`获取这个类的一个实例（即它是一个单例）。

编辑：只是为了澄清，`getInstance()`是由外部库调用的，而不是我的代码，所以只是子类化并不能解决问题。

如果我不能这样做，我能想到的唯一其他解决方案是复制粘贴整个类并修改方法。这并不理想，因为我必须让我的 fork 与库的更改保持同步。如果有人有一些更易于维护的东西，我愿意接受建议。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-04-20T08:49:33.597

有可能的。我用它来猴子补丁阻止 webapps 中类卸载的顽皮线程本地。您只需要使用反射去除`final`修饰符，然后您可以修改字段。

像这样的东西可以解决问题：

```
private void killThreadLocal(String klazzName, String fieldName) {
    Field field = Class.forName(klazzName).getDeclaredField(fieldName);
    field.setAccessible(true);  
    Field modifiersField = Field.class.getDeclaredField("modifiers");
    modifiersField.setAccessible(true);
    int modifiers = modifiersField.getInt(field);
    modifiers &= ~Modifier.FINAL;
    modifiersField.setInt(field, modifiers);
    field.set(null, null);
} 
```

周围也有一些缓存`Field#set`，所以如果一些代码在它之前运行过，它可能不一定有效....

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-20T06:36:23.227

任何 AOP 框架都可以满足您的需求

它允许您为 getInstance 方法定义运行时覆盖，从而允许您返回任何适合您需要的类。

Jmockit 在内部使用 ASM 框架来做同样的事情。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-20T05:47:17.637

如果你真的必须（尽管对于我们的问题，我建议你使用 CaptainAwesomePants 的解决方案）你可以看看[JMockIt](http://code.google.com/p/jmockit/)。尽管这旨在用于单元测试，但如果允许您重新定义任意方法。这是通过在运行时修改字节码来完成的。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-20T06:29:25.257

您应该可以使用 JNI 更改它...不确定这是否适合您。

编辑：这是可能的，但不是一个好主意。

[http://java.sun.com/docs/books/jni/html/pitfalls.html](http://java.sun.com/docs/books/jni/html/pitfalls.html)

> 10.9 违反访问控制规则
> 
> JNI 不强制执行类、字段和方法访问控制限制，这些限制可以通过使用诸如 private 和 final 等修饰符在 Java 编程语言级别表示。可以编写本机代码来访问或修改对象的字段，即使在 Java 编程语言级别这样做会导致 IllegalAccessException。JNI 的许可是一个有意识的设计决定，因为本机代码无论如何都可以访问和修改堆中的任何内存位置。
> 
> 绕过源语言级别访问检查的本机代码可能会对程序执行产生不良影响。例如，如果在实时 (JIT) 编译器对字段进行内联访问后，本机方法修改了最终字段，则可能会产生不一致。同样，本机方法不应修改不可变对象，例如 java.lang.String 或 java.lang.Integer 实例中的字段。这样做可能会破坏 Java 平台实现中的不变量。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-20T06:57:31.243

您可以尝试以下方法。注意：它根本不是线程安全的，这不适用于编译时已知的常量原语（因为它们被编译器内联）

```
Field field = SomeClass.class.getDeclareField("INSTANCE");
field.setAccessible(true); // what security. ;)
field.set(null, newValue); 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-20T05:41:47.260

我将通过承认这实际上不是对您提出的关于修改私有静态最终字段的问题的回答来作为这个答案的开头。但是，在上面提到的具体示例代码中，我实际上可以制作它以便您可以覆盖 doSomething()。您可以做的是利用 getInstance() 是公共方法和子类的事实：

```
public class MySomeClass extends SomeClass
{
   private static final INSTANCE = new MySomeClass();

   public SomeClass getInstance() {
        return INSTANCE;
   }

   public Object doSomething() {
      //Override behavior here!
   }
} 
```

现在只需调用 MySomeClass.getInstance() 而不是 SomeClass.getInstance() 就可以了。当然，这仅在您调用 getInstance() 而不是您正在使用的不可修改内容的其他部分时才有效。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-20T17:15:37.107

使用[mockito](http://code.google.com/p/mockito/)非常简单：

```
import static org.mockito.Mockito.*;

public class SomeClass {

    private static final SomeClass INSTANCE = new SomeClass();

    public static SomeClass getInstance() {
        return INSTANCE;
    }

    public Object doSomething() {
        return "done!";
    }

    public static void main(String[] args) {
        SomeClass someClass = mock(SomeClass.getInstance().getClass());
        when(someClass.doSomething()).thenReturn("something changed!");
        System.out.println(someClass.doSomething());
    }
} 
```

此代码打印“发生了一些变化！”；您可以轻松地替换您的单例实例。我的 0.02 美分。

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2009-04-20T06:45:23.643

如果没有可用的外部破解（至少我不知道），我会破解课程本身。通过添加所需的安全检查来更改代码。因此它是一个外部库，您不会定期进行更新，也不会发生太多更新。每当发生这种情况时，我都可以很高兴地重新做，因为这不是一项大任务。

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2009-04-20T16:32:01.503

在这里，您的问题是古老的依赖注入（又名控制反转）。您的目标应该是注入您的实现`SomeClass`而不是对其进行修补。是的，这种方法需要对您现有的设计进行一些更改，但出于正确的原因（在此处说出您最喜欢的设计原则）——尤其是同一个对象不应同时负责创建和使用其他对象。

我假设您使用的方式`SomeClass`有点像这样：

```
public class OtherClass {
  public void doEverything() {
    SomeClass sc = SomeClass.geInstance();
    Object o = sc.doSomething();

    // some more stuff here...
  }
} 
```

相反，您应该首先创建实现相同接口或扩展的类`SomeClass`，然后将该实例传递给，`doEverything()`以便您的类对`SomeClass`. 在这种情况下，调用的代码`doEverything`负责传入正确的实现——无论是实际的`SomeClass`还是你的猴子补丁`MySomeClass`。

```
public class MySomeClass() extends SomeClass {
  public Object doSomething() {
    // your monkeypatched implementation goes here
  }
}

public class OtherClass {
  public void doEveryting(SomeClass sc) {
    Object o = sc.doSomething();

    // some more stuff here...
  }
} 
```

# java - 用 Java 或 .NET 封装 C++ API

> ID：767009
> 
> 赞同：4
> 
> 时间：2009-04-20T05:27:46.950
> 
> 标签：java, .net, c++, interop

有没有人在 Java 或 .NET 中成功地“封装”了一个 C++ API？我有一个应用程序，它提供了用于编写插件的 C++ API。我想做的是从 .NET 或 Java 访问该 API。

我需要使用 COM，还是有更简单/更好的选择？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-20T05:56:17.850

如果您有一个非常直接的方法签名（即采用和返回原始类型的方法，例如 int、char[]、void* ... 等），那么在 .NET 中这样做是相当容易的，并且仍然可能但有点使用 JNI 在 Java 中更难。

但是，如果您的类方法使用现代 C++ 编程技术，例如 boost 共享指针和 STL 容器，那么情况就完全不同了。在这种情况下，您需要非常小心内存管理。

编辑：如果该方法具有 C++ 模板参数会更有趣，因为 C++ 模板系统与 C# 或 Java 泛型非常不同，因为它只是一个编译时机制。基本上，这意味着每次将不同的数据类型传递给模板参数时，方法或类的签名都是不同的。这使得该方法无法用 C# 或 Java 包装。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-20T05:55:22.827

我认为您可能会要求类似于[Java Native Inferface](http://en.wikipedia.org/wiki/Java_Native_Interface)它允许您调用用 C++ 等语言编写的代码。我从来没有使用过它。但你可能想检查一下。希望能帮助到你。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-20T05:50:01.560

在 Java 方面，这里有很多选项.. [这个问题](https://stackoverflow.com/questions/180784/whats-the-best-easiest-way-to-manipulate-activex-objects-in-java)实际上与您正在寻找的内容非常接近，前提是您的 API 可以装在 DLL、com 或 activex 对象中。

我个人使用 JIntegra 将 API 调用包装到 office (Word) 并直接在 Java 中使用它。它确实需要一些黑客来获得所需的功能，但我们最终使它工作。摆弄其实是在Word端，实际集成还是比较容易的。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-20T06:00:48.383

如果您打算使用 .NET，我建议您创建一个[C++/CLI 包装器](http://www.functionx.com/cppcli/index.htm)。C++/CLI 允许您[将托管 .NET 代码与本机 C++ 代码混合](http://msdn.microsoft.com/en-us/magazine/cc163681.aspx)。这种方法有一些技巧，但在大多数情况下效果很好。

[维基百科条目](http://en.wikipedia.org/wiki/C%2B%2B/CLI)也有一些很好的链接。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-20T06:10:09.500

使用 SWIG 处理 JNI 内容使得包装 cpp API 并从 Java 中使用它变得非常轻松。

这是一个[SWIG 教程](http://www.swig.org/tutorial.html)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-20T05:56:24.917

我是[SlimDX](http://slimdx.org)的主要作者。它可能不是最大的开源互操作性项目，但在整个项目的 150K+ 行中，它是相当可观的。它是使用 C++/CLI 编写的，这是一种 Microsoft 开发的语言，与 C++ 基本兼容，旨在允许您构建包装器。它工作得很好，但需要注意的是它仅适用于 Windows。Mono不会接受它。我不知道这对您有多大的影响，但它可能是比 COM 更好的选择。不幸的是，您基本上必须自己想出很多技巧和窍门。我本来打算在博客上写下我们在 SlimDX 上使用的很多东西，但不知怎的，我从来没有完全解决它。

在Java方面，我相信你必须使用JNI。祝你好运。我从来没有与任何与 JNI 合作过的人交谈过，而我们俩都笑了，以一种糟糕的“哎呀，伤害”之类的方式。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-20T13:21:22.973

我维护的软件是用 C++ 实现的，但必须具有多种语言的接口，包括 Java 和 .NET，还包括 delphi 和 VB6。另外，它必须在多个平台上工作（因此 Java 需要在 unix 上工作）。

这样做的方法是使用单个 DLL 导出使用原始类型的普通 C 函数。例如，给定一个类 Foo：

```
long MY_EXPORT_FLAG FooCreate()
{
    return (long)new Foo();
}

void MY_EXPORT_FLAG FooDestroy(long Handle)
{
   delete (Foo*)Handle;
}

void MY_EXPORT_FLAG BarMethod(long Handle, const char* pStr1, long* pReturnValue)
{
   *pReturnValue = ((Foo*)Handle)->BarMethod( pStr1 );
} 
```

然后你的 JNI/.NET/VB6/Delphi 代码实现语言特定的类包装器，但调用这些 C dll 函数。每个类包装器都包含一个句柄，并将其传递给 C 函数。

这很有效，因为大多数语言倾向于使用 C 作为最低公分母，因此只要您可以通过瘦 C api 导出接口，您就可以为其他语言构建接口。

我们在 DLL 中导出 C（而不是 C++）api，因为函数签名跨平台更加标准化。

不要忘记，在 C# 和 Java 上，您必须处理多字节字符串编码，因此您应该弄清楚如何将字符串转码到 C++ 代码/从 C++ 代码转码。这通常涉及了解语言环境，或者您可以便宜并只支持 UTF-8。

# .net - WMI Win32_Process.Create 因权限不足而失败

> ID：767010
> 
> 赞同：1
> 
> 时间：2009-04-20T05:28:16.217
> 
> 标签：.net, security, vbscript, wmi, win32-process

[我正在尝试通过调用Win32_Process](http://msdn.microsoft.com/en-us/library/aa394372(VS.85).aspx)类从 vbscript 中的远程 Windows 服务器上运行一个简单的 cmd 实用程序，如下所示：

```
serverIP = "10.0.0.3"
Set oWMI = GetObject("winmgmts:{impersonationLevel=impersonate}!\\" & serverIP & "\root\cimv2:Win32_Process")
RunCommand = "cmd.exe /c echo hello >c:\hello.txt"
wscript.echo RunCommand
intReturn = oWMI.Create(RunCommand, Null, Null, intProcessID)  
wscript.echo intReturn
Select Case intReturn
        Case 0 Wscript.Echo "Successful"
        Case 2 Wscript.Echo "Access denied"
        Case 3 Wscript.Echo "Insufficient privilege"
        Case 8 Wscript.Echo "Unknown failure"
        Case 9 Wscript.Echo "Path not found"
        Case 21 Wscript.Echo "Invalid parameter"
        Case Else Wscript.Echo "Unable to execute for unknown reason"
End Select 
```

这总是因 privs 不足而失败（返回代码 3）。

谁能看到我做错了什么？该脚本是从作为域管理员调用的 cmd 会话中运行的，因此它应该可以正常工作，除非我不完全了解有关 WMI 安全性的某些内容。

可能会有人建议PSEXEC。我意识到了这一点，并且可能会退回到它。但这似乎是一个可以解决的问题，我不想为此脚本创建对外部可执行文件的依赖关系。

我会提到一些我尝试过的事情。

*   这个家伙[说](http://blogs.msdn.com/alejacma/archive/2008/04/09/win32-process-create-fails-if-user-profile-is-not-loaded.aspx)，如果没有加载配置文件，可能会出现问题。即使调用用户（域管理员）登录到两个系统，我也会遇到同样的问题。
*   在这个[线程](http://groups.google.com/group/microsoft.public.windows.server.scripting/browse_thread/thread/a2d084de7ba0852f/630cdbd387941a19?lnk=raot)中，Richard Mueller 指出应该同时指定 impersonationlevel=impersonate 和 authenticationlevel=Pkt。我试过了。还是不行。
*   在此[页面上](http://msdn.microsoft.com/en-us/library/aa389292.aspx)，似乎应该指定名字对象中所需的[NT 权限。](http://www.ss64.com/nt/ntrights.html)我已尝试指定 SeInteractiveLogonRight、SeNetworkLogonRight、SeBackupPrivilege、SeRestorePrivilege、SeDebugPrivilege 和 SeChangeNotifyPrivilege。没有任何效果。

我在谷歌搜索时注意到的一个共同点是，人们在某些目标计算机上看到了这个问题，但在其他计算机上却没有。所以在我看来，根本上缺少的是完成这项任务所需的安全权限的全面分解。棒棒糖将不胜感激地发送给任何可以明确提供此类故障的人！

徒劳地希望它会增加收视率，我将在此处添加 .net 标签，因为 .net 人员经常处理相同的 WMI 问题并且可能有洞察力。

哇。Bump，这不会变成[风滚草](https://stackoverflow.com/badges/63/tumbleweed)吧？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2010-07-02T10:59:00.967

我有类似的问题。[http://social.technet.microsoft.com/Forums/en-US/winserverManagement/thread/305557c4-df94-4d92-85bf-a049c83f120c](http://social.technet.microsoft.com/Forums/en-US/winserverManagement/thread/305557c4-df94-4d92-85bf-a049c83f120c)的建议 帮助了我。很快：确保 LOCAL SERVICE 和 NETWORK SERVICE 帐户被授予“替换进程级令牌”（SeAssignPrimaryTokenPrivilege）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-08-19T19:35:17.450

> 在此页面上，似乎应该指定名字对象中所需的 NT 权限。我已尝试指定 SeInteractiveLogonRight、SeNetworkLogonRight、SeBackupPrivilege、SeRestorePrivilege、SeDebugPrivilege 和 SeChangeNotifyPrivilege。没有任何效果。

请注意，如果您尝试使用上面列出的特权字符串（直接来自 NT 权限），那将不起作用。您应该使用[WMI 安全设置表 6.8 中显示的名字对象权限](http://technet.microsoft.com/en-us/library/bb684728.aspx)

（但是，如果您已经是域管理员并且您只是尝试 cmd.exe echo > 文件，那几乎肯定不是问题）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-01T23:56:22.477

在 MS Technet 上查看此详细页面，该页面摘自[**“Microsoft Windows 管理员的高级 VBScript”**](http://www.microsoft.com/technet/scriptcenter/topics/remote/rscripting.mspx)一书， 特别是“第 6 章：Don Jones 和 Jeffery Hicks 的远程脚本”，其中包含有关确保目标设备正确配置为远程脚本的详细信息.

另请查看 c:\winnt\system32\WBEM\logs\wmiprov.txt 我敢打赌你看到的是这样的：

```
(Mon Jun 01 16:57:19 2009.2x) : ***************************************
(Mon Jun 01 16:57:19 2009.2x) : Could not get pointer to binary resource for file:
(Mon Jun 01 16:57:19 2009.2x) : C:\WINNT\system32\DRIVERS\wmiacpi.sys[MofResource](Mon Jun 01 16:57:19 2009.2x) : 
(Mon Jun 01 16:57:19 2009.2x) : *************************************** 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-30T13:10:24.153

您是否在服务器端的日志事件中找到有关错误的更多信息。这有助于诊断访问权限错误，或尝试使用**[FileMon](http://technet.microsoft.com/en-us/sysinternals/bb896642.aspx)**监控访问。

# php - 编码器的复制和粘贴生成帮助

> ID：767012
> 
> 赞同：9
> 
> 时间：2009-04-20T05:28:34.843
> 
> 标签：php

我自己就是这些类型的编码人员之一，他们从未在正式环境中学习过编码，而是通过使用复制和粘贴脚本以及通过 GPL 项目和高级软件（即通常商业脚本公司向您展示如何更改或更新其脚本中的代码的方式，即“复制并粘贴到第 234 行等。”）...这是我的开始。

我不明白我的工作是如何工作的，但我越来越擅长使用代码，虽然我觉得由于我的非正式学习方法，我缺乏知识，一些非常简单但必要的 web 原则一般编码（服务器、浏览器等的来龙去脉）。我觉得我好像是从理解代码的内部开始的，实际的方面......并且缺乏对我正在做的事情的基本原理和理论上的理解。

我也认识很多和我一样的人，他们开始在同一个社区学习，并且和我几乎处于同一阶段……感觉好像图片中缺少了一些重要的东西。当我尝试使用 PHP 创作工具时，我发现我缺乏纪律，我发现理解这些工具非常具有挑战性……这正在成为我完成项目的时间框架（必须手动编写所有代码）的失败。我也发现有时很难寻求帮助，因为缺乏编程附带的特定语言，并且能够使用正确的词来解释我的问题的复杂性。

我的职业是美发师，做过调酒师和酒店经理，职业是商业顾问。我已经慢慢学习了 3 年的 web 开发，在过去的 2 年里我承担了相当多的商业项目，但我显然觉得我的技能和整体知识有些缺乏。

基本上，我想请任何有类似起点的有经验的编码人员给我一个想法，让我了解如何调整我的编码学科以提高效率和生产力。对编程有如此非正式理解的人想要学习和理解什么。作为程序员我必须知道的事情是什么......以及整个画面的基本概述是什么？？？？随时引导我阅读文章

任何帮助总是受到赞赏。

莉亚

**编辑：**只是为了总结一下我的实际能力。我是一名程序员，我确实从头开始编写自己的代码......并出售我的作品。我可以编写 PHP 函数和类，使用 mysql，对 html 和 css 有很好的理解，并且在设计方面（网络图形）非常好，并且正在学习 javascript/ajax/jquery，因为我在使用 jquery我的大部分项目。感谢到目前为止的所有答案！

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-20T05:44:27.830

*   意识到“复制和粘贴编程”实际上并不是编程，尽管有这个名字。“编程”的行为是弄清楚某些东西应该如何工作，以及需要哪些代码才能使其工作。因此，当您复制和粘贴一些代码时，是其他人进行了编程。这不一定是一件坏事，因为您不应该总是需要自己编写代码。但是要称自己为程序员，您确实需要自己编写代码。

*   你会想要开始谦虚。不要尝试编写大型复杂的应用程序作为您编程的第一步。大多数学习编程的人首先被教导如何打印“Hello, world”是有充分理由的。这是因为您需要知道的不仅仅是要使用什么代码——您需要知道代码执行从哪里开始以及它是如何流动的，以及诸如此类的事情。您需要能够查看代码并在脑海中逐步完成它，知道程序下一步将执行到哪里，这样您才能了解它是如何工作的。

*   参加编程教程或课程。网上有很多免费的东西。不要相信任何只会给你大量代码的教程，确保它迫使你自己真正想出一些代码。进行诸如排序字符串、计算斐波那契数列之类的练习，然后“回显”或“打印”结果。了解条件语句（如“if”）和“for”循环，并使用它们来做各种事情。

*   GUI或表单编程更复杂；在查看任何 API 或框架文档以了解该语言可以做什么之前，请确保您了解该语言的基础知识。您需要了解执行流程、如何编写函数、可以使用哪些类型的变量等，然后才能有效地使用 API 或框架。不能做很酷的图形或表格并坚持基本的文本或数字处理是很无聊的，但你必须在跑步之前走路。确保你在做，而不仅仅是阅读。当你了解了一些新的东西，比如 Array 类型，“while”语句，试试看。通过实际去做，你会比仅仅阅读一本书或网站更快地“得到它”，而且你可能更有可能记住它。

*   阅读有关编程的书籍。有人说你应该先学习C，然后再学习其他任何东西。我不一定同意，但是如果您确实学习了 C，那么要阅读的书是 Kernighan 和 Ritchie 的“The C Programming Language”。许多编程书籍非常有趣，但要么不适合初学者，要么不会教您如何真正开始编程。这是一个例外。

*   使用带有语法突出显示和行号的体面的文本编辑器。这就是你所需要的。一个同时进行代码完成等的大型 IDE 在学习阶段不一定有帮助。不要花太长时间选择或设置它。如果您还没有，只需获取 Notepad++（如果您在 Windows 上）并完成它。如果您不喜欢它，您可以在熟练后更改它。或者，如果您已经为 Microsoft Visual Studio 付费，请使用它，但不要仅仅为了学习一门语言而去购买它。避免陷入将所有时间都花在磨刀工具上而没有时间使用它们的陷阱。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-04-20T05:59:28.637

最简单和最快的方法是什么？**找一个导师**，或一组导师。不一定是真人导师，他们可以离线，虽然真人导师更实用。

当您参加本地软件开发社区（例如论坛或用户组会议）时，您可以找到这些人。经常去这些地方，线下和线上；您将学到的知识量是巨大的，更不用说能够从其他人那里获得想法的好处了。

[Code Complete](https://rads.stackoverflow.com/amzn/click/com/0735619670)和[Pragmatic Programmer](https://rads.stackoverflow.com/amzn/click/com/020161622X)同样是上面的优秀书籍推荐。我建议您首先使用 Code Complete，因为它解决了如何使您的代码变得明智和优雅，您当然可以立即使用它。

祝你好运！

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-20T05:33:02.523

如果你有兴趣成为一名更好的程序员，我必须建议你阅读[实用程序员](https://rads.stackoverflow.com/amzn/click/com/020161622X)，别担心，它不是让你大吃一惊的代码全文，而是只能提炼出的有用的教训来自多年的编程经验，以一种易于阅读但仍然非常有用的方式编写:)

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-04-20T05:37:34.727

我们都以不同的方式学习，所以不要因为您进入该领域的方式而感到受阻。

我想我可以建议的最简单、最容易的事情是给自己买一本 PHP 书（因为这是你现在熟悉的东西），然后从那里开始建立信心。

闲暇之余，只需创建一些非常小的基础应用程序即可毫无压力地练习。然后使用 Python、Java 或 .NET 之类的语言。这取决于您喜欢什么。掌握一两种语言后，您就可以阅读 Code Complete 之类的书籍，这些书籍将涵盖软件开发的一些更深奥的领域。

祝你好运，这是一个你永远不会停止学习的职业。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-20T05:34:15.717

我完全不相信“复制粘贴一代”的前提是任何一种新现象。与以前相比，现在只有这些工具可供更广泛的受众使用。

[如果您想真正磨练自己的技能，可能值得参加一些课程，无论是在当地社区大学还是通过使用许多](http://www.diveintopython.net/)[优秀](http://mitpress.mit.edu/sicp/)的在线资源或[书籍](http://mitpress.mit.edu/sicp/)中的一些在自主学习环境中

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-20T05:43:11.937

我相信 Code Complete 是另一本与 Pragmatic Programmer 相同的书，已被推荐。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-20T06:02:22.513

我以前也遇到过你的情况，高中毕业时我在实习中“学习”了 c 和 shell 编程，主要是通过复制和粘贴，后来在不同的时间，我可能在特定技术方面遇到过类似的情况。

我的建议：

1.  在你的 CC 上课。您想要的是高级编程课程的先决条件。他们可能还提供“我以前从未接触过计算机”级别的课程，但这不是后续课程的正式先决条件。这可能是在 Java 中。

2.  阅读一本包含练习的更好的编程书籍。Kernighan 和 Ritchie 的 C 编程语言是经典之作。这将是我的建议，因为 C 与 PHP 非常相似，足以让人熟悉，但又足够不同，您可以将它们分开。即使您可能永远不会编写一条生产线 C，我也会这么说。Paul Graham 的 ANSI Common Lisp 也是一个合适的选择。

3.  如果你真的很铁杆并且有奉献精神，你可以试试 Abelson 和 Sussman 的计算机程序结构和解释。这是加州大学伯克利分校（[http://webcast.berkeley.edu/course_details.php?seriesid=1906978389](http://webcast.berkeley.edu/course_details.php?seriesid=1906978389)）和麻省理工学院（[http://ocw.mit.edu/OcwWeb/Electrical-工程和计算机科学/6-001Spring-2005/CourseHome/](http://ocw.mit.edu/OcwWeb/Electrical-Engineering-and-Computer-Science/6-001Spring-2005/CourseHome/)）。在学校环境之外尝试这可能太难了。它专为聪明的年轻学生而设计，除了学习之外无事可做，并且有机会获得研究生的辅导。我只是为了完整性才包括它。

我会避免任何网络编程书籍。您已经了解网络编程。我的印象是，您感觉自己好像在撞到一堵墙，并看着那堵墙周围或那边的路，而不是试图直接穿过它。

我建议不要查看任何面向 Web 的书籍，因为它不会为您提供全局，它只会描述适用于 Web 编程的技术。要了解的重要事项是计算机实际运行的方式、堆栈和堆之间的区别、指针、垃圾收集的基础知识、递归，并且至少了解扩展机制可能会有所帮助。我的意思是，如果您了解 Unix 上的共享库、Windows 上的 DLL、Java 上的类路径和 jar，或者如何在 PHP、Ruby、Perl 或 Python 中创建库，那么其中任何一个都可以。重要的是加载外部代码的概念。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-04-20T20:58:09.647

看看[计算机程序的结构和解释，](http://groups.csail.mit.edu/mac/classes/6.001/abelson-sussman-lectures/ "计算机程序的结构和解释")看看你是否认为它会有所帮助。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-04-20T05:40:23.253

复制和粘贴编程是指在多个地方使用相同的代码，而不是将其放在函数或类中。如果您所做的只是在遵循操作指南的同时修改现有源代码，那么您所做的不是编程，只需复制和粘贴即可。

你需要做的是读一本关于编程的书，不管你觉得你的水平如何。如果你觉得它的复制和粘贴水平，你应该从一本初学者的书开始。忘记你认为你知道的一切，阅读并遵循这本书。完成后，您可以记住您在 C&P 期间注意到的一些聪明的代码（？）。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-04-20T09:22:49.473

掌握任何技能都需要时间，但如果你坚持下去，你会变得更好。从这个意义上说，编程本质上并没有什么不同。究竟如何才能最好地学习是一个高度个人化的问题，因此很难就此提供任何有意义的建议。根据我的经验，将不同类型的学习（实践经验、与其他程序员相处、阅读书籍、正规教育等）以均匀的剂量结合起来比仅仅追求一种学习（如正规教育）效果更好。

如果您还不知道这些读数，您可能会发现它们很有趣：

*   [http://www.norvig.com/21-days.html](http://www.norvig.com/21-days.html)
*   [http://softwarecraftsmanship.oreilly.com/wiki](http://softwarecraftsmanship.oreilly.com/wiki)

# hibernate - 休眠状态

> ID：767016
> 
> 赞同：2
> 
> 时间：2009-04-20T05:31:40.450
> 
> 标签：hibernate, web, jboss

有谁知道 Hibernate 发生了什么？几天来，hibernate.org 重定向到“jboss.org”，但在过去的 2-3 天里，它只是显示 jboss.org 维护屏幕。

我意识到 Hibernate 一直与 JBoss 相关联，所以我没有问这个问题，但我在多个项目中使用 Hibernate，并且我使用了很多在线文档，所以我想知道这个站点何时/何时会重新出现。（我不是在问 NHibernate，只是在问普通的 Java Hibernate）。

我会在 hibernate 论坛或 jboss 论坛上问这个问题，但目前这些都不可用。（此外，jboss.org 上的休眠链接是“hibernate.org”，这是无用的）。只是好奇这个社区中是否有人知道任何事情。

以下是没有真正得到足够答案的相关问题：

*   [https://stackoverflow.com/questions/761425/whats-happening-to-hibernate-org-closed](https://stackoverflow.com/questions/761425/whats-happening-to-hibernate-org-closed)

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-20T05:50:44.070

大概 JBoss.org 团队知道（它在 hibernate.org 上这么说）。他们的网站有一个[联系我们](http://jboss.org/contact.html)的链接，我敢肯定这比 SO swarm 更有可能从他们那里得到明智的回应 :-)。无意冒犯。

为了它的价值，我问他们。让我们看看他们回来了。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-20T20:40:14.277

我在周五维护消息还没出来之前就给他们发了电子邮件，并在 JBoss 论坛上发布了消息，但无济于事。如果他们做出回应，我会感到惊讶，否则我希望他们会发布一条消息，说明问题的性质和预期的返回时间。如果你问我，这是一种非常破旧的经商方式。

如果您访问 Internet 存档（只是 google 'wayback machine'）并在 hibernate.org 上搜索，您可以提取该站点的快照，包括大部分文档。不是最新的文档，但总比没有好。

# php - 如何正确使用 PDO 对象进行参数化 SELECT 查询

> ID：767026
> 
> 赞同：85
> 
> 时间：2009-04-20T05:36:43.857
> 
> 标签：php, mysql, select, pdo

我已经尝试按照 PHP.net 的说明进行`SELECT`查询，但我不确定执行此操作的最佳方法。

`SELECT`如果可能，我想使用参数化查询在字段与参数匹配的`ID`表中返回 。`name`这应该返回一个`ID`，因为它将是唯一的。

然后我想将它`ID`用于`INSERT`另一个表，所以我需要确定它是否成功。

我还读到您可以准备查询以供重用，但我不确定这有什么帮助。

* * *

## 回答 #1

> 赞同：158
> 
> 时间：2009-04-20T09:15:45.123

您选择这样的数据：

```
$db = new PDO("...");
$statement = $db->prepare("select id from some_table where name = :name");
$statement->execute(array(':name' => "Jimbo"));
$row = $statement->fetch(); // Use fetchAll() if you want all results, or just iterate over the statement, since it implements Iterator 
```

您以相同的方式插入：

```
$statement = $db->prepare("insert into some_other_table (some_id) values (:some_id)");
$statement->execute(array(':some_id' => $row['id'])); 
```

我建议您将 PDO 配置为在出错时引发异常。然后，如果任何查询失败，您将得到一个`PDOException`- 无需明确检查。要打开异常，请在创建`$db`对象后立即调用：

```
$db = new PDO("...");
$db->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION); 
```

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2013-03-02T20:11:41.393

我最近一直在使用 PDO，上面的答案是完全正确的，但我只是想证明以下内容也有效。

```
$nametosearch = "Tobias";
$conn = new PDO("server", "username", "password");
$conn->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);
$sth = $conn->prepare("SELECT `id` from `tablename` WHERE `name` = :name");
$sth->bindParam(':name', $nametosearch);
// Or sth->bindParam(':name', $_POST['namefromform']); depending on application
$sth->execute(); 
```

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2014-03-04T08:26:23.600

您可以使用`bindParam`或`bindValue`方法来帮助准备您的陈述。它使事情一见钟情，而不是做，`$check->execute(array(':name' => $name));`特别是如果您绑定多个值/变量。

检查下面清晰易读的示例：

```
$q = $db->prepare("SELECT id FROM table WHERE forename = :forename and surname = :surname LIMIT 1");
$q->bindValue(':forename', 'Joe');
$q->bindValue(':surname',  'Bloggs');
$q->execute();

if ($q->rowCount() > 0){
    $check = $q->fetch(PDO::FETCH_ASSOC);
    $row_id = $check['id'];
    // do something
} 
```

如果您期望**多行**删除`LIMIT 1`并将 fetch 方法更改为`fetchAll`：

```
$q = $db->prepare("SELECT id FROM table WHERE forename = :forename and surname = :surname");// removed limit 1
$q->bindValue(':forename', 'Joe');
$q->bindValue(':surname',  'Bloggs');
$q->execute();

if ($q->rowCount() > 0){
    $check = $q->fetchAll(PDO::FETCH_ASSOC);
    //$check will now hold an array of returned rows. 
    //let's say we need the second result, i.e. index of 1
    $row_id = $check[1]['id']; 
    // do something
} 
```

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2013-10-19T15:23:13.077

这里有一个完整的答案，一切都可以使用：

```
 $sql = "SELECT `username` FROM `users` WHERE `id` = :id";
    $q = $dbh->prepare($sql);
    $q->execute(array(':id' => "4"));
    $done= $q->fetch();

 echo $done[0]; 
```

这`$dbh`是 PDO db 连接器，基于`id`从表中`users`我们得到了`username`使用`fetch();`

我希望这对某人有所帮助，享受！

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2016-01-08T07:00:48.430

**方法一：使用PDO查询方法**

```
$stmt = $db->query('SELECT id FROM Employee where name ="'.$name.'"');
$results = $stmt->fetchAll(PDO::FETCH_ASSOC); 
```

**获取行数**

```
$stmt = $db->query('SELECT id FROM Employee where name ="'.$name.'"');
$row_count = $stmt->rowCount();
echo $row_count.' rows selected'; 
```

**方法二：带参数的语句**

```
$stmt = $db->prepare("SELECT id FROM Employee WHERE name=?");
$stmt->execute(array($name));
$rows = $stmt->fetchAll(PDO::FETCH_ASSOC); 
```

**方法三：绑定参数**

```
$stmt = $db->prepare("SELECT id FROM Employee WHERE name=?");
$stmt->bindValue(1, $name, PDO::PARAM_STR);
$stmt->execute();
$rows = $stmt->fetchAll(PDO::FETCH_ASSOC);

**bind with named parameters**
$stmt = $db->prepare("SELECT id FROM Employee WHERE name=:name");
$stmt->bindValue(':name', $name, PDO::PARAM_STR);
$stmt->execute();
$rows = $stmt->fetchAll(PDO::FETCH_ASSOC);

or
$stmt = $db->prepare("SELECT id FROM Employee WHERE name=:name");
$stmt->execute(array(':name' => $name));
$rows = $stmt->fetchAll(PDO::FETCH_ASSOC); 
```

想知道更多看这个[链接](http://www.techsudhir.com/2015/12/php-pdo.html)

* * *

## 回答 #6

> 赞同：-2
> 
> 时间：2016-11-14T10:23:52.070

如果您在单页中使用内联编码而不使用 oops 而不是使用这个完整示例，它肯定会有所帮助

```
//connect to the db
$dbh = new PDO('mysql:host=localhost;dbname=mydb', dbuser, dbpw); 

//build the query
$query="SELECT field1, field2
FROM ubertable
WHERE field1 > 6969";

//execute the query
$data = $dbh->query($query);
//convert result resource to array
$result = $data->fetchAll(PDO::FETCH_ASSOC);

//view the entire array (for testing)
print_r($result);

//display array elements
foreach($result as $output) {
echo output[field1] . " " . output[field1] . "<br />";
} 
```

# visual-studio-2005 - 链式应用安装

> ID：767029
> 
> 赞同：0
> 
> 时间：2009-04-20T05:39:25.097
> 
> 标签：visual-studio-2005, setup-deployment

嗨，我正在使用 Visual Studio 为我的应用程序创建一个 msi 文件。它检查系统中是否存在 .net 2.0。如果它不存在，则安装中止。

如果 .net 2.0 不存在，我需要安装它并继续安装应用程序而不是中止安装。

这如何在 Visual Studio 2005 安装和部署项目中实现？？？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-20T05:52:46.563

不知道。不过，在 VS Setup 项目上花费了相当长的时间后，我可以告诉你一件事：它们很**糟糕**。我的意思是真的很糟糕。我喜欢 VS，但那些项目令人尴尬。可悲的是，他们认为你可以和他们一起去任何地方。我怎么强调他们有多糟糕都不为过。

也就是说，您应该切换到[Windows Installer XML](http://wix.sourceforge.net/)，通常称为“WiX”。它带有一个 VS 插件，基本上只是做一些基本的链接，然后你可以随意设置 XML。这需要一些时间来适应，因为没有任何用户界面。最后，它比 VS 的东西有了如此巨大的改进，值得花额外的时间（比如一个小时左右）来熟悉这种格式。

# mysql - 简单的 MySQL 数据库问题

> ID：767039
> 
> 赞同：0
> 
> 时间：2009-04-20T05:46:31.040
> 
> 标签：mysql, database, normalization

我对数据库很陌生，我有一个快速的问题。

如果我有这些字段，我将如何设计我的 MySQL 数据库：

ID, lat, long, date - 多个日期，时间 - 多次

我知道我应该把它放在两张桌子上，对吧？那两张桌子看起来怎么样？

谢谢！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-20T06:09:31.873

Your first table might be called "location" and it would have an "id" column as its primary key, along with two columns called "latitude" and "longditude" (which could be varchar or a numeric type, depending what your application requires). Your second table might be called "location_event" and it could have an "id" column as its primary key, along with a foreign key column called "location_id" that is a reference to the primary key of the "location" table. This "location_event" table would also have a "date" column and a "time" column (of types date and time respectively).

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-20T06:24:22.850

It's hard to tell what you're trying to do from the terse description but third normal form dictates that any column should be dependent on:

*   the key.
*   the whole key.
*   nothing but the key.

To that end, I'd say my initial analysis would generate:

```
Location
    LocId primary key
    Lat
    Long
Events
    LocId foreign key Location(LocId)
    Date
    Time 
```

This is based on my (possibly flawed) analysis that you want to store a location at which zero or more events can happen.

It's good practice to put the events in a separate table since the alternative is to have arrays of columns which is never a good idea.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-20T07:13:09.223

据我所知，日期和时间是情侣总是一起出现。在这种情况下，我会建议两张桌子，位置和时间。

```
CREATE TABLE location (
  id INT  NOT NULL,
  lat FLOAT  NOT NULL,
  long FLOAT  NOT NULL,
  PRIMARY KEY (id)
)

CREATE TABLE time (
  id INT  NOT NULL,
  locationid INT  NOT NULL,
  date DATE  NOT NULL,
  time DATE  NOT NULL
) 
```

您可以选择添加外键约束

```
ALTER TABLE time ADD CONSTRAINT location_fk_constraint FOREIGN KEY location_fk_constraint (locationid)
    REFERENCES location (id)
    ON DELETE CASCADE
    ON UPDATE CASCADE; 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-20T06:19:16.467

OK, let's say, for the sake of argument, that you are talking about longitude and latitude. That these are entries in some kind of list (perhaps a sea log? *Arrgh, me maties!*) of longitude and latitude. And that each of these long/lat pairs may appear more than once in the list.

Perhaps you want to build a database that figures out how many appearances each long/lat pair has, and when each appearance happened?

So how's this: First we have a table of the long/lat pairs, and we'll give each of those an ID.

```
ID  long   lat
--  -----  -----
1   11111  22222
2   33333  44444
3   55555  66666 
```

Next, we'll have another table, which will assign each appearance of the long/lat pairs a date/time:

```
ID  date     time
--  ----     -----
1   1/1/1900 12:30
1   2/2/1900 12:31
1   3/2/1900 12:30
2   1/1/1930 08:21 
```

Let's say you'll call the first table "`longlat`" and the second one "`appearances`".

You could find all the appearances of a single long/lat pair by doing something like:

```
SELECT date,time FROM appearances 
   LEFT JOIN longlat ON appearances.ID=longlat.ID 
   WHERE longlat.long = 11111 AND longlat.lat = 22222 
```

You could count how many times something happened at a longitude of 11111, by doing:

```
SELECT count(ID) FROM appearances 
   LEFT JOIN longlat ON appearances.ID=longlat.ID 
   WHERE longlat.long = 11111 
```

Hope that helps! I gotta admit, it's really quite annoying to try and guess what people mean... Try making yourself more clear in the future, and you'll see that the help you'll get will be that much more useful, concise and targeted at what you need.

Good luck!

# bash - 在 Bash 注销时保存最后一个工作目录

> ID：767040
> 
> 赞同：11
> 
> 时间：2009-04-20T05:46:43.753
> 
> 标签：bash, shell

当您在 bash 中执行“退出”时，是否可以保存最后一个工作目录。因此，下次您登录时，它将位于您上次注销时所在的目录。

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-04-20T06:30:22.993

将 ~./.bash_logout 中的最后一个工作目录保存到隐藏文件中：

```
pwd > ~/.lastdirectory 
```

在 ~/.bashrc 中读取此文件

```
[ -s ~/.lastdirectory ] && cd `cat ~/.lastdirectory` 
```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-04-20T06:33:18.570

把它放在你的`~/.bashrc`（可能在最后）：

```
cd "$(<~/.storepwd)" 
```

然后您可以选择以下选项：

要么把它放进去`~/.bash_logout`（不会记住交互式非登录 shell 的目录）：

```
printf %s "$PWD" > ~/.storepwd 
```

或使用`trap`on `EXIT`，将其放入您的`~/.bashrc`（陷阱可以轻松/意外地覆盖）：

```
trap 'printf %s "$PWD" > ~/.storepwd' EXIT 
```

或者使用`PROMPT_COMMAND`，把它放在你的`~/.bashrc`（可能是最可靠的方式）：

```
PROMPT_COMMAND+='; printf %s "$PWD" > ~/.storepwd' 
```

还要确保 your`~/.profile`或`~/.bash_profile`source your `~/.bashrc`，否则登录 shell 启动时路径将不会恢复。

看[http://mywiki.wooledge.org/DotFiles](http://mywiki.wooledge.org/DotFiles)获取有关如何使用点文件的信息。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-20T23:13:49.507

您还需要小心处理整个概念。例如，如果你设法让你的代码在你不期望的时候运行，它可能会混淆很多事情。

例如，如果您要运行一个更改当前工作目录的 shell 脚本，然后在退出期间设法保存其 CWD，那么您可能最终会在下一个启动的 shell 中进入一个您没有启动的目录预计。

另一个流行的，至少对我来说，至少在$work 上，是当root su 向您的用户运行脚本时运行脚本，所有这些都是自动的（即，以编程方式）。如果您正在为自己的用户执行此 CWD 技巧，那很好，但它可能会严重破坏期望“su - youruser -c ls”返回主目录中的文件的系统工具。（好吧，以您的用户身份调用“ls”是一个愚蠢的想法，但在某些情况下，您的用户可能拥有比 root 更好的运行环境——例如，在 root 被压缩的 NFS 挂载上。）

因此，这里的关键是判断您是否在交互式外壳中，如果不是，*请不要恢复或保存您的 CWD*。IIRC，$- 有一个用于交互式 shell 的“i”。用它来设置陷阱和恢复 CWD。

就个人而言，我只是设置了一个别名：

```
alias go='. go.sh' 
```

然后 go.sh 只需检查它的参数以了解我想去哪个目录。例如，“go myproj”将 cd ~/svn/myproj，“go bigdisk”将 cd /mnt/bigdisk。而且，对于更复杂的情况，它可以采用更多参数，例如，“go myproj lib”将只是“cd ~/svn/myproj/myproj/lib”或其他。没有自动保存，但也没有副作用。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-20T05:51:24.163

每次更改目录（cd）时，您都可以将当前目录（pwd）写入某个文件。启动终端时，bash 启动脚本应该在该文件中查找“最后一个目录”。如果发现了什么- cd 到它。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-20T05:59:32.083

查看 .bashrc，也许可以在注销时修改它以包含您感兴趣的目录。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-20T06:05:55.470

您很可能希望在 shell 退出时将当前目录保存到文件中。有多种方法可以检测 shell 退出：

1.  将一些代码放入 ~/.bash_logout。这只会在登录 shell 退出时执行，因此如果您只是关闭终端窗口，则不会保存目录。
2.  EXIT 上的陷阱。使用内置的“trap”，您可以在 shell 退出时执行一些代码。这将在任何 shell 退出时运行 - 好吧，就是您设置陷阱的任何 shell。

您可以在每次提示时保存 CWD，或者每次运行“cd”时保存 CWD，但这有点矫枉过正。

要在下一个 shell 启动时恢复 CWD，只需在保存文件的内容（如果存在）上运行“cd”即可。

您可能想考虑如果同时运行多个 shell 会发生什么。你想保存哪一个的CWD？是否应该所有开始使用该 CWD 的新 shell？或者只是下一个开始的shell？

# iphone - iPhone 封面流

> ID：767048
> 
> 赞同：1
> 
> 时间：2009-04-20T05:51:45.333
> 
> 标签：iphone

我需要为我们的 iPhone 应用程序实现封面流功能。我试图在网上找到示例代码以开始使用它，但我没有任何运气。谁能告诉我如何实现封面流功能或给我一个示例？

提前致谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-20T07:57:07.917

试试 FlowCover

[http://www.chaosinmotion.com/flowcover.m](http://www.chaosinmotion.com/flowcover.m)

源码为你提供了一个实现coverflow效果的FlowCoverView。您只需要自定义一些委托方法。查看示例源代码，自定义它以满足您的需求应该很简单。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-08-03T20:10:21.463

您可能还想查看我在 iPhoneDevCamp 发布的库——OpenFlow。[http://apparentlogic.com/openflow](http://apparentlogic.com/openflow)

它都是基于核心动画的，因此很容易理解并根据您的需求进行定制。AFOpenFlowView 是 UIView 的子类。

我包含了一个演示应用程序，并查看我个人网站上的博客条目以获取有关其使用的更多信息。fajkowski.com

如果您有任何问题或意见，请给我留言！-亚历克斯

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-12-05T15:56:55.953

这个看起来很有希望：

[https://github.com/nicklockwood/iCarousel](https://github.com/nicklockwood/iCarousel)

似乎比上面建议的其他两个更积极地维护。

# linq-to-entities - Linq to Entities 生成的 SQL 中的连接过多

> ID：767049
> 
> 赞同：0
> 
> 时间：2009-04-20T05:51:47.877
> 
> 标签：linq-to-entities

我有一个设置了关系的 .NET 实体数据模型，因此我不需要在我的 LINQ 查询中手动加入实体。下面的 LINQ 查询引用了另一个表**CustomerUserField**：

```
from c in Customer.GetCustomer(this.ClientId, intRecordId)
select new
{
  c.TitleId,
  c.FirstName,
  c.LastName,
  c.Phone,
  c.MobilePhone,
  c.Fax,
  c.EmailAddress,
  c.CustomerUserField.Text1,
  c.CustomerUserField.Text2,
  c.CustomerUserField.Text3,
  c.CustomerUserField.Text4,
  c.CustomerUserField.Text5
}; 
```

它在 C# 中看起来不错且整洁，但是生成的 SQL 会为引用表中的每一列创建一个单独的左外连接：

```
SELECT 
[Limit1].[C1] AS [C1], 
[Limit1].[TitleId] AS [TitleId], 
...
FROM                                 
    [dbo].[Customer] AS [Extent1]
    LEFT OUTER JOIN [dbo].[CustomerUserField] AS [Extent2] ON [Extent1].[CustomerId] = [Extent2].[CustomerId]
    LEFT OUTER JOIN [dbo].[CustomerUserField] AS [Extent9] ON [Extent2].[CustomerUserFieldId] = [Extent9].[CustomerUserFieldId]
    LEFT OUTER JOIN [dbo].[CustomerUserField] AS [Extent10] ON [Extent2].[CustomerUserFieldId] = [Extent10].[CustomerUserFieldId]
    LEFT OUTER JOIN [dbo].[CustomerUserField] AS [Extent11] ON [Extent2].[CustomerUserFieldId] = [Extent11].[CustomerUserFieldId]
    LEFT OUTER JOIN [dbo].[CustomerUserField] AS [Extent12] ON [Extent2].[CustomerUserFieldId] = [Extent12].[CustomerUserFieldId]
    LEFT OUTER JOIN [dbo].[CustomerUserField] AS [Extent13] ON [Extent2].[CustomerUserFieldId] = [Extent13].[CustomerUserFieldId]... 
```

此 SQL 非常慢，因为只需要 1 个左外连接。有什么想法可以将我的 LINQ 更改为仅执行一次连接吗？

提前致谢！

安东尼。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-20T08:12:13.187

您可以使用以下代码“急切地加载”您的客户选项表：

```
DataLoadOptions options = new DataLoadOptions();
options.LoadWith<Customer>(c => c.CustomerUserField);

using (ToDoDataContext context = new ToDoDataContext())
{
    context.LoadOptions = options;
    //Your code goes here
} 
```

这应该意味着您的联接只执行一次，因为它同时加载表

# visual-studio - 如何在 Visual Studio 2003 中创建的 Web 应用程序中回发后保持滚动位置

> ID：767059
> 
> 赞同：0
> 
> 时间：2009-04-20T05:56:10.453
> 
> 标签：visual-studio, web-applications

有没有办法在 Visual Studio 2003 中回发后保持滚动位置。

在 Visual Studio 2005 中，我可以通过将页面指令的**MaintainScrollPositionOnPostback属性设置为 true 来实现。**

如果不设置 location.href 属性，我怎么能做到这一点？？？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-20T06:08:05.853

如果您在 1.1 框架中，您正在寻找[SmartNavigation](http://msdn.microsoft.com/en-us/library/system.web.ui.page.smartnavigation.aspx)。在 2.0 中，MaintainScrollPositionOnPostback 已弃用。不要抱太大希望，它充其量是平庸的。:)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-20T06:20:51.363

SmartNavigation 将为您工作。它在 .Net 1.1 中可用。

# php - 是否有任何用于 php 的高级开源 pop3 类？

> ID：767064
> 
> 赞同：3
> 
> 时间：2009-04-20T05:58:15.537
> 
> 标签：php, email, pop3

我正在寻找一个用于 php 的高级开源 pop3 类。对于使用 phpmailer 的传出邮件，我需要 pop3 类来处理传入邮件（读取、删除。解码）。

感谢您的阅读，我们将非常感谢您的帮助

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-20T06:02:53.853

[Zend Mail](http://framework.zend.com/manual/en/zend.mail.read.html)具有广泛的电子邮件阅读功能。（注意 Zend 框架的组件可以作为单个元素使用，不依赖于框架）

# parameters - 我应该如何将用户定义的类型传递给 SqlParameterCollection.AddWithValue？

> ID：767072
> 
> 赞同：1
> 
> 时间：2009-04-20T06:02:43.807
> 
> 标签：parameters, types, sqlcommand, implicit-typing

我有一个名为 的自定义数据类型`StudentID`，它具有到字符串的隐式转换。

当我将`StudentID`实例传递给`SqlCommand.Parameters.AddWithValue`（作为值）并执行命令时，我收到以下错误：

```
No mapping exists from object type StudentID to a known managed provider native type. 
```

指定参数的类型 like`SqlDbType.NVarChar`没有帮助。唯一可行的是将`StudentID`值显式转换为字符串，这违背了隐式转换的目的。

我猜该框架不考虑可用的转换。我可以对`StudentID`类做些什么来使命令处理它而不需要显式转换为原始类型？

[这篇 MSDN 文章](http://msdn.microsoft.com/en-us/library/yy6y35y8.aspx)讨论了如何处理原始类型，而不是用户定义的类型。最接近的匹配是对象，它说它作为变体传递。

确切的故障点在 System.Data.SqlClient.MetaType.GetMetaTypeFromValue 方法中，带有签名`private static MetaType GetMetaTypeFromValue(Type dataType, object value, bool inferLen)`。反射表明它寻找原始类型，如果 TypeCode 是对象，它会寻找 Sql* 数据类型，例如 SqlBoolean，因此它似乎在寻找非常特定的原始类型或 Sql* 类型。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-27T16:33:37.310

据我所知，您不能通过 UDT。只允许使用原始类型或 Sql* 类型。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2015-06-08T21:03:03.690

看来您可以`SqlUserDefinedTypeAttribute`与自定义类型一起使用。看看*当前*的实现`GetMetaTypeFromValue`。

# php - 项目管理/多个版本

> ID：767076
> 
> 赞同：3
> 
> 时间：2009-04-20T06:05:45.533
> 
> 标签：php, version-control, deployment, project-management, versioning

我在这里寻找有关如何管理项目的多个版本的一些提示和技巧。

目前我有一个应用程序的开发版本，其中包括一些改进和新功能。与此同时，我必须做一些错误解决。修复新功能尚未触及的文件上的错误很容易，但只要我触摸具有新功能的页面。我每次都需要注释几行代码。我觉得这不是最好的玩耍方式。必须有一个足够好的方法来解决这个问题。

问题的另一方面是部署。我经常需要等待几周才能在网站上上传新功能。与此同时，有时我往往会忘记每个已修改（或为错误注释）的文件，它可能会产生错误。我听说过为 ruby​​ 粉丝准备的 capistrano，对我有帮助吗？我主要是 PHP/asp.net 开发人员。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-20T06:31:22.600

您正在经历“**不兼容**的开发工作”的经典案例：
您不能同时修复错误并在同一文件上进行开发。

这是分支的经典案例，它允许同一个文件：

*   将其状态冻结为最初部署的状态（分支的陈述点）
*   修复错误修复分支中的错误
*   将其中一些错误改造成当前的开发分支
*   在开发分支中开发新功能。

如果您对立即设置 VCS（版本控制系统）不满意，您至少可以将代表您的服务器的文件树复制到 2 个目录（一个`1.0`和一个 ' `DEV`'）中，有效地进行一些“手动”修订控制。
然后像[WinMerge](https://stackoverflow.com/questions/413649/how-to-diff-merge-changes-to-a-deployment-project-file/417962#417962)这样的工具将帮助您跟踪差异并进行一些合并

但是真正的 VCS 会更有效，并且可以用作部署的稳定源，如[针对单人 Web 应用程序](https://stackoverflow.com/questions/330848/best-version-control-for-a-one-man-web-app/330883#330883)问题（带有颠覆）的最佳版本控制所示。
这个版本控制的源代码也可以被[capistrano](https://stackoverflow.com/questions/tagged/capistrano)这样的部署系统使用。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-20T06:12:50.023

大多数版本控制系统都能够“分支”您的软件，因此您可以同时运行同一代码库的多个版本。

例如，您的“1.0”分支可能是当前的生产版本。对于新的开发，您可能会创建一个“1.1”分支，它以 1.0 的副本开始。您所有的新功能都应该在 1.1 中，任何生产错误修复都应该在 1.0 中（最终也应该在 1.1 中）。通常有一些工具可用于合并分支之间的更改（例如，将错误修复从 1.0 合并到 1.1）。

这是对颠覆分支的一个很好的描述。

[http://svnbook.red-bean.com/en/1.1/ch04.html](http://svnbook.red-bean.com/en/1.1/ch04.html)

检查您当前的版本控制系统，了解它如何处理分支。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-20T06:08:16.680

一种方法是在源代码控制软件中创建一个分支。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-20T06:31:31.070

源代码控制系统是您的解决方案。他们中的大多数都有处理项目不同版本的方法，例如 perforce、svn 等。您可以使用 Perforce 中的分支创建任意数量的版本。任何版本的任何更改都需要合并到所有更高版本。我发现 peforce merge 很舒服。每个新版本都从其早期版本的副本开始。您可以开发一些控制脚本并配置 perforce，这将提醒对先前版本的任何更改，而这些更改未在更高版本中完成。

# java - 如何在 Apache Jackrabbit 中配置自定义节点定义？

> ID：767085
> 
> 赞同：4
> 
> 时间：2009-04-20T06:09:00.063
> 
> 标签：java, jackrabbit, jcr, jsr170

有没有一种方法可以在实例化新存储库时为[Apache Jackrabbit配置自定义](http://jackrabbit.apache.org)[节点类型以进行注册？](http://jackrabbit.apache.org/node-type-notation.html)

我正在使用[Apache Maven](http://maven.apache.org)自动化我的构建，并且有一些单元测试可以使用[JUnit](http://junit.org)运行，集成测试可以使用[Jetty](http://www.mortbay.org/jetty)运行，并且希望能够轻松设置和拆除测试存储库。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2010-02-12T01:34:16.973

如果您能够升级到新发布的 Jackrabbit 2.0.0，您可以通过编程方式创建和注册节点类型。主要的钩子是 JSR-283 [NodeTypeManager](http://www.day.com/maven/javax.jcr/javadocs/jcr-2.0/javax/jcr/nodetype/NodeTypeManager.html)，它兼作新 NodeType 的工厂和注册它们的地方。只需在 JUnit 测试的 setup 方法中注册它们，就可以开始使用了。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-07-31T08:56:07.593

我建议您使用[CND 文件](http://jackrabbit.apache.org/node-type-notation.html)定义您的节点类型，并配置您的 JUnit 测试用例为您注册它们，如本[示例](http://jackrabbit.apache.org/node-types.html#NodeTypes-RegisteringNodeTypes)中所示。我想说最合适的方法是定义一个执行此配置的抽象测试用例。

另请注意，节点类型与工作空间相关联，而不是与整个存储库相关联。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2015-11-04T14:58:03.247

根据[NodeTypeManager](http://www.day.com/maven/javax.jcr/javadocs/jcr-2.0/javax/jcr/nodetype/NodeTypeManager.html)，这是创建节点类型的代码示例：

```
 import javax.jcr.PropertyType;
    import javax.jcr.Session;
    import javax.jcr.nodetype.NodeType;
    import javax.jcr.nodetype.NodeTypeManager;
    import javax.jcr.nodetype.NodeTypeTemplate;
    import javax.jcr.nodetype.PropertyDefinitionTemplate;

    /**
     *
     * @author Aroniaina
     */
    public class FileType {
        public static void RegisterFileType(Session session) throws Exception {        
            NodeTypeManager nodeTypeManager = session.getWorkspace().getNodeTypeManager();

            NodeTypeTemplate nodeType = nodeTypeManager.createNodeTypeTemplate();
            nodeType.setName("FileType");
            String[] str = {"nt:resource"};        
            nodeType.setDeclaredSuperTypeNames(str);
            nodeType.setMixin(false);
            nodeType.setQueryable(true);

            PropertyDefinitionTemplate path = nodeTypeManager.createPropertyDefinitionTemplate();
            path.setName("jcr:path");
            path.setRequiredType(PropertyType.PATH);
            path.setQueryOrderable(false);
            path.setFullTextSearchable(false);
            nodeType.getPropertyDefinitionTemplates().add(path);

            PropertyDefinitionTemplate nom = nodeTypeManager.createPropertyDefinitionTemplate();
            nom.setName("jcr:nom");
            nom.setRequiredType(PropertyType.STRING);
            nom.setQueryOrderable(true);
            nom.setFullTextSearchable(true);
            nodeType.getPropertyDefinitionTemplates().add(nom);

            PropertyDefinitionTemplate description = nodeTypeManager.createPropertyDefinitionTemplate();
            description.setName("jcr:description");
            description.setRequiredType(PropertyType.STRING);
            description.setQueryOrderable(true);
            description.setFullTextSearchable(true);
            nodeType.getPropertyDefinitionTemplates().add(description);

            PropertyDefinitionTemplate motsCles = nodeTypeManager.createPropertyDefinitionTemplate();
            motsCles.setName("jcr:motsCles");
            motsCles.setRequiredType(PropertyType.STRING);
            motsCles.setQueryOrderable(true);
            motsCles.setFullTextSearchable(true);
            nodeType.getPropertyDefinitionTemplates().add(motsCles);

            PropertyDefinitionTemplate size = nodeTypeManager.createPropertyDefinitionTemplate();
            size.setName("jcr:size");
            size.setRequiredType(PropertyType.STRING);
            size.setQueryOrderable(true);
            size.setFullTextSearchable(false);
            nodeType.getPropertyDefinitionTemplates().add(size);

            PropertyDefinitionTemplate users = nodeTypeManager.createPropertyDefinitionTemplate();
            users.setName("jcr:users");
            users.setRequiredType(PropertyType.STRING);
            users.setQueryOrderable(true);
            users.setFullTextSearchable(false);
            nodeType.getPropertyDefinitionTemplates().add(users);

            PropertyDefinitionTemplate groupe = nodeTypeManager.createPropertyDefinitionTemplate();
            groupe.setName("jcr:groupe");
            groupe.setRequiredType(PropertyType.STRING);
            groupe.setQueryOrderable(true);
            groupe.setFullTextSearchable(false);
            nodeType.getPropertyDefinitionTemplates().add(groupe);

            NodeType newnodetype = nodeTypeManager.registerNodeType(nodeType, true);             
            session.save();        
        }

    } 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-12-04T07:57:03.740

您可以在[Silverpeas](http://www.silverpeas.org)中查看我们的代码。我们正在使用带有一些单元测试的 Apache Jackrabbit。目前这是我的开发分支上正在进行的一项工作：[https](https://github.com/ehsavoie/Silverpeas-Core/tree/feature_82) ://github.com/ehsavoie/Silverpeas-Core/tree/feature_82在内存存储库中使用，加载 CND 文件并使用 spring 进行测试。例如查看[DocumentRepositoryTest](https://github.com/ehsavoie/Silverpeas-Core/blob/feature_82/lib-core/src/test/java/org/silverpeas/attachment/repository/DocumentRepositoryTest.java)

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-05-28T04:58:41.013

我不确定节点类型，但我读过 apache sling 有一种方法可以在安装包（osgi 包）时指定初始内容。听起来至少与您的想法相似。

# infopath - InfoPath autonumber field

> ID：767089
> 
> 赞同：2
> 
> 时间：2009-04-20T06:10:17.473
> 
> 标签：infopath, autonumber

I am designing an infopath (Change Request) form:

1)How can i add a text box that automaticaly increments to the next number when a new form is created (adding a new Change Request form to the form library).

2)How do i retrieve information from an existing form to the new form.

NOTE: The field is not inside a repeating table. I need to generate the next Change Request number on each new Change Request form.

TIA!

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-20T06:56:52.913

没有内置方法可以做到这一点，但有几种方法可以实现您想要的（数据库查询或 SPList 查询）。但是这种请求在某种程度上听起来像是解决另一个问题的解决方法。数量增加的常见情况是：

*   唯一 ID
*   计算请求
*   使外部列表可引用（与 ID 相同）
*   使 ID 可猜测（时间戳不可）

如果您需要 ID：在大多数情况下，您不必使用整数 ID。只需使用表单标题作为自然 ID。（例如客户+时间戳）

如果您需要可猜测的 ID，则需要它们是因为外部系统想要访问或引用请求。在这种情况下，请尝试将拉动方向更改为推送方向（例如，通过使用工作流）或让您的其他系统提供“getID”函数，您的表单可以调用该函数以获得已知 ID（无需猜测）。

无论如何 - 对我来说，看起来你想实现这个来解决其他一些问题。也许这个问题也有不同的解决方案？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-09-17T14:54:50.843

您可以在要自动编号的表单上的文本标题中输入一个标记，例如#num#，然后使用 javascript 或 jquery 查找这些标记并用递增的数字替换它们。

这样做的缺点是，如果您将列表导出到 excel，则标记不会被转换为数字。但它是屏幕渲染的一个很好的解决方案。

使用 Firebug 找出包含您的自动编号标签的容器的类别。也许你可以做这样的*事情*：

```
function TokenReplacement(){
    var ClassName = 'ms-formlabel';
    var elements = new Array();
    var elements = document.getElementsByTagName('td'); 
    var numerator=0;
    //Now do find and replace on everything else
    for(var e=0;e<elements.length;e++){
        thiselement = elements[e];
        if(thiselement.className == ClassName){
            //autonumber the questions by replacing the #num# token
            if(thiselement.innerHTML.search('#num#') > -1){
                numerator++
                var replacenum = "<b>" + numerator + ".&nbsp;&nbsp;</b>";
                thiselement.innerHTML = elements[e].innerHTML.replace('#num#',replacenum);  
            }
        }
    }
} 
```

# c++ - 与 C++ 中循环中的更改值进行比较是一种好的形式吗？

> ID：767099
> 
> 赞同：1
> 
> 时间：2009-04-20T06:14:52.017
> 
> 标签：c++, merge, vector, coding-style, member-functions

毫无疑问，你们中的一些人已经看过我最近的帖子，都是关于同一个程序的。我一直遇到问题。重申一下：还在学习，不是很高级，不太了解指针，没有上课，根本不懂OOP概念等。这段代码只是将两个排序的向量fray和sarray合并为一个排序的向量向量。至少，我希望它是这样做的。告诉我：

```
 //int num is to find the size of the original vector and
    //build up farray and sarray; not used in the merge process
    int num = original.size() 
    std::vector<int> final;

    std::vector<int>::iterator it = farray.begin();
    std::vector<int>::iterator iter = sarray.begin();

    //farray.size() == (0 thru (num / 2))
    //sarray.size() == ((num / 2) thru num)
    for (;it != farray.end() && iter != sarray.end();) {
        if (*it > *iter) {
            final.push_back(*it);
            it++;
        }    
        else
        {
            final.push_back(*iter);
            iter++;
        }

            if (it == farray.end()) {
                for (int i = 0; iter < sarray.end(); i++) {
                    final.push_back(*iter);
                }
            }

            if (iter == sarray.end()) {
                for (int i = 0; it < farray.end(); i++) {
                    final.push_back(*iter);
                }
            }
        } 
```

我重写了我的合并排序函数的合并部分，以便......好吧，让它工作。我实际上对这段代码有几个问题：

1.  如果 for 循环在下一次传递时可能会改变它们，那么将我的最后两个 if 语句与 std::vector::iterators it && iter 进行比较是一种好的形式吗？
2.  iter 的值是否会在此循环的最后一次通过时发生变化并搞砸我的代码？将我的最后一个 if 语句放在 *it 和 *iter 比较之前吗？
3.  end() 成员函数是否引用了调用它的最后一个值？似乎它可能会以某种方式延伸过去。

编辑：我明天会回复所有回复，所以如果你想听更多，请回来查看。已经过了午夜。晚安。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-20T06:55:08.113

1\. 可以将来自同一容器的迭代器与 for 循环条件进行比较，但这仅在您在 for 循环语句的增量部分或 for 循环本身的主体中移动一个或其他迭代器时才有意义。在这个 for 循环中，您可以比较`iter`，`sarray.end()`但 for 循环永远不会改变`iter`。这意味着要么没有迭代，要么 for 循环永远不会终止。此外，您可能想要使用`!=`而不是`<`用于比较。`==`并`!=`为所有迭代器工作，`<`不是。

```
 for (int i = 0; iter != sarray.end(); i++) {
                final.push_back(*iter);
            } 
```

从`iter`您希望循环开始的地方开始，您可能需要这样的东西：

```
 for (; iter != sarray.end(); ++iter) {
                final.push_back(*iter);
            } 
```

由于您仍在学习（尽管我们不是所有人！），通过这样的算法工作可能具有指导意义，但您应该知道`std::merge`哪个可能会满足您的需求。

```
std::merge( farray.begin(), farray.end(), sarray.begin(), sarray.end(), std::back_inserter( final ) ); 
```

（你需要`#include <iterator>`和`<algorithm>`。）

2\. 我没有看到在外部 for 循环中增加 iter 或它会使后面的 for 循环中的逻辑无效，即 1\. 中的点。

3\. `end()`指向容器末尾的一个，因此您可以将其用于循环终止检查，但您不应该尝试取消引用“ `==`”到“ `.end()`”的迭代器。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-20T06:58:43.940

我没有检查你的算法的实现，我只是参考你的三个问题：

1.  迭代器很像指向容器值的指针。这就像在 for 循环中使用 size_t i 然后 ++i 一样。你会觉得比较 farray[i] 和 sarray[i] 有问题吗？可能不是，因此没关系。
2.  我在这里看到您在代码中所做的是，您只是读取了 *it 和 *iter 的值，实际上并没有更改它们，因此它们不会更改。
3.  end() 指向一个无效的地方。它不指向最后一个值，而是指向“之后”。如果你愿意，它就像“NULL”，因此如果(iter == sarray.end()) 为真，如果你写 *iter，你会崩溃，因为你不能取消引用等于 end() 的迭代器。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-20T06:56:59.823

一些一般性建议：您需要考虑变量名称。称您的迭代器为“it”和“iter”有时会让您感到困惑。事实上，如果你仔细观察，它已经有了。如果“farray”和“sarray”是有意义的名称，那么“fiter”和“siter”怎么样。

另外，考虑一下合并排序在做什么。最后两个块只是为了“排空”哪个迭代器还剩下一些东西。所以他们不需要在第一个循环中。

我可能会把它写成（伪代码）：

```
while not (list1.empty and list2.empty):
    if list1.empty:
        result.push(list2.pop)
    else if list2.empty:
        result.push(list1.pop)
    else if list1.top > list2.top:
        result.push(list2.pop)
    else:
        result.push(list1.pop) 
```

或者在有点生锈的货物崇拜的 C++ 中：

```
std::vector<int>::iterator fiter = farray.begin();
std::vector<int>::iterator siter = sarray.begin();

while (fiter != farray.end() || siter != sarray.end()) {
    if (fiter == farray.end())      final.push_back(*siter++);
    else if (siter == sarray.end()) final.push_back(*fiter++);
    else if (*fiter > *siter)       final.push_back(*siter++);
    else                            final.push_back(*siter++);
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-20T12:28:33.757

你有几件事要考虑。

首先，如果要合并两个范围，最好使用[std::merge](http://msdn.microsoft.com/en-us/library/9ew9xdb2.aspx)函数，而不是自己滚动。

您的代码有点难以阅读，因为您使用不同的缩进样式以及花括号的位置。选择一种风格并坚持下去。

for 循环的第一部分似乎是合并的正确实现：

```
for (;it != farray.end() && iter != sarray.end();) {
    if (*it > *iter) {
        final.push_back(*it);
        it++;
    }    
    else
    {
        final.push_back(*iter);
        iter++;
    } 
```

...这应该是完成工作所需的全部内容。

循环的第二部分有几个问题：

```
 for (;it != farray.end() && iter != sarray.end();) {
         :   :
            if (it == farray.end()) {
                for (int i = 0; iter < sarray.end(); i++) {
                    final.push_back(*iter);
                }
            }

            if (iter == sarray.end()) {
                for (int i = 0; it < farray.end(); i++) {
                    final.push_back(*iter);
                }
            }
        } 
```

一方面，for() 条件的编写使得两者都`it`不能`iter`指向`end()`它们各自集合的 ，否则循环结束。所以`it`can never point to `sarray.end()`, `iter`can never point to `farray.end()`, 任何`if`语句都不能触发。它们都是死的（无法访问的）代码。

但即使它们不是死代码，它们也有错误。`for(...)`当迭代器指向集合的末尾时，条件中的条件会中断循环，但是这个迭代器永远不会移动，所以你有一个无限循环。

同样，这两个`for(...)`s 都是不需要的死代码，因为迭代器永远不能指向向量的末尾。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-20T12:47:28.110

一个简单的评论：为什么不使用`while (condition)`而不是`for(; !condition; )`.

后者的构造是非标准的，难以理解！

# apache-flex - Problem with pulling out icons from resource bundle in Flex

> ID：767100
> 
> 赞同：2
> 
> 时间：2009-04-20T06:16:06.193
> 
> 标签：apache-flex, resourcemanager

I'm having trouble with getting icons from resource bundle in Flex. Here's the scenario:

Directory structure looks like this:

```
 -ResourceManagerTest
   -resources
     -icons
       -icon1.png
       -icon2.png
       -icons.properties
 -src
   -MyButton.as
   -ResourceManagerTest.mxml 
```

In icons.properties I have:

```
CIRCLE_FILLED=Embed("icon1.png")
CIRCLE_CONTOUR=Embed("icon2.png") 
```

I'd like to create ToggleButtonBar with buttons whose icons are pulled out from resource bundle.

Here's the source of programmatically created button:

```
package
{
    import mx.resources.ResourceManager;

    public class MyButton extends Object
    {
    public var icon:Class;
    public function MyButton()
    {
        super();
        icon = ResourceManager.getInstance().getClass("icons", "CIRCLE_FILLED");
    }

} 
```

}

And here is ResourceManagerTest where I define the ToggleButtonBar:

```
<mx:WindowedApplication xmlns:mx="http://www.adobe.com/2006/mxml" 
layout="absolute"
creationComplete="onCreationComplete()">

<mx:Script>
    <![CDATA[
        [Bindable]
        public var dataProvider:Array;

        public function onCreationComplete():void {

            dataProvider = new Array();
            dataProvider.push(new MyButton());
            dataProvider.push(new MyButton());
            tgb.dataProvider = dataProvider;
        }

    ]]>
</mx:Script>

<mx:ToggleButtonBar id="tgb"/> 
```

Buttons do appear, however without any icons. What am I doing wrong?

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-07-07T01:28:17.677

The best resource I've found for information about how to setup ResourceBundle in Flex 3 is "[Using Resources](http://livedocs.adobe.com/flex/3/html/help.html?content=l10n_4.html)" in Adobe's livedocs.

```
[ResourceBundle("icons")] 
```

In addition to including the resource bundle, you need to make sure you include the resource path at compile time. Read Adobe's docs for more information.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-20T07:31:51.753

首先，您似乎没有在构建中包含资源包。你可能需要类似的东西

```
<mx:Metadata>
        [ResourceBundle("RegistrationForm")]
</mx:Metadata> 
```

在 MXML 或只是

```
[ResourceBundle("RegistrationForm")] 
```

在你班上名列前茅

完成此操作后，请确保您拥有捆绑包...尝试仅添加一个字符串资源，看看是否可以得到它。如果您有捆绑包但它仍然无法使用，请为您的图标使用不同的路径。它们可能与资源无关（如果不玩它，我永远记不起什么是相对于什么的）。

# c# - C# 泛型

> ID：767101
> 
> 赞同：0
> 
> 时间：2009-04-20T06:16:30.313
> 
> 标签：c#, generics

我有一个 Read 通用函数，它可以很好地完成它的工作。它从字节缓冲区中读取并返回特定类型

```
public static T Read<T>()
{
    // An T[] would be a reference type, and a lot easier to work with.
    T[] t = new T[1];

    // Marshal.SizeOf will fail with types of unknown size. Try and see...
    int s = Marshal.SizeOf(typeof(T));
    if (index + s > size)
        // Should throw something more specific.
        throw new Exception("Error 101 Celebrity");

    // Grab a handle of the array we just created, pin it to avoid the gc
    // from moving it, then copy bytes from our stream into the address
    // of our array.
    GCHandle handle = GCHandle.Alloc(t, GCHandleType.Pinned);
    Marshal.Copy(dataRead, index, handle.AddrOfPinnedObject(), s);

    index += s;

    // Return the first (and only) element in the array.
    return t[0];
} 
```

问题：Write 函数怎么做？

```
public static T Write<T>()
{
    // An T[] would be a reference type, and a lot easier to work with.
    T[] t = new T[1];

    // Marshal.SizeOf will fail with types of unknown size. Try and see...
    int s = Marshal.SizeOf(typeof(T));
    if (index + s > size)
        // Should throw something more specific.
        throw new Exception("Error 101 Celebrity");

    // Grab a handle of the array we just created, pin it to avoid the gc
    // from moving it, then copy bytes from our stream into the address
    // of our array.
    GCHandle handle = GCHandle.Alloc(dataWrite, GCHandleType.Pinned);
    Marshal.Copy(t, index, handle.AddrOfPinnedObject(), s); // ?? Problem

    index += s;
} 
```

“t”应该是 byte[] 数组。我该如何做到这一点？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-20T06:49:16.240

有很多代码要放在 SO 上，但是就在这里。Marshal.Copy 有一些重载可以满足您的需求。

```
class Program
{
    static void Main(string[] args)
    {
        TestStruct test = new TestStruct();
        test.Bar = 100;
        test.Foo = 200;

        using (MemoryStream ms = new MemoryStream())
        {
            using (ObjectStream os = new ObjectStream(ms, false))
            {
                os.Write(test);
            }
            ms.Seek(0, SeekOrigin.Begin);
            Console.WriteLine(BitConverter.ToString(ms.ToArray()));
            using (ObjectStream os = new ObjectStream(ms, false))
            {
                TestStruct result = os.Read<TestStruct>();
                Console.WriteLine(result.Bar);
                Console.WriteLine(result.Foo);
            }
        }

        Console.ReadLine();
    }
}

struct TestStruct
{
    public int Foo;
    public int Bar;
}

class ObjectStream : Stream
{
    private Stream _backing;
    private bool _ownsStream = true;

    public ObjectStream(Stream source)
        :this(source, true)
    {
    }

    public ObjectStream(Stream source, bool ownsStream)
    {
        if (source == null)
            throw new ArgumentNullException("source");

        _backing = source;
        _ownsStream = ownsStream;
    }

    public override bool CanRead
    {
        get
        {
            return _backing.CanRead;
        }
    }

    public override bool CanSeek
    {
        get
        {
            return _backing.CanSeek;
        }
    }

    public override bool CanWrite
    {
        get
        {
            return _backing.CanWrite;
        }
    }

    public override void Flush()
    {
        _backing.Flush();
    }

    public override long Length
    {
        get
        {
            return _backing.Length;
        }
    }

    public override long Position
    {
        get
        {
            return _backing.Position;
        }
        set
        {
            _backing.Position = value;
        }
    }

    public override int Read(byte[] buffer, int offset, int count)
    {
        return _backing.Read(buffer, offset, count);
    }

    public override long Seek(long offset, SeekOrigin origin)
    {
        return _backing.Seek(offset, origin);
    }

    public override void SetLength(long value)
    {
        _backing.SetLength(value);
    }

    public override void Write(byte[] buffer, int offset, int count)
    {
        _backing.Write(buffer, offset, count);
    }

    /// <summary>
    /// Writes a value type to the stream.
    /// </summary>
    /// <typeparam name="T">The type of value.</typeparam>
    /// <param name="value">The value.</param>
    /// <returns>The number of bytes written to the stream.</returns>
    public int Write<T>(T value)
    {
        // An T[] would be a reference type, and alot easier to work with.
        T[] t = new T[1];
        t[0] = value;

        // Marshal.SizeOf will fail with types of unknown size. Try and see...
        int s = Marshal.SizeOf(typeof(T));
        // Create a temp array.
        byte[] target = new byte[s];

        // Grab a handle of the array we just created, pin it to avoid the gc
        // from moving it, then copy bytes from our stream into the address
        // of our array.
        GCHandle handle = GCHandle.Alloc(t, GCHandleType.Pinned);
        Marshal.Copy(handle.AddrOfPinnedObject(), target, 0, s); // ?? Problem

        // Write to the stream.
        Write(target, 0, s);

        return s;
    }

    /// <summary>
    /// Reads a value type from the stream.
    /// </summary>
    /// <typeparam name="T">The type to read.</typeparam>
    /// <returns>The data read from the stream.</returns>
    public T Read<T>()
    {
        // An T[] would be a reference type, and alot easier to work with.
        T[] t = new T[1];

        // Marshal.SizeOf will fail with types of unknown size. Try and see...
        int s = Marshal.SizeOf(typeof(T));
        byte[] target = new byte[s];

        // Make sure there is enough data.
        if (Read(target, 0, s) != s)
            throw new InvalidDataException("Not enough data.");

        // Grab a handle of the array we just created, pin it to avoid the gc
        // from moving it, then copy bytes from our stream into the address
        // of our array.
        GCHandle handle = GCHandle.Alloc(t, GCHandleType.Pinned);
        Marshal.Copy(target, 0, handle.AddrOfPinnedObject(), s);

        // Return the first (and only) element in the array.
        return t[0];
    }

    protected override void Dispose(bool disposing)
    {
        if (disposing && _ownsStream)
            _backing.Dispose();
        base.Dispose(disposing);
    }
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-20T06:54:04.340

和上次一样，你可能想使用 BinaryWriter 类。

```
public void Write<T>(T item) {
    // An T[] would be a reference type, and alot easier to work with.
    T[] t = new T[] { item };

    // Marshal.SizeOf will fail with types of unknown size. Try and see...
    int s = Marshal.SizeOf(typeof(T));
    if (_index + s > _size)
        // Should throw something more specific.
        throw new Exception("Error 101 Celebrity");

    // Grab a handle of the array we just created, pin it to avoid the gc
    // from moving it, then copy bytes from our array into the stream.
    GCHandle handle = GCHandle.Alloc(t, GCHandleType.Pinned);
    Marshal.Copy(handle.AddrOfPinnedObject(), _stream, _index, s);

    _index += s;
} 
```

# asp.net-mvc - When to use a Presentation Model in ASP.NET MVC?

> ID：767102
> 
> 赞同：3
> 
> 时间：2009-04-20T06:16:41.840
> 
> 标签：asp.net-mvc

Imagine a blog engine in ASP.NET MVC where I want strongly-typed Views. I have a Model for BlogPost and a Model for Comments. A typical page would display a blog post and all of that post's comments. What object should I pass to the View()? Should I create a Presentation Model? Maybe I'm using that term incorrectly, but by that I mean should I create a composite model just for a View(), something like BlogAndComments? Should my controller create an instance of BlogAndComments and pas that?

Or, should I somehow pass both a BlogPost and Comments object to the View?

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-20T06:48:31.717

我认为您对演示模型的理解是正确的。至于何时应该创建视图模型，答案可能是“视情况而定”。在您的示例中，您可能可以在 ViewData 对象中传递 BlogPost 和 Comments 。它并不华丽，但是，嘿，它完成了工作。

当以及如果开始觉得丑陋或笨拙，那么我会开始考虑制作一个视图模型。我通常以某种“页面”的概念结束，其中包括页面标题、公共数据，然后是特定页面的特定内容。在您的情况下，这可能最终成为一个 BlogViewPage，其中包括 Title、BlogPost 和 List 评论。

这种方法的好处是，您可以通过发出请求并测试 BlogViewPage 来测试该控制器，以确保它包含预期的数据。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-02-09T18:42:15.160

我总是使用强类型视图并为每个视图或视图用户控件创建一个表示模型类。优点是，通过单独查看表示模型类，我可以确切地知道视图使用的值是什么。如果我正在传递域模型，那么这并不明显，因为域模型可能包含许多视图不使用的属性。我将不得不查看视图的标记以确定它需要什么值。此外，表示模型通常会添加某些域模型中不可用的属性。这似乎有点乏味，但我认为从长远来看它可以节省时间并使代码更好。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-20T10:20:31.113

在我看来，评论与帖子本身一样属于观点。

为您的评论创建一个 BL 课程，例如：

```
class CommentBO
{
    Guid UserID;
    string Text;
} 
```

然后，您的帖子就有了 BO。

```
class PostBO
{
    Guid UserID;
    List<CommentBO> Comments;
} 
```

那么你的模型可以非常简单。

```
class BlogModel
{
    string AuthorName;
    string BlogTitle;

    List<PostBO> Posts;
} 
```

将它传递给视图并渲染它。

您可能会想省略所有 BO 并直接从数据库中填充模型。这是一种选择，但并不完全正确。模型只是一个视图显示的东西包。然而，这些事情应该在其他地方准备好，即在业务逻辑级别，控制器只是名义上的参与。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-20T15:14:18.990

在我看来，如果评论属于博客文章，为什么不在博客文章模型上创建评论集合呢？从域建模的角度来看，这非常有意义，并且您使用的任何 ORM 都可能支持延迟加载该集合，这也简化了您的控制器逻辑。

# visual-studio-2003 - 无法在 Visual Studio 2003 中创建 Web 应用程序

> ID：767104
> 
> 赞同：0
> 
> 时间：2009-04-20T06:17:11.293
> 
> 标签：visual-studio-2003

我无法通过 Visual Studio 2003 创建新的 Web 应用程序。当我尝试创建 Web 应用程序时，我收到类似“找不到用于与 FrontPage 服务器扩展通信的组件”的错误。同时我可以创建 Windows 应用程序。请帮我解决这个...

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-20T16:04:58.103

我会检查你是否在你的网络服务器上安装了 Front-Page 扩展。在控制面板中，转到*Add/Remove Programs*并切换到*Add/Remove Windows Components*。双击*Internet 信息服务 (IIS)*，您将看到列出的*Front Page Server Extensions 。*应该检查它，如果没有然后检查它并接受更改，您将需要您的安装媒体来完成更新，除非它们被复制到您的硬盘驱动器。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-20T06:27:35.620

您可以尝试重新安装 Visual Studio 2003。听起来有些 DLL 可能已经消失了。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-11T08:39:06.913

我已经卸载了 IIS 和 VS2003，然后安装了 IIS，然后安装了 VS 2003……现在它工作正常……问题是因为我先安装了 VS2003，然后安装了 IIS……所以请确保我们必须先安装 IIS……谢谢

# javascript - 在javascript中将剪贴板数据作为数组获取

> ID：767105
> 
> 赞同：0
> 
> 时间：2009-04-20T06:18:00.683
> 
> 标签：javascript, clipboard

有没有办法在 JavaScript 中操作剪贴板数据？

还有一种方法可以实现视觉工作室***

> ***Ctrl+Shift+V***

循环粘贴剪贴板数据的选项？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-20T06:27:58.117

您可以通过 Javascript 复制/粘贴剪贴板内容。检查此链接

[http://www.geekpedia.com/tutorial126_Clipboard-cut-copy-and-paste-with-JavaScript.html](http://www.geekpedia.com/tutorial126_Clipboard-cut-copy-and-paste-with-JavaScript.html)

对不起，我不明白第二个问题:(

# winapi - 使用 DDC 在 Windows 上检测 VGA 显示器？

> ID：767112
> 
> 赞同：2
> 
> 时间：2009-04-20T06:20:44.250
> 
> 标签：winapi, vga

Windows 是否提供任何 api 调用来检测显示器当前是否使用 DDC I 或 DCC 2 连接到 VGA 端口？

我试图找出一种方法来了解显示器是否已连接并打开。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-20T06:57:47.593

调用[EnumDisplayDevices](http://msdn.microsoft.com/en-us/library/dd162609(VS.85).aspx)函数。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-07-21T13:40:42.390

不是免费的解决方案，但到目前为止我能找到的唯一一个：

[http://www.nicomsoft.com/wini2cddc/](http://www.nicomsoft.com/wini2cddc/)

# vb.net - How to append new node to existing node in xml

> ID：767126
> 
> 赞同：0
> 
> 时间：2009-04-20T06:28:05.340
> 
> 标签：vb.net

Following is my xml file code

> ```
> <XMLFile>
>  <EMail>
>  <From>
>   <Address>dddd@acd.com</Address>
>  </From>
>  <Receipent> <To>eeee@qwe.com</To> </Receipent>
>   <Subject>fffffsadasd</Subject> 
>   <Body>ggggasdsd</Body> 
>   </EMail>
>   </XMLFile> 
> ```

i hve a sent button.On clicking that button each time i want to append Enail node and correponding childnodes to existing xml file. In sent buttonclick i hve written following code.

```
Dim currNode As XmlNode
        Dim doc As New XmlDocument

        doc.LoadXml(("<XMLFile>" + " <EMail></EMail>" + "</XMLFile>"))
        Dim docFrag As XmlDocumentFragment = doc.CreateDocumentFragment()
        docFrag.InnerXml = "<From>" + " <Address>" + txtFrom.Text + " </Address>" + "</From>"
        currNode = doc.DocumentElement.FirstChild
        currNode.InsertAfter(docFrag, currNode.LastChild)

        docFrag.InnerXml = "<Receipent>" + " <To>" + txtTo.Text + " </To>" + "</Receipent>"
        currNode = doc.DocumentElement.FirstChild
        currNode.InsertAfter(docFrag, currNode.LastChild)

        docFrag.InnerXml = "<Subject>" + txtSubject.Text + "</Subject>"
        currNode = doc.DocumentElement.FirstChild
        currNode.InsertAfter(docFrag, currNode.LastChild)

        docFrag.InnerXml = "<Body>" + txtBody.Text + "</Body>"
        currNode = doc.DocumentElement.FirstChild
        currNode.InsertAfter(docFrag, currNode.LastChild)

        doc.Save("C:\xmlmailfile.xml") 
```

What modification i have to make in button click

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-20T06:58:49.633

像这样的事情应该这样做。XMLTextWriter 可能更适合您的目的：

```
Private Function GenerateXML(ByVal emails As List(Of Email)) As String

    Dim sb As New System.Text.StringBuilder

    Using sw As New IO.StringWriter(sb), xt As New Xml.XmlTextWriter(sw)

        xt.WriteStartElement("xmlDoc")

        For i As Integer = 0 To emails.Count - 1

            xt.WriteStartElement("email")

            xt.WriteStartElement("From")
            xt.WriteElementString("address", emails(i).From)
            xt.WriteEndElement()

            xt.WriteStartElement("Receipent")
            xt.WriteElementString("to", emails(i).Recipient)
            xt.WriteEndElement()

            xt.WriteElementString("subject", emails(i).Subject)
            xt.WriteElementString("body", emails(i).Body)

            xt.WriteEndElement()

        Next

        xt.WriteEndElement()

    End Using

    Return sb.ToString

End Function 
```

**编辑：**

这需要错误处理等，但应该适合你。在某些情况下它会中断（例如，如果文件存在但为空），您需要自己解决。

```
Module consoleTestApp

    Private _path As String = "c:\output.xml"

    //Just pretend these are text boxes
    Public txtFrom As String
    Public txtRecipient As String
    Public txtSubject As String
    Public txtBody As String

    Sub Main()

        txtFrom = "from1"
        txtRecipient = "rec1"
        txtSubject = "subj1"
        txtBody = "body1"

        AddNewEmail()

        txtFrom = "from2"
        txtRecipient = "rec2"
        txtSubject = "subj2"
        txtBody = "body2"

        AddNewEmail()

    End Sub

    Private Sub AddNewEmail()

        If Not IO.File.Exists(_path) Then

            Using xt As New Xml.XmlTextWriter(_path, System.Text.Encoding.UTF8)

                xt.WriteStartElement("xmlDoc")
                xt.WriteEndElement()

            End Using

        End If

        Dim xD As New Xml.XmlDocument
        xD.Load(_path)

        Dim xN As Xml.XmlNode = xD.CreateNode(Xml.XmlNodeType.Element, String.Empty, "email", String.Empty)
        xN.InnerXml = GenerateXML()

        xD.SelectSingleNode("//xmlDoc").AppendChild(xN)
        xD.Save(_path)

    End Sub

    Private Function GenerateXML() As String

        Dim sb As New System.Text.StringBuilder

        Using sw As New IO.StringWriter(sb), xt As New Xml.XmlTextWriter(sw)

            xt.WriteStartElement("From")
            xt.WriteElementString("address", txtFrom)
            xt.WriteEndElement()

            xt.WriteStartElement("Receipent")
            xt.WriteElementString("to", txtRecipient)
            xt.WriteEndElement()

            xt.WriteElementString("subject", txtSubject)
            xt.WriteElementString("body", txtBody)

        End Using

        Return sb.ToString

    End Function

End Module 
```

# apache - Glassfish with Apache. Why SSL?

> ID：767138
> 
> 赞同：2
> 
> 时间：2009-04-20T06:34:39.973
> 
> 标签：apache, ssl, glassfish

I have been looking around to figure out how to configure Glassfish front ended with Apache. And most of the tutorials using the load balancing plug in is making me enable SSL on Apache. I am trying to understand the connection. I should be able to do non SSL communications when I dont have a need for SSL.

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-23T07:08:17.837

有几篇博客文章展示了如何在 Glassfish 前使用 Apache。有多种选择，根据您的需要，不同的策略可能是最合适的。

我已经将 Apache 与 mod_jk 一起使用，它将请求转发到 Glassfish - https 和常规 http。[这里](http://www.google.com/search?q=glassfish+mod_jk)有很多很好的参考资料。

也可以在 Apache 中使用其他模块，例如 mod_proxy，但同样，您的要求将充实最合适的。

Glassfish 内部也有相当不错的 http 引擎，您可以在其中配置[虚拟主机](http://docs.sun.com/app/docs/doc/820-4335/ablsw?a=view)，如在 apache 中。如果 Glassfish 服务器上的负载不是很大，您可以考虑只使用 Glassfish，而不需要任何东西。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-02T19:18:35.130

您还可以使用[Sun Java System Web Server SJSWS](http://www.sun.com/software/products/web_srvr/)代替 Apache。尽管它的名字很糟糕，但它只是 Sun 的 Web 服务器（免费使用）。它可以用作[反向代理 (PDF)](http://www.sun.com/software/whitepapers/javaenterprisesystem/web_infra_reverse_proxy.pdf)。Sun 对 SJWS/Glassfish 组合进行了很好的测试。

# javascript - Variable for img src=

> ID：767143
> 
> 赞同：12
> 
> 时间：2009-04-20T06:40:27.150
> 
> 标签：javascript, image, src

I have a question. Firstly, I am not going to pretend that I know what I am talking about here. I am a newbie to http and JavaScript.

I think my question may be answered in this post [IMG SRC tags and JavaScript](https://stackoverflow.com/questions/116967/img-src-tags-and-javascript) but I thought I would explain the exact thing I am trying to achieve in case there is an easier way.

I have a webpage, I want to display an image on it. Only thing is, the image is coming from an automated system monitor, the image is automatically generated each day and placed in a new directory depending on date.

e.g. On April 4 = "[http://host/partition/2009/apr/04/cpu.gif](http://host/partition/2009/apr/04/cpu.gif)"
e.g. On April 5 = "[http://host/partition/2009/apr/05/cpu.gif](http://host/partition/2009/apr/05/cpu.gif)"

To facilitate this, I have created some basic JavaScript to give me the date in the format I need it. I have all that working. Now I just want to use that variable I created to show the image. I have the JavaScript code stored in a function called displaydate() If I do this `<script language="JavaScript"> displaydate() </script>` I see "[http://host/partition/2009/apr/05/cpu.gif](http://host/partition/2009/apr/05/cpu.gif)" and that is correct.

Now how do I display this on the site correctly?

```
 <a href="displaydate()"><img src="displaydate()" </a></td>    //This does not work. I am just adding it to show where I have been heading. 
```

P.S. I have read a lot of pages on this and been trying a lot of things, but have had no luck so far. Any help, would be much appreciated.

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-04-20T06:47:06.150

是的，该页面可能确实回答了您的问题。基本上，你想要这个 javascript：

```
<script type="text/javascript">
document.getElementById('image').src = "yourpicture.png";
</script> 
```

除了你想用你写的函数替换“yourpicture.png”来生成磁盘上图像的正确路径，所以......

```
<script type="text/javascript">
document.getElementById('image').src = displaydate();
</script> 
```

当然，您可能需要根据自己的用途对其进行一些修改，无论 < img > 标签的 id 属性是什么，getElementById 都会作为参数。您可能希望在页面加载后执行上述 javascript，即：

```
<html>
<head>
<script type="text/javascript">
function load()
{
document.getElementById('image').src = displaydate();
}

function displaydate()
{
//your displaydate() function here
}
</script>
</head>

<body onload="load()">

<img src="nothing.jpg" id="image" name="image"/>
</body>
</html> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-24T12:42:28.217

你应该只需要改变这一行

```
document.write("http://host1/Shared/" + year + "/" + month + "/" + day + "/cpu_abs.gif"); 
```

至

```
return "http://host1/Shared/" + year + "/" + month + "/" + day + "/cpu_abs.gif"; 
```

# apache-flex - format the number

> ID：767144
> 
> 赞同：0
> 
> 时间：2009-04-20T06:40:32.563
> 
> 标签：apache-flex, actionscript-3

how to decrease the number of digits before decimal point in action script. for example 10000 means it prints only 10 and 12345=12; 90000=90;

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-20T06:45:07.187

[整数除以](http://codingforums.com/showthread.php?t=58799)1000。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-20T10:49:30.250

这在一定程度上取决于您处理的数字类型（uint、int 或 Number），以及您是否想将数字减少**设定****数量**或设定数量。在 Number 的情况下，您希望如何处理小数点后的数字。该代码将 uint 减少到一定数量的数字。

 **```
trace(ReduceToDigitLength(10000, 2)); //traces 10
trace(ReduceToDigitLength(12345, 2)); //traces 12
trace(ReduceToDigitLength(90000, 2)); //traces 90
trace(ReduceToDigitLength(1235, 2)); //traces 12
trace(ReduceToDigitLength(15, 2)); //traces 15
trace(ReduceToDigitLength(9, 2)); //traces 9
//...
function ReduceToDigitLength(value:uint, length:uint):uint
{
    var digitLength:uint = value.toString().length;

    if (digitLength <= length)
        return value;

    return RemoveDigits(value, digitLength - length);
}

function RemoveDigits(value:uint, digitsToRemove:uint):uint
{
    return Math.floor(value / Math.pow(10, digitsToRemove));
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-20T07:00:23.747

尝试：

```
var i: int = j / 1000 
```

当然，除非您的意思是减少小数点前的位数，但*保持*<1 的数量？

所以： 10000*.123* 意味着它只打印 10 *.123*和 12345*.8*=12*.8*; 90000*.999*=90*.999*；

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-20T23:52:54.140

要减少小数点*前*的位数，只需除以 10 的倍数。如果这确实是一个数字并且您想要一个整数，您可能希望通过强制转换为 int 或 uint 来降低数字（取决于性质数字本身）。请注意， Math.floor 将返回另一个 Number 并且不会对您有太大帮助，因为它可能仍会产生带有非常小的小数位的输出。

要在 MXML 中更好地控制格式，请查看框架中的格式类：http: [//livedocs.adobe.com/flex/3/langref/mx/formatters/NumberFormatter.html](http://livedocs.adobe.com/flex/3/langref/mx/formatters/NumberFormatter.html)

# asp-classic - 在经典 ASP 中使用 Web 服务

> ID：767145
> 
> 赞同：1
> 
> 时间：2009-04-20T06:40:58.320
> 
> 标签：asp-classic

以下代码在 Win Server 2003 机器上不适用于我，但适用于 XP。我已经在服务器上安装了 SOAP Toolkit 3.0。可能是什么原因？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-06-16T04:47:54.173

'这是在经典 ASP 中使用 .NET Web 服务的另一种方式。

```
<html>
    <head><title></title></head>
    <body>

    <%    
        Dim objHTTP, strEnvelope
        Set objHTTP = Server.CreateObject("Microsoft.XMLHTTP")

        'Create the SOAP Envelope.
        'Start with standard xml name space and XML Schema Definition.
        strEnvelope = "<?xml version='1.0' encoding='utf-8'?>"
        strEnvelope = strEnvelope & "<soap:Envelope xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xmlns:xsd='http://www.w3.org/2001/XMLSchema' xmlns:soap='http://schemas.xmlsoap.org/soap/envelope/'>"

        'Define body of SOAP with method name and parameter names and vlaues to be passed.
        strEnvelope = strEnvelope & "<soap:Body>"
        strEnvelope = strEnvelope & "<AuthenticateUser xmlns='http://wwwte.abc.com/cpp'>"
        strEnvelope = strEnvelope & "<db>1</db>"
        strEnvelope = strEnvelope & "<_username>MYUSERNAME</_username>"
        strEnvelope = strEnvelope & "<_password>MYPASSWORD</_password>"
        strEnvelope = strEnvelope & "</AuthenticateUser>"
        strEnvelope = strEnvelope & "</soap:Body></soap:Envelope>"    

        'Set properties of HTTP object and send SOAP envelop while calling 'Send' method
        Dim url
        url = "http://cpp.abc.com/cpp/CPPLDAP/CPPLDAP.asmx"
        With objHTTP
            .Open "post", url, False
            .setRequestHeader "Content-Type", "text/xml; charset=utf-8"
            .setRequestHeader "SOAPAction", "http://wwwte.abc.com/cpp/AuthenticateUser"
            .send strEnvelope
        End With
        ' Following will write xml received from web services in the browser
        Dim strResponse
        strResponse = objHTTP.responseXML.Text
        If (strResponse = "") Then
            Response.Write("Invalid user")
        Else        
            Set myXmlDoc = Server.CreateObject("MSXML2.DOMDocument")
            myXmlDoc.loadXML (strResponse)
            Set objLst = myXmlDoc.getElementsByTagName("directoryEntry")
            Set objListNodes = objLst.Context.childNodes(0).childNodes
            For i = 0 To (objListNodes.Length - 1)
               Response.Write(objListNodes.Item(i).nodeName & ":------ " & objListNodes.Item(i).Text)
               Response.Write("</BR>")
            Next
        End If

    %>

    </body>
</html> 
```

# git - 如何阻止 .gitignore 出现在未跟踪文件列表中？

> ID：767147
> 
> 赞同：1004
> 
> 时间：2009-04-20T06:42:27.050
> 
> 标签：git, version-control, dvcs, gitignore

我刚刚`git init`在我的新项目的根上做了一个。

然后我创建了一个`.gitignore`文件。

现在，当我键入时`git status`，**.gitignore**文件出现在未跟踪文件列表中。这是为什么？

* * *

## 回答 #1

> 赞同：1004
> 
> 时间：2009-04-20T07:11:45.857

该`.gitignore`文件应该在您的存储库中，因此确实应该按照`git status`建议添加并提交。它必须是存储库树的一部分，以便可以合并对它的更改等等。

因此，将其添加到您的存储库中，它不应该被 gitignored。

如果你真的想要，如果你不想提交它，你可以添加`.gitignore`到文件中。`.gitignore`但是，在这种情况下，最好将忽略添加到`.git/info/exclude`.gitignore 一个特殊的签出本地文件，该文件的工作方式与 .gitignore 类似，但由于它位于`.git`文件夹中，因此不会显示在“git status”中。

另请参阅[https://help.github.com/articles/ignoring-files](https://help.github.com/articles/ignoring-files)

* * *

## 回答 #2

> 赞同：286
> 
> 时间：2009-04-20T07:14:19.283

如果你想在你的 Git 树之外存储被忽略的文件列表，你可以使用*.git/info/exclude*文件。它仅适用于您对 repo 的结帐。

* * *

## 回答 #3

> 赞同：81
> 
> 时间：2009-04-20T07:58:37.743

您实际上可以在文件中放入`.gitignore`一行`.gitignore`。这将导致`.gitignore`文件被 git 忽略。我实际上并不认为这是一个好主意。我认为忽略文件应该进行版本控制和跟踪。我只是为了完整性而把它放在那里。

* * *

## 回答 #4

> 赞同：58
> 
> 时间：2009-06-10T07:46:20.723

您还可以拥有一个全局用户 git`.gitignore`文件，该文件将自动应用于您的*所有*存储库。这对于 IDE 和编辑器文件（例如Vim`swp`和文件）很有用。`*~`更改目录位置以适合您的操作系统。

1.  添加到您的`~/.gitconfig`文件中：

    ```
    [core]
    excludesfile = /home/username/.gitignore 
    ```

2.  创建一个`~/.gitignore`包含要忽略的文件模式的文件。

3.  将您的点文件保存在另一个存储库中，以便进行备份（可选）。

任何时候你复制、初始化或克隆一个 repo，你的全局 gitignore 文件也将被使用。

* * *

## 回答 #5

> 赞同：52
> 
> 时间：2011-02-09T20:19:07.487

如果有人已经将 a 添加`.gitignore`到您的存储库中，但您想对其进行一些更改并忽略这些更改，请执行以下操作：

`git update-index --assume-unchanged .gitignore`

[来源](http://justaddwater.dk/2009/12/07/how-to-make-git-ignore-files-that-already-exist-in-your-project/)。

* * *

## 回答 #6

> 赞同：37
> 
> 时间：2009-04-20T06:50:37.827

添加`.gitignore`文件并提交后，它将不再显示在“未跟踪文件”列表中。

```
git add .gitignore
git commit -m "add .gitignore file"
git status 
```

* * *

## 回答 #7

> 赞同：20
> 
> 时间：2009-09-25T03:00:21.097

以防其他人有与我们一样的痛苦。我们想排除一个已经提交的文件。

这篇文章更有用： [使用 .git/info/exclude 太晚了](https://stackoverflow.com/questions/1158857/working-with-git-info-exclude-too-late)

具体来说，您需要忽略文件实际上是使用命令 git remove 参见**git rm** ( [http://www.kernel.org/pub/software/scm/git/docs/git-rm.html](http://www.kernel.org/pub/software/scm/git/docs/git-rm.html) )

你去测试它

**`git rm --dry-run *.log`**
（如果您说要排除所有日志文件）

如果您运行它，这将输出*将被*排除的内容。

然后

你通过去运行它

**`git rm *.log`**
（或您想要的任何文件名路径/表达式）

然后`*.log`在文件中添加一行`.gitignore`。

* * *

## 回答 #8

> 赞同：17
> 
> 时间：2009-06-11T20:01:50.900

当然 .gitignore 文件会显示在状态中，因为它没有被跟踪，git 认为它是一个好吃的新文件！

但是，由于 .gitignore 是一个未跟踪的文件，因此当您将其放入 .gitignore 时，它​​会被 git 忽略！

所以，答案很简单：只需添加以下行：

```
.gitignore # Ignore the hand that feeds! 
```

到您的 .gitignore 文件！

而且，与 August 的回应相反，我应该说 .gitignore 文件*不应该*在您的存储库中。它只是碰巧*可以*，这通常很方便。这可能是 .gitignore 被创建为 .git/info/exclude 的替代品的原因，因为它没有被存储库跟踪的选项。无论如何，如何使用 .gitignore 文件完全取决于您。

作为参考，请查看 kernel.org 上的[gitignore(5) 手册页](http://git-scm.com/docs/gitignore)。

* * *

## 回答 #9

> 赞同：16
> 
> 时间：2014-07-01T10:21:57.260

首先，正如许多其他人已经说过的，你**`.gitignore`应该被 Git 跟踪**（因此不应该被忽略）。让我解释一下为什么。

（TL;DR：提交`.gitignore`文件，并使用[全局`.gitignore`](https://docs.github.com/en/free-pro-team@latest/github/using-git/ignoring-files#configuring-ignored-files-for-all-repositories-on-your-computer)忽略由您的 IDE 或操作系统创建的文件）

正如您可能已经知道的那样，Git 是一个*分布式版本控制系统*。这意味着它允许您在不同版本之间来回切换（即使开发已经分流到不同的分支），它还允许多个开发人员在同一个项目上工作。

尽管在快照之间切换时跟踪您`.gitignore`也有好处，但提交它的最重要原因是您希望与从事同一项目的其他开发人员共享文件。通过将文件提交到 Git 中，其他贡献者将`.gitignore`在克隆存储库时自动获取文件，因此他们不必担心意外提交不应提交的文件（例如日志文件、缓存目录、数据库凭据， ETC。）。如果在某个时候项目的`.gitignore`更新，他们可以简单地提取这些更改，而不必手动编辑文件。

当然，会有一些文件和文件夹是您想要忽略的，但它们是特定于您的，不适用于其他开发人员。但是，那些不应该在项目的`.gitignore`. 还有两个地方可以忽略文件和文件夹：

*   由您的操作系统或 IDE 创建的文件和文件夹应该放在一个[全局`.gitignore`](https://docs.github.com/en/free-pro-team@latest/github/using-git/ignoring-files#configuring-ignored-files-for-all-repositories-on-your-computer). 好处是这`.gitignore`适用于您计算机上的所有存储库，因此您不必为每个存储库重复此操作。它不会与其他开发人员共享，因为他们可能使用不同的操作系统和/或 IDE。
*   不属于项目的文件，也不属于`.gitignore`全局文件`.gitignore`，可以使用[显式存储库排除在`your_project_directory/.git/info/exclude`](https://docs.github.com/en/free-pro-team@latest/github/using-git/ignoring-files#excluding-local-files-without-creating-a-gitignore-file). 此文件不会与其他开发人员共享，并且特定于该单个存储库

* * *

## 回答 #10

> 赞同：15
> 
> 时间：2009-04-20T07:55:16.173

这个想法是将特定于您的项目的文件放入`.gitignore`文件中，然后（如前所述）将其添加到存储库中。例如`.pyc`和`.o`文件、测试套件创建的日志、一些固定装置等。

对于您自己的设置创建但不一定会为每个用户显示的`.swp`文件（如使用 vim 的文件、隐藏的 ecplise 目录等），您应该使用`.git/info/exclude`（如前所述）。

* * *

## 回答 #11

> 赞同：13
> 
> 时间：2011-07-19T12:46:58.860

注意以下“问题” 有时您想添加目录但在这些目录中没有文件。简单的解决方案是创建一个包含以下内容的 .gitignore：

```
* 
```

这个接缝工作正常，直到您意识到没有添加目录（如预期的那样添加到您的存储库。原因是 .gitignore 也将被忽略，因此目录是空的。因此，您应该做这样的事情：

```
*
!.gitignore 
```

* * *

## 回答 #12

> 赞同：9
> 
> 时间：2009-06-09T08:17:54.573

这似乎只适用于您当前的目录以`Git`忽略存储库中的所有文件。

更新此文件

```
.git/info/exclude 
```

用你的通配符或文件名

> ```
> *pyc
> *swp
> *~ 
> ```

* * *

## 回答 #13

> 赞同：6
> 
> 时间：2016-10-03T23:27:21.560

如果您已经签入 .gitignore 并且您想忽略对它的修改，请查看[此答案](https://stackoverflow.com/a/21756612/877682)：

> 尝试使用此命令：
> 
> ```
> git update-index --assume-unchanged FILENAME_TO_IGNORE 
> ```
> 
> 要反转它（如果您想对其进行更改），请使用：
> 
> ```
> git update-index --no-assume-unchanged 
> ```
> 
> **更新**：
> 
> 以下是如何在当前目录下列出**“假设未更改”**文件：
> 
> ```
> git ls-files -v | grep -E "^[a-z]" 
> ```
> 
> 因为该`-v`选项将使用小写字母表示“假定未更改”文件。

* * *

## 回答 #14

> 赞同：4
> 
> 时间：2014-02-06T13:39:23.867

就我而言，我想排除现有文件。仅修改**.gitignore**不起作用。我按照以下步骤操作：

```
git rm --cached dirToFile/file.php
vim .gitignore
git commit -a 
```

通过这种方式，我从缓存中清除了要排除的文件，然后将其添加到**.gitignore**。

* * *

## 回答 #15

> 赞同：3
> 
> 时间：2009-12-30T13:15:26.747

导航到 git repo 的基本目录并执行以下命令：

```
echo '\\.*' >> .gitignore 
```

所有点文件都将被忽略，包括那个讨厌的 .DS_Store 如果你在 Mac 上。

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2013-03-13T03:32:07.140

最终用户很可能希望 Git 忽略“.gitignore”文件，因为 Eclipse 创建的 IDE 特定文件夹可能与 NetBeans 或其他 IDE 不同。因此，为了保持源代码 IDE 的对抗性，可以轻松地拥有一个不与整个团队共享的自定义 git ignore，因为个别开发人员可能使用不同的 IDE。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2012-10-05T13:30:08.307

我发现对讨厌`.DS_Store`的文件设置忽略的最佳位置是在`.git/info/exclude`文件中。

当您在其中设置 git 存储库时，IntelliJ 似乎会自动执行此操作。

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2014-03-17T19:29:39.987

`.gitignore`是关于忽略*其他*文件。git 是关于文件的，所以这是关于忽略文件的。然而，当 git 处理文件时，这个文件需要作为列出其他文件名的机制存在。

如果它被称为`.the_list_of_ignored_files`它可能会更明显一点。

类比是您不想做的待办事项列表。除非您在某处列出它们，否则您不会知道它们是某种“待办事项”列表。

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2016-08-29T15:36:07.303

我认为在某些情况下忽略 .gitignore 非常有用。例如，当您有多个团队或大型团队在同一个代码库上工作时。在这种情况下，您需要有某些约定，其中一个约定是关于 git repo 中忽略的内容。它通常是关于忽略 IDE 或 OS 创建的文件和目录、一些生成的日志等。

但是，有一股力量倾向于对`.gitignore`文件进行非常规的更改。该`.gitignore`文件可能会被不负责任的人、错误地、使用的工具或在其他情况下进一步更改。

为了对此产生反作用，我们可以执行以下操作：

1.  最初的 .gitignore 应该反映团队中的约定，
2.  推送后，应通过添加 .gitignore 条目来保护 .gitignore 并再次推送该更改。`.gitignore`文件以这种方式“**密封**”。

可以仅在本地更改“**密封**”`.gitignore`文件，而无需将该更改者传播给团队的其他成员。但是，如果更改在整个团队中得到广泛同意，则可以“解封”它，更改它，然后再次“密封”它。这不可能是错误的，只能是故意的。

可悲的是，您不能 100% 避免愚蠢，但这样您就已尽一切努力防止愚蠢的事情发生。

如果你的团队相对较小，拥有非常优秀的专业人士，那么这并不重要，但即使是那些人也会很高兴能少担心一件事。

`.git/info/exclude`当您无法对基础架构设置做任何事情时，使用很酷，只需覆盖您自己的 a** 以免出错。

从正确和错误的立场来看，我投票赞成在`.gitignore`文件中添加 .gitignore 条目，让每个人都可以自由地在本地做任何他们想做的事情，但不会侵犯他人。

# c# - 在 WPF 列表框中显示图像

> ID：767148
> 
> 赞同：3
> 
> 时间：2009-04-20T06:42:54.367
> 
> 标签：c#, wpf, data-binding, .net-3.5

我正在尝试将存储在 MSSql Db 中的图像显示为 varbinary，当执行我的代码时它只是挂起自己

代码如下...

XAML

```
<Window x:Class="ImageList.Window1"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:local="clr-namespace:ImageList"
    Title="Window1" Height="331" Width="575">
    <Window.Resources>
        <local:BinaryImageConverter x:Key="imgConverter" />
    </Window.Resources>
    <StackPanel>
        <ListBox Name="lstImages" ItemsSource="{Binding}" >
            <ListBox.Resources>
                <DataTemplate x:Key="data">
                    <Image Source="{Binding Path=ImageData, Converter={StaticResource imgConverter}}"/>
                </DataTemplate>
            </ListBox.Resources>
        </ListBox>        
        <Button  Height="25" Name="button1" Click="button1_Click">Button</Button>
        <Button  Height="25" Name="button2" Click="button2_Click">Load Images</Button>
    </StackPanel>
</Window> 
```

C＃

```
{
       private void button2_Click(object sender, RoutedEventArgs e)
        {
            ImageDataContext db = new ImageDataContext();
            var data = db.ImageDetails.Select(p => p.ImageData).ToList();
            lstImages.ItemsSource = data;
        }

    }

    public class BinaryImageConverter : IValueConverter
    {
        object IValueConverter.Convert(object value, Type targetType, object parameter, System.Globalization.CultureInfo culture)
        {
            if (value != null && value is byte[])
            {
                byte[] ByteArray = value as byte[];
                BitmapImage bmp = new BitmapImage();
                bmp.BeginInit();
                bmp.StreamSource = new MemoryStream(ByteArray);
                bmp.EndInit();
                return bmp;
            }
            return null;
        }

        object IValueConverter.ConvertBack(object value, Type targetType, object parameter, System.Globalization.CultureInfo culture)
        {
            throw new Exception("The method or operation is not implemented.");
        }
    } 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-20T07:49:16.580

我会试一试。

ListBox 中的每个项目都绑定到一个名为“ImageData”的属性：

```
<Image Source="{Binding Path=ImageData, Converter={StaticResource imgConverter}}"/> 
```

...但是当您设置将 ListBox 绑定到的列表时，您只需将 ImageData 属性选择到列表中：

```
var data = db.ImageDetails.Select(p => p.ImageData).ToList();
lstImages.ItemsSource = data; 
```

因此，您最终会得到一个`List<byte[]>`或其他东西，而不是具有 ImageData 属性的对象列表。

如果我的猜测是正确的，你有两个选择：

`1.`将绑定更改为直接绑定到图像：

```
<Image Source="{Binding Converter={StaticResource imgConverter}}"/> 
```

`2.`更改 linq 查询以创建具有 ImageData 属性的对象：

```
var data = db.ImageDetails.Select(p => new { ImageData = p.ImageData.ToArray() }).ToList();
lstImages.ItemsSource = data; 
```

**编辑**向 linq 查询添加了 ToArray() 调用以反映 Prashant 的发现。

# javascript - 阐明混淆的 javascript 代码块

> ID：767151
> 
> 赞同：-2
> 
> 时间：2009-04-20T06:43:51.510
> 
> 标签：javascript

有没有办法阐明混淆的 javascript 代码块？？？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-20T07:07:00.080

你可以试试这些——

[http://elfz.laacz.lv/beautify/](http://elfz.laacz.lv/beautify/)

[http://www.brianfolts.com/un/](http://www.brianfolts.com/un/) - 仅适用于 FF

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-20T07:00:48.583

取决于它是如何混淆的。您可能无法获得原始代码，但是首先进行漂亮的打印，然后手动分析代码（如果它只是最小化/压缩），您会走得很远。

如果它是被`eval()`编辑的混淆代码，你需要通过额外的箍来获取传递给的代码`eval()`（或者只是给自己打补丁`eval`来做一些事情，比如打印参数）。

# video - 视频流/托管

> ID：767155
> 
> 赞同：1
> 
> 时间：2009-04-20T06:45:49.913
> 
> 标签：video, video-streaming

我们的客户希望我们通过添加视频功能来更新他们的 Web 应用程序。它有点像 YouTube，但有帐户和视频隐私。它应该能够流式传输实时和录制的视频。

我们没有开发自定义应用程序，而是决定开发一个开箱即用的应用程序。它可以是开源的，但我们愿意尝试许可产品。你们对我们可以使用什么有什么建议吗？

顺便说一下，Web 应用程序位于 .Net 2.0 中。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-20T07:17:34.457

是的 - 老实说，最简单的方法是使用**Flash Media Server** - 或兼容的软件。然后，您可以使用 Flash/Flex 应用程序来利用媒体本身。有几个与 FMS 类似的软件包是兼容的，尽管我今晚无法说出一个名字（谷歌会帮助你。）

这是相当标准的，你会发现大量的教程来帮助你在线。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-20T07:29:14.660

你可以考虑

[http://www.kyte.com/](http://www.kyte.com/)

[http://influxis.com/applications/](http://influxis.com/applications/)

[http://www.uvault.com/](http://www.uvault.com/)

谢谢

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-12-20T09:36:12.410

要流式传输实时和录制的视频，使用 Flash 媒体服务器或 wowza 服务器进行[实时视频流传输](http://hioxindia.com/live-stream-hosting.php)将是最佳选择。这些软件也可以通过多个播放客户端和设备进行流式传输。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-12-20T09:40:54.100

窗户好吗？在过去 15 年左右的时间里，Windows Media Services 可以做到这一点，无论如何它都是 Windows 操作系统的一部分。

# mysql - 使用当前的 auto_increment 值作为同一 INSERT 查询中另一个字段的基础 - 这在 MySQL 中可能吗？

> ID：767161
> 
> 赞同：2
> 
> 时间：2009-04-20T06:48:33.027
> 
> 标签：mysql, stored-procedures, auto-increment

在我的表（MySQL）中，我有这些字段：

`id` - 主要的，自动增量

`hash`- base 36 表示`id`

我想一次填充这两个字段，使用存储过程来计算 id 在 INSERT 上接收到的值的 base 36 等效值。像这样的东西：

```
INSERT into `urls` (`id`,`hash`) VALUES (NULL,base36(`id`)); 
```

显然这是行不通的，但我希望它能说明我正在努力实现的目标。这可能吗？如果可以，怎么做？

注意：我只想使用一个查询，所以 last_insert_id 没有帮助（至少据我所知）。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-20T07:22:50.217

这个问题本质上是对[另一个](https://stackoverflow.com/questions/469009/can-you-access-the-auto-increment-value-in-mysql-within-one-statement)问题的重述。简而言之，自动增量字段的优点是保证该值是唯一的，缺点是该值在 INSERT 已经执行之前不存在。

这是*必然*的。**例如，您可以为给定的表检索下一个自动增量值是什么，但由于并发问题，您**不能确定接下来执行的查询将是获得该 ID 的查询。别人可能会先拿走它。因此，ID 字段的分配必须是在插入记录时发生的原子 get-and-increment 操作。

换句话说，尽管您可能*想*在单个查询中执行此操作，但您根本不会这样做。理论上，您可以通过在 INSERT 上附加一个触发器来假装您只执行一个查询，该触发器在事后添加您的 ID 字段的替代表示。或者，您可以使用基于提前知道的内容的非自动增量 ID 字段。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-20T07:46:02.920

尽管您不能在单个查询中执行此操作，但您可以执行以下操作：

```
START TRANSACTION;
INSERT into `urls` (`id`) VALUES (NULL);
UPDATE `urls` SET `hash`=BASE36(`id`) WHERE `id`=LAST_INSERT_ID();
COMMIT; 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-20T09:48:32.207

您可以使用触发器来执行此操作，例如：

```
CREATE TRIGGER `calc_id_hash` AFTER INSERT ON `urls`
FOR EACH ROW SET new.`hash`= BASE36(new.`id`); 
```

# iphone - 如何通过在 iphone 应用程序中按通话按钮拨打号码？

> ID：767169
> 
> 赞同：1
> 
> 时间：2009-04-20T06:52:33.487
> 
> 标签：iphone

我正在使用一个表格视图，其中每个销售都有一个特定的电话号码，旁边是一个呼叫按钮，按下该号码拨打该号码......例如，如果我在单元格中有一个电话号码为（425）821-1300，我改变了使用字符串变量phonenumberstring，通过如下代码将其转换为标准格式425-821-1300

```
 phonenumberstring=[phonenumberstring substringFromIndex:1];
    phonenumberstring=[phonenumberstring stringByReplacingOccurrencesOfString:@")" withString:@"-"];

    m_strPhoneNumber = [NSString stringWithFormat:@"tel:%@", self.phonenumberstring];
//[[UIApplication sharedApplication] openURL:[NSURL URLWithString:m_strPhoneNumber]];
    NSURL *url = [[NSURL alloc] initWithString:m_strPhoneNumber];//1
    [[UIApplication sharedApplication] openURL:url];//2 
```

当我在注释的第 1 行和第 2 行进行调试时，事情正在使用它 url 显示为 nill 并且未拨打电话

问候

阿伦

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-20T08:06:10.687

此时 m_strPhoneNumber 和 phonenumberstring 的值是多少。phonenumberstring 设置是否正确？

要删除第一个括号，为什么不使用`stringByReplacingOccurrencesOfString:@"("`withString:@"" 等。它看起来不那么脆弱。事实上，我建议去掉所有非数字字符——甚至连字符。

这可能是矫枉过正，但尝试类似：

```
m_strPhoneNumber = [NSMutableString stringWithString:@"tel:%@"];
NSArray *numberTokens = [phonenumberstring componentsSeparatedByCharactersInSet:[[NSCharacterSet decimalDigitCharacterSet] invertedSet]];
            for (NSString *token in numberTokens) {
                m_strPhoneNumber = [m_strPhoneNumber stringByAppendingString:token];
            } 
```

作为一种小风格，我建议`phoneNumberString`它更具可读性。我还建议使用更多变量 - 优化器将确保它们不会产生影响，并且会使调试更加容易。

# xml - 将元素从一个 DOMDocument 复制到另一个

> ID：767175
> 
> 赞同：1
> 
> 时间：2009-04-20T06:55:15.133
> 
> 标签：xml, dom, msxml

有没有办法将元素从一个 DOMDocument 实例复制（深）到另一个？

```
<Document1>
  <items>
    <item>1</item>
    <item>2</item>
    ...
  </items>
</Document1>

<Document2>
  <items>
  </items>
</Document> 
```

我需要将 /Document1/items/* 复制到 /Document2/items/。

似乎 DOMDocument 没有从另一个 DOMDocument 导入节点的方法。它甚至不能从 xml 文本创建节点。

当然我可以使用字符串操作来实现这一点，但也许有更简单的解决方案？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-20T07:00:30.783

您可以使用[cloneNode](http://msdn.microsoft.com/en-us/library/ms762269(VS.85,loband).aspx)方法并传递一个`true`参数。该参数表示是否递归地克隆被引用节点的所有子节点。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-11-20T15:52:44.713

在 Java 中：

```
void copy(Element parent, Element elementToCopy)
{
   Element newElement;

   // create a deep clone for the target document:
   newElement = (Element) parent.getOwnerDocument().importNode(elementToCopy, true);

   parent.appendChild(newElement);
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-08-06T15:12:43.307

下面的函数会复制一个 Document 并保存一个基本的`<!DOCTYPE>`，这是不正确的使用`Transformer`。

```
 public static Document copyDocument(Document input) {
        DocumentType oldDocType = input.getDoctype();
        DocumentType newDocType = null;
        Document newDoc;
        String oldNamespaceUri = input.getDocumentElement().getNamespaceURI();
        if (oldDocType != null) {
            // cloning doctypes is 'implementation dependent'
            String oldDocTypeName = oldDocType.getName();
            newDocType = input.getImplementation().createDocumentType(oldDocTypeName,
                                                                      oldDocType.getPublicId(),
                                                                      oldDocType.getSystemId());
            newDoc = input.getImplementation().createDocument(oldNamespaceUri, oldDocTypeName,
                                                              newDocType);
        } else {
            newDoc = input.getImplementation().createDocument(oldNamespaceUri,
                                                              input.getDocumentElement().getNodeName(),
                                                              null);
        }
        Element newDocElement = (Element)newDoc.importNode(input.getDocumentElement(), true);
        newDoc.replaceChild(newDocElement, newDoc.getDocumentElement());
        return newDoc;
    } 
```

# perl - 是否有将 mod_perl 移植到 Catalyst 的好资源？值得吗？

> ID：767176
> 
> 赞同：2
> 
> 时间：2009-04-20T06:56:37.923
> 
> 标签：perl, porting, mod-perl, catalyst

我们有一个大型的电子学习 mod_perl 网络应用程序，它使用 AxKit、XML、XLST 和 javascript，主要在 unix 服务器上运行。我注意到的是代码相当混乱，并且已经有几代开发人员进进出出。由于当前的结构，尝试制作一个简单的 hello world 网页的任务涉及编写一些组件以使其工作，这要归功于 AxKit XSL 转换。

所以，我正在研究强大的 Catalyst 框架，而 MVC 本身让我垂涎三尺。我正在寻找资源和最佳实践，看看将当前的 Web 应用程序移植到 Catalyst 是否可行。

我想听听催化剂同事的意见，如果我的管理层问这个神奇的问题，此举是否值得，为什么？

谢谢 ：）

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-20T15:13:49.583

我的猜测是“这取决于您使用了多少 AxKit”。如果您只是使用 XSLT 而不是 XSP、XPathScript 或任何样式动态的东西，那么它可能会非常简单。如果您正在使用 AxKit 世界中一些更有趣的生物，那么您肯定会想更深入地了解 Catalyst 对 XPathScript 和 XSP 等事物的支持程度（据我所知，目前还没有任何支持） ）。如果您正在考虑完全转储 XML/XSLT，那么走 Catalyst 路径肯定比不走更容易。

我知道有几个 AxKit 开发人员使用过，并且确实在某些项目中使用过 Catalyst，即使是最固执的他们也可能会承认 Catalyst 功能强大且易于实现某些目标。对于想要“xkit xsl 转换”的人来说，AxKit 是一个更专业的工具。

如果您在 irc.perl.org 上，请在 #axkit-dahut 频道询问，我们同时拥有 AxKit 和 Catalyst 核心开发人员；）

# c# - C# 泛型 - 数组？

> ID：767181
> 
> 赞同：5
> 
> 时间：2009-04-20T06:57:06.813
> 
> 标签：c#, generics

如何在 C# 中重做该 C++ 模板函数的声明？

```
 template <class type>
void ReadArray(type * array, unsigned short count)
{
    int s = sizeof(type) * count;
    if(index + s > size)
        throw(std::exception("Error 102"));
    memcpy(array, stream + index, s);
    index += s;
} 
```

调用时，它通过在特定位置（索引）读取流（流）来在给定数组中附加字节/字/（类型）。

我试图像这样重做声明，但出现错误

```
 public static T void ReadArray(<T> Array inputarray) // error
    {
        ...
    } 
```

谢谢！

另一个保守的问题 - 如何将字节附加到该数组（memcpy（））中，我应该使用指针吗？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-04-20T07:02:32.573

你像这样使用它：

```
public static void ReadArray<T>(T[] inputArray) {
   ...
} 
```

您可以使用该`Array.Copy`方法在数组之间复制数据。

编辑：
如果你想在不同的数据类型之间进行数据的“盲拷贝”，例如从字节数组到长数组，那不是你可以使用安全代码做的事情。例如，您可以使用`BitConverter`该类将数组中的八个字节转换为长整数。您也可以使用带有指针的不安全代码来执行“盲复制”，但您应该保存它，直到您使用安全方法实际遇到性能问题。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-20T07:01:46.210

```
public static void ReadArray<T>(T[] inputarray)
    {
        ...
    } 
```

要附加到数组，您应该将其转换为 List

```
List<T> list = new List<T>();
list.AddRange(inputarray);
list.AddRange(anotherArray); 
```

# version-control - 哪个 SCM 工具支持这些功能？

> ID：767185
> 
> 赞同：2
> 
> 时间：2009-04-20T06:57:54.190
> 
> 标签：version-control, perforce

在过去 5 年左右的时间里，我一直在使用 Perforce，并且对它提供的功能非常满意。

根据您对 SCM 工具 SVN、GIT、CVS 等的经验，您能否告诉我该 SCM 工具支持以下列表中的哪些功能。

1.  命令行等效（不是精简版）GUI 功能
2.  分支以维护多个版本
3.  每个更改都是唯一可识别的（自动运行数字）
4.  日食插件
5.  bugzilla 或任何其他类似的错误跟踪软件的插件
6.  Maven 插件
7.  易于合并/良好的合并工具
8.  减少磁盘占用
9.  快速和低内存要求
10.  Windows 操作系统的客户端和服务器（如果有的话）

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-20T07:03:32.057

您可能需要调查以下内容：

*   [颠覆](http://subversion.tigris.org/)
*   [水银](http://www.selenic.com/mercurial/)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-20T07:01:36.163

查看此[版本控制软件列表](http://en.wikipedia.org/wiki/List_of_revision_control_software)。了解每个系统的优缺点，然后做出决定。

还要确保在 SO 中搜索 SCM 问题。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-27T22:34:49.220

任何现代 SCM 都将满足您的要求。

尝试一下[Plastic SCM](http://www.plasticscm.com)（我认为除了 Maven）

# unix - 如何获取差异以报告新行、已更改行和已删除行的摘要

> ID：767198
> 
> 赞同：56
> 
> 时间：2009-04-20T07:02:53.150
> 
> 标签：unix, diff

我想总结两个文件之间的差异。预期输出是新行、删除行和更改行的计数。diff 是否容易提供这样的输出？如果没有，是否有任何可用的脚本/实用程序有助于获取摘要。

* * *

## 回答 #1

> 赞同：104
> 
> 时间：2009-04-20T08:01:56.610

我想你正在寻找[`diffstat`](https://invisible-island.net/diffstat/). `diff -u`只需将to的输出通过管道传输`diffstat`，您应该会得到类似的结果。

```
 include/net/bluetooth/l2cap.h |    6 ++++++
 net/bluetooth/l2cap.c         |   18 +++++++++---------
 2 files changed, 15 insertions(+), 9 deletions(-) 
```

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2013-06-12T00:28:04.663

对于使用*Git*或*Mercurial*的用户，可以快速查看此类*未分级更改*的摘要：

```
git diff --stat
hg diff --stat 
```

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2009-04-20T07:12:09.460

如果您使用 diff -u ，它将生成一个统一的差异，其前面带有*+*和*-*的行。如果您通过 grep 管道输出（仅获取*+*或*-*）然后到 wc 您将分别获得*+* es 和*-* es 的计数。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2017-03-08T16:12:28.603

这是 suyasha 的脚本，所有格式都正确，带有换行符，并添加了一些消息输出。干得好，suyasha，应该将您的回复作为答案发布。我会投票赞成的。

```
#!/bin/bash
# USAGE:    diffstat.sh [file1] [file2]

if [ ! $2 ]
then
   printf "\n   USAGE: diffstat.sh [file1] [file2]\n\n"
   exit
fi

diff -u -s "$1" "$2" > "/tmp/diff_tmp" 
add_lines=`cat "/tmp/diff_tmp" | grep ^+ | wc -l`
del_lines=`cat "/tmp/diff_tmp" | grep ^- | wc -l` 
# igonre diff header (those starting with @@) 
at_lines=`cat "/tmp/diff_tmp" | grep ^@ | wc -l`
chg_lines=`cat "/tmp/diff_tmp" | wc -l`
chg_lines=`expr $chg_lines - $add_lines - $del_lines - $at_lines` 
# subtract header lines from count (those starting with +++ & ---) 
add_lines=`expr $add_lines - 1`
del_lines=`expr $del_lines - 1`
total_change=`expr $chg_lines + $add_lines + $del_lines`
rm /tmp/diff_tmp

printf "Total added lines:  "
printf "%10s\n" "$add_lines"
printf "Total deleted lines:"
printf "%10s\n" "$del_lines"
printf "Modified lines:     "
printf "%10s\n" "$chg_lines"
printf "Total changes:      "
printf "%10s\n" "$total_change" 
```

# ruby-on-rails - 使用活动资源时如何从 url 中删除 .xml 和 .json

> ID：767203
> 
> 赞同：12
> 
> 时间：2009-04-20T07:05:55.187
> 
> 标签：ruby-on-rails

当我在活动资源中进行映射时，它对 Ruby on Rails 的默认请求总是自动在 url 的末尾添加扩展名。例如：我想通过如下映射从 Ruby on Rails 获取用户资源：

```
类用户 < ActiveResource::Base
  self.site = 'http://localhost:3000'
结尾

```

还有我需要的东西，我只希望它通过不带扩展名的 url

```
http://localhost:3000/用户
```

相反，它会自动在网址末尾添加扩展名，例如

```
http://localhost:3000/user.xml
```

从活动资源映射发出请求时，如何省略 url 的扩展？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2014-03-06T20:04:57.307

起初，我确实使用了@Joel AZEMAR 的答案，并且在我开始使用 PUT 之前效果很好。在 .json/.xml 中添加一个 PUT。

在这里进行的一些[研究](https://github.com/rails/activeresource/blob/master/lib/active_resource/base.rb#L295)表明，使用该`ActiveResource::Base#include_format_in_path`选项对我来说效果更好。

**没有 include_format_in_path：**

```
class Foo < ActiveResource::Base
  self.site = 'http://localhost:3000'
end

Foo.element_path(1)
=> "/foo/1.json" 
```

**使用 include_format_in_path：**

```
class Foo < ActiveResource::Base
  self.include_format_in_path = false
  self.site = 'http://localhost:3000'
end

Foo.element_path(1)
=> "/foo/1" 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-07-01T16:37:47.233

你可以通过在你的类中重写两个 ActiveResource 的方法来做到这一点：

```
class User < ActiveResource::Base
  class << self
    def element_path(id, prefix_options = {}, query_options = nil)
      prefix_options, query_options = split_options(prefix_options) if query_options.nil?
      "#{prefix(prefix_options)}#{collection_name}/#{id}#{query_string(query_options)}"
    end

    def collection_path(prefix_options = {}, query_options = nil)
      prefix_options, query_options = split_options(prefix_options) if query_options.nil?
      "#{prefix(prefix_options)}#{collection_name}#{query_string(query_options)}"
    end
  end

  self.site = 'http://localhost:3000'
end 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2011-05-25T14:27:36.730

您可以覆盖 ActiveResource::Base 的方法

在 /lib/active_resource/extend/ 目录中添加这个库，不要忘记在*config/application.rb中取消注释*
**“config.autoload_paths += %W(#{config.root}/lib)”**

 *```
module ActiveResource #:nodoc:
  module Extend
    module WithoutExtension
      module ClassMethods
        def element_path_with_extension(*args)
          element_path_without_extension(*args).gsub(/.json|.xml/,'')
        end
        def new_element_path_with_extension(*args)
          new_element_path_without_extension(*args).gsub(/.json|.xml/,'')
        end
        def collection_path_with_extension(*args)
          collection_path_without_extension(*args).gsub(/.json|.xml/,'')
        end
      end

      def self.included(base)
        base.class_eval do
          extend ClassMethods
          class << self
            alias_method_chain :element_path, :extension
            alias_method_chain :new_element_path, :extension
            alias_method_chain :collection_path, :extension
          end
        end
      end  
    end
  end  
end 
```

在模型中

```
class MyModel < ActiveResource::Base
  include ActiveResource::Extend::WithoutExtension
end 
```

# c# - 对 URL 的 POST 请求消息花费异常时间

> ID：767207
> 
> 赞同：0
> 
> 时间：2009-04-20T07:07:01.890
> 
> 标签：c#, .net, httpwebrequest

我正在尝试通过单击按钮发布到 URL（以启用相机的触发脉冲）。我有一个类似的代码可以在单击按钮时禁用触发脉冲。我面临的问题是动作完成的延迟异常高。我无法弄清楚为什么它有时会提前完成并且有时会花费大量时间。有人可以帮忙吗？

```
private void button2_Click_1(object sender, EventArgs e)
{
    try
    {
        string requestmethod = "POST";
        string postData = "";
        byte[] byteArray = Encoding.UTF8.GetBytes(postData);
        string URL = "http://192.168.0.42/entrig.cgi";
        string contenttype = "application/x-www-form-urlencoded";
        request = null;
        request = (HttpWebRequest)WebRequest.Create(URL);
        Stream dataStream;
        ((HttpWebRequest)request).KeepAlive = false;
        request.Method = requestmethod;
        request.ContentType = contenttype;
        request.ContentLength = byteArray.Length;
        dataStream = request.GetRequestStream();
        dataStream.Write(byteArray, 0, byteArray.Length);
        dataStream.Close();
        MessageBox.Show("Started Trigger");
    }
    catch (Exception ex)
    {
        MessageBox.Show(ex.StackTrace);
    }
} 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-20T08:05:54.060

没有理由假设服务器是一致的。尝试监控什么是没有线的（例如使用[Fiddler](http://www.fiddler2.com/fiddler2/)）并查看减速在哪里。

# c# - 转换为类型

> ID：767208
> 
> 赞同：0
> 
> 时间：2009-04-20T07:07:06.447
> 
> 标签：c#, reflection, casting

我想知道是否可以将对象强制转换为类型...我刚刚开始使用反射，所以也许我做错了，但这就是我想做的：

```
...
Type type = ...;
Type interfaceType = someOtherType.GetInterface("IConverter`2");

return (Cast to interfaceType)Activator.CreateInstance(type); 
```

可以转换到界面吗？

**更新：**

编译器说找不到 T 和 K。myInterface Type 实例知道 T 和 K 类...

```
public IConverter<T, K> GetConverter(Type type)
{
    if (dtoModelDictionary.ContainsKey(type))
    {
        Type foundType = dtoModelDictionary[type];
        Type myInterface = foundType.GetInterface("IConverter`2");

        return (IConverter<T, K>)Activator.CreateInstance(foundType); 
    }
    else if (dalModelDictionary.ContainsKey(type))
    {
        Type foundType = dalModelDictionary[type];

        return (IConverter<T, K>)Activator.CreateInstance(foundType);
    }
    else
    {
        throw new System.Exception();
    }
} 
```

第二次更新：

```
public SomeClass GetConverter(Type type)
    {
        if (dtoModelDictionary.ContainsKey(type))
        {
            Type foundType = dtoModelDictionary[type];
            Type myInterface = foundType.GetInterface("IConverter`2");

            IConverter<T, K> converter = (IConverter<T, K>)Activator.CreateInstance(foundType); 
            return converter.someMethod(); 
        }
    } 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-20T07:39:21.953

回复你更新：

您不能强制转换为未定义泛型参数的类型。必须为使用它的方法定义 T 和 K。

要么声明它：

```
public IConverter<T, K> GetConverter<T, K>(Type type) 
```

或者，如果您经常遇到使用此接口但您不知道任何 T 或 K 类型的问题，请使用没有泛型的接口：

```
interface IConverter
{ 
  // general members
}

interface  IConverter<T, K> : IConverter 
{
  // typesave members
}

public IConverter GetConverter(Type type)
{
  // ...
  return (IConverter)Activator.CreateInstance(type);
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-20T07:15:58.687

不是真的，不是……至少不是这样。问题是你的返回值必须是你方法的返回值的类型。因为必须在编译时输入所有内容，所以对于这种特定类型的强制转换，我可以看到有限或没有实际用例——也许你可以多说一些关于你想要完成的事情？

现在，如果您使用的是泛型，您*确实*有一个运行时类型的故事，您可以返回您的 Type 参数类型：

```
public T MyMethod<T>(...)
...
return (T)Activator.CreateInstance(type); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-20T07:33:00.393

您只能将对象转换为它实际上是的东西。例如，您可以将`String`引用转换为`IEnumerable`，但不能将其转换为`char[]`。

如果你的方法返回的实际上实现了接口，你可以像往常一样转换它。

例子：

```
return (IConverter<int,string>)Activator.CreateInstance(type); 
```

编辑：
您需要使方法通用，以便在调用它时可以指定数据类型：

```
public IConverter<T, K> GetConverter<T, K>(Type type) {
   ...
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-20T07:54:23.977

你可以这样做：

```
var type = typeof(IConverter<,>).MakeGenericType(new Type[] { typeof(T), typeof(K) }); 
```

# python - 在没有应用程序注意的情况下以编程方式在窗口中截取屏幕截图

> ID：767212
> 
> 赞同：0
> 
> 时间：2009-04-20T07:11:05.063
> 
> 标签：python, windows, events, operating-system, screenshot

有多种方法可以截取 Windows 中正在运行的应用程序的屏幕截图。但是，我听说可以定制应用程序，以便它可以通过某些 Windows 事件处理程序在截取屏幕截图时注意到它？有什么方法可以截取屏幕截图以使应用程序无法注意到？（甚至可能在 VM 中运行应用程序，并从主机截取屏幕截图？）我更喜欢 Python 中的解决方案，但任何事情都可以。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-20T12:08:21.497

对于用数码相机拍摄的屏幕截图，肯定没有任何保护措施。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-20T12:06:51.797

*> 我听说可以定制应用程序，以便在截取屏幕截图时通知它*

完全废话。不要重复孩子们说的话……阅读 MSDN 上的屏幕截图。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-20T07:31:07.170

你有一个特定的反截图程序吗？最终，你是对的，在虚拟机中运行应用程序将胜过它所拥有的任何“保护”，但方法取决于你使用的操作系统/虚拟机，在需要之前不值得开销。

我只是用这个：[通过python脚本截取屏幕截图。[Linux]](https://stackoverflow.com/questions/69645/take-a-screenshot-via-a-python-script-linux/70237#70237)（仅限 Windows）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-21T23:06:37.910

可以使用远程桌面或[（低级）VNC 镜像驱动程序](http://www.uvnc.com/features/driver.html)并在另一台计算机上截取屏幕截图。

# c# - 如何在 C# 中跨本地网络进行 UDP 多播？

> ID：767215
> 
> 赞同：13
> 
> 时间：2009-04-20T07:11:52.580
> 
> 标签：c#, .net, networking, messaging

我正在尝试在我的本地网络上进行一些简单的 UDP 通信。

我要做的就是对网络上的所有机器进行多播

这是我的发送代码

```
 public void SendMessage(string message)
    {
        var data = Encoding.Default.GetBytes(message);
        using (var udpClient = new UdpClient(AddressFamily.InterNetwork))
        {
            var address = IPAddress.Parse("224.100.0.1");
            var ipEndPoint = new IPEndPoint(address, 8088);
            udpClient.JoinMulticastGroup(address);
            udpClient.Send(data, data.Length, ipEndPoint);
            udpClient.Close();
        }
    } 
```

这是我的接收代码

```
 public void Start()
    {
        udpClient = new UdpClient(8088);
        udpClient.JoinMulticastGroup(IPAddress.Parse("224.100.0.1"), 50);

        receiveThread = new Thread(Receive);
        receiveThread.Start();
    }

    public void Receive()
    {
        while (true)
        {
            var ipEndPoint = new IPEndPoint(IPAddress.Any, 0);
            var data = udpClient.Receive(ref ipEndPoint);

            Message = Encoding.Default.GetString(data);

            // Raise the AfterReceive event
            if (AfterReceive != null)
            {
                AfterReceive(this, new EventArgs());
            }
        }
    } 
```

它可以在我的本地机器上完美运行，但不能通过网络运行。

- 似乎不是防火墙。我在两台机器上都禁用了它，它仍然无法正常工作。

- 如果我直接发送到客户端机器的硬编码IP地址（即不是多播），它就可以工作。

任何帮助，将不胜感激。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-20T09:53:03.240

您的本地网络硬件是否支持[IGMP](http://en.wikipedia.org/wiki/Internet_Group_Management_Protocol)？

您的交换机可能支持多播，但如果禁用 IGMP，它不会注意到任何连接的硬件是否订阅了特定的多播组，因此它不会转发这些数据包。

要对此进行测试，请暂时使用交叉电缆将两台机器直接连接在一起。这应该（AFAICR）始终有效。

此外，它应该是提供给 TTL 参数的代码的*服务器*`JoinMulticastGroup()`端，而不是客户端端。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2013-05-31T11:03:34.870

我刚刚在类似的事情上花了 4 个小时（我认为），我的解决方案是：

```
client.Client.Bind(new IPEndPoint(IPAddress.Any, SSDP_PORT));
client.JoinMulticastGroup(SSDP_IP,IP.ExternalIPAddresses.First());
client.MulticastLoopback = true; 
```

在多播组上使用特定的（第一个外部）IP 地址。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-20T07:37:23.457

我在代码中的任何地方都看不到指定的[TTL 。](http://en.wikipedia.org/wiki/Time_to_live#Time_to_live_of_IP_packets "维基百科文章")请记住，TTL 最初的意思是单位秒，但现在变成了单位跃点。这意味着通过使用巧妙的 TTL，您可以避免通过路由器。我机器上的默认 TTL 是 32 - 我认为这应该绰绰有余；但如果您的系统经历了任何形式的安全锁定，您的实际上可能会有所不同（UdpClient.Ttl）。

我不能推荐你需要的 TTL——因为我个人需要做很多实验。

如果这不起作用，你可以看看这些文章：

*   [OSIX 文章](http://www.osix.net/modules/article/?id=409 "OSIX 文章")
*   [代码项目文章](http://www.codeproject.com/KB/IP/multicast.aspx "代码项目文章")

总而言之，使用 Sockets 而不是 UdpClients 似乎取得了成功。

您选择的多播组也可以是仅限本地的。[尝试另一个。](http://www.29west.com/docs/THPM/multicast-address-assignment.html "分配多播 IP 的提示")

您的物理网络层也可能导致问题。我会冒险质疑开关和直接（x-over）连接。集线器和所有更智能的应该可以很好地处理它们。然而，我没有任何文献支持这一点。

# xml - 元素在 XML 中属于哪个命名空间？

> ID：767220
> 
> 赞同：1
> 
> 时间：2009-04-20T07:14:56.677
> 
> 标签：xml, schema, namespaces

假设我有以下 XML 文档，它没有定义默认命名空间，并且“信息”元素没有以任何命名空间前缀作为前缀。我的问题是，1.命名空间元素“信息”属于什么？2\. 有没有办法对“信息”元素应用 XML 模式检查（例如，我想检查信息元素的内容不为空或使用模式定义的东西）？

```
<?xml version="1.0" encoding="utf-8"?>
<Information>Hello XML</Information> 
```

提前谢谢，乔治

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-20T07:24:12.833

从[规范](http://www.w3.org/TR/REC-xml-names/#defaulting)：

> 如果范围内没有默认命名空间声明，则命名空间名称没有值。无前缀属性名称的命名空间名称始终没有值。在所有情况下，本地名称都是本地部分（这当然与无前缀名称本身相同）。

所以这里的命名空间其实就是空字符串`""`。

# .net - 阅读自定义 HttpWebResponse StatusDescription？

> ID：767236
> 
> 赞同：3
> 
> 时间：2009-04-20T07:27:23.090
> 
> 标签：.net, wcf, rest, httpwebresponse, status

引发异常时，我正在 RESTful WCF 服务中设置自定义 StatusDescription。它旨在为调用者提供一个友好的描述，说明他们为什么会收到失败状态代码。

以下是我在 Fiddler 中看到的响应。所以我知道我的自定义消息被推回给调用者。我不知道如何从.NET 中检索该消息。StatusDescription 不包含此字符串。

如果您可以提供一些简单的示例代码，那就太好了。

> HTTP/1.1 500**消息：“抛出了 'Exceptions.DataSourceNotFoundException' 类型的异常。” Uri：[http](http://www.test1.com/)**
> ://www.test1.com/ 内容长度：0
> 服务器：Microsoft-HTTPAPI/2.0
> 日期：星期一，2009 年 4 月 20 日 07:13:40 GMT

**更新**
这个问题的答案在 Silverlight 中不起作用。在 Silverlight 2 和 3 测试版中测试。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-29T06:39:14.240

不是 .NET 程序员，在 msdn 上找到了这个

```
catch(WebException ex)
{
    string message = ((HttpWebResponse)ex.Response).StatusDescription;
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-29T16:18:48.543

我已经很多年没有使用过 .NET 了，但是在 Java 中，人们经常期望获得 HTTP 代码和消息以显示 404 Not Found 错误，而 404 实际上让 Java 抛出 FileNotFoundException。对于这些情况，在 Java 中应该使用[`HttpURLConnection#getErrorStream`](http://java.sun.com/j2se/1.5.0/docs/api/java/net/HttpURLConnection.html#getErrorStream())而不是`#getResponseMessage`.

那么：对于 500 个响应，可能在 .NET 客户端中发生了类似的事情？事实上[，国家的文件`HttpWebRequest`](http://msdn.microsoft.com/en-us/library/system.net.httpwebrequest.aspx)：

> 当访问资源时发生错误时，**HttpWebRequest**类会引发[WebException 。](http://msdn.microsoft.com/en-us/library/system.net.webexception.aspx)WebException.Status属性包含[指示错误来源的 WebExceptionStatus](http://msdn.microsoft.com/en-us/library/system.net.webexceptionstatus.aspx)[值](http://msdn.microsoft.com/en-us/library/system.net.webexception.status.aspx)。当[WebException.Status](http://msdn.microsoft.com/en-us/library/system.net.webexception.status.aspx)为[WebExceptionStatus.ProtocolError](http://msdn.microsoft.com/en-us/library/system.net.webexceptionstatus.protocolerror.aspx)时，[Response](http://msdn.microsoft.com/en-us/library/system.net.webexception.response.aspx)属性包含从资源接收到的[HttpWebResponse 。](http://msdn.microsoft.com/en-us/library/system.net.httpwebresponse.aspx)

详细信息：`Response`上面的链接是指`WebException.Response`，而不是[`HttpWebRequest.GetResponse`](http://msdn.microsoft.com/en-us/library/system.net.httpwebrequest.getresponse.aspx)。所以，`WebException`有自己的`Response`财产。以下示例基于[`WebException.Response`](http://msdn.microsoft.com/en-us/library/system.net.webexception.response.aspx)文档，但我没有对其进行测试。

重要提示：请注意，这不使用`GetResponse`from `HttpWebRequest`，而是`Response`from `WebException`：

```
try {
  HttpWebRequest myHttpWebRequest = 
      (HttpWebRequest) WebRequest.Create("http://www.example.org/not_found");
  HttpWebResponse myHttpWebResponse =
      (HttpWebResponse) myHttpWebRequest.GetResponse();
  myHttpWebResponse.Close();
}
catch(WebException e) {
  Console.WriteLine("Exception Message: " + e.Message);
  if(e.Status == WebExceptionStatus.ProtocolError) {
    Console.WriteLine("Status Code: {0}",
        ((HttpWebResponse)e.Response).StatusCode);
    Console.WriteLine("Status Description: {0}",
        ((HttpWebResponse)e.Response).StatusDescription);
    }
}
catch(Exception e) {
  Console.WriteLine(e.Message);
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-30T11:01:45.537

我认为您的问题是您的状态代码为 500。当状态代码不正常（200 或某种类型的重定向）时，WebRequest.GetResponse() 调用会在 .NET 中引发 WebException。

此异常实际上将包含设置了 StatusDescription 的 HttpWebResponse 对象。以下示例来自 MSDN：

```
public static void GetPage(String url) 
    {
        try 
           {    
                // Creates an HttpWebRequest for the specified URL. 
                HttpWebRequest myHttpWebRequest = (HttpWebRequest)WebRequest.Create(url); 
                // Sends the HttpWebRequest and waits for a response.
                HttpWebResponse myHttpWebResponse = (HttpWebResponse)myHttpWebRequest.GetResponse(); 
                if (myHttpWebResponse.StatusCode == HttpStatusCode.OK)
                   Console.WriteLine("\r\nResponse Status Code is OK and StatusDescription is: {0}",
                                        myHttpWebResponse.StatusDescription);
                // Releases the resources of the response.
                myHttpWebResponse.Close(); 

            } 
        catch(WebException e) 
           {
                Console.WriteLine("\r\nWebException Raised. The following error occured : {0}",e.Status); 
           }
        catch(Exception e)
        {
            Console.WriteLine("\nThe following Exception was raised : {0}",e.Message);
        }
    } 
```

来源：http: [//msdn.microsoft.com/en-us/library/system.net.httpwebresponse.statuscode.aspx](http://msdn.microsoft.com/en-us/library/system.net.httpwebresponse.statuscode.aspx)

要实际获取状态，您需要从异常本身获取 HttpWebResponse 对象：

```
try {
   // Create a web request for an invalid site. Substitute the "invalid site" strong in the Create call with a invalid name.
     HttpWebRequest myHttpWebRequest = (HttpWebRequest) WebRequest.Create("invalid site");

    // Get the associated response for the above request.
     HttpWebResponse myHttpWebResponse = (HttpWebResponse) myHttpWebRequest.GetResponse();
    myHttpWebResponse.Close();
}
catch(WebException e) {
    Console.WriteLine("This program is expected to throw WebException on successful run."+
                        "\n\nException Message :" + e.Message);
    if(e.Status == WebExceptionStatus.ProtocolError) {
        Console.WriteLine("Status Code : {0}", ((HttpWebResponse)e.Response).StatusCode);
        Console.WriteLine("Status Description : {0}", ((HttpWebResponse)e.Response).StatusDescription);
    }
}
catch(Exception e) {
    Console.WriteLine(e.Message);
} 
```

来源：http: [//msdn.microsoft.com/en-us/library/system.net.webexception.status.aspx](http://msdn.microsoft.com/en-us/library/system.net.webexception.status.aspx)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-02T09:26:01.350

我不知道它是否是复制/粘贴的东西，但“Uri：”标题与状态代码在同一行——这可能是一个问题。

大多数原因代码是几个没有“：”且没有引号的单词：[https](https://www.rfc-editor.org/rfc/rfc2616#section-6.1.1) ://www.rfc-editor.org/rfc/rfc2616#section-6.1.1所以我怀疑标头解析器认为“消息：”是 HTTP 标头的开始（检查 webResponse.Headers["Message"]）。

您可以添加一个标题（例如，X-Error-Details）。

# python - 覆盖 __init__ 时属性不可用？

> ID：767241
> 
> 赞同：2
> 
> 时间：2009-04-20T07:28:59.903
> 
> 标签：python

我试图覆盖一个`__init__`方法，但是当我调用超级方法时，在该方法中创建的属性不可用。我可以看到这不是继承问题，因为`class B`仍然有可用的属性。

我认为代码示例会更好地解释它:-)

```
Python 2.5.2 (r252:60911, Oct  5 2008, 19:24:49) 
[GCC 4.3.2] on linux2
Type "help", "copyright", "credits" or "license" for more information.
>>> class A(object):
...   def __init__(self, *args, **kwargs):
...     self.args = args
...     self.kwargs = kwargs
... 
>>> a = A('a', 'b', key='value')
>>> print a.args, a.kwargs
('a', 'b') {'key': 'value'}
>>> class B(A):
...   pass
... 
>>> b = B('b', 'c', key_b='value_b')
>>> print b.args, b.kwargs
('b', 'c') {'key_b': 'value_b'}
>>> class C(A):
...   def __init__(self, *args, **kwargs):
...     print 'class C'
...     super(A, self).__init__(*args, **kwargs)
... 
>>> c = C('c', 'd', key_c='value_C')
class C
>>> print c.args, c.kwargs
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
AttributeError: 'C' object has no attribute 'args'
>>> class D(A):
...   def __init__(self, *args, **kwargs):
...     super(A, self).__init__(*args, **kwargs)
...     print 'D'
... 
>>> d = D('d', 'e', key_d='value D')
D
>>> print d.args, d.kwargs
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
AttributeError: 'D' object has no attribute 'args'
>>> 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-20T07:38:44.873

您对超类的调用需要使用它自己的类型

```
super(D, self).__init__(*args,**kwargs) 
```

而不是

```
super(A... 
```

我相信调用`super(A, self).__init__`会调用 的超类`A`，即`object`. 相反，您想调用 的超类`D`，即`A`。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-20T07:40:05.713

您使用 super() 不正确。**在您的“C”类中， init** () 方法的第二行应该像这样将 C 作为第一个参数传递...

```
super(C, self).__init__(*args, **kwargs) 
```

实际上，您甚至不需要在这里使用 super 。你可以打电话

```
A.__init__(self, *args, **kwargs) 
```

# jquery - 有用。但这是最佳实践吗？

> ID：767244
> 
> 赞同：4
> 
> 时间：2009-04-20T07:30:27.577
> 
> 标签：jquery

当我开始学习一门新语言时，我总是觉得我没有以实用、标准的方式来学习。所以这里有一个关于 jQuery 的问题，以及我所做的是否可以接受。

我有 3 张图片。

```
<img src="del.png" class="delete user" />
<img src="del.png" class="delete event" />
<img src="del.png" class="delete recipe" /> 
```

然后我让 jQuery 检测到 $('.delete') 上的点击事件。

```
$('.delete').click(function() {
    if( $(this).hasClass('user') ) {
        action = 'user'
    }

    if( $(this).hasClass('event') ) {
        action = 'event'
    }

   if( $(this).hasClass('recipe') ) {
        action = 'recipe'
    }

   // I then use ajax, send the action as $_POST to the PHP script
   // and it tells PHP what to delete.

   // Doing it this way, I don't have to use 3 onclick functions and 3 ajax functions.

}); 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-20T07:37:41.223

我同意@Tommi，您正在避免编写比您需要的更多的代码，并且还将您的 ajax 调用合并到一个地方，而不是有 3 个大致相同的 ajax 调用（或编写一个 ajax 函数并从 3 个不同的位置调用它） .

如果这对您有用并且不会令人困惑，那么我认为它没有任何问题。事实上，有很多方法可以用一种丑陋和不优雅的方式来做你想做的事情，但这不是其中之一。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-04-20T07:34:10.813

我会说这种做你正在做的事情的方式没有错。在这样的调度程序函数中使用双重类实际上非常干净和可读。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-20T07:37:47.310

如果一个对象将用户和事件作为类，那么操作将是事件而不是用户怎么办？

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-20T07:42:18.560

此解决方案使您的系统依赖于 javascript 来工作。一个更强大的解决方案是构建一个至少可以在*没有*javascript 的情况下运行的东西，然后在加载时使用 javascript 来修改按钮的行为以执行更多的 ajax-y 操作。

它需要更多的代码才能做到这一点，而且*看起来*不那么优雅。但是，如果您正在寻找“最佳”解决方案，您可能需要权衡并确定处理“无 javascript”极端情况是否是优先事项。

无论您决定哪条路线，您至少应该有意识地以一种或另一种方式做出决定，而不是让它在以后让您感到惊讶。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-20T07:52:46.430

您可能想为您的 AJAX 创建一个单独的函数，并将其传递`action`给它。

正如您的代码所代表的那样，它将允许您动态更改操作并为一个`img`. 我会记录这是否是故意的。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-20T08:56:07.963

这段代码可以单独看到。但是，我建议`<a>`直接使用 onClick 事件，而不是依赖 jquery 向您的元素添加功能。

虽然 jquery 完成了可以接受的工作，但您最终会得到难以阅读的代码，因为最终结果并未显示实际上存在与 onClick 事件关联的事件处理程序这一事实。我个人更喜欢能够查看实际正在执行的代码，使用像 Firebug 这样的工具来检查我正在服务的页面。

如果您是唯一读过您的代码的人，那么这不是问题。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-20T12:48:55.533

如果我想做这样的事情，我会更概括一些事情，就像这样

```
function getType(elem)
{
    var m = /\btype:([a-zA-Z_]+)\b/.exec(elem.className);
    return m ? m[1] : null;
}

function deleteType(type)
{
    // delete code instead of alert
    alert("Deleting type " + type);
}

$(function()
{
    $(".delete").click(function(ev)
    {
        var type = getType(this);
        if (type)
        {
            deleteType(type);
        }
        return false;
    });
}); 
```

用在像这样的元素上

```
<a href="#" class="delete type:foo">delete foo</a>
<a href="#" class="delete type:bar xxx">delete bar</a>
<a href="#" class="delete">do nothing</a> 
```

无需为新类型添加额外代码。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-04-20T13:18:46.583

假设你有一个`LI`结构（或类似的东西）：

```
<ul>
    <li>Some text <a href="delete.php?do=user">delete</a></li>
    <li>Some text <a href="delete.php?do=event">delete</a></li>
    <li>Some text <a href="delete.php?do=recipe">delete</a></li>
</ul> 
```

你可以这样做

```
$('.delete').click(function(){
    var t=$(this);
    jQuery.ajax({
        type: "GET",
        url: t.attr('href'),
        cache: false,
        success: function(data){
            t.parent().remove(); // you remove the whole li tag
        }
    });
}); 
```

当然，如果您需要在 ajax 成功时触发不同的功能，那么我认为您的方式是最好的选择。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-04-20T22:53:18.263

在阅读您的代码时，我有同样的冲动将代码重构为更短的代码，特别是代码结构中存在重复。

以下解决方案获取已单击的 div 的类列表。然后它检索列出的最后一个类。

```
$('.delete').click(function() {

   // Your 'action' class type must always be the last in the list
   action = $(this).attr('class').split(' ').slice(-1); 

   // Remaining logic goes here...

}); 
```

# sql-server - 如何删除表上的所有默认约束约束

> ID：767248
> 
> 赞同：8
> 
> 时间：2009-04-20T07:31:07.653
> 
> 标签：sql-server, sql-server-2005, constraints

如何删除属于 SQL 2005 中特定表的所有默认约束？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-20T07:37:03.927

[搜索](http://www.google.co.uk/search?hl=en&q=drop+all+constraints+script&btnG=Google+Search&meta=&aq=f&oq=)中的一种解决方案：（针对默认约束进行了编辑）

```
SET NOCOUNT ON

DECLARE  @constraintname SYSNAME, @objectid int,
           @sqlcmd         VARCHAR(1024)

DECLARE CONSTRAINTSCURSOR CURSOR  FOR
SELECT NAME, object_id
FROM   SYS.OBJECTS
WHERE  TYPE = 'D' AND @objectid = OBJECT_ID('Mytable')

OPEN CONSTRAINTSCURSOR

FETCH NEXT FROM CONSTRAINTSCURSOR
INTO @constraintname, @objectid

WHILE (@@FETCH_STATUS = 0)
BEGIN
    SELECT @sqlcmd = 'ALTER TABLE ' + OBJECT_NAME(@objectid) + ' DROP CONSTRAINT ' + @constraintname
    EXEC( @sqlcmd)
    FETCH NEXT FROM CONSTRAINTSCURSOR
    INTO @constraintname, @objectid
END

CLOSE CONSTRAINTSCURSOR
DEALLOCATE CONSTRAINTSCURSOR 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2013-03-20T00:34:35.647

我知道这是旧的，但我只是在谷歌搜索时发现它。下面是一个在 SQL 2008（不确定 2005 年）中对我有用的解决方案，而不使用游标：

```
declare @sql nvarchar(max)

set @sql = ''

select @sql = @sql + 'alter table YourTable drop constraint ' + name  + ';'
from sys.default_constraints 
where parent_object_id = object_id('YourTable')
AND type = 'D'

exec sp_executesql @sql 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2020-03-18T09:16:16.577

gbn 发布的脚本对我不起作用，所以我使用的是修改后的版本：

```
SET NOCOUNT ON

DECLARE  @DfId INT, @TableId INT,
         @SqlCmd    VARCHAR(1024)

DECLARE DFCONSTRAINTCUR CURSOR FOR
SELECT [parent_object_id] TABLE_ID, [object_id] DF_ID
FROM   SYS.OBJECTS
where parent_object_id = OBJECT_ID('<table name>') 
and [TYPE] = 'D' 

OPEN DFCONSTRAINTCUR

FETCH NEXT FROM DFCONSTRAINTCUR
INTO @TableId, @DfId

WHILE (@@FETCH_STATUS = 0)
BEGIN
    SELECT @sqlcmd = 'ALTER TABLE ' + OBJECT_NAME(@TableId) + ' DROP CONSTRAINT ' + OBJECT_NAME(@DfId)
    EXEC(@sqlcmd)
    FETCH NEXT FROM DFCONSTRAINTCUR
    INTO @TableId, @DfId
END

CLOSE DFCONSTRAINTCUR
DEALLOCATE DFCONSTRAINTCUR 
```

* * *

## 回答 #4

> 赞同：-3
> 
> 时间：2009-04-20T14:38:16.317

你为什么要这样做？删除约束是一项非常激烈的操作，不仅会影响您的流程，还会影响所有用户。也许您的问题可以通过其他方式解决。如果您不是系统的 dba，您应该非常认真地考虑是否应该这样做。（当然，在大多数系统中，dba 不会允许其他任何人拥有执行此类操作的权限。）

# c# - 将 BitmapFrame 用于元数据而不锁定文件

> ID：767250
> 
> 赞同：1
> 
> 时间：2009-04-20T07:31:22.893
> 
> 标签：c#, .net, wpf, image-processing

我发现在 WPF 中获取图像元数据的常用方法是创建一个`BitmapFrame`对象并检查其上的 Metadata 属性。但是我似乎无法创建`BitmapFrame`满足这两个要求的对象：

1.  不锁定文件
2.  给定某些文件时不会抛出奇怪的、未记录的异常

使用这些行似乎可以`BitmapImage`可靠地创建：

```
BitmapFrame.Create(new Uri(imageName));
BitmapFrame.Create(new Uri(imageName), BitmapCreateOptions.DelayCreation, BitmapCacheOption.None); 
```

但是，他们将文件锁定了不确定的时间。`BitmapFrame`据我所知，没有 dispose 方法。

这可以防止文件被锁定：

```
BitmapFrame.Create(new Uri(imageName), BitmapCreateOptions.None, BitmapCacheOption.OnLoad); 
```

但是在 Vista 上它会在某些文件上抛出`ArgumentException`s 和s，而在 Win7 上它会抛出s 和s。这让我认为缓存不受支持/未经测试。`InvalidOperationException``FileFormatException``IOException``BitmapFrame`

您可以从 WPF 中的图像中获取元数据，而无需在文件上留下不确定的时间长度吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-20T10:38:26.080

您是否尝试过使用转换器方法？例如，我的[Intuipic](http://intuipic.codeplex.com)应用程序就是这样做的。有关[`BitmapFrameConverter`](http://intuipic.codeplex.com/SourceControl/changeset/view/7348#114513)在没有锁定的情况下加载以及[`BitmapOrientationConverter`](http://intuipic.codeplex.com/SourceControl/changeset/view/7348#114514)获取元数据的详细信息，请参阅。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2010-03-19T20:12:13.680

我不知道此时的答案是否对任何人仍然有用，但由于我今天才到这里，我认为其他人可能会感兴趣。

在尝试使用 BitmapFrame 测试图像是否有效时，我遇到了类似的问题，然后尝试重命名图像文件。使用此代码，图像被锁定并且移动命令不起作用：

```
bool isImageValid = true;
try
{
    BitmapFrame bmpFrame = BitmapFrame.Create(new Uri("C:\\Images\\Test.jpg"));
}
catch
{
    isImageValid = false;
}
File.Move("C:\\Images\\Test.jpg", "C:\\Images\\Test0.jpg"); 
```

但是，当我第一次在文件流中读取图像文件时，一旦使用块完成并且移动命令起作用，文件就会被释放：

```
bool isImageValid = true;
try
{
    using (FileStream fs = new FileStream("C:\\Images\\Test.jpg", FileMode.Open))
    {
        BitmapFrame bmpFrame = BitmapFrame.Create(fs);
    }
}
catch
{
    isImageValid = false;
}
File.Move("C:\\Images\\Test.jpg", "C:\\Images\\Test0.jpg"); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-07-02T06:02:43.613

尝试 bitmapImage.StreamSource.Dispose() 或 bitmapImage.Freeze();

# asp.net - ASP.NET -> WCF 并发问题

> ID：767258
> 
> 赞同：0
> 
> 时间：2009-04-20T07:34:20.077
> 
> 标签：asp.net, vb.net, wcf

我正在开发一个基于 Ajax 的应用程序，它大量使用服务器调用来与数据库通信的 WCF 层。每当我从客户端（ASP.NET 页面）在短时间内对底层 WCF 服务进行多次调用时，系统就会挂起并进入空闲状态。

我该如何处理这样的并发问题？谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2013-07-11T12:29:04.623

我怀疑您已`[AspNetCompatibilityRequirements(RequirementsMode = AspNetCompatibilityRequirementsMode.Allowed)]`在 .svc 和 Web.config中打开

要么您不需要 Session 并且禁用 AspNetCompatibilityRequirements 将解决您的问题。

或者您可能需要它只读，因此您可以更改 Global.asax.cs 中特定 svc 的 SessionStateBehavior。顺序阻塞将停止。

```
protected void Application_BeginRequest(object sender, EventArgs e) {
   if (Request.Path.Contains("AjaxTestWCFService.svc")) {
      HttpContext.Current.SetSessionStateBehavior(SessionStateBehavior.ReadOnly);
   }
} 
```

但是请注意， SessionStateBehavior.ReadOnly 将阻止写入会话而不会引发异常。写入的值将作为 null 返回。

如果您确实需要 WCF 服务中的读/写会话，您可以尝试使用可能不会公开相同阻塞行为的[SQLServer aspsessionstate 模式。](http://support.microsoft.com/kb/317604)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-20T10:26:13.627

没有您的配置很难提供帮助，但是

*   客户在通话后是否正确关闭/chanell？
*   您的服务是*每次通话*、*单身*还是*每次会话*？
*   您是否尝试过[Fiddler](http://www.fiddler2.com/fiddler2/)或其他跟踪工具来捕获您的 http 流量？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-09-10T05:26:35.110

好吧，假设问题与 DB 并发或 Web 服务器硬件无关，这里有一些可以尝试的方法... WCF 有一些限制默认值，导致我的一个应用程序出现类似问题。默认值非常低（例如 20 个并发调用/会话/实例）将以下内容添加到您的配置中：

```
<!--add a behavior to modify the throttling -->

<behaviors>
 <serviceBehaviors>
 <behavior name="LessThrottlingBehavior">
 <serviceThrottling 
        maxConcurrentCalls="100" 
        maxConcurrentSessions="100" 
        maxConcurrentInstances="100"
      />

    </behavior>
  </serviceBehaviors>
</behaviors>

<!-- modify the service to point to this behavior -->

 <services>
<service name="MyWCFServer.WCFServer" behaviorConfiguration="LessThrottlingBehavior">
</service>
</services> 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-07-11T12:39:00.193

如果 WCF 层通过 HTTP 进行通信，您可能会达到 HTTP 层所做的最大传出连接数。

[http://msdn.microsoft.com/en-us/library/system.net.servicepointmanager.defaultconnectionlimit.aspx](http://msdn.microsoft.com/en-us/library/system.net.servicepointmanager.defaultconnectionlimit.aspx)

服务器环境中的默认值是 10，这意味着从应用程序服务器到 WCF 层最多可以有 10 个并发传出连接。只需根据估计的并发 WCF 调用数将此值更改为更大的值。

具体来说，将其放入`Application_Start`您的前端 Web 应用程序（调用 WCF 服务的应用程序，而不是使用 WCF 服务的应用程序）：

```
 System.Net.ServicePointManager.DefaultConnectionLimit = 200; 
```

# testing - 如何自动化 Siebel GUI？

> ID：767259
> 
> 赞同：4
> 
> 时间：2009-04-20T07:34:47.473
> 
> 标签：testing, automation, automated-tests, siebel

我正在寻找一种方法来自动化 Siebel Retail 8.1 GUI（高交互性）以进行功能测试。

到目前为止，我发现的唯一选择是使用 HP 的 QTP，它非常昂贵。

您知道任何替代方案，或者您对 QTP 有任何经验吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-20T18:53:04.237

QTP 是一款出色的通用测试自动化工具。我对 Siebel Retail 8.1 GUI 不太了解 - 它是基于 Web 的还是胖客户端？如果是基于 Web 的，则有很多替代方案，包括开源。如果它是一个胖客户端，那么您的选择就会受到限制。QTP 的供应商替代品是 IBM Rational Functional Tester、Compuware TestPartner、Borland SilkTest。

您可能想查看相关的 SO 问题：

*   用于自动化 GUI 测试的工具（在 Windows 上）？
*   有什么方法可以自动化 Windows 窗体测试吗？
*   GUI的自动化测试
*   Windows 窗体的自动化测试

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2017-06-14T01:41:30.563

Oracle ATS 是自动化 Siebel GUI 的官方工具。

有 2 种不同的 Siebel GUI，一种是旧的 HI/SI，它是 activeX，需要 IE 才能查看。另一种叫做 OpenUI，它是纯 Web 的。

Oracle ATS 都支持它们，Oracle 上的视频展示了如何测试 Siebel。

第一个是我创建的。最后两个用于负载测试 Siebel。

[https://otube.oracle.com/media/Siebel+OpenUI+functional+testing+new+feature++in+OATS+13.1.0.1+by+Sophia+Du/0_eya24f4k/2902](https://otube.oracle.com/media/Siebel+OpenUI+functional+testing+new+feature++in+OATS+13.1.0.1+by+Sophia+Du/0_eya24f4k/2902)

[https://otube.oracle.com/media/Siebel+load+testing+%28Part+IA+creating+load+script%29/0_2hlxkxa6/2902](https://otube.oracle.com/media/Siebel+load+testing+%28Part+IA+creating+load+script%29/0_2hlxkxa6/2902)

[https://otube.oracle.com/media/Siebel+Load+Testing+%28Part+IIA+How+to+Do+Performance+Testing+for+Siebel+OpenUI+Application%29+by+Anna+Huang/0_raccbegx/ 2902](https://otube.oracle.com/media/Siebel+Load+Testing+%28Part+IIA+How+to+Do+Performance+Testing+for+Siebel+OpenUI+Application%29+by+Anna+Huang/0_raccbegx/2902)

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-05-18T22:40:05.087

我知道这是一个迟到的答复 - 但请不要太相信 QTP 来测试 Siebel。我自己和 Siebel 开发社区的同事（是的，有一个 :) 的经验发现使用 QTP 测试 Siebel 的实用性存在相当大的问题。

# perl - 如何使 Perl 的 a2p 支持 gawk？

> ID：767270
> 
> 赞同：2
> 
> 时间：2009-04-20T07:39:34.620
> 
> 标签：perl, awk

我有一些使用 cygwin 的 gawk 的 awk 脚本。现在我需要将这些脚本传递给没有安装 cygwin 但有 Perl 的同事。我希望我可以只使用 cygwin 中包含的 a2p，但它失败并出现如下错误：

```
Undefined subroutine &main::gensub called at ./t.pl line 18, <> line 1. 
```

我希望现有的 Perl 库/模块可以实现这些方法。任何指针？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-20T12:27:21.840

`gensub()`不支持该功能`a2p`。如果您修改代码以使用`gsub()`它，那么它应该可以编译。

或者，您可以`gensub()`在翻译后的 Perl 程序的末尾添加一个子例程来模拟该`gensub()`功能。

但是，由 生成的 Perl 代码`a2p`不是很容易维护，所以我只将它用作最后的手段。

如果您的 gawk 程序不调用其他 cygwin/unix 实用程序，那么最好将 Windows gawk 可执行文件与程序一起分发给您的同事。

# email - 在数据库中存储用户电子邮件地址的最佳和最安全的方法是什么？

> ID：767276
> 
> 赞同：26
> 
> 时间：2009-04-20T07:43:50.600
> 
> 标签：email, encryption, security

出于安全原因，是否值得在将用户电子邮件放入数据库之前对其进行加密？

我知道我们使用哈希和加盐密码，但这是另一回事，因为我们并不真正需要密码原件。对于电子邮件，情况就不同了。

知道解密密钥无论如何都会在数据库附近的某个地方，加密电子邮件是否有意义？我想如果有人进入系统，他们也会找到密钥，如果不是立即，那么最终。

最佳实践是什么？如果我运行自己的服务器而不是共享/虚拟主机，是否还有其他可用选项？

编辑：我打算使用 SQL Server。不，它不是有安全要求的企业软件，只是我想到的一些娱乐网站。

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2009-04-20T07:53:16.087

如果您将来需要该电子邮件地址，则必须以纯文本形式存储它们。

当然，您可以对它们进行加密，但是，在这种情况下，这实际上是通过默默无闻的安全性。基本上，如果您的应用程序的边界是安全的，则其中的数据可以是纯文本。在此处加密会增加您处理数据的复杂性，但并不能真正阻止攻击者获取您的原始数据。

正如您所说，如果他通过了您的外围防御，他很可能很容易获得您的解密密钥来解密电子邮件数据。加密可能会稍微减慢坚定的攻击者，但不会为您的数据增加任何真正的安全性。

最好的方案是散列电子邮件地址（使用盐！）并存储它。这允许您根据输入值（例如）检查电子邮件地址并验证输入的电子邮件地址是否与您存储的相同，当然，这样做的主要缺点是您无法知道电子邮件是什么address 没有那个额外的价值，所以如果你想（例如）定期给你的用户发电子邮件，那你就不走运了。

我怀疑您正在存储电子邮件地址，因为它是有用的数据，并且您*会*想要对它做一些事情（例如发送电子邮件:) 在这种情况下，加密只会增加使用该数据的开销，而获得的回报却很少.

在这种情况下，我将专注于保护对数据库本身的访问（即您的“外围”防御）并确保它们尽可能强大，同时将数据库中的数据以纯文本形式保留。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-04-20T07:47:41.123

希望这个答案也能回答你的问题。

[是否值得在数据库中加密电子邮件地址？](https://stackoverflow.com/questions/70450/is-it-worth-encrypting-email-addresses-in-the-database)

简而言之，不，不值得加密用户电子邮件地址。您认为数据库泄露可能会导致某人也获得破解您的加密所需的密钥的访问权是正确的。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2009-04-20T09:28:53.297

总的来说，我同意其他人的说法，这不值得付出努力。但是，我不同意任何可以访问您的数据库的人也可以获取您的密钥。对于 SQL 注入当然不是这样，对于以某种方式丢失或被遗忘的备份副本来说可能不是这样。而且我觉得电子邮件地址是个人信息，所以我不关心垃圾邮件，而是关心地址泄露后的个人后果。

当然，当你害怕 SQL 注入时，你应该确保这种注入是被禁止的。备份副本应自行加密。

尽管如此，对于某些在线社区，成员可能绝对不希望其他人知道他们是成员（例如与心理保健、经济帮助、医疗和性建议、成人娱乐、政治等相关的内容）。在这些情况下，尽可能少地存储个人详细信息并加密那些需要的信息（请注意，数据库级加密不会阻止使用 SQL 注入显示详细信息），这可能不是一个坏主意。再次：将电子邮件地址视为个人详细信息。

对于您的娱乐网站，情况可能并非如此，您应该专注于禁止`SELECT * FROM`通过 SQL 注入，并确保访问者无法通过更改 URL 以某种方式获取其他人的个人资料或订单信息。

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2013-04-26T17:31:55.767

> 计算机安全中最常被引用的真理之一是，唯一真正安全的计算机是埋在混凝土中的计算机，电源关闭，网络电缆被切断。

考虑到这一点，安全存储电子邮件地址的最佳方式是什么？**根本不要存储它们！**

**tl;dr**你需要他们的电子邮件地址，或者向他们发送电子邮件的方式吗？要么相信比你做得更好的人，要么根本不使用电子邮件地址。

为什么需要记录客户的电子邮件地址？我遇到的唯一原因是：

*   账户确认和认证
*   交易和营销电子邮件

**确认与认证**

我们想要的核心是两步验证：他们知道的东西和他们拥有的东西。他们知道的东西是密码，而且很容易证明，因为他们将是唯一知道密码的人。他们拥有的东西更难证明，传统上我们使用电子邮件地址，因为它很容易验证。这些天虽然我们可以使用其他东西：

*   移动电话
*   具有受信任网站（Facebook、Google、Twitter）的帐户

手机验证很简单。使用[twilio.com](https://www.twilio.com/)之类的服务向他们发送短信，并要求他们发回确认码。我们现在知道手机属于想要注册的客户。使用 OpenID，您可以使用其他受信任的站点验证现有帐户，并由他们处理确认过程。

对于客户进行身份验证，他们提供的只是他们的手机号码和密码，或 OpenID 身份验证令牌。两者都不需要电子邮件地址（OpenID 提供商可能会但那不是您的责任）。

如果这些不是一个选项，那么您仍然可以确认电子邮件地址，然后将其用于身份验证。确认只需要存储一个唯一的令牌并将一个链接发送到电子邮件地址。存储电子邮件地址的加盐哈希，并以与密码相同的方式使用它来匹配帐户。

**交易和营销电子邮件**

我们要存储电子邮件地址的真正原因！所以我们可以向他们发送我们认为他们需要的东西的报价，这样他们就可以在不阅读的情况下删除它。说真的，电子邮件是最好的媒介吗？如果我们有一个 OpenID 帐户，那么为什么不将其用于通知呢？发送 Facebook 消息或在他们的墙上写字、在 Twitter 上@提及他们、向他们的手机发送短信、构建应用程序并向他们推送通知。有很多渠道比电子邮件更有效。

如果您想使用电子邮件，请使用像[Mandrill](http://mandrill.com/)和[MailChimp](http://mailchimp.com/)这样的电子邮件平台。当他们注册时，在 MailChimp 的邮件列表中创建订阅者。将订阅者 ID 与帐户一起存储。对于交易电子邮件（重置密码、帐户更新），获取订阅者并将存储的电子邮件传递给 Mandrill 以发送电子邮件。对于大众营销，只需发送到 MailChimp 中的邮件列表。

唯一存储在数据库中的是订阅者 ID。它还提供了使用电子邮件平台、取消订阅、打开和点击率、电子商务跟踪等的所有好处。电子邮件平台将更好地交付您的电子邮件。他们在保护数据隐私方面也会比您做得更好。让他们做数据库安全方面的艰苦工作，这样您就可以专注于获得更多客户。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-20T07:49:41.647

我认为当人们可以进入您的数据库时，您无论如何都会被搞砸:)

仅仅加密您的电子邮件地址没有多大意义。除了您的数据库中还有很多您不希望收集的其他信息之外，解密密钥确实在您打开数据库的同时触手可及。

我想建议在更高级别上找到您的安全层和数据完整性。所以防止有人进入你的数据库。

为什么电子邮件地址如此重要？无论如何，大多数人都会收到垃圾邮件，否则他们的电子邮件地址将在网络上的某个地方可用。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-20T07:47:52.637

取决于您访问地址的频率。如果您偶尔阅读它们，这可能是有道理的，但这将是我花时间研究的最后一个安全问题。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-20T07:48:07.767

我不加密用户电子邮件。重点是保护数据库；如果您真的想在存储电子邮件后使用它们，那么无论如何都可以访问这些密钥。

不过，请检查地址的有效性和可能的​​ SQL 注入。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-04-20T07:49:23.693

如果应用程序服务器和数据库位于不同的服务器上，那么加密全部或部分数据库通常会提高安全性。

即使它们在同一台机器上，黑客也可能无法弄清楚您的密码存储在哪里（尽管我不会依赖它）。

我通常不会在应用程序级别加密电子邮件，而是依赖大多数企业数据库提供的数据库范围加密。

当然，如果您使用的是 MySQL 之类的东西，那么您别无选择，只能在应用程序级别进行。

我通常会告诉我的客户加密数据库不值得麻烦，但是如果您有更严格的隐私要求，这样做可能是有意义的。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-04-20T07:51:45.667

加密数据库内容始终是一个棘手的考虑。显然，除非内容可以未加密，否则内容是无用的，如果必须在没有人为干预的情况下进行，那么您将密文和密钥都存储在某处。如果*某个地方*在同一台机器上，那么人们可能想知道你为什么还要打扰。

好吧，您可能想这样做有几个原因。一是因为某些公司政策*要求您这样做。*另一个可能是您的数据库位于比访问它的机器更恶劣的环境中。

一般来说，加密数据库内容不会为您赢得任何奖项，但如果您能证明这一点，那么您显然至少有这样做的动力。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2016-05-04T15:00:11.173

是的，如果你用盐对其进行哈希处理，可能会对用户有所帮助。我有一个代码，之前我使用了盐和哈希，然后我可以解密它。流程是，一旦用户注册您，然后对其进行哈希和加盐（加密过程）。然后，如果您需要获取加密数据，则会进行解密。

# java - 休眠无PK

> ID：767277
> 
> 赞同：55
> 
> 时间：2009-04-20T07:44:32.487
> 
> 标签：java, database, hibernate, jpa

是否可以创建一个`@Entity`不包含主键/ Id 的表（来自 JPA 注释的 Hibernate ）？

我知道这不是一个好主意；一个表应该有一个主键。

* * *

## 回答 #1

> 赞同：52
> 
> 时间：2009-11-21T17:29:50.513

罗杰的自我回答是正确的。详细说明一下是什么意思（起初我并不清楚，并认为这会有所帮助）：

假设您有一张 Foo 表，如下所示：

```
TABLE Foo (
bar varchar(20),
bat varchar(20)
) 
```

通常，您可以编写一个带注释的类来使用此表：

```
// Technically, for this example, the @Table and @Column annotations 
// are not needed, but don't hurt. Use them if your column names 
// are different than the variable names.

@Entity
@Table(name = "FOO")
class Foo {

  private String bar;
  private String bat;

  @Column(name = "bar")
  public String getBar() {
   return bar;    
  }

  public void setBar(String bar) {
   this.bar = bar;    
  }

  @Column(name = "bat")
  public String getBat() {
   return bat;    
  }

  public void setBat(String bat) {
   this.bat = bat;    
  }

} 
```

..但是，该死的。该表没有我们可以用作 id 的任何内容，它是我们用于 [插入重要业务功能] 的遗留数据库。我认为他们不会让我开始修改表以便我使用休眠。

相反，您可以将对象拆分为可用于休眠的结构，该结构允许将整行用作键。（当然，这假设该行是唯一的。）

因此将 Foo 对象分成两部分：

```
@Entity
@Table(name = "FOO")
class Foo {

  @Id
  private FooKey id;

  public void setId(FooKey id) {
    this.id = id;
  }

  public void getId() {
    return id;
  }
} 
```

和

```
@Embeddable
class FooKey implements Serializable {
  private String bar;
  private String bat;

  @Column(name = "bar")
  public String getBar() {
   return bar;    
  }

  public void setBar(String bar) {
   this.bar = bar;    
  }

  @Column(name = "bat")
  public String getBat() {
   return bat;    
  }

  public void setBat(String bat) {
   this.bat = bat;    
  } 
```

}

..应该就是这样。Hibernate 将使用 Embeddable 密钥作为其所需的身份，您可以正常拨打电话：

```
Query fooQuery = getSession().createQuery("from Foo"); 
```

希望这有助于初学者获得这项工作。

* * *

## 回答 #2

> 赞同：48
> 
> 时间：2011-09-29T07:27:56.740

使用以下代码；Hibernate 没有自己的逻辑来区分重复记录

让我知道这种方法是否有任何问题

```
@Entity @IdClass(Foo.class)
class Foo implements Serializable {
  @Id private String bar;
  @Id private String bat;

  public String getBar() {
   return bar;    
  }

  public void setBar(String bar) {
   this.bar = bar;
  }

  public String getBat() {
   return bat;    
  }

  public void setBat(String bat) {
   this.bat = bat;    
  }
} 
```

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2016-05-19T14:41:49.737

我发现这个技巧有效：

```
<id column="ROWID" type="string" /> 
```

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2009-04-29T13:30:56.593

我发现这是不可能的。对于那些使用遗留系统的人来说，运气太差了。

如果您进行反向工程（从现有的 JDBC 连接创建 JPA 注释实体），该表将创建两个 Java 类，一个实体和一个字段；id，以及一个包含关系中所有列的可嵌入 id。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2019-02-26T09:12:49.590

Though ROWID is a pseudo-column,yet as ROWID corresponds to the physical address of a ROW, it is the quickest mean to retrieve any row data. As @Id is used to identify the object uniquely and ROWID is unique inside a table, we can exploit it to overcome the issue we are discussing about. Actually, if we don't need any meaningful unique identifier, ROWID is the best column to annotate with @Id annotation as it corresponds to the physical address of the row. The following code worked for me. `@Id @Column(name = "ROWID") private String Id;`

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2011-05-25T19:26:25.627

您不需要创建一个单独的类作为您的@Id 或主键。只需使用整数（或其他）。另外，不要发布假密钥，因为使用它的开发人员可能会认为它是真实的并尝试使用它。最后，这最好用在 VIEW 中。我同意之前的帖子，在大多数情况下（如果不是所有情况），表都应该有一个主键。例如：

```
@Entity
@Table(name = "FOO")
class Foo {

  @SuppressWarnings("unused")
  @Id
  private Integer id;

  @Column(name = "REAL_COLUMN")
  private String realColumn;

  public String getRealColumn() {
    return realColumn;    
  }

  public void setRealColumn(String realColumn) {
    this.realColumn= realColumn;    
  }

} 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2014-07-21T11:08:39.930

从表中创建 Pojo - 使用 eclipse 中存在的逆向工程方法。对于非主键表，eclipse会生成两个Pojo类。

```
eclipse generated class and hbm.xml - 
---
Foo.java 
//

public class Foo implements java.io.Serializable {

    private FooId id;

    public Foo() {
    }

    public Foo(FooId id) {
        this.id = id;
    }

    public FooId getId() {
        return this.id;
    }

    public void setId(FooId id) {
        this.id = id;
    }

}
---
FooId.java
//

public class FooId implements java.io.Serializable {

    private String bar;
    private String bat;

    public FooId() {
    }

    public FooId(String bar, String bat) {
        this.bar = bar;
        this.bat = bat;
    }

    public String getBar() {
        return this.bar;
    }

    public void setBar(String bar) {
        this.bar = bar;
    }

    public String getBat() {
        return this.bat;
    }

    public void setBat(String bat) {
        this.bat = bat;
    }

    public boolean equals(Object other) {
        if ((this == other))
            return true;
        if ((other == null))
            return false;
        if (!(other instanceof FooId))
            return false;
        FooId castOther = (FooId) other;

        return ((this.getBar() == castOther.getBar()) || (this.getBar() != null
                && castOther.getBar() != null && this.getBar().equals(
                castOther.getBar())))
                && ((this.getBat() == castOther.getBat()) || (this.getBat() != null
                        && castOther.getBat() != null && this.getBat().equals(
                        castOther.getBat())));
    }

    public int hashCode() {
        int result = 17;

        result = 37 * result
                + (getBar() == null ? 0 : this.getBar().hashCode());
        result = 37 * result
                + (getBat() == null ? 0 : this.getBat().hashCode());
        return result;
    }

}
---
Foo.hbm.xml

<hibernate-mapping>
    <class name="com.Foo" table="foo" schema="public" catalog="hibernate_poc">
        <composite-id name="id" class="com.FooId">
            <key-property name="bar" type="string">
                <column name="bar" length="20" />
            </key-property>
            <key-property name="bat" type="string">
                <column name="bat" length="20" />
            </key-property>
        </composite-id>
    </class>
</hibernate-mapping>

---
entry in the Hibernate.cfg.xml - 

<mapping class="com.poc.Foo" resource="Foo.hbm.xml"/>

---
Fetch the Data from table -
FooDataFetch.java
//

import java.util.List;

import org.hibernate.Query;
import org.hibernate.Session;
import org.hibernate.SessionFactory;
import org.hibernate.Transaction;
import org.hibernate.cfg.Configuration;

public class FooDataFetch {
        private static Session session = null;

   public static void main(String[] args) {
          try{            
            Configuration cfg = new Configuration();
            cfg.configure("/hibernate.cfg.xml");
            SessionFactory sf = cfg.buildSessionFactory();
            session = sf.openSession();

            session.beginTransaction();
              queryPerson(session);
            session.close(); 

          }catch (Throwable ex) { 
             System.err.println("Failed to create sessionFactory object." + ex);
            ex.printStackTrace();
             throw new ExceptionInInitializerError(ex); 
          }       
       }    

       private static void queryPerson(Session session) {
            Query query = session.createQuery("from Foo");                 
            List <Foo>list = query.list();
            java.util.Iterator<Foo> iter = list.iterator();
            while (iter.hasNext()) {
                Foo foo = iter.next();
                System.out.println("Foo Details: \"" + foo.getId().getBar() +"\", " + foo.getId().getBat());
            }
        }      
} 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2015-03-26T14:29:43.267

添加到 Awied 的评论中。如果您想搜索柱，请使用以下 HQL。

```
Query fooQuery = getSession().createQuery("from Foo.id.bar = '<barName>'"); 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2017-05-18T14:17:43.467

当涉及到视图而不是在 Hibernate 中搜索解决方法时，在数据库视图中添加虚拟 id 可能更容易。我在另一个问题中写过：[https ://stackoverflow.com/a/44050230/1673775](https://stackoverflow.com/a/44050230/1673775)

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2016-09-08T06:44:27.167

我找到了没有主键和 null 作为值的表的解决方案。它将在 oracle DB 上运行。其他数据库可能存在类似的情况。

1.  您应该在 POJO 类中创建新的主键：

    @Id @Column(name="id") 私有整数 id；

并像这样使用 createNativeQuery

```
getEntityManager().createNativeQuery("select rownum as id, ..... 
```

本机查询将生成主键，您将获得唯一的结果。

# java - 在程序终止的情况下如何关闭端口？

> ID：767292
> 
> 赞同：9
> 
> 时间：2009-04-20T07:50:17.717
> 
> 标签：java, multithreading, sockets, jvm

我在我的一个 Java 应用程序中使用 Socket 通信。据我所知，如果程序遇到任何异常终止，侦听端口不会关闭并且程序无法重新启动，因为它报告“端口已经打开..”我有吗？处理这个问题？处理这个问题的一般方法是什么？

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2009-04-20T08:00:43.977

听起来您的程序正在侦听套接字。通常，当您的程序退出时，操作系统会关闭所有可能打开的套接字（包括侦听套接字）。但是，对于侦听套接字，操作系统通常会在程序退出后保留端口一段时间（几分钟），以便它可以处理任何未完成的连接尝试。您可能会注意到，如果您异常关闭程序，然后过一段时间再回来，它会正常启动。

如果你想避免这个延迟时间，你可以使用`setsockopt()`SO_REUSEADDR 选项来配置套接字。这告诉操作系统你知道重复使用相同的地址是可以的，你不会遇到这个问题。

您可以使用该[`ServerSocket.setReuseAddress(true)`](http://java.sun.com/j2se/1.4.2/docs/api/java/net/ServerSocket.html#setReuseAddress(boolean))方法在 Java 中设置此选项。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-20T08:00:46.677

您想在套接字上设置 SO_REUSEADDR 标志。

请参阅[setReuseAddress()](https://docs.oracle.com/javase/1.5.0/docs/api/java/net/ServerSocket.html#setReuseAddress(boolean))。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-20T07:54:25.147

当 JVM 进程结束时，操作系统应该自动处理诸如此类的事情。不过，在关闭端口之前可能会有短暂的延迟。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-20T07:55:18.780

正如[处理异常 Java 程序退出](https://stackoverflow.com/questions/590899/handling-abnormal-java-program-exits)中所述，如果确实需要显式操作，您可以设置一个**[Runtime.addShutdownHook()](http://java.sun.com/javase/6/docs/api/java/lang/Runtime.html#addShutdownHook%28java.lang.Thread%29)**方法来处理任何特殊情况。

# php - mysqldump passthru 返回码的

> ID：767295
> 
> 赞同：0
> 
> 时间：2009-04-20T07:51:03.063
> 
> 标签：php, mysql, mysqldump, passthru

我正在尝试通过 php 进行 mysql 转储。

这是代码

```
$backupFile = $table. "-". date("Y-m-d-H:i:s") . '.gz';
    //Command nog aanpassen....
    $command = "mysqldump --opt -h $dbhost -u $dbuser -p $dbpass $dbname  | gzip > $backupFile";
    //$status = system($command);
    echo $backupFile ."<br>";
    $status = passthru($command, $a);
    echo "output:" .  $a; 
```

$a = 2 的值。但我找不到它的含义。我也无法在任何地方找到备份文件。

有任何想法吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-20T08:02:22.070

我不确定这是否是问题，但看起来您的密码传递参数不正确。

如果你使用 -p 你需要在它旁边有密码，没有空格，像这样：

```
$command = "mysqldump --opt -h $dbhost -u $dbuser -p$dbpass $dbname  | gzip > $backupFile"; 
```

或使用长 --password=$dbpass。

例如：

```
$command = "mysqldump --opt -h $dbhost -u $dbuser --password=$dbpass $dbname  | gzip > $backupFile"; 
```

从 mysqldump 手册页：

> --password[=密码], -p[密码]
> 
> 连接到服务器时使用的密码。如果使用短选项形式 (-p)，则选项和密码之间不能有空格。如果您在命令行中省略了 --password 或 -p 选项后面的密码值，系统会提示您输入密码值。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-11-10T19:35:20.577

也可能是您的备份目的地。确保您正在运行 mysqldump 的用户（在您的情况下可能是 www-data 或其他一些 apache 用户）对您尝试写入备份的目录具有写入权限。很多时候我会从命令行尝试一个命令..并看到它工作正常..但我是root，或者我的用户..不是www-data。

# jpa - EJB 在单个事务中查找持久数据

> ID：767297
> 
> 赞同：0
> 
> 时间：2009-04-20T07:51:52.423
> 
> 标签：jpa, transactions, ejb

假设我在 db 中有两个表：Car 和 Part。汽车拥有任意数量的零件。

因为我使用 EJB 3.0，所以我有 Car 和 Part 的实体 bean，而 Car 实体 bean 包含 Part 对象的列表。

我想将新零件保存到 db 中，然后从 db all Cars 中获取。我希望我刚刚添加的部分是与获取的汽车相关的部分之一。但事实并非如此。

我确实坚持并在单个事务中找到，所以这就是我猜的问题。如何在 entityManager 上调用 persist 后立即将某些内容保存到 db 并从 db 中获取？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-20T14:08:50.363

尝试在持久化 Part 和获取 Car 实体之间使用 EntityManager 的 flush 方法。

# security - 是否有任何研究支持或反对频繁更改密码？

> ID：767310
> 
> 赞同：18
> 
> 时间：2009-04-20T07:57:50.880
> 
> 标签：security, passwords

我正在寻找有关频繁更改密码的安全效果的研究，研究每隔一两个月或类似时间强制更改密码的安全优势/问题。

有人知道吗？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-20T08:11:50.737

[这](https://cryptosmith.com/password-sanity/exp-harmful/)是一篇关于密码策略的研究文章。它提到了人们应该更改密码的频率以及其他一些非常有趣的东西。以下是摘录。

> 一些专家表示，如果攻击者截获密码，定期更改密码将减少损失：一旦更改密码，攻击者就会被锁定。这假设恢复的密码不会向攻击者提供有关受害者当前密码的任何提示。事实上，定期更改密码往往会鼓励人们设计密码序列，例如 secret01a、secret01b、secret01c 等。
> 
> 这使用户可以在旧密码过期时轻松选择并记住新密码。这样的序列对于攻击者来说通常是非常明显的，因此受害者的任何一个旧密码都可能会为攻击者提供相当少量的密码来猜测。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-20T08:29:01.460

TechReport[强大的 Web 密码可以实现任何目标吗？](http://research.microsoft.com/pubs/70445/tr-2007-64.pdf)声明“只有在攻击者利用获取的凭据极其缓慢的情况下，经常更改密码才有帮助。”</p>

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-04-20T08:12:19.177

在我看来，强迫人们过于频繁地更改密码会降低安全性，因为人们能记住这么多密码的唯一方法就是开始使用愚蠢的密码，如 Computer123 或 January1，然后是 February1 等……

一个更好的主意是减少频率，然后培训人们如何创建强密码。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-04-20T08:36:33.627

虽然不*完全*是您正在寻找的研究，但它密切相关，可能会将您推向正确的方向。我已经看过一些关于您正在寻找的特定主题的研究，但目前还找不到参考资料。

[微软安全大师建议：“写下你的密码”](http://news.cnet.com/Microsoft-security-guru-Jot-down-your-passwords/2100-7355_3-5716590.html)

密码可能会发生许多不好的事情，并且希望在不产生新问题的情况下尽可能地减轻这些事情。“更改您的密码”政策旨在通过限制攻击者的机会窗口来减轻您的密码泄露可能造成的损害。虽然不是所有安全措施的最终目的，但它有时会产生巨大的影响。作为一名安全顾问，如果公司至少每年更改一次重要密码，我个人（仅今年）就已经花费了数万美元来清理本可以完全避免的混乱。

频繁更改密码的危险在于您会选择糟糕的密码。这使情况变得更糟，因为它现在允许进行原本不可能的攻击。

链接文章中提到的新智慧是选择（或分配）一个随机密码，可能会定期更改，并将其写在您安全的地方。显然，你不会把它留在你的电脑上，就像你不会把钥匙留在你的车里一样。理由是人们已经接受过培训，知道如何保护“事物”，但在保护信息方面自然很差。因此，如果您将密码变成您可以持有的东西，那么您可以像保护密钥一样保护它。在实践中，这非常有效，但它往往会让 IT 部门感到紧张。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2016-08-09T22:06:33.197

2016 年 8 月更新：

本文：“频繁更改密码是安全的敌人，FTC 技术专家说” [http://arstechnica.com/security/2016/08/frequent-password-changes-are-the-enemy-of-security-ftc-technologist -says/?imm_mid=0e6947&cmp=em-webops-na-na-newsltr_security_20160809](http://arstechnica.com/security/2016/08/frequent-password-changes-are-the-enemy-of-security-ftc-technologist-says/?imm_mid=0e6947&cmp=em-webops-na-na-newsltr_security_20160809) 本周出现在各处，包括 Bruce Scheier 的博客、O'Reilly 的安全通讯、ArsTechnica、Slate 和 NewsCombinator，可能正是您想要的今年早些时候要求的。

它参考： [https ://www.cs.unc.edu/~reiter/papers/2010/CCS.pdf](https://www.cs.unc.edu/~reiter/papers/2010/CCS.pdf)

TL;DR 摘要：停止过期/更改密码。这是一种非常糟糕的安全做法。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-04-20T08:11:35.090

我不知道存在任何研究，但为了让您考虑问题的两个方面，这里有一篇反对强制更改密码的论文：

[管理网络安全 - 第 10 部分：更改密码](http://www.sciencedirect.com/science?_ob=ArticleURL&_udi=B6VJG-3WNN2SR-3&_user=88470&_rdoc=1&_fmt=&_orig=search&_sort=d&view=c&_acct=C000006998&_version=1&_urlVersion=0&_userid=88470&md5=2881320c4a258bcb50c15b9c5fdb7426)

还有一个教育机构的教学网站，它至少提出了一个令人信服的案例（由博士撰写），迫使用户经常更改密码。这些是网站在链接到页面后提供的强制密码更改的主要参数：

[“为什么我必须更改我的 !@$%#* 密码？”](http://cc.uoregon.edu/cnews/spring2006/passwords.htm)

*   如果您被要求至少每六个月更改一次密码，那么一旦您的密码被更改，有人在您不知情的情况下盗取了您的密码并访问了您的帐户，将立即被拒之门外。有些人可能认为这是一种不常见的情况，但人们通常会在出售旧电脑时忘记删除他们可能为拨号或访问电子邮件而保存的密码。
*   如果您至少每六个月更改一次密码，那么可能试图使用暴力破解您的密码（如上所述）的黑客基本上需要重新开始，因为您的密码现在可能已更改为他们已经尝试过的某种模式并且被拒绝。
*   强制更改密码还会阻止用户在多个帐户上使用相同的密码。（在多个帐户上使用相同的密码是不好的，因为那样你的密码只有与共享该公共密码的系统中最不安全的系统一样安全，而且如果你的帐户确实受到威胁，坏人突然不仅可以访问一个帐户，但要多个帐户，放大问题的范围）。

就“研究”而言，这些可能不会削减它，但似乎至少是对争论双方的一个很好的介绍。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-04-20T08:18:41.797

这不是一项研究，但 Gene Spafford 发表了一篇短文，讨论了频繁更改密码的政策没有多大意义的原因：

*   [http://www.cerias.purdue.edu/site/blog/post/password-change-myths/](http://www.cerias.purdue.edu/site/blog/post/password-change-myths/)

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2012-01-06T20:36:17.120

当您认为您的密码可能已经或即将被泄露时，应更改密码。否则，通常是无用的浪费时间，实际上是安全隐患。请参阅此链接：

[http://old.news.yahoo.com/s/ytech_wguy/20100413/tc_ytech_wguy/ytech_wguy_tc1590](http://old.news.yahoo.com/s/ytech_wguy/20100413/tc_ytech_wguy/ytech_wguy_tc1590)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2016-11-07T15:01:51.647

这是一篇发表在 ACM 出版物（自 2010 年起）中的优秀论文，讨论了安全性和用户期望的成本效益分析。

[http://research.microsoft.com/en-us/um/people/cormac/papers/2009/SoLongAndNoThanks.pdf](http://research.microsoft.com/en-us/um/people/cormac/papers/2009/SoLongAndNoThanks.pdf)

它确实声称更改密码肯定是个好建议，但它可能不值得用户付出代价，因为几乎没有证据支持我们更频繁地更改密码更安全的想法。这真是一篇好文章。

# installation - 通过 cmd 行或 GUI 设置 JAVA_HOME 有区别吗

> ID：767315
> 
> 赞同：5
> 
> 时间：2009-04-20T08:00:11.607
> 
> 标签：installation, java

这是一个真正的菜鸟问题。

当我使用命令行界面设置 JAVA_HOME 时，我使用了 set JAVA_HOME = C:\Program Files\Java\jdk1.6.0_13

但是，当我从 System>Advanced>Environment Variables 打开 JAVA_HOME 变量时，更改不可见。这是两个不同的设置吗？

每次我设置一个新的 Jdk 时都会有这个问题，并且从来没有完全理解为什么两者似乎不同。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-20T08:03:27.030

您在命令行上设置的变量适用于*该*命令外壳和它启动的任何其他进程。当您从系统/高级/环境变量设置它时，它会在设置后影响您启动的任何其他进程，包括命令 shell。根据您设置它的位置，同一用户或登录的任何其他用户都可以使用它。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-20T08:03:56.233

您通过命令行设置的 JAVA_HOME 仅为该 shell 会话设置。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-20T08:04:13.330

对父进程所做的更改只会传播到新创建的子进程；尝试打开一个新的命令提示符并检查那里的值。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-20T17:02:47.280

其他人怎么说... :-)

我将补充一点，即使在对话框中设置了变量之后，已经运行的进程（通常）也不知道更改：例如。命令提示符窗口仍将显示旧值。您必须启动另一个窗口才能看到更改。
在某些（极少数）情况下，您甚至可能需要注销并重新登录以验证更改（我最近又看到了）。

# asp.net - 如何设置服务参考授权？

> ID：767316
> 
> 赞同：0
> 
> 时间：2009-04-20T08:00:16.083
> 
> 标签：asp.net, soap, web-config

如何在 web.config 中设置服务引用的授权？

我正在编写一个密码检索器，它通过电子邮件发送用户密码。电子邮件是通过 SOAP 服务引用发送的。但是，每次我尝试声明对 SOAP API 的引用时，Web 应用程序都会返回到登录页面 - 当您请求需要用户授权的内容时的默认操作。

自然，我需要能够在没有用户登录的情况下调用服务引用，因为它毕竟是一个密码检索器。我知道这是如何针对`<location path="Webpage.aspx">`某种类型的东西完成的，但不是针对服务参考，而且我很难在 Google 上找到答案。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-20T08:44:36.463

啊！事实证明这最终不是授权问题 - 一些向导在 web.config 中戳了一下并弄得一团糟，最终导致了类似于授权问题的问题。

请投票结束问题，因为它不再相关。

# c# - 服务器应该如何向富客户端推送数据

> ID：767321
> 
> 赞同：4
> 
> 时间：2009-04-20T08:02:14.130
> 
> 标签：c#, java, client-server

我正在编写一个简单的会计程序，由几个 C# winform 客户端和一个将数据读/写到数据库中的 java 服务器应用程序组成。其中一项要求是所有 C# 客户端都应从服务器接收更新。例如，如果用户 a 从他的 C# 客户端创建新发票，其他用户应该从他们的客户端看到这个新发票。

我的经验主要是 Web 开发，我不知道用 C#s 客户端和 Java servlet 服务器满足这一要求的最佳方法是什么。

我最初的想法是使用 Glassfish 运行 ActiveMQ 并使用消息传递 pub/sub 方法，以便可以将更新推送到 C# 客户端。我将创建不同的主题，如 newInvoice、cancelInvoice 等，以区分消息类型。每条消息将只包含以 JSON 编码的对象。

但在我看来，这涉及到相当多的工作。鉴于我的用户群非常小（只有 3 或 4 个并发用户），在我看来应该有一些更简单的解决方案。（我不熟悉套接字编程:)）

我知道这是一个客户端-服务器编程 101 问题，但如果任何有经验的程序员可以为我指出一些简单的解决方案，那就太好了。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-20T08:14:05.473

这里*最简单*的方法通常是简单地使用轮询 - 即让客户端每次（您的时间间隔）查询数据。这避免了一系列问题（防火墙、安全、视线、分辨率、客户端跟踪等）。

使用 WCF，您可以在双工通道上进行回调（允许服务器主动向客户端发送消息），但这更复杂。我重视简单，所以我通常只是投票。

有助于此处的技巧是将系统设计为具有用于查询“自 x 以来的更改”的内置机制 - 例如，可能由数据库触发器提供的审计表。当然，具体细节因项目而异。

您可能想要查看的另一个选项是 ADO.NET 同步服务；这可以满足您的大部分要求，以使数据库的本地副本与服务器保持最新 - 但它本身有一些复杂性。这在“本地数据库缓存”VS 模板中可用（IIRC）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-09-25T21:59:04.747

您可能想看看[StreamHub 推送服务器](http://www.stream-hub.com/)- 它是一种流行的用 Java 编写的 Comet 服务器，它有一个 .NET 客户端 SDK，用于从 C# 中的服务器接收更新。它还具有 Java 客户端 SDK 和通常的 Ajax/Comet Web 浏览器支持，使您在将来可以更灵活地将数据推送到 Web、Java 和 C# 客户端。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-20T13:35:03.253

您可以使用多种推送技术，例如 ActiveMQ（如您所提到的）或 XMPP。但是，如果您只需要关心 3 或 4 个客户，那么轮询将是最简单的解决方案。它不能很好地扩展，但这并不是你真正关心的问题，除非你的服务器是 8086 或什么 8-)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-20T08:12:02.763

与其将信息从服务器推送到 1:N 客户端，让客户端每隔一段时间轮询服务器以获取更新不是更容易吗？或者当客户端启动并创建到服务器的连接时，服务器可以为该客户端连接动态生成一个新的消息队列，然后客户端可以轮询更新？

# php - 在 SimpleXML 中，如何将现有的 SimpleXMLElement 添加为子元素？

> ID：767327
> 
> 赞同：9
> 
> 时间：2009-04-20T08:03:57.793
> 
> 标签：php, oop, simplexml

我有一个 SimpleXMLElement 对象 $child 和一个 SimpleXMLElement 对象 $parent。

如何将 $child 添加为 $parent 的子级？有没有办法做到这一点而无需转换为 DOM 并返回？

addChild() 方法似乎只允许我创建一个新的空元素，但是当我要添加的元素 $child 也有子元素时，这无济于事。我想我可能需要在这里递归。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2013-02-12T11:24:23.190

不幸的是[`SimpleXMLElement`](http://php.net/SimpleXMLElement)，它没有提供任何东西来将两个元素结合在一起。正如[@nickf 所写](https://stackoverflow.com/a/767358/367456)，它更适合阅读而不是操作。但是，姊妹扩展名`DOMDocument`用于编辑，您可以通过[`dom_import_simplexml()`](http://php.net/dom_import_simplexml). @salathe[在相关答案中显示](https://stackoverflow.com/a/3418317/367456)了这对于特定的 SimpleXMLElements 是如何工作的。

下面显示了它如何与输入检查和更多选项一起工作。我用两个例子来做。第一个示例是插入 XML 字符串的函数：

```
/**
 * Insert XML into a SimpleXMLElement
 *
 * @param SimpleXMLElement $parent
 * @param string $xml
 * @param bool $before
 * @return bool XML string added
 */
function simplexml_import_xml(SimpleXMLElement $parent, $xml, $before = false)
{
    $xml = (string)$xml;

    // check if there is something to add
    if ($nodata = !strlen($xml) or $parent[0] == NULL) {
        return $nodata;
    }

    // add the XML
    $node     = dom_import_simplexml($parent);
    $fragment = $node->ownerDocument->createDocumentFragment();
    $fragment->appendXML($xml);

    if ($before) {
        return (bool)$node->parentNode->insertBefore($fragment, $node);
    }

    return (bool)$node->appendChild($fragment);
} 
```

该示例性功能允许附加 XML 或将其插入到某个元素之前，包括根元素。在确定是否有要添加的内容后，它利用*DOMDocument* 函数和方法将 XML 作为文档片段插入，这也在[如何在 PHP DOMDocument 中导入 XML 字符串中进行了](https://stackoverflow.com/q/4081090/367456)概述。使用示例：

```
$parent = new SimpleXMLElement('<parent/>');

// insert some XML
simplexml_import_xml($parent, "\n  <test><this>now</this></test>\n");

// insert some XML before a certain element, here the first <test> element
// that was just added
simplexml_import_xml($parent->test, "<!-- leave a comment -->\n  ", $before = true);

// you can place comments above the root element
simplexml_import_xml($parent, "<!-- this works, too -->", $before = true);

// but take care, you can produce invalid XML, too:
// simplexml_add_xml($parent, "<warn><but>take care!</but> you can produce invalid XML, too</warn>", $before = true);

echo $parent->asXML(); 
```

这给出了以下输出：

```
<?xml version="1.0"?>
<!-- this works, too -->
<parent>
  <!-- leave a comment -->
  <test><this>now</this></test>
</parent> 
```

第二个例子是插入一个`SimpleXMLElement`. 如果需要，它会使用第一个功能。它基本上检查是否有事情要做以及要导入哪种元素。如果是属性，则直接添加，如果是元素，则序列化为XML，然后作为XML添加到父元素中：

```
/**
 * Insert SimpleXMLElement into SimpleXMLElement
 *
 * @param SimpleXMLElement $parent
 * @param SimpleXMLElement $child
 * @param bool $before
 * @return bool SimpleXMLElement added
 */
function simplexml_import_simplexml(SimpleXMLElement $parent, SimpleXMLElement $child, $before = false)
{
    // check if there is something to add
    if ($child[0] == NULL) {
        return true;
    }

    // if it is a list of SimpleXMLElements default to the first one
    $child = $child[0];

    // insert attribute
    if ($child->xpath('.') != array($child)) {
        $parent[$child->getName()] = (string)$child;
        return true;
    }

    $xml = $child->asXML();

    // remove the XML declaration on document elements
    if ($child->xpath('/*') == array($child)) {
        $pos = strpos($xml, "\n");
        $xml = substr($xml, $pos + 1);
    }

    return simplexml_import_xml($parent, $xml, $before);
} 
```

这个示例性函数确实标准化了元素列表和属性列表，就像 Simplexml 中常见的一样。您可能希望将其更改为一次插入多个 SimpleXMLElements，但正如下面的用法示例所示，我的示例不支持该示例（请参阅属性示例）：

```
// append the element itself to itself
simplexml_import_simplexml($parent, $parent);

// insert <this> before the first child element (<test>)
simplexml_import_simplexml($parent->children(), $parent->test->this, true);

// add an attribute to the document element
$test = new SimpleXMLElement('<test attribute="value" />');
simplexml_import_simplexml($parent, $test->attributes());

echo $parent->asXML(); 
```

这是第一个使用示例的延续。因此现在的输出是：

```
<?xml version="1.0"?>
<!-- this works, too -->
<parent attribute="value">
  <!-- leave a comment -->
  <this>now</this><test><this>now</this></test>
<!-- this works, too -->
<parent>
  <!-- leave a comment -->
  <test><this>now</this></test>
</parent>
</parent> 
```

我希望这是有帮助的。您可以[在 gist](https://gist.github.com/hakre/4761677)和[在线演示](http://eval.in/9568)/ [PHP 版本概述](http://3v4l.org/1sI05)中找到代码。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-04-20T08:16:49.040

我知道这不是最有用的答案，但特别是因为您正在创建/修改 XML，我会切换到使用 DOM 函数。SimpleXML 非常适合访问简单的文档，但在更改它们方面却很差。

如果 SimpleXML 在所有其他地方都对您很好，并且您想坚持下去，您仍然可以选择暂时跳到 DOM 函数以执行您需要的操作，然后再跳回来，使用[`dom_import_simplexml()`](http://au.php.net/manual/en/function.dom-import-simplexml.php)and [`simplexml_import_dom()`](http://au.php.net/manual/en/function.simplexml-import-dom.php)。我不确定这有多有效，但它可能会帮助你。

* * *

## 回答 #3

> 赞同：-2
> 
> 时间：2013-01-16T16:32:11.903

实际上，如果您仔细查看`addChild()`定义的方式，则可能（动态地）。我使用这种技术通过递归和引用传递将任何数组转换为 XML

*   `addChild()`添加的孩子的回报`SimpleXMLElement`。
*   要添加叶节点，请使用`$xml->addChilde($nodeName, $nodeValue)`.
*   要添加可能具有子节点或值的节点，请使用 `$xml->addChilde($nodeName)`，没有值传递给`addChild()`。这将产生一个 SimpleXMLElement 类型的子节点！不是字符串！

**目标 XML**

```
<root>
    <node>xyz</node>
    <node>
        <node>aaa</node>
        <node>bbb</node>
    </node>
</root> 
```

**代码：**

```
$root = new SimpleXMLElement('<root />');
//add child with name and string value.
$root.addChild('node', 'xyz'); 
//adds child with name as root of new SimpleXMLElement
$sub = $root->addChild('node');
$sub.addChild('node', 'aaa');
$sub.addChild('node', 'bbb'); 
```

* * *

## 回答 #4

> 赞同：-3
> 
> 时间：2012-06-11T23:15:45.177

把这个留在这里，因为我偶然发现了这个页面，发现 SimpleXML 现在通过[::addChild 方法](http://php.net/manual/en/simplexmlelement.addchild.php)支持这个功能。

您也可以使用此方法添加任何级联元素：

```
$xml->addChild('parent');
$xml->parent->addChild('child');
$xml->parent->child->addChild('child_id','12345'); 
```

# c# - .NET Compact Framework 中标签/文本框的 AutoSize

> ID：767335
> 
> 赞同：4
> 
> 时间：2009-04-20T08:08:28.170
> 
> 标签：c#, .net, compact-framework

对于 .NET Compact Framework 中的 Label 和 TextBox 控件的 AutoSize 属性的省略，我简直要疯了。我有一个简单的应用程序，它应该在 TabControl 中列出一堆文本数据（通常在单行到几段文本之间）。其他一切工作顺利，但我尝试动态调整用于显示文本的 Label / TextBox -controls 的尝试失败了。

这是我尝试过的方式：

```
/*
Variables: 
s = The text intended for the TextBox
NewTB = TextBox object
width = Intended width
whiteSpaceAdjustment = amount of pixels per line to adjust "wasted" whitespace due to wrapping
*/

String[] linesArray = s.Replace(Environment.NewLine, "\n").Split(new char[] { '\n' });

int lines = 0;

int lineHeight = g.MeasureString(
        s.Replace("\n", "").Replace("\r", ""),
        LabelFont
    ).ToSize().Height;

foreach (String str in linesArray) {
    if (str.Length == 0) {
        lines++;
        continue;
    }
    szz = g.MeasureString(str, LabelFont).ToSize();
    lines += szz.Width / (width - whiteSpaceAdjustment);
    lines += (szz.Width % width) != 0 ? 1 : 0;
}
NewTB.Height = lines * lineHeight;
NewTB.Width = width; 
```

...但问题是 whiteSpaceAdjustment 所需的范围太大。当它足够大以实际处理最极端的情况（段落主要由非常长的单词组成）时，大多数框最终都会太高一两行。

我可能不得不自己实现自动换行，但在我去那里之前，有没有人准备好一个干净的解决方案？

我将永远感激不尽！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-20T08:17:54.637

试试这篇文章

[www.mobilepractices.com/2007/12/multi-line-graphicsmeasurestring.html](http://www.mobilepractices.com/2007/12/multi-line-graphicsmeasurestring.html)

确保您还查看了文章底部的链接，以便能够使用不同的字体。

如果您使用的是 .Net CF 3.5，您可以将他们的示例转换为扩展方法。否则，我建议您创建一个继承自框架控件的新控件。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2016-05-16T08:16:37.663

这是我为在 WinCE 中自动调整标签宽度而开发的。

```
/// <summary>
/// This class provides dynamic size labels, i.e. as the text grows lable width will grow with it. 
/// </summary>
public partial class AutoSizeLabel : UserControl
{
    private string _strText;
    private const int padding = 10;

    public AutoSizeLabel()
    {
        InitializeComponent();
    }

    public override string Text
    {
        get
        {
            return _strText;
        }
        set
        {
            _strText = value;
            Refresh();
        }
    }

    protected override void OnPaint(PaintEventArgs pe)
    {
        SizeF size = pe.Graphics.MeasureString(this.Text, this.Font);
        this.Size = new Size((int)size.Width + padding, this.Height);

        if (this.Text.Length > 0)
        {
            pe.Graphics.DrawString(this.Text,
                this.Font,
                new SolidBrush(this.ForeColor),
                (this.ClientSize.Width - size.Width) / 2,
                (this.ClientSize.Height - size.Height) / 2);
        }
        // Calling the base class OnPaint
        base.OnPaint(pe);
    }
} 
```

# sql-server-2005 - 删除或不删除 ssis 包目标表中的行

> ID：767338
> 
> 赞同：3
> 
> 时间：2009-04-20T08:09:42.740
> 
> 标签：sql-server-2005, ssis

我使用 sql server 2005 management studio 中的导入/导出向导将行从 excel 表导出到 sql 表，并选中不要删除目标表中的行选项。我将导出操作保存为 ssis 包，是的，新行正在附加到现有行，但现在我需要删除目标 sql 表中的所有行。

当我进入 BIDS 编辑我的包时，我无法在任何地方找到更改此行为的选项。有人知道如何更改 ssis 包设计器的此设置吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-20T18:44:10.827

当您启用删除目标行选项时，“执行 SQL 任务”将添加到包的控制流中。此任务用于在目标上执行 TRUNCATE TABLE 语句。在您的包中，控制流可能包含单个数据流任务。只需添加一个执行 SQL 任务并将其连接到数据流任务。将目标连接管理器分配给执行 SQL 任务并将 SQL 语句设置为“TRUNCATE TABLE [yourdestinationtable]”

# .net - 属性与评论

> ID：767340
> 
> 赞同：2
> 
> 时间：2009-04-20T08:10:19.850
> 
> 标签：.net, attributes

与使用注释（或签名级别的 xml 注释）相比，属性有哪些优势？我确实记得在某个地方的这个站点的 C# 部分看到了一个线程，但我现在找不到它。

另外，是否可以将属性应用于方法中的特定参数（这是我在某处读到的面试问题）？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-20T08:18:16.900

注释只是为了开发者的利益，让他们可以看到类和方法是关于什么的。

属性对您正在开发的解决方案很有用，因为您可以使用它来描述如何使用要添加属性的类。

是的，您可以对参数使用属性，但根据我的经验，这会导致一些复杂的代码，考虑重新设计，以便您的参数可以分组到结构或类中。

这是一个关于属性的链接：

[http://en.csharp-online.net/Attributes](http://en.csharp-online.net/Attributes)

希望这可以帮助

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-20T08:15:09.170

我不明白属性和评论是如何相关的；属性为类/对象添加某些功能，而注释是内联文档。

可以使用属性来简化元数据的添加（例如，使用 Author(string name) 属性来表示类的作者等），从而简化元数据的提取，但否则我看不到比较。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-20T08:14:42.087

[属性](http://msdn.microsoft.com/en-us/library/xtwkdas5(VS.71).aspx)可以在运行时访问，这不是注释的情况。

事实上，属性和评论是两个完全不同的东西，服务于两个完全不同的目的。

注释旨在为阅读您的代码的程序员提供提示，而属性旨在为编译器/运行时“阅读”您的代码提供提示..

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-20T08:15:41.990

通常，当您计划以某种方式以编程方式处理源代码（通常使用 .NET 反射）时，通常会使用属性。要对 XML 注释执行相同操作，您必须对注释格式有一个特殊约定并自己解析源文件，并且在编译时无法像属性一样轻松检查该约定。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-20T08:18:45.027

自定义属性旨在使用反射在运行时访问。它们可以应用于方法参数以及泛型类型参数、方法返回类型、程序集、类型声明、类型成员和模块。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-20T08:20:18.627

一般来说，您无法比较 XML 注释的属性。后者最终与代码完全无关，而属性保留在元数据部分的编译程序集中。

至于你问题的第二部分，这确实是可能的：

```
[return:MySecondAttribute] void Foo([MyAttribute] int bar) 
```

这里 a`MySecondAttribute`应用于返回值，并`MyAttribute`应用于参数`bar`。替换`return:`为`assembly:`在程序集级别应用属性。

# c# - XDocument.Save() 没有标题

> ID：767343
> 
> 赞同：20
> 
> 时间：2009-04-20T08:11:05.420
> 
> 标签：c#, xml, linq-to-sql

我正在使用 Linq-to-XML 编辑 csproj 文件，并且需要保存没有`<?XML?>`标头的 XML。

由于`XDocument.Save()`缺少必要的选项，最好的方法是什么？

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2009-04-20T08:17:03.063

您可以使用 来执行此操作`XmlWriterSettings`，并将文档保存到`XmlWriter`：

```
XDocument doc = new XDocument(new XElement("foo",
    new XAttribute("hello","world")));

XmlWriterSettings settings = new XmlWriterSettings();
settings.OmitXmlDeclaration = true;
StringWriter sw = new StringWriter();
using (XmlWriter xw = XmlWriter.Create(sw, settings))
// or to write to a file...
//using (XmlWriter xw = XmlWriter.Create(filePath, settings))
{
    doc.Save(xw);
}
string s = sw.ToString(); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2021-03-17T14:23:06.153

比公认的答案更简单的解决方案是使用[XDocument.ToString()](https://docs.microsoft.com/en-us/dotnet/api/system.xml.linq.xnode.tostring?view=net-5.0)来获取没有标题的 XML 文本。

例子：

```
// Load the file
XDocument xDocument = XDocument.Load(fileName);

// Edit the XML...

// Save the edited XML text to file
File.WriteAllText(fileName, xDocument.ToString()); 
```

# .net - FitNesse RowFixture：包含、startsWith、endsWith

> ID：767345
> 
> 赞同：2
> 
> 时间：2009-04-20T08:11:45.417
> 
> 标签：.net, fitnesse

是否可以在 FitNesse for .net 的 RowFixture 中表达这一点：

```
contains(data)
startswith(data)
endswith(data) 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-20T08:29:58.230

快速浏览后，我找到了自己问题的答案：

您可以添加单元处理程序以将特定行为添加到您的测试

```
!|cell handler loader|
|load|SubstringHandler|
|load|StartsWithHandler|
|load|EndsWithHandler| 
```

然后你可以做一个这样的测试：

```
!|My fixture|
|Content|
|..contained..|
|starts with..|
|..ends with| 
```

# sql - 广告系统的Sql优化

> ID：767352
> 
> 赞同：0
> 
> 时间：2009-04-20T08:14:00.327
> 
> 标签：sql, optimization

我目前正在开发一个广告系统，它已经运行了一段时间，除了最近我们每天的浏览量从大约 7k 飙升到 328k 之外。我们的服务器不能再承受这方面的压力了——并且知道我不是最好的 SQL 人（嘿，我可以让它工作，但并不总是以最好的方式）我在这里要求一些优化指南。我希望你们中的一些人能够就如何改进这一点给出粗略的想法 - 我并不特别需要代码，只是为了看到光明:)。

就目前而言，当应该显示一个广告时，会调用一个 PHP 脚本，该脚本反过来会调用一个存储过程。这个存储过程进行了几项检查，它针对我们的客户数据库进行测试，以查看显示广告的人（由主键 id 给出）是否是给定语言环境下的实际客户（我们的系统运行在几种语言上，这些语言都运行作为单独的站点）。接下来是提取的所有广告详细信息（作为 url 的图像位置、广告的高度和宽度）- 以免 step 调用单独的存储过程来测试是否允许显示广告（活动是否在任一日期到期或允许显示的广告数量？）以及客户是否可以访问它（我们运行了 2 个访问系统，一个黑名单和一个白名单），最后我们正在运行什么类型的活动，

该代码由我将在此处发布的几个存储过程组成。

--- 从 PHP 调用的程序

```
CREATE PROCEDURE [dbo].[ExecView]

    (
    @publisherId bigint,
    @advertId bigint,
    @localeId int,
    @ip varchar(15),
    @ipIsUnique bit,
    @success bit OUTPUT,
    @campaignId bigint OUTPUT,
    @advert varchar(500) OUTPUT,
    @advertWidth int OUTPUT,
    @advertHeight int OUTPUT
    )

AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @unique bit
    DECLARE @approved bit
    DECLARE @publisherEarning money
    DECLARE @advertiserCost money
    DECLARE @originalStatus smallint
    DECLARE @advertUrl varchar(500)
    DECLARE @return int

    SELECT @success = 1, @advert = NULL, @advertHeight = NULL, @advertWidth = NULL

    --- Must be valid publisher, ie exist and actually be a publisher
    IF dbo.IsValidPublisher(@publisherId, @localeId) = 0
        BEGIN
            SELECT @success = 0
            RETURN 0
        END

    --- Must be a valid advert
    EXEC @return = FetchAdvertDetails @advertId, @localeId, @advert OUTPUT, @advertUrl OUTPUT, @advertWidth OUTPUT, @advertHeight OUTPUT

    IF @return = 0
        BEGIN
            SELECT @success = 0
            RETURN 0
        END 

    EXEC CanAddStatToAdvert 2, @advertId, @publisherId, @ip, @ipIsUnique, @success OUTPUT, @unique OUTPUT, @approved OUTPUT, @publisherEarning OUTPUT, @advertiserCost OUTPUT, @originalStatus OUTPUT, @campaignId OUTPUT

    IF @success = 1
        BEGIN   
            INSERT INTO dbo.Stat (AdvertId, [Date], Ip, [Type], PublisherEarning, AdvertiserCost, [Unique], Approved, PublisherCustomerId, OriginalStatus)
            VALUES (@advertId, GETDATE(), @ip, 2, @publisherEarning, @advertiserCost, @unique, @approved, @publisherId, @originalStatus)
        END

END 
```

--- IsValidPublisher

```
CREATE FUNCTION [dbo].[IsValidPublisher] 
(
    @publisherId bigint,
    @localeId int
)
RETURNS bit
AS
BEGIN
    DECLARE @customerType smallint
    DECLARE @result bit

    SET @customerType = (SELECT [Type] FROM dbo.Customer
    WHERE CustomerId = @publisherId AND Deleted = 0 AND IsApproved = 1 AND IsBlocked = 0 AND LocaleId = @localeId)

    IF @customerType = 2
        SET @result = 1
    ELSE
        SET @result = 0

    RETURN @result  
END 
```

-- 获取广告详情

```
CREATE PROCEDURE [dbo].[FetchAdvertDetails] 
    (
        @advertId bigint,
        @localeId int,
        @advert varchar(500) OUTPUT,
        @advertUrl varchar(500) OUTPUT,
        @advertWidth int OUTPUT,
        @advertHeight int OUTPUT
    )
AS
BEGIN
    -- SET NOCOUNT ON added to prevent extra result sets from
    -- interfering with SELECT statements.
    SET NOCOUNT ON;

    SELECT @advert = T1.Advert, @advertUrl = T1.TargetUrl, @advertWidth = T1.Width, @advertHeight = T1.Height FROM Advert as T1
    INNER JOIN Campaign AS T2 ON T1.CampaignId = T2.Id
    WHERE T1.Id = @advertId AND T2.LocaleId = @localeId AND T2.Deleted = 0 AND T2.[Status] <> 1

    IF @advert IS NULL
        RETURN 0
    ELSE
        RETURN 1
END 
```

--- CanAddStatToAdvert

```
CREATE PROCEDURE [dbo].[CanAddStatToAdvert] 
    @type smallint, --- Type of stat to add
    @advertId bigint,
    @publisherId bigint,
    @ip varchar(15),
    @ipIsUnique bit,
    @success bit OUTPUT,
    @unique bit OUTPUT,
    @approved bit OUTPUT,
    @publisherEarning money OUTPUT,
    @advertiserCost money OUTPUT,
    @originalStatus smallint OUTPUT,
    @campaignId bigint OUTPUT
AS
BEGIN
    SET NOCOUNT ON;
    DECLARE @campaignLimit int
    DECLARE @campaignStatus smallint
    DECLARE @advertsLeft int
    DECLARE @campaignType smallint
    DECLARE @campaignModeration smallint
    DECLARE @count int

    SELECT @originalStatus = 0
    SELECT @success = 1
    SELECT @approved = 1
    SELECT @unique = 1

    SELECT @campaignId = CampaignId FROM dbo.Advert
    WHERE Id = @advertId

    IF @campaignId IS NULL
        BEGIN
            SELECT @success = 0
            RETURN
        END

    SELECT @campaignLimit = Limit, @campaignStatus = [Status], @campaignType = [Type], @publisherEarning = PublisherEarning, @advertiserCost = AdvertiserCost, @campaignModeration = ModerationType FROM dbo.Campaign
    WHERE Id = @campaignId

    IF (@type <> 0 AND @type <> 2 AND @type <> @campaignType) OR ((@campaignType = 0 OR @campaignType = 2) AND (@type = 1)) -- if not a click or view type, then type must match the campaign (ie, only able to do leads on lead campaigns, no isales or etc), click and view campaigns however can do leads too
        BEGIN
            SELECT @success = 0
            RETURN
        END

    -- Take advantage of the fact that the variable only gets touched if there is a record,
    -- which is supposed to override the existing one, if there is one
    SELECT @publisherEarning = Earning FROM dbo.MapCampaignPublisherEarning
    WHERE CanpaignId = @campaignId AND PublisherId = @publisherId

    IF @campaignStatus = 1
        BEGIN
            SELECT @success = 0
            RETURN
        END

    IF NOT @campaignLimit IS NULL
        BEGIN
            SELECT @advertsLeft = AdvertsLeft FROM dbo.Campaign WHERE Id = @campaignId
            IF @advertsLeft < 1
                BEGIN
                    SELECT @success = 0
                    RETURN
                END
        END

    IF @campaignModeration = 0 -- blacklist
        BEGIN
            SELECT @count = COUNT([Status]) FROM dbo.MapCampaignModeration WHERE CampaignId = @campaignId AND PublisherId = @publisherId AND [Status] = 3
            IF @count > 0
                BEGIN
                    SELECT @success = 0
                    RETURN
                END
        END
    ELSE -- whitelist
        BEGIN
            SELECT @count = COUNT([Status]) FROM dbo.MapCampaignModeration WHERE CampaignId = @campaignId AND PublisherId = @publisherId AND [Status] = 2
            IF @count < 1
                BEGIN
                    SELECT @success = 0
                    RETURN
                END
        END

    IF @ipIsUnique = 1
        BEGIN
            SELECT @unique = 1
        END
    ELSE
        BEGIN
            IF (SELECT COUNT(T1.Id) FROM dbo.Stat AS T1
                            INNER JOIN dbo.IQ_Advert AS T2
                            ON T1.AdvertId = T2.Id
                            WHERE T2.CampaignId = @campaignId
                            AND T1.[Type] = @type
                            AND T1.[Unique] = 1
                            AND T1.PublisherCustomerId = @publisherId
                            AND T1.Ip = @ip
                            AND DATEADD(SECOND, 86400, T1.[Date]) > GETDATE()
              ) = 0 
                SELECT @unique = 1
             ELSE
             BEGIN
                SELECT @unique = 0, @originalStatus = 1 -- not unique, and set status to be ip conflict
             END

        END

    IF @unique = 0 AND @type <> 0 AND @type <> 2
    BEGIN
        SELECT @unique = 1, @approved = 0
    END

    IF @originalStatus = 0
        SELECT @originalStatus = 5

    IF @approved = 0 OR @type <> @campaignType
    BEGIN
        SELECT @publisherEarning = 0, @advertiserCost = 0
    END

END 
```

我认为这需要的不仅仅是几个索引来帮助它，而是完全重新思考如何处理它。我听说将其作为批处理运行会有所帮助，但我不确定如何实现它，并且真的不确定我是否可以通过在实际插入之前保留所有这些好的检查的方式来实现它，或者如果我不得不放弃其中的一些。

无论如何，所有帮助将不胜感激，如果您需要任何表格布局，请告诉我:)。

感谢您花时间看它:)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-20T08:18:33.013

确保引用具有所有权前缀的表。所以而不是：

```
INNER JOIN Campaign AS T2 ON T1.CampaignId = T2.Id 
```

采用

```
INNER JOIN dbo.Campaign AS T2 ON T1.CampaignId = T2.Id 
```

这将允许数据库缓存执行计划。

Another possibility is to disable database locking, which has data integrity risks, but can significantly increase performance:

```
INNER JOIN dbo.Campaign AS T2 (nolock) ON T1.CampaignId = T2.Id 
```

Run a sample query in SQL Analyzer with "Show Execution Plan" turned on. This might give you a hint as to the slowest part of the query.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-20T14:14:09.743

it seems like FetchAdvertDetails hit the same tables as the start of CanAddStatToAdvert (Advert and Campaign). If possible, I'd try to eliminate FetchAdvertDetails and roll its logic into CanAddStatToAdvert, so you don't have the hit Advert and Campaign the extra times.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-08-14T14:33:07.523

Get rid of most of the SQL.

> This stored procedure does several checks, it tests up against our customer database to see if the person showing the advert (given by a primary key id) is an actual customer under the given locale (our system is running on several languages which are all run as separate sites). Next up is all the advert details fetched out (image location as an url, height and width of the advert) - and lest step calls a separate stored procedure to test if the advert is allowed to be shown (is the campaign expired by either date or number of adverts allowed to show?) and if the customer has access to it (we got 2 access systems running, a blacklist and a whitelist one) and lastly what type of campaign we're running, is the view unique and so forth.

Most of this should not be done in the database for every request. In particular:

*   Customer and local can be stored in memory. Expire them after 5 minutes or so, but do not ask for this info on every repetitive request.
*   Advert details can also be stored. Every advert will have a "key" to identify it (Number)?. Ust a dictionary / hashtable in memory.

Eliminate as many SQL Parts as you can. Dumping repetitive work on the SQL Database is a typical mistake.

# java - String.equals 与 ==

> ID：767372
> 
> 赞同：560
> 
> 时间：2009-04-20T08:22:45.967
> 
> 标签：java, string

这段代码将一个字符串分成标记并将它们存储在一个字符串数组中，然后将一个变量与第一个 home 进行比较......为什么它不起作用？

```
public static void main(String...aArguments) throws IOException {

    String usuario = "Jorman";
    String password = "14988611";

    String strDatos = "Jorman 14988611";
    StringTokenizer tokens = new StringTokenizer(strDatos, " ");
    int nDatos = tokens.countTokens();
    String[] datos = new String[nDatos];
    int i = 0;

    while (tokens.hasMoreTokens()) {
        String str = tokens.nextToken();
        datos[i] = str;
        i++;
    }

    //System.out.println (usuario);

    if ((datos[0] == usuario)) {
        System.out.println("WORKING");
    }
} 
```

* * *

## 回答 #1

> 赞同：590
> 
> 时间：2009-04-20T08:25:16.213

使用[`string.equals(Object other)`](http://docs.oracle.com/javase/8/docs/api/java/lang/String.html#equals-java.lang.Object-)函数来比较字符串，而不是`==`运算符。

该函数检查字符串的实际内容，`==`运算符检查对对象的引用是否相等。请注意，字符串常量通常是“内部”的，因此具有相同值的两个常量实际上可以与 进行比较`==`，但最好不要依赖它。

```
if (usuario.equals(datos[0])) {
    ...
} 
```

注意：比较是在 'usuario' 上完成的，因为这在您的代码中保证为非空，尽管您仍应检查数组中是否确实有一些标记，`datos`否则您将获得数组越界异常.

* * *

## 回答 #2

> 赞同：575
> 
> 时间：2013-04-24T14:18:19.123

## 认识乔曼

Jorman 是一位成功的商人，拥有 2 座房子。

![在此处输入图像描述](https://i.stack.imgur.com/xLcfG.png)

但其他人不知道这一点。

## 是同一个乔曼吗？

当你问麦迪逊街或伯克街的邻居时，他们只能这样说：

![在此处输入图像描述](https://i.stack.imgur.com/ZjMlG.png)

单独使用住宅，很难确认它是同一个Jorman。由于它们是 2 个不同的地址，因此很自然地假设它们是 2 个不同的人。

**这就是操作员的`==`行为方式。**所以它会说这`datos[0]==usuario`是错误的，因为它只*比较地址*。

## 救援调查员

如果我们派了调查员怎么办？我们知道这是同一个 Jorman，但我们需要证明它。我们的侦探会仔细检查身体的所有方面。通过彻底询问，代理人将能够断定它是否是同一个人。让我们看看它以 Java 术语发生。

下面是 String 方法的源代码`equals()`：

![在此处输入图像描述](https://i.stack.imgur.com/6MYZy.png)

它逐个字符地比较字符串，以得出它们确实相等的结论。

**这就是 String`equals`方法的行为方式。**所以`datos[0].equals(usuario)`会返回 true，因为它执行了一个*逻辑比较*。

* * *

## 回答 #3

> 赞同：99
> 
> 时间：2009-04-20T10:12:19.760

值得注意的是，**在某些情况下，使用“==”运算符可能会产生预期的结果，因为 java 处理字符串的方式**- 字符串文字在编译期间被保留（请参阅） - 因此，当您在两个类中`String.intern()`编写示例时`"hello world"`将这些字符串与“==”进行比较，您可以获得结果：true，这是根据[规范](http://docs.oracle.com/javase/specs/jls/se7/html/jls-3.html#jls-3.10.5)预期的；当您比较相同的字符串（如果它们具有相同的值）时，第一个是字符串文字（即通过 定义`"i am string literal"`），第二个是在运行时构造的，即。使用“new”关键字 like `new String("i am string literal")`，`==`（相等）运算符返回 false，因为它们都是`String`类的不同实例。

**唯一正确的方法是使用`.equals()`-> `datos[0].equals(usuario)`。** `==`仅表示两个对象是相同的对象实例（即具有相同的内存地址）

**更新**：01.04.2013 我更新了这篇文章，因为下面的评论是正确的。最初我声明实习 (String.intern) 是 JVM 优化的副作用。虽然它确实可以节省内存资源（这就是我所说的“优化”），但它主要是语言的特征

* * *

## 回答 #4

> 赞同：37
> 
> 时间：2012-03-11T03:24:27.933

`equals()`function 是`Object`类的方法，程序员应该重写它。`String`类覆盖它以检查两个字符串是否相等，即内容而不是引用。

`==`运算符检查两个对象的引用是否相同。

考虑程序

```
String abc = "Awesome" ;
String xyz =  abc;

if(abc == xyz)
     System.out.println("Refers to same string"); 
```

这里的`abc`and`xyz`都指的是同一个`String` `"Awesome"`。因此表达式`(abc == xyz)`为`true`。

```
String abc = "Hello World";
String xyz = "Hello World";

if(abc == xyz)
    System.out.println("Refers to same string");
else
    System.out.println("Refers to different strings");

if(abc.equals(xyz))
     System.out.prinln("Contents of both strings are same");
else
     System.out.prinln("Contents of strings are different"); 
```

这里`abc`和`xyz`是两个具有相同内容的不同字符串`"Hello World"`。因此，这里的表达式`(abc == xyz)`是`false`where as `(abc.equals(xyz))`is `true`。

`==`希望您了解和之间的区别`<Object>.equals()`

谢谢。

* * *

## 回答 #5

> 赞同：32
> 
> 时间：2013-07-25T05:10:49.113

```
The == operator checks if the two references point to the same object or not.
.equals() checks for the actual string content (value). 
```

注意 .equals() 方法属于 Object 类（所有类的超类）。您需要根据您的类要求覆盖它，但是对于 String 它已经实现并且它检查两个字符串是否具有相同的值。

```
Case1)
String s1 = "Stack Overflow";
String s2 = "Stack Overflow";
s1 == s1;      // true
s1.equals(s2); // true
Reason: String literals created without null are stored in the string pool in the permgen area of the heap. So both s1 and s2 point to the same object in the pool.
Case2)
String s1 = new String("Stack Overflow");
String s2 = new String("Stack Overflow");
s1 == s2;      // false
s1.equals(s2); // true
Reason: If you create a String object using the `new` keyword a separate space is allocated to it on the heap. 
```

* * *

## 回答 #6

> 赞同：26
> 
> 时间：2009-04-20T08:25:29.550

代替

```
datos[0] == usuario 
```

采用

```
datos[0].equals(usuario) 
```

`==`比较变量的引用，`.equals()`比较你想要的值。

* * *

## 回答 #7

> 赞同：26
> 
> 时间：2013-01-04T05:36:41.897

`==`测试参考相等。

`.equals()`测试值相等。

因此，如果您真的想测试两个字符串是否具有相同的值，您应该使用`.equals()`（除了在少数情况下，您可以保证具有相同值的两个字符串将由相同的对象表示，例如：`String`interning）。

`==`用于测试两个字符串是否相同`Object`。

```
// These two have the same value
new String("test").equals("test") ==> true 

// ... but they are not the same object
new String("test") == "test" ==> false 

// ... neither are these
new String("test") == new String("test") ==> false 

// ... but these are because literals are interned by 
// the compiler and thus refer to the same object
"test" == "test" ==> true 

// concatenation of string literals happens at compile time resulting in same objects
"test" == "te" + "st"  ==> true

// but .substring() is invoked at runtime, generating distinct objects
"test" == "!test".substring(1) ==> false 
```

重要的是要注意它`==`比`equals()`（单个指针比较而不是循环）便宜得多，因此，在它适用的情况下（即您可以保证您只处理内部字符串）它可以带来重要的性能改进. 但是，这些情况很少见。

* * *

## 回答 #8

> 赞同：12
> 
> 时间：2012-03-12T05:17:31.130

下面我们来分析一下Java，来了解Strings的标识和相等性：

```
public static void testEquality(){
    String str1 = "Hello world.";
    String str2 = "Hello world.";

    if (str1 == str2)
        System.out.print("str1 == str2\n");
    else
        System.out.print("str1 != str2\n");

    if(str1.equals(str2))
        System.out.print("str1 equals to str2\n");
    else
        System.out.print("str1 doesn't equal to str2\n");

    String str3 = new String("Hello world.");
    String str4 = new String("Hello world.");

    if (str3 == str4)
        System.out.print("str3 == str4\n");
    else
        System.out.print("str3 != str4\n");

    if(str3.equals(str4))
        System.out.print("str3 equals to str4\n");
    else
        System.out.print("str3 doesn't equal to str4\n");
} 
```

当第一行代码`String str1 = "Hello world."`执行时，`\Hello world."` 会创建一个字符串，变量`str1`引用它。`"Hello world."`由于优化，下一行代码执行时不会再创建另一个字符串。该变量`str2`还指现有的`""Hello world."`.

操作员`==`检查两个对象的身份（两个变量是否引用同一个对象）。由于`str1`和`str2`引用内存中的相同字符串，因此它们彼此相同。该方法`equals`检查两个对象的相等性（两个对象是否具有相同的内容）。当然，和的内容`str1`是`str2`一样的。

当代码`String str3 = new String("Hello world.")`执行时，会创建一个包含内容的新字符串实例，`"Hello world."`并由变量 引用`str3`。然后再次创建另一个带有内容的字符串实例，`"Hello world."`并由 `str4`. 由于`str3`and`str4`指的是两个不同的实例，它们并不相同，但它们的内容是相同的。

因此，输出包含四行：

```
Str1 == str2

Str1 equals str2

Str3! = str4

Str3 equals str4 
```

* * *

## 回答 #9

> 赞同：11
> 
> 时间：2009-04-20T08:26:43.680

您应该使用[string equals](http://docs.oracle.com/javase/7/docs/api/java/lang/String.html#equals(java.lang.Object))来比较两个字符串是否相等，而不是 operator == 只是比较引用。

* * *

## 回答 #10

> 赞同：11
> 
> 时间：2010-02-06T07:07:17.503

如果您`intern()`在将字符串插入数组之前调用它，它也将起作用。`==`当且仅当它们是值相等 ( `equals()`.)时，内部字符串是引用相等 ( )

```
public static void main (String... aArguments) throws IOException {

String usuario = "Jorman";
String password = "14988611";

String strDatos="Jorman 14988611";
StringTokenizer tokens=new StringTokenizer(strDatos, " ");
int nDatos=tokens.countTokens();
String[] datos=new String[nDatos];
int i=0;

while(tokens.hasMoreTokens()) {
    String str=tokens.nextToken();
    datos[i]= str.intern();            
    i++;
}

//System.out.println (usuario);

if(datos[0]==usuario) {  
     System.out.println ("WORKING");    
} 
```

* * *

## 回答 #11

> 赞同：8
> 
> 时间：2012-05-16T13:36:50.803

`==`运算符比较 Java 中对象的引用。您可以使用字符串的`equals`方法。

```
String s = "Test";
if(s.equals("Test"))
{
    System.out.println("Equal");
} 
```

* * *

## 回答 #12

> 赞同：8
> 
> 时间：2012-09-07T11:30:41.760

如果要比较字符串的任何分配值，即原始字符串，“==”和.equals 都可以，但是对于新的字符串对象，您应该只使用.equals，而这里“==”将不起作用。

例子：

```
String a = "name";

String b = "name"; 
```

`if(a == b)` 并将`(a.equals(b))`返回 true。

但

```
String a = new String("a"); 
```

在这种情况下`if(a == b)`会返回`false`

所以最好使用`.equals`运算符...

* * *

## 回答 #13

> 赞同：8
> 
> 时间：2012-12-03T11:43:17.750

通常`.equals`用于`Object`比较，您想验证两个`Objects`是否具有相同的值。

`==`用于参考比较（堆上的两者`Objects`是否相同`Object`）并检查是否`Object`为空。它还用于比较原始类型的值。

* * *

## 回答 #14

> 赞同：6
> 
> 时间：2012-12-06T09:59:20.440

== 运算符是值的简单比较。
对于对象引用，（值）是（引用）。因此，如果 x 和 y 引用同一个对象，则 x == y 返回 true。

* * *

## 回答 #15

> 赞同：6
> 
> 时间：2012-12-10T12:15:44.277

@Melkhiah66 您可以使用 equals 方法而不是 '==' 方法来检查相等性。如果你使用 intern() 那么它会检查对象是否在池中，如果存在则返回相等，否则返回不相等。equals 方法在内部使用哈希码并为您提供所需的结果。

 `````
public class Demo
{
  public static void main(String[] args)
  {
              String str1 = "Jorman 14988611";
    String str2 = new StringBuffer("Jorman").append(" 14988611").toString();
    String str3 = str2.intern();
    System.out.println("str1 == str2 " + (str1 == str2));           //gives false
    System.out.println("str1 == str3 " + (str1 == str3));           //gives true
    System.out.println("str1 equals str2 " + (str1.equals(str2)));  //gives true
    System.out.println("str1 equals str3 " + (str1.equals(str3)));  //gives true
  }
} 
````  `* * *

## 回答 #16

> 赞同：6
> 
> 时间：2012-12-20T06:23:29.253

我知道这是一个老问题，但这是我的看法（我觉得非常有用）：

* * *

**技术说明**

在 Java 中，所有变量要么是**原始类型**，要么是**引用**。

（如果您需要知道什么是引用：“对象变量”只是*指向对象的指针。*因此，使用`Object something = ...`，某些东西实际上是内存中的地址（数字）。）

`==`比较确切的值。所以它比较原始值是否相同，或者引用（地址）是否相同。这就是为什么`==`通常不适用于字符串的原因。字符串是对象，`==`正如其他人指出的那样，对两个字符串变量进行操作只是比较内存中的地址是否相同。`.equals()`调用对象的比较方法，该方法将比较引用指向的实际对象。在字符串的情况下，它比较每个字符以查看它们是否相等。

* * *

**有趣的部分**：

那么为什么`==`有时会为字符串返回 true 呢？请注意，字符串是不可变的。在您的代码中，如果您这样做

```
String foo = "hi";
String bar = "hi"; 
```

由于字符串是不可变的（当您调用`.trim()`或其他操作时，它会生成一个新字符串，而不是修改指向内存中的原始对象），您实际上并不需要两个不同的`String("hi")`对象。如果编译器是智能的，那么字节码将读取到只生成一个`String("hi")`对象。所以如果你这样做

```
if (foo == bar) ... 
```

之后，它们指向同一个对象，并将返回 true。但你很少打算这样做。相反，您要求用户输入，即在内存的不同部分创建新字符串等。

**注意**：如果您执行类似`baz = new String(bar)`编译器的操作，可能仍然会发现它们是相同的。但重点是当编译器看到文字字符串时，它可以轻松优化相同的字符串。

我不知道它在运行时是如何工作的，但我假设 JVM 没有保留“实时字符串”列表并检查是否存在相同的字符串。（例如，如果您读取一行输入两次，并且用户输入相同的输入两次，它不会检查第二个输入字符串是否与第一个相同，并将它们指向相同的内存）。它会节省一些堆内存，但开销如此微不足道，不值得。同样，重点是编译器很容易优化文字字符串。

你有它......对`==`vs的一个坚韧不拔的解释`.equals()`以及为什么它看起来很随机。

* * *

## 回答 #17

> 赞同：4
> 
> 时间：2013-04-29T12:41:43.720

将`.equals()`检查两个字符串是否具有相同的值并返回`boolean`值，因为`==`运算符检查两个字符串是否是同一个对象。

* * *

## 回答 #18

> 赞同：4
> 
> 时间：2013-05-31T00:04:09.600

有人在上面的帖子中说 == 用于 int 和检查空值。它也可用于检查布尔运算和字符类型。

不过要非常小心，并仔细检查您使用的是字符而不是字符串。例如

```
 String strType = "a";
    char charType = 'a'; 
```

对于字符串，您将检查这将是正确的

```
 if(strType.equals("a")
        do something 
```

但

```
 if(charType.equals('a')
        do something else 
```

将是不正确的，您需要执行以下操作

```
 if(charType == 'a')
         do something else 
```

* * *

## 回答 #19

> 赞同：4
> 
> 时间：2013-10-24T09:26:41.463

`a==b`

比较参考，而不是值。with 对象引用的使用`==`通常限于以下内容：

1.  比较以查看参考是否为`null`.

2.  比较两个枚举值。这是有效的，因为每个`enum`常量只有一个对象。

3.  您想知道两个引用是否指向同一个对象

`"a".equals("b")`

比较相等的值。因为此方法是在`Object`派生所有其他类的类中定义的，所以它会自动为每个类定义。但是，除非该类覆盖它，否则它不会对大多数类执行智能比较。对于大多数 Java 核心类，它已经以一种有意义的方式定义。如果它没有为（用户）类定义，它的行为与`==`.

* * *

## 回答 #20

> 赞同：3
> 
> 时间：2012-10-22T10:35:49.003

使用拆分而不是分词器，它肯定会为您提供准确的输出，例如：

```
string name="Harry";
string salary="25000";
string namsal="Harry 25000";
string[] s=namsal.split(" ");
for(int i=0;i<s.length;i++)
{
System.out.println(s[i]);
}
if(s[0].equals("Harry"))
{
System.out.println("Task Complete");
} 
```

在这之后，我相信你会得到更好的结果......

# c++ - （C++ 查询）全局访问实例化对象

> ID：767375
> 
> 赞同：0
> 
> 时间：2009-04-20T08:23:52.627
> 
> 标签：c++, global

这是一个基本程序，用于获取两个 5 位数字作为字符串，并利用 '+' 上的运算符重载对 2 个数字使用加法。

```
#include <iostream>
#include <limits>
#include <cstdlib>
#include <cstring>
#include <sstream>

using namespace std;

class IntStr
{
   int InputNum;
   public:
     //IntStr();
     IntStr::IntStr(int num);
     IntStr operator+ (const IntStr &);
     //~IntStr();
     void Display();
};

IntStr::IntStr(int num)
{
  InputNum = num;
}

void IntStr::Display()
{
   cout << "Number is (via Display) : " << InputNum <<endl;
}

IntStr IntStr::operator+ (const IntStr & second) {
        int add_result = InputNum + second.InputNum;
        return IntStr(add_result);
        }

int main()
{
    string str;
    bool option = true;
    bool option2 = true;
    while (option)
    {
    cout << "Enter the number : " ;
    if (!getline(cin, str)) 
    {
       cerr << "Something went seriously wrong...\n";
    }

    istringstream iss(str);
    int i;
    iss >> i;    // Extract an integer value from the stream that wraps str

    if (!iss) 
    {
       // Extraction failed (or a more serious problem like EOF reached)
       cerr << "Enter a number dammit!\n";
    } 
    else if (i < 10000 || i > 99999) 
    {
    cerr << "Out of range!\n";
    } 
    else 
    {
      // Process i
      //cout << "Stream is: " << iss << endl; //For debugging purposesc only
      cout << "Number is : " << i << endl;
      option = false;
      IntStr obj1 = IntStr(i);
      obj1.Display();
    }
    }//while

    while (option2)
    {
    cout << "Enter the second number : " ;
    if (!getline(cin, str)) 
    {
       cerr << "Something went seriously wrong...\n";
    }

    istringstream iss(str);
    int i;
    iss >> i;    // Extract an integer value from the stream that wraps str

    if (!iss)  //------------------------------------------> (i)
    {
       // Extraction failed (or a more serious problem like EOF reached)
       cerr << "Enter a number dammit!\n";
    } 
    else if (i < 10000 || i > 99999) 
    {
    cerr << "Out of range!\n";
    } 
    else 
    {
      // Process i
      //cout << "Stream is: " << iss << endl; //For debugging purposes only
      cout << "Number is : " << i << endl;
      option2 = false;
      IntStr obj2 = IntStr(i);
      obj2.Display();
      //obj1->Display();
    }
    }//while

    //IntStr Result = obj1 + obj2; // --------------------> (ii)
    //Result.Display();

    cin.get();
} 
```

需要澄清上述代码中的 (i) 和 (ii) 点...

(1) (i) 实际上做了什么？

(2) (ii) -> 不编译.. 出现错误“obj1 未声明（首先使用此函数）”。这是因为 obj1 和 obj2 仅在 while 循环内声明吗？我如何在全球范围内访问它们？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-20T08:36:25.420

1) 来自[http://www.cplusplus.com/reference/iostream/ios/operatornot/](http://www.cplusplus.com/reference/iostream/ios/operatornot/)：

> 布尔运算符！( ) 常量；评估流对象
> 
> 如果在流上设置了任一错误标志（failbit 或 badbit），则返回 true。否则返回false。

来自[http://www.cplusplus.com/reference/iostream/ios/fail/](http://www.cplusplus.com/reference/iostream/ios/fail/)：

> 当错误与操作本身的内部逻辑有关时，通常由输入操作设置failbit，而当错误涉及流的完整性丢失时，通常会设置badbit，即使不同的操作也可能持续存在在流上执行。

2）这两个对象不在范围内，它们只存在于前面的括号中。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-20T08:31:57.600

```
if (!iss) 
```

测试流是否处于错误状态，如果转换失败或您处于流的末尾，就会出现这种情况

obj1 在这里定义：

```
else 
    {
      // Process i
      //cout << "Stream is: " << iss << endl; //For debugging purposesc only
      cout << "Number is : " << i << endl;
      option = false;
      IntStr obj1 = IntStr(i);
      obj1.Display();
    } 
```

因此它是 else-block 的本地，并且不能在它之外访问。如果你想增加它的范围，修改它在块之外的定义。然而，将它移到所有块之外（即使其成为全局）并不是一个好主意。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-20T08:34:30.183

1.  调用在布尔上下文中评估流的重载运算符。这将检查流的状态以查看先前的操作是否失败 - 如果是这样，您不能依赖整数变量中的值`i`是有效的，因为流上的输入不是整数。

2.  变量`obj1`和`obj2`在 while 循环的范围内定义 - 它们在范围之外不可用。您可以在 while 范围之外声明它们，在这种情况下，变量将保存它在 while 循环中保存的最后一个值。

# python - pyunit 的漂亮 html 报告

> ID：767377
> 
> 赞同：9
> 
> 时间：2009-04-20T08:24:39.380
> 
> 标签：python, html, python-unittest

你知道为 pyunit 创建漂亮的 html 报告的工具吗？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-20T08:44:49.347

我建议如下：

1.  [使用鼻子](http://somethingaboutorange.com/mrl/projects/nose/)运行测试
2.  创建一个以 HTML 格式输出结果的鼻子插件。鼻子示例代码有一个简单的 HTML 输出插件（[https://raw.github.com/nose-devs/nose/master/examples/html_plugin/htmlplug.py](https://raw.github.com/nose-devs/nose/master/examples/html_plugin/htmlplug.py)）。您可能可以使用它，至少作为一个起点。

鼻子插件文档： http: [//nose.readthedocs.org/en/latest/index.html](http://nose.readthedocs.org/en/latest/index.html)

另外一个选项：

*   Nose 可以将测试结果输出为 NUnit 兼容的 XML: `nosetests --with-xunit`. 这将`nostests.xml`在当前目录中生成一个文件。
*   有一些解决方案可以将此 XML 转换为 HTML：
    *   例如，Hudson/Jenkins 在浏览器中将 XML 测试结果显示为 HTML。
    *   [如何将 NUnit 输出转换为 HTML 报告](https://stackoverflow.com/questions/2996219/how-to-convert-nunit-output-into-an-html-report)
    *   [http://www.google.com/search?&q=nunit+xml+to+html](http://www.google.com/search?&q=nunit+xml+to+html)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-02-22T14:54:18.577

有一个为 pyunit 开发的简单 HTMLTestRunner，这里是[链接](http://tungwaiyip.info/software/HTMLTestRunner.html)

它的不足之处是控制台没有输出，因为 sys.stdout 和 sys.stderr 被 HTMLTestRunner 捕获。除了上述之外，其他人对我来说都很好。

# iphone - iPhone 无法使用 UDP recvfrom 接收数据

> ID：767380
> 
> 赞同：0
> 
> 时间：2009-04-20T08:25:27.273
> 
> 标签：iphone, cocoa, cocoa-touch, macos

我正在编写一个不断发送和接收数据的应用程序。我的初始发送/接收运行成功，但是当我期望 recvfrom 中的数据大小为 512 字节时，我得到它的返回值为 -1，即“资源暂时不可用”。并且 errno 设置为 EAGAIN。如果我使用阻塞调用，即没有超时，应用程序只会挂在 recvfrom 中。iPhone上的recvfrom有最大限制吗？下面是从服务器接收数据的函数。我无法弄清楚可能出了什么问题。

```
{   struct timeval tv;

tv.tv_sec = 3;
tv.tv_usec = 100000;

    setsockopt (mSock, SOL_SOCKET, SO_RCVTIMEO, (char   *)&tv, sizeof tv);

    NSLog(@"Receiving.. sock:%d",mSock);

    recvBuff = (unsigned char *)malloc(1024);
    if(recvBuff == NULL)
        NSLog(@"Cannot allocate memory to recvBuff");

    fromlen = sizeof(struct sockaddr_in);
    n = recvfrom(mSock,recvBuff,1024,0,(struct sockaddr *)&from, &fromlen);

    if (n == -1) {
        [self error:@"Recv From"];
        return;
    }
    else
    {
        NSLog(@"Recv Addr: %s Recv Port: %d",inet_ntoa(from.sin_addr), ntohs(from.sin_port));
        strIPAddr = [[NSString alloc] initWithFormat:@"%s",inet_ntoa(from.sin_addr)];
        portNumber = ntohs(from.sin_port);
        lIPAddr = [KDefine StrIpToLong:strIPAddr];
        write(1,recvBuff,n);
        bcopy(recvBuff, data, n);
        actualRecvBytes = n;
        free(recvBuff);
    } 
```

}

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-20T10:46:39.680

阅读[手册页](http://developer.apple.com/documentation/Darwin/Reference/ManPages/man2/recvfrom.2.html)：

> 如果套接字上没有可用的消息，则接收调用等待消息到达，除非套接字是非阻塞的（请参阅[fcntl(2)](http://developer.apple.com/documentation/Darwin/Reference/ManPages/man2/fcntl.2.html)），在这种情况下返回值 -1 并将外部变量`errno`设置为`EAGAIN`。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-11-27T07:28:59.750

我正在编写一个 UDP 应用程序，并认为我遇到了类似的问题。Peter Hosey 的说法是正确的，即给定的结果`recvfrom`意味着没有要读取的数据；但你想知道，怎么可能没有数据？

如果您一次从某个主机向您的 iphone 发送多个 UDP 数据报，则其中一些数据报可能会被丢弃，因为（在 iphone 上）接收缓冲区大小不足以一次容纳那么多数据。

解决问题的可靠方法是实现一个功能，允许您的应用程序请求重新传输丢失的数据报。一个不那么健壮的解决方案（不能解决健壮解决方案所做的所有问题）是简单地使用[`setsockopt(2)`](http://developer.apple.com/mac/library/documentation/Darwin/Reference/ManPages/man2/setsockopt.2.html).

缓冲区大小调整可以如下进行：

```
int rcvbuf_size = 128 * 1024; // That's 128Kb of buffer space.
if (setsockopt(sockfd, SOL_SOCKET, SO_RCVBUF, 
        &rcvbuf_size, sizeof(rcvbuf_size)) == -1) {
    // put your error handling here...
} 
```

您可能需要调整缓冲区大小才能找到最适合您的应用程序的内容。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2018-09-25T17:30:11.830

对我来说，这是一个选角问题。本质上 a 是将返回的值分配给 int 而不是 size_t

```
int rtn = recvfrom(sockfd,... // wrong 
```

代替：

```
size_t rtn = recvfrom(sockfd,...// correct 
```

# ajax - 您如何模仿将数据推送到 Web 应用程序？

> ID：767382
> 
> 赞同：1
> 
> 时间：2009-04-20T08:26:33.667
> 
> 标签：ajax, language-agnostic, http, web-applications, networking

显然，您不能将数据推送到 Web 应用程序，因为 HTTP 在*请求-响应*周期中工作。

但是您知道哪些黑客/方法可以模仿将数据推送到客户端？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-20T08:28:29.323

您可以使用所谓的 Comet： [http://en.wikipedia.org/wiki/Comet_(programming)](http://en.wikipedia.org/wiki/Comet_(programming))、[https ://stackoverflow.com/search?q=comet](https://stackoverflow.com/search?q=comet)

基本上，浏览器中的 javascript 会立即向服务器发出请求（使用 XmlHttpRequest）。服务器在它有一些数据要服务之前不会响应。

来自文章：

浏览器向服务器发出异步请求，服务器可能会在响应之前等待数据可用。响应可以包含要由客户端执行的编码数据（通常是 XML 或 JSON）或 javascript。在响应处理结束时，浏览器创建并发送另一个 XHR，以等待下一个事件。因此，浏览器总是向服务器保留一个未完成的请求，以便在每个事件发生时得到响应。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-20T08:31:25.963

在某些情况下，*轮询*（即以定期（短）间隔发送请求）可能就足够了。但就在没有客户端请求的情况下发送数据而言，上面给出的答案 - Comets - 是最接近真实交易的事情。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-20T09:10:53.857

您仅限于在 HTTP 中进行轮询。我似乎记得，早在本世纪初，早期的 Netscape 浏览器之一确实实现了[HTTP 推送](http://support.microsoft.com/kb/250983)，但它没有取得任何进展。

*   [HTTP Push 上的好 ol' Wikipedia 页面](http://en.wikipedia.org/wiki/Push_technology#HTTP_server_push)（有很多 [需要澄清]）

您不能将原始套接字与 Flash、Javascript/Xml、Silverlight 一起使用。使用 Java 和 Active-X 可以，但需要证书。Quake Live 展示了这一点，所有网络显然仍然基于 UDP，但在 IE 或 Firefox 的浏览器插件中。

所以轮询，轮询，轮询。

# javascript - Javascript：如何暂时禁用页面上的所有操作？

> ID：767385
> 
> 赞同：9
> 
> 时间：2009-04-20T08:27:53.897
> 
> 标签：javascript, events

在带有 Ajax 事件的页面上，我想禁用所有操作，直到 Ajax 调用返回（以防止重复提交等问题）

我通过在“锁定”页面时预先添加`return false;`当前的 onclick 事件来尝试此操作，并在稍后“解锁”页面时将其删除。但是，这些动作在“解锁”后不再处于活动状态——您只是无法触发它们。

为什么这不起作用？请参阅下面的示例页面。还有其他想法可以实现我的目标吗？

**示例代码：**
链接和按钮都显示 JS 警报；按下锁定时，然后解锁事件处理程序与以前相同，但不起作用...？！？
该代码最终适用于特立尼达，但也应该适用于外部。

```
<html><head><title>Test</title>

<script type="text/javascript">
function lockPage()
{
  document.body.style.cursor = 'wait';
  lockElements(document.getElementsByTagName("a"));
  lockElements(document.getElementsByTagName("input"));

  if (typeof TrPage != "undefined")
  {
    TrPage.getInstance().getRequestQueue().addStateChangeListener(unlockPage);
  }
}

function lockElements(el)
{
  for (var i=0; i<el.length; i++)
  {
    el[i].style.cursor = 'wait';
    if (el[i].onclick)
    {
      var newEvent = 'return false;' + el[i].onclick;
      alert(el[i].onclick + "\n\nlock -->\n\n" + newEvent);
      el[i].onclick = newEvent;
    }
  }
}

function unlockPage(state)
{
  if (typeof TrRequestQueue == "undefined" || state == TrRequestQueue.STATE_READY)
  {
    //alert("unlocking for state: " + state);
    document.body.style.cursor = 'auto';
    unlockElements(document.getElementsByTagName("a"));
    unlockElements(document.getElementsByTagName("input"));
  }
}

function unlockElements(el)
{
  for (var i=0; i<el.length; i++)
  {
    el[i].style.cursor = 'auto';
    if (el[i].onclick && el[i].onclick.search(/^return false;/)==0)
    {
      var newEvent = el[i].onclick.substring(13);
      alert(el[i].onclick + "\n\nunlock -->\n\n" + newEvent);
      el[i].onclick = newEvent;
    }
  }
}
</script>

<style type="text/css">
</style>
</head>

<body>

<h1>Page lock/unlock test</h1>

<p>Use these actions to lock or unlock active elements on the page:
<a href="javascript:lockPage()">lock</a>,
<a href="javascript:unlockPage()">unlock</a>.</p>

<p>And now some elements:</p>

<a onclick="alert('This is the action!');return false;" href="#">link action</a> &nbsp;
<input type="button" value="button action" onclick="alert('This is another action!')"/>
</body>
</html> 
```

* * *

谢谢你们的想法和答案。

现在我看到我混淆了字符串和函数，这显然不能工作;(

我应该明确表示我们使用了一些 Web FW 和标签库（Trinidad）来创建事件处理（和 Ajax）代码，因此我不能直接编辑它或使用同步 Ajax 等。

此外，Ajax 只是应该执行此代码的一种场景。其目的是防止用户重复提交页面/操作，这也与非 Ajax 页面相关，您可以在其中双击按钮。我知道这并不安全，它只是为了避免过于频繁地出现导航错误页面（当然，我们有服务器端保护），这是一种“方便”的东西。

所以，可能会尝试 div 覆盖。

再次感谢，
克里斯托夫。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-04-20T09:12:01.683

设置一个全局变量怎么样

```
actions_disabled = 0 
```

AJAX 调用开始时递增，结束时递减。然后，您所有的“动作”处理程序都可以从

```
if (actions_disabled) return false; 
```

比调试自修改代码简单得多！

或者，要锁定您的控件，您可以设置：

```
control.disabled="disabled" 
```

这将使它们变灰，使用户很明显他们无法提交。要解锁，只需设置：

```
control.disabled="" 
```

基于评论的新想法（不能在评论中引用代码，它似乎......）：

您总是可以将额外的属性挂在 Javascript 对象上：

要锁定，您可以：

```
control.onclick_old = control.onclick
control.onclick = "return false;" 
```

要解锁，您可以：

```
control.onclick = control.onclick_old 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-20T08:54:55.127

我曾经通过创建一个覆盖我想要禁用的区域的 DIV 来实现这个目标，将其设置为`z-index`高于页面上的任何其他元素，然后将其设置`opacity`为`0`. 默认情况下，这个 DIV 被 隐藏`display: none`，所以它不会干扰任何东西。但是，当我想要禁用该区域时，我只是将其设置`display`为`block`.

史蒂夫

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-20T09:32:35.473

阿贾克斯。异步。只需使 HTTP 请求同步即可。问题解决了。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-20T09:40:27.140

您的代码的问题是由于没有掌握 javascript 中的类型。

当你说：

```
var newEvent = 'return false;' + el[i].onclick 
```

它的作用是将 el[i].onclick（它是一个函数）强制转换为字符串，然后将其连接到字符串 'return false;'。然后当你重新分配它时：

```
el[i].onclick = newEvent; 
```

onclick 以前是一个函数，现在是一个字符串。

然后，您尝试通过获取子字符串从字符串中恢复旧函数：

```
var newEvent = el[i].onclick.substring(13); 
```

这很好，除了 newEvent 仍然是一个字符串！因此，当您再次将其分配回 onclick 时，您分配的是原始函数的字符串表示形式，而不是函数本身。

您可以使用 eval 来评估字符串并返回函数，但请不要这样做。正如其他评论者所建议的那样，有许多更好的方法可以做到这一点。

如果您不想允许异步请求，我还会质疑您为什么要使用 AJAX。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2021-03-28T07:39:19.870

将 lockPage() 放在 activete() 函数的顶部，将 unlockPage() 放在 deactivate() 的底部。

```
activate: function() {

    function lockPage()
    {
      lockElements(document.getElementsByTagName("a"));
      lockElements(document.getElementsByTagName("input"));
      lockElements(document.getElementsByTagName("button"));
    };

    function lockElements(el)
    {
      for (var i=0; i<el.length; i++)
      {
        el[i].style.pointerEvents="none";
      }
    };

    lockPage();

    // ...
}, 
```

```
deactivate: function() {

    // ...

    function unlockPage() {
        unlockElements(document.getElementsByTagName("a"));
        unlockElements(document.getElementsByTagName("input"));
        unlockElements(document.getElementsByTagName("button"));
    };

    function unlockElements(el)
    {
      for (var i=0; i<el.length; i++)
      {
        el[i].style.pointerEvents="auto";
      }
    };

    unlockPage();

}, 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-20T10:37:32.853

使用 div 覆盖并不会阻止用户使用 Tab 键进入您的页面。通常这是可以的，因为大多数用户无论如何都不会在页面中使用标签。

如果您在页面上使用任何键盘快捷键，它们仍然可用，因此需要单独处理这些快捷键。

另外，我假设单击可以具有焦点的元素（例如`<a>`标签），然后按 Enter，仍会导致双重提交。

# c++ - C++中的内存泄漏

> ID：767392
> 
> 赞同：6
> 
> 时间：2009-04-20T08:30:06.107
> 
> 标签：c++, memory-management, memory-leaks

我在英特尔 Xscale 设备上运行我的 c++ 应用程序。[问题是，当我使用Valgrind](http://valgrind.org/)运行我的应用程序脱机（Ubuntu）时，它没有显示任何内存泄漏。

但是当我在目标系统上运行它时，它以 50K 的可用内存开始，并在一夜之间减少到 2K。Valgrind 没有显示这种泄漏，如何捕获？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-04-20T08:44:16.680

这些小型嵌入式设备的一个常见罪魁祸首是内存碎片。您的应用程序中可能有 2 个对象之间的可用内存。一个常见的解决方案是对最常见的类使用专用的分配器（C++ 中的新操作符）。纯粹用于大小为 N 的对象的内存池不会碎片化——两个对象之间的空间总是 N 的倍数。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-20T08:37:32.423

这可能不是真正的内存泄漏，但可能是内存使用量增加的情况。例如，它可以分配一个不断增加的字符串：

```
string s;
for (i=0; i<n; i++)
  s += "a"; 
```

50k 不算多，也许您应该手动检查您的来源，看看可能导致问题的原因。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-20T08:35:25.703

这可能不是泄漏，而只是运行时堆没有向操作系统释放内存。这也可能是碎片化。

克服这个问题的可能方法：

1.  分成两个应用程序。主应用程序将具有简单的逻辑，很少或没有动态内存使用。它将启动工作应用程序以实际执行工作块，以使工作应用程序不会耗尽内存，并将定期重新启动该应用程序。这样，内存就会定期返回给操作系统。

2.  编写自己的内存分配器。例如，您可以分配一个专用堆并仅从那里分配内存，然后完全释放专用堆。这需要操作系统支持多个堆。

另请注意，您的程序可能在 Ubuntu 和目标系统上运行不同，因此采用不同的执行路径，导致内存泄漏的代码在目标系统上执行，而不是在 Ubuntu 上执行。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-20T09:29:31.470

这听起来确实像碎片化。碎片是由您在堆栈上分配对象引起的，例如：

对象1
对象2 对象
3 对象
4

然后删除一些对象

对象1

对象
3 对象4

现在，您的内存中有一个未使用的漏洞。如果您分配另一个对孔来说太大的对象，则该孔仍将被浪费。最终，如果有足够的内存流失，您最终可能会出现如此多的漏洞，以至于它们会浪费您的内存。

解决此问题的方法是尝试预先确定您的内存需求。如果您知道自己正在创建许多特定对象，请尝试确保它们的大小相同。

您可以使用池来使特定类的分配更有效......或者至少让您更好地跟踪它，以便您可以了解正在发生的事情并提出一个好的解决方案。

一种方法是创建一个静态：

```
struct Slot
{
    Slot() : free(true) {}
    bool free;
    BYTE data[20];  // you'll need to tune the value 20 to what your program needs
};
Slot pool[500]; // you'll need to pick a good pool size too. 
```

在程序启动时预先创建池并预先分配它，使其与程序的最大要求一样大。您可能希望 HeapAlloc 它（或操作系统中的等效项，以便您可以控制它何时从应用程序启动的某个位置出现）。

然后覆盖可疑类的 new 和 delete 运算符，以便它们从该向量返回槽。因此，您的对象将存储在此向量中。

您可以为要放入此向量中的相同大小的类覆盖 new 和 delete。

为不同的对象创建不同大小的池。

一开始就去找最严重的罪犯。

我以前做过类似的事情，它解决了我在嵌入式设备上的问题。我也使用了很多 STL，所以我创建了一个自定义分配器（google for stl custom allocator - 有很多链接）。这对于存储在我的程序使用的小型数据库中的记录很有用。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-20T08:39:22.417

如果您的内存使用量下降，我认为不能将其定义为内存泄漏。您从哪里获得内存使用报告？系统可能只是将程序的大部分内存使用放在了虚拟内存中。

我能补充的是，众所周知，Valgrind 在查找内存泄漏方面非常有效！

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-20T08:39:52.167

此外，您确定在分析代码时，代码覆盖率足以覆盖所有可能在目标平台上执行的代码路径吗？

Valgrind 肯定不会说谎。正如已经指出的那样，这可能确实是运行时堆没有释放内存，但我不这么认为。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-20T08:40:31.980

您是否使用任何复杂的技术来跟踪对象的范围......？如果是，则 valgrind 不够聪明，尽管您可以尝试使用 valgrind 设置 xscale 相关选项

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-20T08:42:24.953

大多数应用程序显示出这样的内存使用模式：

*   他们开始时使用的很少
*   随着他们创建数据结构，他们越来越多地使用
*   当他们开始删除旧数据结构或重用现有数据结构时，他们会达到内存使用大致保持不变的稳定状态

如果您的应用程序的大小不断增加，则您可能存在漏洞。如果它在一段时间内增加大小然后达到相对稳定的状态，你可能不会。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-04-20T09:33:14.300

您可以使用 Valgrind 的 massif 工具，该工具将向您显示分配最多内存的位置以及它如何随时间演变。

# c# - C# 类和方法

> ID：767393
> 
> 赞同：4
> 
> 时间：2009-04-20T08:30:21.240
> 
> 标签：c#, oop

我发现很难确定类的责任：我必须把这个方法放在这个类中还是应该把这个方法放在另一个类中？例如，想象一个简单的 User 类，其中包含 id、forname、lastname 和密码。现在您有一个 userId 并且您需要 forname 和 lastname，因此您创建了一个类似的方法：public User GetUserById(int id){}。接下来您要显示所有用户的列表，因此您创建另一个方法：public List GetAllUsers(){}。当然，您还想更新、删除和保存用户。这为我们提供了 5 种方法：

```
public bool SaveUser(User user);
public bool UpdateUser(User user);
public bool DeleteUser(User user);
public User GetUserById(int id);
public List<User> GetAllUsers(); 
```

所以我的问题是：你把所有这些方法都放在 User 类中了吗？或者您是否创建了另一个可以连接到数据库并包含所有这些方法的数据类（UserData 类）？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-20T08:36:53.407

您在这里描述的基本上是[Active Record Pattern](http://www.martinfowler.com/eaaCatalog/activeRecord.html)或[Repository Pattern](http://www.martinfowler.com/eaaCatalog/repository.html)之间的选择。我建议您阅读这些模式并选择适合您的应用程序/经验/工具集的模式。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-20T08:33:53.913

我不会将这些特定方法放入“用户”类中。

这个“问题”有两种常见的方法：

*   您将这些方法放在 User 类中，这意味着您正在使用[Active Record](http://en.wikipedia.org/wiki/Active_record_pattern) 模式
*   例如，您将这些方法放在一个单独的类 (UserRepository) 中，然后使用 [存储库](http://www.martinfowler.com/eaaCatalog/repository.html)模式。

我更喜欢存储库方法，因为这样可以保持我的“用户”类干净，并且不会因为数据访问代码而杂乱无章。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-20T08:34:52.367

除非特定于一组用户的额外复杂性（或真正复杂的数据库访问机制），否则我可能会在 User 类上将这些方法设为静态。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-20T08:37:10.693

这些方法对我来说听起来更像`UserManager`（或类似的东西）。用户类应该只对应并代表一个*用户*，而不是很多。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-20T08:46:39.657

如果我们查看企业应用程序设计模式，那么获取用户的方法，即 GetUserByID 和 GetAllUsers 将位于单独的类中 - 您可以将其命名为 UserData 或 UserDAO（DAO - 数据访问对象）。

事实上，您应该为 UserDAO 设计一个接口，使用适当的方法来处理用户对象 - 例如 CreateUser、UpdateUser、DeleterUser、GetUserXXX 等。

根据数据源应该有一个UserDAO的实现，例如如果您的用户存储在数据库中，那么您可以在UserDAO的实现中实现访问数据库的逻辑。

以下是将访问方法保留在单独的类中的优点：

1) 用户对象应该是只有 getter setter 方法的普通对象，这将有助于跨层传递对象 - 从数据访问层到业务层到 Web 层。这也将有助于保持用户对象可序列化

2) 数据访问逻辑与用户对象松散耦合——这意味着如果数据源发生变化，那么您无需更改用户对象本身。这也有助于测试驱动开发，您可能需要在测试阶段使用模拟对象

3）如果User对象是复杂对象，与Address或Department或Role等其他对象有关系，那么关系的复杂性将被封装在UserDAO中，而不是泄漏在User Object中。

4) 如果遵循这些模式，移植到 NHibernate 或 Spring.NET 或 .NET LINQ 等框架会变得更容易

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-20T12:37:03.440

让我们看看你的情况。

你们公司的装配部门有“N”人工作。

去一个人那里询问他的信息是可以的，但你不能指望他告诉你在装配部门工作的所有人员的详细信息。他为什么要记住所有细节的原因，如果你确实期望那么他的效率会下降（组装工作并记住其他人的细节）。

所以.....也许我们可以指定一个经理来做这个 ppl 管理活动（获取详细信息，添加新人，编辑，删除等）

因此，您有两个实体

1) 在您的装配部门工作的用户/人员 2) 经理

这样就分了两个班。希望这会对你有所帮助。

谢谢

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-20T08:33:38.470

在其他所有条件相同的情况下，任何一种方式都可以。但是，选择哪一个通常取决于您在其中找到类的应用程序或类库的整体架构`User`。如果数据访问代码似乎与目标代码纠缠不清`User`，那么按照您的考虑，将其分成两个类可能更有意义。如果 CRUD 方法是对 DAL 的单行委托，可能具有特定于应用程序的逻辑，那么将它们留在 User 类中应该没问题。

在这两种情况下，复杂性或多或少是相同的——它是在具有少量高维护类的低维护组件或具有大量低维护类的高维护组件之间进行权衡。

我还假设 CRUD 方法应该是`static`.

做最简单的事情来立即编写代码，但如果您发现这样会更好，请考虑将来可能的重构。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-20T08:38:31.967

如果我正确理解您的问题，则 User 类处理单个用户。因此，用户类不知道有多少用户或关于他们的任何事情。保存此信息的结构在其他地方，您提到的方法似乎属于该结构/类。

# php - 根据 5 条规则帮助从 PHP 数组中提取数据

> ID：767396
> 
> 赞同：0
> 
> 时间：2009-04-20T08:31:09.130
> 
> 标签：php, arrays, loops

我正在使用图像文件路径数组。一个典型的数组可能存储了 5 个图像文件路径。

对于每个数组，我想只提取“最佳”照片以显示为集合的缩略图。

我发现循环和数组非常混乱，经过 4 小时试图弄清楚如何构建它，我不知所措。

以下是我正在使用的规则：

1.  最好的照片在其文件路径中有“-large”。并非所有阵列中都会有这样的图像，但如果有，那总是我想要提取的照片。

2.  下一个最好的照片是 260 像素宽。我可以用 getimagesize 来查找。如果我找到其中之一，我想停止寻找并使用它。

3.  下一个最好的照片是 265 宽。如果我找到一个我想使用它并停止寻找。

4.  下一个最好的照片是 600 像素宽。同样的交易。

5.  然后是 220px 宽。

我需要 5 个单独的 for 循环吗？5个嵌套for循环

这是我正在尝试的：

```
if $image_array{    
  loop through $image_array looking for "-large"
  if you find it, print it and break;             

  if you didn't find it, loop through $image_array looking for 260px wide.
  if you find it, print it and break;
} 
```

等等....

但这似乎不起作用。

我想根据这些标准“搜索”我的数组以找到最佳的单个图像。如果它找不到第一种类型，那么它会寻找第二种，依此类推。那是怎么做的？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-20T09:49:44.293

```
<?php

// decide if 1 or 2 is better
function selectBestImage($image1, $image2) {
    // fix for strange array_filter behaviour
    if ($image1 === 0)
        return $image2;

    list($path1, $info1) = $image1;
    list($path2, $info2) = $image2;
    $width1 = $info1[0];
    $width2 = $info2[0];

    // ugly if-block :(
    if ($width1 == 260) {
        return $image1;
    } elseif ($width2 == 260) {
        return $image2;
    } elseif ($width1 == 265) {
        return $image1;
    }  elseif ($width2 == 265) {
        return $image2;
    } elseif ($width1 == 600) {
        return $image1;
    }  elseif ($width2 == 600) {
        return $image2;
    } elseif ($width1 == 220) {
        return $image1;
    }  elseif ($width2 == 220) {
        return $image2;
    } else {
        // nothing applied, so both are suboptimal
        // just return one of them
        return $image1;
    }
}

function getBestImage($images) {
    // step 1: is the absolutley best solution present?
    foreach ($images as $key => $image) {
        if (strpos($image, '-large') !== false) {
            // yes! take it and ignore the rest.
            return $image;
        }
    }

    // step 2: no best solution
    // prepare image widths so we don't have to get them more than once
    foreach ($images as $key => $image) {
        $images[$key] = array($image, getImageInfo($image));
    }

    // step 3: filter based on width
    $bestImage = array_reduce($images, 'selectBestImage');

    // the [0] index is because we have an array of 2-index arrays - ($path, $info)
    return $bestImage[0];
}

$images = array('image1.png', 'image-large.png', 'image-foo.png', ...);

$bestImage = getBestImage($images);

?> 
```

这应该有效（我没有测试它），但它不是最理想的。

它是如何工作的？首先，我们寻找绝对最好的结果，在这种情况下，`-large`，因为寻找子字符串是便宜的（相比之下）。

如果我们没有找到`-large`图像，我们必须分析图像宽度（更昂贵！ - 所以我们预先计算它们）。

array_reduce 调用一个过滤函数，该函数接受 2 个数组值并将这两个替换为函数返回的一个（更好的一个）。重复此操作，直到数组中只剩下一个值。

这个解决方案仍然不是最理想的，因为比较（即使它们很便宜）不止一次进行。我的 big-O() 符号技巧有点生疏（哈！），但我认为它是 O(n*logn)。soulmerges 解决方案是更好的解决方案 - O(n) :)

您仍然可以改进 soulmerges 解决方案，因为不需要第二个循环：

首先，将它打包到一个函数中，这样您就可以将 return 作为中断替换。如果第一个 strstr 匹配，则返回该值并忽略其余部分。之后，您不必为每个数组键存储分数。只需与最高密钥变量进行比较，如果新值更高，则存储它。

```
<?php

function getBestImage($images) {
    $highestScore = 0;
    $highestPath  = '';

    foreach ($images as $image) {
        if (strpos($image, '-large') !== false) {
            return $image;
        } else {
            list($width) = getImageInfo($image);

            if ($width == 260 && $highestScore < 5) {
                $highestScore = 5;
                $highestPath  = $image;

            } elseif ($width == 265 && $highestScore < 4) {
                $highestScore = 4;
                $highestPath  = $image;

            } elseif ($width == 600 && $highestScore < 3) {
                $highestScore = 3;
                $highestPath  = $image;

            } elseif ($width == 220 && $highestScore < 2) {
                $highestScore = 2;
                $highestPath  = $image;
            } elseif ($highestScore < 1) {
                // the loser case
                $highestScore = 1;
                $highestPath  = $image;
            }
        }
    }

    return $highestPath;
}

$bestImage = getBestImage($images);

?> 
```

没有测试，应该在 O(n) 中工作。无法想象一种更快、更有效的方式 atm。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-20T10:29:25.400

```
// predefined list of image qualities (higher number = best quality)
// you can add more levels as you see fit
$quality_levels = array(
    260 => 4, 
    265 => 3, 
    600 => 2,
    220 => 1
);

if ($image_arry) {

    $best_image = null;

    // first search for "-large" in filename 
    // because looping through array of strings is faster then getimagesize
    foreach ($image_arry as $filename) {
          if (strpos('-large', $filename) !== false) {
                $best_image = $filename;
                break;
            }
    }

    // only do this loop if -large image doesn't exist
    if ($best_image == null) {
            $best_quality_so_far = 0;

        foreach ($image_arry as $filename) {
            $size = getimagesize($filename);
            $width = $size[0];

                    // translate width into quality level
            $quality = $quality_levels[$width];

            if ($quality > $best_quality_so_far) {
                $best_quality_so_far = $quality;
                $best_image = $filename;
            }
        }
    }

    // we should have best image now
    if ($best == null) {
        echo "no image found";
    } else {
        echo "best image is $best";
    }
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-20T11:27:09.067

另一种方法（微不足道，不太通用，更慢）。只需一一检查规则：

```
function getBestFile($files) {
    foreach ($files as $arrayKey => $file) {
        if (strstr($file, '-large') !== FALSE) {
            return $file;
        }
    }
    foreach ($files as $arrayKey => $file) {
        if (is260wide($file)) {
            return $file;
        }
    }
    // ...
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-20T11:58:06.137

您需要 3 个循环和一个默认选择。

```
loop through $image_array looking for "-large"
if you find it, return it;

if you didn't find it, loop through $image_array
get image width
if prefered width (260px), return it.
if $sizes[$width] not set, add filename

loop a list of prefered sizes in order and see if it is set in $sizes
if you find it, return it;

return the first image or default image; 
```

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-04-20T08:41:25.160

我会根据应用的规则数量为文件分配分数。如果您希望某些规则取代其他规则，您可以为该规则加分。

```
define('RULE_POINTS_LARGE', 10);
define('RULE_POINTS_260_WIDE', 5);
// ...

$points = array();
foreach ($files as $arrayKey => $file) {
    $points[$arrayKey] = 0;
    if (strstr($filename, '-large') !== FALSE) {
        $points[$arrayKey] += RULE_POINTS_LARGE;
    }
    // if ...
}

// find the highest value in the array:
$highestKey = 0;
$highestPoints = 0;
foreach ($points as $arrayKey => $points) {
    if ($files[$arrayKey] > $highestPoints) {
        $highestPoints = $files[$arrayKey];
        $highestKey = $arrayKey;
    }
}

// The best picture is $files[$highestKey] 
```

再附注：给你的规则一个值的倍数将确保一个规则可以比所有其他规则“更强”。示例：5 条规则 -> 规则值（1、2、4、8、16）。

*   1 < 2
*   1 + 2 < 4
*   1 + 2 + 4 < 8
*   等等

# c# - Janus GridEx for ASP.NET Designer 支持

> ID：767398
> 
> 赞同：2
> 
> 时间：2009-04-20T08:31:52.017
> 
> 标签：c#, asp.net, janus, gridex

几天来，我一直在使用 Janus GridEx for Web。恐怕我无法打开 GridEx 设计器（ASP.NET 设计器中的网格上下文菜单），这使得实际工作几乎不可能或至少没有生产力。我收到以下错误消息：

> 调用“GridEX 设计器”时出错。详细信息：调用的目标已引发异常。

不幸的是，此错误消息并没有真正告诉我有关真正错误的任何信息。在 Janus 论坛中，有人遇到了同样的问题。支持人员建议检查版本和本地副本属性，但这不是问题的原因（我的和 Janus 论坛中的人都不是）。

感谢您的任何帮助。

问候马蒂亚斯

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-22T07:31:38.117

本帖原文：

> 我刚刚弄清楚如何打开 GridEx 设计器。Visual Studio 需要以管理员身份运行（Vista 中的“以管理员身份运行”，并确认 UAC 消息）。个人不喜欢这样，但它工作正常。

到目前为止，这是正确的，该消息不再出现。设计器确实打开了，但没有保存任何更改。在 Janussys 论坛中，支持人员以前从未见过这种行为。

目前的问题是不同的（我会说更糟）：设计师没有打开，但开始帖子中提到的消息不再出现。只是什么都没有发生。UAC 仍处于禁用状态，并且 Visual Studio 以管理员身份运行。我完全重新安装了禁用 UAC 的组件。

我知道“不起作用！” 根本没有正确的错误描述，但在这种情况下，我只是不知道更好。

# unit-testing - 我如何将其分解为单元测试？

> ID：767401
> 
> 赞同：2
> 
> 时间：2009-04-20T08:32:18.800
> 
> 标签：unit-testing, refactoring

我有一个在对象上调用的方法来执行一些业务逻辑并将其添加到数据库中。

该对象是一个事务，部分业务逻辑需要在数据库中搜索相关账户和账户上的历史项目。

然后有一系列的比较和操作需要从账户中取回信息并将其应用于交易，然后再将交易传递给其他人并写入数据库。

目前我能想到的唯一测试方法是在测试中创建一个帐户和相关的历史信息，然后为每个不同的场景构建一个事务，并捕获写入数据库的事务信息和传递的信息，但是这感觉就像它在一次测试中的测试方式太多了。每个场景都将在一个单独的单元测试中执行，测试构造被重构为单独的方法，但测试目标的实际代码片段超过 500 行。

我想这个问题更多的是关于重构而不是单元测试，但在这种情况下，它们是齐头并进的。

如果有人有任何建议（好的或坏的），那么我很高兴听到它。

编辑：

伪代码：

```
Find account for transaction 
Do validation on transaction codes and values 
Update transaction with info from account 
Get related history from account Handle different transaction codes and values (6 different combinations, each with different logic) 
Update the transaction again with new account info (resulting from business logic) 
Send transaction to clients 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-20T08:48:12.617

如果您对这个问题有一些伪代码，我将不胜感激，但只要遵循它，我会：

*   **为直接访问数据库的数据访问对象创建接口**——这样您可以传入一个只假装（例如，模拟）它访问数据库的对象。然后，该对象将返回与您的数据库将返回的结果一致的结果，而无需实际执行任何 DB 调用。您的对象还可以模拟场景，例如将数据回滚到其原始状态。
*   **将每个“场景”提取到一个单独的方法**中——这是一个单元的本质。如果您的方法有 500 行长，那么其中必须有可以提取的连续块。如果合适的话，为每一个写一个单元测试。
*   **如果您的单元测试测试太多，那可能意味着您的方法做得太多**- 您可以通过识别您正在测试的不同事物然后将它们放入自己的方法中来提取方法。冲洗并重复，直到您只需要对每种方法进行一次测试。
*   **“传递给其他人”的交易听起来像是一种代码味道**——交易本身应该只是一个连续的单元。如果你需要不同的用户来完成你的交易，你做的太多了；而是根据标志等而不是数据库事务来跟踪数据库上的数据状态。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-20T12:17:12.457

从现有的遗留代码中分离单元可能非常棘手且耗时。查看[有效地使用遗留代码工作](https://rads.stackoverflow.com/amzn/click/com/0131177052)，了解各种经过试验和测试的技术，使事情更易于管理。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-20T08:43:25.670

这取决于您要测试的内容。您想测试数据库事务吗？您想测试业务交易还是其他？尝试将模型用于您不想测试的东西。使用模型，您可以专注于某些测试目标。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-20T08:53:01.043

是的，您 - 可以 - 重写您当前的代码，以便可以根据所有指南和最佳实践对其进行单元测试。

但是，这可能很昂贵，您应该估算成本并将其与收益进行比较...

收益是您可能会发现代码存在问题，并且如果做得好，重构会降低复杂性。

这两个因素可能会节省一些时间 - 在未来。

成本是重构代码、编写测试用例所花费的时间和精力，以及将来可能需要花费的额外时间来维护测试用例和模拟代码——这可能是一笔巨大的成本.

您正在将已知成本与未来风险进行比较，我相信很多聪明人都知道如何做到这一点，但很明显，您实际上可以花费无限时间进行重构和模拟，而不会将失败风险降低到零（或即使代码和问题很复杂并且你在重构时把事情搞砸了），所以你需要在这里找到一个平衡点。

在这种情况下，由于代码很旧，可能可以“草率”或“务实”并进行黑盒测试 - 或自上而下的测试并仅测试接口（或抽象）而无需费心模拟数据库。是的，您可以争辩说这不是单元测试，而是系统测试或功能测试实践。

...但是，它可能会为您的钱 - 或您的雇主/客户的钱 - 或更多时间与您的重要人物（或至少更多时间观看发现频道）提供最佳价值。

如果您有旧代码，请允许黑盒测试，允许测试之间的依赖关系并编译一系列测试以设置测试数据并对其进行操作，并且至少在未 100% 测试时自动测试。

# wpf - 如何在 WPF Expander Header 中对齐 TexBlocks

> ID：767407
> 
> 赞同：6
> 
> 时间：2009-04-20T08:35:02.227
> 
> 标签：wpf, header, expander

我在扩展器标题中有多个 Texblock。我希望这些 TextBlocks 与左、右和中心对齐。

我怎样才能做到这一点？

请帮忙...

谢谢

沙拉特

红色文本应左对齐，蓝色文本应居中对齐，绿色应右对齐

请复制 XAMLPad.Exe 中的代码

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-20T08:53:43.587

您不能简单地使用带有 TextBlocks 的 Grid 或 Dock 面板来控制对齐的原因是因为 Expander 的默认模板左对齐标题内容而不是允许它拉伸。

有两种方法可以解决这个问题。您可以指定扩展器标题内容的宽度，也可以为扩展器定义新模板。

第二种选择可能是最好的，但也更难实施。如果您有 Expression Blend，那么您可以右键单击*Objects and Timeline*树中的 Expander 元素，然后选择*Edit Control Parts -> Edit a copy...* 完成后，您还需要修改*HeaderSite*的模板（您这次可以选择*编辑模板而不是创建副本）。*一旦你在那里，你几乎可以将它设置为*拉伸*以进行水平对齐，并在右侧添加一点边距，你就完成了。

如果您没有 Expression Blend 更新问题以指定它，我将发布一些示例代码。我在这里没有这样做的主要原因是模板大约有 250 行代码，我不想无缘无故地产生很多噪音。

鉴于您给出的答复，我猜您没有 Blend。如果将以下 XAML 放入 XAML Pad 中，您应该会看到一个 Expander 示例，它将使标头内容能够跨越 Expander 的整个宽度。您很可能希望将页面的资源移动到单独的资源字典中，以便您可以在应用程序中重用它。

```
<Page xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      >
      <Page.Resources>
        <LinearGradientBrush x:Key="ExpanderArrowHoverFill" EndPoint="0,1" StartPoint="0,0">
            <GradientStop Color="#FFF0F8FE" Offset="0"/>
            <GradientStop Color="#FFE0F3FE" Offset="0.3"/>
            <GradientStop Color="#FF6FA7C5" Offset="1"/>
        </LinearGradientBrush>
        <LinearGradientBrush x:Key="ExpanderArrowPressedFill" EndPoint="0,1" StartPoint="0,0">
            <GradientStop Color="#FFDCF0FA" Offset="0"/>
            <GradientStop Color="#FFC5E6F7" Offset="0.2"/>
            <GradientStop Color="#FF5690D0" Offset="1"/>
        </LinearGradientBrush>
        <LinearGradientBrush x:Key="ExpanderArrowFill" EndPoint="0,1" StartPoint="0,0">
            <GradientStop Color="White" Offset="0"/>
            <GradientStop Color="#FFBFBFBF" Offset="0.5"/>
            <GradientStop Color="#FF878787" Offset="1"/>
        </LinearGradientBrush>
        <Style x:Key="ExpanderRightHeaderStyle" TargetType="{x:Type ToggleButton}">
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type ToggleButton}">
                        <Border Padding="{TemplateBinding Padding}">
                            <Grid SnapsToDevicePixels="False" Background="Transparent">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="19"/>
                                    <RowDefinition Height="*"/>
                                </Grid.RowDefinitions>
                                <Grid>
                                    <Grid.LayoutTransform>
                                        <TransformGroup>
                                            <TransformGroup.Children>
                                                <TransformCollection>
                                                    <RotateTransform Angle="-90"/>
                                                </TransformCollection>
                                            </TransformGroup.Children>
                                        </TransformGroup>
                                    </Grid.LayoutTransform>
                                    <Ellipse Fill="{DynamicResource ExpanderArrowFill}" Stroke="DarkGray" HorizontalAlignment="Center" x:Name="circle" VerticalAlignment="Center" Width="19" Height="19"/>
                                    <Path Stroke="#666" StrokeThickness="2" HorizontalAlignment="Center" x:Name="arrow" VerticalAlignment="Center" SnapsToDevicePixels="false" Data="M 1,1.5 L 4.5,5 L 8,1.5"/>
                                </Grid>
                                <ContentPresenter HorizontalAlignment="Center" Margin="0,4,0,0" VerticalAlignment="Top" SnapsToDevicePixels="True" Grid.Row="1" RecognizesAccessKey="True"/>
                            </Grid>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsChecked" Value="true">
                                <Setter Property="Data" TargetName="arrow" Value="M 1,4.5  L 4.5,1  L 8,4.5"/>
                            </Trigger>
                            <Trigger Property="IsMouseOver" Value="true">
                                <Setter Property="Stroke" TargetName="circle" Value="#FF3C7FB1"/>
                                <Setter Property="Fill" TargetName="circle" Value="{DynamicResource ExpanderArrowHoverFill}"/>
                                <Setter Property="Stroke" TargetName="arrow" Value="#222"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="true">
                                <Setter Property="Stroke" TargetName="circle" Value="#FF526C7B"/>
                                <Setter Property="StrokeThickness" TargetName="circle" Value="1.5"/>
                                <Setter Property="Fill" TargetName="circle" Value="{DynamicResource ExpanderArrowPressedFill}"/>
                                <Setter Property="Stroke" TargetName="arrow" Value="#FF003366"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        <Style x:Key="ExpanderUpHeaderStyle" TargetType="{x:Type ToggleButton}">
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type ToggleButton}">
                        <Border Padding="{TemplateBinding Padding}">
                            <Grid SnapsToDevicePixels="False" Background="Transparent">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="19"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <Grid>
                                    <Grid.LayoutTransform>
                                        <TransformGroup>
                                            <TransformGroup.Children>
                                                <TransformCollection>
                                                    <RotateTransform Angle="180"/>
                                                </TransformCollection>
                                            </TransformGroup.Children>
                                        </TransformGroup>
                                    </Grid.LayoutTransform>
                                    <Ellipse Fill="{DynamicResource ExpanderArrowFill}" Stroke="DarkGray" HorizontalAlignment="Center" x:Name="circle" VerticalAlignment="Center" Width="19" Height="19"/>
                                    <Path Stroke="#666" StrokeThickness="2" HorizontalAlignment="Center" x:Name="arrow" VerticalAlignment="Center" SnapsToDevicePixels="false" Data="M 1,1.5 L 4.5,5 L 8,1.5"/>
                                </Grid>
                                <ContentPresenter HorizontalAlignment="Stretch" Margin="4,0,19,0" VerticalAlignment="Center" SnapsToDevicePixels="True" Grid.Column="1" RecognizesAccessKey="True"/>
                            </Grid>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsChecked" Value="true">
                                <Setter Property="Data" TargetName="arrow" Value="M 1,4.5  L 4.5,1  L 8,4.5"/>
                            </Trigger>
                            <Trigger Property="IsMouseOver" Value="true">
                                <Setter Property="Stroke" TargetName="circle" Value="#FF3C7FB1"/>
                                <Setter Property="Fill" TargetName="circle" Value="{DynamicResource ExpanderArrowHoverFill}"/>
                                <Setter Property="Stroke" TargetName="arrow" Value="#222"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="true">
                                <Setter Property="Stroke" TargetName="circle" Value="#FF526C7B"/>
                                <Setter Property="StrokeThickness" TargetName="circle" Value="1.5"/>
                                <Setter Property="Fill" TargetName="circle" Value="{DynamicResource ExpanderArrowPressedFill}"/>
                                <Setter Property="Stroke" TargetName="arrow" Value="#FF003366"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        <Style x:Key="ExpanderLeftHeaderStyle" TargetType="{x:Type ToggleButton}">
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type ToggleButton}">
                        <Border Padding="{TemplateBinding Padding}">
                            <Grid SnapsToDevicePixels="False" Background="Transparent">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="19"/>
                                    <RowDefinition Height="*"/>
                                </Grid.RowDefinitions>
                                <Grid>
                                    <Grid.LayoutTransform>
                                        <TransformGroup>
                                            <TransformGroup.Children>
                                                <TransformCollection>
                                                    <RotateTransform Angle="90"/>
                                                </TransformCollection>
                                            </TransformGroup.Children>
                                        </TransformGroup>
                                    </Grid.LayoutTransform>
                                    <Ellipse Fill="{DynamicResource ExpanderArrowFill}" Stroke="DarkGray" HorizontalAlignment="Center" x:Name="circle" VerticalAlignment="Center" Width="19" Height="19"/>
                                    <Path Stroke="#666" StrokeThickness="2" HorizontalAlignment="Center" x:Name="arrow" VerticalAlignment="Center" SnapsToDevicePixels="false" Data="M 1,1.5 L 4.5,5 L 8,1.5"/>
                                </Grid>
                                <ContentPresenter HorizontalAlignment="Center" Margin="0,4,0,0" VerticalAlignment="Top" SnapsToDevicePixels="True" Grid.Row="1" RecognizesAccessKey="True"/>
                            </Grid>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsChecked" Value="true">
                                <Setter Property="Data" TargetName="arrow" Value="M 1,4.5  L 4.5,1  L 8,4.5"/>
                            </Trigger>
                            <Trigger Property="IsMouseOver" Value="true">
                                <Setter Property="Stroke" TargetName="circle" Value="#FF3C7FB1"/>
                                <Setter Property="Fill" TargetName="circle" Value="{DynamicResource ExpanderArrowHoverFill}"/>
                                <Setter Property="Stroke" TargetName="arrow" Value="#222"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="true">
                                <Setter Property="Stroke" TargetName="circle" Value="#FF526C7B"/>
                                <Setter Property="StrokeThickness" TargetName="circle" Value="1.5"/>
                                <Setter Property="Fill" TargetName="circle" Value="{DynamicResource ExpanderArrowPressedFill}"/>
                                <Setter Property="Stroke" TargetName="arrow" Value="#FF003366"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        <Style x:Key="ExpanderHeaderFocusVisual">
            <Setter Property="Control.Template">
                <Setter.Value>
                    <ControlTemplate>
                        <Border>
                            <Rectangle Stroke="Black" StrokeDashArray="1 2" StrokeThickness="1" Margin="0" SnapsToDevicePixels="true"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        <Style   x:Key="ExpanderDownHeaderStyle" TargetType="{x:Type ToggleButton}">
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type ToggleButton}">
                        <Border Padding="{TemplateBinding Padding}">
                            <Grid SnapsToDevicePixels="False" Background="Transparent">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="19"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <Ellipse Fill="{DynamicResource ExpanderArrowFill}" Stroke="DarkGray" HorizontalAlignment="Center" x:Name="circle" VerticalAlignment="Center" Width="19" Height="19"/>
                                <Path Stroke="#666" StrokeThickness="2" HorizontalAlignment="Center" x:Name="arrow" VerticalAlignment="Center" SnapsToDevicePixels="false" Data="M 1,1.5 L 4.5,5 L 8,1.5"/>
                                <ContentPresenter HorizontalAlignment="Stretch" Margin="4,0,19,0" VerticalAlignment="Center" SnapsToDevicePixels="True" Grid.Column="1" RecognizesAccessKey="True"/>
                            </Grid>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsChecked" Value="true">
                                <Setter Property="Data" TargetName="arrow" Value="M 1,4.5  L 4.5,1  L 8,4.5"/>
                            </Trigger>
                            <Trigger Property="IsMouseOver" Value="true">
                                <Setter Property="Stroke" TargetName="circle" Value="#FF3C7FB1"/>
                                <Setter Property="Fill" TargetName="circle" Value="{DynamicResource ExpanderArrowHoverFill}"/>
                                <Setter Property="Stroke" TargetName="arrow" Value="#222"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="true">
                                <Setter Property="Stroke" TargetName="circle" Value="#FF526C7B"/>
                                <Setter Property="StrokeThickness" TargetName="circle" Value="1.5"/>
                                <Setter Property="Fill" TargetName="circle" Value="{DynamicResource ExpanderArrowPressedFill}"/>
                                <Setter Property="Stroke" TargetName="arrow" Value="#FF003366"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        <Style x:Key="StretchExpanderStyle" TargetType="{x:Type Expander}">
            <Setter Property="Foreground" Value="{DynamicResource {x:Static SystemColors.ControlTextBrushKey}}"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
            <Setter Property="VerticalContentAlignment" Value="Stretch"/>
            <Setter Property="BorderBrush" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type Expander}">
                        <Border SnapsToDevicePixels="true" Background="{TemplateBinding Background}" BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="{TemplateBinding BorderThickness}" CornerRadius="3">
                            <DockPanel>
                                <ToggleButton FocusVisualStyle="{StaticResource ExpanderHeaderFocusVisual}" Margin="1" MinHeight="0" MinWidth="0" x:Name="HeaderSite" Style="{StaticResource ExpanderDownHeaderStyle}" Content="{TemplateBinding Header}" ContentTemplate="{TemplateBinding HeaderTemplate}" ContentTemplateSelector="{TemplateBinding HeaderTemplateSelector}" FontFamily="{TemplateBinding FontFamily}" FontSize="{TemplateBinding FontSize}" FontStretch="{TemplateBinding FontStretch}" FontStyle="{TemplateBinding FontStyle}" FontWeight="{TemplateBinding FontWeight}" Foreground="{TemplateBinding Foreground}" HorizontalContentAlignment="{TemplateBinding HorizontalContentAlignment}" Padding="{TemplateBinding Padding}" VerticalContentAlignment="{TemplateBinding VerticalContentAlignment}" DockPanel.Dock="Top" IsChecked="{Binding Path=IsExpanded, Mode=TwoWay, RelativeSource={RelativeSource TemplatedParent}}"/>
                                <ContentPresenter HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}" Margin="{TemplateBinding Padding}" x:Name="ExpandSite" VerticalAlignment="{TemplateBinding VerticalContentAlignment}" Focusable="false" Visibility="Collapsed" DockPanel.Dock="Bottom"/>
                            </DockPanel>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsExpanded" Value="true">
                                <Setter Property="Visibility" TargetName="ExpandSite" Value="Visible"/>
                            </Trigger>
                            <Trigger Property="ExpandDirection" Value="Right">
                                <Setter Property="DockPanel.Dock" TargetName="ExpandSite" Value="Right"/>
                                <Setter Property="DockPanel.Dock" TargetName="HeaderSite" Value="Left"/>
                                <Setter Property="Style" TargetName="HeaderSite" Value="{StaticResource ExpanderRightHeaderStyle}"/>
                            </Trigger>
                            <Trigger Property="ExpandDirection" Value="Up">
                                <Setter Property="DockPanel.Dock" TargetName="ExpandSite" Value="Top"/>
                                <Setter Property="DockPanel.Dock" TargetName="HeaderSite" Value="Bottom"/>
                                <Setter Property="Style" TargetName="HeaderSite" Value="{StaticResource ExpanderUpHeaderStyle}"/>
                            </Trigger>
                            <Trigger Property="ExpandDirection" Value="Left">
                                <Setter Property="DockPanel.Dock" TargetName="ExpandSite" Value="Left"/>
                                <Setter Property="DockPanel.Dock" TargetName="HeaderSite" Value="Right"/>
                                <Setter Property="Style" TargetName="HeaderSite" Value="{StaticResource ExpanderLeftHeaderStyle}"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="false">
                                <Setter Property="Foreground" Value="{DynamicResource {x:Static SystemColors.GrayTextBrushKey}}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Page.Resources>
    <Grid>
        <Expander Width="500" Style="{DynamicResource StretchExpanderStyle}">
            <Expander.Header>
                <Grid>
                    <TextBlock DockPanel.Dock="Left" HorizontalAlignment="Left" Text="Left" Foreground="Red" />                                                                                      
                    <TextBlock Text="Center" HorizontalAlignment="Center" Foreground="Blue" />
                    <TextBlock DockPanel.Dock="Right" HorizontalAlignment="Right" Text="Right" Foreground="Green" />     
                </Grid>
                <!-- As an alternative you could use a dock panel. as shown by the following -->
                <!--<DockPanel HorizontalAlignment="Stretch">
                    <TextBlock DockPanel.Dock="Left" Text="Left" Foreground="Red" />                    
                    <TextBlock DockPanel.Dock="Right" Text="Right" Foreground="Green" />                                                   
                    <TextBlock Text="Center" HorizontalAlignment="Center" Foreground="Blue" />
                </DockPanel>
                -->                
            </Expander.Header>
            Some Content.......
        </Expander>
    </Grid>
</Page> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-20T09:59:36.890

请复制 XAMLPad.Exe 中的代码

红色文本应左对齐，蓝色文本应居中对齐，绿色应右对齐

请回复。

谢谢

```
<Page xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation" xmlns:sys="clr-namespace:System;assembly=mscorlib" xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml" >
  <Grid>
  <Expander HorizontalAlignment="Stretch" VerticalAlignment="Top" Grid.ColumnSpan="8" Grid.Row="2">
                        <Expander.Header>
                            <TextBlock>
                             <InlineUIContainer> 
                                    <TextBlock Text="Summary" Foreground="Red" TextWrapping="Wrap" HorizontalAlignment="Left" VerticalAlignment="Top" />
                            </InlineUIContainer>
                                  <Run Text=" "/> 
                              <InlineUIContainer>  
                                    <TextBlock Text="Duration:" TextWrapping="Wrap" Foreground="Blue" HorizontalAlignment="Left" VerticalAlignment="Center"/>
                               </InlineUIContainer> 
                                 <Run Text=" "/> 
                                 <InlineUIContainer>  
                                    <TextBlock Text="1" TextWrapping="Wrap" Foreground="Blue" HorizontalAlignment="Left" VerticalAlignment="Center" Margin="23,0,0,0"/>
                               </InlineUIContainer> 
                                 <InlineUIContainer>  
                                    <TextBlock Text=" Years" TextWrapping="Wrap"  Foreground="Blue"  HorizontalAlignment="Left" VerticalAlignment="Center"/>
                               </InlineUIContainer> 
                                   <Run Text=" "/> 
                                 <InlineUIContainer>  
                                    <TextBlock Text="Status:" TextWrapping="Wrap"   Foreground="Green"  HorizontalAlignment="Left" VerticalAlignment="Center"/>
                               </InlineUIContainer> 
                                    <Run Text=" "/> 
                                 <InlineUIContainer>  
                                    <TextBlock Text="Approved" TextWrapping="Wrap"  Foreground="Green"  HorizontalAlignment="Left" VerticalAlignment="Center"/>
                               </InlineUIContainer> 
                                    </TextBlock>
                        </Expander.Header>
                        <TextBlock Text="Testing1....." Background="#FFFFFFFF" Margin="0,4,0,0" TextWrapping="Wrap"/>
                    </Expander>
  </Grid>
</Page> 
```

# c# - 使用三重 DES 时的加密数据大小

> ID：767408
> 
> 赞同：3
> 
> 时间：2009-04-20T08:35:08.997
> 
> 标签：c#, .net, encryption, cryptography, 3des

我打算在我的一个项目中使用 TripleDES。我正在做一些实验以适应它。我知道三重 DES 的块大小是 8 个字节，所以我假设如果给出 8 个字节的数据，我应该得到 8 个字节的加密数据。但我得到的是：

```
输入大小 | 加密大小
. | .
. | .
6 字节 | 8 个字节
7 个字节 | 8 个字节
8 字节 | 16 字节
9 个字节 | 16 字节
. | .
. | .

```

正常吗？这是它应该工作的方式。以下是我尝试使用三重 DES 的方法：

 `````
class TripleDESEncryption
{
    private readonly TripleDESCryptoServiceProvider engine;

    public TripleDESEncryption () : this (256) { }

    public TripleDESEncryption (int keySizeInBits) {
        engine = new TripleDESCryptoServiceProvider { KeySize = keySizeInBits };
        engine.GenerateKey ();
    }

    public byte[] Encrypt (byte[] plain) {
        return engine.CreateEncryptor ().TransformFinalBlock (plain, 0, plain.Length);
    }

    public byte[] Decrypt (byte[] encrypted) {
        return engine.CreateDecryptor ().TransformFinalBlock (encrypted, 0, encrypted.Length);
    }
}

class Program
{
    static readonly int MAX_TEXT_LENGTH = 128;

    static void Main (string[] args) {
        Console.WriteLine ("{0,10}{1,10}{2,10}{3,10}", "Algo", "Key Size", "Input Size", "Encrypted Size");

        var tripleDES = new TripleDESEncryption ();
        var input = new List<byte> ();

        for (int i = 0; i <= MAX_TEXT_LENGTH; i++) {
            var plain = input.ToArray ();
            var encrypted = tripleDES.Encrypt (plain);
            Console.WriteLine ("{0,10}{1,10}{2,10}{3,10}", "Triple DES", keySize, input.Count, encrypted.Length);
            input.Add (0x65);
        }

        Console.ReadLine ();
    }
} 
````  `* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-04-20T08:41:15.580

TripleDESCryptoServiceProvider 默认使用[PKCS7-padding](http://msdn.microsoft.com/en-us/library/system.security.cryptography.paddingmode.aspx)。这会将任何消息填充到块大小的下一个倍数。

为避免使用填充，只需将`Padding`-property 设置为`PaddingMode.None`

```
new TripleDESCryptoServiceProvider { 
  KeySize = keySizeInBits, 
  Padding = PaddingMode.None 
}; 
```

# zend-framework - 如何使用 Zend Mail 在 smtp 之前弹出？

> ID：767416
> 
> 赞同：0
> 
> 时间：2009-04-20T08:37:31.923
> 
> 标签：zend-framework, smtp, pop3

我刚开始使用 Zend Mail Compoment，我需要在 smtp 之前弹出，但在 zend 邮件文档中没有提到这一点。

任何人都可以就此提出建议吗？

谢谢

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-20T09:06:17.550

SMTP 之前的 POP 不是 SMTP 标准的一部分，它只是一种用于检查连接到 SMTP 服务器的客户端是否具有有效凭据的技巧，而不使用 SMTP 自己的身份验证机制。

只需使用 Zend 框架自己[打开 POP 邮箱](http://framework.zend.com/manual/en/zend.mail.read.html#zend.mail.read-example)，然后通过 SMTP 发送邮件。

# svn - 删除不必要的 svn:mergeinfo 属性

> ID：767418
> 
> 赞同：139
> 
> 时间：2009-04-20T08:37:41.347
> 
> 标签：svn, merge, tortoisesvn, svn-mergeinfo

当我在我的存储库中合并内容时，Subversion 想要将很多`svn:mergeinfo`属性添加/更改到与我想要合并的内容完全无关的文件中。

之前在 Stack Overflow 上已询问过有关此行为的问题：

*   *[工作副本根以外的路径上的 SVN Mergeinfo 属性](https://stackoverflow.com/questions/391864/svn-mergeinfo-properties-on-paths-other-than-the-working-copy-root)*
*   *[有没有办法使用 svn:mergeinfo 关闭 TortoiseSVN？](https://stackoverflow.com/questions/622409/tortoisesvn-using-svnmergeinfo-is-there-a-way-to-turn-it-off)*

根据我对上述主题的理解，我的存储库中的很多文件似乎都有明确的`svn:mergeinfo`属性，而实际上它们不应该。建议是减少数量，仅将这些属性放在相关文件/文件夹中。

所以现在我的问题是：如何轻松删除那些不需要的属性？我正在使用 TortoiseSVN，但我不愿意手动检查/修复数百个文件。有没有更简单的方法来删除那些不必要的`svn:mergeinfo`属性？

PS 我**不是**在寻找 C++ SVN API 代码。

* * *

## 回答 #1

> 赞同：144
> 
> 时间：2010-04-15T21:05:44.103

这是删除所有子树 svn:mergeinfo 属性但不在根文件夹中的另一种方法（这是分支正常工作所必需的）。

从项目的根目录执行：

```
svn propdel svn:mergeinfo -R
svn revert .
svn ci -m "Removed mergeinfo" 
```

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2010-03-08T20:03:40.373

这是一种删除所有子树 svn:mergeinfo 属性的方法。在存储库的根目录中运行它：

```
svn propget svn:mergeinfo --depth=infinity 
    | grep -v "^/"
    | grep -v "^\."   
    | cut -d- -f1 
    | xargs svn propdel svn:mergeinfo 
```

一站式轻松复制/粘贴：

```
svn propget svn:mergeinfo --depth=infinity | grep -v "^/" | grep -v "^\." | cut -d- -f1 | xargs svn propdel svn:mergeinfo 
```

要在运行之前预览这将影响哪些文件，请将最后一个“propdel”更改为“propget”或完全删除最后一个 xargs 管道。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2009-04-20T09:03:25.713

正如[这个线程](http://subversion.tigris.org/ds/viewMessage.do?dsForumId=1065&dsMessageId=1601195)中提到的：

*   大多数空的合并信息（“空白”）可能是由于源项目没有明确的合并信息的工作副本到工作副本副本/移动引起的。除非您使用 1.6 SVN，否则使用 propdel 可能是解决方案：从 1.5.5 开始，这些 WC-to-WC 副本不再在目标上创建空的 mergeinfo
*   较早的 svn move (rename) 重组操作也可以传播 mergeinfo，而不是将它们留在根目录中
*   有一个潜在的内存问题，由[案例 3393](http://subversion.tigris.org/issues/show_bug.cgi?id=3393)跟踪，将在即将发布的 1.6.2 版本中修复并在 1.5 中向后移植

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2012-12-29T14:51:47.430

由于我对盲目`svn:merge-info`删除属性没有信心，我已经实现了一个工具来分析工作副本的当前情况，并从非根合并信息属性中删除尽可能多的合并修订。在额外的人工检查和控制之后，可以提交对工作副本的更改。

这里是：[svn-clean-mergeinfo](https://github.com/ymartin59/svn-clean-mergeinfo)

不要犹豫，报告有关其使用的任何问题以改进它。

Subversion 1.10 引入了一个专用于该任务的新工具：`svn-mergeinfo-normalizer`

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2010-03-24T00:19:30.150

我知道已经有一段时间了，但我遇到了类似的问题。我正在使用 TortoiseSVN 1.6.7。碰巧该属性位于我的工作副本的根目录上。当我查看根目录上的属性并单击 svn:mergeinfo 上的删除时，它询问我是否要递归删除它。这摆脱了我所有的 svn:mergeinfo cockups。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-08-14T23:56:04.387

如果您确定要批量删除 mergeinfo 属性，可以使用以下 BASH 脚本。

```
FILES=`svn status |grep "^ M      " |sed s/" M      "// |tr '\n', ' '`
svn revert $FILES 
```

它获取已更改文件的列表，将其过滤为仅合并信息更改，删除除实际文件路径之外的所有内容，将每行路径转换为空格分隔列表，然后在该列表上恢复调用。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2013-01-25T02:08:50.613

除了盲目地删除 mergeinfo 属性，还可以完成“丢失”的合并。

从根文件夹复制 mergeinfo 属性，然后对子文件夹执行合并以获取适当的相对路径和完全相同的修订列表。（您可以但不需要仅列出此列表与子文件夹中已有的列表之间的差异。）

通常，此合并最终应该只更改 mergeinfo 属性，而不是任何实际文件。（如果它最终改变了文件，那么之前的合并之一一定只是部分合并，这可能已经给你带来了问题。）

一旦你让它们完全匹配，这样做应该最终会为你删除 mergeinfo 属性。您可能还需要执行相反的操作：将仅存在于子文件夹中的任何合并修订合并到根目录（同样，您可以粘贴完整列表并让 SVN 为您找出差异）。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2011-12-05T10:18:47.407

要在目录结构中进行更改，这将是（仅非 DOS 'find'）：

```
find . -path "*/.svn" -prune -or -exec svn propdel svn:mergeinfo '{}' \; 
```

运行连接到 1.5 服务器的 1.6.12 客户端，我有类似的问题；*项目中*有一个子目录需要它自己的 svn:mergeinfo，但是有 121 个这样的条目（包括 ./var 下面的 5 个目录，带有“svn:ignore *”）似乎有点不合适。因此，最好有一个（例如 Python）脚本，它能够删除明显多余的合并信息并讲述其他差异......

# asp.net-mvc - ASP.NET MVC（和 MvcContrib）的隐藏特性

> ID：767423
> 
> 赞同：5
> 
> 时间：2009-04-20T08:39:59.110
> 
> 标签：asp.net-mvc

这个问题可能还为时过早，但为了与隐藏功能模因保持一致，我会对 ASP.NET MVC 框架和 MvcContrib 中的隐藏功能列表感兴趣，或者更确切地说，我猜是未充分利用的功能。

* * *

## 回答 #1

> 赞同：-1
> 
> 时间：2009-05-21T12:49:55.080

ASP.NET MVC 最隐蔽的特性是特性不存在。

换句话说，该框架被设计为可扩展的。

# iphone - 将静态库添加到 iPhone 项目

> ID：767429
> 
> 赞同：2
> 
> 时间：2009-04-20T08:42:18.980
> 
> 标签：iphone, xcode, static-libraries, openldap

这个问题的动机是我试图让 LDAP 函数与 iPhone 应用程序一起工作，这是我在论文的一部分中尝试的一个项目。

当我开发应用程序时，我使用了 Mac OS X 中的 ldap.framework 框架。这在模拟器中运行良好，但是当我现在尝试在设备上获取应用程序时，它告诉我不允许这样做使用这个框架。

经过一番研究，我发现我可以使用 arm 架构构建 openldap，并将静态库添加到我的设备应用程序中。

[我最终设法通过设置此处](http://latenitesoft.blogspot.com/2008/10/iphone-programming-tips-building-unix.html)提到的变量并使用以下命令来编译配置和构建 openldap...

```
Ade$ ./configure CC=$DEVROOT/usr/bin/arm-apple-darwin9-gcc-4.0.1 \
LD=$DEVROOT/usr/bin/ld --host=arm-apple-darwin --with-yielding_select=yes
Ade$ make depend
Ade$ make 
```

有人告诉我，我要查找的文件的扩展名为“.a”，所以我搜索了一个提到 ldap 的“.a”文件...

```
Ade$ sudo find / -name *ldap*.a
Password:
/Users/Ade/Desktop/openldap-2.4.16/libraries/libldap/.libs/libldap.a
/Users/Ade/Desktop/openldap-2.4.16/libraries/libldap_r/.libs/libldap_r.a 
```

所以我假设这些是我需要的文件？

我的问题是我接下来要做什么？我知道我需要将库添加到 Xcode 项目中，并且可能还会添加大量“.h”文件？

如果有人能给我一个指向文档的指针或阐明下一阶段的任何信息，我将不胜感激。

非常感谢，阿德

附言。我还在我的博客[www.greenpasta.com](http://www.greenpasta.com)上谈到了这个过程。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-26T13:44:53.443

我已经为 iPhoneOS 2.2 构建了一个 LDAP 客户端。您只需将 .a 拖入“与库的链接”构建阶段。我建议使用库的常规（非 _r）版本，除非您特别需要对 ldap 内容进行重入（我不推荐）。您还可以将 .h 添加到您的项目中，这通常是访问它们的最简单方法。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-20T10:57:49.027

只需将 .a 文件拖到 Xcode 项目中，然后选择“将文件复制到项目中”。我不熟悉 OpenLDAP，但我认为 _r 版本只是一个线程安全版本。我建议使用它而不是复制另一个。您可能不应该将这两个文件都复制到 Xcode 中，否则会出现链接错误。

然后对定义 OpenLDAP 的客户端 API 的 .h 文件执行相同的操作 - 我再次不确定这些文件是哪些，但我相信您可以轻松找到。

我建议将 .a 和 .h 文件一起组织在资源下的 Xcode 组中。

在您的源代码中包含头文件，您应该一切顺利。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-07T16:52:33.857

您可能还需要将 -lldap 添加到链接器命令（在构建设置窗格中）。

# c# - 让这个案例成为 REST 的更好方法

> ID：767436
> 
> 赞同：1
> 
> 时间：2009-04-20T08:43:36.433
> 
> 标签：c#, .net, asp.net-mvc, rest

想象一下这种情况：

颜色有一个id。很容易。
相同的颜色可以根据用户的语言偏好、搜索查询和个人偏好有不同的显示名称。
这个显示名称没有定义，但它需要传递到每个页面，因此每次提到颜色时用户都会面对相同的标签。
此外，（为了保持这个解释简短，跟我一起去）名称也可以是空白的（所以参数是可选的）。

由于这样的参数很多，而且参数是可选的，我不想把所有这些可选参数都推送到丑陋的查询字符串中，所以我做了一个单独的 URL 参数来标识颜色，基本上放置颜色 id 和可选一个参数中的参数，用自定义分隔符分隔。

例子：

*   Color.mvc/display/123456--BorisRed--AnotherParameter
*   Formula.mvc/display/123456--BorisRed--AnotherParameter/987654

我有一个生成这个字符串的辅助方法和一个解析这个字符串的辅助方法。

到目前为止效果很好，但我觉得可能有更好的方法来做到这一点。有什么建议么？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-20T08:47:09.793

对我来说看起来不错；您可能想看看是否可以在解析层中使用“模型绑定器”，以便您在路由中只使用 {id} ，并拥有`SomeAction(MyColor id)`，并让模型绑定器自动解析`id`. 或者（也许更简单），我似乎记得它也会`TypeConverter`在这里使用 - 所以也许`TypeConverter`为你的颜色类/结构写一个（`MyColor`上面）。

示例转换器：

```
[TypeConverter(typeof(MyColorConverter))]
public class MyColor
{
    public int Id { get; set; }
    public string Name { get; set; }

    public override string ToString()
    {
        return Name;
    }
}

class MyColorConverter : TypeConverter
{
    public override bool CanConvertFrom(ITypeDescriptorContext context,
         Type sourceType)
    {
        return sourceType == typeof(string)
            || base.CanConvertFrom(context, sourceType);
    }
    public override object ConvertFrom(ITypeDescriptorContext context, 
        System.Globalization.CultureInfo culture, object value)
    {
        if (value != null && value is string)
        {
            string[] parts = ((string)value).Split(new string[] {"--"},
               StringSplitOptions.None);
            MyColor color = new MyColor();
            if(parts.Length > 0) color.Id = int.Parse(parts[0]);
            if(parts.Length > 1) color.Name = parts[1];
            return color;
        }
        return base.ConvertFrom(context, culture, value);
    }
    public override bool CanConvertTo(ITypeDescriptorContext context,
         Type destinationType)
    {
        return destinationType == typeof(string)
            || base.CanConvertTo(context, destinationType);
    }
    public override object ConvertTo(ITypeDescriptorContext context,
        System.Globalization.CultureInfo culture, object value,
        Type destinationType)
    {
        if (destinationType == typeof(string))
        {
            MyColor color = (MyColor)value;
            return color.Id + "--" + color.Name;
        }
        return base.ConvertTo(context, culture, value, destinationType);
    }
} 
```

# refactoring - 重构布尔表达式的工具

> ID：767437
> 
> 赞同：6
> 
> 时间：2009-04-20T08:43:37.290
> 
> 标签：refactoring, boolean-logic, boolean-expression

我正在寻找一种工具来重构布尔表达式。我有这样的表达

```
a1 => (b1 <=> c or d) AND 
a2 => (b2 <=> c or d) AND
a2 => (b2 <=> c or d) 
```

该工具应该能够简化表达式，例如提取上例中的子表达式“c or d”。有没有免费的计算机代数系统可以做到这一点？

目前我想手动重构表达式，用一个小haskell quickcheck脚本证明等价。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-20T09:02:25.157

我不确定工具，但看看[布尔代数](http://en.wikipedia.org/wiki/Boolean_algebra_(structure))

您可以绘制所有输入和输出的网格以尝试找到最小的布尔表达式

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-01-31T23:31:30.927

[DMS 软件再造工具包](http://www.semanticdesigns.com/Products/DMS/DMSToolkit.html)可以做到这一点。

它是用于将语言（包括 Java）解析为 AST 和符号表的通用编译器技术。DMS 还提供源到源的转换，以及关联和交换律重写。

您的布尔表达式将显示为 Java AST 表达式树。通过提供一组关于布尔代数的规则，您可以操纵这些表达式树。

我们过去这样做是为了对 C、RLL 和诊断方程系统进行布尔表达式简化和转换，无论是在大尺度表达式上，还是在许多中等尺度表达式上（尺度很像你的例子）。

编辑 5/19/2010：查看使用 DMS[的传统代数转换示例。](http://www.semanticdesigns.com/Products/DMS/SimpleDMSDomainExample.html)构造一个执行布尔代数的变体是微不足道的。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2018-05-14T20:24:04.857

[布尔重构和简化](https://www.dcode.fr/boolean-expressions-calculator)

该工具非常适合优化复杂的布尔表达式。

# bdd - BDD 测试是验收测试吗？

> ID：767439
> 
> 赞同：47
> 
> 时间：2009-04-20T08:44:21.127
> 
> 标签：bdd, fitnesse, acceptance-testing

`Fitnesse`如果你有`BDD`测试，你需要类似的东西吗？

* * *

## 回答 #1

> 赞同：126
> 
> 时间：2010-11-22T18:41:50.387

BDD“测试”存在于多个不同的粒度级别，一直到最初的项目愿景。大多数人都知道这些场景。一些人记得[BDD 以“应该”一词](https://dannorth.net/introducing-bdd/)作为 JUnit 的“测试”的替代词开始 - 作为 TDD 的替代品。我将“测试”放在引号中的原因是因为 BDD 并不是真正的测试。它的重点是寻找缺乏理解或理解不匹配的地方。

由于这个重点，对话比 BDD 工具重要得多。

我要再说一遍。**对话比 BDD 工具重要得多。**

验收测试实际上并不强制进行对话，并且通常假设您正在编写的测试是正确的测试。在 BDD 中，我们假设我们不知道我们在做什么（并且可能不知道我们不知道）。这就是为什么我们使用“给定，何时，然后”之类的东西 - 这样我们就可以围绕场景和/或单元级示例进行对话。（这是大多数人熟悉的两个级别——相当于验收测试和单元测试——但它的规模更大了）。

我们不称它们为“验收测试”，因为您不能要求业务人员“请帮助我进行验收测试”。他们会用一种非常奇怪、斜视的眼神看着你，然后把你当作*那个怪胎女孩*。93% 的人不希望这样。

尝试“我想和你谈谈......”的场景。或者，“你能给我举个例子吗？” 这些都很好。称它们为“验收测试”开始让人们认为你实际上是在做测试，这意味着你知道你在做什么，只是想确保你已经完成了它。在这一点上，谈话往往集中在你能多快把错误的东西拿出来，而不是你把错误的东西拿出来的事实。

你得到了错误的东西。[真的，老实说，你是。](https://dannorth.net/2010/08/30/introducing-deliberate-discovery/)即使你认为你不是，那只是因为你不了解二阶无知。你不知道你不知道，没关系，只要你找到了你*可以*知道你不知道的地方。（你不会找到所有这些。不要让分类悖论让你夜不能寐。）

真正做到正确的唯一方法是预先获得*所有*要求，并且您知道尝试时会发生什么。这是正确的。是*瀑布*。还记得加班吗？周末上班？在这七年中，您创造的任何东西都没有投入生产？如果你想避免这种情况，你只有一次机会：假设你错了，就它进行一些对话以减少错误，然后接受你*仍然*是错的并继续努力。过早编写测试意味着你有*更多的*机会出错，现在更难改变，每个人都认为你是对的，PM 正在衡量你的速度，现在你承诺再犯 2 周。而且 - 更糟糕的是 - 你将要测试你'

再来一次。**对话比 BDD 工具重要得多。**

拜托，拜托，不要专注于工具。这些工具只是一种用于捕获对话并确保它们在代码中发挥作用的机制。场景不能替代对话，就像 3 x 5 索引卡可以替代需求一样。

话虽如此，如果您*必须*从工具开始，请将 Slim 放在 Fitnesse 后面，这样它就可以运行可爱的 Given / When / Thens，而不必弄乱 Fit 的桌子和固定装置。[GivWenZen](http://code.google.com/p/givwenzen/)是基于 Slim 和其中任何一个岩石。FitSharp 是 .NET 领域的等价物。或者只是使用 Cucumber 或 SpecFlow，或者[使用一些定制的 DSL*](https://github.com/lunivore/WiPFlash/blob/master/Example.PetShop.Scenarios/PetRegistrationAndPurchase.cs)，它可以很好地完成多年的工作。

透明度：*我写了那个。还有一些 JBehave。我希望我们称它为“不要专注于 BDD 工具行为”。我可能会大量参与 BDD 的其他部分。另外，如果我能把这条信息传达出去，丹诺斯会给我买一品脱，所以这不是完全公正的建议。

无论如何-已经进行了对话。这只是人。去谈谈。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-20T08:46:59.827

我不知道是否有这样的东西，严格来说，作为“BDD 测试”。BDD 是一种哲学，它建议您如何最好地与利益相关者互动和协作以完成复杂的项目。它没有直接为编写测试的最佳方式制定任何规定。换句话说，在 BDD 哲学项目下，您可能仍然需要进行所有常见类型的测试（包括验收测试）。

当您听到“BDD 框架”时，说话者通常是指用于编写所有常用测试但带有 BDD 扭曲的框架。例如，在 RSpec 中，您仍然编写单元测试；您只需向它们添加 BDD 风味。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-13T18:38:29.260

虽然 BDD 比仅测试的范围更大，但确实存在 BDD 测试。这些测试是遵循 BDD 语言的单元测试。

给定一些初始上下文（给定），当事件发生时，确保一些结果。

根据您偏好的语言，有一些不错的 BDD 框架可用。 [JBehave](http://jbehave.org/) for Java [RSpec](http://rspec.info/) for Ruby [NBehave](http://nbehave.org/) for .NET

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-08-13T05:17:19.283

我喜欢区分“规格”和“测试”。

如果我要介绍一个名为 的方法`GetAverage(IEnumerable<int> numbers)`，我将编写一个或多或少的标准单元测试。

如果我涵盖了一个名为 的方法`CalculateSalesTax(decimal amount, State state, Municipality municipality)`，我仍然会编写单元测试，但我会称它为规范，因为我将对其进行更改 (1) 以验证例程的行为，以及 (2)因为测试本身将记录例程及其验收标准。

考虑：

```
[TestFixture]
public class When_told_to_calculate_sales_tax_for_a_given_state_and_municipality() // the name defines the context
{
    // set up mocks and expected behaviour
    StateSalesTaxWebService stateService 
        = the_dependency<IStateSalesTaxWebService>;
    MunicipalSurchargesWebService municipalService 
        = the_dependency<IMunicipalSurchargesWebService>;

   stateService.Stub(x => x.GetTaxRate(State.Florida))
        .Return(0.6);
    municipalService.Stub(x => x.GetSurchargeRate(Municipality.OrangeCounty))
        .Return(0.05);

    // run what's being tested
    decimal result = new SalesTaxCalculator().CalculateSalesTax
        (10m, State.Florida, Municipality.OrangeCounty);

    // verify the expected behaviour (these are the specifications)
    [Test]
    public void should_check_the_state_sales_tax_rate()
    {
        stateService.was_told_to(x => x.GetTaxRate(State.Florida)); // extension methods wrap assertions
    }

    [Test]
    public void should_check_the_municipal_surcharge_rate()
    {
        municipalService.was_told_to(x => x.GetSurchargeRate(Municipality.OrangeCounty));
    }

    [Test]
    public void should_return_the_correct_sales_tax_amount()
    {
        result.should_be_equal_to(10.65m);
    }
} 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-09-03T06:36:33.110

JBehave（和 NBehave 最近添加了相同的支持）与常规测试文件一起工作，因此当许多其他框架添加“BDD 品味到单元测试”时，使用 JBehave 创建的基于文本的行为规范/示例适用于验收测试。不，你不需要健身。

要了解它是如何工作的，我建议[JBehaves 2min tutorial](http://jbehave.org/documentation/two-minute-tutorial/)。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-06-25T21:48:38.870

对于 Flex 中的 BDD 测试，您可以尝试 GivWenZen-flex 查看[http://bitbucket.org/loomis/givwenzen-flex](http://bitbucket.org/loomis/givwenzen-flex)。

干杯，克里斯

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2011-12-08T17:27:25.050

实施良好的 xBehavior BDD 测试是机器人驱动的用户接受标准。

xSpecification BDD 测试通常是单元测试，不太可能成为可接受的用户接受标准。

# tdd - TDD 和贝叶斯垃圾邮件过滤器问题

> ID：767444
> 
> 赞同：4
> 
> 时间：2009-04-20T08:45:17.803
> 
> 标签：tdd, machine-learning, nlp, classification

众所周知，贝叶斯分类器是过滤垃圾邮件的有效方法。这些可以相当简洁（我们的只有几百个 LoC），但是在获得任何结果之前，所有核心代码都需要预先编写。

但是，TDD 方法要求只能编写通过测试的最少代码量，因此给出以下方法签名：

```
bool IsSpam(string text) 
```

下面的文本字符串，显然是垃圾邮件：

```
"Cheap generic viagra" 
```

我能写的最少代码是：

```
bool IsSpam(string text)
{
    return text == "Cheap generic viagra"
} 
```

现在也许我添加另一个测试消息，例如

```
"Online viagra pharmacy" 
```

我可以将代码更改为：

```
bool IsSpam(string text)
{
    return text.Contains("viagra");
} 
```

...等等等等。直到某个时候，代码变成了一堆字符串检查、正则表达式等，因为我们已经*进化*了它，而不是从一开始就考虑它并以不同的方式编写它。

那么，TDD 应该如何处理这种从最简单的代码演变为通过测试的代码不是正确的方法的情况呢？（特别是如果事先知道最好的实现不能简单地进化）。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-20T09:23:41.313

Begin by writing tests for lower level parts of the spam filter algorithm.

First you need to have in your mind a rough design of how the algorithm should be. Then you isolate a core part of the algorithm and write tests for it. In the case of a spam filter that would maybe be calculating some simple probability using Bayes' theorem (I don't know about Bayesian classifiers, so I could be wrong). You build it bottom-up, step by step, until finally you have all the parts of the algorithm implemented and putting them together is simple.

It requires lots of practice to know which tests to write in which order, so that you can do TDD in small enough steps. If you need to write much more than 10 lines of code to pass one new test, you probably are doing something wrong. Start from something smaller or mock some of the dependencies. It's safer err on the smaller side, so that the steps are too small and your progress is slow, than trying to make too big steps and failing badly.

The "Cheap generic viagra" example that you have might be better suited for an [acceptance test](http://en.wikipedia.org/wiki/Acceptance_testing). It will probably even run very slowly, because you first need to initialize the spam filter with example data, so it won't be useful as a TDD test. TDD tests need to be [FIRST](http://agileinaflash.blogspot.com/2009/02/first.html) (F = Fast, as in many hundreds or thousands tests per second).

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-20T08:51:24.277

这是我的看法：测试驱动开发意味着在编码之前编写测试。这并不意味着您为其编写测试的每个代码单元都必须是微不足道的。

此外，您仍然需要计划您的软件以合理有效的方式完成其任务。简单地添加越来越多的字符串似乎并不是解决这个问题的最佳设计。

因此，简而言之，您从可能的最小功能块编写代码（并对其进行测试），但您不会以这种方式设计算法（在伪代码中或您喜欢这样做）。

看看你和其他人是否同意会很有趣。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-03-02T19:14:50.673

我不认为检查一个特定的字符串是否是垃圾邮件真的是一个单元测试，它更多的是一个客户测试。有一个重要的区别，因为它不是真正的红色/贪婪类型的东西。实际上，您可能应该有几百个测试文档。最初，有些会被归类为垃圾邮件，随着您对产品的改进，这些分类将更直接地符合您的要求。因此，您应该制作一个自定义应用程序来加载一堆测试文档，对它们进行分类，然后评估整体得分。当您完成该客户测试时，由于您尚未实施算法，因此得分将非常糟糕。但是您现在有了衡量前进进度的方法，考虑到您可以期待前进的学习/更改/实验的数量，这非常有价值。

当你实现你的算法时，（甚至是第一手的客户测试）你仍然可以用真正的单元测试来做 TDD。贝叶斯过滤器组件的第一个测试不会测量特定字符串是否被评估为垃圾邮件，而是衡量该字符串是否适当地通过了贝叶斯过滤器组件。然后，您的下一个测试将关注如何实现贝叶斯过滤器（正确构造节点、应用训练数据等）。

您确实需要对产品的发展方向有一个愿景，并且您的测试和实施应该针对该愿景。您也不能只是盲目地添加客户测试，您需要在考虑整体产品愿景的情况下添加测试。任何软件开发目标都会有你可以编写的好测试和坏测试。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-20T11:20:48.520

在我看来，使用贝叶斯垃圾邮件过滤器，您应该使用现有方法。特别是您将使用贝叶斯定理，可能还有其他一些概率论。

在这种情况下，似乎最好的方法是根据这些方法来决定你的算法，这些方法应该经过试验和测试，或者可能是实验性的。然后，您的单元测试应该设计为测试 ispam 是否正确实现了您决定的算法，以及结果在 0 和 1 之间的基本测试。

关键是，您的单元测试并非旨在测试您的算法是否合理。您应该已经知道，或者您的程序可能被设计为实验，以查看它是否明智。

这并不是说 isspam 功能的性能不重要。但它不一定是单元测试的一部分。数据可能来自 alpha 测试的反馈、新的理论结果或您自己的实验。在这种情况下，可能需要一种新算法，并且需要新的单元测试。

另请参阅[有关](https://stackoverflow.com/questions/186619/how-to-unit-test-a-pseudo-random-number-generator)测试随机数生成器的问题。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-23T10:08:02.600

这里的问题不在于测试驱动开发，而在于您的测试。如果您开始针对单个测试开发代码，那么您所做的所有测试就是指定一个字符串检查函数。

TDD 的主要思想是在编写代码之前考虑您的测试。您无法详尽地测试垃圾邮件过滤器，但您可以通过数万或数十万个测试文档得出一个合理的近似值。在存在这么多测试的情况下，朴素贝叶斯算法比十万行 switch 语句更简单。

实际上，您可能无法通过 100% 的单元测试，因此您只需要尝试尽可能多地通过即可。您还必须确保您的测试足够真实。如果你这样想，测试驱动开发和机器学习有很多共同点。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-20T09:32:09.407

For me, what you call *minimum amount of code to pass a test* is the whole `IsSpam()` function. This is consistent with its size (you say only a few hundred LoC).

Alternatively, incremental approach does not claim to code first and think afterwards. You can design a solution, code it and then refine the design with special cases or better algorithm.

Anyway, refactoring does not consist simply in adding new stuff over old one. For me this is a more destructive approach, where you throw away old code for a simple feature and replace it with new code for a refined and more elaborate feature.

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-20T09:34:47.153

你有你的单元测试，对吧？

这意味着您现在可以重构代码甚至重写它并使用单元测试来查看您是否破坏了某些东西。

*先让它工作，然后让它干净*——是时候进行第二步了：）

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-20T09:39:42.570

(1) 你不能说一个字符串“是垃圾邮件”或“不是垃圾邮件”，就像你说一个数字是否是素数一样。这不是黑色或白色。

(2) 仅使用用于测试的示例编写字符串处理函数是不正确的，当然也不是 TDD 的目标。例子应该代表一种价值观。TDD 不能防止愚蠢的实现，所以你不应该假装你根本不知道，所以你不应该写`return text == "Cheap generic viagra"`.

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2010-03-02T18:56:24.193

您所描述的问题是理论上的，通过添加对测试的响应，您将制作一个大而混乱的泥球。你缺少的东西非常重要。

循环是：红色 --> 绿色 --> 重构

你不只是在红色和绿色之间跳跃。一旦测试通过（绿色），您就可以重构生产代码和测试。然后你编写下一个失败的测试（红色）。

如果你正在重构，那么你正在消除重复和混乱，并且随着它的增长而变得混乱。您将很快达到提取方法、建立评分和评级以及可能引入外部工具的地步。只要它是最简单的事情，你就会这样做。

不要只是在红色和绿色之间跳来跳去，否则你的所有代码都会变得一团糟。该重构步骤不是可选的或任意的。这是必不可少的。

# sql - 分组时避免多个子选择

> ID：767447
> 
> 赞同：1
> 
> 时间：2009-04-20T08:46:36.847
> 
> 标签：sql, db2

我有一个类似的查询：

```
select table_one.x, sum(table_one.y)
(select foo from table_two where table_one.x = table_two.x) as item_description
from table_one
inner join table_two
on table_one.x = table_two.x
-- where table_2 row has various attributes
group by table_one.x 
```

分组意味着我需要一个子选择来访问表二中的 foo 。现在，如果我想从表二中选择第二列，有没有办法在没有第二个子选择的情况下访问它？

数据库是 DB2。

编辑：连接是多对一的，即将 table_one 视为订单，table_b 视为包含项目的信息。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-20T08:53:58.327

table_two 对于每个 table_one.x 是否有多行，或者它是一个一对二的连接...如果它是一对二，那么这不是你想要的......因为你的子选择是在与您的加入条件相同

```
SELECT
   table_one.x, table_two.foo, sum(table_one.y)
FROM table_one
   INNER JOIN table_two
       ON table_one.x = table_two.x 
GROUP BY
   table_one.x, table_two.foo 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-20T08:58:07.100

```
SELECT  *
FROM    (
        SELECT  x, SUM(y)
        FROM    table_one
        GROUP BY
                x
        ) AS t1
INNER JOIN
        table_two t2
ON      t2.x = t1.x
-- where table_2 row has various attributes 
```

# java - 如何使用 BigInteger 类在 Java 中实现无符号 64 位 int？

> ID：767456
> 
> 赞同：13
> 
> 时间：2009-04-20T08:50:40.987
> 
> 标签：java, types

我正在寻找一种容量为 0 到 2^64 - 1 的数据类型。我们知道 Java 不支持“无符号”禁止字符数据类型。

BigInteger 类允许创建长数据类型无法支持的更大数字。但我不确定 BigInteger 类将如何服务于我的目的。BigInteger 类仅允许通过构造函数进行赋值。我看到以下可能性，但它会生成一个随机数。

```
BigInteger(int numBits, Random rnd) 
Constructs a randomly generated BigInteger, uniformly distributed over the range 0 to (2^numBits - 1), inclusive. 
```

我看不到任何 setValue(x) 类型的 API 可以让我为这个 BigInteger 选择我自己的值。如何使用 BigInteger 类来实现这一点，或者还有其他方法吗？请发布代码示例。

PS：[这里](https://stackoverflow.com/questions/508630/java-equivalent-of-unsigned-long-long)有人发布的问题没有实现细节。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-20T10:28:41.767

您通常可以像使用无符号一样使用 Java 的有符号数字数据类型。

请参阅有关 Java 中已签名与未签名的[旧答案。](https://stackoverflow.com/questions/397867/port-of-random-generator-from-c-to-java/397997#397997)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-20T08:57:07.307

为什么不编写自己的包装器并在下面使用带符号的 long。如果用户希望将无符号值作为 BigInteger 获取 - 测试符号并将 2^64 添加到 BigInteger。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-20T08:56:00.023

您可以使用 BigInteger.valueOf(l) 从 long 创建 BigInteger，其中 l 是 long。

但是如果你想使用精确的 64 位，我会使用 long。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-20T08:57:56.290

您可能想要创建一个封装 BigInteger 的 UInt64 类；您还可以检查每个操作（add、mul 等）是否返回一个无符号的 64 位 BigInteger；模拟溢出可能很棘手

```
class UInt64 {

    private final BigInteger value;

    private UInt64(BigInteger aValue) {
         // method to enforce your class invariant: 0...2**64-1
         checkInvariantOf(aValue);
         value = aValue; 
    }

    public static UInt64 of(String value) {
         return new UInt64(new BigInteger(value));
    }

    public UInt64 add(UInt64 v) {
         return new UInt64(value.add(v.value));
    }

    ....
} 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2015-08-21T18:59:15.457

在 Java SE 8 及更高版本中，您可以使用 long 数据类型来表示无符号的 64 位 long，其最小值为 0，最大值为 2^64-1。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-20T21:21:18.373

您可以将值 0 到 2^64-1 存储在 long 值中。

许多操作按预期工作，但是大多数 API 和一些操作仅在它们假定签名操作时工作，但是有一些变通方法。

然而，使用 BigInteger 可能更容易理解。;)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-20T08:55:27.497

正如您所发现的，[BigInteger是不可变的。](http://java.sun.com/j2se/1.4.2/docs/api/java/math/BigInteger.html)您可能希望研究对 BigInteger 进行子类化，并编写自己的构造函数来验证输入，并在相关范围内发出正的 BigInteger。

为了保持数字仅使用 64 位的要求，您可能还需要重载各种操作，因此它们会限制结果并返回新类的实例而不是新的 BigInteger。

这可能是相当多的工作，但仍然应该比从头开始做这一切要好得多。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2020-05-22T11:21:01.173

要将 uint64 输入到 a`BigInteger`中，可以使用带有字节数组和符号的构造函数：

```
public static BigInteger bigIntegerFromUInt64(long uint64) {
  if (uint64 < 0) {
    ByteBuffer buffer = ByteBuffer.allocate(Long.BYTES);
    buffer.putLong(uint64);
    byte[] uint64Bytes = buffer.array();

    return new BigInteger(/* signum */ 1, uint64Bytes);
  } else {
    return BigInteger.valueOf(uint64);
  }
} 
```

# asp.net - 在 ASP.NET 中的模块之间共享页面

> ID：767463
> 
> 赞同：0
> 
> 时间：2009-04-20T08:54:23.240
> 
> 标签：asp.net

我正在编写一个 ASP.NET 应用程序，它具有不同的模块（每个模块都有不同的样式和母版页），但是我需要在模块之间共享一些页面。

如何在 ASP.NET 应用程序中的两个不同模块之间共享页面？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-20T09:01:07.937

这可能是将页面的“搜索”组件拉出到用户控件中并向其添加“搜索模式”属性的候选者。

您可以拥有不同的 search_X.aspx 页面，这些页面具有不同的输出/样式/gridview 列等...

并且您可以使用不同的搜索模式在每个不同的搜索页面上定义您的控件

例如

```
<myctl:Search ID="searchCustomers" runat="server" SearchMode="CustomerPurchases" /> 
```

或者

```
<myctl:Search ID="searchCustomers" runat="server" SearchMode="CustomerDetails" /> 
```

然后让您的页面绑定到该控件上的某个事件，该事件返回 SearchClause/DataSource 等以绑定到您的显示列表

# vbscript - 如何通过 VBScript 将图像从剪贴板复制到 Microsoft Word？

> ID：767467
> 
> 赞同：0
> 
> 时间：2009-04-20T08:55:55.937
> 
> 标签：vbscript, ms-word

我正在尝试使用[VBScript](http://en.wikipedia.org/wiki/VBScript)将图像从剪贴板复制到 Microsoft Word 。我怎样才能做到这一点？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-20T09:05:38.813

您在 WSH 环境中吗？或者这是在VBA中？

在 VBA 中，您只需执行`Application.Selection.Paste`.

在 WSH 中：

```
Set wordapp = CreateObject("Word.Application")
wordapp.Visible = True
wordapp.Documents.Add
wordapp.Selection.Paste 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-20T09:09:53.127

我不相信使用 vbscript 可以直接访问剪贴板。但是，您可以非常巧妙地使用 vbscript 来驱动 IE，并使用 IE 为您完成繁重的工作。看看[这个实现](http://www.myitforum.com/articles/11/view.asp?id=523)

# ruby-on-rails - 如何编写 rake 任务来触发 BackgrounDRb 任务？

> ID：767469
> 
> 赞同：1
> 
> 时间：2009-04-20T08:56:00.600
> 
> 标签：ruby-on-rails, ruby, rake, backgroundrb

我有一个 BackgrounDRb 工作人员设置为每 15 分钟运行一次它的“同步”方法。然后，说，我想运行一次刚才的方法。我试图将其包装在 rake 任务中，如下所示：

```
namespace :mytasks do
  task :sync do |t|
    worker = MiddleMan.worker(:my_worker)
    worker.async_sync
  end
end 
```

但这不起作用。它使用各种未定义的常量等等来解决问题。我没有尝试要求杂项。gems 生成了一个可运行的 rake 任务。:(

所以，问题是如何从 rake 任务中触发 BackgrounDRb 任务？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-20T11:19:30.130

我不确定运行 BackroundDRb-tasks 的细节，但是如果你想在你的 rake 任务中包含 rails 环境，你必须明确它。我很确定缺少这一点是导致您的 rake 任务失败的原因。

```
namespace :foo do
  task :bar => :environment do |t|
    # ..
  end
end 
```

# asp.net - 将部分页面属性移动到 View 而没有后面的代码

> ID：767476
> 
> 赞同：0
> 
> 时间：2009-04-20T08:59:36.503
> 
> 标签：asp.net, asp.net-mvc, code-behind

我正在重构一个使用以前版本的 Asp.Net MVC 构建的 Web 应用程序，其中所有视图每个都有 2 个代码隐藏文件。

此外，如果视图正常工作，我想开始删除文件后面的所有代码，因为它们中的大多数都是空的。

在代码隐藏中很少有这样的属性：

```
public partial class List {
    public Message NewMessage { get { return new Message(); } }
} 
```

在完全删除它们之前（我知道这种方法与视图无关）如何在单页 aspx 或 ascx 中复制它们？
我只是尝试在 <% %> 标记中复制和粘贴公共方法，但这不起作用。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-20T09:17:11.017

请问您为什么首先使用这种方法？我认为你可以通过使你的`View`强类型来实现同样的事情，并将消息作为`View`'s传递`Model`。

```
Inherits="System.Web.Mvc.View<Message>" 
```

如果您已经有一个强类型`View`，您可以在您的类库中创建一个自定义类，以便为您的消息留出空间，例如

```
public class ModelWithMessage  {
    public Message Message { get; set; }
    public Object Model { get; set; }
    public ModelWithMessage(Message Message, Object Model) {
        this.Message = Message;
        this.Model = Model;
    }
} 
```

当然，您也可以使该类型成为通用类型，允许`ModelWithMessage<T>`构造并避免将其强制`Model`转换为您需要的任何类型。

另一种方法是使用`TempData`. 在您的控制器中，设置

```
TempData["Message"] = "Hello world!"; 
```

然后在您中，`View`您只需使用

```
<%= TempData["Message"] %> 
```

您选择哪种方法取决于您的 Message 类包含的内容。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-20T09:18:23.527

你几乎已经为自己回答了这个问题，因为你说'我知道这种方法与视图无关':)

首先，我会将这些方法移出控制器类并在模型中传递任何所需的数据（假设这是它们的合适位置），然后当您从代码隐藏文件中删除所有功能并再次进行干净分离时，您可以从视图中删除代码隐藏文件。

# c++ - 静态成员函数的模板特化；如何？

> ID：767477
> 
> 赞同：14
> 
> 时间：2009-04-20T09:00:10.403
> 
> 标签：c++, templates, boost

我正在尝试使用模板专业化来实现一个具有不同句柄 void 的模板函数。

以下代码在 gcc 中为我提供了“非命名空间范围内的显式专业化”：

```
template <typename T>
static T safeGuiCall(boost::function<T ()> _f)
{
    if (_f.empty())
        throw GuiException("Function pointer empty");
    {
        ThreadGuard g;
        T ret = _f();
        return ret;
    }
}

// template specialization for functions wit no return value
template <>
static void safeGuiCall<void>(boost::function<void ()> _f)
{
    if (_f.empty())
        throw GuiException("Function pointer empty");
    {
        ThreadGuard g;
        _f();
    }
} 
```

我尝试将其移出类（类未模板化）并移入命名空间，但随后出现错误“显式专业化不能具有存储类”。我已经阅读了很多关于此的讨论，但人们似乎不同意如何专门化功能模板。有任何想法吗？

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-04-20T09:56:33.667

当你专门化一个模板化方法时，你必须在类括号之外这样做：

```
template <typename X> struct Test {}; // to simulate type dependency

struct X // class declaration: only generic
{
   template <typename T>
   static void f( Test<T> );
};

// template definition:
template <typename T>
void X::f( Test<T> ) {
   std::cout << "generic" << std::endl;
}
template <>
inline void X::f<void>( Test<void> ) {
   std::cout << "specific" << std::endl;
}

int main()
{
   Test<int> ti;
   Test<void> tv;
   X::f( ti ); // prints 'generic'
   X::f( tv ); // prints 'specific'
} 
```

当你把它带到课堂之外时，你必须删除'static'关键字。类之外的静态关键字具有与您可能想要的不同的特定含义。

```
template <typename X> struct Test {}; // to simulate type dependency

template <typename T>
void f( Test<T> ) {
   std::cout << "generic" << std::endl;
}
template <>
void f<void>( Test<void> ) {
   std::cout << "specific" << std::endl;
}

int main()
{
   Test<int> ti;
   Test<void> tv;
   f( ti ); // prints 'generic'
   f( tv ); // prints 'specific'
} 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-20T09:42:30.613

这不是你问题的直接答案，但你可以写这个

```
template <typename T>
static T safeGuiCall(boost::function<T ()> _f)
{
        if (_f.empty())
                throw GuiException("Function pointer empty");
        {
                ThreadGuard g;
                return _f();
        }
} 
```

即使 _f() 返回 'void' 它也应该工作

编辑：在更一般的情况下，我认为我们应该更喜欢函数重载而不是专业化。这是一个很好的解释：[http ://www.gotw.ca/publications/mill17.htm](http://www.gotw.ca/publications/mill17.htm)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-20T09:13:38.170

您可以以与在其类之外定义成员函数相同的方式声明显式特化：

```
class A
{
public:
  template <typename T>
  static void foo () {}
};

template <>
void A::foo<void> ()
{
} 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-20T09:25:20.827

您的问题似乎与 boost::function 有关-以下专业化有效：

```
template <typename T>
T safeGuiCall()
{
    return T();
}

template <>
void safeGuiCall<void>()
{
}

int main() {
    int x = safeGuiCall<int>();     // ok
    //int z = safeGuiCall<void>();  // this should & does fail
    safeGuiCall<void>();            // ok
} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-11-30T19:15:40.177

我有一个类似的问题。如果您查看原始帖子，我将第一个静态保留在其中，但取出了第二个，两个错误都消失了。

# ios - iPhone UITableView 在重用 UITableViewCell 时按下删除按钮后缺少公开按钮

> ID：767482
> 
> 赞同：3
> 
> 时间：2009-04-20T09:01:22.303
> 
> 标签：ios, objective-c, iphone, uitableview

我有一个 iPhone`UITableView`显示自定义`UITableViewCell`s，显示在其右侧的公开按钮图标。
当我滑动单元格时，显示按钮会自动替换为红色的“删除”按钮。如果我按下“删除”按钮，该行将从表中删除，但随后会发生一些奇怪的事情。
当我滚动表格并**重新使用**已删除的单元格时，数据已正确加载，但**缺少披露按钮**。

我试图在`prepareForReuse`方法中重置按钮但没有成功。

我不明白我错过了什么，因为邮件应用程序的行为似乎相同，所以它应该由 iPhone OS 原生支持。

顺便说一句：`UITableViewCell`从NIB加载。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-20T21:31:18.867

看来我已经通过添加解决了这个问题

```
- (UITableViewCell *)tableView:(UITableView *)tableView cellForRowAtIndexPath:(NSIndexPath *)indexPath 
```

这行代码：

```
[cell setAccessoryType:UITableViewCellAccessoryDetailDisclosureButton]; 
```

我认为这条线对正常单元格没有用，但在删除后重新使用的单元格恢复正确的单元格行为......

无论如何要删除我使用的行

```
- (void)tableView:(UITableView *)tableView commitEditingStyle:(UITableViewCellEditingStyle)editingStyle forRowAtIndexPath:(NSIndexPath *)indexPath 
```

这个（我猜）标准行：

```
 [tableView deleteRowsAtIndexPaths:[NSArray arrayWithObject:indexPath] withRowAnimation:YES]; 
```

谢谢斯特凡诺

# javascript - 如何检查一个变量是否是 JavaScript 中的一个数组？

> ID：767486
> 
> 赞同：1946
> 
> 时间：2009-04-20T09:02:59.553
> 
> 标签：javascript, arrays, list, variables

我想检查一个变量是 JavaScript 中的数组还是单个值。

我找到了一个可能的解决方案......

```
if (variable.constructor == Array)... 
```

这是最好的方法吗？

* * *

## 回答 #1

> 赞同：1838
> 
> 时间：2014-10-29T15:07:05.927

有几种方法可以检查变量是否为数组。最好的解决方案是您选择的解决方案。

```
variable.constructor === Array 
```

这是 Chrome 上最快的方法，很可能是所有其他浏览器。所有数组都是对象，因此检查构造函数属性对于 JavaScript 引擎来说是一个快速的过程。

如果您在确定对象属性是否为数组时遇到问题，则必须首先检查该属性是否存在。

```
variable.prop && variable.prop.constructor === Array 
```

其他一些方法是：

```
Array.isArray(variable) 
```

**使用 Chrome 75 于 2019 年 5 月 23 日更新，向@AnduAndrici 大声喊叫，让我带着他的问题重新审视这个问题** 。在我看来，最后一个是最丑陋的，也是~~最慢~~的速度之一。~~运行速度约为第一个示例的 1/5。~~这家伙慢了大约 2-5%，但很难说。扎实好用！结果给我留下了深刻的印象。Array.prototype，其实就是一个数组。你可以在这里阅读更多关于它的信息[https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/isArray](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/isArray)

```
variable instanceof Array 
```

此方法运行速度约为第一个示例的~~1/3 。~~如果您只关注漂亮的代码而不是性能，那么仍然非常可靠，看起来更干净。请注意，检查数字并不像`variable instanceof Number`往常一样返回`false`。**更新：`instanceof`现在速度提高了 2/3！**

**所以又一次更新**

```
Object.prototype.toString.call(variable) === '[object Array]'; 
```

这家伙是尝试检查阵列最慢的。但是，这是您正在寻找的任何类型的一站式商店。但是，由于您要查找数组，因此只需使用上述最快的方法。

另外，我进行了一些测试：http: [//jsperf.com/instanceof-array-vs-array-isarray/35](http://jsperf.com/instanceof-array-vs-array-isarray/35)所以玩得开心并检查一下。

注意：@EscapeNetscape 在 jsperf.com 关闭时创建了另一个测试。[http://jsben.ch/#/QgYAV](http://jsben.ch/#/QgYAV)我想确保原始链接在 jsperf 重新上线时保持不变。

* * *

## 回答 #2

> 赞同：1106
> 
> 时间：2009-04-20T09:05:46.457

您还可以使用：

```
if (value instanceof Array) {
  alert('value is Array!');
} else {
  alert('Not an array');
} 
```

在我看来，这似乎是一个非常优雅的解决方案，但对每个人来说都是他自己的。

编辑：

从 ES5 开始，现在还有：

```
Array.isArray(value); 
```

但这会在较旧的浏览器上中断，除非您使用的是 polyfills（基本上...... IE8 或类似的）。

* * *

## 回答 #3

> 赞同：80
> 
> 时间：2009-04-20T09:08:08.263

有多种解决方案都有自己的怪癖。[此页面](http://perfectionkills.com/instanceof-considered-harmful-or-how-to-write-a-robust-isarray/)提供了一个很好的概述。一种可能的解决方案是：

```
function isArray(o) {
  return Object.prototype.toString.call(o) === '[object Array]'; 
} 
```

* * *

## 回答 #4

> 赞同：76
> 
> 时间：2009-04-20T10:10:35.087

我注意到有人提到了 jQuery，但我不知道有一个[`isArray()`](http://api.jquery.com/jQuery.isArray/)函数。原来它是在 1.3 版中添加的。

jQuery 按照 Peter 的建议实现了它：

```
isArray: function( obj ) {
    return toString.call(obj) === "[object Array]";
}, 
```

已经对 jQuery 充满信心（尤其是他们的跨浏览器兼容性技术），我要么升级到 1.3 版并使用它们的功能（前提是升级不会导致太多问题），要么直接在我的代码。

非常感谢您的建议。

* * *

## 回答 #5

> 赞同：76
> 
> 时间：2014-01-08T07:37:32.327

在现代浏览器（和一些旧版浏览器）中，您可以这样做

```
Array.isArray(obj) 
```

（Chrome 5、Firefox 4.0、IE 9、Opera 10.5 和 Safari 5[支持）](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/isArray)

如果需要支持老版本的IE，可以使用[es5-shim](https://github.com/es-shims/es5-shim) polyfill Array.isArray；或添加以下内容

```
# only implement if no native implementation is available
if (typeof Array.isArray === 'undefined') {
  Array.isArray = function(obj) {
    return Object.prototype.toString.call(obj) === '[object Array]';
  }
}; 
```

如果你使用 jQuery，你可以使用`jQuery.isArray(obj)`or `$.isArray(obj)`。如果你使用下划线，你可以使用`_.isArray(obj)`

如果您不需要检测在不同帧中创建的数组，您也可以使用`instanceof`

```
obj instanceof Array 
```

* * *

**注意**：`arguments`可用于访问函数参数的关键字不是数组，即使它（通常）表现得像一个：

```
var func = function() {
  console.log(arguments)        // [1, 2, 3]
  console.log(arguments.length) // 3
  console.log(Array.isArray(arguments)) // false !!!
  console.log(arguments.slice)  // undefined (Array.prototype methods not available)
  console.log([3,4,5].slice)    // function slice() { [native code] } 
}
func(1, 2, 3)
```

* * *

## 回答 #6

> 赞同：54
> 
> 时间：2011-10-24T21:12:50.357

这是一个老问题，但遇到同样的问题，我找到了一个非常优雅的解决方案，我想分享。

向 Array 添加原型使其非常简单

```
Array.prototype.isArray = true; 
```

现在，如果您有一个要测试的对象，看看它是否是一个数组，您只需要检查新属性

```
var box = doSomething();

if (box.isArray) {
    // do something
} 
```

isArray 仅在其为数组时可用

* * *

## 回答 #7

> 赞同：47
> 
> 时间：2009-04-20T09:07:33.147

通过[克罗克福德](http://javascript.crockford.com/remedial.html)：

```
function typeOf(value) {
    var s = typeof value;
    if (s === 'object') {
        if (value) {
            if (value instanceof Array) {
                s = 'array';
            }
        } else {
            s = 'null';
        }
    }
    return s;
} 
```

Crockford 提到的主要失败是无法正确确定在不同上下文中创建的数组，例如`window`. 如果这还不够，该页面有一个更复杂的版本。

* * *

## 回答 #8

> 赞同：31
> 
> 时间：2013-07-11T14:05:20.773

如果您只处理 EcmaScript 5 及更高版本，那么您可以使用内置`Array.isArray`函数

例如，

```
Array.isArray([])    // true
Array.isArray("foo") // false
Array.isArray({})    // false 
```

* * *

## 回答 #9

> 赞同：28
> 
> 时间：2011-12-03T03:17:16.313

我个人喜欢 Peter 的建议：[https](https://stackoverflow.com/a/767499/414784) ://stackoverflow.com/a/767499/414784 （对于 ECMAScript 3。对于 ECMAScript 5，请使用`Array.isArray()`）

然而，对帖子的评论表明，如果`toString()`完全改变，那么检查数组的方式将会失败。如果您真的想具体并确保`toString()`没有更改，并且对象类属性没有问题（`[object Array]`是数组对象的类属性），那么我建议您执行以下操作：

```
//see if toString returns proper class attributes of objects that are arrays
//returns -1 if it fails test
//returns true if it passes test and it's an array
//returns false if it passes test and it's not an array
function is_array(o)
{
    // make sure an array has a class attribute of [object Array]
    var check_class = Object.prototype.toString.call([]);
    if(check_class === '[object Array]')
    {
        // test passed, now check
        return Object.prototype.toString.call(o) === '[object Array]';
    }
    else
    {
        // may want to change return value to something more desirable
        return -1; 
    }
} 
```

请注意，在 JavaScript The Definitive Guide 6th edition, 7.10 中，它说`Array.isArray()`是使用`Object.prototype.toString.call()`ECMAScript 5 实现的。另外请注意，如果您要担心`toString()`实现更改，您还应该担心所有其他内置方法也会更改。为什么使用`push()`？有人可以改变它！这样的做法是愚蠢的。上述检查是为那些担心`toString()`改变的人提供的解决方案，但我认为检查是不必要的。

* * *

## 回答 #10

> 赞同：20
> 
> 时间：2011-08-08T14:42:10.160

当我发布这个问题时，我使用的 JQuery 版本不包含`isArray`函数。如果有的话，我可能会使用它，相信该实现是执行此特定类型检查的最佳独立于浏览器的方式。

由于 JQuery 现在确实提供了这个功能，所以我会一直使用它......

```
$.isArray(obj); 
```

（从 1.6.2 版开始）它仍然使用形式的字符串比较来实现

```
toString.call(obj) === "[object Array]" 
```

* * *

## 回答 #11

> 赞同：17
> 
> 时间：2012-03-16T07:50:57.337

我想我会为那些可能已经在他们的脚本中使用 Underscore.js 库的人添加另一个选项。Underscore.js 有一个 isArray() 函数（参见[http://underscorejs.org/#isArray](http://underscorejs.org/#isArray)）。

```
_.isArray(object) 
```

> 如果 object 是一个数组，则返回 true。

* * *

## 回答 #12

> 赞同：11
> 
> 时间：2014-03-19T08:40:02.210

如果你使用 Angular，你可以使用 angular.isArray() 函数

```
var myArray = [];
angular.isArray(myArray); // returns true

var myObj = {};
angular.isArray(myObj); //returns false 
```

[http://docs.angularjs.org/api/ng/function/angular.isArray](http://docs.angularjs.org/api/ng/function/angular.isArray)

* * *

## 回答 #13

> 赞同：9
> 
> 时间：2013-12-03T03:44:26.310

在 Crockford 的[JavaScript The Good Parts](http://shop.oreilly.com/product/9780596517748.do)中，有一个函数可以检查给定参数是否为数组：

```
var is_array = function (value) {
    return value &&
        typeof value === 'object' &&
        typeof value.length === 'number' &&
        typeof value.splice === 'function' &&
        !(value.propertyIsEnumerable('length'));
}; 
```

他解释说：

> 首先，我们询问该值是否真实。我们这样做是为了拒绝 null 和其他虚假值。其次，我们询问 typeof 值是否为 'object'。对于对象、数组和（奇怪的）空值，这将是正确的。第三，我们询问该值是否具有一个数字的长度属性。这对于数组总是如此，但通常不适用于对象。第四，我们询问该值是否包含拼接方法。这对于所有阵列都是如此。最后，我们询问长度属性是否是可枚举的（长度是否会由 for in 循环产生？）。这对于所有数组都是错误的。这是我发现的最可靠的阵列测试。不幸的是，它是如此复杂。

* * *

## 回答 #14

> 赞同：5
> 
> 时间：2015-01-11T14:17:49.913

通用解决方案如下：

```
Object.prototype.toString.call(obj)=='[object Array]' 
```

从 ECMAScript 5 开始，正式的解决方案是：

```
Array.isArray(arr) 
```

此外，对于旧的 JavaScript 库，您可以找到以下解决方案，尽管它不够准确：

```
var is_array = function (value) {
    return value &&
    typeof value === 'object' &&
    typeof value.length === 'number' &&
    typeof value.splice === 'function' &&
    !(value.propertyIsEnumerable('length'));
}; 
```

解决方案来自[http://www.pixelstech.net/topic/85-How-to-check-whether-an-object-is-an-array-or-not-in-JavaScript](http://www.pixelstech.net/topic/85-How-to-check-whether-an-object-is-an-array-or-not-in-JavaScript)

* * *

## 回答 #15

> 赞同：3
> 
> 时间：2011-05-26T13:08:17.980

[从https://github.com/miksago/Evan.js/blob/master/src/evan.js](https://github.com/miksago/Evan.js/blob/master/src/evan.js)引用的代码

```
 var isArray = Array.isArray || function(obj) {
    return !!(obj && obj.concat && obj.unshift && !obj.callee);}; 
```

* * *

## 回答 #16

> 赞同：3
> 
> 时间：2013-01-06T08:01:24.577

我正在使用这行代码：

```
if (variable.push) {
   // variable is array, since AMAIK only arrays have push() method.
} 
```

* * *

## 回答 #17

> 赞同：3
> 
> 时间：2013-10-24T18:43:37.273

对于那些打代码的人来说，一个字符最少的不可靠测试：

```
function isArray(a) {
  return a.map;
} 
```

这在遍历/展平层次结构时通常使用：

```
function golf(a) {
  return a.map?[].concat.apply([],a.map(golf)):a;
}

input: [1,2,[3,4,[5],6],[7,[8,[9]]]]
output: [1, 2, 3, 4, 5, 6, 7, 8, 9] 
```

* * *

## 回答 #18

> 赞同：2
> 
> 时间：2015-03-29T13:07:14.130

来自[w3schools](http://www.w3schools.com/js/js_arrays.asp)：

```
function isArray(myArray) {
    return myArray.constructor.toString().indexOf("Array") > -1;
} 
```

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2013-04-20T17:17:31.800

我喜欢布赖恩的回答：

```
function is_array(o){
    // make sure an array has a class attribute of [object Array]
    var check_class = Object.prototype.toString.call([]);
    if(check_class === '[object Array]')    {
        // test passed, now check
        return Object.prototype.toString.call(o) === '[object Array]';
    } else{
        // may want to change return value to something more desirable
        return -1; 
    }
} 
```

但你可以这样做：

```
return Object.prototype.toString.call(o) === Object.prototype.toString.call([]); 
```

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2014-07-28T09:32:11.927

我创建了一小段代码，它可以返回真正的类型。

我还不确定性能，但这是正确识别 typeof 的尝试。

[https://github.com/valtido/better-typeOf](https://github.com/valtido/better-typeOf)也在这里写了一些博客[http://www.jqui.net/jquery/better-typeof-than-the-javascript-native-typeof/](http://www.jqui.net/jquery/better-typeof-than-the-javascript-native-typeof/)

它的工作原理类似于当前的 typeof。

```
var user = [1,2,3]
typeOf(user); //[object Array] 
```

它认为它可能需要一些微调，并考虑到一些事情，我没有遇到或正确测试它。因此欢迎进一步改进，无论是性能方面的，还是错误地重新报告 typeOf。

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2014-08-24T20:32:16.587

我认为使用 myObj.constructor==Object 和 myArray.constructor==Array 是最好的方法。它比使用 toString() 快近 20 倍。如果您使用自己的构造函数扩展对象并希望这些创建也被视为“对象”，那么这不起作用，但否则它会更快。typeof 与构造函数方法一样快，但 typeof []=='object' 返回 true，这通常是不可取的。 [http://jsperf.com/constructor-vs-tostring](http://jsperf.com/constructor-vs-tostring)

需要注意的一点是 null.constructor 会抛出一个错误，所以如果你可能要检查空值，你必须首先执行 if(testThing!==null){}

* * *

## 回答 #22

> 赞同：-1
> 
> 时间：2022-02-08T20:44:24.933

使用`Array.isArray()`which 确定传递的值是否为 Array

```
const someArr = [1,2,3];
console.log(Array.isArray(someArr)); // true

const obj = { name: "John" };
console.log(Array.isArray(obj)); // false

const str = "hello";
console.log(Array.isArray(str)); // false

let x;
console.log(Array.isArray(x)); // false
```

更多关于`Array.isArray()`可以在[这里找到](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/isArray)

* * *

## 回答 #23

> 赞同：-7
> 
> 时间：2014-03-02T18:01:53.770

由于 .length 属性对于 javascript 中的数组是特殊的，因此您可以简单地说

```
obj.length === +obj.length // true if obj is an array 
```

Underscorejs 和其他几个库使用这个简短而简单的技巧。

* * *

## 回答 #24

> 赞同：-21
> 
> 时间：2015-02-12T23:01:13.750

我刚想出的东西：

`if (item.length) //This is an array else //not an array`

# wcf - 类型化数据集和 Dtos

> ID：767488
> 
> 赞同：1
> 
> 时间：2009-04-20T09:04:04.433
> 
> 标签：wcf, dataset, dto

我有一个连接到 WCF 服务以实现其业务逻辑的 Web 应用程序。出于性能和互操作性的原因，我想使用简单的 Dto 在 WCF 边界传输数据。

但是，我必须使用类型化的数据集进行数据访问（由于政治原因，ORM 或任何其他选项不可用）。

将 Dto 与类型化数据集一起使用是个好主意吗？有人做过吗？有推荐的模式吗？最重要的是，是否有一个库/工具/方法可以从类型化的数据集中自动生成 Dto？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-09T21:56:39.760

我想到了实体翻译模式。 [http://msdn.microsoft.com/en-us/library/cc304747.aspx](http://msdn.microsoft.com/en-us/library/cc304747.aspx) 好吧，也许是它的变体。[](http://msdn.microsoft.com/en-us/library/cc304747.aspx)

最近我不得不做一些类似的事情，我刚刚创建了另一个“层”，它将存储在数据行/数据表等中的数据转换为数据合同对象。服务层可以使用您的数据访问方法的结果作为参数调用这个新的层方法。

这是一个快速而肮脏的 PSUEDOCODE 示例：

```
 public class personTranslator
 {

     public static PersonDataContract TranslateToContract(Datarow personDataRow)
    {
        PersonDataContract resultPerson = new Person;
        resultPerson.FirstName = personDataRow["FirstName"];
        resultPerson.LastName = personDataRow["LastName"];
        .
        .
        [etc.]

        return resultPerson;
    }
 } 
```

服务层类

```
 public PersonDataContract GetSpecificPerson([Parameters])
 {
     [other setup/validation code...]
    return   PersonTranslator.TranslateToContract(PersonDataAccess.GetPersonRow([Parameters]));
 } 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-20T09:28:06.780

I would suggest to use typed DataRow-s, DataTable-s. There's really not much difference between a typed DataRow and a Dto object. Performance wise you have to test it that plain Dto-s will help (I doubt it). As for interoperability, typed DataRow-s are plain classes, so they are as interoperable as Dto objects.

# .net - 在树视图中动态编辑节点标签

> ID：767489
> 
> 赞同：1
> 
> 时间：2009-04-20T09:04:58.130
> 
> 标签：.net

我有一个树视图控件。我只希望用户单独为某些指定节点编辑节点的文本。

在树视图控件中，我有 labelit 属性，它使树中所有节点的文本都可编辑，但我只希望相应的节点文本可编辑。

就像是

treeview1.nodes[1].edit=true.......

无论如何要做...

提前致谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-20T09:12:48.423

最好的办法是在 TreeView 上将 LabelEdit 设置为 true，但在用户尝试编辑节点时捕获[BeforeLabelEdit事件并将 e.CancelEdit 设置为 true，除非您允许它。](http://msdn.microsoft.com/en-us/library/system.windows.forms.treeview.beforelabeledit.aspx)

要以编程方式在节点上启动编辑，可以使用[TreeNode.BeginEdit()](http://msdn.microsoft.com/en-us/library/system.windows.forms.treenode.beginedit.aspx)。

# windows-services - Windows 服务或计划任务，我们更喜欢哪一个？

> ID：767490
> 
> 赞同：19
> 
> 时间：2009-04-20T09:05:37.877
> 
> 标签：windows-services, scheduled-tasks

如果我们需要编写一个周期性工作的程序，我们更喜欢哪种方式？编写 Windows 服务或编写作为计划任务工作的控制台应用程序？

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-04-20T09:23:02.237

如果可以的话，我建议将该过程作为计划任务运行，并且仅在需要时才编写服务。服务（正确地）编写起来要困难得多，如果您按照任何类型的时间表运行进程，那么使用 Windows 调度程序比尝试构建自己的调度程序要好得多（在服务）。

*   windows任务调度器比你自制的调度器效率更高
*   Windows 任务计划程序提供了许多您几乎肯定不会尝试复制的选项，但稍后可能会发现它们很有用
*   如果您构建一个服务，如果您想更改确定在什么条件下运行任务的逻辑，则必须重新编译程序。如果您使用调度程序，您只需翻转一些选项并完成它。

如果您试图在两者之间做出决定，那么显然使用任务计划程序是一个可行的选择。如果使用任务计划程序是一个可行的选择，那么构建服务几乎肯定是错误的选择。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-04-20T09:08:37.713

取决于您需要它运行的规律性。

如果它需要每天每 60 秒运行一次，我会选择 Windows 服务。

如果它每天只需要运行一次，我会选择计划任务

中间的任何东西......使用你的判断:)

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-04-20T10:58:53.613

从控制台应用程序开始。将位于循环-进程-睡眠循环内的逻辑分开，然后您实际上可以轻松地在它们之间切换 - 即使在同一个 EXE 中也是如此。

我已经做到了。我们可以调用：

ourservice.exe - 控制台

它会运行。或者

ourservice.exe -安装

它将作为服务安装:)

我会在 99% 的情况下执行预定任务。如果您需要一直运行，请侦听端口，查看文件夹（也许 - 可以每 10 秒完成一次，没有问题）：然后在服务中执行。如果你所做的只是唤醒，做一些处理（或不做），然后回到睡眠：使用调度程序。它更容易、更干净（内存管理，特别是如果你使用 COM 对象，如果你使用 MAPI 则真的），并且使用 MS 调度程序的选项（每周，但不是在星期二下午 5 点）比你可以在时间.....这不是时间，因为它已经存在并且是免费的

哦，调试控制台应用程序（调度程序）比调试服务更容易...... :) 或者让某人“运行它”。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-04-20T09:16:59.160

如果它真的是“定期”，那么我会选择计划任务。这些可以设置为以任何所需的频率运行。

服务（根据我的经验）更多地用于必须响应基本上随机事件的程序，例如通过 FTP 到达的文件，或者必须监视文件系统或数据库状态的程序。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-20T10:35:47.740

或者，如果您想要定期运行某些东西，请查看[quartz.net 。](http://quartznet.sourceforge.net/)它是一个预构建的框架，允许您安排任务并节省您自己编写服务部分的时间。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-04-20T10:43:13.603

避免使用服务，除非您必须使用它。

这是一个过程——这意味着它*一直在*运行。无故使用系统资源是不好的做法。

我个人认为其他人在我的计算机上 24/7 全天候执行他们的进程是很侮辱的，而这是完全没有必要的。他们用完了我的表现。我禁用了所有不必要的后台服务。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-10-21T20:29:15.990

如果您想使用 WCF 或 .NET Remoting 并让客户端应用程序与某些主机服务通信，我认为服务可能会很有用；否则我同意，如果更复杂的服务没有添加任何新内容，则计划任务比服务更可取。

而@Tom，他关于必须保持登录到计算机才能运行计划任务的说法是错误的。我刚刚测试了自己，并确认即使您没有登录，Windows 计划任务仍然会运行（当然，除非您选择任务仅在您登录时运行的选项）。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-04-20T09:09:36.277

这取决于你的意思是定期？每一秒，每一分钟，每一小时，每一天？

我想说任务运行得越频繁，Windows 服务就越受欢迎。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-04-20T09:11:43.853

“这取决于”，但为了简单起见，我通常更喜欢计划任务：

*   您不需要向您的程序添加任何样板服务代码。
*   您的程序可以从命令行运行以进行故障排除（您必须在服务程序中使用命令行开关来完成此操作）。

如果这或多或少是一次性的，并且您将自己安装和控制，那么计划任务可能是一个好主意。

对于应该具有成品感觉并且客户应该自己安装的东西，我会选择 Windows 服务。

时间表也是一个问题。计划任务的最短计划是一分钟。低于此值的任何内容，您要么需要使用 Windows 服务，要么在您的工作中构建一个循环。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-06-18T18:45:39.070

我认为这还取决于您是否可以让计算机保持登录状态。我发现除非设置任务的人登录，否则 Windows 计划任务无法运行。如果计算机无法保持登录状态，则程序必须作为服务计划任务运行。

# vb.net - 如何查询未订购某款产品的日期范围？(LINQ)

> ID：767503
> 
> 赞同：1
> 
> 时间：2009-04-20T09:09:58.693
> 
> 标签：vb.net, linq, linq-to-sql

我有三张桌子，

*   产品（ProductID、ProductName）
*   订单（OrderID、OrderDate）
*   OrderDetails(ProductID, OrderID) 产品和订单之间的连接表。

例如Products表A01、A02、A03中有3个ProductID

Orders 表中的四个 OrderID 1\. 01/01/2009、2\. 03/01/2009、3\. 05/01/2009、4\. 07/01/2009。

OrderDetails 数据如下：

A01 -- 01/01/2009

A02 -- 01/01/2009

A01 -- 03/01/2009

A02 -- 03/01/2009

A01 -- 05/01/2009

A03 -- 05/01/2009

A01 -- 07/01/2009

然后我想显示从 02/01/2009 到 08/01/2009 范围内未订购 A03 的日期，这可能会产生这样的结果。

**日期范围为 02/01/2009 至 08/01/2009 的产品 A03 的**DateMissingOrder ：****

 **2009 年 3 月 1 日

2009 年 7 月 1 日

如何在 LINQ to SQL Visual Basic 中执行此操作？请有人帮助我一些线索..在此先感谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-20T09:51:48.437

尝试这样的事情：

**选择范围内的所有日期**

```
Dim DatesInRange = (From o in dc.Orders _
                   Where (o.OrderDate >= StartDate and _
                          o.OrderDate <= EndDate)
                   Select o.OrderDate).Distinct 
```

**选择 A03 订单范围内的所有日期**

```
Dim Dates = (From o in dc.OrdersDetails _
            Where (o.Order.OrderDate >= StartDate and _
                   o.Order.OrderDate <= EndDate) and _
                   o.Order.Product.ProductName = "A03" _
            Select o.Order.OrderDate).Distinct 
```

**返回第二个列表中缺少的日期**

```
Dim MissingDates = DatesInRange.Except(Dates) 
```

# matlab - 欧拉计划 214，如何提高效率？

> ID：767512
> 
> 赞同：5
> 
> 时间：2009-04-20T09:12:13.073
> 
> 标签：matlab

我越来越沉迷于 Project Euler 问题。但是，自从一周以来，我一直坚持使用[#214](http://projecteuler.net/index.php?section=problems&id=214)。

这是问题的一个简短版本： PHI() 是欧拉的总函数，即对于任何给定的整数 n，PHI(n)=k<=n 的个数，其中 gcd(k,n)=1。

我们可以迭代 PHI() 来创建一个链。例如从 18 开始：

> PHI(18)=6 => PHI(6)=2 => PHI(2)=1。

所以从 18 开始，我们得到一个长度为 4 (18,6,2,1) 的链

问题是计算所有小于 40e6 的素数之和，这些素数生成长度为 25 的链。

我构建了一个计算任何数字的链长的函数，并测试了它的
小值：它运行良好且快速。
所有素数的总和<=20，生成长度为 4 的链：12
所有素数的总和<=1000，生成长度为 10 的链：39383

不幸的是，我的算法不能很好地扩展。当我把它应用到这个问题上时，需要几个小时来计算......所以我停止了它，因为 Project Euler 问题必须在不到一分钟的时间内解决。

我认为我的素数检测功能可能很慢，所以我给程序提供了一个 <40e6 的素数列表以避免素数测试......现在代码运行得更快了，但仍然没有办法得到解决方案不到几个小时（我不想要这个）。

那么我在这里缺少什么“魔术”吗？我真的不明白如何在这个方面更有效率......

我不是在寻求解决方案，因为与优化作斗争是 Project Euler 的全部乐趣。但是，任何可以让我走上正轨的小提示都会受到欢迎。

谢谢 ！

* * *

抱歉，评论的格式错误，我无法删除它。所以这里又是：

要计算 totient 函数，我使用以下方法： 对于给定的 n，我们将 p 称为它的因子列表。
phi(n)=n*prod((p-1)/p)

例如：2,3 是 18 的因数 => phi(18) = 18 * 1/2 * 2/3 = 6

所以以这种方式我不计算任何gcd。给我因素的函数是在 MATLAB 中构建的（是的，我忘了提到我在 Matlab 中编码）。也许我应该重写分解函数......

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-20T09:26:39.620

我会大胆猜测，耗时的部分是计算数字的总和。

一种想法可能是尝试以某种巧妙的方式生成这些。想想是否有可能一次计算它们，而不是一次计算一个数字......

另外，你是如何计算totient函数的？定义（整数 k 的数量，其中 gcd(n,k)==1）不是使用它的有用方法。查一下，看看能不能找到更合适的配方。

编辑：是的，这就是我所追求的表达方式。但是遍历每个整数，将其分解，然后计算 totient 太慢了。寻找一种在不进行任何因式分解的情况下计算 totients 的方法......

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-21T14:04:09.040

尝试倒退...（从 1、2 等开始，然后按自己的方式向上工作，而不是试图倒退并链接成链）

编辑：还请注意，totient(x) 具有[特定的结构](http://en.wikipedia.org/wiki/Euler%27s_totient_function)，即 totient(x) = x * (1-(1/p)) 的乘积，其中 p 是除 x 的不同质因数。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-21T21:55:01.170

**提示**：

1.  **使用记忆**，不要计算`phi(n)`超过一次。

2.  **`phi()`**在计算 phi(N) 时，**尝试使用****您已经为较小的 n 计算的值。**像`phi(m*n) = phi(m) * phi(n)` [应该`m`并且`n`拥有什么属性来保持这个属性？]

3.  **你知道`phi(p)`当 p 是素数时是**什么吗？

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-20T09:19:39.793

我还没有解决它，但我认为你的缓存方案可能在正确的轨道上，你可能没有缓存正确的东西。希望这对您来说不是太多或太模糊的“提示”。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-20T09:28:31.380

好吧，我不熟悉它，你也没有表现出你在做什么......但是一些想法：

*   简化gcd；你不需要知道答案——只要知道是否有*任何公*因数——所以分解较小的数字（从素数列表中）并根据较大的数字测试每个项

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-20T09:41:20.803

要意识到的一件事是，例如，一旦达到 6，则链的其余部分始终是 2,1。

# c# - 在 c# (wpf) 中捕获 windows 键

> ID：767513
> 
> 赞同：6
> 
> 时间：2009-04-20T09:12:30.343
> 
> 标签：c#, wpf, keyboard

我编写了一个小程序，在按下任何按钮时在屏幕上显示声音和图像。当我的一个小孩爬到我的腿上并开始敲击按键时，我总是开始它，当然，随机的。

它工作正常，除了 2 个键，其中一个是 ON/OFF 开关，另一个是 Windows 键。（我相信CTRL-ESC等价物）我可以在按下它时拦截它，但只有在开始菜单显示之后。

我使用的事件是 UIElement.KeyDown ，到目前为止我所能想到的是：（e 是 KeyEventArgs）

```
 if (e.Key == Key.LWin) e.Handled = true; 
```

但恐怕比开始窗口已经显示了。

我已经有 1 个答案，但非常想知道是否有任何 wpf 支持？

我怀疑可能无法对主开关进行编程？否则，也欢迎任何帮助..

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-04-20T09:19:46.393

你需要一个[键盘挂钩](https://github.com/shanselman/babysmash/blob/master/KeyboardHook.cs)。不幸的是，这必须通过 P/Invoke 来完成；它不能用托管代码来完成。

看看[婴儿粉碎！](http://www.babysmash.com)斯科特汉塞尔曼。它托管在~~[http://www.codeplex.com/babysmash](http://www.codeplex.com/babysmash)~~ Github上的~~code plex上~~[https://github.com/shanselman/babysmash](https://github.com/shanselman/babysmash)

或者，查看CodeProject 上的[ShapeShow](http://www.codeproject.com/KB/WPF/ShapeShow.aspx)，这是类似的。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2011-10-31T16:14:34.540

请参阅[http://msdn.microsoft.com/en-us/library/system.windows.input.key(v=VS.90).aspx](http://msdn.microsoft.com/en-us/library/system.windows.input.key(v=VS.90).aspx)

在底部你会看到一个简单的例子，我认为你正在寻找的是这些方面的东西：

左窗口键：System.Windows.Input.Key.LWin

右窗口键：System.Windows.Input.Key.RWin

例子：

```
private void OnKeyDownHandler(object sender, KeyEventArgs e)
{
    if (e.Key == Key.LWin) {
        textBlock1.Text = "You Entered: " + textBox1.Text;
    }
} 
```

# python - Python中的代码块

> ID：767519
> 
> 赞同：10
> 
> 时间：2009-04-20T09:14:23.537
> 
> 标签：python, ruby, lambda

您能否详细说明 Python 中“块”（在 Ruby 意义上）的当前状态？

Python 中存在哪些语言结构？它们与其他语言（如 Ruby、Smalltalk、[插入更多]）相比如何？还是 Python 缺少这样的结构？

到目前为止，我已经理解了这`lambda`件事；它只有一条线，但也许很接近。那么“装饰器”`yield`呢？在这种情况下呢？

我也在一些项目中使用旧的 Python 版本。在哪个 Python 版本（2.5、2.6 等）中引入了哪些构造，或者计划在未来的版本中使用哪些构造？

您能否链接有关该主题的有趣文章，这些文章解释了 Python 的这些内容，并与其他语言进行了比较，并且对于想要扩展基本 Python 知识的人来说可能很有趣？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-04-20T09:21:31.803

函数是 Python 中的一等成员：

```
def add(x, y):
    return x + y

a = add          # Bind
b = a(34, 1)     # Call 
```

因此，您可以随心所欲地传递函数。您可以对 Python 中的任何可调用对象执行相同的操作。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-20T09:39:34.160

`lambda`是最接近 Ruby 块的等价物，并且对一行的限制[是有意的](http://www.artima.com/weblogs/viewpost.jsp?thread=147358)。通常认为多行匿名函数（Ruby 中的块）*通常*比在某处使用名称定义函数并传递它的可读性差，如[SilentGhost 的答案](https://stackoverflow.com/questions/767519/blocks-of-code-in-python/767529#767529)所示。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-20T09:42:19.850

与其他语言相比，comp.lang.python 上有很好的讨论：

*   [让我们谈谈 Lambda 函数！](http://groups.google.com/group/comp.lang.python/browse_thread/thread/05f1dcda93929d82)
*   [Python中的代码块](http://groups.google.com/group/comp.lang.python/browse_thread/thread/13b06186a5c8273a)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-20T13:32:25.227

这`def`等效于仅将函数对象绑定到对象引用变量的赋值语句。

然后可以使用对象引用变量来调用函数对象来执行。

# python - 从 python 2.5 开始，当前工作目录不再继承自调用进程？

> ID：767531
> 
> 赞同：3
> 
> 时间：2009-04-20T09:22:13.953
> 
> 标签：python, import

我将 Windows 2003 服务器上的 python 版本从 2.4 更新到 2.5。

在 2.4 中，我可以从子目录 c:\application\subdir\ 中导入文件“sub1.py”，如下所示：

```
import sub1 
```

只要 c:\application 中的调用脚本 main.py 是这样启动的：

```
c:\application\subdir>python ..\main.py 
```

但在 2.5 中它不再适用于我：

```
C:\application\subdir>python ..\main.py
Traceback (most recent call last):
  File "main.py", line 3, in <module>
    import sub1
ImportError: No module named sub1 
```

现在我可以放一个空文件

```
__init__.py 
```

进入子目录并像这样导入：

```
import subdir.sub1 as sub1 
```

python 2.5有变化吗？这意味着 python 2.4 中的当前工作目录是从调用进程继承的，而在 python 2.5 中，它被设置为主脚本所在的位置。

[edit3] 我现在更正了这个问题。我必须道歉，我起初过度简化了示例，并在没有检查我的简化示例的情况下删除了导致错误的原因。[/编辑3]

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-20T09:24:58.067

要导入 sub.py，您需要：

```
import sub      # not sub1 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-20T09:29:49.753

您可以检查 python 在哪里搜索模块。位置列表包含在变量 sys.path 中。

您可以创建一个简单的脚本（或以交互方式执行）来显示：

```
import sys

for x in sys.path:
  print x 
```

默认情况下，python 将搜索它正在执行的目录以及原始脚本所在的目录。

另外，尝试将 PYTHONPATH 环境变量设置为包含“.\”目录。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-20T09:30:05.323

我假设`sub1`是一个错字？在您的问题中，您有时会提及`sub`，有时会提及`sub1`。

我首先会检查 sub.py 文件是否存在于`c:\application`.

*   检查 sub.py 文件和应用程序目录的权限。用户可以读取 sub.py 文件吗？python解释器可以创建*.pyc文件吗？
*   此外，手动删除 sub.pyc 文件，以防万一旧版本的 pyc 导致问题。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-20T10:32:41.070

您需要进行以下更改：

*   `subdir`通过在目录中添加一个空`__init__.py`文件变成一个包
*   将导入更改为：`from subdir import sub1`

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-20T09:25:20.623

将此目录添加到您的 python 路径

# delphi - Delphi 2009 中的 COM 服务器 AnsiString 参数

> ID：767536
> 
> 赞同：0
> 
> 时间：2009-04-20T09:24:41.140
> 
> 标签：delphi, com, unicode, delphi-2009

我有一个简单的 COM dll，其方法采用两个字符串。在 delphi 的类型库编辑器中，这些字符串被定义为 LPSTR。这将转换为 TLB 文件中的 PChar。当从 D2007 升级到 D2009 时，这成为一个问题，因为 PChar 现在已从 PAnsiChar 更改为 PWideChar（当它从 ridl 文件生成时，它仍然成为 TLB 文件中的 PChar）。并且接口需要兼容上一个...

有没有办法让 PAnsiChar 作为 TLB 文件中的类型，以便它对应于 D2007 中的先前声明？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-20T09:42:42.563

您可以自己修改生成的代码。最简单的方法可能是重新声明 PChar：

```
type
  PChar = PAnsiChar; 
```

在生成的单元之上。

或者只是搜索并用 PAnsiChar 替换所有出现的 PChar（如果需要）。

顺便说一句，这是一个奇怪的 COM DLL，因为它不兼容自动化。通常，BSTR（Delphi 中的 WideString）用于 COM 中的字符串。

# c# - how i can list out all the namespace in XML?

> ID：767541
> 
> 赞同：15
> 
> 时间：2009-04-20T09:26:06.613
> 
> 标签：c#, .net, xml, namespaces

My basic requirement is to get element value from the XML file, i have used XMLDoxument.SelectSingleNode. My XML file contains some Namespace in header, so i have used NameSpaceManager to add namespace-prefix and i have used prefix to get that particular element. Now in my XML files that namespaces are getting vary, i don’t want to do any hard coding, is there any way that i can find out all the namespaces and i can add it to NameSpaceManager.

Thanks.

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2014-11-06T17:51:36.890

命名空间可以在 xml 文档中的任何位置找到。因此，为了提取所有命名空间并将它们声明到 XmlNamespaceManager 中，我执行了以下操作：

```
public static XmlNamespaceManager getAllNamespaces(XmlDocument xDoc)
{
    XmlNamespaceManager result = new XmlNamespaceManager(xDoc.NameTable);

    IDictionary<string, string> localNamespaces = null;
    XPathNavigator xNav = xDoc.CreateNavigator();
    while (xNav.MoveToFollowing(XPathNodeType.Element))
    {
        localNamespaces = xNav.GetNamespacesInScope(XmlNamespaceScope.Local);
        foreach (var localNamespace in localNamespaces)
        {
            string prefix = localNamespace.Key;
            if (string.IsNullOrEmpty(prefix))
                    prefix = "DEFAULT";

            result.AddNamespace(prefix, localNamespace.Value);
        }
    }

    return result;
} 
```

只需注意默认命名空间的情况。我将默认命名空间重新定义为“DEFAULT”前缀，因为在查询默认命名空间时使用上面返回的命名空间管理器创建 SelectSingleNode 时遇到问题。我是我的解决方法。希望这可以帮助

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-04-20T12:04:13.127

谢谢你快速的回复...

我认为您使用的 .Net 版本必须是最新版本。我正在使用.Net framework 1.1 ...相当老了:( ..

到那时，我已经得到了一些这样的示例代码..出于同样的目的......

```
XmlNodeList _xmlNameSpaceList =  _xmlDocument.SelectNodes(@"//namespace::*[not(. = ../../namespace::*)]");

            _xmlNSmgr = new XmlNamespaceManager(_xmlDocument.NameTable);        

            foreach(XmlNode nsNode in _xmlNameSpaceList)
            {
                _xmlNSmgr.AddNamespace(nsNode.LocalName,nsNode.Value);
            } 
```

任何评论将不胜感激，为我的知识库增加知识......谢谢

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-20T09:45:00.217

从 XmlDocument 检索命名空间的基本问题可以通过简单地检索`NameTable`XmlDocument 并从中创建一个来解决`XmlNameSpaceManager`。

但是，如果您想出于其他目的列出名称空间，则应检查该类以及该类`GetNamespacesInScope`公开的方法。`XmlNamespaceManager``XPathNavigator`

使用 XmlDocument 时，您可以通过以下代码从中获取 XmlNamespaceManager：

```
//Instantiate an XmlDocument object.
XmlDocument xmldoc = new XmlDocument();

//Load XML file into the XmlDocument object. 
xmldoc.Load("C:\\myFile.xml");

//Instantiate an XmlNamespaceManager object. 
XmlNamespaceManager nsMgr = new XmlNamespaceManager(xmldoc.NameTable);

// Retrieve the namespaces into a Generic dictionary with string keys.
IDictionary<string, string> dic = nsMgr.GetNamespacesInScope(XmlNamespaceScope.All);

// Iterate through the dictionary.

... 
```

[在本文中](http://www.hanselman.com/blog/GetNamespacesFromAnXMLDocumentWithXPathDocumentAndLINQToXML.aspx)，Scott Hanselman 提出了一种使用此方法列出文档中所有名称空间的方法，该方法使用 XPathNavigator 和使用 LINQ 桥。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2018-02-07T15:39:53.917

Ruchita 发布了`XmlDocument`. 但我想对`XDocument`. 这与`XDocument`：

```
var xml = XDocument.Load(filename);
var xmlNameSpaceList = ((IEnumerable)xml.XPathEvaluate(@"//namespace::*[not(. = ../../namespace::*)]")).Cast<XAttribute>();
var xmlNSmgr = new XmlNamespaceManager(new NameTable());
foreach (var nsNode in xmlNameSpaceList)
{
    xmlNSmgr.AddNamespace(nsNode.Name.LocalName, nsNode.Value);
} 
```

现在您可以将 XPath 与命名空间一起使用，例如`xml.XPathEvaluate("//test:p", xmlNSmgr)`.

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2021-09-27T13:29:08.760

```
var xml = XDocument.Load(@"C:\Temp\file.xml");

var listnameSpaces = xml.Root.Attributes().Where(a => a.IsNamespaceDeclaration).ToList().ToDictionary(x => x.Name.LocalName, x => x.Name.Namespace); 
```

* * *

## 回答 #6

> 赞同：-3
> 
> 时间：2011-04-06T18:34:55.520

如果您正在寻找避免命名空间问题的快速方法，请在执行 XmlDocument.LoadXml(bla) 之前通过 RegEx 从 Xml 中去除命名空间定义。我在解析实时 XHTML 页面时这样做。将 XmlDoc 加载时间从 15 秒缩短到 0.15 秒，这样我就不必为我的 xpath 加上前缀了。

# ide - Notepad++ 是否显示所有隐藏字符？

> ID：767545
> 
> 赞同：269
> 
> 时间：2009-04-20T09:28:00.133
> 
> 标签：ide, editor, text-editor, notepad++, scintilla

在记事本++中，我设置了“用 2 个空格替换选项卡”。

在 Python 中编码时，我从网上复制粘贴了一些代码，它看起来缩进正确。但是运行代码会导致缩进错误，我最终通过删除行开头的所有“可见”空格并再次插入相同数量的空格来解决这个问题。

[基于Scintilla](https://en.wikipedia.org/wiki/Scintilla_(software))的 Notepad++ 是否有可能不显示所有特殊字符，而是将它们显示为空格？有没有解决这个问题的设置？

* * *

## 回答 #1

> 赞同：424
> 
> 时间：2009-04-20T09:35:20.350

是的，它确实。启用此功能的方式取决于您的 Notepad++ 版本。在较新的版本上，您可以使用：

菜单*视图*→*显示符号*→ *显示所有字符`

或者

菜单*视图*→*显示符号*→*显示空白和制表符*

（感谢下面对这些更新位置的bers 评论和bkaid 的回答。）

* * *

在旧版本上，您可以查找：

菜单*视图*→*显示所有字符*

或者

菜单*视图*→*显示空白和 TAB*

* * *

## 回答 #2

> 赞同：105
> 
> 时间：2011-07-27T18:09:30.640

在较新版本的 Notepad++（当前为 5.9）中，此选项位于：

```
View->Show Symbol->Show All Characters 
```

或者

```
View->Show Symbol->Show White Space and Tab 
```

* * *

## 回答 #3

> 赞同：17
> 
> 时间：2010-03-05T16:47:37.823

使用十六进制编辑器插件仔细检查您的文本。在您的情况下，可能有一些控制字符已经潜入您的文本中。通常您会查看空白，它会显示 32 32 32 32，或 Unicode 32 00 32 00 32 00 32 00。如果没有大量代码，您可能会这样发现问题。

从这里下载 Hex 插件； [http://sourceforge.net/projects/npp-plugins/files/Hex%20Editor/](http://sourceforge.net/projects/npp-plugins/files/Hex%20Editor/)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2018-04-16T17:02:35.150

对于非打印字符，您可以执行以下操作：

*   如果您可以识别字符，光标需要 2 个箭头键移动，只需选择该字符。
*   做`Ctrl`——`F`
*   现在您可以计算或替换甚至标记所有此类字符

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2019-10-29T01:46:37.837

是的，很遗憾，您无法关闭它们或任何其他特殊字符。\View\Show Symbols 下的选项仅打开或关闭选项卡、空格、EOL 等内容。因此，如果您想阅读一些带有文本的晦涩编码 - 您实际上需要查看其他地方。我还研究了更改编码，ASCII 未列出，这不会使混乱不可见。

# asp.net - Disable controls while Ajax call in Asp.net

> ID：767548
> 
> 赞同：0
> 
> 时间：2009-04-20T09:28:28.667
> 
> 标签：asp.net, javascript, ajax, ajaxcontroltoolkit

how can i disable a set of controls while waiting for a certain Ajax call to end?

I'm aware of the method:

```
Sys.WebForms.PageRequestManager.getInstance().add_beginRequest(onSubmit); 
```

but this will be triggered for *every* updatepanel, not only the one I want to control.

Also, an UpdateProgress (maybe with an overlying semitransparent div) is not really **disabling**.

Maybe there's something in ajaxcontroltoolkit? Thanks

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-20T22:29:30.347

此函数将在`beginRequest`事件上执行：

```
 function onSubmit (sender, args) {
  var element = args.get_postBackElement();
  // May need more traversing...
  var parentElement = element.parentNode.parentNode;
  $(":input", parentElement).attr("disabled", "disabled");
} 
```

这将禁用父元素内的所有控件。

请注意，您需要包含[JQuery](http://jquery.com/) JavaScript 库。我想提一下微软支持 JQuery，他们将在即将发布的 Visual Studio 版本中支持它。欲了解更多信息，请访问[http://live.visitmix.com/](http://live.visitmix.com/)。

# linux - 如何停止 Linux 上的“不间断”进程？

> ID：767551
> 
> 赞同：53
> 
> 时间：2009-04-20T09:29:04.343
> 
> 标签：linux, signals, sigabrt, kill-process, sigkill

我有一个 VirtualBox 进程，我试图杀死（`KILL`/ `ABORT`）但没有成功。父 pid 为 1 (init)。

`top`显示了`D`记录为“不间断睡眠”的过程。

`strace`什么都不显示。

我怎样才能摆脱这个？它阻止我卸载 VirtualBox 内核驱动程序以加载更新的驱动程序。

* * *

## 回答 #1

> 赞同：50
> 
> 时间：2009-04-20T09:37:10.720

简单的答案：你不能。

更长的答案：不间断的睡眠意味着进程不会被信号唤醒。它只能被它正在等待的东西唤醒。当我遇到这种情况时，例如。对于 CD-ROM，我通常使用suspend-to-disk 和恢复来重置计算机。

* * *

## 回答 #2

> 赞同：28
> 
> 时间：2015-11-22T14:14:03.597

杀死一个不间断的进程是成功的，它只是不会立即这样做。该过程在实际接收到信号之前不会消失。所以仅仅发送一个信号是不足以摆脱进程的，你还必须把它从不间断的睡眠中唤醒。

Tanel Poder 为分析 D 状态过程编写了一个很好的[指南](http://blog.tanelpoder.com/2013/02/21/peeking-into-linux-kernel-land-using-proc-filesystem-for-quickndirty-troubleshooting/)。这种状态很典型是由不完整的 I/O 引起的，例如网络故障。slm 发布了一些关于超级用户如何解除网络 I/O 阻塞以及问题本身的[非常有用的指示。](https://superuser.com/a/541685)

就个人而言，在 VirtualBox 上处理 Windows 时，甚至使用 wine，我经常遇到这个问题，因为 cdrom I/O 永远不会完成（我猜它是某种磁盘存在检查）。[可以重置 ATA 设备](https://www.skytale.net/blog/archives/24-Resetting-SATA-devices-under-Linux.html)，这可能会解除进程的阻塞。例如，我正在使用以下小脚本来重置我的两个光盘驱动器，从而解除它们阻塞的进程：

```
echo 1 > /sys/block/sr0/delete
echo 1 > /sys/block/sr1/delete
echo "- - -" > /sys/class/scsi_host/host7/scan 
```

* * *

## 回答 #3

> 赞同：20
> 
> 时间：2009-04-20T09:35:15.780

D状态基本上意味着进程正在等待磁盘I/O，或者其他不能中断的块I/O。有时这意味着内核或设备正在疯狂地尝试读取坏块（尤其是从光盘中）。有时这意味着还有别的东西。

进程在退出 D 状态之前不能被杀死。找出它在等待什么并修复它。简单的方法是重新启动。有时删除有问题的磁盘会有所帮助，但这可能相当危险：如果您不知道自己在做什么，则无法修复的灾难性硬件故障（阅读：冒烟）。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2013-08-29T18:35:29.823

我最近在远程服务器上遇到了一个处于`D`状态的进程，我想澄清一下，需要**硬重启**或重启才能删除该进程。

在用尽所有其他选项之前，请勿尝试软重启。例如，您可以尝试释放进程挂起的任何资源。软重启可能会让您的系统部分关闭并且不再响应 ssh，但不会重启，因为它在试图终止不间断进程时挂起。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2017-08-16T16:19:13.143

正如其他人所说，不可中断进程是卡在无法中断的内核函数中的进程（通常它正在等待一些 I/O 操作）。有关详细说明，请参阅[此答案](https://stackoverflow.com/a/223727/2063031)。

除了重新启动计算机之外，我还通过[刷新 linux VM 缓存](https://unix.stackexchange.com/a/87909/78327)`D`成功地使一些进程脱离了状态：

```
kill -9 {process_id}
sync
echo 3 | sudo tee /proc/sys/vm/drop_caches 
```

这似乎并没有影响系统稳定性，但我不是系统程序员，不确定这可能会产生什么意想不到的后果。

* * *

**编辑**：

根据[内核文档](https://www.kernel.org/doc/Documentation/sysctl/vm.txt)，`drop_caches`在开发环境中似乎相当安全。

> **drop_caches**
> 
> 写入这将导致内核丢弃干净的缓存，以及可回收的slab对象，如dentries和inode。一旦放下，他们的记忆就会自由。
> 
> 释放页面缓存：
> 
> ```
> echo 1 > /proc/sys/vm/drop_caches 
> ```
> 
> 释放可回收的slab对象（包括dentries和inode）：
> 
> ```
> echo 2 > /proc/sys/vm/drop_caches 
> ```
> 
> 释放slab对象和页面缓存：
> 
> ```
> echo 3 > /proc/sys/vm/drop_caches 
> ```
> 
> 这是非破坏性操作，不会释放任何脏对象。为了增加此操作释放的对象数量，用户可以在写入 /proc/sys/vm/drop_caches 之前运行“同步”。这将最大限度地减少系统上脏对象的数量并创建更多要删除的候选对象。
> 
> 该文件不是控制各种内核缓存（inode、dentries、pagecache 等）增长的手段，当系统其他地方需要内存时，内核会自动回收这些对象。
> 
> 使用此文件可能会导致性能问题。由于它会丢弃缓存的对象，因此重新创建丢弃的对象可能会花费大量的 I/O 和 CPU，尤其是在它们被大量使用的情况下。因此，不建议在测试或调试环境之外使用。
> 
> 使用此文件时，您可能会在内核日志中看到信息性消息：
> 
> ```
> cat (1234): drop_caches: 3 
> ```
> 
> 这些仅供参考。它们并不意味着您的系统有任何问题。要禁用它们，请将 4（位 3）回显到 drop_caches。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2020-02-06T06:07:00.713

这里是新的，没有那么有经验，但是我遇到了同样的问题，当我使用 htop 检查它们的状态时，我可以看到我的进程进入不间断睡眠（D 状态）。由于某些原因，

```
kill -9 <pid> 
```

为我工作。也许你可以试试同样的。

编辑：详细的答案在 ostrokach 那里（我没有看到）。

# asp.net - 如何通过 Web 服务交付 Excel 电子表格

> ID：767558
> 
> 赞同：2
> 
> 时间：2009-04-20T09:31:17.317
> 
> 标签：asp.net, vb.net, web-services

是否可以通过 Web 服务提供 Excel 电子表格。我相信不是因为 ASP.NET Web 服务似乎只处理 excel 二进制格式不是的可序列化元素（我认为）。如果 Excel 以 XML 格式保存，这会起作用吗？

我有许多将通过电子邮件发送的报告，但已提出请求，允许通过 Web 服务提取这些报告。

这是可以实现的吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-20T09:40:06.033

是的。您可以在服务器上将 excel 文件作为内存流打开，然后将它们作为字节 [] 流式传输到客户端/消费者。然后客户端可以将文件流保存回本地机器。

MS有一篇关于它的知识库文章。

[http://support.microsoft.com/kb/318425](http://support.microsoft.com/kb/318425)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-20T09:39:46.703

我不会尝试。Excel 电子表格有大量与格式化等相关的开销。我很想只通过网络发送数据。如果它绝对必须是接收端的电子表格，那么更多的编码可以格式化数据。

另一种替代方法是让电子表格文件可供直接下载。您托管 Web 服务的事实意味着您正在使用某种 Web 服务器，因此 WebClient.DownloadFile 应该可用。然后，您的 Web 服务可以提供最新文件的 URL。

*编辑 - 如果您仍然愿意，下面 Eoin Campbell 的回答将允许您选择您喜欢的路线。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-20T09:49:50.407

您可以通过使用 base64 或其他一些替代方法将 excel 文件转换为 mime 编码字符串来序列化它。

以同样的方式将附件嵌入到电子邮件中。

当然，客户端需要知道它需要一个 mime 编码的字符串，以及使用哪种解码类型

# sql-server - SQL Server 2005 复制，具有可更新订阅错误的事务性

> ID：767560
> 
> 赞同：0
> 
> 时间：2009-04-20T09:32:01.527
> 
> 标签：sql-server, sql-server-2005, replication

几天前，我为我们的 SQL Server 2005 数据库设置了一些复制，复制的类型是可更新订阅的事务。

复制工作正常，最近我通过修改订阅服务器上的 1 个数据来测试可升级订阅功能，但随后出现错误并且未提交数据。

错误是：

```
错误来源：.Net SQLClient 数据提供程序。
错误消息：Publisher 的 RPC 安全信息丢失或无效。使用 sp_link_publication 来指定它。
可更新订阅：回滚交易。
……  

```

我已经检查了发布者和订阅者的用户名和密码，并且由于我使用混合身份验证并且我为发布者和订阅者设置了相同的用户名和密码，所以不会错。

我的复制架构是这样的：
[复制架构 http://i.msdn.microsoft.com/ms151196.89217927-03fc-4ba0-8110-73ada9810b3f(en-us,SQL.100).gif](http://i.msdn.microsoft.com/ms151196.89217927-03fc-4ba0-8110-73ada9810b3f(en-us,SQL.100).gif)

（左图使用 3 个服务器），假设 A 是发布者，B/C 是订阅者

有人有这个问题的解决方案吗？如果可能的话，我更喜欢 GUI 解决方案而不是 T-SQL。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-29T04:00:16.073

抱歉没有 GUI 解决方案，我会运行

`sp_link_publication.`

这个链接

[http://msdn.microsoft.com/en-us/library/ms174991.aspx](http://msdn.microsoft.com/en-us/library/ms174991.aspx)

解释参数

希望有帮助

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-04T02:48:39.167

问题解决了，问题实际上与 MS DTC 相关，我修改了 MSDTC 设置并重新创建了复制（发布者和订阅者），现在它可以工作了

PS:
- MSDTC 可以在管理工具 -> 组件服务 -> 右键单击​​计算机并转到 MSDTC 选项卡
- 在那里我检查所有项目并按应用然后重新创建复制

# c# - WPF中的动画GIF问题

> ID：767564
> 
> 赞同：2
> 
> 时间：2009-04-20T09:32:39.623
> 
> 标签：c#, wpf, .net-3.5

我在我的 WPF 中添加了上面的代码，其中包括动画 GIF 图像，问题是每当表单加载时，我都找不到任何显示在表单上的图像，有什么建议吗？？？

```
<Image Name="imgScan"  Source="Images\Pre_Scan_RealImage.gif" /> 
```

我什至尝试了上面显示的图像元素

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2012-12-21T13:34:05.947

**在下面使用 XAML**

```
<MediaElement Height="30" Width="30" LoadedBehavior="Play" Source="Images\loading.gif" /> 
```

**设置 loading.gif 的属性**

1.  **构建动作**：无
2.  **复制到输出目录**：始终复制

它应该工作。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-04-20T10:11:00.233

目前 WPF 本身并不支持动画 GIF。

您可以通过[在 PictureBox 中托管图像](https://stackoverflow.com/questions/210922/how-do-i-get-an-animated-gif-to-work-in-wpf)来解决它。

编辑：还可以查看[此](http://social.msdn.microsoft.com/Forums/en-US/wpf/thread/93d50a97-0d8d-4b18-992e-cd3200693337)线程以获取更多信息。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-20T10:06:11.227

> 我什至尝试了上面显示的图像元素

它是否有效？;)

`MediaElement`尚不支持包 URI 。这意味着您需要将 GIF 包含为外部文件，而不是资源。这可能是您的问题，但如果不是，您需要提供更多信息。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-20T10:50:40.840

我喜欢[这里](http://www.solidrockstable.com/blogs/PragmaticTSQL/Lists/Posts/Post.aspx?ID=37)的 UserControl用于显示 GIF 动画，猜猜什么工作就像图像控件一样简单。

谢谢大家

这是[同一篇文章](http://web.archive.org/web/20120413012735/http://www.solidrockstable.com/blogs/PragmaticTSQL/Lists/Posts/Post.aspx?ID=37)（Wayback Machine 捕获的网络帖子）

# unit-testing - What to test in unit testing, a method or a scenario?

> ID：767567
> 
> 赞同：1
> 
> 时间：2009-04-20T09:34:10.603
> 
> 标签：unit-testing, code-coverage, testcase

What to test in unit testing, a method or a scenario?

If test each method then minimal test case setup is required.

If test a method which calls other methods then setup required for the test case is huge. If unit-tests for the individual methods are already there then why to write for this method which is using them?

But then it also have little bit of functionality which should be tested. Also the code coverge tool will complain about coverage percentage.

Please provide your practical inputs.

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-20T10:05:54.707

> 如果测试一个调用其他方法的方法，那么测试用例所需的设置是巨大的。如果单个方法的单元测试已经存在，那么为什么要为使用它们的方法编写？

因为该方法可能会使用错误的参数或以错误的顺序调用底层方法，或者对返回值执行错误的操作。

根据我的经验，与它们与此类“胶水代码”之间的交互相比，自包含方法中出错的可能性通常很小。

“经典”单元测试，您完全独立地测试每个类的行为是一个不错的概念，但实际上，这种情况并不是那么普遍或有用。这取决于在设计代码的模块化和（隐含的）可测试性方面花了多少心血，但永远不可能做到所有事情。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-21T06:58:30.607

第一*法则*是：

**一次只测试一件事！**

这意味着：您甚至不测试方法，而是在单一条件下测试方法的单个方面。所以你想出了几个测试相同的方法。

隔离是良好单元测试的关键。您需要模拟您的依赖项（例如，使用 RhinoMocks）。一开始它看起来更复杂，但从长远来看，它更容易管理和维护。在测试中只测试少量代码，让你的测试尽可能的简单，你将拥有可维护的测试。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-20T11:23:30.510

您对一个方法进行单元测试，每个可能的执行路径都有一个测试用例。

单元测试的典型结构是 Arrange-Act-assert（三个 A）：

*   安排 - 为您要测试的案例创建环境（这可以在套件设置或测试案例中完成，或两者兼而有之）
*   Act - 测试用例调用被测方法
*   断言 - 验证被测方法是否完成了它应该做的事情

过多的设置应该表明您应该查看您的设计，例如，您的班级可能太大，或者做的事情太多。[过度设置](https://stackoverflow.com/questions/333682/tdd-anti-patterns-catalogue/333739#333739)是一种反模式。

您可以使用[模拟对象](http://en.wikipedia.org/wiki/Mock_object)来隔离您正在测试的类。

# zend-framework - Zend_Rest_Server + Zend_Rest_Client，变量未读取

> ID：767570
> 
> 赞同：0
> 
> 时间：2009-04-20T09:35:06.747
> 
> 标签：zend-framework, zend-rest

我想要做的是将 $rest->apikey 传递给我的 Zend_Rest_Server。empAction 创建我的 Zend_Rest_Server 所需的数组。但是在 getByShortname($id,$apikey) 中，我无法读取 $apikey。他们查询以检查 API 密钥没有返回任何结果。

```
$rest = new Zend_Rest_Client('http://localhsot/api/emp');
$rest->method('getByShortname');
$rest->id('1124921');
$rest->apikey('1234');
$result = $rest->get();
var_dump($result); //should work

//---------------------------------------
//For Emp method--> api/emp
//---------------------------------------
//... rest of code ...
public function empAction() 
{
    require_once 'EmprestServer.php';

    $params = $this->_getAllParams();

    unset($params['controller']);
    unset($params['action']);
    unset($params['module']);

    $param_keys = array_keys($params);
    if($param_keys[0]=='id') {
        $request = array('method' => 'getById');
    } else if($param_keys[0]=='shortname') {
        $request = array('method' => 'getByShortname');
    }

    foreach($param_keys AS $key) {
        $request[$key] = $filter_params[$key]; //need to filter key
        //need better checking
        if(!$request[$key]) {
            throw new Exception($request[$key].' contained invalid data.');
        }
    }

/*
I am able to generate this array using the code prior to this line...
    $request = array();
    $request['method']    = 'getByShortname';
    $request['shortname'] = 'wdelrosa';
    $request['apikey']    = '1234';
*/

    $server = new Zend_Rest_Server();
    $server->setClass('EmprestServer');
    $server->handle($request);
}
//... rest of code ...
//---------------------------------------
//The Class
//---------------------------------------
class EmprestServer
{
    public function getByShortname($shortname,$apikey)
    {
        $emp = new Employee();
        $data = array();

        /** PROBLEM **/
        /** I can't access $apikey WHY? Any ideas? **/

        if(!$this->checkKey($apikey)) {
            throw new Exception('Key is invalid.');
        }

        if(!$data = $emp->getEmployeeByShortname($shortname)) throw new Exception('Employee ID not found.');
        $data = $data->toArray();
        return $data;
    }
} 
```

更新：这似乎有效。我得到了一个有效的 XML 输出

```
http://locahost/api/emp/shortname/wdelrosa/apikey/1234 
```

但是如果我使用上面的 Zend_Rest_Client，apikey 就不会被读取。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-24T05:15:06.747

来源：[http](http://framework.zend.com/manual/en/zend.rest.client.html) : //framework.zend.com/manual/en/zend.rest.client.html 第 44.2.3 节。请求参数

```
$client = new Zend_Rest_Client('http://example.org/rest');

$client->arg('value1');
$client->arg2('value2');
$client->get();

// or

$client->arg('value1')->arg2('value2')->get(); 
```

上面示例中的两种方法都将导致以下 get args：

```
?method=arg&arg1=value1&arg=value1&arg2=value2 
```

你会注意到第一次调用

```
$client->arg('value1'); 
```

导致两者

```
method=arg&arg1=value1 and arg=value1; 
```

这样 Zend_Rest_Server 可以正确理解请求，而不需要预先存在的服务知识。

所以：

```
$rest = new Zend_Rest_Client('http://example.org/api/emp');
$rest->getById(); //this was not here before. This made it work!
$rest->id('1124921');
$rest->apikey('1234');
$result = $rest->get();
if($result->status()=='success') {
    echo $result->emp_id() .' '. $result->emp_shortname().' '. $result->status();
} else {
    echo $result->response().' '.$result->status();
} 
```

会工作！

# sql - 一个 StoredProcedure 中的多个更新语句

> ID：767574
> 
> 赞同：11
> 
> 时间：2009-04-20T09:36:25.557
> 
> 标签：sql, stored-procedures

我想知道是否可以在存储过程中有多个 Update 语句

像这样的东西：

```
Update Table1 set field1 = @new_value where id = @table1_id

Update Table2 set field2 = @new_value where id = @table2_id

Update Table3 set field3 = @new_value where id = @table3_id 
```

现在我正在单独执行它们，但由于它们只一起使用，我想知道它们是否可以只位于一个 SP 中。

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2009-04-20T09:39:22.447

是的，有可能：

```
CREATE PROCEDURE prc_update (@table1_id INT, @table2_id INT, @table3_id INT, @new_value INT)
AS
BEGIN
        UPDATE  Table1
        SET     field1 = @new_value
        WHERE   id = @table1_id

        UPDATE  Table2
        SET     field2 = @new_value
        WHERE   id = @table2_id

        UPDATE  Table3
        SET     field3 = @new_value
        WHERE   id = @table3_id
END 
```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-04-20T09:44:19.673

是的，这很好用。

还要在更新前将其放入存储过程中：

```
set nocount on 
```

这可以防止存储过程为没有结果的查询创建结果集。否则每次更新都会产生一个空的结果集，并发送回客户端。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-04-20T13:26:44.817

您还应该将这些语句包装在事务中，以便如果一个失败，所有语句都会回滚。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2020-01-07T11:18:34.350

下面是带有 transaction 、 nocounton 和多个更新查询的存储过程。

```
 CREATE PROCEDURE prc_update (@table1_id INT, @table2_id INT, @table3_id INT, 
 @new_value INT)
 AS
 BEGIN
 BEGIN TRY

 Set Nocount ON
 Begin Transaction
 Save Transaction BeforeTransactionSavePoint
    UPDATE  Table1
    SET     field1 = @new_value
    WHERE   id = @table1_id

    UPDATE  Table2
    SET     field2 = @new_value
    WHERE   id = @table2_id

    UPDATE  Table3
    SET     field3 = @new_value
    WHERE   id = @table3_id
   Commit Transaction
END TRY  
BEGIN CATCH

If @@TRANCOUNT > 0
Rollback Tran BeforeTransactionSavePoint
DECLARE  
 @ErMessage NVARCHAR(2048),  
 @ErSeverity INT,  
 @ErState INT  

 SELECT  
 @ErMessage = ERROR_MESSAGE(),  
 @ErSeverity = ERROR_SEVERITY(),  
 @ErState = ERROR_STATE()  

 RAISERROR (@ErMessage,@ErSeverity,@ErState )  
 END 
```

# localhost - CherryPy Hello World 错误

> ID：767575
> 
> 赞同：13
> 
> 时间：2009-04-20T09:36:50.627
> 
> 标签：localhost, port, cherrypy

当我运行 CherryPy Hello World 时：

```
import cherrypy

class HelloWorld:
    def index(self):
        return "Hello world!"
    index.exposed = True

cherrypy.config.update({'server.socket_port': 8080,})
cherrypy.quickstart(HelloWorld()) 
```

...我明白了：IOError：端口 8080 未绑定在“本地主机”上。会是什么呢？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2012-02-14T03:28:22.327

如果你尝试在 Heroku 上部署 CherryPy，你无法使用 loopback 来检查你是否真的打开了一个端口，那么你只需要简单地禁用 CherryPy 的`wait_for_occupied_port()`功能，这样 CherryPy 的自我一致性检查就不会确定它有，事实上， 未能启动。以下是我用来修复 CherryPy 以使其在 Heroku 上运行的三行代码：

```
 from cherrypy.process import servers
    def fake_wait_for_occupied_port(host, port): return
    servers.wait_for_occupied_port = fake_wait_for_occupied_port 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-04-20T09:57:38.253

您可能在该端口上侦听了其他内容。

在 Linux 上执行：

```
netstat -pnl | grep 8080 
```

并查看 8080 上正在监听什么进程

在 Windows 上使用类似[TCPView](http://technet.microsoft.com/en-us/sysinternals/bb897437.aspx)的东西来做同样的事情。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2011-10-28T20:25:38.320

正如[Jason R. Coombs](https://stackoverflow.com/questions/767575/cherrypy-hello-world-error/3282264#3282264)所写，禁用环回设备存在问题。heroku.com 已禁用环回，因此 CherryPy 将崩溃。我为此[提交了一个错误](https://bitbucket.org/cherrypy/cherrypy/issue/1100/cherrypy-322-gives-engine-error-when)。

更新：[报告为已解决。](https://bitbucket.org/cherrypy/cherrypy/changeset/7e87ed84d9f4)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-29T20:05:54.193

我想当我开始使用 CherryPy 时遇到了类似的问题......但我不记得它到底是什么......但修复涉及使用配置文件而不是手动传递配置：

MyProj.conf：

```
[全球的]
server.socket_host = "127.0.0.1"
server.socket_port = 8080
server.thread_pool = 10

```

MyProj.py

```
import os
import cherrypy

class HelloWorld:
    def index(self):
        return "Hello world!"
    index.exposed = True

# Assumes the config file is in the directory as the source.    
conf_path = os.path.dirname(os.path.abspath(__file__))
conf_path = os.path.join(conf_path, "MyProj.conf")
cherrypy.config.update(conf_path)
cherrypy.quickstart(HelloWorld()) 
```

这肯定在这里有效。
我正在使用 Python 2.6.1 和 CherryPy 3.1.1，并使用以下命令运行脚本`-W ignore`：

```
c:\My_path> python -W 忽略 MyProj.py

```

如果您在 *nix 下，则应将 放在文件顶部的注释中`-W ignore`。`#!`

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2010-07-19T15:03:13.243

我昨天在 Ubuntu Linux 服务器上遇到了这个问题。在我意识到错误消息非常笼统之前，我花了几个小时试图找出 CherryPy 代码中的错误。即使主机不拥有服务器尝试绑定的 IP 地址，它也会给出此错误消息。在我的情况下，环回接口（lo，127.0.0.1）被禁用。因此，即使我设置`server.socket_host='0.0.0.0'`了 ，检查端口 的尝试`wait_for_occupied_port`也会失败（因为它合理地假设环回接口始终可用）。重新启用回送接口后，CherryPy 服务器将正常启动。

更新：CherryPy 3.2.3 修复了这个特定问题。[在 3.2.3 发布之前，可以在CherryPy 项目下载](https://bitbucket.org/cherrypy/cherrypy/downloads)中获得开发版本。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-29T16:13:27.497

*   在不同的端口上使用它（例如 8000）
*   阅读[ConfigApi](http://www.cherrypy.org/wiki/ConfigAPI)（再一次）
*   尝试最新版本而不是 3.0
*   这也可能是由某些 Windows 防火墙（Eset smart security 或其他）引起的。所以只需在不同的端口上使用它。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2016-03-04T13:58:52.977

如果您使用的是 OS X，请尝试调用：

```
sudo lsof -i :8080 
```

这将告诉您使用该端口的过程。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-06-28T23:44:03.020

AVG Anti-Virus 给我造成了这个问题。卸载 AVG（远非理想）就可以了。我怀疑我无法禁用的链接扫描仪。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2013-04-11T19:52:27.823

在我的 Win7 PC 上使用 Python 3.3 运行 CherryPy 3.2.2 时，我遇到了同样的问题。服务器将正常启动，然后在大约几分钟内崩溃。

我已经应用了CherryPy 3.2.3 laurasia 中提到的[补丁](https://bitbucket.org/cherrypy/cherrypy/changeset/7e87ed84d9f4)。但这没有帮助。

所以我不得不在最后注释掉引发错误的行，`python\Lib\site-packages\cherrypy\process\servers.py`以防止服务器死机：

```
...
#    if host == client_host(host):
#        raise IOError("Port %r not bound on %r" % (port, host))
... 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2020-09-27T02:40:57.893

## 视窗 10

如果你得到一个 python 异常打印到 stdio，8080 在 127.0.0.1 上不是免费的，那么你要做的是：

```
netstat -o -a 
```

在 Windows 命令提示符下。单独做`netstat -o`会给你一个不正确的PID。

在第一列的地址字符串中查找 8080。找到后，水平转到最后一列，即 PID（进程 ID）。

现在要终止一个进程，我使用`kill <PID>`它是 mysys 安装的一部分。`where kill`我在我的系统上发现了这一点。

因此，所有在一起：

```
netstat -o -a
[find PID then hit ctrl-c to stop netstat]
kill 13164 
```

其中 13164 是第一步中找到的示例 PID。

如果您没有安装 mysys，请安装它，或者在 windows 上查找如何通过其 PID 杀死进程。

# c++ - 从 DLL 中导出包含 `std::` 对象（矢量、地图等）的类

> ID：767579
> 
> 赞同：62
> 
> 时间：2009-04-20T09:38:26.660
> 
> 标签：c++, visual-studio, dll

我正在尝试从包含对象的 DLL 中导出类`std::vectors`-`std::strings`整个类通过以下方式声明为 DLL 导出：

```
class DLL_EXPORT FontManager { 
```

问题是，对于复杂类型的成员，我会收到以下警告：

> ```
> warning C4251: 'FontManager::m__fonts' : class 'std::map<_Kty,_Ty>' needs to have dll-interface to be used by clients of class 'FontManager'
>       with
>       [
>           _Kty=std::string,
>           _Ty=tFontInfoRef
>       ] 
> ```

即使我没有更改成员变量本身的类型，我也可以通过在它们之前放置以下前向类声明来删除一些警告：

```
template class DLL_EXPORT std::allocator<tCharGlyphProviderRef>;
template class DLL_EXPORT std::vector<tCharGlyphProviderRef,std::allocator<tCharGlyphProviderRef> >;
std::vector<tCharGlyphProviderRef> m_glyphProviders; 
```

看起来前向声明`DLL_EXPORT`在编译成员时“注入”了 for，但它安全吗？当客户端编译此标头并使用他身边
的容器时，它真的会改变什么吗？ 它会在未来使用这种容器（并且可能不是内联）吗？ 它真的解决了警告试图警告的问题吗？`std::`
`DLL_EXPORT`

这个警告是我应该担心的，还是最好在这些构造的范围内禁用它？
客户端和 DLL 将始终使用相同的库和编译器集构建，并且这些是仅标头类...

我将 Visual Studio 2003 与标准 STD 库一起使用。

* * *

### 更新

我想更多地针对您，因为我看到答案很笼统，在这里我们谈论的是标准容器和类型（例如`std::string`）-也许问题确实是：

我们是否可以通过相同的库头禁用客户端和 DLL 都可用的标准容器和类型的警告，并像对待一个`int`或任何其他内置类型一样对待它们？（它似乎在我这边工作正常）
如果是这样，我们可以做到这一点的条件应该是什么？

或者是否应该禁止使用此类容器，或者至少要格外小心以确保没有赋值运算符、复制构造函数等会内联到 DLL 客户端中？

一般来说，我想知道您是否觉得设计一个具有此类对象的 DLL 接口（例如，使用它们将内容作为返回值类型返回给客户端）是一个好主意，为什么，我想拥有此功能的“高级”接口......
也许最好的解决方案是 Neil Butterworth 建议的 - 创建一个静态库？

* * *

## 回答 #1

> 赞同：59
> 
> 时间：2009-04-20T10:33:35.780

当您从客户端接触班级中的成员时，您需要提供一个 DLL 接口。DLL 接口意味着编译器在 DLL 本身中创建函数并使其可导入。

因为编译器不知道 DLL_EXPORTED 类的客户端使用了哪些方法，所以它必须强制所有方法都是 dll 导出的。它必须强制客户端可以访问的所有成员也必须 dll 导出其功能。当编译器警告您方法未导出并且客户端的链接器发送错误时，就会发生这种情况。

并非每个成员都必须使用 dll-export 进行标记，例如客户端无法访问的私有成员。在这里您可以忽略/禁用警告（注意编译器生成的 dtor/ctors）。

否则成员必须导出他们的方法。使用 DLL_EXPORT 前向声明它们不会导出这些类的方法。您必须在其编译单元中将相应的类标记为 DLL_EXPORT。

它归结为......（对于不可导出 dll 的成员）

1.  如果您有客户不能/不能使用的成员，请关闭警告。

2.  如果您有客户端必须使用的成员，请创建 dll 导出包装器或创建间接方法。

3.  要减少外部可见成员的数量，请使用诸如[PIMPL idiom](http://c2.com/cgi/wiki?PimplIdiom)之类的方法。

* * *

```
template class DLL_EXPORT std::allocator<tCharGlyphProviderRef>; 
```

这确实在当前编译单元中创建了模板特化的实例化。所以这会在dll中创建std::allocator的方法并导出相应的方法。这不适用于具体类，因为这只是模板类的实例化。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2009-05-01T02:01:17.170

该警告告诉您，您的 DLL 用户将无法跨 DLL 边界访问您的容器成员变量。显式导出它们使它们可用，但这是个好主意吗？

一般来说，我会避免从你的 DLL 中导出标准容器。如果您可以绝对保证您的 DLL 将与相同的运行时和编译器版本一起使用，那么您将是安全的。您必须确保在您的 DLL 中分配的内存是使用相同的内存管理器释放的。否则，充其量只能在运行时断言。

因此，不要跨 DLL 边界直接公开容器。如果您需要公开容器元素，请通过访问器方法进行。在您提供的情况下，将接口与实现分开，并在 DLL 级别公开接口。您对 std 容器的使用是您的 DLL 客户端不需要访问的实现细节。

或者，按照 Neil 的建议创建一个静态库而不是 DLL。您失去了在运行时加载库的能力，并且您的库的使用者必须在您更改库时重新链接。如果这些是您可以接受的折衷方案，那么静态库至少可以让您解决这个问题。我仍然会争辩说您不必要地公开了实现细节，但这可能对您的特定库有意义。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2010-08-05T05:54:06.560

还有其他问题。

一些 STL 容器对于导出是“安全的”（例如 vector），而有些则不是（例如 map）。

例如 Map 是不安全的，因为它（无论如何在 MS STL 发行版中）包含一个名为 _Nil 的静态成员，它的值在迭代中进行比较以测试是否结束。使用 STL 编译的每个模块都有不同的 _Nil 值，因此在一个模块中创建的映射将不能从另一个模块迭代（它永远不会检测到结束并崩溃）。

即使您静态链接到一个库，这也适用，因为您永远无法保证 _Nil 的值是什么（它是未初始化的）。

我相信 STLPort 不会这样做。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2011-03-06T01:20:43.507

我发现处理这种情况的最佳方法是：

创建您的库，使用库名称中包含的编译器和 stl 版本对其进行命名，就像 boost 库一样。

例子：

**- FontManager-msvc10-mt.dll**用于 dll 版本，特定于 MSVC10 编译器，具有默认 stl。

**- FontManager-msvc10_stlport-mt.dll**用于 dll 版本，特定于 MSVC10 编译器，带有 stl 端口。

**- FontManager-msvc9-mt.dll**用于 dll 版本，特定于 MSVC 2008 编译器，具有默认 stl

**- libFontManager-msvc10-mt.lib**用于静态库版本，特定于 MSVC10 编译器，具有默认 stl。

遵循此模式，您将避免与不同 stl 实现相关的问题。请记住，vc2008 中的 stl 实现与 vc2010 中的 stl 实现不同。

使用 boost::config 库查看您的示例：

```
#include <boost/config.hpp>

#ifdef BOOST_MSVC
#  pragma warning( push )
#  pragma warning( disable: 4251 )
#endif

class DLL_EXPORT FontManager
{
public:
   std::map<int, std::string> int2string_map;
}

#ifdef BOOST_MSVC
#  pragma warning( pop )
#endif 
```

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-04-20T10:47:47.460

似乎很少有人考虑的一种替代方法是根本不使用 DLL，而是静态链接到静态 .LIB 库。如果你这样做，所有导出/导入的问题都会消失（尽管如果你使用不同的编译器，你仍然会遇到名称修改问题）。您当然会失去 DLL 体系结构的特性，例如函数的运行时加载，但在许多情况下，这可能是一个很小的代价。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-08-04T13:03:00.590

找到[这篇文章](http://www.unknownroad.com/rtfm/VisualStudio/warningC4251.html)。简而言之，亚伦在上面给出了“真实”的答案；不要跨库边界公开标准容器。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-11-21T20:16:45.030

虽然这个帖子很老了，但我最近发现了一个问题，这让我再次想到在我的导出类中使用模板：

我写了一个类，它有一个 std::map 类型的私有成员。一切都运行良好，直到它在发布模式下编译，即使在构建系统中使用，这确保所有编译器设置对于所有目标都是相同的。地图完全隐藏，没有任何东西直接暴露给客户。

结果，代码只是在发布模式下崩溃。我猜是因为为实现和客户端代码创建了不同的二进制 std::map 实例。

我猜 C++ 标准并没有说明如何处理导出的类，因为这几乎是特定于编译器的。所以我想最大的可移植性规则是只公开接口并尽可能多地使用 PIMPL 习惯用法。

感谢您的任何启发

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2015-04-08T05:05:17.570

> 从 dll 中导出包含 std:: 对象（向量、地图等）的类

另请参阅 Microsoft 的 KB 168958 文章[如何导出标准模板库 (STL) 类和包含作为 STL 对象的数据成员的类的实例化](http://support.microsoft.com/en-us/kb/168958)。来自文章：

> **导出 STL 类**
> 
> 1.  在 DLL 和 .exe 文件中，链接到 C 运行时的相同 DLL 版本。将两者都与 Msvcrt.lib 链接（发布版本）或将两者与 Msvcrtd.lib 链接（调试版本）。
> 2.  在 DLL 中，在模板实例化声明中提供 __declspec 说明符以从 DLL 导出 STL 类实例化。
> 3.  在 .exe 文件中，在模板实例化声明中提供 extern 和 __declspec 说明符以从 DLL 导入类。这会导致警告 C4231“使用非标准扩展：模板显式实例化之前的‘extern’。” 您可以忽略此警告。

和：

> **导出包含作为 STL 对象的数据成员的类**
> 
> 1.  在 DLL 和 .exe 文件中，链接到 C 运行时的相同 DLL 版本。将两者都与 Msvcrt.lib 链接（发布版本）或将两者与 Msvcrtd.lib 链接（调试版本）。
> 2.  在 DLL 中，在模板实例化声明中提供 __declspec 说明符以从 DLL 导出 STL 类实例化。
>     
>     注意：您不能跳过第 2 步。您必须导出用于创建数据成员的 STL 类的实例化。
> 3.  在 DLL 中，在类的声明中提供 __declspec 说明符以从 DLL 中导出类。
> 4.  在 .exe 文件中，在类的声明中提供 __declspec 说明符以从 DLL 导入类。如果您要导出的类有一个或多个基类，那么您也必须导出这些基类。
>     
>     如果您要导出的类包含属于类类型的数据成员，那么您也必须导出数据成员的类。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-04-20T10:57:48.827

在这种情况下，请考虑使用 pimpl 成语。将所有复杂类型隐藏在单个 void* 后面。编译器通常不会注意到您的成员是私有的并且所有方法都包含在 DLL 中。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-05-01T01:32:39.250

如果您使用 DLL，则在“DLL PROCESS ATTACH”事件中初始化所有对象并导出指向其类/对象的指针。
您可以提供特定的函数来创建和销毁对象以及获取所创建对象的指针的函数，因此您可以将这些调用封装在包含文件的访问包装类中。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2010-04-20T20:10:20.717

由于模板类中的静态数据成员（如 stl 容器），MSVC 无法接受上述任何解决方法

每个模块（dll/exe）都有自己的每个静态定义的副本......哇！如果您以某种方式“导出”此类数据（如上文“指出”），这将导致可怕的事情......所以不要在家里尝试这个

请参阅[http://support.microsoft.com/kb/172396/en-us](http://support.microsoft.com/kb/172396/en-us)

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2015-10-07T04:30:59.660

在这种情况下使用的最佳方法是使用 PIMPL 设计模式。

# dynamics-crm - 我应该把我的 ISV 项目文件放在哪里？

> ID：767580
> 
> 赞同：1
> 
> 时间：2009-04-20T09:38:50.967
> 
> 标签：dynamics-crm

我需要我的项目在多租户环境中运行。在 SDK 之后，我将 aspx 文件放在 C:\Inetpub\wwwroot\ISV\MyProject 中。然后我将 DLL 放在 C:\Program Files\Microsoft Dynamics CRM\Server\bin\assembly 中。

当我在 CRM 中查看我的页面时，我得到：

```
Could not load type 'MyProject._Default'. 
```

如果我将 DLL 放在 c:\wwwroot\inetpub\bin 文件夹中，则页面会加载，但我不知道（并且目前没有测试方法）这是否会离线工作。

此外，当我使用 c:\wwwroot\inetpub\bin 中的 DLL 加载我的页面时，它似乎工作正常。但是，当我使用地址 /isv/MyProject/default.aspx 将其添加到帐户页面中的 IFRAME 时，加载的页面无法正常工作，因为它丢失了组织的名称。有谁知道我应该使用哪个 URL 进行多租户？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-22T09:39:41.837

我认为开发 CRM 扩展以供普通 CRM 用户访问的最佳实践（即 = 每个人都有他/她自己的 CAL）是将页面存储在 [Installation folder]\CRMWeb\ISV 文件夹下的文件夹中。相应的 dll 应放在 [安装文件夹]\CRMWeb\bin 文件夹中。对我来说，这原来是

```
C:\Program Files\Microsoft Dynamics CRM\CRMWeb\ISV\MyApp 
```

也就是说，不在**Server**文件夹中，而是在**CRMWeb**文件夹中。

就多租户而言，调用 CRM Web 服务时必须使用**CrmAuthenticationToken参数。**该令牌又具有一个名为 OrganizationName 的属性。与 UI 集成的扩展（如 IFrame、按钮等）已经将这些信息作为 GET 参数提供给您的页面。检查此[MSDN 链接](http://msdn.microsoft.com/en-us/library/cc150848.aspx)以查看示例。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-23T18:49:29.903

从 rollup2 开始，ms 建议将您的 dll 放在您自己的项目 bin 文件夹中。在 CRM SDK 上查找“自定义代码最佳实践”以获取更多信息。

# content-management-system - 使用 XSL 列出 Sitecore CMS 中项目的所有字段

> ID：767588
> 
> 赞同：3
> 
> 时间：2009-04-20T09:40:34.610
> 
> 标签：content-management-system, xslt, field, sitecore

我在 sitecore (6) 中使用调试设备，当 URL 附加了某个查询字符串（激活设备）时，它将输出页面的“开发人员”视图。在页面上，我有项目名称、模板、分支主、工作流信息等。

我想使用 xsl 渲染列出项目上的所有字段 - 最好不包括隐藏的 (__) 字段，但它们是否存在并不重要。

我试过了：

```
<xsl:for-each select="$sc_item/fields/field"> 
```

但这仅列出了每个项目的五个字段：

*   __创建
*   __修订
*   __更新
*   __更新者
*   __锁

sitecore 文档说使用 sc 功能来访问字段*值*，但我需要先获取字段*名称*。

非常感谢任何帮助！

[编辑] 找到了解决方案 - 如果字段为空，则字段不会在项目 xml 中列出！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-20T09:44:33.337

休息一下后，我意识到了答案：项目 XML 中没有列出空字段！

# c# - 需要使用系统库对服务进行单元测试

> ID：767591
> 
> 赞同：2
> 
> 时间：2009-04-20T09:42:06.747
> 
> 标签：c#, unit-testing, tdd

我目前正在编写我正在编写的“PluginsService”。我需要使用 Assembly、AssemblyName、Directory 和 File 的系统库。目前我正在为每一个创建包装器接口，以便我可以在测试中模拟它们。但是，这确实意味着我必须将很多包装器注入到服务中。

因此，例如，当测试一种在文件夹中搜索某些插件的方法时，我正在这样做

```
With.Mocks(mockery)
    .Expecting(() =>
    {
            Expect.Call(directory.GetFiles(PLUGINPATH, PLUGINSEARCHPATTERN)).IgnoreArguments().Return(pluginLibraries);
            Expect.Call(file.ReadAllBytes(null)).IgnoreArguments().Return(bytes);
               Expect.Call(assemblyName.GetAssemblyName("fileName")).IgnoreArguments().Return(name);
            Expect.Call(assembly.GetExecutingAssembly()).Return(executingAssembly);
    })
    .Verify(() => result = service.FindAvailablePlugins()); 
```

我有两个问题：

1.  有没有更好的方法来处理 TDD 的系统库项目？
2.  4 个项目是否太多无法注入一个类？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-21T04:17:50.010

我最近做了同样的事情，并提出了一个设计，我有自己的`Directory`对象，它有一个`DirectoryBoundary`指向目录的链接。它`DirectoryBoundary`本身没有直接进行单元测试，但我使用了一些集成测试来覆盖它。

如果你朝这个方向走，我想你会发现你的设计变得更加流畅，你的集成点也更容易了。让我们面对现实吧，.NET 文件 IO 类并不是为可测试性而设计的。所以想出你自己的。你可以模拟新的`Directory`类，或者像我一样做，只是有假的边界类和你注入的某种形式的创建者。

希望有帮助。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-21T13:27:08.677

Oren 在测试中使用这样的东西来处理 DateTime：

```
public static class SystemTime
{
  public static Func<DateTime> Now = () => DateTime.Now;
} 
```

然后在测试中：

```
SystemTime.Now = () => new DateTime(2000,1,1);
repository.ResetFailures(failedMsgs); 
SystemTime.Now = () => new DateTime(2000,1,2);
var msgs = repository.GetAllReadyMessages(); 
Assert.AreEqual(2, msgs.Length); 
```

它是注入的替代方法，但不是线程安全的。 [在测试中处理时间](http://ayende.com/Blog/archive/2008/07/07/Dealing-with-time-in-tests.aspx)

# .htaccess - ISAPI 重写而不是 mod_rewrite

> ID：767592
> 
> 赞同：1
> 
> 时间：2009-04-20T09:42:08.647
> 
> 标签：.htaccess, mod-rewrite, rewrite, isapi, modx

我正在使用 ISAPI Rewrite 在 Windows 上安装 Modx 而不是使用 mod_rewrite 的 apache？

你如何定义重写规则？我猜不是 .htccess 文件？

有任何想法吗？谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2010-06-25T14:06:10.990

尝试：

```
RewriteRule ^/$    /index.php?REQUEST_URI=index.php [L] 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-21T17:12:37.683

根据[ISAPI_Rewrite 2 文档](http://www.isapirewrite.com/docs/)，您需要将[配置](http://www.isapirewrite.com/docs/#conffile)写入`httpd.ini`文件中的`[ISAPI_Rewrite]`部分：

```
[ISAPI_Rewrite]

RewriteRule … 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-07-09T14:32:15.250

[ISAPI_Rewrite 3](http://www.helicontech.com/isapi_rewrite/)的全局配置称为 httpd.conf，每个站点的分布式配置是 .htaccess。

# php - 使用准备好的语句在一个查询中修改多个表

> ID：767597
> 
> 赞同：0
> 
> 时间：2009-04-20T09:43:31.827
> 
> 标签：php, mysql

我有以下与 mysql 和 php 一起使用的准备好的查询。它是为了允许用户被添加到一个特定的类别中，通过 $subcat 传入。

```
$alterQuery = "UPDATE AUCTIONS SET subcat= ? WHERE article_no= ?";
   if ($altRecord = $con->prepare($alterQuery)) {
       $altRecord->bind_param("ss", $subcat, $pk);
       $altRecord->execute();
    $altRecord->close();
    echo "true";
    } 
```

在同一个查询中，我想做的是在检查用户名不存在之后，在 USERS 表中插入一条新记录，仅插入用户名。是否可以将 $alterQuery 更改为：

最好的方法是什么？

检查用户名，如果它== null，是否进行后续插入？我可以在同一个 if 块中执行两个不同的查询吗？

编辑：附加数据库方案以回应评论

```
AUCTIONS    

    ARTICLE_NO      varchar(20) primary key
    ARTICLE_NAME    varchar(100)
    SUBTITLE    varchar(20)
    CURRENT_BID     decimal(5,2)
    START_PRICE     decimal(5,2)
    BID_COUNT   varchar(20)
    QUANT_TOTAL     varchar(20)
    QUANT_SOLD  varchar(20)
    ACCESSSTARTS    varchar(30)
    ACCESSENDS  varchar(20)
    ACCESSORIGIN_END    varchar(20)
    USERNAME    varchar(20)     
    BEST_BIDDER_ID  varchar(20)     
    FINISHED    tinyint(4)  
    WATCH   tinyint(4)      
    BUYITNOW_PRICE  decimal(5,2)    
    PIC_URL     varchar(120)    
    PRIVATE_AUCTION     tinyint(4)
    AUCTION_TYPE    varchar(20)     
    ACCESSINSERT_DATE   varchar(20)
    ACCESSUPDATE_DATE   varchar(20)
    CAT_DESC    varchar(20)     
    CAT_PATH    varchar(20)     
    ARTICLE_DESC    text    
    COUNTRYCODE     varchar(20)
    LOCATION    varchar(20)
    CONDITIONS  varchar(20)
    REVISED     tinyint(4) 
    PAYPAL_ACCEPT   tinyint(4) 
    PRE_TERMINATED  tinyint(4) 
    SHIPPING_TO     varchar(20)
    FEE_INSERTION   decimal(5,2)
    FEE_FINAL   decimal(5,2)
    FEE_LISTING     decimal(5,2)
    PIC_XXL     tinyint(4) 
    PIC_DIASHOW     tinyint(4) 
    PIC_COUNT   varchar(20)
    ITEM_SITE_ID    varchar(20)
    STARTS  datetime    
    ENDS    datetime    
    ORIGIN_END  datetime
    SUBCAT  varchar(20)

USERS
    username    varchar(30) primary key
    firstname   varchar(30)
    lastname    varchar(30)
    flaggedauctions     varchar(30)
    lastauction     varchar(30)     
    street1     varchar(30)     
    city1   varchar(30)     
    postcode1   varchar(30)
    street2     varchar(30)
    city2   varchar(30)     
    postcode2   varchar(30)
    phone   varchar(30)     
    mobilephone     varchar(30) 
    fax     varchar(30)     
    email   varchar(30)     
    website     varchar(30) 
    bank    varchar(30)     
    banknumber  varchar(30)
    accountnumber   varchar(30)
    comments    varchar(30) 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-20T09:48:25.967

你为什么想这么做？将您的查询包含在事务中将是完整的提交或回滚。

[http://en.wikipedia.org/wiki/ACID#Atomicity](http://en.wikipedia.org/wiki/ACID#Atomicity)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-20T09:49:34.200

最好创建一个存储过程：

```
DELIMITER $$
CREATE PROCEDURE prc_add_user_to_category(_subcat VARCHAR(20), _article_no VARCHAR(20), _username VARCHAR(30))
BEGIN
        UPDATE  AUCTIONS
        SET     subcat= _subcat
        WHERE   article_no= _article_no;
        INSERT
        INTO    users (username)
        VALUES  (_username)
        ON DUPLICATE KEY
        UPDATE
        username = username;
END
$$
DELIMITER ; 
```

并从您的代码中调用它：

```
$alterQuery = "CALL prc_add_user_to_category(?, ?, ?)";
   if ($altRecord = $con->prepare($alterQuery)) {
       $altRecord->bind_param("ss", $subcat, $pk, $userid);
       $altRecord->execute();
    $altRecord->close();
    echo "true";
    } 
```

检查并证明可以编译并针对您的架构工作`5.2.0-falcon-alpha-community-nt-log`

# drupal - 右上角的用户设置模块（Drupal）

> ID：767599
> 
> 赞同：0
> 
> 时间：2009-04-20T09:44:15.633
> 
> 标签：drupal

是否有允许我将用户帐户信息放在右上角的 Drupal 模块？

[http://lh4.ggpht.com/_SDci0Pf3tzU/SexDUQGuhQI/AAAAAAAAEsQ/VzFzR_-CQIQ/s400/user%20logon.png](http://picasaweb.google.com/lh/photo/do6m0Hz5ffczC8d0rTzwrQ?feat=embedwebsite)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-20T15:59:06.527

[Logintoboggan](http://drupal.org/project/logintoboggan)有一个“以 xyz 身份登录 | 注销”块，但是否可以将其放在标题中取决于您使用的主题。

此外，[管理菜单模块](http://drupal.org/project/admin_menu)提供了类似的功能，但仅适用于管理员。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-20T19:05:37.063

自己写......这并不难......只需使用 hook_block，阅读它的文档并在您的模块中实现它。我假设您的网站有一个专用模块。

有关更多信息，请阅读此处的 hook_block 文档：http: [//api.drupal.org/api/function/hook_block](http://api.drupal.org/api/function/hook_block)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-24T09:35:04.330

请注意，由于这是一个“外观”问题，因此最好在主题层处理：

1.  实施挂钩块以根据需要在站点模块中创建具有此信息结构的块，或创建自定义块 admin/block
2.  自定义您的主题，以便在此位置有一个区域
3.  将块放置在该区域

# iphone - 我对 UIKit 中的框架和边界有正确的理解吗？

> ID：767604
> 
> 赞同：33
> 
> 时间：2009-04-20T09:45:46.113
> 
> 标签：iphone, uikit, uiview

让我试着解释一下。如果我错了，请告诉我。我对此只有 70% 的把握。

就像我理解的那样， UIView 有一个框架和一个边界矩形。框架矩形的工作是设置 UIView 相对于它的 superview 的位置。更准确地说：相对于父视图的坐标系。边界矩形的工作是设置 UIView 的绘图区域，相对于它自己的坐标系。

简要地：

*   框架矩形用于相对于其父视图定位 UIView
*   bounds rectangle 是设置UIView的绘图区域

我错过了什么错误或重要的事情吗？

* * *

## 回答 #1

> 赞同：38
> 
> 时间：2009-04-20T14:37:15.927

查看 Apple 的[View Geometry](https://developer.apple.com/library/content/documentation/Cocoa/Conceptual/CocoaViewsGuide/Coordinates/Coordinates.html)指南。他们有很好的例子来说明当你改变边界和帧值时会发生什么。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2010-03-19T13:15:18.477

视图的框架：视图将填充的父视图内矩形的位置和大小。

视图的边界：视图本身内部矩形的位置和大小。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-04-20T10:16:51.670

是的你是对的。

当你需要使用视图时，就使用框架；边界用于实际实现视图。例如，您需要使用边界来绘制视图或处理触摸事件。相反，您在创建视图或在其父视图中定位视图等时使用框架。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-04-20T10:53:05.793

你说的对。

您可以互换使用这两者，尽管只是在使用视图时框架更容易，而在视图内部工作时边界更容易（例如在事件处理或绘图代码中）

另请注意，如果在视图上进行了转换，则 frame 是未定义的。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2012-09-03T11:44:53.017

[http://developer.apple.com/library/ios/#documentation/windowsviews/conceptual/viewpg_iphoneos/WindowsandViews/WindowsandViews.html](http://developer.apple.com/library/ios/#documentation/windowsviews/conceptual/viewpg_iphoneos/WindowsandViews/WindowsandViews.html)

对于 iOS。原点坐标与 Mac OS 的位置不同（左上角，而不是左下角）

# java - 是否有 Swing hack 来查询或设置窗口的 Z 顺序？

> ID：767605
> 
> 赞同：6
> 
> 时间：2009-04-20T09:47:19.837
> 
> 标签：java, swing

我们正在尝试在退出时保存应用程序的状态并在启动时恢复它。状态的一部分是所有 JFrame 的相对 Z 顺序。

不幸的是，Swing 似乎没有提供任何方法来学习或设置窗口的 Z 顺序（即使相对于同一 VM 中的其他窗口）。

我们通过在所有窗口上按顺序调用 toFront() 来设置 Z 顺序。但查询 Z 顺序仍未解决。（添加焦点侦听器并不总是有效，例如，当一个人在一组窗口上使用 Windows 的“级联”操作时。）

有任何想法吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-20T12:27:18.017

没有任何粒度。

正如你所说，你可以调用 toFront() 和 toBack()，你可以要求一个窗口“留在顶部”，但仅此而已。

另一种选择是有一个带有内部框架的框架，并使用 setComponentZOrder() （但这仅适用于内部组件 - 您必须在容器上调用它）。

我相信它在 Swing 中没有成为优先事项的原因之一是对 Z 排序的支持非常依赖于平台。（但是，嘿，什么不是……）

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2009-08-26T19:26:27.237

您可以使用 Container 类中的 setComponentZOrder(Component c, int layer) 和 getComponentZOrder(Component c)。对此有一个 JDC 技术提示：http: [//72.5.124.55/developer/JDCTechTips/2005/tt0118.html](http://72.5.124.55/developer/JDCTechTips/2005/tt0118.html)

# visual-studio - 使用 Visual Studio 宏名称启动外部应用程序不起作用？

> ID：767607
> 
> 赞同：0
> 
> 时间：2009-04-20T09:48:12.190
> 
> 标签：visual-studio, debugging, arguments, macros

使用 Visual Studio / C#，我最近一直在调试一些 nunit 测试，现在我试图确保如果我们分支代码，单元测试不会停止在调试模式下工作。

我通过更改项目属性以将 NUnit 作为外部程序启动来实现这一点：

```
C:\Program Files\NUnit 2.4.8\bin\nunit-console.exe 
```

..然后设置我的 .nunit 配置：

```
D:\SomePath\branches\NewFeatureBranch\TestDSP.nunit 
```

所以现在我想让这条路径通用。我认为这样的事情应该有效：

```
$(SolutionDir)\$(ProjectName).nunit 
```

...但是 NUnit 在运行测试之前退出。尽管作为快速控制台应用程序告诉我，这些变量似乎没有被发送：

```
arg[0] = D:\Projects\Tools\ArgDebugger\Debug\ArgDebugger.exe
arg[1] = $(SolutionDir)\$(ProjectName).nunit 
```

还有其他方法可以提供这些信息吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-20T10:24:27.453

好吧，当我构建两个控制台应用程序时。

App2 与 App1 一起调试。在 App1 System.IO.Directory.GetCurrentDirectory() 给出

*App2的Solution\Project\Bin\Debug*。

因此将*..\..\..\*放入 App2 的工作目录给了我

*App2 的*解决方案\* 因此，您可以将 .nunit 文件的路径更改为*./TestDSP.nunit**

 *# mvvm - CommandSink 背后的隐喻是什么？

> ID：767612
> 
> 赞同：2
> 
> 时间：2009-04-20T09:49:05.107
> 
> 标签：mvvm

我正在研究[Josh Smith 在 CommandSink 上的代码和文章，](http://www.codeproject.com/KB/WPF/VMCommanding.aspx)这是一种简化在 MVVM 上下文中使用命令的解决方案，似乎非常有用。

但我觉得我错过了一些关于这个概念的东西，因为我不理解“sink”这个词指的是什么，例如

*   命令***沉入***ViewModel 背后的代码？
*   命令在集合中，例如盘子在***水槽***中？
*   或者这是保持 View 和 ViewModel***同步***的文字游戏？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-20T09:56:11.390

我认为恰当的比喻与电子产品中“接地”与电荷一起使用的方式有关。“接收器”通常是负责最终接收和清理它正在接收的任何东西的实体。

这意味着在这种情况下，命令在到达接收器后不会继续在系统中使用，它是行尾。

我认为[这个条目](http://en.wikipedia.org/wiki/Sink_%28computing%29)是相关的，但阅读[消歧](http://en.wikipedia.org/wiki/Sink_%28disambiguation%29)列表也是说明性的。

# c# - 使用 C# 识别 CPU 架构类型

> ID：767613
> 
> 赞同：24
> 
> 时间：2009-04-20T09:49:08.287
> 
> 标签：c#, architecture, cpu, identify

我想检查用户正在运行哪个 CPU 架构，是 i386 还是 X64 还是 AMD64。我想用 C# 来做。我知道我可以尝试 WMI 或注册表。除了这两种方法还有其他方法吗？我的项目面向 .NET 2.0！

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2009-04-20T09:55:46.430

您也可以尝试（仅在不被操纵的情况下才有效）：

```
System.Environment.GetEnvironmentVariable("PROCESSOR_ARCHITECTURE") 
```

* * *

## 回答 #2

> 赞同：28
> 
> 时间：2012-05-07T13:33:22.227

导致我来到这里的是检查 32 位和 64 位操作系统。评分最高的答案是查看**Current process**的设置。在没有找到答案后，我找到了以下设置。希望这对你有用。

```
bool is64 = System.Environment.Is64BitOperatingSystem 
```

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2017-07-28T12:37:43.197

我知道这个问题来自过去，但截至 2017 年，现在有一种简单的方法可以了解当前进程的架构，在 .net 标准中：

```
System.Runtime.InteropServices.RuntimeInformation.ProcessArchitecture 
```

返回的值是 X86、X64、ARM、ARM64 之一，并给出了它正在运行的进程的`OSArchitecture`体系结构。而是返回已安装操作系统的体系结构。

文档的链接（虽然非常没用......）：

RuntimeInformation.ProcessArchitecture： [https ://docs.microsoft.com/en-us/dotnet/api/system.runtime.interopservices.runtimeinformation.processarchitecture?view=netstandard-1.4](https://docs.microsoft.com/en-us/dotnet/api/system.runtime.interopservices.runtimeinformation.processarchitecture?view=netstandard-1.4)

架构枚举： [https ://docs.microsoft.com/en-us/dotnet/api/system.runtime.interopservices.architecture?view=netstandard-1.4](https://docs.microsoft.com/en-us/dotnet/api/system.runtime.interopservices.architecture?view=netstandard-1.4)

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2012-08-27T09:37:15.313

这是一段似乎有效的代码（基于 P/Invoke）；它允许确定 CPU/机器架构、当前进程架构以及给定的二进制文件架构（如何编译）：

```
 public enum Architecture
    {
        Unknown,
        x86,
        x64,
        arm64,
    }

    public static Architecture ProcessArchitecture
    {
        get
        {
            var si = new SYSTEM_INFO();
            GetSystemInfo(ref si);
            return GetArchitecture(ref si);
        }
    }

    public static Architecture MachineArchitecture
    {
        get
        {
            var si = new SYSTEM_INFO();
            GetNativeSystemInfo(ref si);
            return GetArchitecture(ref si);
        }
    }

    public static Architecture ReadFileArchitecture(string filePath)
    {
        if (filePath == null)
            throw new ArgumentNullException(nameof(filePath));

        using (var stream = File.OpenRead(filePath))
        {
            return ReadFileArchitecture(stream);
        }
    }

    // note .NET dll will come out as x86
    public static Architecture ReadFileArchitecture(Stream stream)
    {
        if (stream == null)
            throw new ArgumentNullException(nameof(stream));

        var length = stream.Length;
        if (length < 64)
            return Architecture.Unknown;

        var reader = new BinaryReader(stream);
        stream.Position = 60;
        var peHeaderPtr = reader.ReadUInt32();
        if (peHeaderPtr == 0)
        {
            peHeaderPtr = 128;
        }
        if (peHeaderPtr > length - 256)
            return Architecture.Unknown;

        stream.Position = peHeaderPtr;
        var peSignature = reader.ReadUInt32();
        if (peSignature != 0x00004550) // "PE"
            return Architecture.Unknown;

        var machine = reader.ReadUInt16();
        Architecture arch;
        switch (machine)
        {
            case IMAGE_FILE_MACHINE_AMD64:
                arch = Architecture.x64;
                break;

            case IMAGE_FILE_MACHINE_I386:
                arch = Architecture.x86;
                break;

            case IMAGE_FILE_MACHINE_ARM64:
                arch = Architecture.arm64;
                break;

            default:
                return Architecture.Unknown;
        }
        return arch;
    }

    private static Architecture GetArchitecture(ref SYSTEM_INFO si)
    {
        switch (si.wProcessorArchitecture)
        {
            case PROCESSOR_ARCHITECTURE_AMD64:
                return Architecture.x64;

            case PROCESSOR_ARCHITECTURE_ARM64:
                return Architecture.arm64;

            case PROCESSOR_ARCHITECTURE_INTEL:
                return Architecture.x86;

            default:
                throw new PlatformNotSupportedException();
        }
    }

    private const int PROCESSOR_ARCHITECTURE_AMD64 = 9;
    private const int PROCESSOR_ARCHITECTURE_INTEL = 0;
    private const int PROCESSOR_ARCHITECTURE_ARM64 = 12;
    private const int IMAGE_FILE_MACHINE_ARM64 = 0xAA64;
    private const int IMAGE_FILE_MACHINE_I386 = 0x14C;
    private const int IMAGE_FILE_MACHINE_AMD64 = 0x8664;

    [DllImport("kernel32")]
    private static extern void GetSystemInfo(ref SYSTEM_INFO lpSystemInfo);

    [DllImport("kernel32")]
    private static extern void GetNativeSystemInfo(ref SYSTEM_INFO lpSystemInfo);

    [StructLayout(LayoutKind.Sequential)]
    private struct SYSTEM_INFO
    {
        public short wProcessorArchitecture;
        public short wReserved;
        public int dwPageSize;
        public IntPtr lpMinimumApplicationAddress;
        public IntPtr lpMaximumApplicationAddress;
        public IntPtr dwActiveProcessorMask;
        public int dwNumberOfProcessors;
        public int dwProcessorType;
        public int dwAllocationGranularity;
        public short wProcessorLevel;
        public short wProcessorRevision;
    } 
```

此代码支持 x86、x64 和 arm64 架构以及 Windows XP。[在现代版本的 .NET 中，您在System.Runtime.InteropServices.RuntimeInformation 命名空间](https://docs.microsoft.com/en-us/dotnet/api/system.runtime.interopservices.runtimeinformation)中有内置函数。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2009-04-20T09:55:07.977

[Win32_Processor](http://msdn.microsoft.com/en-us/library/aa394373(VS.85).aspx) WMI 类将完成这项工作。使用[MgmtClassGen.exe](http://msdn.microsoft.com/en-us/library/2wkebaxa(VS.80).aspx)生成强类型包装器。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2014-08-13T11:08:45.183

最后，在 C# 中为当前运行的 CLR 运行时解析平台/处理器架构的最短技巧是：

```
PortableExecutableKinds peKind;
ImageFileMachine machine;
typeof(object).Module.GetPEKind(out peKind, out machine); 
```

此处[Module.GetPEKind](http://msdn.microsoft.com/en-us/library/system.reflection.module.getpekind%28v=vs.110%29.aspx)返回一个[ImageFileMachine](http://msdn.microsoft.com/en-us/library/system.reflection.imagefilemachine%28v=vs.110%29.aspx)枚举，该枚举自 .NET v2 起就存在：

```
public enum ImageFileMachine
{
    I386    = 0x014C,
    IA64    = 0x0200,
    AMD64   = 0x8664,
    ARM     = 0x01C4    // new in .NET 4.5
} 
```

为什么不使用`new AssemblyName(fullName)`or `typeof(object).Assembly.GetName()`？那么在 ASP.NET MVC 源代码中
有这样的注释（从 1.0 开始）：`HACK`

```
private static string GetMvcVersionString() {
    // DevDiv 216459:
    // This code originally used Assembly.GetName(), but that requires FileIOPermission, which isn't granted in
    // medium trust. However, Assembly.FullName *is* accessible in medium trust.
    return new AssemblyName(typeof(MvcHttpHandler).Assembly.FullName).Version.ToString(2);
} 
```

看到他们为自己使用了一些隐藏的技巧。可悲的是，`AssemblyName`构造函数没有`ProcessorArchitecture`正确设置该字段，它只是`None`用于任何新的 AssemblyName。

因此，对于未来的读者，让我推荐您将丑陋的 GetPEKind 与 ImageFileMachine 一起使用！

笔记：

*   这将返回当前运行的运行*时架构*，而不是底层系统架构！
    也就是说，唯一的例外是 I386 运行时可能在 AMD64 系统上运行。
*   在单声道/ubuntu 14.04/AMD64 和 .NET/Win7/I386 上测试。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2017-12-19T01:05:30.430

这个怎么样？

```
switch (typeof(string).Assembly.GetName().ProcessorArchitecture) {
    case System.Reflection.ProcessorArchitecture.X86:
        break;
    case System.Reflection.ProcessorArchitecture.Amd64:
        break;
    case System.Reflection.ProcessorArchitecture.Arm:
        break;
} 
```

不过`case *.Arm:`还没有测试。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2014-11-03T12:30:44.253

根据您想知道的原因，您可能会发现检查 IntPtr 结构的大小是最简单的方法。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-04-20T10:00:54.967

也许[这篇](http://www.codeproject.com/KB/system/GetHardwareInformation.aspx)CodeProject 文章可以提供帮助？它使用 System.Management 命名空间中的 ManagementObjectSearcher 来搜索硬件信息。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-04-20T09:51:22.637

你可以问用户吗？

当然开个玩笑...我认为 WMI 是您将使用的。但也许还有其他方法？

如果你选择 WMI，那么 LinqToWmi 可能会有用。我试过一次，它看起来很简单 =) -> [http://www.codeplex.com/linq2wmi](http://www.codeplex.com/linq2wmi)

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2012-02-15T15:18:22.437

这对我来说似乎是最简单的：

```
System.Environment.Is64BitOperatingSystem 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2020-01-15T10:54:49.697

这是我的方式：

如果操作系统是 Linux，请 pinvoke libc-syscall uname，您将在 Machine-field 中拥有处理器。

如果操作系统是 Windows，检查 System.IntPtr.Size * 8 = 64，那么它是 64 位的。如果不是 64 位，则检查 IsWow64Process 是否存在，如果存在，并且进程是 Wow64，则它是 x86-64，否则它是 x86-32。

这个靠谱。
检查处理器架构环境变量不是。

代码：

```
namespace RamMonitorPrototype
{

    // https://stackoverflow.com/a/55202696/155077
    //[System.Runtime.InteropServices.StructLayout(System.Runtime.InteropServices.LayoutKind.Sequential)]
    //unsafe internal struct Utsname_internal
    //{
    //    public fixed byte sysname[65];
    //    public fixed byte nodename[65];
    //    public fixed byte release[65];
    //    public fixed byte version[65];
    //    public fixed byte machine[65];
    //    public fixed byte domainname[65];
    //}

    public class Utsname
    {
        public string SysName; // char[65]
        public string NodeName; // char[65]
        public string Release; // char[65]
        public string Version; // char[65]
        public string Machine; // char[65]
        public string DomainName; // char[65]

        public void Print()
        {
            System.Console.Write("SysName:\t");
            System.Console.WriteLine(this.SysName); // Linux 

            System.Console.Write("NodeName:\t");
            System.Console.WriteLine(this.NodeName); // System.Environment.MachineName

            System.Console.Write("Release:\t");
            System.Console.WriteLine(this.Release); // Kernel-version

            System.Console.Write("Version:\t");
            System.Console.WriteLine(this.Version); // #40~18.04.1-Ubuntu SMP Thu Nov 14 12:06:39 UTC 2019

            System.Console.Write("Machine:\t");
            System.Console.WriteLine(this.Machine); // x86_64

            System.Console.Write("DomainName:\t");
            System.Console.WriteLine(this.DomainName); // (none)
        }

    }

    // https://github.com/microsoft/referencesource/blob/master/System/compmod/microsoft/win32/UnsafeNativeMethods.cs
    // https://github.com/dotnet/corefx/blob/master/src/Common/src/CoreLib/System/Environment.Windows.cs
    public class DetermineOsBitness
    {
        private const string Kernel32 = "kernel32.dll";

        [System.Runtime.InteropServices.DllImport("libc", EntryPoint = "uname", CallingConvention = System.Runtime.InteropServices.CallingConvention.Cdecl)]
        private static extern int uname_syscall(System.IntPtr buf);

        // https://github.com/jpobst/Pinta/blob/master/Pinta.Core/Managers/SystemManager.cs
        public static Utsname Uname()
        {
            Utsname uts = null;
            System.IntPtr buf = System.IntPtr.Zero;

            buf = System.Runtime.InteropServices.Marshal.AllocHGlobal(8192);
            // This is a hacktastic way of getting sysname from uname ()
            if (uname_syscall(buf) == 0)
            {
                uts = new Utsname();
                uts.SysName = System.Runtime.InteropServices.Marshal.PtrToStringAnsi(buf);

                long bufVal = buf.ToInt64();
                uts.NodeName = System.Runtime.InteropServices.Marshal.PtrToStringAnsi(new System.IntPtr(bufVal + 1 * 65));
                uts.Release = System.Runtime.InteropServices.Marshal.PtrToStringAnsi(new System.IntPtr(bufVal + 2 * 65));
                uts.Version = System.Runtime.InteropServices.Marshal.PtrToStringAnsi(new System.IntPtr(bufVal + 3 * 65));
                uts.Machine = System.Runtime.InteropServices.Marshal.PtrToStringAnsi(new System.IntPtr(bufVal + 4 * 65));
                uts.DomainName = System.Runtime.InteropServices.Marshal.PtrToStringAnsi(new System.IntPtr(bufVal + 5 * 65));

                if (buf != System.IntPtr.Zero)
                    System.Runtime.InteropServices.Marshal.FreeHGlobal(buf);
            } // End if (uname_syscall(buf) == 0) 

            return uts;
        } // End Function Uname

        [System.Runtime.InteropServices.DllImport(Kernel32, CharSet = System.Runtime.InteropServices.CharSet.Auto, BestFitMapping = false)]
        [System.Runtime.Versioning.ResourceExposure(System.Runtime.Versioning.ResourceScope.Machine)]
        private static extern System.IntPtr GetModuleHandle(string modName);

        [System.Runtime.InteropServices.DllImport(Kernel32, CharSet = System.Runtime.InteropServices.CharSet.Ansi, BestFitMapping = false, SetLastError = true, ExactSpelling = true)]
        [System.Runtime.Versioning.ResourceExposure(System.Runtime.Versioning.ResourceScope.None)]
        private static extern System.IntPtr GetProcAddress(System.IntPtr hModule, string methodName);

        [System.Runtime.InteropServices.DllImport(Kernel32, SetLastError = true, CallingConvention = System.Runtime.InteropServices.CallingConvention.Winapi)]
        [return: System.Runtime.InteropServices.MarshalAs(System.Runtime.InteropServices.UnmanagedType.Bool)]
        private static extern bool IsWow64Process(
             [System.Runtime.InteropServices.In] Microsoft.Win32.SafeHandles.SafeHandleZeroOrMinusOneIsInvalid hProcess,
             [System.Runtime.InteropServices.Out, System.Runtime.InteropServices.MarshalAs(System.Runtime.InteropServices.UnmanagedType.Bool)] out bool wow64Process
        );

        [System.Security.SecurityCritical]
        private static bool DoesWin32MethodExist(string moduleName, string methodName)
        {
            System.IntPtr hModule = GetModuleHandle(moduleName);

            if (hModule == System.IntPtr.Zero)
            {
                System.Diagnostics.Debug.Assert(hModule != System.IntPtr.Zero, "GetModuleHandle failed.  Dll isn't loaded?");
                return false;
            }

            System.IntPtr functionPointer = GetProcAddress(hModule, methodName);
            return (functionPointer != System.IntPtr.Zero);
        }

        public static bool Is64BitOperatingSystem()
        {
            if (System.IntPtr.Size * 8 == 64)
                return true;

            if (!DoesWin32MethodExist(Kernel32, "IsWow64Process"))
                return false;

            bool isWow64;

            using(Microsoft.Win32.SafeHandles.SafeWaitHandle safeHandle = new Microsoft.Win32.SafeHandles.SafeWaitHandle(System.Diagnostics.Process.GetCurrentProcess().Handle, true))
            {
                IsWow64Process(safeHandle, out isWow64);
            }
            return isWow64;
        }

        // This doesn't work reliably
        public static string GetProcessorArchitecture()
        {
            string strProcessorArchitecture = null;

            try
            {
                strProcessorArchitecture = System.Convert.ToString(System.Environment.GetEnvironmentVariable("PROCESSOR_ARCHITECTURE"));

                switch (typeof(string).Assembly.GetName().ProcessorArchitecture)
                {
                    case System.Reflection.ProcessorArchitecture.X86:
                        strProcessorArchitecture = "x86";
                        break;
                    case System.Reflection.ProcessorArchitecture.Amd64:
                        strProcessorArchitecture = "x86";
                        break;
                    case System.Reflection.ProcessorArchitecture.Arm:
                        strProcessorArchitecture = "ARM";
                        break;
                }

                bool is64bit = !string.IsNullOrEmpty(System.Environment.GetEnvironmentVariable("PROCESSOR_ARCHITEW6432"));

                if (is64bit)
                    strProcessorArchitecture += "-64";
                else
                    strProcessorArchitecture += "-32";
            }
            catch (System.Exception ex)
            {
                strProcessorArchitecture = ex.Message;
            }

            return strProcessorArchitecture;
        } // End Function GetProcessorArchitecture

    }

} 
```

* * *

## 回答 #13

> 赞同：-1
> 
> 时间：2009-04-20T10:17:46.287

我相信你应该避免像 WMI 和 LINQ 这样的臃肿。你最终必须得到更多的信息，而这些都不能满足于臃肿的 API 和框架。

只需调用一个调用并提取 CPUID 信息的 dll。C++/CLI 或 pinvoke 可以获取您需要的有关供应商的所有信息。首先，您需要查看是否支持该指令（99% 的时间是）。

要快速启动和运行，请检查英特尔站点的 wincpuid 示例并从那里从 cpuid.h 中提取该片段。只有 2 家供应商，其中一家擅长内存延迟，而另一家则不然（例如本机代码与托管代码）。所以你会在其他架构等上遇到 Mono 的问题（谁没有顺便说一句）。至于 x64，您已经知道它或者只是获得了 corflags（它已经存在并使用 .NET 分发杀死您的客户硬盘驱动器）..

（[http://software.intel.com/en-us/articles/api-detects-ia-32-and-x64-platform-cpu-characteristics/](http://software.intel.com/en-us/articles/api-detects-ia-32-and-x64-platform-cpu-characteristics/)）

* * *

## 回答 #14

> 赞同：-4
> 
> 时间：2011-08-22T05:56:01.837

这是我所做的：

```
public static bool Isx86()
{
    return (Environment.ExpandEnvironmentVariables("%ProgramFiles(x86)%").Length == 0);
} 
```

如果您使用 64 位架构，您将有两个程序文件环境变量。如果您使用的是 x86，那么您将只有一个。

# c# - 如何为 winforms 文本框实现类似智能感知的建议框？

> ID：767622
> 
> 赞同：3
> 
> 时间：2009-04-20T09:53:05.923
> 
> 标签：c#, .net, winforms, intellisense, autosuggest

我们有一个文本框，用户可以在其中输入一组术语，用逗号分隔并用换行符分隔。可能有数千个有效术语，因此我们希望在用户键入时提供智能感知式建议。默认的自动完成是不够的，因为它只会对整个文本框进行前缀匹配，并且不支持多行文本框。如何为 winforms 文本框实现类似智能感知的建议框？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-20T09:58:09.560

我在 2005 年写了[这篇](http://www.codeproject.com/KB/cs/diy-intellisense.aspx)关于使用列表框和文本框控件（或者它可能是 RTB）进行智能感知的文章。它远非完美或完美，但可能会让您入门。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-20T09:57:39.500

我正是使用[Infragistics UltraCombo 组件](http://www.infragistics.com/dotnet/netadvantage.aspx)来做到这一点的。不幸的是，它不是免费的。

# c# - 使用 WatIN 确定网站在谷歌中的位置

> ID：767624
> 
> 赞同：1
> 
> 时间：2009-04-20T09:53:34.970
> 
> 标签：c#, watin

我正在使用 WatIn - 并拥有当前脚本：

```
IE ie = new IE("http://www.google.co.il");
ie.TextField(Find.ByName("q")).TypeText(mykeyword);
ie.Button(Find.ByName("btnG")).Click(); 
```

现在我想以某种方式了解我的网站所处的位置。

我知道谷歌将网站的网址包装在他们的页面中（我正在解析 google.co.il）：

```
<span dir=ltr>www.website.co.il/</span> 
```

我知道它应该是这样的：ie.Span(Find.XXX))

我是 WatIN 的新手，将不胜感激。

提前致谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-20T10:20:30.133

自己找到了解决方案：

```
 using (IE ie = new IE("http://www.google.co.il"))
            {
                ie.TextField(Find.ByName("q")).TypeText(keyword);
                ie.Button(Find.ByName("btnG")).Click();
                int position = 1;
                label1.Text = "";
                foreach (Span span in ie.Spans)
                {
                    if (span.OuterHtml.ToLower().StartsWith("<span dir=ltr>"))
                    {
                        label1.Text += position.ToString() + ": " + span.InnerHtml + "\n";
                        position++;
                    }
                }
            } 
```

# php - 从时间中删除 5 小时

> ID：767628
> 
> 赞同：2
> 
> 时间：2009-04-20T09:56:00.783
> 
> 标签：php, datetime, strtotime

我正在使用 strtotime 从一些复杂的 XML 创建时间戳，但时区不正确。

如何从时间中删除 5 小时？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-20T09:58:34.257

如果您知道时区，则可以使用[`date_default_timezone_set()`](http://is.php.net/manual/en/function.date-default-timezone-set.php)

设置好后，您可以在 strtotime() 中执行此操作，如您所知。

```
strtotime("-5 hours", $time); 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-20T10:03:35.447

你可能想要这样的东西：

```
date('Y-m-d H:i:s', time() - 18000); 
```

这会将字符串格式化为日期和时间，表示自纪元以来的当前时间（以秒为单位） - 18000 秒（五小时）。您可以调整要减去的数字来调整调整的小时数。如果将 18000 写为 (60*60*5) 可能会更清楚。

strtotime() 对于排序不同于美国的字符串可能会产生意想不到的后果。欧洲符号 (01/02/2009) 将被解读为 1 月 2 日，而它的意思是 2 月 1 日。这是我在 olafur 的解决方案中看到的唯一问题，除了它是可靠的，但是这个或那个都可以。

# c++ - 我将如何为图像格式编写 Photoshop 插件？

> ID：767644
> 
> 赞同：4
> 
> 时间：2009-04-20T10:04:03.260
> 
> 标签：c++, image, photoshop

我有一种图像格式，而 Photoshop 不支持它。我的任务是编写一个插件来导入或打开格式，但那里的信息似乎很少，我能找到的信息都是关于编写过滤器的。但是，我想导入/导出/打开，而不是过滤它。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-20T10:25:46.127

我使用 Photoshop 导入滤镜的经验大约有六年了，所以请用一粒（旧的）盐来评论。

我只是将官方 SDK 中的导入过滤器示例代码作为样板，并添加了我自己的解码功能。这是一项直截了当的工作，从开始到结束花了一周的时间。

如果我没记错的话，最糟糕的是：

1.  正确设置编译器并编译示例代码（两天）

2.  了解 Photoshop GUI 的工作原理。当时它不是标准的win32，而是基于半mac资源的东西。我认为他们已经改变了这一点。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-06-17T04:22:13.327

您需要获得一份[Photoshop SDK](http://www.adobe.com/devnet/photoshop/sdk/index.html)的副本。这包含编写导入插件所需的所有文档和源示例。

# php - 数据库中变量的if else条件问题

> ID：767649
> 
> 赞同：0
> 
> 时间：2009-04-20T10:09:23.637
> 
> 标签：php

我正在从数据库中检索一个字段到 $subcat。如果 $subcat 为空，我想显示要添加到类别的表单，否则我想显示类别。$subcat 肯定存在并被正确检索。它是 null 或字符串。

```
if ($subcat != null) {
$showCategory = "<p><strong>Auction Category: </strong> ".$tmp['subcat'];
}
else 
{
$showCategory = "<form name=\"categoryForm\">
  <input name=\"radiobutton\" type=\"radio\" value=\"fakeapproved\" />Fake (Approved)<p>
  <input name=\"radiobutton\" type=\"radio\" value=\"fakesuspected\" />Fake (Suspected)<p>
  <input name=\"radiobutton\" type=\"radio\" value=\"keyword\" />Forbidden Keywords<p>
  <input name=\"radiobutton\" type=\"radio\" value=\"parallelimport\" />Parallel Imports
  <input name=\"Submit\" type=\"submit\" value=\"Update\" onclick=\"handleClick(".$pk.");return false\"/>
</form>";
} 
```

然而，所显示的只是形式。当 $subcat 明确地，毫无疑问不为空时，表单仍然显示。我尝试交换 else 子句，但随后显示类别，即使 $subcat 可验证为空。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-20T10:20:08.167

如果变量实际上为 NULL，则 is null 有效。如果变量是空字符串 ("")、零、假或空数组，则 is_null 的计算结果为假。这有点违反直觉，所以我总是建议使用 empty() 。

empty() 为 0、空字符串、空数组、布尔值 false 或 NULL 返回 true。所以试试：

```
if(!empty($subcat)){ do something; } 
```

仅当您 100% 确定您只想在变量为 NULL 时做某事时才使用 is_null。Empty 通常更好地检查您是否要在意外的情况下调用类方法。

编辑：哦，有时从数据库中检索 NULL 会给你字符串“NULL”，它与实际的 NULL 值不同。这取决于您使用的数据库以及您如何将值首先保存到数据库中。这很容易被忽略，并且可能需要很长时间才能弄清楚。尝试 var_dump()'ing 您的 subcat 变量以查看它是“NULL”字符串 (4) 还是字面上的 NULL 值。这可能是您在评论中提到的其他代码段中出现意外行为的原因。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-20T10:14:12.923

[在 php 中，您可以使用is_null](http://fi.php.net/is_null)检查变量是否为空

所以使用：

```
if (!is_null($subcat)) { 
```

# html - 为什么在涉及 colspan 时 IE 会忽略单元格的宽度？

> ID：767653
> 
> 赞同：1
> 
> 时间：2009-04-20T10:11:21.027
> 
> 标签：html, internet-explorer

考虑这个（剪断的）例子

```
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">>
<body>
    <table style="background-color: Navy; width:400px">
        <tr>
            <td style="background-color: Green; width:35px">test</td>
            <td style="background-color: Green; width:35px">test</td>
            <td style="background-color: Green; width:35px">t</td>
            <td style="background-color: Green">buffer</td>
        </tr>
        <tr>
            <td colspan="4">
                <img src="http://www.tiepvoud.nl/archief/boris_jeltsin.jpg" alt="Product Mixing Gauges" width="400" />
            </td>
        </tr>
    </table>
</body>
</html> 
```

这在除 IE 之外的所有浏览器中都可以正常工作。如果图像足够小（比如 40），一切都很好。当图像的大小有点大（比如 200）时，IE 开始调整单元格宽度。
发生了什么？

**--SIDENOTE--**
给建议使用 CSS 的人。我知道。这是一个抽象的例子。表格仍然是有效的 HTML，不必担心。表格数据应该在表格中。用 div 重新发明表格至少与创建基于表格的布局一样亵渎神明。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-20T10:23:01.827

如果您硬编码第 4 列的宽度，它会按预期工作......

> ```
> ...
> <td style="background-color: Green; width:295px">buffer</td>
> ... 
> ```

它忽略 colspan 属性，所以如果图像的宽度大于第一列，它就会混合在一起。搜索“ [IE6 colspan bug](http://www.google.com/search?hl=en&lr=&ie=UTF-8&q=IE+6+colspan+bug&btnG=Search) ”...

* * *

[编辑：]如果你必须用桌子来做，那（不漂亮）可能会起作用：

```
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">>
<body>
    <table style="background-color: Navy; width:400px">
        <tr>
          <td>
            <table width="100%">
              <tr>
                <td style="background-color: Green; width:35px">test</td>
                <td style="background-color: Green; width:35px">test</td>
                <td style="background-color: Green; width:35px">t</td>
                <td style="background-color: Green">buffer</td>
              </tr>
            </table>
          </td>
        </tr>
        <tr>
          <td colspan="4">
            <img src="http://www.tiepvoud.nl/archief/boris_jeltsin.jpg" alt="Product Mixing Gauges" width="400" />
          </td>
        </tr>
    </table>
</body>
</html> 
```

让我想起了[一点](https://stackoverflow.com/questions/469445/last-words-of-a-programmer/470462#470462)

但我真的认为你**应该使用 CSS**进行布局！！！

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-20T10:32:33.287

试试这个：

```
<style type="text/css">table {table-layout: fixed;}</style> 
```

它应该有效，我猜这只发生在 IE6 中（不适用于 IE7 和 IE8）

或者您可以在第 4 列中使用 width:auto

```
<td style="background-color: Green; width: auto;">buffer</td> 
```

顺便说一句，我希望你没有使用上面的代码来创建基于表格的布局（这是旧时尚，嘿，你今天应该学习基于 CSS 的布局）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-20T10:14:46.370

如果您在`<html>`标签上方指定了任何 DOCTYPE

如果您将其更改为，它是否有效

```
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"> 
```

或者

```
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"> 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-20T10:37:43.867

尝试在一些东西上设置**溢出**CSS 属性，比如表格

例如：`<table style="background-color: Navy; width:400px;**overflow: hidden**">`

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-20T10:55:42.327

有一个名为[960](http://960.gs/)的基于 CSS 的网格系统，它易于学习，适用于 IE、FF 和 Sarari。它将有助于强制执行您定义的列跨度并创建更清晰的标记。这是一个很好的[教程](http://net.tutsplus.com/tutorials/html-css-techniques/prototyping-with-the-grid-960-css-framework/)。

起初我持怀疑态度，因为我是一个 ASP.NET 的老家伙，但它为我节省了大量的维护和跨浏览器问题的时间。我还发现，通过减少使用表，我可以更快地整合更多客户端功能。这是一个明确的优势。

# c# - 如何安全地计算会话数：Global.Asax 中的 Session_Start/End 是否足够安全？

> ID：767654
> 
> 赞同：2
> 
> 时间：2009-04-20T10:11:54.707
> 
> 标签：c#, session

我想知道给定时间的并发会话数量。但是对于蜘蛛和负载平衡器以及可能不知道的影响，在全局 asax 中执行此操作有多安全：

```
void Session_Start(object sender, EventArgs e)
{
  counter++;
}

void Session_End(object sender, EventArgs e)
{
  counter--;
} 
```

有小费吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-20T10:20:06.437

至少，这个解决方案有一个线程问题（除了你提到的可能影响你的其他问题，我不会介绍）：

增量和减量任务应该以原子方式使用[`Interlocked.Increment`](http://msdn.microsoft.com/en-us/library/dd78zt0c(loband).aspx)and[`Interlocked.Decrement`](http://msdn.microsoft.com/en-us/library/1z4b2e5y(loband).aspx)方法而不是`++`or来完成`--`。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-20T10:15:49.830

如果您将会话保存在数据库服务器或状态服务器中，则不会触发 Session_End 事件。否则，我认为应该没有问题。

此外，在递增/递减计数器时，您必须像这样获得对对象的锁定 -

```
lock(<some shared object>)
{
    counter++;
} 
```

你也可以试试看[这个](http://aspnetresources.com/blog/count_your_visitors.aspx)。

# sql-server - 如何创建一个也允许空值的唯一约束？

> ID：767657
> 
> 赞同：716
> 
> 时间：2009-04-20T10:12:55.640
> 
> 标签：sql-server, tsql

我想对要填充 GUID 的列有一个唯一的约束。但是，我的数据包含此列的空值。如何创建允许多个空值的约束？

这是一个[示例场景](http://sqlfiddle.com/#!3/36a10/1)。考虑这个模式：

```
CREATE TABLE People (
  Id INT CONSTRAINT PK_MyTable PRIMARY KEY IDENTITY,
  Name NVARCHAR(250) NOT NULL,
  LibraryCardId UNIQUEIDENTIFIER NULL,
  CONSTRAINT UQ_People_LibraryCardId UNIQUE (LibraryCardId)
) 
```

然后查看此代码以了解我要实现的目标：

```
-- This works fine:
INSERT INTO People (Name, LibraryCardId) 
 VALUES ('John Doe', 'AAAAAAAA-AAAA-AAAA-AAAA-AAAAAAAAAAAA');

-- This also works fine, obviously:
INSERT INTO People (Name, LibraryCardId) 
VALUES ('Marie Doe', 'BBBBBBBB-BBBB-BBBB-BBBB-BBBBBBBBBBBB');

-- This would *correctly* fail:
--INSERT INTO People (Name, LibraryCardId) 
--VALUES ('John Doe the Second', 'AAAAAAAA-AAAA-AAAA-AAAA-AAAAAAAAAAAA');

-- This works fine this one first time:
INSERT INTO People (Name, LibraryCardId) 
VALUES ('Richard Roe', NULL);

-- THE PROBLEM: This fails even though I'd like to be able to do this:
INSERT INTO People (Name, LibraryCardId) 
VALUES ('Marcus Roe', NULL); 
```

最后的语句失败并显示一条消息：

> 违反 UNIQUE KEY 约束“UQ_People_LibraryCardId”。无法在对象“dbo.People”中插入重复键。

如何更改我的架构和/或唯一性约束，以便它允许多个`NULL`值，同时仍检查实际数据的唯一性？

* * *

## 回答 #1

> 赞同：1428
> 
> 时间：2009-04-20T10:31:34.800

您正在寻找的确实是 ANSI 标准 SQL:92、SQL:1999 和 SQL:2003 的一部分，即 UNIQUE 约束必须不允许重复的非 NULL 值但接受多个 NULL 值。

然而，在 SQL Server 的 Microsoft 世界中，允许使用单个 NULL，但不允许使用多个 NULL...

在**SQL Server 2008**中，您可以基于排除 NULL 的谓词定义唯一过滤索引：

```
CREATE UNIQUE NONCLUSTERED INDEX idx_yourcolumn_notnull
ON YourTable(yourcolumn)
WHERE yourcolumn IS NOT NULL; 
```

在早期版本中，您可以使用带有 NOT NULL 谓词的 VIEWS 来强制执行约束。

* * *

## 回答 #2

> 赞同：172
> 
> 时间：2009-04-20T10:20:27.247

### SQL Server 2008 +

`WHERE`您可以使用一个子句创建一个接受多个 NULL 的唯一索引。请参阅[下面的答案](https://stackoverflow.com/a/767702/290343)。

### 在 SQL Server 2008 之前

您不能创建 UNIQUE 约束并允许 NULL。您需要设置 NEWID() 的默认值。

在创建 UNIQUE 约束之前将现有值更新为 NEWID() 其中 NULL。

* * *

## 回答 #3

> 赞同：54
> 
> 时间：2010-11-12T05:04:17.150

**SQL Server 2008 及更高版本**

只需过滤一个唯一索引：

```
CREATE UNIQUE NONCLUSTERED INDEX UQ_Party_SamAccountName
ON dbo.Party(SamAccountName)
WHERE SamAccountName IS NOT NULL; 
```

**在较低版本中，仍然不需要物化视图**

对于 SQL Server 2005 和更早版本，您可以在没有视图的情况下执行此操作。我刚刚添加了一个独特的约束，就像你要求我的一张桌子一样。鉴于我想要 column 的唯一性`SamAccountName`，但我想允许多个 NULL，我使用了物化列而不是物化视图：

```
ALTER TABLE dbo.Party ADD SamAccountNameUnique
   AS (Coalesce(SamAccountName, Convert(varchar(11), PartyID)))
ALTER TABLE dbo.Party ADD CONSTRAINT UQ_Party_SamAccountName
   UNIQUE (SamAccountNameUnique) 
```

当实际所需的唯一列为 NULL 时，您只需在计算列中放入将保证在整个表中唯一的内容。在这种情况下，`PartyID`是一个身份列，并且数字永远不会匹配任何`SamAccountName`，所以它对我有用。您可以尝试自己的方法——确保您了解数据的领域，以免与真实数据相交。这可以像添加这样的微分字符一样简单：

```
Coalesce('n' + SamAccountName, 'p' + Convert(varchar(11), PartyID)) 
```

即使`PartyID`有一天变成非数字并且可能与 a 重合`SamAccountName`，现在也没关系了。

请注意，包含计算列的索引的存在隐式导致每个表达式结果与表中的其他数据一起保存到磁盘，这会占用额外的磁盘空间。

请注意，如果您不需要索引，您仍然可以通过将关键字添加`PERSISTED`到列表达式定义的末尾来使表达式预先计算到磁盘来节省 CPU。

在 SQL Server 2008 及更高版本中，如果可能，请务必使用过滤解决方案！

**争议**

请注意，一些数据库专业人士会将此视为“代理 NULL”的情况，这肯定存在问题（主要是由于试图确定某事物何时是*真实值*或*缺失数据的代理值的*问题；也可能存在问题随着非 NULL 代理值的数量疯狂地增加）。

但是，我相信这个案例是不同的。我添加的计算列将永远不会用于确定任何内容。它本身没有任何意义，并且不编码在其他正确定义的列中尚未单独找到的信息。永远不应选择或使用它。

所以，我的故事是，这不是一个代理 NULL，我坚持它！由于我们实际上不希望非 NULL 值用于欺骗`UNIQUE`索引以忽略 NULL 之外的任何目的，因此我们的用例没有正常代理 NULL 创建所出现的问题。

综上所述，我对使用索引视图没有任何问题——但它带来了一些问题，例如使用`SCHEMABINDING`. 向您的基表添加新列很有趣（您至少必须删除索引，然后删除视图或将视图更改为不受模式绑定）。请参阅在 SQL Server (2005) （以及更高版本）、[(2000)](http://msdn.microsoft.com/en-us/library/aa933148%28SQL.80%29.aspx)[中创建索引视图](https://msdn.microsoft.com/en-us/library/ms191432(v=sql.90).aspx)的完整（长）列表。

**更新**

如果您的列是数字，则可能存在确保使用的唯一约束`Coalesce`不会导致冲突的挑战。在这种情况下，有一些选择。一种可能是使用负数，将“代理 NULL”仅放在负范围内，而将“实际值”仅放在正范围内。或者，可以使用以下模式。在表中`Issue`（在哪里`IssueID`）`PRIMARY KEY`，可能有也可能没有`TicketID`，但如果有，它必须是唯一的。

```
ALTER TABLE dbo.Issue ADD TicketUnique
   AS (CASE WHEN TicketID IS NULL THEN IssueID END);
ALTER TABLE dbo.Issue ADD CONSTRAINT UQ_Issue_Ticket_AllowNull
   UNIQUE (TicketID, TicketUnique); 
```

如果 IssueID 1 有票 123，则`UNIQUE`约束将在值 (123, NULL) 上。如果 IssueID 2 没有票证，它将为 (NULL, 2)。有些想法会表明，这个约束不能对表中的任何行重复，并且仍然允许多个 NULL。

* * *

## 回答 #4

> 赞同：19
> 
> 时间：2013-09-20T17:20:00.167

对于使用**Microsoft SQL Server Manager**并希望创建唯一但可为空的索引的人，您可以像往常一样创建唯一索引，然后在新索引的索引属性中，从左侧面板中选择“过滤器”，然后输入您的过滤器（这是您的 where 子句）。它应该是这样的：

```
([YourColumnName] IS NOT NULL) 
```

这适用于 MSSQL 2012

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2013-02-06T12:13:07.050

当我应用下面的唯一索引时：

```
CREATE UNIQUE NONCLUSTERED INDEX idx_badgeid_notnull
ON employee(badgeid)
WHERE badgeid IS NOT NULL; 
```

每个非空更新和插入都失败并出现以下错误：

> 更新失败，因为以下 SET 选项的设置不正确：“ARITHABORT”。

我在[MSDN上找到了这个](http://msdn.microsoft.com/en-us/library/ms190306.aspx)

> 在计算列或索引视图上创建或更改索引时，SET ARITHABORT 必须为 ON。如果 SET ARITHABORT 为 OFF，则在计算列或索引视图上有索引的表上的 CREATE、UPDATE、INSERT 和 DELETE 语句将失败。

所以为了让它正常工作，我这样做了

> 右键单击[Database]-->Properties-->Options-->Other Options-->Misscellaneous-->Arithmetic Abort Enabled-->true

我相信可以在代码中使用

```
ALTER DATABASE "DBNAME" SET ARITHABORT ON 
```

但我没有测试过这个

* * *

## 回答 #6

> 赞同：9
> 
> 时间：2017-07-18T12:47:24.357

也可以在设计器中完成

右键单击索引>**属性**以获取此窗口

[![捕获](https://i.stack.imgur.com/nCplb.png)](https://i.stack.imgur.com/nCplb.png)

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2009-04-20T10:19:40.447

创建一个仅选择非`NULL`列的视图并`UNIQUE INDEX`在视图上创建：

```
CREATE VIEW myview
AS
SELECT  *
FROM    mytable
WHERE   mycolumn IS NOT NULL

CREATE UNIQUE INDEX ux_myview_mycolumn ON myview (mycolumn) 
```

请注意，您需要在视图而不是表上执行`INSERT`'s 和's。`UPDATE`

您可以使用`INSTEAD OF`触发器来执行此操作：

```
CREATE TRIGGER trg_mytable_insert ON mytable
INSTEAD OF INSERT
AS
BEGIN
        INSERT
        INTO    myview
        SELECT  *
        FROM    inserted
END 
```

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2009-04-20T10:21:13.920

可以在聚集索引视图上创建唯一约束

您可以像这样创建视图：

```
CREATE VIEW dbo.VIEW_OfYourTable WITH SCHEMABINDING AS
SELECT YourUniqueColumnWithNullValues FROM dbo.YourTable
WHERE YourUniqueColumnWithNullValues IS NOT NULL; 
```

* * *

和这样的唯一约束：

```
CREATE UNIQUE CLUSTERED INDEX UIX_VIEW_OFYOURTABLE 
  ON dbo.VIEW_OfYourTable(YourUniqueColumnWithNullValues) 
```

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-04-20T10:39:10.367

也许考虑一个“ `INSTEAD OF`”触发器并自己进行检查？在列上使用非聚集（非唯一）索引来启用查找。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2021-03-25T14:54:47.937

以我的经验 - 如果您认为列需要允许 NULL，但对于它们存在的值也需要是唯一的，那么您可能错误地对数据建模。这通常表明您在同一个表中创建一个单独的子实体作为不同的实体。将此实体放在第二个表中可能更有意义。

在提供的示例中，我会将 LibraryCardId 放在一个单独的 LibraryCards 表中，并使用 People 表的唯一非空外键：

```
CREATE TABLE People (
  Id INT CONSTRAINT PK_MyTable PRIMARY KEY IDENTITY,
  Name NVARCHAR(250) NOT NULL,
)
CREATE TABLE LibraryCards (    
  LibraryCardId UNIQUEIDENTIFIER CONSTRAINT PK_LibraryCards PRIMARY KEY,
  PersonId INT NOT NULL
  CONSTRAINT UQ_LibraryCardId_PersonId UNIQUE (PersonId),
  FOREIGN KEY (PersonId) REFERENCES People(id)
) 
```

这样，您就不必为既独特又可为空的列烦恼。如果一个人没有借书证，他们就不会在借书证表中记录。此外，如果有关于图书卡的其他属性（可能是到期日期或其他内容），您现在有一个放置这些字段的合理位置。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2015-02-26T14:18:17.680

如前所述，SQL Server 在`UNIQUE CONSTRAINT`. [自 2007 年以来，Microsoft Connect 上](https://connect.microsoft.com/SQLServer/feedback/details/299229/change-unique-constraint-to-allow-multiple-null-values)有一张票。正如那里和[这里](http://improvingsoftware.com/2010/03/26/creating-a-unique-constraint-that-ignores-nulls-in-sql-server/)所建议的那样，截至目前，最好的选择是使用[另一个答案](https://stackoverflow.com/a/767702/594074)或计算列中所述的过滤索引，例如：

```
CREATE TABLE [Orders] (
  [OrderId] INT IDENTITY(1,1) NOT NULL,
  [TrackingId] varchar(11) NULL,
  ...
  [ComputedUniqueTrackingId] AS (
      CASE WHEN [TrackingId] IS NULL
      THEN '#' + cast([OrderId] as varchar(12))
      ELSE [TrackingId_Unique] END
  ),
  CONSTRAINT [UQ_TrackingId] UNIQUE ([ComputedUniqueTrackingId])
) 
```

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2018-05-04T20:30:10.470

您可以创建一个**INSTEAD OF**触发器来检查特定条件和是否满足错误。在较大的表上创建索引的成本可能很高。

这是一个例子：

```
CREATE TRIGGER PONY.trg_pony_unique_name ON PONY.tbl_pony
 INSTEAD OF INSERT, UPDATE
 AS
BEGIN
 IF EXISTS(
    SELECT TOP (1) 1 
    FROM inserted i
    GROUP BY i.pony_name
    HAVING COUNT(1) > 1     
    ) 
     OR EXISTS(
    SELECT TOP (1) 1 
    FROM PONY.tbl_pony t
    INNER JOIN inserted i
    ON i.pony_name = t.pony_name
    )
    THROW 911911, 'A pony must have a name as unique as s/he is. --PAS', 16;
 ELSE
    INSERT INTO PONY.tbl_pony (pony_name, stable_id, pet_human_id)
    SELECT pony_name, stable_id, pet_human_id
    FROM inserted
 END 
```

* * *

## 回答 #13

> 赞同：-1
> 
> 时间：2013-01-25T18:33:34.353

您不能使用`UNIQUE`约束来执行此操作，但您可以在触发器中执行此操作。

```
 CREATE TRIGGER [dbo].[OnInsertMyTableTrigger]
   ON  [dbo].[MyTable]
   INSTEAD OF INSERT
AS 
BEGIN
    SET NOCOUNT ON;

    DECLARE @Column1 INT;
    DECLARE @Column2 INT; -- allow nulls on this column

    SELECT @Column1=Column1, @Column2=Column2 FROM inserted;

    -- Check if an existing record already exists, if not allow the insert.
    IF NOT EXISTS(SELECT * FROM dbo.MyTable WHERE Column1=@Column1 AND Column2=@Column2 @Column2 IS NOT NULL)
    BEGIN
        INSERT INTO dbo.MyTable (Column1, Column2)
            SELECT @Column2, @Column2;
    END
    ELSE
    BEGIN
        RAISERROR('The unique constraint applies on Column1 %d, AND Column2 %d, unless Column2 is NULL.', 16, 1, @Column1, @Column2);
        ROLLBACK TRANSACTION;   
    END

END 
```

* * *

## 回答 #14

> 赞同：-1
> 
> 时间：2015-11-07T07:22:50.387

```
CREATE UNIQUE NONCLUSTERED INDEX [UIX_COLUMN_NAME]
ON [dbo].[Employee]([Username] ASC) WHERE ([Username] IS NOT NULL) 
WITH (ALLOW_PAGE_LOCKS = ON, ALLOW_ROW_LOCKS = ON, PAD_INDEX = OFF, SORT_IN_TEMPDB = OFF, 
DROP_EXISTING = OFF, IGNORE_DUP_KEY = OFF, STATISTICS_NORECOMPUTE = OFF, ONLINE = OFF, 
MAXDOP = 0) ON [PRIMARY]; 
```

* * *

## 回答 #15

> 赞同：-1
> 
> 时间：2015-11-21T16:12:01.093

如果您使用 textBox 制作注册表单并使用 insert 并且您的 textBox 为空并且您单击提交按钮，则此代码。

```
CREATE UNIQUE NONCLUSTERED INDEX [IX_tableName_Column]
ON [dbo].[tableName]([columnName] ASC) WHERE [columnName] !=`''`; 
```

# sql - 返回字段为空的查询

> ID：767663
> 
> 赞同：0
> 
> 时间：2009-04-20T10:15:32.610
> 
> 标签：sql, mysql

我正在尝试对我的表使用以下查询：

```
SELECT ARTICLE_NO, USERNAME, ACCESSSTARTS, ARTICLE_NAME, date_format(str_to_date(ACCESSSTARTS, '%d.%m.%Y %k:%i:%s'), '%d %m %Y' ) AS shortDate FROM AUCTIONS WHERE upper(ARTICLE_NAME) LIKE '%hardy%' and subcat = 'null' ORDER BY str_to_date(ACCESSSTARTS, '%d.%m.%Y %k:%i:%s'), article_no limit 0, 10 
```

这应该返回超过 100 条记录。subcat 默认为空。我是否错误地标记了 null，或者是否有其他方法可以返回列为 null 的记录？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-20T10:16:49.173

采用

```
subcat IS NULL 
```

除此之外，我认为您想使用：

```
lower(ARTICLE_NAME) LIKE '%hardy%' 
```

因为您在 like 字符串中使用小写字母。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-20T10:23:56.707

查询应如下所示：

```
SELECT ARTICLE_NO, USERNAME, ACCESSSTARTS, ARTICLE_NAME, date_format(str_to_date(ACCESSSTARTS, '%d.%m.%Y %k:%i:%s'), '%d %m %Y' ) AS shortDate 
FROM AUCTIONS
WHERE upper(ARTICLE_NAME) LIKE '%hardy%' and subcat IS NULL
ORDER BY str_to_date(ACCESSSTARTS, '%d.%m.%Y %k:%i:%s'), article_no limit 0, 10 
```

注意 WHERE 子句中的**subcat IS NULL**。

# javascript - 使用带有 Javascript 替换方法的正则表达式

> ID：767666
> 
> 赞同：0
> 
> 时间：2009-04-20T10:16:41.687
> 
> 标签：javascript, regex

朋友们，

我是 Javascript 和正则表达式的新手，希望您能提供帮助！

在 Javascript 函数中，我需要检查逗号（，）是否出现 1 次或多次。如果是这样，那么它的任一侧都应该有一个或多个数字。

例如

1,000.00 没问题

1,000,00 没问题

,000.00 不行

1,000.00 不行

如果满足这些条件，我希望删除逗号，因此 1,000.00 变为 1000.00

我尝试过的是：

var x = '1,000.00';

var regex = new RegExp("[0-9]+,[0-9]+", "g");

var y = x.replace(正则表达式,"");

警报（y）；

运行警报时显示“.00”，这不是我所期望或想要的！

提前感谢您提供的任何帮助。

**强文本** 编辑 **强文本**

感谢所有人到目前为止的输入和给出的 3 个答案。不幸的是，我认为我没有很好地解释我的问题。

我想要实现的是：

如果文本中有逗号，并且它的任一侧有一个或多个数字，则删除逗号，但保留字符串的其余部分。

如果文本中有逗号，并且两边都没有至少一个数字，那么什么也不做。

所以使用我上面的例子：

1,000.00 变为 1000.00

1,000,00 变成 100000

,000.00 保留为 ,000.00

1,000.00 保留为 1,000.00

为混乱道歉！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-20T10:29:44.603

您的正则表达式对于高于 1000 的订单不会非常灵活，并且在没有逗号的输入方面存在问题。更有问题的是，您还匹配和替换了您感兴趣的数据部分！

最好有一个匹配有问题的表格的正则表达式并将它们删除。

以下匹配（按顺序）输入开头、输入结尾处的逗号，前面是一些非数字，或者后面是一些非数字。

```
var y = x.replace(/^,|,$|[^0-9]+,|,[^0-9]+/g,''); 
```

顺便说一句，如果你碰巧能够做[lookbehind](http://www.regular-expressions.info/lookaround.html) ，所有这一切都会容易得多，但几乎每个JS实现都没有。

**根据问题更新进行编辑：**

好的，我不会试图理解为什么你的规则是这样的，但是正则表达式更容易解决它：

```
var y = x.replace(/(\d),(\d)/g, '$1$2'); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-20T10:47:13.267

我会使用以下内容：

```
^[0-9]{1,3}(,[0-9]{3})*(\.[0-9]+)$ 
```

*   [0-9]{1,3}：1 到 3 位数字
*   (,[0-9]{3})*：[可选] 更多以逗号分隔的数字三元组
*   (\.[0-9]+): [可选] 点 + 更多数字

如果此正则表达式匹配，您就知道您的号码是有效的。之后只需用空字符串替换所有逗号。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-20T13:57:00.627

在我看来你有三个错误条件

1.  “,1000”
2.  “1000”
3.  “一千”

如果其中任何一个为真，那么您应该拒绝该字段，如果它们都是假的，那么您可以以正常方式去除逗号并继续前进。这可以是一个简单的选择：

```
^,|,,|,$ 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-20T14:54:03.720

我只会删除除数字和小数点分隔符 ( `[^0-9.]`) 之外的任何内容，并通过以下方式发送输出`parseFloat()`：

```
var y = parseFloat(x.replace(/[^0-9.]+/g, "")); 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-20T15:33:02.393

```
// invalid cases:
// - standalone comma at the beginning of the string
// - comma next to another comma
// - standalone comma at the end of the string
var i,
    inputs = ['1,000.00', '1,000,00', ',000.00', '1,,000.00'],
    invalid_cases = /(^,)|(,,)|(,$)/;
for (i = 0; i < inputs.length; i++) {
    if (inputs[i].match(invalid_cases) === null) {
       // wipe out everything but decimal and dot
       inputs[i] = inputs[i].replace(/[^\d.]+/g, '');
    }
}
console.log(inputs); // ["1000.00", "100000", ",000.00", "1,,000.00"] 
```

# crystal-reports - 使用报表查看器获取报表中的总页数

> ID：767674
> 
> 赞同：0
> 
> 时间：2009-04-20T10:20:15.360
> 
> 标签：crystal-reports, report, viewer

如何使用报表查看器获取报表中的总页数？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-20T10:29:40.063

这是你正在使用的吗？

```
=Globals!TotalPages 
```

请注意，这只适用于报告的页眉或页脚。

此外，在 Reporting Services 2008 中，可以在查看每个页面时根据需要一次呈现一个页面，并且在查看/呈现整个报表之前，TotalPages 数字可能不准确。

# java - 可嵌入的 Java HTTP 服务器

> ID：767682
> 
> 赞同：3
> 
> 时间：2009-04-20T10:23:33.090
> 
> 标签：java, tomcat, web-applications, jetty, nanohttpd

支持嵌入式 Java HTTP 服务器时似乎有多个极端。我见过极简主义方法，例如 NanoHTTPD，并利用 com.sun.net.httpserver 包尝试嵌入 Jetty 和 Tomcat。理想的可嵌入 HTTP 服务器将被实现，以便它可以通过 Executor 启动并带有 Servlet/JSP 支持，但除此之外应该允许使用其父级的记录器并允许集成其 JMX 挂钩。

同样，它也应该足够模块化，您可以选择不包含某些功能。有没有人遇到过任何具有此特性的基于 Java 的 HTTP 服务器？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-04-20T10:25:58.683

[码头](http://www.mortbay.org/jetty/)：

*   [JMX 集成](http://docs.codehaus.org/display/JETTY/JMX)
*   可配置的日志记录（用于请求和调试）
*   [JSP 2.0 和 2.1](http://docs.codehaus.org/display/JETTY/JSP+2.0+v+JSP+2.1)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-20T13:01:27.687

我认为 grizzly 是您的理想解决方案。[https://grizzly.dev.java.net/](https://grizzly.dev.java.net/)。开箱即用它只是一个 NIO 服务器，但有不同的包支持 HTTP、Servlets\JSP 等。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-21T07:15:37.370

即使是最小的 Jetty，我也负担不起开销（大小），所以我编写了自己的框架——我不记得 Jetty 是否有 OSS 许可障碍，这排除了我们的可能性。但是，当时，Jetty 的设计和高度模块化的架构给我留下了深刻的印象——它很容易成为我探索过的最佳选择（早在 2001 年左右），我推荐它。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-20T12:56:32.473

问题是您需要多少功能。小型的通常只支持 http 请求，您可能需要 servlet API、https 通信、Web 应用程序等。Jetty 是高度模块化的，因此您可以将所需的内容组合在一起。

# reporting-services - 通过报表/文档模板工具从 SQL Server 生成文档

> ID：767683
> 
> 赞同：0
> 
> 时间：2009-04-20T10:23:47.957
> 
> 标签：reporting-services, crystal-reports, merge, reporting

我正在寻找一个从模板生成看起来不错的文档的工具，它需要：

*   通过代码调用（非交互方式）
*   在 Windows 上运行，理想情况下从 Web 服务器中的代码调用
*   处理包含自己的内部数据定义、查询选项等的独立*报告文件（即理想情况下，我们可以将简单的报告文件推送到服务器，并且它可以简单地工作 - 报告/文档维护不一定是开发人员活动）
*   根据我们传入的参数（ID 等）从数据库（SQL Server 2005）访问数据
*   导出（再次，通过代码）到 pdf 或类似文件

*= 其中独立仅表示报告是完全自描述的；完全可以预料，执行报告将需要额外的报告运行时组件。与使用本地 VS 项目中的数据集的 rdlc 形成对比。

我查看了 rdl/rdlc 选项（Visual Studio 2008），但 rdlc 似乎与程序集耦合（不是独立的），并且 rdl 似乎缺乏基于代码的导出能力。VS2008 中包含的 Crystal Reports 版本似乎与 rdlc 非常相似——大概完整的 Crystal Reports 产品具有更多功能，但价格标签也很重要......

我欢迎任何关于可能适合和推荐的合适的、专业的工具的建议......

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-20T14:31:46.330

我认为 SQL Reporting Services 完全支持您的所有要求。我自己用 SSRS 构建了一些复杂的解决方案。（[例](http://www.dundas.com/Products/Chart/RS/Why/SuccessStories/Success%20Story_Skybow.pdf)）

*   通过代码完全可管理（通过 SSRS WS）（上传、执行和导出报告）
*   使用 SQL Server 作为数据库
*   查询在 RDL（或存储过程）中定义并基于参数

还有其他解决方案，例如 Telerik Reporting 或 Data Dynamics ActiveReport，但它们不是免费的。如果您需要更多信息，请告诉我

SSRS WS：我的意思是 Web 服务接口（[报表服务器 Web 服务](http://msdn.microsoft.com/en-us/library/ms152787.aspx) ）。还有一个 URL Access 方法，但我不认为它是你的解决方案

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-20T12:40:31.857

我认为您无法满足所有要求。3号尤其是杀手。

在一次阅读中，我将其视为在 SQL 上生成的临时报告。另一方面，它赋予用户“授权”，让他们在您定义的某些范围内自行滚动？

您可能已经看过...但是您是否考虑过使用[ReportBuilder](http://msdn.microsoft.com/en-us/library/dd220530.aspx)功能来设置基础知识并让用户完成其余的工作？无论如何，你需要一个报告猴子来设置一些东西。

编辑，评论后：

Reporting Services 就是这样。

它包含一个 Web 服务，用于呈现从 VS 上传的 RDL 文件。Report Builder 是一个模板，供用户在您设置的限制和环境内破解和抨击自己的内容。

[RS 2008 架构](http://msdn.microsoft.com/en-us/library/ms155792(SQL.90).aspx)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-20T15:19:51.753

我们的[Data Dynamics Reports 产品](http://www.datadynamics.com/Products/DDRPT/Default.aspx)听起来很适合您。它是用于 .NET / Visual Studio 的完全可编程的报告组件。[在此处](http://www.datadynamics.com/Help/ddReports/webframe.html)查看有关 API 的文档。您可以将报告导出为我们的各种格式，包括 PDF、HTML 和 Excel，它还包括一个最终用户设计器控件，您可以将其嵌入到您自己的应用程序中，让最终用户修改或创建他们自己的报告。

报告存储在 RDL（Reporting Services 使用的相同 XML 方言）中 - 事实上，您可以获取任何现有的 RDL 文件并在 Data Dynamics Reports 中打开它们。除了与 RDL 的兼容性之外，我们还添加了更多功能，例如“主题”以始终如一地设置您的报告样式、[主报告](http://www.datadynamics.com/Products/DDRPT/ScreencastViewer.aspx?ID=MASTR)（想想 ASP.NET 报告的母版页），以及其他几个内置控件，例如日历、条形码、和[仪表板控件](http://www.datadynamics.com/Products/DDRPT/ScreencastViewer.aspx?ID=DSHBD)仅举几例。

现在让我们逐一查看您的需求，看看 Data Dynamics Reports 如何解决它们：

*   通过代码（非交互方式）调用 - **Data Dynamics Reports 包含全面的 API。**
*   在 Windows 上运行，最好从 Web 服务器中的代码调用 -**您可以在基于客户端或 ASP.NET 应用程序中使用 Data Dynamics Reports，它甚至支持中等信任的 ASP.NET 应用程序（Web 服务很好）。**
*   处理包含自己的内部数据定义、查询选项等的独立*报告文件（即理想情况下，我们可以将简单的报告文件推送到服务器，并且它可以简单地工作 - 其中报告/文档维护不一定是开发人员活动） - **Data Dynamics Reports 使用标准 RDL（不是 rdlc），其中包括有关如何从数据源检索数据的所有信息。我们还包括一个最终用户设计器控件，允许您将这些独立文件的设计环境嵌入到您自己的应用程序中。**
*   根据我们传入的参数（ID 等）从数据库（SQL Server 2005）访问数据 -**数据动态报告包括对参数的全面支持（甚至从查询中获取“有效值”。**
*   导出（再次通过代码）到 pdf 或类似文件 - **Data Dynamics Reports 支持导出到 PDF、HTML、Excel、Word、图像和 XML。**

我希望它对您有用，如果您有任何其他问题，请告诉我。

```
Scott Willeke
Data Dynamics / GrapeCity inc. 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-09-14T00:52:39.990

我认为，根据所有标准，您可能需要查看 Crystal Reports，因为您希望报表是独立的，不过，您也可以使用 XtraReports 或 ActiveReports Pro 创建报表设计器并具有许多相同的功能。

至于即时运行它并让它生成、分发和存档运行的报告，请在 www.versareports.com 上查看我们的产品。它应该与您想要使用的任何 .NET 报表设计器一起使用，并提供您可能需要的企业级报表服务器框架。

# python - 估计 zip 大小/创建时间

> ID：767684
> 
> 赞同：7
> 
> 时间：2009-04-20T10:23:56.443
> 
> 标签：python, zip, time-estimation

我需要使用 Python zipfile 模块或 unix 命令行实用程序按需创建 ZIP 存档。

要压缩的资源通常 > 1GB 并且不一定对压缩友好。

我如何有效地估计它的创建时间/大小？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-04-20T10:32:27.530

从大文件中提取一堆小部分。可能有 64 个 64k 的块。随机选择。

连接数据，压缩它，测量时间和压缩比。由于您随机选择了文件的一部分，因此您压缩了具有代表性的数据子集。

现在您所要做的就是根据您的测试数据的时间来估计整个文件的时间。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-20T10:31:13.587

我建议您测量制作特定尺寸拉链所需的平均时间。然后，您根据该度量计算估计值。但是，如果您不知道数据的压缩程度，我认为无论如何估计都会非常粗略。如果您要压缩的数据每次都具有非常相似的“配置文件”，您可能会做出更好的预测。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-20T10:41:08.430

如果有可能从python模块获得进度回调，我建议找出每秒处理了多少字节（通过简单地存储文件中你在第二个开始的位置以及结束时的位置）。当您拥有有关计算机速度的数据时，您当然可以保存它，并将其用作下一个 zip 文件的基础。（我通常在显示时间预测之前收集大约 5 个样本）

使用此方法可以为您提供[Microsoft 分钟](http://www.urbandictionary.com/define.php?term=Microsoft%20Minutes)数，因此当您获得更多样本时，您需要对其进行平均。如果您制作包含大量文件的 zip 文件，情况尤其如此，因为与 1 个大文件相比，压缩许多小文件时 ZIP 往往会变慢。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-20T10:39:00.773

如果您使用[ZipFile.write()](http://docs.python.org/library/zipfile.html)方法将文件写入存档，则可以执行以下操作：

1.  获取要压缩的文件列表及其相对大小
2.  将一个文件写入存档并计算需要多长时间
3.  根据写入的文件数量、文件大小和剩余文件数量计算 ETA。

但是，如果您只压缩一个非常大的文件，这将不起作用。我自己从来没有使用过 zip 模块，所以我不确定它是否可以工作，但是对于少量的大文件，也许你可以使用 ZipFile.writestr() 函数并读入/压缩你的文件块?

# javascript - 如何强制 Internet Explorer 应用 CSS 样式

> ID：767692
> 
> 赞同：0
> 
> 时间：2009-04-20T10:27:23.097
> 
> 标签：javascript, internet-explorer, css-selectors

我有几个这样的 CSS 选择器：

```
table.SearchCustomerResults > thead > tr > th[sortOrder="0"] {}
table.SearchCustomerResults > thead > tr > th[sortOrder="1"] {} 
```

然后我为 JavaScript 中的每个单元格设置 sortOrder 扩展属性。但是，在我稍微移动光标之前，更改的样式在浏览器（IE7，也许是其他）中不可见。如何强制重新评估样式？

编辑：我没有使用最初所说的 IE6，而是 IE7。不过，问题仍然存在。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-20T15:35:07.270

有多种 hack-y 方法可以强制重新渲染。[script.aculo.us](http://script.aculo.us)有一个名为`forceRerendering`（自然）的方法，如下所示：

```
someElement.appendChild(document.createTextNode(' '));
someElement.removeChild(someElement.lastChild); 
```

在这种情况下，这也应该有效。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-20T10:43:14.790

IE6 不支持属性或子选择器，所以这根本不起作用。你在使用[ie7-js](http://code.google.com/p/ie7-js/)吗？

* * *

好的，我现在明白了。这看起来像 IE 中的一个错误（使用`div`and `title`for`th`并且`sortOrder`有同样的问题）。

```
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
  <head>
    <style>
      th[sortOrder="0"] {color:red}
      th[sortOrder="1"] {color:blue}
    </style>
    <script>
      function changeSortOrder() {
        // swap the orders so that blue is actually red and vice versa
        document.getElementById("hdr0").setAttribute("sortOrder","1");
        document.getElementById("hdr1").setAttribute("sortOrder","0");
        //document.getElementById("hdr0").innerHTML += "";
        //document.getElementById("hdr1").innerHTML += "";
      }
    </script>
  </head>
  <body onload="changeSortOrder()">
    <table class="SearchCustomerResults">
      <thead><tr>
        <th sortOrder="0" id="hdr0">red</th>
        <th sortOrder="1" id="hdr1">blue</th>
      </tr></thead>
    </table>
  </body>
</html> 
```

修改的行`innerHTML`似乎可以解决该错误。但是，在 Google 上找不到任何参考资料。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-06-13T08:29:14.540

我有类似的问题：插入新的 div 后，IE 没有应用边距。
**下一个代码有帮助：**
  setTimeout(function () { newDiv.addClass('tratata').removeClass('tratata'); }, 0); //jquery语法

# asp.net - ASP.NET - 发送电子邮件

> ID：767694
> 
> 赞同：1
> 
> 时间：2009-04-20T10:27:57.663
> 
> 标签：asp.net

我正在做一个航班预订系统，我想向用户发送一封电子邮件，其中包含他旅行的电子机票。电子客票是使用从数据库中获取的预订 ID 以及来自之前页面的其他详细信息（如乘客姓名等）动态生成的。那么如何将动态生成的 E-Ticket 发送到他的 E-Mail ID 中呢？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2010-04-22T14:00:02.220

**警告**：此问题的公认答案建议`System.Web.Mail`用于发送电子邮件。`System.Net.Mail`但是，此 API在 .NET 2.0 中已被替换，并且`System.Web.Mail`现在的类都标记为过时/不推荐使用。

* * *

这是一个真正简单的示例，说明如何在 .NET 中构造和发送邮件消息：

```
using (MailMessage message = new MailMessage())
{
    message.From = new MailAddress("boss@example.com");
    message.To.Add(new MailAddress("you@example.com"));
    message.Subject = "Get back to work!";
    message.Body = "Stop hanging around SO.";

    SmtpClient smtp = new SmtpClient();
    smtp.Send(message);
} 
```

实际上，上面的代码可以写得更短，使用[`SmtpClient.Send()`](http://msdn.microsoft.com/en-us/library/h1s04he7.aspx)方法：

```
SmtpClient smtp = new SmtpClient();
smtp.Send("boss@example.com", "you@example.com",
          "Get back to work!", "Stop hanging around SO."); 
```

但是，您通常需要使用“详细”样式，以便能够在地址上设置显示名称、更改邮件内容类型或向邮件添加附件。

无论您选择哪种方式，您都需要根据 SMTP 设置配置您的应用程序，告诉它如何发送电子邮件。在您的应用程序配置文件（将`web.config`在 ASP.NET 应用程序中）中，您需要添加如下内容：

```
<system.net>
    <mailSettings>
        <smtp from="default@example.com">
            <network host="smtp.example.com" />
        </smtp>
    </mailSettings>
</system.net> 
```

确切的设置取决于您希望应用程序如何传递邮件消息。使用上述示例配置，消息将通过指定的 SMTP 服务器进行中继。其他解决方案包括让应用程序将消息写入拾取文件夹，本地 IIS 虚拟邮件服务器将从该文件夹处理它们。详见[官方文档](http://msdn.microsoft.com/en-us/library/ms164240.aspx)。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-20T10:33:44.390

可以使用[System.Net.Mail](http://www.systemnetmail.com/)命名空间发送电子邮件。我会考虑使用 StringBuilder 或 String.Format 将详细信息放入电子邮件正文中。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-20T10:37:39.530

**警告：**我对这个问题的原始回答建议使用 System.Web.Mail 发送电子邮件。但是，此 API 在 .NET 2.0 中已被 System.Net.Mail 取代，并且 System.Web.Mail 的类现在都标记为过时/不推荐使用。

* * *

您可以使用 System.Web.Mail.Mailmessage 类：

```
System.Web.Mail.MailMessage mailMessage = new System.Web.Mail.MailMessage();
mailMessage.To = "recipient@repipient.com";
mailMessage.From = "sender@sender.com";
mailMessage.Subject = "Email subject";
mailMessage.BodyFormat = System.Web.Mail.MailFormat.Html;
mailMessage.Body = "Email body";

System.Web.Mail.SmtpMail.SmtpServer = System.Configuration.ConfigurationSettings.AppSettings["mailserver"];
System.Web.Mail.SmtpMail.Send(mailMessage); 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-13T16:40:27.300

System.web.mail 在 asp.net v2.0 中（正确地）被弃用；您应该忽略该答案，并听取那些指向您使用 system.net.mail 的人的意见。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-20T10:33:55.683

看看[MailMessage](http://msdn.microsoft.com/en-us/library/system.net.mail.mailmessage.aspx)类。该 MSDN 页面包含一个完整的示例，包括如何处理附件。

或者查看 Scott Guthries 博客中的[这个简短教程](http://weblogs.asp.net/scottgu/archive/2005/12/10/432854.aspx)- 它还解释了配置文件 (web.config) 中所需的条目。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-20T10:35:34.557

在 ASP.NET 中发送电子邮件非常简单。Jsut 在您的代码中生成消息的内容，拉入固定和动态元素以创建正文的完整字符串，然后以纯文本或 HTML 的形式简单地发送。

下面是调用发送的基本结构：

导入 System.Net.Mail

```
 Dim eMessage As New MailMessage(senderAddress, receiverAddress)

        eMessage.Subject = emailSubject
        eMessage.Body = emailBody
        eMessage.IsBodyHtml = emailIsHTML
        eMessage.Attachments.Add(emailAttachment)

        ' send email object
        Dim smtp As New SmtpClient
        smtp.Send(eMessage) 
```

内容的动态部分只是一个字符串构建器或类似的方法，用于从您需要的固定和动态元素构建字符串，如果您想使用 HTML 电子邮件，则添加 HTML 格式等。

# apache-flex - Flex 中的 RTSP

> ID：767697
> 
> 赞同：2
> 
> 时间：2009-04-20T10:29:16.570
> 
> 标签：apache-flex, video, red5, rtmp, rtsp

我们目前正在开发一个 Flex 应用程序，该应用程序需要通过 RTSP 连接到一组交通检测摄像机。总的来说，我对视频流的世界是全新的，我想知道这是否可能。

AFAIK 无法在 Flash 播放器中使用 RTSP 提要，所以我认为我们需要在服务器上安装某种转换器，接收 RTSP 流并将其转换为 RTMP，以便我们可以在我们的弹性应用程序。我们希望 Red5 可以帮助我们做到这一点。

我的假设是否正确，有人这样做过吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-05T03:11:01.990

Wowza Media 似乎支持 RTSP 到 RTMF 的转换：[http ://www.wowzamedia.com/comparison.html](http://www.wowzamedia.com/comparison.html)

还有基于Red5和FFMPEG的通用视频流转码器Xuggle [http://www.xuggle.com/ 。](http://www.xuggle.com/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-03-24T11:50:39.790

基于[这项工作](http://blog.gnanet.net/2008/05/09/rtsp-source-mp4-flv-streaming/) ，我尝试将 H264 信号转换为可以在 Flash 中轻松显示的 SWF 流。这是食谱。（这个配方适用于 Linux。）

1.  下载 Live555 流媒体，从[http://www.live555.com/liveMedia/](http://www.live555.com/liveMedia/) 你拥有的 src 文件通常命名为 live555-latest.tar.gz

2.  解压并编译：

    *   开箱：`tar xzvf live555-latest.tar.gz`。这将创建一个名为 live 的目录。
    *   `cd live`
    *   `./genMakefiles linux`（如果您有 32 位系统）或者`./genMakefiles linux-64bit`如果您的系统是 64 位）
    *   `make`, 一段时间后你会有一个全新的编译代码
3.  Live55 有很多好东西，但我们只对 openRTSP 所在的“testProgs”目录感兴趣。OpenRTSP 将让我们接收信号并将其发送到 ffmpeg，这是一个为 ffserver 提供数据的程序。ffserver 是一个服务器，它接收来自 ffmpeg 的信号并将其转换为 SWF（和其他格式）。

4.  下载、解压、配置和安装ffmpeg

    *   [从http://www.ffmpeg.org/](http://www.ffmpeg.org/)下载 ffmpeg 。我测试的版本是0.6.1：[http ://www.ffmpeg.org/releases/ffmpeg-0.6.1.tar.gz](http://www.ffmpeg.org/releases/ffmpeg-0.6.1.tar.gz)
    *   开箱：`tar xzvf ffmpeg-0.6.1.tar.gz`。这将创建一个名为 ffmpeg-0.6.1 的目录
    *   `cd ffmpeg-0.6.1`
    *   所有有趣的视频流都打包在 VideoLan 中。所以你最好现在就安装 VideoLan。去[http://www.videolan.org/](http://www.videolan.org/)看看安装它是多么容易。您可能会对包依赖项包含 ffmpeg 库感到惊讶。
    *   安装 VideoLan 后`./configure`，然后`make`.
    *   3 或 4 小时后，您将编译并运行 mmpeg 和 mmserver。
5.  现在我们几乎准备好流式传输整个世界。首先，让我们尝试让 openRTSP 工作。
6.  转到您的“实时”目录（记住 3.2）并执行：cd testProgs

7.  试试这个：`./openRTSP -v -c -t rtsp://<hostname>:<port>/<cam_path>`首先，你会看到这样的日志：

    ```
    - opening conection blah blah.
    - sending DESCRIBE blah blah.
    - receiving streamed data. 
    ```

    如果一切顺利，您的控制台将很快开始打印许多奇怪的字符。这些字符是视频字节，但您（现在）看不到它。如果您没有看到您的丝网印刷字符，则说明您的配置有问题。检查到目前为止的步骤。

8.  我们收到信号了！现在让我们将它发送到一个有用的组件：ffmpeg，它绑定到ffserver。我们需要为 ffserver 创建一个配置文件。
9.  使用您喜欢的编辑器创建此文本文件：

    ```
    Port 8090
    BindAddress 0.0.0.0
    MaxHTTPConnections 2000
    MaxClients 1000
    MaxBandwidth 1000
    CustomLog -
    NoDaemon

    <Feed feed1.ffm>
    File /tmp/feed1.ffm
    FileMaxSize 200K
    ACL allow 127.0.0.1
    </Feed>

    <Stream testFlash.swf>
    Feed feed1.ffm
    Format swf
    VideoFrameRate 25
    VideoSize 352x288
    VideoIntraOnly
    NoAudio
    </Stream>

    <Stream stat.html>
    Format status
    ACL allow localhost
    ACL allow 192.168.0.0 192.168.255.255
    </Stream> 
    ```

    命名文件，例如，ffserver.conf。将它保存在任何地方，例如在 ffserver 的同一目录中。

    因此，ffserver 将绑定到 8090 端口，用于输入和输出。`<Feed>`标签配置输入流。在这种情况下，配置的提要的名称是 feed1.ffm。请记住第 14 步。 `<Stream>`包含输出流的配置。在这种情况下，名称将为 testFlash.swf（请记住），格式为 SWF。视频帧率为 25，大小为 352x288，不包含音频。最后一个流是一个 HTML 文件 (stat.html)，它将显示服务器的状态。

10.  开始`ffserver: ./ffserver -f ffserver.conf`（或您离开配置文件的任何地方）。-f 参数表示您将从自定义文件加载配置。

11.  打开导航器并转到`http://localhost:8090/stat.html`。服务器的状态页面将显示，我们将看到一行有关我们的 testFlash.swf 流的信息。现在看起来很安静，所以让我们用 openRTSP 的输出（从第 7 步开始）输入这个流。

12.  做这个：

    ```
    <path to openRTSP>/openRTSP -v -c -t rtsp://<hostname>:<port>/<cam_path> | <path to ffmeg>/ffmpeg -i - http://localhost:8090/feed1.ffm 
    ```

    第一条路径（“|”之前与步骤9相同。“|”是将openRTSP的输出（视频信号序列，又名stage chars）连接到ffmpeg的输入的符号。“-I - " 表示 mmpeg 的输入取自管道 "|" 并且`http://localhost:8090/feed1.ffm`是 ffmpeg 的目标（输出），基本上是 ffserver 的输入。

    所以通过这个命令，我们连接了 openRTSP -> ffmpeg -> ffserver

    当您输入此命令时，将显示很多信息。重要的是要注意显示输入参数和输出参数，并且这些参数需要“兼容”。就我而言，这将显示：

    ```
    Input #0, h264, from 'pipe: ':
    Duration: N/A, bitrate: N/A
    Stream #0.0: Video: h264, yuv420p, 352x288, 25 fps, 25 tbr, 1200k tbn, 50 tbc
    Output #0, ffm, to 'http://localhost:8090/feed1.ffm':
    Metadata:
    encoder: Lavf52.64.2
    Stream #0.0: Video: FLV, yuv420p, 352x288, q=2-31, 200 kb/s, 1000k tbn, 25 tbc
    Stream mapping:
    Stream #0.0 -> #0.0
    </pre> 
    ```

    然后流开始播放。你会在最后一行看到不断变化的数字，告诉你每一刻的实时帧率。就像是

    ```
    frame= 395 fps= 37 q=31.7 Lsize = 1404kB time=15.80 bitrate = 727.9kbits/s 
    ```

    如果您没有看到这行指标，则说明您的输出配置有问题。回去修改testFlash.swf的参数。

13.  一切都完成了。您可以在 中查看视频`http://localhost:8090/testFlash.swf`。您可以使用此 URL 来嵌入 Flash 电影，或者在我的例子中，嵌入 Flex 应用程序。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-01T13:47:30.873

您可以尝试通过 Red5 重新流式传输并将您的 Flex 应用程序连接到 Red5 服务器。

阅读更多：[http://red5wiki.com/wiki/SteamStream](http://red5wiki.com/wiki/SteamStream)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-02T17:21:08.967

如果您熟悉 flex 编程或将其带入 swf 所需的任何东西，那么您可以尝试实现 rtsp-over-tcp，AFAIK udp 在 flash 中不可用。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-01-03T17:10:37.050

我刚刚用 Wowza 测试了这个。输入是来自 Etrovision H264 DVS 的 RTSP 流。如果您想尝试一下，请查看此步骤并使用 Application.xml 文件：http: //96.30.11.104/forums/showthread.php?p= [24806](http://96.30.11.104/forums/showthread.php?p=24806)

视频在 Flash 播放器中播放，但代价是单条流延迟 5 秒，所有设备在办公室局域网中，服务器运行在 Core2Duo/2.8GHz/3GB RAM。不确定它是否可以更快，或者这是此设置的预期转码损坏...

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-15T11:36:36.940

Red5 很好，尤其是现在有了 xuggle 支持（允许现成的 FFMPEG 集成），它提供了与 red5 的良好集成（即关于进行实时流转换等的很好的教程）。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-09-03T01:37:07.250

虽然它的公共/开源版本现在有点过时了，但您可以看看这个项目，它使用 Xuggler 和 Red5 将基于 RTSP 和图像的相机转码为 RTMP 流。 [http://sourceforge.net/projects/imux/](http://sourceforge.net/projects/imux/)
（免责声明：我为创建原始源代码的公司工作）

# c++-cli - 如何将数据添加到 DataTable？

> ID：767708
> 
> 赞同：0
> 
> 时间：2009-04-20T10:33:32.177
> 
> 标签：c++-cli

如何将数据添加到具有 5 列的 DataTable？

我正在使用 C++ (CLI)。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-20T10:54:37.273

来自[MSDN](http://msdn.microsoft.com/en-us/library/aa325587(VS.71).aspx)

```
void AddRow(DataTable^ myTable){
    DataRowCollection^ rc; 
    DataRow^ myNewRow;
    // Create an array with three elements.
    Object rowVals[] = gcnew Object[3];
    rc = myTable->Rows;
    rowVals[0] = S"hello";
    rowVals[1] = S"world";
    rowVals[2] = S"two";
    // Add and return the new row.
    myNewRow = rc->Add(rowVals);
 } 
```

您需要向 rowVals 添加两个新值，然后就可以不用了（PS 我通过眼睛将语法更改为 cli 语法，它可能无法完全按原样编译，但应该足以使用）

# sql-server - 使用报表查看器的报表中的总页数

> ID：767713
> 
> 赞同：0
> 
> 时间：2009-04-20T10:34:01.503
> 
> 标签：sql-server, reporting-services, reportviewer

我想获取表单中的总页数，该表单位于 Report Viewer 中。

我使用了这段代码，实际上报告有 5 页，但我只有一页。

```
int t=int T = objReportViewer.LocalReport.GetTotalPages(); 
```

我怎样才能让它给我所有 5 页？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2010-10-13T08:18:46.410

在带有 ReportViewer 2010 的 C# 中，

```
reportViewerName.PageCountMode = PageCountMode.Actual; 
```

为我完成了这项工作。

PS：刚看到，这个贴1年多了，不好意思！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-20T12:28:07.173

使用[Globals.TotalPages](http://msdn.microsoft.com/en-us/library/ms157274(SQL.90).aspx)吗？

文本框示例：`=Globals.PageNumber & " of " & Globals.TotalPages`

# php - 如何使用 preg_replace 在 PHP 中转义 $？

> ID：767714
> 
> 赞同：9
> 
> 时间：2009-04-20T10:35:13.967
> 
> 标签：php, regex, preg-replace

我`preg_replace`用来转义特殊字符：

```
$tmpStr=preg_replace("/\?/", "\?", $tmpStr);
$tmpStr=preg_replace("/\#/", "\#", $tmpStr);
$tmpStr=preg_replace("/\^/", "\^", $tmpStr);
$tmpStr=preg_replace("/\&/", "\&", $tmpStr);
$tmpStr=preg_replace("/\*/", "\*", $tmpStr);
$tmpStr=preg_replace("/\(/", "\(", $tmpStr);
$tmpStr=preg_replace("/\)/", "\)", $tmpStr);
$tmpStr=preg_replace("/\//", "\/", $tmpStr); 
```

但我无法`$`使用相同的功能逃脱：

```
$tmpStr=preg_replace("/\$/", "\$", $tmpStr); 
```

而且当我使用上述语句时，所有空格都被替换`$`并且`$`没有被转义。

如何正确转义美元符号？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-04-20T10:42:02.827

我强烈建议使用[preg_quote()](http://de.php.net/manual/en/function.preg-quote.php)代替。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2011-08-23T18:31:33.420

正确的答案是您必须使用 PHP 的转义字符转义正则表达式中的反斜杠和美元符号。

```
backslash = \\
dollar sign = \$

$tmpStr=preg_replace("/\\\$/", "\\$", $tmpStr); 
```

这对于需要匹配包含美元符号的字符串的任何人都很有用。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2010-05-22T03:04:13.193

看起来你的问题是逃避问题之一。PHP 中的单引号 ( `'`) 与双引号 ( ) 的工作方式不同`"`。这很像在 Perl 中，变量插值不会发生在单引号字符串中，并且美元符号 ( `$`) 不是元字符：

```
print "\$"; # prints $
print '\$'; # prints \$ 
```

此外，Perl 的字符类将简化您的代码：

```
$tmpStr = preg_replace('/([?#^&*()$\\/])/', '\\\\$1', $tmpStr); 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-04-20T10:43:32.683

$ 符号必须自行转义，所以

```
$tmpStr=preg_replace("/$$/", "\$", $tmpStr); 
```

我还建议改用[addlashes](http://fi2.php.net/manual/en/function.addslashes.php)。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2012-11-01T10:13:35.043

是的，PHP 似乎将`\\$`其视为`$`双引号字符串。这意味着您必须让 PHP`\$`看到`\\\$`.

我刚刚尝试过`preg_replace("/\\\$$k\\\$/", $v, $data)`，它确实有效（`$KEY$`用 VALUE.

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-20T10:38:21.197

IIRC你用$替换$。所以应该是$$

你也可以试试

```
$tmpStr=preg_replace('/\$/', '\$', $tmpStr); 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-20T10:47:35.980

PHP 将 \$ 视为 $ 不是真的吗？我还没有测试过，它可能会这样；

php 是第一个，并用“/$/”替换你的“/\$/”然后 preg 引擎确实很神奇.. 不幸的是，$ 是一个正则表达式运算符（我相信它匹配字符串的结尾？），所以它不会在您的文本中找到 $-characters 但会

我认为，您需要做的是像这样双重转义 $ 字符；

$tmpStr=preg_replace("/\$/", "\$", $tmpStr);

另外..在这种情况下，我会使用 str_replace()

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2016-03-17T07:49:07.583

```
$pattern = preg_replace('/\$(.+)/', '\\\$$1', $pattern); 
```

* * *

## 回答 #9

> 赞同：-2
> 
> 时间：2015-02-03T16:00:17.017

在 PHP 中，对于 HTML 中使用的“$”的特殊情况，您还可以对其实体进行先前的替换：

```
$tmpStr = str_replace('$', '&amp;#36;',$tmpStr); 
```

* * *

## 回答 #10

> 赞同：-2
> 
> 时间：2015-06-12T13:48:14.323

试试 addlashes() 吗？

检查 [php.net/addslashes()](http://php.net/manual/pt_BR/function.addslashes.php)

# c# - 试图让对话窗口记住它的最后位置

> ID：767715
> 
> 赞同：2
> 
> 时间：2009-04-20T10:35:31.767
> 
> 标签：c#, winforms

我正在 C# 中创建一个简单的对话窗口，并想记住它的放置位置，以便以后可以在同一位置打开另一个（在同一应用程序运行期间，因此不需要配置文件等）。我可以轻松保存位置（一个点）或边界（一个矩形），但是在创建另一个表单时，调用`form.ShowDialog()`两者都会重置：

```
 Form form= new Form();   

 form.Location = ptSavedLocation;
 //now form.Location is correct

 form.ShowDialog();
 //now form.Location is default again, and form is displayed where I don't want it. 
```

如何让表单尊重其位置（或边界，或任何其他适当的属性/设置器）？谢谢！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-20T10:40:32.253

将表单开始位置设置为手动

例如。

```
 Form form= new Form();   

 form.StartPosition = FormStartPosition.Manual;

 form.Location = ptSavedLocation;
 //now form.Location is correct

 form.ShowDialog();
 //now form.Location is default again, and form is displayed where I don't want it. 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-20T10:40:45.573

将表单 StartPosition 属性设置为 Manual

# javascript - javascript类中的类变量

> ID：767718
> 
> 赞同：1
> 
> 时间：2009-04-20T10:36:19.797
> 
> 标签：javascript, jquery

这个[问题](https://stackoverflow.com/questions/84716/is-there-a-better-way-to-create-an-object-oriented-class-with-jquery "问题")的解决方案建议使用 John Resig 的类实现。该解决方案涵盖了我的所有需求，除了：

如何在这个类中声明一个可以从外部访问的公共全局变量？

我想建立如下内容：

```
 var MyClass = Class.extend({

        EVENT_NAME : 'event-name',

        init : function() {
            // ...
        }

    });

// Now another file can directly read this value without creating the class object
console.log( MyClass.EVENT_NAME ); 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-20T12:10:43.627

做你想做的事情的“唯一”方法是将函数用作“类”。这样，您就可以声明一个可以访问其公共“静态”成员的“类”。像这样的东西：

```
function MyObject() {
  // constructor stuff here
}
MyObject.EVENT_NAME = "event_name";

console.log(MyObject.EVENT_NAME); // No need to instantiate MyObject 
```

但是，在我看来，您将静态类型语言的概念与 Javascript 更动态的东西混合在一起。为什么要访问尚未创建的对象的成员？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-20T10:54:20.130

在窗口上下文中声明它或者不要使用 'var' 关键字：

```
window.globalVar = somevalue
globalVar = somevalue 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-20T11:37:25.937

```
var MyClass = Class.extend({

        EVENT_NAME : 'event-name',

        init : function() {
            // ...
        }
        return {
            event_name: function() { return EVENT_NAME; }
        }

    });
    console.log( MyClass.event_name ); 
```

实际上，老实说，我不确定上述内容将如何使用，`.extend()`因为我以前没有实际使用`extend()`过。但是，该`return { name:value }`技术是在对象中公开公共实例方法的一种非常常见的方式。正确测试它应该不需要很长时间，抱歉我没有机会自己做。

# winforms - WinForm 应用程序和 MS Office 参考资料

> ID：767720
> 
> 赞同：0
> 
> 时间：2009-04-20T10:36:42.620
> 
> 标签：winforms, ms-office, project-reference

在我们的 WinForms 项目中，我们需要提供从 Excel 工作表导入数据的工具。

有一些方法可以在您的项目引用中引用 MS Office 文件（此处为 Office 2003）。

每次构建环境略有不同时，项目引用都会中断并显示 Excel 缺失错误。

我的问题是如何正确地将 Office 2003 文件引用到您的 WinForm 应用程序中？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-20T10:42:23.997

这是 Office 的一个大问题，我们也遇到过（Office 2003 与 Office 2007）

我们有两个解决方案：

*   创建了一个预先编译并引用的网关库，而不是真正的 Excel dll。

*   [使用了ExcelReader](http://www.codeproject.com/KB/office/ExcelReader.aspx)等外部 Excel 库。

# asp.net-mvc - ASP.NET MVC 将部分视图作为完整视图页面返回

> ID：767722
> 
> 赞同：0
> 
> 时间：2009-04-20T10:37:09.313
> 
> 标签：asp.net-mvc, renderpartial

我有许多用于以不同格式呈现媒体（主要是嵌入视频）的部分视图。我现在有一个要求，让我在 iframe 中显示这些视频。有没有一种方法可以返回一个嵌入了部分视图的最小 HTML 页面？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-20T10:43:29.157

查看这些关于如何将部分视图呈现为字符串的讨论。

[在 ASP.NET MVC Beta 中将 RenderPartial 渲染为字符串](http://www.brightmix.com/blog/how-to-renderpartial-to-string-in-asp-net-mvc/)

[RenderPartial 到字符串](http://forums.asp.net/t/1315284.aspx)

# delphi - Delphi：如何调试运行直到你回到你的源文件？

> ID：767723
> 
> 赞同：6
> 
> 时间：2009-04-20T10:37:10.810
> 
> 标签：delphi, delphi-2007

如果我运行一个程序并引发异常，系统会询问我是要继续还是中断。

如果我选择 break 我可以看到异常来自哪里，但如果 break 在库或系统文件中而不是我的源文件之一（假设异常在`System.pas`or中`Controls.pas`）我需要手动执行执行，`F8`直到它返回到我的一个文件，所以我可以看到我的代码的哪一部分导致了异常。

这可能需要很长时间。

我知道我应该在我的代码中捕获较低级别的异常，但在这种情况下，它没有遇到我的异常处理程序之一。

有没有办法说

*   继续执行，直到到达文件 X 或
*   直到您回到项目特定文件。

出于对其他编译器/IDE如何处理这个问题的普遍好奇，我也很感兴趣。

抱歉，如果我没有尽可能清楚地说明这一点。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-04-20T10:42:31.843

您可以使用**Stack View**窗口解决此问题。

1.  打开堆栈视图窗口 ( `CTRL`++ `ALT`) `S`。
2.  双击堆栈视图中要插入断点的方法。
3.  包含调用者方法的单元打开并且光标定位在调用者方法上。
4.  设置断点。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-20T12:44:14.203

还有比 Lieven 的建议更简单的方法。按照他布置的前 3 个步骤进行操作，但不要放置断点。

放置断点的问题是您必须在之后清除它，否则每次通过该行时您最终都会进入调试器。如果您只想运行到某一行然后拖放到调试器*一次*，请将光标放在该行（插入点，而不是鼠标光标）上，然后按**F4**（运行到光标）。这就像一个一次性断点。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-20T10:43:50.357

有几种方法：

1.  **使用“下一个源代码行”功能（Shift+F7）**
2.  使用调用堆栈并双击您需要的函数，在此处添加断点并点击“运行”(F9)。
3.  使用“Step out” (Shift+F8) 功能，直到您回到自己的代码中。

# c# - 转换 .net Func 到 .net 表达式 >

> ID：767733
> 
> 赞同：133
> 
> 时间：2009-04-20T10:40:45.527
> 
> 标签：c#, .net, lambda, expression, func

使用方法调用很容易从 lambda 转换为表达式...

```
public void GimmeExpression(Expression<Func<T>> expression)
{
    ((MemberExpression)expression.Body).Member.Name; // "DoStuff"
}

public void SomewhereElse()
{
    GimmeExpression(() => thing.DoStuff());
} 
```

但我想把 Func 变成一个表达式，只有在极少数情况下......

```
public void ContainTheDanger(Func<T> dangerousCall)
{
    try 
    {
        dangerousCall();
    }
    catch (Exception e)
    {
        // This next line does not work...
        Expression<Func<T>> DangerousExpression = dangerousCall;
        var nameOfDanger = 
            ((MemberExpression)dangerousCall.Body).Member.Name;
        throw new DangerContainer(
            "Danger manifested while " + nameOfDanger, e);
    }
}

public void SomewhereElse()
{
    ContainTheDanger(() => thing.CrossTheStreams());
} 
```

不起作用的行给了我编译时错误`Cannot implicitly convert type 'System.Func<T>' to 'System.Linq.Expressions.Expression<System.Func<T>>'`。显式强制转换并不能解决这种情况。有没有我忽略的设施可以做到这一点？

* * *

## 回答 #1

> 赞同：112
> 
> 时间：2009-04-20T10:43:10.077

哦，一点都不容易。`Func<T>`表示泛型`delegate`而不是表达式。如果有任何方法可以这样做（由于编译器所做的优化和其他事情，一些数据可能会被丢弃，因此可能无法取回原始表达式），它会即时反汇编 IL并推断表达式（这绝非易事）。将 lambda 表达式视为数据 ( `Expression<Func<T>>`) 是**编译器**完成的一项魔法（基本上，编译器在代码中构建表达式树，而不是将其编译为 IL）。

### 相关事实

这就是为什么将 lambda 推到极致的语言（如 Lisp）通常更容易实现为**解释器**。在那些语言中，代码和数据本质上是相同的东西（即使在*运行时*），但是我们的芯片无法理解这种形式的代码，所以我们必须通过在它之上构建一个能够理解它的解释器来模拟这样的机器（类似语言的 Lisp 做出的选择）或在某种程度上牺牲了能力（代码将不再完全等于数据）（C# 做出的选择）。在 C# 中，编译器允许 lambda在*编译时被解释为***代码**( `Func<T>`) 和**数据**( )，从而产生将代码视为数据的错觉。`Expression<Func<T>>`

 ** * *

## 回答 #2

> 赞同：43
> 
> 时间：2011-02-27T13:48:59.180

```
 private static Expression<Func<T, bool>> FuncToExpression<T>(Func<T, bool> f)  
    {  
        return x => f(x);  
    } 
```

* * *

## 回答 #3

> 赞同：25
> 
> 时间：2009-04-20T10:53:59.567

你可能应该做的，是改变方法。接受一个表达式>，然后编译并运行。如果它失败了，你已经有了要查看的表达式。

```
public void ContainTheDanger(Expression<Func<T>> dangerousCall)
{
    try 
    {
        dangerousCall().Compile().Invoke();;
    }
    catch (Exception e)
    {
        // This next line does not work...
        var nameOfDanger = 
            ((MemberExpression)dangerousCall.Body).Member.Name;
        throw new DangerContainer(
            "Danger manifested while " + nameOfDanger, e);
    }
}

public void SomewhereElse()
{
    ContainTheDanger(() => thing.CrossTheStreams());
} 
```

显然，您需要考虑这对性能的影响，并确定这是否是您真正需要做的事情。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2012-09-02T17:29:07.073

[NJection.LambdaConverter](https://github.com/sagifogel/NJection.LambdaConverter)是一个将委托转换为表达式的库

```
public class Program
{
    private static void Main(string[] args) {
       var lambda = Lambda.TransformMethodTo<Func<string, int>>()
                          .From(() => Parse)
                          .ToLambda();            
    }   

    public static int Parse(string value) {
       return int.Parse(value)
    } 
} 
```

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2009-04-20T10:52:58.383

如果你有时需要一个表达式，有时需要一个委托，你有两个选择：

*   有不同的方法（每种1个）
*   总是接受这个`Expression<...>`版本，`.Compile().Invoke(...)`如果你想要一个代表就接受它。显然，这是有代价的。

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2009-04-20T10:55:39.627

但是，您可以通过 .Compile() 方法采用另一种方式 - 不确定这是否对您有用：

```
public void ContainTheDanger<T>(Expression<Func<T>> dangerousCall)
{
    try
    {
        var expr = dangerousCall.Compile();
        expr.Invoke();
    }
    catch (Exception e)
    {
        Expression<Func<T>> DangerousExpression = dangerousCall;
        var nameOfDanger = ((MethodCallExpression)dangerousCall.Body).Method.Name;
        throw new DangerContainer("Danger manifested while " + nameOfDanger, e);
    }
}

public void SomewhereElse()
{
    var thing = new Thing();
    ContainTheDanger(() => thing.CrossTheStreams());
} 
```

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2013-03-21T12:38:54.810

```
 Expression<Func<T>> ToExpression<T>(Func<T> call)
        {
            MethodCallExpression methodCall = call.Target == null
                ? Expression.Call(call.Method)
                : Expression.Call(Expression.Constant(call.Target), call.Method);

            return Expression.Lambda<Func<T>>(methodCall);
        } 
```

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2009-05-01T19:38:41.277

Cecil Mono 团队的 JB Evain 正在取得一些进展以实现这一目标

[http://evain.net/blog/articles/2009/04/22/converting-delegates-to-expression-trees](http://evain.net/blog/articles/2009/04/22/converting-delegates-to-expression-trees)

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2014-02-17T21:22:52.220

改变

```
// This next line does not work...
Expression<Func<T>> DangerousExpression = dangerousCall; 
```

到

```
// This next line works!
Expression<Func<T>> DangerousExpression = () => dangerousCall(); 
```

# asp.net-mvc - Unity 依赖注入 - 如何在 .config 中注册实例？

> ID：767737
> 
> 赞同：3
> 
> 时间：2009-04-20T10:42:08.300
> 
> 标签：asp.net-mvc, dependency-injection, unity-container

这是一个 C# Asp.net MVC 项目。

我目前在 global.asax.cs 中设置了 Unity 映射。我想将容器设置从代码移动到 web.config。

我自己的类型一切都很好，但现在我需要翻译这一行：

container.RegisterInstance(System.Web.Security.Membership.Provider);

（所有其他配置行都是 container.Register **Type**）。

我一点也不远。如果我什至包括

```
<typeAliases>
    <!-- others elided -->
    <typeAlias
    alias="MembershipProvider"
type="System.Web.Security.MembershipProvider, System.Web"></typeAlias> 
```

它因配置错误而死：

```
The value of the property 'type' cannot be parsed. The error is: Could not load file or assembly 'System.Web' or one of its dependencies. The system cannot find the file specified. 
```

所以这很奇怪——它似乎没有在 GAC 中解决它？或者 System.Web 不在 appdomain 中？

如果我手动将 System.Web 复制到 bin 文件夹，我可以继续，并解决问题的症结所在：您如何 RegisterInstance System.Web.Security.MembershipProvider --> System.Web.Security.Membership.Provider？

```
<type type="MembershipProvider" mapTo="System.Web.Security.Membership.Provider, System.Web"></type> 
```

给出：

无法从程序集“System.Web”加载类型“System.Web.Security.Membership.Provider”。

正如预期的那样，因为它不是一种类型。

感谢您的任何指示。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-27T08:25:18.810

您是否尝试过更长的 Assembliy 参考？

```
System.Web, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a 
```

所以在你的情况下，你会有一条像

```
<type type="MembershipProvider" mapTo="System.Web.Security.MembershipProvider, System.Web, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a"></type> 
```

还值得一提的是你有一个 . 在第二个示例中的“MembershipProvider”中间。

# php - 用于登录应用程序的 PHP CLI 脚本

> ID：767751
> 
> 赞同：0
> 
> 时间：2009-04-20T10:45:31.927
> 
> 标签：php

我正在尝试编写一个脚本以使用 PHP CLI 脚本登录到 Web 应用程序：

```
 <?php
     $post_data = array(
    'user_name' => 'abc',
    'user_password'=>'XYZ@@11',
);

$url ='http://www.myapplication.com?action=Login&module=Users';                 
$hat = new  HttpRequest($url,HTTP_METH_POST);
$hat->setPostFields($post_data);
    $hat->send();
    $res = $hat->getResponseData();
    print'<pre>'; print_r($res); print '</pre>';
   ?> 
```

我想将用户名和密码发布到此页面并尝试登录应用程序。我不知道这是否是正确的方法？请建议如何去做。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-20T10:55:16.523

您可以使用[cURL 库](http://is.php.net/curl)来创建 POST 请求。

*   [使用 php 和 CURL 进行 POST 数据操作](http://www.askapache.com/htaccess/sending-post-form-data-with-php-curl.html)
*   [在 PHP 中使用 cURL 和 libcurl](http://devzone.zend.com/article/1081-Using-cURL-and-libcurl-with-PHP)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-20T11:06:13.953

如果您正在访问的页面使用 HTTP 基本身份验证，请查看[HttpRequest::setOptions](http://uk.php.net/manual/en/function.httprequest-setoptions.php)并在您的请求中设置*httpauth* 和 *httpauthtype*选项。你需要这样的东西：

```
$options=array();
$options['httpauth']="abc:XYZ@@11";
$options['httpauthtype']=HTTP_AUTH_BASIC;

$hat->setOptions($options); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-20T13:00:21.307

看起来不错 - 我对 HttpRequest 了解不多，但您可能需要做一些工作来维护 cookie 数据，所以您保持登录状态

# c# - 有没有办法在会话变量更改时得到通知？

> ID：767754
> 
> 赞同：0
> 
> 时间：2009-04-20T10:46:42.410
> 
> 标签：c#, session-variables

当会话变量发生变化时，是否可以在代码中得到通知？将举一个例子使其更清楚。

它是一个普通的 ASP.NET 站点，具有母版页和内容页。我想显示用户状态的图像，即是否登录（2 个不同的图像）。不是在母版页的每个 page_load 上检查会话变量，是否可以设置图像并仅在更改该会话变量时更改它？几乎就像发生变化时触发触发器一样。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-20T10:49:15.460

据我所知，会话对象 (HTTPSessionState) 没有任何 OnChanged 事件，因此您必须每次都进行检查，但是在 MasterPage Page_Load 事件中进行检查的开销微乎其微。

您应该考虑使用内置的 Membership Provider 来执行此操作，因为它具有特殊的 Login/LoginStatus 控件，当用户登录/注销时，这些控件将改变状态（您为模板提供您自己的图像/样式等......） /是匿名的

# java - 字符串中子字符串的出现次数

> ID：767759
> 
> 赞同：146
> 
> 时间：2009-04-20T10:47:52.220
> 
> 标签：java, string

为什么以下算法对我没有停止？（str 是我要搜索的字符串，findStr 是我要查找的字符串）

```
String str = "helloslkhellodjladfjhello";
String findStr = "hello";
int lastIndex = 0;
int count = 0;

while (lastIndex != -1) {
    lastIndex = str.indexOf(findStr,lastIndex);

    if( lastIndex != -1)
        count++;

    lastIndex += findStr.length();
}

System.out.println(count); 
```

* * *

## 回答 #1

> 赞同：215
> 
> 时间：2009-04-21T11:16:17.057

使用Apache Commons Lang 的[StringUtils.countMatches](http://commons.apache.org/proper/commons-lang/apidocs/org/apache/commons/lang3/StringUtils.html#countMatches(java.lang.CharSequence,%20java.lang.CharSequence))怎么样？

```
String str = "helloslkhellodjladfjhello";
String findStr = "hello";

System.out.println(StringUtils.countMatches(str, findStr)); 
```

输出：

```
3 
```

* * *

## 回答 #2

> 赞同：134
> 
> 时间：2009-04-20T11:10:11.510

你`lastIndex += findStr.length();`被放在括号外，导致无限循环（当没有找到发生时，lastIndex 总是 to `findStr.length()`）。

这是固定版本：

```
String str = "helloslkhellodjladfjhello";
String findStr = "hello";
int lastIndex = 0;
int count = 0;

while (lastIndex != -1) {

    lastIndex = str.indexOf(findStr, lastIndex);

    if (lastIndex != -1) {
        count++;
        lastIndex += findStr.length();
    }
}
System.out.println(count); 
```

* * *

## 回答 #3

> 赞同：99
> 
> 时间：2009-04-20T21:01:44.070

一个较短的版本。;)

```
String str = "helloslkhellodjladfjhello";
String findStr = "hello";
System.out.println(str.split(findStr, -1).length-1); 
```

* * *

## 回答 #4

> 赞同：91
> 
> 时间：2009-04-20T11:41:26.350

最后一行制造了一个问题。`lastIndex`永远不会是-1，所以会有一个无限循环。这可以通过将最后一行代码移到 if 块中来解决。

```
String str = "helloslkhellodjladfjhello";
String findStr = "hello";
int lastIndex = 0;
int count = 0;

while(lastIndex != -1){

    lastIndex = str.indexOf(findStr,lastIndex);

    if(lastIndex != -1){
        count ++;
        lastIndex += findStr.length();
    }
}
System.out.println(count); 
```

* * *

## 回答 #5

> 赞同：82
> 
> 时间：2009-04-20T11:09:39.187

你真的必须自己处理匹配吗？特别是如果您只需要出现次数，则正则表达式更整洁：

```
String str = "helloslkhellodjladfjhello";
Pattern p = Pattern.compile("hello");
Matcher m = p.matcher(str);
int count = 0;
while (m.find()){
    count +=1;
}
System.out.println(count); 
```

* * *

## 回答 #6

> 赞同：42
> 
> 时间：2017-06-30T03:35:19.653

我很惊讶没有人提到这个班轮。它简单，简洁，性能略好于`str.split(target, -1).length-1`

```
public static int count(String str, String target) {
    return (str.length() - str.replace(target, "").length()) / target.length();
} 
```

* * *

## 回答 #7

> 赞同：14
> 
> 时间：2015-04-12T09:49:30.850

在这里，它包含在一个漂亮且可重用的方法中：

```
public static int count(String text, String find) {
        int index = 0, count = 0, length = find.length();
        while( (index = text.indexOf(find, index)) != -1 ) {                
                index += length; count++;
        }
        return count;
} 
```

* * *

## 回答 #8

> 赞同：8
> 
> 时间：2009-04-20T11:03:22.400

```
String str = "helloslkhellodjladfjhello";
String findStr = "hello";
int lastIndex = 0;
int count = 0;

while((lastIndex = str.indexOf(findStr, lastIndex)) != -1) {
     count++;
     lastIndex += findStr.length() - 1;
}
System.out.println(count); 
```

循环结束时计数为 3；希望能帮助到你

* * *

## 回答 #9

> 赞同：8
> 
> 时间：2017-08-04T01:30:57.777

```
public int countOfOccurrences(String str, String subStr) {
  return (str.length() - str.replaceAll(Pattern.quote(subStr), "").length()) / subStr.length();
} 
```

* * *

## 回答 #10

> 赞同：7
> 
> 时间：2016-02-26T00:02:43.557

许多给定的答案在以下一项或多项上都失败了：

*   任意长度的图案
*   重叠匹配（例如“23232”中的“232”或“aaa”中的“aa”）
*   正则表达式元字符

这是我写的：

```
static int countMatches(Pattern pattern, String string)
{
    Matcher matcher = pattern.matcher(string);

    int count = 0;
    int pos = 0;
    while (matcher.find(pos))
    {
        count++;
        pos = matcher.start() + 1;
    }

    return count;
} 
```

示例调用：

```
Pattern pattern = Pattern.compile("232");
int count = countMatches(pattern, "23232"); // Returns 2 
```

如果您想要非正则表达式搜索，只需使用`LITERAL`标志适当地编译您的模式：

```
Pattern pattern = Pattern.compile("1+1", Pattern.LITERAL);
int count = countMatches(pattern, "1+1+1"); // Returns 2 
```

* * *

## 回答 #11

> 赞同：6
> 
> 时间：2016-03-14T05:20:29.920

您可以使用内置库函数出现次数：

```
import org.springframework.util.StringUtils;
StringUtils.countOccurrencesOf(result, "R-") 
```

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2009-04-20T10:50:47.907

`lastIndex`每当您寻找下一次出现时增加。

否则它总是找到第一个子字符串（在位置 0）。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2009-04-20T10:51:20.540

```
public int indexOf(int ch,
                   int fromIndex) 
```

返回此字符串中第一次出现指定字符的索引，从指定索引开始搜索。

因此，您的`lastindex`值始终为 0，并且始终在字符串中找到*hello 。*

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2013-07-03T13:25:57.593

给出的正确答案对于计算行返回之类的东西没有好处，而且过于冗长。后来的答案更好，但一切都可以简单地实现

```
str.split(findStr).length 
```

它不会使用问题中的示例删除尾随匹配项。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2009-04-20T10:52:46.670

尝试添加`lastIndex+=findStr.length()`到循环的末尾，否则您将陷入无限循环，因为一旦找到子字符串，您就会尝试从相同的最后一个位置一次又一次地找到它。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2012-08-17T08:45:32.233

试试这个。它用 . 替换所有匹配项`-`。

```
String str = "helloslkhellodjladfjhello";
String findStr = "hello";
int numberOfMatches = 0;
while (str.contains(findStr)){
    str = str.replaceFirst(findStr, "-");
    numberOfMatches++;
} 
```

如果你不想破坏你的`str`，你可以创建一个具有相同内容的新字符串：

```
String str = "helloslkhellodjladfjhello";
String strDestroy = str;
String findStr = "hello";
int numberOfMatches = 0;
while (strDestroy.contains(findStr)){
    strDestroy = strDestroy.replaceFirst(findStr, "-");
    numberOfMatches++;
} 
```

执行此块后，这些将是您的值：

```
str = "helloslkhellodjladfjhello"
strDestroy = "-slk-djladfj-"
findStr = "hello"
numberOfMatches = 3 
```

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2013-01-14T11:04:45.120

这是用于计算令牌在用户输入的字符串中出现的次数的高级版本：

```
public class StringIndexOf {

    public static void main(String[] args) {

        Scanner scanner = new Scanner(System.in);

        System.out.println("Enter a sentence please: \n");
        String string = scanner.nextLine();

        int atIndex = 0;
        int count = 0;

        while (atIndex != -1)
        {
            atIndex = string.indexOf("hello", atIndex);

            if(atIndex != -1)
            {
                count++;
                atIndex += 5;
            }
        }

        System.out.println(count);
    }

} 
```

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2013-02-13T04:21:59.183

下面的方法显示了子字符串在整个字符串上重复了多少次。希望对您充分利用：-

```
 String searchPattern="aaa"; // search string
    String str="aaaaaababaaaaaa"; // whole string
    int searchLength = searchPattern.length(); 
    int totalLength = str.length(); 
    int k = 0;
    for (int i = 0; i < totalLength - searchLength + 1; i++) {
        String subStr = str.substring(i, searchLength + i);
        if (subStr.equals(searchPattern)) {
           k++;
        }

    } 
```

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2015-03-23T15:26:05.877

正如@Mr_and_Mrs_D 建议的那样：

```
String haystack = "hellolovelyworld";
String needle = "lo";
return haystack.split(Pattern.quote(needle), -1).length - 1; 
```

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2016-03-08T13:36:57.400

根据现有答案，我想添加一个没有 if 的“较短”版本：

```
String str = "helloslkhellodjladfjhello";
String findStr = "hello";

int count = 0, lastIndex = 0;
while((lastIndex = str.indexOf(findStr, lastIndex)) != -1) {
    lastIndex += findStr.length() - 1;
    count++;
}

System.out.println(count); // output: 3 
```

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2018-08-15T19:28:27.850

此解决方案打印整个字符串中给定子字符串的出现总数，还包括确实存在重叠匹配的情况。

```
class SubstringMatch{
    public static void main(String []args){
        //String str = "aaaaabaabdcaa";
        //String sub = "aa";
        //String str = "caaab";
        //String sub = "aa";
        String str="abababababaabb";
        String sub = "bab";

        int n = str.length();
        int m = sub.length();

        // index=-1 in case of no match, otherwise >=0(first match position)
        int index=str.indexOf(sub), i=index+1, count=(index>=0)?1:0;
        System.out.println(i+" "+index+" "+count);

        // i will traverse up to only (m-n) position
        while(index!=-1 && i<=(n-m)){   
            index=str.substring(i, n).indexOf(sub);
            count=(index>=0)?count+1:count;
            i=i+index+1;  
            System.out.println(i+" "+index);
        }
        System.out.println("count: "+count);
    }
} 
```

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2014-02-14T13:05:05.933

这是另一个不使用 regexp/patterns/matchers 甚至不使用 StringUtils 的解决方案。

```
String str = "helloslkhellodjladfjhelloarunkumarhelloasdhelloaruhelloasrhello";
        String findStr = "hello";
        int count =0;
        int findStrLength = findStr.length();
        for(int i=0;i<str.length();i++){
            if(findStr.startsWith(Character.toString(str.charAt(i)))){
                if(str.substring(i).length() >= findStrLength){
                    if(str.substring(i, i+findStrLength).equals(findStr)){
                        count++;
                    }
                }
            }
        }
        System.out.println(count); 
```

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2015-01-13T20:55:49.307

如果您需要原始字符串中每个子字符串的索引，您可以使用 indexOf 执行以下操作：

```
 private static List<Integer> getAllIndexesOfSubstringInString(String fullString, String substring) {
    int pointIndex = 0;
    List<Integer> allOccurences = new ArrayList<Integer>();
    while(fullPdfText.indexOf(substring,pointIndex) >= 0){
       allOccurences.add(fullPdfText.indexOf(substring, pointIndex));
       pointIndex = fullPdfText.indexOf(substring, pointIndex) + substring.length();
    }
    return allOccurences;
} 
```

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2017-11-29T23:18:29.523

```
public static int getCountSubString(String str , String sub){
int n = 0, m = 0, counter = 0, counterSub = 0;
while(n < str.length()){
  counter = 0;
  m = 0;
  while(m < sub.length() && str.charAt(n) == sub.charAt(m)){
    counter++;
    m++; n++;
  }
  if (counter == sub.length()){
    counterSub++;
    continue;
  }
  else if(counter > 0){
    continue;
  }
  n++;
}

return  counterSub; 
```

}

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2021-03-06T14:34:27.137

只是一个更桃色的答案

```
 public int countOccurrences(String str, String sub) {
        if (str == null || str.length() == 0 || sub == null || sub.length() == 0) return 0;
        int count = 0;
        int i = 0;
        while ((i = str.indexOf(sub, i)) != -1) {
            count++;
            i += sub.length();
        }
        return count;
    } 
```

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2021-07-08T21:52:35.777

刚才在面试中被问到这个问题，我完全空白。（像往常一样，我告诉自己，面试结束的那一刻我会得到解决方案）我做了，电话结束后 5 分钟 :(

```
 int subCounter=0;
    int count =0;
    for(int i=0; i<str.length(); i++) {
        if((subCounter==0 && "a".equals(str.substring(i,i+1))) 
                || (subCounter==1 && "b".equals(str.substring(i,i+1)))
                || (subCounter==2 && "c".equals(str.substring(i,i+1)))) {
            ++subCounter;
        }
        if(subCounter==3) {
            count = count+1;
            subCounter=0;
        }
    }
    System.out.println(count); 
```

# c# - Exchange WS '在商店中找不到指定的对象。错误

> ID：767760
> 
> 赞同：6
> 
> 时间：2009-04-20T10:49:12.933
> 
> 标签：c#, exchange-server, exchangewebservices

我们正在使用 Exchange 2007 WS 处理邮件文件夹，如果我们尝试转发已经收到的邮件，则会遇到各种问题。我们的流程是：

*   Windows 服务监视邮箱文件夹，在找到新邮件时，我们处理信息并将项目移动到“已处理文件夹”并存储 Exchange 邮件 ID。
*   用户可以选择将邮件转发到外部。我们使用 Exchange API 使用我们之前存储的 Message Id 来查找项目，然后再次使用 API 进行转发。

除了再次找到邮件被证明是相当不稳定的。我们经常收到以下错误：

> 在商店中找不到指定的对象。

有没有更好/更可靠的方法可以实现相同的目标？Exchange WS 的文档相当稀疏。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-20T14:23:40.983

您是保存新找到的消息的消息 ID 还是将消息移动到“已处理”文件夹后？当它移动到新文件夹时，id 会改变。

[Inside Microsoft Exchange Server 2007 Web Services](http://www.microsoft.com/learning/en/us/books/10724.aspx)一书中推荐的方法是获取新发现项目的 PR_SEARCH_KEY (0x300B, Binary)，然后将其移动到“已处理”文件夹。然后，您可以根据 PR_SEARCH_KEY 在新文件夹中搜索它并获取它的新消息 ID 以转发它。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2010-09-13T09:50:09.033

这是 microsoft exchange manage API 中的一个错误。这是更多信息的链接 [http://maheshde.blogspot.com/2010/09/exchange-web-service-specified-object.html](http://maheshde.blogspot.com/2010/09/exchange-web-service-specified-object.html)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2013-11-27T15:31:08.320

我得出的结论是，这发生在我身上是因为当我的应用程序正在处理电子邮件时，其他人同时在摆弄电子邮件。

所以为了解决这个问题，我把它的代码放在一个try catch中，看看异常是否==那个在商店里找不到的对象，如果是这样，我就跳过它并继续下一个项目。所以 for 没有问题。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2013-03-04T08:37:35.660

我编写了一个程序，读取收件箱中的电子邮件，将附件下载到指定文件夹，将电子邮件信息和保存的路径写入数据库，最后删除电子邮件。我将此程序作为 Windows 服务运行。完成所有测试后，我将这个程序运行到主服务器并运行它。程序成功运行，但有时我收到此错误。我检查了所有内容，最后发现我忘记停止计算机上的服务。在我的计算机和真实服务器上运行的 2 个程序同时检查同一个邮箱。**如果您收到此错误，请确保只有一个程序可以在同一个邮箱中处理。**

# c# - RESX 文件和 xml 数据

> ID：767762
> 
> 赞同：4
> 
> 时间：2009-04-20T10:49:21.980
> 
> 标签：c#, xml

存储程序中使用的 XML 数据的最佳方式是什么？使用 RESX 文件或将其存储为 .xml 文件并根据要求加载和卸载文件

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-20T11:11:52.770

第三种选择是将 XML 文件作为嵌入资源放入程序集中。在这种情况下，使用 Assembly.GetManifestResourceStream() 加载 XML。

正如 Cerebrus 所写，当需要本地化时，RESX 将是可行的方法。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-20T10:56:03.727

.resx 文件***是***XML 文件，尽管它符合特定的架构 (Microsoft ResX Schema v2.0)。该模式的设计明确目标是易于人工阅读和手动编辑。

我认为将数据存储为 XML 文件没有问题。基本上它取决于数据的功能 - 如果它是您尝试存储的可本地化资源，请使用已建立的 .resx 文件。如果没有，您可以自由地将 XML 与自定义模式一起使用。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-22T07:41:11.027

将 XML（blob）放入 .resx

正面：

*   一应俱全

负面：

*   如果内容很大，它会增加内存负载。Big-in-size 与没有内容的装配体尺寸相比。如果程序集大小为 10kb，内容大小为 10kb，即使 10kb 在今天的场景中并不大，只需将内容保存在单独的文件中，就可以将程序集大小减少一半。
*   通过将 XML 保留为 RESX 中的字符串键值对，代码可管理性急剧下降。由于 resx 编辑器不是 XML 敏感的。

如果您非常热衷于将 xml 内容作为嵌入资源保存，您可以创建 XML 文件并将其作为文件资源保存在 RESX 中。

# svn - SVN如何在两个分支上添加文件时解决新树冲突

> ID：767763
> 
> 赞同：96
> 
> 时间：2009-04-20T10:49:25.803
> 
> 标签：svn, merge, tree-conflict

当合并几个分支（使用 SVN 1.6.1）时，在两个分支上都添加了一个文件（然后在这些单独的分支中工作），我遇到了一个新的树冲突：

```
 C foo.txt
  >   local obstruction, incoming add upon merge 
```

我需要两个分支的更改，但树冲突并没有给我通常的 .working、.merge-left 和 .merge-right 文件——由于冲突的性质，这是可以理解的。有很多这样的冲突，并且在每个分支上都发生了相同文件的删除，但它们很容易解决。

我该如何解决这个问题？SVN redbean book (for 1.6) 没有涵盖这种情况。

* * *

## 回答 #1

> 赞同：167
> 
> 时间：2010-02-05T12:26:30.623

我找到了一个[建议解决方案的帖子](http://little418.com/2009/05/svn-local-obstruction-incoming-add-upon-merge.html)。它即将运行：

```
svn resolve --accept working <YourPath> 
```

这将声称本地版本文件正常。
您可以为单个文件或整个项目目录运行它。

* * *

## 回答 #2

> 赞同：40
> 
> 时间：2009-04-20T11:29:56.423

[正如“树冲突”设计](http://svn.apache.org/repos/asf/subversion/trunk/notes/tree-conflicts/design-overview.txt)文档的旧版本（2009）中提到的：

> XFAIL 冲突来自添加版本控制文件的合并
> 
> 该测试进行合并，**将没有历史记录的文件添加到现有版本化文件**中。
> 这应该是 ' `local obstruction, incoming add upon merge`' 品种的文件的树冲突。修复了 r35341 中的预期。

（顺便说一下，这在 ClearCase 中也称为“邪恶双胞胎”）：
一个文件在两个不同的分支中创建了两次（这里“添加”了两次），为两个不同的元素创建了两个不同的历史记录，但名称相同。

理论上的解决方案是在目标分支“”中手动合并这些文件（使用外部差异工具）`B2`。

如果您仍在源分支上工作，理想的情况是从源分支中删除该文件`B1`，然后合并从`B2`to`B1`以使该文件可见`B1`（然后您将在同一个元素上工作）。
如果因为只发生 from`B1`到合并而无法进行合并`B2`，则每次合并都需要手动合并`B1->B2`。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2011-02-16T09:11:14.463

> 如果传入的更改是您想要的怎么办？我无法运行 svn resolve --accept theirs-full

svn resolve --accept base

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2011-08-17T22:55:18.697

我只是设法让自己非常彻底地尝试遵循上面 user619330 的建议。情况是：（1）：我在我的初始分支branch1上工作时添加了一些文件；(2) 我创建了一个新的分支，branch2 用于进一步开发，将它从主干分支出来，然后合并我从 branch1 的更改 (3) 一位同事将我的 mods 从 branch1 复制到他自己的分支，添加了更多的 mods，然后合并回主干；(4) 我现在想将来自主干的最新更改合并到我当前的工作分支 branch2 中。这是 svn 1.6.17。

合并与新文件存在树冲突，我想要来自它们不同的主干的新版本，所以从 branch2 的干净副本中，我对冲突文件进行了 svn 删除，提交了这些 branch2 更改（从而创建了一个临时没有相关文件的 branch2 版本），然后我从主干进行了合并。我这样做是因为我希望历史记录与主干版本相匹配，这样以后在尝试合并回主干时就不会遇到更多问题。合并进行得很好，我得到了文件的主干版本，svn st 显示一切正常，然后我在尝试提交更改时遇到了更多的树冲突，在我之前所做的删除和合并中的添加之间。是否有一个 svn 解决了有利于我的工作副本（现在有文件的主干版本）的冲突，并让它提交。

嗯，不。更新 branch2 的另一个副本导致文件的旧版本（主干合并前）。所以现在我有两个不同的 branch2 工作副本，据说更新到相同的版本，有两个不同版本的文件，并且都坚持认为它们是完全最新的！签出 branch2 的干净副本会导致文件的旧（主干前）版本。我手动将这些更新到主干版本并提交更改，回到我的第一个工作副本（我最初提交主干更改的地方），尝试更新它，现在在有问题的文件上出现校验和错误。把有问题的目录吹走，通过更新获得一个新版本，最后我有了一个好的分支 2 版本，主干发生了变化。我希望。警告开发商。

# c# - 从源字符串中查找多个索引

> ID：767767
> 
> 赞同：6
> 
> 时间：2009-04-20T10:51:03.817
> 
> 标签：c#, .net, algorithm, string

基本上我需要做 String.IndexOf() 并且我需要从源字符串中获取索引数组。

有没有简单的方法来获取索引数组？

在问这个问题之前，我已经谷歌了很多，但没有找到解决这个简单问题的简单解决方案。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-04-20T10:55:48.410

这个扩展方法怎么样：

```
public static IEnumerable<int> IndexesOf(this string haystack, string needle)
{
    int lastIndex = 0;
    while (true)
    {
        int index = haystack.IndexOf(needle, lastIndex);
        if (index == -1)
        {
            yield break;
        }
        yield return index;
        lastIndex = index + needle.Length;
    }
} 
```

请注意，在“XAAAY”中查找“AA”时，此代码现在只会产生 1。

如果您真的需要一个数组，请调用`ToArray()`结果。（这是假设 .NET 3.5 并因此支持 LINQ。）

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-04-20T10:57:25.363

我怀疑你必须循环：

```
 int start = 0;
        string s = "abcdeafghaji";
        int index;
        while ((index = s.IndexOf('a', start)) >= 0)
        {
            Console.WriteLine(index);
            start = index + 1;
        } 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-04-20T11:09:25.677

```
 var indexs = "Prashant".MultipleIndex('a');

//Extension Method's Class
    public static class Extensions
    {
         static int i = 0;

         public static int[] MultipleIndex(this string StringValue, char chChar)
         {

           var indexs = from rgChar in StringValue
                        where rgChar == chChar && i != StringValue.IndexOf(rgChar, i + 1)
                        select new { Index = StringValue.IndexOf(rgChar, i + 1), Increament = (i = i + StringValue.IndexOf(rgChar)) };
            i = 0;
            return indexs.Select(p => p.Index).ToArray<int>();
          }
    } 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2016-04-08T05:53:27.790

使用使用正则表达式的解决方案可能更可靠，使用 indexOf 函数可能不可靠。它将找到所有匹配项和索引，不匹配可能导致意外结果的确切短语。这个函数通过使用 Regex 库来解决这个问题。

```
public static IEnumerable<int> IndexesOf(string haystack, string needle)
{
       Regex r = new Regex("\\b(" + needle + ")\\b");
       MatchCollection m = r.Matches(haystack);

       return from Match o in m select o.Index;
} 
```

# c++ - 资源管理器缩略图 (winXP)

> ID：767770
> 
> 赞同：2
> 
> 时间：2009-04-20T10:51:54.567
> 
> 标签：c++, image, thumbnails, windows-explorer

我有一种文件格式，需要能够在资源管理器缩略图中显示。由于目标系统是 windows XP，Vista PreviewHandler API 将不适合。我将使用 C++。

我该怎么做？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-20T13:15:49.603

您需要为您的文件类型注册一个 shell 扩展名。该扩展包含通过实现 IExtractImage 接口提取/生成缩略图的代码。

请参阅：[MSDN 上的 IExtractImage 接口](http://msdn.microsoft.com/en-us/library/bb761848(VS.85).aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2018-06-08T11:37:02.123

[https://github.com/reliak/moonpdf/tree/master/ext/sumatra/src/previewer](https://github.com/reliak/moonpdf/tree/master/ext/sumatra/src/previewer)就是完美的例子。

要构建 x86 和 x64 版本的 DLL，我使用带有 SP1 的 VS 2010 以及`<thumbcache.h>`安装在 Windows 7 x64 上的 Win7 x64 SDK（用于）。构建的 DLL 在任一位的 Win7 和 Win10 上都可以正常工作。

也不要忘记`/MD`链接器标志以避免在 WinXP 上安装*Microsoft Visual C++ 2010 Redistributable Package (x86) 。*

可以添加下一行`"targetver.h"`以避免导入和使用来自较新版本的 Windows 系统 DLL 的新函数（例如，`RegDeleteTreeW`在 WinXP中没有`advapi.dll`）：

```
#define WINVER 0x0501
#define _WIN32_WINNT 0x0501
#include <winsdkver.h>
#include <SDKDDKVer.h> 
```

此外，它还实现了某些文件格式的预览器，但在您的实现中可以完全省略相关接口。

# android - Android：启用/禁用自动同步和后台数据

> ID：767771
> 
> 赞同：3
> 
> 时间：2009-04-20T10:52:03.817
> 
> 标签：android, synchronization, gprs

我想开发一个应用程序来禁用后台数据（Android 1.5 中的新功能）和自动同步，然后启用 GPRS/EDGE 连接，反之亦然。

我想出了如何通过更改 APN 设置来启用/禁用 GPRS/EDGE。（奇怪的解决方案。然而；Android 开发人员不会认为用户可能想要禁用 GPRS/EDGE）但是，我找不到启用/禁用自动同步和后台数据的方法。

我调查了 Android 代码，据我了解，同步操作是一个意图。所以，我想用 putExtra 达到意图并触发启用/禁用。但; 我找不到正确的关键字。或者也许我完全错了。

解决这个问题的正确方法是什么？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-10T10:38:55.450

在我的 HTC 梦想中，有一个复选框可以禁用自动同步。如果您愿意，我可以查找菜单树状结构，以便您可以在 Android 源代码中找到回调函数。但我很确定不能完全禁用自动同步。取消选中自动同步将阻止定时执行同步，但如果任何网络数据连接可用，则每次运行具有同步功能的应用程序时都会发生同步。

总之祝你好运。

编辑 ：

有两种方法可以获取您想要的信息。

首先，我认为您可以使用 android-sources/packages/apps/Settings/src/com/android/settings/Utils.java 中的代码来创建一个活动，该活动将征用意图的所有键，然后找到您想要的.

另一种方法是给制作 Toggle Setting 应用程序 ( [http://smartphoneandroid.com/2008/12/28/toggle-setting-perfect-app-for-android-phone.html](http://smartphoneandroid.com/2008/12/28/toggle-setting-perfect-app-for-android-phone.html) ) 的人写一封不错的邮件，因为他显然找到了解决您问题的方法。他的电子邮件地址写在 android 市场上的应用程序表中。我不会在这里写，但如果你没有真正的安卓手机，我可以通过你的邮件地址邮寄给你。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-10T13:01:57.153

背景数据是一种[安全设置](http://developer.android.com/reference/android/provider/Settings.Secure.html)，因此不能由用户应用程序更改。但请记住，这只是一个设置 - 它不是强制执行的。应用程序旨在阅读并尊重它，但我敢打赌有些不会。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2014-07-24T14:26:20.573

禁用自动同步

```
ContentResolver.setMasterSyncAutomatically(false); 
```

启用自动同步

```
ContentResolver.setMasterSyncAutomatically(true); 
```

您需要的权限是

```
<uses-permission android:name="android.permission.WRITE_SYNC_SETTINGS" /> 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-01-12T17:01:54.110

ContentResolver 上的 setMasterSyncAutomatically() 应该这样做。检查：[通用同步设置自动同步复选框以编程方式](https://stackoverflow.com/questions/8009273/general-sync-settings-auto-sync-checkbox-programtically)

# delphi - 在 Delphi 中对运行时和设计时包大惊小怪

> ID：767779
> 
> 赞同：7
> 
> 时间：2009-04-20T10:53:39.257
> 
> 标签：delphi, runtime, packages, vcl, design-time

我已经看到 Delphi 中的大多数组件 (VCL) 都分为两部分。
1) DesignTime 包
2) RunTime 包

为什么要大惊小怪。如果将 RunTime 和 DesignTime 包合并到一个包中，会有什么区别？

我从来没有真正理解过这种分离逻辑。

那么这背后的逻辑是什么？

曾经有人提到，这种区别只是为了避免采用和遵循 Microsoft 制定的组件标准。这背后真的没有逻辑。

这是真的？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-04-20T11:05:48.010

答：某些组件具有大型且复杂的设计时功能，例如属性编辑器，您可能不想将其包含在运行时应用程序中。

B. 一些组件供应商不希望将其大型复杂设计时功能许可用于免版税运行时使用，而是限制它们仅供开发人员使用。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-20T17:18:29.520

如果您进行了一些研究，您会发现[这个 SO 问题](https://stackoverflow.com/questions/763075/component-package-where-to-divide-runtime-designtime-registration-etc)在不到 2 天前被问到......

如前所述，主要原因是您不能在运行时包中包含任何 Delphi 设计单元。并且没有理由使用只能在 IDE 中运行的代码来膨胀您的可执行文件。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-04-20T11:18:09.870

1.  设计时的东西可能会使用 Delphi 的内部单元/包，您既没有源代码也没有法律允许以二进制形式分发这些单元/包。
2.  您可能不想让您的应用程序要求在用户的计算机上安装 Delphi。

逻辑是将您自己的代码与“胶水”代码分开，这使得它在 IDE 中易于使用。

# windows - 如何检查是否使用 Perl 加载了 Windows 设备驱动程序？

> ID：767783
> 
> 赞同：2
> 
> 时间：2009-04-20T10:54:55.727
> 
> 标签：windows, perl, driver

我想知道如何检查是否使用 Perl 加载了设备驱动程序？操作系统是 Windows Server 2003，我有兴趣查看特定视频卡的驱动程序是否正确加载。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-20T13:30:05.310

一种方法是在 MSDN 上查找所需的 Win32 API 调用，然后使用 Win32::API，或使用 sysinternals 程序 Listdlls.exe

[http://technet.microsoft.com/en-us/sysinternals/bb896656.aspx#ListDLLs](http://technet.microsoft.com/en-us/sysinternals/bb896656.aspx#ListDLLs) v2.25

# c# - 如何使用 C# 中的发布请求上传图像/文件？

> ID：767790
> 
> 赞同：0
> 
> 时间：2009-04-20T10:56:08.220
> 
> 标签：c#, image, post, upload, request

C# 提供了提交发布请求的功能，但没有关于在 MSDN 上上传图像/文件的功能。我想在不使用原始标题的情况下执行此操作。

### 相关问题

[使用 HTTPWebrequest (multipart/form-data) 上传文件](https://stackoverflow.com/questions/566462/upload-files-with-httpwebrequest-multipart-form-data)

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-20T10:57:41.103

您可以轻松使用`WebClient`类。它有一个`UploadFile`方法：

```
var client = new WebClient();
client.UploadFile("http://server/upload.aspx", @"C:\file.jpg"); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-23T17:35:59.457

我的 ASP.NET 上传常见问题解答有一篇关于此的文章，带有示例代码：[使用 RFC 1867 POST 请求和 HttpWebRequest/WebClient 上传文件](http://aspnetupload.com/Upload-File-POST-HttpWebRequest-WebClient-RFC-1867.aspx)。此代码不会将文件加载到内存中，支持多个文件，并支持表单值、设置凭据和 cookie 等。

# xpath - 带有特殊字符的 xpath 属性

> ID：767792
> 
> 赞同：0
> 
> 时间：2009-04-20T10:57:01.153
> 
> 标签：xpath, expression, special-characters

```
$xpath->query('/html[boolean(string(normalize-space(@xml:lang))) = "true"]') 
```

通常上面的查询会起作用，但在这种情况下，xhtml 属性 xml:lang 中有冒号。将其替换为实体 &59; 也不行。

有什么建议么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-20T13:00:33.227

这不是一个完整的答案，但......

需要注意的重要一点是属性 xml:lang 中没有冒号。属性“lang”是“xml”命名空间，它并不完全相同。xml 命名空间（在某些方面）是“内置的”。

其次，我认为您可能的意思是：

```
'/html[boolean(string(normalize-space(@xml:lang))) = true()]' 
```

因为真与假不是 xpath 中的字符串。

现在，我使用 XML::LibXML 在 perl 中运行了以下脚本，它工作得很好：

```
#!/usr/bin/perl

use strict;
use warnings;
use XML::LibXML;

my $parser = XML::LibXML->new;
my $xml = $parser->parse_file('test.html');

my ($node) = $xml->findnodes('/html[boolean(string(normalize-space(@xml:lang))) = true()]');

print $node->textContent, "\n"; 
```

使用这个作为我的输入：

```
<?xml version='1.0'?>
<html xml:lang='en-uk'>
        <head><title>boo</title></head>
        <body><p>boo</p></body>
</html> 
```

打印出预期的输出（“ `boo\nboo`”）。

我想知道您是否正在使用不完全识别名称空间的解析器。另外，你所说的“作品”是什么意思？您是否试图找出 html 元素是否具有 xml:lang 属性？

如果你是，这可能是一个更好的说法：

```
'/html[@xml:lang]' 
```

# prolog - Prolog 运算符优先级和规则匹配

> ID：767799
> 
> 赞同：6
> 
> 时间：2009-04-20T10:58:27.577
> 
> 标签：prolog, operator-precedence

我在我的序言解释器中加载了接下来的两个事实：

```
foo(U+V,1).
foo(U*V,2). 
```

现在我尝试使用该结果进行下一个查询：

```
foo(x*x+x,R).  -->  R = 1
foo(x+x*x,R).  -->  R = 1
foo(x*x*x,R).  -->  R = 2 
```

现在我尝试下一个查询：

```
foo(x*x-x,R).  -->  no 
```

据我了解，这可以通过运算符优先级如何构建树表达式来解释：

```
x+x*x  -->  +           so it matches with  -->  +
           / \                                  / \
          x   *                                U   V
             / \
            x   x

x-x*x  -->  -           DOES NOT matches any fact.
           / \                             
          x   *                                
             / \
            x   x 
```

这个解释正确吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-20T11:14:33.717

是的，这是正确的。

默认运算符优先级被定义为自然的，即使用正常的数学优先级。但如果你不喜欢，你可以重新定义它。

改变优先级是否是一个好主意是另一回事，它有效地改变了 Prolog 的语法并可能导致解析问题。特别是如果您更改 Prolog 语法的运算符优先级，优先级高于 1000。

# asp.net - IIS 7 网站共享相同的应用程序池

> ID：767802
> 
> 赞同：0
> 
> 时间：2009-04-20T10:59:16.187
> 
> 标签：asp.net, iis, iis-7

我有一个 ASP.NET 应用程序。我计划在同一台服务器上运行这个应用程序的多个实例。

每个实例都有自己的域，例如 www.app1.com 和 www.app2.com。

每个应用程序实例都有自己的管理区域，应该受到 SSL 保护。您不能在同一台机器和端口号上安装多个 SSL 证书，因此使用[https://www.app1.com/admin](https://www.app1.com/admin)和[https://www.app2.com/admin](https://www.app2.com/admin)是不行的。

然后我想做以下事情：

使用我的 appname 域：www.appname.com 和 SSL 证书，并在 IIS 中为我​​拥有的每个客户端域添加一个应用程序到该网站：

[https://www.appname.com/app1/admin](https://www.appname.com/app1/admin) & [https://www.appname.com/app2/admin](https://www.appname.com/app2/admin)。

但这会隔离 www.app1.com 和[https://www.appname.com/app1/admin](https://www.appname.com/app1/admin)之间的会话状态——尽管它们在 IIS 7 中使用相同的应用程序池。

有没有办法解决这个问题？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-20T11:38:32.877

我见过在不同的 ASP.NET 应用程序之间共享会话状态的一种方法是使用其他选项之一来存储会话状态信息。不幸的是，我目前无法访问 IIS 7，但假设它是相似的，以下是您在 IIS 6 中配置它的方式：

*   IIS 管理控制台
*   调出适用虚拟目录的属性
*   ASP.NET 选项卡 -> 编辑配置
*   状态管理选项卡

“会话状态模式”默认为 InProc，但您可以将其更改为您的各种应用程序“实例”以使用相同的 SQL Server 数据库。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-10-10T15:59:34.983

您可以在同一台机器上使用多个 SSL 证书，它们只需要专用 IP 地址。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-12-07T02:28:20.310

请注意，您不一定需要服务器上的多个 IP 来在 IIS 7 中的 Windows Server 上安装多个域 SSL 证书。您只需从命令行添加它们。

我从 GoDaddy 获得了 UCC 标准 SSL 多域证书，然后添加了我需要的所有域名。您基本上只需将其安装到您想要的域之一，然后通过命令行在其他域之间共享它。我的猜测是，这*并不是*适用于所有情况的最佳做法，但它确实可以解决您的问题，而不会*强迫*您共享应用程序的安全部分。

查看此链接以获取指导：

[http://www.sslshopper.com/article-ssl-host-headers-in-iis-7.html](http://www.sslshopper.com/article-ssl-host-headers-in-iis-7.html)

顺便说一句 - 每个域名的管理员都必须批准它。如果其上的域名发生更改，它将使您在 IIS 的所有站点中的证书无效，并且所有管理员都必须重新授权更改。

# vim - 是否可以用鼠标使用vim

> ID：767804
> 
> 赞同：5
> 
> 时间：2009-04-20T10:59:52.720
> 
> 标签：vim, editor, mouse, vi

可以用鼠标使用vim吗？如果是这样，怎么做？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-20T11:11:14.160

您可以启用鼠标`:set mouse=a`（字母“a”表示在所有模式下启用它）

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-04-20T11:02:54.787

使用 GVim，您可以选择文本并移动光标，并使用鼠标选择菜单选项。复制和粘贴，通过右键单击等...但我想这错过了使用 VIM 的重点。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-04-20T11:04:11.790

您可以将某些操作映射到鼠标左键单击和右键单击。并且有很多已经映射的动作可以与 ctags 和其他东西一起使用。

```
:help mouse-using 
```

# c# - “else if”比“switch() case”快吗？

> ID：767821
> 
> 赞同：397
> 
> 时间：2009-04-20T11:07:15.247
> 
> 标签：c#, performance, if-statement, switch-statement

我是前 Pascal 人，目前正在学习 C#。我的问题如下：

下面的代码是否比进行切换更快？

```
int a = 5;

if (a == 1)
{
    ....
}
else if(a == 2)
{
    ....
}
else if(a == 3)
{
    ....
}
else if(a == 4)
{
    ....
}
else
    .... 
```

和开关：

```
int a = 5;

switch(a)
{
    case 1:
        ...
        break;

    case 2:
        ...
        break;

    case 3:
        ...
        break;

    case 4:
        ...
        break;

    default:
        ...
        break;

} 
```

哪个更快？

我在问，因为我的程序具有类似的结构（很多很多“else if”语句）。我应该把它们变成开关吗？

* * *

## 回答 #1

> 赞同：705
> 
> 时间：2009-04-20T11:14:15.947

对于少数几项，差异很小。如果您有很多物品，您绝对应该使用开关。

如果一个开关包含五个以上的项目，则使用查找表或哈希列表来实现。这意味着所有项目都获得相同的访问时间，与 if:s 列表相比，最后一个项目需要更多时间才能到达，因为它必须首先评估每个先前的条件。

* * *

## 回答 #2

> 赞同：184
> 
> 时间：2009-04-20T11:27:23.840

你为什么在乎？

99.99% 的时间，你不应该在意。

这些类型的微优化不太可能影响代码的性能。

此外，如果您需要关心，那么您应该对您的代码进行性能分析。在这种情况下，找出 switch case 和 if-else 块之间的性能差异将是微不足道的。

**编辑：**为了清楚起见：实施更清晰和更可维护的设计。通常，当遇到巨大的 switch-case 或 if-else 块时，解决方案是使用多态性。找到正在改变的行为并将其封装起来。我以前不得不处理像这样巨大、丑陋的 switch case 代码，而且通常简化起来并不难。但是哦，太令人满意了。

* * *

## 回答 #3

> 赞同：32
> 
> 时间：2009-04-20T11:11:19.200

相信[这个性能评估](http://www.blackwasp.co.uk/SpeedTestIfElseSwitch.aspx)，switch case 更快。

这是结论：

> 结果表明 switch 语句比 if-else-if 梯形图执行得更快。这是由于编译器能够优化 switch 语句。在 if-else-if 梯形图的情况下，代码必须按照程序员确定的顺序处理每个 if 语句。但是，因为 switch 语句中的每个 case 都不依赖于较早的 case，所以编译器能够以提供最快执行速度的方式重新排序测试。

* * *

## 回答 #4

> 赞同：16
> 
> 时间：2009-04-20T11:18:41.303

另一件需要考虑的事情：这真的是您的应用程序的瓶颈吗？在极少数情况下确实需要这种优化。大多数时候，你可以通过重新思考你的算法和数据结构来获得更好的加速。

* * *

## 回答 #5

> 赞同：11
> 
> 时间：2009-04-20T11:11:16.640

Switch 通常比长长的 if 列表要快，因为编译器可以生成跳转表。列表越长，switch 语句对一系列 if 语句的影响就越好。

* * *

## 回答 #6

> 赞同：10
> 
> 时间：2009-04-20T11:10:56.453

我会说切换是要走的路，它既更快又更好的做法。

这是一个[链接](http://www.blackwasp.co.uk/SpeedTestIfElseSwitch.aspx)，显示了比较两者的基准测试。

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2009-04-20T11:10:07.190

应该不难测试，创建一个在 5 个数字之间切换或 ifelse 的函数，将 rand(1,5) 放入该函数并在计时时循环几次。

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2009-04-20T11:13:27.337

`switch`如果可能，通常由编译器翻译成查找表。因此，查找任意案例是 O(1)，而不是在找到您想要的案例之前实际进行一些案例比较。

所以在很多情况下一个`if`/`else if`链会比较慢。不过，根据您的案件受到打击的频率，这可能没有什么区别。

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2009-04-20T11:10:52.087

从技术上讲，它们产生完全相同的结果，因此它们应该以几乎相同的方式进行优化。但是，与 ifs 相比，编译器使用跳转表优化 switch case 的可能性更大。

我在这里谈论一般情况。对于 5 个条目，假设您按频率对条件进行排序，为 if 执行的平均测试次数应少于 2.5。除非在一个非常紧凑的循环中，否则几乎不会成为写回家的瓶颈。

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2009-04-20T11:24:33.333

比 switch 的性能优势（相对轻微，但值得注意）更重要的是可读性问题。

与 if 链相比，我发现一个 switch 语句的意图和纯空格非常清晰。

* * *

## 回答 #11

> 赞同：5
> 
> 时间：2010-04-04T12:47:32.353

我不确定，但我相信其中一种或另一种的速度会根据您使用的编程语言而变化。

我通常更喜欢使用开关。这样代码更容易阅读。

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2009-04-20T11:14:58.050

简短回答：switch 语句更快

if 语句平均需要两次比较（在运行示例代码时）才能找到正确的子句。

无论您有多少不同的情况，switch 语句的平均比较次数都是 1。编译器/VM 将在编译时制作一个可能选项的“查找表”。

如果您经常运行此代码，虚拟机是否可以以类似的方式优化 if 语句？

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2009-04-20T19:25:51.163

由于该语句表达了与您的/链`switch`相同的意图，但以更受限制、更正式的方式表达，您的第一个猜测应该是编译器将能够更好地优化它，因为它可以得出更多关于代码条件的结论（即只有一个状态可能为真，被比较的值是原始类型等。）当您比较两种相似的语言结构以获得运行时性能时，这是一个非常安全的普遍事实。`if``else`

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2012-09-29T08:24:12.120

请参阅 [http://msdn.microsoft.com/en-us/library/system.reflection.emit.opcodes.switch%28VS.71%29.aspx](http://msdn.microsoft.com/en-us/library/system.reflection.emit.opcodes.switch%28VS.71%29.aspx)

switch statement basically a look up table it have options which are known and if statement is like boolean type. according to me switch and if-else are same but for logic switch can help more better. while if-else helps to understand in reading also.

# flash - Flash 视频播放完毕后，如何运行一行动作脚本？

> ID：767825
> 
> 赞同：0
> 
> 时间：2009-04-20T11:08:48.893
> 
> 标签：flash, video, actionscript-2, flv, flvplayback

我在 Flash 横幅中包含一个视频。当横幅加载时，在将播放视频的空间中，我准备了“点击播放”图形，并带有一个调用 nextFrame 的按钮——将主 Flash 电影的播放头带到实际视频所在的帧。

然后视频播放正常，但在空白的黑屏上结束。

我想要的是，当视频播放完毕后，主 Flash 电影的时间线将返回到带有“点击播放”图形的帧，而不是空白。谁能告诉我我需要使用什么动作脚本（as2）以及把它放在哪里？谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-20T22:19:11.497

你用什么来显示 FLV ？FLVPlayback 组件、媒体显示组件或只是 Video、NetSteam 和 NetConnection 类？

例如，对于 FLVPlayback 组件，您有[FLVPlayback.complete](http://help.adobe.com/en_US/AS2LCR/Flash_10.0/00002391.html)事件，但让我们知道您使用的是什么，其余的应该很容易。

假设 FLVPlayback 组件的实例名称为*my_FLVPlybk*，这应该可以帮助您：

```
import mx.video.*;
var listenerObject:Object = new Object();
listenerObject.complete = function(eventObject:Object):Void {
    trace("Elapsed play time at completion is: " + my_FLVPlybk.playheadTime);
};
my_FLVPlybk.addEventListener("complete", listenerObject);
my_FLVPlybk.contentPath = "http://www.helpexamples.com/flash/video/water.flv"; 
```

代码片段来自 Flash 8 [FLVPlayback.complete](http://livedocs.adobe.com/flash/8/main/00003537.html#3734897)事件文档。

# html - html表单元素上的圆角和颜色边框

> ID：767829
> 
> 赞同：1
> 
> 时间：2009-04-20T11:09:39.780
> 
> 标签：html, forms, coding-style

我怎样才能在 html 表单中制作很酷**的复选框**和**选择框**元素，它们`IE` 也可以使用？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-20T11:15:09.267

通常所做的是创建一个假元素，该元素（通过 javascript）将值设置为隐藏元素（通过 css 隐藏）。然后这个假元素可以应用任何视觉样式。

*   [使用 jQuery 创建自定义样式的复选框](http://john.mcclumpha.org/javascript/Creating_custom_styled_checkboxes_with_jQuery/)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-20T11:30:53.537

复选框和单选按钮不能（一致地）设置样式，每个浏览器都以自己的方式显示它们，并且一些浏览器完全忽略了为它们设置的样式。

据我所知，Ólafur Waage 所说的（通过 javascript 创建一个假元素）是最常见的方法。

# c# - WCF 并将代理代码移动到 DLL。是否可以？

> ID：767834
> 
> 赞同：3
> 
> 时间：2009-04-20T11:10:23.413
> 
> 标签：c#, wcf, proxy

看起来我无法成功地将我的 WCF 代理代码移动到单独的 DLL 中（与我在遇到的所有示例中看到的 EXE 不同）。

我尝试这样做的原因是我希望我的代理代码被不同的客户端（可能是非托管代码）调用，这些客户端可能对 WCF 一无所知，但只需要访问服务（通过由代理可能吗？）。

每当我将以下创建新代理的代码移动到同一解决方案中的不同 VS 项目时，我都会收到可怕的“*在 ServiceModel 客户端配置部分中找不到引用合同 'localhost.IRemoteCommandService' 的默认端点元素”异常*。

```
localhost.RemoteCommandServiceClient proxy = 
    new localhost.RemoteCommandServiceClient(); 
```

每当在代理代码所在的同一项目中的 Main 方法中使用相同的代码时（从 Visual Studio 自动生成），相同的代码都能顺利运行。

任何的想法？我希望我的代理的客户端代码不需要将服务模型 XML 配置作为代理，因为这会破坏我首先将 WCF 代理代码移动到 DLL 的目的。

谢谢，斯特凡诺

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-20T11:11:43.910

端点确实通常在配置文件中指定。您必须查看配置文件中的 serviceModel 数据，并将其复制到您的调用 app.config - 或者您需要使用更详细的方式在代码中创建代理（即通过代码指定地址、绑定、配置等给构造函数）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-20T11:26:44.590

如果您不想在客户端上进行端点配置，则必须通过在代码中指定所有内容来将其嵌入到您的代理 dll 中。

另一种选择是使用动态代理，例如 this [one](http://blogs.msdn.com/vipulmodi/archive/2006/11/16/dynamic-programming-with-wcf.aspx)，这将允许您的客户端应用程序中没有 serviceModel。

# php - 如何对 HABTM 数据进行分页？

> ID：767835
> 
> 赞同：0
> 
> 时间：2009-04-20T11:10:43.287
> 
> 标签：php, cakephp

我有一个表，其中一个集合有许多实体，一个实体具有并属于许多集合..现在对于特定集合有很多实体..我如何对属于特定集合的那些实体进行分页..

我的查找查询说.., $this->Collection->find('first', array('condition'=>array('uid'=>$uid)), 'contains(array('Entity'))) ; 现在如何对实体的结果进行分页..

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-26T22:10:53.170

在您的控制器操作中

$this->paginate=array('Entity' => array('conditions' => "Entity.collection_id=$id", 'fields' => array('Entity.*') ) );

$this->set('entities', $this->paginate($this->Collection->Entity));

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-20T12:32:30.580

我在这里假设您使用的是 SQL 数据库。
现在我还没有测试代码，但我认为它应该可以工作。

```
// First query to get some info.
$testquery = mysql_query("SELECT * FROM `table` WHERE `entity` = 'something'");
    if(!$testquery) die(mysql_error());

$total_items      = mysql_num_rows($testquery);     // Count the total number of entity's that match the criteria.  
$limit            = 10;     // Maximun number of entity's on page.
$page             = $_GET['page'];

//calcuate total pages
$total_pages     = ceil($total_items / $limit); // ceil is used to round up fractions to the next int
$set_limit          = $page * $limit - ($limit);

$query2 = mysql_query("SELECT * FROM `table` WHERE `entity` = 'something' LIMIT $set_limit, $limit");
    if(!$query2) die(mysql_error());

//show data matching query:
while($code = mysql_fetch_object($query2)) {
    echo("item: ".$code->title."<BR>");
}

// This displays the "previous page" link if there is a previous page.
$prev_page = $page - 1;
if($prev_page >= 1) {
    echo("<a href=yourpagename.php?page=$prev_page>Previous</a>");
}

//Display middle pages: 
$mid_page = 1;
while ($total_pages >= $mid_page) {
    if ($page == $midpage){
        echo ("<b>$mid_page</b> | ");
    }
    else {
        echo ("  <a href=yourpagename.php?page=$mid_page> $mid_page </a> | ");
        $midpage++;
    }
}

// This page will display a "next page" link if there is one.
$next_page = $page + 1;
if($next_page <= $total_pages) {
    echo("<a href=yourpagename.php?page=$next_page>Next</a>");
} 
```

# sharepoint-2007 - 如何在 MOSS2007/WSS 中实现会话超时功能？

> ID：767845
> 
> 赞同：0
> 
> 时间：2009-04-20T11:13:02.470
> 
> 标签：sharepoint-2007

我想在我的 SharePoint 应用程序中实现会话超时功能。我尝试通过以下方式进行设置：

```
Central Administration --> Application Management--> Configure Session State. 
```

我在这里设置了一个时间框架，但它不起作用。谁能建议我可以拥有相同功能的任何其他方式？

提前致谢，

萨西什

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-24T18:54:28.290

它只是一个 .NET Web 应用程序。你总是可以在 web.config 中设置它。或者，如果您感到疯狂，总有 machine.config。

# java - 数据库迁移

> ID：767846
> 
> 赞同：4
> 
> 时间：2009-04-20T11:13:07.993
> 
> 标签：java, database, jdbc, migrate

我正在研究java中的数据库迁移工具。该工具将数据库表及其数据复制到目标数据库。但我希望它适用于不同的数据库。从 mysql 复制并在 derby 等中创建。使用 JDBC，我们可以收集有关表及其列的足够信息。但是我要问这个，如果我可以使用 sql free 在 java 上重新创建表。我的意思是不同的数据库有不同的数据类型，有时它们的 sql 语法也不同。那么 JDBC 或任何其他库（可以是开源的）能否以一种简单且全球化的方式完成这项工作？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-20T13:59:26.313

Apache 的[DdlUtils](http://db.apache.org/ddlutils/)完成了我需要的工作。当我搜索crossdb时发现它，它非常有用但功能强大。它可以从头开始生成数据库，只需使用参数。或者它可以抓取现有的数据库表定义，也可以使用索引定义。如果需要，您可以使用分隔符（对我来说，使用 Apache Derby 是一个非常重要的选择）。您可以打印出这些定义或将它们直接应用到源数据库（我还没有尝试过第二个）。它翻译所选数据库的定义。但是一个大问题是没有关于如何开始使用它的好的教程。我搜索了这些包以找到一个好的起点。这是我所取得的成就，一个生成完整数据库表创建 sql 的示例代码。

```
DerbyPlatform dp = new DerbyPlatform();
dp.setDelimitedIdentifierModeOn(true);
Database dbs = new Database();
DerbyModelReader dmr = new DerbyModelReader(dp);
Database test = dmr.getDatabase(conn, "MyDBTest");

DerbyBuilder db = new DerbyBuilder(dp);
String testSqlDerby = dp.getCreateTablesSql(test, true, true);
System.out.println(testSqlDerby);

System.out.println("\n\n\n\n");

MySql50Platform mp = new MySql50Platform();
mp.setDelimitedIdentifierModeOn(true);
MySqlBuilder mb = new MySqlBuilder(mp);
String testSqlMysql = mp.getCreateTablesSql(test, true, true);
System.out.println(testSqlMysql); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-20T11:32:41.720

我不知道 JDBC 具有执行此操作的通用工具。您可能必须创建一个实用程序库来生成用于创建表的 SQL。

从一个执行 ANSI SQL 的程序开始，并在您打算支持的尽可能多的平台上对其进行测试。请记住，Java 仍然是一次编写，到处调试，因此您需要在您打算支持该系统的任何平台上对其进行测试。如果您必须对任何平台的 create 语句进行辩证变体，则将生成器子类化。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-05T14:33:32.310

试试 SchemaCrawler，它也是开源的，用 Java 编写。它提供对数据库元数据的编程访问，还允许在 JavaScript 中编写脚本。 [http://schemarawler.sourceforge.net/](http://schemacrawler.sourceforge.net/)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-20T13:23:08.163

尝试查看 HIBERNATE 为迁移提供了什么。我知道 H 可以从数据库模式和模型对象的模式生成模型对象。所以也许你可以重用 HIBERNATE 的一些部分。他们有 DIALECT 的概念，这正是您所说的：定义数据库实现的细节。

# iphone - 如何显示iphone应用程序的背景图像或前景图像

> ID：767848
> 
> 赞同：0
> 
> 时间：2009-04-20T11:13:27.697
> 
> 标签：iphone

这可能是一个非常愚蠢的问题。从今天早上开始，我正试图在 iPhone 上的第一个“Hello World”应用程序后面放置一个图像。我尝试使用 Interface Builder 使用库中的 UIImageView 对象这样做，也尝试以编程方式这样做。

谷歌搜索也没有太大帮助。任何人都可以演示一个简单的应用程序，该应用程序显示如何在 iphone 应用程序中、背景和/或前景中显示图像？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-20T11:34:05.383

您可以尝试在 IB 中将 UIImageView 添加到您的视图中，并将其排列到背景中（在所有标签等后面）

编辑：我刚刚意识到，您已经在 IB 中尝试过。我无知，对不起。问题是，我自己也做了同样的把戏，而且效果很好。如果您在 IB 中将 UIImageView 添加到您的视图中，会发生什么？它会粘在前台吗？如果是这样，您可以使用“布局”菜单重新排列对象的位置。

edit2：我刚刚搜索了iphone参考库，“Hello World”示例也显示了它是如何完成的。（[http://developer.apple.com/iphone/prerelease/library/samplecode/HelloWorld/index.html](http://developer.apple.com/iphone/prerelease/library/samplecode/HelloWorld/index.html)）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-20T11:47:04.790

您缺少的步骤可能是将图像添加到项目中。

将图像从查找器拖到项目大纲的资源部分。Xcode 从文件类型推断动作，图像将被复制到 Resources 文件夹。您可以在项目大纲的 Targets 部分查看它，如果您公开您的 Hello World 目标，您将看到不同的构建阶段，包括“复制捆绑资源”构建阶段。

无论如何，一旦将图像添加到您的项目中，UIImageView 检查器图像名称将自动完成您的图像名称，并且一切都应该工作。无需代码。

# xslt - XPath 查找节点是否存在

> ID：767851
> 
> 赞同：208
> 
> 时间：2009-04-20T11:14:39.237
> 
> 标签：xslt, xpath, expression

使用 XPath 查询如何确定节点（标记）是否存在？

例如，如果我需要确保网站页面具有正确的基本结构，例如`/html/body`和`/html/head/title`.

* * *

## 回答 #1

> 赞同：331
> 
> 时间：2009-04-20T11:26:43.343

```
<xsl:if test="xpath-expression">...</xsl:if> 
```

所以例如

```
<xsl:if test="/html/body">body node exists</xsl:if>
<xsl:if test="not(/html/body)">body node missing</xsl:if> 
```

* * *

## 回答 #2

> 赞同：76
> 
> 时间：2010-09-20T12:37:32.480

试试下面的表达式：`boolean(path-to-node)`

* * *

## 回答 #3

> 赞同：51
> 
> 时间：2011-07-04T10:38:27.313

Patrick 是正确的，无论是使用 ，还是`xsl:if`检查节点是否存在的语法。但是，正如 Patrick 的回答所暗示的那样，没有与 if-then-else 等效的 xsl，因此，如果您正在寻找更像 if-then-else 的东西，通常最好使用`xsl:choose`and `xsl:otherwise`。因此，Patrick 的示例语法将起作用，但这是另一种选择：

```
<xsl:choose>
 <xsl:when test="/html/body">body node exists</xsl:when>
 <xsl:otherwise>body node missing</xsl:otherwise>
</xsl:choose> 
```

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2011-05-01T17:03:18.317

使用选项可能会更好，不必多次输入（或可能错误输入）您的表达式，并允许您遵循其他不同的行为。

我经常使用`count(/html/body) = 0`，因为具体的节点数量比集合更有趣。例如...当意外超过 1 个节点与您的表达式匹配时。

```
<xsl:choose>
    <xsl:when test="/html/body">
         <!-- Found the node(s) -->
    </xsl:when>
    <!-- more xsl:when here, if needed -->
    <xsl:otherwise>
         <!-- No node exists -->
    </xsl:otherwise>
</xsl:choose> 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2012-02-16T23:30:33.463

我在 Ruby 中工作并使用 Nokogiri 获取元素并查看结果是否为 nil。

```
require 'nokogiri'

url = "http://somthing.com/resource"

resp = Nokogiri::XML(open(url))

first_name = resp.xpath("/movies/actors/actor[1]/first-name")

puts "first-name not found" if first_name.nil? 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2010-04-25T12:10:39.167

使用 count() 在 Java 中使用 xpath 时的一种变体：

```
int numberofbodies = Integer.parseInt((String) xPath.evaluate("count(/html/body)", doc));
if( numberofbodies==0) {
    // body node missing
} 
```

# wpf - 如何在 WPF Grid 列中定位元素？

> ID：767854
> 
> 赞同：3
> 
> 时间：2009-04-20T11:16:06.677
> 
> 标签：wpf, grid, wpf-positioning

假设我想在 Grid 控件的第 3 列中的坐标 x=20, y=5 处放置一个元素。我该怎么做呢？我是否需要在列中添加 Canvas 面板，然后向其中添加控件？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-20T11:31:49.460

你可以这样做，但看看这个.. [附加属性](http://www.interact-sw.co.uk/iangblog/2006/03/10/attachedpropcomplexity)

```
<Grid Background="Yellow">
  <Rectangle Fill="Red" Margin="20,10,0,0" Width="50" Height="30"
     HorizontalAlignment="Left" VerticalAlignment="Top" />
  <Rectangle Stroke="Green" Margin="30,15,0,0" Width="20" Height="30"
     HorizontalAlignment="Left" VerticalAlignment="Top" />
</Grid> 
```

您可以使用 Margin 属性来模拟绝对定位。

不确定这是否会对您有所帮助，但无论如何都是有趣的阅读。

# iphone - 一个视图中有多个 PickerViews？

> ID：767856
> 
> 赞同：21
> 
> 时间：2009-04-20T11:16:58.733
> 
> 标签：iphone, objective-c, oop

我想使用同一个 viewController 在同一个视图中创建 2 个单独的选择器。但是如何为他们设置单独的委托和数据源呢？

似乎无法让它工作。它们显示相同的数据。如果您对此有任何示例代码，将不胜感激。

谢谢。

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2009-04-20T12:53:52.557

请注意，数据源和委托协议的每个方法都包含一个`UIPickerView *`参数，例如：

```
- (NSInteger)numberOfComponentsInPickerView:(UIPickerView *)pickerView 
```

您需要使用它来区分您的两个实例，如下所示：

```
- (NSInteger)numberOfComponentsInPickerView:(UIPickerView *)pickerView
{

    if([pickerView isEqual: pickerOne]){
      // return the appropriate number of components, for instance
         return 3;
    }

    if([pickerView isEqual: pickerTwo]){
      // return the appropriate number of components, for instance
         return 4;
    }
} 
```

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2009-04-20T14:22:02.063

最直接的方法是使用[`tag`](http://developer.apple.com/iPhone/library/documentation/UIKit/Reference/UIView_Class/UIView/UIView.html#//apple_ref/doc/uid/TP40006816-CH3-SW25)pickerView 的属性。我通常在标题中定义这些以提高可读性。您可以在 Interface Builder 或代码中设置标签。

```
#define kPickerOne 0
#define kPickerTwo 1 
```

然后在你的实现文件中......

```
-(NSInteger)numberOfComponentsInPickerView:(UIPickerView *)pickerView 
{
     if(pickerView.tag == kPickerOne)
     {
          // do something with picker one
     }
     else if(pickerView.tag == kPickerTwo)
     {
          // the other picker
     }
} 
```

# delphi - 用户可调整的数据结构

> ID：767865
> 
> 赞同：2
> 
> 时间：2009-04-20T11:23:03.617
> 
> 标签：delphi, design-patterns, dynamic

假设一个用于联系人数据库的数据结构*Person 。*结构的字段应该是可配置的，以便用户可以将用户定义的字段添加到结构中，甚至可以更改现有字段。所以基本上应该有一个配置文件，如

```
FieldNo  FieldName          DataType           DefaultValue
 0        Name               String             ""
 1        Age                Integer            "0"
 ... 
```

然后程序应该加载这个文件，管理动态数据结构（动态不是以“运行时更改”的方式，而是以“用户可以通过配置文件更改”的方式）并允许对数据字段进行简单且类型安全的访问.

我已经实现了这一点，将有关每个数据字段的信息存储在静态数组中，并仅存储对象中更改的值。

我的问题：有没有描述这种情况的模式？我想我不是第一个遇到创建用户可调类问题的人？

提前致谢。如果问题不够清楚，请告诉我。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-20T11:58:04.327

我快速浏览了 Martin Folwer 的“企业应用程序架构模式”，*元数据映射*模式描述了（快速浏览）您所描述的内容。

摘录...

“*元数据映射*允许开发人员以简单的表格形式定义映射，然后可以通过通用代码进行处理，以执行读取、插入和更新数据的细节。”

高温高压

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-20T12:29:22.273

我建议查看 Martin Fowler 的企业应用程序架构模式中的各种对象关系模式，请[点击此处](https://rads.stackoverflow.com/amzn/click/com/0321127420)。这是它在此处涵盖的模式列表。

最适合您的问题似乎是[这里](http://martinfowler.com/eaaCatalog/metadataMapping.html)的元数据映射。还有其他的pattern，Mapper等。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-20T11:49:04.927

处理这个问题的正常方法是让类有一个用户定义的记录列表，每个记录都由用户定义的字段列表组成。为此，配置信息可以很容易地存储在包含类型 id、字段类型等的数据库表中，然后将实际数据存储在一个简单的表中，数据仅表示为（objectid + 字段索引）/字符串对 - 你当您读取或写入数据库时​​，将字符串与实际类型进行转换。

# delphi - 列表框中的图像预览

> ID：767866
> 
> 赞同：1
> 
> 时间：2009-04-20T11:23:27.797
> 
> 标签：delphi, image, listbox, preview

当我将鼠标悬停在文件名列表框中的项目上时，如何显示图像的预览（几乎像提示）？我尝试显示表单并加载图像，但是当预览表单显示时，我失去了列表框的焦点，这意味着当我移动鼠标时，当我转到列表中的下一个项目时预览图像不会改变.

谢谢，彼得。

* * *

根据 TOndrej 的回答，我尝试实现自定义 THintWindow，但 Canvas.StretchDraw 不会绘制作为参数发送的位图。有什么想法为什么不呢？文本正常显示。

```
procedure TFormMain.DisplayPreview(HintImage: TBitmap);
var
  CustomHint: THintWindow;
  Rect: TRect;
  MousePoint: TPoint;
begin
  *{
    Based on Source: http://www.chami.com/tips/delphi/112996D.html
  }*
  GetCursorPos(MousePoint);
  with Rect do
    begin
      // set the position and size of the hint window
      Left   := MousePoint.X;
      Top    := MousePoint.Y;
      Right  := Left + 50;
      Bottom := Top + 25;
    end;

  CustomHint := THintWindow.Create(Self);
  try
    with CustomHint do
      begin
        // set the background color
        //Color := clNone;
        **Canvas.StretchDraw(Rect, HintImage);**
        ActivateHint(Rect, 'Hint');
        Application.ProcessMessages;
        //
        // perform your tasks here
        // before closing the hint window
        //
        Sleep(500);
        ReleaseHandle;
      end;

  finally
    if Assigned(CustomHint) then
      CustomHint.Free;
  end;
end; 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-20T11:47:54.150

对我来说，您似乎想要一个自定义提示窗口。为此，您应该编写一个新的`THintWindow`后代，并通过将新类分配给单元中的`HintWindowClass`全局变量来将其全局设置为整个应用程序`Forms`，或者编写您自己的列表框后代，您将在其中处理`CM_HINTSHOW`消息并将新的提示窗口类分配给`HintInfo.HintWindowClass`. `CM_HINTSHOW`（HintInfo 指向由 VCL在消息中传递给您的控件的记录。）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-20T11:40:58.457

1）如果是，您是否像对话框（模态窗口）一样显示预览表单，然后将其更改为非模态窗口。
2）一旦预览表单出现，请记住将焦点设置回您的父窗口，这样您的具有列表框的父表单将获得焦点，并将鼠标移动事件传递给列表框。

此致。

# c# - 如何正则表达式用方法结果替换匹配组项

> ID：767869
> 
> 赞同：7
> 
> 时间：2009-04-20T11:24:43.847
> 
> 标签：c#, regex

输入字符串是这样的：

线A：50

B线：120

A线：12

B线：53

我想用 的结果替换 LineB 值`MultiplyCalculatorMethod(LineAValue)`，其中`LineAValue`是上面行的值，`LineB`并且`MultiplyCalculatorMethod`是我的另一个复杂的 C# 方法。

在半代码中，我想做这样的事情：

```
int MultiplyCalculatorMethod(int value)
{
   return 2 * Math.Max(3,value);
}
string ReplaceValues(string Input)
{
   Matches mat = Regex.Match(LineA:input_value\r\nLineB:output_value)
   foreach (Match m in mat)
   {
       m.output_value = MultiplyCalculatorMethod(m.input_value)
   }
   return m.OutputText;
}

Example:

string Text = "LineA:5\r\nLineB:2\r\nLineA:2\r\nLineB:7";
string Result = ReplaceValues(Text);
//Result = "LineA:5\r\nLineB:10\r\nLineA:2\r\nLineB:6"; 
```

我写了一个`Regex.Match`来匹配`LineA: value\r\nLineB: value`并分组获取这些值。但是当我使用 时`Regex.Replace`，我只能提供一个“静态”结果，即从匹配中组合组，但我不能在那里使用 C# 方法。

所以我的问题是如何 Regex.Replace 其中 Result 是 C# 方法的结果，其中输入是 LineA 值。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-20T12:28:54.393

您可以像这样使用 MatchEvaluator：

```
public static class Program
{
    public static void Main()
    {
        string input = "LineA:5\r\nLineB:2\r\nLineA:2\r\nLineB:7";
        string output = Regex.Replace(input, @"LineA:(?<input_value>\d+)\r\nLineB:\d+", new MatchEvaluator(MatchEvaluator));
        Console.WriteLine(output);
    }

    private static string MatchEvaluator(Match m)
    {
        int inputValue = Convert.ToInt32(m.Groups["input_value"].Value);
        int outputValue = MultiplyCalculatorMethod(inputValue);

        return string.Format("LineA:{0}\r\nLineB:{1}", inputValue, outputValue);
    }

    static int MultiplyCalculatorMethod(int value) 
    { 
        return 2 * Math.Max(3, value); 
    }
} 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-20T12:05:44.327

尝试使用以下替换重载。

```
public static string Replace( string input, string pattern, MatchEvaluator evaluator); 
```

MatchEvaluator 可以访问 Match 内容，并且可以调用任何其他方法来返回替换字符串。

# asp.net-mvc - Vista 上 IIS7 上的 ASP.NET 网站

> ID：767870
> 
> 赞同：0
> 
> 时间：2009-04-20T11:25:49.867
> 
> 标签：asp.net-mvc

我开发了一个 MVC 应用程序并将其部署到我的本地 IIS，因为我正在使用开发服务器进行开发。

这是在 Vista Ultimate 上。

当我浏览该站点时，所有图像均未显示，并且还显示了登录页面。

什么会导致图像不显示以及为什么当我没有在 web.config 中设置安全性时显示登录页面？

我试图查看 ASPNET 帐户是否具有权限，但存在该名称的用户，并且属性中也没有添加选项。

马尔科姆

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-07-22T09:15:15.927

这可能是部署问题，而不是权限问题。您是否尝试通过浏览器直接浏览图像？

因此，如果您的项目中有一个图像

```
\images\login.png 
```

在浏览器中打开以：

```
http://hostname/images/login.png 
```

如果这有效，那么您的 html 中存在引用问题。从内存中，asp.net mvc 中的大多数图像位于：

```
src="../../images/login.png" 
```

如果您的路径与当前位置不同，这可能会崩溃。我通常更喜欢这个：

```
src="/images/login.png" 
```

甚至更好：

```
src="<%= ResolveUrl("~/images/login.png")%>" 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-20T11:42:14.523

在我像这样编写图像标签之前，我在 MVC 应用程序中显示图像时遇到了问题：

```
<img src="<%= Uri.Content("./content/images/image.png") %>" alt="text" /> 
```

# workflow - 工作流服务持久性不起作用

> ID：767878
> 
> 赞同：1
> 
> 时间：2009-04-20T11:27:44.930
> 
> 标签：workflow, persistence, service

我创建了一个状态工作流服务并在 app.config 中设置了它的持久性。

```
<add type="System.Workflow.Runtime.Hosting.SqlWorkflowPersistenceService, System.Workflow.Runtime, Version=3.0.00000.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35"
               connectionString="Initial Catalog=WFPersistence;Data Source=LUKA-PC\SQLEXPRESS;Integrated Security=SSPI;"
               LoadIntervalSeconds="1"
               UnLoadOnIdle="true"/> 
```

当 UNLoadONIdle 设置为 false 时一切正常，但是当我将其设置为 true 时，客户端调用工作流服务公开的方法......它挂起，一段时间后它会引发以下错误：

> 请求通道在 00:00:59.9985354 之后等待回复时超时。增加传递给 Request 调用的超时值或增加 Binding 上的 SendTimeout 值。分配给此操作的时间可能是较长超时的一部分。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-21T07:42:09.677

解决！！！问题是我在工作流程中的自定义对象引用。所以我将它们声明为 [Serializable]，现在它可以工作了。

# python - 在 Python 中导入所花费的时间

> ID：767881
> 
> 赞同：17
> 
> 时间：2009-04-20T11:29:46.673
> 
> 标签：python, import

我想知道内置模块和用户定义模块的导入需要多少时间。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2018-08-30T06:11:53.313

从 Python3.7 版本开始，提供了新`-X importtime`选项。要测量导入时间，只需使用该选项执行您的脚本，例如`python -X importtime my_script.py`.

以供参考：

*   [https://docs.python.org/3.7/using/cmdline.html#id5](https://docs.python.org/3.7/using/cmdline.html#id5)

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-04-20T11:38:10.633

你可以测试这个运行

```
$ time python -c "import math" 
```

但是，这对您有什么帮助？进口只发生一次，几乎永远不会成为瓶颈。一遍又一遍地导入同一个模块不会比导入一次慢得多，因为 Python 会跟踪哪些模块已经被导入。

你到底想达到什么目的？

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2012-04-29T20:41:49.437

[分析导入的一种方法是使用 bzr源代码](http://wiki.bazaar.canonical.com/Download)中使用的 profile_imports 模块：

```
# put those two lines at the top of your script
import profile_imports
profile_imports.install()

# display the results
profile_imports.log_stack_info(sys.stderr) 
```

除了为您提供导入时间之外，这还估计了编译正则表达式的时间，这通常是导入速度放缓的重要原因。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-04-20T18:46:36.717

要了解导入需要多长时间，最简单的方法可能是使用[timeit 模块](http://docs.python.org/library/timeit.html)..

```
>>> import timeit
>>> t = timeit.Timer('import urllib')
>>> t.timeit(number = 1000000)
0.98621106147766113 
```

所以导入 urllib 100 万次，只用了不到一秒钟（在 Macbook Pro 上）..

> 我有一个导入其他模块的主脚本。我需要计算需要多少时间

如果您指的是总脚本执行时间，在 Linux/OS X/Cygwin 上，您可以使用以下`time`命令运行脚本，例如：

```
$ time python myscript.py 

real    0m0.046s
user    0m0.024s
sys     0m0.020s 
```

（请记住，这包括所有 Python 解释器的启动时间，以及实际的代码执行时间，尽管它是非常微不足道的）

另一种可能更有用的方法是分析脚本：

而不是运行你的代码

```
$ python myscript.py 
```

..你用..

```
$ python -m cProfile myscript.py
         1059 function calls in 0.015 CPU seconds

   Ordered by: standard name

   ncalls  tottime  percall  cumtime  percall filename:lineno(function)
        1    0.000    0.000    0.000    0.000 <string>:1(<module>)
        1    0.002    0.002    0.015    0.015 myscript.py:1(<module>)
   [...] 
```

我发现命令行输出不是很容易阅读，所以我几乎总是使用[gprof2dot](http://code.google.com/p/jrfonseca/wiki/Gprof2Dot)，它将分析信息变成一个漂亮的 graphviz 图：

```
$ python -m cProfile -o myscript.prof myscript.py
$ python gprof2dot.py -o myscript.dot -f pstats myscript.prof
$ dot -Tpng -o profile.png prof_runtest.dot -Gbgcolor=black 
```

[示例输出（1429x1896px PNG）](http://jrfonseca.googlecode.com/svn/wiki/gprof2dot.png)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-20T11:57:17.730

使用 cProfile：

```
python -m cProfile yourscript.py 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2016-07-16T03:01:37.867

我在分析一个启动时间为几秒的大型遗留应用程序时遇到了这个问题。将内置导入器替换为进行一些分析的东西相对简单。下面是一个 hacky 方式，显示每个模块大约需要多长时间执行：

```
import os
import sys
import time

class ImportEventNode(object):
    def __init__(self, name, start_time, children=None, end_time=None):
        self.name = name
        self.start_time = start_time
        self.children = [] if children is None else children
        self.end_time = end_time

    def __repr__(self):
        return 'ImportEventNode({self.name}, {self.start_time}, children={self.children}, end_time={self.end_time})'.format(self=self)

    @property
    def total_time(self):
        return self.end_time - self.start_time

    @property
    def net_time(self):
        return self.total_time - sum(child.total_time for child in self.children)

root_node = cur_node = None

all_nodes = []
old_import = __import__
def __import__(*args, **kwargs):
    global root_node, cur_node
    name = args[0]
    if name not in sys.modules:
        t0 = time.time()
        if root_node is None:
            root_node = prev_node = cur_node = lcur_node = ImportEventNode(args[0], t0)
        else:
            prev_node = cur_node
            cur_node = lcur_node = ImportEventNode(name, t0)
            prev_node.children.append(cur_node)
        try:
            ret = old_import(*args, **kwargs)
        finally:
            lcur_node.end_time = time.time()
        all_nodes.append(lcur_node)
        cur_node = prev_node
        return ret
    else:
        return old_import(*args, **kwargs)

__builtins__.__import__ = __import__ 
```

运行一个简单的示例，这是导入 scipy.stats 时的样子：

```
:import scipy.stats
:
:nodes = sorted(all_nodes, key=(lambda x: x.net_time), reverse=True)
:for node in nodes[:10]:
:    print(node.name, node.net_time)
:
:<EOF>
('pkg_resources', 0.08431100845336914)
('', 0.05861020088195801)
('decomp_schur', 0.016885995864868164)
('PIL', 0.0143890380859375)
('scipy.stats', 0.010602712631225586)
('pkg_resources._vendor.packaging.specifiers', 0.007072925567626953)
('add_newdocs', 0.00637507438659668)
('mtrand', 0.005497932434082031)
('scipy.sparse.linalg', 0.005171060562133789)
('scipy.linalg', 0.004471778869628906) 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-20T13:21:25.750

在 Python 2.4 中在 Windows 上进行了测试 - 您可以自己尝试。

```
>>> import time

>>> ## Built-in module
>>> def testTime():
        now = time.clock() # use time.time() on unix-based systems
        import math
        print time.clock() - now

>>> testTime()
7.54285810167e-006

>>> ## My own module
>>> def testTime():
        now = time.clock()
        import myBuiltInModule # Not its actual name ;-)
        print time.clock() - now

>>> testTime()
0.00253174635324
>>> testTime()
3.70158777141e-006 
```

因此，缓存模块和从头引入的模块之间存在很大差异。为了说明，我们可以重新加载模块：

```
>>> def testTime():
        now = time.clock()
        reload(myBuiltInModule )
        print time.clock() - now

>>> testTime()
0.00250017809526 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2021-08-10T13:15:18.263

这是对[szymon](https://stackoverflow.com/a/52090274/6446053)的扩展，`skjern`也是结合[Python Profilers](https://docs.python.org/3/library/profile.html)和[tuna](https://github.com/nschloe/tuna)的建议。

首先安装金枪鱼

```
pip install tuna 
```

然后，创建一个 python 扩展文件并将其命名为您想要的任何名称。这里我们将其命名为`timit_package.py`.

在此文件中，包括内置模块和用户定义模块。

在这里，我只测试

```
import mne 
```

然后，在终端

```
python -mcProfile -o program.prof timit_package.py 
```

等待几秒钟，然后将以下行粘贴到终端中

```
tuna program.prof 
```

将生成一个浏览器以及配置文件。

[![在此处输入图像描述](https://i.stack.imgur.com/7J3ft.png)](https://i.stack.imgur.com/7J3ft.png)

我用 python 3.9 测试这个

# multithreading - 使用 common-j 组件进行事务管理

> ID：767889
> 
> 赞同：0
> 
> 时间：2009-04-20T11:32:56.573
> 
> 标签：multithreading, transactions, jakarta-ee, websphere, parallel-processing

我们有一个需要并行化的 Websphere Java EE 应用程序，我们希望为此使用[CommonJ 工作组件](http://e-docs.bea.com/wls/docs92/commonj/commonj.html#wp1058124)。

每个“线程”都需要对来自数据库的数据有自己的看法。其中大部分是预取的，但仍需要到数据库中获取一些。我们预计所有这些线程的整体工作的持续时间将是“长的”（即有足够的时间来更改基础数据）。

因此，我们需要确保隔离应用程序使用的数据并在线程工作过程中查询。

似乎确保这一点的唯一方法是进行“全局”事务并使用 XA 事务。但我们希望尽可能避免这种复杂性（和开销），并且正在寻找想法或替代方案：有什么想法吗？

此外，Common-J 工作组件在多大程度上（如果有的话）支持容器管理的事务？

*@Karl：也许我只是指开销。我们的想法是 XA 事务和消息传递会产生共享事务的 Common-J 工作组件可以避免的开销？正在操作的数据集将是超过 300k 的不同数据行，每行需要对其进行约 100 次计算。尽管这些可以划分到不同的线程上操作共享、缓存、只读数据，但复制到/读取队列的相对内存开销似乎令人望而却步。你会同意吗？*

*@Karl：每个实体几十到几百毫秒。我们还专注于改进逻辑处理作为一项单独的任务。
当要求所有线程在单个数据库中具有一致的数据视图时，我是否需要使用 XA 事务？我对此的回答是，每个线程都需要自己的 JPA EntityManager（例如连接），并且需要 XA 来协调它们的访问。
但是，如果我可以在没有 XA 的情况下做到这一点，那就更好了，不是吗？*

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-22T15:11:54.220

您觉得 WAS 中的 XA 事务有什么复杂之处？如果您担心数据完整性，那么 XA 事务听起来很合适。

当谈到在 WAS 中创建和管理自己的线程时，它可能会变得有点讨厌，我会尽量避免管理自己的线程。使事情并发的一种可能是将数据发布到队列或主题，并让大量的多个并发侦听器从队列中接收。这样你就可以配置并发并让容器管理线程。

卡尔

# crystal-reports - 在 Crystal Report 中创建“查找表”

> ID：767906
> 
> 赞同：0
> 
> 时间：2009-04-20T11:39:56.243
> 
> 标签：crystal-reports

我已经在 CR2008 中有一个使用存储过程生成的报告。麻烦的是，由于我们的后端数据库存在问题，此报告将返回一些“空白”价格......

我需要做的是在这个报告中包含一个所谓的“查找”表，其中包含项目和成本，以便如果报告有一个空白（空）单元格，那么它会在这个单独的表中查找。

关于如何做到这一点的任何建议？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-20T12:02:39.950

1.  更改您的存储过程以查找缺失的价格或
2.  如果您的查找表（不是一对多！）与您的过程输出相关，则将其链接到 Crystal Reports 并使用公式来计算价格。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-23T00:28:35.413

就像 arvo 所说，我会更改存储过程。比水晶报告+公式更容易维护。听起来你几乎可以做一个

isnull(price, (select top 1 price from item where ....)) 作为价格，

# jquery - 查看 JQuery 选择

> ID：767909
> 
> 赞同：0
> 
> 时间：2009-04-20T11:41:19.173
> 
> 标签：jquery, selection

是否可以查看我在特定 jquery 选择中选择了哪些项目/元素？

我看到有人演示 jquery，他们使用某种形式的控制台为每个选择返回一组项目，然后他们可以将鼠标悬停在每个项目上，它会在浏览器中突出显示它。

我目前正在使用 alert($('div').length); 看看我选择了哪些*没有*帮助的。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-20T11:57:10.273

前段时间我为此编写了一个 jquery 插件。它使用 firebug 的日志控制台来记录 jquery 的选择。（如果你不使用 Firebug 进行 Web 开发，你真的应该考虑一下）

```
(function ($) {
    function logThis() {
        console.debug(this);
    }

    jQuery.fn.debug = function (msg) {
        console.group(msg || "no message");
        this.each(logThis);
        console.groupEnd();
        return this;
    };
})(jQuery); 
```

要使用它，只需在带有可选消息的 jquery 选择上调用 debug

```
$(".example").debug("nodes found") 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-20T11:48:08.830

如果这纯粹是为了调试，您可以将其记录到您的 javascript 控制台：

```
$('div').each(function() {
    console.log($(this).id);
}) 
```

注意：如果您还没有使用它，我强烈建议您使用[firebug 。](http://getfirebug.com/lite.html)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-20T12:15:54.410

您只需要[Firebug](http://getfirebug.com/)和代码中的这一行：

```
console.log(<<myJQuerySelection>>); 
```

例如：

```
console.log($('div')); 
```

将鼠标移到结果上，它们将在页面上突出显示。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-20T12:45:23.467

这些都是很好的例子，我也做的一件事是在元素周围创建一个边框。

```
$('div').css({border: '1px solid red'}); 
```

然后，您可以在浏览器中轻松查看已选择的内容（除非某些元素从视口中隐藏）。当未安装/启用 Firebug 时，这也很方便。

可能应该使用 CSS 属性“大纲”，这样它就不会将元素扩展 2 个像素。

# python - 谜语：方形拼图

> ID：767912
> 
> 赞同：21
> 
> 时间：2009-04-20T11:41:59.110
> 
> 标签：python, knights-tour

最近几天，我一直克制自己的硕士学习，一直专注于这个（看似简单的）难题：

* * *

有这个 10*10 的网格构成了一个包含 100 个可用地点的正方形。目的是从一个角落开始，根据一些简单的“遍历规则”遍历所有地方并达到第 100 号（如果您是程序员，则为 99 号，而不是从 0 开始：）

遍历的规则是：
1\. 沿纵横轴跳两个空格
2\. 沿对角线跳一个空格
3\. 每个方格只能访问一次

为了更好地可视化，这是一个有效的遍历示例（直到第 8 步）：
[示例遍历 http://img525.imageshack.us/img525/280/squarepuzzle.png](http://img525.imageshack.us/img525/280/squarepuzzle.png)

* * *

出于无聊，我一直在手动解决这个难题。多年来，我时不时尝试手动解决，但从未超过96。听起来容易吗？试试自己，看看自己:)

因此，为了解决这个问题，我用 Python 开发了一个简短的（大约 100 行代码）程序。我是这门语言的初学者，我想看看我能做什么。
该程序简单地应用了详尽的尝试和错误解决技术。换句话说：蛮力深度优先搜索。

我的问题从这里出现：不幸的是，该程序无法解决问题，因为状态空间太大以至于搜索永远不会结束而没有找到解决方案。它可以毫不费力地上升到 98 号（并打印出来），但也不是一个完整的解决方案。
该程序还打印出到目前为止它所覆盖的搜索树的长度。几分钟后，从第 65 个元素开始的遍历列表就被覆盖到最后，只有一条路径。这个数字在指数增加的时间段内减少。我已经运行代码很长一段时间了，无法超过 50 个障碍，现在我确信了。

除非我永远运行它，否则这种简单的方法似乎是不够的。那么，如何改进我的代码以更快、更高效地提出解决方案呢？

基本上，我期待看到有关如何：

1.  捕获和利用特定于该问题的**领域知识**
2.  应用**编程技术/技巧**来克服疲惫

    ..并最终实现一个实质性的解决方案。

提前致谢。

* * *

**修订**
感谢 Dave Webb 将问题与它所属的域相关联：

> 这与骑士巡回赛问题非常相似，后者涉及在棋盘周围移动骑士而不重新访问同一个方格。基本上这是同一个问题，但有不同的“遍历规则”。

* * *

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-04-20T12:06:28.333

[这与骑士巡回赛](http://en.wikipedia.org/wiki/Knight's_tour)问题非常相似，后者涉及在棋盘周围移动骑士而不重新访问同一个方格。基本上这是同一个问题，但有不同的“遍历规则”。

我记得递归处理骑士巡回赛的关键优化是按照目标方格上可用移动数量的递增顺序执行下一步。这鼓励搜索尝试在一个区域密集移动并填充它，而不是在整个板上缩放并留下永远无法访问的小岛广场。（这是[Warnsdorff 的算法](http://en.wikipedia.org/wiki/Knight's_tour#Warnsdorff.27s_algorithm)。）

还要确保你已经尽可能地考虑了对称性。例如，在最简单的级别上，您的起始方块的 x 和 y 只需上升到 5，因为 (10,10) 与 (1,1) 相同，但棋盘旋转。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-04-20T17:33:38.937

我决定看看这个问题，看看我是否可以把它分解成 5x5 的解决方案，一个解决方案的结尾从另一个角落跳开。

第一个假设是 5x5 是可解的。它很快。

所以我运行了solve(0,5) 并查看了结果。我在 Excel 中绘制了一个 10x10 编号的网格，并带有一个 5x5 的编号网格进行翻译。然后我只是搜索了#]（结束单元格）的结果，这将是下一个 5x5 开始时的跳跃。（例如，对于第一个方格，我搜索了“13]”。）

以供参考：

```
10 x 10 grid                       5 x 5 grid 
 0  1  2  3  4 |  5  6  7  8  9     0  1  2  3  4
10 11 12 13 14 | 15 16 17 18 19     5  6  7  8  9
20 21 22 23 24 | 25 26 27 28 29    10 11 12 13 14
30 31 32 33 34 | 35 36 37 38 39    15 16 17 18 19
40 41 42 43 44 | 45 46 47 48 49    20 21 22 23 24
---------------+---------------
50 51 52 53 54 | 55 56 57 58 59
60 61 62 63 64 | 65 66 67 68 69
70 71 72 73 74 | 75 76 77 78 79
80 81 82 83 84 | 85 86 87 88 89
90 91 92 93 94 | 95 96 97 98 99 
```

这是一个可能的解决方案：

第一个方格：[0, 15, 7, 19, 16, 1, 4, 12, 20, 23, 8, 5, 17, 2, 10, 22, 14, 11, 3, 18, 6, 9, 24, 21, 13] 把它放在对角线跳到 5（在 10x10 中）下一个 5 x 5 的第一个角。

第二方：[0, 12, 24, 21, 6, 9, 17, 2, 14, 22, 7, 15, 18, 3, 11, 23, 20, 5, 8, 16, 19, 4, 1, 13, 10] 将它放在 10x10 中的最后一个 25 格，距离 55 有两跳。

第三格：[0, 12, 24, 21, 6, 9, 17, 5, 20, 23, 8, 16, 19, 4, 1, 13, 10, 2, 14, 11, 3, 18, 15, 7, 22] 将它放在 10x10 中的最后一个格子 97 处，距离 94 两跳。

第四方阵可以是任何有效的解决方案，因为终点并不重要。然而，解决方案从 5x5 到 10x10 的映射更难，因为正方形从对角开始。代替翻译，运行solve(24,5)并随机选择一个：[24, 9, 6, 21, 13, 10, 2, 17, 5, 20, 23, 8, 16, 1, 4, 12, 0、15、18、3、11、14、22、7、19]

这应该可以通过编程方式完成，因为已知 5x5 解决方案在端点合法移动到下一个 5x5 角时是有效的。5x5 解决方案的数量为 552，这意味着存储解决方案以供进一步计算和重新映射非常容易。

除非我做错了，否则这会为您提供一种可能的解决方案（以上 5x5 解决方案分别定义为一到四个）：

```
def trans5(i, col5, row5):
    if i < 5: return 5 * col5 + 50 * row5 + i
    if i < 10: return 5 + 5 * col5 + 50 * row5 + i
    if i < 15: return 10 + 5 * col5 + 50 * row5 + i
    if i < 20: return 15 + 5 * col5 + 50 * row5 + i
    if i < 25: return 20 + 5 * col5 + 50 * row5 + i

>>> [trans5(i, 0, 0) for i in one] + [trans5(i, 1, 0) for i in two] + [trans5(i, 0, 1) for i in three] + [trans5(i, 1, 1) for i in four]
    [0, 30, 12, 34, 31, 1, 4, 22, 40, 43, 13, 10, 32, 2, 20, 42, 24, 21, 3, 33, 11, 14, 44, 41, 23, 5, 27, 49, 46, 16, 19, 37, 7, 29, 47, 17, 35, 38, 8, 26, 48, 45, 15, 18, 36, 39, 9, 6, 28, 25, 50, 72, 94, 91, 61, 64, 82, 60, 90, 93, 63, 81, 84, 54, 51, 73, 70, 52, 74, 71, 53, 83, 80, 62, 92, 99, 69, 66, 96, 78, 75, 57, 87, 65, 95, 98, 68, 86, 56, 59, 77, 55, 85, 88, 58, 76, 79, 97, 67, 89] 
```

有人可以仔细检查方法吗？我认为这是解决问题的有效解决方案和方法。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-04-21T13:40:39.190

最终，我想出了修改后的 Python 代码来解决这个问题。我已经调整了几个小时的代码，它已经在几个小时内找到了 50 万个解决方案。
全套解决方案仍然需要彻底的搜索，即让程序运行直到它完成所有组合。但是，达到“一个”合法解决方案可以减少到“线性时间”。

首先，我学到的东西：

1.  感谢[Dave Webb 的回答](https://stackoverflow.com/questions/767912/riddle-the-square-puzzle/767984#767984)和[ammoQ 的回答](https://stackoverflow.com/questions/767912/riddle-the-square-puzzle/767991#767991)。该问题确实是哈密顿路径问题的扩展，因为它是 NP-Hard。一开始没有“简单”的解决方案。[Knight's Tour](http://en.wikipedia.org/wiki/Knight%27s_tour)有一个著名的谜语，这只是同一个问题，不同大小的棋盘/网格和不同的遍历规则。为了详细说明问题和方法和算法已经设计了很多事情。

2.  感谢[乔的回答](https://stackoverflow.com/questions/767912/riddle-the-square-puzzle/769302#769302)。该问题可以自下而上的方式处理，并且可以分解为可解决的子问题。解决的子问题可以在入口-出口点的概念中连接（一个人的出口点可以连接到另一个人的入口点），这样主要问题就可以作为较小规模问题的构成来解决。这种方法是合理和实用的，但并不完整。如果存在，它不能保证找到答案。

经过详尽的蛮力搜索，以下是我在代码上开发的关键点：

*   [Warnsdorff 算法](http://en.wikipedia.org/wiki/Knight%27s_tour#Warnsdorff.27s_algorithm)：该算法是快速获得大量解决方案的关键点。它只是说，你应该选择你的下一步行动到“最不方便”的地方，并用升序或可访问性填充你的“去”列表。最不容易到达的地方是指可能跟随动作最少的地方。

    以下是伪代码（来自维基百科）：

* * *

一些定义：

*   如果 P 可以通过一个骑士的移动移动到 Q 并且 Q 尚未被访问，则可以从位置 P 访问位置 Q。
*   位置 P 的可访问性是从 P 可访问的位置数。

算法：

> 将 P 设置为棋盘上的随机初始位置 将棋盘标记为 P 处的棋步数为“1”，每个棋步数从 2 到棋盘上的方格数，令 S 为可从输入位置访问的位置集合将 P 设置为 S 中具有最小可访问性的位置 用当前移动编号标记 P 处的棋盘 返回已标记的棋盘——每个方块都将标记有它被访问的移动编号。

* * *

*   [检查岛屿](https://stackoverflow.com/questions/767912/riddle-the-square-puzzle/768497#768497)：这里对领域知识的一个很好的利用被证明是很方便的。如果一个移动（除非它是最后一个移动）会导致它的*任何*邻居变成一个岛，即任何其他移动都无法访问，则不再调查该分支。与 Warnsdorff 算法相结合可节省大量时间（大约 25%）。

这是我在 Python 中的代码，它解决了这个谜题（考虑到问题是 NP-Hard，在可接受的程度上）。代码很容易理解，因为我认为自己是 Python 的初学者。这些评论在解释实现方面很简单。解决方案可以通过基本的 GUI（代码中的指南）显示在简单的网格上。

```
# Solve square puzzle
import operator

class Node:
# Here is how the squares are defined
    def __init__(self, ID, base):
        self.posx = ID % base
        self.posy = ID / base
        self.base = base
    def isValidNode(self, posx, posy):
        return (0<=posx<self.base and 0<=posy<self.base)

    def getNeighbors(self):
        neighbors = []
        if self.isValidNode(self.posx + 3, self.posy): neighbors.append(self.posx + 3 + self.posy*self.base)
        if self.isValidNode(self.posx + 2, self.posy + 2): neighbors.append(self.posx + 2 + (self.posy+2)*self.base)
        if self.isValidNode(self.posx, self.posy + 3): neighbors.append(self.posx + (self.posy+3)*self.base)
        if self.isValidNode(self.posx - 2, self.posy + 2): neighbors.append(self.posx - 2 + (self.posy+2)*self.base)
        if self.isValidNode(self.posx - 3, self.posy): neighbors.append(self.posx - 3 + self.posy*self.base)
        if self.isValidNode(self.posx - 2, self.posy - 2): neighbors.append(self.posx - 2 + (self.posy-2)*self.base)
        if self.isValidNode(self.posx, self.posy - 3): neighbors.append(self.posx + (self.posy-3)*self.base)
        if self.isValidNode(self.posx + 2, self.posy - 2): neighbors.append(self.posx + 2 + (self.posy-2)*self.base)
        return neighbors

# the nodes go like this:
# 0 => bottom left
# (base-1) => bottom right
# base*(base-1) => top left
# base**2 -1 => top right
def solve(start_nodeID, base):
    all_nodes = []
    #Traverse list is the list to keep track of which moves are made (the id numbers of nodes in a list)
    traverse_list = [start_nodeID]
    for i in range(0, base**2): all_nodes.append(Node(i, base))
    togo = dict()
    #Togo is a dictionary with (nodeID:[list of neighbors]) tuples
    togo[start_nodeID] = all_nodes[start_nodeID].getNeighbors()
    solution_count = 0

    while(True):
        # The search is exhausted
        if not traverse_list:
            print "Somehow, the search tree is exhausted and you have reached the divine salvation."
            print "Number of solutions:" + str(solution_count)
            break

        # Get the next node to hop
        try:
            current_node_ID = togo[traverse_list[-1]].pop(0)
        except IndexError:
            del togo[traverse_list.pop()]
            continue

        # end condition check
        traverse_list.append(current_node_ID)
        if(len(traverse_list) == base**2):
            #OMG, a solution is found
            #print traverse_list
            solution_count += 1
            #Print solution count at a steady rate
            if(solution_count%100 == 0): 
                print solution_count
                # The solution list can be returned (to visualize the solution in a simple GUI)
                #return traverse_list

        # get valid neighbors
        valid_neighbor_IDs = []
        candidate_neighbor_IDs = all_nodes[current_node_ID].getNeighbors()
        valid_neighbor_IDs = filter(lambda id: not id in traverse_list, candidate_neighbor_IDs)

        # if no valid neighbors, take a step back
        if not valid_neighbor_IDs:
            traverse_list.pop()
            continue

        # if there exists a neighbor which is accessible only through the current node (island)
        # and it is not the last one to go, the situation is not promising; so just eliminate that
        stuck_check = True
        if len(traverse_list) != base**2-1 and any(not filter(lambda id: not id in traverse_list, all_nodes[n].getNeighbors()) for n in valid_neighbor_IDs): stuck_check = False

        # if stuck
        if not stuck_check:
            traverse_list.pop()
            continue

        # sort the neighbors according to accessibility (the least accessible first)
        neighbors_ncount = []
        for neighbor in valid_neighbor_IDs:
            candidate_nn = all_nodes[neighbor].getNeighbors()
            valid_nn = [id for id in candidate_nn if not id in traverse_list]
            neighbors_ncount.append(len(valid_nn))
        n_dic = dict(zip(valid_neighbor_IDs, neighbors_ncount))
        sorted_ndic = sorted(n_dic.items(), key=operator.itemgetter(1))

        sorted_valid_neighbor_IDs = []
        for (node, ncount) in sorted_ndic: sorted_valid_neighbor_IDs.append(node)

        # if current node does have valid neighbors, add them to the front of togo list
        # in a sorted way
        togo[current_node_ID] = sorted_valid_neighbor_IDs

# To display a solution simply
def drawGUI(size, solution):
    # GUI Code (If you can call it a GUI, though)
    import Tkinter
    root = Tkinter.Tk()
    canvas = Tkinter.Canvas(root, width=size*20, height=size*20)
    #canvas.create_rectangle(0, 0, size*20, size*20)
    canvas.pack()

    for x in range(0, size*20, 20):
        canvas.create_line(x, 0, x, size*20)
        canvas.create_line(0, x, size*20, x)

    cnt = 1
    for el in solution:
        canvas.create_text((el % size)*20 + 4,(el / size)*20 + 4,text=str(cnt), anchor=Tkinter.NW)
        cnt += 1
    root.mainloop()

print('Start of run')

# it is the moment
solve(0, 10)

#Optional, to draw a returned solution
#drawGUI(10, solve(0, 10))

raw_input('End of Run...') 
```

感谢大家分享他们的知识和想法。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-04-20T12:08:15.490

这只是[http://en.wikipedia.org/wiki/Hamiltonian_path](http://en.wikipedia.org/wiki/Hamiltonian_path)问题的一个例子。德国维基百科声称它是 NP 难的。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-20T14:25:46.580

我可以进行优化以检查岛屿（即没有有效邻居的未访问空间。）并退出遍历，直到岛屿被消除。这将发生在某个树遍历的“便宜”一侧附近。我想问题是减少是否值得付出代价。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-21T03:55:54.307

我想看看我是否可以编写一个能提出所有可能解决方案的程序。

```
#! /usr/bin/env perl
use Modern::Perl;

{
  package Grid;
  use Scalar::Util qw'reftype';

  sub new{
    my($class,$width,$height) = @_;
    $width  ||= 10;
    $height ||= $width;

    my $self = bless [], $class;

    for( my $x = 0; $x < $width; $x++ ){
      for( my $y = 0; $y < $height; $y++ ){
        $self->[$x][$y] = undef;
      }
    }

    for( my $x = 0; $x < $width; $x++ ){
      for( my $y = 0; $y < $height; $y++ ){
        $self->[$x][$y] = Grid::Elem->new($self,$x,$y);;
      }
    }

    return $self;
  }

  sub elem{
    my($self,$x,$y) = @_;
    no warnings 'uninitialized';
    if( @_ == 2 and reftype($x) eq 'ARRAY' ){
      ($x,$y) = (@$x);
    }
    die "Attempted to use undefined var" unless defined $x and defined $y;
    my $return = $self->[$x][$y];
    die unless $return;
    return $return;
  }

  sub done{
    my($self) = @_;
    for my $col (@$self){
      for my $item (@$col){
        return 0 unless $item->visit(undef);
      }
    }
    return 1;
  }

  sub reset{
    my($self) = @_;
    for my $col (@$self){
      for my $item (@$col){
        $item->reset;
      }
    }
  }

  sub width{
    my($self) = @_;
    return scalar @$self;
  }

  sub height{
    my($self) = @_;
    return scalar @{$self->[0]};
  }
}{
  package Grid::Elem;
  use Scalar::Util 'weaken';

  use overload qw(
    "" stringify
    eq equal
    == equal
  );

  my %dir = (
    #       x, y
    n  => [ 0, 2],
    s  => [ 0,-2],
    e  => [ 2, 0],
    w  => [-2, 0],

    ne => [ 1, 1],
    nw => [-1, 1],

    se => [ 1,-1],
    sw => [-1,-1],
  );

  sub new{
    my($class,$parent,$x,$y) = @_;
    weaken $parent;
    my $self = bless {
      parent => $parent,
      pos    => [$x,$y]
    }, $class;

    $self->_init_possible;

    return $self;
  }

  sub _init_possible{
    my($self) = @_;
    my $parent = $self->parent;
    my $width  = $parent->width;
    my $height = $parent->height;
    my($x,$y)  = $self->pos;

    my @return;
    for my $dir ( keys %dir ){
      my($xd,$yd) = @{$dir{$dir}};
      my $x = $x + $xd;
      my $y = $y + $yd;

      next if $y < 0 or $height <= $y;
      next if $x < 0 or $width  <= $x;

      push @return, $dir;
      $self->{$dir} = [$x,$y];
    }
    return  @return if wantarray;
    return \@return;
  }

  sub list_possible{
    my($self) = @_;
    return unless defined wantarray;

    # only return keys which are
    my @return = grep {
      $dir{$_} and defined $self->{$_}
    } keys %$self;

    return  @return if wantarray;
    return \@return;
  }

  sub parent{
    my($self) = @_;
    return $self->{parent};
  }

  sub pos{
    my($self) = @_;
    my @pos = @{$self->{pos}};
    return @pos if wantarray;
    return \@pos;
  }

  sub visit{
    my($self,$v) = @_;
    my $return = $self->{visit} || 0;

    $v = 1 if @_ == 1;
    $self->{visit} = $v?1:0 if defined $v;

    return $return;
  }

  sub all_neighbors{
    my($self) = @_;
    return $self->neighbor( $self->list_possible );
  }
  sub neighbor{
    my($self,@n) = @_;
    return unless defined wantarray;
    return unless @n;

    @n = map { exists $dir{$_} ? $_ : undef } @n;

    my $parent = $self->parent;

    my @return = map {
      $parent->elem($self->{$_}) if defined $_
    } @n;

    if( @n == 1){
      my($return) = @return;
      #die unless defined $return;
      return $return;
    }
    return  @return if wantarray;
    return \@return;
  }

  BEGIN{
    for my $dir ( qw'n ne e se s sw w nw' ){
      no strict 'refs';
      *$dir = sub{
        my($self) = @_;
        my($return) = $self->neighbor($dir);
        die unless $return;
        return $return;
      }
    }
  }

  sub stringify{
    my($self) = @_;
    my($x,$y) = $self->pos;
    return "($x,$y)";
  }

  sub equal{
    my($l,$r) = @_;
    "$l" eq "$r";
  }

  sub reset{
    my($self) = @_;
    delete $self->{visit};
    return $self;
  }
}

# Main code block
{
  my $grid = Grid->new();

  my $start = $grid->elem(0,0);
  my $dest  = $grid->elem(-1,-1);

  my @all = solve($start,$dest);
  #say @$_ for @all;
  say STDERR scalar @all;
}

sub solve{
  my($current,$dest,$return,@stack) = @_;
  $return = [] unless $return;
  my %visit;
  $visit{$_} = 1 for @stack;

  die if $visit{$current};

  push @stack, $current->stringify;

  if( $dest == $current ){
    say @stack;

    push @$return, [@stack];
  }

  my @possible = $current->all_neighbors;
  @possible = grep{
    ! $visit{$_}
  } @possible;

  for my $next ( @possible ){
    solve($next,$dest,$return,@stack);
  }

  return @$return if wantarray;
  return  $return;
} 
```

该计划在终止之前提出了超过 100,000 种可能的解决方案。我发送`STDOUT`到一个文件，它超过 200 MB。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-09-13T11:46:45.223

您可以使用扫描线动态规划算法精确计算解决方案的数量。

# sql - 使用单个 PL SQL 查询返回多个计数

> ID：767915
> 
> 赞同：2
> 
> 时间：2009-04-20T11:43:29.200
> 
> 标签：sql, oracle, plsql

我有以下两个返回计数的 PL/SQL Oracle 查询：

```
SELECT count(*)
  INTO counter_for_x
  FROM Table_Name
 WHERE Column_Name = 'X';

SELECT count(*)
  INTO counter_for_y
  FROM Table_Name
 WHERE Column_Name = 'Y'; 
```

是否可以编写一个查询来返回计数并填充相应的计数器变量？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-20T11:46:05.013

```
SELECT  (
        SELECT COUNT(*)
        FROM   table_name
        WHERE  column_name = 'X'
        ),
        (
        SELECT COUNT(*)
        FROM   table_name
        WHERE  column_name = 'Y'
        )
INTO    counter_for_x, counter_for_y
FROM    dual 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-15T09:40:14.520

这将做到：

```
select count(decode(column_name,'X',1)) x_count
,      count(decode(column_name,'Y',1)) y_count
into   counter_for_x, counter_for_y
from   table_name
where  column_name in ('X','Y'); 
```

或者如果您更喜欢使用 CASE：

```
select count(case when column_name = 'X' then 1 end) x_count
,      count(case when column_name = 'Y' then 1 end) y_count
into   counter_for_x, counter_for_y
from   table_name
where  column_name in ('X','Y'); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-20T11:49:15.333

可以，但我不会...

```
select nvl(sum(decode(column_name,'X',1,0)),0), nvl(sum(decode(column_name,'Y',1,0)),0)
  into counter_for_x, counter_for_y
  from table_name
  where column_name in ('X', 'Y'); 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-20T11:59:07.307

另一种方式。

```
SELECT
   Max(CASE WHEN Column_Name = 'X' THEN Count ELSE NULL END) AS Count_X ,
   MAX(CASE WHEN Column_Name = 'Y' THEN Count ELSE NULL END) AS Count_Y
FROM
(
    SELECT count(*) as Count, Column_Name
    FROM Table_Name
    Where Column_Name in ('X', 'Y')
    Group By Column_Name
) AS InnerTable 
```

# asp.net-mvc - asp.net mvc 搜索和编辑视图

> ID：767917
> 
> 赞同：1
> 
> 时间：2009-04-20T11:43:55.423
> 
> 标签：asp.net-mvc, partial-views

我正在考虑创建一个允许基于 ajax 的搜索和编辑功能的视图。我将不胜感激有关我正在考虑的结构的任何反馈！

该结构将由一个文本框和一个搜索按钮组成 按钮的提交导致操作搜索被点击，并返回一个部分 - 在命名 div “itemDisplay##” 中找到的项目的文本表示（## 是 Id找到的项目） - 名为编辑的按钮 - 占位符 div 与找到的项目的 id “itemEdit##” 当用户点击编辑按钮时，会请求一个局部视图 (Edit.ascx) 并填充命名的 div itemEdit## Edit.ascx 有保存和取消按钮。

成功保存并取消隐藏edit div并显示原itemDisplay## 保存过程中失败显示在edit.ascx中。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-20T12:01:09.313

这些听起来都像是离散的动作，因此在它的实现中并不是特别 RESTful。通常我会有一个带有过滤的列表操作——这个过滤可以通过 AJAX 完成，因为它返回的基本上是相同的视图。单击特定项目可能会将我带到详细信息视图 - 带有一个编辑按钮。我可能还会在列表中包含一个编辑按钮，在这种情况下，单击它会将我带到编辑模式下的详细信息页面。但是，列表、查看和编辑都是不同的操作，并且具有不同的 URL。单击“查看”或“编辑”中的列表按钮将使我返回“列表”操作。单击编辑中的保存按钮将使我返回到该项目的视图——这提供了该项目已更新的确认。编辑中的错误会使用适当的消息呈现编辑视图。

我的经验法则是在视图的上下文没有变化时使用 AJAX，但在调用新操作（新上下文）时使用完整请求（GET/POST）。这有助于保持接口 (URL) RESTful。当然，你可以用任何你想做的方式来做，但是 MVC 让 RESTful URL 更容易，而 RESTful URL 让用户更容易为页面添加书签以轻松返回 - 正是因为它们映射到一个特定的操作特定的数据项。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-20T12:20:20.983

正如您所描述的，搜索可以以“ajax 方式”完成。使用相同的 url / page 来编辑和显示详细信息会使代码混乱，并且正如另一个答案中所述，它不是很完整，所以我会为此使用单独的 URL 和页面。

# python - 删除 *.pyc 继续

> ID：767920
> 
> 赞同：-5
> 
> 时间：2009-04-20T11:46:10.237
> 
> 标签：python, operating-system, sys

[作为这个问题](https://stackoverflow.com/questions/755694/delete-pyc)的后续，我有一个新问题：

`os.remove(module_name)`和内部发生了什么`del sys.modules["module_name"]`？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-20T12:25:28.413

简短的回答是这`os.remove(module_name)`将从文件系统中删除一个文件。 `del sys.modules["module_name"]`将从当前 Python 解释器正在维护的先前加载的模块的缓存中删除一个模块。

在 Python 中，当您导入模块时，解释器会检查是否存在与您尝试导入的文件`.pyc`同名的文件。`.py`如果存在，并且`.py`自文件导入后文件未更改`.pyc`，则 Python 将加载该`.pyc`文件（这明显更快）。

如果该`.pyc`文件不存在，或者该文件在创建后`.py`已更改，则加载该文件并创建一个新文件。（值得注意的是，简单地运行一个 Python 文件，say不会导致 a*被*创建。只有ing 模块会导致这种情况发生。）`.pyc``.py``.pyc``test.py`*`test.pyc``import`*

 *`sys.modules`完全是另一回事。为了加速两次导入相同模块的代码，Python 维护了在当前解释器会话期间已导入的模块列表。如果要导入的模块在 中`sys.modules`，则将读取缓存的版本（也`.py`不会`.pyc`检查磁盘上的文件）。Python 提供了一个内置函数[`reload()`](http://docs.python.org/library/functions.html)，允许您绕过模块缓存并强制从磁盘重新加载。

要获取有关 Python 模块系统的更多信息，请参阅有关[模块](http://docs.python.org/tutorial/modules.html#compiled-python-files)的文档。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-10-19T13:11:54.893

我启动了很多这样的应用程序

```
import os

os.system('attrib +H *.pyc /S') 
```

在 Windows 上，这会在应用程序启动时隐藏任何可见的编译文件——它们给了我点数。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-10-05T00:14:46.500

我的oneliner为这份工作：

```
find . -name *.pyc |xargs rm 
```

注意：您需要 Linux（或类 Unix 操作系统）

# cvs - 按用户签入的 CVS 列表

> ID：767921
> 
> 赞同：2
> 
> 时间：2009-04-20T11:46:54.713
> 
> 标签：cvs

> **可能重复：**
> [获取特定用户的 CVS 历史记录](https://stackoverflow.com/questions/57183/get-cvs-history-for-a-particular-user)

是否可以列出特定用户完成的所有签入/提交？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-20T11:54:14.010

```
cvs history -c -u «user» 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-20T11:51:40.757

采用

```
cvs log -w<loginname> <filename> 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-20T11:53:35.913

历史 -c -uUSERNAME -D2009-03-25

列出自 2009-03-25 以来完成的所有检查

# c - GNU make %-style 模式规则的可移植等价物

> ID：767922
> 
> 赞同：5
> 
> 时间：2009-04-20T11:47:00.533
> 
> 标签：c, makefile, portability, automake, gnu-make

我正在按照“[使用 Autotools 检查”](http://www.crsr.net/Notes/CheckAndAutotools.html)页面上的说明来尝试在（当前）小型 C 项目中构建对单元测试的支持。虽然我使用的是[Cgreen](http://www.lastcraft.com/cgreen.php)而不是[Check](http://check.sourceforge.net/)。

我在执行第 9 步时遇到了问题，这导致 automake 发出关于使用 `%' 样式的模式规则作为 GNU make 扩展的警告。

具体的制作规则是：

```
check_%.$(OBJEXT) : $(srcdir)/%.c
    $(COMPILE) -DCHECKING -c -o $@ $^ 
```

我想知道是否有一种等效的方法来指定此规则，它不依赖于 gnu make 扩展。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-20T15:48:14.603

可移植的 make 规则只能使用不同的后缀，前缀应该相同。

```
.c.o:
        $(COMPILE) -DCHECKING -c -o $@ $< 
```

但是，后缀不一定以点开头。（在这种情况下，您必须告诉 Automake 您的后缀是什么，因为它无法猜测。）因此，例如，如果您重命名`check_showdns.o`为`showdns_check.o`：

```
SUFFIXES = _check.o 
check_libapdns_LDADD        = @CHECK_LIBS@ showdns_check.o
.c_check.o:
        $(COMPILE) -DCHECKING -c -o $@ $< 
```

* * *

## 回答 #2

> 赞同：-3
> 
> 时间：2009-04-20T17:03:49.443

我宁愿尝试禁用警告或忽略它。GNU make 适用于所有相关的类 Unix 平台；没有实际理由花时间维护 makefile 的可移植性。GNU make 在功能方面也优于大多数其他 make 方言。

# html - 不同的浏览器（Firefox/Safari/IE/Opera）对表单元素名称属性有限制吗？

> ID：767931
> 
> 赞同：0
> 
> 时间：2009-04-20T11:49:26.360
> 
> 标签：html, forms

不同的浏览器（Firefox/Safari/IE/Opera）对表单元素的“name”属性的**长度**有不同的限制吗？

```
   <输入名称='a012345678901234567890123456789012345678901234567890123456789 ...'>

```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-20T11:58:45.963

HTML 规范：

> ID 和 NAME 标记必须以字母 ([A-Za-z]) 开头，后跟任意数量的字母、数字 ([0-9])、连字符 ("-")、下划线 ("_") , 冒号 (":") 和句点 (".")。

**未**指定最大长度。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-20T12:07:42.277

我认为您不会达到通常浏览器的最大长度。到目前为止，我还没有看到很长的“名称”属性，但是 ASP HTML 代码中经常有很长的字符串，比如这个：

```
<input type="hidden" name="__VIEWSTATE" id="__VIEWSTATE"
value="eoR/9oFJY7x1fwy2bYuP+si4g80sNmQNAyTEWindlIuh
/sy+xAs0bFI1ygCuhB4Ceou6RZH4vO760FTZA7SdwD... [about 20 KB more]" 
```

所以我猜所有属性的最大长度将远远超过你可能担心的 1024/32768 字节。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-04-20T12:07:06.537

简短回答：不，除了可以使用什么字符（AZ、0-9、“-”、“_”、“.”、“:”，并且必须以字母开头）之外，没有其他限制

长答案：可能，但如果你达到了这些限制，你就做错了。第一个失败的浏览器将是手机浏览器，其中内存非常宝贵。在这些情况下，浏览器可能会崩溃，或者只使用名称的前*x 个*字符。但底线是您不应该超越这些限制 - 如果您需要一个唯一的名称，只需使用 GUID。如果您需要对一堆元信息进行编码，则字段名称是错误的放置位置（将其粘贴在名为*input_name* .metadata 的匹配隐藏字段中）

# c# - 控制多个线程的好方法

> ID：767939
> 
> 赞同：1
> 
> 时间：2009-04-20T11:53:35.277
> 
> 标签：c#, vb.net, multithreading

我有一个可以执行多项任务的 MDI WinForms 应用程序。每个任务都作为 backgroundWorker 运行。

控制正在运行的线程的好方法是什么：

*   检查特定线程是否正在运行
*   停止特定线程？

例如，不应该同时运行相同的任务。

可能我需要一个单独的类来存储 isTaskRunning 变量吗？

这样做的好方法是什么？

TIA

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-20T12:03:50.647

您可以采取的一种方法是为每个任务创建一个类。然后让那个班级执行任务。它将知道是否可以一次使用多个任务，并限制对每个任务的访问。因此 ：

```
public class LongUploadTask
{
  private bool isRunning;

  public void Execute()
  {
    if(!isRunning)
    {
       //etc...
    }
  }
} 
```

请注意，如果您从多个线程访问它，我已经省略了锁定代码，我认为您不是。此外，如果您想异步执行此操作，您可以使用异步委托和手动重置事件来实现 BackgroundWorker 正在执行的操作。

# winforms - Windows 窗体面板边框的背景色

> ID：767944
> 
> 赞同：2
> 
> 时间：2009-04-20T11:55:17.907
> 
> 标签：winforms, panel, border

有没有办法改变`BackColor`面板或类似控件的边框？

当我将鼠标悬停在用户控件上时，我试图“突出显示”用户控件。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-20T14:05:55.613

这是一个简单的类，它突出显示带有边框的表单上的控件：

```
 public class Highlighter : Control
    {
        public void SetTarget(Control c)
        {
            Rectangle r = c.Bounds;
            r.Inflate(3, 3);
            Bounds = r;
        }

        protected override void OnPaint(PaintEventArgs e)
        {
            base.OnPaint(e);

            e.Graphics.FillRectangle(Brushes.Red, e.ClipRectangle);
        }
    } 
```

然后，在您的表单中，设置所有内容以使用它：

```
 private void Form1_Load(object sender, EventArgs e)
    {
        foreach (Control c in Controls)
        {
            c.MouseEnter += mouseEnter;
            c.MouseLeave += mouseLeave;
        }
    }

    private void mouseEnter(object sender, EventArgs e)
    {
        _highlighter.SetTarget(sender as Control);
        _highlighter.Visible = true;
    }

    private void mouseLeave(object sender, EventArgs e)
    {
        _highlighter.Visible = false;
    } 
```

然后，在构造函数中，只需创建荧光笔：

```
 public Form1()
    {
        InitializeComponent();
        _highlighter = new Highlighter();
        Controls.Add(_highlighter);
    } 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-20T12:03:17.653

您可以使用 MouseEnter / MouseLeave 事件来执行此操作。

```
 private void panel1_MouseEnter(object sender, EventArgs e)
    {
        panel1.BackColor = System.Drawing.Color.Red;
    }

    private void panel1_MouseLeave(object sender, EventArgs e)
    {
        panel1.BackColor = System.Drawing.Color.Empty;
    } 
```

# api - 是否可以通过编程方式为 Apple iTunes 商店中的项目创建 URL？

> ID：767951
> 
> 赞同：8
> 
> 时间：2009-04-20T11:57:35.077
> 
> 标签：api, itunes, itunes-store

是否可以通过编程方式创建直接指向 Apple iTunes 商店项目的 URL？

我注意到[last.fm](http://last.fm)和类似网站的链接可以将用户直接带到 iTunes 商店的一部分，例如专辑页面。

链接的 URL 由 last.fm 创建。以下是此类 URL 的示例： [http ://www.last.fm/affiliate_redirect.php?restype=9&id=3168755&supplier=24](http://www.last.fm/affiliate_redirect.php?restype=9&id=3168755&supplier=24)

我想他们在这个链接后面有一些代码，但他们肯定没有手动添加所有项目吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-12-16T05:31:15.627

有两个方面。[首先，您可以通过以编程方式搜索 App Store](http://www.onemanclapping.org/2009/01/itms-link-generator-api.html)来获得深层链接：

```
http://www.onemanclapping.org/2009/01/itms-link-generator-api.html 
```

[接下来，您可以使用LinkShare API](http://brandontreb.com/money-you-might-be-missing-out-on-linkshare-api-integration/)将这些链接转换为附属链接：

```
http://brandontreb.com/money-you-might-be-missing-out-on-linkshare-api-integration/ 
```

[链接文本](http://www.onemanclapping.org/2009/01/itms-link-generator-api.html)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-20T12:13:38.083

[该页面](http://www.apple.com/itunes/affiliates/faq.html)指出：

> 链接到 iTunes 如何创建 iTunes 链接？
> 
> 使用您的会员用户名和密码登录 [www.linkshare.com](http://www.linkshare.com)。在 iTunes 的“创建链接”页面上，您会找到横幅和文本链接。作为会员，您还可以访问 iTunes RSS 源，并能够创建指向 iTunes 上任何歌曲、艺术家、专辑或有声读物的直接链接，以及 iMix 播放列表、播客和 iTunes Essentials。

所以这听起来像是一个“不”。当然，总是有一种蛮力的方法，即从艺术家姓名列表或您想要创建链接的任何内容中抓取搜索引擎的输出...

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2012-01-31T18:51:11.437

要记住的一件好事是，苹果在 URL 结构中使用应用 ID，如果您希望能够在应用上线之前编写指向应用的链接，您可以通过进入 iTunes Connect 自己创建 URL，找到您的应用ID，然后创建一个如下所示的 URL。

![来自 iTunes Connect 的 Apple ID](https://i.stack.imgur.com/4HeuP.png)

```
http://itunes.apple.com/app/id439244209 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-06-24T13:05:52.413

以编程方式，我们通过 URL 搜索歌曲，这是 iTunes API 提供的链接代码

```
NSString *method=[NSString stringWithFormat:@"http://ax.phobos.apple.com.edgesuite.net/WebObjects/MZStoreServices.woa/wa/wsSearch?term=shakira's+waka+waka&entity=musicVideo"];
    NSMutableURLRequest *request = [[[NSMutableURLRequest alloc] init] autorelease];
    [request setURL:[NSURL URLWithString:method]];
    [request setHTTPMethod:@"GET"];
    [request setValue:@"application/x-www-form-urlencoded" forHTTPHeaderField:@"Content-Type"];
    artist=[[NSMutableArray alloc]init];
url=[[NSMutableArray alloc]init];
    album=[[NSMutableArray alloc]init];
            NSURLConnection *theConnection = [[NSURLConnection alloc] initWithRequest:request delegate:self]; 
```

# assertions - Belt and Braces 是编程的好习惯还是只是引入了不必要的复杂性？

> ID：767952
> 
> 赞同：14
> 
> 时间：2009-04-20T11:57:52.783
> 
> 标签：assertions

我想知道使用[腰带和大括号（吊带）](http://www.phrases.org.uk/meanings/61250.html)方法进行编程 - 尤其是数据验证 - 是否是一种好习惯。这来自以下示例。

我正在创建一个表单，并向所有字段添加了侦听器，这意味着`OK`只有在表单中的所有字段都具有有效值时才启用该按钮。然后我正在编写`OK`单击按钮时运行的代码。

我悲观的一面认为，Belt and Braces 永远不会伤害任何人，如果我的表单逻辑出现错误，再次验证表单也无妨。

但是，如果验证失败，我不知道要输入什么。如果我做这样的事情：

```
if (! form.isValid()) {
  displayErrorMessage();
} 
```

然后我必须创建代码来显示不应该显示的错误消息。将来维护此代码的任何人都会担心并且可能会对此在理论上不必要的对话感到困惑。我想要的最后一件事是有人想知道为什么这个特定的对话框从不显示。

规模的另一端的一个选项是：

```
if (! form.isValid()) {
  throw new RuntimeException("This should never happen!");
} 
```

坦率地说，即使打字我也觉得很脏，但也许有一个很好的理由使用它，但我错过了。

所以最后我结束了：

```
assert form.isValid(); 
```

然而，它的缺点是它不是真正的腰带和大括号，因为大括号在运行时不存在，所以如果代码中有错误，我的表单的裤子仍然会掉下来。

所以也许我根本不应该有额外的验证，但我仍然有一部分认为它不会受到伤害。

我很想听听你在类似情况下会做什么。

（**编辑**：问题是问什么是确保表单返回有效数据的最佳方法。假设表单的输出在它最终进入数据库之前再次验证等等。）

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-20T12:07:19.703

我没有做太多的 UI 工作，但最近我发现自己在做一些非常相似的事情。我留下了腰带（在每个控件更改时验证它）和大括号（在 OK_Click 上再次检查有效）。

我将两者都保留的基础是，如果将来某些更改错过了控件上的验证，则单击“确定”按钮时会被捕获。

在我看来，对 OK 的检查是**真正的**验证，而每个控件的验证是只是增强用户体验的糖。

也就是说我没有想太多，也不经常做UI工作。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-20T13:05:41.857

根据我的经验，“以防万一”代码*有时*是懒惰编程的症状。即，我找到了一个基本可行的解决方案，但我不确定它是否会一直有效，所以我会输入一些双重检查代码“以防万一”。如果您不将火箭飞船送上月球，这种类型的事情相对无害，但仍然可能是非常糟糕的做法。

对于我的（非火箭式）业务应用程序，我总是输入错误日志和友好消息，并尝试从头到尾思考问题，以便用户尽可能少地看到友好消息。如果有问题，我能够更好地解决它，因为我的代码不会被各种不必要的检查弄得一团糟。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-20T12:04:14.877

我的同事通常会双重验证输入，“以防万一”。我认为这在很大程度上取决于与您一起工作的人或必须维护您的代码的人。如果你总是重复验证，他们会很快了解你在做什么。如果您有时只进行双重验证，他们可能会感到困惑。也许您应该向同事咨询他们的习惯？如果您单独或在一个非常小的团队中工作，则可能可以双重验证您的输入。

如果我要接管你的代码，我认为重要的事情可能是遵循一个约定，要么总是要么永远不会在两个地方都进行验证。至少这样我就不会糊涂了。

**编辑**：就网络编程而言，javascript 通常用于在将输入发送到服务器之前进行验证。显然，这还不够，因为用户可以关闭 javascript 并绕过该验证，因此在这种情况下需要服务器端验证。在任何情况下，如果用户可能恶意或意外绕过验证的第一行，还必须对后端进行仔细检查。我想这在 Java、C# 等中不是问题。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-20T12:11:11.893

我还要说双重验证永远不会伤害任何人，只会增加安全性。

我还想就您的业务逻辑提出一点意见。我假设这是一个 Winforms 应用程序，但该原理也适用于 Web。UI 不应强制执行业务逻辑。将验证放在那里很好，但它也需要在业务逻辑中。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-20T12:13:39.750

无论您决定做什么，只要确保**记录**意外状态并使程序以某种方式**失败**以防止数据损坏。就我个人而言，我认为这对于我不期望出现错误的情况是必要且足够的。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-20T12:15:07.173

在网络（没有双关语）编程中，总是会采用这种方法，因为您不能依赖实际运行的客户端验证；狡猾的用户可以构建一个表单帖子或 URL 来模拟您的客户端并将数据发送回服务器。

在独立应用程序中，它不太清楚。我建议这取决于验证发生的位置。例如，如果您的验证在您的业务逻辑中运行，而不是在您的 UI 中，那么您的验证应该每次都运行。使用关注点分离，业务逻辑不应该依赖 UI 来进行验证。毕竟，可以从典型的 GUI、Web 应用程序甚至 API 调用业务逻辑。

我建议的一件事是，在 UI 中将验证逻辑加倍可能是矫枉过正——但您应该能够处理来自底层的错误。在这种情况下，错误可能来自验证。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-20T13:17:11.783

我建议从纯粹的可用性角度来看待这个问题。您的用户在填写表单时应该如何工作？大多数时候，我建议在控件和表单级别进行验证。当然，您可以使用多种用户交互方式：

1.  让用户为所欲为，然后在 OK 上检查他们的结果。这对于专家用户来说非常棒，允许他们快速、渐进地输入内容，但让新手和不经常使用的用户不知所措。
2.  在输入或离开时验证每个控件。这可能很好，特别是对于复杂的形式（当然我们不应该设计，永远，真的，但是......！）；但做得不好会阻止人们按照自己的顺序逐步填写表格。如果我这样做，我更喜欢视觉上的指示，表明有什么不对劲。
3.  让输入任何错误的东西都不可能。这可以（几乎）通过例如数字滑块、受限标量的组合框、防止错误条目的自动验证编辑框来实现。

但是，即使在第 3 种情况下，在某些情况下您也必须检查值的组合是否有效。我曾处理过一些控件子集中的值相互依赖（由方程式控制）的情况。在这些情况下，向用户提供即时反馈并不总是可行或值得付出努力，因此始终可以制作一个案例来验证 OK。

我同意 Binary Worrier 的观点，即 OK 检查是主要检查。如果您确定它永远不会失败，请确保在触发时记录警告，并尽可能通过您的支持渠道嗅探此类事件，但不要让最终用户为编程错误付费。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2015-08-21T17:45:18.127

我将给出一个非常不受欢迎的答案。

我的回答是：**视情况而定**。

在人们开始愤怒地从椅子上站起来并为他们的拿铁咖啡添加额外的泡沫之前，请听我说完。 [![一个愤怒的程序员敲打屏幕](https://i.stack.imgur.com/V1gjX.jpg)](https://i.stack.imgur.com/V1gjX.jpg)

我修改了一个使用共享文件的 ERP 包。别笑，这是日常工作。无论如何，该系统在设计中存在一个缺陷——*它在输入时验证数据，然后由于一次性验证，一旦它写出记录，它总是假设它是正确的。*

这听起来是一种合理的方法，直到您遇到丢失的数据字段、崩溃的会话、您看不到的 RAM 损坏的机器、未检测到的 LAN 连接不稳定的机器，以及编程语言本身中偶尔出现的错误（或两个） . 记录写了一半，字段可能会丢失数据，索引偶尔会无缘无故地崩溃......这个列表还在继续。

现在，提供软件的供应商在很大程度上与束手无策的人竞争，因为，嘿，时间就是金钱，而且他们的业务是销售他们的产品（软件）。每 15 分钟编写额外的健全性检查就是 15 分钟可以用来产生收入。 **但是他们不会在凌晨 3 点被寻呼来修复崩溃的会话或释放令人讨厌的死锁。我愿意。**

因此，我在我编写的过程、函数和方法中添加了断言的粗略等价物。我对传递的数据类型进行健全性检查（它使所有变量变体），尽可能交叉引用数据，并在代码中寻找其他“精神错乱”的迹象。当例程发现类似于暮光区的东西时，它会给出一个诊断对话框（用户通常会截屏并转发给我），然后尝试优雅地失败；如果不能正常失败，用户通常会看到保存进度并注销的说明。

这是腰带和吊带吗？ **是的。** 我喜欢这样做吗？ **不。** 它是否在许多场合拯救了我的理智、睡眠时间和培根？

***是的。哦是的...***

所以，如果你有一个“敌对”的编程环境，**你不能总是相信输入到你的代码中的数据**，那么嵌入各种健全性检查是合理的......一直保持安全带和吊带.

否则，它是不需要的。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2014-12-23T14:55:52.413

我认为皮带和背带不是一个好习惯。

如果需要极高的可靠性，例如飞船软件，那么保证它的方法是提供多个并行运行的不同实现，都提供相同的输入，并且都期望提供相同的输出。显然，那不是腰带和牙套，而是别的东西。

如果极端可靠性不是问题，那么皮带和背带实际上只会以您自己发现的方式使事情复杂化。

您最终得到的断言是最好的做法，因为断言旨在捕获错误并记录代码，而这正是当前情况发生的情况：如果表单在您的点无效断言，那么您在表单的其他地方有一个错误，并且断言本质上是在记录这样一个事实，即在您的代码中，您希望表单的有效性已经得到处理。此外，应该在应用程序的测试阶段消除此错误发生的可能性，因此它不应该在生产中发生，这再次符合断言的目的和预期用途。

如果您真的喜欢皮带和大括号范式，那么您仍然可以将断言视为皮带和大括号方案的一部分，但在正确的上下文中：*测试*。这个断言在测试期间是束手无策的，因为它保证您在代码的其他地方完成了所有正确的测试。

# silverlight - 如何将 Silverlight DatePicker 控件设置为只读？

> ID：767956
> 
> 赞同：3
> 
> 时间：2009-04-20T11:58:56.587
> 
> 标签：silverlight, datepicker

如何将`System.Windows.Controls.DatePicker`Silverlight 项目中使用的控件设置为 ReadOnly ？

我似乎无法在 Xaml 或后面的代码中设置任何属性。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2011-11-15T18:23:12.497

我找到了日期选择器的源代码并添加了一个 ReadOnly 属性。

..和“是的”有一个值得这样做的理由。我想要有 3 个状态：

1.  普通的
2.  禁用（灰色外观）
3.  ReadOnly（不灰显，没有日历按钮...还更改了文本框的边框，使其看起来像一个标签）

3 的风格是我的偏好，但特别是我想区分禁用控件（灰色）和只读“视觉”明智。

不确定是否要发布代码（有很多）......或者是否有人仍然感兴趣;-)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-04-05T20:30:41.473

我解决了为 DatePickerTextBox 控件设置新样式的问题。此控件是 DatePicker 样式的一部分。然后使用这些行，您可以将所有可以访问此样式的 DatePicker 控件设为只读。这只会使手动编辑日期成为只读，用户仍然可以使用下拉按钮选择日期。

```
<Style TargetType="prim:DatePickerTextBox">
  <Setter Property="IsReadOnly" Value="True"/>
</Style> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-20T15:08:18.927

你为什么想要？

DatePicker 是一个美化的组合框，它下拉日历而不是列表。如果它变成只读，那么它实际上是一个只读文本框吗？

<编辑> 如果它纯粹是为了外观，那么解决方法是复制控件模板并对其进行编辑，使其禁用状态看起来与其活动状态相同，然后在需要只读时将其设置为禁用行为。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-04-21T20:03:16.930

仅处理日期更改事件并抑制它并将其恢复为今天的日期（或其他一些设定日期）怎么样？

# .net - 清理你的源代码树

> ID：767961
> 
> 赞同：2
> 
> 时间：2009-04-20T12:00:44.150
> 
> 标签：.net, continuous-integration, open-source

在清理源代码树时，你删除了哪些常见的东西？例如：

1.  删除 bin/obj/debug/release 目录
2.  删除临时/缓存文件，例如 ReSharper 缓存文件
3.  删除源代码控制文件/目录，例如 _svn 和 .svn

另外，您通常对源代码树做什么？例如：

1.  将其压缩以存档
2.  通过电子邮件将其发送给感兴趣的各方

我问是因为我一直在研究基于 Jeff Attwood 的[CleanSourcesPlus](http://www.codinghorror.com/blog/archives/000368.html)的工具。

该工具称为**[Tree Trim](http://code.google.com/p/treetrim/)**，可在[http://code.google.com/p/treetrim/下载](http://code.google.com/p/treetrim/)

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-20T12:04:11.367

要执行 1 - 3，我只需从 Subversion**导出。**

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-20T12:05:02.457

使用 TortoiseSVN 的导出命令将从源代码树中删除所有 _svn/.svn 文件夹。我不知道这是否有帮助。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-20T12:06:17.710

好吧，我们在 Tortoise SVN 中有一个排除策略，以首先阻止垃圾进入那里。

bin bin Obj obj ~* *.bak *.tmp *.suo *.user PrecompiledWeb

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-20T12:08:00.497

我使用 MSBuild 来[自动化](http://code.google.com/p/octalforty-wizardby/source/browse/trunk/src/octalforty.Wizardby.msbuild)从 SVN 存储库导出源、构建和压缩所有内容的过程。所以一切都归结为运行`PrepareDownloads Release`两次——因为 MSBuild 的运行方式。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-20T12:49:31.863

构建过程应该是自动化的，这样您就可以在命令行上使用一个命令来完成所有这些工作。

如果我想把当前的开发版本放在一起（假设没有持续集成系统已经这样做了），我说它`mvn clean package`会根据需要自动下载所有库依赖项，构建软件，运行所有测试并将发布工件组装在一个整洁的 ZIP 文件。使用 Maven 配置自动构建过程可能需要几个小时（如果 Maven 对您来说是新的，则更多，如果您可以从其他项目之一复制配置模板则更少），但之后它只是命令中的一个命令线。

发布新版本时，我运行`mvn release:prepare`以增加版本号并在源代码管理中标记发布，之后我从源代码管理导出新标签并构建它`mvn clean deploy`，它将组装工件并将它们上传到 Web 可访问的存储库.

# asp.net - 生成一个 aspx 页面的 PDF 文件而不显示它

> ID：767966
> 
> 赞同：3
> 
> 时间：2009-04-20T12:01:56.597
> 
> 标签：asp.net, pdf

从我的代码中，我显示了一个 .aspx 页面，其中包含基础图表控件。我想通过电子邮件发送与 PDF 附件相同的 .aspx 页面，而不在屏幕上显示 .aspx 页面。如何才能做到这一点。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-20T12:24:23.580

为什么不直接在电子邮件中发送生成图表的 URL 并让用户确定他们想要如何保存它呢？据推测，您可以构建一个对所有需要的参数进行编码的 url——如果您要以编程方式构建它（至少如果您希望它简单的话），您将需要它。或者，您可以使用 HttpHandler (ashx) 进行转换（如@Marc 所述）并将 PDF 发回。无论哪种方式，您都可以使您的电子邮件更小。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-20T12:05:56.913

inragistics 控制如何运作？它会变成 gif/png/etc 吗？还是 ActiveX/flash/etc？

对于基于图像的图表，有一系列工具可以完成将 html+图像抓取为 pdf 的工作，包括 HTMLDOC、ABCpdf 等。生成您的 PDF，并将文件用作附件。

你仍然需要一个网络服务器来生成图像——但你永远不必查看页面；它本质上变成了一种美化的网络服务。

# c# - 验证活动目录中的过期密码

> ID：767978
> 
> 赞同：2
> 
> 时间：2009-04-20T12:05:27.260
> 
> 标签：c#, security, active-directory, passwords

我正在用 c#、.Net 3.5 编写一个自助服务密码重置系统——我需要做的一件事是允许用户使用过期密码进行身份验证并赋予他们更改密码的能力。您可以使用 System.DirectoryServices 或 System.DirectoryServices.AccountManagement 命名空间验证过期密码吗？无论如何使用低级api调用来做到这一点？

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-20T12:33:00.297

看到[这个问题](https://stackoverflow.com/questions/290548/c-validate-a-username-and-password-against-active-directory)，特别是[这个答案](https://stackoverflow.com/questions/290548/c-validate-a-username-and-password-against-active-directory/291811#291811)

# c++ - 将 std::find_if 与 std::string 一起使用

> ID：767995
> 
> 赞同：3
> 
> 时间：2009-04-20T12:10:18.307
> 
> 标签：c++, stl

我在这里很愚蠢，但是在遍历字符串时，我无法获得要 find_if 的谓词的函数签名：

```
bool func( char );

std::string str;
std::find_if( str.begin(), str.end(), func ) ) 
```

在这种情况下，谷歌不是我的朋友:(有人在这里吗？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-04-20T12:16:42.910

```
#include <iostream>
#include <string>
#include <algorithm>

bool func( char c ) {
    return c == 'x';
}

int main() {
    std::string str ="abcxyz";;
    std::string::iterator it = std::find_if( str.begin(), str.end(), func );
    if ( it != str.end() ) {
        std::cout << "found\n";
    }
    else {
        std::cout << "not found\n";
    }
} 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-20T12:39:05.180

`c`如果您尝试在 std::string中查找单个字符，`str`则可以使用`std::find()`而不是`std::find_if()`. 而且，实际上，您最好使用`std::string`的成员函数[`string::find()`](http://msdn.microsoft.com/en-us/library/efzty53k.aspx)而不是函数 from `<algorithm>`。

```
#include <iostream>
#include <string>
#include <algorithm>

int main()
{
  std::string str = "abcxyz";
  size_t n = str.find('c');
  if( std::npos == n )
    cout << "Not found.";
  else
    cout << "Found at position " << n;
  return 0;
} 
```

# c# - 随机数发生器只产生一个随机数

> ID：767999
> 
> 赞同：813
> 
> 时间：2009-04-20T12:11:24.717
> 
> 标签：c#, random

我有以下功能：

```
//Function to get random number
public static int RandomNumber(int min, int max)
{
    Random random = new Random();
    return random.Next(min, max);
} 
```

我怎么称呼它：

```
byte[] mac = new byte[6];
for (int x = 0; x < 6; ++x)
    mac[x] = (byte)(Misc.RandomNumber((int)0xFFFF, (int)0xFFFFFF) % 256); 
```

如果我在运行时使用调试器执行该循环，我会得到不同的值（这是我想要的）。但是，如果我在该代码下方两行放置一个断点，则数组的所有成员`mac`都具有相同的值。

为什么会这样？

* * *

## 回答 #1

> 赞同：1124
> 
> 时间：2009-04-20T12:12:30.317

每次您执行此操作`new Random()`时，都会使用时钟对其进行初始化。这意味着在一个紧密的循环中，您可以多次获得相同的值。您应该保留一个[Random](https://docs.microsoft.com/en-us/dotnet/api/system.random?view=netframework-4.8)实例并继续在**同一**实例上使用[Next 。](https://docs.microsoft.com/en-us/dotnet/api/system.random.next?view=netframework-4.8#System_Random_Next)

 **```
//Function to get a random number 
private static readonly Random random = new Random(); 
private static readonly object syncLock = new object(); 
public static int RandomNumber(int min, int max)
{
    lock(syncLock) { // synchronize
        return random.Next(min, max);
    }
} 
```

* * *

编辑（见评论）：为什么我们需要在`lock`这里？

基本上，`Next`是要改变`Random`实例的内部状态。如果我们从多个线程同时执行此操作，您*可能会*争辩说“我们只是让结果更加随机”，但我们*实际上*正在做的事情可能会破坏内部实现，我们也可以开始获得相同的数字来自不同的线程，这*可能*是一个问题 - 也可能不是。但是，内部发生的事情的保证是更大的问题。因为`Random`不**保证**线程安全。因此，有两种有效的方法：

*   同步，这样我们就不会从不同的线程同时访问它
*   每个线程使用不同的`Random`实例

两者都可以；但是同时从多个调用者中对**单个**实例进行互斥只是自找麻烦。

实现了这些方法中的`lock`第一个（也是更简单的）；但是，另一种方法可能是：

```
private static readonly ThreadLocal<Random> appRandom
     = new ThreadLocal<Random>(() => new Random()); 
```

这是每个线程，所以你不需要同步。

* * *

## 回答 #2

> 赞同：130
> 
> 时间：2012-07-13T15:25:45.620

为了便于在整个应用程序中重用，静态类可能会有所帮助。

```
public static class StaticRandom
{
    private static int seed;

    private static ThreadLocal<Random> threadLocal = new ThreadLocal<Random>
        (() => new Random(Interlocked.Increment(ref seed)));

    static StaticRandom()
    {
        seed = Environment.TickCount;
    }

    public static Random Instance { get { return threadLocal.Value; } }
} 
```

然后您可以使用带有代码的静态随机实例，例如

```
StaticRandom.Instance.Next(1, 100); 
```

* * *

## 回答 #3

> 赞同：67
> 
> 时间：2009-06-23T11:26:10.173

Mark 的解决方案可能非常昂贵，因为它每次都需要同步。

我们可以通过使用线程特定的存储模式来解决同步的需要：

```
 public class RandomNumber : IRandomNumber
{
    private static readonly Random Global = new Random();
    [ThreadStatic] private static Random _local;

    public int Next(int max)
    {
        var localBuffer = _local;
        if (localBuffer == null) 
        {
            int seed;
            lock(Global) seed = Global.Next();
            localBuffer = new Random(seed);
            _local = localBuffer;
        }
        return localBuffer.Next(max);
    }
} 
```

测量这两种实现，您应该会看到显着的差异。

* * *

## 回答 #4

> 赞同：43
> 
> 时间：2013-03-31T12:34:04.947

我的回答来自[这里](https://stackoverflow.com/a/15729385/661933)：

只是重申**正确的解决方案**：

```
namespace mySpace
{
    public static class Util
    {
        private static rnd = new Random();
        public static int GetRandom()
        {
            return rnd.Next();
        }
    }
} 
```

所以你可以打电话：

```
var i = Util.GetRandom(); 
```

自始至终。

**如果您严格需要一个真正的无状态静态方法**来生成随机数，您可以依赖`Guid`.

```
public static class Util
{
    public static int GetRandom()
    {
        return Guid.NewGuid().GetHashCode();
    }
} 
```

*它会慢一点，但*`Random.Next`至少从我的经验来看，它可能比 随机得多。

但**不是**：

```
new Random(Guid.NewGuid().GetHashCode()).Next(); 
```

不必要的对象创建会使其变慢，尤其是在循环下。

并且**从不**：

```
new Random().Next(); 
```

它不仅速度较慢（在循环内），而且它的随机性......在我看来并不是很好......

* * *

## 回答 #5

> 赞同：29
> 
> 时间：2009-04-20T12:25:46.603

我宁愿使用以下类来生成随机数：

```
byte[] random;
System.Security.Cryptography.RNGCryptoServiceProvider prov = new System.Security.Cryptography.RNGCryptoServiceProvider();
prov.GetBytes(random); 
```

* * *

## 回答 #6

> 赞同：18
> 
> 时间：2009-04-20T12:37:10.287

1）正如 Marc Gravell 所说，尝试使用一个随机发生器。将它添加到构造函数中总是很酷：System.Environment.TickCount。

2) 一个小费。假设您要创建 100 个对象，并假设每个对象都应该有自己的随机生成器（如果您在很短的时间内计算随机数的 LOADS 会很方便）。如果您要在循环中执行此操作（生成 100 个对象），您可以这样做（以确保完全随机）：

```
int inMyRandSeed;

for(int i=0;i<100;i++)
{
   inMyRandSeed = System.Environment.TickCount + i;
   .
   .
   .
   myNewObject = new MyNewObject(inMyRandSeed);  
   .
   .
   .
}

// Usage: Random m_rndGen = new Random(inMyRandSeed); 
```

干杯。

* * *

## 回答 #7

> 赞同：10
> 
> 时间：2018-10-19T16:06:19.680

每次执行

```
Random random = new Random (15); 
```

如果您执行数百万次也没关系，您将始终使用相同的种子。

如果你使用

```
Random random = new Random (); 
```

你得到不同的随机数序列，如果黑客猜到了种子并且你的算法与你系统的安全性有关——你的算法被破坏了。我执行 mult。在此构造函数中，种子由系统时钟指定，如果在很短的时间（毫秒）内创建了多个实例，则它们可能具有相同的种子。

如果您需要安全的随机数，则必须使用该类

> System.Security.Cryptography.RNGCryptoServiceProvider

```
public static int Next(int min, int max)
{
    if(min >= max)
    {
        throw new ArgumentException("Min value is greater or equals than Max value.");
    }
    byte[] intBytes = new byte[4];
    using(RNGCryptoServiceProvider rng = new RNGCryptoServiceProvider())
    {
        rng.GetNonZeroBytes(intBytes);
    }
    return  min +  Math.Abs(BitConverter.ToInt32(intBytes, 0)) % (max - min + 1);
} 
```

用法：

```
int randomNumber = Next(1,100); 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2021-07-21T18:34:31.297

我用这个：

```
int randomNumber = int.Parse(Guid.NewGuid().ToString().FirstOrDefault(Char.IsDigit).ToString().Replace("\0", "0")); 
```

性能：在我的 PC 上生成 100 万个随机数：711 毫秒。

如果 Guid 不包含任何数字（我不知道这是否可能），那么将使用 0 作为结果。

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2020-08-31T05:06:52.777

我通过使用 Rnd() 函数解决了这个问题：

```
Function RollD6() As UInteger
        RollD6 = (Math.Floor(6 * Rnd())) + 1
        Return RollD6
End Function 
```

当表单加载时，我使用 Randomize() 方法来确保每次运行时我不会总是得到相同的随机数序列。

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2021-07-21T17:55:01.933

在 Visual Basic 中这是可行的（可能可以转换为 C#，如果不是 DLL 引用可以是一个解决方案）：

```
Private Function GetRandomInt(ByVal Min As Integer, ByVal Max As Integer) As Integer
     Static Generator As System.Random = New System.Random()
     Return Generator.Next(Min, Max)
End Function 
```

* * *

## 回答 #11

> 赞同：-2
> 
> 时间：2014-06-04T05:13:31.957

有很多解决方案，这里有一个：如果你只想数字擦除字母并且方法接收随机和结果长度。

```
public String GenerateRandom(Random oRandom, int iLongitudPin)
{
    String sCharacters = "123456789ABCDEFGHIJKLMNPQRSTUVWXYZ123456789";
    int iLength = sCharacters.Length;
    char cCharacter;
    int iLongitudNuevaCadena = iLongitudPin; 
    String sRandomResult = "";
    for (int i = 0; i < iLongitudNuevaCadena; i++)
    {
        cCharacter = sCharacters[oRandom.Next(iLength)];
        sRandomResult += cCharacter.ToString();
    }
    return (sRandomResult);
} 
```

* * *

## 回答 #12

> 赞同：-4
> 
> 时间：2020-10-01T02:16:44.657

总是得到一个正的随机数。

```
 var nexnumber = Guid.NewGuid().GetHashCode();
        if (nexnumber < 0)
        {
            nexnumber *= -1;
        } 
```*******````***