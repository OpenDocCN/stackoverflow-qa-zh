# StackOverflow 问答 000155000-000155999

# c# - 找出对象在 .NET 中使用多少内存的最简单方法是什么？

> ID：155022
> 
> 赞同：2
> 
> 时间：2008-09-30T20:46:29.687
> 
> 标签：c#, .net, memory

找出对象在 .NET 中使用多少内存的最简单方法是什么？

最好不必求助于第三方工具。Marshal.SizeOf 或 sizeof 运算符看起来很有用，但仅适用于有限范围的类型。

一些相关的帖子：

*   [.NET 中的对象内存分析](https://stackoverflow.com/questions/109836/object-memory-analysis-in-net)
*   [.NET 中的空数组是否使用任何空间？](https://stackoverflow.com/questions/151936/does-an-empty-array-in-net-use-any-space)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-30T20:50:11.610

在这里问和回答：[确定一个类使用多少内存？](https://stackoverflow.com/questions/51540/determine-how-much-memory-a-class-uses#51895)

快速总结是，如果您不想使用工具，则需要使用[.NET Profiling API](http://msdn.microsoft.com/en-us/library/ms404386.aspx)

Profiling API 非常强大，但我不认为它会被认为是“简单”的，所以我强烈建议使用内存分析工具——有些免费的可以，有些不行- 非常好的商业产品（特别是[JetBrains dotTrace](http://www.jetbrains.com/profiler/index.html)）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-30T20:52:56.050

你也可以这样做：

```
int startMem = GC.GetTotalMemory(true);
YourClass c = new YourClass();
int endMem = GC.GetTotalMemory(true);
int usedMeme = endMem - startMem; 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-01-31T15:18:07.700

由于 .NET 的垃圾收集特性，测量实际使用了多少内存有点困难。例如，如果你想测量一个类实例的大小，它是否包括你的实例所指向的实例所使用的内存？

**如果答案是否定**的，将所有字段的大小相加：使用反射，遍历类的所有成员；对 typeof(ValueType).IsAssignableFrom(member.Type) 的任何内容使用 Marshal.Sizeof(member.Type) - 这测量原始类型和结构，所有这些都驻留在类的实例分配中。每个引用类型（任何不能分配给值类型的）都将采用 IntPtr.Size。这有很多令人作呕的例外，但它可能对你有用。

**如果答案是肯定的**，你有一个严重的问题。多个事物可以引用单个实例，因此如果 'a' 和 'b' 都指向 'c'，则将`RecursiveSizeOf(a) + RecursiveSizeOf(b)`大于`SimpleSizeOf(a) + SimpleSizeOf(b) + SimpleSizeOf(c)`.

更糟糕的是，递归测量可能会导致您向下循环引用，或者将您带到您不打算测量的对象 - 例如，如果一个类正在引用互斥锁，则该互斥锁可能指向拥有它的线程。该线程可能指向它的所有局部变量，这些局部变量指向一些 C# 框架结构……您最终可能会测量整个程序。

它可能有助于理解像 C# 这样的垃圾收集语言在区分对象和内存单元的方式上有些“模糊”（从完全非技术意义上）。这是很多`Marshal`缓解措施 - 封送规则确保您正在封送（或测量）的结构具有明确定义的内存布局，因此具有明确定义的大小。在这种情况下，如果您打算使用 Marhsal.SizeOf()，则应该使用定义明确的可编组结构。

另一种选择是序列化。这不会具体告诉您正在使用多少内存，但它会让您对对象的大小有一个相对的了解。但是同样，为了序列化事物，它们必须具有明确定义的布局（因此也必须具有明确定义的大小）——您可以通过使类适当地可序列化来完成。

如果上述任何选项对您有吸引力，我可以发布实施示例。

# python - SQLAlchemy and kinterbasdb in separate apps under mod_wsgi

> ID：155029
> 
> 赞同：1
> 
> 时间：2008-09-30T20:47:35.330
> 
> 标签：python, sqlalchemy, kinterbasdb

I'm trying to develop an app using turbogears and sqlalchemy. There is already an existing app using kinterbasdb directly under mod_wsgi on the same server. When both apps are used, neither seems to recognize that kinterbasdb is already initialized Is there something non-obvious I am missing about using sqlalchemy and kinterbasdb in separate apps? In order to make sure only one instance of kinterbasdb gets initialized and both apps use that instance, does anyone have suggestions?

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-06T18:39:22.887

我以为我已经发布了我的解决方案......

修改这两个应用程序以在其 httpd conf 文件中的 WSGIApplicationGroup ${GLOBAL} 下运行并修补 sqlalchemy.databases.firebird.py 以在调用 self.dbapi.init(... 之前检查 self.dbapi.initialized 是否为 True(... 是唯一的方法我可以设法让这个场景启动并运行
。SQLAlchemy 0.4.7 补丁：

```
diff -Naur SQLAlchemy-0.4.7/lib/sqlalchemy/databases/firebird.py SQLAlchemy-0.4.7.new/lib/sqlalchemy/databases/firebird.py
--- SQLAlchemy-0.4.7/lib/sqlalchemy/databases/firebird.py 2008-07-26 12:43:52.000000000 -0400
+++ SQLAlchemy-0.4.7.new/lib/sqlalchemy/databases/firebird.py 2008-10-01 10:51:22.000000000 -0400
@@ -291,7 +291,8 @@
         全局_initialized_kb
         如果不是 _initialized_kb 并且 self.dbapi 不是 None：
             _initialized_kb = 真
- self.dbapi.init(type_conv=type_conv, concurrency_level=concurrency_level)
+ 如果不是 self.dbapi.initialized：
+ self.dbapi.init(type_conv=type_conv, concurrency_level=concurrency_level)
         返回（[]，选择）

     def create_execution_context(self, *args, **kwargs):

```

# javascript - How can I have two different drop down menus depend on the same parent menu?

> ID：155046
> 
> 赞同：0
> 
> 时间：2008-09-30T20:50:55.027
> 
> 标签：javascript

I have two drop down menus that I want populated with identical data depending on what is selected on the parent drop down menu. Right now, I am using a javascript library that populates one child drop down menu based on a parent, but I need to have two drop down menus populated simultaneously.

This javascript library contains a function called PrintOptions that is supposed to populate the dropdown menu when something is selected from the parent menu. I have tried calling the same function twice one for each drop down menu, but it doesn't seem to be working.

This is where I got the library: [http://www.javascripttoolbox.com/lib/dynamicoptionlist/documentation.php](http://www.javascripttoolbox.com/lib/dynamicoptionlist/documentation.php)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-30T21:15:12.987

Reading the document you list, it seems there's a section that allows you to specify multiple child components from the parent:

```
To create the DynamicOptionList object, pass the names of the fields that are dependent on each other, with the parent field first.
Create the object by passing field names

var dol = new DynamicOptionList("Field1","Child1","Child2");

Or create an empty object and then pass the field names

var dol = new DynamicOptionList();
dol.addDependentFields("Field1","Child1","Child2");

```

Instead of trying to call the function more than once, just add the 2nd child component's name to the DynamicOptionList constructor, as in the first example above. As I read the docs that means whatever happens to Child1 will also happen to Child2 when Field1 is selected.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-30T20:55:24.343

In the event handler you have for your parent drop down, you are probably having some other code populate that child drop down. Simply add the code again, but instead reference the second drop down. That's the rough approach. There are some details and style guidance I'm leaving out, but that'll get the job done.

# windows - Novell client and windows SSO

> ID：155050
> 
> 赞同：0
> 
> 时间：2008-09-30T20:53:25.970
> 
> 标签：windows, sspi, novell

Does the novell gina install a specific security provider that can be used via SSPI? Does it have to called out specifically or is SPNEGO good enough? Will that support single sign on if the novell gina is installed on the remote server?

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-12T20:25:08.283

我不知道 SSPI 或低级别的东西，但我认为 Novell GINA 的工作方式与单点登录无关，更多的是关于通过凭证。

也就是说，当物理用户（而不是编程用户）登录时，Novell Gina 使用凭据并将它们传递给 Windows Gina，以及任何其他排队的 Gina 来接收它们，直到一切都完成，并且一切已登录。

# mysql - mysql时间戳列

> ID：155054
> 
> 赞同：31
> 
> 时间：2008-09-30T20:54:19.150
> 
> 标签：mysql, timestamp

是否可以在 MySQL 表中定义一个时间戳列，每次修改同一行中的字段时都会自动更新该列？理想情况下，该列最初应设置为插入行的时间。

干杯，唐

* * *

## 回答 #1

> 赞同：47
> 
> 时间：2008-09-30T21:06:43.787

您可以像提到的其他海报一样使用时间戳列。这是可用于在其中添加列的 SQL：

```
ALTER TABLE `table1` ADD `lastUpdated` TIMESTAMP ON UPDATE CURRENT_TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ; 
```

这会添加一个名为“lastUpdated”的列，其默认值是当前日期/时间。当该记录更新时（假设 5 分钟后），时间戳将自动更新为当前时间。

* * *

## 回答 #2

> 赞同：23
> 
> 时间：2008-09-30T20:56:14.530

这是**[时间戳](http://dev.mysql.com/doc/refman/5.0/en/timestamp.html)**列类型的默认功能。但是请注意，这种类型的格式是 yyyymmddhhmmss（所有数字，没有冒号或其他分隔符）。

**编辑：**上述关于格式的评论仅适用于 MySQL < 4.1 的版本...以后的版本将其格式化为**DateTime**

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2016-03-14T00:38:43.627

这就是我观察到的（MySql 5.7.11） -

表中的第一个 TIMESTAMP 列将当前时间戳作为默认值。因此，如果您在不提供值的情况下执行 INSERT 或 UPDATE，则该列将获得当前时间戳。

任何后续的 TIMESTAMP 列都应该有一个明确定义的默认值。如果您有两个 TIMESTAMP 列并且没有为第二列指定默认值，则在尝试创建表时会出现此错误 -

错误 1067 (42000)：“COLUMN_NAME”的默认值无效

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-11-15T22:12:48.130

仅当默认值设置为 MySQL 时间戳时，才会设置创建或更新时间。`ALTER TABLE some_table ADD when TIMESTAMP DEFAULT CURRENT_TIMESTAMP`.
否则，它就像 DateTime 字段一样工作，只是它相对于 1970/01/01 UTC，所以它是一个绝对时间点，而不像 DateTime 那样取决于特定时区。

# 64-bit - 开发 PC：AMD 与 Intel 以及 32 位与 64 位

> ID：155064
> 
> 赞同：9
> 
> 时间：2008-09-30T20:57:18.800
> 
> 标签：64-bit, intel, 32-bit, amd-processor

我正在寻找购买新的开发 PC。我的预算不超过 1,000 美元（包括显示器）。我对笔记本电脑（台式机更换类型）持开放态度，或者传统的台式电脑就可以了。

我的主要开发环境是 Microsoft、Visual Studio 2008（以及对旧版 Visual Studio 6 代码的支持）。SQL Server 2005、2008 以及对 SQL Server 2000 的旧版支持。Microsoft Office 2003，可能安装 2007，但支持早至 Office 2000。我将编写和支持的软件主要是 Windows XP，但也有一些 Vista。我将不得不假设有 64 位实现可供安装。

我的第一个困惑始于选择 AMD 或 Intel。我担心的是在 AMD 环境中使用 Visual Studio 构建软件存在兼容性问题。我没有任何证据，只是担心有人会为我澄清。

最后，我对 32 位和 64 位安装感到困惑。即使 64 位正在稳步发展，我是否应该坚持使用最小公分母（32 位）？我知道 64 位操作系统将处理超过 4G 的 RAM，我喜欢这样做，因为我想为测试环境设置尽可能多的虚拟机，并且可能同时有很多活动..

我不是在寻找梦想中的机器，只是一台带有显示器和最好的处理器的机器，大约 1000 美元，这将使我能够为那里的大多数机器编写软件。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-30T21:00:07.780

AMD 和 Intel 之间存在一些指令级别差异，但 Visual Studio 不会发现任何内容。也许如果您使用 Sun Studio 进行开发，您可能会遇到它们（我遇到过！）。

如果您觉得需要在该环境中进行测试，我会选择 64 位机器并在其上运行 32 位虚拟机。这里的普遍感觉似乎是，您能负担得起的最高级别的 Vista 就是开发平台。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-30T21:08:28.197

使用 32 位 XP 和 Vista，您可能无法访问超过 3GB 或 RAM，但可能会更少（我的家用计算机只能使用 Vista 32 访问 2.25GB）。如果你买得起一台 4GB 内存的机器，我会推荐使用 Vista-64（家庭高级版或旗舰版）。

根据您正在进行的开发类型，硬盘驱动器速度可能会对编译时间产生很大影响。如果可能的话，为台式机购买 10,000 RPM 硬盘，为笔记本电脑购买 7200 RPM 硬盘，但它们确实成本更高。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-30T21:14:29.120

AMD 很久以前就消除了它们的不兼容性。您对此的决定应该只是您认为哪个品牌具有更好的性能/功能。我肯定会选择 64 位，因为你总是可以为 VM 和应用程序模拟 32 位等等。当您只需花费 100 美元购买另外 2 到 4 个演出而不是另外 1000 美元最终购买 64 位机器时，使用额外内存的能力将获得回报。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-30T21:15:52.547

鉴于您对运行多个 VM 的 RAM 感兴趣，这将是关键，CPU 也是如此。目前，英特尔在性能上领先于美元（特别是如果您对超频感兴趣），但 AMD 的选项是可以接受的，而且这批现象似乎在真正的四核应用方面比英特尔四核更好。

RAM 的质量和速度在很大程度上并不重要。通用 DDRII 800mhz 就可以了，只要确保你有 4 或 8 GB 的内存。

在操作系统方面，xp 64bit 相当需要驱动程序支持，尽管它已经存在了一段时间。然而，Vista 64bit 几乎支持 Vista 32bit 的所有驱动程序。虽然这意味着您的一些旧设备将无法工作，但您使用 Vista 的麻烦应该比 XP 少得多。在版本控制方面，我建议使用高级版，但是您需要查看添加的功能列表以确定是否值得（对我来说，这根本不值得）。

就特定处理器可能出现的问题而言？我同意**stimms**的观点，尽管可能存在细微差别，但这不是您在 VS 开发中会遇到的问题。然而，我在该领域的经验绝不是广泛的。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-12-11T03:41:33.563

如果您寻找不太昂贵的开发机器，AMD 应该更好。

AMD 780G/790G 主板板载集成VGA，以合理的价格超越大多数nvidia/intel 视频集成主板。AMD Phenom CPU 的性能不如 Intel。但是考虑到您可以以英特尔仅提供 2 核的价格获得 AMD 3 核 CPU，这是一笔划算的交易。

Intel的CPU有很大的超频潜力。然而，作为一名开发人员，我想你喜欢一台坚如磐石的机器，而不喜欢在编译代码时冒着蓝屏死机的风险。

如果您想使用 X64 虚拟机进行测试，硬件虚拟化很重要。大多数现代 AMD CPU 都内置了硬件虚拟化功能，而英特尔从其低端 CPU 中删除了此功能。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-30T21:13:28.373

至少获得 4 gigs rams 等于您需要一个可以处理超过 3 gigs 的系统（所以 64 位操作系统）。Rams 很便宜，如果你想要快速的东西，IDE 和所有其他软件（调试、测试、数据库客户端等）都需要一些 ram。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-30T21:15:15.387

对于 cpu，您可以以不到 190 美元的价格获得[四核，如果有一块可以处理它的主板（大约 125 美元），您就有了一个良好的开端。](http://www.newegg.com/Product/Product.aspx?Item=N82E16819115017)您不需要拥有最新的视频卡...

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-30T21:18:17.127

在您的预算（低于 720 美元）范围内，许多已经构建的 PC 对您来说可能会很好。看这个例子： ![替代文字](https://c1.neweggimages.com/NeweggImage/productimage/83-103-152-02.jpg)

*   Vista 家庭高级版 64 位
*   320 gig 硬盘
*   3 个演出公羊
*   GeForce 7100 显卡
*   包括 22 英寸宏基 LCD
*   酷睿 2 双核 E4700

# apache-flex - Flex中的brokenImageSkin尺寸

> ID：155065
> 
> 赞同：0
> 
> 时间：2008-09-30T20:57:30.703
> 
> 标签：apache-flex

如果我无法加载图像，我正在尝试实现一个自定义的“损坏的图像”图标。为此，我使用了 brokenImageSkin 参数，但它以真实分辨率渲染图像，如果控件的大小受到限制，最终会切断图像。

```
 <mx:Image brokenImageSkin="@Embed('/assets/placeholder.png')" source="http://www.example.com/bad_url.png"/> 
```

如何将 brokenImageSkin 缩放到自定义宽度和高度？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-30T21:40:00.680

我在这个例子中看到了， [http://blog.flexexamples.com/2008/03/02/setting-a-custom-broken-image-skin-for-the-image-control-in-flex/#more- 538](http://blog.flexexamples.com/2008/03/02/setting-a-custom-broken-image-skin-for-the-image-control-in-flex/#more-538)，有一个IO错误事件，可以设置图片的宽高。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-30T22:22:11.530

1.  创建一个扩展 ProgrammaticSkin 的新类。使用 [Embed] 元关键字嵌入您的图像，并将其与 Class 类型的变量相关联（参见文档）

2.  覆盖更新显示列表。

3.  在此函数中调用 graphics.clear()。

4.  调用 graphics.beginBitmapFill 然后根据传入的 unscaledWidth 和 unscaledHeight 应用适当的尺寸和缩放。

这要复杂得多，但这是我所知道的从这样的自定义蒙皮操作中获得更多控制的唯一方法。

# procedural-generation - 如何开始程序生成？

> ID：155069
> 
> 赞同：152
> 
> 时间：2008-09-30T20:59:27.063
> 
> 标签：procedural-generation

[程序生成](http://en.wikipedia.org/wiki/Procedural_generation)最近（由 Spore、MMO 等）引起了关注，它似乎是一种有趣/强大的编程技术。

我的问题是：

*   您知道任何使用程序生成技术的中型项目吗？
*   哪种语言/语言类别最适合程序生成？
*   您可以将程序生成用于“严重”代码吗？（即，不是游戏）

* * *

## 回答 #1

> 赞同：122
> 
> 时间：2008-10-01T08:50:36.607

您可能应该从一些理论和简单的例子开始，例如[中点位移算法](https://web.archive.org/web/20170812230846/http://www.gameprogrammer.com/fractal.html)。如果您对生成图形感兴趣，还应该了解一些关于[Perlin Noise的知识。](http://en.wikipedia.org/wiki/Perlin_noise)我用它来开始我最后一年的程序生成项目。

[分形](http://en.wikipedia.org/wiki/Fractal)与程序生成密切相关。

[Terragen](http://en.wikipedia.org/wiki/Terragen)和[SpeedTree](http://en.wikipedia.org/wiki/SpeedTree)将向您展示程序生成的一些惊人的可能性。

过程生成是一种可以在任何语言中使用的技术（它绝对不限于诸如 C 之类的过程语言，因为它可以用于诸如 Java 之类的 OO 语言和诸如 Prolog 之类的逻辑语言中）。对任何语言的递归有很好的理解将加强​​您对程序生成的掌握。

至于“严肃”或非游戏代码，程序生成技术已用于：

*   模拟城市的发展，以规划交通管理
*   模拟血管的生长
*   SpeedTree 用于电影和建筑演示

* * *

## 回答 #2

> 赞同：50
> 
> 时间：2009-07-02T21:27:40.913

程序内容生成维基：

[http://pcg.wikidot.com/](http://pcg.wikidot.com/)

如果你想要的不在那里，那么添加它;）

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2013-08-21T13:29:05.383

程序内容生成现在都是为 GPU 编写的，因此您需要了解着色器语言。这意味着 GLSL 或 HLSL。这些是分别与 OpenGL 和 DirectX 相关的语言。

虽然由于速度、更容易的学习曲线和[Frank D Luna](http://www.amazon.co.uk/Introduction-3D-Game-Programming-Directx/dp/1936420228/ref=sr_1_1?ie=UTF8&qid=1377091630&sr=8-1&keywords=frank%20luna%20directx%2011)等原因，我个人更喜欢 Dx11 / HLSL，但更多平台支持 OpenGL。

如果您想直接开始编写着色器，而无需花费（大量）时间来设置 OpenGL/DirectX 游戏引擎，您还应该查看 WebGL。

程序内容从噪音开始。

因此，您需要了解 Perlin 噪声（及其继任者[Simplex 噪声](http://http.developer.nvidia.com/GPUGems2/gpugems2_chapter26.html)）。

[Shadertoy](http://shadertoy.com)是学习着色器编程的绝佳参考。我建议您在自己尝试过着色器编码后使用它，因为那里的代码不适用于数学上的娇气，但这就是程序内容的完成方式。

Shadertoy 由程序天才[Inigo Quilez](http://www.iquilezles.org/)创建，他是在 Pixar 工作的演示场景的产物。他有[一些实时编码会话的 youtube 视频](http://www.youtube.com/user/mari1234mari)（[很好的例子](http://www.youtube.com/watch?v=emjuqqyq_qc)），我也可以推荐这些。

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2008-10-01T08:29:03.943

程序生成在演示场景中大量使用，以在小型可执行文件中创建复杂的图形。Will Wright 甚至说他在制作《孢子》时受到了演示场景的启发。这可能是您最好的起点。

[http://en.wikipedia.org/wiki/Demoscene](http://en.wikipedia.org/wiki/Demoscene)

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2011-07-13T14:08:27.980

关于这个主题有一本很棒的书：

[http://www.amazon.com/Texturing-Modeling-Third-Procedural-Approach/dp/1558608486](https://rads.stackoverflow.com/amzn/click/com/1558608486)

它偏向于非实时视觉效果和动画生成，但我想这些理论和想法在这些领域之外是可用的。

值得一提的是，有一个专业的软件包可以实现完整的程序工作流程，称为 SideFX 的 Houdini。您可以使用它来发明和原型化问题的程序解决方案，然后您可以将其转换为代码。

虽然它是一个相当昂贵的软件包，但它有一个免费的评估许可证，可以用作非常好的教育和/或工程工具。

* * *

## 回答 #6

> 赞同：9
> 
> 时间：2014-08-30T12:47:01.497

如果您想要一个世界发电机模拟板块构造、侵蚀、雨影等的示例，请查看： [https ://github.com/ftomassetti/lands](https://github.com/ftomassetti/lands)

除此之外，还有一个文明进化模拟器：

[https://github.com/ftomassetti/civs](https://github.com/ftomassetti/civs)

一个充满有趣资源的博客是：

dungeonleague.com/

它现在被放弃了，但你应该阅读它的所有帖子

* * *

## 回答 #7

> 赞同：8
> 
> 时间：2008-10-01T08:45:14.217

我不是这方面的专家，但我可以尝试提供一些答案：

1.  NetHack 和它的兄弟是开源的，并且严重依赖于程序生成的关卡（地图）。[链接](http://www.nethack.org/v343/downloads.html)到它的下载。如果您对景观/纹理/云生成更感兴趣，我建议您搜索[Gamasutra](http://www.Gamasutra.com)和[GameDev](http://www.GameDev.Net)，它们有很多关于这些主题的文章。

2.  AFAIK我认为语言之间没有太大区别。你看到的大部分代码都在 C/CPP 中，因为它仍然是游戏开发者的官方语言，但你可以使用任何你想要的......

3.  好吧，这取决于您是否有可以从此类技术中受益的项目。我看到了军队模拟器中使用的程序生成（它可以被认为是一个游戏，虽然它们不是很可玩:)）。

还有一个小提示-我的定义是，如果程序生成是从少量规则或模式以及大量随机性中生成大量数据的任何事物，那么您的结果可能会有所不同:)

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2019-12-23T10:34:30.753

（十多年后……）

**程序生成**仅意味着代码用于生成数据，而不是手工制作。例如，如果您想生成一个包含各种树的森林，您**不会****手动**设计每棵树，因此编码更有效地生成变化。它可能是树图形、大小、结构、位置的生成......

一般来说，有一些规则的某种交互**，****除此之外**你可以添加一些你自己的随机性和逻辑，结合所有这些技术......任何有点混乱但不太混乱的东西都可以产生有趣的结果。

 **以下是一些值得注意的技术：

*   [https://en.wikipedia.org/wiki/Cellular_automaton](https://en.wikipedia.org/wiki/Cellular_automaton)
*   [https://en.wikipedia.org/wiki/Conway%27s_Game_of_Life](https://en.wikipedia.org/wiki/Conway%27s_Game_of_Life)（著名的元胞自动机）
*   书：[https ://en.wikipedia.org/wiki/A_New_Kind_of_Science](https://en.wikipedia.org/wiki/A_New_Kind_of_Science)
*   分形：[https ://en.wikipedia.org/wiki/Fractal](https://en.wikipedia.org/wiki/Fractal)
*   植物：[https ://en.wikipedia.org/wiki/L-system](https://en.wikipedia.org/wiki/L-system)
*   地形或地图、纹理、烟雾、云层、湍流：[https ://en.wikipedia.org/wiki/Perlin_noise](https://en.wikipedia.org/wiki/Perlin_noise)
*   地形或地图：[https ://en.wikipedia.org/wiki/Voronoi_diagram](https://en.wikipedia.org/wiki/Voronoi_diagram)

一些以其程序生成而闻名的游戏：

*   [https://en.wikipedia.org/wiki/Rogue_(video_game)](https://en.wikipedia.org/wiki/Rogue_(video_game))和一般的roguelikes
*   [https://en.wikipedia.org/wiki/Elite_(video_game)](https://en.wikipedia.org/wiki/Elite_(video_game))随机种子...
*   [https://en.wikipedia.org/wiki/.kkrieger](https://en.wikipedia.org/wiki/.kkrieger)整个游戏只使用了 97,280 字节的磁盘空间。

[关于程序地块生成](https://www.youtube.com/watch?v=wbpMiKiSKm8&list=PLFt_AvWsXl0eBW2EiBtl_sxmDtSgZBxB3)的视频教程。

游戏程序化内容生成会议，有很多关于该主题的视频：[一切程序化](https://www.everythingprocedural.com/)

玩得开心。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2013-10-06T15:54:12.230

最重要的是分析道路、城市、街区和建筑物的结构。找出所有例如建筑物的共同点。看看照片、地图、计划和现实。如果你这样做，你将比那些认为城市建设仅仅是计算机技术问题的人领先一步。

接下来，您应该开发解决方案，了解如何以微小、不同的步骤创建该几何图形。您必须定义构成可信城市的规则。如果你喜欢 3D 建模，你必须重新思考你所学的很多东西，这样计算机才能在任何情况下遵循你的指令。

为了不松懈，您应该设置许多只负责整个过程的一小部分的操作员。这使得调试、扩展和改进您的系统变得更加容易。在下一步中，您应该链接这些运算符并通过更改参数来检查结果。

我见过太多“城市生成器”，它们主要由随机形状的盒子组成，上面有一些窗口纹理：（

# embedded - 简单的去抖程序

> ID：155071
> 
> 赞同：10
> 
> 时间：2008-09-30T20:59:45.237
> 
> 标签：embedded

您是否有一个简单的去抖动例程可以方便地处理单个开关输入？

这是一个没有任何操作系统的简单裸机系统。

我想避免使用特定计数的循环结构，因为处理器速度可能会波动。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-09-30T21:18:23.320

我想你可以在这里学到很多：[http ://www.ganssle.com/debouncing.pdf](http://www.ganssle.com/debouncing.pdf)

如果可能的话，最好的办法是始终在硬件中执行此操作，但也有一些关于软件的想法。

来自 TFA 的简单示例代码：

```
#define CHECK_MSEC 5 // Read hardware every 5 msec
#define PRESS_MSEC 10 // Stable time before registering pressed
#define RELEASE_MSEC 100 // Stable time before registering released
// This function reads the key state from the hardware.
extern bool_t RawKeyPressed();
// This holds the debounced state of the key.
bool_t DebouncedKeyPress = false;
// Service routine called every CHECK_MSEC to
// debounce both edges
void DebounceSwitch1(bool_t *Key_changed, bool_t *Key_pressed)
{
    static uint8_t Count = RELEASE_MSEC / CHECK_MSEC;
    bool_t RawState;
    *Key_changed = false;
    *Key_pressed = DebouncedKeyPress;
    RawState = RawKeyPressed();
    if (RawState == DebouncedKeyPress) {
        // Set the timer which allows a change from current state.
        if (DebouncedKeyPress) Count = RELEASE_MSEC / CHECK_MSEC;
        else Count = PRESS_MSEC / CHECK_MSEC;
    } else {
        // Key has changed - wait for new state to become stable.
        if (--Count == 0) {
            // Timer expired - accept the change.
            DebouncedKeyPress = RawState;
            *Key_changed=true;
            *Key_pressed=DebouncedKeyPress;
            // And reset the timer.
            if (DebouncedKeyPress) Count = RELEASE_MSEC / CHECK_MSEC;
            else Count = PRESS_MSEC / CHECK_MSEC;
        }
    } 
```

}

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-10-02T21:43:19.250

最简单的解决方案通常是最好的，我发现仅每 N 毫秒读取一次开关状态（10 到 50 之间，取决于开关）一直对我有用。

我已经去掉了损坏和复杂的去抖动例程，并用一个简单的慢速轮询代替了它们，结果总是这样好。

要实现它，您需要在系统上设置一个简单的周期性定时器中断（假设不支持 RTOS），但如果您习惯在裸机上对其进行编程，那么安排起来应该不难。

请注意，这种简单的方法增加了检测状态变化的延迟。如果一个开关需要 T 毫秒才能达到新的稳定状态，并且每 X 毫秒轮询一次，那么检测压力的最坏情况延迟是 T+X 毫秒。您的轮询间隔 X*必须*大于最坏情况的反弹时间 T。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-30T21:27:12.597

没有适用于所有类型按钮的单一简单解决方案。无论这里有人告诉您使用什么，您都必须使用您的硬件进行尝试，看看它的效果如何。并查看示波器上的信号，以确保您真的知道发生了什么。Rich B 的 pdf 链接看起来是个不错的起点。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-16T00:21:49.997

我使用多数投票方法来消除输入的抖动。我建立了一个简单的三态移位寄存器类型的数据结构，并对每个样本进行移位并取三个中最好的两个作为“正确”值。这显然是您的中断处理程序或轮询器的功能，具体取决于实际读取硬件的方法。

但是，最好的建议是请您友好的硬件设计师“锁定”该值，并允许您在达到该值时清除该值。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-30T21:08:51.393

要消除抖动，您需要忽略任何持续低于某个阈值的切换。您可以在开机时设置硬件计时器，或使用通过周期性中断设置的标志。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-30T21:22:21.767

如果你能摆脱它，最好的硬件解决方案是让开关有两个不同的状态，中间没有状态。也就是说，使用 SPDT 开关，每个极点都馈入触发器的 R 或 S 线。以这种方式接线，触发器的输出应该被去抖动。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-25T05:15:26.220

我通常做的是输入寄存器的宽度有三个左右的变量。每次轮询，通常来自中断，都会将值向上移动一个，以便为新样本让路。然后我有一个通过设置样本的逻辑与并清除逆逻辑或来形成的去抖动变量。即（未经测试，来自记忆）

```
input3 = input2;
input2 = input1;
input1 = (*PORTA);

debounced |= input1 & input2 & input3;
debounced &= (input1 | input2 | input3); 
```

这是一个例子：

debounced 有 xxxx （其中“x”是“随便”）

```
input1 = 0110,
input2 = 1100,
input3 = 0100 
```

有了上面的信息，

我们只需要将位 2 切换为 1，位 0 切换为 0。其余的仍在“弹跳”。

```
debounced |= (0100); //set only bit 2
debounced &= (1110); //clear only bit 0 
```

结果是现在 debounced = x1x0

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2015-01-26T16:38:32.213

ganssle.com 的算法可能存在错误。我对以下行的印象

```
static uint8_t Count = RELEASE_MSEC / CHECK_MSEC; 
```

应该读

```
static uint8_t Count = PRESS_MSEC / CHECK_MSEC; 
```

为了正确地消除初始压力。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2016-11-25T21:30:30.683

在硬件级别，基本的去抖动例程必须考虑物理键（或开关）行为的以下部分：

按键静置 -> 手指接触按键并开始向下推 -> 按键到达行程底部，手指保持在那里 -> 手指开始松开按键，弹簧将按键向上推 -> 手指松开按键，按键稍微振动直到它停止

所有这些阶段都涉及 2 块金属相互刮擦和碰撞，在几毫秒的时间内将电压从 0 上下波动，因此每一步都有电噪声：

(1) 按键未接触时的噪音，由湿度、振动、温度变化等环境问题引起，导致按键触点电压变化

(2) 按键时产生的噪音

(3) 按键时的噪音

(4) 按键释放时的噪音

(5) 按键松动后发出的声音

这是我们基本上猜测键被人按下的算法：

读取键的状态，可以是“可能被按下”、“肯定被按下”、“肯定没有被按下”、“可能没有被按下”（我们永远不确定）

循环而键“可能”被按下（如果处理硬件，这是一个大于某个阈值的电压样本），直到“绝对没有”被按下（低于阈值电压）（这是初始化，等待噪声停顿，“可能”和“绝对不是”的定义取决于具体应用）

循环，而键“绝对没有”被按下，直到键“可能”被按下

当键“可能”被按下时，开始循环并采样键的状态，并跟踪键“可能”被按下的时间 - 如果键回到“可能不是”或“绝对没有”被按下在一定时间之前的状态，重新启动程序 - 在您选择的特定时间（毫秒数）（通常通过尝试不同的值），您确定样本值不再由噪声引起，但很可能由人的手指实际按住键而导致返回值“按下”

* * *

```
while(keyvalue = maybepressed){
//loop - wait for transition to notpressed
sample keyvalue here;
maybe require it to be "notpressed" a number of times before you assume
it's really notpressed;
}
while(keyvalue = notpressed){
//loop - wait for transition to maybepressed
sample keyvalue
again, maybe require a "maybepressed" value a number of times before you 
transition
}
while(keyvalue=maybepressed){
  presstime+=1;
  if presstime>required_presstime return pressed_affirmative
  }
}
return pressed_negative 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2019-01-10T01:27:30.567

使用集成，您将成为一个快乐的露营者。适用于所有开关。

只需在读取为高时增加一个计数器，并在读取为低时将其递减，并且当积分器达到限制（上限或下限）时调用状态（高或低）。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2019-05-25T10:05:04.547

Jack Ganssle 很好地描述了整个概念。他作为原始问题的答案发布的解决方案非常好，但我发现其中一部分不太清楚它是如何工作的。

处理开关弹跳的主要方法有三种： - 使用轮询 - 使用中断 - 中断和池的组合。

由于我主要处理低功耗或倾向于低功耗的嵌入式系统，因此 Keith 对集成的回答对我来说非常合理。

如果您使用具有一个机械稳定位置的 SPST 按钮式开关，那么我更喜欢使用中断和池组合的解决方案。
像这样：使用 GPIO 输入中断来检测第一个边沿（下降或上升，未驱动开关状态的相反方向）。在 GPIO 输入 ISR 下设置关于检测的标志。
使用另一个中断来测量时间（即通用定时器或 SysTick）来计算毫秒数。在每个 SysTick 增量（1 ms）上：
如果 buttonFlag 为真，则调用函数来轮询按钮的状态（轮询）。
对 N 个连续的 SysTick 增量执行此操作，然后清除标志。

当您轮询按钮状态时，请使用您希望确定按钮状态的逻辑，例如 M 个连续读数相同、平均值超过 Z、如果状态计数、最后 X 个读数相同等。

我认为这种方法应该受益于中断响应和更低的功耗，因为在 N SysTick 增量后不会有按钮轮询。各种中断之间没有复杂的中断修改，因此程序代码应该相当简单易读。

考虑以下事项：您是否需要“释放”按钮，是否需要检测长按以及按钮释放时是否需要操作。我不喜欢按钮释放时的按钮动作，但有些解决方案就是这样工作的。

# c# - 存储过程默认值

> ID：155074
> 
> 赞同：3
> 
> 时间：2008-09-30T21:00:52.770
> 
> 标签：c#, sql, sql-server, tsql, stored-procedures

当谈到 SQL 时，我是一个新手。在创建具有以下参数的存储过程时：

```
@executed           bit,
@failure            bit,
@success            bit,
@testID             int,
    @time               float = 0,
@name               varchar(200) = '',
@description        varchar(200) = '',
@executionDateTime  nvarchar(max) = '',
@message            nvarchar(max) = '' 
```

这是 T-SQL 中默认值的正确形式吗？我尝试使用 NULL 而不是 ''。

当我尝试通过 C# 执行此过程时，我收到一个错误，指的是预期但未提供描述这一事实。当这样调用它时：

```
 cmd.Parameters["@description"].Value = result.Description; 
```

结果。描述为空。这不应该在 SQL 中默认为 NULL（在我的情况下是 ''）吗？

这是调用命令：

```
 cmd.CommandText = "EXEC [dbo].insert_test_result @executed,
                           @failure, @success, @testID, @time, @name, 
                           @description, @executionDateTime, @message;";

        ...
        cmd.Parameters.Add("@description", SqlDbType.VarChar);
        cmd.Parameters.Add("@executionDateTime", SqlDbType.VarChar);
        cmd.Parameters.Add("@message", SqlDbType.VarChar);

        cmd.Parameters["@name"].Value = result.Name;
        cmd.Parameters["@description"].Value = result.Description;
        ...

        try
        {
            connection.Open();
            cmd.ExecuteNonQuery();
        }
        ...
        finally
        {
            connection.Close();
        } 
```

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-09-30T21:02:34.030

更好的方法是将 CommandText 更改为 SP 的名称，将 CommandType 更改为 StoredProcedure - 然后参数将更清晰地工作：

```
cmd.CommandText = "insert_test_result";
cmd.CommandType = CommandType.StoredProcedure; 
```

这也允许通过名称而不是位置更简单地传递。

通常，ADO.NET 需要 DBNull.Value，而不是 null。我只是使用一种方便的方法循环我的参数并用 DBNull.Value 替换任何空值 - 就像（包装的）一样简单：

```
 foreach (IDataParameter param in command.Parameters)
    {
        if (param.Value == null) param.Value = DBNull.Value;
    } 
```

然而！用 null 指定一个值与让它采用默认值是不同的。如果您希望它使用默认值，请不要在命令中包含该参数。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-30T21:07:27.093

如果您不使用命名参数，MSSQL 将按接收顺序（按索引）获取参数。我认为在 cmd 对象上有一个选项。

所以你的 SQL 应该更像

```
EXEC [dbo].insert_test_result 
@executed = @executed,
@failure = @failure, 
@success = @success, 
@testID = @testID, 
@time = @time, 
@name = @name, 
@description = @description, 
@executionDateTime = @executionDateTime, 
@message = @message; 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-04T00:23:48.293

```
 cmd.CommandText = "insert_test_result";
cmd.Parameters.Add(new SQLParameter("@description", result.Description));
cmd.Parameters.Add(new SQLParameter("@message", result.Message));
try
{
     connection.Open();
     cmd.ExecuteNonQuery();
}
finally
{
     connection.Close();
} 
```

# dotnetnuke - Separator attribute not working in SolPartMenu on DotNetNuke skin.ascx

> ID：155080
> 
> 赞同：0
> 
> 时间：2008-09-30T21:02:28.943
> 
> 标签：dotnetnuke, ascx, skin

I can get rootmenuitemlefthtml and rootmenuitemrighthtml to emit but not separator. Tried CDATA wrapping and setting SeparatorCssClass. I just want pipes between root menu items.

```
<dnn:SOLPARTMENU runat="server" id="dnnSOLPARTMENU" Separator="<![CDATA[|]]>" SeparatorCssClass="MainMenu_SeparatorCSS"
        usearrows="false" 
        userootbreadcrumbarrow="false" usesubmenubreadcrumbarrow="false"
        rootmenuitemlefthtml="&nbsp;&lt;span&gt;&nbsp;&nbsp;&nbsp;" rootmenuitemrighthtml="&nbsp;&nbsp;&nbsp;&lt;/span&gt;" rootmenuitemcssclass="rootmenuitem"
        rootmenuitemselectedcssclass="rootmenuitemselected" rootmenuitembreadcrumbcssclass="rootmenuitembreadcrumb"
        submenucssclass="submenu" submenuitemselectedcssclass="submenuitemselected" submenuitembreadcrumbcssclass="submenuitembreadcrumb"
        CSSNodeSelectedRoot="rootmenuitembreadcrumb" CSSNodeSelectedSub="submenuitembreadcrumb"
        MouseOverAction="False" MouseOutHideDelay="0"
        delaysubmenuload="true" level="Root" /> 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-06T10:15:01.487

虽然不是直接的答案 - 您可能希望切换到 DotNetNuke 菜单而不是使用 SolPart。SolPart 不再受到官方支持，并且该菜单的开发工作在大约两年前就停止了。SolPart 的作者 Jon Henning 从头开始​​编写 DotNetNuke 菜单，并试图解决原始 SolPart 菜单中的许多缺点。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-24T14:06:34.867

检查这个 Solpartmenu：

```
<dnn:SOLPARTMENU runat="server" ID="dnnHorizontalSolpart" ProviderName="SolpartMenuNavigationProvider"
    ClearDefaults="True" MenuBarCssClass="Hmain_dnnmenu_bar" MenuContainerCssClass="Hmain_dnnmenu_container"
    MenuItemCssClass="Hmain_dnnmenu_rootitem" MenuItemSelCssClass="Hmain_dnnmenu_itemhoverRoot"
    MenuIconCssClass="Hmain_dnnmenu_icon" MenuBreakCssClass="Hmain_dnnmenu_break"
    SubMenuCssClass="Hmain_dnnmenu_submenu" SubMenuItemSelectedCssClass="Hmain_dnnmenu_subselected"
    CSSNodeSelectedRoot="Hmain_dnnmenu_rootselected" MenuEffectsMouseOverDisplay="None"
    Separator="|" SeparatorCssClass="Hmain_dnnmenu_separator" UseArrows="False" UseRootBreadCrumbArrow="False" /> 
```

```
.Hmain_dnnmenu_separator
{
    background-color: Transparent;
    color: #C55203;
    font-family: Arial;
    font-size: 11px;
}
.Hmain_dnnmenu_bar
{
    cursor: pointer;
    cursor: hand;
    height: 30px;
    background-color: Transparent;
}
.Hmain_dnnmenu_container
{
    background-color: Transparent;
}
.Hmain_dnnmenu_rootitem
{
    background-color: #DBDBDB;
    cursor: pointer;
    cursor: hand;
    color: #C55203;
    font-family: Arial;
    font-size: 11px;
    _height: 30px;
    _padding: 5px;
    vertical-align: middle;
    text-decoration:underline;
}
.Hmain_dnnmenu_rootitem td
{
    font-family: Arial;
    font-size: 11px;
    _height: 30px;
    _padding: 5px;
    vertical-align: middle;
}
.Hmain_dnnmenu_itemhoverRoot
{
    background-color: #DBDBDB;
    color: #C55203;
    cursor: pointer;
    cursor: hand;
    font-family: Arial;
    font-size: 11px;
    _height: 30px;
    _padding: 5px;
    text-decoration:underline;
    vertical-align: middle;
}
.Hmain_dnnmenu_icon
{
    cursor: pointer;
    cursor: hand;
}
.Hmain_dnnmenu_submenu
{
    background-color: #DBDBDB;
    border: solid 1px #B7B7B7;
    cursor: pointer;
    cursor: hand;
    color: #C55203;
    font-family: Arial;
    font-size: 11px;
    text-align: left;
    text-decoration:none;
    z-index: 1000;
}
.Hmain_dnnmenu_submenu td
{
    border-bottom: solid 1px #B7B7B7;
    font-family: Arial;
    font-size: 11px;
    text-align: left;
    text-decoration:none;
}
.Hmain_dnnmenu_break
{
    font-family: Arial;
    font-size: 11px;
}
.Hmain_dnnmenu_rootselected
{
    color: #C55203;
    cursor: pointer;
    cursor: hand;
    font-size: 11px;
    font-weight: lighter;
    font-style: normal;
    font-family: Arial;
    white-space: nowrap;
    vertical-align: middle;
    text-decoration: None;
}
.Hmain_dnnmenu_submenu_itemhover
{
    background-color: #C55203;
    color: #FFFFFF;
    font-family: Arial;
    font-size: 11px;
}
.Hmain_dnnmenu_subselected
{
    background-color: #C55203;
    color: #FFFFFF;
    font-family: Arial;
    font-size: 11px;
} 
```

# flash - Flash rendering: optimisation tips and tricks

> ID：155084
> 
> 赞同：5
> 
> 时间：2008-09-30T21:03:33.187
> 
> 标签：flash, actionscript-3, optimization

I'm about to push out a website soon and so I've gotten in the last stages. Time to optimize the baby! The website performs pretty good overall, with an average framerate of 32fps. But at some heavy animation parts it likes to drop a couple of frames to about 22fps. Which is not that horrible. But I'm tweaking it as much as possible to keep it running at the highest speed possible.

I might overlooked some tips and tricks to make this baby run even smoother.

So hereby I open this thread to share whatever ninja tricks ever helped you in the past. A couple of mine which I can think of right now:

**Sequencing the animation:**

Let as less as possible transitions happen at the same time, try to make it act more as a transformer, one thing at a time. Next to gaining speed in animation, you probably end up gaining more flow.

**Keep the animating objects as small as possible:**

So flash has to calculate less pixels at the same time.

**cacheAsBitmap = true:**

Those big movieclips, vector shapes being moved around, are probably quicker moved when they are cached as a bitmap. Might take up some space in your memory, but anything for higher framerates ;)

**Destroy everything you do not use:**

Set those unused movieclips to null and then remove it as a child. So your garbage collector takes care of it.

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-01T03:45:52.267

另一个考虑因素是您使用的补间引擎。如果您使用的是 Flash 附带的那个，您可能会通过切换到 TweenLite 之类的东西来获得一些性能（还有很多其他的好东西）。

请记住，cacheAsBitmap 可能非常危险。如果您正在缩放、旋转或更新剪辑本身（例如修改其中某些内容的 alpha），则 flash 将不得不生成一个新快照，这会减慢一切。只要您在 x 和 y 上移动剪辑，最好始终打开（如果您需要旋转，请将其关闭，然后在完成后重新打开）。另请注意，如果您使用过滤器 cacheAsBitmap*总是*自动打开 -> 可能会很慢。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-01T06:25:58.887

把事情简单化，

Flash 将图形渲染为矢量（并且非常好）。对象越复杂，渲染所需的时间就越多。

也尝试跟踪图形显示树。舞台的每个孩子都必须单独渲染，所以如果你有 1000 个孩子，这会让事情变得非常缓慢。

一种解决方案是在单个对象中渲染一次，例如显示处理程序。您可能会失去“客观性”，但可以通过更快的渲染来弥补。在为精灵制作瓷砖或许多小“添加”时请记住这一点。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-02T05:58:09.523

您可能想要使用movieclips/sprites 等的scrollRect 属性......它基本上充当一个蒙版，但您可以将蒙版剪辑滚动一些偏移量。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-30T21:22:02.423

Alpha 透明度可能需要大量渲染...

据我所知，如果你为它制作动画，辉光滤镜会造成严重破坏。

尽可能使用 visible = false 而不是 alpha = 0。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-30T21:30:58.783

仅`cacheAsBitmap = true:`在您没有为 Sprite/MovieClip 的变换设置动画时使用（例如缩放/旋转等），否则它实际上会使其变慢。

尽可能使用 PNG 而不是矢量形状。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-10-03T10:50:21.567

大块文本，如果它们不改变，通常可以用位图（或透明 PNG）替换。这使得内容难以维护，但它会对性能产生*重大*影响。（注意：这主要适用于嵌入式字体，尤其是像亚洲字体这样的弯曲字体，因为这些字体被渲染为矢量形状。设备字体由操作系统渲染，产生的开销要少得多。）

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-10-03T10:53:28.113

简介，简介，简介。

如果脚本运行缓慢，请开始跟踪计时报告以找出哪个类、哪个函数、哪个循环、哪个语句让您变慢。如果图形效果让你慢下来，追踪详细的时间 FPS 报告并开始调整。当你删除这个或那个层时它会加速吗？或者当您将该剪辑更改为不透明时？等等。在尝试修复之前隔离慢的部分。

只是四处寻找和重构很少能让你获得任何真正的性能改进。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-30T21:30:28.910

Flash（8 - Actionscript 2 或更低版本）将呈现剪辑，即使它的可见性设置为 false - 要停止呈现它，您需要将其移出“可见”屏幕（即 x = -2000，前提是剪辑宽度为小于 2000）。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-10-03T10:48:18.310

位图缓存仅在您正在缓存的 DisplayObject 具有复杂的内部部分但倾向于坐在那里而不改变时才给您真正的回报 - 例如下拉菜单，其内部具有各种可换肤的元素，但只需要在以下情况下重新渲染它已打开或关闭。小心不要仅仅因为对象很大就打开缓存。

# .net - 如何使用 .Net 中的反射从密封类继承？

> ID：155087
> 
> 赞同：21
> 
> 时间：2008-09-30T21:03:57.567
> 
> 标签：.net, inheritance

在你开始向我开火之前，我不打算这样做，但[另一篇文章](https://stackoverflow.com/questions/154698/how-can-i-keep-a-class-from-being-inherited-in-c)中有人说这是可能的。这怎么可能？我从来没有听说过使用反射继承任何东西。但是我看到了一些奇怪的东西......

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-09-30T21:31:53.507

如果没有要覆盖的虚函数，继承密封类就没有多大意义。

如果您尝试编写一个包含虚函数的密封类，则会收到以下编译器错误：

```
// error CS0549: 'Seal.GetName()' is a new virtual member in sealed class 'Seal' 
```

但是，您可以通过在基类中声明虚函数来将它们放入密封类中（像这样），

```
public abstract class Animal
{
    private readonly string m_name;

    public virtual string GetName() { return m_name; }

    public Animal( string name )
    { m_name = name; }
}

public sealed class Seal : Animal
{
    public Seal( string name ) : base(name) {}
} 
```

但问题仍然存在，我看不出你怎么能偷偷溜过编译器让你声明一个子类。我尝试使用 IronRuby（ruby 是所有黑客语言中最黑客的），但即使它也不会让我这样做。

“密封”部分嵌入到 MSIL 中，所以我猜 CLR 本身实际上是强制执行的。您必须加载代码，反汇编它，删除“密封”位，然后重新组装它，然后加载新版本。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-10-01T07:43:50.400

很抱歉在另一个线程中发布了不正确的假设，我没有正确回忆。使用以下示例，使用 Reflection.Emit，展示了如何从另一个类派生，但它在运行时失败并抛出 TypeLoadException。

```
sealed class Sealed
{
   public int x;
   public int y;
}

class Program
{
   static void Main(string[] args)
   {
      AppDomain ad = Thread.GetDomain();
      AssemblyName an = new AssemblyName();
      an.Name = "MyAssembly";
      AssemblyBuilder ab = ad.DefineDynamicAssembly(an, AssemblyBuilderAccess.Run);
      ModuleBuilder mb = ab.DefineDynamicModule("MyModule");
      TypeBuilder tb = mb.DefineType("MyType", TypeAttributes.Class, typeof(Sealed));

      // Following throws TypeLoadException: Could not load type 'MyType' from
      // assembly 'MyAssembly' because the parent type is sealed.
      Type t = tb.CreateType();
   }
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-30T21:15:17.870

它***可能***（如果可以的话会增加尺寸）。根据 freenode 上的人的说法，这将涉及修改字节码，使用 Reflection.Emit，并为 JIT 提供一组新的字节码。

并不是说我**知道**……这正是他们的想法。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-30T21:16:44.183

另一位发帖人可能更多地沿着 Reflection.Emit 的思路思考，而不是更常见的只读反射 API。

但是，仍然不可能（至少根据[这篇文章](http://www.devx.com/dotnet/Article/28783/1954)）。但是，在您尝试实际执行发出的代码之前，肯定有可能用 Reflection.Emit 搞砸一些不会被捕获的东西。

* * *

## 回答 #5

> 赞同：-3
> 
> 时间：2009-06-02T01:56:05.900

创建一个名为 GenericKeyValueBase 的新类

把这个放进去

```
 public class GenericKeyValueBase<TKey,TValue>
    {
        public TKey Key;
        public TValue Value;

        public GenericKeyValueBase(TKey ItemKey, TValue ItemValue)
        {
            Key = ItemKey;
            Value = ItemValue;
        }
    } 
```

并且继承它加上你可以添加额外的扩展方法添加/删除（AddAt 和 RemoveAt）到你的新派生类（并使其成为一个集合/字典），如果你感觉真的很酷。

一个简单的实现示例，您将使用普通 System.Collections.Generic.KeyValuePair 作为基础，但可以使用上面的代码

```
 class GenericCookieItem<TCookieKey, TCookieValue> : GenericKeyValueBase<TCookieKey,TCookieValue>
    {
        public GenericCookieItem(TCookieKey KeyValue, TCookieValue ItemValue) : base(KeyValue, ItemValue)
        {
        }
    } 
```

# excel - Microsoft Excel 破坏 .csv 文件中的变音符号？

> ID：155097
> 
> 赞同：196
> 
> 时间：2008-09-30T21:07:06.827
> 
> 标签：excel, encoding, csv, diacritics

我正在以编程方式将数据（使用 PHP 5.2）导出到 .csv 测试文件中。
示例数据：（ `Numéro 1`注意带重音的 e）。数据是`utf-8`（没有前置 BOM）。

当我在 MS Excel 中打开此文件时，显示为`NumÃ©ro 1`.

我可以在正确显示它的文本编辑器（UltraEdit）中打开它。UE 报告字符为`decimal 233`.

如何在 .csv 文件中**导出文本数据，以便****MS Excel 正确呈现**它，最好不强制使用导入向导或非默认向导设置？

* * *

## 回答 #1

> 赞同：255
> 
> 时间：2008-09-30T21:30:17.317

格式正确的 UTF8 文件可以将[字节顺序标记](http://en.wikipedia.org/wiki/Byte_order_mark)作为其前三个八位字节。这些是十六进制值 0xEF、0xBB、0xBF。这些八位字节用于将文件标记为 UTF8（因为它们与“字节顺序”信息无关）。[1](http://en.wikipedia.org/wiki/Byte_order_mark) 如果此 BOM 不存在，则留给消费者/读者来推断文本的编码类型。不支持 UTF8 的阅读器会将字节作为其他编码（例如 Windows-1252）读取，并`ï»¿`在文件开头显示字符。

有一个已知错误，即 Excel 在通过文件关联打开 UTF8 CSV 文件时假定它们采用单字节编码，而**忽略**UTF8 BOM 的存在。任何系统默认代码页或语言设置都无法解决**此**问题。BOM 不会在 Excel 中提供线索 - 它只是行不通。（少数报告声称 BOM 有时会触发“导入文本”向导。）此错误似乎存在于 Excel 2003 及更早版本中。大多数报告（在此处的答案中）说这已在 Excel 2007 及更高版本中修复。

请注意，您始终**可以**使用“导入文本”向导在 Excel 中正确打开 UTF8 CSV 文件，该向导允许您指定正在打开的文件的编码。当然，这不太方便。

此答案的读者很可能处于他们不特别支持 Excel < 2007，但将原始 UTF8 文本发送到 Excel 的情况下，这会误解它并将您的文本洒上`Ã`其他类似的 Windows-1252 字符。 **添加 UTF8 BOM 可能是您最好和最快的解决方法。**

如果您在旧版 Excel 上遇到用户问题，并且 Excel 是 CSV 的唯一使用者，您可以通过导出 UTF16 而不是 UTF8 来解决此问题。Excel 2000 和 2003 将正确双击打开这些。（其他一些文本编辑器可能会遇到 UTF16 问题，因此您可能需要仔细权衡您的选择。）

* * *

[* 除非你不能，（至少）Excel 2011 for Mac 的导入向导实际上并不总是适用于所有编码，不管你告诉它什么。</轶事证据> :)]

* * *

## 回答 #2

> 赞同：42
> 
> 时间：2008-11-24T17:11:18.583

预先添加 BOM (\uFEFF) 对我有用 (Excel 2007)，因为 Excel 将文件识别为 UTF-8。否则，保存它并使用导入向导可以，但不太理想。

* * *

## 回答 #3

> 赞同：33
> 
> 时间：2009-10-30T08:50:24.100

以下是我在向用户发送 Microsoft Excel 时在项目中使用的 PHP 代码：

```
 /**
   * Export an array as downladable Excel CSV
   * @param array   $header
   * @param array   $data
   * @param string  $filename
   */
  function toCSV($header, $data, $filename) {
    $sep  = "\t";
    $eol  = "\n";
    $csv  =  count($header) ? '"'. implode('"'.$sep.'"', $header).'"'.$eol : '';
    foreach($data as $line) {
      $csv .= '"'. implode('"'.$sep.'"', $line).'"'.$eol;
    }
    $encoded_csv = mb_convert_encoding($csv, 'UTF-16LE', 'UTF-8');
    header('Content-Description: File Transfer');
    header('Content-Type: application/vnd.ms-excel');
    header('Content-Disposition: attachment; filename="'.$filename.'.csv"');
    header('Content-Transfer-Encoding: binary');
    header('Expires: 0');
    header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
    header('Pragma: public');
    header('Content-Length: '. strlen($encoded_csv));
    echo chr(255) . chr(254) . $encoded_csv;
    exit;
  } 
```

更新：文件名改进和错误修复正确的长度计算。感谢[TRiG](https://stackoverflow.com/users/209139/trig)和[@ivanhoe011](https://stackoverflow.com/users/373505/ivanhoe011)

* * *

## 回答 #4

> 赞同：15
> 
> 时间：2013-08-22T08:26:09.377

**Excel 版本 (2003 + 2007) 和文件类型的所有组合的答案**

这里的大多数其他答案仅涉及他们的 Excel 版本，不一定会对您有所帮助，因为他们的答案可能不适用于您的 Excel 版本。

例如，添加 BOM 字符会引入自动列分隔符识别问题，但并非每个 Excel 版本都会出现问题。

有 3 个变量决定它是否适用于大多数 Excel 版本：

*   编码
*   BOM 字符存在
*   电池分离器

SAP 的某个坚忍的人尝试了每一种组合并报告了结果。最终结果？使用带有 BOM 的 UTF16le 和制表符作为分隔符，让它在大多数 Excel 版本中工作。

你不相信我吗？我也不会，但在这里阅读并哭泣：[http ://wiki.sdn.sap.com/wiki/display/ABAP/CSV+tests+of+encoding+and+column+separator](http://wiki.sdn.sap.com/wiki/display/ABAP/CSV+tests+of+encoding+and+column+separator)

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2008-09-30T21:33:51.617

导入时选择 UTF-8 编码。如果您使用 Office 2007，这是您选择它的地方：在您打开文件之后。

[![](https://i.stack.imgur.com/y9b4A.jpg)](https://i.stack.imgur.com/y9b4A.jpg)

* * *

## 回答 #6

> 赞同：9
> 
> 时间：2011-03-30T16:26:55.417

在输出 CSV 数据之前回显 UTF-8 BOM。这修复了 Windows 中的所有字符问题，但不适用于 Mac。

```
echo "\xEF\xBB\xBF"; 
```

它对我有用，因为我需要生成一个仅在 Windows PC 上使用的文件。

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2012-02-18T00:03:28.023

UTF-8 在没有任何服务包的 Office 2007 中对我不起作用，无论有无 BOM（U+ffef 或 0xEF,0xBB,0xBF，均不起作用）安装 sp3 使 UTF-8 在 0xEF,0xBB,0xBF BOM 为前置。

UTF-16 在 python 中使用带有 0xff 0xef BOM 前缀的“utf-16-le”编码并使用制表符作为分隔符时有效。我必须手动写出 BOM，然后使用“utf-16-le”而不是“utf-16”，否则每个 encode() 都会将 BOM 附加到写出的每一行之前，这些行在第一列上显示为垃圾第二行及之后。

不知道 UTF-16 是否可以在没有安装任何 sp 的情况下工作，因为我现在不能回去。*叹*

这是在windows上，不知道MAC的office。

对于这两种工作情况，直接从浏览器启动下载时导入工作，并且文本导入向导不会干预，它的工作方式与您预期的一样。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2009-02-27T17:29:40.663

正如 Fregal 所说，\uFEFF 是要走的路。

```
<%@LANGUAGE="JAVASCRIPT" CODEPAGE="65001"%>
<%
Response.Clear();
Response.ContentType = "text/csv";
Response.Charset = "utf-8";
Response.AddHeader("Content-Disposition", "attachment; filename=excelTest.csv");
Response.Write("\uFEFF");
// csv text here
%> 
```

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2009-06-05T20:06:12.283

您可以保存扩展名为“xls”的 html 文件，并且重音符号可以使用（至少 2007 年之前）。

示例：将此（在记事本中使用另存为 utf8）另存为 test.xls：

```
<html>
<meta http-equiv="Content-Type" content="text/html" charset="utf-8" />
<table>
<tr>
  <th>id</th>
  <th>name</th>
</tr>
<tr>
 <td>4</td>
 <td>Hélène</td>
</tr>
</table>
</html> 
```

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2009-06-12T03:01:12.187

我还注意到这个问题前段时间得到了“回答”，但我不明白那些说如果不使用文本向导就无法在 Excel 中成功打开 utf8 编码的 csv 文件的故事。

我的可重现体验：`Old MacDonald had a farm,ÈÌÉÍØ`输入记事本，按 Enter，然后另存为（使用 UTF-8 选项）。

使用 Python 显示其中的实际内容：

```
>>> open('oldmac.csv', 'rb').read()
'\xef\xbb\xbfOld MacDonald had a farm,\xc3\x88\xc3\x8c\xc3\x89\xc3\x8d\xc3\x98\r\n'
>>> ^Z 
```

好的。记事本在前面放了一个BOM。

现在进入 Windows 资源管理器，双击文件名，或右键单击并使用“打开方式...”，然后弹出 Excel (2003) 并按预期显示。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-09-30T21:11:09.283

这只是字符编码的问题。看起来您正在将数据导出为 UTF-8：UTF-8 中的 é 是两字节序列 0xC3 0xA9，在 Windows-1252 中解释为 é。当您将数据导入 Excel 时，请确保告诉它您使用的字符编码是 UTF-8。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-09-30T21:30:01.077

CSV 格式在 Excel 中实现为 ASCII，而不是 unicode，因此会破坏变音符号。我们遇到了同样的问题，这就是我发现官方 CSV 标准在 Excel 中被定义为基于 ASCII 的方式。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2009-11-05T09:56:03.233

Excel 2007 正确读取带有 BOM (EF BB BF) 编码的 csv 的 UTF-8。

Excel 2003（可能更早）使用 BOM (FF FE) 读取 UTF-16LE，但使用制表符而不是逗号或分号。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2009-12-09T13:22:14.920

我只能让 CSV 在 Excel 2007 中正确解析为制表符分隔的 little-endian UTF-16，从正确的字节顺序标记开始。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2011-05-26T13:16:14.040

在 Django 中，将 BOM 写入输出 CSV 文件实际上对我有用：

```
def handlePersoonListExport(request):
    # Retrieve a query_set
    ...

    template = loader.get_template("export.csv")
    context = Context({
        'data': query_set,
    })

    response = HttpResponse()
    response['Content-Disposition'] = 'attachment; filename=export.csv'
    response['Content-Type'] = 'text/csv; charset=utf-8'
    response.write("\xEF\xBB\xBF")
    response.write(template.render(context))

    return response 
```

欲了解更多信息[http://crashcoursing.blogspot.com/2011/05/exporting-csv-with-special-characters.html](http://crashcoursing.blogspot.com/2011/05/exporting-csv-with-special-characters.html)谢谢大家！

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2011-10-19T15:44:32.823

我发现的另一个解决方案是将结果编码为 Windows 代码页 1252（Windows-1252 或 CP1252）。这可以通过例如`Content-Type`适当地设置为类似的东西`text/csv; charset=Windows-1252`并类似地设置响应流的字符编码来完成。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2012-07-20T04:26:02.163

请注意，包含 UTF-8 BOM 不一定是个好主意 - Mac 版本的 Excel 会忽略它，实际上会将 BOM 显示为 ASCII……电子表格第一个字段开头的三个讨厌的字符……</p>

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2008-09-30T21:12:25.613

检查您生成文件的编码，要使 excel 正确显示文件，您必须使用系统默认代码页。

您使用哪种语言？如果是 .Net，您只需要在生成文件时使用 Encoding.Default。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2011-10-14T08:29:31.890

使用 Ruby 1.8.7，我将每个字段编码为 UTF-16 并丢弃 BOM（也许）。

以下代码是从 active_scaffold_export 中提取的：

```
<%                                                                                                                                                                                                                                                                                                                           
      require 'fastercsv'                                                                                                                                                                                                                                                                                                        
      fcsv_options = {                                                                                                                                                                                                                                                                                                           
        :row_sep => "\n",                                                                                                                                                                                                                                                                                                        
        :col_sep => params[:delimiter],                                                                                                                                                                                                                                                                                          
        :force_quotes => @export_config.force_quotes,                                                                                                                                                                                                                                                                            
        :headers => @export_columns.collect { |column| format_export_column_header_name(column) }                                                                                                                                                                                                                                
      }                                                                                                                                                                                                                                                                                                                          

      data = FasterCSV.generate(fcsv_options) do |csv|                                                                                                                                                                                                                                                                           
        csv << fcsv_options[:headers] unless params[:skip_header] == 'true'                                                                                                                                                                                                                                                      
        @records.each do |record|                                                                                                                                                                                                                                                                                                
          csv << @export_columns.collect { |column|                                                                                                                                                                                                                                                                              
            # Convert to UTF-16 discarding the BOM, required for Excel (> 2003 ?)                                                                                                                                                                                                                                     
            Iconv.conv('UTF-16', 'UTF-8', get_export_column_value(record, column))[2..-1]                                                                                                                                                                                                                                        
          }                                                                                                                                                                                                                                                                                                                      
        end                                                                                                                                                                                                                                                                                                                      
      end                                                                                                                                                                                                                                                                                                                        
    -%><%= data -%> 
```

重要的一行是：

```
Iconv.conv('UTF-16', 'UTF-8', get_export_column_value(record, column))[2..-1] 
```

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2011-11-28T16:35:23.427

我找到了解决问题的方法。这是一个令人讨厌的 hack，但它有效：使用**Open Office**打开文档，然后将其保存为任何 excel 格式；结果`.xls`or`.xlsx`将显示重音字符。

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2011-12-13T11:06:04.090

如果您像我一样在 vb.net 中有旧代码，则以下代码对我有用：

```
 Response.Clear()
    Response.ClearHeaders()
    Response.ContentType = "text/csv"
    Response.Expires = 0
    Response.AddHeader("Content-Disposition", "attachment; filename=export.csv;")
    Using sw As StreamWriter = New StreamWriter(Context.Response.OutputStream, System.Text.Encoding.Unicode)
        sw.Write(csv)
        sw.Close()
    End Using
    Response.End() 
```

* * *

## 回答 #22

> 赞同：-2
> 
> 时间：2013-04-25T16:54:44.327

使用记事本++ clic 在编码上打开文件 csv，选择转换为 UTF-8（不转换为 UTF-8（不带 BOM））保存通过双击打开的 excel 希望对 Christophe GRISON 有所帮助

# java - 使 DocumentBuilder.parse 忽略 DTD 引用

> ID：155101
> 
> 赞同：86
> 
> 时间：2008-09-30T21:08:02.520
> 
> 标签：java, document, dtd

当我用这种方法解析我的 xml 文件（变量 f）时，我得到一个错误

> C:\Documents and Settings\joe\Desktop\aicpcudev\OnlineModule\map.dtd（系统找不到指定的路径）

我知道我没有 dtd，也不需要它。如何在忽略 DTD 引用错误的情况下将此 File 对象解析为 Document 对象？

```
private static Document getDoc(File f, String docId) throws Exception{
    DocumentBuilderFactory dbf = DocumentBuilderFactory.newInstance();
    DocumentBuilder db = dbf.newDocumentBuilder();
    Document doc = db.parse(f);

    return doc;
} 
```

* * *

## 回答 #1

> 赞同：144
> 
> 时间：2008-10-01T01:39:58.200

尝试在 DocumentBuilderFactory 上设置功能：

```
DocumentBuilderFactory dbf = DocumentBuilderFactory.newInstance();

dbf.setValidating(false);
dbf.setNamespaceAware(true);
dbf.setFeature("http://xml.org/sax/features/namespaces", false);
dbf.setFeature("http://xml.org/sax/features/validation", false);
dbf.setFeature("http://apache.org/xml/features/nonvalidating/load-dtd-grammar", false);
dbf.setFeature("http://apache.org/xml/features/nonvalidating/load-external-dtd", false);

DocumentBuilder db = dbf.newDocumentBuilder();
... 
```

最终，我认为这些选项是特定于解析器实现的。如果有帮助，[这里是 Xerces2 的一些文档。](http://xerces.apache.org/xerces2-j/features.html)

* * *

## 回答 #2

> 赞同：59
> 
> 时间：2008-09-30T22:19:26.357

[与@anjanb](https://stackoverflow.com/questions/155101/make-documentbuilderparse-ignore-dtd-references#155330)建议的方法类似

```
 builder.setEntityResolver(new EntityResolver() {
        @Override
        public InputSource resolveEntity(String publicId, String systemId)
                throws SAXException, IOException {
            if (systemId.contains("foo.dtd")) {
                return new InputSource(new StringReader(""));
            } else {
                return null;
            }
        }
    }); 
```

我发现简单地返回一个空的 InputSource 也一样有效？

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2011-04-28T13:34:04.757

我发现 DTD 文件与 XML 一起位于 jar 文件中的问题。我根据此处的示例解决了该问题，如下所示：-

```
DocumentBuilder db = dbf.newDocumentBuilder();
db.setEntityResolver(new EntityResolver() {
    public InputSource resolveEntity(String publicId, String systemId) throws SAXException, IOException {
        if (systemId.contains("doc.dtd")) {
             InputStream dtdStream = MyClass.class
                     .getResourceAsStream("/my/package/doc.dtd");
             return new InputSource(dtdStream);
         } else {
             return null;
         }
      }
}); 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2016-11-10T14:00:55.983

**源 XML（使用 DTD）**

```
<!DOCTYPE MYSERVICE SYSTEM "./MYSERVICE.DTD">
<MYACCSERVICE>
   <REQ_PAYLOAD>
      <ACCOUNT>1234567890</ACCOUNT>
      <BRANCH>001</BRANCH>
      <CURRENCY>USD</CURRENCY>
      <TRANS_REFERENCE>201611100000777</TRANS_REFERENCE>
   </REQ_PAYLOAD>
</MYACCSERVICE> 
```

用于接受上述 XML 作为字符串并删除 DTD 声明的 Java DOM 实现

```
public Document removeDTDFromXML(String payload) throws Exception {

    System.out.println("### Payload received in XMlDTDRemover: " + payload);

    Document doc = null;
    DocumentBuilderFactory dbf = DocumentBuilderFactory.newInstance();
    try {

        dbf.setValidating(false);
        dbf.setNamespaceAware(true);
        dbf.setFeature("http://xml.org/sax/features/namespaces", false);
        dbf.setFeature("http://xml.org/sax/features/validation", false);
        dbf.setFeature("http://apache.org/xml/features/nonvalidating/load-dtd-grammar", false);
        dbf.setFeature("http://apache.org/xml/features/nonvalidating/load-external-dtd", false);

        DocumentBuilder db = dbf.newDocumentBuilder();

        InputSource is = new InputSource();
        is.setCharacterStream(new StringReader(payload));
        doc = db.parse(is); 

    } catch (ParserConfigurationException e) {
        System.out.println("Parse Error: " + e.getMessage());
        return null;
    } catch (SAXException e) {
        System.out.println("SAX Error: " + e.getMessage());
        return null;
    } catch (IOException e) {
        System.out.println("IO Error: " + e.getMessage());
        return null;
    }
    return doc;

} 
```

**目标 XML（无 DTD）**

```
<MYACCSERVICE>
   <REQ_PAYLOAD>
      <ACCOUNT>1234567890</ACCOUNT>
      <BRANCH>001</BRANCH>
      <CURRENCY>USD</CURRENCY>
      <TRANS_REFERENCE>201611100000777</TRANS_REFERENCE>
   </REQ_PAYLOAD>
</MYACCSERVICE> 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-30T21:13:44.033

> 我知道我没有 dtd，也不需要它。

我对这种说法表示怀疑；您的文档是否包含任何实体引用？如果是这样，您肯定需要DTD。

无论如何，防止这种情况发生的常用方法是使用 XML 目录为“map.dtd”定义本地路径。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-30T22:11:49.480

这是另一个遇到同样问题的用户：[http://forums.sun.com/thread.jspa?threadID=284209&forumID=34](http://forums.sun.com/thread.jspa?threadID=284209&forumID=34)

该帖子上的用户 ddssot 说

```
myDocumentBuilder.setEntityResolver(new EntityResolver() {
          public InputSource resolveEntity(java.lang.String publicId, java.lang.String systemId)
                 throws SAXException, java.io.IOException
          {
            if (publicId.equals("--myDTDpublicID--"))
              // this deactivates the open office DTD
              return new InputSource(new ByteArrayInputStream("<?xml version='1.0' encoding='UTF-8'?>".getBytes()));
            else return null;
          }
}); 
```

用户进一步提到“如您所见，当解析器命中 DTD 时，将调用实体解析器。我通过其特定 ID 识别出我的 DTD，并返回一个空 XML 文档而不是真正的 DTD，停止所有验证......”

希望这可以帮助。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2020-02-05T16:04:38.527

我正在使用 sonarqube，并且 eclipse 的 sonarlint 向我展示了**不受信任的 XML 应该在不解析外部数据的情况下进行解析（squid：S2755）**

我设法使用以下方法解决了它：

```
 factory = DocumentBuilderFactory.newInstance();

    factory.setFeature("http://apache.org/xml/features/disallow-doctype-decl", true);

    // If you can't completely disable DTDs, then at least do the following:
    // Xerces 1 - http://xerces.apache.org/xerces-j/features.html#external-general-entities
    // Xerces 2 - http://xerces.apache.org/xerces2-j/features.html#external-general-entities
    // JDK7+ - http://xml.org/sax/features/external-general-entities
    factory.setFeature("http://xml.org/sax/features/external-general-entities", false);

    // Xerces 1 - http://xerces.apache.org/xerces-j/features.html#external-parameter-entities
    // Xerces 2 - http://xerces.apache.org/xerces2-j/features.html#external-parameter-entities
    // JDK7+ - http://xml.org/sax/features/external-parameter-entities
    factory.setFeature("http://xml.org/sax/features/external-parameter-entities", false);

    // Disable external DTDs as well
    factory.setFeature("http://apache.org/xml/features/nonvalidating/load-external-dtd", false);

    // and these as well, per Timothy Morgan's 2014 paper: "XML Schema, DTD, and Entity Attacks"
    factory.setXIncludeAware(false);
    factory.setExpandEntityReferences(false); 
```

# c# - 为什么没有正确找到我的 App_Code 文件夹中子文件夹中的类？

> ID：155105
> 
> 赞同：7
> 
> 时间：2008-09-30T21:09:11.283
> 
> 标签：c#, asp.net, namespaces, app-code

将类文件放入 App_Code 文件夹的子文件夹时出现以下错误：

errorCS0246：找不到类型或命名空间名称“MyClassName”（您是否缺少 using 指令或程序集引用？）

这个类根本不在命名空间中。有任何想法吗？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-09-30T21:22:47.773

您需要将 codeSubDirectories 添加到 web.config 中的编译元素

```
<configuration>
    <system.web>
      <compilation>
         <codeSubDirectories>
           <add directoryName="View"/>
         </codeSubDirectories>
      </compilation>
   </system.web>
</configuration> 
```

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2011-08-16T18:11:12.350

检查文件的 BuildAction 属性。这应该设置为“编译”

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-30T21:11:28.237

您是否可能没有将文件夹设置为 IIS（或您的 Web 服务器）中的应用程序？如果不是，则使用的 App_Code 是来自*父*文件夹（或下一个应用程序向上）的 App_Code。

确保该文件夹被标记为应用程序，并使用正确的 ASP.NET 版本。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-11-08T07:57:39.217

这可能不是正确的方法，但我发现它最简单。

像往常一样在主文件夹中创建类，然后用鼠标将其移动到子文件夹。重新编译，一切都应该没问题。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-30T21:21:41.863

当您将文件夹添加到您的 app_code 时，如果我没记错的话，它们会被不同的命名空间分隔，使用默认命名空间作为根，然后为每个文件夹添加。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-07-13T22:57:25.937

在 Visual Studio（至少 2010 年，但我也记得过去的版本）中，您可以在解决方案资源管理器中右键单击文件夹，然后选择“包含在项目中”。

然后在每个文件的属性选项卡上（或一次选择所有文件），为“构建操作”属性选择“编译”。

这对我有用。

# emulation - What's a good source to learn about QEMU?

> ID：155109
> 
> 赞同：29
> 
> 时间：2008-09-30T21:10:32.107
> 
> 标签：emulation, processor, qemu

What book or website would you recommend to learn about QEMU? I'd like to see some usage examples as well as how to use the APIs.

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2008-10-02T06:39:53.057

**最佳资源：**

*   [主要 QEMU 使用文档](http://wiki.qemu.org/Manual)
*   [Qemu Man Page](http://manpages.ubuntu.com/manpages/lucid/man1/qemu.1.html) - 使用 qemu 时的宝贵资源。
*   [快速入门指南](http://ubuntu-tutorials.com/2007/07/04/setting-up-qemu-kqemu-on-ubuntu-704-feisty/)- 略微特定于 ubuntu/debian。涵盖 KVM。
*   [Qemu 网络指南](http://www.h7.dion.ne.jp/%7Eqemu-win/HowToNetwork-en.html)- 很棒的资源，超级有用。

玩得开心 qemu 是一个很棒的工具。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2012-09-19T10:20:57.237

一些额外的资源来理解和开始使用源代码：

*   [http://vmsplice.net/~stefan/qemu-code-overview.pdf](http://vmsplice.net/~stefan/qemu-code-overview.pdf)
*   [https://wiki.aalto.fi/download/attachments/41747647/qemu.pdf](https://wiki.aalto.fi/download/attachments/41747647/qemu.pdf)
*   [https://www.usenix.org/legacy/event/usenix05/tech/freenix/full_papers/bellard/bellard.pdf](https://www.usenix.org/legacy/event/usenix05/tech/freenix/full_papers/bellard/bellard.pdf)
*   [http://www.ece.cmu.edu/~ee349/f-2012/lab2/qemu.pdf](http://www.ece.cmu.edu/~ee349/f-2012/lab2/qemu.pdf)
*   [http://events.linuxfoundation.org/sites/events/files/slides/cloudopen-liguori.pdf](http://events.linuxfoundation.org/sites/events/files/slides/cloudopen-liguori.pdf)

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2016-08-01T13:21:07.003

**详细技术资料：**

*   [http://www.csd.uoc.gr/~hy428/reading/qemu-internals-slides-may6-2014.pdf](http://www.csd.uoc.gr/~hy428/reading/qemu-internals-slides-may6-2014.pdf)
*   [http://lists.gnu.org/archive/html/qemu-devel/2011-04/pdfhC5rVdz7U8.pdf](http://lists.gnu.org/archive/html/qemu-devel/2011-04/pdfhC5rVdz7U8.pdf)
    我找不到其他章节
*   [http://connect.ed-diamond.com/GNU-Linux-Magazine/GLMF-147/Qemu-Visite-au-caeur-de-l-emulateur](http://connect.ed-diamond.com/GNU-Linux-Magazine/GLMF-147/Qemu-Visite-au-caeur-de-l-emulateur)（不幸的是只有法语）

# background - 开发 c# 长时间运行的处理器应用程序的最佳方法

> ID：155116
> 
> 赞同：2
> 
> 时间：2008-09-30T21:12:44.833
> 
> 标签：background, long-integer, task, worker, runner

我有几个不同的 c# worker 应用程序，它们运行各种连续任务：从队列发送电子邮件、将新订单从网站数据库导入订单数据库、进行数据库备份和恢复、为 OLTP -> OLAP 运行数据处理以及其他相关任务。之前，我将它们作为 Windows 服务发布，但目前我将它们作为常规控制台应用程序发布。它们都基于我创建的通用任务运行程序框架，对此我很满意，但是我不确定部署这些类型的应用程序的最佳方式是什么。我喜欢控制台版本，因为它快速简单，并且可以快速查看程序活动和输出。缺点是工作计算机有几个控制台屏幕正在运行并且变得混乱。另一方面，服务方法似乎需要很长时间才能部署，我必须通过事件日志来查看消息。对此有何经验/意见？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-30T21:16:21.190

我喜欢控制台应用程序方法。我通常会设置一些东西，所以我可以传递一个像 -unattended 这样的开关来抑制控制台屏幕。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-30T21:19:20.153

Windows Service 会是一个不错的选择，无论你是否关闭当前会话，它都会在后台运行，你也可以将它配置为在服务器上执行补丁更新时在 Windows 重新启动后自动启动。您可以将重要消息记录到事件查看器或数据库表中。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-30T21:25:20.263

对于这样的事情，标准的做法是使用 Windows 服务。您希望该服务在网络帐户上运行，因此它不需要登录用户。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-30T21:29:44.793

几年前，我从事过类似问题的工作。从逻辑上讲，我需要一项服务，但有时我需要查看正在发生的事情，通常我想要一个历史记录。所以我开发了一个服务来完成这项工作，只要它想记录，它就会调用它的订阅者（实现为观察者模式）。

该服务注册了它自己的数据记录器（写入数据库），并且在运行时，用户可以运行一个 GUI，该 GUI 使用远程处理连接到服务，成为一个实时监听器！

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-30T21:30:45.100

我将投票支持 Windows 服务。管理这些控制台应用程序将变得非常痛苦。

Windows 服务部署很简单：初始安装后，您只需将其关闭并执行 XCOPY。无需运行任何复杂的安装程序。第一次只是半复杂的，即使那样也只是

```
installutil MyApp.exe 
```

将服务配置为在域帐户下运行，以获得最佳安全性和与其他计算机的最简单互操作。

使用事件日志（带有错误、警告和信息）的组合来获取重要通知，并将详细日志记录转储到文本文件中。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2011-11-03T18:23:36.810

为什么不获得世界上最好的并使用类似的东西：
[http ://topshelf-project.com/](http://topshelf-project.com/)

它将允许您将程序作为命令行或 Windows 服务运行。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-20T20:44:34.963

我不确定这是否适用于您的应用程序，但是当我有一些不依赖于用户输入的控制台应用程序或者它们只是完成工作并退出的应用程序时，我会在虚拟机上运行此类程序服务器，这样我在工作时不会看到弹出屏幕，并且虚拟服务器很容易创建和重新启动。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-05-05T19:37:35.863

我们经常使用 Windows 服务作为后台进程。我不喜欢命令行应用程序，因为您需要登录到服务器才能运行它们。服务一直在后台运行（假设它们是自动启动的）。使用 Windows 中的 sc.exe 命令行工具安装它们也很简单。我比 installutil.exe 的膨胀软件更喜欢它。当然 installutil 做的更多，但我不需要它做什么。我只想注册我的服务。

我们还创建了一个基础架构，其中我们有一个通用服务 .exe，它根据接口定义加载 .DLL，因此添加一个新的“服务”就像放入一个新的 DLL 并重新启动服务主机一样简单。

然而，我们开始远离服务。我们遇到的问题是它们锁定了 DLL（出于显而易见的原因），因此升级它们很痛苦。我们需要停止、升级然后重新启动。不难，但需要额外的步骤。相反，我们正在运行我们需要完成的实际后台作业的 asp.net 应用程序中的特殊“页面”。仍然有一项服务，但它所做的只是调用 asp.net 页面，因此它不会锁定我们的任何 DLL。然后我们可以替换 asp.net bin 目录中的 DLL 和正常的 asp.net 规则，以重新启动应用程序域。

# .net - IE hosted .net user control using an unmanaged dll

> ID：155125
> 
> 赞同：1
> 
> 时间：2008-09-30T21:15:17.697
> 
> 标签：.net, internet-explorer

What's a good way for an IE hosted .net user control (e.g., < object classid="myctrl.dll#init">) to pull down an unmanaged dll for it to use?

For Click-once, this is easy with a manifest, but ie hosted controls don't get installed in the click-once app cache and instead run out of the download cache. Copy the dll there? Or into the temp directory?

Added: I'm fine with full trust. The reason for using .net is the better security model over active-x (more kinds of evidence)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-30T23:02:15.770

如果可以做到这一点，我会感到惊讶，因为这将是一个巨大的安全漏洞。本机代码只能在完全信任的情况下运行，因此加载新的本机 COM 对象需要对对象进行签名，下载它的 CAB 也进行签名，并且类（一旦注册）适当注册 - 并且用户得到适当的警告，以确保他们只运行他们信任的控件和组件。

允许 .NET 代码规避其中一些规则，因为它经过验证、在虚拟机下运行并被沙盒化。

# asp.net - Filter ASP.NET web application's files when deploying

> ID：155134
> 
> 赞同：1
> 
> 时间：2008-09-30T21:17:35.883
> 
> 标签：asp.net, deployment

I want to deploy my web application (asp.net mvc), and I need to remove all the codebehind files from my project.

Any scripts that you guys know of to do this?

I prefer using a script since I can tweak it if need be.

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-30T21:21:01.117

只需在您的项目中选择发布网站选项，它应该会处理好（如果您使用 vs）。

菜单建立/发布网站

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-30T21:25:08.283

在 Visual Sudio 中，右键单击您的项目并在出现的对话框中选择发布...，选择“仅需要的文件，以运行此应用程序”。

发布向导会将所有代码隐藏文件编译到您的程序集中并删除它们以进行发布。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-11T17:54:59.763

首先，不建议将代码隐藏文件用于 ASP.NET MVC。Codebehind 是 ASP.NET 标准文件的控制器 - 但在 ASP.NET MVC 中，您拥有更强大的控制器。

其次，为什么需要删除代码隐藏文件？IIS / MVC / Web.config 应该注意确保 *.cs 等文件不会得到服务并导致 404。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-30T21:40:56.620

我建议使用 Web 部署项目。这将编译您的网站并将部署所需的所有文件复制到一个新文件夹中（没有代码隐藏文件，因为它们不需要部署）。您还可以通过这种方式获得更多控制权，因为您可以设置预构建和构建后事件。

例如，我在 web 部署项目上设置了一个构建后事件来执行一个批处理文件，该文件将一些文件复制到 Debug/Release 文件夹中，然后将其压缩，准备好通过 FTP 传输到生产服务器。

# c# - 如何在 .net 应用程序中共享应用程序配置？

> ID：155144
> 
> 赞同：8
> 
> 时间：2008-09-30T21:21:44.123
> 
> 标签：c#, .net, app-config

我有一个相对较大的.Net 系统，其中包含许多不同的应用程序。我不想拥有许多不同的 app.config 文件，而是希望在所有应用程序之间共享一个配置文件。

我还想在我的机器上开发一个版本，一个版本供其他人在他们的机器上开发，一个版本用于测试系统，一个版本用于实时系统。

有没有一种简单的方法可以做到这一点？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-30T21:43:44.883

对于多个应用程序需要的大量配置，我会将这些配置放入一个中央存储库，例如一个数据库，一个公共位置的文件。

要为不同的环境使用不同版本的配置文件，请为每个不同的环境创建一个构建配置和一个以环境命名的配置文件，例如：

生产 production.app.config 测试 test.app.config

然后，您可以使用预构建事件将正确的配置复制到项目中的默认 app.config 上。然后，这将照常复制到您的输出目录。

预构建事件看起来与上面类似，只需使用 $(Configuration) 为您想要的环境获取适当的文件。

您可以将其与上述内容结合起来，将整个构建特定的配置文件复制到每个项目中。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-30T21:28:31.143

您可以在“子”项目上使用构建后事件（属性 -> 构建事件）将配置文件从主项目复制到其他项目，如下所示：

```
copy /Y c:\path\to\master\project\app.config $(TargetPath).config
exit 0 
```

（最后一行的“exit 0”可防止构建错误）。

要为不同的构建目标（“RELEASE”、“DEBUG”等）拥有单独的配置文件，您可以在 NOTEPAD.EXE 中编辑 .csproj 文件（或 .vbproj）为每个目标组添加 AppConfig 标签，例如这：

```
 <PropertyGroup Condition=" '$(Configuration)|$(Platform)' == 'Debug|AnyCPU' ">
    <DebugSymbols>true</DebugSymbols>
    <DebugType>full</DebugType>
    <Optimize>false</Optimize>
    <OutputPath>.\bin\Debug\</OutputPath>
    <DefineConstants>DEBUG;TRACE</DefineConstants>
    <AppConfig>debug.app.config</AppConfig>
  </PropertyGroup>
  <PropertyGroup Condition=" '$(Configuration)|$(Platform)' == 'Release|AnyCPU' ">
    <DebugSymbols>true</DebugSymbols>
    <DebugType>full</DebugType>
    <Optimize>false</Optimize>
    <OutputPath>.\bin\Devel\</OutputPath>
    <DefineConstants>TRACE</DefineConstants>
    <AppConfig>release.app.config</AppConfig>
  </PropertyGroup> 
```

请注意每个组中出现的新**<AppConfig>**标记。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-30T22:58:22.660

您可以向元素添加一个属性，告诉它从不同的文件加载该数据，而不是将`<add>`元素添加到配置文件的部分。然后，您可以将常用设置保存在该常用文件中。`<appSettings>``file=``<appSettings>`

请参阅MSDN 库中的[appSettings 元素（常规设置架构）](http://msdn.microsoft.com/en-us/library/ms228154.aspx)。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-24T21:48:39.203

可以使用[NTFS 符号链接](http://en.wikipedia.org/wiki/NTFS_symbolic_link)来共享 .NET .config 文件。我已经在一个由 ASP.NET 应用程序、控制台应用程序等组成的解决方案中成功地使用了它。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-01T08:42:25.610

您还可以将配置设置放入 machine.config 以在多个应用程序之间共享它们。但是，这使部署更加成问题。

# php - 嵌套下拉

> ID：155152
> 
> 赞同：2
> 
> 时间：2008-09-30T21:23:20.657
> 
> 标签：php, mysql, html, forms

我正在用 php/mysql 构建一个表单。我有一张包含位置和子位置列表的表格。每个子位置都有一个父位置。列“parentid”引用同一个表中的另一个 locationid。我现在想通过以下方式将这些值加载到下拉列表中：

```
--Location 1
----Sublocation 1
----Sublocation 2
----Sublocation 3
--Location 2
----Sublocation 4
----Sublocation 5 
```

等等等等

有没有人为此得到一个优雅的解决方案？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-30T21:26:21.150

您在寻找类似[OPTGROUP](http://www.w3schools.com/TAGS/tag_optgroup.asp)标签的东西吗？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-30T21:37:23.417

注意：这只是伪代码。我没有尝试运行它，但您应该能够根据需要调整概念。

```
$parentsql = "SELECT parentid, parentname FROM table";

 $result = mysql_query($parentsql);
 print "<select>";
 while($row = mysql_fetch_assoc($result)){
    $childsql = "SELECT childID, childName from table where parentid=".$row["parentID"];
    $result2 = mysql_query($childsql);
    print "<optgroup label=\".$row["parentname"]."\">";
    while($row2 = mysql_fetch_assoc($result)){
        print "<option value=\"".$row["childID"]."\">".$row["childName"]."</option>\n";
    }
    print "</optgroup>";
}
 print "</select>"; 
```

考虑到 BaileyP 的有效批评，以下是如何在没有在每个循环中调用多个查询的开销的情况下做到这一点：

```
$sql = "SELECT childId, childName, parentId, parentName FROM child LEFT JOIN parent ON child.parentId = parent.parentId ORDER BY parentID, childName";  
$result = mysql_query($sql);
$currentParent = "";

print "<select>";
while($row = mysql_fetch_assoc($result)){
    if($currentParent != $row["parentID"]){
        if($currentParent != ""){
            print "</optgroup>";
        }
        print "<optgroup label=\".$row["parentName"]."\">";
        $currentParent = $row["parentName"];
    }

    print "<option value=\"".$row["childID"]."\">".$row["childName"]."</option>\n";
}
print "</optgroup>"
print "</select>"; 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-30T21:30:09.020

optgroup 绝对是要走的路。其实就是为了这个

例如用法，查看[http://www.grandhall.eu/tips/submit/](http://www.grandhall.eu/tips/submit/)的源代码- “Grandhall Grill Used”下的选择器。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-30T21:30:19.690

您可以在实际 HTML 中使用空格/破折号缩进。不过，您需要一个 recusive 循环来构建它。就像是：

```
<?php

$data = array(
    'Location 1'    =>    array(
        'Sublocation1',
        'Sublocation2',
        'Sublocation3'    =>    array(
            'SubSublocation1',
        ),
    'Location2'
);

$output = '<select name="location">' . PHP_EOL;

function build_items($input, $output)
{
    if(is_array($input))
    {
        $output .= '<optgroup>' . $key . '</optgroup>' . PHP_EOL;
        foreach($input as $key => $value)
        {
            $output = build_items($value, $output);
        }
    }
    else
    {
        $output .= '<option>' . $value . '</option>' . PHP_EOL;
    }

    return $output;
}

$output = build_items($data, $output);

$output .= '</select>' . PHP_EOL;

?> 
```

或类似的东西;）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-30T23:10:22.040

理想情况下，您应该从数据库中以正确的顺序选择所有这些数据，然后循环输出。这是我对您所要求的内容的看法

```
<?php
/*
Assuming data that looks like this

locations
+----+-----------+-------+
| id | parent_id | descr |
+----+-----------+-------+
|  1 |      null | Foo   |
|  2 |      null | Bar   |
|  3 |         1 | Doe   |
|  4 |         2 | Rae   |
|  5 |         1 | Mi    |
|  6 |         2 | Fa    |
+----+-----------+-------+
*/

$result = mysql_query( "SELECT id, parent_id, descr FROM locations order by coalesce(id, parent_id), descr" );

echo "<select>";
while ( $row = mysql_fetch_object( $result ) )
{
    $optionName = htmlspecialchars( ( is_null( $row->parent_id ) ) ? "--{$row->descr}" : "----{$row->desc}r", ENT_COMPAT, 'UTF-8' );
    echo "<option value=\"{$row->id}\">$optionName</option>";
}
echo "</select>"; 
```

如果您不喜欢该`coalesce()`功能的使用，可以在此表中添加一个“display_order”列，您可以手动设置，然后用于`ORDER BY`.

# c# - .NET 中的嵌入式 Web 服务器

> ID：155161
> 
> 赞同：9
> 
> 时间：2008-09-30T21:27:26.840
> 
> 标签：c#, .net, php, webserver

我想在一个用 .NET 开发的 Windows 应用程序中嵌入一个轻量级的 Web 服务器。Web 服务器必须支持 PHP。

我看过 Cassini，但它似乎只是 ASP.NET。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-09-30T21:38:17.127

.net 类 HttpListener 公开了构建 IIS 的基础 http.sys。Windows XP2 以后的所有机器都默认安装了 http.sys。这里有一些链接可以帮助您入门。

[使用 HTTPLISTENER 的 XML-RPC 服务器](http://www.cookcomputing.com/blog/archives/000572.html)

[傻瓜的HttpListener](http://bartdesmet.net/blogs/bart/archive/2007/02/22/httplistener-for-dummies-a-simple-http-request-reflector.aspx)

至于 PHP 支持，我不知道您将如何启用它，但没有技术原因您无法构建它。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-30T21:46:11.210

我会看看[XAMPP Lite](http://www.apachefriends.org/en/xampp-windows.html)之类的东西，你可以用你的应用程序轻松地启动和关闭它。

还有声称正是您正在寻找的[AppWeb 。](http://www.appwebserver.org)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-30T21:54:44.077

您始终可以将 PHP 用作 CGI 应用程序。CGI 有据可查，AFAIK 很容易实现。使用 Darrel Millers 的建议，再加上一些 CGI 魔术，你应该用煤气做饭。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2014-02-14T21:20:51.020

Mongoose 嵌入式网络服务器 [https://code.google.com/p/mongoose/](https://code.google.com/p/mongoose/)

您可以使用 VS2012/10/08 作为 EXE 构建它，您可以使用 PHP 和 websockets 将数据推送到客户端应用程序。您还可以构建一个 DLL，您可以使用 make 或将代码引入 VS DLL 项目并构建一个 _DLLMain、DEF 文件等。然后直接从 C# 使用它 - 请参阅 mongoose.cs 和 example.cs 文件。

# sql-server - sqlserver rake db 的连接错误：迁移

> ID：155164
> 
> 赞同：2
> 
> 时间：2008-09-30T21:27:52.363
> 
> 标签：sql-server, ruby-on-rails, ruby

我收到以下错误：

```
Open
OLE error code:80004005 in Microsoft OLE DB Provider for SQL Server
[DBNETLIB][ConnectionOpen (Connect()).]SQL Server does not exist or access denied.
HRESULT error code:0×80020009
Exception occurred. 
```

我尝试按照[这里](http://wiki.rubyonrails.org/rails/pages/HowtoConnectToMicrosoftSQLServer)的指示进行操作，但没有成功。

有任何想法吗？

***固定的***

我认为我的具体问题与我的笔记本电脑上安装了许多混合系统有关。我有 Visual Studio 2005 和 2008 组件以及装有 SQL Server Express Edition 的 SQL Server Management Standard 以及可能影响我的环境稳定性的各种其他组件。一旦我重新加载 Vista 并[从上面的链接](http://wiki.rubyonrails.org/rails/pages/HowtoConnectToMicrosoftSQLServer)返回步骤，它就可以正常工作。

我只加载了 SQL Server 和 SQL Server Management Studio 的 Express Edition。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-30T21:39:12.070

通常是身份验证/权限错误。

SQL Server 是否与 Web 服务器在同一个盒子上，查看它们运行的​​帐户，并查看您正在建立的连接类型（集成或其他）？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-01T00:39:05.867

随机猜测：默认情况下，SQL Server（至少是express）不启用网络访问。SQL Admin manager 工具使用命名管道连接到它，但是 rails 很可能会尝试使用 TCP。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-25T20:06:13.330

我认为我的具体问题与我的笔记本电脑上安装了许多混合系统有关。我的 Visual Studio 2005 和 2008 组件和 SQL Server 管理标准加载了 SQL Server Express Edition 以及可能影响我的环境稳定性的各种其他组件。一旦我重新加载 Vista 并返回[http://wiki.rubyonrails.org/rails/pages/HowtoConnectToMicrosoftSQLServer](http://wiki.rubyonrails.org/rails/pages/HowtoConnectToMicrosoftSQLServer)上的步骤，它就可以正常工作。

我只加载了 SQL Server 和 SQL Server Management Studio 的 Express Edition

# silverlight - 设置 Silverlight Listbox 的背景颜色

> ID：155168
> 
> 赞同：0
> 
> 时间：2008-09-30T21:28:42.050
> 
> 标签：silverlight

如何设置列表框的背景颜色？我有一个带有文本块的列表框，但似乎并没有实际用于设置这些控件的背景颜色，为什么这看起来这么难？

为了充分披露，我之前问过一个类似的[问题](https://stackoverflow.com/questions/152376/dynamically-setting-background-colour-of-a-silverlight-control-listbox#152502)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-30T22:37:58.030

您可以使用 ListBox.ItemContainerStyle 属性执行此操作。[可以在这里](http://blogs.msdn.com/delay/archive/2008/03/05/lb-sv-faq-examples-notes-tips-and-more-for-silverlight-2-beta-1-s-listbox-and-scrollviewer-controls.aspx)找到很好的解释。基于该示例，我们可以将 ItemContainterStyle 设置为具有透明背景色，然后将 ListBox 包装在 Border 中（ListBox 不显示其背景色）。

```
<Border Background="Green">
<ListBox Background="Red">
  <ListBox.ItemContainerStyle>
      <Style TargetType="ListBoxItem">
          <Setter Property="Background" Value="Transparent"/>
      </Style>
  </ListBox.ItemContainerStyle>
    <TextBlock Text="Hello" />
    <TextBlock Text="Goodbye" />
  </ListBox>
</Border> 
```

如果您只想设置实际项目，您可以将背景设置为实际颜色，然后跳过边框。

# objective-c - 处理通过 NSObject 的 performSelectorOnMainThread:withObject:waitUntilDone 调用的方法期间引发的异常：

> ID：155171
> 
> 赞同：4
> 
> 时间：2008-09-30T21:29:52.140
> 
> 标签：objective-c, cocoa, macos, exception

`myMethod:`如果通过 NSObject 调用in 时引发的异常会发生什么`performSelectorOnMainThread:withObject:waitUntilDone:`？

特别是，我可以在这样的调用范围内捕获它们`performSelectorOnMainThread`吗...

```
@try {
    [self performSelectorOnMainThread:@selector(myMethod) withObject:nil waitUntilDone:YES];
} @catch(NSException *e) {
    //deal with exception raised in myMethod here??
} 
```

我意识到如果 waitUntilDone 是 ，它的语义很奇怪`NO`。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-30T23:52:12.750

你将无法像那样抓住它们。Cocoa 可以捕获异常并将其记录到控制台，但它不会在调用 -perform 的线程中重新引发它们。相反，您可以在 -myMethod: (或调用 -myMethod:) 的包装器中捕获它们，并将它们存储在其他线程可以读取它们的地方。

# asp.net - 我需要帮助从 asp.net 2.0 执行一个 bat 文件

> ID：155174
> 
> 赞同：2
> 
> 时间：2008-09-30T21:30:02.840
> 
> 标签：asp.net, vb.net, batch-file

我有一个使用 asp.net 2.0 和 vb.net 的 Web 应用程序，我编写了一个 bat 文件来使用 GPG 加密文件并将其称为 asp.net shell（路径名和文件名）。当我从 cmd windows 双击 bat 文件时，它工作正常，但是当我在应用程序中调用它时，我传递的所有命令都完美执行，除了 gpg 命令。我确保运行应用程序的用户具有运行我导入、信任和验证所有密钥的命令的所有权利和特权，事实上，双击它时 bat 文件工作正常，但为什么它确实成功执行了 GPG功能。它没有返回任何错误只是没有加密任何文件

gpg -e --always-trust -r <> 文件名

任何帮助将不胜感激。

谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-30T22:19:32.410

我有一个类似的问题：

[C#.Net：为什么我的 Process.Start() 挂起？](https://stackoverflow.com/questions/34183/cnet-why-is-my-processstart-hanging)

似乎微软以其无限的智慧阻止了批处理文件在 Windows Server 2003 中由 IIS 执行。Brenden Tompkins 在这里有一个解决方法：

[http://codebetter.com/blogs/brendan.tompkins/archive/2004/05/13/13484.aspx](http://codebetter.com/blogs/brendan.tompkins/archive/2004/05/13/13484.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-30T21:32:09.280

您是否尝试过完全限定批处理文件中 gpg 可执行文件的路径？

* * *

## 回答 #3

> 赞同：-2
> 
> 时间：2008-09-30T21:32:06.020

不知道你是如何使用'shell（）'但[Process.Start](http://msdn.microsoft.com/en-us/library/system.diagnostics.process.start.aspx?ppud=4)是要走的路。

# html - HTML 输入的理想用户反馈

> ID：155183
> 
> 赞同：0
> 
> 时间：2008-09-30T21:31:19.173
> 
> 标签：html, interface, usability, standards, w3c

让我们面对现实吧：编写正确的、符合标准的 HTML 是相当困难的。编写语义 HTML 更是如此，但我认为计算机不可能解决这个问题。

所以我的问题是，对于输入 HTML 的用户来说，“理想”的反馈是什么？它会是 W3C 验证器样式的错误列表以及相应的行号和列吗？它会是一个带注释的代码显示突出显示的行、错误的解释和可能的修复吗？一种拼写检查样式模式，您可以分别处理每个错误？它*不会*给他们任何错误信息吗？此外，告诉用户哪些类型的错误是一个好主意？（一些广泛的错误类别包括解析错误、嵌套错误（即在 ab 标签中放置 div）和格式错误。）

*   **Scottm：**好点；我也不喜欢 W3C 列出所有错误的方式。但是，仍然存在让用户适当地编辑有问题的 HTML 的问题。
*   **onebyone：**好的，所以[看一些截图](http://users.skynet.be/mgueury/mozilla/screenshot.html)，看起来 HTML Validator 有一个 W3C 错误列表，但结合了直接进入相关源代码段和扩展错误信息的能力，以及你不必这样做的事实滚动以从一个部分跳到另一个部分。看起来不错，但是普通的乔可以使用吗？

*编辑1：*作为澄清，这是关于接口，不一定是底层实现。但是，界面需要使用纯 HTML 和 JavaScript 是可行的（如果它只需要 HTML，则可用性加倍，但我认为在这种情况下你会被 W3C 卡住）。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-30T21:34:09.697

我一直认为语法高亮很棒。在 HTML 中，这也将非常有用，因为当开发人员可以看到标签被适当地着色时，他/她可以很容易地区分标签。

就我个人而言，我不喜欢 W3C 给你一大堆无聊问题的方式。代码本身的视觉帮助要好得多。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-30T21:51:29.343

Firefox“HTML 验证器”附加组件的输出非常好。它在一个大窗口中向您显示源，在一个小窗口中显示错误列表（小并不重要，因为您通常只关心第一个，因为您的目标是完全没有）。单击一个错误以突出显示，然后在第二个小窗口中显示扩展的解释，而代码的违规部分在大窗口中突出显示。

但是，该附加组件不包含文本编辑器，因此它不是您问题的完整解决方案。不过，它同时使用了基于 SGML 的验证器和 HTML Tidy，我认为对于本地文件，您可以使用它来进行 Tidy 建议的更正。

# javascript - 在文本框中的 Enter 键上使用 JavaScript 触发按钮单击

> ID：155188
> 
> 赞同：1377
> 
> 时间：2008-09-30T21:32:09.577
> 
> 标签：javascript, htmlbutton

我有一个文本输入和一个按钮（见下文）。当在文本框中按下键时，如何使用 JavaScript**触发按钮的单击事件？**`Enter`

我的当前页面上已经有一个不同的提交按钮，所以我不能简单地将按钮设置为提交按钮。而且，如果从这个文本框中按下该键，我*只*希望该`Enter`键单击该特定按钮，仅此而已。

```
<input type="text" id="txtSearch" />
<input type="button" id="btnSearch" value="Search" onclick="doSomething();" /> 
```

* * *

## 回答 #1

> 赞同：1489
> 
> 时间：2008-09-30T21:52:16.970

在 jQuery 中，以下将起作用：

```
$("#id_of_textbox").keyup(function(event) {
    if (event.keyCode === 13) {
        $("#id_of_button").click();
    }
}); 
```

```
$("#pw").keyup(function(event) {
    if (event.keyCode === 13) {
        $("#myButton").click();
    }
});

$("#myButton").click(function() {
  alert("Button code executed.");
});
```

```
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>

Username:<input id="username" type="text"><br>
Password:&nbsp;<input id="pw" type="password"><br>
<button id="myButton">Submit</button>
```

或者在纯 JavaScript 中，以下内容会起作用：

```
document.getElementById("id_of_textbox")
    .addEventListener("keyup", function(event) {
    event.preventDefault();
    if (event.keyCode === 13) {
        document.getElementById("id_of_button").click();
    }
}); 
```

```
document.getElementById("pw")
    .addEventListener("keyup", function(event) {
    event.preventDefault();
    if (event.keyCode === 13) {
        document.getElementById("myButton").click();
    }
});

function buttonCode()
{
  alert("Button code executed.");
}
```

```
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>

Username:<input id="username" type="text"><br>
Password:&nbsp;<input id="pw" type="password"><br>
<button id="myButton" onclick="buttonCode()">Submit</button>
```

* * *

## 回答 #2

> 赞同：422
> 
> 时间：2008-09-30T21:56:01.623

然后只需将其编码！

```
<input type = "text"
       id = "txtSearch" 
       onkeydown = "if (event.keyCode == 13)
                        document.getElementById('btnSearch').click()"    
/>

<input type = "button"
       id = "btnSearch"
       value = "Search"
       onclick = "doSomething();"
/> 
```

* * *

## 回答 #3

> 赞同：182
> 
> 时间：2008-09-30T21:52:28.653

想通了：

```
<input type="text" id="txtSearch" onkeypress="return searchKeyPress(event);" />
<input type="button" id="btnSearch" Value="Search" onclick="doSomething();" />

<script>
function searchKeyPress(e)
{
    // look for window.event in case event isn't passed in
    e = e || window.event;
    if (e.keyCode == 13)
    {
        document.getElementById('btnSearch').click();
        return false;
    }
    return true;
}
</script> 
```

* * *

## 回答 #4

> 赞同：85
> 
> 时间：2008-09-30T21:33:27.653

使按钮成为提交元素，因此它将是自动的。

```
<input type = "submit"
       id = "btnSearch"
       value = "Search"
       onclick = "return doSomething();"
/> 
```

请注意，您需要一个`<form>`包含输入字段的元素才能完成这项工作（感谢 Sergey Ilinsky）。

重新定义标准行为不是一个好习惯，`Enter`键应始终调用表单上的提交按钮。

* * *

## 回答 #5

> 赞同：77
> 
> 时间：2013-11-19T05:37:45.667

由于还没有人用过`addEventListener`，这里是我的版本。给定元素：

```
<input type = "text" id = "txt" />
<input type = "button" id = "go" /> 
```

我会使用以下内容：

```
var go = document.getElementById("go");
var txt = document.getElementById("txt");

txt.addEventListener("keypress", function(event) {
    event.preventDefault();
    if (event.keyCode == 13)
        go.click();
}); 
```

这允许您在保持 HTML 干净的同时单独更改事件类型和操作。

> **请注意**，确保这可能是值得的，`<form>`因为当我将这些元素包含在其中时，按 Enter 提交了表单并重新加载了页面。我眨了几眼才发现。
> 
> > **附录**：感谢@ruffin 的评论，我添加了缺少的事件处理程序和 a`preventDefault`以允许此代码（可能）也可以在表单中工作。（我将开始对此进行测试，此时我将删除括号中的内容。）

* * *

## 回答 #6

> 赞同：60
> 
> 时间：2011-02-08T04:49:52.833

在纯 JavaScript 中，

```
if (document.layers) {
  document.captureEvents(Event.KEYDOWN);
}

document.onkeydown = function (evt) {
  var keyCode = evt ? (evt.which ? evt.which : evt.keyCode) : event.keyCode;
  if (keyCode == 13) {
    // For Enter.
    // Your function here.
  }
  if (keyCode == 27) {
    // For Escape.
    // Your function here.
  } else {
    return true;
  }
}; 
```

我注意到回复只在 jQuery 中给出，所以我也想用纯 JavaScript 给出一些东西。

* * *

## 回答 #7

> 赞同：23
> 
> 时间：2013-09-12T19:27:56.980

您可以为此使用的一个基本技巧，我还没有看到完全提到。如果您想执行 ajax 操作，或在 Enter 上进行其他一些工作，但不想实际提交表单，您可以这样做：

```
<form onsubmit="Search();" action="javascript:void(0);">
    <input type="text" id="searchCriteria" placeholder="Search Criteria"/>
    <input type="button" onclick="Search();" value="Search" id="searchBtn"/>
</form> 
```

设置 action="javascript:void(0);" 像这样是本质上防止默认行为的捷径。在这种情况下，无论您是按 Enter 还是单击按钮，都会调用一个方法，然后调用 ajax 来加载一些数据。

* * *

## 回答 #8

> 赞同：18
> 
> 时间：2018-02-18T18:57:43.770

# `keypress`与`event.key === "Enter"`现代 JS 一起使用！

```
const textbox = document.getElementById("txtSearch");
textbox.addEventListener("keypress", function onEvent(event) {
    if (event.key === "Enter") {
        document.getElementById("btnSearch").click();
    }
}); 
```

[Mozilla 文档](https://developer.mozilla.org/en-US/docs/Web/API/KeyboardEvent/key)

[支持的浏览器](http://caniuse.com/#feat=keyboardevent-key)

* * *

## 回答 #9

> 赞同：16
> 
> 时间：2015-03-02T08:04:35.977

**尝试一下：**

```
<input type="text" id="txtSearch"/>
<input type="button" id="btnSearch" Value="Search"/>

<script>             
   window.onload = function() {
     document.getElementById('txtSearch').onkeypress = function searchKeyPress(event) {
        if (event.keyCode == 13) {
            document.getElementById('btnSearch').click();
        }
    };

    document.getElementById('btnSearch').onclick =doSomething;
}
</script> 
```

* * *

## 回答 #10

> 赞同：15
> 
> 时间：2011-10-27T03:35:04.000

要在每次按下 enter 键时触发搜索，请使用以下命令：

```
$(document).keypress(function(event) {
    var keycode = (event.keyCode ? event.keyCode : event.which);
    if (keycode == '13') {
        $('#btnSearch').click();
    }
} 
```

* * *

## 回答 #11

> 赞同：14
> 
> 时间：2008-09-30T21:56:26.240

```
onkeydown="javascript:if (event.which || event.keyCode){if ((event.which == 13) || (event.keyCode == 13)) {document.getElementById('btnSearch').click();}};" 
```

这只是我从最近的一个项目中得到的东西......我在网上找到了它，我不知道在普通的旧 JavaScript 中是否有更好的方法。

* * *

## 回答 #12

> 赞同：13
> 
> 时间：2008-10-01T09:51:32.090

虽然，我很确定只要表单中只有一个字段和一个提交按钮，即使页面上有另一个表单，按 Enter 键也应该提交表单。

然后，您可以使用 js 捕获表单 onsubmit 并执行您想要的任何验证或回调。

* * *

## 回答 #13

> 赞同：13
> 
> 时间：2013-08-29T14:01:38.417

这是所有**[YUI](http://yuilibrary.com/)**爱好者的解决方案：

```
Y.on('keydown', function() {
  if(event.keyCode == 13){
    Y.one("#id_of_button").simulate("click");
  }
}, '#id_of_textbox'); 
```

在这种特殊情况下，我使用 YUI 触发已注入按钮功能的 DOM 对象确实有更好的结果——但这是另一回事了……

* * *

## 回答 #14

> 赞同：12
> 
> 时间：2015-08-22T11:56:32.053

在**Angular2 中**：

```
(keyup.enter)="doSomething()" 
```

如果您不希望按钮中有一些视觉反馈，那么不引用按钮而是直接调用控制器是一个很好的设计。

此外，不需要 id - 另一种分离视图和模型的 NG2 方式。

* * *

## 回答 #15

> 赞同：11
> 
> 时间：2016-07-07T18:11:03.357

没有人注意到有一段时间可用的 html 属性“accesskey”。

这是一种没有 javascript 的键盘快捷键方式。

[![accesskey_browsers](https://i.stack.imgur.com/Yb7GA.png)](https://i.stack.imgur.com/Yb7GA.png)

[MDN 上的 accesskey 属性快捷方式](https://developer.mozilla.org/en-US/docs/Web/HTML/Global_attributes/accesskey)

打算这样使用。html 属性本身就足够了，但是我们可以根据浏览器和操作系统更改占位符或其他指示符。该脚本是一种未经测试的从头开始提供想法的方法。您可能想要使用浏览器库检测器，例如小[Bowser](https://github.com/ded/bowser)

```
let client = navigator.userAgent.toLowerCase(),
    isLinux = client.indexOf("linux") > -1,
    isWin = client.indexOf("windows") > -1,
    isMac = client.indexOf("apple") > -1,
    isFirefox = client.indexOf("firefox") > -1,
    isWebkit = client.indexOf("webkit") > -1,
    isOpera = client.indexOf("opera") > -1,
    input = document.getElementById('guestInput');

if(isFirefox) {
   input.setAttribute("placeholder", "ALT+SHIFT+Z");
} else if (isWin) {
   input.setAttribute("placeholder", "ALT+Z");
} else if (isMac) {
  input.setAttribute("placeholder", "CTRL+ALT+Z");
} else if (isOpera) {
  input.setAttribute("placeholder", "SHIFT+ESCAPE->Z");
} else {'Point me to operate...'}
```

```
<input type="text" id="guestInput" accesskey="z" placeholder="Acces shortcut:"></input>
```

* * *

## 回答 #16

> 赞同：11
> 
> 时间：2019-01-29T14:02:56.773

在现代，不推荐使用（没有`keyCode`or `onkeydown`）Javascript：

```
<input onkeypress="if(event.key == 'Enter') {console.log('Test')}"> 
```

* * *

## 回答 #17

> 赞同：10
> 
> 时间：2015-04-02T09:37:26.893

如果您还想禁用 Posting to server 中的 enter 按钮并执行 Js 脚本。

```
<input type="text" id="txtSearch" onkeydown="if (event.keyCode == 13)
 {document.getElementById('btnSearch').click(); return false;}"/>
<input type="button" id="btnSearch" value="Search" onclick="doSomething();" /> 
```

* * *

## 回答 #18

> 赞同：9
> 
> 时间：2010-05-08T19:48:51.707

这个**[onchange](https://developer.mozilla.org/en/DOM/element.onchange)**尝试很接近，但是对于浏览器的行为不正常（在 Safari 4.0.5 和 Firefox 3.6.3 上），所以最终，我不会推荐它。

```
<input type="text" id="txtSearch" onchange="doSomething();" />
<input type="button" id="btnSearch" value="Search" onclick="doSomething();" /> 
```

* * *

## 回答 #19

> 赞同：8
> 
> 时间：2010-04-22T13:53:26.433

```
event.returnValue = false 
```

在处理事件时或在事件处理程序调用的函数中使用它。

它至少可以在 Internet Explorer 和 Opera 中运行。

* * *

## 回答 #20

> 赞同：8
> 
> 时间：2012-05-16T20:44:52.330

对于 jQuery mobile，我必须这样做：

```
$('#id_of_textbox').live("keyup", function(event) {
    if(event.keyCode == '13'){
    $('#id_of_button').click();
    }
}); 
```

* * *

## 回答 #21

> 赞同：8
> 
> 时间：2015-12-23T18:51:22.987

要添加一个完全简单的 JavaScript 解决方案来解决[@icedwater 的表单提交问题](https://stackoverflow.com/revisions/20064004/2)，这里有一个完整的解决*方案`form`*。

> **注意：**这适用于“现代浏览器”，包括 IE9+。IE8 版本并没有那么复杂，可以在[这里学习](https://stackoverflow.com/a/21814964/1028230)。

* * *

小提琴：[https ://jsfiddle.net/rufwork/gm6h25th/1/](https://jsfiddle.net/rufwork/gm6h25th/1/)

### HTML

```
<body>
    <form>
        <input type="text" id="txt" />
        <input type="button" id="go" value="Click Me!" />
        <div id="outige"></div>
    </form>
</body> 
```

### JavaScript

```
// The document.addEventListener replicates $(document).ready() for
// modern browsers (including IE9+), and is slightly more robust than `onload`.
// More here: https://stackoverflow.com/a/21814964/1028230
document.addEventListener("DOMContentLoaded", function() {
    var go = document.getElementById("go"),
        txt = document.getElementById("txt"),
        outige = document.getElementById("outige");

    // Note that jQuery handles "empty" selections "for free".
    // Since we're plain JavaScripting it, we need to make sure this DOM exists first.
    if (txt && go)    {
        txt.addEventListener("keypress", function (e) {
            if (event.keyCode === 13)   {
                go.click();
                e.preventDefault(); // <<< Most important missing piece from icedwater
            }
        });

        go.addEventListener("click", function () {
            if (outige) {
                outige.innerHTML += "Clicked!<br />";
            }
        });
    }
}); 
```

* * *

## 回答 #22

> 赞同：8
> 
> 时间：2020-06-25T14:46:21.797

# 短工作纯 JS

```
txtSearch.onkeydown= e => (e.key=="Enter") ? btnSearch.click() : 1 
```

```
txtSearch.onkeydown= e => (e.key=="Enter") ? btnSearch.click() : 1

function doSomething() {
  console.log('');
}
```

```
<input type="text" id="txtSearch" />
<input type="button" id="btnSearch" value="Search" onclick="doSomething();" />
```

* * *

## 回答 #23

> 赞同：6
> 
> 时间：2018-01-28T15:41:02.397

对于那些可能喜欢简洁和现代 js 方法的人。

```
input.addEventListener('keydown', (e) => {if (e.keyCode == 13) doSomething()}); 
```

其中**input**是包含您的输入元素的变量。

* * *

## 回答 #24

> 赞同：5
> 
> 时间：2014-05-19T12:40:51.240

```
document.onkeypress = function (e) {
 e = e || window.event;
 var charCode = (typeof e.which == "number") ? e.which : e.keyCode;
 if (charCode == 13) {

        // Do something here
        printResult();
    }
}; 
```

这是我的两分钱。我正在开发适用于 Windows 8 的应用程序，并希望按钮在按下 Enter 按钮时注册一个单击事件。我在 JS 中这样做。我尝试了一些建议，但遇到了问题。这工作得很好。

* * *

## 回答 #25

> 赞同：5
> 
> 时间：2015-06-12T18:05:35.077

用 jQuery 做到这一点：

```
$("#txtSearch").on("keyup", function (event) {
    if (event.keyCode==13) {
        $("#btnSearch").get(0).click();
    }
}); 
```

用普通的 JavaScript 来做到这一点：

```
document.getElementById("txtSearch").addEventListener("keyup", function (event) {
    if (event.keyCode==13) { 
        document.getElementById("#btnSearch").click();
    }
}); 
```

* * *

## 回答 #26

> 赞同：1
> 
> 时间：2018-07-09T22:04:38.743

在 jQuery 中，您可以使用`event.which==13`. 如果您有`form`，则可以使用`$('#formid').submit()`（将正确的事件侦听器添加到所述表单的提交中）。

```
$('#textfield').keyup(function(event){
   if(event.which==13){
       $('#submit').click();
   }
});
$('#submit').click(function(e){
   if($('#textfield').val().trim().length){
      alert("Submitted!");
   } else {
    alert("Field can not be empty!");
   }
});
```

```
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<label for="textfield">
Enter Text:</label>
<input id="textfield" type="text">
<button id="submit">
Submit
</button>
```

* * *

## 回答 #27

> 赞同：1
> 
> 时间：2020-08-17T07:12:30.760

这一天的`change`活动就是这样！

```
document.getElementById("txtSearch").addEventListener('change',
    () => document.getElementById("btnSearch").click()
); 
```

* * *

## 回答 #28

> 赞同：0
> 
> 时间：2019-12-03T12:05:45.780

我已经开发了自定义 javascript 来通过添加类来实现这个功能

例子：`<button type="button" class="ctrl-p">Custom Print</button>`

在这里查看[Fiddle](https://jsfiddle.net/RaviMakwana/k6zL1q9t/)
- 或 -
查看运行示例 [https://stackoverflow.com/a/58010042/6631280](https://stackoverflow.com/a/58010042/6631280)

> 注意：在当前逻辑上，您需要按`Ctrl`+ `Enter`

* * *

## 回答 #29

> 赞同：-4
> 
> 时间：2011-09-13T10:45:41.460

这也可能有帮助，一个小的 JavaScript 函数，它工作正常：

```
<script type="text/javascript">
function blank(a) { if(a.value == a.defaultValue) a.value = ""; }

function unblank(a) { if(a.value == "") a.value = a.defaultValue; }
</script> 
<input type="text" value="email goes here" onfocus="blank(this)" onblur="unblank(this)" /> 
```

我知道这个问题已经解决了，但我刚刚发现了一些对其他人有帮助的东西。

# c++ - 使用应用程序的 Windows API commctrl.h 在没有 Platform SDK 的机器上不起作用

> ID：155191
> 
> 赞同：2
> 
> 时间：2008-09-30T21:33:06.967
> 
> 标签：c++, windows, dll

我写了一些使用以下内容的东西：

```
#include <math.h>
#include <time.h>
#include <stdio.h>
#include <stdlib.h>
#include <windows.h>
#include <commctrl.h> 
```

此代码在安装了 Platform SDK 的 2 台机器上运行良好，但在 Windows 的全新安装（当然是 VM）上不能运行（无论是调试版本还是发布版本）。它以非常熟悉的方式死去：

```
---------------------------
C:\Documents and Settings\Someone\Desktop\DesktopRearranger.exe
---------------------------
C:\Documents and Settings\Someone\Desktop\DesktopRearranger.exe

This application has failed to start because the application configuration is incorrect. Reinstalling the application may fix this problem.

---------------------------
OK   
--------------------------- 
```

我怎样才能让它在全新安装上运行？它使用的是哪个 dll 却找不到？我的赌注是在 commctrl 上，但有人可以告诉我为什么不是每个窗口都这样吗？

此外，如果有人对如何调试这样的东西有提示，因为我的 CPP 已经生锈了，看起来:)

编辑 - 对我有用的是下载 Visual Studio 2008 的 Redistributable。我认为这不是一个好的解决方案 - 下载 2MB 文件并安装以运行简单的 11K 工具。我想我会更改代码以使用 LoadLibrary 从 comctl32.dll 获取我需要的 2 或 3 个函数。谢谢大家 ：）

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-30T21:39:20.447

Use Dependency Walker. Download and install from [http://www.dependencywalker.com/](http://www.dependencywalker.com/) (just unzip to install). Then load up your executable. The tool will highlight which DLL is missing. Then you can find the redistributable pack which you need to ship with your executable.

If you use VS2005, most cases will be covered by [http://www.microsoft.com/downloads/details.aspx?FamilyId=32BC1BEE-A3F9-4C13-9C99-220B62A191EE&displaylang=en](http://www.microsoft.com/downloads/details.aspx?FamilyId=32BC1BEE-A3F9-4C13-9C99-220B62A191EE&displaylang=en) which includes everything needed to run EXEs created with VS2005\. Using depends.exe you may find a more lightweight solution, though.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-30T22:42:59.030

**Common controls is a red herring**. Your problem is that the Visual C++ 8.0 runtime - I assume you're using Visual Studio 2005 - isn't installed. Either statically link to the C/C++ runtime library, or distribute the runtime DLL.

You will have this problem with any C or C++ program that uses the DLL. You could get away with it in VS 6.0 as `msvcrt.dll` came with the OS from Windows 2000 up, and in VS.NET 2003 as `msvcr71.dll` came with .NET Framework 1.1\. No more. Visual Studio 2005 and later use side-by-side assemblies to prevent DLL Hell, but that means you can't rely even on .NET 2.0 installing the exact version of C runtime that your program's built-in manifest uses. .NET 2.0's `mscorwks.dll` binds to version 8.0.50608.0 in its manifest; a VS-generated application binds to 8.0.50727.762 as of VS2005 SP1\. My recollection is it used some pre-release version in the original (RTM) release of VS2005, which meant you had to deploy a Publisher Policy merge module if you were using the merge modules, to redirect the binding to the version actually in the released C run-time merge module.

See also [Redistributing Visual C++ Files](http://msdn.microsoft.com/en-us/library/ms235299(VS.80).aspx) on MSDN.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-30T21:35:52.530

我怀疑它正在尝试查找未安装的通用控件版本。您可能需要一个清单文件来将通用控件的版本映射到您的目标操作系统。此外，您可能需要确保安装了与您链接的相同 VC 运行时。

[克里斯杰克逊博客](http://blogs.msdn.com/cjacks/archive/2006/08/21/711240.aspx)

EDIT: A little searching and I've confirmed (mostly) that it is the version of your VC++ runtimes that is to blame. You need to distribute the versions that you built with. The platform SDK usually includes a merge module of these for that purpose, but there is often a VCRedist.exe for them as well. Try looking Microsoft's downloads.

[KB94885](http://support.microsoft.com/kb/948854)

# iis-6 - IIS6 中的“无法访问网络位置”错误

> ID：155202
> 
> 赞同：3
> 
> 时间：2008-09-30T21:36:32.077
> 
> 标签：iis-6

我正在对 IIS6 的一个问题进行故障排除，在该问题中，所有绑定到默认 IP 地址的站点在尝试启动这些站点中的任何一个时都会给出错误消息“无法访问网络位置”。

nic 已配置所有 ip 地址。当我执行 httpcfg 查询 iplisten 时，我只看到默认 IP 地址。当我使用 httpcfg 添加它们时，所有网站都停止工作，所以我认为我做错了，所以我删除了它们。

两个问题： 1- 为什么那些网站拒绝启动？2- httpcfg 查询 iplisten 的结果应该是什么？所有IP地址还是只有一个？

过去的网站运行良好，但发生了一些变化。我应用了一些 Windows 更新，但我不确定它们是否破坏了任何东西（我对此表示怀疑......否则数百家网络托管公司会尖叫）

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-01T07:25:09.727

解决方案是使用 httpcfg 而不指定端口号。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-30T21:51:28.390

有时在应用 Windows 更新时会出现错误。您可能会尝试的一件事是运行 aspnet_regiis /i 或 /c。我不确定这是否是您的问题，但肯定值得一试。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-30T22:18:18.217

该消息通常来自 Windows 网络（它是`ERROR_NETWORK_UNREACHABLE`、`ERROR_HOST_UNREACHABLE`、之一`ERROR_PROTOCOL_UNREACHABLE`- 您可以在 中搜索错误消息`WinError.h`）。

您是否设置了虚拟目录以指向另一台机器上的网络共享？如果是这样，请检查与该机器的连接。

# asp.net - 良好的错误处理实践

> ID：155203
> 
> 赞同：10
> 
> 时间：2008-09-30T21:36:34.883
> 
> 标签：asp.net, error-handling

对于 asp.net 站点，什么是好的错误处理实践？例子？谢谢！

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-09-30T21:47:16.623

与任何 .net 项目一样，我发现最好的方法是仅捕获特定错误类型（如果它们可能发生在给定页面上）。

例如，您可以为给定输入的用户捕获格式异常（以防 JavaScript 验证失败并且您没有使用 tryparse），但始终将顶级异常的捕获留给全局错误处理程序。

```
 try
        {
            //Code that could error here
        }
        catch (FormatException ex)
        {
            //Code to tell user of their error
            //all other errors will be handled 
            //by the global error handler
        } 
```

如果需要，您可以使用 ASP.Net 的开源[elmah](http://code.google.com/p/elmah/)（错误记录模块和处理程序）来为您执行顶级/全局错误捕获。

使用[elmah](http://code.google.com/p/elmah/)，它可以创建一个错误日志，通过一个简单的配置 Web 界面可以查看。您还可以过滤不同类型的错误，并为不同的错误类型拥有自己的自定义错误页面。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-30T21:42:45.150

我发现一种特别有用的做法是创建一个通用错误页面，然后将 web.config 的 customErrors 节点上的 defaultRedirect 设置为该错误页面。

然后设置您的 global.asax 以记录所有未处理的异常，然后将它们（未处理的异常）放在某个类的静态属性中（我有一个名为 ErrorUtil 的类，具有静态 LastError 属性）。然后，您的错误页面可以查看此属性以确定要向用户显示的内容。

更多细节在这里： http: [//www.codeproject.com/KB/aspnet/JcGlobalErrorHandling.aspx](http://www.codeproject.com/KB/aspnet/JcGlobalErrorHandling.aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-30T21:48:18.180

嗯，这是相当开放的，这非常酷。我给你推荐一个word .doc，你可以从[Dot Net Spider](http://www.dotnetspider.com/tutorials/BestPractices.aspx)下载，它实际上是我小公司代码标准的基础。该标准包括一些非常有用的错误处理技巧。

一个这样的异常示例（我不记得这是文档的原始内容还是我们将其添加到文档中）：永远不要“捕获异常并且什么也不做”。如果你隐藏一个异常，你永远不会知道异常是否发生。您应该始终尝试通过以编程方式检查所有错误情况来避免异常。

不该做什么的例子：

```
try
{
   ...
}
catch{} 
```

非常顽皮，除非你有充分的理由。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-30T21:52:59.870

您应该确保可以捕获应用程序生成的大部分错误，并向用户显示友好的消息。但当然，您无法捕获所有错误，因为您可以使用 web.config 和 defaultRedirect 由另一个用户。另一个非常方便的记录错误的工具是 ELMAH。ELMAH 将记录您的应用程序生成的所有错误，并以非常易读的方式显示给您。在您的应用程序中插入 ELMAH 就像在 web.config 文件中添加几行代码并附加程序集一样简单。您绝对应该尝试一下 ELMAH，它确实可以为您节省数小时的痛苦。

[http://code.google.com/p/elmah/](http://code.google.com/p/elmah/)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-30T21:58:45.300

1.  在每个页面中针对您预期可能发生的异常进行防御性编码并适当地处理它们，因此不要在每次发生异常时都扰乱用户。

2.  记录所有异常，并提供参考。

3.  为任何未处理的异常提供通用错误页面，该页面提供了用于支持的参考（支持可以从日志中识别详细信息）。不要显示实际的异常，因为大多数用户不会理解它，但它会暴露有关您系统的信息（可能是密码等），因此存在潜在的安全风险。

4.  不要捕获所有异常并且对它们不做任何事情（如上面的答案）。这样做几乎没有充分的理由，有时您可能想要捕获特定异常而不是故意这样做，但这应该明智地使用。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-01T00:46:05.070

将用户重定向到标准错误页面并不总是一个好主意。如果用户正在处理表单，他们可能不希望被重定向离开正在处理的表单。我将所有可能导致异常的代码放在 try/catch 块中，并在 catch 块中吐出一条警告消息，提醒用户发生错误，并将异常记录在数据库中，包括表单输入、查询字符串等等。不过，我正在开发一个内部站点，所以大多数用户在遇到问题时都会给我打电话。对于公共站点，您可能希望使用 elmah 之类的东西。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-11-17T09:41:30.007

```
public string BookLesson(Customer_Info oCustomerInfo, CustLessonBook_Info oCustLessonBookInfo)
    {
        string authenticationID = string.Empty;
        int customerID = 0;
        string message = string.Empty;
        DA_Customer oDACustomer = new DA_Customer();

        using (TransactionScope scope = new TransactionScope())
        {
            if (oDACustomer.ValidateCustomerLoginName(oCustomerInfo.CustId, oCustomerInfo.CustLoginName) == "Y")
            {
                // if a new student
                if (oCustomerInfo.CustId == 0)
                {
                    oCustomerInfo.CustPassword = General.GeneratePassword(6, 8);
                    oCustomerInfo.CustPassword = new DA_InternalUser().GetPassword(oCustomerInfo.CustPassword, false);
                    authenticationID = oDACustomer.Register(oCustomerInfo, ref customerID);
                    oCustLessonBookInfo.CustId = customerID;
                }
                else // if existing student
                {
                    oCustomerInfo.UpdatedByCustomer = "Y";
                    authenticationID = oDACustomer.CustomerUpdateProfile(oCustomerInfo);
                }
                message = authenticationID;
                // insert lesson booking details
                new DA_Lesson().BookLesson(oCustLessonBookInfo);
            }

            else
            {
                message = "login exists";
            }
            scope.Complete();
            return message;
        }

    } 
```

# c# - 另一个锁定问题

> ID：155209
> 
> 赞同：1
> 
> 时间：2008-09-30T21:38:13.180
> 
> 标签：c#, multithreading, locking

我试图锁定我的多线程理解。我正在尽我所能自学，但其中一些问题需要澄清。

我用一段代码经历了三次迭代，尝试锁定。

在这段代码中，唯一需要锁定的是 this.managerThreadPriority。

首先，简单、程序化的方法，带有简约的锁定。

```
var managerThread = new Thread
(
    new ThreadStart(this.ManagerThreadEntryPoint)
);

lock (this.locker)
{
    managerThread.Priority = this.managerThreadPriority;
}

managerThread.Name = string.Format("Manager Thread ({0})", managerThread.GetHashCode());

managerThread.Start(); 
```

接下来，使用单个语句创建和启动一个新线程，但锁的范围似乎太大，无法包括线程的创建和启动。编译器并不神奇地知道在 this.managerThreadPriority 使用后可以释放锁。

我认为应该避免这种幼稚的锁定。

```
lock (this.locker)
{
    new Thread
    (
        new ThreadStart(this.ManagerThreadEntryPoint)
    )
    {
        Priority = this.managerThreadPriority,
        Name = string.Format("Manager Thread ({0})", GetHashCode())
    }
    .Start();
} 
```

最后，创建和启动新线程的单个语句，仅在共享字段周围使用“嵌入式”锁。

```
new Thread
(
    new ThreadStart(this.ManagerThreadEntryPoint)
)
{
    Priority = new Func<ThreadPriorty>(() =>
    {
        lock (this.locker)
        {
            return this.managerThreadPriority;
        }
    })(),

    Name = string.Format("Manager Thread ({0})", GetHashCode())
}
.Start(); 
```

想评论锁定语句的范围？例如，如果我需要在`if`语句中使用一个字段并且该字段需要被锁定，我应该避免锁定整个`if`语句吗？例如

```
bool isDumb;

lock (this.locker) isDumb = this.FieldAccessibleByMultipleThreads;

if (isDumb) ... 
```

比。

```
lock (this.locker)
{
    if (this.FieldAccessibleByMultipleThreads) ...
} 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-01T04:47:19.357

> 想评论锁定语句的范围？例如，如果我需要在 if 语句中使用一个字段并且该字段需要被锁定，我是否应该避免锁定整个 if 语句？

一般来说，它的范围应该是需要保护资源的代码部分，仅此而已。这是为了让其他线程尽快使用它。

但这**取决于您锁定的资源是否是必须保持一致性的更大图景的一部分，或者它是否是与任何其他资源没有直接关系的独立资源**。

*如果您有相互关联的部分需要以同步方式全部更改，则需要在整个过程中锁定整套部分。如果您有一个独立的单个项目与其他任何项目解耦，那么只需将一个项目锁定足够长的时间，以便部分流程可以访问它。*

另一种说法是，**您是在保护对资源的同步还是异步访问**？

一般来说，同步访问需要更长时间地保留它，因为它关心资源所属的更大图景。它必须保持与相关资源的一致性。在这种情况下，如果您想在所有处理都处理完之前防止中断，您可以很好地包装整个 for 循环。

异步访问应尽可能简短地保留它。因此，锁定更合适的位置是代码部分内部，例如在 for 循环或 if 语句内部，因此您可以在处理其他元素之前立即释放单个元素。

* * *

除了这两个考虑之外，我还要补充一个。**避免嵌套涉及两个不同锁定对象的锁**。我从经验中了解到，这很可能是死锁的来源，尤其是在代码的其他部分使用它们的情况下。如果这两个对象是一个组的一部分，需要一直被视为一个整体，那么这种嵌套应该被重构出来。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-30T21:43:23.933

1）在你开始另一个线程之前，你根本不必担心共享访问它。

2) 是的，您应该锁定对共享可变数据的*所有*访问权限。（如果它是不可变的，则不需要锁定。）

3) 不要使用 GetHashCode() 来指示线程 ID。使用 Thread.ManagedThreadId。我知道，有些书推荐 Thread.GetHashCode() - 但请查看文档。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-30T21:54:50.707

在启动任何线程之前无需锁定任何内容。

如果您只打算读取一个变量，则也不需要锁。当您混合读取和写入时，您需要使用互斥锁和类似的锁定，并且您需要锁定读取和写入线程。

# sql - 动态 SQL - 搜索查询 - 可变数量的关键字

> ID：155220
> 
> 赞同：4
> 
> 时间：2008-09-30T21:42:40.563
> 
> 标签：sql, sql-injection, dynamic-sql

我们正在尝试更新我们的经典 asp 搜索引擎以保护它免受 SQL 注入。我们有一个 VB 6 函数，它通过基于各种搜索参数将查询连接在一起来动态构建查询。我们已经使用动态 sql 将其转换为存储过程，用于除关键字之外的所有参数。

关键字的问题是用户提供了可变数量的单词，我们想为每个关键字搜索几列。由于我们无法为每个关键字创建单独的参数，我们如何构建安全查询？

例子：

```
@CustomerId AS INT
@Keywords AS NVARCHAR(MAX)

@sql = 'SELECT event_name FROM calendar WHERE customer_id = @CustomerId '

--(loop through each keyword passed in and concatenate)

@sql = @sql + 'AND (event_name LIKE ''%' + @Keywords + '%'' OR event_details LIKE ''%' + @Keywords + '%'')'

EXEC sp_executesql @sql N'@CustomerId INT, @CustomerId = @CustomerId 
```

处理此问题并维护 SQL 注入保护的最佳方法是什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-30T22:12:20.570

您可能不喜欢听到这个，但在针对数据库发出之前，您最好返回到在代码中动态构建 SQL 查询。如果您在 SQL 字符串中使用参数占位符，您将获得针对 SQL 注入攻击的保护。

例子：

```
string sql  = "SELECT Name, Title FROM Staff WHERE UserName=@UserId";
using (SqlCommand cmd = new SqlCommand(sql))
{
  cmd.Parameters.Add("@UserId", SqlType.VarChar).Value = "smithj"; 
```

您可以根据需要查询的列集构建 SQL 字符串，然后在字符串完成后添加参数值。这样做有点痛苦，但我认为这比使用真正复杂的 TSQL 要容易得多，因为 TSQL 会取消选择可能输入的许多可能排列。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-30T22:22:58.860

这里有 3 个选项。

1.  使用[转换列表表](http://www.sommarskog.se/arrays-in-sql-2005.html)并加入其中的函数。所以你会有这样的东西。

    ```
    SELECT * 
    FROM calendar c
       JOIN dbo.fnListToTable(@Keywords) k 
           ON c.keyword = k.keyword 
    ```

2.  有一组固定的参数，并且只允许搜索最多 N 个关键字

    ```
    CREATE PROC spTest
    @Keyword1 varchar(100),
    @Keyword2 varchar(100),
    .... 
    ```

3.  在 TSQL 中编写转义字符串函数并转义关键字。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-01T05:13:49.340

*   除非你需要它，否则你可以简单地删除任何不在 [a-zA-Z] 中的字符 - 大多数这些东西不会在搜索中，你不应该以这种方式被注入，你也不必担心关键字或类似的东西。但是，如果您允许引用，则需要更加小心。

*   与 sambo99 的 #1 类似，您可以将关键字插入到临时表或表变量中并加入它（甚至使用通配符），而不会存在注入的危险：

这不是真正的动态：

```
SELECT DISTINCT event_name
FROM calendar
INNER JOIN #keywords
    ON event_name LIKE '%' + #keywords.keyword + '%'
    OR event_description LIKE '%' + #keywords.keyword + '%' 
```

*   您实际上可以生成具有大量参数的 SP，而不是手动对其进行编码（根据您对搜索编码的偏好，将默认值设置为 '' 或 NULL）。如果您发现需要更多参数，那么增加它生成的参数数量会很简单。

*   您可以将搜索移至数据库外部的全文索引（如 Lucene），然后使用 Lucene 结果提取匹配的数据库行。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-10-17T23:02:07.610

你可以试试这个：

```
SELECT * FROM [tablename] WHERE LIKE % +keyword% 
```

# apache-flex - 如何让构建自动更新 Flex 中的 Web 服务引用？

> ID：155229
> 
> 赞同：0
> 
> 时间：2008-09-30T21:44:02.027
> 
> 标签：apache-flex, web-services, build-process, flexbuilder

在 FlexBuilder3 中，我可以转到“数据/管理 Web 服务...”选择一个 Web 服务，然后单击“更新”以确保我的代码和服务器同步。如何自动执行此操作，以便每次构建时都会重新生成自动生成的 Web 服务代码？

如果在开发过程中服务器接口发生了变化，但我的代码没有发生变化，那么它无论如何都不会工作 - 我宁愿遇到编译错误而不是运行时错误，我不得不追踪到更改的 Web 服务接口。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-03T10:53:00.687

不幸的是，您无法在构建时更新 Web 服务。更新是向导的一部分，并不作为一个单独的操作来实现，需要根据需要调用。

我的一个建议是进入项目属性并在“**构建**”面板中添加一个程序作为新构建器。您必须创建这个程序，每次构建项目时检查 WSDL 文件没有更改。这有点复杂，但是如果您正在处理一个依赖于正在大量开发的 Web 服务的项目，它可能会为您节省大量时间。

# ruby-on-rails - Capistrano 没有正确重启 Mongrel 集群

> ID：155234
> 
> 赞同：5
> 
> 时间：2008-09-30T21:46:38.760
> 
> 标签：ruby-on-rails, ruby, deployment, capistrano, mongrel

我有一个在 nginx 下运行的由三个杂种组成的集群，我使用 Capistrano 2.4.3 部署应用程序。当我在有一个正在运行的系统时“限制部署”时，行为是：

1.  应用程序已部署。代码更新成功。
2.  在 cap deploy 输出中，有这样的：

    *   执行“sudo -p 'sudo 密码：' mongrel_rails cluster::restart -C /var/www/rails/myapp/current/config/mongrel_cluster.yml”
    *   服务器：[“myip”]
    *   [myip] 执行命令
    *   ** [out :: myip] 停止端口 9096
    *   ** [out :: myip] 停止端口 9097
    *   ** [out :: myip] 停止端口 9098
    *   ** [out :: myip] 已经启动了 9096 端口
    *   ** [out :: myip] 已经启动了 9097 端口
    *   ** [out :: myip] 已经启动了 9098 端口
3.  我立即在服务器上检查，发现 Mongrel 仍在运行，并且前三个实例的 PID 文件仍然存在。
4.  不久之后（不到一分钟），我发现 Mongrel 不再运行，PID 文件不见了，并且无法重新启动。
5.  如果我手动在服务器上启动 mongrel，应用程序启动得很好。

似乎“mongrel_rails cluster::restart”在尝试重新启动集群之前没有正确等待完全停止。如何诊断和解决此问题？

编辑：这是答案：

mongrel_cluster，在“重启”任务中，简单地这样做：

```
 def run
   stop
   start
 end 
```

在调用“开始”之前，它不会进行任何等待或检查以查看进程是否退出。这是[一个已知的错误，提交了一个未完成的补丁](http://rubyforge.org/tracker/index.php?func=detail&aid=19657&group_id=1336&atid=5291)。我将补丁应用到 Mongrel Cluster，问题就消失了。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-01T14:42:16.323

您可以通过在 capistrano 配方中添加以下内容来明确告诉 mongrel_cluster 配方在开始之前删除 pid 文件：

```
# helps keep mongrel pid files clean
set :mongrel_clean, true 
```

这会导致它将 --clean 选项传递给 mongrel_cluster_ctl。

我回去查看了我的一个部署方法，发现我也改变了重启任务的工作方式。查看 mongrel 用户组中的以下消息：

[杂种用户讨论重启](http://rubyforge.org/pipermail/mongrel-users/2007-October/004260.html)

以下是我的 deploy:restart 任务。我承认这有点骇人听闻。

```
namespace :deploy do
  desc "Restart the Mongrel processes on the app server."
  task :restart, :roles => :app do
    mongrel.cluster.stop
    sleep 2.5
    mongrel.cluster.start
  end
end 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-01T02:37:48.937

首先，通过仅调用`cap deploy:restart`. 您可能希望`--debug`在远程执行之前将选项传递给提示，或者`--dry-run`只是在调整设置时查看发生了什么的选项。

乍一看，这听起来像是 pid 文件或 mongrel 进程的权限问题，但很难确定。引起我注意的几件事是：

*   **该`:runner`变量被明确设置为`nil`**- 是否有特定原因？
*   Capistrano 2.4 为**变量****引入了新的行为`:admin_runner`**。没有看到整个食谱，这可能与您的问题有关吗？

    > **:runner 与 :admin_runner**（来自[capistrano 2.4 版本](http://weblog.jamisbuck.org/2008/6/13/capistrano-2-4-0)） 一些封盖者注意到以 :runner 用户身份运行 deploy:setup 和 deploy:cleanup 会破坏他们精心设计的权限。我同意这是一个问题。在此版本中，deploy:start、deploy:stop 和 deploy:restart 在 sudoing 时都继续使用 :runner 用户，但 deploy:setup 和 deploy:cleanup 将使用 :admin_runner 用户。:admin_runner 变量默认未设置，这意味着这些任务将以 root 身份执行，但如果您希望它们以 :runner 身份运行，只需执行“set :admin_runner, runner”。

我对下一步做什么的建议。手动停止杂种并清理 PID。手动启动杂种。`cap deploy:restart`接下来，一边调试问题一边继续运行。根据需要重复。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-03T00:10:49.313

无论哪种方式，我的杂种在上一个停止命令完成关闭它们之前就开始了。

sleep 2.5 不是一个好的解决方案，如果它需要超过 2.5 秒来停止所有正在运行的杂种。

似乎需要：

```
stop && start 
```

对比

```
stop; start 
```

（这就是 bash 的工作方式，&& 等待第一个命令完成而没有错误，而“;”只是运行下一个命令）。

我想知道是否有一个：

```
wait cluster_stop
then cluster_start 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-30T22:36:00.903

我讨厌这么基本，但听起来 pid 文件在尝试启动时仍然挂起。确保手动停止杂种。手动清理 pid 文件。然后进行上限部署。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-03T00:12:40.807

很好的讨论：[http ://www.ruby-forum.com/topic/139734#745030](http://www.ruby-forum.com/topic/139734#745030)

# java - 为什么不尝试 I/O 就不可能检测到 TCP 套接字已被对等方优雅地关闭？

> ID：155243
> 
> 赞同：95
> 
> 时间：2008-09-30T21:49:06.507
> 
> 标签：java, sockets, tcp, network-programming

[作为最近一个问题](https://stackoverflow.com/questions/151590/java-how-do-detect-a-remote-side-socket-close)的后续，我想知道为什么在 Java 中，如果不尝试在 TCP 套接字上读/写，就不可能检测到套接字已被对等方优雅地关闭？无论使用 pre-NIO`Socket`还是 NIO似乎都是这种情况`SocketChannel`。

当对等方优雅地关闭 TCP 连接时，连接两端的 TCP 堆栈都知道这一事实。服务器端（启动关闭的那个）以 state 结束`FIN_WAIT2`，而客户端（没有明确响应关闭的那个）以 state 结束`CLOSE_WAIT`。为什么没有方法`Socket`可以`SocketChannel`查询 TCP 堆栈以查看底层 TCP 连接是否已终止？是不是 TCP 栈没有提供这样的状态信息？或者是为了避免对内核进行昂贵的调用而做出的设计决定？

在已经发布了这个问题的一些答案的用户的帮助下，我想我知道问题可能来自哪里。没有明确关闭连接的一方最终处于 TCP 状态`CLOSE_WAIT`，这意味着连接正在关闭并等待该方发出自己的`CLOSE`操作。我想`isConnected`返回`true`和`isClosed`返回已经足够公平了`false`，但是为什么没有类似的东西`isClosing`呢？

下面是使用 pre-NIO 套接字的测试类。但是使用 NIO 可以获得相同的结果。

```
import java.net.ServerSocket;
import java.net.Socket;

public class MyServer {
  public static void main(String[] args) throws Exception {
    final ServerSocket ss = new ServerSocket(12345);
    final Socket cs = ss.accept();
    System.out.println("Accepted connection");
    Thread.sleep(5000);
    cs.close();
    System.out.println("Closed connection");
    ss.close();
    Thread.sleep(100000);
  }
}

import java.net.Socket;

public class MyClient {
  public static void main(String[] args) throws Exception {
    final Socket s = new Socket("localhost", 12345);
    for (int i = 0; i < 10; i++) {
      System.out.println("connected: " + s.isConnected() + 
        ", closed: " + s.isClosed());
      Thread.sleep(1000);
    }
    Thread.sleep(100000);
  }
} 
```

当测试客户端连接到测试服务器时，即使服务器启动关闭连接，输出也保持不变：

```
connected: true, closed: false
connected: true, closed: false
... 
```

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2012-02-22T17:12:34.437

我经常使用套接字，主要是使用选择器，虽然不是网络 OSI 专家，但据我了解，调用`shutdownOutput()`套接字实际上会在网络 (FIN) 上发送一些东西，这会唤醒另一端的选择器（C 中的行为相同语）。在这里你有**检测**：实际上检测到一个读取操作，当你尝试它时会失败。

在您提供的代码中，关闭套接字将关闭输入和输出流，而无法读取可能可用的数据，因此会丢失它们。Java`Socket.close()`方法执行“优雅的”断开连接（与我最初的想法相反），因为留在输出流中的数据将被发送*，然后是 FIN*以表示其关闭。FIN 将被另一方确认，就像任何常规数据包都会¹一样。

如果需要等待对方关闭其socket，则需要等待其FIN。为了实现这一点，你**必须**检测`Socket.getInputStream().read() < 0`，这意味着你不应该*关闭*你的套接字，因为它会**关闭它的`InputStream`**.

从我在 C 中所做的，现在在 Java 中，实现这样的同步关闭应该像这样完成：

1.  关闭套接字输出（在另一端发送 FIN，这是此套接字发送的最后一件事）。输入仍处于打开状态，因此您可以`read()`检测到遥控器`close()`
2.  读取套接字`InputStream`，直到我们收到来自另一端的回复 FIN（因为它会检测到 FIN，它会经历相同的优雅断开过程）。这在某些操作系统上很重要，因为只要其中一个缓冲区仍然包含数据，它们实际上就不会关闭套接字。它们被称为“幽灵”套接字并在操作系统中用完描述符编号（现代操作系统可能不再是问题）
3.  关闭套接字（通过调用`Socket.close()`或关闭其`InputStream`or `OutputStream`）

如以下 Java 代码片段所示：

```
public void synchronizedClose(Socket sok) {
    InputStream is = sok.getInputStream();
    sok.shutdownOutput(); // Sends the 'FIN' on the network
    while (is.read() > 0) ; // "read()" returns '-1' when the 'FIN' is reached
    sok.close(); // or is.close(); Now we can close the Socket
} 
```

当然，双方*必须*使用相同的关闭方式，否则发送部分可能总是发送足够的数据以保持`while`循环忙碌（例如，如果发送部分仅发送数据而从不读取以检测连接终止。这很笨拙，但您可能无法控制）。

正如@WarrenDew 在他的评论中指出的那样，丢弃程序（应用程序层）中的数据会导致应用程序层的非正常断开连接：尽管所有数据都是在 TCP 层（`while`循环）接收的，但它们被丢弃了。

¹：来自“ [Java 中的基本网络](http://www.springer.com/us/book/9781846280306)”：见图。3.3 p.45，以及整个 §3.7，第 43-48 页

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2008-10-01T06:06:54.953

我认为这更像是一个套接字编程问题。Java 只是遵循套接字编程的传统。

来自[维基百科](http://en.wikipedia.org/wiki/Transmission_Control_Protocol)：

> TCP 提供从一台计算机上的一个程序到另一台计算机上的另一个程序的可靠、有序的字节流传递。

握手完成后，TCP 不会在两个端点（客户端和服务器）之间进行任何区分。术语“客户端”和“服务器”主要是为了方便。因此，“服务器”可能正在发送数据，而“客户端”可能正在同时向对方发送一些其他数据。

“关闭”一词也具有误导性。只有FIN声明，意思是“我不会再给你发东西了”。但这并不意味着飞行中没有数据包，或者对方无话可说。如果您将蜗牛邮件实现为数据链路层，或者如果您的数据包经过不同的路由，则接收方可能会以错误的顺序接收数据包。TCP 知道如何为您解决这个问题。

此外，作为一个程序，您可能没有时间继续检查缓冲区中的内容。因此，在您方便时，您可以检查缓冲区中的内容。总而言之，当前的套接字实现还不错。如果确实存在 isPeerClosed()，那么每次您想调用 read 时都必须进行额外调用。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2008-09-30T22:11:15.457

底层的套接字 API 没有这样的通知。

无论如何，发送 TCP 堆栈直到最后一个数据包才会发送 FIN 位，因此当发送应用程序在发送数据之前逻辑关闭其套接字时，可能会缓冲大量数据。同样，由于网络比接收应用程序更快而缓冲的数据（我不知道，也许您正在通过较慢的连接中继它）对接收器可能很重要，并且您不希望接收应用程序丢弃它只是因为堆栈已收到 FIN 位。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2008-10-01T13:17:37.040

由于到目前为止没有一个答案完全回答了这个问题，我总结了我目前对这个问题的理解。

当建立 TCP 连接并且一个对等方调用`close()`其`shutdownOutput()`套接字时，连接另一侧的套接字将转换为`CLOSE_WAIT`状态。原则上，可以从 TCP 堆栈中找出套接字是否处于`CLOSE_WAIT`状态而无需调用`read/recv`（例如，`getsockopt()`在 Linux 上： http: [//www.developerweb.net/forum/showthread.php?](http://www.developerweb.net/forum/showthread.php?t=4395) t=4395 ），但事实并非如此便携的。

Java 的`Socket`类似乎旨在提供与 BSD TCP 套接字相当的抽象，可能是因为这是人们在编写 TCP/IP 应用程序时习惯的抽象级别。BSD 套接字是支持 INET（例如 TCP）之外的套接字的泛化，因此它们不提供查找套接字 TCP 状态的可移植方式。

没有这样的方法，`isCloseWait()`因为人们习惯于在 BSD 套接字提供的抽象级别上对 TCP 应用程序进行编程，并不期望 Java 提供任何额外的方法。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2011-08-10T12:28:09.317

可以使用 java.net.Socket.sendUrgentData(int) 方法检测 (TCP) 套接字连接的远程端是否已关闭，并在远程端关闭时捕获它抛出的 IOException。这已经在 J​​ava-Java 和 Java-C 之间进行了测试。

这避免了将通信协议设计为使用某种 ping 机制的问题。通过在套接字上禁用 OOBInline (setOOBInline(false)，任何接收到的 OOB 数据都会被静默丢弃，但 OOB 数据仍然可以发送。如果远程端关闭，则尝试重置连接，失败，并导致抛出一些 IOException .

如果您在协议中实际使用 OOB 数据，那么您的里程可能会有所不同。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-09-30T22:15:35.900

这是一个有趣的话题。我刚刚挖掘了java代码来检查。根据我的发现，有两个明显的问题：第一个是 TCP RFC 本身，它允许远程关闭的套接字以半双工方式传输数据，因此远程关闭的套接字仍然是半开的。根据 RFC，RST 不会关闭连接，您需要发送显式 ABORT 命令；所以Java允许通过半封闭套接字发送数据

（有两种方法可以读取两个端点的关闭状态。）

另一个问题是实现说这种行为是可选的。由于 Java 力求可移植，它们实现了最好的通用特性。我猜，维护（操作系统，半双工的实现）的地图将是一个问题。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2009-07-06T03:44:06.653

当 Java IO 堆栈在突然拆除时被破坏时，它肯定会发送 FIN。您无法检测到这一点是没有意义的，b/c 大多数客户端仅在关闭连接时才发送 FIN。

...我真的开始讨厌 NIO Java 类的另一个原因。似乎一切都有些半途而废。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2009-01-24T21:23:08.730

这是 Java（以及我看过的所有其他）OO 套接字类的一个缺陷——无法访问 select 系统调用。

C中的正确答案：

```
struct timeval tp;  
fd_set in;  
fd_set out;  
fd_set err;  

FD_ZERO (in);  
FD_ZERO (out);  
FD_ZERO (err);  

FD_SET(socket_handle, err);  

tp.tv_sec = 0; /* or however long you want to wait */  
tp.tv_usec = 0;  
select(socket_handle + 1, in, out, err, &tp);  

if (FD_ISSET(socket_handle, err) {  
   /* handle closed socket */  
} 
```

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2012-08-24T15:47:59.617

这是一个蹩脚的解决方法。使用 SSL ;) 并且 SSL 在拆卸时会进行关闭握手，因此您会收到套接字被关闭的通知（大多数实现似乎都会进行属性握手拆卸）。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-10-01T11:09:11.187

这种行为（不是 Java 特定的）的原因是您没有从 TCP 堆栈获得任何状态信息。毕竟，套接字只是另一个文件句柄，如果没有实际尝试，您将无法确定是否有实际数据要从中读取（在`select(2)`那里无济于事，它只表示您可以尝试不阻塞）。

有关详细信息，请参阅[Unix 套接字常见问题解答](http://www.unixguide.net/network/socketfaq/)。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-10-10T17:35:44.047

只有写入需要交换数据包才能确定连接丢失。一个常见的解决方法是使用 KEEP ALIVE 选项。

* * *

## 回答 #12

> 赞同：-3
> 
> 时间：2011-10-27T10:34:26.283

在处理半开 Java 套接字时，可能需要查看 [isInputShutdown()](http://download.oracle.com/javase/1.4.2/docs/api/java/net/Socket.html#isInputShutdown%28%29)和[isOutputShutdown()](http://download.oracle.com/javase/1.4.2/docs/api/java/net/Socket.html#isOutputShutdown%28%29)。

# sql-server - 如何使用 TSQL 截断数据库中的所有表？

> ID：155246
> 
> 赞同：221
> 
> 时间：2008-09-30T21:49:17.663
> 
> 标签：sql-server, tsql

我有一个数据库测试环境，我想在测试周期开始时重新加载新数据。我对重建整个数据库不感兴趣——只是简单地“重新设置”数据。

使用 TSQL 从所有表中删除所有数据的最佳方法是什么？有没有可以使用的系统存储过程、视图等？我不想为每个表手动创建和维护截断表语句——我希望它是动态的。

* * *

## 回答 #1

> 赞同：444
> 
> 时间：2008-10-01T09:10:22.657

在处理从具有外键关系的表中删除数据时——这基本上是任何设计合理的数据库的情况——我们可以禁用所有约束，删除所有数据，然后重新启用约束

```
-- disable all constraints
EXEC sp_MSForEachTable "ALTER TABLE ? NOCHECK CONSTRAINT all"

-- delete data in all tables
EXEC sp_MSForEachTable "DELETE FROM ?"

-- enable all constraints
exec sp_MSForEachTable "ALTER TABLE ? WITH CHECK CHECK CONSTRAINT all" 
```

更多关于禁用约束和触发器[在这里](https://stackoverflow.com/questions/123558/sql-server-2005-t-sql-to-temporarily-disable-a-trigger#123966)

如果某些表有标识列，我们可能想要重新设置它们

```
EXEC sp_MSForEachTable "DBCC CHECKIDENT ( '?', RESEED, 0)" 
```

请注意， RESEED 的行为在全新表和之前从[BOL](http://msdn.microsoft.com/en-us/library/aa258817(SQL.80).aspx)插入一些数据的表之间有所不同：

> **DBCC CHECKIDENT ('table_name', RESEED, newReseedValue)**
> 
> 当前标识值设置为 newReseedValue。如果自创建以来没有向表中插入任何行，则执行 DBCC CHECKIDENT 后插入的第一行将使用 newReseedValue 作为标识。否则，插入的下一行将使用 newReseedValue + 1。如果 newReseedValue 的值小于标识列中的最大值，则在后续引用该表时将生成错误消息 2627。

感谢[Robert](https://stackoverflow.com/users/23566/robert-claypool)指出禁用约束不允许使用截断这一事实，必须删除约束，然后重新创建

* * *

## 回答 #2

> 赞同：197
> 
> 时间：2008-09-30T21:56:32.310

对于 SQL 2005，

```
EXEC sp_MSForEachTable 'TRUNCATE TABLE ?' 
```

[为2000 年](http://www.databasejournal.com/scripts/article.php/2226781)和[2005/2008](http://www.keithrull.com/2007/09/07/HowToTruncateMultipleTablesInSQLServerAndTheMagicOfSpMSforeachtable.aspx)年添加更多链接..

* * *

## 回答 #3

> 赞同：65
> 
> 时间：2012-10-04T02:20:53.137

这是数据库擦除脚本之王。它将清除所有表并正确重新设置它们：

```
SET QUOTED_IDENTIFIER ON;
EXEC sp_MSforeachtable 'SET QUOTED_IDENTIFIER ON; ALTER TABLE ? NOCHECK CONSTRAINT ALL'  
EXEC sp_MSforeachtable 'SET QUOTED_IDENTIFIER ON; ALTER TABLE ? DISABLE TRIGGER ALL'  
EXEC sp_MSforeachtable 'SET QUOTED_IDENTIFIER ON; DELETE FROM ?'  
EXEC sp_MSforeachtable 'SET QUOTED_IDENTIFIER ON; ALTER TABLE ? CHECK CONSTRAINT ALL'  
EXEC sp_MSforeachtable 'SET QUOTED_IDENTIFIER ON; ALTER TABLE ? ENABLE TRIGGER ALL' 
EXEC sp_MSforeachtable 'SET QUOTED_IDENTIFIER ON';

IF NOT EXISTS (
    SELECT
        *
    FROM
        SYS.IDENTITY_COLUMNS
        JOIN SYS.TABLES ON SYS.IDENTITY_COLUMNS.Object_ID = SYS.TABLES.Object_ID
    WHERE
        SYS.TABLES.Object_ID = OBJECT_ID('?') AND SYS.IDENTITY_COLUMNS.Last_Value IS NULL
)
AND OBJECTPROPERTY( OBJECT_ID('?'), 'TableHasIdentity' ) = 1

    DBCC CHECKIDENT ('?', RESEED, 0) WITH NO_INFOMSGS; 
```

享受，但要小心！

* * *

## 回答 #4

> 赞同：49
> 
> 时间：2014-03-20T08:57:05.733

最简单的方法是

1.  打开 SQL 管理工作室
2.  导航到您的数据库
3.  右键单击并选择任务->生成脚本（图 1）
4.  在“选择对象”屏幕上，选择“选择特定对象”选项并选中“表格”（图 2）
5.  在下一个屏幕上，选择“高级”，然后将“脚本删除和创建”选项更改为“脚本删除和创建”（图 3）
6.  选择将脚本保存到新的编辑器窗口或文件并根据需要运行。

这将为您提供一个脚本，该脚本可以删除并重新创建所有表，而无需担心调试或是否包含所有内容。虽然这不仅仅是截断，但结果是相同的。请记住，您的自动递增主键将从 0 开始，而不是截断表，它会记住最后分配的值。如果您无权访问 PreProd 或生产环境中的 Management Studio，您也可以从代码中执行此操作。

1.

![在此处输入图像描述](https://i.stack.imgur.com/KWXSP.png)

2.

![在此处输入图像描述](https://i.stack.imgur.com/fwUxD.png)

3.

![在此处输入图像描述](https://i.stack.imgur.com/Jq2E0.png)

* * *

## 回答 #5

> 赞同：13
> 
> 时间：2008-09-30T22:11:07.423

仅当您的表之间没有任何外键关系时，截断所有表才有效，因为 SQL Server 不允许您截断具有外键的表。

另一种方法是确定具有外键的表并首先从中删除，然后您可以在之后截断没有外键的表。

有关详细信息，请参阅[http://www.sqlteam.com/forums/topic.asp?TOPIC_ID=65341](http://www.sqlteam.com/forums/topic.asp?TOPIC_ID=65341)和[http://www.sqlteam.com/forums/topic.asp?TOPIC_ID=72957](http://www.sqlteam.com/forums/topic.asp?TOPIC_ID=72957)。

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2008-10-02T09:19:37.293

不要这样做！真的，不是一个好主意。

如果您知道要截断哪些表，请创建一个存储过程来截断它们。您可以修复订单以避免外键问题。

如果您真的想将它们全部截断（例如，您可以 BCP 加载它们），您将同样快速地删除数据库并从头开始创建一个新数据库，这将带来额外的好处，即您确切地知道自己在哪里。

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2009-08-11T18:51:12.083

我喜欢与 MSSQL Server Developer 或 Enterprise 一起使用的另一个选项是在创建空模式后立即创建数据库的快照。此时，您可以继续将数据库恢复到快照。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2013-08-20T20:59:18.740

如果您想将数据保留在特定表（即静态查找表）中，同时删除/截断同一数据库中其他表中的数据，那么您需要一个包含异常的循环。当我偶然发现这个问题时，这就是我正在寻找的东西。

sp_MSForEachTable 对我来说似乎有问题（即与 IF 语句的行为不一致），这可能是 MS 未记录它的原因。

```
declare @LastObjectID int = 0
declare @TableName nvarchar(100) = ''
set @LastObjectID = (select top 1 [object_id] from sys.tables where [object_id] > @LastObjectID order by [object_id])
while(@LastObjectID is not null)
begin
    set @TableName = (select top 1 [name] from sys.tables where [object_id] = @LastObjectID)

    if(@TableName not in ('Profiles', 'ClientDetails', 'Addresses', 'AgentDetails', 'ChainCodes', 'VendorDetails'))
    begin
        exec('truncate table [' + @TableName + ']')
    end 

    set @LastObjectID = (select top 1 [object_id] from sys.tables where [object_id] > @LastObjectID order by [object_id])
end 
```

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2014-04-17T14:42:41.160

截断所有表最困难的部分是删除和重新添加外键约束。

以下查询为与@myTempTable 中的每个表名相关的每个约束创建 drop 和 create 语句。如果您想为所有表生成这些，您可以简单地使用信息模式来收集这些表名。

```
DECLARE @myTempTable TABLE (tableName varchar(200))
INSERT INTO @myTempTable(tableName) VALUES
('TABLE_ONE'),
('TABLE_TWO'),
('TABLE_THREE')

-- DROP FK Contraints
SELECT 'alter table '+quotename(schema_name(ob.schema_id))+
  '.'+quotename(object_name(ob.object_id))+ ' drop constraint ' + quotename(fk.name) 
  FROM sys.objects ob INNER JOIN sys.foreign_keys fk ON fk.parent_object_id = ob.object_id
  WHERE fk.referenced_object_id IN 
      (
         SELECT so.object_id 
         FROM sys.objects so JOIN sys.schemas sc
         ON so.schema_id = sc.schema_id
         WHERE so.name IN (SELECT * FROM @myTempTable)  AND sc.name=N'dbo'  AND type in (N'U'))

 -- CREATE FK Contraints
 SELECT 'ALTER TABLE [PIMSUser].[dbo].[' +cast(c.name as varchar(255)) + '] WITH NOCHECK ADD CONSTRAINT ['+ cast(f.name as varchar(255)) +'] FOREIGN KEY (['+ cast(fc.name as varchar(255)) +'])
      REFERENCES [PIMSUser].[dbo].['+ cast(p.name as varchar(255)) +'] (['+cast(rc.name as varchar(255))+'])'
FROM  sysobjects f
      INNER JOIN sys.sysobjects c ON f.parent_obj = c.id
      INNER JOIN sys.sysreferences r ON f.id = r.constid
      INNER JOIN sys.sysobjects p ON r.rkeyid = p.id
      INNER JOIN sys.syscolumns rc ON r.rkeyid = rc.id and r.rkey1 = rc.colid
      INNER JOIN sys.syscolumns fc ON r.fkeyid = fc.id and r.fkey1 = fc.colid
WHERE 
      f.type = 'F'
      AND
      cast(p.name as varchar(255)) IN (SELECT * FROM @myTempTable) 
```

然后我只需复制要运行的语句 - 但通过一些开发工作，您可以使用游标动态运行它们。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2009-08-11T20:11:21.237

编写数据库脚本要容易得多（甚至可能更快），然后从脚本中删除并创建它。

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2009-08-11T21:21:03.327

制作一个空的“模板”数据库，进行完整备份。当您需要刷新时，只需使用 WITH REPLACE 恢复即可。快速，简单，防弹。如果这里或那里的几个表需要一些基本数据（例如配置信息，或者只是使您的应用程序运行的基本信息），它也会处理。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2008-09-30T21:55:16.477

这是*一种*方法......可能还有其他 10 种更好/更有效的方法，但听起来这种情况很少发生，所以这里......

获取`tables`from的列表`sysobjects`，然后用光标遍历那些，调用`sp_execsql('truncate table ' + @table_name)`each `iteration`。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2014-01-30T17:39:18.307

运行一次注释掉的部分，用您想要截断的表填充 _TruncateList 表，然后运行脚本的其余部分。如果您经常这样做，则需要随着时间的推移清理 _ScriptLog 表。

如果你想要做所有的表，你可以修改它，只需输入 SELECT name INTO #TruncateList FROM sys.tables。但是，您通常不想全部完成。

此外，这将影响数据库中的所有外键，如果它对您的应用程序来说过于生硬，您也可以对其进行修改。这不是为了我的目的。

```
/*
CREATE TABLE _ScriptLog 
(
    ID Int NOT NULL Identity(1,1)
    , DateAdded DateTime2 NOT NULL DEFAULT GetDate()
    , Script NVarChar(4000) NOT NULL
)

CREATE UNIQUE CLUSTERED INDEX IX_ScriptLog_DateAdded_ID_U_C ON _ScriptLog
(
    DateAdded
    , ID
)

CREATE TABLE _TruncateList
(
    TableName SysName PRIMARY KEY
)
*/
IF OBJECT_ID('TempDB..#DropFK') IS NOT NULL BEGIN
    DROP TABLE #DropFK
END

IF OBJECT_ID('TempDB..#TruncateList') IS NOT NULL BEGIN
    DROP TABLE #TruncateList
END

IF OBJECT_ID('TempDB..#CreateFK') IS NOT NULL BEGIN
    DROP TABLE #CreateFK
END

SELECT Scripts = 'ALTER TABLE ' + '[' + OBJECT_NAME(f.parent_object_id)+ ']'+
' DROP  CONSTRAINT ' + '[' + f.name  + ']'
INTO #DropFK
FROM .sys.foreign_keys AS f
INNER JOIN .sys.foreign_key_columns AS fc
ON f.OBJECT_ID = fc.constraint_object_id

SELECT TableName
INTO #TruncateList
FROM _TruncateList

SELECT Scripts = 'ALTER TABLE ' + const.parent_obj + '
    ADD CONSTRAINT ' + const.const_name + ' FOREIGN KEY (
            ' + const.parent_col_csv + '
            ) REFERENCES ' + const.ref_obj + '(' + const.ref_col_csv + ')
'
INTO #CreateFK
FROM (
    SELECT QUOTENAME(fk.NAME) AS [const_name]
        ,QUOTENAME(schParent.NAME) + '.' + QUOTENAME(OBJECT_name(fkc.parent_object_id)) AS [parent_obj]
        ,STUFF((
                SELECT ',' + QUOTENAME(COL_NAME(fcP.parent_object_id, fcp.parent_column_id))
                FROM sys.foreign_key_columns AS fcP
                WHERE fcp.constraint_object_id = fk.object_id
                FOR XML path('')
                ), 1, 1, '') AS [parent_col_csv]
        ,QUOTENAME(schRef.NAME) + '.' + QUOTENAME(OBJECT_NAME(fkc.referenced_object_id)) AS [ref_obj]
        ,STUFF((
                SELECT ',' + QUOTENAME(COL_NAME(fcR.referenced_object_id, fcR.referenced_column_id))
                FROM sys.foreign_key_columns AS fcR
                WHERE fcR.constraint_object_id = fk.object_id
                FOR XML path('')
                ), 1, 1, '') AS [ref_col_csv]
    FROM sys.foreign_key_columns AS fkc
    INNER JOIN sys.foreign_keys AS fk ON fk.object_id = fkc.constraint_object_id
    INNER JOIN sys.objects AS oParent ON oParent.object_id = fkc.parent_object_id
    INNER JOIN sys.schemas AS schParent ON schParent.schema_id = oParent.schema_id
    INNER JOIN sys.objects AS oRef ON oRef.object_id = fkc.referenced_object_id
    INNER JOIN sys.schemas AS schRef ON schRef.schema_id = oRef.schema_id
    GROUP BY fkc.parent_object_id
        ,fkc.referenced_object_id
        ,fk.NAME
        ,fk.object_id
        ,schParent.NAME
        ,schRef.NAME
    ) AS const
ORDER BY const.const_name

INSERT INTO _ScriptLog (Script)
SELECT Scripts
FROM #CreateFK

DECLARE @Cmd NVarChar(4000)
    , @TableName SysName

WHILE 0 < (SELECT Count(1) FROM #DropFK) BEGIN
    SELECT TOP 1 @Cmd = Scripts 
    FROM #DropFK

    EXEC (@Cmd)

    DELETE #DropFK WHERE Scripts = @Cmd
END

WHILE 0 < (SELECT Count(1) FROM #TruncateList) BEGIN
    SELECT TOP 1 @Cmd = N'TRUNCATE TABLE ' +  TableName
        , @TableName = TableName
    FROM #TruncateList

    EXEC (@Cmd)

    DELETE #TruncateList WHERE TableName = @TableName
END

WHILE 0 < (SELECT Count(1) FROM #CreateFK) BEGIN
    SELECT TOP 1 @Cmd = Scripts 
    FROM #CreateFK

    EXEC (@Cmd)

    DELETE #CreateFK WHERE Scripts = @Cmd
END 
```

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2018-07-04T13:23:25.033

这有点晚了，但它可能会帮助某人。我有时会创建一个过程，它使用 T-SQL 执行以下操作：

1.  将所有约束存储在临时表中
2.  放弃所有约束
3.  截断除某些不需要截断的表之外的所有表
4.  重新创建所有约束。

我已经在我的博客上列出了[这里](http://mohitleekha.blogspot.com/2018/07/truncate-microsoft-sql-database-without.html)

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2009-07-02T16:39:05.867

我不明白为什么清除数据比删除和重新创建每个表的脚本更好。

或者备份您的空数据库并将其恢复到旧数据库

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2012-10-24T08:21:31.903

在截断表之前，您必须删除所有外键。使用此[脚本](http://social.technet.microsoft.com/wiki/contents/articles/2958.script-to-create-all-foreign-keys-en-us.aspx) 生成最终脚本以删除和重新创建数据库中的所有外键。请将@action 变量设置为“CREATE”或“DROP”。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2012-11-23T07:16:49.323

select 'delete from ' +TABLE_NAME from INFORMATION_SCHEMA.TABLES where TABLE_TYPE='BASE TABLE'

结果从何而来。

复制并粘贴到查询窗口并运行命令

# agile - 帮助我了解 QA 在 Scrum 中的工作方式

> ID：155250
> 
> 赞同：64
> 
> 时间：2008-09-30T21:50:13.150
> 
> 标签：agile, scrum

显然我们使用 Scrum 开发方法。一般是这样的：

开发人员为了完成他们的任务而苦苦挣扎。通常，这些任务需要大部分 sprint 才能完成。QA 缠着 Dev 发布他们可以测试的东西，Dev 最终在 sprint 结束前一两天向 QA 抛出了一些错误的代码，剩下的时间用来修复 QA 发现的错误。QA 永远无法按时完成任务，sprint 很少能按时发布，Dev 和 QA 在 sprint 结束时的日子过得很痛苦。

当可发布的开发任务占据了 sprint 的大部分时间时，scrum 应该如何工作？

感谢大家参与讨论。由于这是一个非常开放的问题，似乎没有一个“答案”——下面有很多很好的建议。我将尝试总结我的一些“带回家”的观点并做出一些澄清。

（顺便说一句 - 这是放置这个的最佳位置还是我应该把它放在“答案”中？）

思考/行动的要点：

*   需要确保开发人员的任务尽可能小（细化）。
*   Sprint 长度应根据平均任务长度适当调整（例如，1 周任务的 sprint 应至少为 4 周）
*   团队（包括 QA）需要努力提高估算的准确性。
*   考虑并行进行单独的 QA 冲刺，但如果这对团队最有效，则可以抵消
*   单元测试！

* * *

## 回答 #1

> 赞同：40
> 
> 时间：2008-09-30T21:59:37.717

我的观点是你有一个估计问题。似乎缺少测试每个功能的时间，并且在计划冲刺时只考虑构建部分。

我并不是说这是一个容易解决的问题，因为它比任何事情都更常见。但可以帮助的事情是：

*   将 QA 视为开发团队的成员，并将他们更紧密地包含在 sprint 计划和估算中。

*   “可发布的开发任务”不应占用大部分 sprint。完整的工作功能应该。尝试为每种任务收集有关开发时间与 QA 时间的指标，并在估计未来的冲刺时使用这些指标。

*   您可能需要查看您的积压工作以查看您是否有非常粗粒度的功能。尝试将它们划分为可以轻松估计和测试的较小任务。

总而言之，您的团队似乎还没有找到其真正的速度，因为在为 sprint 进行估计和规划时没有考虑到一些任务。

但最终，估计不准确是您在基于敏捷或基于瀑布的项目中发现的一个棘手的项目管理问题。祝你好运。

* * *

## 回答 #2

> 赞同：35
> 
> 时间：2008-09-30T23:05:14.157

这里的聚会有点晚了，但这是我根据你写的内容的看法。

现在，Scrum 是一种项目管理方法，而不是一种开发方法。但在我看来，关键是要有适当的开发流程。没有一个，您将大部分时间花在**反应**而不是构建上。

我是一个测试优先的人。在我的开发过程中，我首先构建测试来执行需求和设计决策。**你的**团队是如何执行这些的？我在这里要说明的一点是，您根本不能**“把东西扔到栅栏上”**并期望除了失败之外的任何事情。这种失败要么是由测试团队（由于没有很好地测试，因此让问题溜走），要么是由开发人员（由于没有构建解决问题的产品）。我并不是说你**必须先**编写测试——我不是激进分子或测试优先的布道者——但我是说你**必须**有一个流程来生成高质量、经过测试、准备好生产的代码，当你达到迭代的结束。

在我称之为**死亡螺旋方法**的开发方法中，我一直是**正确**的。多年来，我以这种模式为政府（美国）开发了软件。它不能很好地工作，它要花很多钱，它会产生迟到的代码，糟糕的代码，并且对士气没有任何帮助。当您将所有时间都花在修复本来可以避免的错误上时，您将无法取得任何进展。我完全被这件事打败了。

 **您不希望 QA 发现您的问题。你真的想让他们失业。我的目标是让 QA 大吃一惊，因为一切正常。诚然，这是一个目标。在实践中，他们会找到东西。我不是超人。我犯错了。

回到调度...

在我目前的工作中，我们做 Scrum，我们只是不这么称呼它。我们在这里不喜欢标签，但我们喜欢按时生产高质量的代码。每个人都在船上。我们告诉 QA 我们将准备测试什么以及何时测试。如果他们提前两周来敲门，他们可以和手说话。每个人都知道时间表，每个人都知道发布中的内容，每个人都知道产品必须按照宣传的方式工作，然后才能进入 QA。那是什么意思？你告诉 QA “不要费心测试 XYZ - 它已经坏了，直到发布 C 版才会修复”，如果他们去测试，你把他们指向那个声明并告诉他们不要浪费你的时间。苛刻，也许，但有时是必要的。我不是要粗鲁，但每个人都需要知道“规则”

您的管理层必须参与其中。如果他们不是，你就会遇到麻烦。QA 无法运行该节目，开发组也无法完全运行它。所有的组（即使这些组每个组只有一个人或一个戴多个帽子的人）都需要在同一页面上：客户、测试团队、开发人员、管理层和其他任何人。通常，超过一半的战斗是沟通。

也许你在 sprint 中的努力超出了你所能完成的范围。情况可能就是这样。你为什么这样做？满足时间表？如果是这样，那就是管理层需要介入并解决问题的地方。如果您要提供 QA 错误代码，请期望他们将其扔回去。最好给他们 3 件有用的东西，而不是 8 件未完成的东西。目标是产生一些在每次迭代中完全实现的功能，而不是把一堆半途而废的东西放在一起。

我希望收到它的本意——作为鼓励而不是咆哮。就像我提到的那样，我一直在你所在的地方，这并不有趣。但有希望。你可以在一个 sprint 中扭转局面，也许两个。也许您不会在下一个 sprint 中添加任何新功能，而只是修复损坏的部分。你必须作为一个团队来决定。

编写测试代码的另一个小插件：自从采用了“先编写测试”的方法后，我发现自己对我的产品更加放松和自信了。当我所有的测试都通过时，我就有了一种没有它们就无法拥有的自信。

祝你好运！

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2008-11-07T18:23:40.573

在我看来，在需要 QA 功能测试以便在 sprint 中“完成”给定功能的场景中存在资源分配问题。到目前为止，在我发现的任何与 QA 相关的 scrum 讨论中似乎都没有人解决这个问题，而且这里的原始问题几乎是相同的（至少是相关的），所以我想提供一个部分答案并稍微扩展这个问题。

至于关于完成完整冲刺的开发任务的具体原始问题 - 如果 QA 的功能测试是您对“完成”的定义的一部分，那么放松这些任务的一般建议似乎是有道理的。假设一个 4 周的 sprint，如果测试多个开发人员的多个功能需要大约一周的时间，那么似乎开发任务需要大约 3 周，然后是延迟一周的测试任务大约需要 1 周是答案。QA 当然会尽快开始，因为我们认识到从最后一组交付的功能开始，会有大约一周的延迟。我意识到我们希望尽快为 QA 提供功能，这样您就不会在 sprint 中遇到这种类似瀑布的场景，但现实情况是开发通常无法实现，值得在 sprint 的 1 到 3 周之前向 QA 交付功能。当然，这里和那里都有一些零碎的东西，但大部分工作是 2-3 周的开发，然后剩下大约一周的测试。

所以这是资源分配问题，也是我对该问题的扩展——在上述场景中，QA 有时间测试 sprint 的计划功能（价值 3 周的开发任务，最后一周用于测试最后交付的功能）。还让我们假设 QA 在 1 周的开发后开始获得一些可测试的功能 - 但是第 1 周的 QA 和第 4 周的开发呢？

如果 QA 功能测试是 sprint 中某个功能“完成”定义的一部分，那么这种低效率似乎是不可避免的。QA 将在第 1 周大部分闲置，而开发将在第 4 周大部分闲置。当然，有一些事情自然会填补这个时间，比如错误修复和验证、设计/计划等，但我们基本上是以 75% 的容量调度我们的资源。

显而易见的答案似乎是开发和 QA 的冲刺重叠，因为现实情况是 QA 在某种程度上总是落后于开发。在 QA 冲刺之后向产品所有者和其他人进行演示，因为我们希望在展示之前对功能进行测试。这似乎允许更有效地使用开发和质量保证，因为我们没有浪费太多时间。假设我们想让开发人员继续开发和测试人员测试，我找不到更好的实用解决方案。也许我错过了一些东西，我希望有人可以为我阐明这一点——否则，这种僵化的 scrum 方法似乎是有缺陷的。谢谢。

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2008-09-30T21:56:22.777

希望您通过在每个 sprint 中处理更少的开发任务来解决此问题。这导致了以下问题：谁在设置开发者的目标？为什么 Dev 始终未能实现这些目标？

如果开发人员没有设定自己的目标，那就是他们总是迟到的原因。这不是练习 Scrum 的理想方式。这只是增量开发，具有大型的、按期限驱动的可交付成果，开发人员没有实际的利益相关者责任。

如果开发人员因为知道的不够多而无法设定自己的目标，那么他们必须提前更多地参与进来。

Scrum 依赖于[敏捷宣言](http://agilemanifesto.org/)中概述的四个基本原则。

1.  交互很重要——这意味着开发人员、质量保证、项目管理和最终用户需要更多地交谈并相互交谈。软件是用计算机的神秘语言对知识进行编码的过程。要对知识进行编码，开发人员必须具备知识。[为什么你认为我们称它为“代码”？] Scrum 不是一种“编写规范 - 跨越横梁”的方法。这是 ANTI-“编写规范 - 抛出横梁”

2.  工作软件很重要——这意味着开发人员咬掉的每个部分都必须导致一个*工作*版本。不是一组供 QA 处理的错误修复，而是工作软件。

3.  客户协作——这意味着开发人员必须与业务分析师、最终用户、企业所有者以及所有能够帮助他们了解他们正在构建的东西的人合作。截止日期并不像接下来交给客户的事情那么重要。如果客户需要 X，那是每个人最优先要做的事情。如果项目计划说构建 Y，那就是一堆乱七八糟的东西。

4.  响应变化——这意味着客户可以重新安排后续冲刺的优先级。他们无法重新安排进程中的 sprint（这太疯狂了），但以下所有 sprint 都是更改优先级的候选者。

如果客户开车，那么最后期限就会变得不那么人为的“项目里程碑”，而更多的是“我们首先需要 X，然后是 Y，Z 部分的这个东西，我们不再需要那个了。现在我们有了 W，Z 是多余的。”

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2008-11-13T04:12:25.220

Scrum 规则说，所有 Sprint 项目都需要在 Sprint 结束时经过“全面测试，可能实现的功能”才能被认为是完整的。Sprint 总是按时结束，团队没有获得荣誉，也不允许在 Sprint 审查中展示任何不完整的内容 - 包括 QA。

从技术上讲，这就是您所需要的。一个团队承诺一定数量的工作，最终在 Sprint 结束前两天将其提交给 QA，而 QA 没有及时完成。所以 Sprint 的输出为零，他们必须走到客户面前，承认他们一个月的工作没有什么可展示的。

下一轮，你会打赌他们会选择更少的工作，并弄清楚如何将其提交给 QA，以便按时完成。

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2014-02-18T23:38:50.480

作为一名从事敏捷项目工作 2.5 年的 QA，这是一个非常困难的问题，我仍然没有所有答案。

我作为“三人组”的一部分工作（两名开发人员配对程序 + 一名 QA），并且我参与了在两周迭代开始时的计划会议中分配故事和估计。正如 adrianh 上面提到的，对于 QA 来说，在最初的 sprint 计划中让他们的声音被听到是很重要的。这可能会很困难，特别是如果您与个性非常强大的开发人员一起工作，但是 QA 必须在真正意义上保持自信（即不咄咄逼人或强硬，但尊重地寻求理解真相/PO 和开发人员/技术专家，同时让自己明白了）。我提倡在计划期间首先制定 QA 任务，以鼓励测试驱动的心态——QA 可能必须真正提出自己才能得到采用。

1.  QA 被听到，而不是被降级为被问到“那么你将如何测试它？” 在开发人员说出他们的作品（瀑布心态）之后。

2.  它允许 QA 提出测试想法，同时检查接受标准的可测试性，而真相/PO 存在（我确实说过他们必须出席计划会议，不是吗？！）填补任何理解上的空白。

3.  它为测试驱动方法提供了基础——在测试方法被阐明并分配给开发人员之后，开发人员可以考虑他们将如何生成代码来通过这些测试。

4.  如果步骤 1 - 3 是您在其余迭代中唯一的 TDD 活动，那么您仍然比 Steve 在第一篇文章中假设的场景好一百万倍；“开发人员为了完成他们的任务而绞尽脑汁。通常这些任务需要大部分 sprint 才能完成。QA 缠着 Dev 发布他们可以测试的东西，Dev 最终在 sprint 结束前一两天向 QA 抛出一些错误代码并花费其余时间修复 QA 发现的错误”

不用说，这对 QA 有一些警告；

1.  他们必须准备好让他们的测试想法受到 Devs 和 Truth/PO 的挑战并达成妥协；“QA 警察”的态度不会在敏捷团队中流行。

2.  QA 任务必须达到一个艰难的平衡，既不能太详细也不能太笼统（任务可以写在卡片上，然后在“散热器板”上进行讨论，并在日常站立会议上讨论——它们需要从“进行中”转移到在迭代期间“完成”）。

3.  QA 需要为计划/评估会议做准备。不要指望能够为看不见的用户故事突然出现并产生一种测试方法！开发人员似乎确实能够做到这一点，因为他们的任务通常更加明确 - 例如“将 x 模块更改为与 z 组件的接口”或“重构 y 方法”。作为 QA，您需要在计划之前熟悉引入/更改的功能，以便了解测试的范围以及您可能应用的测试设计技术。

4.  自动化您的测试并在迭代的前两三天内编写并“失败”几乎是必不可少的，或者至少与开发人员准备好代码的时间相一致。然后，您可以运行 test/s 并查看它们是否按预期通过（正确的 QA TDD）。这就是在迭代结束时避免迷你瀑布的方法。您应该在开发人员开始编码之前或在他们开始编码之前向他们演示测试，以便他们知道目标是什么。

5.  我说 4 是“几乎必不可少的”，因为有时可以通过预期行为的手动清单（我敢说脚本！）成功实现相同的目标 - 关键是提前与开发人员分享这一点；继续和他们说话！

关于上面关于任务主题的第 2 点，我尝试创建大小为 1/2 小时到 2 小时的任务，每个任务对应于可演示的工作，例如“添加检查不正确密码到自动测试 - 2小时”。虽然这有助于我组织我的工作，但其他团队成员批评它过于详细，并且在我站起来时会产生影响，要么从前一天开始完成多个任务，要么根本无法移动任何任务，因为我还没有接触到它们。人们真的希望在每日站会中看到稳步进展的感觉，因此在 1/2 天或 1 天的块内创建任务更有帮助（但您可能会保留自己的“微任务”列表以完成您在站立时用于沟通整体进展的较大任务的一部分）。

关于上述第 4 点和第 5 点；你早早准备的自动化测试或手动检查表应该只涵盖快乐的路径或关键的验收标准。一旦这些通过，您就可以为迭代结束时的最后一轮“探索性测试”计划额外的任务，以检查边缘情况。开发人员在此期间所做的事情是有问题的，因为就他们而言，除非并且直到您发现错误，否则它们是“代码完整的”。一些敏捷从业者主张首先选择边缘案例，尽管这也可能存在问题，因为如果时间用完，您可能无法保证已经交付了验收标准。这是取决于用户故事的上下文和您作为 QA 的经验的精细平衡决策之一！

As I said at the beginning I still don't have all the answers but hope the above provide some pointers born out of hard experience!

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2009-12-10T23:00:16.183

我们解决了这个问题如下： - 产品待办事项中的每个项目都必须有适合标准或验收标准，没有这些，我们不会开始冲刺 - 测试人员是我们团队的一部分，对于每个产品待办事项项目，他都会创建测试任务（1 个或多个，基于验收标准）以及估计和要测试的项目的链接 - 在每日 Scrum 期间，所有完成的任务都放在“待测试”列中 - 我们从不做任务耗时超过 16 小时；估计较长的任务被拆分

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2008-09-30T22:07:17.853

听起来您的开发团队在发布给 QA 之前可能没有自己做足够的测试。如果您所有的单元测试都通过了，那么 QA 周期应该会比较顺利，不是吗？他们会发现一些集成错误，但应该不会很多，对吧？

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2008-09-30T22:15:56.117

我认为这里有几个问题。首先，我认为也许开发人员的任务要么不够精细，要么估计不好，或者两者兼而有之。Scrum 中 sprint 的全部目的是能够在 sprint 结束时展示可行的代码。我提到的两个问题都可能导致代码错误。

如果开发人员在 sprint 快结束时发布错误代码，我还会查看：

*   产品负责人是否真的让开发人员负责完成他们的任务。那是 PO 的工作，如果这没有发生，那么开发人员就会懈怠。
*   开发人员是否使用任何类型的 TDD。如果没有，那可能会有很大帮助。让开发人员养成测试代码的习惯。我们在我工作的地方遇到了这个问题，我的团队专注于在重要领域进行 TDD，这样我们以后就不必让其他人去做
*   任务/用户故事是否过于笼统？任务分解中的摆动空间会导致开发人员马虎。同样，这有点像 PO 问题。

我过去听说过的一个想法是使用 QA 人员作为 Scrummaster。他们将出席每日站立会议，并可以了解开发人员的情况。他们可以解决 PO 的问题（假设 PO 可以充分完成他们的工作）。

我不禁觉得你需要在 QA 和你的 Scrum 团队之间进行更多的合作。听起来测试只发生在最后，这是一个问题。让 QA 成为团队的一部分将有助于确定可以更早、更好地测试的东西。

我也觉得你对产品负责人有意见。他们必须在那里确保每个人都朝着正确的方向前进。他们应该确保良好的合作，不仅在 QA 和开发人员之间，而且在开发人员之间。

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2008-10-05T15:14:03.007

> “当可发布的开发任务占据了 sprint 的大部分时间时，scrum 应该如何工作？”

正如你所发现的那样——它运行得不是很好:-) 你描述的过程对我来说听起来不像 Scrum——或者至少不像 Scrum 做得很好。

根据您的描述，我不确定 QA 人员是团队的一部分 - 还是单独的小组。

如果他们是一个单独的组，那么这可能是问题的很大一部分。他们不会参与团队对完成任务的承诺——以及与产品所有者相关的范围谈判。如果没有团队中的 QA 技能，我从来没有见过敏捷团队取得成功。通过让开发人员具备大量测试/QA 技能 - 或者通过在团队中拥有一个或三个嵌入式 QA 人员。

如果他们*在*团队中，那么他们需要在最初的冲刺计划中更多地听到他们的声音。到目前为止，产品所有者和团队应该清楚你过度使用了。

如果是我，我会尝试一些事情：

*   让团队中的 QA/测试人员加入（如果他们还没有）
*   与产品负责人和团队就什么算是“完成”进行长时间的交谈。听起来有些开发人员仍处于“移交给 QA”的 pre-scrum 心态”== 完成。
*   将故事分解成更小的块 - 更容易发现估计错误
*   考虑运行较短的冲刺 - 因为很少和经常更容易跟踪和学习。

您可能还会发现这些[关于平滑 scrum 燃尽图的技巧](https://stackoverflow.com/questions/91257/scrum-burndown-issues)很有用。

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2008-09-30T21:53:51.677

将任务拆分为更小的任务。

此外，QA 可以创建测试用例供 Dev 进行测试。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2008-09-30T22:21:37.443

要考虑的一个想法是让 QA 在主要开发之后进行一次迭代。这在我们的环境中运作良好。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2013-12-13T21:55:52.120

在这里我想说，一种尺寸并不适合所有人。每个团队处理 QA 的方式都不同。这在很大程度上取决于您正在从事的项目，无论是小项目还是大项目。它是否需要广泛的回归、用户接受和探索性测试，或者您需要测试的场景很少。让我重申一下，在敏捷中，通才优先于专家。那是什么？因为在项目期间有一段时间你没有任何东西要测试，所以那个时候你可能正在做其他事情。即使你是一个铁杆程序员，你也可能在做测试。

我们如何处理它？我们有常规的 2 周冲刺。一周后开始测试开发人员在一周内完成的任务。现在测试人员不断向我们的问题跟踪器添加问题，完成冲刺任务的开发人员开始挑选这些错误。在 sprint 结束时，我们主要完成了我们的 sprint 任务以及所有关键和主要错误。

那么测试人员二在 sprint 的第一周做什么呢？

好吧，总有一些事情要测试。我们在待办事项中有测试任务，其中可能包括一些探索性测试。许多人不重视探索性测试，但这对于打造优质产品极为重要。优秀的测试人员会为自己创建任务并找到出错的可能性并进行测试。

希望有帮助！

# c# - 什么是 C# 中的“< >”语法

> ID：155260
> 
> 赞同：6
> 
> 时间：2008-09-30T21:51:48.810
> 
> 标签：c#, .net

我一直在学习 C# 的基础知识，但还没有很好地解释这是什么：

```
var l = new List<string>(); 
```

我不知道是在`<string>`做什么，也不知道是不是`List`在施展魔法。我还看到在`< >`标签中抛出了物体。

有人可以用例子向我解释一下吗？

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2008-09-30T22:00:04.797

这是 C# 的通用语法。

基本概念是它允许您使用类型占位符并在编译时替换实际的真实类型。

例如，旧方式：

```
ArrayList foos = new Arraylist();
foos.Add("Test"); 
```

通过使 ArrayList 存储 System.Objects 列表（所有事物的基本类型 .NET）来工作。

因此，当从列表中添加或检索对象时，CLR 必须将其强制转换为对象，基本上真正发生的是：

```
foos.Add("Test" as System.Object);
string s = foos[1] as String. 
```

这会导致铸造性能损失，而且它也不安全，因为我可以这样做：

```
ArrayList listOfStrings = new ArrayList();
listOfStrings.Add(1);
listOfStrings.Add("Test"); 
```

这将编译得很好，即使我在 listOfStrings 中放了一个整数。

泛型改变了这一切，现在使用泛型我可以声明我的集合期望的类型：

```
List<int> listOfIntegers = new List<int>();
List<String> listOfStrings = new List<String>();

listOfIntegers.add(1);

// Compile time error.
listOfIntegers.add("test"); 
```

这提供了编译时类型安全，并避免了昂贵的转换操作。

您利用它的方式非常简单，尽管有一些高级边缘案例。基本概念是通过使用类型占位符使您的类类型不可知，例如，如果我想创建一个通用的“添加两件事”类。

```
public class Adder<T>
{
   public T AddTwoThings(T t1, T t2)
   {
       return t1 + t2;
   }
}

Adder<String> stringAdder = new Adder<String>();
Console.Writeline(stringAdder.AddTwoThings("Test,"123"));

Adder<int> intAdder = new Adder<int>();
Console.Writeline(intAdder.AddTwoThings(2,2)); 
```

对于泛型的更详细的解释，我不能推荐足够多的书 CLR via C#。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-30T21:59:55.937

它是*泛型*- 它是类型参数化的一种形式。在您的示例中，它使 l 引用字符串列表-该列表将只包含字符串：编译器（几乎）将其视为 API 文档提到“T”的任何地方实际上都说“字符串”。因此，您只能向其中添加字符串，并且如果您使用索引器，则不需要强制转换为字符串等。

老实说，在在线论坛上详细介绍仿制药几乎是不可能的。（在深度 C# 中，我花了将近 50 页来讨论泛型。）但是，有了特性的名称，您应该可以更好地了解更多信息。MSDN [“C# 泛型简介”](http://msdn.microsoft.com/en-us/library/ms379564(VS.80).aspx)可能是一个很好的起点。

在 SO 上询问有关泛型的具体问题可能会产生良好的结果——我只是认为它不能真正在一个问题/答案中得到正确涵盖。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-30T21:57:27.207

这是 .NET 泛型。< > 中的类型表示列表中包含的元素的类型。

使用 ArrayList 你必须将元素投射到里面......

```
int x = (int)myArrayList[4]; 
```

使用 List 您可以避免该步骤，因为编译器已经知道类型。

```
int x = myList[4]; 
```

泛型在 .NET 2.0 及更高版本中可用。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-30T21:58:20.603

那些是泛型的。您正在制作一个仅包含字符串的列表。你也可以说

```
List<int> 
```

并得到一个只包含整数的列表。

泛型是一个巨大的话题，对于一个单一的答案来说太大了。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-30T21:59:20.757

这些被称为泛型（特别是[List](http://msdn.microsoft.com/en-us/library/6sh2ey19.aspx)是一个泛型类）。

从 MSDN 阅读

*   [泛型（C# 编程指南）](http://msdn.microsoft.com/en-us/library/512aeb7t.aspx)
*   [C# 泛型简介](http://msdn.microsoft.com/en-us/library/ms379564.aspx)
*   [.NET Framework 中的泛型](http://msdn.microsoft.com/en-us/library/ms172192.aspx)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-30T22:00:47.807

这是在行动的泛型。常规列表存储对象类型的项目。这需要类型之间的转换。这也将允许您将任何类型的项目存储在列表的一个实例中。当您遍历该列表中的项目时，您无法确定它们都是某种类型（至少在不强制转换每个项目的情况下不能确定）。例如，假设您创建了一个这样的列表：

```
List listOfStrings = new List(); 
```

没有什么能阻止某人做这样的事情：

```
listOfStrings.add(6); //Not a string 
```

通用列表将允许您指定强类型列表。

```
List<string> listOfStrings = new List<string>();
listOfStrings.add("my name"); //OK
listofStrings.add(6); //Throws a compiler error 
```

这里有一个更彻底的[例子](http://msdn.microsoft.com/en-us/library/ms379564(VS.80).aspx)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-30T22:04:18.813

< > 用于泛型。在您的具体示例中，这意味着 List 是字符串列表，而不是整数列表。

泛型用于允许类型成为泛型。它在 Collections 中使用 ALOT 以允许它们采用不同的类型，以便它们可以像普通数组一样运行，并且仍然可以捕获在编译时分配的无效类型。基本上它允许一个类说“我需要与某个特定类型 T 相关联，但我不想硬编码该类型是什么，并让用户选择它。”。例如，一个简单的数组可能看起来像：

```
public class MyArray<T> {
    private T[] _list;

    public MyArray() : this.MyArray(10);
    public MyArray(int capacity)
    { _list = new T[capacity]; }

    T this[int index] {
        get { return _list[index]; }
        set { _list[index] = value; }
    }
} 
```

在这里，我们有一个类型为 T 的私有列表，可以像普通数组一样使用我们的类进行访问。我们不关心它是什么类型，这对我们的代码无关紧要。但是使用该类的任何人都可以将其用作`MyArray<string>`创建字符串列表，而其他人可能会将其用作`MyArray<bool>`并创建标志列表。

# netbeans - 如何在 netbeans 6.5 中隐藏文本限制线？

> ID：155271
> 
> 赞同：7
> 
> 时间：2008-09-30T21:55:32.123
> 
> 标签：netbeans

有没有办法在 netbeans 6.5 中隐藏文本限制线？

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2010-07-14T10:00:56.933

在 NetBeans 6.9 中，将 Right Margin 设置为 0 会有效地隐藏文本限制线。
在 Preferences > Editor > Formatting > All Languages > Right Margin 中设置值。
*（Mac OS X 10.6.4、NetBeans 6.9）*

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-01-31T17:28:56.063

行没有移动到 200 列，但您可以将其隐藏，将其颜色设置为与背景相同

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2010-12-06T11:49:41.330

您可以将其设置为 0。因此它将不可见。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-09-30T22:04:40.933

您是在谈论通过右侧运行的线，默认情况下在 80 列点？即选项-> 编辑器-> 缩进-> 右边距。我将其设置为 200 列，将其推离屏幕右侧。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-07-31T03:43:02.420

嗨~我发现了如何隐藏“文本限制线”:)

1.  工具->选项->导出（弹出窗口）->浏览..（选择目标“ *ccc.zip* ”文件）选择导出选项：检查“编辑器”->确定

2.  编辑“ *ccc.zip* ”文件中的xml 文件“ **\Editors\Preferences\org-netbeans-modules-editor-settings-CustomPreferences.xml ”。**

     *```
    <entry javaType="java.lang.Boolean" name="text-limit-line-visible" xml:space="preserve">
    <value><![CDATA[false]]></value></entry> 
    ```* 
**   工具 -> 选项 -> 导入“ *ccc.zip* ”文件* 

 *完毕

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2018-10-11T10:20:54.387

至于现在（18 年 10 月）在 NetBeans **8.2** + **9**中，您可以通过转到选项 -> 字体和颜色 -> 突出显示 -> 文本限制线 -> 前景来隐藏*文本限制线或实际更改其颜色*

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2015-05-27T08:14:25.320

记得在导出 ccp.zip 之前转到工具、选项、字体和颜色、突出显示选项卡、选择文本限制线...。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2017-10-24T07:16:06.230

有一种简单的方法可以禁用 NetBeans 针对行数生成的警告。

转到**工具 > 选项 > 编辑器 > 提示**

找到复选框**太多行**>取消选中复选框

并单击**应用**。

享受 ：）

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2021-11-17T15:59:19.520

您是否尝试查看您的项目属性是否具有覆盖全局属性的格式？

见下文： [https ://bz.apache.org/netbeans/show_bug.cgi?id=223329](https://bz.apache.org/netbeans/show_bug.cgi?id=223329)

# apache-flex - 如何在 Flex AdvancedDataGrid 中排序 - 未调用回调

> ID：155279
> 
> 赞同：3
> 
> 时间：2008-09-30T21:57:23.353
> 
> 标签：apache-flex, sorting, advanceddatagrid

我有一个使用客户数据分组的 AdvancedDataGrid。并非所有组都在层次结构中处于同一级别，组可以同时包含组和成员。我们有一个排序回调，但除了最叶级别的组外，它不会被调用。有关示例，请参见下面的代码 - 展开所有组，然后单击“出生日期”上的排序列以按出生日期进行反向排序。（奇怪的是，出于某种深不可测的原因，第一个升序排序有效。）

我们不会因与组成员处于同一级别分组的任何数据而被调用。

我该如何解决？

谢谢。

```
<?xml version="1.0" encoding="utf-8"?>
<mx:Application xmlns:mx="http://www.adobe.com/2006/mxml" 
     layout="vertical" 
     verticalAlign="middle" 
     backgroundColor="white" >
  <mx:Script>
    <![CDATA[
      import mx.controls.advancedDataGridClasses.AdvancedDataGridColumn;
      import mx.collections.HierarchicalData;
      import mx.utils.ObjectUtil;

      private var arrData : Array = [
        { name: "User A", dob: "04/14/1980" },
        { name: "User B", dob: "01/02/1975" },
        { name: "Group A", children: [
          { name: "User E", dob: "09/13/1972" },
          { name: "User F", dob: "11/22/1993" }
          ]
        },
        { name: "Group B", children: [
          { name: "Group B1", children: [
            { name: "User I", dob: "01/23/1984" },
            { name: "User J", dob: "11/10/1948" }
            ]
          },
          { name: "User G", dob: "04/09/1989" },
          { name: "User H", dob: "06/20/1963" }
          ]
        },
        { name: "User C", dob: "12/30/1977" },
        { name: "User D", dob: "10/27/1968" }
      ];

      private function date_sortCompareFunc(itemA:Object, itemB:Object):int
      {
        if ( itemA.hasOwnProperty("dob") && itemB.hasOwnProperty("dob"))
        {
          var dateA:Date = new Date(Date.parse(itemA.dob));
          var dateB:Date = new Date(Date.parse(itemB.dob));
          return ObjectUtil.dateCompare(dateA, dateB);
        }
        else if ( itemA.hasOwnProperty("dob"))
        {
          return 1;
        }
        else if (itemB.hasOwnProperty("dob"))
        {
          return -1;
        }
        return ObjectUtil.stringCompare(itemA.name, itemB.name);
      }

      private function date_dataTipFunc(item:Object):String
      {
        if (item.hasOwnProperty("dob"))
        {
          return dateFormatter.format(item.dob);
        }
        return "";
      }

      private function label_dob(item:Object, col:AdvancedDataGridColumn):String
      {
        var dob:String="";
        if(item.hasOwnProperty("dob"))
        {
          dob=item.dob;
        }
        return dob;
      }
    ]]>
  </mx:Script>

  <mx:DateFormatter id="dateFormatter" formatString="MMMM D, YYYY" />

  <mx:AdvancedDataGrid id="adgTest" dataProvider="{new HierarchicalData(this.arrData)}" designViewDataType="tree" width="746" height="400">
    <mx:columns>
      <mx:AdvancedDataGridColumn headerText="Name"  dataField="name"/>
      <mx:AdvancedDataGridColumn dataField="dob" headerText="Date of birth" 
           labelFunction="label_dob" 
           sortCompareFunction="date_sortCompareFunc"
           showDataTips="true" 
           dataTipFunction="date_dataTipFunc" />

    </mx:columns>
  </mx:AdvancedDataGrid>
</mx:Application> 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-09-10T17:56:01.107

似乎第一行包含空数据或空字符串，并且高级数据网格设置为使用分组数据，然后排序函数不会被调用。

是的，这有点小技巧，但是如果您可以放入不切实际的（例如 1770 年 1 月 1 日），您可以在数据库/文件读取/数据输入级别插入的恒定数据，然后使用列 labelFunction 来如果数据与该列匹配，则呈现为 null，它应该可以工作，或者至少会调用排序函数。

```
 public function dateCellLabel(item:Object, column:AdvancedDataGridColumn):String
    {
        var date:String = item[column.dataField];

        if (date=="1/1/1770") 
            return null; 
        else
            return  date;
    } 
```

很抱歉这么晚才回答这个问题，但至少如果其他人试图找到答案，他们可能会看到这个。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-01T04:52:20.733

这与 SortCompareFunction 的逻辑有关。

放置`dob:"01/01/1970"`所有组节点，排序按预期工作，对吗？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-03-16T16:54:58.940

我不认为问题与使用空字符串或空字符串值（它们是完全有效的值）对分组数据进行排序有关；文档清楚地说明了所代表的属性`dataField`必须是 dataProvider [item] 上的有效属性，即它必须存在，null 或其他。

虽然我给 RaySir 我的投票，但我不太同意这是一个 hack，而是你正在规范化你的数据，我认为这是一个非常好的表示层的事情。

这是一个重新设计的示例：

```
<?xml version="1.0" encoding="utf-8"?>
<mx:Application xmlns:mx="http://www.adobe.com/2006/mxml" 
    layout="vertical" 
    verticalAlign="middle" 
    backgroundColor="white" >
    <mx:Script>
        <![CDATA[
            import mx.collections.HierarchicalData;
            import mx.controls.advancedDataGridClasses.AdvancedDataGridColumn;
            import mx.utils.ObjectUtil;

            private var arrData : Array = [
                { name: "User A", dob: "04/14/1980" },
                { name: "User B", dob: "01/02/1975" },
                { name: "Group A", dob: null, children: [
                    { name: "User E", dob: "09/13/1972" },
                    { name: "User F", dob: "11/22/1993" }
                ]
                },
                { name: "Group B", dob: null, children: [
                    { name: "Group B1", dob: null, children: [
                        { name: "User I", dob: "01/23/1984" },
                        { name: "User J", dob: "11/10/1948" }
                    ]
                    },
                    { name: "User G", dob: "04/09/1989" },
                    { name: "User H", dob: "06/20/1963" }
                ]
                },
                { name: "User C", dob: "12/30/1977" },
                { name: "User D", dob: "10/27/1968" }
            ];

            private function dob_sort(itemA:Object, itemB:Object):int {
                var dateA:Date = itemA.dob ? new Date(itemA.dob) : null;
                var dateB:Date = itemB.dob ? new Date(itemB.dob) : null;
                return ObjectUtil.dateCompare(dateA, dateB);
            }

            private function dob_dataTip(item:Object):String {
                if (!item.hasOwnProperty('children') && item.hasOwnProperty("dob")) {
                    return dateFormatter.format(item.dob);
                }
                return null;
            }

            private function dob_label(item:Object, col:AdvancedDataGridColumn):String {
                if(!item.hasOwnProperty('children') && item.hasOwnProperty("dob")) {
                    return item.dob;
                }
                return null;
            }
        ]]>
    </mx:Script>

    <mx:DateFormatter id="dateFormatter" formatString="MMMM D, YYYY" />

    <mx:AdvancedDataGrid id="adgTest" dataProvider="{new HierarchicalData(arrData)}" designViewDataType="tree" width="746" height="400">
        <mx:columns>
            <mx:AdvancedDataGridColumn headerText="Name"  dataField="name"/>
            <mx:AdvancedDataGridColumn headerText="Date of birth" dataField="dob"
                labelFunction="dob_label" 
                dataTipFunction="dob_dataTip"
                sortCompareFunction="dob_sort"
                showDataTips="true" />

        </mx:columns>
    </mx:AdvancedDataGrid>
</mx:Application> 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-10-17T15:46:17.403

虽然在此示例中似乎并非如此，但列上缺少的 dataField 将阻止排序发生。系统正如所描述的那样，从不调用 sortCompareFunction。

如果您有一个自定义列渲染器，它自己从数据中提取字段，则很容易忽略填充 dataField 属性。在这种情况下，一切都会正常工作，直到您进行排序。不会调用 sortCompareFunction。

通过在 sortCanBeApplied 中的第 1259 行左右调试 HierarchicalCollectionView.as 进行检查。

# html - HTML复选框可以设置为只读吗？

> ID：155291
> 
> 赞同：909
> 
> 时间：2008-09-30T21:58:58.077
> 
> 标签：html, checkbox

我认为他们可以，但由于我没有把钱放在嘴边（可以这么说）设置 readonly 属性实际上似乎没有做任何事情。

我宁愿不使用禁用，因为我希望选中的复选框与表单的其余部分一起提交，我只是不希望客户能够在某些情况下更改它们。

* * *

## 回答 #1

> 赞同：638
> 
> 时间：2011-08-01T22:05:23.273

你可以使用这个：

```
<input type="checkbox" onclick="return false;"/> 
```

这是有效的，因为从 click 事件返回 false 会停止执行链继续。

* * *

## 回答 #2

> 赞同：447
> 
> 时间：2008-09-30T22:02:57.503

`READONLY`不适用于复选框，因为它会阻止您编辑字段的*值*，但使用复选框您实际上是在编辑字段的*状态*（打开 || 关闭）

来自[faqs.org](http://www.faqs.org/docs/htmltut/forms/_INPUT_DISABLED.html)：

> 重要的是要理解 READONLY 只是阻止用户更改字段的值，而不是阻止与字段交互。例如，在复选框中，您可以打开或关闭它们（从而设置 CHECKED 状态），但您不更改字段的值。

如果您不想使用`disabled`但仍想提交值，那么将值作为隐藏字段提交并在用户不符合编辑条件时将其内容打印给用户怎么样？例如

```
// user allowed change
if($user_allowed_edit)
{
    echo '<input type="checkbox" name="my_check"> Check value';
}
else
{
    // Not allowed change - submit value..
    echo '<input type="hidden" name="my_check" value="1" />';
    // .. and show user the value being submitted
    echo '<input type="checkbox" disabled readonly> Check value';
} 
```

* * *

## 回答 #3

> 赞同：380
> 
> 时间：2008-09-30T22:09:45.570

这是您无法更改的复选框：

```
<input type="checkbox" disabled="disabled" checked="checked"> 
```

只需添加`disabled="disabled"`为属性。

**编辑以解决评论：**

如果您希望回发数据，一个简单的解决方案是将相同的名称应用于隐藏的输入：

```
<input name="myvalue" type="checkbox" disabled="disabled" checked="checked"/>
<input name="myvalue" type="hidden" value="true"/> 
```

这样，当复选框设置为“禁用”时，它仅用于数据的可视化表示，而不是实际“链接”到数据。在回发中，当复选框被禁用时，隐藏输入的值被发送。

* * *

## 回答 #4

> 赞同：72
> 
> 时间：2008-09-30T22:18:21.930

```
<input type="checkbox" onclick="this.checked=!this.checked;"> 
```

但是您绝对必须验证服务器上的数据以确保它没有被更改。

* * *

## 回答 #5

> 赞同：57
> 
> 时间：2012-10-19T09:13:51.000

另一个“简单的解决方案”：

```
<!-- field that holds the data -->
<input type="hidden" name="my_name" value="1" /> 
<!-- visual dummy for the user -->
<input type="checkbox" name="my_name_visual_dummy" value="1" checked="checked" disabled="disabled" /> 
```

> 禁用=“禁用”/禁用=真

* * *

## 回答 #6

> 赞同：45
> 
> 时间：2008-09-30T22:14:06.713

这提出了一些可用性问题。

如果你想显示一个复选框，但不让它与之交互，那为什么还要一个复选框呢？

但是，我的方法是使用禁用（用户希望禁用的复选框不可编辑，而不是使用 JS 使启用的复选框不起作用），并使用 javascript 添加一个表单提交处理程序，该处理程序在表单之前启用复选框提交。通过这种方式，您确实可以发布您的价值观。

即是这样的：

```
var form = document.getElementById('yourform');
form.onSubmit = function () 
{ 
    var formElems = document.getElementsByTagName('INPUT');
    for (var i = 0; i , formElems.length; i++)
    {  
       if (formElems[i].type == 'checkbox')
       { 
          formElems[i].disabled = false;
       }
    }
} 
```

* * *

## 回答 #7

> 赞同：40
> 
> 时间：2010-06-12T04:19:26.540

```
<input type="checkbox" readonly="readonly" name="..." /> 
```

用jQuery：

```
$(':checkbox[readonly]').click(function(){
            return false;
        }); 
```

提供一些视觉提示（css，文本，...）仍然可能是一个好主意，该控件将不接受输入。

* * *

## 回答 #8

> 赞同：25
> 
> 时间：2012-05-31T10:51:46.243

我用它来实现结果：

```
<input type=checkbox onclick="return false;" onkeydown="return false;" /> 
```

* * *

## 回答 #9

> 赞同：22
> 
> 时间：2019-05-27T08:45:46.057

迟来的答案，但大多数答案似乎过于复杂。

据我了解，OP基本上想要：

1.  显示状态的只读复选框。
2.  随表单返回的值。

应当指出的是：

1.  OP 不喜欢使用该`disabled`属性，因为他们“希望选中的复选框与表单的其余部分一起提交”。
2.  未选中的复选框不会与表单一起提交，因为上面 1\. 中 OP 的引用表明他们已经知道。基本上，复选框的值仅在选中时才存在。
3.  禁用的复选框清楚地表明它无法根据设计进行更改，因此用户不太可能尝试更改它。
4.  复选框的值不限于表示其状态，例如`yes`或`false`，可以是任何文本。

因此，由于该`readonly`属性不起作用，因此不需要 javascript 的最佳解决方案是：

1.  一个禁用的复选框，没有名称或值。
2.  如果复选框要显示为选中状态，则会显示一个隐藏字段，其中包含存储在服务器上的名称和值。

所以对于一个选中的复选框：

```
<input type="checkbox" checked="checked" disabled="disabled" />
<input type="hidden" name="fieldname" value="fieldvalue" />
```

对于未选中的复选框：

```
<input type="checkbox" disabled="disabled" />
```

禁用输入（尤其是复选框）的主要问题是它们的对比度差，这对于某些具有某些视觉障碍的人来说可能是个问题。用简单的词来表示一个值可能会更好，例如`Status: none`or `Status: implemented`，但在使用后者时包括上面的隐藏输入，例如：

```
<p>Status: Implemented<input type="hidden" name="status" value="implemented" /></p>
```

* * *

## 回答 #10

> 赞同：19
> 
> 时间：2019-05-25T11:04:00.973

我会使用只读属性

```
<input type="checkbox" readonly> 
```

然后使用 CSS 禁用交互：

```
input[type='checkbox'][readonly]{
    pointer-events: none;
} 
```

请注意，使用伪类 :read-only 在这里不起作用。

```
input[type='checkbox']:read-only{ /*not working*/
    pointer-events: none;
} 
```

* * *

## 回答 #11

> 赞同：13
> 
> 时间：2014-04-02T19:22:47.177

我碰巧注意到下面给出的解决方案。发现它是我对同一问题的研究。我不知道是谁发布的，但它不是我制作的。它使用 jQuery：

```
$(document).ready(function() {
    $(":checkbox").bind("click", false);
}); 
```

这将使复选框只读，这将有助于向客户端显示只读数据。

* * *

## 回答 #12

> 赞同：13
> 
> 时间：2019-09-13T01:37:28.643

**当前的大多数答案都存在以下一个或多个问题：**

1.  只检查鼠标而不是键盘。
2.  仅检查页面加载。
3.  钩住流行的更改或提交事件，如果有其他东西让它们上钩，它们将不会总是有效。
4.  需要隐藏输入或其他特殊元素/属性，您必须撤消才能使用 javascript 重新启用复选框。

**以下很简单，没有这些问题。**

```
$('input[type="checkbox"]').on('click keyup keypress keydown', function (event) {
    if($(this).is('[readonly]')) { return false; }
}); 
```

如果复选框是只读的，它不会改变。如果不是，它会的。它确实使用 jquery，但你可能已经在使用它了......

**有用。**

* * *

## 回答 #13

> 赞同：9
> 
> 时间：2010-07-20T17:43:45.790

```
onclick="javascript: return false;" 
```

* * *

## 回答 #14

> 赞同：9
> 
> 时间：2019-03-05T18:31:02.030

如果您希望它们通过表单提交到服务器但不与用户交互，您可以`pointer-events: none`在 css 中使用（[适用于除 IE10- 和 Opera 12- 之外的所有现代浏览器](https://caniuse.com/#feat=pointer-events)）并设置 tab-index `-1`以防止通过键盘进行更改。另请注意，您不能使用`label`标签，因为单击它会改变状态。

```
input[type="checkbox"][readonly] {
  pointer-events: none !important;
}

td {
  min-width: 5em;
  text-align: center;
}

td:last-child {
  text-align: left;
}
```

```
<table>
  <tr>
    <th>usual
    <th>readonly
    <th>disabled
  </tr><tr>
    <td><input type=checkbox />
    <td><input type=checkbox readonly tabindex=-1 />
    <td><input type=checkbox disabled />
    <td>works
  </tr><tr>
    <td><input type=checkbox checked />
    <td><input type=checkbox readonly checked tabindex=-1 />
    <td><input type=checkbox disabled checked />
    <td>also works
  </tr><tr>
    <td><label><input type=checkbox checked /></label>
    <td><label><input type=checkbox readonly checked tabindex=-1 /></label>
    <td><label><input type=checkbox disabled checked /></label>
    <td>broken - don't use label tag
  </tr>
</table>
```

* * *

## 回答 #15

> 赞同：7
> 
> 时间：2009-08-13T16:41:21.783

```
<input name="isActive" id="isActive" type="checkbox" value="1" checked="checked" onclick="return false"/> 
```

* * *

## 回答 #16

> 赞同：6
> 
> 时间：2012-04-26T06:01:29.580

`<input type="checkbox" onclick="return false" />`会为你工作，我正在使用这个

* * *

## 回答 #17

> 赞同：4
> 
> 时间：2015-03-04T00:44:58.020

我知道“禁用”不是一个可接受的答案，因为操作员希望它发布。但是，即使您设置了只读选项，您也总是必须在服务器端验证值。这是因为您无法阻止恶意用户使用 readonly 属性发布值。

我建议存储原始值（服务器端），并将其设置为禁用。然后，当他们提交表单时，忽略发布的任何值并采用您存储的原始值。

它的外观和行为就像它是一个只读值。它处理（忽略）来自恶意用户的帖子。你用一块石头杀死了两只鸟。

* * *

## 回答 #18

> 赞同：4
> 
> 时间：2012-11-30T17:22:01.507

基于上述答案，如果使用 jQuery，这可能是所有输入的一个很好的解决方案：

```
<script>
    $(function () {
        $('.readonly input').attr('readonly', 'readonly');
        $('.readonly textarea').attr('readonly', 'readonly');
        $('.readonly input:checkbox').click(function(){return false;});
        $('.readonly input:checkbox').keydown(function () { return false; });
    });
</script> 
```

我将它与 Asp.Net MVC 一起使用以将某些表单元素设置为只读。以上通过将任何父容器设置为 .readonly 来适用于文本和复选框，例如以下场景：

```
<div class="editor-field readonly">
    <input id="Date" name="Date" type="datetime" value="11/29/2012 4:01:06 PM" />
</div>
<fieldset class="flags-editor readonly">
     <input checked="checked" class="flags-editor" id="Flag1" name="Flags" type="checkbox" value="Flag1" />
</fieldset> 
```

* * *

## 回答 #19

> 赞同：4
> 
> 时间：2012-07-26T21:55:14.083

这里的一些答案似乎有点迂回，但这里有一个小技巧。

```
<form id="aform" name="aform" method="POST">
    <input name="chkBox_1" type="checkbox" checked value="1" disabled="disabled" />
    <input id="submitBttn" type="button" value="Submit" onClick='return submitPage();'>
</form>​ 
```

然后在 jquery 中，您可以选择以下两个选项之一：

```
$(document).ready(function(){
    //first option, you don't need the disabled attribute, this will prevent
    //the user from changing the checkbox values
    $("input[name^='chkBox_1']").click(function(e){
        e.preventDefault();
    });

    //second option, keep the disabled attribute, and disable it upon submit
    $("#submitBttn").click(function(){
        $("input[name^='chkBox_1']").attr("disabled",false);
        $("#aform").submit();
    });

}); 
```

​</p>

演示：http: [//jsfiddle.net/5WFYt/](http://jsfiddle.net/5WFYt/)

* * *

## 回答 #20

> 赞同：4
> 
> 时间：2013-07-22T20:33:06.770

```
<input type="radio" name="alwaysOn" onchange="this.checked=true" checked="checked">
<input type="radio" name="alwaysOff" onchange="this.checked=false" > 
```

* * *

## 回答 #21

> 赞同：4
> 
> 时间：2018-09-12T06:36:27.267

不，输入复选框不能是只读的。

但是您可以使用 javascript 将它们设为只读！

随时在任何地方添加此代码，通过防止用户以任何方式修改复选框，使复选框按假定只读工作。

```
jQuery(document).on('click', function(e){
      // check for type, avoid selecting the element for performance
      if(e.target.type == 'checkbox') {
          var el = jQuery(e.target);
          if(el.prop('readonly')) {
              // prevent it from changing state
              e.preventDefault();
          }
      }
});
```

```
input[type=checkbox][readonly] {
    cursor: not-allowed;
}
```

```
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<label><input type="checkbox" checked readonly> I'm readonly!</label>
```

您可以在 jQuery 加载后随时添加此脚本。

它适用于动态添加的元素。

它通过拾取页面上任何元素上的单击事件（发生在更改事件之前）来工作，然后检查该元素是否为只读复选框，如果是，则阻止更改。

有这么多的ifs使它不影响页面的性能。

* * *

## 回答 #22

> 赞同：4
> 
> 时间：2021-03-24T14:57:13.667

`readonly`不适用于`<input type='checkbox'>`

因此，如果您需要从表单中的禁用复选框提交值，您可以使用 jQuery：

```
$('form').submit(function(e) {
    $('input[type="checkbox"]:disabled').each(function(e) {
        $(this).removeAttr('disabled');
    })
}); 
```

这样，在提交表单时，禁用的属性就会从元素中删除。

* * *

## 回答 #23

> 赞同：3
> 
> 时间：2014-12-05T20:36:51.000

我会评论 ConroyP 的答案，但这需要 50 个我没有的声誉。我确实有足够的声誉来发布另一个答案。对不起。

ConroyP 的答案的问题是，该复选框甚至不包含在页面上，因此无法更改。尽管 Electrons_Ahoy 没有规定太多，但最好的答案是不可更改的复选框看起来与可更改的复选框相似（如果不相同），就像应用“禁用”属性时的情况一样。解决 Electrons_Ahoy 给出的不想使用“禁用”属性的两个原因的解决方案*不一定*是无效的，因为它使用了“禁用”属性。

假设两个布尔变量 $checked 和 $disabled ：

```
if ($checked && $disabled)
    echo '<input type="hidden" name="my_name" value="1" />';
echo '<input type="checkbox" name="my_name" value="1" ',
    $checked ? 'checked="checked" ' : '',
    $disabled ? 'disabled="disabled" ' : '', '/>'; 
```

如果 $checked 为真，则复选框显示为选中状态。如果 $checked 为 false，则复选框显示为未选中。当且仅当 $disabled 为 false 时，用户才能更改复选框的状态。当复选框未选中时，无论用户是否选中，都不会发布“my_name”参数。“my_name=1”参数在复选框被选中时发布，无论用户是否选中。我相信这就是 Electrons_Ahoy 所寻找的。

* * *

## 回答 #24

> 赞同：2
> 
> 时间：2019-01-14T13:01:39.690

如果您希望所有复选框都“锁定”，因此如果存在“只读”属性，则用户无法更改“已检查”状态，那么您可以使用 jQuery：

```
$(':checkbox').click(function () {
    if (typeof ($(this).attr('readonly')) != "undefined") {
        return false;
    }
}); 
```

这段代码很酷的一点是，它允许您更改整个代码中的“只读”属性，而无需重新绑定每个复选框。

它也适用于单选按钮。

* * *

## 回答 #25

> 赞同：1
> 
> 时间：2014-09-24T14:34:31.577

聚会很晚，但我找到了 MVC 的答案 (5) 我禁用了 CheckBox 并在复选框之前添加了一个 HiddenFor，所以当它发布时，如果首先找到 Hidden 字段并使用该值。这确实有效。

```
 <div class="form-group">
     @Html.LabelFor(model => model.Carrier.Exists, new { @class = "control-label col-md-2" })
         <div class="col-md-10">
              @Html.HiddenFor(model => model.Carrier.Exists)
              @Html.CheckBoxFor(model => model.Carrier.Exists, new { @disabled = "disabled" })
              @Html.ValidationMessageFor(model => model.Carrier.Exists)
          </div>
 </div> 
```

* * *

## 回答 #26

> 赞同：1
> 
> 时间：2018-12-28T03:23:36.910

只需使用如下所示的简单禁用标签。

```
<input type="checkbox" name="email"  disabled> 
```

* * *

## 回答 #27

> 赞同：0
> 
> 时间：2008-09-30T22:06:14.750

> 我只是不希望客户能够在某些情况下更改它们。

READONLY 本身不起作用。你也许可以用 CSS 做一些时髦的事情，但我们通常只是将它们禁用。

警告：如果它们被发布回来，那么客户可以更改它们，期间。您不能依靠 readonly 来阻止用户更改某些内容。总是可以使用 fiddler 或者只是使用带有 firebug 的 html 或类似的东西。

* * *

## 回答 #28

> 赞同：0
> 
> 时间：2009-09-26T06:05:12.497

如果您需要将复选框与表单一起提交但对用户有效，我建议将它们设置为禁用并在提交表单时使用 javascript 重新启用它们。

这有两个原因。首先也是最重要的，您的用户可以从他们可以更改的复选框和只读复选框之间的明显差异中受益。禁用执行此操作。

第二个原因是禁用状态是内置在浏览器中的，因此当用户单击某些内容时，您需要执行的代码更少。这可能更多是个人喜好而不是其他任何东西。提交表单时，您仍然需要一些 javascript 来取消禁用这些。

在提交表单以取消禁用复选框时，我似乎更容易使用一些 javascript，而不是使用隐藏的输入来携带值。

* * *

## 回答 #29

> 赞同：0
> 
> 时间：2010-11-08T17:47:22.913

人们想要一个只读复选框和（以及）一个只读单选组的主要原因是，无法更改的信息可以以输入的形式呈现给用户。

OK disabled 会这样做——不幸的是，禁用的控件不能通过键盘导航，因此违反了所有可访问性法规。这是我所知道的 HTML 中最大的挂断。

* * *

## 回答 #30

> 赞同：0
> 
> 时间：2011-03-25T20:16:34.177

贡献非常非常晚......但无论如何。在页面加载时，使用 jquery 禁用除当前选中的复选框之外的所有复选框。然后将当前选定的设置为只读，使其具有与禁用的相似的外观。用户无法更改该值，并且选定的值仍然提交。

* * *

## 回答 #31

> 赞同：0
> 
> 时间：2013-05-22T13:39:15.277

要不就：

```
$('your selector').click(function(evt){evt.preventDefault()}); 
```

* * *

## 回答 #32

> 赞同：0
> 
> 时间：2022-02-14T22:58:33.723

摘自[https://stackoverflow.com/a/71086058/18183749](https://stackoverflow.com/a/71086058/18183749)

> 如果您不能使用“禁用”属性（因为它会删除 POST 时的值输入），并注意到 html 属性“只读”仅适用于 textarea 和一些输入（文本、密码、搜索，据我所知） )，最后，如果您不想费心用隐藏的输入逻辑复制所有选择、复选框和单选，您可能会发现以下函数或任何您喜欢的内部逻辑：

```
 addReadOnlyToFormElements = function (idElement) {

            // html readonly don't work on input of type checkbox and radio, neither on select. So, a safe trick is to disable the non-selected items
            $('#' + idElement + ' input[type="checkbox"]:not(:checked)').prop('disabled',true); 

            // and, on the selected ones, to disable mouse/keyoard events and mimic readOnly appearance
            $('#' + idElement + ' input[type="checkbox"]:checked').prop('tabindex','-1').css('pointer-events','none').css('opacity','0.5');
        } 
```

没有什么比删除这些只读的更容易的了

```
removeReadOnlyFromFormElements = function (idElement) {

    // Remove the disabled attribut on non-selected
    $('#' + idElement + ' input[type="checkbox"]:not(:checked)').prop('disabled',false);

    // Restore mouse/keyboard events and remove readOnly appearance on selected ones
    $('#' + idElement + ' input[type="checkbox"]:checked').prop('tabindex','').css('pointer-events','').css('opacity','');
} 
```

* * *

## 回答 #33

> 赞同：-1
> 
> 时间：2009-04-09T13:28:39.520

When posting an HTML checkbox to the server, it has a string value of 'on' or ''.

Readonly does not stop the user editing the checkbox, and disabled stops the value being posted back.
One way around this is to have a hidden element to store the actual value and the displayed checkbox is a dummy which is disabled. This way the checkbox state is persisted between posts.

Here is a function to do this. It uses a string of 'T' or 'F' and you can change this any way you like. This has been used in an ASP page using server side VB script.

```
public function MakeDummyReadonlyCheckbox(i_strName, i_strChecked_TorF)

    dim strThisCheckedValue

    if (i_strChecked_TorF = "T") then
        strThisCheckedValue = " checked "
        i_strChecked_TorF = "on"
    else
        strThisCheckedValue = ""
        i_strChecked_TorF = ""
    end if

    MakeDummyReadonlyCheckbox = "<input type='hidden' id='" & i_strName & "' name='" & i_strName & "' " & _
        "value='" & i_strChecked_TorF & "'>" & _
    "<input type='checkbox' disabled id='" & i_strName & "Dummy' name='" & i_strName & "Dummy' " & _
        strThisCheckedValue & ">"   
end function

public function GetCheckbox(i_objCheckbox)

    select case trim(i_objCheckbox)

        case ""
            GetCheckbox = "F"

        case else
            GetCheckbox = "T"

    end select

end function 
```

At the top of an ASP page you can pickup the persisted value...

```
strDataValue = GetCheckbox(Request.Form("chkTest")) 
```

and when you want to output your checkbox you can do this...

```
response.write MakeDummyReadonlyCheckbox("chkTest", strDataValue) 
```

I have tested this and it works just fine. It also does not rely upon JavaScript.

* * *

## 回答 #34

> 赞同：-1
> 
> 时间：2013-01-29T17:39:16.993

如果其他人使用 MVC 和编辑器模板，这就是我控制显示只读属性的方式（我使用自定义属性来获取 if 语句中的值）

```
@if (true)
{
    @Html.HiddenFor(m => m)
    @(ViewData.Model ? Html.Raw("Yes") : Html.Raw("No"))
} 
else
{               
    @Html.CheckBoxFor(m => m)
} 
```

* * *

## 回答 #35

> 赞同：-1
> 
> 时间：2010-05-05T17:30:24.013

我的解决方案实际上与 FlySwat 的解决方案相反，但我不确定它是否适合您的情况。我有一组复选框，每个复选框都有一个提交表单的 onClick 处理程序（它们用于更改表的过滤器设置）。我不想允许多次点击，因为第一次之后的后续点击会被忽略。所以我在第一次点击后禁用所有复选框，并在提交表单后：

`onclick="document.forms['form1'].submit(); $('#filters input').each(function() {this.disabled = true});"`

复选框位于 ID 为“filters”的 span 元素中 - 代码的第二部分是一个 jQuery 语句，它遍历复选框并禁用每个复选框。这样，复选框值仍然通过表单提交（因为表单是在禁用它们之前提交的），并且它会阻止用户在页面重新加载之前更改它们。

* * *

## 回答 #36

> 赞同：-1
> 
> 时间：2014-05-27T08:55:58.800

```
<input name="testName" type="checkbox" disabled> 
```

* * *

## 回答 #37

> 赞同：-1
> 
> 时间：2011-11-16T04:11:25.173

提交表单时，我们实际上传递的是复选框的值，而不是状态（选中/未选中）。Readonly 属性阻止我们编辑值，而不是状态。如果您想要一个代表您要提交的值的只读字段，请使用只读文本。

* * *

## 回答 #38

> 赞同：-1
> 
> 时间：2020-12-24T09:15:31.660

@(Model.IsEnabled) 使用此条件动态选中和取消选中，如果复选框已选中，则设置为只读。

```
 <input id="abc" name="abc"  type="checkbox" @(Model.IsEnabled ? "checked=checked onclick=this.checked=!this.checked;" : string.Empty) > 
```

* * *

## 回答 #39

> 赞同：-1
> 
> 时间：2018-02-19T07:23:37.997

最新的 jQuery 有这个功能

```
$("#txtname").prop('readonly', false); 
```

* * *

## 回答 #40

> 赞同：-3
> 
> 时间：2010-11-01T14:37:24.680

最简单的（在我看来）：

```
onclick="javascript:{this.checked = this.defaultChecked;}" 
```

* * *

## 回答 #41

> 赞同：-3
> 
> 时间：2012-04-30T00:46:50.940

如果您知道始终选中该复选框，则以下方法有效：

```
<input type="checkbox" name="Name" checked onchange='this.checked = true;'> 
```

* * *

## 回答 #42

> 赞同：-3
> 
> 时间：2011-07-01T15:37:57.310

在旧 HTML 中，您可以使用

```
<input type="checkbox" disabled checked>text 
```

但实际上不建议只使用旧的 HTML，现在您应该使用 XHTML。

在格式良好的 XHTML 中，您必须使用

```
<input type="checkbox" disabled="disabled" checked="checked" />text <!-- if yu have a checked box-->
<input type="checkbox" disabled="disabled" />text <!-- if you have a unchecked box --> 
```

格式良好的 XHTML 需要 XML 表单，这就是使用 disabled="disabled" 而不是简单地使用 disabled 的原因。

* * *

## 回答 #43

> 赞同：-4
> 
> 时间：2008-09-30T22:17:59.950

您始终可以使用看起来像复选框的小图像。

* * *

## 回答 #44

> 赞同：-4
> 
> 时间：2012-02-07T07:46:08.527

试试这个使复选框只读，但不允许用户检查。这将让您发布复选框值。您需要选择复选框的默认状态为选中才能执行此操作。

```
<input type="checkbox" readonly="readonly" onclick="this.checked =! this.checked;"> 
```

如果您想要上述功能 + 不想接收复选框数据，请尝试以下操作：

```
<input type="checkbox" readonly="readonly" disabled="disabled" onclick="this.checked =! this.checked;"> 
```

希望有帮助。

* * *

## 回答 #45

> 赞同：-4
> 
> 时间：2014-07-15T05:24:23.027

为什么不用顶部的空白 div 覆盖输入。

```
<div id='checkbox_wrap'>
   <div class='click_block'></div>
   <input type='checkbox' /> 
</div> 
```

然后像这样的CSS

```
 #checkbox_wrap{
   height:10px;
   width:10px;
   }
 .click_block{
   height: 10px;
   width: 10px;
   position: absolute;
   z-index: 100;
} 
```

* * *

## 回答 #46

> 赞同：-4
> 
> 时间：2012-07-08T17:41:30.940

你们没有人想到的是你们都在使用 JavaScript，任何用户都可以很容易地绕过它。

简单地禁用它会禁用所有 JQuery/Return False 语句。

只读复选框的唯一选择是服务器端。

显示它们，让他们更改它们，但不要接受来自它们的新帖子数据。

* * *

## 回答 #47

> 赞同：-5
> 
> 时间：2008-09-30T22:04:18.890

不，但您也许可以使用 javascript 事件来实现类似的功能

# windows-installer - 使用 Orca 将组合框添加到设置

> ID：155299
> 
> 赞同：2
> 
> 时间：2008-09-30T22:01:11.020
> 
> 标签：windows-installer, installation, orca

我试图在设置组件期间在对话框中显示组合框。目前，我们有一个单选按钮组。我认为用组合框替换它应该像在 MSI 的“组合框”表和“控制”表中添加正确的条目一样简单，在相应的对话框中用组合框替换对单选按钮组的引用。但是，这是行不通的。设置崩溃并给出错误 #2885。[Windows 安装程序错误 2885：无法在对话框 [2] 上创建控件 [3]。从[这里开始](http://www.appdeploy.com/msierrors/detail.asp?id=564)。]

关于如何做到这一点的任何想法？我显然只能使用 Orca（这是自从任何人都记得以来一直使用的东西）。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-01T18:51:12.077

啊哈！！弄清楚它是什么。我做的一切都是正确的，除了当我用组合框替换单选按钮时，仍然有一个元素（上一个按钮）将单选按钮组作为其下一个元素（有点像制表位）。在表单加载时，它试图找到单选按钮但找不到它们，从而给出错误。

有点像处理链表时典型的新程序员错误：不更新对您正在删除/插入的节点的引用。

# .net - .NET - 如何将“大写”分隔的字符串拆分为数组？

> ID：155303
> 
> 赞同：117
> 
> 时间：2008-09-30T22:03:42.213
> 
> 标签：.net, regex, algorithm, string, pascalcasing

我如何从这个字符串开始：“ThisIsMyCapsDelimitedString”

...到这个字符串：“这是我的大写分隔字符串”

VB.net 中最少的代码行是首选，但也欢迎使用 C#。

干杯!

* * *

## 回答 #1

> 赞同：178
> 
> 时间：2008-09-30T22:59:25.123

我前一阵子做的。它匹配 CamelCase 名称的每个组成部分。

```
/([A-Z]+(?=$|[A-Z][a-z])|[A-Z]?[a-z]+)/g 
```

例如：

```
"SimpleHTTPServer" => ["Simple", "HTTP", "Server"]
"camelCase" => ["camel", "Case"] 
```

要将其转换为仅在单词之间插入空格：

```
Regex.Replace(s, "([a-z](?=[A-Z])|[A-Z](?=[A-Z][a-z]))", "$1 ") 
```

* * *

如果您需要处理数字：

```
/([A-Z]+(?=$|[A-Z][a-z]|[0-9])|[A-Z]?[a-z]+|[0-9]+)/g

Regex.Replace(s,"([a-z](?=[A-Z]|[0-9])|[A-Z](?=[A-Z][a-z]|[0-9])|[0-9](?=[^0-9]))","$1 ") 
```

* * *

## 回答 #2

> 赞同：39
> 
> 时间：2008-09-30T22:14:59.910

```
Regex.Replace("ThisIsMyCapsDelimitedString", "(\\B[A-Z])", " $1") 
```

* * *

## 回答 #3

> 赞同：20
> 
> 时间：2008-11-15T00:31:19.103

很好的答案，MizardX！我稍微调整了一下，将数字视为单独的单词，因此“AddressLine1”将变为“Address Line 1”而不是“Address Line1”：

```
Regex.Replace(s, "([a-z](?=[A-Z0-9])|[A-Z](?=[A-Z][a-z]))", "$1 ") 
```

* * *

## 回答 #4

> 赞同：18
> 
> 时间：2008-09-30T22:59:04.233

只是为了一点点......这是一个不使用正则表达式的扩展方法。

```
public static class CamelSpaceExtensions
{
    public static string SpaceCamelCase(this String input)
    {
        return new string(Enumerable.Concat(
            input.Take(1), // No space before initial cap
            InsertSpacesBeforeCaps(input.Skip(1))
        ).ToArray());
    }

    private static IEnumerable<char> InsertSpacesBeforeCaps(IEnumerable<char> input)
    {
        foreach (char c in input)
        {
            if (char.IsUpper(c)) 
            { 
                yield return ' '; 
            }

            yield return c;
        }
    }
} 
```

* * *

## 回答 #5

> 赞同：12
> 
> 时间：2008-09-30T22:13:47.057

除了格兰特瓦格纳的出色评论：

```
Dim s As String = RegularExpressions.Regex.Replace("ThisIsMyCapsDelimitedString", "([A-Z])", " $1") 
```

* * *

## 回答 #6

> 赞同：10
> 
> 时间：2014-11-11T22:50:31.393

我需要一个支持首字母缩写词和数字的解决方案。这种基于正则表达式的解决方案将以下模式视为单独的“单词”：

*   大写字母后跟小写字母
*   一串连续的数字
*   连续大写字母（解释为首字母缩略词） - 新词可以使用最后一个大写字母开头，例如 HTMLGuide => "HTML Guide"、"TheATeam" => "The A Team"

您*可以*将其作为单线：

```
Regex.Replace(value, @"(?<!^)((?<!\d)\d|(?(?<=[A-Z])[A-Z](?=[a-z])|[A-Z]))", " $1") 
```

更易读的方法可能会更好：

```
using System.Text.RegularExpressions;

namespace Demo
{
    public class IntercappedStringHelper
    {
        private static readonly Regex SeparatorRegex;

        static IntercappedStringHelper()
        {
            const string pattern = @"
                (?<!^) # Not start
                (
                    # Digit, not preceded by another digit
                    (?<!\d)\d 
                    |
                    # Upper-case letter, followed by lower-case letter if
                    # preceded by another upper-case letter, e.g. 'G' in HTMLGuide
                    (?(?<=[A-Z])[A-Z](?=[a-z])|[A-Z])
                )";

            var options = RegexOptions.IgnorePatternWhitespace | RegexOptions.Compiled;

            SeparatorRegex = new Regex(pattern, options);
        }

        public static string SeparateWords(string value, string separator = " ")
        {
            return SeparatorRegex.Replace(value, separator + "$1");
        }
    }
} 
```

这是（XUnit）测试的摘录：

```
[Theory]
[InlineData("PurchaseOrders", "Purchase-Orders")]
[InlineData("purchaseOrders", "purchase-Orders")]
[InlineData("2Unlimited", "2-Unlimited")]
[InlineData("The2Unlimited", "The-2-Unlimited")]
[InlineData("Unlimited2", "Unlimited-2")]
[InlineData("222Unlimited", "222-Unlimited")]
[InlineData("The222Unlimited", "The-222-Unlimited")]
[InlineData("Unlimited222", "Unlimited-222")]
[InlineData("ATeam", "A-Team")]
[InlineData("TheATeam", "The-A-Team")]
[InlineData("TeamA", "Team-A")]
[InlineData("HTMLGuide", "HTML-Guide")]
[InlineData("TheHTMLGuide", "The-HTML-Guide")]
[InlineData("TheGuideToHTML", "The-Guide-To-HTML")]
[InlineData("HTMLGuide5", "HTML-Guide-5")]
[InlineData("TheHTML5Guide", "The-HTML-5-Guide")]
[InlineData("TheGuideToHTML5", "The-Guide-To-HTML-5")]
[InlineData("TheUKAllStars", "The-UK-All-Stars")]
[InlineData("AllStarsUK", "All-Stars-UK")]
[InlineData("UKAllStars", "UK-All-Stars")] 
```

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-10-01T02:44:04.520

对于更多种类，使用普通的旧 C# 对象，以下生成与 @MizardX 出色的正则表达式相同的输出。

```
public string FromCamelCase(string camel)
{   // omitted checking camel for null
    StringBuilder sb = new StringBuilder();
    int upperCaseRun = 0;
    foreach (char c in camel)
    {   // append a space only if we're not at the start
        // and we're not already in an all caps string.
        if (char.IsUpper(c))
        {
            if (upperCaseRun == 0 && sb.Length != 0)
            {
                sb.Append(' ');
            }
            upperCaseRun++;
        }
        else if( char.IsLower(c) )
        {
            if (upperCaseRun > 1) //The first new word will also be capitalized.
            {
                sb.Insert(sb.Length - 1, ' ');
            }
            upperCaseRun = 0;
        }
        else
        {
            upperCaseRun = 0;
        }
        sb.Append(c);
    }

    return sb.ToString();
} 
```

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2015-08-03T20:27:23.037

下面是将以下内容转换为标题大小写的原型：

*   蛇案例
*   骆驼香烟盒
*   帕斯卡案例
*   句格
*   标题大小写（保持当前格式）

显然，您自己只需要“ToTitleCase”方法。

```
using System;
using System.Collections.Generic;
using System.Globalization;
using System.Text.RegularExpressions;

public class Program
{
    public static void Main()
    {
        var examples = new List<string> { 
            "THEQuickBrownFox",
            "theQUICKBrownFox",
            "TheQuickBrownFOX",
            "TheQuickBrownFox",
            "the_quick_brown_fox",
            "theFOX",
            "FOX",
            "QUICK"
        };

        foreach (var example in examples)
        {
            Console.WriteLine(ToTitleCase(example));
        }
    }

    private static string ToTitleCase(string example)
    {
        var fromSnakeCase = example.Replace("_", " ");
        var lowerToUpper = Regex.Replace(fromSnakeCase, @"(\p{Ll})(\p{Lu})", "$1 $2");
        var sentenceCase = Regex.Replace(lowerToUpper, @"(\p{Lu}+)(\p{Lu}\p{Ll})", "$1 $2");
        return new CultureInfo("en-US", false).TextInfo.ToTitleCase(sentenceCase);
    }
} 
```

控制台输出如下：

> ```
> THE Quick Brown Fox
> The QUICK Brown Fox
> The Quick Brown FOX
> The Quick Brown Fox
> The Quick Brown Fox
> The FOX
> FOX
> QUICK 
> ```

[引用的博文](http://brantleytec.blogspot.com/2015/07/pascalcase-or-camelcase-to-title-case.html)

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-09-30T22:14:06.777

```
string s = "ThisIsMyCapsDelimitedString";
string t = Regex.Replace(s, "([A-Z])", " $1").Substring(1); 
```

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2017-10-04T14:28:46.423

正则表达式比简单循环慢约 10-12 倍：

```
 public static string CamelCaseToSpaceSeparated(this string str)
    {
        if (string.IsNullOrEmpty(str))
        {
            return str;
        }

        var res = new StringBuilder();

        res.Append(str[0]);
        for (var i = 1; i < str.Length; i++)
        {
            if (char.IsUpper(str[i]))
            {
                res.Append(' ');
            }
            res.Append(str[i]);

        }
        return res.ToString();
    } 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-09-30T22:18:26.937

天真的正则表达式解决方案。不会处理 O'Conner，并且还会在字符串的开头添加一个空格。

```
s = "ThisIsMyCapsDelimitedString"
split = Regex.Replace(s, "[A-Z0-9]", " $&"); 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-09-30T22:12:04.533

可能有一个更优雅的解决方案，但这是我想到的：

```
string myString = "ThisIsMyCapsDelimitedString";

for (int i = 1; i < myString.Length; i++)
{
     if (myString[i].ToString().ToUpper() == myString[i].ToString())
     {
          myString = myString.Insert(i, " ");
          i++;
     }
} 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2014-08-25T06:04:50.870

尝试使用

```
"([A-Z]*[^A-Z]*)" 
```

结果将适合字母与数字混合

```
Regex.Replace("AbcDefGH123Weh", "([A-Z]*[^A-Z]*)", "$1 ");
Abc Def GH123 Weh  

Regex.Replace("camelCase", "([A-Z]*[^A-Z]*)", "$1 ");
camel Case 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2016-05-14T21:16:53.477

实现伪代码来自：[https ://stackoverflow.com/a/5796394/4279201](https://stackoverflow.com/a/5796394/4279201)

```
 private static StringBuilder camelCaseToRegular(string i_String)
    {
        StringBuilder output = new StringBuilder();
        int i = 0;
        foreach (char character in i_String)
        {
            if (character <= 'Z' && character >= 'A' && i > 0)
            {
                output.Append(" ");
            }
            output.Append(character);
            i++;
        }
        return output;
    } 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2017-05-15T02:31:22.340

要在非大写字母和[大写字母 Unicode 类别](https://msdn.microsoft.com/en-us/library/20bw873z.aspx#SupportedUnicodeGeneralCategories)之间进行匹配：[`(?<=\P{Lu})(?=\p{Lu})`](https://regex101.com/r/zahL4H/1)

```
Dim s = Regex.Replace("CorrectHorseBatteryStaple", "(?<=\P{Lu})(?=\p{Lu})", " ") 
```

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2018-01-10T10:49:24.997

程序和快速实现：

```
 /// <summary>
  /// Get the words in a code <paramref name="identifier"/>.
  /// </summary>
  /// <param name="identifier">The code <paramref name="identifier"/></param> to extract words from.
  public static string[] GetWords(this string identifier) {
     Contract.Ensures(Contract.Result<string[]>() != null, "returned array of string is not null but can be empty");
     if (identifier == null) { return new string[0]; }
     if (identifier.Length == 0) { return new string[0]; }

     const int MIN_WORD_LENGTH = 2;  //  Ignore one letter or one digit words

     var length = identifier.Length;
     var list = new List<string>(1 + length/2); // Set capacity, not possible more words since we discard one char words
     var sb = new StringBuilder();
     CharKind cKindCurrent = GetCharKind(identifier[0]); // length is not zero here
     CharKind cKindNext = length == 1 ? CharKind.End : GetCharKind(identifier[1]);

     for (var i = 0; i < length; i++) {
        var c = identifier[i];
        CharKind cKindNextNext = (i >= length - 2) ? CharKind.End : GetCharKind(identifier[i + 2]);

        // Process cKindCurrent
        switch (cKindCurrent) {
           case CharKind.Digit:
           case CharKind.LowerCaseLetter:
              sb.Append(c); // Append digit or lowerCaseLetter to sb
              if (cKindNext == CharKind.UpperCaseLetter) {
                 goto TURN_SB_INTO_WORD; // Finish word if next char is upper
              }
              goto CHAR_PROCESSED;
           case CharKind.Other:
              goto TURN_SB_INTO_WORD;
           default:  // charCurrent is never Start or End
              Debug.Assert(cKindCurrent == CharKind.UpperCaseLetter);
              break;
        }

        // Here cKindCurrent is UpperCaseLetter
        // Append UpperCaseLetter to sb anyway
        sb.Append(c); 

        switch (cKindNext) {
           default:
              goto CHAR_PROCESSED;

           case CharKind.UpperCaseLetter: 
              //  "SimpleHTTPServer"  when we are at 'P' we need to see that NextNext is 'e' to get the word!
              if (cKindNextNext == CharKind.LowerCaseLetter) {
                 goto TURN_SB_INTO_WORD;
              }
              goto CHAR_PROCESSED;

           case CharKind.End:
           case CharKind.Other:
              break; // goto TURN_SB_INTO_WORD;
        }

        //------------------------------------------------

     TURN_SB_INTO_WORD:
        string word = sb.ToString();
        sb.Length = 0;
        if (word.Length >= MIN_WORD_LENGTH) {  
           list.Add(word);
        }

     CHAR_PROCESSED:
        // Shift left for next iteration!
        cKindCurrent = cKindNext;
        cKindNext = cKindNextNext;
     }

     string lastWord = sb.ToString();
     if (lastWord.Length >= MIN_WORD_LENGTH) {
        list.Add(lastWord);
     }
     return list.ToArray();
  }
  private static CharKind GetCharKind(char c) {
     if (char.IsDigit(c)) { return CharKind.Digit; }
     if (char.IsLetter(c)) {
        if (char.IsUpper(c)) { return CharKind.UpperCaseLetter; }
        Debug.Assert(char.IsLower(c));
        return CharKind.LowerCaseLetter;
     }
     return CharKind.Other;
  }
  enum CharKind {
     End, // For end of string
     Digit,
     UpperCaseLetter,
     LowerCaseLetter,
     Other
  } 
```

测试：

```
 [TestCase((string)null, "")]
  [TestCase("", "")]

  // Ignore one letter or one digit words
  [TestCase("A", "")]
  [TestCase("4", "")]
  [TestCase("_", "")]
  [TestCase("Word_m_Field", "Word Field")]
  [TestCase("Word_4_Field", "Word Field")]

  [TestCase("a4", "a4")]
  [TestCase("ABC", "ABC")]
  [TestCase("abc", "abc")]
  [TestCase("AbCd", "Ab Cd")]
  [TestCase("AbcCde", "Abc Cde")]
  [TestCase("ABCCde", "ABC Cde")]

  [TestCase("Abc42Cde", "Abc42 Cde")]
  [TestCase("Abc42cde", "Abc42cde")]
  [TestCase("ABC42Cde", "ABC42 Cde")]
  [TestCase("42ABC", "42 ABC")]
  [TestCase("42abc", "42abc")]

  [TestCase("abc_cde", "abc cde")]
  [TestCase("Abc_Cde", "Abc Cde")]
  [TestCase("_Abc__Cde_", "Abc Cde")]
  [TestCase("ABC_CDE_FGH", "ABC CDE FGH")]
  [TestCase("ABC CDE FGH", "ABC CDE FGH")] // Should not happend (white char) anything that is not a letter/digit/'_' is considered as a separator
  [TestCase("ABC,CDE;FGH", "ABC CDE FGH")] // Should not happend (,;) anything that is not a letter/digit/'_' is considered as a separator
  [TestCase("abc<cde", "abc cde")]
  [TestCase("abc<>cde", "abc cde")]
  [TestCase("abc<D>cde", "abc cde")]  // Ignore one letter or one digit words
  [TestCase("abc<Da>cde", "abc Da cde")]
  [TestCase("abc<cde>", "abc cde")]

  [TestCase("SimpleHTTPServer", "Simple HTTP Server")]
  [TestCase("SimpleHTTPS2erver", "Simple HTTPS2erver")]
  [TestCase("camelCase", "camel Case")]
  [TestCase("m_Field", "Field")]
  [TestCase("mm_Field", "mm Field")]
  public void Test_GetWords(string identifier, string expectedWordsStr) {
     var expectedWords = expectedWordsStr.Split(' ');
     if (identifier == null || identifier.Length <= 1) {
        expectedWords = new string[0];
     }

     var words = identifier.GetWords();
     Assert.IsTrue(words.SequenceEqual(expectedWords));
  } 
```

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2018-10-24T21:56:30.970

一个简单的解决方案，它应该比正则表达式解决方案快几个数量级（基于我在这个线程中针对顶级解决方案运行的测试），特别是随着输入字符串的大小增长：

```
string s1 = "ThisIsATestStringAbcDefGhiJklMnoPqrStuVwxYz";
string s2;
StringBuilder sb = new StringBuilder();

foreach (char c in s1)
    sb.Append(char.IsUpper(c)
        ? " " + c.ToString()
        : c.ToString());

s2 = sb.ToString(); 
```

# javascript - 跨浏览器“跳转到”/“滚动”文本区域

> ID：155306
> 
> 赞同：11
> 
> 时间：2008-09-30T22:04:20.717
> 
> 标签：javascript, html, css

我有一个包含多行输入的 textarea，并且触发了一个 JavaScript 事件，这需要我将 textarea 滚动到第 345 行。

`scrollTop`有点做我想要的，除了据我所知它是像素级别的，我想要在行级别上运行的东西。使事情变得复杂的是，再次强调，不可能使 textareas 不换行。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-09-30T22:37:17.220

您可以使用 wrap 属性停止包装。它不是 HTML 4 的一部分，但大多数浏览器都支持它。
您可以通过将区域的高度除以其行数来计算线的高度。

```
<script type="text/javascript" language="JavaScript">
function Jump(line)
{
  var ta = document.getElementById("TextArea");
  var lineHeight = ta.clientHeight / ta.rows;
  var jump = (line - 1) * lineHeight;
  ta.scrollTop = jump;
}
</script>

<textarea name="TextArea" id="TextArea" 
  rows="40" cols="80" title="Paste text here"
  wrap="off"></textarea>
<input type="button" onclick="Jump(98)" title="Go!" value="Jump"/> 
```

在 FF3 和 IE6 中测试正常。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2013-01-07T16:14:40.797

如果您使用 .scrollHeight 而不是 .clientHeight，它将适用于以有限高度和滚动条显示的文本区域：

```
<script type="text/javascript" language="JavaScript">
function Jump(line)
{
  var ta = document.getElementById("TextArea");
  var lineHeight = ta.scrollHeight / ta.rows;
  var jump = (line - 1) * lineHeight;
  ta.scrollTop = jump;
}
</script>

<textarea name="TextArea" id="TextArea" 
  rows="40" cols="80" title="Paste text here"
  wrap="off"></textarea>
<input type="button" onclick="Jump(98)" title="Go!" value="Jump"/> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2018-02-28T15:41:39.517

Something to consider when referring to the accepted answer: you may not have specified the `rows` attribute in your `textarea` e.g. instead, you may have set the height of the `textarea` using CSS.

Therefore referring to `ta.rows` will not work as per above (it's 2 by default), so instead you could get the `line-height` of your `textarea` via `currentStyle` / `getComputedStyle` or even jQuery's `.css()`, and do something like the following:

```
function jump(line) {
  var ta = document.getElementById("TextArea");
  var jump = line * parseInt(getStyle(ta, 'line-height'), 10);
  ta.scrollTop = jump;
}

function getStyle(el, styleProp) {
  if (el.currentStyle) {
    var y = el.currentStyle[styleProp];
  } else if (window.getComputedStyle) {
    var y = document.defaultView.getComputedStyle(el, null).getPropertyValue(styleProp);
  }
  return y;
} 
```

# php - 如何让 PHP 与 ADOdb 和 MySQL 一起工作？

> ID：155308
> 
> 赞同：1
> 
> 时间：2008-09-30T22:04:35.083
> 
> 标签：php, mysql, windows, iis, adodb

我试图让一个 PHP 站点在带有 MySQL 的 Windows Server 上的 IIS 中工作。

我收到了这个错误……</p>

致命错误：在第 363 行调用 C:\inetpub...\adodb\drivers\adodb-mysql.inc.php 中未定义的函数 mysql_connect()

* * *

更新……</p>

此链接概述了我在服务器上安装 PHP 所遵循的步骤：
[如何让 PHP 和 MySQL 在 IIS 7.0 上运行？](https://stackoverflow.com/questions/11919/how-do-i-get-php-and-mysql-working-on-iis-70#94341)
（特别注意有关 php.ini 和 php_mysql.dll 的步骤 6 和 8）。

phpinfo报告中只有两行引用了SQL：

```
<?php
    phpinfo();
?> 
```

> 配置命令：
> cscript /nologo configure.js "--enable-snapshot-build" "--enable-mysqlnd"
> 
> sql.safe_mode：
> 本地值关闭，主值关闭

[PHP 配置命令 http://img79.imageshack.us/img79/2373/configurecommandmw8.gif](http://img79.imageshack.us/img79/2373/configurecommandmw8.gif)

[PHP sql.safe_mode http://img49.imageshack.us/img49/3066/sqlsafemoderu6.gif](http://img49.imageshack.us/img49/3066/sqlsafemoderu6.gif)

* * *

更新……</p>

我找到了解决方案：[如何在 PHP 中安装 MySQL 模块？](https://stackoverflow.com/questions/158279/how-do-i-install-mysql-modules-within-php#160746)

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-30T22:07:06.310

查看 phpinfo 以查看 mysql 函数是否使用您的 PHP 编译

```
<?php
    phpinfo();
?> 
```

由于在某些版本的 php 中，它不是默认的安装。

**编辑更新：**

您的 phpinfo(); 中应该有一个完整的 MySQL 类别；

例如，请参见：[https](https://secure18.easycgi.com/phpinfo.php) : //secure18.easycgi.com/phpinfo.php（谷歌搜索示例）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-30T22:07:15.247

听起来您使用的 PHP 版本没有在编译时支持 MySQL，或者没有在 php.ini 中启用。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-01T14:33:12.023

看起来你还没有安装 MySQL PHP 扩展！除了安装正确的模块之外，您不应该做任何配置（并且不应该对 ADODB 做任何事情）*。*

PHP 也有 2 个版本 - CGI 版本和 ISAPI 模块。你最好使用带有 ISS 的 ISAPI 版本并添加所有的装饰......

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-14T16:09:20.533

我找到了解决方案：[如何在 PHP 中安装 MySQL 模块？](https://stackoverflow.com/questions/158279/how-do-i-install-mysql-modules-within-php#160746)

# c++ - Boost：触发并忘记异步函数调用？

> ID：155311
> 
> 赞同：5
> 
> 时间：2008-09-30T22:04:52.227
> 
> 标签：c++, boost, asynchronous

我想以一次性的方式调用函数。在 Boost / C++ 中执行此操作的最佳方法是什么？

我想向它传递两个参数并且不需要结果。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-30T22:43:56.627

[我有一段时间没有使用 boost::thread 了，但是我在该类](http://www.boost.org/doc/libs/1_36_0/doc/html/thread/thread_management.html)的文档页面上看到了一个简单的示例：

```
void find_the_question(int the_answer);

boost::thread deep_thought_2(find_the_question,42); 
```

我相信一旦它完成函数，线程就会退出。这可能不是您想要的，因为一旦线程超出范围，它将被销毁。如果这不起作用，您可能需要创建一个长时间运行的线程池，然后将仿函数作为 boost::bind 组合传递。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-30T22:40:40.613

好吧，您可以启动一个线程，然后再也不加入它。就像是：

```
boost::thread some_thread(&SomeFunction, param1, param2); 
```

一旦 some_thread 变量超出范围，执行线程将被分离并且将无法再次加入。除非这个函数的处理时间很长，否则启动线程是一种浪费。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-01T01:27:03.037

根据您执行此操作的频率，您最好创建一个线程池以及一个工作队列。如果您尝试每秒执行数十次线程，则创建线程会产生大量开销。如果您不关心返回值，那就很容易了。

旋转一两个（或十个）线程；有一个线程安全的函子队列来调用（将参数绑定到函数并将其放入队列中）；线程在队列中等待某些东西出现，第一个唤醒的线程开始处理工作。当一个线程完成运行作业时，它会再次在队列中等待。

看看[这个项目](http://www.codeproject.com/KB/threads/ProducerConsumerModel.aspx)，了解一种方法。

当然，如果您只是每隔几秒钟进行一次异步调用以提高 UI 的响应能力，那么每次都启动一个新线程会更容易。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-30T22:14:12.937

也许你想发出一个信号？

我真的很喜欢 Qt 的信号和插槽功能，而且我知道 Boost 也有信号/插槽。不过，我从未在 Boost 中使用过信号/插槽。

# c# - 如何在 .Net 中获取视频缩略图？

> ID：155314
> 
> 赞同：26
> 
> 时间：2008-09-30T22:06:17.730
> 
> 标签：c#, .net, video-processing

我正在寻找实现从输入视频中检索单个帧的功能，因此我可以将其用作缩略图。

这些方面的东西应该起作用：

```
// filename examples: "test.avi", "test.dvr-ms"
// position is from 0 to 100 percent (0.0 to 1.0)
// returns a bitmap
byte[] GetVideoThumbnail(string filename, float position)
{
} 
```

有谁知道如何在.Net 3.0 中做到这一点？

正确的解决方案将是此功能的“最佳”实现。避免选择空白帧的奖励积分。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-01-07T02:14:09.763

我最终推出了自己的独立类（使用我描述的单一方法），可以在[此处查看](https://gist.github.com/2823028)源代码。[媒体浏览器是](http://www.mediabrowser.tv)GPL，但我很高兴我为该文件编写的代码成为公共领域。请记住，它使用来自[directshow.net](http://sourceforge.net/projects/directshownet/)项目的互操作，因此您必须使用它们清除那部分代码。

此类不适用于 DVR-MS 文件，您需要为这些文件注入直接显示过滤器。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-09-30T22:08:37.773

这个项目将为 AVI 解决问题：http: [//www.codeproject.com/KB/audio-video/avifilewrapper.aspx](http://www.codeproject.com/KB/audio-video/avifilewrapper.aspx)

任何其他格式，您都可以查看 directshow。有一些项目可能会有所帮助：http:
[//sourceforge.net/projects/directshownet/](http://sourceforge.net/projects/directshownet/)
[http://code.google.com/p/slimdx/](http://code.google.com/p/slimdx/)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2011-07-27T22:44:25.193

[1- 从http://ffmpeg.arrozcru.org/builds/](http://ffmpeg.arrozcru.org/builds/)获取最新版本的 ffmpeg.exe

2- 提取文件并将 ffmpeg.exe 复制到您的网站

3-使用此代码：

```
Process ffmpeg;

string video;
string thumb;

video = Server.MapPath("first.avi");
thumb = Server.MapPath("frame.jpg");

ffmpeg = new Process();

ffmpeg.StartInfo.Arguments = " -i "+video+" -ss 00:00:07 -vframes 1 -f image2 -vcodec mjpeg "+thumb;
ffmpeg.StartInfo.FileName = Server.MapPath("ffmpeg.exe");
ffmpeg.Start(); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-20T17:05:05.930

[www.mitov.com](http://www.mitov.com)上有一些图书馆可能会有所帮助。它是 Directshow 功能的通用包装器，我认为其中一个演示展示了如何从视频文件中获取帧。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-07-29T02:11:24.493

这也值得一看：

[http://www.codeproject.com/Articles/13237/Extract-Frames-from-Video-Files](http://www.codeproject.com/Articles/13237/Extract-Frames-from-Video-Files)

# sql-server - OUTPUT INTO 子句中可以使用哪些列？

> ID：155321
> 
> 赞同：16
> 
> 时间：2008-09-30T22:08:43.637
> 
> 标签：sql-server

我正在尝试构建一个映射表，以将表中新行的 ID 与从中复制它们的 ID 关联起来。OUTPUT INTO 子句似乎非常适合，但它的行为似乎不符合文档。

我的代码：

```
DECLARE @Missing TABLE (SrcContentID INT PRIMARY KEY )
INSERT INTO @Missing 
    ( SrcContentID ) 
SELECT cshadow.ContentID
    FROM Private.Content AS cshadow
    LEFT JOIN Private.Content AS cglobal ON cshadow.Tag = cglobal.Tag
    WHERE cglobal.ContentID IS NULL 

PRINT 'Adding new content headers'
DECLARE @Inserted TABLE (SrcContentID INT PRIMARY KEY, TgtContentID INT )
INSERT INTO Private.Content 
    ( Tag, Description, ContentDate, DateActivate, DateDeactivate, SortOrder, CreatedOn, IsDeleted, ContentClassCode, ContentGroupID, OrgUnitID ) 
    OUTPUT cglobal.ContentID, INSERTED.ContentID INTO @Inserted (SrcContentID, TgtContentID)
SELECT Tag, Description, ContentDate, DateActivate, DateDeactivate, SortOrder, CreatedOn, IsDeleted, ContentClassCode, ContentGroupID, NULL 
    FROM Private.Content AS cglobal
    INNER JOIN @Missing AS m ON cglobal.ContentID = m.SrcContentID 
```

导致错误消息：

```
Msg 207, Level 16, State 1, Line 34
Invalid column name 'SrcContentID'. 
```

（第 34 行是带有 OUTPUT INTO 的行）

实验表明，只有实际存在于 INSERT 目标中的行才能在 OUTPUT INTO 中选择。但这与在线书籍中的文档相矛盾。关于**OUTPUT 子句**的文章有示例 E，描述了类似的用法：

> OUTPUT INTO 子句从正在更新的表 (WorkOrder) 以及 Product 表中返回值。Product 表在 FROM 子句中用于指定要更新的行。

有人用过这个功能吗？

（与此同时，我已经重写了我的代码以使用游标循环来完成这项工作，但这很丑陋，我仍然很好奇）

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2011-03-24T18:14:56.397

您可以在 Sql Server 2008 中使用 MERGE 执行此操作。示例代码如下：

```
--drop table A
create table A (a int primary key identity(1, 1))
insert into A default values
insert into A default values

delete from A where a>=3

-- insert two values into A and get the new primary keys
MERGE a USING (SELECT a FROM A) AS B(a)
ON (1 = 0) -- ignore the values, NOT MATCHED will always be true
WHEN NOT MATCHED THEN INSERT DEFAULT VALUES -- always insert here for this example
OUTPUT $action, inserted.*, deleted.*, B.a; -- show the new primary key and source data 
```

结果是

```
INSERT, 3, NULL, 1
INSERT, 4, NULL, 2 
```

即，对于每一行，新的主键 (3, 4) 和旧的主键 (1, 2)。创建一个名为 #OUTPUT 的表并添加“ INTO #OUTPUT;” 在 OUTPUT 子句的末尾将保存记录。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-10-01T05:35:22.160

我已经验证问题是您只能使用`INSERTED`列。该文档似乎表明您可以使用`from_table_name`，但我似乎无法使其工作（无法绑定多部分标识符“m.ContentID”。）：

```
TRUNCATE TABLE main

SELECT *
FROM incoming

SELECT *
FROM main

DECLARE @Missing TABLE (ContentID INT PRIMARY KEY)
INSERT INTO @Missing(ContentID) 
SELECT incoming.ContentID
FROM incoming
LEFT JOIN main
    ON main.ContentID = incoming.ContentID
WHERE main.ContentID IS NULL

SELECT *
FROM @Missing

DECLARE @Inserted TABLE (ContentID INT PRIMARY KEY, [Content] varchar(50))
INSERT INTO main(ContentID, [Content]) 
OUTPUT INSERTED.ContentID /* incoming doesn't work, m doesn't work */, INSERTED.[Content] INTO @Inserted (ContentID, [Content])
SELECT incoming.ContentID, incoming.[Content] 
FROM incoming
INNER JOIN @Missing AS m
    ON m.ContentID = incoming.ContentID

SELECT *
FROM @Inserted

SELECT *
FROM incoming

SELECT *
FROM main 
```

显然，`from_table_name`前缀只允许在`DELETE`or `UPDATE`（或`MERGE`在 2008 年） - 我不知道为什么：

*   `from_table_name`

是一个列前缀，它指定包含在or语句的`FROM`子句中的表，用于指定要更新或删除的行。`DELETE``UPDATE`

如果在子句中还指定了要修改的表，则对该`FROM`表中列的任何引用都必须使用`INSERTED`or`DELETED`前缀进行限定。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-03-18T16:48:48.347

我遇到了与您完全相同的问题，我感到您的痛苦……据我所知，无法将 from_table_name 前缀与 INSERT 语句一起使用。我确信这有一个可行的技术原因，我很想知道它到底是什么。

好的，找到了，这里有一篇关于为什么它不起作用的论坛帖子： [MSDN forums](http://social.msdn.microsoft.com/forums/en-US/transactsql/thread/c1fe0b9c-9305-4cb0-9237-9374ff4fc03e/)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-19T12:34:09.540

我想我找到了解决这个问题的方法，遗憾的是它涉及一个临时表，但至少它可以防止创建一个可怕的游标:) 你需要做的是在你正在复制记录的表中添加一个额外的列from 并给它一个 'uniqueidentifer' 类型。

然后声明一个临时表：

```
DECLARE @tmptable TABLE (uniqueid uniqueidentifier, original_id int, new_id int) 
```

像这样将数据插入到您的临时表中：

```
insert into @tmptable
(uniqueid,original_id,new_id)
select NewId(),id,0 from OriginalTable 
```

继续并在原始表中进行真正的插入：

```
insert into OriginalTable
(uniqueid)
select uniqueid from @tmptable 
```

现在将新创建的标识值添加到您的临时表中：

```
update @tmptable
set new_id = o.id
from OriginalTable o inner join @tmptable tmp on tmp.uniqueid = o.uniqueid 
```

现在您有一个查找表，将新 id 和原始 id 保存在一条记录中，供您使用 :)

我希望这可以帮助某人...

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-11-16T08:14:07.067

(MS) 如果正在修改的表也在 FROM 子句中指定，则对该表中列的任何引用都必须使用 INSERTED 或 DELETED 前缀进行限定。

在您的示例中，您不能在 OUTPUT 中使用 cglobal 表，除非它是 INSERTED.column_name 或 DELETED.column_name：

```
INSERT INTO Private.Content 
    (Tag) 
    OUTPUT cglobal.ContentID, INSERTED.ContentID 
    INTO @Inserted (SrcContentID, TgtContentID)
SELECT Tag
    FROM Private.Content AS cglobal
    INNER JOIN @Missing AS m ON cglobal.ContentID = m.SrcContentID 
```

对我有用的是一个简单的别名表，如下所示：

```
INSERT INTO con1 
    (Tag) 
    OUTPUT **con2**.ContentID, INSERTED.ContentID 
    INTO @Inserted (SrcContentID, TgtContentID)
SELECT Tag
    FROM Private.Content con1
    **INNER JOIN Private.Content con2 ON con1.id=con2.id**
    INNER JOIN @Missing AS m ON con1.ContentID = m.SrcContentID 
```

# windows - Web 应用程序的带宽和流量模拟器？

> ID：155329
> 
> 赞同：13
> 
> 时间：2008-09-30T22:11:39.840
> 
> 标签：windows, linux, simulation

您能否建议如何创建一个测试环境来模拟 Web 应用程序中的各种类型的带宽和流量？

或者也许是一个针对 localhost 的开源程序？

我认为在编写 Web 应用程序时这是一个非常重要的主题，但这不是一个常见的主题，我可以想象创建这种环境的唯一方法是在本地网络中使用某种代理，但在开始研究 squid 之前文档 我想听听您的建议。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-30T22:15:54.277

如果您使用的是 apache，您可能想看看[apache ab](http://httpd.apache.org/docs/2.0/programs/ab.html)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-30T19:24:48.513

有两种方法可以塑造网络流量以模拟网络链接：

1.  在位于网络堆栈中某处的客户端或服务器上运行一些软件，并塑造应用程序和网络接口之间的流量
2.  在具有 2 个用于路由流量的网络接口的专用机器上运行流量整形软件

(2) 如果您不想在客户端或服务器上安装软件（并且可能影响性能），但需要更多的硬件摆弄，那么（2）是一个更好的解决方案。

您可能需要考虑的其他一些功能是可以模拟哪些整形参数。大多数会延迟和丢包，有些还会抖动和带宽限制。一些解决方案可以选择性地过滤流量（例如通过端口号、TCP 或 UDP 等）。

以下是我发现的一些系统的列表：

**开源或免费软件**

[DummyNet](http://info.iet.unipi.it/~luigi/ip_dummynet/)是一个开源的基于 BSD Unix 的专用设备。目前尚不清楚该软件是否正在积极维护

[NistNet](http://snad.ncsl.nist.gov/nistnet/)是用于专用设备的基于 Linux 的开源系统。该软件已经好几年没有得到积极的维护了。

**商业的**

[Apposite Technoligies](http://www.apposite-tech.com/)销售用于模拟 WAN 链接的专用硬件解决方案，以及用于配置设置和收集流量测量的基于 Web 的 GUI

[East Coast DataCom](http://www.ecdata.com/compprof.htm)销售用于模拟路由器和调制解调器的硬件专用模拟器

[Itrinegy](http://www.itrinegy.com/)提供专用设备解决方案和在客户端或服务器上运行的解决方案。

[Network FX](http://www.networkfx.com/) 提供多种专用设备产品，用于模拟客户端和服务器之间的网络损伤

[NetLimiter](http://www.netlimiter.com/)是一个客户端系统，允许对单个应用程序进行节流，并包含防火墙。

[Shunra Software](http://www.shunra.com/)提供一系列产品，从高端企业 WAN 模拟和测试到简单的客户端驻留仿真器。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-30T22:13:38.947

我能想到的最接近的是用Shunra的[VEDekstop](http://www.shunra.com/vedesktop.aspx)做类似的事情。

[模拟数据库应用程序测试中的高延迟和低带宽](http://sqlblog.com/blogs/john_paul_cook/archive/2008/04/13/simulating-high-latency-and-low-bandwidth-for-database-connectivity-testing.aspx)

*Shunra VE Desktop Standard 是一种基于 Windows 的客户端软件解决方案，可模拟广域网链接，以便您可以直接从您的桌面在各种当前和潜在的网络条件下测试应用程序。*

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-01T00:32:50.467

不久前我写了一个 php 脚本，它使用 CURL 对我的服务器运行一系列页面请求，这代表了一个典型的使用场景。我让它输出服务器响应每个请求所花费的时间。然后我有另一个脚本，它在一段时间内同时生成了一堆这些测试用例脚本，并将结果关联到一个文件中，然后我可以在电子表格中查看该文件以查看平均时间。通过这种方式，我可以模拟访问我想要的网站的用户数量。限制是您需要在与 Web 服务器不同的服务器上运行测试脚本，并且客户端机器可能会因为负载过大而无法在某个点之后给出有意义的结果。我已经离开了工作，否则我会把脚本贴在这里。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-25T10:05:57.133

如果您将 Linux 机器作为服务器，Linux 机器作为客户端，或者能够在客户端和服务器之间放置（可能是虚拟机）Linux 路由器，则可以使用 NetEm。

[NetEm](http://www.linuxfoundation.org/en/Net:Netem)是一个 Linux TC（流量控制）规则，它可以延迟（即增加延迟）数据包离开主机。尽管设置巧妙的规则很棘手（例如，为某些流量添加延迟，而不是其他流量），但添加一个简单的“将所有离开接口的内容延迟 50 毫秒”类型的规则很容易，并且提供了一些方法。

通过在客户端和服务器之间放置一个 Linux VM，您可以模拟尽可能多的延迟。您可以动态打开和关闭它。Linux 有其他 TC 规则可以与 NetEm 结合来限制带宽（但是设置它的脚本可能有些复杂）。NetEm 也可以随机丢弃数据包。

我用它，它很管用：）

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-30T19:30:50.670

正如其他人所提到的，[Apache 的 ab](http://httpd.apache.org/docs/2.0/programs/ab.html)（Apache 附带，因此您可能已经拥有它）很好。

其他不错的选择是：

*   HP 的[LoadRunner](http://en.wikipedia.org/wiki/LoadRunner) Apache
*   雅加达的[JMeter](http://jakarta.apache.org/jmeter/)
*   [Tsung](http://tsung.erlang-projects.org/)（如果你想让你的 erlang 上）

我个人最喜欢 ab 和 JMeter。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-03-05T18:08:53.450

来自 Microsoft 的 Web 应用程序压力工具 (WAST) 正是您所需要的。

[http://www.microsoft.com/downloads/details.aspx?familyid=e2c0585a-062a-439e-a67d-75a89aa36495&displaylang=en](http://www.microsoft.com/downloads/details.aspx?familyid=e2c0585a-062a-439e-a67d-75a89aa36495&displaylang=en)

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2010-07-29T04:36:15.807

我已经多年没有使用它了（不需要，不是因为我发现了其他任何东西），但是[xat webspeed](http://www.xat.com/wo/index.html)将是我要指出的第一件事

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-01T19:38:40.370

我发现了这个运行良好的小 Java 程序：[邋遢](http://www.dallaway.com/sloppy/)

但这不是一个专业的解决方案，但它适用于简单的测试，我猜它使用 java 流和缓冲区来减慢连接速度。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-10-01T01:42:49.537

我们使用 Loadrunner 在我们的 App 中进行带宽和流量模拟。Loadrunner 可以在各种机器上启动代理，您可以模拟一台机器在拨号调制解调器上运行，另一台在 DSL 上运行，另一台在有线互联网上运行。我们还使用 Loadrunner 来模拟从 10 个用户运行到 500 个用户运行的各种流量情况。我们还可以在脚本中插入思考时间并模拟执行 http 请求的真实用户。最好的部分是它带有一个录音室，它可以插入 Internet Explorer，您可以记录整个场景/用例，这可以像点击一页到完整的 50-60 页脚本或更多一样简单。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-10-25T09:57:37.883

你看过宗璇吗？这是一个很好的实用程序，可以查看您的网站是否会在受到攻击时扩展，我的意思是非常受欢迎。我们将它用于我们的 Web 前端，以及我们的内部系统。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-12-05T00:50:19.763

如果您有兴趣在浏览器中执行测试，还有[一个非常棒的 Firefox 插件](http://www.uselessapplications.com/en/Application/FirefoxThrottle.aspx)。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2011-05-03T10:23:33.663

不要忘记 Wanulator (http://www.wanulator.de/)。Wanulator 这个名字来自“WAN”和“模拟器”。这几乎描述了该软件的功能：它模拟不同的 Internet 条件，例如延迟或丢包。此外，它模拟用户接入线路速度，例如调制解调器、ISDN 或 ADSL。Wanulator 目前是打包为基于 SLAX 的 Linux 启动 CD。这将为您提供完整的开箱即用体验。您可以在眨眼间将任何 PC 变成测试系统 - 只需启动 Wanulator CD。该软件包已经包含有用的客户端软件例如网络浏览器和网络嗅探器（Wireshark）。不过，如果 PC 有 2 个网络接口，则系统可以作为服务器和客户端之间的中间系统运行 - 作为交换机 - 无需任何配置麻烦。

# oracle - ExecuteScalar 在服务器上不起作用

> ID：155334
> 
> 赞同：0
> 
> 时间：2008-09-30T22:13:30.803
> 
> 标签：oracle, .net-2.0

该应用程序使用 Oracle DataAccess 版本。1.1。, VS 2008, .Net Framework 3.5 w/SP1

```
OracleConnection connection = new OracleConnection(ConnectionStringLogon);
connection.Open();

OracleParameter selectParam = new OracleParameter(":applicationName", OracleDbType.Varchar2, 256);
selectParam.Value = applicationName;

if (connection.State != ConnectionState.Open)
    connection.Open();

OracleCommand cmd = new OracleCommand();

cmd.Connection = connection;
cmd.CommandText = "Select ApplicationId from Applications where AppName = 'appName'";
cmd.CommandType = CommandType.Text;

if (selectParam != null)
{
        cmd.Parameters.Add(selectParam);
}
object lookupResult = cmd.ExecuteScalar();
cmd.Parameters.Clear();

if (lookupResult != null) 
```

该过程在 object lookupResult = cmd.ExecuteScalar(); 上失败；出现此错误：

事件类型：错误事件源：应用程序日志事件类别：无事件 ID：9961 日期：2008 年 9 月 30 日时间：下午 4:42:11 用户：不适用计算机：Server15 描述：System.NullReferenceException：未设置对象引用到一个对象的实例。在 Oracle.DataAccess.Client.OracleCommand.ExecuteReader(Boolean requery, Boolean fillRequest, CommandBehavior 行为) 在 Oracle.DataAccess.Client.OracleCommand.ExecuteReader() 在 Oracle.DataAccess.Client.OracleCommand.ExecuteScalar() 在 Membership.OracleMembershipProvider.GetApplicationId OracleMembershipProvider.cs 中的（字符串 applicationName，布尔 createIfNeeded）：第 1626 行

我已经从我能想到的各个角度看待这个问题......基本上，无论我如何包装它，执行都失败了。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-30T22:53:41.440

这不是“ExecuteReader”中的错误。执行查询时出错...为`applicationName`空？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-30T22:27:40.083

我注意到您的 CommandText 不包含指定的参数“：applicationName”

# c# - 学习 CIL (MSIL) 的最佳资源是什么

> ID：155357
> 
> 赞同：19
> 
> 时间：2008-09-30T22:21:15.183
> 
> 标签：c#, .net, code-generation, cil

我是一名 C# 3 / .NET 3.5 专家，希望开始使用 System.Reflection.Emit.DynamicMethod 进行一些运行时代码生成。我很想通过熟悉 IL 来更上一层楼。

任何指针（双关语）？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-01T08:55:22.693

除了达伦的回答，我建议选择或发明一种玩具语言，并为它编写一个简单的编译器。选择一些不需要解析的东西，比如 BF 或基于堆栈的语言，你会发现编写编译器实际上比看起来更简单。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-30T22:28:01.080

学习它的最好方法是写一些你理解的东西，然后看看它创建的 IL。此外，根据您所做的工作，您可以使用表达式树而不是发出 IL，然后当您编译表达式树时，微软的那些聪明人会为您创建 IL。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-09-30T22:47:44.167

[.NET Reflector](http://www.red-gate.com/products/reflector/index.htm)非常适合检查 C#/VB.NET 生成的 IL。

这是一个很棒的学习工具。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-10-01T07:47:52.560

ECMA 335 规范可在此处免费下载：http: [//www.ecma-international.org/publications/standards/Ecma-335.htm](http://www.ecma-international.org/publications/standards/Ecma-335.htm)

分区 III 与处理 MSIL 最相关，但我强烈建议任何 .NET 开发人员也使用分区 I，因为它将极大地巩固对平台的理解。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-30T22:31:21.367

[专家 .NET 2.0 IL 汇编程序。](https://rads.stackoverflow.com/amzn/click/com/1590596463)虽然这本书现在可能有点过时，但对我来说仍然是一个很好的概述。

# c# - 切换任务时不会触发 Control.Enter 事件。有替代方案吗？

> ID：155366
> 
> 赞同：1
> 
> 时间：2008-09-30T22:25:17.030
> 
> 标签：c#, events, user-interface

代表步骤：

1.  创建示例 .NET 表单应用程序
2.  在表单上放置一个文本框
3.  将函数连接到 TextBox 的 Enter 事件

当您运行此应用程序时，当焦点第一次转到 TextBox 时会触发**Control.Enter事件。**但是，如果您单击离开另一个应用程序，然后单击返回测试应用程序，则该事件不会再次触发。

因此**，在应用程序之间移动不会触发 Enter/Leave**。

是否有另一种可供我使用的替代*控制级*事件，它会在这种情况下触发？

通常，我会使用**Form.Activated**。不幸的是，这在这里很麻烦，因为我的组件由一个停靠系统托管，该系统可以将我的组件取消停靠到一个新的表单中而无需通知我。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-01T01:40:27.047

你想在 Enter 事件中做什么？

我找不到在您的示例程序中触发的另一个控件级事件，但是当我的测试应用程序确实重新获得焦点时，最后获得焦点的控件仍然具有它。

有趣的问题，但它需要更多的上下文。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-02T20:58:57.393

如果我尝试您的示例并在另一个窗口、桌面等上的控件外部单击，我可以触发 Got 和 Lost Focus 事件，但如果您只是尝试在表单或只有 1 个控件的控件内单击，这些事件*永远不会*被触发，因为它是唯一需要关注的事情。既不会进入也不会离开，除非你改变动态或超载控制，你不能让这种情况发生

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-01T04:12:05.013

在您的示例中，我认为您需要另一个控件。原因是第一个控件 (tabIndex 0) 是具有焦点的控件。由于没有其他控件可以将焦点切换到，此控件将始终保持焦点，因此永远无法进入。切换到另一个应用程序或表单不会更改此表单中的焦点或活动控件，因此当您返回时，您仍然不会触发事件。

添加控件 control.entered 应该可以正常工作。如果这是您唯一的控件，为什么不在窗体获得焦点时调用 formLoad 或 TextChanged 上的事件？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-01T15:02:08.710

谢谢，我会提供一些背景。

我的控件是一个包含网格和工具栏的 UserControl。用户通常会启动其中几个控件来查看系统数据的不同部分。

有几个键盘快捷键可以从当前网格中的选定行启动操作。但是，要求这些键盘快捷键不仅适用**于当前聚焦的网格**。如果用户当前专注于应用程序的许多其他区域之一，那么这个键盘快捷键应该仍然有效，它应该被路由到**最后一个焦点网格**。

所以我将一个函数连接到我的 UserControl 的 Control.Enter 事件，基本上说 LastFocusedGrid = this。

它会工作，除了对接和脱离...

看，这些控件托管在具有停靠功能的应用程序中，有点类似于 Visual Studio。

默认情况下，控件作为应用程序主工作区域中的选项卡启动，类似于在 Visual Studio 中打开源文件的方式。

但是，用户可以通过抓住选项卡标题并将其拖出主应用程序来“撕掉”选项卡。此时，应用程序创建一个新的“浮动表单”来承载控件。就 Control.Enter 和 Form.Activated 事件而言，在主应用程序和此浮动表单之间切换与在应用程序之间切换相同。

那时，我们使用原始帖子中描述的示例应用程序模拟了“表单中的一个控件”场景。

现在，有一些方法可以解决这个问题。我可以利用 Form.Activated 事件，该事件在表单之间切换时会触发。如果您在测试应用程序中将一个事件添加到 Form 的 Activated 事件中，您会发现它工作得很好。

问题是我的 UserControl 与其父窗体的关系是流动的，使得解决方案有些复杂。我尝试连接到“this.ParentForm.Activated”，它工作正常。问题是你什么时候调用这个？当您取消停靠/重新停靠时会发生什么？我最终得到了一堆令人讨厌的代码，其中包含“previousParentForm”之类的东西，这样我就可以从旧表单中解脱出来，然后我仍然面临着当我的父表单被更改时对接系统没有通知我的问题，所以我也必须在那里做一些改变。

这些问题并非无法解决，但如果有一个更简单的控制级“父窗体被激活”事件，那就优雅多了。

这相当长，但我希望它能澄清情况。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-01T17:50:01.567

那么在创建网格的时候，能不能不设置KeyPressed、KeyUp等事件呢？如果是这样，所有网格都可以使用相同的事件处理程序。只需确保当您进入事件处理程序时执行以下操作：

```
Grid currentGrid = (Grid)sender; 
```

然后，您应该能够将该代码块应用于发送进来的任何网格，而不必担心跟踪。

由于所有的事件处理程序确实是，它的位置实际上是一个静音点，只要您需要执行它的所有内容都可以访问。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-01T18:23:37.087

Frye，问题是无论用户在应用程序中的哪个位置，键盘快捷键都应该起作用。它们是全局命令，在顶层处理，然后路由到“最后聚焦的网格”。

因此，在网格级别处理击键将无济于事。

更具体地说，假设用户启动了网格 A、B 和 C。但他还启动了与我的代码无关的其他控件 X、Y 和 Z。

用户点击A，然后点击C。然后他点击Y，然后点击Z。专注于Z，他点击了我的键盘快捷键。在这种情况下，网格 C 应该响应，因为它是用户关注的最后一个网格。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-01T19:09:59.550

听起来您遇到的问题与 Enter 事件没有直接关系，更重要的是，如果您有“与您的代码无关”的控件，那么您实际上并没有查看控件级别事件.

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-01T20:25:00.960

估计我不是很清楚。

我的控件位于容器应用程序中。其他团队的其他不相关控制也是如此。把它想象成 Visual Studio——我的控件是代码编辑选项卡，但还有待处理的更改列表和属性窗口，它们与源文件共存但不直接相关。

键盘快捷键由容器应用程序处理。然后它应该被路由到用户关注的最后一个控件。

维护这个“LastFocusedGrid”参考是我在 Enter 事件中所做的。

如果你想在 Visual Studio 中看到类似的功能，试试这个：

1.  打开几个源文件
2.  导航到“起始页”选项卡。
3.  按 Ctrl-F 并在“当前文档”中搜索一些字符串
4.  请注意， serach 功能会自动导航到 LAST FOCUSED 源文件以执行搜索。

因此，即使您没有关注源文件，ctrl-F 命令也会由 Visual Studio 处理并路由到最后一个关注的源文件选项卡。

现在用 Ctrl-G 尝试同样的事情。除非您直接关注源文件，否则它不起作用。

我的键盘命令在这里需要像 Ctrl-F 一样工作，而不是像 Ctrl-G。这就是为什么我不直接在我的控件中捕获键盘事件。

这是否澄清或使事情变得更糟？

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-01T21:36:17.747

您是否尝试过简单的 Control.GotFocus？

* * *

## 回答 #10

> 赞同：-2
> 
> 时间：2015-08-24T16:35:45.760

在此示例中，如果您在单击文本框之间切换，则 enter 或 got focus 都不会按预期执行，但是如果您单击子表单，两者都会按预期运行。

```
 using System;
    using System.Collections.Generic;
    using System.Linq;
    using System.Windows.Forms;

    namespace EnterBrokenExample
    {
        static class Program
        {
            /// <summary>
            /// The main entry point for the application.
            /// </summary>
            [STAThread]
            static void Main()
            {
                Application.EnableVisualStyles();
                Application.SetCompatibleTextRenderingDefault(false);

                Form Form1 = new Form();
                Form c1 = new Form();
                Form c2 = new Form();

                Form1.IsMdiContainer = true;

                c1.MdiParent = Form1;
                c2.MdiParent = Form1;

                c1.Show();
                c2.Show();

                TextBox tb1 = new TextBox();
                c1.Controls.Add(tb1);
                tb1.Enter += ontbenter;
                tb1.Text = "Some Text";
                tb1.GotFocus += ongotfocus;

                TextBox tb2 = new TextBox();
                c2.Controls.Add(tb2);
                tb2.Enter += ontbenter;
                tb2.Text = "some other text";
                tb2.GotFocus += ongotfocus;

                Application.Run(Form1);
            }
            static void ontbenter(object sender, EventArgs args)
            {
                if (!(sender is TextBox))
                    return;
                TextBox s = (TextBox)sender;
                s.SelectAll();
            }

            static void ongotfocus(object sender, EventArgs args)
            {
                if (!(sender is TextBox))
                    return;
                TextBox s = (TextBox)sender;
                s.SelectAll();
            }
        }
    } 
```

# sql-server - Oracle 在 SQL Server 2008 中是否有类似变更数据捕获的功能？

> ID：155367
> 
> 赞同：3
> 
> 时间：2008-09-30T22:26:13.907
> 
> 标签：sql-server, oracle

更改数据捕获是 SQL Server 2008 中的一项新功能。来自 MSDN：

> 更改数据捕获通过捕获已进行 DML 更改的事实和已更改的实际数据来为用户表提供历史更改信息。通过使用读取事务日志且对系统影响较小的异步进程来捕获更改

这是非常甜蜜的 - 不再手动添加 CreatedDate 和 LastModifiedBy 列。

甲骨文有这样的东西吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-30T22:40:50.580

当然。根据业务需求，Oracle 实际上有许多用于此类事情的技术。

*   Oracle 长期以来（8i 天）都有一个叫做[Workspace Manager](http://download.oracle.com/docs/cd/B19306_01/appdev.102/b14253/long_intro.htm#ADWSM010)的东西，它允许您对表启用版本并跟踪一段时间内的更改。不过，这可能有点重量级，因为它基于视图而不是触发器。
*   从 11.1 开始（作为企业版的额外费用选项），Oracle 有一个 Total Recall，它异步挖掘重做日志以获取记录到单独表中的数据更改，然后可以在主表上使用闪回查询语法进行查询。Total Recall 会自动对历史数据进行分区和压缩，并在指定的数据保留期后自动清除数据。
*   Oracle 拥有一种 LogMiner 技术，可以挖掘重做日志并将事务呈现给消费者。在 LogMiner 之上构建了许多技术，包括[Change Data Capture](http://download.oracle.com/docs/cd/B19306_01/server.102/b14223/cdc.htm#sthref889)和[Streams](http://download.oracle.com/docs/cd/B19306_01/server.102/b14229/strms_over.htm#STRMS001)。
*   如果目标是复制更改，您还可以使用物化视图和物化视图日志。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-01T16:34:26.163

Oracle 具有更改数据通知，您可以在其中向系统注册查询，并且在该查询中访问的资源被标记为要监视。对这些资源的更改由系统排队，允许您针对数据运行 procs。

这是使用 DBMS_CHANGE_NOTIFICATION 包管理的。

这是一个关于它的信息文档： [http ://www.oracle-base.com/articles/10g/dbms_change_notification_10gR2.php](http://www.oracle-base.com/articles/10g/dbms_change_notification_10gR2.php)

如果您从 C# 应用程序连接到 Oracle，ODP.Net（Oracles .Net 客户端库）可以与更改数据通知交互，以在进行 Oracle 更改时提醒您的 c# 应用程序 - 非常漂亮。如果您问我，请告别反复轮询数据更改 - 只需注册表，通过 ODP.Net 和 wala 设置更改数据通知，仅在必要时调用 c# 方法。哇！

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-01T02:55:29.207

“不再手动添加 CreatedDate 和 LastModifiedBy 列” ...只要您有能力在重做日志中在线保留数据库的完整历史记录，并且永远不想将数据移动到不同的数据库。

我会继续添加它们，并避免依赖像这样的内置数据库技术。如果您需要保留记录的历史状态，请使用审计表或将所有内容发送到数据仓库，以正确处理缓慢变化的维度。

话虽如此，我将补充一点，Oracle 10g+ 可以通过使用闪回查询语法来挖掘日志文件。此处的示例：http: [//download.oracle.com/docs/cd/B19306_01/server.102/b14200/statements_10002.htm#i2112847](http://download.oracle.com/docs/cd/B19306_01/server.102/b14200/statements_10002.htm#i2112847)

该技术还用于 Oracle 的 Datapump 导出实用程序，为多个表提供一致的数据。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-30T22:35:07.567

我相信 Oracle 从 8i 开始就提供了审计功能，但是用于捕获数据的表相当复杂，并且在启用此功能时会对性能产生重大影响。

在 Oracle 8i 中，您一次只能为整个数据库而不是一个表启用此功能，但是 9i 引入了细粒度审计，它提供了更大的灵活性。这已在 10/11g 中进行了扩展。

有关详细信息，请参阅[http://www.oracle.com/technology/deploy/security/database-security/fine-grained-auditing/index.html](http://www.oracle.com/technology/deploy/security/database-security/fine-grained-auditing/index.html)。

同样在 11g 中，Oracle 引入了 Audit Vault，它为审计信息提供了安全的存储，即使是 DBA 也无法更改这些数据（根据 Oracle 的文档，我还没有使用过这个特性）。更多信息可以在[http://www.oracle.com/technology/deploy/security/database-security/fine-grained-auditing/index.html](http://www.oracle.com/technology/deploy/security/database-security/fine-grained-auditing/index.html)找到。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2018-03-28T18:56:04.290

Oracle 具有称为闪回数据存档的机制。重新审视[审计行更改](http://www.oracle.com/technetwork/issue-archive/2016/16-mar/o26performance-2925662.html)：

> Oracle 闪回查询检索过去某个时间存在的数据。
> 
> 闪回数据归档提供了在表的生命周期内跟踪和存储表的所有事务更改的能力。不再需要将此智能构建到您的应用程序中。闪回数据存档对于遵守记录阶段策略和审计报告很有用。

```
CREATE TABLESPACE SPACE_FOR_ARCHIVE 
datafile 'C:\ORACLE DB12\ARCH_SPACE.DBF'size 50G;

CREATE FLASHBACK ARCHIVE longterm
TABLESPACE space_for_archive
RETENTION 1 YEAR;

ALTER TABLE EMPLOYEES FLASHBACK ARCHIVE LONGTERM;

select EMPLOYEE_ID, FIRST_NAME, JOB_ID, VACATION_BALANCE,
        VERSIONS_STARTTIME TS,
        nvl(VERSIONS_OPERATION,'I') OP
from EMPLOYEES
versions between timestamp  timestamp '2016-01-11 08:20:00' and systimestamp
where EMPLOYEE_ID = 100
order by EMPLOYEE_ID, ts; 
```

# javascript - XMLHttpRequest POST 多部分/表单数据

> ID：155371
> 
> 赞同：20
> 
> 时间：2008-09-30T22:27:46.010
> 
> 标签：javascript, ajax, xmlhttprequest

我想在 JavaScript 中使用 XMLHttpRequest 来发布一个包含文件类型输入元素的表单，这样我就可以避免页面刷新并返回有用的 XML。

我可以在不刷新页面的情况下提交表单，使用 JavaScript 将表单上的目标属性设置为 MSIE 的 iframe 或 Mozilla 的对象，但这有两个问题。小问题是目标不符合 W3C（这就是我在 JavaScript 中设置它的原因，而不是在 XHTML 中）。主要问题是 onload 事件不会触发，至少在 OS X Leopard 上的 Mozilla 上不会。此外，XMLHttpRequest 将使响应代码更漂亮，因为返回的数据可以是 XML，而不是像 iframe 那样仅限于 XHTML。

提交表单会产生如下所示的 HTTP：

```
Content-Type: multipart/form-data;boundary=<boundary string>
Content-Length: <length>
--<boundary string>
Content-Disposition: form-data, name="<input element name>"

<input element value>
--<boundary string>
Content-Disposition: form-data, name=<input element name>"; filename="<input element value>"
Content-Type: application/octet-stream

<element body> 
```

如何让 XMLHttpRequest 对象的 send 方法复制上述 HTTP 流？

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2010-11-21T23:02:18.970

[您可以自己构造“multipart/form-data”请求（在http://www.faqs.org/rfcs/rfc2388.html](http://www.faqs.org/rfcs/rfc2388.html)上阅读更多信息），然后使用该`send`方法（即 xhr.send(your-multipart -表格数据））。同样，但更简单的是，在 Firefox 4+（也在 Chrome 5+ 和 Safari 5+）中，您可以使用[FormData](http://hacks.mozilla.org/2010/07/firefox-4-formdata-and-the-new-file-url-object/)接口来帮助构建此类请求。该`send`方法适用于文本内容，但如果您想发送图像等二进制数据，您可以借助`sendAsBinary`从 Firefox 3.0 开始的方法来完成。关于如何通过 发送文件的详细信息`XMLHttpRequest`，请参考[http://blog.igstan.ro/2009/01/pure-javascript-file-upload.html](http://blog.igstan.ro/2009/01/pure-javascript-file-upload.html)。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-30T22:42:40.747

没有任何方法可以访问 javascript 中的文件输入字段，因此没有仅用于 ajax 文件上传的 javascript 解决方案。

有一些解决方法，比如[使用 iframe](http://www.ajaxf1.com/tutorial/ajax-file-upload-tutorial.html)。

另一种选择是使用[SWFUpload](http://www.swfupload.org/)或[Google Gears之类的东西](http://ajaxian.com/archives/youtube-uploader-now-using-gears-and-what-people-missed-in-gears-04)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-30T22:42:31.577

我不明白为什么 iframe（一个不可见的）意味着 XHTML 而不是任何内容。如果您使用 iframe，您可以设置 onreadystatechange 事件并等待“完成”。接下来，您可以使用 frame.window.document.innerHTML （请有人纠正我）来获取字符串结果。

```
var lFrame = document.getElementById('myframe');
lFrame.onreadystatechange = function()
{
   if (lFrame.readyState == 'complete')
   {
      // your frame is done, get the content...
   }
}; 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-30T22:45:52.800

您需要 POST 到 IFrame 才能使其正常工作，只需将 target 属性添加到您的表单中，您可以在其中指定 IFrame ID。像这样的东西：

```
 <form method="post" target="myiframe" action="handler.php">
...
</form>
<iframe id="myiframe" style="display:none" /> 

```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-04T18:15:57.040

我对您指定的 onload 事件感到困惑，它是在页面上还是在 iframe 上？，第一个答案是正确的，如果您想要实现的是在响应存在时触发某个方法，则无法使用纯粹的 xmlhttprequest 来执行此操作在 iframe 上，只需使用 DOM 脚本检查它是否已经有内容，然后触发该方法。

将 onload 事件附加到 iframe

```
if(window.attachEvent){
 document.getElementById(iframe).attachEvent('onload', some_method);
}else{
 document.getElementById(iframe).addEventListener('load', some_method, false);
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-06-29T15:27:23.887

> 内容处置：表单数据，名称

您应该使用分号，如下所示： Content-Disposition: form-data; 姓名

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2017-12-31T13:58:56.107

这是使用 FormData 的最新方式（[完整文档 @MDN](https://developer.mozilla.org/en-US/docs/Web/API/FormData/Using_FormData_Objects)）

脚本：

```
var form = document.querySelector('#myForm');
form.addEventListener("submit", function(e) {
    var xhr = new XMLHttpRequest();
    xhr.open("POST", this.action);
    xhr.addEventListener("load", function(e) {
        // Your callback
    });

    xhr.send(new FormData(this));

    e.preventDefault();
}); 
```

（从这个基本形式）

```
<form id="myForm" action="..." method="POST" enctype="multipart/form-data">
    <input type="file" name="file0">
    <input type="text" name="some-text">
    ...
</form> 
```

再次感谢 Alex Polo 的回答

# c# - 为什么我需要 OleDbCommand.Prepare()？

> ID：155375
> 
> 赞同：2
> 
> 时间：2008-09-30T22:28:56.583
> 
> 标签：c#, .net, stored-procedures, ole

我正在使用通过存储查询（名为“UpdatePaid”，如下所示的 3 个参数）与 MSAccess 表对应的数据网格和适配器，如下所示：

```
 OleDbCommand odc = new OleDbCommand("UpdatePaid", connection);

    OleDbParameter param;

    odc.CommandType = CommandType.StoredProcedure;

    param = odc.Parameters.Add("v_iid", OleDbType.Double);
    param.SourceColumn = "I";
    param.SourceVersion = DataRowVersion.Original;

    param = odc.Parameters.Add("v_pd", OleDbType.Boolean);
    param.SourceColumn = "Paid";
    param.SourceVersion = DataRowVersion.Current;

    param = odc.Parameters.Add("v_Projected", OleDbType.Currency);
    param.SourceColumn = "ProjectedCost";
    param.SourceVersion = DataRowVersion.Current;

    odc.Prepare();

    myAdapter.UpdateCommand = odc;

    ...

    myAdapter.Update(); 
```

它工作正常......但真正奇怪的是，直到我输入**odc.Prepare()**调用它*才起作用。*因此，我的问题是：在使用 OleDb 存储的过程/查询时，我是否需要一直这样做？为什么？我还有另一个项目即将推出，我必须用 SqlDbCommand 做同样的事情......我也必须用这些做吗？

 *** * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-01T04:30:49.490

奇怪的是，这被称为准备好的声明，它们实际上非常好。基本上会发生什么是您创建或获取 sql 语句（插入、删除、更新），而不是传递实际值，而是传递“？” 作为占位符。这一切都很好，除了我们想要传入的值而不是“？”。

因此，我们准备了语句，而不是“？”，而是像上面一样传入参数，这些参数将代替占位符的值。

准备解析字符串以查找参数可以替换问号的位置，因此您所要做的就是输入参数数据并执行命令。

在 oleDB 中，存储的查询是准备好的语句，因此需要准备。我没有使用 SqlDB 的存储查询，所以我不得不推迟到前面的 2 个答案。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-30T23:22:17.987

我不将它与 SqlDbCommand 一起使用。对我来说，它似乎是一个错误，它是*必需*的。如果您要连续多次调用一个过程，它应该只是*很好。*也许我错了，文档中有一条关于过于喜欢这个调用的提供者的注释。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-30T23:27:24.667

您在使用 JET OLEDB 提供程序吗？或 MSDASQL + JET ODBC？

您不需要致电`Prepare()`，但我相信这取决于驱动程序/供应商。

你绝对不需要使用`Prepare()`for `System.Data.SqlClient`。

# c++ - 如何通过最小增量（或接近它）改变浮点数？

> ID：155378
> 
> 赞同：49
> 
> 时间：2008-09-30T22:29:20.703
> 
> 标签：c++, c, floating-point

我有一个`double`值`f`，并且希望有一种方法可以将它稍微大一点（或小一点）以获得一个新值，该值将尽可能接近原始值，但仍严格大于（或小于）原始值。

它不必关闭到最后一点——更重要的是，我所做的任何更改都可以保证产生不同的值，而不是返回到原来的值。

* * *

## 回答 #1

> 赞同：65
> 
> 时间：2008-09-30T22:34:57.850

检查你的 math.h 文件。如果你幸运的话，你已经定义了[`nextafter`](http://en.cppreference.com/w/c/numeric/math/nextafter)and[`nextafterf`](http://en.cppreference.com/w/c/numeric/math/nextafter)函数。它们以可移植且独立于平台的方式完全满足您的需求，并且是 C99 标准的一部分。

另一种方法（可能是后备解决方案）是将浮点数分解为尾数和指数部分。递增很简单：只需将尾数加一即可。如果你得到一个溢出，你必须通过增加你的指数来处理这个问题。递减的工作方式相同。

**编辑**：正如评论中所指出的，只需在其二进制表示中增加浮点数就足够了。尾数溢出将增加指数，这正是我们想要的。

简而言之，这与 nextafter 所做的相同。

不过，这不会是完全可移植的。您将不得不处理字节顺序以及并非所有机器都具有 IEEE 浮点数的事实（好的 - 最后一个原因更具学术性）。

处理 NAN 和无限可能有点棘手。您不能简单地增加它们，因为它们根据定义而不是数字。

* * *

## 回答 #2

> 赞同：23
> 
> 时间：2008-09-30T22:38:05.487

```
u64 &x = *(u64*)(&f);
x++; 
```

是的，认真的。

**编辑：**正如有人指出的那样，这不能正确处理 -ve 数字、Inf、Nan 或溢出。上述更安全的版本是

```
u64 &x = *(u64*)(&f);
if( ((x>>52) & 2047) != 2047 )    //if exponent is all 1's then f is a nan or inf.
{
    x += f>0 ? 1 : -1;
} 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-09-30T22:38:36.077

绝对而言，您可以添加到浮点值以生成新的不同值的最小量将取决于该值的当前大小；它将是类型的[机器 epsilon](http://en.wikipedia.org/wiki/Machine_epsilon)乘以当前指数。

查看[IEEE](http://en.wikipedia.org/wiki/IEEE_754)浮点表示规范。最简单的方法是将值重新解释为整数类型，加 1，然后通过检查符号位和指数位检查（如果您关心的话）您是否没有翻转符号或生成 NaN。

或者，您可以使用[frexp](http://www.cplusplus.com/reference/clibrary/cmath/frexp.html)获取当前尾数和指数，从而计算要添加的值。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-30T22:47:22.453

我需要做同样的事情并想出了这段代码：

```
double DoubleIncrement(double value)
{
  int exponent;
  double mantissa = frexp(value, &exponent);
  if(mantissa == 0)
    return DBL_MIN;

  mantissa += DBL_EPSILON/2.0f;
  value = ldexp(mantissa, exponent);
  return value;
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-30T23:01:20.437

对于它的价值，标准 ++ 递增停止运行的值是 9,007,199,254,740,992。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-01T02:36:45.520

这可能不是您想要的，但您仍然可能会发现[numeric_limits](http://msdn.microsoft.com/en-us/library/85084kd6(VS.80).aspx)正在使用中。特别是成员 min() 和 epsilon()。

我不相信像 mydouble + numeric_limits::epsilon() 这样的东西会做你想做的事，除非 mydouble 已经接近 epsilon。如果是，那么你很幸运。

* * *

## 回答 #7

> 赞同：-2
> 
> 时间：2008-09-30T22:38:40.913

我不久前发现了这段代码，也许它可以帮助您确定可以将其向上推的最小值，然后将其增加该值。不幸的是，我不记得此代码的参考：

```
#include <stdio.h>

int main()
{
    /* two numbers to work with */
    double number1, number2;    // result of calculation
    double result;
    int counter;        // loop counter and accuracy check

    number1 = 1.0;
    number2 = 1.0;
    counter = 0;

    while (number1 + number2 != number1) {
        ++counter;
        number2 = number2 / 10;
    }
    printf("%2d digits accuracy in calculations\n", counter);

    number2 = 1.0;
    counter = 0;

    while (1) {
        result = number1 + number2;
        if (result == number1)
            break;
        ++counter;
        number2 = number2 / 10.0;
    }

    printf("%2d digits accuracy in storage\n", counter );

    return (0);
} 
```

# java - 界面问题

> ID：155388
> 
> 赞同：4
> 
> 时间：2008-09-30T22:32:55.920
> 
> 标签：java, interface

假设我有接口 MyInterface 和 2 个实现 MyInterface 的类 A、B。
我声明了 2 个对象：`MyInterface a = new A()`和`MyInterface b = new B()`.
当我尝试传递给函数时 - 函数`doSomething(A a){}`出现错误。

这是我的代码：

```
public interface MyInterface {}

public class A implements MyInterface{}

public class B implements MyInterface{}

public class Tester {

    public static void main(String[] args){
        MyInterface a = new A();
        MyInterface b = new B();
        test(b);
    }

    public static void test(A a){
        System.out.println("A");
    }

    public static void test(B b){
        System.out.println("B");
    }

} 
```

我的问题是我从一些可以是各种类的组件接口中获取，我需要为每个类编写函数。
所以一种方法是获取接口并检查它是哪种类型。（A的例子）

我想知道其他人是如何处理这个问题的？？

谢谢

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-30T22:39:18.307

你不能只在每个类实现的接口上有一个方法吗？还是您无法控制界面？

这将提供多态性并避免定义任何外部方法的需要。我相信这是接口的意图，它允许客户端以非类型特定的方式处理所有实现它的类。

如果您无法添加到界面，那么您最好使用适当的方法引入第二个界面。如果您无法编辑接口或类，那么您需要一个将接口作为参数的方法，然后检查具体类。然而，这应该是最后的手段，而是颠覆了接口的使用，并将方法与所有实现联系起来。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-30T22:44:52.520

听起来你在追求这样的事情：

```
public static void test(MyInterface obj){
  if(obj instanceof A) {
     A tmp = (A)obj;
  } else if(obj instanceof B) {
     B tmp = (B)obj;
  } else {
     //handle error condition
  }
} 
```

但请注意，这是一种非常糟糕的形式，表明您的设计出现了严重错误。如果您无法控制界面，那么按照 marcj 的建议，添加第二个界面可能是可行的方法。请注意，您可以在保留二进制兼容性的同时执行此操作。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-30T22:38:35.330

我不清楚您实际要问什么，但问题是您没有采用 MyInterface 类型参数的方法。我不知道 Java 中的确切语法是什么，但是您可以执行类似 if (b is B) { test(b as B) } 的操作，但我不会。如果需要泛型，则使用 MyInterface 类型作为变量类型，否则使用 B 作为变量类型。你违背了使用界面的目的。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-30T22:40:23.873

我认为访问者[设计模式](http://en.wikipedia.org/wiki/Visitor_pattern)会帮助你。基本思想是让你的类（A 和 B）自己调用适当的方法，而不是你试图决定调用哪个方法。作为一个 C# 人，我希望我的 Java 可以工作：

```
public interface Visitable {   
   void accept(Tester tester) 
}

public interface MyInterface implements Visitable {    
}

public class A implements MyInterface{
   public void accept(Tester tester){
       tester.test(this);
   }
}

public class B implements MyInterface{
   public void accept(Tester tester){
       tester.test(this);
   }
}

public class Tester {

    public static void main(String[] args){
        MyInterface a = new A();
        MyInterface b = new B();
        a.accept(this);
        b.accept(this);
    }

    public void test(A a){
        System.out.println("A");
    }

    public void test(B b){
        System.out.println("B");
    }

} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-30T22:42:15.880

我不确定我是否完全理解这个问题，但似乎一种方法可能是将 test() 方法移到子类中：

```
public interface MyInterface {    
    public void test();
}

public class A implements MyInterface{
    public void test() {
        System.out.println("A");
    }
}

public class B implements MyInterface{
    public void test() {
        System.out.println("B");
    }
}

public class Tester {

    public static void main(String[] args){
        MyInterface a = new A();
        MyInterface b = new B();
        b.test();
    }
} 
```

您可以类似地使用 toString() 方法并打印结果。但是，如果您的要求使这成为不可能，我无法从这个问题中完全看出。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2012-06-20T09:08:24.023

在一个 .java 文件中只使用一个公共类/接口，否则会抛出错误。并以对象名称调用对象。您仅在Teater类中声明了两个方法，那么声明A，B类的目的是什么。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-30T22:48:41.637

您有 3 个选项：

1.  访客模式；您需要能够更改 MyInterface 类型以包含一个方法`visit(Visitor)`，其中`Visitor`该类包含许多用于访问每个子类的方法。
2.  `if-else`在您的方法内部使用`test(MyInterface)`以检查它们之间
3.  使用链接。也就是说，声明处理程序`ATester`等`BTester`，所有这些都实现了`ITester`具有方法的接口`test(MyInterface)`。然后在 中`ATester`，在做任何事情之前检查类型是否等于 A。然后，您的主 Tester 类可以拥有这些测试器的链并将每个`MyInterface`实例沿链传递，直到它到达`ITester`可以处理它的那个。这基本上是将`if-else`块从 2 变成单独的类。

在大多数情况下，我个人会选择 2 个。Java 缺乏真正的面向对象。处理它！想出各种方法来解决它通常只会导致难以遵循的代码。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-01T04:46:16.303

听起来您需要 a) 通过将方法放在 MyInterface 上并在 A 和 B 中实现来利用多态性，或者 b) 组合和访问者设计模式的某种组合。当事情变得笨拙时，我会从 a) 开始，然后朝着 b) 前进。

我对访客的广泛想法：

[http://tech.puredanger.com/2007/07/16/visitor/](http://tech.puredanger.com/2007/07/16/visitor/)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-30T22:40:09.663

我通常使用抽象类来解决这个问题，如下所示：

> `public abstract class Parent {}`
> `public class A extends Parent {...}`
> `public class B extends Parent {...}`

这允许您将 Parent 对象传递给采用 A 或 B 的函数。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2013-05-14T13:42:39.460

```
public interface MyInterface {}

public class A implements MyInterface{}

public class B implements MyInterface{}

public class Tester {

    public static void main(String[] args){
       MyInterface a = new A();
       MyInterface b = new B();
       test(b); // this is wrong
    }

    public static void test(A a){
        System.out.println("A");
    }

    public static void test(B b){
        System.out.println("B");
    }

} 
```

您正在尝试将`MyInterface`引用变量引用的对象传递给使用其子类型（如`test(B b)`. 编译器在这里抱怨，因为`MyInterface`引用变量可以引用任何子类型的`MyInterface`对象，但不一定是 的对象`B`。如果在 Java 中允许这样做，可能会出现运行时错误。举一个例子，这将使您的概念更清晰。我已经修改了你的类代码`B`并添加了一个方法。

```
public class B implements MyInterface {
    public void onlyBCanInvokeThis() {}

} 
```

现在只需更改如下`test(B b)`方法：

```
public static void test(B b){
    b.onlyBCanInvokeThis();
    System.out.println("B");
} 
```

如果编译器允许，此代码将在运行时崩溃：

```
 MyInterface a = new A();
 // since a is of type A. invoking onlyBCanInvokeThis()
 // inside test() method on a will throw exception.
 test(a); 
```

为了防止这种情况，编译器不允许使用超类引用的这种方法调用技术。

* * *

我不确定您要实现什么目标，但似乎您想要实现运行时多态性。为此，您需要在您的方法中声明一个方法`MyInterface`并在每个子类中实现它。这样，对方法的调用将在运行时根据对象类型而不是引用类型来解决。

```
public interface MyInterface {    
    public void test();
}

public class A implements MyInterface{
    public void test() {
        System.out.println("A");
    }
}

public class B implements MyInterface{
    public void test() {
        System.out.println("B");
    }
}

public class Tester {

    public static void main(String[] args){
        MyInterface a = new A();
        MyInterface b = new B();
        b.test(); // calls B's implementation of test()
    }
} 
```

# .net - WPF中BitmapFrame和BitmapImage的区别

> ID：155391
> 
> 赞同：13
> 
> 时间：2008-09-30T22:33:07.683
> 
> 标签：.net, wpf

WPF中的BitmapFrame和BitmapImage有什么区别？您将在哪里使用每个（即。为什么要使用 BitmapFrame 而不是 BitmapImage？）

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-09-30T22:43:37.953

如果您需要获取位，您应该坚持使用抽象类[BitmapSource](http://msdn.microsoft.com/en-us/library/system.windows.media.imaging.bitmapsource.aspx) ，如果您只想绘制它，甚至可以使用[ImageSource 。](http://msdn.microsoft.com/en-us/library/system.windows.media.imagesource.aspx)

实现 BitmapFrame 只是实现的面向对象的本质。您真的不需要区分实现。BitmapFrames 可能包含一些额外的信息（元数据），但通常只有图像应用程序会关心。

您会注意到这些继承自 BitmapSource 的其他类：

*   位图框
*   位图图像
*   缓存位图
*   颜色转换位图
*   裁剪位图
*   格式转换位图
*   渲染目标位图
*   变换位图
*   可写位图

您可以通过构造 BitmapImage 对象从 URI 中获取 BitmapSource：

```
Uri uri = ...;
BitmapSource bmp = new BitmapImage(uri);
Console.WriteLine("{0}x{1}", bmp.PixelWIdth, bmp.PixelHeight); 
```

BitmapSource 也可以来自解码器。在这种情况下，您间接使用 BitmapFrames。

```
Uri uri = ...;
BitmapDecoder dec = BitmapDecoder.Create(uri, BitmapCreateOptions.None, BitmapCacheOption.Default);
BitmapSource bmp = dec.Frames[0];
Console.WriteLine("{0}x{1}", bmp.PixelWIdth, bmp.PixelHeight); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2014-07-25T00:45:40.927

接受的答案是不完整的（也不意味着我的答案是完整的），我的补充可能会帮助某个地方的人。

我使用 BitmapFrame的原因（尽管是*唯一*`TiffBitmapDecoder`的原因）是当我使用该类访问多帧 TIFF 图像的各个帧时。例如，

```
TiffBitmapDecoder decoder = new TiffBitmapDecoder(
    new Uri(filename), 
    BitmapCreateOptions.None, 
    BitmapCacheOption.None);

for (int frameIndex = 0; frameIndex < decoder.Frames.Count; frameIndex++)
{
    BitmapFrame frame = decoder.Frames[frameIndex];
    // Do something with the frame
    // (it inherits from BitmapSource, so the options are wide open)
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-30T22:55:39.733

BitmapFrame 是用于图像处理的低级原语。当您想将某些图像从一种格式编码/解码为另一种格式时，通常使用它。

BitmapImage 是更高级别的抽象，具有一些简洁的数据绑定属性（UriSource 等）。

如果您只是显示图像并想要一些微调 BitmapImage 是您所需要的。

如果您正在进行低级图像处理，那么您将需要 BitmapFrame。

# c# - 是否有任何一个网站包含许多好的 C# 截屏视频？

> ID：155393
> 
> 赞同：17
> 
> 时间：2008-09-30T22:33:37.447
> 
> 标签：c#

是否有任何一个网站包含许多好的 C# 截屏视频？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-09-30T22:39:48.180

我喜欢标记为 C#的第[9 频道截屏视频。](http://channel9.msdn.com/tags/CSharp/)

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-09-30T22:40:28.337

[Dimecasts.net](http://dimecasts.net/)发布了很多关于各种 .NET 主题的简短截屏视频。一些在 ALT.NET 空间中。他们编写的大多数示例代码都是用 C# 编写的。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-30T22:38:15.877

电视

> dnrTv 融合了培训视频和采访节目。培训视频通常是无菌的和单向的。让我们面对现实吧，你只能拿这么多。但是你需要看代码！在这种格式中，您可以获得采访脱口秀的自发性，以及网络广播或培训视频的细节。
> 
> Carl Franklin 是广受欢迎的 mp3 脱口秀节目 .NET Rocks! 的主持人，他于 2002 年 8 月开始录制该节目。 dnrTV 于 2006 年 1 月 12 日推出，与 .NET Rocks 同一周！显示编号 159！
> 
> 我们将 dnrTV 视为 .NET Rocks! 的天然附属品，允许详细探索更多技术主题。与往常一样，Carl 保持气氛轻松和对话，这是度过午餐时间的好方法！

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2010-01-18T11:26:14.740

抱歉耽搁了，但我认为[TekPub](http://www.tekpub.com/) Screencast 很棒。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-30T22:52:52.313

*   [WindowsClient.net WPF 视频](http://windowsclient.net/learn/videos_wpf.aspx)
*   [Visual C# 开发人员中心](http://msdn.microsoft.com/en-us/vcsharp/aa336819.aspx)
*   [YouTube 搜索“C# 编程”](http://www.youtube.com/results?search_query=c%23+programming&search_type=&aq=f)

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2011-12-06T16:49:10.747

您应该检查[Pluralsight](http://pluralsight-training.net)。他们有很棒的培训视频，他们的 C# Fundamentals 视频是最受欢迎的。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-30T22:38:28.887

[http://www.asp.net/learn/](http://www.asp.net/learn/)

[http://www.learnvisualstudio.net](http://www.learnvisualstudio.net)

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-30T22:42:06.567

好吧...这些不是关于 C# 本身的，但如果你想了解 NHibernate，NHibernate 的[夏天](http://www.summerofnhibernate.com/)可能是我看过的最好的视频。大小适中的捕获，即使它们是关于 NHibernate 的，我也学到了关于重构单元测试的一两件事。我什至捐赠了，因为我认为它们很好。10/10

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-10-05T14:21:23.310

**在 YouTube 上学习 C#**：[**89 个 C# 教程合集**](http://www.youtube.com/view%5Fplay%5Flist?p=CF53106B24EF9ACB)。主要是如何用 C# 做某事的例子。[**另一个 98 个 C# 视频的大集合**](http://www.youtube.com/view%5Fplay%5Flist?p=13141D4688033C31)。它涵盖了很多 C# 基础知识。

# .net - .NET 的 FIPS 兼容密码加密

> ID：155400
> 
> 赞同：4
> 
> 时间：2008-09-30T22:35:47.410
> 
> 标签：.net, vb.net, security, encryption, fips

我正在开发一个需要用户输入域管理员凭据的 VB.NET (3.5) 应用程序中的 WinForms。为了让用户更轻松，他们应该只需要输入一次用户名和密码，然后依靠我的应用程序来保存这些凭据。我想将这些凭据与其他用户设置一起保存，但出于安全原因，密码需要加密。

加密和解密此密码的简单方法是什么？我希望加密方法与 FIPS 兼容。到目前为止我尝试过的方法导致了这个异常：

> System.InvalidOperationException：此实现不是 Windows 平台 FIPS 验证的加密算法的一部分。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-01T05:50:49.813

查看符合 FIPS 的数据保护 API (DPAPI)（据我所知；您可以在[此处](http://technet.microsoft.com/en-us/library/cc750357.aspx)查看评估）。

DPAPI 在 .NET 2.0 及更高版本中通过 System.Security.Cryptography.ProtectedData 类公开。它使用用户当前的凭据作为加密密钥。[在这里](https://stackoverflow.com/questions/154430/persistent-storage-of-encrypted-data-using-net)查看我更完整的答案。

# .net - 在 .NET 中断言参数和值的前置条件和后置条件的最佳方法？

> ID：155422
> 
> 赞同：4
> 
> 时间：2008-09-30T22:41:04.027
> 
> 标签：.net, design-by-contract

我最近一直在考虑按合同设计，我想知道人们认为在 .NET 中断言值的前置条件和后置条件的最佳方式是什么？即验证方法的参数值。

有些人推荐 Debug.Assert，而其他人则谈论使用 if 语句加上抛出异常。各自的优缺点是什么？

您推荐了哪些可用的框架？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-01T05:36:37.743

另一种选择是[Spec#](http://research.microsoft.com/SpecSharp/)。

*Spec# 是面向对象语言 C# 的扩展。它扩展了类型系统以包括非空类型和检查异常。它以前置条件和后置条件以及对象不变量的形式提供方法契约。*

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-21T02:27:52.127

当 .NET 4.0 发布时，我们最终会使用代码契约。但是，现在在我们的生产代码中，我们已经通过“Guard”类以及生成异常的常用方法取得了巨大的成功。

有关更多详细信息，请参阅[我关于此的帖子](http://www.moserware.com/2008/01/borrowing-ideas-from-3-interesting.html)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-30T22:48:58.893

我更喜欢异常而不是断言，因为如果它应该是那样而不是那样，我想知道它以便我可以修复它，并且我们在调试模式下获得的覆盖范围远不及现实生活中的使用或覆盖范围，所以只是使用 Debug.Assert 还不够。

使用断言意味着您不会在发布代码中添加臃肿，但这意味着您只有在调试构建中捕获它们时才能看到这些合约何时以及为什么会被破坏。

使用异常意味着无论何时发生、调试或发布，您都可以看到合约中断，但这也意味着您的发布版本包含更多检查和代码。

您可以采用中间方法并使用 Trace 将您的前置条件和后置条件追踪到某种应用程序日志，您可以使用这些日志来调试问题。但是，您需要一种收集这些日志的方法，以了解您的用户遇到了什么问题。也有可能将此与异常结合起来，这样您就可以获得更严重问题的异常。

不过，我的看法是，如果合同值得执行，那么当它违反时抛出异常是值得的。我认为这在某种程度上取决于意见和目标应用程序。如果您确实抛出异常，您可能需要某种形式的事件报告系统，该系统在引发的异常未处理时提供崩溃报告。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-02-01T00:57:31.573

[您可以在http://conditions.codeplex.com/](http://conditions.codeplex.com/)上查看 fluent 框架， 它是开源且免费的。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-21T02:16:31.010

Spec# 是实现它的方法，它是 C# 的超集。现在你有了“[代码契约](http://research.microsoft.com/en-us/projects/contracts/)”，它是 Spec# 的与语言无关的版本，所以现在你可以在 VB.NET 中拥有代码契约。

# asp.net - 如何从客户端重新排序 NetFlix 队列等下拉列表控件（Javascript）

> ID：155424
> 
> 赞同：2
> 
> 时间：2008-09-30T22:41:55.820
> 
> 标签：asp.net, javascript, drop-down-menu

我们有一系列下拉控件来确定列的排序顺序。我们遇到的问题是，当用户选择一列作为第二列时，其他下拉列表需要更改其值，以便只有一个“第二列”。

1.  A栏[1]
2.  B栏[2]
3.  C栏[3]
4.  D栏[4]
5.  E 栏 [5]

在上面的列表中，当您将 D 列更改为 [2] 时，B 列变为 [3]，C 变为 [4] 等等。我可以在服务器端管理它，但我想知道是否有人知道如何做这在客户端使用 javascript。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-30T23:29:34.113

查看[Scriptaculous 之](http://script.aculo.us/)类的 Javascript 工具包，用于客户端重新排序。

您将元素添加为“ [Sortables](http://github.com/madrobby/scriptaculous/wikis/sortable) ”，并编写自己的回调代码，以便在项目被拖放时执行——例如向服务器发送异步请求以保持新订单。

这是使用 Scriptaculous 和 PHP 创建可排序列表的[完整教程](http://zenofshen.com/posts/ajax-sortable-lists-tutorial)。对于 ASP，客户端代码会略有不同，但过程会相似。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-01T18:26:17.300

关于 JavaScript 框架的注释；我强烈推荐[jQuery](http://www.jquery.com)。

# javascript - 为什么IE在设置innerHTML时会出现意外错误

> ID：155426
> 
> 赞同：6
> 
> 时间：2008-09-30T22:42:10.373
> 
> 标签：javascript, internet-explorer, innerhtml

我尝试在 Firefox 中的一个元素上设置 innerHTML，它运行良好，在 IE 中尝试过，但没有明显原因出现意外错误。

例如，如果您尝试将表格的 innerHTML 设置为“hi from stu”，它将失败，因为表格后面必须有一个序列。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-10-31T22:45:49.983

您会看到这种行为，因为 innerHTML 对于 IE 中的表格元素是只读的。来自 MSDN 的[innerHTML 属性](http://msdn.microsoft.com/en-us/library/ms533897(VS.85).aspx)文档：

> 该属性对所有对象都是读/写的，除了以下对象，它是只读的：COL、COLGROUP、FRAMESET、HEAD、HTML、STYLE、TABLE、TBODY、TFOOT、THEAD、TITLE、TR。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-02T09:24:28.590

不知道为什么你会因为 Stu 的问题而被降级，因为这是我最近解决的问题。*诀窍是将 HTML “喷射”到当前未附加到文档树*的 DOM 元素中。这是执行此操作的代码片段：

```
// removing the scripts to avoid any 'Permission Denied' errors in IE
var cleaned = html.replace(/<script(.|\s)*?\/script>/g, "");

// IE is stricter on malformed HTML injecting direct into DOM. By injecting into 
// an element that's not yet part of DOM it's more lenient and will clean it up.
if (jQuery.browser.msie)
{
    var tempElement = document.createElement("DIV");
    tempElement.innerHTML = cleaned;
    cleaned = tempElement.innerHTML;
    tempElement = null;
}
// now 'cleaned' is ready to use... 
```

请注意，我们在此代码段中仅使用 jQuery 来测试浏览器是否为 IE，对 jQuery 没有硬依赖。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-31T22:33:52.270

检查您尝试设置 innerHTML 的元素的范围。因为 FF 和 IE 以不同的方式处理这个问题

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-03T15:27:59.000

[http://www.ericvasilik.com/2006/07/code-karma.html](http://www.ericvasilik.com/2006/07/code-karma.html)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-09-22T08:10:56.157

我一直在与用不同的链接列表替换表中的链接列表的问题作斗争。如上所述，问题来自 IE 及其表元素的只读属性。

Append 对我来说不是一个选项，所以我（最终）解决了这个问题（适用于 Ch、FF 和 IE 8.0（尚未尝试其他 - 但我很有希望））。

```
replaceInReadOnly(document.getElementById("links"), "<a href>........etc</a>");

function replaceInReadOnly(element, content){
    var newNode = document.createElement();
    newNode.innerHTML = content;
    var oldNode = element.firstChild;
    var output = element.replaceChild(newNode, oldNode);
} 
```

对我有用 - 我希望它对你有用

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-01T03:53:51.687

“显然 firefox 不是那么挑剔” ==> 显然 FireFox 是如此的错误，以至于它没有注册这种明显违反基本 html 嵌套规则的行为......

正如有人在另一个论坛中指出的那样，FireFox 将接受，您将整个 html 文档附加为表单域甚至图像的子项，-(

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-01T16:11:52.147

您是否尝试过设置 innerText 和/或 textContent？当您尝试在 IE 中更改它们的 innerHTML 时，某些节点（如 SCRIPT 标记）的行为将不会像预期的那样。更多关于 innerText 与 textContent 的信息：

[http://blog.coderlab.us/2006/04/18/the-textcontent-and-innertext-properties/](http://blog.coderlab.us/2006/04/18/the-textcontent-and-innertext-properties/)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-31T22:30:11.153

您是在设置完全不同的 innerHTML 还是替换了 innerHTML 中的模式？我问是因为如果您尝试通过 innerHTML 的“功能”进行简单的搜索/替换，您会发现某些类型的元素不在 IE 中播放。

这可以通过在 try/catch 中包围您的尝试并通过 parentNode 冒泡 DOM 直到您成功地做到这一点来谨慎地解决。

但是，如果您要插入全新的内容，这将不合适。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2014-01-21T07:21:52.710

您可以修改行为。下面是一些代码，可以防止在 IE 中对其他引用的元素进行垃圾收集：

```
if (/(msie|trident)/i.test(navigator.userAgent)) {
 var innerhtml_get = Object.getOwnPropertyDescriptor(HTMLElement.prototype, "innerHTML").get
 var innerhtml_set = Object.getOwnPropertyDescriptor(HTMLElement.prototype, "innerHTML").set
 Object.defineProperty(HTMLElement.prototype, "innerHTML", {
  get: function () {return innerhtml_get.call (this)},
  set: function(new_html) {
   var childNodes = this.childNodes
   for (var curlen = childNodes.length, i = curlen; i > 0; i--) {
    this.removeChild (childNodes[0])
   }
   innerhtml_set.call (this, new_html)
  }
 })
}

var mydiv = document.createElement ('div')
mydiv.innerHTML = "test"
document.body.appendChild (mydiv)

document.body.innerHTML = ""
console.log (mydiv.innerHTML) 
```

[http://jsfiddle.net/DLLbc/9/](http://jsfiddle.net/DLLbc/9/)

* * *

## 回答 #10

> 赞同：-2
> 
> 时间：2008-09-30T22:43:26.720

我刚刚发现，如果您尝试在 IE 中不正确的元素上设置 innerHTML，则会引发此错误。例如，如果您尝试将表格的 innerHTML 设置为“ **hi from stu** ”，它将失败，因为表格后面必须有一个序列。显然firefox不是那么挑剔。希望能帮助到你。

# javascript - 如何在 javascript 中转义 DOM 名称？

> ID：155427
> 
> 赞同：1
> 
> 时间：2008-09-30T22:42:13.323
> 
> 标签：javascript

我有一个我想通过 javascript 处理的表单元素，但它不喜欢它的语法。

```
<form name="mycache">
  <input type="hidden" name="cache[m][2]">
  <!-- ... -->
</form> 
```

我想能够说：

```
document.mycache.cache[m][2] 
```

但显然我需要指出这`cache[m][2]`是整个名称，而不是对`cache`. 可以做到吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-30T22:44:42.663

更新：实际上，我错了，您可以使用 [ 或 ] 字符作为表单元素 id 和/或 name 属性的一部分。

这是一些证明它的代码：

```
<html>
<body>

<form id="form1">

<input type='test' id='field[m][2]' name='field[m][2]' value='Chris'/>

<input type='button' value='Test' onclick='showtest();'/>

<script type="text/javascript">
function showtest() {
    var value = document.getElementById("field[m][2]").value;
    alert(value);
}
</script>

</form>

</body>
</html> 
```

更新：您还可以使用以下内容从表单元素中获取值：

```
var value = document.forms.form1["field[m][2]"].value; 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-30T22:47:04.560

改为使用`document.getElementsByName("input_name")`。也可以跨平台。赢。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-30T22:44:51.117

是否可以向表单元素添加 id 引用并使用 document.getElementById？

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-01T03:35:56.177

-- 在过去（在 HTML3.2/4.01 过渡/XHTML1.0 过渡 DOM 绑定中），您可以使用：

```
form.elements["cache[m][2]"] 
```

——但正如 Chris Pietschmann 所展示的，这些元素不是必需的，因为这些绑定方案也允许直接访问（尽管我个人更喜欢额外的可读性！-）

# coldfusion - ColdFusion：从列表中选择第一个非空值

> ID：155435
> 
> 赞同：3
> 
> 时间：2008-09-30T22:43:57.873
> 
> 标签：coldfusion, idioms

在 JavaScript 中，您可以这样做：

```
var a = null;
var b = "I'm a value";
var c = null;
var result = a || b || c; 
```

并且 'result' 将获得 'b' 的值，因为 JavaScript 短路了 'or' 运算符。

我想要一个单行习语在 ColdFusion 中做到这一点，我能想到的最好的方法是：

```
<cfif LEN(c) GT 0><cfset result=c></cfif>
<cfif LEN(b) GT 0><cfset result=b></cfif>
<cfif LEN(a) GT 0><cfset result=a></cfif> 
```

谁能做得比这更好？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-30T23:10:05.923

ColdFusion 没有空值。

您的示例基于哪个项目是空字符串的选择。

如果这就是您所追求的，并且所有其他值都是简单值，您可以这样做：

```
<cfset result = ListFirst( "#a#,#b#,#c#" )/> 
```

（这是因为标准列表函数忽略了空元素。）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-30T23:19:13.343

注意：其他 CFML 引擎确实支持空值。

如果我们真的在处理空值（而不是空字符串），这里有一个适用于 Railo 和 OpenBlueDragon 的函数：

```
<cffunction name="FirstNotNull" returntype="any" output="false">
    <cfset var i = 0/>
    <cfloop index="i" from="1" to="#ArrayLen(Arguments)#">
        <cfif NOT isNull(Arguments[i]) >
            <cfreturn Arguments[i] />
        </cfif>
    </cfloop>
</cffunction> 
```

那么函数的使用就这么简单：

```
<cfset result = FirstNotNull( a , b , c ) /> 
```

# unit-testing - 单元测试命名最佳实践

> ID：155436
> 
> 赞同：647
> 
> 时间：2008-09-30T22:44:28.527
> 
> 标签：unit-testing, naming-conventions

**命名单元测试类和测试方法的最佳实践是什么？**

之前在 SO 上对此进行了讨论，在[单元测试的一些流行的命名约定是什么？](https://stackoverflow.com/questions/96297/naming-conventions-for-unit-tests)

我不知道这是否是一个很好的方法，但目前在我的测试项目中，我在每个生产类和测试类之间都有一对一的映射，例如`Product`和`ProductTest`.

然后，在我的测试类中，我的方法的名称是我正在测试的方法的名称、下划线，然后是情况和我期望发生的情况，例如`Save_ShouldThrowExceptionWithNullName()`.

* * *

## 回答 #1

> 赞同：607
> 
> 时间：2009-10-20T11:47:58.217

**更新（2021 年 7 月）**

自从我最初的答案（将近 12 年）和最佳实践在此期间发生了很大变化以来，已经有一段时间了。所以我倾向于更新我自己的答案，并为读者提供不同的命名策略。

许多评论和答案指出，我在原始答案中提出的命名策略并不抗拒重构，最终导致难以理解的名称，我完全同意。

在过去的几年里，我最终使用了一种更易于阅读的命名模式，其中测试名称描述了我们想要测试的内容，正如[Vladimir Khorikov](https://enterprisecraftsmanship.com/posts/you-naming-tests-wrong/)所描述的那样。

一些例子是：

*   `Add_credit_updates_customer_balance`
*   `Purchase_without_funds_is_not_possible`
*   `Add_affiliate_discount`

但正如您所看到的，它是一个非常灵活的模式，但最重要的是，阅读名称您就知道测试是关于什么的，而不包括可能随时间变化的技术细节。

为了命名项目和测试类，我仍然坚持原来的答案模式。

**原始答案（2009 年 10 月）**

我喜欢[Roy Osherove 的命名策略](https://osherove.com/blog/2005/4/3/naming-standards-for-unit-tests.html)。如下：

`[UnitOfWork_StateUnderTest_ExpectedBehavior]`

它具有方法名称和结构化方式所需的所有信息。

工作单元可以小到单个方法、一个类，也可以大到多个类。它应该代表所有要在这个测试用例中测试并在控制之下的东西。

对于程序集，我使用典型的`.Tests`结尾，我认为这种结尾非常普遍，并且对于类也是如此（以 结尾`Tests`）：

`[NameOfTheClassUnderTestTests]`

之前我是用Fixture作为后缀而不是Tests，但我觉得后者更常见，于是我改变了命名策略。

* * *

## 回答 #2

> 赞同：151
> 
> 时间：2011-09-13T08:01:13.003

我喜欢遵循*测试的***“应该”**命名标准，同时在被测单元（即类）之后命名*测试夹具。*

 **为了说明（使用 C# 和 NUnit）：

```
[TestFixture]
public class BankAccountTests
{
  [Test]
  public void Should_Increase_Balance_When_Deposit_Is_Made()
  {
     var bankAccount = new BankAccount();
     bankAccount.Deposit(100);
     Assert.That(bankAccount.Balance, Is.EqualTo(100));
  }
} 
```

为什么**是“应该”**？

我发现它迫使测试编写者用类似于“应该[处于某种状态] [之后/之前/何时] [动作发生]”的句子来命名测试

是的，到处写“应该”确实有点重复，但正如我所说，它迫使作家以正确的方式思考（这对新手有好处）。另外，它通常会产生一个可读的英文测试名称。

*更新*：

我注意到 Jimmy Bogard 也是“应该”的粉丝，甚至还有一个名为“应该”的单元测试[**库**](http://lostechies.com/erichexter/2013/01/13/shouldlibrary/)。

*更新（4年后...）*

对于那些感兴趣的人，我命名测试的方法多年来一直在发展。*我在上面描述的应该*模式的一个问题是它不容易一眼就知道正在测试哪种方法。对于 OOP，我认为使用被测方法开始测试名称更有意义。对于一个设计良好的类，这应该导致可读的测试方法名称。我现在使用类似于`<method>_Should<expected>_When<condition>`. 显然，根据上下文，您可能希望将“应该/何时”动词替换为更合适的动词。例子： `Deposit_ShouldIncreaseBalance_WhenGivenPositiveValue()`

* * *

## 回答 #3

> 赞同：89
> 
> 时间：2008-09-30T22:56:33.367

我喜欢这种命名风格：

```
OrdersShouldBeCreated();
OrdersWithNoProductsShouldFail(); 
```

等等。它让非测试人员非常清楚问题是什么。

* * *

## 回答 #4

> 赞同：56
> 
> 时间：2008-09-30T22:54:31.250

[肯特贝克](https://rads.stackoverflow.com/amzn/click/com/0321146530)建议：

*   每个“单元”（程序的类）一个测试夹具。测试装置本身就是类。测试夹具名称应为：

    ```
    [name of your 'unit']Tests 
    ```

*   测试用例（测试夹具方法）的名称如下：

    ```
    test[feature being tested] 
    ```

例如，具有以下类：

```
class Person {
    int calculateAge() { ... }

    // other methods and properties
} 
```

测试夹具将是：

```
class PersonTests {

    testAgeCalculationWithNoBirthDate() { ... }

    // or

    testCalculateAge() { ... }
} 
```

* * *

## 回答 #5

> 赞同：19
> 
> 时间：2009-10-10T23:09:39.107

**类名**。对于测试夹具名称，我发现“测试”在许多领域的通用语言中很常见。例如，在工程领域：`StressTest`，在化妆品领域：`SkinTest`。很抱歉不同意 Kent，但在我的测试装置（`StressTestTest`？）中使用“测试”会令人困惑。

“单位”在域中也被大量使用。例如`MeasurementUnit`。一个类是称为`MeasurementUnitTest`“Measurement”还是“MeasurementUnit”的测试？

因此，我喜欢对所有测试类使用“Qa”前缀。例如`QaSkinTest`和`QaMeasurementUnit`。它永远不会与域对象混淆，并且使用前缀而不是后缀意味着所有测试装置在视觉上都在一起（如果您的测试项目中有假货或其他支持类，则很有用）

**命名空间**。我在 C# 中工作，并将我的测试类保存在与他们正在测试的类相同的命名空间中。它比拥有单独的测试命名空间更方便。当然，测试类在不同的项目中。

**测试方法名称**。我喜欢将我的方法命名为WhenXXX_ExpectYYY。它使前提条件清晰，并有助于自动化文档（a la TestDox）。这与 Google 测试博客上的建议类似，但前提条件和期望更加分离。例如：

```
WhenDivisorIsNonZero_ExpectDivisionResult
WhenDivisorIsZero_ExpectError
WhenInventoryIsBelowOrderQty_ExpectBackOrder
WhenInventoryIsAboveOrderQty_ExpectReducedInventory 
```

* * *

## 回答 #6

> 赞同：14
> 
> 时间：2010-08-31T14:08:41.610

我使用**Given-When-Then**概念。看看这篇短文[http://cakebaker.42dh.com/2009/05/28/given-when-then/](http://cakebaker.42dh.com/2009/05/28/given-when-then/)。文章以 BDD 的形式描述了这个概念，但您也可以在 TDD 中使用它而无需任何更改。

* * *

## 回答 #7

> 赞同：10
> 
> 时间：2009-06-18T18:59:42.637

我最近提出了以下约定来命名我的测试、它们的类和包含项目，以最大化它们的描述性：

假设我正在命名空间`Settings`中的项目中测试该类`MyApp.Serialization`。

首先，我将使用`MyApp.Serialization.Tests`命名空间创建一个测试项目。

在这个项目中，当然还有命名空间中，我将创建一个名为`IfSettings`（保存为**IfSettings.cs**）的类。

可以说我正在测试该`SaveStrings()`方法。-> 我将命名测试`CanSaveStrings()`。

当我运行此测试时，它将显示以下标题：

`MyApp.Serialization.Tests.IfSettings.CanSaveStrings`

我认为这很好地告诉了我，它正在测试什么。

当然，在英语中，名词“Tests”与动词“tests”相同是很有用的。

您在命名测试方面的创造力没有限制，因此我们可以获得完整的句子标题。

通常测试名称必须以动词开头。

示例包括：

*   检测（例如`DetectsInvalidUserInput`）
*   投掷（例如`ThrowsOnNotFound`）
*   意志（例如`WillCloseTheDatabaseAfterTheTransaction`）

等等

另一种选择是使用“that”而不是“if”。

后者虽然节省了我的击键次数，并且更准确地描述了我正在做的事情，因为我不知道***测试***的行为是否存在，但我正在测试它***是否***存在。

[*编辑*]

在使用上述命名约定一段时间后，我发现在使用接口时， *If*前缀可能会令人困惑。碰巧的是，测试类*IfSerializer.cs*看起来与“打开文件选项卡”中的接口*ISerializer.cs*非常相似。当在测试、被测试的类及其接口之间来回切换时，这会变得非常烦人。因此，我现在会选择**That** over **If**作为前缀。

此外，我现在使用 - 仅用于我的测试类中的方法，因为它不被认为是其他任何地方的最佳实践 - 用于分隔我的测试方法名称中的单词的“_”，如下所示：

```
[Test] public void detects_invalid_User_Input() 
```

我发现这更容易阅读。

[*结束编辑*]

我希望这会产生更多的想法，因为我认为命名测试非常重要，因为它可以为您节省大量时间，否则这些时间会花费在试图了解测试在做什么（例如，在长时间中断后恢复项目之后） .

* * *

## 回答 #8

> 赞同：9
> 
> 时间：2008-09-30T22:53:00.740

请参阅：http: [//googletesting.blogspot.com/2007/02/tott-naming-unit-tests-responsibly.html](http://googletesting.blogspot.com/2007/02/tott-naming-unit-tests-responsibly.html)

对于测试方法名称，我个人发现使用详细和自记录的名称非常有用（以及进一步解释测试正在做什么的 Javadoc 注释）。

* * *

## 回答 #9

> 赞同：7
> 
> 时间：2013-02-27T15:31:01.690

我认为最重要的事情之一是在您的命名约定中保持一致（并与您团队的其他成员达成一致）。很多时候，我看到在同一个项目中使用了许多不同的约定。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-09-30T22:56:54.457

在 VS + NUnit 中，我通常在我的项目中创建文件夹来将功能测试组合在一起。然后我创建单元测试夹具类并以我正在测试的功能类型命名它们。[Test] 方法的命名方式如下`Can_add_user_to_domain`：

```
- MyUnitTestProject   
  + FTPServerTests <- Folder
   + UserManagerTests <- Test Fixture Class
     - Can_add_user_to_domain  <- Test methods
     - Can_delete_user_from_domain
     - Can_reset_password 
```

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2008-09-30T23:12:02.517

我应该补充一点，将您的测试保存在同一个包中，但在与正在测试的源代码并行的目录中，一旦您准备好部署它，就可以消除代码的膨胀，而无需执行一堆排除模式。

我个人喜欢[《JUnit 袖珍指南》](http://oreilly.com/catalog/9780596007430/)中描述的最佳实践……很难打败 JUnit 的合著者写的书！

# sql-server-2005 - 带有报表参数的自动图表分页

> ID：155442
> 
> 赞同：0
> 
> 时间：2008-09-30T22:46:16.713
> 
> 标签：sql-server-2005, reporting-services, charts

基于 SQL Server 2005 报告服务中的几个报告参数，我想为返回结果中的每一行自动生成一个或多个图表，并将它们分页或隔开。我该怎么做？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-08-31T08:10:10.520

如果每行的图表数量不同，但变化是已知的（例如，它要么只是图表 1，要么是图表 1 和 3，要么是图表 1、2 和 3），那么使用表格就足够简单了。

在默认详细信息行中添加您需要的任何普通字段。现在为您可能需要的每个图表插入一个新的详细信息行。最后，根据您的规则设置每个图表行的[可见性](http://msdn.microsoft.com/en-us/library/aa337155%28SQL.90%29.aspx)，注意如果您的表达式计算结果为真，该规则将**隐藏该行。**确保使用最左侧单元格左侧的区域选择**行**，如果正确，您会看到它是属性网格中的一行。

要获得您想要的布局，您可以合并图表以进入单元格，或者使用单个单元格并在其中放置一个矩形，然后在矩形中布置您的其他控件。

任何隐藏的行都将被折叠，因此如果您简单地切换图表本身的可见性，您将不会得到大的空白部分。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-28T19:30:55.137

您可以做的是在页面上放置一个[List 控件，按记录唯一键（ID 或多个字段，如果复合）设置](http://msdn.microsoft.com/en-us/library/ms159121(SQL.90).aspx)[List 分组](http://msdn.microsoft.com/en-us/library/ms159660(SQL.90).aspx)，并在 List 上放置一个图表。接下来，设置项目可见性表达式以[使用报告参数对其进行控制](http://msdn.microsoft.com/en-us/library/aa337155(SQL.90).aspx)。

# javascript - 如何在输入元素获得焦点时禁用 YAHOO.util.KeyListener？

> ID：155445
> 
> 赞同：1
> 
> 时间：2008-09-30T22:46:56.183
> 
> 标签：javascript, keyboard, yui, shortcuts, keylistener

我有一个带有[YUI 的 MenuBar](http://developer.yahoo.com/yui/menu/)小部件的 MenuBar 设置，并且我有一个`YAHOO.util.KeyListener`附加到*文档*以快速通过键盘访问菜单和子菜单项（例如，'s' 打开设置菜单）。问题是当用户在输入元素中时， *keylistener仍然会触发。*例如，用户可能在文本字段中输入*汤*，“s”字符将导致设置菜单弹出。

一种解决方案是在焦点位于输入元素上时禁用*keylistener ，并在模糊时启用它。*我该怎么做呢？有更好的解决方案吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-10-01T08:45:13.030

我赞扬您尝试提供键盘快捷键，但请注意，实现跨平台会有点痛苦。如果可行，我强烈建议在标签上使用[访问键。](http://www.w3.org/TR/html401/interact/forms.html#h-17.11.2)`<a>`

如果你还要去，我猜`accesskey`对你没用。我假设您已经阅读[了相关的 YUI 教程](http://developer.yahoo.com/yui/examples/container/keylistener.html)。

如果`blur`并且`focus`真的是正确的方法，我会使用类似的东西

```
YAHOO.util.Event.onDOMReady(init);
function init() {
    // set up the keyboard listeners

    setUpExceptionsToKeyboardShortcuts();
}

function disableShortcuts() {
    // Do what you've got to do
}

function enableShortcuts() {
    // Do what you've got to do
}

function setUpExceptionsToKeyboardShortcuts() {
    var focusable = document.getElementsByTagName('input');
    focusable = focusable.concat(document.getElementsByTagName('select'));
    focusable = focusable.concat(document.getElementsByTagName('textarea'));
    YAHOO.util.Event.addListener(focusable, 'focus', disableShortcuts);
    YAHOO.util.Event.addListener(focusable, 'blur', ensableShortcuts);
} 
```

# vim - Vim 自动生成 ctags

> ID：155449
> 
> 赞同：55
> 
> 时间：2008-09-30T22:47:30.393
> 
> 标签：vim, autocomplete, ctags

现在我有以下内容`.vimrc`：

```
au BufWritePost *.c,*.cpp,*.h !ctags -R 
```

这样做有几个问题：

1.  它很慢 - 为自上次标记生成以来未更改的文件重新生成标记。
2.  由于不可避免的“按 Enter 或键入命令继续”，我必须在写入文件后*再次按下 Enter 按钮。*

当您将这两个问题结合起来时，我最终会过早地按下额外的输入（在`ctags -R`完成之前），然后看到烦人的错误消息，并且不得不再次按下输入。

我知道这听起来没什么大不了的，但是根据我在特定日期执行的文件写入量，它往往会变得非常烦人。必须有更好的方法来做到这一点！

* * *

## 回答 #1

> 赞同：45
> 
> 时间：2008-09-30T23:05:04.220

`au BufWritePost *.c,*.cpp,*.h silent! !ctags -R &`

缺点是在完成之前您不会拥有有用的标签文件。只要您在 *nix 系统上，在之前的 ctags 完成之前进行多次写入应该是可以的，但您应该测试它。在 Windows 系统上，它不会把它放在后台，它会抱怨文件被锁定直到第一个 ctags 完成（这不应该在 vim 中引起问题，但你最终会得到一个稍微过时的标签文件）。

请注意，您可以`--append`按照 tonylo 的建议使用该选项，但是您必须禁用`tagbsearch`这可能意味着标签搜索需要更长的时间，具体取决于标签文件的大小。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2008-10-02T20:25:33.213

**编辑**： 一个非常类似于以下行的解决方案已发布为**AutoTag [vim](http://www.vim.org/scripts/script.php?script_id=1343)脚本**。但是请注意，该脚本**需要一个支持 Python 的 vim**。

我的解决方案改为使用 awk，因此它应该适用于更多系统。

* * *

```
au FileType {c,cpp} au BufWritePost <buffer> silent ! [ -e tags ] &&
    \ ( awk -F'\t' '$2\!="%:gs/'/'\''/"{print}' tags ; ctags -f- '%:gs/'/'\''/' )
    \ | sort -t$'\t' -k1,1 -o tags.new && mv tags.new tags 
```

请注意，您只能在脚本中以这种方式编写它，否则它必须单独一行。

里面发生了很多事情：

1.  此自动命令在检测到文件为 C 或 C++ 时触发，并依次添加由`BufWritePost`事件触发的缓冲区本地自动命令。

2.  它使用`%`在执行时被缓冲区的文件名替换的占位符，以及`:gs`用于对文件名进行外壳引用的修饰符（通过将任何嵌入的单引号转换为quote-escape-quote-quote）。

3.  这样，它会运行一个 shell 命令来检查`tags`文件是否存在，在这种情况下，它的内容会被打印，除了引用刚刚保存的文件的行，同时`ctags`仅在刚刚保存的文件上调用，结果是`sort`ed 并放回原位。

警告实现者：这假设所有内容都在同一个目录中，并且这也是缓冲区本地当前目录。我没有考虑过路径修改。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2012-01-14T23:14:58.677

我写了[easytags.vim 就是](http://www.vim.org/scripts/script.php?script_id=3114)为了做到这一点：自动更新和高亮标签。该插件可以配置为仅更新正在编辑的文件或正在编辑的文件目录中的所有文件（递归）。它可以使用全局标签文件、文件类型特定标签文件和项目特定标签文件。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2010-11-30T05:46:46.453

我注意到这是一个旧线程，但是......在 *nix 中使用**incron**，例如支持 inotify 的环境。每当目录中的文件更改时，它总是会启动命令。IE，

```
/home/me/Code/c/that_program IN_DELETE,IN_CLOSE_WRITE ctags --sort=yes *.c 
```

就是这样。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-30T23:01:38.957

也许使用 ctags 的 append 参数，如下所示：

[http://vim.wikia.com/wiki/Autocmd_to_update_ctags_file](http://vim.wikia.com/wiki/Autocmd_to_update_ctags_file)

我不能真正保证这一点，因为我通常使用源代码浏览来进行代码浏览，但使用 vim 作为编辑器......看图。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-30T22:55:34.057

让 ctags 计划通过 crontab 运行怎么样？如果您的项目树的结构相当稳定，那应该可行吗？

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-09-30T23:03:15.847

要禁止“按 Enter”提示，请使用[:silent](http://vim.wikia.com/wiki/Avoiding_the_%22Hit_ENTER_to_continue%22_prompts)。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2011-09-01T10:45:09.150

在 OSX 上，这个命令不能开箱即用，至少对我来说不是。

```
au BufWritePost *.c,*.cpp,*.h silent! !ctags -R & 
```

我找到了一篇[文章](http://gmarik.info/blog/2010/10/08/ctags-on-OSX)，它解释了如何获取包含 -R 选项的标准 ctags 版本。仅此一项对我不起作用。我必须将 /usr/local/bin 添加到 .bash_profile 中的 PATH 变量中，以便获取 Homebrew 安装程序的 bin。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-10-01T09:01:28.357

该`--append`选项确实是要走的路。与 a 一起使用`grep -v`，我们只能更新一个*标记*文件。例如，这里是一个解决这个问题的[未完善插件的摘录。](https://github.com/LucHermitte/lh-tags)（注意：它需要一个“外部”[库插件](https://github.com/LucHermitte/lh-vim-lib)）

```
" Options {{{1
let g:tags_options_cpp = '--c++-kinds=+p --fields=+imaS --extra=+q'

function! s:CtagsExecutable()
  let tags_executable = lh#option#Get('tags_executable', s:tags_executable, 'bg')
  return tags_executable
endfunction

function! s:CtagsOptions()
  let ctags_options = lh#option#Get('tags_options_'.&ft, '')
  let ctags_options .= ' '.lh#option#Get('tags_options', '', 'wbg')
  return ctags_options
endfunction

function! s:CtagsDirname()
  let ctags_dirname = lh#option#Get('tags_dirname', '', 'b').'/'
  return ctags_dirname
endfunction

function! s:CtagsFilename()
  let ctags_filename = lh#option#Get('tags_filename', 'tags', 'bg')
  return ctags_filename
endfunction

function! s:CtagsCmdLine(ctags_pathname)
  let cmd_line = s:CtagsExecutable().' '.s:CtagsOptions().' -f '.a:ctags_pathname
  return cmd_line
endfunction

" ######################################################################
" Tag generating functions {{{1
" ======================================================================
" Interface {{{2
" ======================================================================
" Mappings {{{3
" inoremap <expr> ; <sid>Run('UpdateTags_for_ModifiedFile',';')

nnoremap <silent> <Plug>CTagsUpdateCurrent :call <sid>UpdateCurrent()<cr>
if !hasmapto('<Plug>CTagsUpdateCurrent', 'n')
  nmap <silent> <c-x>tc  <Plug>CTagsUpdateCurrent
endif

nnoremap <silent> <Plug>CTagsUpdateAll     :call <sid>UpdateAll()<cr>
if !hasmapto('<Plug>CTagsUpdateAll', 'n')
  nmap <silent> <c-x>ta  <Plug>CTagsUpdateAll
endif

" ======================================================================
" Auto command for automatically tagging a file when saved {{{3
augroup LH_TAGS
  au!
  autocmd BufWritePost,FileWritePost * if ! lh#option#Get('LHT_no_auto', 0) | call s:Run('UpdateTags_for_SavedFile') | endif
aug END

" ======================================================================
" Internal functions {{{2
" ======================================================================
" generate tags on-the-fly {{{3
function! UpdateTags_for_ModifiedFile(ctags_pathname)
  let source_name    = expand('%')
  let temp_name      = tempname()
  let temp_tags      = tempname()

  " 1- purge old references to the source name
  if filereadable(a:ctags_pathname)
    " it exists => must be changed
    call system('grep -v "  '.source_name.' " '.a:ctags_pathname.' > '.temp_tags.
      \ ' && mv -f '.temp_tags.' '.a:ctags_pathname)
  endif

  " 2- save the unsaved contents of the current file
  call writefile(getline(1, '$'), temp_name, 'b')

  " 3- call ctags, and replace references to the temporary source file to the
  " real source file
  let cmd_line = s:CtagsCmdLine(a:ctags_pathname).' '.source_name.' --append'
  let cmd_line .= ' && sed "s#\t'.temp_name.'\t#\t'.source_name.'\t#" > '.temp_tags
  let cmd_line .= ' && mv -f '.temp_tags.' '.a:ctags_pathname
  call system(cmd_line)
  call delete(temp_name)

  return ';'
endfunction

" ======================================================================
" generate tags for all files {{{3
function! s:UpdateTags_for_All(ctags_pathname)
  call delete(a:ctags_pathname)
  let cmd_line  = 'cd '.s:CtagsDirname()
  " todo => use project directory
  "
  let cmd_line .= ' && '.s:CtagsCmdLine(a:ctags_pathname).' -R'
  echo cmd_line
  call system(cmd_line)
endfunction

" ======================================================================
" generate tags for the current saved file {{{3
function! s:UpdateTags_for_SavedFile(ctags_pathname)
  let source_name    = expand('%')
  let temp_tags      = tempname()

  if filereadable(a:ctags_pathname)
    " it exists => must be changed
    call system('grep -v "  '.source_name.' " '.a:ctags_pathname.' > '.temp_tags.' && mv -f '.temp_tags.' '.a:ctags_pathname)
  endif
  let cmd_line = 'cd '.s:CtagsDirname()
  let cmd_line .= ' && ' . s:CtagsCmdLine(a:ctags_pathname).' --append '.source_name
  " echo cmd_line
  call system(cmd_line)
endfunction

" ======================================================================
" (public) Run a tag generating function {{{3
function! LHTagsRun(tag_function)
  call s:Run(a:tag_function)
endfunction

" ======================================================================
" (private) Run a tag generating function {{{3
" See this function as a /template method/.
function! s:Run(tag_function)
  try
    let ctags_dirname  = s:CtagsDirname()
    if strlen(ctags_dirname)==1
      throw "tags-error: empty dirname"
    endif
    let ctags_filename = s:CtagsFilename()
    let ctags_pathname = ctags_dirname.ctags_filename
    if !filewritable(ctags_dirname) && !filewritable(ctags_pathname)
      throw "tags-error: ".ctags_pathname." cannot be modified"
    endif

    let Fn = function("s:".a:tag_function)
    call Fn(ctags_pathname)
  catch /tags-error:/
    " call lh#common#ErrorMsg(v:exception)
    return 0
  finally
  endtry

  echo ctags_pathname . ' updated.'
  return 1
endfunction

function! s:Irun(tag_function, res)
  call s:Run(a:tag_function)
  return a:res
endfunction

" ======================================================================
" Main function for updating all tags {{{3
function! s:UpdateAll()
  let done = s:Run('UpdateTags_for_All')
endfunction

" Main function for updating the tags from one file {{{3
" @note the file may be saved or "modified".
function! s:UpdateCurrent()
  if &modified
    let done = s:Run('UpdateTags_for_ModifiedFile')
  else
    let done = s:Run('UpdateTags_for_SavedFile')
  endif
endfunction 
```

此代码定义：

*   `^Xta`强制更新当前项目中所有文件的标签库；
*   `^Xtc`强制更新当前（未保存）文件的标签库；
*   每次保存文件时更新标签库的自动命令；它支持和许多选项来禁用我们不想要的自动更新，根据文件类型调整 ctags 调用，......这不仅仅是一个提示，而是一个插件的一小部分摘录。

高温下，

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2011-02-10T20:22:22.623

有一个名为[AutoTag](http://www.vim.org/scripts/script.php?script_id=1343)的 vim 插件非常有效。

如果您安装了 taglist，它也会为您更新。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2011-03-26T09:45:47.123

在我看来，插件索引器更好。

[http://www.vim.org/scripts/script.php?script_id=3221](http://www.vim.org/scripts/script.php?script_id=3221)

有可能：

1) project.tar.gz 的附加组件

2）独立插件

*   背景标签生成（您无需等待 ctags 工作）
*   支持多个项目

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2011-10-26T22:15:27.570

Auto Tag 是一个 vim 插件，可以在保存时更新现有的标签文件。

我多年来一直在使用它，没有任何问题，除了它对标签文件强制执行最大大小。除非你有一大组代码都在同一个标​​签文件中被索引，否则你不应该达到这个限制。

请注意，自动标记需要 vim 中的 Python 支持。

# c# - C# 对象不为空，但 (myObject != null) 仍然返回 false

> ID：155458
> 
> 赞同：18
> 
> 时间：2008-09-30T22:49:02.900
> 
> 标签：c#, null, compare

我需要在对象和 NULL 之间进行比较。当对象不为 NULL 时，我用一些数据填充它。

这是代码：

```
 if (region != null)
 {
  ....
 } 
```

这是可行的，但是当循环和循环时，区域对象不为空（我可以在调试模式下看到其中的数据）。在逐步调试时，它不会进入 IF 语句...当我使用以下表达式进行快速观察时：我看到 (region == null) 返回 false，AND (region != null ) 也返回 false ......**为什么以及如何？**

**更新**

有人指出该对象是 == 和 != 重载：

```
 public static bool operator ==(Region r1, Region r2)
    {
        if (object.ReferenceEquals(r1, null))
        {
            return false;
        }
        if (object.ReferenceEquals(r2, null))
        {
            return false;
        }

        return (r1.Cmr.CompareTo(r2.Cmr) == 0 && r1.Id == r2.Id);
    }

    public static bool operator !=(Region r1, Region r2)
    {
        if (object.ReferenceEquals(r1, null))
        {
            return false;
        }
        if (object.ReferenceEquals(r2, null))
        {
            return false;
        }
        return (r1.Cmr.CompareTo(r2.Cmr) != 0 || r1.Id != r2.Id);
    } 
```

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2008-09-30T22:51:49.570

== 和/或 != 运算符是否为区域对象的类重载？

现在您已经发布了重载的代码：

重载应该如下所示（代码取自[Jon Skeet](https://stackoverflow.com/questions/155458/c-object-is-not-null-but-myobject-null-still-return-false#155488)和[Philip Rieck](https://stackoverflow.com/questions/155458/c-object-is-not-null-but-myobject-null-still-return-false#155508)的帖子）：

```
public static bool operator ==(Region r1, Region r2)
{
    if (object.ReferenceEquals( r1, r2)) {
        // handles if both are null as well as object identity
        return true;
    }

    if ((object)r1 == null || (object)r2 == null)
    {
       return false;
    }        

    return (r1.Cmr.CompareTo(r2.Cmr) == 0 && r1.Id == r2.Id);
}

public static bool operator !=(Region r1, Region r2)
{
    return !(r1 == r2);
} 
```

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2008-09-30T22:59:25.450

那些运算符重载被破坏了。

首先，如果 != 仅通过调用 == 并反转结果来实现，它会使生活变得更轻松。

其次，在 == 进行无效检查之前，应该有：

```
if (object.ReferenceEquals(r1, r2))
{
    return true;
} 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-09-30T23:03:56.827

两个重载都不正确

```
 public static bool operator ==(Region r1, Region r2)
    {
        if (object.ReferenceEquals(r1, null))
        {
            return false;
        }
        if (object.ReferenceEquals(r2, null))
        {
            return false;
        }

        return (r1.Cmr.CompareTo(r2.Cmr) == 0 && r1.Id == r2.Id);
    } 
```

如果 r1 和 r2 为 null，则第一个测试 ( *object.ReferenceEquals(r1, null)* ) 将返回 false，即使 r2 也为 null。

尝试

```
//ifs expanded a bit for readability
 public static bool operator ==(Region r1, Region r2)
    {
        if( (object)r1 == null && (object)r2 == null)
        {
           return true;
        }
        if( (object)r1 == null || (object)r2 == null)
        {
           return false;
        }        
        //btw - a quick shortcut here is also object.ReferenceEquals(r1, r2)

        return (r1.Cmr.CompareTo(r2.Cmr) == 0 && r1.Id == r2.Id);
    } 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-30T22:50:52.180

当您有多个线程处理相同的数据时，有时会发生这种情况。如果是这种情况，您可以使用锁来防止它们相互干扰。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-09T19:55:26.273

对于类型“T”的相等比较，重载这些方法：

```
int GetHashCode() //Overrides Object.GetHashCode
bool Equals(object other) //Overrides Object.Equals; would correspond to IEquatable, if such an interface existed
bool Equals(T other) //Implements IEquatable<T>; do this for each T you want to compare to
static bool operator ==(T x, T y)
static bool operator !=(T x, T y) 
```

**您的特定类型比较代码应该在一个地方完成**：类型安全的`IEquatable<T>`接口方法`Equals(T other)`。如果您要与另一种类型 (T2) 进行比较，请同时实现`IEquatable<T2>`，并将该类型的字段比较代码放入 Equals(T2 other) 中。

所有重载的方法和运算符都应将相等比较任务转发给主要类型安全的 Equals(T other) 实例方法，以便维护干净的依赖层次结构，并在每个级别引入更严格的保证，以消除冗余和不必要的复杂性。

```
bool Equals(object other)
{
    if (other is T) //replicate this for each IEquatable<T2>, IEquatable<T3>, etc. you may implement
        return Equals( (T)other) ); //forward to IEquatable<T> implementation
    return false; //other is null or cannot be compared to this instance; therefore it is not equal
}

bool Equals(T other)
{
    if ((object)other == null) //cast to object for reference equality comparison, or use object.ReferenceEquals
        return false;
    //if ((object)other == this) //possible performance boost, ONLY if object instance is frequently compared to itself! otherwise it's just an extra useless check
        //return true;
    return field1.Equals( other.field1 ) &&
           field2.Equals( other.field2 ); //compare type fields to determine equality
}

public static bool operator ==( T x, T y )
{
    if ((object)x != null) //cast to object for reference equality comparison, or use object.ReferenceEquals
        return x.Equals( y ); //forward to type-safe Equals on non-null instance x
    if ((object)y != null)
        return false; //x was null, y is not null
    return true; //both null
}

public static bool operator !=( T x, T y )
{
    if ((object)x != null)
        return !x.Equals( y ); //forward to type-safe Equals on non-null instance x
    if ((object)y != null)
        return true; //x was null, y is not null
    return false; //both null
} 
```

**讨论：**

前面的实现将类型特定（即字段相等）的比较集中到该类型的`IEquatable<T>`实现的末尾。和运算`==`符`!=`具有并行但相反的实现。我更喜欢这个而不是一个引用另一个，这样就有一个额外的方法调用依赖的一个。如果`!=`操作员只是要调用`==`操作员，而不是提供同等性能的操作员，那么您最好只使用`!(obj1 == obj2)`并避免额外的方法调用。自我比较从等于运算符和`IEquatable<T>`实现中省略，因为它可能会引入 1\. 在某些情况下不必要的开销，和/或 2\. 不一致的性能取决于实例与自身与其他实例的比较频率。

我不喜欢但应该提到的另一种方法是反转此设置，将特定于类型的相等代码集中在相等运算符中，并让 Equals 方法依赖于此。然后可以使用快捷方式`ReferenceEquals(obj1,obj2)`正如 Philip 在之前的一篇文章中提到的那样，同时检查引用相等和空相等，但这种想法具有误导性。似乎你用一块石头杀死了两只鸟，但实际上你创造了更多的工作——在确定对象既不是空的也不是同一个实例之后，你还必须继续检查每个实例是否一片空白。在我的实现中，您检查任何单个实例是否为 null 一次。在调用 Equals 实例方法时，已经排除了第一个被比较的对象为空，所以剩下要做的就是检查另一个是否为空。所以最多两次比较后，我们直接跳到字段检查中，无论我们使用哪种方法（`Equals(object),Equals(T),==,!=`）。另外，正如我所提到的，如果您确实在大多数时间都在比较并反对自己，那么您可以在深入进行现场比较之前在 Equals 方法中添加该检查。最后添加它的要点是，您仍然可以维护流/依赖关系层次结构，而无需在每个级别引入冗余/无用检查。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-30T22:59:27.213

那么这里的这些检查是不是不对：

```
public static bool operator !=(Region r1, Region r2)
{
    if (object.ReferenceEquals(r1, null))
    {
        return false;
    }
    if (object.ReferenceEquals(r2, null))
    {
        return false;
    }
... 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-01T18:50:32.357

还有一种可能是您需要单击正在查看的参数旁边的刷新图标。VS 在不评估每个语句/参数的同时尝试跟上性能。在开始对不相关的地方进行更改之前，请先确认一下。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2012-11-22T20:04:55.183

```
bool comp;
if (object.IsNullOrEmpty(r1))
{
    comp = false;
}

if (object.IsNullOrEmpty(r2))
{
    comp = false;
}
return comp; 
```

# linq - LINQ 提交更改未提交更改

> ID：155460
> 
> 赞同：0
> 
> 时间：2008-09-30T22:50:26.923
> 
> 标签：linq, linq-to-sql

我正在使用 LINQ to SQL 和 C#。我有两个 LINQ 类：用户和网络。

用户拥有 UserID（主键）和 NetworkID

网络具有 NetworkID（主键）和 AdminID（用户 ID）

以下代码工作正常：

```
user.Network.AdminID = 0;
db.SubmitChanges(); 
```

但是，如果我在进行更改之前访问 AdminID，则数据库永远不会发生更改。所以以下不起作用：

```
if(user.Network.AdminID == user.UserID)
{
     user.Network.AdminID = 0;
     db.SubmitChanges();
} 
```

它正在进入 if 语句并调用提交更改。出于某种原因，对 AdminID 的更改永远不会进入数据库。没有抛出错误，改变永远不会“接受”。

知道是什么原因造成的吗？

谢谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-30T23:53:56.800

我刚刚进行了快速测试，它对我来说效果很好。

我不想问这个问题，但是您确定 if 语句会返回 true 吗？可能是您没有点击更改值的代码。

除此之外，我们可能需要更多信息。该成员的属性是什么？您是否跟踪到 set 语句以确保在调用 SubmitChanges 之前设置了值？在 SubmitChanges 之后，Linq 实体是否具有新值？还是数据库和 Linq 实体都无法获取新值？

简而言之，该代码应该可以工作......所以其他地方可能是错误的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-01T00:01:25.193

这是原始[帖子](http://forums.microsoft.com/MSDN/ShowPost.aspx?PostID=3086400&SiteID=1)。

* * *

这是由 LinqToSql 设计器生成的设置器。

代码片段

```
{
  Contact previousValue = this._Contact.Entity;
  if (((previousValue != value)
    || (this._Contact.HasLoadedOrAssignedValue == false)))
  {
    this.SendPropertyChanging();
    if ((previousValue != null))
    {
      this._Contact.Entity = null;
      previousValue.ContactEvents.Remove(this);
    }
    this._Contact.Entity = value;
    if ((value != null))
    {
      value.ContactEvents.Add(this);
      this._ContactID = value.ID;
    }
    else
    {
      this._ContactID = default(int);
    }
    this.SendPropertyChanged("Contact");
  }
} 
```

此行将子项的属性设置为父项。

```
this._Contact.Entity = value; 
```

此行将子项添加到父项的集合中

```
value.ContactEvents.Add(this); 
```

ID的**设置器**没有第二行。

因此，使用自动生成的实体...此代码会产生意外行为：

```
myContactEvent.ContactID = myContact.ID; 
```

这段代码很好：

```
myContactEvent.Contact = myContact; 
```

这段代码也不错：

```
myContact.ContactEvents.Add(myContactEvent); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-07-26T21:40:48.023

我有这个问题。原因是一行愚蠢的代码：

```
DBDataContext db { get { return new DBDataContext(); } } 
```

显然应该是：

```
DBDataContext db = new DBDataContext(); 
```

# ruby - Ruby 中的“为”是什么

> ID：155462
> 
> 赞同：23
> 
> 时间：2008-09-30T22:50:36.377
> 
> 标签：ruby, metaprogramming

在红宝石中：

```
for i in A do
    # some code
end 
```

是相同的：

```
A.each do |i|
   # some code
end 
```

`for`不是内核方法：

*   `for`红宝石中的“”到底是什么
*   有没有办法使用其他关键字来做类似的事情？

就像是：

```
 total = sum i in I {x[i]} 
```

映射到：

```
 total = I.sum {|i] x[i]} 
```

* * *

## 回答 #1

> 赞同：46
> 
> 时间：2008-09-30T23:15:49.217

这几乎是语法糖。一个区别是，虽然`for`会使用它周围的代码范围，但`each`会在其块内创建一个单独的范围。比较以下内容：

```
for i in (1..3)
  x = i
end
p x # => 3 
```

相对

```
(1..3).each do |i|
  x = i
end
p x # => undefined local variable or method `x' for main:Object 
```

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-09-30T23:04:56.217

`for`只是该`each`方法的语法糖。这可以通过运行以下代码看到：

```
for i in 1 do
end 
```

这会导致错误：

```
NoMethodError: undefined method `each' for 1:Fixnum 
```

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2008-09-30T23:11:04.550

For 只是语法糖。

从[镐](http://www.rubycentral.com/pickaxe/tut_expressions.html#UK)：

> **对于...在**
> 
> 前面我们说过，唯一内置的 Ruby 循环原语是 while 和 until。那么，这个“为”的东西是什么？好吧， for 几乎是一大堆语法糖。当你写
> 
> ```
> for aSong in songList
>   aSong.play
> end 
> ```
> 
> Ruby 将其翻译成如下内容：
> 
> ```
> songList.each do |aSong|
>   aSong.play
> end 
> ```
> 
> for 循环和 each 形式之间的唯一区别是在主体中定义的局部变量的范围。第 87 页对此进行了讨论。
> 
> 您可以使用 for 迭代任何响应每个方法的对象，例如 Array 或 Range。
> 
> ```
> for i in ['fee', 'fi', 'fo', 'fum']
>   print i, " "
> end
> for i in 1..3
>   print i, " "
> end
> for i in File.open("ordinal").find_all { |l| l =~ /d$/}
>   print i.chomp, " "
> end 
> ```
> 
> 产生：
> 
> ```
> fee fi fo fum 1 2 3 second third 
> ```
> 
> 只要你的类定义了一个明智的 each 方法，你就可以使用 for 循环来遍历它。
> 
> ```
> class Periods
>   def each
>     yield "Classical"
>     yield "Jazz"
>     yield "Rock"
>   end
> end
> 
> periods = Periods.new
> for genre in periods
>   print genre, " "
> end 
> ```
> 
> 产生：
> 
> ```
> Classical Jazz Rock 
> ```

Ruby 没有其他用于列表推导的关键字（如您上面所做的 sum 示例）。 `for`不是一个非常流行的关键字，`arr.each {}`通常首选方法语法 ( )。

# visual-studio - 扩展 SSRS 中的图表功能

> ID：155484
> 
> 赞同：3
> 
> 时间：2008-09-30T22:57:28.933
> 
> 标签：visual-studio, sql-server-2005, reporting-services, charts

SQL Server (2005) Business Intelligence Development Studio 中的默认图表对象似乎没有一些格式选项，例如：

1.  指定 x 和 y 轴上标签的文本方向
2.  向条形图添加趋势线
3.  任意调整图表中项目的大小 - 例如，如果我调整图表对象的大小，所有内容都会相应地调整大小，但我无法在扩展图例区域时保持图表的大小相同。
4.  多线图表标签

所以我想知道的是

1.  上面提到的格式问题有什么简单的答案吗？
2.  您会推荐哪些网站/书籍/资源/示例来扩展图表对象的功能？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-18T08:47:12.907

Some colleagues of mine gave up on the stock control and bought [Dundas charts](http://www.dundas.com/Products/Chart/RS/index.aspx)

The stock charts are cut down versions of Dundas.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-30T23:44:07.340

是的，您可以在 x 和 y 轴上指定标签的文本方向

1.  转到图表属性并在选项卡 x 和 y 轴中输入图表标题，并在标题对齐中使用左/右/中心对齐等组合。
2.  您可以更改图例线转到图表属性单击其中的图例选项卡有一个“在绘图区域内显示图例”选项，您可以在其中包含趋势线
3.  当文本限制扩展时，您可以使用多行文本标签

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-10T14:56:34.587

我看不出如何调整图例的大小，放在绘图区域内对于饼图来说看起来很丑

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-05T14:45:58.510

我建议使用 gbn 建议的登打士图表组件。如果这不可能，至少这篇[文章](http://social.msdn.microsoft.com/forums/en-US/sqlreportingservices/thread/97452004-db3a-4c56-9201-1998d984d15a/)应该解决问题 1。

# platform-independent - 独立于操作系统的 API 来监控文件系统？

> ID：155490
> 
> 赞同：8
> 
> 时间：2008-09-30T22:59:30.207
> 
> 标签：platform-independent, file-monitoring

我想尝试有关分布式文件同步/复制的想法。为了在用户工作时提高效率，我想实现某种守护程序来监视某些目录中的更改（例如 /home/user/dirToBeMonitored 或 c:\docs 和 setts\user\dirToBeMonitored）。因此，我可以知道每次（或在合理的时间间隔内）添加/更改/删除了哪个文件名。

任何高中级语言都可以做到这一点吗？你知道一些 API（以及使用哪种语言？）来做到这一点？

谢谢。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-10-01T00:09:21.587

对于[Windows](http://msdn.microsoft.com/en-us/library/aa365261(VS.85).aspx)、[Linux](http://en.wikipedia.org/wiki/Inotify)、[Mac OS X](http://en.wikipedia.org/wiki/FSEvents)和任何其他你可以命名的[Unix ，API 似乎是完全不同的。](http://en.wikipedia.org/wiki/File_Alteration_Monitor)我不知道有任何跨平台库以一致的方式处理这个问题。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-07-18T17:15:18.280

*一个合理的答案，尽管它需要一个较大的库依赖项（非常值得 IMO）！*

QT 提供了[QFileSystemwatcher](http://doc.trolltech.com/4.4/qfilesystemwatcher.html)类，它使用了底层平台的原生机制。

更好的是，您可以使用 Python 或 Ruby 的 QT 语言绑定。[这](http://www.rkblog.rk.edu.pl/w/p/pyqt4-text-editor-final-changes/)是一个使用[QFileSystemWatcher](http://doc.trolltech.com/4.4/qfilesystemwatcher.html)的简单 PyQT4 应用程序。

**笔记**

*   关于[创建可部署 PyQT4 应用程序](http://aralbalkan.com/1675)的一个很好的参考，尤其是在 OSX 上，但也应该适用于 Windows。
*   [之前在此处](https://stackoverflow.com/questions/61253/how-to-be-notified-of-file-directory-change-in-c-c-ideally-using-posix/61300#61300)发布的相同解决方案。
*   其他跨平台工具包也可以解决问题（例如[Gnome](http://www.gnome.org/)的[GIO](http://library.gnome.org/devel/gio/unstable/)具有[GFileMonitor](http://library.gnome.org/devel/gio/unstable/GFileMonitor.html)，尽管它仅适用于 UNIX 并且不支持 OSX 的[FSEvents](http://en.wikipedia.org/wiki/FSEvents)机制 afaik）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-30T23:43:38.840

在 Linux 中，它被称为[inotify](http://linux.die.net/man/7/inotify)。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-01T00:11:14.670

在 OS X 上，它被称为[fsevents](http://en.wikipedia.org/wiki/FSEvents)。它是操作系统级别的 API，因此最容易从 C 或 C++ 访问。它*应该*可以从几乎任何语言访问，尽管您的首选语言的绑定可能尚未编写。

# java - 用Java下载邮件附件

> ID：155504
> 
> 赞同：8
> 
> 时间：2008-09-30T23:02:53.413
> 
> 标签：java, spring, email, attachment

我查看了参考文档，Spring 似乎对发送邮件有很好的支持。但是，我需要登录到一个邮件帐户，阅读邮件并下载任何附件。Spring 邮件 API 是否支持下载邮件附件？

我知道您可以使用 Java Mail API 来做到这一点，但过去我发现使用它非常冗长且令人不快。

**编辑**：我收到了一些回复，这些回复指向描述如何发送带有附件的邮件的教程，但我要问的是如何从**收到**的邮件中**读取**附件。

 **干杯，唐

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-10-01T16:30:53.333

这是我用于下载电子邮件的类（带有附件处理）。您必须浏览一下它正在做的一些事情（比如忽略日志记录类和数据库写入）。为了便于阅读，我还重新命名了一些包。

总体思路是将所有附件保存为文件系统中的单个文件，并且将每封电子邮件保存为数据库中的一条记录，其中包含一组指向所有附件文件路径的子记录。

专注于 doEMailDownload 方法。

```
/**
  * Copyright (c) 2008 Steven M. Cherry
  * All rights reserved.
  */
package utils.scheduled;

import java.io.BufferedOutputStream;
import java.io.File;
import java.io.FileOutputStream;
import java.io.InputStream;
import java.sql.Timestamp;
import java.util.Properties;
import java.util.Vector;

import javax.mail.Address;
import javax.mail.Flags;
import javax.mail.Folder;
import javax.mail.Message;
import javax.mail.Multipart;
import javax.mail.Part;
import javax.mail.Session;
import javax.mail.Store;
import javax.mail.internet.MimeBodyPart;

import glob.ActionLogicImplementation;
import glob.IOConn;
import glob.log.Log;
import logic.utils.sql.Settings;
import logic.utils.sqldo.EMail;
import logic.utils.sqldo.EMailAttach;

/**
  * This will connect to our incoming e-mail server and download any e-mails
  * that are found on the server.  The e-mails will be stored for further processing
  * in our internal database.  Attachments will be written out to separate files
  * and then referred to by the database entries.  This is intended to be  run by 
  * the scheduler every minute or so.
  *
  * @author Steven M. Cherry
  */
public class DownloadEMail implements ActionLogicImplementation {

    protected String receiving_host;
    protected String receiving_user;
    protected String receiving_pass;
    protected String receiving_protocol;
    protected boolean receiving_secure;
    protected String receiving_attachments;

    /** This will run our logic */
    public void ExecuteRequest(IOConn ioc) throws Exception {
        Log.Trace("Enter");

        Log.Debug("Executing DownloadEMail");
        ioc.initializeResponseDocument("DownloadEMail");

        // pick up our configuration from the server:
        receiving_host = Settings.getValue(ioc, "server.email.receiving.host");
        receiving_user = Settings.getValue(ioc, "server.email.receiving.username");
        receiving_pass = Settings.getValue(ioc, "server.email.receiving.password");
        receiving_protocol = Settings.getValue(ioc, "server.email.receiving.protocol");
        String tmp_secure = Settings.getValue(ioc, "server.email.receiving.secure");
        receiving_attachments = Settings.getValue(ioc, "server.email.receiving.attachments");

        // sanity check on the parameters:
        if(receiving_host == null || receiving_host.length() == 0){
            ioc.SendReturn();
            ioc.Close();
            Log.Trace("Exit");
            return; // no host defined.
        }
        if(receiving_user == null || receiving_user.length() == 0){
            ioc.SendReturn();
            ioc.Close();
            Log.Trace("Exit");
            return; // no user defined.
        }
        if(receiving_pass == null || receiving_pass.length() == 0){
            ioc.SendReturn();
            ioc.Close();
            Log.Trace("Exit");
            return; // no pass defined.
        }
        if(receiving_protocol == null || receiving_protocol.length() == 0){
            Log.Debug("EMail receiving protocol not defined, defaulting to POP");
            receiving_protocol = "POP";
        }
        if(tmp_secure == null || 
            tmp_secure.length() == 0 ||
            tmp_secure.compareToIgnoreCase("false") == 0 ||
            tmp_secure.compareToIgnoreCase("no") == 0
        ){
            receiving_secure = false;
        } else {
            receiving_secure = true;
        }
        if(receiving_attachments == null || receiving_attachments.length() == 0){
            Log.Debug("EMail receiving attachments not defined, defaulting to ./email/attachments/");
            receiving_attachments = "./email/attachments/";
        }

        // now do the real work.
        doEMailDownload(ioc);

        ioc.SendReturn();
        ioc.Close();
        Log.Trace("Exit");
    }

    protected void doEMailDownload(IOConn ioc) throws Exception {
        // Create empty properties
        Properties props = new Properties();
        // Get the session
        Session session = Session.getInstance(props, null);

        // Get the store
        Store store = session.getStore(receiving_protocol);
        store.connect(receiving_host, receiving_user, receiving_pass);

        // Get folder
        Folder folder = store.getFolder("INBOX");
        folder.open(Folder.READ_WRITE);

        try {

            // Get directory listing
            Message messages[] = folder.getMessages();

            for (int i=0; i < messages.length; i++) {
                // get the details of the message:
                EMail email = new EMail();
                email.fromaddr = messages[i].getFrom()[0].toString();
                Address[] to = messages[i].getRecipients(Message.RecipientType.TO);
                email.toaddr = "";
                for(int j = 0; j < to.length; j++){
                    email.toaddr += to[j].toString() + "; ";
                }
                Address[] cc;
                try {
                    cc = messages[i].getRecipients(Message.RecipientType.CC);
                } catch (Exception e){
                    Log.Warn("Exception retrieving CC addrs: %s", e.getLocalizedMessage());
                    cc = null;
                }
                email.cc = "";
                if(cc != null){
                    for(int j = 0; j < cc.length; j++){
                        email.cc += cc[j].toString() + "; ";
                    }
                }
                email.subject = messages[i].getSubject();
                if(messages[i].getReceivedDate() != null){
                    email.received_when = new Timestamp(messages[i].getReceivedDate().getTime());
                } else {
                    email.received_when = new Timestamp( (new java.util.Date()).getTime());
                }

                email.body = "";
                Vector<EMailAttach> vema = new Vector<EMailAttach>();
                Object content = messages[i].getContent();
                if(content instanceof java.lang.String){
                    email.body = (String)content;
                } else if(content instanceof Multipart){
                    Multipart mp = (Multipart)content;

                    for (int j=0; j < mp.getCount(); j++) {
                        Part part = mp.getBodyPart(j);

                        String disposition = part.getDisposition();

                        if (disposition == null) {
                            // Check if plain
                            MimeBodyPart mbp = (MimeBodyPart)part;
                            if (mbp.isMimeType("text/plain")) {
                                Log.Debug("Mime type is plain");
                                email.body += (String)mbp.getContent();
                            } else {
                                Log.Debug("Mime type is not plain");
                                // Special non-attachment cases here of 
                                // image/gif, text/html, ...
                                EMailAttach ema = new EMailAttach();
                                ema.name = decodeName(part.getFileName());
                                File savedir = new File(receiving_attachments);
                                savedir.mkdirs();
                                File savefile = File.createTempFile("emailattach", ".atch", savedir );
                                ema.path = savefile.getAbsolutePath();
                                ema.size = part.getSize();
                                vema.add(ema);
                                ema.size = saveFile(savefile, part);
                            }
                        } else if ((disposition != null) && 
                            (disposition.equals(Part.ATTACHMENT) || disposition.equals(Part.INLINE) ) 
                        ){
                            // Check if plain
                            MimeBodyPart mbp = (MimeBodyPart)part;
                            if (mbp.isMimeType("text/plain")) {
                                Log.Debug("Mime type is plain");
                                email.body += (String)mbp.getContent();
                            } else {
                                Log.Debug("Save file (%s)", part.getFileName() );
                                EMailAttach ema = new EMailAttach();
                                ema.name = decodeName(part.getFileName());
                                File savedir = new File(receiving_attachments);
                                savedir.mkdirs();
                                File savefile = File.createTempFile("emailattach", ".atch", savedir );
                                ema.path = savefile.getAbsolutePath();
                                ema.size = part.getSize();
                                vema.add(ema);
                                ema.size = saveFile( savefile, part);
                            }
                        }
                    }
                }

                // Insert everything into the database:
                logic.utils.sql.EMail.insertEMail(ioc, email);
                for(int j = 0; j < vema.size(); j++){
                    vema.get(j).emailid = email.id;
                    logic.utils.sql.EMail.insertEMailAttach(ioc, vema.get(j) );
                }

                // commit this message and all of it's attachments
                ioc.getDBConnection().commit();

                // Finally delete the message from the server.
                messages[i].setFlag(Flags.Flag.DELETED, true);
            }

            // Close connection 
            folder.close(true); // true tells the mail server to expunge deleted messages.
            store.close();
        } catch (Exception e){
            folder.close(true); // true tells the mail server to expunge deleted messages.
            store.close();
            throw e;
        }

    }

    protected int saveFile(File saveFile, Part part) throws Exception {

        BufferedOutputStream bos = new BufferedOutputStream( new FileOutputStream(saveFile) );

        byte[] buff = new byte[2048];
        InputStream is = part.getInputStream();
        int ret = 0, count = 0;
        while( (ret = is.read(buff)) > 0 ){
            bos.write(buff, 0, ret);
            count += ret;
        }
        bos.close();
        is.close();
        return count;
    }

    protected String decodeName( String name ) throws Exception {
        if(name == null || name.length() == 0){
            return "unknown";
        }
        String ret = java.net.URLDecoder.decode( name, "UTF-8" );

        // also check for a few other things in the string:
        ret = ret.replaceAll("=\\?utf-8\\?q\\?", "");
        ret = ret.replaceAll("\\?=", "");
        ret = ret.replaceAll("=20", " ");

        return ret;
    }

} 
```

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2010-12-24T19:33:23.293

我对 Steven 的示例进行了一些处理，并删除了 Steven 特定的代码部分。如果有附件，我的代码将不会读取电子邮件的正文。这对我的情况很好，但你可能想为你的情况进一步完善它。

```
package utils;

import java.io.BufferedOutputStream;
import java.io.File;
import java.io.FileOutputStream;
import java.io.InputStream;
import java.util.ArrayList;
import java.util.Date;
import java.util.List;
import java.util.Properties;

import javax.mail.Address;
import javax.mail.Flags;
import javax.mail.Folder;
import javax.mail.Message;
import javax.mail.Multipart;
import javax.mail.Part;
import javax.mail.Session;
import javax.mail.Store;
import javax.mail.internet.MimeBodyPart;

public class IncomingMail {

 public static List<Email> downloadPop3(String host, String user, String pass, String downloadDir) throws Exception {

  List<Email> emails = new ArrayList<Email>();

  // Create empty properties
  Properties props = new Properties();

  // Get the session
  Session session = Session.getInstance(props, null);

  // Get the store
  Store store = session.getStore("pop3");
  store.connect(host, user, pass);

  // Get folder
  Folder folder = store.getFolder("INBOX");
  folder.open(Folder.READ_WRITE);

  try {
   // Get directory listing
   Message messages[] = folder.getMessages();
   for (int i = 0; i < messages.length; i++) {

    Email email = new Email();

    // from 
    email.from = messages[i].getFrom()[0].toString();

    // to list
    Address[] toArray = messages[i] .getRecipients(Message.RecipientType.TO);
    for (Address to : toArray) { email.to.add(to.toString()); }

    // cc list
    Address[] ccArray = null;
    try {
     ccArray = messages[i] .getRecipients(Message.RecipientType.CC);
    } catch (Exception e) { ccArray = null; }
    if (ccArray != null) {
     for (Address c : ccArray) {
      email.cc.add(c.toString());
     }
    }

    // subject
    email.subject = messages[i].getSubject();

    // received date
    if (messages[i].getReceivedDate() != null) {
     email.received = messages[i].getReceivedDate();
    } else {
     email.received = new Date();
    }

    // body and attachments
    email.body = "";
    Object content = messages[i].getContent();
    if (content instanceof java.lang.String) {

     email.body = (String) content;

    } else if (content instanceof Multipart) {

     Multipart mp = (Multipart) content;

     for (int j = 0; j < mp.getCount(); j++) {

      Part part = mp.getBodyPart(j);
      String disposition = part.getDisposition();

      if (disposition == null) {

       MimeBodyPart mbp = (MimeBodyPart) part;
       if (mbp.isMimeType("text/plain")) {
        // Plain
        email.body += (String) mbp.getContent();
       } 

      } else if ((disposition != null) && (disposition.equals(Part.ATTACHMENT) || disposition .equals(Part.INLINE))) {

       // Check if plain
       MimeBodyPart mbp = (MimeBodyPart) part;
       if (mbp.isMimeType("text/plain")) {
        email.body += (String) mbp.getContent();
       } else {
        EmailAttachment attachment = new EmailAttachment();
        attachment.name = decodeName(part.getFileName());
        File savedir = new File(downloadDir);
        savedir.mkdirs();
        // File savefile = File.createTempFile( "emailattach", ".atch", savedir);
        File savefile = new File(downloadDir,attachment.name);
        attachment.path = savefile.getAbsolutePath();
        attachment.size = saveFile(savefile, part);
        email.attachments.add(attachment);
       }
      }
     } // end of multipart for loop 
    } // end messages for loop

    emails.add(email);

    // Finally delete the message from the server.
    messages[i].setFlag(Flags.Flag.DELETED, true);
   }

   // Close connection
   folder.close(true); // true tells the mail server to expunge deleted messages
   store.close();

  } catch (Exception e) {
   folder.close(true); // true tells the mail server to expunge deleted
   store.close();
   throw e;
  }

  return emails;
 }

 private static String decodeName(String name) throws Exception {
  if (name == null || name.length() == 0) {
   return "unknown";
  }
  String ret = java.net.URLDecoder.decode(name, "UTF-8");

  // also check for a few other things in the string:
  ret = ret.replaceAll("=\\?utf-8\\?q\\?", "");
  ret = ret.replaceAll("\\?=", "");
  ret = ret.replaceAll("=20", " ");

  return ret;
 }

 private static int saveFile(File saveFile, Part part) throws Exception {

  BufferedOutputStream bos = new BufferedOutputStream(
    new FileOutputStream(saveFile));

  byte[] buff = new byte[2048];
  InputStream is = part.getInputStream();
  int ret = 0, count = 0;
  while ((ret = is.read(buff)) > 0) {
   bos.write(buff, 0, ret);
   count += ret;
  }
  bos.close();
  is.close();
  return count;
 }

} 
```

你还需要这两个辅助类

```
package utils;

import java.util.ArrayList;
import java.util.Date;
import java.util.List;

public class Email {

 public Date received;
 public String from;
 public List<String> to = new ArrayList<String>();
 public List<String> cc = new ArrayList<String>();
 public String subject;
 public String body;
 public List<EmailAttachment> attachments = new ArrayList<EmailAttachment>();
} 
```

和

```
package utils;

public class EmailAttachment {

 public String name;
 public String path;
 public int size;
} 
```

我用它来测试上面的类

```
package utils;

import java.util.List;

public class Test {

 public static void main(String[] args) {

  String host = "some host";
  String user = "some user";
  String pass = "some pass";
  String downloadDir = "/Temp";
  try {
   List<Email> emails = IncomingMail.downloadPop3(host, user, pass, downloadDir);
   for ( Email email : emails ) {
    System.out.println(email.from);
    System.out.println(email.subject);
    System.out.println(email.body);
    List<EmailAttachment> attachments = email.attachments;
    for ( EmailAttachment attachment : attachments ) {
     System.out.println(attachment.path+" "+attachment.name);
    }
   }
  } catch (Exception e) { e.printStackTrace(); }

 }

} 
```

更多信息可以在[http://java.sun.com/developer/onlineTraining/JavaMail/contents.html找到](http://java.sun.com/developer/onlineTraining/JavaMail/contents.html)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-09-29T01:05:49.140

这是一个错误：

```
else if ((disposition != null) && (disposition.equals(Part.ATTACHMENT)
 || disposition.equals(Part.INLINE) ) 
```

它应该是：

```
else if ((disposition.equalsIgnoreCase(Part.ATTACHMENT)
 || disposition.equalsIgnoreCase(Part.INLINE)) 
```

感谢@Stevenmcherry 的回答

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2013-12-09T09:53:08.330

我使用 Apache Commons Mail 来完成这个任务：

```
import java.util.List;
import javax.activation.DataSource; 
import javax.mail.internet.MimeMessage;   
import org.apache.commons.mail.util.MimeMessageParser;   

public List<DataSource> getAttachmentList(MimeMessage message) throws Exception {
    msgParser = new MimeMessageParser(message);
    msgParser.parse();
    return msgParser.getAttachmentList();
} 
```

从`DataSource`对象中，您可以检索`InputStream`附件的（除了名称和类型）（请参阅 API：[http ://docs.oracle.com/javase/6/docs/api/javax/activation/DataSource.html?is-external=真的](http://docs.oracle.com/javase/6/docs/api/javax/activation/DataSource.html?is-external=true)）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-30T23:07:29.330

到目前为止，我只使用了 JavaMail API（出于我的目的，我对它们相当满意）。如果完整的 JavaMail 包对您来说太重，则可以使用底层传输引擎而无需包的顶层。您在 SMTP、POP3 和 IMAP 堆栈中的位置越低，您需要为自己做的准备就越多。

从好的方面来说，您还可以忽略应用程序不需要的部分。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2013-10-11T12:00:23.380

```
import java.io.IOException;
import java.io.InputStream;

import javax.mail.internet.MimeMessage;
import javax.servlet.http.HttpServletRequest;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.core.io.InputStreamSource;
import org.springframework.mail.javamail.JavaMailSender;
import org.springframework.mail.javamail.MimeMessageHelper;
import org.springframework.mail.javamail.MimeMessagePreparator;
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.multipart.commons.CommonsMultipartFile;

@Controller
@RequestMapping("/sendEmail.do")
public class SendEmailAttachController {
    @Autowired
    private JavaMailSender mailSender;

    @RequestMapping(method = RequestMethod.POST)
    public String sendEmail(HttpServletRequest request,
            final @RequestParam CommonsMultipartFile attachFile) {

        // Input here
        final String emailTo = request.getParameter("mailTo");
        final String subject = request.getParameter("subject");
        final String yourmailid = request.getParameter("yourmail");
        final String message = request.getParameter("message");

        // Logging
        System.out.println("emailTo: " + emailTo);
        System.out.println("subject: " + subject);
        System.out.println("Your mail id is: "+yourmailid);
        System.out.println("message: " + message);
        System.out.println("attachFile: " + attachFile.getOriginalFilename());

        mailSender.send(new MimeMessagePreparator() {

            @Override
            public void prepare(MimeMessage mimeMessage) throws Exception {
                MimeMessageHelper messageHelper = new MimeMessageHelper(
                        mimeMessage, true, "UTF-8");
                messageHelper.setTo(emailTo);
                messageHelper.setSubject(subject);
                messageHelper.setReplyTo(yourmailid);
                messageHelper.setText(message);

                // Attachment with mail
                String attachName = attachFile.getOriginalFilename();
                if (!attachFile.equals("")) {

                    messageHelper.addAttachment(attachName, new InputStreamSource() {

                        @Override
                        public InputStream getInputStream() throws IOException {
                            return attachFile.getInputStream();
                        }
                    });
                }

            }

        });

        return "Result";
    }
} 
```

# emacs - 如何从 Emacs 中创建目录？

> ID：155507
> 
> 赞同：152
> 
> 时间：2008-09-30T23:03:32.867
> 
> 标签：emacs, directory, command

如何使用 Emacs 创建一个新目录？我使用什么命令？（如果可能，请举个例子）

* * *

## 回答 #1

> 赞同：209
> 
> 时间：2008-09-30T23:04:19.807

*   要创建目录`dir/to/create`，请键入：

    ```
    M-x make-directory RET dir/to/create RET 
    ```

*   创建目录，`dir/parent1/node`然后`dir/parent2/node`键入：

    ```
    M-! mkdir -p dir/parent{1,2}/node RET 
    ```

    它假定 Emacs 的劣质 shell 是`bash`/`zsh`或其他兼容的 shell。

*   或在某种`Dired`模式下

    ```
    + 
    ```

    它不会创建不存在的父目录。

    例子：

    ```
    C-x d *.py RET ; shows python source files in the CWD in `Dired` mode
    + test RET     ; create `test` directory in the CWD 
    ```

    `CWD`代表当前工作目录。

*   或者只是使用不存在的父目录创建一个新文件，`C-x C-f`然后键入：

    ```
    M-x make-directory RET RET 
    ```

Emacs 要求在最近的 Emacs 版本中保存新文件时自动创建父目录。对于旧版本，请参阅[如何使 Emacs 创建中间目录 - 保存文件时？](https://stackoverflow.com/q/6830671/4279)

* * *

## 回答 #2

> 赞同：48
> 
> 时间：2008-09-30T23:05:46.450

`Ctrl`+ `X` `D`( `C-x d`) 以“dired”模式打开一个目录，然后`+`创建一个目录。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2008-09-30T23:46:46.100

您还可以使用运行单个 shell 命令`M-!`

您基本上是在向命令行发送一个字符串，因此您不会获得任何好的自动完成功能，但如果您知道如何通过命令行执行操作但不知道 Emacs 等效方式，它会很有用。

```
M-! mkdir /path/to/new_dir 
```

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2011-08-27T20:07:02.800

我想我今天早些时候做得很艰难。我做了：

```
M-x shell-command 
```

然后

```
mkdir -p topdir/subdir 
```

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-10-01T02:30:55.893

您可以`M-x` `make-directory`在任何缓冲区内使用，不一定是 dired 缓冲区。它是一个您也可以使用的 lisp 函数。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2013-01-01T21:22:37.397

我在搜索如何在 Emacs 中自动创建目录时遇到了这个问题。我找到的最佳答案是在几年后的[另一个帖子中。](https://stackoverflow.com/questions/6830671/how-to-make-emacs-create-intermediate-dirs-when-saving-a-file)[Victor Deryagin](https://stackoverflow.com/users/513266/victor-deryagin)的答案正是我想要的。将该代码添加到您的 .emacs 将使 Emacs 在您保存文件时提示您创建目录。

# php - 如何在 PHP 中将 utf-8 字符串转换为 utf-16 字符串

> ID：155514
> 
> 赞同：10
> 
> 时间：2008-09-30T23:04:58.637
> 
> 标签：php, utf-8, utf-16

如何在 PHP 中将 utf-8 字符串转换为 utf-16 字符串？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-09-30T23:10:03.567

mbstring[支持 UTF-16](http://www.php.net/manual/en/mbstring.supported-encodings.php)，所以你可以使用[`mb_convert_encoding`](http://www.php.net/manual/en/function.mb-convert-encoding.php).

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-23T08:33:28.703

你也可以使用[`iconv`](http://php.net/manual/en/function.iconv.php).

它在 PHP 中是原生的，但要求您的所有文本都是一个字符集。否则它可能会丢弃字符。

# vb6 - 在没有 DoEvents 的情况下取消 VB6.0 中长时间运行的进程？

> ID：155517
> 
> 赞同：22
> 
> 时间：2008-09-30T23:05:08.337
> 
> 标签：vb6

是否可以在不使用 DoEvents 的情况下取消 VB6.0 中长时间运行的进程？

例如：

```
for i = 1 to someVeryHighNumber
    ' Do some work here '
    ...

    if cancel then
        exit for
    end if
next

Sub btnCancel_Click()
    cancel = true
End Sub 
```

我假设在“如果取消那么......”之前我需要一个“DoEvents”有没有更好的方法？有一阵子了...

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2008-10-02T04:35:45.663

不，你做对了，你肯定想要在你的循环中使用 DoEvents。

如果你把它`DoEvents`放在你的主循环中，并且发现这太慢了处理速度，请尝试调用 Windows API 函数`GetQueueStatus`（它比 DoEvents 快得多）来快速确定是否有必要调用 DoEvents。`GetQueueStatus`告诉您是否有要处理的事件。

```
' at the top:
Declare Function GetQueueStatus Lib "user32" (ByVal qsFlags As Long) As Long

' then call this instead of DoEvents:
Sub DoEventsIfNecessary()
    If GetQueueStatus(255) <> 0 Then DoEvents
End Sub 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-09-30T23:13:19.223

不，您必须使用 DoEvents 否则所有 UI、键盘和计时器事件将在队列中等待。

您唯一能做的就是每 1000 次迭代调用一次 DoEvents 等。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-09-30T23:09:51.463

“for”循环是否在 GUI 线程中运行？如果是这样，是的，您将需要一个 DoEvents。您可能希望使用单独的线程，在这种情况下不需要 DoEvents。您[可以在 VB6 中执行此操作](http://www.freevbcode.com/ShowCode.Asp?ID=1287)（不简单）。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-09-30T23:14:32.450

你可以在一个单独的线程上启动它，但在 VB6 中这是一个非常痛苦的过程。DoEvents 应该可以工作。这是一个hack，但VB6也是如此（10年的VB老手在这里说话，所以不要贬低我）。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-10-01T03:39:14.233

将长期运行的任务划分为量子。此类任务通常由一个简单的循环驱动，因此将其分成 10、100、1000 次等迭代。使用 Timer 控件，每次触发时都会执行部分任务并随时保存其状态。首先，设置初始状态并启用定时器。完成后，禁用计时器并处理结果。

您可以通过更改每个量子完成的工作量来“调整”它。在 Timer 事件处理程序中，您可以检查“取消”并根据需要提前停止。您可以通过将工作负载和 Timer 捆绑到带有 Completed 事件的 UserControl 中来使这一切变得更整洁。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-10-15T22:36:53.127

当我需要它时，这对我很有效。它检查用户是否按下了退出键以退出循环。

请注意，它有一个非常大的缺点：它会检测用户是否在任何应用程序上按下了转义键 - 而不仅仅是您的应用程序。但是当你想给自己一种方法来中断一个长时间运行的循环，或者一种按住 shift 键绕过一些代码的方法时，这是一个很好的开发技巧。

```
Option Explicit

Private Declare Function GetAsyncKeyState Lib "user32" (ByVal nVirtKey As Long) As Integer

Private Sub Command1_Click()
    Do
        Label1.Caption = Now()
        Label1.Refresh
        If WasKeyPressed(vbKeyEscape) Then Exit Do
    Loop

    Label1.Caption = "Exited loop successfully"

End Sub

Function WasKeyPressed(ByVal plVirtualKey As Long) As Boolean
    If (GetAsyncKeyState(plVirtualKey) And &H8000) Then WasKeyPressed = True
End Function 
```

GetAsyncKeyState 的文档在这里：

[http://msdn.microsoft.com/en-us/library/ms646301(VS.85).aspx](http://msdn.microsoft.com/en-us/library/ms646301(VS.85).aspx)

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2009-01-05T17:55:20.223

**编辑**结果[证明](https://stackoverflow.com/questions/2785169/using-the-net-backgroundworker-from-vb6-fails-with-an-accessviolationexception)MSDN 文章有缺陷，并且该技术[**不起作用**](https://stackoverflow.com/questions/2785169/using-the-net-backgroundworker-from-vb6-fails-with-an-accessviolationexception):(

这是一篇关于使用[.NET BackgroundWorker](http://msdn.microsoft.com/en-us/library/aa719109.aspx)组件在 VB6 中的另一个线程上运行任务的文章。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2009-10-13T17:01:33.243

这是 VB6 中异步后台处理的一个非常标准的方案。（例如，它在 Dan Appleman 的[书中](http://www.amazon.co.uk/Applemans-Developing-ActiveX-Components-Visual/dp/1562765760)和 Microsoft 的 VB6[示例中](http://msdn.microsoft.com/en-us/library/aa445814(VS.60).aspx)。）您创建一个单独的 ActiveX EXE 来完成工作：这样工作就会自动在另一个线程上，在一个单独的进程中（这意味着您不必担心变量被践踏）。

*   VB6 ActiveX EXE 对象应该公开一个事件 CheckQuitDoStuff()。这需要一个名为 Quit 的 ByRef 布尔值。
*   客户端在 ActiveX EXE 对象中调用 StartDoStuff。此例程在隐藏窗体上启动 Timer 并**立即返回**。这会解除阻塞调用线程。Timer 间隔非常短，因此 Timer 事件会快速触发。
*   Timer 事件处理程序禁用 Timer，然后回调到 ActiveX 对象的 DoStuff 方法。这开始了冗长的处理。
*   DoStuff 方法会定期引发 CheckQuitDoStuff 事件。客户端的事件处理程序检查特殊标志并在需要中止时设置 Quit True。然后 DoStuff 中止计算并在 Quit 为 True 时提前返回。

这种方案意味着客户端实际上不需要是多线程的，因为调用线程在“DoStuff”发生时不会阻塞。棘手的部分是确保 DoStuff 以适当的间隔引发事件 - 太长，并且您无法在您想要的时候退出：太短，并且您不必要地减慢了 DoStuff。此外，当 DoStuff 退出时，它必须卸载隐藏的表单。

如果 DoStuff 确实设法在中止之前完成所有工作，您可以引发不同的事件来告诉客户端工作已完成。

# asp.net - ASP.NET 2.0/3.5 中的 XHTML 1.0 严格（或过渡）合规性

> ID：155532
> 
> 赞同：10
> 
> 时间：2008-09-30T23:11:13.427
> 
> 标签：asp.net, xhtml-1.0-strict

有没有什么好的方法可以让 ASP.NET 2.0 在 XHTML 1.0 严格（或过渡）DTD 下进行验证？在破解 HTTP 响应的核心之前，我很想听听一些想法。

一个主要问题是表单标签本身，这是我尝试验证时从 W3C 得到的输出：

```
Line 13, Column 11: there is no attribute "name".
<form name="aspnetForm" method="post" action="Default.aspx" onsubmit="javascript 
```

众所周知，该标记对 ASP.NET 来说是非常基础的。嗯。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-10-01T07:13:21.317

ASP.NET 2.0 及更高版本确实可以输出严格（或过渡）XHTML。这将解决您的“没有属性“名称””验证错误等问题。要进行此设置，请使用以下内容更新您的 Web.config 文件：

```
<system.web>
    ... other configuration goes here ...
    <xhtmlConformance mode="Strict" />
</system.web> 
```

对于过渡 XHTML，请`mode="Transitional"`改用。

请参阅MSDN 上[的如何：在 ASP.NET 网站中配置 XHTML 呈现。](http://msdn.microsoft.com/en-us/library/ms178159.aspx)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-30T23:24:15.267

您是否考虑过[ASP.NET MVC 框架](http://www.asp.net/mvc/)？如果要求严格的 XHTML 合规性，这可能是一个更好的选择。您可以更好地控制您的输出，但是如果您已经习惯了传统的 ASP.NET 模型，那么您将涉足陌生的领域。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-30T23:20:05.727

[可以使用CSS 适配器](http://www.asp.net/CssAdapters/)等技术更改 ASP.NET 控件的输出。尽管我个人不建议您开箱即用，但它可能会为您提供一些好的解决方案的提示。

我通常尽可能避免使用 ASP.NET 控件，除了那些不自己生成标记的控件，例如 Repeater 控件。我会研究 ASP.NET MVC 框架（StackOverflow 是基于什么构建的），因为它可以让您 100% 控制标记。

# c# - 如何判断 .Net System.Diagnostics.Process 何时运行成功或失败？

> ID：155540
> 
> 赞同：5
> 
> 时间：2008-09-30T23:13:21.063
> 
> 标签：c#, sql, error-handling

我正在编写调度程序或排序。它基本上是一个包含 exe 列表（如“C:\a.exe”）的表和一个控制台应用程序，它每分钟左右查看表中的记录并运行尚未运行的任务。

我运行这样的任务：

```
System.Diagnostics.Process p = new System.Diagnostics.Process();
p.StartInfo.UseShellExecute = false;
p.StartInfo.FileName = someExe; // like "a.exe"
p.Start(); 
```

如何判断特定任务是否失败？例如，如果 a.exe 抛出未处理的异常怎么办？我希望上面的代码知道何时发生这种情况，并使用“特定任务失败”等内容更新任务表。

我怎样才能做到这一点？

我没有使用 Sql Agent 或 Windows Scheduler，因为其他人告诉我不要。他有更多的“经验”，所以我基本上只是听从命令。随意提出替代方案。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-30T23:31:28.227

您可以捕获[Win32Exception](http://msdn.microsoft.com/en-us/library/system.componentmodel.win32exception.aspx)以检查[Process.Start()](http://msdn.microsoft.com/en-us/library/e8zac0ca.aspx)是否由于文件不存在或执行访问被拒绝而失败。

但是您无法捕获使用此类创建的进程引发的异常。首先，应用程序可能不是用 .NET 编写的，因此可能根本没有异常的概念。

您可以做的是检查应用程序的[ExitCode](http://msdn.microsoft.com/en-us/library/system.diagnostics.process.exitcode.aspx)或读取[StandardOutput](http://msdn.microsoft.com/en-us/library/system.diagnostics.process.standardoutput.aspx)和[StandardError](http://msdn.microsoft.com/en-us/library/system.diagnostics.process.standarderror.aspx)流以检查是否正在发布错误消息。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-30T23:20:15.243

我认为您正在寻找 Process.ExitCode，假设流程返回一个。不过，您可能需要使用 WaitForExit() 。还有一个 ErrorDataReceived 事件，当应用程序发送到 stderr 时会触发该事件。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-30T23:24:27.153

除了 ExitCode，您还可以执行以下操作：

```
string output = p.StandardOutput.ReadToEnd(); 
```

这将捕获本应写入命令窗口的所有内容。然后，您可以解析该字符串以查找用于显示错误的已知模式，具体取决于应用程序。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-01T10:55:59.223

扩展@jop 所说的内容。您还需要等待该过程关闭。因此：

```
 p.Start();
        p.WaitForExit();
        int returnCode = p.ExitCode; 
```

非零代码通常是错误。一些应用程序使用负数是错误，正数作为状态代码/警告。

# sql-server - 给定位置的全局唯一基于整数的 ID（顺序）

> ID：155544
> 
> 赞同：0
> 
> 时间：2008-09-30T23:16:01.417
> 
> 标签：sql-server

我需要为给定位置创建一个唯一 ID，并且该位置的 ID 必须是连续的。所以它基本上就像一个主键，除了它也与 locationID 相关联。所以 3 个不同的位置都有 ID，比如 1,2,3,4,5,...,n

做这个的最好方式是什么？我还需要一种安全的方法来获取给定位置的 nextID，我猜我可以将事务放在获取下一个 ID 的存储过程上？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-30T23:34:52.667

我见过的其中一种方法是创建一个将位置映射到下一个 ID 的表。

```
CREATE TABLE LocationID {
    Location varchar(32) PRIMARY KEY,
    NextID int DEFAULT(1)
} 
```

在存储过程中，您可以进行更新并获取当前值，同时增加值：

```
...
UPDATE LocationID SET @nextID = NextID, NextID = NextID + 1 WHERE Location = @Location
... 
```

以上可能不是很便携，您最终可能会得到增量值而不是当前值。您可以根据需要调整列的默认值。

需要注意的另一件事是，您将多久点击一次，以及您是否要从另一个存储过程或应用程序代码中点击它。如果它来自另一个存储过程，那么一次一个可能就可以了。如果您要从应用程序代码中找到它，您最好先获取一个值范围，然后将它们一个接一个地分配给您的应用程序，然后再获取另一个范围。如果应用程序在仍有一半分配的块时出现故障，这可能会在您的序列中留下空白。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-30T23:21:07.177

您需要包装代码以查找下一个 ID 和代码以将行保存在同一事务中。你不想要（伪代码）：

```
transaction {
   id = getId
}

... other processing

transaction {
   createRowWithNewId
} 
```

因为在“...其他处理”期间可以保存具有该 ID 的另一个对象

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2017-06-30T18:49:02.713

如果这不需要持久化，您总是可以在查询中执行此操作，而不是将其存储在表本身中。

```
select
  locationID
  ,row_number() over (partition by locationID order by (select null)) as LocationPK
From
  YourTable 
```

# ajax - 引用的 .dll 中引发的异常如何调试？

> ID：155559
> 
> 赞同：2
> 
> 时间：2008-09-30T23:21:49.063
> 
> 标签：ajax, debugging, .net-3.5

我在文本框上使用了水印扩展器，并且 AJAX 控件工具包 .dll 引发了异常。这很奇怪，因为这才刚刚开始。

我尝试从 Ajax 解决方案和 Ajax 示例（但使用我的代码）进行调试，但没有骰子。

有没有办法从我的解决方案中进入 Ajax .dll 以查看发生这种情况的位置？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-30T23:27:19.597

难道您不能只获取 Ajax Control Toolkit 的源代码并将其作为项目包含在您的解决方案中，然后引用它吗？然后您就可以进入代码，如果您真的需要，您可以在部署时将预编译的代码放入。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-30T23:28:12.027

AJAX 控件工具包的源代码可从以下位置获得：

[http://www.codeplex.com/AjaxControlToolkit/Release/ProjectReleases.aspx?ReleaseId=16488](http://www.codeplex.com/AjaxControlToolkit/Release/ProjectReleases.aspx?ReleaseId=16488)

只需下载并开始调试。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-30T23:32:09.367

您不需要包含 AjaxControlToolkit 项目。只需打开您需要的文件（在当前中断的代码所在的 VS 实例中），并在适当的位置设置断点。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-03-27T11:36:43.513

也许黑盒方法在这里更合适。你说这个错误刚刚开始 - 你的环境发生了什么变化来开始这个？通过单步执行代码，您可能会陷入困境。您可以部署到干净的环境并且不会出现错误吗？或者，它在开发环境中有效，但在测试环境中无效？

# multithreading - 获取当前执行线程的 TThread 对象？

> ID：155560
> 
> 赞同：17
> 
> 时间：2008-09-30T23:22:09.017
> 
> 标签：multithreading, delphi

我想要一个像 GetCurrentThread 这样的函数，它返回当前执行线程的 TThread 对象。我知道有一个 Win32 API 调用 GetCurrentThread，但它返回线程 ID。如果有可能从该 ID 获取 TThread 对象，那也很好。

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2008-10-01T00:55:31.943

从您自己的回答来看，您似乎只想“确定是否在主线程中运行”，在这种情况下您可以使用

```
if Windows.GetCurrentThreadId() = System.MainThreadID then
// ... 
```

尽管如果它是由工作线程加载的，则这不适用于使用 Delphi 创建的 DLL。

* * *

## 回答 #2

> 赞同：23
> 
> 时间：2008-10-01T05:00:10.013

Delphi 的最新版本 Delphi 2009 在 TThread 类上有一个 CurrentThread 类属性。

如果它是本机线程，这将返回正确的 Delphi 线程对象。如果线程是“外来”线程，即使用其他机制或在第三方线程的回调上创建，那么它将围绕线程句柄创建一个包装线程。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-01T05:52:23.850

我正在使用我自己的 TThread 后代，它在全局列表中注册自己，并受锁保护。

这样，这个后代中的方法可以遍历列表并获得一个 TThread 给出一个 ID。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-30T23:35:50.463

回答我自己的问题。我想不可能从 ID 中获取 TThread 对象。可以通过使用全局变量来实现。然后比较它的句柄和当前线程id，可以判断是否在主线程中运行。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-30T23:50:51.567

当前执行的线程不是您要从中运行函数的线程吗？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-01T00:04:38.837

*您可以通过TlsSetValue* API 调用将 TThread 实例的指针存储在当前线程的上下文中，然后使用*TlsGetValue*检索它。但是，请注意，这仅在您尝试检索/存储**当前**线程的 TThread 实例时才有效。

# svn - 你如何使用 git svn？

> ID：155566
> 
> 赞同：14
> 
> 时间：2008-09-30T23:26:20.347
> 
> 标签：svn, git

请提供在 svn 中有效使用 git 的提示。你的“最佳实践”是什么？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-30T23:28:13.727

这是我最近学到的一些：

1.  `git svn rebase`做之前总是做`git svn dcommit`
2.  当你在做的时候`dcommit`，从一个临时的临时分支做 - 如果你（或 git）搞砸了，只需删除分支并重新开始就更容易恢复

当`svn dcommit`在一个大的提交中途死亡并且你似乎失去了所有的历史时，[这样做](http://groups.google.com/group/google-code-hosting/msg/baf06d4d630371c3)：

> 如何恢复：
> 
> 首先，打开 .git/logs/HEAD
> 
> 找到作为 git repo 头部的提交的哈希。希望你能记住提交信息并能弄清楚，但这应该很明显
> 
> 回到你现在的工作目录：
> 
> git reset --hard <来自日志的哈希>
> 
> 这会让你的工作目录回到你执行 git-svn dcommit 之前的位置。然后：
> 
> git-svn rebase git-svn dcommit

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-30T23:55:58.763

创建克隆时，使用`--prefix=svn/`. 它创建了更好的分支名称。

另外，在执行or时不要忽略`--trunk`,`--tags`和`--branches`参数。`clone``init`

获取是比较耗时的步骤之一，因此设置一个 cron 作业`git svn fetch`在后台执行。这是安全的，因为提取不会影响您的任何工作分支。

（背景信息`git svn fetch`：无论何时执行此命令都会首先执行`git svn rebase`，因此通过提前执行此步骤，您的`git svn rebase`调用通常会更快。该`fetch`命令下载 SVN 提交并将它们粘贴到由 git-svn 管理的特殊分支中。这些分支是可以通过做查看`git branch -r`，如果您执行了上述步骤，则它们以“svn/”开头。）

确保您知道如何使用`git reflog`. 我有几次`git svn dcommit`死亡（通常是因为我试图检查一些巨大的东西）并且我的提交似乎丢失了。在每种情况下，提交都很容易在 reflog 中找到。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-30T23:56:21.880

~~如果您的 SVN 存储库中有一个可以拒绝提交的提交后挂钩，那么`git svn dcommit`将在第一次拒绝提交时停止处理提交，并且您必须从 git reflog 恢复剩余的提交。~~

实际上，我认为上述问题是由于我的牛人`git rebase -i`在尝试修复被拒绝的提交时没有正确运行引起的。但是，多亏了 reflog，我们才能恢复一切！

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-09-27T14:17:17.740

我一直在写一些关于如何同时使用 Subversion 和 Git 的博客，并且我还发布了一些基本的截屏视频。在这里收集所有内容：[http ://www.tfnico.com/presentations/git-and-subversion](http://www.tfnico.com/presentations/git-and-subversion)

我会尝试一个总结：

*   去吧！试试看也无妨：）
*   先从一个小的 Git 项目开始学习。
*   Stick to the command-line until you master it. GUI-tools might just confuse you.
*   If possible, do one-off migrations, leave SVN behind, one project at a time, starting with the small ones.
*   If you do have to live with a Git and SVN together, be aware that you have to give up many advantages you get from Git, like branches, but you get the "local" benefits (stash, index, speed).
*   If you are one Git user, just do git-svn rebasing and dcommitting by yourself.
*   If you are several Git collaborators, set up a central Git/SVN that only pulls from SVN, while each Git-user dcommits directly back to SVN. [More info here](https://stackoverflow.com/questions/1880405/can-different-git-svn-clones-of-the-same-svn-repository-expect-to-be-able-to-shar/3422422#3422422).

# code-analysis - 了解代码指标

> ID：155581
> 
> 赞同：9
> 
> 时间：2008-09-30T23:29:01.323
> 
> 标签：code-analysis, metrics

我最近安装了 Eclipse Metrics 插件，并为我们的一个项目导出了数据。

拥有这些漂亮的图表非常好，但我真的很想更深入地了解它们的含义。指标的定义只能告诉你它的真正含义。

有谁知道任何好的资源、书籍、网站等，可以帮助我更好地理解所有数据的含义，并了解如何在必要时改进代码？

我对传出耦合和圈复杂性等事物感兴趣，而不是代码行或每个方法的行数。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-01T00:47:23.647

我不认为代码指标（有时称为[软件指标](http://en.wikipedia.org/wiki/Software_metric)）在您可以改进的地方提供有价值的数据。

使用代码指标，很高兴看到您在一小时内编写了多少代码等，但除此之外，它们还告诉您编写代码的质量、文档和代码覆盖率。他们几乎是一周的尝试来衡量你无法真正衡量的地方。

代码指标还区分解决更难问题的程序员，因为他们*显然*设法减少了代码。然而，他们解决了难题，一个初级程序员编写了大量的*垃圾代码*看起来不错。

另一个使用指标的例子是非常流行的[Ohloh](http://en.wikipedia.org/wiki/Ohloh)。他们使用指标为开源项目贴上价格标签（使用行数等），这本身就是一种*有缺陷*的尝试——正如你可以想象的那样。

说了这么多，维基百科条目提供了一些关于该主题的整体见解，很抱歉没有用一个非常棒的网站或书籍以更支持的方式回答你的问题，但我敢打赌你明白我不是一个超级粉丝。:)

可以用来帮助您改进的方法是持续集成并在代码、文档等方面遵守某种标准。这就是你可以改进的方法。指标只是会议的糖果——“看起来我们已经编码了那么多”。

**更新**

好的，我的观点是传出耦合甚至圈复杂度都可能表明有问题——但不一定是错的。它可以作为重构类的指标，但没有经验法则可以告诉您何时重构。

恕我直言，500 多行代码、重构或[DRY 主体](http://en.wikipedia.org/wiki/Don%27t_repeat_yourself)等规则在大多数情况下更适用。有时就这么简单。

我给了你这么多，因为圈复杂度被绘制成流程图，它可以让你大开眼界。但同样，请谨慎使用。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-12-15T05:27:22.300

在我看来，指标是在代码库中找到痛点的好方法。它们对于向您的经理展示为什么您应该花时间改进它也非常有用。

这是我写的一篇文章：http: [//blog.jorgef.net/2011/12/metrics-in-brownfield-applications.html](http://blog.jorgef.net/2011/12/metrics-in-brownfield-applications.html)

我希望它有帮助

# css - 是否有任何干净的 CSS 方法可以使单词中的每个字母具有不同的颜色？

> ID：155584
> 
> 赞同：10
> 
> 时间：2008-09-30T23:29:45.737
> 
> 标签：css, colors

我需要一种方法来让单词的每个字母旋转 3 种不同的颜色。我知道一些不太干净的方法可以用 asp.NET 做到这一点，但我想知道是否可能有一个更干净的 CSS/JavaScript 解决方案，它对搜索引擎更友好。

设计器为每个页面都包含[一个这样的文件。](http://stlartworks.efficionconsulting.com/Portals/6/Skins/ArtWorks/img/ProgramsHeading.png)我宁愿不必为每个页面手动生成图像，因为这使得非技术站点编辑器很难添加页面和更改页面名称。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-10-02T19:30:21.583

这是一些JavaScript。

```
var message = "The quick brown fox.";
var colors = new Array("#ff0000","#00ff00","#0000ff"); // red, green, blue

for (var i = 0; i < message.length; i++){
  document.write("<span style=\"color:" + colors[(i % colors.length)] + ";\">" + message[i] + "</span>");
}
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-09-30T23:35:49.513

在服务器端，您可以轻松地做到这一点，而无需烦人的搜索引擎 AFAIK。

```
// This server-side code example is in JavaScript because that's
// what I know best.
var words = split(message, " ");
var c = 1;
for(var i = 0; i < words.length; i++) {
   print("<span class=\"color" + c + "\">" + words[i] + "</span> ");
   c = c + 1; if (c > 3) c = 1;
} 
```

如果您真的想要简单的内联 HTML 代码，请编写客户端 Javascript 以从给定的 P 或 DIV 或基于其 ID 的任何内容中检索消息，拆分它，如上重新编码，并替换 P 或 DIV 的“innerHTML”属性。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-10-01T12:59:25.103

仅使用 CSS 肯定没有解决方案，因为 CSS 选择器使您无法访问单个字母（除了`:first-letter`）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-02T18:58:10.973

> 我宁愿不必为每个页面手动生成图像

然后自动生成图像。

您没有指定您正在使用哪种服务器端技术，但任何好的技术都可以让您操作图像（或至少调用外部图像实用程序）

所以非技术用户只需要做这样的事情：

```
<img src="images/redblueyellow.cfm/programs.png" alt="programs"/> 
```

然后 redblueyellow.cfm 脚本将使用现有的programs.png 或根据需要生成具有多种颜色的新图像。

如果您愿意，我可以提供示例 CFML 或伪代码来执行此操作？

# c# - 是否有将源代码转回 CodeCompileUnit 的现有方法？

> ID：155586
> 
> 赞同：6
> 
> 时间：2008-09-30T23:30:38.747
> 
> 标签：c#, winforms, serialization, code-generation, designer

我们在我们自己的设计师中使用了 DesignSurface 和所有优秀的 IDesignerHost。然后将设计的表格以我们自己的定制格式保留，一切都很好。我们还希望将表单导出为基于文本的格式（我们已经这样做了，因为它并不难）。

但是，我们还希望将该文本导入设计器的文档中，这涉及将设计器代码返回到 CodeCompileUnit。不幸的是， Parse 方法没有实现（毫无疑问，有充分的理由）。有替代方案吗？我们不想使用标准 .NET 安装中不存在的任何东西（例如随 Visual Studio 安装的 .NET 库）。

我目前的想法是编译导入的文本，然后实例化表单并将其属性和控件复制到设计表面对象，然后捕获新的 CodeCompileUnit，但我希望有更好的方法。谢谢。

* * *

更新：我虽然有些人可能对我们的进展感兴趣。到目前为止，不太好。我发现的简要概述是 Parse 方法没有实现，因为它被认为太难了，存在可以完成工作的开源解析器，但它们并不完整，因此不能保证在所有情况下都能正常工作（ NRefactory 是 SharpDevelop 项目中的一个，我相信），并且从实例到设计器的控件复制目前还没有工作。我相信这是因为尽管控件被添加到设计器表面包装的表单实例中，但设计器表面并没有意识到它们的包含。我们的下一个尝试是模拟剪切/粘贴，看看是否能解决它。显然，这是一个巨大的讨厌的解决方法，但我们需要它工作，所以我们'

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-11T14:39:34.947

这并不完全符合您的要求，但您可以尝试使用 CodeDomComponentSerializationService 类根据设计图面的当前状态生成 CodeDom 图。

我们使用该类在我们的内置设计器中处理复制/粘贴功能。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-30T23:25:06.017

您总是可以编写自己的 C# 解析器。这样你就可以确定它的完整性。

在您的情况下，因为您不需要诸如智能感知之类的东西，所以您可能只使用解析器生成器就可以逃脱。

但是，即使您手写一个，也可能不会花费您超过一个月的时间。

# asp.net - 如何确定 ASP.NET 站点 (IIS) 上的用户数？他们的信息呢？

> ID：155593
> 
> 赞同：18
> 
> 时间：2008-09-30T23:35:01.543
> 
> 标签：asp.net, iis, session, iis-7, iis-6

有没有办法确定在 ASP.NET 应用程序中具有活动会话的用户数？我在特定应用程序中有一个管理/工具页面，我想显示有关所有打开会话的信息，例如会话数，也许还有请求机器的地址，或每个用户的其他凭据信息。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-03-18T20:03:11.420

## 在 global.aspx 中

```
void Application_Start(object sender, EventArgs e)
{
    // Code that runs on application startup
    Application["OnlineUsers"] = 0;
}

void Session_Start(object sender, EventArgs e)
{
    // Code that runs when a new session is started
    Application.Lock();
    Application["OnlineUsers"] = (int)Application["OnlineUsers"] + 1;
    Application.UnLock();
}

void Session_End(object sender, EventArgs e)
{
    // Code that runs when a session ends. 
    // Note: The Session_End event is raised only when the sessionstate 
    // mode is set to InProc in the Web.config file. 
    // If session mode is set to StateServer or SQLServer, 
    // the event is not raised.
    Application.Lock();
    Application["OnlineUsers"] = (int)Application["OnlineUsers"] - 1;
    Application.UnLock();
} 
```

**注意：** Application.Lock 和 Application.Unlock 方法用于防止多个线程同时更改此变量。

## 在 Web.config 中

验证 SessionState 是否为“InProc”以使其正常工作

```
 <system.web>
        <sessionState mode="InProc" cookieless="false" timeout="20" />
    </system.web> 
```

## 在您的 .aspx 文件中

```
Visitors online: <%= Application["OnlineUsers"].ToString() %> 
```

**注意：**代码最初复制自~~[http://www.aspdotnetfaq.com/Faq/How-to-show-number-of-online-users-visitors-for-ASP-NET-website.aspx](http://www.aspdotnetfaq.com/Faq/How-to-show-number-of-online-users-visitors-for-ASP-NET-website.aspx)~~（链接不再有效）

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-09-30T23:50:04.113

[ASP.NET 性能计数器](http://technet.microsoft.com/en-us/library/cc775901.aspx)，如 State Server Sessions Active（活动用户会话的数量）应该可以帮助您。然后你可以从你的管理页面[读取并显示性能计数器](http://www.developer.com/net/net/article.php/11087_3356561_1)..

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-18T20:13:45.717

如果您使用.net Membership，您可以使用

```
Membership.GetNumberOfUsersOnline() 
```

有关它的更多信息：http: [//msdn.microsoft.com/en-us/library/system.web.security.membership.getnumberofusersonline.aspx](http://msdn.microsoft.com/en-us/library/system.web.security.membership.getnumberofusersonline.aspx)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-29T08:48:01.377

如果您想自己实现相同的机制，您可以定义为 CurrentUserManager 类并在此处实现单例模式。CurrentUserManager 类的这个单例对象在 AppDomain 中是唯一的。在此类中，您将创建一次它的自身实例，并且您将通过隐藏其构造函数来禁止其他人创建此类的新实例。每当请求到达此对象时，该单个实例都会给出响应。因此，如果您实现一个保存每个用户记录的列表（当用户进来时，您将他添加到列表中；当他出去时，您将他从列表中删除）。最后，如果您想要当前用户数，您可以只向这个单例对象询问列表数。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2018-06-25T04:33:56.980

如果您使用 sql server 作为会话状态提供程序，您可以使用此代码来计算在线用户数：

```
SELECT Count(*) As Onlines FROM ASPStateTempSessions WHERE Expires>getutcdate() 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-30T23:44:40.990

我过去看到的方法是在 Global.asax 文件中的 Session_OnStart 事件中添加额外的代码，以与会话无关的方式存储信息，例如数据库或 HttpApplicationState 对象。根据您的需要，您还可以使用 Session_OnEnd 删除此信息。

您可能希望使用 Application_Start 和 Application_End 事件来初始化和清理其中的一些信息。

然后管理页面可以读取此信息并显示统计信息等。

[这在http://msdn.microsoft.com/en-us/library/ms178594.aspx](http://msdn.microsoft.com/en-us/library/ms178594.aspx)和[http://msdn.microsoft.com/en-us/library/ms178581.aspx](http://msdn.microsoft.com/en-us/library/ms178581.aspx)有更深入的解释。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2013-09-23T13:24:20.927

您可以使用 PerformanceCounter 从 System.Diagnostics 命名空间获取数据。它允许您获得“会话活跃”等等。它允许您从本地服务器和远程服务器获取。

这是如何在本地计算机上执行此操作的示例

```
void Main()
{
    var pc = new PerformanceCounter("ASP.NET Applications", "Sessions Active", "__Total__");

    Console.WriteLine(pc.NextValue());
} 
```

或者对于远程服务器，你会这样做：

```
void Main()
{
    var pc = new PerformanceCounter("ASP.NET Applications", "Sessions Active", "__Total__", "ServerHostName.domain");

    Console.WriteLine(pc.NextValue());
} 
```

[ASP.NET 的性能计数器](http://msdn.microsoft.com/en-us/library/fxk122b4.aspx)提供了可以监视的 ASP.NET 计数器的完整列表

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2017-05-08T11:30:01.760

Google Analytics 附带一个 API，可以在您的 ASP.NET MVC 应用程序上实现。它具有实时功能，因此可以跟踪您网站上的当前用户数量并将其返回到您的应用程序。

[这里有一些信息](http://biasecurities.com/2012/02/using-the-google-analytics-api-with-asp-net-mvc/)

# language-agnostic - 文件 I/O 对 Web 开发的性能影响有多大？

> ID：155599
> 
> 赞同：2
> 
> 时间：2008-09-30T23:36:42.397
> 
> 标签：language-agnostic, file-io

我知道，只要在服务器端生成页面，数据库始终是帐篷中的长杆。

但是在 Web 服务器上也有很多文件 i/o 正在进行。脚本代码充满了 include/require 语句。此外，通常将模板化的 html 存储在应用程序外部的文件中，这些文件会相应地加载和填充。

当涉及到 Web 开发时，文件 i/o 起多大作用？它会成为一个问题吗？什么时候过分？Web 服务器/语言是否缓存任何内容？

它在你的经历中真的很重要吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-30T23:46:13.980

10 年前，磁盘比处理器快得多，以至于您不必担心太多。在磁盘成为问题之前，您会用完 CPU（或使 NIC 饱和）。如今，CPU 和千兆网卡可能会使磁盘成为瓶颈，**但是**......

大多数非数据库磁盘使用都很容易并行化。如果您没有将托管架构设计为通过添加更多系统来横向扩展，那么这比微调磁盘访问更重要。

如果您设计为水平扩展，通常只购买更多服务器比试图弄清楚如何优化磁盘便宜。更不用说，用于模板的 SSD 甚至 RAM 磁盘之类的东西都不会成为问题。

很少有一个服务架构可以水平扩展，流行到足以引起可扩展性问题，但利润不足以在您的机架中再买一个 1u。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-30T23:48:07.360

只有当您与外界的带宽与磁盘带宽相似时，文件 I/O 才会成为一个因素（对于静态内容和静态页面包括）。这意味着您的连接速度非常快，正在快速 LAN 上提供内容，或者磁盘非常慢（或者存在大量磁盘争用）。所以很可能答案是否定的。

当然，这假设您不是仅为文件的一小部分加载大文件。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-01T00:01:37.283

文件 I/O 是可能影响 Web 应用程序性能的众多因素之一，包括带宽、网络连接、内存等。确定文件 I/O 是否导致您出现任何问题的最有效方法是在服务器上运行一些分析，看看这是否是您性能的限制因素。

这在很大程度上取决于您从磁盘加载的文件类型，许多小文件与一些大文件具有非常不同的属性。Web 服务器可以缓存文件，既可以在内存内部缓存，也可以向客户端指示可以缓存文件（例如图像），因此不需要每次都请求。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-01T00:44:39.567

不要过早优化。它的邪恶，或者什么。

但是，I/O 是您在计算机上可以做的最慢的事情。尽量保持在最低限度，但不要让 Knuth 看到你在做什么。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2008-09-30T23:42:43.100

我想说，只有在您提供大量静态内容时，文件 IO 速度才会成为问题。当您处理数据并执行代码以呈现页面时，从磁盘读取页面本身的时间可以忽略不计。在您提供的静态文件无法放入内存的情况下，文件 I/O 很重要，例如在提供视频或图像文件时。它也可能发生在 html 文件中，但由于 html 文件的大小很小，所以这种可能性较小。

# rdf - 了解 RDF / OWL 的最佳方式是什么？

> ID：155601
> 
> 赞同：23
> 
> 时间：2008-09-30T23:41:53.117
> 
> 标签：rdf, web-standards, semantic-web, owl

哪些参考资料为使用 RDF/OWL 提供了很好的总结/教程？似乎有足够多的工具（Protege、Topbraid、Jena 等）不需要了解标记语言的语法，但了解这些概念当然仍然至关重要。

我正在研究 w3c 文档（尤其是[RDF Primer](http://www.w3.org/TR/rdf-primer/)），但我也想找到其他资源/技术来使用。

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2008-10-01T00:12:30.923

与面向对象的语言相比，语义 Web 的一个很好的介绍是 W3C 的这份文档：[面向对象软件开发人员的语义 Web 入门](http://www.w3.org/TR/sw-oosd-primer/)。它帮助我从一开始就澄清了很多事情。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-09-30T23:43:28.480

*   对于 RDF 的实际使用，Shelley Power 的书*[Practical RDF](https://rads.stackoverflow.com/amzn/click/com/0596002637)*是一个好的开始。
*   [ESW Wiki](http://esw.w3.org/topic/FrontPage)也是一个很好的资源
*   还有[David Beckett 的 RDF 资源指南](https://rads.stackoverflow.com/amzn/click/com/0596002637)
*   [蒂姆·伯纳斯-李的笔记](http://www.w3.org/DesignIssues/)总是很好读
*   从semantic-web@w3.org 邮件列表档案中有[一堆链接](http://lists.w3.org/Archives/Public/semantic-web/2005Oct/0251.html)

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-10-01T00:12:23.590

我发现尝试使用 SPARQL 是掌握 RDF 的一种非常有用的方法。阅读它很棒，但是尝试建模一些东西并查询其他人的模型使它对我来说“点击”。

更多资源：

*   [Planet RDF](http://planetrdf.com/index.rdf)（rss 聚合了几个 rdf/semweb 博客）通常提供丰富的信息
*   [如果您有脚本背景， Arc](http://arc.semsol.org/)（用于 PHP 的 rdf/sparql 库）非常棒且易于上手
*   [Semantic Web for the Working Ontologist](https://rads.stackoverflow.com/amzn/click/com/0123735564)（书）包含大量实际示例，激发了对 RDF、RDFS 和 OWL 的需求，并且（在我看来）可读性非常好。
*   许多库的教程也是很好的资源

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-07-14T08:57:26.370

如果您想了解如何使用 OWL 构建本体，那么[本书](http://protegewiki.stanford.edu/wiki/Protege4Pizzas10Minutes)中的披萨本体教程是一个不错的起点。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-12-27T14:52:44.070

从 2008年11 月上旬开始[，Jim Hendler 接受了软件工程电台采访](http://www.se-radio.net/episode-116-the-semantic-web-with-jim-hendler/)，讨论了该领域的最新技术。他的书[《工作本体论的语义网：RDFS 和 OWL 中的有效建模](https://rads.stackoverflow.com/amzn/click/com/0123735564)》因其对该领域的实际覆盖而获得了高分。

从那次采访中寻找链接让我找到了[Protege](http://protege.stanford.edu/)，这是斯坦福大学的一个活跃的开源项目。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2013-10-20T03:50:29.677

不久前我发布了一系列内容丰富的文章和教程，这可能会有所帮助。该系列从非常基本的概念开始并逐步构建。

**[语义网视觉和技术简介 - 第 1 部分 - 概述](http://www.semanticfocus.com/blog/entry/title/introduction-to-the-semantic-web-vision-and-technologies-part-1-overview/)** 这是专门为帮助您了解语义网视觉和技术而编写的系列文章中的第一篇。在这一部分中，我们介绍了 Tim Berners-Lee 提出的语义 Web 愿景。我们还查看了著名的层蛋糕图，该图说明了使之成为可能的关键技术。

**[第 2 部分 - 基础](http://www.semanticfocus.com/blog/entry/title/introduction-to-the-semantic-web-vision-and-technologies-part-2-foundations/)** 在这一部分中，我们将围绕层蛋糕的底部进行一些关于 Unicode、URI 和 XML 的要点——这三种基础技术渗透到现有的 Web 中，并且与新兴的语义 Web 尤其相关。

**[第 3 部分 - 资源描述框架](http://www.semanticfocus.com/blog/entry/title/introduction-to-the-semantic-web-vision-and-technologies-part-3-the-resource-description-framework/)** 我们使用 Unicode、URI 和 XML，因为我们在对资源描述框架 (RDF) 的回顾中对语义 Web 层蛋糕进行下一步的研究。同时，我们使用可视化 RDF/OWL 编辑器 Altova SemanticWorks 进行试驾。

**[第 4 部分 - Protégé 101（截屏教程）](http://www.semanticfocus.com/blog/entry/title/introduction-to-semantic-web-vision-and-technologies-part-4-protege-101-screencast)** 我们达到了本系列中的一个重要里程碑 - 跨越了熟悉的技术（如 XML、Unicode、URI 和 RDF）与 Web 本体语言 (OWL) 之间的巨大鸿沟。这是事情真正开始变得有趣的地方。（对不起，烦人的点击声。）

**[第 5 部分 - 使用 Protege 4 构建 OWL 本体（截屏教程）](http://www.semanticfocus.com/blog/entry/title/introduction-to-semantic-web-vision-and-technologies-part-5-building-owl-ontologies-using-protege-4-screencast/)** 我们仍在使用 Protege，但这次使用的是新的 ALPHA 版本并更深入地了解概念。

很抱歉没有完成这个系列到一个好的结局，但我被猛烈抨击了。最近，我写了几篇关于关联数据方面的文章。尽管不是专门针对 RDF/OWL，但它们是高度相关的，并且可能对那些对 RDF/OWL 感兴趣的人也很感兴趣。从最近到最后的顺序：

*   **[看一看 SPARQL – 用于语义 Web 的 SQL](http://codyburleson.com/2013/10/03/inroducing-sparql-sql-for-the-semantic-web/)**
*   **[关联数据——企业的发展方向](http://codyburleson.com/2013/07/15/linked-data-where-the-enterprise-is-going/)**
*   **[软件开发生命周期中的关联数据](http://codyburleson.com/2013/07/10/linked-data-in-the-software-development-lifecycle/)**
*   **[W3C 的关联数据平台旨在重构 Web](http://codyburleson.com/2013/06/22/w3c-ldp-reframing-the-web/)**
*   **[正如网络之父所说，网络的下一步是什么](http://codyburleson.com/2013/01/03/whats-next-for-the-web/)**

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-10-24T13:32:52.050

对于 OWL，请查看 OWL 2 规范，例如以下文档，其中也提供了很多示例。

*   [http://www.w3.org/TR/owl2-syntax/](http://www.w3.org/TR/owl2-syntax/)
*   [http://www.w3.org/TR/owl2-primer/](http://www.w3.org/TR/owl2-primer/)

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-01-13T16:21:34.847

Bob DuCharme 的博客文章，使用 Pellet 添加元数据值，是开始 OWL 的一个不错的实用起点：[http ://www.snee.com/bobdc.blog/2008/12/adding-metadata-value-with-pel.html](http://www.snee.com/bobdc.blog/2008/12/adding-metadata-value-with-pel.html)

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-12-27T16:39:30.797

这是一个关于语义网的精彩视频：http: //vimeo.com/1062481?pg=embed&sec= [1062481](http://vimeo.com/1062481?pg=embed&sec=1062481)

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2013-06-28T13:13:32.157

我发现linkeddatatools 教程很容易理解基础知识。

[http://www.linkeddatatools.com/semantic-web-basics](http://www.linkeddatatools.com/semantic-web-basics)

# exchange-server - 如果禁用 IMAP，是否可以将 Mac Mail 与 MS Exchange 一起使用

> ID：155603
> 
> 赞同：0
> 
> 时间：2008-09-30T23:42:44.863
> 
> 标签：exchange-server, apple-mail

我们的网络管理员为我们的交换服务器禁用了 IMAP 和 POP，但启用了 RDP over HTTP。Mac Mail 是否仅使用 IMAP 与 Exchange 服务器进行通信，或者它是否也知道如何使用 RDP over HTTP？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-30T23:47:07.893

不。据我所知，Mac 邮件使用 IMAP 发送邮件并使用 HTTP 获取日历数据。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-01T00:02:09.387

不。Mail.app 支持 IMAP 和 POP，但还没有 RDP over HTTP。

# oop - 方法和函数有什么区别？

> ID：155609
> 
> 赞同：2020
> 
> 时间：2008-09-30T23:45:10.007
> 
> 标签：oop, language-agnostic, terminology

有人可以在 OOP 上下文中提供**方法**与**函数**的简单解释吗？

* * *

## 回答 #1

> 赞同：2108
> 
> 时间：2008-10-01T00:00:13.977

**函数**是一段按名称调用的代码。它可以传递数据进行操作（即参数），也可以选择返回数据（返回值）。传递给函数的所有数据都是显式传递的。

方法是一段由与对象关联的名称调用的代码**。**在大多数方面，它与函数相同，除了两个关键区别：

1.  方法被隐式传递给调用它的对象。
2.  方法能够对包含在类中的数据进行操作（请记住，对象是类的实例——类是定义，对象是该数据的实例）。

（这是一个简化的解释，忽略了[范围](http://en.wikipedia.org/wiki/Scope_(computer_science))等问题。）

* * *

## 回答 #2

> 赞同：1074
> 
> 时间：2008-09-30T23:51:53.500

方法在对象上或在类中是静态的。
函数独立于任何对象（并且在任何类之外）。

对于 Java 和 C#，只有方法。
对于 C，只有函数。

对于 C++ 和 Python，这取决于你是否在课堂上。
但在基础英语中：

*   **功能**：独立的特性或功能。
*   **方法**：做某事的一种方式，它有不同的方法或方法，但与同一方面（又名类）相关。

* * *

## 回答 #3

> 赞同：296
> 
> 时间：2008-09-30T23:48:11.307

**'method'是****'function'**的面向对象的词。这几乎就是它的全部内容（即，没有真正的区别）。

不幸的是，我认为这里的很多答案都在延续或推进存在一些复杂、有意义的差异的想法。

真的 - 没有那么多，只是对同一件事有不同的说法。

[后期补充]

* * *

事实上，正如[Brian Neal在对](https://stackoverflow.com/users/63485/brian-neal)[这个问题](https://stackoverflow.com/questions/840522/given-a-pointer-to-a-c-object-what-is-the-preferred-way-to-call-a-static-membe)的评论中指出的那样，C++ 标准在提及成员函数时从不使用术语“方法”。有些人可能会认为这表明 C++ 并不是真正的面向对象语言。但是，我更愿意将其视为一个非常聪明的群体认为没有特别充分的理由使用不同术语的迹象。

* * *

## 回答 #4

> 赞同：120
> 
> 时间：2008-10-01T00:33:40.793

一般来说：方法是属于一个类的函数，函数可以在代码的任何其他范围内，因此您可以声明所有方法都是函数，但并非所有函数都是方法：

以以下 python 示例为例：

```
class Door:
  def open(self):
    print 'hello stranger'

def knock_door:
  a_door = Door()
  Door.open(a_door)

knock_door() 
```

给出的示例向您展示了一个名为“Door”的类，它有一个名为“open”的方法或动作，它被称为方法，因为它是在一个类中声明的。代码的另一部分“def”就在下面，它定义了一个函数，它是一个函数，因为它没有在类中声明，这个函数调用我们在类中定义的方法，如你所见，最后这个函数被自己调用。

如您所见，您可以在任何地方调用函数，但是如果要调用方法，则必须传递与声明该方法的类相同类型的新对象（Class.method（object）），或者必须调用对象内部的方法（object.Method()），至少在python中。

将方法视为只有一个实体可以做的事情，所以如果你有一个 Dog 类，那么只在该类内部有一个 bark 函数是有意义的，这将是一个方法，如果你还有一个 Person 类，它可能是有意义的为它写一个不属于任何类的函数“feed”，因为人类和狗都可以被喂食，你可以称它为一个函数，因为它不属于任何特定的类。

* * *

## 回答 #5

> 赞同：94
> 
> 时间：2017-10-08T00:07:41.743

简单的记忆方法：

*   **功能**→**免费**（免费意味着它可以在任何地方，无需在对象或类中）
*   **方法 → **M** **ember**（对象或类的成员）**

 *** * *

## 回答 #6

> 赞同：51
> 
> 时间：2014-10-28T23:08:20.610

**Function**和**Method**之间主要区别的一个非常笼统的定义：

> 函数是在类之外定义的，而方法是在类内部和类的一部分中定义的。

* * *

## 回答 #7

> 赞同：37
> 
> 时间：2008-10-01T00:21:08.110

如果您想在这里阅读“我的 OO 方法介绍”

面向对象范式背后的想法是“威胁”软件由......以及“对象”组成。现实世界中的对象具有属性，例如，如果您有一个员工，该员工有一个姓名、一个员工 ID、一个职位、他属于一个部门等等。

对象也知道如何处理它的属性并对它们执行一些操作。假设我们想知道员工现在在做什么，我们会问他。

```
employe whatAreYouDoing. 
```

“whatAreYouDoing”是发送给对象的“消息”。对象知道如何回答这些问题，据说它有解决问题的“方法”。

因此，对象必须公开其行为的方式称为方法。因此，方法是工件对象必须“做”某事。

其他可能的方法是

```
employee whatIsYourName
employee whatIsYourDepartmentsName 
```

等等

另一方面，函数是编程语言必须计算某些数据的方式，例如，您可能拥有返回 16 的函数 addValues( 8 , 8 )

```
// pseudo-code
function addValues( int x, int y )  return x + y 
// call it 
result = addValues( 8,8 )
print result // output is 16... 
```

由于第一个流行的编程语言（例如 fortran、c、pascal）没有涵盖 OO 范式，它们只调用这些工件“函数”。

例如，C 中的前一个函数是：

```
int addValues( int x, int y ) 
{
   return x + y;
} 
```

说一个对象具有执行某些操作的“函数”是不“自然的”，因为函数与数学内容更相关，而 Employee 几乎没有数学知识，但是您可以拥有与函数完全相同的方法，例如在 Java 中，这将是等效的 addValues 函数。

```
public static int addValues( int x, int y ) {
    return x + y;
} 
```

看起来很熟悉？那是因为 Java 的根源在于 C++，而 C++ 源于 C。

最后只是一个概念，在实现中它们可能看起来相同，但在 OO 文档中这些被称为方法。

这是 Java 中以前的 Employee 对象的示例。

```
public class Employee {

    Department department;
    String name;

    public String whatsYourName(){
        return this.name;
    }
    public String whatsYourDeparmentsName(){
         return this.department.name();
    }
    public String whatAreYouDoing(){
        return "nothing";
    } 
    // Ignore the following, only set here for completness
    public Employee( String name ) {
        this.name = name;
    }

}

// Usage sample.
Employee employee = new Employee( "John" ); // Creates an employee called John

// If I want to display what is this employee doing I could use its methods.
// to know it.
String name = employee.whatIsYourName():
String doingWhat = employee.whatAreYouDoint();

// Print the info to the console.

 System.out.printf("Employee %s is doing: %s", name, doingWhat );

Output:
Employee John is doing nothing. 
```

那么，区别在于应用它的“域”。

AppleScript 有“自然语言”matphor 的想法，在某些时候 OO 有。例如 Smalltalk。我希望在阅读本文后，您可以更容易地理解对象中的方法。

注意：代码不编译，仅作为示例。随意修改帖子并添加 Python 示例。

* * *

## 回答 #8

> 赞同：22
> 
> 时间：2008-09-30T23:56:16.937

在 OO 世界中，这两者通常用于表示同一事物。

从纯数学和 CS 的角度来看，当使用相同的参数 ( f(x,y) = (x + y) ) 调用时，函数将始终返回相同的结果。另一方面，方法通常与类的实例相关联。尽管如此，大多数现代 OO 语言在大多数情况下不再使用术语“函数”。许多静态方法可能与函数非常相似，因为它们通常没有状态（并非总是如此）。

* * *

## 回答 #9

> 赞同：20
> 
> 时间：2008-09-30T23:55:13.867

假设一个函数是一段代码（通常有自己的作用域，有时也有自己的闭包），它可以接收一些参数，也可以返回一个结果。

方法是一个对象拥有的函数（在一些面向对象的系统中，更正确的说法是它由一个类拥有）。被对象/类“拥有”意味着您通过对象/类引用方法；例如，在 Java 中，如果要调用对象“door”拥有的方法“open()”，则需要编写“door.open()”。

通常方法还会获得一些额外的属性来描述它们在对象/类中的行为，例如：可见性（与面向对象的封装概念相关），它定义了可以从哪些对象（或类）调用方法。

在许多面向对象的语言中，所有“函数”都属于某个对象（或类），因此在这些语言中没有不是方法的函数。

* * *

## 回答 #10

> 赞同：18
> 
> 时间：2008-09-30T23:52:13.390

方法是类的函数。用普通的术语来说，人们到处交换方法和功能。基本上您可以将它们视为同一事物（不确定全局函数是否称为方法）。

[http://en.wikipedia.org/wiki/Method_(computer_science)](http://en.wikipedia.org/wiki/Method_(computer_science))

* * *

## 回答 #11

> 赞同：16
> 
> 时间：2008-10-01T00:54:03.583

函数是一个数学概念。例如：

```
f(x,y) = sin(x) + cos(y) 
```

表示函数 f() 将返回第一个参数的 sin 添加到第二个参数的余弦。这只是数学。碰巧 sin() 和 cos() 也是函数。函数还有另一个属性：对具有相同参数的函数的所有调用都应该返回相同的结果。

另一方面，方法是与面向对象语言中的对象相关的函数。它有一个隐含的参数：被操作的对象（以及它的状态）。

因此，如果您有一个带有方法 g(x) 的对象 Z，您可能会看到以下内容：

```
Z.g(x) = sin(x) + cos(Z.y) 
```

在这种情况下，参数 x 被传入，与前面的函数示例相同。但是，cos() 的参数是存在于对象 Z 内部的值。Z 和存在于其中的数据 (Zy) 是 Z 的 g() 方法的隐式参数。

* * *

## 回答 #12

> 赞同：16
> 
> 时间：2016-01-12T02:13:19.637

从历史上看，“方法”是不返回值的东西，而“函数”是返回值的东西，这可能存在细微差别。每种语言都有自己的具有特殊含义**的术语词典。**

在**“C”**中，**“函数”**一词表示**程序例程**。

在**Java**中，术语**“函数”**没有任何特殊含义。而**“方法”**是指形成类实现的例程之一。

在**C#**中，这将翻译为：

```
public void DoSomething() {} // method
public int DoSomethingAndReturnMeANumber(){} // function 
```

但实际上，我重申这两个概念确实没有区别。如果您在有关 Java 的非正式讨论中使用术语“函数”，人们会认为您的意思是“方法”并继续。不要在有关 Java 的适当文档或演示文稿中使用它，否则你会看起来很傻。

* * *

## 回答 #13

> 赞同：14
> 
> 时间：2014-02-06T05:03:18.387

函数或方法是一段命名的可调用代码，它执行一些操作并可选地返回一个值。

在**C**语言中，使用术语函数。**Java**和**C#**人们会说它是一种方法（在这种情况下，函数是在类/对象中定义的）。

C **++**程序员可能将其称为函数或有时方法（取决于他们是否正在编写过程风格的 C++ 代码或正在执行 C++ 的面向对象方式，只有 C/C++ 的程序员也可能将其称为函数，因为术语“方法”是在 C/C++ 文献中较少使用）。

您只需调用函数的名称即可使用函数，

```
result = mySum(num1, num2); 
```

您可以通过首先引用其对象来调用方法，例如，

```
result = MyCalc.mySum(num1,num2); 
```

* * *

## 回答 #14

> 赞同：13
> 
> 时间：2008-12-03T09:47:08.277

函数是一组可用于操作数据的逻辑。

而Method是用于操作其所属对象的数据的函数。所以从技术上讲，如果你有一个与你的类不完全相关但在类中声明的函数，它不是方法；这被称为糟糕的设计。

* * *

## 回答 #15

> 赞同：11
> 
> 时间：2008-09-30T23:59:25.790

在诸如 Object Pascal 或 C++ 之类的 OO 语言中，“方法”是与对象关联的函数。因此，例如，“Dog”对象可能具有“bark”功能，这将被视为“Method”。相反，“StrLen”函数是独立的（它提供作为参数提供的字符串的长度）。因此它*只是*一个“功能”。Javascript 在技术上也是面向对象的，但与 C++、C# 或 Pascal 等成熟语言相比，它面临许多限制。尽管如此，这种区别应该仍然存在。

一些额外的事实：C# 完全面向对象，因此您不能创建独立的“函数”。在 C# 中，每个函数都绑定到一个对象，因此从技术上讲，它是一个“方法”。关键是 C# 中很少有人将它们称为“方法”——他们只是使用术语“函数”，因为没有任何真正的区别。

最后——所以任何 Pascal 大师都不会在这里跳到我身上——Pascal 还区分了“函数”（返回值）和“过程”，后者没有。尽管您当然可以选择是否返回值，但 C# 并没有明确地做出这种区分。

* * *

## 回答 #16

> 赞同：10
> 
> 时间：2008-09-30T23:57:38.587

类上的方法作用于类的实例，称为对象。

```
class Example
{
   public int data = 0; // Each instance of Example holds its internal data. This is a "field", or "member variable".

   public void UpdateData() // .. and manipulates it (This is a method by the way)
   {
      data = data + 1;
   }

   public void PrintData() // This is also a method
   {
      Console.WriteLine(data);
   }
}

class Program
{
   public static void Main()
   {
       Example exampleObject1 = new Example();
       Example exampleObject2 = new Example();

       exampleObject1.UpdateData();
       exampleObject1.UpdateData();

       exampleObject2.UpdateData();

       exampleObject1.PrintData(); // Prints "2"
       exampleObject2.PrintData(); // Prints "1"
   }
} 
```

* * *

## 回答 #17

> 赞同：10
> 
> 时间：2008-10-01T01:20:03.817

既然您提到了 Python，以下可能是大多数现代面向对象语言中方法和对象之间关系的有用说明。简而言之，他们所谓的“方法”只是一个传递额外参数的函数（正如其他答案所指出的那样），但 Python 比大多数语言更明确。

```
# perfectly normal function
def hello(greetee):
  print "Hello", greetee

# generalise a bit (still a function though)
def greet(greeting, greetee):
  print greeting, greetee

# hide the greeting behind a layer of abstraction (still a function!)
def greet_with_greeter(greeter, greetee):
  print greeter.greeting, greetee

# very simple class we can pass to greet_with_greeter
class Greeter(object):
  def __init__(self, greeting):
    self.greeting = greeting

  # while we're at it, here's a method that uses self.greeting...
  def greet(self, greetee):
    print self.greeting, greetee

# save an object of class Greeter for later
hello_greeter = Greeter("Hello")

# now all of the following print the same message
hello("World")
greet("Hello", "World")
greet_with_greeter(hello_greeter, "World")
hello_greeter.greet("World") 
```

现在比较函数`greet_with_greeter`和方法`greet`：唯一的区别是第一个参数的名称（在函数中我称之为“greeter”，在方法中我称之为“self”）。所以我可以以`greet`与使用函数完全相同的方式使用该`greet_with_greeter`方法（使用“点”语法来获取它，因为我在一个类中定义了它）：

```
Greeter.greet(hello_greeter, "World") 
```

所以我有效地将一个方法变成了一个函数。我可以把一个函数变成一个方法吗？好吧，因为 Python 让你在定义类之后搞乱它们，让我们试试：

```
Greeter.greet2 = greet_with_greeter
hello_greeter.greet2("World") 
```

是的，该函数`greet_with_greeter`现在也称为方法`greet2`。这显示了方法和函数之间唯一真正的区别：当您通过调用“在”对象上调用方法时`object.method(args)`，语言会神奇地将其转换为`method(object, args)`.

（OO 纯粹主义者可能会争辩说方法与函数不同，如果您进入高级 Python 或 Ruby - 或 Smalltalk！ - 您将开始明白他们的观点。此外，有些语言为方法提供对对象的位的特殊访问。但是主要的概念差异仍然是隐藏的额外参数。）

* * *

## 回答 #18

> 赞同：9
> 
> 时间：2012-04-13T09:50:07.257

对我来说：如果我同意，方法和函数的功能是相同的：

*   一个函数可以返回一个值
*   可能期望参数

就像任何一段代码一样，你可能有你放入的对象，你可能有一个对象作为结果。在这样做的过程中，他们可能会改变对象的状态，但这不会改变他们对我的基本功能。

在调用对象或其他代码的函数时可能存在定义差异。但这不就是语言上的区别，这就是人们交换它们的原因吗？我会小心提到的计算示例。因为我雇了员工来做我的计算：

```
new Employer().calculateSum( 8, 8 ); 
```

通过这样做，我可以依靠负责计算的雇主。如果他想要更多的钱，我会释放他，让碳素收集器处理闲置员工的功能来完成剩下的工作，并聘请一名新员工。

即使争论一个方法是一个对象函数而一个函数是非连接计算也无济于事。函数描述符本身以及理想情况下函数的文档将告诉我它需要什么以及它可能返回什么。其余的，比如操纵某个对象的状态对我来说并不是真正透明的。我确实希望函数和方法都能交付和操纵他们声称的内容，而无需详细了解他们是如何做到的。即使是纯计算函数也可能会更改控制台的状态或附加到日志文件。

* * *

## 回答 #19

> 赞同：7
> 
> 时间：2017-12-14T14:03:07.747

让我们不要把应该是一个非常简单的答案复杂化。方法和函数是一回事。当函数在类外部时，您将其称为函数，而在将函数编写在类内部时，将其称为方法。

* * *

## 回答 #20

> 赞同：6
> 
> 时间：2008-09-30T23:53:50.343

据我了解，方法是可以对类执行的任何操作。它是编程中使用的通用术语。

在许多语言中，方法由函数和子例程表示。大多数语言用于这些的主要区别是函数可能会将值返回给调用者，而子例程可能不会。然而，许多现代语言只有函数，但这些函数可以选择不返回任何值。

例如，假设您想描述一只猫，并且希望它能够打哈欠。您将创建一个带有 Yawn 方法的 Cat 类，它很可能是一个没有任何返回值的函数。

* * *

## 回答 #21

> 赞同：6
> 
> 时间：2008-10-01T00:00:07.473

对于一阶近似，方法（在 C++ 风格的 OO 中）是成员函数的另一个词，即作为类的一部分的函数。

在像 C/C++ 这样的语言中，你可以拥有不是类成员的函数；您不会将与类无关的函数称为方法。

* * *

## 回答 #22

> 赞同：5
> 
> 时间：2015-03-31T22:34:12.163

恕我直言，当人们想要引用对象内部的函数时，他们只是想发明一个新词来简化程序员之间的交流。

如果您说的是方法，那么您的意思是类中的函数。如果您说的是函数，那么您的意思只是类外的函数。

事实上，这两个词都是用来描述功能的。即使您错误地使用它，也不会发生任何错误。这两个词都很好地描述了您希望在代码中实现的目标。

函数是必须发挥作用（*函数*）做某事的代码。方法是解决问题*的方法。*

它做同样的事情。这是同样的事情。如果您想要超级精确并遵守约定，您可以将方法称为对象内部的函数。

* * *

## 回答 #23

> 赞同：5
> 
> 时间：2015-11-10T14:23:44.610

函数是主要属于**面向过程的编程**的概念，其中函数是可以处理数据并返回值的实体

方法是**面向对象编程**的概念，其中方法是类的成员，主要对类成员进行处理。

* * *

## 回答 #24

> 赞同：4
> 
> 时间：2013-07-30T04:02:56.940

我不是专家，但这是我所知道的：

1.  函数是C语言术语，它指的是一段代码，函数名将是使用该函数的标识符。

2.  方法是面向对象的术语，通常它在函数参数中有一个 this 指针。你不能像C那样调用这段代码，你需要使用对象来调用它。

3.  调用方法也不同。这里调用意思就是找到这段代码的地址。C/C++，链接的时候会使用函数符号来定位。

4.  Objective-C 是不同的。调用意思是一个 C 函数使用数据结构来查找地址。这意味着在运行时一切都是已知的。

* * *

## 回答 #25

> 赞同：3
> 
> 时间：2017-04-23T23:11:23.440

我知道很多其他人已经回答了，但我发现以下是一个简单但有效的单行答案。虽然它看起来并不比这里的其他答案好很多，但如果你仔细阅读它，它会包含你需要了解的关于方法与功能的一切。

*方法是具有定义接收器的函数，在 OOP 术语中，方法是对象实例上的函数。*

* * *

## 回答 #26

> 赞同：3
> 
> 时间：2017-12-25T03:55:51.380

类是一些数据和函数的集合，可以选择使用构造函数。

当您创建该特定类的实例（复制、复制）时，构造函数会初始化该类并返回一个对象。

现在类成为对象（没有构造函数）&函数在对象上下文中被称为方法。

所以基本上

类<==新==>对象

函数<==新==>方法

在java中，通常被告知构造函数名称与类名称相同，但实际上构造函数类似于实例块和静态块，但具有用户定义的返回类型（即类类型）

而类可以有一个静态块，实例块，构造函数，函数对象通常只有数据和方法。

* * *

## 回答 #27

> 赞同：3
> 
> 时间：2019-01-17T08:35:50.790

函数 - 独立代码段中的函数，其中包含一些逻辑，**必须独立调用** **并在类之外定义。**

方法 - 方法是一段独立的代码，它**在引用某个对象时被调用，并在类中定义。**

* * *

## 回答 #28

> 赞同：3
> 
> 时间：2019-12-20T07:11:11.623

TL;博士

函数是一段要运行的代码。
方法是对象内部的函数。

函数示例：

```
 function sum(){
  console.log("sum")l
} 
```

方法示例：

```
const obj = {
a:1,
b:2,
sum(){
  }
} 
```

所以这就是为什么我们说函数中的“this”关键字不是很有用，除非我们将它与调用、应用或绑定一起使用。因为调用、应用、绑定将调用该函数作为对象内部的方法 ==> 基本上它将函数转换为方法

* * *

## 回答 #29

> 赞同：2
> 
> 时间：2017-09-06T04:02:43.857

在 C++ 中，有时使用方法来反映类的成员函数的概念。但是，最近我在《C++ 编程语言第 4 版》一书中的第 586 页“派生类”中找到了一条语句

> 虚函数有时也称为方法。

这有点令人困惑，但他**有时会**说，所以大致有道理，C++ 创建者倾向于将方法视为可以在对象上调用的函数，并且可以表现出多态性。

* * *

## 回答 #30

> 赞同：2
> 
> 时间：2017-09-28T14:12:19.317

以下是使用 JavaScript 示例对方法与函数的一些解释：

**`test(20, 50);`是函数定义并用于运行一些步骤或返回可以在某处存储/使用的东西。**

> 您可以重用代码：定义一次代码并多次使用它。
> 
> 您可以使用不同的参数多次使用相同的代码，以产生不同的结果。

```
var x = myFunction(4, 3);   // Function is called, return value will end up in x

function myFunction(a, b) {
    return a * b;          // Function returns the product of a and b
} 
```

**`var test = something.test();`这里 test() 可以是某个对象的方法，也可以是为内置对象自定义的原型，这里有更多解释：**

> JavaScript 方法是可以对对象执行的操作。
> 
> JavaScript 方法是包含函数定义的属性。

javascript中字符串的内置属性/方法：

```
var message = "Hello world!";
var x = message.toUpperCase();
//Output: HELLO WORLD! 
```

自定义示例：

```
function person(firstName, lastName, age, eyeColor) {
    this.firstName = firstName;  
    this.lastName = lastName;
    this.age = age;
    this.eyeColor = eyeColor;
    this.changeName = function (name) {
        this.lastName = name;
    };
}

something.changeName("SomeName"); //This will change 'something' objject's name to 'SomeName' 
```

您也可以为字符串、数组等定义属性，例如

```
String.prototype.distance = function (char) {
    var index = this.indexOf(char);

    if (index === -1) {
        console.log(char + " does not appear in " + this);
    } else {
        console.log(char + " is " + (this.length - index) + " characters from the end of the string!");
    }
};

var something = "ThisIsSomeString"

// now use distance like this, run and check console log

something.distance("m");
```

一些参考资料：[Javascript Object Method](https://www.w3schools.com/js/js_object_methods.asp) , [Functions](https://www.w3schools.com/js/js_functions.asp) , [More info on prototype](https://stackoverflow.com/a/8392062/5236174)

* * *

## 回答 #31

> 赞同：2
> 
> 时间：2017-12-15T18:42:27.150

# 方法和函数之间的区别

通过阅读Microsoft 上的[此文档](https://docs.microsoft.com/en-us/dotnet/csharp/tour-of-csharp/classes-and-objects#base-classes)

> 包含可执行代码的成员统称为类的函数成员。上一节描述了方法，它们是主要的函数成员。本节介绍 C# 支持的其他类型的函数成员：构造函数、属性、索引器、事件、运算符和终结器。

所以方法是函数的子集。每个方法都是函数，但不是每个函数都是方法，例如，a`constructor`不能说是**方法**，但它是函数。

* * *

## 回答 #32

> 赞同：2
> 
> 时间：2020-03-05T11:52:07.127

***简而言之：非静态（“instance”）方法采用隐藏指针指向“this”（作为它们的第一个参数），这是您调用该方法的对象。***

这是与常规独立函数的唯一区别，尽管动态调度。

如果您有兴趣，请阅读下面的详细信息。

我将尽量简短，并以 C++ 为例，尽管我所说的几乎可以应用于所有语言。

*   对于您的 CPU，函数和方法都只是一段代码。时期。
*   因此，当调用函数/方法时，它们可以带参数

好吧，我说没有实际区别。让我们深入一点：

*   有两种方法：静态和非静态
*   静态方法类似于常规函数，但在类中声明，其作用类似于命名空间
*   非静态（“实例”）方法采用指向“this”的隐藏指针。这是与常规独立功能的唯一区别。

抛开动态调度不谈，这意味着它就这么简单：

```
class User {
    public string name; // I made it public intentionally

    // Each instance method takes a hidden reference to "this"
    public void printName(/*User & this*/) {
        cout << this.name << endl;
    }
}; 
```

相当于

```
public getName(User & user) {
    // No syntactic sugar, passing a reference explicitly
    cout << user.name << endl;
} 
```

所以，本质上，`user->printName()`它只是`getName(user)`.

如果您不使用动态分派，仅此而已。如果它*被使用*，那么它会涉及更多，但编译器仍然会发出看起来像`this`作为第一个参数的函数的东西。

* * *

## 回答 #33

> 赞同：2
> 
> 时间：2020-12-15T07:13:42.427

方法和功能之间有明显的区别：

**函数**是一段独立的代码，你可以在任何地方调用它，只要用给定的参数提到它的名字，就像在大多数过程语言中一样，例如 C++ 和 python。尽管

**方法**专门与对象相关联，这意味着您只能通过在它之前用点（。）表示法提及它的对象来调用方法，就像在专门的纯面向对象语言（如 C# 和 java）中一样。

* * *

## 回答 #34

> 赞同：2
> 
> 时间：2020-12-30T20:21:23.123

**一般答案是：**

`method`具有对象上下文（this，或类实例引用），

`function`没有上下文（null、全局或静态）。

**但问题的答案取决于您使用的语言术语。**

1.  在 JavaScript (ES 6) 中，您可以根据需要自由[自定义函数上下文 (this)](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/this)，这通常必须链接到 (this) 对象实例上下文。

2.  在 Java 世界中，您总是听到[“只有 OOP 类/对象，没有函数”](https://tonyxu.io/books/thinking-in-java/chapter-2/)，但如果您仔细观察`static methods`Java，它们实际上是在全局/空上下文（或类的上下文，没有实例化）中，所以只有函数没有目的。Java 老师可以告诉你，`functions were rudiment of C in C++ and dropped in Java`但他们告诉你这是为了简化历史并避免新手提出不必要的问题。如果您在 Java 7 之后的版本中看到，您会发现许多纯函数编程元素（甚至不是来自 C，[而是来自较旧的 1988](https://www.dreamsongs.com/Files/hicss.pdf) Lisp）[用于简化并行计算，并且不是 OOP 类风格](https://docs.oracle.com/javase/tutorial/collections/streams/parallelism.html)。

3.  在 C++ 和 D 世界中，事情变得更强大，并且您已经将[函数](https://www.tutorialspoint.com/cplusplus/cpp_functions.htm)和[对象与方法和字段](https://www.tutorialspoint.com/cplusplus/cpp_classes_objects.htm)分开。但在实践中，您再次看到函数`without this`和方法`whith this`（带有对象上下文）。

4.  在 FreePascal/Lazarus 和 Borland Pascal/Delphi 中，函数和[对象](https://wiki.freepascal.org/Object_Oriented_Programming_with_Free_Pascal_and_Lazarus)（变量和[字段](https://www.freepascal.org/docs-html/ref/refsu24.html)）的分离术语通常类似于 C++。

5.  Objective-C 来自 C 世界，因此您必须使用方法插件将 C 函数和 Objective-C 对象分开。

6.  C# 与 Java 非常相似，但具有许多 C++ 优点。

* * *

## 回答 #35

> 赞同：2
> 
> 时间：2021-08-10T17:52:20.360

A`method`是任何对象或类的成员。A`function`是独立的。

但在 Javascript 的情况下，`function`是`method`可以互换的。

* * *

## 回答 #36

> 赞同：1
> 
> 时间：2019-09-22T11:53:44.887

它们通常可以互换，但*方法*通常是指类内的子例程，而*函数*通常是指类外的子例程。例如，在 Ruby 中：

```
# function
def putSqr(a)
   puts a ** 2
end

class Math2
   # method
   def putSqr(a)
      puts a ** 2
   end
end 
```

在 Java 中，所有东西（除了 package 和 import 语句）都必须在类中，人们几乎总是将它们称为“方法”。

* * *

## 回答 #37

> 赞同：1
> 
> 时间：2020-05-06T12:19:48.550

函数和方法看起来非常相似。它们也有输入和返回输出。区别在于**方法在类内部，**而**函数在类外部**。

* * *

## 回答 #38

> 赞同：1
> 
> 时间：2021-09-14T05:51:32.987

使用 C# 术语，函数和方法之间存在区别。术语*函数成员*不仅包括方法，还包括其他非数据成员，例如索引器、运算符、构造函数、析构函数和属性——所有包含可执行代码的成员。

参考 => Professional C# and .NET 2021 Edition - 由 Christina Nagel 编写

* * *

## 回答 #39

> 赞同：1
> 
> 时间：2021-12-20T04:04:20.083

> 方法和函数有什么区别？

Python 的官方文档是这样定义的（在这里感谢[@Kelly Bundy](https://stackoverflow.com/questions/70415511/hasattr-is-called-a-method-but-it-looks-like-a-function/70415890#comment124474084_70415890)！）：

> [**功能**](https://docs.python.org/3/glossary.html#term-function)
> 
> 一系列向调用者返回一些值的语句。它也可以传递零个或多个[参数](https://docs.python.org/3/glossary.html#term-argument)，这些参数可用于执行主体。另请参阅[参数](https://docs.python.org/3/glossary.html#term-parameter)、[方法](https://docs.python.org/3/glossary.html#term-method)和[函数定义](https://docs.python.org/3/reference/compound_stmts.html#function)部分

> [**方法**](https://docs.python.org/3/glossary.html#term-method)
> 
> 在类体内定义的函数。如果作为该类实例的属性调用，该方法将获取实例对象作为其第一个[参数](https://docs.python.org/3/glossary.html#term-argument)（通常称为`self`）。请参阅[函数](https://docs.python.org/3/glossary.html#term-function)和[嵌套范围](https://docs.python.org/3/glossary.html#term-nested-scope)。

* * *

正方形是长方形，但并非所有长方形都是正方形。我解释世界的方式是，方法是函数，但并非所有函数都是方法。一个方法的独特之处在于它是一种*特殊类型的函数*，它也与一个类相关联并且可以访问类成员变量。

## 也可以看看：

1.  [我的答案] [hasattr 被称为方法，但它看起来像一个函数](https://stackoverflow.com/questions/70415511/hasattr-is-called-a-method-but-it-looks-like-a-function/70415890#70415890)

# c# - 如何在 .NET 中指定控制台应用程序的退出代码？

> ID：155610
> 
> 赞同：517
> 
> 时间：2008-09-30T23:45:10.397
> 
> 标签：c#, .net, exit-code

我在 .NET 中有一个简单的控制台应用程序。它只是一个更大的应用程序的一个测试部分。我想指定我的控制台应用程序的“退出代码”。我该怎么做呢？

* * *

## 回答 #1

> 赞同：668
> 
> 时间：2008-09-30T23:47:57.330

三个选项：

*   `Main`如果您将`Main`方法声明为 return ，则可以将其返回`int`。
*   你可以打电话[`Environment.Exit(code)`](https://docs.microsoft.com/en-us/dotnet/api/system.environment.exit)。
*   您可以使用属性设置[退出代码](https://docs.microsoft.com/en-us/dotnet/api/system.environment.exitcode)`Environment.ExitCode = -1;`： . 如果没有其他设置返回代码或使用上述其他选项之一，则将使用此选项）。

根据您的应用程序（控制台、服务、Web 应用程序等），可以使用不同的方法。

* * *

## 回答 #2

> 赞同：295
> 
> 时间：2008-10-01T03:30:01.557

除了涵盖 return int 的答案之外......呼吁理智。请在枚举中定义您的退出代码，如果合适，请使用标志。它使调试和维护变得如此容易（而且，作为奖励，您可以轻松地在帮助屏幕上打印出退出代码 - 您确实有其中一个，对吧？）。

```
enum ExitCode : int {
  Success = 0,
  InvalidLogin = 1,
  InvalidFilename = 2,
  UnknownError = 10
}

int Main(string[] args) {
   return (int)ExitCode.Success;
} 
```

* * *

## 回答 #3

> 赞同：55
> 
> 时间：2012-08-26T23:07:24.043

您可以使用三种方法从控制台应用程序返回退出代码。

1.  修改`Main`应用程序中的方法，使其返回一个`int`代替（在[VB.NET](https://en.wikipedia.org/wiki/Visual_Basic_.NET)中返回代替`void`的函数），然后从该方法返回退出代码。`Integer``Sub`
2.  将[Environment.ExitCode](http://msdn.microsoft.com/en-us/library/system.environment.exitcode.aspx)属性设置为退出代码。请注意，方法 1\. 具有优先权 - 如果该`Main`方法返回的值不是`void`（`Sub`在 VB.Net 中为 a），则此属性的值将被忽略。
3.  将退出代码传递给[Environment.Exit](http://msdn.microsoft.com/en-us/library/system.environment.exit)方法。与其他两种方法相反，这将立即终止该过程。

应该遵守的一个重要标准是`0`代表“成功”。

在相关主题上，考虑使用枚举来定义您的应用程序将要返回的退出代码。[FlagsAttribute](http://msdn.microsoft.com/en-us/library/system.flagsattribute.aspx)将允许您返回代码组合。

此外，请确保您的应用程序被编译为“控制台应用程序”。

* * *

## 回答 #4

> 赞同：44
> 
> 时间：2011-11-22T16:53:44.177

如果您打算使用[David 建议的方法](https://stackoverflow.com/questions/155610/how-do-i-specify-the-exit-code-of-a-console-application-in-net/8220145#8220145)，您还应该查看 [Flags] 属性。

这允许您对枚举进行按位操作。

```
[Flags]
enum ExitCodes : int
{
  Success = 0,
  SignToolNotInPath = 1,
  AssemblyDirectoryBad = 2,
  PFXFilePathBad = 4,
  PasswordMissing = 8,
  SignFailed = 16,
  UnknownError = 32
} 
```

然后

```
(ExitCodes.SignFailed | ExitCodes.UnknownError) 
```

将是 16 + 32。:)

* * *

## 回答 #5

> 赞同：29
> 
> 时间：2008-09-30T23:46:17.537

```
System.Environment.ExitCode 
```

请参阅*[Environment.ExitCode 属性](https://docs.microsoft.com/en-us/dotnet/api/system.environment.exitcode)*。

* * *

## 回答 #6

> 赞同：26
> 
> 时间：2008-09-30T23:46:02.607

```
int code = 2;
Environment.Exit( code ); 
```

* * *

## 回答 #7

> 赞同：14
> 
> 时间：2008-09-30T23:46:45.413

只需从 main 中返回适当的代码。

```
int Main(string[] args)
{
    return 0; // Or exit code of your choice
} 
```

* * *

## 回答 #8

> 赞同：11
> 
> 时间：2008-09-30T23:50:14.703

如果您的 main 有一个无效的返回签名，请使用*ExitCode 。*否则，您需要通过返回的值“设置”它。

从*[Environment.ExitCode 属性](https://docs.microsoft.com/en-us/dotnet/api/system.environment.exitcode)*：

> 如果 Main 方法返回 void，您可以使用此属性设置将返回给调用环境的退出代码。如果 Main 不返回 void，则忽略此属性。此属性的初始值为零。

* * *

## 回答 #9

> 赞同：8
> 
> 时间：2011-11-21T23:45:59.667

[枚举选项](https://stackoverflow.com/questions/155610/how-do-i-specify-the-exit-code-of-a-console-application-in-net/156134#156134)非常好。但是，可以通过将数字相乘来改进它，如下所示：

```
enum ExitCodes : int
{
  Success = 0,
  SignToolNotInPath = 1,
  AssemblyDirectoryBad = 2,
  PFXFilePathBad = 4,
  PasswordMissing = 8,
  SignFailed = 16,
  UnknownError = 32
} 
```

在出现多个错误的情况下，将特定错误编号加在一起将为您提供一个唯一编号，该编号将代表检测到的错误的组合。

例如，错误级别 6 只能由错误 4 和 2 组成，12 只能由错误 4 和 8 组成，14 只能由 2、4 和 8 组成等。

* * *

## 回答 #10

> 赞同：8
> 
> 时间：2016-10-11T20:51:22.503

作为对[Scott Munro 回答](https://stackoverflow.com/questions/155610/how-do-i-specify-the-exit-code-of-a-console-application-in-net/12134636#12134636)的更新：

*   在 C# 6.0 和 VB.NET 14.0 ( [Visual Studio 2015](https://en.wikipedia.org/wiki/Microsoft_Visual_Studio#2015) ) 中，需要[Environment.ExitCode](http://msdn.microsoft.com/en-us/library/system.environment.exitcode.aspx)或[Environment.Exit(exitCode)](http://msdn.microsoft.com/en-us/library/system.environment.exit)从控制台应用程序返回非零代码。更改的返回类型`Main`无效。
*   在[F#](https://en.wikipedia.org/wiki/F_Sharp_%28programming_language%29) 4.0 (Visual Studio 2015) 中，`main`入口点的返回值受到尊重。

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2016-08-10T12:38:15.173

您可以在*[系统错误代码 (0-499)](https://docs.microsoft.com/en-us/windows/win32/debug/system-error-codes--0-499-)*上找到系统错误代码。

您会找到典型的代码，例如“找不到文件”的 2 或“拒绝访问”的 5。

当你偶然发现一个未知代码时，你可以使用这个命令来找出它的含义：

```
net helpmsg decimal_code 
```

例如，

```
net helpmsg 1 
```

返回

```
Incorrect function 
```

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2019-03-02T16:36:34.390

使用此代码

```
Environment.Exit(0); 
```

如果您不想返回任何内容，请使用 0 作为 int。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2021-06-27T10:18:46.850

我这样做是这样的：

```
int exitCode = 0;
Environment.Exit(exitCode); 
```

或者你可以抛出一个错误（个人喜好）：

```
throw new ArgumentException("Code 0, Environment Exit"); 
```

我选择了 ArgumentException，但您可以输入其他。它会正常工作。

* * *

## 回答 #14

> 赞同：-2
> 
> 时间：2020-10-17T19:00:31.870

只是另一种方式：

```
public static class ApplicationExitCodes
{
    public static readonly int Failure = 1;
    public static readonly int Success = 0;
} 
```

# javascript - 假设我的访问者启用了 javascript 是否合理？

> ID：155615
> 
> 赞同：37
> 
> 时间：2008-09-30T23:46:45.883
> 
> 标签：javascript

我知道服务器端验证是防止恶意用户（或只是选择禁用 javascript 的用户）绕过客户端验证的绝对必要条件。但这主要是为了保护您的应用程序，而不是为那些运行禁用 javascript 的浏览器的用户提供价值。假设访问者启用了 javascript 并且对于那些没有启用的人来说只是一个无法使用的站点是否合理？

* * *

## 回答 #1

> 赞同：35
> 
> 时间：2008-09-30T23:52:12.983

我在 Firefox 中使用 NoScript 进行浏览，当我遇到无法运行的页面时，它总是让我烦恼。也就是说 - 了解你的听众。如果您正试图迎合偏执的计算机安全专业人员 - 假设他们可能没有启用 JavaScript。如果您要面向普通观众，JavaScript 可能已启用。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-10-01T01:44:39.937

完全取决于你的目标是谁。

如果您的网站或应用程序用于 Intranet，您可以做出很多假设。如果您的目标受众是最前沿的社交网络类型，您可以假设 JavaScript 可以工作。如果您预计会有很多偏执狂的系统管理员类型，您可以假设他们中的许多人会尝试在 lynx 中访问您的网站，或者出于“安全原因”而关闭 JS。

亚马逊就是一个很好的例子——他们的方法是由他们的业务目标驱动的。他们是一个大众市场网站，但对他们来说，将用户锁定在旧的/无法使用的浏览器中意味着潜在的销售损失，因此他们努力研究非脚本后备。

因此，就像许多此类问题一样，答案不仅仅是重复您在某处读过的关于可访问性或渐进增强的内容。真正的答案是“视情况而定”。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2008-09-30T23:52:08.413

我认为还有另一个原因促使您在没有 JS 的情况下至少支持一些主要功能——我们现在很多人从移动设备和 PDA 浏览，它们没有相同的 JavaScript 支持。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2008-09-30T23:52:40.970

[http://www.w3schools.com/browsers/browsers_stats.asp](http://www.w3schools.com/browsers/browsers_stats.asp)

他们声称 95% 的用户启用了 Javascript。

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2008-09-30T23:56:02.600

[复制](https://stackoverflow.com/questions/121108/how-many-people-disable-javascript#121128)

至少有一个类别的答案肯定是“不”。如果您为政府工作，则*必须*确保使用屏幕阅读器的人可以访问该网站。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2008-10-08T01:21:43.543

> 假设访问者启用了 javascript 并且对于那些没有启用的人来说只是一个无法使用的站点是否合理？

实际上有两个问题，答案是：是的，假设访问者启用了 javascript 是合理的。而且，不，这并不意味着其他人应该留下无法使用的网站。

渐进式增强是要走的路。让您的网站在没有 javascript 的情况下可用，然后添加花里胡哨。

至于客户端验证，它只是方便用户避免不必要的往返服务器（应该执行真正的验证）。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-10-01T10:38:26.767

[我在 Firefox 中使用NoScript](http://noscript.net/)插件进行浏览，我很惊讶有如此多的开发人员甚至没有考虑过让他们的网站可降解。

永远不要假设用户禁用了 JavaScript——尤其是看到它可能并不总是他们的错。许多企业都有阻止 JavaScript/ActiveX 等的防火墙 - 在这种情况下，该`<noscript>`元素将不起作用，所以我也不建议使用它！

除非您正在创建一个 90% 的 Ajax 完整的 Web 应用程序，否则您必须确保遵守标准并通过各个交互层逐步增强您的网站。

也不要忘记对象检测的重要性，尤其是随着手机网页浏览的兴起。最流行的移动网络浏览器之一（Opera mini 4.0）不允许所有“后台 javaScript”工作，Ajax 调用很少正确执行......只是需要注意的事情。

老实说，我厌倦了认为每个人都会启用 JS 的开发人员！什么无知！！

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-09-30T23:48:10.030

现在可以假设您的访问者启用了 JS。话虽如此，您应该争取在禁用 JS 的情况下尽可能降低您的网站。如果您的网站回退到在没有 JS 的情况下仍然可用的状态，这是理想的选择。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-09-30T23:48:15.787

是的。但是通过常规的 HTML 和 URL 尽可能多地公开它，如果不是为了谷歌的话。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-09-30T23:49:37.000

可访问，是的...功能？并不真地。

这确实是一个客户需求问题，而不是开发人员可以回答的问题，但是如果您的客户试图强制要求非 JS 浏览器可以工作，您应该强烈反对它，并真正将他们放在他们将缺少的“酷”因素上.

鉴于 GWT、RichFaces 等对 Javascript 的严重依赖，如果没有它，要制作具有任何类型的用户友好 UI 的应用程序是不可行的。

不过，您当然应该警告未启用 JS 的用户，他们尝试访问的网站严重依赖 JS。对此无礼无礼。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2008-10-01T03:54:28.487

不！某些环境会根据政策将其禁用，而您无法启用它。即使它被启用，它也可能会被削弱。

这个问题以前有人问过。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-10-01T08:03:38.543

要考虑的一个有趣的点是，作为一名 Web 开发人员，您有推动技术进步的社会责任——通过使用 AJAX 之类的东西，您可以增加曝光率和潜在的采用率。唯一能阻止你充分利用这项技术的就是钱——如果你不能赚到你需要的钱，因为人们在查看材料时会遇到困难，你必须重新考虑。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2008-10-08T01:37:34.227

正如您的问题所暗示的那样，永远不要假设 Javascript 用于表单验证。最终有人会意识到这一点并关闭 Javascript。

取而代之的是，以相当常规的 html 方式对应用程序进行编码，并使用 Javascript 来实现它的本质：用户的可选福利。

即使对于像 Gmail 这样的完全 AJAX 应用程序，也需要在服务器端完成完整的表单验证工作。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2011-07-31T17:06:50.547

是的，JavaScript 与 CSS 一样古老，没有人试图围绕不支持 CSS 的浏览器进行构建。跨站点脚本是人们害怕 JavaScript 的原因，但相信我，如果开发人员想把你搞砸，他不需要 JavaScript 来做。就移动浏览器而言，现在大多数都有 JavaScript，其他的不应该被视为浏览器。我的建议是不要让你的网站容易受到那些选择关闭 JavaScript 的人的攻击，从而向黑客敞开心扉，但同时不要特意支持那些生活在石器时代的人。你不会支持 IE 4 或 Netscape，对吧？那为什么要支持那些因为公然恐惧或偏执而破坏自己浏览器的人呢？

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-10-01T00:07:13.277

我认为可以公平地假设您网站的大多数访问者都启用了 JavaScript。一些流量较大的网站依赖于 JavaScript。例如，我很惊讶地发现，如果没有支持 JS 的浏览器，您将无法通过支持 Passport 的站点进行身份验证。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2008-10-01T00:11:22.063

不，不是，句号，句号，故事的结尾。在道德层面上它只是幼稚和错误，更不用说你错过了全球大约 50% 的互联网用户（信不信由你，全球 70% 的网络访问来自移动设备）。

添加需要 Javascript 的额外漂亮的东西，这很好。不要让您的网站在没有 Javascript 的情况下无法使用，除非您有非常、非常、非常好的理由这样做。

有人正确地指出，我没有证据支持我关于 70% 的移动网络用户的说法。不幸的是，我找不到它的来源，但我记得它是权威的，所以没有理由怀疑它。尽管考虑到全球范围内的使用情况，但许多发展中国家的手机数量超过了固定电话和宽带，这确实是有道理的。在我的未知来源中引用的一项统计数据是，特别是一个非洲国家拥有 300,000 条固定电话，但拥有 150 万部手机！

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2008-10-01T00:16:46.793

几乎所有（但不是全部！）用户都将启用 javascript。（我相信上面引用的大约 5% 的数字是准确的。）

鉴于您可以通过明智地使用 javascript 来极大地提高可用性，我认为大多数时候，假设它已启用是合理的。

当然，在某些情况下情况并非如此，（即，为移动设备设计的网站，或具有高比例的残疾用户等），并且始终应该努力使您的网站具有可访问性尽可能多的人口。

也就是说，如果您只有一个低流量的网站，那么一小部分的 5% 是一个非常小的数字。当您的网站可能只会为您带来一两个额外用户时，可能不值得向后弯曲以使这些人可以访问您的网站。

我想简短的答案是（一如既往），没有正确答案 - 这将完全取决于目标用途和相关座位的目标用户。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2008-10-01T00:37:46.603

根据[这个小页面](http://www.w3schools.com/browsers/browsers_stats.asp)，95% 的浏览器都启用了 Javascript，并且还在不断提高。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2008-10-01T01:48:39.553

[W3C 浏览器统计](http://www.w3schools.com/browsers/browsers_stats.asp)页面（向下滚动）有一些关于此的信息；他们说，截至 2008 年 1 月，95% 的访问者使用 JavaScript。

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2008-10-01T03:20:51.233

假设您的访问者启用了 javascript 是合理的！-)

——但当然这取决于你想联系谁......

上面多次提到了 w3schools，正如 Dan 所说，它自己的访问者使得从中得出结论有些古怪。

但是，如果您查看[theCounter.com](http://www.thecounter.com/stats/2008/August/javas.php "theCounter.com 2008 年 8 月")，似乎他们的观众在这一点上通常具有相同的习惯......

尚未提及的一个转折是爬虫、邮件收集器等的数量不断增加，它们肯定没有打开 javascript，计数器检测它们的效果如何？-)

我的猜测是，这种机器浏览器占据了 5-6% 的大部分！o]

- 也就是说，如果可能的话，让你的应用程序优雅地降级（正如一位智者所说）

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2008-10-01T03:27:16.897

您的问题似乎建议为应用程序提供基于表单的输入。如果它是一个 Intranet 应用程序，那么您将得到内部安全专家的指导。如果它是公共应用程序，那么正如其他海报所建议的那样，优雅地失败。

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2008-10-01T06:31:53.273

我会争辩说，只要您提供合适的方法来替换 javascript（如果未启用），期望他们拥有 javascript 是非常合理的。我喜欢 Yahoo UI Library 的原因之一是它可以优雅地降级。

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2008-10-01T10:45:13.460

我总是先尝试将我的网站编码为静态网站，然后添加 js/ajax 功能。这样我可以确定它可以在非 JS 浏览器上运行:)

但是，javascript 就像 flash：所有用户都拥有它，但开发人员必须关注 WHAT IF....？:D

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2008-10-04T15:35:37.457

正如许多人所指出的，这完全是一个“取决于”的问题。

这就是为什么指标在网站上很有价值，可以帮助显示您是否真的可以用“主要网站说大多数人都在使用 JS”的类比运行——您可以拥有一个 99% 的网站。我不会深入研究上面所说的，因为它已经得到很好的回答:)

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2010-11-30T17:29:52.963

并不是说其他​​人都没有加入，但我在某种程度上不同意“看看你的观众”的立场。

如果你只是显示一些信息，它真的应该是“看看你的应用程序”，并且你的 js 是为了花哨的目的，那么如果你愿意的话，当然要看看漂亮的退化。

`<noscript>`但是，如果您正在构建类似 Google Docs 的东西，那么有人会认为他们可以在没有 js 的情况下使用您的网站真是太愚蠢了，所以也许可以通过标签内的讽刺信息让他们知道这一点。

从纯哲学的角度来看，如果用户想要访问你的网站，他们会翻转 js 开关，或者升级到一个像样的浏览器等等。你应该强迫他们这样做，因为进化对于生存很重要。物种。

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2015-04-05T23:52:02.163

根据[这个](http://www.w3schools.com/browsers/browsers_stats.asp)网站，95% 的浏览器使用 JavaScript。

也就是说，有很多机器人不使用 JavaScript：爬虫、搜索机器人等。我想说接近 100% 的实际人类用户使用 JavaScript。但你的猜测和我的一样好。

# javascript - 圆坐标到Javascript中的数组

> ID：155649
> 
> 赞同：15
> 
> 时间：2008-09-30T23:57:43.157
> 
> 标签：javascript, arrays, geometry, formula

将圆的坐标添加到 JavaScript 中的数组的最佳方法是什么？到目前为止，我只能做一个半圆，但我需要一个将整个圆返回到两个不同数组的公式：`xValues`和`yValues`. （我正在尝试获取坐标，以便可以沿路径为对象设置动画。）

**这是我到目前为止所拥有的：**

```
circle: function(radius, steps, centerX, centerY){
    var xValues = [centerX];
    var yValues = [centerY];
    for (var i = 1; i < steps; i++) {
        xValues[i] = (centerX + radius * Math.cos(Math.PI * i / steps-Math.PI/2));
        yValues[i] = (centerY + radius * Math.sin(Math.PI * i / steps-Math.PI/2));
   }
} 
```

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2008-10-01T00:12:09.427

你的循环应该这样设置：

```
for (var i = 0; i < steps; i++) {
    xValues[i] = (centerX + radius * Math.cos(2 * Math.PI * i / steps));
    yValues[i] = (centerY + radius * Math.sin(2 * Math.PI * i / steps));
} 
```

*   从 0 开始循环
*   遍历整个 2 * PI 范围，而不仅仅是 PI。
*   你不应该有`var xValues = [centerX]; var yValues = [centerY];`- 圆的中心不是它的一部分。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-10-01T00:14:34.880

Bresenham 的算法要快得多。你听说过它与绘制直线有关，但有一种用于圆的算法。

无论您是使用它还是继续进行三角计算（如今这些计算速度非常快）——您只需要画出 1/8 的圆圈。通过交换 x,y 你可以得到另一个 1/8，然后 x、y 和两者的负数 - 交换和未交换 - 为你圈子的所有其余部分提供分数。8倍加速！

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-10-01T00:16:25.890

改变：

```
Math.PI * i / steps 
```

到：

```
2*Math.PI * i / steps 
```

一个完整的圆是 2pi 弧度，而你只会去 pi 弧度。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-30T23:59:53.650

如果您已经有半个圆圈，只需镜像点以获得另一半
，确保您以正确的顺序执行此操作。

更具体地说，对于另一半，您只需将“ `+ sin(...)`”替换为“ `- sin(...)`”

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-01T00:02:48.277

您需要使用偏函数将弧度输入 cos 和 sin；因此，将您获得的四分之一或一半圆的值，并将它们反映在中心点的轴上以获得完整的圆。

也就是说 JavaScript 的 sin 和 cos 并不那么挑剔，所以你一定把弧度减半了。我会把它写成：

```
function circle(radius, steps, centerX, centerY){
    var xValues = [centerX];
    var yValues = [centerY];
    var table="<tr><th>Step</th><th>X</th><th>Y</th></tr>";
    var ctx = document.getElementById("canvas").getContext("2d");
    ctx.fillStyle = "red"
    ctx.beginPath();
    for (var i = 0; i <= steps; i++) {
        var radian = (2*Math.PI) * (i/steps);
        xValues[i+1] = centerX + radius * Math.cos(radian);
        yValues[i+1] = centerY + radius * Math.sin(radian);
        if(0==i){ctx.moveTo(xValues[i+1],yValues[i+1]);}else{ctx.lineTo(xValues[i+1],yValues[i+1]);}
        table += "<tr><td>" + i + "</td><td>" + xValues[i+1] + "</td><td>" + yValues[i+1] + "</td></tr>";
    }
    ctx.fill();
    return table;
}
document.body.innerHTML="<canvas id=\"canvas\" width=\"300\" height=\"300\"></canvas><table id=\"table\"/>";
document.getElementById("table").innerHTML+=circle(150,15,150,150); 
```

我假设无论出于何种原因，您都希望 xValues[0] 和 yValues[0] 成为 centerX 和 centerY。我不知道你为什么想要那个，因为它们已经是传递给函数的值了。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-01T00:11:54.963

我可以通过将步数乘以 2 自己解决它：

```
circle: function(radius, steps, centerX, centerY){
    var xValues = [centerX];
    var yValues = [centerY];
    for (var i = 1; i < steps; i++) {
        xValues[i] = (centerX + radius * Math.cos(Math.PI * i / steps*2-Math.PI/2));
        yValues[i] = (centerY + radius * Math.sin(Math.PI * i / steps*2-Math.PI/2));
   }
} 
```

# database-design - 用于跟踪营销网站中的随机设置的数据库模式

> ID：155669
> 
> 赞同：2
> 
> 时间：2008-10-01T00:08:38.310
> 
> 标签：database-design, schema, customization, entity-relationship

我有基于 Flex 的消费者[网站](http://www.rollingrazor.com)，我想在其中根据随机和其他标准更改各种外观和感觉类型设置，然后跟踪这些以产生最多销售。

例如，我可能会完全关闭主页，根据人们来自哪里显示不同的内容。我可能会显示或隐藏某些功能，或更改某些文本。我可能会改变的事情尚未定义，并且可能会变得相当复杂。

我想设计最灵活的数据库模式，但它必须高效且易于搜索。目前，我有一个“SiteVisit”表，其中包含有关每个不同访问者的信息。

我想在包含每个设置的列的单个表和仅包含键值对的表之间找到正确的平衡。

有什么建议么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-09T20:30:26.727

好的，这非常棘手。我这么说的原因是因为你要求两件事：

*   轻松的存储库模式，以便您可以存储各种数据并更改以后动态保存的内容
*   固定的数据库架构，以便您可以有效地查询数据

解决方案将是妥协。你必须明白这一点。

假设您有 User 表：

```
+----------------
| User
+----------------
| UserId (PK)
| ...
+---------------- 
```

1) XML blob 方法 您可以将数据作为博客（大 XML）保存到表中（实际上是一个属性包），但查询（过滤）将是一场噩梦。

```
+----------------
| CustomProperty
+----------------
| PropId (PK)
| UserId (FK)
| Data of type memo/binary/...
+---------------- 
```

优点是您（业务逻辑）拥有架构。这同时也是该解决方案的缺点。另一个巨大的缺点是查询/过滤将非常困难和缓慢！

2) 每个属性的表 另一种解决方案是为每个属性（主页等）制作一个特殊的表。该表将包含每个用户的价值（基于 FK 对用户表的关系）。

```
+----------------
| HomePage
+----------------
| HomePageId (PK)
| UserId (FK)
| Value of type string
+---------------- 
```

这种方法的优点是您可以非常快速地查看该属性的所有值。缺点是您将拥有太多表（每个自定义属性一个），并且您将在查询操作期间经常连接表。

3) CustomProperty 表 在此解决方案中，您有一个包含所有自定义属性的表。

```
+----------------
| CustomPropertyEnum
+----------------
| PropertyId (PK)
| Name of type string
+----------------

+----------------
| CustomProperty
+----------------
| PropId (PK)
| PropertyId (FK)
| UserId (FK)
| Value of type string
+---------------- 
```

在此解决方案中，您将所有自定义属性存储在一个表中。您还有一个特殊的枚举表，可以让您更有效地查询数据。缺点是您将在查询操作期间经常连接表。

为自己选择。我会根据您的工作量在 2 和 3 之间做出决定（很可能是 3，因为它更容易）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2014-07-22T22:55:43.843

这是使用 NoSQL 数据库的经典案例。它可用于轻松存储各种键值对，无需任何预定义模式。

# language-agnostic - 反转 4x4 矩阵 - 需要数值最稳定的解决方案

> ID：155670
> 
> 赞同：13
> 
> 时间：2008-10-01T00:08:44.613
> 
> 标签：language-agnostic, matrix, linear-algebra, fixed-point, matrix-inverse

我想反转一个 4x4 矩阵。我的数字以定点格式存储（准确地说是 1.15.16）。

使用浮点算术，我通常只构建伴随矩阵并除以行列式（例如蛮力解决方案）。到目前为止，这对我有用，但是在处理定点数时，由于使用了所有乘法，我得到了不可接受的精度损失。

注意：在定点算术中，我总是丢弃一些立即结果的最低有效位。

那么-反转矩阵的最稳定的数值方法是什么？我不太在意性能，但简单地使用浮点会减慢我的目标架构。

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-10-01T00:24:52.063

元答案：它真的是一个通用的 4x4 矩阵吗？如果您的矩阵具有特殊形式，那么有直接的反演公式可以快速并让您的操作倒计时。

例如，如果它是来自图形的标准齐次坐标变换，例如：

```
[ux vx wx tx]
[uy vy wy ty]
[uz vz wz tz]
[ 0  0  0  1] 
```

（假设由旋转、比例、平移矩阵组成）

然后有一个[易于推导的直接公式](http://graphics.stanford.edu/courses/cs248-98-fall/Final/q4.html)，即

```
[ux uy uz -dot(u,t)]
[vx vy vz -dot(v,t)]
[wx wy wz -dot(w,t)]
[ 0  0  0     1    ] 
```

（从链接页面窃取的 ASCII 矩阵。）

由于定点精度的损失，您可能无法击败它。

如果您的矩阵来自您知道它具有更多结构的某个领域，那么可能会有一个简单的答案。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-01T00:23:51.037

我认为这个问题的答案取决于矩阵的确切形式。具有旋转（基本）的标准分解方法（LU、QR、Cholesky 等）在固定点上相当不错，尤其是对于小型 4x4 矩阵。请参阅 Press 等人的《数字食谱》一书。有关这些方法的说明。

[这篇论文](http://ieeexplore.ieee.org/Xplore/login.jsp?url=/iel5/10072/32298/01511286.pdf)提供了一些有用的算法，但不幸的是，它在付费墙后面。他们建议使用（枢轴）Cholesky 分解，其中包含一些过于复杂而无法在此处列出的附加功能。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-12-10T15:02:19.570

我想支持 Jason S 提出的问题：您确定需要反转矩阵吗？这几乎没有必要。不仅如此，这通常是一个坏主意。如果您需要求解 Ax = b，则直接求解系统比将 b 乘以 A 逆在数值上更稳定。

即使您必须一遍又一遍地解决 Ax = b 的许多 b 值，反转 A 仍然不是一个好主意。您可以分解 A（例如 LU 分解或 Cholesky 分解）并保存这些*因子*，这样您就不会重做每次都有效，但是您仍然每次使用分解都可以解决系统问题。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-01T00:36:38.680

在执行正常算法之前，您可能会考虑加倍到 1.31。它会使乘法次数增加一倍，但是您正在执行矩阵求逆，并且您所做的任何事情都将与处理器中的乘法器密切相关。

对于任何有兴趣找到 4x4 反转方程的人，您可以使用符号数学包为您解决它们。TI-89 甚至可以做到，尽管需要几分钟。

如果您告诉我们矩阵反转对您有什么作用，以及它如何适合您的其余处理，我们可能会提出替代方案。

-亚当

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-10T14:48:42.810

让我问一个不同的问题：您肯定需要对矩阵求逆（称为 M），还是需要使用矩阵求逆来求解其他方程？（例如，对于已知的 M，b，Mx = b）通常有其他方法可以做到这一点，而无需明确需要计算逆。或者，如果矩阵 M 是时间的函数并且它变化缓慢，那么您可以计算一次完整的逆矩阵，并且有迭代方法来更新它。

* * *

## 回答 #6

> 赞同：-3
> 
> 时间：2008-10-01T00:29:31.833

如果矩阵表示仿射变换（很多时候这是 4x4 矩阵的情况，只要您不引入缩放分量），则逆只是上部 3x3 旋转部分的转置，最后一列取反。显然，如果您需要一个广义的解决方案，那么研究高斯消除可能是最简单的。

# php - 从 MySQL TEXT 列中提取时在 HTML 中显示空格

> ID：155681
> 
> 赞同：9
> 
> 时间：2008-10-01T00:12:20.470
> 
> 标签：php, mysql, html

我已将 textarea 元素的输入保存到 MySQL 中的 TEXT 列。我正在使用 PHP 将数据从数据库中提取出来，并希望在 ap 元素中显示它，同时仍显示用户输入的空格（例如多个空格和换行符）。我尝试了一个 pre 标签，但它不遵守包含 div 元素中设置的宽度。除了创建一个 PHP 函数来将空格转换为   并将新行转换为 br 标记之外，我还有哪些选择？我更喜欢干净的 HTML/CSS 解决方案，但欢迎任何输入！谢谢！

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-10-01T00:20:32.120

`pre`您可以使用以下 CSS使内部的文本换行

```
pre {
 white-space: pre-wrap;       /* css-3 */
 white-space: -moz-pre-wrap;  /* Mozilla, since 1999 */
 white-space: -pre-wrap;      /* Opera 4-6 */
 white-space: -o-pre-wrap;    /* Opera 7 */
 word-wrap: break-word;       /* Internet Explorer 5.5+ */
} 
```

取自[本站](http://users.tkk.fi/~tkarvine/pre-wrap-css3-mozilla-opera-ie.html)

它目前在 CSS3 中定义（这还不是一个完成的标准），但大多数浏览器似乎都支持它根据评论。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-09T13:01:54.253

你可以只使用 PHP 的[nl2br 函数](http://uk3.php.net/nl2br)。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-01T00:25:39.487

你有两个相互竞争的要求。您要么希望内容适合特定区域（即：宽度：300px），要么希望在用户输入时保留空格和换行符。你不能两者都做，因为一个 - 根据定义 - 会干扰另一个。

由于 HTML 不支持空格，因此您唯一的选择是将多个空格更改为“ ” 并将换行符更改为 <br />，使用 <pre> 标签，或指定 css 样式“white-space: pre”。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-01T00:32:12.170

关于 div 的问题，您始终可以使其滚动，或向下调整字体（这甚至可以根据服务器端代码中最长行的长度动态地进行）。

# c# - 我需要一个 LINQ 表达式来查找元素名称和属性与输入节点匹配的 XElement

> ID：155685
> 
> 赞同：5
> 
> 时间：2008-10-01T00:13:59.373
> 
> 标签：c#, .net, xml, linq, linq-to-xml

当元素名称和所有属性名称和值与输入元素匹配时，我需要替换 XElement 层次结构中节点的内容。（如果没有匹配，可以添加新元素。）

例如，如果我的数据如下所示：

```
<root>
  <thing1 a1="a" a2="b">one</thing1>
  <thing2 a1="a" a2="a">two</thing2>
  <thing2 a1="a" a3="b">three</thing2>
  <thing2 a1="a">four</thing2>
  <thing2 a1="a" a2="b">five</thing2>
<root> 
```

当我使用此输入调用方法时，我想找到最后一个元素：

```
<thing2 a1="a" a2="b">new value</thing2> 
```

该方法不应该有硬编码的元素或属性名称——它只是将输入与数据匹配。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-01T00:59:24.070

这将匹配具有确切标签名称和属性名称/值对的任何给定元素：

```
public static void ReplaceOrAdd(this XElement source, XElement node)
{
    var q = from x in source.Elements()
            where x.Name == node.Name
            && x.Attributes().All(a =>node.Attributes().Any(b =>a.Name==b.Name && a.Value==b.Value))
            select x;

    var n = q.LastOrDefault();

    if (n == null) source.Add(node);
    else n.ReplaceWith(node);                                              
}

var root = XElement.Parse(data);
var newElem =XElement.Parse("<thing2 a1=\"a\" a2=\"b\">new value</thing2>");

root.ReplaceOrAdd(newElem); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-01T00:35:24.657

你可以用路径做一个 XPathSelectElement （不要引用我的话，去过酒吧；早上会清理） /root/thing2[@a1='a' and @a2='b'] 然后取 . LastOrDefault()（XPathSelectElement 是 system.Linq.Xml 中的扩展方法）。

这将为您提供要更改的节点。但是，我不确定您要如何更改它。您得到的结果是实际的 XElement，因此更改它会更改树元素。

# winapi - ChangeServiceConfig 问题设置登录凭据

> ID：155695
> 
> 赞同：2
> 
> 时间：2008-10-01T00:19:43.213
> 
> 标签：winapi, windows-services

我遇到了这个奇怪的问题 - 我正在调用`ChangeServiceConfig`一个新安装的服务（我`CreateService`自己）来提供登录凭据，但是当函数成功（返回 TRUE）时，如果我尝试启动该服务，它会失败并显示1069（登录失败）。如果我进入服务管理器并手动修改凭据（我可以看到用户名是正确的，但当然看不到密码），那么一切正常，它开始正常。

调用本身很简单：

`ChangeServiceConfig(hService, SERVICE_NO_CHANGE, SERVICE_NO_CHANGE, SERVICE_NO_CHANGE, NULL, NULL, NULL, NULL, strUser, strPassword, NULL);`

关于我应该在哪里寻找以及可能出现什么问题的任何想法？

提前致谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-01T00:34:40.883

用户帐户必须明确具有作为服务登录的权限 ( `SeServiceLogonRight`)。许多用户，包括计算机管理员，可能没有设置此标志，您可能需要手动设置它。当您使用它来配置服务时，Windows 服务控制面板实际上会在后台默默地执行此操作。

关于需要完全限定用户名，我也有一些模糊的模糊记忆。它需要采用`DOMAIN\Username`格式 - 如果它是本地帐户，您需要指定`.\Username`或找出机器名称并使用`MACHINENAME\Username`

# javascript - 不明确的 JavaScript 错误 [nsSessionStore.js]

> ID：155697
> 
> 赞同：2
> 
> 时间：2008-10-01T00:20:11.217
> 
> 标签：javascript, firebug

我在 Firebug 中看到一个模棱两可的错误。我不认为它与我正在编写的脚本特别相关，但是我没有足够的细节来单独从这个错误中确定这一点。有没有人看到类似的东西并有建议？

错误：

> [异常...“组件不可用”nsresult：“0x80040111（NS_ERROR_NOT_AVAILABLE）”位置：“JS 框架 :: file:///Applications/Firefox.app/Contents/MacOS/components/nsSessionStore.js :: sss_saveState ： ：第 1896 行“数据：否] [打破此错误] this._writeFile(this._sessionFile, oState.toSource());

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-01T00:29:22.160

我自己也遇到过同样的错误，这是一个内部 FireFox 问题，根本不是您的脚本的问题。它与FireFox状态的保存有关：

根据： http: [//blogs.unbolt.net/index.php/brinley/2008/04/26/0x80040111_nssessionstore](http://blogs.unbolt.net/index.php/brinley/2008/04/26/0x80040111_nssessionstore)，它是由损坏的会话状态引起的。

简而言之，我认为您无法采取任何措施来避免它（它是 FireFox 中的一个错误，或者可能是一个插件）。但是，该链接声称您可以清除会话（通过关闭 FireFox）以在问题出现时解决问题。

* * *

仅供参考，您可能想阅读评论，因为似乎关闭 FireFox 不一定会消除问题......但如果您只关心您的脚本是否有问题，那么请不要担心 :-)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-07T12:34:21.633

把它贴在这里，这样我以后可以找到它：/

修改nsSessionStore.js：this._writeFile(this._sessionFile, oState.toSource()); to: this._writeFile(this._sessionFile, "(" + this._toJSONString(oState) + ")");

BTW, the error is caused by extensions creating browser elements without disabling the history (I don't know what that means either, see [bug](https://bugzilla.mozilla.org/show_bug.cgi?id=366509)). The bug should be fixed in 3.1, see [bug](https://bugzilla.mozilla.org/show_bug.cgi?id=407110).

# php - php 代码库的 i18n 有哪些好的工具/框架？

> ID：155706
> 
> 赞同：3
> 
> 时间：2008-10-01T00:25:16.210
> 
> 标签：php, internationalization

我一直在寻找一些启用动态 php 应用程序本地化和国际化的选项。似乎有各种可用的工具，例如 gettext 和 Yahoo 的 R3，我很想听听开发人员和翻译人员的意见，哪些工具好用，哪些功能对简化实施和翻译任务很重要。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-01T12:54:10.450

PHP gettext 实现工作非常顺利。使用 po edit 和 gettext 的 po 文件是处理本地化的最佳方式，请记住，没有任何一种解决方案可以完全处理各种语言的复杂性。例如，gettext 方法在复数形式上非常好，但我所见过的任何东西都不能处理诸如共轭之类的事情。

有关更多信息，请参阅我的帖子：[如何构建多语言网站？](https://stackoverflow.com/questions/39562/how-do-you-build-a-multi-language-web-site#41379)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-01T00:59:27.080

我们一直在修改[Zend_Translate](http://framework.zend.com/manual/en/zend.translate.html)，因为无论如何我们都使用 Zend 框架。它有很好的记录，到目前为止非常可靠。

过去，我几乎大部分时间都使用自己*的本土*解决方案。这涉及带有常量或变量的语言文件，这些常量或变量包含所有文本部分，并且稍后会在视图/模板中回显。

至于 gettext，过去我听说过有关 PHP 的 gettext 实现有缺陷的参考资料，但我无法真正支持这一点，我现在也没有任何参考资料。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-31T00:11:50.313

pecl 中有许多有用的扩展： [http ://pecl.php.net/packages.php?catpid=28&catname=Internationalization](http://pecl.php.net/packages.php?catpid=28&catname=Internationalization)

特别是，您可能想查看 php-intl，它提供了 International Components for Unicode (ICU) 中的大部分关键 i18n 功能

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-09T02:56:59.193

显示消息的数据库驱动解决方案并不总是好的解决方案，我在一个拥有超过 15 种语言的网站工作，翻译是一个问题。

所以我们的设计是：

*   php-mysql中的翻译应用（翻译访问等）
*   然后翻译是用 php 数组编写的
*   这些阵列也缓存在 APC 中以加快站点速度。

所以要本地化不同的语言，你只需要做一个包含

像

```
<?php
include('lang/en.php');
include('lang/en_us.php'); // this file overrides few keys from the last one.
?> 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-09T02:32:25.747

Xataface 可用于非常轻松地国际化任意 PHP/MySQL 应用程序。它支持静态文本和数据库数据的翻译。您所要做的就是在应用程序的几个地方添加一行或两行代码，就可以了。

[http://xataface.com/documentation/tutorial/internationalization-with-dataface-0.6](http://xataface.com/documentation/tutorial/internationalization-with-dataface-0.6)

# apache-flex - 如何在 Flex 中直观地“突破”容器？

> ID：155712
> 
> 赞同：8
> 
> 时间：2008-10-01T00:28:53.427
> 
> 标签：apache-flex, flash, actionscript-3, mxml

这是我的问题 - 我有一些这样的代码：

```
<mx:Canvas width="300" height="300">
     <mx:Button x="800" />
</mx:Canvas> 
```

所以问题是画布内的按钮有一个超过画布宽度的 x 属性方式 - 因为它是画布的子级，所以画布遮盖它并创建一些滚动条让我滚动到按钮。

我想要的是在没有滚动条的情况下显示按钮 - 画布左侧 800 像素，同时仍将按钮作为画布的子项。我怎么做？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-01T01:13:17.237

我想通了 - 显然 Container 有一个名为 clipContent 的属性 - 这是 Adob​​e 的描述：

*如果此容器的子项的位置和/或大小超出此容器的边界，是否应用剪辑蒙版。如果为 false，则此容器的子项在被移动或调整到此容器边界之外时仍然可见。如果为 true，则此容器的子项将被剪裁。*

*如果 clipContent 为 false，则禁用此容器的滚动并且不会出现滚动条。如果clipContent 为true，那么滚动条通常会在容器的子项超出容器边界时出现。有关对滚动条外观的额外控制，请参阅horizo​​ntalScrollPolicy 和verticalScrollPolicy。默认值是true。*

所以基本上 - 要在容器边界之外显示按钮，我需要执行以下操作：

```
<mx:Canvas width="300" height="300" clipContent="false" >
     <mx:Button x="800" />
</mx:Canvas> 
```

这比我想象的要容易。:)

[这是官方文档...](http://livedocs.adobe.com/flex/3/langref/mx/core/Container.html#clipContent)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-06T18:34:24.927

您还应该能够使用**includeInLayout**属性，这将允许您将它独立地应用于每个子组件。

# language-agnostic - 国际化 Web 应用程序的最佳实践？

> ID：155719
> 
> 赞同：42
> 
> 时间：2008-10-01T00:32:38.470
> 
> 标签：language-agnostic, internationalization

国际化网络应用程序似乎总是一件苦差事。无论您为可插入语言提前计划了多少，总是存在编码问题、不适合您的模板的时髦措辞以及其他问题。

我认为获得 SO 社区对程序员在决定将其 Web 应用程序国际化时应该注意的一组事情的意见会很有用。

* * *

## 回答 #1

> 赞同：59
> 
> 时间：2008-10-15T20:40:42.393

国际化很难，以下是我从使用 20 多种不同语言的 2 个网站中学到的一些东西：

*   到处使用 UTF-8。没有例外。HTML、服务器端语言（尤其要注意 PHP）、数据库等。
*   除非您需要大量工作，否则图像中没有文字。如有必要，使用 CSS 将文本放在图像上。
*   将配置与本地化分开。这样，本地化人员可以翻译文本，您可以处理每个区域设置的不同配置（功能、布局等）。您不希望本地化人员有能力弄乱您的应用程序。
*   确保您的布局可以处理比英语长 2-3 倍的文本。而且也比英语少 50%（日语和中文通常更短）。
*   某些语言需要更大的字体大小（日文、中文）
*   颜色也是特定于语言环境的。红色和绿色在任何地方都不是同一个意思！
*   将作为语言环境名称的类名添加到文档的正文标记中。这样，您可以轻松地在 CSS 文件中指定特定区域设置的布局。
*   注意变量替换。不要分裂你的字符串。像这样让它们保持完整：“您有 X 条新消息”并将“X”替换为 #。
*   不同的语言有不同的复数形式。0、1、2-4、5-7、7-无穷大。很难对付。
*   上下文是困难的。有时本地化人员需要知道字符串在何处/如何使用以确保正确翻译。

资源：

*   [http://interglacial.com/~sburke/tpj/as_html/tpj13.html](http://interglacial.com/~sburke/tpj/as_html/tpj13.html)
*   [http://www.ryandoherty.net/2008/05/26/quick-tips-for-localizing-web-apps/](http://www.ryandoherty.net/2008/05/26/quick-tips-for-localizing-web-apps/)
*   [http://ed.agadak.net/2007/12/one-potato-two-potato-three-potato-four](http://ed.agadak.net/2007/12/one-potato-two-potato-three-potato-four)

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-10-01T14:19:54.207

在我公司，我们所有的字符串都存储在 *.properties 文件中。我们的构建工具构建了属性文件的“测试语言”副本，它替换了如下字符串：

```
Click here 
```

像这样：

```
[~~ Çļïčк н∑ѓё ~~ ﾀｳ ~~] 
```

现在，当我们在配置文件中将语言设置为“测试”时，将使用这些属性文件。（当然我们不提供测试语言文件）。

这使我们能够：

1.  确保正确显示 Unicode 字符，包括日文/中文/韩文。
2.  确保布局适合具有较长单词的语言（特别是德语的平均单词比英语更长）。
3.  找出任何硬编码的字符串（因为它们是纯英语的）。

至于实际翻译，这是由专业翻译人员完成的，而不是开发人员。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2014-04-30T08:40:19.043

作为一个生活在国外的英国人，我对许多 Web 应用程序的国际化方法感到沮丧，并在[博客中讲述了我的挫败感](http://www.planetjones.co.uk/blog/27-04-2014/web-internationalization-often-inconsistent.html)。

我的建议是：

*   考虑如何显示页面的国际版本
*   使用地理定位可能适用于许多用户，但正如我的示例对许多用户显示的那样，它不会
*   为什么不使用 Accept-Language 标头来确定要服务的语言
*   如果用户通过搜索引擎访问页面，则不要将他们重定向到其他地方，例如使用不同语言的主页
*   更改语言并重新加载不同的页面非常烦人 - 要么提供相同的页面，要么在重定向之前警告用户当前内容无法以不同的语言提供
*   英语是一种非常常见的语言，所以可能默认使用它
*   但请确保 GUI 上的更改语言选项清晰（我喜欢谷歌地图正在做的事情，如帖子所示）

我在网上看到的只是公司内部化的错误。从用户的角度来看它确实很棘手。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-01T14:09:01.457

我有几个“双语”应用程序我在 ASP.NET1.1 中使用了资源文件

还有一个叫做字符串资源工具的东西基本上你把所有字符串都放在一个 .RES 文件中，然后根据文化或是否有人点击了该语言的链接来确定要读取的文件

最大的问题是确保翻译正确完成

# c# - 在 C# 的另一个进程内存中搜索特定字符串（或字节数组）的快速方法？

> ID：155721
> 
> 赞同：3
> 
> 时间：2008-10-01T00:33:34.240
> 
> 标签：c#, .net, search, readprocessmemory

请发布一个工作源代码示例（或链接），说明如何在另一个进程内存中搜索字符串并在找到时获取匹配偏移量。类似的方式在游戏作弊工具中使用 ReadProcessMemory 搜索游戏内存中的值。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-01T01:34:15.530

您可能希望将[内存映射文件](http://en.wikipedia.org/wiki/Memory-mapped_file)视为在不同进程之间共享内存的一种方式。您需要使用 Win32 P/Invokes 在 C# 中实现此功能，请参阅此[代码项目](http://www.codeproject.com/KB/dotnet/globalcache.aspx)链接以获取您可以适应的示例。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-01T13:33:00.890

[维基百科上的字符串搜索算法](http://en.wikipedia.org/wiki/String_searching_algorithm)。

# qt - qt/wxwidgets 第三方组件？

> ID：155724
> 
> 赞同：4
> 
> 时间：2008-10-01T00:34:37.063
> 
> 标签：qt, components, wxwidgets

我习惯在 Delphi 和 C# 环境中工作，它们似乎有一组丰富的第三方组件可用。我目前想使用 qt 或 wxwidgets 在 C++ 中进行跨平台编程。第三方组件有很大的市场吗？我在看sourceforge，这似乎并没有显示出太多有用的东西（你怎么在不下载源代码的情况下找出项目中的组件或功能？）。我在考虑轮播/封面流组件，丰富的数据网格（例如 DevExpress 提供的那种）。还是这样，写自己的地盘？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2010-06-08T08:17:05.570

Qt 有一个第三方组件——高级数据网格——Qtitan DataGrid。其中几乎有所有必要的可能性。

超快速处理大型数据集
使用 QStyle 渲染对象，确保网格融入任何应用程序的 UI 设计
两种垂直滚动模式
可自定义行和列颜色
两个集成表格视图
列带和分组
自动调整宽度和高度
固定列
灵活排序
列摘要
集成高性能缓存机制
高级绘制引擎，用于更快地呈现 UI 元素
跨平台支持
API 用于外部编辑器

关于这个网格的截图 [http://www.devmachines.com/qtitan_screenshots.php](http://www.devmachines.com/qtitan_screenshots.php)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-01T01:16:10.100

有许多高质量的第三方 Qt 库，尽管我不知道有一个集中的资源可以找到它们。

几个地方开始寻找：

*   [http://www.ics.com/products/qt/addons](http://www.ics.com/products/qt/addons/)

    [ICS](http://www.ics.com)提供 [QicsTable](http://www.ics.com/products/qt/qicstable/)，一个高性能的模型-视图-委托表库，并通过 KDAB 转售各种库。（这些都可以免费下载。）

*   [http://www.qtcentre.org/contest-first-edition/finalists](http://www.qtcentre.org/contest-first-edition/finalists)

    [QtCentre](http://www.qtcentre.org)有一个年度编程竞赛，奖励有趣的基于 Qt 的工具和库。今年的比赛仍在评审中，但去年的决赛选手可以在上面的链接中看到。查看 Custom Widget 和 Helper Library 类别。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-15T08:45:30.400

对于跨平台 GUI 开发，Qt 是您应该寻找的工具。我都用过。这是我对 Qt 的感受

如果您使用 Qt，构建丰富的 GUI 是小菜一碟。它有大量的 GUI 功能，首先是它的图形视图、OpenGL 支持、支持 css 的样式表。一个成熟的绘画系统，Richtext 格式，与 Webkit 的集成，我相信我在这里还缺少很多……

Qt 有自己的构建系统，qmake，它创建平台相关的 Makefile，所以没有 Makefile 的麻烦。此外，您会得到一个更易于管理的配置文件。对于 wxWidgets，您需要为您打算使用的各种编译器创建不同的 Makefile。

使用 Qt 而不是 wxWidgets 的其他优点是 - Api 非常容易学习，它具有直观的 api、一流的文档和大量的示例。这可以帮助您很快提高自己的工作效率，从而让您的产品及早进行标记。BTW Qt 是一个 RAD 工具。此外，还有庞大的用户群，还有像 QtCentre.org 这样的论坛可以帮助您解决问题。如果您打算购买商业许可证，您可以直接从 Qt Software (trolltech) 获得支持。

您显然会使用 Qt 的模型视图模式，允许您将业务逻辑与表示层分离。我建议您写信给“奇趣科技的支持”或“奇趣科技的销售”以获取更多信息。您可以解释您的要求，他们将能够解释 Qt 如何满足您的需求。

您还可以下载开源版本并查看演示。[封面流：http :](http://ariya.blogspot.com/2008/03/introducing-photoflow.html) //labs.trolltech.com/blogs/2007/11/02/pictureflow-on-windows-mobile/，http : [//ariya.blogspot.com/2008/03/introducing-photoflow.html](http://labs.trolltech.com/blogs/2007/11/02/pictureflow-on-windows-mobile/)

正如我所说，如果您打算开发它的 Rich gui，请使用 Qt。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-01T04:02:13.193

除了 ICS 和 QtCentre 的那些之外，[Qt-apps](http://www.qt-apps.org/index.php?xcontentmode=4298)网站还有一些用于 Qt 的开源小部件/组件。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-22T23:09:28.020

对于 wxWidgets，你有[wxCode](http://wxcode.sourceforge.net/)，它有很多东西，尽管并非所有现有的第三方组件（包括一些非常有用的组件）都可以从那里获得。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2014-01-15T10:43:12.940

可以在这里找到 Qt 的优质组件 - [http://www.devmachines.com/](http://www.devmachines.com/)

目前有用于 Qt 的 Microsoft Ribbon Control、用于 Qt 的 DataGrid、用于 Qt 的 Charting。所有组件都是商业的，应该在 Qt Commercial 或 Qt LGPL 中使用。

# sql-server - (local), '.' 之间有区别吗？和本地主机？

> ID：155733
> 
> 赞同：32
> 
> 时间：2008-10-01T00:39:11.373
> 
> 标签：sql-server, connection-string

在建立与数据库的本地编程连接时，我已经使用了所有这三个。它们之间有什么真正的区别吗？

* * *

## 回答 #1

> 赞同：36
> 
> 时间：2008-10-01T00:44:51.670

最后的结果是一样的。区别在于：

*   'localhost' 在 TCP/IP 级别解析，相当于 IP 地址 127.0.0.1
*   根据应用程序“（本地）”可能只是“本地主机”的别名。在 SQLServer 中，“（本地）”和“。” 意味着将在同一台机器内使用命名管道（共享内存）协议建立连接（不需要通过 TCP/IP 堆栈）。

这就是理论。在实践中，如果您使用其中任何一种，我认为性能或功能不会有实质性差异。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-01T00:40:56.533

它们通常是同义词。但是，这取决于您正在配置的应用程序。只要应用程序理解您的意思，它就不会导致性能损失。至少，如果你明白我的意思，你不必过早地根除。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-01T00:53:59.607

据我所知，点***“。”*** 和***“本地”***是 Windows 应用程序术语，而不是“标准”术语，***localhost***在 TCP/IP 级别解析为***127.0.0.1***，因此如果您想确保跨平台“兼容”，您应该使用 localhost 或 127.0。 0.1

# javascript - 检测未保存的更改

> ID：155739
> 
> 赞同：97
> 
> 时间：2008-10-01T00:41:28.480
> 
> 标签：javascript, asp.net, prompt

我需要在 ASP .Net 应用程序中实现“未保存的更改”提示。如果用户修改 Web 表单上的控件，并在保存前尝试离开，则会出现提示，警告他们有未保存的更改，并为他们提供取消并留在当前页面的选项。如果用户没有触摸任何控件，则不应显示提示。

理想情况下，我想在 JavaScript 中实现这一点，但在我开始编写自己的代码之前，是否有任何现有的框架或推荐的设计模式来实现这一点？理想情况下，我想要一些可以轻松地在多个页面中重复使用的东西，并且只需最少的更改。

* * *

## 回答 #1

> 赞同：98
> 
> 时间：2008-10-01T01:26:36.953

使用 jQuery：

```
var _isDirty = false;
$("input[type='text']").change(function(){
  _isDirty = true;
});
// replicate for other input types and selects 
```

根据需要结合`onunload`/`onbeforeunload`方法。

从评论中，以下引用了所有输入字段，没有重复代码：

```
$(':input').change(function () { 
```

Using`$(":input")`指的是所有的 input、textarea、select 和 button 元素。

* * *

## 回答 #2

> 赞同：47
> 
> 时间：2008-10-01T01:09:46.557

一块拼图：

```
/**
 * Determines if a form is dirty by comparing the current value of each element
 * with its default value.
 *
 * @param {Form} form the form to be checked.
 * @return {Boolean} <code>true</code> if the form is dirty, <code>false</code>
 *                   otherwise.
 */
function formIsDirty(form) {
  for (var i = 0; i < form.elements.length; i++) {
    var element = form.elements[i];
    var type = element.type;
    if (type == "checkbox" || type == "radio") {
      if (element.checked != element.defaultChecked) {
        return true;
      }
    }
    else if (type == "hidden" || type == "password" ||
             type == "text" || type == "textarea") {
      if (element.value != element.defaultValue) {
        return true;
      }
    }
    else if (type == "select-one" || type == "select-multiple") {
      for (var j = 0; j < element.options.length; j++) {
        if (element.options[j].selected !=
            element.options[j].defaultSelected) {
          return true;
        }
      }
    }
  }
  return false;
} 
```

[还有一个](http://developer.mozilla.org/en/DOM/window.onbeforeunload)：

```
window.onbeforeunload = function(e) {
  e = e || window.event;  
  if (formIsDirty(document.forms["someForm"])) {
    // For IE and Firefox
    if (e) {
      e.returnValue = "You have unsaved changes.";
    }
    // For Safari
    return "You have unsaved changes.";
  }
}; 
```

总结一下，你会得到什么？

```
var confirmExitIfModified = (function() {
  function formIsDirty(form) {
    // ...as above
  }

  return function(form, message) {
    window.onbeforeunload = function(e) {
      e = e || window.event;
      if (formIsDirty(document.forms[form])) {
        // For IE and Firefox
        if (e) {
          e.returnValue = message;
        }
        // For Safari
        return message;
      }
    };
  };
})();

confirmExitIfModified("someForm", "You have unsaved changes."); 
```

您可能还希望将`beforeunload`事件处理程序的注册更改为使用`LIBRARY_OF_CHOICE`的事件注册。

* * *

## 回答 #3

> 赞同：17
> 
> 时间：2008-10-01T00:51:45.557

在 .aspx 页面中，您需要一个 Javascript 函数来判断表单信息是否“脏”

```
<script language="javascript">
    var isDirty = false;

    function setDirty() {
        isDirty = true;
    }

    function checkSave() {
        var sSave;
        if (isDirty == true) {
            sSave = window.confirm("You have some changes that have not been saved. Click OK to save now or CANCEL to continue without saving.");
            if (sSave == true) {
                document.getElementById('__EVENTTARGET').value = 'btnSubmit';
                document.getElementById('__EVENTARGUMENT').value = 'Click';  
                window.document.formName.submit();
            } else {
                 return true;
            }
        }
    }
</script>
<body class="StandardBody" onunload="checkSave()"> 
```

并在代码隐藏中，将触发器添加到输入字段以及重置提交/取消按钮......

```
btnSubmit.Attributes.Add("onclick", "isDirty = 0;");
btnCancel.Attributes.Add("onclick", "isDirty = 0;");
txtName.Attributes.Add("onchange", "setDirty();");
txtAddress.Attributes.Add("onchange", "setDirty();");
//etc.. 
```

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2009-11-16T19:35:06.747

下面使用浏览器的 onbeforeunload 函数和 jquery 来捕获任何 onchange 事件。IT 还寻找任何提交或重置按钮来重置指示已发生更改的标志。

```
dataChanged = 0;     // global variable flags unsaved changes      

function bindForChange(){    
     $('input,checkbox,textarea,radio,select').bind('change',function(event) { dataChanged = 1})
     $(':reset,:submit').bind('click',function(event) { dataChanged = 0 })
}

function askConfirm(){  
    if (dataChanged){ 
        return "You have some unsaved changes.  Press OK to continue without saving." 
    }
}

window.onbeforeunload = askConfirm;
window.onload = bindForChange; 
```

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2008-10-01T23:45:27.657

谢谢大家的回复。我最终使用 JQuery 和[Protect-Data](http://code.google.com/p/protect-data/)插件实现了一个解决方案。这使我可以自动将监视应用于页面上的所有控件。

但是有一些注意事项，尤其是在处理 ASP .Net 应用程序时：

*   当用户选择取消选项时，doPostBack 函数将引发 JavaScript 错误。我不得不手动在 doPostBack 中的 .submit 调用周围放置一个 try-catch 来抑制它。

*   在某些页面上，用户可以执行回发到同一页面的操作，但不是保存。这会导致任何 JavaScript 逻辑重置，因此它认为在回发之后没有任何变化，而可能发生了某些事情。我必须实现一个隐藏的文本框，它与页面一起回发，用于保存一个简单的布尔值，指示数据是否脏。这会在回发中持续存在。

*   您可能希望页面上的某些回发不会触发对话框，例如保存按钮。在这种情况下，您可以使用 JQuery 添加一个 OnClick 函数，该函数将 window.onbeforeunload 设置为 null。

希望这对必须实现类似功能的其他人有所帮助。

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2015-05-21T12:57:01.500

通用解决方案在给定页面中支持多个表单（**只需复制并粘贴到您的项目中**）

```
$(document).ready(function() {
    $('form :input').change(function() {
        $(this).closest('form').addClass('form-dirty');
    });

    $(window).bind('beforeunload', function() {
        if($('form:not(.ignore-changes).form-dirty').length > 0) {
            return 'You have unsaved changes, are you sure you want to discard them?';
        }
    });

    $('form').bind('submit',function() {
        $(this).closest('form').removeClass('form-dirty');
        return true;
    });
}); 
```

注意：此解决方案与其他解决方案相结合，创建通用集成解决方案。

特征：

*   只需复制并粘贴到您的应用程序中即可。
*   支持多种形式。
*   您可以设置样式或使动作变脏，因为它们具有“form-dirty”类。
*   您可以通过添加“忽略更改”类来排除某些表单。

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2009-05-25T09:17:48.333

以下解决方案适用于原型（在 FF、IE 6 和 Safari 中测试）。它使用通用表单观察器（当表单的任何字段被修改时触发 form:changed），您也可以将其用于其他内容。

```
/* use this function to announce changes from your own scripts/event handlers.
 * Example: onClick="makeDirty($(this).up('form'));"
 */
function makeDirty(form) {
    form.fire("form:changed");
}

function handleChange(form, event) {
    makeDirty(form);
}

/* generic form observer, ensure that form:changed is being fired whenever
 * a field is being changed in that particular for
 */
function setupFormChangeObserver(form) {
    var handler = handleChange.curry(form);

    form.getElements().each(function (element) {
        element.observe("change", handler);
    });
}

/* installs a form protector to a form marked with class 'protectForm' */
function setupProtectForm() {
    var form = $$("form.protectForm").first();

    /* abort if no form */
    if (!form) return;

    setupFormChangeObserver(form);

    var dirty = false;
    form.observe("form:changed", function(event) {
        dirty = true;
    });

    /* submitting the form makes the form clean again */
    form.observe("submit", function(event) {
        dirty = false;
    });

    /* unfortunatly a propper event handler doesn't appear to work with IE and Safari */
    window.onbeforeunload = function(event) {
        if (dirty) {
            return "There are unsaved changes, they will be lost if you leave now.";
        }
    };
}

document.observe("dom:loaded", setupProtectForm); 
```

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2013-10-22T18:36:34.783

这是一个简单的 javascript / jquery 解决方案。它解释了用户的“撤消”，它被封装在一个函数中以便于应用，并且它不会在提交时出错。只需调用该函数并传递表单的 ID。

此函数在页面加载时序列化表单一次，并在用户离开页面之前再次序列化。如果两个表单状态不同，则会显示提示。

试试看：http: [//jsfiddle.net/skibulk/Ydt7Y/](http://jsfiddle.net/skibulk/Ydt7Y/)

```
function formUnloadPrompt(formSelector) {
    var formA = $(formSelector).serialize(), formB, formSubmit = false;

    // Detect Form Submit
    $(formSelector).submit( function(){
        formSubmit = true;
    });

    // Handle Form Unload    
    window.onbeforeunload = function(){
        if (formSubmit) return;
        formB = $(formSelector).serialize();
        if (formA != formB) return "Your changes have not been saved.";
    };
}

$(function(){
    formUnloadPrompt('form');
}); 
```

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2012-04-30T19:35:46.393

[我最近为一个名为dirtyForms](https://github.com/snikch/jquery.dirtyforms)的开源jQuery 插件做出了贡献。

该插件旨在处理动态添加的 HTML，支持多种表单，几乎可以支持任何对话框框架，在卸载对话框之前回退到浏览器，具有可插入的帮助框架以支持从自定义编辑器获取脏状态（包括 tinyMCE 插件） , 在 iF​​rames 内工作，脏状态可以随意设置或重置。

[https://github.com/snikch/jquery.dirtyforms](https://github.com/snikch/jquery.dirtyforms)

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2014-12-15T10:48:19.390

使用 jQuery 检测表单更改非常简单：

```
var formInitVal = $('#formId').serialize(); // detect form init value after form is displayed

// check for form changes
if ($('#formId').serialize() != formInitVal) {
    // show confirmation alert
} 
```

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2012-02-14T05:17:24.780

我在上面 Slace 的建议上进行了扩展，包括大多数可编辑元素，并排除了某些元素（此处使用名为“srSearch”的 CSS 样式）导致设置脏标志。

```
<script type="text/javascript">
        var _isDirty = false;
        $(document).ready(function () {            

            // Set exclude CSS class on radio-button list elements
            $('table.srSearch input:radio').addClass("srSearch");

            $("input[type='text'],input[type='radio'],select,textarea").not(".srSearch").change(function () {
                _isDirty = true;
            });
        });

        $(window).bind('beforeunload', function () {
            if (_isDirty) {
                return 'You have unsaved changes.';
            }
        }); 
```

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2014-07-08T06:10:07.773

```
 var unsaved = false;
    $(":input").change(function () {         
        unsaved = true;
    });

    function unloadPage() {         
        if (unsaved) {             
          alert("You have unsaved changes on this page. Do you want to leave this page and discard your changes or stay on this page?");
        }
    } 
```

window.onbeforeunload = 卸载页面；

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2008-10-02T01:32:28.677

这正是 Fleegix.js 插件`fleegix.form.diff`([http://js.fleegix.org/plugins/form/diff](http://js.fleegix.org/plugins/form/diff)）是为创建的。使用`fleegix.form.toObject`([http://js.fleegix.org/ref#fleegix.form.toObject](http://js.fleegix.org/ref#fleegix.form.toObject)`fleegix.form.diff` ）并将其保存在变量中，然后使用on unload与当前状态进行比较。非常简单。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2020-11-17T08:10:31.860

很多过时的答案，所以这里有一些更现代的东西。

ES6

```
let dirty = false
document.querySelectorAll('form').forEach(e => e.onchange = () => dirty = true) 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-10-01T00:56:05.717

[一种方法](http://www.4guysfromrolla.com/demos/OnBeforeUnloadDemo3.htm)，使用数组来保存变量，以便跟踪变化。

这是一个非常简单的[检测变化](http://gadgetopia.com/post/2507)的方法，但其余的就没有那么优雅了。

[Farfetched Blog](http://farfetched.blogspot.com/2005/03/warn-of-unsaved-changes-javascript.html)中的另一种相当简单且小巧的方法：

```
<body onLoad="lookForChanges()" onBeforeUnload="return warnOfUnsavedChanges()">
<form>
<select name=a multiple>
 <option value=1>1
 <option value=2>2
 <option value=3>3
</select>
<input name=b value=123>
<input type=submit>
</form>

<script>
var changed = 0;
function recordChange() {
 changed = 1;
}
function recordChangeIfChangeKey(myevent) {
 if (myevent.which && !myevent.ctrlKey && !myevent.ctrlKey)
  recordChange(myevent);
}
function ignoreChange() {
 changed = 0;
}
function lookForChanges() {
 var origfunc;
 for (i = 0; i < document.forms.length; i++) {
  for (j = 0; j < document.forms[i].elements.length; j++) {
   var formField=document.forms[i].elements[j];
   var formFieldType=formField.type.toLowerCase();
   if (formFieldType == 'checkbox' || formFieldType == 'radio') {
    addHandler(formField, 'click', recordChange);
   } else if (formFieldType == 'text' || formFieldType == 'textarea') {
    if (formField.attachEvent) {
     addHandler(formField, 'keypress', recordChange);
    } else {
     addHandler(formField, 'keypress', recordChangeIfChangeKey);
    }
   } else if (formFieldType == 'select-multiple' || formFieldType == 'select-one') {
    addHandler(formField, 'change', recordChange);
   }
  }
  addHandler(document.forms[i], 'submit', ignoreChange);
 }
}
function warnOfUnsavedChanges() {
 if (changed) {
  if ("event" in window) //ie
   event.returnValue = 'You have unsaved changes on this page, which will be discarded if you leave now. Click "Cancel" in order to save them first.';
  else //netscape
   return false;
 }
}
function addHandler(target, eventName, handler) {
 if (target.attachEvent) {
  target.attachEvent('on'+eventName, handler);
 } else {
  target.addEventListener(eventName, handler, false);
 }
}
</script> 
```

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2015-07-06T06:04:52.413

在 IE 中 document.ready 将无法正常工作，它会更新输入的值。

所以我们需要在 document.ready 函数中绑定加载事件，该函数也将处理 IE 浏览器。

下面是您应该放在 document.ready 函数中的代码。

```
 $(document).ready(function () {
   $(window).bind("load", function () { 
    $("input, select").change(function () {});
   });
}); 
```

# java - Java中的远程打印模块

> ID：155740
> 
> 赞同：2
> 
> 时间：2008-10-01T00:41:48.683
> 
> 标签：java, printing

我正在开发一个应用程序，该应用程序将运行基于 Web 的销售点界面。

销售点 PC（目前我不确定它是否会在 Linux 或 Windows 上运行）必须连接一台财务打印机，但与任何 Web 应用程序一样，它是处理所有内容的服务器。服务器和 PoS 机器都在同一个 LAN 上。

我必须通过使用串口的财务打印机实时发送销售数据，因此打印 PDF 甚至网页都不是一种选择。

有人告诉我，我可以有一个小应用程序在客户端上侦听 Web 服务，该应用程序反过来与打印机而不是服务器或浏览器对话，但不知道如何去做。此外，我很可能需要听取任何打印机反馈（例如，由打印机生成的优惠券编号）并将其交回服务器。

有任何想法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-01T00:58:33.837

几年前我做了类似的事情。前。但在我的情况下，服务器和 PC 在同一个局域网中。你的 PoS 在局域网内吗？如果是这样，我会向你解释。

同时，如果您有“小应用程序”，您可以查看以下内容：

[http://java.sun.com/j2se/1.4.2/docs/api/javax/print/PrintService.html](http://java.sun.com/j2se/1.4.2/docs/api/javax/print/PrintService.html)

打印服务有一种方法可以发现在它运行的机器上注册的打印机。因此，当您在应用程序上收到来自服务器的消息后，您只需执行类似于上面链接中显示的代码的操作：

取自，[http://java.sun.com/j2se/1.4.2/docs/api/javax/print/PrintService.html](http://java.sun.com/j2se/1.4.2/docs/api/javax/print/PrintService.html)

```
DocFlavor flavor = DocFlavor.INPUT_STREAM.POSTSCRIPT;
PrintRequestAttributeSet aset = new HashPrintRequestHashAttributeSet();
aset.add(MediaSizeName.ISO_A4);
PrintService[] pservices =
             PrintServiceLookup.lookupPrintServices(flavor, aset);
if (pservices.length > 0) {
   DocPrintJob pj = pservices[0].createPrintJob();
   // InputStreamDoc is an implementation of the Doc interface //
   Doc doc = new InputStreamDoc("test.ps", flavor);
   try {
         pj.print(doc, aset);
    } catch (PrintException e) { 
    }
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-01T01:30:48.970

这就是为什么你有小程序。但是小程序在安全沙箱中运行。但是，如果给在 webapp 中运行的小程序适当的权限，它可以打开套接字、写入文件、写入串行端口等。

# c# - .net 中的提供者模型

> ID：155742
> 
> 赞同：8
> 
> 时间：2008-10-01T00:43:19.943
> 
> 标签：c#, .net, provider-model

当 .net 2.0 框架刚问世时，提供者模型风靡一时。2.0 甚至附带了一堆默认提供程序（会员、站点地图、角色）。自从 2.0 发布以来，炒作已经平息，虽然我仍然每天都在使用提供者，但它似乎得到的新闻要少得多。

我想知道这是否是因为人们使用了提供者以外的东西并且它们已被取代，或者仅仅是因为使用量没有其他 IoC 方法那么大？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-01T00:47:50.137

它实际上并没有消亡。DI仍然很大。有许多 DI 框架可供选择。**是的，它并没有像它绝对应该那样**硬生生地融入到**每个部分**框架中，但它仍然是一个非常好的实践。例如，我使用 P&P 的自定义应用程序块来执行 DI。直到他们放弃了 Unity。现在我正在使用统一。

 **轻量级 DI 框架对于任何大型可扩展应用程序都是一个好主意。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-01T07:57:14.177

我认为，随着这些工具在 .NET 中变得更加标准，围绕它们的炒作变得越来越少，但它们的使用却没有。当然，成员资格和角色提供者对于我们正在开发的新应用程序非常重要，并且将为我们节省大量代码。

[Microsoft Patterns and Practices](http://msdn.microsoft.com/en-us/practices/default.aspx)是 Enterprise Library 等工具的诞生地，它与 Security Applicaiton 块的提供者模式（尤其是成员资格）密切相关，并且该模型似乎在整个块中使用。

# php - 在生成的数据中检查而不是打印 JavaScript？

> ID：155751
> 
> 赞同：2
> 
> 时间：2008-10-01T00:46:29.000
> 
> 标签：php, javascript, security

在我的 php web 应用程序中，假设我想加倍努力，除了去帮派克星和对清理我的输入保持警惕之外，我还想确保在我插入到 html 的字符串中没有 JavaScript 输出模板。

有没有一种标准方法可以确保我不会将 JavaScript 放入生成的 html 内容中？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-01T03:25:14.610

如果您不反对外部依赖，那么[HTML Purifier 库](http://htmlpurifier.org/)对于大多数 XSS 攻击来说是一个很好的过滤器。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-01T15:58:25.343

在 PHP 中，我将从 strip_tags 开始。像这样：

```
$output = strip_tags($input); 
```

如果我想在用户输入中允许一些标签，我会包括它们，如下所示：

```
$output = strip_tags($input, '<code><em><strong>'); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-01T16:48:28.267

我认为不可能找到这样的 javascript 代码。

您必须通过某种类型的解释器传递数据才能尝试找到有效的 js 语句。这将占用大量处理器资源，并且可能会根据文本的性质产生许多误报。

实体转义元字符可能是进一步保护您的应用程序免受过滤器可能遗漏的攻击的最佳方式。如果将 Javascript 作为常规文本加载，则无法运行 Javascript。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-01T00:54:10.807

不完全是标准方式；因为如果你在做: `<img src="${path}">`, 并`${path}`扩展到 `http://p0wned.com/jpg.jpg" /><script src="p0wned.com/js.js"/>`

无论如何，我喜欢这个正则表达式：

```
#from http://www.perlmonks.org/?node_id=161281
sub untag {
  local $_ = $_[0] || $_;
# ALGORITHM:
#   find < ,
#       comment <!-- ... -->,
#       or comment <? ... ?> ,
#       or one of the start tags which require correspond
#           end tag plus all to end tag
#       or if \s or ="
#           then skip to next "
#           else [^>]
#   >
  s{
    <               # open tag
    (?:             # open group (A)
      (!--) |       #   comment (1) or
      (\?) |        #   another comment (2) or
      (?i:          #   open group (B) for /i
        ( TITLE  |  #     one of start tags
          SCRIPT |  #     for which
          APPLET |  #     must be skipped
          OBJECT |  #     all content
          STYLE     #     to correspond
        )           #     end tag (3)
      ) |           #   close group (B), or
      ([!/A-Za-z])  #   one of these chars, remember in (4)
    )               # close group (A)
    (?(4)           # if previous case is (4)
      (?:           #   open group (C)
        (?!         #     and next is not : (D)
          [\s=]     #       \s or "="
          ["`']     #       with open quotes
        )           #     close (D)
        [^>] |      #     and not close tag or
        [\s=]       #     \s or "=" with
        `[^`]*` |   #     something in quotes ` or
        [\s=]       #     \s or "=" with
        '[^']*' |   #     something in quotes ' or
        [\s=]       #     \s or "=" with
        "[^"]*"     #     something in quotes "
      )*            #   repeat (C) 0 or more times
    |               # else (if previous case is not (4))
      .*?           #   minimum of any chars
    )               # end if previous char is (4)
    (?(1)           # if comment (1)
      (?<=--)       #   wait for "--"
    )               # end if comment (1)
    (?(2)           # if another comment (2)
      (?<=\?)       #   wait for "?"
    )               # end if another comment (2)
    (?(3)           # if one of tags-containers (3)
      </            #   wait for end
      (?i:\3)       #   of this tag
      (?:\s[^>]*)?  #   skip junk to ">"
    )               # end if (3)
    >               # tag closed
   }{}gsx;          # STRIP THIS TAG
  return $_ ? $_ : "";
} 
```

# c# - C# 中的安全句柄

> ID：155780
> 
> 赞同：18
> 
> 时间：2008-10-01T00:57:58.253
> 
> 标签：c#, .net

什么是安全手柄？它与 IntPtr 有何不同？我什么时候应该使用一个？它的优点是什么？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-10-01T05:23:10.677

另一种看待它的方式：使用 SafeHandle，您*几乎*不需要编写另一个终结器。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-10-01T01:01:11.960

我认为[MSDN](http://msdn.microsoft.com/en-us/library/system.runtime.interopservices.safehandle.aspx)的定义很明确：

> SafeHandle 类提供句柄资源的关键终结，防止句柄被垃圾收集过早回收，并防止句柄被 Windows 回收以引用非预期的非托管对象。在 .NET Framework 2.0 版之前，所有操作系统句柄只能封装在 IntPtr 托管包装对象中。
> 
> SafeHandle 类包含一个终结器，可确保句柄已关闭并保证运行，即使在主机可能不信任 AppDomain 状态一致性的意外 AppDomain 卸载期间也是如此。
> 
> 有关使用 SafeHandle 的好处的更多信息，请参阅安全句柄和关键终结。
> 
> 此类是抽象的，因为您无法创建通用句柄。要实现 SafeHandle，您必须创建一个派生类。要创建 SafeHandle 派生类，您必须知道如何创建和释放操作系统句柄。这个过程对于不同的句柄类型是不同的，因为一些使用 CloseHandle，而另一些使用更具体的方法，例如 UnmapViewOfFile 或 FindClose。为此，您必须为每个操作系统句柄类型创建一个 SafeHandle 派生类；例如 MySafeRegistryHandle、MySafeFileHandle 和 MySpecialSafeFileHandle。其中一些派生类是预先编写的，并在 Microsoft.Win32.SafeHandles 命名空间中为您提供。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2014-12-12T22:50:39.047

在托管代码从非托管代码接收 IntPtr 的情况下，您应该尽可能使用 SafeHandle 的派生类。虽然 SafeHandle 类的名称、一般用途甚至文档都暗示它只应该用于包含 Windows 操作系统句柄、一些内部 .NET 框架类，例如 Microsoft.Win32.SafeHandles.SafeLocalAllocHandle 以及派生的那些来自公开可用的抽象类[System.Runtime.InteropServices.SafeBuffer](http://msdn.microsoft.com/en-us/library/vstudio/system.runtime.interopservices.safebuffer(v=vs.100).aspx)也使用它来保证释放其他非托管资源，例如动态分配的结构和数组。通常，我认为，只要将 IntPtr 从非托管代码返回到托管代码，即使不需要清理，创建此类的派生类也是一种很好的做法。

SafeHandle 的既定目的是保证即使世界即将结束（例如，正在卸载 AppDomain 或发生 StackOverflowException），.NET 框架也应绝对确保调用 SafeHandle 的终结器以关闭或解除分配非托管被包装的 IntPtr 引用的实体。[SafeHandle 类通过从CriticalFinalizerObject](http://msdn.microsoft.com/en-us/library/vstudio/system.runtime.constrainedexecution.criticalfinalizerobject(v=vs.100).aspx)继承来实现这一点班级。然而，从这个类继承确实给继承者带来了在调用终结器时不完全搞砸进程状态的义务，这可能是为什么它不经常用于 Windows 操作系统句柄以外的实体的原因。.NET 框架还提供了一些弱终结排序，因此可以安全地与任何不从 CriticalFinalizerObject 继承的类的终结器中的 SafeHandle 对象进行交互，但需要这样做的情况应该很少见。

理想情况下，还应该使用 SafeHandle 派生类通过在派生类中封装预期功能来更安全地与非托管实体引用进行交互。一个从 SafeHandle 继承的编写良好的类应该有一个特定的目的，并且应该提供足以防止任何开发人员出于该目的使用它的方法，而无需直接与其包含的 IntPtr 交互。添加此类方法还可以让其他开发人员清楚地了解非托管方法调用的结果将用于托管上下文中的用途。继承自 SafeHandle 的类可用于此目的，即使不需要对非托管方法通过调用类的构造函数中的 base(false) 返回的指针进行清理。

下面的两个示例使用派生自 SafeHandle 的类来安全地清理对非托管实体的引用并封装与非托管实体相关的功能。The first example is a more traditional scenario in which a user token returned by [LogonUser](http://msdn.microsoft.com/en-us/library/windows/desktop/aa378184(v=vs.85).aspx) is wrapped by an instance of the SafeTokenHandle class. 当对象被释放或最终确定时，此类将在令牌上调用 CloseHandle。它还包括一个名为 GetWindowsIdentity 的方法，该方法为用户令牌所代表的用户返回一个 WindowsIdentity 对象。第二个示例使用 Windows 内置函数[CommandLineToArgvW](http://www.bing.com/search?q=CommandLineToArgvW&form=DLCDF8&pc=MDDC&src=IE-SearchBox)解析命令行。此函数返回一个指向包含连续内存块的数组的指针，该内存块可以通过一次调用 LocalFree 来释放。SafeLocalAllocWStrArray 类（继承自 SafeLocalAllocArray 类，该类也在本示例中定义）将在对象被释放或最终确定时调用数组上的 LocalFree。它还包括一个将非托管数组的内容复制到托管数组的函数。

```
static class Examples
{
    static void Example1_SafeUserToken()
    {
        const string user = "SomeLocalUser";
        const string domain = null;
        const string password = "ExamplePassword";
        NativeMethods.SafeTokenHandle userToken;
        WindowsIdentity identity;

        NativeMethods.LogonUser(user, domain, password, NativeMethods.LogonType.LOGON32_LOGON_INTERACTIVE, NativeMethods.LogonProvider.LOGON32_PROVIDER_DEFAULT, out userToken);

        using (userToken)
        {
            // get a WindowsIdentity object for the user
            // WindowsIdentity will duplicate the token, so it is safe to free the original token after this is called
            identity = userToken.GetWindowsIdentity();
        }

        // impersonate the user
        using (identity)
        using (WindowsImpersonationContext impersonationContext = identity.Impersonate())
        {
            Console.WriteLine("I'm running as {0}!", Thread.CurrentPrincipal.Identity.Name);
        }
    }

    static void Example2_SafeLocalAllocWStrArray()
    {
        const string commandLine = "/example /command";
        int argc;
        string[] args;

        using (NativeMethods.SafeLocalAllocWStrArray argv = NativeMethods.CommandLineToArgvW(commandLine, out argc))
        {
            // CommandLineToArgvW returns NULL on failure; since SafeLocalAllocWStrArray inherits from
            // SafeHandleZeroOrMinusOneIsInvalid, it will see this value as invalid
            // if that happens, throw an exception containing the last Win32 error that occurred
            if (argv.IsInvalid)
            {
                int lastError = Marshal.GetHRForLastWin32Error();
                throw new Win32Exception(lastError, "An error occurred when calling CommandLineToArgvW.");
            }

            // the one unsafe aspect of this is that the developer calling this function must be trusted to
            // pass in an array of length argc or specify the length of the copy as the value of argc
            // if the developer does not do this, the array may end up containing some garbage or an
            // AccessViolationException could be thrown
            args = new string[argc];
            argv.CopyTo(args);
        }

        for (int i = 0; i < args.Length; ++i)
        {
            Console.WriteLine("Argument {0}: {1}", i, args[i]);
        }
    }
}

/// <summary>
/// P/Invoke methods and helper classes used by this example.
/// </summary>
internal static class NativeMethods
{
    // documentation: http://msdn.microsoft.com/en-us/library/windows/desktop/aa378184(v=vs.85).aspx
    [DllImport("advapi32.dll", SetLastError = true, CharSet = CharSet.Unicode)]
    public static extern bool LogonUser(string lpszUsername, string lpszDomain, string lpszPassword, LogonType dwLogonType, LogonProvider dwLogonProvider, out SafeTokenHandle phToken);

    // documentation: http://msdn.microsoft.com/en-us/library/windows/desktop/ms724211(v=vs.85).aspx
    [DllImport("kernel32.dll", SetLastError = true)]
    public static extern bool CloseHandle(IntPtr handle);

    // documentation: http://msdn.microsoft.com/en-us/library/windows/desktop/bb776391(v=vs.85).aspx
    [DllImport("shell32.dll", CharSet = CharSet.Unicode, SetLastError = true)]
    public static extern SafeLocalAllocWStrArray CommandLineToArgvW(string lpCmdLine, out int pNumArgs);

    // documentation: http://msdn.microsoft.com/en-us/library/windows/desktop/aa366730(v=vs.85).aspx
    [DllImport("kernel32.dll", SetLastError = true)]
    public static extern IntPtr LocalFree(IntPtr hLocal);

    /// <summary>
    /// Wraps a handle to a user token.
    /// </summary>
    public class SafeTokenHandle : SafeHandleZeroOrMinusOneIsInvalid
    {
        /// <summary>
        /// Creates a new SafeTokenHandle. This constructor should only be called by P/Invoke.
        /// </summary>
        private SafeTokenHandle()
            : base(true)
        {
        }

        /// <summary>
        /// Creates a new SafeTokenHandle to wrap the specified user token.
        /// </summary>
        /// <param name="arrayPointer">The user token to wrap.</param>
        /// <param name="ownHandle"><c>true</c> to close the token when this object is disposed or finalized,
        /// <c>false</c> otherwise.</param>
        public SafeTokenHandle(IntPtr handle, bool ownHandle)
            : base(ownHandle)
        {
            this.SetHandle(handle);
        }

        /// <summary>
        /// Provides a <see cref="WindowsIdentity" /> object created from this user token. Depending
        /// on the type of token, this can be used to impersonate the user. The WindowsIdentity
        /// class will duplicate the token, so it is safe to use the WindowsIdentity object created by
        /// this method after disposing this object.
        /// </summary>
        /// <returns>a <see cref="WindowsIdentity" /> for the user that this token represents.</returns>
        /// <exception cref="InvalidOperationException">This object does not contain a valid handle.</exception>
        /// <exception cref="ObjectDisposedException">This object has been disposed and its token has
        /// been released.</exception>
        public WindowsIdentity GetWindowsIdentity()
        {
            if (this.IsClosed)
            {
                throw new ObjectDisposedException("The user token has been released.");
            }
            if (this.IsInvalid)
            {
                throw new InvalidOperationException("The user token is invalid.");
            }

            return new WindowsIdentity(this.handle);
        }

        /// <summary>
        /// Calls <see cref="NativeMethods.CloseHandle" /> to release this user token.
        /// </summary>
        /// <returns><c>true</c> if the function succeeds, <c>false otherwise</c>. To get extended
        /// error information, call <see cref="Marshal.GetLastWin32Error"/>.</returns>
        protected override bool ReleaseHandle()
        {
            return NativeMethods.CloseHandle(this.handle);
        }
    }

    /// <summary>
    /// A wrapper around a pointer to an array of Unicode strings (LPWSTR*) using a contiguous block of
    /// memory that can be freed by a single call to LocalFree.
    /// </summary>
    public sealed class SafeLocalAllocWStrArray : SafeLocalAllocArray<string>
    {
        /// <summary>
        /// Creates a new SafeLocalAllocWStrArray. This constructor should only be called by P/Invoke.
        /// </summary>
        private SafeLocalAllocWStrArray()
            : base(true)
        {
        }

        /// <summary>
        /// Creates a new SafeLocalallocWStrArray to wrap the specified array.
        /// </summary>
        /// <param name="handle">The pointer to the unmanaged array to wrap.</param>
        /// <param name="ownHandle"><c>true</c> to release the array when this object
        /// is disposed or finalized, <c>false</c> otherwise.</param>
        public SafeLocalAllocWStrArray(IntPtr handle, bool ownHandle)
            : base(ownHandle)
        {
            this.SetHandle(handle);
        }

        /// <summary>
        /// Returns the Unicode string referred to by an unmanaged pointer in the wrapped array.
        /// </summary>
        /// <param name="index">The index of the value to retrieve.</param>
        /// <returns>the value at the position specified by <paramref name="index" /> as a string.</returns>
        protected override string GetArrayValue(int index)
        {
            return Marshal.PtrToStringUni(Marshal.ReadIntPtr(this.handle + IntPtr.Size * index));
        }
    }

    // This class is similar to the built-in SafeBuffer class. Major differences are:
    // 1\. This class is less safe because it does not implicitly know the length of the array it wraps.
    // 2\. The array is read-only.
    // 3\. The type parameter is not limited to value types.
    /// <summary>
    /// Wraps a pointer to an unmanaged array of objects that can be freed by calling LocalFree.
    /// </summary>
    /// <typeparam name="T">The type of the objects in the array.</typeparam>
    public abstract class SafeLocalAllocArray<T> : SafeHandleZeroOrMinusOneIsInvalid
    {
        /// <summary>
        /// Creates a new SafeLocalArray which specifies that the array should be freed when this
        /// object is disposed or finalized.
        /// <param name="ownsHandle"><c>true</c> to reliably release the handle during the finalization phase;
        /// <c>false</c> to prevent reliable release (not recommended).</param>
        /// </summary>
        protected SafeLocalAllocArray(bool ownsHandle)
            : base(ownsHandle)
        {
        }

        /// <summary>
        /// Converts the unmanaged object referred to by <paramref name="valuePointer" /> to a managed object
        /// of type T.
        /// </summary>
        /// <param name="index">The index of the value to retrieve.</param>
        /// <returns>the value at the position specified by <paramref name="index" /> as a managed object of
        /// type T.</returns>
        protected abstract T GetArrayValue(int index);

        // 
        /// <summary>
        /// Frees the wrapped array by calling LocalFree.
        /// </summary>
        /// <returns><c>true</c> if the call to LocalFree succeeds, <c>false</c> if the call fails.</returns>
        protected override bool ReleaseHandle()
        {
            return (NativeMethods.LocalFree(this.handle) == IntPtr.Zero);
        }

        /// <summary>
        /// Copies the unmanaged array to the specified managed array.
        /// 
        /// It is important that the length of <paramref name="array"/> be less than or equal to the length of
        /// the unmanaged array wrapped by this object. If it is not, at best garbage will be read and at worst
        /// an exception of type <see cref="AccessViolationException" /> will be thrown.
        /// </summary>
        /// <param name="array">The managed array to copy the unmanaged values to.</param>
        /// <exception cref="ObjectDisposedException">The unmanaged array wrapped by this object has been
        /// freed.</exception>
        /// <exception cref="InvalidOperationException">The pointer to the unmanaged array wrapped by this object
        /// is invalid.</exception>
        /// <exception cref="ArgumentNullException"><paramref name="array"/> is null.</exception>
        public void CopyTo(T[] array)
        {
            if (array == null)
            {
                throw new ArgumentNullException("array");
            }

            this.CopyTo(array, 0, array.Length);
        }

        /// <summary>
        /// Copies the unmanaged array to the specified managed array.
        /// 
        /// It is important that <paramref name="length" /> be less than or equal to the length of
        /// the array wrapped by this object. If it is not, at best garbage will be read and at worst
        /// an exception of type <see cref="AccessViolationException" /> will be thrown.
        /// </summary>
        /// <param name="array">The managed array to copy the unmanaged values to.</param>
        /// <param name="index">The index to start at when copying to <paramref name="array" />.</param>
        /// <param name="length">The number of items to copy to <paramref name="array" /></param>
        /// <exception cref="ObjectDisposedException">The unmanaged array wrapped by this object has been
        /// freed.</exception>
        /// <exception cref="InvalidOperationException">The pointer to the unmanaged array wrapped by this object
        /// is invalid.</exception>
        /// <exception cref="ArgumentNullException"><paramref name="array"/> is null.</exception>
        /// <exception cref="ArgumentOutOfRangeException"><paramref name="index"/> is less than zero.-or- 
        /// <paramref name="index" /> is greater than the length of <paramref name="array"/>.-or-
        /// <paramref name="length"/> is less than zero.</exception>
        /// <exception cref="ArgumentException">The sum of <paramref name="index" /> and <paramref name="length" />
        /// is greater than the length of <paramref name="array" />.</exception>
        public void CopyTo(T[] array, int index, int length)
        {
            if (this.IsClosed)
            {
                throw new ObjectDisposedException(this.ToString());
            }
            if (this.IsInvalid)
            {
                throw new InvalidOperationException("This object's buffer is invalid.");
            }
            if (array == null)
            {
                throw new ArgumentNullException("array");
            }
            if (index < 0 || array.Length < index)
            {
                throw new ArgumentOutOfRangeException("index", "index must be a nonnegative integer that is less than array's length.");
            }
            if (length < 0)
            {
                throw new ArgumentOutOfRangeException("length", "length must be a nonnegative integer.");
            }
            if (array.Length < index + length)
            {
                throw new ArgumentException("length", "length is greater than the number of elements from index to the end of array.");
            }

            for (int i = 0; i < length; ++i)
            {
                array[index + i] = this.GetArrayValue(i);
            }
        }
    }

    /// <summary>
    /// The type of logon operation to perform.
    /// </summary>
    internal enum LogonType : uint
    {
        LOGON32_LOGON_BATCH = 1,
        LOGON32_LOGON_INTERACTIVE = 2,
        LOGON32_LOGON_NETWORK = 3,
        LOGON32_LOGON_NETWORK_CLEARTEXT = 4,
        LOGON32_LOGON_NEW_CREDENTIALS = 5,
        LOGON32_LOGON_SERVICE = 6,
        LOGON32_LOGON_UNLOCK = 7
    }

    /// <summary>
    /// The logon provider to use.
    /// </summary>
    internal enum LogonProvider : uint
    {
        LOGON32_PROVIDER_DEFAULT = 0,
        LOGON32_PROVIDER_WINNT50 = 1,
        LOGON32_PROVIDER_WINNT40 = 2
    }
} 
```

# c# - 关于 C# 表达式树的建议

> ID：155792
> 
> 赞同：3
> 
> 时间：2008-10-01T01:00:42.490
> 
> 标签：c#, reflection, expression-trees

我正在研究一种接受表达式树作为参数的方法，以及类的类型（或实例）。

基本思想是，此方法会将某些内容添加到将用于验证的集合中。

```
public interface ITestInterface
{
    //Specify stuff here.
}

private static void DoSomething<T>(Expression<Func<T, object>> expression, params IMyInterface[] rule)
{
    // Stuff is done here.
} 
```

该方法调用如下：

```
class TestClass
{
    public int MyProperty { get; set; }
}

class OtherTestClass  : ITestInterface
{
    // Blah Blah Blah.
}

static void Main(string[] args)
{
    DoSomething<TestClass>(t => t.MyProperty, 
        new OtherTestClass());
} 
```

我这样做是因为我希望传入的属性名称是强类型的。

我正在努力解决的几件事..

1.  在 DoSomething 中，我想获取`PropertyInfo`T 的类型（从传入的主体）并将其与 rule[] 一起添加到集合中。目前，我正在考虑使用 expression.Body 并从“Convert.([propertyname])”中删除 [propertyname] 并使用反射来获得我需要的东西。这看起来既麻烦又错误。有没有更好的办法？
2.  这是我正在使用的特定模式吗？
3.  最后，感谢任何关于我对我正在做的事情的误解的建议或澄清和/或 C# 表达式树的资源或良好信息。

谢谢！

伊恩

# 编辑：

DoSomething 方法中返回的一个示例`expression.Body.ToString()`是包含“Convert(t.MyProperty)”的字符串（如果从上面的示例调用）。

我确实需要它是强类型的，所以如果我更改属性名称它不会编译。

感谢您的建议！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-07T21:17:02.797

我严重依赖表达式树来将我想要对当前应用程序执行的许多操作推送到编译时，即静态类型检查。

我遍历表达式树，将它们翻译成其他“有意义”的东西。

我最终做了很多事情，而不是 URL，我依赖于类似 MVC 的方法，在该方法中我声明 lambda 函数，并将其翻译……解释，编译器生成的表达式树为 URL。当调用这个 URL 时，我做相反的事情。通过这种方式，我可以对断开的链接进行编译时检查，这对于重构和重载也很有效。我认为以这种方式考虑使用表达式树很酷。

您可能想查看访问者模式，开始使用它很痛苦，因为它一开始并没有多大意义，但它将所有内容联系在一起，并且它是解决编译器构造中类型检查的一种非常正式的方法。你可以做同样的事情，但不是类型检查，而是发出你需要的东西。

我目前正在努力解决的问题是能够构建一个简单的框架来翻译（或者实际上我应该说是解释）表达式树并发出 JavaScript。这个想法是编译器生成的表达式树将转换为与某些对象模型接口的有效 JavaScript。

令人兴奋的是，当我出错时编译器总是能够告诉我，并确保最终结果只是一堆字符串，但重要的部分是这些字符串是如何创建的。他们通过了一些验证，这意味着什么。

一旦你做到了，你就不能用表达式树做任何事情。

在使用 System.Reflection.Emit 的东西时，我发现自己使用表达式树来创建一个用于动态编译的轻量级框架，它在编译时基本上可以说我的动态创建的程序集是否也能编译，并且这与反射无缝工作和静态类型检查。它越走越远，最终得到了一些最终节省了大量时间并被证明非常敏捷和健壮的东西。

所以我喜欢这种东西，这就是元编程的全部内容，在你的程序中编写程序来执行程序。我说继续来！

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-01T01:20:17.030

从 Expression.Body 收集 PropertyInfo 对象似乎类似于[我](https://stackoverflow.com/questions/123088/possible-pitfalls-of-using-this-extension-method-based-shorthand#144982)对另一个问题的解决方案。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-01T01:28:06.450

我很欣赏你在这里试图处理的财产。我遇到了这个难题。写起来总感觉怪怪的：

```
DoSomething("MyProperty", new OtherClass()); 
```

如果属性曾经更改名称，或者在调用中输入错误的文本，那么就会出现问题。我了解到的是，这可能是您必须通过测试来处理的问题。具体来说，单元测试。我会编写单元测试来强制“DoSomething”调用正常工作。

您可能会尝试的另一件事是使用属性装饰您的属性，然后在构造类时反映您的类，查找具有属性的属性并加载规则。

```
[DoSomething(typeof(OtherClass), typeof(OtherClass2))]
public int MyProperty
{
  get;
  set;
} 
```

在这种情况下，构造函数（可能在基类中？）将动态创建一个 OtherClass 对象和一个 OtherClass2 对象，并将它们与属性名称一起加载到一个集合中。

# .net - Rhino Mocks：如何模拟 ADO.NET 的 DataRow？

> ID：155797
> 
> 赞同：4
> 
> 时间：2008-10-01T01:02:24.187
> 
> 标签：.net, ado.net, rhino-mocks

ADO.NET 有臭名昭著的 DataRow 类，您无法使用 new 对其进行实例化。现在这是一个问题，因为我发现需要使用 Rhino Mocks 来模拟它。

有谁知道我如何解决这个问题？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-10-01T01:11:18.440

我很好奇你为什么需要模拟 DataRow。有时您可能会陷入嘲笑之中，而忘记使用真实的东西可能同样谨慎。如果您正在传递数据行，那么您可以简单地使用辅助方法实例化一个并将其用作模拟的返回值。

```
SetupResult.For(someMockClass.GetDataRow(input)).Return(GetReturnRow());

public DataRow GetReturnRow()
{
    DataTable table = new DataTable("FakeTable");
    DataRow row = table.NewRow();
    row.value1 = "someValue";
    row.value2 = 234;

    return row;
} 
```

如果这不是您所处的情况，那么我将需要一些示例代码来弄清楚您要做什么。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-28T11:46:58.707

我也为此使用[Typemock](http://www.typemock.com) Isolator，它可以模拟其他模拟框架无法模拟的东西。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-01T01:05:10.703

任何时候我不能模拟某些东西（我更喜欢 MoQ 而不是 Rhino，但这不是重点）我必须围绕它编写代码。

在我看来，你只有两个选择。花钱购买一个可以模拟任何类的高级框架，例如 TypeMock，或者编写一个围绕不是为模拟而编写的类的包装器。

它在框架中的一个可悲的状态。在 1.1 天，TDD 并不是一个大问题。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2021-11-10T22:36:16.647

这对我有用

```
 private DataRow GetReturnRow()
    {
        DataTable table = new DataTable("FakeTable");
        table.Columns.Add("column_name");

        DataRow row = table.NewRow();
        row["column_name"] = your_value;

        return row;
    } 
```

# visual-studio - 如何配置 Visual Studio 以使用代码视图作为 Web 服务的默认视图？

> ID：155810
> 
> 赞同：22
> 
> 时间：2008-10-01T01:08:32.003
> 
> 标签：visual-studio, web-services

当您双击一个类时（在“解决方案资源管理器”中）...如果该类恰好是一个 .asmx.cs 网络服务...那么您会得到这个...

> 要将组件添加到您的类中，请将它们从工具箱中拖动并使用“属性”窗口来设置它们的属性。要为您的类创建方法和事件，请单击此处切换到代码视图。

...它是 Web 服务的“视觉设计表面”。

（谁实际上使用该表面来编写 Web 服务？）

所以我想知道，我如何配置 Visual Studio 从不向我显示该设计视图？

或者至少，默认情况下向我显示代码视图？

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2008-10-01T01:20:45.983

您可以为任何给定的文件类型（.cs、.xml、.xsd 等）设置默认编辑器。要更改给定类型的默认编辑器：

1.  右键单击项目中该类型的文件，然后选择“打开方式...”
2.  选择您喜欢的编辑器。您可能需要“CSharp 编辑器”。
3.  单击“设置为默认值”。

我看不到您在 Web 服务中看到的行为，但这应该适用于 Visual Studio 中的所有文件类型。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2010-11-22T14:08:23.830

将以下属性添加到您的类：

```
[System.ComponentModel.DesignerCategory("Code")] 
```

（不知道为什么 [System.ComponentModel.DesignerCategory("")] 不起作用。）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-07-07T15:21:55.160

将以下属性添加到您的类：

```
<System.ComponentModel.DesignerCategory("")> 
```

# python - 以编程方式聚焦 hippo.CanvasEntry？

> ID：155822
> 
> 赞同：2
> 
> 时间：2008-10-01T01:16:38.380
> 
> 标签：python, focus, pygtk

考虑这个 Python 程序，它使用 PyGtk 和 Hippo Canvas 来显示可点击的文本标签。单击文本标签会将其替换为包含标签文本的 Hippo CanvasEntry 小部件。

```
import pygtk
pygtk.require('2.0')
import gtk, hippo

def textClicked(text, event, row):
    input = hippo.CanvasEntry()
    input.set_property('text', text.get_property('text'))
    parent = text.get_parent()
    parent.insert_after(input, text)
    parent.remove(text)

def main():
    canvas = hippo.Canvas()
    root = hippo.CanvasBox()
    canvas.set_root(root)

    text = hippo.CanvasText(text=u'Some text')
    text.connect('button-press-event', textClicked, text)
    root.append(text)

    window = gtk.Window()
    window.connect('destroy', lambda ignored: gtk.main_quit())
    window.add(canvas)

    canvas.show()
    window.show()

    gtk.main()

if __name__ == '__main__':
    main() 
```

单击文本标签时创建的 CanvasEntry 如何在创建时自动聚焦？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-01T03:14:25.947

在 下方`CanvasEntry`，有一个普通的旧的`gtk.Entry`，您需要在它可见时立即请求焦点。这是您的功能的修改版本，`textClicked`它就是这样做的：

```
def textClicked(text, event, row):
    input = hippo.CanvasEntry()
    input.set_property('text', text.get_property('text'))
    entry = input.get_property("widget")
    def grabit(widget):
        entry.grab_focus()
    entry.connect("realize", grabit)
    parent = text.get_parent()
    parent.insert_after(input, text)
    parent.remove(text) 
```

# .net - 从数据适配器填充数据表时出错

> ID：155829
> 
> 赞同：2
> 
> 时间：2008-10-01T01:20:21.790
> 
> 标签：.net, sql-server, database

我收到此错误，但只是偶尔。99.9% 的时间它工作正常：

无法启用约束。一行或多行包含违反非空、唯一或外键约束的值。

有谁知道原因可能是什么？我只使用该数据表来查看而不是更新，所以是否可以以某种方式轻松关闭所有约束？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-01T01:23:35.183

在填充 DataTable 之前将[DataSet.EnforceConstraints设置为 false](http://msdn.microsoft.com/en-us/library/system.data.dataset.enforceconstraints.aspx)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-01T01:22:40.737

这通常发生在您的数据集上的架构强制执行您的数据库不执行的某些操作时。

Visual Studio 将自动读取架构并尝试在数据集上设置一些主键，但如果您使用的视图可能会返回多行，它将失败。通过删除设计器中的约束，很容易从 DataSet 本身中删除这些约束。

检查以确保您的数据集在您可能有两行具有相同键的情况下没有强制使用主键，例如在将两个表连接在一起并因此复制父表中的行的视图中。默认情况下，VS 将尝试创建父表的主键作为数据集的唯一约束，但视图本身不强制执行此类约束。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2016-08-04T19:42:17.090

如果您使用 XSD 数据集定义架构并且数据库中可变长度字段（varchar、varbinary 等）的最大长度增加但未重新生成 XSD，也会出现此错误。

就我而言，我有`varchar(100)`一个文本值长度为 60 个字符的数据库字段。XSD 预计该字段的最大长度为 50（您可以`InitClass()`在 Designer.cs 文件的方法中看到这一点）。加载此记录时，我收到“无法启用约束”错误消息。更新记录以减少低于 50 的字段消除了错误。

# c# - 您如何在 C# 中引用 MS office 互操作？

> ID：155835
> 
> 赞同：2
> 
> 时间：2008-10-01T01:23:06.993
> 
> 标签：c#, office-interop

我正在尝试从 C# 访问 Outlook 2007。我按照 msdn 上的说明安装了 PIA msi。成功安装后，Visual Studio 的 .net 选项卡下的引用中没有显示任何内容。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-01T01:25:03.510

Office 交互可通过“添加引用”对话框窗口的“COM”选项卡上的 COM 对象进行。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-01T01:40:16.703

下载并运行安装程序后，您是否运行了它提取并放置在它要求您创建的文件夹中的 MSI 安装程序？

# c# - 如何在没有互操作程序集的情况下创建 Microsoft Jet (Access) 数据库？

> ID：155848
> 
> 赞同：5
> 
> 时间：2008-10-01T01:29:57.413
> 
> 标签：c#, interop, jet

我需要在不使用 ADOX 互操作程序集的情况下创建一个访问 (mdb) 数据库。

如何才能做到这一点？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-10-01T01:31:50.780

在我扔掉这段代码之前，它还不如在 stackoverflow 上运行

这些方面的东西似乎可以解决问题：

```
if (!File.Exists(DB_FILENAME))
{
    var cnnStr = "Provider=Microsoft.Jet.OLEDB.4.0;Data Source=" + DB_FILENAME;

    // Use a late bound COM object to create a new catalog. This is so we avoid an interop assembly. 
    var catType = Type.GetTypeFromProgID("ADOX.Catalog");
    object o = Activator.CreateInstance(catType);
    catType.InvokeMember("Create", BindingFlags.InvokeMethod, null, o, new object[] {cnnStr});

    OleDbConnection cnn = new OleDbConnection(cnnStr);
    cnn.Open();
    var cmd = cnn.CreateCommand();
    cmd.CommandText = "CREATE TABLE VideoPosition (filename TEXT , pos LONG)";
    cmd.ExecuteNonQuery();

} 
```

此代码说明一旦使用 ADOX.Catalog COM 组件创建数据库，您就可以使用 OleDbConnection 访问该数据库。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-01T03:36:34.067

我和 Autsin 做了同样的事情，创建了一个 Access db，然后将它作为托管资源包含到我的项目中。在那里，它包含在编译代码中，您可以根据需要将其复制到硬盘上多次。空数据库也相对较小，因此没有太多开销。

额外的好处是能够设置数据库，如果您知道它将如何使用或每次将添加哪些表，您可以减少编码量和缓慢的数据库查询。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-01T01:41:14.673

如果您在 .net 3.5 中使用此连接字符串，则不需要安装 Jet（头疼）

```
Provider=Microsoft.ACE.OLEDB.12.0;Data
Source=C:\myFolder\myAccess2007file.accdb;Persist
Security Info=False; 
```

这应该适用于访问 2007 及以下版本

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-01T02:08:28.867

有趣的问题——我从来没有想过像这样动态地创建一个。我一直将我的基线数据库作为资源包含在项目中，并在我需要新数据库时制作了一份副本。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-07-06T10:22:53.243

ACE**不在**任何框架中（尚未。即不在 1、2、3.5、4、4.5 中）

它也不是 Windows 更新的一部分。

JET4**在**Framework2 及以上。

如果您正在使用 Access/MDB 文件等，则不要假设 ACE 存在。

# c# - C#中的设计时间序列化

> ID：155852
> 
> 赞同：7
> 
> 时间：2008-10-01T01:32:09.407
> 
> 标签：c#, .net, serialization

我在 C# 中创建了一个非可视组件，它被设计为表单上元数据的占位符。
该组件有一个属性，它是自定义对象的集合，该对象被标记为可序列化，并实现了用于序列化的 GetObjectData 和用于反序列化的公共构造函数。

在表单的 resx 文件中，它将生成用于存储集合的二进制数据，但是每当我对序列化类进行更改时，我都会遇到设计器错误，需要从 resx 文件中手动删除数据，然后重新创建此数据。

我尝试更改构造函数以在类中的每个属性周围都有一个 try / catch 块

```
try
{
  _Name = info.GetString("Name");
}
catch (SerializationException)
{
  this._Name = string.Empty;
} 
```

但它仍然崩溃。我得到的最后一个错误是我必须实现 IConvertible。

我更喜欢使用 xml 序列化，因为我至少可以看到它，设计师可以使用它吗？

有没有办法让序列化更稳定，对变化的抵抗力更小？

编辑：
更多信息...更好的描述也许
我有一个从组件继承的类，它有一个属性是规则的集合。RulesCollection 似乎必须标记为 Serializable，否则它不会保留其成员。

Rules 类也是一个组件，其属性为 DesignTimeVisible(false) 以阻止它显示在组件托盘中，该类未标记为 Serializable。

将集合标记为可序列化会在 resx 文件中生成二进制数据（不理想），并且 IDE 会报告规则类不可序列化。

我认为这个问题已经超出了一个简单的问题。所以我可能会很快关闭它。
如果有人有任何指向类似内容的链接，那将有很大帮助。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-01T01:44:34.307

您可能想尝试将所有内容序列化为生成代码的替代方法。要做到这一点非常容易。**只需从Component**实现您的非可视类。然后照原样公开您的集合，但确保放入集合中的每个对象本身都是从**Component**派生的。通过这样做，一切都是代码生成的。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-13T22:42:49.527

从那以后，我发现了我哪里出错了。

我正在实现自定义集合的组件（从 CollectionBase 继承），我将其更改为 List 并将 DesignerSerializationVisibility(DesignerSerializationVisibility.Content) 属性添加到 List 属性，此列表也是只读的。这将生成代码以生成所有组件属性和列表中的所有条目。

存储在列表中的类不需要任何特定属性或需要可序列化。

```
private List<Rule> _Rules;
[DesignerSerializationVisibility(DesignerSerializationVisibility.Content)]
public List<Rule> Rules
{
    get { return _Rules; }
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-02T01:00:53.043

您能否为存在序列化问题的类添加更多代码，也许是构造函数和属性以引用您正在使用的变量。

请注意：我在可视化设计器和代码生成方面遇到了很多问题，如果我在控件上有一个属性，那么通常我把

[DesignerSerializationVisibility(DesignerSerializationVisibility.Hidden)]

在属性上并自己处理初始化。

# c# - ASP.NET MVC - 将参数传递给控制器

> ID：155864
> 
> 赞同：109
> 
> 时间：2008-10-01T01:38:11.747
> 
> 标签：c#, asp.net-mvc

我有一个控制器，其操作方法如下：

```
public class InventoryController : Controller
{
    public ActionResult ViewStockNext(int firstItem)
    {
        // Do some stuff
    }
} 
```

当我运行它时，我收到一条错误消息：

> 参数字典不包含参数“firstItem”的“System.Int32”类型的有效值。要使参数可选，其类型应该是引用类型或 Nullable 类型。

我让它在某一时刻工作，我决定尝试不带参数的函数。发现控制器不是持久的，我把参数放回去了，现在当我调用方法时它拒绝识别参数。

我正在使用此 url 语法来调用操作：

```
http://localhost:2316/Inventory/ViewStockNext/11 
```

任何想法为什么我会收到此错误以及我需要做些什么来解决它？

我尝试向类添加另一种采用整数的方法，它也因同样的原因而失败。我尝试添加一个带字符串的字符串，并将字符串设置为空。我试过添加一个不带参数的，效果很好，但当然它不适合我的需要。

* * *

## 回答 #1

> 赞同：111
> 
> 时间：2008-10-01T01:46:32.817

您的路由需要按照`{controller}/{action}/{firstItem}`. 如果您将路由保留为文件中的默认设置`{controller}/{action}/{id}`，`global.asax.cs`那么您将需要传入`id`.

```
routes.MapRoute(
    "Inventory",
    "Inventory/{action}/{firstItem}",
    new { controller = "Inventory", action = "ListAll", firstItem = "" }
); 
```

...或类似的东西。

* * *

## 回答 #2

> 赞同：88
> 
> 时间：2011-12-02T22:46:23.227

您可以将 firstItem 更改为 id 并且它将起作用

您可以更改 global.asax 上的路由（我不建议这样做）

而且，不敢相信没有人提到这一点，您可以致电：

```
http://localhost:2316/Inventory/ViewStockNext?firstItem=11 
```

在@Url.Action 中将是：

```
@Url.Action("ViewStockNext", "Inventory", new {firstItem=11}); 
```

根据您正在做的事情的类型，最后一个会更合适。此外，您应该考虑不执行 ViewStockNext 操作，而是执行带有索引的 ViewStock 操作。（我的 2 美分）

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2008-10-01T01:50:33.400

要改写[Jarret Meyer 的答案](https://stackoverflow.com/questions/155864/aspnet-mvc-problem-passing-parameters-to-the-controller#155895)，您需要将参数名称更改为“id”或添加如下路线：

```
routes.MapRoute(
        "ViewStockNext", // Route name
        "Inventory/ViewStockNext/{firstItem}",  // URL with parameters
        new { controller = "Inventory", action = "ViewStockNext" }  // Parameter defaults
    ); 
```

原因是默认路由只查找没有参数或名为“id”的参数的操作。

编辑：嘿，没关系 Jarret 在发布后添加了一个路线示例。

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2015-08-28T13:28:17.130

或使用路由属性：

```
public class InventoryController : Controller
{
    [Route("whatever/{firstItem}")]
    public ActionResult ViewStockNext(int firstItem)
    {
        int yourNewVariable = firstItem;
        // ...
    }
} 
```

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2012-09-12T18:47:40.967

Headspring 创建了一个不错的库，允许您在操作的属性中为参数添加别名。这看起来像这样：

```
[ParameterAlias("firstItem", "id", Order = 3)]
public ActionResult ViewStockNext(int firstItem)
{
    // Do some stuff
} 
```

有了这个，您不必为了处理不同的参数名称而更改路由。该库还支持多次应用它，因此您可以映射多个参数拼写（在不破坏公共接口的情况下进行重构时很方便）。

您可以从[Nuget获得它并在](http://nuget.org/packages/ActionParameterAlias)[此处](http://jeffreypalermo.com/blog/adding-an-alias-to-an-action-parameter-for-model-binding-in-asp-net-mvc/)阅读 Jeffrey Palermo 的文章

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2009-01-25T17:35:33.923

`public ActionResult ViewNextItem(int? id)`使`id`整数成为可为空的类型，不需要 string<->int 转换。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2017-04-04T18:44:46.367

使用 ASP.NET Core Tag Helper 功能：

```
<a asp-controller="Home" asp-action="SetLanguage" asp-route-yourparam1="@item.Value">@item.Text</a> 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-10-11T18:44:28.427

还有另一种方法可以做到这一点（在 Stephen Walther 的[Pager 示例中进行了更详细的描述](https://rads.stackoverflow.com/amzn/click/com/0672329980)

本质上，您在视图中创建了一个链接：

```
Html.ActionLink("Next page", "Index", routeData) 
```

在 routeData 中，您可以指定名称/值对（例如，routeData["page"] = 5），并在控制器索引函数中相应的参数接收值。那是，

```
public ViewResult Index(int? page) 
```

将**页面**作为 5 传递。我不得不承认，字符串（“页面”）自动成为变量是很不寻常的——但这也是 MVC 在其他语言中的工作方式......

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-12-10T03:41:53.860

或者，您可以尝试将参数类型更改为字符串，然后在方法中将字符串转换为整数。我是 MVC 的新手，但我相信您的参数列表中需要可为空的对象，否则控制器将如何指示未提供此类参数？所以...

```
public ActionResult ViewNextItem(string id)... 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2012-01-19T08:28:44.520

之所以对“id”进行特殊处理，是因为它被添加到了默认路由映射中。要更改此设置，请转到 Global.asax.cs，您将找到以下行：

```
routes.MapRoute ("Default", "{controller}/{action}/{id}", 
                 new { controller = "Home", action = "Index", id = "" }); 
```

将其更改为：

```
routes.MapRoute ("Default", "{controller}/{action}", 
                 new { controller = "Home", action = "Index" }); 
```

# php - 从 ColdFusion 的 serializeJSON 方法到 PHP 的 json_decode 有人遇到问题吗？

> ID：155869
> 
> 赞同：5
> 
> 时间：2008-10-01T01:39:11.307
> 
> 标签：php, coldfusion, null, json

互联网对此没有帮助。我们在 ColdFusion 中使用编码数据`serializeJSON`并尝试在 PHP 中使用`json_decode`. 大多数情况下，这工作正常，但在某些情况下，`json_decode`返回`NULL`。我们已经寻找了明显的罪魁祸首，但`serializeJSON`似乎正在按预期格式化事情。还有什么问题？

更新：有几个人（明智地）要求我发布导致问题的输出。我会，除了我们刚刚发现结果集是我们所有的数据（列出 2300 多个出租物业的信息，总共 565,135 个 ASCII 字符）！这可能是个问题，尽管我在 PHP 文档中没有看到任何关于字符串最大大小的内容。那里的限制因素是什么？内存？

更新二：问题似乎是我们的几个用户复制并粘贴了带有“智能”引号的 Microsoft Word 文本。那些讨厌的用户...

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-05T04:59:59.687

您可以尝试在 UTF-8 中运行，并让 PHP 知道这一事实。

我遇到了一个问题，PHP`json_decode`无法解码 UTF-8 JSON 字符串（除了你所拥有的大括号之外，还有一些“奇怪”的字符）。我的解决方案是通过在提交给 PHP 的 HTML 页面中插入一个 Content-Type 元标记来提示 PHP 我在 UTF-8 模式下工作。这样，提交数据的内容类型，即 JSON 字符串，也将是 UTF-8：

```
<meta http-equiv="Content-Type" content="text/html;charset=utf-8"/> 
```

之后，PHP`json_decode`能够正确解码字符串。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-01T01:55:16.197

你能可靠地复制这个问题吗？如果是这样，您可以发布返回 null 的示例数据吗？我相信你知道这一点，但为了其他可能不知道的人的信息，[RFC 4627](http://www.faqs.org/rfcs/rfc4627.html)描述了 JSON，假设有效的 javascript 是有效的 JSON 是一个常见的错误。最好将 JSON 视为 javascript 的子集。

回应编辑：

我建议检查以确保您的信息已填充到您的 PHP 脚本中（在它被传递给 json_decode 之前），并验证该信息（特别是如果您可以可靠地重现错误）。为方便起见，您可以尝试使用[在线验证器](http://www.jsonlint.com/)。基于非常有限的信息，听起来可能是超时而不是获取所有数据？需要这么大的数据集吗？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-07-26T09:31:15.650

我遇到了这个确切的问题，事实证明这是由于 ColdFusion 将不可打印的字符放入 JSON 数据包（这些字符确实存在于我们的数据中），但它们无法进入 JSON。

这个站点上的两个问题为我解决了这个问题，尽管我选择了 PHP 解决方案而不是 ColdFusion 解决方案，因为我觉得它是两者中更优雅的一个。

[PHP解决方案](https://stackoverflow.com/questions/1176904/php-how-to-remove-all-non-printable-characters-in-a-string)

在将字符串传递给 json_decode() 之前修复字符串

```
$string = preg_replace('/[\x00-\x1F\x80-\xFF]/', '', $string); 
```

[ColdFusion 解决方案](https://stackoverflow.com/questions/1176940/how-to-get-around-serializejson-in-cf8-encoding-non-printable-characters)

使用 serializeJSON() 后，在该 SO 问题中使用 cleanXmlString() 函数

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-01T02:21:29.740

你可以尝试用另一个解析器解析它，然后寻找错误——我知道 Python 的 JSON 解析器质量非常高。如果您安装了 Python，则可以很容易地通过[demjson](http://pypi.python.org/pypi/demjson)的语法检查器运行文本。如果它是一个非常大的数据集，你可以使用我的库[jsonlib——](http://pypi.python.org/pypi/jsonlib)内存使用会比 demjson 更高，但它会运行得更快，因为它是用 C 编写的。

# asp.net - 如何在 ASP.Net 页面的 VB 内联中声明隐式类型变量？

> ID：155870
> 
> 赞同：2
> 
> 时间：2008-10-01T01:39:13.147
> 
> 标签：asp.net, asp.net-mvc, vb.net

我想做以下事情：

```
<%=var t = ViewData.Model%> 
```

但在**`VB`**

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-01T02:37:42.150

```
<% Dim t = ViewData.Model %> 
```

VB 不使用隐式类型变量的特殊关键字...只是 Dim。

# vb.net - VB.Net 中的 MyClass

> ID：155884
> 
> 赞同：6
> 
> 时间：2008-10-01T01:42:08.647
> 
> 标签：vb.net

VB.Net 的 MyClass 关键字的实际用途是什么？

我了解[MyClass 的技术用法](http://msdn.microsoft.com/en-us/library/b3b35kyk.aspx)；我不明白它在现实世界中的实际用法。

仅当您有任何虚拟（可覆盖）成员时，使用 MyClass 才有意义。但这也意味着您要忽略子类中的覆盖实现。这似乎是自相矛盾的。

我可以想到一些人为的例子，但它们只是糟糕的设计而不是实际使用。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2013-09-29T15:58:38.327

`MyClass`，从编译器的角度来看，是一种省略`callvirt`指令以支持`call`指令的方法。本质上，当您使用虚拟语义 ( ) 调用方法时`callvirt`，您表示您想要使用最衍生的变体。如果您希望省略您使用的派生变体`MyClass`( `call`)。虽然您已经表示您了解基本概念，但我认为从功能的角度而不是隐含的理解来描述它可能会有所帮助。它在功能上`MyBase`与作用域是基类型 with 的警告相同`MyBase`，而不是活动类型 with `MyClass`。

在层次结构的当前点覆盖虚拟调用语义通常是一个糟糕的设计选择，它唯一有效的时候是您必须依赖对象层次结构中的特定功能，并且不能依赖继承者通过在其实现中的基本调用来调用您的变体。它还可以依赖您作为设计者来决定它是唯一的选择，因为您在对象层次结构中进一步覆盖了功能，并且您必须确保在这种极端情况下，在继承树的当前级别上的这个特定方法必须是叫。

一切都与设计有关，了解整体设计和极端案例。C♯ 不包含此类功能可能是有原因的，因为在这些极端情况下，您可以将方法分离为层次结构中当前级别调用的私有变体，并在必要时仅引用该私有实现。我个人认为，使用分段方法是达到目的的理想方法，因为它明确说明了您的设计选择，并且更容易遵循（而且它也是语言中唯一*有效*的方法，没有功能等效于`MyClass`.）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-01T02:10:40.997

多态性

很抱歉，我在这里没有清晰的代码示例，但您可以点击下面的链接，我讨厌复制 MSDN 库描述，但它非常好，很难更清楚地重写它。

“MyClass 提供了一种引用当前类实例成员的方法，而无需将它们替换为任何派生类覆盖。MyClass 关键字的行为类似于引用最初实现的类的当前实例的对象变量。”

另请注意，您不能在共享方法中使用 MyClass。

通过 MyClass 实现多态的一个很好的例子是[http://www.devarticles.com/c/a/VB.Net/Implementing-Polymorphism-in-VB.Net/](http://www.devarticles.com/c/a/VB.Net/Implementing-Polymorphism-in-VB.Net/)

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2008-10-01T01:57:37.613

我想我能看到它的唯一用途是，如果你想要基本条件和继承条件？IE，您希望能够继承一个成员，但您希望能够访问该成员的值，该成员没有被继承更改？

* * *

## 回答 #4

> 赞同：-4
> 
> 时间：2008-10-04T05:20:12.550

如果要调用链式构造函数，则需要它。

```
Public Sub New(ByVal accountKey As Integer)
    MyClass.New(accountKey, Nothing)
End Sub

Public Sub New(ByVal accountKey As Integer, ByVal accountName As String)
    MyClass.New(accountKey, accountName, Nothing)
End Sub

Public Sub New(ByVal accountKey As Integer, ByVal accountName As String, ByVal accountNumber As String)
    m_AccountKey = accountKey
    m_AccountName = accountName
    m_AccountNumber = accountNumber
End Sub 
```

# coldfusion - 如何在 ColdFusion 中重命名 Verity 集合？

> ID：155891
> 
> 赞同：2
> 
> 时间：2008-10-01T01:44:40.403
> 
> 标签：coldfusion, verity

如果不删除、重新创建和重建集合，似乎无法重命名 ColdFusion 中的现有 Verity 集合。问题是，我有一些非常大的收藏，我不想从头开始删除和重建。任何人有这个难题的一个方便的技巧？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-01T18:13:31.730

我不相信有一种简单的方法可以重命名 Verity 集合。您可以随时使用

```
<cfcollection action="map" ...> 
```

为现有集合分配别名，前提是您不需要重新使用原始名称。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-18T01:37:48.970

看起来这是不可能的。删除并重新创建具有所需名称的集合似乎是唯一可用的方法。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-20T20:12:58.940

对于 Verity 部分（不考虑 ColdFusion），分离集合、重命名并重新附加它很容易：

```
rcadmin> indexdetach
Server Alias:YourDocserver
Index Alias:CollectionName
Index Type [(c)ollection,(t)ree,(p)arametric,(r)ecommendation]:c
Save changes? [y|n]:y
<<Return>> SUCCESS

rcadmin> collpurge
Collection alias:CollectionName
Admin Alias:AdminServer
Save changes? [y|n]:y
<<Return>> SUCCESS

rcadmin> adminsignal
Admin Alias:AdminServer
Type of signal (Shutdown=2,WSRefresh=3,RestartAllServers=4):4
Save changes? [y|n]:y
<<Return>> SUCCESS 
```

现在您可以重命名集合目录，然后重新附加。（如果您不确定这些值中的任何一个，请在离线之前使用 collget 检查它们）。

```
rcadmin> collset
Admin Alias:AdminServer
Collection Alias:NewCollectionName
Modify Type (Update=0, Insert=1):1
Path:
Gateway[(o)dbc|(n)otes|(e)xchange|(d)ocumentum|(f)ilesys|(w)eb|o(t)her]:
Style Alias:
Document Access (Public=0,Secure=1,Anonymous=2):
Query Parser [(s)imple|(b)oolPlus|(f)reeText|(o)ldFreeText|O(l)dSimple|O(t)her]:

Description:
Max. Search Time(msecs):
Save changes? [y|n]:y

rcadmin> indexattach
Index Alias:NewCollectionName
Index Type [(c)ollection,(t)ree,(p)arametric,(r)ecommendation]:c
Server Alias:YourDocserver
Modify Type (Update=0, Insert=1):1
Index State (offline=0,hidden=1,online=2):2
Threads (default=3):
Save changes? [y|n]:y
<<Return>> SUCCESS 
```

它现在应该再次出现在“层次结构视图”中。

您还可以使用“合并”实用程序以新名称将内容从一个集合复制到另一个集合。

# unicode - Unicode URL 解码

> ID：155892
> 
> 赞同：7
> 
> 时间：2008-10-01T01:44:45.693
> 
> 标签：unicode, urldecode

URL 编码 unicode 字符的常用方法是将其拆分为 2 个 %HH 代码。( **\u4161** => **%41%61** )

但是，解码时如何区分unicode？你怎么知道**%41%61**是**\u4161**与**\x41\x61**（“Aa”）？

需要编码的 8 位字符是否以**%00 开头**？

或者，unicode字符应该丢失/拆分的点是什么？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-01T01:50:55.023

根据[维基百科](http://en.wikipedia.org/wiki/Percent-encoding)：

> # 现行标准
> 
> 通用 URI 语法要求提供 URI 中字符数据表示的新 URI 方案实际上必须表示来自未保留集中的字符而无需翻译，并且应该根据 UTF-8 将所有其他字符转换为字节，然后百分比编码这些值。此要求是在 2005 年 1 月随 RFC 3986 的发布而引入的。在此日期之前引入的 URI 方案不受影响。
> 
> 当前规范未解决的是如何处理编码的字符数据。例如，在计算机中，字符数据在某种程度上以编码形式表现出来，因此在映射到 URI 字符时可以被视为二进制数据或字符数据。据推测，由 URI 方案规范来解释这种可能性并要求其中一种，但实际上，很少，如果有的话，实际上会这样做。
> 
> # 非标准实现
> 
> Unicode 字符存在一种非标准编码：%uxxxx，其中 xxxx 是表示为四个十六进制数字的 Unicode 值。此行为未由任何 RFC 指定，并且已被 W3C 拒绝。第三版 ECMA-262 仍然包括一个使用这种语法的 escape(string) 函数，还有一个 encodeURI(uri) 函数，它可以转换为 UTF-8 并对每个八位字节进行百分比编码。

所以，看起来这完全取决于编写 unencode 方法的人......标准不是很有趣吗？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-01T02:03:35.710

我一直做的是首先 UTF-8 编码一个 Unicode 字符串，使其成为一系列 8 位字符，然后转义任何带有 %HH*的字符。*

PS - 我只能希望非标准实现（％uxxxx）很少而且相距甚远。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-01T02:06:47.637

由于 URI 是在 unicode 出现之前或至少在广泛使用之前引入的，我想这是一个非常特定于实现的问题。UTF-8 对您的文本进行编码，然后按照正常情况对其进行转义听起来是最好的主意，因为这完全向后兼容任何现有的 ASCII/ANSI 系统，尽管您可能会得到一两个奇怪的奇怪字符。

另一方面，要解码，您需要对文本进行转义，并获得一个 UTF-8 字符串。如果有人使用较旧的系统尝试以 ASCII/ANSI 向您发送一些数据，这不会造成任何伤害，那（几乎）已经是 UTF-8 编码了。

# c# - 如何检测运行 C# 代码时发生的上下文切换次数？

> ID：155903
> 
> 赞同：4
> 
> 时间：2008-10-01T01:50:38.957
> 
> 标签：c#, multithreading

从 C# 中，是否可以检测在特定线程上执行代码块时发生的上下文切换的数量？理想情况下，我想知道我的线程代码被安排了多少次以及在哪个 CPU 上。

我知道我可以使用诸如[Windows 事件跟踪](http://msdn.microsoft.com/en-us/magazine/cc163437.aspx)和相关查看器之类的工具，但这似乎有点复杂来获取我想要的数据。

此外，诸如[Process Explorer](http://technet.microsoft.com/en-us/sysinternals/bb896653.aspx)之类的工具使得很难判断由于特定代码块而发生了多少次切换。

**背景**：我正在尝试测试 .NET 中低级锁原语的实际性能（由于对我最近发表的[一篇博客文章](http://www.moserware.com/2008/09/how-do-locks-lock.html)的一些评论。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-01T01:55:49.347

听起来您可能正在寻找一种编程解决方案，但如果没有，Microsoft 的[Process Explorer](http://technet.microsoft.com/en-us/sysinternals/bb896653.aspx)工具会很容易地告诉您特定线程的上下文切换次数。

进入工具后，双击您的进程，选择“线程”选项卡，然后选择您的线程。

.NET 选项卡具有更具体的 .NET 相关性能数据。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-01T03:17:38.450

我从来没有这样做过，但这里有一些可能会有所帮助的线索：

1.  .NET 分析器 API 可能允许您加入？[ICorProfilerCallback](http://msdn.microsoft.com/en-us/library/ms230818.aspx)接口具有RuntimeThreadSuspended 和 RuntimeThreadResumed 回调。但是对[这篇博](http://blogs.msdn.com/davbr/archive/2005/10/17/481969.aspx)文的评论似乎表明他们不会得到你想要的东西：“当线程被运行时挂起时发出 RuntimeThreadSuspended，通常是为了准备进行 GC。”

2.  有一个“上下文切换/秒”性能计数器可能会有所帮助。我没有专门看这个计数器，但我猜它在 Win32 线程而不是托管线程上运行。您可以使用分析 API 来获取任何给定托管线程 ID 的 Win32 线程 ID。

祝你好运！;)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-01T22:58:05.883

It looks like procexp might be using the kernel thread (KTHREAD) or executive thread (ETHREAD) data structures that have a ContextSwitches field on them. It might be possible to get this from managed code.

# asp.net-mvc - 使用 Asp.Net MVC 创建私人照片库

> ID：155906
> 
> 赞同：9
> 
> 时间：2008-10-01T01:52:19.933
> 
> 标签：asp.net-mvc, image-gallery

我需要创建一个由用户管理的照片库服务。我只使用 Asp.net 已经完成了一百万次，但我想知道在使用 Asp.net MVC 时是否需要做任何特殊考虑。

基本上，我会将实际图像存储在文件系统上，并将位置存储在将图像链接到特定用户的数据库中。除注册用户外，任何人都不应访问**用户**图库中的图像。意思是，我需要以某种方式阻止用户与不是该站点用户的人共享来自画廊的图像的 URL。

过去，我使用一些通用处理程序来验证请求是否允许访问图像资源。我可以使用相同的模式但使用控制器吗？我在想也许创建一个照片控制器，只是一个简单的 Get 动作。这是否需要我有一个仅用于显示图像的视图？

我是在正确的轨道上还是有更好的方法来做到这一点？（除了将图像存储在数据库中）

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-01T03:44:00.773

此链接说明如何创建自定义 ImageResult 类。我能够完全按照我的需要去做

[https://blog.maartenballiauw.be/post/2008/05/13/aspnet-mvc-custom-actionresult.html](https://blog.maartenballiauw.be/post/2008/05/13/aspnet-mvc-custom-actionresult.html)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-01T01:59:35.860

这不是一个完整的答案，但我会考虑使用限制对实际文件本身的访问的路由，然后可能使用获取图像的操作的身份验证。

# tomcat - 从 cargo-maven2-plugin 以嵌入式模式启动 tomcat 的最简单方法是什么？

> ID：155908
> 
> 赞同：0
> 
> 时间：2008-10-01T01:53:02.037
> 
> 标签：tomcat, maven-2, maven-plugin, cargo

我已将 tomcat:catalina:5.5.23 定义为 cargo 插件的依赖项，但是我仍然得到以下异常：

```
java.lang.ClassNotFoundException: org.apache.catalina.Connector
at java.net.URLClassLoader$1.run(URLClassLoader.java:200)
at java.security.AccessController.doPrivileged(Native Method)
at java.net.URLClassLoader.findClass(URLClassLoader.java:188)
at java.lang.ClassLoader.loadClass(ClassLoader.java:316)
at org.codehaus.classworlds.RealmClassLoader.loadClassDirect(RealmClassLoader.java:195)
at org.codehaus.classworlds.DefaultClassRealm.loadClass(DefaultClassRealm.java:255)
at org.codehaus.classworlds.DefaultClassRealm.loadClass(DefaultClassRealm.java:274)
at org.codehaus.classworlds.RealmClassLoader.loadClass(RealmClassLoader.java:214)
at java.lang.ClassLoader.loadClass(ClassLoader.java:251)
at java.lang.ClassLoader.loadClassInternal(ClassLoader.java:374)
at java.lang.Class.forName0(Native Method)
at java.lang.Class.forName(Class.java:247)
at org.codehaus.cargo.container.tomcat.internal.Tomcat5xEmbedded.preloadEmbedded(Tomcat5xEmbedded.java:232) 
```

看起来 RealmClassLoader 没有找到该类，可能是由于 java.security.AccessController.doPrivileged 拒绝访问。

有没有人让tomcat在maven中以嵌入式模式运行？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-03T21:47:34.600

旁注：您可以启动类似于 tomcat 的码头。（Servlet 将在[http://localhost:8080/](http://localhost:8080/) artefact-name 上可用）

```
mvn jetty6:run 
```

您必须添加到您的 pom 中：

```
<project>
    <build>
        <plugins>
            <plugin>
                <groupId>org.mortbay.jetty</groupId>
                <artifactId>maven-jetty6-plugin</artifactId>
                <configuration>
                    <scanIntervalSeconds>5</scanIntervalSeconds>
                    <!--
                    <webXml>${basedir}/WEB-INF/web.xml</webXml>
                    -->
                </configuration>
            </plugin>
         </plugins>
    </build>
</project> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-12T20:54:40.080

还有一个 tomcat maven 插件：

[http://mojo.codehaus.org/tomcat-maven-plugin/introduction.html](http://mojo.codehaus.org/tomcat-maven-plugin/introduction.html)

```
<plugins>
  <plugin>
    <groupId>org.codehaus.mojo</groupId>
    <artifactId>tomcat-maven-plugin</artifactId>
  </plugin>
</plugins> 
```

在我的机器上，这会加载 tomcat 6。我不确定如何让它与 tomcat 5.5 一起使用

# automated-tests - 您如何处理在开发过程中预计会失败的单元/回归测试？

> ID：155911
> 
> 赞同：7
> 
> 时间：2008-10-01T01:54:05.250
> 
> 标签：automated-tests

在软件开发过程中，代码库中可能存在已知问题。如果测试写得好，这些错误将导致回归/单元测试失败。

我们的团队一直在争论如何管理失败的测试：

1.  使用 REVISIT 或 TODO 注释注释掉失败的测试用例。

    *   **优点**：我们将始终知道何时引入了*新*缺陷，而不是我们已经知道的缺陷。
    *   **缺点**：可能会忘记重新访问已注释掉的测试用例，这意味着缺陷可能会从裂缝中溜走。
2.  让测试用例失败。

    *   **优点**：不会忘记修复缺陷，因为脚本失败会不断提醒您存在缺陷。
    *   **缺点**：由于故障噪声，难以检测何时引入了*新缺陷。*

我想探讨一下这方面的最佳实践。就个人而言，我认为三态解决方案是确定脚本是否通过的最佳解决方案。例如，当您运行脚本时，您可能会看到以下内容：

*   通过百分比：75%
*   失败百分比（预期）：20%
*   失败百分比（意外）：5%

*您基本上会用一些元数据标记您希望*失败（由于某些缺陷）的任何测试用例。这可确保您在测试结束时仍能看到失败结果，但会立即知道是否有您未预料到的*新失败。*这似乎占据了上述 2 个提案中最好的部分。

有没有人有管理这个的最佳实践？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-01T02:04:28.487

我会把你的测试用例留在里面。根据我的经验，用类似的东西注释掉代码

```
// TODO:  fix test case 
```

类似于做：

```
// HAHA: you'll never revisit me 
```

严肃地说，随着您接近交付，重新访问代码中的 TODO 的愿望往往会消退，尤其是单元测试之类的事情，因为您正专注于修复代码的其他部分。

将测试留在您的“三态”解决方案中。但是，我强烈建议尽快修复这些案例。我对不断提醒的问题是，人们看到它们后，往往会掩盖它们并说“哦，是的，我们总是遇到这些错误......”

举个例子——在我们的一些代码中，我们引入了“可跳过断言”的概念——断言可以让您知道存在问题，但允许我们的测试人员跳过它们进入其余的代码。我们发现 QA 开始说诸如“哦，是的，我们一直得到那个断言，我们被告知它是可跳过的”，并且没有报告错误。

我想我的建议是还有另一种选择，即修复您的测试用例立即发现的错误。不这样做可能有实际的理由，但从长远来看，现在养成这种习惯可能会更有益。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-01T03:54:38.643

立即修复错误。

如果它太复杂而无法立即完成，那么它可能是一个太大的单元，无法进行单元测试。

丢失单元测试，并将缺陷放入您的错误数据库中。这样它就具有可见性，可以优先考虑，等等。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-01T02:49:51.887

我通常在 Perl 和 Perl 的 Test::* 模块中工作，允许您插入 TODO 块：

```
TODO: {
  local $TODO = "This has not been implemented yet."

  # Tests expected to fail go here
} 
```

在测试运行的详细输出中，$TODO 中的消息被附加到 TODO 块中每个测试的通过/失败报告中，以解释为什么预期会失败。对于测试结果的汇总，所有的 TODO 测试都被视为成功，但是，如果有任何实际返回成功的结果，汇总也会将这些结果进行计数，并报告意外成功的测试数量。

那么，我的建议是找到具有类似功能的测试工具。（或者只是使用 Perl 进行测试，即使被测试的代码是另一种语言......）

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-01T01:56:32.170

我倾向于使用[Ignore](http://www.nunit.org/index.php?p=ignore&r=2.2)属性（这是使用[NUnit](http://www.nunit.org/index.php?p=home)）将这些留在其中 - 在测试运行输出中提到了测试，因此它是可见的，希望这意味着我们不会忘记它。考虑在“忽略”消息中添加问题/票证 ID。这样，当潜在问题被认为成熟时，它就会得到解决 - 立即修复失败的测试会很好，但有时小错误必须等到时机成熟。

我考虑过[Explicit](http://www.nunit.org/index.php?p=explicit&r=2.2)属性，它的优点是无需重新编译即可运行，但它不需要“原因”参数，并且在我们运行的 NUnit 版本中，测试不显示在输出中作为未运行。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-01T02:18:49.043

我们做了以下工作： 在测试上设置层次结构。

示例：您必须测试 3 件事。

*   测试登录（登录，检索用户名，获取“最后登录日期”或熟悉的东西等）
*   测试数据库检索（搜索给定的“schnitzelmitkartoffelsalat” - 标签，搜索最新标签）
*   测试网络服务（连接、获取版本号、检索简单数据、检索详细数据、更改数据）

每个测试点都有子点，如括号中所述。我们将这些分层。举最后一个例子：

```
3\. Connect to a web service
    ...
3.1\. Get the version number
    ...
3.2\. Data:
    3.2.1\. Get the version number
    3.2.2\. Retrieve simple data
    3.2.3\. Retrieve detailed data
    3.2.4\. Change data 
```

如果一个点失败（在开发过程中）**给出一个准确的错误信息**。即3.2.2。失败的。那么测试单元将不会执行 3.2.3 的测试。和 3.2.4。. 这样你会得到一个（确切的）错误消息：“3.2.2 failed”。因此让程序员（首先）解决该问题而不是处理 3.2.3。和 3.2.4。因为这行不通。

这有助于澄清问题并明确首先必须做什么。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-01T02:31:52.257

我认为您需要一个 TODO 观察器，它可以从代码库中生成“TODO”注释。TODO*是*您的测试元数据。它是已知故障消息前面的一行，并且很容易关联。

TODO 很好。使用它们。通过定期将它们实际放入积压工作来积极管理它们。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-01T03:34:50.873

Joel 的[“12 Steps to Better Code”](http://www.joelonsoftware.com/articles/fog0000000043.html)中的 #5是在编写新代码之前修复错误：

> 当您在第一次尝试运行它时发现代码中有错误时，您将能够立即修复它，因为所有代码仍然在您的脑海中记忆犹新。
> 
> 如果您在几天前编写的某些代码中发现了一个错误，您将需要一段时间才能找到它，但是当您重新阅读您编写的代码时，您会记住所有内容并且您将能够修复在合理的时间内出错。
> 
> 但是，如果您在几个月前编写的代码中发现了一个错误，您可能已经忘记了该代码的很多内容，而且修复起来要困难得多。到那时你可能正在修复别人的代码，他们可能正在 Aruba 度假，在这种情况下，修复 bug 就像科学：你必须缓慢、有条不紊、一丝不苟，而且你无法确定如何发现治疗方法需要很长时间。
> 
> 而且，如果您在已经发布的代码中发现了一个错误，那么您将花费巨额费用来修复它。

但是，如果您真的想忽略失败的测试，请在您使用的任何测试框架中使用 [Ignore] 属性或其等效属性。在 MbUnit 的 HTML 输出中，忽略的测试显示为黄色，而失败的测试显示为红色。这使您可以轻松地注意到一个新失败的测试，但您不会忘记已知失败的测试。

# c# - 如何在 XML Schema 验证错误上引发 XmlSchemaException？

> ID：155912
> 
> 赞同：1
> 
> 时间：2008-10-01T01:54:41.613
> 
> 标签：c#, .net, xml, schema

调用**XmlDocument**需要传入一个`Validate()`委托。该事件函数获取一个参数，该参数又具有type 的属性。哇！**`ValidationEventHandler``ValidationEventArgs``Exception``XmlSchemaException`**

 **我当前的代码如下所示：

```
ValidationEventHandler onValidationError = delegate(object sender,
    ValidationEventArgs args)
{
    throw(args.Exception);
}

doc.Validate(onValidationError); 
```

是否有一些我忽略的其他方法只是*抛出*`XmlSchemaException`if 验证失败（完全忽略警告）？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-01T01:59:10.790

因为 Validate 方法采用 ValidationEventHandler 委托，所以由开发人员决定如何处理异常。你在做什么是正确的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2019-08-09T19:28:38.540

如果有任何错误，传递参数将引发`null`异常。`validationEventHandler`

[Extensions.Validate](https://docs.microsoft.com/en-us/dotnet/api/system.xml.schema.extensions.validate?#System_Xml_Schema_Extensions_Validate_System_Xml_Linq_XDocument_System_Xml_Schema_XmlSchemaSet_System_Xml_Schema_ValidationEventHandler_)方法的 MSDN 文档将`validationEventHandler`参数描述为：

> A`ValidationEventHandler`表示当阅读器遇到验证错误时发生的事件。如果`null`，则在验证错误时引发异常。

# .net - 业务实体加载模式

> ID：155913
> 
> 赞同：0
> 
> 时间：2008-10-01T01:54:59.927
> 
> 标签：.net, vb.net, n-tier-architecture

我正在做的项目是使用 n 层架构。我们的层如下：

*   数据访问
*   商业逻辑
*   商业实体
*   介绍

Business Logic 向下调用到数据访问层，Presentation 层向下调用到 Business Logic 层，业务实体都被它们引用。

我们的业务实体与我们的数据模型 1-1 基本匹配。对于每张桌子，我们都有一个班级。最初设计框架时，没有考虑管理主从关系或子父关系。所以所有的业务逻辑、数据访问和业务实体，都只引用了数据库中的一个表。一旦我们开始开发应用程序，很快就会发现在我们的对象模型中没有这些关系会严重伤害我们。

您的所有层（包括数据库）都是从内部元数据数据库生成的，我们用它来驱动我们自己开发的代码生成器。

问题是在我们的实体中加载或延迟加载关系的最佳方式是什么。例如，假设我们有一个与地址表具有主子关系的人员类。这在业务实体中显示为 Person 对象上 Addresses 的集合属性。如果我们有一对一的关系，那么这将显示为单个实体属性。填充和保存关系对象的最佳方法是什么？我们的业务实体不了解业务逻辑层，因此在调用属性 get 时无法在内部完成。

我敢肯定有某种标准模式可以做到这一点。有什么建议么？

此外，需要注意的一点是 DataAcess 层使用反射来构建我们的实体。存储过程基于一张表返回一个结果选择，并使用反射通过将属性名称与列名称匹配来填充我们的业务对象。所以做连接会很困难。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-01T02:17:28.703

我强烈建议您查看 Fowler 的[企业架构模式](http://martinfowler.com/eaaCatalog/)一书。他很好地概述了解决这类问题的几种不同方法，包括实体关系。

更引人注目的项目之一是工作单元模式，它基本上是一个收集器，它观察在您的实体上执行的操作，一旦您完成了您的操作，它会批处理适当的数据库调用，并向数据库。这种模式是[NHibernate](http://www.hibernate.org/343.html)使用的核心概念之一，它使用一个实现 IDisposable 的对象来表示“工作”的结束。这允许您将您的操作包装在一个 using 中，并让工作单元为您处理这些操作。

**编辑：附加信息**

[这](http://martinfowler.com/eaaCatalog/unitOfWork.html)是与工作单元的基本类结构的链接……这并不是世界上最令人兴奋的事情。Fowler 在他的书中提供了更多细节，您可以[在此处](http://books.google.com/books?id=FyWZt5DdvFkC&lpg=PT217&vq=Unit%20of%20work&dq=Patterns%20of%20Enterprise%20Application%20Architecture&client=firefox-a&pg=PT217#v=onepage&q=Unit%20of%20work&f=false)查看其中的一些细节。您还可以将 NHibernate 中的 Session 对象视为可能的实现（我能够追踪[ISession](http://nhibernate.svn.sourceforge.net/viewvc/nhibernate/trunk/nhibernate/src/NHibernate/ISession.cs?revision=3745&view=markup)接口......不确定实现的位置）

希望这可以帮助。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-01T02:16:39.737

我过去使用的一种方法是使容器类型足够智能以获取所需的对象。例如：

```
public class Relation<T>
{
  private T _value;

  private void FetchData()
  {
    if( LoadData != null ) {
      LoadDataEventArgs args = new LoadDataEventArgs(typeof(T), /* magic to get correct object */);
      LoadData(this, args);
      _value = (T)args.Value;
    }
  }

  public event EventHandler<LoadDataEventArgs> LoadData;

  public T Value {
    get {
      if( _value == default(T) )
        FetchData();
      return _value; 
    }
    set { /* Do magic here. */ }
  }
} 
```

然后你在你的实体上声明它，比如：

```
[RelationCriteria("ID", EqualsMyProperty="AddressID")]
public Relation<Address> Address {
  get; set;
} 
```

并且由声明 Address 属性的类型的加载程序来为 LoadData 事件添加处理程序。

一个类似的类实现了 IList 来为您提供一对多的关系。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-01T01:59:22.430

您使用什么语言？您所描述的正是实体框架在.Net 中所做的。但是您没有分享您使用的语言，我假设您不想重写任何数据层。

# php - PHP 会话数据未保存

> ID：155920
> 
> 赞同：58
> 
> 时间：2008-10-01T01:57:49.127
> 
> 标签：php, session

我有一种“我发誓我没有碰过服务器”的情况。老实说，我没有接触任何 php 脚本。我遇到的问题是 php 数据没有跨不同的页面或页面刷新保存。我知道正在正确创建一个新会话，因为我可以设置一个会话变量（例如 $_SESSION['foo'] = "foo" 并在同一页面上打印出来就好了。但是当我尝试使用同一个变量时在另一个页面上它没有设置！我可以在我的主机服务器上使用任何 php 函数或信息来查看发生了什么？

这是一个示例脚本，目前无法在我的主机服务器上运行：

```
<?php
session_start();
if(isset($_SESSION['views']))
    $_SESSION['views'] = $_SESSION['views']+ 1;
else
    $_SESSION['views'] = 1;

echo "views = ". $_SESSION['views'];
echo '<p><a href="page1.php">Refresh</a></p>';
?> 
```

刷新页面后，“views”变量永远不会增加。我认为这是他们方面的问题，但我想首先确保我不是一个完全的白痴。

这是我的主机服务器的 phpinfo()（PHP 版本 4.4.7）： ![替代文字](https://i.stack.imgur.com/3bv0K.png)

* * *

## 回答 #1

> 赞同：42
> 
> 时间：2008-10-01T21:57:04.140

感谢所有有用的信息。事实证明，我的主机更改了服务器并开始使用不同的会话保存路径，而不是 /var/php_sessions 不再存在。一个解决方案是`ini_set(' session.save_path','SOME WRITABLE PATH');`在我的所有脚本文件中声明，但这会很痛苦。我与主持人交谈，他们明确地将会话路径设置为确实存在的真实路径。希望这可以帮助任何遇到会话路径问题的人。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2011-10-25T01:38:28.447

检查以确保您没有将 https:// 与 http:// 混合。会话变量不会在安全会话和不安全会话之间流动。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2010-10-11T16:16:45.987

有同样的问题——发生在我身上的是我们的服务器管理员将 session.cookie_secure 布尔值更改为 On，这意味着 cookie 只会通过安全连接发送。由于没有找到 cookie，php 每次都创建一个新会话，因此看不到会话变量。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2008-10-01T02:04:27.317

使用`phpinfo()`并检查`session.*`设置。

也许信息存储在 cookie 中，而您的浏览器不接受 cookie，诸如此类。

首先检查并返回结果。

你也可以做 `print_r($_SESSION);`一个转储这个变量并查看内容....

关于你的`phpinfo()`，是`session.save_path`一个有效的吗？您的 Web 服务器是否对该目录具有写入权限？

希望这可以帮助。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2011-07-21T14:46:42.233

我有以下问题

索引.php

```
<?
    session_start();
    $_SESSION['a'] = 123;
    header('location:index2.php');
?> 
```

index2.php

```
<?
  session_start();
  echo $_SESSION['a'];
?> 
```

变量`$_SESSION['a']`设置不正确。然后我相应地改变`index.php`了

```
<?
    session_start();
    $_SESSION['a'] = 123;
    session_write_close();
    header('location:index2.php');
?> 
```

我不知道这在内部意味着什么，我只是向自己解释说会话变量更改不够快:)

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2008-10-01T02:23:22.620

检查会话保存路径是否可被 Web 服务器写入。

确保你打开了cookies..（当我关闭它们来测试某些东西时我忘记了）

使用带有 firebug 扩展的 firefox 来查看 cookie 是否被设置并传回。

在不相关的说明中，开始查看 php5，因为 php 4.4.9 是 php4 系列的最后一个。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2010-04-11T09:15:41.360

检查脚本运行所在文件夹的组和所有者是谁。如果 group id 或 user id 错误，例如设置为 root，会导致 session 无法正确保存。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-10-01T02:06:09.433

在增加它之前检查“views”的值。如果出于某种奇怪的原因，它被设置为一个字符串，那么当你给它加 1 时，它总是返回 1。

```
if (isset($_SESSION['views'])) {
    if (!is_numeric($_SESSION['views'])) {
        echo "CRAP!";
    }
    ++$_SESSION['views'];
} else {
    $_SESSION['views'] = 1;
} 
```

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-10-01T04:36:39.867

好吧，我们可以消除代码错误，因为我在自己的服务器（PHP 5）上测试了代码。

以下是要检查的内容：

1.  你在任何地方调用 session_unset() 或 session_destroy() 吗？这些函数将立即删除会话数据。如果我把这些放在我的脚本的末尾，它就会开始表现得和你描述的完全一样。

2.  它在所有浏览器中的行为都相同吗？如果它在一个浏览器上运行而不在另一个浏览器上运行，则您可能在无法运行的浏览器上遇到了配置问题（例如，您关闭了 cookie 并忘记打开它们，或者错误地阻止了 cookie）。

3.  会话文件夹是否可写？您无法使用 is_writable() 对其进行测试，因此您需要转到该文件夹​​（从 phpinfo() 中，它看起来像 /var/php_sessions）并确保实际创建了会话。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2009-06-30T21:50:07.020

> 当我遇到类似问题时，我知道我找到的一个解决方案（使用 Apache 1 的 OSX 并刚刚切换到 PHP5）是取消设置 1 个特定键（即 unset($_SESSION['key']);) 导致它无法保存。一旦我不再取消设置该键，它就保存了。我再也没有见过这种情况，除了在另一个站点上的那个服务器上，但那是一个不同的变量。也没有什么特别的。

感谢这个达里尔。这帮助了我。我正在删除一个会话变量，并且由于某种原因它阻止了会话提交。现在我只是将它设置为 null （这对我的应用程序来说很好），它可以工作。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2010-04-10T14:50:58.340

如果您在 php5 中设置会话，然后尝试在 php4 页面上读取它，它可能不会在正确的位置查找！使页面具有相同的 php 版本或设置 session_path。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2011-06-21T16:32:33.817

我花了很长时间寻找类似问题的答案。这不是代码或设置的问题，因为非常相似的代码在同一服务器上的另一个 .php 中完美运行。原来问题是由大量数据保存到此页面的会话中引起的。在一个地方，我们有这样一行：从数据库加载的数据数组`$_SESSION['full_list'] = $full_list`在哪里？`$full_list`每行是一个包含大约 150 个元素的数组。几年前最初编写代码时，数据库只包含大约 1000 行，所以`$full_list`包含大约 100 个元素，每个元素是大约 20 个元素的数组。随着时间的推移，20 个元素变成了 150 行，1000 行变成了 17000 行，因此代码将接近 64 兆的数据存储到会话中。显然，由于存储了这么多数据，它拒绝存储任何其他内容。一旦我们更改代码以在本地处理数据而不将其保存到会话中，一切都运行良好。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2008-10-01T05:52:31.823

当我遇到类似问题时，我知道我找到的一个解决方案（使用 Apache 1 的 OSX 并刚刚切换到 PHP5）是取消设置 1 个特定键（即 unset($_SESSION['key']);) 导致它无法保存。一旦我不再取消设置该键，它就保存了。我再也没有见过这种情况，除了在另一个站点上的那个服务器上，但那是一个不同的变量。也没有什么特别的。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2008-10-01T07:18:27.933

这是我在其他评论中没有看到的一个常见问题：您的主机是否正在运行某种缓存？如果它们以某种方式自动缓存结果，您会得到这种行为。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2009-05-31T14:11:38.950

只是想补充一点，如果您不小心错过了页面上的 session_start() 语句，也会发生这种情况。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2009-07-31T11:43:56.333

检查您是否正在使用 session_write_close(); 在任何地方，我在另一个会话之后立即使用它，然后尝试再次写入会话并且它不工作..所以只需评论那个sh * t out

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2011-07-12T14:13:42.397

我将会话 cookie 路径设置为“//”而不是“/”。萤火虫太棒了。希望它可以帮助某人。

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2012-01-12T18:02:03.587

当我使用来自 www.domain.com/auth.php 并重定向到 domain.com/destpage.php 的安全页面时，我遇到了这个问题。我从 auth.php 链接中删除了 www 并且它起作用了。这让我很震惊，因为一切正常；我到达目的地时没有设置会话。

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2012-06-20T10:58:26.597

一个经常被忽视的常见问题是 session_start() 命令之前必须没有其他代码或额外的间距。

我之前遇到过这个问题，在 session_start() 之前我有一个空行，导致它无法正常工作。

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2012-09-23T18:01:24.790

编辑您的 php.ini。
我认为 session.gc_probability 的值为 1，所以设置为 0。

```
session.gc_probability=0 
```

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2014-10-03T14:35:50.397

添加我的解决方案：

检查您是否访问了**正确的域**。我`www.mysite.com`用来启动会话，并尝试从`mysite.com`（不带`www`）接收它。

我已经通过将所有域的 htaccess 重写添加到 www 来解决这个问题，以确保安全。

还要检查您使用的是 http 还是 https。

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2014-10-04T10:29:04.067

我必须做的另外几件事（我有同样的问题：PHP 升级到 5.4 后没有会话保留）。你很多人不需要这些，这取决于你的服务器的 php.ini 包含什么（检查 phpinfio()）；

```
session.use_trans_sid=0 ; Do not add session id to URI (osc does this)
session.use_cookies=0;  ; ensure cookies are not used
session.use_only_cookies=0 ; ensure sessions are OK to use IMPORTANT
session.save_path=~/tmp/osc; ; Set to same as admin setting
session.auto_start = off; Tell PHP not to start sessions, osc code will do this 
```

基本上，你的 php.ini 应该设置为无 cookie，并且会话参数必须与 osc 想要的一致。

您可能还需要更改 application_top.php 中的一些会话代码片段 - 创建 tep_session_is_registered(...) 调用中不存在的对象（例如导航对象），将 $HTTP_ 变量设置为较新的 $_SERVER 变量和很少有其他针对空对象的 isset 测试（谷歌获取信息）。我最终能够使用原始的 session.php 文件（包含/类和包含/函数）和稍微修改的 application_top.php 来让事情重新开始。php.ini 设置是主要问题，但这当然取决于您的服务器公司默认安装的内容。

# c++ - 在 Linux 中从我的应用程序启动网页

> ID：155930
> 
> 赞同：5
> 
> 时间：2008-10-01T02:00:53.923
> 
> 标签：c++, c, linux, browser

我有一个应用程序，当用户选择它时，它会在“当前”浏览器中启动一个网页。我的应用程序的这一部分在 Windows 版本中运行良好，但我不知道如何在 Linux 版本中执行此操作。

现在，Linux 版本在特定目录中针对 Firefox 进行了硬编码，并且每次都运行它的新实例，并且不显示我传入的 URL。我希望它不要每次都启动新版本，而只是打开一个当前打开的页面中的新页面（如果它已经在运行）。

对于我使用的窗口：

```
ShellExecute(NULL,"open",filename,NULL,NULL,SW_SHOWNORMAL); 
```

对于我目前使用的 Linux：

```
pid_t pid;
char *args[2];

char *prog=0;
char firefox[]={"/usr/bin/firefox"};

if(strstri(filename,".html"))
    prog=firefox;

if(prog)
{
    args[0]=(char *)filename;
    args[1]=0;
    pid=fork();
    if(!pid)
        execvp(prog,args);

} 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-01T02:06:09.837

如果您正在为现代发行版编写此代码，您可以使用`xdg-open`：

```
$ xdg-open http://google.com/ 
```

如果您使用的是旧版本，则必须使用特定于桌面的命令，例如`gnome-open`or `exo-open`。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-01T19:19:54.003

xdg-open 是新标准，您应该尽可能使用它。但是，如果发行版超过几年，它可能不存在，替代机制包括 $BROWSER（较旧的尝试标准）、gnome-open（Gnome）、kfmclient exec（KDE）、exo-open（Xfce）、或自己解析 mailcap（text/html 处理程序可能是浏览器）。

话虽如此，大多数应用程序并不需要做那么多工作——如果它们是为特定环境构建的，它们就会使用该环境的启动机制。例如，Gnome 有 gnome_url_show，KDE 有 KRun，大多数终端程序（例如 mutt）解析 mailcap 等。硬编码浏览器并允许分发者或用户覆盖默认值也很常见。

我不建议对此进行硬编码，但如果你真的想在 Firefox 中打开一个新标签，你可以使用“firefox -new-tab $URL”。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-06T11:09:49.580

xdg-open 的注释：检查[http://portland.freedesktop.org/wiki/](http://portland.freedesktop.org/wiki/)，“使用 Xdg-utils”部分；它声明您可以在自己的应用程序中包含 xdg-open 脚本，并在目标系统尚未安装 xdg-open 时将其用作后备。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-01T18:44:40.780

如果您不想涉及其他应用程序，只需使用 firefox 内置的远程控制命令即可。例如：

```
firefox -remote 'openurl(http://stackoverflow.com)' 
```

详细用法见[http://www.mozilla.org/unix/remote.html](http://www.mozilla.org/unix/remote.html)

# windows - 如何使用 Windows 批处理文件遍历文本文件中的每一行？

> ID：155932
> 
> 赞同：275
> 
> 时间：2008-10-01T02:01:38.070
> 
> 标签：windows, batch-file

我想知道如何使用 Windows 批处理文件遍历文本文件中的每一行并连续处理每一行文本。

* * *

## 回答 #1

> 赞同：345
> 
> 时间：2008-10-02T18:33:46.133

我需要将整条生产线作为一个整体进行处理。这是我发现的工作。

```
for /F "tokens=*" %%A in (myfile.txt) do [process] %%A 
```

带有星号 (*) 的 tokens 关键字将提取整行的所有文本。如果您不输入星号，它只会拉出该行的第一个单词。我认为它与空格有关。

[对于 TechNet 上的命令](http://technet.microsoft.com/en-us/library/bb490909.aspx)

* * *

如果文件路径中有空格，则需要使用`usebackq`. 例如。

```
for /F "usebackq tokens=*" %%A in ("my file.txt") do [process] %%A 
```

* * *

## 回答 #2

> 赞同：60
> 
> 时间：2008-10-01T02:06:49.930

从 Windows 命令行参考：

要解析文件，忽略注释行，请键入：

```
for /F "eol=; tokens=2,3* delims=," %i in (myfile.txt) do @echo %i %j %k 
```

此命令解析 Myfile.txt 中的每一行，忽略以分号开头的行，并将每行的第二个和第三个标记传递给 FOR 正文（标记由逗号或空格分隔）。FOR 语句的主体引用 %i 来获取第二个令牌， %j 来获取第三个令牌，以及 %k 来获取所有剩余的令牌。

如果您提供的文件名包含空格，请在文本周围使用引号（例如，“文件名”）。要使用引号，您必须使用 usebackq。否则，引号将被解释为定义要解析的文字字符串。

顺便说一句，您可以在以下位置找到大多数 Windows 系统上的命令行帮助文件：

```
 "C:\WINDOWS\Help\ntcmds.chm" 
```

* * *

## 回答 #3

> 赞同：37
> 
> 时间：2010-05-04T14:39:16.580

在批处理文件中，您必须**使用**：（类型）`%%``%``help for`

```
for /F "tokens=1,2,3" %%i in (myfile.txt) do call :process %%i %%j %%k
goto thenextstep
:process
set VAR1=%1
set VAR2=%2
set VAR3=%3
COMMANDS TO PROCESS INFORMATION
goto :EOF 
```

这是做什么的：for 命令末尾的“do call :process %%i %%j %%k”将 for 命令中获取的信息从 myfile.txt 传递到“进程”“子例程”。

在批处理程序中使用 for 命令时，需要对变量使用双 % 符号。

以下行将这些变量从 for 命令传递到进程“子例程”，并允许您处理此信息。

```
set VAR1=%1
 set VAR2=%2
 set VAR3=%3 
```

如果需要更多示例，我愿意分享这个精确设置的一些非常高级的用法。当然，根据需要添加您的 EOL 或 Delims。

* * *

## 回答 #4

> 赞同：30
> 
> 时间：2012-01-23T18:36:46.937

改进第一个“FOR / F ..”答案：我要做的是调用执行 MyList.txt 中列出的每个脚本，所以它对我有用：

```
for /F "tokens=*" %A in  (MyList.txt) do CALL %A ARG1 
```

--或者，如果您希望在多行上执行此操作：

```
for /F "tokens=*" %A in  (MuList.txt) do (
ECHO Processing %A....
CALL %A ARG1
) 
```

编辑：上面给出的示例是从命令提示符执行 FOR 循环；从批处理脚本中，需要添加额外的 %，如下所示：

```
---START of MyScript.bat---
@echo off
for /F "tokens=*" %%A in  ( MyList.TXT) do  (
   ECHO Processing %%A.... 
   CALL %%A ARG1 
)
@echo on
;---END of MyScript.bat--- 
```

* * *

## 回答 #5

> 赞同：23
> 
> 时间：2013-05-28T12:49:53.713

@MrKraus 的[回答](https://stackoverflow.com/a/163873/1358924)很有启发性。此外，让我补充一点，**如果要加载**与批处理文件位于同一目录中的文件，请在文件名前加上 %~dp0。这是一个例子：

```
cd /d %~dp0
for /F "tokens=*" %%A in (myfile.txt) do [process] %%A 
```

**注意：：**如果您的文件名或目录（例如上例中的 myfile.txt）有空格（例如 'my file.txt' 或 'c:\Program Files'），请使用：

```
for /F "tokens=*" %%A in ('type "my file.txt"') do [process] %%A 
```

，使用**type**关键字调用`type`程序，该程序显示文本文件的内容。如果您不想承受调用 type 命令的开销，您应该将目录更改为文本文件的目录。请注意，带有空格的文件名仍然需要 type 。

我希望这可以帮助别人！

* * *

## 回答 #6

> 赞同：18
> 
> 时间：2013-07-18T12:52:01.560

公认的答案很好，但有两个限制。
它删除空行和以开头的行`;`

要阅读任何内容的行，您需要延迟扩展切换技术。

```
@echo off
SETLOCAL DisableDelayedExpansion
FOR /F "usebackq delims=" %%a in (`"findstr /n ^^ text.txt"`) do (
    set "var=%%a"
    SETLOCAL EnableDelayedExpansion
    set "var=!var:*:=!"
    echo(!var!
    ENDLOCAL
) 
```

Findstr 用于在每行前面加上行号和冒号，因此空行不再为空。

访问参数时需要禁用DelayedExpansion `%%a`，否则感叹号`!`和插入符号`^`将丢失，因为它们在该模式下具有特殊含义。

但是要从行中删除行号，需要启用延迟扩展。
`set "var=!var:*:=!"`删除第一个冒号之前的所有冒号（使用`delims=:`也会删除一行开头的所有冒号，而不仅仅是 findstr 中的冒号）。
endlocal 为下一行再次禁用延迟扩展。

现在唯一的限制是 ~8191 的行长度限制，但似乎没有办法克服这一点。

* * *

## 回答 #7

> 赞同：14
> 
> 时间：2009-08-12T13:18:09.143

或者，您可以排除引号中的选项：

```
FOR /F %%i IN (myfile.txt) DO ECHO %%i 
```

* * *

## 回答 #8

> 赞同：9
> 
> 时间：2008-10-01T02:08:09.647

这是我编写的一个 bat 文件，用于执行文件夹中的所有 SQL 脚本：

```
REM ******************************************************************
REM Runs all *.sql scripts sorted by filename in the current folder.
REM To use integrated auth change -U <user> -P <password> to -E
REM ******************************************************************

dir /B /O:n *.sql > RunSqlScripts.tmp
for /F %%A in (RunSqlScripts.tmp) do osql -S (local) -d DEFAULT_DATABASE_NAME -U USERNAME_GOES_HERE -P PASSWORD_GOES_HERE -i %%A
del RunSqlScripts.tmp 
```

* * *

## 回答 #9

> 赞同：7
> 
> 时间：2008-10-01T02:03:54.790

如果您有一个 NT 系列 Windows（一个带有`cmd.exe`外壳的），请尝试[FOR /F 命令](http://technet.microsoft.com/library/bb490909.aspx)。

* * *

## 回答 #10

> 赞同：6
> 
> 时间：2018-10-14T19:39:30.443

接受的 anwser 使用`cmd.exe`和

```
for /F "tokens=*" %F in (file.txt) do whatever "%F" ... 
```

仅适用于“普通”文件。它以巨大的文件惨遭失败。

对于大文件，您可能需要使用 Powershell 和类似的东西：

```
[IO.File]::ReadLines("file.txt") | ForEach-Object { whatever "$_" } 
```

或者如果你有足够的内存：

```
foreach($line in [System.IO.File]::ReadLines("file.txt")) { whatever "$line" } 
```

这对我有用的 250 MB 文件包含超过 200 万行，其中`for /F ...`命令在几千行后卡住。

有关 和 之间的区别`foreach`，`ForEach-Object`请参阅[了解 ForEach 和 ForEach-Object](https://blogs.technet.microsoft.com/heyscriptingguy/2014/07/08/getting-to-know-foreach-and-foreach-object/)。

（学分：[在 PowerShell 中逐行读取文件](https://stackoverflow.com/questions/33511772/read-file-line-by-line-in-powershell) ）

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2013-01-11T19:27:38.153

在此处修改示例以列出我们在 Heroku 上的 Rails 应用程序 - 谢谢！

```
cmd /C "heroku list > heroku_apps.txt"
find /v "=" heroku_apps.txt | find /v ".TXT" | findstr /r /v /c:"^$" > heroku_apps_list.txt
for /F "tokens=1" %%i in (heroku_apps_list.txt) do heroku run bundle show rails --app %%i 
```

完整代码[在这里](https://gist.github.com/4512454/)。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2020-02-02T10:42:49.120

从命令行打印文本文件中的所有行（使用延迟扩展）：

```
set input="path/to/file.txt"

for /f "tokens=* delims=[" %i in ('type "%input%" ^| find /v /n ""') do (
set a=%i
set a=!a:*]=]!
echo:!a:~1!) 
```

适用于前导空白、空白行、空白行。

在 Win 10 CMD 上测试

[![测试文本](https://i.stack.imgur.com/82ttF.png)](https://i.stack.imgur.com/82ttF.png)

# regex - 我将使用什么 GNU/Linux 命令行工具来对文件执行搜索和替换？

> ID：155934
> 
> 赞同：26
> 
> 时间：2008-10-01T02:02:55.790
> 
> 标签：regex, linux, sed, gnu

我将使用什么 GNU/Linux 命令行工具来对文件执行搜索和替换？

可以以正则表达式格式指定搜索文本和替换吗？

* * *

## 回答 #1

> 赞同：52
> 
> 时间：2008-10-01T02:08:34.980

```
sed 's/a.*b/xyz/g;' old_file > new_file 
```

[GNU sed](http://www.gnu.org/software/sed/)（你可能有）更加通用：

```
sed -r --in-place 's/a(.*)b/x\1y/g;' your_file 
```

以下是这些选项的简要说明：

> **-i[SUFFIX], --in-place[=SUFFIX]** 就地编辑文件（如果提供扩展名，则进行备份）
> 
> **-r, --regexp-extended** 在脚本中使用扩展的正则表达式。

[FreeBSD](http://www.freebsd.org/cgi/man.cgi?query=sed&sektion=1)、[NetBSD](https://man.netbsd.org/sed.1)和[OpenBSD](http://man.openbsd.org/sed.1)版本也支持这些选项。

如果你想了解更多关于 sed 的信息，[Cori](https://stackoverflow.com/questions/155934/what-gnu-linux-command-line-tool-would-i-use-for-performing-a-search-and-replace/155944#155944)推荐[了这个教程](http://www.grymoire.com/Unix/Sed.html)。

* * *

## 回答 #2

> 赞同：28
> 
> 时间：2008-10-01T02:04:16.007

Perl 就是为此而发明的：

```
perl -pi -e 's/foo/bar/g;' *.txt 
```

这些单引号中的任何正常 s/// 模式。您可以使用以下内容进行备份：

```
perl -pi.bak -e 's/foo/bar/g;' *.txt 
```

或管道：

```
cat file.txt | perl -ne 's/foo/bar/g;' | less 
```

但这确实是 sed 的工作。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-10-01T19:41:44.013

将 Ruby 视为 Perl 的替代品。它像 Perl 一样为您窃取了大部分 Perl 的单行命令行参数 ( `-i`, `-p`, `-l`, `-e`, `-n`) 和自动设置`$_`，并且有很多正则表达式的优点。此外，Ruby 的语法可能比 Perl 或 sed 的语法更舒适、更易于阅读或编写。（或不，取决于你的口味。）

`ruby -pi.bak -e '$_.gsub!(/foo|bar/){|x| x.upcase}' *.txt`

对比

`perl -pi.bak -e 's/(foo|bar)/\U\1/g' *.txt`

在许多情况下，当处理单行代码时，性能并不足以成为关心您使用轻量级 sed 还是重量级 Perl 还是重量级 Ruby 的问题。使用最容易编写的任何内容。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-10-01T02:04:44.333

[sed](http://www.grymoire.com/Unix/Sed.html)，流编辑器，是的，它使用正则表达式。

# storage - 分布式文件源

> ID：155938
> 
> 赞同：1
> 
> 时间：2008-10-01T02:04:04.977
> 
> 标签：storage, distributed, nfs, mogilefs

寻找一种软件解决方案来存储分布在多个服务器上的大文件 (>50MB - 1.5GB)。我们已经研究过 MogileFS，但是，鉴于现有的软件需求，需要有一个 NFS 接口。更喜欢开源，但是，对所有选项开放。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-01T02:58:36.250

如果您只有少量服务器，您可以尝试[rsync](http://samba.anu.edu.au/rsync/)。将其与 SSH 结合使用以提高安全性。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-24T13:57:31.930

你看过 Hadoop DFS 吗？它比分布式文件系统要多得多，但应该适用于非常大的文件。

# uml - 您是否先设计/草图/绘制开发解决方案，然后再进行开发？如果有怎么办？

> ID：155948
> 
> 赞同：7
> 
> 时间：2008-10-01T02:06:37.107
> 
> 标签：uml, system

我经常与希望在他们的业务中更好地使用技术的决策者合作。我发现**一张图片胜过一千个单词**，并且在某种图表中对系统进行原型设计总是有助于讨论。我已经使用 Visio、UML（有点）、思维导图、流程图和模拟 WinForms 来启动这些赞助商的愿景，以确保每个人都在同一个页面上。我似乎一直在寻找可用于将业务愿景与开发流程结合起来的通用流程，以便我们都以相同的方式结束，“**解决问题的功能**”。

我正在寻找有关如何处理设计过程的建议或 Cliff 注释，以便它适用于可能只需要一周时间开发的应用程序，但也可以用于包含更大的项目。

我知道这深入到 UML 领域，但我发现我很难找到适当使用各种图表类型的指南，更不用说帮助业务用户理解图表并与它们相关联了。

您使用什么来捕捉系统/应用程序的愿景，然后呈现给项目的发起人？（所有在你写一行代码之前）......

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-01T02:18:40.213

纸或白板！

对于孤独的开发者，我建议使用纸张。至少一开始，最终你可能想用 UML 将它形式化，但我认为没有必要。

对于一组（物理上）一起工作的开发人员，我建议使用白板。这样，每个人都可以看到它，每个人都可以改进和贡献。同样，您可能想在这一点上正式化，但我仍然认为没有必要

当我第一次开始做 OOP（或设计一种算法）时，我会在编码时在脑海中完成这一切。但是在做了一些合理的复杂项目之后，我肯定看到了绘制系统中不同对象之间的交互的好处。

我自己做项目，所以我使用很多索引卡来设计课程和纸来进行互动。关键是它需要易于更改。我曾经使用过图表编辑器 Dia 来进行 UML，但是进行更改太难了。我希望能够进行快速更改，以便找出最有效的方法。

值得一提的是，TDD 和做“spike”[1] 项目也可以在设计系统时提供帮助。

[1] 来自 C# 中的极限编程冒险，第 8 页：

> “Spike”是一个极限编程术语，意思是“实验”。我们使用这个词是因为我们认为尖峰是一种快速、几乎是蛮力的实验，目的是只学习一件事。想想用木板钉一个大钉子。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-01T02:33:59.100

对于小型或非常有限的任务，我认为开发人员几乎普遍同意任何类型的图表都是不必要的步骤。

然而，在处理更大、更复杂的系统时，尤其是当两个或多个流程必须交互或需要复杂的业务逻辑时，[流程活动图](http://www.agilemodeling.com/style/activityDiagram.htm "过程活动图")可能非常有用。我们在开发中使用相当纯粹的敏捷方法，发现这些几乎是我们使用的唯一图表类型。令人惊讶的是，您可以通过将所有大件放在您面前并用流线连接它们来优化高级设计。我不能强调根据您的问题定制图表的重要性，而不是相反，因此虽然链接提供了一个很好的起点，但只需添加有意义的内容来表示您的系统/问题。

至于存储，白板非常适合头脑风暴和想法仍在完善时，但我认为，一旦想法形成相当最终的形状，电子和 wiki 会更好（如果你是，OmniGraffle 是图表之王很幸运能够在工作中使用 Mac :) 。拥有一个可以转储所有这些图表的区域对于新手快速掌握系统的整体部分而无需深入研究代码非常有帮助。此外，由于活动图代表更大的逻辑块，因此不存在必须始终保持最新状态的问题。当您对系统进行重大更改时，可以，但希望无论如何都可能使用现有图表来计划更改。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-01T02:20:25.920

来自*[概念大片：更好](https://rads.stackoverflow.com/amzn/click/com/0738205370)*的想法指南 James L. Adams：

> 智力障碍导致智力策略选择低效或智力弹药短缺。. . . 1\. 使用不正确的语言（口头的、数学的、视觉的）解决问题——比如试图用数学方法解决一个问题，而这个问题可以更容易地在视觉上完成

（第 71 页，第 3 版）

不用说，如果您选择使用图表来捕捉可能用数学更好地捕捉的想法，那同样糟糕。当然，诀窍是找到正确的语言来表达问题和解决方案。当然，使用一种以上的语言来表达问题和解决方案可能是合适的。

我的意思是你假设图表是最好的方法。我不确定我是否愿意做出这样的假设。您可能会通过其他一些制定要求和提议的设计的方法获得更好的答案（并且客户可能对结果更满意）。

顺便说一句，强烈推荐阅读概念性大片。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-01T02:23:55.770

阅读 Kruchten 的[4+1 Views](http://en.wikipedia.org/wiki/4%2B1)。

这是您可以继续的方法。

1.  将用例收集到用例图中。这将显示参与者和用例。该图并没有从很多细节开始。

2.  优先考虑用例以关注高价值用例。

3.  写叙述。如果需要，您可以绘制活动图。

以上完全是非技术性的。UML 对要使用的形状施加了一些规则，但除此之外，您可以用最终用户术语来描述事物。

1.  您可以进行名词分析，绘制类图来说明实体和关系。首先，这些将在用户术语中。没有令人讨厌的技术内容。

2.  您可以展开活动图或添加序列图以显示处理模型。这将从最终用户对处理的非技术描述开始。

3.  您可以遍历类和活动图以从分析转向设计。在某些时候，您将退出分析并进入工程模式。用户可能不想看到所有这些图片。

4.  您可以为开发视图绘制组件图，为物理视图绘制部署图。这些也将随着您对系统概念的扩展和完善而迭代。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-01T02:25:22.757

在设计应用程序时（我主要创建 Web 应用程序，但这确实适用于其他应用程序），我通常会创建用户故事来确定最终用户真正需要什么。这些构成了典型的“业务需求”。

在确定用户故事后，我会创建流程图来列出人们在使用应用程序时将采用的路径。

在该步骤之后（有时会获得批准过程），我创建界面草图（钢笔/铅笔和方格纸），并开始数据库的布局。这一步和下一步通常是最耗时的过程。

下一步是绘制草图并将它们变成清理过的线框。我在这一步中使用 OmniGraffle——它比 Visio 早了几光年。

在此之后，您可能想做典型的 UML 图，或其他对象布局/功能组织，但业务人员不会太在意那种细节 :)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-01T02:33:08.480

当我整合一个设计时，我关心的是如何将想法清晰而轻松地传达给观众。该观众由（通常）具有不同背景的不同人组成。我不想做的是进入特定设计模型的“教学模式”。如果我必须花大量时间告诉我的客户实心箭头的含义以及它与空心箭头的不同之处或方形与圆形的含义，我没有取得进展——至少没有取得进展我想要。

如果它是相当非正式的，我会在白板或一些纸上画出来——最多是块和简单的箭头。此时粗略设计的重点是确保我们在同一页面上。不过会因客户而异。

如果它更正式，我可能会拿出一个 UML 工具并整理一些图表，但大多数我的客户不编写软件，并且可能只是对内部部分感兴趣。我们将其保持在“气泡和线条”级别，并且可能会整理一些需要澄清的项目符号列表。我的客户通常不想看到类图或类似的东西。

如果我们需要展示一些 GUI 交互，我会在 Visual Studio 中拼凑一些简单的窗口原型——它既快速又简单。我发现客户可以很容易地理解这一点。

简而言之，我制作了简单的图纸（以某种格式），可以将设计传达给相关方和利益相关者。我确保我知道我想要它做什么，更重要的是——他们需要它做什么，并与之交谈。它通常不会进入杂草，因为人们迷路了，而且我发现没有时间花时间将所有内容绘制到第 n 级。最终，如果客户和我（以及所有其他相关方）在讨论完设计后在同一页面上，我是一个快乐的人。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-01T02:43:55.927

我是一个敏捷的人，所以我倾向于不花很多时间在图表上。有时候，在白板或餐巾纸上画草图有助于确保您了解特定问题或要求，但没有什么比将工作软件放在客户面前让他们了解它是如何工作的更好的了。如果您的客户会接受频繁的迭代和演示而不是前期设计，我建议您去接受它。如果他们能够以通过单元或集成测试的形式获得早期反馈，那就更好了（[Fit](http://fit.c2.com/)之类的东西在这里很好用）。

我通常不喜欢原型，因为原型往往成为最终产品。我不幸地从事一个项目，该项目基本上是扩展商业产品，结果证明是一个“概念证明”，被打包并出售。在针对核心应用程序记录了 1000 多个缺陷后，该项目被取消（不包括我们目前正在进行的任何增强或定制）。

我尝试过使用 UML，发现除非看图表的人理解 UML，否则它们几乎没有帮助。屏幕模型通常不是一个坏主意，但它们只显示直接影响用户的应用程序的一面，因此您不会为任何不是演示的东西获得太多里程。奇怪的是，像 Visual Studio 中的工作流设计器这样的工具可以生成非常清晰的图表，非开发人员也很容易理解，因此如果您的应用程序足够复杂，可以从中受益，它是生成核心应用程序工作流的好工具。

尽管如此，在我多年来使用的所有方法中，没有什么比让用户亲自动手让您知道您对问题的理解程度更好的了。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-01T05:07:16.097

我建议阅读 Joel 关于“无痛功能规范”的文章。第 1 部分的标题是[“为什么要打扰？”](http://www.joelonsoftware.com/articles/fog0000000036.html) .

我们在工作中使用[样机屏幕](http://www.mockupscreens.com/)（“快速简单的屏幕原型”）。更改屏幕很容易，并且草图清楚地表明这只是一个设计。

然后将模型包含在包含规范的 Word 文档中。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-01T02:41:47.833

如果您正在与许多利益相关者和许多贡献者一起处理一个大型且规避风险的项目，那么 UML 建议很有效。即使在这些项目中，开发一个原型展示给决策者也确实很有帮助。通常通过 UI 和典型的用户故事引导他们就足够了。也就是说，您必须注意，专注于决策者的 UI 往往会使他们忽略一些重要的后端问题，例如验证、业务规则和数据完整性。他们倾向于将这些问题视为“技术”问题而不是业务决策。

另一方面，如果您正在从事一个敏捷项目，在该项目中可以快速更改代码（并快速回滚错误），您可能能够制作一个包含所有工作的进化原型。您的应用程序架构应该足够灵活和灵活，以支持快速更改（例如裸对象设计模式或 Rails 风格的 MVC）。它有助于建立一种鼓励实验的开发文化，并承认 BDUF 不能预测软件能否成功运行。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2013-06-18T23:20:33.540

4+1 视图只对技术人员有用。只有当他们足够感兴趣时。还记得你在与客户讨论用例图的最后十几次努力吗？

我发现唯一对每个人都有效的事情实际上是向他们展示你的应用程序的屏幕。你自己说过：一张图抵得上一千个字。

奇怪的是，有两种方法对我有用：

1.  向用户提供完整的用户手册（甚至在开发开始之前），或者
2.  使用看起来不像完成的应用程序的模型：首先讨论你的应用程序的主屏幕。满意后，继续讨论模型，但一次只讨论一个场景。

对于选项（1），您可以使用任何您想要的，这并不重要。

对于选项（2），从笔和纸开始是完全可以的。但是很快你最好使用专门的模型工具（只要你需要编辑、维护或组织你的模型）

我最终在 2005 年编写了自己的模型工具，它变得非常流行：[MockupScreens](http://MockupScreens.com)

这是我所知道的最完整的模型工具列表。其中许多是免费的：[http ://c2.com/cgi/wiki?GuiPrototypingTools](http://c2.com/cgi/wiki?GuiPrototypingTools)

# c# - OleDbException 系统资源超出

> ID：155959
> 
> 赞同：8
> 
> 时间：2008-10-01T02:10:10.407
> 
> 标签：c#, oledbexception

下面的代码执行一个简单的插入命令。如果连续调用 2,000 次（插入 2,000 行），则会抛出带有 message = "System Resources Exceeded" 的 OleDbException。我还应该做些什么来释放资源吗？

```
using (OleDbConnection conn = new OleDbConnection(connectionString))
using (OleDbCommand cmd = new OleDbCommand(commandText, conn))
{
    conn.Open();
    cmd.ExecuteNonQuery();
} 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-01T02:12:17.140

超出系统资源的错误不是来自托管代码，而是来自您杀死数据库（JET？）

您打开的连接太多，太快了...

一些技巧：

*   通过不为每个命令打开新连接来避免往返，并使用单个连接执行插入。
*   确保数据库连接池正常工作。（不确定这是否适用于 OLEDB 连接。）
*   考虑使用更优化的方式插入数据。

你试过这个吗？

```
using (OleDBConnection conn = new OleDBConnection(connstr))
{
    while (IHaveData)
    {
        using (OldDBCommand cmd = new OldDBCommand())
        {
            cmd.Connection = conn;
            cmd.ExecuteScalar();
        }
    }
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-01T02:46:57.773

我用 Access 2007 数据库毫无例外地测试了这段代码（我的插入次数高达 13000 次）。

但是，我注意到它非常慢，因为您每次都在创建连接。如果将“使用（连接）”放在循环之外，它会更快。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-01T03:29:22.760

除了上述（仅连接到数据库一次）之外，我还想确保您正在关闭并处理您的连接。由于 c# 中的大多数对象都是由内存管理的，因此连接和流并不总是具有这种奢侈，因此如果不处理这样的对象，则不能保证它们会被清理。这具有使该连接在程序生命周期内保持打开状态的附加效果。

另外，如果可能的话，我会考虑使用事务。我不知道您使用此代码的目的是什么，但 OleDbTransactions 在插入和更新数据库中的许多行时很有用。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-11T16:08:13.063

我不确定具体细节，但我遇到了类似的问题。我们使用带有 IIS 的 Access 数据库来为我们的客户提供服务。我们没有很多客户端，但是在单个会话期间打开和关闭了很多连接。经过大约一周的工作，我们收到了同样的错误，并且所有连接尝试都失败了。为了纠正这个问题，我们所要做的就是重新启动工作进程。

经过一番研究，我发现（当然）Access 在这种环境下表现不佳。资源没有得到正确释放，随着时间的推移，可执行文件将耗尽。为了解决这个问题，我们将迁移到 Oracle 数据库。如果这不能解决问题，我会及时通知您我的发现。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2014-01-20T06:40:18.410

这可能是因为您没有处理创建的 Connection 和 Command 对象。始终在最后处理对象。

```
OledbCommand.Dispose(); 
```

# iphone - 您在编写 Objective-C 和 Cocoa 时使用了哪些最佳实践？

> ID：155964
> 
> 赞同：346
> 
> 时间：2008-10-01T02:13:42.270
> 
> 标签：iphone, objective-c, cocoa, cocoa-touch, ios

我知道[HIG](http://developer.apple.com/library/mac/#documentation/UserExperience/Conceptual/AppleHIGuidelines/Intro/Intro.html)（非常方便！），但是在编写 Objective-C 时，尤其是在使用 Cocoa（或 CocoaTouch）时，您使用了哪些编程实践。

* * *

## 回答 #1

> 赞同：398
> 
> 时间：2008-10-01T03:17:10.090

我已经开始做一些我认为不是标准的事情：

1）随着属性的出现，我不再使用“_”作为“私有”类变量的前缀。毕竟，如果一个变量可以被其他类访问，不应该有一个属性吗？我一直不喜欢“_”前缀让代码更难看，现在我可以省略它了。

2）说到私有的东西，我更喜欢将私有方法定义放在 .m 文件中的类扩展中，如下所示：

```
#import "MyClass.h"

@interface MyClass ()
- (void) someMethod;
- (void) someOtherMethod;
@end

@implementation MyClass 
```

为什么要在 .h 文件中塞满外人不应该关心的东西？空 () 适用于 .m 文件中的私有类别，如果您不实现声明的方法，则会发出编译警告。

3) 我已将 dealloc 放在 .m 文件的顶部，就在 @synthesize 指令的下方。你dealloc不应该在你想在课堂上考虑的事情列表的顶部吗？在 iPhone 这样的环境中尤其如此。

3.5）在表格单元格中，使每个元素（包括单元格本身）不透明以提高性能。这意味着在所有内容中设置适当的背景颜色。

3.6) 当使用 NSURLConnection 时，通常你可能想要实现委托方法：

```
- (NSCachedURLResponse *)connection:(NSURLConnection *)connection
                  willCacheResponse:(NSCachedURLResponse *)cachedResponse
{
      return nil;
} 
```

我发现大多数 Web 调用都是非常单一的，它比您希望缓存响应的规则更例外，尤其是对于 Web 服务调用。实现所示方法会禁用响应缓存。

同样有趣的是，约瑟夫·马蒂洛 (Joseph Mattiello) 提供了一些针对 iPhone 的优秀技巧（在 iPhone 邮件列表中收到）。还有更多，但这些是我认为最普遍有用的（请注意，现在对原始版本进行了一些轻微编辑，以包含回复中提供的详细信息）：

4) 仅在必要时使用双精度，例如在使用 CoreLocation 时。确保以“f”结束常量，以使 gcc 将它们存储为浮点数。

```
float val = someFloat * 2.2f; 
```

当实际上可能是双精度时，这一点最重要`someFloat`，您不需要混合模式数学，因为您在存储的“val”中失去了精度。虽然 iPhone 的硬件支持浮点数，但与单精度相比，执行双精度算术可能仍需要更多时间。参考：

*   [iPhone上的双倍vs浮动](https://stackoverflow.com/questions/1622729/double-vs-float-on-the-iphone)
*   [iPhone/iPad 双精度数学](https://stackoverflow.com/questions/8854001/iphone-ipad-double-precision-math)

在较旧的手机上，据说计算以相同的速度运行，但您可以在寄存器中拥有比双精度更多的单精度组件，因此对于许多计算而言，单精度最终会更快。

5）将您的属性设置为`nonatomic`。它们是`atomic`默认的，在综合时，将创建信号量代码以防止多线程问题。99% 的人可能不需要担心这一点，并且当设置为非原子时，代码不会那么臃肿并且内存效率更高。

6) SQLite 可以是一种非常、非常快速的缓存大型数据集的方法。例如，地图应用程序可以将其切片缓存到 SQLite 文件中。最昂贵的部分是磁盘 I/O。通过在大块之间发送`BEGIN;`和避免许多小写。`COMMIT;`例如，我们使用 2 秒计时器，在每次新提交时重置。当它过期时，我们发送 COMMIT；，这会导致您的所有写入都集中在一大块中。SQLite 将事务数据存储到磁盘并执行此开始/结束包装避免创建许多事务文件，将所有事务分组到一个文件中。

此外，如果 SQL 在您的主线程上，它将阻止您的 GUI。如果您有一个很长的查询，最好将您的查询存储为静态对象，并在单独的线程上运行您的 SQL。确保将任何修改数据库的查询字符串包装在`@synchronize() {}`块中。对于简短的查询，只需将内容留在主线程上即可更方便。

更多 SQLite 优化技巧在这里，虽然文档看起来已经过时了，但许多点可能还是不错的；

[http://web.utk.edu/~jplyon/sqlite/SQLite_optimization_FAQ.html](http://web.utk.edu/~jplyon/sqlite/SQLite_optimization_FAQ.html)

* * *

## 回答 #2

> 赞同：109
> 
> 时间：2008-10-06T16:46:23.707

## 不要使用未知字符串作为格式字符串

当方法或函数采用格式字符串参数时，您应该确保您可以控制格式字符串的内容。

例如，在记录字符串时，很容易将字符串变量作为唯一参数传递给`NSLog`：

```
 NSString *aString = // get a string from somewhere;
    NSLog(aString); 
```

这样做的问题是字符串可能包含被解释为格式字符串的字符。这可能导致错误输出、崩溃和安全问题。相反，您应该将字符串变量替换为格式字符串：

```
 NSLog(@"%@", aString); 
```

* * *

## 回答 #3

> 赞同：107
> 
> 时间：2008-10-01T15:47:25.137

使用标准的 Cocoa 命名和格式化约定和术语，而不是您在其他环境中习惯的任何东西。那里**有**很多 Cocoa 开发人员，当他们中的另一个人开始使用您的代码时，如果它的外观和感觉与其他 Cocoa 代码相似，将会更加平易近人。

做什么和不做什么的例子：

*   不要`id m_something;`在对象的接口中声明并称其为*成员变量*或*字段*；使用`something`or`_something`作为它的名字并将其称为*实例变量*。
*   不要命名吸气剂`-getSomething`；正确的 Cocoa 名称是 just `-something`。
*   不要命名 setter `-something:`；它应该是`-setSomething:`
*   方法名称散布在参数中并包含冒号；是`-[NSObject performSelector:withObject:]`，不是`NSObject::performSelector`。
*   在方法名、参数、变量、类名等中使用大写字母（CamelCase）而不是下划线（下划线）。
*   类名以大写字母开头，变量名和方法名以小写字母开头。

无论您做什么，**都不要**使用 Win16/Win32 风格的匈牙利符号。甚至微软也放弃了这一点，转向了 .NET 平台。

* * *

## 回答 #4

> 赞同：106
> 
> 时间：2008-10-03T15:43:40.280

## IB奥特莱斯

从历史上看，网点的内存管理一直很差。当前的最佳实践是将出口声明为属性：

```
@interface MyClass :NSObject {
    NSTextField *textField;
}
@property (nonatomic, retain) IBOutlet NSTextField *textField;
@end 
```

使用属性使内存管理语义清晰；如果您使用实例变量综合，它还提供一致的模式。

* * *

## 回答 #5

> 赞同：97
> 
> 时间：2008-10-04T05:15:29.970

## 使用 LLVM/Clang 静态分析器

注意：在 Xcode 4 下，它现在已内置到 IDE 中。

您使用[Clang 静态分析器](http://clang.llvm.org/StaticAnalysis.html)- 不出所料 - 在 Mac OS X 10.5 上分析您的 C 和 Objective-C 代码（还没有 C++）。安装和使用很简单：

1.  [从此页面](http://clang.llvm.org/StaticAnalysisUsage.html)下载最新版本。
2.  从命令行，`cd`到您的项目目录。
3.  执行`scan-build -k -V xcodebuild`。

（还有一些额外的限制等，特别是您应该在其“调试”配置中分析一个项目——有关详细信息，请参阅[http://clang.llvm.org/StaticAnalysisUsage.html](http://clang.llvm.org/StaticAnalysisUsage.html) ——但这或多或少它归结为什么。）

然后分析器为您生成一组网页，显示可能的内存管理和编译器无法检测到的其他基本问题。

* * *

## 回答 #6

> 赞同：94
> 
> 时间：2008-10-01T04:59:44.367

这是一种微妙但方便的方法。如果您将自己作为委托传递给另一个对象，请在您之前重置该对象的委托`dealloc`。

```
- (void)dealloc
{
self.someObject.delegate = NULL;
self.someObject = NULL;
//
[super dealloc];
} 
```

通过这样做，您可以确保不再发送委托方法。当您即将`dealloc`消失在以太中时，您要确保没有任何东西可以意外地向您发送任何消息。记住 self.someObject 可能被另一个对象保留（它可能是一个单例或在自动释放池上或其他），直到你告诉它“停止向我发送消息！”，它认为你即将被释放的对象是公平的游戏。

养成这种习惯将使您免于许多调试起来很痛苦的奇怪崩溃。

同样的原则也适用于 Key Value Observation 和 NSNotifications。

编辑：

更具防御性，更改：

```
self.someObject.delegate = NULL; 
```

进入：

```
if (self.someObject.delegate == self)
    self.someObject.delegate = NULL; 
```

* * *

## 回答 #7

> 赞同：86
> 
> 时间：2008-10-01T03:53:27.943

@肯德尔

代替：

```
@interface MyClass (private)
- (void) someMethod
- (void) someOtherMethod
@end 
```

采用：

```
@interface MyClass ()
- (void) someMethod
- (void) someOtherMethod
@end 
```

Objective-C 2.0 中的新功能。

Apple 的 Objective-C 2.0 参考中描述了类扩展。

*“类扩展允许您在主类 @interface 块内以外的位置为类声明其他所需的 API”*

所以他们是实际班级的一部分——而不是除了班级之外的（私人）类别。微妙但重要的区别。

* * *

## 回答 #8

> 赞同：75
> 
> 时间：2008-10-06T19:45:30.413

## 避免自动释放

由于您通常 (1) 无法直接控制它们的生命周期，因此自动释放的对象可能会持续较长时间，并不必要地增加应用程序的内存占用。虽然在桌面上这可能没什么影响，但在更受限制的平台上，这可能是一个重大问题。因此，在所有平台上，尤其是在更受限制的平台上，最好的做法是避免使用会导致自动释放对象的方法，而是鼓励您使用 alloc/init 模式。

因此，而不是：

```
aVariable = [AClass convenienceMethod]; 
```

在可能的情况下，您应该改用：

```
aVariable = [[AClass alloc] init];
// do things with aVariable
[aVariable release]; 
```

当您编写自己的方法来返回一个新创建的对象时，您可以利用[Cocoa 的命名约定](http://developer.apple.com/documentation/Cocoa/Conceptual/MemoryMgmt/Tasks/MemoryManagementRules.html#//apple_ref/doc/uid/20000994)向接收者标记它必须通过在方法名称前加上“new”来释放它。

因此，而不是：

```
- (MyClass *)convenienceMethod {
    MyClass *instance = [[[self alloc] init] autorelease];
    // configure instance
    return instance;
} 
```

你可以写：

```
- (MyClass *)newInstance {
    MyClass *instance = [[self alloc] init];
    // configure instance
    return instance;
} 
```

由于方法名称以“new”开头，因此 API 的使用者知道他们负责释放接收到的对象（例如，参见[NSObjectController 的`newObject`方法](http://developer.apple.com/documentation/Cocoa/Reference/ApplicationKit/Classes/NSObjectController_Class/Reference/Reference.html#//apple_ref/doc/uid/20002044-BBCEAICF)）。

(1) 您可以使用自己的本地自动释放池进行控制。有关这方面的更多信息，请参阅[自动释放池](http://developer.apple.com/documentation/Cocoa/Conceptual/MemoryMgmt/Concepts/AutoreleasePools.html#//apple_ref/doc/uid/20000047)。

* * *

## 回答 #9

> 赞同：69
> 
> 时间：2008-11-17T23:11:06.440

其中一些已经提到过，但这是我能想到的：

*   **遵循 KVO 命名规则。**即使您现在不使用 KVO，根据我的经验，它在未来仍然很有用。如果你使用 KVO 或绑定，你需要知道事情正在按照他们应该的方式工作。这不仅包括访问器方法和实例变量，还包括对多关系、验证、自动通知相关键等。
*   **将私有方法放在一个类别中。**不仅是接口，还有实现。在私有方法和非私有方法之间有一些概念上的距离是很好的。我将所有内容都包含在我的 .m 文件中。
*   **将后台线程方法放在一个类别中。**和上面一样。我发现当你在思考主线程上有什么和没有什么时，保持一个清晰的概念障碍是很好的。
*   **使用`#pragma mark [section]`.** 通常我按我自己的方法、每个子类的覆盖以及任何信息或正式协议进行分组。这使得跳转到我正在寻找的内容变得更加容易。在同一个主题上，将相似的方法（如表格视图的委托方法）组合在一起，不要只是将它们粘在任何地方。
*   **使用 _ 前缀私有方法和 ivars。**我喜欢它的外观，当我指的是意外财产时，我不太可能使用 ivar。
*   **不要在 init 和 dealloc 中使用 mutator 方法/属性。**我从来没有因为它发生过任何不好的事情，但是如果您更改方法以执行取决于对象状态的操作，我可以看到逻辑。
*   **将 IBOutlets 放在属性中。**我实际上只是在这里读到这个，但我要开始做。不管有什么记忆好处，它在风格上似乎更好（至少对我来说）。
*   **避免编写您并非绝对需要的代码。**这确实涵盖了很多事情，比如在需要时制作 ivars `#define`，或者缓存一个数组而不是在每次需要数据时对其进行排序。关于这一点我可以说很多，但底线是在你需要它之​​前不要编写代码，或者探查器告诉你。从长远来看，它使事情更容易维护。
*   **完成你开始的事情。**拥有大量半成品、有缺陷的代码是杀死项目的最快方法。如果您需要一个很好的存根方法，只需通过放入`NSLog( @"stub" )`内部来指示它，或者您想要跟踪事物。

* * *

## 回答 #10

> 赞同：56
> 
> 时间：2008-10-01T08:04:58.073

编写单元测试。你可以在 Cocoa 中测试**很多**在其他框架中可能更难的东西。例如，使用 UI 代码，您通常可以验证事物是否按应有的方式连接，并相信它们在使用时会正常工作。您可以轻松设置状态并调用委托方法来测试它们。

您也没有公共、受保护和私有方法的可见性妨碍为您的内部编写测试。

* * *

## 回答 #11

> 赞同：55
> 
> 时间：2008-10-01T02:16:48.207

黄金法则：如果你`alloc`就是你`release`！

更新：除非您使用 ARC

* * *

## 回答 #12

> 赞同：54
> 
> 时间：2008-10-01T15:40:11.363

不要把 Objective-C 写成 Java/C#/C++/等。

我曾经看到一个习惯于编写 Java EE Web 应用程序的团队尝试编写一个 Cocoa 桌面应用程序。就好像它是一个 Java EE Web 应用程序一样。当他们真正需要的只是一个 Foo 类和可能的 Fooable 协议时，有很多 AbstractFooFactory 和 FooFactory 以及 IFoo 和 Foo 飞来飞去。

确保您不这样做的一部分是真正理解语言的差异。例如，您不需要上面的抽象工厂和工厂类，因为 Objective-C 类方法与实例方法一样动态调度，并且可以在子类中被覆盖。

* * *

## 回答 #13

> 赞同：50
> 
> 时间：2008-10-01T16:35:03.790

确保将[Debugging Magic](http://developer.apple.com/technotes/tn2004/tn2124.html)页面添加为书签。这应该是您在试图找到 Cocoa 虫源时将头撞到墙上的第一站。

例如，它将告诉您如何找到您首先分配内存的方法，该方法后来导致崩溃（例如在应用程序终止期间）。

* * *

## 回答 #14

> 赞同：38
> 
> 时间：2008-10-01T05:16:50.597

尽量避免我现在决定称之为 Newbiecategoryaholism 的东西。当 Objective-C 的新手发现类别时，他们经常会疯狂，为现有的每个类添加有用的小类别（*“什么？我可以添加一个方法来将数字转换为罗马数字到 NSNumber 摇滚！”*）。

不要这样做。

无需在两打基础类之上散布几十个小类别方法，您的代码将更可移植且更易于理解。

大多数时候，当您真的认为需要一个类别方法来帮助简化某些代码时，您会发现您永远不会重用该方法。

还有其他危险，除非您为您的类别方法命名空间（除了完全疯狂的 ddribin 之外还有谁？）Apple，或插件或在您的地址空间中运行的其他东西也有可能定义相同的类别具有相同名称但副作用略有不同的方法....

好的。既然您已被警告过，请忽略“不要做这部分”。但要极端克制。

* * *

## 回答 #15

> 赞同：37
> 
> 时间：2008-10-01T08:10:26.327

抵制将世界子类化。在 Cocoa 中，很多事情是通过委托和使用底层运行时完成的，而在其他框架中则是通过子类化完成的。

例如，在 Java 中，您经常使用匿名`*Listener`子类的实例，而在 .NET 中，您经常使用您的`EventArgs`子类。在 Cocoa 中，你也不会这样做——而是使用 target-action。

* * *

## 回答 #16

> 赞同：37
> 
> 时间：2008-10-06T16:49:19.083

## 根据用户需要对字符串进行排序

当您对字符串进行排序以呈现给用户时，您不应该使用 simple`compare:`方法。相反，您应该始终使用本地化比较方法，例如`localizedCompare:`or `localizedCaseInsensitiveCompare:`。

有关更多详细信息，请参阅[搜索、比较和排序字符串](http://developer.apple.com/documentation/Cocoa/Conceptual/Strings/Articles/SearchingStrings.html)。

* * *

## 回答 #17

> 赞同：31
> 
> 时间：2008-10-03T15:51:39.997

## 声明的属性

您通常应该对所有属性使用 Objective-C 2.0 声明的属性功能。如果它们不是公共的，请将它们添加到类扩展中。使用声明的属性可以使内存管理语义立即清晰，并使您更容易检查您的 dealloc 方法——如果您将属性声明分组在一起，您可以快速扫描它们并与您的 dealloc 方法的实现进行比较。

在不将属性标记为“非原子”之前，您应该三思而后行。正如[《Objective C 编程语言指南》](http://developer.apple.com/documentation/Cocoa/Conceptual/ObjectiveC/Introduction/chapter_1_section_1.html)所指出的，属性默认是原子的，并且会产生相当大的开销。此外，简单地使您的所有属性原子化并不能使您的应用程序线程安全。当然，还要注意，如果您不指定“非原子”并实现自己的访问器方法（而不是综合它们），则必须以原子方式实现它们。

* * *

## 回答 #18

> 赞同：26
> 
> 时间：2008-10-12T20:14:24.740

## 考虑 nil 值

正如[这个问题](https://stackoverflow.com/questions/156395/sending-a-message-to-nil)所指出的，消息`nil`在 Objective-C 中是有效的。`nil`虽然这通常是一个优势——导致代码更简洁、更自然——但如果你在没有预料到的时候 得到了一个值，这个特性偶尔会导致特殊的和难以追踪的错误。

* * *

## 回答 #19

> 赞同：26
> 
> 时间：2009-05-07T20:57:48.947

使用 NSAssert 和朋友。我一直使用 nil 作为有效对象……尤其是向 nil 发送消息在 Obj-C 中是完全有效的。但是，如果我真的想确定变量的状态，我会使用 NSAssert 和 NSParameterAssert，这有助于轻松追踪问题。

* * *

## 回答 #20

> 赞同：23
> 
> 时间：2010-08-27T10:17:32.057

简单但经常被遗忘的一个。根据规格：

> 通常，具有相同选择器（相同名称）的不同类中的方法也必须共享相同的返回和参数类型。此约束由编译器强加以允许动态绑定。

在这种情况下，所有相同命名的选择器，**即使在不同的 classes**中，都将被视为具有相同的返回/参数类型。这是一个简单的例子。

```
@interface FooInt:NSObject{}
-(int) print;
@end

@implementation FooInt
-(int) print{
    return 5;
}
@end

@interface FooFloat:NSObject{}
-(float) print;
@end

@implementation FooFloat
-(float) print{
    return 3.3;
}
@end

int main (int argc, const char * argv[]) {

    NSAutoreleasePool * pool = [[NSAutoreleasePool alloc] init];    
    id f1=[[FooFloat alloc]init];
    //prints 0, runtime considers [f1 print] to return int, as f1's type is "id" and FooInt precedes FooBar
    NSLog(@"%f",[f1 print]);

    FooFloat* f2=[[FooFloat alloc]init];
    //prints 3.3 expectedly as the static type is FooFloat
    NSLog(@"%f",[f2 print]);

    [f1 release];
    [f2 release]
    [pool drain];

    return 0;
} 
```

* * *

## 回答 #21

> 赞同：22
> 
> 时间：2008-10-01T16:57:52.737

如果您使用 Leopard (Mac OS X 10.5) 或更高版本，您可以使用 Instruments 应用程序来查找和跟踪内存泄漏。在 Xcode 中构建程序后，选择 Run > Start with Performance Tool > Leaks。

即使您的应用程序没有显示任何泄漏，您也可能将对象保留的时间过长。在 Instruments 中，您可以为此使用 ObjectAlloc 工具。在 Instruments 文档中选择 ObjectAlloc 工具，然后通过选择 View > Detail（它旁边应该有一个复选标记）调出工具的详细信息（如果它尚未显示）。在 ObjectAlloc 详细信息中的“分配生命周期”下，确保选择“已创建且仍然存在”旁边的单选按钮。

现在，无论何时停止记录应用程序，选择 ObjectAlloc 工具都会在“#Net”列中显示对应用程序中每个仍然存在的对象的引用数。确保您不仅查看您自己的类，而且查看您的 NIB 文件的顶级对象的类。例如，如果屏幕上没有窗口，并且您看到对仍然存在的 NSWindow 的引用，那么您可能还没有在代码中发布它。

* * *

## 回答 #22

> 赞同：21
> 
> 时间：2008-10-01T04:54:13.757

在 dealloc 中清理。

这是最容易忘记的事情之一——尤其是。以 150 英里/小时的速度进行编码时。总是，总是，总是在 dealloc 中清理你的属性/成员变量。

我喜欢使用 Objc 2 属性——*使用*新的点符号——所以这使得清理工作变得轻松。通常很简单：

```
- (void)dealloc
{
    self.someAttribute = NULL;
    [super dealloc];
} 
```

这将为您处理发布并将属性设置为 NULL（我认为这是防御性编程 - 以防在 dealloc 中进一步向下的另一种方法再次访问成员变量 - 很少见但*可能*发生）。

在 10.5 中启用 GC 后，不再需要这么多 - 但您可能仍需要清理您创建的其他资源，您可以在 finalize 方法中执行此操作。

* * *

## 回答 #23

> 赞同：17
> 
> 时间：2008-12-16T19:27:06.570

所有这些评论都很棒，但我真的很惊讶没有人提到不久前发布的[Google 的 Objective-C 样式指南](http://google-styleguide.googlecode.com/svn/trunk/objcguide.xml)。我认为他们已经完成了非常彻底的工作。

* * *

## 回答 #24

> 赞同：15
> 
> 时间：2008-10-01T05:31:02.607

此外，半相关主题（有更多回复的空间！）：

[您希望在 2 年前了解的那些 Xcode 小技巧和窍门是什么？](https://stackoverflow.com/questions/146297/what-are-those-little-xcode-tips-tricks-you-wish-you-knew-about-2-years-ago).

* * *

## 回答 #25

> 赞同：13
> 
> 时间：2008-10-01T17:02:07.110

不要忘记 NSWindowController 和 NSViewController 将释放它们管理的 NIB 文件的顶级对象。

如果您手动加载 NIB 文件，则您有责任在使用完该 NIB 的顶级对象后释放它们。

* * *

## 回答 #26

> 赞同：12
> 
> 时间：2010-07-12T19:09:57.860

对于初学者来说，一个相当明显的方法是：利用 Xcode 的代码自动缩进功能。即使您是从另一个来源复制/粘贴，一旦您粘贴了代码，您也可以选择整个代码块，右键单击它，然后选择重新缩进该块中所有内容的选项。

Xcode 实际上会解析该部分并根据括号、循环等对其进行缩进。这比在每一行都按空格键或制表键要有效得多。

* * *

## 回答 #27

> 赞同：10
> 
> 时间：2008-10-01T16:19:14.217

我知道我在第一次接触 Cocoa 编程时忽略了这一点。

确保您了解有关 NIB 文件的内存管理职责。您负责释放您加载的任何 NIB 文件中的顶级对象。阅读有关该主题[的 Apple 文档。](http://developer.apple.com/documentation/Cocoa/Conceptual/LoadingResources/CocoaNibs/chapter_3_section_6.html#//apple_ref/doc/uid/10000051i-CH4-DontLinkElementID_12)

* * *

## 回答 #28

> 赞同：10
> 
> 时间：2009-10-18T18:12:12.827

打开所有 GCC 警告，然后关闭那些经常由 Apple 标头引起的警告以减少噪音。

还要经常运行 Clang 静态分析；您可以通过“运行静态分析器”构建设置为所有构建启用它。

编写单元测试并在每次构建时运行它们。

* * *

## 回答 #29

> 赞同：10
> 
> 时间：2011-10-19T02:58:56.530

**变量和属性**

1/ 保持标题干净，隐藏实现
不要在标题中包含实例变量。私有变量作为属性放入类延续中。公共变量在您的标头中声明为公共属性。如果它应该是只读的，则将其声明为只读并在类延续中将其覆盖为读写。基本上我根本不使用变量，只使用属性。

2/ 给你的属性一个非默认的变量名，例如：

```
 @synthesize property = property_; 
```

原因1：你会发现忘记“自我”导致的错误。分配财产时。原因 2：根据我的实验，Instruments 中的 Leak Analyzer 在使用默认名称检测泄漏属性时存在问题。

3/ 永远不要直接在属性上使用保留或释放（或仅在非常特殊的情况下）。在您的 dealloc 中，只需为它们分配零。保留属性旨在自行处理保留/释放。例如，您永远不知道 setter 是否不是添加或删除观察者。您应该只在其 setter 和 getter 内直接使用该变量。

**意见**

1/ 如果可以的话，将每个视图定义放入 xib 中（通常是动态内容和图层设置例外）。它节省了时间（它比编写代码更容易），很容易改变并且保持你的代码干净。

2/ 不要试图通过减少视图数量来优化视图。不要仅仅因为您想在其中添加子视图而在代码中创建 UIImageView 而不是 xib。改为使用 UIImageView 作为背景。视图框架可以毫无问题地处理数百个视图。

3/ IBOutlets 不必总是保留（或强）。请注意，您的大多数 IBOutlets 都是您的视图层次结构的一部分，因此被隐式保留。

4/ 释放 viewDidUnload 中的所有 IBOutlets

5/ 从你的 dealloc 方法调用 viewDidUnload。它没有被隐式调用。

**记忆**

1/ 创建对象时自动释放对象。许多错误是由于将您的发布调用移动到一个 if-else 分支或在 return 语句之后引起的。仅在特殊情况下才应使用释放而不是自动释放 - 例如，当您等待运行循环并且您不希望过早地自动释放对象时。

2/ 即使您使用的是 Authomatic Reference Counting，您也必须完全理解保留释放方法的工作原理。手动使用保留释放并不比 ARC 复杂，在这两种情况下，您都必须处理泄漏和保留周期。考虑在大型项目或复杂的对象层次结构上手动使用保留释放。

**评论**

1/ 使您的代码自动记录。每个变量名和方法名都应该说明它在做什么。如果代码编写正确（您需要大量练习），您将不需要任何代码注释（与文档注释不同）。算法可能很复杂，但代码应该总是简单的。

2/ 有时，您需要评论。通常用于描述不明显的代码行为或黑客行为。如果您觉得必须写注释，请先尝试将代码重写为更简单且不需要注释。

**缩进**

1/不要过多地增加缩进。大多数方法代码应该在方法级别缩进。嵌套块（if、for 等）会降低可读性。如果您有三个嵌套块，则应尝试将内部块放入单独的方法中。永远不要使用四个或更多的嵌套块。如果您的大部分方法代码都在 if 内，请否定 if 条件，例如：

```
 if (self) {
   //... long initialization code ...
}

return self; 
```

```
 if (!self) {
   return nil;
}

//... long initialization code ...

return self; 
```

**了解 C 代码，主要是 C 结构体**

请注意，Obj-C 只是 C 语言上的一个轻量级 OOP 层。您应该了解 C 中的基本代码结构是如何工作的（枚举、结构、数组、指针等）。例子：

```
 view.frame = CGRectMake(view.frame.origin.x, view.frame.origin.y, view.frame.size.width, view.frame.size.height + 20); 
```

是相同的：

```
 CGRect frame = view.frame;
frame.size.height += 20;
view.frame = frame; 
```

**还有很多**

维护您自己的编码标准文档并经常更新。尝试从你的错误中学习。了解为什么会创建错误并尝试使用编码标准来避免它。

我们的编码标准目前有大约 20 页，混合了 Java 编码标准、Google Obj-C/C++ 标准和我们自己添加的标准。记录您的代码，在正确的位置使用标准缩进、空格和空行等。

* * *

## 回答 #30

> 赞同：9
> 
> 时间：2011-03-29T17:51:33.770

更**实用**。

Objective-C 是面向对象的语言，但 Cocoa 框架具有函数式风格，并且在许多情况下是设计函数式风格的。

1.  存在可变性的分离。使用*不可变*类作为主要类，可变对象作为次要类。例如，主要使用 NSArray，仅在需要时使用 NSMutableArray。

2.  有纯函数。没那么多，买很多框架 API 都是像纯函数一样设计的。查看诸如`CGRectMake()`or之类的函数`CGAffineTransformMake()`。显然指针形式看起来更高效。然而，带有指针的间接参数不能提供无副作用。尽可能纯粹地设计结构。分离偶数状态对象。将值传递给其他对象时使用`-copy`而不是。`-retain`因为共享状态可以默默地影响其他对象中的值的变化。所以不可能没有副作用。如果您有来自对象的外部值，请复制它。因此，尽可能少地设计共享状态也很重要。

但是也不要害怕使用不纯的函数。

1.  有懒惰的评价。看到类似`-[UIViewController view]`财产的东西。创建对象时不会创建视图。它会在调用者`view`第一次读取属性时创建。`UIImage`在实际绘制之前不会加载。像这种设计有很多实现。这种设计对资源管理很有帮助，但如果不了解惰性求值的概念，就很难理解它们的行为。

2.  有关闭。尽可能使用 C 块。这将大大简化您的生活。但在使用它之前，请再次阅读有关块内存管理的内容。

3.  有半自动GC。NSAutoreleasePool。使用`-autorelease`初级。`-retain/-release`真正需要时使用手动辅助。（例如：内存优化、显式资源删除）

* * *

## 回答 #31

> 赞同：8
> 
> 时间：2009-05-20T22:46:02.090

我看到的 Apple 提供的示例将 App 委托视为全局数据存储，某种数据管理器。那是大错特错。创建一个单例并可能在 App 委托中实例化它，但不要将 App 委托用作应用程序级事件处理之外的任何东西。我衷心赞同[这篇博](http://cocoawithlove.com/2008/11/singletons-appdelegates-and-top-level.html)文中的建议。[这个线程](https://stackoverflow.com/questions/338734/iphone-proper-usage-of-application-delegate)提示了我。

* * *

## 回答 #32

> 赞同：4
> 
> 时间：2011-08-08T03:52:07.480

仅在*dealloc*方法中释放一个*属性。*如果要释放该*属性*所持有的内存，只需将其设置为 nil：

 **```
self.<property> = nil; 
```

* * *

## 回答 #33

> 赞同：0
> 
> 时间：2012-04-25T11:41:31.083

```
#import "MyClass.h"

@interface MyClass ()
- (void) someMethod;
- (void) someOtherMethod;
@end

@implementation MyClass 
```

# jquery - jQuery匹配多个属性

> ID：155977
> 
> 赞同：45
> 
> 时间：2008-10-01T02:21:07.650
> 
> 标签：jquery, html, jquery-selectors

我有以下标记，我想`All`选中单选按钮。

```
<ul>
    <li><input type="radio" value="All" name="Foo"/>All</li>
    <li><input type="radio" value="New" name="Foo"/>New</li>
    <li><input type="radio" value="Removed" name="Foo"/>Removed</li>
    <li><input type="radio" value="Updated" name="Foo"/>Updated</li>
</ul> 
```

我想通过属性匹配，但我需要匹配 2 个属性，`@name='Foo'`并且`@value='All'`.

像这样的东西：

```
$("input[@name='Foo' @value='all']").attr('checked','checked'); 
```

有人可以展示如何做到这一点吗？

* * *

## 回答 #1

> 赞同：69
> 
> 时间：2008-10-01T02:43:34.430

以下 HTML 文件显示了如何执行此操作：

```
<html>
  <head>
    <script type="text/javascript" src="jquery-1.2.6.pack.js"></script>
    <script type="text/javascript">
      $(document).ready(function(){
        $("a").click(function(event){
          $("input[name='Foo'][value='All']").attr('checked','checked');
          event.preventDefault();
        });
      });
    </script>
  </head>
  <body>
    <ul>
      <li><input type="radio"  value="All"  name="Foo"  />All</li>
      <li><input type="radio"  value="New"  name="Foo"  />New</li>
      <li><input type="radio"  value="Removed"  name="Foo"  />Removed</li>
      <li><input type="radio"  value="Updated"  name="Foo"  />Updated</li>
    </ul>
    <a href="" >Click here</a>
  </body>
</html> 
```

单击链接时，将选择所需的单选按钮。重要的一行是设置`checked`属性的那一行。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-04-21T08:31:43.613

我在与此类似的墙上敲打我的头，只是想指出在 jQuery 1.3 中，接受的答案中使用的语法是唯一可行的语法。提问者使用 @ 语法来表示在 jQuery 中根本不起作用的表达式。希望这可以帮助下一个人通过 Google =p 遇到这个问题

要清楚，你必须使用

```
jQuery('input[name=field1][val=checked]') 
```

并不是

```
jQuery('input[@name=field1][@val=checked]') 
```

# vb.net - VB.Net MessageBox.Show() 将我的表单移到后面

> ID：155996
> 
> 赞同：3
> 
> 时间：2008-10-01T02:30:15.147
> 
> 标签：vb.net, mdi, messagebox, mdichild

我有一个 MDI 应用程序。当我使用 MessageBox.Show() 显示消息框时，当我关闭消息框时，整个应用程序会消失在所有打开的窗口后面。

代码没有做任何特别的事情。事实上，这是从 MDI 子窗体中调用消息框的行：

```
MessageBox.Show(String.Format("{0} saved successfully.", Me.BusinessUnitTypeName), "Save Successful", MessageBoxButtons.OK, MessageBoxIcon.Information, MessageBoxDefaultButton.Button1, MessageBoxOptions.DefaultDesktopOnly) 
```

Me.BusinessUnitTypeName() 是一个只读属性 getter，它根据成员变量的值返回一个字符串。此属性没有副作用。

有任何想法吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-01T02:48:17.617

删除最后一个参数`MessageBoxOptions.DefaultDesktopOnly`.

来自[MSDN](http://msdn.microsoft.com/en-us/library/system.windows.forms.messageboxoptions(VS.80).aspx)：

> DefaultDesktopOnly 将导致引发 MessageBox 的应用程序失去焦点。显示的 MessageBox 不会使用视觉样式。有关详细信息，请参阅使用视觉样式呈现控件。

最后一个参数允许后台 Windows 服务通过 csrss.exe 与活动桌面通信！有关详细信息，请参阅 Bart de Smet 的[博客文章](http://bartdesmet.net/blogs/bart/archive/2004/12/03/488.aspx)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-01T02:48:09.940

删除该`MessageBoxOptions.DefaultDesktopOnly`参数，它将正常工作。

`DefaultDesktopOnly`指定“**消息框显示在活动桌面上**”导致焦点丢失。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2019-02-05T16:58:39.860

这些答案是正确的，但我想补充一点。我在使用别人的代码时遇到了这个问题。一个简单的消息框导致最前面的窗口移到后面：

MessageBox.Show("你好")。

原来，在 MessageBox 之前有一个 BindingSource.Endedit 命令。BindingSource 尚未连接到任何控件，但它导致窗口更改 z 位置。

我只包含此注释，因为我的搜索将我带到了这个问题，并且我认为它可能对其他人有帮助。

# vb.net - 如何在 vb.net 运行时将事件分配给计时器？

> ID：155998
> 
> 赞同：1
> 
> 时间：2008-10-01T02:30:30.153
> 
> 标签：vb.net

鉴于这种：

```
Public Sub timReminder_Tick(ByVal sender As System.Object, ByVal e As System.EventArgs)
    If DateTime.Now() > g_RemindTime Then
        Reminders.ShowDialog()
        timReminder.Enabled = False
    End If
End Sub 
```

我希望能够这样说（就像在 Delphi 中那样）：

```
timReminder.Tick = timReminder_Tick 
```

但是当我尝试它时会出错。

有谁知道我如何在 VB.NET 运行时将自定义事件分配给计时器的 on-tick 事件？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-01T02:34:16.150

使用“AddHandler”和“AddressOf”关键字将处理程序添加到 Tick 事件。

```
AddHandler timeReminder.Tick, AddressOf timeReminder_Tick

```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-10T01:01:06.647

`addHandler`是一个非常强大的工具。

尝试使用它将事件添加到集合中的一系列控件。

处理程序可以向所有类型的控件添加验证或错误检查，并且可以处理您添加到表单的任何内容。*******************