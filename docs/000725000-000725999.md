# StackOverflow 问答 000725000-000725999

# c# - 应用程序图标

> ID：725001
> 
> 赞同：2
> 
> 时间：2009-04-07T10:31:33.677
> 
> 标签：c#, winforms, winapi

我有 3 个图标。当我编译应用程序时，我使用第一个图标 - 主应用程序图标。
我在资源中还有 2 个其他图标。

当我显示 MessageBox.Show(...) 时，第一个应用程序图标出现在任务栏中。出于某种原因，我希望能够在运行时更改主图标。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-26T11:56:29.013

虽然这里已经提到了 P/Invoke -如果您不想编写自己的 MessageBox，有一篇关于更改图标的好文章[http://www.codeproject.com/KB/dialog/MessageBoxIndirectCS.aspx 。](http://www.codeproject.com/KB/dialog/MessageBoxIndirectCS.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-07T10:44:37.730

我不认为它是直截了当的，看看这篇[文章](http://www.eggheadcafe.com/articles/createiconsforsystemtray.asp)它可能会帮助你。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-25T11:49:13.250

您可以通过使用 P/Invoke 调用 Windows[`MessageBoxIndirect`](http://pinvoke.net/default.aspx/user32/MessageBoxIndirect.html)函数来更改消息框中显示的图标。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-04-04T19:54:44.230

```
System.Drawing .Icon ica= new Icon (Application.StartupPath + "\\" + "my_new_icon.ico");

 this.Icon = ica; //This is an Active Form 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-07T10:38:06.170

我不确定您是否可以更改标准 MessageBox 的图标。您可能必须制作自己的 MessageBox。然后它只是更改标准winform的图标。这已在 MSDN 和可通过 Google 找到的许多页面上广泛记录。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-07T19:42:14.833

我很确定标准 MessageBox.Show() 方法不能显示自定义图标（您可以在枚举中指定几个不同的图标，但不能在其中放置任意图标），但是如果您有一个普通的 .NET 表单，只需将“图标”属性设置为您想要的图像，它就可以工作。在运行时执行此操作时，可能需要在之前和之后进行正常的挂起/恢复布局调用，或者它们可能不需要，我不知道，但在表单上设置属性不应该是一件繁琐的工作。

# perl - 如何区分 Perl 中的 0 和空格？

> ID：725009
> 
> 赞同：6
> 
> 时间：2009-04-07T10:33:32.860
> 
> 标签：perl, whitespace

我的程序中有以下代码：

```
$val = chr(someFunction());

if($val == " ")
{
    #do something

}
elsif($val == 0)
{
   #do something else
} 
```

但是，只要将 0 传递给 $val，if 部分就会执行，而不是我希望执行的 elsif。

我怎样才能解决这个问题？

谢谢你。

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2009-04-07T10:35:53.820

运算符用于比较`==`数值。如果要比较字符串，则应使用`eq`运算符。

```
if ($val eq " ") ... 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-07T11:03:45.923

有几种方法可以解决这个问题（[TIMTOWDI](http://en.wikipedia.org/wiki/There_is_more_than_one_way_to_do_it)）。`looks_like_a_number`您可以从标准`Scalar::Util`包中导入函数：

```
if (looks_like_a_number($val) and $val == 0) {
    #do something
} 
```

您可以使用字符串相等运算符

```
if ($val eq 0) {
    #do something
} 
```

如果你有 Perl 5.10，你可以使用智能匹配运算符

```
if ($val ~~ 0) {
    #do something
} 
```

还有很多。您使用哪种方法在很大程度上取决于您要达到的目标。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-07T18:00:20.897

如果您启用了警告，您就会知道问题所在。

运行这个：

```
use strict;
use warnings;

my $val = chr(someFunction());

if($val == " ")
{
    #do something

}
elsif($val == 0)
{
   #do something else
}

sub someFunction {
    return 1;
} 
```

你得到： C:>test.pl 参数“”在 C:\test.pl 第 6 行的数字 eq (==) 中不是数字。参数“^A”在数字 eq (==) 中不是数字在 C:\test.pl 第 6 行。

添加使用诊断为我们提供了额外的解释：

```
 (W numeric) The indicated string was fed as an argument to an operator
   that expected a numeric value instead.  If you're fortunate the message
   will identify which operator was so unfortunate. 
```

所以，既然我们不想要数字 eq，我们想要字符串 eq: `eq`。如果您还不知道这一点，您可以查看`perldoc perlop`有关[Equality Operators](http://perldoc.perl.org/perlop.html#Equality-Operators)的信息。

这是一个典型的例子，说明使用`warnings`and `strict`pragma 如何节省时间。

# unit-testing - 单元测试：TypeMocking 单例

> ID：725010
> 
> 赞同：1
> 
> 时间：2009-04-07T10:33:49.723
> 
> 标签：unit-testing, mocking, typemock

我正在使用 TypeMock Isoler 为一些单元测试模拟一些对象 - 尝试使用 AAA api（因此 Isolate 调用）。

我有一个简单的单例类，您可以在其中调用静态 GetInstance()，然后返回该类的一个实例。我认为这将是一个简单的模拟问题，但我遇到了一个非常令人沮丧的问题！我似乎无法让 GetInstance() 使用我预期的调用集正确返回我的模拟对象。

我试过了：

*   使用 MST 项目（使用 Accessor 类）将模拟对象直接分配给实例变量（使用 Memers.MustSpecifyReturnValues 伪造对象，并使用 WithExactArguments 设置期望值 Isolate.WhenCalled），但由于某种原因，模拟对象*总是*返回 null（并且没有例外）。
*   模拟 Singleton.GetInstance() 以返回模拟对象。这将返回一个需要设置 WhenCalled 的模拟对象，但现在我进行的 Isolate.WhenCalled 调用似乎对假对象没有执行任何操作 - 所以所有调用都会引发意外调用异常。
*   我还尝试模拟实际的方法调用（例如 Singleton.GetInstance().Test()），这将适用于对该方法的调用，但是对单例上其他方法的所有其他调用都返回 null 而不是抛出异常正如我想要的那样（因为这似乎会自动模拟所有没有 Members.MustSpecifyReturnValues 的对象）。

我想要的只是模拟一个单例，并且我没有明确告诉它期望抛出异常的任何调用。我以为这很简单，但显然不是！伤心

有谁知道我做错了什么？

谢谢詹姆斯

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-07T10:47:55.413

我认为简单的解决方案是创建单例类的假实例并在调用实际类构造函数之前使用 SwapNextInstace ：

```
[TestMethod]
public void SetBhaciorOnSingleton()
{
   var fake = Isolate.Fake.Instance<SingletonClass>();

   Isolate.WhenCalled(() => fake.SomeFunction()).WillReturn(10);
   // Set additional behavior on singleton class

   Isolate.Swap.NextInstance<SingletonClass>().With(fake);

   // This is where the class constructor is being called
   var result = SingletonClass.GetInstace().SomeFunction();
   Assert.AreEqual(10, result );
} 
```

除非在测试之前创建单例类，否则此解决方案应适用于大多数情况。如果您需要在创建类后设置行为，只需使用WhenCalled：

```
[TestMethod]
public void SetBhaciorOnSingleton()
{
    var fake = Isolate.Fake.Instance<SingletonClass>();

    Isolate.WhenCalled(() => fake.SomeFunction()).WillReturn(10);

    Isolate.WhenCalled(() => SingletonClass.GetInstace()).WillReturn(fake);

    var result = SingletonClass.GetInstace().SomeFunction();
    Assert.AreEqual(10, result );
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2016-02-16T10:49:32.977

免责声明我在 Typemock 工作。

您不需要模拟 Singleton.GetInstance<>()。使用 Isolate.Fake.AllInstances<>() 而不是 Isolate.Fake.Instance<>() 您可以模拟单例。然后通过设置应用于所有实例的假单例行为的行为。

看一下这个例子：

```
public class Singleton
    {
        private Singleton() { }
        static readonly Singleton instance = new Singleton();

        public static Singleton Instance { get {  return instance; } }

        public int ReturnZero()
        {
            return 0;
        }
    }

    [TestMethod]
    public void FakeSingleton()
    {
        // Here we are setting the same behavior on all instances.
        // The behavior we set on fake will apply to past instance as well
        var fakeSingleton = Isolate.Fake.AllInstances<Singleton>();
        Isolate.WhenCalled(() => fakeSingleton.ReturnZero()).WillReturn(10);

        // Assert that the behavior works.
        Assert.AreEqual(10, Singleton.Instance.ReturnZero());
    } 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-07T16:55:14.347

谢谢。

我之前没有尝试过 NextInstance，因为它不适用于我不想更改的接口。

但是，我已经尝试过了，它确实有效 - 虽然我假设设置 WhenCalled(s) 的顺序并不重要，但它肯定是。例如，如果我在 Swap 之后执行 WhenCalled，它就不起作用。它需要在交换之前进行。（老实说，这对我来说真的没有意义——它应该是同一个对象）。

但是，最后一个示例（我尝试过的方法之一）对我不起作用。我伪造，对伪造设置期望，然后对单例设置期望以返回伪造的实例 - 但现在它返回具体实例！

它可能与调用构造函数的方式有关吗？我记得看到过一些关于那个的...

或者，我可以使用 Swap，但是，我希望能够在 TestSetup 中设置所有这些东西，并对实际测试中的期望进行微小的修改，但这看起来是不可能的。?

* * *

## 回答 #4

> 赞同：-2
> 
> 时间：2009-04-07T10:41:18.347

最好的解决方案是不使用单例（或任何其他静态可变数据）。只需创建一个实例并使用依赖注入将其传递给所有需要它的对象。

*   [http://butunclebob.com/ArticleS.UncleBob.SingletonVsJustCreateOne](http://butunclebob.com/ArticleS.UncleBob.SingletonVsJustCreateOne)
*   [http://www.youtube.com/watch?v=-FRm3VPhseI](http://www.youtube.com/watch?v=-FRm3VPhseI)

# project-management - SCRUM - 适当的非开发资源水平？

> ID：725023
> 
> 赞同：4
> 
> 时间：2009-04-07T10:37:44.627
> 
> 标签：project-management, scrum

我们正在尝试为一个开发在线应用程序的小型开发团队（三个半开发人员）运行 SCRUM，但我们无法从非开发资源（例如产品所有者、用户测试等）那里获得时间。

我正在研究一个商业案例，以获取更多非开发资源，并使其更能响应我们对他们参与的要求。

现在的情况：

*   产品负责人是一个5人的团队，其中一半是从开发团队跨大西洋而来（这比之前完全没有负责人的情况要好）
*   产品负责人“团队”几乎每月只开两次会
*   没有专门的用户测试或 QA 资源
*   完成用户测试的最快时间是 3 周，大约需要 2 个工作日的测试
*   我们正在努力实现每月冲刺

具体问题：

*   产品负责人（如果他们是一个人）每周应该花多少时间在他们的产品负责人角色上？
*   您是否希望产品负责人“每天一整天”都可用？
*   您希望每月有多少专用测试/QA 资源可用？

我试过用谷歌搜索“权威”答案，或者只是关于团队资源水平的任何报告，但没有找到任何东西。

有谁知道这样的事情，所以我的商业案例不仅仅是“我认为......”，而是可以参考专家意见和现实世界的统计数据？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-07T12:26:15.850

> 产品负责人（如果他们是一个人）每周应该花多少时间在他们的产品负责人角色上？

根据我在一个由 15 名 DEV+QA 和一名产品负责人组成的团队的经验，我会说平均每周大约一天应该没问题。我还强烈建议遵循代理产品所有者方法，或者创建一个**需求架构师**（谷歌 Dean Leffingwell 需求架构师）。这实际上是我们所做的，因为我们的产品负责人没有足够的时间在项目上花费时间。

> 您是否希望产品负责人“每天一整天”都可用？

当然这是理想的。如果有一个位于同一位置的代理，它也会有所帮助。如果没有这个，我强烈建议设置一个时间 SLA，以通过 EMAIL 回答与当前+下一个 sprint 相关的问题。例如在工作日结束时返回或其他。

> 您希望每月有多少专用测试/QA 资源可用？

如上所述，这取决于项目的类型和团队中开发人员 / BA 的数量。我建议在 BA 和测试人员之间至少建立 1:1 的关系，因为所需的 QA 数量是指定需求数量的强大函数。由于您在谈论在线应用程序，我假设没有很长的回归/集成周期，因此与开发人员 1:3 的关系就足够了。我认为测试人员对需求和可用性有重要影响，而不仅仅是错误修复。另一个因素是您是否打算采用敏捷工程实践，例如 TDD、单元测试、持续集成等。如果是这样，测试资源将更加关注测试定义、可用性、性能/负载测试，而不是回归。

查看瓶颈的一种方法是采用某种可视化工作流程的看板。在该板上，您可以看到瓶颈在哪里。无论是在采购订单、开发还是测试中。如果您正在使用具有常规任务板图表的单个 scrum 团队，您可以通过添加“测试中”和“规范中”列轻松获取此信息（因此总体而言，您有 - 待定 -> 规范中 -> 在 DEV进度 -> 测试中 -> 待定采购订单批准 -> 完成）。如果您发现有太多便笺卡在某个列/阶段，那么您知道在哪里寻找问题。向您的管理层展示这一点，它的经验性和比其他项目中看到的任何信息/经验法则要好得多，或者至少是一个很好的补充......

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-07T11:12:54.607

我怀疑您会为这些问题找到任何权威答案，因为它们几乎完全取决于特定情况。

关于你的问题：

以我的经验，产品负责人可能会全职参与一个项目，每隔几个月召开一次简短的会议。

对于您的项目类型，根据您提供的详细信息，我不希望产品负责人每天整天都在场，更有可能他们每周左右参加一两次会议。（1 小时会议。）

测试的数量取决于项目在哪里，在它的生命周期中，但是这可能由其他开发人员、BA、项目经理和用户完成，因此这取决于您公司的流程。
对于您的规模团队，我会说 1 个全职 QA 资源可能有用。（取决于你的开发人员有多好。）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-07T11:38:15.887

您不能拥有一个团队项目的所有者，因为您发现它根本行不通。你有几个选择，我最喜欢的是宣布独立——他们不想承担成为所有者的责任——你自己承担责任。你清楚地理解了问题，尝试控制，发送一些简明扼要的电子邮件，概述新结构 - 不要请求许可，只要这样做会让他们稍微动摇。

其他答案 - 您不会得到 24x7 的所有者，您必须围绕所有者的日程安排工作，但您可以要求提前知道该日程安排。

QA - 对于 3.5 名开发人员，我希望有 0.5 到 1 名 QA 人员，我希望在 0 到 1 之间，如果你找不到专门的测试人员，则更可能是 0。用户 - 你是新主人记住，建立早期 QA 用户的智囊团并颠覆组织。

顺便说一句 - 基于 20 个组织中的 50 多个项目的答案。

* * *

## 回答 #4

> 赞同：-2
> 
> 时间：2009-04-07T11:32:39.690

我是经过认证的 SCRUM 大师，以下是我对您的情况的分析：

注意事项：

*   SCRUM 不允许“半个开发人员”的场景，开发人员应该专注于手头的项目。
*   多个产品负责人是一个糟糕的情况。需要一个人对项目有清晰的愿景。您是否将客户视为产品所有者？
*   如果你正在调整 SCRUM，那么你不是在做 SCRUM 而是在做 SCRUM-BUT。

建议性答案：

> 产品负责人（如果他们是一个人）每周应该花多少时间在他们的产品负责人角色上？

您可以在团队中拥有一名代理产品负责人，负责推动产品开发并在原始产品负责人和团队之间建立适当的沟通桥梁。

理想情况下，产品负责人应该是一个敬业的人，但根据您的情况，一些可以决定要纳入此 sprint 的任务（业务分析明确的要求），并在您给定的时间内为下一个 sprint 的任务做准备的人就足够了。

> 您是否希望产品负责人“每天一整天”都可用？

不一定，但应该出席以通过任何沟通方式解释对任务的任何疑问。

> 您希望每月有多少专用测试/QA 资源可用？

贯穿整个冲刺。在 SCRUM 中，每个人都被称为“开发人员”，并且应该在整个 sprint 中都在场，这增加了知识共享并提高了团队的整体绩效。

高温高压

# javascript - 使用 Jquery 位置函数

> ID：725029
> 
> 赞同：1
> 
> 时间：2009-04-07T10:39:39.023
> 
> 标签：javascript, jquery, jquery-ui, jquery-plugins

我正在做一些基本上可以在线创建名片的事情。

我正在尝试用 CSS 布置`div`标签。然后我想获取标签相对于它们的容器`x`的`y`坐标，`div`以便可以将其传递给 PHP GD 库，以便制作图像。

我尝试`.position()`在 jquery 中使用该函数，但它给出了相对位置。

有没有人有任何可能有帮助的指示？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-07T10:53:42.187

查看[jQuery 尺寸插件](http://docs.jquery.com/Plugins/dimensions)以找到元素的正确位置。

**编辑：** 如评论中所述，维度插件已合并到核心中。可以在此处找到文档：[offset](http://docs.jquery.com/CSS/offset)和此处[position](http://docs.jquery.com/CSS/position)。

链接的示例可以像这样扩展：替换以下代码

```
var x = $("#Company_Name").position().left;
var y = $("#Company_Name").position().top;

$("p:last").text( "Full Name: left: " + x + ", top: " + y ); 
```

有了这个：

```
var $companyname = $("#Company_Name");
var x = $companyname.position().left;
var y = $companyname.position().top;
var ax = $companyname.offset().left;
var ay = $companyname.offset().top;

$("p:last").text( "Full Name: left: " + x + "/" + ax + ", top: " + y + "/" + ay); 
```

请注意，我只搜索了一次元素并将其填充到变量中。如果搜索需要一些时间，这是个好主意。

**EDIT2：** 我刚刚意识到，这并不像我预期的那样工作。我写了一些函数来计算相对位置：

```
function toString(obj){
        return "{top: " + obj.top + " left: " + obj.left + "}";
    }

    function getRelativePosition(selector){

        var $parentElem = $("#parentElem");
        var $element = $(selector);

        var elementPosition = $element.position();
        var parentPosition = $parentElem.position();

        return {top: elementPosition.top - parentPosition.top, 
            left: elementPosition.left - parentPosition.left};
    }

  $(document).ready(function(){

        var position = $("#Company_Name").position();
        var relativePosition = getRelativePosition("#Company_Name");

        $("p:last").text("position: " + toString(position) + " relativePosition: " + toString(relativePosition));
    }); 
```

让我知道这是否适合您。有人可能会告诉我 jQuery 中位置和偏移之间的区别：-\

**EDIT3：** 要获得多个元素的位置，您可以调用具有不同 ID 的函数，或者给它们全部相同的名称或相同的类，以便将它们全部选中。这是一个工作示例：

```
<html>
<head>
<script type="text/javascript" src="http://code.jquery.com/jquery-latest.js"></script>

<script type="text/javascript">

function toString(obj){
    return "{top: " + obj.top + " left: " + obj.left + "}";
}

function getRelativePosition(selector){

    var $parentElem = $("#parentElem");
    var $element = $(selector);

    var elementPosition = $element.position();
    var parentPosition = $parentElem.position();

    return {top: elementPosition.top - parentPosition.top, 
        left: elementPosition.left - parentPosition.left};
}

$(document).ready(function(){

$(".cardfield").each(function(i){

    var position = $(this).position();
    var relativePosition = getRelativePosition(this);

    $("p:last").append("element: " + this.id + " position: " + toString(position) + " relativePosition: " + toString(relativePosition) + "<br>");

});
});

</script>
</head>
<body>

<br><br><br><br><br>

<div id="parentElem" style="margin: 0px; top:10px; background-color: #ddd;">
<br><br>
<div class="cardfield" id="Company_Name1">Foo Bar</div>
<br>
<div class="cardfield" id="Company_Name2">Company Name</div>
<div class="cardfield" id="firstname" style="float: right;">Tim</div><br/>
<div class="cardfield" id="lastname" style="float: right;">B&uuml;the</div>
<br><br>
</div>

</p></p>
</body>
</html> 
```

注意：我为所有字段指定了“cardfield”类并使用 jQuery 来选择它们。然后我使用[each](http://docs.jquery.com/Each)函数来处理元素。在我给每个函数的内部，“this”指的是当前对象。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-11-30T11:17:04.740

绝对元素的完美位置

```
var position = window.jQuery(this).position();

var parent_pos = window.jQuery(this).parent().position();

var xpos = position.top - parent_pos.top;
var ypos = position.left - parent_pos.left; 
```

如果你完整的父 div 名称或 id 那么你可以写如下

```
var parent_pos = window.jQuery(this).parent('#cardcreate').position(); 
```

这非常适合它。

# iphone - 在 UIWebView 中处理 URL 重定向

> ID：725033
> 
> 赞同：7
> 
> 时间：2009-04-07T10:40:28.817
> 
> 标签：iphone, objective-c, uiwebview, uikit

我的应用程序中有一个`UIWebView`用于显示在我的应用程序中单击的链接的网页。

一些链接是 URL-Shortened 链接，例如 tinyURL 或 bit.ly。这些 URL 在初始 URL 加载后重定向。

我的问题是我的应用程序中的某些链接是指向非网页资源的 URL 缩短链接 - 例如视频或其他媒体。

我可以使用`webView:shouldStartLoadWithRequest:navigationType:`截取 URL 并决定如何处理它——只是它只在初始加载时调用，而不是在重定向之后调用。

我能做些什么来拦截 bit.ly 链接指向的 URL？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-04-07T10:46:30.457

看来我的过分热心并没有花时间实际检查使用`UIWebView`. `webView:shouldStartLoadWithRequest:navigationType:`确实捕获重定向。很抱歉浪费了任何人的时间；）

# c++ - 将 (void*) 转换为 std::vector

> ID：725040
> 
> 赞同：17
> 
> 时间：2009-04-07T10:43:18.780
> 
> 标签：c++, casting, binary, types

我有一个`(void*)`缓冲区，我需要先转换`std::vector<unsigned char>`它才能传递它。不幸的是，我的 C++ 铸造技能有点弱。有什么建议么？

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2009-04-07T10:47:56.927

您将需要缓冲区的长度。一旦你这样做，我们可以这样做：

```
unsigned char *charBuf = (unsigned char*)voidBuf;
/* create a vector by copying out the contents of charBuf */
std::vector<unsigned char> v(charBuf, charBuf + len); 
```

好的，评论让我开始了解我为什么不使用`reinterpret_cast`：

> *   在 C++ 中，C 风格的强制转换是一个方便的函数——它要求编译器在可用的强制转换运算符集上选择最安全和最便携的转换形式。
>     
>     
> *   它`reinterpret_cast`是实现定义的，并且应该始终是您心中的最后一件事（并且在您必须故意做不可移植的事情时使用）。
>     
>     
> *   ( 之间的转换`unsigned`不会改变类型)`char *`并且`void *`是可移植的(`static_cast`如果你真的很挑剔，你可以实际使用)。

C 风格转换的问题是：增加的灵活性可能会在指针类型更改时引起心痛。

**注意：**我同意尽可能不强制转换的一般惯例。但是，在没有提供任何来源的情况下，这是我能做的最好的事情。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-07T10:48:17.583

您不能简单地将 a 强制`void*`转换为 a，`std::vector<unsigned char>`因为后者的内存布局包括其他对象，例如当前分配的大小和字节数。

假设缓冲区由 指向`buf`且其长度为`n`：

```
vector<unsigned char> vuc(static_cast<char*>(buf), static_cast<char*>(buf) + n); 
```

将创建一个您可以安全使用的缓冲区*副本*。

**[编辑：添加`static_cast<char*>`，这是指针算术所必需的。]**

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-07T13:38:23.913

唯一合法的情况是您已经创建了一个向量，并且只是想将其取回。

```
void SomeFunc(void* input);

main() {
  std::vector< unsigned char > v;
  SomeFunc((void*) &v);
}

SomeFunc(void* input) {
  // Now, you could cast that void* into a vector
  std::vector< unsigned char >* v_ = (vector<unsigned char>*)input
} 
```

我实际上并没有尝试看看它是否会运行，但这就是它的精神。也就是说，如果您是从头开始制作的，那么您肯定做错了。这真的很糟糕。如果您被迫实施已经定义的“SomeFunc()”，这可能是唯一可以远程理解的。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-07T10:49:35.550

对已分配的缓冲区使用 std::vector 类不是解决方案。std::vector 对象管理内存并在销毁时释放它。

一个复杂的解决方案可能是编写自己的分配器，它使用已分配的缓冲区，但在几种情况下您必须非常小心，例如矢量调整大小等。

如果您通过某些 C API 函数绑定了 void* 缓冲区，那么您可以忘记转换为 std::vector。

如果您只需要该缓冲区的副本，则可以这样做：

```
std::vector< unsigned char> cpy( 
    (unsigned char*)buffer, (unsigned char*)buffer + bufferSize); 
```

其中 bufferSize 是复制缓冲区的字符大小。

# sql - 像 int 一样选择和过滤 nvarchar

> ID：725042
> 
> 赞同：2
> 
> 时间：2009-04-07T10:43:26.347
> 
> 标签：sql, sql-server, tsql

我的 MS SQL 2005 数据库的表 McTable 中有一个 nvarchar 列 BigMacs，其中包含字母数字和数值。例如：

*   132
*   第432章
*   sfs54543
*   5256

现在我想做这样的事情：

```
select Convert(BigMacs, int) from McTable
where IsNumerc(BigMacs) = 1 AND Convert(BigMacs, int) > 6 
```

但是当我这样做时，我得到一个错误：

> Msg 245, Level 16, State 1, Line 41 转换 nvarchar 值时转换失败 ' ***。***' 到数据类型 int。

在线选择。

如何解决这个问题？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-07T10:50:51.273

试试这个：

```
SELECT  *
FROM    (
        SELECT  REPLACE(BigMacs, ',', '.') AS BigMacs
        FROM    McTable m
        WHERE   IsNumerc(BigMacs) = 1
        ) q
WHERE   CAST(BigMacs AS DECIMAL) > 6 
```

`IsNumeric`将返回`TRUE`小数，如`1234.1232`，但不能转换为`INT`.

检查：

```
WITH McTable AS
        (
        SELECT '123124,123123' AS BigMacs
        )
SELECT  *
FROM    (
        SELECT  REPLACE(BigMacs, ',', '.') AS BigMacs
        FROM    McTable
        WHERE   IsNumeric(BigMacs) = 1
        ) q
WHERE   CAST(BigMacs AS DECIMAL) > 6

-----------
123124.123123 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-07T11:07:19.393

这可能是因为 IsNumeric 函数对于任何可以转换为数字的值都返回 true。试试下面的例子：

```
create table McTable  (BigMac varchar(255))

insert into McTable  select '1p927'
insert into McTable  select '1927'
insert into McTable  select '1,927'
insert into McTable  select '1.927'

select BigMac, isnumeric(BigMac)
from McTable 

select BigMac, CAST(BigMac AS DECIMAL)
from McTable 
where isnumeric(BigMac) = 1 
```

即使除 '1p927' 之外的所有行都是数字的，强制转换也会失败！这是因为 '1,927' 不能转换为十进制（在我的机器上）

IsNumeric 不能完全按照指定的方式工作。如发现[here](http://www.sqlhacks.com/index.php/Retrieve/Isnumeric-problems)，您可以使用

```
IsNumeric (data + 'e0') 
```

-江户

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-07T14:55:20.593

有很多方法可以做到这一点。这两个工作相同。在这种情况下最好不要使用替换，因为要替换的未知数太多。最好过滤掉所有不是你想要的东西。

```
SELECT
    CONVERT(INT,BigMacs) AS BigMacs
FROM
    McTable
WHERE
    ISNUMERIC(BigMacs) = 1
AND PATINDEX('%[^0-9]%', BigMacs) = 0

SELECT
    CONVERT(INT,BigMacs) AS BigMacs
FROM
    McTable
WHERE
    ISNUMERIC(BigMacs) = 1
AND BigMacs NOT LIKE ('%[^0-9]%') 
```

注意：如果人们正确拼写 ISNUMERIC()，它会有所帮助。如果您在 CONVERT() 上使用正确的语法顺序，它也会有所帮助

# c# - 根据数据库查找表中的值自动创建枚举？

> ID：725043
> 
> 赞同：127
> 
> 时间：2009-04-07T10:43:43.943
> 
> 标签：c#, database, dynamic, enums

如何根据数据库查找表中的值（使用企业库数据层）自动创建枚举并随后在 C# 中使用其值？

例如，如果我在数据库中添加一个新的查找值，我不想在代码中手动添加额外的静态枚举值声明——我想保持枚举与数据库同步。

有这样的事情吗？

* * *

我不想创建代码生成的静态枚举（[根据代码项目](http://en.wikipedia.org/wiki/The_Code_Project)文章*[枚举代码生成器 - 从数据库查找表中自动生成枚举代码](http://www.codeproject.com/KB/database/EnumGenerator.aspx)*）并且希望它是完全自动的。

* * *

## 回答 #1

> 赞同：101
> 
> 时间：2009-04-27T05:28:06.910

我正在做这件事，但是您*需要*进行某种代码生成才能使其正常工作。

在我的解决方案中，我添加了一个项目“EnumeratedTypes”。这是一个控制台应用程序，它从数据库中获取所有值并从中构造枚举。然后它将所有枚举保存到程序集中。

枚举生成代码是这样的：

```
// Get the current application domain for the current thread
AppDomain currentDomain = AppDomain.CurrentDomain;

// Create a dynamic assembly in the current application domain,
// and allow it to be executed and saved to disk.
AssemblyName name = new AssemblyName("MyEnums");
AssemblyBuilder assemblyBuilder = currentDomain.DefineDynamicAssembly(name,
                                      AssemblyBuilderAccess.RunAndSave);

// Define a dynamic module in "MyEnums" assembly.
// For a single-module assembly, the module has the same name as the assembly.
ModuleBuilder moduleBuilder = assemblyBuilder.DefineDynamicModule(name.Name,
                                  name.Name + ".dll");

// Define a public enumeration with the name "MyEnum" and an underlying type of Integer.
EnumBuilder myEnum = moduleBuilder.DefineEnum("EnumeratedTypes.MyEnum",
                         TypeAttributes.Public, typeof(int));

// Get data from database
MyDataAdapter someAdapter = new MyDataAdapter();
MyDataSet.MyDataTable myData = myDataAdapter.GetMyData();

foreach (MyDataSet.MyDataRow row in myData.Rows)
{
    myEnum.DefineLiteral(row.Name, row.Key);
}

// Create the enum
myEnum.CreateType();

// Finally, save the assembly
assemblyBuilder.Save(name.Name + ".dll"); 
```

我在解决方案中的其他项目引用了这个生成的程序集。因此，我可以在代码中使用动态枚举，并完成智能感知。

然后，我添加了一个构建后事件，以便在构建此“EnumeratedTypes”项目后，它会自行运行并生成“MyEnums.dll”文件。

顺便说一句，它有助于更​​改项目的*构建顺序*，以便首先构建“EnumeratedTypes”。否则，一旦您开始使用动态生成的 .dll，如果 .dll 被删除，您将无法进行构建。（鸡和蛋的问题——解决方案中的其他项目需要此 .dll 才能正确构建，并且在构建解决方案之前无法创建 .dll ......）

我从[这篇 msdn 文章](http://msdn.microsoft.com/en-us/library/system.reflection.emit.enumbuilder.aspx)中获得了上述大部分代码。

希望这可以帮助！

* * *

## 回答 #2

> 赞同：54
> 
> 时间：2009-04-07T10:53:38.473

枚举必须在编译时指定，你不能在运行时动态添加枚举 - 为什么你会在代码中没有使用/引用它们？

来自专业 C# 2008：

> C# 中枚举的真正强大之处在于，它们在幕后被实例化为派生自基类 System.Enum 的结构。这意味着可以针对它们调用方法来执行一些有用的任务。请注意，由于 .NET Framework 的实现方式，将语法上的枚举视为结构不会造成性能损失。实际上，一旦您的代码被编译，枚举将作为原始类型存在，就像 int 和 float 一样。

因此，我不确定您是否可以按照自己的方式使用 Enums。

* * *

## 回答 #3

> 赞同：21
> 
> 时间：2009-04-07T10:47:05.620

它必须是一个实际的枚举吗？改用 a 怎么样`Dictionary<string,int>`？

例如

```
Dictionary<string, int> MyEnum = new Dictionary(){{"One", 1}, {"Two", 2}};
Console.WriteLine(MyEnum["One"]); 
```

* * *

## 回答 #4

> 赞同：15
> 
> 时间：2012-07-17T18:58:48.220

我已经使用[T4](http://en.wikipedia.org/wiki/Text_Template_Transformation_Toolkit)模板完成了此操作。将 .tt 文件拖放到项目中并设置 Visual Studio 以运行 T4 模板作为预构建步骤是相当简单的。

T4 生成一个 .cs 文件，这意味着您可以让它只查询数据库并根据结果在 .cs 文件中构建一个枚举。作为预构建任务连接起来，它将在每次构建时重新创建您的枚举，或者您可以根据需要手动运行 T4。

* * *

## 回答 #5

> 赞同：13
> 
> 时间：2009-04-07T13:03:49.613

假设您的数据库中有以下内容：

```
table enums
-----------------
| id | name     |
-----------------
| 0  | MyEnum   |
| 1  | YourEnum |
-----------------

table enum_values
----------------------------------
| id | enums_id | value | key    |
----------------------------------
| 0  | 0        | 0     | Apple  |
| 1  | 0        | 1     | Banana |
| 2  | 0        | 2     | Pear   |
| 3  | 0        | 3     | Cherry |
| 4  | 1        | 0     | Red    |
| 5  | 1        | 1     | Green  |
| 6  | 1        | 2     | Yellow |
---------------------------------- 
```

构造一个选择以获取您需要的值：

```
select * from enums e inner join enum_values ev on ev.enums_id=e.id where e.id=0 
```

构建枚举的源代码，你会得到类似的东西：

```
String enumSourceCode = "enum " + enumName + "{" + enumKey1 + "=" enumValue1 + "," + enumKey2 + ... + "}"; 
```

（显然这是在某种循环中构造的。）

然后是有趣的部分，编译你的枚举并使用它：

```
CodeDomProvider provider = CodeDomProvider.CreateProvider("CSharp");
CompilerParameters cs = new CompilerParameters();
cp.GenerateInMemory = True;

CompilerResult result = provider.CompileAssemblyFromSource(cp, enumSourceCode);

Type enumType = result.CompiledAssembly.GetType(enumName); 
```

现在您已编译并准备好使用该类型。
要获取存储在数据库中的枚举值，您可以使用：

```
[Enum].Parse(enumType, value); 
```

其中 value 可以是整数值（0、1 等）或枚举文本/键（Apple、Banana 等）

* * *

## 回答 #6

> 赞同：10
> 
> 时间：2009-05-20T13:20:56.520

只是用“现成的”代码和一些解释显示 Pandincus 的 [答案](https://stackoverflow.com/questions/725043/dynamic-enum-in-c/887853#887853)：这个例子你需要两个解决方案（我知道它也可以通过一个来完成；），让高级学生展示它......

所以这里是表的 DDL SQL：

```
USE [ocms_dev]
    GO

CREATE TABLE [dbo].[Role](
    [RoleId] [int] IDENTITY(1,1) NOT NULL,
    [RoleName] [varchar](50) NULL
) ON [PRIMARY] 
```

所以这里是生成 dll 的控制台程序：

```
using System;
using System.Collections.Generic;
using System.Text;
using System.Reflection;
using System.Reflection.Emit;
using System.Data.Common;
using System.Data;
using System.Data.SqlClient;

namespace DynamicEnums
{
    class EnumCreator
    {
        // after running for first time rename this method to Main1
        static void Main ()
        {
            string strAssemblyName = "MyEnums";
            bool flagFileExists = System.IO.File.Exists (
                   AppDomain.CurrentDomain.SetupInformation.ApplicationBase + 
                   strAssemblyName + ".dll"
            );

            // Get the current application domain for the current thread
            AppDomain currentDomain = AppDomain.CurrentDomain;

            // Create a dynamic assembly in the current application domain,
            // and allow it to be executed and saved to disk.
            AssemblyName name = new AssemblyName ( strAssemblyName );
            AssemblyBuilder assemblyBuilder = 
                    currentDomain.DefineDynamicAssembly ( name,
                            AssemblyBuilderAccess.RunAndSave );

            // Define a dynamic module in "MyEnums" assembly.
            // For a single-module assembly, the module has the same name as
            // the assembly.
            ModuleBuilder moduleBuilder = assemblyBuilder.DefineDynamicModule (
                    name.Name, name.Name + ".dll" );

            // Define a public enumeration with the name "MyEnum" and
            // an underlying type of Integer.
            EnumBuilder myEnum = moduleBuilder.DefineEnum (
                    "EnumeratedTypes.MyEnum",
                    TypeAttributes.Public,
                    typeof ( int )
            );

            #region GetTheDataFromTheDatabase
            DataTable tableData = new DataTable ( "enumSourceDataTable" );

            string connectionString = "Integrated Security=SSPI;Persist " +
                    "Security Info=False;Initial Catalog=ocms_dev;Data " +
                    "Source=ysg";

            using (SqlConnection connection = 
                    new SqlConnection ( connectionString ))
            {

                SqlCommand command = connection.CreateCommand ();
                command.CommandText = string.Format ( "SELECT [RoleId], " + 
                        "[RoleName] FROM [ocms_dev].[dbo].[Role]" );

                Console.WriteLine ( "command.CommandText is " + 
                        command.CommandText );

                connection.Open ();
                tableData.Load ( command.ExecuteReader ( 
                        CommandBehavior.CloseConnection
                ) );
            } //eof using

            foreach (DataRow dr in tableData.Rows)
            {
                myEnum.DefineLiteral ( dr[1].ToString (),
                        Convert.ToInt32 ( dr[0].ToString () ) );
            }
            #endregion GetTheDataFromTheDatabase

            // Create the enum
            myEnum.CreateType ();

            // Finally, save the assembly
            assemblyBuilder.Save ( name.Name + ".dll" );
        } //eof Main 
    } //eof Program
} //eof namespace 
```

这是打印输出的控制台编程（记住它必须引用 dll）。让高年级学生展示将所有内容与动态加载结合在一起的解决方案，并检查是否已经构建了 dll。

```
// add the reference to the newly generated dll
use MyEnums ; 

class Program
{
    static void Main ()
    {
        Array values = Enum.GetValues ( typeof ( EnumeratedTypes.MyEnum ) );

        foreach (EnumeratedTypes.MyEnum val in values)
        {
            Console.WriteLine ( String.Format ( "{0}: {1}",
                    Enum.GetName ( typeof ( EnumeratedTypes.MyEnum ), val ),
                    val ) );
        }

        Console.WriteLine ( "Hit enter to exit " );
        Console.ReadLine ();
    } //eof Main 
} //eof Program 
```

* * *

## 回答 #7

> 赞同：8
> 
> 时间：2018-04-18T13:43:46.693

我们不是从错误的方向来的吗？

如果数据在部署版本的生命周期内可能发生变化，那么枚举是不合适的，您需要使用字典、散列或其他动态集合。

如果您知道一组可能的值在已部署版本的生命周期内是固定的，那么最好使用枚举。

如果您的数据库中*必须*有一些东西可以复制枚举集，那么为什么不添加一个部署步骤来清除并使用最终的枚举值集重新填充数据库表呢？

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2015-02-12T08:09:50.520

我总是喜欢编写自己的“自定义枚举”。比我有一个更复杂的类，但我可以重用它：

```
public abstract class CustomEnum
{
    private readonly string _name;
    private readonly object _id;

    protected CustomEnum( string name, object id )
    {
        _name = name;
        _id = id;
    }

    public string Name
    {
        get { return _name; }
    }

    public object Id
    {
        get { return _id; }
    }

    public override string ToString()
    {
        return _name;
    }
}

public abstract class CustomEnum<TEnumType, TIdType> : CustomEnum
    where TEnumType : CustomEnum<TEnumType, TIdType>
{
    protected CustomEnum( string name, TIdType id )
        : base( name, id )
    { }

    public new TIdType Id
    {
        get { return (TIdType)base.Id; }
    }

    public static TEnumType FromName( string name )
    {
        try
        {
            return FromDelegate( entry => entry.Name.Equals( name ) );
        }
        catch (ArgumentException ae)
        {
            throw new ArgumentException( "Illegal name for custom enum '" + typeof( TEnumType ).Name + "'", ae );
        }
    }

    public static TEnumType FromId( TIdType id )
    {
        try
        {
            return FromDelegate( entry => entry.Id.Equals( id ) );
        }
        catch (ArgumentException ae)
        {
            throw new ArgumentException( "Illegal id for custom enum '" + typeof( TEnumType ).Name + "'", ae );
        }
    }

    public static IEnumerable<TEnumType> GetAll()
    {
        var elements = new Collection<TEnumType>();
        var infoArray = typeof( TEnumType ).GetFields( BindingFlags.Public | BindingFlags.Static );

        foreach (var info in infoArray)
        {
            var type = info.GetValue( null ) as TEnumType;
            elements.Add( type );
        }

        return elements;
    }

    protected static TEnumType FromDelegate( Predicate<TEnumType> predicate )
    {
        if(predicate == null)
            throw new ArgumentNullException( "predicate" );

        foreach (var entry in GetAll())
        {
            if (predicate( entry ))
                return entry;
        }

        throw new ArgumentException( "Element not found while using predicate" );
    }
} 
```

现在我只需要创建我想使用的枚举：

```
 public sealed class SampleEnum : CustomEnum<SampleEnum, int>
    {
        public static readonly SampleEnum Element1 = new SampleEnum( "Element1", 1, "foo" );
        public static readonly SampleEnum Element2 = new SampleEnum( "Element2", 2, "bar" );

        private SampleEnum( string name, int id, string additionalText )
            : base( name, id )
        {
            AdditionalText = additionalText;
        }

        public string AdditionalText { get; private set; }
    } 
```

最后我可以随心所欲地使用它：

```
 static void Main( string[] args )
        {
            foreach (var element in SampleEnum.GetAll())
            {
                Console.WriteLine( "{0}: {1}", element, element.AdditionalText );
                Console.WriteLine( "Is 'Element2': {0}", element == SampleEnum.Element2 );
                Console.WriteLine();
            }

            Console.ReadKey();
        } 
```

我的输出是：

```
Element1: foo
Is 'Element2': False

Element2: bar
Is 'Element2': True 
```

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-04-07T11:00:11.377

**你想要 System.Web.Compilation.BuildProvider**

我也怀疑这样做是否明智，但也许有一个我想不出的好用例。

您正在寻找的是[构建提供程序](http://msdn.microsoft.com/en-us/library/system.web.compilation.buildprovider.aspx)，即 System.Web.Compilation.BuildProvider

[SubSonic](http://subsonicproject.com/)**非常**有效地使用它们，您可以下载源代码并查看它们如何使用它们，您不需要像他们正在做的那样复杂的任何东西。

希望这可以帮助。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-10-12T15:28:03.537

无论哪种方式，使用动态枚举都是不好的。您将不得不经历“复制”数据的麻烦，以确保将来易于维护的清晰易懂的代码。

如果您开始引入自动生成的库，那么您肯定会给未来的开发人员带来更多的困惑，他们不得不升级您的代码，而不是简单地将您的枚举编码在适当的类对象中。

给出的其他示例听起来不错且令人兴奋，但请考虑代码维护的开销与您从中获得的收益。另外，这些值会经常改变吗？

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-09-10T12:30:27.253

我不认为有做你想做的事的好方法。如果你仔细想想，我认为这不是你真正想要的。

如果您有一个动态枚举，这也意味着您必须在引用它时为其提供动态值。也许通过很多魔法，您可以实现某种[IntelliSense](http://en.wikipedia.org/wiki/IntelliSense)来处理这个问题并在 DLL 文件中为您生成一个枚举。但是考虑一下它所花费的工作量，访问数据库以获取 IntelliSense 信息的效率以及控制生成的 DLL 文件的版本的噩梦。

如果您真的不想手动添加枚举值（无论如何您都必须将它们添加到数据库中），请改用代码生成工具，例如[T4](http://en.wikipedia.org/wiki/Text_Template_Transformation_Toolkit)模板。右键单击+运行，您就可以在代码中静态定义枚举，并获得使用枚举的所有好处。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2017-07-20T14:16:45.643

保留枚举并同时创建动态值列表的一种方法是将您当前拥有的枚举与动态创建的字典一起使用。

由于大多数枚举是在定义它们要使用的上下文中使用的，并且“动态枚举”将由动态进程支持，因此您可以区分 2.

第一步是创建一个表/集合，其中包含动态条目的 ID 和引用。在表中，您将自动增量远大于您的最大枚举值。

现在是动态枚举的部分，我假设您将使用枚举创建一组应用一组规则的条件，其中一些是动态生成的。

```
Get integer from database
If Integer is in Enum -> create Enum -> then run Enum parts
If Integer is not a Enum -> create Dictionary from Table -> then run Dictionary parts. 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2018-07-08T04:24:46.270

枚举生成器类

```
public class XEnum
{
    private EnumBuilder enumBuilder;
    private int index;
    private AssemblyBuilder _ab;
    private AssemblyName _name;
    public XEnum(string enumname)
    {
        AppDomain currentDomain = AppDomain.CurrentDomain;
        _name = new AssemblyName("MyAssembly");
        _ab = currentDomain.DefineDynamicAssembly(
            _name, AssemblyBuilderAccess.RunAndSave);

        ModuleBuilder mb = _ab.DefineDynamicModule("MyModule");

        enumBuilder = mb.DefineEnum(enumname, TypeAttributes.Public, typeof(int));

    }
    /// <summary>
    /// adding one string to enum
    /// </summary>
    /// <param name="s"></param>
    /// <returns></returns>
    public FieldBuilder add(string s)
    {
        FieldBuilder f = enumBuilder.DefineLiteral(s, index);
        index++;
        return f;
    }
    /// <summary>
    /// adding array to enum
    /// </summary>
    /// <param name="s"></param>
    public void addRange(string[] s)
    {
        for (int i = 0; i < s.Length; i++)
        {
            enumBuilder.DefineLiteral(s[i], i);
        }
    }
    /// <summary>
    /// getting index 0
    /// </summary>
    /// <returns></returns>
    public object getEnum()
    {
        Type finished = enumBuilder.CreateType();
        _ab.Save(_name.Name + ".dll");
        Object o1 = Enum.Parse(finished, "0");
        return o1;
    }
    /// <summary>
    /// getting with index
    /// </summary>
    /// <param name="i"></param>
    /// <returns></returns>
    public object getEnum(int i)
    {
        Type finished = enumBuilder.CreateType();
        _ab.Save(_name.Name + ".dll");
        Object o1 = Enum.Parse(finished, i.ToString());
        return o1;
    }
} 
```

创建一个对象

```
string[] types = { "String", "Boolean", "Int32", "Enum", "Point", "Thickness", "long", "float" };
XEnum xe = new XEnum("Enum");
        xe.addRange(types);
        return xe.getEnum(); 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2020-10-04T01:28:51.843

说起来，我也厌倦了根据 Id / Name db 表列写出枚举，从 SSMS 中的查询中复制和粘贴内容。

下面是一个超级脏的存储过程，它将表名、要用于 c# 枚举名称的列名以及要用于 c# 枚举值的列名作为输入。

我使用的大多数这些表名 a) 以“s”结尾 b) 有一个 [TABLENAME]Id 列，c) 有一个 [TABLENAME]Name 列，因此有几个 if 语句将采用该结构，其中在这种情况下，列名参数不是必需的。

这些例子的一些背景 - 这里的“Stonk”并不是真正的“股票”，而是有点像我使用“stonk”的方式，它的意思是“在一段时间内有一些数字与之相关的东西”但那是不重要，它只是具有此 Id / Name 模式的表的示例。它看起来像这样：

```
CREATE TABLE StonkTypes (
    StonkTypeId TINYINT IDENTITY(1,1) PRIMARY KEY NOT NULL,
    StonkTypeName VARCHAR(200) NOT NULL CONSTRAINT UQ_StonkTypes_StonkTypeName UNIQUE (StonkTypeName)
) 
```

创建过程后，此语句：

`EXEC CreateCSharpEnum 'StonkTypes'`

选择此字符串：

```
public enum StonkTypes { Stonk = 1, Bond = 2, Index = 3, Fund = 4, Commodity = 5, 
PutCallRatio = 6, } 
```

我可以将其复制并粘贴到 C# 文件中。

我有一个 Stonks 表，它有 StonkId 和 StonkName 列，所以这个执行：

```
EXEC CreateCSharpEnum 'Stonks' 
```

吐出：

`public enum Stonks { SP500 = 1, DowJonesIndustrialAverage = 2, ..... }`

但是对于那个枚举，我想使用枚举名称值的“符号”列，所以这样：

```
EXEC CreateCSharpEnum 'Stonks', 'Symbol' 
```

诀窍和渲染：

`public enum Stonks { SPY = 1, DIA = 2, ..... }`

事不宜迟，这就是这个肮脏的疯狂。是的，很脏，但我对自己很满意——它是构建 SQL 代码的 SQL 代码，它构建了 C# 代码。涉及几层。

```
 CREATE OR ALTER PROCEDURE CreateCSharpEnum
@TableName VARCHAR(MAX),
@EnumNameColumnName VARCHAR(MAX) = NULL,
@EnumValueColumnName VARCHAR(MAX) = NULL
AS

DECLARE @LastCharOfTableName VARCHAR(1)
SELECT @LastCharOfTableName = RIGHT(@TableName, 1)

PRINT 'Last char = [' + @LastCharOfTableName + ']'

DECLARE @TableNameWithoutS VARCHAR(MAX)
IF UPPER(@LastCharOfTableName) = 'S'
    SET @TableNameWithoutS = LEFT(@TableName, LEN(@TableName) - 1)
ELSE
    SET @TableNameWithoutS = @TableName

PRINT 'Table name without trailing s = [' + @TableNameWithoutS + ']'

IF @EnumNameColumnName IS NULL
    BEGIN
        SET @EnumNameColumnName = @TableNameWithoutS + 'Name'
    END

PRINT 'name col name = [' + @EnumNameColumnName + ']'

IF @EnumValueColumnName IS NULL
    SET @EnumValueColumnName = @TableNameWithoutS + 'Id'

PRINT 'value col name = [' + @EnumValueColumnName + ']'

-- replace spaces and punctuation
SET @EnumNameColumnName  = 'REPLACE(' + @EnumNameColumnName + ', '' '', '''')'
SET @EnumNameColumnName  = 'REPLACE(' + @EnumNameColumnName + ', ''&'', '''')'
SET @EnumNameColumnName  = 'REPLACE(' + @EnumNameColumnName + ', ''.'', '''')'
SET @EnumNameColumnName  = 'REPLACE(' + @EnumNameColumnName + ', ''('', '''')'
SET @EnumNameColumnName  = 'REPLACE(' + @EnumNameColumnName + ', '')'', '''')'

PRINT 'name col name with replace sql = [' + @EnumNameColumnName + ']'

DECLARE @SqlStr VARCHAR(MAX) = 'SELECT ' + @EnumNameColumnName  
+ ' + '' = ''' 
+ ' + LTRIM(RTRIM(STR(' + @EnumValueColumnName + '))) + '','' FROM ' + @TableName + ' ORDER BY ' + @EnumValueColumnName

PRINT 'sql that gets rows for enum body = [' + @SqlStr + ']'

CREATE TABLE #EnumRowsTemp (s VARCHAR(MAX))

INSERT 
INTO #EnumRowsTemp
EXEC(@SqlStr)

--SELECT * FROM #EnumRowsTemp

DECLARE @csharpenumbody VARCHAR(MAX) 
SELECT @csharpenumbody = COALESCE(@csharpenumbody + ' ', '') + s FROM #EnumRowsTemp

--PRINT @csharpenumbody

DECLARE @csharpenum VARCHAR(MAX) = 'public enum ' + @TableName + ' { ' + @csharpenumbody + ' }'

PRINT @csharpenum

SELECT @csharpenum

DROP TABLE #EnumRowsTemp 
```

请保持批判性。我不明白的一件时髦的事情是，为什么我必须创建和删除这个#EnumRowsTemp 表，而不仅仅是“SELECT INTO #EnumRowsTemp”来动态创建临时表？我不知道答案，我试过了，但没有用。这可能是这段代码中最少的问题......

尽管它可能很脏......我希望这可以为你们中的一些笨蛋节省一点时间。

* * *

## 回答 #15

> 赞同：-1
> 
> 时间：2009-06-25T05:58:16.577

您可以使用 CodeSmith 生成如下内容：

[http://www.csharping.com/PermaLink,guid,cef1b637-7d37-4691-8e49-138cbf1d51e9.aspx](http://www.csharping.com/PermaLink,guid,cef1b637-7d37-4691-8e49-138cbf1d51e9.aspx)

# c++ - 为什么我的 CDatabase 对象不能理解我的数据源名称？

> ID：725046
> 
> 赞同：1
> 
> 时间：2009-04-07T10:44:05.830
> 
> 标签：c++, sql, sql-server, mfc, odbc

我正在使用 MFC 类 CDatabase。为了建立到 SQL Server 的连接，我使用连接字符串调用 OpenEx()。我的问题是该对象似乎无法解释字符串的 DSN 部分。连接字符串如下所示：

```
 ODBC;DSN=mySystemDSN;UID=myUsername;WSID=myMachineName;DATABASE=myDatabaseName;Trusted_Connection=Yes 
```

这应该是对的，因为我是通过使用 OpenEx(NULL)、手动选择数据源然后调用 GetConnect() 得到的。

但是这个字符串似乎没有包含足够的信息：OpenEx() 总是弹出一个对话框询问更多信息。我从这个对话中选择什么似乎并不重要——我可以选择一个与完全不同的数据库相关联的 DSN，并且事情仍然有效（在这种情况下调用 GetConnect() 表明它正在使用我的连接字符串，但 DSN 除外部分，这是从其他数据源借来的）。

我需要我的应用程序能够自动连接到数据库 - 对话框是一个交易破坏者。我尝试了具有类似结果的无 DSN 连接。这是怎么回事，我能做些什么呢？

*编辑回答 Neil Butterworth 的问题：*

我在 ODBC 数据源管理器中创建 DSN 时提供的信息如下：

驱动程序：SQL Server
名称：mySystemDSN
服务器：myMachineName
身份验证类型（可以是 Windows 或 SQL Server）：Windows
复选框“连接到 SQL Server 以获取附加配置选项的默认设置。”：勾选
复选框“将默认数据库更改为”：勾选并从下拉菜单中选择 myDatabaseName
复选框“使用 ANSI 引用的标识符”：勾选
复选框“使用 ANSI 空值、填充和警告”：勾选
复选框“执行字符数据翻译”：勾选

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-07T10:47:02.920

您似乎缺少密码和服务器的主机名。我想有趣的问题是您在对话框中输入了哪些信息来创建 DSN？

**编辑：**您可能还想看看[这个站点](http://www.connectionstrings.com/)，它有很多连接字符串示例。

**Edit2：**我会删除“ODBC；” 在字符串的开头。如果这不起作用，我会将 DSN 中的身份验证类型更改为 SQL 服务器并明确提供用户 ID 和密码，以检查身份验证是否不是问题。然后我可能会放弃:-)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-07T12:13:42.137

感谢 Neil Butterworth，我在[这里](http://www.connectionstrings.com/)找到了一个可行的答案：

“驱动程序={SQL Native Client}；服务器=myMachineName；数据库=myDatabaseName；Trusted_Connection=yes；”

我仍然对为什么在连接工作时调用 GetConnect() 不会产生完美的 DSN 字符串感到困惑，但现在我有了一个无 DSN 的解决方案，我并不在乎！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-07T11:31:12.907

一些选项：

*   是系统DSN还是用户DSN？也就是说，DSN 对执行用户可见吗？
*   尝试删除`UID=myUsername`
*   尝试`Driver=ODBC`代替`ODBC`

为什么您使用 DSN 而不是更传统的自包含连接字符串？如`Driver=SQLOLEBD;WSID=myMachineName;DATABASE=myDatabaseName;Trusted_Connection=Yes;`

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-11-16T15:58:11.783

为了创建连接字符串，我使用 www.connectionstrings.com。非常适合在所有变体和数据库引擎上创建连接字符串

# installation - 为什么有些安装需要这么长时间？

> ID：725062
> 
> 赞同：3
> 
> 时间：2009-04-07T10:47:36.617
> 
> 标签：installation

几乎我们都在这里和那里完成了安装程序 - 我们所有人都安装了一些庞然大物的程序。为什么有些安装需要这么长时间？恰当的例子：Adobe CS 套件（使用更新的版本，您可以休假）或 Visual Studio。

我知道有要复制的文件——大多数时候甚至解压。有一些注册表项需要设置（如果在 Windows 下），可能需要启动一个服务或一对。有些安装可能甚至会检查硬件/软件组合。所有这些都不能证明某些程序的安装时间太长了。

我怎样才能加快速度？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-07T10:54:13.590

我机器上的 Visual Studio 是 3.03GB - 1,979 个文件夹中有 16,842 个文件。对于我的（双核、2GB、sata2）系统来说，通过病毒扫描和审计软件将 3GB 传输到文件系统上是太多了——它在整个过程中都受到 CPU 或 IO 的约束。这就是为什么需要这么长时间。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-04-07T11:00:40.313

这显然取决于您要安装的内容 正如 Colin Pickard 指出的那样，您会将大量数据转移到磁盘上（+可选的病毒检查等）。

对于我最近构建的安装，我们必须请求关闭一些 Windows 服务，等待，并在继续之前检查它们是否真的*已经*关闭。这需要时间。

我承认在上面，这不是并行的，而它可能是并行的。我怀疑安装不一定是优化的。它们很可能是团队在发布之前完成的最后一件事，而且他们很可能认为你只会做一次（并忘记完成后的痛苦）。显然不是一个理想的状态！

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-07T11:00:14.293

大多数安装程序不仅会打包，还会压缩其内容，因此在安装时必须解压缩所有这些文件。所有解压后的数据也必须在解压后写入磁盘。

查看 zip 操作处理多个文件的时间。它也很慢。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-04-07T11:28:55.487

Many installers maintain a log that is flushed to the disk after each primitive operation so that even if installation encounters a fatal failure the log is preserved and can be sent to the software vendor. Such flushing sums up and significantly contributes to overall time.

# .net - 在 IHttpHandler 中访问原始 HTTP 请求包

> ID：725070
> 
> 赞同：0
> 
> 时间：2009-04-07T10:48:41.717
> 
> 标签：.net, ihttphandler

我正在尝试编写一个 IHttpHandler，它可以处理来自 Windows Media Player/Silverlight 的流媒体请求。这意味着响应这样的原始 HTTP 请求（取自协议文档）

```
"GET /ms/contoso_100_files/0MM0.wmv HTTP/1.0"
"Accept: */*"
"User-Agent: NSPlayer/4.1.0.3925"
"Host: netshow.micro.com"
"Pragma: no-cache,rate=1.000000,stream-time=0,stream-offset=0:0,request-context=1,max-duration=0"
"Pragma: xClientGUID={2200AD50-2C39-46c0-AE0A-2CA76D8C766D}" 
```

当我进入 ProcessRequest 方法时， context.Request.Headers 集合似乎没有公开 Pragma 值。此外，它永远无法真正做到，因为有两行具有相同的键（Pragma）！

我假设如果我能得到原始数据包，我可以手动解析它们。

也就是说，接下来我要做的是构造一个 HttpWebRequest 类型的辅助请求。这也包含一个类似的字典，我希望它也无法接受两个相同的编译指示值而不覆盖另一个。

我错过了什么吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-07T10:53:42.280

*没有*Pragma 标头的事实使我认为它们可能不会被发送。我建议你使用 Fiddler 来观察网络流量，以确保它们被发送给你。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-07T10:56:51.023

你是如何访问的`Request.Headers`？`NameValueCollection`处理多个标题的情况，但您必须使用正确的成员来访问它们：

```
string[] values = context.Request.GetValues("Pragma"); 
```

（索引属性本质上执行一个`join(','...)`有多个值的地方）。

# c# - 如何为计时器使用安全线程（从不同的线程更改计时器属性）

> ID：725093
> 
> 赞同：0
> 
> 时间：2009-04-07T10:56:28.810
> 
> 标签：c#, winforms, multithreading, timer

要访问我的表单上的备忘录，我使用以下代码

```
 public string TextValue
    {
        set
        {
            if (this.Memo.InvokeRequired)
            {
                this.Invoke((MethodInvoker)delegate
                {
                    this.Memo.Text += value + "\n";
                });
            }
            else
            {
                this.Memo.Text += value + "\n";
            }
        }
    } 
```

我想使用相同的代码来启用/禁用我的计时器，但是计时器没有属性 InvokeRequired。

```
 public int Timer
    {
        set
        {
            if (this.timer.InvokeRequired) //?? No such thing
            {
                this.Invoke((MethodInvoker)delegate
                {
                    if (value == 1)
                        this.timer.Enabled = true;
                    else
                        this.timer.Enabled = false;
                });
            }
            else
            {
                if (value == 1)
                    this.timer.Enabled = true;
                else
                    this.timer.Enabled = false;
            }
        }
    } 
```

如何从不同的线程启用计时器？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-07T11:00:28.207

“this”是表单对象吗？

假设您使用表单设计器创建了 Timer 对象，该对象是由与创建表单的线程相同的线程创建的，因此检查表单的 InvokeRequired 属性可以有效地告诉您同样的事情。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-08-16T21:21:38.290

从代码中删除计时器，如下所示：

```
public int Timer
{
    set
    {
        if (this.InvokeRequired) 
        {
            this.Invoke((MethodInvoker)delegate
            {
                if (value == 1)
                    this.timer.Enabled = true;
                else
                    this.timer.Enabled = false;
            });
        }
        else
        {
            if (value == 1)
                this.timer.Enabled = true;
            else
                this.timer.Enabled = false;
        }
    }
} 
```

# algorithm - 闰年计算

> ID：725098
> 
> 赞同：55
> 
> 时间：2009-04-07T10:58:15.327
> 
> 标签：algorithm, calendar, leap-year

为了找到闰年，为什么年份必须不能被 100 整除且能被 400 整除？

我明白为什么它必须能被 4 整除。请解释一下算法。

* * *

## 回答 #1

> 赞同：106
> 
> 时间：2009-04-07T11:16:45.983

一年的长度是（或多或少）365.242196 天。因此，我们必须或多或少地减去四分之一天以使其适合：

**365.242196** - 0.25 = **364.992196** （在 4 年内增加 1 天）：但是哎呀，现在它太小了！！让我们加百分之一（一百年不加一天:-)）

**364.992196** + 0,01 = **365.002196**（哎呀，有点太大了，无论如何让我们在大约 400 年内添加一次）

**365.002196** - 1/400 = **364.999696**

现在差不多了，只是偶尔玩一下闰秒，你就准备好了。

（注意：在此步骤之后不再应用更正的原因是因为一年也会改变长度！！，这就是为什么闰秒是最灵活的解决方案，请参见[此处](http://www.webexhibits.org/calendars/year.html)的示例）

这就是为什么我猜

* * *

## 回答 #2

> 赞同：88
> 
> 时间：2009-04-07T11:01:52.777

[维基百科](http://en.wikipedia.org/wiki/Leap_year)上有一个算法来确定闰年：

```
function isLeapYear (year):
    if ((year modulo 4 is 0) and (year modulo 100 is not 0))
    or (year modulo 400 is 0)
        then true
    else false 
```

[在关于闰年的维基百科页面](http://en.wikipedia.org/wiki/Leap_year)上有很多关于这个主题的信息，包括关于不同日历的信息。

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2009-04-07T11:01:46.503

一般来说，计算闰年的算法如下......

如果一年能被 4 整除但不能被 100 整除，则一年将是闰年。如果一年能被 4 和 100 整除，则除非它也能被 400 整除，否则它不是闰年。

因此，1996、1992、1988 等年份是闰年，因为它们可以被 4 整除，但不能被 100 整除。对于世纪年，400 规则很重要。因此，世纪年 1900、1800 和 1700 虽然仍然可以被 4 整除，但也可以被 100 整除。由于它们不能被 400 整除，因此它们不是闰年

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2014-08-30T09:39:39.163

这足以检查一年是否是闰年。

```
if( (year%400==0 || year%100!=0) &&(year%4==0))
    cout<<"It is a leap year";
else
    cout<<"It is not a leap year"; 
```

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2015-08-09T17:46:26.833

a) 一年是 365.242199 天。

b) 如果每年是 365 天，那么 100 年我们将失去 24.2199 天。这就是为什么我们每世纪增加 24 天（每 4 年，除以 100 时除外）

c) 但是我们仍然损失了 0.21299 天/世纪。因此，在 4 个世纪中，我们损失了 0.8796 天。这就是为什么我们每 4 个世纪增加 1 天（每 4 个世纪我们计算一个闰年）。

d) 但这意味着我们每四百年（4 个世纪）损失 -0.1204 天（我们前进）。因此，在 8 个四百周年（3200 年）中，我们不计算闰年。

e) 但这意味着我们每 3200 年损失 0.0368 天。因此，在 24x3200 年（=76800 年）中，我们损失了 0.8832 天。这就是为什么我们要计算闰年。

等等...（到那时我们将摧毁地球，所以没关系）

**但我无法理解的是，为什么我们不计算每 500 年而不是 400 年的闰年。这样我们会更快地收敛到正确的时间（我们会损失 2.3 小时/500 年）。**

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2009-04-07T11:04:30.320

我相信[维基百科](http://en.wikipedia.org/wiki/Leap_years)可以比我更好地解释它，但这基本上与这样一个事实有关，即如果你每四年增加一天，我们就会领先于太阳，因为它绕太阳运行的时间少于365.25 天，因此我们通过在不能被 400 整除的年份（例如 1900 年）上不添加闰日来弥补这一点。

希望有帮助

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2016-10-18T17:45:33.393

这是使用 javascript 三元运算符的[wikipedia algorithm](https://en.wikipedia.org/wiki/Leap_year)的简单实现：

```
isLeapYear = (year % 100 === 0) ? (year % 400 === 0) : (year % 4 === 0); 
```

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2014-03-12T12:52:45.850

如果输入年份是闰年，则返回 true

基本现代代码：

```
 If year mod 4 = 0, then leap year
  if year mod 100 then normal year
  if year mod 400 then leap year
  else normal year 
```

今天的规则开始于公元 1582 年的儒略历规则，每 4 年开始于公元前 46 年，但在公元 10 年之前并不一致，正如塞萨尔所宣布的那样。然而，他们确实在前几年每隔三年添加一些闰年：因此闰年是公元前 45 年、公元前 42 年、公元前 39 年、公元前 36 年、公元前 33 年、公元前 30 年、公元前 27 年、公元前 24 年、公元前 21 年、公元前 18 年BC, 15 BC, 12 BC, 9 BC, 8 AD, 12 AD 45BC 之前没有添加闰年。

0 年不存在，因为它是 ...2BC 1BC 1AD 2AD... 对于某些计算，这可能是一个问题。

```
function isLeapYear(year: Integer): Boolean;
begin
  result := false;
  if year > 1582 then // Todays calendar rule was started in year 1582 
    result := ((year mod 4 = 0) and (not(year mod 100 = 0))) or (year mod 400 = 0)
  else if year > 10 then // Between year 10 and year 1582 every 4th year was a leap year 
    result := year mod 4 = 0
  else //Between year -45 and year 10 only certain years was leap year, every 3rd year but the entire time
    case year of
      -45, -42, -39, -36, -33, -30, -27, -24, -21, -18, -15, -12, -9:
        result := true;
    end;
end; 
```

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-04-07T11:05:30.583

你真的应该先尝试谷歌。

[维基百科对闰年](http://en.wikipedia.org/wiki/Leap_year)有解释。您描述的[算法适用于](http://en.wikipedia.org/wiki/Leap_year#Algorithm)[Proleptic Gregorian calendar](http://en.wikipedia.org/wiki/Proleptic_Gregorian_calendar)。

更多关于它的数学可以在文章[日历算法](https://sites.millersville.edu/bikenaga/number-theory/calendar/calendar.html)（[PDF](https://sites.millersville.edu/bikenaga/number-theory/calendar/calendar.pdf)）中找到。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2011-12-28T14:55:43.263

如果我们更进一步，会不会好很多。假设每 3200 年为无闰年，一年的长度将到来

```
364.999696 + 1/3200 = 364.999696 + .0003125 = 365.0000085 
```

在此之后，大约 120000 年后需要进行调整。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2017-01-07T19:20:18.860

在`Java`下面的代码中计算两个给定年份之间的闰年计数。确定循环的起点和终点。

然后如果参数模 4 等于 0 且参数模 100 不等于 0 或参数模 400 等于 0 则为闰年并增加计数器。

```
static int calculateLeapYearCount(int year, int startingYear) {
        int min = Math.min(year, startingYear);
        int max = Math.max(year, startingYear);
        int counter = 0;
        for (int i = min; i < max; i++) {
            if ((i % 4 == 0 && i % 100 != 0) || i % 400 == 0) {
                counter = counter + 1;
            }
        }
        return counter;
    } 
```

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2017-03-04T19:20:15.330

PHP：

```
// is number of days in the year 366?  (php days of year is 0 based)
return ((int)date('z', strtotime('Dec 31')) === 365); 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2013-04-22T12:00:58.310

这里出现了一个相当晦涩的想法。当每年用100整除得到365天时，这个时候该怎么办？在遥远的未来，当连年可以用400整除时，只能得到365天。

那么就有可能或有理由对可被 80 整除的年份进行更正。正常年份将有 365 天，而那些可被 400 整除的年份可以得到 366 天。或者这是一个松散的情况。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-04-07T11:07:36.023

闰年是任意的，用来描述闰年的系统是人造的。没有为什么。

我的意思是，每 28 年可能会有一个闰年，在那些闰年我们会有额外的一周……但是决定每 4 年让它成为一天以迎头赶上的权力。

这也与地球需要 365.25 天才能绕太阳转等有关。当然，它并不是真正的 365.25，它是否略少（**365.242222...**），所以为了纠正这种差异，他们决定放弃飞跃能被 100 整除的年份。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2009-04-07T11:13:06.010

如果您对这些规则的原因感兴趣，那是因为地球绕太阳运行一圈所需的时间是一个很长的不精确的十进制值。它不完全是 365.25。它略小于 365.25，因此每 100 年必须消除一个闰日（365.25 - 0.01 = 365.24）。但这也不完全正确。该值略大于 365.24。因此，4 次中只有 3 次适用 100 年规则（或者换句话说，每 400 年加回 1 天；365.25 - 0.01 + 0.0025 = 365.2425）。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2009-04-07T11:21:11.620

目前平均一年大约有 365.2425 天（地球正在减速，但我们暂时忽略它）。

我们每 4 年有闰年的原因是因为这使我们平均达到 365.25 `[(365+365+365+366) / 4 = 365.25, 1461 days in 4 years]`。

我们在 100 倍数上没有闰年的原因是为了让我们达到 365.24 `[(1461 x 25 - 1) / 100 = 365.24，100 年有 36,524 天。

那么我们再次在 400 倍数上有闰年的原因是为了让我们达到 365.2425 `[(36,524 x 4 + 1) / 400 = 365.2425, 146,097 days in 400 years]`。

我相信在 3600 倍数上可能还有另一条规则，但我从来没有为它编码（千年虫是一回事，但在我看来，没有必要计划未来一千年半 - 请记住，我一直之前错了）。

所以，规则是，在降低优先级：

*   400的倍数是闰年。
*   100的倍数不是闰年。
*   4的倍数是闰年。
*   其他任何事情都不是闰年。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2014-05-01T00:33:25.577

你可以只检查年份数字是否能被 4 和 400 整除。你真的不需要检查它是否不能被 100 整除。400 出现问题的原因是因为根据公历，我们的“日长”略关闭，因此为了弥补这一点，我们有 303 个常规年（每个 365 天）和 97 个闰年（每个 366 天）。额外的 3 年不是闰年的区别在于与公历保持循环，公历每 400 年重复一次。查找 Christian Zeller 的同余方程。这将有助于理解真正的原因。希望这可以帮助 ：）

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2014-11-26T09:39:36.260

在公历中，必须考虑 3 个标准来识别闰年：

1.  年份可以被 4 整除；
2.  如果年份可以被 100 整除，则它不是闰年，除非；
3.  年份也能被 400 整除。那么就是闰年。[为什么年份除以 100 不是闰年](http://programmingansic.blogspot.com/2014/11/the-reason-for-leap-year.html)

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2019-05-26T10:39:36.193

C# 实现

```
public bool LeapYear()
{
     int year = 2016;

     return year % 4 == 0 && year % 100 != 0 || year % 400 == 0 ;
} 
```

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2020-05-16T09:30:50.453

在 shell 中，您可以使用`cal -j YYYY`which 打印一年中的儒略日，如果最后一个儒略日是 366，那么它是闰年。

```
$ function check_leap_year
 {
  year=$1
   if [ `cal -j $year | awk 'NF>0' | awk 'END { print $NF } '` -eq 366 ];
   then
      echo "$year -> Leap Year";
   else
      echo "$year -> Normal Year" ;
   fi
 }
$ check_leap_year 1900
1900 -> Normal Year
$ check_leap_year 2000
2000 -> Leap Year
$ check_leap_year 2001
2001 -> Normal Year
$ check_leap_year 2020
2020 -> Leap Year
$ 
```

使用awk，你可以做到

```
$ awk -v year=1900 ' BEGIN { jul=strftime("%j",mktime(year " 12 31 0 0 0 ")); print jul } '
365
$ awk -v year=2000 ' BEGIN { jul=strftime("%j",mktime(year " 12 31 0 0 0 ")); print jul } '
366
$ awk -v year=2001 ' BEGIN { jul=strftime("%j",mktime(year " 12 31 0 0 0 ")); print jul } '
365
$ awk -v year=2020 ' BEGIN { jul=strftime("%j",mktime(year " 12 31 0 0 0 ")); print jul } '
366
$ 
```

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2018-12-26T08:16:32.400

我在“Python 3 图解指南”一书中发现了这个问题。在很早的一章中，只讨论了数学运算，没有循环，没有比较，没有条件。如何判断某一年是否为闰年？

以下是我想出的：

```
y = y % 400
a = y % 4
b = y % 100
c = y // 100
ly = (0**a) * ((1-(0**b)) + 0**c)   # ly is not zero for leap years, else 0 
```

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2019-11-29T04:29:28.767

从 1700 年到 1917 年，官方日历是儒略历。从那以后他们我们使用公历系统。从儒略历到公历的过渡发生在 1918 年，当时 1 月 31 日之后的第二天是 2 月 14 日。这意味着 1918 年的第 32 天，是 2 月 14 日。

在这两个日历系统中，二月是唯一一个天数可变的月份，闰年有 29 天，其他年份有 28 天。在儒略历中，闰年可以被 4 整除，而在格里高利历中，闰年是以下之一：

能被 400 整除。

能被 4 整除，不能被 100 整除。

所以闰年的程序是：

Python：

```
def leap_notleap(year):

    yr = ''
    if year <= 1917:
        if year % 4 == 0:
            yr = 'leap'
        else:
            yr = 'not leap'
    elif year >= 1919:
        if (year % 400 == 0) or (year % 4 == 0 and year % 100 != 0):
            yr = 'leap'
        else:
            yr = 'not leap'
    else:
        yr = 'none actually, since feb had only 14 days'

    return yr 
```

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2018-10-19T08:24:57.050

很简单，因为 2000 年是闰年，它可以被 100 整除并且可以被 4 整除。所以为了保证它是正确的闰年，我们需要确保它可以被 400 整除。2000 % 4 = 0 2000 % 100 = 0 根据算法它是不是飞跃，但它可以被 400 2000 % 400 = 0 整除，所以它是飞跃。

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2021-06-13T00:40:05.947

如果年份是闰年，BIS 将为 1，否则在此布尔逻辑中为 0：

```
BIS = A MOD 4=0 - (A MOD 100=0 AND A>1600) + (A MOD 400=0 AND A>1600) 
```

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2016-12-25T17:19:31.230

蟒蛇 3.5

```
def is_leap_baby(year):
    if ((year % 4 is 0) and (year % 100 is not 0)) or (year % 400 is 0):
        return "{0}, {1} is a leap year".format(True, year)
    return "{0} is not a leap year".format(year)

print(is_leap_baby(2014))
print(is_leap_baby(2012)) 
```

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2019-03-06T01:19:20.033

我认为这是最有效的方法。

Python：

```
def leap(n):
    if n % 100 == 0:
        n = n / 100
    return n % 4 == 0 
```

* * *

## 回答 #27

> 赞同：-2
> 
> 时间：2011-08-21T21:05:44.343

刚刚用 Coffee-Script 写了这个：

```
is_leap_year = ( year ) ->
  assert isa_integer year
  return true   if year % 400 == 0
  return false  if year % 100 == 0
  return true   if year %   4 == 0
  return false

# parseInt? that's not even a word. 
# Let's rewrite that using real language:
integer = parseInt 

isa_number = ( x ) ->
  return Object.prototype.toString.call( x ) == '[object Number]' and not isNaN( x )

isa_integer = ( x ) ->
  return ( isa_number x ) and ( x == integer( x ) ) 
```

当然，这里所做的有效性检查比所要求的要远一些，但我发现在良好的编程中这是必要的事情。

请注意，此函数的返回值表示所谓的公历中的闰年，因此对于 1400 年，它表示`false`，而事实上，根据当时使用的儒略历，那一年*是*闰年。我仍然会将它留在我正在编写的日期时间库中，因为编写正确的代码来快速处理日期会令人惊讶地涉及，所以我只会支持公历（或为另一个公历付费）。

# asp.net - 分页计数错误asp.net

> ID：725100
> 
> 赞同：1
> 
> 时间：2009-04-07T10:59:06.137
> 
> 标签：asp.net, sql-server, paging, datalist

我有一个带有分页的数据列表，它可以在本地调试良好，但在我的托管公司提供的部署服务器上不起作用。

```
Line 151:        TotalRowCount = pagedData.DataSourceCount; 
```

我在本地和部署服务器上使用相同的远程数据库。

错误信息：

```
Server Error in '/' Application.
Object reference not set to an instance of an object.
Description: An unhandled exception occurred during the execution of the current web request. Please review the stack trace for more information about the error and where it originated in the code.

Exception Details: System.NullReferenceException: Object reference not set to an instance of an object.

Source Error:

Line 149:
Line 150:        // Remember the total number of records being paged through across postbacks
Line 151:        TotalRowCount = pagedData.DataSourceCount;
Line 152:        PrevPage.Visible = !pagedData.IsFirstPage;
Line 153:        NextPage.Visible = !pagedData.IsLastPage;

Source File: \\pdc1\sites\t\test.domain.com\public_html\Auctions.aspx.cs    Line: 151

Stack Trace:

[NullReferenceException: Object reference not set to an instance of an object.]
   Auctions.ItemDataSource_Selected(Object sender, ObjectDataSourceStatusEventArgs e) in \\pdc1\sites\t\test.domain.com\public_html\Auctions.aspx.cs:151
   System.Web.UI.WebControls.ObjectDataSourceView.OnSelected(ObjectDataSourceStatusEventArgs e) +95
   System.Web.UI.WebControls.ObjectDataSourceView.InvokeMethod(ObjectDataSourceMethod method, Boolean disposeInstance, Object& instance) +432
   System.Web.UI.WebControls.ObjectDataSourceView.ExecuteSelect(DataSourceSelectArguments arguments) +1247
   System.Web.UI.WebControls.BaseDataList.GetData() +38
   System.Web.UI.WebControls.DataList.CreateControlHierarchy(Boolean useDataSource) +153
   System.Web.UI.WebControls.BaseDataList.OnDataBinding(EventArgs e) +54
   System.Web.UI.WebControls.BaseDataList.DataBind() +55
   System.Web.UI.WebControls.BaseDataList.EnsureDataBound() +60
   System.Web.UI.WebControls.BaseDataList.CreateChildControls() +69
   System.Web.UI.Control.EnsureChildControls() +87
   System.Web.UI.Control.PreRenderRecursiveInternal() +44
   System.Web.UI.Control.PreRenderRecursiveInternal() +171
   System.Web.UI.Control.PreRenderRecursiveInternal() +171
   System.Web.UI.Control.PreRenderRecursiveInternal() +171
   System.Web.UI.Control.PreRenderRecursiveInternal() +171
   System.Web.UI.Page.ProcessRequestMain(Boolean includeStagesBeforeAsyncPoint, Boolean includeStagesAfterAsyncPoint) +842

Version Information: Microsoft .NET Framework Version:2.0.50727.3053; ASP.NET Version:2.0.50727.3053 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-07T11:22:35.987

这意味着从服务器到您的数据库的连接不起作用，因为 pagedData 对象为空。

检查您是否可以使用正确的身份访问您的数据源。

# iphone - 有没有办法在 CAKeyframeAnimation 中间交换图层或视图？

> ID：725102
> 
> 赞同：0
> 
> 时间：2009-04-07T11:00:03.857
> 
> 标签：iphone, objective-c, core-animation, layer

我正在运行一个关键帧动画，以使用 CAKeyframeAnimation 移动和翻转扑克牌视图。有没有办法在动画期间交换 cardFront 和 cardBack 层？还是我在这里采取了错误的方法...

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-07T20:50:05.437

使用设置为动画持续时间一半的计时器来执行 cardBack.contents = cardFront.contents

# php - 如何在 PHP 中使用 { } 创建我自己的函数

> ID：725112
> 
> 赞同：0
> 
> 时间：2009-04-07T11:02:03.587
> 
> 标签：php, function

我想创建自己的功能`loop()`：

```
loop($x,$y){
    //do something
} 
```

它应该像 foreach 运算符一样工作：

```
$y=count($array); 
for($x=0; $x<$y; $x++){ 
     //do something 
} 
```

如何`{ }`在 PHP 中创建这样的函数？（不是常规功能）

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-04-07T11:05:47.820

你不能。

for 或 foreach 之类的结构是 php 语法的一部分。

如果要创建常规函数，只需使用 function 关键字：

```
function some_func($x, $y)
{
....
} 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-07T11:49:05.300

在更高级的级别上，您可以创建一个类并对其进行迭代，您可以在其中几乎可以在执行*期间*（迭代时）更改执行流程。

这是文档： http: [//php.net/iterator](http://php.net/iterator)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-07T11:13:31.280

在 PHP 6 中会有 lambda 函数——这就是你想要做的。现在你必须坚持使用“普通”函数。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-07T13:05:33.773

如果你真的很认真地对待你的函数/s，你可以做的另一件事是你可以写一个 php 扩展，这会给你一些灵活性...... [http://devzone.zend.com/node/view/id/1021](http://devzone.zend.com/node/view/id/1021)我必须警告你虽然..这并不容易....

# windows-services - 如何获取 CreateProcessAsUser 的有效用户令牌？

> ID：725113
> 
> 赞同：5
> 
> 时间：2009-04-07T11:03:01.697
> 
> 标签：windows-services, token, createprocessasuser

我有一个以普通用户身份运行的应用程序和一个作为本地系统运行的服务。我希望应用程序能够告诉服务再次启动应用程序，一旦服务完成了其他一些事情。（所以应用程序不会在服务执行它的“事情”时运行。）为了让服务能够以第一次启动它的用户身份启动应用程序，它需要一个用户令牌。应用程序在退出之前将令牌发送到服务，但在服务尝试使用它时令牌/句柄无效。（它用它做的第一件事是 DuplicateTokenEx 获取主令牌。）

用户令牌是否始终只在调用 OpenProcessToken 的进程中有效？

有没有其他方法可以做到这一点？我不希望用户必须使用 logonuser “登录”到应用程序。那将是愚蠢的。我想我可以将“explorer.exe”的进程句柄从应用程序移交给服务，服务可以使用它来获取用户令牌，但这需要 PROCESS DUP HANDLE 访问权限。我对那个解决方案并不感到兴奋，但也许这是这样做的方法？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-07T13:32:46.517

您在这里有多个问题，因此我将尝试分别解决它们，如果我误解了，您可以纠正我：

1.  您似乎有一个服务和一个用户应用程序不能同时执行某些功能。为了实现这一点，您让服务停止应用程序，执行特殊功能，然后重新启动应用程序。如果这是正确的，那么在我看来，你有一个设计缺陷。而不是停止，然后重新启动应用程序，您应该通过互斥使用命名互斥和/或使用 IPC 方法（例如命名管道来传达意图）来协调对共享资源的访问。

2.  用户令牌是否始终只在调用 OpenProcessToken 的进程中有效？是的，您收到的令牌句柄是进程句柄表的索引，不能直接转移。您将需要使用 DuplicateHandle，这可能是您想要的，但可能会很混乱。

3.  您希望找到获取用户令牌以将应用程序启动到用户（交互式？）会话的最佳方式。如果是这种情况，最好的方法是检索用户的会话令牌并使用它。您可以查看[这篇文章](http://asprosys.blogspot.com/2009/03/allow-service-to-interact-with-desktop.html)和示例代码，它使用 C#，但应该相对容易转移到您选择的语言。

编辑：更新为包括 Windows 2000。由于您在 SYSTEM 帐户下运行该服务，它可以打开进程本身的句柄（如有必要，该进程可以发送其进程 ID）。然后它可以打开附加到该进程的令牌，复制它并使用生成的令牌来启动（或重新启动）目标应用程序。

# version-control - 哪个版本控制支持在多个版本中合并？

> ID：725118
> 
> 赞同：0
> 
> 时间：2009-04-07T11:05:11.193
> 
> 标签：version-control, merge, branch, branching-and-merging

想象一下，您有一个大型软件项目，您必须同时支持多个分支（版本）。例如，您在网站上有一个生产版本，一个当前由客户测试的集成测试版本，一个用于本地系统测试的测试版本，以及一个开发人员正在破解新功能的开发版本。

什么版本控制系统可以很好地支持这种设置？我主要担心的是它应该支持不同版本之间的合并 - 如果您在生产版本中修复紧急错误，您不想检查所有其他版本并手动修复错误 5 次。

如果你有答案，我想听听你应用它的项目有多大，你有什么经验。我正在寻找一个明确支持开发人员合并的系统 - 由构建管理器等应用脚本的解决方案对我们没有帮助。（太危险了；开发人员应该立即完成合并，因为他/她最清楚该做什么。）非常感谢！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-07T11:40:45.427

我认为大多数（如果不是全部）现代 SCM 都可以做到这一点。不一定是自动的，尽管有些脚本可以以一种非常轻松的方式处理它。

在工作中，我们使用 Perforce，并且我们手动进行集成（借助 Perl 脚本来复制更改列表信息）。我们仔细选择要发布的变更列表（例如，我们可以丢弃有风险的变更列表）。
对于大多数分布式 VCS（Mercurial、Bazaar，可能是 Git 等），使用多个分支（或克隆）是自然的工作流程。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-07T11:25:11.690

以我的经验与颠覆作品合并，但非常痛苦（尽管我听说新版本在这方面更好）。Git 和 Mercurial 可以正确合并，没有任何问题。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-13T23:00:22.533

如果您真的想处理多个版本但又不想遭受 Clearcase 的痛苦，您应该尝试[使用 Accurev](http://www.accurev.com)或[PlasticSCM 之](http://www.plasticscm.com)类的东西。

Accurev 处理它的流非常强大，你必须习惯它们，但一旦你习惯了它，它就会非常非常强大。

塑料在处理无限数量的分支（及其相应的合并）方面更强大，这说起来容易做起来难。您已经具备了优秀的 CC 所提到的所有灵活性，但没有神秘的命令或奇怪的配置。

在这里，您有跟踪多个分支的分支资源管理器

![替代文字](https://farm4.static.flickr.com/3354/3439112851_133242de6f.jpg)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-15T22:34:34.717

这个问题的答案是流程第一，工具链第二。

您需要决定您希望如何访问已知版本（例如“正在生产什么？”），您希望如何对这些版本进行更改，以及您希望如何将更改传播到其他版本。

大多数 Subversion-Or-Better 的 VCS 系统将支持常见的工作流。这是一个常见的：

1.  发展在主干
2.  当发布时，标记主干，例如 1.3.0
3.  在您制作的标签处创建一个主干分支，例如 1.3.x
4.  发布基于“标签”的代码（例如 1.3.0）
5.  恢复主干上新功能的开发
6.  如果您需要修复生产中的错误，请检查分支并修复它。正常释放它，创建一个新标签（例如 1.3.1）。
7.  根据需要将分支中的更改合并回主干
8.  根据需要重复步骤 6 和 7，直到您的下一个版本。

这是另一种常见的做法：

1.  发展在主干
2.  当发布的时候，标记主干
3.  基于“标签”发布到生产环境（例如 1.3.0）
4.  如果发现错误，则创建一个分支以针对标签修复该错误
5.  提交新分支并重新标记（例如 1.3.1）
6.  将该分支合并回主干
7.  每当发现错误时重复步骤 4、5 和 6

这些非常常见且易于实现/理解；大多数版本控制系统很容易支持它们。如果您获得更复杂的流程，您将减少可用的工具集，但可能拥有更多功能。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-07T11:14:25.040

[Clearcase](http://www.ibm.com/developerworks/rational/products/clearcase/)将处理多个分支和修订，并在任何/所有这些之间进行合并。您可以随意定义分支，根据需要进行标记，并与这些分支合并。不用说，这可能会变得*异常*复杂，IBM 提供了一个[合并管理器](http://publib.boulder.ibm.com/infocenter/cchelp/v7r0m1/topic/com.ibm.rational.clearcase.doc/topics/u_mrgman.htm)来帮助您。您可以以图形方式显示分支（如果有帮助的话）。

Clearcase 非常强大，但管理起来也相应复杂且耗时。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-07T11:14:47.050

Team Foundation Server 通过合并支持任意数量的分支。它虽然很不错，但是 2010 版本的功能使分支更加引人注目。请参阅[第 10-4 集第 4 集：不再有并行开发的痛苦](http://channel9.msdn.com/shows/10-4/10-4-Episode-4-No-More-Parallel-Development-Pain/)。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-07T11:08:34.350

可以配置[Telelogic CM Synergy/CM](http://de.wikipedia.org/wiki/Telelogic_Synergy/CM)以支持这样的设置。

好处是，如果文件在这些版本中未更改，则所有“更高”版本都会自动更新，无需开发人员或构建管理员操作。如果修改后的文件被更改，开发人员会在签入时立即收到通知，并且必须合并这些内容。它支持将相关更改分组到任务和更改请求中，并具有相关的跟踪系统。

缺点是它*真的*又大又慢，需要大量的 buildmanager 时间，而且 eclipse 集成几乎无法使用。您可能需要每 5 或 10 名开发人员配备一名全职构建经理。

# java - 检测使用 Java 登录计算机的用户

> ID：725124
> 
> 赞同：6
> 
> 时间：2009-04-07T11:06:46.990
> 
> 标签：java, active-directory

我想开发一个可以检测用户登录窗口域的 Java 应用程序。这些凭据将用于登录 Java 应用程序。

我怎样才能做到这一点？

谢谢！

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-04-07T11:09:36.783

```
System.getProperty("user.name") 
```

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-04-07T11:32:15.933

如果你需要域名，你可以使用这个：

```
 com.sun.security.auth.module.NTSystem NTSystem = new
          com.sun.security.auth.module.NTSystem();
  System.out.println(NTSystem.getName());
  System.out.println(NTSystem.getDomain()); 
```

再见。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-11-03T21:26:50.730

注意： System.getProperty("user.name") 仅在用户启动应用程序时才有效。如果该程序由 System 或 LANDesk 之类的应用程序运行，则用户将显示为“SYSTEM”（在域“NT AUTHORITY”下）。

在这种情况下，使用 NTSystem 的第二种解决方案将返回正确的结果。

# c++ - 如何在编译时检测“严格别名”？

> ID：725138
> 
> 赞同：2
> 
> 时间：2009-04-07T11:11:03.423
> 
> 标签：c++, c, optimization, pointers

“[严格别名](https://stackoverflow.com/questions/98650/what-is-the-strict-aliasing-rule)”优化需要特别注意源代码，sa 使用联合而不是指针强制转换。有没有办法使用预处理器指令（#if/else）检测编译器是否正在尝试进行此类优化？

我想为不关心的处理器和编译器维护旧的和非严格别名准备的代码路径。它似乎更快。

编辑：[GCC 预定义的宏](http://gcc.gnu.org/onlinedocs/cpp/Common-Predefined-Macros.html#Common-Predefined-Macros)似乎没有任何关于别名的内容。换句话说，我对 gcc 4.x 最感兴趣，但也对通用解决方案（似乎不存在）感兴趣。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-07T11:12:40.177

完全依赖于实现 - 您需要检查特定编译器的文档。在提出这样的问题时，最好提及您正在使用的编译器。

一种半便携的方法是从您的 Makefile 中 - 为别名和非别名版本定义不同的目标，并为别名版本定义您自己的 STRICT_ALIASING （或其他）预处理器符号。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-07T11:38:12.297

[对于 GCC，请参见“may_alias”属性](http://gcc.gnu.org/onlinedocs/gcc-4.3.3/gcc/Type-Attributes.html)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-07T11:42:34.440

没有通用的解决方案。最接近的是#ifdef __cplusplus，因为标准 C++ 允许编译器假定指向不同类型的指针没有别名（除非它们是 char*）。即使在简单的场景中也会发生这种情况，例如：

```
void (int *foo, float *bar) {
  *foo++;
  *bar = 0; // Can safely be scheduled between the load and store of foo.
} 
```

因此，“严格混叠”并不是真正的优化；“容忍未定义的行为”是一种悲观。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-07T13:48:06.667

据我所知，没有用于检测严格别名的预处理器指令。

如果您使用 gcc 的“-Wall”，那么编译器会警告您有关可能违反严格别名规则的代码。

> `-Wstrict-aliasing`--- 此选项仅在 '-fstrict-aliasing' 激活时有效。它警告可能破坏编译器用于优化的严格别名规则的代码。该警告并未涵盖所有情况，但确实试图找出更常见的陷阱。它包含在“-Wall”中。相当于'-Wstrict-aliasing=3'</p>

如果您正在处理的代码很关键，那么您可以`-fstring-aliasing`在 gcc 中禁用。或者，如果您不想禁用严格别名，我建议查看 asm 输出以确保编译器没有进行您不想要的危险优化。

* * *

顺便说一句，akauppi 在评论中说：

> 'restrict' 为特定指针启用严格的别名优化。

restrict 关键字不直接“启用...优化”，而是为编译器提供更多信息，而这些额外信息间接帮助编译器确定它是否可以应用特定的优化技术。

[TI 的 DSP 编译器文档](http://wisconsin.cern.ch/ROD/ti_documents/spru187k.pdf)中对 restrict 关键字的一个很好的解释：

为了帮助编译器确定内存依赖关系，您可以使用 restrict 关键字限定指针、引用或数组。restrict 关键字是可以应用于指针、引用和数组的类型限定符。它的使用代表程序员保证在指针声明的范围内，指向的对象只能由该指针访问。任何违反此保证的行为都会导致程序未定义。这种做法有助于编译器优化某些代码部分，因为可以更容易地确定别名信息。

# c++ - 引用计数智能指针的引用计数如何工作？

> ID：725142
> 
> 赞同：30
> 
> 时间：2009-04-07T11:12:22.437
> 
> 标签：c++, memory-management, memory-leaks, smart-pointers, shared-ptr

换句话说，实现如何跟踪计数？

是否维护了一个类似地图的对象，所有`shared_ptr`实例都可以访问该对象，其键是指针的地址，值是引用的数量？如果我必须实现 a `shared_ptr`，这是我想到的第一个想法。

在这些引用计数智能指针的情况下是否存在内存泄漏的可能性？如果是这样，我该如何避免它们？

* * *

## 回答 #1

> 赞同：68
> 
> 时间：2009-04-07T11:26:46.210

我已经看到了两种不同的非侵入式方法：

1.  智能指针分配一小块内存来包含引用计数器。然后，智能指针的每个副本都会收到一个指向实际对象的指针和一个指向引用计数的指针。
2.  除了对象指针之外，每个智能指针还包含前一个和下一个指针，从而形成指向特定对象的智能指针的双向链表。引用计数隐含在列表中。复制智能指针时，它会将自身添加到列表中。销毁后，每个智能指针都会将自己从列表中删除。如果它是列表中的最后一个，那么它也会释放引用的对象。

如果你去[这里](http://ootips.org/yonat/4dev/smart-pointers.html)并滚动到底部，有一个很好的图表可以更清楚地解释这些方法。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-07T11:19:19.597

使用引用计数智能指针创建内存泄漏非常容易。只需创建在图中具有循环的对象的任何类似图形的结构。循环中的对象会互相阻止释放。这无法自动解决 - 例如，当您创建一个双链接列表时，您必须注意不要一次删除多个对象。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-07T11:19:22.077

每个智能指针对象都包含一个共享引用计数——每个原始指针一个。

你可以看看[这篇](http://www.codeproject.com/KB/cpp/SmartPointers.aspx)文章。此实现将这些存储在一个单独的对象中，该对象被复制。您还可以查看[boost 的文档](http://www.boost.org/doc/libs/1_38_0/libs/smart_ptr/sp_techniques.html)或查看有关智能指针的[Wikipedia 文章。](http://en.wikipedia.org/wiki/Smart_pointer)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-07T11:19:18.740

不，shared_ptr 只保留一个额外的指针用于引用计数。

当您复制 shared_ptr 对象时，它会复制带有引用计数的指针，增加它，并在包含的对象上复制指针。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-07T11:22:49.777

据我记得，在Effective C++的一章中提到了引用计数指针的问题。

原则上，您拥有“轻量级”指针类，其中包含指向持有引用的类的指针，该引用知道递增/递减引用并销毁指针对象。该引用计数类指向要引用的对象。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-04-07T13:43:51.263

许多答案解决了引用计数的存储方式（它存储在所有 shared_ptr 持有相同本机指针的共享内存中），但大多数都避免了泄漏问题。

使用引用计数指针泄漏内存的最简单方法是创建循环。例如，所有指针都是 shared_ptr 且至少有两个元素的双向链表保证不会被删除。即使外部指针被释放，内部指针仍然会计数，并且引用计数不会达到 0。也就是说，至少在最简单的实现中是这样。

循环问题最简单的解决方案是将 shared_ptr（引用计数指针）与不共享对象所有权的弱指针混合。

共享指针将共享资源（指针）和附加的reference_count 信息。当你使用弱指针时，引用计数加倍：有一个共享指针引用计数和一个弱指针引用计数。每当共享指针计数达到 0 时，资源就会被释放，但 reference_count 信息会保持活动状态，直到最后一个弱指针被释放。

在双向链表中，外部引用保存在 shared_ptr 中，而内部链接只是weak_ptr。只要没有外部引用（shared_ptr），列表的元素就会被释放，删除弱引用。最后，所有弱引用都已被删除，指向每个资源的最后一个弱指针释放了 reference_count 信息。

它不像上面的文字看起来那么令人困惑......我稍后再试一次。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2020-05-14T09:02:44.400

实现 RC 的类基本上保持对它所管理的内存地址的引用数（来自类的其他对象，包括它自己的）的计数。仅当对内存地址的引用计数为零时才释放内存。

让我们看一些代码：

```
template <class T>
class SharedPtr
{
    T* m_ptr;   
    unsigned int* r_count;  
public:
    //Default Constructor
    SharedPtr(T* ptr) :m_ptr{ ptr }, r_count{ ptr ? new unsigned int : nullptr }
    {
        if (r_count)
        {
            *r_count = 1;
        }
    }

    //Copy Constructor
    SharedPtr(SharedPtr& ptr) :m_ptr{ ptr.m_ptr }, r_count{ ptr.m_ptr ? new unsigned int : nullptr }
    {
        if (ptr.r_count)
        {
            ++(*ptr.r_count);
            r_count = ptr.r_count;
            m_ptr = ptr.m_ptr;
        }
    }

    //Copy Assignment
    SharedPtr& operator=(SharedPtr& ptr)
    {
        if (&ptr == this)
            return *this;
        if (ptr.r_count)
        {
            delete m_ptr;
            ++(*ptr.r_count);
            r_count = ptr.r_count;
            m_ptr = ptr.m_ptr;
        }
        return *this;
    }

    //Destructor
    ~SharedPtr()
    {
        if (r_count)
        {
            --(*r_count);
            if (!(*r_count))
            {
                delete m_ptr;
                delete r_count;
            }
        }
    }
}; 
```

以下是上述`SharedPtr`类如何工作的详细信息：

内部变量

**内部指针** `m_ptr`

类的指针`SharedPtr`，它是用于管理相关内存的实际指针。这个指针变量在多个`SharedPtr`对象之间共享，这就是为什么我们需要一个引用计数系统来跟踪在程序生命周期的任何时间点有多少`SharedPtr`对象正在管理这个指针指向的内存。

**参考计数器** `r_count`

这是一个指向整数类型变量的指针，它也在`SharedPtr`管理同一内存的多个对象之间共享。这是共享的，因为每个`SharedPtr`管理内存的对象都应该知道`SharedPtr`管理同一内存的每个其他对象的计数。实现这一点的方法是拥有一个由`SharedPtr`同一家族的对象引用的公共引用计数器。

每次`SharedPtr`物化一个新对象以管理已由其他`SharedPtr`对象管理的内存时，r_count 就会增加 1。当对象死亡时，它也会减少 1 `SharedPtr`，以便其他`SharedPtr`对象“知道”它们的家庭中的一个管理家庭记忆的成员已经去世，不再管理记忆。

**默认构造函数**

当一个新`SharedPtr`对象被堆分配的内存创建和初始化时，这个构造函数被调用，内部指针`m_ptr`被初始化为需要管理的堆分配的内存地址。因为这是对该指针的第一个也是唯一的引用，所以引用计数器`r_count`设置为 1。这里没有发生任何有趣的事情。

**复制构造函数和复制赋值**

这是“真正的”引用计数发生的地方。

每当`SharedPtr`使用另一个`SharedPtr`对象创建新对象或使现有对象`SharedPtr`引用另一个对象`SharedPtr`时，即基本上当新`SharedPtr`对象（现有或新创建的）用于管理已由其他`SharedPtr`对象管理的内存时，内部使这个新管理器的指针变量`m_ptr`指向要管理的内存地址，并且该族的引用计数增加 1。

**析构函数**

智能指针旨在释放它们在死亡时管理的内存。在 的情况下`SharedPtr`，它确保在释放内存之前没有其他对正在管理的内存的引用。所有这些都发生在对象的析构函数中。

正如您在代码中看到的，对象只有在对内存的引用计数为 0 时才会释放内存，然后才会死掉。

这很重要，因为如果一个`SharedPtr`对象在 r_count 不为 0 时释放内存，则`SharedPtr`管理相同内存的其他对象会在之后的某个时间尝试访问它，结果将是程序崩溃。

通过`SharedPtr`将释放内存的责任交给管理内存的最后一个幸存对象，确保不会发生这种情况。由于 的设计`SharedPtr`，所有这些都自动发生，无需程序员干预。

这就是引用计数的工作原理。

引用计数就像几个室友的例行公事：最后离开房间的人有责任锁上大门。为了无缝地发生这种情况，每个室友都应该知道他是否是最后一个离开房间的人。

# actionscript-3 - 变量 addChild 没有定义？

> ID：725143
> 
> 赞同：3
> 
> 时间：2009-04-07T11:12:39.973
> 
> 标签：actionscript-3, flash-cs3, addchild

我在使用 AS3 时遇到问题 - Flash CS3 给了我此错误消息：错误 #1065：未定义变量 addChild。

有什么想法有什么问题吗？

这是我的代码：

```
package coa.application{
    import flash.display.SimpleButton;
    import flash.text.TextField;
    import flash.text.TextFieldType;

    public class Tab extends SimpleButton {

        public var menuType:String;

        public function Tab(tabText:String, menuType:String) {
            this.menuType=menuType;
            var mytext:TextField=createTextField(0,0,200,20);
            mytext.text=tabText;
        }
        private function createTextField(x:Number, y:Number, width:Number, height:Number):TextField {
            var result:TextField = new TextField();
            result.x=x;
            result.y=y;
            result.width=width;
            result.height=height;
            addChild(result);
            return result;
        }
    }    
} 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-07T11:28:19.203

这是因为 SimpleButton 不是继承自 DisplayObjectContainer 而是继承自 InteractiveObject。

addChild 是来自 DisplayObjectContainer 的方法。SimpleButton 包含 3 个显示对象，用于 3 个状态和 hittest 对象，它们分别命名为 upState、overState、downState 和 hitTestState。

所以你应该能够设置其中之一。

```
//addChild(result);
upState = result; 
```

您可以只向状态添加一个 DisplayObjectContainer（如 Sprite），然后在其中添加 TextField，以防您想向状态添加更多图形。

```
upState = new Sprite();
upState.addChild(new MyButtonBackground()); //Make this class.
upState.addChild(result); 
```

# sql - 左连接中的最新记录

> ID：725153
> 
> 赞同：69
> 
> 时间：2009-04-07T11:13:53.543
> 
> 标签：sql, sql-server, sql-server-2005

想象一下，我在 SqlServer 中有以下 3 个表：

```
Customer (CustomerID, FirstName, LastName)
Address (AddressID, CustomerID, Line1, City, State)
Product (ProductID, CustomerID, Description) 
```

一个客户可以有多个送货地址和多个产品。

我想做的是列出每个州的客户数量，其中州由最近的地址记录确定。例如“每个州有多少客户最后收到产品？”。因此，我对客户以前的任何地址记录都不感兴趣，只对最近的（由 AddressID 确定）感兴趣。

```
State | Number of Customers
--------------------------
CA    | 32
GA    | 12
TX    | 0
OH    | 18 
```

我通常会做类似的事情：

```
SELECT a.State, count(c.CustomerID)
FROM Product p
INNER JOIN Customer c ON c.CustomerID = p.CustomerID
LEFT JOIN Address a ON a.CustomerID = c.CustomerID
WHERE p.ProductID = 101
GROUP BY a.State 
```

但是，由于客户可能有多个地址，客户是否只计入最近地址记录的状态？

PS 以上纯粹是一个示例场景，用于轻松解释我试图实现的连接，并不反映实际的系统设计。

* * *

## 回答 #1

> 赞同：143
> 
> 时间：2009-04-07T11:18:17.743

试试这个：

```
SELECT a.State, count(c.CustomerID)
FROM Product p
INNER JOIN Customer c ON c.CustomerID = p.CustomerID
LEFT JOIN Address a ON a.CustomerID = c.CustomerID 
      AND a.AddressID = 
        (
           SELECT MAX(AddressID) 
           FROM Address z 
           WHERE z.CustomerID = a.CustomerID
        )
WHERE p.ProductID = 101
GROUP BY a.State 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-07T11:15:54.787

您也可以尝试（假设我正确地记住了我的 SQLServer 语法）：

```
SELECT state, count(customer_id)
FROM (
    SELECT
        p.customer_id
        , (SELECT TOP 1 State FROM Address WHERE Address.CustomerID = p.CustomerID ORDER BY Address.ID DESC) state
    FROM Product p
    WHERE p.ProductID = 101)
GROUP BY state 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-07T11:21:37.160

如果没有 Orders 和 OrderDetails 表，我看不出你怎么能做到这一点。Orders 表将包含 CustomerID ShippingDate 和 ShipToAddressID，而 OrderDetails 将包含 OrderID 和 ProductID。然后，您需要一个嵌套查询来确定最近的订单（以及最近的地址），将其与订单详细信息相结合以获取订购的产品，然后过滤您关心的产品。

# php - 带有表单的 PHP 中的 OOP 概念

> ID：725162
> 
> 赞同：2
> 
> 时间：2009-04-07T11:16:55.190
> 
> 标签：php, oop, forms

我知道如何创建类和对象，但我想知道如何在 PHP 中将 FORMS 与 OOP 概念集成。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-07T11:21:22.930

你的问题有点不清楚。至少对我来说。

如果您想了解 (x)html 表单是如何在 PHP 中以 OO 方式实现的，您可能需要查看[Zend_Form](http://framework.zend.com/manual/en/zend.form.html)的代码和手册。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-07T11:19:37.990

如果您想在 PHP 表单中包含一些面向对象的概念，您可以使用“[表单生成和验证类](http://www.phpclasses.org/browse/package/1.html)”。甚至还有一个视频教程；-)。当然，如果您喜欢或编辑现有的，您也可以创建自己的。

以下是该课程的规格：

```
- Multiple inputs may be interconnected in such way that client side events that occur on one input can trigger actions on the context of other inputs. Developers may use input interconnection support without writing Javascript code.
- Can be extended with new types of input controls plug-in classes.
- Custom input plug-in classes can be used to support for handling client site events on the server side without submitting the form or redrawing the whole form page
- Some control plug-in classes are made available:
* AJAX based form submission (without reloading the whole page)
* Auto-complete text inputs
* Select a location on a map using Google Maps API
* Calendar date input
* CAPTCHA test to prevent automated access by robots
* Linked select input to switch select options when the value of another input changes. An unlimited number of selected can be linked in cascade. Additional plug-in subclasses are provided to retrive option groups from a MySQL database or many other SQL databases using the Metabase PEAR::MDB2 PHP database abstraction layer APIs
* Manage animations that apply visual effects to the page form elements, like: fade-in, fade-out, show, hide, update content, etc..
- XHTML compliant output.
- Load submitted form field values even with register_globals option Off and strip slashes when magic_quotes_gpc option is On.
- Keyboard navigation support:
* Attachment of labels with activation keys to each form field.
* Tab navigation order index.
- Built-in server side (PHP based) and client side (Javascript 1.0 or better) field validation for:
* E-mail address
* Credit card numbers (Visa, Mastercard, American Express, Discover, Diners Club, Carte Blanche, enRoute, JCB, any of these or even determined by a select field).
* Regular expressions.
* Field not empty.
* Field equal to another (useful for password confirmation fields).
* Field different from another (useful for reminder fields that must not be equal to the actual password).
* As set (for check boxes, radio buttons and select multiple fields).
* As integer number (with range limitation).
* As floating point number (with range limitation).
* Programmer defined client and server validation functions.
- Highlight invalid fields rendering them distinct CSS styles
- Security attack prevention by optionally discarding invalid values passed in fields that could not be edited by users but may be spoofed by attackers.
- Option to define a value that, when used in a field, it is accepted without performing any of the validations defined for the field.
- Ability to stop the user from submiting a form more than once inadvertdly.
- Sub form validation (validate only smaller set of field depending on the submit button that was used).
- Composition and generation of the form HTML output with fields displayed as fully accessible or in read-only mode.
- Generation of Javascript functions (useful to set to the page ONLOAD event):
* Set the input focus to a field.
* Select the text of a field.
* Set the input focus and select the text of a field.
* Enable and disable input fields
- Automatic capitalization of the text of a field:
* Upper case.
* Lower case.
* Word initials
- Replacement of text field expressions to perform adjustments like trimming whitespace or auto-complete values based on rules defined by regular expressions
- Compose forms with templates using plain HTML files with embedded PHP code or using the Smarty template engine with a supplied pre-filter plugin 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-07T11:23:58.853

您还可以查看[Yii 框架](http://www.yiiframework.com)，它将表单实现为模型（MVC 中的“M”部分）——在我看来，它的开销比 ZF 的表单实现要少得多。

# wpf - ViewModel/View 关系和验证

> ID：725171
> 
> 赞同：6
> 
> 时间：2009-04-07T11:20:20.673
> 
> 标签：wpf, mvvm

在我们的 WPF 应用程序中，我们希望使用基本的 MVVM 模式。我们正在讨论它，出现了一些关于 ViewModel/View 关系和验证的不确定性。你说下面是不是很好理解呢？

*   **每个 View 都有一个且只有一个 ViewModel** ，而 ViewModel 的目的是为其 View 提供数据并处理其 View 的所有事件和命令。（是否存在一个 ViewModel 服务两个 View 的情况，例如一个标准 XAML 输入表单视图和一个 CSV 导入，它提供与表单相同的数据，因此需要进行相同的验证？）

*   **当视图抛出 ChangedFocus 或 SaveButtonPressed 事件等时，**验证仅由 ViewModel 处理。****

***   **模型非常愚蠢**，只是基于数据库中的一个或多个表的数据结构，但模型本身不处理验证，例如。甚至是 ViewModel 建立并持有对象的 ObservableCollection，例如“客户”，而不是模型本身。** 

 **任何反馈表示赞赏。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-07T15:06:56.930

> 每个 View 都有一个且只有一个 ViewModel

我认为，如果您严格遵守该模式，那么每个视图将只有一个 ViewModel。我们的应用程序中有一个案例，其中需求在中途发生变化，让 View 引用两个不同的 ViewModel 是最简单的。根据您实现模式的方式，这可能会也可能不会。

> 是否存在一个 ViewModel 服务两个 View 的情况

是的，这是该模式的优点之一。

> 验证仅由 ViewModel 处理

不必要。我们选择让我们的模型类实现 IDataErrorInfo 并自己进行验证。这确保了无论在何处使用 Model 类，验证都是相同的。如果验证需要更改，它只在一个地方。

> 模型很笨

它只是像你想要的那样愚蠢。如果愿意，您可以在模型中包含验证和业务规则。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-08T05:43:17.230

我同意上面所说的一切。只有一条评论：您的视图模型可以在内部使用另一个视图模型。使用这种方法，您可以将视图划分为几个区域，这些区域由不同的视图模型提供服务。只需使用 ContentPresenter，将其绑定到所需的视图模型属性（获取所需的视图模型）并使用 DataTemplate 将所需的视图与您的视图模型相关联。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-07T11:23:14.033

> 是否存在一个 ViewModel 服务两个 View 的情况

皮肤应用程序可以利用这种能力。

> 模型非常愚蠢，但模型本身不处理验证

该模型可以随心所欲。它可以包括“验证”以确保完整性，但该验证不会包括 UI 中出现的消息。

# javascript - ServerXMLHTTP 错误：找不到窗口类

> ID：725178
> 
> 赞同：0
> 
> 时间：2009-04-07T11:22:00.760
> 
> 标签：javascript, windows, http, serverxmlhttp

当调用是异步的时，我在经典 ASP 下使用来自 JScript 的 MsXml.ServerXmlHttp 对象时遇到错误。错误消息是“找不到窗口类”

* * *

环境为：Windows Server 2003 SP2；IIS v6；经典ASP；脚本

当使用 asynch = true 调用 ServerXmlHttp.open 时，发送方法上会发生错误。当使用 asynch = false 调用 ServerXmlHttp.open 时，不会发生错误

该代码适用于具有所有相同版本的主要产品的测试环境（尽管它并未与生产环境保持相同）

在测试环境中，代码同时使用同步和异步打开

使用 MSXML2.ServerXMLHTTP.6.0 MSXML2.ServerXMLHTTP.4.0 MSXML2.ServerXMLHTTP.2.0 时出现错误

无论 URL 是什么，代码都会以相同的方式失败：google.com 和 stackoverflow.com 就像我需要调用的实际页面一样失败

在测试环境google.com、stackoverflow.com和我需要调用的页面都工作。

无论我使用 GET 还是 POST，都会发生错误

无论标题如何，都会发生错误。

无论协议是 HTTP 还是 HTTPS，都会发生错误。

错误发生得非常快 - 几乎肯定是客户端。

连接同步时不会发生错误。

我已经重新安装了 MSXML6.msi

我已经使用“proxycfg.exe -d”将互联网堆栈配置为不使用代理。( [http://support.microsoft.com/kb/289481/](http://support.microsoft.com/kb/289481/) )

* * *

这是一个指示性代码示例（我已对其进行了简化，因为我认为代码不是问题）：

```
var xmlServerHttp = Server.CreateObject("MSXML2.ServerXMLHTTP.6.0");
xmlServerHttp.open("POST", "http://some-url.com", true); //true causes error

xmlServerHttp.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");

xmlServerHttp.send("some=values&some=othervalues"); //error happens here

var responseXML;
var stateok = false;
var numOfWaits = 10;            
do {
    if (xmlServerHttp.readyState == READYSTATE_COMPLETED) {
     responseXML = String(xmlServerHttp.responseText);
     stateok = true;
    }
    else {
        xmlServerHttp.waitForResponse(1);
    }
 } while (!stateok && --numOfWaits > 0); 
```

此代码在 xmlServerHttp.send 调用中引发错误：“找不到窗口类”。

这就是 MSDN 关于错误的说法 ( [http://msdn.microsoft.com/en-us/library/ms820745.aspx](http://msdn.microsoft.com/en-us/library/ms820745.aspx) )

> 应用程序尝试使用的窗口类不是向系统注册的特定于应用程序的类或预定义的控件类之一（例如 BUTTON、LISTBOX、SCROLLBAR 等）。

此知识库文章 ( [http://support.microsoft.com/kb/303326](http://support.microsoft.com/kb/303326) ) 包含以下异步特定说明：

> ServerXMLHTTP 不使用 Urlmon.dll。但是，当您在异步模式下使用 ServerXMLHTTP 时，您还需要此消息泵，因为解析器通过将消息发送回线程来触发事件。

Urlmon.dll 确实存在于服务器的 system32 文件夹中。但是它在代码以异步模式工作的测试服务器上不存在：S。（我没有明确安装 urlmon.dll - 当我去寻找它时它就在那里。）

我的猜测是服务器上存在一些配置或安装问题。也许缺少 MSXML 依赖。但我不知道如何进一步调查。有没有人有什么建议？

特别是，谁能告诉我：

*   MsXml.ServerXmlHttp 的依赖是什么？

    或者我怎么能弄清楚它们。

*   在这种情况下，错误消息“找不到窗口类”是什么意思？

*   是否有任何特定于异步 HTTP 调用的设置或配置？

感谢您阅读本文。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-06-16T20:28:22.083

带有 COM 对象的 ASP 的单线程特性不允许您像您想象的那样处理异步事件。

有人可能认为这可以通过引用 中声明的事件处理程序来实现`global.asa`，但我怀疑这是否可行。

您的代码完全没有意义，因为您正在尝试完全复制所做的事情`async=false`。您可以使用该方法控制超时`setTimeout()`。

# email - MailMessage.From.DisplayName 与 SmtpClient.Send() 的行为不符

> ID：725181
> 
> 赞同：2
> 
> 时间：2009-04-07T11:22:43.037
> 
> 标签：email, .net-2.0, smtpclient

我正在使用以下代码在 .Net2.0 中发送电子邮件。

```
MailMessage message = new MailMessage();
message.From = new MailAddress("webmaster@mydomain.com", "webmaster@mydomain.com on behalf of someone else");
message.To.Add("someone@anotherdomain.com");
message.IsBodyHtml = true;
message.Body = "some actual html here, not just a string literal"
message.Subject = "Alert email from www.mydomain.com";

SmtpClient client = new SmtpClient("MySmtpClient.com", 25);
client.Send(message); 
```

我遇到的问题是，当我检查我的电子邮件收件箱时，电子邮件的 from 字段显示“webmaster@mydomain.com”而不是“代表其他人的 webmaster@mydomain.com”，即它只显示来自电子邮件地址而不是 DisplayName。

我试过设置和我设置`message.ReplyTo`的一样，`message.From`但这似乎没有什么区别。

我在这里错过了什么吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-07T13:24:39.360

尝试添加发件人标头。

例如：

```
message.Headers.Add( "Sender", "webmaster@mydomain.com" ) 
```

# asp.net-mvc - asp.net mvc webservice，如何从widowsforms应用程序调用？

> ID：725186
> 
> 赞同：0
> 
> 时间：2009-04-07T11:23:40.727
> 
> 标签：asp.net-mvc, web-services

我有一项任务是自动将带有序列化数据的压缩文件从窗口应用程序发送到 Web 应用程序，但我的问题是我不知道具体是怎么做的，我可以从窗口应用程序发送压缩文件到控制器操作，控制器操作将接受该文件并解压缩？可能这些文件会很大，我知道是通过 ftp 服务器还是 asp.net mvc（作为 web 服务）执行此操作

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-07T12:45:27.037

它不会是二进制数据，而是 xml 中的一些数据（很多 xml）。问题是：有人在本地向本地数据库添加一些记录，并且其中一些数据想要上传到网站，我的问题是如何实现该导出/导入？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-07T11:32:07.117

据我所知，ASP.NET MVC 与 Web 服务无关，尽管我想你可以伪造它。

为什么不使用*用于*Web 服务的 WCF？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-07T11:32:31.063

我认为 Web 服务不能很好地处理二进制数据。我相信它必须被编码才能传输，这可以显着增加传输大小。我会推荐一个混合解决方案。

创建一个返回请求文件的票证 ID 的 Web 服务。将票证 ID 传递到 URL 以使用 HTTP 下载文件。

# c# - 导出为 .xlsx

> ID：725190
> 
> 赞同：5
> 
> 时间：2009-04-07T11:24:02.147
> 
> 标签：c#, asp.net, excel

谁能建议将数据导出为 .xlsx 格式的最佳方法。1.动态创建工作表。2.自定义每张表中的数据。我们不能使用办公网络组件。

谢谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-07T11:29:03.520

您应该看看[OpenXML SDK 2.0](http://www.microsoft.com/downloads/details.aspx?FamilyId=C6E744E5-36E9-45F5-8D8C-331DF206E0D0)。

相关博客文章：

*   Stuart Whiteford[使用 Open XML SDK 2.0 创建 Excel 工作簿](http://blog.stuartwhiteford.com/?p=49)
*   [用于 SpreadsheetML 的文档组装解决方案，](http://blogs.msdn.com/brian_jones/archive/2008/11/04/document-assembly-solution-for-spreadsheetml.aspx)作者 Brian Jones

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-07T11:26:15.010

您可以使用第三方组件，例如[Aspose Cells](http://www.aspose.com/categories/file-format-components/aspose.cells-for-.net-and-java/default.aspx)或[XLSIO](http://www.syncfusion.com/products/xlsio/web/default.aspx) (Syncfusion)：

> 使用 Aspose.Cells，开发人员可以轻松打开和保存多种文件格式。其中包括 Excel 97 / 2000 / XP / 2007 (XLSX)、SpreadSheetML、制表符分隔和 CSV 文档。使用 Aspose.Cells，您还可以打开加密的 Excel 文件。甚至可以通过使用另一个 Aspose 产品（即 Aspose.Pdf）和 Aspose.Cells 将 Excel 文档转换为 PDF 格式。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-10-01T03:39:58.307

[Excel Package](http://excelpackage.codeplex.com/) is an open-source (GPL) component for reading/writing Excel 2007 files. I used it on a small project, and the API is straightforward.

The source code also seems well-organized and easy to get around (if you need to expand functionality or fix minor issues as I did).

You can use either approach (customizing a template or creating everything from scratch). Customizing is much easier if you want the result to look nice.

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-08T14:48:58.790

[SpreadsheetGear for .NET](http://www.spreadsheetgear.com/)可以生成 XLS 和 XLSX 工作簿，并包含一个用于自定义/格式化数据的综合 API。

[您可以在此处](http://www.spreadsheetgear.com/support/samples/excel.aspx)查看实时 ASP.NET Excel 报告示例。

免责声明：我拥有 SpreadsheetGear LLC。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-04-19T01:56:54.720

EPPlus 是一个 .net 库，它使用 Open Office Xml 格式 (xlsx) 读取和写入 Excel 2007/2010 文件。

[http://epplus.codeplex.com/](http://epplus.codeplex.com/)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-07T11:54:08.330

还要记住，在许多情况下 .CSV 就可以了。Excel 读得很好。

您只需要一个 XLSX 文件来实现格式设置、多个工作表等纯 Excel 功能 - 对于这些功能，有许多现有的 Excel 1997-2003 生成器库可以生成适用于 Excel 2007 的文件。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2012-04-12T11:27:24.030

您可以使用[EasyXLS](http://www.easyxls.com)将数据导出为 xlsx 文件。可以使用此库为您的报告设置一个很好的格式。

# sql-server - SSAS - 带有“一个”表的多对多维度

> ID：725196
> 
> 赞同：1
> 
> 时间：2009-04-07T11:26:35.697
> 
> 标签：sql-server, ssas

我有一个组织表和一个组织成员表

组织表：|OrgId|名称|...|

组织成员表：|MembershipId|父组织id|子组织id|

这描述了一种组织结构，其中一个组织可以是多个父组织的子组织，而父组织又可以是其他父组织的子组织。

没有像 o1 是 o2 的子级，即 o1 的子级这样的循环引用。

我正在努力将其建模为 SSAS 中的一个维度。是否可以？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-22T11:25:53.623

您正在有效地尝试在单个父子维度中建模多个层次结构。您需要从 Org 表中创建一个普通维度，从 Org 成员表中创建一个父子维度，以及一个将两个 Org 表链接到 Org 成员表的新中间度量值组。

为了避免在此处复制 Marco 的所有版权内容，请阅读[多对多革命](http://www.sqlbi.eu/Default.aspx?tabid=80)并查找“多层次结构”部分。

# sql - 如何选择每组的顶部和底部记录？

> ID：725199
> 
> 赞同：1
> 
> 时间：2009-04-07T11:27:00.203
> 
> 标签：sql, sql-server-2008

说，我在数据库（SQL Server 2008）中有一个表，其中的数据与此类似（但要大得多）：

```
| ID | SCORE | GROUP |
-----------------------
| 10 |     1 | A     |
| 6  |     2 | A     |
| 3  |     3 | A     |
|----|-------|-------|
| 8  |     5 | B     |
|----|-------|-------|
| 4  |     1 | C     |
| 9  |     3 | C     |
| 2  |     4 | C     |
| 7  |     4 | C     |
|----|-------|-------|
| 12 |     3 | D     |
| 1  |     3 | D     |
| 11 |     4 | D     |
| 5  |     6 | D     | 
```

我想获取`ID`each 的顶部和底部记录`GROUP`，其中每个组的记录按`SCORE`（和补充`ID`）排序，如下所示：

```
| GROUP | MIN_ID | MAX_ID  |
----------------------------
| A     | 10     | 3       |
| B     | 8      | 8       |
| C     | 4      | 7       |
| D     | 1      | 5       | 
```

问题是：我怎样才能做到这一点？

到目前为止，我一直在尝试基于该`RANK()`函数的解决方案，但还没有找到一个既能产生正确输出又能模糊有效或可维护的查询。

* * *

*笔记：*

该示例已简化。我的“表”实际上是一个已经很复杂的查询的输出，我希望将最后阶段添加到该查询中。我宁愿只从表中选择一次。

如果可能的话，最好有一个通用的解决方案，让我可以选择`n`每组的顶部和底部值。

s的`ID`顺序不方便。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-07T11:41:24.600

> 如果可能的话，最好有一个通用的解决方案，让我可以选择`n`每组的顶部和底部值。

```
WITH q AS
        (
        SELECT  m.*,
                ROW_NUMBER() OVER (PARTITION BY Group ORDER BY Score) AS rn_asc,
                ROW_NUMBER() OVER (PARTITION BY Group ORDER BY Score DESC) AS rn_desc
        FROM    mytable m
        )
SELECT  *
FROM    q
WHERE   rn_asc BETWEEN 1 AND 10
        OR rn_desc BETWEEN 1 AND 10 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-07T11:36:52.473

```
DECLARE @YourTable TABLE (ID INTEGER, Score INTEGER, [Group] VARCHAR(1))
INSERT INTO @YourTable VALUES (10, 1, 'A')
INSERT INTO @YourTable VALUES (6 , 2, 'A')
INSERT INTO @YourTable VALUES (3 , 3, 'A')
INSERT INTO @YourTable VALUES (8 , 5, 'B')
INSERT INTO @YourTable VALUES (4 , 1, 'C')
INSERT INTO @YourTable VALUES (9 , 3, 'C')
INSERT INTO @YourTable VALUES (2 , 4, 'C')
INSERT INTO @YourTable VALUES (7 , 4, 'C')
INSERT INTO @YourTable VALUES (12, 3, 'D')
INSERT INTO @YourTable VALUES (1 , 3, 'D')
INSERT INTO @YourTable VALUES (11, 4, 'D')
INSERT INTO @YourTable VALUES (5 , 6, 'D') 
```

* * *

```
SELECT [Group], MIN([Min_ID]), MAX([Max_ID])
FROM (
  SELECT [score].[Group], [Min_ID] = [min].ID, [Max_ID] = [max].ID
  FROM (
    SELECT [Group], [Min_Score] = MIN(Score), [Max_Score] = MAX(Score)
    FROM @YourTable
    GROUP BY [GROUP]) score
    INNER JOIN @YourTable [min] ON [min].[Group] = [score].[Group] AND [min].[Score] = [score].[Min_Score]
    INNER JOIN @YourTable [max] ON [max].[Group] = [score].[Group] AND [max].[Score] = [score].[Max_Score] 
  ) yourtable
GROUP BY [yourtable].[Group] 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-07T11:37:19.023

任何解决方案还需要一些关于组和分数的良好索引，但包括 ID

```
SELECT
    foo.[Group],
    m1.ID AS Min_ID,
    m2.ID AS Max_ID
FROM
    (
    SELECT
       [Group], MIN(Score) AS MinScore, MAX(Score) AS MaxScore
    FROM
       mytable
    GROUP BY
       [Group]
    ) foo
    JOIN
    mytable m1 ON foo.[Group] = m1.[Group] AND foo.MinScore = m1.Score
    JOIN
    mytable m2 ON foo.[Group] = m2.[Group] AND foo.MaxScore = m2.Score 
```

但是，在您的示例数据中，这也有效，因为 ID 和分数按顺序对齐：

```
SELECT
    [Group],
    MIN(ID) AS Min_ID,
    MAX(ID) AS Max_ID
FROM
    mytable
GROUP BY
    [Group] 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-07T11:42:26.530

您可以使用子查询 ( `SELECT TOP 1`) ...

# asp.net - 非常简单的缓存 - 这是一个好的技术吗？

> ID：725203
> 
> 赞同：1
> 
> 时间：2009-04-07T11:28:18.873
> 
> 标签：asp.net, caching

我正在使用以下技术来缓存对我的数据库的一些调用——这个函数存在于我的存储库中。

```
Public Shared Function GetByStoreURL(ByVal StoreURL As String) As Model.Partner

        Dim key As String = StoreURL
        If Current.Cache(key) Is Nothing Then
            Dim objPartner = Model.DB.Select().From(Tables.Partner).Where(Partner.Columns.StoreURL).IsEqualTo(StoreURL.ToString).And(Partner.Columns.IsDeleted).IsNotEqualTo(1).ExecuteSingle(Of Partner)()
            Current.Cache.Add(key, objPartner, Nothing, Web.Caching.Cache.NoAbsoluteExpiration, TimeSpan.FromMinutes(60), CacheItemPriority.NotRemovable, Nothing)
        End If

        Return DirectCast(Current.Cache(key), Model.Partner)

    End Function 
```

这种技术有缺陷吗？看起来很简单，看起来效果很好。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-07T11:35:58.870

唯一的问题是如果您想使缓存无效（由于数据更改）并且您正在负载平衡/集群环境中运行。如果这是一种可能性，那么您可以添加文件依赖项，或者查看像 Velocity 这样的分布式缓存系统。

如果您不需要这样做，则无需扩展，并且您不介意拥有潜在的“陈旧”记录，那很好:-)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-07T11:41:31.683

实际上，这里有很多错误，最明显的是违反了[单一责任原则](http://en.wikipedia.org/wiki/Single_responsibility_principle)。基本上，您的函数应该只执行一项严格定义的任务（即`Partner`从数据库中检索 a）。

接下来是多线程。网站本质上是多线程的，因此应该考虑到这一点。`If Current.Cache(key) Is Nothing`更具体地说，可以在调用和之间从缓存中删除一个项目`Return DirectCast(Current.Cache(key), Model.Partner)`。解决此问题需要锁定，但这会使函数更加膨胀（参见第一段）。

此外，可以在执行数据库代码时将项目添加到缓存中。这将导致错误，因为`Cache.Add`不会覆盖具有相同键的值，而该键已经存在（想想多线程）。

最后我质疑 a 的唯一性`StoreURL`。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-07T11:32:03.187

这种技术被称为[延迟初始化](http://en.wikipedia.org/wiki/Lazy_initialization)。是的，它被广泛使用。

# .net - 使用 Facebook Connect 和 .Net 检查会话到期

> ID：725217
> 
> 赞同：0
> 
> 时间：2009-04-07T11:32:41.563
> 
> 标签：.net, facebook

.Net 的 Facebook Connect API 中是否有办法检查会话是否已过期或是否仍然有效？有时我可以收到`userId`但如果我尝试获取任何其他信息，它会告诉我会话已过期，这就是为什么我想在尝试接收 uid 之前检查会话是否已过期（因为我不会如果会话过期，可以使用它）。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-09T20:34:25.493

检查 Auth.getSession 应该返回用户会话是否仍然有效。

如果您使用的是 JS API，则 FB.ApiClient.sessionIsExpired 将为 true。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-01-26T13:53:28.173

`/me`我建议对使用该用户访问令牌的图表进行简单调用。Facebook 将响应令牌状态。见developers.facebook.com/blog/post/500/

# asp.net-mvc - ASP.NET MVC 中控制器名称的语言

> ID：725220
> 
> 赞同：1
> 
> 时间：2009-04-07T11:33:00.393
> 
> 标签：asp.net-mvc, multilingual

我的控制器名称应该使用我的母语还是英文？当前的最佳实践是什么？如果是英语，我如何确保网址保持在我的母语中？

我知道我的 webapp 不会是多语言的，我宁愿不写很多样板。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-07T11:39:12.000

ASP.NET MVC 中的约定是控制器和操作名称与 URI 中的控制器和操作名称相同，除非在特殊情况下，如模棱两可的重载。我认为遵循该约定是一个好主意，即使这意味着控制器和操作名称将使用您的母语，而其余代码将使用英语。如果我被要求调试一个网站，该网站以某种我不懂的语言（如斯瓦希里语）显示，我会发现如果它们反映了斯瓦希里语 URI，则为某个页面找到适当的控制器和操作要容易得多。被翻译成英文。

但是请注意，大多数 Unicode 字符不能出现在 URI 中（没有[Punycode](http://en.wikipedia.org/wiki/Punycode)）。只有 ASCII 字符的受限子集可以出现在 URI 中。有关详细信息，请参阅[规范](http://www.ietf.org/rfc/rfc3986.txt)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-08-04T07:22:15.093

从 SEO 的角度来看，我认为在 MVC 站点所基于的控制器/视图/操作上使用相同的语言是一个很好的标准。

在我的情况下，我有一些基于我的母语瑞典语的网站，为了获得最佳的**搜索引擎优化**和**页面排名，**当我将控制器/视图/操作命名为网站上的内容语言时，我使用相同的语言。

在控制器/视图/操作中，我总是使用英语作为编码和评论语言。

我不知道这是否是最好的方法，但如果您关心**搜索引擎优化**和**页面排名**，感觉这是一个很好的模式。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-07T11:35:44.550

您可以用任何语言（UTF-8）编写控制器和控制器的方法名称，这不是问题。对于只支持一种语言的网站应该没问题。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-07T11:40:59.170

这是您的应用程序，所以当然是您的选择，但如果您有本地语言 URI，那么我也会选择本地语言控制器和操作名称，以确保一致性和易用性。

Jeff Atwood 写了一篇关于软件开发和英语的有趣[帖子（我不确定我是否同意，但它很有趣且相关）。](http://www.codinghorror.com/blog/archives/001248.html)它不会回答你的问题，但值得一读。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-07T11:56:41.753

如果您要让一个国际团队查看您的代码，那么请使用英文名称。如果您要自己完成所有工作，或者让当地人说语言，那么您可以使用当地语言命名。

但请记住，命名约定是针对英语而不是针对当地语言的。所以这是个问题。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-09T13:44:26.363

我的意见可能是尝试在 global.asax 中按语言显式加载路由定义。

常量字符串 DEFAULT_LANGUAGE = "en";

routes.MapRoute("Product_EN", "en/Product/{action}", new { controller="Product", action="Index"} );

routes.MapRoute("Product_FR", "fr/Produit/{action}", new { controller="Product", action="Index"} );

routes.MapRoute("Product_ES", "es/Produto/{action}", new { controller="Product", action="Index"} );

route.MapRoute("Default", "{language}/{controller}/{action}/{id}", new { language = DEFAULT_LANGUAGE, controller="Home", action="Index", id=""}) ;

注意：这些是示例，您应该从全局资源中检索翻译后的名称。

但是随后我们被迫在您的视图中引用正确的路由名称以使用 RouteActions。无论如何，这是一种解决方法，但允许您将 URL 翻译到您的网站中，例如：

www.mysite.com/produit/afficher www.mysite.com/product/show ...

我希望它有帮助，干杯

弗雷德。

# .net - 如何使用 RDLC 在 PDF 中嵌入字体

> ID：725226
> 
> 赞同：8
> 
> 时间：2009-04-07T11:34:45.940
> 
> 标签：.net, pdf, fonts, embed, rdlc

我正在使用 Microsoft.Reporting.WebForms.LocalReport 生成一些 PDF，一切都像魅力一样，但现在邪恶的营销想要使用自定义字体（他们正在使用诸如“企业身份”之类的疯狂论点）。

我已经环顾四周了，现在我知道了

*   我需要 ReportViewer 2008 SP1 或更高版本
*   字体必须标记为允许嵌入
*   字体必须是 TrueType

但它仍然不起作用。我相信 RDLC 不支持此功能，有人知道是否是这种情况吗？不幸的是，我无法使用服务器端报告，因为我缺少报告服务器。

蒂亚

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2012-08-03T07:55:55.113

嵌入字体适用于 Microsoft Reporting 2010 或更高版本，以下限制仍然适用

*   字体必须标记为允许嵌入
*   字体必须是 TrueType 类型

您可能会遇到字体被嵌入但 PDF 仍以 Arial 显示文本的问题。这发生在我在 Windows Server 2008 R2 上安装了一些新字体后，重新启动 AppPool (ASP.NET MVC) 并没有解决这个问题，需要重新启动服务器。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-07-08T15:52:38.393

我在 Visual Studio 2008 中使用 Arial Narrow 字体做了一个简单的测试，效果很好。我已经在没有字体的虚拟 XP 机器上测试了生成的 PDF，并且渲染正常。可能是字体的问题？

嗯，也许是这个——在我的测试中，我使用了 Winforms.LocalReport 而不是 WebForms。也许这就是诀窍？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2015-04-29T16:10:00.043

我遇到了同样的问题，但我发现不需要嵌入字体。问题在于 HTML 中的 Font Face 属性。我们使用的 HTML 编辑器生成 Font 标签，如下所示：

```
<font face="Impact,Charcoal,sans-serif" size="6">Impact </font> 
```

这对于报告查看器来说很好，但要生成 PDF 文件，它需要如下所示：

```
<font face="Impact" size="6">Impact </font> 
```

所以我添加了代码来替换绑定到报告之前的属性值：

```
htmlValue = htmlValue.Replace("Impact,Charcoal,sans-serif", "Impact")
               .Replace("Arial,Helvetica,sans-serif", "Arial")
               .Replace("Georgia,serif", "Georgia")
               .Replace("Verdana,Geneva,sans-serif", "Verdana")
               .Replace("'Courier New',Courier,monospace", "Courier New")
               .Replace("'Lucida Console',Monaco,monospace", "Lucida Console")
               .Replace("Tahoma,Geneva,sans-serif", "Tahoma")
               .Replace("'Times New Roman',Times,serif", "Times New Roman")
               .Replace("'Trebuchet MS',Helvetica,sans-serif", "Trebuchet MS"); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2019-03-02T11:48:14.247

*   字体必须标记为允许嵌入
*   字体必须是 TrueType 类型
*   将您的字体添加到 Windows 服务器字体

如果您执行上述所有操作并且字体未显示在 Pdf 报告 RDLC 文件中，

也许你必须重新启动服务器，它对我有用

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2020-03-28T02:53:12.463

为了补充 marc.d 的出色答案，我可以确认在我的情况下我还必须完全重新启动服务器。我还要补充一点，检查字体是否可嵌入的方法是执行我在下面描述的两种方法之一。

**方法1）如果您的字体已经安装**

在 Windows 资源管理器中浏览到 C:\Windows\Fonts\，找到您感兴趣的字体。请注意，同一家族中的字体将被组合在一起，因此您需要双击一个组才能导航到单独的字体文件。在资源管理器窗口底部的属性列表中，您将看到“可嵌入性”： [![在此处输入图像描述](https://i.stack.imgur.com/hxGRn.png)](https://i.stack.imgur.com/hxGRn.png)

**方法 2) 如果您在其他位置有 TTF 文件**

使用 Windows 资源管理器，打开文件属性并切换到详细信息选项卡： [![在此处输入图像描述](https://i.stack.imgur.com/d0vS4.png)](https://i.stack.imgur.com/d0vS4.png)

您可能会看到的字体可能值为：

*   无嵌入 - 字体供应商不允许嵌入。这些字体非常罕见。
*   打印和预览 - 字体供应商允许嵌入，但文档被锁定且无法编辑。大多数第三方字体都有此设置。
*   可编辑——字体供应商允许将字体嵌入到文档中，并允许使用嵌入的字体编辑文档
*   可安装 - 这是最宽松的设置。字体供应商允许将字体嵌入文档中，并允许文档查看应用程序将字体永久安装在用户的计算机上。大多数应用程序将这些字体视为设置为可编辑嵌入的字体。

来源：[https ://www.microsoft.com/en-us/microsoft-365/blog/2015/07/06/document-font-embedding-demystified/](https://www.microsoft.com/en-us/microsoft-365/blog/2015/07/06/document-font-embedding-demystified/)

# blackberry - 您在 BlackBerry AppWorld 上启动应用程序的经验？

> ID：725227
> 
> 赞同：7
> 
> 时间：2009-04-07T11:34:52.227
> 
> 标签：blackberry, mobile, appworld

我正在寻找一些在 BlackBerry AppWorld 上启动移动应用程序的经验。我很快就会推出一个，我想确保我可以避免任何潜在的陷阱。

你有什么问题吗？如果是这样，您或 RIM 很容易解决这些问题吗？你还能提供什么样的其他建议？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-14T02:14:15.690

不是我自己的经验，但这是最近读到的一个有趣的东西：[黑莓应用商店，200 美元不要过关，不要上传应用程序。](http://weblogs.asp.net/bsimser/archive/2009/04/01/blackberry-app-store-200-do-not-pass-go-do-not-upload-application.aspx)

它谈到了将应用程序放入商店所涉及的成本。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-04-10T08:49:14.540

提交黑莓手机应用程序后，需要超过 3 周的时间才能获得批准，同时提交的黑莓 playbook 应用程序只需一天时间即可获得批准。我认为现在它更专注于剧本应用程序。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-20T16:05:08.227

我们大约在 2 周前提交了我们的应用程序，它仍在等待审核。

# java - Quartz 调度程序不显示 Log4j 消息

> ID：725228
> 
> 赞同：3
> 
> 时间：2009-04-07T11:35:07.640
> 
> 标签：java, logging, log4j, quartz-scheduler

我正在尝试配置我的 Quartz 调度程序以支持日志记录。我曾尝试执行以下操作：

在我的应用程序的 classes 文件夹中添加了 log4j.xml。相同的代码是：

```
log4j.appender.stdout=org.apache.log4j.ConsoleAppender
log4j.appender.stdout.Target=System.out
log4j.appender.stdout.layout=org.apache.log4j.PatternLayout
log4j.appender.stdout.layout.ConversionPattern=
    %d{ABSOLUTE} %5p %c{1}:%L - %m%n
log4j.rootLogger=debug, stdout 
```

在我的调度程序类中添加了以下语句：

```
static Logger logger = Logger.getLogger("QuartzReport.class");
logger.info("Info"); 
```

但是，控制台会在启动时显示以下消息：

```
log4j:WARN No appenders could be found for logger 
    (org.quartz.simpl.SimpleThreadPool).
log4j:WARN Please initialize the log4j system properly. 
```

请告诉我是否缺少某些东西。

问候， 伊布

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-07T12:41:58.213

你基本上错过了两点：

1.  您的配置文件是属性文件，而不是 XML。所以你应该把它保存为'log4j.properties'；
2.  确保第 1 项中提到的文件位于应用程序的类路径中（假设正在使用最近的 log4j 实现）。

祝你好运，

道格拉斯

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-07T16:33:27.330

还尝试使用此行更新您的 log4j 配置

log4j.logger.org.quartz=调试，标准输出

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-13T12:13:14.800

`QuartzReport`您可以使用配置文件（您的属性文件）以编程方式（如在您的类的 main 方法中）配置您的代码。

较新版本的 Log4j 将尝试加载`log4j.properties`从您的类路径命名的文件并使用它来自动配置您的记录器。

在您的情况下，该`BasicConfigurator.configure()`调用将覆盖您的属性文件中的任何定义（即，您的属性文件被忽略）。并且日志显示的输出尊重您在`PatternLayout`构造函数中提供的模式。更多关于如何定义这种模式的细节可以在[`PatternLayout`类文档](http://logging.apache.org/log4j/1.2/apidocs/org/apache/log4j/PatternLayout.html)中找到。

# apache - 网站部署

> ID：725229
> 
> 赞同：-4
> 
> 时间：2009-04-07T11:35:08.920
> 
> 标签：apache

我正在开发移动网站。我可以将它部署在 IIS 服务器中。我可以在 Apache 服务器中部署相同的内容吗？

谢谢！！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-07T11:39:17.037

这取决于您使用的是什么语言/框架？例如，您可以在 ISS 和 Aapche 上运行 PHP，但通常答案是否定的。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-07T11:40:11.060

取决于您使用的技术。如果您使用的是 ASP/ASP.NET，那么您不能使用 Apache，因为 Apache 不支持 ASP/ASP.NET 脚本/编程语言。

另一方面，如果您的应用程序不使用服务器端技术（尽管我对此表示怀疑），那么 Web 服务器就无关紧要了。

如果您使用的是服务器端技术，例如 php 或 perl，您可以将应用程序移植到任一 Web 服务器上，因为这两种技术在任一服务器上都可用。

# c# - 从 Windows 服务打印报告

> ID：725234
> 
> 赞同：2
> 
> 时间：2009-04-07T11:37:18.477
> 
> 标签：c#, pdf, windows-services, printing, reporting

我们需要定期从 Windows 服务打印报告，我们使用 .NET 2.0。
我们有模块可以将此报告生成为 PDF 或 HTML 文件，PDF 会更好，因为我们可以更好地控制报告的外观。
我们还有为任务选择的用户名、密码和打印机名称。我搜索并研究了几个关于如何从 Windows 服务打印 PDF 文件的选项，即从命令行使用 Acrobat Reader 并且无法使其工作。
Acrobat Reader 似乎不可靠且难以使用，我们还需要保证它安装在我们的客户机器上。
您对此是否有解决方案，可能在第三方组件中？

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-07T12:03:50.380

您可能已经或可能没有看到我[在此处](https://stackoverflow.com/questions/233842/programmatically-printing-in-adobe-reader-9-using-net-interop)提出的有关此问题的问题，如果您毕竟被迫使用 Acrobat，它可能会给您一些提示。

否则这个商业第三方组件会做你想做的 - [abcpdf](http://websupergoo.com/abcpdf-11.htm)。顺便说一句，它是线程安全的。

PS 你需要专业版，因为只有专业版支持渲染。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-18T10:09:43.653

[我们发现了这个名为pdfprint#](http://sourceforge.net/projects/pdfprn/)的开源库中隐藏的明珠，它可以满足我们的需要。
它似乎基于[XPDF](http://foolabs.com/xpdf/)，它是 C++ 中的一个开源库。
作者在论坛中写道：“打印机*必须具有*postscript 功能，图书馆将原始 postscript 发送到打印机。” 我想知道（并担心）这将是一个多大的问题......
谢谢大家的帮助！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-07T12:07:39.217

你能执行命令行工具吗？（当您使用的是应用程序而不是网站（hta 也应该工作））

如果是这样，也许将 Crystal Reports（将导出类型设置为 PDF）与免费导出工具（在 Google 上搜索 crexport）结合使用是一个很好的解决方案。

还有很多 .NET 的 PDF 导出组件，也许编写自己的命令行应用程序就足够了？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-09T05:25:21.243

这是我从我们的客户那里听到的一个非常常见的场景，他们使用[ActiveReports](http://www.datadynamics.com)来运行报告并从服务中打印出来。使用 ActiveReports 的另一个好处是，除了能够打印报告之外，您还可以将相同的报告保存为 PDF、HTML 或 Excel，而不必对报告进行任何更改。

```
Scott Willeke
Data Dynamics / GrapeCity 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-15T07:34:22.820

如果您使用的是 Crystal Reports，那么您可以使用 Crystal Report 的内置选项使用这样的代码打印报表。

```
oReport.PrintOptions.PrinterName = "PrinterName";
oReport.PrintToPrinter(1, true, 0, 0); 
```

或者您可以在此处列出另一个选项[如何将原始数据发送到打印机](http://support.microsoft.com/kb/322091)

# rdf - 什么是语义网？

> ID：725261
> 
> 赞同：49
> 
> 时间：2009-04-07T11:42:22.180
> 
> 标签：rdf, semantics, semantic-web, sparql

我听说过很多关于语义网的信息，但我仍然不确定它是什么。它与我们现在所知道的网络有何不同？

* * *

## 回答 #1

> 赞同：41
> 
> 时间：2009-04-07T12:37:28.473

最好的解释是举例。尝试[使用谷歌搜索](http://www.google.co.uk/search?q=all+cars+advertised+on+the+web+with+engines+smaller+than+2.0+litres+that+run+unleaded%2C+and+have+an+mp3+connection+and+can+been+seen+in+a+showroom+conveniently+accessible+by+public+transport+from+my+house)所有在网络上宣传的汽车，这些汽车的发动机小于 2.0 升，无铅运行，有 mp3 连接，并且可以在从我家乘坐公共交通工具方便到达的陈列室中看到。

谷歌将无法帮助您进行该查询，不是真的。您必须自己进行多次搜索并关联结果。在语义网络上，您可以表达对汽车销售产品的兴趣，并添加约束。每个结果都会很有用。一个或多个 UI 可能使您能够做到这一点，有些可能是专门的，有些则完全通用。

另一个例子，创建一个通常不存储在一个地方的东西的图表，比如健怡可乐的受欢迎程度，或者人群中的乡村散步与同一人群中的临床肥胖水平。对于这些，您可能根本不使用 Web 浏览器，但可能会使用[更像 Excel 的东西](http://www.gapminder.org/)- 但语义 Web 为您提供了工具（SPARQL、RDF），用于查找和操作现有数据并且可通过 HTTP 访问。

因此，Bravax 提出的观点并不完全正确，不会有太大变化——您可能只是获得了一些更有用和更好的 mashup 网站。或者，您可能会发现自己做了很多在今天之前从未想过与网络相关的事情。

当前的网络有很多替代方法可以做同样的事情，比如动画 GIF、Flash、Silverlight、DHTML 等。为了将数据放在语义网络上，会有一系列工具和格式。RDFa 是一个很好的，一种更通用的微格式，但是您可以[提供](http://sw.deri.org/2007/07/sitemapextension/)整个数据库的转储，公开[SPARQL 端点](http://www.w3.org/TR/rdf-sparql-protocol/)，使用微格式或专有的 HTML 结构并[添加转换](http://www.w3.org/2001/sw/grddl-wg/doc29/primer.html)，会有很多工具来适应不同的案例。

所以 Vartec 也是部分正确的，你可以使用 RDFa 和 eRDF，但你也可以使用很多其他的东西来发布数据。

[请注意，语义网络和另一个称为关联数据](http://www.ted.com/index.php/talks/tim_berners_lee_on_the_next_web.html)的简单概念之间有很多重叠之处。它们之间的关系尚不清楚，但我的看法是，在语义 Web 工具和技术有任何作用之前，您需要链接数据网络。关联数据是关于数据的，语义网更多的是关于处理数据、对其进行推理以及处理诸如信任可靠性之类的问题。[本质上是技术栈](http://en.wikipedia.org/wiki/Semantic_Web_Stack)的底层几层。

* * *

## 回答 #2

> 赞同：37
> 
> 时间：2009-04-07T11:42:48.573

> 它与我们现在所知道的网络有何不同？

现在 HTML+CSS 更多地集中在结构和表现上。语义是关于信息的**含义**。在语义网中，您使用共享[本体](http://en.wikipedia.org/wiki/Ontology_(information_science))来建立对象的含义（语义）和对象之间关系的含义。最著名的本体是：[FOAF](http://en.wikipedia.org/wiki/FOAF_(software))和[Dublin Core](http://en.wikipedia.org/wiki/Dublin_core)。

通常语义会用专门的语言来表达，例如[RDF](http://en.wikipedia.org/wiki/Resource_Description_Framework)或[OWL](http://en.wikipedia.org/wiki/Web_Ontology_Language)。[可以使用eRDF](http://en.wikipedia.org/wiki/Embedded_RDF)或 W3C 的[RDFa](http://en.wikipedia.org/wiki/RDFa)将 RDF 嵌入到 XHTML 中。

eRDF/RDFa 的结构较少的替代方案是[微格式](http://microformats.org/wiki/microformats)。

阅读更多： [http ://en.wikipedia.org/wiki/Semantic_web](http://en.wikipedia.org/wiki/Semantic_web)

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2009-04-07T12:44:38.893

语义网本质上是一个非常简单的想法。（就像所有的好人一样。）

目前的 Web 由文档组成，文档之间有链接。谷歌通过使用上下文和链接中的锚文本来确定链接的含义并基于此构建用于检索数据的引擎，从而取得了相当不错的业务。换句话说，谷歌猜测链接的语义是什么。

语义网的想法是“如果输入这些链接会怎样？” *Web 上的每个事实都有一个地址 - 一个 URI - 并通过关系（也是*URI）链接到其他事实（也是URI）。关系组称为“本体”。

因此，与当前 Web 上的 A 页面链接到 B 页面不同，语义 Web 上的链接更像：

URI A 使用 URI C 类型的链接链接到 URI B。

任何东西都可以有一个 URI。人们可以有 URI；通常我们使用一组称为 FOAF 的关系来描述它们。假设 Jeff Atwood 的 URI 是[http://codinghorror.com/foaf.xml](http://codinghorror.com/foaf.xml)；那么你可以说：

< [http://codinghorror.com](http://codinghorror.com) >< [http://xmlns.com/foaf/0.1/homepage](http://xmlns.com/foaf/0.1/homepage) >< [http://codinghorror.com/foaf.xml](http://codinghorror.com/foaf.xml) >

即[http://codinghorror.com](http://codinghorror.com)是 http://codinghorror.com/foaf.xml 的内容所代表的人的[主页](http://codinghorror.com/foaf.xml)。

现在机器可以读取和查询这些关系——因此您可以将 Web 变成计算机可以立即使用的数据库。Semantic Web 查询语言是 SPARQL，值得一试。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-06-23T06:48:54.147

语义网就是这样——位于万维网之上的语义（有意义的）层。它是半结构化的 (RDF)，它是自描述的（使用 OWL 的本体），并允许资源发现 (SPARQL)。

语义网在“开放世界”假设的前提下工作；仅仅因为没有说明某事并不意味着它不存在，它只是“未知”。这与 MySQL 等 RDBMS 中使用的逻辑完全不同。- 如果缺少某些东西，它就不存在 - “封闭世界”假设。Prolog 和 DATALOG 是 Close World 逻辑的好例子。

如果你想真正了解底层发生了什么，你需要看看它的基础，它位于描述逻辑中。可以在这里找到描述逻辑的一个很好的概述：http: [//www.inf.unibz.it/~franconi/dl/course/](http://www.inf.unibz.it/~franconi/dl/course/)

如果您想了解有关 RDF 的更多信息，请阅读[RDF Primer](http://www.w3.org/TR/rdf-primer/)。[RDF Semantics](http://www.w3.org/TR/rdf-mt/)是另一本轰动一时的读物。

研究人员基本上已经放弃了语义网的“语义”部分，并决定专注于关联数据——如何导航 RDF 三元组，以便我们可以浪费更多的互联网带宽；-)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-07T11:46:22.967

目前，对于 HTML 页面，我们有标记标签来描述应该如何显示内容，`<b>`, '`<pre>`等。这些标签对它们的内容没有任何意义。

语义网的概念是文档将包含确实暗示其内容含义的 XML 标记。例如`<person><firstname>`. 伟大的想法是 CSS 将能够格式化此类文档，但也可以轻松地从这些文档中提取有意义的信息。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-04-07T15:49:32.443

语义网是万维网的发明者蒂姆·伯纳斯-李（Tim Berners-Lee）真正想要的万维网——即相互关联的数据的全球图。它是[社交图谱的概括](http://dig.csail.mit.edu/breadcrumbs/node/215 "TimBL：巨大的全球图")，您可以在其中使用社交数据（使用诸如[FOAF](http://xmlns.com/foaf/spec/#sec-glance)之类的词汇表）以及任何其他类型的机器可理解的数据并将它们相互连接。向机器描述此信息的标准格式是资源描述格式 ( [RDF](http://www.w3.org/TR/2002/WD-rdf-concepts-20021108/#section-Introduction) ) 和 Web 本体语言 ( [OWL](http://www.w3.org/TR/2004/REC-owl-features-20040210/#s1 "猫头鹰简介") )。Web 上已经有很多编码数据，包括一个 RDF 版本的 Wikipedia，称为[DBPedia](http://dbpedia.org/About)。

语义网将不同于今天的网络，因为计算机和人类都将理解文档包含什么以及文档之间链接的重要性。这将促进信息处理任务的自动化，包括从可靠来源研究信息。[完整的 SemWeb 堆栈](http://upload.wikimedia.org/wikipedia/en/3/37/Semantic-web-stack.png)包括密码学、证明系统和信任网络。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2012-08-27T10:37:26.617

[Tim Berners-Lee](http://en.wikipedia.org/wiki/Tim_Berners-Lee)在他的博文[Giant Global Graph](http://dig.csail.mit.edu/breadcrumbs/node/215)（从 2007-11-21）中描述了它：

三个心理动作：

1.  **互联网**：“有趣的不是电缆，而是计算机”
2.  （**万维网**）**网络**：“有趣的不是计算机，而是文档”
3.  **Giant Global Graph**：“重要的不是文件，而是文件所涉及的内容”

关于“巨型全局图”一词：

> 现在，我们可以使用 Graph 一词来与 Web 区分开来。
> 
> 我将此图称为语义网，但也许它应该是巨型全球图！比 WWWW 还差吗？;-) “语义网”这个术语已经建立了很长时间，我不打算改变它。但是让我们想想它是什么图。（脚注：“Graph”也恰好是 RDF 规范使用的词，但顺便说一下。当 XML 解析器创建 DOM 树时，RDF 解析器在内存中创建 RDF 图。）

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2013-06-21T09:17:59.280

语义网是迄今为止提出的修复万维网固有设计缺陷的唯一实用解决方案。因为正如我们今天所知，互联网的设计者并没有提供机制来解决支配人类思考和交流方式的基本语言现象，例如同音异义词、同义词等。在互联网上搜索信息会导致大量虚假信息积极的一面。语义网的想法归结为为网络资源分配明确的标识符，这将有助于正确识别它们的含义。如果有一天它成功了，我们可能会忘记通常的谷歌搜索是什么样子的，如果它失败了，一切都将保持现在的状态。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-04-07T11:52:21.390

这是一个吸引人们兴趣的流行语，类似于Web 2.0

即在未来的内容将从演示中分离出来，允许很多好处。
实际上，事实将是主观的，取决于主持人的真实性和权威性。

换句话说，从现在开始，用户不会看到太大的不同。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-04-07T13:44:33.180

语义网是一个分布式信息系统，其中相互关联的数据通过 HTTP 以 RDF 三元组的形式发布。RDF 三元组由主语、谓语和宾语组成，但可以附加其他东西，例如关于对象自然语言的数据类型和注释。在语义 Web 上，URI 既用作标识符，也用作网络资源的地址。

它与 Web 不同，因为 Web 是文档和应用程序接口的分布式信息系统。

# ping - 无法实时比较 ping 时间

> ID：725269
> 
> 赞同：0
> 
> 时间：2009-04-07T11:43:35.513
> 
> 标签：ping

我尝试了以下命令失败

```
sdiff <(ping www.nato.int) <(ping www.reuters.com) 
```

**有什么办法可以实时比较ping时间？**

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-07T11:59:27.473

怎么样：

`watch 'ping -c 4 www.google.com; echo; ping -c 4 www.yahoo.com'`

给出如下结果：

```
每2.0s：ping -c 4 www.google.com；回声; ping -c 4 www.yahoo.com 2009 年 4 月 7 日星期二 13:57:47

PING www.l.google.com (74.125.39.105) 56(84) 字节数据。
来自 fx-in-f105.google.com (74.125.39.105) 的 64 个字节：icmp_seq=1 ttl=248 time=8.06 ms
来自 fx-in-f105.google.com (74.125.39.105) 的 64 个字节：icmp_seq=2 ttl=248 time=8.47 ms
来自 fx-in-f105.google.com (74.125.39.105) 的 64 个字节：icmp_seq=3 ttl=248 time=8.37 ms
来自 fx-in-f105.google.com (74.125.39.105) 的 64 个字节：icmp_seq=4 ttl=248 time=8.19 ms

--- www.l.google.com ping 统计 ---
4个包发送，4个接收，0%丢包，时间2999ms
rtt 最小值/平均值/最大值/mdev = 8.061/8.276/8.478/0.196 毫秒

PING www-real.wa1.b.yahoo.com (87.248.113.14) 56(84) 字节数据。
来自 f1.us.www.vip.ird.yahoo.com (87.248.113.14) 的 64 个字节：icmp_seq=1 ttl=56 time=43.3 ms
来自 f1.us.www.vip.ird.yahoo.com (87.248.113.14) 的 64 个字节：icmp_seq=2 ttl=56 time=44.3 ms
来自 f1.us.www.vip.ird.yahoo.com (87.248.113.14) 的 64 个字节：icmp_seq=3 ttl=56 time=42.4 ms
来自 f1.us.www.vip.ird.yahoo.com (87.248.113.14) 的 64 个字节：icmp_seq=4 ttl=56 time=43.0 ms

--- www-real.wa1.b.yahoo.com ping 统计 ---
4个包发送，4个接收，0%丢包，时间2999ms
rtt min/avg/max/mdev = 42.422/43.277/44.301/0.728 ms

```

你需要减去ping时间吗？它必须并排（有点烦人）吗？你理想的输出格式是什么？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-07T12:10:45.607

您可以使用 perl/python/php/otherlang 和 time 来执行此操作，例如打开连接到端口 80 所需的时间。您可以将其存储到变量中，然后将其用于数学分析。

在伪代码中是这样的：

```
$site1_start = get_timestamp();
$sock = opensocket($someAddress,$required_port);
if($sock) { $sock->close(); };
$site1_end = get_timestamp();
$site1_round_trip = $t2 - $t1

$site2_start = get_timestamp();
$sock = opensocket($someAddress);
if($sock) { $sock->close(); };
$site2_end = get_timestamp();
$site2_round_trip = $t2 - $t1

// now we can perform some stuff on the round trips 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-20T19:36:33.580

通常我只是并排打开两个 xterm 并在每个中运行 ping。或在一个终端“ping host1 & ping host2&”

fping -e 将在一次运行中为您提供主机列表的延迟。所以你可以这样做：看 fping -e www.google.com www.yahoo.com www.kernel.org

不是每个人都有手表，但你可以这样做（然后你可以看到历史）：while :; 约会；fping -e www.google.com www.yahoo.com www.kernel.org; 睡觉1；完毕

输出仍然很难看，并不是每个人都安装了 fping ..

如果您想产生体面的输出，这是一个开始。只需给它一个主机列表作为参数。

```
#!/usr/bin/perl
use strict;
use warnings;
use POSIX;

for(;;) {
    print strftime("%T:", localtime);
    foreach my $host (@ARGV) {
        my $a=`ping -c 1 $host`;
        my $latency;
        if($a =~ /rtt.* =\s+([\d.]+)\//s) {
            $latency=$1;
        } else {
            $latency="(dropped)";
        }
        print "$host:$latency\t";
    }
    print "\n";
    sleep(1);
} 
```

# asp.net - IIS Web Farm 的防弹会话

> ID：725272
> 
> 赞同：5
> 
> 时间：2009-04-07T11:44:59.270
> 
> 标签：asp.net, iis, state

大家下午好。

我们目前正在从一台 Web 服务器跳转到两台，为了向我们的用户提供无缝故障转移，我们需要对会话做一些事情。

目前，我们正在研究三种不同的方法。

1.  使用状态服务器
2.  使用 SQL 服务器
3.  把所有东西都塞进隐藏的领域

我个人希望看到选项一到位，因为我们没有选项二的专用数据库，选项三似乎是一个混乱的黑客。

我目前面临的问题是我的经理对状态服务器提供的单点故障不满意（我们的 SQL 服务器是复制的，所以那里没有问题）。

关于复制状态服务器或类似的东西可以做些什么吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-07T20:47:16.037

这可能会很痛苦，但我决定关闭 Session 并处理后果。到目前为止，没有什么不可逾越的事情发生。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-08T08:00:06.213

经过进一步调查，我们决定使用 StateServer 选项。我们仍在寻找如何克服 StateServer 上的单点故障，并且我们已经找到了两个进一步的调查途径。

我们的第一个选择是使用第三方程序来处理会话。我们现在正在研究的一个称为[nCache](http://www.alachisoft.com/ncache/ncache_express.html)：我认为还有另一个称为 ScaleOut，我们也可以看看。

第二个选项是使用会话状态分区，我们目前也在研究这个选项：http: [//msdn.microsoft.com/en-gb/magazine/cc163730.aspx](http://msdn.microsoft.com/en-gb/magazine/cc163730.aspx)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-07T12:43:03.047

据我所知，没有办法备份或复制您的 StateServer 服务。在 Web 场中使用 StateServer 时的另一个问题是，如果您的集群允许相同的浏览器在不同的请求上访问不同的机器，那么它们在每个请求上可能有不同的会话数据！（编辑：Martin 在下面指出，您可以通过在多个 Web 服务器之间共享单个 StateServer 实例来解决此问题）。出于您的目的，选项 2 或 3 会更容错，我将提出另一个想法：对于小块数据，请尝试使用 cookie 进行会话存储。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-07T20:36:07.730

我认为您正在转向另一种架构：多个前端 IIS。

你会用NLB吗？

*   如果是这样，您最好的选择是使用状态服务器，它在概念上将充当应用程序服务器。

在我的公司，我们正在将 .NET 应用程序迁移到两个具有网络负载平衡的 IIS，并且应用程序用于在 proc 中进行会话管理。

我们调查过还有另一种选择：

*   在 NLB 配置中使用客户端关联，允许回发返回到生成进程的 IIS，代价是失去所有 NLB...

在 Microsoft 咨询之后，最好的选择是 State Server :)

希望能帮助到你！

最好的祝福！

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-07T20:27:41.307

还要确保您没有使用 SQL Server 来存储仅来自数据库的会话状态。如果是这样，您还不如每次都调用数据库。

# .net - 使用反射来确定程序集模块类型

> ID：725273
> 
> 赞同：1
> 
> 时间：2009-04-07T11:45:03.717
> 
> 标签：.net, reflection, .net-assembly

如何使用 .net 反射来确定执行程序集的类型，我的意思是 dll 或 exe。目前它可以做类似的事情：

`Assembly.GetExecutingAssembly().CodeBase.ToLower.EndsWith(".exe")`

但似乎存在不需要进行字符串比较的更好的东西，即比较程序集模块名称也属于这一类。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-07T11:51:13.953

不是 100% 确定这一点，但我认为这`Assembly.EntryPoint`对于 DLL 来说是空的。

# .net - ServiceController 所需权限

> ID：725279
> 
> 赞同：0
> 
> 时间：2009-04-07T11:47:58.390
> 
> 标签：.net, privileges, servicecontroller

我正在使用 ServiceController 在远程机器上启动服务。当我想查询该机器上的服务时，出现以下异常：

无法在计算机“机器名”上打开服务控制管理器。此操作可能需要其他权限。

查询/启动/停止远程机器上的服务需要什么权限？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-07T11:51:43.093

行政人员

# c# - PHP 网络服务器连接到同一台服务器上的 C# 程序——我在找什么？

> ID：725286
> 
> 赞同：0
> 
> 时间：2009-04-07T11:50:07.997
> 
> 标签：c#, php, sockets

所以我有一个网络服务器，用户可以在其中远程控制一个外部电子板，由于某些条件迫使我使用 C# 作为中间人放置一个桌面程序。

我正在寻找的神奇关键字是什么？起初我想到了套接字，但每个套接字搜索都涉及通过 TCP 的服务器-客户端......它是同一台机器，所以理论上我可以输入环回地址并正常进行。但这是一种矫枉过正的方式还是唯一的方式？

提前致谢。

编辑：我的 C# 程序基本上是一个守护进程，它将等待来自 PHP 脚本的命令。所以我可以远程访问该网站并指示该 C# 应用程序。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-07T12:57:35.680

我建议使用 TCP/IP（甚至 UDP）（或其他 MS 消息传递协议）的客户端/服务器架构，以便与您的 C# 程序通信。您实际上正在做的是为专门的硬件编写设备驱动程序。通过使其成为客户端/服务器，您可以：

*   将代码转换为 Windows 服务，该服务可以在您的 Web 服务器可以连接的任何机器上运行，而不仅仅是本地机器。
*   轻松让服务器处理多个连接，以便您的 Web 服务器以外的客户端可以访问硬件，并以合理的方式处理访问争用。想想用于调试/测试硬件的测试控制台。
*   在您的简历中添加一条关于编写客户端/服务器系统和 Windows 服务的酷行！
*   可能还有一些我现在想不到的其他好处:-)

**编辑**

*   如果用心编写，您还可以将服务抽象为同时处理多个设备

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-07T12:10:04.343

我不是 100% 确定你的意思。我假设您想从 php 脚本中调用 C# 应用程序。如果是这样，也许这会有所帮助：

```
function execute($command, $stdin) {
    $pipes = array();
    $process = proc_open($command, array(array('pipe', 'r'), array('pipe', 'w'), array('pipe', 'w')), $pipes);
    if ($stdin) fwrite($pipes[0], $stdin);
    fclose($pipes[0]);
    $stdout = '';
    while(!feof($pipes[1])) $stdout .= fgets($pipes[1], 1024);
    fclose($pipes[1]);
    $stderr = '';
    while(!feof($pipes[2])) $stderr .= fgets($pipes[2], 1024);
    fclose($pipes[2]);
    $return_value = proc_close($process);
    return array($stdout, $stderr, $return_value);
} 
```

其中 $command 是你的 c# 应用程序的路径和文件名（加上任何命令行参数），如果需要，$stdin 是你的 c# 应用程序的标准输入。

如果您的 C# 应用程序正在特定端口（比如说 8888）上侦听请求，那么您可能正在寻找：

```
$handle = fopen("http://localhost:8888/someurl?someparam=somevalue", "r"); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-09T20:08:07.897

[XML-RPC](http://en.wikipedia.org/wiki/XML-RPC)和[SOAP](http://en.wikipedia.org/wiki/SOAP)是为应用程序到应用程序的通信而设计的。

# javascript - 在javascript中更改图像的颜色

> ID：725287
> 
> 赞同：9
> 
> 时间：2009-04-07T11:50:18.727
> 
> 标签：javascript

我想动态更改地图图像的颜色（比如从蓝色变为红色）。而且我不能使用画布，因为我必须支持 IE。知道如何使用 javascript 在客户端操作图像吗？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-07T12:25:12.827

如果颜色过渡非常极化（即，没有很多细微的渐变变化），您可以为图像的彩色部分制作一个透明的“洞”（使用 8 位 png 或 gif 格式来支持 IE6），并且将背景颜色设置为真实颜色：

```
<!-- mymap.png contains a transparent "hole" for color -->
<img id="colorme" src="mymap.png" style="background-color:red" />

<script>
// change the color to blue:
document.getElementById('colorme').style.backgroundColor = 'blue'
</script> 
```

这并不能解决您“在客户端操作图像”的要求。以任意方式操作图像只能使用诸如画布之类的东西，以及仅限 IE 的 vml 的某些部分。但如果是简单的颜色变化，这个技巧可能就足够了。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-07T11:55:14.863

在服务器端执行它并将其作为新资源获取，例如使用透明间隔图像并将真实图像 URL 作为背景图像属性放置在使用类名的一组 CSS 选择器中。

现在更改图像的类名应该替换显示的图像，客户端不需要讨厌的聪明东西。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-07T12:23:51.953

根据您的需要，您可以使用纯 CSS 来移动背景图像的视口。查看此站点的顶部导航菜单： http: [//grotonhomesforsale.com](http://grotonhomesforsale.com)

看看当您将鼠标悬停在它上面时，文本下方的图像如何变化？你可以做同样的事情，但使用不同的图像

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2013-11-12T15:14:35.630

目前 IE 从 IE 9 开始支持画布，因此可以在 IE 中转换为画布并操作图像。

你可以考虑这个 jquery 插件。它很容易使用。

```
$("#myImageID").tancolor(); 
```

有一个交互式[演示](http://nicolaisi.github.io/tancolor/)。你可以玩弄它。

查看有关用法的文档，它非常简单。[文档](https://github.com/nicolaisi/tancolor)

# .net - 托管在 DataGridView 单元格中的组合框控件可以要求结束编辑吗？

> ID：725289
> 
> 赞同：7
> 
> 时间：2009-04-07T11:50:31.457
> 
> 标签：.net, datagridview

我有一个组合框控件托管在未绑定的 DataGridView 控件中。当用户选择一个项目（或键入一个条目并按回车键）时，我希望它应用更改并退出编辑模式。

这可能吗？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-07T14:53:27.197

在 DataGridView 的 CurrentCellDirtyStateChanged 事件上，您可以调用以下代码：

```
myDataGridView.EndEdit(DataGridViewDataErrorContexts.Commit) 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-03-15T07:59:46.283

你也可以这样做：

```
 datagridview1.CommitEdit(DataGridViewDataErrorContexts.Commit); 
```

如果你不想结束编辑并且你的价值被承诺。

# java - 为什么 System.out 的设计很尴尬？

> ID：725291
> 
> 赞同：13
> 
> 时间：2009-04-07T11:51:16.930
> 
> 标签：java, api

有没有人知道 java.lang.System.out 的尴尬设计背后的动机？

尴尬：
首先，*out*成员被暴露（封装任何人？）。
其次，它是**最终**的，但可以通过*setOut()*更改（与 final 相矛盾）。

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-04-07T12:02:47.513

在 Java 1.0.x`System.out`和朋友们没有`final`——可以通过直接分配来更改它们。然而，当 Sun 决定在 Java 1.1 中选择性地限制这种行为时（当时是针对小程序），这带来了一个问题。为了至少保持一些向后兼容性，`out`已将其制成最终版本并使用本地方法写入，该方法包含适当的安全检查。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-04-07T11:56:02.223

我敢打赌它主要是为了简洁而暴露的。比较：

```
System.out.prinln("blah"); 
```

和

```
System.getOut().println("blah"); 
```

前者的字符并不短，但它仍然*更*短，概念上更简单。它也很可能更快，尤其是在 JIT 在 Java 虚拟机中不太常见的时代；我敢打赌，在这些情况下，直接访问比方法调用更快。因此，它归结为一种权衡。

**更新：**
对于`final`and `setOut()`，[后者的文档](http://java.sun.com/j2se/1.4.2/docs/api/java/lang/System.html#setOut%28java.io.PrintStream%29)说如果有安全管理器，它将被查询以查看是否允许调用者重新设置输出流。这可能是答案；如果该`out`成员是可以直接分配的，那么就没有办法保护它。

这只是我对 API 的解释以及其设计背后的想法，我可能会离开。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-07T11:59:40.610

`Array.length`这与vs有相似之处`List.size()`。

可能是出于历史原因吗？还有其他类似的语言吗？

# java - 向 Java 应用程序添加许多框架 - 会不会产生负面影响？

> ID：725297
> 
> 赞同：2
> 
> 时间：2009-04-07T11:53:48.937
> 
> 标签：java, performance, frameworks

如果向 Java 应用程序添加许多框架依赖项，这是否会大大增加其内存占用，因为它会在启动时预加载所有库，或者是一种更懒惰的行为，它只会在您实际需要时加载所需的类（例如 import 语句或甚至更晚）？

添加许多依赖项是否还会产生 Java 开发人员应该注意的其他负面影响？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-07T11:56:42.737

类只会根据需要加载（其他类通过`import`等引用）

多个框架令人头疼的是您必须管理它们的共享依赖项。例如，框架 A 需要日志框架 X，但框架 B 需要日志框架 Y。

这些问题并非无法克服，但您必须跟踪它们。当您升级框架 A 时，您很可能最终会产生连锁反应，您必须在其中更新相应的依赖项。然后需要另一个框架组件更新，等等。

例如，框架 A 得到升级，需要更新到 Log4J。然后强制您将框架 B 更新到与您的新 Log4J 兼容的版本，依此类推。

如果您有多个框架要求，这实际上可能指向相应地细分您的应用程序（分成不同的可部署/服务等）的要求。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-07T12:12:58.207

从概念上讲，当您添加大量框架时，您可能还会向代码库添加大量重叠功能。这种过载也​​可能会让人头疼，并且您将让不同的人无缘无故地使用相同功能的不同版本（来自不同的框架）。它可能会变得混乱。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-07T12:19:43.213

如果由于对第三方 jar 有大量依赖而担心分布式应用程序的大小，您总是可以对其进行混淆/缩小，这通常会大大减少应用程序的大小。我过去使用过[Pro Guard](http://proguard.sourceforge.net/)，它还会通过混淆和删除未使用的类/方法/字段等来减少依赖项的大小。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-07T12:19:49.907

从技术上讲，如果您在 java 中使用多个框架并且您的系统非常大并且如果您的框架将减少 java 代码的开销，那么使用它就可以了。例如，如果您的系统非常大，那么您可以使用 Hibernate 与数据库进行对象关系映射。它将减少您的代码负担，例如插入、更新、删除查询。但是如果你的系统不是那么大，你可以在上面手动写，它不会像 hibernate 那样花费太多时间来处理。Spring 或 Struts2 中的情况相同。

# excel - 如何在 Excel 中更改数据透视表数据源？

> ID：725300
> 
> 赞同：24
> 
> 时间：2009-04-07T11:54:13.087
> 
> 标签：excel, business-intelligence, xls, pivot-table

我想将它从一个数据库更改为另一个。

数据透视表上下文菜单上似乎没有任何选项可以执行此操作

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2010-08-11T20:31:46.153

只需点击表格中的任意位置，然后转到页面顶部的选项卡并选择选项 - 从那里您将看到更改数据源选项。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2011-03-14T11:31:29.340

看起来这在很大程度上取决于您的 Excel 版本。我使用的是 2007 版本，当您右键单击表格时，它没有提供向导选项。您需要单击数据透视表以使额外的“数据透视表工具”出现在屏幕顶部其他选项卡的右侧。单击此处显示的“选项”选项卡，然后功能区中间有一个名为“更改数据源”的大图标。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-07T11:55:32.147

右键单击excel中的数据透视表选择向导单击“返回”单击查询窗口中的“获取数据...”文件 - 表定义

然后你可以创建一个新的或选择一个不同的连接

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2012-03-12T22:03:51.260

为了从 excel 2007 中的功能区更改数据源...

单击工作表中的数据透视表。转到显示数据透视表工具、选项选项卡的功能区。选择更改数据源按钮。将出现一个对话框。

要获得正确的范围并避免出现错误消息...选择现有字段的内容并将其删除，然后切换到新的数据源工作表并突出显示数据区域（对话框将保留在所有窗口的顶部）。正确选择新数据源后，它将填充对话框中的空白字段（之前已删除）。单击确定。切换回您的数据透视表，它应该已经使用来自新源的新数据进行了更新。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-07T11:59:12.217

*   右键单击数据透视表，选择数据透视表向导。
*   单击“返回”按钮两次。
*   选择外部数据源，点击下一步。
*   点击获取数据
*   在第一个选项卡中，数据库的第一个选项是“新数据源”

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-06-09T13:21:30.950

这个附加组件将为您解决问题。

[http://www.contextures.com/xlPivotPlayPlus01.html](http://www.contextures.com/xlPivotPlayPlus01.html)

它显示连接字符串，并允许对其进行更改。如果需要，不要忘记更改查询 SQL（使用相同的工具）。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2011-10-07T15:21:39.117

对任何不涉及从头开始重新创建数据透视表的解决方案要小心。您的数据透视字段的选项名称可能与它们呈现给数据库的值不同步。

例如，在我正在处理的一本涉及人口统计数据的工作簿中，如果您尝试选择“20-24”年龄段选项，Excel 实际上会为您提供 25-29 岁的数字。当然，它不会告诉你它正在这样做。

有关解决此问题的问题的程序化 (VBA) 方法，请参见下文。我认为它相当完整/强大，但我不经常使用数据透视表，因此希望得到反馈。

```
Sub SwapSources()

strOldSource = "2010 Data"
strNewSource = "2009 Data"

Dim tmpArrOut

For Each wsh In ThisWorkbook.Worksheets
    For Each pvt In wsh.PivotTables
        tmpArrIn = pvt.SourceData
        ' row 1 of SourceData is the connection string.
        ' rows 2+ are the SQL code broken down into 255-byte chunks.
        ' we need to concatenate rows 2+, replace, and then split them up again

        strSource1 = tmpArrIn(LBound(tmpArrIn))
        strSource2 = ""
        For ii = LBound(tmpArrIn) + 1 To UBound(tmpArrIn)
            strSource2 = strSource2 & tmpArrIn(ii)
        Next ii

        strSource1 = Replace(strSource1, strOldSource, strNewSource)
        strSource2 = Replace(strSource2, strOldSource, strNewSource)

        ReDim tmpArrOut(1 To Int(Len(strSource2) / 255) + 2)
        tmpArrOut(LBound(tmpArrOut)) = strSource1
        For ii = LBound(tmpArrOut) + 1 To UBound(tmpArrOut)
            tmpArrOut(ii) = Mid(strSource2, 255 * (ii - 2) + 1, 255)
        Next ii

        ' if the replacement SQL is invalid, the PivotTable object will throw an error
        Err.Clear
        On Error Resume Next
            pvt.SourceData = tmpArrOut
        On Error GoTo 0
        If Err.Number <> 0 Then
            MsgBox "Problems changing SQL for table " & wsh.Name & "!" & pvt.Name
            pvt.SourceData = tmpArrIn ' revert
        ElseIf pvt.RefreshTable <> True Then
            MsgBox "Problems refreshing table " & wsh.Name & "!" & pvt.Name
        Else
            ' table is now refreshed
            ' need to ensure that the "display name" for each pivot option matches
            ' the actual value that will be fed to the database.  It is possible for
            ' these to get out of sync.
            For Each pvf In pvt.PivotFields
                'pvf.Name = pvf.SourceName
                If Not IsError(pvf.SourceName) Then ' a broken field may have no SourceName
                    mismatches = 0
                    For Each pvi In pvf.PivotItems
                        If pvi.Name <> pvi.SourceName Then
                            mismatches = mismatches + 1
                            pvi.Name = "_mismatch" & CStr(mismatches)
                        End If
                    Next pvi
                    If mismatches > 0 Then
                        For Each pvi In pvf.PivotItems
                            If pvi.Name <> pvi.SourceName Then
                                pvi.Name = pvi.SourceName
                            End If
                        Next
                    End If
                End If
            Next pvf
        End If
    Next pvt
Next wsh

End Sub 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2010-01-20T14:20:28.480

> 右键单击excel中的数据透视表选择向导单击“返回”单击查询窗口中的“获取数据...”文件 - 表定义
> 
> 然后你可以创建一个新的或选择一个不同的连接

完美地工作。

获取数据按钮在小按钮旁边，在范围文本输入框旁边有一个红色箭头。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2011-07-13T11:51:31.673

对于 MS excel 2000 office 版本，单击数据透视表，您将在功能区上方找到一个选项卡，称为 Pivottable 工具 - 单击该选项卡您可以从数据选项卡更改数据源

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2011-08-05T07:49:12.043

如果是 Excel 2007，您可以在选项菜单/更改数据源中更改数据源

# algorithm - 实现排序和/或搜索算法——在哪里以及为什么

> ID：725315
> 
> 赞同：2
> 
> 时间：2009-04-07T11:58:01.940
> 
> 标签：algorithm, language-agnostic, sorting

我不时遇到手动实现的排序和/或搜索算法，而不是使用语言实现的算法。我一直在研究的大多数源代码都是用 Java、C# 或 PHP 编写的——但我猜这种现象与语言无关。

关于列表等常规数据结构；为什么以及在哪里实现自己的算法？意识形态原因？内存效率更高？无法忍受使用内置功能的想法？Java 最好使用合并排序（在 Collections.sort() 中），当您将其与快速排序进行比较时，它会产生一些开销。如果您有一个经常用于执行常见任务的收藏夹，我们非常欢迎您以您选择的语言提交它！

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-07T12:01:24.503

*   并非每种排序算法都由标准库实现。
*   并非每种语言都支持通用数据类型/容器
*   有时您需要根据数据大小在排序算法之间切换
*   为一组特定的输入调整算法更容易
*   测量处理器速度
*   课程作业
*   只是为了好玩

这些只是其中一些原因......

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-07T12:02:31.040

**博格排序**：

```
while (!is_sorted(array)) {
    randomly_shuffle(array);
} 
```

预期运行时间：O(n!)

:)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-07T12:05:21.657

内置语言实现通常会更快，但前提是您以标准方式排序/搜索。只要您做了一些不寻常的事情，无论是解释密钥的方式，处理多个指针，连接到不同的环境等等，您都可以通过调整基本例程来满足您的确切要求来提高性能。

例如，我需要保持三个大型（巨大）数据集在同一个键上排序，因此我必须返回源代码并更改 C 快速排序代码以在三个不同的数据数组上移动元素。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-07T12:08:57.310

在 C++ 中，您可以拥有一个容器，其中包含一个仅由容器的方法搜索的数组。您可以使用一些库实现，但是您必须提供一个比较器类，这与简单地编写一个 for() 循环的代码量相同。为什么要为这种情况生成一个新实体（比较器类）？

# vb6 - VB6 ADO 设置 rs=command.Execute

> ID：725319
> 
> 赞同：2
> 
> 时间：2009-04-07T11:59:04.527
> 
> 标签：vb6, ado

```
Set rs = command.Execute 
if not rs.EOF then
   'logic here
end if 
```

上面的代码在第 2 行失败，因为 rs 已关闭（可能 oledb 提供程序错误地认为它是一个插入命令，因此无需返回任何内容）。该命令是一个插入语句，例如：

```
Insert into log(Name,Value) values("xxx", 123); select scope_identity() 
```

我需要在一次往返中从服务器返回身份。有任何想法吗？

PS：使用字段名称更新插入语句（感谢 Eduardo），但这不是问题。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-07T13:59:03.987

您的问题是数据源返回两个记录集。这是由于数据库的 NOCOUNT 设置。第一个记录集仅用于返回受插入语句影响的记录。第二个记录集返回 SELECT SCOPE_IDENTITY 调用的结果。所以你需要这样做：

```
If rs.State = adStateClosed Then
   Set rs = rs.NextRecordset()
End If 
```

然后你可以检查 EOF 和所有这些。但我通常会避免所有这些，并将这样的东西放在存储过程中。然后我在存储过程中设置 NOCOUNT ON。并在存储过程结束时返回 id。现在你的插入可能只是这样简单，但逻辑可能会增长。通过将其放入存储过程中，您只需更改存储过程，而不必更改已编译的 VB 应用程序。它还稍微隔离了数据库代码。

你不想做的是在你的声明中设置 NOCOUNT ON。如果不是整个数据库，我认为会影响整个连接。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-07T12:01:58.980

Select @@Identity From TableName 应该给出最后插入的 id

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-07T13:57:32.557

这是 SQL Server 吗？尝试`SET NOCOUNT ON`在 SQL 开头添加，例如

```
SET NOCOUNT ON;
Insert into log(Name,Value) values("xxx", 123); 
select scope_identity() 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-07T13:35:37.990

您可以尝试在函数中返回 ID。

```
CREATE FUNCTION dbo.MyFunc ( @name varchar(10), @value varchar(10))
RETURNS int
AS
BEGIN
    DECLARE @rtn int

    Insert into log(Name,Value) 
    values("xxx", 123); 

    select @rtn = scope_identity()
    RETURN @rtn;
END 
```

虽然我认为你上面有什么，但你在哪里进行插入然后选择应该以某种方式工作。

# jsp - 使用 Java Servlet/JSP/JSF 并结合 Ajax 建立论坛的最佳数据库/数据策略是什么？

> ID：725328
> 
> 赞同：0
> 
> 时间：2009-04-07T12:01:16.767
> 
> 标签：jsp, jsf, forum

通常对于标准 J2EE 项目，我直接使用 SQL 构造或 ORM 框架将数据管理为表单等，但当然企业环境不会同时对 n 用户访问性能有太多顾虑。

那么对于多达 50 个用户或更多用户的用户论坛来说，最适合性能的策略是什么？

你有什么建议吗？

1）在我看来，我必须在数据级别保留所有前端/最后消息的快速访问索引，但我对使用纯文本文件或数据库表有疑问？

2）从视觉上我的想法是建立一个只链接到“快速访问索引”的消息列表的顶部，然后使用 Ajax 获取消息的详细信息和内容，这样我可以将应用程序流分成两个单独的通道，一种旨在提供快速内容，另一种旨在提供复杂数据（内容消息、用户详细信息等）。

重要的提醒：

论坛应用程序必须非常适合任何“差”数据和 Java 环境，请不要将我的问题 phpize ;-)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-07T15:34:23.697

阅读 Hibernate 和二级缓存。您可以缓存所有“快速访问”内容，以便在请求有关条目的更多详细信息之前不会命中数据库。

# java - 将中型代码库从 Java 1.4.2 迁移到 Java 5 的策略

> ID：725331
> 
> 赞同：3
> 
> 时间：2009-04-07T12:01:48.840
> 
> 标签：java, refactoring, migration

我正在审查代码库（~20K LOC）并试图确定如何将其从 1.4.2 迁移到 5。显然，这不是一个一夜之间的项目，我收到的建议是编写新代码针对 Java 5 并以零碎的方式迁移旧代码。此外，我不是 Java 5 中的新特性方面的专家（即我知道它们，但从未编写过任何用于生产用途的东西）。

我的问题：

1.  Java 5 的哪些特性通常用于生产代码？（即泛型、自动装箱等）是否有要避免/不被视为最佳实践的功能？

2.  我可以使用哪些最佳重构策略来迁移这种大小的代码库？（即仅在编辑类时一次更改一个类等） 目标 - 降低代码库的风险。限制 - 进行重构的资源。

任何建议表示赞赏 - 在此先感谢。

**更新 - 晚了一年，但迟到总比没有好？=)**

感谢您的所有评论 - 很多很棒的观点。在软件开发人员的生活中，总会有一些您努力完成但由于更“紧急”的事情而无法完成的项目。

关于Java 5的使用（当时），是客户端生产环境需要的东西，所以我们没有使用Java 6。

我发现对于集合、枚举和拆箱原语的更强类型是我最倾向于应用的功能，无论是旧代码还是新代码。重构相当简单，但代码理解显着提高，标准变得更容易执行。我最麻烦的是泛型。我认为这是一个我还没有机会完全掌握和欣赏的概念，所以我很难找到以前应用泛型的案例。

再次感谢为此线程做出贡献的所有人，并为迟到的跟进表示歉意。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-07T12:29:18.230

Java 5 几乎完全向后兼容 Java 4。通常，迁移时**必须**`enum`进行的唯一更改是重命名Java 4 代码中 new 关键字的任何用法。

此处列出了潜在兼容性问题的完整列表：

[http://java.sun.com/j2se/1.5.0/compatibility.html](http://java.sun.com/j2se/1.5.0/compatibility.html)

我在实践中遇到的唯一其他问题与 JAXP 实现中的更改有关。在我们的例子中，它只是意味着从类路径中删除 xerces.jar。

就重构而言，我认为迁移您的集合类以使用新的强类型泛型版本并删除不必要的转换是一个好主意。但正如另一位海报指出的那样，如果您在垂直切片中工作，则更改为通用集合往往效果最好。否则，您最终不得不在代码中添加强制转换以使泛型类型与非泛型类型兼容。

我在迁移代码时喜欢使用的另一个功能是 @Override 注释。它有助于在重构代码时发现继承问题。

[http://java.sun.com/j2se/1.5.0/docs/api/java/lang/Override.html](http://java.sun.com/j2se/1.5.0/docs/api/java/lang/Override.html)

如果您的代码使用线程，新的并发库非常有用。例如，您可以用`ThreadPoolExecutor`.

[http://java.sun.com/j2se/1.5.0/docs/relnotes/features.html#concurrency](http://java.sun.com/j2se/1.5.0/docs/relnotes/features.html#concurrency)

我肯定会采取在正常维护期间更改代码时更新代码的方法。除了兼容性问题之外，我认为没有令人信服的理由使用新的 Java 5 功能，除非您已经出于其他原因更改了代码。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-07T12:08:35.033

仿制药的“病毒”性质存在一个非常现实的问题。一旦您开始在架构中的给定层引入它们，您通常也希望在上层和下层引入它们。我发现引入泛型可能最好在完整的“垂直”中完成。但是你不必一次做*所有*的垂直。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-07T12:26:55.973

这是一个很难回答的问题，因为它取决于哪些代码会受到影响以及该代码的重要性。

首先，当迁移是一项艰巨的任务时，请帮自己一个忙，升级到最新版本的 Java，即 Java 6 而不是 Java 5。Java 6 已经推出一年半或更长时间，并且已经成熟。没有理由不选择 Java 5（恕我直言）。

其次，就像任何软件项目一样，您的目标应该是尽快将某些东西投入生产。因此，您需要识别系统的一部分。越小越好，越非关键性越好。

另一件事就是尝试在 Java 6 下启动您的应用程序，然后看看有什么问题。它可能比你预期的更糟。可能会好很多。

您可能需要注意的另一件事是，通过它的声音，您的应用程序中将包含已被弃用的 jars/libraries。有些甚至可能与 1.4.2 之后的 Java 不兼容。您可能还希望将所有这些升级到最新版本。

这可能意味着更多的东西会被破坏，但使​​用旧的/不推荐使用的 API 只会把罐子踢到街上并给你带来其他问题。

升级可能会产生深远的影响，但也有例外。想到 Axis1 到 Axis2。这些情况需要更仔细的思考。

至于使用了哪些功能……都差不多。我想不出任何应该避免的事情。

另外，我刚刚注意到您的项目的大小：~20K LOC。这实际上非常小（例如，我在过去 3 个月里自己编写了一个具有这种大小的应用程序）。

最后，这还取决于您找到损坏的东西的难易程度。如果您有良好的单元测试覆盖率，那就太好了。不过，这非常罕见。如果您可以通过应用程序运行并可靠地发现问题，那还不错。

有问题的情况是场景难以测试，并且您可能不会立即发现问题。这需要更加谨慎。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-07T12:08:45.923

您可能想要迁移在从 1.4 到 5 的过渡中不起作用的东西（不确定那会是什么），但我会警惕*为了*迁移而迁移的东西。

如果你确实走这条路，一些问题：

你有全面的测试覆盖率吗？如果没有，您应该为要迁移的代码编写单元测试。

您的代码库中是否有广泛使用的组件？如果是这样，就 API 而言，它们可能是迁移的候选对象（例如，使用泛型等）

就 Java 5 中广泛使用的内容而言。泛型很重要，它让你的生活变得更轻松。我没有看到*太多*的自动装箱，也没有枚举（这都是相对的）。Varargs 几乎从不。注释对框架很有用，但我使用这些。我不认为我自己曾经实施过。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-07T12:43:28.943

20（非注释）kloc 应该足够小以插入泛型。显然，请确保您的代码首先在 Java SE 5 上编译运行。关于泛型的相对简单的事情是，添加它们对语义的改变很小（某些重载可能会因为隐含的情况而改变——`Iterator<char[]> iter; ... System.out.println(iter.next());`作为我头脑中的一个坏例子）。

在某些情况下，添加泛型会突出代码的概念问题。例如，使用一个`Map`作为两个具有不相交键集的映射。`TreeMap`是 Java 库中的一个示例，其中单个类具有两种不同的模式（使用`Comparator<T>`或`Comparable<T>`）。

诸如增强和自动装箱之类的东西非常本地化，可以零碎添加。枚举比较少见，可能需要考虑一下你将如何实际使用它们。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-07T12:49:24.810

我认为你的做法是错误的。您的计划不应该是将所有当前代码更新到 Java 1.5，您的计划应该是确保所有当前代码在 1.5 中的运行与在 1.4.2 中完全相同，并且所有未来编写的代码都将在 1.5 中正常运行.

我已经经历了几次这样的不同大小的代码库的转换。我们的目标始终是确保我们有大量的单元测试，以便我们可以轻松地插入 1.5 并通过它运行我们的测试。我们实际上遇到了大约 10 个问题，主要与正则表达式库不支持某些东西或支持不同的东西有关。

然后在 1.5 中编写所有新代码，如果您出于某种原因更改了旧类，请花一分钟时间实现泛型，但没有理由重构所有内容。如果您没有进行测试，这对我来说听起来有点危险。

# java - LinkageError JAXB 2.0 -> 2.1 (Tomcat)

> ID：725337
> 
> 赞同：8
> 
> 时间：2009-04-07T12:02:55.420
> 
> 标签：java, tomcat, jaxb, endorsed

尝试访问在 tomcat 中运行的 Web 服务时出现此错误。

> 引起：java.lang.LinkageError: JAXB 2.0 API 正在从引导类加载器加载，但是这个 RI（来自 jar:file:/C:/software/tomcat6/webapps/messaging/WEB-INF/lib/jaxb-impl -2.1.5.jar!/com/sun/xml/bind/v2/model/impl/ModelBuilder.class) 需要 2.1 API。使用认可的目录机制将 jaxb-api.jar 放置在引导类加载器中。（见[http://java.sun.com/j2se/1.5.0/docs/guide/standards/](http://java.sun.com/j2se/1.5.0/docs/guide/standards/)）

我搜索了错误并做了应该解决的问题（我将 jaxb-api.jar，版本 2.1 放在 JDK/lib/endorsed 和 JDK/jre/lib/endorsed 中）但它似乎没有任何效果。

我以前没有它，我不确定发生了什么变化。我使用JDK 6u10。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-14T13:32:42.937

Java 6u10 包含 JAXB 2.1，因此根本不需要包含它（从 6u4 开始就包含它）。

现在看起来您在 webapp 中包含的 JAXB 和 JRE 附带的捆绑 JAXB 之间存在冲突。您可以尝试从您的 webapp ( `C:/software/tomcat6/webapps/messaging/WEB-INF/lib/jaxb-impl-2.1.5.jar`) 中删除 JAXB jar 并依赖内置版本。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-14T13:21:37.427

推荐的方法是定义 JAVA_ENDORSED_DIRS 环境变量。然后 Tomcat 将使用这个 Java 属性：

```
-Djava.endorsed.dirs=$JAVA_ENDORSED_DIRS 
```

为了加载认可的罐子。因此，创建一个文件夹，将 jaxb-api.jar v2.1 放在那里并定义环境变量以指向该文件夹。

这比使用全局认可的目录要好，因为它不会影响整个 JVM，并且您不必在更新 JRE 时重复该过程。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-07T14:45:44.500

您是否有可能在 $JAVA_HOME/jre/lib/ext 目录中有 jaxb jar？下面是引导加载程序的定义：

> Bootstrap - 这个类加载器包含 Java 虚拟机提供的基本运行时类，以及系统扩展目录 ($JAVA_HOME/jre/lib/ext) 中存在的 JAR 文件中的任何类。注意 - 一些 JVM 可能将其实现为多个类加载器，或者它可能根本不可见（作为类加载器）。

（取自[这里](http://tomcat.apache.org/tomcat-6.0-doc/class-loader-howto.html)）

请搜索系统中所有包含 jaxb jar 的位置（至少 jaxb-api 和 jaxb-impl），并确保它们位于 Web 应用程序的 WEB-INF/lib 目录或 lib 目录中的雄猫。

# c# - 如何确定文件是否与文件掩码匹配？

> ID：725341
> 
> 赞同：30
> 
> 时间：2009-04-07T12:05:31.797
> 
> 标签：c#, .net, regex

我需要确定文件名是否适合文件掩码。文件掩码可以包含 * 或 ? 人物。有什么简单的解决方案吗？

```
bool bFits = Fits("myfile.txt", "my*.txt");

private bool Fits(string sFileName, string sFileMask)
    {
        ??? anything simple here ???
    } 
```

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2009-11-03T16:48:16.380

我很高兴找到乔尔的答案——也为我节省了一些时间！但是，我确实必须进行一些更改以使该方法符合大多数用户的期望：

*   我删除了第一个参数之前的“this”关键字。它在这里什么也不做（尽管如果该方法打算成为扩展方法，它可能很有用，在这种情况下，它需要是公共的并包含在静态类中，并且本身是一个静态方法）。
*   我使正则表达式不区分大小写以匹配标准的 Windows 通配符行为（例如，“c*.*”和“C*.*”都返回相同的结果）。
*   我在正则表达式中添加了开始和结束锚点，再次匹配标准 Windows 通配符行为（例如，“stuff.txt”将与“stuff*”或“s*”或“s*.*”匹配，但不仅仅是“s”）。

* * *

```
private bool FitsMask(string fileName, string fileMask)
{
    Regex mask = new Regex(
        '^' + 
        fileMask
            .Replace(".", "[.]")
            .Replace("*", ".*")
            .Replace("?", ".")
        + '$',
        RegexOptions.IgnoreCase);
    return mask.IsMatch(fileName);
} 
```

## 2009.11.04 更新：匹配几个面具之一

为了获得更大的灵活性，这里有一种建立在原始之上的插件兼容方法。此版本允许您传递多个掩码（因此第二个参数名称*fileMasks*上的复数），由行、逗号、竖线或空格分隔。我想要它，这样我就可以让用户在 ListBox 中放置任意数量的选择，然后选择与其中*任何*一个匹配的所有文件。请注意，某些控件（如 ListBox）使用 CR-LF 进行换行，而其他控件（例如 RichTextBox）仅使用 LF——这就是 "\r\n" 和 "\n" 都出现在拆分列表中的原因。

```
private bool FitsOneOfMultipleMasks(string fileName, string fileMasks)
{
    return fileMasks
        .Split(new string[] {"\r\n", "\n", ",", "|", " "},
            StringSplitOptions.RemoveEmptyEntries)
        .Any(fileMask => FitsMask(fileName, fileMask));
} 
```

## 2009.11.17 更新：更优雅地处理 fileMask 输入

FitsMask 的早期版本（我留下来进行比较）做得很好，但是由于我们将其视为正则表达式，因此如果它不是有效的正则表达式，它将引发异常。解决方案是我们实际上希望输入 fileMask 中的任何正则表达式元字符都被视为文字，而不是元字符。但是我们仍然需要特别对待句号、星号和问号。因此，FitsMask 的这个改进版本安全地将这三个字符移开，将所有剩余的元字符转换为文字，然后将三个有趣的字符放回，以它们的“正则表达式”形式。

另一个小的改进是允许大小写独立，每个标准 Windows 行为。

```
private bool FitsMask(string fileName, string fileMask)
{
    string pattern =
         '^' + 
         Regex.Escape(fileMask.Replace(".", "__DOT__")
                         .Replace("*", "__STAR__")
                         .Replace("?", "__QM__"))
             .Replace("__DOT__", "[.]")
             .Replace("__STAR__", ".*")
             .Replace("__QM__", ".")
         + '$';
    return new Regex(pattern, RegexOptions.IgnoreCase).IsMatch(fileName);
} 
```

## 2010.09.30 更新：一路走来，激情接踵而至……

我之前没有更新这个内容是失职的，但是这些参考资料可能会引起已经做到这一点的读者的兴趣：

*   我嵌入了**FitsMask**方法作为 WinForms 用户控件的核心，该控件恰当地称为**FileMask ——请参阅**[此处](http://cleancode.sourceforge.net/api/csharp/html/T_CleanCode_GeneralComponents_Controls_FileMask.htm)的 API 。
*   然后，我在 Simple-Talk.com 上发表了一篇介绍 FileMask 控件的文章，题为[Using LINQ Lambda Expressions to Design Customizable Generic Components](http://www.simple-talk.com/dotnet/.net-framework/using-linq-lambda-expressions-to-design-customizable-generic-components/)。（虽然该方法本身不使用 LINQ，但 FileMask 用户控件使用，因此本文的标题。）

* * *

## 回答 #2

> 赞同：22
> 
> 时间：2009-04-07T12:08:48.340

试试这个：

```
private bool FitsMask(string sFileName, string sFileMask)
{
    Regex mask = new Regex(sFileMask.Replace(".", "[.]").Replace("*", ".*").Replace("?", "."));
    return mask.IsMatch(sFileName);
} 
```

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2010-02-17T12:49:25.487

很多人不知道，但 .NET 包含一个内部类，称为“PatternMatcher”（在“System.IO”命名空间下）。

该静态类仅包含 1 个方法： `public static bool StrictMatchPattern(string expression, string name)`

.net 需要使用通配符比较文件时使用此方法（FileSystemWatcher、GetFiles() 等）

使用反射器，我在这里公开了代码。并没有真正通过它来了解它是如何工作的，但它工作得很好，

因此，这是任何不想使用低效 RegEx 方式的人的代码：

```
public static class PatternMatcher
{
    // Fields
    private const char ANSI_DOS_QM = '<';
    private const char ANSI_DOS_STAR = '>';
    private const char DOS_DOT = '"';
    private const int MATCHES_ARRAY_SIZE = 16;

    // Methods
    public static bool StrictMatchPattern(string expression, string name)
    {
        expression = expression.ToLowerInvariant();
        name = name.ToLowerInvariant();
        int num9;
        char ch = '\0';
        char ch2 = '\0';
        int[] sourceArray = new int[16];
        int[] numArray2 = new int[16];
        bool flag = false;
        if (((name == null) || (name.Length == 0)) || ((expression == null) || (expression.Length == 0)))
        {
            return false;
        }
        if (expression.Equals("*") || expression.Equals("*.*"))
        {
            return true;
        }
        if ((expression[0] == '*') && (expression.IndexOf('*', 1) == -1))
        {
            int length = expression.Length - 1;
            if ((name.Length >= length) && (string.Compare(expression, 1, name, name.Length - length, length, StringComparison.OrdinalIgnoreCase) == 0))
            {
                return true;
            }
        }
        sourceArray[0] = 0;
        int num7 = 1;
        int num = 0;
        int num8 = expression.Length * 2;
        while (!flag)
        {
            int num3;
            if (num < name.Length)
            {
                ch = name[num];
                num3 = 1;
                num++;
            }
            else
            {
                flag = true;
                if (sourceArray[num7 - 1] == num8)
                {
                    break;
                }
            }
            int index = 0;
            int num5 = 0;
            int num6 = 0;
            while (index < num7)
            {
                int num2 = (sourceArray[index++] + 1) / 2;
                num3 = 0;
            Label_00F2:
                if (num2 != expression.Length)
                {
                    num2 += num3;
                    num9 = num2 * 2;
                    if (num2 == expression.Length)
                    {
                        numArray2[num5++] = num8;
                    }
                    else
                    {
                        ch2 = expression[num2];
                        num3 = 1;
                        if (num5 >= 14)
                        {
                            int num11 = numArray2.Length * 2;
                            int[] destinationArray = new int[num11];
                            Array.Copy(numArray2, destinationArray, numArray2.Length);
                            numArray2 = destinationArray;
                            destinationArray = new int[num11];
                            Array.Copy(sourceArray, destinationArray, sourceArray.Length);
                            sourceArray = destinationArray;
                        }
                        if (ch2 == '*')
                        {
                            numArray2[num5++] = num9;
                            numArray2[num5++] = num9 + 1;
                            goto Label_00F2;
                        }
                        if (ch2 == '>')
                        {
                            bool flag2 = false;
                            if (!flag && (ch == '.'))
                            {
                                int num13 = name.Length;
                                for (int i = num; i < num13; i++)
                                {
                                    char ch3 = name[i];
                                    num3 = 1;
                                    if (ch3 == '.')
                                    {
                                        flag2 = true;
                                        break;
                                    }
                                }
                            }
                            if ((flag || (ch != '.')) || flag2)
                            {
                                numArray2[num5++] = num9;
                                numArray2[num5++] = num9 + 1;
                            }
                            else
                            {
                                numArray2[num5++] = num9 + 1;
                            }
                            goto Label_00F2;
                        }
                        num9 += num3 * 2;
                        switch (ch2)
                        {
                            case '<':
                                if (flag || (ch == '.'))
                                {
                                    goto Label_00F2;
                                }
                                numArray2[num5++] = num9;
                                goto Label_028D;

                            case '"':
                                if (flag)
                                {
                                    goto Label_00F2;
                                }
                                if (ch == '.')
                                {
                                    numArray2[num5++] = num9;
                                    goto Label_028D;
                                }
                                break;
                        }
                        if (!flag)
                        {
                            if (ch2 == '?')
                            {
                                numArray2[num5++] = num9;
                            }
                            else if (ch2 == ch)
                            {
                                numArray2[num5++] = num9;
                            }
                        }
                    }
                }
            Label_028D:
                if ((index < num7) && (num6 < num5))
                {
                    while (num6 < num5)
                    {
                        int num14 = sourceArray.Length;
                        while ((index < num14) && (sourceArray[index] < numArray2[num6]))
                        {
                            index++;
                        }
                        num6++;
                    }
                }
            }
            if (num5 == 0)
            {
                return false;
            }
            int[] numArray4 = sourceArray;
            sourceArray = numArray2;
            numArray2 = numArray4;
            num7 = num5;
        }
        num9 = sourceArray[num7 - 1];
        return (num9 == num8);
    }
} 
```

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2013-10-29T10:38:31.053

这些答案似乎都没有奏效，而且 msorens 的答案是不必要的复杂。这个应该可以正常工作：

```
public static Boolean MatchesMask(string fileName, string fileMask)
{
    String convertedMask = "^" + Regex.Escape(fileMask).Replace("\\*", ".*").Replace("\\?", ".") + "$";
    Regex regexMask = new Regex(convertedMask, RegexOptions.IgnoreCase);
    return regexMask.IsMatch(fileName)
} 
```

这确保掩码中可能的正则表达式字符被转义，替换 \* 和 \?，并用 ^ 和 $ 将其全部包围以标记边界。

当然，在大多数情况下，将其简单地制作成一个`FileMaskToRegex`返回 Regex 对象的工具函数会更有用，因此您只需得到它一次，然后可以创建一个循环，在其中检查文件列表中的所有字符串。

```
public static Regex FileMaskToRegex(string fileMask)
{
    String convertedMask = "^" + Regex.Escape(fileMask).Replace("\\*", ".*").Replace("\\?", ".") + "$";
    return new Regex(convertedMask, RegexOptions.IgnoreCase);
} 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2015-04-08T13:10:35.003

Nissim 在他的回答中提到了 PatternMatcher 类......

这里有一个解释：

[http://referencesource.microsoft.com/#System/services/io/system/io/PatternMatcher.cs](http://referencesource.microsoft.com/#System/services/io/system/io/PatternMatcher.cs)

所以你不必使用反射代码并猜测它是如何工作的。

另外，我认为使用此代码可能是最好的解决方案，因为它可以保证在您的比较和框架方法（如`GetFiles()`.

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2015-04-08T14:20:00.013

使用作为[NuGet 包](https://www.nuget.org/packages?q=System.Management.Automation)或 Windows PowerShell SDK提供的[`WildCardPattern`](https://msdn.microsoft.com/library/system.management.automation.wildcardpattern)类。`System.Management.Automation`

```
WildcardPattern pattern = new WildcardPattern("my*.txt");
bool fits = pattern.IsMatch("myfile.txt"); 
```

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2010-08-23T20:35:58.370

先前提出的功能的最快版本：

```
 public static bool FitsMasks(string filePath, params string[] fileMasks)
            // or
    public static Regex FileMasksToRegex(params string[] fileMasks)
    {
        if (!_maskRegexes.ContainsKey(fileMasks))
        {
            StringBuilder sb = new StringBuilder("^");
            bool first = true;
            foreach (string fileMask in fileMasks)
            {
                if(first) first =false; else sb.Append("|");
                sb.Append('(');
                foreach (char c in fileMask)
                {
                    switch (c)
                    {
                        case '*': sb.Append(@".*"); break;
                        case '?': sb.Append(@"."); break;
                        default:
                                sb.Append(Regex.Escape(c.ToString()));
                            break;
                    }
                }
                sb.Append(')');
            }
            sb.Append("$");
            _maskRegexes[fileMasks] = new Regex(sb.ToString(), RegexOptions.IgnoreCase);
        }
        return _maskRegexes[fileMasks].IsMatch(filePath);
                    // or
        return _maskRegexes[fileMasks];
    }
    static readonly Dictionary<string[], Regex> _maskRegexes = new Dictionary<string[], Regex>(/*unordered string[] comparer*/); 
```

笔记：

1.  重用正则表达式对象。
2.  使用 StringBuilder 优化 Regex 创建（多次 .Replace() 调用很慢）。
3.  多个掩码，与 OR 结合使用。
4.  另一个版本返回正则表达式。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2016-04-22T11:59:40.090

从 Windows 7 使用 P/Invoke（无 260 字符数限制）：

```
// UNICODE_STRING for Rtl... method
[StructLayout(LayoutKind.Sequential, CharSet = CharSet.Unicode)]
public struct UNICODE_STRING
{
    public ushort Length;
    public ushort MaximumLength;
    [MarshalAs(UnmanagedType.LPWStr)]
    string Buffer;

    public UNICODE_STRING(string buffer)
    {
        if (buffer == null)
            Length = MaximumLength = 0;
        else
            Length = MaximumLength = unchecked((ushort)(buffer.Length * 2));
        Buffer = buffer;
    }
}

// RtlIsNameInExpression method from NtDll.dll system library
public static class NtDll
{
    [DllImport("NtDll.dll", CharSet=CharSet.Unicode, ExactSpelling=true)]
    [return: MarshalAs(UnmanagedType.U1)]
    public extern static bool RtlIsNameInExpression(
        ref UNICODE_STRING Expression,
        ref UNICODE_STRING Name,
        [MarshalAs(UnmanagedType.U1)]
        bool IgnoreCase,
        IntPtr Zero
        );
}

public bool MatchMask(string mask, string fileName)
{
    // Expression must be uppercase for IgnoreCase == true (see MSDN for RtlIsNameInExpression)
    UNICODE_STRING expr = new UNICODE_STRING(mask.ToUpper());
    UNICODE_STRING name = new UNICODE_STRING(fileName);

    if (NtDll.RtlIsNameInExpression(ref expr, ref name, true, IntPtr.Zero))
    {
        // MATCHES !!!
    }
} 
```

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-04-07T12:32:13.947

如果 PowerShell 可用，它直接支持[通配符类型匹配](http://msdn.com/library/system.management.automation.wildcardpattern)（以及正则表达式）。

```
WildcardPattern pat = new WildcardPattern("a*.b*");
if (pat.IsMatch(filename)) { ... } 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2019-07-05T07:23:44.780

我不想复制源代码，就像@frankhommers 一样，我想出了一个基于反射的解决方案。

请注意我在参考源中找到的关于在 name 参数中使用通配符的代码注释。

```
 public static class PatternMatcher
    {
        static MethodInfo strictMatchPatternMethod;
        static PatternMatcher()
        {
            var typeName = "System.IO.PatternMatcher";
            var methodName = "StrictMatchPattern";
            var assembly = typeof(Uri).Assembly;
            var type = assembly.GetType(typeName, true);
            strictMatchPatternMethod = type.GetMethod(methodName, BindingFlags.Static | BindingFlags.Public) ?? throw new MissingMethodException($"{typeName}.{methodName} not found");
        }

        /// <summary>
        /// Tells whether a given name matches the expression given with a strict (i.e. UNIX like) semantics.
        /// </summary>
        /// <param name="expression">Supplies the input expression to check against</param>
        /// <param name="name">Supplies the input name to check for.</param>
        /// <returns></returns>
        public static bool StrictMatchPattern(string expression, string name)
        {
            // https://referencesource.microsoft.com/#system/services/io/system/io/PatternMatcher.cs
            // If this class is ever exposed for generic use,
            // we need to make sure that name doesn't contain wildcards. Currently 
            // the only component that calls this method is FileSystemWatcher and
            // it will never pass a name that contains a wildcard.
            if (name.Contains('*')) throw new FormatException("Wildcard not allowed");
            return (bool)strictMatchPatternMethod.Invoke(null, new object[] { expression, name });
        }
    } 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2020-01-05T17:20:42.500

对于 .net Core，就像微软[那样](https://github.com/ianhays/corefx/blob/21e73c6b703946032a61cd639c2ba7662b319785/src/System.IO.FileSystem.Watcher/src/System/IO/FileSystemWatcher.cs#L384)。

```
 private bool MatchPattern(ReadOnlySpan<char> relativePath)
        {
            ReadOnlySpan<char> name = IO.Path.GetFileName(relativePath);
            if (name.Length == 0)
                return false;

            if (Filters.Count == 0)
                return true;

            foreach (string filter in Filters)
            {
                if (FileSystemName.MatchesSimpleExpression(filter, name, ignoreCase: !PathInternal.IsCaseSensitive))
                    return true;
            }

            return false;
        } 
```

microsoft 本身似乎为 .NET 4.6 所做的方式记录在[github](https://github.com/microsoft/referencesource/blob/17b97365645da62cf8a49444d979f94a59bbb155/System/services/io/system/io/FileSystemWatcher.cs#L679)中：

```
 private bool MatchPattern(string relativePath) {            
        string name = System.IO.Path.GetFileName(relativePath);            
        if (name != null)
            return PatternMatcher.StrictMatchPattern(filter.ToUpper(CultureInfo.InvariantCulture), name.ToUpper(CultureInfo.InvariantCulture));
        else
            return false;                
    } 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2016-03-24T07:25:17.437

我的版本，支持**通配符：

```
 static Regex FileMask2Regex(string mask)
    {
        var sb = new StringBuilder(mask);

        // hide wildcards
        sb.Replace("**", "affefa0d52e84c2db78f5510117471aa-StarStar");
        sb.Replace("*", "affefa0d52e84c2db78f5510117471aa-Star");
        sb.Replace("?", "affefa0d52e84c2db78f5510117471aa-Question");
        sb.Replace("/", "affefa0d52e84c2db78f5510117471aa-Slash");
        sb.Replace("\\", "affefa0d52e84c2db78f5510117471aa-Slash");

        sb = new StringBuilder(Regex.Escape(sb.ToString()));

        // unhide wildcards
        sb.Replace("affefa0d52e84c2db78f5510117471aa-StarStar", @".*");
        sb.Replace("affefa0d52e84c2db78f5510117471aa-Star", @"[^/\\]*");
        sb.Replace("affefa0d52e84c2db78f5510117471aa-Question", @"[^/\\]");
        sb.Replace("affefa0d52e84c2db78f5510117471aa-Slash", @"[/\\]");

        sb.Append("$");

        // allowed to have prefix
        sb.Insert(0, @"^(?:.*?[/\\])?");

        return new Regex(sb.ToString(), RegexOptions.IgnoreCase);
    } 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2018-03-29T13:25:19.293

如何使用反射来访问 .NET 框架中的函数？

像这样：

```
public class PatternMatcher
{
  public delegate bool StrictMatchPatternDelegate(string expression, string name);
  public StrictMatchPatternDelegate StrictMatchPattern;
  public PatternMatcher()
  {
    Type patternMatcherType = typeof(FileSystemWatcher).Assembly.GetType("System.IO.PatternMatcher");
    MethodInfo patternMatchMethod = patternMatcherType.GetMethod("StrictMatchPattern", System.Reflection.BindingFlags.Static | System.Reflection.BindingFlags.Public);
    StrictMatchPattern = (expression, name) => (bool)patternMatchMethod.Invoke(null, new object[] { expression, name });
  }
}

void Main()
{
  PatternMatcher patternMatcher = new PatternMatcher();
  Console.WriteLine(patternMatcher.StrictMatchPattern("*.txt", "test.txt")); //displays true
  Console.WriteLine(patternMatcher.StrictMatchPattern("*.doc", "test.txt")); //displays false
} 
```

# c# - 普通旧 CLR 对象与数据传输对象

> ID：725348
> 
> 赞同：422
> 
> 时间：2009-04-07T12:08:21.743
> 
> 标签：c#, .net, poco, dto

POCO = 普通旧 CLR（或更好：类）对象

DTO = 数据传输对象

在这篇[文章](http://rlacovara.blogspot.com/2009/03/what-is-difference-between-dto-and-poco.html)中有所不同，但坦率地说，我阅读的大多数博客都以定义 DTO 的方式描述 POCO：DTO 是用于在应用程序的层之间移动数据的简单数据容器。

POCO 和 DTO 是一回事吗？

* * *

## 回答 #1

> 赞同：584
> 
> 时间：2009-04-07T12:11:09.020

POCO 遵循 OOP 的规则。它应该（但不是必须）具有状态*和*行为。POCO 来自 POJO，由 Martin Fowler [[这里的轶事](http://www.martinfowler.com/bliki/POJO.html)] 创造。他使用 POJO 一词作为一种方式，使拒绝框架重 EJB 实现更加性感。POCO 应该在 .Net 中的相同上下文中使用。不要让框架支配你的对象的设计。

DTO 的唯一目的是转移状态，并且不应该有任何行为。有关使用此模式的示例，请参阅 Martin Fowler[对 DTO 的解释。](http://martinfowler.com/eaaCatalog/dataTransferObject.html)

区别在于：**POCO 描述了一种编程方法**（老式的面向对象编程），其中**DTO 是一种**用于使用对象“传输数据”的模式。

虽然您可以将 POCO 视为 DTO，但如果这样做，您将面临创建[贫血域模型的风险。](http://www.martinfowler.com/bliki/AnemicDomainModel.html)此外，结构不匹配，因为 DTO 应该设计为传输数据，而不是代表业务领域的真实结构。这样做的结果是 DTO 往往比您的实际域更平坦。

在任何合理复杂的域中，您几乎总是最好创建单独的域 POCO 并将它们转换为 DTO。DDD（领域驱动设计）定义了[反腐败层（](http://books.google.com/books?id=7dlaMs0SECsC&lpg=PA366&ots=ulHUZZRdr2&dq=anti%20corruption%20layer&pg=PA364#v=onepage&q&f=false)[这里](http://moffdub.wordpress.com/2008/09/21/anatomy-of-an-anti-corruption-layer-part-1/)的另一个链接，但最好的办法是[买书](https://rads.stackoverflow.com/amzn/click/com/0321125215)），这是一个很好的结构，可以使隔离清晰。

* * *

## 回答 #2

> 赞同：53
> 
> 时间：2009-04-09T02:32:51.173

因为我已经在我的博客文章中表明了我的立场，所以我贡献可能是多余的，但那篇文章的最后一段总结了一些事情：

*因此，总而言之，要学会爱上 POCO，并确保您不会传播任何关于它与 DTO 相同的错误信息。DTO 是简单的数据容器，用于在应用程序的各层之间移动数据。POCO 是成熟的业务对象，唯一的要求是它们是 Persistence Ignorant（没有获取或保存方法）。最后，如果您还没有查看 Jimmy Nilsson 的书，请从您当地的大学书库中挑选。它有 C# 中的示例，非常适合阅读。*

顺便说一句，Patrick，我将 POCO 作为生活方式文章阅读，我完全同意，这是一篇很棒的文章。这实际上是我推荐的 Jimmy Nilsson 书中的一部分。我不知道它可以在线获得。他的书确实是我在 POCO / DTO / Repository / 和其他 DDD 开发实践中找到的最佳信息来源。

* * *

## 回答 #3

> 赞同：28
> 
> 时间：2009-11-03T14:14:29.263

POCO 只是一个不依赖外部框架的对象。这是平原。

POCO 是否有行为无关紧要。

DTO 可能是 POCO，也可能是域对象（通常具有丰富的行为）。

通常 DTO 更有可能依赖外部框架（例如属性）来进行序列化，因为它们通常在系统边界处退出。

在典型的 Onion 风格架构（通常在广泛的 DDD 方法中使用）中，领域层位于中心，因此其对象此时不应具有该层之外的依赖关系。

* * *

## 回答 #4

> 赞同：16
> 
> 时间：2015-04-13T17:55:29.380

我为该主题写了一篇文章：[DTO vs Value Object vs POCO](http://enterprisecraftsmanship.com/2015/04/13/dto-vs-value-object-vs-poco/)。

简而言之：

*   DTO != 值对象
*   DTO ⊂ POCO
*   值对象⊂ POCO

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2009-04-07T12:16:50.117

我认为 DTO 可以是 POCO。DTO 更多的是关于对象的使用，而 POCO 更多的是对象的样式（与架构概念解耦）。

POCO 与 DTO 不同的一个示例是，当您在域模型/业务逻辑模型中谈论 POCO 时，它是问题域的一种很好的 OO 表示。您可以在整个应用程序中使用 POCO，但这可能会产生一些不良副作用，例如知识泄漏。例如，DTO 用于 UI 与之通信的服务层，DTO 是数据的平面表示，仅用于向 UI 提供数据，并将更改传达回服务层。服务层负责将 DTO 的双向映射到 POCO 域对象。

**更新**Martin Fowler[表示](http://www.martinfowler.com/bliki//LocalDTO.html)，这种方法是一条繁重的道路，只有在领域层和用户界面之间存在严重不匹配时才应采用。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2019-08-04T22:53:19.677

## TL;博士：

DTO 描述了状态转移的模式。POCO 并没有描述任何东西，只是它没有什么特别之处。这是 OOP 中“对象”的另一种说法。它来自 POJO (Java)，由 Martin Fowler 创造，他实际上只是将其描述为“对象”的一个更高级的名称，因为“对象”不是很性感，人们一直在避免它。

## 扩大...

好的，以我认为需要的更高级的方式来解释这一点，从您最初关于 DTO 的问题开始：

DTO 是一种对象模式，用于在关注层之间传输状态。他们可以有行为（即技术上可以是 poco），只要该行为不会改变状态。例如，它可能有一个序列化自身的方法。

POCO 是一个普通的对象，但“普通”的意思是它不是特殊的，没有任何特定的要求或约定。它只是意味着它是一个没有隐含模式的 CLR 对象。一个通用术语。我还听说它扩展为描述它也不能与其他框架一起使用的事实。因此，例如，如果您的 POCO`[JsonProperty]`在其属性中具有或 EF 装饰，那么我认为它不是 POCO。POCO 像您在学校学习创建的对象一样免费且不受阻碍

这里有一些不同类型的对象模式示例进行比较：

*   **视图模型**：用于为视图建模数据。通常具有数据注释来帮助特定视图（即通常不是共享对象）的绑定和验证，或者在当今时代，特定视图*组件*（例如 React）。在 MVVM 中，它还充当控制器。它不仅仅是一个 DTO；它不是传输状态，而是呈现状态，或者更具体地说，以对 UI 有用的方式形成状态。
*   **值对象**：用于表示值，应该是不可变的
*   **Aggregate Root**：用于管理状态和不变量。不应允许通过 ID 引用内部实体
*   **处理程序**：用于响应事件/消息。
*   **属性**：用作处理横切关注点的装饰。可能只允许在某些对象级别上使用（例如属性但不是类，方法但不是属性等）
*   **服务**：用于执行复杂的任务。通常是某种形式的门面。
*   **控制器**：用于控制请求和响应的流程。通常仅限于特定协议或充当某种调解者；它负有特殊责任。
*   **Factory**：用于配置和/或组装复杂对象，以在构造函数不够好时使用。也用于决定需要在运行时创建哪些对象。
*   **Repository/DAO**：用于访问数据。通常暴露 CRUD 操作或者是表示数据库模式的对象；可以用实现特定的属性进行标记。事实上，这些模式 DAO 对象中的一个实际上是另一种 DTO ......
*   **API Contracts**：可能使用序列化属性进行标记。通常需要有公共的 getter 和 setter，并且应该是轻量级的（不是过于复杂的图）；与序列化无关的方法并不典型且不鼓励使用。

这些可以被视为只是对象，但请注意，它们中的大多数通常都与模式相关联或具有隐含的限制。所以你可以称它们为“对象”，或者你可以更具体地了解它的意图并用它来称呼它。这也是我们有设计模式的原因；用几句话来描述复杂的概念。DTO 是一种模式。聚合根是一种模式，视图模型是一种模式（例如 MVC 和 MVVM）。

POCO 没有描述模式。这只是在 OOP 中引用类/对象的一种不同方式，可以是任何东西。将其视为一个抽象概念；他们可以指任何东西。IMO，这是一种单向的关系，因为一旦一个对象到达它只能干净地服务于一个目的的地步，它就不再是一个 POCO。例如，一旦你用装饰标记你的类以使其与某些框架一起工作（即“插入”它），它就不再是 POCO。因此，我认为有一些逻辑关系，如：

*   DTO 是 POCO（直到它被检测）
*   POCO 可能不是 DTO
*   视图模型是一个 POCO（直到它被检测）
*   POCO 可能不是视图模型

区分两者的关键在于保持模式清晰和一致，以避免交叉关注点并导致紧密耦合。例如，如果您有一个业务对象，它具有改变状态的方法，但也使用 EF 装饰来装饰到地狱，以便保存到 SQL Server 和 JsonProperty，以便可以通过 API 端点将其发送回。该对象将无法容忍更改，并且可能会充斥着各种属性（例如，UserId、UserPk、UserKey、UserGuid，其中一些被标记为不保存到数据库中，而另一些则被标记为不被序列化为API 端点上的 JSON）。

因此，如果您要告诉我某些东西是 DTO，那么我可能会确保它除了移动状态之外从未用于任何其他用途。如果您告诉我某些东西是视图模型，那么我可能会确保它没有被保存到数据库中。如果你告诉我某个东西是域模型，那么我可能会确保它不依赖于域之外的任何东西。但是，如果您告诉我某些东西是 POCO，那么您实际上不会告诉我太多，除了它不是也不应该被检测。

## 历史

从 Fowler 的解释中转述：在一个对象很花哨的世界中（例如，遵循特定的模式，有仪器等），它以某种方式鼓励人们避免使用不花哨的对象来捕获业务逻辑。所以他们给它起了一个花哨的名字POJO。如果您想要一个示例，他所指的是“实体 Bean”，它是具有非常具体的约定和要求等的对象之一。如果您不知道那是什么--> [Java Beans](https://en.wikipedia.org/wiki/JavaBeans) .

相比之下，POJO/POCO 只是您在学校学习创建的常规 ole 对象。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-07T12:41:58.510

DTO 的主要用例是从 Web 服务返回数据。在这种情况下，POCO 和 DTO 是等价的。POCO 中的任何行为在从 Web 服务返回时都会被删除，因此它是否具有行为并不重要。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2017-11-27T14:13:12.907

DTO 对象用于将数据反序列化为来自不同来源的对象。这些对象不是您的模型 (POCO) 对象。您需要将这些对象转换为您的模型 (POCO) 对象。转换主要是复制操作。如果它是内部源，您可以直接从源填充这些 POCO 对象，但如果它是外部源，则不建议使用。外部源具有 API 以及它们使用的 Schema 的描述。然后在 DTO 中加载请求数据并在 POCO 中转换这些请求数据要容易得多。是的，这是一个额外的步骤，但有一个原因。规则是将源中的数据加载到对象中。它可以是 JSON、XML 等等。加载后，将该数据转换为模型中所需的数据。所以大多数时候 DTO 是外部源的对象图像。

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2009-04-07T13:16:28.897

这是一般规则：DTO ==邪恶和过度设计软件的指标。POCO ==好。“企业”模式已经摧毁了 Java EE 世界中很多人的大脑。请不要在 .NET 领域重蹈覆辙。

* * *

## 回答 #10

> 赞同：-14
> 
> 时间：2015-03-05T06:07:23.470

甚至不要称他们为 DTO。他们被称为**模型**......时期。模型永远不会有行为。我不知道是谁提出了这个愚蠢的术语 DTO，但它一定是一个 .NET 的东西是我能想到的。想想 MVC 中的视图模型，同样的 dam** 事物，模型用于在服务器端或网络期间在层之间传输状态，它们都是模型。带有数据的属性。这些是您通过电线传递的模型。模型，模型模型。就是这样。

我希望愚蠢的术语 DTO 能从我们的词汇中消失。

# c# - 将集合引用分配给属性时的最佳实践

> ID：725356
> 
> 赞同：2
> 
> 时间：2009-04-07T12:09:21.537
> 
> 标签：c#, properties

我非常倾向于 C++ 思维，需要一些关于特定 C# 问题的指导。假设我们有以下类：

```
public class Foo
{
    private IList<Bar> _bars = new List<Bar>(); // Note IList<> vs List<>.

    public IList<Bar> Bars
    {
        get { return _bars; }
        set
        {
            ...
        }
    }
} 
```

现在，代替`...`，我倾向于清除参数`_bars`中`AddRange`的项目，而不是仅仅分配给。我的看法是，我想继续引用项目引用的相同*项目*，而不是引用的实际项目。`set``value``value``_bars`*`value``IList<Bar>``value`*

 *我的想法是错误的吗？你觉得这里怎么样？

编辑：经过一些评论，我意识到我必须补充一点，我希望能够在 Foo ctor 中使用现有的 Bars 集合并从该集合中初始化 _bars 。因此，通过该修订和迄今为止的评论，这感觉更好：

```
public class Foo
{
    private readonly List<Bar> _bars = new List<Bar>();

    public Foo(IEnumerable<Bar> bars)
    {
        _bars.AddRange(bars);
    }

    public IList<Bar> Bars
    {
        get { return _bars; }
    }
} 
```

好点吗？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-07T12:14:45.893

如果我们谈论的是业务（域）对象，我会公开`IEnumerable<T>`任何适合该集合的方法，通常是 Add、Remove 和 Clear。我几乎从不公开集合的 setter。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-07T12:13:00.653

是否有必要让您的 Foo 实例的 Bars 属性引用另一个 List ？

如果没有，那么我宁愿没有 Bars 的属性设置器。

如果有必要能够将 Bars 属性设置为另一个 List 实例，那么我想我会发现你的 setter 修改了列表会很奇怪。我的意思是：当我为该属性分配另一个 Bars 列表时，我会假设我的 Foo 实例随后包含我分配给该属性的列表中可用的 Bars。不多也不少。突然发现收藏中包含更多（或更少）酒吧，我会觉得很奇怪......

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-07T12:14:11.480

根据您的问题推断的要求：

```
public class Foo
{
    private readonly IList<Bar> _bars = new List<Bar>();

    public IList<Bar> Bars
    {
        get { return _bars; }
    }
} 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-07T12:27:12.663

当然，没有必要为 Bars 属性公开一个设置器。在内部，您持有对集合的引用，正如 Kent 建议的那样，可以将其标记为只读。通过 getter，调用者可以使用可用的方法（Add、Remove、Clear、AddRange 等）对集合执行他们想要的操作，但至关重要的是，它们永远无法更改您对集合对象持有的内部引用。

然后，这允许您控制允许的方法。正如 Jamie 所建议的那样，拥有属性返回类型`IEnumerable`将导致 Bars 属性公开一个只读集合。公开`IList`意味着可以修改集合的内容。该属性的设置器将使其完全开放，让调用者做他们想做的事，而您不再处于控制之中。

**编辑**

按照上面的问题编辑。这实际上取决于如何`Foo`使用该对象。

由于您主要关心的是`Foo`从现有的`Bar`对象列表初始化...

```
IList<Bar> bars = ...some list of Bars previously constructed... 
```

您最新的代码示例`Foo`强制调用者通过构造函数进行初始化，但随后也允许他们通过属性更改集合

```
Foo foo = new Foo(bars);
...
foo.Bars.Clear();
foo.Bars.AddRange(bars); 
```

当允许通过构造函数初始化对象时，您需要问自己为什么要这样做。是吗...

1.  为了来电者的方便？允许调用代码提供随后可以通过属性更改的值。
2.  因为你想限制对象的使用方式？强制在对象构造上设置值（或某些值组合）并在对象的整个生命周期内保持固定。

您需要问自己——您是否希望调用者能够在`Foo`构建对象后更改 Bars 集合的内容？

如果否 - 使 Bars 属性公开一个只读集合。
如果是——向对象添加一个默认构造函数，`Foo`这样调用者就不必提供一个列表来初始化它。但是如果他们通过重载的构造函数进行选择，他们将可以选择这样做。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-08T09:10:07.700

我可以接受此类属性的设置器，但我通常不允许空值，因为空值很少具有与空列表不同的业务含义。

```
set { _bars = value ?? new List<Bar>();} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-08T11:26:54.470

我认为从 getter 返回 _bars 引用有点狡猾。你真的希望类的客户能够修改列表的内容吗？

所以我会做以下事情：在构造/设置上制作一个副本，并为 getter 返回一个只读视图。

# python - Python中的字符串操作

> ID：725364
> 
> 赞同：1
> 
> 时间：2009-04-07T12:10:57.353
> 
> 标签：python, string, replace

我正在将一些代码从另一种语言转换为 python。该代码将一个相当大的文件读入一个字符串，然后通过数组索引来操作它，例如：

```
str[i] = 'e' 
```

由于字符串是不可变的，这不能直接在 python 中工作。在 python 中这样做的首选方法是什么？

我看过这个`string.replace()`函数，但它返回的字符串副本听起来不是很理想，因为在这种情况下，字符串是一个完整的文件。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-04-07T12:15:39.417

假设您没有使用 UTF-8 等可变长度文本编码，您可以使用`array.array`：

```
>>> import array
>>> a = array.array('c', 'foo')
>>> a[1] = 'e'
>>> a
array('c', 'feo')
>>> a.tostring()
'feo' 
```

但是由于您正在处理文件的内容，[`mmap`](http://docs.python.org/library/mmap.html)因此应该更有效：

```
>>> f = open('foo', 'r+')
>>> import mmap
>>> m = mmap.mmap(f.fileno(), 0)
>>> m[:]
'foo\n'
>>> m[1] = 'e'
>>> m[:]
'feo\n'
>>> exit()
% cat foo
feo 
```

这是一个快速基准测试脚本（对于非 Unix 操作系统，您需要将 dd 替换为其他内容）：

```
import os, time, array, mmap

def modify(s):
    for i in xrange(len(s)):
        s[i] = 'q'

def measure(func):
    start = time.time()
    func(open('foo', 'r+'))
    print func.func_name, time.time() - start

def do_split(f):
    l = list(f.read())
    modify(l)
    return ''.join(l)

def do_array(f):
    a = array.array('c', f.read())
    modify(a)
    return a.tostring()

def do_mmap(f):
    m = mmap.mmap(f.fileno(), 0)
    modify(m)

os.system('dd if=/dev/random of=foo bs=1m count=5')

measure(do_mmap)
measure(do_array)
measure(do_split) 
```

我在几年前的笔记本电脑上得到的输出符合我的直觉：

```
5+0 records in
5+0 records out
5242880 bytes transferred in 0.710966 secs (7374304 bytes/sec)
do_mmap 1.00865888596
do_array 1.09792494774
do_split 1.20163106918 
```

所以 mmap 稍微快一点，但没有一个建议的解决方案特别不同。如果您看到了巨大的差异，请尝试使用[cProfile](http://docs.python.org/library/profile.html#module-pstats)来查看花费时间的原因。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-04-07T12:14:38.217

```
l = list(str)
l[i] = 'e'
str = ''.join(l) 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-07T14:57:50.337

其他人已经回答了您问题的字符串操作部分，但我认为您应该考虑解析文件并修改文本表示的数据结构而不是直接操作文本是否会更好。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-07T12:16:05.983

尝试：

```
sl = list(s)
sl[i] = 'e'
s = ''.join(sl) 
```

# mysql - MySQL 在使用 ORDER BY 时不使用索引（“使用文件排序”）

> ID：725366
> 
> 赞同：18
> 
> 时间：2009-04-07T12:11:36.180
> 
> 标签：mysql, performance, optimization

由于在我的 SQL 代码中使用“ORDER BY”语句，我遇到了一些相当大的性能问题。

只要我不在 SQL 中使用 ORDER BY 语句，一切都很好。但是，一旦我在 SQL 代码中引入 ORDER BY:s，由于缺乏正确的索引，一切都会大大减慢。有人会认为解决这个问题是微不足道的，但从论坛讨论等情况来看，这似乎是一个相当普遍的问题，我还没有看到这个问题的明确和简洁的答案。

**问题：**给定下表...

```
创建表 values_table (
  id int(11) NOT NULL auto_increment,
  ...
  value1 int(10) unsigned NOT NULL default '0',
  value2 int(11) NOT NULL 默认 '0',
  主键（id），
  键值1（值1），
  键值2（值2），
) 引擎=MyISAM AUTO_INCREMENT=2364641 默认字符集=utf8；

```

**...在对value2**的值进行排序时，如何创建在查询 table 以获取**value1** -range 时将使用的索引？

 **目前，当不使用 ORDER BY 子句时，获取是可以的。

请参阅以下 EXPLAIN QUERY 输出：

```
好的，当不使用 ORDER BY 时：

解释 select ... from values_table this_ where this_.value1 介于 12345678 和 12349999 之间，限制为 10；

+----+-------------+--------+-------+-------------- -+----------+---------+------+------+------------- +
| 编号 | 选择类型 | 表| 类型 | 可能的键 | 关键 | key_len | 参考 | 行 | 额外 |
+----+-------------+--------+-------+-------------- -+----------+---------+------+------+------------- +
| 1 | 简单 | 这个_ | 范围 | 值1 | 值1 | 4 | 空 | 3303 | 使用位置 |
+----+-------------+--------+-------+-------------- -+----------+---------+------+------+------------- +

```

```
但是，当使用 ORDER BY 时，我得到“使用文件排序”：

解释 select ... from values_table this_ where this_.value1 在 12345678 和 12349999 之间 order by this_.value2 asc limit 10;

+----+-------------+--------+-------+-------------- -+----------+---------+------+------+------------- ----------------+
| 编号 | 选择类型 | 表| 类型 | 可能的键 | 关键 | key_len | 参考 | 行 | 额外 |
+----+-------------+--------+-------+-------------- -+----------+---------+------+------+------------- ----------------+
| 1 | 简单 | 这个_ | 范围 | 值1 | 值1 | 4 | 空 | 3303 | 使用哪里；使用文件排序 |
+----+-------------+--------+-------+-------------- -+----------+---------+------+------+------------- ----------------+

```

有关表格内容的一些附加信息：

```
从值表中选择最小值（值 1）、最大值（值 1）；
+---------------+---------------+
| 最小值（值 1）| 最大值（值2）|
+---------------+---------------+
| 0 | 4294967295 |
+---------------+---------------+

...

从值表中选择最小值（值 2）、最大值（值 2）；
+---------------+---------------+
| 最小值（值 2）| 最大值（值2）|
+---------------+---------------+
| 1 | 953359 |
+---------------+---------------+

```

如果需要任何进一步的信息来回答这个问题，请告诉我。

提前非常感谢！

**更新 #1：**添加新的复合索引（**ALTER TABLE values_table ADD INDEX (value1, value2);**）不能解决问题。添加这样的索引后，您仍然会得到“使用文件排序”。

**更新#2：**我在我的问题中没有提到的一个约束是我宁愿改变表的结构（比如添加索引等）而不是改变使用的 SQL 查询。SQL 查询是使用 Hibernate 自动生成的，因此请考虑那些或多或少是固定的。

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-04-07T12:26:26.067

在这种情况下，您不能使用索引，因为您使用的是`RANGE`过滤条件。

如果你会使用类似的东西：

```
SELECT  *
FROM    values_table this_
WHERE   this_.value1 = @value
ORDER BY
        value2
LIMIT 10 
```

，然后创建一个复合索引`(VALUE1, VALUE2)`将用于过滤和排序。

但是您使用范围条件，这就是为什么您无论如何都需要执行排序。

您的复合索引将如下所示：

```
值1 值2
----- ------
1 10
1 20
1 30
1 40
1 50
1 60
2 10
2 20
2 30
3 10
3 20
3 30
3 40

```

, 如果你选择`1`and `2`in `value1`，你仍然没有得到一整套排序好的`value2`.

如果您的索引`value2`不是很有选择性（即`DISTINCT value2`表中没有很多），您可以尝试：

```
CREATE INDEX ix_table_value2_value1 ON mytable (value2, value1)

/* Note the order, it's important */    

SELECT  *
FROM    (
        SELECT  DISTINCT value2
        FROM    mytable
        ORDER BY
                value2
        ) q,
        mytable m
WHERE   m.value2 >= q.value2
        AND m.value2 <= q.value2
        AND m.value1 BETWEEN 13123123 AND 123123123 
```

这称为`SKIP SCAN`访问方法。`MySQL`不直接支持，但是可以这样模拟。

在这种情况下将使用该访问权限，但除非包含的行数少于约，`RANGE`否则您可能不会获得任何性能优势。`DISTINCT value2``1%`

注意用法：

```
m.value2 >= q.value2
AND m.value2 <= q.value2 
```

代替

```
m.value2 = q.value2 
```

这使得对每个循环`MySQL`执行`RANGE`检查。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-07T12:17:05.543

在我看来，您有两个完全*独立*的键，一个用于 value1，一个用于 value2。

所以当你使用value1键进行检索时，记录不一定按value2的顺序返回，所以要进行排序。这仍然比全表扫描好，因为您只对满足“where value1”子句的记录进行排序。

我认为（如果这在 MySQL 中是可能的）， (value1,value2) 上的复合键可以解决这个问题。

尝试：

```
CREATE TABLE values_table (
    id int(11) NOT NULL auto_increment,
    ...
    value1 int(10) unsigned NOT NULL default '0',
    value2 int(11) NOT NULL default '0',
    PRIMARY KEY  (id),
    KEY value1 (value1),
    KEY value1and2 (value1,value2),
) ENGINE=MyISAM AUTO_INCREMENT=2364641 DEFAULT CHARSET=utf8; 
```

（或等效的`ALTER TABLE`），假设这是 MySQL 中复合键的正确语法。

在我知道的所有数据库中（我不得不承认 MySQL 不是其中之一），这将导致数据库引擎选择 value1and2 键来检索行，并且它们已经按 value2-within-value1 顺序排序，所以不需要文件排序。

如果需要，您仍然可以保留 value2 键。

# vb.net - 如何过滤掉一些导致查询字符串中的漏洞的字符？

> ID：725367
> 
> 赞同：0
> 
> 时间：2009-04-07T12:11:45.650
> 
> 标签：vb.net, security, query-string

我需要过滤掉像 /?-^%{}[];$=*`#|&@'\"<>()+,\ 这样的字符。如果它在查询中，我需要用空字符串替换它字符串。请帮帮我。我在 ASP 页面中使用它。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-08T11:05:06.957

最好的想法是使用以下功能：

```
Public Function MakeSQLSafe(ByVal sql As String) As String
    'first i'd avoid putting quote chars in as they might be valid? just double them up.
    Dim strIllegalChars As String = "/?-^%{}[];$=*`#|&@\<>()+,\"
    'replace single quotes with double so they don't cause escape character
    If sql.Contains("'") Then
        sql = sql.Replace("'", "''")
    End If
    'need to double up double quotes from what I remember to get them through
    If sql.Contains("""") Then
        sql = sql.Replace("""", """""")
    End If
    'remove illegal chars
    For Each c As Char In strIllegalChars
        If sql.Contains(c.ToString) Then
            sql = sql.Replace(c.ToString, "")
        End If
    Next

    Return sql
End Function 
```

这还没有经过测试，它可能会变得更有效率，但它应该能让你继续前进。无论您在应用程序中的何处执行 sql，只需将 sql 包装在此函数中以在执行前清理字符串：

ExecuteSQL(MakeSQLSafe(strSQL))

希望有帮助

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-08T11:27:16.090

与任何字符串清理一样，您最好使用指示允许哪些字符的白名单*，*而不是使用不允许的字符的*黑名单*。

这个关于过滤 HTML 标签的问题导致了一个接受的答案，建议使用正则表达式来匹配白名单：[如何过滤除某个白名单之外的所有 HTML 标签？](https://stackoverflow.com/questions/307013/how-do-i-filter-all-html-tags-except-a-certain-whitelist)- 我建议你做一些非常相似的事情。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-13T20:48:14.973

我正在使用 URL 路由，我发现这很好用，将 URL 的每个部分传递给这个函数。它比您需要的更多，因为它将“&”等字符转换为“and”，但您可以修改它以适应：

```
public static string CleanUrl(this string urlpart) {

    // convert accented characters to regular ones
    string cleaned = urlpart.Trim().anglicized();

    // do some pretty conversions
    cleaned = Regex.Replace(cleaned, "&nbsp;", "-");
    cleaned = Regex.Replace(cleaned, "#", "no.");
    cleaned = Regex.Replace(cleaned, "&", "and");
    cleaned = Regex.Replace(cleaned, "%", "percent");
    cleaned = Regex.Replace(cleaned, "@", "at");

    // strip all illegal characters like punctuation
    cleaned = Regex.Replace(cleaned, "[^A-Za-z0-9- ]", "");

    // convert spaces to dashes
    cleaned = Regex.Replace(cleaned, " +", "-");

    // If we're left with nothing after everything is stripped and cleaned
    if (cleaned.Length == 0)
        cleaned = "no-description";

    // return lowercased string
    return cleaned.ToLower();
}

// Convert accented characters to standardized ones
private static string anglicized(this string urlpart) {
    string beforeConversion = "àÀâÂäÄáÁéÉèÈêÊëËìÌîÎïÏòÒôÔöÖùÙûÛüÜçÇ’ñ";
    string afterConversion = "aAaAaAaAeEeEeEeEiIiIiIoOoOoOuUuUuUcC'n";

    string cleaned = urlpart;

    for (int i = 0; i < beforeConversion.Length; i++) {
         cleaned = Regex.Replace(urlpart, afterConversion[i].ToString(), afterConversion[i].ToString());
    }
    return cleaned;

    // Spanish : ÁÉÍÑÓÚÜ¡¿áéíñóúü"

} 
```

# c# - C#读取返回数组的每个值

> ID：725369
> 
> 赞同：1
> 
> 时间：2009-04-07T12:11:49.720
> 
> 标签：c#, arrays

我返回了一个数组，但是由于我是编程新手，所以我不知道如何读取每个值。有人可以指出我正确的方向吗？

我的代码如下。

```
private void testToolStripMenuItem_Click(object sender, EventArgs e)
{
 foreach (int name in getNames()) //<----I'm wrong here I guess
 {
    MessageBox.Show(name.ToString());
 }
}

private ArrayList getNames()
{
 //some code...
 ..
 ...
 return names;
} 
```

谢谢大家

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-07T12:15:52.520

首先，您不是返回一个数组，而是一个`ArrayList`实例。其次，为什么一个名字是一个`int`？你肯定是说`string`？最后，如果您使用的是 .NET 2.0 或更高版本，则可以使用泛型来改进您的代码。所以，使用`List<string>`而不是`ArrayList`.

```
private void testToolStripMenuItem_Click(object sender, EventArgs e)
{
    foreach (string name in getNames())
    {
        MessageBox.Show(name);
    }
}

private List<string> GetNames()
{
    var names = new List<string>();
    names.Add("Kent");
    return names;
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-07T12:16:46.760

这里的问题是 getNames 返回一个*对象*数组列表——而不是整数。

您可以使用此更改重写您的代码：

```
 foreach (object nameobj in getNames())
 {
    string name = (string)nameobj;
    MessageBox.Show(name);
 } 
```

或者，您可以（并且应该）使用泛型来保持一切整洁。这可能看起来像这样（未经测试的）代码：

```
private void testToolStripMenuItem_Click(object sender, EventArgs e)
{
 foreach (string name in getNames()) 
 {
    MessageBox.Show(name);
 }
}

private IList<string> getNames()
{
 //some code...
 List<string> names = new List<string>();
 names.Add("Scott");
 ..
 ...
 return names;
} 
```

添加使用 for `System.Collections.Generic`。此外，正如其他人所注意到的，我将其更改为`string`from `int`。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-07T12:15:44.253

而不是使用`ArrayList`，尝试使用`List<int>`。

我猜在 foreach 语句中，您遇到了强制转换异常。这很难说，因为你遗漏了`getNames()`.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-07T12:17:26.870

尝试返回一个 int 列表。像这样：

```
private List<int> getNames()
{
    //some code...
     ..
     ...
     return names;
} 
```

要么，要么检查它是否真的在你的列表中，所以你没有做任何类似 list.add("5") 的事情。那么 5 将是一个字符串，而不是一个 int。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-07T12:34:13.367

ArrayList 将项目存储为对象。因此，您需要将其拆箱为所需的类型（在您的情况下为 int）。但是为什么名称是 int 而不是 string 呢？

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-04-07T12:21:57.340

这可能会让你开始：

```
String key, val;

foreach (DictionaryEntry de in myArrayList)
{
     key = (String)de.Key;
     val = (MyObjectType)de.Value;
} 
```

编辑：更新以将 IEnumerator 版本删除为 foreach 版本。

# c++ - 观察者模式中的 const-correct Notifier

> ID：725375
> 
> 赞同：2
> 
> 时间：2009-04-07T12:13:33.023
> 
> 标签：c++, constants, observer-pattern, const-correctness

我想实现一个不改变模型的模型类的观察者。因此，它应该能够使用 const-Reference 来访问模型。但观察员登记禁止这样做。

以下是我的项目中如何实现观察者模式：

```
 //Attributes of type Observable are used by classes that want to notify others
//of state changes. Observing Objects register themselves with AddObserver.
//The Observable Object calls NotifyObservers when necessary.
class Notifier
{
public:
    AddObserver(Observer*);
    RemoveObserver(Observer*);
    NotifyObservers();
};

class Model
{
public:
    Notifier& GetNotifier() //Is non const because it needs to return a non-const 
    {                       //reference to allow Observers to register themselves.

         return m_Notifier; 
    }

    int QueryState() const;

    void ChangeModel(int newState)
    {
        m_Notifier.NotifyObservers();
    }

private:
    Notifier m_Notifier;
};

//This View does not Modify the Model.
class MyNonModifingView : public Observer
{
public:
    SetModel(Model* aModel)  //should be const Model* aModel...
    {
        m_Model = aModel;
        m_Model->GetNotifier().AddObserver(this); //...but can't because
        //SetModel needs to call GetNotifier and add itself, which requires
        //non-const AddObserver and GetNotifier methods.
    }

    void Update()  //Part of Observer-Interface, called by Notifiers
    {
        m_Model->QueryState();
    }

}; 

```

非修改观察者需要“更改”模型的唯一地方是它想要注册它的时候。我觉得我无法避免 const_cast 这里，但我想知道是否有更好的解决方案。

旁注：换句话说，我不认为模型对象管理的“观察者列表”是模型状态的一部分。C++ 无法区分并将状态和观察者混为一谈，迫使两者都是 const 或 non-const。

干杯，菲利克斯

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-07T12:48:15.470

如果您认为 Notifier 对象不是拥有它的 Model 对象的一部分，因此修改 Notifier 不会“算作”修改 Model，那么将 getNotifier 设置为返回非常量引用的 const 方法：

```
Notifier& GetNotifier() const //Is const but returns a non-const 
{                             //reference to allow Observers to 
                              //register themselves.

     return m_Notifier; 
} 
```

然后，您必须将 m_Notifier 标记为可变，或者通过指针（或智能指针）或引用而不是包含来拥有它。无论哪种方式，您都可以避免使用 const_cast。通常最好嵌入对象而不是指向/引用它们，但是如果在这种情况下通知程序不被视为使用它的模型的一部分，那么嵌入就不是必需的。通过引用拥有它会迫使您在构造模型时初始化引用，这会导致依赖注入，这不是坏事。拥有智能指针意味着，与嵌入一样，您不必对清理做任何事情。

可能还有其他设计方法（例如 Vinay 添加另一个类），但是您的评论“是非常量，因为它需要返回非常量引用”向我表明您可以完全按照您的意愿去做，你只是没有意识到你可以。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-07T12:18:18.223

我从您的代码中不清楚，但如果您有一个逻辑上为 const 但物理上非 const 的成员，通常的解决方案是使其**mutable**。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-07T12:42:34.530

反而

```
view->SetModel( model ); 
```

你可以打电话

```
model->getNotifier()->addObserver( view );
view->setModel( model ); // this function will accept const Model* 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-07T13:00:49.993

我的其他答案的另一种方法。

根本不要让观察者持有指向模型的指针。将 a 传递给`const *Model`由通知程序调用的更新方法。这需要知道它正在通知什么模型，但这可能并不难，因为它嵌入在模型中，所以它可能总是那个......

如果观察者在 SetModel 中需要一个非常量模型，您仍然可以给它一个，但更有可能的是您将完全摆脱 SetModel，而只需调用`some_model.AddObserver(some_observer)`而不是`some_observer.SetModel(some_model)`.

同样，但不那么彻底，您可以保持原样，但要声明`const *Model m_Model`。然后你可以在SetModel中使用aModel作为一个非常量Model，但是观察者没有其他方法可以修改这个Model。

如果期望观察者能够在没有用于这样做的参数的情况下注销自身，则这些更改都不会起作用。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-07T12:20:37.250

除了返回 const 模型，您还可以再创建一个类来包装 Notifier 对象并实现 Notifier。（适配器模式）。观察者可以使用新创建的类进行注册/注销。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-07T13:18:13.197

我希望控制器能解决这个问题：

1.Controller知道Model并允许View注册到Model。

```
class MyController 
{
public:

    //Controller associated with the Model
    MyController(Model* pModel):m_pModel(pModel)
    {
    }

    //Provide the facility to register the view. 
    //Alternatively, if there is 1:1 relation between controller and View then View poniter can be stored locally inside Controller
    void registerObserver(Observer* pObserver) 
    {
               //Register observer  
        m_pModel->GetNotifier().AddObserver(pObserver);
               //set the model in view
        pObserver->SetModel(m_pModel);

    }
}; 
```

2.更改 MyNonModifiningView 以接受 const Model* aModel

```
class MyNonModifingView : public Observer
{
public:
    SetModel(const Model* aModel) 
    {
        m_Model = aModel;
    //NO need to register here, My controller does it for me.
        //   m_Model->GetNotifier().AddObserver(this);
    }

    void Update()  //Part of Observer-Interface, called by Notifiers
    {
        m_Model->QueryState();
    }

}; 
```

# email - 如何快速将文件批量发送到电子邮件？

> ID：725385
> 
> 赞同：0
> 
> 时间：2009-04-07T12:14:54.970
> 
> 标签：email, terminal, mutt

我经常在 Gmail 中发送文件以在不同计算机之间交换文件。这很麻烦。我想快速发送我的文件，例如错误日志。我找到了一篇关于 Mutt 的有前途的文章 [1]，但它显然不是我想要的：

> 请注意，mutt 是一个纯 MUA，没有合适的电子邮件服务器就无法发送电子邮件。

我**不想要电子邮件服务器**，因为我无法将它安装到客户的计算机上。我不需要知道发件人。我想快速将许多错误日志发送到我的 Gmail。我看起来像：

> mutt -s "许多错误日志" -a ./log1 -a ./log2 -a ./log3 mygmail@gmail.com

我真的很想在终端做这份工作。在 Gmail 中批量发送文件太耗时了。**如何快速发送大量文件？**

[1] [http://www.cyberciti.biz/tips/sending-mail-with-attachment.html](http://www.cyberciti.biz/tips/sending-mail-with-attachment.html)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-07T14:52:29.617

Mutt 可以配置为使用与默认不同的 MTA `sendmail`。您可以安装 SSMTP（[在此处](http://wiki.dreamhost.com/SSMTP)描述并可[在此处](http://wiki.dreamhost.com/SSMTP)下载）或[ESMTP](http://esmtp.sourceforge.net/)并将其配置为直接发送到 Gmail 的 Web 服务器，然后将 Mutt 配置为使用 SSMTP 或 ESMTP。[这在这个 Ubuntu 教程](http://ubuntu-tutorials.com/2007/07/08/configuring-mutt-to-use-an-alternate-mta-esmtp/)中有很好的描述。如果安装系统范围的二进制文件不是一个选项，您应该能够将 SSMTP 或 ESMTP 安装到本地文件夹。

如果您更喜欢脚本，[mimesend是 Perl 的](http://cpansearch.perl.org/src/DONEILL/MIME-tools-5.427/examples/mimesend)[MIME-tools 包](http://search.cpan.org/dist/MIME-tools/)中的示例程序之一，它与您的 mutt 命令执行相同的操作，并且可能被黑客入侵以连接到 Gmail 的 Web 服务器。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-07T14:11:51.447

你为什么要使用电子邮件？其他选项：

*   FTP/SCP（自己运行服务器，或购买托管服务）
*   [像Dropbox](https://www.getdropbox.com/home)这样的互联网存储服务。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-07T14:24:00.387

假设您不想像上面建议的那样使用 ftp/scp，这就是我解决类似问题的方法...从客户端通过电子邮件发送日志：

1.  我在我的服务器上创建了一个 cgi 脚本，它能够将东西邮寄给自己。一种电子邮件代理网络服务。

2.  客户端将它需要发送的文件（显然连同身份验证一起）发布到该 cgi 脚本。

这样，客户端只需要与我的服务器交谈，而不是与邮件服务器交谈。

也许这会有所帮助。-大学教师

# c# - Web 应用程序之间的通信，1 个 SSL 证书，其他没有

> ID：725387
> 
> 赞同：0
> 
> 时间：2009-04-07T12:15:04.207
> 
> 标签：c#, asp.net, xml, ssl

这种情况：我有一个没有 SSL 的 web 服务，它为另一个 web 应用程序提供了两个页面。当用户提交这些页面时，带有私人信息的 XML 文件将发送到 Web 服务。

如何对 XML 文件提供必要的隐私保护？一个证书是否足以提供适当的安全性？

我不确定这个，并且正处于项目的准备阶段......所以需要了解这部分所涉及的工作......

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-07T12:38:26.663

证书与服务器的主机名相关联（或者，使用通配符证书，域中的所有主机）。因此，如果这两个服务位于同一主机上，则两者都可以使用相同的证书。

如果它们不在同一主机上，则非 SSL 服务将没有传输安全性，除非单独添加。WCF 支持消息（或消息的一部分）加密。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-07T12:39:07.737

作为 SSL 的替代方案，您可以使用 System.Security.Cryptography 中可用的任何算法自己加密文件，但是您必须制定一种机制来交换您的密钥。

然而，到目前为止，最简单的方法是让两个 Web 服务都使用 SSL 端点。这将一举解决您所有的机密性、完整性和身份问题。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-10T07:39:01.277

最简单的解决方案当然是使用 TLS，ex-SSL（每种编程语言都广泛支持）。

无需购买证书（它不会带来额外的安全性，主要是为了让 PHB 感觉更好）：要么创建自签名证书，要么设置自己的 CA。

# asp.net - 如何从javascript控制页面发布？

> ID：725393
> 
> 赞同：0
> 
> 时间：2009-04-07T12:16:40.660
> 
> 标签：asp.net, javascript

这就是我想做的。我希望用户能够删除他们自己的帖子，但我希望他们先确认这一点，所以当用户单击删除链接时，我想显示一个带有是和否的确认对话框（标准 Javascript 确认对话框），如果用户选择“否”，没有任何反应，页面不会回发，但如果他们选择“是”，页面应该回发到服务器，如何使用 ASP.NET 中的 Javascript 来完成？

谢谢

编辑：非常感谢大家，我想我会去 OnClientClick="return confirm("Are you sure?");"

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-07T12:20:14.927

您需要（在您的代码后面）：

1.  使用 ClientScript 对象以字符串形式获取按钮的回发引用
2.  修改按钮的 OnClientClick 属性以包含以下 JavaScript 和先前检索到的引用：

    btn.OnClientClick = "return confirm('你确定吗？');" + btnPostbackReferenceString;

3.  利润。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-07T12:21:04.443

像这样将您的确认添加到您的按钮：

```
submitButton.Attributes["onclick"] = 
  "if (!confirm('Do you want to continue ?')){return false;}"; 
```

如果用户选择 no，confirm 返回 false，则您的代码返回 false，回发将被避免。

请注意：如果您**返回 confirm('some text')**，无论用户选择什么，您的回发都将被避免。

# php - 删除从最后出现的特定字符序列开始的所有字符

> ID：725400
> 
> 赞同：3
> 
> 时间：2009-04-07T12:17:14.140
> 
> 标签：php, regex, parsing, split, explode

我正在解析一些电子邮件。移动邮件、iPhone 和我假设 iPod touch 附加一个签名作为单独的边界，使其易于删除。并非所有邮件客户端都这样做，并且只需使用“--”作为签名分隔符。

我需要从字符串中删除“--”，但只需要最后一次出现。

样本副本

```
 hello, this is some email copy-- check this out
 --
 Tom Foolery 
```

我考虑过拆分'--'，删除最后一部分，我会拥有它，但如果没有匹配项，似乎都没有返回很好的价值让我知道它是否做了任何事情`explode()`。`split()`

我不能`preg_replace()`超过一条线。我已将所有行尾标准化为`\n`.

最好的建议是什么`hello, this is some email copy-- check this out`，不接受，会有没有签名的情况，当然也会有我无法涵盖所有​​情况的情况。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-07T12:22:39.570

实际上[正确的签名分隔符](https://www.rfc-editor.org/rfc/rfc3676#section-4.3)是`"-- \n"`（注意换行符之前的空格），因此分隔符正则表达式应该是`'^-- $'`. 虽然您可能会考虑使用`'^--\s*$'`，但它会与 OE 一起使用，但会出错。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-07T12:24:46.820

试试这个：

```
preg_replace('/--[\r\n]+.*/s', '', $body) 
```

这将在第一次出现后删除所有内容，`--`然后是一个或多个换行符。如果您只想删除最后一次出现，请`/.*--[\r\n]+.*/s`改用。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-07T12:40:14.067

您不能缓存该用户或服务发送的最后几封电子邮件并进行比较，而不仅仅是在之后砍掉所有内容。底部看起来像其他的位可以安全地移除，而正确的消息完好无损。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-04-07T22:57:39.730

我认为为了更加防弹，我将采用非正则表达式路线

```
 echo substr($body, 0, strrpos($body, "\n--")); 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2012-11-12T03:02:38.187

这似乎给了我最好的结果：

`$body = preg_replace('/\s*(.+)\s*[\r\n]--\s+.*/s', '$1', $body);`

*   它将匹配并修剪最后一个“（换行）--（可选空格/换行）（签名）”
*   修剪签名前所有剩余的换行符
*   修剪正文的开始/结束空格（签名前的剩余换行符，正文开头的空格等）
*   仅当签名前有一些文本（非空白）时才有效（否则它不会剥离签名并将其原封不动地返回）

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2021-03-10T14:44:45.663

要彻底删除所有签名及其前导换行符，请执行贪婪匹配直到最后出现的`--`. 在匹配最后一个`--`后跟零个或多个空格然后是与系统无关的换行符之前，使用 重新开始全字符串匹配`\K`，然后匹配要替换的所有剩余字符串。

代码：（[演示](https://3v4l.org/rgmOi)）

```
$string = <<<BODY
hello, this is some email copy-- check this out
--
Tom Foolery
BODY;

var_export(preg_replace('~.*\K\R-- *\R.*~s', '', $string)); 
```

输出：

```
'hello, this is some email copy-- check this out' 
```

# c# - 如何从 C# 中的另一个类访问计时器

> ID：725413
> 
> 赞同：0
> 
> 时间：2009-04-07T12:19:51.370
> 
> 标签：c#, winforms, timer

另请参阅：[如何从不同的线程/类启用计时器](https://stackoverflow.com/questions/725735/how-to-enable-a-timer-from-a-different-thread-class)

计时器被分配给一个表单，我想在特定位置启用它，但来自另一个类。*我不想公开*

这是我用来访问备忘录的代码

```
 public string TextValue
    {
        set
        {
            if (this.Memo.InvokeRequired)
            {
                this.Invoke((MethodInvoker)delegate
                {
                    this.Memo.Text += value + "\n";
                });
            }
            else
            {
                this.Memo.Text += value + "\n";
            }
        }
    }

    public static void addtxt(string txt)
    {
        var form = Form.ActiveForm as Form1;
        if(form != null)
            form.TextValue = txt;
    } 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-07T12:22:59.460

如果您不想公开计时器本身，请公开`public`您可以调用以启用计时器的方法或属性。显然`Form`，启用 Timer 的 将需要对`Form`拥有`Timer`.

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-07T12:23:06.340

您想如何启用计时器？采取什么行动来实现它？

是否可以将事件添加到要启用计时器的类中，并在包含计时器的表单上订阅该事件？在该事件的事件处理程序中，您可以启用计时器。

当其他类引发事件时，事件处理程序将启用计时器。

```
public class SomeOtherClassThatDoesStuff
{
   public event EventHandler SomethingHappened;

   public void DoStuff()
   {
      ...
      if( SomethingHappened != null )
         SomethingHappened;
      ...
   }
}

public class Form1
{

    private void Button1_Click(object sender, EventArgs e )
    {

      SomeOtherClassThatDoesStuff o = new SomeOtherClassThatDoesStuff();
      o.SomethingHappened += new EventHandler(EnableTimer);

      o.DoStuff();
    }

    private void EnableTimer(object sender, EventArgs e )
    {
       myTimer.Enabled = true;
    }
} 
```

像这样的东西。（我没有测试过，我什至没有编译它，但我想你会明白的:)）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-07T12:22:43.893

使计时器“内部”，然后程序集中的其他类可以访问它。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-07T12:26:34.430

您可以添加一个访问器方法来启用计时器，这将允许您将计时器保持为私有但将方法设为公开，这可行吗？

此外，您可以考虑将访问器设置为[protected](http://msdn.microsoft.com/en-us/library/bcd5672a(VS.71).aspx)或[internal](http://msdn.microsoft.com/en-us/library/7c5ka91b(VS.80).aspx)，这取决于调用它的人可能不需要公开。

# testing - 如何使用 Selenium 测试使用 openid 登录

> ID：725417
> 
> 赞同：2
> 
> 时间：2009-04-07T12:21:11.400
> 
> 标签：testing, openid, selenium, browser-automation

有没有办法使用 Selenium 测试登录到具有开放 ID 的站点？

在 Selenium 中，所有测试都存在于服务器中，因此一旦在网页的相应字段中填写了 open id URL，我就会被带到第 3 方网页以输入凭据，并且我的测试无法再运行。

有没有解决的办法？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-07T13:05:12.480

是的 - 使用 Selenium RC。它解决了基本 Selenium Core 的跨域问题，并允许您针对多个站点编写脚本。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-15T08:12:00.283

我想，从技术上讲，您可以在您的测试域中包含一个非常愚蠢的 OpenID 服务器，但是 Patrick 建议的支持跨域操作的测试框架听起来是一个更好的主意。

虽然，我想这取决于您要测试的内容。使用第三方 OpenID 服务器可能对您的测试不利，因为更改该服务器的 UI 可能会导致您的测试中断。或者，也许您想确保您的代码与该服务器正确互操作，在这种情况下，使用 3rd 方正是您想要测试的。

# objective-c - 为什么在 Category 中声明一个方法而不实现它？

> ID：725419
> 
> 赞同：1
> 
> 时间：2009-04-07T12:22:06.030
> 
> 标签：objective-c, cocoa

我正在阅读一个开源项目的源代码，我在一个实现文件中遇到了以下类别定义：

```
@interface QCView (Private)
- (void)_pause;
- (void)setClearsBackground:(BOOL)flag;
@end 
```

起初我认为该`setClearsBackground`方法正在*添加*到`QCView`类定义中。但是当我搜索这个实现文件时，我没有找到一个`setClearsBackground`方法的实现（尽管这个消息被发送到`QCView`文件中几个地方的实例）。

为什么有人会在框架类上声明一个方法，`QCView`但又不在任何地方实现该方法？我唯一的猜测是，这是一种绕过编译器并调用未在`QCView.h`文件中声明的方法的方法。但这似乎不太可能，因为开发人员怎么会知道这种方法的实现甚至存在？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-07T12:29:52.237

开发人员可能使用了诸如[类转储](http://www.codethecode.com/projects/class-dump/)之类的工具来生成标头，其中列出了框架实现的所有方法。如果您需要访问 SPI 并且别无选择，这很有用。如果没有声明，Objective-C 会对方法参数做出假设，并且除了生成警告之外，还可能生成不正确的方法调用。

所有关于在未来操作系统版本中破坏的未记录接口的常见警告都适用。至少，您应该检查对象是否响应该方法 ( `-[NSObject respondsToSelector]`)。对于额外的偏执，您可以将调用包装在异常块中，以防方法保留但其行为发生变化。

# configuration - ClickOnce 和应用程序设置

> ID：725429
> 
> 赞同：2
> 
> 时间：2009-04-07T12:24:08.477
> 
> 标签：configuration, clickonce

我有一个 ClickOnce 部署的 Windows 窗体应用程序，它使用两个关键功能的应用程序设置：用户连接的数据库以及他们是否使用复制服务或连接到主服务器。这些设置在安装最新更新后针对某些（但不是全部）用户进行了更改。

什么会导致应用程序设置被更改，我该如何防止它在未来发生？我能想到的唯一解释是，我是从与过去不同的工作站发布的。

# iphone - 什么最能解释 [myVar dealloc] 和 [myVar release] 之 间的区别？

> ID：725431
> 
> 赞同：7
> 
> 时间：2009-04-07T12:25:03.903
> 
> 标签：iphone, release, dealloc

我想我知道区别，但不知道如何正确解释。

dealloc 会立即完全删除该变量保留的内存。

release 将该变量内存的保留计数器递减 -1。如果它是1，那么它是0，所以它会在那个时刻与dealloc具有相同的效果。

是对的吗？还是有更好的简短解释？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-04-07T12:32:51.247

这是完全正确的。

但是在使用对象时您不会使用`dealloc`, 因为您不知道保留计数是多少。你也不在乎。你只是说你不再需要它，通过调用`release`. 一旦没有人这样做，对象就会调用`dealloc`自己。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-04-07T12:36:41.783

一切都正确，但是您缺少的一个关键点是您永远不应该自己调用 dealloc。以下是 Apple 文档中有关 NSObject 的 dealloc 方法的一些信息：

（来自[http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/nsobject_Class/Reference/Reference.html#//apple_ref/occ/instm/NSObject/dealloc](http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/nsobject_Class/Reference/Reference.html#//apple_ref/occ/instm/NSObject/dealloc)）

> 您永远不会直接发送 dealloc 消息。相反，对象的 dealloc 方法是通过释放 NSObject 协议方法间接调用的（如果释放消息导致接收者的保留计数变为 0）。有关使用这些方法的更多详细信息，请参阅 Cocoa 的内存管理编程指南。
> 
> 子类必须实现它们自己的 dealloc 版本，以允许释放对象消耗的任何额外内存——例如为数据或对象实例变量动态分配的存储被释放对象所拥有。在执行特定于类的释放后，子类方法应该通过向 super 发送消息来合并超类版本的 dealloc：

# java - 创建图形复杂的 Java Swing 应用程序的最佳编程过程？

> ID：725432
> 
> 赞同：1
> 
> 时间：2009-04-07T12:25:09.330
> 
> 标签：java, user-interface, design-patterns, swing

我正在启动一个相当复杂的 Swing 应用程序，该应用程序主要面向图形，具有大约 1000 个单独的 jpeg、30 多种不同的形式，以及跟踪用户交互速率的计时器。

我的问题是从实际编程的角度来看，在我已经为整个项目编写了一个故事板并获得了客户的批准之后，开始编程这个大型项目的最佳位置（代码方面）是什么，我应该以什么顺序编程元素？

（示例答案：首先开始编写所有必要部分的声明和初始化语句，然后编写所有方法的骨架版本，然后处理摆动设计和布局管理器（gridbag），然后处理事件和监听器）

感谢大家的建议，哦，顺便说一句，我真的很喜欢 StackOverflow！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-07T12:58:33.963

您正在描述一种“瀑布式”开发方法——首先完成某个级别的程序，然后完成下一个级别等。这确实是一种可能的方法，但很多人发现它所谓的[跟踪子弹](http://www.artima.com/intv/tracer.html)方法更好；首先做一些*功能性*的东西，然后从中学习，调整需要的东西并继续。如果您与客户一起工作，这尤其有用，因为通过展示原型，您可以获得反馈并避免误解。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-07T13:02:14.983

我会拿起一本关于 TDD 的书，即使您不打算编写自动化测试，它也会对如何处理您的项目提供很多很好的建议。

在那之后，我会选择一个单一的功能，它垂直地贯穿你的应用程序并实现端到端。这应该使您能够获得任何基础设施/框架，并发现可能从您的设计中抛出的任何问题。

如果您的客户有空闲时间，请沿途向他们展示每一项功能，并确保您所做的每一项都为产品增加了一些价值。

- 编辑

此外，我会看看为您的屏幕使用图形设计器，而不是使用 GridBagLayout。这只会浪费时间，并且在更换屏幕时很快就会成为维护的噩梦。我个人更喜欢以资源文件类型方式工作的那些，其中屏幕本质上是“编译”的，您只需将其加载到您的代码中

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-07T13:16:57.240

我更喜欢编写 UI，首先我编写（使用 TDD）实现 UI 行为的后端类，而不依赖于 UI 的呈现（即没有 Swing 或任何其他 UI 库）。之后，我编写了一个带有 UI 库的精简表示层，其中所有事件处理程序等都委托给 UI 后端（它们应该只是没有任何逻辑的单行代码）。这样做的好处是您可以轻松地为 UI 编写测试，从而更容易更改和维护 UI。有关详细信息，请参阅[http://martinfowler.com/eaaDev/ModelViewPresenter.html](http://martinfowler.com/eaaDev/ModelViewPresenter.html)上的链接。

在更高的层次上，首先实现对用户产生最大价值的功能。尝试尽早展示一些东西，以便您可以从用户那里获得反馈并改进 UI 中的任何缺陷。您可以伪造大多数后台服务（例如数据库和业务规则），以便可以使用 UI，即使它还没有真正做任何事情。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-09T16:14:24.090

我认为**mad-j**有智慧的话。

不要专注于“全部”......识别部分/组件/模块并交付它们。然后继续下一个和下一个。这称为[迭代和增量开发](http://en.wikipedia.org/wiki/Iterative_and_incremental_development)（对瀑布模型弱点的回应）！

这也将允许您创建工具和框架，使您的开发更容易和更快。

这将使您能够尽早向客户展示功能部件。不过给点建议！您的客户很可能会不断更改其需求、更改 GUI、改变主意等。我已经看到整个项目由于这些持续更改而失败。在此问题上不再提及，但请注意它很可能会发生并准备好处理它！

如果您和客户有功能部件，它们可以立即进行测试，而不是测试一个庞大的系统。

通过迭代地完成功能部分可能会让您在每一层工作，在大多数 API 上使用大多数工具和技术。这样做的好处是它可以让您及早识别复杂性。正是这些复杂的领域使以下陈述成立：

> 前 90% 的代码占了前 90% 的开发时间。剩下的 10% 的代码占了另外 90% 的开发时间。——汤姆·卡吉尔

识别、承认和理解这些复杂领域将使您能够更有效地管理风险并改变您的努力和资源。

祝你好运，

杰奇！

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-07T13:18:02.167

正如 MrWiggles 所提到的，您可能需要考虑使用 UI 构建器。

如果您正在考虑编写许多表单，并且看起来表单数据可以很好地匹配某些 javabean，您可能需要考虑首先创建一些框架面板。

如果您可以创建一些简单的基类来处理连接（将字段同步到 bean，反之亦然），它将为您节省大量工作。

您甚至可能想要设置一些面板，这些面板将基于 bean “自动创建”字段。只需传入一个 bean，面板就会自行创建。诀窍是为字段指定布局，并处理具有固定值、验证等的字段（可以使用 javabean 属性编辑器处理固定值 - 请参阅[http://javadude.com/articles/propedit/index。 .html](http://javadude.com/articles/propedit/index.html) _

如果您打算使用 Swing（eclipse RCP 很好，顺便说一句），您可能需要查看 Swing 应用程序框架（[https://appframework.dev.java.net/](https://appframework.dev.java.net/)）。如果不直接使用它，它可能会给您一些关于如何设置绑定的想法。

希望这个对你有帮助

* * *

## 回答 #6

> 赞同：-6
> 
> 时间：2009-04-07T12:37:57.740

你真的确定 Swing 吗？从 EMF 开始，Eclipse RCP 更好更灵活

无论如何，对于 Swing，首先我将准备一个所有的 XSLT 模板：公共代码例程和其他公共部分，然后将它们引入抽象和接口类，您使用的 ORM 模式。

然后我会设计一个通用的 UI 方案，这个“xslize”也是。

毕竟使用 ANT XSLT 处理器，我将根据您的规范准备一个完整的构建过程。

PS 我在 2001 年之前为简单的 web 和 swing cruds 制作了类似的项目，如果您使用一些特殊的 UI 设计器，您还可以使用 xslt 嵌套或编写每个规范，而不会在您的 ui 原始概念中添加脏代码，所以当我制作/添加删除全部或单个代码的功能，最多 30 秒用于完全重建 ALL，当然您必须“XSLIZE”全部使用许多 xslt 覆盖器/导入。

# c# - 覆盖（强制转换）

> ID：725435
> 
> 赞同：14
> 
> 时间：2009-04-07T12:25:30.577
> 
> 标签：c#, casting

如果我有一个基类和两个派生类，并且我想手动实现两个派生类之间的转换，有什么办法吗？（在 C# 中）

```
abstract class AbsBase
{
   private int A;
   private int B;
   private int C;
   private int D;
}

class Imp_A : AbsBase
{
   private List<int> E;
}

class Imp_B : AbsBase
{
   private int lastE;
} 
```

通常我会从 Imp_A -> Imp_B 进行投射，我希望 E 列表中的最后一个值是“LastE”。此外，如果有三个或更多的实施类别（例如 Salary、Hourly、Consultant 和前雇员）怎么办？

不管这在架构上是否合理（我无法描述整个应用程序并简明扼要）有可能吗？

我打算编写一个转换器，但据我了解，转换器将创建 Imp_B 类的新对象，我不需要它，因为“员工”在任何时候都只是选项之一。

-德文

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2009-04-07T12:44:10.393

您必须实现[显式](https://docs.microsoft.com/en-us/dotnet/csharp/language-reference/keywords/explicit)或[隐式](https://docs.microsoft.com/en-us/dotnet/csharp/language-reference/keywords/implicit)运算符。

```
class Imp_A : AbsBase
{
   public static explicit operator Imp_B(Imp_A a)
   {
      Imp_B b = new Imp_B();

      // Do things with b

      return b;
   }
} 
```

现在您可以执行以下操作。

```
Imp_A a = new Imp_A();
Imp_B b = (Imp_B) a; 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-07T12:27:34.520

如果可能的话，我建议你这样写 Imp_B：

```
class Imp_B : Imp_A
{
    private int A;
    private int B;
    private int C;
    private int D;
    private int lastE { get { return this.E.Last(); } }
} 
```

如果您实际上不能从 ImpB 派生，那么您就不可能按照您想要的方式透明地将 ImpA 对象“视为” ImpB，因为它们在内存中并不相同。因此，实现显式转换。

# struts2 - 如何使用 struts2 创建向导屏幕布局？

> ID：725441
> 
> 赞同：1
> 
> 时间：2009-04-07T12:26:52.993
> 
> 标签：struts2

我想为我的项目构建一个向导屏幕。为此，我正在使用 struts2 框架。谁能帮我....

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-07T12:40:13.180

我的建议是……不要。至少不是直接的。使用 Spring Webflow。它在向导和会话状态风格的过程中非常出色。 **注意：** Spring Webflow 可以在其他 Web 框架之上使用，尤其是 Spring MVC 和 JSF。有一个[Struts 2 Webflow 插件](http://cwiki.apache.org/S2PLUGINS/spring-webflow-plugin.html)。

如果你不打算使用 Webflow，它与编写普通的控制器/动作/视图/表单并没有太大的不同，除了逻辑会变得非常乏味。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-13T14:05:01.760

您将需要实现[ScopeInterceptor](http://struts.apache.org/2.1.6/struts2-core/apidocs/org/apache/struts2/interceptor/ScopeInterceptor.html)来创建类似接口的向导。另一种方法是实现自定义对话范围。可以在[这里](http://www.vitarara.org/cms/struts_2_cookbook/using_a_conversation_scope)找到一个很棒的教程。

# excel - 删除文件DSN后Excel查询表仍然有效，怎么可能？

> ID：725444
> 
> 赞同：2
> 
> 时间：2009-04-07T12:27:24.223
> 
> 标签：excel, odbc, xls, pivot-table, dsn

我有一个带有数据透视表的 xls，使用 proc 来填充它。

我删除了“管理工具-odbc-文件DSN”中的数据连接，它仍然有效，这怎么可能？

这是否意味着recipent 不必存在文件DSN 即可查看数据透视表中的数据？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-07T15:43:35.173

这是可能的，因为当您使用文件 DSN 时，excel 会读取文件的内容，该文件本质上具有构建与外部数据提供者的连接字符串的所有条目。然后 Excel 将构造连接字符串并使用它来填充 QueryTable。因此，一旦您第一次成功刷新 QueryTable，您就不再需要该文件 DSN。因此，在您删除它或在没有该 DSN 的其他机器中它会起作用。

附带说明一下，当您在 QueryTable 中使用文件 DSN 时，如果您更新 FileDSN（例如更新到新数据库或类似的东西），您的 QueryTable 刷新将不会反映该更改，您必须重建 QueryTable。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-07T12:41:40.430

当您创建一次数据透视表时，之后该 .xls 文件将在您的硬盘驱动器中独立工作。因此，它不再需要任何 DSN。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-07T14:05:14.690

数据透视表在其后面保留一个数据透视表数据缓存。您可以以任何您喜欢的方式操作这些数据，但很明显，在您重新连接之前，它不会刷新。

斯坦·斯科特

# c# - c#什么时候应该使用List，什么时候应该使用arraylist？

> ID：725459
> 
> 赞同：47
> 
> 时间：2009-04-07T12:31:20.253
> 
> 标签：c#, list, arraylist

正如标题所说，我应该什么时候使用`List`，什么时候应该使用`ArrayList`？

谢谢

* * *

## 回答 #1

> 赞同：89
> 
> 时间：2009-04-07T12:32:51.357

主要使用时间`ArrayList`是在.NET 1.1

除此之外，`List<T>`一路（对于您当地的`T`）...

对于那些（罕见的）您不知道预先类型（并且不能使用泛型）的情况，甚至`List<object>`比`ArrayList`（IMO）更有帮助。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-04-07T12:35:50.803

您应该始终使用`List<TypeOfChoice>`（在 .NET 2.0 中引入泛型），因为它是 TypeSafe 并且比`ArrayList`（没有不必要的装箱/拆箱）更快。

我能想到 ArrayList 可以派上用场的唯一情况是，如果您需要与旧的东西（.NET 1.1）交互，或者您需要一个不同类型的对象数组并将所有内容加载为对象 - 但您可以做后者一般用`List<Object>`哪个更好。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-04-07T12:33:48.937

由于 List 是一个泛型类，我倾向于总是使用 List。

ArrayList 是一个 .NET 1.x 类（尽管仍然可用且有效），但它不是“类型化”/通用的，因此您需要将项目从“对象”转换回所需的类型；而在使用 List 时，您不必这样做。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-04-07T12:36:17.540

尽可能使用列表。当存在高性能 List 时，我看不到 ArrayList 的任何用途。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-04-07T12:40:35.080

ArrayList 是一种较旧的 .NET 数据结构。如果您使用的是 .NET 2.0 或更高版本，则当数组需要保存相同类型的项目时，请始终使用 List。使用 List 而不是 ArrayList 可以提高性能和可用性。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-07T12:40:21.260

正如其他人所说。您应该使用 List 泛型，几乎总是在您知道类型（C# 是一种强类型语言）时使用，以及在您执行多态/继承类或其他类似的事情时使用其他方式。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2011-12-12T07:30:38.443

如果你不想使用 Linq 查询，那么你不需要使用 List。如果你想使用那么你必须更喜欢List。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2013-04-04T03:23:39.957

泛型是在 .Net 2.0 中引入的。如果您使用的是早期版本的 .Net，那么您可以使用数组列表，否则我们可以使用泛型列表本身。Array List 已被弃用，不会提供更好的类型安全性，还会产生装箱和拆箱问题。但 Generic List 不会。

# string - Fortran 77 中的字符串数组

> ID：725465
> 
> 赞同：7
> 
> 时间：2009-04-07T12:32:55.520
> 
> 标签：string, fortran, character, fortran77

我有一个关于 Fortran 77 的问题，但我找不到解决方案。

我正在尝试存储定义如下的字符串数组：

```
character matname(255)*255 
```

这是一个由 255 个长度为 255 的字符串组成的数组。

后来我从一个文件中读取了名称列表，并像这样设置了数组的内容：

```
matname(matcount) = mname 
```

**编辑：**实际上`mname`value 是硬编码`mname = 'AIR'`的 type ，它是执行上一行`character*255`的函数的参数。`matadd()`但这仅用于测试，将来它将从文件中读取。

稍后我想用以下方式打印它：

```
write(*,*) matname(matidx) 
```

但它似乎打印了所有 255 个字符，它打印了我分配的字符串和很多垃圾。

*   所以这是我的问题，我怎么知道存储的字符串的长度？
*   我应该有另一个所有长度的数组吗？
*   我怎么知道读取的字符串的长度？

谢谢。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-07T12:37:30.097

您可以使用此函数获取长度（没有空白尾部）

```
integer function strlen(st)
      integer       i
      character     st*(*)
      i = len(st)
      do while (st(i:i) .eq. ' ')
        i = i - 1
      enddo
      strlen = i
      return
      end 
```

从这里得到：http: [//www.ibiblio.org/pub/languages/fortran/ch2-13.html](http://www.ibiblio.org/pub/languages/fortran/ch2-13.html)

PS：当你说： matname(matidx) 它得到整个字符串（256）个字符......所以这是你的字符串加上空格或垃圾

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-07T16:35:08.620

只要您感兴趣的字符串部分仅包含空格， Timotei 发布的函数将为您提供字符串的长度，如果您在程序中分配值应该为真，因为 FORTRAN 应该初始化变量为空，对于表示空格的字符。

但是，如果您正在从文件中读取，您可能会在行尾拾取其他控制字符（特别是回车和/或换行符，\r 和/或 \n，具体取决于您的操作系统）。您还应该将它们扔到函数中以获得正确的字符串长度。否则你会得到一些有趣的打印语句，因为这些字符也会被打印出来。

这是我的函数版本，它在末尾检查除空格之外的备用空白字符。

```
 function strlen(st)
  integer           i,strlen
  character         st*(*)
  i = len(st)
  do while ((st(i:i).eq.' ').or.(st(i:i).eq.'\r').or.
 +  (st(i:i).eq.'\n').or.(st(i:i).eq.'\t'))
    i = i - 1
  enddo
  strlen = i
  return
  end 
```

如果“垃圾”部分中有其他字符，这仍然无法完全工作。

但是，假设它确实适用于您的数据，那么您可以将您的 write 语句更改为如下所示：

```
write(*,*) matname(matidx)(1:strlen(matname(matidx))) 
```

它只会打印出实际的字符串。

至于是否应该使用另一个数组来保存字符串的长度，这取决于您。strlen() 函数是 O(n)，而在表中查找长度是 O(1)。如果您发现自己经常计算这些静态字符串的长度，那么在读入它们时计算一次长度，将它们存储在数组中并在需要时查找它们可能会提高性能。但是，如果您没有注意到减速，我不会担心。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-07T19:27:41.030

根据您使用的编译器，您可以使用`trim()`内部函数从字符串中删除任何前导/尾随空格，然后像往常一样处理它，即

```
character(len=25) :: my_string
my_string = 'AIR'
write (*,*) ':', trim(my_string), ':' 
```

应该打印`:AIR:`。

编辑：更好的是，看起来有一个`len_trim()`函数可以在修剪后返回字符串的长度。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-06-18T03:15:53.410

intel 和 Compaq Visual Fortran 具有内在函数 LEN_TRIM(STRING)，它返回不带尾随空格或空格的长度。

如果要抑制前导空格或空格，请使用“向左调整”，即 ADJUSTF(STRING)

在这些 FORTRAN 中，我还注意到一个有用的特性：如果将字符串作为参数传递给函数或子例程，并且在子例程中将其声明为 CHARACTER*(*)，然后在子例程中使用 LEN(STRING) 函数返回传入的实际字符串长度，而不是调用程序中声明的字符串长度。

示例：CHARACTER*1000 STRING

```
 .
        .

  CALL SUBNAM(STRING(1:72)

  SUBROUTINE SYBNAM(STRING)
  CHARACTER*(*) STRING
  LEN(STRING) will be 72, not 1000 
```

# linux - gcc中共享库函数的静态链接

> ID：725472
> 
> 赞同：151
> 
> 时间：2009-04-07T12:34:56.373
> 
> 标签：linux, gcc

如何在 gcc 中静态链接共享库函数？

* * *

## 回答 #1

> 赞同：119
> 
> 时间：2009-04-07T12:52:06.287

参考：

[http://www.linuxquestions.org/questions/linux-newbie-8/forcing-static-linking-of-shared-libraries-696714/](http://www.linuxquestions.org/questions/linux-newbie-8/forcing-static-linking-of-shared-libraries-696714/)

您需要库的静态版本来链接它。

共享库实际上是具有指定入口点的特殊格式的可执行文件（包括一些粘性寻址问题）。它没有静态链接所需的所有信息。

您不能静态链接共享库（或动态链接静态库）。

该标志`-static`将强制链接器使用静态库 (.a) 而不是共享 (.so) 库。但静态库并不总是默认安装，因此您可能必须自己安装静态库。

另一种可能的方法是使用[statifier](http://statifier.sf.net)或[Ermine](http://magicErmine.com)。这两种工具都将一个动态链接的可执行文件作为输入，并将创建一个包含所有共享库的自包含可执行文件作为输出。

* * *

## 回答 #2

> 赞同：82
> 
> 时间：2009-06-02T11:10:00.577

如果你想静态链接**libapplejuice**，而不是**liborangejuice**，你可以这样链接：

```
gcc object1.o object2.o -Wl,-Bstatic -lapplejuice -Wl,-Bdynamic -lorangejuice -o binary 
```

有一个警告——如果`liborangejuice`使用`libapplejuice`，那么`libapplejuice`也将被动态链接。

您必须与 静态链接`liborangejuice`才能`libapplejuice`获得`libapplejuice`静态。

并且不要忘记保留`-Wl,-Bdynamic`其他内容，否则您最终会链接所有静态内容，包括`libc`（这不是一件好事）。

* * *

## 回答 #3

> 赞同：21
> 
> 时间：2017-12-11T18:51:33.217

是的，我知道这是一个有 8 年历史的问题，但有人告诉我，可以静态链接到共享对象库，当我搜索有关它的更多信息时，这确实是热门话题。

`ld`要实际证明使用(的链接器)静态链接共享对象库是不可能`gcc`的——而不是一群人坚持认为这是不可能的——使用以下`gcc`命令：

```
gcc -o executablename objectname.o -Wl,-Bstatic -l:libnamespec.so 
```

*（当然，您必须从 编译`objectname.o`，`sourcename.c`并且您可能还应该构建自己的共享对象库。如果这样做，请使用`-Wl,--library-path,.`以便 ld 可以在本地目录中找到您的库。）*

您收到的实际错误是：

```
/usr/bin/ld: attempted static link of dynamic object `libnamespec.so'
collect2: error: ld returned 1 exit status 
```

希望有帮助。

* * *

## 回答 #4

> 赞同：20
> 
> 时间：2011-09-06T15:08:06.563

如果您有共享库 (.so) 的 .a 文件，则可以简单地将其包含在其完整路径中，就好像它是一个目标文件一样，如下所示：

这仅通过编译生成 main.o：

```
gcc -c main.c 
```

这将该对象文件与相应的静态库链接并创建可执行文件（名为“main”）：

```
gcc main.o mylibrary.a -o main 
```

或在单个命令中：

```
gcc main.c mylibrary.a -o main 
```

它也可以是绝对或相对路径：

```
gcc main.c /usr/local/mylibs/mylibrary.a -o main 
```

* * *

## 回答 #5

> 赞同：11
> 
> 时间：2015-03-12T08:33:37.300

有点晚了，但是……我找到了几年前保存的链接，我认为它可能对你们有用：

**CDE：自动创建可移植的 Linux 应用程序**

[http://www.pgbovine.net/cde.html](http://www.pgbovine.net/cde.html)

*   只需下载程序
*   执行作为参数传递的二进制文件，您希望使其可移植的二进制文件的名称，例如：**nmap**

    ./cde_2011-08-15_64bit nmap

该程序将读取链接到 nmap 及其依赖项的所有库，并将所有这些库保存在名为**cde-package/**的文件夹中（与您在同一目录中）。

*   最后，您可以压缩文件夹并将可移植二进制文件部署在任何系统中。

请记住，要启动可移植程序，您必须执行位于**cde-package/nmap.cde中的二进制文件**

最好的祝福

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-07T12:49:42.517

在 gcc 中，这不受支持。事实上，我知道的任何现有编译器/链接器都不支持这一点。

# iphone - 在 iPhone 应用程序中创建类似 Facebook Profile 和 Wall 的视图

> ID：725479
> 
> 赞同：0
> 
> 时间：2009-04-07T12:36:49.863
> 
> 标签：iphone, view

我必须创建一个应用程序，其中包含与 Facebook iPhone 应用程序相同类型的视图 - 配置文件视图和墙部分。我的要求是有一个问题，用户可以给出不限行数的答案。所以很明显我必须使用 UITableView。现在我的问题是确定我的表格行高是否有两行。答案部分应该很小，如果答案部分很大，那么它应该很大，答案是无限的。

有谁知道如何创建这种类型的表格视图？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-07T13:03:53.217

听起来你会想要实施

```
-(CGFloat)tableView:(UITableView *)tableView heightForRowAtIndexPath:(NSIndexPath *)indexPath 
```

在你的 UITableViewDelegate 中。您需要计算各行的高度，然后在上述函数中返回这些高度。

# php - 在 UEStudio 中使用 XDebug 进行 PHP 调试

> ID：725481
> 
> 赞同：0
> 
> 时间：2009-04-07T12:37:29.770
> 
> 标签：php, debugging, xdebug

我刚刚下载了最新版本的 UEStudio 09，并且正在尝试集成的 XDebug 功能。

我已经安装了 xdebug，并通过我的 php_info() 验证了这一点。我写了一个非常基本的脚本来测试它：

```
1:  <?php
2:  $x = 5;
3:  $y = $x + 1;
4:  $z = 10;
5:  while ($z--) {
6:      echo $x, $y, "<br />\n";
7:  } 
```

然后我开始调试会话并在我的输出窗口中收到此消息：

```
Client: Listening for connection... 
```

我在第 4 行添加了一个断点，只是为了测试它。然后我在浏览器中使用特殊的 url 参数打开文件：

```
http://localhost/uetest/index.php?XDEBUG_SESSION_START=test
```

该脚本正常运行，它不会停止调试或任何事情。输出是这样的：

```
客户：正在监听连接...
客户端：已接受连接
客户端：初始化会话
===============================
调试引擎名称：Xdebug
调试引擎版本：2.0.3
协议版本：1.0
===============================
客户端：会话处于活动状态
客户端命令：步入
客户端：退出调试会话
脚本完成没有错误

```

如果我访问`http://localhost:9000/uetest/index.php`然后 UEStudio 说“连接接受”，但从那里什么都没有发生！该脚本永远不会在浏览器中完成，然后最终 UEStudio 崩溃。

有任何想法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-09-26T09:13:12.330

上周我评估了 UEStudio 作为 Zend Studio 5.5 的替代品。我如下设置我的 XDebug 配置并让它工作：

```
[XDebug]
zend_extension_ts=./ext/php_xdebug.dll
xdebug.profiler_enable=0
xdebug.profiler_enable_trigger=1
xdebug.profiler_output_dir=d:/
xdebug.profiler_output_name=timestamp
xdebug.remote_enable=1
xdebug.remote_mode=req
xdebug.remote_autostart=0
xdebug.remote_port=9000
xdebug.remote_host=localhost 
xdebug.idekey=debug 
```

我必须在我的 php.ini 中添加几个设置才能使其正常工作。以上是生成的配置。此外，我安装了 XDebug Helper Firefox 插件以直接从 Firefox 开始调试。很方便。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-07T12:52:29.047

许多年前我使用过 xdebug，但最近我一直在使用 Zend 调试器，所以我不记得我做了什么来让 xdebug.dll 工作。但是，我确实记得，我确实需要在 php.ini 中添加一些条目。Zend 调试器的条目是：

对于 Linux：

```
[Zend]
zend_extension=/usr/lib/php5/20060613+lfs/ZendDebugger.so
zend_debugger.allow_hosts=127.0.0.1
zend_debugger.expose_remotely=always 
```

对于 Windows：

```
[Zend]
zend_extension_ts="c:/php/ext/ZendDebugger.dll"
zend_debugger.allow_hosts=127.0.0.1
zend_debugger.expose_remotely=always 
```

谷歌搜索“php xdebug php.ini”把我带到了这里：

[http://devzone.zend.com/article/2930-Debugging-PHP-applications-with-xdebug](http://devzone.zend.com/article/2930-Debugging-PHP-applications-with-xdebug)

这表明：

```
xdebug.remote_enable=On
xdebug.remote_host="localhost"
xdebug.remote_port=9000
xdebug.remote_handler="dbgp" 
```

对于 xdebug。

希望这可以帮助。

# c# - C#中时间的字符串到mmm-yy格式

> ID：725491
> 
> 赞同：0
> 
> 时间：2009-04-07T12:39:08.360
> 
> 标签：c#, datetime

我需要使用 C# 在 ASP.net 中执行一些日期操作。

1.  我要输入的日期应该是“Jul-05”格式（mmm-yy 格式和类型**字符串**）......我该如何检查这个？？？？或者我如何用任何用户输入的字符串来验证这一点？？？

2.  验证后，我需要将 tht 与数据库中的值进行比较（例如列名*buy_period*，其值（例如）2007 年 4 月 31 日）。

我怎样才能写一个查询来比较两者？（因为两个日期的格式不同）

你能帮我吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-07T12:49:33.577

```
 DateTime myDateTime = DateTime.ParseExact( input, "MMM-yy" ); 
```

然后，您可以愉快地将其作为参数传递给存储过程（等），以在服务器上进行比较（或仅使用作为现有查询结果返回的 DateTime）

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-07T12:51:26.287

.NET 框架在 DateTime 结构 :: Parse、TryParse、ParseExact、TryParseExact 上有一些不错的方法。

此信息[在 MSDN 上进行了讨论](http://msdn.microsoft.com/en-us/library/2h3syy57(VS.85).aspx)。

因为您提供的是自定义日期字符串，所以我们应该使用 ParseExact 或 TryParseExact。如果解析失败，后者不会抛出异常。

所以..让我们试试这个...

```
using System.Globalization;

CultureInfo MyCultureInfo = new CultureInfo("en-US");
string myString = "Jul-05";
DateTime myDateTime = DateTime.ParseExact(myString, "MMM-yy", MyCultureInfo))
Console.WriteLine(); 
```

然后可以将值 myDateTime 作为 DateTime 属性传递到数据库并对其进行检查。

编辑：该死的，在我打字的时候被罗兰打败了一分钟！

编辑2：请注意“MMM-yy”。如[MSDN 页面](http://msdn.microsoft.com/en-us/library/8kb3ddd4(VS.85).aspx)所述，`MMM`是“表示当前 System.Globalization.DateTimeFormatInfo.AbbreviatedMonthNames 属性中定义的月份的缩写名称。” `mmm`（小写）无效。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-07T13:03:40.847

使用该`TryParseExact`方法验证字符串并将其解析为一个`DateTime`值：

```
DateTime month;
if (DateTime.TryParseExact("MMM-yy", CultureInfo.InvariantCulture, DateTimeStyles.None, out month)) {
   // parsing was successful
} 
```

该`DateTime`值将使用月份的第一天和时间 0:00 来填充一个完整的值，因此一个字符串 like`"jul-05"`将被解析为一个完整的`DateTime`值 like `2005-07-01 00:00:00.0000`，因此它将是该月的起点。

要将其与数据库中的日期进行比较，您还需要下个月的起点，您可以获得：

```
DateTime nextMonth = month.AddMonths(1); 
```

现在您可以通过这种方式将日期与月份的起点和终点进行比较：

```
where date >= @Month and date < @NextMonth 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-07T12:41:19.353

1：[读这个](http://msdn.microsoft.com/en-us/library/az4se3k1(VS.71).aspx)

2：该列是日期时间还是varchar？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-07T12:44:24.790

那么您的验证和比较必须是两个不同的操作。所以你可以做很多事情来验证。

验证选项：

1.）在“-”上拆分您的字符串并检查 mmm 部分是否在您的月份列表中，然后检查该数字是否有效。

2.) 正则表达式，这是先进的，但可以减少到一行。如果您有兴趣，请查找 RegEx。

验证字符串后，将其转换为 DateTime 对象并使用 DateTime.Compare() 将其与其他值进行比较。

希望有帮助。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-07T12:51:45.337

你可以使用

```
DateTime date = DateTime.ParseExact(value, "MMM-yy", null); //checked at http://msdn.microsoft.com/en-us/library/8kb3ddd4.aspx 
```

然后在 sql 命令参数中使用该日期。

# java - 安卓覆盖流

> ID：725496
> 
> 赞同：11
> 
> 时间：2009-04-07T12:40:20.433
> 
> 标签：java, android, mobile, coverflow

我正在为 android 编写一个应用程序，并希望有一个`itunes`类似的封面流预览。api中有什么我可以使用的还是我必须从头开始构建的？

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2010-01-08T10:47:38.367

我创建了一个基本的coverflow小部件，可以在这里找到：

[http://www.inter-fuser.com/2010/01/android-coverflow-widget.html](http://www.inter-fuser.com/2010/01/android-coverflow-widget.html)

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-04-07T14:54:14.870

没有内置的coverflow小部件，最接近的可能是[Gallery](http://developer.android.com/reference/android/widget/Gallery.html)小部件。如果有人还没有尝试过类似的东西，我仍然会感到惊讶，你可能会在互联网上发现一些代码。谷歌在 Android 上提到了一些 Coverflow，尽管我没有详细检查过。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2011-09-05T13:39:42.060

默认情况下不提供，但是有：

[http://code.google.com/p/android-coverflow/](http://code.google.com/p/android-coverflow/)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-06-25T07:44:29.337

对于 sdk 的最新版本（3.1+），在 2 年前的 Google I/O 期间提供了一个示例。它显示了一个 3D 覆盖流，它可以替代覆盖流。（它广泛用于 Google 音乐和新闻应用等应用）。

演示[在这里](http://www.youtube.com/watch?v=d2caXMF-ud8)。

源代码[在这里](http://code.google.com/p/android-ui-utils/downloads/detail?name=CarouselExample.zip)。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2014-05-21T07:51:28.107

我从头开始制作了一个coverflow小部件。它不使用任何已弃用的组件。你可以在这里找到它：http: [//applm.github.io/ma-components/](http://applm.github.io/ma-components/)

# c# - Visual Studio 调试“快速观察”工具和 lambda 表达式

> ID：725499
> 
> 赞同：96
> 
> 时间：2009-04-07T12:40:26.597
> 
> 标签：c#, visual-studio, debugging, lambda

为什么在“快速监视”窗口中调试时不能使用 lambda 表达式？

UPD：另见

[http://blogs.msdn.com/b/jaredpar/archive/2009/08/26/why-no-linq-in-debugger-windows.aspx](http://blogs.msdn.com/b/jaredpar/archive/2009/08/26/why-no-linq-in-debugger-windows.aspx)

[http://blogs.msdn.com/b/jaredpar/archive/2010/06/02/why-is-linq-absent-from-debugger-windows-part-2.aspx](http://blogs.msdn.com/b/jaredpar/archive/2010/06/02/why-is-linq-absent-from-debugger-windows-part-2.aspx)

* * *

## 回答 #1

> 赞同：91
> 
> 时间：2009-04-07T13:28:43.670

不，您不能在 watch / locals / immediate 窗口中使用 lambda 表达式。正如 Marc 所指出的，这非常复杂。不过，我想更深入地探讨这个话题。

大多数人不考虑在调试器中执行匿名函数是它不会发生在真空中。定义和运行匿名函数的行为改变了代码库的底层结构。通常，尤其是从即时窗口更改代码是一项非常困难的任务。

考虑以下代码。

```
void Example() {
  var v1 = 42;
  var v2 = 56; 
  Func<int> func1 = () => v1;
  System.Diagnostics.Debugger.Break();
  var v3 = v1 + v2;
} 
```

此特定代码创建一个闭包来捕获值 v1。每当匿名函数使用在其范围之外声明的变量时，都需要闭包捕获。出于所有意图和目的，此函数中不再存在 v1。最后一行实际上看起来更像下面

```
var v3 = closure1.v1 + v2; 
```

如果函数 Example 在调试器中运行，它将在 Break 行停止。现在想象一下，如果用户在监视窗口中输入以下内容

```
(Func<int>)(() => v2); 
```

为了正确执行此调试器（或更合适的 EE）需要为变量 v2 创建一个闭包。这很困难，但并非不可能做到。

不过，真正让这对 EE 来说是一项艰巨的工作的是最后一行。现在应该如何执行该行？出于所有意图和目的，匿名函数删除了 v2 变量并将其替换为closure2.v2。所以最后一行代码现在真的需要阅读

```
var v3 = closure1.v1 + closure2.v2; 
```

然而，要在代码中真正获得这种效果，需要 EE 更改代码的最后一行，这实际上是一个 ENC 操作。虽然这个特定的例子是可能的，但大部分场景是不可能的。

更糟糕的是执行 lambda 表达式不应该创建一个新的闭包。它实际上应该将数据附加到原始闭包中。在这一点上，您直接进入限制 ENC。

不幸的是，我的小例子只触及了我们遇到的问题的表面。我一直说我会写一篇关于这个主题的完整博客文章，希望这个周末我有时间。

* * *

## 回答 #2

> 赞同：64
> 
> 时间：2009-04-07T12:52:05.427

Lambda 表达式，就像匿名方法一样，实际上是非常复杂的野兽。即使我们排除`Expression`（.NET 3.5），仍然会留下*很多*复杂性，尤其是捕获的变量，这些变量从根本上重新构建使用它们的代码（您认为变量成为编译器生成的类上的字段） ，带着一点烟雾和镜子。

因此，我一点也不惊讶您不能无所事事地使用它们——有*很多*编译器工作（以及幕后的类型生成）支持这种魔法。

* * *

## 回答 #3

> 赞同：49
> 
> 时间：2010-05-05T09:13:01.047

您不能在“立即”或“监视”窗口中使用 lambda 表达式。

但是，您可以使用[System.Linq.Dynamic 表达式](http://weblogs.asp.net/scottgu/archive/2008/01/07/dynamic-linq-part-1-using-the-linq-dynamic-query-library.aspx)，其形式为 .Where("Id = @0", 2) - 它没有标准 Linq 中可用的全部方法，也没有完整的lambda 表达式的强大功能，但总比没有好！

* * *

## 回答 #4

> 赞同：22
> 
> 时间：2014-11-12T21:23:33.123

未来已经到来！

[**Visual Studio 2015**](http://blogs.msdn.com/b/visualstudioalm/archive/2014/11/12/support-for-debugging-lambda-expressions-with-visual-studio-2015.aspx)[中添加了对调试 lambda 表达式的支持](http://blogs.msdn.com/b/visualstudioalm/archive/2014/11/12/support-for-debugging-lambda-expressions-with-visual-studio-2015.aspx)（撰写本文时为*预览版）。*

Expression Evaluator 必须重写，因此缺少许多功能：远程调试 ASP.NET、在即时窗口中声明变量、检查动态变量等。目前不支持需要调用本机函数的 lambda 表达式。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-04-16T19:16:40.860

这可能会有所帮助：Visual Studio 的扩展即时窗口（在调试中使用 Linq、Lambda Expr）

*   [http://extendedimmediatewin.codeplex.com/](http://extendedimmediatewin.codeplex.com/)
*   [http://dvuyka.spaces.live.com/blog/cns!305B02907E9BE19A!381.entry](http://dvuyka.spaces.live.com/blog/cns!305B02907E9BE19A!381.entry)

一切顺利，帕特里克

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-04-07T12:42:34.017

调试器的表达式求值器不支持 Lambda 表达式...这不足为奇，因为在编译时它们用于创建方法（或表达式树）而不是表达式（查看 Reflector 并显示切换到 .NET 2 到看他们）。

另外，它们当然可以形成一个闭包，另一个完整的结构层。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2014-09-17T19:20:40.247

为了回答您的问题，这里是 Visual Studio Program Manager 对您为什么不能这样做的官方解释。简而言之，因为在 VS 中实现“真的，真的很难”。但该功能目前正在进行中（2014 年 8 月更新）。

[允许在调试时评估 lambda 表达式](http://visualstudio.uservoice.com/forums/121579-visual-studio/suggestions/2049821-debug-lambda-expressions-planned)

当你在那里时添加你的投票！

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2015-09-15T18:21:37.023

如果您仍需要使用 Visual Studio 2013，您实际上可以使用包管理器控制台窗口在即时窗口中编写循环或 lambda 表达式。就我而言，我在函数顶部添加了一个列表：

```
private void RemoveRoleHierarchy()
{
    #if DEBUG
    var departments = _unitOfWork.DepartmentRepository.GetAll().ToList();
    var roleHierarchies = _unitOfWork.RoleHierarchyRepository.GetAll().ToList();
    #endif

    try
    {
        //RoleHierarchy
        foreach (SchoolBo.RoleHierarchy item in _listSoRoleHierarchy.Where(r => r.BusinessKeyMatched == false))
            _unitOfWork.RoleHierarchyRepository.Remove(item.Id);

        _unitOfWork.Save();
    }
    catch (Exception e)
    {
        Debug.WriteLine(e.ToString());
        throw;
    }
} 
```

`GetAll()`我的功能在哪里：

```
private DbSet<T> _dbSet;

public virtual IList<T> GetAll()
{
    List<T> list;
    IQueryable<T> dbQuery = _dbSet;
    list = dbQuery
        .ToList<T>();

    return list;
} 
```

在这里我不断收到以下错误，所以我想打印出各个存储库中的所有项目：

> InnerException {"DELETE 语句与 REFERENCE 约束 \"FK_dbo.Department_dbo.RoleHierarchy_OranizationalRoleId\" 冲突。冲突发生在数据库 \"CC_Portal_SchoolObjectModel\"、表 \"dbo.Department\"、列 'OranizationalRoleId' 中。\r\n语句已终止。"} System.Exception {System.Data.SqlClient.SqlException}

然后，我通过在即时窗口中执行以下命令来了解部门存储库中有多少记录：

```
_unitOfWork.DepartmentRepository.GetAll().ToList().Count 
```

返回 243。

因此，如果您在包管理器控制台中执行以下操作，它会打印出所有项目：

```
PM> for($i = 0; $i -lt 243; $i++) { $a = $dte.Debugger.GetExpression("departments[$i].OrgagnizationalRoleId"); Write-Host $a.Value $i } 
```

这个想法的作者可以在[这里找到](http://ogresoft.blogspot.ca/2013/06/how-to-write-loop-or-lambda-expression.html)

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2015-12-05T07:59:07.983

在 VS 2015 中您现在可以这样做，这是他们添加的新功能之一。

# c# - 您可以在格式字符串中包含条件检查代码吗？

> ID：725519
> 
> 赞同：1
> 
> 时间：2009-04-07T12:44:29.517
> 
> 标签：c#, .net, compact-framework

我有一个自定义控件，它是列表的一部分。它应该显示的文本是通过为其 Text 属性分配一个值来设置的。在运行时，此文本从数据库中加载。我想在这个文本前面加上字符串“Toelichting:”（荷兰语的“解释”）。我可以通过将控件的 FormatString 属性设置为以下内容来完成此操作：

```
"Toelichting: {0}" 
```

现在，如果加载的文本是一个空字符串，我想显示“Toelichting: –”，所以最后有一个短划线。否则，我想显示“Toelichting：MyText”。是否可以在 FormatString 中添加一些条件检查代码，以便我可以检查参数是否不为空？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-07T12:47:16.017

为什么不只是这个？

```
string.Format("Toelichting: {0}", string.IsNullOrEmpty(explanation) ? "–" : explanation); 
```

我认为没有办法将其嵌入格式字符串中。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-07T12:46:37.390

不，没有办法做到这一点。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-07T12:48:23.737

你可以这样做：

```
String.Format("Toelichting: {0}", 
    (String.IsNullOrEmpty(yourstr)) ? "-" : yourstr); 
```

不完美，但它相对紧凑和可读。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-07T13:10:14.980

如果你经常做这种事情，那么考虑编写你自己的格式化程序，这样你就可以编写这样的代码......

foo = string.Format(new MyFormatter(), "Toelichting: {0:explanation}", bar);

MyFormatter 将实现 IFormatProvider 和 ICustomFormatter。

看看这个...

[.NET：是否有用于将对象属性的值插入字符串的 String.Format 表单？](https://stackoverflow.com/questions/357447/-net-is-there-a-string-format-form-for-inserting-the-value-of-an-object-property)

...这可能比您需要的更复杂（因为它处理反射并适用于任何对象）

# c# - 将大文件从 PC 传输到掌上电脑

> ID：725526
> 
> 赞同：0
> 
> 时间：2009-04-07T12:46:51.243
> 
> 标签：c#, pocketpc, file-transfer

我需要将一个大文件从 PC 传输到 PPC（掌上电脑），但我不能使用 RAPI。

我需要：

1.  将 .sdf（大）文件转换为二进制格式
2.  转移到 PPC（通过 Web 服务）
3.  在 PPC 中从二进制转换为 .sdf

问题是在 PPC 中我遇到了“内存不足”异常（在大文件中）。使用一个小文件，它可以很好地工作。

我能做些什么？也许我可以分片发送文件？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-25T06:09:42.347

康拉德所说，您需要以较小的尺寸发送文件，具体取决于您拥有的 pf PPC 类型。这可能小到几mb，然后写入存储卡或主存储器。我个人使用 FTP 传输“大”文件（范围为数百 mb）以传输到我的 PPC，但我确信您可以使用您可能需要的任何其他解决方案。但是您需要研究目标 PPC 的限制，它们通常具有有限的内存、存储和 CPU。.net 紧凑框架中还有一个内置的 http 下载器类，您可以使用它。

# version-control - 源代码控制树和分支的可视化视图

> ID：725530
> 
> 赞同：1
> 
> 时间：2009-04-07T12:47:40.290
> 
> 标签：version-control, tfs, branch

是否有任何实用程序可以与 Subversion 或（最好是）Team Foundation Server 的源代码控制系统一起使用，以显示源代码树的可视化表示？例如，它显示分支（带有标签）分裂，合并回来等等。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-07T12:54:06.780

你的意思是像 Tortoise SVN 内置的修订图？[您可以在此处](http://tortoisesvn.net/docs/release/TortoiseSVN_en/tsvn-dug-revgraph.html)查看其显示功能的示例。

![](https://tortoisesvn.net/docs/release/TortoiseSVN%5Fen/images/RevisionGraph.png)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-07T12:51:55.303

我不确定现在 - 去 www.codeplex.com 并搜索 TFS。

在 VS2010 中有一个非常好的特性。请参阅[第 10-4 集第 4 集：不再有并行开发的痛苦](http://channel9.msdn.com/shows/10-4/10-4-Episode-4-No-More-Parallel-Development-Pain)。您现在可以下载 CTP 并尝试一下。

# java - 将 Stripes 应用程序转换为使用友好 URL

> ID：725534
> 
> 赞同：5
> 
> 时间：2009-04-07T12:48:24.533
> 
> 标签：java, stripes

我正在阅读 Fred Daoud 的 Stripes 书，并尝试将 Hello World 应用程序转换为使用友好的 URL，因为我不是像[http://localhost:8080/getting_started/Hello.action](http://localhost:8080/getting_started/Hello.action)这样的基于后缀的映射的忠实粉丝。

这里是前...

index.jsp：

```
<jsp:forward page="/Hello.action"/> 
```

网页.xml：

```
<servlet-mapping>
    <servlet-name>DispatcherServlet</servlet-name>
    <url-pattern>*.action</url-pattern>
</servlet-mapping> 
```

我的 HelloActionBean 上没有 UrlBinding。我有本书的例子工作。

我想知道书籍示例是否适合早期版本的 Stripes，因为我已经下载了 1.5.1，并且我的 web.xml 定义了 StripesFilter 和 StripesDispatcher，而我在其他地方看到了 DynamicMappingFilter，例如在Fred的[这篇文章](http://www.theserverside.com/tt/articles/article.tss?l=Stripes15)中在服务器端。

无论如何，我做了以下更改：

index.jsp：

```
<jsp:forward page="/hello"/> 
```

网页.xml：

```
<servlet-mapping>
    <servlet-name>DispatcherServlet</servlet-name>
    <url-pattern>/*</url-pattern>
 </servlet-mapping> 
```

HelloActionBean.java：

```
**@UrlBinding("/hello")**
public class HelloActionBean implements ActionBean 
{ 
```

但是，当我尝试通过[http://localhost:8080/getting_started](http://localhost:8080/getting_started)加载应用程序时，我看到：

```
net.sourceforge.stripes.exception.ActionBeanNotFoundException: Could not locate an ActionBean that is bound to the URL [/]. Commons reasons for this include mis-matched URLs and forgetting to implement ActionBean in your class. Registered ActionBeans are: {/hello=class stripesbook.action.HelloActionBean, /controller/DefaultView.action=class net.sourceforge.stripes.controller.DefaultViewActionBean, /hello/=class stripesbook.action.HelloActionBean, /controller/DefaultView.action/=class net.sourceforge.stripes.controller.DefaultViewActionBean}
    at net.sourceforge.stripes.controller.AnnotatedClassActionResolver.getActionBean(AnnotatedClassActionResolver.java:341) 
```

如果我通过[http://localhost:8080/getting_started/hello](http://localhost:8080/getting_started/hello)访问它，服务器似乎进入一个循环，一个接一个地抛出异常。

任何建议表示赞赏 - 谢谢。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-07T13:52:37.000

我一直在尝试其他一些事情并让它工作......

我删除了 web.xml 中现有的 DispatcherServlet servlet 和 servlet-mapping 定义，并替换为 DynamicMappingFilter。

作为奖励，更改链接事件的传递方式，例如

```
http://localhost:8080/getting_started/hello?randomDate= 
```

变成

```
http://localhost:8080/getting_started/hello/randomDate 
```

将 ActionBean 上的 UrlBinding 更改为：

```
@UrlBinding("/hello/{$event}") 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-08-20T13:05:46.073

将 Dispatcher servlet 替换为 DynamicMappingFilter 对我来说不起作用（我收到一条错误消息，指出 DynamicMappingFilter 只能与 StripesFilter 一起使用）。所以我现在在我的 web.xml 中配置了两个过滤器和一个过滤器映射：

```
<filter>
    <display-name>Stripes Filter</display-name>
    <filter-name>StripesFilter</filter-name>
    <filter-class>net.sourceforge.stripes.controller.StripesFilter</filter-class>
    <init-param>
        <param-name>ActionResolver.Packages</param-name>
        <param-value>com.package.myactions.package</param-value>
    </init-param>
</filter>

<filter>
    <description>Dynamically maps URLs to ActionBeans.</description>
    <display-name>Stripes Dynamic Mapping Filter</display-name>
    <filter-name>DynamicMappingFilter</filter-name>
    <filter-class>
        net.sourceforge.stripes.controller.DynamicMappingFilter
    </filter-class>
</filter>

<filter-mapping>
    <filter-name>DynamicMappingFilter</filter-name>
    <url-pattern>/*</url-pattern>
    <dispatcher>REQUEST</dispatcher>
    <dispatcher>FORWARD</dispatcher>
    <dispatcher>INCLUDE</dispatcher>
</filter-mapping> 
```

# networking - C# - Windows XP SP III 中的用户态 TCP 堆栈

> ID：725536
> 
> 赞同：0
> 
> 时间：2009-04-07T12:48:57.043
> 
> 标签：networking, tcp, raw-sockets, penetration-testing

我正在尝试创建一个应用程序来制作数据包，以便能够在此处调试某些网关，并尝试 TCP DoS 情况。尽管如此，这应该很容易，我没有找到一种方法来为 Windows 应用程序实现它。

我开始在 Unix 机器上使用Python 中 Core Security 的[Impacket](http://oss.coresecurity.com/projects/impacket.html)，但我现在想避免这种情况。首先，Impacket 不适用于 Windows，而且它似乎并没有完全符合我的要求。

有谁知道如何在 Windows 中获得类似原始套接字的简单行为？我知道不再有原始套接字了。但是有没有类似的东西？我可以使用的任何 C# 库......我没有找到任何东西。

谢谢 ;）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-07T12:53:17.720

尝试使用 libpcap (winpcap)，它可以在 tcp/ip 堆栈下工作，只是在原始数据包级别。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-07T13:02:57.227

创建套接字并不多。

```
using System.Net.Sockets;
Socket rawSocket = new Socket(AddressFamily.InterNetwork, SocketType.Raw, ProtocolType.Raw); 
```

或者如果它是您所追求的自定义 TCP 数据包：

```
Socket rawSocket = new Socket(AddressFamily.InterNetwork, SocketType.Raw, ProtocolType.IP); 
```

如果您计划发送 .Net 框架未公开的 IP 或更高层数据包。然而，IP 和 TCP 数据包很容易组合在一起，如果您正在测试格式错误的数据包，您很可能无论如何都需要自定义数据包。

# asp.net - ASP.net 服务器控件：如何处理动态控件的 ID

> ID：725542
> 
> 赞同：1
> 
> 时间：2009-04-07T12:50:16.713
> 
> 标签：asp.net, controls

> **可能重复：**
> [.Net 更改元素 ID](https://stackoverflow.com/questions/699677/net-changes-the-element-ids)

我有以下问题（我会简化解释，否则它会变得太复杂/太长）。

我需要创建一个从 Panel 继承的 ASP.net 服务器控件。很简单。当自定义控件呈现时，它应该动态创建一个 Button，将一个事件处理程序与其关联（这也将在服务器控件内部定义）并将此按钮添加到呈现的控件。在服务器控件中定义的 click 事件处理程序做了一些暂时不感兴趣的工作。

我已经编写了一个示例并且效果很好。在服务器控件的构造函数中，我创建了一个新的按钮控件，给它一个 ID，关联一个事件处理程序，在服务器控件的 OnInit 上，我将按钮添加到 Panel 控件（请记住，我的控件继承自 Panel），然后一切都被渲染了。这看起来类似于以下内容：

```
public class MyCustomControl: Panel
    {
        private Button myButton;

        public MyCustomControl()
        {
            myButton = new Button();
            myButton.ID = "btnTest";
            myButton.Click += new EventHandler(btnTest_Click);
        }

        protected void btnTest_Click(object sender, EventArgs e)
        {
            //do something...
        }

        //...

        protected override void OnInit(EventArgs e)
        {
            base.OnInit(e);

            this.Controls.AddAt(0, myButton);
        }

        protected override void OnLoad(EventArgs e)
        {
            base.OnLoad(e);
            //...
        }

        protected override void OnPreRender(EventArgs e)
        {
            base.OnPreRender(e);
        }

        protected override void Render(HtmlTextWriter output)
        {
            base.RenderContents(output);
        }
    } 
```

这工作得很好。该按钮会正确呈现，当我单击它时，会调用并执行此客户服务器控件中的相应处理程序。但是，当我想将此服务器控件的多个实例添加到我的页面时，问题就开始了，因为我生成的所有按钮都将具有相同的 id “btnTest”，这会导致冲突。所以我尝试将一个随机数与按钮的 id 相关联，它最终是“btnTest1235512”或类似的东西。这解决了我的多个 ID 问题，但导致我的事件处理程序在单击按钮时不再被正确调用。我想这是由于我的按钮在进入构造函数时总是获得另一个 id 的问题，因此适当的回调（btnTest_Click 事件处理程序）不是

有人可以给我一个建议，我可以如何处理这个问题。有什么方法可以记住按钮的 ID 并重新关联它。然而据我所知，这必须发生在 OnInit 中，其中 ViewState 尚不可用。所以将 id 存储在 ViewState 中是行不通的。

有什么建议么？？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-07T12:57:43.153

实施[`INamingContainer`](http://msdn.microsoft.com/en-us/library/system.web.ui.inamingcontainer.aspx)应该可以解决问题。然后，您可以继续命名所有按钮`btnTest`。

这只是一个标记接口，因此您不必实现任何方法或属性。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-07T13:00:57.233

从 INamingContainer 继承，例如：

```
public class MyCustomControl : Panel, INamingContainer
{
} 
```

这是一个标记接口，不需要实现。我刚刚验证了你的代码，它解决了你的问题。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-07T13:05:45.957

实施 INamingContainer 将为您完成。它会自动命名具有唯一 ID 的按钮。请注意，如果您需要在任何 JavaScript 中使用这些按钮中的任何一个，则需要使用 ClientID 属性：

```
function getButton() {
  var myButton = document.getElementById('<%=btnTest.ClientID %>');
} 
```

# fluent-nhibernate - FluentNHibernate：SaveOrUpdate 上的对象名称无效

> ID：725543
> 
> 赞同：1
> 
> 时间：2009-04-07T12:50:34.573
> 
> 标签：fluent-nhibernate

我正在尝试让 FluentNHibernate 启动并运行。

当我尝试将实体对象添加到数据库时，我在内部异常中收到“无效的对象名称'Recipe'错误，这是主要异常

无法插入：[OurRecipes.Domain.Recipe][SQL: INSERT INTO Recipe (EnteredByID, ModifiedOn, Method, PrepTime, CookTime, RecipeTitle) VALUES (?, ?, ?, ?, ?, ?); 选择 SCOPE_IDENTITY()]

这就是我配置它的方式。

```
public static ISessionFactory Create()
    {
        return Fluently.Configure()
            .Database(MsSqlConfiguration.MsSql2005
            .ConnectionString(c => c.Is("Server=(local);initial catalog=OurRecipesDB;Integrated Security=SSPI")))
            .Mappings(m => m.FluentMappings.AddFromAssemblyOf<Recipe>())
            .BuildSessionFactory();
    } 
```

这是我第一次这样做所以......

即使此配置运行没有错误，它似乎也无法识别我的域项目中的“食谱”类。

这是我在 SaveOrUpdate 行上得到错误的代码。

```
 var factory = SessionFactoryCreator.Create();

        using (var session = factory.OpenSession())
        {

            Recipe rec = new Recipe();
            rec.RecipeTitle = "test";
            rec.Method = "test";
            rec.PrepTime = 10;
            rec.CookTime = 20;
            rec.EnteredByID = 1;
            rec.ModifiedOn = DateTime.Now;

            session.SaveOrUpdate(rec); 
```

}

编辑：对不起，SQL 表名是Recipes .....好吧，这里晚了！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-07T13:02:42.377

你的食谱映射是什么样的？我敢打赌，您没有定义表名。您的映射类应类似于：

```
public class RecipeMap : ClassMap<Recipe>
{
    public RecipeMap()
    {
        SchemaIs("dbo");
        WithTable("Recipes");
        [... additional mappings ...]
    }
} 
```

# java - portlet 2.0 (jsr286) 使用 spring 开发

> ID：725546
> 
> 赞同：6
> 
> 时间：2009-04-07T12:51:28.113
> 
> 标签：java, spring, spring-mvc, portlet, jsr286

我们正在讨论从liferay 安装上的普通portlet 开发切换到基于spring webmvc portlet 的开发是否是一个好主意。

我们即将开始开发一些 portlet，所以现在是时候了。但是我看到的问题是我们想使用一些portlet 2.0 特性，这些特性不适用于早于spring 3.0 的版本。（对？）

有没有人知道，是否值得等待？（3.0 什么时候安排？）目前的里程碑足够稳定吗？

我们的第一个真正的版本将在今年的最后一个季度发布，所以 springsource 的人还有一些时间来完成一个决赛...... ;-)

有任何想法吗？

**更新**

因此，Spring 3 已经发布，它支持我们需要的所有 JSR286 特性。（我认为这是对 JSR286 功能的非常完整的支持）

我看到的唯一缺点是文档在注释方面没有跟上速度。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-07T13:42:08.367

我们在 Liferay 上使用 Spring Portlet MVC 2.5，我们取得了很好的效果。大多数 JSR-286 功能（如事件）可以通过扩展 DispatcherPortlet 类来实现。

即将发布的 3.0 版本仍然存在很多错误，所以我会比较保守并保持稳定和成熟的版本 2

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-07T13:07:04.503

Spring 框架在代码质量方面有着出色的记录。过去他们的 M 版本质量很高，所以我不会害怕使用它。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-07T22:44:26.783

Juergen Hoeller 将 2008 年 7 月作为 Spring 3.0 的预计发布日期：

[http://www.springify.com/archives/15](http://www.springify.com/archives/15)

我认为他们迟到了。8)

大约六个月前，Matt Raible 在 2008 年 10 月对这一事实表示遗憾：

[http://raibledesigns.com/rd/entry/the_colorado_software_summit_and](http://raibledesigns.com/rd/entry/the_colorado_software_summit_and)

我想知道新的专业与开源模型是否影响了可用性。

他们现在还在进行 Spring DM、Spring Blaze 和 Spring Integration 工作。

鉴于他们过去的高质量发布历史，我敢打赌，他们正在抵制提前发布以确保代码符合他们的标准的冲动。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-08-21T11:22:47.090

我刚刚开始了解带有 Spring 3.0 M4 的 Portlet MVC，并遇到了一个使用 Spring3 (JSR-286) 功能和注释的[修改后的 PetPortlet 示例。](http://www.salientpoint.com/blog/?p=384)虽然它是 Mavenized 并且可能无法直接部署在 Liferay 上，但它仍然提供了很好的示例。

如果您碰巧遇到任何其他人，请发表评论。

# c# - 使用 Log4Net 的 Spring.Net 日志记录不起作用

> ID：725552
> 
> 赞同：1
> 
> 时间：2009-04-07T12:53:01.307
> 
> 标签：c#, log4net, spring.net

我无法让 Spring.Net 使用 Log4Net 进行日志记录。我对查看 Aspects 的日志记录特别感兴趣。我正在使用一个非常简单的日志配置，类似于 MovieFinder 示例应用程序：

```
...
<logger name="Spring">
  <level value="DEBUG" /> <!-- Have tried INFO as well, no different -->
  <appender-ref ref="SpringAppender"/>
</logger> 

<appender name="SpringAppender" type="log4net.Appender.RollingFileAppender">
  <file value="..\Log\Spring_Log.txt"/>
  <appendToFile value="true"/>
  <maximumFileSize value="100MB"/>
  <maxSizeRollBackups value="2"/>
  <layout type="log4net.Layout.PatternLayout">
    <conversionPattern value="%date %-5level [%thread] %logger - %message%newline"/>
  </layout>
</appender>
... 
```

文件“Spring_Log.txt”已创建，但没有记录任何内容（即空文件）。Log4Net 目前正在正确记录 NHibernate 和我们的自定义应用程序日志记录。我正在使用 Spring.Net v1.2.0.20313 和 Log4Net v1.2.10.0。

有没有其他人遇到过他们能够解决的问题？非常感谢您的帮助，干杯。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-02T17:34:22.253

正如 Erich 所说，您需要配置 Common.Logging。您的 log4net 配置文件很好。这是我使用您的配置文件所得到的：

```
2009-05-02 19:08:40,890 DEBUG [10] Spring.Objects.Factory.Support.AbstractObjectDefinitionReader - Loading XML object definitions from config [C:\Documents and Settings\pczapla\My Documents\Visual Studio 2008\Projects\TimeLogger\TimeLogger\bin\Debug\TimeLogger.exe.config#spring/objects]
2009-05-02 19:08:40,905 DEBUG [10] Spring.Objects.Factory.Support.AbstractObjectDefinitionReader - Using the following XmlReader implementation : System.Xml.XsdValidatingReader
2009-05-02 19:08:40,921 DEBUG [10] Spring.Objects.Factory.Xml.DefaultObjectDefinitionDocumentReader - Loading object definitions.
2009-05-02 19:08:40,921 DEBUG [10] Spring.Objects.Factory.Xml.ObjectDefinitionParserHelper - Loading object definitions... 
```

以下是如何配置 Common.Logging 的快速指南：

添加 Common.Logging 和 Common.Logging.Log4Net 程序集，它们在 lib 文件夹`C:\Program Files\Spring.NET 1.2.0\lib\Net\2.0\`（然后将以下配置添加到您的`app.config`：

```
<configuration>
    </configSections>
        ...
        <sectionGroup name="common">
            <section name="logging" type="Common.Logging.ConfigurationSectionHandler, Common.Logging" />
        </sectionGroup>
    </configSections>
    ...
    <common>
        <logging>
            <factoryAdapter type="Common.Logging.Log4Net.Log4NetLoggerFactoryAdapter, Common.Logging.Log4net">
                <!-- Common Logging assumes that log4net is initialized -->
                <arg key="configType" value="EXTERNAL"/>
                <!-- Or it can configure log4net for you
                <arg key="configType" value="FILE-WATCH" />
                <arg key="configFile" value="path\to\your\log4net.config" />
                -->
            </factoryAdapter>
        </logging>
    </common>
</configuration> 
```

这就对了。现在您应该从 spring 中获取调试消息。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-27T15:24:04.200

Spring.NET 使用 Common.Logging。您是否将 Common.Logging 配置为登录到 log4net？有关文档，请参阅[http://netcommon.sourceforge.net/documentation.html](http://netcommon.sourceforge.net/documentation.html)

hth，埃里希

# sql - 如何合并两个 MySQL 表？

> ID：725556
> 
> 赞同：95
> 
> 时间：2009-04-07T12:53:51.383
> 
> 标签：sql, mysql, merge

如何合并两个具有相同结构的 MySQL 表？

两个表的主键会发生冲突，所以我考虑到了这一点。

* * *

## 回答 #1

> 赞同：126
> 
> 时间：2009-04-07T13:04:18.910

你也可以试试：

```
INSERT IGNORE
  INTO table_1 
SELECT *
  FROM table_2
     ; 
```

这允许 table_1 中的那些行取代 table_2 中具有匹配主键的行，同时仍插入具有新主键的行。

或者，

```
REPLACE
   INTO table_1
 SELECT *
   FROM table_2
      ; 
```

将使用 table_2 中的相应行更新 table_1 中已经存在的那些行，同时插入具有新主键的行。

* * *

## 回答 #2

> 赞同：38
> 
> 时间：2009-04-07T13:02:21.440

这取决于主键的语义。如果它只是自动增量，那么使用类似的东西：

```
insert into table1 (all columns except pk)
select all_columns_except_pk 
from table2; 
```

如果 PK 意味着什么，您需要找到一种方法来确定哪个记录应该具有优先权。您可以创建一个选择查询来首先查找重复项（参见[cpitis 的回答](https://stackoverflow.com/questions/725556/how-can-i-merge-two-mysql-tables/725571#725571)）。然后消除您不想保留的那些并使用上面的插入添加剩余的记录。

* * *

## 回答 #3

> 赞同：22
> 
> 时间：2009-04-07T13:00:43.707

```
INSERT
INTO    first_table f
SELECT  *
FROM    second_table s
ON DUPLICATE KEY
UPDATE
        s.column1 = DO_WHAT_EVER_MUST_BE_DONE_ON_KEY_CLASH(f.column1) 
```

* * *

## 回答 #4

> 赞同：15
> 
> 时间：2009-04-07T13:00:18.437

如果您需要手动执行，请执行一次：

首先，合并到一个临时表中，例如：

```
create table MERGED as select * from table 1 UNION select * from table 2 
```

然后，用类似的东西识别主键约束

```
SELECT COUNT(*), PK from MERGED GROUP BY PK HAVING COUNT(*) > 1 
```

其中 PK 是主键字段...

解决重复项。

重命名表。

[已编辑 - 删除了 UNION 查询中的括号，这导致了下面评论中的错误]

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2013-06-28T01:59:28.313

不像听起来那么复杂......只需将重复的主键从您的查询中删除......这对我有用！

```
INSERT INTO
  Content(
    `status`,
    content_category,
    content_type,
    content_id,
    user_id,
    title,
    description,
    content_file,
    content_url,
    tags,
    create_date,
    edit_date,
    runs
  )
SELECT `status`,
  content_category,
  content_type,
  content_id,
  user_id,
  title,
  description,
  content_file,
  content_url,
  tags,
  create_date,
  edit_date,
  runs
FROM
  Content_Images 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-08-20T13:35:19.777

您可以编写一个脚本来为您更新 FK.. 查看此博客： http: [//multunus.com/2011/03/how-to-easily-merge-two-identical-mysql-databases/](http://multunus.com/2011/03/how-to-easily-merge-two-identical-mysql-databases/)

他们有一个聪明的脚本来使用 information_schema 表来获取“id”列：

```
SET @db:='id_new'; 

select @max_id:=max(AUTO_INCREMENT) from information_schema.tables;

select concat('update ',table_name,' set ', column_name,' = ',column_name,'+',@max_id,' ; ') from information_schema.columns where table_schema=@db and column_name like '%id' into outfile 'update_ids.sql';

use id_new
source update_ids.sql; 
```

# .net - 我可以访问在 Dot net 的同一应用程序中以另一种语言声明的会话变量吗？

> ID：725561
> 
> 赞同：2
> 
> 时间：2009-04-07T12:56:21.517
> 
> 标签：.net

Dot net 允许您以多种语言开发应用程序，即 c# vb.net、j# 等。假设我用两种语言 vb.net 和 c# 开发应用程序。如果我在 vb.net 代码中声明一个会话变量，并且我想在 c# 代码中访问相同的会话变量。是否可以？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-07T13:03:53.123

是的，假设您正在谈论 Web 应用程序，并且它们在同一个站点/进程中，这是可能的

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-07T13:07:33.877

您的技术不清楚，如果您指的是 ASP.NET 会话意义上的会话，那么会话仅可用于在同一应用程序中运行的代码，但是同一应用程序可以使用以各种语言编写的 dll。

如果您指的是可执行应用程序中保存的全局值，那么可以在使用不同语言构建的应用程序中再次包含多个 dll。全局值的可访问性由它们的可访问性修饰符控制。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-07T13:40:25.687

是的，这是完全可能的。只要两种语言的 DLL 使用相同的会话状态实例，就可以从另一种语言访问变量。

# asp.net-mvc - ASP.NET MVC web.config（多个）问题

> ID：725563
> 
> 赞同：2
> 
> 时间：2009-04-07T12:56:53.933
> 
> 标签：asp.net-mvc, web-config

我在服务器上运行 MVC 项目时遇到问题。服务器上的主项目有它自己的 web.config 文件（在 configsections 中引用了 1.0 版本），而“虚拟子项目”也有一个（引用了 3.5 版本）。我收到以下错误：

*配置错误描述：处理服务此请求所需的配置文件期间发生错误。请查看下面的具体错误详细信息并适当地修改您的配置文件。解析器错误消息：已定义部分或组名称“system.web.extensions”。对此的更新可能只发生在定义它的配置级别。*

**主 web.config（位置：）`http://servername/web.config`部分：**

sectionGroup name="system.web.extensions" type="System.Web.Configuration.SystemWebExtensionsSectionGroup, System.Web.Extensions, Version=1.0.61025.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35"

**子项目 web.config (location: `http://servername/subproject/web.config`) 部分：**

sectionGroup name="system.web.extensions" type="System.Web.Configuration.SystemWebExtensionsSectionGroup, System.Web.Extensions, Version=3.5.0.0, Culture=neutral, PublicKeyToken=31BF3856AD364E35"

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-07T13:04:02.840

尝试在子项目 web.config 中删除第二个定义之前的部分。

见：[http ://forums.iis.net/t/1155685.aspx](http://forums.iis.net/t/1155685.aspx)

> 您可以使用子站点的 Web 配置文件中的元素删除预定义的部分或部分组。它看起来像这样：

```
<configuration>
 <configSections>
  <remove name="system.web.extensions "/>
  <!-- Add your new section or section group -->
  </configSections>
</configuration> 
```

了解更多信息，

> 请参考： <configSections> 的 <remove> 元素 [http://msdn.microsoft.com/en-us/library/aa309404(VS.71).aspx](http://msdn.microsoft.com/en-us/library/aa309404(VS.71).aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-07T13:01:24.033

您是否引用了两个不同版本的 dll，否则，将它们都更改为 3.5.0.0。

# .net - 多个 UpdatePanelAnimationExtender 控件 AjaxControlToolKit

> ID：725565
> 
> 赞同：3
> 
> 时间：2009-04-07T12:57:02.077
> 
> 标签：.net, ajax, ajaxcontroltoolkit

我遇到了 UpdatePanelAnimationExtender 和多个更新面板的问题。我想要发生的是让面板淡出，更新，然后淡入。

但是，它会淡出所有面板，只会淡出我更新的面板。显然这是 UpdatePanelAnimationExtender 的一个相当常见的问题，但我似乎找不到解决方案。有人会碰巧知道解决此问题的方法吗？提前致谢。

这是一些示例代码：

```
<asp:UpdatePanel ID="update1" runat="server" UpdateMode="Conditional">
  //--My Code goes in here
</asp:UpdatePanel>

<cc1:UpdatePanelAnimationExtender ID="updateAnimation1" runat="server" TargetControlID="update1">
     <Animations>
         <OnUpdating>
              <FadeOut Duration="0.2" Fps="20" />
         </OnUpdating>
         <OnUpdated>
              <FadeIn Duration="0.2" Fps="20" />
         </OnUpdated>
     </Animations>
</cc1:UpdatePanelAnimationExtender>

<asp:UpdatePanel ID="update2" runat="server" UpdateMode="Conditional">
  //--My Code goes in here
</asp:UpdatePanel>

<cc1:UpdatePanelAnimationExtender ID="updateAnimation2" runat="server" TargetControlID="update2">
     <Animations>
         <OnUpdating>
              <FadeOut Duration="0.2" Fps="20" />
         </OnUpdating>
         <OnUpdated>
              <FadeIn Duration="0.2" Fps="20" />
         </OnUpdated>
     </Animations>
</cc1:UpdatePanelAnimationExtender> 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2010-06-23T13:26:23.557

在 UpdatePanels 上设置 UpdateMode=Always，这将修复它

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-03-04T14:41:32.820

我使用方法 UpdatePanelAnimationExtender 有条件且对 javascript 有效。问候。

```
<cc1:UpdatePanelAnimationExtender ID="upaStock" runat="server" TargetControlID="upStock">
<Animations> 
    <OnUpdating>
        <Sequence>
            <Parallel duration="0">
                <Condition ConditionScript="document.getElementById('ctl00_p1_hdfValidacion2').value == 'true';">
                    <ScriptAction Script="onUpdating('ctl00_p1_pnlPopup','dviStock','divCuerpo');" />
                </Condition>
            </Parallel>
        </Sequence>
    </OnUpdating>

    <OnUpdated>
        <Sequence>
            <Parallel duration="0">
                <ScriptAction Script="onUpdated('ctl00_p1_pnlPopup'); document.getElementById('ctl00_p1_hdfValidacion2').value = 'false';" />
            </Parallel>
        </Sequence>
    </OnUpdated>
</Animations> 
```

# c# - C#：GridView，逐行操作

> ID：725570
> 
> 赞同：2
> 
> 时间：2009-04-07T13:00:02.180
> 
> 标签：c#, asp.net, gridview

我有一个显示用户消息的网格视图。用户拥有的每条消息都在我的数据库表中被标记为已读或未读。

有没有办法根据消息是已读还是未读来更改网格视图中某些行的样式？我希望以粗体显示整行未读消息。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-07T13:02:23.720

您将需要使用该`RowDataBound`事件来执行此类任务。这是一个例子：

```
<asp:GridView ID="GridView1" runat="server" OnRowDataBound="GridView1_RowDataBound" >
...
</asp:GridView> 
```

.

```
protected void GridView1_RowDataBound(object sender, GridViewRowEventArgs e)
{
    // searching through the rows
    if (e.Row.RowType == DataControlRowType.DataRow)
    {
        bool isnew = (bool)DataBinder.Eval(e.Row.DataItem, "IsNew");
        if ( isnew ) e.Row.BackColor = Color.FromName("#FAF7DA"); // is a "new" row
    }
} 
```

* * *

*参考：[http ://blog.devexperience.net/en/5/Change_background_color_of_GridView's_Rows.aspx](http://blog.devexperience.net/en/5/Change_background_color_of_GridView's_Rows.aspx)*

# php - 显示数据库内容？PHP/MySQL

> ID：725594
> 
> 赞同：0
> 
> 时间：2009-04-07T13:04:04.743
> 
> 标签：php, mysql, chat

所以我有一个聊天室类型的数据库，其中用户插入的文本被存储到数据库中，作为他们的用户名在一个字段中，他们的消息在另一个字段中。我想让我的页面输出数据库信息，以便人们可以看到彼此的消息。我该怎么做呢？

此外，是否可以创建一个 for 循环来检查数据库是否已使用新消息更新，因此它会重新加载页面？（然后页面再次输出数据库信息更新大家的消息）

请帮忙..我很困惑。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-07T13:07:50.930

查看 PHP 手册中的[MySQL 函数](http://php.net/mysql)。您需要连接到服务器/数据库并运行选择查询以从表中获取数据。

至于循环：您可以使用 JavaScript setInterval 函数并将其与 AJAX 调用结合起来定期轮询新记录。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-07T13:13:33.833

1.  要从 mysql 数据库中读取任何内容，您可以使用`mysql_connect()`和`mysql_query()`函数，例如：

> ```
> $link = mysql_connect('localhost', 'root', '');
> $results = mysql_query('select * from messages');
> 
> while($row = mysql_fetch_array($results))
> {
>     echo $row['username'] . ': ' . $row['message'].'<br />';
> } 
> ```

2.  要显示新消息，最好的方法是使用 AJAX 并从那里轮询数据库，或者将单独的页面加载到 DIV 中，或者将 XML 取回并放入 HTML 标记中。我建议将[JQuery](http://jquery.com/)用于此类任务。查看[http://www.sitepoint.com/article/ajax-jquery/](http://www.sitepoint.com/article/ajax-jquery/)以获取示例。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-07T15:16:59.760

就像其他人所说的那样，您将需要连接到您的数据库，然后查询您拥有数据的表。

```
while($row = mysql_fetch_assoc($results))
{
    echo $row['username'] . " said: " . $row['message'] . "<br />";
} 
```

我使用 mysql_fetch_assoc() 而不是 mysql_fetch_array() 因为数组是关联数组（不是按整数索引，而是按名称（关联））

至于动态显示页面上的更新，这涉及到AJAX。基本上这意味着您的页面将调用后台脚本以从数据库中获取新记录。这将需要您的“消息”表中的一个新字段，例如“msg_delivered”，您可以在获取它时将其设置为“1”。

如果您有兴趣制作 AJAX 聊天客户端，您应该检查一下：[http ://htmltimes.com/javascript-chat-c​​lient-in-jquery.php](http://htmltimes.com/javascript-chat-client-in-jquery.php)

# asp.net-mvc - 专注于 ASP.NET MVC 模型错误

> ID：725604
> 
> 赞同：9
> 
> 时间：2009-04-07T13:06:10.760
> 
> 标签：asp.net-mvc, model-view-controller, validation

我有一个模型可以进行一些验证检查并将错误添加到 ModelState：

```
ViewData.ModelState.AddModelError("mycontrol", "message") 
```

它们在视图端显示得很好，但是有没有办法将焦点设置到与验证消息对应的控件上？现在，页面刷新并停留在页面的顶部，所以如果错误出现在页面的末尾，用户就不清楚发生了什么。

注意：另一种解决方案是 ValidationSummary 在页面顶部显示错误列表，但我一直无法让它显示任何内容。我所有的错误都通过 ValidationMessage 显示。

**编辑：**我发现我的 ValidationSummary 有问题。我的标记是：

```
<% Html.ValidationSummary()%> 
```

应该是：

```
<%=Html.ValidationSummary()%> 
```

但是，我仍然想知道如何捕捉到错误的字段。

* * *

## 回答 #1

> 赞同：36
> 
> 时间：2009-04-07T15:43:59.807

滚动到第一个输入时出现错误的一些 jquery 优点。棘手的一点是，您必须在调用 focus() 之前获取底层 DOM 元素，因为 jQuery 对象上的 focus() 方法会触发焦点事件，而不是将焦点赋予元素。

```
<script type='text/javascript'>
    $(document).ready( function()
    {
       var input = $('.input-validation-error:first');

       if(input)
       {
           input.focus();
       }
    });
</script> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-07T13:21:47.493

您可以使用 JavaScript 在页面上查找添加了 MVC 验证 HTML 类 (input-validation-error) 的输入元素，并将克拉移到第一个。尽管我还没有测试过，但 / 应该 / 将屏幕移动到该元素。

诸如 jQuery 之类的 JS 库将使这一切变得简单。

# asp.net-mvc - 我如何对这个业务逻辑进行单元测试？

> ID：725608
> 
> 赞同：3
> 
> 时间：2009-04-07T13:07:20.417
> 
> 标签：asp.net-mvc, unit-testing, moq

我有一个方法可以接收一个对象并将其保存到数据库中。但是，在我保存对象之前，我执行以下操作...

### （伪代码）

```
if (IsAuthenticated)
{
   foo.UserId = AuthenticatedUser.Id;
}
else
{
   foo.AnonEmail = "Jon@World-Domination";
   foo.AnonName = "Jon Skeet";
}

try
{
    _fooService.Save(foo);
}
catch
{
    // Some view, with error stuff now added to 
    return View(...); ViewData.ModelState.
}

// all good, redirect to the proper next view.
return RedirectToAction(...); 
```

该代码工作正常，但我不确定如何编写两个单元测试以获得成功。a) 用户使用有效数据进行身份验证 b) 用户未使用有效数据进行身份验证。

我不确定该怎么做的原因是，两种情况都返回相同的 RedirectToAction(..) 视图对象。所以我可以成功测试..但它没有告诉我保存的对象是否包含经过身份验证的用户 ID 或匿名信息。就像我想要第一个单元测试说

*   起订量为经过身份验证的用户
*   调用方法
*   测试结果是否为 RedirectToActionView
*   测试持久化的 foo 对象是否包含 moq 的用户 ID。

想法？

## 更新

常见的建议是我模拟 fooService。我目前正在使用依赖注入和起订量，所以有人可以告诉我如何使用起订量吗？不过，我不确定DI在这里有多重要？？？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-07T13:13:58.900

我会模拟该`_fooService`对象，并测试它作为测试的一部分接收到的内容。这样，您的周围代码保持不变并且不受影响，并且通过检查`_fooService`接收到的内容，您可以断言行为是否符合预期。在这种情况下，返回对象不感兴趣。

你怎么嘲笑你的`_fooService`？您可以实现自己的“测试”版本（遵循与真实世界版本相同的接口），或使用模拟框架。无论您使用哪种方法，您的上面的代码都需要配置给定的实现`_fooService`（通常在构造时 - 请参阅[依赖注入](http://en.wikipedia.org/wiki/Dependency_injection)以获取有关其工作原理的更多信息）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-07T13:15:24.280

您可以模拟 _fooService.Save(foo) 并检查提供的 foo。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-09T20:31:17.123

也许您发现很难测试对象，因为您在一个方法中发生了多个活动。

这里的总体主题是控制器逻辑。

1.  用用户信息装饰域对象
2.  坚持更新逻辑
3.  根据成功/失败确定要渲染的下一个视图

如果您提取另一个对象（IUserDecoratorService），那么您的代码看起来像

```
userService.UpdateUserInformation(foo);

try
{
    _fooService.Save(foo);
}
catch
{
    // Some view, with error stuff now added to 
    return View(...); ViewData.ModelState.
}

// all good, redirect to the proper next view.
return RedirectToAction(...); 
```

此方法易于测试，因为它是与 2 项服务的 2 次简单交互以及您已经可以测试的路由决策。

现在您只需要为您的新服务编写测试：

```
[Test]
public void ShouldDecorateWithUserIdForAuthenticatedUser()
{
    {setup authenticated user}
    :
    service.UpdateUserInformation(foo);

    Assert.AreEqual(expectedId, foo.UserId);
    Assert.IsNull(foo.AnonEmail);
    Assert.IsNull(foo.AnonEName);

}

[Test]
public void ShouldSpoofTheAllKnowingSkeetIfAnonymousUser()
{
    {setup anonymous user}
    :
    service.UpdateUserInformation(foo);

    Assert.AreEqual(UnassignedId, foo.UserId);
    Assert.AreEqual("Jon@World-Domination", foo.AnonEmail);
    Assert.AreEqual("Jon Skeet", foo.AnonName);

} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-08T11:48:27.773

您想使用 DI 将 fooservice 正确实现到您的对象中，因此在测试时您可以这样做；

（使用最小起订量）

```
[TestMethod]
public void Jon_Skeet_Is_Saved_If_User_Not_Authenticated()
{
  bool jonWasSaved = false;
  var mockFooService = new Mock<IFooService>();
  mockFooService
       .Expect(x => x.Save(It.Is<Foo>(foo => foo.AnonName == "Jon Skeet")))
       .Callback(() => jonWasSaved = true;);

  FooManager instance = new FooManager(mockFooService.Object);
  Foo testFoo = new Foo();
  testFoo.UserId = 1; // this is not the authenticated id

  instance.baa(foo);

  Assert.IsTrue(jonWasSaved);
} 
```

您可能还想传入用于检查 AuthetnicatedUser.Id 的任何服务的模拟版本

高温高压

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-07T13:15:28.353

您仍然可以引用您的对象。在您的单元测试结束时，您不能只断言 foo.AnonEmail 或 UserId 的值是什么吗？

单元测试不应该触及外部源，（这是一个集成测试）所以如果你走这条路，你应该模拟你的数据源，然后通过你的模拟进行测试。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-07T13:15:44.560

您可以在测试中访问 foo 吗？我假设这是课堂上的一个领域。有公共吸气剂吗？如果不是，您可能必须使用反射（我假设它在 asp.net 中可用，但我不太熟悉它）

# treeview - ExtJS：向 TreePanel 中的节点添加单击操作

> ID：725613
> 
> 赞同：1
> 
> 时间：2009-04-07T13:07:56.513
> 
> 标签：treeview, extjs

[修订] 我正在 ExtJs 中创建一个 TreePanel，它从 JSON 文件加载其子项。我在向节点添加点击操作时遇到问题。我不确定它是添加到创建树的脚本中，还是添加为 JSON 中的属性，如果是，语法是什么。任何帮助，将不胜感激！如果可能，请提供一个例子。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2010-05-05T14:25:39.293

向 TreePanel 添加一个监听器：

```
listeners: {
    click: function(node, event){
        console.log(node);
    }
} 
```

并使用节点中的数据。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-08T03:17:58.373

这是一个非常普遍谈论的问题（一般事件），所以我建议搜索 extjs 论坛并阅读他们在学习中心的内容。

事件侦听器可以在创建 TreePanel 时分配或附加到现有 TreePanel。

我有一个类似（和常见）的设置，我有一个树用作导航菜单，每个叶节点都充当应该在 TabPanel 中打开的链接。

要处理节点点击，您可以执行以下操作：

```
Ext.get('your-tree').on('click', function(node, event){
    如果（节点。isLeaf（））{
        // 对节点做你需要做的事情。
    }
});

```

[Jozef Sakalos（又名 Saki）](http://extjs.com/forum/member.php?u=2178)在他的网站[extjs.eu](http://extjs.eu/)上提供了大量信息。我认为您对[组件通信](http://examples.extjs.eu/?ex=compcomm)示例最感兴趣。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-06T02:38:15.650

Gerry 让你走上正轨，Saki 的例子永远不会出错。我刚刚回答了一个非常相似的问题。该答案也可能为您提供更多信息：

[如何在 ExtJS TreePanel 中找到选定的节点？](https://stackoverflow.com/questions/822319/how-do-i-find-the-selected-node-in-an-extjs-treepanel)

# sql-server - 将 LINQ2SQL 数据上下文约束到特定的 SQL 应用程序角色

> ID：725620
> 
> 赞同：0
> 
> 时间：2009-04-07T13:11:08.550
> 
> 标签：sql-server, linq-to-sql, application-role

在 SQL Server 中，您可以拥有应用程序角色安全性，例如，您可以通过它授予源自特定应用程序的特定权限。

您可以执行 sp_SetAppRole() 来设置应用程序角色，但想知道在使用摩擦最小的 LINQ2SQL 数据上下文时如何实现这一点。

我看过这个链接： [http](http://social.msdn.microsoft.com/Forums/en-US/linqprojectgeneral/thread/e25e98a6-b0ac-42fc-b70c-2b269a7fa1cb) ://social.msdn.microsoft.com/Forums/en-US/linqprojectgeneral/thread/e25e98a6-b0ac-42fc-b70c-2b269a7fa1cb但希望有更清洁的方法/

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-12T14:42:41.443

我的结论（原因见下文）：

使用 SQL 应用程序角色不能很好地与连接池配合使用，也不应该直接在最终用户应用程序中使用（仅在业务层上）。

SQL 替代方案将带走使用 linq 的许多优势，因为它依赖于 SP。

我的建议：

如果您有业务层/服务器，请在应用程序级别进行授权，而不是依赖 sql 授权。如果您仍要授权，请拥有一个与业务层应用程序关联的帐户，并为其关联一个普通角色。

如果是直接连接到 sql 的客户端应用程序。用户仍然有权调用他（她）身份可以访问的任何内容，并且应用程序密码在那里。如果您对具有该级别访问权限的用户不满意，则需要一个业务层。

如果您仍想继续使用该方法，请关闭连接池。要减少打开/关闭开销，请显式打开连接。

* * *

完整解释/参考：

一个问题是它不能很好地与连接池配合使用。这与 linq2sql 无关。[请参阅](http://msdn.microsoft.com/en-us/library/8xx3tyca.aspx)msdn的末尾。

[自 sql server 2005 (msdn link)](http://msdn.microsoft.com/en-us/library/bb669062.aspx)以来有 2 个替代方案，您链接到的线程中也提到了一个，但它也指出它可能会出错。

请注意，它在 2 层场景中是不安全的选项，例如客户端使用的应用程序直接连接到 sql 时。在这些情况下，客户端计算机中任何应用程序的密码都将在其中公开。如果它是连接的业务层，它会更安全，但这正是您真正想要连接池的情况。

在我的第二个 msdn 链接中提到的另一种替代方案适用于连接池。它基于存储过程和execute as 语句。在过程内部调用execute as，并在过程执行后恢复上下文。这很好，但通过使用 sp 路线真的会从 linq2sql 中得到很多东西。

# javascript - 匹配 HTML 中没有标签内容的文本

> ID：725623
> 
> 赞同：1
> 
> 时间：2009-04-07T13:12:09.733
> 
> 标签：javascript, html, regex

我正在寻找 Javascript 的正则表达式来搜索 HTML 中的文本（例如“span”）。

例子：

> `<div>Lorem span Ipsum dor<a href="blabla">la`**布拉**`la</a> dsad <span>2</span> ... </div>`

但是只有“Lorem”之后的“span”应该匹配，而不是`<span>`标签。
对于第二个示例，如果我们搜索“bla”，则应该只匹配粗体文本。

编辑：

HTML是通过innerHTML获取的，匹配的会被包围`<span class="x">$text</span>`，然后重写为该节点的innerHTML，所有这些都不会*杀死*其他标签。

EDIT2 和我的解决方案：

我编写了自己的搜索，它是逐字符搜索，带有缓存和标志。

感谢您的帮助！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-07T14:47:46.570

您可以使用 dom 方法来处理每个文本节点。

此方法将父节点作为第一个参数，并遍历其所有子节点，处理文本节点，并将函数作为第二个参数传递。例如，该函数是您对测试节点的数据进行操作的地方，以查找或替换或删除或将找到的文本包装在“突出显示”的范围内。

您可以仅使用第一个参数调用该函数，它将返回一个文本节点数组，然后您可以使用该数组来操作文本 - 在这种情况下，数组项是每个节点，并且具有数据、父节点和兄弟节点.

```
document.deepText= function(hoo, fun){
    var A= [], tem;
    if(hoo){
        hoo= hoo.firstChild;
        while(hoo!= null){
            if(hoo.nodeType== 3){
                if(fun){
                    if((tem= fun(hoo))!== undefined){
                       A[A.length]= tem;
                    }
                }
                else A[A.length]= hoo;
            }
            else A= A.concat(arguments.callee(hoo, fun));
            hoo= hoo.nextSibling;
        }
    }
    return A;
} 
```

//测试用例

```
function ucwords(pa, rx){
    var f= function(node){
        var t= node.data;
        if(t && t.search(rx)!=-1){
            node.data= t.replace(rx,function(w){return w.toUpperCase()});
            return node;
        }
        return undefined;
    }
    return document.deepText(pa, f);
} 
```

**ucwords(document.body,/\bspan\b/ig)**

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-07T13:21:26.777

如果您在 DOM 元素中有 HTML，则可以使用 textContent/innerText 来获取文本（不带任何 HTML 标签）：

```
var getText = function(el) {
    return el.textContent || el.innerText;
};
// usage:
// <div id="myElement"><span>Lorem</span> ipsum <em>dolor<em></div>
alert(getText(document.getElementById('myElement'))); // "Lorem ipsum dolor" 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-07T13:45:36.860

```
(?<!\<|/)span 
```

这应该给出所有不是标签的跨度事件。希望这至少有一点帮助:)

说明：查找前面*没有*or的所有`span`事件*`<``/`*

 ** * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-07T14:54:02.233

你想做的事情可以用 jQuery 很容易地完成：

```
 $("span:contains('blah')) 
```

如果要进行正则表达式匹配，请执行上一个堆栈溢出示例中所做的操作：

[jQuery 正则表达式](https://stackoverflow.com/questions/190253/jquery-selector-regular-expressions/193787#193787)

要获得更优雅的解决方案，请创建[自定义选择器](http://www.west-wind.com/weblog/posts/519980.aspx)。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-07T22:09:53.090

```
/span(?=[^>]*<)/ 
```

换句话说，从单词“span”的末尾向前看，在下一个左尖括号之前没有右尖括号，所以我们不能在标签内。据说，带引号的属性值可以包含右尖括号，尽管我从未见过这样做。但是，为了涵盖这种可能性，您可以使用这个正则表达式：

```
/span(?=(?:[^>"']+|"[^"]*"|'[^']*')*<)/ 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-07T13:18:13.103

如果我理解正确，您想搜索一个词，但只搜索不属于 HTML 标记的词。

我没有确切的答案，但我用于开发正则表达式的一些工具是这个站点：[http](http://www.regular-expressions.info/) ://www.regular-expressions.info/和这个程序：[http://www.radsoftware.com。 au/正则表达式设计器/](http://www.radsoftware.com.au/regexdesigner/)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-07T13:18:52.197

这在一般情况下可能是不可能的，因为您需要计算正则表达式无法实现的开始和结束标签。

正则表达式不是处理 XML 的智能解决方案。相反，您应该使用 HTML 或 XML DOM 方法来提取所需的信息。

如果您真的想要或需要使用正则表达式，您可以尝试以下方法。

```
>[^<]*bla[^<]*< 
```

但我很确定这在一般情况下是行不通的。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2013-05-10T15:39:20.123

* ***使用前瞻发现了一个新的解决方案

```
 var pageHTML ="  <span aa span > span asa span";
 var regex = "span(?!([^<]+)?>)"; 
```

只有当它没有“<”然后它后面有“>”时，这个正则表达式才会找到“span”这个词。

** 旧解决方案

这是我的解决方案，我正在寻找“asd”，如果它周围有打开和关闭标签，我会忽略这个匹配。

我正在这样做，通过查看匹配单词的右侧和左侧，如果我发现它被标签包围，我返回相同的匹配单词“我不替换它”，如果没有，我用文本替换它我需要

```
 var pageHTML ="  < aa asd > asd < asd";
    var regex = "asd";
    var pattern = new RegExp(regex, "gi");
    var replaceWord = "dsa";

    //Replace all instances of word/words with our special spans
    pageHTML = pageHTML.replace(pattern, function(match, index, original){
        var leftIndex = index;  
        var rightIndex = parseInt(parseInt(index)+match.length);

        var insideTag = false;
        var foundOpenTag = false;

        for(; leftIndex > 0; leftIndex--){
           if(pageHTML.charAt(leftIndex) == ">")
               break;
           if(pageHTML.charAt(leftIndex) == "<"){
                   foundOpenTag = true;
                   break;
               }
        }

        if(!foundOpenTag){
            return replaceWord;
        }

      for(; rightIndex < pageHTML.length ; rightIndex++){
           if(pageHTML.charAt(rightIndex) == "<")
               break;
           if(pageHTML.charAt(rightIndex) == ">" ){
                   insideTag = true;
                   break;
               }
        }
        if(insideTag)
            return match;
        else return replaceWord;

            }); 
```

警报（页面HTML）；

# asp.net - 生成文件，然后启动安全下载

> ID：725625
> 
> 赞同：2
> 
> 时间：2009-04-07T13:13:26.080
> 
> 标签：asp.net, security, excel, download

在 asp.net 2.0 (VB) 环境中工作时，我已经有了可以从数据库中为网站的特定“用户”生成 excel 文件的代码。我希望能够按需启动此报告生成器，然后在生成文件后，允许用户下载此文件。

我怎样才能安全地做到这一点，而不仅仅是将文件转储到一些公开可读的目录中？

注意：与[this question](https://stackoverflow.com/questions/643643/how-to-create-and-download-excel-document-using-asp-net)相关，但我真正感兴趣的部分从未得到回答。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-07T13:19:45.953

您可以创建一个允许您进行授权的 HTTP 处理程序，而不是将其放在公共目录中。

您可以通过在 web.config 中编译和注册或通过创建 ashx 页面来创建处理程序。然后您的页面将授权用户，然后将内容写入响应。

如果您需要会话状态，请务必从 IRequiresSessionState 继承。

# 编辑

我是 C# 人，所以这里有一个示例：

```
public class DownloadFile : IHttpHandler, System.Web.SessionState.IRequiresSessionState
{

    public void ProcessRequest (HttpContext context) {
    //Validate user is authenticiated and authorized.
    if (context.Request.IsAuthenticated)
    {
         //This is your own custom authorization mechanism
         if (AuthorizeUser(context.Request.User))
         {
            //not sure what the correct content type is. This is probally wrong
            context.Response.ContentType = "application/xls";
            //Setting size is optional               
            context.Response.AddHeader("Content-Disposition",
               "attachment; filename=" + downloadName + "; size=" +               myExcellFile.Length.ToString());
            context.Response.BinaryWrite(myExcellFile);

         }

    } 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-07T13:21:11.147

使用 Http 处理程序（*.ashx 文件）。将生成文件的代码移动到处理程序，在生成文件*之前*检查那里的安全性，设置[适当的 content-type 和 content-disposition 标头](https://stackoverflow.com/questions/186867/what-content-type-to-force-download-of-text-response)，并用于`Response.BinaryWrite`将文件直接发送到浏览器。永远不要将它放在服务器的文件系统上。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-07T13:22:07.103

你可以吗...？

1.  在私人（用户无法访问）文件夹中创建您的 excel 文件
2.  向用户返回与 Excel 电子表格相关联的唯一 url（不容易猜到的东西）
3.  在您的应用程序中处理该 url 请求并将 excel 电子表格流式传输给调用者（相应地更改响应的内容类型）

这将允许您让这些 url 超时，甚至在需要时动态重新生成 excel 电子表格。

# c# - 使用 Google Data API 使用 C# 访问 Google 电子表格

> ID：725627
> 
> 赞同：106
> 
> 时间：2009-04-07T13:13:51.367
> 
> 标签：c#, google-sheets, google-api-dotnet-client, google-data-api, google-sheets-api

我在谷歌电子表格中有一些信息作为单张纸。有什么方法可以通过提供 google 凭据和电子表格地址从 .NET 读取此信息。是否可以使用 Google 数据 API。最终，我需要从 DataTable 中的 Google 电子表格中获取信息。我该怎么做？如果有人尝试过，请分享一些信息。

* * *

## 回答 #1

> 赞同：183
> 
> 时间：2009-05-07T14:43:07.240

根据[.NET 用户指南](https://developers.google.com/google-apps/spreadsheets/)：

下载[.NET 客户端库](http://code.google.com/p/google-gdata/)：

添加这些 using 语句：

```
using Google.GData.Client;
using Google.GData.Extensions;
using Google.GData.Spreadsheets; 
```

认证：

```
SpreadsheetsService myService = new SpreadsheetsService("exampleCo-exampleApp-1");
myService.setUserCredentials("jo@gmail.com", "mypassword"); 
```

获取电子表格列表：

```
SpreadsheetQuery query = new SpreadsheetQuery();
SpreadsheetFeed feed = myService.Query(query);

Console.WriteLine("Your spreadsheets: ");
foreach (SpreadsheetEntry entry in feed.Entries)
{
    Console.WriteLine(entry.Title.Text);
} 
```

给定您已经检索到的 SpreadsheetEntry，您可以获得此电子表格中所有工作表的列表，如下所示：

```
AtomLink link = entry.Links.FindService(GDataSpreadsheetsNameTable.WorksheetRel, null);

WorksheetQuery query = new WorksheetQuery(link.HRef.ToString());
WorksheetFeed feed = service.Query(query);

foreach (WorksheetEntry worksheet in feed.Entries)
{
    Console.WriteLine(worksheet.Title.Text);
} 
```

并获得基于单元格的提要：

```
AtomLink cellFeedLink = worksheetentry.Links.FindService(GDataSpreadsheetsNameTable.CellRel, null);

CellQuery query = new CellQuery(cellFeedLink.HRef.ToString());
CellFeed feed = service.Query(query);

Console.WriteLine("Cells in this worksheet:");
foreach (CellEntry curCell in feed.Entries)
{
    Console.WriteLine("Row {0}, column {1}: {2}", curCell.Cell.Row,
        curCell.Cell.Column, curCell.Cell.Value);
} 
```

* * *

## 回答 #2

> 赞同：23
> 
> 时间：2009-05-11T03:52:35.670

我围绕[Google 的 .Net 客户端库](http://code.google.com/p/google-gdata/)[编写了一个简单的包装器](http://bugsquash.blogspot.com/2008/10/crud-api-for-google-spreadsheets.html)，它公开了一个更简单的类似数据库的接口，具有强类型的记录类型。这是一些示例代码：

```
public class Entity {
    public int IntProp { get; set; }
    public string StringProp { get; set; }
}

var e1 = new Entity { IntProp = 2 };
var e2 = new Entity { StringProp = "hello" };
var client = new DatabaseClient("you@gmail.com", "password");
const string dbName = "IntegrationTests";
Console.WriteLine("Opening or creating database");
db = client.GetDatabase(dbName) ?? client.CreateDatabase(dbName); // databases are spreadsheets
const string tableName = "IntegrationTests";
Console.WriteLine("Opening or creating table");
table = db.GetTable<Entity>(tableName) ?? db.CreateTable<Entity>(tableName); // tables are worksheets
table.DeleteAll();
table.Add(e1);
table.Add(e2);
var r1 = table.Get(1); 
```

还有一个 LINQ 提供程序可以转换为 google 的[结构化查询运算符](http://code.google.com/apis/spreadsheets/docs/2.0/reference.html#ListParameters)：

```
var q = from r in table.AsQueryable()
        where r.IntProp > -1000 && r.StringProp == "hello"
        orderby r.IntProp
        select r; 
```

* * *

## 回答 #3

> 赞同：19
> 
> 时间：2016-06-16T06:51:44.467

**（2016 年 6 月至 11 月）**问题及其答案现已过时，因为：1）[GData API](http://developers.google.com/gdata/docs/directory)是上一代 Google API。虽然并非所有 GData API 都已被弃用，*但*[所有最新的 Google API](http://developers.google.com/api-client-library/dotnet/apis)都不使用[Google 数据协议](http://developers.google.com/gdata)；2) 有一个[新的 Google Sheets API v4](http://googleappsdeveloper.blogspot.com/2016/05/apps-dev-sheets-api.html)（也不是 GData）。

 *从这里开始，您需要获取[适用于 .NET 的 Google API 客户端库](http://developers.google.com/api-client-library/dotnet)并使用最新的[Sheets API](http://developers.google.com/sheets)，它比任何以前的 API 都更强大和灵活。这是一个[C# 代码示例](http://developers.google.com/sheets/quickstart/dotnet)，可帮助您入门。另请查看[Sheets API 的 .NET 参考文档](https://developers.google.com/resources/api-libraries/documentation/sheets/v4/csharp/latest/)和[.NET Google APIs 客户端库开发人员指南](http://developers.google.com/api-client-library/dotnet/get_started)。

如果您对 Python 不过敏（如果您是，请假装它是伪代码；）），我制作了几个视频，其中包含稍长、更多“真实”的使用 API 的示例，您可以从中学习并迁移到 C#（如果需要） ：

*   [将 SQL 数据迁移到工作表](http://googleappsdeveloper.blogspot.com/2016/06/introducing-google-sheets-api-v4.html)[（](http://wescpy.blogspot.com/2016/06/using-new-google-sheets-api.html)代码深入研究）
*   [使用 Sheets API 格式化文本](http://gsuite-developers.googleblog.com/2016/11/formatting-cells-with-the-google-sheets-api.html)（代码深入[研究](http://wescpy.blogspot.com/2016/09/formatting-cells-in-google-sheets-with.html)）
*   [从电子表格数据生成幻灯片](https://gsuite-developers.googleblog.com/2016/11/generating-slides-from-spreadsheet-data.html)（代码深入[研究](http://wescpy.blogspot.com/2016/11/generating-slides-from-spreadsheet-data.html)）
*   [Sheets API 视频库](https://developers.google.com/sheets/api/videos)中的那些和其他

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2018-06-04T12:38:05.297

这个由 Marcos Placona 于 2017 年 3 月 24 日制作的 Twilio 博客页面可能会有所帮助。

[Google 电子表格和 .NET Core](https://www.twilio.com/blog/2017/03/google-spreadsheets-and-net-core.html)

它引用[了 Google.Api.Sheets.v4](https://www.nuget.org/packages/Google.Apis.Sheets.v4/)和[OAuth2](https://developers.google.com/identity/protocols/OAuth2)。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-05-04T13:36:42.777

您可以通过多种方式完成您的要求：

1.  使用 Google 的电子表格 C# 库（如 Tacoman667 的回答）来获取 ListFeed，它可以返回一个行列表（Google 用语中的 ListEntry），每个行都有一个名称-值对列表。Google 电子表格 API ( [http://code.google.com/apis/spreadsheets/code.html](http://code.google.com/apis/spreadsheets/code.html) ) 文档提供的信息足以帮助您入门。

2.  使用 Google 可视化 API，它可以让您提交更复杂（几乎类似于 SQL）的查询，以仅获取您需要的行/列。

3.  电子表格内容作为 Atom 提要返回，因此您可以使用 XPath 或 SAX 解析来提取列表提要的内容。[在http://gqlx.twyst.co.za](http://gqlx.twyst.co.za)有一个这样做的例子（虽然我害怕只在 Java 和 Javascript 中）。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-05-04T12:59:13.413

[http://code.google.com/apis/gdata/articles/dotnet_client_lib.html](http://code.google.com/apis/gdata/articles/dotnet_client_lib.html)

这应该让你开始。我最近没有玩过它，但不久前我下载了一个非常旧的版本，它看起来很可靠。这个也更新到了 Visual Studio 2008，所以请查看文档！

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2019-11-25T19:08:14.753

正如@wescpy 所说，@Kelly 最受好评的答案不再有效。但是，在 2020-03-03 之后，由于使用的库使用`Google Sheets v3 API`.

> Google Sheets v3 API 将于 2020 年 3 月 3 日关闭

[https://developers.google.com/sheets/api/v3](https://developers.google.com/sheets/api/v3)

这是由 Google 于 2019 年 9 月 10 日宣布的：

[https://cloud.google.com/blog/products/g-suite/migrate-your-apps-use-latest-sheets-api](https://cloud.google.com/blog/products/g-suite/migrate-your-apps-use-latest-sheets-api)

新的代码示例`Google Sheets v4 API`：

去

[https://developers.google.com/sheets/api/quickstart/dotnet](https://developers.google.com/sheets/api/quickstart/dotnet)

并生成`credentials.json`. 然后安装`Google.Apis.Sheets.v4`NuGet 并尝试以下示例：

请注意，我`Unable to parse range: Class Data!A2:E`在示例代码中遇到了错误，但在我的电子表格中出现了错误。`Sheet1!A2:E`但是，自从我的工作表被命名后，更改为工作。也只与`A2:E`.

```
using Google.Apis.Auth.OAuth2;
using Google.Apis.Sheets.v4;
using Google.Apis.Sheets.v4.Data;
using Google.Apis.Services;
using Google.Apis.Util.Store;
using System;
using System.Collections.Generic;
using System.IO;
using System.Threading;

namespace SheetsQuickstart
{
    class Program
    {
        // If modifying these scopes, delete your previously saved credentials
        // at ~/.credentials/sheets.googleapis.com-dotnet-quickstart.json
        static string[] Scopes = { SheetsService.Scope.SpreadsheetsReadonly };
        static string ApplicationName = "Google Sheets API .NET Quickstart";

        static void Main(string[] args)
        {
            UserCredential credential;

            using (var stream =
                new FileStream("credentials.json", FileMode.Open, FileAccess.Read))
            {
                // The file token.json stores the user's access and refresh tokens, and is created
                // automatically when the authorization flow completes for the first time.
                string credPath = "token.json";
                credential = GoogleWebAuthorizationBroker.AuthorizeAsync(
                    GoogleClientSecrets.Load(stream).Secrets,
                    Scopes,
                    "user",
                    CancellationToken.None,
                    new FileDataStore(credPath, true)).Result;
                Console.WriteLine("Credential file saved to: " + credPath);
            }

            // Create Google Sheets API service.
            var service = new SheetsService(new BaseClientService.Initializer()
            {
                HttpClientInitializer = credential,
                ApplicationName = ApplicationName,
            });

            // Define request parameters.
            String spreadsheetId = "1BxiMVs0XRA5nFMdKvBdBZjgmUUqptlbs74OgvE2upms";
            String range = "Class Data!A2:E";
            SpreadsheetsResource.ValuesResource.GetRequest request =
                    service.Spreadsheets.Values.Get(spreadsheetId, range);

            // Prints the names and majors of students in a sample spreadsheet:
            // https://docs.google.com/spreadsheets/d/1BxiMVs0XRA5nFMdKvBdBZjgmUUqptlbs74OgvE2upms/edit
            ValueRange response = request.Execute();
            IList<IList<Object>> values = response.Values;
            if (values != null && values.Count > 0)
            {
                Console.WriteLine("Name, Major");
                foreach (var row in values)
                {
                    // Print columns A and E, which correspond to indices 0 and 4.
                    Console.WriteLine("{0}, {1}", row[0], row[4]);
                }
            }
            else
            {
                Console.WriteLine("No data found.");
            }
            Console.Read();
        }
    }
} 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-04-07T13:17:57.847

我很确定 Google 代码上会有一些 C# SDK/工具包。我找到[了这个](http://code.google.com/p/google-gdata/)，但可能还有其他的，所以值得一游。

# c - C中的正则表达式

> ID：725630
> 
> 赞同：5
> 
> 时间：2009-04-07T13:14:21.770
> 
> 标签：c, regex

我很好奇，有人知道在 C 中进行正则表达式匹配的好方法吗？我能想到的唯一方法是通过 Flex。这是唯一的方法还是有更好的方法？

谢谢！

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-04-07T13:16:17.540

呃……最好的办法是

```
#include <regex.h> 
```

那是正则表达式的 POSIX[标准 API 。](http://www.osix.net/modules/article/?id=349)

对于非 POSIX 系统，滚动您自己的系统是一种选择，基本的正则表达式引擎并不难完成。我敢肯定也有现成的解决方案，我还没有需要。

想想看，我认为[glib](http://library.gnome.org/devel/glib/stable/glib-Perl-compatible-regular-expressions.html)有一个。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-04-07T13:28:41.813

根据您正在寻找的方言和您使用的平台：

*   POSIX 正则表达式很可能在标准 C 库中 - 请参阅 <regex.h> 和 regcomp、regerror、regexec、regfree。
*   [libPCRE](http://www.pcre.org/)提供了 perl 的大部分扩展正则表达式功能
*   glib 有[GRegex](http://library.gnome.org/devel/glib/stable/glib-regex-syntax.html)
*   [Henry Spencer 的 Tcl 正则表达式库](http://arglist.com/regex/)。

Henry Spencer 还完成了另一个[正则表达式库](http://www.straatinternet.com/opensource/hsre/)，被当前版本的 TCL 和 PostgreSQL 使用。这个很有趣，因为它是一种混合 NFA/DFA 实现。

> 以多种方式接受相同字符串的正则表达式（如 a*a?）本质上需要 NFA。通常的实现使用回溯将 NFA 建模为 DFA，对于特别退化的模式，回溯可能高达 O(2^length(input))。但是，简单的递归实现可以通过捕获、反向引用、代码回调以及许多语言提供的所有常见“额外”特性来扩展，除了测试匹配。
> 
> “NFA”方法跟踪多个当前状态，并使用每个传入字符更新所有这些状态（有关更多解释，请参阅 Ross Cox 对[Thompson NFA regexes的文章）。](http://swtch.com/%7Ersc/regexp/regexp1.html)这种方法是 O(input.length*pattern.length)，它更快 - 在最坏的情况下非常快 - 但不能执行反向引用或捕获，因为它不跟踪它是*如何*进入状态的。
> 
> Spencer 的方法是一种混合方法，将模式的某些部分编译到 NFA 方法中，并且仅在实际请求捕获的必要时使用回溯。这通常是一场重大胜利（参见 TCL[在 regex-dna 大战中的立场](http://shootout.alioth.debian.org/gp4/benchmark.php?test=regexdna&lang=all&box=1)）。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-07T13:30:49.267

看这个：[http ://www.pcre.org/](http://www.pcre.org/)

这是一个非常好的库！

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-07T13:16:28.007

[http://www.gnu.org/software/hello/manual/libc/Regular-Expressions.html](http://www.gnu.org/software/hello/manual/libc/Regular-Expressions.html)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-08T02:15:03.190

一种完全不同的方法是尝试[解析表达式语法 (PEG)](http://en.wikipedia.org/wiki/Parsing_expression_grammar)。PEG 从解析器的角度来解决模式匹配问题，甚至可以利用形成完整语法的多个规则。这使得编写匹配平衡括号的表达式成为可能，否则在大多数正则表达式方言中很难表达。

尽管 PEG 相对较新，但应该有一些可以从 C 中使用的实现。

我个人使用的 PEG 实现是[LPeg](http://www.inf.puc-rio.br/~roberto/lpeg/lpeg.html)。它巧妙地绑定到 Lua，巧合的是，它是由 Lua 的主要作者之一，Roberto Ierusalimschy 编写的。它提供了完整的 PEG 实现，还包括一个适配器，可将正则表达式转换为等效的 PEG 以供执行。

将 Lua 核心链接到 C 程序只是为了访问 LPeg 可能听起来有点矫枉过正，但实际上并不难做到，即使您没有计划将 Lua 用于其他目的。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-07T13:17:10.937

也许[这篇文章](http://www.osix.net/modules/article/?id=349)会有所帮助？它向您展示了如何使用`regex.h`.

> 是的，posix regex 拥有这一切难道不是很棒吗，所以我想知道为什么它们不在 C 语言中？好吧，我找到了答案，我很高兴，它们就在那里，以及如何使用它们

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-07T13:31:25.100

[提升正则表达式](http://www.boost.org/doc/libs/1_38_0/libs/regex/doc/html/index.html)

# iphone - 从 iPhone 向 .NET SOAP Web 服务提交 XML 的问题

> ID：725631
> 
> 赞同：1
> 
> 时间：2009-04-07T13:15:03.313
> 
> 标签：iphone, web-services, soap

我的 iPhone 应用程序需要向已经存在的 .NET SOAP Web 服务提交对象，以便将其保存到数据库服务器。我认为最简单的方法是构建对象的 XML 表示并将其传递给 Web 服务。但是，这似乎不起作用。如果 XML 的深度超过一级，则 Web 服务方法似乎没有被调用（当 Web 服务方法被调用时，它会在事件日志中写入一个条目）。

例如，如果 XML 是：

```
<Name>Jim</Name> 
```

Web 服务方法被调用，并且 Web 服务器上的事件日志中有一个条目。

如果 XML 是：

```
<Person><Name>Jim</Name></Person> 
```

未调用 Web 服务方法（事件日志中没有条目）。

以下是 Web 服务方法定义：

```
public string SubmitiPhoneObject(string theObjectAsXml) {
    WriteToEventLog("Begin Service.SubmitiPhoneObject");
    // Do some work…
} 
```

这是我从 iPhone 提交的 SOAP 请求：

```
<?xml version="1.0" encoding="utf-8"?>
<soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/">
<soap:Body>
    <SubmitiPhoneObject xmlns="http://www.myServer.com/iPhoneService/">
        <theObjectAsXml>
            <TheObject>
                <PersonID>5263</PersonID>
                <DepartmentID>379</DepartmentID>
            </TheObject>
        </theObjectAsXml>
    </SubmitiPhoneObject>
</soap:Body> 
```

任何人都知道为什么没有调用 Web 服务方法？关于如何从 iPhone 应用程序向 Web 服务提交对象有更好/更简单的建议吗？

谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-09T15:09:23.663

感谢您的回答，我最终在传递 XML 字符串并在服务器上对其进行解码之前对其进行了编码。

在我使用的 iPhone 上：

```
[xml stringByAddingPercentEscapesUsingEncoding:NSASCIIStringEncoding] 
```

进行编码。

在我使用的服务器上

```
Server.UrlDecode 
```

进行解码。到目前为止似乎正在工作。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-07T14:57:49.150

与 iPhone 和其他移动设备的理想情况相比，完整的 SOAP 处理通常被认为会占用更多资源，因此直接生成所需 XML 的方法可能是一种不错的方法。

为了调试这一点，我建议您在提交此请求时获取从服务器收到的响应 XML。该响应应该为您提供有关在服务器上完成的操作以及遇到的任何错误的更多信息。希望这可以帮助！

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-07T15:02:25.037

您应该使用[soapUI](http://soapUI.org/)来构建消息以发送到您的服务。然后，您将知道发送消息的格式。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-07T16:57:35.433

如果您必须使用 SOAP（而且我会非常努力地使用更简单的东西），那么请考虑使用 WSDL2ObjC 来生成通信代码，而不是手动滚动它：

[http://code.google.com/p/wsdl2objc/](http://code.google.com/p/wsdl2objc/)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-07T15:00:49.037

这是一个太笼统的问题。

你说你不能从 iPhone 提交到 .NET。但是你可以从其他地方提交吗？

*   如果你不能，那么 iPhone 就不在等式了，这是一个 .NET 问题。

*   如果可以，请检查成功请求与 iPhone 发出的请求之间的区别。如果 iPhone 产生的东西

    *   不是有效的 SOAP 请求：

        .NET 不在等式中，这是您的 XML 序列化的问题。

    *   是一个有效的 SOAP 请求，但没有被 Web 服务识别：

        在这种情况下，您有两种选择：

        *   将 iPhone XML 序列化调整为与成功的相同
        *   向 .NET 人员报告问题。

        我建议两者都做。

如果您的请求很简单，那么将其作为字符串存储在 iPhone 上可能是一个可行的选择。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-08T04:24:25.203

此处给出的[Objective-c 包装器](http://kosmaczewski.net/projects/objective-c-rest-client/)在尝试将数据发送到 Web 服务时效果很好。如果要将 XML 提交到 Web 服务，请将 XML 的内容读入 NSData 对象并将该 NSData 作为 HTTP 请求的正文传递。这按预期工作。

# java - 优化Java中字符串集合的内存使用

> ID：725640
> 
> 赞同：9
> 
> 时间：2009-04-07T13:16:44.247
> 
> 标签：java, string, memory-management

我有大量的名称-值对（大约 100k），我需要将它们存储在某种缓存（比如哈希映射）中，其中值是一个平均大小约为 30k 字节的字符串。

现在我知道一个事实，大量的值具有完全相同的字符串数据。为了避免必须多次分配相同的字符串数据，我想以某种方式重用以前分配的字符串，从而消耗更少的内存。此外，这需要相当快。即逐一扫描所有先前分配的值不是一种选择。

关于如何解决这个问题的任何建议？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-04-07T13:51:31.137

不要*使用*String.intern（多年来一直存在与此相关的各种内存问题）。相反，创建自己的缓存，类似于 String.intern。基本上，您需要一个 Map，其中每个键都映射到自身。然后，在缓存任何字符串之前，你“实习”它：

```
private Map<String,WeakReference<String>> myInternMap = new WeakHashMap<String,,WeakReference<String>>();
public String intern(String value) {
  synchronized(myInternMap) {
    WeakReference<String> curRef = myInternMap.get(value);
    String curValue = ((curRef != null) ? curRef.get() : null);
    if(curValue != null) {
      return curValue;
    }

    myInternMap.put(value, new WeakReference<String>(value));
    return value;
  }
} 
```

请注意，您对键和值使用弱引用，这样您就不会为不再使用的字符串保留引用。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-04-07T13:18:01.480

[String.intern()](http://java.sun.com/javase/6/docs/api/java/lang/String.html#intern%28%29)会在这里帮助你（很可能）。它将*同一*字符串的多个实例解析为一个副本。

编辑：我建议这“最有可能”会有所帮助。在什么情况下不会？*实习字符串将具有永久*存储这些实习字符串表示的效果。如果问题域是一次性过程，这可能不是问题。如果它是一个长时间运行的进程（例如 Web 应用程序），那么您很可能会遇到问题。

我会犹豫说*永远不要*使用实习（我会犹豫说*永远*不要做任何事情）。但是，在某些情况下它并不理想。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-04-07T13:49:07.973

`String.intern`正如布赖恩所说，这是显而易见的选择。但是，如果您不想在内存中的所有字符串中进行实习，您可以使用 Set 首先查看该值是否存在。这是未经测试的代码。从主地图中移除时，您必须解决从反向地图中移除的问题

```
 class Map2<K, V> implements Map<K, V>
  {
    Map<K, V> _map = Maps.newHashMap();
    Set<V, V> _rev = Maps.newHashMap();

    V put(K k, V v) {
      if (_rev.containsKey(v)) {
        V prev = _rev.get(v);
        return _map.put(k, prev);
      } else {
        _rev.put(v, v);
        return _map.put(k,v);
      }
   } 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-07T13:51:40.247

这在某种程度上取决于您如何创建`String`.

一种可能的方法是使用`TreeSet`可以`Comparator`比较现有`String`s 和 new 来源的that `String`。使用`SortedSet.tailSet`and an`Iterator`来查找现有的`String`. 或者，`NavigableSet.ceiling/floor`或者`TreeMap`具有类似设置。

`String.intern`有性能问题。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-07T13:58:11.557

同意其他人不使用 String.intern()：一旦你把一个字符串放在那里，它就永远不会消失。查看 Xerces 的早期修订版，了解为什么这是一个坏主意。

更好的解决方案是使用 Wea​​kHashMap，将值包装在 WeakReference 中：

```
private Map<String,WeakReference<String>> _map 
    = new WeakHashMap<String,WeakReference<String>>();

public synchronized String intern(String str)
{
    WeakReference<String> ref = _map.get(str);
    String s2 = (ref != null) ? ref.get() : null;
    if (s2 != null)
        return s2;
    str = new String(str);
    _map.put(str, new WeakReference(str));
    return str;
} 
```

这段代码来自[我写](http://www.kdgregory.com/index.php?page=java.refobj)的一篇关于 Java 引用对象的文章。你会在那里找到解释。

编辑：需要在这里创建一个新字符串（我会更新文章），因为原始字符串可能是一个更大的字符数组的子字符串。我认为这是在 JDK 1.3 中修复的，但显然不是（至少在 1.5 中没有）。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-07T20:24:05.780

你可以压缩字符串。一个 30K 的字符串应该得到一个很好的压缩比。我写了一个 hack 来压缩大字符串作为练习，但是你可以使用压缩数据的字节 [] 来存储字符串。

一个 30K 的字符串将使用大约 60KB（每个字符 2 个字节），因此即使使用 getBytes() 也可能是一种改进。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-07T20:27:05.973

你真的需要**Strings**，还是只需要任何旧的**CharSequence**？如果没有，那么考虑实现一个[“紧凑”的 CharSequence](http://www.javamex.com/tutorials/memory/ascii_charsequence.shtml)，比如我在链接中建议的那个。

# asp.net - 使用内联代码测试 Container.DataItem

> ID：725643
> 
> 赞同：7
> 
> 时间：2009-04-07T13:17:21.250
> 
> 标签：asp.net, asp.net-2.0, repeater

我想在 ASP.Net 2.0 中做这样的事情：

```
 <asp:Repeater id="myRepeater" runat="server">
      <ItemTemplate>
           <% if (DataBinder.Eval(Container.DataItem, "MyProperty").Equals("SomeValue")) { %>
                <%#DataBinder.Eval(Container.DataItem, "MyProperty")%>
           <% } %>
      </ItemTemplate>
 </asp:Repeater> 
```

但我不能像这样测试 DataBinder.Eval(Container.DataItem, "MyProperty") 。

注意：我无权访问源代码，我只能更改 aspx 内联。

NOTE2：我知道我可以使用这个：

```
 <%#DataBinder.Eval(Container.DataItem, "MyProperty").Equals("SomeValue")?"<!--":""%> 
```

但我正在寻找一种更清洁的方式。

有没有办法用中继器内的内联代码测试 Container.DataItem？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-07T13:37:12.480

我会这样做。您将“可见性”函数绑定到 asp:literal 控件的可见属性：

```
<asp:Repeater id="myRepeater" runat="server">
    <ItemTemplate>
        <asp:literal runat='server' id='mycontrol' 
          visible='<%# DataBinder.Eval(Container.DataItem, "MyProperty").Equals("SomeValue") %>'>
          <%# DataBinder.Eval(Container.DataItem, "MyProperty") %>
        </asp:literal>
     </ItemTemplate>
 </asp:Repeater> 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-07T13:30:26.257

您可以将其重构为服务器端脚本。

```
<script runat="server">
protected string ShowIfEqual(RepeaterItem Item, string SomeValue) {
   YourTypeThatIsDataBound _item = (YourTypeThatIsDataBound)Item.DataItem;
   return _item.MyProperty == SomeValue ? _item.MyProperty : string.Empty;
}
</script> 
```

并将其称为内联...

```
<%#ShowIfEqual(Container, "SomeValue")%> 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-07-06T20:36:33.543

“其他情况”呢？

它看起来很丑，不可读！

```
<asp:Repeater id="myRepeater" runat="server">
    <ItemTemplate>
        <%--(if true part)--%>
        <asp:literal runat='server'
          visible='<%# DataBinder.Eval(Container.DataItem,"OrderCount") > 0%>'> 
            <%# DataBinder.Eval(Container.DataItem, "OrderCount") %>
        </asp:literal>
        <%--(else part)--%>
        <asp:literal runat='server'
          visible='<%# DataBinder.Eval(Container.DataItem,"OrderCount") ==0%>'>
            <p>yet no orders</p>
        </asp:literal>
     </ItemTemplate>
 </asp:Repeater> 
```

* * *

## 回答 #4

> 赞同：-4
> 
> 时间：2009-04-07T13:21:11.660

不，没有其他方法可以做到这一点。

# javascript - 有没有办法在 IE 中打开 javascript 链接？

> ID：725645
> 
> 赞同：3
> 
> 时间：2009-04-07T13:17:45.180
> 
> 标签：javascript, html, internet-explorer

我有一个使用 javascript 提交表单的链接，如下所示：

```
<a href="javascript:document.some_form.submit()">some link</a> 
```

但是，这将指向供应商提供的应用程序，该应用程序当然只能在 IE 中运行。如果用户使用不同的浏览器，有什么方法可以让这个链接在 IE 中打开？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-04-07T13:23:17.427

如果不将编译后的代码放在用户的机器上，那么很可能不会。这将要求您向操作系统指定要运行的特定程序，这将违反当今市场上大多数浏览器的（并且应该）存在的安全限制。

您可能可以为每个主要浏览器供应商创建插件，这些插件将拦截链接并在 IE 中打开它，但这变得乏味，因为每个浏览器都有不同的模型。最重要的是，您必须在每台机器上安装您的插件，而用户可能对此并不感兴趣。

这里最好的选择是通知用户该站点必须在 IE 中浏览，如果可能，与供应商合作使其在其他浏览器中运行。

另一种可能性是您可能将您的应用程序和供应商应用程序都托管在使用嵌入式 WebBrowser 控件的客户端程序中，该程序本质上是 IE。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-07T13:24:01.653

不，没有。这将是一个严重的安全风险——利用 Internet Explorer 漏洞的站点将能够以这种方式感染 Mozilla Firefox 上的用户。

只需警告它是一个需要 IE 的外部站点（如果它们已经在 IE 中，可能使用用户代理嗅探来避免显示它）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-07T13:24:30.920

我不这么认为，因为您必须在客户端计算机上启动/激活程序。如果用户不在 IE 中，您可以重定向提交并警告用户，并在这种情况下返回 false。链接的更好语法可能是：

```
<a href="#dummy" onclick="document.some_form.submit()">some link</a> 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-07T14:37:12.353

如果点击链接的人没有使用 Internet Explorer，您可以做的（我已经做的）是让链接不起作用并打开一个新窗口，显示一个 DIV 或弹出一个`alert()`通知他们必须使用 Internet Explorer目标站点工作。

就像是：

```
<a href="/enablejavascript.html"
    onclick="
        if (window.external && 'undefined' !== typeof window.external.AddFavorite) {
            document.forms['some_form'].submit();
        } else {
            alert('You must be using Internet Explorer to use this website.');
        }
        return false;
    ">some link</a> 
```

[window.external.AddFavorite](http://msdn.microsoft.com/en-us/library/ms535926(VS.85).aspx)（据我所知）仅在 Internet Explorer 中可用，因此使用它来检测 IE 应该是相当安全的。您也可以检查[navigator.userAgent](http://docs.sun.com/source/816-6408-10/nav.htm#1193476)，`MSIE`但是某些浏览器（例如 Opera）可能会欺骗 IE 用户代理。

# c# - 如何对列表进行排序 > 根据列表 [0] C# 中的数字 ASC/DESC？

> ID：725652
> 
> 赞同：0
> 
> 时间：2009-04-07T13:18:56.813
> 
> 标签：c#, list, sorting, uint32

如何按 ASC 顺序排序？

我得到了`List<List<UInt32>>`完整的记录，`List<UInt32>`我希望这些记录根据每条记录的第一列进行排序 - 该列是 UInt32 编号。

所以：

我有以下清单：

```
new List<UInt32>: 32,1,1,1,1,1
new List<UInt32>: 22,2,2,2,2,2
new List<UInt32>: 32,1,1,1,1,1
new List<UInt32>: 1,1,1,1,1 
```

应排序为：

```
List<UInt32>: 1,1,1,1,1
List<UInt32>: 22,2,2,2,2,2
new List<UInt32>: 32,1,1,1,1,1
new List<UInt32>: 32,1,1,1,1,1 
```

-> 只有第一个数字很重要！其他对于排序并不重要。我正在寻找 ASC 的东西，但两者都很棒，所以当我认为应该更改算法时，我会查一下 :)

感谢您的努力帮助！

@Samuel，谢谢，我会在尝试更改类型时尝试实现它:)

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-07T13:21:27.387

几乎重复：

[如何根据 List<string> 字段数对 List<List<string>> 进行排序？](https://stackoverflow.com/questions/721577/how-to-sort-listliststring-according-to-liststring-number-of-fields)

就像是：

```
var sorted = parent.OrderBy( l => l[0] ); 
```

或者：

```
parent.Sort( (a,b) => a[0].CompareTo( b[0] ) ) 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-07T13:33:52.113

虽然约翰的回答有效，但我建议使用`First()`而不是访问列表中的 0 元素。这样，它不仅适用于`IEnumerable<T>`任何`IList<T>`.

```
var sorted = list.OrderBy(subList => subList.First()); 
```

# mysql - 数据库世界中的提供者和连接器有什么区别？

> ID：725655
> 
> 赞同：0
> 
> 时间：2009-04-07T13:19:21.620
> 
> 标签：mysql, ado.net, provider, mysql-connector

我创建了一个新的文本文件，将其重命名为 test.udl 并双击该文件。这将打开 OLE DB 连接字符串对话框。第一个选项卡显示了安装在我的机器上的提供程序列表。我需要一个 MySQL 连接字符串，但列表中没有 MySql 提供程序。所以我从互联网上下载了 MySql ADO.NET 连接器并安装它，但它仍然没有显示为提供程序。

什么是提供者，什么是连接器？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-07T13:32:12.150

连接器将允许您以“.Net”方式进行连接，而提供程序将允许您通过 OLEDB 接口进行连接。

MySql 连接器将允许您访问 MySqlConnection、MySqlCommand 等类以及所有 ADO.Net 范例对象，而使用 OLEDB 您将通过 OleDbConnection、OleDbCommand 等进行连接

# asp.net - body runat="server" 导致编译错误

> ID：725658
> 
> 赞同：6
> 
> 时间：2009-04-07T13:20:18.263
> 
> 标签：asp.net

在母版页中，我有以下标记

```
<body id="body" runat="server"> 
```

我已经设置`runat="server"`了，因为我需要能够在代码隐藏中访问 body 元素。

我现在想为`body onload`事件添加一个 JavaScript 函数调用，如下所示：

```
<body id="body" runat="server" onload="someJavaScriptFunction();"> 
```

但是，这给了我一个编译错误，并显示“无法解析符号 someJavaScriptFunction();”的消息。如果我运行应用程序，我会收到一条错误消息告诉我

```
编译器错误消息：CS1026:) 预期
```

这里发生了什么？`onload`是一个客户端事件，那么为什么 ASP.NET 编译器会关心这个呢？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-04-07T13:22:47.023

您需要在后面的代码中添加它；

```
protected void Page_Load(object sender, EventArgs e)
{
     body.Attributes.Add("onload", "someJavaScriptFunction();");
} 
```

添加`runat="server"`到标签使其成为服务器标签，即使它不是显式前缀之一（例如`<asp:Panel />`）。在服务器标签上，任何`onXXXX`事件处理程序都处理服务器端事件，而不是客户端事件（除非显式调用“客户端”，例如使用 OnClientClick 按钮）。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-07T13:24:20.903

它也是一个设置选项：

```
<head>
  <script language="text/javascript">
    window.onload = function() { someJavaScriptFunction(); }
  </script>
</head> 
```

发生这种情况是因为 ASP 试图将 body 标记内的脚本解释为页面中代码的一部分。好像它是 C# / VB...

# c# - C# 如何从 VS2008 代码指标中排除生成的代码？

> ID：725660
> 
> 赞同：3
> 
> 时间：2009-04-07T13:21:02.253
> 
> 标签：c#, visual-studio-2008, code-generation, code-metrics

如何从 Visual Studio 2008 代码指标中排除生成的代码，如 Windows 窗体设计器相关代码？

我一直在挖掘，但我没有找到任何解决方案。`DebuggerHidden`并且`DebuggerNonUserCode`没有效果。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-07T13:28:17.243

尝试[GeneratedCodeAttribute](http://msdn.microsoft.com/en-us/library/system.codedom.compiler.generatedcodeattribute.aspx)。

# php - mysqli 为什么会这样？

> ID：725679
> 
> 赞同：0
> 
> 时间：2009-04-07T13:25:34.350
> 
> 标签：php, mysqli

我有两个后续的 mysqli 语句，第二个返回：

> 致命错误：在...中的非对象上调用成员函数 bind_param()

为什么会发生这种情况？这是否意味着我需要打开两个不同的连接？有什么方法可以避免这种情况（我喜欢将 SQL 连接详细信息保存在一个文件中）？

这里的代码：

```
$db = new mysqli("localhost", "root", "", "database");

$stmt = $db->prepare("UPDATE posts SET vote_".$_POST['vote']." = vote_".$_POST['vote']." + 1 WHERE id=?");
$stmt->bind_param('s', $_POST['id_post']);
$stmt->execute();
$stmt->close();

$stmt = $db->prepare("INSERT INTO votes (kind, users_id, posts_id) VALUES (?, ?, ?)");
$stmt->bind_param('sss',$_POST['vote'],$_POST['id_user'],$_POST['id_post']);
$stmt->execute();
$stmt->close(); 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-07T13:28:57.913

我认为您的 $stmt 变量在您调用 bind_param 时为空。也许你的 $_POST['vote'] 是空的？您可以在绑定命令上的参数之前检查它

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-07T13:33:23.160

[检查mysqli::prepare](http://php.net/manual/de/mysqli.prepare.php)的返回值。如果为 FALSE，您应该使用[mysqli::error](http://php.net/manual/de/mysqli.error.php)获取发生错误的详细信息。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-07T13:30:54.913

可能出了点问题`$db->prepare()`，检查一下`$db->error`。

# sql - 如何使用通过自身连接检索到的数据更新表？

> ID：725684
> 
> 赞同：8
> 
> 时间：2009-04-07T13:26:54.940
> 
> 标签：sql, sql-server, sql-server-2008

我有以下数据：

```
SectorKey Sector foo  
1         A      null 
2         B      null
...       ...    ...
1         null   a  
2         null   b 
2         null   c 
1         null   d 
2         null   e 
...       ...    ... 
```

我想根据扇区键的值在扇区为空时更新扇区，即当扇区键为 1 时，我希望扇区为“A”，当扇区键为 2 时，我希望扇区为“B”

我试过这个查询：

```
update tbFoo
set Sector=A.sector 
from tbFoo A INNER JOIN tbFoo B
ON A.SectorKey=B.SectorKey 
and A.Sector is not null 
and B.Sector is null 
```

并收到此错误消息：

> 表 'tbFoo' 不明确。

我试图给第一个 tbFoo 起别名，但它似乎不是一个有效的语法。我不明白为什么 SQLServer 抱怨命名模棱两可，因为我的所有表都有别名。

我找到[了这个线程](https://stackoverflow.com/questions/440702/how-can-i-update-a-field-in-one-table-with-a-field-from-another-table-sql)，我觉得我做的事情与赞成的答案完全相同。我还尝试了接受的答案中建议的查询：

```
 update tbFoo A
    set Sector = 
       (select Sector from tbFoo 
        where A.SectorKey=SectorKey and Sector is not null) 
```

然后 SQLServer 抱怨“A”附近的语法不正确

关于可能发生的事情以及解决此问题的任何想法？我正在使用 SQLServer 2008。

**编辑**我没有显示我的表格的总数据。我不是只有两个案例（A 和 B），而是几千个案例。因此，明确的案例不是一种选择

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-04-07T13:34:45.793

在更新查询的第一部分使用别名：

```
update B
set Sector=A.sector 
from tbFoo A INNER JOIN tbFoo B
ON A.SectorKey=B.SectorKey 
and A.Sector is not null 
and B.Sector is null 
```

否则它不知道要更新表的哪个实例。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2014-04-07T18:56:43.797

尝试使用 CTE 并更改别名的字段名称：

```
WITH CTE_TBFOO(SETOR)
AS
(  
    SELECT Sector
    FROM tbFoo T1  
)
update tbFoo
set Sector= A.SETOR
from CTE_TBFOO A 
WHERE A.SETOR = SectorKey 
and   A.SETOR  is not null 
and   B.Sector is null 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-07T13:33:48.823

```
update
    tbFoo
set
    Sector = (select tf.Sector from tbFoo tf where
                tbFoo.SectorKey = tf.SectorKey and
                tf.Sector is not null) 
```

应该管用

# database - 如何为单个主键插入多行？

> ID：725695
> 
> 赞同：2
> 
> 时间：2009-04-07T13:29:23.450
> 
> 标签：database

我有一个名为“Patient_detail”的表。此表中有 4 列。他们是：

1.  `patient_id`主键（非空）
2.  `visit_serial_ID`主键（非空）
3.  `examination`
4.  `plan`

现在，如何针对“Patient_detail”表的单个主键“patient_id”和“visit_serial_ID”在“examination”和“plan”列中插入多条记录？

字段的数据类型如下：

*   `patient_id`: 号码(11)
*   `visit_serial_ID`: 号码(5)
*   `examination`: varchar2(50)
*   `plan`: varchar2(50)

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-04-07T13:32:54.957

你不能（这是主键的全部意义 - 每个值都有一行）。您需要将其拆分为几张表，一张用于就诊，一张用于患者。访问表与患者表的主键列有外键关系。

**编辑**

您需要考虑您所代表的实际现实生活中的事物，以及它们如何相互关联。对于每个单独的现实生活中的事物，您通常会有一个单独的表。这允许您追求一对一、多对一、多对多的关系。例如，您代表一位来访的患者，期间有许多检查，每个检查都有相应的计划（这是正确的吗？）。因此，您应该有一个包含患者数据的患者表、一个包含就诊数据的就诊表和一个包含检查数据的检查表，甚至可能还有一个包含计划数据的计划表。

就诊表与患者表是多对一的关系（一个患者可以就诊多次）。为了实现这一点，它应该有一个指向 patient_id 列的外键。类似地，检查表与访问表具有多对一的关系，因此，它应该具有访问表主键的外键。

还有其他方法可以分离。正如萨沙所说，查找规范化。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-07T13:33:55.733

您可以这样做，但您的主键将不再是主键，并且您的数据将被非规范化。最好的方法是将此表拆分为两个单独的表，如下所示：

```
Patients
----------
PatientId

Visits
----------
VisitSerialId
Examination
Pland
PatientId 
```

请注意，该`Visits`表具有该表的外键关系`Patients`。这将使您拥有`1:M`您正在寻找的关系。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-07T13:33:41.617

你不能。这就是主键——每一行都是独一无二的。您需要一个单独的表，它有自己的主键，并且与该表有外键关系，以便存储多个条目。这将是一个简单的一对多关系。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-07T13:34:21.893

正如darasd所说，你不能。您正在寻找的是调用规范化。

# asp.net - ASP.net MaskedEdit：输入数字 425.25 产生 4250000000.25。我怎样才能解决这个问题？

> ID：725704
> 
> 赞同：1
> 
> 时间：2009-04-07T13:31:41.730
> 
> 标签：asp.net

我在 ORACLE 数据库中有一个 NUMBER 字段，设置为 13,2。我想使用 MaskedEdit 字段来屏蔽它。

如果我输入 425.25，它会产生一个 4250000000000.25，而不是移动 425。我实际上是按句点键输入 425，然后按 25，这将我移动到 MaskedEdit 的小数区域。这很好用，但我需要主整数向下移动而不是用零填充。

有任何想法吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-07T13:44:00.420

可能是您的软件的本地化版本误解了字符。（时期）。请尝试用 ,（逗号）代替句点。

此外，您应该检查 CultureInfo，这是防止此类错误的重要工具，您应该在 Web.Config 和接受它的每个方法上设置它，就像 MS 代码分析告诉您的那样。接受 CultureInfo 参数的常用方法是：

1.  解析（int.Parse，double.Parse，...）
2.  ToString (int.ToString, double.ToString, ...)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-10-02T18:16:28.260

检查您的 Mask 属性：

这不是正确的标记，只是 Ajax Control Toolkit 站点的一个示例。

```
<ajaxToolkit:MaskedEditExtender
    TargetControlID="TextBox2" 
    Mask="9,999,999.99"
    MessageValidatorTip="true" 
    OnFocusCssClass="MaskedEditFocus" 
    OnInvalidCssClass="MaskedEditError"
    MaskType="Number" 
    InputDirection="RightToLeft" 
    AcceptNegative="Left" 
    DisplayMoney="Left"
    ErrorTooltipEnabled="True"/> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-05-01T16:11:50.960

删除了 MaskedEdit 控件并使用 JQuery 插件来产生相同的效果，只是没有缺陷。

# .net - 如何使用 Linq-to-SQL 仅插入新记录？

> ID：725708
> 
> 赞同：5
> 
> 时间：2009-04-07T13:32:07.627
> 
> 标签：.net, linq, linq-to-sql, insert

我必须定期在我的 SQL Server 数据库中插入一些数据。但是我读取数据的提要重复了之前插入的一些数据。当我使用 Linq-to-SQL 将某些数据插入数据库时​​，可能会重复某些数据，或者会引发主键违规异常，具体取决于主键。

如何无重复无异常地插入数据？我不想通过 try-catch 来避免异常，因为一旦引发异常，其余数据就不会被插入。

**更新**我也找到了自己的解决方案：我写了一个重复条目删除存储过程，它在 InsertAllOnSubmit + SubmitChanges 之后运行

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-07T13:37:13.057

您所要做的就是创建您的类的一个新实例，然后在表上调用 InsertOnSumbit()：

```
var foo = new MyFoo { Name = "foo1" };
var dc = new MyDataContext();
dc.Foos.InsertOnSubmit(foo);
dc.SubmitChanges(); 
```

您需要确定的另一件事是如何增加 ID 列。一般来说，我总是确保在我的 ID 列上使用 IDENTITY(1,1) 设置。这是在您的 LINQ 实体的 id 列上声明的，如下所示：

```
[Column(AutoSync = AutoSync.OnInsert, IsPrimaryKey = true, IsDbGenerated = true)]
public Int32 Id { get; set; } 
```

为避免重复，您真正需要的是我们在我的商店中所说的“附加”功能。恕我直言，这最容易通过存储过程完成——我们甚至有一个模板用于它：

```
USE [<Database_Name, sysobject, Database_Name>]
GO

CREATE PROCEDURE [<Schema, sysobject, dbo>].[<Table_Name, sysobject, Table_Name>__append]
(
    @id INT OUTPUT,
    @<Key_Param, sysobject, Key_Param> <Key_Param_Type, sysobject, VARCHAR(50)>
)
AS
BEGIN

        SELECT @id = [id] FROM [<Schema, sysobject, dbo>].[<Table_Name, sysobject, Table_Name>s] (NOLOCK) WHERE [<Key_Param, sysobject, Key_Param>] = @<Key_Param, sysobject, Key_Param>

IF @id IS NULL  
BEGIN       
    INSERT INTO [<Schema, sysobject, dbo>].[<Table_Name, sysobject, Table_Name>s] ([<Key_Param, sysobject, Key_Param>]) 
    OUTPUT INSERTED.[id] INTO @inserted_ids
    VALUES (@<Key_Param, sysobject, Key_Param>)

    SELECT TOP 1 @id = [id] FROM @inserted_ids;
END
ELSE
BEGIN
    UPDATE [<Schema, sysobject, dbo>].[<Table_Name, sysobject, Table_Name>s]
    SET
        [<Key_Param, sysobject, Key_Param>] = @<Key_Param, sysobject, Key_Param>
    WHERE [id] = @id
END
END
GO 
```

不过，可以在 linq 中执行此操作，只需查询现有 ID 的列表（或您要键入的任何列）：

```
var dc = new MyDataContext();
var existingFoos = dc.Foos.ToList();
var newFoos = new List<Foo>();
foreach(var bar in whateverYoureIterating) {
// logic to add to newFoos 
}
var foosToInsert = newFoos.Where(newFoo => !existingFoos.Any(existingFoo => newFoo.Id == existingFoo.Id));

dc.Foos.InsertAllOnSubmit(foosToInsert);
dc.SubmitChanges();
// use the next line if you plan on re-using existingFoos. If that's the case I'd wrap  dc.SubmitChanges() in a try-catch as well.
existingFoos.AddRange(foosToInsert); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-07T13:42:06.087

不幸的是，没有办法绕过它，因为 Linq to SQL 在执行插入之前不会检查数据库。唯一的方法是先查询数据库*以*确定是否存在重复记录，如果不存在则添加记录。

理想情况下，Linq to SQL 将支持 SQL 列上的[Ignore Duplicate Keys](http://msdn.microsoft.com/en-us/library/csh347s8(VS.71).aspx)属性。但不幸的是，目前还没有。

# mysql - MySQL 中的默认排序顺序 (ALTER TABLE ... ORDER BY ...;)

> ID：725717
> 
> 赞同：18
> 
> 时间：2009-04-07T13:33:10.167
> 
> 标签：mysql, sorting, alter-table

假设 MySQL 表 (ISAM) 的默认排序通过执行以下命令进行更改：

```
ALTER TABLE tablename ORDER BY columnname ASC; 
```

从现在开始，假设我的查询中没有指定“ORDER BY”（即“SELECT * FROM tablename WHERE ... LIMIT 10;”），我是否**保证**按照“columnname ASC”的顺序从表中检索到记录？

是否有任何我应该注意的极端情况？

**更新 #1：**非常感谢 Quassnoi，他正确地指出了 INSERT 和 DELETE 会打乱排序。这导致我提出以下额外问题：

*   更新呢？假设没有对表进行 INSERT 或 DELETE，而只是更新 - 排序顺序会保持不变吗？
*   假设进行了 INSERT 和 DELETE - 我如何再次“重建”排序，比如每天一次（在这种特定情况下，表仅每天更改，因此在更改完成后每天重建它应该仍然可以！）。REPAIR TABLE 是否修复它，或者必须再次添加 ALTER TABLE ... ORDER BY ？

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2009-04-07T13:37:13.277

从[**文档**](http://dev.mysql.com/doc/refman/5.1/en/alter-table.html)：

> 注意插入和删除后表不保持这个顺序

实际上，如果你`SELECT ... ORDER BY`向这张桌子发出，选项`ALTER TABLE`不会让你省去`filesort`，而是让`filesort`速度更快。

对已排序的集合进行排序相当于浏览该集合以确保一切正常。

> 更新呢？假设没有对表进行 INSERT 或 DELETE，而只是更新 - 排序顺序会保持不变吗？

如果您的表不包含任何动态字段（如`VARCHAR`或“BLOB”），那么更新时*很可能* `MyISAM`不会移动它。

**但是，如果我正在建造核电站或我得到报酬的东西，我不会依赖这种行为。**

> 假设进行了 INSERT 和 DELETE - 我如何再次“重建”排序，比如每天一次（在这种特定情况下，表仅每天更改，因此在更改完成后每天重建它应该仍然可以！）。REPAIR TABLE 是否修复它，或者必须再次添加 ALTER TABLE ... ORDER BY ？

你需要做`ALTER TABLE ... ORDER BY`。

`REPAIR`只是修复损坏表的物理结构。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2016-01-08T10:02:17.840

对列进行物理排序可以节省大量 IO。这是在高级系统中用于加快查询时间的完全合法的方法。您只需要不时重组数据，使其保持集群状态。仅仅因为有些人没有听说过它并不意味着它不存在。- 25 年高级 DB 设计老手。

# c# - 如何从不同的线程/类启用计时器

> ID：725735
> 
> 赞同：4
> 
> 时间：2009-04-07T13:35:24.387
> 
> 标签：c#, winforms, timer

**原始帖子：[如何从 C# 中的另一个类访问计时器](https://stackoverflow.com/questions/725413/how-to-access-a-timer-from-another-class-in-c)**

我什么都试过了。

-事件

-Invoke 无法完成，因为 Timers 没有 InvokeRequired 属性。

-公共/内部财产

没有任何效果，代码正在执行，timer.Enabled 属性被设置为“true”，但它没有勾选。如果我调用事件或只是在非静态方法中从表单类更改属性 -它确实打勾并且有效。

我从来不知道我需要一天甚至更多的时间来学习如何使用一个像样的计时器。

如果没有办法做到这一点，还有什么我可以使用的类似于计时器（延迟、启用/禁用）的方法吗？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-07T13:38:45.130

如果您需要多线程支持，您应该使用 System.Timers 命名空间中的 Timer 类，而不是 WinForms Timer 控件。查看 WinForms Timer 控件的 MSDN 文档以获取更多信息：

[http://msdn.microsoft.com/en-us/library/system.windows.forms.timer.aspx](http://msdn.microsoft.com/en-us/library/system.windows.forms.timer.aspx)

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-04-07T13:43:06.007

您不需要检查`InvokeRequired`Control 本身，您可以检查类上的属性，例如：

```
if (this.InvokeRequired) 
{ 
    BeginInvoke(new MyDelegate(delegate()
    {
        timer.Enabled = true;
    }));
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-07T13:42:18.303

我不小心再次尝试使用调用，这次成功了，但我会接受你的回答，DavidM。

```
 public bool TimerEnable
    {
        set
        {
            this.Invoke((MethodInvoker)delegate
            {
                this.timer.Enabled = value;
            });
        }
    }

    public static void timerEnable()
    {
        var form = Form.ActiveForm as Form1;
        if (form != null)
            form.TimerEnable = true;
    } 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-07T13:42:38.317

仅仅因为`System.Windows.Forms.Timer`没有调用的能力，并不意味着你的表单没有。`InvokeEx`从第二个（或其他）线程尝试我的启用计时器。

```
public static class ControlExtensions
{
  public static TResult InvokeEx<TControl, TResult>(this TControl control,
                            Func<TControl, TResult> func)
    where TControl : Control
  {
    if (control.InvokeRequired)
    {
      return (TResult)control.Invoke(func, control);
    }
    else
    {
      return func(control);
    }
  }
} 
```

有了这个，以下代码对我有用：

```
new Thread(() =>
  {
    Thread.Sleep(1000);
    this.InvokeEx(f => f.timer1.Enabled = true);
  }).Start(); 
```

计时器在 1 秒后立即启动。

# html - 如何为列表样式类型的自动生成数字着色？

> ID：725741
> 
> 赞同：27
> 
> 时间：2009-04-07T13:36:30.937
> 
> 标签：html, css, xhtml

我正在使用以下列表：

```
<ol id="footnotes">
    <a name="footnote1"><li></a>This is the first footnote...</li>
    <a name="footnote2"><li></a>This is the second footnote...</li>
</ol> 
```

使用以下 .css：

```
#footnotes {list-style-type: decimal;
            list-style-color: #f90;
            }

#footnotes li
           {color: #000;
            }

#footnotes a li,
#footnotes li a
           {color: #f90;
            } 
```

目的是让 li/footer 文本本身为黑色 ( `#000`)，数字样式为橙色 ( `#f90`)。

我试过使用该`list-style-color`属性，但这除了扰乱 Web 开发人员工具栏（在 FF3.0.8/Ubuntu 8.04 中）之外什么也没做，Midori 同样不会以橙色显示数字（我想我会在 Webkit 引擎中尝试它，以防万一...）。

有任何想法吗？

编辑了 HTML（因为我记得标​​签不一定需要包含任何东西来充当锚点）：

```
<ol id="footnotes">
    <li><a name="footnote1"></a>This is the first footnote...</li>
    <li><a name="footnote2"></a>This is the second footnote...</li>
</ol> 
```

回应那些建议`<span>`在...内部使用 a 的人`<li>`。发生了这种情况，尽管我感谢您的建议和花费的时间，但我一直在寻找（我是标准的标准主义者... ;) ）以寻求更多...语义的选择。

事实上，我想我可能会使用这种方法。尽管由于其纯粹的信息性质，我接受了皮特·米肖的不同答案。谢谢！

* * *

## 回答 #1

> 赞同：50
> 
> 时间：2011-08-31T08:47:06.700

CSS3 中有一种方法，使用[Generated and Replaced Content Module](http://www.w3.org/TR/css3-content/)。使用这种技术，您不必在 HTML 中添加任何额外的标记。这样的事情应该可以解决问题：

```
ol li {
    list-style-type: none;
    counter-increment: list;
    position: relative;
}

ol li:after {
    content: counter(list) ".";
    position: absolute;
    left: -2.5em;
    width: 2em;
    text-align: right;
    color: red;
} 
```

* * *

## 回答 #2

> 赞同：32
> 
> 时间：2009-04-07T13:42:43.153

这应该有效：

```
<ol id="footnotes">
    <li><span>This is the first footnote...</span></li>
    <li><span>This is the second footnote...</span></li>
</ol>

#footnotes li { color: #f90; }
#footnotes li span { color: #000; } 
```

* * *

## 回答 #3

> 赞同：27
> 
> 时间：2009-04-07T13:43:03.620

好吧，更重要的是数字是在技术上生成的`<li>`，所以你对数字所做的任何事情`<li>`都会影响数字。从规范：

> “CSS 中的大多数块级元素都会生成一个主体块框。在本节中，我们将讨论导致元素生成两个框的两种 CSS 机制：一个主体块框（用于元素的内容）和一个单独的标记框（用于装饰）例如项目符号、图像或数字）。”

请注意，标记框和主框都属于同一个元素——在本例中为列表项。因此，我们应该期望所有`<li>`样式都适用于标记和内容。如果您认为它好像列表项本身正在生成编号内容（这实际上是在 CSS 术语中所做的），这也不足为奇。当规范继续时，稍后会确认这一点：

> “列表属性允许对列表进行基本的视觉格式化。与更通用的标记一样，带有“显示：列表项”的元素会为元素的内容生成一个主体框和一个可选的标记框。其他列表属性允许作者指定标记类型（图像、字形或数字）及其相对于主框的位置（在内容之前或在其外部或内部）。它们不允许作者指定不同的样式（颜色、字体、对齐方式等）列出标记或调整其相对于主框的位置。”

所以因为标记属于列表，所以它受`<li>`样式影响，不能直接调整。为标记实现不同样式的唯一方法是`<span>`在列表项内插入 a，并使用您希望与标记不同的属性来设置跨度的样式。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2013-04-03T13:47:43.303

这个简单的 CSS3 解决方案适用于大多数浏览器（IE8 及更高版本）：

```
ul {
    padding-left: 14px;
    list-style: none;
}
ul li:before {
    color: #f90;
    content: "•";
    position: relative; 
    left: -7px;
    font-size: 18px;
    margin-left: -7px;
} 
```

您可能需要根据您的情况调整`padding`和值。`margin`

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2012-03-29T16:48:59.483

我最近遇到了类似的问题，发现了一篇文章，为[有序列表编号设置样式，该文章描述了一种](http://www.456bereastreet.com/archive/201105/styling_ordered_list_numbers/)**无需使用额外标签即可**实现列表标记样式的智能方法。这篇文章基本上说对于有序列表：

> 关键是在从列表中删除默认编号后，使用 CSS 生成的内容来创建和插入计数器编号。

有关更多详细信息，请参阅文章。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2020-07-16T04:54:28.947

这些天你可以使用`::marker`;

例子：

```
li::marker {
  color: #f90;
} 
```

更多内容，包括浏览器兼容性表：[https ://developer.mozilla.org/en-US/docs/Web/CSS/::marker#Browser_compatibility](https://developer.mozilla.org/en-US/docs/Web/CSS/::marker#Browser_compatibility)

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-04-07T13:46:14.503

这个怎么样？

```
<head>
  <style>
    #footnotes li { color: #f90; }
    #footnotes li a { color: #000; }
  </style>
</head>
<body>
  <ol id="footnotes">
    <li><a name="footnote1">This is the first footnote...</a></li>
    <li><a name="footnote2">This is the second footnote...</a></li>
  </ol>
</body> 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2013-03-06T17:10:21.983

结合我发现不完整的其他一些答案，我发现这是最完整的。它考虑层次结构中不同级别的**子样式类型**，并认为 li 可能不止一行（*:after*位于底线，因此我们使用*:before*）。

还要注意侧字符的自定义：`1\. 1)`.Tested in Chrome。

```
ol { counter-reset:li; }
ol li {
    list-style-type:none;
    counter-increment:li;
    position:relative;
}
ol li:before {
    content:counter(li) ")";
    position:absolute;
    left: -2.6em;
    width: 2em;
    text-align: right;
    color: #f00;
}
ol ol li:before { content:counter(li,lower-alpha) ")"; }
ol ol ol li:before { content:counter(li,lower-roman) "."; } 
```

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2011-05-17T14:48:40.817

您还可以使用“外部”列表样式属性。 [看这里](http://www.echoecho.com/csslists.htm)

# asp.net - ASP.NET 中继器分页/排序

> ID：725743
> 
> 赞同：2
> 
> 时间：2009-04-07T13:37:11.793
> 
> 标签：asp.net, sorting, repeater, paging

那么关于如何做到这一点的*真实故事是什么。*我发现的所有示例都使用默认分页（有人觉得可以接受吗？？？），但我想使用自定义分页。我不能使用 GridView，因为我需要更多的灵活性。我看到的示例都使用 PagedDataSource 类，但我找不到使用自定义分页的示例。我是否注定要推出自己的分页/排序解决方案以避免其他内置方法的臃肿软件？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-07T13:39:36.233

我认为大多数需要这么多自定义工作的人都会使用第三方控制工具包，例如 Telerik、DevExpress、Infragistics 或 ComponentOne。

如果您想做一次，您可能会想再做一次，因此值得拥有一个高质量、可重复使用、通用且经过测试的解决方案。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-07T13:47:01.193

一个用于分页的简单转发器，其中一些页码水平呈现，非常容易编码和重用。

# git - 你将如何使用 git 将单个文件恢复到以前的提交状态？

> ID：725749
> 
> 赞同：91
> 
> 时间：2009-04-07T13:38:55.970
> 
> 标签：git

我想知道为什么它不在 GUI 中实现？我知道 git 有一种内容方法与单文件方法，但有时单文件恢复是至关重要的。

例如，需要之前几次提交的 .png 图形文件。

可能我需要结帐，但我仍然不确定，因为这些概念有时会让我忘记。

# asp.net - DTD的重要性是什么以及它如何影响网页页面的显示

> ID：725753
> 
> 赞同：1
> 
> 时间：2009-04-07T13:39:47.997
> 
> 标签：asp.net, html, xml, xhtml, dtd

DTD的重要性是什么以及它如何影响网页在运行时的显示

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-07T13:51:46.423

如前所述，这会告诉浏览器您所针对的文档的确切类型（例如 HTML 版本）。特别是某些浏览器具有“怪癖模式”和“严格模式”，它们在运行时都会以不同的方式呈现（显示）您的 HTML。

[A List Apart 上有一篇](http://www.alistapart.com/articles/doctype/)有用的DOCTYPE 文章可帮助您选择正确的 DTD。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-07T13:42:14.560

DTD 定义了文档的类型，尤其是您打算定位的 HTML 规范的特定版本。

# python - 在 HTML 文件中查找所有 *rendered* 图像

> ID：725756
> 
> 赞同：0
> 
> 时间：2009-04-07T13:40:41.897
> 
> 标签：python, html, regex, parsing

我需要一种在 HTML 片段中仅查找**呈现的IMG 标记的方法。**因此，我不能只对 HTML 片段进行正则表达式来查找所有 IMG 标签，因为我还会获得在 HTML 中显示为文本（未呈现）的 IMG 标签。

我在 AppEngine 上使用 Python。

有任何想法吗？

谢谢，伊万

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-07T14:11:57.763

渲染的 img 标签的源代码是这样的：

```
<img src="img.jpg"></img> 
```

如果 img 标签显示为文本（未渲染），则 html 代码将如下所示：

```
 &lt;img src=&quot;styles/BWLogo.jpg&quot;&gt;&lt;/img&gt; 
```

`&lt;`是“<”字符，`&gt;`是“>”字符

要仅匹配渲染的 img 标签，您可以使用正则表达式匹配由 < 和 > 形成的 img 标签，而不是`&lt;`和`&gt;`

评论中的img标签也需要忽略“ `<!--`”和“ `-->`”之间的字符

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-07T18:31:30.697

使用[BeautifulSoup](http://www.crummy.com/software/BeautifulSoup)。它是一个用于 Python 的 HTML/XML 解析器，提供简单、惯用的方式来导航、搜索和修改解析树。它可能不会被假的 img 标签弄错。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-07T18:51:01.713

听起来像是[BeautifulSoup](http://www.crummy.com/software/BeautifulSoup/)的工作：

```
>>> from BeautifulSoup import BeautifulSoup
>>> doc = """
... <html>
... <body>
... <img src="test.jpg">
... &lt;img src="yay.jpg"&gt;
... <!-- <img src="ohnoes.jpg"> -->
... <img src="hurrah.jpg">
... </body>
... </html>
... """
>>> soup = BeautifulSoup(doc)
>>> soup.findAll('img')
[<img src="test.jpg" />, <img src="hurrah.jpg" />] 
```

如您所见，BeautifulSoup 足够聪明，可以忽略评论和显示的 HTML。

**编辑**：不过，我不确定您所说的 RSS 提要转义所有图像是什么意思。我不希望 BeautifulSoup 弄清楚如果它们都被转义了，哪些是要显示的。你能澄清一下吗？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-07T18:28:30.237

由于图像标签可能位于某些 <pre> 或 <xmp> 标签之间，您可能必须遍历 dom（= 将 html 转换为 xml/dom 树并搜索它）并找到所有 <img> 节点。python标准库中有一个xml.dom类：[docs.python.org](http://docs.python.org/library/xml.dom.html)

您也可以在客户端上执行此操作并通过 ajax 将其报告回来（尽管这意味着服务器上的负载更多）。

# c++ - MSVC++ 编译器错误 C2143

> ID：725764
> 
> 赞同：1
> 
> 时间：2009-04-07T13:42:28.693
> 
> 标签：c++, visual-c++, compiler-errors

以下代码摘录负责神秘的 MSVC++ 编译器错误：

```
template<class T> class Vec : public vector<T>{
  public:
    Vec() : vector<T>(){}
    Vec(int s) : vector<T>(s){}

    T& operator[](int i){return at(i);  }
    const T& operator[](int i)const{ return at(i);}
};

... 
```

错误：

```
test.cpp(5) : error C2143: syntax error : missing ',' before '<'
  test.cpp(12) : see reference to class template instantiation 'Vec<T>' being compiled 
```

我该如何解决？

- -编辑 - -

一些上下文：

我正在尝试编译代码，基本上是从*The C++ Programming Language*复制和粘贴的。我什至还没有完全理解这段代码。然而，其目的是实现一个向量类型，当某些代码尝试访问向量范围之外的项目时，该向量类型将引发异常，而不是仅仅返回不正确的值。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-07T13:48:43.123

尝试

```
template<class T> class Vec : public vector<T>{
  public:
    Vec() : vector(){} // no <T>
    Vec(int s) : vector(s){} // same

    T& operator[](int i){return at(i);  }
    const T& operator[](int i)const{ return at(i);}
}; 
```

模板类的构造函数在其名称中不包含模板签名。

作为旁注，您的第二个构造函数应该是

```
Vec(typename vector<T>::size_type s) : vector(s){} // not necessarily int 
```

最后，你真的不应该从向量派生，因为它有一个非虚拟的析构函数。不要试图通过指向向量的指针来删除 Vec。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-07T13:47:24.703

你为什么要尝试从向量继承？这会给你带来很多问题。其中最少的是该向量没有虚拟析构函数。这将导致在删除对您的类的多态引用时调用错误的析构函数，这将导致内存泄漏或一般的不良行为。

例如，以下代码不会调用 ~Vec()，而是调用 ~vector()。

```
vector<int> *pVec = new Vec<int>();
delete pVec;  // Calls ~vector<T>(); 
```

您看到的实际编译错误是因为您使用模板语法进行基本构造函数调用。只需删除它，它应该编译

```
Vec() : vector() {} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-11-22T05:53:29.690

来自[MSDN：编译器错误 C2143 (C++)](http://msdn.microsoft.com/en-us/library/0afb82ta%28VS.80%29.aspx)

```
对标准 C++ 库中的类型进行了非限定调用：
```

```
// C2143g.cpp
// compile with: /EHsc /c
#include <vector>
static vector<char> bad;   // C2143
static std::vector<char> good;   // OK 
```

这只是咬我。您只需修复对 的引用`vector<T>`，将它们替换为`std::vector<T>`.

# php - 使用 PHP 连接 MySQL 数据库

> ID：725767
> 
> 赞同：0
> 
> 时间：2009-04-07T13:42:44.027
> 
> 标签：php, mysql, connection

我有这个小功能可以连接到 MySQL 数据库：

```
function connectSugarCRM()
{
    $connectorSugarCRM = mysql_connect ("localhost", "123", "123")
    or die ("Connection failed");
    mysql_select_db("sugar5") or die ("Failed attempt to connect to database");
    return $connectorSugarCRM;
} 
```

然后，为了运行一个查询，我正在做这样的事情，但我总是得到一个“PHP致命错误：无法重新声明connectSugarCRM（）（以前在......中声明”，它指向我的函数“connectSugarCRM”的定义"（第 1 行）。

```
$ExecuteSQL = mysql_query ($sqlSTR, connectSugarCRM()) or die ("Query Failed!"); 
```

我的代码有什么问题？谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-07T13:59:08.387

包含其他文件时，请始终使用 include_once 或 require_once。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-07T13:55:18.210

首先，在所有代码中搜索“function connectSugarCRM()”并确保它只出现一次。如果不止一次，那是你的问题。

否则，请尝试将您的查询行更改为：

```
$sugarConnection = connectSugarCRM();
$ExecuteSQL = mysql_query($sqlSTR, $sugarConnection) or die ("Query Failed!"); 
```

将来，行号和完整的错误消息对于调试这些东西真的很有帮助。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-07T13:55:23.827

检查您的代码是否包含递归。

包含的模块`connectSugarCRM()`似乎包含两次：

```
<?php
function connectSugarCRM()
{
    $connectorSugarCRM = mysql_connect ("myserver", "myname", "mypass") or die ("Connection failed\n");
    mysql_select_db("test") or die ("Failed attempt to connect to database\n");
    return $connectorSugarCRM;
}

function connectSugarCRM()
{
    $connectorSugarCRM = mysql_connect ("myserver", "myname", "mypass") or die ("Connection failed\n");
    mysql_select_db("test") or die ("Failed attempt to connect to database\n");
    return $connectorSugarCRM;
}

$ExecuteSQL = mysql_query ("SELECT 1", connectSugarCRM()) or die ("Query Failed!\n");
?>

[~]# php test.php

PHP Fatal error:  Cannot redeclare connectsugarcrm() (previously declared in /root/test/sugar/test.php:4) in /root/test/sugar/test.php on line 14 
```

# django - 如何在 Django 模板中获得“switch-case”语句功能？

> ID：725771
> 
> 赞同：27
> 
> 时间：2009-04-07T13:43:03.340
> 
> 标签：django, django-templates, switch-statement, case

我在 Django 模板中找到了一个带有“switch”标签的[链接](http://www.djangosnippets.org/snippets/878/)，但我想知道如果没有它是否可以以某种方式实现。只使用 Django 自带的东西？基本上还有其他方法可以使用多个“if”或“ifequal”语句吗？

提前感谢任何提示/建议。

* * *

## 回答 #1

> 赞同：56
> 
> 时间：2012-05-01T07:24:19.680

从 Django 1.4 开始，有`{% elif %}`：

```
{% if a %}
  thing
{% elif b %}
  other thing
{% elif c %}
  another thing
{% endif %} 
```

* * *

## 回答 #2

> 赞同：22
> 
> 时间：2009-10-14T07:11:36.337

致之前的回复者：在不了解用例的情况下，您做出了假设并批评了提问者。@Ber 说“到处都是”，提问者当然没有暗示。不公平。

我有一个案例，我想`{% switch %}`在我的 Django 模板中的一个地方做一个声明。将 switch 语句的等价物移动到 Python 代码中不仅不方便，而且实际上会使视图和模板都更难阅读，并采用属于一个地方的简单条件逻辑并将其分成两个地方。

在许多情况下，我可以想象一个`{% switch %}`（或一个 { `% if %}`）很有用，不使用一个需要将 HTML 放在视图中。这是一个更严重的罪，这就是为什么`{% if %}`首先存在的原因。`{% switch %}`没有什么不同。

幸运的是，Django 是可扩展的，并且已经多人实现了 switch。查看：

[切换模板标签](http://www.djangosnippets.org/snippets/967/)

```
from django import template
from django.template import Library, Node, VariableDoesNotExist

register = Library()

@register.tag(name="switch")
def do_switch(parser, token):
    """
    The ``{% switch %}`` tag compares a variable against one or more values in
    ``{% case %}`` tags, and outputs the contents of the matching block.  An
    optional ``{% else %}`` tag sets off the default output if no matches
    could be found::

        {% switch result_count %}
            {% case 0 %}
                There are no search results.
            {% case 1 %}
                There is one search result.
            {% else %}
                Jackpot! Your search found {{ result_count }} results.
        {% endswitch %}

    Each ``{% case %}`` tag can take multiple values to compare the variable
    against::

        {% switch username %}
            {% case "Jim" "Bob" "Joe" %}
                Me old mate {{ username }}! How ya doin?
            {% else %}
                Hello {{ username }}
        {% endswitch %}
    """
    bits = token.contents.split()
    tag_name = bits[0]
    if len(bits) != 2:
        raise template.TemplateSyntaxError("'%s' tag requires one argument" % tag_name)
    variable = parser.compile_filter(bits[1])

    class BlockTagList(object):
        # This is a bit of a hack, as it embeds knowledge of the behaviour
        # of Parser.parse() relating to the "parse_until" argument.
        def __init__(self, *names):
            self.names = set(names)
        def __contains__(self, token_contents):
            name = token_contents.split()[0]
            return name in self.names

    # Skip over everything before the first {% case %} tag
    parser.parse(BlockTagList('case', 'endswitch'))

    cases = []
    token = parser.next_token()
    got_case = False
    got_else = False
    while token.contents != 'endswitch':
        nodelist = parser.parse(BlockTagList('case', 'else', 'endswitch'))

        if got_else:
            raise template.TemplateSyntaxError("'else' must be last tag in '%s'." % tag_name)

        contents = token.contents.split()
        token_name, token_args = contents[0], contents[1:]

        if token_name == 'case':
            tests = map(parser.compile_filter, token_args)
            case = (tests, nodelist)
            got_case = True
        else:
            # The {% else %} tag
            case = (None, nodelist)
            got_else = True
        cases.append(case)
        token = parser.next_token()

    if not got_case:
        raise template.TemplateSyntaxError("'%s' must have at least one 'case'." % tag_name)

    return SwitchNode(variable, cases)

class SwitchNode(Node):
    def __init__(self, variable, cases):
        self.variable = variable
        self.cases = cases

    def __repr__(self):
        return "<Switch node>"

    def __iter__(self):
        for tests, nodelist in self.cases:
            for node in nodelist:
                yield node

    def get_nodes_by_type(self, nodetype):
        nodes = []
        if isinstance(self, nodetype):
            nodes.append(self)
        for tests, nodelist in self.cases:
            nodes.extend(nodelist.get_nodes_by_type(nodetype))
        return nodes

    def render(self, context):
        try:
            value_missing = False
            value = self.variable.resolve(context, True)
        except VariableDoesNotExist:
            no_value = True
            value_missing = None

        for tests, nodelist in self.cases:
            if tests is None:
                return nodelist.render(context)
            elif not value_missing:
                for test in tests:
                    test_value = test.resolve(context, True)
                    if value == test_value:
                        return nodelist.render(context)
        else:
            return "" 
```

* * *

## 回答 #3

> 赞同：21
> 
> 时间：2009-04-07T14:46:47.290

不幸的是，这对于默认的 Django 模板引擎是不可能的。你必须写一些像这样丑陋的东西来模拟一个开关。

```
{% if a %}
    {{ a }}
{% else %}
    {% if b %}
        {{ b }}
    {% else %}
        {% if c %}
            {{ c }}
        {% else %}
            {{ default }}
        {% endif %}
    {% endif %}
{% endif %} 
```

或者如果只有一个 if 条件可以为真并且您不需要默认值。

```
{% if a %}
{{ a }}
{% endif %}
{% if b %}
{{ b }}
{% endif %}
{% if c %}
{{ c }}
{% endif %} 
```

通常，当模板引擎不足以完成你想要的事情时，这表明代码应该被移动到 Django 视图而不是模板中。例如：

```
# Django view
if a:
  val = a
elif b:
  val = b
elif c:
  val = c
else:
  val = default

# Template
{{ val }} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-06-29T09:28:35.403

在一个非常普遍的观点中，对 switch 语句的需求表明需要创建新的类和对象来捕获不同的“案例”。

然后，无需到处“切换”，您只需调用对象方法或引用对象属性即可。

# python - 动态使用 Cython 扩展模块中定义的类方法

> ID：725777
> 
> 赞同：3
> 
> 时间：2009-04-07T13:44:09.517
> 
> 标签：python, methods, cython

如果存在，我想使用类方法的 C 实现（从[Cython](http://www.cython.org/)生成），或者如果不存在 C 扩展，则使用其 Python 等效项。我首先尝试了这个：

```
class A(object):
    try:
        import c_ext
        method = c_ext.optimized_method
    except ImportError:
        def method(self):
            return "foo" 
```

其中 optimize_method 是[Cython](http://www.cython.org/)模块中定义的函数：

```
def optimized_method(self):
    return "fasterfoo" 
```

但这不起作用：

```
>>> A().method()
exceptions.TypeError: optimized_method() takes exactly one argument (0 given) 
```

我发现完成这项工作的唯一方法是：

```
class A(object):
    def method(self):
        try:
            import c_ext
            return c_ext.optimized_method(self)
        except ImportError:
            pass
        return "foo" 
```

但是在每个函数调用中检查模块的存在似乎并不理想......为什么我的第一种方法不起作用？

[编辑]：添加[Cython](http://www.cython.org/)模块的内容

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-07T15:11:47.650

好的，我刚刚找到了答案...

The problem comes from the way Cython [wraps the functions it exports](http://docs.cython.org/docs/limitations.html#behaviour-of-class-scopes): every method is unbound regardless from where it is referenced.

The solution is to explicitly declare a bound method:

```
class A(object):
    def method(self):
        return "foo"

try:
    import c_ext
    import types
    A.method = types.MethodType(c_ext.optimized_method, None, A)
except ImportError:
    pass 
```

# architecture - 高级开发人员的沟通模式

> ID：725781
> 
> 赞同：7
> 
> 时间：2009-04-07T13:44:23.837
> 
> 标签：architecture, project-management

几个月来，我一直在我们公司举行每周一次的“技术主管”会议。它变得非常平凡，而且更多的是状态更新。我正在寻找使这更加动态的想法：

*   这些是我认为可以产生伟大想法和远见的人
*   它们还具有其他人在特定领域和代码/架构主体中没有的深度
*   这是他们有时间互相交流的少数机会之一，所以我想让它尽可能高效

我是一名工程师，而不是经理，但让这些人围坐一个小时告诉我他们上周做了什么似乎是在浪费才华。更难的是，有些人也从偏远地区拨入。我希望让它变得不那么正式，比如白板讨论会，但不确定需要多少结构。如果你读过“美丽的心灵”，我会喜欢他们在普林斯顿举行的下午茶派对，他们在黑板上谈论数学。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-07T13:52:22.927

我认为挑战是让每个人都参与进来。为技术主管可以自愿参加的演示留出时间，并让他们提交主题。要求他们展示达到重要里程碑的项目。使用 webex 为远程人员在线执行此操作。您需要每周会议，还是可以每两周召开一次？这也有帮助。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-07T18:51:21.680

1.  不允许拨入
2.  选择一个有争议的话题，让某人准备好争论它（“我们应该将我们所有的应用程序迁移到 ruby​​。”“我们需要一个通用的消息传递框架”。“PL/SQL 应该被禁止”）
3.  找一间带大白板的会议室

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-07T16:07:59.733

我发现当我们有人“教”一项技术时，我们在这些会议中的来回交流会得到最好的结果。也许这是新事物——也许不是。有时我们会一起进行一些代码审核，我们会讨论什么是好的，什么是坏的，以及为什么有些事情会按照它们的方式完成。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-07T13:51:26.393

我同意，应该为创意输入预留专门的面谈时间。您可以从通过电子邮件发送的每周格式信函中获取有关进度的更新。

一些想法：

*   做一个棕色袋子风格的演示。让每个领导展示他/她的那块蛋糕的整体架构方法，重点关注挑战以及如何解决它们
*   选择新的/有趣的/重要的技术和技巧，并让主题专家就如何在他们的领域应用它进行演示
*   讨论软技能和外围问题，如团队管理。留下名字，但创建一个论坛，可以在构建管理、项目管理等方面分享建设性的想法。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-07T19:33:34.620

首先，我将状态更新分开（如果不需要，则将它们完全删除）。

其次，我不会给出任何答案，我会给出更多的问题。

一般来说，擅长某事的人喜欢谈论自己、他们所做的事情、他们的决定和理由，以及基本上每天激励他们的东西。这些人有维基百科，你可以搜索他们相关的问题吗？您是否与他们一对一地了解是什么让他们打勾？了解个人并了解个人将使放松这些人的工作变得容易得多。他们更喜欢辩论而不是状态更新吗？如果是这样，开始辩论。

在早上或午餐前在人们新鲜时这样做，而不是在漫长的一周后筋疲力尽时这样做。

由于这些人是您的明星，因此向他们展示您对他们的时间的重视程度非常重要。为会议安排时间，对此要格外努力。此外，如果人们正在讨论他们的问题/问题，请询问他们正在做什么。记下对自己的快速提醒，并在随后的会议中询问进展情况。不要强迫每个人说话。

如果本次会议是您运行的论坛，请戴上主持人的帽子并戴上工程师的帽子。在会议期间不提供任何建议或贡献。推动会议议程，保持顺畅。这是你倾听的机会。特别是，带来人们的问题或业务问题。把技术问题留给那些人，因为他们可能已经解决了。当然，他们可以并且会提出技术问题。但是谈谈你如何评估你的员工？那有效吗？我们可以做些什么来提高对 X 的认识？我们应该在团队之间轮换员工吗？谈谈你觉得很难而不是容易的事情。

我完全建议不要浪费人们的时间来要求他们准备他们所在地区的状态更新或演示等等。如果有什么你需要知道或想听的，问那个问题。显然，状态更新对您没有价值。你想听什么？

希望有帮助！

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-07T13:51:57.173

您是否尝试过制定议程并对应该讨论的内容提出一些期望，例如架构和即将出现的挑战，而不是上周在任务方面完成了什么？或者他们会兴奋地讨论什么很酷的事情？另一个方面是尝试在会议之前发送一条消息，您想尝试将会议更改为更像这样或那样，并查看您得到什么样的反馈，因为其他潜在客户可能希望它改变但可能不想挺身而出进行更改。

另一部分是您与这些其他潜在客户有多少定期互动？如果您每天与他们交谈 20 分钟，那么您可能能够在各种信息中滑入关于您想在会议中做什么，而如果互动更加有限，那么这可能不是一个好主意。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-07T13:57:17.127

也许需要一点友好的竞争。没什么太严重的，但可以提供一点焦点。您可以为最佳 5 分钟演讲提供奖品，由集体投票授予。演示文稿的内容实际上并不重要，尽管技术性的东西可能是最好的。一旦冰被打破，您可以尝试放弃比赛方面，看看势头是否继续。

不过，请保持演讲简短——我们曾经做过一次类似的演讲，演讲时间为 1 小时（每两周 1 次），但会议超出了……很多。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-07T19:33:23.607

让您的开发人员讨论他们热衷的事情。

我可能会先发送一封电子邮件，然后让每个开发人员给我发回他们想要谈论和分享知识的三个主题的列表。它可以是任何东西，从技术到工具再到测试。没关系，只要他们愿意谈论它并对此有一些热情。

然后我会开始挑选和选择哪些主题以及哪些人将在下次会议上展示/讨论。我会留意多人建议的话题，因为如果人们对同一话题有不同的看法，这些话题可能会引发一些有趣的对话。

但大多数情况下，我会尝试和培养的是一种共享知识的心态。我会寻找能够向我解释他们面临什么样的障碍、他们如何克服挑战、他们用来克服挑战的技术/工具以及他们是否认为这些技术/工具将适用于他们的人未来的发展环境。希望他们对自己的解决方案有一些热情，并愿意分享这些知识。

我还会让他们列出两到三件在他们的环境中导致他们痛苦/痛苦/沮丧的事情。我在这里寻找的是一个揭露常见问题和头痛的机会，然后看看是否有人已经成功地处理了相同或类似的问题。

大多数情况下 - 知识共享。他们必须了解这个时代的意义以及每个人的目的。

在某种程度上，它就像开发人员的支持小组。

# python - 在 Python 中，“.append()”和“+= []”有什么区别？

> ID：725782
> 
> 赞同：133
> 
> 时间：2009-04-07T13:44:24.087
> 
> 标签：python, list, concatenation

有什么区别：

```
some_list1 = []
some_list1.append("something") 
```

和

```
some_list2 = []
some_list2 += ["something"] 
```

* * *

## 回答 #1

> 赞同：170
> 
> 时间：2009-04-07T14:00:24.080

对于您的情况，唯一的区别是性能：附加速度是原来的两倍。

```
Python 3.0 (r30:67507, Dec  3 2008, 20:14:27) [MSC v.1500 32 bit (Intel)] on win32
Type "help", "copyright", "credits" or "license" for more information.
>>> import timeit
>>> timeit.Timer('s.append("something")', 's = []').timeit()
0.20177424499999999
>>> timeit.Timer('s += ["something"]', 's = []').timeit()
0.41192320500000079

Python 2.5.1 (r251:54863, Apr 18 2007, 08:51:08) [MSC v.1310 32 bit (Intel)] on win32
Type "help", "copyright", "credits" or "license" for more information.
>>> import timeit
>>> timeit.Timer('s.append("something")', 's = []').timeit()
0.23079359499999999
>>> timeit.Timer('s += ["something"]', 's = []').timeit()
0.44208112500000141 
```

一般情况下`append`会将一项添加到列表中，同时会将右侧列表的*所有*`+=`元素复制到左侧列表中。

 ***更新：性能分析**

比较字节码，我们可以假设version 在+和 += version -- in 中`append`浪费了周期。显然超过+ 。`LOAD_ATTR``CALL_FUNCTION``BUILD_LIST``BUILD_LIST``LOAD_ATTR``CALL_FUNCTION`

```
>>> import dis
>>> dis.dis(compile("s = []; s.append('spam')", '', 'exec'))
  1           0 BUILD_LIST               0
              3 STORE_NAME               0 (s)
              6 LOAD_NAME                0 (s)
              9 LOAD_ATTR                1 (append)
             12 LOAD_CONST               0 ('spam')
             15 CALL_FUNCTION            1
             18 POP_TOP
             19 LOAD_CONST               1 (None)
             22 RETURN_VALUE
>>> dis.dis(compile("s = []; s += ['spam']", '', 'exec'))
  1           0 BUILD_LIST               0
              3 STORE_NAME               0 (s)
              6 LOAD_NAME                0 (s)
              9 LOAD_CONST               0 ('spam')
             12 BUILD_LIST               1
             15 INPLACE_ADD
             16 STORE_NAME               0 (s)
             19 LOAD_CONST               1 (None)
             22 RETURN_VALUE 
```

`LOAD_ATTR`我们可以通过消除开销来进一步提高性能：

```
>>> timeit.Timer('a("something")', 's = []; a = s.append').timeit()
0.15924410999923566 
```

* * *

## 回答 #2

> 赞同：52
> 
> 时间：2009-04-07T13:51:17.003

`append`在您给出的示例中，就输出而言，和之间没有区别`+=`。`append`但是和`+`（问题最初提出的问题）之间是有区别的。

```
>>> a = []
>>> id(a)
11814312
>>> a.append("hello")
>>> id(a)
11814312

>>> b = []
>>> id(b)
11828720
>>> c = b + ["hello"]
>>> id(c)
11833752
>>> b += ["hello"]
>>> id(b)
11828720 
```

如您所见，`append`并`+=`具有相同的结果；他们将项目添加到列表中，而不生成新列表。使用`+`添加两个列表并生成一个新列表。

* * *

## 回答 #3

> 赞同：49
> 
> 时间：2009-04-07T13:57:37.907

```
>>> a=[]
>>> a.append([1,2])
>>> a
[[1, 2]]
>>> a=[]
>>> a+=[1,2]
>>> a
[1, 2] 
```

看到 append 将单个元素添加到列表中，这可能是任何东西。`+=[]`加入列表。

* * *

## 回答 #4

> 赞同：32
> 
> 时间：2009-04-07T15:29:12.133

+= 是一个任务。当你使用它时，你实际上是在说 'some_list2= some_list2+['something']'。作业涉及重新绑定，因此：

```
l= []

def a1(x):
    l.append(x) # works

def a2(x):
    l= l+[x] # assign to l, makes l local
             # so attempt to read l for addition gives UnboundLocalError

def a3(x):
    l+= [x]  # fails for the same reason 
```

+= 运算符通常也应该像 list+list 通常那样创建一个新的列表对象：

```
>>> l1= []
>>> l2= l1

>>> l1.append('x')
>>> l1 is l2
True

>>> l1= l1+['x']
>>> l1 is l2
False 
```

然而在现实中：

```
>>> l2= l1
>>> l1+= ['x']
>>> l1 is l2
True 
```

这是因为 Python 列表实现[了 __iadd__()](http://docs.python.org/reference/datamodel.html#object.__iadd__)以使 += 增强赋值短路并改为调用 list.extend() 。（这有点奇怪：它通常按照你的意思做，但出于令人困惑的原因。）

通常，如果您要附加/扩展现有列表，并且希望保留对同一列表的引用（而不是创建新列表），最好明确并坚持使用 append()/extend()方法。

* * *

## 回答 #5

> 赞同：21
> 
> 时间：2009-04-07T13:54:49.193

```
 some_list2 += ["something"] 
```

实际上是

```
 some_list2.extend(["something"]) 
```

对于一个值，没有区别。文档指出：

> `s.append(x)` 一样`s[len(s):len(s)] = [x]`
> `s.extend(x)` _`s[len(s):len(s)] = x`

因此显然`s.append(x)`与`s.extend([x])`

* * *

## 回答 #6

> 赞同：9
> 
> 时间：2014-06-10T08:56:48.657

不同之处在于***concatenate***将使结果列表变平，而***append***将保持级别不变：

例如：

```
myList = [ ]
listA = [1,2,3]
listB = ["a","b","c"] 
```

使用 append，您最终会得到一个列表列表：

```
>> myList.append(listA)
>> myList.append(listB)
>> myList
[[1,2,3],['a',b','c']] 
```

使用 concatenate 代替，你最终得到一个平面列表：

```
>> myList += listA + listB
>> myList
[1,2,3,"a","b","c"] 
```

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2012-01-02T13:42:10.627

这里的性能测试不正确：

1.  您不应该只运行一次配置文件。
2.  如果比较`append`与`+=[]`多次，则应声明`append`为本地函数。
3.  不同 python 版本的时间结果不同：64 位和 32 位。

例如

```
timeit.Timer('for i in xrange(100): app(i)', 's = [] ; app = s.append').timeit() 
```

可以在这里找到好的测试：[Python list append vs. +=[]](https://web.archive.org/web/20171201054245/http://www.markandclick.com:80/1/post/2012/01/python-list-append-vs.html)

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2009-04-07T15:24:17.730

除了其他答案中描述的方面之外， append 和 +[] 在您尝试构建列表时具有非常不同的行为。

```
>>> list1=[[1,2],[3,4]]
>>> list2=[5,6]
>>> list3=list1+list2
>>> list3
[[1, 2], [3, 4], 5, 6]
>>> list1.append(list2)
>>> list1
[[1, 2], [3, 4], [5, 6]] 
```

list1+['5','6'] 将 '5' 和 '6' 作为单独的元素添加到 list1 中。list1.append(['5','6']) 将列表 ['5','6'] 作为单个元素添加到 list1。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2012-03-14T01:03:43.597

其他答案中提到的重新绑定行为在某些情况下确实很重要：

```
>>> a = ([],[])
>>> a[0].append(1)
>>> a
([1], [])
>>> a[1] += [1]
Traceback (most recent call last):
  File "<interactive input>", line 1, in <module>
TypeError: 'tuple' object does not support item assignment 
```

那是因为增强的赋值总是重新绑定，即使对象在原地发生了变异。这里的重新绑定恰好是`a[1] = *mutated list*`，这对元组不起作用。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2020-04-05T17:56:18.787

“+”**不会**改变列表

.append()**改变**旧列表

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2018-09-03T13:48:46.380

我们先举个例子

```
list1=[1,2,3,4]
list2=list1     (that means they points to same object)

if we do 
list1=list1+[5]    it will create a new object of list
print(list1)       output [1,2,3,4,5] 
print(list2)       output [1,2,3,4]

but if we append  then 
list1.append(5)     no new object of list created
print(list1)       output [1,2,3,4,5] 
print(list2)       output [1,2,3,4,5]

extend(list) also do the same work as append it just append a list instead of a 
single variable 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2019-04-15T10:12:34.677

append() 方法将单个项目添加到现有列表

```
some_list1 = []
some_list1.append("something") 
```

所以这里 some_list1 将被修改。

更新：

而使用 + 组合现有列表中的列表元素（多个元素）类似于扩展（由[Flux](https://stackoverflow.com/users/5916915/flux)更正）。

```
some_list2 = []
some_list2 += ["something"] 
```

所以这里的 some_list2 和 ["something"] 是两个组合在一起的列表。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2020-10-01T08:25:49.037

截至今天和 Python 3.6，@Constantine 提供的结果不再相同。

```
Python 3.6.10 |Anaconda, Inc.| (default, May  8 2020, 02:54:21) 
[GCC 7.3.0] on linux
Type "help", "copyright", "credits" or "license" for more information.
>>> import timeit
>>> timeit.Timer('s.append("something")', 's = []').timeit()
0.0447923709944007
>>> timeit.Timer('s += ["something"]', 's = []').timeit()
0.04335783299757168 
```

看起来`append`和`+=`现在具有相同的性能，而编译差异根本没有改变：

```
>>> import dis
>>> dis.dis(compile("s = []; s.append('spam')", '', 'exec'))
  1           0 BUILD_LIST               0
              2 STORE_NAME               0 (s)
              4 LOAD_NAME                0 (s)
              6 LOAD_ATTR                1 (append)
              8 LOAD_CONST               0 ('spam')
             10 CALL_FUNCTION            1
             12 POP_TOP
             14 LOAD_CONST               1 (None)
             16 RETURN_VALUE
>>> dis.dis(compile("s = []; s += ['spam']", '', 'exec'))
  1           0 BUILD_LIST               0
              2 STORE_NAME               0 (s)
              4 LOAD_NAME                0 (s)
              6 LOAD_CONST               0 ('spam')
              8 BUILD_LIST               1
             10 INPLACE_ADD
             12 STORE_NAME               0 (s)
             14 LOAD_CONST               1 (None)
             16 RETURN_VALUE 
```

# html - CSS 甚至不适用

> ID：725783
> 
> 赞同：2
> 
> 时间：2009-04-07T13:44:29.187
> 
> 标签：html, css

我正在编程的网络应用程序遇到一个非常奇怪的问题。*基本上，什么*都没有奏效，我不得不不断降低它的复杂程度，试图让它发挥作用。我现在遇到的问题是由于某种原因我的 CSS 不适用。

我把它链接了，我确保我使用的 ID 是正确的，但它只是不应用 css。继承人的代码：

管理.php

```
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <title>Blog Manager</title>
    <link rel='stylsheet' type='text/css' href='manage.css' />
    <script type='text/javascript' src='jquery.js'></script>
    <script type='text/javascript' src='prototype.js'></script>  
    <script type='text/javascript' src='shadowbox-prototype.js'></script>
    <script type='text/javascript' src='shadowbox.js'></script>
    <script type="text/javascript">
    window.onload = Shadowbox.init();
    </script>
  </head>
  <body>
    <center>
    <div id='loginbox'>
      <table>
        <tr>
          <td>Username</td>
          <td><input type='text' name='username' /></td>
        </tr>
        <tr>
          <td>Password</td>
          <td><input type='password' name='password' /></td>
        </tr>
        <tr>
          <td colspan='2'><input type='submit' value='Submit' /></td>
        </tr>
      </table>
    </div>
    </center>
  </body>
</html> 
```

管理.css

```
#loginbox {
    position: absolute;
    height: 400px;
    width: 400px;
    top: 50%;
    left: 50%;
    margin-top: -200px;
    margin-left: -200px;
    background-color: #999999;
    border: 1px solid #666666;
} 
```

我错过了一些小东西吗？我在 firefox 和 chrome 中尝试过，所以我知道这不是一些奇怪的浏览器问题。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-04-07T13:47:35.857

这包含一个错字：

```
<link rel='stylsheet' type='text/css' href='manage.css' /> 
```

更改`stylsheet`为`stylesheet`。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-07T13:48:31.563

链接 rel='样式表'

记得使用 firebug 来测试你的 css 并验证你的 html

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-07T13:49:52.607

在`<link>`manage.php 的标签中，更改：

```
<link rel='stylsheet' type='text/css' href='manage.css' /> 
```

到：

```
<link rel='stylesheet' type='text/css' href='manage.css' /> 
```

（注意“样式表”中的错字）

# iphone - 如何在代码中在 iPhone 上“闪耀”png？

> ID：725791
> 
> 赞同：1
> 
> 时间：2009-04-07T13:46:12.990
> 
> 标签：iphone

如何复制应用程序启动器在方形 .png 上使用的效果，以向我的用户展示他们的图标作为应用程序徽章的外观。

注意 - 我想在 iPhone 上的代码中执行此操作，而不是在我计算机上的 Photoshop 中。

谢谢！

编辑：试图在这里真正清楚。我如何用*代码*做到这一点！我尝试过创建一个叠加层，但闪耀的苹果实际上确实使顶部变亮，所以只是在顶部放一个 png 不会产生相同的效果。

大概应用程序启动器应用了一些 CA 效果 - 有人知道如何复制它们吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-07T13:58:08.890

在计算机上的 Photoshop 中创建一个透明的光泽叠加层，并在代码中合并这两个图像。

没有硬编码光泽遮罩或构建迷你光线追踪器，这可能是最简单的方法。

这里甚至还有一个 Photoshop 教程/模板的链接：

[http://www.keepthewebweird.com/iphone-icon-psd-template/](http://www.keepthewebweird.com/iphone-icon-psd-template/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-08T17:50:25.157

另一种更简单的方法是将您的图标保存为一个名为“icon.png”的 57px x 57px PNG，没有任何发光效果，然后将其 FTP 到 Web 服务器的根文件夹并在那里创建一个名为 icon_test.html 的文件，其中包含以下代码：

```
<html>
    <head>
        <link rel="apple-touch-icon" href="/icon.png"/> 
        <title>The App Name</title>
    </head>
    <body>
         iPhone test page
    </body>
</html> 
```

然后只需在 iPhone 上的移动 Safari 中浏览 icon_test.html 文件，点击工具栏中的“+”按钮将页面保存为书签，点击“添加到主屏幕”，然后点击右上角的“添加” . 然后，您将看到您的图标出现在主屏幕上，并带有 Apple 的闪耀覆盖。

# jquery-ui - IE 6 的 Jquery Accordion 问题

> ID：725795
> 
> 赞同：7
> 
> 时间：2009-04-07T13:47:04.937
> 
> 标签：jquery-ui

我使用以下选项在我的一个页面上实现了 Jquery 手风琴

```
$("#accordion").accordion({ header: "h3", alwaysOpen: false, active: false, autoHeight: false}); 
```

这在 Firefox 和 ie7 中效果很好（[现在我已经升级到 v1.7 of jquery ui](http://dev.jqueryui.com/ticket/4331)）

然而在 ie6 中，几乎每个手风琴的所有内容都消失了（我只剩下一个`<select>`标签显示？！）

如果我根据[这个答案](https://stackoverflow.com/questions/332448/jquery-accordion-ie-animation-issues/694323#694323)将 AutoHeight 选项更改为 true ，那么一切都很好，除了我失去了手风琴大小合适的好处，而且其中一些有大量的空白。

有谁知道修复，以便我仍然可以拥有 AutoHeight = false？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-07-27T13:01:34.373

添加 .ui-accordion-content{ zoom: 1; 我的 CSS 为我解决了这个问题：

```
<link type="text/css" href="css/dark-hive/jquery-ui-1.7.2.custom.css" rel="stylesheet" />   
<style type="text/css">
        .ui-accordion-content{ zoom: 1; } 
</style> 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-07-20T00:32:15.397

面对同样的问题，我找到了一个适用于所有浏览器的解决方案，而无需更改 autoHeight 参数。

只需像这样向您的CSS添加一个类：

```
* html .clearfix { height: 1%; } 
```

然后将其添加到 h3 之后的内容 div 中（如下所示：）

```
<h3>Header</h3>
<div class="clearfix">Whatever</div> 
```

这个问题实际上是一个带有不可见文本渲染的 IE6 问题。我已经在包含无序列表和复杂嵌套 div 等的内容上对其进行了测试，一切正常。让我知道这是否成功！

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-08T19:39:50.927

我有同样的问题。手风琴与 ul 配合得很好，所以我找到了这篇关于如何在不使用 .

[http://mindrulers.blogspot.com/2008/03/create-table-using-css.html](http://mindrulers.blogspot.com/2008/03/create-table-using-css.html)

希望这可以帮助。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-12-14T05:14:29.770

该问题似乎与 IE6 渲染错误有关。这解决了我的问题。

```
// This is required for IE6.
if (jQuery.browser.msie && jQuery.browser.version.substr(0,1)<7)
    jQuery('#accordion *').css('zoom', '1'); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-06-15T11:52:10.507

我的解决方法是对 IE6 使用 autoHeight true，对所有其他浏览器使用 false。

```
var autoHeight = false;
if($.browser.msie && parseFloat($.browser.version) <= 7.0) { autoHeight = true; }
$("#accordion").accordion({ autoHeight: autoHeight }); 
```

# sql-server-2005 - sql server 中的动态 sql join

> ID：725804
> 
> 赞同：0
> 
> 时间：2009-04-07T13:48:16.760
> 
> 标签：sql-server-2005, tsql

我有两个表之间的关系。这两个表 PK 是 int 类型。

在一张表（UserS）中，我需要提供用户名并获取相应的 ID（即 PK）。这是使用表单身份验证时的标准 ASP.NET 用户表。

但是，在相关表中，我想提供从 Users 表中找到的 ID 以获取值。

就像是：

运行查询以获取用户名的 ID（简单的选择/位置查询）返回结果运行一个子查询，我可以在上面的结果中传递 - 获取 ID = 结果的值

这听起来很像动态 sql。但是，可能有更合适和更合适的方式来编写此查询（在 Sql Server 2k5 上）。

我该怎么做？潜伏着什么陷阱？

编辑：我会按照[http://www.sqlteam.com/article/introduction-to-dynamic-sql-part-1的方式尝试一些东西](http://www.sqlteam.com/article/introduction-to-dynamic-sql-part-1)

编辑：感谢大家的提示，我写了这个：

SELECT Discount.DiscountAmount FROM Discount INNER JOIN aspnet_Users ON Discount.DiscountCode = aspnet_Users.UserId 和 aspnet_Users.Username = 's'

其中 's' 将被参数替换。

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-07T13:52:34.597

您不必为此使用动态 SQL。

您可以改用查找：

```
DECLARE @ID bigint
SELECT @ID = ID FROM Users WHERE Username = @Username

SELECT
  *
FROM
  TableB
WHERE
  ID = @ID 
```

然后，您可以将 PARAMETER @Username 添加到您的 SqlCommand 对象中，以防止 SQL 注入的风险。

此外，进行查找比连接更可取，因为针对 TableB 扫描了一次索引。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-07T13:54:42.297

对，我会这样做：

```
SELECT *
FROM TableB
JOIN Users ON Users.Id = TableB.ID 
WHERE Users.Username = @Username 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-07T13:57:41.260

关于查找与连接 - 虽然新手使用查找似乎更直观，但您应该使用连接。需要为主要结果集中的每一行评估查找，而对连接进行一次评估。联接效率更高，这意味着它们更快。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-07T13:53:32.520

这只是一个简单的连接，不是吗？

```
SELECT  x.*
FROM    user_table u
        INNER JOIN
                other_table x
                ON u.id = x.user_id
WHERE   u.name = @user_name 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-07T13:54:03.703

```
SELECT  values.value
FROM    form_users, values
WHERE   form_users.username = 'John Doe'
        AND values.user = form_users.userid 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-07T13:56:19.347

```
SELECT
   *
FROM
   table2 t2
   JOIN
   UserS t1 ON t2.IDKey = t1.IDKey
WHERE
   UserS.Username = @Input 
```

# http - CloudFront 缓存 - 如何确保 CF 在到期后从 S3 源服务器刷新？

> ID：725809
> 
> 赞同：5
> 
> 时间：2009-04-07T13:48:41.347
> 
> 标签：http, caching, amazon-s3, amazon-web-services

我将带有到期标头的资产放入 S3，这些标头已成功传递到 CloudFront 分配。但是，过期后的请求不会导致 CloudFront 从源服务器请求新文件。

我还发现查询字符串版本令牌不会强制使用新资产，并且我不想使用完整的文件名版本控制。

所有这一切都可能归因于我对缓存控制标头的了解不足，但我开始怀疑我是否遗漏了有关 CloudFront 应该如何工作的关键信息。CloudFront 响应显示如下标头。

```
Cache-Control: max-age=120
Expires: Tue, 07 Apr 2009 12:13:26 GMT 
```

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2010-06-27T01:05:19.163

时间流逝，事情发生了变化。正如蒂姆所指出的，最短的缓存时间是 24 小时，但在 2010 年 4 月，亚马逊宣布他们将识别并遵循将缓存缩短至一小时的指令。

此处公告：http: [//developer.amazonwebservices.com/connect/ann.jspa ?annID=655](http://developer.amazonwebservices.com/connect/ann.jspa?annID=655)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-07T14:55:17.457

看起来亚马逊忽略了不到 24 小时的到期时间。 [http://developer.amazonwebservices.com/connect/thread.jspa?messageID=107699꒳](http://developer.amazonwebservices.com/connect/thread.jspa?messageID=107699&#107699)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-10-07T15:55:24.087

正如 Matchu 在评论中所指出的，如果您愿意，您现在可以将到期时间一直设置为零，这对于开发和测试服务器来说非常好！

[http://aws.amazon.com/about-aws/whats-new/2012/03/19/amazon-cloudfront-lowers-minimum-expiration-period/](http://aws.amazon.com/about-aws/whats-new/2012/03/19/amazon-cloudfront-lowers-minimum-expiration-period/)

> 最小 TTL 值可能短至 0 秒。然后，您可以通过在源文件中设置缓存控制标头来为每个文件设置 TTL。

另请注意[亚马逊文档所说的内容](http://docs.aws.amazon.com/AmazonCloudFront/latest/DeveloperGuide/Expiration.html)：

> 在 Expires 标头中的到期日期和时间过去后，每次边缘站点收到对象请求时，CloudFront 都会再次从源服务器获取对象。
> 
> 我们建议您使用 Cache-Control max-age 指令而不是 Expires 标头字段来控制对象缓存。如果您同时为 Cache-Control max-age 和 Expires 指定值，CloudFront 仅使用 max-age 的值。

# latex - 在编写手册/书籍方面，Sphinx 比 LaTex 更好吗？

> ID：725811
> 
> 赞同：16
> 
> 时间：2009-04-07T13:49:03.140
> 
> 标签：latex, python-sphinx

年初时只有[少数人推荐使用 Sphinx。](https://stackoverflow.com/questions/409717/how-best-to-write-documentation-ideally-in-latex-targetting-both-the-web-html#409956)

狮身人面像最近发展得相当快。我今天注意到 Sage 已经从使用 LaTex 直接编辑更改为 Sphinx。[这在William Stein](http://groups.google.com/group/sage-support/browse_thread/thread/e3bad521d986ec4b?hl=en) 4 月 2 日关于 Sage 教程的回答中很明显

> 本教程不再是乳胶文档。这是一个完全不同的 Sphinx 文档，可以输出 pdf。

这表明我认为 Sphinx 可能处于适合我的水平。

**在编写手册/书籍方面，Sphinx 比 LaTex 更好吗？**

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-04-08T11:00:21.180

*我们用sphinx*写了一本书，但我们不得不调整用 Python 脚本生成的*tex文件。*

看看这个[线程](http://groups.google.com/group/sphinx-dev/browse_thread/thread/ee0504fce5a770c4/6629328a3b739522?lnk=gst&q=openerp#6629328a3b739522)，在*书籍构建工具*部分

这是我们对原始 LaTeX 文件所做的一些更改：

*   文档类 = '书'
*   添加了*frontmatter*，*mainmatter*和*backmatter*
*   *为fncychap.sty*添加了新样式
**   两列索引而不是一列*   页眉的一些变化*   一切都是黑白的
    *   链接
    *   标题
    *   图像（使用 imagemagick 将图像转换为灰度图像）*   提示和注释显示在带有图标的更好的框中*   在页面上更好的浮动放置以优化使用的空间*

 *我们还对*book.cls*和*sphinx.sty做了一些小改动*

通过所有这些调整，我们对结果非常满意。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-09-10T16:42:17.343

好吧，至少有一本书是用 sphinx 和 rst2pdf 打印的

此处通过 sphinx 和 rst2pdf 生成的一些示例文档：

[http://freedrive.com/folder/236385](http://freedrive.com/folder/236385)

和这里：

[http://freedrive.com/folder/236380](http://freedrive.com/folder/236380)

专门查看python库参考和django书。

这是开发分支的输出，并且存在正在修复的错误（例如，目录通常位于页面的错误一侧）。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2010-03-12T08:05:54.347

我更喜欢 Sphinx 而不是 Latex 来编写手册，原因有两个：

1.  您可以轻松构建漂亮的 HTML、PDF、htmlhelp 和 qthelp 版本的手册。
2.  reST 语法写起来更快，我发现更容易记住（更简单）

然而，一本书可能是一个不同的故事。如果我想写一本只有印刷版和 pdf 版本并且包含方程式和引文的书，我会选择 Latex，因为我认为它比 reST 成熟得多，而且我发现它很容易定制。

顺便提一句。我在使用 Latex 方面有更多的经验。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-07T13:52:50.463

最好是创建参考文档，而不是写书。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-08T11:24:15.600

Word 是更好的文档制作工具吗？

LaTeX（和 TeX）已经存在的时间比我们大多数人意识到的有程序可以做这类事情并且我们对它们感兴趣。LaTeX 几乎肯定比 Sphinx（或 Word）好。

1.  对你更好吗？也许。

2.  对我更好吗？不太可能。

3.  对普通人来说更好吗？定义“平均”，然后转到第 1 点。

# .net - 处理大文件时正则表达式匹配中的 OutOfMemoryException

> ID：725817
> 
> 赞同：3
> 
> 时间：2009-04-07T13:50:30.157
> 
> 标签：.net, regex, performance, memory, out-of-memory

我有一个生产代码版本的异常日志。

```
System.OutOfMemoryException: Exception of type 'System.OutOfMemoryException' was thrown.
   at System.Text.RegularExpressions.Match..ctor(Regex regex, Int32 capcount, String text, Int32 begpos, Int32 len, Int32 startpos)
   at System.Text.RegularExpressions.RegexRunner.InitMatch()
   at System.Text.RegularExpressions.RegexRunner.Scan(Regex regex, String text, Int32 textbeg, Int32 textend, Int32 textstart, Int32 prevlen, Boolean quick)
   at System.Text.RegularExpressions.Regex.Run(Boolean quick, Int32 prevlen, String input, Int32 beginning, Int32 length, Int32 startat)
   at System.Text.RegularExpressions.MatchCollection.GetMatch(Int32 i)
   at System.Text.RegularExpressions.MatchEnumerator.MoveNext() 
```

它尝试处理的数据约为 800KB。

在我的本地测试中，它运行良好。你有没有见过类似的行为，可能是什么原因？

我是否应该在处理之前拆分文本，但显然在这种情况下正则表达式可能不匹配，因为原始文件是从随机位置拆分的。

**我的正则表达式：**

**编辑 2：**

我认为这个特殊的 RegEx 导致了这个问题，当我在一个孤立的环境中测试它时，它会立即吃掉内存。

```
((?:( |\.\.|\.|""|'|=)[\/|\?](?:[\w#!:\.\?\+=&@!$'~*,;\/\(\)\[\]\-]|%[0-9a-f]{2})*)( |\.|\.\.|""|'| ))? 
```

**编辑**

我的本地测试错了。我正在加载一个大字符串，然后在其上附加一些东西，这使 .NET Framework 头晕目眩，然后在 RegEx 期间而不是在字符串操作期间给出 OOM 异常（或随机，所以忽略我之前说过的东西）。

*这是一个 .NET Framework 2.0 应用程序。*

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-07T14:18:56.607

没有看到你的正则表达式，我不确定，但有时你会遇到这样的问题，因为你的匹配是贪婪而不是懒惰。

Regex 引擎必须在内部存储大量信息，贪婪匹配最终可能导致 Regex 多次选择 800k 字符串的大部分。

[这里](http://www.regular-expressions.info/catastrophic.html)有一些很好的信息。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-07T13:59:30.243

如果您的应用程序可能，我会尝试的第一件事是拆分输入。

是否可以逐行读取文件（如果输入是文件），以这种方式应用正则表达式？

你应该看看[CLR Profiler](http://msdn.microsoft.com/en-us/library/ms979205.aspx)。学习如何使用可能需要一点时间，但这是值得的。它将帮助您可视化您的对象使用了多少内存。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-07T14:06:36.933

根据您的编辑，听起来您的代码可能正在创建占用大量内存的字符串。这意味着即使内存不足异常是从 Regex 代码中生成的，这实际上并不是因为 Regex 本身占用了太多内存。因此，如果在您自己的代码中使用 StringBuilder 可以解决问题，那么您应该这样做。

# java - JTextField 中没有空格

> ID：725823
> 
> 赞同：1
> 
> 时间：2009-04-07T13:51:35.830
> 
> 标签：java, swing, validation, jtextfield

如何禁止用户将空白放入 JTextField？
甚至不能写空格。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-07T14:19:59.680

我建议使用扩展的 PlainDocument 设置 JTextField 的 Document，您可以在其中覆盖 insertString 方法。（也很高兴限制大小......）
类似：

```
Document doc = new PlainDocument() {
    @Override
    public void insertString(int offs, String str, AttributeSet attr)
    throws BadLocationException {
        String newstr = str.replaceAll(" ", "");  // could use "\\s" instead of " "
        super.insertString(offs, newstr, attr);
    }

    @Override
    public void replace(int offs, int len, String str, AttributeSet attr) 
    throws BadLocationException {
        String newstr = str.replaceAll(" ", "");  // could use "\\s" instead of " "
        super.replace(offs, len, newstr, attr);
    }
};
textField.setDocument(doc); 
```

编辑：
`replace`也必须被覆盖/实现！

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-07T14:15:08.177

您可以使用键盘映射。查看[这个](http://www.exampledepot.com/egs/javax.swing.text/OverrideKey.html)不允许空间的示例，如下所示：

```
KeyStroke keyStroke = KeyStroke.getKeyStroke(Character.valueOf(' '), 0);
textField.getInputMap(JComponent.WHEN_FOCUSED).put(keyStroke, "none"); 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-07T14:33:40.583

解决此问题的最佳方法可能是使用`Document`带有 a 的 a`DocumentFilter`来删除任何键入、粘贴或以其他方式插入的空格。（编辑：这个问题最初链接到一个关于演示这种技术的小型 Swing 程序的博客条目（在这种情况下只允许整数输入）。）

扩展子类型`Document`是可能的，但更容易出错（并将您与特定实现联系起来）。

试图拦截按键实际上不起作用（它处于错误的抽象级别，因此错过了您可以插入文本的任何其他方式，例如粘贴、dnd 等）。

`JFormattedTextField`是确保任何 UI 都耗费大量时间的好方法。

# silverlight - 哪种 Silverlight MVVM 测试项目类型？

> ID：725825
> 
> 赞同：1
> 
> 时间：2009-04-07T13:51:46.393
> 
> 标签：silverlight, mvvm, automated-tests

在为 Silverlight MVVM 应用程序创建测试项目时，我应该创建一个针对 ViewModel 的标准 C# 测试项目，还是针对视图的[Silverlight 测试项目](http://code.msdn.microsoft.com/silverlightut/)，或者（gulp）两者...

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-07T20:49:49.290

为了测试 Silverlight，您将需要创建一个 Silverlight 类库项目......您将无法创建一个“标准”测试项目，因为 Silverlight 使用一个精简的框架，并且具有替代的依赖项要求。例如，Silverlight 引用 mscorlib ...您将无法轻松地将其添加到“标准”项目中，因为此引用由项目模板控制。

ib。

# svn - 有谁知道类似于 SVN Time-Lapse View 的 Git 工具

> ID：725827
> 
> 赞同：19
> 
> 时间：2009-04-07T13:51:53.850
> 
> 标签：svn, git

SVN Time-Lapse View 是一个跨平台查看器，可下载文件的所有修订版，并让您通过拖动滑块滚动浏览它们。当您滚动时，您会看到当前修订版和先前修订版的视觉差异。因此，您可以看到文件是如何演变的，并且您可以轻松找到行出现、消失或更改的修订版本。

[http://code.google.com/p/svn-time-lapse-view/](http://code.google.com/p/svn-time-lapse-view/)

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-08-22T14:56:17.627

从命令行，我建议一种方法：

```
git whatchanged -p pathToACertainFile 
```

这将显示该文件发生的所有完整差异，以及它们在哪个 sha 哈希上完成（从最新到最早）。最好将终端设置为显示彩色的东西。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-07T13:58:34.597

它不是一个滑块，但 TextMate 的 Git 包允许您通过下拉菜单浏览单个文件的修订。它突出显示当前修订的更改，并将最后编辑一行的人命名为`svn blame`-style。还有用于导航到上一个/下一个修订版的键盘快捷键。

~~[http://blog.macromates.com/2008/git-bundle/](http://blog.macromates.com/2008/git-bundle/)~~

2014-05-10 更新：现已在 GitHub 上提供：[https ://github.com/textmate/git.tmbundle](https://github.com/textmate/git.tmbundle)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-07T14:30:57.937

您可能想花一些时间探索`git log`命令和`gitk`(`gitk`与许多相同的选项一起使用`git log`)。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2015-05-23T21:55:40.997

我在这里基于 svn-time-lapse-view 创建了 git-time-lapse-view：

[https://github.com/JonathanAquino/git-time-lapse-view](https://github.com/JonathanAquino/git-time-lapse-view)

![在此处输入图像描述](https://i.stack.imgur.com/1Wy3T.jpg)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2012-03-12T18:46:53.577

最近出现了两个新项目：

*   [scm-time-lapse-view](https://github.com/vlovich/scm-time-lapse-view) (svn-time-lapse-view, Java 的分支)
*   [git-time-lapse](http://www.vim.org/scripts/script.php?script_id=3849) (Vim 脚本)

不幸的是，他们都没有在本地存储库上为我工作:-(

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-07T15:04:42.053

如果你在 Mac 上，你可能想试试[GitX](http://gitx.frim.nl/)

正如网站所引用的：

> GitX 是一个专门用于 Mac OS X 的 git GUI。它目前具有一个类似于 gitk 的历史查看器和一个类似于 git gui 的提交 GUI。但随后以丝般顺滑的 OS X 风格呈现！
> 
> 特征：
> 
> *   详细的历史查看器
> *   不错的提交 GUI，允许每次提交登台
> *   快速漂亮的 Aqua 界面
> *   将提交粘贴到 gist.github.com
> *   探索任何修订的树
> *   QuickLook 集成

可能无法完全按照您的意愿行事，但历史查看器应该会有所帮助。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-06-28T21:28:42.000

如果有 Git Java 库，您可以修改 SVN Time Lapse View 以使用它。

# java - 如何在 Java 中从 Linux 打开 UNC 路径？

> ID：725829
> 
> 赞同：6
> 
> 时间：2009-04-07T13:52:15.707
> 
> 标签：java, linux, unc

在给定 Linux 上 Java 的 UNC 路径的情况下，是否有任何可用的库允许我读取和写入 Windows 文件共享。

它在 Windows 盒子本身上是微不足道的，我知道 smbclient 方法，但我希望通过放入库来做到这一点。

谢谢。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-07T14:00:50.817

看看[jcifs](http://jcifs.samba.org/)。这听起来像你在找什么。

从 jcifs 网站：

> JCIFS 是一个开源客户端库，它以 100% Java 实现 CIFS/SMB 网络协议。CIFS 是 Microsoft Windows 平台上的标准文件共享协议（例如 Map Network Drive ...）。该客户端广泛用于大型 Intranet 的生产中。

# c# - 使用 ASP.Net ListView.ExtractItemValues，如何获取 ListViewDataItem 中 RadioButtonList 中的选定项？

> ID：725831
> 
> 赞同：0
> 
> 时间：2009-04-07T13:52:19.357
> 
> 标签：c#, asp.net, listview

我正在尝试遍历 ASP.Net ListView 中的 ListViewDataItems，并使用 ListView.ExtractItemValues 从 DataBoundControls 中获取值。这适用于 ITextControls，但我很难从 RadioButtonList 中获取所选项目。

这是我的标记：

```
<asp:ListView ID="lvQuiz" runat="server">
<LayoutTemplate>
<fieldset>
<ul>
    <asp:PlaceHolder ID="itemplaceholder" runat="server"></asp:PlaceHolder>
</ul>    
</fieldset> 
<asp:Button ID="cmdSubmit" runat="server" Text="Submit" OnClick="cmdSubmit_Click" />

</LayoutTemplate>
<ItemTemplate>
    <li>
        <fieldset>
            <legend>
                <asp:Label ID="lblQuestionText" runat="server" Text='<%# Bind("Question.QuestionText") %>' />
            </legend>
            <asp:RadioButtonList ID="rblResponse" runat="server" DataTextField="ResponseText" DataValueField="Id" 
                DataSource='<%# Bind("Question.PossibleResponses") %>'>
            </asp:RadioButtonList>
        </fieldset>
    </li>
</ItemTemplate> 
```

这是我试图提取值的代码：

```
var Q = (Quiz)Session["Quiz"];

foreach (var item in lvQuiz.Items)
{                
    var itemValues = new OrderedDictionary();
    lvQuiz.ExtractItemValues(itemValues, item, true);

    var myQuestion = Q.UserResponses.Keys
        .Where(x => x.QuestionText == itemValues["Question.QuestionText"])
        .Single();

    Q.UserResponses[myQuestion] = itemValues["Question.PossibleResponses"].SelectedItem
} 
```

我的问题在于那里的最后一行。"Question.PossibleResponses" 绑定到 RadioButtonList，但 itemValues["Question.PossibleResponses"] 的值返回我的 RadioButtonList 的所有选项的列表。如何判断用户选择了哪一个？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-09T20:02:18.067

Well, I ended up implementing an extension method for Control that implements a Recursive FindControl, as outlined in Steve Smith blog post on [Recursive FindControl](http://stevesmithblog.com/blog/recursive-findcontrol/). As I only had two bindable controls that I cared about (Label and a ListControl), this ended up being good enough. Tightly coupled to the UI, but I don't know what else to do.

# ldap - LDAP 模式中 OID 号码的实验/私有分支？

> ID：725837
> 
> 赞同：12
> 
> 时间：2009-04-07T13:52:42.897
> 
> 标签：ldap, snmp, oid

LDAP 模式中的属性或对象类通过称为[OID](http://en.wikipedia.org/wiki/Object_identifier)的唯一编号来标识。此外，OID 也用于 SNMP 协议。[每个人都可以通过 IANA](http://pen.iana.org/pen/PenApplication.page)申请企业号，然后定义自己的子号。但申请的处理时间最长可达 30 天。

有谁知道在等待官方企业号码时是否有可用于实验目的的 OID 号码的“测试”分支？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-04-08T08:52:17.353

显然 OID 分支 2.25 无需注册即可与 UUID 一起使用。可以在这里找到详细的解释： [http](http://www.oid-info.com/get/2.25) ://www.oid-info.com/get/2.25 ，还有一个指向 UUID 生成器的链接。

=> 我认为这对于未注册的 OID 来说是一个很好的解决方案。只需使用 UUID-Generator 生成一个这样的 OID。您将得到类似 2.25.178307330326388478625988293987992454427 的内容，然后可以通过在末尾添加 .1、.2、... 来简单地创建自己的子编号。

也有可能注册这样的 2.25 OID，但仍然需要人工干预，并且不能完全保证唯一性，因为其他人仍然有可能（尽管不太可能）使用与未注册的 OID 相同的 OID。对于已注册的 OID，我仍然希望 IANA 注册一个私人企业号码。

这里还列出了如何分配 OID：[http](http://www.oid-info.com/faq.htm#10) ://www.oid-info.com/faq.htm#10 。但是这里已经列出了主要答案。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-07T14:06:29.103

没有。但是，如果您的作品没有发表任何内容，没人会知道。如果您想尝试一些东西，一些 LDAP 服务器公司会分 OID 号码。但你可以化妆任何东西。

当前分配的数字仅以 0、1 或 2 开头。如果您以 4 或其他数字开头，任何精明的人都会知道您在伪造它。

我们在这里将一些关于 OID 的信息放在一起：http: [//ldapwiki.willeke.com/wiki/HowToGetYourOwnLDAPOID](http://ldapwiki.willeke.com/wiki/HowToGetYourOwnLDAPOID)

-吉姆

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-07T14:35:34.400

我不知道你在哪里。在英国，每家公司都有自己的 OID 分支机构，因为它会[http://www.oid-info.com/get/1.2.826.0](http://www.oid-info.com/get/1.2.826.0)

（不知道其他国家有没有类似的设置

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-05-22T05:50:21.910

您可以尝试[遵循](http://linuxgazette.net/130/peterson.html)**内部**原型设计（检查“对象标识符（OID）”段落）。

# ruby - 如果会话在 rails 中关闭，想要显示错误消息

> ID：725840
> 
> 赞同：0
> 
> 时间：2009-04-07T13:52:54.190
> 
> 标签：ruby

嗨，如果会话关闭，我想显示一条错误消息，因为如果我登录并按浏览器顶部的返回，然后按前进并尝试刷新页面，它会显示一条错误消息它找不到会话中的当前用户，我想显示一个页面来处理该错误消息。就像您的会话已过期。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-07T14:38:25.407

如果我对您的理解正确，您希望在 login_required 函数等中执行类似的操作。

```
cookie_session = request.cookies['my_app_session']
unless cookie_session.blank? && Session.find_by_session_d(cookie_session).blank?
  flash[:warning] = "Your session is expired, please login again"
  redirect_to new_session_path
end 
```

这个例子应该被这样对待，但它可能会让你知道该怎么做。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-07T13:59:54.953

您必须将该用户直接重定向到登录页面。并且只显示您的会话已过期的错误消息。请再次登录。或者，如果特定用户需要，您也可以要求他们重新向服务器发送请求。

# jquery - Jquery Dialogue - 同一页面上的多个

> ID：725841
> 
> 赞同：4
> 
> 时间：2009-04-07T13:53:04.580
> 
> 标签：jquery, jquery-ui

我试图在一个页面上多次实现一个 jquery 对话框 - 基本上，我想在用户点击他们的名字时显示关于一个人的更多信息。

我正在用 php 生成页面。

我试过这样做，并让它部分工作，但我只能让页面上的第一个实例工作。请任何人都可以给我举个例子，因为 UI 页面上的那些不是很有帮助，因为它们会在页面打开时自动弹出。

我没有发布我的代码，因为我认为这不是正确的方法。

提前谢谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-07T14:56:11.760

您需要的所有信息都在 UI 文档页面上，位于标签为“选项”和“方法”的选项卡底部。这些人是您的朋友，他们会（几乎）告诉您小部件可以做的所有事情。例如，

```
<div id="dialog" title="Basic dialog">
    <p>This is the default dialog which is useful for displaying
       information. The dialog window can be moved, resized and
       closed with the 'x' icon.</p>
</div>
...
<a href="" onclick="openDialog('Peter Smith', '<p>Peter Smith likes dirt bike riding, mountain climbing and punk music.</p>'); return false;">Peter Smith</a>
...
<script type="text/javascript">

    $(document).ready( function() {
       $("#dialog").dialog({ autoOpen: false, modal: true });
    });

   function openDialog(title, text) {
        $("#dialog").html(text).dialog('option','title',title).dialog('open');
   }
</script> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-07T14:14:07.540

以下应该是一个有效的例子。

```
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<!-- Above Doctype should provide S mode in Moz, Safari, Opera, IE8 and A (almost standards) in IE6/7 -->
<head>
  <meta http-equiv="Content-Type" content="application/text+html;utf-8"/>

  <title>Sandbox</title>

  <link rel="stylesheet" href="css/screen.css" type="text/css" media="screen" charset="utf-8" />
  <link rel="stylesheet" href="css/print.css" type="text/css" media="print" charset="utf-8" />
  <link type="text/css" href="http://jqueryui.com/latest/themes/base/ui.all.css" rel="stylesheet" />
<style type="text/css">

</style>

<script type="text/javascript" src="http://www.google.com/jsapi"></script>
<script type="text/javascript">
    google.load("jquery", "1.3.2");
    google.load("jqueryui", "1.7.0");
</script>
<script type="text/javascript">
google.setOnLoadCallback(function() {

      $(document).ready(function() {
        $('.more-text').toggle();
        $('.more').click(function() {
            $(this).parent().next('p').dialog();
        })

    });
});
</script>
</head>
<body>
    <div id="container">
        <div id="person-1">
        <p>Short text for person one <a href="#" class="more">Show more</a></p>
        <p class="more-text">This is more of the text</p>
        </div>
        <div id="person-2">
        <p>Short text for person two <a href="#" class="more">Show more</a></p>
        <p class="more-text">This is more of the text with a longer description that
        is supposed to go into a popup</p>
        </div>
    </div>
</body>

</html> 
```

# php - PHP：如何去掉多列行中双引号内的逗号？

> ID：725843
> 
> 赞同：3
> 
> 时间：2009-04-07T13:53:26.747
> 
> 标签：php, regex, csv

我需要一个 PHP 解决方案来摆脱双引号内的逗号。我似乎无法找出使用[`preg_replace`](http://php.net/preg_replace).

我正在将数据从逗号分隔的文本文件插入数据库。

文本文件中的某些列包含用双引号括起来的多个单词。这些双引号里面有逗号，所以当我尝试使用逗号分隔的列将文本插入我的数据库时，它会读取双引号之间的引号并将它们变成列。

以下是文本文件中一行的外观：

```
partname,2035, "this is, desc,ription",qty, "another, description",

```

这就是我尝试将其分开时发生的情况：

```
结果部分名称，2035，这是，描述，翻录，数量，另一个，描述， 

```

这就是我要的：

```
兼职, 2035, 这是描述, 数量, 另一个描述,

```

如您所见，用双引号括起来的部分不应分成单独的列。我不知道如何解决这个问题；有人能指出我正确的方向吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-07T17:18:54.897

伙计们，PHP 已经为此提供了一个函数[fgetcsv](http://php.net/fgetcsv)（从文件中获取逗号分隔值）

```
<?php
$r = array();
$fh = fopen('test.txt','r');
while($t = fgetcsv($fh)) {
    $r[] = $t;
}
var_dump($r); 
```

自 PHP4 时代以来就存在。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-10-01T10:33:14.463

```
function csv_string_to_array($str){
$expr="/,(?=(?:[^\"]*\"[^\"]*\")*(?![^\"]*\"))/";
$results=preg_split($expr,trim($str));
return preg_replace("/^\"(.*)\"$/","$1",$results);
} 
```

这就是诀窍。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-07T13:56:54.087

你想要的是 str_getcsv() 函数。它只在 PHP5.3.0+ 中可用。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-07T14:05:11.710

尝试使用此功能将单行拆分为原始值。它试图处理非常不规则的 CSV

```
function csv_split( $src, $comma = ',', $esc = '\\' ){
    $a = array();
    while( $src ){
        $c = $src{0};
        switch( $c ){
        // permit empty values
        case ',':
            $a[] = '';
            $src = substr( $src, 1 );
            continue 2;
        // ignore whitespace
        case ' ':
        case "\t":
            preg_match('/^\s+/', $src, $r );
            $src = substr( $src, strlen($r[0]) );
            continue 2;
        // quoted values
        case '"':
        case "'":
        case '`':
            $reg = sprintf('/^%1$s((?:\\\\.|[^%1$s\\\\])*)%1$s\s*(?:,|$)/', $c );
            break;
        // naked values
        default:
            $reg = '/^((?:\\\\.|[^,\\\\])*)(?:,|$)/';
            $c = ',';
        }
        if( preg_match( $reg, $src, $r ) ){
            $a[] = empty($r[1]) ? '' : str_replace( '\\'.$c, $c, $r[1] );
            $src = substr( $src, strlen($r[0]) );
            continue;
        }
        // else fail
        trigger_error("csv_split failure", E_USER_WARNING );
        break;
    }
    return $a;
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-07T14:47:44.963

这可能对您有用：

```
$pieces = explode( '"', 'partname,2035, "this is, desc,ription",qty, "another, description",' );

// explode the ones we should split (will be even-# elements)
for ( $i=0; $i<= count($pieces); $i+=2 ) {
    $tmpArray   = explode(",", $pieces[$i]);
    foreach($tmpArray as $value) {
        if ( strlen(trim($value)) > 0 ) {
            $finalArray[] = $value;
        }
    }
}

// now add the ones we shouldn't split inside quotes (odd-# elements)
for ( $i=1; $i<= count($pieces); $i+=2 ) {
    if ( strlen(trim($pieces[$i])) > 0 ) {  
        $finalArray[] = $pieces[$i];
    }
}

// show the result
echo "<pre>";
print_r($finalArray);
echo "<pre>"; 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-07T15:28:45.817

该问题的一般解决方案是在创建行时转义分隔符，然后再用简单的逗号分隔数据。

```
define(SEPARATOR,',');
$dataField = str_replace(SEPARATOR,'BSLASH'.SEPARATOR,$dataField); 
```

请将 BSLASH 更改为反斜杠字符（评论输入框比我更聪明，因为当我尝试编写反斜杠字符时它的行为很奇怪，我不知道如何将其关闭 :)）

当然，如果您从 3rd 方来源接收数据，这不是一个选项。

# c# - 水晶报表最佳实践

> ID：725860
> 
> 赞同：0
> 
> 时间：2009-04-07T13:57:14.710
> 
> 标签：c#, sql-server, sql-server-2005, crystal-reports

我没有太多管理报告的经验，但我在一个这样的应用程序上工作：

有一个界面供用户从报告列表中选择他们想要查看的报告。此列表由数据库中的报告表填充，该表包含报告名称、文件名和报告采用的参数等信息。

这些报告中有几个通用参数——它们是范围或排序——因此用户可能会调出一份关于所有编号为 200 到 4000 的小部件的报告，这些小部件按 Foo 分组。

现在一个人同时开发一个存储过程，和报表文件。他们把它传给我，我必须通过在生产中运行 sproc 脚本并将 .rpt 文件移动到正确的目录来部署它。然后，我必须在报告表中插入一条记录，其中包含名称、文件名和参数。

这是一个后勤挑战，因为没有很好的方法来跟踪哪些报告已部署到哪些系统上（仅仅因为它们存在，并不意味着它们已更新，理想情况下总共有 4 个系统应该匹配），并且有几个可能的故障点：

1) sproc 中的参数与 .rpt 文件中的参数不匹配 2) 报告表中的参数与 .rpt 或 sproc 中的参数不匹配 3) sproc 在 .rpt 文件被更新时更新'不是出于任何原因 4) 当新报告需要一个尚未在参数页面中编码的参数时会发生什么？

这一切都归结为系统不够动态。就像我说的，我不知道报告，但我感觉做报告的人也不知道。似乎必须有更好的方法来保持 sproc 和 .rpt 文件同步，并通过反射之类的东西动态地询问它需要的参数。

这通常是如何处理的？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-13T17:02:36.357

We simply use the default crystal parameter prompting engine. Otherwise, our reporting solution is basically the same as the one you described.

It doesn't make sense to put the parameters into a table. These can be retrieved by loading the ReportDocument and reading the parameters collection. Your prompting engine should look here and then generate the prompts. Otherwise, it's just too much to keep in sync.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-07T14:40:09.787

我不知道“通常”，但我们的应用程序将报告与存储过程 SQL 和可配置参数绑定在一个文件中。然后，我们的报告生成器应用程序可以反序列化从单个包运行报告所需的所有内容。所需的索引仅限于知道要显示给用户的有效文件名列表和相关的友好报告标题。

这是在 C++/MFC 中使用 Stock MFC 序列化完成的；我敢肯定，正如您所说，通过反射和 XML 序列化，在 C#/.NET 环境中将有可能实现更巧妙的解决方案。

# asp.net - 服务器端检测页面显示在 IFrame 中

> ID：725871
> 
> 赞同：10
> 
> 时间：2009-04-07T13:59:01.743
> 
> 标签：asp.net, iframe

是否可以确定 - 服务器端 - 页面是否已加载到`IFrame`?

当我的应用程序中发生某些错误时，用户会被重定向到`Default.aspx`并显示错误消息。该错误消息的文本由异常处理代码在会话中设置。错误消息一旦显示就会从会话中清除。

但是，我的应用程序的一部分必须使用`IFrame`（它正在执行 3D 安全卡支付检查，它要求一个`IFrame`以显示卡提供商的身份验证 UI）。如果在此过程中发生错误，我的重定向将在`IFrame`. 我正在使用 JavaScript 来检测并`Default.aspx`正确重新加载，但这意味着我`Page_Loads`快速连续获得两个，并且错误消息仅显示在第一个上（然后被清除）。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2011-10-19T01:29:56.737

您可以在客户端执行此操作：[如何识别网页是在 iframe 中加载还是直接加载到浏览器窗口中？](https://stackoverflow.com/questions/326069/how-to-identify-if-a-webpage-is-being-loaded-inside-an-iframe-or-directly-into-t)

我找到的解决方法是将一些标识符放入 iframe 中打开的 url 的查询字符串中。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-07T14:09:51.450

我认为您无法检测到某种意义上的 Page.IsInIFrame() 功能，但您可以考虑为加载在 IFrame 中的页面和未加载的页面设置不同的基类您可以知道错误来自对 IFrame 页面的请求，该请求可能在一定程度上有所帮助。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-07T15:00:54.307

从服务器端没有办法。唯一的方法是通过javascript。当您进行重定向时，您可以通过查询字符串传递错误消息或代码吗？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-10T12:32:09.293

使用带有 window.location 的 Javascript 进行重定向不起作用吗？强制整页重定向？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2015-03-14T11:02:32.167

这是不可能的，因为客户端可以在禁用 javascript 的情况下打开 iframe。[http://caniuse.com/#feat=iframe-sandbox](http://caniuse.com/#feat=iframe-sandbox)

* * *

## 回答 #6

> 赞同：-3
> 
> 时间：2015-04-15T17:38:16.360

简单地说，检查当前页面的 url。如果它与 IFrame 页面相同，则重定向到 Default.aspx 或其他。

```
Dim urlpath1 As String = HttpContext.Current.Request.Url.AbsoluteUri
If Right(urlpath1, 13) = "WebForm1.aspx" Then
       Response.Redirect("~/")
   Else
       Response.Write("It's OK!")
   End If 
```

# security - Anti XSS and Classic ASP

> ID：725875
> 
> 赞同：17
> 
> 时间：2009-04-07T13:59:27.777
> 
> 标签：security, asp-classic, xss

I'm currently trying to secure my classic ASP application from XSS. I came across the AntiXSS from Microsoft on the net and I was wondering if this would work with a classic application?

If not do you have any ideas how I could go about sanitizing the strings?

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-04-07T14:05:08.437

To sanitize strings I would HTML encode all output, that way you don't have to dink around with special characters or huge regex expressions

```
Server.HTMLEncode(string) 
```

The two most important countermeasures to prevent cross-site scripting attacks are to:

*   Constrain input.
*   Encode output.

via [How To: Prevent Cross-Site Scripting in ASP.NET](http://msdn.microsoft.com/en-us/library/ms998274.aspx) (i know i'ts not classic asp but there are similar principals)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-07T14:51:41.677

When functions don't exist in classic ASP, write them.

*   [http://snipplr.com/view/12446/add-and-strip-slashes/](http://snipplr.com/view/12446/add-and-strip-slashes/)
*   [http://snipplr.com/view/12207/htmlspecialchars/](http://snipplr.com/view/12207/htmlspecialchars/)
*   [http://snipplr.com/view/10608/striptags/](http://snipplr.com/view/10608/striptags/)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-10-28T19:49:22.750

If you do have to allow certain HTML tags (as I do in my current project), you can use a regex to allow only those tags and no others, like so:

```
set objRegExp = new RegExp
with objRegExp
    .Pattern = "<^((b)|(i)|(em)|(strong)|(br))>.*</.*>"
    .IgnoreCase = varIgnoreCase
    .Global = True
end with
cleanString = objRegExp.replace(originalString, "") 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-07T14:00:57.353

Not easily - you'd need to make a COM-callable wrapper, install on the servers, etc. I simply don't think it is a suitable fit for "classic" ASP.

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2015-07-28T14:40:42.380

```
<% 
Response.AddHeader "X-XSS-Protection", "1" 
%> 
```

# c++ - Xerces/Xalan：UNC 路径作为文档函数的参数？

> ID：725877
> 
> 赞同：0
> 
> 时间：2009-04-07T13:59:37.497
> 
> 标签：c++, c, xml, xslt, xerces

我正在使用 Xerces-C 2.5 和 Xalan-C 1.8 转换 XML 文档。XSL 包含一个“文档”函数，它引用网络上的一个文件。不幸的是，我无法通过 HTTP 访问此文件。我只有UNC路径。

Xerces 拒绝解析引用的文档，因为*WinSockNetAccessor::makeNew*在 Xerces 中被调用，因为“文件”协议只被本地文件接受。*WinSockNetAccessor::makeNew*仅针对 HTTP 实现，抛出异常并忽略文件。

有没有办法欺骗 Xerces，以便在不编写我自己的解析器或操作 Xerces 的情况下接受 unc 路径作为本地文件或任何其他已知的解决方法？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-07T14:01:41.767

我想，一个简单的解决方法是创建一个映射，这样你就可以调用网络驱动器 O: 或其他任何东西。这通常会愚弄不能直接使用 UNC 路径的程序（例如 cmd.exe 本身）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-08T11:23:11.467

XSL 中出现的 UNC 是否有“file:”前缀？

顺便说一句，Xerces C V2.5 已经有好几年了。您是否尝试过目前的最新版本 - V3.0.1？

# php - MySQL和PHP中的空数据库？

> ID：725879
> 
> 赞同：17
> 
> 时间：2009-04-07T13:59:44.767
> 
> 标签：php, mysql

是否可以通过使用 PHP 连接到数据库并发出命令来清空整个数据库？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-04-07T14:09:37.503

如果您有权限，最简单的方法是：

```
删除数据库数据库名称；
创建数据库数据库名称；
使用数据库数据库名称；

```

另一种方法是查询`information_schema`数据库中的触发器、存储的例程（过程和函数）、表、视图以及可能的其他内容，然后单独删除它们。

即使在此之后，您的数据库仍可能与新创建的数据库处于不同的状态，因为它可能具有自定义的默认字符集和排序规则集。用来`ALTER DATABASE`改变它。

随着功能的不断添加（事件...），您将以这种方式进行越来越多的工作。所以真的，完全清空数据库的唯一方法是删除它并重新创建它。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-04-07T14:03:38.610

您可以使用

```
SELECT table_name FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA = 'your db' 
```

并进行截断，

甚至，你可以使

```
SELECT 'TRUNCATE TABLE ' + table_name + ';' FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA = 'your db' 
```

然后迭代结果集，为每条记录执行字符串查询。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2015-08-30T14:33:10.723

您可以获取数据库中所有表的列表 ( `$databaseName`)，遍历所有表，然后应用`TRUNCATE TABLE`到每个表。

```
$result = mysqli_query($link, "SHOW TABLES IN `$databaseName`"); 
while ($table = mysqli_fetch_array($result)) {
    $tableName = $table[0];
    mysqli_query($link, "TRUNCATE TABLE `$databaseName`.`$tableName`");

    if (mysqli_errno($link)) echo mysqli_errno($link) . ' ' . mysqli_error($link);
    else echo "$tableName was cleared<br>";
} 
```

这将清除数据库中所有表的内容，保持结构不变。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-07T14:05:16.563

是的。基本上，您需要获取数据库中所有表的列表，然后遍历该列表并`TRUNCATE TABLE $tablename`为每个条目发出一个。

这看起来是一个不错的实现：[Truncate all tables in a MySQL database](http://david-burger.blogspot.com/2008/02/truncate-all-tables-in-mysql-database.html)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2016-10-05T14:36:49.967

这对我有用。

```
mysql -u < DB-USER > -p<DB-PASS> --silent --skip-column-names -e "SHOW TABLES" <DB-NAME> | xargs -L1 -I% echo 'DROP TABLE `%`;' | mysql -u < DB-USER > -p< DB-PASS > -v < DB-NAME > 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2019-08-14T10:43:05.317

是的。您可以通过分配为变量来连接数据库并截断表。

$conn = new mysqli($servername, $username, $password, $dbname);

$variableName = $conn->query($que);

if ($conn->connect_error) {

die("连接失败：" . $conn->connect_error);

}

$result = $conn->query('TRUNCATE TABLE yourtablename;');

```
if ($result) {

    echo "Request ID table has been truncated";  

   }

   else echo "Something went wrong: " . mysqli_error(); 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2018-11-18T02:34:23.617

```
<?php
    $connection = new mysqli($host, $user, $pass, $db);
    $sql = "SELECT * FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA LIKE '".$db."'";
    $result = $connection->query($sql);
    $tables = $result->fetch_all(MYSQLI_ASSOC);
    foreach($tables as $table) {
        $sql = "TRUNCATE TABLE `".$table['TABLE_NAME']."`";
        $result = $connection->query($sql);
    }
?> 
```

# wpf - WPF：树视图中的自定义 +-

> ID：725883
> 
> 赞同：7
> 
> 时间：2009-04-07T14:00:26.917
> 
> 标签：wpf, treeview

是否可以将 TreeView 控件 (+-) 的内置折叠展开图标更改为我自己的图标？

提前致谢！

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-04-07T14:09:59.017

不幸的是，您需要重新模板`TreeViewItem`才能实现这一目标。此默认样式可能会帮助您入门。请注意需要替换图像的路径。

```
<Style x:Key="TreeViewItemFocusVisual">
  <Setter Property="Control.Template">
    <Setter.Value>
      <ControlTemplate>
        <Rectangle/>
      </ControlTemplate>
    </Setter.Value>
  </Setter>
</Style>
<Style x:Key="ExpandCollapseToggleStyle" TargetType="{x:Type ToggleButton}">
  <Setter Property="Focusable" Value="False"/>
  <Setter Property="Width" Value="19"/>
  <Setter Property="Height" Value="13"/>
  <Setter Property="Template">
    <Setter.Value>
      <ControlTemplate TargetType="{x:Type ToggleButton}">
        <Border Width="19" Height="13" Background="Transparent">
          <Border SnapsToDevicePixels="true" Width="9" Height="9"
                  BorderBrush="#FF7898B5" BorderThickness="1" CornerRadius="1">
            <Border.Background>
              <LinearGradientBrush EndPoint="1,1" StartPoint="0,0">
                <GradientStop Color="White" Offset=".2"/>
                <GradientStop Color="#FFC0B7A6" Offset="1"/>
              </LinearGradientBrush>
            </Border.Background>
            <Path x:Name="ExpandPath"
                  Margin="1,1,1,1"
                  Fill="Black"
                  Data="M 0 2 L 0 3 L 2 3 L 2 5 L 3 5 L 3 3 L 5 3 L 5 2 L 3 2 L 3 0 L 2 0 L 2 2 Z"/>
          </Border>
        </Border>
        <ControlTemplate.Triggers>
          <Trigger Property="IsChecked" Value="True">
            <Setter Property="Data" TargetName="ExpandPath"
                    Value="M 0 2 L 0 3 L 5 3 L 5 2 Z"/>
          </Trigger>
        </ControlTemplate.Triggers>
      </ControlTemplate>
    </Setter.Value>
  </Setter>
</Style>
<Style x:Key="TreeViewItemStyle1" TargetType="{x:Type TreeViewItem}">
  <Setter Property="Background" Value="Transparent"/>
  <Setter Property="HorizontalContentAlignment"
          Value="{Binding Path=HorizontalContentAlignment,
              RelativeSource={RelativeSource AncestorType={x:Type ItemsControl}}}"/>
  <Setter Property="VerticalContentAlignment"
          Value="{Binding Path=VerticalContentAlignment,
              RelativeSource={RelativeSource AncestorType={x:Type ItemsControl}}}"/>
  <Setter Property="Padding" Value="1,0,0,0"/>
  <Setter Property="Foreground"
          Value="{DynamicResource {x:Static SystemColors.ControlTextBrushKey}}"/>
  <Setter Property="FocusVisualStyle" Value="{StaticResource TreeViewItemFocusVisual}"/>
  <Setter Property="Template">
    <Setter.Value>
      <ControlTemplate TargetType="{x:Type TreeViewItem}">
        <Grid>
          <Grid.ColumnDefinitions>
            <ColumnDefinition MinWidth="19" Width="Auto"/>
            <ColumnDefinition Width="Auto"/>
            <ColumnDefinition Width="*"/>
          </Grid.ColumnDefinitions>
          <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition/>
          </Grid.RowDefinitions>
          <ToggleButton x:Name="Expander"
                        Style="{StaticResource ExpandCollapseToggleStyle}"
                        ClickMode="Press"
                        IsChecked="{Binding Path=IsExpanded,
                            RelativeSource={RelativeSource TemplatedParent}}"/>
          <Border Grid.Column="1" x:Name="Bd"
                  SnapsToDevicePixels="true"
                  Background="{TemplateBinding Background}"
                  BorderBrush="{TemplateBinding BorderBrush}"
                  BorderThickness="{TemplateBinding BorderThickness}"
                  Padding="{TemplateBinding Padding}">
            <ContentPresenter x:Name="PART_Header"
                              SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}"
                              HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"
                              ContentSource="Header"/>
          </Border>
          <ItemsPresenter x:Name="ItemsHost" Grid.Column="1" Grid.ColumnSpan="2" Grid.Row="1"/>
        </Grid>
        <ControlTemplate.Triggers>
          <Trigger Property="IsExpanded" Value="false">
            <Setter Property="Visibility" TargetName="ItemsHost" Value="Collapsed"/>
          </Trigger>
          <Trigger Property="HasItems" Value="false">
            <Setter Property="Visibility" TargetName="Expander" Value="Hidden"/>
          </Trigger>
          <Trigger Property="IsSelected" Value="true">
            <Setter Property="Background" TargetName="Bd"
                    Value="{DynamicResource {x:Static SystemColors.HighlightBrushKey}}"/>
            <Setter Property="Foreground"
                    Value="{DynamicResource {x:Static SystemColors.HighlightTextBrushKey}}"/>
          </Trigger>
          <MultiTrigger>
            <MultiTrigger.Conditions>
              <Condition Property="IsSelected" Value="true"/>
              <Condition Property="IsSelectionActive" Value="false"/>
            </MultiTrigger.Conditions>
            <Setter Property="Background" TargetName="Bd"
                    Value="{DynamicResource {x:Static SystemColors.ControlBrushKey}}"/>
            <Setter Property="Foreground"
                    Value="{DynamicResource {x:Static SystemColors.ControlTextBrushKey}}"/>
          </MultiTrigger>
          <Trigger Property="IsEnabled" Value="false">
            <Setter Property="Foreground"
                    Value="{DynamicResource {x:Static SystemColors.GrayTextBrushKey}}"/>
          </Trigger>
        </ControlTemplate.Triggers>
      </ControlTemplate>
    </Setter.Value>
  </Setter>
</Style> 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-24T15:12:39.120

非常感谢你，肯特！这是我的案例的解决方案：

```
<Style x:Key="styleTreeViewExpandCollapse" TargetType="{x:Type ToggleButton}">
  <Setter Property="OverridesDefaultStyle" Value="True"/>
  <Setter Property="Template">
    <Setter.Value>
      <ControlTemplate TargetType="{x:Type ToggleButton}">
        <Image x:Name="image" Source="images/img1.ico" />
        <ControlTemplate.Triggers>
          <Trigger Property="IsChecked" Value="true">
            <Setter TargetName="image" Property="Source" Value="images/img2.ico" />
          </Trigger>
        </ControlTemplate.Triggers>
      </ControlTemplate>
    </Setter.Value>
  </Setter>
</Style>
<Style x:Key="styleTreeView" TargetType="{x:Type TreeViewItem}">
  <Setter Property="Template">
    <Setter.Value>
      <ControlTemplate TargetType="{x:Type TreeViewItem}">
        <Grid>
          <Grid.ColumnDefinitions>
            <ColumnDefinition MinWidth="19" Width="Auto"/>
            <ColumnDefinition Width="Auto"/>
            <ColumnDefinition Width="*"/>
          </Grid.ColumnDefinitions>
          <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition/>
          </Grid.RowDefinitions>
          <ToggleButton Grid.Column="0" x:Name="Expander"
                        Style="{StaticResource styleTreeViewExpandCollapse}"
                        IsChecked="{Binding Path=IsExpanded,
                            RelativeSource={RelativeSource TemplatedParent}}"
                        ClickMode="Press"
                        Width="16" Height="16"/>
          <ContentPresenter Grid.Column="1" x:Name="PART_Header"
                            ContentSource="Header"
                            HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"/>
          <ItemsPresenter x:Name="ItemsHost"
                          Grid.Row="1"
                          Grid.Column="1" Grid.ColumnSpan="2"/>
        </Grid>
        <ControlTemplate.Triggers>
          <Trigger Property="IsExpanded" Value="false">
            <Setter TargetName="ItemsHost" Property="Visibility"
                    Value="Collapsed"/>
          </Trigger>
          <Trigger Property="HasItems" Value="false">
            <Setter TargetName="Expander" Property="Visibility" 
                    Value="Hidden"/>
          </Trigger>
          <MultiTrigger>
            <MultiTrigger.Conditions>
              <Condition Property="HasHeader" Value="false"/>
              <Condition Property="Width" Value="Auto"/>
            </MultiTrigger.Conditions>
            <Setter TargetName="PART_Header" Property="MinWidth" Value="75"/>
          </MultiTrigger>
          <MultiTrigger>
            <MultiTrigger.Conditions>
              <Condition Property="HasHeader" Value="false"/>
              <Condition Property="Height" Value="Auto"/>
            </MultiTrigger.Conditions>
            <Setter TargetName="PART_Header" Property="MinHeight" Value="19"/>
          </MultiTrigger>
        </ControlTemplate.Triggers>
      </ControlTemplate>
    </Setter.Value>
  </Setter>
</Style> 
```

图标 img1.ico 和 img2.ico 是一个箭头。

# objective-c - 自增列

> ID：725884
> 
> 赞同：2
> 
> 时间：2009-04-07T14:00:46.840
> 
> 标签：objective-c, sqlite

在我的表中，我希望有一个唯一的 ID 列，并且它将自动递增。我想从0开始。

我该如何实施？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-04-07T14:04:08.953

基本上，创建一个 INTEGER PRIMARY KEY 类型的列或一个名为 ROWID 的列，然后在插入行时不要指定值。

完整的详细信息[在 Autoincrement 的 SQLite 页面上](http://www.sqlite.org/autoinc.html)。

# php - 使用php通过ajax上传文件

> ID：725888
> 
> 赞同：4
> 
> 时间：2009-04-07T14:01:12.360
> 
> 标签：php, javascript, ajax

我想知道是否可以通过 ajax 和 php 上传二进制文件，并有一个下载链接。我想避免刷新整个页面，就像使用标准 html 表单一样。到目前为止，我一直在使用表单来获取信息，例如单选框和文本框，并使用 javascript 来覆盖默认行为。上传文件是否可以做类似的事情？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-04-07T14:19:45.263

无法通过 Javascript 提交文件。

您的选择是：

*   隐藏的 iframe 技巧，由 Google 推广。自己实现这个可能会导致一些笨拙的东西，所以那里有一些库，比如[jQuery](http://docs.jquery.com/Main_Page)，它有插件，比如 jQuery 流行的[Form Plugin](http://malsup.com/jquery/form/)，可以自动执行此操作，因此您在使用时不必感到内部肮脏。
*   使用 Flash 来促进该过程。最值得注意的是[SWFUpload](http://swfupload.org/)非常受欢迎。在所有条件相同的情况下，我可能会使用 Javascript 解决方案来解决这个问题，但我过去曾成功使用过它。这个解决方案最酷的地方在于它带有更好的界面，例如加载指示器和缩略图等。不过，此时您要求用户使用 Flash + Javascript，这在某些情况下可能不起作用。
*   使用 Silverlight 代替 Flash，尽管我并不认为这是一个可行的解决方案，因为它的渗透率比其他两种解决方案低得多。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-07T14:07:14.657

虽然您不能通过 AJAX 上传文件，但您可以在弹出窗口中放置一个文件控件，然后在弹出窗口关闭时更新生成该弹出窗口的页面。

我不太清楚如何更新产生弹出窗口的页面，但我已经看到它在 ANGEL 学习管理套件中完成。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-07T14:07:52.237

在您的表单上有一个 IFrame (display:none) 并将表单的目标设置为该 iframe。

我的表格如下所示：

```
<iframe id="upload_target" name="upload_target" src="" style="width:0px;height:0px;border:0px solid #fff;"></iframe>
<form enctype="multipart/form-data" name="frmXMLUpload"  target="upload_target" action="scripts/uploadXML.php" method="POST" onSubmit="return checkExtension(fXMLFile.value, 'xml')">
<!--only allow up to 30k of data to be uploaded-->
<input type="hidden" name="MAX_FILE_SIZE" value="30000" />
<input name="fXMLFile" id="fXMLFile" type="file" accept="text/xml" size="50" />
<p><input type="submit" value="Upload" /></p>
</form> 
```

并在您的 IFRAME 中处理响应。基本上这根本不是 AJAX，但谁希望 JavaScript 能够访问您本地计算机上的文件？它的方式很好。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-07T14:03:44.663

仅在 AJAX / Javascript 中通常不可能做到这一点。

看一眼：

[http://www.codeplex.com/SLFileUpload/](http://www.codeplex.com/SLFileUpload/)

一种在silverlight应用程序中执行此操作的方法。

或者：

[http://www.element-it.com/Examples/MultiPowUpload/SimpleUpload.html](http://www.element-it.com/Examples/MultiPowUpload/SimpleUpload.html)

闪现。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-07T14:06:09.603

正如John Gietzen 所说，您不能直接通过AJAX 执行此操作（*即*通过AJAX发送实际数据）。但是，您可以做的是，将您的表单发布到一个不可见的 iframe，然后使用 AJAX 向服务器询问 URL。这将保留基本的用户体验——不刷新页面。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-07T14:15:02.420

你考虑过jquery吗？有很好的插件可以优雅地做到这一点。

比如这个：[http ://www.phpletter.com/Our-Projects/AjaxFileUpload/](http://www.phpletter.com/Our-Projects/AjaxFileUpload/)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-07T14:20:42.970

看看这个例子，我的插件比 phpLetter 的插件好一点，尽管 phpLetter 可能有更好的 PHP 方面的例子。

[http://www.fyneworks.com/jquery/multiple-file-upload/#tab-Examples](http://www.fyneworks.com/jquery/multiple-file-upload/#tab-Examples)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-07T14:30:47.423

您可能还想看看[SwfUploader](http://swfupload.org/)，它使用 Flash 进行文件上传，显示进度条，并且不需要刷新页面。[在这里](http://demo.swfupload.org/v220/index.htm)可以看到示威。

# sql-server - SQL Server T-SQL 错误处理的最佳实践是什么？

> ID：725891
> 
> 赞同：37
> 
> 时间：2009-04-07T14:02:35.073
> 
> 标签：sql-server, sql-server-2005, tsql, error-handling

我们有一个主要用 SQL Server 7.0 编写的大型应用程序，其中所有数据库调用都是对存储过程的。**我们现在正在运行 SQL Server 2005**，它提供了更多的 T-SQL 功能。

在几乎每次 SELECT、INSERT、UPDATE 和 DELETE 之后，@@ROWCOUNT 和 @@ERROR 都会被捕获到局部变量中并评估问题。如果出现问题，请执行以下操作：

*   错误信息输出参数已设置
*   回滚（如有必要）已完成
*   信息被写入（插入）到日志表
*   返回一个错误号，对于这个过程是唯一的（如果是致命的，则为正，如果是警告，则为负）

他们都不检查行（仅在已知时），并且有些与或多或少的日志/调试信息不​​同。此外，行逻辑有时会从错误逻辑中分离出来（在 WHERE 子句中检查并发字段的更新中，rows=0 表示其他人已经更新了数据）。但是，这是一个相当通用的示例：

```
SELECT, INSERT, UPDATE, or DELETE

SELECT @Error=@@ERROR, @Rows=@@ROWCOUNT
IF @Rows!=1 OR @Error!=0
BEGIN
    SET @ErrorMsg='ERROR 20, ' + ISNULL(OBJECT_NAME(@@PROCID), 'unknown') 
                               + ' - unable to ???????? the ????.'
    IF @@TRANCOUNT >0
    BEGIN 
        ROLLBACK
    END

    SET @LogInfo=ISNULL(@LogInfo,'')+'; '+ISNULL(@ErrorMsg,'')+
        + ' @YYYYY='        +dbo.FormatString(@YYYYY)
        +', @XXXXX='        +dbo.FormatString(@XXXXX)
        +', Error='         +dbo.FormatString(@Error)
        +', Rows='          +dbo.FormatString(@Rows)

    INSERT INTO MyLogTable (...,Message) VALUES (....,@LogInfo)

    RETURN 20

END 
```

我正在考虑用 TRY-CATCH T-SQL 替换我们如何做到这一点。我已经阅读了有关[TRY...CATCH (Transact-SQL)](http://msdn.microsoft.com/en-us/library/ms175976(SQL.90).aspx)语法的信息，所以不要只发布一些摘要。我正在寻找任何好的想法以及如何**最好**地执行或改进我们的错误处理方法。它不必是 Try-Catch，只要是使用 T-SQL 错误处理的任何好的或最佳实践。

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2009-04-07T14:09:35.477

您应该阅读以下内容：

[http://www.sommarskog.se/error-handling-I.html](http://www.sommarskog.se/error-handling-I.html)

我不能高度推荐该链接。它有点长，但以一种好的方式。

前面有一个免责声明，它最初是为 SQL Server 2000 编写的，但它也涵盖了 SQL Server 2005+ 中新的 try/catch 错误处理能力。

* * *

## 回答 #2

> 赞同：25
> 
> 时间：2009-04-07T20:28:36.797

我们目前将此模板用于我们执行的任何查询（如果您在例如 DDL 语句中不需要它，您可以省略 Transaction 内容）：

```
BEGIN TRANSACTION
BEGIN TRY
    // do your SQL statements here

    COMMIT TRANSACTION
END TRY
BEGIN CATCH
    SELECT 
        ERROR_NUMBER() AS ErrorNumber,
        ERROR_SEVERITY() AS ErrorSeverity,
        ERROR_STATE() AS ErrorState,
        ERROR_PROCEDURE() AS ErrorProcedure,
        ERROR_LINE() AS ErrorLine,
        ERROR_MESSAGE() AS ErrorMessage

    ROLLBACK TRANSACTION
END CATCH 
```

当然，您可以轻松地将捕获的异常插入到错误日志表中。

它对我们非常有效。您甚至可以使用代码生成（例如 CodeSmith）或一些自定义 C# 代码将一些从旧存储过程自动转换为新格式的过程。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-04-07T15:25:16.463

错误处理没有固定的最佳实践。这一切都取决于您的需求和一致性。

这是存储电话号码的表和存储过程的示例。

```
 SET ANSI_NULLS ON
    GO
    SET QUOTED_IDENTIFIER ON
    GO
    SET ANSI_PADDING ON
    GO
    CREATE TABLE [dbo].[Phone](
        [ID] [int] IDENTITY(1,1) NOT NULL,
        [Phone_Type_ID] [int] NOT NULL,
        [Area_Code] [char](3) NOT NULL,
        [Exchange] [char](3) NOT NULL,
        [Number] [char](4) NOT NULL,
        [Extension] [varchar](6) NULL,
     CONSTRAINT [PK_Phone] PRIMARY KEY CLUSTERED 
    (
        [ID] ASC
    )WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
    ) ON [PRIMARY]

    GO
    SET ANSI_PADDING OFF
    GO
    /**/

    CREATE PROCEDURE [dbo].[usp_Phone_INS]
         @Customer_ID INT
        ,@Phone_Type_ID INT
        ,@Area_Code CHAR(3)
        ,@Exchange CHAR(3)
        ,@Number CHAR(4)
        ,@Extension VARCHAR(6)
    AS
    BEGIN
        SET NOCOUNT ON;

        DECLARE @Err INT, @Phone_ID INT

        BEGIN TRY
            INSERT INTO Phone
                (Phone_Type_ID, Area_Code, Exchange, Number, Extension)
            VALUES
                (@Phone_Type_ID, @Area_Code, @Exchange, @Number, @Extension)
            SET @Err = @@ERROR
            SET @Phone_ID = SCOPE_IDENTITY()
            /* 
                Custom error handling expected by the application.
                If Err = 0 then its good or no error, if its -1 or something else then something bad happened.
            */
            SELECT ISNULL(@Err,-1) AS Err, @Phone_ID
        END TRY
        BEGIN CATCH
            IF (XACT_STATE() <> 0)
                BEGIN
                    ROLLBACK TRANSACTION
                END

            /* 
                Add your own custom error handling here to return the passed in paramters. 
                I have removed my custom error halding code that deals with returning the passed in parameter values.
            */

            SELECT ERROR_NUMBER() AS Err, ISNULL(@Phone_ID,-1) AS ID
        END CATCH
    END 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-04-07T15:02:33.850

看起来你已经很好地处理了这个问题。我怀疑你在做超过 95% 的 SQL 程序员。

你应该在这里找到一些有趣的信息：

*   **[检测和报告存储过程中的错误 - 第 1 部分：SQL Server 2000](http://rwgarrison.com/rg/Writing/ErrorCheckingPart1.htm)**
*   检测和报告存储过程中的错误 - 第 2 部分：SQL Server 2005 TRY-CATCH 块*

一个 [不相关] 建议：开始使用 '<>' 而不是 '!='。

[* SQL Junkies 已经消失，因此第二篇文章不可用。我会尝试在某个地方重新发布它并更新链接。]

# java - 客户端小程序缓存？

> ID：725897
> 
> 赞同：1
> 
> 时间：2009-04-07T14:04:09.890
> 
> 标签：java, caching, jar, applet

是否可以在客户端缓存小程序中使用的 jar 文件？我正在阅读相互矛盾的信息：

*   看来您可以使用`<object>`+设置“缓存”参数`<param>`

然而 -

*   我想`<applet>`这是首选的方式吗？我还没有看到applet 标记的任何类型的缓存属性。

有谁知道缓存jar文件的方法？我的小程序中需要一个大小约为 130kb 的第三方库。

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-07T14:22:31.547

根据[java 插件开发文档](http://java.sun.com/javase/6/docs/technotes/guides/plugin/developer_guide/applet_caching.html)，您可以使用 cache_archive、cache_version 和 cache_archive_ex 参数来缓存您的小程序和第三方库。

这是用法：

```
<OBJECT .... >
<PARAM NAME="archive" VALUE="a.jar">
<PARAM NAME="cache_archive" VALUE="b.jar, c.jar, d.jar">
<PARAM NAME="cache_version" VALUE="0.0.0.1, 0.0.2A.1, 0.3D.22.FFFE">
<PARAM NAME="cache_archive_ex" VALUE="applet.jar;preload, util.jar;preload;0.9.0.AC1, tools.jar;0.9.8.7F">
</OBJECT> 
```

此外，此页面中还有一个警告：

> 使用归档属性指定的 .jar 文件也会缓存在此粘性缓存中。
> 
> 如果此小程序缓存机制对您不起作用，请检查它是否已在其他地方禁用，例如通过 API。确保您没有通过 API 禁用 URLConnection 的缓存： URLConnection.setUseCaches 和 URLConnection.SetDefaultUseCaches

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-09T22:20:40.650

小程序默认缓存在客户端机器上，几乎不需要覆盖它 IMO。

即使使用缓存机制，也不能保证文件会被缓存。缓存控制似乎更多的是关于版本控制 IMO，但在注意到使用它时进度条行为很奇怪后，我将其禁用。

对于版本控制，我只需从包含版本号的 URL 加载 jar。

# hibernate - 当我的实体 bean 中有双 @id 时，如何使用休眠加载我的对象？

> ID：725909
> 
> 赞同：3
> 
> 时间：2009-04-07T14:06:27.590
> 
> 标签：hibernate

```
@Id
int master_id;

@Id
int id; 
```

...这不起作用：

```
User user= (User) session.load(User.class, new Integer(master_id), new Integer(id)); 
```

* * *

```
load(Class theClass, Serializable id) 
```

我用可序列化的对象替换了最后两个参数，但仍然无法检索该对象。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-07T15:50:08.247

好吧，问题解决了`@Embeddable`！

```
@Embeddable
public class UsertId implements Serializable{
    int master_id;
    int id;
    //.....setter &getter
}

//and in the bean, the type for Id should be UsertId
@Id
UsertId id; 
```

# django - Django 模型的动态元属性？

> ID：725913
> 
> 赞同：10
> 
> 时间：2009-04-07T14:07:28.337
> 
> 标签：django, django-models

我正在尝试使用模型继承向我的所有 Django 模型添加一个动态 Meta 属性，但我无法让它工作。我有一个权限，我想像这样添加到我的所有模型中：

```
class ModelA(models.Model):
    class Meta:
        permisssions =(('view_modela','Can view Model A'),)   

class ModelB(models.Model):
    class Meta:
        permisssions =(('view_modelb','Can view Model B'),) 
```

我尝试创建一个像这样的抽象基类：

```
class CustomModel(models.Model):
    def __init__(self, *args, **kwargs):
        self._meta.permissions.append(('view_'+self._meta.module_name, u'Can view %s' % self._meta.verbose_name))
        super(CustomModel,self).__init__(*args, **kwargs)

class ModelA(CustomModel):
    ....

class ModelB(CustomModel):
    ... 
```

但它不起作用。这是正确的方法吗？因为 Django 使用自省来构造模型类，所以我不确定在`__init__()`类的过程中添加权限是否会起作用。每次我访问模型实例时，我当前的实现都会附加另一个权限元组。

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2009-04-07T23:15:40.640

你的直觉是正确的，这是行不通的。在 Django 中，权限存储在数据库中，这意味着：

*   它们需要在运行 syncdb 时在类级别可用以填充 auth_permission 表（并且您的方法需要一个实例，在 syncdb 期间不会创建）
*   即使您确实将其添加到`_meta.permissions`in `__init__`，该`User`对象也不会在任何权限检查调用中获取它，因为这些调用会查阅数据库中的权限表（以及该表的缓存）。

使用继承无法实现您的目标。你在这里真正需要的是一个[Python 元类](https://docs.python.org/3/reference/datamodel.html#metaclasses)。

这个元类在定义之前动态地重写您的`ModelA`和`ModelB`类定义，因此它不需要`ModelA`实例，并且可用于syncdb。由于 Django 的模型首先也使用元类来构建`Meta`对象，唯一的要求是您的元类必须继承自与 Django 模型相同的元类。

这是一些示例代码（Python 2）：

```
from django.db.models.base import ModelBase

class CustomModelMetaClass(ModelBase):

    def __new__(cls, name, bases, attrs):
        klas = super(CustomModelMetaClass, cls).__new__(cls, name, bases, attrs)
        klas._meta.permissions.append(
            (
                'view_{0.module_name}'.format(klas._meta),
                u'Can view {0.verbose_name}'.format(klas._meta))
        )

        return klas

class ModelA(models.Model):

    __metaclass__ = CustomModelMetaClass

    test = models.CharField(max_length=5) 
```

蟒蛇 3：

```
from django.db.models.base import ModelBase

class CustomModelMetaClass(ModelBase):

    def __new__(cls, name, bases, attrs):
        klas = super().__new__(cls, name, bases, attrs)
        klas._meta.permissions.append(
            (
                'view_{0.module_name}'.format(klas._meta),
                'Can view {0.verbose_name}'.format(klas._meta))
        )

        return klas

class ModelA(models.Model, metaclass=CustomModelMetaClass):

    test = models.CharField(max_length=5) 
```

请注意，在这种情况下，权限将仅写入`migrate`. 如果您需要在运行时根据用户动态更改权限，您需要提供自己的[身份验证后端](http://docs.djangoproject.com/en/stable/topics/auth/#writing-an-authentication-backend)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-02-25T12:40:57.480

尝试使用自定义管理器：

```
#create a custom manager
class DynTableNameManager(models.Manager):
    #overwrite all() (example)
    #provide table_name
    def all(self, table_name):
        from django.db import connection
        cursor = connection.cursor()
        cursor.execute("""
            SELECT id, name
            FROM %s
            """ % table_name)
        result_list = []
        for row in cursor.fetchall():
            p = self.model(id=row[0], name=row[1])
            result_list.append(p)
        return result_list

#cerate a dummy table
class DummyTable(models.Model):
    name = models.CharField ( max_length = 200 )
    objects = DynTableNameManager() 
```

像这样使用：

```
f = DummyTable.objects.all('my_table_name') 
```

# .net - 如何在 C# 应用程序中访问二进制资源

> ID：725915
> 
> 赞同：8
> 
> 时间：2009-04-07T14:07:52.173
> 
> 标签：.net, resources

我正在尝试将一个空的 Access 数据库 (.mdb) 作为资源存储在我的应用程序中。然后我想把它写出文件系统并用表定义等填充它。我在 Visual Studio 2005 和我的 C# 应用程序中遇到的问题是无法访问存储在同一个程序集中的资源（我会认为默认情况下可以访问）。这是我的代码：

```
byte[] abytResource;
System.Reflection.Assembly objAssembly = System.Reflection.Assembly.GetExecutingAssembly();
objStream = objAssembly.GetManifestResourceStream("empty.mdb");
abytResource = new Byte[objStream.Length];
objStream.Read(abytResource, 0, (int)objStream.Length);
objFileStream = new FileStream(newDatabasePathWithName, FileMode.Create);
objFileStream.Write(abytResource, 0, (int)objStream.Length);
objFileStream.Close(); 
```

GetManifestResourceStream 返回 NULL 并且根据文档，这是因为资源必须是私有的（因为即使它不存在，也会返回非 NULL 值）。所以我的问题是：

如何让我自己的应用程序可以访问我的资源？顺便说一句，我已经将它添加到项目中并将其标记为“嵌入式资源”。

谢谢！

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-04-07T14:09:26.053

您需要在“empty.mdb”前面加上程序集的默认命名空间。就像是：

```
objStream = objAssembly.GetManifestResourceStream("My.Namespace.empty.mdb"); 
```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-04-07T14:19:49.803

您还可以通过调用来检查资源的名称

```
string[] myResources = objAssembly.GetManifestResourceNames();
foreach(string reso in myResources) {
   Console.WriteLine(reso);
} 
```

此外，请确保您的 empty.mdb 文件在编译操作时标记为 Embedded Resource

[替代文字 http://img520.imageshack.us/img520/6649/sinttuloo.png](http://img520.imageshack.us/img520/6649/sinttuloo.png)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2014-12-03T00:58:10.657

这将提取一个二进制嵌入资源文件...

```
 /// <summary>
    /// Extracts an embedded file to local file system.
    /// </summary>
    /// <param name="resName">Resource name of embedded file. NameSpace.FileName.Extension</param>
    /// <param name="fileName">Extracted file name</param>
    public void ExtractEmbeddedFile(string resName, string fileName)
    {
        if (File.Exists(fileName)) File.Delete(fileName);

        Assembly assembly = Assembly.GetExecutingAssembly();

        using (var input = assembly.GetManifestResourceStream(resName))
        using (var output = File.Open(fileName, FileMode.CreateNew))
        {
            if (input == null) throw new FileNotFoundException(resName + ": Embedded resoure file not found");

            var buffer = new byte[32768];
            int read;
            while ((read = input.Read(buffer, 0, buffer.Length)) > 0)
            {
                output.Write(buffer, 0, read);
            }
            output.Flush();
        }
    } 
```

它对于需要数据文件的 C# 单元测试非常有用，您的 DLL 通常在没有任何内容文件的情况下运行（它们可能在单元测试框架创建的临时文件夹中运行）。

这有另一个文本文件（不是二进制文件）的代码片段，尽管它可能由于未能使用该`using`语句而导致内存泄漏。

*   [http://www.cauldwell.net/patrick/blog/PermaLink,guid,e9a1451b-108c-4da7-8be9-2b6c2316f7b1.aspx](http://www.cauldwell.net/patrick/blog/PermaLink,guid,e9a1451b-108c-4da7-8be9-2b6c2316f7b1.aspx)

# c# - 在一天中的特定时间触发事件的好方法？

> ID：725917
> 
> 赞同：5
> 
> 时间：2009-04-07T14:08:01.783
> 
> 标签：c#, events

我有一个应用程序需要在一天中的特定时间触发几个事件——时间都是由用户定义的。我可以想到几种方法，但没有一个坐得很好。时间不必具有特别高的分辨率 - 每种方式一分钟左右就可以了。

我的想法：

1.  当应用程序启动时读取所有时间并启动计时器，这将在适当的时间打勾

2.  启动一个计时器，每隔一分钟左右检查一次“当前事件”

tia 以获得更好的解决方案。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-07T14:11:43.787

看看[Quartz.Net](http://quartznet.sourceforge.net/)。它是一个调度程序框架（最初用于 Java）。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-07T14:12:01.990

*   存储/索引事件，按下次需要注意的时间排序。这可能在内存中，也可能不在内存中，具体取决于有多少，您进行更改的频率等。如果您的所有事件每天触发一次，则此列表基本上是一个循环缓冲区，仅当用户更改其事件时才会更改。
*   启动一个计时器，该计时器将在列表顶部的事件发生时“滴答”。如果您愿意，可以向上取整到下一分钟。
*   当计时器触发时，处理现在过去的所有事件[编辑-尚未处理]，如有必要，将它们重新插入列表中（即，如果您没有“循环缓冲区”优化)，并设置一个新的计时器。

显然，当您更改事件集或更改现有事件的时间时，您可能需要重置计时器以使其更早触发。通常没有必要将其重置为稍后触发 - 您也可以让它熄灭并且什么都不做。如果您将计时器可以运行的时间上限设置为一分钟（或者只有一个 1 分钟的循环计时器），那么您可以在不重置的情况下获得 1 分钟的精度。这基本上是您的选择2。

可以说你应该使用现有的框架而不是滚动你自己的框架，但我不知道 C#，所以我不知道有什么可用的。我通常对设置 squillions 计时器的想法有点警惕，因为某些环境不支持（或不支持它）。因此，这个方案只需要一个。我不知道 C# 在这方面是否有任何问题，但这个方案可以很容易地安排在必要时使用 O(1) RAM，这是无可匹敌的。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-07T14:11:17.627

这听起来像是 Windows 服务的经典案例。我认为VS2005/2008中有一个Windows Service项目类型。该服务与一个简单的数据库和一个前端应用程序相结合，允许用户设置触发时间，这就是您所需要的。

如果它不会经常更改，计划任务也是一个选项。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-07T14:12:07.577

我已经按照这些思路编写了一些程序。

我建议#2。您需要做的就是保留事件“到期”的时间列表，并且每隔 X 时间量（取决于您的分辨率）检查您的列表中的“现在”事件。如果您可以保证列表已排序，并且列表中的每个事件恰好到期一次，则可以进行一些优化。否则，如果您有重复性事件，则必须确保遮盖窗户。我的意思是，如果你有一个在上午 11:30 到期的事件，并且你每秒钟都检查一次，那么你有可能在 11:29:59 进行检查，然后直到 11:31 再检查一次： 01，由于CPU时间片的不精确。因此，您需要确保其中一项检查（11:29 或 11:31）仍然能够获得 11:30 的命中，并且只有其中一项能够获得（即，您不会同时在 11 点运行： 29 和 11:31)。

这种方法比只检查您知道在您的列表中的时间的优势是允许您的列表在您不知情的情况下被第三方修改，并且您的事件处理程序将继续“正常工作”。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-07T14:12:34.703

最简单的方法可能是使用 Windows 调度程序。

否则，您需要使用其中一个 Timer 类，计算距离第一个事件还有多长时间。与调度程序不同，这种方法允许正在运行的进程找到新事件（并且可能会重置计时器）。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-07T14:13:08.463

#1 的问题是事件之前的毫秒数可能太大而无法存储在 Timer 的间隔中，并且随着事件数量的增加，您的计时器数量可能会变得不合理。

我看不出 #2 有什么问题，但我会选择后台工作人员或线程。

# javascript - js/jQuery Drag'n'Drop，重新计算放置目标

> ID：725938
> 
> 赞同：4
> 
> 时间：2009-04-07T14:11:14.723
> 
> 标签：javascript, jquery, tree

我有以下问题，我有一个大树，它有可以按需折叠和展开的子节点（节点内的数据通过 AJAX 获取）。但是，我使用 jquery.event.drop/drag 来创建我的拖放目标。

但是，当我折叠/展开放置目标更改位置时，我需要重新计算。这就是我想要这样做的方式：

```
function create_drop_targets() {
  $('li a')
    .bind('dropstart', function(event) {
    })
    .bind('drop', function(event) {
    })
    .bind('dropend', function(event) {
    });
} 
```

create_drop_targets() 在折叠/展开时被调用。

但是，这不起作用。我在 jquery.event.drop 中找到了以下内容：

```
var drop = $.event.special.drop = {
    setup: function(){
        drop.$elements = drop.$elements.add( this );
        drop.data[ drop.data.length ] = drop.locate( this );
        },
    locate: function( elem ){ // return { L:left, R:right, T:top, B:bottom, H:height, W:width }
        var $el = $(elem), pos = $el.offset(), h = $el.outerHeight(), w = $el.outerWidth();
        return { elem: elem, L: pos.left, R: pos.left+w, T: pos.top, B: pos.top+h, W: w, H: h };
        } 
```

现在我需要知道如何再次调用 setup() 方法，以便它使用 droppables 的新位置重新填充 $elements。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-25T18:48:18.890

只是有同样的问题。我在 jQuery 的源代码中四处游荡，发现了这个（在 中`ui.droppable.js`）：

```
drag: function(draggable, event) {
  //If you have a highly dynamic page, you might try this option. It renders positions every time you move the mouse.
  if(draggable.options.refreshPositions) $.ui.ddmanager.prepareOffsets(draggable, event);
  ... 
```

所以，你只需要使用

```
$(".cocktails").draggable({
  refreshPositions: true,
}); 
```

似乎没有太多记录......但它解决了我的问题。当然，这会让一切都变慢一些，我建议进行一些依赖于使用的调整（在更改发生之前启用它，并在用户移动鼠标并且发生更改后禁用它）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-07T15:14:24.230

也许添加 jQuery 1.3 中引入的实时事件会更好？

`$("li a").live("dropstart", function(){...});`

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-11-24T17:32:03.080

我意识到原来的问题现在已经很老了，但是我想出的一个小技巧是在没有太多开销的情况下刷新可拖动元素的位置（AFAICT）是在适当的地方禁用并立即重新启用它们。

例如，我注意到调整浏览器窗口的大小不会刷新可拖动表格行的位置，所以我这样做了：

```
$(window).resize(function () {                
    $(".draggable").draggable("option", "disabled", true);
    $(".draggable").draggable("option", "disabled", false);
}); 
```

我希望这可以帮助那里的人！

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-01-15T22:15:34.963

当我尝试将滚动与 liteGrid 中的可拖动行结合起来时，我遇到了同样的问题，但我找到了一种解决方法。您的里程可能会有所不同，但我所做的是向我的拖动事件处理程序添加逻辑，该处理程序将检查网格是否正在滚动（这是我需要强制刷新可放置位置的时候），如果是这样，我设置在可拖动对象上将 refreshPositions 设置为 true。这不会*立即*刷新位置，但会导致它们在下次拖动手柄移动时刷新。由于 refreshPositions 会减慢速度，因此我会在下次触发拖动事件处理程序时重新禁用它。最终结果是 refreshPositions 仅在网格在 liteGrid 中滚动时启用，其余时间禁用。这里有一些代码来说明：

```
//This will be called every time the user moves the draggable helper.
function onDrag(event, ui) {
    //We need to re-aquire the drag handle; we don't
    //hardcode it to a selector, so this event can be
    //used by multiple draggables.
    var dragHandle = $(event.target);

    //If refreshOptions *was* true, jQueryUI has already refreshed the droppables,
    //so we can now switch this option back off.
    if (dragHandle.draggable('option', 'refreshPositions')) {
        dragHandle.draggable('option', 'refreshPositions', false)
    }

    //Your other drag handling code

    if (/* logic to determine if your droppables need to be refreshed */) {
                dragHandle.draggable('option', 'refreshPositions', true);
    }
}

$("#mydraggable").draggable({
    //Your options here, note that refreshPositions is off.
    drag: onDrag
}); 
```

我希望这可以使您免于像我一样多次将头撞到键盘上...

# c# - 如何从 1 个 linq2sql obj 设置属性，该属性由与另一个 obj 的关系填充

> ID：725948
> 
> 赞同：0
> 
> 时间：2009-04-07T14:12:07.670
> 
> 标签：c#, linq-to-sql, orm

我正在使用 Linq2SQL，我对它很陌生。

我有一个 User 表和一个 UserData 表，其想法是可以通过在 UserData 表中添加或删除行来添加/删除 User 对象的属性。我没有想出这个特殊的设计，但我或多或少地坚持下去（只要我能想出一个解决方案）

[替代文字 http://www.86th.org/linq2sqlproblem.jpg](http://www.86th.org/linq2sqlproblem.jpg)

我想在用户对象上填充/绑定“名字”，方法是将值设置为：

```
 UserData.Value WHERE UserData.ItemID == User.UserID AND KeyName = 'FirstName' 
```

同样，姓氏将是：

```
 UserData.Value WHERE UserData.ItemID == User.UserID AND KeyName = 'LastName' 
```

用户数据表说明：

*   UserData.ItemID 是 FK (User.UserID)
*   UserData.KeyName 指定属性的名称
*   UserData.Value 是实际值。

我将如何设置我的用户对象来处理这个问题，以便我可以在这个对象上执行正常的 CRUD 功能并将更改传递到两个表？

~~这甚至可能吗？~~

这是不好的形式吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-07T15:14:44.930

## 快速笔记

我将*UserData*重命名为*ExtendedProperty*，这导致从*User*到*ExtendedProperty*的关系被称为*ExtendedProperties*。

## 变更摘要

1.  在部分*User*类中为*FirstName*和*LastName*创建了一个 getter/setter
**   *从ExtendedProperties*集合中获取正确的*ExtendedProperty*元素，并返回或更新它的*Value*属性。***   重构为可重用的格式，如下所示***

 ***```
partial class User
{
    public string FirstName
    {
        get { return (string)this.getExtendedProperty("FirstName").Value; }
        set { this.getExtendedProperty("FirstName").Value = value; }
    }

    public string LastName
    {
        get { return (string)this.getExtendedProperty("LastName").Value; }
        set { this.getExtendedProperty("LastName").Value = value; }
    }

    // Grab a related property out of the collection, any changes to it will be reflected in the database after a submit
    private ExtendedProperty getExtendedProperty(string KeyName)
    {
        // grab the properties that fit the criterea
        var properties = (from prop in this.ExtendedProperties where prop.KeyName == KeyName select prop);

        // return value
        ExtendedProperty property = properties.SingleOrDefault();

        // if this is a new user then there arent going to be any properties that match
        if (property == null)
        {
            // Define a new item to add to the collection
            property = new ExtendedProperty()
            {
                ItemID = this.UserID,
                KeyName = KeyName,
                Value = String.Empty
            };

            // Add the item we're about to return to the collection
            this.ExtendedProperties.Add(property);
        }

        // either way we have a valid property to return at this point
        return property;
    }
} 

```

我只是希望这不是臃肿/效率低下。

## 编辑

在*getExtendedProperty*中，设置新创建的*User的**FirstName*或*LastName*时会出错，因为它在*ExtendedProperties*集合中没有任何对应的*ExtendedProperty*元素，如下所示。

 ***```
User expected = new User();
expected.UserID = Guid.NewGuid();
expected.UserName = "LJ";
expected.FirstName = "Leeroy";  // It would error here
expected.LastName = "Jenkins"; 
```

因此，我添加了一项检查，以确保如果新项目被请求但当前不在其中，它们会被添加到*ExtendedProperties集合中。*

我还删除了*setExtendedProperty*，因为我觉得这没有必要，而且无论如何只是围绕 1 班轮的一种方法。

在我接受这个答案之前，我真的很感激任何反馈，我会让它坐几天。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-07T15:16:12.883

我个人觉得它的形式不好，但我想每个人都有做事的方法。为什么不能在用户表中分配用户数据？我想我可能不理解这里的设计理念。

# vb.net - 跨会话维护自动完成/建议列表的最佳方式

> ID：725949
> 
> 赞同：2
> 
> 时间：2009-04-07T14:12:14.487
> 
> 标签：vb.net, autocomplete, clickonce, session-variables

我想维护在给定 PC 上应用程序的所有用途中输入到 ComboBox 中的所有字符串的列表，用作该 ComboBox 的 AutoCompleteSource，即我在 ComboBox 中输入“Fred”，提交数据，关闭应用程序，重新打开应用程序，重新打开 ComboBox，键入“F”，接收建议“Fred”。

假设我已经有适当的代码来在内存中创建和维护这样的列表，并在将新元素输入到 ComboBox 等时向其中添加新元素，那么您建议在会话之间保存/加载此数据的最佳方法是什么?

可能的复杂因素：此应用程序将通过 OneClick 部署进行部署，并且每次应用程序启动时都会在线搜索更新。我希望如果应用程序更新，更新完成后列表仍然存在。

谢谢你的帮助。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-07T14:26:15.483

根据您的访问级别，将它们存储在平面文件中似乎是最简单的选择。

*   要读取选项列表，请读取文件并返回一个空列表（如果不存在）。
*   要添加项目，请创建文件（如果不存在），然后附加选项。

这意味着您不会在更新时发送空文件，因此数据可以保留。

看来您可以将文件放在数据目录中或使用独立存储[。](http://msdn.microsoft.com/en-us/library/d8saf4wy.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-07T20:09:14.223

我会简单地使用内置的用户设置（我的项目>设置>选择“用户”作为设置范围）；它们非常容易检索和更新。尽管我没有进行广泛的测试，但我相信它们会通过应用程序更新而保留下来。

您的应用程序是否使用数据库？如果是这样，那将是永久存储的另一种选择。

**编辑**
如果您决定使用“用户设置”选项，这里有一个新[问题](https://stackoverflow.com/questions/729959/clickonce-and-usersettings)，用于解决这些设置和 ClickOnce 的问题。

# java - 如何在 Java 中有效地使用 SAXParseException

> ID：725952
> 
> 赞同：14
> 
> 时间：2009-04-07T14:12:54.627
> 
> 标签：java, validation, xsd, sax, saxparseexception

我正在验证 Java 中的 XMLSchema，并在我有无效的内容模型时抛出 SAXParseExceptions。

我将使用这些异常来突出验证失败的地方 - 但 SAXParseExceptions 似乎有点太低级了。

例如，对于枚举失败，我在一个异常中得到提供的值与内容模型不匹配的有效性错误，以及在下一个异常中应用的元素。

我在想我需要一个实用程序来抽象一点，以将相关错误合并在一起并将异常文本解析为可用的异常属性。

这是一种合理的方法，还是我只是错过了一些东西，或者可能是一个库或帮助类？

* * *

更新@timgilbert，感谢您的回复。

例如，我在 t'internet 上发现的 SAXParseException

```
cvc-pattern-valid: Value 'en' is not facet-valid
with respect to pattern '([a-zA-Z]{1,8})(-[a-zA-Z0-9]{1,8})*' 
```

对我来说关键的事情是

*   此例外适用的元素“en”。为什么我不能调用 exception.getElement() 或其他东西，为什么不能调用相关元素的 XPath？内存文档比行号和列号更有用！
*   这是模式验证失败。为什么我不能得到可能的故障类型的枚举和对适当故障的引用？
*   验证失败的实际模式。
*   接下来会抛出另一个异常来告诉我导致我需要合并的问题的“en”元素的值

我希望能够做的一个例子是让人们提交一个文档并突出显示验证失败的文档并显示用户友好的消息 - 上面的错误消息似乎不太友好......必须解析用单引号感觉就像一场等待发生的事故:)

我想我可能在'reference-to-element'这件事上做错了，也许我应该在默认情况下对文档进行身份转换作为验证的一部分，并使用我的验证错误属性来增加转换可以用 CSS 挑选出来。如果我需要解析消息以使它们更友好，那仍然无济于事......

回复：紧密绑定，javax.xml.validation.Validator.validate() 无论如何都会抛出 org.xml.sax.SAXException - 不知道我该如何摆脱假设绑定......

干杯

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-08T19:22:29.163

我不完全清楚你在这里问什么，也许你可以提供更多关于你的意思的细节太低级的异常？是错误信息本身无法理解吗？

SaxParseException 类确实具有 getColumnNumber() 和 getLineNumber() 方法，您可以将它们呈现给用户以让他们修复错误。

您可能会尝试使用不同的 XML 解析实现 - 每个解析器在发现无效代码时都会抛出错误，但不同的实现可能有不同的错误消息和异常链。

实际上，出于这个原因，我对尝试构建一个检查异常链并尝试从中构建更连贯的错误消息的库持怀疑态度，因为您会将代码相当紧密地耦合到特定细节XML 解析实现（特别是如果您依赖于错误消息的特定措辞）。

（对不起，这不是更具体，也许你可以举一个你看到的问题的例子？）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-12-09T04:38:22.667

Brabster 我也遇到了类似的问题，我需要告诉 xml 中的哪个元素出现错误。我通过在我的 SAX Parser 处理程序中维护一个堆栈来稍微解决了这个问题。在 startElement 方法中，我将 qName（元素的名称）压入堆栈，在 endElement 方法中，我从堆栈中弹出 qName。

每当出现异常时，我的堆栈代表元素的完整 XPath。

唯一的问题是如果有多个具有相同名称的元素，那么您不知道错误是针对哪个元素的。但至少完整的 XPath 细节与 LineNumber 和 ColumnNumber 一起提供了帮助。

希望这可以帮助。

# entity-framework - 如何让实体框架停止设置 rowversion 字段？

> ID：725960
> 
> 赞同：1
> 
> 时间：2009-04-07T14:13:59.913
> 
> 标签：entity-framework, timestamp, rowversion

我使用实体框架，并且我在表上有一个行版本（时间戳）字段用于并发。但是，在更新实体对象时，它不断尝试将 rowversion 列设置为 null，并且出现错误：

无法将“LmpDemoRequest”上的“VerCol”属性设置为“null”值。您必须将此属性设置为“Byte[]”类型的非空值。

我在实体定义中有 VerCol 列，但我无法删除“Setter”函数。

如何让实体框架停止尝试设置此列？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-07T14:18:40.743

您可以为 RowVersion 字段（例如 DateTime.Now）传递任意有效值。它们将被服务器生成的值覆盖。

对于 EF 的未来版本，应该支持“影子属性”，它存在于模型中，但不存在于您的类中。该功能在这种情况下很有用。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-12-11T12:15:00.023

我有一个案例，其中一个视图包含一个表中的 RowVersion 列，该列在视图中被连接在一起......因此该列有时可能为空。

但是 EF4“知道”RowVersion 列不能为空，因此即使在**简单的 LINQ 查询**中，它也会引发 InvalidOperationException：

> 无法将“vVoteInfo”上的“PersonRowVersion”属性设置为“DBNull”值。您必须将此属性设置为 'Byte[]' 类型的非空值

我最后不得不更改视图以将其用于 RowVersion 列，这样 EF 就会很高兴：

```
coalesce(p._RowVersion, cast(0 as binary(6))) [PersonRowVersion] 
```

# perl - 从头开始创建 XS 模块的现代方法是什么？

> ID：725963
> 
> 赞同：17
> 
> 时间：2009-04-07T14:14:26.697
> 
> 标签：perl, perl-xs

我需要为 Perl 编写一个 XS 模块。据我了解，h2xs 今天几乎已被弃用，今天启动 XS 模块的首选方法是什么？我查看了 Module::Starter，但它只处理纯 Perl 模块。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-04-07T14:24:12.947

不，不推荐使用 h2xs。如果您创建许多纯 Perl 模块，Module::Starter 肯定更方便，但没有理由避免使用 h2xs。不过，我建议在使用它之前通读它的文档，这样你就知道你希望它做什么或不做什么。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-08T08:52:03.500

我个人只是使​​用 Module::Starter 并自己添加 .xs 文件。这取决于您的目标是什么：如果您要对 C api 进行一对一的映射，那么 h2xs 可以为您做很多样板文件，但是如果您要制作一个全新的界面，或者当您re 只用 perl 本身（而不是一些外部库）做事，它不会增加太多但麻烦恕我直言。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-04-19T15:42:22.807

就个人而言，每当我开始制作一个新模块时，我只是通过`cp`从我的另一个与其相似的模块中编辑和编辑文件来完成它，并进行适当的编辑。当然，这种方法中没有任何内容表明它必须是我的一种。CPAN 上有很多代码，您可以复制并从中获得灵感……

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-04-08T18:55:18.120

您还应该看看使用[Inline::C](http://search.cpan.org/perldoc?Inline::C)

# linq-to-sql - N-Tiered LinqToSql 问题

> ID：725972
> 
> 赞同：0
> 
> 时间：2009-04-07T14:17:25.147
> 
> 标签：linq-to-sql, n-tier-architecture

我希望你能帮忙。我正在使用 Linq to Sql 开发一个分层网站。我在 DBML 设计器中创建了一个名为 memberState 的新类（或对象）。此对象不是数据库中的实际表。我的中间层有这个方法：

public override IEnumerable(memberState) GetMembersByState(string @state)
{
using (BulletinWizardDataContext context = DataContext)
{
IEnumerable(memberState) mems = (from m in context.Members
join ma in context.MemberAddresses
on m.UserId 等于 ma.UserId
join s在 ma.StateId 上的 context.States
中等于 s.StateId
其中 s.StateName == @state
select new memberState
{
userId = m.UserID,
firstName = m.FirstName,
middleInitial = m.MiddleInitial,
lastName = m.LastName,
createDate = m.CreateDate,
modifyDate = m.ModifyDate
}).ToArray(memberState)();
返回内存；
}
}

我的联接中的表（Members、States 和 MemberAddresses 是我的数据库中的实际表）。我创建了对象 memberStates 以便可以在上面的查询中使用它（注意**Select New memberState**。当网页上的数据更新时，如何将更改保留回成员表？我的成员表由以下列组成: UserId, FirstName, MiddleInitial, LastName, CreateDate, ModifyDate. 我不确定如何将更改保存回数据库。

谢谢，

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-12T13:45:36.667

```
var m = myContext.Members.Single(m=> m.UserID == myMemState.userID);
m.FirstName = myMemState.firstName;
m.MiddleInitial = myMemState.middleInitial;
... 
```

那将是快速的方法。它对数据库进行了额外的往返，但效果很好。如果这对您来说是个问题，那么请按照 Jakob 的建议进行附加。为此，您必须执行一些额外的步骤，例如检查配置以进行乐观更新，并确保在执行附加时拥有原始字段。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-07T14:28:59.563

如果我没记错的话，您可以从不同的表（Members、States 和 MemberAddresses）创建一个视图并将其添加到数据上下文中。然后可以保存对视图对象中数据的任何修改，只要在数据库和数据上下文中明确设置/定义了所有关系，linq to sql 就会正确处理提交。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-07T14:55:09.610

如果您有一个 Member 表，那么 dbml 很可能包含一个 Member 类。要更新数据库中的成员，您必须创建一个新的成员对象，并将其附加到 BulletinWizardDataContext.Members 集合。类似于以下代码的东西应该是诀窍（我没有测试过代码）：

```
using (BulletinWizardDataContext context = DataContext)
{
    Member m = new Member() { UserId = userId };
    context.Members.Attach(m);
    m.FirstName = firstName;
    // Set other properties
    context.SubmitChanges();
} 
```

必须在设置属性之前调用 Attach。此外，在对象的属性设置为默认值的情况下，Linq2Sql 的 Attach 存在一些问题（例如，数值为 0，布尔值为 false，字符串为 null 等）。在这种情况下，Attach 不会生成正确的 SQL。

# c# - 十六进制表示法的 ASCII 值

> ID：725976
> 
> 赞同：0
> 
> 时间：2009-04-07T14:19:03.987
> 
> 标签：c#, hex, pbx

我正在尝试解析来自 PBX 的一些输出数据，但我发现了一些我无法真正弄清楚的东西。在文档中它说以下

> 呼叫类型和功能的信息。“状态信息 3”的八个字符，后面是十六进制表示法的 ASCII 值。
> 
> ```
> 1.性格
> Bit7 来电
> Bit6 呼出
> Bit5 内部通话
> Bit4 CN 调用
> 2.性格
> Bit3 转接电话（转接方在里面）
> Bit2 CN-转接电话（外线转接方）
> 位 1
> 位0
> 
> ```

任何想法如何解释这个？我当时没有可以匹配的原始数据，但我仍然需要弄清楚。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-07T14:24:03.727

您可能会收到两个字符（十六进制数字：0-9，AF）第一个数字表示最高有效 4 位的十六进制值，下一个数字表示最低有效 4 位。

示例：您可能会收到类似字符串“7C”的内容作为位图的十六进制表示：01111100。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-07T14:23:29.797

> “状态信息 3”的八个字符，后面是十六进制表示法的 ASCII 值。

如果认为这意味着以下。

1.  你会得到 8 个字节——我猜每行一个字节。
2.  这只是错误的术语。它们表示每个字节有两个十六进制数字，但称它们为字符。

所以它只是一个带有位标志的字节——或者更准确地说是一个由八个这样的字节组成的数组。

```
Bit

7  incoming
6  outgoing
5  internal
4  CN
3  transfered
2  CN transfered
1  unused?
0  unused? 
```

您可以将其映射到枚举。

```
[BitFlags]
public enum CallInformation : Byte
{
    Incoming     = 128,
    Outgoing     =  64,
    Internal     =  32,
    CN           =  16
    Transfered   =   8,
    CNTransfered =   4,
    Undefined    =   0
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-07T14:24:33.787

没有数据很难。我猜你会得到两个字节（两个 ASCII 字符），并且需要在位级别将它们分开。

例如，如果第一个字符是“A”，则需要查找其字符代码（65 或十六进制 0x41），然后查看位。当然，无论十进制还是十六进制，这些位都是相同的，但是在十六进制中手动操作更容易。0x41 是第 5 位和第 1 位设置，所以这将是一个“内部调用”。第 1 位似乎没有记录。

我不确定为什么看起来好像需要两个字符；它只记录了八位。

# php - 用PHP清除MySQL表中的数据？

> ID：725982
> 
> 赞同：20
> 
> 时间：2009-04-07T14:20:56.073
> 
> 标签：php, mysql

如何使用 PHP 从 MySQL 中的一个表中清除所有条目？

* * *

## 回答 #1

> 赞同：46
> 
> 时间：2009-04-07T14:24:31.477

```
TRUNCATE TABLE tablename 
```

或者

```
DELETE FROM tablename 
```

第一个通常是更好的选择，因为在 InnoDB 上 DELETE FROM 很慢。

实际上，您的[其他问题](https://stackoverflow.com/questions/725879/empty-database-in-mysql-and-php)不是已经回答了吗？

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2009-04-07T14:26:20.133

```
TRUNCATE TABLE table; 
```

是 SQL 命令。在 PHP 中，您将使用：

```
mysql_query('TRUNCATE TABLE table;'); 
```

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2009-04-07T14:46:54.387

```
TRUNCATE TABLE `table` 
```

除非您需要保留 AUTO_INCREMENT 序列的当前值，在这种情况下您可能更喜欢

```
DELETE FROM `table` 
```

虽然如果操作的时间很重要，保存 AUTO_INCREMENT 值，截断表，然后使用恢复值

```
ALTER TABLE `table` AUTO_INCREMENT = value 
```

会发生得更快。

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2014-10-10T04:12:25.320

MySQLI 示例，其中 $con 是数据库连接变量，表名是：mytable。

```
mysqli_query($con,'TRUNCATE TABLE mytable'); 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-04-07T14:21:43.527

```
TRUNCATE TABLE mytable 
```

不过要小心。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2015-09-10T05:46:25.600

TRUNCATE 将使您的表空白并重置主键 DELETE 也会使您的表空白但不会重置主键。

我们可以用于截断

```
TRUNCATE TABLE tablename 
```

我们可以用于删除

```
DELETE FROM tablename 
```

我们也可以给出如下条件

从表名中删除，其中 id='xyz'

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-07T19:36:09.530

实际上，我相信当您删除所有行时，MySQL 优化器会执行 TRUNCATE。

# sharepoint - 如果 SharePoint 已经升级到 3.0，将 TFS 升级到 2008 有什么问题吗？

> ID：725989
> 
> 赞同：0
> 
> 时间：2009-04-07T14:22:07.490
> 
> 标签：sharepoint, tfs

我安装了 WSS 3.0 并将我的 TFS2005SP1 安装指向它。我正在计划我的 TFS 2008 升级。我读到的所有内容都提到在 TFS 升级*后迁移到 WSS3.0。*

是否有任何与已经执行的 WSS 升级相关的问题需要注意？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-07T16:44:58.503

我也处于同样的情况。我有 TFS2008 坐在这里准备好了。我最终的想法是，既然微软*确实*发布了关于如何升级 TFS2005 以使用 WSS3.0 的官方文档（我遵循并完美地工作），那么从 TFS2005 升级到 TFS2008 应该可以顺利进行 WSS3.0已经到位。

我还是有点紧张，你的问题是我第一次在网上找到这个问题。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-09-23T13:46:59.180

我在升级时遇到了问题。输入 Reporting Services 帐户信息后，它将始终以静默方式退出。设置向导的下一页应该是 SharePoint 连接设置。升级时，我没有替换 WSS 2.0 站点，而是并行安装并更改了 TFS 配置中的 SharePoint 端口设置。我认为这是安装失败的原因。

我最终构建了一个具有完全相同规格、计算机名称等的新虚拟机。我没有安装 TFS 2005，而是恢复了 TFS 2005 数据库，然后运行了 TFS 2008 安装程序。它检测并升级了 2005 数据库，一切正常。

# firefox - 是否有允许向网页发送任意 POST 数据的 Firefox 扩展（或任何其他浏览器）？

> ID：725998
> 
> 赞同：23
> 
> 时间：2009-04-07T14:24:30.807
> 
> 标签：firefox, http-post

**我想测试我的网站的安全性，如果**可能的话，我希望有一个能够发送 POST 数据的应用程序。

谢谢

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-04-07T14:28:54.463

尝试[提琴手](http://www.fiddler2.com/fiddler2/)。从他们自己的文档中：

“请求构建器允许您制作自定义请求以发送到服务器。您可以手动创建新请求，也可以从 Web 会话列表中拖放会话以基于现有请求创建新请求。”

[![替代文字](https://i.stack.imgur.com/TDinS.jpg)](https://i.stack.imgur.com/TDinS.jpg)
[（来源：[ifinity.com.au](http://www.ifinity.com.au/Portals/0/images/fiddler-request-detail.JPG)）]

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-04-07T14:29:05.727

是的，我知道有两个：

*   [篡改数据](https://addons.mozilla.org/en-US/firefox/addon/966)

*   [修改标题](https://addons.mozilla.org/de/firefox/addon/967)

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2011-01-17T16:32:16.010

*   [RESTClient](https://addons.mozilla.org/fr/firefox/addon/restclient/ "REST客户端")：面向请求和用户友好（在选项卡中运行，XML 答案着色）

    开发版本（适用于 Firefox 4.b9）在这里：

    https://github.com/chao/RESTClient

*   海报：处理二进制数据 POST（带文件加载）

    https://addons.mozilla.org/fr/firefox/addon/poster/

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2011-04-27T18:59:25.253

一只名为[海报](https://addons.mozilla.org/en-US/firefox/addon/poster/)的火狐正是如此。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-04-07T14:28:30.580

我认为[Fiddler](http://www.fiddler2.com/fiddler2/)会允许这样做。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-04-07T14:29:55.817

我相信 LiveHTTPHeaders 可以做到这一点（[http://livehttpheaders.mozdev.org/](http://livehttpheaders.mozdev.org/)）。

但是您需要先捕获一个实际的 GET/POST 请求，然后单击“Replay...”。在那里，您可以根据需要编辑您的请求（包括标题）。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2011-02-14T19:19:55.763

[HTTP 资源测试](https://addons.mozilla.org/en-US/firefox/addon/http-resource-test)工作正常。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2012-05-03T05:01:28.153

HttpRequester .. 简直太棒了...***************