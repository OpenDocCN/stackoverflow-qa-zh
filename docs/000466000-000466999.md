# StackOverflow 问答 000466000-000466999

# sql-server-2008 - 使用 Xquery 按 XML 类型字段过滤从 SQL Query 返回的行

> ID：466024
> 
> 赞同：0
> 
> 时间：2009-01-21T16:42:22.247
> 
> 标签：sql-server-2008, xquery

我有一个表存储有关发生的错误的数据（通过 SSIS），具有信息的主列存储为 XML。我希望能够在此列中查询名称/值对。

用 SQL 解释：`SELECT * FROM #tmp WHERE seq='7406834'`

示例表：

```
CREATE TABLE #tmp(id INT, category varchar(10), details xml)

    INSERT INTO #tmp(id,category,details) values (1,'cat1','<fields><field name="brnum" value="586" /><field name="qty" value="0" /><field name="seq" value="7406815" /></fields>')  
    INSERT INTO #tmp(id,category,details) values (1,'cat2','<fields><field name="brnum" value="586" /><field name="qty" value="0" /><field name="seq" value="7406817" /></fields>')  
    INSERT INTO #tmp(id,category,details) values (1,'cat3','<fields><field name="brnum" value="586" /><field name="qty" value="0" /><field name="seq" value="7406834" /></fields>')  
    INSERT INTO #tmp(id,category,details) values (1,'cat4','<fields><field name="brnum" value="586" /><field name="qty" value="0" /><field name="seq" value="7406841" /></fields>')

DROP TABLE #tmp 
```

任何人都可以帮助语法。我已经能够基本上使用派生表，将每个元素变成一列，然后查询它，但似乎应该有一种更简单的方式来告诉我每行的所有属性（id、类别、详细信息）有一个 details.seq='xxxxx'。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2010-12-21T20:40:56.903

改变主意，使用 FLWOR :P

```
CREATE TABLE #tmp
    (
      id INT
    , category VARCHAR(10)
    , details XML
    )

INSERT  INTO #tmp
        ( id
        , category
        , details
        )
VALUES  ( 1
        , 'cat1'
        , '<fields><field name="brnum" value="586" /><field name="qty" value="0" /><field name="seq" value="7406815" /></fields>'
        )
INSERT  INTO #tmp
        ( id
        , category
        , details
        )
VALUES  ( 1
        , 'cat2'
        , '<fields><field name="brnum" value="586" /><field name="qty" value="0" /><field name="seq" value="7406817" /></fields>'
        )
INSERT  INTO #tmp
        ( id
        , category
        , details
        )
VALUES  ( 1
        , 'cat3'
        , '<fields><field name="brnum" value="586" /><field name="qty" value="0" /><field name="seq" value="7406834" /></fields>'
        )
INSERT  INTO #tmp
        ( id
        , category
        , details
        )
VALUES  ( 1
        , 'cat4'
        , '<fields><field name="brnum" value="586" /><field name="qty" value="0" /><field name="seq" value="7406841" /></fields>'
        )

DECLARE @val INT = 7406834 

SELECT  *
FROM    #tmp t
WHERE   details.value('(for $f in //field
                        where data($f/@name) = "seq"
                        return 
                          data($f/@value))[1]', 'int') = @val

DROP TABLE #tmp 
```

# c - 将指针传递给C中的递归函数

> ID：466041
> 
> 赞同：1
> 
> 时间：2009-01-21T16:46:39.103
> 
> 标签：c, memory-leaks, recursion

我刚开始学习C的道路上，遇到了一些困难：

下面列出的代码给了我以下错误：

附加到程序：`/workfolder/cocoa/c_stuff/bookshelf/build/Debug/bookshelf'，进程
1674。
无法访问地址 0xa0df194 的内存 无法访问地址 0xa0df194 的内存

```
// code start

#define MAX_NAME_LENGTH 200
#define MAX_AUTHOR_LENGTH 200
#define MAX_DESCRIPTION_LENGTH 1000
#define MAX_PUBLISHER 200
#define MAX_ISBN 50

//structures<
typedef struct {
    char title[MAX_NAME_LENGTH];
    char author[MAX_AUTHOR_LENGTH];
    char ISBN[MAX_ISBN];
    char description[MAX_DESCRIPTION_LENGTH];
    char publisher[MAX_PUBLISHER];
} Book;

void getUserInput(Book *s[])
{   
    printf("what is the book's title ?\n");
    fgets(s[book_count]->title, MAX_NAME_LENGTH, stdin);

    printf("what is the author's name?\n");
    fgets(s[book_count]->author, MAX_AUTHOR_LENGTH, stdin);

    printf("what is the ISBN?\n");
    fgets(s[book_count]->ISBN, MAX_ISBN, stdin);

    printf("write a short description\n");
    fgets(s[book_count]->description, MAX_DESCRIPTION_LENGTH, stdin);

    printf("what is the book's publisher\n");
    fgets(s[book_count]->publisher, MAX_PUBLISHER, stdin);

    printf("want to add another book ? Y\\N\n");

    book_count++;

    if(tolower(fgetc(stdin)) == 'y') 
    {
        return getUserInput(s);
    } 
    else 
    {
        return;
    }
}

int main (int argc, const char * argv[]) {
    // insert code here...
    Book *book_shelf[100];

    if((book_shelf[0] = (Book *)malloc(sizeof(Book))) == NULL)
    {
        exit(1);
    }

    getUserInput(book_shelf);

    return 0;
} 
```

代码编译正确，函数第一次运行良好（所有问题都被问到，结构接收数据）；但是当用户键入“y”来添加另一本书时，就会发生内存错误。

发生错误的任何想法？

提前致谢！

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-01-21T16:53:09.713

您只为 main 中的第一本书分配了内存 - 之后它尝试写入数组中的下一个插槽，该插槽不指向已分配的内存块，从而给您一个 seg-fault。您将不得不为要阅读的每本书分配内存。

此外，由于 C 不知道数组有多长，因此您必须将该信息传递给函数调用。（而且我看不到您在哪里定义 book_count。）

您可以尝试以下方法：

```
void getUserInput(Book *s[], int *book_count, int max_book_count)
{
   if (book_count == max_book_count) return; // If we've filled all the slots, we can't add anymore without causing trouble.
   s[book_count] = malloc(sizeof(Book));

   ..

   if(tolower(fgetc(stdin)) == 'y') 
   {
       (*book_count)++;
       getUserInput(s, book_count, max_book_count);
   } 
   return;
}

int main (int argc, const char * argv[]) {
    // insert code here...
    Book *book_shelf[100];

    int book_count = 0;
    getUserInput(book_shelf, &book_count, 100);
    // Make sure to free all the malloc'd data
} 
```

在这种情况下更好的是，只需使用循环并跳过整个递归步骤。

```
int main (int argc, const char * argv[]) {
    // insert code here...
    Book *book_shelf[100];

    char response = 'y';
    int book_count = 0;
    while (book_count < 100 && response == 'y')
    {
        book_shelf = malloc(sizeof(Book));
        response = getUserInput(book_shelf[book_count++]);
    }
    // make sure to free all the allocated data!
}

char getUserInput(Book *book)
{
   // write input straight to book
   printf("what is the book's title ?\n");
   fgets(book->title, MAX_NAME_LENGTH, stdin);

   ...

   return tolower(fgetc(stdin));
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-21T16:53:42.193

除非我读错了，否则您在将 book_count 用作数组下标之前没有定义它。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-21T16:54:13.253

在 main 中，您在堆栈上分配了一个包含 100 个指向 Book Structure 的指针的数组。我相信您的意图是分配 100 个结构，然后将地址传递给该结构块以获取用户输入

将主要更改为：

```
Book book_shelf[100];
...
getUserInput(book_shelf);
... 
```

编辑：OOPS 错过了前面文章中提到的单 Book malloc。那是正确的第一本书。如果您按上述方式进行编辑并消除 if (book_shelf[0]...) 检查，您将实现预期的结果

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-21T16:56:45.947

1.  您只为第一本书分配空间，而不是为其他人分配空间（主中的 malloc）

2.  我猜缺少一些代码，没有 book_count 的声明和初始化

3.  您应该使用循环而不是递归

4.  对于这种重复，不要使用递归，而是使用循环

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-21T17:02:52.563

对于这个问题，递归可能是矫枉过正的，一个简单的 do { ... } while（用户一直回答是）就可以了。但是，您遇到的问题主要在于您的 Book *book_shelf[100]。有几种方法可以解决这个问题。

首先将其更改为一系列书籍，如 samills 建议的：

```
Book book_shelf[100]; 
```

然后将您的 getUserInput 更改为以下内容：

```
getUserInput(Book *book_shelf, int offset, int length) {
    if(offset < 0 || offset >= length) {
        return;
    }

    //...

    return getUserInput(book_shelf, offset + 1, length)
} 
```

或者您可以使用现有代码并将 getUserInput 函数更改为如下所示并从 main 中删除 malloc：

```
getUserInput(Book *book_shelf) {
     book_shelf[book_count] = (Book*)malloc(sizeof(Book));
     // ...
} 
```

正确使用 sizeof 运算符的道具（我看到那个东西经常被滥用，让我的眼睛流血）。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-21T17:01:34.500

正如在 Josh 的回答中，通过在您的代码中添加以下几行应该使其工作：

> ```
> book_count++;
> 
> if(tolower(fgetc(stdin)) == 'y') 
> {
>     if((book_shelf[book_count] = (Book *)malloc(sizeof(Book))) == NULL)
>     {
>         printf("Cannot allocate memory for Book");
>         exit(1);
>     }
>     return getUserInput(s);
> } 
> else 
> {
>     return;
> } 
> ```

但是，我鼓励您不要使用递归函数来获取输入。递归会导致调试困难。您可以考虑改用普通循环。

**注意：**我假设 book_count 是已初始化为 0 的全局变量

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-21T17:30:36.643

非常感谢您的回复！

我意识到我没有分配足够的内存来处理结构数组的一个以上元素（正是 Josh 所说的）。所以本质上：

书 *book_shelf;

if(book_shelf = (Book*)malloc(sizeof(Book)) == NULL)//退出代码

所以第二次我会遇到内存问题。

再次感谢！

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-29T23:13:17.383

看起来你仍然做错了：

书 *book_shelf;

if(book_shelf = (Book*)malloc(sizeof(Book)) == NULL)//退出代码

book_shelf 只是一个指针的大小。当您执行 malloc 时，您一次只分配一本书。这是错误的。您需要在数组的一个实例中为 Book 对象数组分配连续的内存。

喜欢

书 book_shelf[100];

不是

书 *book_shelf[100];

或使用 malloc，使用指针指向使用
100*malloc(sizeof(Book)) 实例化的数组。

您可能会很幸运，在您的 malloc(sizeof(Book)) 调用之间没有分配其他堆内存，并且内存管理系统默认分配连续内存。此外， book_shelf 将仅指向最后一个分配的 Book 结构，而不是您在原始问题中指出的第一个。

Josh 一次也没有分配足够的内存。如果您想将元素一个接一个地扩展到 book_shelf 的末尾，请使用链表。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2012-01-18T15:47:48.000

带指针和递归的阶乘

```
#include<iostream.h>
#include<conio.h>

int show(int *p)

{

int f;

int x=*p;
if(*p==1)  //boundry checking for recursion

return 1;

else

f=x*show(&(--*p)); //this code is similar to f=x*show(n-1); with non-pointers 

return f;

}

void main()

{

int a=6;

int b=show(&a);

cout<<b;

getch();

} 
```

# c# - 将 Integer 转换为单词字符串

> ID：466042
> 
> 赞同：4
> 
> 时间：2009-01-21T16:46:53.783
> 
> 标签：c#, .net

> **可能重复：**
> [C# 将整数转换为书面数字](https://stackoverflow.com/questions/3213/c-convert-integers-into-written-numbers)

我需要在.NET（具体为3.5）中取一个整数值并将其转换为等效的英文单词（即4 =>“四”，1879 =>“一千八百七十九”）。

我想知道.NET 框架中是否内置了任何东西来进行这种转换。似乎属于那里就足够有用了。我一直找不到任何东西来做这项工作。

如果它没有包含在任何地方的框架中，有没有人有比数字/位置特定查找更优雅的想法？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-17T06:06:42.047

字符串 s 是输入数字

```
 const string input = "1023";

        string[] placement = { "thousand", "hundred", "ten", "" };
        string[] numbersToLetters = { "", "one", "two", "tre", "four", "five", "six", "seven", "eight", "nine" };

        for (int i = 0; i < input.Length; i++)
        {
            int  digits = input[i] != '0' ? (placement.Length - input.Length) + i : 3;
            int result = int.Parse(input[i].ToString());

            var type = placement[digits];
            var number = numbersToLetters[result];
            Console.WriteLine(number + type);
        } 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-21T16:51:20.683

我所知道的没有任何内置的东西。您只需要进行一些数字解析和替换。

我确实在网上找到了一些例子：

[http://www.dotnetspider.com/resources/2743-Code-Convert-numbers-word.aspx](http://www.dotnetspider.com/resources/2743-Code-Convert-numbers-word.aspx) [http://www.codeproject.com/KB/cs/codesamples.aspx](http://www.codeproject.com/KB/cs/codesamples.aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-17T06:04:26.560

没有直接的功能可以为您转换和创建单词形式。你将不得不编写你的程序，基本上你将不得不硬编码所有数字的值，即 1 一、2 二、...、9 九。然后，您还必须处理数十、数百、数千，然后您必须编写逻辑来提取数字并相应地附加单词。

# asp.net - 使用 javascript 为单个 asp 年龄上的多个实例启用/禁用表

> ID：466045
> 
> 赞同：1
> 
> 时间：2009-01-21T16:48:16.337
> 
> 标签：asp.net, javascript, user-controls

我刚刚发布了一个问题，很快就得到了答复，谢谢。

我有一个新问题，因为我有一个 asp 标签，它在实例化过程中动态设置文本，然后我有一个与之相关的 onmousedown 函数调用一个 javascript 函数来启用一个位于显示下方的表格区域 - 默认情况下没有. 在我将其中两个用户控件放在一个页面上之前，一切正常。它们都具有正确的特定标签文本，但启用 javascript 似乎将第一个用户控件表的显示样式属性设置为阻止，而不是位于单击的标签下方的那个。我确定这是因为脚本在客户端运行（我真的很想保留）并且所有用户控件都具有相同的 id 名称（因为它们都是同一个用户控件的实例）所以要设置的 javascript样式显示属性只是获取第一个表。

用户控制asp代码如下：

```
function enableDivArea(objName) {
    document.getElementById(objName).style.display = "block";
}
function disableDivArea(objName) {
    document.getElementById(objName).style.display = "none";
    document.forms[0].submit();
}<asp:Label style="cursor:pointer;color:#EA9156;font-family:Arial,Helvetica,sans-serif;font-weight:bold;" ID="m_emailAddressLabel" onmousedown="enableDivArea('EmailFormDivArea');" runat="server" Text="someone@emailaddress.com"></asp:Label>
<table id="EmailFormDivArea" style="display:none; border-style: outset; border-width: thin">
    <tr>
        <td>To: <asp:Label ID="m_sendEmailToLabel" runat="server" Text=""></asp:Label></td>
        <td align="right"><asp:Label onmousedown="disableDivArea('EmailFormDivArea');" id="m_closeLabel" runat="server" Text="close"></asp:Label></td>
    </tr>
    <tr>
        <td><asp:Label ID="m_fromLabel" runat="server" Text="First Name:" Visible="True"></asp:Label></td>
        <td><asp:TextBox ID="m_firstNameBox" runat="server" Visible="True"></asp:TextBox></td>
    </tr>
    <tr>
        <td><asp:Label ID="Label1" runat="server" Text="Last Name:" Visible="True"></asp:Label></td>
        <td><asp:TextBox ID="m_lastNameBox" runat="server" Visible="True"></asp:TextBox></td>
    </tr>
    <tr>
        <td><asp:Label ID="Label2" runat="server" Text="E-mail:" Visible="True"></asp:Label></td>
        <td><asp:TextBox ID="m_emailBox" runat="server" Visible="True"></asp:TextBox></td>
    </tr>
    <tr>
        <td><asp:Label ID="Label3" runat="server" Text="Phone number:" Visible="True"></asp:Label></td>
        <td><asp:TextBox ID="m_phoneNumberBox" runat="server" Visible="True"></asp:TextBox></td>
    </tr>
    <tr>
        <td><asp:Label ID="Label4" runat="server" Text="Message:" Visible="True"></asp:Label></td>
        <td><asp:TextBox ID="m_messageBox" runat="server" Visible="True" Rows="6" TextMode="MultiLine"></asp:TextBox></td>
    </tr>
    <tr>
        <td colspan="2" align="center"><asp:Button ID="m_sendMessageButton" runat="server" Text="Send Message" 
                        onclick="m_sendMessageButton_Click" /></td>
    </tr>
    <tr>
        <td colspan="2" align="center"><asp:Label runat="server" ID="m_statusLabel" Text="" Visible="true"></asp:Label></td>
    </tr>
</table> 
```

后面的代码如下所示：

```
protected void Page_Load(object sender, EventArgs e)
{
    m_emailAddressLabel.Text = this.Parameter;
    m_sendEmailToLabel.Text = this.Parameter;

} 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-21T17:05:48.627

让表运行在服务器上，并让用户控制实现INamingContainer。构造表的 ID，并在重写的 CreateChildControls 中以编程方式 (HtmlTable) 设置它，例如 string.Concat(ID, "table")。

编辑：您还需要 javascript 中的动态 ID 引用。您可以为此使用一些 <asp:PlaceHolder>，然后从 CreateChildControls 中的代码隐藏中设置它，但可能更容易内联移动这些小脚本，并从代码隐藏中发出脚本，设置客户端属性asp:标签

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-21T18:18:26.140

在 Henk 的最后回复中，我会牢记这一点。

在你们的信息的帮助下，我以一种新的方式“欺骗”了。我动态地向标签添加了一个属性，我希望 javascript 从 Page_Load 事件的 onmousedown 运行，并按照我想要的方式格式化字符串。这是这条线，它工作得非常好（至少是我想要的）。

```
m_emailAddressLabel.Attributes.Add("onmousedown", "enableDivArea('" + EmailFormDivArea.ClientID + "');"); 
```

感谢你的帮助。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-21T17:01:49.447

只是一个快速的想法，表是否都具有相同的 ID？所以脚本只选择它找到的第一个？

使 ID 独一无二！

使用 asp:table 然后

```
onmousedown="enableDivArea('<%=tableName.ClientID%>');" 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-21T17:13:34.260

首先，您可以设置样式的 CssClass 属性。

隐藏：document.getElementById(theIdOfYourTable).style.display = 'none';

启用是一样的

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-21T17:48:38.133

哎呀，对不起，忘记了您不能在服务器标签中使用 <%%> （并且这样做是出于我的想法）。对你来说更好的是这样调用脚本：

```
onmousedown="enableDivArea(this);" 
```

在您的脚本中，您不必再执行 document.getElementById 了，因为您现在已经将元素作为参数。

# asp.net-mvc - 在 .Net MVC 网站上进行自我翻译以支持本地化

> ID：466046
> 
> 赞同：0
> 
> 时间：2009-01-21T16:48:27.227
> 
> 标签：asp.net-mvc, localization, translation

我们是一家初创公司，我们建立了一个 .net 网站，并将其移植到 MVC。我们所有的文本都使用标签添加到站点，以便将来可以使用 Visual Studio 中的工具自动构建资源文件。

我喜欢 Facebook 引入的鼓励社区自我翻译的想法。我想知道是否有人尝试在.Net 世界中实现这样的事情？该界面必须丰富且易于使用，但我猜任何复杂性都存在于审核中，并且可能写入该语言环境的资源文件。我不知道后者是否可能。

任何想法然后给我喊。也许这本身就是一个开源项目。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-09-04T14:50:46.753

www.west-wind.com 上的 Rick Strahl 有一个[数据驱动的本地化资源提供程序](http://www.west-wind.com/presentations/wwDbResourceProvider/)，但我很确定它与网络表单相关。它允许用户在使用应用程序时在浏览器中编辑和保存翻译文本。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-11-21T17:25:14.220

然后我要问的问题是，您如何检查翻译以确保它们正确且有意义。

一个典型的例子是在英国威尔士的路标需要使用英语和威尔士语。需要一个标语，上面写着“HGV 请走这条路”（或类似的）所以英文被发送给翻译人员并及时回复，并制作了标志并贴在路上。说威尔士语的司机最惊讶地看到一个用英语写着“HGV 请走这条路线”的标志，在威尔士语中它说（显然我已经把它翻译回来）“我们都在度假，请在 11 月 10 日之后再次与我们联系”。

翻译与技术无关，而与语言有关。

# ruby - Array.find方法问题

> ID：466048
> 
> 赞同：2
> 
> 时间：2009-01-21T16:49:26.053
> 
> 标签：ruby

我在 ZenTest 源代码中找到了这一行：

```
result = @test_mappings.find { |file_re, ignored| filename =~ file_re } 
```

`@test_mappings`和这里`result`都是 Array 对象，但我没有在 ruby​​ doc 的 Array 类上找到“find”方法。我也在 irb 上试过：

```
irb(main):014:0> Array.respond_to? :find
=> false
irb(main):015:0> [1,2,3].find
LocalJumpError: no block given
        from (irb):15:in `find'
        from (irb):15:in `each'
        from (irb):15:in `find'
        from (irb):15
irb(main):016:0> [1,2,3].find{|x| x>1}
=> 2 
```

谁能给我解释一下？find 方法怎么会返回一个 Array 对象呢？提前致谢。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-01-21T16:57:20.283

`Array`包括`Enumerable`添加[`find`](http://www.ruby-doc.org/core/classes/Enumerable.html#M003153)方法的模块。

在您的示例中，您测试了`Array.respond_to`. 这只会对 的类方法返回 true `Array`。 `find`是一个实例方法，所以`respond_to?`必须在类的实例上调用。

```
>> a = Array.new
=> []
>> a.respond_to? :find
=> true 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-21T19:26:22.867

另一个有时有用的技巧是调用“方法”函数，该函数列出对象实例可用的所有方法，并使用 grep 方法过滤掉特定的东西。它还让您很好地了解基类提供了哪些标准方法，而无需参考文档。

```
a = Array.new
=> []
>> a.methods.grep /find/
=> ["find", "find_all"] 
```

# regex - 正则表达式：通过排除匹配，没有前瞻 - 有可能吗？

> ID：466053
> 
> 赞同：30
> 
> 时间：2009-01-21T16:50:19.190
> 
> 标签：regex, regex-negation

在某些正则表达式风格中，不支持 [负] 零宽度断言（前瞻/后瞻）。

这使得声明排除非常困难（不可能？）。例如“每行*没有*“foo”的行”，像这样：

```
^((?!foo).)*$ 
```

完全不使用环视能否实现相同的目标（暂时搁置复杂性和性能问题）？

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2009-01-21T17:16:53.597

**更新：**正如[@Ciantic 在评论中指出的那样，它“在oo 之前有两个ff”失败了。](https://stackoverflow.com/questions/466053/regex-matching-by-exclusion-without-look-ahead-is-it-possible/466167#comment80765384_466167)

* * *

```
^(f(o[^o]|[^o])|[^f])*$ 
```

**注意：**在客户端否定匹配比使用上面的正则表达式要容易得多。

正则表达式假定每行都以换行符结尾，如果不是，请查看 C++ 和 grep 的正则表达式。

Perl、Python、C++ 和`grep`所有示例程序都提供相同的输出。

*   [perl](http://ideone.com/90iZj)

    ```
    #!/usr/bin/perl -wn
    print if /^(f(o[^o]|[^o])|[^f])*$/; 
    ```

*   [Python](http://ideone.com/3CYA6)

    ```
    #!/usr/bin/env python
    import fileinput, re, sys
    from itertools import ifilter

    re_not_foo = re.compile(r"^(f(o[^o]|[^o])|[^f])*$")
    for line in ifilter(re_not_foo.match, fileinput.input()):
        sys.stdout.write(line) 
    ```

*   C++

    ```
    #include <iostream>
    #include <string>
    #include <boost/regex.hpp>

    int main()
    {
      boost::regex re("^(f(o([^o]|$)|([^o]|$))|[^f])*$");
      //NOTE: "|$"s are there due to `getline()` strips newline char

      std::string line;
      while (std::getline(std::cin, line)) 
        if (boost::regex_match(line, re))
          std::cout << line << std::endl;
    } 
    ```

*   [grep](http://ideone.com/kjO0J)

    ```
    $ grep "^\(f\(o\([^o]\|$\)\|\([^o]\|$\)\)\|[^f]\)*$" in.txt 
    ```

示例文件：

```
foo
'foo'
abdfoode
abdfode
abdfde
abcde
f

fo
foo
fooo
ofooa
ofo
ofoo 
```

输出：

```
abdfode
abdfde
abcde
f

fo
ofo 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2018-05-10T15:18:58.123

遇到了这个问题，并将没有一个完全正常工作的正则表达式作为个人挑战。我相信我已经设法创建了一个适用于所有输入的正则表达式*-*只要您可以使用[原子分组](https://www.regular-expressions.info/atomic.html)/[占有量词](https://www.regular-expressions.info/possessive.html)。

当然，我不确定是否有*任何*风格允许原子分组但不允许环视，但问题询问是否可以在正则表达式中声明不环视的排除，这*在*技术上是可能的：

```
\A(?:$|[^f]++|f++(?:[^o]|$)|(?:f++o)*+(?:[^o]|$))*\Z 
```

解释：

```
\A                         #Start of string
(?:                        #Non-capturing group
    $                      #Consume end-of-line. We're not in foo-mode.
    |[^f]++                #Consume every non-'f'. We're not in foo-mode.
    |f++(?:[^o]|$)          #Enter foo-mode with an 'f'. Consume all 'f's, but only exit foo-mode if 'o' is not the next character. Thus, 'f' is valid but 'fo' is invalid.
    |(?:f++o)*+(?:[^o]|$)  #Enter foo-mode with an 'f'. Consume all 'f's, followed by a single 'o'. Repeat, since '(f+o)*' by itself cannot contain 'foo'. Only exit foo-mode if 'o' is not the next character following (f+o). Thus, 'fo' is valid but 'foo' is invalid.
)*                         #Repeat the non-capturing group
\Z                         #End of string. Note that this regex only works in flavours that can match $\Z 
```

如果出于某种原因，您可以使用原子分组但不能使用所有格量词或环视，您可以使用：

```
\A(?:$|(?>[^f]+)|(?>f+)(?:[^o]|$)|(?>(?:(?>f+)o)*)(?:[^o]|$))*\Z 
```

但是，正如其他人指出的那样，通过其他方式否定匹配可能更实际。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-08-06T17:05:46.087

我偶然发现了这个问题，寻找我自己的正则表达式排除解决方案，我试图*在*我的正则表达式中排除一个序列。

我对这种情况的最初反应： *例如“每行没有“foo”的行”* 只是在 grep 中使用 -v 反转匹配选项。

```
grep -v foo 
```

这将返回文件中与 'foo' 不匹配的所有行

这很简单，我有一种强烈的感觉，我只是误读了你的问题......

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-21T16:57:34.837

您通常可以查找 foo 并从客户端代码中反转正则表达式匹配的结果。

举个简单的例子，假设您想验证一个字符串是否只包含某些字符。

你可以这样写：

`^[A-Za-z0-9.$-]*$`

并接受一个`true`有效的结果，或者像这样：

`[^A-Za-z0-9.$-]`

并接受一个`false`有效的结果。

当然，这并不总是一种选择：例如，有时您只需将表达式放在配置文件中或将其传递给另一个程序。但值得记住。您的具体问题，例如，如果您可以像这样使用否定，则表达式会简单得多*。*

# javascript - 从 JavaScript 调用 VBScript，反之亦然？

> ID：466059
> 
> 赞同：9
> 
> 时间：2009-01-21T16:53:06.873
> 
> 标签：javascript, asp-classic, vbscript

是否可以从[JavaScript调用中调用](http://en.wikipedia.org/wiki/JavaScript)[VBScript](http://en.wikipedia.org/wiki/VBScript)函数，或者从 VBScript 调用中调用 JavaScript？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2011-11-29T17:00:16.243

**从 Javascript 调用 VBScript 函数**

您的 VBScript：

```
Function myVBFunction()
  ' here comes your vbscript code
End Function 
```

你的 Javascript：

```
function myJavascriptFunction(){
  myVBFunction();           // calls the vbs function
}
window.onload = myJavascriptFunction; 
```

**从 VBScript 调用 Javascript 函数**

```
Function myVBFunction()
  myJavascriptFunction()  
End Function 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-21T17:01:37.090

是的，如果您的主脚本是[Windows 脚本文件](http://msdn.microsoft.com/en-us/library/15x4407c.aspx)(WSF)。

WSF 文件可以包含其他脚本文件并执行来自多个引擎的代码。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-26T03:39:59.350

这也可以在 HTA 中通过在调用函数时指定语言来实现，如下所示：

```
<input id="renameIcon" name="renameIcon" type="image" src="images/rename.ico" onclick=renameUser() onmouseover='vbscript: if showStat <> "busy" Then call showStatus(button4.title)' onmouseout='vbscript: if showStat <> "busy" Then call showStatus("")'> 
```

有关更深入的示例，请参见此处：[http ://docs.google.com/Doc?id=ajh85hfcbjj6_457g7v6fgfh](http://docs.google.com/Doc?id=ajh85hfcbjj6_457g7v6fgfh)

# apache-flex - 对 Flex 和 AIR 的 HTML 友好的 RichTextEditor 的建议？

> ID：466061
> 
> 赞同：4
> 
> 时间：2009-01-21T16:53:16.903
> 
> 标签：apache-flex, flash, actionscript, air

作为一个附带项目，为了“好玩”，我分别用 Flex 和 AIR 重写了我的博客和 CMS，虽然到目前为止我对设计非常满意，但一个主要的痛点仍然存在（即比如说对遗留 HTML 内容执行 CRUD 操作，并在浏览器和 Flash 播放器中体面地呈现该 HTML 内容。当然，我可以使用开箱即用的 RichTextEditor 和 TextArea 控件，但两者都倾向于显示和操作简单标记（例如，属性上的单引号或不存在引号、图像对齐等）及其内容默认情况下生成，虽然在 Flash 播放器中呈现精美，但在浏览器中通常看起来很荒谬——对我来说这是一个重要因素，因为我想继续发布 RSS。

我知道那里有几个 RichTextEditor 衍生品，但在与它们中的任何一个一起前进之前，或者在手动操作内容的替代道路上之前，我想我会先在这里对小组进行投票，看看是否有人解决了以前有这个问题；似乎它必须是一个相当常见的用例。

提前感谢您的见解！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-22T19:32:31.827

您遇到的问题是 Flash 本身支持[非常小的 HTML 子集](http://livedocs.adobe.com/flex/3/langref/flash/text/TextField.html#htmlText)。因此，您为适应 Flash 播放器所做的任何编辑都会使其在 HTML 中呈现得更加原始。就我个人而言，我认为在 Flash 中编辑遗留内容和在浏览器和 Flash 中清晰显示的冲突目标将很难解决。

一种替代方法是编写自己的文本布局引擎，就像[Buzzword](https://buzzword.acrobat.com/)团队所做的那样。鉴于他们花了好几个月的时间来制作他们的申请，我怀疑这大大超出了您的计划范围:)

另一种更简单的替代方法是在 HTML 内容上应用服务器端转换器，以将其简化为 Flash 级别。这将使您拥有一个布局丰富的 HTML 文档和一个更简单的 Flash 文档。但是它不会帮助您在 Flash 播放器中编辑它。

如果您想在 Flash 中编辑 HTML，您可以使用 Christophe Coenraets 首次提到并由[Renaun Erickson 更新](http://renaun.com/blog/2006/11/16/157/)的 wmode + iFrame 技巧，为自己提供双实时预览，但您仍然会遇到不同的问题Flash 和浏览器对 HTML 的支持级别。编辑文本字段以手动编辑然后预览您的内容确实不是您想要做的。

最后一个选择是研究新的测试版 [文本布局框架](http://labs.adobe.com/technologies/textlayout/)，它可以帮助您获得一些更广泛的所见即所得的 HTML 部分。这看起来很复杂但功能相当丰富。它适用于 Flex 3.2 / Flex 4 / Flash CS4。当然这是在测试版中，所以将来可能会改变。

顺便说一句，如果您正在构建一个 AIR 应用程序，那么使用现有的 JS+HTML 编辑器（例如 FCKEditor）构建一个 HTML+JS AIR 应用程序可能是一个可行的解决方案？然后您只需要为 Flash 播放器进行渲染（可能使用上面详述的转换器方法）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-21T17:01:09.337

阅读[在 Actionscript 3 项目中显示 HTML](https://stackoverflow.com/questions/260270/display-html-in-an-actionscript-3-project)

它并没有完全回答您的问题（因为它只涉及在 Flash 中*呈现*HTML），但它可能证明是一个有用的起点。

您是否考虑过使用现有的基于 JavaScript 的富文本编辑器之一并将其嵌入到托管在基于 Flash 的应用程序中的 HTML 中？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-03T23:50:22.923

我本人目前正在研究使用[FCKeditor](http://www.fckeditor.net/)作为页面上的弹出窗口来编辑可以在 Flex 组件[htmlwrapper](http://code.google.com/p/htmlwrapper/)中显示的内容。不知道我会走多远，但这是我的见解！

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-17T05:48:11.803

你试过[html tidy](http://tidy.sourceforge.net/)吗？它有一个独立版本，php 也有[tidy 模块](http://www.php.net/manual/en/intro.tidy.php)。

# entity-framework - 实体框架：基于列值的类型？

> ID：466069
> 
> 赞同：2
> 
> 时间：2009-01-21T16:55:29.473
> 
> 标签：entity-framework

如果是标志 IsAdmin，则转换为 AdminUser，否则转换为 NormalUser。

只是对此感到好奇，但不知道该怎么做。我确实看到您可以基于一个表值和另一个表创建一个子对象，例如：

当 Site_User.IsAdmin = true 时，SiteUser 来自表 Site_User AdminUser 来自表 Site_User 和 Admin_User

但是，我很好奇您是否可以这样做：

如果 IsAdmin 为真，则转换为 AdminUser 否则转换为 NormalUser 其中 AdminUser : SiteUSer 和 NormalUser : SiteUser 但没有 Admin_User 表或 Normal_User 表。这严格来说是基于同一个表和一个列值的转换。这些类型不包含其他信息，仅对以下情况有所帮助：

```
SomeMethod(SiteUser someUser)
{
    if(someUser is AdminUser)
    {
       ...
    }
    else
    {
       ...
    }
} 
```

代替：

```
SomeMethod(SiteUser someUser)
{
    if(someUser.IsAdmin)
    {
       ...
    }
    else
    {
       ...
    }
} 
```

现在我意识到这可能不是最好的例子，但是说标志是一个多值属性，而不是：

```
SomeMethod(SiteUser someUser)
{
    swith(someUser.Role)
    {
        case(1):
          break;
        case(2)
          break;
    }
} 
```

当然，无论如何这可能是一个坏主意，但想知道这是否可能。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-21T17:04:21.720

实体框架支持 Table-Per-Type 和 Table-Per-Hierarchy 继承。

Table-Per-Type 意味着每个类都使用一个新表，包括抽象类型。Table-Per-Hierarchy 意味着单个表用于存储多种类型的数据，并且仅从单个表中提取该类型所需的列。

无论哪种方式，都可以按照您描述的方式测试对象。

```
if (someUser is AdminUser)
{
   ...
}
else
{
   ...
} 
```

可以在此处找到有关使用这两种方法的更多信息，并且它们都在实体框架设计器中得到了可视化支持：

[每种类型的表](http://msdn.microsoft.com/en-us/library/bb738685.aspx)

[逐层表](http://msdn.microsoft.com/en-us/library/bb738443.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-21T16:59:48.763

根据经验，检查对象是否是给定类的实例并不是好的做法。尝试改用方法或属性 ( `someUser.isAdmin()`)。

无论如何，我不确定你的问题是什么？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-21T22:54:19.250

看了上面的两篇文章后，我也发现了这一点：

[http://weblogs.asp.net/zeeshanhirani/archive/2008/08/16/single-table-inheritance-in-entity-framework.aspx](http://weblogs.asp.net/zeeshanhirani/archive/2008/08/16/single-table-inheritance-in-entity-framework.aspx)

这给出了我正在尝试做的 UI 示例。不错。

# winapi - 如何在 Win32 中获取特定的 TIME_ZONE_INFORMATION 结构？

> ID：466071
> 
> 赞同：6
> 
> 时间：2009-01-21T16:55:36.883
> 
> 标签：winapi, datetime

Win32 GetTimeZoneInformation 函数返回您在控制面板中设置的系统本地时区。如何获得另一个特定时区？有这样的电话吗？

托尼

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-21T17:04:50.580

据此，不同时区[的](http://msdn.microsoft.com/en-us/library/ms725481(VS.85).aspx)信息存储在注册表中，因此您必须从那里检索信息并自己填充 TIME_ZONE_INFORMATION 结构。

引用自 msdn 文章

```
评论

每个时区的设置都存储在以下注册表项中：

HKEY_LOCAL_MACHINE
     软件
          微软
               视窗
                    当前版本
                         时区
                              时区名称
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2013-06-29T17:34:04.683

代码：

```
#include <stdio.h>
#include <windows.h>

#define pWin32Error(dwSysErr, sMsg )

typedef struct _REG_TZI_FORMAT
{
    LONG Bias;
    LONG StandardBias;
    LONG DaylightBias;
    SYSTEMTIME StandardDate;
    SYSTEMTIME DaylightDate;
} REG_TZI_FORMAT;

#define REG_TIME_ZONES "SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Time Zones\\"
#define REG_TIME_ZONES_LEN (sizeof(REG_TIME_ZONES)-1)
#define REG_TZ_KEY_MAXLEN (REG_TIME_ZONES_LEN + (sizeof(((TIME_ZONE_INFORMATION*)0)->StandardName)/2) -1)

int GetTimeZoneInformationByName(TIME_ZONE_INFORMATION *ptzi, const char StandardName[]) {
    int rc;
    HKEY hkey_tz;
    DWORD dw;
    REG_TZI_FORMAT regtzi;
    char tzsubkey[REG_TZ_KEY_MAXLEN+1] = REG_TIME_ZONES;

    strncpy(tzsubkey + REG_TIME_ZONES_LEN, StandardName, sizeof(tzsubkey) - REG_TIME_ZONES_LEN);
    if (tzsubkey[sizeof(tzsubkey)-1] != 0) {
        fprintf(stderr, "timezone name too long\n");
        return -1;
    }

    if (ERROR_SUCCESS != (dw = RegOpenKey(HKEY_LOCAL_MACHINE, tzsubkey, &hkey_tz))) {
        fprintf(stderr, "failed to open: HKEY_LOCAL_MACHINE\\%s\n", tzsubkey);
        pWin32Error(dw, "RegOpenKey() failed");
        return -1;
    }

    rc = 0;
    #define X(param, type, var) \
        do if ((dw = sizeof(var)), (ERROR_SUCCESS != (dw = RegGetValueW(hkey_tz, NULL, param, type, NULL, &var, &dw)))) { \
            fprintf(stderr, "failed to read: HKEY_LOCAL_MACHINE\\%s\\%S\n", tzsubkey, param); \
            pWin32Error(dw, "RegGetValue() failed"); \
            rc = -1; \
            goto ennd; \
        } while(0)
    X(L"TZI", RRF_RT_REG_BINARY, regtzi);
    X(L"Std", RRF_RT_REG_SZ, ptzi->StandardName);
    X(L"Dlt", RRF_RT_REG_SZ, ptzi->DaylightName);
    #undef X
    ptzi->Bias = regtzi.Bias;
    ptzi->DaylightBias = regtzi.DaylightBias;
    ptzi->DaylightDate = regtzi.DaylightDate;
    ptzi->StandardBias = regtzi.StandardBias;
    ptzi->StandardDate = regtzi.StandardDate;
ennd:
    RegCloseKey(hkey_tz);
    return rc;
}

#define ZONE "Russian Standard Time"

int main(int argc, char* argv[])
{
    DWORD dw;
    TIME_ZONE_INFORMATION tzi;
    dw = GetTimeZoneInformationByName(&tzi, ZONE);
    if (dw != 0) return 1;
    SYSTEMTIME lt;
    SYSTEMTIME ut = {
        2000, /*WORD wYear;*/
        1, /*WORD wMonth;*/
        0, /*WORD wDayOfWeek;*/
        1, /*WORD wDay;*/
        12, /*WORD wHour;*/
        0, /*WORD wMinute;*/
        0, /*WORD wSecond;*/
        0 /*WORD wMilliseconds;*/
    };
    SystemTimeToTzSpecificLocalTime(&tzi, &ut, &lt);

    printf("%d-%02d-%02d %02d:%02d:%02d UTC\n", ut.wYear, ut.wMonth, ut.wDay, ut.wHour, ut.wMinute, ut.wSecond);
    printf("=\n");
    printf("%d-%02d-%02d %02d:%02d:%02d Europe/Moscow\n", lt.wYear, lt.wMonth, lt.wDay, lt.wHour, lt.wMinute, lt.wSecond);
    return 0;
} 
```

# architecture - 适应不断变化的业务需求？

> ID：466081
> 
> 赞同：2
> 
> 时间：2009-01-21T16:58:07.737
> 
> 标签：architecture, design-patterns

关于如何开发能够适应不断变化的业务需求的软件的想法？任何模式、架构等。可能一些轶事示例会很棒。这更像是一个调查，而不是一个具体的问题。谢谢

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-21T17:01:15.953

您将想了解更多关于整个[敏捷开发](http://en.wikipedia.org/wiki/Agile_development)运动的信息。敏捷正如它所说的：能够快速适应。

*   [罗伯特 C. 马丁 2002 年的著作 - 经典之作。](https://rads.stackoverflow.com/amzn/click/com/0135974445)

*   [C# 中的敏捷——这就是我使用的](https://rads.stackoverflow.com/amzn/click/com/0131857258)

*   [看这个书单](http://www.amazon.com/gp/series/93347/ref=s9_kser_t1_ser?pf_rd_m=ATVPDKIKX0DER&pf_rd_s=top-1&pf_rd_r=11MHW4FJ97DDXJY3X0J0&pf_rd_t=301&pf_rd_p=447162401&pf_rd_i=Agile%20development%20C%23)

*   你会想阅读[敏捷宣言！](http://agilemanifesto.org/)

*   还有一个：[Kent Beck 的工作](https://rads.stackoverflow.com/amzn/click/com/0321146530)——尤其是测试驱动开发。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-21T17:01:44.423

在我看来，*特定*代码比*通用*代码和*抽象*代码更容易改变。因此，如果您想要可更改的代码，请坚持使用特定代码并避免元编程。

从现在开始的 6 个月后，很可能没有人会理解那些通用和抽象方法的真实用例，并且害怕改变它们。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-21T17:08:36.470

如果这是您的开发环境，您将希望使用[***敏捷开发过程。***](http://en.wikipedia.org/wiki/Agile_software_development)

作为此过程的一部分，您可能希望不断有一个工作系统向您的客户展示，以便他们可以在此过程中进行路线更正。这将帮助他们了解正在取得的进展以及您所处的位置。但更重要的是，这将使他们更好地了解系统如何与当前的业务需求一起工作，以及他们的新变化将产生什么影响。

***请注意不要让您的原型在视觉上吸引人。***如果一个原型在图形上看起来很精致，那么您的业务开发人员很有可能会认为该软件比实际情况要完整得多。相反，我建议尝试让它看起来不那么精致，并更多地关注功能。例如，如果您在 Java Swing 中工作，那么有一个很棒的[外观和感觉称为 Napkin](http://napkinlaf.sourceforge.net/)可以帮助您解决这个问题。IT 允许您构建尽可能多的功能，但屏幕看起来就像是在餐巾纸上绘制的。所以人们的注意力和焦点是功能，而不是图形细节。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-21T17:04:07.210

试图设计一个可以轻松适应不断变化的需求的通用系统是行不通的。正如 Mark 所暗示的那样，整个敏捷运动都源于这样一种认识，即简单的特定代码比通用代码更容易适应，只要它编写得好且可维护。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-21T21:21:36.113

[领域驱动设计](http://domaindrivendesign.org/books/index.html)是一个很好的方法，有一本好书可以帮助你前进。

这种方法的一个重点是软件中使用的开发领域模型与它所建模的实际“现实世界”之间的紧密反馈循环，因此不断变化的现实世界是可以的。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-21T17:04:31.407

（几乎）每个程序都有不断变化的业务需求。尝试与客户谈判（营销或产品经理也是客户）很重要，但还不够。需求总是变化的。Scrum 有很多技术来管理需求的变化。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-21T17:52:39.343

考虑业务需求变化的规模：

*   如果小规模需求经常变化，即人们改变了他们想要什么的想法，但他们需要做的事情并没有真正改变，那么采用敏捷实践并保持你的迭代非常短（如果需要，短至 1 个特征迭代）真正去完成某事！）
*   如果更大规模的需求经常发生变化，即运营业务需要什么基础设施，这可能反映了管理层的突发奇想（我认为是“最后一个推销员综合症”——无论最后一个推销员在卖什么，都突然变成了 The Way的未来）。如果您参与这些决策，请尝试将技术问题减少到基础（通信、存储、计算、交互、访问……），并且不要被产品级的花里胡哨分散注意力。请记住，没有什么事情可能是 100% 适合的，但是过于频繁地改变主意的成本可能会超过改变平台或架构的好处。如果您没有参与这些决定，那么除了快速学习并在可能的情况下温和地鼓励更深入的承诺之外，您无能为力；-)
*   如果业务的性质经常变化，即每隔几周就需要新的业务线，合并旧的业务线等，并且您参与了这个级别的讨论，您可以尝试通过更深入地探索来预测未来的变化公司计划。如果您没有参与到这个级别，请尽量保持灵活和无价，直到您找到一家更稳定的公司的工作;-)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-21T17:58:23.950

考虑一个业务规则引擎。并不总是合适的，但可以帮助将业务逻辑和需求与您的技术架构/解决方案分开。例如，假设您需要根据一组测试结果设置汽车的安全等级。对汽车进行的测试可能会改变，分类标准也会改变（包括分类的实际数量，例如从 5 星系统到 10 星系统）。在这种情况下，业务规则引擎可能是对汽车进行分类的好方法。

规则引擎将提供基于文本或 XML 的规则，至少在理论上，这些规则可以由非编程人员（例如业务分析师）编写和维护。这些规则将应用于`Car`对象（假设`Car`对象包含对对象的引用`TestResults`）。规则/规则引擎将分析测试结果并相应地设置对象的`SafetyClassification`属性`Car`。

实际规则可以驻留在数据库或共享位置中，甚至可以通过消息传递基础架构或 Web 服务调用提供给系统。可以将新规则提供给系统并激活，而无需重新编译/重新部署系统。

不同的技术有不同的规则引擎可用。例如，.Net 有 Drools.Net、WWF 规则引擎，以及其他一些。Java 有 JBoss 规则以及许多其他规则。

# ruby - 为 Ruby 设置开发服务器

> ID：466085
> 
> 赞同：6
> 
> 时间：2009-01-21T16:59:54.597
> 
> 标签：ruby, development-environment

我想为 Ruby 制作一个开发服务器。（我已经为 IIS 和 LAMP 设置完成了这项工作，但我并不精通它。）除了实际的服务器（我已经拥有）之外，我还需要什么？还有任何安全问题吗？我知道我可以在我的机器上进行本地开发，但不想这样做。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-21T17:17:15.203

首先，在进行 ruby​​ 开发时，首先要知道的是它在类似 unix 的环境中效果最好，所以 mac os x、linux、solaris、bsd 等...

Ruby 库作为 gem 分发和打包。因此，您需要安装 ruby​​ 并安装 ruby​​gems。然后从那里你使用`gem`安装 ruby​​ 库的命令。

我假设您正在谈论使用 ruby​​ on rails 2.x 或 Merb 1.x 进行 Web 开发。这两个框架将在下一个版本中合并，称为 Rails 3.0。所以这里的答案适用于任何一个。我要说 Rails，但我的意思是 Rails/Merb。

Rails 开发是在您的机器上本地完成的。所以你需要在本地安装 ruby​​ 和所有你需要的库。我知道许多使用 Windows 的人最终会使用虚拟化并在他们的桌面 windows 框中为 rails 运行 linux 环境。

在开发中，大多数人使用应用服务器 Mongrel。在生产中，当前的标准是使用 Apache 2 和 Passenger。

使用 Rails，您将需要使用源代码控制。现在大多数人在 Rails 社区中使用 git，但也可以使用 subversion、perforce 或许多其他 SCM。为了将您的应用程序从源代码控制转移到暂存和生产系统，rails 社区创建了一个名为 Capistrano 的应用程序。它处理部署。您设置您的服务器信息、ssh 密钥、定义访问权限，然后您可以使用单个命令发布您的应用程序。

```
cap deploy 
```

这是一个相当不错的系统。几年前，当我在 odeo.com 工作时，我们有人使用 windows、linux 和 mac 进行开发，并将生产部署到 debian linux。我们的应用程序不是故意的跨平台，它只是这样工作，因为我们有想要添加到它的人，包括设计师和商业类型，他们在 Windows 上。

我强烈建议您查看[http://guides.rubyonrails.com](http://guides.rubyonrails.com)了解更多信息。

# c# - 调用 Web 服务时出现“内存不足”异常

> ID：466089
> 
> 赞同：2
> 
> 时间：2009-01-21T17:01:10.803
> 
> 标签：c#, asp.net, web-services

我有一个调用 .NET DLL 的 ASP.NET Web 应用程序，它又调用 Web 服务。Web 服务调用引发异常：

> 无法生成临时类（结果=1）。错误 CS0001：内部编译器错误 (0xc00000fd) 错误 CS0003：内存不足
> 
> 堆栈跟踪：在 System.Xml.Serialization.Compiler.Compile(Assembly parent, String ns, XmlSerializerCompilerParameters xmlParameters, Evidence evidence)
> 在 System.Xml.Serialization.TempAssembly.GenerateAssembly(XmlMapping[] xmlMappings, Type[] types, String defaultNamespace, Evidence evidence, XmlSerializerCompilerParameters parameters, Assembly assembly, Hashtable assembly) at System.Xml.Serialization.TempAssembly..ctor(XmlMapping[ ] xmlMappings、Type[] 类型、String defaultNamespace、String location、Evidence evidence) at System.Xml.Serialization.XmlSerializer.GetSerializersFromCache(XmlMapping[] mappings, Type type) at System.Xml.Serialization.XmlSerializer.FromMappings(XmlMapping[]映射，类型类型）在 System.Web.Services.Protocols.SoapClientType..ctor（类型类型）在 System.Web.Services.Protocols.SoapHttpClientProtocol..ctor()

我应该提一下，这是我第一次在这台 PC 上执行这段特定的代码（我最近重新格式化/重新安装了 Windows）——这让我认为这是环境问题（同一个应用程序在我们的测试和生产服务器）。但我对原因感到困惑。

* * *

一些额外的细节来回答后续问题：

*   这是一台真正的 PC（不是 VM）。
*   我在 IIS 7 上运行 .NET 3.5。我们的生产服务器是 IIS 6，但它之前在 IIS 7 上运行正常。
*   PC 有 2 GB 的 RAM，并且有很多免费的。
*   我没有更改任何 machine.config 设置，也没有更改任何与进程模型、编译、内存使用等相关的 web.config 设置。
*   本地 IIS_IUSRS 组对“Temporary ASP.NET Files”文件夹具有读/写权限。
*   我检查了应用程序池设置：私有内存和虚拟内存都设置为 0（无限制）。

工作进程的内存使用情况：

*   我回收了工作进程以获得一个干净的状态，然后在应用程序中点击一个 ASP.NET 页面......任务管理器显示已使用 22 MB。
*   然后我点击了进行 Web 服务调用的事件，内存使用量猛增到大约 150 MB，趋于平稳，然后我得到了异常。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-21T17:16:41.787

感谢您添加更多详细信息。

看看这个链接： http: [//support.microsoft.com/](http://support.microsoft.com/?kbid=908158)
?kbid= 908158 这与您遇到的问题类似。

它建议如下： 要解决此问题，请授予用户帐户对 %windir%\Temp 文件夹的列出文件夹内容和读取权限。

这个：
[http ://club.workflowgen.com/scripts/club/publigen/content/templates/show.asp?P=53&L=EN](http://club.workflowgen.com/scripts/club/publigen/content/templates/show.asp?P=53&L=EN)

建议：
为避免此问题，请将 Temp 文件夹的读/写权限授予 ASPNET 帐户。当 ASP.NET Web 服务处理 WebMethods 时，最常用于访问系统 Temp 文件夹的身份是本地 ASPNET 帐户，这是运行 ASP.NET 应用程序的默认帐户。

但是，如果您已将应用程序配置为在其 Web.config 文件中使用模拟，则线程也可以使用任何调用者的身份。如果是这种情况，所有潜在的调用身份都必须具有对 Temp 文件夹的读/写权限。一个可能的调用身份是 Internet 信息服务 (IIS) 应用程序的匿名帐户（通常是 ISUR_xxx 帐户）。该线程还可以使用 IWAM_xxx 帐户或 NETWORK SERVICE。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-21T21:39:38.060

好吧，我不确定**为什么**会这样（这令人沮丧），但我确实想出了一些东西......

我之前安装的 Windows 是 32 位的，但是当我最近重建我的 PC 时，我选择了 64 位版本。因此，我将 IIS 应用程序池中的“启用 32 位应用程序”设置更改为“True”，现在一切似乎都运行良好。

DLL 和网站本身被配置为编译为“任何 CPU”，因此它们不应该在 Win64 上造成任何问题。而且“内存不足”错误仍然有点令人困惑（并且无益）。如果有人有任何想法，您将获得“接受”积分。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-21T18:57:18.417

它正在尝试编译，是否需要对某些临时目录进行可写访问。

# asp.net - ASP.Net：如何正确实现此身份验证流程

> ID：466108
> 
> 赞同：0
> 
> 时间：2009-01-21T17:04:54.777
> 
> 标签：asp.net, windows-authentication, basic-authentication

这是我正在寻找身份验证的流程：

1.  尝试从 Windows 身份验证中提取用户名
2.  如果失败（用户在网络外部），请使用 BASIC 身份验证来获取用户名/密码。
3.  根据 SQL 数据库检查用户名/密码。如果是windows，不需要密码，如果BASIC认证和密码错误，再次提示
4.  使用用户名创建 Identity 对象，并通过另一个 SQL 数据库调用填充用户的角色

这将需要用于多个应用程序。

实现这一点的最佳方法是什么？创建一个 HTTP 模块？如果是这样，我需要记住什么（安全性、虚拟目录设置等）

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-21T17:47:27.077

这种类型的身份验证称为混合模式身份验证（一些谷歌搜索会得到很多点击）。我们在我工作的网站上运行过这种方式，但是我们的设置有一些怪癖，与奇怪的业务需求有关。

这里有一篇文章可能会让你继续讨论这个主题： [http ://www.15seconds.com/Issue/050203.htm](http://www.15seconds.com/Issue/050203.htm)

在一篇文章中详细说明如何设置它是一个很大的话题。

祝你好运！

# apache-flex - 我需要 Flex Builder 吗？

> ID：466111
> 
> 赞同：13
> 
> 时间：2009-01-21T17:05:27.613
> 
> 标签：apache-flex, flexbuilder

我对 Flex 完全陌生。

我是否可以单独使用 Flex SDK 开发一个中等复杂的应用程序，或者我是否需要 Flex Builder？

此外，除了 SDK，我还需要什么才能开始使用？

谢谢你的帮助。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-01-21T17:07:34.147

一两年前我在那里，所以这是我的经验。按子问题排序：

> 我对 Flex 完全陌生。

我也是 Flex 的新手 - 和 Actionscript（虽然它是 javascript 的超集，我非常了解；虽然它对我来说确实不像 javascript）。

> 我是否可以单独使用 Flex SDK 开发一个中等复杂的应用程序，或者我是否需要 Flex Builder？

也许，如果您已经非常了解 Flash 和 Actionscript。我没有，所以我发现它确实有帮助。但这与任何其他 IDE-or-not 决定没有任何不同。

> 此外，除了 SDK，我还需要什么才能开始使用？

没什么，除非你想用AIR，这只是一个简单的下载。其他的都在里面。我对自己的经历非常满意；没有不愉快的惊喜，你问的问题和我一样。YMMV。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-01-21T17:16:16.623

您不需要 FlexBuilder 来开发 Flex 应用程序，我使用：

*   弹性 SDK
*   您选择的编辑器（我在 Linux 上使用 emacs，Notepad++ 在 Windows 中可以很好地处理 ActionScript）
*   Ant（Flex SDK 自带 Ant 任务）

我写了一篇关于如何设置 Flex 开发环境的完整博客文章：

[http://blog.apterainc.com/software/setting-up-a-flex-development-enviroment-in-gnulinux/](http://blog.apterainc.com/software/setting-up-a-flex-development-enviroment-in-gnulinux/)

虽然我写了关于在 Linux 中设置这个环境的博客，但大部分步骤都可以直接转移到 Windows 环境中。

**至于其他海报：**在 Flex 中开发 GUI 组件与使用 HTML 设计网页没有什么不同或更难。如果您需要一个所见即所得的编辑器，那么您对 ​​Flex 或 HTML 的了解还不够。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-01-21T17:24:28.760

您不需要它，但它可能会有所帮助。

我发现[FlashDevelop](http://flashdevelop.org)是用于编写 ActionScript 的更好的 IDE。它与（免费）Flex SDK 相关联，因此只要您不介意手动编码 MXML，那么它应该可以很好地工作。我已经使用它创建了许多较小的 Flex 应用程序，并且效果很好。无论如何，我通常会回避图形 GUI 设计师，所以它对我来说效果很好。

FlexBuilder 为您提供了两件（afaik）您在其他地方无法获得的东西。MXML 的可视化设计器和调试器。如果您获得更昂贵的 Flex Builder 版本，您还将获得一个分析器。

如果您想快速制作原型，或者如果您习惯于以这种方式设计 UI 东西，那么视觉设计师是很好的选择（一旦您开始接触更复杂的 UI 东西，我可以看到它会在哪些方面有所帮助）。

Flex SDK 带有一个命令行调试工具，但您使用 FlexBuilder 获得的 GUI 使使用它变得更加容易。这就是让 FlexBuilder 对我来说值得的原因。我一般不会将 FlexBuilder 用于日常开发，但当我需要调试时，它会让事情变得更容易。

如果您是需要为 FlexBuilder 付费的人，请尝试不使用 FlexBuilder。如果您开始遇到您认为拥有图形设计器或调试器 GUI 会有所帮助的情况，请获取 FlexBuilder 试用版。您将有 30 天的时间试用。如果它对你有足够的帮助，以至于你认为它物有所值，那就买吧。如果没有它你相处得很好，那么你不必担心得到它。

如果您的雇主要购买它并且有预算，那么早点购买它可能是值得的，但您可能可以做我上面提到的同样的事情，以便为您的公司节省一些钱。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-01-21T17:35:07.680

FlexBuilder 对我个人来说非常值得投资；它可能为自己付出了十倍或更多。不，更多。容易地。

我最喜欢的几个关键功能：

*   智能感知/代码提示：特别是如果您是 Flex 新手，这将大大加快您的学习过程；

*   分析器：实时内存/应用分析器确实有助于密切关注盒子内发生的事情；

*   调试器：设置断点、跟踪堆栈、监视变量等是难以战胜的——这里有很棒的东西；

*   Eclipse：Eclipse 只是一个出色的 IDE，Adobe 已经为 Flex 和 AIR 进行了精美的扩展。

顺便说一句，我自己不做任何拖放操作。我手动编写所有代码，但我仍然无法充分推荐 FlexBuilder。如果您可以拿出现金，那么您很可能会对产品感到满意。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-01-21T17:27:42.420

如果您的应用程序涉及大量 GUI，则 Flex Builder 非常有用。它为您提供了一个不错的 IDE 绘制 GUI。如果您只是构建转换为 swf 的 actionscript，则不需要 Flex Builder。Flex SDK 与您最喜欢的编辑器就足够了。

您可能必须学习 Actionscript 和 MXML DTD。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-21T17:30:48.280

这不是必需的，但它确实让事情变得更容易。

然而，话虽如此，当您使用 FlexBuilder 时，您最终可能仍会在 mxml 代码中而不是在 IDE 中对 UI 进行细微调整。

G人

# javascript - javascript中functionName()和functionName.call()的区别

> ID：466116
> 
> 赞同：2
> 
> 时间：2009-01-21T17:06:01.327
> 
> 标签：javascript

希望标题是不言自明的，与仅编写 functionName() 相比，在 Javascript 中使用 .call() 方法有什么优势；?

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-01-21T17:09:14.330

[`functionName.call()`](https://developer.mozilla.org/en/Core_JavaScript_1.5_Reference/Objects/Function/call)将对象实例作为其第一个参数。然后它`functionName`在该对象实例的上下文中运行（即“this”是指定的实例）

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-21T17:08:22.867

如果您不将任何内容传递给`call()`，那将是相同的；该函数将在与调用相同的范围内运行`call()`：

```
function test() {
    alert(this);
}

test(); // alerts the window object
test.call(); // alerts the window object 
```

但是，如果您将一个对象传递给`call()`，则该对象将用作范围：

```
test.call("hi"); // alerts "hi" 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-21T17:26:39.910

让我举个例子：

```
<html>
<head>
<script type="text/javascript">
 var developerName = "window";
function test(){
   var developer = function(developerName ){ this.developerName  = developerName;}
    developer.prototype = {
      displayName : function(){alert(this.developerName );}
    }
    var developerA = new developer("developerA");
    var developerB = new developer("developerB");
    developerA.displayName();//will display an alert box with "developerA" as its inner text
    developerA.displayName.call();//will display an alert box with "window" as its inner text, in this case the context is the window object.
    developerA.displayName.call(developerB);//will display an alert box with "developerB" as its inner text
}
</script>
</head>
<body>
<input type="button" onclick="test()" value="display names"/>
<body>
</html> 
```

进一步阅读：
[http ://www.alistapart.com/articles/getoutbindingsituations](http://www.alistapart.com/articles/getoutbindingsituations)

希望这可以帮助。

# ruby-on-rails - 如何使用 Shoulda 正确测试此控制器操作？

> ID：466120
> 
> 赞同：1
> 
> 时间：2009-01-21T17:07:53.833
> 
> 标签：ruby-on-rails, ruby, testing, functional-programming, shoulda

我有以下控制器动作和测试。我是使用 Shoulda 进行测试的新手，我*知道*我的控制器的某些区域可以进一步测试。例如，我的 Flash 消息以及验证渲染。

所以我的问题是，我将如何在 Shoulda 中正确测试此控制器操作？

我的控制器操作（名称已更改以保护无辜者）：

```
def my_action
  return redirect_to(root_url) if @site.nil?
  @owner = current_site.owner
  if request.post?
    if params[:password].blank? || params[:email].blank?
      flash[:error] = "You must fill in both the e-mail and password fields"
      render :action => "my_action"
    else
      if @owner.authenticated?(params[:password])
        @owner.login = params[:email]
        @owner.save!
        @owner.do_some_method
        flash[:success] = "Success."
        render :action => "my_action"
      else
        flash[:error] = "Incorrect password"
        render :action => "my_action"
      end
    end      
  end  
end 
```

我的测试：

```
context "on POST to :my_action" do
  setup do
    Owner.any_instance().expects(:do_some_method)
    post :my_action, :email => 'foo@bar.com', :password => 'test'
  end
  should_assign_to :owner
  should "Change name and verify password and resend activation key" do
    assert_equal true, assigns(:owner).authenticated?('test')
    assert_equal 'foo@bar.com', assigns(:owner).login
  end
  should_respond_with :success
end 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-23T16:44:25.610

现在，您似乎正在测试特定于控制器内部模型的功能，这应该在单元测试中。

我建议重构您的控制器，以在所有者模型中包含更新所有者电子邮件所需的逻辑。通过这样做，您应该能够将控制器简化为简单的`if update; else; end`类型语句，并大大简化控制器测试。将逻辑移入模型后，您可以使用内置的 Rails 验证。

需要考虑的其他几件事：

*   在您的 POST 操作完成后重定向，可防止用户意外重复发布（大多数浏览器在用户尝试时会抱怨）。
*   `before_filters`如果在控制器内多次执行此操作，则将对@site 的检查以及对@owner 的分配移动到。
*   您可以避免在 `config/routes.rb' 中检查`if request.post?`或`verify`创建路由。

**参考资料**：

*   [瘦控制器，胖模型](http://weblog.jamisbuck.org/2006/10/18/skinny-controller-fat-model)
*   [RailsConf 回顾：瘦控制器](http://therailsway.com/2007/6/1/railsconf-recap-skinny-controllers)
*   [ActionController::Filters::ClassMethods](http://api.rubyonrails.org/classes/ActionController/Filters/ClassMethods.html)
*   [ActionController::Verification::ClassMethods](http://api.rubyonrails.org/classes/ActionController/Verification/ClassMethods.html)

# sql-server - 您可以搜索 SQL Server 2005 存储过程的内容吗？

> ID：466130
> 
> 赞同：25
> 
> 时间：2009-01-21T17:09:56.293
> 
> 标签：sql-server, sql-server-2005

SQL Server Server 2005。我盯着一个有 500 多个存储过程的数据库，并试图收集它们如何与数据交互的复杂性——特别是关于它们如何插入/修改数据。我希望找到一个“搜索”或“查找”功能来查看实际过程的内容。这样，我可以搜索所有使用 some_table_name 做任何事情的过程。SQL 管理的基本查找功能Studio 在打开的文件中查找，并且仅在我已经打开 sproc 的情况下才会在文件中查找内容，即使这样，也只能在 ...\Local Settings\Temp\~vs1011.sql 临时类型文件中查找内容。

截至目前，我知道进入底层过程的唯一方法是右键单击并选择“修改”（或 Script Stored Procedure As => Create or Alter）。是否有更快/更简单的方法来搜索/检查所有存储过程？

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2013-06-05T09:07:26.570

尝试使用第三方工具，例如[ApexSQL Search](http://www.apexsql.com/sql_tools_search.aspx)（免费）或 SSMS Toolpack（免费），除了这里已经提到的那些。

过去当我继承 500 多个对象数据库时，我也遇到过类似的问题。我的经验是查询没问题，但真正有帮助的是第三方 SSMS 插件。

* * *

## 回答 #2

> 赞同：25
> 
> 时间：2009-01-21T17:22:02.323

不要使用 INFORMATION_SCHEMA.ROUTINES。它在 4000 个字符处截断。而是从 sys.sql_modules 获取它。

```
SELECT o.type_desc AS ROUTINE_TYPE
        ,o.[name] AS ROUTINE_NAME
        ,m.definition AS ROUTINE_DEFINITION
FROM sys.sql_modules AS m
INNER JOIN sys.objects AS o
    ON m.object_id = o.object_id
WHERE m.definition LIKE '%search term here%' 
```

（如所写，这也将返回触发器、视图和标量函数。如果您愿意，可以按类型排除）

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2009-01-21T17:13:06.303

您可以使用 Information_Schema.Routines 视图。

```
select * 
FROM   INFORMATION_SCHEMA.ROUTINES 
WHERE  OBJECTPROPERTY(OBJECT_ID(SPECIFIC_NAME),'IsMSShipped') =0 
       and OBJECT_DEFINITION(OBJECT_ID(SPECIFIC_NAME)) like '%search term here%' 
       AND ROUTINE_TYPE='PROCEDURE' 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2012-03-05T19:48:18.933

RedGate 的 SQL 搜索产品可以轻松处理这个问题并且是免费的。 [http://www.red-gate.com/products/sql-development/sql-search/](http://www.red-gate.com/products/sql-development/sql-search/)

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-01-21T17:11:58.957

批量导出到文本文件，然后使用 Google 桌面对它们进行索引。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-01-21T17:13:17.473

> ```
> select top 10 * from syscomments 
> ```

您还可以找到 sp_grep，它是一个流行的但不包括在内的过程，它可以执行此操作。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-01-21T17:13:33.277

```
SELECT DISTINCT OBJECT_NAME(id) AS ObjectName, [Text] AS CodeSnippet 
FROM syscomments (nolock) 
WHERE [TEXT] LIKE '%Whatever You Want To Search For%' 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-01-21T17:15:15.097

是的。

1.  您可以从 sys.syscomments 中选择 *

2.  如果你有 VS for Database Pro。您可以新建一个数据库项目并从数据库中导入架构并在项目中进行搜索。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2014-09-30T18:27:36.143

输入您的 proc 名称，其中显示 Place Proc Name Here

sp_msforeachdb'SELECT DISTINCT o.name, o.xtype FROM ?.dbo.syscomments c INNER JOIN ?.dbo.sysobjects o ON c.id=o.id WHERE c.TEXT LIKE ''%Place Proc Name Here%'''

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-01-21T17:14:31.963

使用 INFORMATION_SCHEMA.ROUTINES 表。

在该表中，ROUTINE_DEFINITION 字段包含存储过程的文本。

```
SELECT
  R.SPECIFIC_NAME
 ,R.ROUTINE_DEFINITION
FROM
  MyDatabase.INFORMATION_SCHEMA.ROUTINES R
WHERE UPPER(R.ROUTINE_DEFINITION) LIKE '%' + UPPER('DELETE') + '%' 
```

当然，你可以参数化我硬编码单词“DELETE”的地方。在 SQL Server 2005 中测试。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-01-21T17:16:16.360

如果你想要一个友好的界面，我可以推荐来自 Idera的廉价[SQL 管理工具集。](http://www.idera.com/Content/Show57.aspx?CartID=314)除了其他工具之外，它还有一个很好的 SQL 搜索实用程序，可以在存储过程（或其他任何地方）中查找字符串并帮助您导航它们。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-01-21T17:16:24.050

```
select o.name 
from syscomments c
    inner join sysobjects o on c.id = o.id
where text like '%tableName%' 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-01-21T17:23:18.403

我使用了不久前遇到的以下存储过程：

```
 CREATE PROC dbo.sp_search_code  
(  
@SearchStr  varchar(100),  
@RowsReturned int = NULL OUT  
)  
AS  
/*************************************************************************************************  
  Copyright © 1997 - 2002 Narayana Vyas Kondreddi. All rights reserved.  

Purpose: To search the stored proceudre, UDF, trigger code for a given keyword.  

Written by: Narayana Vyas Kondreddi  
  http://vyaskn.tripod.com  

Tested on:  SQL Server 7.0, SQL Server 2000  

Date created: January-22-2002 21:37 GMT  

Date modified: February-17-2002 19:31 GMT  

Email:   vyaskn@hotmail.com  

Examples:  

To search your database code for the keyword 'unauthorized':  
EXEC sp_search_code 'unauthorized'  

To search your database code for the keyword 'FlowerOrders' and also find out the number of hits:  
DECLARE @Hits int  
EXEC sp_search_code 'FlowerOrders', @Hits OUT  
SELECT 'Found ' + LTRIM(STR(@Hits)) + ' object(s) containing this keyword' AS Result  
*************************************************************************************************/  
BEGIN  
 SET NOCOUNT ON  

 SELECT DISTINCT USER_NAME(o.uid) + '.' + OBJECT_NAME(c.id) AS 'Object name',  
  CASE   
    WHEN OBJECTPROPERTY(c.id, 'IsReplProc') = 1   
    THEN 'Replication stored procedure'  
    WHEN OBJECTPROPERTY(c.id, 'IsExtendedProc') = 1   
    THEN 'Extended stored procedure'      
   WHEN OBJECTPROPERTY(c.id, 'IsProcedure') = 1   
    THEN 'Stored Procedure'   
   WHEN OBJECTPROPERTY(c.id, 'IsTrigger') = 1   
    THEN 'Trigger'   
   WHEN OBJECTPROPERTY(c.id, 'IsTableFunction') = 1   
    THEN 'Table-valued function'   
   WHEN OBJECTPROPERTY(c.id, 'IsScalarFunction') = 1   
    THEN 'Scalar-valued function'  
    WHEN OBJECTPROPERTY(c.id, 'IsInlineFunction') = 1   
    THEN 'Inline function'   
  END AS 'Object type',  
  'EXEC sp_helptext ''' + USER_NAME(o.uid) + '.' + OBJECT_NAME(c.id) + '''' AS 'Run this command to see the object text'  
 FROM syscomments c  
  INNER JOIN  
  sysobjects o  
  ON c.id = o.id  
 WHERE c.text LIKE '%' + @SearchStr + '%' AND  
  encrypted = 0    AND  
  (  
  OBJECTPROPERTY(c.id, 'IsReplProc') = 1  OR  
  OBJECTPROPERTY(c.id, 'IsExtendedProc') = 1 OR  
  OBJECTPROPERTY(c.id, 'IsProcedure') = 1  OR  
  OBJECTPROPERTY(c.id, 'IsTrigger') = 1  OR  
  OBJECTPROPERTY(c.id, 'IsTableFunction') = 1 OR  
  OBJECTPROPERTY(c.id, 'IsScalarFunction') = 1 OR  
  OBJECTPROPERTY(c.id, 'IsInlineFunction') = 1   
  )  

 ORDER BY 'Object type', 'Object name'  

 SET @RowsReturned = @@ROWCOUNT  
END 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-01-21T17:36:38.347

与上述答案完全不同的方法是编写一个使用 Microsoft.SqlServer.Management.Smo 和 Microsoft.SqlServer.Management.Common 命名空间的简单程序。使用这些，您可以遍历所有存储过程并从中读取文本。我以这种方式编写了一个程序来比较两个不同数据库（开发和阶段或阶段和生产）中的存储过程并更新不同的数据库。

这是一个例子：

```
using Microsoft.SqlServer.Management.Smo;
using Microsoft.SqlServer.Management.Common;

namespace SqlObjectChecker
{
    internal class ProcedureUpdater
    {
        internal string UpdateProcedure(string spName, string devConnString, string prodConnString, bool updateDev)
        {
            string returnMessage = "";

            ServerConnection devConnection = new ServerConnection();
            devConnection.ConnectionString = devConnString;
            ServerConnection prodConnection = new ServerConnection();
            prodConnection.ConnectionString = prodConnString;

            try
            {
                devConnection.Connect();
                prodConnection.Connect();

                Server devServer = new Server(devConnection);
                Server prodServer = new Server(prodConnection);

                Database devDatabase = devServer.Databases["Dbname"];
                Database prodDatabase = prodServer.Databases["Dbname"];

                StoredProcedure devStoredProcedure = devDatabase.StoredProcedures[spName];
                if (devStoredProcedure != null)
                {
                    StoredProcedure prodStoredProcedure = prodDatabase.StoredProcedures[spName];
                    if (prodStoredProcedure != null)
                    {
                        if (updateDev)
                        {
                            devStoredProcedure.TextHeader = prodStoredProcedure.TextHeader;
                            devStoredProcedure.TextBody = prodStoredProcedure.TextBody;
                            devStoredProcedure.Alter();
                            returnMessage = "Dev updated";
                        }
                        else
                        {
                            prodStoredProcedure.TextHeader = devStoredProcedure.TextHeader;
                            prodStoredProcedure.TextBody = devStoredProcedure.TextBody;
                            prodStoredProcedure.Alter();
                            returnMessage = "Prod updated.";
                        }
                    }
                    else
                    {
                        returnMessage = "Prod Stored Procedure Name Found.";
                    }
                }
                else
                {
                    returnMessage = "Dev Stored Procedure Name Found.";
                }

                devConnection.Disconnect();
                prodConnection.Disconnect();
            }
            catch (Exception exception)
            {
                returnMessage = exception.Message;
            }

            return returnMessage;
        }
    }
} 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2009-01-22T02:22:57.550

我写了一个 Perl 模块，它允许我做这些，甚至更多。有了它，我可以使用 SQL 语句操作视图/存储过程（和 Perl 代码）。`#!/usr/bin/perl

# 使用代码库；

使用严格；使用警告；

```
Codebase::CreateFunctions(change=>\&change);

exit; 
```

子更改 { 我的 $string=shift;

```
my %H=(
        23 => 30,
        25 => 26,
        27 => 30,
        28 => 30,
        29 => 30,
        31 => 24,
        32 => 24
         );
$string =~ s/InstallStatus *(<>|==|>=|<=|>|=|<) *(23|25|27|28|29|31|32)(\W)/"iNstallsTatus $1 $H{$2}$3"/iges;
return $string;
 } # change 
```

**END** 选择名称(entries.fullname)||extension(entries.fullname) 作为名称，grep(m/\W(23|25|27|28|29|31|32|InstallStatus|InstallStatusNew|InstallStatusOld)\W/, objects.definition,3) as LISTING from entries inner join objects on entries.OId = objects.OId where (path(entries.fullname) in ('BETA:/') and entries.kind = 'view') and ((( objects.definition like m/\W(TRACKING)\W/) 和 (objects.definition like m/\WInstallStatus(\W|\s)/)) 或 ((objects.definition like m/\W(TRACKING_LOG)\ W/) 和 (objects.definition like m/\WInstallStatus(New|OLD)(\W|\s)/))) 限制 10

```
select name(entries.fullname)||extension(entries.fullname) as Name, change(objects.definition) as FILE
    from entries
    inner join objects on entries.OId = objects.OId
    where (path(entries.fullname) in ('BETA:/') and entries.kind = 'view')
        and (((objects.definition like m/\W(TRACKING)\W/) and (objects.definition like m/\WInstallStatus(\W|\s)/))
        or ((objects.definition like m/\W(TRACKING_LOG)\W/) and (objects.definition like m/\WInstallStatus(New|OLD)(\W|\s)/)))
        and (change(objects.definition) <> objects.definition)
limit 10 
```

`

* * *

## 回答 #16

> 赞同：-1
> 
> 时间：2009-01-21T17:16:36.077

使用 MS SQL Server 管理工作室；

在 TreeView 中找到 Table 或 SP，然后右键单击它并选择“View Dependencies”

这样你就可以看到所有的依赖对象。

# .net - 如何检测直接进入停止状态而没有错误的.net服务问题

> ID：466133
> 
> 赞同：2
> 
> 时间：2009-01-21T17:10:39.413
> 
> 标签：.net, windows-services

我有一个 .Net 服务已开始拒绝启动 - 系统日志显示它“已成功发送启动控制”，然后五秒钟后“服务进入停止状态”。我将我的服务类的 Main() 函数包装在一个 try/catch 块中——但是当这种情况发生时，我的服务的事件日志中不会出现任何错误。

我想知道问题是什么。如果有一些异常没有被捕获 - 它会在哪里被捕获？下面是我运行服务的代码。

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.ServiceProcess;
using System.Text;

namespace MyServerService
{
    static class service
    {
        /// <summary>
        /// The main entry point for the application.
        /// </summary>
        static void Main()
        {
            try
                {
#if DEBUG

                    System.Diagnostics.Debugger.Launch();

#endif

                    ServiceBase[] ServicesToRun;
                    ServicesToRun = new ServiceBase[] 
                { 
                    new MyService() 
                };
                    ServiceBase.Run(ServicesToRun);
            } catch (Exception ex)
            {
                System.Diagnostics.EventLog.WriteEntry("MyServerService", "Main() Error: " + ex.Message + ex.InnerException, System.Diagnostics.EventLogEntryType.Error);
            }
        }
    }
} 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-21T17:28:59.843

Run 方法不会在这里抛出。相反，您需要将代码包装在 MyService 类的 OnStart 方法的重载中的 try/catch 块中，因为这是发生异常的地方。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-21T17:29:28.830

您的[ServiceBase.OnStart](http://msdn.microsoft.com/en-us/library/system.serviceprocess.servicebase.onstart.aspx)实现是做什么的？如果它没有在设定的时间段内返回，则服务控制管理器将再次停止服务。理想情况下，您应该在 OnStart 方法中创建一个新线程以进行任何需要的处理并尽快返回。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-08T04:42:12.313

在这种情况下，我正在将日志写入 Windows 应用程序日志——在生产环境中，日志已满。我不确定调试技术应该是什么来“捕捉”这类问题——但这就是我们的问题。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-21T17:29:29.220

我会检查您服务所依赖的所有组件是否安装正确。

使用 ildasm.exe 或等效工具来检查它需要什么并查看它是否可用。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-21T18:17:27.937

您可以将处理程序添加到 AppDomain.Current.UnhandledException 并将一些日志记录代码放入异常处理程序中。这将允许您捕获导致服务停止的任何异常。

在 VB.NET 中，它看起来像这样

```
Sub Main(ByVal ParamArray parameters As String())
    AddHandler AppDomain.CurrentDomain.UnhandledException, AddressOf AppDomainExceptionHandler

...

End Sub

Private Sub AppDomainExceptionHandler(ByVal sender As Object, ByVal e As UnhandledExceptionEventArgs)

...

End Sub 
```

不确定它在 C# 中会是什么样子，因为我的 C#-fu 不是很好

# python - 保存一次后如何将模型实例设为只读？

> ID：466135
> 
> 赞同：3
> 
> 时间：2009-01-21T17:11:14.683
> 
> 标签：python, django, django-models, django-admin, django-signals

我正在编写的 Django 项目中的一个功能是发送时事通讯。我有一个模型`Newsletter`和一个函数，`send_newsletter`我已经注册了它来收听`Newsletter`'s 的`post_save`信号。当通过管理界面保存时事通讯对象时，`send_newsletter`检查是否`created`为 True，如果是，则它实际发送邮件。

但是，出于显而易见的原因，编辑已经发送的时事通讯没有多大意义。有没有办法`Newsletter`在保存对象后将其设为只读？

## 编辑：

我知道我可以重写`save`对象的方法来引发错误，或者如果对象存在则什么都不做。但是，我没有看到这样做的意义。至于前者，我不知道在哪里捕获该错误以及如何向用户传达对象未保存的事实。至于后者，给用户错误的反馈（管理界面说保存成功）似乎不是一件好事。

我真正想要的是允许用户使用 Admin 界面编写时事通讯并发送，然后浏览已经发送的时事通讯。我希望管理界面在不可编辑的输入框中显示已发送时事通讯的数据，而无需“保存”按钮。或者，我希望“保存”按钮处于非活动状态。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-01-21T19:29:25.670

`save`您可以在模型的方法中检查它是创建还是更新：

```
def save(self, *args, **kwargs):
    if self.pk:
        raise StandardError('Can\'t modify bla bla bla.')
    super(Payment, self).save(*args, **kwargs) 
```

如果您尝试保存现有对象，上面的代码将引发异常。**以前没有持久化的对象没有设置它们的主键。**

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-10T08:57:23.800

[推荐阅读： Django Book 第 17 章中的](http://www.djangobook.com/en/1.0/chapter17/)The Zen of Admin 。

摘要：管理员不是为您尝试做的事情而设计的:(

然而，这本书的 1.0 版本只涵盖了 Django 0.96，此后好事不断。

在 Django 1.0 中，[管理站点](http://docs.djangoproject.com/en/dev/ref/contrib/admin/)更加可定制。由于我自己没有自定义管理员，我必须根据文档进行猜测，但我会说[覆盖模型表单](http://docs.djangoproject.com/en/dev/ref/contrib/admin/#form)是你最好的选择。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2014-01-15T19:58:53.393

您可以轻松做的就是将所有字段设为只读：

```
class MyModelAdmin(ModelAdmin):
    form = ...
    def get_readonly_fields(self, request, obj=None):
        if obj:
            return MyModelAdmin.form.Meta.fields
        else: # This is an addition
            return [] 
```

至于让保存消失，如果

1.  `has_change_permission`即使显示表单，返回 False 也不会禁用
2.  负责呈现管理表单控件（`admin_modify.submit_row`模板标签）的代码片段不会`show_save=True`无条件使用。

无论如何，使那个人不被渲染的一种方法：

1.  使用正确的逻辑创建 has_change_permission 的替代版本：

    ```
    class NoSaveModelAdminMixin(object):
        def render_change_form(self, request, context, add=False, change=False, form_url='', obj=None):
            response = super(NoSaveModelAdmin, self).render_change_form(request, context, add, change,form_url, obj)
            response.context_data["has_change_permission"] = self.has_real_change_permission(request, obj)
        def has_real_change_permission(self, request, obj):
            return obj==None
        def change_view(self, request, object_id, extra_context=None):
            obj = self.get_object(request, unquote(object_id))
            if not self.has_real_change_permission(request, obj) and request.method == 'POST':
                raise PermissionDenied 
            return super(NoSaveModelAdmin, self).change_view(request, object_id, extra_context=extra_context) 
    ```

2.  覆盖与此类似的 submit_row 模板标签：

    ```
    @admin_modify.register.inclusion_tag('admin/submit_line.html', takes_context=True)
    def submit_row(context):
        ...
            'show_save': context['has_change_permission']
        ...

    admin_modify.submit_row = submit_row 
    ```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-03-19T14:00:41.443

在你的 amdin.py 中使用 readonlyadmin。列出你想要只读的所有字段。创建对象后你不能编辑它们

使用链接

```
http://www.djangosnippets.org/snippets/937/ 
```

复制文件，然后导入你的 admin.py 并使用它

# php - php disk_total_space

> ID：466140
> 
> 赞同：2
> 
> 时间：2009-01-21T17:12:11.703
> 
> 标签：php, directory

我需要有关 disk_total_space 功能的帮助..

我的代码上有这个

```
<?php
          $sql="select * from users order by id";
          $result=mysql_query($sql);
          while($row=mysql_fetch_array($result)) {
?>
Name : <?php echo $row['name']; ?>
Email : <?php echo $row['email']; ?>
Diskspace Available : <?php 
$dir = "C:/xampp/htdocs/freehosting/".$row['name'];
disk_total_space($dir);
} ?> 
```

但是，这为每个用户返回了相同的磁盘空间..

任何人都可以给我一些启示？

谢谢 ：）

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-21T17:17:01.520

[http://us2.php.net/disk_total_space](http://us2.php.net/disk_total_space)说，

> “给定一个包含目录的字符串，此函数将返回**相应文件系统**或**磁盘分区**上的总字节数。”

您可能会看到 C 的 total_space：

[Windows 和 Linux 都存在替代解决方案](http://forums.devshed.com/showpost.php?p=1527717&postcount=4)。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-21T17:22:48.407

我认为你想要的是这样的：

```
function foldersize($path) {
    $total_size = 0;
    $files = scandir($path);

    foreach($files as $t) {
        if (is_dir(rtrim($path, '/') . '/' . $t)) {
            if ($t<>"." && $t<>"..") {
                $size = foldersize(rtrim($path, '/') . '/' . $t);
                $total_size += $size;
            }
        } else {
            $size = filesize(rtrim($path, '/') . '/' . $t);
            $total_size += $size;
        }   
    }
    return $total_size;
}

function format_size($size) {
    $mod = 1024;

    $units = explode(' ','B KB MB GB TB PB');
    for ($i = 0; $size > $mod; $i++) {
        $size /= $mod;
    }

    return round($size, 2) . ' ' . $units[$i];
}

$SIZE_LIMIT = 5368709120; // 5 GB
$sql="select * from users order by id";
$result=mysql_query($sql);
while($row=mysql_fetch_array($result)) {
    $disk_used = foldersize("C:/xampp/htdocs/freehosting/".$row['name']);
    $disk_remaining = $SIZE_LIMIT - $disk_used;
    print 'Name: ' . $row['name'] . '<br>';
    print 'diskspace used: ' . format_size($disk_used) . '<br>';
    print 'diskspace left: ' . format_size($disk_remaining) . '<br><hr>';
} 
```

**编辑**：递归函数最初有一个错误。现在它还应该读取原始文件夹中的文件夹，以及这些文件夹中的文件夹，等等。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-21T17:17:15.890

我认为该方法只会告诉您有关给定目录所在的文件系统或分区的信息。不过，您可以尝试简单地向[du 发起](http://www.manpagez.com/man/1/du/)攻击：

```
$space_used=`du -sh $dir`; 
```

-s 总结整个目录，-h 以 MB 和 GB 等“人类”单位返回结果。

*编辑：抱歉，我错过了这是在 Windows 上的。将留下答案，以防它帮助某人搜索类似的问题。对于 Windows，[请在 PHP 手册中尝试此建议](http://www.php.net/manual/en/function.disk-total-space.php#34100)*

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-21T17:18:03.173

PHP.net 上对该函数的评论似乎表明这给出了驱动器/分区的空间`$dir`，而不是`$dir`本身的大小。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-21T17:20:55.943

根据文档[`disk_total_space()`](http://www.php.net/disk_total_space)，返回的值是**目录所在的文件系统**。它不计算目录 + 其子目录中使用的空间。

您可以`du`购买或购买更便携的解决方案：

```
$total = 0;

foreach (new RecursiveDirectoryIterator($dir) as $entry)
{
    if ($entry->isFile())
        $total += $entry->getSize();
} 
```

# git - 您如何构建 Git 存储库工作流程？

> ID：466141
> 
> 赞同：9
> 
> 时间：2009-01-21T17:12:23.573
> 
> 标签：git, dvcs

我们已经看过并观看了有关大型分布式团队如何使用 Git 的视频，但是我们这些没有分布式并与我们团队的其他成员一起在办公室工作的人呢？我们应该如何构建我们的存储库和我们的工作流程？

想想一直使用 Subversion 或 CVS 作为单一权限点的传统办公室。当然，这些团队可以各自维护自己的 Git 存储库，并根据需要相互推/拉，这在许多情况下很快就会变成一场噩梦。或者，他们可以各自维护自己的存储库，并与被称为团队“主”的单个存储库同步。或者，可以将工作流与 DVCS 打开的可能性进行任何组合。

你的团队是如何运作的？您发现什么是有用的工作流程？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-01-21T17:28:42.730

我喜欢雅虎的方式！用户界面 (YUI) 团队似乎正在工作。我不在雅虎，也不在那个团队，但他们的 git 提交日志揭示了很多关于他们的过程。

YUI 团队维护一个中央存储库，团队中的每个人都有提交访问权限。定期在提交到这个存储库之后（可能是在每次推送之后，但我不这么认为），构建系统触发，重建 YUI 并将新标记的提交推送到 github，社区可以在其中分叉代码并对其进行处理.

我赞成代表项目“官方”状态的中央存储库。当然，如果我想与同事共享代码，我可以安排他们从我这里拉出一个分支，我们可以这样协作。

“主”存储库还提供其他优点，例如易于持续集成，因为可以在“主”存储库上配置推/拉触发器以启动单元测试和构建系统。它还确保每个人都知道最新的“已知良好”版本的存储库在哪里，因此如果需要构建、发布或测试项目，可以合理地保证“主”存储库已为此做好准备.

Git 将支持您能想到的几乎所有工作流程，但即使在一个小团队中，您也不希望出现关于“官方”存储库在哪里的问题。可能导致的维护噩梦，尤其是在您接近发布时，将是令人不快的。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2010-07-15T06:46:47.553

看看不错的博客[http://nvie.com/git-model](http://nvie.com/git-model)和评论

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2012-07-20T10:05:09.110

看看 github 团队使用的工作流程：

[http://scottchacon.com/2011/08/31/github-flow.html](http://scottchacon.com/2011/08/31/github-flow.html)

它需要使用 github，但也非常简单明了。

# java - QCompleter 和 QLineEdit 用于多个单词

> ID：466143
> 
> 赞同：4
> 
> 时间：2009-01-21T17:13:05.990
> 
> 标签：java, c++, qt

有没有办法让 QCompleter 像多个单词的自动完成一样？

有人知道怎么做吗？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-01-21T17:32:33.003

我不知道我是否理解正确：

```
QStringList wordList;
wordList << "alpha and beta" << "omega" << "omicron" << "zeta";

QCompleter *completer = new QCompleter(wordList, this);
completer->setCaseSensitivity(Qt::CaseInsensitive);

QLineEdit *lineEdit = new QLineEdit(this);
lineEdit->setCompleter(completer); 
```

如果你输入 alp，那么你会得到一个多于一个单词的补全“alpha and beta”。没有限制。

澄清后更新：

似乎要求的是在分隔符值之后开始新的自动完成。在当前情况下，此分隔符将是一个空格。一个等效的示例是 Qt 示例中的[树模型完成器。](https://doc.qt.io/qt-5/qtwidgets-tools-treemodelcompleter-example.html)这个例子说明了如何解决同样的情况。

# .net - 将数据表作为字段从 Oracle 传递到 .NET

> ID：466159
> 
> 赞同：1
> 
> 时间：2009-01-21T17:15:53.240
> 
> 标签：.net, oracle, datatable, dataset

在 .NET 数据表中，列是对象类型，它可以包含数据表作为列的有效类型。所以你可以创建一个相当复杂的结构：

```
CompanyID (Integer) | CompanyName (String) | OrderRecords (DataTable)
---------------------------------------------------------------------------
1                   | Acme Corp.           | DataTable of Orders 
```

在调用 Oracle 存储过程时，有没有办法返回这样的结构。我尝试使用内联视图，但它不允许我这样做。例子：

```
refCursor IS ref CURSOR;

PROCEDURE GETCOMPANYLIST (
  CompanyCursor OUT refCursor
)
AS
BEGIN
Open CompanyCursor For
SELECT COMPANYID, COMPANYNAME, 
    (SELECT * FROM ORDERS WHERE CompanyID = CompanyID) OrderRecords
    WHERE IsActive = 'T';
END GETCOMPANYLIST; 
```

这不起作用，但有什么办法可以做我想做的事情吗？目前，我必须在一次调用数据库中取回公司列表，然后遍历所有记录并进行单独调用以获取每个订单列表。

[添加了有效答案 - 直到现在还没有真正回答问题的答案]

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-21T17:30:25.690

虽然类型`Object`如您所说，.Net 确实尝试使用更多强类型的值。这些列具有关联的 DataType 属性，该属性仅支持较小的一组类型。有关完整列表，请参阅此链接：http:
[//msdn.microsoft.com/en-us/library/system.data.datacolumn.datatype.aspx](http://msdn.microsoft.com/en-us/library/system.data.datacolumn.datatype.aspx)

由于数据表在后台是 xml，因此您可能可以构建这样的表，但 .Net 不会将其传递给数据库。相反，您应该考虑使用 DataSet。DataSet 只是 DataTables 的集合，但它还支持可以根据需要映射关系的模式。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-21T17:35:10.020

我需要做一次类似的事情，最后将它们全部返回为 OUT REF CURSOR，每个结果集一个。如果愿意，可以将其加载到 DataSet 中。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-25T13:35:41.003

我在很久以前（几个月前）问过这个问题，然后当我没有得到对我有用的回复时，我回到发送多个数据表并在应用程序端以它需要的方式“重新组装”它们要处理。但是，我找到了这个问题的答案，不得不在这里与社区分享。Oracle 从版本 9 开始对 XML 的支持绝对令人难以置信，特别是 DBMS_XMLQuery 包可用于解决我上面列出的问题，方法是将 select 语句解析并作为 XML 数据集发送回，该数据集可以通过 .NET 在应用程序端轻松转换毫不费力。这是我最近编写的测试存储过程中的示例代码：

```
SELECT COMPANYID, COMPANYNAME, 
   DBMS_XMLQuery.GetXML(
   'SELECT * FROM ORDERS WHERE CompanyID = ' 
   ||  COMPANY.COMPANYID )  
    OrderRecords
   FROM COMPANY
   WHERE lower(COMPANYNAME) LIKE '%shawn%'; 
```

这将返回如下内容（只需将 OrderRecords 作为字符串拉入并隐藏到 DataTable：

```
CompanyID | CompanyName      | OrderRecords 
---------------------------------------------------------------------------
1051      | Shawns Company  | XML String Returned, listed below

<?xml version = '1.0'?>
<ROWSET>
   <ROW num="1">
      <ORDERID>500020</ORDERID>
      <NOTES>Test Note</NOTES>
      <!-- Additional fields cut out  Not necessary for example -->
   </ROW>
   <ROW num="2">
      <ORDERID>500021</ORDERID>
      <NOTES>Test Note 2</NOTES>
      <!-- Additional fields cut out  Not necessary for example -->
   </ROW>
   <ROW num="3">
      <ORDERID>500280</ORDERID>
      <NOTES>notes test</NOTES>
      <!-- Additional fields cut out  Not necessary for example -->
   </ROW>
   <!-- Additional Rows cut out  Not necessary for example -->
</ROWSET> 
```

除了这个非常酷的功能之外，DBMS_XMLQuery 包还有很多其他功能。绝对值得一试。

# winforms - 如何刷新 Winforms DataGridView？

> ID：466165
> 
> 赞同：0
> 
> 时间：2009-01-21T17:16:37.887
> 
> 标签：winforms, datagridview, refresh

我`DataGridView`在选项卡中有两个 s ，`DataSource`第二个网格的 s 基于第一个网格中的行选择。问题是在先前的选项卡中插入或更新某些值后，我无法刷新网格。如果我单击该行，它工作正常，但如果我以编程方式选择该行（即第一行），它就不起作用。我尝试了以下方法，但未能刷新。

```
daProgram.ClearBeforeFill = true
daProgram.fill(dsProgram)
bsProgram.ResetBindings(true) -- binding source also tried false
dgvProgram.DataSource=bsProgram -- rebinding the control 
```

我也试过：

```
dgvProgram.DataSource=nothing 
```

和

```
dgvProgram.DataBindings.clear() 
```

没有任何效果:-(

如果有人能在这方面帮助我，我将不胜感激。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2014-12-10T07:42:46.927

尝试这个

```
dgvProgram.DataSource=null; 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-04T23:37:48.110

我已经阅读了一些关于此的内容，也发现 ResetBindings 不起作用。

如果您使用的是 Table Adapters，只需调用 fill 方法（自动添加到您的 Form Load 事件中的方法）。

我读过一些东西说你*不应该*打电话给 Fill。我看不出为什么不这样做。它只是重新查询数据，这正是刷新应该做的。

```
Me.YourTableAdapter.Fill(Me.YourDataSet.YourDataTable) 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-21T18:17:52.803

您是否正确绑定数据？

[http://www.theserverside.net/discussions/thread.tss?thread_id=31014](http://www.theserverside.net/discussions/thread.tss?thread_id=31014)

[http://bytes.com/groups/net-c/256204-refresh-databindings-winform](http://bytes.com/groups/net-c/256204-refresh-databindings-winform)

# .net - .NET ThreadPool 说明 - 可用线程与空闲线程

> ID：466180
> 
> 赞同：0
> 
> 时间：2009-01-21T17:20:07.787
> 
> 标签：.net, multithreading, threadpool

我对 .NET ThreadPool 的一个方面有点困惑：即，您如何知道它的“可用”线程中有多少是等待重用的空闲线程，还有多少尚未创建。

该`GetAvailableThreads()`方法的摘要指出：

> 检索 GetMaxThreads 方法返回的最大线程池线程数与当前活动的线程数之间的差异。

任何“活动”线程都在忙于工作，因此无法重用，但有多少线程“可用”可重用，而“可用”是因为它们尚未创建？

我知道该`GetMinThreads()`方法返回框架将在池中维护以供重用的绝对最小线程数，但这并不一定等于当前空闲线程的数量 - 是吗？我的印象是，空闲线程会在 ThreadPool 中徘徊，并且只有在它们闲置一段时间后才会被修剪到最低限度。

这很重要，因为根据文档：

> 当所有线程池线程都已分配给任务时，线程池不会立即开始创建新的空闲线程。为了避免不必要地为线程分配堆栈空间，它会每隔一段时间创建新的空闲线程。该时间间隔目前为半秒，但在 .NET Framework 的未来版本中可能会发生变化。

我想检查我的应用程序是否必须在池中创建过多的“新”线程 - 减慢它的速度 - 但我不确定如何做到这一点，而无法弄清楚有多少空闲，准备就绪-重用我闲逛的线程。

欢迎任何想法。谢谢！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-21T17:36:13.573

ThreadPool 没有办法确定当前有多少线程处于空闲状态。也就是说，创建但实际上没有做任何事情。

我使用 ThreadPool 的经验表明，保持线程非常好。我不知道他们是否在其中添加了逻辑来跟踪正在使用的平均线程数，但我从未注意到我的程序正在等待线程创建。当然，启动时除外。我的一个程序经常创建和运行几十个并发线程，我看不到启动它们的任何延迟，即使工作负载已经低了一段时间。

我建议您检测您的应用程序，跟踪调用 ThreadPool.QueueUserWorkItem 的时间以及工作项实际启动的时间。像这样的东西：

```
DateTime queueTime = DateTime.Now;
ThreadPool.QueueUserWorkItem(WorkItemProc, queueTime);

void WorkItemProc(object state)
{
    DateTime startTime = DateTime.Now;
    DateTime queueTime = (DateTime)state;
    TimeSpan elapsed = startTime - queueTime;
    // At this point, elapsed.TotalMilliseconds will tell you how long it took
    // between queuing the item and it actually being started.
    ...
} 
```

如果您发现启动池线程花费的时间太长，那么您应该创建自己的托管线程，并使用事件或其他一些消息传递机制来使其工作。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-21T19:39:54.137

我建议这是“如果你不得不问，你没有正确使用它”的情况。如果资源管理是一个问题，那么您应该创建一个专门针对您的性能需求的自定义解决方案。.net 线程池是一个通用工具。

> [它是为一组独立的短期任务而设计的。](http://blogs.msdn.com/oldnewthing/archive/2006/03/14/551140.aspx#551339)

线程池没有为您提供限制它的工具，对我来说，这是您不应该这样做的最好迹象。线程池是标准情况下的纵容工具。但不适用于任何情况。从你的问题来看，我相信，这不适合你。

我建议您阅读我在上面链接的 Raymond Chen 的帖子。还有[Eric Lippert 的这篇文章](http://blogs.msdn.com/ericlippert/archive/2003/12/01/53411.aspx)。

# oop - 什么时候使用继承？

> ID：466184
> 
> 赞同：4
> 
> 时间：2009-01-21T17:21:01.390
> 
> 标签：oop, inheritance

我和我的朋友进行了一次小小的辩论。我必须实现一个“浏览器进程观察器”类，该类在被观察的浏览器（比如 Internet Explorer）运行时调用一个事件。

我们创建了一个“Process watcher”类，这里开始辩论：

他说构造函数应该只接受字符串（如“iexplore.exe”），我说我们应该继承“进程观察者”来创建一个“浏览器观察者”，它接受当前使用的浏览器枚举，构造函数将“翻译”它来“探索”。他说我们应该使用一个 util 函数来充当翻译器。

我知道这两种方法都是有效且好的，但我想知道每种方法的优缺点是什么，以及什么适合我们的情况。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-01-21T17:38:03.430

最近我一直在采取“现在保持简单，如果需要扩展它，以后再重构”的方法。

你现在做的事情看起来很简单。您实际上只有一个案例需要处理。所以我会说现在采取更简单的方法。最后，如果您永远不必制作另一种观察者，那么您将避免额外的复杂性。但是，如果需要，请以一种便于以后重构的方式对其进行编码。

将来，如果您发现需要另一种类型的观察者，请花精力将其重构为继承（或组合，或您想要遵循的任何其他模式）。如果您的初始代码正确完成，那么重构应该相当容易，因此您实际上并没有添加太多额外的工作。

我发现这种方法对我来说效果很好。在我真的不需要继承的情况下，代码保持简单。但是当我真的需要它时，我可以毫无问题地添加它。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-01-21T17:27:59.753

在其他条件相同的情况下，我更喜欢更简单的解决方案（使用字符串作为构造函数参数的单个具体类）而不是更复杂的解决方案（使用基类和子类）。

当您想要改变**行为**时，继承是合适的：如果浏览器观察者会**做**一些普通进程观察者不会做的事情。但是，如果您只想改变**数据**的值，那么只需改变数据即可。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-21T17:37:58.953

如果除了作为 BrowserWatcher 的父级之外，您对 ProcessWatcher 没有其他用途，那么您不应该创建它。如果正在实现其他具有可以放置在 ProcessWatcher 中的共享功能的 Watcher，那么您应该（两者都是“isa”关系，因此满足 Rob 的标准）。

它真的是那么简单。争辩说*有一天*你会有其他的观察者并不是支持创建一个单独的类的论据。您应该尽快输掉比赛，这是一种心理抽搐。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-21T17:28:52.450

继承只能用于实现“isa”关系。

正如您可以说“浏览器观察者”**是**“进程观察者”的特定实例，那么继承适用于这种架构。

因此，对我来说，将您正在观看的内容的身份作为“进程观察者”的浏览器观察者实现的一部分传递，这绝对是要走的路。

**编辑：**更具体地说，继承适用于您想要专门化行为的时候。例如，大多数动物都会发出声音，但您可能希望在一个名为动物的类中提供发出哪种声音，您必须等待专业化。

那么我们有 Horse 类为其声音提供“neigh”，一个 Dog 类为其声音提供“bark”，等等。

高温高压

干杯，

抢

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-21T17:27:24.060

取决于您拥有什么用例或您遵循什么上帝。

我没有说“继承是邪恶的”，但通常我遵循“优先组合优于继承”的原则，以避免过多的类层次结构。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-21T18:53:19.753

我同意在大多数情况下，简单而不是复杂是一个很好的策略，只要你的简单不是太短视（参考 Herms，以这样一种方式编写代码，以便你以后可以轻松地重构）。

然而，我也知道要让你耳边那个鼓励更彻底设计的错误闭嘴是多么困难。如果您仍然希望继承而不必考虑“基类”和“子类”，您可以简单地定义一个由 ProcessWatcher 实现的接口（例如 IProcessWatcher）。当您使用 ProcessWatcher 对象时，请根据接口引用它，这样如果您以后决定创建 BrowserWatcher（或任何其他类型的 ProcessWatcher），您可以这样做而无需强制它从 ProcessWatcher 下降，只要它实现 IProcessWatcher 接口。

**警告：**谨慎操作。想要为每个对象定义一个接口是很诱人的，让我们面对现实吧，这太荒谬了。=)

最终，您需要找到双方都满意的东西，因为您都必须维护这段代码，我认为这可能是一个不错的折衷方案，而不是简单的“继承或不继承”。

祝你好运！

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2020-04-10T13:31:25.973

用很简单的一句话可以说：

> 当您需要使用继承（子类化）时，子类具有与超类不同的行为（不是属性）。

# mysql - MySQL：计算今天添加的记录的最有效方法

> ID：466187
> 
> 赞同：2
> 
> 时间：2009-01-21T17:21:34.197
> 
> 标签：mysql, performance

这是我拥有的 MySQL 表结构：

```
itemID (BIGINT)
userID (BIGINT)
wasAdded (DATETIME) 
```

*我需要通过X*用户 ID获取当天引入的商品数量

最有效的方法是什么？

谢谢

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-21T17:26:25.810

最好的方法是添加一个涵盖`userID` *and* `wasAdded`的索引，然后你可以做

```
SELECT COUNT(*) FROM my_table WHERE userID = 'X' AND wasAdded BETWEEN CONCAT(CURDATE(), ' ', '00:00:00') AND CONCAT(CURDATE(), ' ', '23:59:59'); 
```

这甚至不需要从表中读取，因为它需要的所有数据都在索引中。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-21T17:27:42.093

这应该可以解决问题：

```
SELECT COUNT(itemID) FROM 'tableName' WHERE TO_DAYS(wasAdded) = TO_DAYS(NOW()) AND userID = X 
```

但是，请确保在`wasAdded`and上有一个索引`userID`！

# iis - ColdFusion RDS 和 NTLM 集成身份验证问题

> ID：466191
> 
> 赞同：3
> 
> 时间：2009-01-21T17:22:41.010
> 
> 标签：iis, coldfusion, ntlm, jrun

我似乎无法获得启用 NTLM 身份验证和仍然让 RDS 工作的神奇组合。如果我只保留匿名身份验证，RDS 工作正常 - 一旦我在站点范围内启用它，RDS 就会失败（这是意料之中的）。这是我所做的：

*   这是 Windows XP SP2 和 ColdFusion 8，Eclipse + Adob​​e 插件
*   在 IIS 管理器中，右键单击默认网站并选择属性
*   目录安全选项卡，单击编辑按钮进行匿名访问和身份验证控制
*   身份验证方法弹出窗口，取消选中匿名访问，并选中集成 Windows 身份验证（所有其他检查也为空白）。
*   单击“确定”、“确定”，并覆盖所有子站点的设置，以便使用 NTLM 身份验证“保护”整个站点。
*   回到 IIS 管理器，右键单击 CFIDE 虚拟目录，选择属性
*   目录安全选项卡，编辑身份验证方法。取消选中集成 Windows 身份验证并选中匿名访问。点击 OK，OK 并测试：

```
C:\>wget -S -O - http://localhost/CFIDE/administrator/
--2009-01-21 10:11:59-- http://localhost/CFIDE/administrator/
正在解析本地主机... 127.0.0.1
连接到 localhost|127.0.0.1|:80... 已连接。
已发送 HTTP 请求，等待响应...
  HTTP/1.1 200 正常
  服务器：Microsoft-IIS/5.1
  日期：格林威治标准时间 2009 年 1 月 21 日，星期三 17:12:00
  X-Powered-By: ASP.NET
  Set-Cookie: CFID=712;expires=Fri, 14-Jan-2039 17:12:00 GMT;path=/
  Set-Cookie: CFTOKEN=17139032;expires=Fri, 14-Jan-2039 17:12:00 GMT;path=/
  设置 Cookie：CFAUTHORIZATION_cfadmin=;expires=Mon, 21-Jan-2008 17:12:00 GMT;path=/
  缓存控制：无缓存
  内容类型：文本/html；字符集=UTF-8
长度：未指定 [text/html]
保存到：`STDOUT'

    ... html 输出如下 ...

```

到目前为止一切顺利，CFIDE 目录和至少一个子目录似乎在没有 NTLM 身份验证的情况下工作。所以我启动了 Eclipse 并尝试建立一个 RDS 连接。不幸的是，我只收到拒绝访问消息。进一步调查，似乎 Eclipse 正在尝试与 /CFIDE/main/ide.cfm 通信 - 很公平，再次拉出可信赖的 wget 看看 IIS 在做什么：

```
C:\>wget -S -O - http://localhost/CFIDE/main/ide.cfm
--2009-01-21 10:16:56-- http://localhost/CFIDE/main/ide.cfm
正在解析本地主机... 127.0.0.1
连接到 localhost|127.0.0.1|:80... 已连接。
已发送 HTTP 请求，等待响应...
  HTTP/1.1 401 访问被拒绝
  服务器：Microsoft-IIS/5.1
  日期：格林威治标准时间 2009 年 1 月 21 日，星期三 17:16:56
  WWW-认证：协商
  WWW-认证：NTLM
  内容长度：4431
  内容类型：文本/html
授权失败。

```

其他地方记录的一个潜在问题是主目录和 ide.cfm 页面实际上并不存在于磁盘上。IIS 配置为将所有 .cfm 文件移交给 JRun，而 JRun 配置为将 ide.cfm 映射到 RDS servlet。为了让 IIS 更加明智，我在磁盘上放置了一个主目录和一个空的 ide.cfm 文件，希望它能解决身份验证问题，但没有任何区别。

作为解决方法，我可以做的是将整个站点保留为匿名访问，然后只启用特定的应用程序文件夹以使用 NTLM 集成身份验证，但实际上有数百个可能的 Web 应用程序我必须这样做。呸。

请帮忙！！！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-21T20:09:35.153

回答你自己的问题有些奇怪，但我终于解决了。

*   可以为整个网站启用 NTLM 集成身份验证
*   必须为**CFIDE**虚拟目录启用匿名访问
*   必须为**JRunScripts**虚拟目录启用匿名访问

一旦**CFIDE**和**JRunScripts**都启用了匿名访问，RDS 和通过 Eclipse 进行的调试就像一个魅力。

# svn - 在颠覆中看到许多提交的组合差异？

> ID：466195
> 
> 赞同：14
> 
> 时间：2009-01-21T17:23:15.847
> 
> 标签：svn

我被要求查看 SVN 修订号 123、178、199、245 和 288 中所做的更改——这些都是与特定功能相关的所有提交。解决这个问题的合理方法是什么？我想我真的很想以某种方式查看收集的差异，但我愿意接受建议。我们现在正在修订 400。

编辑：我想知道如何在 subversion 中从命令行执行操作，但也欢迎任何适用于 eclipse 或 intellij idea（或任何单独的应用程序）的解决方案。我也故意对*我*真正希望自动化/获得工具支持的内容持开放态度，因为我真的不知道如何以聪明的方式做到这一点。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-21T17:26:58.117

生成五个不同的提交，并将它们全部与patchutils[中的](http://cyberelk.net/tim/patchutils/man/rn01re02.html)[combineiff](http://cyberelk.net/tim/software/patchutils/)结合起来。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-22T08:40:22.517

在深入研究 IntelliJ 想法后，我找到了一个很好的解决方案：

选择版本控制 | 显示更改视图。

在左侧，您选择存储库并单击您要查看的所有修订。

在右侧窗格中，您将获得受所选修订影响的所有文件的列表。当您选择“差异”时，您将看到所选变更集中的内部更改。未显示提交中发生的内部返工（如预期的那样）

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-21T18:30:09.207

[我问了一个关于为代码审查提取相关更改](https://stackoverflow.com/questions/78339/extract-relevant-changes-for-code-review)的类似问题，但没有得到满意的答案。我最接近解决方案的是做我提到的，创建一个临时分支，然后将有趣的提交挑选到该临时分支中。如果它们干净地结合在一起，那么可以立即审查整个增量。如果它们没有干净地结合并依赖于另一个不相关的更改，也许这意味着无论如何都应该一次审查全部内容。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-26T16:31:39.590

尽管这个问题早就结束了，但我今天实际上写了一个脚本，大致是这样的：

```
 #!/bin/bash

REVISIONS=$@
LAST_REVISION="NULL"
MASTER="master"                             # path to WC

for THIS_REVISION in ${REVISIONS[@]};
do 
    if [ "$LAST_REVISION" != "NULL" ];
    then
        svn diff $MASTER -r ${LAST_REVISION}:${THIS_REVISION} --summarize | while read f;   
        do
            echo ${f#* } | sed "s/[a-zA-Z0-9:\/.]*$MASTER\///" >> "$LAST_REVISION-to-$THIS_REVISION.log"
        done
    fi

    LAST_REVISION=$THIS_REVISION
done 
```

您可以将其称为“my_diff_script.sh rev1 rev2 rev3 rev4”

输出将是：

```
rev1 到 rev2.log
rev2 到 rev3.log
rev3 到 rev4.log

```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-21T17:27:27.630

[bentin](https://stackoverflow.com/users/33412/bendin)对[这个](https://stackoverflow.com/questions/282802/how-can-i-view-all-historical-changes-to-a-file-in-svn)问题的回答具有打印收集到的文件所有修订版本的差异的功能。可以轻松修改它以打印您感兴趣的修订的收集差异。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-21T17:44:32.527

您没有指定是否要基于差异的 HEAD 或每个连续的 REV 编号（我不确定您为什么要实际这样做？（如果您不是故意的，请不要提交））。

```
 #!/bin/bash
for revision in 123 178 199 245 288;
do
          svn diff http://path/to/svn/file@HEAD http://path/to/svn/file@$revision > $revision.diff
done 
```

拜托，windows 粉丝们，给我投反对票，因为我的回答涉及 bash shell 而不是 windows shell（尽管原始帖子从未提及操作系统）

# .net - 如何检测是否可以显示窗口？

> ID：466199
> 
> 赞同：2
> 
> 时间：2009-01-21T17:23:56.327
> 
> 标签：.net, windows-services

当应用程序作为 Windows 服务（用 .NET 编写）运行时，检测用户是否登录以及用户登录时能够开始显示必要对话框的最佳方法是什么？或者当该用户已注销时，可以防止显示对话框？

我希望我的措辞正确:)

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-21T17:33:47.057

您根本不应该从服务中执行此操作。首先，默认情况下服务无权访问桌面。您可以通过选中服务属性对话框上的“允许服务与桌面交互”复选框在 Vista 之前的 Windows 版本中更改此设置，但这是一个非常非常糟糕的主意。

在 Vista 中，服务根本无法与桌面交互。

您假设当时机器上只有一个交互式用户，但情况并非总是如此。由于终端服务，您可以让多个用户登录到交互式会话。

你应该做的是创建一个小的客户端程序，它在用户登录时启动。这个程序将通过一些分布式技术（如 Remoting，或 WCF，我推荐后者）与服务交互。基于从服务器接收到的通信，该客户端程序可以启动对话框和用户界面元素以与用户交互。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-21T17:36:01.670

无论用户是否登录，您都无法从您的服务中显示任何 UI。出于安全原因，该服务将在不同的桌面上运行 - 可以解决此问题，但请不要这样做。最好的办法是有一个单独的程序来显示你的 UI，然后在两者之间使用某种形式的进程间通信。

# sql-server-2005 - 将数据从表导出到 SQL 脚本

> ID：466202
> 
> 赞同：3
> 
> 时间：2009-01-21T17:24:57.263
> 
> 标签：sql-server-2005, import, export

在 SQL Server 2005 中，有没有一种方法可以从具有多行的表中创建 INSERT 脚本？很多时候，在开发过程中，我需要删除表并重新创建它。我最终不得不手动添加以前存在的行。我在删除表之前使用了 SELECT FOR XML AUTO，但在将行插入新表之前仍然需要一些手动干预。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-01-21T17:28:42.887

获取[SSMS 工具包](http://www.ssmstoolspack.com/)，其中包含大量 SQL Server Management Studio 附加组件。其中之一包括一个 INSERT 脚本生成，它应该就在你的小巷里。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-21T17:29:12.247

```
SELECT 'insert into table1 (fielda,fieldb,fieldc) values (''' + fielda + ''',''' + fieldb + ''',''' + fieldc + ''')' AS InsertCmd 
FROM table1 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2011-10-11T13:20:09.457

另一个需要考虑的工具是[MS 数据库发布向导](http://www.microsoft.com/download/en/details.aspx?displaylang=en&id=5498)。它更多地是为大规模数据库导出而设计的，但它还包括一个 SQL 生成向导。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-21T17:28:40.140

我推荐我的世代。它是免费的代码生成工具，它有一个从数据库生成插入的模板。您可以选择单个或多个表。

另一种方法稍微复杂一些，但不需要额外的工具。您可以将数据导出到另一个数据库，然后在重新创建测试数据库时使用导入/导出任务将它们导入回来。您可以将导入任务保存为 SSIS 包，这样您就可以一次又一次地运行 pacakge。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-21T17:28:11.297

为您的数据库使用“任务”菜单中的“导入/导出数据”选项。然后，您可以编写表、存储过程和其他数据库对象的脚本。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-03-07T11:40:02.640

尝试 [用于 SSMS 的 SQL 格式化程序加载项](http://ssmsaddins.codeplex.com/)

# python - 如何在 Windows 上运行的 PyQt 应用程序中隐藏控制台窗口？

> ID：466203
> 
> 赞同：17
> 
> 时间：2009-01-21T17:25:38.663
> 
> 标签：python, windows, command-line, pyqt

这肯定是可能的吗？我一直在寻找 PyQt 教程和文档，但找不到答案。可能我只需要以不同的方式表达我的搜索查询。

[编辑]

感谢 PEZ 的回答 - 更多详细信息，包括[在 Win32 第 20 章 Python 编程](http://www.onlamp.com/pub/a/python/excerpts/chpt20/index.html?page=2)`.pyw`中使用扩展

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2009-01-21T17:28:34.150

我认为您应该能够使用 pythonw.exe 运行您的应用程序。

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2009-01-21T17:39:19.683

一个简单的方法是给你的脚本一个 .pyw 扩展名，而不是通常的 .py。

这与 PEZ 的答案具有相同的效果（使用 pythonw.exe 运行脚本）。

# c - 四舍五入到 2 的下一个幂

> ID：466204
> 
> 赞同：239
> 
> 时间：2009-01-21T17:26:18.103
> 
> 标签：c, optimization, bit-manipulation

我想编写一个返回最接近 2 的下一个幂的函数。例如，如果我的输入是 789，则输出应该是 1024。有没有什么方法可以在不使用任何循环而只使用一些位运算符的情况下实现这一点？

* * *

## 回答 #1

> 赞同：189
> 
> 时间：2009-01-21T17:30:53.647

检查[Bit Twiddling Hacks](https://graphics.stanford.edu/~seander/bithacks.html#RoundUpPowerOf2)。你需要得到以 2 为底的对数，然后加 1。32 位值的示例：

> 向上取整到 2 的次幂
> 
> ```
> unsigned int v; // compute the next highest power of 2 of 32-bit v
> 
> v--;
> v |= v >> 1;
> v |= v >> 2;
> v |= v >> 4;
> v |= v >> 8;
> v |= v >> 16;
> v++; 
> ```

扩展到其他宽度应该是显而易见的。

* * *

## 回答 #2

> 赞同：85
> 
> 时间：2009-01-21T17:35:46.833

```
next = pow(2, ceil(log(x)/log(2))); 
```

这可以通过找到你要提高 2 来得到 x 的数字来工作（取数字的对数，然后除以所需基数的对数，[更多信息请参见维基百科](http://en.wikipedia.org/wiki/Logarithm#Change_of_base)）。然后用 ceil 将其四舍五入以获得最接近的整数幂。

这是一种比其他地方链接的按位方法更通用（即更慢！）的方法，但是很高兴了解数学，是吗？

* * *

## 回答 #3

> 赞同：68
> 
> 时间：2012-09-20T04:46:22.680

我认为这也有效：

```
int power = 1;
while(power < x)
    power*=2; 
```

答案是`power`。

* * *

## 回答 #4

> 赞同：53
> 
> 时间：2009-01-21T17:39:19.107

```
unsigned long upper_power_of_two(unsigned long v)
{
    v--;
    v |= v >> 1;
    v |= v >> 2;
    v |= v >> 4;
    v |= v >> 8;
    v |= v >> 16;
    v++;
    return v;

} 
```

* * *

## 回答 #5

> 赞同：40
> 
> 时间：2012-04-13T14:59:37.463

如果你使用 GCC，你可能想看看Lockless Inc.的[Optimizing the next_pow2()](http://locklessinc.com/articles/next_pow2/ "优化 next_pow() 函数")`builtin_clz()` function汇编指令`bsr`（位扫描反向），就像它在[另一个答案](https://stackoverflow.com/a/466385/611560 "mafutrct 的回答")的[链接到 gamedev 站点](http://www.gamedev.net/topic/229831-nearest-power-of-2/ "Gamedev.net 上 2 的最近幂")中描述的一样。此代码可能[比先前答案](https://stackoverflow.com/a/466278/611560 "Eclipse 的回答")中描述的更快。

顺便说一句，如果你不打算使用汇编指令和 64 位数据类型，你可以使用这个

```
/**
 * return the smallest power of two value
 * greater than x
 *
 * Input range:  [2..2147483648]
 * Output range: [2..2147483648]
 *
 */
__attribute__ ((const))
static inline uint32_t p2(uint32_t x)
{
#if 0
    assert(x > 1);
    assert(x <= ((UINT32_MAX/2) + 1));
#endif

    return 1 << (32 - __builtin_clz (x - 1));
} 
```

* * *

## 回答 #6

> 赞同：19
> 
> 时间：2014-07-19T20:46:54.403

还有一个，虽然我用的是循环，但是这比数学操作数快多了

两个“地板”选项的幂：

```
int power = 1;
while (x >>= 1) power <<= 1; 
```

两个“ceil”选项的幂：

```
int power = 2;
x--;    // <<-- UPDATED
while (x >>= 1) power <<= 1; 
```

* * *

**更新**

如评论中所述`ceil`，其结果错误的地方存在错误。

以下是完整的功能：

```
unsigned power_floor(unsigned x) {
    int power = 1;
    while (x >>= 1) power <<= 1;
    return power;
}

unsigned power_ceil(unsigned x) {
    if (x <= 1) return 1;
    int power = 2;
    x--;
    while (x >>= 1) power <<= 1;
    return power;
} 
```

* * *

## 回答 #7

> 赞同：13
> 
> 时间：2015-01-13T05:31:42.707

对于任何无符号类型，以 Bit Twiddling Hacks 为基础：

```
#include <climits>
#include <type_traits>

template <typename UnsignedType>
UnsignedType round_up_to_power_of_2(UnsignedType v) {
  static_assert(std::is_unsigned<UnsignedType>::value, "Only works for unsigned types");
  v--;
  for (size_t i = 1; i < sizeof(v) * CHAR_BIT; i *= 2) //Prefer size_t "Warning comparison between signed and unsigned integer"
  {
    v |= v >> i;
  }
  return ++v;
} 
```

那里没有真正的循环，因为编译器在编译时知道迭代次数。

* * *

## 回答 #8

> 赞同：11
> 
> 时间：2019-01-24T07:24:43.420

尽管问题被标记为`c`这里我的五美分。幸运的是，C++ 20 将包括`std::ceil2`and `std::floor2`（见[这里](https://en.cppreference.com/w/cpp/header/bit)）。它是`consexpr`模板函数，当前的[GCC 实现](https://github.com/gcc-mirror/gcc/blob/master/libstdc%2B%2B-v3/include/std/bit)使用位移位并​​适用于任何整数无符号类型。

* * *

## 回答 #9

> 赞同：9
> 
> 时间：2009-01-21T18:15:42.433

对于 IEEE 浮点数，你可以做这样的事情。

```
int next_power_of_two(float a_F){
    int f = *(int*)&a_F;
    int b = f << 9 != 0; // If we're a power of two this is 0, otherwise this is 1

    f >>= 23; // remove factional part of floating point number
    f -= 127; // subtract 127 (the bias) from the exponent

    // adds one to the exponent if were not a power of two, 
    // then raises our new exponent to the power of two again.
    return (1 << (f + b)); 
} 
```

如果您需要整数解决方案并且能够使用内联汇编，BSR 将为您提供 x86 上整数的 log2。它计算设置了多少正确位，恰好等于该数字的 log2。其他处理器（通常）具有类似的指令，例如 CLZ，并且根据您的编译器，可能有一个内在函数可以为您完成工作。

* * *

## 回答 #10

> 赞同：9
> 
> 时间：2021-04-06T19:50:36.947

在标准`c++20`中，这包含在`<bit>`. 答案很简单

```
#include <bit>
unsigned long upper_power_of_two(unsigned long v)
{
    return std::bit_ceil(v);
} 
```

* * *

**注意：** 我给出的解决方案是`c++`，而不是`c`，我会回答[这个](https://stackoverflow.com/questions/364985/algorithm-for-finding-the-smallest-power-of-two-thats-greater-or-equal-to-a-giv)问题，但它作为这个问题的副本被关闭了！

* * *

## 回答 #11

> 赞同：6
> 
> 时间：2016-03-31T15:49:08.747

在 x86 中，您可以使用 sse4 位操作指令来加快速度。

```
//assume input is in eax
mov    ecx,31      
popcnt edx,eax   //cycle 1
lzcnt  eax,eax   //cycle 2
sub    ecx,eax
mov    eax,1
cmp    edx,1     //cycle 3
jle @done        //cycle 4 - popcnt says its a power of 2, return input unchanged
shl    eax,cl    //cycle 5
@done: rep ret   //cycle 5 
```

在 c 中，您可以使用匹配的内在函数。

或无跳跃，它通过避免由于跳跃而导致的错误预测来加速事情，但通过延长依赖链来减慢事情的速度。对代码计时，看看哪个最适合您。

```
//assume input is in eax
mov    ecx,31
popcnt edx,eax    //cycle 1
lzcnt  eax,eax
sub    ecx,eax
mov    eax,1      //cycle 2
cmp    edx,1
mov    edx,0     //cycle 3 
cmovle ecx,edx   //cycle 4 - ensure eax does not change
shl    eax,cl    
@done: rep ret   //cycle 5 
```

* * *

## 回答 #12

> 赞同：5
> 
> 时间：2013-11-27T07:21:26.347

```
/*
** http://graphics.stanford.edu/~seander/bithacks.html#IntegerLog
*/
#define __LOG2A(s) ((s &0xffffffff00000000) ? (32 +__LOG2B(s >>32)): (__LOG2B(s)))
#define __LOG2B(s) ((s &0xffff0000)         ? (16 +__LOG2C(s >>16)): (__LOG2C(s)))
#define __LOG2C(s) ((s &0xff00)             ? (8  +__LOG2D(s >>8)) : (__LOG2D(s)))
#define __LOG2D(s) ((s &0xf0)               ? (4  +__LOG2E(s >>4)) : (__LOG2E(s)))
#define __LOG2E(s) ((s &0xc)                ? (2  +__LOG2F(s >>2)) : (__LOG2F(s)))
#define __LOG2F(s) ((s &0x2)                ? (1)                  : (0))

#define LOG2_UINT64 __LOG2A
#define LOG2_UINT32 __LOG2B
#define LOG2_UINT16 __LOG2C
#define LOG2_UINT8  __LOG2D

static inline uint64_t
next_power_of_2(uint64_t i)
{
#if defined(__GNUC__)
    return 1UL <<(1 +(63 -__builtin_clzl(i -1)));
#else
    i =i -1;
    i =LOG2_UINT64(i);
    return 1UL <<(1 +i);
#endif
} 
```

如果您不想冒险进入未定义行为的领域，则输入值必须介于 1 和 2^63 之间。该宏对于在编译时设置常量也很有用。

* * *

## 回答 #13

> 赞同：5
> 
> 时间：2018-10-29T07:32:33.417

这是我在 C 中的解决方案。希望这会有所帮助！

```
int next_power_of_two(int n) {
    int i = 0;
    for (--n; n > 0; n >>= 1) {
        i++;
    }
    return 1 << i;
} 
```

* * *

## 回答 #14

> 赞同：4
> 
> 时间：2013-12-29T00:24:29.070

为了完整起见，这里是沼泽标准 C 中的浮点实现。

```
double next_power_of_two(double value) {
    int exp;
    if(frexp(value, &exp) == 0.5) {
        // Omit this case to round precise powers of two up to the *next* power
        return value;
    }
    return ldexp(1.0, exp);
} 
```

* * *

## 回答 #15

> 赞同：4
> 
> 时间：2018-07-31T20:17:29.610

用于整数输入的 C/C++ 中高效的 Microsoft（例如 Visual Studio 2017）特定解决方案。通过在检查最高有效 1 位的位置之前递减来处理输入与两个值的幂完全匹配的情况。

```
inline unsigned int ExpandToPowerOf2(unsigned int Value)
{
    unsigned long Index;
    _BitScanReverse(&Index, Value - 1);
    return (1U << (Index + 1));
}

// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

#if defined(WIN64) // The _BitScanReverse64 intrinsic is only available for 64 bit builds because it depends on x64

inline unsigned long long ExpandToPowerOf2(unsigned long long Value)
{
    unsigned long Index;
    _BitScanReverse64(&Index, Value - 1);
    return (1ULL << (Index + 1));
}

#endif 
```

这会为英特尔处理器生成 5 个左右的内联指令，类似于以下内容：

```
dec eax
bsr rcx, rax
inc ecx
mov eax, 1
shl rax, cl 
```

显然，Visual Studio C++ 编译器没有针对编译时值进行优化，但它不像那里有很多指令。

编辑：

如果您希望输入值 1 产生 1（2 的零次方），则对上述代码的小修改仍会生成没有分支的直通指令。

```
inline unsigned int ExpandToPowerOf2(unsigned int Value)
{
    unsigned long Index;
    _BitScanReverse(&Index, --Value);
    if (Value == 0)
        Index = (unsigned long) -1;
    return (1U << (Index + 1));
} 
```

只生成更多指令。诀窍是 Index 可以被一个测试替换，然后是一个 cmove 指令。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2019-10-16T11:00:40.993

您可能会发现以下说明有助于实现您的目的：

[![](https://i.stack.imgur.com/V6fin.png)](https://i.stack.imgur.com/V6fin.png)

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2020-10-23T03:25:09.067

C# 中的可移植解决方案：

```
int GetNextPowerOfTwo(int input) {
    return 1 << (int)Math.Ceiling(Math.Log2(input));
} 
```

`Math.Ceiling(Math.Log2(value))`计算二的下一个幂的指数，通过`1 <<`位移计算实际值。

如果您拥有 .NET Core 3 或更高版本，则更快的解决方案：

```
uint GetNextPowerOfTwoFaster(uint input) {
    return (uint)1 << (sizeof(uint) * 8 - System.Numerics.BitOperations.LeadingZeroCount(input - 1));
} 
```

如果可用，这将`System.Numerics.BitOperations.LeadingZeroCount()`使用硬件指令：

[https://github.com/dotnet/corert/blob/master/src/System.Private.CoreLib/shared/System/Numerics/BitOperations.cs](https://github.com/dotnet/corert/blob/master/src/System.Private.CoreLib/shared/System/Numerics/BitOperations.cs)

**更新：**

[RoundUpToPowerOf2()](https://docs.microsoft.com/en-us/dotnet/api/system.numerics.bitoperations.rounduptopowerof2?view=net-6.0#System_Numerics_BitOperations_RoundUpToPowerOf2_System_UInt64_)即将[在 .NET 6 中出现](https://github.com/dotnet/runtime/issues/43135)！内部实现与上面的 .NET Core 3 解决方案基本相同。

这是[社区更新](https://devblogs.microsoft.com/dotnet/new-dotnet-6-apis-driven-by-the-developer-community/)。

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2021-07-01T03:25:55.280

试图为此制定一个“终极”解决方案。以下代码

*   针对 C 语言（不是 C++），

*   如果编译器支持任何代码，则使用编译器内置程序生成高效代码（[CLZ 或 BSR 指令），](https://en.wikipedia.org/wiki/Find_first_set)

*   是可移植的（标准 C 和无程序集），除了内置的，并且

*   解决所有未定义的行为。

如果您使用 C++ 编写，您可以适当地调整代码。请注意，C++20 引入了[std::bit_ceil](https://en.cppreference.com/w/cpp/numeric/bit_ceil)，它的作用完全相同，只是在某些条件下行为可能未定义。

```
#include <limits.h>

#ifdef _MSC_VER
# if _MSC_VER >= 1400
/* _BitScanReverse is introduced in Visual C++ 2005 and requires
   <intrin.h> (also introduced in Visual C++ 2005). */
#include <intrin.h>
#pragma intrinsic(_BitScanReverse)
#pragma intrinsic(_BitScanReverse64)
#  define HAVE_BITSCANREVERSE 1
# endif
#endif

/* Macro indicating that the compiler supports __builtin_clz().
   The name HAVE_BUILTIN_CLZ seems to be the most common, but in some
   projects HAVE__BUILTIN_CLZ is used instead. */
#ifdef __has_builtin
# if __has_builtin(__builtin_clz)
#  define HAVE_BUILTIN_CLZ 1
# endif
#elif defined(__GNUC__)
# if (__GNUC__ > 3)
#  define HAVE_BUILTIN_CLZ 1
# elif defined(__GNUC_MINOR__)
#  if (__GNUC__ == 3 && __GNUC_MINOR__ >= 4)
#   define HAVE_BUILTIN_CLZ 1
#  endif
# endif
#endif

/**
 * Returns the smallest power of two that is not smaller than x.
 */
unsigned long int next_power_of_2_long(unsigned long int x)
{
    if (x <= 1) {
        return 1;
    }
    x--;

#ifdef HAVE_BITSCANREVERSE
    if (x > (ULONG_MAX >> 1)) {
        return 0;
    } else {
        unsigned long int index;
        (void) _BitScanReverse(&index, x);
        return (1UL << (index + 1));
    }
#elif defined(HAVE_BUILTIN_CLZ)
    if (x > (ULONG_MAX >> 1)) {
        return 0;
    }
    return (1UL << (sizeof(x) * CHAR_BIT - __builtin_clzl(x)));
#else
    /* Solution from "Bit Twiddling Hacks"
       <http://www.graphics.stanford.edu/~seander/bithacks.html#RoundUpPowerOf2>
       but converted to a loop for smaller code size.
       ("gcc -O3" will unroll this.) */
    {
        unsigned int shift;
        for (shift = 1; shift < sizeof(x) * CHAR_BIT; shift <<= 1) {
            x |= (x >> shift);
        }
    }
    return (x + 1);
#endif
}

unsigned int next_power_of_2(unsigned int x)
{
    if (x <= 1) {
        return 1;
    }
    x--;

#ifdef HAVE_BITSCANREVERSE
    if (x > (UINT_MAX >> 1)) {
        return 0;
    } else {
        unsigned long int index;
        (void) _BitScanReverse(&index, x);
        return (1U << (index + 1));
    }
#elif defined(HAVE_BUILTIN_CLZ)
    if (x > (UINT_MAX >> 1)) {
        return 0;
    }
    return (1U << (sizeof(x) * CHAR_BIT - __builtin_clz(x)));
#else
    {
        unsigned int shift;
        for (shift = 1; shift < sizeof(x) * CHAR_BIT; shift <<= 1) {
            x |= (x >> shift);
        }
    }
    return (x + 1);
#endif
}

unsigned long long next_power_of_2_long_long(unsigned long long x)
{
    if (x <= 1) {
        return 1;
    }
    x--;

#if (defined(HAVE_BITSCANREVERSE) && \
    ULLONG_MAX == 18446744073709551615ULL)
    if (x > (ULLONG_MAX >> 1)) {
        return 0;
    } else {
        /* assert(sizeof(__int64) == sizeof(long long)); */
        unsigned long int index;
        (void) _BitScanReverse64(&index, x);
        return (1ULL << (index + 1));
    }
#elif defined(HAVE_BUILTIN_CLZ)
    if (x > (ULLONG_MAX >> 1)) {
        return 0;
    }
    return (1ULL << (sizeof(x) * CHAR_BIT - __builtin_clzll(x)));
#else
    {
        unsigned int shift;
        for (shift = 1; shift < sizeof(x) * CHAR_BIT; shift <<= 1) {
            x |= (x >> shift);
        }
    }
    return (x + 1);
#endif
} 
```

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2021-09-15T07:28:01.913

用于 C++14 的 clp2 的 constexpr 版本

```
#include <iostream>
#include <type_traits>

// Closest least power of 2 minus 1\. Returns 0 if n = 0.
template <typename UInt, std::enable_if_t<std::is_unsigned<UInt>::value,int> = 0>
  constexpr UInt clp2m1(UInt n, unsigned i = 1) noexcept
    { return i < sizeof(UInt) * 8 ? clp2m1(UInt(n | (n >> i)),i << 1) : n; }

/// Closest least power of 2 minus 1\. Returns 0 if n <= 0.
template <typename Int, std::enable_if_t<std::is_integral<Int>::value && std::is_signed<Int>::value,int> = 0>
  constexpr auto clp2m1(Int n) noexcept
    { return clp2m1(std::make_unsigned_t<Int>(n <= 0 ? 0 : n)); }

/// Closest least power of 2\. Returns 2^N: 2^(N-1) < n <= 2^N. Returns 0 if n <= 0.
template <typename Int, std::enable_if_t<std::is_integral<Int>::value,int> = 0>
  constexpr auto clp2(Int n) noexcept
    { return clp2m1(std::make_unsigned_t<Int>(n-1)) + 1; }

/// Next power of 2\. Returns 2^N: 2^(N-1) <= n < 2^N. Returns 1 if n = 0\. Returns 0 if n < 0.
template <typename Int, std::enable_if_t<std::is_integral<Int>::value,int> = 0>
  constexpr auto np2(Int n) noexcept
    { return clp2m1(std::make_unsigned_t<Int>(n)) + 1; }

template <typename T>
  void test(T v) { std::cout << clp2(v) << std::endl; }

int main()
{
    test(-5);                          // 0
    test(0);                           // 0
    test(8);                           // 8
    test(31);                          // 32
    test(33);                          // 64
    test(789);                         // 1024
    test(char(260));                   // 4
    test(unsigned(-1) - 1);            // 0
    test<long long>(unsigned(-1) - 1); // 4294967296

    return 0;
} 
```

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2013-10-04T21:52:25.900

许多处理器架构支持`log base 2`或非常相似的操作—— `count leading zeros`. 许多编译器都有它的内在函数。见[https://en.wikipedia.org/wiki/Find_first_set](https://en.wikipedia.org/wiki/Find_first_set)

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2016-08-19T02:10:58.007

假设你有一个好的编译器并且它可以在我上面做一些之前的操作，但无论如何这有效！！！

```
 // http://graphics.stanford.edu/~seander/bithacks.html#IntegerLogObvious
    #define SH1(v)  ((v-1) | ((v-1) >> 1))            // accidently came up w/ this...
    #define SH2(v)  ((v) | ((v) >> 2))
    #define SH4(v)  ((v) | ((v) >> 4))
    #define SH8(v)  ((v) | ((v) >> 8))
    #define SH16(v) ((v) | ((v) >> 16))
    #define OP(v) (SH16(SH8(SH4(SH2(SH1(v))))))         

    #define CB0(v)   ((v) - (((v) >> 1) & 0x55555555))
    #define CB1(v)   (((v) & 0x33333333) + (((v) >> 2) & 0x33333333))
    #define CB2(v)   ((((v) + ((v) >> 4) & 0xF0F0F0F) * 0x1010101) >> 24)
    #define CBSET(v) (CB2(CB1(CB0((v)))))
    #define FLOG2(v) (CBSET(OP(v))) 
```

测试代码如下：

```
#include <iostream>

using namespace std;

// http://graphics.stanford.edu/~seander/bithacks.html#IntegerLogObvious
#define SH1(v)  ((v-1) | ((v-1) >> 1))  // accidently guess this...
#define SH2(v)  ((v) | ((v) >> 2))
#define SH4(v)  ((v) | ((v) >> 4))
#define SH8(v)  ((v) | ((v) >> 8))
#define SH16(v) ((v) | ((v) >> 16))
#define OP(v) (SH16(SH8(SH4(SH2(SH1(v))))))         

#define CB0(v)   ((v) - (((v) >> 1) & 0x55555555))
#define CB1(v)   (((v) & 0x33333333) + (((v) >> 2) & 0x33333333))
#define CB2(v)   ((((v) + ((v) >> 4) & 0xF0F0F0F) * 0x1010101) >> 24)
#define CBSET(v) (CB2(CB1(CB0((v)))))
#define FLOG2(v) (CBSET(OP(v))) 

#define SZ4         FLOG2(4)
#define SZ6         FLOG2(6)
#define SZ7         FLOG2(7)
#define SZ8         FLOG2(8) 
#define SZ9         FLOG2(9)
#define SZ16        FLOG2(16)
#define SZ17        FLOG2(17)
#define SZ127       FLOG2(127)
#define SZ1023      FLOG2(1023)
#define SZ1024      FLOG2(1024)
#define SZ2_17      FLOG2((1ul << 17))  // 
#define SZ_LOG2     FLOG2(SZ)

#define DBG_PRINT(x) do { std::printf("Line:%-4d" "  %10s = %-10d\n", __LINE__, #x, x); } while(0);

uint32_t arrTble[FLOG2(63)];

int main(){
    int8_t n;

    DBG_PRINT(SZ4);    
    DBG_PRINT(SZ6);    
    DBG_PRINT(SZ7);    
    DBG_PRINT(SZ8);    
    DBG_PRINT(SZ9); 
    DBG_PRINT(SZ16);
    DBG_PRINT(SZ17);
    DBG_PRINT(SZ127);
    DBG_PRINT(SZ1023);
    DBG_PRINT(SZ1024);
    DBG_PRINT(SZ2_17);

    return(0);
} 
```

输出：

```
Line:39           SZ4 = 2
Line:40           SZ6 = 3
Line:41           SZ7 = 3
Line:42           SZ8 = 3
Line:43           SZ9 = 4
Line:44          SZ16 = 4
Line:45          SZ17 = 5
Line:46         SZ127 = 7
Line:47        SZ1023 = 10
Line:48        SZ1024 = 10
Line:49        SZ2_16 = 17 
```

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2017-01-16T22:23:03.527

我正在尝试获得最接近 2 的较低幂并制作此功能。可能对您有所帮助。只需将最接近的较低数字乘以 2 即可获得 2 的最接近的上幂

```
int nearest_upper_power(int number){
    int temp=number;
    while((number&(number-1))!=0){
        temp<<=1;
        number&=temp;
    }
    //Here number is closest lower power 
    number*=2;
    return number;
} 
```

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2018-09-25T08:01:24.320

改编了 Paul Dixon 对 Excel 的回答，效果很好。

```
 =POWER(2,CEILING.MATH(LOG(A1)/LOG(2))) 
```

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2018-10-09T16:39:07.280

@YannDroneaud 答案的变体对 有效`x==1`，仅适用于 x86 平台、编译器、gcc 或 clang：

```
__attribute__ ((const))
static inline uint32_t p2(uint32_t x)
{
#if 0
    assert(x > 0);
    assert(x <= ((UINT32_MAX/2) + 1));
#endif
  int clz;
  uint32_t xm1 = x-1;
  asm(
    "lzcnt %1,%0"
    :"=r" (clz)
    :"rm" (xm1)
    :"cc"
    );
    return 1 << (32 - clz);
} 
```

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2019-02-15T20:19:51.913

如果输入是常量表达式，这就是我用来使其成为常量表达式的方法。

```
#define uptopow2_0(v) ((v) - 1)
#define uptopow2_1(v) (uptopow2_0(v) | uptopow2_0(v) >> 1)
#define uptopow2_2(v) (uptopow2_1(v) | uptopow2_1(v) >> 2)
#define uptopow2_3(v) (uptopow2_2(v) | uptopow2_2(v) >> 4)
#define uptopow2_4(v) (uptopow2_3(v) | uptopow2_3(v) >> 8)
#define uptopow2_5(v) (uptopow2_4(v) | uptopow2_4(v) >> 16)

#define uptopow2(v) (uptopow2_5(v) + 1)  /* this is the one programmer uses */ 
```

例如，像这样的表达式：

```
uptopow2(sizeof (struct foo)) 
```

会很好地减少到一个常数。

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2021-04-26T02:49:55.530

g++ 编译器提供了一个计算前导零的内置函数 __builtin_clz：

所以我们可以这样做：

```
int nextPowerOfTwo(unsigned int x) {
  return 1 << sizeof(x)*8 - __builtin_clz(x);
}

int main () {
  std::cout << nextPowerOfTwo(7)  << std::endl;
  std::cout << nextPowerOfTwo(31) << std::endl;
  std::cout << nextPowerOfTwo(33) << std::endl;
  std::cout << nextPowerOfTwo(8)  << std::endl;
  std::cout << nextPowerOfTwo(91) << std::endl;

  return 0;
} 
```

结果：

```
8
32
64
16
128 
```

但请注意，对于`x == 0`，`__builtin_clz`return 是未定义的。

* * *

## 回答 #27

> 赞同：-1
> 
> 时间：2009-01-21T17:40:57.400

如果你需要 OpenGL 相关的东西：

```
/* Compute the nearest power of 2 number that is 
 * less than or equal to the value passed in. 
 */
static GLuint 
nearestPower( GLuint value )
{
    int i = 1;

    if (value == 0) return -1;      /* Error! */
    for (;;) {
         if (value == 1) return i;
         else if (value == 3) return i*4;
         value >>= 1; i *= 2;
    }
} 
```

* * *

## 回答 #28

> 赞同：-1
> 
> 时间：2019-10-24T08:02:40.370

将其转换为浮点数，然后使用 .hex() 显示标准化的 IEEE 表示。

`>>> float(789).hex() '0x1.8a80000000000p+9'`

然后只需提取指数并加 1。

`>>> int(float(789).hex().split('p+')[1]) + 1 10`

并将 2 提高到这个幂。

`>>> 2 ** (int(float(789).hex().split('p+')[1]) + 1) 1024`

* * *

## 回答 #29

> 赞同：-2
> 
> 时间：2020-02-25T01:55:38.517

```
import sys

def is_power2(x):
    return x > 0 and ((x & (x - 1)) == 0)

def find_nearest_power2(x):
    if x <= 0:
        raise ValueError("invalid input")
    if is_power2(x):
        return x
    else:
        bits = get_bits(x)
        upper = 1 << (bits)
        lower = 1 << (bits - 1)
        mid = (upper + lower) // 2
        if (x - mid) > 0:
            return upper
        else:
            return lower

def get_bits(x):
    """return number of bits in binary representation"""
    if x < 0:
        raise ValueError("invalid input: input should be positive integer")
    count = 0
    while (x != 0):
        try:
            x = x >> 1
        except TypeError as error:
            print(error, "input should be of type integer")
            sys.exit(1)
        count += 1
    return count 
```

* * *

## 回答 #30

> 赞同：-2
> 
> 时间：2020-05-01T08:56:43.307

如果你想要一个单行模板。这里是

```
int nxt_po2(int n) { return 1 + (n|=(n|=(n|=(n|=(n|=(n-=1)>>1)>>2)>>4)>>8)>>16); } 
```

或者

```
int nxt_po2(int n) { return 1 + (n|=(n|=(n|=(n|=(n|=(n-=1)>>(1<<0))>>(1<<1))>>(1<<2))>>(1<<3))>>(1<<4)); } 
```

* * *

## 回答 #31

> 赞同：-2
> 
> 时间：2021-10-22T10:00:36.193

```
from math import ceil, log2
pot_ceil = lambda N: 0x1 << ceil(log2(N)) 
```

测试：

```
for i in range(10):
    print(i, pot_ceil(i)) 
```

输出：

```
1 1
2 2
3 4
4 4
5 8
6 8
7 8
8 8
9 16
10 16 
```

# javascript - 调整 iframe 大小时如何防止 swf 刷新？

> ID：466240
> 
> 赞同：2
> 
> 时间：2009-01-21T17:30:48.110
> 
> 标签：javascript, firefox, iframe, flash, refresh

我正在调整 iframe 的大小，当我在 Firefox 中这样做时，内容会刷新。

我有一个扩展的 swf，在 Firefox 中，当 iframe 扩展以容纳 swf 时，swf 出现在其正常位置。

在 IE 中，这不会发生。

任何人都知道如何防止在 Firefox 中发生刷新？

谢谢

* * *

**编辑：**

好的，我认为页面没有被刷新，只是 swf 请在以下位置查看：

[http://antoniocs.org/iframe/index_.html](http://antoniocs.org/iframe/index_.html)

您可以看到，在 Firefox 3 中进行重新尺寸调整时会出现快速“闪烁”，并且 swf 会返回其初始状态（未展开），但在 IE 中不会发生这种情况。

代码都是客户端的，因此如果您查看页面的源代码，您可以查看所有代码。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-27T18:04:27.780

安东尼奥，恐怕问题出在 Firefox 中。当 Gecko 检测到 iFrame 的宽度发生变化时，它会重新绘制页面并导致“刷新”。我知道没有办法改变这种行为，除非使用不同的技术。

I confirmed that the problem exists in other Gecko-based browsers as well (specifically Camino and Flock). I was not able to duplicate it in WebKit-based browsers (Chrome and Safari).

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-28T14:54:09.223

It seems to be that either setting `position: absolute;` or `.cssText` will refresh the frame.

The solution is to add `style="position: absolute;"` to your `<iframe>` and set your css like this:

```
this.mrec_div_idObj.style.left = ((offsetLeftIframe) - (dimX - disX)) + "px";
this.mrec_div_idObj.style.top = (offsetTopDiv - disY) + "px";
this.mrec_div_idObj.style.zIndex = 99999999;
this.mrec_div_idObj.style.margin = 0;
this.mrec_div_idObj.style.padding = 0; 
```

I've tested this and it **works in Firefox 3**.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-22T09:04:56.477

没有 onresize 代码。

这很简单！我有一个宽度为 300 和高度为 250 的 iframe，当我将它们更改为 500 和 400 时，Firefox 会刷新内容，我想防止这种情况发生。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-22T12:11:31.420

这是一个可以查看代码的页面 -> [http://antoniocs.org/iframe/index_.html](http://antoniocs.org/iframe/index_.html)

调整 iframe 大小的代码在 3 秒后运行，您可以看到 swf（如果已扩展）以初始（未扩展）形式出现。

要扩展 swf，只需将鼠标悬停在它上面。

在ie中，iframe中没有刷新。

# c# - 当 TextMode=Password 时 ASP.NET 文本框大小不同

> ID：466248
> 
> 赞同：5
> 
> 时间：2009-01-21T17:33:28.650
> 
> 标签：c#, asp.net

我有一个登录页面，页面上有几个文本框，其中一个的模式设置为“密码”。该页面以前可以使用，但我们最近注意到（自 IE7 更新以来）指定为密码文本框的文本框没有页面上的其他文本框那么宽。如果我删除 TextMode="Password"，文本框会调整大小以匹配其他文本框。

当使用 IE 开发人员工具栏显示页面时，我已经检查了页面上的异常情况，但看起来一切正常。

文本框代码相当基本：

```
 <tr>
  <td>
    Username
  </td>
  <td>
    <asp:TextBox ID="txtUsername" runat="server" TabIndex="2"></asp:TextBox>
  </td>
</tr>
<tr>
  <td>
    Password
  </td>
  <td>
    <asp:TextBox ID="txtPassword" TextMode="Password" runat="server" TabIndex="3"></asp:TextBox>
  </td>
</tr> 
```

我发现另一个人在网上询问这个问题，他们通过对页面上的所有输入控件应用 css 来修复它，但我也没有设法让它工作。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-21T17:38:18.717

确保所有控件具有相同大小的最佳方法是通过样式（内联或 CSS）。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2011-01-05T23:53:48.340

我发现如果您使用以下 CSS：

```
input, select { font-family: sans-serif; } 
```

这将使文本框和密码框的宽度相同。font-family 不必是无衬线字体，但必须定义。

这可能是一个更好的解决方案，因为它似乎可以解决问题，而不是通过在 CSS 中使用显式宽度来解决问题。您现在可以通过使用通用字体系列来使用浏览器的默认字体设置，或者如果您有用于页面的特定字体，则可以显式。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-21T17:35:22.937

如果您为文本框提供 Width="" 属性可能会有所帮助。这应该迫使它们在宽度方面匹配，即使它们具有不同的文本模式。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-21T17:39:00.760

如果您为 TextBox.Columns 属性（映射到 <input size="" /> 属性）指定一个值（如 20），它们将匹配。如果要使用 CSS，应尽量避免使用内联样式（由 TextBox.Width 属性创建）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-06-30T16:10:10.980

您可以尝试将所有文​​本框的 Width 属性设置为相同。150应该是很划算的。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-06-30T16:26:36.007

我认为当您将大小指定为“列”时，密码类型和非密码类型的文本框具有不同的宽度是正常的，因为文本框的宽度是通过乘以字体中最大字符的宽度来计算的（比如说，“m”）按请求的列数。

输入密码时，最大的字符始终是项目符号（所有字符都是项目符号），因此宽度不同（显然使用比例字体时）。要解决此问题，请指定以像素为单位的宽度，而不是列，即：style="width:250px;" （或使用非比例字体）。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2014-09-13T00:10:30.883

我最近在使用 Internet Explorer 11 时遇到了这个问题。我在这里尝试了一切，但没有任何效果，但后来偶然发现了[这篇](http://forums.asp.net/t/1913278.aspx?Any%20known%20IE10%20issues%20with%20textboxes%20)文章。为我解决的问题是这样做：

```
<tr>
    <td style="width: 1000px; text-align: right;">User Name:</td>
    <td style="width: 200px; text-align: right;">
        <asp:TextBox ID="UNTextBox" runat="server" style="width: 200px;"></asp:TextBox>
    </td>
</tr>
<tr>
    <td style="width: 1000px; text-align: right">Password:</td>
    <td style="width: 200px; text-align: right;">
        <asp:TextBox ID="PassTextBox" runat="server" TextMode="Password" style="width: 200px;"></asp:TextBox>
    </td>
</tr> 
```

我必须`style="width: 200px;"`直接放入`asp:TextBox`标签中，否则尺寸在 IE11 中不匹配。

希望对某人有所帮助

# cocoa - 如何使单个 NSView 中显示的所有内容变暗？

> ID：466249
> 
> 赞同：3
> 
> 时间：2009-01-21T17:33:32.143
> 
> 标签：cocoa, nsview, appkit

**背景：**我的应用程序有一个主窗口，其中包含一些较小的`NSView`对象，每个对象都包含几个不同的控件、标签、图像等。这些视图之一（及其包含的所有内容）在响应给定标志时被禁用。设置标志后，我会自动禁用嵌入在该`NSView`.

**问题：**我想知道如何使残疾人*变暗*`NSView`。我正在寻找的效果就像在 disabled 之上绘制一个 50% 透明的黑框`NSView`。背景和所有控件仍然可见，但颜色会变暗。有没有一种简单的方法可以做到这一点？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-21T17:36:18.020

10.5 中的 CoreAnimation 应该提供一种在视图上方放置半透明层的简单方法。您可以在视图前面创建一个黑色图层，不透明度为 0%。当你想使视图变暗时，将黑色图层的不透明度设置为 50%，视图会平滑变暗。

# menu - 这是什么类型的菜单栏？

> ID：466251
> 
> 赞同：0
> 
> 时间：2009-01-21T17:34:07.913
> 
> 标签：menu, menubar

我将在一个站点中构建一个 CSS 菜单栏，类似于[http://www.mightyleaftea.com上的站点](http://www.mightyleaftea.com)

我听说过下拉菜单，但可能在 mayleaftea.com 上的菜单类型是什么？哦，最近[http://www.whitehouse.gov/](http://www.whitehouse.gov/)

这与编程有关。我必须建立菜单...

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-21T17:39:44.673

它看起来像某种[吸盘鱼](http://www.alistapart.com/articles/dropdowns)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-21T17:40:17.450

对我来说，它看起来像一个常规的分层下拉菜单。

试试这个[alistapart 下拉文章](http://www.alistapart.com/articles/dropdowns)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-21T17:39:03.023

看起来它只是一个简单的 DHTML 菜单。

基本上，当您将鼠标悬停在链接上时，他们所做的只是显示菜单 div 的设置。

就像是：

```
document.getElementById('menu_div').style.display = 'block'; 
```

然后在鼠标移出时，您将拥有

```
document.getElementById('menu_div').style.display = 'none'; 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-21T17:37:59.123

它看起来像一个使用 javascript 的下拉菜单。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-21T17:38:57.250

我仍然称它为下拉菜单。碰巧下拉部分比典型的 html 链接列表更多。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-04-08T21:25:27.483

超级菜单或超级下拉菜单

# apache-flex - 在 Sprite 中获取应用于 Flash Sprite 的过滤器边界

> ID：466280
> 
> 赞同：3
> 
> 时间：2009-01-21T17:39:42.413
> 
> 标签：apache-flex, flash, actionscript, sprite, filter

我有一个带有 Sprite 符号的 Flash 库，该符号由其他带有设计时应用过滤器的精灵组成。我将这些符号嵌入到 Flex 应用程序中，如下所示：

```
<mx:Application xmlns:mx="http://www.adobe.com/2006/mxml">
    <mx:Script>
        <![CDATA[
            [Bindable]
            [Embed(source="Resources.swf", symbol="SquareContainer")]
            private var squareContainer_class:Class;

            private function log(msg:String):void {
                    output.text = output.text + "\n" + msg;
            }
        ]]>
    </mx:Script>

    <mx:VBox horizontalAlign="center" width="100%" height="100%" >
        <mx:Image id="squareContainer" source="{squareContainer_class}"/>
        <mx:Button click="log(squareContainer.width + ', ' + squareContainer.height);"/>
        <mx:TextArea id="output" width="100%" height="100%" />
    </mx:VBox>

</mx:Application> 
```

在本例中，SquareContainer 符号为 100px 宽 x 100px 高；但是它包含一个带有发光和模糊滤镜的子精灵，这会导致精灵看起来明显大于 100x100。由于我无法确定容器的组成，因此我无法使用 BitmapData.generateFilterRect() 来获取应用于嵌套精灵的过滤器。

我怎样才能得到精灵的大小加上它的过滤器？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-29T16:30:26.807

哦，甜蜜的成功！（感谢您的提示）一位朋友通过一个很好的递归函数帮助解决了这个问题，以处理嵌套精灵上可能存在的过滤器：

```
private function getDisplayObjectRectangle(container:DisplayObjectContainer, processFilters:Boolean):Rectangle {
    var final_rectangle:Rectangle = processDisplayObjectContainer(container, processFilters);

    // translate to local
    var local_point:Point = container.globalToLocal(new Point(final_rectangle.x, final_rectangle.y));
    final_rectangle = new Rectangle(local_point.x, local_point.y, final_rectangle.width, final_rectangle.height);       

    return final_rectangle;
}

private function processDisplayObjectContainer(container:DisplayObjectContainer, processFilters:Boolean):Rectangle {
    var result_rectangle:Rectangle = null;

    // Process if container exists
    if (container != null) {
        var index:int = 0;
        var displayObject:DisplayObject;

        // Process each child DisplayObject
        for(var childIndex:int = 0; childIndex < container.numChildren; childIndex++){
            displayObject = container.getChildAt(childIndex);

            //If we are recursing all children, we also get the rectangle of children within these children.
            if (displayObject is DisplayObjectContainer) {

                // Let's drill into the structure till we find the deepest DisplayObject
                var displayObject_rectangle:Rectangle = processDisplayObjectContainer(displayObject as DisplayObjectContainer, processFilters);

                // Now, stepping out, uniting the result creates a rectangle that surrounds siblings
                if (result_rectangle == null) { 
                    result_rectangle = displayObject_rectangle.clone(); 
                } else {
                    result_rectangle = result_rectangle.union(displayObject_rectangle);
                }                       
            }                       
        }

        // Get bounds of current container, at this point we're stepping out of the nested DisplayObjects
        var container_rectangle:Rectangle = container.getBounds(container.stage);

        if (result_rectangle == null) { 
            result_rectangle = container_rectangle.clone(); 
        } else {
            result_rectangle = result_rectangle.union(container_rectangle);
        }

        // Include all filters if requested and they exist
        if ((processFilters == true) && (container.filters.length > 0)) {
            var filterGenerater_rectangle:Rectangle = new Rectangle(0,0,result_rectangle.width, result_rectangle.height);
            var bmd:BitmapData = new BitmapData(result_rectangle.width, result_rectangle.height, true, 0x00000000);

            var filter_minimumX:Number = 0;
            var filter_minimumY:Number = 0;

            var filtersLength:int = container.filters.length;
            for (var filtersIndex:int = 0; filtersIndex < filtersLength; filtersIndex++) {                      
                var filter:BitmapFilter = container.filters[filtersIndex];

                var filter_rectangle:Rectangle = bmd.generateFilterRect(filterGenerater_rectangle, filter);

                filter_minimumX = filter_minimumX + filter_rectangle.x;
                filter_minimumY = filter_minimumY + filter_rectangle.y;

                filterGenerater_rectangle = filter_rectangle.clone();
                filterGenerater_rectangle.x = 0;
                filterGenerater_rectangle.y = 0;

                bmd = new BitmapData(filterGenerater_rectangle.width, filterGenerater_rectangle.height, true, 0x00000000);                      
            }

            // Reposition filter_rectangle back to global coordinates
            filter_rectangle.x = result_rectangle.x + filter_minimumX;
            filter_rectangle.y = result_rectangle.y + filter_minimumY;

            result_rectangle = filter_rectangle.clone();
        }               
    } else {
        throw new Error("No displayobject was passed as an argument");
    }

    return result_rectangle;
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2013-01-22T21:05:15.660

这里有一个稍微不同的方法：只需将整个对象绘制进去`BitmapData`，然后计算位图不透明区域的边界。这种方法可能更高效，尤其是在复杂对象上。

```
package lup.utils
{
    import flash.display.BitmapData;
    import flash.display.DisplayObject;
    import flash.geom.Matrix;
    import flash.geom.Point;
    import flash.geom.Rectangle;

    public class BoundsHelper
    {
        private var _hBmd:BitmapData;
        private var _hBmdRect:Rectangle;
        private var _hMtr:Matrix;
        private var _hPoint:Point;

        private var _xMin:Number;
        private var _xMax:Number;
        private var _yMin:Number;
        private var _yMax:Number;

        /**
         * Specify maxFilteredObjWidth and maxFilteredObjHeight to match the maximum possible size
         * of a filtered object. Performance of the helper is inversely proportional to the product
         * of these values.
         *
         * @param maxFilteredObjWidth Maximum width of a filtered object.
         * @param maxFilteredObjHeight Maximum height of a filtered object.
         */
        public function BoundsHelper(maxFilteredObjWidth:Number = 500, maxFilteredObjHeight:Number = 500) {
            _hMtr = new Matrix();
            _hPoint = new Point();
            _hBmd = new BitmapData(maxFilteredObjWidth, maxFilteredObjHeight, true, 0);
            _hBmdRect = new Rectangle(0, 0, maxFilteredObjWidth, maxFilteredObjHeight);
        }

        /**
         * Calculates the boundary rectangle of an object relative to the given coordinate space.
         *
         * @param obj The object which bounds are to be determined.
         *
         * @param space The coordinate space relative to which the bounds should be represented.
         *        If you pass null or the object itself, then the bounds will be represented
         *        relative to the (untransformed) object.
         *
         * @param dst Destination rectangle to store the result in. If you pass null,
         *        new rectangle will be created and returned. Otherwise, the passed
         *        rectangle will be updated and returned.
         */
        public function getRealBounds(obj:DisplayObject, space:DisplayObject = null, dst:Rectangle = null):Rectangle {
            var tx:Number = (_hBmdRect.width  - obj.width ) / 2,
                ty:Number = (_hBmdRect.height - obj.height) / 2;

            // get transformation matrix that translates the object to the center of the bitmap
            _hMtr.identity();
            _hMtr.translate(tx, ty);

            // clear the bitmap so it will contain only pixels with zero alpha channel
            _hBmd.fillRect(_hBmdRect, 0);
            // draw the object; it will be drawn untransformed, except for translation
            // caused by _hMtr matrix
            _hBmd.draw(obj, _hMtr);

            // get the area which encloses all pixels with nonzero alpha channel (i.e. our object)
            var bnd:Rectangle = dst ? dst : new Rectangle(),
                selfBnd:Rectangle = _hBmd.getColorBoundsRect(0xFF000000, 0x00000000, false);

            // transform the area to eliminate the effect of _hMtr transformation; now we've obtained
            // the bounds of the object in its own coord. system (self bounds)
            selfBnd.offset(-tx, -ty);

            if (space && space !== obj) { // the dst coord space is different from the object's one
                // so we need to obtain transformation matrix from the object's coord space to the dst one
                var mObjToSpace:Matrix;

                if (space === obj.parent) {
                    // optimization
                    mObjToSpace = obj.transform.matrix;
                } else if (space == obj.stage) {
                    // optimization
                    mObjToSpace = obj.transform.concatenatedMatrix;
                } else {
                    // general case
                    var mStageToSpace:Matrix = space.transform.concatenatedMatrix; // space -> stage
                        mStageToSpace.invert();                                    // stage -> space
                    mObjToSpace = obj.transform.concatenatedMatrix;                // obj -> stage
                    mObjToSpace.concat(mStageToSpace);                             // obj -> space
                }

                // now we transform all four vertices of the boundary rectangle to the target space
                // and determine the bounds of this transformed shape

                _xMin =  Number.MAX_VALUE;
                _xMax = -Number.MAX_VALUE;
                _yMin =  Number.MAX_VALUE;
                _yMax = -Number.MAX_VALUE;

                expandBounds(mObjToSpace.transformPoint(getPoint(selfBnd.x, selfBnd.y)));
                expandBounds(mObjToSpace.transformPoint(getPoint(selfBnd.right, selfBnd.y)));
                expandBounds(mObjToSpace.transformPoint(getPoint(selfBnd.x, selfBnd.bottom)));
                expandBounds(mObjToSpace.transformPoint(getPoint(selfBnd.right, selfBnd.bottom)));

                bnd.x = _xMin;
                bnd.y = _yMin;
                bnd.width = _xMax - _xMin;
                bnd.height = _yMax - _yMin;
            } else {
                // the dst coord space is the object's one, so we simply return the self bounds
                bnd.x = selfBnd.x;
                bnd.y = selfBnd.y;
                bnd.width = selfBnd.width;
                bnd.height = selfBnd.height;
            }

            return bnd;
        }

        private function getPoint(x:Number, y:Number):Point {
            _hPoint.x = x;
            _hPoint.y = y;
            return _hPoint;
        }

        private function expandBounds(p:Point):void {
            if (p.x < _xMin) {
                _xMin = p.x;
            }
            if (p.x > _xMax) {
                _xMax = p.x;
            }
            if (p.y < _yMin) {
                _yMin = p.y;
            }
            if (p.y > _yMax) {
                _yMax = p.y;
            }
        }
    }
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-21T19:34:17.860

我不确定使用 getBounds 或 getRect 的普通方法是否可行，因为这些方法只会返回正常的 100x100 正方形。

我有几个建议给你。

首先，您可以动态应用过滤器。这样，您将获得过滤器的数字，并且可以通过编程方式进行数学运算以计算出实际大小。

您可以向 fla 中的影片剪辑添加第二层，它具有原始正方形的尺寸以及所有过滤器。然后将此正方形的 alpha 设置为零

第三，你可以只在 fla 中有一个包含正方形的 png 以及其中的发光。

就我个人而言，我会选择中间选项，因为如果要更改过滤器或原始正方形，则需要最少的维护。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-21T20:09:39.333

好吧，有好消息也有坏消息。坏消息是，确实没有一种有效的方法可以“正确”地做到这一点。好消息是有足够的方法来近似它。

一般规则是宽度的大小约为 (filter.blurX * 1.5) + sprite.width，其中“filter”是 sprite.filters 数组中的过滤器。模糊和高度也是如此。另一个一般规则是最小 x 变为 sprite.x - ( filter.blurX * 1.5 ) / 2;

这些数字都不是“Adobe 官方”，但工作在足够合理的误差范围内，允许您基于此创建 BitmapData。

# c++ - #include 的可用性 with xlC on AIX 4.3

> ID：466285
> 
> 赞同：1
> 
> 时间：2009-01-21T17:41:12.597
> 
> 标签：c++, aix, xlc

是否有适用于 AIX 4.3 的 xlC/VACPP 版本，在给出以下源时不会阻塞：

```
#include <map>

int main(void)
{
  return 0;
} 
```

如果是，它仍然可以在任何地方使用吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-21T22:07:26.803

这不是编译器本身，而是编译器附带旧版本的 STL 的事实。您应该能够安装[Apache 的 STL](http://stdcxx.apache.org/#platforms)来解决此问题。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-22T18:16:42.633

您可能想尝试使用[STLport](http://www.stlport.org/)作为编译器附带的 STL 的替代品。

# html - 生成的模板未正确呈现

> ID：466286
> 
> 赞同：0
> 
> 时间：2009-01-21T17:41:48.600
> 
> 标签：html, django, google-app-engine, templates

所以我在谷歌应用引擎模板中有这段代码：

```
<select name='voter'>

{% for voter in allowed_voters %}

    <option {% ifequal voter last_voter %}selected="yes" {% endifequal %} 
    value='{{voter}}'>{{voter}}</option>

{% endfor %}

</select> 
```

该页面不会在选择正确的人的情况下呈现，而是默认为第一个选项。查看源代码显示生成的 html 已将 selected 属性放在正确的位置，所以我无法弄清楚为什么这不起作用。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-22T01:31:35.347

[`option`的`select`属性](http://www.w3.org/TR/html4/interact/forms.html#adef-selected)是一个布尔属性。

尝试以下方法之一：

```
<option {% ifequal voter last_voter %}selected="selected" {% endifequal %} 
value='{{voter}}'>{{voter}}</option>

<option {% ifequal voter last_voter %}selected {% endifequal %} 
value='{{voter}}'>{{voter}}</option> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-10T08:47:22.483

布尔属性的语法在 HTML 和 XHTML 中是不同的。显然你正在输出 HTML，需要使用

```
<option ... selected ...> 
```

在 XHTML 中你会使用

```
<option ... selected="selected" ...> 
```

不幸的是，我们有整个 HTML/XHTML 和 MIME 类型与可怕的不符合标准的浏览器混在一起。你只需要知道这些东西，以确保你吐出的页面可以在大多数浏览器上正确呈现。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-22T00:54:01.583

尝试仅使用标记“已选择”而不是已选择 =“是”

# css - FireFox 3 行高

> ID：466291
> 
> 赞同：10
> 
> 时间：2009-01-21T17:43:59.703
> 
> 标签：css, firefox-3

Firefox 3 引入了一种新行为，其中行高在未设置时与其他浏览器的呈现方式不同。因此，关键部分可能在该浏览器中呈现得太高。设置全局百分比不起作用，因为它的基础不同。设置诸如“1”之类的无单位值也不起作用。有什么方法可以标准化这个维度吗？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-01-21T19:35:41.897

的计算值`line-height: normal`因平台、浏览器（以及同一浏览器的不同版本，如您所说）、字体甚至同一字体的不同大小而异[（请参阅 Eric Meyer 的文章）](http://meyerweb.com/eric/thoughts/2008/05/06/line-height-abnormal/)。

设置无单位值，例如...

```
body {line-height: 1.2;} 
```

...*应该*可以正常化浏览器之间的间距。如果这不起作用，您能否提供更详细的样式表描述？

很难（不可能？）获得“像素完美”的结果，但为了获得尽可能可预测的结果，我尝试使用一个行高，当乘以字体大小时会产生一个很好的圆形值。我们无法知道用户代理的默认字体大小，但 16 像素是比较常见的。

```
body 
{
    font-size: 100%;
    line-height: 1.5;
} 
```

如果用户代理的起始字体大小确实是 16 像素，那么行高`1.5`会很好，甚至是 24 像素。但是，用户可以并且确实可以更改默认字体大小或页面缩放，并且不同的浏览器具有不同的缩放页面的方法。尽管如此，我认为我已经为大多数用户取得了合理的成功。如果我不能使行高准确地出来，那么我会在整数上方而不是在整数下方拍摄一点点，因为有些浏览器似乎会截断值而不是舍入它们。

另外，请注意，如果您对行高使用百分比，则在继承该值时它的行为会有所不同。

```
body 
{
    font-size: 100%;
    line-height: 150%;
}

p
{
    font-size: 75%;
} 
```

从 16 像素的基本字体大小开始，行高将为 24 像素。在一个`<p>`元素内，字体大小变为 12 像素，但行高不会**变为**18 像素，而是保持 24 像素。`line-height: 1.5`这就是和之间的区别`line-height: 150%`。使用`body {line-height: 1.5;}`时，行高为`<p>` *18*像素。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-01-24T09:32:03.350

你绝对无能为力。每个浏览器都有呈现 CSS 和内容的方法。您可以使用“主”重置（正如牛神建议的那样），但即便如此，这最终也无法解决对齐问题。它们在那里是因为实际的渲染引擎。将 CSS 应用到您现有的网站并对其进行测试。告诉我它是否使像素全面完美。它不会。

真正实现像素完美的唯一方法是为特定浏览器实现特定的 CSS。Mozilla 有[@-moz-doc](https://developer.mozilla.org/en/CSS:@-moz-document)，IE 有它自己的 hack，但这些都不是 W3C 规范的一部分，我们都知道标准很重要。所以没有太多选择。

正如大卫上面所说，这很难。我倾向于认为实际上是不可能的。我已经花了几个小时尝试，相信我！几乎发疯的次数比我想的要多。这是一颗难以下咽的药丸，但没有办法绕过它，除非每个人都使用相同的浏览引擎（在我看来，这实际上会让互联网向前迈进一大步）。我的意思是，只要你插入 [gecko][webkit][presto][trident][whatever] 来处理后端......那些都是开源的，你可以合并项目并真正开始。人们需要学会一起玩得好;)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-05-07T16:22:29.020

你可以解决这个问题：

将行高设置为 1，然后使用 padding-top 和 padding-bottom 在文本中设置为零，并将高度设置为 auto。

```
.zeroed_in_element {
    padding: 4px 2px 5px 2px;
    height: auto;
    line-height: 1;
} 
```

* * *

## 回答 #4

> 赞同：-2
> 
> 时间：2009-01-21T17:56:05.187

您应该始终“重置”样式以消除所有浏览器与元素样式的不一致。

我喜欢[Eric Meyer 的 CSS Reset](http://meyerweb.com/eric/thoughts/2007/05/01/reset-reloaded/ "Eric Meyer 的 CSS 重置")。 [雅虎](http://developer.yahoo.com/yui/reset/ "雅虎 CSS 重置")也有。

# c# - 通过表达式树读取行的最佳方法是什么？

> ID：466292
> 
> 赞同：1
> 
> 时间：2009-01-21T17:44:01.827
> 
> 标签：c#, .net, lambda, expression-trees

如果我想从控制台获取用户输入到我的表达式树。最好的方法是什么？以及如何使变量“名称”鸭子打字？

这是我的代码。

```
using System;
using System.Reflection;
using System.Collections.Generic;
using Microsoft.Linq;
using Microsoft.Linq.Expressions;

namespace ExpressionTree
{
    class Program
    {
        static void Main(string[] args)
        {
            List<Expression> statements = new List<Expression>();

            // Output
            MethodInfo Write = typeof(System.Console).GetMethod("Write", new Type[] { typeof(string) });
            ConstantExpression param = Expression.Constant("What is your name? ", typeof(string));
            Expression output = Expression.Call(null, Write, param);
            statements.Add(output);

            // Input
            MethodInfo ReadLine = typeof(System.Console).GetMethod("ReadLine");
            ParameterExpression exprName = Expression.Variable(typeof(String), "name");
            Expression exprReadLine = Expression.Call(null, ReadLine);

            // .NET 4.0 (DlR 0.9) from Microsoft.Scripting.Core.dll
            // Expression.Assign and Expression.Scope
            ScopeExpression input = Expression.Scope(Expression.Assign(exprName, exprReadLine), exprName);
            statements.Add(input);

            // Create the lambda
            LambdaExpression lambda = Expression.Lambda(Expression.Block(statements));

            // Compile and execute the lambda
            lambda.Compile().DynamicInvoke();

            Console.ReadLine();
        }
    }
} 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-21T20:40:46.680

表达式树旨在执行固定操作 - 特别是，成员访问`MemberInfo`在表达式树创建时需要一个已知的（等）（因为它们是不可变的）。

如果您使用的是 4.0，则可以复制[生成的代码`dynamic`](http://marcgravell.blogspot.com/2008/11/dynamic-objects-part1.html)，但老实说，这种情况下更好的方法很简单：不要使用表达式树。

对于这种对成员的动态访问，反射或`ComponentModel`( ) 都是理想的选择。`TypeDescriptor`

另外 - 调用`Compile`你只使用一次的东西不会节省任何时间，使用`DynamicInvoke`也不是......你需要使用类型化的委托表单（`Invoke`）。

# python - 如何生成多行构建命令？

> ID：466293
> 
> 赞同：3
> 
> 时间：2009-01-21T17:44:04.337
> 
> 标签：python, build, build-automation, scons

在 SCons 中，我的命令生成器创建了非常长的命令行。我希望能够将这些命令拆分为多行，以便在构建日志中阅读。

例如，我有一个 SConscipt，例如：

```
import os

# create dependency
def my_cmd_generator(source, target, env, for_signature):
    return r'''echo its a small world after all \
        its a small world after all'''

my_cmd_builder = Builder(generator=my_cmd_generator, suffix = '.foo')

env = Environment()
env.Append( BUILDERS = {'MyCmd' : my_cmd_builder } )

my_cmd = env.MyCmd('foo.foo',os.popen('which bash').read().strip())
AlwaysBuild(my_cmd) 
```

当它执行时，我得到：

```
scons: Reading SConscript files ...
scons: done reading SConscript files.
scons: Building targets ...
echo its a small world after all \
its a small world after all
its a small world after all
sh: line 1: its: command not found
scons: *** [foo.foo] Error 127
scons: building terminated because of errors. 
```

在带有 os.system 和 os.popen 的 python shell 中执行此操作——我得到一个可读的命令字符串，并且子 shell 进程将所有行解释为一个命令。

```
>>> import os
>>> cmd = r'''echo its a small world after all \
... its a small world after all'''
>>> print cmd
echo its a small world after all \
its a small world after all
>>> os.system( cmd)
its a small world after all its a small world after all
0 
```

当我在 SCons 中执行此操作时，它一次执行每一行，这不是我想要的。

我还想避免将我的命令构建到 shell 脚本中，然后执行 shell 脚本，因为这会造成字符串转义的疯狂。

这可能吗？

更新：
cournape，
感谢您提供有关 $CCCOMSTR 的线索。不幸的是，我没有使用 SCons 开箱即用支持的任何语言，所以我正在创建自己的命令生成器。使用生成器，我怎样才能让 SCons 去做：

```
echo its a small world after all its a small world after all' 
```

但打印

```
echo its a small world after all \
    its a small world after all 
```

?

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-06T19:24:02.457

感谢 cournape 关于动作与生成器（和 eclipse pydev 调试器）的提示，我终于弄清楚了我需要做什么。您想将函数作为“操作”而不是“生成器”传递给“生成器”类。这将允许您直接执行 os.system 或 os.popen 调用。这是更新的代码：

```
import os

def my_action(source, target, env):
    cmd = r'''echo its a small world after all \
        its a small world after all'''
    print cmd
    return os.system(cmd)

my_cmd_builder = Builder(
    action=my_action,  # <-- CRUCIAL PIECE OF SOLUTION
    suffix = '.foo')

env = Environment()
env.Append( BUILDERS = {'MyCmd' : my_cmd_builder } )

my_cmd = env.MyCmd('foo.foo',os.popen('which bash').read().strip()) 
```

此 SConstruct 文件将产生以下输出：

```
scons: Reading SConscript files ...
scons: done reading SConscript files.
scons: Building targets ...
my_action(["foo.foo"], ["/bin/bash"])
echo its a small world after all \
        its a small world after all
its a small world after all its a small world after all
scons: done building targets. 
```

另一个关键部分是要记住，从“生成器”切换到“动作”意味着您正在构建的目标不再隐含依赖于您传递给子流程外壳的实际字符串。您可以通过将字符串添加到您的环境中来重新创建此依赖项。

例如，我个人想要的解决方案如下：

```
import os

cmd = r'''echo its a small world after all \
        its a small world after all'''

def my_action(source, target, env):
    print cmd
    return os.system(cmd)

my_cmd_builder = Builder(
    action=my_action,
    suffix = '.foo')

env = Environment()
env['_MY_CMD'] = cmd  # <-- CREATE IMPLICIT DEPENDENCY ON CMD STRING
env.Append( BUILDERS = {'MyCmd' : my_cmd_builder } )

my_cmd = env.MyCmd('foo.foo',os.popen('which bash').read().strip()) 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-04T10:49:13.343

您正在混合两种完全不同的东西：要执行的命令及其在命令行中的表示。默认情况下，scons 会打印命令行，但如果拆分命令行，则会更改执行的命令。

现在，scons 有一种机制来更改打印的命令。它们是按 Action 实例注册的，并且有许多默认的可用实例：

```
env = Environment()
env['CCCOMSTR']  = "CC                 $SOURCE"
env['CXXCOMSTR'] = "CXX                $SOURCE"
env['LINKCOM']   = "LINK               $SOURCE" 
```

将打印，假设只有 C 和 CXX 源：

```
CC    foo.c
CC    bla.c
CXX   yo.cc
LINK  yo.o bla.o foo.o 
```

# database - 删除前导零

> ID：466296
> 
> 赞同：1
> 
> 时间：2009-01-21T17:44:42.573
> 
> 标签：database

我有一个记录学生证号码的表格。其中一些数字包含前导零。当数字被记录到数据库中时，它会删除前导 0。

该字段设置为仅接受数字。学生证的长度各不相同。

我需要用前导零记录和显示该字段。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-01-21T17:46:17.720

如果你总是有一定长度的数字（比如说，它总是 10 个字符），那么你可以在数据库中获取数字的长度（在它转换为字符串之后），然后添加适当的 0。

但是，如果这是任意数量的前导零，则您必须将内容作为字符串存储在数据库中，以便捕获前导零。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-01-21T17:51:00.597

听起来这应该存储为字符串数据。听起来前导零是数据本身的一部分，而不仅仅是其格式的一部分。

您*可以*重新格式化数据以在其中显示前导零，但是我相信您应该存储正确形式的 ID 号，这将导致更少的错误（例如：您忘记将其格式化在一个地方但没有在另一个）。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-21T17:56:46.637

有几种方法可以做到这一点 - 取决于我在您的问题中的评论的答案：

1.  通过将数据类型从数字转换为 varchar/string，将额外的数据存储在数据库中。

    *   ***优点：***实现非常简单；您可以以相同的方式处理所有值。
    *   ***缺点：***如果你有非常大量的数据，存储大小会增加；对字符串的索引和排序表现不佳。
    *   ***在以下情况下使用：***每个数字可能有任意长度（因此有多个零）。
    *   ***不要在以下情况下使用：***您将花费大量时间对数据进行排序，对数字字符串进行排序是一件很痛苦的事情——查看自然排序以了解一些陷阱；
2.  继续将数据作为数字存储在数据库中，但将数字填充回设定的长度（即我在下面的示例中建议的 10）：

    *   ***优点：***数据会更好地索引，更好地搜索，如果您拥有大量数据，则不需要如此大量的存储空间。
    *   ***缺点：***每次查询或显示数据都需要将每个数据实例填充到正确的长度，从而导致轻微的性能损失。
    *   ***在以下情况下使用：***所有输出数字的长度都相同（即包括零，它们都是 [例如] 10 位数字）；大量的分类将是必要的。
3.  将字段添加到表中以存储数字的原始长度，继续将值存储为数字（以利用数字与字符串的排序/索引性能增益）在新字段中存储长度，因为它将包括重要的零：

    *   ***优点：***减少所需的存储空间；最大限度地使用索引；数字排序比文本数字排序容易得多；您仍然可以像使用选项 1 一样将数字填充到任意长度。
    *   ***缺点：***您的数据库中需要一个额外的字段，因此您的所有查询都必须提取该额外字段，因此可能需要在查询/显示时略微增加资源。
    *   ***在以下情况下使用：***存储空间/索引/排序性能是任何问题。
    *   ***不要在以下情况下使用：***您没有更改表结构以包含额外值的奢侈；这将使已经很复杂的查询变得过于复杂。

如果我是你并且我可以稍微修改数据库结构，我会选择选项 3，确保你需要拉出一个额外的字段来获取长度。稍微增加的复杂性在优缺点方面带来了巨大的好处。将字符串填充回正确长度的性能损失将远远被所需的索引和存储空间的性能提升所取代。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-21T17:57:15.373

我使用了一个有类似问题的数据库。他们将邮政编码存储为数字。结果是新泽西州的人们无法使用我们的应用程序。

您正在使用逻辑上是文本字符串而不是数字的数据。它恰好看起来像一个数字，但您确实需要将其视为文本。使用面向文本的数据类型，或者至少创建一个数据库视图，使您能够为此拉回格式正确的值。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-21T21:02:48.743

# Oracle 解决方案

将 ID 存储为数字并将其转换为字符以进行显示。例如，显示`42`为一个零填充的三字符字符串：

```
SQL> select to_char(42, '099') from dual;

 042 
```

更改格式字符串以满足您的需要。

（但是，我不知道这是否可以转移到其他 SQL 风格。）

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-21T17:51:08.380

请参阅此处：[从数字中填充或删除前导零](http://blogs.lessthandot.com/index.php/DataMgmt/DataDesign/the-ten-most-asked-sql-server-questions--1#9)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-21T17:51:22.373

```
declare @recordNumber integer;
set @recordNumber = 93088;
declare @padZeroes integer;
set @padZeroes = 8;
select 
     right( replicate('0',@padZeroes) 
          + convert(varchar,@recordNumber), @padZeroes); 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-21T17:53:13.133

除非您打算对该 ID 进行计算，否则最好将它们存储为文本/字符串。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-01-21T17:54:38.467

另一种选择是，由于该字段是一个 id，我建议为显示编号 (nvarchar) 创建一个辅助字段，您可以将其用于报告等...

然后在您的应用程序中输入学生 ID 时，您可以将其作为数字以及显示数字插入到数据库中。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-07-11T07:28:18.040

在将 ID 存储在数据库中时，您可以将“1”连接到 ID 的开头。检索时，将其视为字符串并删除第一个字符。

MySQL 示例：

```
SET @student_id = '123456789';

INSERT INTO student_table (id,name) VALUES(CONCAT('1',@student_id),'John Smith');
...
SELECT SUBSTRING(id,1) FROM student_table; 
```

数学上：

最初，我想太多，并在存储之前通过在学生 ID 中添加一个整数来进行数学运算，具体取决于它的长度（如果它是 9 位数字，则为 1,000,000,000）。

```
SET @new_student_id = ABS(@student_id) + POW(10, CHAR_LENGTH(@student_id));
INSERT INTO student_table (id,name) VALUES(@new_student_id,'John Smith'); 
```

# cocoa - 是否有适当的方法来处理重叠的 NSView 兄弟姐妹？

> ID：466297
> 
> 赞同：16
> 
> 时间：2009-01-21T17:44:51.620
> 
> 标签：cocoa

我正在开发一个 Cocoa 应用程序，我遇到了一种情况，我想让两个 NSView 对象重叠。我有一个父 NSView，它包含两个子视图（NSView A 和 NSView B），每个子视图都可以有自己的几个子视图。

有没有合适的方法来处理这种重叠？NSView B 总是“高于” NSView A，所以我希望 NSView A 的重叠部分被屏蔽掉。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2010-09-17T21:02:20.470

克里斯，唯一的解决方案是使用 CALayers。这绝对是唯一的解决方案。

NSViews 在 OSX（2010 年 9 月）中被彻底破坏：**兄弟姐妹**无法正常工作。一个或另一个将随机出现在顶部。

再说一遍，问题出在**兄弟姐妹身上**。

要对此进行测试：使用 NSViews 和/或 nsimageviews。制作一个视图是一个大图像（例如 1000x1000）的应用程序。在视图中，到处放三四个小图像/NSView。现在在上面放另一个 1000x1000 的大图像。反复构建和启动应用程序——你会发现它完全坏掉了。通常下面的（小）层会出现在大覆盖层的顶部。如果您在 NSViews 上打开 layer-backing，无论您尝试什么组合，它都无济于事。所以这是最终的测试。

您必须放弃 NSViews 并使用 CALayers，仅此而已。

CALayers 唯一的烦恼是你不能使用 IB 来设置你的东西。您必须在代码中设置所有图层位置，

```
yy = [CALayer layer];
yy.frame = CGRectMake(300,300, 300,300); 
```

只制作一个 NSView，其唯一目的是保持您的第一个 CALayer（可能称为“后部”），然后将所有 CALayer 放入后部。

```
rear = [CALayer layer];
rear.backgroundColor = CGColorCreateGenericRGB( 0.75, 0.75, 0.75, 1.0 );

[yourOnlyNsView setLayer:rear]; // these two lines must be in this order
[yourOnlyNsView setWantsLayer:YES]; // these two lines must be in this order

[rear addSublayer:rr];
[rear addSublayer:yy];
     [yy addSublayer:s1];
     [yy addSublayer:s2];
     [yy addSublayer:s3];
     [yy addSublayer:s4];
[rear addSublayer:tt];
[rear addSublayer:ff]; 
```

然后一切都完美无缺，您可以嵌套和分组您想要的任何内容，并且无论您的结构多么复杂，所有内容都正确显示在应该出现在上方/下方的所有内容之上/之下，这一切都完美无缺。稍后你可以对图层做任何事情，或者以典型的方式随机播放，

```
-(void) shuff
{
[CATransaction begin];
[CATransaction setValue:[NSNumber numberWithFloat:0.0f]
              forKey:kCATransactionAnimationDuration];
if ..
    [rear insertSublayer:ff below:yy];
else
    [rear insertSublayer:ff above:yy];
[CATransaction commit];
} 
```

（你所做的一切令人讨厌的“零秒内”包装的唯一原因是阻止免费提供给你的动画 - 除非你想要动画！）

顺便说一句，苹果公司的这句话，

> 出于性能原因，Cocoa 不强制在同级视图之间进行剪裁，也不保证在同级视图重叠时正确的失效和绘制行为。

他们下面的句子...

> 如果你想在另一个视图前面绘制一个视图，你应该使前视图成为后视图的子视图（或后代）。

很大程度上是荒谬的（您不一定要用 subs 替换兄弟姐妹；并且上面测试中描述的明显错误仍然存​​在）。

所以它是CALayers！享受！

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-01-21T19:08:27.037

如果您的应用程序仅 10.5，请打开视图层，它应该可以正常工作。

如果您打算支持 10.4 及更低版本，则需要找到一种不让视图重叠的方法，因为重叠的兄弟视图是未定义的行为。正如 View Programming Guide 所说：

> 出于性能原因，Cocoa 不强制在同级视图之间进行剪裁，也不保证在同级视图重叠时正确的失效和绘制行为。如果你想在另一个视图前面绘制一个视图，你应该使前视图成为后视图的子视图（或后代）。

我见过一些技巧，有时可以使它起作用，但这不是您可以依赖的任何东西。您需要将视图 A 设置为视图 B 的子视图，或者创建一个能够处理这两个职责的巨型视图。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2011-11-02T02:19:03.293

有一种不使用的方法可以做到这一点，而`CALayers`我一直在开发的应用程序可以证明这一点。创建两个窗口并使用它：

```
[mainWindow addChildWindow:otherWindow ordered:NSWindowAbove]; 
```

要删除“ *otherWindow* ”，请使用：

```
[mainWindow removeChildWindow:otherWindow];

[otherWindow orderOut:nil]; 
```

您可能希望使用以下窗口的标题栏：

```
[otherWindow setStyleMask:NSBorderlessWindowMask]; 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-21T18:43:53.030

为了确保`NSView B`始终重叠`NSView A`，请确保`NSWindowOrderingMode`在添加时使用正确的`subview:`

```
[parentView addSubview:B positioned:NSWindowAbove relativeTo:A]; 
```

您还应该记住，如果视图 B 是 100% 不透明的，则不会要求 A 的隐藏部分重绘。

如果您要移动子视图，您还需要确保调用 `-setNeedsDisplayInRect:`您正在发现的视图区域。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2015-12-04T20:20:45.683

正如 Nate 所写，可以使用：

```
self.addSubview(btn2, positioned: NSWindowOrderingMode.Above, relativeTo: btn1) 
```

但是，一旦您通过“needDisplay = true”调用要求任何一个视图自行重绘它，视图的顺序就不会得到尊重

兄弟姐妹不会得到 drawRect 调用，只有视图直接层次结构会。

## 更新 1

为了解决这个问题，我不得不深入挖掘。大概一周的研究，我把我的发现传播到了几篇文章中。最后的突破在这篇文章：[http ://eon.codes/blog/2015/12/24/The-odd-case-of-luck/](http://eon.codes/blog/2015/12/24/The-odd-case-of-luck/)

## 更新 2

请注意，尽管这个概念很难理解，但它很有效，而且效果很好。这是最终结果和支持它的代码，指向 github 存储库等的链接：http: [//eon.codes/blog/2015/12/30/Graphic-framework-for-OSX/](http://eon.codes/blog/2015/12/30/Graphic-framework-for-OSX/)

# c# - 是否可以在单个 Visual Studio Windows 控制台项目中混合 .cs (C#) 和 .fs (F#) 文件？（。网）

> ID：466298
> 
> 赞同：26
> 
> 时间：2009-01-21T17:44:53.463
> 
> 标签：c#, .net, visual-studio, f#, console

怎么做？是否可以在不使用单独的 dll 文件或项目的情况下将一个 F# 代码中的函数调用到 C# 中？

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-01-21T18:19:08.277

您不能在同一个项目中包含两种不同的语言，但您可以使用 [ilmerge](http://research.microsoft.com/en-us/people/mbarnett/ILMerge.aspx)合并它们。为此，请将两个项目放在同一个解决方案中，并像引用任何 dll 一样引用 F# 模块。作为部署脚本的一部分，运行 ilmerge 将 exe 文件和 dll 文件合并为一个 exe 文件。请参阅此[代码项目](http://www.codeproject.com/KB/dotnet/mergingassemblies.aspx)文章，详细说明如何使用 ilmerge 创建 exe。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2011-01-01T16:13:14.367

不能在同一个项目中混合使用 C# 和 F# 会产生问题；它导致两个项目之间的循环依赖。从概念上讲，只有一个项目包含两种语言，但由于 Visual Studio 管理项目的方式，语言不能混合，导致循环依赖。

目前我看到的唯一解决方案是在第三个项目中创建大量接口，并让其中一个项目引用接口项目，而不是真正的项目。有没有更好的办法？

亲切的问候，尼克

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2009-01-21T17:46:38.607

不。如果您想生成单个 .exe，您可以使用一些 f# 静态链接选项，使用 F# --full-help 命令行开关来获得更多详细信息。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2013-01-31T08:50:25.570

您不能在 C# 项目中编译 F# 源文件 (.fs)，但可以添加 F# 脚本文件 (.fsx)，您可以使用这些文件从 F# 交互中引用和探索 C# 项目的程序集：

```
public static class Math
{
    public static double PowN(double d, int n)
    {
        var result = 1;
        for (int i = 0; i < n; i++) result *= d;
        return result;
    }
} 
```

F# 脚本文件 (.fsx)：

```
#r "bin\debug\ClassLibrary1.dll"

Math.PowN(2.0,3) 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2017-01-21T09:19:53.980

编译您的 F# 代码，使用任何工具（如反射器、ilspy）“反编译”为 C# 代码，将其包含在项目中 -> 获利！

# git - 内容完全不同的 Git 分支

> ID：466303
> 
> 赞同：33
> 
> 时间：2009-01-21T17:46:50.337
> 
> 标签：git, branch

由于 Git 有能力跟踪（并保持干净）具有完全不同内容的分支，因此在同一个存储库中，一些项目（如 Git 本身）已经开始使用它。

例如，Git 为代码本身使用一个分支，同时将其文档保存在一个单独的分支中。相同的仓库，只是不同的分支。

可能只是我，来自 SVN 背景，但我发现在这些分支中“没有共同点”令人困惑。开发/分期/生产分支；那些我理解的。不完整特征的分支；当然，我也在做这些。哎呀，每种语言都有一个分支的文档。但是没有共同的文件？

这只是 Git 中的（可能是一个未充分利用和/或市场不足的）功能，每个人都应该接受并习惯，或者可能是由于懒惰而没有充分区分同一项目的两个方面的人误用？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-01-21T18:03:52.457

我个人不会在不同的分支中存储不同的内容；在文档和代码的情况下，我只会制作一个 myproject.git 和一个 myproject-docs.git （如果构建过程需要，则将文档子模块到代码中）。

另一方面，如果你这样做，不会发生任何不好的事情。Git 不会告诉您该做什么，因此您可以自由决定如何使用它。因此，要回答您的问题，它既不是杀手级功能，也不是如果您不小心就会让您失望的东西。这只是某人选择使用它的方式。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-01-21T23:58:10.433

Git tracks coordinated changes in (text) files within a project, so it doesn't know or care whether branches are mergable or not. Having independent branches in a Git repo is similar to having independent projects in a Subversion repo, which is a common practice (because of svn's overhead).

Because Git's data structure is very different than SVN's, you can do different things with them. In SVN a feature branch is somewhat unusual, and a feature branch which is not often merged to the trunk might be a "bad smell", a sign that the programmer has "gone dark" and is creating code that may never be able to be integrated into the project. In Git, a feature branch is a perfectly safe and sensible workflow.

So they can be used in different ways because **Git is not SVN** even though both have repositories and branches and commits, and serve the same general function of source control.

As I got more experience of Git, what had been *weird* just became *different*. Then I got curious about what I could do with that different tool.

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-01-21T19:02:24.163

I'd say it's more like a lazy workaround for the fact that Git can't currently handle having multiple projects stored in the same repository. You can do it, but there's no way to pull down just the one you want.

I say "lazy", because it wouldn't have been too horribly tough to add the feature when the git developers themselves discovered a need for it (for storing docs). Since they used this weird branch hack, their incentive to fix the issue for everyone else has abated significanly.

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-01-21T18:21:27.443

这样做的好处是，如果您只对 docs 分支感兴趣，则可以只拉取它。就像 jrockway 所说，您可以使用另一个存储库并在必要时进行子模块来执行此操作，但具有创建“裸”的能力' 分支，你可以选择不这样做。

就个人而言，我仍然对此持观望态度。我理解为什么它可能是有益的，但我并不完全相信这是最好的方法。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-01-21T20:16:52.657

I think it depends on what your project is.

Git is obviously a community OSS project so having the docs in the (same) repository so everyone gets them makes sense (to me).

On the other hand I would not store the docs for my projects at work as I would rarley edit them except on 'let's update the docs' type of ticket. At work I don't want my docs intermingled with my source, I just want the source (typical programmer view i know).

Others may want them all-together. I think you just need to realize what it means (remember everyone has a full copy of the repository) and pick the best option for your project.

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-01-21T19:01:36.663

当您习惯了将树呈现给用户的 Subversion 模型时，这有点奇怪，但是一旦您习惯了该模型，它就不会那么混乱了。

A git repository is just a tree of objects that explain how to transform a directory from one state to another. Those objects have a parent. Some objects have two (or more) parents; merges. Some objects have no parent; the initial commit.

As I understand it, internally, Subversion's model is similar minus the concept of where merges came from. Those are just new commits with a handy command (`svn merge`) for getting a patch of the differences between two other commits.

I actually use this feature rather often to manage config files that started from the same directory on separate hosts, like `/etc/apache2`. It's like saying, "this is the alternate start of this stuff, but it's been abandoned". It allows me to stash the state of some files before I overwrite them, but without having to worry about whether they merge right, or are even related to the master branch at all.

In Subversion I'd have to stow that backup in some un-related place (zip file somewhere) or in a subdirectory in the repository. Plus, in subversion, if I delete any reference to those files in the current view of the tree it becomes very hard to find them again.

# c# - 实体框架 - 分离更新问题

> ID：466308
> 
> 赞同：1
> 
> 时间：2009-01-21T17:47:37.810
> 
> 标签：c#, entity-framework

好的，我正在尝试使用此自定义扩展来执行实体更新。现在它应该更新所有属性，然后更新它的所有相关端（引用）。问题是即使发生更改的实体确实具有与有效且正确的实体密钥相关的结束（在调试器中验证）。当RelationshipManager 得到它时，它们的键是空的。有人看到这段代码有什么问题吗？

```
public static void ApplyChanges(this ObjectContext context, EntityObject entityWithChanges)
    {
        if (entityWithChanges.EntityState == EntityState.Detached)
        {
            object entityCurrentlyInDB = null;

            if (context.TryGetObjectByKey(entityWithChanges.EntityKey, out entityCurrentlyInDB))
            {
                context.ApplyPropertyChanges(entityWithChanges.EntityKey.EntitySetName, entityWithChanges);

                foreach (var relatedEnd in ((IEntityWithRelationships)entityCurrentlyInDB).RelationshipManager.GetAllRelatedEnds())
                {
                    var oldRef = relatedEnd as EntityReference;

                    if (oldRef != null)
                    {
                        var newRef =
                            ((IEntityWithRelationships)entityWithChanges).RelationshipManager
                            .GetRelatedEnd(oldRef.RelationshipName, oldRef.TargetRoleName) as EntityReference;
                        oldRef.EntityKey = newRef.EntityKey;
                    }
                }
            }
            else
            {
                throw new ObjectNotFoundException();
            }

        }
    } 
```

这只是我在 [这里找到的修改版本](http://blogs.msdn.com/cesardelatorre/archive/2008/09/04/updating-data-using-entity-framework-in-n-tier-and-n-layer-applications-short-lived-ef-contexts.aspx)

感谢帮助。

更新：这是更新方法

```
public static void UpdateTemplate(Template template)
    {
        using (TheEntities context = new TheEntities())
        {
            context.ApplyChanges(template);
            try
            {
                context.SaveChanges();
            }
            catch (OptimisticConcurrencyException)
            {
                context.Refresh(RefreshMode.ClientWins, template);
                context.SaveChanges();
            }

            context.RemoveTracking(template);
        }
    } 
```

这是单元测试：

```
[TestMethod]
    public void CanUpdateATemplate()
    {
        Template template = new Template();
        template.Name = "Test";
        template.Description = "Test";

        TemplateType type = TemplateManager.FindTemplateTypeByName("Test");

        if (type == null)
        {
            type = new TemplateType();
            type.Name = "Test";
        }

        template.TemplateType = type;

        TemplateManager.AddTemplate(template);

        template = TemplateManager.FindTemplateByID(template.TemplateID);

        Assert.IsNotNull(template);

        type = TemplateManager.FindTemplateTypeByName("Round");

        if (type == null)
        {
            type = new TemplateType();
            type.Name = "Round";
        }

        template.TemplateType = type;

        TemplateManager.UpdateTemplate(template);

        template = TemplateManager.FindTemplateByID(template.TemplateID);

        Assert.IsNotNull(template);
        Assert.IsTrue(template.TemplateType.Name == "Round");

        TemplateManager.DeleteTemplate(template);

        template = TemplateManager.FindTemplateByID(template.TemplateID);

        Assert.IsNull(template);
    } 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-21T20:59:14.490

由于 Detach 在 EF 中的工作方式，这根本不可能。

我发现，如果我自己添加关键信息，我可以得到通用调用，甚至可以保存它。

问题是，当您在调用 Detach 后返回实体时，您会丢失所有关系数据。我发现了一些关于为每个实体编写图形管理器的文章，但我发现作为 EF 的浪费应该做这些事情（据说它会在 v2 中）。

EF 还没有为 N 层部署做好准备。

# sql - 折叠稀疏矩阵的最佳方法

> ID：466317
> 
> 赞同：1
> 
> 时间：2009-01-21T17:52:17.690
> 
> 标签：sql, sql-server

我有一个人口稀少的矩阵，它是一系列左连接的结果。我想把它折叠成一行（见下文）。我看到的唯一解决方案是 PK 上的 GROUP BY 和 ColA、ColB 等上的 MAX() 。性能在这里是一个大问题，所以我想知道是否有人有更好的解决方案。ColA、ColB 等列是已转为列的行。我的理解是我不能使用 PIVOT，因为列来自行（1 到 n）并且可能在任何给定时间发生变化。

产生 SPM 的联接（不，我的表/列并没有真正命名）：

```
 SELECT    
   mainTable.custNbr  
   , mainTable.custPartNbr             
    , [lkup colA].usr_def_attr as [colA]
    , [lkup colB].usr_def_attr as [colB]
    , [lkup colC].usr_def_attr as [colC]
    , [lkup colD].usr_def_attr as [colD]
    , [lkup colE].usr_def_attr as [colE]
  FROM db2.dbo.table2 as mainTable           
    LEFT JOIN db1.dbo.lookup as [colA]
        ON mainTable.lookupValue = [colA].lkup_id     
        and mainTable.cmply_typ_lkup_id = 166697 
    LEFT JOIN db1.dbo.lookup as [lkup colB]
        ON mainTable.lookupValue = [lkup colB].lkup_id    
        and mainTable.cmply_typ_lkup_id = 166700 
    LEFT JOIN db1.dbo.lookup as [lkup colC]
        ON mainTable.lookupValue = [lkup colC].lkup_id    
        and mainTable.cmply_typ_lkup_id = 166699 
    LEFT JOIN db1.dbo.lookup as [lkup colD]
        ON mainTable.lookupValue = [lkup colD].lkup_id    
        and mainTable.cmply_typ_lkup_id = 166696 
    LEFT JOIN db1.dbo.lookup as [lkup colE]
        ON mainTable.lookupValue = [lkup colE].lkup_id    
        and mainTable.cmply_typ_lkup_id = 166698 
```

结果：

```
PKCol   ColA    ColB    ColC    ColD    ColE
204045  NULL    NULL    NULL    NULL    23
204045  NULL    NULL    NULL    35  NULL
204045  NULL    NULL    35      NULL    NULL
204045  NULL    23  NULL    NULL    NULL
204045  23  NULL    NULL    NULL    NULL 
```

期望的结果：

```
PKCol   ColA    ColB    ColC    ColD    ColE
20405   23  23  35      35  23 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-21T18:52:38.567

GROUPY BY + MAX 解决方案不错。因为无论您是否进行聚合，它都会扫描相同数量的记录。

我很想知道有和没有分组的时差是多少。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-22T17:40:51.613

我将其重写为 PIVOT，性能提高了约 30%。这并不容易，必须非常仔细地阅读[**这篇文章。**](http://www.simple-talk.com/community/blogs/andras/archive/2007/09/14/37265.aspx)PIVOT 很奇怪。

* * *

## 回答 #3

> 赞同：-2
> 
> 时间：2009-01-21T18:00:47.860

稀疏矩阵在线性代数、数值方法和物理问题建模中很常见。如果矩阵是对角矩阵，则很容易使用单个向量来表示它。带宽方法可能需要存储非零元素的行和列索引。

谷歌搜索“稀疏矩阵存储”带来了很多点击，包括[这个](http://www.mathematik.hu-berlin.de/~gaggle/EVENTS/2006/BRENT60/presentations/Shahadat%20Hossain%20-%20On%20efficient%20data%20structures%20for%20sparse%20matrix%20storage.pdf)。也许它可以激发一些想法。

# html - 不在 background-image 的 div 中显示文本

> ID：466318
> 
> 赞同：4
> 
> 时间：2009-01-21T17:52:30.747
> 
> 标签：html, css

我有这个 div：

```
<div class="inauguration-image">
  I do not want this text to display, just here for description
</div> 
```

这是它的CSS：

```
.inauguration-image {
    margin-top:5px;
    margin-left:auto;
    margin-right:auto;
    background: url("/images/inauguration_block.png") no-repeat;
    position:relative;
    width:760px;
    height:552px;
} 
```

我不想显示文本，我该怎么做呢？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-01-21T17:55:15.687

```
.inauguration-image {
    margin-top:5px;
    margin-left:auto;
    margin-right:auto;
    background: url("/images/inauguration_block.png") no-repeat;
    position:relative;
    width:760px;
    height:0;
    padding-top:552px;
    overflow:hidden;
} 
```

设置`height:0`和`overflow:hidden`隐藏您的文本；`padding-top:552px`无论如何，使元素足够大以显示您的背景图像。这是一个非常便携的解决方案。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-21T18:10:51.460

```
<div class="inauguration-image">
  <p style="display:none">
     I do not want this text to display, 
     just here for description
  </p>
</div> 
```

我认为您不应该在 div 中包含未包含的文本。

目前尚不清楚您要做什么。如果您只是想评论 div，请使用 HTML 评论。

```
<div class="inauguration-image">
  <!-- I do not want this text to display, 
       just here for description -->
</div> 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-21T18:05:04.187

你也可以使用：

```
.inauguration-image{
    ....
    text-indent:-9999px;
} 
```

它只是将文本移动到 9999px 的左侧，而且您在当前班级中没有任何其他要更改的内容

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2014-02-25T07:30:17.040

使用字体大小`0px`将使文本对眼睛不可见。例如：

```
.inauguration-image {
    margin-top:5px;
    margin-left:auto;
    margin-right:auto;
    background: url("/images/inauguration_block.png") no-repeat;
    position:relative;
    width:760px;
    height:552px;
    font-size: 0px /** Fontsize of 0 makes it invisible */
} 
```

# datetime - 将unix时间戳转换为朱利安

> ID：466321
> 
> 赞同：22
> 
> 时间：2009-01-21T17:52:47.020
> 
> 标签：datetime, timestamp, date, julian-date

如何从 unix 时间戳（比如 1232559922）转换为小数儒略日期（2454853.03150）。

我找到了一个执行类似计算的网站（[http://aa.usno.navy.mil/data/docs/JulianDate.php](http://aa.usno.navy.mil/data/docs/JulianDate.php)），但我需要以编程方式进行。

解决方案可以是 C/C++、python、perl、bash 等......

* * *

## 回答 #1

> 赞同：35
> 
> 时间：2009-01-21T18:00:47.860

Unix 纪元（零点）是 1970 年 1 月 1 日 GMT。这对应于儒略日 2440587.5

所以，在伪代码中：

```
function float getJulianFromUnix( int unixSecs )
{
   return ( unixSecs / 86400.0 ) + 2440587.5;
} 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2013-06-08T19:13:51.357

我知道这是一个旧帖子，但我只想说......

Jason Cohen 给出的答案是转换的一个很好的近似值。

虽然有一个问题与一天中的秒数有关。一天并不完全是 86400 秒长，并且会定期将秒数添加到天数中，以使时间与各种可观察标准保持同步。这些被称为闰秒（[https://en.wikipedia.org/wiki/Leap_second](https://en.wikipedia.org/wiki/Leap_second)）。将闰秒添加到 UTC 以使其保持在 UT1 的 1 秒内。

按理说，随着自 1970 年 1 月 1 日以来的时间越来越长，上述简单的换算会从“实际可观察​​时间”中产生越来越多的误差。从 1972 年到 2013 年，增加了 25 个闰秒。

Julian Day 数字的美丽和简单的部分原因在于它们根本不代表日期字符串。它们只是自儒略纪元开始以来经过的时间的计数，就像 POSIX 时间是自 POSIX 纪元以来的连续毫秒计数。那么，唯一存在的问题是当您尝试将儒略日数字映射到本地化日期字符串时。

如果您需要一个精确到一分钟内（2013 年）的日期字符串，那么您将需要一个可以解释闰秒的算法。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2016-09-08T00:40:52.670

*这是我将Unix*时间戳转换为*Julian*的 JavaScript 代码。最初是显示当前的日期和时间，但有一点 mod 可以回答你的问题：

```
function computeJulianDate(DD,MM,YY,HR,MN,SC) {
    with (Math) {
        HR = HR + (MN / 60) + (SC/3600);
        GGG = 1;
        if (YY <= 1585) GGG = 0;
        JD = -1 * floor(7 * (floor((MM + 9) / 12) + YY) / 4);
        S = 1;
        if ((MM - 9)<0) S=-1;
        A = abs(MM - 9);
        J1 = floor(YY + S * floor(A / 7));
        J1 = -1 * floor((floor(J1 / 100) + 1) * 3 / 4);
        JD = JD + floor(275 * MM / 9) + DD + (GGG * J1);
        JD = JD + 1721027 + 2 * GGG + 367 * YY - 0.5;
        JD = JD + (HR / 24);
    }
    return JD;
}
function getUTCDateTimeOrJD(now,jd=0) {
    var hours = now.getUTCHours();
    var minutes = now.getUTCMinutes();
    var seconds = now.getUTCSeconds()
    var month = now.getUTCMonth() + 1;
    var day = now.getUTCDate();
    var year = now.getUTCFullYear();
    if (jd==1)
        return computeJulianDate(month, day, year, hours, minutes, seconds);
    else
        return day+". "+month+". "+year+". "+hours+":"+minutes+":"+seconds;
}

var unixTime = 1473294606;

    getUTCDateTimeOrJD(new Date(unixTime*1000));
    getUTCDateTimeOrJD(new Date(unixTime*1000),1); 
```

[在这里工作的 JSFiddle 示例](https://jsfiddle.net/eapo/vacduhr5/1/)

# sql - 如何附加到 t-sql SQL Server 2005 中的文本字段

> ID：466323
> 
> 赞同：23
> 
> 时间：2009-01-21T17:53:45.597
> 
> 标签：sql, sql-server, sql-server-2005, tsql, append

在 Sql Server 2005 中使用 t-sql 追加到文本字段的最佳方法是什么？

使用 varchar 我会这样做。

```
update tablename set fieldname = fieldname + 'appended string' 
```

但这不适用于文本字段。

* * *

## 回答 #1

> 赞同：39
> 
> 时间：2009-01-21T18:01:52.897

试试这个：

```
update 
  tablename
set
  fieldname = convert(nvarchar(max),fieldname) + 'appended string' 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-01-21T17:59:48.690

[这应该有效（链接）](http://developer.fusium.com/FUblog/index.cfm/2006/7/13/appending-an-ntext-field "这应该有效。")

从链接复制：

```
DECLARE @ptrval binary(16)
SELECT @ptrval = TEXTPTR(ntextThing)
FROM item
WHERE id =1
UPDATETEXT table.ntextthing @ptrval NULL 0 '!'
GO 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-21T18:01:10.030

在 2005 年，您应该使用 varchar(max) 或 nvarchar(max) 这些列将与普通的 varchar 函数一起使用。text 和 ntext 已被弃用

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-07-15T18:37:38.480

varchar(max) 的最大长度为 2,147,483,647 个字符。这与文本数据类型相同。

无论文本可以容纳什么，它都可以容纳，因此您无需担心通过切换到 VARCHAR(MAX) 会耗尽空间。

# vb.net - VB.NET 队列构造函数错误：队列增长因子必须在 1 到 10 之间

> ID：466330
> 
> 赞同：0
> 
> 时间：2009-01-21T17:57:02.237
> 
> 标签：vb.net, exception, visual-studio-2005, constructor, queue

首先是一些背景：访问 MS-SQL 后端的 VB.NET 2005 应用程序，使用多个 Web 服务进行数据收集/发布。

关于错误：我们的应用程序在我们的一台客户计算机上神秘地崩溃了，它在他们办公室的其他计算机上运行良好，但在大辉格党的计算机上却不行，这现在成了我的问题。这似乎是某种软件冲突，因为他们已经更换了计算机（我假设的软件配置相同），但错误仍然存​​在。我目前正在等待他们的 IT 人员的回复，说明该用户的设置与该办公室的其他用户之间是否存在任何已知差异。

更烦人的是应用程序就消失了。我们无法轻松调试它，因为没有显示错误消息，即使我们有特定的代码来捕获未处理的异常并显示消息，它也会关闭。

但是，我们的异常处理代码*被*调用（至少部分），因为它成功记录了以下错误（只是不像其他正常错误那样向用户显示）：

```
Error Message: Queue grow factor must be between 1 and 10\. 

Stack Trace: at 
System.Collections.Queue..ctor(Int32 capacity, Single growFactor) at 
System.Collections.Queue..ctor() at 
System.Windows.Forms.Control.MarshaledInvoke(Control caller, Delegate method, Object[] args, Boolean synchronous) at 
System.Windows.Forms.Control.BeginInvoke(Delegate method, Object[] args) at 
System.Windows.Forms.Form.OnLoad(EventArgs e) at 
System.Windows.Forms.Form.OnCreateControl() at 
System.Windows.Forms.Control.CreateControl(Boolean fIgnoreVisible) at 
System.Windows.Forms.Control.CreateControl() at 
System.Windows.Forms.Control.WmShowWindow(Message& m) at 
System.Windows.Forms.Control.WndProc(Message& m) at 
System.Windows.Forms.ScrollableControl.WndProc(Message& m) at 
System.Windows.Forms.ContainerControl.WndProc(Message& m) at 
System.Windows.Forms.Form.WmShowWindow(Message& m) at 
System.Windows.Forms.Form.WndProc(Message& m) at 
System.Windows.Forms.Control.ControlNativeWindow.OnMessage(Message& m) at 
System.Windows.Forms.Control.ControlNativeWindow.WndProc(Message& m) at 
System.Windows.Forms.NativeWindow.Callback(IntPtr hWnd, Int32 msg, IntPtr wparam, IntPtr lparam) 
```

现在真正奇怪的是，我们在此时应该运行的代码中根本没有使用队列。（用户打开应用程序，尝试登录，bam，错误发生）代码中任何地方引用的唯一队列是在一个非常特定的函数中，该函数只在内部测试模式下运行。它在那里没有任何问题。

我不知道在哪里处理这个问题，所以任何输入都将不胜感激。

编辑：好的，我终于与他们的 IT 部门取得了联系，正如我所怀疑的那样，他正在运行 .NET 2.0。我让 IT 人员从“添加/删除程序”修复了 .NET 安装，之后问题不再存在。所以这实际上是一个 .NET 问题

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-21T19:39:24.353

该用户是否可能没有适当的 .net 框架？我猜你的应用程序需要 2.0，但也许他/她有 3.5？他运行的 Windows 版本是否与其他用户不同？

问题不在于您的代码，而是较低级别的 .net BCL。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2011-03-15T21:25:01.960

我有一个类似的问题 - 我发现这个问题张贴在寻找答案。就我而言，我一直工作得很好，然后从我的源代码控制中更新到最新版本，并且在构建之后突然我在程序启动时看到了这个问题。哇……？？System.Collections.Queue..ctor() 怎么会突然调用 System.Collections.Queue..ctor(Int32, Single) 而第二个参数不在 1 到 10 之间？

```
System.ArgumentOutOfRangeException 未处理
  Message="队列增长因子必须介于 1 和 10 之间。\r\n参数名称：growFactor"
  来源="mscorlib"
  参数名称="增长因子"
  堆栈跟踪：
       在 System.Collections.Queue..ctor（Int32 容量，单增长因子）
       在 System.Collections.Queue..ctor()
       在 System.Windows.Forms.Control.MarshaledInvoke（控制调用者，委托方法，对象 [] 参数，布尔同步）
       在 System.Windows.Forms.Control.BeginInvoke（委托方法，对象 [] 参数）
       在 System.Windows.Forms.Control.BeginInvoke（委托方法）
       ...我的代码在下面...

```

Reflector 清楚地显示了这段代码：

`public Queue() : this(0x20, 2f) { }`

事实证明，在执行此代码之前，我正在通过与本机代码（在 SCM 中已更改）不匹配的 P/Invoke 签名对本机代码进行 P/Invoking。（我的构建过程没有正确地将更新的本机 DLL 复制到正确的位置。）所以不知何故，堆栈在那个时候被破坏了，导致了这种无法解释的错误。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-22T15:39:10.347

这是我正在等待从他们的 IT 员工那里听到的一件事。我们的应用程序至少需要 .NET 2.0，但我个人还没有对 3.5 进行过任何测试，今天晚些时候我可能有机会研究它..

# c++builder - 如何使用 tlibimp 在 BCB5 中导入 ActiveX 控件？

> ID：466331
> 
> 赞同：1
> 
> 时间：2009-01-21T17:57:02.300
> 
> 标签：c++builder

tlibimp.exe 需要哪些标志才能正确模拟在 Borland C++ Builder 5 IDE 中选择“组件 -> 导入 ActiveX 控件 -> 安装”？我目前通过 tlibimp 一个 ocx 和 -L-，但是与手动导入它的结果相比，它的功能有所损失。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-24T18:10:05.640

命令行取决于 IDE 尝试的内容。例如，将组件安装为活动 x。

-A TypeLibrary 文件后缀（默认为 '_TLB'，-A- ：无后缀） -D 输出目录

-F TypeLibrary 输出文件名（忽略扩展名）

-N C++ 命名空间名称 -X OCX Wrappers 输出文件名（忽略扩展名 - 仅限 C++）

开关：-（默认值如下所示）

-C- 生成 C++ 导入文件

-E+ 为调度接口生成包装类（仅限 C++）

-G+ 使用“使用”语句公开命名空间

-H+ 为 ActiveX 控件生成 IDE 组件包装器

-J- 生成 CORBA IDL 源文件

-K- 生成 Pascal CORBA 存根和骨架

-L- 为 OLE 服务器生成 IDE 组件包装器

-O+ 生成 CoClass Creator 包装器

-P+ 生成 Pascal 导入文件

-Q+ 为 IDE 组件包装器生成“注册”功能

-R+ 为依赖类型库生成文件

-S+ 将 HRESULT 标准调用映射到双接口上的安全调用（仅限 Delphi）

-T- 将 HRESULT 标准调用映射到所有接口上的安全调用（仅限 Delphi）

-V- 为服务器生成事件包装器（仅限 C++）

-W+ 导入文件中的警告

-Yh 导入时忽略[隐藏]标志

-Yr 导入时忽略 [Restricted] 标志

-Yp 导入时忽略 [PreDeclID] 标志

-Ya 结合 -Yh -Yr -Yp

--

迈克尔

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-28T20:31:29.243

事实证明，功能丢失是由于我正在导入的 ocx 文件未注册。使用这个 activeX 控件的项目仍然可以顺利编译，但仍然存在缺陷。用 regsvr32 注册 ocx 解决了这个问题。

# python - 将字符串转换为日期时间

> ID：466345
> 
> 赞同：2707
> 
> 时间：2009-01-21T18:00:29.140
> 
> 标签：python, datetime

我有一个巨大的日期时间列表，像这样的字符串：

```
Jun 1 2005  1:33PM
Aug 28 1999 12:00AM 
```

我将把这些推回到数据库中适当的日期时间字段中，所以我需要将它们魔术到真正的日期时间对象中。

这是通过 Django 的 ORM 进行的，所以我不能使用 SQL 在插入时进行转换。

* * *

## 回答 #1

> 赞同：4157
> 
> 时间：2009-01-21T18:08:52.353

`datetime.strptime`是将字符串解析为日期时间的主要例程。它可以处理各种格式，格式由您给它的格式字符串确定：

```
from datetime import datetime

datetime_object = datetime.strptime('Jun 1 2005  1:33PM', '%b %d %Y %I:%M%p') 
```

结果`datetime`对象是时区天真的。

链接：

*   Python 文档`strptime`：[Python 2](https://docs.python.org/2/library/datetime.html#datetime.datetime.strptime "日期时间.日期时间.strptime")、[Python 3](https://docs.python.org/3/library/datetime.html#datetime.datetime.strptime)

*   `strptime`用于/`strftime`格式化字符串的 Python 文档： [Python 2](https://docs.python.org/2/library/datetime.html#strftime-and-strptime-behavior "strftime 和 strptime 行为")、[Python 3](https://docs.python.org/3/library/datetime.html#strftime-and-strptime-behavior)

*   [strftime.org](http://strftime.org/)也是 strftime 的一个非常好的参考

笔记：

*   `strptime`= "字符串解析时间"
*   `strftime`= "字符串格式化时间"
*   今天大声朗读它，您将不必在 6 个月内再次搜索它。

此外，正如@Izkata 发表的评论中所见，如果您想要一个日期而不是日期时间，那么通过 datetime 可以很好地处理它： datetime.strptime('Jun 1 2005', '%b %d %Y').date () == 日期(2005, 6, 1)

* * *

## 回答 #2

> 赞同：985
> 
> 时间：2009-01-22T18:27:18.540

使用第三方[dateutil](https://dateutil.readthedocs.io)库：

```
from dateutil import parser
parser.parse("Aug 28 1999 12:00AM")  # datetime.datetime(1999, 8, 28, 0, 0) 
```

它可以处理大多数日期格式，包括您需要解析的日期格式。`strptime`它比大多数时候都能猜出正确的格式更方便。

它对于编写测试非常有用，因为可读性比性能更重要。

您可以使用以下方式安装它：

```
pip install python-dateutil 
```

* * *

## 回答 #3

> 赞同：509
> 
> 时间：2009-01-21T18:07:17.893

查看[时间](http://docs.python.org/3/library/time.html)模块中的[strptime 。](http://docs.python.org/3/library/time.html#time.strptime)它是[strftime](http://docs.python.org/3/library/time.html#time.strftime)的倒数。

```
$ python
>>> import time
>>> my_time = time.strptime('Jun 1 2005  1:33PM', '%b %d %Y %I:%M%p')
time.struct_time(tm_year=2005, tm_mon=6, tm_mday=1,
                 tm_hour=13, tm_min=33, tm_sec=0,
                 tm_wday=2, tm_yday=152, tm_isdst=-1)

timestamp = time.mktime(my_time)
# convert time object to datetime
from datetime import datetime
my_datetime = datetime.fromtimestamp(timestamp)
# convert time object to date
from datetime import date
my_date = date.fromtimestamp(timestamp) 
```

* * *

## 回答 #4

> 赞同：185
> 
> 时间：2019-02-22T15:35:25.197

## 蟒蛇> = 3.7

可以使用将**YYYY-MM-DD**字符串转换为日期时间对象[`datetime.fromisoformat`](https://docs.python.org/3/library/datetime.html#datetime.datetime.fromisoformat)。

```
from datetime import datetime

date_string = "2012-12-12 10:10:10"
print (datetime.fromisoformat(date_string))
2012-12-12 10:10:10 
```

* * *

## 回答 #5

> 赞同：129
> 
> 时间：2014-03-02T14:22:44.513

我已经整理了一个可以转换一些非常简洁的表达式的项目。查看时间**[字符串](http://github.com/stevepeak/timestring)**。

## 以下是一些示例：

`pip install timestring`

```
>>> import timestring
>>> timestring.Date('monday, aug 15th 2015 at 8:40 pm')
<timestring.Date 2015-08-15 20:40:00 4491909392>
>>> timestring.Date('monday, aug 15th 2015 at 8:40 pm').date
datetime.datetime(2015, 8, 15, 20, 40)
>>> timestring.Range('next week')
<timestring.Range From 03/10/14 00:00:00 to 03/03/14 00:00:00 4496004880>
>>> (timestring.Range('next week').start.date, timestring.Range('next week').end.date)
(datetime.datetime(2014, 3, 10, 0, 0), datetime.datetime(2014, 3, 14, 0, 0)) 
```

* * *

## 回答 #6

> 赞同：62
> 
> 时间：2014-12-10T13:00:49.200

记住这一点，您就不必再在日期时间转换中感到困惑了。

字符串到日期时间对象 =`strptime`

datetime 对象转换为其他格式 =`strftime`

`Jun 1 2005 1:33PM`

等于

`%b %d %Y %I:%M%p`

> %b 月份作为语言环境的缩写名称（Jun）
> 
> %d 天作为一个零填充的十进制数字 (1)
> 
> %Y 年份，世纪为十进制数（2015）
> 
> %I 小时（12 小时制）作为零填充十进制数 (01)
> 
> %M 分钟作为零填充十进制数 (33)
> 
> %p 区域设置相当于 AM 或 PM(PM)

所以你需要 strptime 即转换`string`为

```
>>> dates = []
>>> dates.append('Jun 1 2005  1:33PM')
>>> dates.append('Aug 28 1999 12:00AM')
>>> from datetime import datetime
>>> for d in dates:
...     date = datetime.strptime(d, '%b %d %Y %I:%M%p')
...     print type(date)
...     print date
... 
```

输出

```
<type 'datetime.datetime'>
2005-06-01 13:33:00
<type 'datetime.datetime'>
1999-08-28 00:00:00 
```

如果你有不同格式的日期，你可以使用 panda 或 dateutil.parse

```
>>> import dateutil
>>> dates = []
>>> dates.append('12 1 2017')
>>> dates.append('1 1 2017')
>>> dates.append('1 12 2017')
>>> dates.append('June 1 2017 1:30:00AM')
>>> [parser.parse(x) for x in dates] 
```

输出

```
[datetime.datetime(2017, 12, 1, 0, 0), datetime.datetime(2017, 1, 1, 0, 0), datetime.datetime(2017, 1, 12, 0, 0), datetime.datetime(2017, 6, 1, 1, 30)] 
```

* * *

## 回答 #7

> 赞同：43
> 
> 时间：2014-03-06T11:53:05.563

许多时间戳都有隐含的时区。为确保您的代码在每个时区都能正常工作，您应该在内部使用 UTC 并在每次外来对象进入系统时附加一个时区。

Python 3.2+：

```
>>> datetime.datetime.strptime(
...     "March 5, 2014, 20:13:50", "%B %d, %Y, %H:%M:%S"
... ).replace(tzinfo=datetime.timezone(datetime.timedelta(hours=-3))) 
```

这假设您知道偏移量。如果您不知道，但您知道例如位置，您可以使用该`pytz`包查询[IANA 时区数据库](https://www.iana.org/time-zones)以获取偏移量。我将在这里以德黑兰为例，因为它有半小时的偏移量：

```
>>> tehran = pytz.timezone("Asia/Tehran")
>>> local_time = tehran.localize(
...   datetime.datetime.strptime("March 5, 2014, 20:13:50",
...                              "%B %d, %Y, %H:%M:%S")
... )
>>> local_time
datetime.datetime(2014, 3, 5, 20, 13, 50, tzinfo=<DstTzInfo 'Asia/Tehran' +0330+3:30:00 STD>) 
```

如您所见，`pytz`已确定该特定日期的偏移量为 +3:30。您现在可以将其转换为 UTC 时间，它将应用偏移量：

```
>>> utc_time = local_time.astimezone(pytz.utc)
>>> utc_time
datetime.datetime(2014, 3, 5, 16, 43, 50, tzinfo=<UTC>) 
```

请注意，采用时区之前的日期会给您带来奇怪的偏移量。这是因为 IANA 已决定使用[Local Mean Time](https://en.wikipedia.org/wiki/Local_mean_time)：

```
>>> chicago = pytz.timezone("America/Chicago")
>>> weird_time = chicago.localize(
...   datetime.datetime.strptime("November 18, 1883, 11:00:00",
...                              "%B %d, %Y, %H:%M:%S")
... )
>>> weird_time.astimezone(pytz.utc)
datetime.datetime(1883, 11, 18, 7, 34, tzinfo=<UTC>) 
```

奇怪的 34 秒来自芝加哥的经度。我使用这个日期是因为它是[芝加哥采用标准化时间的那一天](https://www.loc.gov/item/today-in-history/november-18/#time)。

* * *

## 回答 #8

> 赞同：34
> 
> 时间：2015-12-20T03:03:25.907

以下是使用 Pandas 将格式化为字符串的日期转换为 datetime.date 对象的两种解决方案。

```
import pandas as pd

dates = ['2015-12-25', '2015-12-26']

# 1) Use a list comprehension.
>>> [d.date() for d in pd.to_datetime(dates)]
[datetime.date(2015, 12, 25), datetime.date(2015, 12, 26)]

# 2) Convert the dates to a DatetimeIndex and extract the python dates.
>>> pd.DatetimeIndex(dates).date.tolist()
[datetime.date(2015, 12, 25), datetime.date(2015, 12, 26)] 
```

**计时**

```
dates = pd.DatetimeIndex(start='2000-1-1', end='2010-1-1', freq='d').date.tolist()

>>> %timeit [d.date() for d in pd.to_datetime(dates)]
# 100 loops, best of 3: 3.11 ms per loop

>>> %timeit pd.DatetimeIndex(dates).date.tolist()
# 100 loops, best of 3: 6.85 ms per loop 
```

以下是如何转换 OP 的原始日期时间示例：

```
datetimes = ['Jun 1 2005  1:33PM', 'Aug 28 1999 12:00AM']

>>> pd.to_datetime(datetimes).to_pydatetime().tolist()
[datetime.datetime(2005, 6, 1, 13, 33), 
 datetime.datetime(1999, 8, 28, 0, 0)] 
```

有很多选项可以使用 将字符串转换为 Pandas 时间戳，因此如果您需要任何特殊内容`to_datetime`，请查看[文档。](http://pandas.pydata.org/pandas-docs/stable/generated/pandas.to_datetime.html)

同样，时间戳有许多[属性和方法](http://pandas.pydata.org/pandas-docs/stable/api.html#datetimelike-properties)可以访问，除了`.date`

* * *

## 回答 #9

> 赞同：31
> 
> 时间：2020-10-04T20:57:05.687

如果你的字符串是 ISO8601 格式并且你有 Python 3.7+，你可以使用下面的简单代码：

```
import datetime

aDate = datetime.date.fromisoformat('2020-10-04') 
```

对于日期和

```
import datetime

aDateTime = datetime.datetime.fromisoformat('2020-10-04 22:47:00') 
```

对于包含日期和时间的字符串。如果包含时间戳，该函数`datetime.datetime.isoformat()`支持以下格式

```
YYYY-MM-DD[*HH[:MM[:SS[.fff[fff]]]][+HH:MM[:SS[.ffffff]]]] 
```

where`*`匹配任何单个字符。另请参阅[此处](https://docs.python.org/3/library/datetime.html#datetime.date.fromisoformat)和[此处](https://docs.python.org/3/library/datetime.html#datetime.datetime.fromisoformat)

* * *

## 回答 #10

> 赞同：30
> 
> 时间：2018-01-02T00:04:19.043

我个人喜欢使用该`parser`模块的解决方案，这是该问题的第二个答案并且很漂亮，因为您不必构造任何字符串文字即可使其正常工作。**但是**，一个缺点是它比接受的答案**慢 90%**`strptime`。

```
from dateutil import parser
from datetime import datetime
import timeit

def dt():
    dt = parser.parse("Jun 1 2005  1:33PM")
def strptime():
    datetime_object = datetime.strptime('Jun 1 2005  1:33PM', '%b %d %Y %I:%M%p')

print(timeit.timeit(stmt=dt, number=10**5))
print(timeit.timeit(stmt=strptime, number=10**5))
>10.70296801342902
>1.3627995655316933 
```

只要您不一遍又一遍地这样做*一百万*`parser`次，我仍然认为该方法更方便，并且会自动处理大部分时间格式。

* * *

## 回答 #11

> 赞同：25
> 
> 时间：2011-10-14T00:13:28.483

这里没有提到但很有用的东西：给一天添加一个后缀。我将后缀逻辑解耦，因此您可以将其用于您喜欢的任何数字，而不仅仅是日期。

```
import time

def num_suffix(n):
    '''
    Returns the suffix for any given int
    '''
    suf = ('th','st', 'nd', 'rd')
    n = abs(n) # wise guy
    tens = int(str(n)[-2:])
    units = n % 10
    if tens > 10 and tens < 20:
        return suf[0] # teens with 'th'
    elif units <= 3:
        return suf[units]
    else:
        return suf[0] # 'th'

def day_suffix(t):
    '''
    Returns the suffix of the given struct_time day
    '''
    return num_suffix(t.tm_mday)

# Examples
print num_suffix(123)
print num_suffix(3431)
print num_suffix(1234)
print ''
print day_suffix(time.strptime("1 Dec 00", "%d %b %y"))
print day_suffix(time.strptime("2 Nov 01", "%d %b %y"))
print day_suffix(time.strptime("3 Oct 02", "%d %b %y"))
print day_suffix(time.strptime("4 Sep 03", "%d %b %y"))
print day_suffix(time.strptime("13 Nov 90", "%d %b %y"))
print day_suffix(time.strptime("14 Oct 10", "%d %b %y"))​​​​​​​ 
```

* * *

## 回答 #12

> 赞同：19
> 
> 时间：2016-01-19T07:48:47.447

```
In [34]: import datetime

In [35]: _now = datetime.datetime.now()

In [36]: _now
Out[36]: datetime.datetime(2016, 1, 19, 9, 47, 0, 432000)

In [37]: print _now
2016-01-19 09:47:00.432000

In [38]: _parsed = datetime.datetime.strptime(str(_now),"%Y-%m-%d %H:%M:%S.%f")

In [39]: _parsed
Out[39]: datetime.datetime(2016, 1, 19, 9, 47, 0, 432000)

In [40]: assert _now == _parsed 
```

* * *

## 回答 #13

> 赞同：17
> 
> 时间：2014-11-20T17:58:01.530

Django 时区感知日期时间对象示例。

```
import datetime
from django.utils.timezone import get_current_timezone
tz = get_current_timezone()

format = '%b %d %Y %I:%M%p'
date_object = datetime.datetime.strptime('Jun 1 2005  1:33PM', format)
date_obj = tz.localize(date_object) 
```

当您有以下情况时，这种转换对于 Django 和 Python 非常重要`USE_TZ = True`：

```
RuntimeWarning: DateTimeField MyModel.created received a naive datetime (2016-03-04 00:00:00) while time zone support is active. 
```

* * *

## 回答 #14

> 赞同：16
> 
> 时间：2018-08-16T04:17:16.317

它有助于将字符串转换为日期时间以及时区

```
def convert_string_to_time(date_string, timezone):
    from datetime import datetime
    import pytz
    date_time_obj = datetime.strptime(date_string[:26], '%Y-%m-%d %H:%M:%S.%f')
    date_time_obj_timezone = pytz.timezone(timezone).localize(date_time_obj)

    return date_time_obj_timezone

date = '2018-08-14 13:09:24.543953+00:00'
TIME_ZONE = 'UTC'
date_time_obj_timezone = convert_string_to_time(date, TIME_ZONE) 
```

* * *

## 回答 #15

> 赞同：15
> 
> 时间：2016-02-04T13:43:07.420

创建一个小的实用程序函数，例如：

```
def date(datestr="", format="%Y-%m-%d"):
    from datetime import datetime
    if not datestr:
        return datetime.today().date()
    return datetime.strptime(datestr, format).date() 
```

这足够多才多艺：

*   如果您不传递任何参数，它将返回今天的日期。
*   您可以覆盖默认的日期格式。
*   您可以轻松修改它以返回日期时间。

* * *

## 回答 #16

> 赞同：11
> 
> 时间：2017-02-28T17:37:39.353

**箭头**为日期和时间提供了许多有用的功能。这段代码提供了问题的答案，并表明箭头还能够轻松地格式化日期并显示其他语言环境的信息。

```
>>> import arrow
>>> dateStrings = [ 'Jun 1  2005 1:33PM', 'Aug 28 1999 12:00AM' ]
>>> for dateString in dateStrings:
...     dateString
...     arrow.get(dateString.replace('  ',' '), 'MMM D YYYY H:mmA').datetime
...     arrow.get(dateString.replace('  ',' '), 'MMM D YYYY H:mmA').format('ddd, Do MMM YYYY HH:mm')
...     arrow.get(dateString.replace('  ',' '), 'MMM D YYYY H:mmA').humanize(locale='de')
...
'Jun 1  2005 1:33PM'
datetime.datetime(2005, 6, 1, 13, 33, tzinfo=tzutc())
'Wed, 1st Jun 2005 13:33'
'vor 11 Jahren'
'Aug 28 1999 12:00AM'
datetime.datetime(1999, 8, 28, 0, 0, tzinfo=tzutc())
'Sat, 28th Aug 1999 00:00'
'vor 17 Jahren' 
```

有关更多信息，请参阅[http://arrow.readthedocs.io/en/latest/](http://arrow.readthedocs.io/en/latest/)。

* * *

## 回答 #17

> 赞同：7
> 
> 时间：2015-06-01T15:15:02.030

您可以使用[easy_date](https://github.com/ralphavalon/easy_date)来简化：

```
import date_converter
converted_date = date_converter.string_to_datetime('Jun 1 2005  1:33PM', '%b %d %Y %I:%M%p') 
```

* * *

## 回答 #18

> 赞同：7
> 
> 时间：2020-01-12T17:55:16.027

你也可以签出[`dateparser`](https://dateparser.readthedocs.io/en/latest/)

> [`dateparser`](https://pypi.org/project/dateparser/)提供模块以轻松解析网页上常见的几乎任何字符串格式的本地化日期。

*安装：*

```
$ pip install dateparser 
```

我认为这是解析日期的最简单方法。

> 最直接的方法是使用该`dateparser.parse`函数，它包含了模块中的大部分功能。

*示例代码：*

```
import dateparser

t1 = 'Jun 1 2005  1:33PM'
t2 = 'Aug 28 1999 12:00AM'

dt1 = dateparser.parse(t1)
dt2 = dateparser.parse(t2)

print(dt1)
print(dt2) 
```

*输出：*

```
2005-06-01 13:33:00
1999-08-28 00:00:00 
```

* * *

## 回答 #19

> 赞同：5
> 
> 时间：2017-12-21T12:44:11.237

如果您只想要日期格式，那么您可以通过传递您的各个字段来手动转换它，例如：

```
>>> import datetime
>>> date = datetime.date(int('2017'),int('12'),int('21'))
>>> date
datetime.date(2017, 12, 21)
>>> type(date)
<type 'datetime.date'> 
```

您可以传递拆分字符串值以将其转换为日期类型，例如：

```
selected_month_rec = '2017-09-01'
date_formate = datetime.date(int(selected_month_rec.split('-')[0]),int(selected_month_rec.split('-')[1]),int(selected_month_rec.split('-')[2])) 
```

您将获得日期格式的结果值。

* * *

## 回答 #20

> 赞同：4
> 
> 时间：2020-09-29T07:03:12.607

**似乎使用[熊猫时间戳](https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Timestamp.html)是最快的**

```
import pandas as pd 

N = 1000

l = ['Jun 1 2005  1:33PM'] * N

list(pd.to_datetime(l, format=format))

%timeit _ = list(pd.to_datetime(l, format=format))
1.58 ms ± 21.6 µs per loop (mean ± std. dev. of 7 runs, 1000 loops each) 
```

**其他解决方案**

```
from datetime import datetime
%timeit _ = list(map(lambda x: datetime.strptime(x, format), l))
9.41 ms ± 95.7 µs per loop (mean ± std. dev. of 7 runs, 100 loops each)

from dateutil.parser import parse
%timeit _ = list(map(lambda x: parse(x), l))
73.8 ms ± 1.14 ms per loop (mean ± std. dev. of 7 runs, 10 loops each) 
```

**如果字符串是 ISO8601 字符串，请使用[csio8601](https://pypi.org/project/ciso8601/)**

```
import ciso8601

l = ['2014-01-09'] * N

%timeit _ = list(map(lambda x: ciso8601.parse_datetime(x), l))
186 µs ± 4.13 µs per loop (mean ± std. dev. of 7 runs, 10000 loops each) 
```

* * *

## 回答 #21

> 赞同：3
> 
> 时间：2021-08-23T08:17:09.697

如果你`don't`想你的字符串在日期时间格式方面是什么，你可以使用这个`explicitly specify`：-`format``hack to by pass that step`

```
from dateutil.parser import parse

# function that'll guess the format and convert it into python datetime format
def update_event(start_datetime=None, end_datetime=None, description=None):
    if start_datetime is not None:
        new_start_time = parse(start_datetime)

        return new_start_time

#sample input dates in different format
d = ['06/07/2021 06:40:23.277000','06/07/2021 06:40','06/07/2021']

new = [update_event(i) for i in d]

for date in new:
    print(date)
    # sample output dates in python datetime object
    # 2014-04-23 00:00:00
    # 2013-04-24 00:00:00
    # 2014-04-25 00:00:00 
```

如果您想将其转换为其他日期时间格式，只需使用您喜欢的格式修改最后一行，例如`date.strftime('%Y/%m/%d %H:%M:%S.%f')`：-

```
from dateutil.parser import parse

def update_event(start_datetime=None, end_datetime=None, description=None):
    if start_datetime is not None:
        new_start_time = parse(start_datetime)

        return new_start_time

#sample input dates in different format
d = ['06/07/2021 06:40:23.277000','06/07/2021 06:40','06/07/2021']

# passing the dates one by one through the function
new = [update_event(i) for i in d]

for date in new:
    print(date.strftime('%Y/%m/%d %H:%M:%S.%f'))
    # sample output dates in required python datetime object
    #2021/06/07 06:40:23.277000
    #2021/06/07 06:40:00.000000
    #2021/06/07 00:00:00.000000 
```

尝试运行上面的 snipet 以获得更好的清晰度。谢谢

* * *

## 回答 #22

> 赞同：3
> 
> 时间：2021-11-10T17:32:51.357

与上面的 Javed 类似，我只想要字符串中的日期 - 所以结合 Simon 和 Javed 的逻辑（上图）我们得到：

```
from dateutil import parser
import datetime

s='2021-03-04'

parser.parse(s).date() 
```

输出

> `datetime.date(2021, 3, 4)`

* * *

## 回答 #23

> 赞同：2
> 
> 时间：2017-12-18T21:12:03.277

看[我的回答](https://stackoverflow.com/questions/6615533/is-there-a-python-equivalent-to-cs-datetime-tryparse/47876446#47876446)。

在现实世界的数据中，这是一个真正的问题：多种、不匹配、不完整、不一致和多语言/地区的日期格式，通常在一个数据集中自由混合。生产代码失败是不行的，更不用说像狐狸一样高兴异常。

我们需要尝试...捕获多种日期时间格式 fmt1,fmt2,...,fmtn 并抑制/处理`strptime()`所有不匹配的异常（从..catch 子句）。从[我的解决方案](https://stackoverflow.com/questions/6615533/is-there-a-python-equivalent-to-cs-datetime-tryparse/47876446#47876446)

```
def try_strptime(s, fmts=['%d-%b-%y','%m/%d/%Y']):
    for fmt in fmts:
        try:
            return datetime.strptime(s, fmt)
        except:
            continue

    return None # or reraise the ValueError if no format matched, if you prefer 
```

* * *

## 回答 #24

> 赞同：2
> 
> 时间：2019-01-01T12:17:51.840

```
emp = pd.read_csv("C:\\py\\programs\\pandas_2\\pandas\\employees.csv")
emp.info() 
```

它显示“开始日期时间”列和“上次登录时间”都是数据框中的“对象 = 字符串”

```
<class 'pandas.core.frame.DataFrame'>
RangeIndex: 1000 entries, 0 to 999
Data columns (total 8 columns):
First Name           933 non-null object
Gender               855 non-null object 
```

> ```
> Start Date           1000 non-null object
> 
> Last Login Time      1000 non-null object 
> ```

```
Salary               1000 non-null int64
Bonus %              1000 non-null float64
Senior Management    933 non-null object
Team                 957 non-null object
dtypes: float64(1), int64(1), object(6)
memory usage: 62.6+ KB 
```

通过使用提到的`parse_dates`选项，`read_csv`您可以将字符串日期时间转换为熊猫日期时间格式。

```
emp = pd.read_csv("C:\\py\\programs\\pandas_2\\pandas\\employees.csv", parse_dates=["Start Date", "Last Login Time"])
emp.info()

<class 'pandas.core.frame.DataFrame'>
RangeIndex: 1000 entries, 0 to 999
Data columns (total 8 columns):
First Name           933 non-null object
Gender               855 non-null object 
```

> ```
> Start Date           1000 non-null datetime64[ns]
> Last Login Time      1000 non-null datetime64[ns] 
> ```

```
Salary               1000 non-null int64
Bonus %              1000 non-null float64
Senior Management    933 non-null object
Team                 957 non-null object
dtypes: datetime64[ns](2), float64(1), int64(1), object(4)
memory usage: 62.6+ KB 
```

* * *

## 回答 #25

> 赞同：2
> 
> 时间：2021-03-26T01:19:29.447

将 yyyy-mm-dd 日期字符串映射到 datetime.date 对象的简短示例：

```
from datetime import date
date_from_yyyy_mm_dd = lambda δ : date(*[int(_) for _ in δ.split('-')])
date_object = date_from_yyyy_mm_dd('2021-02-15') 
```

# javascript - 在 IE 中通过 DOM 访问框架

> ID：466346
> 
> 赞同：3
> 
> 时间：2009-01-21T18:00:29.750
> 
> 标签：javascript, html, internet-explorer, iframe

好的，其他所有浏览器都可以使用我目前编写的方法正常工作，但由于某种原因 Internet Explorer 无法正常工作。我在兼容性上花了几个小时（比实际开发该功能更多的时间！）并且快要放弃了！

我有一个论坛，其中一个简洁的功能是 WYSIWYG 编辑器。为此，我基本上有一个 IFrame 作为文档：

```
<iframe name="writer" src="/scripts/blank.html" class="writer"></iframe> 
```

这是 JavaScript 的当前状态（不断更新）：

```
function initEditor()
{
    w = frames['writer']
    wc = g('writerCopy')

    if(w == null) return

    frames['writer'].document.designMode = 'on'
    frames['writer'].document.body.innerHTML = styleSheet+wc.value
    frames['writer'].focus()
} 
```

它现在部分工作，但在线失败：

```
frames['writer'].document.body.innerHTML = styleSheet+wc.value 
```

在 Internet Explorer 中，“'frames.writer.document.body' 为空或不是对象”。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-21T18:16:20.590

你激活了 IE 的[调试](https://msdn.microsoft.com/library/bg182326(v=vs.85)) [工具了](https://msdn.microsoft.com/en-us/library/gg699336%28v=vs.85%29.aspx)吗？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-21T18:33:41.507

我什至不确定 IE 是否支持该设计模式。

而且，.contentDocument 只是 IE8，IE7 和较少使用 .contentWindow.document，但 iframe 窗口是框架集合的一部分。

试试这个，应该是跨浏览器：

```
<iframe name="writer"></iframe>

frames["writer"].document.body.innerHTML = "some html..."; 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-22T03:47:28.207

您需要将 iframe 指向 IE 的虚拟文档。只需`blank.html`使用以下内容创建一个文件：

```
<html><body></body></html> 
```

并设置`<iframe src="blank.html" ... >`

然后你可以去参考`frame.document.body.innerHTML = '...'`你的内心内容。

顺便说一句，这是一个糟糕的问题标题。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-08-01T00:32:43.890

显然，IE8 在整个父页面加载完成之前不会使框架元素可用。另请注意，您可以在父页面加载之前写入框架，但这会覆盖框架并阻止它被加载。

简单的解决方案是将 InitEditor() 调用从正文内部移动到此处：

```
<body onload="InitEditor()"> 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-02-17T20:32:49.617

可能 iframe 尚未加载。我可以复制您的“'frames.writer.document.body' 为空或不是对象”错误。我在它周围添加了一个 setTimeout，然后它对我有用。

```
setTimeout(function () {
    frames['writer'].document.body.innerHTML = "some text";
}, 200); 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-21T20:04:37.470

我在这里错过了什么吗？你不应该使用类似的东西：

```
window.frames[nameOrNumberOfFrame]... 
```

另请参阅[MSDN](http://msdn.microsoft.com/en-us/library/ms537459(VS.85).aspx)：

> 此集合仅包含窗口对象，不提供对相应框架和 iframe 对象的访问。要访问这些对象，请使用包含这些对象的文档的**all**集合。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-25T12:38:03.393

最后我使用了 frames['frameName'].document.write('someText') 但只有在其他方法失败的情况下。

# excel - Lotus 123 到 Excel 2003 的转换

> ID：466351
> 
> 赞同：4
> 
> 时间：2009-01-21T18:01:14.520
> 
> 标签：excel, lotus

我被要求将一些带有宏的 Lotus 123 wk4 文件转换为 excel 2003，我知道数据将使用大多数公式进行转换。我想知道是否还有一种方法可以转换莲花宏。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-21T18:11:05.343

没有自动转换宏的方法。但是，LotusScript 与 VBA 非常相似，因此可以进行转换，尽管并非没有大量工作。事件模型也有些不同，因此您必须根据具体情况转换这些宏。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-21T18:45:06.960

我没有看到转换宏的转换工具。正如其他人所提到的，这通常是手动的。

# c# - 如何获取后代类的属性值

> ID：466352
> 
> 赞同：2
> 
> 时间：2009-01-21T18:01:27.640
> 
> 标签：c#, reflection, inheritance

我有一个继承自基类 (BaseClass) 的类 (Descendant1)。一个后代类的实例被传递到一个以 BaseClass 作为参数的方法中。然后使用反射，它调用对象的属性。

```
public class BaseClass { }

public class Descendant1 : BaseClass
{
    public string Test1 { get { return "test1"; } }
}

public class Processor
{
    public string Process(BaseClass bc, string propertyName)
    {
        PropertyInfo property = typeof(BaseClass).GetProperty(propertyName);
        return (string)property.GetValue(bc, null); 
    } 
} 
```

我的问题是这个。在**Process**方法中，是否可以弄清楚对象到底是什么（Descendant1），然后声明该类型的对象（可能使用反射）并将 BaseClass 参数转换为它，然后对其进行反射杂技？

谢谢。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-21T18:14:13.513

我不确定我是否理解你的问题，但也许你正在考虑这样的事情：

```
 public string Process(BaseClass bc, string propertyName)
        {
            PropertyInfo property =  bc.GetType().GetProperty(propertyName);
            return (string)property.GetValue(bc, null);
        } 
```

bc.GetType() 获取 bc 的真实类型（当您传递 Descendant1 时，它将是 Descendant1 而不是 BaseClass）。

# windows - 如何判断窗口是否有焦点？(Win32 API)

> ID：466354
> 
> 赞同：31
> 
> 时间：2009-01-21T18:02:03.693
> 
> 标签：windows, winapi, hwnd

使用 Win32 API（在 C 中，但这无关紧要），我如何判断给定窗口（由 HWND 标识）是否具有焦点？

我正在挂钩一个应用程序来监视一个事件，当该事件发生时，我想检查应用程序是否已经有了焦点。如果没有，我想闪烁窗口，直到他们关注它。

或者，如果窗口已经获得焦点，FlashWindowEx 结构标志 FLASHW_TIMERNOFG 是否会闪烁，直到窗口获得焦点才不会闪烁？

我现在无法测试这个，因为我不在我的开发环境中，但我的印象是它无论如何都会闪烁，这是我试图避免的。

此外，如果重要，应用程序会在此窗口中使用 DirectX。

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2009-01-21T18:08:23.493

[GetActiveWindow](http://msdn.microsoft.com/en-us/library/ms646292(VS.85).aspx)将返回与输入焦点关联的*顶级窗口。*[GetFocus](http://msdn.microsoft.com/en-us/library/ms646294(VS.85).aspx)将返回具有输入焦点的窗口的句柄。

这篇文章可能会有所帮助： http:
[//www.microsoft.com/msj/0397/Win32/Win320397.aspx](http://www.microsoft.com/msj/0397/Win32/Win320397.aspx)

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2011-09-04T19:11:03.017

[`WM_SETFOCUS`](https://docs.microsoft.com/en-us/windows/win32/inputdev/wm-setfocus)除了 gkrogers 使用 GetActiveWindow 回答之外，您还可以通过捕获and[`WM_KILLFOCUS`](https://docs.microsoft.com/en-us/windows/win32/inputdev/wm-killfocus)事件来为您想知道它是否具有焦点的窗口维护一个布尔变量，或者[`WM_ACTIVATE`](https://docs.microsoft.com/en-us/windows/win32/inputdev/wm-activate)：

```
WndProc() ..
case WM_SETFOCUS:
  puts( "Got the focus" ) ;
  break ;

case WM_KILLFOCUS:
  puts( "Lost the focus" ) ;
  break;

case WM_ACTIVATE:
  if( LOWORD(wparam) == WA_INACTIVE )
    puts( "I AM NOW INACTIVE." ) ;
  else // WA_ACTIVE or WA_CLICKACTIVE
    puts( "MEGAZORD ACTIVATED kew kew kew (flashy-eyes)" ) ;
  break ; 
```

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-01-21T18:05:41.300

您的意思是“专注”还是“活跃”？

一个窗口具有焦点——第一个获取键盘事件的窗口。如果其子窗口之一具有焦点，则外部窗口（用户可以在屏幕上拖动）是“活动的”，但它本身可能有也可能没有焦点。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2013-10-08T17:53:18.863

使用 GetForegroundWindow 函数获取您现在关注的 Hwnd。然后你只需要将它与应用程序的窗口进行比较，以检查它是否包含焦点。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2019-08-13T06:11:10.413

对于多个无模式的孩子：

在*孩子*中，您可以保存焦点，13/08/2019 Visual Studio 2017。

您可以保存焦点，以便父级知道单击了哪个无模式子级。

在孩子的回调处理程序中：

```
case WM_CHILDACTIVATE: // Only gets called when the child border is click on.
    //CurrentFocus = hDlg; // Example: can save the focus globally for parent usage.
    //Beep(2000, 250); // So you can test
break;

case WM_GETMINMAXINFO: // Gets called when child window is being moved or sized.
        //Beep(2000, 250);
break;

case WM_LBUTTONDOWN:  // Only called when cursor is inside the child client area
    //CurrentFocus = hDlg; // Following the focus.
    //Beep(2000, 250);
break; 
```

# optimization - 如果更新失败，MySQL函数插入记录？

> ID：466356
> 
> 赞同：8
> 
> 时间：2009-01-21T18:03:11.630
> 
> 标签：optimization, mysql

我目前正在处理的系统的一部分涉及登录 mysql，并且经常更新计数。

插入的数据格式如下：

```
 date    | name | count |
-----------+------+-------+
2009-01-12 | alan |   5   |
2009-01-12 | dave |   2   |
2009-01-12 | mary |   1   | 
```

这些数据定期从一个平面文件中解析出来，如上所述，为数据库插入/更新做准备 - 数据库上的唯一键是`(date, name)`对。

以前，该系统会在决定更新或插入之前检查现有表中是否存在给定`date`和配对的任何记录。`name`

我们遇到的问题是，随着这个表的增长，响应时间并没有变得更好，我们希望尽可能减少查询的数量。

该系统最近更新为运行[`INSERT ... ON DUPLICATE KEY UPDATE`](http://dev.mysql.com/doc/refman/5.0/en/insert-on-duplicate.html)查询，这略微减少了`select`s 的数量，但我们常见的情况是`update`.

我想知道是否有人知道基本上`INSERT ... ON DUPLICATE KEY UPDATE`是反向的mysql函数，即会尝试更新一行，如果没有匹配则执行插入？

* * *

**编辑**

我上面没有说得太清楚，例如，当我有记录时，我想做的`('2009-01-12','alan','5')`是：

```
UPDATE table SET count = count+5 WHERE date = '2009-01-12' and name = 'alan'; 
```

如果上述失败，则插入上述数据。需要增加一个计数器是为什么`REPLACE`不起作用。Replace 执行删除和插入，并且不允许您引用要删除的行，因此`count = count + 5`不会将先前的`count`值增加 5。

[@jasoncohen](https://stackoverflow.com/questions/466356/mysql-function-to-insert-record-if-update-fails#466369) -`INSERT ... ON DUPLICATE KEY UPDATE`确实可以完成这项工作，但我在问是否有更优化的方法来做到这一点。

对于因原始措辞不佳而造成的任何混乱，请见谅！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-21T18:14:53.043

这是一样的。使用“UPDATE ... ON NO KEY INSERT”，数据库引擎仍然必须首先检查是否有要更新的内容。因此，即使更新是最常见的，也不需要单独的构造

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-21T18:08:46.003

使用替换功能：

[http://dev.mysql.com/doc/refman/5.0/en/replace.html](http://dev.mysql.com/doc/refman/5.0/en/replace.html)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-21T18:24:57.283

我一直在试图弄清楚你到底想要什么，正如我所见，如果数据匹配，你不想做任何事情？我没有看到解决方案，如果“计数”会以某种方式发生变化并需要更新，那么您会遇到 INSERT INTO ON DUPLICATE KEY UPDATE （我真的没有看到问题）。

但是，如果计数永远不会更新，您可能想查看 INSERT IGNORE INTO 如果唯一键（日期+名称）已经存在，它将忽略插入。

您没有考虑“刷新/旋转”您的平面文件，因此只检查添加的材料？或者那不可能？

编辑：

由于重复键违规，INSERT 将立即失败，并在这种情况下触发 UPDATE。根本不应该是任何性能问题。我一直在非常大的数据库上执行此操作，并且从空数据库开始与已经填充的数据库相比，我没有注意到任何巨大的性能差异。

但是，不时运行 ANALYZE TABLE/OPTIMIZE TABLE 以保持索引处于良好状态可能是件好事。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-21T18:07:38.050

为什么还`INSERT`不够？即使大多数时候它是一个重复的密钥，因此是一个更新（而不是相反），它仍然是正确的操作，对吗？

您只是在询问性能问题吗？

# c# - 使用 C# 和 VS.NET 2005 延迟处理队列中的消息

> ID：466362
> 
> 赞同：0
> 
> 时间：2009-01-21T18:05:40.160
> 
> 标签：c#, .net, msmq, message-queue

这是队列的设置：

1.  队列是公共的并标记为事务性的。
2.  Web 服务负责将消息插入队列。
3.  Windows 服务正在侦听队列

鉴于此，我怎样才能只处理至少 20 分钟前的消息？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-21T19:21:08.010

鉴于队列是先进先出的，您必须假设队列中的所有消息的到达时间等于或晚于队列中第一条消息的时间。

你可以利用它来发挥你的优势。

基本上，您会在 MessageQueue 实例上调用 Peek 方法并查看 ArrivedTime 属性。如果现在和到达时间之间的时间大于 20 分钟，那么您将处理它，否则，您将继续等待（直到您下一次处理队列上的消息）。

这是一个例子：

```
static Message GetQueueMessage(MessageQueue queue)
{
  // Store the current time.
  DateTime now = DateTime.Now;

  // Get the message on top of the queue.
  Message message = queue.Peek();

  // If the current time is greater than or equal to 20 minutes, then process it,
  // otherwise, get out and return false.  Generate 20 minutes first.
  // You can refactor this to have it passed in.
  TimeSpan delay = TimeSpan.FromMinutes(20);

  // If the delay is greater than the arrived time and now, then get out.
  if (delay > (now - message.ArrivedTime))
  {
    // Return null.
    return null;
  }

  // Pop the message from the queue to remove it.
  return queue.ReceiveById(message.Id);    
} 
```

然后，您可以在循环中运行它，在两者之间稍等片刻（每 5 秒，每 10 秒，任何您认为适合处理频率的东西）：

```
// Have some other reasonable check here.
do while (true)
{
  // The message to process.
  Message message = GetQueueMessage(queue);

  // Continue to process while there is a message.
  do while (message != null)
  {
    // Process the message.

    // Get the next message.
    message = GetQueueMessage(queue);
  }

  // Wait a little bit, five seconds for example.
  Thread.Sleep(5000);
} 
```

理想情况下，根据[Charles Conway 的评论](https://stackoverflow.com/questions/466362/processing-messages-from-a-queue-on-a-delay-using-c-and-vs-net-2005#466636)，您不会在循环中处理它，而是只需从事件处理程序中调用 GetQueueMessage，该事件处理程序将在您指定的时间间隔内触发。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-21T19:28:29.727

```
// Have some other reasonable check here.
do while (true)
{
...
} 
```

在布尔条件下具有“真”是一种代码气味......您是否考虑过使用定时器每 5 秒唤醒一次？

```
Timer timer = new Timer();
timer.Elapsed +=new ElapsedEventHandler(timer_Elapsed);

static void timer_Elapsed(object sender, ElapsedEventArgs e)
{
   // The message to process.
   Message message = GetQueueMessage(queue);

    // Continue to process while there is a message.
   do while (message != null)
   {
   // Process the message.

   // Get the next message.
   message = GetQueueMessage(queue);
   }

} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-21T19:20:17.077

需要注意的是，您在什么时候定义 20 分钟大？

**案例 1：**如果根据生成和发送消息的时间进行定义，那么您将不得不使用 Message.SentTime。然后，您可以使用 Peek 查看消息，并延迟处理，直到达到 20 分钟的阈值。 *这假设消息将以线性顺序到达，但**不能**保证！（见下文。）*

**情况2：**如果根据消息到达队列的时间来定义，注意Message.ArrivedTime的时间（IE进程正在“监听”消息队列）并在20分钟后消费。

**但是...**这两种情况都会导致问题，因为您只能查看第一条消息。因此，您必须在指定时间将消息消费到队列或其他结构中以进行处理。

# design-patterns - 什么时候设计模式是问题而不是解决方案？

> ID：466365
> 
> 赞同：57
> 
> 时间：2009-01-21T18:06:24.417
> 
> 标签：design-patterns

我从来没有在需要使用设计模式的软件上工作过。根据 Paul Graham 的[Revenge of the Nerds](http://www.paulgraham.com/icad.html)文章，设计模式是不够抽象的标志。

直接引用他的话，“例如，在 OO 世界中，你会听到很多关于“模式”的信息。我想知道这些模式有时是否不是人类编译器在工作的案例 (c) 的证据。当我在我的程序中看到模式时，我认为这是麻烦的迹象。程序的形状应该只反映它需要解决的问题。代码中的任何其他规律性至少对我来说是一个信号，表明我正在使用不够强大的抽象——通常是我手动生成一些我需要编写的宏的扩展。”

我只是想知道是否每个人都认为设计模式被过度使用并且是代码中没有足够抽象的症状。

* * *

## 回答 #1

> 赞同：41
> 
> 时间：2009-01-21T18:16:38.203

我不认为模式本身是问题，而是开发人员可以学习模式然后过度应用它们，或者以非常不合适的方式应用它们的事实。

模式的使用是有经验的程序员自然而然地学会的。您已经多次解决某个问题 X，您知道哪种方法有效，您使用该方法是因为您的技能和经验告诉您它是合适的。这是一个模式，没关系。

但是对于一个不太熟练的程序员来说，同样有可能找到一种方法来做事，并试图将他们遇到的每一个问题都塞进那个模式，因为他们不知道任何其他方法。这也是一种模式，而且是邪恶的。

* * *

## 回答 #2

> 赞同：26
> 
> 时间：2009-01-22T02:11:10.507

来吧伙计们，请阅读整个报价，仔细阅读。或者更好的是，阅读这篇文章。

Paul Graham 批评类 C 语言没有提供足够的抽象方法。在这篇文章的范围内，他对模式的批评是事后的想法，或者更确切地说是他主要论点的一个案例。他的推理是这样的：

使用通用策略来解决重复出现的问题是合乎逻辑的。在真正抽象的语言中，可以将这些策略形式化并将它们放入库中。每当您需要使用它们时，您只需#include 它们、实例化它们、扩展它们或其他什么。相比之下，类 C 语言不提供必要的抽象方法。存在诸如“模式”之类的事实证明了这一点。模式是一种无法用库代码表达的常见策略，因此每次应用时都必须进行富有表现力的编写。

Paul Graham 并不认为模式本身就是邪恶的。它们是语言缺乏提供抽象手段的症状。在这方面，他几乎肯定是对的。我们是否应该因此使用不同的语言，当然是另一个讨论。

另一方面，该问题的原始海报是错误的：模式不是“代码中没有足够抽象的症状”，而是您的语言中没有足够的抽象手段的症状。

* * *

## 回答 #3

> 赞同：22
> 
> 时间：2009-01-21T18:18:49.557

模式实际上只是描述事物如何工作的一种方式。这是对它们进行分类的一种方式。是否有一些程序过度使用它们？当然。拥有模式的最大优势在于，通过将某事分类为这样或那样，每个人都在同一页面上（假设他们具有了解正在谈论的内容的知识水平。）。当您拥有一个包含 10,000 行代码的系统时，有必要能够快速确定某事将如何工作。

这是否意味着您应该始终使用模式，不。这将导致将事物强制分类的问题，但您也不应该回避它们。

* * *

## 回答 #4

> 赞同：22
> 
> 时间：2009-01-21T18:50:07.607

我对模式的问题是，这个概念的核心似乎有一个中心谎言：如果你能以某种方式对专家编写的代码进行分类，那么任何人都可以通过识别和机械地应用这些类别来编写专家代码。这对管理人员来说听起来很棒，因为专业的软件设计师相对较少。

问题是它不是真的。你不能只用“设计模式”来编写专家级的代码，就像你不能只用缝纫模式来设计你自己的专业时装设计师级的服装一样。

* * *

## 回答 #5

> 赞同：19
> 
> 时间：2009-01-21T18:16:10.263

> 程序的形状应该只反映它需要解决的问题。

当需求发生变化并且您的模块没有使用 Facade 或潜在的 Mediator 进行抽象时会发生什么，从而使交换变得过于困难？

> 设计模式是不够抽象的标志

很有可能，如果您正确地抽象了所有内容，那么您在某处就有了设计模式。

如果有一个不需要加载的非常“重”的对象怎么办？代理模式使用户免于永远等待。

我可以继续说下去，但我想我已经说得够多了。正确使用设计模式是很好的工具。当它们使用不当时就会出现问题，但我想这就是为什么滥用模式被称为反模式的原因。

* * *

## 回答 #6

> 赞同：12
> 
> 时间：2009-01-21T18:49:33.630

我相信保罗格雷厄姆引用的这一部分很重要：

> [...] 我正在使用不够强大的抽象——我经常手动生成一些我需要编写的宏的扩展 [...]

它表明，如果您可以在您的语言中构建这些抽象（并且您可以使用 Lisp 做几乎任何事情，这可能是他在上面所说的），您不需要使用模式对它们进行建模。

但并不是每个人都使用 Lisp，所以你只能在可以的地方构建抽象，在不能的地方使用模式。例如，在没有[高阶函数](http://en.wikipedia.org/wiki/Higher-order_function)的语言中，这些函数通常使用[策略模式](http://en.wikipedia.org/wiki/Strategy_pattern)来建模。

这似乎是你如何看待它的问题：模式可以被视为问题的症状（例如，缺乏高阶函数），或作为问题的解决方案（例如，制作类似高阶的东西）可以通过策略模式实现功能）。

* * *

## 回答 #7

> 赞同：8
> 
> 时间：2009-01-21T19:57:38.280

[叹气] 在人们开始使用他们自己的判断之前，我们必须揭穿多少反对良好做法的咆哮？

简短的回答：如果您正在使用面向对象的语言进行实际工作，那么您很可能已经实现了一些 GoF 设计模式来完成工作。你是否意识到你已经做到了这一点，这是一个教育、观点和内省的问题。否认你曾经做过这个或模式不存在或不是“必要的”或“过度使用”是荒谬的——除非你从来没有写过比“hello world”更复杂的东西;-)

为什么，就在前几天我不得不为单例实现一个访问者外观，只是为了让适配器策略起作用:-P

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2009-01-21T20:33:47.303

术语设计模式是重载和混乱的。

有一种狭义的思考方式：基本上是 GoF 书中列出的 OO 概念的统称，例如 Singleton、Facade、Strategy。如果您将设计模式作为您的简历中的一项能力，您可能会使用此定义。

一个项目可以轻松包含数十个单例对象。这种模式很明显受益于被编码为可实例化的抽象，例如，作为宏或抽象类。GoF 书中的许多其他模式也是如此。

在我看来，Paul Graham 的论点是：设计模式，作为重复自己的标准方式，应该被编码为可实例化的抽象，并且由此推论，您应该使用一种具有非常灵活的方式来定义可实例化抽象的语言。

但这个概念更笼统——我认为他歪曲了设计模式。Christopher Alexander 发明了这个概念，以便将其应用于国家、城市、城镇和房屋的设计。游戏设计师拥有诸如战争迷雾、不对称能力等模式语言。

在这个一般意义上，设计模式都应该被编码为可实例化的抽象变得不那么明显了。

如果您还没有阅读 A Pattern Language，请在[此处](http://downlode.org/Etext/Patterns/)查看它的范围。想象一下软件世界的类似情况。GoF 模式将位于 ToC 的底部：它们是实现细节。

你还能在它们上面找到什么其他模式？

我猜一章会有与游戏相关的模式。它可以结合游戏设计模式和实现技术——我认为这不是一个明确的区别——比如游戏循环、世界实体、空间散列、高度图景观等等。这些都是设计模式。

现在，在一个游戏项目的范围内，您可能只有一个 World Entity 实现。任何使用任何语言工作的人都可以将这个 World Entity 变成一个可实例化的抽象，就像基类一样。

但是该模式描述的是这种抽象是如何形成的：它包含一些位置概念，它是可渲染的，等等。这种设计模式本身是否会受益于被编码为宏或抽象类并不明显——该模式已经描述了一个抽象！你会为世界实体实现创建一个元类吗？用于定义世界实体类的宏，带有各种不虔诚的参数？

进一步查看虚构的目录，我们看到这些模式从属于更一般的模式，即游戏模式。这值得编码为宏或抽象类吗？也许。但不明显。我们谈论的是游戏框架，您可以在其中通过传递参数、填充空白等来定义计算机游戏。这可能是富有成效和乐趣的，但它不是唯一的做事方式。

Erlang 平台对与服务器一样通用的模式具有可实例化的抽象，这很酷。我猜 Erlang 项目的服务器数量与 Java 项目的单例数量一样多。

但是对于您的特定目的，如果您正在使用 Lisp 或 Haskell 或其他任何东西并编写服务器，有时只需遵循服务器模式，将其实现为良好的旧函数和对象就足够了，而无需尝试使实例化整个事物的抽象。

所有设计模式都不是源代码中的低级文本模式。

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2009-01-21T21:16:49.197

我认为保罗格雷厄姆在这一点上错过了重要的时间。使用模式并不是要拿起一本列出它们的书并将其中的一些应用到您的代码中。我同意这将是一个糟糕的选择，但这不是模式的意义所在。

设计模式只是一种识别“嘿，我认识到这与我之前解决的另一个问题相似”并学习创建解决方案的良好抽象以便它适用于适当情况的一种方式。

事实上，如果您编写了任何合理大小的程序，那么您很有可能使用了众所周知的设计模式，只是不知道它有一个名字。例如，在我知道它是“工厂”之前，我已经使用了很长时间的“工厂”模式。知道它的正式名称只是阻止我再次重新发明轮子。

当然，一些众所周知的模式有点糟糕。单例绝对是可疑的。但那是一个明确的案例，一个过于聪明的解决方案寻找要解决的问题，但做得不好。但这就是为什么你可以找到很多支持和反对它的文献——因为人们认识到它可能不是一个好的解决方案。

但是作为一个整体的模式是一件非常好的事情，如果它们*鼓励*抽象的话。

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2009-01-21T18:43:17.260

我相信 Paul Graham 的主张是设计模式应该用语言来表达。如果存在 X 模式，则意味着人们被迫重写代码序列来做到这一点，并且应该有一种特定于语言的表达方式。这可以内置到语言中（虽然这很尴尬，并且可以创建新的设计模式），或者它可以在语言中自动化（例如 Common Lisp 宏；C++ 模板，特别是在以奇怪的方式使用时，可以做很多相同的事情有时）。

例如，让我们考虑一个更简单的模式：递增循环。必须对序列中的每个元素执行某些操作是很常见的，如果我们没有与 for 语句相对应的内容，我们无疑会采用一些通用的编码约定来表达它，并且有人（或某些四人组）会将它们打包在一起与其他类似的基本结构并写一本关于它的书。

类似地，如果使用工厂模式，一种语言可以包含工厂功能，或者可以在该语言中实现自动化。具体来说，Paul 希望能够编写一个 Lisp 宏来实现它，而不是一遍又一遍地自己编写工厂。

使用设计模式的危险在于它是我们不断输入的熟悉的代码框架，因此我们有很多代码块，我们往往不会全神贯注地阅读和编写。不便之处在于它们是我们必须一遍又一遍地键入的代码，并且感觉重写确实应该是自动化的。

模式是像 GoF 说的那样是使用语言的重要组成部分，还是可以像 PG 说的那样被抽象出来，从根本上说是一个经验问题，最好的解决办法是寻找模式本身不需要的语言并观察它们是否真的需要新的模式。

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2009-01-21T18:43:25.433

设计模式定义如下（来自维基百科，但我也在某本书中读过相同的内容）

> 在软件工程中，设计模式是针对软件设计中常见问题的通用可重用解决方案。设计模式不是可以直接转换为代码的完成设计。它是关于如何解决问题的描述或模板，可以在许多不同的情况下使用。

如果您直接从偏移量应用模式而不广泛进入问题域可能会导致问题。使用设计模式作为指导或更多作为解决问题的提示/提示。强行应用的设计模式肯定不会给出足够抽象的解决方案。经常看到在企业软件中使用了一些设计模式的变体或组合......一种混合体。如果您说您从未使用过设计模式，那么您会很高兴知道类似 foreach 循环之类的东西实际上是一种交互器模式，您可以在附近寻找更明显的实现！

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2009-01-21T18:49:51.850

简而言之，模式只是用各种语言解决常见任务的形式化方法。因此，甚至在有人创造这个词之前就有了“设计模式”。对于每种语言，都有“最佳实践”，而设计模式实际上就是这样 - 一组针对定期出现的问题的最佳实践。

标记模式的主要好处之一是共享术语允许我们谈论抽象概念。

显然，设计模式在任何给定的上下文中都可能被误用或过度使用，但我真的看不出设计模式作为一个概念是如何成为问题的。

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2009-01-21T18:17:26.767

当我在 LISP 中编程时，我根本没有使用 GoF 设计模式，它只是不适用于我正在编写的程序。现在，我正在使用 C# 进行编程，并且一直遇到设计模式实际上简化了正在编写的程序的情况。

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2009-01-21T18:14:46.663

任何事情都有时间和地点。我见过有太多模式的代码，这会同意你的观点，但模式也不够多，这使得代码难以维护并且在进行更改时容易出错。

概括这样的事情在逻辑上是有缺陷的，但是如果您将问题重新表述为“代码中是否存在太多模式是更大问题的征兆，即抽象级别不足”，那么答案是肯定的。总是这样吗？不。

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2009-01-21T18:24:48.047

我们使用了很多格言（这些格言在 SO 中很常见），如果您将它们追溯到源头，最初是有保留地断言的；如“......当你正在使用......进行开发时”这是其中一种情况。当您进行 OOP 时，模式非常适合。当您处于另一个范式时，YMMV。

“重构”是另一个类似的案例。

当我编写 SQL 时，我大脑的“模式”部分会关闭。

请注意您的引文：“我正在手动生成一些我需要编写的宏的扩展。”。所以他识别模式并将它们抽象成一个宏——他没有用另一种方式重新编码。干得好。这不是模式，而是我们发现的模式没有做正确的事情。我想说他的评论可以进入任何扩展 DRY 优点以及如何拥有它们的 wiki 条目。GoF 会完全同意 - 识别设计模式，然后使用您对它们的了解来适当地实现（或重构）它们。

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2009-01-21T18:38:28.423

在我的程序设计阶段，我经常**首先分解问题**，一旦我把它分解，我就可以很容易地开始识别设计中固有的模式。那时，我可以开始应用众所周知的设计模式，以便在交流或实现设计时，我有一种可以用于交流的通用语言，并希望我可以重用一些通用的对象以前在执行过程中执行过类似的模式。

很多时候，当设计模式应用不正确时，这是因为过程发生了相反的情况。程序员 Joe（我向你们中的 Joe 表示歉意）读了一本关于设计模式的书，然后说：“好的，我了解设计模式 X，现在如何将它应用到我的应用程序中？” **这是错误的。**

设计模式可能是一种强大的武器，但与其他任何东西一样，它们应该被适当地使用，并且程序员也应该随时准备将一些原创思想融入他的设计中。

* * *

## 回答 #17

> 赞同：2
> 
> 时间：2009-01-21T20:53:51.130

我认为有时当你学习一种模式时，你不仅仅是学习模式。但是您在问题域中获得了以前可能没有的新观点。也许它正是你想要的。

如果没有“问题”的上下文，我们就不能说设计模式是否是解决方案。

* * *

## 回答 #18

> 赞同：2
> 
> 时间：2009-01-21T22:21:14.887

永远*不需要*使用设计模式——你总是可以编写代码，忽略迄今为止所学的所有编码——它甚至可以工作。但是设计模式可以让事情变得更容易，为您提供讨论设计的共享语言。

设计模式并不代表太少的抽象——它们是一种提高抽象水平的尝试。您可以说“这个位是访问者”而不是“这里有一些代码递归地遍历对象树，对它们执行操作。”

* * *

## 回答 #19

> 赞同：2
> 
> 时间：2009-02-12T08:24:13.947

如果模式不是解决方案，那么模式就是问题所在。我的意思是：如果为了模式而引入模式而不是为了解决应用程序中实际存在的设计问题，那么它可能会导致问题而不是解决或防止问题。
我一直在工作中告诉人们，四人帮一书（设计模式：可重用的面向对象软件的元素）是参考，而不是优秀设计的手册。

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2009-01-21T18:13:35.323

是的，pg就在那里。如果您在整个应用程序中看到类似的代码，则意味着您缺少该代码的抽象。代码越少越好。

这是关于该主题的另一篇文章：http: [//blog.plover.com/prog/design-patterns.html](http://blog.plover.com/prog/design-patterns.html)

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2009-01-21T18:16:53.880

我宁愿使用太多的模式，也不愿完全没有。也就是说，适当的平衡当然是目标。

* * *

## 回答 #22

> 赞同：1
> 
> 时间：2010-07-08T15:21:39.613

That sentence makes no sense: *design patterns are a sign of not enough abstraction* As design patters **are** an abstraction! Following the answers here I agree that programming languages should have a way to express design patterns. However that is obviously not possible for every situation.

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2009-01-21T18:17:11.183

我记得在与 GoF 的一次采访中，有人询问了一个常见的说法，即设计模式是替换语言中缺少的功能的工具。作者认为 A）任何语言都有设计模式（不是相同的），因为设计模式是为解决语言特性而构建的工具，B）通过向一种语言添加更多特性来摆脱它们的需求是不可行的。

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2009-01-21T19:42:40.010

设计模式是针对常见问题的解决方案。

但首先，您需要知道问题出在哪里或在哪里。这就是人们无法正确使用模式的地方。

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2009-05-03T01:00:32.727

我还没有在我的代码中找到 GoF“设计模式”的用途。coderati 似乎已经掌握了 GoF 的书，现在大多数公司都期望你了解它们并应用它们。就在今天，我接受了一次面试，被问到我知道并使用过哪些模式，以及如何将它们应用到一家大型银行的企业应用程序中。

从我们以前的项目中学习的一般想法显然是有道理的。没有意义的是围绕特定 GoF 模式的炒作和崇拜，人们将它们误认为是良好的编码实践，并期望爱和接受它们，以便被称为称职的开发人员。

因此，为了回答您的问题，我想说 GoF 的设计模式理念被大多数人误解和过度使用。我们需要成熟到更高层次地使用设计模式，将其作为一种通用的学习工具，适用于我们学习和改进 OO 的方式——而不仅仅是记忆和强加于程序的 20 个千篇一律的想法。 ***没有银弹。***

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2009-05-15T22:22:27.353

编程语言，就像口语一样，为您提供了说出您想说的话的词汇。模式只描述了一种表达方式，让人们在更高的层次上知道你在说什么。

如果你愿意让我用一个比喻：写音乐是一个常见的“问题”，而音乐通常（显然并非总是）松散地组合成以下内容的某种变体：

诗歌合唱 诗歌合唱 诗歌合唱 合唱

这确实是一种“模式”。你仍然需要写这首歌，并不是每首写的歌都能很好地使用这种模式。

我试图理解的一点是，模式不是用于编程或音乐的即插即用解决方案。它们是您入门的指南，也是您可以制作适合您需要的东西的跳板。

# c++ - 如何检测运行时正在使用的 CPU？

> ID：466377
> 
> 赞同：4
> 
> 时间：2009-01-21T18:10:09.963
> 
> 标签：c++, gcc, cpu

如何检测运行时正在使用哪个 CPU？c++ 代码需要区分 AMD / Intel 架构？使用 gcc 4.2。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-01-21T18:38:16.257

使用 with的`cpuid`指令`EAX=0`将按顺序返回 12 个字符的供应商字符串`EBX`, `EDX`, `ECX`, 。

对于 Intel，此字符串为“G​​enuineIntel”。对于 AMD，它是“AuthenticAMD”。其他创建 x86 芯片的公司有自己的字符串。[维基百科页面](http://en.wikipedia.org/wiki/CPUID)列出了`cpuid`许多（全部？）字符串，以及用于检索详细信息的示例 ASM 列表。

你真的只需要检查 ECX 是否匹配最后四个字符。前四个不能用，因为有些全美达 CPU 也是以“正版”开头的

*   对于英特尔来说，这是`0x6c65746e`
*   对于 AMD，这是`0x444d4163`

如果您将其中的每个字节转换为一个字符，它们就会出现倒退。这只是 x86 小端设计的结果。如果您将寄存器复制到内存并将其视为字符串，它会正常工作。

示例代码：

```
bool IsIntel() // returns true on an Intel processor, false on anything else
{
  int id_str; // The first four characters of the vendor ID string

  __asm__ ("cpuid":\    // run the cpuid instruction with...
  "=c" (id_str) :       // id_str set to the value of EBX after cpuid runs...
  "a" (0) :             // and EAX set to 0 to run the proper cpuid function.
  "eax", "ebx", "edx"); // cpuid clobbers EAX, ECX, and EDX, in addition to EBX.

  if(id_str==0x6c65746e) // letn. little endian clobbering of GenuineI[ntel]
    return true;
  else
    return false;
} 
```

编辑：另一件事-`IsAMD`只需更改`IsVIA`.`IsTransmeta``if`

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-01-21T18:14:25.027

如果您使用的是 Linux（或在 Cygwin 下运行的 Windows），您可以通过阅读特殊文件`/proc/cpuinfo`并查找以`vendor_id`. 如果字符串是`GenuineIntel`，则您正在英特尔芯片上运行。如果你得到`AuthenticAMD`，你在 AMD 芯片上运行。

```
void get_vendor_id(char *vendor_id)  // must be at least 13 bytes
{
    FILE *cpuinfo = fopen("/proc/cpuinfo", "r");
    if(cpuinfo == NULL)
        ;  // handle error
    char line[256];
    while(fgets(line, 256, cpuinfo))
    {
        if(strncmp(line, "vendor_id", 9) == 0)
        {
            char *colon = strchr(line, ':');
            if(colon == NULL || colon[1] == 0)
                ;  // handle error
            strncpy(vendor_id, 12, colon + 2);
            fclose(cpuinfo);
            return;
        }
    }

    // if we got here, handle error
    fclose(cpuinfo);
} 
```

如果您知道您在 x86 架构上运行，那么可移植性较差的方法是使用 CPUID 指令：

```
void get_vendor_id(char *vendor_id)  // must be at least 13 bytes
{
    // GCC inline assembler
    __asm__ __volatile__
        ("movl $0, %%eax\n\t"
         "cpuid\n\t"
         "movl %%ebx, %0\n\t"
         "movl %%edx, %1\n\t"
         "movl %%ecx, %2\n\t"
         : "=m"(vendor_id), "=m"(vendor_id + 4), "=m"(vendor_id + 8)  // outputs
         : // no inputs
         : "%eax", "%ebx", "%edx", "%ecx", "memory");  // clobbered registers
    vendor_id[12] = 0;
}

int main(void)
{
    char vendor_id[13];
    get_vendor_id(vendor_id);

    if(strcmp(vendor_id, "GenuineIntel") == 0)
        ; // it's Intel
    else if(strcmp(vendor_id, "AuthenticAMD") == 0)
        ; // it's AMD
    else
        ; // other
    return 0;
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-21T18:20:00.490

在 Windows 上，您可以使用[GetNativeSystemInfo](http://msdn.microsoft.com/en-us/library/ms724340(VS.85).aspx)函数

在 Linux 上，尝试[sysinfo](http://linux.die.net/man/2/sysinfo)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-22T13:35:07.973

您可能根本不应该检查。相反，请检查 CPU 是否支持您需要的*功能*，例如 SSE3。两个英特尔芯片之间的差异可能大于 AMD 和英特尔芯片之间的差异。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-21T18:39:41.557

您必须在 Makefile arch= 中定义它`uname -p 2>&1`，然后将 #ifdef i386 some #endif 用于不同的架构。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2013-02-05T10:55:41.713

我发布了一个小项目： http: [//sourceforge.net/projects/cpp-cpu-monitor/](http://sourceforge.net/projects/cpp-cpu-monitor/) ，它使用**libgtop**库并通过 UDP 公开数据。您可以修改它以满足您的需要。GPL 开源。请询问您是否对此有任何疑问。

# javascript - 预期的 javascript 对象

> ID：466395
> 
> 赞同：0
> 
> 时间：2009-01-21T18:16:15.943
> 
> 标签：javascript, internet-explorer

我不擅长 JavaScript，这是 Google 的代码。我得到了一个预期的对象，这在其他地方似乎工作正常。

这是第三行到最后一行（带有 的行`utmSetVar`）。

```
 <HTML>
<HEAD>
</HEAD>
<BODY >
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-159907-14");
pageTracker._trackPageview();
} catch(err) {}
</script>

   <script type="text/javascript">__utmSetVar('aff/VG-CEGBWI');</script>
</BODY>
</HTML> 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-21T18:55:39.247

utmSetVar 函数是在旧的 Google Analytics 代码库中使用“urchin”跟踪器提供的函数。

[http://www.google-analytics.com/urchin.js](http://www.google-analytics.com/urchin.js)

您可以使用以下内容来确定您使用的是哪一个

[http://www.google.com/support/googleanalytics/bin/answer.py?answer=75129](http://www.google.com/support/googleanalytics/bin/answer.py?answer=75129)

为了解决您的问题，您将需要恢复到旧的跟踪方式（简单的 hack 解决方案）或咨询谷歌网站以了解实现您所追求的最新方法。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-21T21:21:47.237

正确的代码是：

```
<script type="text/javascript">pageTracker._setVar('aff/undefined');</script> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-21T18:44:06.167

当我删除有问题的代码行时，对我来说效果很好。

我不知道有什么`__utmSetVar('aff/VG-CEGBWI');`作用。你能详细说明吗？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-21T18:50:21.270

从我在 Google 上看到的内容来看，它用于跟踪（cookie）网站访问者。这是有关如何定义它的示例。不幸的是，该页面已消失，您只能在 Google 缓存中找到它：

[什么是 utmsetvar](http://74.125.95.132/search?q=cache:go6X_gcBMIIJ:www.danielpayne.net/theleap/2008/04/how-to-set-up-user-defined-variable.html+__utmSetVar&hl=en&ct=clnk&cd=3&gl=us&client=firefox-a)

# c# - 类中的静态方法 - 在这种情况下可以吗？

> ID：466406
> 
> 赞同：7
> 
> 时间：2009-01-21T18:18:22.660
> 
> 标签：c#, asp.net, asp.net-2.0

大家好 - 我有一个应用程序来验证用户。他们传递用户名和密码。我将用户名和密码传递给具有静态方法的类。例如，它正在调用具有以下签名的方法：

```
public class Security
{
public static bool Security.Member_Authenticate (string username, string password) 
{ //do stuff}
} 
```

如果我有 1000 人同时击中这个，我会不会因为该方法的返回流血到其他人而有任何问题？我的意思是，由于这些方法是静态的，如果一个人获得身份验证，实际上他们不应该是，但他们之前的人成功通过身份验证，ASP.Net 由于方法是静态的而返回不匹配的结果？我读过静态属性与视图状态的问题，但对静态方法有点困惑。如果这是一种不好的方法，那么首选的方法是什么？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-21T18:22:06.680

这不会发生。当方法是静态的（或在 VB.NET 中共享）时，只要该方法不依赖于输入以外的任何东西来解决问题，那么您就是安全的。只要您不从其他任何地方修改任何公共变量或对象，就可以了。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-21T18:22:10.517

只要在连续调用之间不使用任何持久数据，静态方法就可以了。我猜你的方法只是在数据库上运行一个查询并基于它返回真/假。

在这种情况下，我认为静态方法应该可以正常工作，无论您对其进行了多少次调用。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-21T18:23:09.250

ASP.net 确实使用了各种底层线程池，这会使静态方法和字段变得很冒险。

但是，您可以通过仅在该方法中使用局部范围的变量来避免使用静态方法的大多数线程问题。这样，每个线程（用户）将拥有自己的所有正在使用的变量的内存副本。

如果您使用更高范围的变量，请确保对它们的所有访问都具有线程意识。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-21T19:19:10.260

抛出异常不是一个好习惯，因为它使 .net 运行时创建额外的基础设施来捕获它们。为了验证这一点，创建一个类并使用循环用一些随机值填充它。为像 10,000 这样的大计数器进行循环迭代。记录创建列表所需的时间。现在将实例创建包含在 try..catch 块中并记录时间。现在，您可以看到异常大的差异。

例如

```
for(int i=0; i<10000; i++){
     Employee emp = new Employee();
     emp.Name = "Random Name" + i.ToString();
} 
```

相对

```
for(int i=0; i<10000; i++){
     try{
          Employee emp = new Employee();
          emp.Name = "Random Name" + i.ToString();
     }catch{}
} 
```

尽管是否抛出异常没有固定的解决方案，但最佳实践是在程序中创建备用流程并使用适当的返回值处理每个条件。只有当情况可以被证明是异常时，才应该抛出异常。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-23T19:52:00.240

虽然我可以看到静态方法在感知性能提升方面的价值，但我相信这里的真正问题是收益（和风险）是否值得你可能造成的维护混乱和安全漏洞。我相信大多数人会警告您不要提供接受用户凭据并返回成功或失败的公共方法。它潜在地提供了一种简单的黑客攻击方法。

所以，我的观点是哲学的。否则，我同意其他人的观点，即限制代码使用局部变量应确保您不会因方法的并发访问而产生任何副作用问题，即使在不同的线程上也是如此，即，如果您调用该方法在 ThreadPool 线程上。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-21T18:42:00.990

如果出现问题（在原始方法中），最好使用`public static void Authenticate(string, string)`哪个抛出异常？`return false`

这是一种很好的 .NET 风格。布尔函数返回类型是 C 风格，已过时。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-09T18:43:37.350

为什么没有用户名和密码的用户类和一个称为身份验证的方法？

# eclipse - (Eclipse) 如何将第三方插件与我的功能打包在一起？

> ID：466416
> 
> 赞同：6
> 
> 时间：2009-01-21T18:21:29.910
> 
> 标签：eclipse, plugins

MyFeature 由依赖于第三方插件 d 的插件 a、b 和 c 组成。我如何打包 MyFeature 这样

1.  它包含 d 并且如果它在目标工作台中不存在则可以安装它
2.  我的插件 a、b 和 c 可以引用 d 的特定版本，即使工作台中存在更高或更低版本
3.  即将安装时满足d的依赖要求

PS我意识到上面的一些可能是不可能的。我只是在陈述我目前看到的问题，以及是否有更好的方法让我完全错过

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-21T18:33:20.697

您需要的一切都可以轻松完成。您的 a、b、c 插件可能取决于 d 的确切版本。Eclipse 插件开发工具允许您进行设置。

插件“d”应该在您的更新站点上，在您的插件旁边。您的功能应明确声明它由 a、b、c 和 d 组成。如果“d”需要更多插件，最好在更新站点上也提供它们（然后您的功能也可以包含它们）。

PDEBuild（用于无头构建 Eclipse 插件的 ant 脚本）支持提取/重新打包 3rd 方插件，因此您可以使用它来准备您的功能。

# visual-studio - Visual Studio 中的字母排序方法

> ID：466417
> 
> 赞同：63
> 
> 时间：2009-01-21T18:21:57.740
> 
> 标签：visual-studio, visual-studio-2008, coding-style, resharper, organization

是否有任何类型的插件或工具可用于 Visual Studio 2008 以按字母顺序排列方法？理想情况下，我想要一个自动或按需按字母顺序排列选择或指定类型（即只有方法，而不是成员变量）的工具。

* * *

## 回答 #1

> 赞同：38
> 
> 时间：2015-11-14T14:02:24.437

虽然 Resharper 有许多很酷的功能，但它对 CPU 和 I/O 的使用有很大的影响，并且使用起来可能非常复杂。除非您有资格获得一些非常具体的免费使用许可证，否则它也仅在商业许可下可用。

试试[CodeMaid](https://visualstudiogallery.msdn.microsoft.com/76293c4d-8c16-4f4a-aee6-21f83a571496)。它可以免费用于商业用途，并且性能开销要低得多。我发现它易于使用，并且非常适合按字母顺序排列方法。

* * *

要对文件进行排序，请通过解决方案资源管理器打开文件：

1.  右键单击打开的文件
2.  Code Maid 菜单（可能在右键菜单顶部附近）
3.  点击`Reorganize Active Document`

或者，使用默认的 CodeMaid 热键`CTRL`+对您`M`的`Z`活动文件进行排序。

* * *

## 回答 #2

> 赞同：26
> 
> 时间：2009-01-21T18:50:07.310

[Resharper](http://www.jetbrains.com/resharper/index.html)有一个类型成员布局，它可以按类型、可访问性和字母顺序对成员进行排序。

~~您还可以查看[Ora](http://www.codeplex.com/ora)，它在 Visual Studio 中显示了一个已排序的窗格（即使您的源可能不是）。~~林克死了。

* * *

## 回答 #3

> 赞同：23
> 
> 时间：2011-12-22T03:59:41.870

以下答案比 OP 要求的要远得多，因为我相信，仅按名称排序方法对于大多数程序员来说是远远不够的。大多数情况下，您希望您的方法、构造函数、字段、事件处理程序和接口实现彼此分离（即通过区域），并按各种标准排序。

为此，我尝试[了 NArrange](http://www.narrange.net/)、[Regionerate](http://www.rauchy.net/regionerate/)等，但我发现它们使用起来并不直观。所以**[ReSharper](http://www.jetbrains.com/resharper/)**成为了我选择的工具。

正如@DavidN 已经提到的，ReSharper 可以按名称、可访问性、类型、只读等对您的类成员（字段、构造函数、方法、委托）进行排序......您还可以用区域包围特定成员。我最喜欢的是对接口成员（例如，`#region IDisposable`其中包含`void Dispose()`方法）和处理事件的方法进行分组的能力。

ReSharper 提供了两者 - 一种配置和触发类成员排序的简单方法。

**配置布局**

在 Visual Studio 中创建一个 XML 文件，并将默认类型成员布局（ReSharper 选项 > 语言 > C# > 类型成员布局）复制粘贴到该文件中。下载最新的[XSD 架构](https://github.com/hhariri/Blog/tree/master/Various)。将架构文件添加到 Visual Studio 的架构文件（菜单 > XML > 架构... > 添加）。您现在应该能够使用 IntelliSense 支持编辑 XML 文件。

**触发重新排序**

如果您使用*Visual Studio*键盘方案（ReSharper 选项 > Visual Studio 集成）并按下*Silent Code Cleanup*`**Ctrl+E,F**`。将弹出一个对话框，您可以在其中选择*代码清理*设置。对于此设置，您应该检查*Reorder type members*。第二次按下快捷键时，ReSharper 将自动重新排序您的班级成员。

 ***[1](https://github.com/hhariri/Blog/tree/master/Various)：[ReSharper 类型成员 XSD 架构](https://github.com/hhariri/Blog/tree/master/Various)

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2010-06-24T15:30:37.287

对于 C#，您可以使用[Regionerate](https://marketplace.visualstudio.com/items?itemName=OmerRauchwerger.Regionerate)来组织您的代码。您可以创建一个简单组织代码但不使用区域的模板。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-01-23T00:30:15.360

您可以使用[Devexpress](http://www.devexpress.com/)的免费[DXCore](http://www.devexpress.com/Downloads/Visual_Studio_Add-in/DXCore/)产品（用于创建[CodeRush](http://www.devexpress.com/Products/Visual_Studio_Add-in/CodeRushX/)的相同可扩展性框架）自己创建这样的功能。

# .net - 在 C# 服务中设置 ASP.Net 缓存 PrivateBytesLimit

> ID：466428
> 
> 赞同：3
> 
> 时间：2009-01-21T18:27:24.610
> 
> 标签：.net, caching

我有一个 C# 服务，它不是 ASP.NET 应用程序，而是使用类 HttpRuntime 的单例实例来缓存其缓存成员中的项目。单例是这样创建的：

```
static private System.Web.HttpRuntime _httpRuntime = new HttpRuntime(); 
```

我想设置它的最大内存使用量，所以我在应用程序的配置文件 service.exe.config 中有以下内容：

```
<configuration>
 <caching>
    <cache privateBytesLimit= "50000000"   privateBytesPollTime = "00:01:00"/>
 </caching>
</configuration> 
```

这似乎没有任何效果。当我查看 HttpRuntime.Cache.EffectivePrivateBytesLimit 时，它没有设置为 50MB，而是 720MB。

我究竟做错了什么？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-21T19:16:00.173

您没有使用正确的缓存元素。根据文档，可以使用缓存元素的 privateBytesLimit 属性设置 EffectivePrivateBytesLimit 属性，[以便在应用程序的配置文件](http://msdn.microsoft.com/en-us/library/system.web.caching.cache.effectiveprivatebyteslimit.aspx)[中缓存（ASP.NET 设置架构）元素](http://msdn.microsoft.com/en-us/library/ms228248%28v=vs.90%29.aspx)；

```
<configuration>
  <system.web>
    <caching>
      <cache privateBytesLimit="10000000" privateBytesPollTime="00:01:00" />
    </caching>
  </system.web>
</configuration> 
```

# performance - 向 SQL Server 2008 数据库添加非强制外键是否会影响性能？

> ID：466429
> 
> 赞同：3
> 
> 时间：2009-01-21T18:27:25.327
> 
> 标签：performance, sql-server-2008, foreign-keys

我正在使用数据库，我想开始使用 LINQ To SQL。出于性能原因，该数据库现在没有任何 FK。我们一次向数据库插入数百万行，这就是为什么没有任何 FK 的原因。

所以我想我要在数据库中添加非强制 FK 来描述我的 LINQ To SQL 表之间的关系，但我不希望添加非强制外键会影响性能。

有谁知道这可能是什么影响？

更新：我将 LINQ-To-SQL 用于非性能密集型的东西。80% 的数据访问是通过生产中的存储过程进行的。但是对于编写单元测试和其他非性能关键任务，LINQ-To-SQL 使数据访问变得非常容易。

更新：这是添加非强制 FK 的方法

ALTER TABLE [dbo].[ACI] WITH NOCHECK ADD CONSTRAINT [FK_ACI_CustomerInformation] FOREIGN KEY([ACIOI]) REFERENCES [dbo].[CustomerInformation] ([ACI_OI]) NOT FOR REPLICATION GO

ALTER TABLE [dbo].[ACI] NOCHECK 约束 [FK_ACI_CustomerInformation] GO

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-23T15:27:56.373

对于不同的环境（同一驱动器上的数据/日志、同一驱动器上的 tempdb、大量缓存与少量缓存等），答案可能会有所不同，因此找出这一点的最佳方法是进行基准测试。创建两个相同的数据库，一个有 fk，一个没有。对每个数据库执行正常的百万行加载，并测量每秒的事务。这样您就可以在自己的环境中确定。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-11-11T16:24:22.340

外键将在您的表中创建非聚集索引，这将提高外键连接的性能。

额外的索引会降低插入/更新/删除/合并语句的性能，并会增加表大小。

[http://msdn.microsoft.com/en-us/library/ms191195.aspx](http://msdn.microsoft.com/en-us/library/ms191195.aspx)

即使使用 NOT FOR REPLICATION 创建索引，索引仍然存在，SQL Server 将需要维护它们。

在您的情况下，我会： - 使用外键并降低性能或 - 在生产中不使用外键（再见数据完整性）并针对我将为其创建外键的生产数据库副本运行我的测试。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-21T18:38:23.293

它可能会产生一些影响，尤其是在那些数量上。
但是，我会先在类似的系统上对此进行测试，这样您就可以测量影响（如果有的话）。

不过老实说，我可能会为此使用手写存储过程，因此您可以根据需要优化它们，而不是使用 LINQ to SQL。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-11-11T16:04:34.747

我意识到这是一个老问题，但我想评论创建一个未对现有数据强制执行的 FK 的做法是多么糟糕。如果实际上需要外键，则需要在添加外键（应该在设计时添加）之前修复任何不良数据，而不是试图忽略它。您所做的只是通过拒绝注意到它并采取措施来掩盖您非常严重的数据完整性问题。由于需求变化，偶尔需要这样做，但在将外键添加到包含数据的表时，不应将其视为首选技术。应该找到并修复不良数据。

与PK无关的数据是没有用的。如果我有一个订单表，其客户 ID 不再存在于客户表中，我怎么知道谁订购了该产品？当然，这就是为什么无论您是否进行百万行插入，都应该从一开始就强制执行 FK。我每天通过 SSIS 对许多具有外键的表进行数百万行插入，以此作为不首先设置它们的原因表明缺乏对数据库设计的理解。牺牲数据完整性来提高速度总是一个糟糕的主意。没有数据完整性，您的数据库将不可靠，因此毫无用处。

# .net - 创建存根的首选工具是什么？

> ID：466430
> 
> 赞同：3
> 
> 时间：2009-01-21T18:28:53.013
> 
> 标签：.net, testing, stub

继我的上一个问题“[什么是“存根”](https://stackoverflow.com/questions/463278/what-is-a-stub)之后，我真的很想今晚坐下来，更多地尝试创建存根对象。

**创建存根对象的首选工具是什么？**

并获得奖励积分:)

您还可以链接到任何好的教程以开始使用它们吗？

非常感谢男孩和女孩，感谢:)

**仅供参考 - 我正在使用 .NET（2.0 @ Work，3.5 @ Home）**

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-21T18:35:15.093

简单地说，Rhino.Mocks。是的，“Mocks 不是 Stubs”，但 Rhino.Mocks 两者兼而有之。在将我的大脑包裹在 Rhino.Mocks 上之前，我手动编写了自己的存根。再也不。

抱歉，我没有获得奖励积分。Ayende.com 是获取 Rhino.Mocks 的地方，有不错的在线文档和一个充满问题的论坛。作者其实也很擅长回应和回答。我觉得学习如何使用它没有什么好的“捷径”。为此，我认为最好通过实践和/或反复试验来学习。

（在重读上述内容时，我并不是说它听起来像 RTFM，即使它可能会以这种方式出现。）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-21T18:47:39.390

我已经使用 Rhinomocks 有一段时间了。它的问题在于它允许各种不同的策略和语法来创建模拟和存根。对象模型越来越挤满了各种扩展方法、函数和对象，这些扩展方法、函数和对象仅在某些上下文中有用。这使得学习变得更加困难。

我是 AAA 语法的粉丝，所以我可能会在下一个项目中切换到 Moq，它比 rhino mocks 更新一些。它从 rhinomocks 中窃取了一些好主意，但没有 rhinomocks 多年来收集的旧内容。如果您不熟悉嘲笑和存根，我当然会研究一下。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-21T18:48:10.963

继我对[JMD 回答的](https://stackoverflow.com/questions/466430/what-is-your-tool-of-choice-for-creating-stubs#466446)评论之后..

我一直在检查 Rhino Mocks，我之前听说它也有存根功能，所以看看它是如何工作的会很有意义。

我没有机会用这些生成很多代码，但这里有一些我发现的有用链接（到目前为止）：

*   [来自男人本人:)](http://ayende.com/Wiki/(S(vcy2bn55h5cja0vsedn14y45))/Rhino+Mocks+-+Stubs.ashx)
*   [“使用 Stub 和 Rhino Mocks 进行单元测试”](http://grabbagoft.blogspot.com/2007/06/unit-testing-with-stubs-and-rhino-mocks.html)
*   [“Rhino Mocks vs NMock”](http://devlicio.us/blogs/derik_whittaker/archive/2007/06/13/rhino-mocks-vs-nmock-part-1-stubs.aspx)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-21T20:24:49.177

RhinoMocks 很棒而且非常完整，但我发现[moq](http://code.google.com/p/moq/wiki/QuickStart)更易于学习和使用。

```
var mock = new Mock<IFoo>();
mock.Expect(foo => foo.Execute("ping")).Returns(true); 
```

我也使用 RhinoMocks，它很棒，但我想我发现 moq 的 API 非常容易发现，而且（简短的）文档非常有用。[当Phil Haack](http://haacked.com/archive/2008/03/23/comparing-moq-to-rhino-mocks.aspx)将 RhinoMocks 与Moq进行比较时，他并没有意识到 RhinoMocks 的所有功能，Moq 是关于可发现性的声明。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-26T07:48:06.100

我们为 Pex 开发了一个存根框架，您可以在[http://research.microsoft.com/stubs](http://research.microsoft.com/stubs)上阅读（和了解）它。这个框架在很多方面与 Rhino/Moq 不同：它“只是”用于生成存根和源代码。

# c# - SoapHttpClientProtocol.Invoke Method .NET Web 服务的异常

> ID：466433
> 
> 赞同：2
> 
> 时间：2009-01-21T18:29:56.103
> 
> 标签：c#, .net, web-services, soap, proxy-classes

我正在从基于 C# 表单的应用程序调用 Web 服务。

```
ServReturnType obj = ServProxyClass(int i, int k); 
```

我有可能找回异常。例外情况可能是服务根本没有连接，接收失败，但原始消息已发送，或介于两者之间。然后，我需要根据抛出的异常（类型或消息或两者）做出决定，以便接下来执行两个操作之一。

```
try
{    
     ServReturnType obj = ServProxyClass(int i, int k);
}
catch (WebException ex)
{
     DoAction1();
}
catch(SocketException ex)
{
     DoAction2();
}
catch(SoapException ex)
{
     DoAction1()
} 
```

问题是，我对后续操作的选择取决于第一次调用是否在失败之前到达服务器。我怎样才能找到所有可能抛出的异常的列表，以及它们可能意味着什么，因为这是框架中的所有代码。我查看了 MSDN 文档，发现 SoapHttpClientProtocol.Invoke 可以抛出 SoapException，但是该方法调用的方法会引发 System.Net.WebExceptions。所以我需要一个整个调用堆栈的列表，它可以抛出什么，以及这意味着什么。

有任何想法吗？

**更新 1**

达林，你的回答或多或少地证实了我的怀疑，即我想要的东西并没有真正的意义。我选择先做更多的侦探工作，然后用它来决定下一步做什么。不幸的是，在这种情况下，由于我们正在处理信用卡，所以到底发生了什么以及我们是否发送数据真的很重要。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-21T19:01:05.367

可以从 Web 服务调用中引发的异常的完整列表是如此之多，以至于我真的不认为测试每种可能的异常类型是一个好主意。[在许多情况下，捕获可能包含通过SOAP 故障元素](http://www.w3.org/TR/2000/NOTE-SOAP-20000508/#_Toc478383507)传输的一些业务错误的 SoapException 就足够了，并且所有其他异常都可以被视为未处理的错误：

```
try
{    
    ServReturnType obj = ServProxyClass(int i, int k);
}
catch(SoapException ex)
{
    //Serialize and analyze the fault message from the exception to obtain more info.
    DoSomethingWithTheInfo();
}
catch(Exception ex)
{
    LogTheExceptionSoThatLaterYouKnowWhatHappened(ex);
    SayToTheUserThatSomethingTerriblyWrongHappened();
} 
```

这是一篇很好的[文章](http://aspalliance.com/727_CodeSnip_Handling_SOAP_Exceptions_in_Web_Services)，解释了如何引发和处理 SoapExceptions。

# html - 缩小 HTML

> ID：466437
> 
> 赞同：13
> 
> 时间：2009-01-21T18:31:23.180
> 
> 标签：html, minify

我用谷歌搜索，但找不到任何 HTML minifacation 脚本。

我突然想到，HTML minifacation 没有什么比删除所有不需要的空格更重要的了。

是我遗漏了什么还是我的 Google Fu 丢失了？

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2009-01-21T22:01:36.533

从 HTML 中删除内容时必须小心，因为它是一种脆弱的语言。根据您的页面的编码方式，某些空白可能更重要；此外，如果您有 CSS 样式，`white-space: pre`那么您可能需要保留空格。此外，还有许多浏览器错误等，基本上 HTML 文件中的每个字符都可能满足某些要求或安抚某些浏览器。

在我看来，你最好的选择是使用 CSS 技术很好地设计页面（我最近能够在我工作的网站上获取一个重要页面，只需使用 CSS 而不是表格和嵌套样式对其进行重新编码，就可以将其大小减少 50% ="..." 属性）。然后，使用 GZip 为支持 gzip 的浏览器减小页面大小。这将节省带宽，同时保留 html 的结构。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-01-21T19:01:22.543

有时，根据封闭标签和/或 CSS，空格可能很重要。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-21T18:45:44.587

在提到的其他答案中，除了 HTML Tidy/删除空格之外，没有太多。

这更像是一项手动任务，将样式属性提取到 CSS 中（希望您没有使用 FONT 标签等），尽可能使用更少的标签和属性（例如不在元素中嵌入 <strong> 标签，而是使用 CSS 来制作整个元素 font-weight: 粗体，除非当然使用 >strong<) 等在语义上有意义。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-21T18:38:01.607

[你可以在这里](http://www.websiteoptimization.com/speed/tweak/whitespace/)找到一些很好的参考，比如 HTML tidy 等。

如果您不想使用这些选项之一，Prototype 有一种方法可以[清除](http://prototypejs.org/api/element/cleanwhitespace)DOM 中的空白。您可以自己执行此操作，并通过 Firefox 扩展 Web 开发人员工具栏中的“查看生成的源代码”进行复制。然后你可以用原型的修复替换原来的 html。很抱歉没有做出明显的 nickf。

（我推荐第一个链接）

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-21T18:38:25.820

是的，我想这几乎是在删除空格和评论。您不能像在 javascript 中那样用较短的标识符替换标识符，因为 CSS 类或 javascript 可能会依赖于这些标识符。

此外，删除空格时应小心，并确保始终至少留下空格字符，否则您的所有文本将看起来像这样。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-21T18:45:15.290

[在这个 Wordpress 博客](http://php100.wordpress.com/2006/10/30/html-compact/)上有一个关于这个主题的相当长的讨论。您可以在那里找到使用 PHP 和 HTML Tidy 提出的非常冗长的解决方案。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-12-25T17:20:14.013

我还没有尝试过，但是[htmlcompressor](http://code.google.com/p/htmlcompressor/)是一个 HTML 压缩器，如果你想尝试一下的话。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2020-08-21T15:37:34.457

如果您已经安装了 node.js 并且您是 windows 用户，您可以创建这个 .bat 它将缩小您文件夹中的所有 html 到 min 子文件夹中。

输出将在 min 文件夹中

1.  打开控制台。运行-->`npm install html-minifier -g`
2.  创建.bat。不要忘记在 cd 命令中更改路由。更改 bat 文件中的文件夹比复制和粘贴更容易。
3.  进入控制台进入 .bat 文件夹并运行它。

* * *

```
cd the_destination_folder

dir  /b *.HTML > list1.txt

for /f "tokens=*" %%A in (list1.txt) do html-minifier --collapse-whitespace --remove-comments --remove-optional-tags %%~nxA  -o min\%%~nxA 

pause 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-01-22T00:28:16.080

JavaScript 不能用作压缩 HTML 字符串的解压缩器，例如，为未压缩格式构建 DEV，运行“发布”脚本以将 DEV 构建压缩到生产环境，并将 JavaScript 附加到 HTML 源代码（使用空格等像以前一样被删除）？

服务器上的带宽会减少，但缺点是将字符串解压缩为 HTML 的客户端压力更大。还需要启用 JavaScript 并能够将解压缩的字符串解析为 HTML。

我并不是说它是一个明确的解决方案，而是可能会起作用的东西——这完全取决于您是否在没有用户 JavaScript 权限/系统规范等的情况下查看带宽。

否则寻找混淆脚本，一个简单的谷歌搜索产生[http://tinyurl.com/phpob](http://tinyurl.com/phpob) - 取决于你在寻找什么应该有可用的软件包。

如果我在错误的路线上，请大声喊叫，我会看看我还能做些什么。

祝你好运！

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2013-02-08T07:35:07.360

我最近发现了一个基于 PHP 的脚本，可以缩小您的网站 HTML - Inline css - Inline javascript on the fly 它被称为 [动态网站压缩器](http://codecanyon.net/item/dynamic-website-compressor/2838376)

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2014-02-04T18:00:28.537

这是一个用 PHP 编写的 HTML5 压缩器。

```
<?PHP
$in=file_get_contents('path/to/source.html');

//Strips spaces if there are more than one.
$in=preg_replace('/\s{2,}/m',' ',$in);
//trim
$in=preg_replace('/^\s+|\s+$/m','',$in);
/*Strips spaces between tags. 
Use (&nbsp; or &shy; or better) padding or margin if necessary, otherwise the html
parser appends a one space textnode.*/  
$in=preg_replace('/ ?> < ?/','><',$in);
//Removes tag end slash.
$in=preg_replace('@ ?/>@','>',$in);
//Removes HTML comments except conditional IE comments.
$in=preg_replace('/<!--[^\[]*?-->/','',$in);
//Removes quotes where possible.
$in=preg_replace('/="([^ \'"\=><]+)"/','=$1',$in);
$in=preg_replace("/='([^ '\"\=><]+)'/",'=$1',$in);

file_put_contents('path/to/min.html',$in);
?> 
```

之后，您将拥有一行更短的 html 代码。

最好从正则表达式中创建一个数组，但要注意转义反斜杠。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2014-02-04T18:15:13.097

我多年来一直使用这个正则表达式，没有任何问题：`s/>\s*</></g`

在 Python 中`re.sub(r'>\s*<', '><', html)`

或者在 PHP 中`preg_replace('/>\s*</', '><', $html);`

这删除了标签之间的所有空格，但不是任何地方，这是相当安全的（但并不完美，有些情况会破坏，但很少见）。

我这样做的主要原因不是速度/文件大小，而是因为空白通常会引入一个空间。这没关系，但是当您开始在 DOM 中使用 Javascript 时，经常会丢失空格，从而产生（较小的）布局差异。

考虑：

```
<div>
    <a>link1</a>
    <a>link2</a>
</div> 
```

链接之间有一个空格，但现在我执行以下操作：

```
$('div').append('<a>link3</a>') 
```

而且没有空间......我需要在我的 JS 中手动添加空间，恕我直言，这是相当丑陋且容易出错的。

# java-me - 如何在 J2ME 中捕获 MP3？

> ID：466439
> 
> 赞同：2
> 
> 时间：2009-01-21T18:31:32.870
> 
> 标签：java-me, mp3, audio-recording

我能够通过 Manager.createPlayer("capture://audio") 捕获 WAV 格式的音频。但是，有没有办法在 J2ME 中捕获 MP3 格式的音频？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-23T19:37:37.150

它可能取决于所讨论的平台，您必须检查要支持的不同设备实现。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-23T20:30:58.680

罗里，你什么意思？我真的在要求 createPlayer(String s) 方法的字符串。J2ME 自动录制到 WAV 文件，但我想知道是否可以请求它录制到 MP3。当然，如果那个 MP3 参数不起作用，就会抛出 MediaException。如果我似乎错过了您的回答，请原谅我。

# web-applications - 如何从我的 URL 中删除“cgi-bin”？

> ID：466448
> 
> 赞同：6
> 
> 时间：2009-01-21T18:36:14.123
> 
> 标签：web-applications, url-rewriting, cgi, cgi-bin

我正在嵌入式设备上创建一个小型应用程序，该设备上运行有[boa](http://www.boa.org/) Web 服务器。我正在创建一个混合了普通 HTML 页面和 Perl 脚本的 Web 应用程序，以与主应用程序交互。有没有办法隐藏某些页面是从设备上的 cgi-bin 提供的事实？

我现在拥有的是以下 URL。

*   [http://localhost/home.html](http://localhost/home.html)
*   [http://localhost/cgi-bin/config.pl](http://localhost/cgi-bin/config.pl)
*   [http://localhost/cgi-bin/control.pl](http://localhost/cgi-bin/control.pl)
*   [http://localhost/info.html](http://localhost/info.html)

我非常喜欢的是：

*   [http://localhost/](http://localhost/)
*   [http://localhost/config/](http://localhost/config/)
*   [http://localhost/control/](http://localhost/control/)
*   [http://localhost/info/](http://localhost/info/)

上面的 URL 将我带到相应的 index.html 或 index.pl 文档。是否存在文件结构和服务器设置的某种组合可以启用此行为？

我已经在 Google 上搜索过这个，但正如您所想象的那样，我正在获取 URL 中带有“cgi-bin”的搜索结果页面。我希望这里有人以前做过。

**编辑：**我应该提到我知道如何通过在我的 web 根目录中创建单独的文件夹来为纯 HTML 页面执行此操作，所有这些文件夹都包含 index.html 页面。我的问题是让这种类型的解决方案可以处理 cgi-bin 目录中的 .pl 或 .cgi 文件。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-21T18:49:12.630

在 apache 中，使用 mod_rewrite 会很简单，但 boa 有点不同。您在这里遇到了几个不同的问题。对于 .html 文件，请确保您在 boa.conf 中有以下行：

目录索引 /index.html

然后在访问根目录时将检索任何名为 index.html 的文件。因此，如果您的根目录是 /htdocs，那么制作 /htdocs/index.html 和 /htdocs/info/index.html 应该可以解决这些问题。

对于您的其他脚本，您需要添加以下行：

AddType application/x-httpd-cgi pl

这应该让 perl 像 CGI 一样在任何地方执行。然后是确保 boa 知道它们是索引文件的问题。您可以使用 Redirect 或 Alias 指令来克服其中的一些问题。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-01-21T18:50:00.180

不幸的是，Boa 似乎没有任何可用的 mod_rewrite 选项，因此您在重写 URL 时可以做的事情受到限制。来自[**boa 文档**](http://www.boa.org/documentation/boa-2.html)的这里是您可以使用的选项：

**重定向、别名和 ScriptAlias**

> Redirect、Alias 和 ScriptAlias 都具有相同的语义——它们匹配请求的开头并采取适当的操作。对其他服务器使用 Redirect，对同一服务器使用 Alias，并使用 ScriptAlias 启用目录以执行脚本。
> 
> **重定向**
> 
> 允许您告诉客户端曾经存在于服务器命名空间中的文档，但现在不再这样做了。这允许您告诉客户在哪里寻找重新定位的文档。
> 
> **别名**
> 
> 将一条路径别名为另一条路径。当然，文件系统中的符号链接也可以正常工作。
> 
> **脚本别名**
> 
> 将虚拟路径映射到服务脚本的目录。

基于此，您可以尝试使用 ScriptAlias 或 Alias，甚至是指向“更好” URL 的符号链接。不幸的是，由于这里没有可用的 Boa，我无法测试这些选项来更具体地告诉您要尝试什么。

# html - 在鼠标悬停时更改图像边框

> ID：466449
> 
> 赞同：2
> 
> 时间：2009-01-21T18:36:32.470
> 
> 标签：html, dhtml

我有一个问题，我正在处理一个画廊 php 脚本并且需要帮助，我有一张图片，它周围有一个浅灰色的边框，如果有鼠标悬停事件，我希望边框变成灰色。我怎样才能做到这一点？

提前致谢

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-21T18:42:59.477

使用 :hover 伪类。例如：

```
<html>
<head>
    <style>
        IMG.HoverBorder {border:5px solid #eee;}
        IMG.HoverBorder:hover {border:5px solid #555;}
    </style>
</head>
<body>
    <img class="HoverBorder" src="test.png" />
</body>
</html> 
```

上面的代码在我可以访问的所有健全的浏览器上运行良好。如果您需要 IE 6 支持，请深呼吸并[检查一下](http://locusoptimus.com/css-trickery/ie-image-border-styles-on-hover-solution.php)（感谢@Brian Kim 提醒我有关 IE6）：

```
<html>
<head>
    <style>
        a:hover{ background-color:white; }
        a:link img, a:visited img{ border:5px solid #eee; }
        a:hover img{ border:5px solid #555; }
    </style>
</head>
<body>
    <a href="#"><img class="HoverBorder" src="03 messed up status log edit IE6.png" /></a>
</body>
</html> 
```

这种方法有几种变体——我建议您单击该站点以获取可能更适合您的情况的其他选项。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-21T18:42:08.167

您可以使用[:hover](http://www.w3schools.com/css/pr_pseudo_hover.asp)伪类。

例如：

```
<style>
a.bordered:hover img {
   border: solid 2px grey;
}
</style>

<a href="..." class="bordered"><img src="..." /></a> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-21T18:43:52.953

使用 .mypictureclass:hover 应用边框。

还要给图片显示类应用透明边框，避免添加边框时跳动。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-21T20:55:08.697

好的，伙计们，我知道了 XD，正如我所说，我是一个 html 人，我刚刚发现它是如何工作的，它使用 CSS 作为样式，所以我尝试了很多东西，而且，令人惊讶的是，我只是做了一个副本的 imagethumbnail-tag 并更改了 bordercoler 并将标题编辑为 imagethumbnail:hover

也谢谢大家:)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-06-17T21:08:45.067

```
<style type="text/css">
body,td,th {
    font-size: 14px;
    color: #FFF;
}
body {
    background-color: #000;
}
a {
    font-size: 14px;
    color: #FFF;
}
a:link {
    text-decoration: none;
}
a:visited {
    text-decoration: none;
    color: #FFF;
}
a:hover {
    text-decoration: none;
    color: #CCC;
}
a:active {
    text-decoration: none;
    color: #FC3;
}
a:img,
a:link img,
a:visited img,
a:focus img,
a:hover img,
a:active img {
    border: none;
}
</style> 
```

该代码遵循我到目前为止所看到的所有内容，但仍未正确显示在 IE 中并显示图像周围的边框。这是其中一个鼠标悬停图像的示例。

```
 <a href="index.html">
        <img src="images/buttons/home.png" alt="Home" width="216" height="44" 
        onmouseover="this.src='images/buttons/home_.png'" onmouseout="this.src='images/buttons/home.png'"></a> 
```

# c# - C# 音频库

> ID：466458
> 
> 赞同：40
> 
> 时间：2009-01-21T18:39:27.517
> 
> 标签：c#, audio

我正在寻找用 C# 开发音频播放器，但想知道哪些库可用于播放。我正在寻找一个允许播放大量音频格式（例如 mp3、wma、wav、ogg 等）的免费库。这几乎是我需要的基本功能。但是，如果我可以挑剔的话，可以在格式之间转换音频文件的库会很方便。进行谷歌搜索时，我发现了 alvas.audio 库，但它不是免费的。VLC 库也不错，但我无法让它工作，我宁愿只用 dll 打包我的应用程序，而不是让我的用户也在他们的机器上安装 VLC 软件。

感谢您对此提供任何提示或建议。

* * *

## 回答 #1

> 赞同：45
> 
> 时间：2009-01-23T07:45:18.493

[NAudio](http://www.codeplex.com/naudio)是一个开源的 .NET 音频库，可以播放 WAV、MP3、WMA、AAC 和 AIFF 文件，利用计算机上安装的 ACM 或 Media Foundation 编解码器进行解压缩。对于 ogg 支持，您可以使用一个[附加的 nuget 包。](https://nuget.org/packages/NVorbis.NAudioSupport)

（**编辑：**更新了 NAudio 1.7 中支持的音频文件类型的详细信息。另外，完全披露：我是这个库的作者）

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-01-21T18:56:57.670

[低音音频库](http://www.un4seen.com/)是一种选择。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2010-02-07T21:34:09.940

[阿尔瓦斯音频](http://alvas.net/alvas.audio.aspx)

这个库似乎没有进一步开发，我购买了终身团队许可证，自 2011 年 11 月以来一直无法与开发人员取得联系，多次电子邮件后没有回复，尽管承诺创建，但没有新版本每季度发布新版本。也没有从开发人员那里得到任何关于他放弃该项目的消息。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-01-21T19:00:33.217

你会想看看 DirectShow。DirectShow 是一个非托管库，它依赖于安装在用户系统上的编解码器，您可以为其创建渲染图。DirectShow 是免费的，通常安装在大多数 Windows 机器上。

DirectShow 有一个名为 DirectShow.NET 的托管包装器，您可以在此处找到：

[http://directshownet.sourceforge.net/](http://directshownet.sourceforge.net/)

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2012-12-06T21:14:00.337

截至 2012 年，[OpenAL](http://connect.creativelabs.com/openal/default.aspx)似乎是一个可行的库——并且是某种标准。它适用于一系列操作系统（从 XP 到 Windows 8），并与 MonoGame 集成（已经集成）。

由于 Creative Labs 链接（上方）已关闭，您可以尝试以下方法之一：

*   [源锻造](http://sourceforge.net/projects/openal-net-sdk/)
*   [OpenAL 软件](http://kcat.strangesoft.net/openal.html#download)

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2011-12-02T14:08:35.917

[irrKlang](http://www.ambiera.com/irrklang/)是一个带有 .NET API 的 C++ 音频库。它可免费用于非商业用途。

# javascript - jQuery 可排序回调不起作用？

> ID：466464
> 
> 赞同：3
> 
> 时间：2009-01-21T18:42:40.240
> 
> 标签：javascript, jquery, jquery-ui, jquery-ui-sortable

我正在使用[jQuery UI的](http://ui.jquery.com/)[Sortable](http://docs.jquery.com/UI/Sortable)组件。回调似乎根本不起作用，即使使用这个极简测试：

```
<script type="text/javascript" src="jquery-1.3.js"></script>
<script type="text/javascript" src="jquery-ui-personalized-1.6rc4.js"></script>
<script type="text/javascript">
$(document).ready(function () {
    $("#outer").sortable({
        start: function (e, ui) {
            alert("started");
        },
        update: function (e, ui) {
            alert("updated");
        }
    });
});
</script>
<ul id="outer">
<li>apple</li>
<li>orange</li>
</ul> 
```

当我重新排序这些元素时，我没有收到任何警报。

我的用法是正确的还是我可能误读了[文档](http://docs.jquery.com/UI/Sortable/sortable#options)？

> 启动函数（事件，用户界面）
> 
> 排序开始时调用的函数。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-21T19:08:45.307

根据[这篇文章](http://groups.google.com/group/jquery-dev/browse_thread/thread/8be6c23bf57b3199)， .sortable() 似乎遇到了一些技术困难。您可能需要使用 SVN 下载[最新的主干版本](http://dev.jquery.com/browser/trunk)来修复它。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-07T04:17:57.527

我能够通过同时包含两个版本的 jquery 来解决这个问题。在这里查看：http: [//gist.github.com/59757](http://gist.github.com/59757)

希望能帮助到你！

# c# - 如何在 C# 中使用 SerialPort 端口对象的 dataReceived 事件？

> ID：466474
> 
> 赞同：22
> 
> 时间：2009-01-21T18:44:33.840
> 
> 标签：c#, serial-port

我正在尝试创建一个小型应用程序来收集从连接到 COM10 的外部传感器接收到的数据。我已经成功创建了一个小的 C# 控制台对象和应用程序，它使用 for 循环在固定的时间段内打开端口并将数据流式传输到文件。

我想将此应用程序转换为使用 dataReceived 事件进行流式传输。在阅读了[Top 5 SerialPort Tips](http://blogs.msdn.com/bclteam/archive/2006/10/10/Top-5-SerialPort-Tips-_5b00_Kim-Hamilton_5D00_.aspx)之后，我似乎仍然无法让它工作，也不知道我错过了什么。我重写了控制台应用程序，以便所有代码都在 Main 中并粘贴在下面。有人可以帮我解释一下为什么事件处理程序 port_OnReceiveDatazz 没有被调用，即使我知道硬件正在向端口发送数据？

*谢谢*

感谢@Gabe 、[@](https://stackoverflow.com/questions/466474/how-do-i-use-datareceived-event-of-the-serialport-port-object-in-c#466518) [Jason Down](https://stackoverflow.com/questions/466474/how-do-i-use-datareceived-event-of-the-serialport-port-object-in-c#466510)和[@abatishchev](https://stackoverflow.com/questions/466474/how-do-i-use-datareceived-event-of-the-serialport-port-object-in-c#466577)的所有建议。我很难过，似乎无法让事件处理程序工作。也许它与设备有关。我可以只在线程中读取端口并将数据直接流式传输到文件中。

* * *

**代码**

* * *

```
namespace serialPortCollection
{   class Program
    {
        static void Main(string[] args)
        {

            const int bufSize = 2048;
            Byte[] buf = new Byte[bufSize]; //To store the received data.

            SerialPort sp = new SerialPort("COM10", 115200);
            sp.DataReceived += port_OnReceiveDatazz; // Add DataReceived Event Handler

            sp.Open();
            sp.WriteLine("$"); //Command to start Data Stream

            // Wait for data or user input to continue.
            Console.ReadLine();

            sp.WriteLine("!"); //Stop Data Stream Command
            sp.Close();
        }

       // My Event Handler Method
        private static void port_OnReceiveDatazz(object sender, 
                                   SerialDataReceivedEventArgs e)
        {
            SerialPort spL = (SerialPort) sender;
            const int bufSize = 12;
            Byte[] buf = new Byte[bufSize];
            Console.WriteLine("DATA RECEIVED!");
            Console.WriteLine(spL.Read(buf, 0, bufSize));
        }
    }
} 
```

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-01-21T18:54:04.087

~~我认为您的问题是：~~ **

~~sp.DataReceived += port_OnReceiveDatazz;~~

~~不应该是：~~

~~sp.DataReceived += 新的 SerialDataReceivedEventHandler (port_OnReceiveDatazz);~~

**没关系，语法很好（我最初回答这个问题时没有意识到快捷方式）。

我还看到建议您应该为串行端口打开以下选项：

```
sp.DtrEnable = true;    // Data-terminal-ready
sp.RtsEnable = true;    // Request-to-send 
```

您可能还必须将握手设置为 RequestToSend（通过握手枚举）。

* * *

**更新：**

发现一个建议说你应该先打开你的端口，然后分配事件处理程序。也许这是一个错误？

所以代替这个：

```
sp.DataReceived += new SerialDataReceivedEventHandler (port_OnReceiveDatazz);
sp.Open(); 
```

做这个：

```
sp.Open();
sp.DataReceived += new SerialDataReceivedEventHandler (port_OnReceiveDatazz); 
```

让我知道情况如何。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-01-21T19:11:57.703

首先，我建议您使用以下构造函数，而不是当前使用的构造函数：

```
new SerialPort("COM10", 115200, Parity.None, 8, StopBits.One); 
```

接下来，您确实应该删除此代码：

```
// Wait 10 Seconds for data...
for (int i = 0; i < 1000; i++)
{
    Thread.Sleep(10);
    Console.WriteLine(sp.Read(buf,0,bufSize)); //prints data directly to the Console
} 
```

而只是循环直到用户按下一个键或其他东西，就像这样：

```
namespace serialPortCollection
{   class Program
    {
        static void Main(string[] args)
        {
            SerialPort sp = new SerialPort("COM10", 115200);
            sp.DataReceived += port_OnReceiveDatazz; // Add DataReceived Event Handler

            sp.Open();
            sp.WriteLine("$"); //Command to start Data Stream

            Console.ReadLine();

            sp.WriteLine("!"); //Stop Data Stream Command
            sp.Close();
        }

       // My Event Handler Method
        private static void port_OnReceiveDatazz(object sender, 
                                   SerialDataReceivedEventArgs e)
        {
            SerialPort spL = (SerialPort) sender;
            byte[] buf = new byte[spL.BytesToRead];
            Console.WriteLine("DATA RECEIVED!");
            spL.Read(buf, 0, buf.Length);
            foreach (Byte b in buf)
            {
                Console.Write(b.ToString());
            }
            Console.WriteLine();
        }
    }
} 
```

另外，请注意对数据接收事件处理程序的修订，它现在应该实际打印缓冲区。

**更新 1**

* * *

我刚刚在我的机器上成功运行了以下代码（使用 COM33 和 COM34 之间的空调制解调器电缆）

```
namespace TestApp
{
    class Program
    {
        static void Main(string[] args)
        {
            Thread writeThread = new Thread(new ThreadStart(WriteThread));
            SerialPort sp = new SerialPort("COM33", 115200, Parity.None, 8, StopBits.One);
            sp.DataReceived += port_OnReceiveDatazz; // Add DataReceived Event Handler

            sp.Open();
            sp.WriteLine("$"); //Command to start Data Stream

            writeThread.Start();

            Console.ReadLine();

            sp.WriteLine("!"); //Stop Data Stream Command
            sp.Close();
        }

        private static void port_OnReceiveDatazz(object sender, 
                                   SerialDataReceivedEventArgs e)
        {
            SerialPort spL = (SerialPort) sender;
            byte[] buf = new byte[spL.BytesToRead];
            Console.WriteLine("DATA RECEIVED!");
            spL.Read(buf, 0, buf.Length);
            foreach (Byte b in buf)
            {
                Console.Write(b.ToString() + " ");
            }
            Console.WriteLine();
        }

        private static void WriteThread()
        {
            SerialPort sp2 = new SerialPort("COM34", 115200, Parity.None, 8, StopBits.One);
            sp2.Open();
            byte[] buf = new byte[100];
            for (byte i = 0; i < 100; i++)
            {
                buf[i] = i;
            }
            sp2.Write(buf, 0, buf.Length);
            sp2.Close();
        }
    }
} 
```

**更新 2**

* * *

鉴于最近有关此问题的所有流量。我开始怀疑您的串行端口配置不正确，或者设备没有响应。

我强烈建议您尝试使用其他方式与设备通信（我经常使用超级终端）。然后，您可以使用所有这些设置（比特率、奇偶校验、数据位、停止位、流控制），直到找到有效的设置。设备文档还应指定这些设置。一旦我弄清楚了这些，我会确保正确配置我的 .NET SerialPort 以使用这些设置。

配置串口的一些技巧：

请注意，当我说您应该使用以下构造函数时，我的意思是使用该函数，而不一定是那些参数！您应该为您的设备填写参数，以下设置是通用的，但可能因您的设备而异。

```
new SerialPort("COM10", 115200, Parity.None, 8, StopBits.One); 
```

将 .NET SerialPort 设置为使用与设备相同的流控制也很重要（正如其他人之前所述）。您可以在此处找到更多信息：

[http://www.lammertbies.nl/comm/info/RS-232_flow_control.html](http://www.lammertbies.nl/comm/info/RS-232_flow_control.html)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-06-08T12:36:26.960

我以前工作过的调制解调器遇到了同样的问题，然后有一天刚刚停止引发 DataReceived 事件。

在我的情况下，非常随机的解决方案是启用 RTS，例如

```
sp.RtsEnable = true; 
```

不知道为什么这对这个特殊的工具包起作用（根本不是一个通讯员），也不知道为什么它起作用然后停止但它可能有一天会帮助其他人，所以只是发布它以防万一......

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-01-21T18:57:17.293

顺便说一句，您可以在事件处理程序中使用下一个代码：

```
switch(e.EventType)
{
  case SerialData.Chars:
  {
    // means you receives something
    break;
  }
  case SerialData.Eof:
  {
    // means receiving ended
    break;
  }
} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-03-14T17:53:42.310

我相信这不会起作用，因为您正在使用控制台应用程序并且没有运行事件循环。创建 Winforms 应用程序时会自动设置用于事件处理的事件循环/消息泵，但不会为控制台应用程序设置。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2014-03-12T13:28:50.247

实际上，很可能是`Console.ReadLine`阻止您的回调`Console.Writeline`。MSDN 上的示例看起来几乎相同，除了它们使用 ReadKey（不锁定控制台）。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2016-10-02T04:45:19.967

请注意，使用 .NET/C# 和任何高于 COM9 的 COM 端口都会出现问题。

请参阅：[HOWTO：指定大于 COM9 的串行端口](https://support.microsoft.com/en-us/kb/115831)

底层 CreateFile 方法支持以下格式的解决方法：“\\.\COM10”，但 .NET 阻止使用该解决方法格式；SerialPort 构造函数和 PortName 属性都不允许使用以“\”开头的端口名称

我一直在努力在 C#/.NET 中获得与 COM10 的可靠通信。例如，如果我在 COM9 和 COM10 上有一个设备，则用于 COM10 的流量会流向 COM9 上的设备！如果我移除 COM9 上的设备，COM10 流量会转到 COM10 上的设备。

我还没有想出如何使用 CreateFile 返回的句柄来创建 C#/.NET 样式的 SerialPort 对象，如果我知道如何做到这一点，那么我想我可以从 C# 中使用 COM10+。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2022-01-19T09:59:16.513

```
switch(e.EventType)
{
  case SerilData.Chrs:
  {
    // means you receives something
    break;
  }
  case SerialData.Eo:
  {
    // means reciving ended
    break;
  }
} 
```

# c# - (HttpContext.Current.User != null) 是否足以假设 FormsAuthentication 已对用户进行身份验证

> ID：466482
> 
> 赞同：15
> 
> 时间：2009-01-21T18:46:18.020
> 
> 标签：c#, .net, asp.net, .net-2.0, forms-authentication

在 ASP.NET (2.0) 应用程序中，我使用 FormsAuthentication。

在 Global.asax / Application_AuthenticateRequest 方法中，我检查 HttpContext.Current.User 是否为空。

这足以知道表单身份验证 cookie 是否存在、票证是否未过期，以及总体而言，表单身份验证机制是否已完成验证用户的工作？

我需要这个，因为我在该应用程序中有某些页面，有时不需要访问身份验证（基于某些标准），我将它们放在 web.config 中的单独“位置”指令中，以排除它们从“捕获所有”表单身份验证。

即，如果在此“位置”中访问的页面需要保护，我正在尝试检查 Application_AuthenticateRequest，如果是，则要知道用户是否已经通过身份验证，或者我需要重定向到登录。

编辑：正如答案所暗示的，我很可能会选择 IsAuthenticated。为了让我更好地掌握它，这里有 2 个额外的问题:)（请编辑其他答案以添加这些，谢谢）：

1.  我可以假设如果 IsAuthenticated 为真，那么 HttpContext.Current.User 肯定会包含经过身份验证的用户的用户名吗？

2.  如果强制执行 FormsAuthentication，并且只有少数页面被“位置”指令排除，我怎么能在 HttpContext.Current.User 中得到一个“匿名用户”？

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2009-01-21T18:51:42.937

不，`User`可能只是对匿名用户的引用。检查[`HttpContext.Current.Request.IsAuthenticated`](http://msdn.microsoft.com/en-us/library/system.web.httprequest.isauthenticated.aspx)。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-21T18:51:12.533

我通常使用 Request.IsAuthenticated。我无法告诉你你的方法是否应该奏效。听起来应该是这样，尽管如果您支持匿名登录可能会产生副作用？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-21T19:06:23.360

顺便说一句，请务必检查上下文也不为空（以防您在 httpmodule 中工作）。

# wordpress - Wordpress 插件为没有标题的帖子生成非数字 slug / 永久链接？(1 个帖子)

> ID：466484
> 
> 赞同：1
> 
> 时间：2009-01-21T18:47:38.390
> 
> 标签：wordpress, plugins

我一直在寻找这个，但根本找不到。

我有一个博客在其博客文章中没有标题，但出于各种可用性原因，我希望让永久链接使用没有标题的条目中的前几个单词作为永久链接 slug。

```
 ie, if the post on sample.com/blog is
  Title: (no title)
  Content: Ten Easy Ways to Lose Weight 
```

永久链接可以是 sample.com/blog/ten-easy-ways-to-loose-weight。

有没有插件可以做到这一点？为了我的一生，我找不到一个。（xposted 到 WP 支持，但没有人回应）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-21T20:01:21.113

您可以输入标题，然后不在视图模板中显示它们。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-05T15:30:40.560

[您可以从http://scott.yang.id.au/code/permalink-redirect/](http://scott.yang.id.au/code/permalink-redirect/)获取永久链接重定向插件 与 WP2.71 配合使用它需要 Title 并从中自动创建一个 slug，因此您必须手动如果您有空白标题，请为每个页面输入您想要的 slug。

您应该能够破解 Scott 的 PHP 文件（它只有一页）以查找页面代码并选择其中的一部分用作 slug。

此外，我使用 .htaccess 重写文件来解决不正确的页面请求，以便在不正确的页面请求时调出索引页面。

在此处下载我的重写文件的副本 [https://oulixes.com/htaccess_example.zip](https://oulixes.com/htaccess_example.zip) 解压缩 txt 文件并重命名为 .htaccess 并上传到您的根目录

希望这可以帮助！干杯，比利

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-21T19:59:15.733

我怀疑是否已经为 wordpress 构建了类似的东西。要让您的博客做到这一点，您必须编写一个插件来执行以下操作：

*   如果您使用相同的单词开始多个条目，则会在检查唯一性时生成 slug
*   处理 URL 请求以识别 slug 永久链接，然后更新查询步骤以在数据库中找到正确的帖子。这可能涉及一个新的 db slug 表（这也有助于解决唯一性问题）

简而言之，WP 旨在通过键检索几乎所有内容，并且要支持这样的 slug，您必须创建一个新的键类型。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-21T20:03:46.897

顺便说一句：如果通过 ID（键）检索到任何内容，从技术上讲，它不是永久链接。因此，wordpress 可能无法提供真正的永久链接。

ps：编写一个处理程序/调度程序来解析 URL 并取出唯一的永久链接，然后通过字符串（而不是按键！）将其与数据库匹配并不难。

就像是：

```
$url=$_SERVER["REQUEST_URI"];
echo 'URL called: ',$url,'<br />';
$dispatchfile=$dispatcher->Dispatch($url);
if ($dispatchfile)
   {
   echo 'launching ',$dispatchfile,' inclusion<br />';
   require($dispatchfile);
   }
else
   {
   echo 'dispatcher failed to find module, will check physical file<br />';
   if (file_exists($url)) echo 'dispatcher found physical file<br />';
   else echo 'nada, throw 404!';
   } 
```

# c++ - 轻松打印详细的调试输出？

> ID：466488
> 
> 赞同：3
> 
> 时间：2009-01-21T18:48:13.740
> 
> 标签：c++, debugging

我基本上是在寻找一种方法来自动输入如下内容：

```
cout << "a[" << x << "][" << y << "] =\t" << a[x][y] << endl; 
```

就像是：

```
PRINTDBG(a[x][y]); 
```

理想情况下，这也适用于

```
PRINTDBG(func(arg1, arg2)); 
```

乃至

```
PRINTDBG(if(condition) func(foo);); 
```

（将打印例如“if(false) func(5)”）。

也欢迎非便携式黑客:)

（不，使用调试器是不一样的，它的灵活性要低得多，我觉得它很混乱）

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-21T18:53:38.863

这是`printf`样式输出可以更简洁的区域：

```
cout << "a[" << x << "][" << y << "] =\t" << a[x][y] << endl;
printf("a[%d][%d] =\t%d\n", x, y, a[x][y]); 
```

当然，这具有仅适用于可以`printf`理解的类型的限制，并且仍然无法解决您的问题。

我觉得 Boost 中的表达式分解技术可能有一些价值，但我不是一个模板忍者来识别什么。

**更新**：以下几乎解决了您的问题：

```
#define PRINTDBG(x) cout << #x << " =\t" << x << endl; 
```

但是，当按`PRINTDBG(a[x][y])`字面意思使用时：

```
a[x][y] = 5 
```

它没有给出 和 的实际`x`值`y`。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-21T19:01:09.067

以您想要的方式，这是不可能的。如果你有*if(condition) func(foo);* 给一个宏，它可以将这些东西字符串化，它会打印*if(condition) func(foo);* ，但不是用变量的实际值代替。请记住，预处理器不知道该代码的结构。

对于调试，我会使用一些类型安全的 printf 变体，例如 boost.format 或一些[带有 boost.fusion 的自制 printf](https://stackoverflow.com/questions/455904/print-information-in-test-mode-but-not-in-normal-execution#456184)，这使得打印这样的东西变得更加容易：

```
dprintf("a[%][%] = %", (x, y, a[x][y])); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-21T19:05:26.030

我通常使用简单但可自定义的记录器函数而不是宏

```
 Log(const char *format, ...)
{
    char buffer[MAX_BUFFER_SIZE];
    va_list args;

    //get arguements into a list
    va_start(args, format);

    //printf formated arguement into a string
    vsnprintf(buffer, sizeof(buffer), format, args);

    va_end(args);

    printf("%s", buffer);
  } 
```

所以现在你可以做

```
Log("a[%d][%d] =\t%d\n", x, y, a[x][y])
```

```
Log("if(%s) func(%d) ;", (condition) ? "true" : "False", func(foo))
```

在函数 Log() 中添加一些记录类型（即 LOG_SCREEN、LOG_FILE），现在您可以控制记录到的位置

添加一些日志记录级别（即 WARN、CRIT）来控制它的显示方式、颜色等。

当然有很多很多图书馆已经在做所有这些类型的事情了

希望这可以帮助

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-21T19:07:36.400

在与 Greg 的帖子不同的方向稍微扩展，我看到了一些不错的 C 程序，看起来像这样

```
#DEFINE DEBUG_MODE 1
//...
if( DEBUG_MODE)
  printf("methodX() says: y=%i, var1=%i", y, var1); 
```

但是，您的程序中仍然有大量的 printf，但至少您可以在需要时将它们全部打开和关闭。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-21T19:09:52.153

您可以为自定义类定义运算符«，因此您只需定义一次格式：

```
struct point3 {
      int x,y,z;
      point3(int a, int b, int c){x=a;y=b;z=c;}
};

std::ostream& operator << (std::ostream& os, const point3& f) {
      return os << "(" << f.x << "," << f.y << "," << f.z << ")";
}

point3 p(1,2,3);
std::cout << p; // prints "(1,2,3)" 
```

这与将 cout 或 clog 重定向到文件非常匹配（不记得 std::clog 是如何工作的）

```
#include <iostream>
#include <fstream>

int main() {
      std::ofstream file("log.txt");
      std::streambuf *filebuf = file.rdbuf();
      std::cout.rdbuf(filebuf);

      std::cout << "This is written to the file";

      filestr.close();
      return 0;
} 
```

# linux - 如何找到在linux中消耗最多i/o的进程？

> ID：466496
> 
> 赞同：5
> 
> 时间：2009-01-21T18:50:00.570
> 
> 标签：linux, command

当我使用 top 时，主机上的 iowait 真的很高。

iostat 告诉我哪个磁盘使用得更多，但我想找出哪个进程是罪魁祸首？

我试图在红帽 linux 主机上找到这个。有什么建议么。

编辑：我的 linux 风格既没有 atop 也没有 ntop，因为构建内核不是我的选择，所以不要问我为什么 :)（因为这不是我的个人盒子）。还有其他选择吗

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-21T19:10:19.983

我一般用顶。[Debian Package A Day](http://debaday.debian.net/2009/01/18/atop-an-ascii-full-screen-performance-monitor/)上有一篇关于它的非常好的文章。它确实需要内核补丁（尽管 Ubuntu 已经应用了补丁，但我不确定是否有任何其他发行版。）

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-24T00:42:54.210

使用[iotop](http://packages.debian.org/sid/iotop)。

或者你可以独立获得它，它是一个简单的 python 脚本，需要最近的内核（不记得了，但至少 > 2.6.20）

# asp.net - asp.net 媒体保护

> ID：466506
> 
> 赞同：6
> 
> 时间：2009-01-21T18:52:10.457
> 
> 标签：asp.net, security, media

有谁知道保护 asp.net 媒体的好习惯？

我需要托管各种需要查看特定图像/视频权限的媒体。即，特定用户可能有也可能没有查看媒体文件的权限——而且这一事实可能会即时更改。

我不在乎他们是否可以下载他们有权访问的媒体文件，我只是不想让他们知道他们不应该访问的项目。

我已经考虑过 url 混淆 - 这对我来说似乎很蹩脚。

我已经形成了经过身份验证的用户（我不愿意改变这一点）。

我想保持与权限无关的媒体文件夹结构。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-01-21T19:02:07.660

构建一个必须访问所有媒体的 HttpHandler。然后，在检索文件并将其发送给用户之前，您可以执行任何您想要的验证。将所有媒体保留在主 wwwroot 路径之外，或使用权限拒绝访问该文件夹。

此处有关此主题的更多信息：

[http://www.15seconds.com/Issue/020417.htm](http://www.15seconds.com/Issue/020417.htm)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-27T17:28:03.233

我使用这样的 xml 文件来设置哪些用户/组可以访问文件

```
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE root[
    <!ELEMENT file ANY>
    <!ATTLIST file name ID #REQUIRED>
]>
<root>
    <file name="file.doc" users="155,321" groups="grp5" />
    <file name="file2.doc" users="321" groups="" />
</root> 
```

文件存储在 http root 之上，因此无法通过 URL 访问它们。

当用户尝试访问 GetFile.aspx?file=file.doc 我加载 XML 时，获取与

```
XmlNode xnFile= XML.GetElementById(wantedFile); 
```

，然后我调用一个函数

```
 HasAccess(Context.User, xnFile); 
```

它检查用户是否登录并比较权限，如果该用户可以拥有该文件，我从磁盘读取文件并将它们写出来

```
FileInfo thisFile = new FileInfo(secretLocation + wantedFile);
Response.Clear();
Response.Buffer = false;
Response.BufferOutput = false;
Response.ClearContent();
Response.ClearHeaders();
Response.AddHeader("Content-Length", thisFile.Length.ToString());
Response.AddHeader("Content-disposition", "filename=" + thisFile.Name);
Response.ContentType = "application/none";
Response.WriteFile(secretLocation + wantedFile);
Response.Close();
Response.End();
Response.ClearContent();
Response.ClearHeaders(); 
```

实际上，现在我有一千多个文件，我想将文件数据写入数据库，因为 XML 在 5 年内损坏了两次，可能是由于崩溃或同时使用。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-28T19:50:29.437

根据您在 Spikolynn 答案中的评论

> 我很困惑——这与混淆有什么不同？经过身份验证的用户是否能够与另一个经过身份验证但未经授权的用户共享图像（他们被授权）？

我猜你试图**阻止未经授权的媒体*共享***。

这是很多公司（微软、苹果、IBM 等）投入大量资金来解决的问题。**解决方案是 DRM**，现在他们正在删除它，因为**它失败了**。

所以，我的回答是，如果用户愿意付出一些努力来避免分享，你**就不能阻止分享。**

您可以通过应用**Spikolynn**或**Lusid**在他们的回答中解释的一些技巧来**保持诚实的人诚实。**

 ***** * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-21T19:06:13.017

我建议使用一个表格来保存每个用户可以访问的文件：

```
UserID int
FileID varchar 
```

然后是您的文件的表格：

```
FileID    UniqueIdentifier
FileType  char(4)  <- so you know which extension to use.
etc... 
```

在硬盘驱动器上，将文件命名为 FileID (UniqueIdentifier) 和 FileType（扩展名，例如 .jpg）。权限表中的 fileID 将保存在另一个表中生成的 UniqueIdentifier。

您可以通过 URL 传递它，相对安全地知道用户将无法猜测任何其他文件的名称。

更新：顺便说一句，*这*比编写 HttpHandler 或处理文件权限要简单得多。然而，虽然有人猜出另一个文件名的可能性微乎其微，但它并不是无懈可击的安全性，因为一个用户可能会让另一个用户访问该文件。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-28T19:11:11.013

brownpaperpackage.aspx?id={guid}

在 media.aspx 的 Load 事件中，您验证用户是否已通过身份验证，然后验证用户是否有权查看媒体，如果有，则将媒体作为流加载并将其提供给页面的响应，如[Spikolynn](https://stackoverflow.com/questions/466506/asp-net-media-protection#484352)演示的.

为什么要这样做？它的代码很简单，您可以获得 ASP.NET 和 IIS 的身份验证服务的所有好处，您可以从中找到请求媒体的用户。将该用户映射到您的媒体对象的访问列表是微不足道的。页面有请求对象。您还隐藏了媒体的名称，因此您无法从 URL 中看出发生了什么。

您如何防止人们直接访问您的媒体？您的媒体文件不能存储在 IIS 虚拟目录中。如果是，则有可能直接下载它们。您可以将它们作为字节数组 (blob) 存储在数据库中，也可以将它们存储在 Web 虚拟目录之外的磁盘上。用户必须通过 ASP.NET 才能访问文件

您如何跟踪哪些用户可以访问哪些媒体？您可以通过 asp.net 会员来跟踪您的用户。这意味着每个用户在 aspnet_users 表中都有一个 ID。使用 id 和文件名（或包含实际媒体的 blob）为您的媒体创建一个表。然后，您只需要创建连接两者的第三个表。该表将包含一个用户 ID 和一个媒体 ID，表示该用户可以查看该媒体。使用用户 ID（来自 asp.net Membership）和媒体 ID（来自 URL），您只需要

```
select count(*) from UserMedia where UserId = @UserGuid and MediaId = @MediaIdFromUrl 
```

如果计数 > 0，则用户可以查看媒体。

如何使用 URL 的示例：

```
<asp:image 
  runat="server" 
  ImageUrl="brownpaperpackage.aspx?id=53a2ea4(snip)76ca8b" /> 
```

# c# - 什么是犀牛模拟重复？

> ID：466520
> 
> 赞同：15
> 
> 时间：2009-01-21T18:57:50.880
> 
> 标签：c#, unit-testing, rhino-mocks

什么是犀牛模拟重复？

```
Repeat.Any();

Repeat.Once(); 
```

它是什么意思以及它是如何工作的？

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2009-01-21T19:02:58.453

它与`Expect`构造一起用作流利声明的一部分。至于它是什么意思：它意味着之前的事件预计会发生那么多次。

例如：`Expect.Call(someMethod()).Repeat.Twice()`说那`someMethod()`将被准确地调用两次。

# filesystems - 一个目录可以放多少个文件？

> ID：466521
> 
> 赞同：606
> 
> 时间：2009-01-21T18:58:25.733
> 
> 标签：filesystems, limit

我在一个目录中保留多少个文件是否重要？如果是这样，一个目录中有多少文件太多了，文件太多有什么影响？（这是在 Linux 服务器上。）

背景：我有一个相册网站，上传的每张图片都被重命名为一个 8 位十六进制数字的 id（比如 a58f375c.jpg）。这是为了避免文件名冲突（例如，如果上传了很多“IMG0001.JPG”文件）。原始文件名和任何有用的元数据都存储在数据库中。现在，我在 images 目录中有大约 1500 个文件。这使得列出目录中的文件（通过 FTP 或 SSH 客户端）需要几秒钟。但除此之外，我看不到它有任何影响。特别是，图像文件提供给用户的速度似乎没有任何影响。

我曾考虑通过创建 16 个子目录来减少图像数量：0-9 和 af。然后我会根据文件名的第一个十六进制数字将图像移动到子目录中。但我不确定是否有任何理由这样做，除了偶尔通过 FTP/SSH 列出目录。

* * *

## 回答 #1

> 赞同：802
> 
> 时间：2009-01-21T19:16:51.000

# [FAT32](http://en.wikipedia.org/wiki/File_Allocation_Table#FAT32)：

*   最大文件数：268,173,300
*   每个目录的最大文件数：2 ^(16)  - 1 (65,535)
*   最大文件大小：2 GiB - 1 不带[LFS](http://en.wikipedia.org/wiki/Large_file_support)，4 GiB - 1 带

# [NTFS](http://en.wikipedia.org/wiki/NTFS)：

*   最大文件数：2 ^(32)  - 1 (4,294,967,295)
*   最大文件大小
    *   实现：2 ^(44)  - 2 ⁶字节（16 TiB - 64 KiB）
    *   理论：2 ^(64)  - 2 ⁶字节（16 EiB - 64 KiB）
*   最大卷大小
    *   实施：2 ^(32)  - 1 个集群 (256 TiB - 64 KiB)
    *   理论：2 ^(64)  - 1 个集群（1 YiB - 64 KiB）

# [分机2](http://en.wikipedia.org/wiki/Ext2)：

*   最大文件数：10 ^(18)
*   每个目录的最大文件数：~1.3 × 10 ^(20)（超过 10,000 个性能问题）
*   最大文件大小
    *   16 GiB（块大小为 1 KiB）
    *   256 GiB（块大小为 2 KiB）
    *   2 TiB（块大小为 4 KiB）
    *   2 TiB（块大小为 8 KiB）
*   最大卷大小
    *   4 TiB（块大小为 1 KiB）
    *   8 TiB（块大小为 2 KiB）
    *   16 TiB（块大小为 4 KiB）
    *   32 TiB（块大小为 8 KiB）

# [分机3](http://en.wikipedia.org/wiki/Ext3)：

*   最大文件数：min(volumeSize / 2 ^(13) , numberOfBlocks)
*   最大文件大小：*与 ext2 相同*
*   最大卷大小：*与 ext2 相同*

# [分机4](http://en.wikipedia.org/wiki/Ext4)：

*   最大文件数：2 ^(32)  - 1 (4,294,967,295)
*   每个目录的最大文件数：无限制
*   最大文件大小：2 ^(44)  - 1 字节 (16 TiB - 1)
*   最大卷大小：2 ^(48)  - 1 字节 (256 TiB - 1)

* * *

## 回答 #2

> 赞同：205
> 
> 时间：2011-08-11T20:19:45.087

我在一个 ext3 目录中有超过 800 万个文件。`readdir()`使用的`find`libc以及`ls`该线程中讨论的大多数其他方法来列出大型目录。

在这种情况下速度很慢的原因是`ls`一次只能读取 32K 的目录条目，因此在慢速磁盘上需要多次读取才能列出目录。这个速度问题有一个解决方案。我写了一篇关于它的非常详细的文章：[http ://www.olark.com/spw/2011/08/you-can-list-a-directory-with-8-million-files-but-not-with-](http://www.olark.com/spw/2011/08/you-can-list-a-directory-with-8-million-files-but-not-with-ls/) [ls/](http://www.olark.com/spw/2011/08/you-can-list-a-directory-with-8-million-files-but-not-with-ls/)`find``readdir()`

关键是：`getdents()`直接使用 -- [http://www.kernel.org/doc/man-pages/online/pages/man2/getdents.2.html](http://www.kernel.org/doc/man-pages/online/pages/man2/getdents.2.html)而不是基于 libc 的任何东西，`readdir()`因此您可以指定缓冲区从磁盘读取目录条目时的大小。

* * *

## 回答 #3

> 赞同：74
> 
> 时间：2012-07-07T08:33:59.503

我有一个目录，里面有 88,914 个文件。像您自己一样，它用于存储缩略图和在 Linux 服务器上。

通过 FTP 或 php 函数列出的文件很慢，是的，但在显示文件时也会对性能造成影响。例如 www.website.com/thumbdir/gh3hg4h2b4h234b3h2.jpg 的等待时间为 200-400 毫秒。作为在另一个站点上的比较，我在一个目录中有大约 100 个文件，图像在大约 40 毫秒的等待后显示。

我已经给出了这个答案，因为大多数人刚刚编写了目录搜索功能将如何执行，您不会在拇指文件夹上使用它 - 只是静态显示文件，但会对文件的实际使用方式感兴趣.

* * *

## 回答 #4

> 赞同：57
> 
> 时间：2009-01-21T19:07:58.007

这在一定程度上取决于 Linux 服务器上使用的特定文件系统。现在默认是带有 dir_index 的 ext3，这使得搜索大目录非常快。

所以速度不应该是一个问题，除了你已经注意到的问题，即列表需要更长的时间。

一个目录中的文件总数是有限制的。我似乎记得它肯定可以处理多达 32000 个文件。

* * *

## 回答 #5

> 赞同：49
> 
> 时间：2009-01-21T19:57:55.737

请记住，在 Linux 上，如果您的目录包含太多文件，shell 可能无法扩展通配符。我在 Linux 上托管的相册有这个问题。它将所有调整大小的图像存储在一个目录中。虽然文件系统可以处理许多文件，但 shell 不能。例子：

```
-shell-3.00$ ls A*
-shell: /bin/ls: Argument list too long 
```

或者

```
-shell-3.00$ chmod 644 *jpg
-shell: /bin/chmod: Argument list too long 
```

* * *

## 回答 #6

> 赞同：27
> 
> 时间：2009-01-21T20:52:13.880

我现在正在处理类似的问题。我们有一个分层目录结构，并使用图像 ID 作为文件名。例如，将带有的图像`id=1234567`放置在

```
..../45/67/1234567_<...>.jpg 
```

使用最后 4 位数字来确定文件的去向。

对于几千张图像，您可以使用一层层次结构。我们的系统管理员建议在任何给定目录（ext3）中不要超过几千个文件，以提高效率/备份/他想到的任何其他原因。

* * *

## 回答 #7

> 赞同：27
> 
> 时间：2013-11-10T18:39:16.323

值得一提的是，我只是在一个`ext4`包含 1,000,000 个文件的文件系统上创建了一个目录，然后通过 Web 服务器随机访问这些文件。我没有注意到访问那些（比如说）只有 10 个文件的人有任何溢价。

这与我几年前做这件事的经历*完全*不同。`ntfs`

* * *

## 回答 #8

> 赞同：14
> 
> 时间：2018-12-22T03:42:32.657

我一直有同样的问题。试图在 ext4 的 Ubuntu 服务器中存储数百万个文件。结束运行我自己的基准测试。发现平面目录的性能更好，同时使用起来更简单：

[![基准](https://i.stack.imgur.com/qywB5.png)](https://i.stack.imgur.com/qywB5.png)

写了[一篇文章](https://medium.com/@hartator/benchmark-deep-directory-structure-vs-flat-directory-structure-to-store-millions-of-files-on-ext4-cac1000ca28)。

* * *

## 回答 #9

> 赞同：13
> 
> 时间：2009-01-21T19:01:04.323

我遇到的最大问题是在 32 位系统上。一旦您通过了某个数字，“ls”之类的工具就会停止工作。

一旦你越过了这个障碍，试图对那个目录做任何事情就会变成一个大问题。

* * *

## 回答 #10

> 赞同：10
> 
> 时间：2009-01-21T19:08:12.843

这实际上取决于使用的文件系统，以及一些标志。

例如，[ext3](http://en.wikipedia.org/wiki/Ext3)可以有数千个文件；但是在几千之后，它曾经非常缓慢。主要是在列出目录时，但在打开单个文件时也是如此。几年前，它获得了“htree”选项，大大缩短了获取给定文件名的 inode 所需的时间。

就个人而言，我使用子目录将大多数级别保持在一千左右项目以下。在您的情况下，我将创建 256 个目录，以及 ID 的最后两个十六进制数字。使用最后一个数字而不是第一个数字，这样您就可以平衡负载。

* * *

## 回答 #11

> 赞同：8
> 
> 时间：2009-01-21T19:55:10.143

如果实施目录分区方案所涉及的时间最少，我赞成它。第一次调试涉及通过控制台操作 10000 个文件目录的问题时，您会理解的。

例如，F-Spot 将照片文件存储为 YYYY\MM\DD\filename.ext，这意味着我在手动处理 ~20000 张照片时必须处理的最大目录大约是 800 个文件。这也使文件更容易从第三方应用程序中浏览。永远不要假设您的软件是唯一会访问您的软件文件的东西。

* * *

## 回答 #12

> 赞同：7
> 
> 时间：2009-01-21T20:08:12.127

它绝对取决于文件系统。许多现代文件系统使用体面的数据结构来存储目录的内容，但较旧的文件系统通常只是将条目添加到列表中，因此检索文件是 O(n) 操作。

即使文件系统做对了，列出目录内容的程序仍然绝对有可能搞砸并进行 O(n^2) 排序，所以为了安全起见，我总是限制每个文件的数量目录不超过500。

* * *

## 回答 #13

> 赞同：6
> 
> 时间：2014-01-21T22:24:43.893

ext3 实际上确实有目录大小限制，它们取决于文件系统的块大小。没有每个目录的“最大文件数”，而是每个目录的“用于存储文件条目的最大块数”。具体来说，目录本身的大小不能超过高度为 3 的 b-tree，并且树的扇出取决于块大小。有关详细信息，请参阅此链接。

[https://www.mail-archive.com/cwelug@googlegroups.com/msg01944.html](https://www.mail-archive.com/cwelug@googlegroups.com/msg01944.html)

我最近在一个用 2K 块格式化的文件系统上被这个问题所困扰，`warning: ext3_dx_add_entry: Directory index full!`当我从另一个 ext3 文件系统复制时，它莫名其妙地得到了目录完整的内核消息。就我而言，只有 480,000 个文件的目录无法复制到目标位置。

* * *

## 回答 #14

> 赞同：5
> 
> 时间：2009-01-21T19:07:56.540

问题归结为您将如何处理这些文件。

在 Windows 下，任何文件超过 2k 的目录在资源管理器中对我来说打开速度都很慢。如果它们都是图像文件，超过 1k 的文件往往在缩略图视图中打开速度很慢。

有一次，系统强加的限制是 32,767。现在更高了，但即便如此，在大多数情况下，一次处理的文件也太多了。

* * *

## 回答 #15

> 赞同：5
> 
> 时间：2015-04-17T19:32:38.773

**“取决于文件系统”**
一些用户提到性能影响取决于使用的文件系统。当然。像 EXT3 这样的文件系统可能非常慢。但是，即使您使用 EXT4 或 XFS，您也无法阻止通过或通过外部连接（如 FTP）列出文件夹`ls`会`find`变得越来越慢。

**解决方案我更喜欢与**[@armandino](https://stackoverflow.com/a/466938/318765)
相同的方式。为此，我在 PHP 中使用这个小函数将 ID 转换为文件路径，每个目录生成 1000 个文件：

```
function dynamic_path($int) {
    // 1000 = 1000 files per dir
    // 10000 = 10000 files per dir
    // 2 = 100 dirs per dir
    // 3 = 1000 dirs per dir
    return implode('/', str_split(intval($int / 1000), 2)) . '/';
} 
```

或者如果你想使用字母数字字符，你可以使用第二个版本：

```
function dynamic_path2($str) {
    // 26 alpha + 10 num + 3 special chars (._-) = 39 combinations
    // -1 = 39^2 = 1521 files per dir
    // -2 = 39^3 = 59319 files per dir (if every combination exists)
    $left = substr($str, 0, -1);
    return implode('/', str_split($left ? $left : $str[0], 2)) . '/';
} 
```

结果：

```
<?php
$files = explode(',', '1.jpg,12.jpg,123.jpg,999.jpg,1000.jpg,1234.jpg,1999.jpg,2000.jpg,12345.jpg,123456.jpg,1234567.jpg,12345678.jpg,123456789.jpg');
foreach ($files as $file) {
    echo dynamic_path(basename($file, '.jpg')) . $file . PHP_EOL;
}
?>

1/1.jpg
1/12.jpg
1/123.jpg
1/999.jpg
1/1000.jpg
2/1234.jpg
2/1999.jpg
2/2000.jpg
13/12345.jpg
12/4/123456.jpg
12/35/1234567.jpg
12/34/6/12345678.jpg
12/34/57/123456789.jpg

<?php
$files = array_merge($files, explode(',', 'a.jpg,b.jpg,ab.jpg,abc.jpg,ddd.jpg,af_ff.jpg,abcd.jpg,akkk.jpg,bf.ff.jpg,abc-de.jpg,abcdef.jpg,abcdefg.jpg,abcdefgh.jpg,abcdefghi.jpg'));
foreach ($files as $file) {
    echo dynamic_path2(basename($file, '.jpg')) . $file . PHP_EOL;
}
?>

1/1.jpg
1/12.jpg
12/123.jpg
99/999.jpg
10/0/1000.jpg
12/3/1234.jpg
19/9/1999.jpg
20/0/2000.jpg
12/34/12345.jpg
12/34/5/123456.jpg
12/34/56/1234567.jpg
12/34/56/7/12345678.jpg
12/34/56/78/123456789.jpg
a/a.jpg
b/b.jpg
a/ab.jpg
ab/abc.jpg
dd/ddd.jpg
af/_f/af_ff.jpg
ab/c/abcd.jpg
ak/k/akkk.jpg
bf/.f/bf.ff.jpg
ab/c-/d/abc-de.jpg
ab/cd/e/abcdef.jpg
ab/cd/ef/abcdefg.jpg
ab/cd/ef/g/abcdefgh.jpg
ab/cd/ef/gh/abcdefghi.jpg 
```

正如您在`$int`-version 中看到的那样，每个文件夹最多包含 1000 个文件和最多 99 个目录，其中包含 1000 个文件和 99 个目录......

但不要忘记，许多目录会导致相同的性能问题！

最后，您应该考虑如何减少总文件量。根据您的目标，您可以使用 CSS 精灵来组合多个小图像，如头像、图标、表情符号等，或者如果您使用许多小型非媒体文件，请考虑将它们组合成 JSON 格式。就我而言，我有数千个迷你缓存，最后我决定将它们组合成 10 个一包。

* * *

## 回答 #16

> 赞同：5
> 
> 时间：2016-05-23T23:30:29.607

上面的大多数答案都没有表明原始问题没有“一刀切”的答案。

在今天的环境中，我们拥有大量不同的硬件和软件——有些是 32 位的，有些是 64 位的，有些是最先进的，有些是久经考验的——可靠且永不改变。除此之外，还有各种较旧和较新的硬件、较旧和较新的操作系统、不同的供应商（Windows、Unix、Apple 等）以及随之而来的无数实用程序和服务器。随着硬件的改进和软件转换为 64 位兼容性，让这个庞大而复杂的世界的所有部分与快速变化的步伐很好地配合，必然会有相当大的延迟。

恕我直言，没有一种方法可以解决问题。解决方案是研究可能性，然后通过反复试验找到最适合您的特定需求的方法。每个用户必须确定什么对他们的系统有效，而不是使用千篇一律的方法。

例如，我有一个带有一些非常大文件的媒体服务器。结果只有大约 400 个文件填充了 3 TB 驱动器。仅使用了 1% 的 inode，但使用了总空间的 95%。其他拥有大量较小文件的人可能会在它们接近填充空间之前用完 inode。（根据经验，在 ext4 文件系统上，每个文件/目录使用 1 个 inode。）虽然理论上一个目录中可能包含的文件总数几乎是无限的，但实用性决定了总体使用情况决定了实际单位，而不是只是文件系统功能。

我希望以上所有不同的答案都促进了思考和解决问题，而不是成为进步的不可逾越的障碍。

* * *

## 回答 #17

> 赞同：4
> 
> 时间：2009-01-21T19:13:05.670

我记得运行了一个程序，该程序在输出中创建了大量文件。文件按每个目录 30000 个进行排序。当我不得不重用生成的输出时，我不记得有任何读取问题。它在 32 位 Ubuntu Linux 笔记本电脑上，甚至[Nautilus](http://en.wikipedia.org/wiki/GNOME_Files)也显示了目录内容，尽管是在几秒钟之后。

ext3 文件系统：64 位系统上的类似代码可以很好地处理每个目录的 64000 个文件。

* * *

## 回答 #18

> 赞同：4
> 
> 时间：2010-11-26T15:37:53.553

我遇到了类似的问题。我试图访问一个包含超过 10,000 个文件的目录。构建文件列表并在任何文件上运行任何类型的命令所花费的时间太长。

我想出了一个小 php 脚本来为自己做这件事，并试图找到一种方法来防止它在浏览器中超时。

以下是我为解决该问题而编写的 php 脚本。

[列出目录中的文件，其中包含太多用于 FTP 的文件](http://www.swhistlesoft.com/blog/2010/11/18/42-listing-files-in-a-directory-with-too-many-files-for-ftp)

它如何帮助某人

* * *

## 回答 #19

> 赞同：3
> 
> 时间：2009-01-21T20:49:25.790

我尊重这并不能完全回答你关于多少太多的问题，但解决长期问题的一个想法是，除了存储原始文件元数据之外，还要存储它存储在磁盘上的哪个文件夹 - 规范化取出那段元数据。一旦文件夹超出了您对性能、美观或任何原因感到满意的某个限制，您只需创建第二个文件夹并开始将文件放在那里...

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2013-12-17T05:37:05.120

不是答案，只是一些建议。

选择更合适的FS（文件系统）。因为从历史的角度来看，你所有的问题都足够明智，曾经成为 FS 几十年来发展的核心。我的意思是更现代的 FS 可以更好地支持您的问题。[首先从FS列表](https://en.wikipedia.org/wiki/List_of_file_systems)中根据您的最终目的制作比较决策表。

我认为是时候改变你的范式了。所以我个人建议使用[分布式系统感知 FS](https://en.wikipedia.org/wiki/Distributed_file_system#Distributed_file_systems)，这意味着在大小、文件数量等方面完全没有限制。否则你迟早会遇到新的意想不到的问题。

我不确定是否可以工作，但如果您不提及一些实验，请在当前文件系统上尝试 AUFS。我猜它具有将多个文件夹模拟为单个虚拟文件夹的功能。

要克服硬件限制，您可以使用 RAID-0。

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2014-02-16T00:18:19.463

只要不超过操作系统的限制，没有一个数字是“太多”的。但是，无论操作系统如何，目录中的文件越多，访问任何单个文件所需的时间就越长，并且在大多数操作系统上，性能是非线性的，因此从 10,000 个文件中查找一个文件需要超过 10 倍的时间然后在 1,000 中找到一个文件。

与目录中有大量文件相关的次要问题包括通配符扩展失败。为了降低风险，您可以考虑按上传日期或其他一些有用的元数据对目录进行排序。

* * *

## 回答 #22

> 赞同：-6
> 
> 时间：2021-06-14T08:42:54.500

完美无瑕，

完美无瑕，

绝对完美：

（通用汽车 - RIP）

```
function ff () { 
    d=$1; f=$2; 
    p=$( echo $f |sed "s/$d.*//; s,\(.\),&/,g; s,/$,," ); 
    echo $p/$f ; 
    }

ff _D_   09748abcGHJ_D_my_tagged_doc.json

0/9/7/4/8/a/b/c/G/H/J/09748abcGHJ_D_my_tagged_doc.json

ff -   gadsf12-my_car.json 

g/a/d/s/f/1/2/gadsf12-my_car.json 
```

还有这个

```
ff _D_   0123456_D_my_tagged_doc.json

0/1/2/3/4/5/6/0123456_D_my_tagged_doc.json

ff .._D_   0123456_D_my_tagged_doc.json

0/1/2/3/4/0123456_D_my_tagged_doc.json 
```

请享用 ！

# python - 如何设置它以便线程通信它们已完成任务？

> ID：466525
> 
> 赞同：0
> 
> 时间：2009-01-21T18:59:25.607
> 
> 标签：python, multithreading

从概念上讲，我想完成以下任务，但在理解如何在 Python 中正确编码时遇到了麻烦：

```
from threading import Thread
for i in range(0,3):
    t = Thread(target=myfunction)
    t.start()

# wait until threads have finished executing
print 'complete!' 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-21T19:10:02.823

将线程添加到列表和`join()`它们。

```
from threading import Thread
tlist = []
for i in range(3):
    t = Thread(target=some_function)
    t.start()
    tlist.append(t)

# wait until threads have finished executing
for t in tlist:
    t.join()

print 'complete!' 
```

* * *

## 回答 #2

> 赞同：-4
> 
> 时间：2009-01-21T19:06:02.347

我从未使用过 python，但我认为您正在寻找的概念是“信号量”。

谷歌出现了这个：

[http://www.python.org/doc/2.5.2/lib/semaphore-objects.html](http://www.python.org/doc/2.5.2/lib/semaphore-objects.html)

# c# - 树视图复选框：如何检查选择，反之亦然

> ID：466530
> 
> 赞同：0
> 
> 时间：2009-01-21T19:01:07.583
> 
> 标签：c#, winforms, treeview

我正在处理`TreeView`其`CheckBoxes`属性设置为`True`. 我想要与 a 中相同的功能`CheckListBox`，如果我选中 a 的框`TreeNode`，该节点将被选中；如果我选择一个节点，该节点的复选框将被选中。我不确定我需要连接什么事件才能做到这一点。请帮忙。谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-21T19:19:15.300

尝试以下操作：

```
private void treeView1_AfterSelect(object sender, TreeViewEventArgs e)
{
    treeView1.SelectedNode.Checked = true;
} 
```

这`Event`与`TreeView`s`AfterSelect`事件有关

# asp.net - 从 GridView 中单击 ImageButton 获取行索引

> ID：466540
> 
> 赞同：6
> 
> 时间：2009-01-21T19:03:03.257
> 
> 标签：asp.net, vb.net, gridview, imagebutton

我有一个 Gridview，其中 ImageButtons 通过模板字段添加到列中。我已经为“OnClick”事件附加了一个函数。

进入此函数后，如何获取已单击按钮的行的索引。看来我所拥有的只是页面上的鼠标坐标。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-01-21T19:29:16.527

您可以使用它而不是循环遍历行

```
<asp:ImageButton runat="server" id="ibtn1" ... RowIndex='<%# Container.DisplayIndex %>' 
OnClick="button_click"/>

...

protected void button_click(object sender, EventArgs e){
    ImageButton ibtn1 = sender as ImageButton;
    int rowIndex = Convert.ToInt32(ibtn1.Attributes["RowIndex"]);

    //Use this rowIndex in your code
} 
```

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-01-21T19:56:20.950

将发送者转换为 ImageButton，然后将图像按钮的 NamingContainer 转换为一行：

VB：

```
Dim btn as ImageButton = CType(sender, ImageButton)

Dim row as GridViewRow = CType(btn.NamingContainer, GridViewRow) 
```

C＃：

```
ImageButton btn = (ImageButton)sender;

GridViewRow row = (GridViewRow)btn.NamingContainer; 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-08-05T09:09:12.227

同意 bdukes 最简单的选择是使用 CommandArgument。将数据的唯一 ID 号绑定到该属性，然后处理 _RowCommand 事件。

例如：

```
<asp:TemplateField >
    <HeaderStyle Width="20" />
    <ItemTemplate>
        <asp:ImageButton ImageUrl="images/icons/iCal.png" CommandArgument='<%# Eval("Event_ID") %>' ToolTip="iCal" runat="server" Height="18" Width="18" />
    </ItemTemplate>
</asp:TemplateField>

Protected Sub gv_RowCommand(ByVal sender As Object, ByVal e As System.Web.UI.WebControls.GridViewCommandEventArgs) Handles gv.RowCommand

   e.CommandArgument    'use this value in whatever way you like

End Sub 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-09-09T12:41:49.063

这是一个非常好的技巧。我还有一个技巧。你可以试试看...

```
 protected void userGridview_RowCommand(object sender, GridViewCommandEventArgs e)
    {
        if (e.CommandName == "Select")
        {
            GridViewRow rowSelect = (GridViewRow)(((Button)e.CommandSource).NamingContainer);
            int rowindex = rowSelect.RowIndex;
         }
    } 
```

这也是一个很好的方法。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-01-21T19:05:36.717

我发现最简单的方法是使用[Command](http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.imagebutton.command.aspx)事件而不是[Click](http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.imagebutton.click.aspx)事件，并将项目 ID 作为命令参数发送。

您还可以遍历 GridView 中的行，并将行中的 ImageButton 与`sender`Click 事件中的参数进行比较。

# virtualization - 物理到虚拟的转换？

> ID：466542
> 
> 赞同：5
> 
> 时间：2009-01-21T19:04:05.503
> 
> 标签：virtualization

我真的可以这样做吗？

当我阅读有关虚拟化的内容时，我变得更加兴奋。我意识到的最新一件事是，实际上可以使用我现有的 XP Pro 开发工作站（VS 2005/vs2008/sql server 等）并将整个安装转换为虚拟映像并加载到我的新机器上？听起来不错是真的吗？真的那么容易吗？如果我可以对一台机器进行完整的“转储”，然后简单地将其移动到我的新工作站上，甚至不需要找到我所有的旧安装磁盘，那真是太棒了。

是否有一种 VM 产品比其他产品更好地支持这一点？这可能会让我选择一个平台而不是另一个平台..

我怎么没有早点赶上这股虚拟机潮流！？

编辑/更新：*就像快速更新一样，以防万一有人感兴趣。得到了机器，决定使用 vmware 并进行了一场激烈的战斗，首先试图弄清楚要使用哪种产品，然后真正让任何东西工作。这些说明并不明显，浪费了我 6 个小时来尝试 a) 让 vmware 工作，b) 实际上试图将我的旧 XP 机器转换为 VM - 从来没有让它工作。令人沮丧的是，我在几分钟内下载了 MS Virtual PC，在 5 分钟内启动并运行它，并在一小时内创建虚拟机......非常容易。然而，我还没有想出如何将我的旧 XP 机器转换为 VM - 但是，现在有一个正在运行的 VM，对我来说很明显我不想在我的 VW 窗口中实际运行主要开发设置。*

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-21T22:16:17.813

绝对是[VMware 转换器](http://www.vmware.com/products/converter/)。

VMware Workstation 是我用过的对用户最友好、功能最齐全的应用程序，非常适合调试。[在此处查看](http://e.blip.tv/scripts/flash/showplayer.swf?file=http://blip.tv/rss/flash/1057363)录制/重播功能的精彩视频演示。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-21T19:20:43.067

VMWare 有 p2v。到目前为止，您可以采用最简单的解决方案，如果您想使用不同的解决方案，将 VMDK 转换为 VHD 非常容易。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-21T22:20:32.267

我用过的三个选项。

1) **Vmware 转换器**将为您创建一个可以永远移动的图像。然后，您可以在 VMWare 播放器中免费运行它。

我认为最简单的方法是将外部驱动器连接到您的计算机，将计算机转换为该驱动器上的图像，将驱动器插入另一台机器，然后尝试一下..

2) **Ghost is ghost..**您可以使用类似 norton ghost 或 linux 之类的东西将驱动器镜像到更大的驱动器上。如果您有驱动程序问题，您可以在现有的 xp 安装上进行就地重新安装，它将替换驱动程序并保持所有应用程序、数据和设置不变。

3）**去麦克。** 他们很奇怪。您可以用一根火线将两台 Mac 连接起来，它会复制您的整个设置，包括虚拟机。我已经备份了我的笔记本电脑，如果它死了，我可以在几分钟内将同一台电脑转移到另一台电脑上，因为 Apple 的所有内部组件都是英特尔的，而且驱动程序是相同的。

我听说过的选项：

4)**微软虚拟 PC。**我听说过的第四个选项是 Microsoft Virtual PC。他们从另一家公司购买了这项技术，然后

5) **Citrix** - 这个很有趣，因为可以想象它也可以工作，如果不比 VMware 更好的话。至少这是我从我的 Citrix 朋友那里听到的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-21T22:37:15.790

欢迎来到虚拟化俱乐部。我在我的 Vista 操作系统上设置了一个虚拟机并同时运行 xp。它很棒，因为某些应用程序不能在 64 位中运行（即那些旧的 16 位应用程序。）。您可以尝试 Microsoft Virtual PC 2007，它可能是最用户友好的。这是我用的。你也可以试试 Virtualbox。您可以设置一个分区并为新操作系统分配空间以使其正常工作。或者，如果您有备用的格式化辅助驱动器，请使用它。

祝你好运！

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-04T03:30:27.160

我们现在在 VM 中进行所有开发。

桌面被锁得很紧，IT 经理很高兴。

我们使用 VirtualBox，这很好。

无论如何，对于直接为 VirtualBox 使用物理磁盘有相当明确的说明。P->V 转换并不难。

不能对 MS VPC 或 VMWare 说同样的话。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-01-19T23:44:01.217

这里有一个 XenConvert 的链接，它是专门为这种“P2V”（物理到虚拟）转换而设计的，以表明您的第一个问题的答案是“是”，可以做到。

[http://www.citrix.com/site/ss/downloads/details.asp?downloadId=2318170&productId=683148](http://www.citrix.com/site/ss/downloads/details.asp?downloadId=2318170&productId=683148)

但是，该工具是为将您的 XP 机器的映像填充到服务器而不是桌面机器而设计的。

对于为桌面执行此操作的更具体问题，您更多地谈论“客户端虚拟化”（与服务器虚拟化相反），其中 XenClient、KVM、Virtual Box、qemu、Parallels、VMWare Workstation 等工具是更适合，每个人都有自己的 P2V 转换技术。

# java - JUnit：确保测试方法中的失败在@After方法中的失败之前显示

> ID：466548
> 
> 赞同：0
> 
> 时间：2009-01-21T19:05:30.867
> 
> 标签：java, junit, easymock

我设计了一个小型测试用例类，旨在使模拟更容易（在本例中，使用 JUnit 4 和 EasyMock）。其中一部分是在测试完成后验证模拟，因此模拟在使用@After 注释的方法中进行验证。

但是，如果测试方法本身有失败，导致测试没有完成，mock验证失败，那么JUnit上报的失败就是验证失败。但是，如果报告的失败是测试本身的失败，则它会更有用。

那么，在 JUnit 中是否有一种方法可以确保始终优先显示测试方法中的错误/失败，而不是使用 @After 注释的方法中出现的错误/失败？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-21T19:08:39.847

通常，@After 注释等同于*tearDown()*，它暗示它应该只进行测试清理，而不是运行测试或进行断言。

我会让您的测试用例在每个测试用例结束时调用您的“验证”方法，而不是让 JUnit 为您调用它

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-21T20:52:52.943

你在测试中做了什么断言@After 中的验证被报告了？如果有一个断言失败（或者调用了fail()方法）那么会被报告，而after方法不会被报告。测试方法是什么样的？

# .net - WPF ListViewItem 失去焦点事件 - 如何参加该事件？

> ID：466555
> 
> 赞同：3
> 
> 时间：2009-01-21T19:07:31.720
> 
> 标签：.net, wpf, listview, datatrigger, listviewitem

我有一个列表视图，您可以在其中选择一行/项目。这链接到在行上显示图像的数据触发器。仅在选择行时应显示图像。

这部分工作正常，但是当您将焦点移到其他内容（例如文本框或显示消息框）时，listviewitem 失去焦点，即不再显示行上的突出显示。问题是我的形象仍然存在。当列表视图失去焦点时，它应该被隐藏/折叠......如果您在列表视图上选择不同的项目/行，它可以正常工作。

有人可以帮忙吗？

```
<Style x:Key="deleteImageStyle" TargetType="{x:Type Image}">
    <Setter Property="Source" Value="Resources/iconDelete.png" />
    <Setter Property="Margin" Value="0,2,5,0" />
    <Setter Property="Height" Value="16" />
    <Setter Property="Width" Value="16" />
    <Setter Property="HorizontalAlignment" Value="Right" />
    <Setter Property="VerticalAlignment" Value="Top" />
    <Setter Property="Cursor" Value="Hand" />
    <Style.Triggers>
        <DataTrigger Binding="{Binding RelativeSource={RelativeSource Mode=FindAncestor,AncestorType={x:Type ListBoxItem}},Path=IsSelected}" Value="True">
            <Setter Property="Visibility" Value="Visible"/>
        </DataTrigger>
        <DataTrigger Binding="{Binding RelativeSource={RelativeSource Mode=FindAncestor,AncestorType={x:Type ListBoxItem}},Path=IsSelected}" Value="False">
            <Setter Property="Visibility" Value="Hidden"/>
        </DataTrigger>
        <Trigger Property="IsEnabled" Value="False">
            <Setter Property="Visibility" Value="Hidden" />
        </Trigger>
    </Style.Triggers>
</Style> 
```

问候

特拉维斯PUK

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-21T21:28:24.137

我认为您混淆了 IsSelected 和 IsFocused。

尝试将触发器绑定到[IsFocused](http://msdn.microsoft.com/en-us/library/system.windows.uielement.isfocused.aspx)而不是 IsSelected 以获得所需的结果。

如果我理解正确，您只希望图像在 IsSelected 和 IsFocused 都为真时可见，否则隐藏。

一种方法是将默认可见性设置为可见，然后添加两个将可见性设置为隐藏的触发器：一个触发器用于 IsSelected = False，另一个触发器用于 IsFocused = False。

或者相反，将默认 Visibility 设置为 Hidden，并使用 IsSelected = True 和 IsFocused = True 的 MultiTrigger 将其 Visibility 设置为 Visible

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-21T23:30:15.153

@泡沫包装，

感谢您的信息，这很好地解决了这个问题。根据下面我必须在这两种情况下添加，因为默认值似乎没有生效......但是我还没有尝试过 MultiTrigger 方法，稍后会做。

这就是我最终得到的结果。

```
<Style.Triggers>
            <DataTrigger Binding="{Binding RelativeSource={RelativeSource Mode=FindAncestor,AncestorType={x:Type ListBoxItem}},Path=IsSelected}" Value="True">
                <Setter Property="Visibility" Value="Visible"/>
            </DataTrigger>
            <DataTrigger Binding="{Binding RelativeSource={RelativeSource Mode=FindAncestor,AncestorType={x:Type ListBoxItem}},Path=IsFocused}" Value="True">
                <Setter Property="Visibility" Value="Visible"/>
            </DataTrigger>
            <DataTrigger Binding="{Binding RelativeSource={RelativeSource Mode=FindAncestor,AncestorType={x:Type ListBoxItem}},Path=IsSelected}" Value="False">
                <Setter Property="Visibility" Value="Hidden"/>
            </DataTrigger>
            <DataTrigger Binding="{Binding RelativeSource={RelativeSource Mode=FindAncestor,AncestorType={x:Type ListBoxItem}},Path=IsFocused}" Value="False">
                <Setter Property="Visibility" Value="Hidden"/>
            </DataTrigger>
            <Trigger Property="IsEnabled" Value="False">
                <Setter Property="Visibility" Value="Hidden" />
            </Trigger>
        </Style.Triggers> 
```

感谢您的帮助，这将使我暂时解决我的问题。我认为我的 IsEnabled 触发器现在可能是多余的。

谢谢

特拉维斯PUK

# language-agnostic - 任何人都可以给我一个过度使用的设计模式的例子吗？

> ID：466560
> 
> 赞同：5
> 
> 时间：2009-01-21T19:08:00.813
> 
> 标签：language-agnostic, design-patterns, oop

当人们遇到过度使用设计模式的案例时，我一直在听到和阅读有关案例。好的，误用的设计模式是可以理解的现象。它实际上意味着过度使用的设计模式是什么？

你有任何例子吗？为什么你认为模式太多了？

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2009-01-21T19:16:00.300

单[例](http://en.wikipedia.org/wiki/Singleton_pattern)可能是最被[过度使用的设计模式](http://www.ibm.com/developerworks/webservices/library/co-single.html)。当它超出范围并且更适合直接实例化对象时，我经常看到它在许多情况下使用。

在那之后，我相信[工厂模式](http://en.wikipedia.org/wiki/Factory_method_pattern)被过度用作实例化对象的快捷方式，很多时候没有真正的需要。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-01-21T19:58:42.630

面向对象，它不再是一种设计模式，而是一种生活方式。我已经看到很多程序代码在对象和对象中被大量使用，因为时代精神说“大概你是面向对象的”，而几行 C 和结构也可以。

我认为它是最被过度使用的设计模式，因为它（可能）是最广泛使用的设计模式，并且它的优点很少受到质疑。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-01-21T19:38:36.477

我投票给 ActiveRecord。

许多流行的数据访问框架使用 ActiveRecord 作为*唯一*的数据访问模式，这是一种万能的解决方案，尽管 Martin Fowler 的《企业应用程序架构模式》一书描述了其他几种数据访问模式，并详细介绍了每种模式的优势模式以及如何决定何时使用每种模式。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-01-21T19:15:22.703

我猜**Singleton**很容易被过度使用（尽管它确实有其合法用途）。

对 Singleton 模式的上瘾称为[*Singletonitis*](http://www.theserverside.com/blogs/thread.tss?thread_id=42116)。:) 症状至少包括不必要的高耦合和测试变得更加困难。

**编辑**：作为 Singletonitis 的处方治疗方法，您可以尝试使用 Joshua Kerievsky在[Refactoring to Patterns](https://rads.stackoverflow.com/amzn/click/com/0321213351)中描述的*Inline Singleton 。*

**编辑 2**：关于单身人士的良好讨论，请参阅这个较旧的问题：[单身人士有什么不好](https://stackoverflow.com/questions/137975/what-is-so-bad-about-singletons)

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-01-21T19:51:10.057

（有时）所谓的 JavaBeans-Pattern：每个字段的 getter 和 setter。[高度可疑](http://www.javaworld.com/javaworld/jw-09-2003/jw-0905-toolbox.html)且极为普遍。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-01-21T19:45:57.837

**序言：**一般来说，单例模式被认为是最被滥用的模式，这仅仅是因为许多人实际上会使用它来编写内联编程，如果不是在现实中，而其他人则将它用作全局变量的替代品。

**BODY：**有一本书叫“A Pattern Language”，比著名的 GoF 早几年。它要求在项目的不同方面使用类似的语言——它显然对“设计模式”产生了重大影响，并且了解这两种文本的人认为它更胜一筹。

我个人的经验是，GoF 仅在某些情况下有用，与涵盖所有 OOP 相去甚远。实际上，我觉得这很有趣，其中一些模式在其他语言中已经过时，而其他模式只是冗余地描述了相同的场景（适应和翻译的东西之间真的有那么大的区别吗？）

一般来说，模式是一件好事。单例通常使用静态 getInstance 方法很好。许多 MVC 结构使用类似的命名约定是好的。另一方面，模式不是一切，需要记住。

推荐阅读： http: [//perl.plover.com/yak/design/](http://perl.plover.com/yak/design/)

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-01-21T19:15:27.553

单例模式，只适用于极少数情况，使测试更加困难。它不仅被过度使用，而且在 Java 和 C# 中经常被糟糕地实现——人们经常急于进行双重检查锁定，因为它不仅不合适而且*相对*难以正确处理。

编辑：我真的应该意识到每个人都会发布同样的东西。

下一个示例，工厂模式，特别是它在 Java DOM API 中的使用。布莱赫。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-01-21T19:15:06.777

我会说[Singleton](http://en.wikipedia.org/wiki/Singleton_pattern)被过度使用了。通常有比使用本质上是全局变量更好的解决方案。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-01-21T19:19:24.723

我将权衡过度使用的 Singleton。很多时候，开发人员只学习这一种模式，并在静态类同样有效时使用它。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2009-01-21T20:02:25.947

我认为比过度使用的设计模式更严重的问题是模式被热情的开发人员误用，他们最近学习了一种新的模式工具并决定他们需要尝试一下。最近我一直在阅读 Misko Hevery 的一些关于依赖注入的博客 ( [http://misko.hevery.com/2008/08/17/singletons-are-pathological-liars/ ) 条目。](http://misko.hevery.com/2008/08/17/singletons-are-pathological-liars/)他的主要主张之一是，作为全局实例实现的单例模式严重限制了可测试性，应该避免。

几天前，我从 Christian Gruber 的博客中读到了一篇关于模式的有趣观点。他建议它们作为讨论架构的工具很有用，但不应在设计概念期间使用，以免软件架构恶化为他所谓的“数字绘画”。请参阅有关设计模式的段落：[http](http://www.geekinasuit.com/2008/12/testability-re-discovering-what-we.html) ://www.geekinasuit.com/2008/12/testability-re-discovering-what-we.html 。

因此，设计模式的问题可能是误用和隧道视野，这是由于认为所有设计良好的软件都必须符合“四人帮”中描述的模式之一。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-01-21T19:13:00.820

这实际上是由我们唯一的杰夫阿特伍德在编码恐怖中讨论的：

[http://www.codinghorror.com/blog/archives/000380.html](http://www.codinghorror.com/blog/archives/000380.html)

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-01-23T00:35:30.997

我一直看到在只有一个提供者的情况下使用提供者模式。这似乎是大量的额外工作，没有任何好处。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-01-21T19:21:17.480

我也投票给 Singleton：一个穿着抽象服装的全球化。

还有工厂，因为这样可以更容易地不去考虑在给定程序中对象是如何连接在一起的。

# c# - 绑定标签与代码隐藏集，最佳实践

> ID：466562
> 
> 赞同：3
> 
> 时间：2009-01-21T19:08:13.950
> 
> 标签：c#, asp.net

## 我想知道在 asp.net 中使用绑定标记和将直接属性设置为控件之间的最佳实践是什么。

* * *

aspx.cs

```
public string Description {get; set;} 
```

aspx

```
<asp:Literal ID="txtDescription" runat="server" Text='<%# Description %>' /> 
```

* * *

aspx.cs

```
public string Description
{
    get { return txtDescription.Text ; }
    set { txtDescription.Text = value; }
} 
```

aspx

```
<asp:Literal ID="txtDescription" runat="server" /> 
```

* * *

第一个是最好将设计与代码分开，从而可以自由更改 ID 而不会破坏代码。但似乎我们有时会得到很长的绑定标签，就像这个非常短的例子：

```
Text='<%# ((fn_SearchReminders)Container.DataItem).dtDateActivation.Value.ToString("yyyy-MM-dd - hh:mm") %>' 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-21T19:27:26.453

唯一值得使用绑定表达式的是when...数据绑定。对于处理像文本框这样的静态控件，访问它的最佳方式是您在第二种情况下所做的方式。

这甚至是处理模型视图演示器实现的情况，通常您的 aspx 页面将来自 iSomeView，您将访问类似于

```
string iSomeView.Description
{
    get { return txtDescription.Text ; }
    set { txtDescription.Text = value; }
} 
```

使用与此类似的方法还可以让您轻松构造复杂的对象：

```
Person iSomeView.Person
{
    get { return new Person { Name = txtName.Text, Phone = txtPhone.Text }; }
    set { txtName = value.Name; txtPhone.Text = value.Phone; }
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-21T19:44:29.900

如果您使用 GridView 或 Repeater 等控件，您可以简单地使用 ' /> 并可选择指定格式字符串，如 ' /> 其中“d”代表短日期字符串。

如果其他控件直接包含在页面中，您可以考虑使用私有方法，该方法将在您认为合适的时候设置它们的属性。

像

```
private void SetFormFields(Employee emp){
     lblName.Text = emp.Name;
     txtDateOfBirth.Text = emp.BirthDate.ToShortDateString();
} 
```

并在页面加载事件中或从其他地方调用它。

# c# - C# 中的 switch 语句和“需要一个常量值”

> ID：466565
> 
> 赞同：20
> 
> 时间：2009-01-21T19:08:40.220
> 
> 标签：c#, visual-studio

为什么编译器对第一种情况说“需要一个常量值”...第二种情况工作正常...

```
switch (definingGroup)
{
    case Properties.Settings.Default.OU_HomeOffice:  
        //do something  
        break;
    case "OU=Home Office":  
        //do something
        break;
    default:
        break;
 } 
```

也试过...

```
switch (definingGroup)
{
    case Properties.Settings.Default.OU_HomeOffice.ToString():  
        //do something
        break;
    case "OU=Home Office":
        //do something
        break;
    default:
        break;
 } 
```

...同样的错误

这是 Properties.Setting 代码

```
[global::System.Configuration.ApplicationScopedSettingAttribute()]
[global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
[global::System.Configuration.DefaultSettingValueAttribute("OU=Home Office")]
public string OU_HomeOffice {
    get {
        return ((string)(this["OU_HomeOffice"]));
    }
} 
```

* * *

## 回答 #1

> 赞同：40
> 
> 时间：2009-01-21T19:10:53.960

`Properties.Settings.Default.OU_HomeOffice`不是一个常量字符串 - 在编译时已知的东西。C# switch 语句要求每个 case 都是编译时常量。

（除此之外，这是它知道不会有任何重复的唯一方法。）

有关更多详细信息，请参阅 C# 3.0 规范的第 8.7.2 节。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-01-21T19:11:39.153

这是因为无法在编译时确定该值（因为它来自配置设置）。您需要提供编译代码时已知的值（常量）。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-01-21T19:14:23.673

它的基本意思是，它需要确保每个案例的值在运行时不会改变。像在第二种情况下那样对字符串进行内联硬编码将确保该值在运行时不会改变（就像声明一个“const”变量并将硬编码的字符串分配为一个值一样）。

第一种情况是调用类的属性，编译器在编译时不知道该属性的值。

如果您有一些“配置”值在您的应用程序中几乎是不变的，您可能会考虑创建一个类，您可以在其中将这些值硬编码为 const 变量并在您的 switch 语句中使用它们。否则，您可能会不得不使用 if/else if 语句。

# c++ - (C++) 需要使用 reg 计算出半径内的所有点。二维窗口坐标。系统

> ID：466568
> 
> 赞同：2
> 
> 时间：2009-01-21T19:09:13.307
> 
> 标签：c++, algorithm, visual-c++

提前抱歉，我在如何解释这个问题上有点挣扎...... :)

本质上，我有一个典型的 Windows 坐标系（顶部，左侧是 0,0）。如果有人熟悉 hasrsine 查询，[比如在 SQL 中](http://forums.mysql.com/read.php?10,238858,238858)，它可以根据纬度和经度坐标获取半径内的所有点。

我需要一些更简单的东西，但我的数学技能并没有达到标准！基本上，我在大约 600x400 的空间中散布着随机点。对于地图上的任何 X、Y 点，我需要运行查询以确定该点的给定半径内还有多少其他点。

如果这还不够描述，请告诉我！

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-01-21T19:18:43.617

直截了当的方法：

您可以使用[勾股定理](http://en.wikipedia.org/wiki/Pythagorean_theorem#Distance_in_Cartesian_coordinates)计算点之间的距离：

```
deltaX = x1 - x2
deltaY = y1 - y2
distance = square root of (deltaX * deltaX + deltaY * deltaY) 
```

给定 point `x1,y1`，对每个其他点 ( `x2,y2`) 执行此操作，以查看计算的距离是否在（小于或等于）您的半径范围内。

如果你想让它更快，计算并存储半径的平方，然后与 比较`(deltaX * deltaX + deltaY * deltaY)`，避免平方根。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-21T20:22:22.647

在做毕达哥拉斯之前，您还可以快速消除任何落在可以完全包含目标圆的正方形之外的点。

```
// Is (x1, y1) in the circle defined by center (x,y) and radius r
bool IsPointInCircle(x1, y1, x, y, r)
{
    if (x1 < x-r || x1 > x+r)
       return false;
    if (y1 < y-r || y1 > y+r)
       return false;
    return (x1-x)*(x1-x) + (y1-y)*(y1-y) <= r*r
} 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-21T19:16:20.737

使用毕达哥拉斯：

```
distance = sqrt(xDifference^2 + yDifference^2) 
```

请注意，此示例中的 '^' 表示“幂”，而不是 C 的按位 XOR 运算符。换句话说，这个想法是要消除这两个差异。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-21T20:27:50.123

如果您只关心相对距离，则不应使用平方根，您可以执行以下操作：

```
 rSquared = radius * radius #square the radius
 foreach x, y in Points do
   dX = (x - centerX) * (x - centerX) #delta X
   dY = (y - centerY) * (y - centerY) #delta Y
   if ( dX + dY <= rSquared ) then
     #Point is within Circle
   end
 end 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-21T19:41:36.800

使用[圆的方程](http://en.wikipedia.org/wiki/Circle#Equation)：

```
radius ** 2 = (x - centerX) ** 2 + (y - centerY) ** 2 
```

我们想找出一个点`(x, y)`是否在圆内。我们使用以下等式执行测试：

```
radius ** 2 < (x - centerX) ** 2 + (y - centerY) ** 2

// (Or use <= if you want the circumference of the circle to be included as well) 
```

只需将您的值代入该等式即可。如果有效（不等式成立），则该点位于圆内。否则，它不是。

# svn - 什么报告可用于 svn？

> ID：466572
> 
> 赞同：6
> 
> 时间：2009-01-21T19:10:35.583
> 
> 标签：svn, audit

我们正在迁移到 SVN。

不幸的是，我们定期接受审计，审计员需要以下信息：
文件更改
历史 SVN 访问历史
新文件 添加 文件
更改

是否有工具可以为我们（或其中一些）生成这些报告？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-21T23:39:19.283

`StatSVN`是一个轻量级的颠覆报告生成器。 [http://www.statsvn.org/](http://www.statsvn.org/)

1.  首先生成详细日志文件 -[`svn log`](http://svnbook.red-bean.com/en/1.7/svn-book.html#svn.ref.svn.c.log)

2.  运行[`StatSVN`](http://wiki.statsvn.org/)，它是一个单独的 jar 文件。

`StatSVN`提供指标列表：

*   哪个文件变化最大
*   添加了多少行
*   谁贡献更多

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-21T19:30:04.310

Trac ( [http://trac.edgewall.com](http://trac.edgewall.com) ) 可用于查看 SVN 详细信息。Trac 具有不错的功能，例如允许查看不同的变更集（并在它们之间来回切换）的变更集视图。它还提供了一个漂亮的用户界面，比 ViewVC(www.viewvc.org) 好得多

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-21T19:17:23.870

[svn log](http://svnbook.red-bean.com/en/1.0/re15.html)是获取您要查找的文件相关信息的基本命令...

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-21T19:17:33.557

您可以通过 SVN 修订日志获得所有这些信息。不过，您可能想考虑使用像[Fisheye](http://www.atlassian.com/software/fisheye/)这样的好工具来为您完成这项工作。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-01-21T19:36:58.307

SVN 直接从命令行提供了您所要求的大部分内容：

*   特定文件/目录的更改历史记录：`svn log /your/path`为您提供源代码差异、作者、签入日期等。
*   添加的新文件：`svnlook changed -r <rev> <path to repository>`为您提供在给定修订版中涉及的所有文件。循环遍历所有相关的修订，以及`grep`表示添加文件的“A”。
*   文件更改：`svn diff -r <first rev>:<last rev> <path>`为您提供整个修订范围的差异
*   访问 SVN 的历史记录：SVN 显然维护了所有签入的日志（请参阅 参考资料`svn log`）。至于读取权限，我不知道内置机制，但是您可以轻松创建自己的机制，具体取决于配置。如果您只允许 http 访问，您可以使用网络服务器的日志文件。

它不是很漂亮，但是 SVN 的输出是高度结构化的，因此您可以轻松地进行自己的格式化。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-21T21:52:21.420

以下是我之前使用的一些内容，可让我一目了然地了解变更活动报告和趋势。过滤并不完美，但您可以理解：

```
set REPO_URL=svn://localhost/...
set REVISION_START=1
set REVISION_END=HEAD 
set COMMAND=svn log %REPO_URL% -v -g -r %REVISION_START%:%REVISION_END% 
set REG_EXPRESSION="^...[ACDIMRX].\/" 
```

受影响的配置项：

```
%COMMAND% | find /c "/" 
```

变更集：

```
%COMMAND% | find /c "Changed paths" 
```

在给定修订范围内受影响的唯一文件列表（我安装了 cygwin）：

```
%COMMAND% | findstr /r %REG_EXPRESSION% | sort | uniq -u 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-21T19:21:41.643

看看[codesaga](http://www.codesaga.com/)。它很好地可视化了源代码控制提交。我不能保证报告部分。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-21T19:22:24.607

这个程序可能会帮助你，不是审计，而是更新

[http://www.svnmonitor.com/default.shtml](http://www.svnmonitor.com/default.shtml)

*   监视某些事件的来源
*   发生某些事件时接收任何类型的通知（气球弹出窗口、托盘图标、电子邮件、声音等）

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-01-21T21:03:17.900

要查看对 SVN 的实际访问，您需要解析 Apache 服务器日志（假设您通过 Apache 提供 SVN）。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2017-02-02T13:57:31.403

这个问题也有点老了，但我制作了一个脚本，它可能对 Subversion 的简单报告/审计以及跟踪对 SVN 存储库所做的更改很有用，我想分享它。它以类似于命令“svnlook”的方式提取有关 SVN 提交的信息，但它有两个优点。首先，它允许迭代存储库的所有修订以跟踪所做的所有更改。其次，信息以制表符分隔的表格格式（如 ps 或 df 等 Unix 命令）打印，这种格式既易于阅读，又易于解析或导入电子表格，非常适合报告。它也可以被调用或嵌入到 SVN 提交后挂钩中。

它是一个名为 svn-commit-info.pl 的 Perl 脚本，接受三个参数。第一个是存储库路径，它是强制性的。第二个，可选的，是要搜索的文件模式。第三个也是可选的，是要查询的修订号。

如果仅使用存储库路径执行，它将向 STDOUT 打印有关受存储库中所做的所有提交影响的文件的信息。例如，假设存储库存储在 Subversion 服务器的 /svn/repos/test 中：

```
$ perl svn-commit-info.pl /svn/repos/test
# Repository: /svn/repos/test
# Fields: Action, Revision, Date, Author, Bytes, Path
# Actions: A = New, D = Deleted, U = Updated
A    1     2017-01-31 17:21:19     Samsa     <DIR>    TestProject/
A    2     2017-01-31 17:21:33     Samsa       815    TestProject/.project
A    2     2017-01-31 17:21:33     Samsa     <DIR>    TestProject/.settings/
A    2     2017-01-31 17:21:33     Samsa       564    TestProject/.settings/.jsdtscope
A    2     2017-01-31 17:21:33     Samsa     <DIR>    TestProject/www/
A    3     2017-01-31 17:27:48     David       355    TestProject/www/test.html
A    3     2017-01-31 17:27:48     David     <DIR>    TestProject/www/css/
A    3     2017-01-31 17:27:48     David      9622    TestProject/www/css/logo.jpg
A    3     2017-01-31 17:27:48     David      1231    TestProject/www/css/reportstyle.css
A    3     2017-01-31 17:27:48     David    168345    TestProject/www/css/style.css
U    4     2017-02-01 10:48:34     Samsa    183260    TestProject/www/css/style.css
D    5     2017-02-01 12:51:26     David       355    TestProject/www/test.html 
```

制表符分隔的字段是：执行的操作、修订号、日期和时间、修订的作者、以字节为单位的文件大小（除非文件是由字符串“<DIR>”标记的目录）和存储库中受影响文件的路径。前三行包含关于输出的以人为本的评论。

如果存储库很大，有很多文件或修订版，前一个命令的输出可能需要很长时间才能完成。如果您想跟踪对特定文件（或一组文件）所做的更改，最好指定文件模式（实际上，这是一个 Perl 正则表达式）。例如，要获取有关对文件 style.css 所做更改的信息：

```
$ perl svn-commit-info.pl /svn/repos/test style.css 
```

如果您对特定版本感兴趣，可以指定第三个参数。例如打印第三次修订的所有更改，考虑到'.' 匹配 Perl 正则表达式中的任何字符：

```
$ perl svn-commit-info.pl /svn/repos/test . 3 
```

当然，您可以利用 Unix 过滤器和流水线的强大功能来执行更复杂的查询，例如查找用户 David 所做的所有修改：

```
$ svn-commit-info.pl /svn/repos/test | grep David 
```

要查找所有大小 >= 1Mb 创建的文件：

```
$ svn-commit-info.pl /svn/repos/test | awk '$1 = "A" && $6 ~ /[0-9]/ && $6 >= 1024*1024' 
```

该脚本使用标准的 Subversion 命令“svnlook”，但除此之外它是自包含的。有两个辅助函数来构建命令并获取“svnlook”的输出，然后对命令进行连续调用以组合输出。它需要 Subversion >= 1.7，并且已经在 Perl 5.10 上进行了测试。

```
#!/usr/bin/env perl
use strict; 

my $SVNLOOKCMD = "/usr/bin/svnlook";
my @FIELDS = qw(Action Revision Date Author Bytes Path);

# Builds and returns the "svnlook" command
sub svnlook_cmd {
   my($repository, $action, $revision, @varargs) = @_;
   my $cmd = $SVNLOOKCMD;
   $cmd.= " -r $revision" if $revision;
   $cmd.= " $action '$repository'";
   $cmd.= join "", map { " '$_'" } @varargs;
   $cmd.= '|';
   return $cmd;
}

# Executes the "svnlook" command and returns the output lines
sub svnlook_output {
   my($repository, $action, $revision, @varargs) = @_;
   open(my $svnlookfh, svnlook_cmd $repository, $action, $revision, @varargs);
   my @output = <$svnlookfh>;
   close $svnlookfh;
   chomp @output;
   return wantarray ? @output : $output[0];
}

my($repository, $file, $revision) = @ARGV;
unless($repository) {
    # 'repository' is the only mandatory argument
    print STDERR "$0 <repository> [<file>] [<revision>]\n";
    print STDERR "\t<repository> = path of Subversion repository\n";
    print STDERR "\t<file> = file pattern to search for (regular expression)\n";
    print STDERR "\t<revision> = commit revision number\n";
    exit 1;
}
$file = "." unless $file;
my $first = $revision ? $revision : 1;
my $last = $revision ? $revision : svnlook_output $repository, "youngest";
print "# Repository: $repository\n";
print "# Fields: ", join(", ", @FIELDS), "\n";
print "# Actions: A = New, D = Deleted, U = Updated\n";
for(my $rev = $first; $rev <= $last; $rev++) {
    my $author = "";
    my $date = "";
    foreach my $line (svnlook_output $repository, "changed", $rev) {
        if($line =~ /$file/i) {
            unless($date) {
                $date = svnlook_output $repository, "date", $rev;
                $date =~ s|^(\S+) (\S+).*$|\1 \2|;
            }
            $author = uc svnlook_output $repository, "author", $rev unless $author;
            my($action, $path) = split /\s+/, $line, 2;
            my $size;
            if($path =~ m|/$|) {
                $size = sprintf("%12s", "<DIR>");
            } else {
                $size = svnlook_output $repository, "filesize", $rev, $path;
                $size = sprintf("%12d", $size);
            }
            print join("\t", $action, $rev, $date, $author, $size, $path), "\n";
        }
    }
}
exit 0; 
```

希望这会有所帮助，并对长篇文章感到抱歉。

# .net - ASP.NET 2.0“BC2017：找不到库” - 如何强制 .NET 查找正确的版本？

> ID：466578
> 
> 赞同：0
> 
> 时间：2009-01-21T19:12:50.320
> 
> 标签：.net, asp.net-2.0

当我们尝试访问预编译的 ASP.NET 2.0 (Visual Studio 2005) 应用程序时，它会抛出此错误。

> 编译器错误消息：BC2017：找不到库 'C:\WINDOWS\assembly\GAC_MSIL\System.Web.Mobile\2.0.0.0__b03f5f7f11d50a3a\System.Web.Mobile.dll'

两个直接的问题浮现在脑海中：

1.  我们正在运行 .NET 版本 2.0.50727，而不是 2.0.0.0
2.  我们的 GAC 位于“C:\WINDOWS\Microsoft.NET\Framework\v2.0.50727\Temporary ASP.NET Files”，而不是“C:\WINDOWS\assembly\GAC_MSIL\”

所以很明显它正在寻找一个过时的程序集版本并且它在错误的地方寻找它。

不幸的是，我们无法重新编译应用程序，因为我们正在为客户端托管它，并且无法从原始开发人员那里获得源代码。有没有办法强制 ASP.NET 应用程序使用当前版本的 System.Web.Mobile.dll 以及它需要的任何其他标准 .NET 程序集？

我们当然会告诉他们付费开发人员而不获得源代码的危险，但我们肯定会帮助他们让这个东西运行起来，直到他们可以替换它。

编辑：事实证明，问题是由于一些影响 GAC 的磁盘损坏造成的。现在我们遇到了一些与重建 GAC 相关的其他 .NET 问题，但这是另一回事。结束这个问题。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-21T20:21:51.943

如果您将它要查找的 DLL 与应用程序本身放在同一个文件夹中，它应该先查找那里，然后再回退到 GAC 中的版本

编辑：刚刚发现[http://www.dll-files.com/](http://www.dll-files.com/)。您可以检查他们是否拥有正确版本的 DLL

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2019-01-18T13:57:44.677

将模式更改为发布 > 构建解决方案 > 更改为调试 > 再次构建解决方案。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2019-05-26T15:34:11.667

我有一些课程似乎已包含在项目中，但事实证明它们没有。重新删除/添加，现在它构建，其他项目的类库 DLL 存在并且错误消失了。

# asp.net - Telerik 报告问题

> ID：466581
> 
> 赞同：0
> 
> 时间：2009-01-21T19:14:22.267
> 
> 标签：asp.net, telerik, reporting, telerik-reporting

还有人用这个吗？我刚刚安装了它，文档隐藏在某个地方，到目前为止它做得并不好。它的工具箱选项卡丢失了，当我手动添加项目时，它们会在几秒钟后再次消失。我已经设法完成了一份报告，但是我无法找到如何让查看器显示它，而不会出现关于找不到特定路径的冗长错误。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-21T19:24:00.393

您可以在他们网站[的支持部分](http://www.telerik.com/support/documentation-and-tutorials.aspx)在线找到完整的文档和教程。如果这没有帮助，请在[论坛](http://www.telerik.com/community/forums.aspx)中提问。而且由于您拥有有效的许可证，您还可以创建[支持票](http://www.telerik.com/account/support-tickets.aspx)。

我无法评论报告组件，因为我从未使用过它。但我确实使用了 ASP.NET 控件，因此我可以告诉您，您通常会很快获得帮助（尤其是在创建支持票证时）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-22T10:02:39.947

正如 Mark 和 Martin 已经指出的那样，Telerik 支持是首屈一指的，因此您肯定会在他们的论坛/支持线程中获得帮助。我目前正在使用他们的报告产品，老实说，到目前为止我还没有遇到任何问题。我读到他们在 x64 位机器上的工具箱有问题，但它已在最新的服务包中得到解决，因此您可能需要确保首先使用最新版本。但是，将项目手动添加到工具箱肯定会起作用，如果您也遇到问题，对我来说这听起来更像是 Visual Studio 的问题。还要查看他们的[系统要求](http://www.telerik.com/products/reporting/resources/system-requirements.aspx), 不支持 VS Express 版本，因此也可能出现这种情况。通过他们的帮助，我找到了关于他们的 reportviewer 以及如何使用它的整个部分 - 看看：[http ://www.telerik.com/help/reporting/aspnetreportviewerembedding.html](http://www.telerik.com/help/reporting/aspnetreportviewerembedding.html)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-21T19:16:39.800

Telerik 提供了许多有用的控件，并且通常对它们的代码和支持非常认真。您可能会在他们网站的论坛上获得更多运气。

话虽如此，我发现他们的报告工具非常错误且无法使用。

# iphone - 如何在 iPhone 上录制和播放声音？

> ID：466585
> 
> 赞同：1
> 
> 时间：2009-01-21T19:15:24.683
> 
> 标签：iphone, objective-c, core-audio

在我的应用程序中，我有某些使用以下代码的按钮：

```
SystemSoundID beep;

CFStringRef beepPath = (CFStringRef) [NSString stringWithFormat: @"%@/SoundFile.aif", [[NSBundle mainBundle] bundlePath]];
AudioServicesCreateSystemSoundID (CFURLCreateWithFileSystemPath (NULL, beepPath, kCFURLPOSIXPathStyle, false), &beep);
CFRelease(beepPath);

AudioServicesPlaySystemSound (beep); 
```

我希望用户开始录制并能够录制应用程序发出的**任何**声音，然后能够在一定时间限制后播放录制的声音，或者有一个停止录制按钮，然后是一个“播放”按钮来播放录制的剪辑。

关于如何实现这一点的任何想法？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-24T18:43:10.113

显而易见的解决方案是将用户操作序列保存在 NSArray 中，然后回放它们以重新创建声音。我不确定您是否可以将输出声道录制到另一个文件中，如果您正在尝试这样做的话。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-04-13T11:15:24.510

使用苹果提供的 Speak Here 示例项目。为什么要重新发明轮子？

# java - Java - AWT 从 1.4 到 1.5 的差异（在 Unix 和 Windows 上工作）

> ID：466589
> 
> 赞同：1
> 
> 时间：2009-01-21T19:15:58.520
> 
> 标签：java, tomcat, awt, headless

这是参考我的问题：[java.awt.HeadlessException Applets not display](https://stackoverflow.com/questions/445049/java-awt-headlessexception-applet-not-displayed)。

系统管理员提出了下一个问题。他们在问——

“为什么 java1.5 现在需要在 tomcat 中显式导出 DISPLAY，而 java1.4 则不需要？”

那么 java1.5 发生了什么变化导致它在没有显式导出显示的情况下抛出 java.awt.HeadlessException 呢？

小程序在 java1.5 中的工作方式有变化吗？Sun 是否改变了 java1.5 中 AWT 或 Swing 的内部工作？java1.4 能够看到在 Unix 上运行的 xvfb 库但 java1.5 在没有显式导出显示的情况下无法看到的原因是什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-21T19:40:29.313

我没有全部阅读，但这里有关于 1.5 和 1.4 之间与无头相关的变化的相关信息。

*支持“无头”Java*

[http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=4281163](http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=4281163)

*Java 中的 AWT 增强功能*

[http://java.sun.com/j2se/1.5.0/docs/guide/awt/AWTChanges.html#headless](http://java.sun.com/j2se/1.5.0/docs/guide/awt/AWTChanges.html#headless)

我希望这会有所帮助。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-21T19:34:14.397

我在没有head的系统上运行tomcat，因此根本没有X服务器，也不需要导出DISPLAY。

# java - JTree 给出 ArrayIndexOutOfBoundsException？

> ID：466599
> 
> 赞同：2
> 
> 时间：2009-01-21T19:17:49.890
> 
> 标签：java, multithreading, swing, synchronization, jtree

我尝试将节点动态添加到 Java Swing[`JTree`](http://java.sun.com/j2se/1.4.2/docs/api/javax/swing/JTree.html)中，并且用户应该能够在不断添加节点的同时浏览和折叠层次结构。当我`Thread.sleep(10)`在循环中添加 a 时，它工作正常；但这是一个肮脏的黑客......

这是触发此问题的精简代码。每当我运行它并双击根节点以展开/折叠它（添加节点时），我都会得到一个`ArrayIndexOutOfBoundsException`. 当我添加一个`Thread.sleep(10)`这不会发生。我想这是一个线程问题，但我不知道如何同步？任何提示将不胜感激！

```
public static void main(String[] args) throws InterruptedException {
    final JFrame frame = new JFrame();
    frame.setSize(600, 800);
    frame.setVisible(true);

    MutableTreeNode root = new DefaultMutableTreeNode("root");
    final DefaultTreeModel model = new DefaultTreeModel(root);
    final JTree tree = new JTree(model);
    frame.add(new JScrollPane(tree));

    while (true) {
        MutableTreeNode child = new DefaultMutableTreeNode("test");
        model.insertNodeInto(child, root, root.getChildCount());
        tree.expandRow(tree.getRowCount() - 1);

        // uncommenting this to make it work
        // Thread.sleep(10);
    }
} 
```

我想将其用于打字搜索应用程序，因此（几乎）提供即时结果对我来说至关重要。

**编辑：**感谢您的快速回答！`SwingUtilities.invokeLater()`解决问题。

我现在这样做：

1.  在其中添加 100 个项目`SwingUtilities.invokeLater();`
2.  在 100 个项目之后，我运行它以便更新 GUI：

    ```
    // just wait so that all events in the queue can be processed
    SwingUtilities.invokeAndWait(new Runnable() {
        public void run() { }; 
    }); 
    ```

这样我就有了一个响应速度非常快的 GUI，而且效果很好。谢谢！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-21T19:39:00.830

tree.expandRow 需要在事件线程中完成，所以改变循环如下：

```
while (true) 
{
        MutableTreeNode child = new DefaultMutableTreeNode("test");
        model.insertNodeInto(child, root, root.getChildCount());
        final int rowToExpand = tree.getRowCount() - 1; // ? does this work ?
        SwingUtilities.invokeLater(new Runnable()
        {
           public void run()
           {
               tree.expandRow(rowToExpand);
           }
        });

} 
```

当您使用它时，您可能需要确保您的树模型正在使用的任何列表都是同步的，因此您不会在绘制线程遍历树时插入到集合中。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-21T19:58:18.000

Swing 是线程敌对的，因此在 AWT 事件 Diaptch 线程 (EDT) 中进行 Swing 操作。

无限循环是无稽之谈，所以很难提出建议。我能想到的最好的等价物是迭代发布一个偶数以再次运行代码。因为事件队列中有某些优先级，所以我不确定这是否有效。

```
public static void main(String[] args) throws InterruptedException {
    java.awt.EventQueue.invokeLater(new Runnable() { public void run() {
        runEDT();
    }});
}
private static void runEDT() {
    assert java.awt.EventQueue.isDispatchThread();

    final JFrame frame = new JFrame();
    frame.setSize(600, 800);
    frame.setVisible(true);

    final MutableTreeNode root = new DefaultMutableTreeNode("root");
    final DefaultTreeModel model = new DefaultTreeModel(root);
    final JTree tree = new JTree(model);
    frame.add(new JScrollPane(tree));
    frame.validate();

    new Runnable() { public void run() {
        final MutableTreeNode child = new DefaultMutableTreeNode("test");
        model.insertNodeInto(child, root, root.getChildCount());
        tree.expandRow(tree.getRowCount() - 1);

        final Runnable addNode = this; // Inner class confusion...
        java.awt.EventQueue.invokeLater(addNode);
    }}.run();
} 
```

（免责声明：未经编译或测试。）

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-01-21T19:27:38.810

您可能希望从[TreeModelListener](http://java.sun.com/javase/6/docs/api/javax/swing/event/TreeModelListener.html)的[`treeNodesInserted`](http://java.sun.com/javase/6/docs/api/javax/swing/event/TreeModelListener.html#treeNodesInserted(javax.swing.event.TreeModelEvent))事件中运行 tree.expandRow 命令，以便它仅在模型更新后运行。

# perl - 如何追踪 mod_perl 内存泄漏？

> ID：466601
> 
> 赞同：6
> 
> 时间：2009-01-21T19:18:36.067
> 
> 标签：perl, apache, memory, memory-leaks, mod-perl

我正在使用 mod perl 1.3.0 和 apache 1.3.41 perl 版本 5.8.6，内存大小似乎每 3 次或 4 次请求增加约 4k。我们正在运行的 Perl 脚本很简单：

```
print "Content-type: text/html\n\n";  print "baby"; 
```

然而，当我们用 apache benchmark 猛击它时，那个 apache 进程只会增长和增长。我们正在使用：

```
ab -n 100000 -c 1 http://localhost/search/search.cgi &> /dev/null 
```

在大约 20000 个请求之后，我们观察到进程大小从大约 4 MB 增长到 24。

回答以下问题：我们在 redhat enterprise 4.7 上执行此操作。它之所以被挑出来是因为我们遇到了一个静态文件，或者是一个直接的 cgi 请求并且内存没有增长。当我们使用 PerlHandler Apache::Registry 或 PerlRun，或者只是将 PerlHandler 指向一些作为处理程序的代码时，它们都会泄漏。

有谁见过这样的事情，或者知道发生了什么？

编辑：

谢谢你们的答案。我使用了 Devel::Cycle 并发现了一个漏洞，但这里的问题是我们已经剥离了代码以打印标题和语句。Perl 中的打印功能不会泄漏（我希望....）。我读过 Practical Modperl 中的内存泄漏部分，但它处理编码问题，而且除非 Perl 的打印功能有问题，否则它不是代码。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-22T10:15:55.303

你看过优秀的[Practial mod_perl](http://modperl2book.org/mp1/html/index.html)及其[关于内存泄漏的章节](http://modperl2book.org/mp1/html/14-2-6-Memory-Leakage.html)吗？

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-22T21:29:18.453

由于您正在使用打印语句，您确定您没有加载任何其他模块吗？您正在加载的其他人的代码可能存在泄漏。

当你运行这个时你会得到什么：

```
package My::Handler;

use strict;
use warnings 'all';
use Data::Dumper;

sub handler : method {
  my ($class, $r) = @_;

  print "content-type: text/html\n\n<plaintext>";
  print Dumper( \%INC );
}

1;# return true: 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-22T15:52:24.110

如果可能，请使用 Devel::Cycle 运行您的代码。**您的代码**中的某个地方可能存在内存泄漏，而不是特别是在 mod_perl 中。

一旦你找到了内存泄漏——可能有几个——修复它们。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-22T22:36:41.673

```
$VAR1 = {
    'XSLoader.pm' => '/usr/local/lib/perl5/5.8.6/i686-linux/XSLoader.pm',
    'mod_perl.pm' => '/usr/local/lib/perl5/site_perl/5.8.6/i686-linux/mod_perl.pm', 
    'warnings/register.pm' => '/usr/local/lib/perl5/5.8.6/warnings/register.pm',
    'Apache/DBI.pm' => '/usr/local/lib/perl5/site_perl/5.8.6/Apache/DBI.pm',
    'List/Util.pm' => '/usr/local/lib/perl5/5.8.6/i686-linux/List/Util.pm',
    'Test.pm' => '/home/jodonnell/fashion_2009//Test.pm', 
    'Apache/Server.pm' => '/usr/local/lib/perl5/site_perl/5.8.6/i686-linux/Apache/Server.pm', 
    'warnings.pm' => '/usr/local/lib/perl5/5.8.6/warnings.pm',
    'DBI.pm' => '/usr/local/lib/perl5/site_perl/5.8.6/i686-linux/DBI.pm',
    'Config.pm' => '/usr/local/lib/perl5/5.8.6/i686-linux/Config.pm',
    'bytes.pm' => '/usr/local/lib/perl5/5.8.6/bytes.pm',
    'Carp.pm' => '/usr/local/lib/perl5/5.8.6/Carp.pm',
    'Exporter/Heavy.pm' => '/usr/local/lib/perl5/5.8.6/Exporter/Heavy.pm',
    'Scalar/Util.pm' => '/usr/local/lib/perl5/5.8.6/i686-linux/Scalar/Util.pm',
    'vars.pm' => '/usr/local/lib/perl5/5.8.6/vars.pm',
    'Exporter.pm' => '/usr/local/lib/perl5/5.8.6/Exporter.pm',
    'strict.pm' => '/usr/local/lib/perl5/5.8.6/strict.pm',
    'Apache.pm' => '/usr/local/lib/perl5/site_perl/5.8.6/i686-linux/Apache.pm',
    'constant.pm' => '/usr/local/lib/perl5/5.8.6/constant.pm',
    'overload.pm' => '/usr/local/lib/perl5/5.8.6/overload.pm',
    'AutoLoader.pm' => '/usr/local/lib/perl5/5.8.6/AutoLoader.pm',
    'Apache/Constants.pm' => '/usr/local/lib/perl5/site_perl/5.8.6/i686-linux/Apache/Constants.pm',
    'Apache/Constants/Exports.pm' => '/usr/local/lib/perl5/site_perl/5.8.6/i686-linux/Apache/Constants/Exports.pm',
    'Apache/Connection.pm' => '/usr/local/lib/perl5/site_perl/5.8.6/i686-linux/Apache/Connection.pm',
    'DynaLoader.pm' => '/usr/local/lib/perl5/5.8.6/i686-linux/DynaLoader.pm', 
    'Data/Dumper.pm' => '/usr/local/lib/perl5/5.8.6/i686-linux/Data/Dumper.pm'
}; 
```

在我看来，这些东西都是由 apache 加载的。

# openid - OpenID 委托

> ID：466608
> 
> 赞同：3
> 
> 时间：2009-01-21T19:20:05.453
> 
> 标签：openid, delegation

我已经尝试了所有可能的选项来在我的网站上使用 openID 委托，但没有一种方法对我有用。

1.  我在 HTML 文件的头部有“链接 rel”标签。
2.  我在 HTML 文件的 head 部分中有 xrds 位置元标记。
3.  我正在为 X-XRDS-Location 和 X-YADIS-Location 设置 HTTP 标头。
4.  我在 .htaccess 文件中放置了重定向规则以发送 XRDF 文件，以防使用“Accept”标头请求该类型。

我不确定出了什么问题，但没有一个服务可以成功找到 openID 端点。验证[here](http://www.openidenabled.com/resources/openid-test/checkup/)和[here](http://www.clickpass.com/)。

我正在尝试使用[http://vinuth.com/](http://vinuth.com/)作为 openID URL 并使用上述所有方法访问该页面。我已经验证了这些 head 标签中使用的所有 URL 的正确性。我还尝试过选择性地仅使用其中一种或两种方法的排列方式。

我放在头下的标签：

```
<link rel="openid.server" href="https://pip.verisignlabs.com/server/" />
<link rel="openid.delegate" href="http://gubbi.pip.verisignlabs.com/" />
<meta http-equiv="X-XRDS-Location" content="http://pip.verisignlabs.com/user/gubbi/yadis" />
<meta http-equiv="X-YADIS-Location" content="http://pip.verisignlabs.com/user/gubbi/yadis" /> 
```

在沮丧溢出的状态下寻求帮助。:)

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-08-03T17:23:25.620

试试这个，它应该工作;）

```
<link rel="openid.server" href="http://pip.verisignlabs.com/server" />
<link rel="openid.delegate" href="http://gubbi.pip.verisignlabs.com" />
<link rel="openid2.provider" href="http://pip.verisignlabs.com/server" />
<link rel="openid2.local_id" href="http://gubbi.pip.verisignlabs.com" />
<meta http-equiv="X-XRDS-Location" content="http://pip.verisignlabs.com/user/gubbi/yadisxrds" />
<meta http-equiv="X-YADIS-Location" content="http://pip.verisignlabs.com/user/gubbi/yadisxrds" /> 
```

不需要做任何花哨的事情；）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2013-07-08T11:01:08.720

从[文档](https://pip.verisignlabs.com/faq.do#faq17)中：

```
<link rel="openid.server" href="http://pip.verisignlabs.com/server/" />
<link rel="openid.delegate" href="http://gubbi.pip.verisignlabs.com/" />
<link rel="openid2.provider" href="http://pip.verisignlabs.com/server/" />
<link rel="openid2.local_id" href="http://gubbi.pip.verisignlabs.com/" />
<meta http-equiv="X-XRDS-Location" content="http://pip.verisignlabs.com/user/gubbi/yadisxrds" />
<meta http-equiv="X-YADIS-Location" content="http://pip.verisignlabs.com/user/gubbi/yadisxrds" /> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-21T19:39:45.227

尝试将 openid.server 上的协议更改为 http 而不是 https，看看是否可行。另外，我认为您需要将 <link rel="openid2.provider" href="..." /> 设置为您用于 openid.server 的相同值，以涵盖所有基础。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-10-28T03:40:26.607

这是一个很好的测试RP：

[http://test-id.org/OP/Sreg.aspx](http://test-id.org/OP/Sreg.aspx)

失败后，单击“最近的日志”以查看 RP 尝试执行的详细信息。它可能会帮助你弄清楚你做错了什么。

我建议你拿出你所有的 YADIS 和 XRDS 东西，坚持使用简单的 HTML LINK 标签，直到你做对了。它使未知数减少。

# python - 为什么在使用 super() 时必须指定自己的类，有没有办法绕过它？

> ID：466611
> 
> 赞同：17
> 
> 时间：2009-01-21T19:20:58.293
> 
> 标签：python, multiple-inheritance

当使用 Python`super()`做方法链时，你必须明确指定你自己的类，例如：

```
class MyDecorator(Decorator):
    def decorate(self):
        super(MyDecorator, self).decorate() 
```

我必须将我的班级名称指定`MyDecorator`为`super()`. 这不是 DRY。当我现在重命名我的班级时，我将不得不重命名它两次。为什么以这种方式实施？有没有办法摆脱不得不写两次（或更多）类名的麻烦？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-01-21T19:31:04.183

在 Python 3.0 中，您可以使用`super()`相当于`super(ThisClass, self)`.

文档[在这里](http://docs.python.org/3.0/library/functions.html#super)。文档中的代码示例：

```
class C(B):
    def method(self, arg):
        super().method(arg)    
        # This does the same thing as: super(C, self).method(arg) 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-01-21T19:28:33.660

BDFL 同意。请参阅[PEP 3135 -](http://www.python.org/dev/peps/pep-3135/) Python 3.0 的新超级（和[Pep 367 -](http://www.python.org/dev/peps/pep-0367/) Python 2.6 的新超级）。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2014-08-19T07:19:10.693

这个答案是错误的，试试：

```
def _super(cls):
    setattr(cls, '_super', lambda self: super(cls, self))
    return cls

class A(object):
    def f(self):
        print 'A.f'

@_super
class B(A):
    def f(self):
        self._super().f()

@_super
class C(B):
    def f(self):
        self._super().f()

C().f() # maximum recursion error 
```

* * *

在 Python 2 中有一种使用装饰器的方法：

```
def _super(cls):
    setattr(cls, '_super', lambda self: super(cls, self))
    return cls

class A(object):
    def f(self):
        print 'A.f'

@_super
class B(A):
    def f(self):
        self._super().f()

B().f() # >>> A.f 
```

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-01-21T20:49:17.320

您还可以通过使用避免在旧版本的 python 中编写具体的类名

```
def __init__(self):
    super(self.__class__, self)
    ... 
```

# apache-flex - Flex Datagrid 到数组？

> ID：466620
> 
> 赞同：1
> 
> 时间：2009-01-21T19:23:32.217
> 
> 标签：apache-flex, arrays

我需要将 Adob​​e Flex 中的数据网格表转换为 ArrayCollection。我希望能够遍历数据网格的每一行并将其写入 Array 集合，但我能找到的访问数据网格中数据的唯一方法是 SelectedItem，这对我没有帮助。

显然，可以只复制数据网格的 dataProvider，但我的数据网格是可编辑的，我需要随时将数据网格的状态存储到数据库中。任何人都可以推荐一种方法吗？

## 非常感激

-马特

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-31T02:21:29.767

如果您的 DataGrid 是：

```
<mx:DataGrid id="someDG" dataProvider="{this.provider}" /> 
```

然后检查 this.provider 是 Array 还是 ArrayCollection。如果是 ArrayCollection，则只需通过以下方式访问它：

```
var gotIt:ArrayCollection = this.someDG.dataProvider as ArrayCollection; 
```

如果它是一个数组，那么：

```
var gotIt:ArrayCollection = new ArrayCollection(this.someDG.dataProvider as Array); 
```

希望这可以帮助。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-21T19:51:51.710

您可以通过遍历列中的字段来做到这一点，但您应该使用数据提供程序。如果您的数据状态仅存在于瞬态用户界面控件中，那么您必须将其返回到域对象中并序列化它们。大概数据网格中的每一行都是某种对象，在这种情况下，我会将您的问题重新转换为如何使数据网格中的编辑和域对象保持同步。如果您破解了它，则无需遍历数据网格。

解决同步问题的最简单方法是在数据网格中查看编辑渲染器上的事件。当网格内容更改时，您会自动更新域对象。

您在网格中的就地编辑器是什么？

# .net - 序列化如何在 .Net 中工作

> ID：466625
> 
> 赞同：6
> 
> 时间：2009-01-21T19:26:04.443
> 
> 标签：.net, serialization, properties

我觉得这是一个转贴，但我似乎找不到任何关于它的好信息。我只是想知道序列化实际上是如何工作的（实际上是反序列化）。我想知道的是，如果说我有一个实际上不受私有字段支持的属性；IE：

```
public string SomeProp {
   get {
      return GetValue("SomePropKey");
   }
   set{
      SetValue("SomePropKey", value);
   }
} 
```

当我反序列化时，setter 会被调用吗？getter 在序列化时被调用，因为当我序列化对象时，正确的值被写入输出流。我知道这似乎是一个奇怪的情况，但到底发生了什么？或者我只是把这个复杂化了......

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-01-21T19:30:50.050

这完全取决于您用于序列化的机制。

如果您使用的是 XmlSerialization，那么是的，setter 会被调用。

如果您正在使用数据合同序列化（DataContractSerialization），那么如果您将 DataMember 属性应用于属性（而不是其支持字段），则将调用 getter/setter。

如果您使用 .NET 中的原始序列化机制（IFormatter 实现），那么这种情况是不可能的，因为它只会序列化存储在字段中的值。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-21T19:31:28.833

您是在谈论 XML 序列化还是“常规”序列化（soap / 二进制），因为-afaik- 这两种序列化技术不同。

AFAIK，如果您使用 BinaryFormatter 或 SoapFormatter，则字段是序列化/反序列化的，而不是属性。
在反序列化时，我相信使用了具有 SerializationInfo 和 StreamingContext 参数的特殊 2-arg 构造函数。

但是，没有什么能阻止您通过实现 ISerializable 接口来控制序列化过程。然后，如果您希望使用您的属性设置您的值，我认为您可以完美地做到这一点。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-21T19:35:00.917

我知道这不是您问题的直接答案，您已经得到了您正在寻找的答案。但我不想隐瞒这一点。[您可以使用Reflector](http://www.red-gate.com/products/reflector/)查看基类库源代码。这是了解更多关于 .net 框架内部结构和拓宽知识的绝佳方式。

# process - 如何从 Web 应用程序控制进程？

> ID：466628
> 
> 赞同：-1
> 
> 时间：2009-01-21T19:26:17.097
> 
> 标签：process

我想通过 Web 应用程序与正在运行的进程进行交互（例如查询信息和更改设置）。我将如何做到这一点？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-21T19:39:48.503

从 1000 英尺的角度来看，您可以从 Web 服务可以访问的正在运行的应用程序中公开一个入口点。对于 ASP.NET/Windows 服务（或任何其他在 Windows 机器上运行的 .net 应用程序），您可以在 Windows 服务中创建一个远程对象，ASP.NET Web 服务可以调用该对象并与之交互。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-21T19:55:21.983

如果我要自己做这件事，我会使用套接字为应用程序公开一个 API。如果你想进入真正疯狂的东西，你可以在你的应用程序中公开一个 SOAP 接口——然后在 C# 甚至 PHP 中集成应用程序的控制会更容易。

我可以更具体，但需要知道

*   您正在运行什么操作系统
*   您为网页使用的服务器端语言
*   你有能力修改你想要控制的应用程序吗？

# wpf - 在 XAML WPF 中处理来自业务层的事件

> ID：466631
> 
> 赞同：0
> 
> 时间：2009-01-21T19:26:38.657
> 
> 标签：wpf, events

我对 WPF 很陌生，我有一个非常基本的 WPF 问题：

假设我们有一个自定义 dll，其中包含一些触发诸如 ModemIsConnected 之类的事件的业务逻辑。在 UI 端 (.xaml) 有一个标签，一旦触发该事件，它的值就会更改为 OK。我想将事件处理部分（更改标签的状态和其他小的 UI 调整）卸载给设计人员。是否可以在不创建代码隐藏的情况下处理 xaml 中的事件？

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-21T19:38:47.430

简单的答案是我不相信这是可能的。毫无疑问，您可以使用数据绑定等做一些事情，但是您已经超出了您希望设计师做的事情。

几个选项：

1.  教设计人员编写事件处理程序和调用故事板的最低限度。通过智能感知和 Blend / Visual Studio 之间的良好交互，您可以让某人快速启动并运行。

2.  让他们为您需要的任何“小的 UI 调整”创建故事板动画，然后您可以将它们连接到事件并仅用 3-5 行代码更改您的标签文本。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-21T19:56:49.373

您可以让设计人员完成 UI 方面的工作，而无需他们动手编写代码。您可以创建一个实现[IPropertyNotifyChanged](http://msdn.microsoft.com/en-us/library/ms743695.aspx)的​​类，该类具有一个随着调制解调器状态变化而变化的布尔属性。然后，设计人员可以绑定到该属性，并从 XAML 中执行花哨的触发器、状态更改等，并且绑定系统将处理“告诉”UI 值已更改。

# c# - 如何从 Process.GetCurrentProcess().Threads 获取托管线程

> ID：466632
> 
> 赞同：1
> 
> 时间：2009-01-21T19:27:18.310
> 
> 标签：c#, multithreading

我可以从 Process.GetCurrentProcess().Threads 中获取正在运行的线程列表，但我需要知道以 Thread.Start 开头的线程的托管名称。它不是 ProcessThread 对象的属性。有没有办法从 ProcessThread 获取这些信息？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-21T19:37:50.893

虽然 CLR 为每个托管线程生成一个 OS 线程，但它并不是强制的。我的意思是，没有标准保证操作系统线程和托管线程之间应该存在一对一的映射。

引用 MSDN：

> 操作系统 ThreadId 与托管线程没有固定关系，因为非托管主机可以控制托管线程和非托管线程之间的关系。具体来说，复杂的主机可以使用 CLR Hosting API 针对同一个操作系统线程调度许多托管线程，或者在不同操作系统线程之间移动托管线程。

# javascript - JQuery 异步回发问题，我该如何解决？

> ID：466637
> 
> 赞同：1
> 
> 时间：2009-01-21T19:28:30.057
> 
> 标签：javascript, jquery, asp.net-mvc

我有以下 JQuery 代码，它执行类似于 Stackoverflow 的类似功能，其中用户单击评论链接并显示评论，或者在这种情况下回复成员的状态更新，通常它工作得很好，除非成员发布新的状态更新使用 ASP.net MVC 中的 ajax 异步回发更新状态更新列表。

发生的情况是，如果您单击列表中的新项目，它会将它们带到新页面，而不是执行 JQuery 应该执行的操作。

```
<script type="text/javascript">

    $(function() {
        $("a[id ^='commentLink-']").click(function() {
            match = this.id.match(/commentLink-(\d+)/);
            container = $("div#commentContainer-" + match[1])
            container.toggle();

            if (container.is(":visible")) {
                container.load($(this).attr("href"));
            } else {
                container.html("Loading...");
            }
            return false; //Prevent default action
        });
    });
</script> 
```

**注意：**我认为导致它的原因是列表中的新项目实际上不在页面上，因为列表是通过 ajax 更新的，因此在刷新页面之前新的 html 不存在。

**更新**好吧，我将如何使用 Paolo Bergantino 在他的回答中谈到的这个实时/事件功能来触发 ASP.net MVC ActionResult？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-21T20:01:37.057

查看[`Events/live`](http://docs.jquery.com/Events/live#typefn)jQuery 1.3 中的新功能

> 将处理程序绑定到所有当前和未来匹配元素的事件（如单击）。

因此，当您添加新项目时，jQuery 应该使用 this 添加 click 事件。

如果出于某种奇怪的原因您不想升级到 jQuery 1.3，您可以查看该[`livequery`](http://docs.jquery.com/Plugins/livequery/livequery)插件。

**编辑以响应更新**：

实际使用的代码`.live`是这样的：

```
$(function() {
    $("a[id ^='commentLink-']").live('click', function(event) {
        match = this.id.match(/commentLink-(\d+)/);
        container = $("div#commentContainer-" + match[1])
        container.toggle();

        if (container.is(":visible")) {
            container.load($(this).attr("href"));
        } else {
            container.html("Loading...");
        }
        event.preventDefault();
    });
}); 
```

所做的更改主要在第二行，其中

```
$("a[id ^='commentLink-']").click(function() { 
```

被替换为

```
$("a[id ^='commentLink-']").live('click', function(event) { 
```

我现在还收到`event`要使用的参数，`event.preventDefault();`这是建议您通过 jQuery 停止事件的方式。但是，如果`return false;`成功了，您可以保留它。

我还没有使用过`.live`，但我认为这应该可以解决问题。不过，请确保在尝试之前在服务器中安装了 jQuery 1.3。:)

# c# - 类访问问题

> ID：466650
> 
> 赞同：1
> 
> 时间：2009-01-21T19:32:19.063
> 
> 标签：c#, singleton

我知道这应该很简单，我应该知道，但它暂时让我难以理解。

我正在使用单例模式来帮助记录内容。然而，日志记录只发生在一个类中，单例基本上是一个布尔值的观察者，它打开和关闭日志文件。因为我不希望文件多次打开或关闭多次，所以我使用单例模式。但是，我不希望它成为一个全局值，而且我肯定不希望其他类，即使在访问它的包内也是如此。我怎样才能使它只有这一类使用它？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-21T19:52:21.473

使其成为您要在其中使用它的类中的私有类。另外，考虑将其设为静态类。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-21T19:36:47.387

如果你不希望它被其他类访问，为什么它首先是一个 Singleton 呢？只需将其设为私有的实例类并保留对它的引用。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-21T19:43:47.980

将记录到文件的类设为单例类，或将其设为单例类中的变量。布尔字段应该是你的单例的私有字段，没有人可以通过这种方式访问​​它。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-21T19:50:36.983

一个 - 更多左字段 - 解决方案可能是在记录器中采用状态模式。当设置了记录标志时，实现会翻转到打开文件并记录到它的那个。当它被重置时，实现会失败，关闭文件并且不记录。设置和重新设置不再是一个布尔标志，而是一种改变状态的方法。

# c# - ï»¿ 字符附加到每个文件的开头

> ID：466653
> 
> 赞同：9
> 
> 时间：2009-01-21T19:33:12.433
> 
> 标签：c#, asp.net, encoding, httphandler, byte-order-mark

我已经下载了一个 HttpHandler 类，它将 JS 文件连接到一个文件中，并且它不断`ï»¿`在它连接的每个文件的开头附加字符。

关于造成这种情况的任何想法？是不是一旦处理过的文件被写入缓存，缓存就是这样存储/呈现它的？

任何输入将不胜感激。

```
using System;
using System.Net;
using System.IO;
using System.IO.Compression;
using System.Text;
using System.Configuration;
using System.Web;

public class HttpCombiner : IHttpHandler {

    private const bool DO_GZIP = false;
    private readonly static TimeSpan CACHE_DURATION = TimeSpan.FromDays(30);

    public void ProcessRequest (HttpContext context) {

        HttpRequest request = context.Request;

        // Read setName, contentType and version. All are required. They are
        // used as cache key
        string setName = request["s"] ?? string.Empty;
        string contentType = request["t"] ?? string.Empty;
        string version = request["v"] ?? string.Empty;

        // Decide if browser supports compressed response
        bool isCompressed = DO_GZIP && this.CanGZip(context.Request);

        // Response is written as UTF8 encoding. If you are using languages
        // like Arabic, you should change this to proper encoding 
        UTF8Encoding encoding = new UTF8Encoding(false);

        // If the set has already been cached, write the response directly
        // from cache. Otherwise generate the response and cache it
        if (!this.WriteFromCache(context, setName, version, isCompressed,
            contentType))
        {
            using (MemoryStream memoryStream = new MemoryStream(5000))
            {
                // Decide regular stream or GZipStream based on whether the
                // response can be cached or not
                using (Stream writer = isCompressed
                    ? (Stream)(new GZipStream(memoryStream,
                        CompressionMode.Compress))
                    : memoryStream)
                {
                    // Load the files defined in <appSettings> and process
                    // each file
                    string setDefinition = System.Configuration
                        .ConfigurationManager.AppSettings[setName] ?? "";
                    string[] fileNames = setDefinition.Split(
                        new char[] { ',' }, 
                        StringSplitOptions.RemoveEmptyEntries);

                    foreach (string fileName in fileNames)
                    {
                        byte[] fileBytes = this.GetFileBytes(
                            context, fileName.Trim(), encoding);
                        writer.Write(fileBytes, 0, fileBytes.Length);
                    }

                    writer.Close();
                }

                // Cache the combined response so that it can be directly
                // written in subsequent calls 
                byte[] responseBytes = memoryStream.ToArray();
                context.Cache.Insert(
                    GetCacheKey(setName, version, isCompressed),
                    responseBytes, null,
                    System.Web.Caching.Cache.NoAbsoluteExpiration,
                    CACHE_DURATION);

                // Generate the response
                this.WriteBytes(responseBytes, context, isCompressed,
                    contentType);
            }
        }
    }

    private byte[] GetFileBytes(HttpContext context, string virtualPath,
        Encoding encoding)
    {
        if (virtualPath.StartsWith("http://",
            StringComparison.InvariantCultureIgnoreCase))
        {
            using (WebClient client = new WebClient())
            {
                return client.DownloadData(virtualPath);
            }
        }
        else
        {
            string physicalPath = context.Server.MapPath(virtualPath);
            byte[] bytes = File.ReadAllBytes(physicalPath);
            // TODO: Convert unicode files to specified encoding.
            // For now, assuming files are either ASCII or UTF8
            return bytes;
        }
    }

    private bool WriteFromCache(HttpContext context, string setName,
        string version, bool isCompressed, string contentType)
    {
        byte[] responseBytes = context.Cache[GetCacheKey(setName, version,
            isCompressed)] as byte[];

        if (null == responseBytes || 0 == responseBytes.Length) return false;

        this.WriteBytes(responseBytes, context, isCompressed, contentType);
        return true;
    }

    private void WriteBytes(byte[] bytes, HttpContext context, 
        bool isCompressed, string contentType)
    {
        HttpResponse response = context.Response;

        response.AppendHeader("Content-Length", bytes.Length.ToString());
        response.ContentType = contentType;
        if (isCompressed)
            response.AppendHeader("Content-Encoding", "gzip");

        context.Response.Cache.SetCacheability(HttpCacheability.Public);
        context.Response.Cache.SetExpires(DateTime.Now.Add(CACHE_DURATION));
        context.Response.Cache.SetMaxAge(CACHE_DURATION);
        context.Response.Cache.AppendCacheExtension(
            "must-revalidate, proxy-revalidate");

        response.OutputStream.Write(bytes, 0, bytes.Length);
        response.Flush();
    }

    private bool CanGZip(HttpRequest request)
    {
        string acceptEncoding = request.Headers["Accept-Encoding"];
        if (!string.IsNullOrEmpty(acceptEncoding) &&
             (acceptEncoding.Contains("gzip")
                 || acceptEncoding.Contains("deflate")))
            return true;
        return false;
    }

    private string GetCacheKey(string setName, string version,
        bool isCompressed)
    {
        return "HttpCombiner." + setName + "." + version + "." + isCompressed;
    }

    public bool IsReusable
    {
        get { return true; }
    }
} 
```

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-01-21T19:35:54.753

ï»¿ 字符是[UTF BOM 标记](http://en.wikipedia.org/wiki/Byte-order_mark)。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-01-21T19:36:52.660

它的 UTF[字节顺序标记 (BOM)](http://en.wikipedia.org/wiki/Byte_Order_Mark)。

它位于每个文件的开头，但您的编辑器会在那里忽略它们。当连接起来时，它们最终位于中间，所以你会看到它们。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-01-21T19:36:41.147

我认为这是 UTF-8 编码文件的[字节顺序标记 (BOM)](http://en.wikipedia.org/wiki/Byte_Order_Mark)。此标记允许确定文件以何种编码存储。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-01-21T21:03:47.010

好的，我已经调试了你的代码。

当从磁盘读取文件时，BOM 标记出现在源流中：

```
byte[] bytes = File.ReadAllBytes(physicalPath);
// TODO: Convert unicode files to specified encoding. For now, assuming
// files are either ASCII or UTF8 
```

如果您正确阅读文件，您可以摆脱这些标记。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-09-03T11:55:06.917

您没有发布实际的解决方案是什么。这是我的灵魂解决方案。在将文件读入内存的那一行，我发现了一种删除 BOM 的奇怪方法：

```
byte[] bytes = File.ReadAllBytes(physicalPath);
String ss = new StreamReader(new MemoryStream(bytes), true).ReadToEnd();
byte[] b = StrToByteArray(ss);
return b; 
```

你还需要这个功能：

```
public static byte[] StrToByteArray(string str)
{
    System.Text.ASCIIEncoding encoding = new System.Text.ASCIIEncoding();
    return encoding.GetBytes(str);
} 
```

尼泰克

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2010-02-17T21:51:44.533

如果您将文件的内容保存在字符串中，.Trim() 将非常方便地删除“BOM”。

您可能无法做到这一点，或者您可能*想要*文件末尾的空格，但这当然是一种选择。

对于 .js 空格并不重要，所以这可以工作。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-01-21T19:38:10.427

检查您的 js 文件是如何编码的，并在执行读取和连接的代码中提供相同的编码。这两个字符通常指向 unicode。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-01-21T19:45:14.670

这些字符是 UTF-8 BOM。它们似乎不是来自压缩流。它们更有可能被插入到响应流中，所以我建议在使用它之前清除响应：

```
context.Response.Clear(); 
```

# wpf - 为什么在 WPF 中使用抽象类进行 DataBinding 与使用接口不同？

> ID：466662
> 
> 赞同：1
> 
> 时间：2009-01-21T19:35:11.197
> 
> 标签：wpf, data-binding, inheritance, datatemplate

众所周知，我们不能将 DataTemplates 与接口一起使用，但显然（[老问题](https://stackoverflow.com/questions/327984/wpf-databinding-to-interface-and-not-actual-object-casting-possible)）我们可以使用抽象类。

为什么？

多重继承参数也适用于抽象类......

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-21T19:42:23.553

您提到的旧问题仍然将数据模板应用于具体类。如果您尝试将数据模板应用于抽象类，您将遇到同样的问题。没有什么能阻止您使用接口 - 您只需要将数据模板与该接口的具体实现相关联。

问题本质上是 WPF 使用运行时类型来解析模板。

# iframe - 将 iframe 设置为远程内容的内容高度

> ID：466672
> 
> 赞同：7
> 
> 时间：2009-01-21T19:38:09.053
> 
> 标签：iframe, height, xss

如何使 iframe 适合 100% 的内容（使用 JavaScript）的问题已经在论坛上得到解答……*仅适用于显示来自同一域的内容的 iframe*。

我的问题：当 iframe src 属性用于包含框架的页面域之外的页面时，是否可以调整 iframe 的大小以适应内容？围绕跨站点脚本的浏览器安全功能阻止我访问 iframe 的文档对象。

我正在寻找任何创造性的解决方案。我的一个想法是以某种方式检测滚动条在 iframe 上可见，并逐渐增加高度直到它们不可见。不幸的是，我也找不到任何检测可见滚动条的方法。想法？

请注意，我正在寻找客户端解决方案。

回应：

* * *

## 戴夫

问题仍然存在——我不提前知道远程文档的高度，所以我无法从数据库或查询字符串值中设置它。

* * *

## 杜软

CSS 中 iframe 上的 100% 不会将其设置为iframe*内*内容的 100%，而是相对于页面或包含元素（即 div 或其他内容）。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-05T13:35:45.390

> 当 iframe src 属性适用于包含框架的页面域之外的页面时，是否可以调整 iframe 的大小以适应内容？

可以绕过跨站点限制并将 iframe 设置为其内容的高度，但让它工作可能有点尴尬。

该解决方案涉及通过让 iframe 内容本身 iframe 与父页面在同一服务器上的页面来解决安全模型，它可以与之通信。我在此之前已经回答了一个与此类似的问题[，](https://stackoverflow.com/questions/153152/resizing-an-iframe-based-on-content/362564#362564)其中详细介绍了所有设置的来龙去脉。

对所描述方法的警告是，您必须有方法将 iframe 内容获取到自身 iframe 父服务器上的页面。当 iframed 内容作为站点之间商定的合作伙伴关系的一部分存在时，这通常是可以实现的，但 YMMV。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-11-04T18:44:15.050

（我对[类似问题的回答](https://stackoverflow.com/q/4058217/445073)）

由于浏览器的安全模型，如果不对正在 iframe 的页面进行一些控制，就不可能**做到这一点。**如果可能，那将是一个安全问题，必须加以解决。

尽管在嵌入页面时让嵌入站点知道第三方网页的高度似乎无害，但这可能会将浏览器用户想要保密的信息泄露给嵌入站点。例如，[http://www.facebook.com/](http://www.facebook.com/)根据您是否登录而呈现不同，所以如果我的网站可以计算出高度，`<iframe src="http://www.facebook.com/">`那么我可以计算出您是否是 facebook 用户，某事你可能不想让我知道。

信息泄漏类似于浏览器供应商必须堵塞的臭名昭著的[CSS 历史泄漏。](http://blog.mozilla.com/security/2010/03/31/plugging-the-css-history-leak/)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-21T19:52:51.253

听起来您正在尝试解决出于充分理由而实施的安全功能...

调整大小是否必须通过脚本？您可以重定向到 iframe 大小取自查询字符串、数据库或配置文件等的页面。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-11-02T12:58:02.437

这是理论上的，因为我没有测试过：

> > `file_get_content()`1) PHP 使用或使用 CURL将远程页面保存到本地 html 文件中 。2) Javascript 将本地文件加载到 iframe - 它现在是本地的，安全问题不适用。

如果有 javascript vars 或 Session vars（无法从远程内容中提取），您至少可以使用此技术查询本地文件的文档高度，相应地设置 iframe，然后将远程 URL 加载到调整大小的 iframe 中。

Cavat：您无法知道远程页面中页面更改的 URL，因此您只能在第一页上使用此技术。如果远程页面的高度都相同，这没问题。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-10-04T01:04:23.573

不是最好的解决方案，但您可以尝试：

编写 iframe 的 javascript，在 iframe 应用程序中将 url #h700 中的当前高度设置为 700px 等；然后使用循环在主机站点“在 javascript”中侦听该更改以读取 src="url#h700" 并以此设置 iframe 的高度。

# .net - 调整图像大小从右下角裁剪一个像素

> ID：466679
> 
> 赞同：4
> 
> 时间：2009-01-21T19:39:38.770
> 
> 标签：.net, gdi+

我发现当使用 System.Drawing.Graphics 类调整图像大小时，结果图像从右边框和下边框丢失了一个像素。这是我的代码中某处的错误或 .Net 问题？测试代码：

```
public static void Resize(string imagePath,int width) {
  InterpolationMode[] interpolationModes = new InterpolationMode[]{InterpolationMode.Bicubic, InterpolationMode.Bilinear, InterpolationMode.Default, InterpolationMode.High,
    InterpolationMode.HighQualityBicubic, InterpolationMode.HighQualityBilinear, InterpolationMode.Low, InterpolationMode.NearestNeighbor};
  SmoothingMode[] smoothingModes = new SmoothingMode[]{SmoothingMode.AntiAlias, SmoothingMode.Default, SmoothingMode.HighQuality, SmoothingMode.HighSpeed,
    SmoothingMode.None};

  for(int i = 0; i < interpolationModes.Length; i++) {
    for(int j = 0; j < smoothingModes.Length; j++) {
      Resize(imagePath, width, interpolationModes[i], smoothingModes[j]);
    }
  }
}

public static void Resize(string imagePath,int width, InterpolationMode interpolationMode, SmoothingMode smoothingMode) {
  Image imgPhoto = Image.FromFile(imagePath);
  float percent = (float)width / (float)imgPhoto.Width;
  int height = (int)(imgPhoto.Height * percent);

  Bitmap bmPhoto = new Bitmap(width, height, PixelFormat.Format24bppRgb);
  bmPhoto.SetResolution(imgPhoto.HorizontalResolution, imgPhoto.VerticalResolution);

  Graphics grPhoto = Graphics.FromImage(bmPhoto);
  grPhoto.InterpolationMode = interpolationMode;
  grPhoto.SmoothingMode = smoothingMode;

  grPhoto.DrawImage(imgPhoto,
  new Rectangle(0, 0, width, height),
  new Rectangle(0, 0, imgPhoto.Width, imgPhoto.Height ),
  GraphicsUnit.Pixel);

  grPhoto.Dispose();

  string fileName = Path.GetFileName(imagePath);
  string path = Path.GetDirectoryName(imagePath)+"\\resized";

  if (!Directory.Exists(path))
    Directory.CreateDirectory(path);

  bmPhoto.Save(String.Format("{0}\\{1}_{2}_{3}", path, interpolationMode.ToString(), smoothingMode.ToString(),fileName));
} 
```

源图： [源图http://img110.imageshack.us/img110/4876/sampleaa2.jpg](http://img110.imageshack.us/img110/4876/sampleaa2.jpg)

结果： [结果 http://img110.imageshack.us/img110/2050/resizedsamplesy4.png](http://img110.imageshack.us/img110/2050/resizedsamplesy4.png)

PS 我已经尝试过所有现有的 InterpolationMode 和 SmoothingMode 组合。他们都没有给出可接受的结果。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-21T19:58:30.527

这是 .NET 图形中的一个错误，也是一个非常烦人的错误。这不是舍入误差或算法问题。如果您创建一个 100x100 位图，然后使用 100x100 矩形作为参数之一调用 DrawRectangle，您会看到相同问题的变体：您将看不到绘制矩形的底部或右侧。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2011-11-29T14:35:52.037

无耻地从[这个问题](https://stackoverflow.com/questions/1890605/ghost-borders-ringing-when-resizing-in-gdi)中提出答案，我发现这可以解决它：

```
using (ImageAttributes wrapMode = new ImageAttributes())
{
    wrapMode.SetWrapMode(WrapMode.TileFlipXY);
    g.DrawImage(input, rect, 0, 0, input.Width, input.Height, GraphicsUnit.Pixel, wrapMode);
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-21T19:47:40.453

如果您的线条在原始线条中只有 1 像素宽，则会发生这种情况。当它调整大小时，算法会导致右侧和底部的边框出现“修剪”，而实际上，算法会根据像素色调/颜色/饱和度/位置放置一定程度的重要性。它认为内部单元格优先并且边界丢失。Adobe Photoshop 和 Corel PaintShop Pro 等各种图形应用程序为您提供各种调整大小选项 [插值模式]，以帮助避免此类情况。您需要将 interpolationMode 更改为不同的东西。我有一段时间没有使用 GDI+，所以我忘记了可用的模式是什么。尝试每种模式，看看哪种模式最适合您。

我可能会这样做以保证边界的完整性：

*   去掉原始图片的边框
*   调整图片剩余部分的大小
*   将边框添加回生成的图片

这样，您的边框将保持不变 - 调整大小的图像周围有一个红色像素。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-21T19:46:54.870

鉴于您按比例缩放的百分比并不总是会产生积分结果，这将导致舍入误差，从而产生边界。

您将必须确定任何维度的舍入是否会添加像素边框（您可以检查舍入）。如果是这样，那么您可以创建一个新的位图，然后复制不包括边框的图片部分。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-05-18T18:11:10.750

在我[的开源图像大小调整库](http://imageresizing.net)中，我多年来一直在努力解决这个问题。

我找到的最佳解决方案是使用 HighQualityBicubic、WrapMode.TileFlipXY，并使用 DrawImage 的平行四边形重载。结果仍然显示外部像素略有下降，但没有修剪任何东西。通过将图形对象的背景颜色设置为接近外边缘颜色的颜色，您甚至可以最大限度地减少该问题。

来源摘录：

```
g.InterpolationMode = System.Drawing.Drawing2D.InterpolationMode.HighQualityBicubic;
g.SmoothingMode = System.Drawing.Drawing2D.SmoothingMode.HighQuality;
g.PixelOffsetMode = System.Drawing.Drawing2D.PixelOffsetMode.HighQuality;
g.CompositingQuality = System.Drawing.Drawing2D.CompositingQuality.HighQuality;
g.CompositingMode = CompositingMode.SourceOver;

s.copyAttibutes.SetWrapMode(WrapMode.TileFlipXY);

s.destGraphics.DrawImage(s.sourceBitmap, PolygonMath.getParallelogram(s.layout["image"]), s.copyRect, GraphicsUnit.Pixel, s.copyAttibutes); 
```

如果这没有帮助，我建议禁用 SetResolution 调用，因为这是最后剩下的变量。

# python - 如何在 Python 中返回系统信息？

> ID：466684
> 
> 赞同：25
> 
> 时间：2009-01-21T19:40:34.663
> 
> 标签：python, operating-system

使用 Python，如何以通用方式返回 CPU 使用率、内存使用率（空闲、已使用等）、进程计数等信息，以便在 Linux、Windows、BSD 等上运行相同的代码？

或者，仅当该操作系统确实是操作环境时，如何才能在所有上述系统上返回此信息，并且该操作系统特定于该操作系统的代码正在运行？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-01-21T22:25:02.057

关于跨平台：您最好的选择可能是编写特定于平台的代码，然后有条件地导入它。例如

```
import sys
if sys.platform == 'win32':
  import win32_sysinfo as sysinfo
elif sys.platform == 'darwin':
  import mac_sysinfo as sysinfo
elif 'linux' in sys.platform:
  import linux_sysinfo as sysinfo
#etc

print 'Memory available:', sysinfo.memory_available() 
```

对于具体的资源，Anthony 指出你可以`/proc`在 linux 下访问。对于 Windows，您可以在[Microsoft Script Repository](http://www.microsoft.com/technet/scriptcenter/scripts/python/default.mspx?mfr=true)中四处寻找。我不知道在哪里可以获得有关 Mac 的此类信息，但我可以想到一个很棒的网站，您可以在其中询问:-)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-21T20:09:07.167

在 Linux 环境中，您可以从 /proc 文件系统中读取。

```
~$ cat /proc/meminfo
MemTotal:      2076816 kB
MemFree:        130284 kB
Buffers:        192664 kB
Cached:        1482760 kB
SwapCached:          0 kB
Active:         206584 kB
Inactive:      1528608 kB
HighTotal:     1179484 kB
HighFree:       120768 kB
LowTotal:       897332 kB
LowFree:          9516 kB
SwapTotal:     2650684 kB
SwapFree:      2650632 kB
Dirty:              64 kB
Writeback:          12 kB
AnonPages:       59668 kB
Mapped:          22008 kB
Slab:           200744 kB
PageTables:       1220 kB
NFS_Unstable:        0 kB
Bounce:              0 kB
CommitLimit:   3689092 kB
Committed_AS:   263892 kB
VmallocTotal:   114680 kB
VmallocUsed:      3604 kB
VmallocChunk:   110752 kB 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2015-03-12T19:03:19.820

[psutil](https://github.com/giampaolo/psutil)应该提供你需要的东西：

> [...] 跨平台库，用于检索有关正在运行的进程和系统利用率（CPU、内存、磁盘、网络）的信息 [...]
> 
> [...] 支持 Linux、Windows、OSX、FreeBSD 和 Sun Solaris，包括 32 位和 64 位架构 [...]

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-21T20:25:02.423

我推荐平台模块：

[http://doc.astro-wise.org/platform.html](http://doc.astro-wise.org/platform.html)

[http://docs.python.org/library/platform.html](http://docs.python.org/library/platform.html)

[http://www.doughellmann.com/PyMOTW/platform/index.html](http://www.doughellmann.com/PyMOTW/platform/index.html)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-21T20:07:49.117

看起来您想要获得比标准 Python 库提供的更多信息。如果我是你，我会下载 'ps' 或 'top' 的源代码，或者相同的 Gnome/KDE 版本，或者任何数量的系统监控/绘图程序，它们更有可能拥有所有必要的 Unix 交叉平台位，看看他们做了什么，然后使用 ctypes 进行必要的本机调用。

检测平台很简单。例如，对于 ctypes，您可能会尝试加载 libc.so，如果引发异常，请尝试加载“msvcrt.dll”等等。更不用说简单地使用 os.name 检查操作系统的名称。然后只需将对新的跨平台 API 的调用委托给适当的特定于平台（抱歉）的实现。

完成后，不要忘记将生成的包上传到 pypi。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-21T19:53:19.460

看看[os 模块](http://docs.python.org/library/os.html)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-21T20:58:19.797

有一个[PSI](http://www.psychofx.com/psi/)（Python 系统信息）项目就是为了这个目的，但它们还没有涵盖 Windows。

您可能可以[像这样](http://code.activestate.com/recipes/511491/)使用 PSI 和 recpies并创建一个满足您需求的基本库。

# sql-server-2008 - 有任何可用的 SQL Server 2008 数据库更改管理 (MIgrations) 工具吗？

> ID：466689
> 
> 赞同：3
> 
> 时间：2009-01-21T19:42:57.297
> 
> 标签：sql-server-2008, nant, tarantino

我们在 Nant 构建脚本中运行[Tarantino](http://code.google.com/p/tarantino/wiki/DatabaseChangeManagement)，但我们正在获得一些新硬件并利用机会升级到 SQL Server 2008。不幸的是，Tarantino 不能与 SQL 2K8 一起使用，所以我正在寻找替代方案。

有任何想法吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-21T20:07:56.387

[Migrator.net](http://code.google.com/p/migratordotnet/)是我在 SQL 2008 中使用的工具。它还具有 nant 脚本功能。我建议使用主干版本，而不是 0.7 版本，因为它有一些好的但尚未发布的更改。

[本](http://flux88.com/blog/net-database-migration-tool-roundup/)综述还有其他选择。这里[几乎没有](https://stackoverflow.com/questions/313/-net-migrations-engine) [其他](https://stackoverflow.com/questions/8033/database-migration-library-for-net)类似的问题。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-21T20:36:42.867

有很多非常好的工具 - 有些需要采用数据库更改管理流程（如[DBGhost](http://www.dbghost.com/)），而另一些则限制较少，但需要您做更多的工作（和努力），例如 Red-Gate 的[SQL Packager](http://www.red-gate.com/products/SQL_Packager/index.htm)，它允许您可以将数据库创建和更改脚本打包到 .NET 项目和/或独立的 EXE 文件中。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-09-18T14:49:40.977

我相信 Tarantino 现在已经修复，可以在 2009 年 3 月使用 SQL2008

[http://code.google.com/p/tarantino/source/list](http://code.google.com/p/tarantino/source/list)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-05-28T10:57:55.717

尝试来自 SVN 的[最新版本](http://code.google.com/p/tarantino/source/browse/trunk/LatestVersion/Tarantino.zip)的 Tarantino，它适用于 SQL Server 2008。不幸的是，他们在下载部分发布了一个过时的版本。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-01-24T04:01:12.430

您可能还想看看[RoundhouseE](http://projectroundhouse.org)。

# python - 通过 pypdf 在 pdf 文件上读取/写入 xmp 元数据

> ID：466692
> 
> 赞同：6
> 
> 时间：2009-01-21T19:43:46.857
> 
> 标签：python, pdf, metadata, xmp, pypdf

我可以使用以下代码通过 pyPdf 读取 xmp 元数据：

```
a = pyPdf.PdfFileReader(open(self.fileName))
b = a.getXmpMetadata()                      
c = b.pdf_keywords 
```

但是：这是最好的方法吗？

如果我不使用 pdf_keywords 属性？

有没有办法用 pyPdf 设置这些元数据？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-23T12:32:54.807

据我所知，这是最好的方法——而且没有办法用 pyPDF 更改元数据。

# .net - WPF 路由命令是解决问题还是使问题变得更糟？

> ID：466699
> 
> 赞同：5
> 
> 时间：2009-01-21T19:45:42.813
> 
> 标签：.net, wpf, routed-commands

据我了解，命令模式的目标是帮助将 UI 交互与应用程序逻辑分开。使用正确实现的命令，单击“打印”菜单项可能会导致如下交互链：

```
(button) ---click executes command----> (command) ---calls Print() in app logic ---> (logic) 
```

这鼓励您将 UI 与应用程序逻辑分开。

我一直在研究 WPF 命令，并且在大多数情况下，我看到了它们是如何实现这种模式的。然而，我觉得在某种程度上他们已经*复杂化*了命令模式并设法以这样一种方式实现它，以至于你不鼓励将 UI 与应用程序逻辑分离。

例如，考虑这个简单的 WPF 窗口，它有一个用于将文本粘贴到文本框中的按钮：

```
<Window x:Class="WpfApplication1.Window1"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    Title="Window1" Height="300" Width="300">
    <Window.CommandBindings>
        <CommandBinding Command="ApplicationCommands.Paste"
                        Executed="CommandBinding_Executed"/>
    </Window.CommandBindings>
    <StackPanel>
        <TextBox x:Name="txtData" />
        <Button Command="Paste" Content="Paste" />
    </StackPanel>
</Window> 
```

这是代码隐藏：

```
namespace WpfApplication1
{
    public partial class Window1 : Window
    {
        public Window1()
        {
            InitializeComponent();
        }

        private void CommandBinding_Executed(object sender, ExecutedRoutedEventArgs e)
        {
            ApplicationCommands.Paste.Execute(null, txtData);
        }
    }
} 
```

我从命令中得到了什么？在我看来，我可以很容易地将命令绑定事件处理程序中的代码放入按钮的`Click`事件中。当然，现在我可以将多个 UI 元素与粘贴命令相关联，并且只需要使用一个事件处理程序，但是如果我想粘贴到多个不同的文本框怎么办？我必须使事件处理程序逻辑更复杂或编写更多事件处理程序。所以现在，我觉得我有这个：

```
(button) ---executes Routed Command---> (Window) ---executes command binding----(command binding)
(logic) <---calls application logic--- (event handler) <-----raises event --------------| 
```

我在这里想念什么？对我来说，它看起来像是额外的间接层。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-21T19:59:42.800

你可能会混淆概念。

该`ICommand`接口支持命令模式。这允许您将用户操作抽象为可重用的类。

`ICommand`路由命令是通过可视化树搜索处理程序的特定实现。它们对于可以由许多不同控件实现的命令特别有用，并且您希望当前控件处理它。想想复制/粘贴。可能有一大堆控件可以处理它，但是通过使用路由命令，路由命令系统将根据焦点自动找到正确的控件来处理命令。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-21T22:04:05.857

除了已经提到的内容之外，您在特定的粘贴示例中忘记了 CommandTarget 和 CommandParameter 属性。对于粘贴，您可以通过设置为 CommandTarget 来指定文本框。

当想要从不同的控件使用相同的 RoutedCommand 时，这些属性是绝对必要的。它们允许您向 Executed 处理程序提供有关调用命令的上下文的一些信息。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-22T10:18:12.537

在构建控件时，我倾向于使用 RoutedCommands 和 RoutedUICommands。例如 TextBox 为您实现 UndoCommand 并且 Input guseture 已经绑定到`Ctrl`+ `Z`。然而，在构建视图模型时，我更喜欢使用内部实现 Execute 和 CanExecute 的自定义 ICommand。DelegateCommand 在 Prism 中提供此功能。这允许 view/xaml 设计者只关心命令而不是正确的 Execute/CanExecute 处理程序使用。这将允许更具表现力的视图模型。

附言。委托命令还不能（优雅地）与 InputBindings 一起工作。请微软的某个人解决这个问题！

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-21T19:52:23.783

它们在某些事情上可能有点矫枉过正，但你确实得到了一些不错的好处，比如 CanExecute 可以在命令不可用时自动启用/禁用按钮/菜单项（例如未选择文本等）。您还可以在 Blend 中执行命令操作，而无需使用任何代码，这对设计师来说非常有用。

# outlook - 读取 Outlook 2003 OST 文件

> ID：466716
> 
> 赞同：1
> 
> 时间：2009-01-21T19:53:57.540
> 
> 标签：outlook

我需要从 Outlook 2003 中恢复 OST 文件的内容。我不需要这样做，以至于我愿意支付一些公司为恢复实用程序收取的数百美元。我对从智力挑战方面做这件事更感兴趣。有没有推荐的库来做这件事？我更喜欢 C# 或 Java 中的东西。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2010-11-16T18:31:20.670

如果您想将其作为练习来完成，您可能需要编写自己的库。

*   [PST 格式规范](http://msdn.microsoft.com/en-us/library/ff385210.aspx)
*   [关于 PST 和 OST 文件格式的 Wiki 文章](http://en.wikipedia.org/wiki/Personal_Storage_Table)
*   [lipff](http://sourceforge.net/projects/libpff/) - 用于访问个人文件夹文件 (PFF) 和脱机文件夹文件 (OFF) 格式的开源 C 库和工具。PFF 用于 PAB（个人通讯录）、PST（个人存储表）和 OST（脱机存储表）文件。
*   [PST 文件格式 SDK](http://pstsdk.codeplex.com/) C++。可以读取 PST 和 OST 文件。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-12-03T20:03:01.597

我遇到了同样的问题。似乎有一堆商业工具，但我只能找到一个开源工具[libpst](http://www.five-ten-sg.com/libpst/)。（有限的）文档只讨论了 .pst 文件，但对我来说，它对 .pst 和 .ost 文件都很有吸引力（我相信 Outlook 2003）。

我在编译它时遇到了一些问题。它似乎找不到 Python::Boost 库，但以下工作：

`./configure --without-boost-python --disable-python && make`

无需重命名 .ost 文件或使用 scanpst.exe 进行转换。类似的东西`readpst -M outlook.ost`会将您所有的电子邮件转储到当前目录下的文件中。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-01T04:04:23.643

将 .ost 扩展名重命名为 .pst 并在 Office 安装目录中运行 scanpst.exe。对于 Outlook 2007 之前的版本，这会将您的 OST 转换为 PST。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-21T21:37:30.777

也许你可以检查[Alioth LibPST](http://alioth.debian.org/projects/libpst/)。如果您了解 C，您可能可以浏览源代码并使其做任何您想做的事情。

# c# - .NET 跳转列表

> ID：466726
> 
> 赞同：13
> 
> 时间：2009-01-21T19:57:16.987
> 
> 标签：c#, .net, windows-7

是否有可用的 .NET 库/教程让我向我展示如何为我的应用程序自定义 Windows 7 跳转列表？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-01-21T20:00:09.727

channel9.msdn.com 对新任务栏进行了一系列讨论，包括跳转列表。

[跳转到 Windows 7 任务栏跳转列表](http://channel9.msdn.com/posts/yochay/Jump-into-the-Windows-7-Taskbar-Jump-Lists/)

此外，Windows 7 博客开始了一系列关于开发任务栏的文章，包括如何使用跳转列表。[您可以在http://blogs.msdn.com/yochay/archive/2009/01/06/windows-7-taskbar-part-1-the-basics.aspx](http://blogs.msdn.com/yochay/archive/2009/01/06/windows-7-taskbar-part-1-the-basics.aspx)查看他们的初始帖子

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-06-21T14:26:01.830

Windows 7 API 代码包包含 .NET 的官方实现，请参阅[http://code.msdn.microsoft.com/WindowsAPICodePack](http://code.msdn.microsoft.com/WindowsAPICodePack)

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-01-21T20:10:09.580

看起来这个问题已经得到了回答： [另一篇文章](https://stackoverflow.com/questions/437212/how-do-you-register-a-most-recently-used-list-with-windows-in-preparation-for-win)

这是使用应用程序最近文件列表的内容填充跳转列表的最简单方法（[感谢代码项目！](http://www.codeproject.com/KB/shell/csdoesshell2.aspx)：

```
 void AddFileToRecentFilesList(string fileName)
    {
        SHAddToRecentDocs((uint)ShellAddRecentDocs.SHARD_PATHW, fileName);          
    }

    /// <summary>
    /// Native call to add the file to windows' recent file list
    /// </summary>
    /// <param name="uFlags">Always use (uint)ShellAddRecentDocs.SHARD_PATHW</param>
    /// <param name="pv">path to file</param>
    [DllImport("shell32.dll")]
    public static extern void SHAddToRecentDocs(UInt32 uFlags,
        [MarshalAs(UnmanagedType.LPWStr)] String pv);

    enum ShellAddRecentDocs
    {
        SHARD_PIDL = 0x00000001,
        SHARD_PATHA = 0x00000002,
        SHARD_PATHW = 0x00000003
    } 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-05-25T03:49:09.347

请参阅此处[Windows 团队博客](http://windowsteamblog.com/blogs/developers/archive/2009/05/18/windows-7-managed-code-apis.aspx)。Microsoft 正在为许多新的 Windows 7 功能开发 .Net 包装器。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2014-07-07T10:54:13.160

从 .NET 4.0 开始，JumpLists 可以很容易地与[System.Windows.Shell](http://msdn.microsoft.com/en-us/library/system.windows.shell.aspx)命名空间一起使用。

请参阅 Microsoft 官方[JumpList 类文档](http://msdn.microsoft.com/en-us/library/system.windows.shell.jumplist%28v=vs.110%29.aspx)中的参考和代码示例。

# ajax - 为什么跨域 Ajax 是一个安全问题？

> ID：466737
> 
> 赞同：42
> 
> 时间：2009-01-21T20:01:16.510
> 
> 标签：ajax, security, xss

为什么决定使用**XMLHTTPRequest**进行 XML 调用不应该跨域边界进行调用？您可以从其他域检索 JavaScript、图像、CSS、iframe 以及我能想到的任何其他内容。为什么不允许 Ajax HTTP 请求跨越域边界？考虑到我可以看到它被滥用的唯一方式，这似乎是一个奇怪的限制，那就是如果有人将 Javascript 注入页面。但是，在这种情况下，您可以简单地将 img、script 或 iframe 元素添加到文档中，以使其请求第三方 URL 并将其发送到服务器。

[编辑]

一些答案指出了以下原因，让我们指出他们没有造成不允许这样做的主要原因的原因。

## XSRF（Cross Site Request Forgery，又称CSRF、XSRF）

你可以在不使用它的情况下进行 XSRF 攻击。作为一般规则，根本不使用 XMLHTTPRequest，只是因为很难以与所有主流浏览器兼容的方式生成 XMLHTTPRequest。如果您希望他们加载您的 URL，只需向 URL 添加一个 img 标记会容易得多。

## 发布到第三方网站

```
<script type="text/javascript">
  $.post("http://some-bank.com/transfer-money.php", 
         { amount: "10000", to_account: "xxxx" })
</script> 
```

可以用

```
<body onload="document.getElementById('InvisbleForm').submit()"
    <div style="display:none">
        <form id="InvisbleForm" action="http://some-bank.com/transfer-money.php" method="POST">
            <input type="hidden" name="amount" value="10000">
            <input type="hidden" name="to_account" value="xxxxx">
        </form>
    </div>
</body> 
```

## JPunyon：为什么要把漏洞留在新功能中

你不会再制造任何不安全感。您只是给想要以某种方式使用它的开发人员带来不便。任何想要将此功能用于邪恶（又名真棒）的人都可以使用其他方法来做到这一点。

## 结论

我将**bobince**的答案标记为正确，因为他指出了关键问题。因为 XMLHTTPRequest 允许您使用凭据（cookie）发布到目标站点，并读取从站点发回的数据，以及发送人员凭据，所以您可以编排一些 javascript 来提交一系列表单，包括确认表单, 以及生成的任何随机密钥，这些密钥被放置在适当的位置以防止 XSRF。这样，您可以像银行一样浏览目标站点，而银行的网络服务器将无法判断提交所有这些表单的不仅仅是普通用户。

* * *

## 回答 #1

> 赞同：37
> 
> 时间：2009-01-21T20:53:22.333

> 为什么不允许 Ajax HTTP 请求跨越域边界。

因为 AJAX 请求是 (a) 使用用户凭据提交的，并且 (b) 允许调用者读取返回的数据。

正是这些因素的组合可能导致漏洞。有人提议添加一种省略用户凭据的跨域 AJAX。

> 您可以简单地将 img、script 或 iframe 元素添加到文档中

这些方法都不允许调用者读取返回的数据。

（除了故意设置允许的脚本，允许跨域脚本 - 或者有人犯了一个可怕的错误。）

> 你可以在不使用它的情况下进行 XSS 攻击。发布到第三方网站

这不是 XSS 攻击。这是一种跨站点请求伪造攻击（XSRF）。有一些已知的方法可以解决 XSRF 攻击，例如包括一次性或加密令牌来验证提交是否来自用户故意，而不是从攻击者代码启动。

如果您允许跨域 AJAX，您将失去此保护措施。攻击代码可以从银行站点请求一个页面，读取其中的任何授权令牌，并在第二个 AJAX 请求中提交它们以执行传输。那*将*是跨站点脚本攻击。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2012-10-12T23:12:28.730

POST之间的一个重要区别：

```
<body onload="document.getElementById('InvisbleForm').submit()" ... 
```

而 Ajax 是在执行任何 POST 之后，浏览器将替换页面并且在执行 Ajax 调用之后 - 不是。POST 的结果将是：

1.  对用户清晰可见。
2.  攻击将停留在这一点上，因为来自的响应页面`my-bank.com`将获得控制权。没有银行会实施**一键转账**。

如果允许跨域 Ajax，XSRF 的场景将如下所示：

1.  用户以某种方式访问`www.bad-guy.com`​​。
2.  `my-bank.com`如果在其他浏览器实例中没有打开页面，则攻击不成功。
3.  但是如果这样的页面被打开并且用户已经输入了他的用户名/密码，这意味着在浏览器的缓存中有这个会话的cookie。
4.  页面上的 JavaScript 代码`www.bad-guy.com`对`my-bank.com`.
5.  对于浏览器，这是一个常规的 HTTP 调用，它必须将 my-bank cookie 发送到`my-bank.com`并发送它们。
6.  银行处理此请求是因为它无法将此呼叫与用户的常规活动区分开来。
7.  JavaScript 代码可以读取响应这一事实并不重要。在攻击情况下，这可能不是必需的。真正重要的是，电脑前的用户不会知道这种交互的发生。他会看`www.bad-guy.com`页面上漂亮的图片。
8.  `my-bank.com`如果需要，JavaScript 代码会进行其他几次调用。

要点是不需要注入或任何页面篡改。

更好的解决方案可能是允许调用本身但不发送任何 cookie。这是一个非常简单的解决方案，不需要任何广泛的开发。在许多情况下，Ajax 调用会转到未受保护的位置，并且不发送 cookie 不会成为限制。

现在正在讨论的 CORS（跨源资源共享），其中包括发送/不发送 cookie。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-21T20:11:41.263

好吧，显然你不是唯一有这种感觉的人......

[http://www.google.com/search?q=xmlhttp+cross+site](http://www.google.com/search?q=xmlhttp+cross+site)

编辑：上面的搜索链接了一个有趣的讨论：

[http://blogs.msdn.com/ie/archive/2008/06/23/securing-cross-site-xmlhttprequest.aspx](http://blogs.msdn.com/ie/archive/2008/06/23/securing-cross-site-xmlhttprequest.aspx)

似乎正在提议允许跨站点 xmlhttp 请求（IE 8、FF3 等），尽管我希望在我为我的站点编写代码时它们就在那里:) 然后是兼容性问题......在它无处不在之前还需要一段时间。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-21T20:18:28.800

当您向服务器发送 HTTP 请求时，服务器设置的 cookie 也会由浏览器发送回服务器。服务器使用这些 cookie 来确定用户已登录等事实。

恶意攻击者可以利用这一点，在一些 JavaScript 的帮助下，可以在用户不知情的情况下窃取信息或在其他网站上执行未经授权的命令。

例如，可以要求用户访问具有以下 JavaScript 代码（假设为 jQuery）的站点：

```
<script type="text/javascript">
  $.post("http://some-bank.com/transfer-money.php", 
         { amount: "10000", to_account: "xxxx" })
</script> 
```

现在，如果在执行上述代码时用户真的登录了银行，攻击者可能已经将 10K 美元转移到账户 XXX。

这种攻击称为跨站请求伪造（XSRF）。[在Wikipedia](http://en.wikipedia.org/wiki/XSRF)上有更多关于此的信息。

这主要是由于这个原因，存在同源策略，浏览器不允许您在与源不同的域上执行 XMLHttpRequests。

有一些讨论实际上允许跨域 XHR，但我们必须看看这是否真的被接受。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-21T20:28:17.720

正如您所提到的，这是一个令人担忧的问题，因为它可能被用于不良目的。它也可以很好地使用，因此，正在开发跨域协议。

最大的两个问题是当它与跨站点脚本 (XSS) 和跨站点请求伪造 (CSRF) 结合使用时。两者都是严重的威胁（这就是他们进入 OWASP 前 10 名和 SANS 25 名的原因）。

> 我可以看到它被滥用的唯一方法是，如果有人要注入 Javascript

这就是 XSS 太多的应用程序仍然容易受到攻击，如果浏览器安全模型不能阻止 X 域 AJAX，它们就会让用户面临相当大的攻击向量。

> 您可以简单地向文档添加 img、script 或 iframe 元素，以使其请求第三方 URL

是的，但是那些会发送一个 HTTP_REFERRER 并且（通过其他方式）可以被阻止以防止 CSRF。AJAX 调用可以更容易地欺骗标头，并允许使用其他方法绕过传统的 CSRF 保护。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-21T20:34:53.883

我认为将其与普通 XSRF 攻击区分开来的另一件事是，您也可以通过 javascript 处理返回的数据。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-01-21T20:43:11.793

不知道最大的问题是什么？将向其他域发送的 AJAX 调用首先发送到您的应用程序，然后使用过滤后的数据转发到其他地方，如果您确实需要解析返回的数据，并将其提供给用户。

处理敏感的 AJAX 请求？通过检查标头、存储会话时间数据或将传入的 IP 地址过滤到您信任的来源或您的应用程序来确定传入的傻瓜。

我个人希望将来看到的是，默认情况下，Web 服务器、框架和 CMS 上的所有传入请求都具有坚如磐石的安全性，然后明确定义将解析来自外部源的请求的资源。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-01-21T20:59:48.063

有了`<form>`你可以发布数据，但你不能阅读它。有了`XHR`你，两者都可以。

类似页面`http://bank.example.com/display_my_password`对 XSRF（假设它只显示而不设置密码）和框架（它们具有同源策略）是安全的。然而，跨域 XHR 将是一个漏洞。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-01-21T20:09:31.720

您将毫无戒心的访问者变成拒绝服务攻击者。

另外，想象一个窃取你所有 Facebook 内容的跨站点脚本。它打开一个 IFrame 并导航到 Facebook.com

您已经登录到 facebook (cookie)，它会读取您的数据/朋友。并且做更多的坏事。

# vb.net - 如何在电子邮件中嵌入 PDF？

> ID：466741
> 
> 赞同：2
> 
> 时间：2009-01-21T20:01:46.213
> 
> 标签：vb.net, email, pdf

我已经提到过[这个 SO post](https://stackoverflow.com/questions/104177/how-do-i-embed-an-image-in-a-net-html-mail-message)。我一直在使用 AlternateView 为 PNG 文件嵌入图像。现在我想知道如何使用PDF来做到这一点。

对于 LinkedResource 来说，它是否可行，只需说：

```
Dim document As New LinkedResource(pdfFilePath, "image/pdf") 
```

我只是想弄清楚如何像嵌入图像一样嵌入 PDF，或者这不可能，我必须将其作为附件？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-21T20:07:29.773

您可以嵌入图像，因为它们可以由电子邮件客户端呈现在适当的位置。PDF 无法做到这一点，因此我建议您使用 PDF 的缩略图链接到您的网站以及实际的 PDF。或者只是将 PDF 附加到电子邮件中。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-21T21:50:59.520

我知道有几个选项。

1）**最简单的方法可以吗？**到目前为止，最简单的方法是将 PDF 作为普通附件附加。然后将 pdf 的第一页呈现为图像，将其嵌入到电子邮件中并链接它以打开 PDF（如果可以）。随行人员在 Mac 上执行此操作。

或者，我发现如下：

2) **[FLASHPAPER](http://www.adobe.com/products/flashpaper/)嵌入在显示 PDF 的 HTML 中。** Adobe 有一种称为[Flashpaper](http://www.adobe.com/products/flashpaper/)的技术。它是一个基于 Flash 的文件查看器。您可以使用其中包含的 flashpaper 格式文档，或 PDF 作为源。

查看一些示例。这真的是一闪而过。 [http://www.adobe.com/products/flashpaper/examples/](http://www.adobe.com/products/flashpaper/examples/)

假设您发送的 HTML 电子邮件可以通过（图像未关闭等），您可以将 Flashpaper 查看器作为普通 Flash 对象直接嵌入到 HTML 代码中。

大多数 HTML 电子邮件客户端使用 Internet Explorer 位、Webkit 位或 Gecko 位来呈现 html。Flash 播放器很好地安装在所有东西上，因此运行良好。一个很好的例子是当我们打开一封电子邮件并且其中播放视频时。它几乎总是Flash。

我很幸运以这种方式做到了——您唯一需要决定的是您的大多数客户是否可以看到这一点，以及今天的软件可能会阻止多少（如果有的话）。

我最终做的是混合动力车。1) 将其附加到电子邮件中，2) 嵌入 Flashpaper 查看器。无论哪种方式，他们都会得到它。

Flashpaper 可单独购买，价格为 75 美元。当客户端无法在每台计算机上安装 adobe acrobat 并且它必须 100% 基于 Web 时，它就派上用场了。

我想你应该能够使用任何语言来做同样的事情，只需付出更多的努力，并使用 Flashpaper 之类的东西。

希望有帮助

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-21T20:08:16.683

这是不可能的——至少不能与许多客户一起工作。您只需附加文件即可。

如果您只有一个客户端需要担心，这*可能*是可能的 - 但如果不手动更改每个客户端的设置，则不太可能。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-22T05:05:07.020

PDF 的 MIME 类型是“application/pdf”而不是“image/pdf”

# sql-server - 西里尔搜索

> ID：466745
> 
> 赞同：13
> 
> 时间：2009-01-21T20:03:05.320
> 
> 标签：sql-server, tsql, sql-server-2005

我修改了我为俄罗斯市场制作的一个应用程序。一切似乎都很好，当您将数据输入数据库时​​出现问题，但通过将页面编码设置为 utf-8 解决了这个问题。所以插入和检索工作正常。我遇到了问题，我只是不知道如何解决。当我在 mssql 查询分析器中运行以下查询（简化）时（所以它不可能在代码中搞砸），即使有许多记录匹配，我也没有得到任何结果：（mysql 的版本是 2005）

```
SELECT *
FROM institutions
WHERE city LIKE '%Москва%'
ORDER BY address1 
```

即使我将其修改为：

```
SELECT *
FROM institutions
WHERE city='Москва'
ORDER BY address1 
```

或其他一些变化，它只是不工作。问题是为什么？

PS如果我提交后你看不到西里尔字母，它会搜索莫斯科作为一个城市。

任何人都有解决方案或想法该怎么做？

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2009-01-21T20:07:45.030

好的，刚刚找到答案，有点蹩脚:)。您需要在 unicode 字符串前面添加 N。

```
SELECT * FROM institutions WHERE city LIKE N'%Москва%' ORDER BY address1 
```

我会留下这个，以防其他人被它卡住。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-21T20:09:40.237

N 告诉 SQL Server 它是 unicode 而不是 ascii

# perl - 如何从 Perl 重置我的 LDAP 密码？

> ID：466748
> 
> 赞同：4
> 
> 时间：2009-01-21T20:04:29.327
> 
> 标签：perl, winapi, ldap, passwords

我的公司和其他人一样，不时需要重置密码。为了安全起见，这一切都很好，但我想探索通过脚本重置它的挑战（特别是因为我们不能使用我们之前的 25 个密码；Perl 循环遍历一个列表要快得多比我的手指深）。

我正在尝试使用 Perl 和 Win32::OLE 的 LDAP 连接器来重置我的密码。我在网上关注了几个例子，并简要介绍了：

```
use strict;
use Win32::OLE;

my $dn        = 'cn=name,dc=corp,dc=com';
my $ldap      = Win32::OLE->GetObject('LDAP:');
my $ldap_user = $ldap->OpenDSObject('LDAP://' . $dn,'username','password',1);

$ldap_user->SetPassword('mySw337NewPassword'); 
```

我得到的只是：

```
Win32::OLE(0.1707) error 0x80070005: "Access is denied"
     in METHOD/PROPERTYGET "SetPassword" at pw.change.pl line 8 
```

这是可以解决的吗？我找到了`Net::LDAP::Extension::SetPassword`模块，但那里没有骰子。

谢谢！

**Leon 的更新（Max，你是下一个）：**

你是对的，我应该更好地指定。我试过`Win32::OLE`了，失败了，然后分别尝试`Net::LDAP::Extension::SetPassword`，失败得更厉害。

至于我的服务器：我不确定，我不是 LDAP 人 :) 通过运行`->root_dse->get_value('supportedExtension')`我可以看到`setPassword OID`没有设置，所以也许它不是故意的。

**巴尼顿的最后道具！**

最终解决方案：

```
use strict;
use Win32::OLE;

my $orig_password   = 'password123Test';
my $target_password = 'password321Test';

my $dn        = 'cn=myname,dc=corp,dc=com';
my $ldap      = Win32::OLE->GetObject('LDAP:');
my $ldap_user = $ldap->OpenDSObject('LDAP://'.$dn,'myname',$orig_password,1);

my $tmp_password = '';
for ( my $i = 0; $i < 30; ++$i )
{
    $tmp_password = 'password' . $i . 'ABC';    
    print 'Changing to ' . $tmp_password . "\n";

    $ldap_user->ChangePassword($orig_password,$tmp_password);
    $orig_password = $tmp_password;

    sleep 1;
}

$ldap_user->ChangePassword($tmp_password,$target_password); 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-21T21:57:14.903

`Net::LDAP::Extension::SetPassword`与任何 OLE LDAP 对象没有任何关系。要么使用[Net::LDAP](http://search.cpan.org/perldoc?Net::LDAP)，要么使用`Win32::OLE->GetObject('LDAP:')`.

你没有提到你使用的是什么服务器。设置密码需要对 LDAP 进行扩展，因此这是相关的。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-22T05:23:20.807

当您说您正在尝试“重置”密码时，我认为您的真正意思是[更改](http://msdn.microsoft.com/en-us/library/aa746341(VS.85).aspx)密码而不是[设置](http://msdn.microsoft.com/en-us/library/aa746344(VS.85).aspx)密码。两者是有区别的。“SetPassword”需要上帝/管理员权限，因为无论旧密码是否已知，您都将用户的密码设置为新值，而“ChangePassword”要求用户实际知道旧密码。我假设您的帐户没有管理员权限，否则您将不会得到 0x80070005：“访问被拒绝”

所以而不是：

```
$ldap_user->SetPassword('mySw337NewPassword'); 
```

试试这个：

```
$ldap_user->ChangePassword('password', 'mySw337NewPassword'); 
```

顺便说一句，我从来没有在 perl 中做过这些事情，所以我只是猜测。希望这可以帮助你。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-22T05:33:47.243

要记住的另一件事是 Active Directory 不允许您设置密码，除非您使用 LDAPS 绑定到端口 636。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-22T03:33:29.950

您可以尝试将值写入 userPassword，这将是密码重置，您可能无权这样做。

否则，您可以尝试在一个操作中（LDIF 会将其显示为由​​一行上的单个破折号分隔）删除旧密码的值，然后添加新密码的值。那将是一个密码更改事件。

# asp.net-mvc - 将参数传递给 ASP.NET MVC 中的视图？

> ID：466752
> 
> 赞同：2
> 
> 时间：2009-01-21T20:06:48.933
> 
> 标签：asp.net-mvc

我一直在试验 ASP.NET MVC 并按照[本](http://www.asp.net/learn/mvc/tutorial-01-cs.aspx)教程创建基本的任务列表应用程序。我已经让它运行良好，一切正常，虽然视频是在 VB 中，我在将它“转换”为 C# 时遇到了一些麻烦，但由于代码示例而糊涂了。

现在，为了进一步了解我的知识，我决定对系统进行一些小修改。我想更改索引页面，如果所有任务都已完成，则“我的任务”显示为红色，如果有*任何*未完成的任务，则“我的任务”显示为绿色。

我在 HomeController.cs 中添加了以下函数：

```
 public bool Uncomplete()
    {
        bool AnyLeft = false;
        var tasks = from t in db.Tasks orderby t.EntryDate descending select t;
        foreach (Task match in tasks)
        {
            if (match.IsCompleted == false)
            {
                AnyLeft = true;
            }
        }

        return AnyLeft;
    } 
```

然后我将 Index() ActionResult 修改为如下所示：

```
 public ActionResult Index()
    {
        bool AnyLeft = Uncomplete();
        var tasks = from t in db.Tasks orderby t.EntryDate descending select t;
        return View(tasks.ToList());
    } 
```

我的最终意图是在 Index.aspx 中使用以下代码：

```
<% if (AnyLeft == false)
   { %>
    <h1 class="green">My Tasks</h1>
<% }
   else
   { %>
    <h1 class="red">My Tasks</h1>
<% } %> 
```

但是，我不知道如何让 Index.aspx “知道” AnyLeft 的值为真或假。我试过

```
return View(tasks.ToList(), AnyLeft); 
```

但这会引发我无法完全破译的错误。我有一种感觉，我正在以“错误的方式”做事，但我无法弄清楚。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-21T20:12:18.533

在控制器中使用它：

```
public ActionResult Index()
{
    ViewData["AnyLeft"] = Uncomplete();
    var tasks = from t in db.Tasks orderby t.EntryDate descending select t;
    return View(tasks.ToList());
} 
```

在视图中：

```
<% if (!(bool)ViewData["AnyLeft"])
   { %>
    <h1 class="green">My Tasks</h1>
<% }
   else
   { %>
    <h1 class="red">My Tasks</h1>
<% } %> 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-21T20:12:05.863

```
ViewData["Anyleft"] = Anyleft; 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-24T04:43:44.647

我建议将[Zhaph - Ben Duguid](https://stackoverflow.com/users/33051/zhaph-ben-duguid)的 linq 与扩展方法结合起来进行一些重构。像这样：

```
public static class TaskExtensions {
    public static bool Uncomplete(this IEnumerable<Task> tasks) {
        return (from t in tasks where !t.IsCompleted select t).Any();
    }
} 
```

现在您可以在视图中执行此操作：

```
<h1 class="<%= (tasks.Uncomplete()) ? "Red" : "Green" %>">My Tasks</h1> 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-22T15:43:21.960

我可以就您的 Uncomplete 方法提供一些（希望有帮助）建议：

```
public bool Uncomplete()
{
    bool AnyLeft = false;

    var tasks = from t in db.Tasks 
        where !t.IsCompleted // or you could use t.IsCompleted == false
        orderby t.EntryDate descending select t;

    AnyLeft = tasks.Any;

    return AnyLeft;
} 
```

基本上，我根据您的原始用法做了一些（小）更改：

1.  首先，我在查询中添加了 where 子句——这会将结果限制在我们感兴趣的范围内。
2.  使用 .Any 基本上只会从数据库中获取第一条记录，而不是遍历整个记录集——这甚至比 .Count 更有效。

但是，如果您需要进行其他处理，并且确实需要遍历该集合，则可以像这样执行循环：

```
 foreach (Task match in tasks)
    {
        if (!match.IsCompleted)
        {
            AnyLeft = true;
            break;
        }
    } 
```

由于您不关心有多少未完成的任务，一旦找到第一个未完成的任务，就没有必要遍历整个集合，因此一旦设置 AnyLeft 就调用 break 将停止对 foreach 循环的进一步处理.

我希望这会有所帮助。

# c# - SQL表变化分布

> ID：466757
> 
> 赞同：2
> 
> 时间：2009-01-21T20:07:59.493
> 
> 标签：c#, winforms, visual-studio-2008, software-distribution, sql-server-2008-express

我有一个使用 VS 2008 (C#) 和 SQL Server Express 2008 构建的 WinForm 应用程序，目前部署在测试用户 PC 上。

我对数据库结构进行了修改（添加字段、表等），我想知道在用户 PC 上分发更改的最佳方法是什么（不会丢失用户数据）。

根据我目前所学的内容，我需要将更改写入脚本文件。但是，无需在 SQL Server Management Studio 中手动运行脚本文件的最佳方法是什么？您是否建议使用任何自动分发方法？我必须编写自己的更新应用程序吗？

我目前使用 ClickOnce 分发 EXE 文件中的更改。当您必须使用新版本对数据库进行更改时，ClickOnce 是否仍然是一个可行的解决方案？

TIA

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-21T20:33:42.060

有很多方法可以做到这一点 - 或者以某种方式构建自己的本地版本（例如，我们目前正在将数据库更改脚本作为嵌入式资源打包到 DLL 中，并有一个引擎可以在安装时在客户端计算机上运行这些脚本，并且/或更新时间），或者您可以查看现成的 .NET 产品，例如 Red-Gate [SQL Packager](http://www.red-gate.com/products/SQL_Packager/index.htm)，它可以为您节省大量时间和精力。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-21T20:29:01.150

您可以在启动时编写应用程序以从应用程序文件夹中读取脚本文件并执行它。您可以让脚本在完成后更新数据库中的值，以防止它再次运行。

您可以将新脚本文件部署为内容，应用程序将在下次启动时执行它，升级您的数据库

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-21T20:38:30.587

您可以调用 MSSQL 附带的 osql 或 sqlcmd。

或者您可以使用 SMO 来运行您的数据库更改脚本。请参阅[此博客](http://weblogs.asp.net/jgalloway/archive/2006/11/07/Handling-_2200_GO_2200_-Separators-in-SQL-Scripts-_2D00_-the-easy-way.aspx)它是如何完成的。

# asp.net - 将相同类型的多个用户控件添加到页面

> ID：466760
> 
> 赞同：2
> 
> 时间：2009-01-21T20:08:57.947
> 
> 标签：asp.net, user-controls

已经提出了与此类似的问题，但似乎没有一个可以解决我的确切情况，这就是我正在尝试做的事情。

我有一个管理学生信息的用户控件。即名字、姓氏、地址等。

我有一个网页/表单，上面有一个按钮。“添加学生”。我想要完成的是在每次单击后将一个新的 StudentInfo 控件添加到网络表单中。

我当前的代码看起来像这样

```
Private Sub btnAddStudent_Click(sender as object, ByVal e As System.EventArgs)
Dim lStudentInfo as Control

LoadControl("~/StudentInfo.ascx")

Me.placeholder1.controls.add(lStudentInfo)

End Sub 
```

使用此代码仅添加一个 StudentInfo 控件，并且在再次按下“添加”按钮时，不会在第一个控件下方添加一个新的 StudentInfo 控件，并且在第一个控件中输入的文本/数据被清除。

提前感谢您的任何帮助。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-21T20:12:06.520

正在发生的事情是，每次您进行回发时，您之前的控制权都会丢失。请记住，每个回发都使用一个全新的页面类实例。您上次添加控件的实例在 http 请求完成后立即被*销毁*- 可能在浏览器甚至完成加载它的 DOM 之前。

如果您希望每个回发都存在一个控件，则必须*在每个回*发上添加它。

此外，如果您希望 ViewState 为控件工作，您需要*在页面的 Load 事件之前*添加它。这意味着在 Init 或 PreInit 上。

```
Private Sub btnAddStudent_Click(sender as object, ByVal e As System.EventArgs)
    Me.placeholder1.controls.add(LoadControl("~/StudentInfo.ascx"))
    Session("NewStudentControls") += 1
End Sub

Protected Sub Page_Init(sender as object, e as system.eventargs)
     For i As Integer = 1 To Session("NewStudentControls")
          Me.placeholder1.controls.add(LoadControl("~/StudentInfo.ascx"))
     Next
End Sub 
```

# git - Git 命令显示 .gitignore 忽略了哪些特定文件

> ID：466764
> 
> 赞同：762
> 
> 时间：2009-01-21T20:09:36.230
> 
> 标签：git, ignore

我被 Git 弄湿了，有以下问题：

我的项目源代码树：

```
/
|
+--src/
+----refs/
+----...
|
+--vendor/
+----... 
```

我的供应商分支中有代码（当前为 MEF），我将在那里编译，然后将引用移动到`/src/refs`项目从中获取它们的位置。

我的问题是我的`.gitignore`设置要忽略`*.dll`和`*.pdb`. 我可以`git add -f bar.dll`强制添加被忽略的文件，这没关系，问题是我无法弄清楚哪些文件存在被忽略。

我想列出被忽略的文件，以确保我不会忘记添加它们。

我已阅读手册页`git ls-files`，但无法使其正常工作。在我看来，`git ls-files --exclude-standard -i`应该做我想做的事。我错过了什么？

* * *

## 回答 #1

> 赞同：829
> 
> 时间：2009-01-21T21:17:24.157

笔记：

*   [小白](https://stackoverflow.com/users/814145/xiaobai)的[回答](https://stackoverflow.com/a/12080920/6309)比较简单（git1.7.6+）：（ 详见“[有没有办法告诉git-status忽略](https://stackoverflow.com/a/12080857/6309)[文件的影响？](https://stackoverflow.com/a/12080857/6309) ”）**`git status --ignored`**
    [`.gitignore`](https://stackoverflow.com/a/12080857/6309)
*   [MattDiPasquale](https://stackoverflow.com/users/242933/mattdipasquale)的[答案](https://stackoverflow.com/questions/466764/show-ignored-files-in-git/2196755#2196755)（被赞成）**`git clean -ndX`**适用于较旧的 git，显示可以删除哪些被忽略文件的*预览（不删除任何内容）*

* * *

也很有趣（在[qwertymk](https://stackoverflow.com/users/465546/qwertymk)的[回答](https://stackoverflow.com/a/26580088/6309)中提到），您也可以使用该[**`git check-ignore -v`**](http://git-scm.com/docs/git-check-ignore)命令，至少在 Unix 上（在 CMD **Windows**会话**中不起作用）**

 **```
git check-ignore *
git check-ignore -v * 
```

第二个显示了`.gitignore`在你的 git repo 中忽略文件的实际规则。
在 Unix 上，使用“[什么递归地扩展到当前目录中的所有文件？](https://stackoverflow.com/questions/1690809/what-expands-to-all-files-in-current-directory-recursively) ”和 bash4+：

```
git check-ignore **/* 
```

（或`find -exec`命令）

注意：[https://stackoverflow.com/users/351947/Rafi B.](https://stackoverflow.com/users/351947/c)[在评论](https://stackoverflow.com/questions/466764/git-command-to-show-which-specific-files-are-ignored-by-gitignore/467053?noredirect=1#comment105393217_467053)中建议**避免（有风险的） globstar**：

```
git check-ignore -v $(find . -type f -print) 
```

确保从子文件夹中排除文件`.git/`。

[CervEd](https://stackoverflow.com/users/1507124/cerved)在[评论](https://stackoverflow.com/questions/466764/git-command-to-show-which-specific-files-are-ignored-by-gitignore/467053#comment120476196_467053)中建议避免`.git/`：

```
find . -not -path './.git/*' | git check-ignore --stdin 
```

* * *

原答案42009）

```
git ls-files -i 
```

应该可以工作，除了[它的源代码](http://www.mail-archive.com/git@vger.kernel.org/msg03245.html)表明：

```
if (show_ignored && !exc_given) {
                fprintf(stderr, "%s: --ignored needs some exclude pattern\n",
                        argv[0]); 
```

`exc_given`?

事实证明，在`-i`实际列出任何内容之后，还需要一个参数：

尝试：

```
git ls-files -i --exclude-from=[Path_To_Your_Global].gitignore 
```

（但这只会列出带有过滤器的*缓存*（非忽略）对象，因此这不是您想要的）

* * *

例子：

```
$ cat .git/ignore
# ignore objects and archives, anywhere in the tree.
*.[oa]
$ cat Documentation/.gitignore
# ignore generated html files,
*.html
# except foo.html which is maintained by hand
!foo.html
$ git ls-files --ignored \
    --exclude='Documentation/*.[0-9]' \
    --exclude-from=.git/ignore \
    --exclude-per-directory=.gitignore 
```

* * *

实际上，在我的“gitignore”文件（称为“排除”）中，我找到了一个可以帮助您的命令行：

```
F:\prog\git\test\.git\info>type exclude
# git ls-files --others --exclude-from=.git/info/exclude
# Lines that start with '#' are comments.
# For a project mostly in C, the following would be a good set of
# exclude patterns (uncomment them if you want to use them):
# *.[oa]
# *~ 
```

所以....

```
git ls-files --ignored --exclude-from=.git/info/exclude
git ls-files -i --exclude-from=.git/info/exclude

git ls-files --others --ignored --exclude-standard
git ls-files -o -i --exclude-standard 
```

应该做的伎俩。

（感谢[honzajde](https://stackoverflow.com/users/271996/honzajde)*在*不包括缓存文件[的评论](https://stackoverflow.com/questions/466764/git-command-to-show-which-specific-files-are-ignored-by-gitignore/467053?noredirect=1#comment115090587_467053)中指出：只有（*没有*）有。）`git ls-files -o -i --exclude-from...`*`git ls-files -i --exclude-from...` *`-o`**

 **正如[ls-files 手册页](http://www.kernel.org/pub/software/scm/git/docs/git-ls-files.html)中提到的，`--others`是重要的部分，以便向您显示非缓存、非提交、通常被忽略的文件。

`--exclude_standard`不仅仅是一个快捷方式，而是一种包含*所有*标准“忽略模式”设置的方法。

> `exclude-standard`
> 在每个目录中 添加标准 git 排除项：`.git/info/exclude`,和.`.gitignore``user's global exclusion file`

* * *

## 回答 #2

> 赞同：608
> 
> 时间：2012-08-22T20:29:34.763

有一种更简单的方法（git 1.7.6+）：

```
git status --ignored 
```

请参阅[有没有办法告诉 git-status 忽略 .gitignore 文件的影响？](https://stackoverflow.com/a/12080857/814145)

* * *

## 回答 #3

> 赞同：409
> 
> 时间：2010-02-04T01:17:55.293

另一个非常干净的选项（没有双关语。）：

```
git clean -ndX 
```

解释：

```
$ git help clean

git-clean - Remove untracked files from the working tree
-n, --dry-run - Don't actually remove anything, just show what would be done.
-d - Remove untracked directories in addition to untracked files.
-X - Remove only files ignored by Git. 
```

注意：此解决方案不会显示已被删除的忽略文件。

* * *

## 回答 #4

> 赞同：41
> 
> 时间：2009-09-18T20:14:04.557

虽然通常更正您的解决方案并不适用于所有情况。假设一个回购目录是这样的：

```
# ls **/*                                                                                                       
doc/index.html  README.txt  tmp/dir0/file0  tmp/file1  tmp/file2

doc:
index.html

tmp:
dir0  file1  file2

tmp/dir0:
file0 
```

和这样的 .gitignore ：

```
# cat .gitignore
doc
tmp/* 
```

这将忽略`doc`目录和下面的所有文件`tmp`。Git 按预期工作，但列出被忽略文件的给定命令没有。让我们看看 git 是怎么说的：

```
# git ls-files --others --ignored --exclude-standard                                                            
tmp/file1
tmp/file2 
```

请注意`doc`列表中缺少的内容。您可以通过以下方式获得它：

```
# git ls-files --others --ignored --exclude-standard --directory                                                
doc/ 
```

注意附加`--directory`选项。

据我所知，没有*一个*命令可以一次列出所有被忽略的文件。但我不知道为什么`tmp/dir0`根本没有出现。

* * *

## 回答 #5

> 赞同：19
> 
> 时间：2014-10-27T01:52:22.397

Git 现在内置了这个功能

```
git check-ignore * 
```

当然，您可以将 glob 更改为`**/*.dll`您的情况

[Git 参考](http://git-scm.com/docs/git-check-ignore)

* * *

## 回答 #6

> 赞同：16
> 
> 时间：2015-08-28T15:24:06.420

以下是如何打印工作树中与位于 Git 的多个 gitignore 源中任何位置的模式匹配的文件的完整列表（如果您使用的是 GNU `find`）：

```
$ cd {your project directory}
$ find . -path ./.git -prune -o -print \
| git check-ignore --no-index --stdin --verbose 
```

它将检查存储库当前分支中的所有文件（除非您已在本地删除它们）。

它还标识了特定的 gitignore 源代码行。

Git 继续跟踪与 gitignore 模式匹配的某些文件中的更改，这仅仅是因为这些文件已被添加。有用的是，上面的命令也显示了这些文件。

负 gitignore 模式也被匹配。但是，这些在列表中很容易区分，因为它们以 . 开头`!`。

如果您使用的是 Windows，[Git Bash](http://git-for-windows.github.io/)包括 GNU `find`（如 所示`find --version`）。

如果列表很长（并且您有`rev`），您也可以通过扩展名（有点）显示它们：

```
$ cd {your project directory}
$ find . -path ./.git -prune -o -print \
| git check-ignore --no-index --stdin --verbose \
| rev | sort | rev 
```

有关详细信息，请参阅`man find`、`man git-check-ignore`、`man rev`和`man sort`。

整个方法的重点是 Git（软件）正在迅速变化并且非常复杂。相比之下，GNU*非常*`find`稳定（至少，在这里使用的特性方面）。因此，任何希望通过展示他们对 Git 的深入了解来提高竞争力的人都会以不同的方式回答这个问题。

 *最好的答案是什么？*这个*答案故意尽量减少对 Git 知识的依赖，通过模块化（信息隔离）来达到稳定和简单的目标，并设计为持续*很长时间*。

* * *

## 回答 #7

> 赞同：15
> 
> 时间：2012-08-31T18:15:37.550

使用应该足够了

```
git ls-files --others -i --exclude-standard 
```

因为这涵盖了所涵盖的所有内容

```
git ls-files --others -i --exclude-from=.git/info/exclude 
```

因此后者是多余的。

* * *

您可以通过向`~/.gitconfig`文件添加别名来简化此操作：

```
git config --global alias.ignored "ls-files --others -i --exclude-standard" 
```

现在您只需键入`git ignored`即可查看列表。更容易记住，打字更快。

如果您更喜欢 Jason Geng 解决方案的更简洁显示，您可以为它添加一个别名，如下所示：

```
git config --global alias.ignored "status --ignored -s" 
```

然而，更详细的输出对于解决 .gitignore 文件的问题更有用，因为它列出了每个被忽略的棉花采摘文件。您通常会通过管道传输结果`grep`以查看您希望被忽略的文件是否在其中，或者您不想被忽略的文件是否在其中。

```
git ignored | grep some-file-that-isnt-being-ignored-properly 
```

然后，当您只想看一个简短的显示时，很容易记住和输入

```
git status --ignored 
```

（`-s`通常可以不使用。）

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2021-04-02T16:01:25.110

如果您只需要一个**有效的**被忽略文件列表（无论它们如何被忽略），并且**没有任何额外的通知和日志。**

创建后，在任何地方（在 Git-bash 中）运行：

```
git ignore-list 
```

### 通过执行创建它：

```
git config --global alias.ignore-list "! cd -- \"\${GIT_PREFIX:-.}\" && git ls-files -v \${1:-.} | sed -n -e \"s,^[a-z] \(.*\)$,\${GIT_PREFIX:-./}\1,p\" && git status --ignored --porcelain \${1:-.} 2>/dev/null | sed -n -e \"s/^\(\\!\\! \)\(.*\)$/\2/p\" #" 
```

> **示例用法，** 假设它是初始提交并且您想要推送所有内容，请尝试：
> 
> ```
> git ignore-list | xargs git add -f 
> ```

### 笔记：

1.  `macOS`它已经过测试并且可以在两个`Windows`平台上运行！
2.  进入`cd`目录后，仅列出从该目录（或其子目录）中忽略的文件。
3.  最后，始终记录相对于 root-dir 的路径（其中包含`.git`dir，无论您`cd`进入哪个目录）。

另一个有用的东西是人类可读性，比如如果整个目录被忽略，比如`build`or `node_modules`，这将只记录 dir-name。
虽然`git ls-files --others -i --exclude-standard`命令记录每个文件（适用于`xargs`）。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2021-10-14T11:43:46.953

我会做

```
git status --porcelain --ignored 
```

并且只列出被忽略的文件

```
git status --porcelain --ignored | grep '^[!][!] ' 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2018-12-13T16:28:37.780

[（扩展其他答案）]

请注意，`git check-ignore`使用已提交的`.gitignore`而不是工作树中的那个！要在不污染 git 历史记录的情况下使用它，您可以自由尝试编辑它，然后使用`git commit --amend`.

这个问题主要发生在您需要解决问题的方法时，即 git 不遵循目录。输入`.gitignore`：

```
dirtokeep/**
!dirtokeep/.keep 
```

`.keep`应该是`dirtokeep`.

结果将是*所有内容都*将`dirtokeep`被忽略，*除了* `dirtokeep/.keep`，这将导致`dirtokeep`目录也将在克隆/签出时构建。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2021-04-15T10:06:37.717

如果您想通过手动删除这些文件来删除它们并让您的项目完全清除 GIT 之外的文件，您可以运行：

```
rm -rf $(git status --ignored) 
```

***警告***：这将**删除强制**返回的`git status --ignored`。请自行决定使用，并且仅在您知道自己在做什么的情况下使用。

* * *

## 回答 #12

> 赞同：-1
> 
> 时间：2017-08-12T11:24:19.690

假设有几个忽略目录，为什么不使用“git status node/logs/”来告诉你要添加哪些文件？在目录中，我有一个不属于状态输出的文本文件，例如：

在分支 master
你的分支是最新的'origin/master'。
未跟踪的文件：（
使用“git add ...”来包含将要提交的文件）

```
 node/logs/.gitignore 
```

.gitignore 是：

*

!.gitignore

# windows-mobile - Windows Mobile 模拟器联网到主机

> ID：466770
> 
> 赞同：2
> 
> 时间：2009-01-21T20:10:32.670
> 
> 标签：windows-mobile, networking, emulation

我正在尝试在 VS2008 中做一些 Windows Mobile 开发。WM 应用程序正在进行 WCF 调用（或尝试）。模拟器和我的 WCF 服务器在同一台台式电脑上运行。我发现了一些关于如何在 WM5 模拟器上结合 Virtual PC2007 配置网卡的细节。这确实让我现在可以上网查看模拟器，这让我比以前更接近了。但是，我无法让它识别桌面机器本身，例如[http://mycomputername/](http://mycomputername/)和[http://10.1.1.2/](http://10.1.1.2/)显然，这使得测试 WCF 方面有点困难。我错过了什么明显的东西吗？

谢谢

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-11-26T02:29:09.040

在您正在从中赢得移动开发的 Visual Studio 中，转到工具菜单，然后选择设备模拟器管理器。如果您的设备模拟器正在运行，您将在列表中看到它带有一个小箭头。右键单击此模拟器并选择“摇篮”。这应该会打开 XP 的 activesync 或 Vista 或更高版本的 windows mobile device center。安装好模拟器后，您应该能够通过 IP 或名称访问本地 PC。祝你好运，我花了太多时间试图让这个连接起来，所以我希望这能让你更快地到达那里。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-01-12T21:12:00.930

在设备管理器中摇篮后，我必须执行以下操作：

在 ActiveSync 中，从菜单中转到文件>连接设置，选中“允许连接到以下之一”框，在以下组合中选择 DMA，然后按连接按钮

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-21T21:21:40.983

暂时忘记“ [http://mycomputername/](http://mycomputername/) ”，因为这可能是 DNS 问题。您可以从您的主机 ping 到您的来宾虚拟机吗？你能用其他方式ping 通吗？（使用例如PocketPing）

WCF 服务器是否侦听主机绑定到来宾 VM 将使用的网络设备的 IP 地址？该网络连接是否在 Windows Mobile 上设置为连接到“工作”或“互联网”？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-13T06:27:00.000

不幸的是，这原来是我的病毒扫描程序的问题。谁知道它也有一个该死的防火墙......

# .net - .net 用于 Win95？

> ID：466771
> 
> 赞同：6
> 
> 时间：2009-01-21T20:10:58.190
> 
> 标签：.net, winapi

在对 .net 3.5 符号进行一些研究期间，我发现了一个预处理器指令

```
#if WIN95_SUPPORT
//...
#endif 
```

这对我来说*真的很*奇怪！它位于 System.Windows.Forms.Control 的 Control.cs 方法*void WndProc(ref Message m)*中的第 13861 行！

你们中有人知道吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-21T20:14:23.240

它可能是 Windows 95 支持的以前版本的框架遗留下来的（因为使用以前的代码库是有意义的）。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-01-21T22:56:50.103

考虑到 .NET 1.0 ( [http://en.wikipedia.org/wiki/.NET_Framework_version_list](http://en.wikipedia.org/wiki/.NET_Framework_version_list) ) 的 beta 版本是在 Microsoft 结束对 Windows 95 的支持（2001 年 12 月 31 日）之前发布的，我认为可以安全地假设开发人员直到如果他们必须支持 Windows 95，则在某些情况下。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-21T20:23:40.507

当 .NET 1.0 出现时，它最初在 Windows 98 SE 上得到支持。所以我的猜测是，考虑到您在其中找到它的程序集，它最初是作为在 Win9x Win Forms 和 WinNT（2000、XP、Vista 等）Win Forms 之间切换的一种方式。

因为 Win9x 和 WinNT 使用不同的消息传递协议。如果您不熟悉 Windows Messaging，它是 Win Forms 与操作系统就绘图、键盘事件、鼠标事件和其他所有事情进行通信的一种方式。

# objective-c - 声明变量“id”和“NSObject *”有什么区别？

> ID：466777
> 
> 赞同：44
> 
> 时间：2009-01-21T20:12:52.617
> 
> 标签：objective-c

在 Objective-C 中，声明变量`id`与声明变量有什么区别`NSObject *`？

* * *

## 回答 #1

> 赞同：51
> 
> 时间：2009-01-21T20:19:11.403

使用变量 typed `id`，您可以向它发送任何已知消息，编译器不会抱怨。使用 typed 变量`NSObject *`，您只能向其发送由 NSObject 声明的消息（而不是任何子类的方法），否则它将生成警告。一般来说，`id`就是你想要的。

进一步解释：所有对象本质上都是 type `id`。声明静态类型的目的是告诉编译器，“假设这个对象是这个类的成员。” 所以如果你给它发送一个类没有声明的消息，编译器会告诉你，“等等，那个对象不应该得到那个消息！” 此外，如果两个类具有名称相同但签名不同的方法（即参数或返回类型），它可以猜测您为变量声明的类所指的方法。如果它被声明为`id`，编译器只会举手告诉你，“好吧，我这里没有足够的信息。我正在随机选择一个方法签名。” （不过，这通常不会通过声明来帮助`NSObject*`。

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2009-01-21T20:24:10.940

`id`意思是“一个对象”，`NSObject *`意思是“一个实例`NSObject`或其子类之一”。Objective-C 中有一些不是`NSObject`s 的对象（你现在在 Cocoa 中遇到的是`NSProxy`,`Protocol`和`Class`）。如果某些代码需要特定类的对象，则声明它有助于编译器检查您是否正确使用它。如果你真的可以接受“任何对象”——例如，你要声明一个委托，并将测试所有通过`respondsToSelector:`调用发送的方法——你可以使用`id`.

声明对象变量的另一种方式是“ `id <NSObject>`”，意思是“任何实现`NSObject`协议的对象。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2009-01-21T21:09:34.970

根据我对 Objective-C 的有限理解，并非所有对象都派生自 NSObject（与 Java 中所有对象都派生自 Object 不同）。理论上，您可以拥有其他根对象。id 可以应用于任何那些非 NSObject 派生对象。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2014-11-19T16:42:19.777

我想补充另一个不同之处。当您将协议添加到 时`id`，它不再意味着它将是 type `NSObject *`，它只是意味着它将是任何确认该协议的类。

因此，例如，此代码不会抛出任何错误，因为`NSObject`' 的类别`NSDelayedPerforming`具有该方法：

```
id testId;
[testId performSelector:@selector(isKindOfClass:) withObject:[NSObject class] afterDelay:.5]; 
```

但是，此代码将显示错误`No known instance method for selector "performSelector:withObject:afterDelay:"`：

```
id<NSMutableCopying> testId;
[testId performSelector:@selector(isKindOfClass:) withObject:[NSObject class] afterDelay:.5]; 
```

# sql - 如何在 Grails/Hibernate 中计数：Message.countBy

> ID：466778
> 
> 赞同：5
> 
> 时间：2009-01-21T20:12:54.193
> 
> 标签：sql, grails, groovy, hql

如何计算正文长度在 0 到 25 个字符之间的消息数量？

```
Message.countBy('from Message m where m.body.length <= 25') 
```

对我来说不幸的是，`countBy`它不带字符串参数。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-01-21T20:35:44.507

查看动态方法参考，您可能做的最好的事情就是使用`executeQuery`而不是`count*`：

```
Message.executeQuery('select count(m) from Message m where SIZE(m.body) < 25') 
```

编辑：这里有几个链接可能有助于编写/执行查询：

*   [HQL 参考](http://www.hibernate.org/hib_docs/nhibernate/html/queryhql.html)
*   [Grails 域类动态方法参考](http://grails.org/DomainClass+Dynamic+Methods)

# visual-studio-2008 - 如何在解决方案资源管理器的 VS2005 中放大演示字体大小（用于投影仪）

> ID：466782
> 
> 赞同：0
> 
> 时间：2009-01-21T20:14:04.533
> 
> 标签：visual-studio-2008, visual-studio-2005

在VS2008中它是工具，选项，环境，字体和颜色，环境字体，然后将默认字体从自动更改为真实字体和更大的字体大小。环境字体不是 VS2005 中的设置。看起来较旧的 VS 版本是对话框和工具窗口（不再在 VS2005 或 VS2008 中）。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-21T20:16:31.673

您最好使用[Zoomit](http://technet.microsoft.com/en-us/sysinternals/bb897434.aspx)进行演示。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-21T20:45:44.173

要放大的文本是解决方案资源管理器窗口中的文本，而不是代码窗口（文本编辑器）中的文本。根据我上面从工具，选项中的评论，这可以在 VS2008 中完成，但不能在我正在寻找的 VS2005 中完成。它可以在 VS2005 之前的版本中完成。我将下载并测试 ZoomIT，感谢您的建议（我在 2008 年的 PDC 演示中看到了该建议）

我上面针对解决方案资源管理器窗口文本的评论文本（在 VS2008 中，它是工具、选项、环境、字体和颜色、环境字体，然后将默认字体从自动更改为真实字体和更大的字体大小。环境字体。）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-21T20:23:02.160

工具 -> 选项 -> 字体和颜色 -> 点击下拉“显示设置”并选择 TextEditor。然后更改字体大小。

您还可以尝试降低屏幕分辨率，特别是如果您通常使用高分辨率并且您也希望观众在 IDE 中看到其他鼠标操作（而不仅仅是代码）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-21T20:27:36.987

您要放大哪个文本？它只是源代码吗？如果是这样，它在：工具 | 选项 | 环境 | 字体和颜色 在“显示设置”下选择“文本编辑器”，并根据需要进行更改。

请注意，更改其中一种文本类型（例如纯文本）会更改所有其他文本类型（注释、行号等）。您可能想先使用工具 | 导出您的设置。选项 | 环境 | 导入和导出设置，让您可以轻松地在演示和不演示之间来回切换。

编辑：在命令行上加载设置，使其更容易切换。使用带有文件名的命令行开关 /ResetSettings，例如：/ResetSettings c:\temp\mysettings.vssettings

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-21T20:31:50.927

根据[这篇文章](http://visualstudiohacks.com/articles/general/optimize-visual-studio-for-presentations/)，您无法在解决方案资源管理器中更改文本的大小，所以我会推荐 ZoomIt。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-27T23:07:56.970

谢谢大家的帖子！我想改变整个环境……不仅仅是代码。我几乎做到了...工具->选项->环境->字体和颜色->我在冲浪之前所做的文本编辑器。然后上面提到的Roy要使用Tools->Options->Environment->Fonts and Colors->Environment Font。这样做了 92%... 比我将所有选项更改为 Arial 11 或 Tahoma 12。一切都更改了，除了：当我将它们拖到窗体时的控件。还有什么想法吗？很高兴看到我在创造什么！我还想为我的所有应用程序设置标准字体。我在哪里设置它？默认值为 Windows San Serif 8 或 Tahoma 8。

多谢你们！！希望我以后可以回报并帮助其他人。<史蒂夫>

# assembly - 汇编代码 vs 机器代码 vs 目标代码？

> ID：466790
> 
> 赞同：255
> 
> 时间：2009-01-21T20:17:27.150
> 
> 标签：assembly, machine-code, object-code

目标代码、机器代码和汇编代码有什么区别？

你能举一个直观的例子来说明它们的区别吗？

* * *

## 回答 #1

> 赞同：331
> 
> 时间：2009-01-21T20:22:51.397

**机器代码**是可以由 CPU 直接执行的二进制（1 和 0）代码。如果您在文本编辑器中打开机器代码文件，您会看到垃圾，包括不可打印的字符（不，不是*那些*不可打印的字符；））。

**目标代码**是尚未链接到完整程序中的机器代码的一部分。它是构成完整产品的特定库或模块的机器代码。它还可能包含在已完成程序的机器代码中找不到的占位符或偏移量。**链接器**将使用这些占位符和偏移量将所有内容连接在一起。

**汇编代码**是纯文本和（在某种程度上）人类可读的源代码，大部分具有直接的 1:1 模拟与机器指令。这是使用实际指令、寄存器或其他资源的助记符来完成的。示例包括用于 CPU 的跳转和乘法指令`JMP`。`MULT`与机器代码不同，CPU 不理解汇编代码。您可以使用**汇编器**或**编译器**将汇编代码转换为机器代码，尽管我们通常认为编译器与从 CPU 指令进一步抽象的高级编程语言相关联。

* * *

构建一个完整的程序涉及用汇编或更高级别的语言（如 C++）为程序编写**源代码。**源代码被汇编（对于汇编代码）或编译（对于高级语言）为目标代码，各个模块链接在一起成为最终程序的机器代码。在非常简单的程序的情况下，可能不需要链接步骤。在其他情况下，例如使用 IDE（集成开发环境），链接器和编译器可以一起调用。在其他情况下，可能会使用复杂的**make**脚本或**解决方案**文件来告诉环境如何构建最终应用程序。

还有一些行为不同的**解释语言。**解释语言依赖于特殊解释程序的机器代码。在基本级别，解释器解析源代码并立即将命令转换为新的机器代码并执行它们。现代解释器现在要复杂得多：一次评估整个源代码部分，尽可能缓存和优化，以及处理复杂的内存管理任务。

最后一种类型的程序涉及使用**运行时环境**或**虚拟机**。在这种情况下，程序首先被预编译为较低级别的**中间语言**或**字节码**. 字节码然后由虚拟机加载，即时将其编译为本机代码。此处的优势是虚拟机可以利用程序运行时可用的优化以及针对特定环境的优化。编译器属于开发人员，因此必须生成可以在许多地方运行的相对通用（优化程度较低）的机器代码。然而，运行时环境或虚拟机位于最终用户的计算机上，因此可以利用该系统提供的所有功能。

* * *

## 回答 #2

> 赞同：142
> 
> 时间：2009-07-31T15:31:14.227

其他答案很好地描述了差异，但您也要求提供视觉效果。这是一张图表，展示了他们从 C 代码到可执行文件的过程。

![](https://i.stack.imgur.com/kKTfY.png)

* * *

## 回答 #3

> 赞同：53
> 
> 时间：2009-01-21T20:23:04.907

汇编代码是机器代码的人类可读表示：

```
mov eax, 77
jmp anywhere 
```

机器码是纯十六进制代码：

```
5F 3A E3 F1 
```

我假设您的意思是目标文件中的目标代码。这是机器代码的一种变体，不同之处在于跳转是参数化的，以便链接器可以填充它们。

汇编器用于将汇编代码转换为机器代码（目标代码） 链接器链接多个目标（和库）文件以生成可执行文件。

我曾经用纯十六进制（没有可用的汇编程序）编写了一个汇编程序，幸运的是，这可以追溯到古老的（古老的）6502。但我很高兴有奔腾操作码的汇编程序。

* * *

## 回答 #4

> 赞同：20
> 
> 时间：2009-01-21T20:24:52.080

`8B 5D 32`是机器码

`mov ebx, [ebp+32h]`是组装

`lmylib.so`包含`8B 5D 32`是目标代码

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2010-12-19T02:58:10.667

尚未提及的一点是，有几种不同类型的汇编代码。在最基本的形式中，指令中使用的所有数字都必须指定为常量。例如：

```
1902 美元：BD 37 14：LDA 1437 美元，X
1905 美元：85 03 美元：STA 03 美元
1907 美元：85 09 美元：STA 09 美元
1909 美元：CA：DEX
$190A: 10 : BPL $1902

```

上述代码位，如果存储在 Atari 2600 磁带中的地址 $1900 处，将显示从地址 $1437 开始的表中提取的许多不同颜色的行。在某些工具上，输入地址以及上一行的最右边部分，会将中间列中显示的值存储到内存中，并以以下地址开始下一行。以这种形式输入代码比输入十六进制要方便得多，但必须知道所有内容的精确地址。

大多数汇编器允许使用符号地址。上面的代码会写得更像：

```
彩虹lp：
  lda ColorTbl,x
  STA WSYNC
  斯塔哥伦布
  索引
  bpl Rainbow_lp

```

汇编器会自动调整 LDA 指令，使其引用映射到标签 ColorTbl 的任何地址。与必须手动键入和手动维护所有地址相比，使用这种类型的汇编器可以更轻松地编写和编辑代码。

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2019-04-06T21:51:29.883

源代码、汇编代码、机器代码、目标代码、字节代码、可执行文件和库文件。

对于大多数人来说，所有这些术语通常都非常令人困惑，因为**他们认为它们是相互排斥的**。查看图表以了解它们的关系。下面给出每个术语的描述。

[![代码类型](https://i.stack.imgur.com/SJO6y.png)](https://i.stack.imgur.com/SJO6y.png)

### 源代码

人类可读（编程）语言的指令

### 高级代码

用高级（编程）语言编写的指令，
例如 C、C++ 和 Java 程序

### 汇编代码

用汇编语言（一种低级编程语言）编写的指令。作为编译过程的第一步，高级代码被转换成这种形式。它是汇编代码，然后被转换为实际的机器代码。在大多数系统上，这两个步骤是作为编译过程的一部分自动执行的。
例如，program.asm

### 对象代码

编译过程的产物。它可以是机器码或字节码的形式。
例如，file.o

### 机器码

机器语言指令。
例如，a.out

### 字节码

可以由解释器（如 JVM）执行的中间形式的指令。
例如，Java 类文件

### 可执行文件

链接过程的产物。它们是可以由 CPU 直接执行的机器代码。
例如，.exe 文件。

请注意，在某些情况下，包含字节码或脚本语言指令的文件也可能被视为可执行文件。

### 库文件

一些代码出于不同的原因编译成这种形式，例如可重用性和以后由可执行文件使用。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-01-21T20:45:11.180

汇编是人类可以理解的简短描述性术语，可以直接翻译成 CPU 实际使用的机器代码。

虽然人类可以理解，但汇编程序仍然是低级的。做任何有用的事情都需要大量的代码。

因此，我们改为使用更高级的语言，例如 C、BASIC、FORTAN（好吧，我知道我已经过时了）。当编译这些产生目标代码。早期语言将机器语言作为其目标代码。

今天的许多语言，如 JAVA 和 C#，通常编译成不是机器码的字节码，而是一种在运行时很容易被解释以产生机器码的字节码。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-01-21T20:21:02.210

汇编代码在[这里](http://en.wikipedia.org/wiki/Assembly_language)讨论。

“汇编语言是一种用于计算机编程的低级语言。它实现了对特定 CPU 架构进行编程所需的数字机器代码和其他常量的符号表示。”

机器码在[这里](http://en.wikipedia.org/wiki/Machine_code)讨论。

“机器代码或机器语言是由计算机中央处理单元直接执行的指令和数据系统。”

基本上，汇编代码是一种语言，它由汇编程序（类似于编译器）翻译成目标代码（CPU 运行的本机代码）。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-01-21T20:26:25.150

我认为这些是主要区别

*   代码的可读性
*   控制你的代码在做什么

可读性可以在代码创建 6 个月后改进或替换代码，另一方面，如果性能很关键，您可能希望使用低级语言来针对您将在生产中拥有的特定硬件，因此要获得更快的执行。

IMO 今天的计算机足够快，可以让程序员通过 OOP 获得快速执行。

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2019-11-19T18:42:56.783

程序的源文件被编译成目标文件，然后链接器将这些目标文件链接在一起，生成一个包含架构机器代码的可执行文件。

目标文件和可执行文件都涉及架构的机器代码，当它被文本编辑器打开时，它以可打印和不可打印字符的形式出现。

尽管如此，文件之间的二分法是目标文件可能包含未解析的外部引用（例如`printf`，例如）。因此，它可能需要链接到其他目标文件。也就是说，需要解析未解析的外部引用，以便通过与其他目标文件（如 C/C++ 运行时库的链接）获得体面的可运行可执行文件.

# c# - 对 CeGetVolumeInfo 的 Pinvoke 调用需要未知的枚举值

> ID：466792
> 
> 赞同：1
> 
> 时间：2009-01-21T20:17:49.863
> 
> 标签：c#, windows-mobile, pinvoke

我对 PInvoke 调用还很陌生，所以我希望有人可以帮助我解决这个问题：

我正在尝试从 C# 项目中 PInvoke 对 CeGetVolumeInfo() 的调用，该调用保存在 CoreDll.dll 中。 [这](http://msdn.microsoft.com/en-us/library/aa912305.aspx)是 MSDN 中此函数的定义：

```
 WINBASEAPI BOOL CeGetVolumeInfo(  
 LPCWSTR pszRootPath,  
 CE_VOLUME_INFO_LEVEL InfoLevel,  
 LPCE_VOLUME_INFO lpVolumeInfo ); 
```

我的问题是`CE_VOLUME_INFO_LEVEL`参数。我假设它是某种枚举，但我无法弄清楚它的实际价值是什么（MSDN 没有为它提供任何价值信息），谷歌搜索它几乎一无所获。

有关如何获取/使用 PInvoke 可访问 dll 中定义的枚举的未知值的任何建议？

谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-21T20:59:47.250

看下面的链接 [链接文字](http://msdn.microsoft.com/en-us/library/aa912305.aspx)

“InfoLevel [in] 请求的信息类型。目前，此值必须设置为 CeVolumeInfoLevelStandard。”

从头文件 storemgr.h

> typedef enum _CE_VOLUME_INFO_LEVEL { CeVolumeInfoLevelStandard, } CE_VOLUME_INFO_LEVEL;

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-21T22:52:43.280

我*知道*这一定很简单。我只是对整个“头文件”部分完全视而不见……下载了 Windows CE 5.0 sdk，现在我是直的。

再次感谢！

# iframe - name 属性的替换

> ID：466796
> 
> 赞同：1
> 
> 时间：2009-01-21T20:19:11.653
> 
> 标签：iframe, attributes, replace

我很困惑。我需要命名我的 iframe，以便在我的菜单的超链接中使用该名称作为目标。根据我的 Visual Web Developer Express，name 属性被认为是过时的，需要一个新的构造。我的问题是我用什么属性代码来命名我的 iframe。谢谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-21T21:04:43.683

> 根据我的 Visual Web Developer Express，name 属性被认为是过时的，需要一个新的构造。

那么 Visual Web Developer Express 是错误的。出于锚点和脚本/样式挂钩的目的，'name' 将替换为 'id'，但出于识别链接目标（例如框架）的目的，它不是。见[http://www.w3.org/TR/REC-html40/present/frames.html#adef-target](http://www.w3.org/TR/REC-html40/present/frames.html#adef-target) , [http://www.w3.org/TR/REC-html40/present/frames.html#adef -名称-IFRAME](http://www.w3.org/TR/REC-html40/present/frames.html#adef-name-IFRAME)。

这种用法在 HTML 术语中并未被弃用，但它有点代码味道。将链接定位到 iframe 通常被认为是一件坏事，因为它打破了许多正常的导航预期。有它的用途，但要小心。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-21T20:44:05.533

忽略警告。相信 DOCTYPE 规范。name 属性很好。事实上，通过嵌入式 HTML 表单的 HTTP 帖子使用 name 属性作为键来传递数据。

```
<input id="txtName" name="name" /> 
```

要获取 Page_Load 中的文本框值，您将使用 Request.Form("name")，而不是 Request.Form("txtName")

如果对属性等有疑问，请通过[W3 验证器](http://validator.w3.org)运行呈现的 HTML ，以根据 DOCTYPE 对其进行验证。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-21T20:36:52.617

通常，您会使用“id”属性作为替代。这并不总是“最佳的”。例如，我注意到这并不总是适用于命名锚点。

# c# - 如何枚举 C# 中的所有托管线程？

> ID：466799
> 
> 赞同：25
> 
> 时间：2009-01-21T20:20:02.043
> 
> 标签：c#, multithreading

是否可以枚举 C# 中的所有托管线程？当您在调试时遇到断点时，Visual Studio 似乎能够做到这一点。在“线程”窗口中，它显示了所有正在运行的线程的列表，包括托管名称。有谁知道它是怎么做到的？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-21T20:23:09.273

调试器通常能够做“正常”代码做不到的事情。如果您使用分析/调试 API，您可能会发现您可以做到这一点，但我不相信您可以从“普通”.NET 代码中做到这一点。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-01-21T20:30:41.647

[这听起来像是“如何使用 Name 属性在 .NET 中枚举线程？](https://stackoverflow.com/questions/427485/how-to-enumerate-threads-in-net-using-the-name-property) ”的副本- 如果是这样，简短的回答是“自己跟踪自己的线程” - 即在 a`List<Thread>`或类似中。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-06-28T15:52:51.310

看看[托管堆栈资源管理器](http://mse.codeplex.com/)：

> MSE 的工作原理是在请求堆栈跟踪时快速附加到进程，并在检索到堆栈跟踪的第二秒时分离。这样可以最大限度地减少对过程正常操作的干扰。

不幸的是，这意味着它**必须**由外部进程完成。

一个类似的工具是[StackDump](http://stackdump.codeplex.com/)，它使用[MDbg](http://msdn.microsoft.com/en-us/library/ms229861.aspx)来生成转储。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2020-12-22T09:40:23.797

[您可以通过向ProcInsp](https://github.com/CUSTIS-public/ProcInsp)发出 HTTP GET 请求来枚举线程。ProcInsp 允许您获取具有 CLR 进程堆栈跟踪的线程（在其 UI 中或作为 JSON 消息）。Web API 可在`/Process/%PID%/Threads`.

免责声明：我是这个工具的开发者。它是麻省理工学院许可的，可以免费使用。

# python - Windows 上的 Python 管道：为什么这不起作用？

> ID：466801
> 
> 赞同：11
> 
> 时间：2009-01-21T20:20:05.613
> 
> 标签：python, windows, piping

我正在尝试这样的事情

输出.py

```
print "Hello" 
```

输入.py

```
greeting = raw_input("Give me the greeting. ")
print "The greeting is:", greeting 
```

在 cmd 行

```
Output.py | Input.py 
```

但它返回一个*EOFError*。有人可以告诉我我做错了什么吗？

谢谢你的帮助。

**编辑**
帕特里克哈灵顿[解决方案](https://stackoverflow.com/questions/466801/python-piping-on-windows-why-does-this-not-work#466851)有效，但我不知道为什么......

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2009-01-21T20:30:27.183

我在我的 Windows 机器上测试了它，如果你指定 Python exe，它就可以工作：

```
C:\>C:\Python25\python.exe output.py | C:\Python25\python.exe input.py
Give me the greeting. The greeting is: hello 
```

但是如果直接运行命令，我也会得到一个 EOFError ：

```
output.py | input.py 
```

我不确定这是为什么，我仍在研究这个，但至少现在这应该为您提供一种解决方法。它可能与为 .py 文件调用文件处理程序的方式有关。

**更新**：嗯，你知道什么。看起来这实际上是 Windows 中的一个错误，从文件关联启动时，stdin/stdout 重定向可能无法正常工作。所以解决方法正如我和帕特里克所指出的那样，您需要指定“python”将运行 input.py，否则它不会将 stdout 从 output.py 正确重定向到 input.py 的 stdin。

*参考*：

**[http://mail.python.org/pipermail/python-bugs-list/2004-August/024923.html](http://mail.python.org/pipermail/python-bugs-list/2004-August/024923.html)**

**[http://support.microsoft.com/default.aspx?kbid=321788](http://support.microsoft.com/default.aspx?kbid=321788)**

**更新 2**：

要更改此行为并使 Windows 管道按预期工作以进行 stdin/stdout 重定向，您可以将此值添加到注册表（在我的盒子上测试并验证它是否按预期工作）。

> 1.  启动注册表编辑器。
> 2.  在注册表中找到并单击以下项：
>     
>     
>     
>     **HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Policies\Explorer**
>     
>     
> 3.  在编辑菜单上，单击添加值，然后添加以下注册表值：
>     
>     
>     
>     值名称：*InheritConsoleHandles*
>     数据类型：*REG_DWORD*
>     基数：十进制
>     值数据：1
>     
>     
> 4.  退出注册表编辑器。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-21T20:30:46.560

将其更改为：

```
Output.py | python Input.py 
```

输出将是：

> 给我打招呼。问候语是：你好

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-22T01:22:47.173

这就是你得到 EOFError 的原因（来自 raw_input 的文档）：

> 然后该函数从输入中读取一行，将其转换为字符串（去除尾随的换行符），然后返回。读取 EOF 时，会引发 EOFError。

[http://docs.python.org/library/functions.html?highlight=raw_input#raw_input](http://docs.python.org/library/functions.html?highlight=raw_input#raw_input)

您可能想要使用**sys.stdin**，它提供了一个文件对象，您可以从中使用 read、readlines 方法。

```
import sys
for greeting_line in sys.stdin.readlines():
    print "The greeting is:", greeting_line.strip() 
```

# c++ - 我如何用精神正确地解析这个？

> ID：466802
> 
> 赞同：3
> 
> 时间：2009-01-21T20:20:27.750
> 
> 标签：c++, visual-c++-6, boost-spirit, greedy

我的情况：我是 Spirit 的新手，我必须使用 VC6，因此我使用的是 Spirit 1.6.4。

我有一条看起来像这样的线：

```
//The Description;DESCRIPTION;; 
```

`DESCRIPTION`如果行以 . 开头，我想将文本放入字符串中`//The Description;`。

我有一些有用的东西，但对我来说看起来并不那么优雅：

```
vector<char> vDescription; // std::string doesn't work due to missing ::clear() in VC6's STL implementation
if(parse(chars,
    // Begin grammar
    (
       as_lower_d["//the description;"]
    >> (+~ch_p(';'))[assign(vDescription)]
    ),
    // End grammar
    space_p).hit)
{
    const string desc(vDescription.begin(), vDescription.end());
} 
```

我更想将所有可打印字符分配到下一个`';'`，但以下不起作用，因为`parse(...).hit == false`

```
parse(chars,
        // Begin grammar
        (
           as_lower_d["//the description;"]
        >> (+print_p)[assign(vDescription)]
        >> ';'
        ),
        // End grammar
        space_p).hit) 
```

我如何让它击中？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-21T22:30:05.320

你没有受到打击，因为';' 由 print_p 匹配。试试这个：

```
parse(chars,
    // Begin grammar
    (
       as_lower_d["//the description;"]
    >> (+(print_p-';'))[assign(vDescription)]
    >> ';'
    ),
    // End grammar
    space_p).hit) 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-21T22:43:25.310

您可以尝试使用[`confix_p`](http://www.boost.org/doc/libs/1_37_0/libs/spirit/classic/doc/confix.html)：

```
confix_p(as_lower_d["//the description;"],
         (+print_p)[assign(vDescription)],
         ch_p(';')
        ) 
```

它应该等同于[Fred 的响应](https://stackoverflow.com/questions/466802#467316)。

您的代码失败的原因是`print_p`因为*greedy*。解析器将`+print_p`使用字符，直到遇到输入的结尾或不可打印的字符。分号是可打印的，所以`print_p`声称它。您的输入已用尽，变量已分配，匹配失败 - 解析器的最后一个分号无法匹配。

Fred 的回答构造了一个新的解析器 ，`(print_p - ';')`它匹配`print_p`除了分号之外的所有内容。“匹配除*X*之外的所有内容，然后匹配*X* ”是一种常见模式，因此`confix_p`被提供为构建这种解析器的快捷方式。文档建议使用它来解析 C 或 Pascal 样式的注释，但这不是必需的。

为了使您的代码正常工作，Spirit 需要识别贪婪`print_p`匹配太多，然后*回溯*以允许匹配更少。但是尽管 Spirit 会回溯，但它不会回溯到子解析器贪婪匹配的“中间”。它会回溯到下一个“选择点”，但你的语法没有。请参阅Spirit 文档中的[*详尽回溯和贪婪 RD*](http://www.boost.org/doc/libs/1_37_0/libs/spirit/classic/doc/rationale.html#exhaustive_rd)。

# c# - 将 GUI 导出为 XML？

> ID：466808
> 
> 赞同：1
> 
> 时间：2009-01-21T20:22:08.730
> 
> 标签：c#, java, wpf, xaml

是否有一种工具可以采用 C# 或其他语言设计的 GUI，可以采用屏幕布局并将其导出到 XML 文件，以便最终获得 XML 术语的屏幕模板？以及获取一个 XML 文件并显示结果屏幕？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-21T20:43:39.187

您是否研究过 WPF 中的 XAML？您提到了 C#，所以这似乎与您所询问的内容直接一致。

[http://en.wikipedia.org/wiki/XAML](http://en.wikipedia.org/wiki/XAML)

另一个很好的起点可能是：

[http://en.wikipedia.org/wiki/List_of_user_interface_markup_languages](http://en.wikipedia.org/wiki/List_of_user_interface_markup_languages)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-21T20:44:29.200

XAML 和 XUL 旨在以这种方式工作。QT 和 Glade 也提供此功能。但是，它们（据我所知）没有提供任何工具来对不是使用布局工具创建的 GUI 进行逆向工程。

要使用这种类型的工具，您必须从表单设计器开始，它将表单保存为描述符文件。然后，工具包将提供各种方法（具体方法因工具包而异）来加载描述符文件并从中渲染屏幕，或者将描述符用作代码生成器的输入。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-01-21T20:29:12.680

有`java.beans.XMLEncoder`/ `XMLDecoder`。但如果你想做那种事情，我认为你被误导了。

# php - PHP 的 json_decode() 行为异常

> ID：466809
> 
> 赞同：0
> 
> 时间：2009-01-21T20:22:16.140
> 
> 标签：php, json

我有两个类似的 JSON 文件。我可以用 阅读其中一个`json_decode()`，但不能阅读另一个。

我已将文件上传到[www.huzursuz.com/json/json_test.rar](http://www.huzursuz.com/json/json_test.rar)

如果您想检查它们，`brother_a.php`正在工作，而`brother.php`没有。

我认为问题不是`json_decode`嵌套限制，因为文件非常相似。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-21T20:30:54.313

你从哪里得到这么大的 JSON 字符串？

根据[`json_decode`](http://us.php.net/json_decode)文档，如果 json 在某些方面格式不正确，它只会返回 NULL，这就是我在尝试 Brother.php 时得到的

```
// the following strings are valid JavaScript but not valid JSON

// the name and value must be enclosed in double quotes
// single quotes are not valid 
$bad_json = "{ 'bar': 'baz' }";
json_decode($bad_json); // null

// the name must be enclosed in double quotes
$bad_json = '{ bar: "baz" }';
json_decode($bad_json); // null

// trailing commas are not allowed
$bad_json = '{ bar: "baz", }';
json_decode($bad_json); // null 
```

**编辑**

我通过[`JSONLint`](http://www.jsonlint.com/)一个 JSON 验证器运行了您的两个 JSON 文件，并且正如预期的那样，该`brother+a`文件通过了，但`brother`在一些地方出现了格式错误。

# nhibernate - 有没有办法用 where 子句一对一映射？

> ID：466816
> 
> 赞同：0
> 
> 时间：2009-01-21T20:23:36.840
> 
> 标签：nhibernate, hibernate, nhibernate-mapping, hibernate-mapping

请原谅我对这个话题的无知，因为我对 Hibernate / NHibernate 比较陌生，但我遇到了一个我无法弄清楚的映射：

这是我的数据库表的样子：

```
<bincontents> 
  <id>5873715</id> 
  <title>Video Title</title> 
  <sortorder>0</sortorder> 
  <itemid>23079</itemid> 
  <itemtype>VIDEO</itemtype> 
</bincontents> 
<bincontents> 
  <id>5873716</id> 
  <title>Clip Title</title> 
  <sortorder>1</sortorder> 
  <itemid>131854</itemid> 
  <itemtype>CLIP</itemtype> 
</bincontents> 
```

有没有办法用 where 子句一对一映射？

所以 BinContent 对象的 ItemType 可以是 VIDEO 或 CLIP。这些是作为字符串键入的，不幸的是我无法更改。

因此，如果 ItemType 字段显示“VIDEO”，我想要一个多对一“视频”对象，但是如果 ItemType 字段显示“CLIP”，我想要一个多对一剪辑.

帮助！

在这种情况下，我什至不确定是否要使用多对一。也许是一对一？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-21T20:40:58.520

在我看来，您有继承人的候选人。如果您有一个 BinContents 的抽象基类型，则有一个 VideoBinContents 的派生类，它只包含一个视频映射，以及一个 ClipBinContents，它只包含一个剪辑映射。您的 itemtype 是您的鉴别器。在这里查看更多信息：[http ://www.hibernate.org/hib_docs/reference/en/html/inheritance.html](http://www.hibernate.org/hib_docs/reference/en/html/inheritance.html)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-21T20:39:56.260

难道你不能在你的类中同时拥有 Video 和 Clip 对象，并确保它们永远不会同时填充吗？可能需要您提供更多信息，例如您当前的班级结构。另外，每个 Bin 对象是否只有一个视频，反之亦然？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-21T20:43:59.887

也许这比您正在寻找的更复杂，但似乎您可以为您的垃圾箱设置一个基类并拥有 Video 或 Clip 的子类。使用每个类继承层次结构的表，您可以使用现有的表结构。

这样做将允许您为每个子类提供不同的映射。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-21T20:45:03.503

你可以看看 any 映射。使用“任何”映射，您可以定义多态关联。

检查[这个（第 5.2.4 段）](http://www.hibernate.org/hib_docs/nhibernate/html/mapping.html)

无论如何，我不熟悉你的“领域”，但我认为吉姆也有一点。也许您应该检查您的数据模型和域模型（如果可能），看看这里是否不适合某种继承。

# asp.net - 如何使我的 Selenium 测试不那么脆弱？

> ID：466819
> 
> 赞同：23
> 
> 时间：2009-01-21T20:23:50.117
> 
> 标签：asp.net, testing, selenium

我们使用 Selenium 来测试 ASP.NET 应用程序的 UI 层。许多测试用例测试跨越多个页面的较长流程。

我发现测试非常脆弱，不仅被实际更改页面的代码更改破坏，而且还被无害的重构所破坏，例如重命名控件（因为我需要将控件的 clientID 传递给 Selenium 的 Click 方法等）或替换带有中继器的网格视图。结果，我发现自己在“浪费”时间更新测试用例中的字符串值以修复损坏的测试。

有没有办法编写更易维护的 Selenium 测试？还是更好的 Web UI 测试工具？

**编辑添加：** 通常，第一稿是通过在 IDE 中记录测试来创建的。（这第一步可能由 QA 人员执行。）然后我重构生成的 C# 代码（提取常量、提取重复代码的方法、可能用不同的数据重复测试用例等）。但是每个测试用例的一般代码流仍然相当接近最初生成的代码。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-07-11T17:04:14.253

我发现 PageObject 模式非常有用。

[http://code.google.com/p/webdriver/wiki/PageObjects](http://code.google.com/p/webdriver/wiki/PageObjects)

更多信息： -[硒的意义何在？](https://stackoverflow.com/questions/616810/whats-the-point-of-selenium/616887) -[硒批评](https://stackoverflow.com/questions/99876/selenium-critique/211452)

也许一个好的开始方法是逐步重构您的测试用例。

我使用与 selenium + c# 相同的场景

这是我的代码的样子：

## 测试方法看起来像这样

```
 [TestMethod]
    public void RegisterSpecialist(UserInfo usrInfo, CompanyInfo companyInfo)
    {
        var RegistrationPage = new PublicRegistrationPage(selenium)
              .FillUserInfo(usrInfo)
              .ContinueSecondStep();
        RegistrationPage.FillCompanyInfo(companyInfo).ContinueLastStep();
        RegistrationPage.FillSecurityInformation(usrInfo).ContinueFinishLastStep();
        Assert.IsTrue(RegistrationPage.VerifySpecialistRegistrationMessagePayPal());
        selenium.WaitForPageToLoad(Resources.GlobalResources.TimeOut);
        paypal.LoginSandboxPage(usrInfo.sandboxaccount, usrInfo.sandboxpwd);
        Assert.IsTrue(paypal.VerifyAmount(usrInfo));
        paypal.SubmitPayment();
        RegistrationPage.GetSpecialistInformation(usrInfo);
        var bphome = new BPHomePage(selenium, string.Format(Resources.GlobalResources.LoginBPHomePage, usrInfo.AccountName, usrInfo.Password));
        Assert.IsTrue(bphome.VerifyPageWasLoaded(usrInfo));
        Assert.IsTrue(bphome.VerifySpecialistProfile());
        bphome.Logout();
    } 
```

## 页面对象将是这样的

```
public class PublicRegistrationPage
{
    public ISelenium selenium { get; set; }

    #region Constructors
    public PublicRegistrationPage(ISelenium sel)
    {
        selenium = sel;
        selenium.Open(Resources.GlobalResources.PublicRegisterURL);
    }
    #endregion
    #region Methods

    public PublicRegistrationPage FillUserInfo(UserInfo usr)
    {
        selenium.Type("ctl00_cphComponent_ctlContent_wizRegister_tUserFirstName", usr.FirstName);
        selenium.Type("ctl00_cphComponent_ctlContent_wizRegister_tUserLastName", usr.LastName);
        selenium.Select("ctl00_cphComponent_ctlContent_wizRegister_ddlUserCountry", string.Format("label={0}",usr.Country ));
        selenium.WaitForPageToLoad(Resources.GlobalResources.TimeOut);
        selenium.Type("ctl00_cphComponent_ctlContent_wizRegister_tUserEmail", usr.Email );
        selenium.Type("ctl00_cphComponent_ctlContent_wizRegister_tUserDirectTel", usr.DirectTel);
        selenium.Type("ctl00_cphComponent_ctlContent_wizRegister_tUserMobile", usr.Mobile);
        return this;
    } 
```

}

希望这可以帮助。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-21T20:40:58.897

您如何通过录制和回放来创建 Selenium 测试？我们所做的是围绕页面构建一个对象模型，这样您就可以调用诸如“clickSubmit()”之类的方法，而不是单击一个 id（这些 id 有一个命名约定），这使得 selenium 测试能够在许多变化中存活下来。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-06T01:06:11.113

您可能会也可能不会编写对重构具有弹性的测试。以下是使重构不那么痛苦的方法： 持续集成是必不可少的。

每天或每次构建运行它们。越早修复越容易。

确保开发人员可以自己运行测试。同样，越早看到并修复它，就越容易。

尽量少做硒测试。他们应该关注关键路径/pri 1 测试场景。深度测试应该在单元测试级别（或 jsunit 测试）进行。集成测试总是很昂贵且价值较低。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2021-02-05T01:47:15.360

连接任何低级概念，如 XPath、CSS 选择器或用于端到端测试的 ID，都是不稳定测试的秘诀。我建议使用[testRigor](https://testrigor.com)来生成在您运行/更改/改进应用程序时不会中断的测试。类似于上面的页面对象的代码如下所示：

```
 enter "Peter" into "First Name"
    enter "Pen" into "Last Name"
    enter "US" into "Country" below "User Data"
    enter stored value "email" into "Email"
    enter stored value "password" into "Password"
    enter "415-123-4567" into "Direct Telephone"
    enter "415-123-4568" into "Mobile Number"
    click "Submit" 
```

testRigor 会将看起来像标签的文本与输入相关联，这样一旦从最终用户的角度来看，您的页面看起来相同，那么 testRigor 脚本就会变成绿色。这是[文档](https://testrigor.com/docs/language)。

免责声明：我是 testRigor 的联合创始人。我共同创立了它，因为我们自己也有这些确切的问题。

希望这可以帮助。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-21T23:05:48.400

在测试自动化方面没有无害的变化；）

我们将[SAFS 框架](http://safsdev.sourceforge.net/Default.htm)与 Rational Robot (RRAFS) 一起使用，以尽量减少对我们的自动化脚本的影响。仍然需要维护应用程序映射，但脚本在大多数情况下保持稳定。SAFS 框架听起来与 cynicalman 提到的方法非常相似，但已经打包了您将在脚本中使用的通用方法。

SAFS 网站说对 Selenium 有部分支持，所以这可能对你有用。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-28T18:18:43.770

我发现在 Selenuium-RC 中使用 XPath 表达式大大增加了测试的稳健性。

我以类似的方式编写测试。第一遍通常是通过 IDE/Record 编写的，以获取我的大部分页面流和单击操作。完成后，我开始通过 Selenium-RC 逐步完成测试，添加断言并将绝对小部件定位器更改为更易读和更友好的 Xpath 表达式。（以及记录测试！:)）

需要注意的一件事.. 如果您的测试是 xpath-heavy，由于其糟糕的 javascript 执行能力，它们在 IE6 中的运行速度可能会慢一些。（我有一些测试套件在 IE 下的执行时间比在 FF 下的执行时间要长近一个小时。它是可管理的，但在编写测试时要记住一些事情。）

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2016-03-02T16:24:01.900

Selenium 理论上有一个称为**UI 元素**的抽象（文档在[此处](https://selenium.googlecode.com/git/javascript/selenium-core/scripts/ui-doc.html)）。

特点是

*   抽象定位器，独立于 html 实现；这将很好地映射到 Web 框架的组件或小部件的概念，

*   汇总规则，允许将多个命令合并为一个更抽象的命令。

我已经挣扎了几天来利用这个功能，但最后我决定放弃它，原因如下：

*   一些概念，例如偏移定位器的概念（将它们视为组件的一部分）没有得到充分或有用的开发；
*   格式化程序不完全支持该功能，并且格式化程序越新，支持的功能就越少，这暗示核心 Selenium 进化正在留下这个功能；
*   它没有完全集成在 Selenium 2.0 (WebDriver) 中。

* * *

## 回答 #8

> 赞同：-2
> 
> 时间：2010-11-01T05:30:10.697

我认为 Xpath 是确保稳健的硒测试的最佳方式。我目前正在开发一个库来帮助更轻松地编写 xpath 表达式。

如果有兴趣，可以在这里查看： [http ://www.unit-testing.net/CurrentArticle/How-To-Write-XPath-for-Selenium-Tests.html](http://www.unit-testing.net/CurrentArticle/How-To-Write-XPath-for-Selenium-Tests.html)

# c++ - 面向 C/C++ 程序员的数学资源

> ID：466820
> 
> 赞同：14
> 
> 时间：2009-01-21T20:23:54.110
> 
> 标签：c++, math

我的学位是电气和计算机工程，但我目前是一名软件工程师。我参加了所有代数、几何和微积分课程，这些课程是人们期望从我的学位获得的人，但我必须承认，我认为我学到的东西刚好可以通过考试，但从未真正看到它的用处，因此从未真正保留很多该材料。

现在我已经成熟了一些，我一直看到它的用途。我知道有很多地方可以通过数学知识改进我的编码，所以我准备好重新学习旧的东西并学习一些新的东西。

你最喜欢的资源是什么？（如果有的话，可以将数学与编程联系起来的资源会更好！） 书？网站？博客？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-01-21T20:27:29.813

我发现这个关于这个主题的博客很有趣：

[http://steve-yegge.blogspot.com/2006/03/math-for-programmers.html](http://steve-yegge.blogspot.com/2006/03/math-for-programmers.html)

也有一些书籍推荐。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-01-21T20:29:47.450

[Wolfram MathWorld](http://mathworld.wolfram.com/)是我最喜欢的所有数学资源之一。[维基百科](http://www.wikipedia.org)也有大量的数学资源。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-01-21T20:30:53.503

我认为这些书将帮助您设计算法：

[算法简介](https://rads.stackoverflow.com/amzn/click/com/0262032937)

[具体数学：计算机科学的基础](https://rads.stackoverflow.com/amzn/click/com/0201558025)

[离散数学及其应用](https://rads.stackoverflow.com/amzn/click/com/0073229725)

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-01-21T20:34:36.210

[Hacker's Delight](http://books.google.co.nz/books?id=iBNKMspIlqEC)是一本关于数学和编程的很棒的小书。简介：

> 作者多年来收集的有用的编程建议；使程序员的任务更容易的小算法。终于，证明了掌握计算机编程困难方面的捷径。学习编程的水平比通常在学校和培训课程中教授的水平更高，并且比通过个人学习/经验学习的水平更高。程序员的即时崇拜经典！

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-01-21T20:26:26.163

我不使用很多“真正的数学”，但是当我需要记住我在学校使用的那些公式时，我会去谷歌。很多结果都[在这里](http://mathforum.org/dr.math/)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-21T20:32:38.787

好吧，总是有[Stack Overflow](http://stackoverflow.com)。:) 说真的，如果你有一个涉及数学和编程的特定问题，你可以做得比在这里发布更糟糕。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-01-21T20:35:57.110

已经提到了很多最好的资源，但是既然你特别提到了 C++，你应该看看*C++ 中的数字食谱，3d ed*，ISBN-13：9780521880688。

此外，网络上最好的数学资源之一是[MathsChallenge.net](http://mathschallenge.net/index.php?section=project)及其配套网站[Project Euler](http://projecteuler.net/)。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-01-21T20:52:20.930

几周前我收藏了一个类似的 Stack Overflow 问题，其中包含有关该主题的一些很好的信息：

[成为优秀程序员的必备数学？](https://stackoverflow.com/questions/434647/essential-math-for-excelling-as-a-programmer)

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-01-21T21:03:59.660

另一位发帖人推荐*了 C++ 中的数值食谱，*但发布了一个旧版本的链接。较新*的 C++ 数字食谱，3d 版*，ISBN-13: 9780521880688，是一个很好的资源。

[替代文字 http://ak.buy.com/db_assets/prod_lrg_images/909/204734909.jpg](http://ak.buy.com/db_assets/prod_lrg_images/909/204734909.jpg)

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-01-21T21:07:27.563

克努特。[http://www.amazon.com/Art-Computer-Programming-Volumes-Boxed/dp/0201485419](https://rads.stackoverflow.com/amzn/click/com/0201485419)

或者我喜欢这样称呼它：那个让我意识到我实际上并没有发明或发现任何多年来不为人知的东西的人。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-09-21T14:18:09.567

[科学家和工程师的数学复习](https://rads.stackoverflow.com/amzn/click/com/0471757152)（作者：John R. Fanchi）

[工程师的即时数学](https://rads.stackoverflow.com/amzn/click/com/0750675357)（Archibald L. Fripp、Jon B. Fripp 和 Michael L. Fripp）

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-01-21T21:04:37.397

[我真的很喜欢Mastering Technical Mathematics 3rd Edition](https://rads.stackoverflow.com/amzn/click/com/0071494480)这本书。这是一种以技术为重点的数学鸟瞰图。它从诸如加法和乘法之类的简单概念开始，但在解释这些概念时，它也解释了计算机如何进行计算。大约在中途你会发现二次方程和微积分。第 442 页开始讨论“一般时空超卷”。我在那里没有看到任何关于矩阵数学的内容，但是对于一本好的“简而言之关于数学的一切”类型的书来说，它很棒。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-01-21T22:02:16.733

我自己也有过这种经历……我发现的更全面的起点之一是麻省理工学院的 OpenCourseWare 网站。他们实际上在线免费提供了他们的整个计算机科学数学课程材料（以及许多其他课程材料）。这是数学课程的链接：

[http://ocw.mit.edu/OcwWeb/Electrical-Engineering-and-Computer-Science/6-042JFall-2005/CourseHome/index.htm](http://ocw.mit.edu/OcwWeb/Electrical-Engineering-and-Computer-Science/6-042JFall-2005/CourseHome/index.htm)

这不是计算机数学的全部，但它是一个很好的起点，并找出您可能需要收集的其他研究。

# c++ - 警告和 SunStudio C++ 编译器

> ID：466827
> 
> 赞同：0
> 
> 时间：2009-01-21T20:24:31.317
> 
> 标签：c++, solaris, warnings, sunstudio

我说服我的团队再次打开编译器警告。一些如何禁用所有警告（-w）（不要问......）。其中大多数是显而易见的，但其中之一真的很烦人。我从我在很多地方使用的日期和时间课程中得到它。故事真的很简单。Time 是 Date 的子类，它们都定义了它们的运算符。这有什么问题？这是我得到的警告：

```
Warning: ACTime::operator- hides the function ACDate::operator-(const ACDate&) const. 
```

也许有人可以将描述每个 SunStudio C++ 编译器警告含义的文档链接给我？我找不到这个...谢谢！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-21T20:45:04.003

我以前在 SunStudio 编译器中看到过这种情况。基本上，你有一个这样的结构：

```
class ACDate
{
   public:
     ACDate &operator-(const ACDate &);
};

class ACTime : public ACDate
{
    public:
    ACTime &operator-(const ACTime &);
}; 
```

由于 C++ 范围规则，ACTime::operator- 将 ACDate::operator- 隐藏在 ACTime 对象的上下文中。这很正常，但 SunStudio 编译器会警告此问题，因为它可能是缺少“虚拟”限定符的标志。

这种情况的一种解决方法是在 ACTime 的类声明中明确“使用 ACDate::operator-”，但这可能不是您想要的。

对于您的情况，另一个可能更好的解决方法是使 operator- 成为免费的朋友功能，但这可能会导致其他有趣的问题。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-21T20:35:15.757

我可以帮助你解决这个特定的警告 - 它看起来很像[C++ FAQ Lite](http://www.parashift.com/c++-faq-lite/strange-inheritance.html#faq-23.9)中的这个。您是否偶然更改了 ACTime::operator- 使用的参数类型，而不是 ACDate 中的参数类型？

# linux - 在 J2ME WTK 模拟器中通过 Linux 捕获音频

> ID：466833
> 
> 赞同：0
> 
> 时间：2009-01-21T20:25:34.980
> 
> 标签：linux, java-me, emulation, audio-recording, java-wireless-toolkit

是否可以在 Linux 平台上的 J2ME WTK 模拟器中捕获音频？这个论坛有人成功过吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-30T07:46:48.267

到目前为止还没有……希望在 WTK 的下一个版本中。

# java - 使用 Junit 比较文本文件

> ID：466841
> 
> 赞同：50
> 
> 时间：2009-01-21T20:27:26.490
> 
> 标签：java, junit, compare, text-files

我正在使用以下方法比较 junit 中的文本文件：

```
public static void assertReaders(BufferedReader expected,
          BufferedReader actual) throws IOException {
    String line;
    while ((line = expected.readLine()) != null) {
        assertEquals(line, actual.readLine());
    }

    assertNull("Actual had more lines then the expected.", actual.readLine());
    assertNull("Expected had more lines then the actual.", expected.readLine());
} 
```

这是比较文本文件的好方法吗？什么是首选？

* * *

## 回答 #1

> 赞同：47
> 
> 时间：2009-01-21T21:32:51.287

这是检查文件是否*完全相同*的一种简单方法：

```
assertEquals("The files differ!", 
    FileUtils.readFileToString(file1, "utf-8"), 
    FileUtils.readFileToString(file2, "utf-8")); 
```

Where`file1`和`file2`are `File`instances，并且[`FileUtils`](http://commons.apache.org/io/api-1.4/org/apache/commons/io/FileUtils.html)来自[Apache Commons IO](http://commons.apache.org/io/)。

没有太多自己的代码供您维护，这总是一个优点。:) 如果您已经碰巧在您的项目中使用了 Apache Commons，那么非常容易。但没有像[马克的解决方案](https://stackoverflow.com/questions/466841/comparing-text-files-w-junit#466872)那样好的、详细的错误消息。

**编辑**：
嘿，仔细看看`FileUtils`API，还有一种更[简单的方法](http://commons.apache.org/io/api-1.4/org/apache/commons/io/FileUtils.html#contentEquals%28java.io.File,%20java.io.File%29)：

```
assertTrue("The files differ!", FileUtils.contentEquals(file1, file2)); 
```

作为奖励，此版本适用于所有文件，而不仅仅是文本。

* * *

## 回答 #2

> 赞同：31
> 
> 时间：2009-01-21T20:36:43.863

[junit-addons](http://sourceforge.net/projects/junit-addons)对它有很好的支持：[FileAssert](http://junit-addons.sourceforge.net/junitx/framework/FileAssert.html)

它为您提供以下例外：

```
junitx.framework.ComparisonFailure: aa Line [3] expected: [b] but was:[a] 
```

* * *

## 回答 #3

> 赞同：24
> 
> 时间：2010-06-09T01:18:52.470

以下是各种 3rd-party Java 库中文件比较器的更详尽列表：

*   [org.apache.commons.io.FileUtils](http://www.unitils.org/apidocs/org/unitils/thirdparty/org/apache/commons/io/FileUtils.html#contentEquals%28java.io.File,%20java.io.File%29)
*   [org.dbunit.util.FileAsserts](http://www.dbunit.org/cobertura/org.dbunit.util.FileAsserts.html)
*   [org.fest.assertions.FileAssert](http://easytesting.org/assert/apidocs/org/fest/assertions/FileAssert.html)
*   [junitx.framework.FileAssert](http://junit-addons.sourceforge.net/junitx/framework/FileAssert.html)
*   [org.springframework.batch.test.AssertFile](http://static.springsource.org/spring-batch/apidocs/org/springframework/batch/test/AssertFile.html)
*   [org.netbeans.junit.NbTestCase](http://bits.netbeans.org/dev/javadoc/org-netbeans-modules-nbjunit/org/netbeans/junit/NbTestCase.html#assertFile%28java.io.File,%20java.io.File%29)
*   [org.assertj.core.api.FileAssert](http://joel-costigliola.github.io/assertj/assertj-core-features-highlight.html#file-content-string-assertions)

* * *

## 回答 #4

> 赞同：18
> 
> 时间：2015-03-15T16:03:53.697

截至 2015 年，我会推荐[AssertJ](http://joel-costigliola.github.io/assertj/index.html)，这是一个优雅而全面的断言库。对于文件，您可以针对另一个文件进行断言：

```
@Test
public void file() {
    File actualFile = new File("actual.txt");
    File expectedFile = new File("expected.txt");
    assertThat(actualFile).hasSameContentAs(expectedFile);
} 
```

或针对内联字符串：

```
@Test
public void inline() {
    File actualFile = new File("actual.txt");
    assertThat(linesOf(actualFile)).containsExactly(
            "foo 1",
            "foo 2",
            "foo 3"
    );
} 
```

失败消息也非常有用。如果一行不同，你会得到：

```
java.lang.AssertionError: 
File:
  <actual.txt>
and file:
  <expected.txt>
do not have equal content:
line:<2>, 
Expected :foo 2
Actual   :foo 20 
```

如果其中一个文件有更多行，您会得到：

```
java.lang.AssertionError:
File:
  <actual.txt>
and file:
  <expected.txt>
do not have equal content:
line:<4>,
Expected :EOF
Actual   :foo 4 
```

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2016-03-30T13:01:42.810

`java.nio.file`用API简单比较两个文件的内容。

```
byte[] file1Bytes = Files.readAllBytes(Paths.get("Path to File 1"));
byte[] file2Bytes = Files.readAllBytes(Paths.get("Path to File 2"));

String file1 = new String(file1Bytes, StandardCharsets.UTF_8);
String file2 = new String(file2Bytes, StandardCharsets.UTF_8);

assertEquals("The content in the strings should match", file1, file2); 
```

或者，如果您想比较各个行：

```
List<String> file1 = Files.readAllLines(Paths.get("Path to File 1"));
List<String> file2 = Files.readAllLines(Paths.get("Path to File 2"));

assertEquals(file1.size(), file2.size());

for(int i = 0; i < file1.size(); i++) {
   System.out.println("Comparing line: " + i)
   assertEquals(file1.get(i), file2.get(i));
} 
```

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2009-01-21T21:01:04.067

我建议使用 Assert.assertThat 和[hamcrest 匹配器](http://code.google.com/p/hamcrest/)（junit 4.5 或更高版本 - 甚至可能是 4.4）。

我最终会得到类似的东西：

```
assertThat(fileUnderTest, containsExactText(expectedFile)); 
```

我的匹配器在哪里：

```
class FileMatcher {
   static Matcher<File> containsExactText(File expectedFile){
      return new TypeSafeMatcher<File>(){
         String failure;
         public boolean matchesSafely(File underTest){
            //create readers for each/convert to strings
            //Your implementation here, something like:
              String line;
              while ((line = expected.readLine()) != null) {
                 Matcher<?> equalsMatcher = CoreMatchers.equalTo(line);
                 String actualLine = actual.readLine();
                 if (!equalsMatcher.matches(actualLine){
                    failure = equalsMatcher.describeFailure(actualLine);
                    return false;
                 }
              }
              //record failures for uneven lines
         }

         public String describeFailure(File underTest);
             return failure;
         }
      }
   }
} 
```

匹配器优点：

*   组合和重用
*   在普通代码和测试中使用
    *   收藏品
    *   用于模拟框架
    *   可以使用一般谓词函数
*   非常好的日志能力
*   可与其他匹配器结合，描述和故障描述准确准确

缺点：

*   好吧，这很明显对吧？这比 assert 或 junitx 更冗长（对于这种特殊情况）
*   您可能需要包含 hamcrest 库才能获得最大收益

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2011-01-13T18:15:52.317

`FileUtils`肯定是一个很好的。这是检查文件是否完全相同的另一种[简单方法。](http://commons.apache.org/io/api-1.4/org/apache/commons/io/FileUtils.html#checksumCRC32%28java.io.File%29)

```
assertEquals(FileUtils.checksumCRC32(file1), FileUtils.checksumCRC32(file2)); 
```

虽然 assertEquals() 确实提供了比 assertTrue() 更多的反馈，但 checksumCRC32() 的结果很长。所以，这可能没有本质上的帮助。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2009-01-21T20:31:20.460

如果预期的行数多于实际行数，您将在稍后到达 assertNull 之前使 assertEquals 失败。

不过，这很容易修复：

```
public static void assertReaders(BufferedReader expected,
    BufferedReader actual) throws IOException {
  String expectedLine;
  while ((expectedLine = expected.readLine()) != null) {
    String actualLine = actual.readLine();
    assertNotNull("Expected had more lines then the actual.", actualLine);
    assertEquals(expectedLine, actualLine);
  }
  assertNull("Actual had more lines then the expected.", actual.readLine());
} 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2015-06-07T05:29:07.517

这是我自己的实现`equalFiles`，不需要在你的项目中添加任何库。

```
private static boolean equalFiles(String expectedFileName,
        String resultFileName) {
    boolean equal;
    BufferedReader bExp;
    BufferedReader bRes;
    String expLine ;
    String resLine ;

    equal = false;
    bExp = null ;
    bRes = null ;

    try {
        bExp = new BufferedReader(new FileReader(expectedFileName));
        bRes = new BufferedReader(new FileReader(resultFileName));

        if ((bExp != null) && (bRes != null)) {
            expLine = bExp.readLine() ;
            resLine = bRes.readLine() ;

            equal = ((expLine == null) && (resLine == null)) || ((expLine != null) && expLine.equals(resLine)) ;

            while(equal && expLine != null)
            {
                expLine = bExp.readLine() ;
                resLine = bRes.readLine() ; 
                equal = expLine.equals(resLine) ;
            }
        }
    } catch (Exception e) {

    } finally {
        try {
            if (bExp != null) {
                bExp.close();
            }
            if (bRes != null) {
                bRes.close();
            }
        } catch (Exception e) {
        }

    }

    return equal;

} 
```

要使用它，只需使用常规的`AssertTrue`JUnit 方法

```
assertTrue(equalFiles(expected, output)) ; 
```

# sql-server - 在VBScript中将字符串转换为uniqueidentifier

> ID：466856
> 
> 赞同：2
> 
> 时间：2009-01-21T20:31:34.610
> 
> 标签：sql-server, vbscript, uniqueidentifier

我有一个在我的 SQL 服务器数据库中运行存储过程的脚本，问题是存储过程需要一个 uniqueidentifier 参数。我有一个从数据库中获取会话 id 的函数（它是一个 nvarchar），因此 VBScript 将其设为字符串，我需要将其转换为将其传递给存储过程。

```
 Function GetOpenSession
    Set conn = CreateObject("ADODB.Connection")
    Set rs = CreateObject("ADODB.Recordset")
    conn.Open "Provider=SQLOLEDB.1;Integrated Security=SSPI;Data Source=" & Source
    rs.CursorLocation = 3
    rs.Open "SELECT top 1 OpenSession FROM OpenSessions with (nolock)" , conn, 3, 3
    If rs.RecordCount = 0 Then
        MsgBox "No Connection"
    Else
        GetOpenSession = rs.Fields(0).Value
    End If
End Function 
```

当我尝试执行存储过程时，我得到“强制转换规范的无效字符值”。

```
 set cnParam = cmd.CreateParameter("@ActiveSession",72,1,,GetOpenSession)
    cmd.Parameters.Append cnParam 
```

我无法更改数据库中的任何内容，因此我需要一种方法来在我的脚本中克服这个问题。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-21T21:31:40.400

我相信 VBScript 期望 GUID 被大括号终止。您的会话 ID 是否与以下格式相同 {D6CA6263-E8E1-41C1-AEA6-040EA89BF030}

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-21T21:32:51.427

根据 SELECT OpenSession 的数据类型，您可以在查询中强制转换/转换它，并且 VBScript 可能会将数据类型保留为 GUID：

```
SELECT top 1 CONVERT(uniqueidentifier, OpenSession)
FROM OpenSessions with (nolock) 
```

当您使用`GetOpenSession`or`rs.Fields(0).Value`时，希望 VBScript 将其保留为 GUID。

另一种可能性似乎是 Win32 API 使用[`CoCreateGuid`](https://msdn.microsoft.com/en-us/library/windows/desktop/ms688568.aspx)and [`StringFromGUID2`](https://msdn.microsoft.com/en-us/library/windows/desktop/ms683893.aspx)。[此处](http://www.mrexcel.com/tip078.shtml)有一个示例，但它需要外部 Win32 函数和 GUID 类型。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-21T20:48:15.277

我一般把存储过程的参数类型改成varchar(38)。

SQL Server 在需要时可以更好地将字符串强制转换为 GUID。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-21T20:51:25.053

分配后 GetOpenSession 的值是多少？哪种数据类型？听起来它与您在 CreateParameter 调用中声明的类型 72 (GUID) 不兼容。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-21T21:37:21.560

您可以完全忘记使用 ADO 命令，而只使用普通 SQL 执行存储过程。

```
Set rs = CreateObject("ADODB.Recordset")
rs.Open "EXEC usp_MySP '" & GetOpenSession & "'", cnn 
```

显然这样构建SQL命令很糟糕，但毕竟只是为了测试......

# java - 处理 JavaServer Faces 的 url 映射的标准方法是什么？

> ID：466858
> 
> 赞同：0
> 
> 时间：2009-01-21T20:31:51.783
> 
> 标签：java, jsf, jakarta-ee

我看到的所有教程似乎都使用`*.jsf`,`*.faces`或`/<directory_name>/*`用于 Java Server faces servlet 映射中的 url-pattern。是否有一些官方推荐的命名约定或事实上的标准？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-21T20:42:22.200

推荐的约定在[JSF 1.2 规范](http://java.sun.com/javaee/javaserverfaces/reference/api/index.html)中。

第 10.1.2 节：

> 使用前缀映射时，建议使用以下映射，但不是必需的：

```
<servlet-mapping>
<servlet-name> faces-servlet-name </servlet-name>
<url-pattern>/faces/*</url-pattern>
</servlet-mapping> 
```

> 使用扩展映射时，建议使用以下映射，但不是必需的：

```
<servlet-mapping>
<servlet-name> faces-servlet-name </servlet-name>
<url-pattern>*.faces</url-pattern>
</servlet-mapping> 
```

# button - Dojo Toolbox：关闭对话框

> ID：466867
> 
> 赞同：3
> 
> 时间：2009-01-21T20:35:27.097
> 
> 标签：button, dojo

有没有办法在dojo对话框中设置一个按钮并让它关闭它所在的对话框？

将 dijits 放入 dijits 是行不通的，我不敢相信没有办法做到这一点。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-23T15:49:37.047

当然，您可以将 dijit 小部件放入另一个小部件中。在一个标准的 Dojo 版本中，甚至还包含一个测试用例[Dijit Dialog focus & destroy](http://download.dojotoolkit.org/release-1.2.3/dojo-release-1.2.3/dijit/tests/test_Dialog_focusDestroy.html)，它演示了关闭对话框，其中包含一个按钮。这是相关部分：

```
var btn = new dijit.form.Button({ label: "Close" });
dlg.containerNode.appendChild(btn.domNode);

dojo.connect(btn, "onClick", function(){
    console.log("destroying, while visible"); 
    dlg.destroy();
}); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2016-03-10T09:10:33.073

请注意，从 Dojo 1.7 开始，该`connect`模块已被替换为[`dojo/on`](https://dojotoolkit.org/reference-guide/1.10/dojo/on.html#dojo-on). 因此，上面的等价物是：

```
require(['dojo/on', 'dijit/form/Button'], function (on, Button) {
    // etc

    var btn = new Button({ label: "Close" });
    dlg.containerNode.appendChild(btn.domNode);

    on(btn, "onClick", function(){
        console.log("destroying, while visible"); 
        dlg.destroy();
    });
}); 
```

# asp.net - ASP.Net SoapHttpClientProtocol 中的 HTTP 内容类型

> ID：466875
> 
> 赞同：0
> 
> 时间：2009-01-21T20:37:52.803
> 
> 标签：asp.net, web-services, soap, content-type

我对用 ASP.NET 编写的 Web 服务使用者有疑问。错误信息是：

```
System.InvalidOperationException: Client found response content type of 'application/xml; charset=utf-8', but expected 'text/xml'. 
```

客户端基于 System.Web.Services.Protocols.SoapHttpClientProtocol。~~我们不能更改提供者提供的 Content-Type，它必须是 'application/xml; 字符集=utf-8'。~~有什么方法可以改变 SoapHttpClientProtocol 期望的 Content-Type 吗？不幸的是，我们*可能*仅限于 .NET 1.1。

谢谢！

**更新：**我们找到了一种方法来更改提供者发送的 Content-Type，这解决了问题。不过，我仍然很想知道如何改变消费者的期望。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2011-01-17T06:47:27.930

添加一个

> 服务参考

对于此类 Web 服务不是

> 网络参考

在您的 .net 客户端应用程序中

# java - 你能在 Java 中获得基本的 GC 统计信息吗？

> ID：466878
> 
> 赞同：42
> 
> 时间：2009-01-21T20:38:41.333
> 
> 标签：java, garbage-collection

我想让一些长时间运行的服务器应用程序定期输出 Java 中的一般 GC 性能数字，比如 Runtime.freeMemory() 的 GC 等价物等。比如完成的周期数、平均时间等。

我们在客户机器上运行的系统怀疑配置错误的内存池会导致过多的 GC 频率和长度 - 我突然想到，通常定期报告基本的 GC 活动会很好。

有没有任何独立于平台的方式来做到这一点？

**编辑：我特别想在运行时将此数据输出到系统日志（控制台）；这不是我想要连接到 JVM 的东西，就像 JConsole 或 JVisualVM 一样。**

Edit2: MX bean 看起来像我想要的 - 有没有人有一个获得其中之一的工作代码示例？

* * *

## 回答 #1

> 赞同：54
> 
> 时间：2009-01-21T22:44:45.807

这是一个`[GarbageCollectorMXBean](http://java.sun.com/javase/6/docs/api/java/lang/management/GarbageCollectorMXBean.html)`用于打印 GC 统计信息的示例。大概您会定期调用此方法，例如使用`[ScheduledExecutorService](http://java.sun.com/javase/6/docs/api/java/util/concurrent/ScheduledExecutorService.html)`.

```
public void printGCStats() {
    long totalGarbageCollections = 0;
    long garbageCollectionTime = 0;

    for(GarbageCollectorMXBean gc :
            ManagementFactory.getGarbageCollectorMXBeans()) {

        long count = gc.getCollectionCount();

        if(count >= 0) {
            totalGarbageCollections += count;
        }

        long time = gc.getCollectionTime();

        if(time >= 0) {
            garbageCollectionTime += time;
        }
    }

    System.out.println("Total Garbage Collections: "
        + totalGarbageCollections);
    System.out.println("Total Garbage Collection Time (ms): "
        + garbageCollectionTime);
} 
```

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2009-01-21T20:51:12.930

请参阅[GarbageCollectorMXBean](http://java.sun.com/javase/6/docs/api/java/lang/management/GarbageCollectorMXBean.html)。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2009-01-21T20:48:40.377

JVM 已经内置了一定数量的垃圾收集器日志记录，因此根据您的要求，您可能不需要自定义解决方案。

在 Java 7 中，您可以使用`-XX:-PrintGC`and `-XX:-PrintGCDetails`; 请参阅[VM 调试选项](http://java.sun.com/javase/technologies/hotspot/vmoptions.jsp#DebuggingOptions)。

在 Java 8 到 10 中，使用`-XX:+PrintGC`and`-XX:+PrintGCDetails`代替`+`a `-`( [source](https://docs.oracle.com/javase/8/docs/technotes/tools/windows/java.html) )。

在 Java 11 或更高版本中，-XX 选项[已被弃用](https://docs.oracle.com/en/java/javase/11/migrate/index.html#JSMIG-GUID-055EA9F4-835E-463F-B9E1-9081B3D9E55D)，取而代之的是`-Xlog:gc`. 有关更多高级选项，请参阅[使用 JVM 统一日志记录框架启用日志记录。](https://docs.oracle.com/en/java/javase/11/tools/java.html#GUID-BE93ABDC-999C-4CB5-A88B-1994AAAC74D5)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-22T08:33:57.537

稍微偏离主题，但您可以将 VisualVM 和 JConsole 连接到正在运行的应用程序并查看有用的统计信息。

# php - 什么通常会导致 PHP 遇到堆栈溢出？

> ID：466884
> 
> 赞同：0
> 
> 时间：2009-01-21T20:39:54.297
> 
> 标签：php, windows, iis, memory

我在为一些 php 站点提供服务的 Windows IIS 服务器上。我们已经将一个正常工作的 PHP 站点移到了我们的服务器上，但是提交其中一个表单会返回：

```
PHP has encountered a Stack overflow 
```

当注释掉 MYSQL INSERT 并为表单处理分配 SESSION 变量时，这些是提交表单的重要部分。

任何帮助将不胜感激。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-21T20:44:09.357

递归太多？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-21T20:45:40.290

对我来说，它通常是一个无限循环（包括无限递归）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-21T21:08:38.263

你用的是哪个版本的php？如果我没记错的话，在某些旧版本中，无限（或非常深）递归会导致堆栈溢出。今天，您将收到更具体的错误消息（“已达到 '100' 的最大函数嵌套级别，正在中止！”）。

您提到会话是一个可能的原因；您是否在会话中存储复杂的数据结构？会话在请求之间是序列化和非序列化的，如果你在其中放入太多东西可能会导致一些问题（虽然不确定多少是太多）。也许你可以减少那个？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-22T00:46:42.113

[无关]

```
$stackoverflow = file_get_contents('http://stackoverflow.com/tags/php');
// voila, php encountered stackoverflow ^-^ 
```

# java - 如何设置 Ant 'junit' 任务的工作目录？

> ID：466893
> 
> 赞同：12
> 
> 时间：2009-01-21T20:42:43.323
> 
> 标签：java, ant, junit

我的 Ant 构建包含一个运行一些测试的 junit 任务。为了使测试工作，`user.dir`必须更改指定当前工作目录 ( ) 的属性值，但我不确定如何实现这一点。

目前有问题的任务如下所示：

```
<junit printsummary="withOutAndErr" fork="true"
           haltonfailure="yes" showoutput="true"
           filtertrace="false" dir="C:/workspace/obp-web">
    <jvmarg value="-Duser.dir=C:/workspace/obp-web"/>

    <classpath>
        <fileset dir="${web.lib.dir}" includes="**/*.jar"/>
        <fileset dir="${lib.dir}" includes="**/*.jar"/>
    </classpath>    
    <batchtest fork="no" todir="${web.build.dir}/testresults">
        <formatter type="xml"/>
        <zipfileset src="${web.build.dir}/test-obp-web.jar">
            <include name="**/*Test.class"/>
        </zipfileset>           
    </batchtest>
</junit> 
```

请注意，我尝试使用“dir”属性和“jvmarg”任务将工作目录更改为 C:/workspace/obp-web。但是，当我在打开详细输出的情况下运行 Ant 时，我看到以下输出，这表明工作目录未正确设置：

> **[junit] 如果在同一 VM 中运行，则忽略 dir 属性**
> 
> **[junit] 使用系统属性** {java.runtime.name=Java(TM) SE Runtime Environment, sun.boot.library.path=c:\jdk6\jre\bin, java.vm.version=10.0-b23, ant. lib rary.dir=C:\java\apache-ant-1.7.0\lib, java.vm.vendor=Sun Microsystems Inc., java.vendor.url= [http://java.sun.com/](http://java.sun.com/) , 路径。分隔符=;、java.vm.name=Java HotSpot(TM) 客户端虚拟机、file.encoding.pkg=sun.io、user.country=CA、sun.java.launcher=SUN_STANDARD、sun.os.patch.level= Service Pack 1，java.vm.specification.name=Java 虚拟机规范， **user.dir=c:\workspace\obp-ear**, java.runtime.version=1.6.0_07-b06, java.awt.graphicsenv=sun.awt.Win32GraphicsEnvironment, java.endorse d.dirs=c:\jdk6\jre\lib\endorsed, os.arch=x86, java .io.tmpdir=C:\Users\donal\AppData\Local\Temp\, line.separator=

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-01-21T20:58:48.143

使用属性“dir”（还必须 fork vm）：

[http://ant.apache.org/manual/Tasks/junit.html](http://ant.apache.org/manual/Tasks/junit.html)

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-01-21T20:51:02.837

尝试使用 jvmarg：

```
<junit fork="yes">
  <jvmarg value="-Duser.dir=somedir"/>
  ...
</junit> 
```

请注意，*junit*标签和*batchtest*标签上的 fork**必须**为 true，因为*batchtest*标签会覆盖*junit*的值。Jvmargs 仅在 junit fork 一个新的 JVM 时才有效。

 **** * *

## 回答 #3

> 赞同：1
> 
> 时间：2013-07-19T15:58:00.027

和你一样的问题。

我通过将 batchtest fork 设置为 true 来解决它：

批次测试叉=“**没有**”..

到

批量测试 fork="**是**" ..

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-08-12T09:09:12.223

您是否尝试过路径元素位置？这对我有用。

```
 <classpath>
<!-- filesets, etc. -->
<pathelement location="C:/workspace/obp-web" />
  </classpath> 
```

# .net - .NET 将如何影响 Python 和 Ruby 应用程序？

> ID：466897
> 
> 赞同：5
> 
> 时间：2009-01-21T20:43:40.980
> 
> 标签：.net, python, ruby, ironpython, ironruby

我很好奇 .NET 将如何影响 Python 和 Ruby 应用程序。

用 IronPython/IronRuby 编写的应用程序是否会如此特定于 .NET 环境，以至于它们本质上会变成特定于平台的？

如果他们不使用任何 .NET 功能，那么 IronPython/IronRuby 与非 .NET 对应物相比有什么优势？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-24T12:23:04.313

关于 IronRuby，我不能说什么，但大多数 python 实现（如 IronPython、Jython 和 PyPy）都尽可能地忠实于 CPython 实现。IronPython 正在迅速成为这方面最好的之一，Planet Python 上有很多关于它的流量。

鼓励开发人员编写不同于他们在 CPython 中编写的代码的主要因素是缺少像 NumPy 这样的 C 扩展模块（这在 Jython 和 PyPy 中也是一个问题）。

IronClad 是一个值得关注的有趣项目，它可以让您从 IronPython 中调用 C 扩展模块。这最终应该意味着您可以在 CPython 下开发代码，使用您喜欢的任何模块，并且它将在 IronPython 上运行而无需修改。

[http://www.resolversystems.com/documentation/index.php/Ironclad](http://www.resolversystems.com/documentation/index.php/Ironclad)

所以回答你的问题：

编写在 CPython 上也可以运行的 IronPython 应用程序应该很容易，但我可能打算反过来：也可以在 IronPython 上运行的 CPython 程序。那样的话，如果它不起作用，那么它更有可能是一个已知的错误，具有已知的解决方法。

IronPython 等*现有*的优点是它们提供了该语言的替代实现，这有时对于发现 CPython 中的错误很有用。它们还提供了部署 Python 应用程序的替代方法，如果由于某种原因您发现自己处于不适合将 CPython 实现与您的应用程序一起分发的情况（如 silverlight）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-08-16T22:16:17.737

> *用 IronPython/IronRuby 编写的应用程序是否会如此特定于 .NET 环境，以至于它们本质上会变成特定于平台的？*

IronRuby 目前附带大部分核心 ruby​​ 标准库，并支持 ruby​​ gem。

这意味着它将支持几乎所有不依赖 C 扩展的原生 ruby​​ 应用程序。
另一方面，可以在 IronRuby 中编写不依赖 CLR 的原生 ruby​​ 应用程序，并且这些应用程序可以移植到 MRI。

人们是否选择使用 CLR 为他们的应用程序创建或使用扩展与人们是否为 MRI 创建或使用 C 扩展是同一个问题——一个并不比另一个更便携。

有一个附带问题**“因为在 C# 中创建 IronRuby 扩展比在 C 中创建 CRuby 扩展要容易得多，人们会在应该坚持使用原生 ruby​​ 代码的地方创建扩展吗？”** ，但这完全是主观的。

但总的来说，我认为任何使创建扩展更容易的东西都是一个巨大的胜利。

* * *

> *如果他们不使用任何 .NET 功能，那么 IronPython/IronRuby 与非 .NET 对应物相比有什么优势？*

1.  性能：IronRuby 在大多数情况下已经比 MRI 1.8 更快，并且与 MRI 1.9 相差不远，而且未来只会有所改善。我认为python在这方面是相似的。

2.  部署：正如人们所提到的，在 IIS 中运行本机 ruby​​ 跨平台 Rails 应用程序对一些基于 Windows 的开发人员来说是一个有吸引力的提议，因为它可以让他们更好地与现有服务器/管理基础架构/等集成

3.  稳定性：虽然 MRI 1.9 比 1.8 好得多，但我认为没有人会不同意 CLR 具有比 C ruby​​ 更好的垃圾收集器和基本运行时。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-21T20:51:04.803

IronPython/IronRuby 是为在 .net 虚拟机上工作而构建的，因此它们本质上是特定于平台的。

显然，只要您在程序中不使用任何 .net 框架，它们就与 Python 和 Ruby 兼容。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-21T21:41:33.377

如果您创建了一个库或框架，人们可以在 .NET 上通过他们的 .NET 代码使用它。这对他们来说很酷，对你来说也很酷！

在开发应用程序时，如果您放弃使用 .NET 的工具，那么您将失去“跨平台性”，这并不总是一个问题。

如果您使用内部 API 包装这些用途，您可以稍后将 .NET 实现替换为纯 Python、包装的 C（对于 CPython）或 Java（对于 Jython）。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-21T22:50:17.607

根据 Mono 页面，IronPython 与 Mono 的 .Net 运行时实现兼容，因此可执行文件应该可以在 Windows 和 Linux 上运行。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-21T21:12:41.313

你用第二个问题回答你的第一个问题，如果你不使用.Net中的任何东西，只使用语言实现提供的原始库，你可以用另一个实现来解释你的 *.py 或 *.rb 文件，它应该工作。

好处是，如果您的 .Net 商店通常会负责在客户端机器上安装正确的框架等...好吧，如果您想要 python 或 ruby​​ 代码，您现在需要支持另一个“框架”需要分发安装，处理版本问题等......所以有两个优点，在另一种语言中使用.Net框架功能+保持分发/维护尽可能简单。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-21T21:21:19.937

在 IIS 下运行 Rails/Django 而不是 Apache/Mongrel 类型的解决方案会很酷

# c# - 有没有办法将 IEnumerable 转换为 XElements 的集合？

> ID：466909
> 
> 赞同：4
> 
> 时间：2009-01-21T20:45:33.253
> 
> 标签：c#, xml, linq

我正在尝试使用 LINQ 将 XML 文件保存到磁盘。我有一类业务对象，包括要转换为 XML 的字符串集合（列表）。是否有一种简单的方法可以将此列表转换为 XML 元素列表？

例如，我的清单可能是：

```
List<string> collection = new List<string>() {"1", "2", "3"} 
```

输出应该是：

```
<Collection>
     <Element>1</Element>
     <Element>2</Element>
     <Element>3</Element>
</Collection> 
```

目前，我正在使用这种语法：

```
XElement Configuration =
    new XElement("Configuration",
    new XElement("Collection",  collection.ToArray()
    ),
); 
```

但是，这会将集合连接成单个字符串元素。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-01-21T20:47:03.190

```
XElement Configuration = new XElement("Collection",
      collection.Select(c=>new XElement("Element", c))); 
```

# ms-access - TreeView 自行填充并崩溃 Access

> ID：466916
> 
> 赞同：2
> 
> 时间：2009-01-21T20:47:12.470
> 
> 标签：ms-access, treeview, vba

我的问题是我的 Access 2002 应用程序中的树视图。

当我打开表单时，它已经被填充了。这很奇怪，因为添加节点的唯一代码绑定到按钮。

此外，仅显示部分数据，当我在选项卡 () 之间切换时，树视图中的数据重复/双倍。然后当我点击任何其他选项卡时，Access 会立即崩溃，就像 * zap *

是否有必要一直清理树视图？

任何其他想法可能是什么问题 - 也欢迎解决方案;）

干杯，拉蒙

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-09-30T10:08:31.407

我遇到了这个问题并将其追溯到树视图控件不喜欢在标签页上。您将不得不重新设计表单以将树视图保留在选项卡之外。

如果它必须出现在标签页上，那么您可以尝试.......

将树视图放在选项卡控件后面。将选项卡控件的背景设置为透明。在选项卡控件的“更改时”事件中，获取它以检查正在选择哪个选项卡。如果它是您想要的选项卡，则将树视图设置为可见，否则将其隐藏

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-06-22T15:52:17.407

我使用 VCL (Delphi/BCB) 包装器作为选项卡上的树视图控件（TPageControl 上的 TTreeView）。

一旦我调用 TreeView1.Items.Clear ，我的程序就会挂起。但仅在“某些”情况下！特别是如果我展开一个项目然后尝试 Clear() 所有项目。如果我从不触摸任何节点（或仅滚动），那很好。

我发现在调用 Items.Clear 之前将所选节点设置为 NULL 为我解决了这个问题。

有趣的是，调用 Clear() 导致一些 OnChange 事件由于某种原因发生，这是意料之外的（因为我们无论如何都要删除所有节点！）...

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-21T23:53:17.353

首先，找出为什么 TreeView 在您还没有告诉它时正在加载。单步执行您的代码。你必须先解决这个问题。

其次，如果您不加载 TreeView 但切换选项卡，表单是否会崩溃？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-22T11:12:16.327

谢谢你的建议。

我仍然没有发现为什么将数据加载到 TreeView 中，但我想出了一个解决方案。

首先，我在加载表单时开始清理 TreeView。
这确实对稳定性有好处。现在可以在不崩溃 Access 的情况下四处点击。

当数据加载到 TreeView 时，旧行为再次出现。在选项卡之间切换会添加更多数据并最终导致 Access 崩溃。

似乎 TreeView（6.0 版）正在重建自身而没有正确清理。
基于这个假设，我现在在切换到包含选项卡时清除并重建 TreeView。

我仍然对根本原因感兴趣，但它现在起作用了。

再次感谢，拉蒙

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2014-01-21T00:59:01.163

我不敢相信这个问题仍然存在并且微软没有发布任何修复程序！我在运行 Office 2010 的 Windows 8.1 中遇到了同样的问题

无论如何，我达到的最简单的解决方法（并且可能会节省资源）是在表单的“当前事件”中构建当前活动选项卡的 TreeView。

```
Private Sub Form_Current()
    Select Case Me.tabCompany.Value 'Return Page Index of active page
        Case 0  ' Page Index for Page 1.
            Call TVPage1
        Case 1  ' Page Index for Page 2.
            Call TVPage2
    End Select
End Sub 
```

要记住的另一件事是在选项卡的“更改事件”中从一个页面切换到另一个页面时运行相同的例程来更新 TreeView：

```
Private Sub tabCompany_Change()
    Select Case Me.tabCompany.Value 'Return Page Index of active page
        Case 0  ' Page Index for Page 1.
            Call TVPage1
        Case 1  ' Page Index for Page 2.
            Call TVPage2
    End Select
End Sub 
```

干杯!

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2022-02-14T19:56:09.317

在使用不同选项卡上的 TreeView 控件在选项卡之间切换时，MsAccess 2016/Win10 仍然崩溃。我最初的错误方法是在离开选项卡**后**清除节点- 就像我对位于不同选项卡上的子表单一样（节省资源）。

```
Private Sub MainTabCtrl_Change()
'Activate selected/called Tab
Select Case Nz(Me![MainTabCtrl],0)
Case 0 'Tab 1
    Me![SubFormTab1].Form.RecordSource = "tblSubFormData"
    Me.TreeViewTab1.Object.Nodes.Clear
    Call BuildTreeView1
Case 1 'Tab 2
    Me.TreeViewTab2.Object.Nodes.Clear
    Call BuildTreeView2
End Select
'Deactivate leaving Tab
Select Case Nz(Me![PriorTab],0)
Case 0 'Tab 1
    Me![SubFormTab1].Form.RecordSource = ""
    'Do nothing with TreeView1
Case 1 'Tab 2
    'Do nothing with TreeView2
End Select
Me![PriorTab] = Me![MainTabCtrl]
End Sub 
```

在调用 Tab 时清除 TreeView 节点（如果需要），而不是在离开 Tab 时清除 TreeView 中的节点。

# .net - 日期的自然语言解析器（.NET）？

> ID：466917
> 
> 赞同：6
> 
> 时间：2009-01-21T20:48:02.500
> 
> 标签：.net, datetime, ironpython, nlp

我希望能够让用户使用自然语言（例如“下周五”、“每个工作日”）输入日期（包括重复日期）。很像[http://todoist.com/Help/timeInsert上的示例](http://todoist.com/Help/timeInsert)

我找到[了这篇文章](https://stackoverflow.com/questions/23689/natural-language-date-time-parser-for-net)，但它有点旧，并且只提供了[一个](http://www.codeplex.com/DateTimeEnglishParse)我并不完全满意的解决方案。我想我会重新提出这个问题，看看：是否还有其他 .NET 库可以进行这种日期解析？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-25T19:20:16.317

我知道这不是最佳解决方案，但您也可以尝试将[dateJs](http://www.datejs.com/)库移植到 .net

它处理像今天这样的事情；明天; 2008 年 7 月；下周五; 去年四月；2004.08.07；2005 年 6 月 4 日；晚上 8 点 15 分；22:30:45；+5年

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-21T20:55:42.547

我不知道你今天可以在框架中使用什么来允许你这样做，但如果你满足于玩未来的比特，你可以看看 Oslo，并制作你自己的文本 DSL。

这篇文章展示了如何做你正在尝试做的事情：

[http://www.infoq.com/articles/natural-language-date-dsl-oslo](http://www.infoq.com/articles/natural-language-date-dsl-oslo)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-28T00:23:38.060

DateTime.Parse() 将接受一个字符串参数并尝试生成它的 DateTime 相等。我对此有点生疏，但它应该适用于您可以使用 DateTime.ToString() 生成的任何日期字符串。

您还可以查看 DateTime.ParseExact()，它与 ​​Parse() 执行相同的操作，但允许您限制输入字符串的可能格式。以下链接应该可以帮助您使用框架中的任何其他日期解析功能。

[http://msdn.microsoft.com/en-us/library/1k1skd40.aspx](http://msdn.microsoft.com/en-us/library/1k1skd40.aspx)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-10T00:32:25.057

我们开发的正是您在内部项目中寻找的东西。如果有足够的需要，我们正在考虑将其公开。请查看此博客了解更多详细信息：http: [//precisionsoftwaredesign.com/blog.php](http://precisionsoftwaredesign.com/blog.php)。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-11-10T21:20:41.713

我已经将[这个库](http://smplsite.com/naturaldate/)构建为工作项目的一部分。它没有完全完善，但如果您有兴趣，我可以在其中投入更多工作和/或根据您的需要安排许可证。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-12-21T04:56:56.473

我编写的非常旧的程序（使用 DBASE 衍生工具 Clipper），但代码可读性很强。

**[http://www.jbooth-consulting.com/downloads/clipper/guessdate.zip](http://www.jbooth-consulting.com/downloads/clipper/guessdate.zip)**

如果您想自己动手，可能会给您一些想法...

# c# - 在 C# 中，普遍接受的在类中引用成员属性的方法是什么？

> ID：466921
> 
> 赞同：2
> 
> 时间：2009-01-21T20:48:53.467
> 
> 标签：c#, naming-conventions, class-design

已通读[MSDN 命名指南](http://msdn.microsoft.com/en-us/library/ms229002.aspx)，但找不到明确的答案，除此之外，您通常应尽量避免使用下划线。假设我有以下内容：

```
public class Employee
{
    private string m_name;  //to store property value called Name

    public string Name
    {
        get { return m_name; }
        set { m_name = value; }
    }

    public void ConvertNameToUpper()
    {
        //by convention should you use this
        return m_name.ToUpper();

        //or this
        return Name.ToUpper(); 
    }
} 
```

**上面 m_name 的正确命名约定是什么？**例如，在我继承的代码中，我通常会看到：

*   m_name
*   _姓名
*   姓名
*   myName 或其他一些随机标识符

哪一个（或另一个）最常被接受？

**作为后续，在类的方法中，您是引用内部（私有）标识符还是公共属性访问器？**

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-01-21T20:54:11.800

我认为，无论您使用什么命名约定，最重要的是保持一致。我的意思是，如果您选择像 _name 一样命名私有成员，那么总是这样做，而不是一次使用 _name，另一次使用 m_name。我个人使用下划线前缀约定。（其中一个原因是因为我使用 NHibernate，而 NHibernate 有一个 'field.camelcase-underscore' 访问策略。

对于你的另一个问题：这取决于你想做什么。
您的属性是否包含额外的逻辑，并且您是否希望在引用它时执行此逻辑？然后使用该属性。你不想执行逻辑？使用该字段。Eric Lippert 在他的博客上写了一篇关于这个的[帖子。](http://blogs.msdn.com/ericlippert/archive/2009/01/14/automatic-vs-explicit-properties.aspx)

对于您的跟进：这一切都取决于情况。如果您的属性包含一些额外的逻辑，并且您不想在从类中访问时执行该额外的逻辑，那么使用支持字段...

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-21T20:52:03.397

首先 - 对于简单的获取/设置情况，我建议您使用自动实现的属性。如果这样做，编译器将生成基础变量，并且您只引用属性本身。

除此之外，我建议您选择上述之一或任何类似的东西，然后坚持下去。我工作的公司使用 vName，其中“v”表示这是该属性的值。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-06-07T18:42:46.637

我使用 Style Cop，它在您的代码上强制执行一些样式。我发现这非常有用，我所有的团队成员也都在使用它。

虽然围绕 Style Cop 的使用有很多讨论，但我建议的一件事是，如果您使用 Style Cop，那就是启用所有样式。这样，当您在用户之间共享时，事情就会变得容易得多。

这导致的一件事是您不能用下划线命名您的私有字段。所以我一般在写私有字段的时候使用camelCase，然后对公共属性使用PascalCase：

```
private string name;
public string Name
{
    get { return this.name; }
    set { this.name = value; }
} 
```

Style Cop 还强制使用`this.`它使事情更容易阅读。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-01-21T20:52:53.007

我在示例代码中看到的最常见的是一个简单的 _ 前缀。

然而，真正重要的是团队同意标准是什么并坚持下去。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-01-21T20:55:09.677

如果您不能像 Brian Rasmussen 建议的那样使用自动实现的属性，并且您必须拥有一个私有成员，那么我建议使用下划线前缀 _name。

在智能感知中，项目是参数、本地成员还是私有成员并不是很明显，因为它们都具有相同的符号（蓝色立方体）。但是，如果您将光标移动到特定项目，则工具提示会告诉您它是哪一个。

我发现下划线前缀是一种方便的视觉辅助工具，无需移动光标就可以立即看出它是私有成员。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-21T22:04:46.027

我曾经非常反对 '_' 前缀，但它确实对智能感知很有用，当您想要快速访问成员字段而无需键入许多字母时。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-21T20:56:09.927

一方面我同意你应该使用公司标准，另一方面我会尽量遵守行业标准。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-21T21:04:16.087

我会回应以前的答案，因为您应该坚持您的团队使用的方案，或者如果您不在团队中，请与您使用的任何方案保持一致。

就个人而言，我使用下划线前缀，因为我发现它给了我一个很好的视觉提示。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-01-21T21:50:39.583

我认为普遍接受的命名约定只是为了使名称有意义（并且代码简洁明了）。在我看来，如果我的代码中的标识符出于某种原因需要视觉提示，那就太复杂了，而且名称通常并不完全准确。

我处理过需要手册才能阅读的代码......“m”表示类级别，“p”表示参数等。开发命名约定是为了使代码更易于阅读，但它最终只做了恰恰相反，因为开发人员认为“好的”命名约定意味着可读的代码。

只要确保丹尼斯格林（前亚利桑那红衣主教教练）的名言适用于你的身份：“他们就是我们认为的人！”

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-01-21T21:51:05.323

我尝试仅在必须时访问成员变量，例如当属性为只读或我想绕过任何设置逻辑时。

这样做的一个原因是，如果您稍后确实向 setter 添加了逻辑，您很可能希望它在任何地方都可以使用。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-01-21T22:59:29.413

对于类级变量，我们的编码标准说使用 mVariableName 或 m_VariableName。最主要的是跟随你的公司/老师/等。编码标准/实践。

我个人只通过它的 getter/setter 访问变量（如果有的话）。即使该变量仅在类内部使用，我也使用自动属性。这样，我添加了一层抽象，这意味着如果我改变了一些东西，需要重构的代码更少。

顺便说一句，你的 void 函数不能返回一个字符串..... :-)

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-06-07T18:55:24.163

我只是想补充一点，MSDN 命名指南没有指定这一点，因为它只有公共接口的指南（即属性名称、公共方法、公共方法参数等......）他们不关心私有成员样式，就微软而言，你可以使用你和你的团队想要的任何东西。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-06-07T20:49:48.783

首先，我和许多与我共事过的人已经取消了使用“m_”作为私有成员前缀的做法。接下来，每当我在类中引用私有成员时，我通常使用“this.privateMemberVariableName”中的 this 这个词。使用它足以区分该变量不是局部变量或方法内作为参数传递的变量。

如果公共属性名称包含的逻辑不仅仅是引用私有成员变量，例如实例化连接或将属性值保存在视图状态中，我确实会引用公共属性名称。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-06-07T20:54:15.950

[框架设计指南书](https://rads.stackoverflow.com/amzn/click/com/0321246756)说你不应该在你的变量前面加上 _ - 你应该只使用小写的变量名，我相信 Code Complete 第 2 版说你不应该在你的变量前面加上 m_。

# svn - Git - 最佳实践（一般来说，从前 SVN 用户的角度来看。）

> ID：466933
> 
> 赞同：8
> 
> 时间：2009-01-21T20:51:24.117
> 
> 标签：svn, git, git-svn

最近学习了 Git 的基本概念。我们确实使用了一些 git-svn 来熟悉使用它。我想和我的朋友一起在 git 上开始我的第一个“真正的”项目。

因此，我想问一下，一般来说使用 Git 的最佳实践是什么，以及我熟悉的 SVN 开发人员是否会遇到任何陷阱？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-21T20:56:17.663

多个开发人员之间的协作可能最好使用中央“裸”存储库来完成，这大致类似于 Subversion 中的存储库。在两个或更多人之间仅使用自己的存储库共享更改是困难的并且容易出错。此外，来自 Subversion 背景的使用中央存储库会感觉更舒服。

Git 的一大优点是您可以轻松拥有多个“通用”存储库。我有我的开发设置，所以我在一个我通常与之交互的服务器上保留了一组裸存储库（我的大多数项目的“起源”），但对于某些项目，我也将整个东西推送到 GitHub。我不必选择哪个是单一中央存储库，我可以从 GitHub 存储库中提取和工作，然后再推送到我自己的副本。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-22T00:48:04.950

认为 Git 是带有坏口音的 SVN 是有缺陷的。这个[最近的问题](https://stackoverflow.com/questions/457927/git-workflow-and-rebase-vs-merge-questions)展示了 Git 中的两个在 SVN 中可能有意义的陷阱：

1.  认为`rebase`在 Git 中应该替换为`merge`. 与其他人的更改合并有时会导致许多不必要的合并冲突，从而`rebase`避免。
2.  将功能分支推送到远程存储库，然后在那里合并会得到更糟糕的结果。

另一个主要缺陷在[Git FAQs](http://git.or.cz/gitwiki/GitFaq)的“Unexpected Beharviour”下得到了很好的表达：

```
 A quick rule of thumb is to *never* push into a repository 
    that has a work tree attached to it, until you know what you are doing. 
```

在手册页的某处，它温和地解释说这可能“导致意想不到的结果”。就像失去了别人的所有工作。

这个[Git SVN 速成课程](http://git.or.cz/course/svn.html)将在您仍然在 SVN 中思考的同时轻松过渡到 Git。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-21T22:04:16.030

[在GitHub 上](http://github.com)获得一个帐户并使用它来维护一些工作的、非必要的代码是找到自己的最佳方法的好方法。我发现[Network Visualizer](http://github.com/blog/39-say-hello-to-the-network-graph-visualizer)对于“查看”正在发生的事情非常有帮助，因为我尝试使用 git 进行各种操作。

# c# - 如何初始化列表 到给定的大小（而不是容量）？

> ID：466946
> 
> 赞同：145
> 
> 时间：2009-01-21T20:54:23.407
> 
> 标签：c#, .net, generics, list, initialization

.NET 提供了一个通用列表容器，其性能几乎相同（请参阅数组与列表的性能问题）。但是，它们在初始化方面完全不同。

数组很容易用默认值初始化，并且根据定义它们已经具有一定的大小：

```
string[] Ar = new string[10]; 
```

这允许人们安全地分配随机项目，例如：

```
Ar[5]="hello"; 
```

列表的事情更棘手。我可以看到两种进行相同初始化的方法，这两种方法都不是你所说的优雅：

```
List<string> L = new List<string>(10);
for (int i=0;i<10;i++) L.Add(null); 
```

或者

```
string[] Ar = new string[10];
List<string> L = new List<string>(Ar); 
```

什么是更清洁的方式？

编辑：到目前为止的答案是指容量，这与预先填充列表不同。例如，在刚刚创建的容量为 10 的列表上，无法执行`L[2]="somevalue"`

编辑 2：人们想知道为什么我要以这种方式使用列表，因为这不是它们的预期使用方式。我可以看到两个原因：

1.  人们可以非常有说服力地争辩说，列表是“下一代”数组，增加了灵活性，几乎没有任何惩罚。因此，应该默认使用它们。我指出它们可能不那么容易初始化。

2.  我目前正在编写的是一个基类，它提供默认功能作为更大框架的一部分。在我提供的默认功能中，列表的大小是预先知道的，因此我可以使用数组。但是，我想为任何基类提供动态扩展它的机会，因此我选择了一个列表。

* * *

## 回答 #1

> 赞同：167
> 
> 时间：2009-03-10T20:04:08.967

```
List<string> L = new List<string> ( new string[10] ); 
```

* * *

## 回答 #2

> 赞同：96
> 
> 时间：2009-01-21T21:00:19.217

我不能说我经常需要这个 - 你能详细说明你为什么想要这个吗？我可能会把它作为一个静态方法放在一个辅助类中：

```
public static class Lists
{
    public static List<T> RepeatedDefault<T>(int count)
    {
        return Repeated(default(T), count);
    }

    public static List<T> Repeated<T>(T value, int count)
    {
        List<T> ret = new List<T>(count);
        ret.AddRange(Enumerable.Repeat(value, count));
        return ret;
    }
} 
```

您*可以*使用`Enumerable.Repeat(default(T), count).ToList()`，但由于缓冲区调整大小，这将是低效的。

请注意，如果`T`是引用类型，它将存储`count`为参数传递的引用的副本`value`- 因此它们都将引用同一个对象。这可能是也可能不是您想要的，具体取决于您的用例。

编辑：如评论中所述，如果您愿意，可以`Repeated`使用循环来填充列表。那也会稍微快一点。就我个人而言，我发现代码使用`Repeat`更具描述性，并怀疑在现实世界中性能差异无关紧要，但您的里程可能会有所不同。

* * *

## 回答 #3

> 赞同：23
> 
> 时间：2009-01-21T20:56:16.697

使用将 int（“容量”）作为参数的构造函数：

```
List<string> = new List<string>(10); 
```

编辑：我应该补充一点，我同意弗雷德里克。您使用 List 的方式与一开始使用它的整个推理背道而驰。

编辑2：

> 编辑 2：我目前正在编写的是一个基类，它提供默认功能作为更大框架的一部分。在我提供的默认功能中，列表的大小是预先知道的，因此我可以使用数组。但是，我想为任何基类提供动态扩展它的机会，因此我选择了一个列表。

为什么有人需要知道所有空值的 List 的大小？如果列表中没有实际值，我希望长度为 0。无论如何，这很笨拙的事实表明它违背了该类的预期用途。

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2016-09-02T10:54:18.410

首先创建一个包含您想要的项目数的数组，然后将该数组转换为列表。

```
int[] fakeArray = new int[10];

List<int> list = fakeArray.ToList(); 
```

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2009-01-21T21:24:23.550

如果要使用某个固定值的 N 个元素初始化列表：

```
public List<T> InitList<T>(int count, T initValue)
{
  return Enumerable.Repeat(initValue, count).ToList();
} 
```

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2009-01-21T20:57:37.677

如果要使用固定值对其进行初始化，为什么要使用 List ？我可以理解——为了性能——你想给它一个初始容量，但是列表相对于常规数组的优势之一不是它可以在需要时增长吗？

当你这样做时：

```
List<int> = new List<int>(100); 
```

您创建一个容量为 100 个整数的列表。这意味着在您添加第 101 个项目之前，您的列表不需要“增长”。列表的底层数组将被初始化为长度为 100。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2009-01-23T13:30:50.633

您似乎在强调需要与数据建立位置关联，那么关联数组不是更合适吗？

```
Dictionary<int, string> foo = new Dictionary<int, string>();
foo[2] = "string"; 
```

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2009-01-21T20:59:30.310

像这样初始化列表的内容并不是列表的真正用途。列表旨在保存对象。如果要将特定数字映射到特定对象，请考虑使用键值对结构（如哈希表或字典）而不是列表。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2019-07-25T14:52:21.033

接受的答案（带有绿色复选标记的答案）有问题。

问题：

```
var result = Lists.Repeated(new MyType(), sizeOfList);
// each item in the list references the same MyType() object
// if you edit item 1 in the list, you are also editing item 2 in the list 
```

我建议更改上面的行以执行对象的副本。有很多不同的文章：

*   [通过反射调用的 String.MemberwiseClone() 方法不起作用，为什么？](https://stackoverflow.com/questions/10644644/string-memberwiseclone-method-called-through-reflection-doesnt-work-why)
*   [https://code.msdn.microsoft.com/windowsdesktop/CSDeepCloneObject-8a53311e](https://code.msdn.microsoft.com/windowsdesktop/CSDeepCloneObject-8a53311e)

如果要使用默认构造函数而不是 NULL 来初始化列表中的每个项目，请添加以下方法：

```
public static List<T> RepeatedDefaultInstance<T>(int count)
    {
        List<T> ret = new List<T>(count);
        for (var i = 0; i < count; i++)
        {
            ret.Add((T)Activator.CreateInstance(typeof(T)));
        }
        return ret;
    } 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-01-21T21:05:17.613

```
string [] temp = new string[] {"1","2","3"};
List<string> temp2 = temp.ToList(); 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2014-11-24T19:15:40.033

您可以使用 Linq 巧妙地使用默认值初始化您的列表。（类似于[大卫 B 的回答](https://stackoverflow.com/a/467079/88204)。）

```
var defaultStrings = (new int[10]).Select(x => "my value").ToList(); 
```

更进一步，用不同的值“string 1”、“string 2”、“string 3”等初始化每个字符串：

```
int x = 1;
var numberedStrings = (new int[10]).Select(x => "string " + x++).ToList(); 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2016-11-09T09:27:18.500

关于 IList 的通知： [MSDN IList 备注](https://msdn.microsoft.com/en-us/library/system.collections.ilist(v=vs.110).aspx)：“IList 实现分为三类：只读、固定大小和可变大小。(...)。有关此接口的通用版本，请参阅 `System.Collections.Generic.IList<T>`。”

`IList<T>`不继承自`IList`（但`List<T>`确实实现了`IList<T>`and `IList`），但始终是[variable-size](https://msdn.microsoft.com/en-us/library/bb354714(v=vs.110).aspx)。从 .NET 4.5 开始，`IReadOnlyList<T>`除了 AFAIK 之外，我们还没有固定大小的通用列表，这正是您要寻找的。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2016-11-20T15:48:43.137

这是我用于单元测试的示例。我创建了一个类对象列表。然后我使用 forloop 添加了我期望从服务中获得的“X”个对象。这样，您可以为任何给定大小添加/初始化列表。

```
public void TestMethod1()
    {
        var expected = new List<DotaViewer.Interface.DotaHero>();
        for (int i = 0; i < 22; i++)//You add empty initialization here
        {
            var temp = new DotaViewer.Interface.DotaHero();
            expected.Add(temp);
        }
        var nw = new DotaHeroCsvService();
        var items = nw.GetHero();

        CollectionAssert.AreEqual(expected,items);

    } 
```

希望我对你们有帮助。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2020-09-12T13:35:38.523

如果我理解正确，您需要新 T[size] 的 List<T> 版本，而不需要向其添加值的开销。

如果你不怕 List<T> 的实现在未来会发生巨大的变化（而且在这种情况下我相信概率接近于 0），你可以使用反射：

```
 public static List<T> NewOfSize<T>(int size) {
        var list = new List<T>(size);
        var sizeField = list.GetType().GetField("_size",BindingFlags.Instance|BindingFlags.NonPublic);
        sizeField.SetValue(list, size);
        return list;
    } 
```

请注意，这考虑了底层数组的默认功能，以预填充项目类型的默认值。所有 int 数组的值为 0，所有引用类型数组的值为 null。另请注意，对于引用类型列表，仅创建指向每个项目的指针的空间。

如果您出于某种原因决定不使用反射，我本来希望提供带有生成器方法的 AddRange 选项，但在 List<T> 下仅调用 Insert 无数次，这不起作用。

我还想指出，Array 类有一个名为 ResizeArray 的静态方法，如果你想反过来从 Array 开始。

最后，我真的很讨厌当我问一个问题时，每个人都指出这是一个错误的问题。也许是这样，感谢您提供的信息，但我仍然想要一个答案，因为您不知道我为什么要问它。话虽如此，如果您想创建一个对资源进行最佳利用的框架，List<T> 对于任何事情来说都是一个效率很低的类，而不是在集合的末尾保存和添加东西。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2021-01-17T23:13:10.500

这是一个老问题，但我有两个解决方案。一是快速而肮脏的反射；另一个是**实际回答问题**的解决方案（设置***大小***而不是***容量***），同时仍然具有高性能，这里的答案都没有。

* * *

## 反射

这既快又脏，代码的作用应该很明显。如果你想加快速度，缓存 GetField 的结果，或者创建一个 DynamicMethod 来做：

```
public static void SetSize<T>(this List<T> l, int newSize) =>
    l.GetType().GetField("_size", BindingFlags.NonPublic | BindingFlags.Instance).SetValue(l, 10); 
```

显然很多人会犹豫是否将这样的代码投入生产。

* * *

## `ICollection<T>`

该解决方案基于这样一个事实，即构造函数`List(IEnumerable<T> collection)`优化`ICollection<T>`并立即将大小调整到正确的数量，而无需对其进行迭代。然后它调用集合`CopyTo`来进行复制。

代码如下：

```
public List(IEnumerable<T> collection) {
....
    ICollection<T> c = collection as ICollection<T>;
    if (collection is ICollection<T> c)
    {
        int count = c.Count;
        if (count == 0)
        {
            _items = s_emptyArray;
        }
        else {
            _items = new T[count];
            c.CopyTo(_items, 0);
            _size = count;
        }
    } 
```

因此，我们可以完全优化地将 List 预初始化为正确的大小，而无需任何额外的复制。

怎么会这样？通过创建一个`ICollection<T>`除了返回 a 之外什么都不做的对象`Count`。具体来说，我们***不会***实现任何`CopyTo`唯一调用其他函数的东西。

```
private class SizeCollection<T> : ICollection<T>
{
    public SizeCollection(int size) =>
        Count = size;

    public void Add(T i){}
    public void Clear(){}
    public bool Contains(T i)=>true;
    public void CopyTo(T[]a, int i){}
    public bool Remove(T i)=>true;
    public int Count {get;}
    public bool IsReadOnly=>true;
    public IEnumerator<T> GetEnumerator()=>null;
    IEnumerator IEnumerable.GetEnumerator()=>null;
}

public List<T> InitializedList<T>(int size) =>
    new List<T>(new SizeCollection<T>(size)); 
```

理论上，我们可以对现有数组`AddRange`/做同样的事情，这也解释了循环：`InsertRange``ICollection<T>``Add`

```
public void SetSize<T>(this List<T> l, int size)
{
    if(size < l.Count)
        l.RemoveRange(size, l.Count - size);
    else
        for(size -= l.Count; size > 0; size--)
            l.Add(default(T));
} 
```

* * *

## 回答 #16

> 赞同：-1
> 
> 时间：2016-11-30T01:09:50.983

有点晚了，但你提出的第一个解决方案对我来说似乎更干净：你没有分配内存两次。甚至 List 构造器也需要遍历数组才能复制它；它甚至不知道里面只有空元素。

1\. - 分配 N - 循环 N 成本：1 * allocate(N) + N * loop_iteration

2\. - 分配 N - 分配 N + loop () 成本：2 * allocate(N) + N * loop_iteration

然而，由于 List 是一个内置类，List 的分配循环可能会更快，但 C# 是 jit 编译的所以......

# sql-server - 临时表是线程安全的吗？

> ID：466947
> 
> 赞同：49
> 
> 时间：2009-01-21T20:54:25.607
> 
> 标签：sql-server, multithreading, temp-tables

我正在使用 SQL Server 2000，它的许多存储过程都广泛使用临时表。数据库有很多流量，我担心创建和删除临时表的线程安全。

假设我有一个创建一些临时表的存储过程，它甚至可以将临时表连接到其他临时表等。还可以说两个用户同时执行存储过程。

*   一个用户是否可以运行 sp 并创建一个名为 #temp 的临时表，而另一个用户运行相同的 sp 但由于数据库中已经存在一个名为 #temp 的表而被停止？

*   如果同一个用户在同一个连接上执行同一个存储过程两次呢？

*   是否有任何其他奇怪的场景可能导致两个用户查询相互干扰？

* * *

## 回答 #1

> 赞同：38
> 
> 时间：2009-01-21T20:59:05.223

对于第一种情况，不，这是不可能的，因为 #temp 是一个本地临时表，因此对其他连接不可见（假设您的用户正在使用单独的数据库连接）。临时表名称是生成的随机名称的别名，您在引用本地临时表时引用该名称。

在您的情况下，由于您在存储过程中创建本地临时表，[因此在退出过程范围时将删除该临时表](https://web.archive.org/web/20120713010552/http://msdn.microsoft.com/en-us/library/aa258255(v=sql.80).aspx)（请参阅“备注部分”）。

> 当存储过程完成时，会自动删除在存储过程中创建的本地临时表。该表可以被创建该表的存储过程执行的任何嵌套存储过程引用。调用创建该表的存储过程的进程无法引用该表。

对于第二种情况，是的，您将收到此错误，因为表已经存在，并且只要连接存在，表就会持续存在。如果是这种情况，那么我建议您在尝试创建表之前检查表是否存在。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-01-21T21:00:23.613

本地范围的临时表（带有单个 #）在它们的末尾使用标识符创建，这使得它们是唯一的；多个呼叫者（即使使用相同的登录名）永远不应重叠。

（试试看：从两个连接和相同的登录创建相同的临时表。然后查询 tempdb.dbo.sysobjects 以查看创建的实际表...）

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2012-05-08T18:20:06.510

本地临时表是线程安全的，因为它们只存在于当前上下文中。请不要将上下文与当前连接混淆（来自[MSDN](http://msdn.microsoft.com/en-us/library/ms174979.aspx)：“在存储过程中创建的本地临时表在存储过程完成时会自动删除”），同一个连接可以安全地调用两次或多次创建的存储过程本地临时表（如`#TMP`）。

您可以通过从两个连接执行以下存储过程来测试此行为。该 SP 将等待 30 秒，因此我们可以确定两个线程将同时在它们自己的 #TMP 表版本上运行：

```
CREATE PROCEDURE myProc(@n INT)
AS BEGIN
    RAISERROR('running with (%d)', 0, 1, @n);
    CREATE TABLE #TMP(n INT);
    INSERT #TMP VALUES(@n);
    INSERT #TMP VALUES(@n * 10);
    INSERT #TMP VALUES(@n * 100);
    WAITFOR DELAY '00:00:30';
    SELECT * FROM #TMP;
END; 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2017-07-18T04:28:29.390

简短的回答是：

> *每个查询*都保证了临时表的隔离，并且在线程、锁或并发访问方面没有什么可担心的。

我不确定为什么这里的答案谈论“连接”和线程的重要性，因为它们是编程概念，而*查询隔离是在数据库级别处理的*。

本地临时对象在 SQL Server 中由*Session分隔。*如果您有两个查询同时运行，那么它们是两个完全独立的会话，不会相互干扰。登录无关紧要，例如，如果您使用 ADO.NET 使用单个连接字符串（这意味着多个并发查询将使用相同的 SQL 服务器“登录”），您的查询仍将*在单独的会话中运行*。连接池也无关紧要。本地临时对象（表*和*存储过程）*完全不会被其他会话看到*。

澄清这是如何工作的；虽然您的代码对本地临时对象有一个单一的通用名称，但 SQL Server 会为每个会话的每个对象附加一个唯一的字符串，以使它们分开。您可以通过在 SSMS 中运行以下命令来查看：

```
CREATE TABLE #T (Col1 INT)

SELECT * FROM tempdb.sys.tables WHERE [name] LIKE N'#T%'; 
```

您将看到类似于以下名称的内容：

# T_______________00000000001F

然后，在不关闭该查询选项卡的情况下，打开一个新的查询选项卡并粘贴相同的查询并再次运行它。您现在应该看到如下内容：

# T_______________00000000001F

# T_______________000000000020

因此，每次您的代码引用#T 时，SQL Server 都会根据会话将其转换为正确的名称。分离都是自动处理的。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-01-21T20:56:34.247

临时表与会话相关联，因此如果不同的用户同时运行您的程序，则不会发生冲突......

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-01-21T20:57:10.157

临时表仅在创建它们的查询或过程的上下文中创建。每个新查询都会在数据库上获得一个上下文，该上下文不包含其他查询的临时表。因此，名称冲突不是问题。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-01-21T20:58:14.790

如果您查看 temps 数据库，您可以在那里看到临时表，它们具有系统生成的名称。因此，除了常规的死锁之外，您应该没问题。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-21T21:03:14.513

除非您使用两个井号##temp，否则临时表将是本地的，并且仅存在于与用户的本地连接

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-01-21T21:17:31.567

首先让我们确保您使用的是真正的临时表，它们是以 # 还是 ## 开头的？如果您在运行中创建实际表，然后反复删除和重新创建它们，您确实会遇到并发用户的问题。如果您正在创建全局临时表（以 ## 开头的临时表），您也可能会遇到问题。如果您不希望出现并发问题，请使用本地临时表（它们以 # 开头）。在 proc 结束时显式关闭它们也是一个很好的做法（或者当您正在谈论长的多步骤 proc 时，proc 不再需要它们）并在创建之前检查是否存在（如果存在则删除） .

# javascript - 部分 Javascript 语句记录到服务器

> ID：466954
> 
> 赞同：0
> 
> 时间：2009-01-21T20:56:32.827
> 
> 标签：javascript

我有一些代码可以生成要在站点的各个位置使用的 URL（图像 src、链接 href 等）。我在访问日志中看到了一些行，这些行显示了一些生成伪装成文件请求的 URL的*javascript 代码。*

例如，“/this.getIconSrc()”是我经常看到的一个。我无法弄清楚这种情况是如何发生的或为什么会发生，如果没有在位置栏中实际输入“ [http://whateverthesiteis.com/this.getIconSrc()](http://whateverthesiteis.com/this.getIconSrc()) ” ，我就无法重现它。在大多数情况下，这些函数链接在一起以生成 URL，但整个函数链不会出现在服务器日志中，只是其中的一部分。

我可能已经投入了大约 30 个小时试图弄清楚为什么会发生这种情况，但不能。这似乎不是浏览器问题，因为我在 IE 6/7、FF 2/3、Opera、Safari 3 中尝试过，但问题没有发生。有没有其他人经历过类似的事情，如果有，解决方案是什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-21T21:05:15.150

真的有三种可能：

1.  例如，您的 HTML 格式错误的 HTML 中的错误导致`onclick`泄漏到`href`
2.  您的 Javascript 中的错误`myIcon.src = 'this.getIconSrc()';`- 请注意不应该存在的引号
3.  一个写得不好的蜘蛛正在访问您的网站（就像@Diodeus 说的`<a href="javascript:somefunction()">___</a>`：）

编辑：检查日志中的用户代理和推荐人 - 他们可能会提供线索。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-21T21:04:08.007

您是否正在生成这样的 JavaScript 调用？这或许可以解释。

```
<a href="javascript:somefunction()">___</a> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-21T21:12:02.373

@RoBorg ...我认为最有可能的情况是＃3，因为这个特定的函数实际上只在一个地方被调用......

```
function whatever(){
var src = this.getIconSrc();
return src.replace( /((?:https?:\/\/)?(?:[^\/]+\/)*)[^\/]+/, '$1newimage.png' );
} 
```

# windows-vista - 会话 0 隔离

> ID：466962
> 
> 赞同：0
> 
> 时间：2009-01-21T20:58:33.680
> 
> 标签：windows-vista, service, vista-security, session-0-isolation

Vista 推出了一项新的安全措施，阻止会话 0 访问视频卡等硬件，并且用户不再登录会话 0。我知道这意味着我无法向用户显示 GUI，但是，这是否也意味着我不能显示一个吗？我的代码现在设置的方式，只使它成为命令行会做更多的工作，但是如果我可以使用我现有的代码并且只是以编程方式管理 GUI，它将需要更少的代码。

这可能吗？

MSDN 的文章是这样说的：

> • 服务尝试在会话 0 中创建用户界面 (UI)，例如对话框。由于用户未在会话 0 中运行，因此他或她永远看不到 UI，因此无法提供服务正在运行的输入寻找。该服务似乎停止运行，因为它正在等待未发生的用户响应。

这让我觉得有可能拥有一个自动化的 UI，但有人告诉我你不能将 SendKeys 与服务一起使用，因为它在 Session 0 中被禁用。

**编辑：**我实际上不需要向用户展示 GUI

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-21T21:14:06.223

你可以展示一个；它只是没有出现。

任务栏中有一个关于有一个 GUI 窗口和切换到它的方法的小通知。

无论如何，实际上有一个 TerminalServices API 命令来切换活动会话，如果您真的需要它显示，您可以调用它。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-21T21:17:35.327

您可以编写一个单独的流程，为您的服务流程提供 UI。您的 UI 和服务进程之间的通信可以通过多种方式完成（在 Web 上搜索“进程间通信”或“IPC”）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-21T22:35:20.613

您的服务可以有一个 GUI。只是没有人会看到它。正如 MSDN 引用所暗示的，服务可以显示一个对话框。调用`MessageBox`不会失败；它永远不会回来——不会有人按下它的按钮。

我不确定您想要“管理 GUI”是什么意思。你真的是说假装向控件发送输入，就像`SendInput`? 我看不出有什么不可能的理由。毕竟，您会将输入注入您自己的程序队列，而[`SendInput`特定于 Vista 的警告](http://msdn.microsoft.com/en-us/library/ms646310.aspx)并没有说明这一点。但我认为你会让事情变得比他们需要的复杂得多。重新考虑将程序更改为完全没有 UI 的想法。（这与拥有控制台程序不同。控制台是 UI。）

例如，不要模拟单击按钮所需的鼠标消息，而是消除中间人并直接调用按钮单击事件将调用的函数。

# oracle - 是否可以在不终止会话的情况下终止 oracle 中的单个查询？

> ID：466963
> 
> 赞同：16
> 
> 时间：2009-01-21T20:58:47.190
> 
> 标签：oracle, oracle10g

我希望能够在不终止整个会话的情况下终止 Oracle 10.2.0.4 中的用户查询。这将允许查询结束，但不会将该用户从他们的会话中注销，因此他们可以继续进行其他查询。这可能吗？或者是终止会话的钝锤是结束查询执行的唯一方法吗？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-01-22T15:15:41.220

我发现了一个窍门。我不知道这玩起来有多安全，但它确实有效。有一个 Oracle 事件 10237，它被描述为“模拟 ^C（用于测试目的）”。

您必须拥有要中断的会话的 SID 和 SERIAL#。

调用 SYS.DBMS_SYSTEM.SET_EV( *sid* , *serial#* , 10237, 1, '' ) 以激活目标会话中的事件。任何当前正在执行的语句都应该被中断（收到“ORA-01013：用户请求取消当前操作”）。只要设置了事件，会话尝试执行的任何进一步语句都将立即终止，并出现相同的错误。

要停用事件，请在第四个参数设置为“0”的情况下进行相同的调用。然后会话将能够再次执行语句。

请注意，目标会话必须检测到事件已设置，这可能需要时间，或者可能永远不会发生，具体取决于它正在做什么。因此，您不能只是快速打开和关闭事件。您需要将其打开，验证相关语句是否已停止，然后将其关闭。

这是一些示例代码。这意味着在 SQLPlus 中作为匿名块运行，并适当定义了替换变量“sid”和“serial”。您可以将其转换为以这些为参数的存储过程。

```
DECLARE
  l_status  v$session.status%TYPE;
BEGIN

  dbms_system.set_ev( &sid, &serial, 10237, 1, '');

  LOOP
    SELECT status INTO l_status FROM v$session
      WHERE sid = &sid and serial# = &serial;
    EXIT WHEN l_status='INACTIVE';
  END LOOP;

  dbms_system.set_ev( &sid, &serial, 10237, 0, '');
END; 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-22T09:13:59.453

我怀疑这可能是可能的，因为您可以在 TOAD 中执行此操作。当查询正在运行时，会出现一个取消对话框，您可以点击它来停止查询。

我不知道它是如何实现的，但也很想知道。

如果您使用的是 java，则应该使用 java.sql.Statement cancel() 方法来执行此操作。有关一些注意事项和限制，请参见此处...

[http://download.oracle.com/docs/cd/B14117_01/java.101/b10979/tips.htm#BACDAICJ](http://download.oracle.com/docs/cd/B14117_01/java.101/b10979/tips.htm#BACDAICJ)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-21T22:19:19.057

您可以查看资源限制：

“如果用户超过了调用级别的资源限制，那么 Oracle 会暂停该语句的处理，回滚该语句并返回一个错误。但是，当前事务的所有先前语句保持不变，并且用户的会话保持连接。 "

假设取消 SQL 的原因是资源限制，而不是更新错误的行集（例如）。我怀疑您将无法通过添加资源限制来影响当前正在运行的 SQL。

```
http://download.oracle.com/docs/cd/B19306_01/server.102/b14220/security.htm#i13767
http://download.oracle.com/docs/cd/B19306_01/server.102/b14231/dbrm.htm#i1010776 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-04-18T14:10:49.013

理想情况下，用户的应用程序应该能够取消查询（通过 OCICancel 或等效方法）。

否则，最好使用资源管理器（如果在 Oracle EE 上），您可以使用 DBMS_RESOURCE_MANAGER.SWITCH_CONSUMER_GROUP_FOR_SESS 将目标会话设置为消费者组 CANCEL_SQL。

取消其他会话查询的另一个技巧是使用 kill -URG 向 Oracle 进程发送紧急信号，但它不适用于 sqlplus Windows 客户端会话（这是一种技巧，不适合日常使用）

我写过它为什么在这里工作：

[http://blog.tanelpoder.com/2010/02/17/how-to-cancel-a-query-running-in-another-session/](http://blog.tanelpoder.com/2010/02/17/how-to-cancel-a-query-running-in-another-session/)

# arrays - MATLAB 中的矩阵数组

> ID：466972
> 
> 赞同：40
> 
> 时间：2009-01-21T20:59:54.537
> 
> 标签：arrays, matlab, matrix

我正在寻找一种在 MATLAB 的数组中存储大量可变矩阵的方法。

有没有办法实现这一目标？

例子：

```
for i: 1:unknown
  myArray(i) = zeros(500,800);
end 
```

如果数组的不同长度未知，我可以根据需要使用其他信息进行修改。

更新：性能是我试图做到这一点的主要原因。我之前有它，它将数据作为单个矩阵抓取，实时显示，然后继续处理下一组数据。

我尝试使用 Rocco 下面建议的多维数组，但是我的数据太大以至于内存不足，我可能不得不为我的情况寻找另一种选择。当我尝试其他建议时会更新。

更新 2：谢谢大家的建议，但是我应该事先指定，精度和速度都是这里不可或缺的因素，在尝试 3-d 数组并重新评估该方法之前，我可能不得不考虑回到我原来的方法用于导入数据。

* * *

## 回答 #1

> 赞同：72
> 
> 时间：2009-01-21T21:15:25.533

使用元胞数组。这比 3D 数组的优势在于它不需要*连续的内存空间*来存储所有矩阵。实际上，每个矩阵都可以存储在内存中的不同空间中，如果您的空闲内存碎片化，这将避免您出现内存不足错误。这是一个在元胞数组中创建矩阵的示例函数：

```
function result = createArrays(nArrays, arraySize)
    result = cell(1, nArrays);
    for i = 1 : nArrays
        result{i} = zeros(arraySize);
    end
end 
```

要使用它：

```
myArray = createArrays(requiredNumberOfArrays, [500 800]); 
```

并访问您的元素：

```
myArray{1}(2,3) = 10; 
```

如果您无法提前知道矩阵的数量，您可以简单地使用 MATLAB 的动态索引来使数组尽可能大。*性能开销与元胞*数组的大小成正比，不受矩阵本身大小的影响。例如：

```
myArray{1} = zeros(500, 800);
if twoRequired, myArray{2} = zeros(500, 800); end 
```

* * *

## 回答 #2

> 赞同：45
> 
> 时间：2009-01-21T21:57:48.490

如果所有矩阵的大小都相同（即 500x800），那么您可以制作一个 3D 数组：

```
nUnknown;  % The number of unknown arrays
myArray = zeros(500,800,nUnknown); 
```

要访问一个数组，您将使用以下语法：

```
subMatrix = myArray(:,:,3);  % Gets the third matrix 
```

您可以通过以下几种方式向 myArray 添加更多矩阵：

```
myArray = cat(3,myArray,zeros(500,800));
% OR
myArray(:,:,nUnknown+1) = zeros(500,800); 
```

如果每个矩阵的大小不同，则需要使用 Hosam 建议的单元格数组。

编辑：我错过了关于内存不足的部分。我猜你的 nUnknown 相当大。您可能必须切换矩阵的数据类型（如果您使用整数，则为单个或什至 uintXX 类型）。您可以在调用归零中执行此操作：

```
myArray = zeros(500,800,nUnknown,'single'); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-21T21:55:27.917

```
myArrayOfMatrices = zeros(unknown,500,800); 
```

如果您的内存不足，请在系统中添加更多 RAM，并确保您运行的是 64 位操作系统。还可以尝试降低你的精度（你真的需要双打还是单打能过得去？）：

```
myArrayOfMatrices = zeros(unknown,500,800,'single'); 
```

要附加到该数组，请尝试：

```
myArrayOfMatrices(unknown+1,:,:) = zeros(500,800); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-21T22:50:52.767

我正在使用 octave（matlab 克隆）进行一些体积渲染并构建我的 3D 数组（即 2d 切片数组）

```
buffer=zeros(1,512*512*512,"uint16");
vol=reshape(buffer,512,512,512); 
```

内存消耗似乎是有效的。（对于随后的计算速度不能说同样的话：^）

* * *

## 回答 #5

> 赞同：-2
> 
> 时间：2009-01-21T21:17:31.893

如果你知道什么是未知，

你可以做类似的事情

```
myArray = zeros(2,2);
for i: 1:unknown
  myArray(:,i) = zeros(x,y);
end 
```

然而，自从我上次使用 matlab 以来已经有一段时间了。所以这个页面可能会对这个问题有所了解：

[http://www.mathworks.com/access/helpdesk/help/techdoc/index.html?/access/helpdesk/help/techdoc/matlab_prog/f1-86528.html](http://www.mathworks.com/access/helpdesk/help/techdoc/index.html?/access/helpdesk/help/techdoc/matlab_prog/f1-86528.html)

* * *

## 回答 #6

> 赞同：-2
> 
> 时间：2016-06-28T09:18:43.587

就这样做

```
x=zeros(100,200);
for i=1:100
  for j=1:200
    x(i,j)=input('enter the number');
  end
end 
```***************